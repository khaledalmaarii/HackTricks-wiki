# WWW2Exec - GOT/PLT

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) albo **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

## **Podstawowe informacje**

### **GOT: Globalna tabela przesuniÄ™Ä‡**

**Globalna tabela przesuniÄ™Ä‡ (GOT)** to mechanizm uÅ¼ywany w binariach dynamicznie Å‚Ä…czonych do zarzÄ…dzania **adresami funkcji zewnÄ™trznych**. PoniewaÅ¼ te **adresy nie sÄ… znane do czasu wykonania** (ze wzglÄ™du na dynamiczne Å‚Ä…czenie), GOT zapewnia sposÃ³b **dynamicznego aktualizowania adresÃ³w tych symboli zewnÄ™trznych** po ich rozwiÄ…zaniu.

KaÅ¼dy wpis w GOT odpowiada symbolowi w zewnÄ™trznych bibliotekach, ktÃ³re binarny moÅ¼e wywoÅ‚aÄ‡. Gdy **funkcja jest pierwszy raz wywoÅ‚ana, jej rzeczywisty adres jest rozwiÄ…zywany przez Å‚Ä…cznik dynamiczny i przechowywany w GOT**. Kolejne wywoÅ‚ania tej samej funkcji uÅ¼ywajÄ… adresu przechowywanego w GOT, unikajÄ…c tym samym ponownego rozwiÄ…zywania adresu.

### **PLT: Tabela Å‚Ä…czenia procedur**

**Tabela Å‚Ä…czenia procedur (PLT)** Å›ciÅ›le wspÃ³Å‚pracuje z GOT i sÅ‚uÅ¼y jako trampolina do obsÅ‚ugi wywoÅ‚aÅ„ funkcji zewnÄ™trznych. Gdy binarny **wywoÅ‚uje funkcjÄ™ zewnÄ™trznÄ… po raz pierwszy, kontrola jest przekazywana do wpisu w PLT zwiÄ…zanego z tÄ… funkcjÄ…**. Ten wpis PLT jest odpowiedzialny za wywoÅ‚anie Å‚Ä…cznika dynamicznego w celu rozwiÄ…zania adresu funkcji, jeÅ›li nie zostaÅ‚ on jeszcze rozwiÄ…zany. Po rozwiÄ…zaniu adresu jest on przechowywany w **GOT**.

**Dlatego** wpisy GOT sÄ… uÅ¼ywane bezpoÅ›rednio, gdy adres funkcji zewnÄ™trznej lub zmiennej jest rozwiÄ…zany. **Wpisy PLT sÄ… uÅ¼ywane do uÅ‚atwienia poczÄ…tkowego rozwiÄ…zania** tych adresÃ³w za pomocÄ… Å‚Ä…cznika dynamicznego.

## Uzyskanie wykonania

### SprawdÅº GOT

Uzyskaj adres tabeli GOT za pomocÄ…: **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (121).png>)

ZauwaÅ¼, jak po **zaÅ‚adowaniu** **wykonywalnego** pliku w GEF moÅ¼esz **zobaczyÄ‡** **funkcje**, ktÃ³re znajdujÄ… siÄ™ w **GOT**: `gefâ¤ x/20x 0xADDR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (2) (2).png>)

Za pomocÄ… GEF moÅ¼esz **rozpoczÄ…Ä‡** sesjÄ™ **debugowania** i wykonaÄ‡ **`got`** aby zobaczyÄ‡ tabelÄ™ got:

![](<../../.gitbook/assets/image (496).png>)

### GOT2Exec

W binarnym GOT znajdujÄ… siÄ™ **adresy funkcji lub** sekcji **PLT**, ktÃ³ra zaÅ‚aduje adres funkcji. Celem tego dowolnego zapisu jest **nadpisanie wpisu GOT** funkcji, ktÃ³ra zostanie wykonana pÃ³Åºniej **adresem** PLT funkcji **`system`** na przykÅ‚ad.

Idealnie, **nadpiszesz** **GOT** funkcji, ktÃ³ra **zostanie wywoÅ‚ana z kontrolowanymi przez ciebie parametrami** (dziÄ™ki czemu bÄ™dziesz mÃ³gÅ‚ kontrolowaÄ‡ parametry przekazywane do funkcji system).

JeÅ›li **`system`** **nie jest uÅ¼ywany** przez binarny, funkcja systemowa **nie** bÄ™dzie miaÅ‚a wpisu w PLT. W takim scenariuszu bÄ™dziesz **musiaÅ‚ najpierw ujawniÄ‡ adres** funkcji `system`, a nastÄ™pnie nadpisaÄ‡ GOT, aby wskazywaÅ‚ na ten adres.

MoÅ¼esz zobaczyÄ‡ adresy PLT za pomocÄ… **`objdump -j .plt -d ./vuln_binary`**

## Wpisy GOT libc

**GOT libc** jest zazwyczaj kompilowany z **czÄ™Å›ciowym RELRO**, co czyni go atrakcyjnym celem, zakÅ‚adajÄ…c, Å¼e jest moÅ¼liwe ustalenie jego adresu ([**ASLR**](../common-binary-protections-and-bypasses/aslr/)).

Powszechne funkcje libc bÄ™dÄ… wywoÅ‚ywaÄ‡ **inne funkcje wewnÄ™trzne**, ktÃ³rych GOT moÅ¼na nadpisaÄ‡, aby uzyskaÄ‡ wykonanie kodu.

ZnajdÅº [**wiÄ™cej informacji na temat tej techniki tutaj**](https://github.com/nobodyisnobody/docs/blob/main/code.execution.on.last.libc/README.md#1---targetting-libc-got-entries).

## **Free2system**

W wyzwaleniach eksploatacji sterty jest czÄ™sto moÅ¼liwe kontrolowanie zawartoÅ›ci fragmentÃ³w i w pewnym momencie nawet nadpisanie tabeli GOT. Prostym trikiem, aby uzyskaÄ‡ RCE, jeÅ›li nie sÄ… dostÄ™pne Å¼adne gadÅ¼ety, jest nadpisanie adresu GOT `free`, aby wskazywaÅ‚ na `system` i zapisanie w fragmencie `"/bin/sh"`. W ten sposÃ³b, gdy ten fragment zostanie zwolniony, zostanie wykonane `system("/bin/sh")`.

## **Strlen2system**

InnÄ… powszechnÄ… technikÄ… jest nadpisanie adresu **`strlen`** GOT, aby wskazywaÅ‚ na **`system`**, wiÄ™c jeÅ›li ta funkcja jest wywoÅ‚ywana z wejÅ›ciem uÅ¼ytkownika, moÅ¼na przekazaÄ‡ ciÄ…g `"/bin/sh"` i uzyskaÄ‡ powÅ‚okÄ™.

Co wiÄ™cej, jeÅ›li `puts` jest uÅ¼ywane z wejÅ›ciem uÅ¼ytkownika, moÅ¼na nadpisaÄ‡ adres GOT `puts`, aby wskazywaÅ‚ na `system` i przekazaÄ‡ ciÄ…g `"/bin/sh"` w celu uzyskania powÅ‚oki, poniewaÅ¼ **`puts` wywoÅ‚a `strlen` z wejÅ›ciem uÅ¼ytkownika**.

## **One Gadget**

{% content-ref url="../rop-return-oriented-programing/ret2lib/one-gadget.md" %}
[one-gadget.md](../rop-return-oriented-programing/ret2lib/one-gadget.md)
{% endcontent-ref %}

## **Wykorzystywanie GOT z Heap**

Powszechnym sposobem uzyskania RCE z podatnoÅ›ci sterty jest naduÅ¼ycie fastbin, aby moÅ¼na byÅ‚o dodaÄ‡ czÄ™Å›Ä‡ tabeli GOT do fast bin, dziÄ™ki czemu za kaÅ¼dym razem, gdy ten fragment jest alokowany, bÄ™dzie moÅ¼liwe **nadpisanie wskaÅºnika funkcji, zwykle `free`**.\
NastÄ™pnie wskazujÄ…c `free` na `system` i zwalniajÄ…c fragment, w ktÃ³rym zostaÅ‚ zapisany `/bin/sh\x00`, zostanie wykonana powÅ‚oka.

MoÅ¼liwe jest znalezienie [**przykÅ‚adu tutaj**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/chunk\_extend\_overlapping/#hitcon-trainging-lab13)**.**
## **Ochrona**

Ochrona **Full RELRO** ma na celu ochronÄ™ przed tego rodzaju technikÄ… poprzez rozwiÄ…zanie wszystkich adresÃ³w funkcji podczas uruchamiania binarnego i ustawienie tabeli **GOT jako tylko do odczytu** po tym:

{% content-ref url="../common-binary-protections-and-bypasses/relro.md" %}
[relro.md](../common-binary-protections-and-bypasses/relro.md)
{% endcontent-ref %}

## OdnoÅ›niki

* [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
* [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
