# WWW2Exec - GOT/PLT

{% hint style="success" %}
NauÄite i veÅ¾bajte hakovanje AWS-a:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## **Osnovne informacije**

### **GOT: Globalna tabela offseta**

**Globalna tabela offseta (GOT)** je mehanizam koji se koristi u dinamiÄki povezanim binarnim fajlovima za upravljanje **adresama spoljnih funkcija**. PoÅ¡to ove **adrese nisu poznate do vremena izvrÅ¡avanja** (zbog dinamiÄkog povezivanja), GOT pruÅ¾a naÄin da se **dinamiÄki aÅ¾uriraju adrese ovih spoljnih simbola** nakon Å¡to budu reÅ¡ene.

Svaki unos u GOT-u odgovara simbolu u spoljnim bibliotekama koje binarni fajl moÅ¾e pozvati. Kada se **funkcija prvi put pozove, njena stvarna adresa se reÅ¡ava dinamiÄkim povezivaÄem i Äuva u GOT-u**. Naknadni pozivi iste funkcije koriste adresu saÄuvanu u GOT-u, Äime se izbegava troÅ¡ak ponovnog reÅ¡avanja adrese.

### **PLT: Tabela vezivanja postupaka**

**Tabela vezivanja postupaka (PLT)** tesno saraÄ‘uje sa GOT-om i sluÅ¾i kao trambolina za rukovanje pozivima spoljnih funkcija. Kada binarni fajl **pozove spoljnu funkciju prvi put, kontrola se prenosi na unos u PLT-u koji je povezan sa tom funkcijom**. Taj unos PLT-a je odgovoran za pozivanje dinamiÄkog povezivaÄa da reÅ¡i adresu funkcije ako veÄ‡ nije reÅ¡ena. Nakon Å¡to se adresa reÅ¡i, Äuva se u **GOT-u**.

**Stoga,** unosi u GOT-u se direktno koriste kada se adresa spoljne funkcije ili promenljive reÅ¡i. **Unosi u PLT-u se koriste za olakÅ¡avanje poÄetne rezolucije** ovih adresa putem dinamiÄkog povezivaÄa.

## Dobijanje izvrÅ¡enja

### Provera GOT-a

Dobijte adresu tabele GOT pomoÄ‡u: **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (121).png>)

Primetite kako nakon **uÄitavanja** **izvrÅ¡nog** fajla u GEF-u moÅ¾ete **videti** **funkcije** koje su u **GOT-u**: `gefâ¤ x/20x 0xADDR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (2) (2).png>)

KoriÅ¡Ä‡enjem GEF-a moÅ¾ete **zapoceti** **debugging** sesiju i izvrÅ¡iti **`got`** da biste videli got tabelu:

![](<../../.gitbook/assets/image (496).png>)

### GOT2Exec

U binarnom fajlu GOT ima **adrese funkcija ili** odeljak **PLT** koji Ä‡e uÄitati adresu funkcije. Cilj ovog proizvoljnog pisanja je da se **zameni unos u GOT-u** funkcije koja Ä‡e biti izvrÅ¡ena kasnije **sa** **adresom** PLT-a **funkcije** na primer **`system`**.

Idealno je **zameniti** **GOT** neke **funkcije** koja Ä‡e biti **pozvana sa parametrima koje kontroliÅ¡ete** (tako da Ä‡ete moÄ‡i da kontroliÅ¡ete parametre poslate funkciji sistema).

Ako **`system`** **nije koriÅ¡Ä‡en** od strane binarnog fajla, funkcija sistema **neÄ‡e** imati unos u PLT-u. U ovom scenariju, moraÄ‡ete **prvo procureti adresu** funkcije `system` a zatim prebrisati GOT da pokazuje na ovu adresu.

MoÅ¾ete videti adrese PLT-a sa **`objdump -j .plt -d ./vuln_binary`**

## Unosi GOT-a libc-a

**GOT libc-a** se obiÄno kompajluje sa **delimiÄnim RELRO-om**, Å¡to ga Äini dobrim ciljem za ovo pod uslovom da je moguÄ‡e saznati njegovu adresu ([**ASLR**](../common-binary-protections-and-bypasses/aslr/)).

UobiÄajene funkcije libc-a Ä‡e pozvati **druge interne funkcije** Äiji GOT moÅ¾e biti prebrisiv kako bi se dobilo izvrÅ¡enje koda.

PronaÄ‘ite [**viÅ¡e informacija o ovoj tehnici ovde**](https://github.com/nobodyisnobody/docs/blob/main/code.execution.on.last.libc/README.md#1---targetting-libc-got-entries).

### **Free2system**

U CTF-ovima za eksploataciju hipa Äesto je moguÄ‡e kontrolisati sadrÅ¾aj blokova i u nekom trenutku Äak prebrisati GOT tabelu. Jedan jednostavan trik za dobijanje RCE ako nisu dostupni jednostavni alati je prebrisati adresu `free` u GOT-u da pokazuje na `system` i zapisati unutar bloka `"/bin/sh"`. Na ovaj naÄin, kada se ovaj blok oslobodi, izvrÅ¡iÄ‡e se `system("/bin/sh")`.

### **Strlen2system**

JoÅ¡ jedna uobiÄajena tehnika je prebrisati **`strlen`** adresu u GOT-u da pokazuje na **`system`**, tako da ako se ova funkcija pozove sa korisniÄkim unosom moguÄ‡e je proslediti string `"/bin/sh"` i dobiti shell.

Osim toga, ako se `puts` koristi sa korisniÄkim unosom, moguÄ‡e je prebrisati adresu `strlen` u GOT-u da pokazuje na `system` i proslediti string `"/bin/sh"` da biste dobili shell jer **`puts` Ä‡e pozvati `strlen` sa korisniÄkim unosom**.

## **Jedan alat**

{% content-ref url="../rop-return-oriented-programing/ret2lib/one-gadget.md" %}
[one-gadget.md](../rop-return-oriented-programing/ret2lib/one-gadget.md)
{% endcontent-ref %}

## **Zloupotreba GOT-a iz hipa**

UobiÄajeni naÄin dobijanja RCE iz ranjivosti hipa je zloupotreba fastbin-a kako bi se deo GOT tabele dodao u brzi bin, tako da Ä‡e biti moguÄ‡e **prebrisati pokazivaÄ funkcije, obiÄno `free`**.\
Zatim, usmeravanje `free` na `system` i oslobaÄ‘anje bloka gde je napisano `/bin/sh\x00` izvrÅ¡iÄ‡e shell.

MoguÄ‡e je pronaÄ‡i [**primer ovde**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/chunk\_extend\_overlapping/#hitcon-trainging-lab13)**.**
## **ZaÅ¡tite**

ZaÅ¡tita **Full RELRO** namenjena je zaÅ¡titi od ovakvih tehnika tako Å¡to reÅ¡ava sve adrese funkcija kada se binarni fajl pokrene i Äini **GOT tabelu samo za Äitanje** nakon toga:

{% content-ref url="../common-binary-protections-and-bypasses/relro.md" %}
[relro.md](../common-binary-protections-and-bypasses/relro.md)
{% endcontent-ref %}

## Reference

* [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
* [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

{% hint style="success" %}
NauÄite i veÅ¾bajte hakovanje AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Obuka AWS Red Tim Ekspert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Obuka GCP Red Tim Ekspert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
