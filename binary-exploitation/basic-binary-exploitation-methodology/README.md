# Podstawowa Metodologia Eksploatacji Binarnych

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) albo **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

## Podstawowe Informacje o ELF

Zanim zaczniesz eksploatowaÄ‡ cokolwiek, warto zrozumieÄ‡ czÄ™Å›Ä‡ struktury **binarnego pliku ELF**:

{% content-ref url="elf-tricks.md" %}
[elf-tricks.md](elf-tricks.md)
{% endcontent-ref %}

## NarzÄ™dzia Eksploatacji

{% content-ref url="tools/" %}
[narzÄ™dzia](tools/)
{% endcontent-ref %}

## Metodologia PrzepeÅ‚nienia Stosu

Z tak wieloma technikami dobrze jest mieÄ‡ schemat, kiedy kaÅ¼da technika bÄ™dzie przydatna. ZauwaÅ¼, Å¼e te same zabezpieczenia bÄ™dÄ… wpÅ‚ywaÄ‡ na rÃ³Å¼ne techniki. Sposoby obejÅ›cia zabezpieczeÅ„ moÅ¼na znaleÅºÄ‡ w kaÅ¼dej sekcji zabezpieczeÅ„, ale nie w tej metodologii.

## Kontrolowanie PrzepÅ‚ywu

Istnieje kilka sposobÃ³w, w jaki moÅ¼na kontrolowaÄ‡ przepÅ‚yw programu:

* [**PrzepeÅ‚nienia Stosu**](../stack-overflow/) nadpisywanie wskaÅºnika powrotu ze stosu lub EBP -> ESP -> EIP.
* ByÄ‡ moÅ¼e trzeba wykorzystaÄ‡ [**PrzepeÅ‚nienia Liczb CaÅ‚kowitych**](../integer-overflow.md), aby spowodowaÄ‡ przepeÅ‚nienie.
* Lub poprzez **Arbitrary Writes + Write What Where to Execution**
* [**Formatowanie Å‚aÅ„cuchÃ³w**](../format-strings/)**:** Wykorzystanie `printf` do zapisywania dowolnej zawartoÅ›ci pod dowolnymi adresami.
* [**Indeksowanie Tablic**](../array-indexing.md): Wykorzystanie Åºle zaprojektowanego indeksowania, aby mÃ³c kontrolowaÄ‡ niektÃ³re tablice i uzyskaÄ‡ dowolny zapis.
* ByÄ‡ moÅ¼e trzeba wykorzystaÄ‡ [**PrzepeÅ‚nienia Liczb CaÅ‚kowitych**](../integer-overflow.md), aby spowodowaÄ‡ przepeÅ‚nienie
* **bof to WWW via ROP**: Wykorzystanie przepeÅ‚nienia bufora do skonstruowania ROP i uzyskania WWW.

Techniki **Write What Where to Execution** moÅ¼na znaleÅºÄ‡ w:

{% content-ref url="../arbitrary-write-2-exec/" %}
[arbitrary-write-2-exec](../arbitrary-write-2-exec/)
{% endcontent-ref %}

## Wieczne PÄ™tle

Warto wziÄ…Ä‡ pod uwagÄ™, Å¼e zazwyczaj **jedna eksploatacja podatnoÅ›ci moÅ¼e nie wystarczyÄ‡** do wykonania udanego ataku, zwÅ‚aszcza gdy trzeba ominÄ…Ä‡ pewne zabezpieczenia. Dlatego interesujÄ…ce jest omÃ³wienie kilku opcji, aby **umoÅ¼liwiÄ‡ wielokrotne wykorzystanie jednej podatnoÅ›ci** w tym samym wykonaniu binarnego pliku:

* Zapisz w Å‚aÅ„cuchu **ROP** adres funkcji **`main`** lub adres, gdzie wystÄ™puje **podatnoÅ›Ä‡**.
* KontrolujÄ…c odpowiedni Å‚aÅ„cuch ROP, moÅ¼esz wykonaÄ‡ wszystkie akcje w tym Å‚aÅ„cuchu.
* Zapisz adres **`exit` w GOT** (lub dowolnej innej funkcji uÅ¼ywanej przez binarny plik przed zakoÅ„czeniem) adres, aby wrÃ³ciÄ‡ **do podatnoÅ›ci**.
* Jak wyjaÅ›niono w [**.fini\_array**](../arbitrary-write-2-exec/www2exec-.dtors-and-.fini\_array.md#eternal-loop)**,** przechowuj tutaj 2 funkcje, jednÄ… do ponownego wywoÅ‚ania podatnoÅ›ci i drugÄ… do wywoÅ‚ania**`__libc_csu_fini`**, ktÃ³ra ponownie wywoÅ‚a funkcjÄ™ z `.fini_array`.

## Cele Eksploatacji

### Cel: WywoÅ‚anie IstniejÄ…cej Funkcji

* [**ret2win**](./#ret2win): Istnieje funkcja w kodzie, ktÃ³rÄ… musisz wywoÅ‚aÄ‡ (byÄ‡ moÅ¼e z okreÅ›lonymi parametrami), aby uzyskaÄ‡ flagÄ™.
* W zwykÅ‚ym przepeÅ‚nieniu bufora bez [**PIE**](../common-binary-protections-and-bypasses/pie/) **i** [**canary**](../common-binary-protections-and-bypasses/stack-canaries/), wystarczy zapisaÄ‡ adres w adresie powrotu przechowywanym na stosie.
* W przypadku przepeÅ‚nienia bufora z [**PIE**](../common-binary-protections-and-bypasses/pie/), bÄ™dziesz musiaÅ‚ je ominÄ…Ä‡.
* W przypadku przepeÅ‚nienia bufora z [**canary**](../common-binary-protections-and-bypasses/stack-canaries/), bÄ™dziesz musiaÅ‚ je ominÄ…Ä‡.
* JeÅ›li musisz ustawiÄ‡ kilka parametrÃ³w, aby poprawnie wywoÅ‚aÄ‡ funkcjÄ™ **ret2win**, moÅ¼esz uÅ¼yÄ‡:
* ÅaÅ„cucha [**ROP**](./#rop-and-ret2...-techniques) **jeÅ›li jest wystarczajÄ…co duÅ¼o gadÅ¼etÃ³w**, aby przygotowaÄ‡ wszystkie parametry
* [**SROP**](../rop-return-oriented-programing/srop-sigreturn-oriented-programming.md) (jeÅ›li moÅ¼na wywoÅ‚aÄ‡ ten syscall) do kontrolowania wielu rejestrÃ³w
* GadÅ¼etÃ³w z [**ret2csu**](../rop-return-oriented-programing/ret2csu.md) i [**ret2vdso**](../rop-return-oriented-programing/ret2vdso.md) do kontrolowania kilku rejestrÃ³w
* Poprzez [**Write What Where**](../arbitrary-write-2-exec/) moÅ¼na wykorzystaÄ‡ inne podatnoÅ›ci (nie bof), aby wywoÅ‚aÄ‡ funkcjÄ™ **`win`**.
* [**Przekierowywanie WskaÅºnikÃ³w**](../stack-overflow/pointer-redirecting.md): W przypadku, gdy stos zawiera wskaÅºniki do funkcji, ktÃ³ra ma zostaÄ‡ wywoÅ‚ana lub do ciÄ…gu znakÃ³w, ktÃ³ry ma byÄ‡ uÅ¼yty przez interesujÄ…cÄ… funkcjÄ™ (system lub printf), moÅ¼na nadpisaÄ‡ ten adres.
* [**ASLR**](../common-binary-protections-and-bypasses/aslr/) lub [**PIE**](../common-binary-protections-and-bypasses/pie/) mogÄ… wpÅ‚ynÄ…Ä‡ na adresy.
* [**Nie zainicjowane zmienne**](../stack-overflow/uninitialized-variables.md): Nigdy nie wiesz.

### Cel: RCE

#### Poprzez shellcode, jeÅ›li nx jest wyÅ‚Ä…czone lub Å‚Ä…czenie shellcode z ROP:

* [**(Stack) Shellcode**](./#stack-shellcode): Jest to przydatne do przechowywania shellcode'u na stosie przed lub po nadpisaniu wskaÅºnika powrotu, a nastÄ™pnie **skok do niego** w celu wykonania:
* **W kaÅ¼dym przypadku, jeÅ›li jest** [**canary**](../common-binary-protections-and-bypasses/stack-canaries/), w zwykÅ‚ym przepeÅ‚nieniu bufora trzeba go ominÄ…Ä‡ (wyciek).
* **Bez** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **i** [**nx**](../common-binary-protections-and-bypasses/no-exec-nx.md) moÅ¼na skoczyÄ‡ pod adres stosu, poniewaÅ¼ nie zmieni siÄ™ on nigdy
* **Z** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) bÄ™dziesz musiaÅ‚ uÅ¼yÄ‡ technik takich jak [**ret2esp/ret2reg**](../rop-return-oriented-programing/ret2esp-ret2reg.md), aby skoczyÄ‡ do niego
* **Z** [**nx**](../common-binary-protections-and-bypasses/no-exec-nx.md), bÄ™dziesz musiaÅ‚ uÅ¼yÄ‡ pewnego [**ROP**](../rop-return-oriented-programing/) **do wywoÅ‚ania `memprotect`** i uczynienia pewnej strony `rwx`, aby nastÄ™pnie **przechowaÄ‡ tam shellcode** (wywoÅ‚ujÄ…c na przykÅ‚ad read) i potem skoczyÄ‡ tam.
* To poÅ‚Ä…czy shellcode z Å‚aÅ„cuchem ROP.
#### Za pomocÄ… wywoÅ‚aÅ„ systemowych

* [**Ret2syscall**](../rop-return-oriented-programing/rop-syscall-execv.md): Przydatne do wywoÅ‚ania `execve` w celu uruchomienia dowolnych poleceÅ„. Musisz byÄ‡ w stanie znaleÅºÄ‡ **gadÅ¼ety do wywoÅ‚ania okreÅ›lonego wywoÅ‚ania systemowego z parametrami**.
* JeÅ›li sÄ… wÅ‚Ä…czone [**ASLR**](../common-binary-protections-and-bypasses/aslr/) lub [**PIE**](../common-binary-protections-and-bypasses/pie/), bÄ™dziesz musiaÅ‚ je pokonaÄ‡, **aby uÅ¼yÄ‡ gadÅ¼etÃ³w ROP** z binariÃ³w lub bibliotek.
* [**SROP**](../rop-return-oriented-programing/srop-sigreturn-oriented-programming.md) moÅ¼e byÄ‡ przydatne do przygotowania **ret2execve**.
* GadÅ¼ety z [**ret2csu**](../rop-return-oriented-programing/ret2csu.md) i [**ret2vdso**](../rop-return-oriented-programing/ret2vdso.md) do kontrolowania kilku rejestrÃ³w

#### Za pomocÄ… libc

* [**Ret2lib**](../rop-return-oriented-programing/ret2lib/): Przydatne do wywoÅ‚ania funkcji z biblioteki (zazwyczaj z **`libc`**) jak **`system`** z przygotowanymi argumentami (np. `'/bin/sh'`). Potrzebujesz, aby binarny **zaÅ‚adowaÅ‚ bibliotekÄ™** z funkcjÄ…, ktÃ³rÄ… chcesz wywoÅ‚aÄ‡ (zazwyczaj libc).
* JeÅ›li jest **skompilowany statycznie i nie ma** [**PIE**](../common-binary-protections-and-bypasses/pie/), **adres** `system` i `/bin/sh` nie zmieniÄ… siÄ™, wiÄ™c moÅ¼na ich uÅ¼yÄ‡ statycznie.
* **Bez** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **i znajÄ…c wersjÄ™ libc** zaÅ‚adowanÄ…, **adres** `system` i `/bin/sh` nie zmieniÄ… siÄ™, wiÄ™c moÅ¼na ich uÅ¼yÄ‡ statycznie.
* Z [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **ale bez** [**PIE**](../common-binary-protections-and-bypasses/pie/), znajÄ…c libc i z binarnym uÅ¼ywajÄ…cym funkcji `system`, moÅ¼na **`ret` do adresu systemu w GOT** z adresem `'/bin/sh'` w parametrze (trzeba to ustaliÄ‡).
* Z [ASLR](../common-binary-protections-and-bypasses/aslr/) ale bez [PIE](../common-binary-protections-and-bypasses/pie/), znajÄ…c libc i **bez uÅ¼ycia binarnego `system`**:
* UÅ¼yj [**`ret2dlresolve`**](../rop-return-oriented-programing/ret2dlresolve.md) do rozwiÄ…zania adresu `system` i jego wywoÅ‚ania&#x20;
* **OminiÄ™cie** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) i obliczenie adresu `system` i `'/bin/sh'` w pamiÄ™ci.
* **Z** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **i** [**PIE**](../common-binary-protections-and-bypasses/pie/) **i nie znajÄ…c wersji libc**: Musisz:
* OminÄ…Ä‡ [**PIE**](../common-binary-protections-and-bypasses/pie/)
* ZnaleÅºÄ‡ uÅ¼ywanÄ… **wersjÄ™ libc** (wyciek kilku adresÃ³w funkcji)
* SprawdÅº **poprzednie scenariusze z ASLR**, aby kontynuowaÄ‡.

#### Za pomocÄ… EBP/RBP

* [**Stack Pivoting / EBP2Ret / EBP Chaining**](../stack-overflow/stack-pivoting-ebp2ret-ebp-chaining.md): Kontroluj ESP, aby kontrolowaÄ‡ RET poprzez przechowywane EBP na stosie.
* Przydatne do przepeÅ‚nieÅ„ stosu **off-by-one**
* Przydatne jako alternatywny sposÃ³b na kontrolowanie EIP, wykorzystujÄ…c EIP do konstruowania Å‚adunku w pamiÄ™ci, a nastÄ™pnie skakania do niego za pomocÄ… EBP

#### RÃ³Å¼ne

* [**Przekierowywanie wskaÅºnikÃ³w**](../stack-overflow/pointer-redirecting.md): W przypadku, gdy stos zawiera wskaÅºniki do funkcji, ktÃ³ra ma zostaÄ‡ wywoÅ‚ana lub do ciÄ…gu znakÃ³w, ktÃ³ry ma byÄ‡ uÅ¼yty przez interesujÄ…cÄ… funkcjÄ™ (system lub printf), moÅ¼liwe jest nadpisanie tego adresu.
* [**ASLR**](../common-binary-protections-and-bypasses/aslr/) lub [**PIE**](../common-binary-protections-and-bypasses/pie/) mogÄ… wpÅ‚ynÄ…Ä‡ na adresy.
* [**Nie zainicjowane zmienne**](../stack-overflow/uninitialized-variables.md): Nigdy nie wiesz

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
