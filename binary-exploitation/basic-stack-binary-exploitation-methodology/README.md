# åŸºæœ¬äºŒè¿›åˆ¶åˆ©ç”¨æ–¹æ³•è®º

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹  AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹  GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## ELF åŸºæœ¬ä¿¡æ¯

åœ¨å¼€å§‹åˆ©ç”¨ä»»ä½•ä¸œè¥¿ä¹‹å‰ï¼Œäº†è§£ **ELF äºŒè¿›åˆ¶æ–‡ä»¶** çš„ç»“æ„çš„ä¸€éƒ¨åˆ†æ˜¯å¾ˆæœ‰è¶£çš„ï¼š

{% content-ref url="elf-tricks.md" %}
[elf-tricks.md](elf-tricks.md)
{% endcontent-ref %}

## åˆ©ç”¨å·¥å…·

{% content-ref url="tools/" %}
[tools](tools/)
{% endcontent-ref %}

## æ ˆæº¢å‡ºæ–¹æ³•è®º

æœ‰è¿™ä¹ˆå¤šæŠ€æœ¯ï¼Œæœ€å¥½æœ‰ä¸€ä¸ªæ–¹æ¡ˆï¼Œç¡®å®šä½•æ—¶ä½¿ç”¨æ¯ç§æŠ€æœ¯ã€‚è¯·æ³¨æ„ï¼Œç›¸åŒçš„ä¿æŠ¤æªæ–½ä¼šå½±å“ä¸åŒçš„æŠ€æœ¯ã€‚æ‚¨å¯ä»¥åœ¨æ¯ä¸ªä¿æŠ¤éƒ¨åˆ†æ‰¾åˆ°ç»•è¿‡ä¿æŠ¤çš„æ–¹æ³•ï¼Œä½†åœ¨è¿™ä¸ªæ–¹æ³•è®ºä¸­æ²¡æœ‰æåˆ°ã€‚

## æ§åˆ¶æµ

æœ‰ä¸åŒçš„æ–¹æ³•å¯ä»¥æ§åˆ¶ç¨‹åºçš„æµç¨‹ï¼š

* [**æ ˆæº¢å‡º**](../stack-overflow/) è¦†ç›–æ ˆä¸Šçš„è¿”å›æŒ‡é’ˆæˆ– EBP -> ESP -> EIPã€‚
* å¯èƒ½éœ€è¦æ»¥ç”¨ [**æ•´æ•°æº¢å‡º**](../integer-overflow.md) æ¥å¼•å‘æº¢å‡º
* æˆ–é€šè¿‡ **ä»»æ„å†™å…¥ + å†™å…¥ä½•å¤„æ‰§è¡Œ**ã€‚
* [**æ ¼å¼åŒ–å­—ç¬¦ä¸²**](../format-strings/)**ï¼š**æ»¥ç”¨ `printf` åœ¨ä»»æ„åœ°å€å†™å…¥ä»»æ„å†…å®¹ã€‚
* [**æ•°ç»„ç´¢å¼•**](../array-indexing.md)ï¼šæ»¥ç”¨è®¾è®¡ä¸è‰¯çš„ç´¢å¼•ä»¥æ§åˆ¶æŸäº›æ•°ç»„å¹¶è¿›è¡Œä»»æ„å†™å…¥ã€‚
* å¯èƒ½éœ€è¦æ»¥ç”¨ [**æ•´æ•°æº¢å‡º**](../integer-overflow.md) æ¥å¼•å‘æº¢å‡º
* **bof to WWW via ROP**ï¼šæ»¥ç”¨ç¼“å†²åŒºæº¢å‡ºæ„å»º ROP å¹¶èƒ½å¤Ÿè·å¾— WWWã€‚

æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ° **å†™å…¥ä½•å¤„æ‰§è¡Œ** æŠ€æœ¯ï¼š

{% content-ref url="../arbitrary-write-2-exec/" %}
[arbitrary-write-2-exec](../arbitrary-write-2-exec/)
{% endcontent-ref %}

## æ°¸ä¹…å¾ªç¯

éœ€è¦è€ƒè™‘çš„ä¸€ç‚¹æ˜¯é€šå¸¸**ä»…åˆ©ç”¨æ¼æ´ä¸€æ¬¡å¯èƒ½ä¸è¶³ä»¥æ‰§è¡ŒæˆåŠŸçš„åˆ©ç”¨**ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç»•è¿‡æŸäº›ä¿æŠ¤æªæ–½ã€‚å› æ­¤ï¼Œæœ‰è¶£çš„æ˜¯è®¨è®ºä¸€äº›é€‰é¡¹ï¼Œ**ä½¿å•ä¸ªæ¼æ´åœ¨äºŒè¿›åˆ¶æ–‡ä»¶çš„åŒä¸€æ‰§è¡Œä¸­å¯å¤šæ¬¡åˆ©ç”¨**ï¼š

* åœ¨ **ROP** é“¾ä¸­å†™å…¥ **`main` å‡½æ•°çš„åœ°å€** æˆ–æ¼æ´å‘ç”Ÿçš„åœ°å€ã€‚
* æ§åˆ¶é€‚å½“çš„ ROP é“¾ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿæ‰§è¡Œè¯¥é“¾ä¸­çš„æ‰€æœ‰æ“ä½œ
* åœ¨ **GOT ä¸­çš„ `exit` åœ°å€**ï¼ˆæˆ–äºŒè¿›åˆ¶æ–‡ä»¶åœ¨ç»“æŸä¹‹å‰ä½¿ç”¨çš„ä»»ä½•å…¶ä»–å‡½æ•°ï¼‰ä¸­å†™å…¥è¿”å›åˆ°æ¼æ´çš„åœ°å€
* å¦‚ [**.fini\_array**](../arbitrary-write-2-exec/www2exec-.dtors-and-.fini\_array.md#eternal-loop) ä¸­æ‰€è¿°ï¼Œè¿™é‡Œå­˜å‚¨ 2 ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªç”¨äºå†æ¬¡è°ƒç”¨æ¼æ´ï¼Œå¦ä¸€ä¸ªç”¨äºè°ƒç”¨ **`__libc_csu_fini`**ï¼Œåè€…å°†å†æ¬¡è°ƒç”¨ `.fini_array` ä¸­çš„å‡½æ•°ã€‚

## åˆ©ç”¨ç›®æ ‡

### ç›®æ ‡ï¼šè°ƒç”¨ç°æœ‰å‡½æ•°

* [**ret2win**](./#ret2win)ï¼šä»£ç ä¸­æœ‰ä¸€ä¸ªéœ€è¦è°ƒç”¨çš„å‡½æ•°ï¼ˆå¯èƒ½å¸¦æœ‰ä¸€äº›ç‰¹å®šå‚æ•°ï¼‰ä»¥è·å–æ ‡å¿—ã€‚
* åœ¨æ²¡æœ‰ [**PIE**](../common-binary-protections-and-bypasses/pie/) å’Œ [**canary**](../common-binary-protections-and-bypasses/stack-canaries/) çš„å¸¸è§„ bof ä¸­ï¼Œåªéœ€åœ¨æ ˆä¸­å­˜å‚¨çš„è¿”å›åœ°å€ä¸­å†™å…¥åœ°å€ã€‚
* åœ¨å¸¦æœ‰ [**PIE**](../common-binary-protections-and-bypasses/pie/) çš„ bof ä¸­ï¼Œæ‚¨å°†éœ€è¦ç»•è¿‡å®ƒ
* åœ¨å¸¦æœ‰ [**canary**](../common-binary-protections-and-bypasses/stack-canaries/) çš„ bof ä¸­ï¼Œæ‚¨å°†éœ€è¦ç»•è¿‡å®ƒ
* å¦‚æœéœ€è¦è®¾ç½®å¤šä¸ªå‚æ•°ä»¥æ­£ç¡®è°ƒç”¨ **ret2win** å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ï¼š
* å¦‚æœæœ‰è¶³å¤Ÿçš„ gadgetï¼Œå¯ä»¥ä½¿ç”¨ [**ROP**](./#rop-and-ret2...-techniques) é“¾æ¥å‡†å¤‡æ‰€æœ‰å‚æ•°
* [**SROP**](../rop-return-oriented-programing/srop-sigreturn-oriented-programming/)ï¼ˆå¦‚æœå¯ä»¥è°ƒç”¨æ­¤ç³»ç»Ÿè°ƒç”¨ï¼‰æ¥æ§åˆ¶è®¸å¤šå¯„å­˜å™¨
* æ¥è‡ª [**ret2csu**](../rop-return-oriented-programing/ret2csu.md) å’Œ [**ret2vdso**](../rop-return-oriented-programing/ret2vdso.md) çš„ gadget æ¥æ§åˆ¶å¤šä¸ªå¯„å­˜å™¨
* é€šè¿‡ [**Write What Where**](../arbitrary-write-2-exec/)ï¼Œæ‚¨å¯ä»¥æ»¥ç”¨å…¶ä»–æ¼æ´ï¼ˆé bofï¼‰æ¥è°ƒç”¨ **`win`** å‡½æ•°ã€‚
* [**æŒ‡é’ˆé‡å®šå‘**](../stack-overflow/pointer-redirecting.md)ï¼šå¦‚æœæ ˆåŒ…å«å°†è¦è°ƒç”¨çš„å‡½æ•°çš„æŒ‡é’ˆï¼Œæˆ–è€…åŒ…å«å°†è¦è¢«æœ‰è¶£å‡½æ•°ï¼ˆsystem æˆ– printfï¼‰ä½¿ç”¨çš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œå¯ä»¥è¦†ç›–è¯¥åœ°å€ã€‚
* [**ASLR**](../common-binary-protections-and-bypasses/aslr/) æˆ– [**PIE**](../common-binary-protections-and-bypasses/pie/) å¯èƒ½ä¼šå½±å“åœ°å€ã€‚
* [**æœªåˆå§‹åŒ–å˜é‡**](../stack-overflow/uninitialized-variables.md)ï¼šä½ æ°¸è¿œä¸çŸ¥é“ã€‚

### ç›®æ ‡ï¼šRCE

#### é€šè¿‡ shellcodeï¼Œå¦‚æœ nx ç¦ç”¨æˆ–å°† shellcode ä¸ ROP æ··åˆï¼š

* [**(Stack) Shellcode**](./#stack-shellcode)ï¼šè¿™å¯¹äºåœ¨æ ˆä¸­å­˜å‚¨ shellcode å¹¶åœ¨è¦†ç›–è¿”å›æŒ‡é’ˆä¹‹å‰æˆ–ä¹‹åè·³è½¬åˆ°å®ƒä»¥æ‰§è¡Œå®ƒéå¸¸æœ‰ç”¨ï¼š
* **åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰** [**canary**](../common-binary-protections-and-bypasses/stack-canaries/)**ï¼Œåœ¨å¸¸è§„ bof ä¸­ï¼Œæ‚¨å°†éœ€è¦ç»•è¿‡ï¼ˆæ³„æ¼ï¼‰å®ƒ**
* **æ²¡æœ‰** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **å’Œ** [**nx**](../common-binary-protections-and-bypasses/no-exec-nx.md)ï¼Œå¯ä»¥è·³è½¬åˆ°æ ˆçš„åœ°å€ï¼Œå› ä¸ºå®ƒæ°¸è¿œä¸ä¼šæ”¹å˜
* **æœ‰** [**ASLR**](../common-binary-protections-and-bypasses/aslr/)ï¼Œæ‚¨å°†éœ€è¦ä½¿ç”¨è¯¸å¦‚ [**ret2esp/ret2reg**](../rop-return-oriented-programing/ret2esp-ret2reg.md) çš„æŠ€æœ¯æ¥è·³è½¬åˆ°å®ƒ
* **æœ‰** [**nx**](../common-binary-protections-and-bypasses/no-exec-nx.md)ï¼Œæ‚¨å°†éœ€è¦ä½¿ç”¨ä¸€äº› [**ROP**](../rop-return-oriented-programing/) **æ¥è°ƒç”¨ `memprotect`** å¹¶ä½¿æŸäº›é¡µé¢ `rwx`ï¼Œç„¶å **åœ¨é‚£é‡Œå­˜å‚¨ shellcode**ï¼ˆä¾‹å¦‚è°ƒç”¨ readï¼‰ç„¶åè·³è½¬åˆ°é‚£é‡Œã€‚
* è¿™å°†æ··åˆ shellcode ä¸ ROP é“¾ã€‚
#### é€šè¿‡ç³»ç»Ÿè°ƒç”¨

* [**Ret2syscall**](../rop-return-oriented-programing/rop-syscall-execv/): ç”¨äºè°ƒç”¨ `execve` ä»¥è¿è¡Œä»»æ„å‘½ä»¤ã€‚æ‚¨éœ€è¦èƒ½å¤Ÿæ‰¾åˆ°**è°ƒç”¨ç‰¹å®šç³»ç»Ÿè°ƒç”¨çš„å‚æ•°çš„gadgets**ã€‚
* å¦‚æœå¯ç”¨äº†[**ASLR**](../common-binary-protections-and-bypasses/aslr/)æˆ–[**PIE**](../common-binary-protections-and-bypasses/pie/)ï¼Œæ‚¨éœ€è¦æ‰“è´¥å®ƒä»¬**ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶æˆ–åº“ä¸­çš„ROP gadgets**ã€‚
* [**SROP**](../rop-return-oriented-programing/srop-sigreturn-oriented-programming/)å¯ç”¨äºå‡†å¤‡**ret2execve**
* æ¥è‡ª[**ret2csu**](../rop-return-oriented-programing/ret2csu.md)å’Œ[**ret2vdso**](../rop-return-oriented-programing/ret2vdso.md)çš„gadgetså¯ç”¨äºæ§åˆ¶å¤šä¸ªå¯„å­˜å™¨

#### é€šè¿‡libc

* [**Ret2lib**](../rop-return-oriented-programing/ret2lib/): ç”¨äºè°ƒç”¨åº“ä¸­çš„å‡½æ•°ï¼ˆé€šå¸¸æ¥è‡ª**`libc`**ï¼‰å¦‚**`system`**å¹¶å¸¦æœ‰ä¸€äº›å‡†å¤‡å¥½çš„å‚æ•°ï¼ˆä¾‹å¦‚`'/bin/sh'`ï¼‰ã€‚æ‚¨éœ€è¦äºŒè¿›åˆ¶æ–‡ä»¶**åŠ è½½åŒ…å«æ‚¨æƒ³è¦è°ƒç”¨çš„å‡½æ•°çš„åº“**ï¼ˆé€šå¸¸æ˜¯libcï¼‰ã€‚
* å¦‚æœ**é™æ€ç¼–è¯‘ä¸”æ²¡æœ‰**[**PIE**](../common-binary-protections-and-bypasses/pie/)ï¼Œ`system`å’Œ`/bin/sh`çš„**åœ°å€**ä¸ä¼šæ”¹å˜ï¼Œå› æ­¤å¯ä»¥é™æ€ä½¿ç”¨å®ƒä»¬ã€‚
* **æ²¡æœ‰**[**ASLR**](../common-binary-protections-and-bypasses/aslr/) **å¹¶ä¸”çŸ¥é“åŠ è½½çš„libcç‰ˆæœ¬**ï¼Œ`system`å’Œ`/bin/sh`çš„**åœ°å€**ä¸ä¼šæ”¹å˜ï¼Œå› æ­¤å¯ä»¥é™æ€ä½¿ç”¨å®ƒä»¬ã€‚
* å…·æœ‰[**ASLR**](../common-binary-protections-and-bypasses/aslr/) **ä½†æ²¡æœ‰**[**PIE**](../common-binary-protections-and-bypasses/pie/)**ï¼ŒçŸ¥é“libcå¹¶ä¸”äºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨`system`**å‡½æ•°æ—¶ï¼Œå¯ä»¥**`ret`åˆ°GOTä¸­systemçš„åœ°å€**ï¼Œå‚æ•°ä¸º`'/bin/sh'`çš„åœ°å€ï¼ˆæ‚¨éœ€è¦å¼„æ¸…æ¥šè¿™ä¸€ç‚¹ï¼‰ã€‚
* å…·æœ‰[ASLR](../common-binary-protections-and-bypasses/aslr/)ä½†æ²¡æœ‰[PIE](../common-binary-protections-and-bypasses/pie/)ï¼ŒçŸ¥é“libcå¹¶ä¸”**äºŒè¿›åˆ¶æ–‡ä»¶ä¸ä½¿ç”¨`system`**ï¼š
* ä½¿ç”¨[**`ret2dlresolve`**](../rop-return-oriented-programing/ret2dlresolve.md)è§£æ`system`çš„åœ°å€å¹¶è°ƒç”¨å®ƒ&#x20;
* **ç»•è¿‡**[**ASLR**](../common-binary-protections-and-bypasses/aslr/)å¹¶è®¡ç®—å†…å­˜ä¸­`system`å’Œ`'/bin/sh'`çš„åœ°å€ã€‚
* å…·æœ‰[**ASLR**](../common-binary-protections-and-bypasses/aslr/) **å’Œ** [**PIE**](../common-binary-protections-and-bypasses/pie/) **ä½†ä¸çŸ¥é“libc**ï¼šæ‚¨éœ€è¦ï¼š
* ç»•è¿‡[**PIE**](../common-binary-protections-and-bypasses/pie/)
* æ‰¾åˆ°ä½¿ç”¨çš„**`libc`ç‰ˆæœ¬**ï¼ˆæ³„æ¼å‡ ä¸ªå‡½æ•°åœ°å€ï¼‰
* æ£€æŸ¥**å…·æœ‰ASLRçš„å…ˆå‰æƒ…å†µ**ä»¥ç»§ç»­ã€‚

#### é€šè¿‡EBP/RBP

* [**Stack Pivoting / EBP2Ret / EBP Chaining**](../stack-overflow/stack-pivoting-ebp2ret-ebp-chaining.md): æ§åˆ¶ESPä»¥é€šè¿‡å †æ ˆä¸­å­˜å‚¨çš„EBPæ§åˆ¶RETã€‚
* ç”¨äº**off-by-one**å †æ ˆæº¢å‡º
* ä½œä¸ºæ§åˆ¶EIPçš„æ›¿ä»£æ–¹å¼ï¼Œæ»¥ç”¨EIPåœ¨å†…å­˜ä¸­æ„é€ æœ‰æ•ˆè´Ÿè½½ï¼Œç„¶åé€šè¿‡EBPè·³è½¬åˆ°å®ƒ

#### æ‚é¡¹

* [**Pointers Redirecting**](../stack-overflow/pointer-redirecting.md): å¦‚æœå †æ ˆåŒ…å«å°†è¦è°ƒç”¨çš„å‡½æ•°çš„æŒ‡é’ˆæˆ–å°†è¢«æœ‰è¶£å‡½æ•°ï¼ˆå¦‚systemæˆ–printfï¼‰ä½¿ç”¨çš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œå¯ä»¥è¦†ç›–è¯¥åœ°å€ã€‚
* [**ASLR**](../common-binary-protections-and-bypasses/aslr/)æˆ–[**PIE**](../common-binary-protections-and-bypasses/pie/)å¯èƒ½ä¼šå½±å“åœ°å€ã€‚
* [**æœªåˆå§‹åŒ–çš„å˜é‡**](../stack-overflow/uninitialized-variables.md): æ°¸è¿œä¸çŸ¥é“

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWSé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCPé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
