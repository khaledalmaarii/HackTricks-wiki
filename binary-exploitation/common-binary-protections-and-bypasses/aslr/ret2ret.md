# Ret2ret & Ret2pop

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks merch**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Ret2ret

Glavni cilj ove tehnike je poku코aj **bajpasiranja ASLR-a zloupotrebom postoje캖eg pokaziva캜a na steku**.

U osnovi, prekora캜enja steka obi캜no su uzrokovana stringovima, a **stringovi se zavr코avaju nulom na kraju** u memoriji. To omogu캖ava poku코aj smanjenja mesta na koje pokazuje ve캖 postoje캖i pokaziva캜 na steku. Dakle, ako je stek sadr쬬o `0xbfffffdd`, ovo prekora캜enje mo쬰 ga transformisati u `0xbfffff00` (primetite poslednji nula bajt).

Ako ta adresa pokazuje na코 shell kod na steku, mogu캖e je usmeriti tok ka toj adresi dodavanjem adresa instrukciji `ret` dok se ne dostigne ta adresa.

Stoga bi napad bio slede캖i:

* NOP klizaljka
* Shell kod
* Prepisivanje steka od EIP sa **adresama ka `ret`** (RET klizaljka)
* 0x00 dodat stringom menjaju캖i adresu sa steka tako da pokazuje na NOP klizaljku

Klikom na [**ovaj link**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2ret.c) mo쬰te videti primer ranjivog binarnog fajla, a [**u ovom**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2retexploit.c) eksploataciju.

## Ret2pop

U slu캜aju da mo쬰te prona캖i **savr코en pokaziva캜 na steku koji ne 쬰lite da menjate** (u `ret2ret` smo promenili poslednji najni쬴 bajt u `0x00`), mo쬰te izvesti isti napad kao `ret2ret`, ali **du쬴na RET klizaljke mora biti skra캖ena za 1** (tako da kona캜ni `0x00` prepisuje podatke neposredno pre savr코enog pokaziva캜a), a **poslednja** adresa RET klizaljke mora pokazivati na **`pop <reg>; ret`**.\
Na ovaj na캜in, **podaci pre savr코enog pokaziva캜a 캖e biti uklonjeni** sa steka (to su podaci pogo캠eni sa `0x00`) i **kona캜ni `ret` 캖e pokazivati na savr코enu adresu** na steku bez ikakve promene.

Klikom na [**ovaj link**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2pop.c) mo쬰te videti primer ranjivog binarnog fajla, a [**u ovom**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2popexploit.c) eksploataciju.

## Reference

* [https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks merch**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
