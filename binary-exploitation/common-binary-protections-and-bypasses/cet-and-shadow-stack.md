# CET & Shadow Stack

{% hint style="success" %}
Ucz si i praktykuj Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i praktykuj Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>
{% endhint %}

## Technologia Wzmocnienia Kontroli Przepywu (CET)

**CET** to funkcja bezpieczestwa zaimplementowana na poziomie sprztowym, zaprojektowana w celu zwalczania powszechnych atak贸w na kontrol przepywu, takich jak **Return-Oriented Programming (ROP)** i **Jump-Oriented Programming (JOP)**. Te rodzaje atak贸w manipuluj przepywem wykonania programu, aby wykona zoliwy kod lub poczy ze sob fragmenty nieszkodliwego kodu w taki spos贸b, aby wykona zoliw akcj.

CET wprowadza dwie g贸wne funkcje: **Indirect Branch Tracking (IBT)** i **Shadow Stack**.

* **IBT** zapewnia, 偶e skoki i wywoania porednie s wykonywane do prawidowych cel贸w, kt贸re s jawnie oznaczone jako legalne miejsca docelowe dla skok贸w porednich. Osiga si to za pomoc nowego zestawu instrukcji, kt贸re oznaczaj prawidowe cele, uniemo偶liwiajc atakujcym zmian przepywu kontroli do dowolnych lokalizacji.
* **Shadow Stack** to mechanizm zapewniajcy integralno adres贸w powrotu. Przechowuje zabezpieczon, ukryt kopi adres贸w powrotu oddzielnie od zwykego stosu wywoa. Gdy funkcja zwraca warto, adres powrotu jest weryfikowany wzgldem shadow stack, uniemo偶liwiajc atakujcym nadpisanie adres贸w powrotu na stosie w celu przejcia kontroli nad przepywem.

## Shadow Stack

**Shadow stack** to **dedykowany stos u偶ywany wycznie do przechowywania adres贸w powrotu**. Dziaa obok zwykego stosu, ale jest chroniony i ukryty przed normalnym wykonaniem programu, co sprawia, 偶e trudno jest atakujcym manipulowa nim. G贸wnym celem shadow stack jest zapewnienie, 偶e wszelkie modyfikacje adres贸w powrotu na zwykym stosie zostan wykryte, zanim zostan u偶yte, skutecznie agodzc ataki ROP.

## Jak CET i Shadow Stack Zapobiegaj Atakom

Ataki **ROP i JOP** polegaj na zdolnoci przejcia kontroli nad przepywem aplikacji poprzez wykorzystanie podatnoci, kt贸re pozwalaj na nadpisanie wska藕nik贸w lub adres贸w powrotu na stosie. Kierujc przepyw do sekwencji istniejcych gad偶et贸w kodowych lub gad偶et贸w programowania zorientowanego na powroty, atakujcy mog wykona dowolny kod.

* Funkcja **IBT CET** znacznie utrudnia te ataki, zapewniajc, 偶e skoki porednie mog skaka tylko do adres贸w, kt贸re zostay jawnie oznaczone jako prawidowe cele. Uniemo偶liwia to atakujcym wykonanie dowolnych gad偶et贸w rozproszonych w caym pliku binarnym.
* **Shadow stack** z kolei zapewnia, 偶e nawet jeli atakujcy mo偶e nadpisa adres powrotu na normalnym stosie, **r贸偶nica zostanie wykryta** podczas por贸wnywania skorumpowanego adresu z bezpieczn kopi przechowywan w shadow stack podczas powrotu z funkcji. Jeli adresy si nie zgadzaj, program mo偶e zakoczy dziaanie lub podj inne rodki bezpieczestwa, uniemo偶liwiajc atakowi powodzenie.

{% hint style="success" %}
Ucz si i praktykuj Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i praktykuj Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>
{% endhint %}
