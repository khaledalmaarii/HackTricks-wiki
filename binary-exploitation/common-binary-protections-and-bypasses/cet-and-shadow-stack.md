# CET & Shadow Stack

<details>

<summary><strong>Zacznij od zera i sta si ekspertem od hakowania AWS dziki</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>

## Technologia Wzmocnienia Przepywu Kontroli (CET)

**CET** to funkcja bezpieczestwa zaimplementowana na poziomie sprztowym, zaprojektowana w celu zwalczania powszechnych atak贸w na kontrol przepywu, takich jak **Return-Oriented Programming (ROP)** i **Jump-Oriented Programming (JOP)**. Te rodzaje atak贸w manipuluj przepywem wykonania programu, aby wykona zoliwy kod lub poczy ze sob fragmenty nieszkodliwego kodu w taki spos贸b, aby wykona zoliw akcj.

CET wprowadza dwie g贸wne funkcje: **Indirect Branch Tracking (IBT)** i **Shadow Stack**.

* **IBT** zapewnia, 偶e skoki i wywoania porednie s wykonywane do prawidowych cel贸w, kt贸re s jawnie oznaczone jako legalne miejsca docelowe dla skok贸w porednich. Osiga si to za pomoc nowego zestawu instrukcji, kt贸re oznaczaj prawidowe cele, uniemo偶liwiajc atakujcym zmian przepywu kontroli do dowolnych lokalizacji.
* **Shadow Stack** to mechanizm zapewniajcy integralno adres贸w powrotu. Przechowuje zabezpieczon, ukryt kopi adres贸w powrotu oddzielnie od zwykego stosu wywoa. Po zakoczeniu funkcji adres powrotu jest weryfikowany wzgldem shadow stack, uniemo偶liwiajc atakujcym nadpisanie adres贸w powrotu na stosie w celu przejcia kontroli.

## Shadow Stack

**Shadow stack** to **dedykowany stos u偶ywany wycznie do przechowywania adres贸w powrotu**. Dziaa obok zwykego stosu, ale jest chroniony i ukryty przed normalnym wykonaniem programu, co sprawia, 偶e trudno jest atakujcym manipulowa nim. G贸wnym celem shadow stack jest zapewnienie wykrywania wszelkich modyfikacji adres贸w powrotu na zwykym stosie przed ich u偶yciem, skutecznie agodzc ataki ROP.

## Jak CET i Shadow Stack Zapobiegaj Atakom

Ataki **ROP i JOP** polegaj na zdolnoci przejcia kontroli nad aplikacj poprzez wykorzystanie podatnoci, kt贸re pozwalaj na nadpisanie wska藕nik贸w lub adres贸w powrotu na stosie. Poprzez kierowanie przepywu do istniejcych gad偶et贸w kodu lub gad偶et贸w programowania zorientowanego na powroty, atakujcy mog wykona dowolny kod.

* Funkcja **IBT CET** znacznie utrudnia te ataki, zapewniajc, 偶e skoki porednie mog skaka tylko do adres贸w, kt贸re zostay jawnie oznaczone jako prawidowe cele. Uniemo偶liwia to atakujcym wykonanie dowolnych gad偶et贸w rozproszonych w caym pliku binarnym.
* **Shadow stack** z kolei zapewnia, 偶e nawet jeli atakujcy mo偶e nadpisa adres powrotu na normalnym stosie, r贸偶nica zostanie wykryta podczas por贸wnywania skorumpowanego adresu z bezpieczn kopi przechowywan w shadow stack podczas powrotu z funkcji. Jeli adresy si nie zgadzaj, program mo偶e zakoczy dziaanie lub podj inne rodki bezpieczestwa, uniemo偶liwiajc powodzenie ataku.
