# Ispisivanje Stack Canary-ja

{% hint style="success" %}
NauÄite i veÅ¾bajte hakovanje AWS-a:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Obuka AWS Crveni Tim StruÄnjak (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Obuka GCP Crveni Tim StruÄnjak (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Pomozite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## PoveÄ‡anje ispisivanja stack-a

Zamislite situaciju gde **program podloÅ¾an** preplavljivanju stack-a moÅ¾e izvrÅ¡iti funkciju **puts** koja **ukazuje** na **deo** preplavljenog **stack-a**. NapadaÄ zna da je **prvi bajt canary-ja nula bajt** (`\x00`) i da su ostali bajtovi canary-ja **nasumiÄni** bajtovi. Zatim, napadaÄ moÅ¾e stvoriti preplavljivanje koje **prepisuje stack sve do samo prvog bajta canary-ja**.

Zatim, napadaÄ **poziva funkcionalnost puts** na sredini payload-a koji Ä‡e **ispisati ceo canary** (osim prvog nula bajta).

Sa ovim informacijama, napadaÄ moÅ¾e **kreirati i poslati novi napad** znajuÄ‡i canary (u istoj sesiji programa).

OÄigledno, ova taktika je veoma **ograniÄena** jer napadaÄ mora biti u moguÄ‡nosti da **ispisuje** **sadrÅ¾aj** svog **payload-a** da bi **izneo** **canary** i zatim bio u moguÄ‡nosti da kreira novi payload (u **istoj sesiji programa**) i **poÅ¡alje** **pravi buffer overflow**.

**CTF primeri:**&#x20;

* [**https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html**](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64 bit, ASLR omoguÄ‡en ali bez PIE-a, prvi korak je popuniti preplavljivanje sve do bajta 0x00 canary-ja, zatim pozvati puts i procuriti ga. Sa canary-jem se kreira ROP gedÅ¾et koji poziva puts da procuri adresu puts-a iz GOT-a i ROP gedÅ¾et da pozove `system('/bin/sh')`
* [**https://guyinatuxedo.github.io/14-ret\_2\_system/hxp18\_poorCanary/index.html**](https://guyinatuxedo.github.io/14-ret\_2\_system/hxp18\_poorCanary/index.html)
* 32 bit, ARM, bez relro-a, canary, nx, bez pie-a. Preplavljivanje sa pozivom puts na njega da procuri canary + ret2lib pozivanje `system` sa ROP lancem da izbaci r0 (arg `/bin/sh`) i pc (adresa system-a)

## Proizvoljno ÄŒitanje

Sa **proizvoljnim Äitanjem** kao Å¡to je ono koje pruÅ¾aju format **stringovi**, moguÄ‡e je procuriti canary. Proverite ovaj primer: [**https://ir0nstone.gitbook.io/notes/types/stack/canaries**](https://ir0nstone.gitbook.io/notes/types/stack/canaries) i moÅ¾ete proÄitati o zloupotrebi format stringova za Äitanje proizvoljnih memorijskih adresa u:

{% content-ref url="../../format-strings/" %}
[format-strings](../../format-strings/)
{% endcontent-ref %}

* [https://guyinatuxedo.github.io/14-ret\_2\_system/asis17\_marymorton/index.html](https://guyinatuxedo.github.io/14-ret\_2\_system/asis17\_marymorton/index.html)
* Ovaj izazov zloupotrebljava na veoma jednostavan naÄin format string da proÄita canary sa stack-a

{% hint style="success" %}
NauÄite i veÅ¾bajte hakovanje AWS-a:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Obuka AWS Crveni Tim StruÄnjak (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Obuka GCP Crveni Tim StruÄnjak (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Pomozite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
