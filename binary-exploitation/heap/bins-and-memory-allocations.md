# Bins & ë©”ëª¨ë¦¬ í• ë‹¹

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

ë©ì–´ë¦¬ê°€ ì €ì¥ë˜ëŠ” íš¨ìœ¨ì„±ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ê° ë©ì–´ë¦¬ê°€ í•˜ë‚˜ì˜ ì—°ê²°ëœ ëª©ë¡ì—ë§Œ ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì—¬ëŸ¬ ìœ í˜•ì´ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒë“¤ì´ ë°”êµ¬ë‹ˆì´ë©° 5 ì¢…ë¥˜ì˜ ë°”êµ¬ë‹ˆê°€ ìˆìŠµë‹ˆë‹¤: [62](https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/malloc.c;h=6e766d11bc85b6480fa5c9f2a76559f8acf9deb5;hb=HEAD#l1407) small bins, 63 large bins, 1 unsorted bin, 10 fast bins ê·¸ë¦¬ê³  ìŠ¤ë ˆë“œë‹¹ 64ê°œì˜ tcache binsê°€ ìˆìŠµë‹ˆë‹¤.

ê° unsorted, small, large ë°”êµ¬ë‹ˆì˜ ì´ˆê¸° ì£¼ì†ŒëŠ” ë™ì¼í•œ ë°°ì—´ ë‚´ì— ìˆìŠµë‹ˆë‹¤. ì¸ë±ìŠ¤ 0ì€ ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë©°, 1ì€ unsorted bin, 2-64ëŠ” small bins, 65-127ëŠ” large binsì…ë‹ˆë‹¤.

### Tcache (ìŠ¤ë ˆë“œë³„ ìºì‹œ) Bins

ìŠ¤ë ˆë“œê°€ ìì²´ í™ì„ ê°–ë„ë¡ ë…¸ë ¥í•˜ì§€ë§Œ (Arenas ë° Subheaps ì°¸ì¡°), **ì›¹ ì„œë²„ì™€ ê°™ì´ ë§ì€ ìŠ¤ë ˆë“œë¥¼ ê°€ì§„ í”„ë¡œì„¸ìŠ¤ê°€ í™ì„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì™€ ê³µìœ í•  ê°€ëŠ¥ì„±**ì´ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°, ì£¼ìš” í•´ê²°ì±…ì€ **ë½(lockers)**ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë©°, ì´ëŠ” **ìŠ¤ë ˆë“œë¥¼ ìƒë‹¹íˆ ëŠë¦¬ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ë”°ë¼ì„œ tcacheëŠ” ê° ìŠ¤ë ˆë“œë‹¹ í•˜ë‚˜ì˜ fast binê³¼ ìœ ì‚¬í•˜ë©°, ë©ì–´ë¦¬ë¥¼ ë³‘í•©í•˜ì§€ ì•ŠëŠ” **ë‹¨ì¼ ì—°ê²° ëª©ë¡**ì…ë‹ˆë‹¤. ê° ìŠ¤ë ˆë“œì—ëŠ” **64ê°œì˜ ë‹¨ì¼ ì—°ê²° tcache bins**ê°€ ìˆìŠµë‹ˆë‹¤. ê° ë°”êµ¬ë‹ˆì—ëŠ” [64ë¹„íŠ¸ ì‹œìŠ¤í…œì—ì„œ 24ì—ì„œ 1032B, 32ë¹„íŠ¸ ì‹œìŠ¤í…œì—ì„œ 12ì—ì„œ 516Bê¹Œì§€ì˜ 7ê°œì˜ ë™ì¼ í¬ê¸° ë©ì–´ë¦¬](https://sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=2527e2504761744df2bdb1abdc02d936ff907ad2;hb=d5c3fafc4307c9b7a4c7d5cb381fcdbfad340bcc#l315)ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ìŠ¤ë ˆë“œê°€** ë©ì–´ë¦¬ë¥¼ í•´ì œí•  ë•Œ, tcacheì— í• ë‹¹í•˜ê¸°ì— ë„ˆë¬´ í¬ì§€ ì•Šê³  í•´ë‹¹ tcache ë°”êµ¬ë‹ˆê°€ **ê°€ë“ ì°¨ì§€ ì•Šì•˜ë‹¤ë©´** (ì´ë¯¸ 7ê°œì˜ ë©ì–´ë¦¬ê°€ ìˆëŠ” ê²½ìš°), **ãã“ì— í• ë‹¹ë©ë‹ˆë‹¤**. tcacheë¡œ ì´ë™í•  ìˆ˜ ì—†ëŠ” ê²½ìš°, ì „ì—­ ë°”êµ¬ë‹ˆì—ì„œ í•˜ë‚˜ë¥¼ ì°¾ê±°ë‚˜ ìƒˆë¡œ ë§Œë“¤ê¸° ìœ„í•´ í™ ë½ì„ ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤.

ë©ì–´ë¦¬ê°€ í• ë‹¹ë  ë•Œ, **Tcacheì— í•„ìš”í•œ í¬ê¸°ì˜ ë©ì–´ë¦¬ê°€ ìˆìœ¼ë©´ ì‚¬ìš©**í•˜ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì „ì—­ ë°”êµ¬ë‹ˆì—ì„œ ì°¾ê±°ë‚˜ ìƒˆë¡œ ë§Œë“¤ê¸° ìœ„í•´ í™ ë½ì„ ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤.\
ë˜í•œ ìµœì í™”ê°€ ìˆìœ¼ë©°, ì´ ê²½ìš° í™ ë½ì„ ë³´ìœ í•œ ìƒíƒœì—ì„œ ìŠ¤ë ˆë“œëŠ” ìš”ì²­ëœ í¬ê¸°ì˜ í™ ë©ì–´ë¦¬(7ê°œ)ë¡œ Tcacheë¥¼ ì±„ìš°ë¯€ë¡œ í•„ìš”í•œ ê²½ìš° Tcacheì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>

<summary>tcache ë©ì–´ë¦¬ ì˜ˆì œ ì¶”ê°€</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunk;
chunk = malloc(24);
printf("Address of the chunk: %p\n", (void *)chunk);
gets(chunk);
free(chunk);
return 0;
}
```
main í•¨ìˆ˜ì˜ ret ì˜µì½”ë“œì— ì¤‘ë‹¨ì ì„ ì„¤ì •í•˜ì—¬ ì»´íŒŒì¼í•˜ê³  ë””ë²„ê¹…í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ gefë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš© ì¤‘ì¸ tcache binì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gefâ¤  heap bins
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Tcachebins for thread 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Tcachebins[idx=0, size=0x20, count=1] â†  Chunk(addr=0xaaaaaaac12a0, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
```
</details>

#### Tcache êµ¬ì¡°ì²´ ë° í•¨ìˆ˜

ë‹¤ìŒ ì½”ë“œì—ì„œëŠ” **max bins** ë° **chunks per index**, ë‘ ë²ˆì˜ í•´ì œë¥¼ í”¼í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ **`tcache_entry`** êµ¬ì¡°ì²´, ê·¸ë¦¬ê³  ê° ìŠ¤ë ˆë“œê°€ ê° binì˜ ì£¼ì†Œë¥¼ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” **`tcache_perthread_struct`** êµ¬ì¡°ì²´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>

<summary><code>tcache_entry</code> ë° <code>tcache_perthread_struct</code></summary>
```c
// From https://github.com/bminor/glibc/blob/f942a732d37a96217ef828116ebe64a644db18d7/malloc/malloc.c

/* We want 64 entries.  This is an arbitrary limit, which tunables can reduce.  */
# define TCACHE_MAX_BINS		64
# define MAX_TCACHE_SIZE	tidx2usize (TCACHE_MAX_BINS-1)

/* Only used to pre-fill the tunables.  */
# define tidx2usize(idx)	(((size_t) idx) * MALLOC_ALIGNMENT + MINSIZE - SIZE_SZ)

/* When "x" is from chunksize().  */
# define csize2tidx(x) (((x) - MINSIZE + MALLOC_ALIGNMENT - 1) / MALLOC_ALIGNMENT)
/* When "x" is a user-provided size.  */
# define usize2tidx(x) csize2tidx (request2size (x))

/* With rounding and alignment, the bins are...
idx 0   bytes 0..24 (64-bit) or 0..12 (32-bit)
idx 1   bytes 25..40 or 13..20
idx 2   bytes 41..56 or 21..28
etc.  */

/* This is another arbitrary limit, which tunables can change.  Each
tcache bin will hold at most this number of chunks.  */
# define TCACHE_FILL_COUNT 7

/* Maximum chunks in tcache bins for tunables.  This value must fit the range
of tcache->counts[] entries, else they may overflow.  */
# define MAX_TCACHE_COUNT UINT16_MAX

[...]

typedef struct tcache_entry
{
struct tcache_entry *next;
/* This field exists to detect double frees.  */
uintptr_t key;
} tcache_entry;

/* There is one of these for each thread, which contains the
per-thread cache (hence "tcache_perthread_struct").  Keeping
overall size low is mildly important.  Note that COUNTS and ENTRIES
are redundant (we could have just counted the linked list each
time), this is for performance reasons.  */
typedef struct tcache_perthread_struct
{
uint16_t counts[TCACHE_MAX_BINS];
tcache_entry *entries[TCACHE_MAX_BINS];
} tcache_perthread_struct;
```
</details>

`__tcache_init` í•¨ìˆ˜ëŠ” `tcache_perthread_struct` objì˜ ê³µê°„ì„ ìƒì„±í•˜ê³  í• ë‹¹í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

<details>

<summary>tcache_init ì½”ë“œ</summary>
```c
// From https://github.com/bminor/glibc/blob/f942a732d37a96217ef828116ebe64a644db18d7/malloc/malloc.c#L3241C1-L3274C2

static void
tcache_init(void)
{
mstate ar_ptr;
void *victim = 0;
const size_t bytes = sizeof (tcache_perthread_struct);

if (tcache_shutting_down)
return;

arena_get (ar_ptr, bytes);
victim = _int_malloc (ar_ptr, bytes);
if (!victim && ar_ptr != NULL)
{
ar_ptr = arena_get_retry (ar_ptr, bytes);
victim = _int_malloc (ar_ptr, bytes);
}


if (ar_ptr != NULL)
__libc_lock_unlock (ar_ptr->mutex);

/* In a low memory situation, we may not be able to allocate memory
- in which case, we just keep trying later.  However, we
typically do this very early, so either there is sufficient
memory, or there isn't enough memory to do non-trivial
allocations anyway.  */
if (victim)
{
tcache = (tcache_perthread_struct *) victim;
memset (tcache, 0, sizeof (tcache_perthread_struct));
}

}
```
</details>

### ë¹ ë¥¸ bins

ë¹ ë¥¸ binsëŠ” **ì‘ì€ ì¡°ê°ì— ëŒ€í•œ ë©”ëª¨ë¦¬ í• ë‹¹ ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ì„¤ê³„**ë˜ì—ˆìŠµë‹ˆë‹¤. ìµœê·¼ì— í•´ì œëœ chunksë¥¼ ë¹ ë¥¸ ì•¡ì„¸ìŠ¤ êµ¬ì¡°ì— ìœ ì§€í•¨ìœ¼ë¡œì¨ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ì´ëŸ¬í•œ binsëŠ” í›„ì…ì„ ì¶œ(LIFO) ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬, **ê°€ì¥ ìµœê·¼ì— í•´ì œëœ chunkê°€ ìƒˆë¡œìš´ í• ë‹¹ ìš”ì²­ì´ ìˆì„ ë•Œ ì¬ì‚¬ìš©ë˜ëŠ” ì²« ë²ˆì§¸** chunkê°€ ë©ë‹ˆë‹¤. ì´ ë™ì‘ì€ ì†ë„ ì¸¡ë©´ì—ì„œ ìœ ë¦¬í•˜ë©°, í›„ì…ì„ ì¶œ(LIFO) ë°©ì‹ìœ¼ë¡œ ìŠ¤íƒì˜ ë§¨ ìœ„ì— ì‚½ì…í•˜ê³  ì œê±°í•˜ëŠ” ê²ƒì´ í(FIFO)ë³´ë‹¤ ë¹ ë¦…ë‹ˆë‹¤.

ë˜í•œ, **ë¹ ë¥¸ binsëŠ” ë‹¨ì¼ ì—°ê²° ëª©ë¡ì„ ì‚¬ìš©**í•˜ë©° ì´ëŠ” ì´ë™ ì†ë„ë¥¼ ë”ìš± í–¥ìƒì‹œí‚µë‹ˆë‹¤. ë¹ ë¥¸ binsì˜ chunksëŠ” ì´ì›ƒê³¼ ë³‘í•©ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¤‘ê°„ì—ì„œ ì œê±°í•  ìˆ˜ ìˆëŠ” ë³µì¡í•œ êµ¬ì¡°ê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¨ì¼ ì—°ê²° ëª©ë¡ì€ ì´ëŸ¬í•œ ì‘ì—…ì— ëŒ€í•´ ë” ê°„ë‹¨í•˜ê³  ë¹ ë¦…ë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ ì—¬ê¸°ì„œ ë°œìƒí•˜ëŠ” ì¼ì€ í—¤ë”(ê²€ì‚¬í•  ì²« ë²ˆì§¸ chunkë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°)ê°€ í•­ìƒ í•´ë‹¹ í¬ê¸°ì˜ ìµœì‹  í•´ì œëœ chunkë¥¼ ê°€ë¦¬í‚¤ë„ë¡ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ë˜ì„œ:

* í•´ë‹¹ í¬ê¸°ì˜ ìƒˆë¡œìš´ chunkê°€ í• ë‹¹ë˜ë©´, í—¤ë”ëŠ” ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¬´ë£Œ chunkë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤. ì´ ë¬´ë£Œ chunkê°€ ì‚¬ìš©í•  ë‹¤ìŒ chunkë¥¼ ê°€ë¦¬í‚¤ê³  ìˆê¸° ë•Œë¬¸ì—, ì´ ì£¼ì†ŒëŠ” í—¤ë”ì— ì €ì¥ë˜ì–´ ë‹¤ìŒ í• ë‹¹ì´ ì–´ë””ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ chunkë¥¼ ê°€ì ¸ì™€ì•¼ í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* chunkê°€ í•´ì œë˜ë©´, ë¬´ë£Œ chunkëŠ” í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ chunkì˜ ì£¼ì†Œë¥¼ ì €ì¥í•˜ê³ , ì´ ìƒˆë¡œ í•´ì œëœ chunkì˜ ì£¼ì†Œê°€ í—¤ë”ì— ë„£ì–´ì§‘ë‹ˆë‹¤.

ì—°ê²° ëª©ë¡ì˜ ìµœëŒ€ í¬ê¸°ëŠ” `0x80`ì´ë©°, `0x20-0x2f` í¬ê¸°ì˜ chunkëŠ” `0` ì¸ë±ìŠ¤ì—, `0x30-0x3f` í¬ê¸°ì˜ chunkëŠ” `1` ì¸ë±ìŠ¤ì— ìˆìŠµë‹ˆë‹¤.

{% hint style="danger" %}
ë¹ ë¥¸ binsì˜ chunksëŠ” ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ ì„¤ì •ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì£¼ë³€ì˜ ë‹¤ë¥¸ ë¬´ë£Œ chunksì™€ ë³‘í•©í•  ìˆ˜ ìˆëŠ” ëŒ€ì‹  ì–´ëŠ ì •ë„ì˜ ì‹œê°„ ë™ì•ˆ ë¹ ë¥¸ bin chunksë¡œ ìœ ì§€ë©ë‹ˆë‹¤.
{% endhint %}
```c
// From https://github.com/bminor/glibc/blob/a07e000e82cb71238259e674529c37c12dc7d423/malloc/malloc.c#L1711

/*
Fastbins

An array of lists holding recently freed small chunks.  Fastbins
are not doubly linked.  It is faster to single-link them, and
since chunks are never removed from the middles of these lists,
double linking is not necessary. Also, unlike regular bins, they
are not even processed in FIFO order (they use faster LIFO) since
ordering doesn't much matter in the transient contexts in which
fastbins are normally used.

Chunks in fastbins keep their inuse bit set, so they cannot
be consolidated with other free chunks. malloc_consolidate
releases all chunks in fastbins and consolidates them with
other free chunks.
*/

typedef struct malloc_chunk *mfastbinptr;
#define fastbin(ar_ptr, idx) ((ar_ptr)->fastbinsY[idx])

/* offset 2 to use otherwise unindexable first 2 bins */
#define fastbin_index(sz) \
((((unsigned int) (sz)) >> (SIZE_SZ == 8 ? 4 : 3)) - 2)


/* The maximum fastbin request size we support */
#define MAX_FAST_SIZE     (80 * SIZE_SZ / 4)

#define NFASTBINS  (fastbin_index (request2size (MAX_FAST_SIZE)) + 1)
```
<details>

<summary>ë¹ ë¥¸ ë°”ì¸ ì²­í¬ ì˜ˆì œ ì¶”ê°€</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunks[8];
int i;

// Loop to allocate memory 8 times
for (i = 0; i < 8; i++) {
chunks[i] = malloc(24);
if (chunks[i] == NULL) { // Check if malloc failed
fprintf(stderr, "Memory allocation failed at iteration %d\n", i);
return 1;
}
printf("Address of chunk %d: %p\n", i, (void *)chunks[i]);
}

// Loop to free the allocated memory
for (i = 0; i < 8; i++) {
free(chunks[i]);
}

return 0;
}
```
ì°¸ê³ ë¡œ ë™ì¼í•œ í¬ê¸°ì˜ 8ê°œ ì²­í¬ë¥¼ í• ë‹¹í•˜ê³  í•´ì œí•˜ì—¬ tcacheë¥¼ ì±„ìš°ê³  ì—¬ëŸ ë²ˆì§¸ ì²­í¬ëŠ” fast ì²­í¬ì— ì €ì¥ë˜ë„ë¡í•©ë‹ˆë‹¤.

ì»´íŒŒì¼í•˜ê³  ë©”ì¸ í•¨ìˆ˜ì˜ ret ì˜µì½”ë“œì—ì„œ ì¤‘ë‹¨ì ì„ ì„¤ì •í•˜ì—¬ ë””ë²„ê¹…í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ gefë¥¼ ì‚¬ìš©í•˜ì—¬ tcache binì´ ì±„ì›Œì§€ê³  fast binì— í•˜ë‚˜ì˜ ì²­í¬ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gefâ¤  heap bins
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Tcachebins for thread 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Tcachebins[idx=0, size=0x20, count=7] â†  Chunk(addr=0xaaaaaaac1770, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac1750, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac1730, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac1710, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac16f0, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac16d0, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac12a0, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Fastbins for arena at 0xfffff7f90b00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fastbins[idx=0, size=0x20]  â†  Chunk(addr=0xaaaaaaac1790, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
Fastbins[idx=1, size=0x30] 0x00
```
</details>

### Unsorted bin

Unsorted binì€ í™ ë§¤ë‹ˆì €ê°€ ë©”ëª¨ë¦¬ í• ë‹¹ì„ ë¹ ë¥´ê²Œ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” **ìºì‹œ**ì…ë‹ˆë‹¤. ì‘ë™ ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: í”„ë¡œê·¸ë¨ì´ ì²­í¬ë¥¼ í•´ì œí•˜ë©´ì„œ, ì´ ì²­í¬ê°€ tcacheë‚˜ fast binì— í• ë‹¹ë  ìˆ˜ ì—†ê³  top ì²­í¬ì™€ ì¶©ëŒí•˜ì§€ ì•ŠëŠ” ê²½ìš°, í™ ë§¤ë‹ˆì €ëŠ” ì¦‰ì‹œ íŠ¹ì • small ë˜ëŠ” large binì— ë„£ì§€ ì•ŠìŠµë‹ˆë‹¤. ëŒ€ì‹ , ì£¼ë³€ì˜ ë‹¤ë¥¸ ë¹ˆ ì²­í¬ì™€ **ë³‘í•©í•˜ì—¬** ë” í° ë¹ˆ ë©”ëª¨ë¦¬ ë¸”ë¡ì„ ë§Œë“¤ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ, ì´ ìƒˆë¡œìš´ ì²­í¬ë¥¼ "unsorted bin"ì´ë¼ê³  ë¶ˆë¦¬ëŠ” ì¼ë°˜ì ì¸ binì— ë°°ì¹˜í•©ë‹ˆë‹¤.

í”„ë¡œê·¸ë¨ì´ **ë©”ëª¨ë¦¬ë¥¼ ìš”ì²­**í•  ë•Œ, í™ ë§¤ë‹ˆì €ëŠ” unsorted binì„ **í™•ì¸í•˜ì—¬** ì¶©ë¶„í•œ í¬ê¸°ì˜ ì²­í¬ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ë°œê²¬í•˜ë©´ ì¦‰ì‹œ ì‚¬ìš©í•©ë‹ˆë‹¤. unsorted binì—ì„œ ì í•©í•œ ì²­í¬ë¥¼ ì°¾ì§€ ëª»í•˜ë©´, ì´ ëª©ë¡ì˜ ëª¨ë“  ì²­í¬ë¥¼ í•´ë‹¹ í¬ê¸°ì— ë”°ë¼ ì†Œí˜• ë˜ëŠ” ëŒ€í˜• binìœ¼ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.

ë” í° ì²­í¬ê°€ 2ê°œì˜ ë°˜ìœ¼ë¡œ ë‚˜ë‰˜ê³  ë‚˜ë¨¸ì§€ê°€ MINSIZEë³´ë‹¤ í¬ë©´, unsorted binì— ë‹¤ì‹œ ë°°ì¹˜ë©ë‹ˆë‹¤.&#x20;

ë”°ë¼ì„œ unsorted binì€ ìµœê·¼ì— í•´ì œëœ ë©”ëª¨ë¦¬ë¥¼ ë¹ ë¥´ê²Œ ì¬ì‚¬ìš©í•˜ì—¬ ë©”ëª¨ë¦¬ í• ë‹¹ ì†ë„ë¥¼ ë†’ì´ê³ , ì‹œê°„ì´ ë§ì´ ì†Œìš”ë˜ëŠ” ê²€ìƒ‰ê³¼ ë³‘í•©ì´ í•„ìš”í•œ ì‘ì—…ì„ ì¤„ì…ë‹ˆë‹¤.

{% hint style="danger" %}
ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ì˜ ì²­í¬ì´ë”ë¼ë„ ì‚¬ìš© ê°€ëŠ¥í•œ ì²­í¬ê°€ ë‹¤ë¥¸ ì‚¬ìš© ê°€ëŠ¥í•œ ì²­í¬ì™€ ì¶©ëŒí•˜ëŠ” ê²½ìš° (ì›ë˜ ì„œë¡œ ë‹¤ë¥¸ binì— ì†í•´ ìˆë”ë¼ë„), ë³‘í•©ë©ë‹ˆë‹¤.
{% endhint %}

<details>

<summary>unsorted ì²­í¬ ì˜ˆì‹œ ì¶”ê°€</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunks[9];
int i;

// Loop to allocate memory 8 times
for (i = 0; i < 9; i++) {
chunks[i] = malloc(0x100);
if (chunks[i] == NULL) { // Check if malloc failed
fprintf(stderr, "Memory allocation failed at iteration %d\n", i);
return 1;
}
printf("Address of chunk %d: %p\n", i, (void *)chunks[i]);
}

// Loop to free the allocated memory
for (i = 0; i < 8; i++) {
free(chunks[i]);
}

return 0;
}
```
ì°¸ê³ ë¡œ ë™ì¼í•œ í¬ê¸°ì˜ 9ê°œ ì²­í¬ë¥¼ í• ë‹¹í•˜ê³  í•´ì œí•˜ì—¬ **tcacheë¥¼ ì±„ìš°ë„ë¡**í•˜ë©° ì—¬ëŸ ë²ˆì§¸ ì²­í¬ëŠ” **fastbinì— ë„ˆë¬´ í¬ê¸° ë•Œë¬¸ì—** unsorted binì— ì €ì¥ë˜ê³  ì•„í™‰ ë²ˆì§¸ëŠ” í•´ì œë˜ì§€ ì•Šì•„ì„œ ì•„í™‰ ë²ˆì§¸ì™€ ì—¬ëŸ ë²ˆì§¸ê°€ **top ì²­í¬ì™€ ë³‘í•©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.

ì´ë¥¼ ì»´íŒŒì¼í•˜ê³  main í•¨ìˆ˜ì˜ ret ì˜µì½”ë“œì—ì„œ ì¤‘ë‹¨ì ì„ ì„¤ì •í•˜ì—¬ ë””ë²„ê¹…í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ gefë¥¼ ì‚¬ìš©í•˜ì—¬ tcache binì´ ì±„ì›Œì§€ê³  unsorted binì— í•˜ë‚˜ì˜ ì²­í¬ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gefâ¤  heap bins
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Tcachebins for thread 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Tcachebins[idx=15, size=0x110, count=7] â†  Chunk(addr=0xaaaaaaac1d10, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac1c00, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac1af0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac19e0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac18d0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac17c0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac12a0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Fastbins for arena at 0xfffff7f90b00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fastbins[idx=0, size=0x20] 0x00
Fastbins[idx=1, size=0x30] 0x00
Fastbins[idx=2, size=0x40] 0x00
Fastbins[idx=3, size=0x50] 0x00
Fastbins[idx=4, size=0x60] 0x00
Fastbins[idx=5, size=0x70] 0x00
Fastbins[idx=6, size=0x80] 0x00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Unsorted Bin for arena at 0xfffff7f90b00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[+] unsorted_bins[0]: fw=0xaaaaaaac1e10, bk=0xaaaaaaac1e10
â†’   Chunk(addr=0xaaaaaaac1e20, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[+] Found 1 chunks in unsorted bin.
```
</details>

### ì‘ì€ Bins

ì‘ì€ binsëŠ” í° binsë³´ë‹¤ ë¹ ë¥´ì§€ë§Œ fast binsë³´ë‹¤ëŠ” ëŠë¦½ë‹ˆë‹¤.

62ê°œì˜ ê° binì€ **ë™ì¼í•œ í¬ê¸°ì˜ ì²­í¬**ë¥¼ ê°€ì§‘ë‹ˆë‹¤: 16, 24, ... (32ë¹„íŠ¸ ì‹œìŠ¤í…œì—ì„œëŠ” ìµœëŒ€ 504ë°”ì´íŠ¸, 64ë¹„íŠ¸ ì‹œìŠ¤í…œì—ì„œëŠ” ìµœëŒ€ 1024ë°”ì´íŠ¸). ì´ëŠ” ê³µê°„ì´ í• ë‹¹ë˜ì–´ì•¼ í•˜ëŠ” binì„ ì°¾ê³  ì´ëŸ¬í•œ ëª©ë¡ì— í•­ëª©ì„ ì‚½ì…í•˜ê³  ì œê±°í•˜ëŠ” ì†ë„ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.

ì‘ì€ binì˜ í¬ê¸°ëŠ” binì˜ ì¸ë±ìŠ¤ì— ë”°ë¼ ë‹¤ìŒê³¼ ê°™ì´ ê³„ì‚°ë©ë‹ˆë‹¤:

* ê°€ì¥ ì‘ì€ í¬ê¸°: 2\*4\*ì¸ë±ìŠ¤ (ì˜ˆ: ì¸ë±ìŠ¤ 5 -> 40)
* ê°€ì¥ í° í¬ê¸°: 2\*8\*ì¸ë±ìŠ¤ (ì˜ˆ: ì¸ë±ìŠ¤ 5 -> 80)
```c
// From https://github.com/bminor/glibc/blob/a07e000e82cb71238259e674529c37c12dc7d423/malloc/malloc.c#L1711
#define NSMALLBINS         64
#define SMALLBIN_WIDTH    MALLOC_ALIGNMENT
#define SMALLBIN_CORRECTION (MALLOC_ALIGNMENT > CHUNK_HDR_SZ)
#define MIN_LARGE_SIZE    ((NSMALLBINS - SMALLBIN_CORRECTION) * SMALLBIN_WIDTH)

#define in_smallbin_range(sz)  \
((unsigned long) (sz) < (unsigned long) MIN_LARGE_SIZE)

#define smallbin_index(sz) \
((SMALLBIN_WIDTH == 16 ? (((unsigned) (sz)) >> 4) : (((unsigned) (sz)) >> 3))\
+ SMALLBIN_CORRECTION)
```
ì‘ì€ ë°”ì´ë„ˆë¦¬ì™€ í° ë°”ì´ë„ˆë¦¬ ì¤‘ì—ì„œ ì„ íƒí•˜ëŠ” í•¨ìˆ˜:
```c
#define bin_index(sz) \
((in_smallbin_range (sz)) ? smallbin_index (sz) : largebin_index (sz))
```
<details>

<summary>ì‘ì€ ì²­í¬ ì˜ˆì‹œ ì¶”ê°€</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunks[10];
int i;

// Loop to allocate memory 8 times
for (i = 0; i < 9; i++) {
chunks[i] = malloc(0x100);
if (chunks[i] == NULL) { // Check if malloc failed
fprintf(stderr, "Memory allocation failed at iteration %d\n", i);
return 1;
}
printf("Address of chunk %d: %p\n", i, (void *)chunks[i]);
}

// Loop to free the allocated memory
for (i = 0; i < 8; i++) {
free(chunks[i]);
}

chunks[9] = malloc(0x110);

return 0;
}
```
9ê°œì˜ ë™ì¼í•œ í¬ê¸°ì˜ ì²­í¬ë¥¼ í• ë‹¹í•˜ê³  í•´ì œí•˜ëŠ” ë°©ë²•ì— ì£¼ëª©í•˜ì„¸ìš”. ì´ë ‡ê²Œ í•˜ë©´ **tcacheë¥¼ ì±„ìš°ê²Œ** ë˜ê³  ì—¬ëŸ ë²ˆì§¸ ì²­í¬ëŠ” **fastbinì— ë„ˆë¬´ í¬ê¸° ë•Œë¬¸ì— unsorted binì— ì €ì¥**ë˜ë©° ì•„í™‰ ë²ˆì§¸ ì²­í¬ëŠ” í•´ì œë˜ì§€ ì•Šì•„ì„œ ì•„í™‰ ë²ˆì§¸ì™€ ì—¬ëŸ ë²ˆì§¸ê°€ **top ì²­í¬ì™€ ë³‘í•©ë˜ì§€ ì•Šê²Œ** ë©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ 0x110 í¬ê¸°ì˜ ë” í° ì²­í¬ë¥¼ í• ë‹¹í•˜ì—¬ **unsorted binì— ìˆëŠ” ì²­í¬ê°€ small binìœ¼ë¡œ ì´ë™**í•˜ê²Œ ë©ë‹ˆë‹¤.

ì´ë¥¼ ì»´íŒŒì¼í•˜ê³  main í•¨ìˆ˜ì˜ ret ì˜µì½”ë“œì—ì„œ ì¤‘ë‹¨ì ì„ ì„¤ì •í•˜ì—¬ ë””ë²„ê¹…í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ gefë¥¼ ì‚¬ìš©í•˜ì—¬ tcache binì´ ì±„ì›Œì§€ê³  small binì— í•˜ë‚˜ì˜ ì²­í¬ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gefâ¤  heap bins
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Tcachebins for thread 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Tcachebins[idx=15, size=0x110, count=7] â†  Chunk(addr=0xaaaaaaac1d10, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac1c00, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac1af0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac19e0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac18d0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac17c0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  Chunk(addr=0xaaaaaaac12a0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Fastbins for arena at 0xfffff7f90b00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fastbins[idx=0, size=0x20] 0x00
Fastbins[idx=1, size=0x30] 0x00
Fastbins[idx=2, size=0x40] 0x00
Fastbins[idx=3, size=0x50] 0x00
Fastbins[idx=4, size=0x60] 0x00
Fastbins[idx=5, size=0x70] 0x00
Fastbins[idx=6, size=0x80] 0x00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Unsorted Bin for arena at 0xfffff7f90b00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[+] Found 0 chunks in unsorted bin.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Small Bins for arena at 0xfffff7f90b00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[+] small_bins[16]: fw=0xaaaaaaac1e10, bk=0xaaaaaaac1e10
â†’   Chunk(addr=0xaaaaaaac1e20, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[+] Found 1 chunks in 1 small non-empty bins.
```
</details>

### ëŒ€í˜• bins

ì‘ì€ binsê°€ ê³ ì •ëœ í¬ê¸°ì˜ ì²­í¬ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°˜ë©´, **ê° ëŒ€í˜• binì€ ì²­í¬ í¬ê¸° ë²”ìœ„ë¥¼ ì²˜ë¦¬**í•©ë‹ˆë‹¤. ì´ëŠ” ì‹œìŠ¤í…œì´ **ë‹¤ì–‘í•œ í¬ê¸°ë¥¼ ìˆ˜ìš©**í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ ê° í¬ê¸°ë§ˆë‹¤ ë³„ë„ì˜ binì´ í•„ìš”í•˜ì§€ ì•Šê²Œ í•©ë‹ˆë‹¤.

ë©”ëª¨ë¦¬ í• ë‹¹ê¸°ì—ì„œ ëŒ€í˜• binsëŠ” ì‘ì€ binsê°€ ëë‚˜ëŠ” ê³³ì—ì„œ ì‹œì‘í•©ë‹ˆë‹¤. ëŒ€í˜• binsì˜ ë²”ìœ„ëŠ” ì ì§„ì ìœ¼ë¡œ ì»¤ì§€ë©°, ì²« ë²ˆì§¸ binì€ 512ì—ì„œ 576ë°”ì´íŠ¸ì˜ ì²­í¬ë¥¼ ì»¤ë²„í•  ìˆ˜ ìˆê³ , ë‹¤ìŒ binì€ 576ì—ì„œ 640ë°”ì´íŠ¸ë¥¼ ì»¤ë²„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒ¨í„´ì€ ê³„ì†ë˜ë©°, ê°€ì¥ í° binì—ëŠ” 1MB ì´ìƒì˜ ëª¨ë“  ì²­í¬ê°€ í¬í•¨ë©ë‹ˆë‹¤.

ëŒ€í˜• binsëŠ” ì‘ì€ binsë³´ë‹¤ **ì‘ì—… ì†ë„ê°€ ëŠë¦½ë‹ˆë‹¤**. ì™œëƒí•˜ë©´ í• ë‹¹ì— ê°€ì¥ ì í•©í•œ ì²­í¬ë¥¼ ì°¾ê¸° ìœ„í•´ **ë‹¤ì–‘í•œ ì²­í¬ í¬ê¸° ëª©ë¡ì„ ì •ë ¬í•˜ê³  ê²€ìƒ‰**í•´ì•¼í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ëŒ€í˜• binì— ì²­í¬ê°€ ì‚½ì…ë˜ë©´ ì •ë ¬í•´ì•¼ í•˜ë©°, ë©”ëª¨ë¦¬ê°€ í• ë‹¹ë  ë•Œ ì‹œìŠ¤í…œì€ ì ì ˆí•œ ì²­í¬ë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤. ì´ ì¶”ê°€ ì‘ì—…ìœ¼ë¡œ ì¸í•´ ëŒ€í˜• binsëŠ” **ëŠë¦½ë‹ˆë‹¤**. ê·¸ëŸ¬ë‚˜ ëŒ€í˜• í• ë‹¹ì´ ì‘ì€ í• ë‹¹ë³´ë‹¤ ì ê¸° ë•Œë¬¸ì— ì´ëŠ” í—ˆìš©í•  ìˆ˜ ìˆëŠ” êµí™˜ì…ë‹ˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì€ binsì´ ìˆìŠµë‹ˆë‹¤:

* 64B ë²”ìœ„ì˜ 32ê°œ bins (ì‘ì€ binsì™€ ì¶©ëŒ)
* 512B ë²”ìœ„ì˜ 16ê°œ bins (ì‘ì€ binsì™€ ì¶©ëŒ)
* 4096B ë²”ìœ„ì˜ 8ê°œ bins (ì¼ë¶€ëŠ” ì‘ì€ binsì™€ ì¶©ëŒ)
* 32768B ë²”ìœ„ì˜ 4ê°œ bins
* 262144B ë²”ìœ„ì˜ 2ê°œ bins
* ë‚˜ë¨¸ì§€ í¬ê¸°ë¥¼ ìœ„í•œ 1ê°œ bin

<details>

<summary>ëŒ€í˜• bin í¬ê¸° ì½”ë“œ</summary>
```c
// From https://github.com/bminor/glibc/blob/a07e000e82cb71238259e674529c37c12dc7d423/malloc/malloc.c#L1711

#define largebin_index_32(sz)                                                \
(((((unsigned long) (sz)) >> 6) <= 38) ?  56 + (((unsigned long) (sz)) >> 6) :\
((((unsigned long) (sz)) >> 9) <= 20) ?  91 + (((unsigned long) (sz)) >> 9) :\
((((unsigned long) (sz)) >> 12) <= 10) ? 110 + (((unsigned long) (sz)) >> 12) :\
((((unsigned long) (sz)) >> 15) <= 4) ? 119 + (((unsigned long) (sz)) >> 15) :\
((((unsigned long) (sz)) >> 18) <= 2) ? 124 + (((unsigned long) (sz)) >> 18) :\
126)

#define largebin_index_32_big(sz)                                            \
(((((unsigned long) (sz)) >> 6) <= 45) ?  49 + (((unsigned long) (sz)) >> 6) :\
((((unsigned long) (sz)) >> 9) <= 20) ?  91 + (((unsigned long) (sz)) >> 9) :\
((((unsigned long) (sz)) >> 12) <= 10) ? 110 + (((unsigned long) (sz)) >> 12) :\
((((unsigned long) (sz)) >> 15) <= 4) ? 119 + (((unsigned long) (sz)) >> 15) :\
((((unsigned long) (sz)) >> 18) <= 2) ? 124 + (((unsigned long) (sz)) >> 18) :\
126)

// XXX It remains to be seen whether it is good to keep the widths of
// XXX the buckets the same or whether it should be scaled by a factor
// XXX of two as well.
#define largebin_index_64(sz)                                                \
(((((unsigned long) (sz)) >> 6) <= 48) ?  48 + (((unsigned long) (sz)) >> 6) :\
((((unsigned long) (sz)) >> 9) <= 20) ?  91 + (((unsigned long) (sz)) >> 9) :\
((((unsigned long) (sz)) >> 12) <= 10) ? 110 + (((unsigned long) (sz)) >> 12) :\
((((unsigned long) (sz)) >> 15) <= 4) ? 119 + (((unsigned long) (sz)) >> 15) :\
((((unsigned long) (sz)) >> 18) <= 2) ? 124 + (((unsigned long) (sz)) >> 18) :\
126)

#define largebin_index(sz) \
(SIZE_SZ == 8 ? largebin_index_64 (sz)                                     \
: MALLOC_ALIGNMENT == 16 ? largebin_index_32_big (sz)                     \
: largebin_index_32 (sz))
```
</details>

<details>

<summary>ëŒ€ê·œëª¨ ì²­í¬ ì˜ˆì œ ì¶”ê°€</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunks[2];

chunks[0] = malloc(0x1500);
chunks[1] = malloc(0x1500);
free(chunks[0]);
chunks[0] = malloc(0x2000);

return 0;
}
```
2ê°œì˜ í° í• ë‹¹ì´ ìˆ˜í–‰ë˜ê³ , ê·¸ ì¤‘ í•˜ë‚˜ê°€ í•´ì œë©ë‹ˆë‹¤ (unsorted binì— ë„£ìŒ) ê·¸ë¦¬ê³  ë” í° í• ë‹¹ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤ (unsorted binì—ì„œ large binìœ¼ë¡œ ì´ë™ë¨).

ì´ë¥¼ ì»´íŒŒì¼í•˜ê³  ë©”ì¸ í•¨ìˆ˜ì˜ ret ì˜µì½”ë“œì— ì¤‘ë‹¨ì ì„ ê±¸ì–´ ë””ë²„ê¹…í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ gefë¥¼ ì‚¬ìš©í•˜ì—¬ tcache binì´ ì±„ì›Œì§€ê³  large binì— í•˜ë‚˜ì˜ ì²­í¬ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gefâ¤  heap bin
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Tcachebins for thread 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
All tcachebins are empty
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Fastbins for arena at 0xfffff7f90b00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fastbins[idx=0, size=0x20] 0x00
Fastbins[idx=1, size=0x30] 0x00
Fastbins[idx=2, size=0x40] 0x00
Fastbins[idx=3, size=0x50] 0x00
Fastbins[idx=4, size=0x60] 0x00
Fastbins[idx=5, size=0x70] 0x00
Fastbins[idx=6, size=0x80] 0x00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Unsorted Bin for arena at 0xfffff7f90b00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[+] Found 0 chunks in unsorted bin.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Small Bins for arena at 0xfffff7f90b00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[+] Found 0 chunks in 0 small non-empty bins.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Large Bins for arena at 0xfffff7f90b00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[+] large_bins[100]: fw=0xaaaaaaac1290, bk=0xaaaaaaac1290
â†’   Chunk(addr=0xaaaaaaac12a0, size=0x1510, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[+] Found 1 chunks in 1 large non-empty bins.
```
</details>

### ìµœìƒìœ„ ì²­í¬
```c
// From https://github.com/bminor/glibc/blob/a07e000e82cb71238259e674529c37c12dc7d423/malloc/malloc.c#L1711

/*
Top

The top-most available chunk (i.e., the one bordering the end of
available memory) is treated specially. It is never included in
any bin, is used only if no other chunk is available, and is
released back to the system if it is very large (see
M_TRIM_THRESHOLD).  Because top initially
points to its own bin with initial zero size, thus forcing
extension on the first malloc request, we avoid having any special
code in malloc to check whether it even exists yet. But we still
need to do so when getting memory from system, so we make
initial_top treat the bin as a legal but unusable chunk during the
interval between initialization and the first call to
sysmalloc. (This is somewhat delicate, since it relies on
the 2 preceding words to be zero during this interval as well.)
*/

/* Conveniently, the unsorted bin can be used as dummy top on first call */
#define initial_top(M)              (unsorted_chunks (M))
```
ê¸°ë³¸ì ìœ¼ë¡œ, í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ í™ì„ ëª¨ë‘ í¬í•¨í•˜ëŠ” ì²­í¬ì…ë‹ˆë‹¤. mallocì´ ìˆ˜í–‰ë  ë•Œ ì‚¬ìš© ê°€ëŠ¥í•œ ë¹ˆ ì²­í¬ê°€ ì—†ìœ¼ë©´ ì´ ìµœìƒìœ„ ì²­í¬ëŠ” í•„ìš”í•œ ê³µê°„ì„ ì œê³µí•˜ê¸° ìœ„í•´ í¬ê¸°ë¥¼ ì¤„ì¼ ê²ƒì…ë‹ˆë‹¤. Top Chunkì— ëŒ€í•œ í¬ì¸í„°ëŠ” `malloc_state` êµ¬ì¡°ì²´ì— ì €ì¥ë©ë‹ˆë‹¤.

ë˜í•œ, ì²˜ìŒì—ëŠ” ì •ë ¬ë˜ì§€ ì•Šì€ ì²­í¬ë¥¼ ìµœìƒìœ„ ì²­í¬ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>

<summary>Top Chunk ì˜ˆì‹œ ê´€ì°°</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunk;
chunk = malloc(24);
printf("Address of the chunk: %p\n", (void *)chunk);
gets(chunk);
return 0;
}
```
ì»´íŒŒì¼í•˜ê³  ë©”ì¸ í•¨ìˆ˜ì˜ ret ì˜µì½”ë“œì— ì¤‘ë‹¨ì ì„ ê±¸ì–´ ë””ë²„ê¹…í•œ í›„ mallocì´ ë°˜í™˜í•œ ì£¼ì†ŒëŠ” `0xaaaaaaac12a0`ì´ê³  ì´ ì£¼ì†Œì— í• ë‹¹ëœ ì²­í¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```bash
gefâ¤  heap chunks
Chunk(addr=0xaaaaaaac1010, size=0x290, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[0x0000aaaaaaac1010     00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................]
Chunk(addr=0xaaaaaaac12a0, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[0x0000aaaaaaac12a0     41 41 41 41 41 41 41 00 00 00 00 00 00 00 00 00    AAAAAAA.........]
Chunk(addr=0xaaaaaaac12c0, size=0x410, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[0x0000aaaaaaac12c0     41 64 64 72 65 73 73 20 6f 66 20 74 68 65 20 63    Address of the c]
Chunk(addr=0xaaaaaaac16d0, size=0x410, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[0x0000aaaaaaac16d0     41 41 41 41 41 41 41 0a 00 00 00 00 00 00 00 00    AAAAAAA.........]
Chunk(addr=0xaaaaaaac1ae0, size=0x20530, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  â†  top chunk
```
ìµœìƒìœ„ ì²­í¬ê°€ ì£¼ì†Œ `0xaaaaaaac1ae0`ì— ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœê·¼ í• ë‹¹ëœ ì²­í¬ëŠ” ì£¼ì†Œ `0xaaaaaaac12a0`ì— í¬ê¸°ê°€ `0x410`ì¸ ì²­í¬ì˜€ê¸° ë•Œë¬¸ì— ì´ëŠ” ë†€ë¼ìš´ ì¼ì´ ì•„ë‹™ë‹ˆë‹¤. `0xaaaaaaac12a0 + 0x410 = 0xaaaaaaac1ae0`ì…ë‹ˆë‹¤.\
ë˜í•œ ìµœìƒìœ„ ì²­í¬ì˜ ê¸¸ì´ë¥¼ ì²­í¬ í—¤ë”ì—ì„œ í™•ì¸í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```bash
gefâ¤  x/8wx 0xaaaaaaac1ae0 - 16
0xaaaaaaac1ad0:	0x00000000	0x00000000	0x00020531	0x00000000
0xaaaaaaac1ae0:	0x00000000	0x00000000	0x00000000	0x00000000
```
</details>

### ë§ˆì§€ë§‰ ì•Œë¦¼

`malloc`ì´ ì‚¬ìš©ë˜ê³  ì²­í¬ê°€ ë¶„í• ë  ë•Œ (ì˜ˆ: ì—°ê²°ë˜ì§€ ì•Šì€ ëª©ë¡ì´ë‚˜ ìµœìƒìœ„ ì²­í¬ì—ì„œ), ë‚˜ëˆ„ì–´ì§„ ì²­í¬ì˜ ë‚˜ë¨¸ì§€ì—ì„œ ìƒì„±ëœ ì²­í¬ë¥¼ ë§ˆì§€ë§‰ ì•Œë¦¼ì´ë¼ê³  í•˜ë©° ê·¸ í¬ì¸í„°ëŠ” `malloc_state` êµ¬ì¡°ì²´ì— ì €ì¥ë©ë‹ˆë‹¤.

## í• ë‹¹ íë¦„

ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="heap-memory-functions/malloc-and-sysmalloc.md" %}
[malloc-and-sysmalloc.md](heap-memory-functions/malloc-and-sysmalloc.md)
{% endcontent-ref %}

## í•´ì œ íë¦„

ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="heap-memory-functions/free.md" %}
[free.md](heap-memory-functions/free.md)
{% endcontent-ref %}

## í™ í•¨ìˆ˜ ë³´ì•ˆ ê²€ì‚¬

í™ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ë“¤ì— ì˜í•´ ìˆ˜í–‰ë˜ëŠ” ë³´ì•ˆ ê²€ì‚¬ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="heap-memory-functions/heap-functions-security-checks.md" %}
[heap-functions-security-checks.md](heap-memory-functions/heap-functions-security-checks.md)
{% endcontent-ref %}

## ì°¸ê³  ìë£Œ

* [https://azeria-labs.com/heap-exploitation-part-1-understanding-the-glibc-heap-implementation/](https://azeria-labs.com/heap-exploitation-part-1-understanding-the-glibc-heap-implementation/)
* [https://azeria-labs.com/heap-exploitation-part-2-glibc-heap-free-bins/](https://azeria-labs.com/heap-exploitation-part-2-glibc-heap-free-bins/)
* [https://heap-exploitation.dhavalkapil.com/diving\_into\_glibc\_heap/core\_functions](https://heap-exploitation.dhavalkapil.com/diving\_into\_glibc\_heap/core\_functions)
* [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/implementation/tcache/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/implementation/tcache/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ PDFë¡œ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
