# Ã‡ift Serbest BÄ±rakma

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na(https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## Temel Bilgiler

Bir bellek bloÄŸunu birden fazla kez serbest bÄ±rakÄ±rsanÄ±z, tahsisatÃ§Ä±nÄ±n verilerini bozabilir ve saldÄ±rÄ±lara kapÄ± aralayabilirsiniz. Ä°ÅŸte nasÄ±l gerÃ§ekleÅŸir: bir bellek bloÄŸunu serbest bÄ±raktÄ±ÄŸÄ±nÄ±zda, bu blok serbest bloklar listesine geri gider (Ã¶rneÄŸin "fastbin"). AynÄ± bloÄŸu iki kez Ã¼st Ã¼ste serbest bÄ±rakÄ±rsanÄ±z, tahsisatÃ§Ä± bunu algÄ±lar ve bir hata verir. Ancak **arada baÅŸka bir blok serbest bÄ±rakÄ±rsanÄ±z, Ã§ift serbest bÄ±rakma kontrolÃ¼ atlatÄ±lÄ±r**, bu da bozulmaya neden olur.

Åimdi, yeni bellek istediÄŸinizde (`malloc` kullanarak), tahsisatÃ§Ä± size **iki kez serbest bÄ±rakÄ±lmÄ±ÅŸ bir blok verebilir**. Bu, aynÄ± bellek konumuna iÅŸaret eden iki farklÄ± iÅŸaretÃ§iye yol aÃ§abilir. Bir saldÄ±rgan bu iÅŸaretÃ§ilerden birini kontrol ederse, o belleÄŸin iÃ§eriÄŸini deÄŸiÅŸtirebilir, bu da gÃ¼venlik sorunlarÄ±na yol aÃ§abilir veya hatta kod yÃ¼rÃ¼tmesine izin verebilir.

Ã–rnek:
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
// Allocate memory for three chunks
char *a = (char *)malloc(10);
char *b = (char *)malloc(10);
char *c = (char *)malloc(10);
char *d = (char *)malloc(10);
char *e = (char *)malloc(10);
char *f = (char *)malloc(10);
char *g = (char *)malloc(10);
char *h = (char *)malloc(10);
char *i = (char *)malloc(10);

// Print initial memory addresses
printf("Initial allocations:\n");
printf("a: %p\n", (void *)a);
printf("b: %p\n", (void *)b);
printf("c: %p\n", (void *)c);
printf("d: %p\n", (void *)d);
printf("e: %p\n", (void *)e);
printf("f: %p\n", (void *)f);
printf("g: %p\n", (void *)g);
printf("h: %p\n", (void *)h);
printf("i: %p\n", (void *)i);

// Fill tcache
free(a);
free(b);
free(c);
free(d);
free(e);
free(f);
free(g);

// Introduce double-free vulnerability in fast bin
free(h);
free(i);
free(h);


// Reallocate memory and print the addresses
char *a1 = (char *)malloc(10);
char *b1 = (char *)malloc(10);
char *c1 = (char *)malloc(10);
char *d1 = (char *)malloc(10);
char *e1 = (char *)malloc(10);
char *f1 = (char *)malloc(10);
char *g1 = (char *)malloc(10);
char *h1 = (char *)malloc(10);
char *i1 = (char *)malloc(10);
char *i2 = (char *)malloc(10);

// Print initial memory addresses
printf("After reallocations:\n");
printf("a1: %p\n", (void *)a1);
printf("b1: %p\n", (void *)b1);
printf("c1: %p\n", (void *)c1);
printf("d1: %p\n", (void *)d1);
printf("e1: %p\n", (void *)e1);
printf("f1: %p\n", (void *)f1);
printf("g1: %p\n", (void *)g1);
printf("h1: %p\n", (void *)h1);
printf("i1: %p\n", (void *)i1);
printf("i2: %p\n", (void *)i1);

return 0;
}
```
Bu Ã¶rnekte, tcache'i birkaÃ§ serbest bÄ±rakÄ±lmÄ±ÅŸ parÃ§a ile doldurduktan sonra **kod, Ã¶nce parÃ§a `h`, sonra parÃ§a `i` ve ardÄ±ndan tekrar `h`'yi serbest bÄ±rakarak Ã§ift-serbest bÄ±rakma hatasÄ± oluÅŸturur**. Bu, yeniden boyutlandÄ±rma yapÄ±lÄ±rken Ã¶rtÃ¼ÅŸen bellek adreslerini alabilme olasÄ±lÄ±ÄŸÄ±nÄ± aÃ§ar, yani iki veya daha fazla iÅŸaretÃ§i aynÄ± bellek konumuna iÅŸaret edebilir. Bir iÅŸaretÃ§i aracÄ±lÄ±ÄŸÄ±yla veri manipÃ¼le edilirse diÄŸeri etkilenebilir, bu da kritik bir gÃ¼venlik riski ve sÃ¶mÃ¼rÃ¼ potansiyeli yaratÄ±r.

Ã‡alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, **`i1` ve `i2`'nin aynÄ± adresi aldÄ±ÄŸÄ±na** dikkat edin:

<pre><code>Ä°lk tahsisler:
a: 0xaaab0f0c22a0
b: 0xaaab0f0c22c0
c: 0xaaab0f0c22e0
d: 0xaaab0f0c2300
e: 0xaaab0f0c2320
f: 0xaaab0f0c2340
g: 0xaaab0f0c2360
h: 0xaaab0f0c2380
i: 0xaaab0f0c23a0
Yeniden boyutlandÄ±rmalar sonrasÄ±:
a1: 0xaaab0f0c2360
b1: 0xaaab0f0c2340
c1: 0xaaab0f0c2320
d1: 0xaaab0f0c2300
e1: 0xaaab0f0c22e0
f1: 0xaaab0f0c22c0
g1: 0xaaab0f0c22a0
h1: 0xaaab0f0c2380
<strong>i1: 0xaaab0f0c23a0
</strong><strong>i2: 0xaaab0f0c23a0
</strong></code></pre>

## Referanslar

* [https://heap-exploitation.dhavalkapil.com/attacks/double\_free](https://heap-exploitation.dhavalkapil.com/attacks/double\_free)

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'Ä± takip edin.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
