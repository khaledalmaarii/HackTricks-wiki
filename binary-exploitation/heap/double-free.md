# ë”ë¸” í”„ë¦¬(Double Free)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¥¼ í†µí•´ ì œë¡œë¶€í„° AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ì €í¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ PRì„** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ë°** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— ì œì¶œ**í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

ë©”ëª¨ë¦¬ ë¸”ë¡ì„ ë‘ ë²ˆ ì´ìƒ í•´ì œí•˜ë©´ í• ë‹¹ê¸°ì˜ ë°ì´í„°ê°€ ë§ê°€ì§€ê³  ê³µê²©ì˜ ë¬¸ì„ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ê·¸ ë°©ë²•ì…ë‹ˆë‹¤: ë©”ëª¨ë¦¬ ë¸”ë¡ì„ í•´ì œí•˜ë©´ í•´ë‹¹ ë¸”ë¡ì€ ë¹ˆ ì²­í¬ ëª©ë¡(ì˜ˆ: "fastbin")ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤. ê°™ì€ ë¸”ë¡ì„ ë‘ ë²ˆ ì—°ì†ìœ¼ë¡œ í•´ì œí•˜ë©´ í• ë‹¹ê¸°ê°€ ì´ë¥¼ ê°ì§€í•˜ê³  ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **ë‹¤ë¥¸ ì²­í¬ë¥¼ í•´ì œí•œ í›„ì— ë‘ ë²ˆ í•´ì œí•˜ë©´ ë”ë¸” í”„ë¦¬ í™•ì¸ì´ ìš°íšŒ**ë˜ì–´ ì†ìƒì„ ì¼ìœ¼í‚µë‹ˆë‹¤.

ì´ì œ `malloc`ì„ ì‚¬ìš©í•˜ì—¬ ìƒˆ ë©”ëª¨ë¦¬ë¥¼ ìš”ì²­í•˜ë©´ í• ë‹¹ê¸°ê°€ **ë‘ ë²ˆ í•´ì œëœ ë¸”ë¡ì„ ì œê³µ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë‘ ê°œì˜ ë‹¤ë¥¸ í¬ì¸í„°ê°€ ë™ì¼í•œ ë©”ëª¨ë¦¬ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚¤ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µê²©ìê°€ ì´ëŸ¬í•œ í¬ì¸í„° ì¤‘ í•˜ë‚˜ë¥¼ ì œì–´í•˜ë©´ í•´ë‹¹ ë©”ëª¨ë¦¬ì˜ ë‚´ìš©ì„ ë³€ê²½í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ë³´ì•ˆ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ê±°ë‚˜ ì½”ë“œ ì‹¤í–‰ì„ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆì‹œ:
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
// Allocate memory for three chunks
char *a = (char *)malloc(10);
char *b = (char *)malloc(10);
char *c = (char *)malloc(10);
char *d = (char *)malloc(10);
char *e = (char *)malloc(10);
char *f = (char *)malloc(10);
char *g = (char *)malloc(10);
char *h = (char *)malloc(10);
char *i = (char *)malloc(10);

// Print initial memory addresses
printf("Initial allocations:\n");
printf("a: %p\n", (void *)a);
printf("b: %p\n", (void *)b);
printf("c: %p\n", (void *)c);
printf("d: %p\n", (void *)d);
printf("e: %p\n", (void *)e);
printf("f: %p\n", (void *)f);
printf("g: %p\n", (void *)g);
printf("h: %p\n", (void *)h);
printf("i: %p\n", (void *)i);

// Fill tcache
free(a);
free(b);
free(c);
free(d);
free(e);
free(f);
free(g);

// Introduce double-free vulnerability in fast bin
free(h);
free(i);
free(h);


// Reallocate memory and print the addresses
char *a1 = (char *)malloc(10);
char *b1 = (char *)malloc(10);
char *c1 = (char *)malloc(10);
char *d1 = (char *)malloc(10);
char *e1 = (char *)malloc(10);
char *f1 = (char *)malloc(10);
char *g1 = (char *)malloc(10);
char *h1 = (char *)malloc(10);
char *i1 = (char *)malloc(10);
char *i2 = (char *)malloc(10);

// Print initial memory addresses
printf("After reallocations:\n");
printf("a1: %p\n", (void *)a1);
printf("b1: %p\n", (void *)b1);
printf("c1: %p\n", (void *)c1);
printf("d1: %p\n", (void *)d1);
printf("e1: %p\n", (void *)e1);
printf("f1: %p\n", (void *)f1);
printf("g1: %p\n", (void *)g1);
printf("h1: %p\n", (void *)h1);
printf("i1: %p\n", (void *)i1);
printf("i2: %p\n", (void *)i1);

return 0;
}
```
ì´ ì˜ˆì—ì„œëŠ” tcacheë¥¼ ì—¬ëŸ¬ í•´ì œëœ ì²­í¬ë¡œ ì±„ìš´ í›„ **ì²­í¬ `h`ë¥¼ í•´ì œí•œ ë‹¤ìŒ ì²­í¬ `i`ë¥¼ í•´ì œí•˜ê³  ë‹¤ì‹œ `h`ë¥¼ í•´ì œí•˜ì—¬ ì´ì¤‘ í•´ì œ ì˜¤ë¥˜ë¥¼ ë°œìƒ**ì‹œí‚µë‹ˆë‹¤. ì´ëŠ” ì¬í• ë‹¹í•  ë•Œ ë©”ëª¨ë¦¬ ì£¼ì†Œê°€ ê²¹ì¹˜ê²Œë˜ì–´ ë‘ ê°œ ì´ìƒì˜ í¬ì¸í„°ê°€ ë™ì¼í•œ ë©”ëª¨ë¦¬ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚¬ ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì„ ì—½ë‹ˆë‹¤. í•œ í¬ì¸í„°ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì¡°ì‘í•˜ë©´ ë‹¤ë¥¸ í¬ì¸í„°ì— ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆì–´ ì‹¬ê°í•œ ë³´ì•ˆ ìœ„í—˜ê³¼ ì•…ìš© ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.

ì‹¤í–‰í•˜ë©´ **`i1`ê³¼ `i2`ê°€ ë™ì¼í•œ ì£¼ì†Œë¥¼ ê°€ì§„ ê²ƒì„ í™•ì¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<pre><code>ì´ˆê¸° í• ë‹¹:
a: 0xaaab0f0c22a0
b: 0xaaab0f0c22c0
c: 0xaaab0f0c22e0
d: 0xaaab0f0c2300
e: 0xaaab0f0c2320
f: 0xaaab0f0c2340
g: 0xaaab0f0c2360
h: 0xaaab0f0c2380
i: 0xaaab0f0c23a0
ì¬í• ë‹¹ í›„:
a1: 0xaaab0f0c2360
b1: 0xaaab0f0c2340
c1: 0xaaab0f0c2320
d1: 0xaaab0f0c2300
e1: 0xaaab0f0c22e0
f1: 0xaaab0f0c22c0
g1: 0xaaab0f0c22a0
h1: 0xaaab0f0c2380
<strong>i1: 0xaaab0f0c23a0
</strong><strong>i2: 0xaaab0f0c23a0
</strong></code></pre>

## ì°¸ê³  ìë£Œ

* [https://heap-exploitation.dhavalkapil.com/attacks/double\_free](https://heap-exploitation.dhavalkapil.com/attacks/double\_free)
