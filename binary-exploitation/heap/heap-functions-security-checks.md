# Verifica√ß√µes de Seguran√ßa das Fun√ß√µes de Heap

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** reposit√≥rios [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## unlink

Essa fun√ß√£o remove um bloco de uma lista duplamente encadeada. Verifica√ß√µes comuns garantem que a estrutura da lista encadeada permane√ßa consistente ao desvincular blocos.

* **Verifica√ß√µes de Consist√™ncia**:
* Verifique se `P->fd->bk == P` e `P->bk->fd == P`.
* Mensagem de erro: `corrupted double-linked list`

## \_int\_malloc

Essa fun√ß√£o √© respons√°vel por alocar mem√≥ria da heap. As verifica√ß√µes aqui garantem que a mem√≥ria n√£o seja corrompida durante a aloca√ß√£o.

* **Verifica√ß√£o de Tamanho do Fastbin**:
* Ao remover um bloco de um fastbin, certifique-se de que o tamanho do bloco esteja dentro da faixa do fastbin.
* Mensagem de erro: `malloc(): memory corruption (fast)`
* **Verifica√ß√£o de Consist√™ncia do Smallbin**:
* Ao remover um bloco de um smallbin, certifique-se de que os links anteriores e posteriores na lista duplamente encadeada sejam consistentes.
* Mensagem de erro: `malloc(): smallbin double linked list corrupted`
* **Verifica√ß√£o de Faixa de Mem√≥ria do Unsorted Bin**:
* Garanta que o tamanho dos blocos no unsorted bin esteja dentro dos limites m√≠nimo e m√°ximo.
* Mensagem de erro: `malloc(): memory corruption`
* **Verifica√ß√£o de Consist√™ncia do Unsorted Bin (Primeiro Cen√°rio)**:
* Ao inserir um bloco restante no unsorted bin, verifique se `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`.
* Mensagem de erro: `malloc(): corrupted unsorted chunks`
* **Verifica√ß√£o de Consist√™ncia do Unsorted Bin (Segundo Cen√°rio)**:
* Igual √† verifica√ß√£o anterior, mas acionada ao inserir ap√≥s dividir um bloco r√°pido ou pequeno.
* Mensagem de erro: `malloc(): corrupted unsorted chunks 2`

## \_int\_free

Essa fun√ß√£o libera mem√≥ria previamente alocada. As verifica√ß√µes aqui ajudam a garantir a desaloca√ß√£o adequada da mem√≥ria e a prevenir a corrup√ß√£o de mem√≥ria.

* **Verifica√ß√£o de Limite do Ponteiro**:
* Garanta que o ponteiro sendo liberado n√£o esteja envolvendo a mem√≥ria.
* Mensagem de erro: `free(): invalid pointer`
* **Verifica√ß√£o de Tamanho**:
* Garanta que o tamanho do bloco sendo liberado seja pelo menos `MINSIZE` ou um m√∫ltiplo de `MALLOC_ALIGNMENT`.
* Mensagem de erro: `free(): invalid size`
* **Verifica√ß√£o de Tamanho do Fastbin**:
* Para blocos fastbin, garanta que o tamanho do pr√≥ximo bloco esteja dentro dos limites m√≠nimo e m√°ximo.
* Mensagem de erro: `free(): invalid next size (fast)`
* **Verifica√ß√£o de Dupla Libera√ß√£o do Fastbin**:
* Ao inserir um bloco em um fastbin, garanta que o bloco na cabe√ßa n√£o seja o mesmo que est√° sendo inserido.
* Mensagem de erro: `double free or corruption (fasttop)`
* **Verifica√ß√£o de Consist√™ncia do Fastbin**:
* Ao inserir em um fastbin, garanta que os tamanhos do bloco na cabe√ßa e do bloco sendo inserido sejam iguais.
* Mensagem de erro: `invalid fastbin entry (free)`
* **Verifica√ß√£o de Consist√™ncia do Top Chunk**:
* Para blocos n√£o fastbin, garanta que o bloco n√£o seja o mesmo que o top chunk.
* Mensagem de erro: `double free or corruption (top)`
* **Verifica√ß√£o de Limites de Mem√≥ria**:
* Garanta que o pr√≥ximo bloco por mem√≥ria esteja dentro dos limites da arena.
* Mensagem de erro: `double free or corruption (out)`
* **Verifica√ß√£o do Bit Prev\_inuse**:
* Garanta que o bit prev\_inuse no pr√≥ximo bloco esteja marcado.
* Mensagem de erro: `double free or corruption (!prev)`
* **Verifica√ß√£o de Tamanho Normal**:
* Garanta que o tamanho do pr√≥ximo bloco esteja dentro de faixas v√°lidas.
* Mensagem de erro: `free(): invalid next size (normal)`
* **Verifica√ß√£o de Consist√™ncia do Unsorted Bin**:
* Ao inserir um bloco coalescido no unsorted bin, verifique se `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`.
* Mensagem de erro: `free(): corrupted unsorted chunks`

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** reposit√≥rios [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
