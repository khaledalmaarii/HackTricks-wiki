# Heap TaÅŸmasÄ±

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na (https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nleri**]'ni (https://peass.creator-spring.com) edinin
* [**PEASS Ailesi**]'ni (https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'ler**]'imiz (https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**] (https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**] katÄ±lÄ±n (https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**] (https://twitter.com/hacktricks\_live)** takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**] (https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**] (https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## Temel Bilgiler

Bir heap taÅŸmasÄ±, heap'te bir [**yÄ±ÄŸÄ±n taÅŸmasÄ±**] (../stack-overflow/) gibi. Temelde, heap'te bazÄ± verileri depolamak iÃ§in bir alan ayrÄ±lmÄ±ÅŸ ve **depolanan veriler ayrÄ±lan alandan daha bÃ¼yÃ¼k**.

YÄ±ÄŸÄ±n taÅŸmalarÄ±nda, yÄ±ÄŸÄ±ndan bazÄ± kayÄ±tlarÄ±n (Ã¶rneÄŸin yÃ¶nerge iÅŸaretÃ§isi veya yÄ±ÄŸÄ±n Ã§erÃ§evesi) geri yÃ¼kleneceÄŸini ve bunun istismar edilebileceÄŸini biliyoruz. Heap taÅŸmalarÄ±nda, taÅŸÄ±nabilecek bir heap parÃ§asÄ±nda **varsayÄ±lan olarak depolanan hassas bilgi yoktur**. Bununla birlikte, hassas bilgi veya iÅŸaretÃ§iler olabilir, bu nedenle bu zafiyetin **kritikliÄŸi**, bu zafiyetle **hangi verilerin Ã¼zerine yazÄ±labileceÄŸine** ve bir saldÄ±rganÄ±n bunu nasÄ±l istismar edebileceÄŸine baÄŸlÄ±dÄ±r.

{% hint style="success" %}
TaÅŸma ofsetlerini bulmak iÃ§in [**yÄ±ÄŸÄ±n taÅŸmalarÄ±nda**] (../stack-overflow/#finding-stack-overflows-offsets) olduÄŸu gibi aynÄ± desenleri kullanabilirsiniz.
{% endhint %}

### YÄ±ÄŸÄ±n TaÅŸmalarÄ± vs Heap TaÅŸmalarÄ±

YÄ±ÄŸÄ±n taÅŸmalarÄ±nda, zafiyet tetiklendiÄŸinde yÄ±ÄŸÄ±nda bulunacak dÃ¼zen ve veriler oldukÃ§a gÃ¼venilirdir. Bu, yÄ±ÄŸÄ±nÄ±n lineer olduÄŸu, belleÄŸin Ã§akÄ±ÅŸarak arttÄ±ÄŸÄ±, programÄ±n belirli yerlerinde yÄ±ÄŸÄ±n belleÄŸinin genellikle benzer tÃ¼rde verileri depoladÄ±ÄŸÄ± ve her iÅŸlev tarafÄ±ndan kullanÄ±lan yÄ±ÄŸÄ±n kÄ±smÄ±nÄ±n sonunda bazÄ± iÅŸaretÃ§ilerle belirli bir yapÄ±ya sahip olduÄŸu iÃ§in geÃ§erlidir.

Ancak, bir heap taÅŸmasÄ± durumunda, kullanÄ±lan belleÄŸin lineer olmadÄ±ÄŸÄ±, ancak **ayrÄ±lmÄ±ÅŸ bellek pozisyonlarÄ±nda genellikle ayrÄ±lmÄ±ÅŸ parÃ§alarÄ±n** (yan yana olmayan) olduÄŸu, boyuta gÃ¶re ayrÄ±mlar yapan **kutular ve bÃ¶lgeler** nedeniyle ve **Ã¶nceki serbest bÄ±rakÄ±lan belleÄŸin** yeni parÃ§alar ayrÄ±lmadan Ã¶nce kullanÄ±ldÄ±ÄŸÄ± iÃ§in **taÅŸan nesnenin Ã§arpÄ±ÅŸacaÄŸÄ± nesneyi bilmek karmaÅŸÄ±ktÄ±r**. Bu nedenle, bir heap taÅŸmasÄ± bulunduÄŸunda, istenen nesnenin taÅŸan nesneye bitiÅŸik olmasÄ±nÄ± saÄŸlayacak **gÃ¼venilir bir yol bulunmasÄ± gerekir**.

Bunun iÃ§in kullanÄ±lan tekniklerden biri **Heap Grooming**'dir ve Ã¶rneÄŸin [**bu gÃ¶nderide**] (https://azeria-labs.com/grooming-the-ios-kernel-heap/) kullanÄ±lmaktadÄ±r. GÃ¶nderide, iOS Ã§ekirdeÄŸinde bir bÃ¶lgenin bellekte bellek parÃ§alarÄ±nÄ± depolamak iÃ§in hafÄ±zasÄ±nÄ±n tÃ¼kendiÄŸinde, bir Ã§ekirdek sayfasÄ± ile geniÅŸletildiÄŸi ve bu sayfanÄ±n beklenen boyutlardaki parÃ§alara bÃ¶lÃ¼ndÃ¼ÄŸÃ¼ ve bu parÃ§alarÄ±n sÄ±rayla kullanÄ±lacaÄŸÄ± aÃ§Ä±klanmaktadÄ±r (iOS sÃ¼rÃ¼m 9.2'ye kadar, ardÄ±ndan bu parÃ§alarÄ±n bu saldÄ±rÄ±larÄ±n zorlaÅŸtÄ±rÄ±lmasÄ± iÃ§in rastgele bir ÅŸekilde kullanÄ±ldÄ±ÄŸÄ±).

Bu nedenle, bir heap taÅŸmasÄ± gerÃ§ekleÅŸtiÄŸinde, taÅŸan nesnenin bir kurban sÄ±rayla Ã§arpÄ±ÅŸmasÄ±nÄ± zorlamak iÃ§in birkaÃ§ **`kalloc`'lar** zorlanÄ±r ve tÃ¼m boÅŸ parÃ§alarÄ±n doldurulduÄŸundan ve yeni bir sayfa oluÅŸturulduÄŸundan emin olunmaya Ã§alÄ±ÅŸÄ±lÄ±r.

Belirli bir boyuttaki nesnelerle bu doldurmayÄ± zorlamak iÃ§in, **iOS mach port ile iliÅŸkilendirilmiÅŸ dÄ±ÅŸ hattan tahsis** ideal bir adaydÄ±r. MesajÄ±n boyutunu ÅŸekillendirerek, `kalloc` tahsisinin boyutunu tam olarak belirlemek mÃ¼mkÃ¼ndÃ¼r ve karÅŸÄ±lÄ±k gelen mach portu yok edildiÄŸinde, karÅŸÄ±lÄ±k gelen tahsis hemen `kfree`'ye geri bÄ±rakÄ±lacaktÄ±r.

ArdÄ±ndan, bazÄ± bu yer tutucular **serbest bÄ±rakÄ±labilir**. **`kalloc.4096` serbest listesi, Ã¶ÄŸeleri son giren ilk Ã§Ä±kan dÃ¼zeninde serbest bÄ±rakÄ±r**, bu da temelde bazÄ± yer tutucularÄ±n serbest bÄ±rakÄ±ldÄ±ÄŸÄ± ve saldÄ±rÄ±nÄ±n taÅŸma nesnesini almaya Ã§alÄ±ÅŸÄ±rken birkaÃ§ kurban nesne tahsis etmeye Ã§alÄ±ÅŸÄ±rken, bu nesnenin muhtemelen bir kurban nesne tarafÄ±ndan takip edileceÄŸi anlamÄ±na gelir.

## Ã–rnek ARM64

[https://8ksec.io/arm64-reversing-and-exploitation-part-1-arm-instruction-set-simple-heap-overflow/](https://8ksec.io/arm64-reversing-and-exploitation-part-1-arm-instruction-set-simple-heap-overflow/) sayfasÄ±nda, taÅŸan nesneden sonraki bir sonraki parÃ§ada yÃ¼rÃ¼tÃ¼lecek bir komutun depolandÄ±ÄŸÄ± bir heap taÅŸmasÄ± Ã¶rneÄŸi bulabilirsiniz. Bu nedenle, basit bir saldÄ±rÄ± ile Ã¼zerine yazarak yÃ¼rÃ¼tÃ¼len komutu deÄŸiÅŸtirmek mÃ¼mkÃ¼ndÃ¼r.
```bash
python3 -c 'print("/"*0x400+"/bin/ls\x00")' > hax.txt
```
<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
