# House of Einherjar

<details>

<summary><strong>ì œë¡œë¶€í„° ì˜ì›…ì´ ë  ë•Œê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜** **HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ì…í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

### ì½”ë“œ

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)ì—ì„œ ì˜ˆì œ í™•ì¸
* ë˜ëŠ” [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation)ì—ì„œ í™•ì¸ (tcacheë¥¼ ì±„ì›Œì•¼ í•  ìˆ˜ë„ ìˆìŒ)

### ëª©í‘œ

* ê±°ì˜ ëª¨ë“  íŠ¹ì • ì£¼ì†Œì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ëŠ” ê²ƒ

### ìš”êµ¬ ì‚¬í•­

* ì²­í¬ë¥¼ í• ë‹¹í•˜ë ¤ëŠ” ê²½ìš° ê°€ì§œ ì²­í¬ë¥¼ ìƒì„±:
* í¬ì¸í„°ë¥¼ ìì‹ ì„ ê°€ë¦¬í‚¤ë„ë¡ ì„¤ì •í•˜ì—¬ ë¬´ê²°ì„± ê²€ì‚¬ë¥¼ ìš°íšŒ
* í•œ ì²­í¬ì—ì„œ ë‹¤ë¥¸ ì²­í¬ë¡œì˜ í•œ ì¹¸ ì˜¤ë¥˜ë¥¼ ë‚¼ ìˆ˜ ìˆì–´ì•¼ í•¨
* ì˜¤ë¥˜ë¥¼ ì¼ìœ¼í‚¨ ì²­í¬ì˜ `prev_size`ì— ìì‹ ê³¼ ê°€ì§œ ì²­í¬ ì‚¬ì´ì˜ ì°¨ì´ë¥¼ í‘œì‹œ
* ê°€ì§œ ì²­í¬ í¬ê¸°ë„ ë¬´ê²°ì„± ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ë™ì¼í•œ í¬ê¸°ë¡œ ì„¤ì •ë˜ì–´ì•¼ í•¨
* ì´ëŸ¬í•œ ì²­í¬ë¥¼ êµ¬ì„±í•˜ë ¤ë©´ í™ ëˆ„ìˆ˜ê°€ í•„ìš”í•¨

### ê³µê²©

* ê³µê²©ìê°€ ì œì–´í•˜ëŠ” ì²­í¬ ë‚´ì— `fd`ì™€ `bk`ë¡œ ì›ë˜ ì²­í¬ë¥¼ ê°€ë¦¬í‚¤ëŠ” ê°€ì§œ ì²­í¬ê°€ ìƒì„±ë¨
* ë‹¤ë¥¸ 2ê°œì˜ ì²­í¬ (`B` ë° `C`)ê°€ í• ë‹¹ë¨
* `B`ì—ì„œ ì˜¤ë¥˜ë¥¼ ë‚¼ ê²½ìš° `prev in use` ë¹„íŠ¸ê°€ ì§€ì›Œì§€ê³  `prev_size` ë°ì´í„°ê°€ `C` ì²­í¬ê°€ í• ë‹¹ëœ ìœ„ì¹˜ì™€ ì´ì „ì— ìƒì„±ëœ ê°€ì§œ `A` ì²­í¬ ì‚¬ì´ì˜ ì°¨ì´ë¡œ ë®ì–´ì”Œì›Œì§
* ì´ `prev_size` ë° ê°€ì§œ ì²­í¬ `A`ì˜ í¬ê¸°ëŠ” ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ë™ì¼í•´ì•¼ í•¨
* ê·¸ëŸ° ë‹¤ìŒ tcacheê°€ ì±„ì›Œì§
* ê·¸ëŸ° ë‹¤ìŒ `C`ê°€ í•´ì œë˜ì–´ ê°€ì§œ ì²­í¬ `A`ì™€ í†µí•©ë¨
* ê·¸ëŸ° ë‹¤ìŒ ìƒˆë¡œìš´ ì²­í¬ `D`ê°€ ìƒì„±ë˜ëŠ”ë°, ì´ëŠ” ê°€ì§œ `A` ì²­í¬ì—ì„œ ì‹œì‘í•˜ì—¬ `B` ì²­í¬ë¥¼ ë®ìŒ
* Einherjarì˜ ì§‘ì´ ì—¬ê¸°ì„œ ëë‚¨
* ì´ê²ƒì€ fast bin ê³µê²©ìœ¼ë¡œ ê³„ì†ë  ìˆ˜ ìˆìŒ:
* `B`ë¥¼ í•´ì œí•˜ì—¬ fast binì— ì¶”ê°€
* `B`ì˜ `fd`ë¥¼ ë®ì–´ì“°ì–´ `D` ì²­í¬ë¥¼ ì•…ìš©í•œ ëŒ€ìƒ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ë„ë¡ í•¨ (ì´ëŠ” `B`ë¥¼ í¬í•¨í•˜ê³  ìˆê¸° ë•Œë¬¸)
* ê·¸ëŸ° ë‹¤ìŒ 2ê°œì˜ mallocì´ ìˆ˜í–‰ë˜ê³  ë‘ ë²ˆì§¸ mallocì€ **ëŒ€ìƒ ì£¼ì†Œë¥¼ í• ë‹¹**í•  ê²ƒì„

## ì°¸ê³  ë° ë‹¤ë¥¸ ì˜ˆì œ

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* í¬ì¸í„°ë¥¼ í•´ì œí•œ í›„ì—ëŠ” nullë¡œ ì´ˆê¸°í™”ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì—¬ì „íˆ ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŒ. ë”°ë¼ì„œ ì²­í¬ê°€ ì •ë ¬ë˜ì§€ ì•Šì€ binì— ë°°ì¹˜ë˜ê³  í¬í•¨ëœ í¬ì¸í„°ë¥¼ ëˆ„ì¶œì‹œí‚¤ê³  (libc ëˆ„ì¶œ) ê·¸ëŸ° ë‹¤ìŒ ìƒˆë¡œìš´ í™ì´ ì •ë ¬ë˜ì§€ ì•Šì€ binì— ë°°ì¹˜ë˜ì–´ ì–»ì€ í¬ì¸í„°ì—ì„œ í™ ì£¼ì†Œë¥¼ ëˆ„ì¶œí•¨.
