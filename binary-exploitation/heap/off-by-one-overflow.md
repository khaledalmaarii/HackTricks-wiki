# Off by one overflow

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

ä»…å…·æœ‰1Bæº¢å‡ºè®¿é—®æƒé™çš„æ”»å‡»è€…å¯ä»¥ä¿®æ”¹å…ˆå‰å¤§å°çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä»è€Œå…è®¸ç¯¡æ”¹å®é™…é‡Šæ”¾çš„å—ï¼Œæœ€ç»ˆç”ŸæˆåŒ…å«å¦ä¸€ä¸ªåˆæ³•å—çš„å—ã€‚

### ä»£ç ç¤ºä¾‹ï¼š

* [https://github.com/DhavalKapil/heap-exploitation/blob/d778318b6a14edad18b20421f5a06fa1a6e6920e/assets/files/shrinking\_free\_chunks.c](https://github.com/DhavalKapil/heap-exploitation/blob/d778318b6a14edad18b20421f5a06fa1a6e6920e/assets/files/shrinking\_free\_chunks.c)
* ç”±äºä½¿ç”¨äº†Tcachesï¼Œæ­¤æ”»å‡»ä¸å†æœ‰æ•ˆã€‚
* æ­¤å¤–ï¼Œå¦‚æœå°è¯•ä½¿ç”¨æ›´å¤§çš„å—æ»¥ç”¨å®ƒï¼ˆå› æ­¤ä¸æ¶‰åŠtcachesï¼‰ï¼Œæ‚¨å°†æ”¶åˆ°é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): invalid next size (unsorted)`

### ç›®æ ‡

* ä½¿ä¸€ä¸ªå—åŒ…å«åœ¨å¦ä¸€ä¸ªå—ä¸­ï¼Œå› æ­¤å¯¹ç¬¬äºŒä¸ªå—çš„å†™è®¿é—®å…è®¸è¦†ç›–åŒ…å«çš„å—

### è¦æ±‚

* é€šè¿‡ä¸€ä¸ªæº¢å‡ºæ¥ä¿®æ”¹å…ˆå‰å¤§å°çš„å…ƒæ•°æ®ä¿¡æ¯

### æ”»å‡»

* ä¸‰ä¸ªå†…å­˜å—ï¼ˆaã€bã€cï¼‰ä¾æ¬¡ä¿ç•™ã€‚ç„¶åé‡Šæ”¾ä¸­é—´çš„å—ã€‚ç¬¬ä¸€ä¸ªåŒ…å«ä¸€ä¸ªoff by oneæº¢å‡ºæ¼æ´ï¼Œæ”»å‡»è€…åˆ©ç”¨å®ƒä¸0x00ï¼ˆå¦‚æœå‰ä¸€ä¸ªå­—èŠ‚ä¸º0x10ï¼Œåˆ™ä¼šä½¿ä¸­é—´å—æŒ‡ç¤ºå…¶å®é™…å¤§å°å‡å°0x10ï¼‰ã€‚
* ç„¶åï¼Œåœ¨ä¸­é—´é‡Šæ”¾çš„å—ï¼ˆbï¼‰ä¸­åˆ†é…äº†2ä¸ªæ›´å°çš„å—ï¼Œä½†æ˜¯ç”±äº`b + b->size`ä»æœªæ›´æ–°cå—ï¼Œå› ä¸ºæŒ‡å‘çš„åœ°å€æ¯”åº”è¯¥çš„å°ã€‚
* ç„¶åï¼Œb1å’Œcè¢«é‡Šæ”¾ã€‚ç”±äº`c - c->prev_size`ä»ç„¶æŒ‡å‘bï¼ˆç°åœ¨æ˜¯b1ï¼‰ï¼Œä¸¤è€…è¢«åˆå¹¶ä¸ºä¸€ä¸ªå—ã€‚ä½†æ˜¯ï¼Œb2ä»ç„¶åœ¨b1å’Œcä¹‹é—´ã€‚
* æœ€åï¼Œæ‰§è¡Œæ–°çš„mallocä»¥é‡æ–°è·å–è¿™ä¸ªå®é™…ä¸Šå°†åŒ…å«b2çš„å†…å­˜åŒºåŸŸï¼Œä»è€Œå…è®¸æ–°mallocçš„æ‰€æœ‰è€…æ§åˆ¶b2çš„å†…å®¹ã€‚

è¿™å¼ å›¾ç‰‡å®Œç¾è§£é‡Šäº†æ”»å‡»ï¼š

<figure><img src="../../.gitbook/assets/image (1247).png" alt=""><figcaption><p><a href="https://heap-exploitation.dhavalkapil.com/attacks/shrinking_free_chunks">https://heap-exploitation.dhavalkapil.com/attacks/shrinking_free_chunks</a></p></figcaption></figure>

## å‚è€ƒèµ„æ–™

* [https://heap-exploitation.dhavalkapil.com/attacks/shrinking\_free\_chunks](https://heap-exploitation.dhavalkapil.com/attacks/shrinking\_free\_chunks)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
