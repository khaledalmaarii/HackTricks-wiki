# Tcache Bin SaldÄ±rÄ±sÄ±

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana dÃ¶nÃ¼ÅŸÃ¼n</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶nderin.

</details>

## Temel Bilgiler

Tcache bin nedir hakkÄ±nda daha fazla bilgi iÃ§in bu sayfaya bakÄ±n:

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

Ä°lk olarak, Tcache glibc sÃ¼rÃ¼mÃ¼ 2.26'da tanÄ±tÄ±ldÄ±.

[**guyinatuxido sayfasÄ±nda**](https://guyinatuxedo.github.io/29-tcache/tcache\_explanation/index.html) Ã¶nerilen **Tcache** saldÄ±rÄ±sÄ±, hedeflenen amaÃ§, bir serbest bÄ±rakÄ±lmÄ±ÅŸ parÃ§anÄ±n iÃ§indeki bir kovadaki bir sonraki parÃ§a iÅŸaretÃ§isini isteÄŸe baÄŸlÄ± bir adrese Ã¼zerine yazmak olduÄŸu hÄ±zlÄ± kova saldÄ±rÄ±sÄ±na Ã§ok benzerdir, bÃ¶ylece daha sonra **o belirli adrese tahsis edilebilir ve potansiyel olarak iÅŸaretÃ§iler Ã¼zerine yazÄ±labilir**.

Ancak, gÃ¼nÃ¼mÃ¼zde, bahsedilen kodu Ã§alÄ±ÅŸtÄ±rÄ±rsanÄ±z hata alÄ±rsÄ±nÄ±z: **`malloc(): hizalanmamÄ±ÅŸ tcache parÃ§asÄ± tespit edildi`**. Bu nedenle, yeni iÅŸaretÃ§iye hizalanmÄ±ÅŸ bir adres yazmak gereklidir (veya yazÄ±lan adresin gerÃ§ekten hizalandÄ±ÄŸÄ± binary'yi yeterince kez Ã§alÄ±ÅŸtÄ±rmak).

### Tcache indeks saldÄ±rÄ±larÄ±

Genellikle, heap'in baÅŸlangÄ±cÄ±nda, tcache iÃ§indeki **her indeksteki parÃ§a miktarÄ±nÄ±** ve **her tcache indeksinin baÅŸ parÃ§a adresini** iÃ§eren bir parÃ§a bulunabilir. Bu bilgiyi deÄŸiÅŸtirmek mÃ¼mkÃ¼n olduÄŸunda, **bazÄ± indekslerin baÅŸ parÃ§asÄ±nÄ± istenilen bir adrese yÃ¶nlendirmek mÃ¼mkÃ¼n olacaktÄ±r** (Ã¶rneÄŸin malloc hook gibi) ve daha sonra bu durumda malloc hook iÃ§eriÄŸini Ã¼zerine yazmak mÃ¼mkÃ¼n olacaktÄ±r.

## Ã–rnekler

* CTF [https://guyinatuxedo.github.io/29-tcache/dcquals19\_babyheap/index.html](https://guyinatuxedo.github.io/29-tcache/dcquals19\_babyheap/index.html)
* **Libc bilgi sÄ±zÄ±ntÄ±sÄ±**: Tcache'leri doldurmak, bir parÃ§ayÄ± sÄ±ralanmamÄ±ÅŸ listeye eklemek, tcache'yi boÅŸaltmak ve ardÄ±ndan sadece ilk 8B'yi Ã¼zerine yazarak sÄ±ralanmamÄ±ÅŸ kovadan parÃ§ayÄ± **yeniden tahsis etmek mÃ¼mkÃ¼n olacak, ikinci adresi parÃ§adan libc'ye bÄ±rakarak okuyabileceÄŸiz**.
* **Tcache saldÄ±rÄ±sÄ±**: Binary, 1B heap taÅŸmasÄ±na karÅŸÄ± savunmasÄ±zdÄ±r. Bu, ayrÄ±lmÄ±ÅŸ bir parÃ§anÄ±n **boyut baÅŸlÄ±ÄŸÄ±nÄ±** deÄŸiÅŸtirmek iÃ§in kÃ¶tÃ¼ye kullanÄ±lacaktÄ±r. Daha sonra, bu parÃ§a **serbest bÄ±rakÄ±lacak**, sahte boyuttaki parÃ§alarÄ±n tcache'ine eklenerek. ArdÄ±ndan, sahte boyutta bir parÃ§a tahsis edilecek ve Ã¶nceki parÃ§a **gerÃ§ekte daha kÃ¼Ã§Ã¼k olduÄŸu bilinerek geri dÃ¶necek ve bu, bellekteki bir sonraki parÃ§ayÄ± Ã¼zerine yazma fÄ±rsatÄ± verecektir**.\
Bu, **bir sonraki parÃ§anÄ±n FD iÅŸaretÃ§isini Ã¼zerine yazmak** iÃ§in kÃ¶tÃ¼ye kullanÄ±lacaktÄ±r **`malloc_hook`'a** iÅŸaret etmek, bÃ¶ylece ilk olarak deÄŸiÅŸtirdiÄŸimiz meÅŸru iÅŸaretÃ§iyi tahsis edebilecek ve ardÄ±ndan ikinci tahsis, `malloc_hook`'ta bir parÃ§a dÃ¶ndÃ¼recektir ve bu, **bir tek parÃ§a yazmak iÃ§in kÃ¶tÃ¼ye kullanÄ±labilir**.
* CTF [https://guyinatuxedo.github.io/29-tcache/plaid19\_cpp/index.html](https://guyinatuxedo.github.io/29-tcache/plaid19\_cpp/index.html)
* **Libc bilgi sÄ±zÄ±ntÄ±sÄ±**: Use after free ve double free var. Bu yazÄ±da yazar, kÃ¼Ã§Ã¼k bir kovaya yerleÅŸtirilen bir parÃ§anÄ±n adresini okuyarak libc'nin bir adresini sÄ±zdÄ±rdÄ± (sÄ±ralanmamÄ±ÅŸ kovadan deÄŸil, kÃ¼Ã§Ã¼k kovadan sÄ±zdÄ±rmak gibi).
* **Tcache saldÄ±rÄ±sÄ±**: Bir **Ã§ift serbest bÄ±rakma** ile bir Tcache gerÃ§ekleÅŸtirilir. AynÄ± parÃ§a iki kez serbest bÄ±rakÄ±ldÄ±ÄŸÄ±nda, tcache iÃ§inde parÃ§a kendisine iÅŸaret edecektir. Daha sonra, tahsis edilir, FD iÅŸaretÃ§isi **free hook'a** iÅŸaret etmek Ã¼zere deÄŸiÅŸtirilir ve ardÄ±ndan tekrar tahsis edilir, bÃ¶ylece listedeki bir sonraki parÃ§a free hook'ta olacaktÄ±r. ArdÄ±ndan, bu da tahsis edilir ve buraya `system`'in adresini yazmak mÃ¼mkÃ¼n olacak, bÃ¶ylece `"/bin/sh"` iÃ§eren bir malloc serbest bÄ±rakÄ±ldÄ±ÄŸÄ±nda bir shell alÄ±nÄ±r.
* CTF [https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps0/index.html](https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps0/index.html)
* Buradaki ana zayÄ±flÄ±k, offsetini belirterek heap'te **herhangi bir adresi serbest bÄ±rakma** kapasitesidir.
* **Tcache indeks saldÄ±rÄ±larÄ±**: Tcache parÃ§asÄ±na (tcache kovalarÄ±nÄ±n bilgilerini iÃ§eren parÃ§a) depolanacak bir boyutta bir parÃ§a tahsis edip serbest bÄ±rakmak, farklÄ± baytlarda her kovadaki parÃ§a miktarÄ±nÄ± depoladÄ±ÄŸÄ± iÃ§in **0x100 deÄŸerine sahip bir adres oluÅŸturacaktÄ±r**.
* Sonra, bu deÄŸer 0x100 boyutunda bir parÃ§a olduÄŸu gibi gÃ¶rÃ¼nÃ¼r. Bu adresi `free` ile kÃ¶tÃ¼ye kullanmaya izin verecektir. Bu, bu adresi tcache iÃ§indeki 0x100 boyutundaki parÃ§a indeksine **ekleyecektir**.
* ArdÄ±ndan, boyutu **0x100** olan bir parÃ§a **tahsis edildiÄŸinde**, Ã¶nceki adres bir parÃ§a olarak geri dÃ¶necek ve diÄŸer tcache indekslerini Ã¼zerine yazma olanaÄŸÄ± saÄŸlayacaktÄ±r.\
Ã–rneÄŸin, malloc hook adresini birine koyarak ve o indeksin boyutunda bir parÃ§a tahsis ederek calloc hook'ta bir parÃ§a almak, bir tek parÃ§a yazmak iÃ§in kÃ¶tÃ¼ye kullanÄ±labilir ve bir shell almak mÃ¼mkÃ¼n olacaktÄ±r.
* CTF [https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps1/index.html](https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps1/index.html)
* Bir Ã¶ncekiyle aynÄ± zayÄ±flÄ±k, bir ek kÄ±sÄ±tlama ile
* **Tcache indeks saldÄ±rÄ±larÄ±**: Bir Ã¶nceki saldÄ±rÄ±ya benzer saldÄ±rÄ± ancak **tcache bilgilerini iÃ§eren parÃ§ayÄ± serbest bÄ±rakarak** daha az adÄ±mla yapÄ±lÄ±r, bÃ¶ylece adresi, boyutuna gÃ¶re tcache indeksine eklenir ve bu boyutta tahsis edilebilir ve tcache parÃ§a bilgilerini bir parÃ§a olarak almak mÃ¼mkÃ¼n olur, bu da bir indeksin adresini free hook olarak eklemeyi, tahsis etmeyi ve Ã¼zerine bir tek parÃ§a yazmayÄ± mÃ¼mkÃ¼n kÄ±lar.
