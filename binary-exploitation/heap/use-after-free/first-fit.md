# Prva Fit

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## **Prva Fit**

Kada oslobaÄ‘ate memoriju u programu koristeÄ‡i glibc, razliÄite "kante" se koriste za upravljanje delovima memorije. Evo pojednostavljena objaÅ¡njenja dva uobiÄajena scenarija: nesortirane kante i brze kante.

### Nesortirane Kante

Kada oslobodite deo memorije koji nije brzi deo, on ide u nesortiranu kantu. Ova kanta deluje kao lista gde se novi osloboÄ‘eni delovi dodaju na poÄetak (â€glavuâ€œ). Kada zatraÅ¾ite novi deo memorije, alokator gleda u nesortiranu kantu sa zadnje strane (â€repâ€œ) kako bi pronaÅ¡ao deo koji je dovoljno velik. Ako je deo iz nesortirane kante veÄ‡i od onoga Å¡to vam je potrebno, on se deli, pri Äemu se vraÄ‡a prednji deo i ostatak ostaje u kanti.

Primer:

* Alokujete 300 bajtova (`a`), zatim 250 bajtova (`b`), oslobodite `a` i zatim ponovo zatraÅ¾ite 250 bajtova (`c`).
* Kada oslobodite `a`, ide u nesortiranu kantu.
* Ako zatim ponovo zatraÅ¾ite 250 bajtova, alokator pronalazi `a` na repu i deli ga, vraÄ‡ajuÄ‡i deo koji odgovara vaÅ¡em zahtevu i zadrÅ¾avajuÄ‡i ostatak u kanti.
* `c` Ä‡e pokazivati na prethodni `a` i biti popunjen sa `a`-ima.
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Fastbins se koriste za male memorijske blokove. Za razliku od nesortiranih kanti, fastbins dodaju nove blokove na poÄetak, stvarajuÄ‡i ponaÅ¡anje poslednji unutra - prvi napolje (LIFO). Ako zatraÅ¾ite mali blok memorije, alokator Ä‡e uzeti blok sa poÄetka fastbina.

Primer:

* Alokujete Äetiri bloka od po 20 bajtova svaki (`a`, `b`, `c`, `d`).
* Kada ih oslobodite u bilo kom redosledu, osloboÄ‘eni blokovi se dodaju na poÄetak fastbina.
* Ako zatim zatraÅ¾ite blok od 20 bajtova, alokator Ä‡e vratiti najskorije osloboÄ‘eni blok sa poÄetka fastbina.
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
## Ostale reference i primeri

* [https://heap-exploitation.dhavalkapil.com/attacks/first\_fit](https://heap-exploitation.dhavalkapil.com/attacks/first\_fit)
* [https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
* ARM64. KoriÅ¡Ä‡enje nakon oslobaÄ‘anja: Generisanje korisniÄkog objekta, oslobaÄ‘anje istog, generisanje objekta koji dobija osloboÄ‘eni blok i omoguÄ‡ava pisanje u njega, **prepisivanje pozicije korisnikovog->Å¡ifra** iz prethodnog. Ponovno koriÅ¡Ä‡enje korisnika da **zaobiÄ‘e proveru Å¡ifre**
