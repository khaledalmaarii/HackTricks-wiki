# First Fit

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>

## **First Fit**

Wenn Sie im Programm mit glibc Speicher freigeben, werden verschiedene "Bins" verwendet, um die Speicherbl√∂cke zu verwalten. Hier ist eine vereinfachte Erkl√§rung von zwei h√§ufigen Szenarien: unsorted bins und fastbins.

### Unsorted Bins

Wenn Sie einen Speicherblock freigeben, der kein schneller Block ist, gelangt er in den unsorted bin. Dieser Bin fungiert wie eine Liste, in die neue freigegebene Bl√∂cke vorne (dem "Kopf") hinzugef√ºgt werden. Wenn Sie einen neuen Speicherblock anfordern, schaut der Allocator von hinten (dem "Schwanz") auf den unsorted bin, um einen ausreichend gro√üen Block zu finden. Wenn ein Block aus dem unsorted bin gr√∂√üer ist als das, was Sie ben√∂tigen, wird er aufgeteilt, wobei der vordere Teil zur√ºckgegeben wird und der verbleibende Teil im Bin verbleibt.

Beispiel:

* Sie allozieren 300 Bytes (`a`), dann 250 Bytes (`b`), geben `a` frei und fordern erneut 250 Bytes an (`c`).
* Wenn Sie `a` freigeben, gelangt es in den unsorted bin.
* Wenn Sie dann erneut 250 Bytes anfordern, findet der Allocator `a` am Ende und teilt es auf, gibt den Teil zur√ºck, der Ihrer Anfrage entspricht, und beh√§lt den Rest im Bin.
* `c` wird auf das vorherige `a` zeigen und mit den `a's` gef√ºllt sein.
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Fastbins werden f√ºr kleine Speicherbl√∂cke verwendet. Im Gegensatz zu unsortierten Bins f√ºgen Fastbins neue Bl√∂cke am Anfang hinzu, was ein Last-In-First-Out (LIFO)-Verhalten erzeugt. Wenn Sie einen kleinen Speicherblock anfordern, wird der Allocator diesen vom Kopf des Fastbins abrufen.

Beispiel:

* Sie allozieren vier Bl√∂cke von jeweils 20 Bytes (`a`, `b`, `c`, `d`).
* Wenn Sie sie in beliebiger Reihenfolge freigeben, werden die freigegebenen Bl√∂cke am Anfang des Fastbins hinzugef√ºgt.
* Wenn Sie dann einen 20-Byte-Block anfordern, wird der Allocator den zuletzt freigegebenen Block vom Kopf des Fastbins zur√ºckgeben.
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
## Weitere Referenzen & Beispiele

* [https://heap-exploitation.dhavalkapil.com/attacks/first\_fit](https://heap-exploitation.dhavalkapil.com/attacks/first\_fit)
* [https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
* ARM64. Use after free: Erstellen eines Benutzerobjekts, Freigeben, Erstellen eines Objekts, das den freigegebenen Chunk erh√§lt und das Schreiben darauf erm√∂glicht, **√úberschreiben der Position von user->password** aus dem vorherigen. Wiederverwendung des Benutzers, um die Passwortpr√ºfung zu **umgehen**.
