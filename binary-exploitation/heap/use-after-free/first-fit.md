# First Fit

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## **First Fit**

å½“æ‚¨åœ¨ä½¿ç”¨glibcé‡Šæ”¾ç¨‹åºä¸­çš„å†…å­˜æ—¶ï¼Œä¼šä½¿ç”¨ä¸åŒçš„â€œbinsâ€æ¥ç®¡ç†å†…å­˜å—ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§å¸¸è§æƒ…å†µçš„ç®€åŒ–è§£é‡Šï¼šæœªæ’åºçš„binså’Œfastbinsã€‚

### æœªæ’åºçš„Bins

å½“æ‚¨é‡Šæ”¾ä¸€ä¸ªä¸æ˜¯å¿«é€Ÿå—çš„å†…å­˜å—æ—¶ï¼Œå®ƒä¼šè¿›å…¥æœªæ’åºçš„binã€‚è¿™ä¸ªbinå°±åƒä¸€ä¸ªåˆ—è¡¨ï¼Œæ–°é‡Šæ”¾çš„å—ä¼šè¢«æ·»åŠ åˆ°å‰é¢ï¼ˆâ€œå¤´éƒ¨â€ï¼‰ã€‚å½“æ‚¨è¯·æ±‚ä¸€ä¸ªæ–°çš„å†…å­˜å—æ—¶ï¼Œåˆ†é…å™¨ä¼šä»åé¢ï¼ˆâ€œå°¾éƒ¨â€ï¼‰æŸ¥çœ‹æœªæ’åºçš„binï¼Œä»¥æ‰¾åˆ°è¶³å¤Ÿå¤§çš„å—ã€‚å¦‚æœæœªæ’åºçš„binä¸­çš„å—æ¯”æ‚¨éœ€è¦çš„å¤§ï¼Œå®ƒä¼šè¢«åˆ†å‰²ï¼Œè¿”å›å‰éƒ¨åˆ†å¹¶ä¿ç•™å‰©ä½™éƒ¨åˆ†åœ¨binä¸­ã€‚

ç¤ºä¾‹ï¼š

* æ‚¨åˆ†é…äº†300å­—èŠ‚ï¼ˆ`a`ï¼‰ï¼Œç„¶å250å­—èŠ‚ï¼ˆ`b`ï¼‰ï¼Œé‡Šæ”¾`a`å¹¶å†æ¬¡è¯·æ±‚250å­—èŠ‚ï¼ˆ`c`ï¼‰ã€‚
* å½“æ‚¨é‡Šæ”¾`a`æ—¶ï¼Œå®ƒè¿›å…¥æœªæ’åºçš„binã€‚
* å¦‚æœç„¶åå†æ¬¡è¯·æ±‚250å­—èŠ‚ï¼Œåˆ†é…å™¨ä¼šåœ¨å°¾éƒ¨æ‰¾åˆ°`a`å¹¶å°†å…¶æ‹†åˆ†ï¼Œè¿”å›ç¬¦åˆæ‚¨è¯·æ±‚çš„éƒ¨åˆ†å¹¶ä¿ç•™å‰©ä½™éƒ¨åˆ†åœ¨binä¸­ã€‚
* `c`å°†æŒ‡å‘å…ˆå‰çš„`a`å¹¶å¡«å……`a`çš„å†…å®¹ã€‚
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Fastbins are used for small memory chunks. Unlike unsorted bins, fastbins add new chunks to the head, creating a last-in-first-out (LIFO) behavior. If you request a small chunk of memory, the allocator will pull from the fastbin's head.

Example:

* You allocate four chunks of 20 bytes each (`a`, `b`, `c`, `d`).
* When you free them in any order, the freed chunks are added to the fastbin's head.
* If you then request a 20-byte chunk, the allocator will return the most recently freed chunk from the head of the fastbin.
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
## å…¶ä»–å‚è€ƒèµ„æ–™å’Œç¤ºä¾‹

* [https://heap-exploitation.dhavalkapil.com/attacks/first\_fit](https://heap-exploitation.dhavalkapil.com/attacks/first\_fit)
* [https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
* ARM64ã€‚ä½¿ç”¨åé‡Šæ”¾ï¼šç”Ÿæˆä¸€ä¸ªç”¨æˆ·å¯¹è±¡ï¼Œé‡Šæ”¾å®ƒï¼Œç”Ÿæˆä¸€ä¸ªè·å–åˆ°è¢«é‡Šæ”¾å—çš„å¯¹è±¡ï¼Œå¹¶å…è®¸å¯¹å…¶è¿›è¡Œå†™å…¥ï¼Œ**è¦†ç›–å…ˆå‰ç”¨æˆ·->å¯†ç çš„ä½ç½®**ã€‚é‡ç”¨ç”¨æˆ·ä»¥**ç»•è¿‡å¯†ç æ£€æŸ¥**ã€‚
