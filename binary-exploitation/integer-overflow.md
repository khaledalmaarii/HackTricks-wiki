# PrzepeÅ‚nienie liczb caÅ‚kowitych

{% hint style="success" %}
Dowiedz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Dowiedz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**Grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **UdostÄ™pniaj sztuczki hakerskie, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}

## Podstawowe informacje

W centrum **przepeÅ‚nienia liczb caÅ‚kowitych** leÅ¼y ograniczenie narzucone przez **rozmiar** typÃ³w danych w programowaniu komputerowym i **interpretacjÄ™** danych.

Na przykÅ‚ad **8-bitowa liczba caÅ‚kowita bez znaku** moÅ¼e reprezentowaÄ‡ wartoÅ›ci od **0 do 255**. JeÅ›li sprÃ³bujesz przechowaÄ‡ wartoÅ›Ä‡ 256 w 8-bitowej liczbie caÅ‚kowitej bez znaku, zawiÅ›nie ona do 0 ze wzglÄ™du na ograniczenie jej pojemnoÅ›ci. Podobnie, dla **16-bitowej liczby caÅ‚kowitej bez znaku**, ktÃ³ra moÅ¼e przechowywaÄ‡ wartoÅ›ci od **0 do 65 535**, dodanie 1 do 65 535 spowoduje zawiniÄ™cie wartoÅ›ci z powrotem do 0.

Co wiÄ™cej, **8-bitowa liczba caÅ‚kowita ze znakiem** moÅ¼e reprezentowaÄ‡ wartoÅ›ci od **-128 do 127**. Wynika to z faktu, Å¼e jeden bit jest uÅ¼ywany do reprezentowania znaku (dodatni lub ujemny), pozostawiajÄ…c 7 bitÃ³w do reprezentowania wartoÅ›ci bezwzglÄ™dnej. Najbardziej ujemna liczba jest reprezentowana jako **-128** (binarnie `10000000`), a najbardziej dodatnia liczba to **127** (binarnie `01111111`).

### Maksymalne wartoÅ›ci

Dla potencjalnych **podatnoÅ›ci internetowych** bardzo interesujÄ…ce jest poznanie maksymalnie obsÅ‚ugiwanych wartoÅ›ci:

{% tabs %}
{% tab title="Rust" %}
```rust
fn main() {

let mut quantity = 2147483647;

let (mul_result, _) = i32::overflowing_mul(32767, quantity);
let (add_result, _) = i32::overflowing_add(1, quantity);

println!("{}", mul_result);
println!("{}", add_result);
}
```
{% endtab %}

{% tab title="C" %}
Integer overflows occur when the result of an arithmetic operation exceeds the maximum size that the data type can hold. This can lead to unexpected behavior and security vulnerabilities in C programs. To prevent integer overflows, developers should carefully validate input data, use data types that can accommodate the expected range of values, and implement checks to detect overflow conditions before they cause harm.
{% endtab %}
```c
#include <stdio.h>
#include <limits.h>

int main() {
int a = INT_MAX;
int b = 0;
int c = 0;

b = a * 100;
c = a + 1;

printf("%d\n", INT_MAX);
printf("%d\n", b);
printf("%d\n", c);
return 0;
}
```
## PrzykÅ‚ady

### Czyste przepeÅ‚nienie

Wydrukowany wynik bÄ™dzie wynosiÅ‚ 0, poniewaÅ¼ przepeÅ‚niliÅ›my typ char:
```c
#include <stdio.h>

int main() {
unsigned char max = 255; // 8-bit unsigned integer
unsigned char result = max + 1;
printf("Result: %d\n", result); // Expected to overflow
return 0;
}
```
### Konwersja ze znakowanej na nieznakowanÄ…

RozwaÅ¼ sytuacjÄ™, w ktÃ³rej liczba caÅ‚kowita ze znakiem jest odczytywana z wejÅ›cia uÅ¼ytkownika, a nastÄ™pnie uÅ¼ywana w kontekÅ›cie traktujÄ…cym jÄ… jako liczbÄ™ caÅ‚kowitÄ… bez znaku, bez odpowiedniej walidacji:
```c
#include <stdio.h>

int main() {
int userInput; // Signed integer
printf("Enter a number: ");
scanf("%d", &userInput);

// Treating the signed input as unsigned without validation
unsigned int processedInput = (unsigned int)userInput;

// A condition that might not work as intended if userInput is negative
if (processedInput > 1000) {
printf("Processed Input is large: %u\n", processedInput);
} else {
printf("Processed Input is within range: %u\n", processedInput);
}

return 0;
}
```
W tym przykÅ‚adzie, jeÅ›li uÅ¼ytkownik wprowadzi liczbÄ™ ujemnÄ…, zostanie ona zinterpretowana jako duÅ¼a liczba caÅ‚kowita bez znaku ze wzglÄ™du na sposÃ³b interpretacji wartoÅ›ci binarnych, co potencjalnie prowadzi do nieoczekiwanego zachowania.

### Inne PrzykÅ‚ady

* [https://guyinatuxedo.github.io/35-integer\_exploitation/int\_overflow\_post/index.html](https://guyinatuxedo.github.io/35-integer\_exploitation/int\_overflow\_post/index.html)
* Do przechowywania rozmiaru hasÅ‚a uÅ¼yto tylko 1B, wiÄ™c istnieje moÅ¼liwoÅ›Ä‡ przepeÅ‚nienia go i sprawienia, Å¼e bÄ™dzie myÅ›laÅ‚o, Å¼e ma dÅ‚ugoÅ›Ä‡ 4, podczas gdy faktycznie wynosi 260, aby ominÄ…Ä‡ ochronÄ™ sprawdzajÄ…cÄ… dÅ‚ugoÅ›Ä‡
* [https://guyinatuxedo.github.io/35-integer\_exploitation/puzzle/index.html](https://guyinatuxedo.github.io/35-integer\_exploitation/puzzle/index.html)
*   MajÄ…c parÄ™ liczb, znajdÅº za pomocÄ… z3 nowÄ… liczbÄ™, ktÃ³ra pomnoÅ¼ona przez pierwszÄ… da drugÄ…:&#x20;

```
(((argv[1] * 0x1064deadbeef4601) & 0xffffffffffffffff) == 0xD1038D2E07B42569)
```
* [https://8ksec.io/arm64-reversing-and-exploitation-part-8-exploiting-an-integer-overflow-vulnerability/](https://8ksec.io/arm64-reversing-and-exploitation-part-8-exploiting-an-integer-overflow-vulnerability/)
* Do przechowywania rozmiaru hasÅ‚a uÅ¼yto tylko 1B, wiÄ™c istnieje moÅ¼liwoÅ›Ä‡ przepeÅ‚nienia go i sprawienia, Å¼e bÄ™dzie myÅ›laÅ‚o, Å¼e ma dÅ‚ugoÅ›Ä‡ 4, podczas gdy faktycznie wynosi 260, aby ominÄ…Ä‡ ochronÄ™ sprawdzajÄ…cÄ… dÅ‚ugoÅ›Ä‡ i nadpisaÄ‡ na stosie nastÄ™pnÄ… zmiennÄ… lokalnÄ…, omijajÄ…c obie ochrony

## ARM64

To **nie zmienia siÄ™ w ARM64**, jak moÅ¼na zobaczyÄ‡ w [**tym poÅ›cie na blogu**](https://8ksec.io/arm64-reversing-and-exploitation-part-8-exploiting-an-integer-overflow-vulnerability/).
