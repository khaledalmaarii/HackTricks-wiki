# åŒé‡é‡Šæ”¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

å¦‚æœé‡Šæ”¾ä¸€ä¸ªå†…å­˜å—è¶…è¿‡ä¸€æ¬¡ï¼Œå¯èƒ½ä¼šç ´ååˆ†é…å™¨çš„æ•°æ®å¹¶ä¸ºæ”»å‡»æ‰“å¼€å¤§é—¨ã€‚äº‹æƒ…æ˜¯è¿™æ ·å‘ç”Ÿçš„ï¼šå½“æ‚¨é‡Šæ”¾ä¸€ä¸ªå†…å­˜å—æ—¶ï¼Œå®ƒä¼šå›åˆ°ä¸€ä¸ªç©ºé—²å—çš„åˆ—è¡¨ä¸­ï¼ˆä¾‹å¦‚â€œfastbinâ€ï¼‰ã€‚å¦‚æœè¿ç»­ä¸¤æ¬¡é‡Šæ”¾ç›¸åŒçš„å†…å­˜å—ï¼Œåˆ†é…å™¨ä¼šæ£€æµ‹åˆ°è¿™ä¸€ç‚¹å¹¶æŠ¥é”™ã€‚ä½†æ˜¯ï¼Œå¦‚æœ**åœ¨ä¸¤æ¬¡é‡Šæ”¾ä¹‹é—´é‡Šæ”¾å¦ä¸€ä¸ªå—ï¼Œåˆ™ä¼šç»•è¿‡åŒé‡é‡Šæ”¾æ£€æŸ¥**ï¼Œå¯¼è‡´æ•°æ®æŸåã€‚

ç°åœ¨ï¼Œå½“æ‚¨è¯·æ±‚æ–°çš„å†…å­˜ï¼ˆä½¿ç”¨`malloc`ï¼‰æ—¶ï¼Œåˆ†é…å™¨å¯èƒ½ä¼šç»™æ‚¨ä¸€ä¸ª**å·²ç»é‡Šæ”¾ä¸¤æ¬¡çš„å—**ã€‚è¿™å¯èƒ½å¯¼è‡´ä¸¤ä¸ªä¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„å†…å­˜ä½ç½®ã€‚å¦‚æœæ”»å‡»è€…æ§åˆ¶å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆï¼Œä»–ä»¬å¯ä»¥æ›´æ”¹è¯¥å†…å­˜çš„å†…å®¹ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ï¼Œç”šè‡³å…è®¸ä»–ä»¬æ‰§è¡Œä»£ç ã€‚

ç¤ºä¾‹ï¼š
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
// Allocate memory for three chunks
char *a = (char *)malloc(10);
char *b = (char *)malloc(10);
char *c = (char *)malloc(10);
char *d = (char *)malloc(10);
char *e = (char *)malloc(10);
char *f = (char *)malloc(10);
char *g = (char *)malloc(10);
char *h = (char *)malloc(10);
char *i = (char *)malloc(10);

// Print initial memory addresses
printf("Initial allocations:\n");
printf("a: %p\n", (void *)a);
printf("b: %p\n", (void *)b);
printf("c: %p\n", (void *)c);
printf("d: %p\n", (void *)d);
printf("e: %p\n", (void *)e);
printf("f: %p\n", (void *)f);
printf("g: %p\n", (void *)g);
printf("h: %p\n", (void *)h);
printf("i: %p\n", (void *)i);

// Fill tcache
free(a);
free(b);
free(c);
free(d);
free(e);
free(f);
free(g);

// Introduce double-free vulnerability in fast bin
free(h);
free(i);
free(h);


// Reallocate memory and print the addresses
char *a1 = (char *)malloc(10);
char *b1 = (char *)malloc(10);
char *c1 = (char *)malloc(10);
char *d1 = (char *)malloc(10);
char *e1 = (char *)malloc(10);
char *f1 = (char *)malloc(10);
char *g1 = (char *)malloc(10);
char *h1 = (char *)malloc(10);
char *i1 = (char *)malloc(10);
char *i2 = (char *)malloc(10);

// Print initial memory addresses
printf("After reallocations:\n");
printf("a1: %p\n", (void *)a1);
printf("b1: %p\n", (void *)b1);
printf("c1: %p\n", (void *)c1);
printf("d1: %p\n", (void *)d1);
printf("e1: %p\n", (void *)e1);
printf("f1: %p\n", (void *)f1);
printf("g1: %p\n", (void *)g1);
printf("h1: %p\n", (void *)h1);
printf("i1: %p\n", (void *)i1);
printf("i2: %p\n", (void *)i1);

return 0;
}
```
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨ç”¨å¤šä¸ªå·²é‡Šæ”¾çš„å—å¡«å……tcacheåï¼Œä»£ç **é‡Šæ”¾äº†å—`h`ï¼Œç„¶åæ˜¯å—`i`ï¼Œç„¶åå†æ¬¡é‡Šæ”¾`h`ï¼Œå¯¼è‡´åŒé‡é‡Šæ”¾é”™è¯¯**ã€‚è¿™æ‰“å¼€äº†é‡æ–°åˆ†é…æ—¶æ¥æ”¶é‡å å†…å­˜åœ°å€çš„å¯èƒ½æ€§ï¼Œæ„å‘³ç€ä¸¤ä¸ªæˆ–æ›´å¤šæŒ‡é’ˆå¯ä»¥æŒ‡å‘ç›¸åŒçš„å†…å­˜ä½ç½®ã€‚é€šè¿‡ä¸€ä¸ªæŒ‡é’ˆæ“çºµæ•°æ®ç„¶åå¯èƒ½å½±å“å¦ä¸€ä¸ªï¼Œä»è€Œåˆ›å»ºäº†ä¸¥é‡çš„å®‰å…¨é£é™©å’Œæ½œåœ¨çš„åˆ©ç”¨å¯èƒ½ã€‚

æ‰§è¡Œåï¼Œæ³¨æ„**`i1`å’Œ`i2`è·å¾—äº†ç›¸åŒçš„åœ°å€**ï¼š

<pre><code>åˆå§‹åˆ†é…ï¼š
a: 0xaaab0f0c22a0
b: 0xaaab0f0c22c0
c: 0xaaab0f0c22e0
d: 0xaaab0f0c2300
e: 0xaaab0f0c2320
f: 0xaaab0f0c2340
g: 0xaaab0f0c2360
h: 0xaaab0f0c2380
i: 0xaaab0f0c23a0
é‡æ–°åˆ†é…åï¼š
a1: 0xaaab0f0c2360
b1: 0xaaab0f0c2340
c1: 0xaaab0f0c2320
d1: 0xaaab0f0c2300
e1: 0xaaab0f0c22e0
f1: 0xaaab0f0c22c0
g1: 0xaaab0f0c22a0
h1: 0xaaab0f0c2380
<strong>i1: 0xaaab0f0c23a0
</strong><strong>i2: 0xaaab0f0c23a0
</strong></code></pre>

## å‚è€ƒ

* [https://heap-exploitation.dhavalkapil.com/attacks/double\_free](https://heap-exploitation.dhavalkapil.com/attacks/double\_free)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)çš„æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ä¸Šå…³æ³¨**æˆ‘ä»¬ã€‚
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚ 

</details>
