# å †å‡½æ•°å®‰å…¨æ£€æŸ¥

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## unlink

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="unlink.md" %}
[unlink.md](unlink.md)
{% endcontent-ref %}

è¿™æ˜¯æ‰§è¡Œçš„æ£€æŸ¥æ‘˜è¦ï¼š

* æ£€æŸ¥æŒ‡å®šå—çš„å¤§å°æ˜¯å¦ä¸ä¸‹ä¸€ä¸ªå—ä¸­æŒ‡å®šçš„ `prev_size` ç›¸åŒ
* é”™è¯¯æ¶ˆæ¯ï¼š`corrupted size vs. prev_size`
* è¿˜è¦æ£€æŸ¥ `P->fd->bk == P` å’Œ `P->bk->fw == P`
* é”™è¯¯æ¶ˆæ¯ï¼š`corrupted double-linked list`
* å¦‚æœå—ä¸æ˜¯å°å—ï¼Œè¯·æ£€æŸ¥ `P->fd_nextsize->bk_nextsize == P` å’Œ `P->bk_nextsize->fd_nextsize == P`
* é”™è¯¯æ¶ˆæ¯ï¼š`corrupted double-linked list (not small)`

## \_int\_malloc

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="malloc-and-sysmalloc.md" %}
[malloc-and-sysmalloc.md](malloc-and-sysmalloc.md)
{% endcontent-ref %}

* **å¿«é€Ÿ bin æœç´¢æœŸé—´çš„æ£€æŸ¥ï¼š**
* å¦‚æœå—æœªå¯¹é½ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): unaligned fastbin chunk detected 2`
* å¦‚æœå‰å‘å—æœªå¯¹é½ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): unaligned fastbin chunk detected`
* å¦‚æœè¿”å›çš„å—å¤§å°ä¸æ­£ç¡®ï¼Œå› ä¸ºå®ƒåœ¨å¿«é€Ÿ bin ä¸­çš„ç´¢å¼•ä¸æ­£ç¡®ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): memory corruption (fast)`
* å¦‚æœç”¨äºå¡«å…… tcache çš„ä»»ä½•å—æœªå¯¹é½ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): unaligned fastbin chunk detected 3`
* **å° bin æœç´¢æœŸé—´çš„æ£€æŸ¥ï¼š**
* å¦‚æœ `victim->bk->fd != victim`ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): smallbin double linked list corrupted`
* **åˆå¹¶æœŸé—´çš„æ£€æŸ¥** å¯¹æ¯ä¸ªå¿«é€Ÿ bin å—æ‰§è¡Œï¼š&#x20;
* å¦‚æœå—æœªå¯¹é½è§¦å‘ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc_consolidate(): unaligned fastbin chunk detected`
* å¦‚æœå—çš„å¤§å°ä¸åº”æœ‰çš„å¤§å°ä¸åŒï¼Œå› ä¸ºå®ƒåœ¨ç´¢å¼•ä¸­çš„ä½ç½®ä¸æ­£ç¡®ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc_consolidate(): invalid chunk size`
* å¦‚æœå‰ä¸€ä¸ªå—æœªè¢«ä½¿ç”¨ä¸”å‰ä¸€ä¸ªå—çš„å¤§å°ä¸ prev\_chunk æŒ‡ç¤ºçš„å¤§å°ä¸åŒï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`corrupted size vs. prev_size in fastbins`
* **æœªæ’åº bin æœç´¢æœŸé—´çš„æ£€æŸ¥**ï¼š
* å¦‚æœå—å¤§å°å¼‚å¸¸ï¼ˆå¤ªå°æˆ–å¤ªå¤§ï¼‰ï¼š&#x20;
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): invalid size (unsorted)`
* å¦‚æœä¸‹ä¸€ä¸ªå—å¤§å°å¼‚å¸¸ï¼ˆå¤ªå°æˆ–å¤ªå¤§ï¼‰ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): invalid next size (unsorted)`
* å¦‚æœä¸‹ä¸€ä¸ªå—æŒ‡ç¤ºçš„å‰ä¸€ä¸ªå¤§å°ä¸å—çš„å¤§å°ä¸åŒï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): mismatching next->prev_size (unsorted)`
* å¦‚æœä¸æ˜¯ `victim->bck->fd == victim` æˆ–ä¸æ˜¯ `victim->fd == av (arena)`ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): unsorted double linked list corrupted`
* å› ä¸ºæˆ‘ä»¬æ€»æ˜¯æ£€æŸ¥æœ€åä¸€ä¸ªï¼Œå®ƒçš„ fd åº”å§‹ç»ˆæŒ‡å‘ arena ç»“æ„ã€‚
* å¦‚æœä¸‹ä¸€ä¸ªå—æœªæŒ‡ç¤ºå‰ä¸€ä¸ªå—æ­£åœ¨ä½¿ç”¨ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): invalid next->prev_inuse (unsorted)`
* å¦‚æœ `fwd->bk_nextsize->fd_nextsize != fwd`ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): largebin double linked list corrupted (nextsize)`
* å¦‚æœ `fwd->bk->fd != fwd`ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): largebin double linked list corrupted (bk)`
* **æŒ‰ç´¢å¼•æœç´¢å¤§ bin æœŸé—´çš„æ£€æŸ¥ï¼š**
* `bck->fd-> bk != bck`ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): corrupted unsorted chunks`
* **æŒ‰ä¸‹ä¸€ä¸ªæ›´å¤§çš„æœç´¢å¤§ bin æœŸé—´çš„æ£€æŸ¥ï¼š**
* `bck->fd-> bk != bck`ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): corrupted unsorted chunks2`
* **ä½¿ç”¨é¡¶éƒ¨å—æ—¶çš„æ£€æŸ¥ï¼š**
* `chunksize(av->top) > av->system_mem`:
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): corrupted top size`

## `tcache_get_n`

* **`tcache_get_n` ä¸­çš„æ£€æŸ¥ï¼š**
* å¦‚æœå—æœªå¯¹é½ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`malloc(): unaligned tcache chunk detected`

## `tcache_thread_shutdown`

* **`tcache_thread_shutdown` ä¸­çš„æ£€æŸ¥ï¼š**
* å¦‚æœå—æœªå¯¹é½ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`tcache_thread_shutdown(): unaligned tcache chunk detected`

## `__libc_realloc`

* **`__libc_realloc` ä¸­çš„æ£€æŸ¥ï¼š**
* å¦‚æœæ—§æŒ‡é’ˆæœªå¯¹é½æˆ–å¤§å°ä¸æ­£ç¡®ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`realloc(): invalid pointer`

## `_int_free`

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="free.md" %}
[free.md](free.md)
{% endcontent-ref %}

* **`_int_free` å¼€å§‹æ—¶çš„æ£€æŸ¥ï¼š**
* æŒ‡é’ˆå·²å¯¹é½ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`free(): invalid pointer`
* å¤§å°å¤§äº `MINSIZE` ä¸”å¤§å°ä¹Ÿå¯¹é½ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`free(): invalid size`
* **`_int_free` tcache ä¸­çš„æ£€æŸ¥ï¼š**
* å¦‚æœæ¡ç›®æ•°è¶…è¿‡ `mp_.tcache_count`ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`free(): too many chunks detected in tcache`
* å¦‚æœæ¡ç›®æœªå¯¹é½ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`free(): unaligned chunk detected in tcache 2`
* å¦‚æœå·²é‡Šæ”¾çš„å—å·²è¢«é‡Šæ”¾å¹¶ä½œä¸ºå—å­˜åœ¨äº tcache ä¸­ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`free(): double free detected in tcache 2`
* **`_int_free` å¿«é€Ÿ bin ä¸­çš„æ£€æŸ¥ï¼š**
* å¦‚æœå—çš„å¤§å°æ— æ•ˆï¼ˆå¤ªå¤§æˆ–å¤ªå°ï¼‰è§¦å‘ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`free(): invalid next size (fast)`
* å¦‚æœæ·»åŠ çš„å—å·²ç»æ˜¯å¿«é€Ÿ bin çš„é¡¶éƒ¨ï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`double free or corruption (fasttop)`
* å¦‚æœé¡¶éƒ¨çš„å—å¤§å°ä¸æˆ‘ä»¬è¦æ·»åŠ çš„å—çš„å¤§å°ä¸åŒï¼š
* é”™è¯¯æ¶ˆæ¯ï¼š`invalid fastbin entry (free)`
## **`_int_free_merge_chunk`**

* **`_int_free_merge_chunk`ä¸­çš„æ£€æŸ¥:**
* å¦‚æœå—æ˜¯é¡¶éƒ¨å—:
* é”™è¯¯æ¶ˆæ¯: `double free or corruption (top)`
* å¦‚æœä¸‹ä¸€ä¸ªå—è¶…å‡ºäº†arenaçš„è¾¹ç•Œ:
* é”™è¯¯æ¶ˆæ¯: `double free or corruption (out)`
* å¦‚æœå—æœªæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼ˆåœ¨ä¸‹ä¸€ä¸ªå—çš„prev\_inuseä¸­ï¼‰:
* é”™è¯¯æ¶ˆæ¯: `double free or corruption (!prev)`
* å¦‚æœä¸‹ä¸€ä¸ªå—çš„å¤§å°å¤ªå°æˆ–å¤ªå¤§:
* é”™è¯¯æ¶ˆæ¯: `free(): invalid next size (normal)`
* å¦‚æœå‰ä¸€ä¸ªå—æœªè¢«ä½¿ç”¨ï¼Œå°†å°è¯•åˆå¹¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœ`prev_size`ä¸å‰ä¸€ä¸ªå—ä¸­æŒ‡ç¤ºçš„å¤§å°ä¸åŒ:
* é”™è¯¯æ¶ˆæ¯: `corrupted size vs. prev_size while consolidating`

## **`_int_free_create_chunk`**

* **`_int_free_create_chunk`ä¸­çš„æ£€æŸ¥:**
* å°†ä¸€ä¸ªå—æ·»åŠ åˆ°æœªæ’åºçš„binä¸­ï¼Œæ£€æŸ¥`unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`:
* é”™è¯¯æ¶ˆæ¯: `free(): corrupted unsorted chunks`

## `do_check_malloc_state`

* **`do_check_malloc_state`ä¸­çš„æ£€æŸ¥:**
* å¦‚æœæœªå¯¹é½çš„å¿«é€Ÿbinå—:
* é”™è¯¯æ¶ˆæ¯: `do_check_malloc_state(): unaligned fastbin chunk detected`

## `malloc_consolidate`

* **`malloc_consolidate`ä¸­çš„æ£€æŸ¥:**
* å¦‚æœæœªå¯¹é½çš„å¿«é€Ÿbinå—:
* é”™è¯¯æ¶ˆæ¯: `malloc_consolidate(): unaligned fastbin chunk detected`
* å¦‚æœä¸æ­£ç¡®çš„å¿«é€Ÿbinå—å¤§å°:
* é”™è¯¯æ¶ˆæ¯: `malloc_consolidate(): invalid chunk size`

## `_int_realloc`

* **`_int_realloc`ä¸­çš„æ£€æŸ¥:**
* å¤§å°å¤ªå¤§æˆ–å¤ªå°:
* é”™è¯¯æ¶ˆæ¯: `realloc(): invalid old size`
* ä¸‹ä¸€ä¸ªå—çš„å¤§å°å¤ªå¤§æˆ–å¤ªå°:
* é”™è¯¯æ¶ˆæ¯: `realloc(): invalid next size`
