# Heap FonksiyonlarÄ± GÃ¼venlik Kontrolleri

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da **takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## unlink

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="unlink.md" %}
[unlink.md](unlink.md)
{% endcontent-ref %}

YapÄ±lan kontrollerin Ã¶zeti ÅŸunlardÄ±r:

* Belirtilen blok boyutunun, bir sonraki blokta belirtilen `prev_size` ile aynÄ± olup olmadÄ±ÄŸÄ±nÄ± kontrol edin
* Hata mesajÄ±: `corrupted size vs. prev_size`
* AyrÄ±ca `P->fd->bk == P` ve `P->bk->fw == P` olduÄŸundan emin olun
* Hata mesajÄ±: `corrupted double-linked list`
* Blok kÃ¼Ã§Ã¼k deÄŸilse, `P->fd_nextsize->bk_nextsize == P` ve `P->bk_nextsize->fd_nextsize == P` olduÄŸundan emin olun
* Hata mesajÄ±: `corrupted double-linked list (not small)`

## \_int\_malloc

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="malloc-and-sysmalloc.md" %}
[malloc-and-sysmalloc.md](malloc-and-sysmalloc.md)
{% endcontent-ref %}

* **HÄ±zlÄ± blok aramasÄ± sÄ±rasÄ±nda yapÄ±lan kontroller:**
* Blok hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `malloc(): unaligned fastbin chunk detected 2`
* Ä°leri blok hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `malloc(): unaligned fastbin chunk detected`
* DÃ¶ndÃ¼rÃ¼len bloÄŸun boyutu, hÄ±zlÄ± blok iÃ§indeki dizine gÃ¶re doÄŸru deÄŸilse:
* Hata mesajÄ±: `malloc(): memory corruption (fast)`
* Tcache'i doldurmak iÃ§in kullanÄ±lan herhangi bir blok hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `malloc(): unaligned fastbin chunk detected 3`
* **KÃ¼Ã§Ã¼k blok aramasÄ± sÄ±rasÄ±nda yapÄ±lan kontroller:**
* `victim->bk->fd != victim` ise:
* Hata mesajÄ±: `malloc(): smallbin double linked list corrupted`
* **Konsolidasyon sÄ±rasÄ±nda yapÄ±lan kontroller** her hÄ±zlÄ± blok bloÄŸu iÃ§in gerÃ§ekleÅŸtirilir:&#x20;
* Blok hizalanmamÄ±ÅŸsa tetikleyin:
* Hata mesajÄ±: `malloc_consolidate(): unaligned fastbin chunk detected`
* BloÄŸun, iÃ§inde bulunduÄŸu dizine gÃ¶re farklÄ± bir boyuta sahip olmasÄ± durumunda:
* Hata mesajÄ±: `malloc_consolidate(): invalid chunk size`
* Ã–nceki blok kullanÄ±mda deÄŸilse ve Ã¶nceki bloÄŸun boyutu prev\_chunk tarafÄ±ndan belirtilenden farklÄ±ysa:
* Hata mesajÄ±: `corrupted size vs. prev_size in fastbins`
* **SÄ±rasÄ±z blok aramasÄ± sÄ±rasÄ±nda yapÄ±lan kontroller**:
* Blok boyutu garipse (Ã§ok kÃ¼Ã§Ã¼k veya Ã§ok bÃ¼yÃ¼k):&#x20;
* Hata mesajÄ±: `malloc(): invalid size (unsorted)`
* Sonraki blok boyutu garipse (Ã§ok kÃ¼Ã§Ã¼k veya Ã§ok bÃ¼yÃ¼k):
* Hata mesajÄ±: `malloc(): invalid next size (unsorted)`
* Bir sonraki bloÄŸun belirttiÄŸi Ã¶nceki blok boyutu, bloÄŸun boyutundan farklÄ±ysa:
* Hata mesajÄ±: `malloc(): mismatching next->prev_size (unsorted)`
* EÄŸer `victim->bck->fd == victim` deÄŸilse veya `victim->fd == av (arena)` deÄŸilse:
* Hata mesajÄ±: `malloc(): unsorted double linked list corrupted`
* Her zaman sonuncusunu kontrol ettiÄŸimizden, fd'sinin her zaman arena yapÄ±sÄ±na iÅŸaret etmesi gerekir.
* Sonraki blok, Ã¶ncekinin kullanÄ±mda olduÄŸunu belirtmiyorsa:
* Hata mesajÄ±: `malloc(): invalid next->prev_inuse (unsorted)`
* `fwd->bk_nextsize->fd_nextsize != fwd` ise:
* Hata mesajÄ±: `malloc(): largebin double linked list corrupted (nextsize)`
* `fwd->bk->fd != fwd` ise:
* Hata mesajÄ±: `malloc(): largebin double linked list corrupted (bk)`
* **BÃ¼yÃ¼k blok (dizinle) aramasÄ± sÄ±rasÄ±nda yapÄ±lan kontroller**:
* `bck->fd-> bk != bck` ise:
* Hata mesajÄ±: `malloc(): corrupted unsorted chunks`
* **BÃ¼yÃ¼k blok (bir sonraki bÃ¼yÃ¼k) aramasÄ± sÄ±rasÄ±nda yapÄ±lan kontroller**:
* `bck->fd-> bk != bck` ise:
* Hata mesajÄ±: `malloc(): corrupted unsorted chunks2`
* **Ãœst blok kullanÄ±mÄ± sÄ±rasÄ±nda yapÄ±lan kontroller**:
* `chunksize(av->top) > av->system_mem` ise:
* Hata mesajÄ±: `malloc(): corrupted top size`

## `tcache_get_n`

* **`tcache_get_n` iÃ§indeki kontroller:**
* Blok hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `malloc(): unaligned tcache chunk detected`

## `tcache_thread_shutdown`

* **`tcache_thread_shutdown` iÃ§indeki kontroller:**
* Blok hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `tcache_thread_shutdown(): unaligned tcache chunk detected`

## `__libc_realloc`

* **`__libc_realloc` iÃ§indeki kontroller:**
* Eski iÅŸaretÃ§i hizalanmamÄ±ÅŸsa veya boyut yanlÄ±ÅŸsa:
* Hata mesajÄ±: `realloc(): invalid pointer`

## `_int_free`

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="free.md" %}
[free.md](free.md)
{% endcontent-ref %}

* **`_int_free` baÅŸlangÄ±cÄ±ndaki kontroller:**
* Ä°ÅŸaretÃ§i hizalanmÄ±ÅŸsa:
* Hata mesajÄ±: `free(): invalid pointer`
* Boyut `MINSIZE`'dan bÃ¼yÃ¼kse ve boyut aynÄ± zamanda hizalanmÄ±ÅŸsa:
* Hata mesajÄ±: `free(): invalid size`
* **`_int_free` tcache'deki kontroller:**
* `mp_.tcache_count`'dan fazla giriÅŸ varsa:
* Hata mesajÄ±: `free(): too many chunks detected in tcache`
* GiriÅŸ hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `free(): unaligned chunk detected in tcache 2`
* Serbest bÄ±rakÄ±lan blok zaten serbest bÄ±rakÄ±lmÄ±ÅŸsa ve tcache'te bir blok olarak mevcutsa:
* Hata mesajÄ±: `free(): double free detected in tcache 2`
* **`_int_free` hÄ±zlÄ± blok iÃ§indeki kontroller:**
* Blok boyutu geÃ§ersizse (Ã§ok bÃ¼yÃ¼k veya kÃ¼Ã§Ã¼k) tetikleyin:
* Hata mesajÄ±: `free(): invalid next size (fast)`
* Eklenen blok zaten hÄ±zlÄ± blok Ã¼stÃ¼nde ise:
* Hata mesajÄ±: `double free or corruption (fasttop)`
* Ãœstteki bloÄŸun boyutu, eklediÄŸimiz bloÄŸun boyutundan farklÄ±ysa:
* Hata mesajÄ±: `invalid fastbin entry (free)`
## **`_int_free_merge_chunk`**

* **`_int_free_merge_chunk` iÃ§inde yapÄ±lan kontroller:**
* EÄŸer chunk en Ã¼st chunk ise:
* Hata mesajÄ±: `double free or corruption (top)`
* EÄŸer bir sonraki chunk arena sÄ±nÄ±rlarÄ±nÄ±n dÄ±ÅŸÄ±nda ise:
* Hata mesajÄ±: `double free or corruption (out)`
* EÄŸer chunk kullanÄ±lmamÄ±ÅŸ olarak iÅŸaretlenmemiÅŸse (bir sonraki chunk'taki prev\_inuse'ta):
* Hata mesajÄ±: `double free or corruption (!prev)`
* EÄŸer bir sonraki chunk'Ä±n boyutu Ã§ok kÃ¼Ã§Ã¼k veya Ã§ok bÃ¼yÃ¼kse:
* Hata mesajÄ±: `free(): invalid next size (normal)`
* EÄŸer Ã¶nceki chunk kullanÄ±lmÄ±yorsa, birleÅŸtirmeye Ã§alÄ±ÅŸacaktÄ±r. Ancak, `prev_size` Ã¶nceki chunk'ta belirtilen boyuttan farklÄ±ysa:
* Hata mesajÄ±: `corrupted size vs. prev_size while consolidating`

## **`_int_free_create_chunk`**

* **`_int_free_create_chunk` iÃ§inde yapÄ±lan kontroller:**
* SÄ±rasÄ±z bin'e bir chunk eklenirken, `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)` kontrol edilir:
* Hata mesajÄ±: `free(): corrupted unsorted chunks`

## `do_check_malloc_state`

* **`do_check_malloc_state` iÃ§inde yapÄ±lan kontroller:**
* HatalÄ± hÄ±zlÄ± bin chunk'Ä±:
* Hata mesajÄ±: `do_check_malloc_state(): unaligned fastbin chunk detected`

## `malloc_consolidate`

* **`malloc_consolidate` iÃ§inde yapÄ±lan kontroller:**
* HatalÄ± hÄ±zlÄ± bin chunk'Ä±:
* Hata mesajÄ±: `malloc_consolidate(): unaligned fastbin chunk detected`
* YanlÄ±ÅŸ hÄ±zlÄ± bin chunk boyutu:
* Hata mesajÄ±: `malloc_consolidate(): invalid chunk size`

## `_int_realloc`

* **`_int_realloc` iÃ§inde yapÄ±lan kontroller:**
* Boyut Ã§ok bÃ¼yÃ¼k veya Ã§ok kÃ¼Ã§Ã¼k:
* Hata mesajÄ±: `realloc(): invalid old size`
* Bir sonraki chunk'Ä±n boyutu Ã§ok bÃ¼yÃ¼k veya Ã§ok kÃ¼Ã§Ã¼k:
* Hata mesajÄ±: `realloc(): invalid next size`
