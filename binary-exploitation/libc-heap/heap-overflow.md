# í™ ì˜¤ë²„í”Œë¡œìš°

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œë¡œ PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

í™ ì˜¤ë²„í”Œë¡œìš°ëŠ” í™ì—ì„œ ë°œìƒí•˜ëŠ” [**ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°**](../stack-overflow/)ì™€ ìœ ì‚¬í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ í™ì— ë°ì´í„°ë¥¼ ì €ì¥í•  ê³µê°„ì´ ì˜ˆì•½ë˜ì—ˆì§€ë§Œ **ì €ì¥ëœ ë°ì´í„°ê°€ ì˜ˆì•½ëœ ê³µê°„ë³´ë‹¤ í° ê²½ìš°**ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ì—ì„œëŠ” ëª‡ ê°€ì§€ ë ˆì§€ìŠ¤í„°(ëª…ë ¹ í¬ì¸í„° ë˜ëŠ” ìŠ¤íƒ í”„ë ˆì„)ê°€ ìŠ¤íƒì—ì„œ ë³µì›ë  ê²ƒì´ë©° ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™ ì˜¤ë²„í”Œë¡œìš°ì˜ ê²½ìš° **í™ ì²­í¬ì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¯¼ê°í•œ ì •ë³´ê°€ ì €ì¥ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤**. ê·¸ëŸ¬ë‚˜ ë¯¼ê°í•œ ì •ë³´ë‚˜ í¬ì¸í„°ê°€ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì´ ì·¨ì•½ì ì˜ **ì¤‘ìš”ì„±ì€ ë¬´ì—‡ì´ ë®ì–´ì“°ì—¬ì§ˆ ìˆ˜ ìˆëŠ”ì§€** ë° ê³µê²©ìê°€ ì´ë¥¼ ì–´ë–»ê²Œ ì•…ìš©í•  ìˆ˜ ìˆëŠ”ì§€ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

{% hint style="success" %}
ì˜¤ë²„í”Œë¡œìš° ì˜¤í”„ì…‹ì„ ì°¾ê¸° ìœ„í•´ [**ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°**](../stack-overflow/#finding-stack-overflows-offsets)ì—ì„œì™€ ê°™ì€ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš° vs í™ ì˜¤ë²„í”Œë¡œìš°

ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ì—ì„œëŠ” ì·¨ì•½ì ì´ íŠ¸ë¦¬ê±°ë  ë•Œ ìŠ¤íƒì— ì¡´ì¬í•  ë°ì´í„° ë° ë°°ì—´ì´ ìƒë‹¹íˆ ì‹ ë¢°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ìŠ¤íƒì´ ì„ í˜•ì´ë©°, ì¶©ëŒ ë©”ëª¨ë¦¬ì—ì„œ í•­ìƒ ì¦ê°€í•˜ë©°, **í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì¤‘ ìŠ¤íƒ ë©”ëª¨ë¦¬ì˜ íŠ¹ì • ìœ„ì¹˜ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìœ ì‚¬í•œ ì¢…ë¥˜ì˜ ë°ì´í„°**ê°€ ì €ì¥ë˜ë©°, ê° í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìŠ¤íƒ ë¶€ë¶„ ëì— ì¼ë¶€ í¬ì¸í„°ê°€ ìˆëŠ” íŠ¹ì • êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ í™ ì˜¤ë²„í”Œë¡œìš°ì˜ ê²½ìš° ì‚¬ìš©ëœ ë©”ëª¨ë¦¬ëŠ” ì„ í˜•ì´ ì•„ë‹ˆì§€ë§Œ **í• ë‹¹ëœ ì²­í¬ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ì˜ ë¶„ë¦¬ëœ ìœ„ì¹˜ì— ìˆìŠµë‹ˆë‹¤**(ì„œë¡œ ì˜†ì— ìœ„ì¹˜í•˜ì§€ ì•ŠìŒ) í¬ê¸°ì— ë”°ë¼ í• ë‹¹ì„ ë¶„ë¦¬í•˜ëŠ” **bins ë° zones**ë¡œ ì¸í•´ ê·¸ë¦¬ê³  **ì´ì „ì— í•´ì œëœ ë©”ëª¨ë¦¬ê°€ ì‚¬ìš©**ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. **ì–´ë–¤ ê°ì²´ê°€ ì˜¤ë²„í”Œë¡œìš°ë  ìˆ˜ ìˆëŠ” ê°ì²´ì™€ ì¶©ëŒí•  ê²ƒì¸ì§€ ì•Œì•„ë‚´ëŠ” ê²ƒì€ ë³µì¡**í•©ë‹ˆë‹¤. ë”°ë¼ì„œ í™ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œê²¬ë˜ë©´ ì›í•˜ëŠ” ê°ì²´ê°€ ì˜¤ë²„í”Œë¡œìš°ë  ìˆ˜ ìˆëŠ” ê°ì²´ ì˜†ì— ìˆë„ë¡ **ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì°¾ì•„ì•¼** í•©ë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ê¸°ìˆ  ì¤‘ í•˜ë‚˜ëŠ” **Heap Grooming**ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ [**ì´ ê²Œì‹œë¬¼**](https://azeria-labs.com/grooming-the-ios-kernel-heap/)ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ê²Œì‹œë¬¼ì—ì„œëŠ” iOS ì»¤ë„ì—ì„œ ë©”ëª¨ë¦¬ë¥¼ ì €ì¥í•  ê³µê°„ì´ ë¶€ì¡±í•´ì§€ë©´ ì»¤ë„ í˜ì´ì§€ë¡œ í™•ì¥ë˜ê³ , ì´ í˜ì´ì§€ëŠ” ì˜ˆìƒ í¬ê¸°ì˜ ì²­í¬ë¡œ ë¶„í• ë˜ì–´ ìˆœì„œëŒ€ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤(iOS ë²„ì „ 9.2ê¹Œì§€, ê·¸ ì´í›„ì—ëŠ” ì´ëŸ¬í•œ ì²­í¬ê°€ ì´ëŸ¬í•œ ê³µê²©ì˜ ì–´ë ¤ì›€ì„ ìœ„í•´ ë¬´ì‘ìœ„ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤).

ë”°ë¼ì„œ í™ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•˜ëŠ” ì´ì „ ê²Œì‹œë¬¼ì—ì„œ, ì˜¤ë²„í”Œë¡œìš°ëœ ê°ì²´ê°€ í¬ìƒì ìˆœì„œì™€ ì¶©ëŒí•˜ë„ë¡ ê°•ì œí•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ **`kallocs`ê°€ ì—¬ëŸ¬ ìŠ¤ë ˆë“œì— ì˜í•´ ê°•ì œë¡œ ì‹¤í–‰**ë˜ì–´ ëª¨ë“  ë¹ˆ ì²­í¬ê°€ ì±„ì›Œì§€ê³  ìƒˆ í˜ì´ì§€ê°€ ìƒì„±ë˜ë„ë¡ ì‹œë„í•©ë‹ˆë‹¤.

íŠ¹ì • í¬ê¸°ì˜ ê°ì²´ë¡œ ì´ ì±„ì›€ì„ ê°•ì œí•˜ê¸° ìœ„í•´ **iOS mach portì™€ ê´€ë ¨ëœ out-of-line í• ë‹¹**ì´ ì´ìƒì ì¸ í›„ë³´ì…ë‹ˆë‹¤. ë©”ì‹œì§€ í¬ê¸°ë¥¼ ì¡°ì •í•¨ìœ¼ë¡œì¨ `kalloc` í• ë‹¹ì˜ í¬ê¸°ë¥¼ ì •í™•íˆ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©° í•´ë‹¹ mach portê°€ íŒŒê´´ë˜ë©´ í•´ë‹¹ í• ë‹¹ì€ ì¦‰ì‹œ `kfree`ë¡œ ë°˜í™˜ë©ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ì´ëŸ¬í•œ í”Œë ˆì´ìŠ¤í™€ë” ì¤‘ ì¼ë¶€ë¥¼ **í•´ì œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **`kalloc.4096` free listëŠ” í›„ì…ì„ ì¶œ ìˆœì„œë¡œ ìš”ì†Œë¥¼ í•´ì œ**í•˜ë¯€ë¡œ ì¼ë¶€ í”Œë ˆì´ìŠ¤í™€ë”ê°€ í•´ì œë˜ê³  ì•…ìš©ì´ ê°€ëŠ¥í•œ ê°ì²´ë¥¼ í• ë‹¹í•˜ë ¤ëŠ” ë™ì•ˆ ì—¬ëŸ¬ í¬ìƒì ê°ì²´ë¥¼ í• ë‹¹í•˜ë ¤ê³  ì‹œë„í•˜ë©´ ì´ ê°ì²´ê°€ í¬ìƒì ê°ì²´ ë’¤ì— ë”°ë¥´ê²Œ ë  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

### ì˜ˆì‹œ libc

[**ì´ í˜ì´ì§€**](https://guyinatuxedo.github.io/27-edit\_free\_chunk/heap\_consolidation\_explanation/index.html)ì—ì„œëŠ” ë‹¤ìŒ ì²­í¬ì˜ prev in use ë¹„íŠ¸ì™€ prev í¬ê¸° ìœ„ì¹˜ë¥¼ ë®ì–´ì“°ëŠ” ê²ƒìœ¼ë¡œ **ì‚¬ìš©ëœ ì²­í¬ë¥¼ í†µí•©**í•  ìˆ˜ ìˆìœ¼ë©°, ê·¸ëŸ° ë‹¤ìŒ ë‹¤ë¥¸ í¬ì¸í„°ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ë°ì´í„°ë¥¼ ë®ì–´ì“°ê³  ë‹¤ì‹œ í• ë‹¹í•˜ì—¬ ì˜¤ë²„í”Œë¡œìš°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ë³´ì—¬ì£¼ëŠ” ê¸°ë³¸ì ì¸ í™ ì˜¤ë²„í”Œë¡œìš° ì—ë®¬ë ˆì´ì…˜ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[**protostar heap 0**](https://guyinatuxedo.github.io/24-heap\_overflow/protostar\_heap0/index.html)ì˜ ë‹¤ë¥¸ ì˜ˆì‹œëŠ” **í™ ì˜¤ë²„í”Œë¡œìš°**ë¥¼ ì•…ìš©í•˜ì—¬ **ìŠ¹ì í•¨ìˆ˜ë¥¼ í˜¸ì¶œ**í•˜ì—¬ **í”Œë˜ê·¸ë¥¼ íšë“**í•  ìˆ˜ ìˆëŠ” CTFì˜ ë§¤ìš° ê¸°ë³¸ì ì¸ ì˜ˆì‹œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

[**protostar heap 1**](https://guyinatuxedo.github.io/24-heap\_overflow/protostar\_heap1/index.html)ì˜ ì˜ˆì‹œì—ì„œëŠ” ë²„í¼ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì•…ìš©í•˜ì—¬ **ì‚¬ìš©ìë¡œë¶€í„°ì˜ ì„ì˜ ë°ì´í„°ê°€ ì“°ì¼ ì£¼ì†Œ**ë¥¼ **ê°€ê¹Œìš´ ì²­í¬ì— ë®ì–´ì“°ëŠ” ë°©ë²•**ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì˜ˆì‹œ ARM64

[https://8ksec.io/arm64-reversing-and-exploitation-part-1-arm-instruction-set-simple-heap-overflow/](https://8ksec.io/arm64-reversing-and-exploitation-part-1-arm-instruction-set-simple-heap-overflow/) í˜ì´ì§€ì—ì„œëŠ” ì‹¤í–‰ë  ëª…ë ¹ì´ ì˜¤ë²„í”Œë¡œìš°ëœ ì²­í¬ì—ì„œ ì €ì¥ë˜ëŠ” í™ ì˜¤ë²„í”Œë¡œìš° ì˜ˆì‹œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì‰¬ìš´ ì•…ìš©ì„ í†µí•´ ì‹¤í–‰ë  ëª…ë ¹ì„ ë®ì–´ì“°ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
```bash
python3 -c 'print("/"*0x400+"/bin/ls\x00")' > hax.txt
```
### ë‹¤ë¥¸ ì˜ˆì‹œ

* [**Auth-or-out. Hack The Box**](https://7rocky.github.io/en/ctf/htb-challenges/pwn/auth-or-out/)
* ìš°ë¦¬ëŠ” ì •ìˆ˜ ì˜¤ë²„í”Œë¡œ ì·¨ì•½ì ì„ ì‚¬ìš©í•˜ì—¬ í™ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì–»ìŠµë‹ˆë‹¤.
* ìš°ë¦¬ëŠ” ì˜¤ë²„í”Œë¡œëœ ì²­í¬ì˜ `struct` ë‚´ë¶€ì˜ í•¨ìˆ˜ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ì†ìƒì‹œì¼œ `system`ê³¼ ê°™ì€ í•¨ìˆ˜ë¥¼ ì„¤ì •í•˜ê³  ì½”ë“œ ì‹¤í–‰ì„ ì–»ìŠµë‹ˆë‹¤.
