# ãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨**HackTricks Cloud**ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

ãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã¯ã€ãƒ’ãƒ¼ãƒ—å†…ã§ã®[**ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼**](../stack-overflow/)ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚åŸºæœ¬çš„ã«ã€ãƒ’ãƒ¼ãƒ—ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã®ã‚¹ãƒšãƒ¼ã‚¹ãŒäºˆç´„ã•ã‚Œã€**æ ¼ç´ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒäºˆç´„ã•ã‚ŒãŸã‚¹ãƒšãƒ¼ã‚¹ã‚ˆã‚Šã‚‚å¤§ãã‹ã£ãŸ**ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã§ã¯ã€ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰ãƒ¬ã‚¸ã‚¹ã‚¿ï¼ˆå‘½ä»¤ãƒã‚¤ãƒ³ã‚¿ã‚„ã‚¹ã‚¿ãƒƒã‚¯ãƒ•ãƒ¬ãƒ¼ãƒ ãªã©ï¼‰ãŒå¾©å…ƒã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã£ã¦ãŠã‚Šã€ã“ã‚Œã‚’æ‚ªç”¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã®å ´åˆã€ãƒ’ãƒ¼ãƒ—ãƒãƒ£ãƒ³ã‚¯ã«ã¯**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æ©Ÿå¯†æƒ…å ±ã¯æ ¼ç´ã•ã‚Œã¦ã„ãªã„**ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãŸã ã—ã€æ©Ÿå¯†æƒ…å ±ã‚„ãƒã‚¤ãƒ³ã‚¿ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã“ã®è„†å¼±æ€§ã®**é‡å¤§æ€§ã¯ã€ã©ã®ãƒ‡ãƒ¼ã‚¿ãŒä¸Šæ›¸ãã•ã‚Œã‚‹ã‹**ã¨æ”»æ’ƒè€…ãŒã“ã‚Œã‚’ã©ã®ã‚ˆã†ã«æ‚ªç”¨ã§ãã‚‹ã‹ã«ä¾å­˜ã—ã¾ã™ã€‚

{% hint style="success" %}
ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã¯ã€[**ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼**](../stack-overflow/#finding-stack-overflows-offsets)ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚
{% endhint %}

### ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ vs ãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼

ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã§ã¯ã€è„†å¼±æ€§ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹æ™‚ç‚¹ã§ã‚¹ã‚¿ãƒƒã‚¯ã«å­˜åœ¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¨é…ç½®ãŒã‹ãªã‚Šä¿¡é ¼ã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¹ã‚¿ãƒƒã‚¯ãŒãƒªãƒ‹ã‚¢ã§ã‚ã‚Šã€å¸¸ã«å¢—åŠ ã—ã¦ã„ã‚‹ãŸã‚ã€**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œä¸­ã®ç‰¹å®šã®å ´æ‰€ã§ã¯ã€ã‚¹ã‚¿ãƒƒã‚¯ãƒ¡ãƒ¢ãƒªãŒé€šå¸¸åŒæ§˜ã®ç¨®é¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´**ã—ã€å„é–¢æ•°ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹ã‚¹ã‚¿ãƒƒã‚¯éƒ¨åˆ†ã®æœ«å°¾ã«ã„ãã¤ã‹ã®ãƒã‚¤ãƒ³ã‚¿ãŒã‚ã‚‹ç‰¹å®šã®æ§‹é€ ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚

ã—ã‹ã—ã€ãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã®å ´åˆã€ä½¿ç”¨ã•ã‚Œã‚‹ãƒ¡ãƒ¢ãƒªã¯ãƒªãƒ‹ã‚¢ã§ã¯ãªãã€**å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒãƒ£ãƒ³ã‚¯ã¯é€šå¸¸ãƒ¡ãƒ¢ãƒªã®åˆ¥ã€…ã®ä½ç½®ã«é…ç½®**ã•ã‚Œã¦ã„ã¾ã™ï¼ˆéš£æ¥ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚ã“ã‚Œã¯ã€ã‚µã‚¤ã‚ºã«ã‚ˆã£ã¦å‰²ã‚Šå½“ã¦ã‚’åˆ†é›¢ã™ã‚‹**ãƒ“ãƒ³ã‚„ã‚¾ãƒ¼ãƒ³**ã¨ã€æ–°ã—ã„ãƒãƒ£ãƒ³ã‚¯ã‚’å‰²ã‚Šå½“ã¦ã‚‹å‰ã«**ä»¥å‰ã«è§£æ”¾ã•ã‚ŒãŸãƒ¡ãƒ¢ãƒªãŒä½¿ç”¨**ã•ã‚Œã‚‹ãŸã‚ã§ã™ã€‚ãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã«å¯¾ã—ã¦è„†å¼±æ€§ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã€**æœ›ã¾ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã®å¯¾è±¡ã¨ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éš£ã«é…ç½®ã™ã‚‹ä¿¡é ¼æ€§ã®é«˜ã„æ–¹æ³•ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚

ãã®ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã®1ã¤ãŒ**Heap Grooming**ã§ã™ã€‚ãŸã¨ãˆã°ã€[**ã“ã®æŠ•ç¨¿**](https://azeria-labs.com/grooming-the-ios-kernel-heap/)ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®æŠ•ç¨¿ã§ã¯ã€iOSã‚«ãƒ¼ãƒãƒ«ã§ã€ã‚¾ãƒ¼ãƒ³ãŒãƒ¡ãƒ¢ãƒªã‚’æ ¼ç´ã™ã‚‹ã®ã«ååˆ†ãªãƒ¡ãƒ¢ãƒªãŒãªããªã‚‹ã¨ã€ã‚«ãƒ¼ãƒãƒ«ãƒšãƒ¼ã‚¸ãŒæ‹¡å¼µã•ã‚Œã€ã“ã®ãƒšãƒ¼ã‚¸ãŒæœŸå¾…ã•ã‚Œã‚‹ã‚µã‚¤ã‚ºã®ãƒãƒ£ãƒ³ã‚¯ã«åˆ†å‰²ã•ã‚Œã€é †ç•ªã«ä½¿ç”¨ã•ã‚Œã¾ã™ï¼ˆiOSãƒãƒ¼ã‚¸ãƒ§ãƒ³9.2ã¾ã§ã¯ã€ã“ã‚Œã‚‰ã®ãƒãƒ£ãƒ³ã‚¯ã¯ã“ã‚Œã‚‰ã®æ”»æ’ƒã®è¤‡é›‘ã•ã‚’å¢—ã™ãŸã‚ã«ãƒ©ãƒ³ãƒ€ãƒ ãªæ–¹æ³•ã§ä½¿ç”¨ã•ã‚Œã¾ã™ï¼‰ã€‚

ã—ãŸãŒã£ã¦ã€ãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å‰è¿°ã®æŠ•ç¨¿ã§ã¯ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¢«å®³è€…ã®é †åºã¨è¡çªã•ã›ã‚‹ãŸã‚ã«ã€è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«ã‚ˆã£ã¦è¤‡æ•°ã®**`kallocs`ãŒå¼·åˆ¶ã•ã‚Œã€ã™ã¹ã¦ã®ç©ºããƒãƒ£ãƒ³ã‚¯ãŒåŸ‹ã‚ã‚‰ã‚Œã€æ–°ã—ã„ãƒšãƒ¼ã‚¸ãŒä½œæˆã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ç‰¹å®šã®ã‚µã‚¤ã‚ºã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã“ã®åŸ‹ã‚è¾¼ã¿ã‚’å¼·åˆ¶ã™ã‚‹ãŸã‚ã«ã€**iOS mach portã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸã‚¢ã‚¦ãƒˆã‚ªãƒ–ãƒ©ã‚¤ãƒ³ã®å‰²ã‚Šå½“ã¦**ãŒç†æƒ³çš„ãªå€™è£œã§ã™ã€‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚µã‚¤ã‚ºã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€`kalloc`ã®å‰²ã‚Šå½“ã¦ã®ã‚µã‚¤ã‚ºã‚’æ­£ç¢ºã«æŒ‡å®šã—ã€å¯¾å¿œã™ã‚‹mach portãŒç ´æ£„ã•ã‚Œã‚‹ã¨ã€å¯¾å¿œã™ã‚‹å‰²ã‚Šå½“ã¦ãŒã™ãã«`kfree`ã«æˆ»ã•ã‚Œã¾ã™ã€‚

ãã®å¾Œã€ã“ã‚Œã‚‰ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ã„ãã¤ã‹ã‚’**è§£æ”¾**ã§ãã¾ã™ã€‚**`kalloc.4096`ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆã¯ã€å¾Œå…¥ã‚Œå…ˆå‡ºã—ã®é †åºã§è¦ç´ ã‚’è§£æ”¾**ã™ã‚‹ãŸã‚ã€ã„ãã¤ã‹ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãŒè§£æ”¾ã•ã‚Œã€ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆãŒã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã®å¯¾è±¡ã¨ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰²ã‚Šå½“ã¦ã‚ˆã†ã¨ã™ã‚‹é–“ã«è¤‡æ•°ã®è¢«å®³è€…ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰²ã‚Šå½“ã¦ã‚ˆã†ã¨ã™ã‚‹å ´åˆã€ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¢«å®³è€…ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ç¶šãå¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚

### libcã®ä¾‹

[**ã“ã®ãƒšãƒ¼ã‚¸**](https://guyinatuxedo.github.io/27-edit\_free\_chunk/heap\_consolidation\_explanation/index.html)ã§ã¯ã€æ¬¡ã®ãƒãƒ£ãƒ³ã‚¯ã®prev in useãƒ“ãƒƒãƒˆã¨prevã‚µã‚¤ã‚ºã®ä½ç½®ã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ã§ã€**ä½¿ç”¨ä¸­ã®ãƒãƒ£ãƒ³ã‚¯ã‚’çµ±åˆ**ï¼ˆæœªä½¿ç”¨ã¨è¦‹ãªã™ã“ã¨ã§ï¼‰ã—ã€**ãã‚Œã‚’å†åº¦å‰²ã‚Šå½“ã¦**ã—ã¦ã€ç•°ãªã‚‹ãƒã‚¤ãƒ³ã‚¿ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã§ãã‚‹ã“ã¨ã‚’ç¤ºã™åŸºæœ¬çš„ãªãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

[**protostar heap 0**](https://guyinatuxedo.github.io/24-heap\_overflow/protostar\_heap0/index.html)ã‹ã‚‰ã®åˆ¥ã®ä¾‹ã§ã¯ã€**ãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼**ã‚’æ‚ªç”¨ã—ã¦ã€winneré–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦**ãƒ•ãƒ©ã‚°ã‚’å–å¾—**ã™ã‚‹CTFã®éå¸¸ã«åŸºæœ¬çš„ãªä¾‹ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

[**protostar heap 1**](https://guyinatuxedo.github.io/24-heap\_overflow/protostar\_heap1/index.html)ã®ä¾‹ã§ã¯ã€ãƒãƒƒãƒ•ã‚¡ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã§ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ä»»æ„ã®ãƒ‡ãƒ¼ã‚¿ãŒæ›¸ãè¾¼ã¾ã‚Œã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’è¿‘ãã®ãƒãƒ£ãƒ³ã‚¯ã«ä¸Šæ›¸ãã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

### ARM64ã®ä¾‹

[https://8ksec.io/arm64-reversing-and-exploitation-part-1-arm-instruction-set-simple-heap-overflow/](https://8ksec.io/arm64-reversing-and-exploitation-part-1-arm-instruction-set-simple-heap-overflow/)ã®ãƒšãƒ¼ã‚¸ã«ã¯ã€å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ãŸãƒãƒ£ãƒ³ã‚¯ã‹ã‚‰æ¬¡ã®ãƒãƒ£ãƒ³ã‚¯ã«æ ¼ç´ã•ã‚Œã‚‹ãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã®ä¾‹ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ç°¡å˜ãªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã§ãã‚Œã‚’ä¸Šæ›¸ãã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
```bash
python3 -c 'print("/"*0x400+"/bin/ls\x00")' > hax.txt
```
### ãã®ä»–ã®ä¾‹

* [**Auth-or-out. Hack The Box**](https://7rocky.github.io/en/ctf/htb-challenges/pwn/auth-or-out/)
* ãƒ’ãƒ¼ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«æ•´æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼è„†å¼±æ€§ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
* ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ãŸãƒãƒ£ãƒ³ã‚¯ã®`struct`å†…ã®é–¢æ•°ã¸ã®ãƒã‚¤ãƒ³ã‚¿ã‚’ç ´å£Šã—ã¦ã€`system`ãªã©ã®é–¢æ•°ã‚’è¨­å®šã—ã¦ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã‚’å–å¾—ã—ã¾ã™ã€‚
