# House of Einherjar

{% hint style="success" %}
AWS í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop) í™•ì¸!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass) ì°¸ì—¬ ë˜ëŠ” **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** íŒ”ë¡œìš°**.
* **HackTricks** ë° **HackTricks Cloud** ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ ìš”ë ¹ ê³µìœ .

</details>
{% endhint %}

## ê¸°ë³¸ ì •ë³´

### ì½”ë“œ

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)ì—ì„œ ì˜ˆì œ í™•ì¸
* ë˜ëŠ” [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation)ì—ì„œ í™•ì¸ (tcacheë¥¼ ì±„ì›Œì•¼ í•  ìˆ˜ë„ ìˆìŒ)

### ëª©í‘œ

* ê±°ì˜ ëª¨ë“  íŠ¹ì • ì£¼ì†Œì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.

### ìš”êµ¬ ì‚¬í•­

* ì²­í¬ë¥¼ í• ë‹¹í•˜ë ¤ëŠ” ê²½ìš° ê°€ì§œ ì²­í¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
* í¬ì¸í„°ë¥¼ ìì‹ ì„ ê°€ë¦¬í‚¤ë„ë¡ ì„¤ì •í•˜ì—¬ ë¬´ê²°ì„± ê²€ì‚¬ë¥¼ ìš°íšŒí•©ë‹ˆë‹¤.
* í•œ ì²­í¬ì—ì„œ ë‹¤ìŒ ì²­í¬ë¡œì˜ ë„ ë°”ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ `PREV_INUSE` í”Œë˜ê·¸ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.
* ì˜¤í”„ ë°”ì´ ë„ ì˜¤ìš©ëœ ì²­í¬ì˜ `prev_size`ì— ìì‹ ê³¼ ê°€ì§œ ì²­í¬ ì‚¬ì´ì˜ ì°¨ì´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
* ê°€ì§œ ì²­í¬ í¬ê¸°ë„ ë¬´ê²°ì„± ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ë™ì¼í•œ í¬ê¸°ë¡œ ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
* ì´ëŸ¬í•œ ì²­í¬ë¥¼ êµ¬ì„±í•˜ë ¤ë©´ í™ ëˆ„ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

### ê³µê²©

* ê³µê²©ìê°€ ì œì–´í•˜ëŠ” ì²­í¬ ë‚´ì— `fd` ë° `bk`ë¡œ ê°€ë¦¬í‚¤ëŠ” ê°€ì§œ ì²­í¬ `A`ê°€ ìƒì„±ë©ë‹ˆë‹¤.
* ë‹¤ë¥¸ 2ê°œì˜ ì²­í¬(`B` ë° `C`)ê°€ í• ë‹¹ë©ë‹ˆë‹¤.
* `B`ì—ì„œ ì˜¤í”„ ë°”ì´ ì›ì„ ì•…ìš©í•˜ì—¬ `prev in use` ë¹„íŠ¸ë¥¼ ì§€ìš°ê³  `prev_size` ë°ì´í„°ë¥¼ `C` ì²­í¬ê°€ í• ë‹¹ëœ ìœ„ì¹˜ì™€ ì´ì „ì— ìƒì„±ëœ ê°€ì§œ `A` ì²­í¬ ì‚¬ì´ì˜ ì°¨ì´ë¡œ ë®ì–´ì”ë‹ˆë‹¤.
* ì´ `prev_size` ë° ê°€ì§œ ì²­í¬ `A`ì˜ í¬ê¸°ëŠ” ì²´í¬ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ë™ì¼í•´ì•¼ í•©ë‹ˆë‹¤.
* ê·¸ëŸ° ë‹¤ìŒ, tcacheê°€ ì±„ì›Œì§‘ë‹ˆë‹¤.
* ê·¸ëŸ° ë‹¤ìŒ, `C`ê°€ í•´ì œë˜ì–´ ê°€ì§œ ì²­í¬ `A`ì™€ í†µí•©ë©ë‹ˆë‹¤.
* ê·¸ëŸ° ë‹¤ìŒ, ê°€ì§œ `A` ì²­í¬ì—ì„œ ì‹œì‘í•˜ê³  `B` ì²­í¬ë¥¼ í¬í•¨í•˜ëŠ” ìƒˆë¡œìš´ ì²­í¬ `D`ê°€ ìƒì„±ë©ë‹ˆë‹¤.
* Einherjarì˜ ì§‘ì´ ì—¬ê¸°ì„œ ëë‚©ë‹ˆë‹¤.
* ì´ê²ƒì€ fast bin ê³µê²© ë˜ëŠ” Tcache ë…ê°ìœ¼ë¡œ ê³„ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
* `B`ë¥¼ í•´ì œí•˜ì—¬ fast bin / Tcacheì— ì¶”ê°€í•©ë‹ˆë‹¤.
* `B`ì˜ `fd`ë¥¼ ë®ì–´ì“°ì–´ `D` ì²­í¬ë¥¼ ì•…ìš©í•˜ì—¬ ëŒ€ìƒ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ë§Œë“­ë‹ˆë‹¤(ì´ëŠ” `B`ë¥¼ í¬í•¨í•˜ê³  ìˆê¸° ë•Œë¬¸ì—).
* ê·¸ëŸ° ë‹¤ìŒ, 2ê°œì˜ mallocì´ ìˆ˜í–‰ë˜ê³  ë‘ ë²ˆì§¸ mallocì€ **ëŒ€ìƒ ì£¼ì†Œë¥¼ í• ë‹¹**í•˜ê²Œ ë©ë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ ë° ë‹¤ë¥¸ ì˜ˆì œ

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* í¬ì¸í„°ë¥¼ í•´ì œí•œ í›„ì—ëŠ” ë„ë¡œ ì´ˆê¸°í™”ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì—¬ì „íˆ ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì •ë ¬ë˜ì§€ ì•Šì€ binì— ì²­í¬ë¥¼ ë°°ì¹˜í•˜ê³  í•´ë‹¹ í¬ì¸í„°ê°€ í¬í•¨í•˜ëŠ” í¬ì¸í„°(ë¦¬ë¸ŒC ëˆ„ì¶œ)ë¥¼ ëˆ„ì¶œí•œ ë‹¤ìŒ ìƒˆ í™ì„ ì •ë ¬ë˜ì§€ ì•Šì€ binì— ë°°ì¹˜í•˜ê³  í•´ë‹¹ í¬ì¸í„°ë¡œë¶€í„° í™ ì£¼ì†Œë¥¼ ëˆ„ì¶œí•©ë‹ˆë‹¤.
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* `strtok`ì—ì„œ ë„ ë°”ì´íŠ¸ ì˜¤ë²„í”Œë¡œ ë²„ê·¸.
* House of Einherjarë¥¼ ì‚¬ìš©í•˜ì—¬ ì¤‘ì²©ëœ ì²­í¬ ìƒí™©ì„ ì–»ê³  Tcache ë…ê°ì„ ë§ˆì¹¨ìœ¼ë¡œì¨ ì„ì˜ ì“°ê¸° ì›ì‹œë¥¼ ì–»ìŠµë‹ˆë‹¤.

{% hint style="success" %}
AWS í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop) í™•ì¸!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass) ì°¸ì—¬ ë˜ëŠ” **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** íŒ”ë¡œìš°**.
* **HackTricks** ë° **HackTricks Cloud** ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ ìš”ë ¹ ê³µìœ .

</details>
{% endhint %}
