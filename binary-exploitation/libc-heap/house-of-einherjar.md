# Einherjar Evi

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶nderin.

</details>

## Temel Bilgiler

### Kod

* Ã–rneÄŸi kontrol et [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* Veya ÅŸu adresten bak [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation) (tcache'yi doldurmanÄ±z gerekebilir)

### AmaÃ§

* Hemen hemen her belirli adreste bellek tahsis etmek.

### Gereksinimler

* Bir parÃ§a tahsis etmek istediÄŸimizde sahte bir parÃ§a oluÅŸturun:
* SaÄŸlamlÄ±k kontrollerini atlamak iÃ§in iÅŸaretÃ§ileri kendisine iÅŸaret etmesini saÄŸlayÄ±n
* Bir parÃ§adan diÄŸerine bir null bayt ile bir bayt taÅŸmasÄ± yaparak `PREV_INUSE` bayraÄŸÄ±nÄ± deÄŸiÅŸtirin.
* YanlÄ±ÅŸlÄ±kla kullanÄ±lan parÃ§anÄ±n `prev_size`'Ä±na kendisi ile sahte parÃ§a arasÄ±ndaki farkÄ± gÃ¶sterin
* Sahte parÃ§a boyutu da saÄŸlamlÄ±k kontrollerini atlamak iÃ§in aynÄ± boyutta olmalÄ±dÄ±r
* Bu parÃ§alarÄ± oluÅŸturmak iÃ§in bir heap sÄ±zÄ±ntÄ±sÄ±na ihtiyacÄ±nÄ±z olacak.

### SaldÄ±rÄ±

* SaldÄ±rgan tarafÄ±ndan kontrol edilen bir parÃ§anÄ±n iÃ§ine `fd` ve `bk` ile iÅŸaret eden bir sahte parÃ§a oluÅŸturulur ve korumalarÄ± atlamak iÃ§in orijinal parÃ§aya iÅŸaret eder
* 2 diÄŸer parÃ§a (`B` ve `C`) tahsis edilir
* `B`'deki bir bayt taÅŸmasÄ± kullanÄ±larak `prev in use` biti temizlenir ve `C` parÃ§asÄ±nÄ±n tahsis edildiÄŸi yer ile Ã¶nce oluÅŸturulan sahte `A` parÃ§asÄ± arasÄ±ndaki farkla `prev_size` verisi Ã¼zerine yazÄ±lÄ±r
* Bu `prev_size` ve sahte parÃ§adaki boyut olan `A` aynÄ± olmalÄ±dÄ±r ki kontrolleri atlayabilsin.
* Sonra, tcache doldurulur
* Sonra, `C` serbest bÄ±rakÄ±lÄ±r bÃ¶ylece sahte parÃ§a `A` ile birleÅŸir
* Sonra, sahte `A` parÃ§asÄ±nda baÅŸlayacak ve `B` parÃ§ayÄ± kapsayacak yeni bir parÃ§a `D` oluÅŸturulur
* Einherjar Evi burada biter
* Bu, bir fast bin saldÄ±rÄ±sÄ± veya Tcache zehirlenmesi ile devam ettirilebilir:
* `B`'yi serbest bÄ±rakarak onu fast bin / Tcache'ye ekleyin
* `B`'nin `fd`si Ã¼zerine yazÄ±larak hedef adrese iÅŸaret etmesi saÄŸlanÄ±r, Ã§Ã¼nkÃ¼ iÃ§inde `B` bulunduran `D` parÃ§asÄ±nÄ± iÃ§erir
* Sonra, 2 malloc yapÄ±lÄ±r ve ikincisi **hedef adresi tahsis edecek**

## Referanslar ve diÄŸer Ã¶rnekler

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* Ä°ÅŸaretÃ§ileri sÄ±fÄ±rlamadÄ±ÄŸÄ±nÄ±zda serbest bÄ±rakÄ±lan iÅŸaretÃ§ilere hala eriÅŸilebilir. Bu nedenle, bir parÃ§a sÄ±ralanmamÄ±ÅŸ kutuya yerleÅŸtirilir ve iÃ§erdiÄŸi iÅŸaretÃ§ileri sÄ±zdÄ±rÄ±r (libc sÄ±zÄ±ntÄ±sÄ±) ve ardÄ±ndan bir yeni heap sÄ±ralanmamÄ±ÅŸ kutuya yerleÅŸtirilir ve aldÄ±ÄŸÄ± iÅŸaretÃ§iden bir heap adresi sÄ±zdÄ±rÄ±lÄ±r.
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* `strtok`'da null bayt taÅŸma hatasÄ±.
* Ã–rtÃ¼ÅŸen parÃ§alar durumu elde etmek iÃ§in Einherjar Evi'ni kullanÄ±n ve Tcache zehirlenmesi ile keyfi yazma yetkisine ulaÅŸÄ±n.
