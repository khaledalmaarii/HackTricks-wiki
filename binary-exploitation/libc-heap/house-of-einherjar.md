# House of Einherjar

<details>

<summary><strong>ì œë¡œë¶€í„° ì˜ì›…ì´ ë  ë•Œê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜** **HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ì…í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì— ê°€ì…í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜** **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œë¡œ PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

### ì½”ë“œ

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)ì—ì„œ ì˜ˆì œ í™•ì¸
* ë˜ëŠ” [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation)ì—ì„œ í™•ì¸ (tcacheë¥¼ ì±„ì›Œì•¼ í•  ìˆ˜ë„ ìˆìŒ)

### ëª©í‘œ

* ê±°ì˜ ëª¨ë“  íŠ¹ì • ì£¼ì†Œì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ëŠ” ê²ƒ

### ìš”êµ¬ ì‚¬í•­

* ì²­í¬ë¥¼ í• ë‹¹í•˜ë ¤ëŠ” ê²½ìš° ê°€ì§œ ì²­í¬ë¥¼ ìƒì„±:
* ìì‹ ì„ ê°€ë¦¬í‚¤ë„ë¡ í¬ì¸í„°ë¥¼ ì„¤ì •í•˜ì—¬ ë¬´ê²°ì„± ê²€ì‚¬ë¥¼ ìš°íšŒ
* í•œ ì²­í¬ì—ì„œ ë‹¤ìŒ ì²­í¬ë¡œì˜ ë„ ë°”ì´íŠ¸ë¥¼ í†µí•œ 1ë°”ì´íŠ¸ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì‚¬ìš©í•˜ì—¬ `PREV_INUSE` í”Œë˜ê·¸ ìˆ˜ì •
* ì˜¤ë²„í”Œë¡œìš°ëœ ì²­í¬ì˜ `prev_size`ì— ìì‹ ê³¼ ê°€ì§œ ì²­í¬ ì‚¬ì´ì˜ ì°¨ì´ë¥¼ í‘œì‹œ
* ê°€ì§œ ì²­í¬ í¬ê¸°ë„ ë¬´ê²°ì„± ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ë™ì¼í•œ í¬ê¸°ë¡œ ì„¤ì •ë˜ì–´ì•¼ í•¨
* ì´ëŸ¬í•œ ì²­í¬ë¥¼ êµ¬ì„±í•˜ë ¤ë©´ í™ ëˆ„ìˆ˜ê°€ í•„ìš”

### ê³µê²©

* ê³µê²©ìê°€ ì œì–´í•˜ëŠ” ì²­í¬ ë‚´ì— `fd`ì™€ `bk`ë¡œ ê°€ë¦¬í‚¤ëŠ” ê°€ì§œ ì²­í¬ `A`ê°€ ìƒì„±ë¨
* ë‹¤ë¥¸ 2ê°œì˜ ì²­í¬ (`B` ë° `C`)ê°€ í• ë‹¹ë¨
* `B`ì—ì„œ 1ë°”ì´íŠ¸ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì•…ìš©í•˜ì—¬ `prev in use` ë¹„íŠ¸ë¥¼ ì§€ìš°ê³  `prev_size` ë°ì´í„°ë¥¼ `C` ì²­í¬ê°€ í• ë‹¹ëœ ìœ„ì¹˜ì™€ ì´ì „ì— ìƒì„±ëœ ê°€ì§œ `A` ì²­í¬ ì‚¬ì´ì˜ ì°¨ì´ë¡œ ë®ì–´ì”€
* ì´ `prev_size` ë° ê°€ì§œ ì²­í¬ `A`ì˜ í¬ê¸°ëŠ” ì²´í¬ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ë™ì¼í•´ì•¼ í•¨
* ê·¸ëŸ° ë‹¤ìŒ tcacheë¥¼ ì±„ì›€
* ê·¸ëŸ° ë‹¤ìŒ `C`ë¥¼ í•´ì œí•˜ì—¬ ê°€ì§œ ì²­í¬ `A`ì™€ í†µí•©
* ê·¸ëŸ° ë‹¤ìŒ ìƒˆë¡œìš´ ì²­í¬ `D`ê°€ ìƒì„±ë˜ëŠ”ë°, ì´ëŠ” ê°€ì§œ `A` ì²­í¬ì—ì„œ ì‹œì‘í•˜ì—¬ `B` ì²­í¬ë¥¼ ë®ìŒ
* Einherjarì˜ ì§‘ì´ ì—¬ê¸°ì„œ ëë‚¨
* ì´ê²ƒì€ fast bin ê³µê²©ì´ë‚˜ Tcache ë…ê°ìœ¼ë¡œ ê³„ì†ë  ìˆ˜ ìˆìŒ:
* `B`ë¥¼ í•´ì œí•˜ì—¬ fast bin / Tcacheì— ì¶”ê°€
* `B`ì˜ `fd`ë¥¼ ë®ì–´ì“°ì–´ `D` ì²­í¬ë¥¼ ì•…ìš©í•˜ì—¬ ëŒ€ìƒ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ë„ë¡ í•¨ (ì´ëŠ” `B`ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” `D` ì²­í¬ë¥¼ í¬í•¨)
* ê·¸ëŸ° ë‹¤ìŒ 2ê°œì˜ mallocì„ ìˆ˜í–‰í•˜ê³  ë‘ ë²ˆì§¸ mallocì€ **ëŒ€ìƒ ì£¼ì†Œë¥¼ í• ë‹¹**í•  ê²ƒì„

## ì°¸ê³  ë° ë‹¤ë¥¸ ì˜ˆì œ

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* í¬ì¸í„°ë¥¼ í•´ì œí•œ í›„ì—ëŠ” ë„ë¡œ ì´ˆê¸°í™”ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì—¬ì „íˆ ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŒ. ë”°ë¼ì„œ ì²­í¬ê°€ ì •ë ¬ë˜ì§€ ì•Šì€ ë°”êµ¬ë‹ˆì— ë°°ì¹˜ë˜ê³  í¬í•¨ëœ í¬ì¸í„°ë¥¼ ëˆ„ì¶œì‹œí‚¤ê³  (libc ëˆ„ì¶œ) ê·¸ í¬ì¸í„°ì—ì„œ ëˆ„ì¶œëœ í™ ì£¼ì†Œë¥¼ ì–»ì€ í›„ ìƒˆ í™ì´ ì •ë ¬ë˜ì§€ ì•Šì€ ë°”êµ¬ë‹ˆì— ë°°ì¹˜ë˜ì–´ ì–»ì€ í¬ì¸í„°ì—ì„œ í™ ì£¼ì†Œë¥¼ ëˆ„ì¶œì‹œí‚´.
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* `strtok`ì—ì„œì˜ ë„ ë°”ì´íŠ¸ ì˜¤ë²„í”Œë¡œìš° ë²„ê·¸
* House of Einherjarë¥¼ ì‚¬ìš©í•˜ì—¬ ì¤‘ì²©ëœ ì²­í¬ ìƒí™©ì„ ì–»ê³  ì„ì˜ ì“°ê¸° ì›ì‹œë¥¼ ì–»ê¸° ìœ„í•´ Tcache ë…ê°ì„ ë§ˆë¬´ë¦¬í•¨.
