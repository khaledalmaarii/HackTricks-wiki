# Einherjar Evi

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶nderin.

</details>
{% endhint %}

## Temel Bilgiler

### Kod

* Ã–rneÄŸi kontrol edin: [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* Veya ÅŸu adresten bakÄ±n: [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation) (tcache'yi doldurmanÄ±z gerekebilir)

### AmaÃ§

* Hemen hemen herhangi bir belirli adreste bellek tahsis etmek.

### Gereksinimler

* Bir parÃ§a tahsis etmek istediÄŸimizde sahte bir parÃ§a oluÅŸturun:
* KontrolÃ¼ atlamak iÃ§in iÅŸaretÃ§ileri kendisine iÅŸaret etmesini saÄŸlayÄ±n
* Bir parÃ§adan diÄŸerine bir null bayt ile bir bayt taÅŸmasÄ± yaparak `PREV_INUSE` bayraÄŸÄ±nÄ± deÄŸiÅŸtirin.
* YanlÄ±ÅŸlÄ±kla kullanÄ±lan parÃ§anÄ±n `prev_size`'Ä±na kendisi ile sahte parÃ§a arasÄ±ndaki farkÄ± belirtin
* Sahte parÃ§a boyutu da kontrolÃ¼ atlamak iÃ§in aynÄ± boyutta olmalÄ±dÄ±r
* Bu parÃ§alarÄ± oluÅŸturmak iÃ§in bir heap sÄ±zÄ±ntÄ±sÄ±na ihtiyacÄ±nÄ±z olacak.

### SaldÄ±rÄ±

* SaldÄ±rgan tarafÄ±ndan kontrol edilen bir parÃ§anÄ±n iÃ§ine `A` sahte bir parÃ§a oluÅŸturulur ve korumalarÄ± atlamak iÃ§in `fd` ve `bk` ile orijinal parÃ§aya iÅŸaret eder
* 2 diÄŸer parÃ§a (`B` ve `C`) tahsis edilir
* `B`'deki bir hata kullanÄ±larak `prev in use` biti temizlenir ve `prev_size` verisi, Ã¶nce oluÅŸturulan sahte `A` parÃ§asÄ±nÄ±n yerinden `C` parÃ§asÄ±nÄ±n tahsis edildiÄŸi yere kadar olan farkla deÄŸiÅŸtirilir
* Bu `prev_size` ve sahte parÃ§adaki boyut olan `A` aynÄ± olmalÄ±dÄ±r kontrolÃ¼ atlamak iÃ§in.
* ArdÄ±ndan, tcache doldurulur
* Sonra, `C` serbest bÄ±rakÄ±lÄ±r, bÃ¶ylece sahte parÃ§a `A` ile birleÅŸir
* Sonra, sahte `A` parÃ§asÄ±nda baÅŸlayacak ve `B` parÃ§asÄ±nÄ± kapsayacak yeni bir parÃ§a `D` oluÅŸturulur
* Einherjar Evi burada biter
* Bu, hÄ±zlÄ± bin saldÄ±rÄ±sÄ± veya Tcache zehirlenmesi ile devam ettirilebilir:
* `B`'yi serbest bÄ±rakarak hÄ±zlÄ± bin / Tcache'e ekleyin
* `B`'nin `fd`si Ã¼zerine yazarak, iÃ§inde `B` bulunan `D` parÃ§asÄ±na iÅŸaret etmesini saÄŸlayÄ±n
* ArdÄ±ndan, 2 malloc yapÄ±lÄ±r ve ikincisi **hedef adresi tahsis edecek**

## Referanslar ve diÄŸer Ã¶rnekler

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* Ä°ÅŸaretÃ§ileri sÄ±fÄ±rlanmadÄ±ÄŸÄ± iÃ§in serbest bÄ±rakÄ±ldÄ±ktan sonra hala verilerine eriÅŸmek mÃ¼mkÃ¼ndÃ¼r. Bu nedenle, bir parÃ§a sÄ±ralanmamÄ±ÅŸ kutuya yerleÅŸtirilir ve iÃ§erdiÄŸi iÅŸaretÃ§ileri sÄ±zdÄ±rÄ±r (libc sÄ±zÄ±ntÄ±sÄ±) ve ardÄ±ndan yeni bir heap sÄ±ralanmamÄ±ÅŸ kutuya yerleÅŸtirilir ve aldÄ±ÄŸÄ± iÅŸaretÃ§iden bir heap adresi sÄ±zdÄ±rÄ±lÄ±r.
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* `strtok`'daki null bayt taÅŸma hatasÄ±.
* Ã–rtÃ¼ÅŸen parÃ§alar durumu elde etmek iÃ§in Einherjar Evi'ni kullanÄ±n ve Tcache zehirlenmesi ile keyfi yazma ilkelini elde edin.
