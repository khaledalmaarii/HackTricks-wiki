# BÃ¼yÃ¼k Bin SaldÄ±rÄ±sÄ±

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na(https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## Temel Bilgiler

BÃ¼yÃ¼k bir binin ne olduÄŸu hakkÄ±nda daha fazla bilgi iÃ§in bu sayfaya bakÄ±n:

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

BÃ¼yÃ¼k bir bin saldÄ±rÄ±sÄ±nÄ±n harika bir Ã¶rneÄŸini [**how2heap - bÃ¼yÃ¼k bin saldÄ±rÄ±sÄ±**](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/large\_bin\_attack.c) sayfasÄ±nda bulabilirsiniz.

Temelde burada, en son "gÃ¼ncel" glibc sÃ¼rÃ¼mÃ¼nde (2.35), **`P->bk_nextsize`** kontrol edilmediÄŸi iÃ§in belirli koÅŸullar saÄŸlandÄ±ÄŸÄ±nda bÃ¼yÃ¼k bir bin parÃ§asÄ±nÄ±n deÄŸeriyle bir adresin deÄŸiÅŸtirilebileceÄŸini gÃ¶rebilirsiniz.

Bu Ã¶rnekte aÅŸaÄŸÄ±daki koÅŸullarÄ± bulabilirsiniz:

* BÃ¼yÃ¼k bir parÃ§a tahsis edilir
* Ä°lk parÃ§adan daha kÃ¼Ã§Ã¼k ancak aynÄ± dizindeki baÅŸka bir bÃ¼yÃ¼k parÃ§a tahsis edilir
* Binde ilk sÄ±raya gitmesi gerektiÄŸi iÃ§in daha kÃ¼Ã§Ã¼k olmalÄ±dÄ±r
* (Ãœst parÃ§ayla birleÅŸmeyi Ã¶nlemek iÃ§in bir parÃ§a oluÅŸturulur)
* ArdÄ±ndan, ilk bÃ¼yÃ¼k parÃ§a serbest bÄ±rakÄ±lÄ±r ve ondan daha bÃ¼yÃ¼k yeni bir parÃ§a tahsis edilir -> ParÃ§a1 bÃ¼yÃ¼k bine gider
* ArdÄ±ndan, ikinci bÃ¼yÃ¼k parÃ§a serbest bÄ±rakÄ±lÄ±r
* Åimdi, zafiyet: SaldÄ±rgan, `chunk1->bk_nextsize`'Ä± `[hedef-0x20]` olarak deÄŸiÅŸtirebilir
* Daha sonra, 2. parÃ§adan daha bÃ¼yÃ¼k bir parÃ§a tahsis edilir, bu nedenle parÃ§a2, bÃ¼yÃ¼k binde `chunk1->bk_nextsize->fd_nextsize` adresini parÃ§a2'nin adresiyle Ã¼zerine yazarak eklenir

{% hint style="success" %}
DiÄŸer potansiyel senaryolar da vardÄ±r, Ã¶nemli olan, bÃ¼yÃ¼k bir bindeki mevcut X parÃ§adan **daha kÃ¼Ã§Ã¼k** bir parÃ§ayÄ± bÃ¼yÃ¼k bine eklemektir, bu nedenle binde doÄŸrudan ondan Ã¶nce eklenmesi gerekmektedir ve X'in **`bk_nextsize`**'Ä±nÄ± deÄŸiÅŸtirebilmemiz gerekmektedir Ã§Ã¼nkÃ¼ daha kÃ¼Ã§Ã¼k parÃ§anÄ±n adresi oraya yazÄ±lacaktÄ±r.
{% endhint %}

Bu, malloc'tan ilgili kod parÃ§acÄ±ÄŸÄ±dÄ±r. Adresin nasÄ±l Ã¼zerine yazÄ±ldÄ±ÄŸÄ±nÄ± daha iyi anlamak iÃ§in yorumlar eklenmiÅŸtir:

{% code overflow="wrap" %}
```c
/* if smaller than smallest, bypass loop below */
assert (chunk_main_arena (bck->bk));
if ((unsigned long) (size) < (unsigned long) chunksize_nomask (bck->bk))
{
fwd = bck; // fwd = p1
bck = bck->bk; // bck = p1->bk

victim->fd_nextsize = fwd->fd; // p2->fd_nextsize = p1->fd (Note that p1->fd is p1 as it's the only chunk)
victim->bk_nextsize = fwd->fd->bk_nextsize; // p2->bk_nextsize = p1->fd->bk_nextsize
fwd->fd->bk_nextsize = victim->bk_nextsize->fd_nextsize = victim; // p1->fd->bk_nextsize->fd_nextsize = p2
}
```
{% endcode %}

Bu, daha bÃ¼yÃ¼k parÃ§alarla hÄ±zlÄ± bin saldÄ±rÄ±sÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in libc'in `global_max_fast` global deÄŸiÅŸkenini **Ã¼zerine yazmak** iÃ§in kullanÄ±labilir.

Bu saldÄ±rÄ±nÄ±n baÅŸka harika bir aÃ§Ä±klamasÄ±nÄ± [**guyinatuxedo**](https://guyinatuxedo.github.io/32-largebin\_attack/largebin\_explanation0/index.html) adresinde bulabilirsiniz.

### DiÄŸer Ã¶rnekler

* [**La casa de papel. HackOn CTF 2024**](https://7rocky.github.io/en/ctf/other/hackon-ctf/la-casa-de-papel/)
* AynÄ± durumda bÃ¼yÃ¼k bin saldÄ±rÄ±sÄ± [**how2heap**](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/large\_bin\_attack.c) adresinde gÃ¶rÃ¼ndÃ¼ÄŸÃ¼ gibi.
* Yazma ilkesi daha karmaÅŸÄ±ktÄ±r, Ã§Ã¼nkÃ¼ burada `global_max_fast` iÅŸe yaramaz.
* SÃ¶mÃ¼rÃ¼yÃ¼ bitirmek iÃ§in FSOP gereklidir.

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da **takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud** github depolarÄ±na PR'lar gÃ¶ndererek paylaÅŸÄ±n.

</details>
