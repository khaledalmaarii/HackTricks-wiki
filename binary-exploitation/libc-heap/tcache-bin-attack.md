# Tcache Bin SaldÄ±rÄ±sÄ±

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'ler gÃ¶ndererek HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## Temel Bilgiler

Tcache bin nedir hakkÄ±nda daha fazla bilgi iÃ§in bu sayfaya bakÄ±n:

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

Ä°lk olarak, Tcache'in Glibc sÃ¼rÃ¼mÃ¼ 2.26'da tanÄ±tÄ±ldÄ±ÄŸÄ±nÄ± unutmayÄ±n.

**Tcache saldÄ±rÄ±sÄ±** (aynÄ± zamanda **Tcache zehirlenmesi** olarak da bilinir) [**guyinatuxido sayfasÄ±nda**](https://guyinatuxedo.github.io/29-tcache/tcache\_explanation/index.html) Ã¶nerilen, hedefin bir serbest bÃ¶lÃ¼m iÃ§indeki bir bindeki bir sonraki parÃ§a iÅŸaretÃ§isini istenilen bir adrese Ã¼zerine yazmak olduÄŸu hÄ±zlÄ± bin saldÄ±rÄ±sÄ±na Ã§ok benzerdir, bÃ¶ylece daha sonra **belirli bir adrese bu iÅŸaretÃ§iyi ayÄ±rmak ve potansiyel olarak iÅŸaretÃ§ileri Ã¼zerine yazmak mÃ¼mkÃ¼n olur**.

Ancak, gÃ¼nÃ¼mÃ¼zde, bahsedilen kodu Ã§alÄ±ÅŸtÄ±rÄ±rsanÄ±z hata alÄ±rsÄ±nÄ±z: **`malloc(): hizalanmamÄ±ÅŸ tcache parÃ§asÄ± tespit edildi`**. Bu nedenle, yeni iÅŸaretÃ§iye hizalanmÄ±ÅŸ bir adres yazmak gereklidir (veya yazÄ±lan adresin gerÃ§ekten hizalandÄ±ÄŸÄ±ndan emin olmak iÃ§in yeterince kez ikili dosyayÄ± Ã§alÄ±ÅŸtÄ±rmak gereklidir).

### Tcache indeks saldÄ±rÄ±larÄ±

Genellikle, heap'in baÅŸlangÄ±cÄ±nda, tcache iÃ§indeki **her indeksteki parÃ§a miktarÄ±nÄ±** ve **her tcache indeksinin baÅŸ parÃ§a adresini** iÃ§eren bir parÃ§a bulunabilir. Bu bilgiyi bir ÅŸekilde deÄŸiÅŸtirmek mÃ¼mkÃ¼n olursa, **bazÄ± indekslerin baÅŸ parÃ§asÄ±nÄ± istenilen bir adrese iÅŸaret edecek ÅŸekilde yapmak mÃ¼mkÃ¼n olur** (`__malloc_hook` gibi) ve daha sonra bu durumda `__malloc_hook` iÃ§eriÄŸini Ã¼zerine yazmak mÃ¼mkÃ¼n olur.

## Ã–rnekler

* CTF [https://guyinatuxedo.github.io/29-tcache/dcquals19\_babyheap/index.html](https://guyinatuxedo.github.io/29-tcache/dcquals19\_babyheap/index.html)
* **Libc bilgi sÄ±zÄ±ntÄ±sÄ±**: Tcache'leri doldurmak, bir parÃ§ayÄ± sÄ±ralanmamÄ±ÅŸ listeye eklemek, tcache'yi boÅŸaltmak ve ardÄ±ndan sadece ilk 8B'yi Ã¼zerine yazarak sÄ±ralanmamÄ±ÅŸ bÃ¶lÃ¼mden parÃ§ayÄ± **yeniden tahsis etmek** mÃ¼mkÃ¼ndÃ¼r, **ikinci adresi parÃ§adan libc'ye okuyabiliriz**.
* **Tcache saldÄ±rÄ±sÄ±**: Ä°kinci bir 1B heap taÅŸmasÄ± olan bir ikili dosya zafiyetlidir. Bu, ayrÄ±lmÄ±ÅŸ bir parÃ§anÄ±n **boyut baÅŸlÄ±ÄŸÄ±nÄ±** deÄŸiÅŸtirmek iÃ§in kÃ¶tÃ¼ye kullanÄ±lacaktÄ±r. Daha sonra, bu parÃ§a **serbest bÄ±rakÄ±lacak**, sahte boyuttaki parÃ§alarÄ±n tcache'ine eklenir. ArdÄ±ndan, sahte boyutta bir parÃ§a tahsis edilecek ve Ã¶nceki parÃ§a **gerÃ§ekte daha kÃ¼Ã§Ã¼k olduÄŸu bilinerek geri dÃ¶necektir ve bu, bellekteki bir sonraki parÃ§ayÄ± Ã¼zerine yazma fÄ±rsatÄ± verir**.\
Bu, **bir sonraki parÃ§anÄ±n FD iÅŸaretÃ§isini Ã¼zerine yazmak** iÃ§in kÃ¶tÃ¼ye kullanÄ±lacaktÄ±r, bÃ¶ylece deÄŸiÅŸtirilen ilk meÅŸru iÅŸaretÃ§iyi ve ardÄ±ndan ikinci tahsisin **`malloc_hook`'a** dÃ¶neceÄŸi bir parÃ§a alÄ±nacaktÄ±r ve bu, **bir gadget yazmak iÃ§in kÃ¶tÃ¼ye kullanÄ±labilir**.
* CTF [https://guyinatuxedo.github.io/29-tcache/plaid19\_cpp/index.html](https://guyinatuxedo.github.io/29-tcache/plaid19\_cpp/index.html)
* **Libc bilgi sÄ±zÄ±ntÄ±sÄ±**: Bir kullanÄ±m sonrasÄ± serbest bÄ±rakma ve Ã§ift serbest bÄ±rakma vardÄ±r. Bu yazÄ±da yazar, kÃ¼Ã§Ã¼k bir bine yerleÅŸtirilen bir parÃ§anÄ±n adresini okuyarak libc'nin bir adresini sÄ±zdÄ±rdÄ±.
* **Tcache saldÄ±rÄ±sÄ±**: Bir **Ã§ift serbest bÄ±rakma** aracÄ±lÄ±ÄŸÄ±yla bir Tcache gerÃ§ekleÅŸtirilir. AynÄ± parÃ§a iki kez serbest bÄ±rakÄ±lÄ±r, bu nedenle Tcache iÃ§inde parÃ§a kendisine iÅŸaret eder. ArdÄ±ndan, tahsis edilir, FD iÅŸaretÃ§isi **free hook'a** iÅŸaret etmek Ã¼zere deÄŸiÅŸtirilir ve ardÄ±ndan tekrar tahsis edilir, bÃ¶ylece listedeki bir sonraki parÃ§a free hook'ta olacaktÄ±r. ArdÄ±ndan, bu da tahsis edilir ve `system` adresi buraya yazÄ±labilir, bÃ¶ylece `"/bin/sh"` iÃ§eren bir malloc serbest bÄ±rakÄ±ldÄ±ÄŸÄ±nda bir kabuk alÄ±nabilir.
* CTF [https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps0/index.html](https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps0/index.html)
* Buradaki ana zafiyet, heap'te herhangi bir adresi `free` etme kapasitesidir ve bunu belirtmek iÃ§in ofsetini gÃ¶stermektir.
* **Tcache indeks saldÄ±rÄ±larÄ±**: Tcache parÃ§asÄ±nÄ±n iÃ§inde depolanan bir boyutta bir parÃ§a tahsis edip serbest bÄ±rakmak, farklÄ± baytlarda her bir bindeki parÃ§a miktarÄ±nÄ± depoladÄ±ÄŸÄ± iÃ§in **deÄŸeri 0x100 olan bir adres oluÅŸturacaktÄ±r**. Bu, tcache'nin her bir indeksindeki 0x100 boyutundaki parÃ§alarÄ±n bir parÃ§a oluÅŸturmasÄ±na neden olur.
* ArdÄ±ndan, bu deÄŸer 0x100 boyutunda bir parÃ§a olduÄŸu gibi gÃ¶rÃ¼nÃ¼r. Bu adresi `free` ile kÃ¶tÃ¼ye kullanmaya izin verecektir. Bu, o adresin tcache iÃ§indeki 0x100 boyutundaki parÃ§alarÄ±n indeksine **eklenecektir**.
* ArdÄ±ndan, boyutu **0x100** olan bir parÃ§a **tahsis edilir**, Ã¶nceki adres bir parÃ§a olarak geri dÃ¶necek ve diÄŸer tcache indekslerini Ã¼zerine yazmaya izin verecektir.\
Ã–rneÄŸin, malloc hook adresini birine koyarak ve o indeksin boyutunda bir parÃ§a tahsis ederek calloc hook'ta bir parÃ§a alÄ±nabilir, bu da bir gadget yazmak iÃ§in bir fÄ±rsat saÄŸlar.
* CTF [https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps1/index.html](https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps1/index.html)
* Bir Ã¶ncekiyle aynÄ± zafiyet, bir ek kÄ±sÄ±tlama ile
* **Tcache indeks saldÄ±rÄ±larÄ±**: Ã–nceki saldÄ±rÄ±ya benzer saldÄ±rÄ± ancak **tcache bilgilerini iÃ§eren parÃ§ayÄ± serbest bÄ±rakarak** daha az adÄ±mla gerÃ§ekleÅŸtirilir, bu nedenle adresi, boyutuna gÃ¶re tcache indeksine eklenir ve bu nedenle o boyutta tahsis edilebilir ve tcache parÃ§a bilgilerini bir parÃ§a olarak almak mÃ¼mkÃ¼n olur, bu da bir indeksin adresini free hook olarak eklemeyi, tahsis etmeyi ve Ã¼zerine bir gadget yazmayÄ± mÃ¼mkÃ¼n kÄ±lar.
* [**Matematik KapÄ±sÄ±. HTB Siber KÄ±yamet CTF 2023**](https://7rocky.github.io/en/ctf/other/htb-cyber-apocalypse/math-door/)
* `fd` iÅŸaretÃ§isine bir sayÄ± eklemek iÃ§in **Serbest BÄ±rakmadan Sonra Yazma**.
* Bu zorlukta birÃ§ok **heap feng-shui** gereklidir. YazÄ±, **Tcache serbest listesinin baÅŸÄ±nÄ± kontrol etmenin oldukÃ§a kullanÄ±ÅŸlÄ± olduÄŸunu** gÃ¶stermektedir.
* `stdout` Ã¼zerinden **Glibc sÄ±zÄ±ntÄ±sÄ±** (FSOP).
* **Tcache zehirlenmesi** ile keyfi yazma yetkisi elde etmek.
* **ğŸ’¬ [**Discord grubuna** katÄ±lÄ±n](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek PR'ler oluÅŸturarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na paylaÅŸÄ±n.**
