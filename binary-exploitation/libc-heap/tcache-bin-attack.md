# Tcache Bin SaldÄ±rÄ±sÄ±

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
{% endhint %}

## Temel Bilgiler

Tcache bin nedir hakkÄ±nda daha fazla bilgi iÃ§in bu sayfaya bakÄ±n:

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

Ä°lk olarak, Tcache'nin Glibc sÃ¼rÃ¼m 2.26'da tanÄ±tÄ±ldÄ±ÄŸÄ±nÄ± unutmayÄ±n.

[**guyinatuxido sayfasÄ±nda**](https://guyinatuxedo.github.io/29-tcache/tcache\_explanation/index.html) Ã¶nerilen **Tcache saldÄ±rÄ±sÄ±** (aynÄ± zamanda **Tcache zehirlenmesi** olarak da bilinir) hedef, bir serbest bÄ±rakÄ±lmÄ±ÅŸ parÃ§anÄ±n iÃ§indeki bir kovadaki bir sonraki parÃ§a iÅŸaretÃ§isini isteÄŸe baÄŸlÄ± bir adrese Ã¼zerine yazmak olduÄŸu iÃ§in hÄ±zlÄ± kova saldÄ±rÄ±sÄ±na Ã§ok benzerdir, bÃ¶ylece daha sonra **o belirli adrese tahsis edilebilir ve potansiyel olarak iÅŸaretÃ§iler Ã¼zerine yazÄ±labilir**.

Ancak, gÃ¼nÃ¼mÃ¼zde, bahsedilen kodu Ã§alÄ±ÅŸtÄ±rÄ±rsanÄ±z hata alÄ±rsÄ±nÄ±z: **`malloc(): hizalanmamÄ±ÅŸ tcache parÃ§asÄ± algÄ±landÄ±`**. Bu nedenle, yeni iÅŸaretÃ§iye hizalanmÄ±ÅŸ bir adres yazmak gereklidir (veya yazÄ±lan adresin gerÃ§ekten hizalandÄ±ÄŸÄ± kadar sÄ±kÄ± bir ÅŸekilde ikili dosyayÄ± Ã§alÄ±ÅŸtÄ±rmak gereklidir).

### Tcache indeks saldÄ±rÄ±sÄ±

Genellikle, heap'in baÅŸlangÄ±cÄ±nda, tcache iÃ§indeki **her indeksteki parÃ§a miktarÄ±nÄ±** iÃ§eren bir parÃ§a ve **her tcache indeksinin baÅŸ parÃ§a adresini** iÃ§eren bir parÃ§a bulunabilir. Bu bilgiyi bir ÅŸekilde deÄŸiÅŸtirmek mÃ¼mkÃ¼n olursa, **bazÄ± indeksin baÅŸ parÃ§asÄ±nÄ± istenen bir adrese yÃ¶nlendirmek mÃ¼mkÃ¼n olacaktÄ±r** (`__malloc_hook` gibi) ve daha sonra bu durumda `__malloc_hook` iÃ§eriÄŸini Ã¼zerine yazmak mÃ¼mkÃ¼n olacaktÄ±r.

## Ã–rnekler

* CTF [https://guyinatuxedo.github.io/29-tcache/dcquals19\_babyheap/index.html](https://guyinatuxedo.github.io/29-tcache/dcquals19\_babyheap/index.html)
* **Libc bilgi sÄ±zÄ±ntÄ±sÄ±**: Tcache'leri doldurmak, bir parÃ§ayÄ± sÄ±ralanmamÄ±ÅŸ listeye eklemek, tcache'yi boÅŸaltmak ve ardÄ±ndan sadece ilk 8B'yi Ã¼zerine yazarak bu parÃ§ayÄ± tekrar tahsis etmek mÃ¼mkÃ¼ndÃ¼r, **parÃ§anÄ±n ikinci adresini bozulmamÄ±ÅŸ bir ÅŸekilde bÄ±rakarak, bu sayede okuyabiliriz**.
* **Tcache saldÄ±rÄ±sÄ±**: Ä°kinci bir 1B heap taÅŸmasÄ± olan bir ikili dosya zayÄ±f durumdadÄ±r. Bu, tahsis edilen bir parÃ§anÄ±n **boyut baÅŸlÄ±ÄŸÄ±nÄ±** deÄŸiÅŸtirmek iÃ§in kÃ¶tÃ¼ye kullanÄ±lacaktÄ±r. Daha sonra, bu parÃ§a **serbest bÄ±rakÄ±lacak**, sahte boyuttaki parÃ§alarÄ±n tcache'ine eklenir. ArdÄ±ndan, sahte boyuttaki bir parÃ§a tahsis edilecek ve Ã¶nceki parÃ§a **bu parÃ§anÄ±n aslÄ±nda daha kÃ¼Ã§Ã¼k olduÄŸunu bilerek geri dÃ¶necek ve bu, bellekteki bir sonraki parÃ§ayÄ± Ã¼zerine yazma fÄ±rsatÄ± verecektir**.\
Bu, **bir sonraki parÃ§anÄ±n FD iÅŸaretÃ§isini Ã¼zerine yazmak** iÃ§in kÃ¶tÃ¼ye kullanÄ±lacaktÄ±r, bÃ¶ylece deÄŸiÅŸtirilen ilk iÅŸaretÃ§i ve ardÄ±ndan ikinci tahsis, **`malloc_hook`'ta bir parÃ§a dÃ¶ndÃ¼recektir ve bu, bir **one gadget** yazmak iÃ§in kÃ¶tÃ¼ye kullanÄ±labilir.
* CTF [https://guyinatuxedo.github.io/29-tcache/plaid19\_cpp/index.html](https://guyinatuxedo.github.io/29-tcache/plaid19\_cpp/index.html)
* **Libc bilgi sÄ±zÄ±ntÄ±sÄ±**: Bir kullanÄ±mdan sonra serbest bÄ±rakma ve Ã§ift serbest bÄ±rakma vardÄ±r. Bu yazÄ±da, yazar, kÃ¼Ã§Ã¼k bir kovaya yerleÅŸtirilen bir parÃ§anÄ±n adresini okuyarak libc'in bir adresini sÄ±zdÄ±rdÄ±.
* **Tcache saldÄ±rÄ±sÄ±**: Bir **Ã§ift serbest bÄ±rakma** ile bir Tcache gerÃ§ekleÅŸtirilir. AynÄ± parÃ§a iki kez serbest bÄ±rakÄ±lÄ±r, bu nedenle Tcache iÃ§inde parÃ§a kendisine iÅŸaret eder. ArdÄ±ndan, tahsis edilir, FD iÅŸaretÃ§isi **free hook**'a yÃ¶nlendirilir ve ardÄ±ndan tekrar tahsis edilir, bÃ¶ylece listedeki bir sonraki parÃ§a free hook'ta olacaktÄ±r. ArdÄ±ndan, bu da tahsis edilir ve `system` adresi buraya yazÄ±labilir, bÃ¶ylece `"/bin/sh"` iÃ§eren bir malloc serbest bÄ±rakÄ±ldÄ±ÄŸÄ±nda bir kabuk alÄ±nabilir.
* CTF [https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps0/index.html](https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps0/index.html)
* Buradaki ana zayÄ±flÄ±k, heap'te herhangi bir adresi `free` edebilme kapasitesidir.
* **Tcache indeks saldÄ±rÄ±sÄ±**: Tcache parÃ§asÄ±nÄ±n iÃ§inde depolanan bir boyutta bir parÃ§a tahsis edip serbest bÄ±rakmak, farklÄ± baytlarda her bir kovadaki parÃ§a miktarÄ±nÄ± depoladÄ±ÄŸÄ± iÃ§in, belirli bir indekste bir parÃ§a, deÄŸeri 0x100 olan bir adres oluÅŸturacaktÄ±r.
* Sonra, bu deÄŸer 0x100 boyutunda bir parÃ§a olduÄŸu gibi gÃ¶rÃ¼nmektedir. Bu adresi `free` ile kÃ¶tÃ¼ye kullanmak mÃ¼mkÃ¼n olacaktÄ±r. Bu, o adresin 0x100 boyutundaki parÃ§a indeksine eklenmesine neden olacaktÄ±r.
* ArdÄ±ndan, boyutu **0x100** olan bir parÃ§a tahsis edildiÄŸinde, Ã¶nceki adres bir parÃ§a olarak geri dÃ¶necek ve diÄŸer tcache indekslerini Ã¼zerine yazma olanaÄŸÄ± saÄŸlayacaktÄ±r.\
Ã–rneÄŸin, malloc hook adresini birine koyarak ve o indeksin boyutunda bir parÃ§a tahsis ederek calloc hook'ta bir parÃ§a alÄ±nabilir, bu da bir one gadget yazmak iÃ§in kÃ¶tÃ¼ye kullanÄ±labilir.
* CTF [https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps1/index.html](https://guyinatuxedo.github.io/44-more\_tcache/csaw19\_popping\_caps1/index.html)
* Bir Ã¶ncekiyle aynÄ± zayÄ±flÄ±k ve bir ek kÄ±sÄ±tlama
* **Tcache indeks saldÄ±rÄ±sÄ±**: Bir Ã¶nceki saldÄ±rÄ±ya benzer saldÄ±rÄ± ancak **tcache bilgilerini iÃ§eren parÃ§ayÄ± serbest bÄ±rakarak** daha az adÄ±mda gerÃ§ekleÅŸtirilir, bu nedenle boyutuna gÃ¶re tcache indeksine adresi eklenir ve bu boyutta tahsis edilebilir ve tcache parÃ§a bilgileri bir parÃ§a olarak alÄ±nabilir, bu da bir indeksin adresini free hook olarak eklemeyi, tahsis etmeyi ve Ã¼zerine bir one gadget yazmayÄ± mÃ¼mkÃ¼n kÄ±lar.
* [**Math Door. HTB Cyber Apocalypse CTF 2023**](https://7rocky.github.io/en/ctf/other/htb-cyber-apocalypse/math-door/)
* `fd` iÅŸaretÃ§isine bir sayÄ± eklemek iÃ§in **Write After Free**.
* Bu zorlukta birÃ§ok **heap feng-shui** gereklidir. YazÄ±, **Tcache serbest listesinin baÅŸÄ±nÄ± kontrol etmenin oldukÃ§a kullanÄ±ÅŸlÄ± olduÄŸunu** gÃ¶stermektedir.
* `stdout` Ã¼zerinden **Glibc sÄ±zÄ±ntÄ±sÄ±** (FSOP).
* **Tcache zehirlenmesi** ile keyfi yazma yetkisi elde etmek.
* **ğŸ’¬ [**Discord grubuna** katÄ±lÄ±n](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** adresinden takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.**
