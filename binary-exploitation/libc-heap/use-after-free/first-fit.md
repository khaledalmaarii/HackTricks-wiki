# Ä°lk Uygun

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

## **Ä°lk Uygun**

Bir programda glibc kullanarak belleÄŸi serbest bÄ±raktÄ±ÄŸÄ±nÄ±zda, bellek parÃ§alarÄ±nÄ± yÃ¶netmek iÃ§in farklÄ± "kutular" kullanÄ±lÄ±r. Ä°ki yaygÄ±n senaryonun basitleÅŸtirilmiÅŸ bir aÃ§Ä±klamasÄ± ÅŸunlardÄ±r: sÄ±ralanmamÄ±ÅŸ kutular ve hÄ±zlÄ± kutular.

### SÄ±ralanmamÄ±ÅŸ Kutular

HÄ±zlÄ± bir parÃ§a olmayan bir bellek parÃ§asÄ±nÄ± serbest bÄ±raktÄ±ÄŸÄ±nÄ±zda, bu parÃ§a sÄ±ralanmamÄ±ÅŸ kutuya gider. Bu kutu, yeni serbest bÄ±rakÄ±lan parÃ§alarÄ±n Ã¶nÃ¼ne (baÅŸa) eklenen bir liste gibi davranÄ±r. Yeni bir bellek parÃ§asÄ± istediÄŸinizde, tahsisatÃ§Ä±, istediÄŸinizden yeterince bÃ¼yÃ¼k bir parÃ§a bulmak iÃ§in sÄ±ralanmamÄ±ÅŸ kutuya arkadan (kuyruk) bakar. EÄŸer sÄ±ralanmamÄ±ÅŸ kutudan bir parÃ§a istediÄŸinizden bÃ¼yÃ¼kse, bÃ¶lÃ¼nÃ¼r; Ã¶n kÄ±smÄ± geri dÃ¶ndÃ¼rÃ¼lÃ¼r ve geri kalan kÄ±sÄ±m kutuda kalÄ±r.

Ã–rnek:

* 300 bayt (`a`) tahsis edersiniz, ardÄ±ndan 250 bayt (`b`) tahsis edersiniz, `a`yÄ± serbest bÄ±rakÄ±rsÄ±nÄ±z ve tekrar 250 bayt (`c`) istersiniz.
* `a`yÄ± serbest bÄ±raktÄ±ÄŸÄ±nÄ±zda, sÄ±ralanmamÄ±ÅŸ kutuya gider.
* Sonra 250 bayt daha isterseniz, tahsisatÃ§Ä± `a`yÄ± kuyrukta bulur ve bÃ¶lerek, isteÄŸinize uygun olan kÄ±smÄ± geri dÃ¶ndÃ¼rÃ¼r ve geri kalanÄ± kutuda tutar.
* `c`, Ã¶nceki `a`ya iÅŸaret edecek ve `a`'larÄ±n iÃ§eriÄŸiyle dolacaktÄ±r.
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Fastbins, kÃ¼Ã§Ã¼k bellek parÃ§alarÄ± iÃ§in kullanÄ±lÄ±r. SÄ±ralanmamÄ±ÅŸ kovalarÄ±n aksine, fastbins yeni parÃ§alarÄ± baÅŸa ekler ve son giren-ilk Ã§Ä±kan (LIFO) davranÄ±ÅŸÄ± oluÅŸturur. EÄŸer kÃ¼Ã§Ã¼k bir bellek parÃ§asÄ± isterseniz, ayÄ±rÄ±cÄ± fastbin'in baÅŸÄ±ndan alacaktÄ±r.

Ã–rnek:

* 20 baytlÄ±k dÃ¶rt parÃ§a ayÄ±rÄ±rsÄ±nÄ±z (`a`, `b`, `c`, `d`).
* OnlarÄ± herhangi bir sÄ±rayla serbest bÄ±raktÄ±ÄŸÄ±nÄ±zda, serbest bÄ±rakÄ±lan parÃ§alar fastbin'in baÅŸÄ±na eklenir.
* Sonra 20 baytlÄ±k bir parÃ§a isterseniz, ayÄ±rÄ±cÄ± en son serbest bÄ±rakÄ±lan parÃ§ayÄ± fastbin'in baÅŸÄ±ndan dÃ¶ndÃ¼recektir.
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
## DiÄŸer Referanslar ve Ã–rnekler

* [**https://heap-exploitation.dhavalkapil.com/attacks/first\_fit**](https://heap-exploitation.dhavalkapil.com/attacks/first\_fit)
* [**https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/**](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
* ARM64. Use after free: Bir kullanÄ±cÄ± nesnesi oluÅŸtur, serbest bÄ±rak, serbest bÄ±rakÄ±lan parÃ§ayÄ± alan bir nesne oluÅŸtur ve ona yazma izni ver, **Ã¶ncekinin konumunu kullanÄ±cÄ±->ÅŸifre ile deÄŸiÅŸtir**. KullanÄ±cÄ±yÄ± **ÅŸifre kontrolÃ¼nÃ¼ atlamak** iÃ§in yeniden kullan.
* [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/use\_after\_free/#example**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/use\_after\_free/#example)
* Program notlar oluÅŸturmaya izin verir. Bir not, not bilgisini iÃ§eren malloc(8) (Ã§aÄŸrÄ±labilen bir iÅŸlevin iÅŸaretÃ§isi ile) ve notun iÃ§eriÄŸini iÃ§eren baÅŸka bir malloc(\<boyut>) iÅŸaretÃ§isine sahip olacak.
* SaldÄ±rÄ±, not bilgi boyutundan daha bÃ¼yÃ¼k malloc iÃ§eriÄŸine sahip 2 not (not0 ve not1) oluÅŸturmak ve ardÄ±ndan bunlarÄ± serbest bÄ±rakarak hÄ±zlÄ± bin (veya tcache) iÃ§ine almaktÄ±r.
* Sonra, iÃ§erik boyutu 8 olan baÅŸka bir not (not2) oluÅŸturun. Ä°Ã§erik, parÃ§anÄ±n yeniden kullanÄ±lacaÄŸÄ± not1'de olacak, iÅŸlev iÅŸaretÃ§isini win iÅŸlevine yÃ¶nlendirebilir ve ardÄ±ndan not1'i Use-After-Free yaparak yeni iÅŸlev iÅŸaretÃ§isini Ã§aÄŸÄ±rabiliriz.
* [**https://guyinatuxedo.github.io/26-heap\_grooming/pico\_areyouroot/index.html**](https://guyinatuxedo.github.io/26-heap\_grooming/pico\_areyouroot/index.html)
* BazÄ± bellek ayÄ±rmak, istenen deÄŸeri yazmak, serbest bÄ±rakmak, yeniden boyutlandÄ±rmak mÃ¼mkÃ¼ndÃ¼r ve Ã¶nceki veriler hala orada olduÄŸundan, parÃ§adaki yeni beklenen yapÄ±ya gÃ¶re iÅŸlenecektir, bÃ¶ylece deÄŸeri ayarlamak veya bayraÄŸÄ± almak mÃ¼mkÃ¼n olacaktÄ±r.
* [**https://guyinatuxedo.github.io/26-heap\_grooming/swamp19\_heapgolf/index.html**](https://guyinatuxedo.github.io/26-heap\_grooming/swamp19\_heapgolf/index.html)
* Bu durumda, belirli bir parÃ§anÄ±n iÃ§ine 4 yazmak gereklidir, bu ilk ayrÄ±lan parÃ§adÄ±r (hepsini zorla serbest bÄ±raktÄ±ktan sonra bile). Her yeni ayrÄ±lan parÃ§ada, dizin iÃ§indeki numarasÄ± saklanÄ±r. Sonra, 4 parÃ§a (+ baÅŸlangÄ±Ã§ta ayrÄ±lan) tahsis edin, sonuncusu iÃ§inde 4 olacak, onlarÄ± serbest bÄ±rakÄ±n ve ilk parÃ§anÄ±n yeniden tahsisini zorlayÄ±n, bu da iÃ§inde 4 olan son parÃ§ayÄ± kullanacaktÄ±r.
