# Ä°lk Uygun

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## **Ä°lk Uygun**

Glibc kullanarak bir programda belleÄŸi serbest bÄ±raktÄ±ÄŸÄ±nÄ±zda, bellek parÃ§alarÄ±nÄ± yÃ¶netmek iÃ§in farklÄ± "kutular" kullanÄ±lÄ±r. Ä°ÅŸte iki yaygÄ±n senaryonun basitleÅŸtirilmiÅŸ bir aÃ§Ä±klamasÄ±: sÄ±ralanmamÄ±ÅŸ kutular ve hÄ±zlÄ± kutular.

### SÄ±ralanmamÄ±ÅŸ Kutular

HÄ±zlÄ± bir parÃ§a olmayan bir bellek parÃ§asÄ±nÄ± serbest bÄ±raktÄ±ÄŸÄ±nÄ±zda, bu parÃ§a sÄ±ralanmamÄ±ÅŸ kutuya gider. Bu kutu, yeni serbest bÄ±rakÄ±lan parÃ§alarÄ±n Ã¶nÃ¼ne (baÅŸa) eklendiÄŸi bir liste gibi davranÄ±r. Yeni bir bellek parÃ§asÄ± istediÄŸinizde, tahsisatÃ§Ä±, isteÄŸiniz iÃ§in yeterince bÃ¼yÃ¼k bir parÃ§a bulmak iÃ§in sÄ±ralanmamÄ±ÅŸ kutuya arkadan (kuyruk) bakar. EÄŸer sÄ±ralanmamÄ±ÅŸ kutudan bir parÃ§a ihtiyacÄ±nÄ±zdan bÃ¼yÃ¼kse, bÃ¶lÃ¼nÃ¼r; Ã¶n kÄ±smÄ± geri dÃ¶ndÃ¼rÃ¼lÃ¼r ve geri kalan kÄ±sÄ±m kutuda kalÄ±r.

Ã–rnek:

* 300 bayt (`a`) tahsis edersiniz, ardÄ±ndan 250 bayt (`b`) tahsis edersiniz, `a`'yÄ± serbest bÄ±rakÄ±rsÄ±nÄ±z ve tekrar 250 bayt (`c`) istersiniz.
* `a`'yÄ± serbest bÄ±raktÄ±ÄŸÄ±nÄ±zda, sÄ±ralanmamÄ±ÅŸ kutuya gider.
* Sonra tekrar 250 bayt isterseniz, tahsisatÃ§Ä± `a`'yÄ± kuyrukta bulur ve bÃ¶lerek, isteÄŸinize uygun olan kÄ±smÄ± geri dÃ¶ndÃ¼rÃ¼r ve geri kalanÄ± kutuda tutar.
* `c`, Ã¶nceki `a`'ya iÅŸaret edecek ve `a`'larÄ±n iÃ§eriÄŸiyle dolacaktÄ±r.
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Fastbins kÃ¼Ã§Ã¼k bellek parÃ§alarÄ± iÃ§in kullanÄ±lÄ±r. SÄ±ralanmamÄ±ÅŸ kovalarÄ±n aksine, fastbins yeni parÃ§alarÄ± baÅŸa ekler ve son giren-ilk Ã§Ä±kan (LIFO) davranÄ±ÅŸÄ±nÄ± oluÅŸturur. EÄŸer kÃ¼Ã§Ã¼k bir bellek parÃ§asÄ± isterseniz, ayÄ±rÄ±cÄ± fastbin'in baÅŸÄ±ndan alacaktÄ±r.

Ã–rnek:

* 20 baytlÄ±k dÃ¶rt parÃ§a (`a`, `b`, `c`, `d`) ayÄ±rÄ±rsÄ±nÄ±z.
* OnlarÄ± herhangi bir sÄ±rayla serbest bÄ±raktÄ±ÄŸÄ±nÄ±zda, serbest bÄ±rakÄ±lan parÃ§alar fastbin'in baÅŸÄ±na eklenir.
* Sonra 20 baytlÄ±k bir parÃ§a isterseniz, ayÄ±rÄ±cÄ± en son serbest bÄ±rakÄ±lan parÃ§ayÄ± fastbin'in baÅŸÄ±ndan dÃ¶ndÃ¼recektir.
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
## DiÄŸer Referanslar ve Ã–rnekler

* [**https://heap-exploitation.dhavalkapil.com/attacks/first\_fit**](https://heap-exploitation.dhavalkapil.com/attacks/first\_fit)
* [**https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/**](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
* ARM64. Use after free: Bir kullanÄ±cÄ± nesnesi oluÅŸtur, serbest bÄ±rak, serbest bÄ±rakÄ±lan parÃ§ayÄ± alan bir nesne oluÅŸtur ve ona yazma izni ver, **Ã¶ncekinin konumunu kullanÄ±cÄ±->ÅŸifre ile deÄŸiÅŸtir**. KullanÄ±cÄ±yÄ± tekrar kullanarak **ÅŸifre kontrolÃ¼nÃ¼ atla**
* [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/use\_after\_free/#example**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/use\_after\_free/#example)
* Program notlar oluÅŸturmaya izin verir. Bir not, malloc(8) iÃ§inde not bilgisine (Ã§aÄŸrÄ±labilecek bir iÅŸlev iÅŸaretÃ§isi ile) ve notun iÃ§eriÄŸine sahip baÅŸka bir malloc(\<boyut>) iÅŸaretÃ§isine sahip olacaktÄ±r.
* SaldÄ±rÄ±, not bilgi boyutundan daha bÃ¼yÃ¼k malloc iÃ§eriÄŸine sahip 2 not (not0 ve not1) oluÅŸturmak ve ardÄ±ndan bunlarÄ± serbest bÄ±rakarak hÄ±zlÄ± bin (veya tcache) iÃ§ine almaktÄ±r.
* Sonra, iÃ§erik boyutu 8 olan baÅŸka bir not (not2) oluÅŸturun. Ä°Ã§erik, not1'de olacak Ã§Ã¼nkÃ¼ parÃ§a yeniden kullanÄ±lacak, iÅŸlev iÅŸaretÃ§isini win iÅŸlevine iÅŸaret etmesi iÃ§in deÄŸiÅŸtirebileceÄŸimiz yer ve ardÄ±ndan not1'i Use-After-Free yaparak yeni iÅŸlev iÅŸaretÃ§isini Ã§aÄŸÄ±rmak.
* [**https://guyinatuxedo.github.io/26-heap\_grooming/pico\_areyouroot/index.html**](https://guyinatuxedo.github.io/26-heap\_grooming/pico\_areyouroot/index.html)
* BazÄ± bellek ayÄ±rmak, istenen deÄŸeri yazmak, serbest bÄ±rakmak, yeniden boyutlandÄ±rmak mÃ¼mkÃ¼ndÃ¼r ve Ã¶nceki veriler hala orada olduÄŸundan, parÃ§adaki yeni beklenen yapÄ±ya gÃ¶re iÅŸlem gÃ¶recektir, bÃ¶ylece deÄŸeri ayarlamak veya bayraÄŸÄ± almak mÃ¼mkÃ¼n olacaktÄ±r.
* [**https://guyinatuxedo.github.io/26-heap\_grooming/swamp19\_heapgolf/index.html**](https://guyinatuxedo.github.io/26-heap\_grooming/swamp19\_heapgolf/index.html)
* Bu durumda, belirli bir parÃ§anÄ±n iÃ§ine 4 yazmak gereklidir, bu ilk ayrÄ±lan parÃ§adÄ±r (hepsini zorla serbest bÄ±raktÄ±ktan sonra bile). Her yeni ayrÄ±lan parÃ§ada, dizin iÃ§indeki numarasÄ± saklanÄ±r. Sonra, 4 parÃ§a (+ baÅŸlangÄ±Ã§ta ayrÄ±lan) tahsis edin, sonuncusu iÃ§inde 4 olacak ÅŸekilde, onlarÄ± serbest bÄ±rakÄ±n ve ilk parÃ§anÄ±n yeniden tahsisini zorlayÄ±n, bu da iÃ§inde 4 olan son serbest bÄ±rakÄ±lan parÃ§ayÄ± kullanacaktÄ±r.
