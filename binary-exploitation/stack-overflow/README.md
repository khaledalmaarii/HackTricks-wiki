# Stack Overflow

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini edinin**](https://peass.creator-spring.com)
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## Stack Overflow Nedir

Bir **stack overflow** (yÄ±ÄŸÄ±n taÅŸmasÄ±), bir programÄ±n yÄ±ÄŸÄ±na ayrÄ±lan alanÄ±n kapasitesinden fazla veri yazdÄ±ÄŸÄ± bir gÃ¼venlik aÃ§Ä±ÄŸÄ±dÄ±r. Bu fazla veri, **bitiÅŸik bellek alanÄ±nÄ± Ã¼zerine yazacak**, geÃ§erli verilerin bozulmasÄ±na, kontrol akÄ±ÅŸÄ±nÄ±n bozulmasÄ±na ve potansiyel olarak kÃ¶tÃ¼ amaÃ§lÄ± kodun yÃ¼rÃ¼tÃ¼lmesine neden olacaktÄ±r. Bu sorun genellikle, giriÅŸ Ã¼zerinde sÄ±nÄ±rlar kontrolÃ¼ yapmayan gÃ¼vensiz iÅŸlevlerin kullanÄ±lmasÄ±ndan kaynaklanÄ±r.

Bu Ã¼zerine yazma iÅŸleminin ana sorunu, **kaydedilmiÅŸ komut iÅŸaretÃ§isi (EIP/RIP)** ve **kaydedilmiÅŸ taban iÅŸaretÃ§isi (EBP/RBP)**'nin Ã¶nceki iÅŸleve geri dÃ¶nÃ¼ÅŸ iÃ§in **yÄ±ÄŸÄ±nda depolanmasÄ±dÄ±r**. Bu nedenle, bir saldÄ±rgan bunlarÄ± Ã¼zerine yazabilir ve programÄ±n **yÃ¼rÃ¼tme akÄ±ÅŸÄ±nÄ± kontrol edebilir**.

Bu zafiyet genellikle bir iÅŸlevin **yÄ±ÄŸÄ±na ayrÄ±lan miktarÄ±ndan daha fazla bayt kopyaladÄ±ÄŸÄ±** iÃ§in ortaya Ã§Ä±kar, bu nedenle yÄ±ÄŸÄ±nÄ±n diÄŸer kÄ±sÄ±mlarÄ±nÄ± Ã¼zerine yazabilir.

Bu zafiyete duyarlÄ± olan bazÄ± yaygÄ±n iÅŸlevler: **`strcpy`, `strcat`, `sprintf`, `gets`**... AyrÄ±ca, bir **uzunluk argÃ¼manÄ± alan** **`fgets`**, **`read` & `memcpy`** gibi iÅŸlevler, belirtilen uzunluÄŸun ayrÄ±lan uzunluktan bÃ¼yÃ¼k olduÄŸu durumlarda zafiyetli bir ÅŸekilde kullanÄ±labilir.

Ã–rneÄŸin, aÅŸaÄŸÄ±daki iÅŸlevler zafiyete aÃ§Ä±k olabilir:
```c
void vulnerable() {
char buffer[128];
printf("Enter some text: ");
gets(buffer); // This is where the vulnerability lies
printf("You entered: %s\n", buffer);
}
```
### Stack Overflow Ofsetlerini Bulma

YÄ±ÄŸÄ±n taÅŸmalarÄ±nÄ± bulmanÄ±n en yaygÄ±n yolu, Ã§ok bÃ¼yÃ¼k bir `A` giriÅŸi vermek (Ã¶rneÄŸin `python3 -c 'print("A"*1000)'`) ve **eriÅŸilmeye Ã§alÄ±ÅŸÄ±lan adresin `0x41414141` olduÄŸunu gÃ¶steren** bir `Segmentation Fault` beklemektir.

AyrÄ±ca, YÄ±ÄŸÄ±n TaÅŸma aÃ§Ä±ÄŸÄ± bulduÄŸunuzda, genellikle bir **De Bruijn dizisi** kullanÄ±lÄ±r. Bu, _k_ boyutunda bir alfabeye ve _n_ uzunluÄŸundaki alt dizilere sahip bir dizi olup, **her olasÄ± _n_ uzunluÄŸundaki alt dizinin tam olarak bir kez** ardÄ±ÅŸÄ±k bir alt dizi olarak gÃ¶rÃ¼ndÃ¼ÄŸÃ¼ dÃ¶ngÃ¼sel bir dizidir.

Bu ÅŸekilde, EIP'yi kontrol etmek iÃ§in hangi ofsetin gerektiÄŸini el ile bulmak yerine, bu dizilerden birini dolgu olarak kullanmak ve ardÄ±ndan Ã¼zerine yazÄ±lan baytlarÄ±n ofsetini bulmak mÃ¼mkÃ¼ndÃ¼r.

Bunun iÃ§in genellikle **pwntools** kullanÄ±labilir:
```python
from pwn import *

# Generate a De Bruijn sequence of length 1000 with an alphabet size of 256 (byte values)
pattern = cyclic(1000)

# This is an example value that you'd have found in the EIP/IP register upon crash
eip_value = p32(0x6161616c)
offset = cyclic_find(eip_value)  # Finds the offset of the sequence in the De Bruijn pattern
print(f"The offset is: {offset}")
```
veya **GEF**:
```bash
#Patterns
pattern create 200 #Generate length 200 pattern
pattern search "avaaawaa" #Search for the offset of that substring
pattern search $rsp #Search the offset given the content of $rsp
```
## YÄ±ÄŸÄ±n TaÅŸmalarÄ±nÄ± SÃ¶mÃ¼rme

TaÅŸma sÄ±rasÄ±nda (taÅŸma boyutu yeterince bÃ¼yÃ¼kse) yÄ±ÄŸÄ±n iÃ§indeki yerel deÄŸiÅŸkenlerin deÄŸerlerini **Ã¼zerine yazabilirsiniz** ve kaydedilmiÅŸ **EBP/RBP ve EIP/RIP'yi (hatta daha fazlasÄ±nÄ±)** bulana kadar.\
Bu tÃ¼r bir zafiyeti istismar etmenin en yaygÄ±n yolu, **dÃ¶nÃ¼ÅŸ adresini deÄŸiÅŸtirmektir**, bÃ¶ylece iÅŸlev bittiÄŸinde **kontrol akÄ±ÅŸÄ± kullanÄ±cÄ±nÄ±n belirttiÄŸi yere yÃ¶nlendirilir**.

Ancak, diÄŸer senaryolarda belki sadece **yÄ±ÄŸÄ±nda bazÄ± deÄŸiÅŸken deÄŸerlerini Ã¼zerine yazmak** yeterli olabilir (kolay CTF zorluklarÄ±nda olduÄŸu gibi).

### Ret2win

Bu tÃ¼r CTF zorluklarÄ±nda, **asla Ã§aÄŸrÄ±lmayan** bir **iÅŸlev** **iÃ§inde** bulunan ve **Ã§aÄŸrÄ±lmasÄ± gereken bir iÅŸlev** bulunmaktadÄ±r. Bu zorluklarda sadece **dÃ¶nÃ¼ÅŸ adresini Ã¼zerine yazmak iÃ§in ofseti bulmanÄ±z** ve Ã§aÄŸrÄ±lacak iÅŸlevin adresini bulmanÄ±z yeterlidir (genellikle [**ASLR**](../common-binary-protections-and-bypasses/aslr/) devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸ olacaktÄ±r), bu sayede zafiyetli iÅŸlev dÃ¶ndÃ¼ÄŸÃ¼nde gizli iÅŸlev Ã§aÄŸrÄ±lacaktÄ±r:

{% content-ref url="ret2win/" %}
[ret2win](ret2win/)
{% endcontent-ref %}

### YÄ±ÄŸÄ±n Kabuk Kodu

Bu senaryoda saldÄ±rgan, yÄ±ÄŸÄ±nda bir kabuk kodu yerleÅŸtirebilir ve kontrol edilen EIP/RIP'yi kÃ¶tÃ¼ amaÃ§lÄ± kodu Ã§alÄ±ÅŸtÄ±rmak iÃ§in kabuk kodusuna atlamak iÃ§in kullanabilir:

{% content-ref url="stack-shellcode/" %}
[stack-shellcode](stack-shellcode/)
{% endcontent-ref %}

### ROP ve Ret2... teknikleri

Bu teknik, Ã¶nceki tekniÄŸe baÅŸlÄ±ca korumayÄ± atlamak iÃ§in temel Ã§erÃ§evedir: **YÃ¼rÃ¼tÃ¼lebilir yÄ±ÄŸÄ±n yok (NX)**. Ve ikili dosyadaki mevcut talimatlarÄ± kÃ¶tÃ¼ye kullanarak keyfi komutlarÄ± Ã§alÄ±ÅŸtÄ±rmayÄ± saÄŸlayan diÄŸer teknikleri gerÃ§ekleÅŸtirmenize olanak tanÄ±r (ret2lib, ret2syscall...):

{% content-ref url="../rop-return-oriented-programing/" %}
[rop-return-oriented-programing](../rop-return-oriented-programing/)
{% endcontent-ref %}

## YÄ±ÄŸÄ±n TaÅŸmalarÄ±

Bir taÅŸma her zaman yÄ±ÄŸÄ±nda olmayabilir, Ã¶rneÄŸin **yÄ±ÄŸÄ±n** iÃ§inde de olabilir:

{% content-ref url="../libc-heap/heap-overflow.md" %}
[heap-overflow.md](../libc-heap/heap-overflow.md)
{% endcontent-ref %}

## Koruma TÃ¼rleri

Zafiyetlerin istismarÄ±nÄ± Ã¶nlemeye Ã§alÄ±ÅŸan Ã§eÅŸitli korumalar bulunmaktadÄ±r, bunlarÄ± kontrol edin:

{% content-ref url="../common-binary-protections-and-bypasses/" %}
[common-binary-protections-and-bypasses](../common-binary-protections-and-bypasses/)
{% endcontent-ref %}
