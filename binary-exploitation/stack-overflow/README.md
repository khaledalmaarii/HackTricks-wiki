# Stack Overflow

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## What is a Stack Overflow

Bir **stack overflow**, bir programÄ±n yÄ±ÄŸÄ±n (stack) iÃ§in ayrÄ±lan alandan daha fazla veri yazmasÄ± durumunda meydana gelen bir gÃ¼venlik aÃ§Ä±ÄŸÄ±dÄ±r. Bu fazla veri, **komÅŸu bellek alanÄ±nÄ±** **Ã¼st Ã¼ste yazarak**, geÃ§erli verilerin bozulmasÄ±na, kontrol akÄ±ÅŸÄ±nÄ±n kesilmesine ve potansiyel olarak kÃ¶tÃ¼ niyetli kodun Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±na yol aÃ§ar. Bu sorun genellikle, girdi Ã¼zerinde sÄ±nÄ±r kontrolÃ¼ yapmayan gÃ¼vensiz fonksiyonlarÄ±n kullanÄ±lmasÄ±ndan kaynaklanÄ±r.

Bu Ã¼st yazmanÄ±n ana sorunu, **kaydedilmiÅŸ talimat iÅŸaretÃ§isi (EIP/RIP)** ve Ã¶nceki fonksiyona dÃ¶nmek iÃ§in **kaydedilmiÅŸ temel iÅŸaretÃ§i (EBP/RBP)**'nin **yÄ±ÄŸÄ±n Ã¼zerinde saklanmasÄ±dÄ±r**. Bu nedenle, bir saldÄ±rgan bunlarÄ± Ã¼st Ã¼ste yazarak **programÄ±n yÃ¼rÃ¼tme akÄ±ÅŸÄ±nÄ± kontrol edebilir**.

GÃ¼venlik aÃ§Ä±ÄŸÄ± genellikle bir fonksiyonun **yÄ±ÄŸÄ±nÄ±n iÃ§ine ayrÄ±lan miktardan daha fazla bayt kopyalamasÄ±** nedeniyle ortaya Ã§Ä±kar, bu nedenle yÄ±ÄŸÄ±nÄ±n diÄŸer kÄ±sÄ±mlarÄ±nÄ± Ã¼st Ã¼ste yazma yeteneÄŸine sahip olur.

Buna karÅŸÄ± hassas olan bazÄ± yaygÄ±n fonksiyonlar: **`strcpy`, `strcat`, `sprintf`, `gets`**... AyrÄ±ca, belirtilen uzunluk ayrÄ±lan uzunluktan bÃ¼yÃ¼kse, **`fgets`**, **`read` & `memcpy`** gibi **uzunluk argÃ¼manÄ±** alan fonksiyonlar da savunmasÄ±z bir ÅŸekilde kullanÄ±labilir.

Ã–rneÄŸin, aÅŸaÄŸÄ±daki fonksiyonlar savunmasÄ±z olabilir:
```c
void vulnerable() {
char buffer[128];
printf("Enter some text: ");
gets(buffer); // This is where the vulnerability lies
printf("You entered: %s\n", buffer);
}
```
### Stack Overflow ofsetlerini Bulma

Stack overflow'larÄ± bulmanÄ±n en yaygÄ±n yolu, Ã§ok bÃ¼yÃ¼k bir `A` giriÅŸi vermektir (Ã¶rneÄŸin, `python3 -c 'print("A"*1000)'`) ve **`0x41414141` adresinin eriÅŸilmeye Ã§alÄ±ÅŸÄ±ldÄ±ÄŸÄ±nÄ±** belirten bir `Segmentation Fault` beklemektir.

AyrÄ±ca, Stack Overflow zafiyetini bulduktan sonra, **geri dÃ¶nÃ¼ÅŸ adresini** yazmak iÃ§in gereken ofseti bulmanÄ±z gerekecek, bunun iÃ§in genellikle bir **De Bruijn dizisi** kullanÄ±lÄ±r. Verilen bir _k_ boyutundaki alfabede ve _n_ uzunluÄŸundaki alt diziler iÃ§in, bu, **her olasÄ± \_n**\_\*\* uzunluÄŸundaki alt dizinin tam olarak bir kez** bitiÅŸik bir alt dizi olarak gÃ¶rÃ¼ndÃ¼ÄŸÃ¼ **dÃ¶ngÃ¼sel bir dizidir**.

Bu ÅŸekilde, EIP'yi kontrol etmek iÃ§in hangi ofsetin gerektiÄŸini elle bulmak yerine, bu dizilerden birini dolgu olarak kullanmak ve ardÄ±ndan onu yazmayÄ± bitiren baytlarÄ±n ofsetini bulmak mÃ¼mkÃ¼ndÃ¼r.

Bunun iÃ§in **pwntools** kullanmak mÃ¼mkÃ¼ndÃ¼r:
```python
from pwn import *

# Generate a De Bruijn sequence of length 1000 with an alphabet size of 256 (byte values)
pattern = cyclic(1000)

# This is an example value that you'd have found in the EIP/IP register upon crash
eip_value = p32(0x6161616c)
offset = cyclic_find(eip_value)  # Finds the offset of the sequence in the De Bruijn pattern
print(f"The offset is: {offset}")
```
veya **GEF**:
```bash
#Patterns
pattern create 200 #Generate length 200 pattern
pattern search "avaaawaa" #Search for the offset of that substring
pattern search $rsp #Search the offset given the content of $rsp
```
## YÄ±ÄŸÄ±n TaÅŸmalarÄ±nÄ± SÃ¶mÃ¼rme

Bir taÅŸma sÄ±rasÄ±nda (taÅŸma boyutunun yeterince bÃ¼yÃ¼k olduÄŸunu varsayarsak) yÄ±ÄŸÄ±n iÃ§indeki yerel deÄŸiÅŸkenlerin **deÄŸerlerini** **Ã¼st Ã¼ste yazma** imkanÄ±na sahip olacaksÄ±nÄ±z, bu da kaydedilmiÅŸ **EBP/RBP ve EIP/RIP'ye (veya daha fazlasÄ±na)** ulaÅŸana kadar devam eder.\
Bu tÃ¼r bir gÃ¼venlik aÃ§Ä±ÄŸÄ±nÄ± istismar etmenin en yaygÄ±n yolu, **dÃ¶nÃ¼ÅŸ adresini deÄŸiÅŸtirmektir**, bÃ¶ylece fonksiyon sona erdiÄŸinde **kontrol akÄ±ÅŸÄ±, kullanÄ±cÄ±nÄ±n bu iÅŸaretÃ§ide belirttiÄŸi yere yÃ¶nlendirilecektir**.

Ancak, diÄŸer senaryolarda sadece **yÄ±ÄŸÄ±ndaki bazÄ± deÄŸiÅŸken deÄŸerlerini Ã¼st Ã¼ste yazmak** istismar iÃ§in yeterli olabilir (kolay CTF zorluklarÄ±nda olduÄŸu gibi).

### Ret2win

Bu tÃ¼r CTF zorluklarÄ±nda, **asla Ã§aÄŸrÄ±lmayan** ve **kazanmak iÃ§in Ã§aÄŸÄ±rmanÄ±z gereken** bir **fonksiyon** **binary** iÃ§inde bulunmaktadÄ±r. Bu zorluklar iÃ§in sadece **dÃ¶nÃ¼ÅŸ adresini Ã¼st Ã¼ste yazmak iÃ§in ofseti bulmanÄ±z** ve **Ã§aÄŸÄ±rÄ±lacak fonksiyonun adresini bulmanÄ±z** gerekir (genellikle [**ASLR**](../common-binary-protections-and-bypasses/aslr/) devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸ olacaktÄ±r) bÃ¶ylece savunmasÄ±z fonksiyon dÃ¶ndÃ¼ÄŸÃ¼nde, gizli fonksiyon Ã§aÄŸrÄ±lacaktÄ±r:

{% content-ref url="ret2win/" %}
[ret2win](ret2win/)
{% endcontent-ref %}

### YÄ±ÄŸÄ±n Shellcode

Bu senaryoda, saldÄ±rgan yÄ±ÄŸÄ±nda bir shellcode yerleÅŸtirebilir ve kontrol edilen EIP/RIP'i kullanarak shellcode'a atlayÄ±p rastgele kod Ã§alÄ±ÅŸtÄ±rabilir:

{% content-ref url="stack-shellcode/" %}
[stack-shellcode](stack-shellcode/)
{% endcontent-ref %}

### ROP & Ret2... teknikleri

Bu teknik, Ã¶nceki tekniÄŸin ana korumasÄ±nÄ± aÅŸmak iÃ§in temel bir Ã§erÃ§evedir: **Ã‡alÄ±ÅŸtÄ±rÄ±lamaz yÄ±ÄŸÄ±n (NX)**. Ve mevcut talimatlarÄ± istismar ederek rastgele komutlar Ã§alÄ±ÅŸtÄ±racak diÄŸer birkaÃ§ tekniÄŸi (ret2lib, ret2syscall...) gerÃ§ekleÅŸtirmeye olanak tanÄ±r:

{% content-ref url="../rop-return-oriented-programing/" %}
[rop-return-oriented-programing](../rop-return-oriented-programing/)
{% endcontent-ref %}

## YÄ±ÄŸÄ±n TaÅŸmalarÄ±

Bir taÅŸma her zaman yÄ±ÄŸÄ±nda olmayacak, Ã¶rneÄŸin **yÄ±ÄŸÄ±n** iÃ§inde de olabilir:

{% content-ref url="../libc-heap/heap-overflow.md" %}
[heap-overflow.md](../libc-heap/heap-overflow.md)
{% endcontent-ref %}

## Koruma TÃ¼rleri

GÃ¼venlik aÃ§Ä±klarÄ±nÄ±n istismarÄ±nÄ± Ã¶nlemeye Ã§alÄ±ÅŸan Ã§eÅŸitli korumalar vardÄ±r, bunlarÄ± kontrol edin:

{% content-ref url="../common-binary-protections-and-bypasses/" %}
[common-binary-protections-and-bypasses](../common-binary-protections-and-bypasses/)
{% endcontent-ref %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
