# Stack Overflow

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## ä»€ä¹ˆæ˜¯æ ˆæº¢å‡º

**æ ˆæº¢å‡º**æ˜¯ä¸€ç§æ¼æ´ï¼Œå½“ç¨‹åºå‘æ ˆä¸­å†™å…¥çš„æ•°æ®è¶…è¿‡å…¶åˆ†é…çš„å®¹é‡æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚è¿™äº›å¤šä½™çš„æ•°æ®å°†**è¦†ç›–ç›¸é‚»çš„å†…å­˜ç©ºé—´**ï¼Œå¯¼è‡´æœ‰æ•ˆæ•°æ®çš„æŸåã€æ§åˆ¶æµçš„ä¸­æ–­ï¼Œä»¥åŠæ½œåœ¨çš„æ¶æ„ä»£ç æ‰§è¡Œã€‚è¿™ä¸ªé—®é¢˜é€šå¸¸æ˜¯ç”±äºä½¿ç”¨ä¸å®‰å…¨çš„å‡½æ•°è€Œå¼•èµ·çš„ï¼Œè¿™äº›å‡½æ•°å¯¹è¾“å…¥ä¸è¿›è¡Œè¾¹ç•Œæ£€æŸ¥ã€‚

è¿™ä¸ªè¦†ç›–çš„ä¸»è¦é—®é¢˜æ˜¯**ä¿å­˜çš„æŒ‡ä»¤æŒ‡é’ˆ (EIP/RIP)** å’Œ**ä¿å­˜çš„åŸºæŒ‡é’ˆ (EBP/RBP)** ç”¨äºè¿”å›åˆ°ä¸Šä¸€ä¸ªå‡½æ•°ï¼Œè¿™äº›ä¿¡æ¯æ˜¯**å­˜å‚¨åœ¨æ ˆä¸Šçš„**ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿè¦†ç›–è¿™äº›ä¿¡æ¯å¹¶**æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµ**ã€‚

è¯¥æ¼æ´é€šå¸¸æ˜¯å› ä¸ºä¸€ä¸ªå‡½æ•°**åœ¨æ ˆä¸­å¤åˆ¶çš„å­—èŠ‚æ•°è¶…è¿‡äº†ä¸ºå…¶åˆ†é…çš„æ•°é‡**ï¼Œå› æ­¤èƒ½å¤Ÿè¦†ç›–æ ˆçš„å…¶ä»–éƒ¨åˆ†ã€‚

ä¸€äº›å¸¸è§çš„æ˜“å—æ”»å‡»çš„å‡½æ•°åŒ…æ‹¬ï¼š**`strcpy`, `strcat`, `sprintf`, `gets`**... æ­¤å¤–ï¼Œåƒ**`fgets`**ã€**`read`**å’Œ**`memcpy`**è¿™æ ·çš„å‡½æ•°ï¼Œå¦‚æœæŒ‡å®šçš„é•¿åº¦å¤§äºåˆ†é…çš„é•¿åº¦ï¼Œå¯èƒ½ä¼šä»¥è„†å¼±çš„æ–¹å¼ä½¿ç”¨ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹å‡½æ•°å¯èƒ½æ˜¯è„†å¼±çš„ï¼š
```c
void vulnerable() {
char buffer[128];
printf("Enter some text: ");
gets(buffer); // This is where the vulnerability lies
printf("You entered: %s\n", buffer);
}
```
### å¯»æ‰¾æ ˆæº¢å‡ºåç§»é‡

å¯»æ‰¾æ ˆæº¢å‡ºçš„æœ€å¸¸è§æ–¹æ³•æ˜¯è¾“å…¥å¤§é‡çš„ `A`sï¼ˆä¾‹å¦‚ `python3 -c 'print("A"*1000)'`ï¼‰ï¼Œå¹¶æœŸå¾…å‡ºç° `Segmentation Fault`ï¼Œè¿™è¡¨æ˜ **å°è¯•è®¿é—®äº†åœ°å€ `0x41414141`**ã€‚

æ­¤å¤–ï¼Œä¸€æ—¦å‘ç°å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œæ‚¨éœ€è¦æ‰¾åˆ°åç§»é‡ï¼Œä»¥ä¾¿èƒ½å¤Ÿ **è¦†ç›–è¿”å›åœ°å€**ï¼Œé€šå¸¸ä½¿ç”¨ **De Bruijn åºåˆ—**ã€‚å¯¹äºç»™å®šå¤§å°ä¸º _k_ çš„å­—æ¯è¡¨å’Œé•¿åº¦ä¸º _n_ çš„å­åºåˆ—ï¼Œè¿™æ˜¯ä¸€ä¸ª **å¾ªç¯åºåˆ—ï¼Œå…¶ä¸­æ¯ä¸ªå¯èƒ½çš„é•¿åº¦ä¸º \_n**\_\*\* çš„å­åºåˆ—æ°å¥½å‡ºç°ä¸€æ¬¡\*\* ä½œä¸ºè¿ç»­å­åºåˆ—ã€‚

è¿™æ ·ï¼Œæ‚¨å°±ä¸éœ€è¦æ‰‹åŠ¨æ‰¾å‡ºæ§åˆ¶ EIP æ‰€éœ€çš„åç§»é‡ï¼Œè€Œæ˜¯å¯ä»¥ä½¿ç”¨è¿™äº›åºåˆ—ä¸­çš„ä¸€ä¸ªä½œä¸ºå¡«å……ï¼Œç„¶åæ‰¾åˆ°è¦†ç›–å®ƒçš„å­—èŠ‚çš„åç§»é‡ã€‚

å¯ä»¥ä½¿ç”¨ **pwntools** æ¥å®ç°è¿™ä¸€ç‚¹ï¼š
```python
from pwn import *

# Generate a De Bruijn sequence of length 1000 with an alphabet size of 256 (byte values)
pattern = cyclic(1000)

# This is an example value that you'd have found in the EIP/IP register upon crash
eip_value = p32(0x6161616c)
offset = cyclic_find(eip_value)  # Finds the offset of the sequence in the De Bruijn pattern
print(f"The offset is: {offset}")
```
æˆ– **GEF**ï¼š
```bash
#Patterns
pattern create 200 #Generate length 200 pattern
pattern search "avaaawaa" #Search for the offset of that substring
pattern search $rsp #Search the offset given the content of $rsp
```
## åˆ©ç”¨æ ˆæº¢å‡º

åœ¨æº¢å‡ºæœŸé—´ï¼ˆå‡è®¾æº¢å‡ºå¤§å°è¶³å¤Ÿå¤§ï¼‰ï¼Œæ‚¨å°†èƒ½å¤Ÿ**è¦†ç›–**æ ˆå†…å±€éƒ¨å˜é‡çš„å€¼ï¼Œç›´åˆ°è¾¾åˆ°ä¿å­˜çš„**EBP/RBP å’Œ EIP/RIPï¼ˆç”šè‡³æ›´å¤šï¼‰**ã€‚\
æ»¥ç”¨è¿™ç§ç±»å‹æ¼æ´çš„æœ€å¸¸è§æ–¹æ³•æ˜¯**ä¿®æ”¹è¿”å›åœ°å€**ï¼Œè¿™æ ·å½“å‡½æ•°ç»“æŸæ—¶ï¼Œ**æ§åˆ¶æµå°†è¢«é‡å®šå‘åˆ°ç”¨æˆ·åœ¨æ­¤æŒ‡é’ˆä¸­æŒ‡å®šçš„ä»»ä½•ä½ç½®**ã€‚

ç„¶è€Œï¼Œåœ¨å…¶ä»–åœºæ™¯ä¸­ï¼Œä»…ä»…**è¦†ç›–æ ˆä¸­æŸäº›å˜é‡çš„å€¼**å¯èƒ½å°±è¶³ä»¥è¿›è¡Œåˆ©ç”¨ï¼ˆä¾‹å¦‚åœ¨ç®€å•çš„CTFæŒ‘æˆ˜ä¸­ï¼‰ã€‚

### Ret2win

åœ¨è¿™ç§ç±»å‹çš„CTFæŒ‘æˆ˜ä¸­ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ª**å‡½æ•°**ï¼Œ**ä»æœªè¢«è°ƒç”¨**ï¼Œè€Œä¸”**æ‚¨éœ€è¦è°ƒç”¨å®ƒæ‰èƒ½è·èƒœ**ã€‚å¯¹äºè¿™äº›æŒ‘æˆ˜ï¼Œæ‚¨åªéœ€æ‰¾åˆ°**è¦†ç›–è¿”å›åœ°å€çš„åç§»é‡**å¹¶**æ‰¾åˆ°è¦è°ƒç”¨çš„å‡½æ•°çš„åœ°å€**ï¼ˆé€šå¸¸[**ASLR**](../common-binary-protections-and-bypasses/aslr/)ä¼šè¢«ç¦ç”¨ï¼‰ï¼Œè¿™æ ·å½“æ˜“å—æ”»å‡»çš„å‡½æ•°è¿”å›æ—¶ï¼Œéšè—çš„å‡½æ•°å°†è¢«è°ƒç”¨ï¼š

{% content-ref url="ret2win/" %}
[ret2win](ret2win/)
{% endcontent-ref %}

### æ ˆShellcode

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥å°†Shellcodeæ”¾ç½®åœ¨æ ˆä¸­ï¼Œå¹¶åˆ©ç”¨æ§åˆ¶çš„EIP/RIPè·³è½¬åˆ°Shellcodeå¹¶æ‰§è¡Œä»»æ„ä»£ç ï¼š

{% content-ref url="stack-shellcode/" %}
[stack-shellcode](stack-shellcode/)
{% endcontent-ref %}

### ROP & Ret2... æŠ€æœ¯

è¯¥æŠ€æœ¯æ˜¯ç»•è¿‡å‰ä¸€ç§æŠ€æœ¯ä¸»è¦ä¿æŠ¤çš„åŸºæœ¬æ¡†æ¶ï¼š**ä¸å¯æ‰§è¡Œæ ˆï¼ˆNXï¼‰**ã€‚å®ƒå…è®¸æ‰§è¡Œå…¶ä»–å‡ ç§æŠ€æœ¯ï¼ˆret2libï¼Œret2syscall...ï¼‰ï¼Œé€šè¿‡æ»¥ç”¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ç°æœ‰æŒ‡ä»¤æœ€ç»ˆæ‰§è¡Œä»»æ„å‘½ä»¤ï¼š

{% content-ref url="../rop-return-oriented-programing/" %}
[rop-return-oriented-programing](../rop-return-oriented-programing/)
{% endcontent-ref %}

## å †æº¢å‡º

æº¢å‡ºä¸æ€»æ˜¯å‘ç”Ÿåœ¨æ ˆä¸­ï¼Œå®ƒä¹Ÿå¯èƒ½å‘ç”Ÿåœ¨**å †**ä¸­ï¼Œä¾‹å¦‚ï¼š

{% content-ref url="../libc-heap/heap-overflow.md" %}
[heap-overflow.md](../libc-heap/heap-overflow.md)
{% endcontent-ref %}

## ä¿æŠ¤ç±»å‹

æœ‰å‡ ç§ä¿æŠ¤æªæ–½è¯•å›¾é˜²æ­¢æ¼æ´çš„åˆ©ç”¨ï¼Œè¯·æŸ¥çœ‹å®ƒä»¬ï¼š

{% content-ref url="../common-binary-protections-and-bypasses/" %}
[common-binary-protections-and-bypasses](../common-binary-protections-and-bypasses/)
{% endcontent-ref %}

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
