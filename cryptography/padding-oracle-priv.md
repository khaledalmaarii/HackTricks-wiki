{% hint style="success" %}
AWS ν•΄ν‚Ή λ°°μ°κ³  μ‹¤μµν•κΈ°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP ν•΄ν‚Ή λ°°μ°κ³  μ‹¤μµν•κΈ°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks μ§€μ›ν•κΈ°</summary>

* [**κµ¬λ… μ”κΈμ **](https://github.com/sponsors/carlospolop)λ¥Ό ν™•μΈν•μ„Έμ”!
* π’¬ [**Discord κ·Έλ£Ή**](https://discord.gg/hRep4RUj7f)μ— κ°€μ…ν•κ±°λ‚ [**ν…”λ κ·Έλ¨ κ·Έλ£Ή**](https://t.me/peass)μ— μ°Έμ—¬ν•κ±°λ‚ **νΈμ„ν„°** π¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**λ¥Ό ν”λ΅μ°**ν•μ„Έμ”.
* [**HackTricks**](https://github.com/carlospolop/hacktricks) λ° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) κΉƒν—™ μ €μ¥μ†μ— PRμ„ μ μ¶ν•μ—¬ ν•΄ν‚Ή νΈλ¦­μ„ κ³µμ ν•μ„Έμ”.

</details>
{% endhint %}

# CBC - Cipher Block Chaining

CBC λ¨λ“μ—μ„λ” **μ΄μ „μ— μ•”νΈν™”λ λΈ”λ΅μ΄ IVλ΅ μ‚¬μ©**λμ–΄ λ‹¤μ λΈ”λ΅κ³Ό XOR μ—°μ‚°μ„ μν–‰ν•©λ‹λ‹¤:

![https://defuse.ca/images/cbc\_encryption.png](https://defuse.ca/images/cbc\_encryption.png)

CBCλ¥Ό λ³µνΈν™”ν•λ ¤λ©΄ **λ°λ€λ΅** **μ‘μ—…**μ„ μν–‰ν•©λ‹λ‹¤:

![https://defuse.ca/images/cbc\_decryption.png](https://defuse.ca/images/cbc\_decryption.png)

**μ•”νΈν™” ν‚¤**μ™€ **IV**λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•¨μ— μ μν•μ„Έμ”.

# λ©”μ‹μ§€ ν¨λ”©

μ•”νΈν™”λ” **κ³ μ •λ ν¬κΈ°μ λΈ”λ΅**μ—μ„ μν–‰λλ―€λ΅ **λ§μ§€λ§‰ λΈ”λ΅**μ„ μ™„μ„±ν•κΈ° μ„ν•΄ μΌλ°μ μΌλ΅ **ν¨λ”©**μ΄ ν•„μ”ν•©λ‹λ‹¤.\
μΌλ°μ μΌλ΅ **PKCS7**μ΄ μ‚¬μ©λλ©°, ν¨λ”©μ€ λΈ”λ΅μ„ **μ™„μ„±**ν•κΈ° μ„ν•΄ ν•„μ”ν• **λ°”μ΄νΈ μ**λ¥Ό **λ°λ³µ**ν•λ” ν¨λ”©μ„ μƒμ„±ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, λ§μ§€λ§‰ λΈ”λ΅μ΄ 3λ°”μ΄νΈ λ¶€μ΅±ν•λ©΄ ν¨λ”©μ€ `\x03\x03\x03`μ΄ λ©λ‹λ‹¤.

**8λ°”μ΄νΈ κΈΈμ΄μ 2κ° λΈ”λ΅**μ— λ€ν• λ” λ§μ€ μμ λ¥Ό μ‚΄ν΄λ΄…μ‹λ‹¤:

| λ°”μ΄νΈ #0 | λ°”μ΄νΈ #1 | λ°”μ΄νΈ #2 | λ°”μ΄νΈ #3 | λ°”μ΄νΈ #4 | λ°”μ΄νΈ #5 | λ°”μ΄νΈ #6 | λ°”μ΄νΈ #7 | λ°”μ΄νΈ #0  | λ°”μ΄νΈ #1  | λ°”μ΄νΈ #2  | λ°”μ΄νΈ #3  | λ°”μ΄νΈ #4  | λ°”μ΄νΈ #5  | λ°”μ΄νΈ #6  | λ°”μ΄νΈ #7  |
| ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |
| P       | A       | S       | S       | W       | O       | R       | D       | 1        | 2        | 3        | 4        | 5        | 6        | **0x02** | **0x02** |
| P       | A       | S       | S       | W       | O       | R       | D       | 1        | 2        | 3        | 4        | 5        | **0x03** | **0x03** | **0x03** |
| P       | A       | S       | S       | W       | O       | R       | D       | 1        | 2        | 3        | **0x05** | **0x05** | **0x05** | **0x05** | **0x05** |
| P       | A       | S       | S       | W       | O       | R       | D       | **0x08** | **0x08** | **0x08** | **0x08** | **0x08** | **0x08** | **0x08** | **0x08** |

λ§μ§€λ§‰ μμ μ—μ„ **λ§μ§€λ§‰ λΈ”λ΅μ΄ κ°€λ“ μ°ΌμΌλ―€λ΅ ν¨λ”©λ§ μλ” λ‹¤λ¥Έ λΈ”λ΅μ΄ μƒμ„±**λμ—μμ„ μ£Όλ©ν•μ„Έμ”.

# ν¨λ”© μ¤λΌν΄

μ‘μ© ν”„λ΅κ·Έλ¨μ΄ μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό λ³µνΈν™”ν•λ©΄ λ¨Όμ € λ°μ΄ν„°λ¥Ό λ³µνΈν™”ν• λ‹¤μ ν¨λ”©μ„ μ κ±°ν•©λ‹λ‹¤. ν¨λ”©μ„ μ •λ¦¬ν•λ” λ™μ• **μλ»λ ν¨λ”©μ΄ κ°μ§€ κ°€λ¥ν• λ™μ‘μ„ μ λ°**ν•λ©΄ **ν¨λ”© μ¤λΌν΄ μ·¨μ•½μ **μ΄ μμµλ‹λ‹¤. κ°μ§€ κ°€λ¥ν• λ™μ‘μ€ **μ¤λ¥**, **κ²°κ³Ό λ¶€μ΅±**, λλ” **μ‘λ‹µμ΄ λλ¦Ό**μΌ μ μμµλ‹λ‹¤.

μ΄ λ™μ‘μ„ κ°μ§€ν•λ©΄ **μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό λ³µνΈν™”**ν•κ³  μ‹¬μ§€μ–΄ **μ„μμ ν‰λ¬Έμ„ μ•”νΈν™”**ν•  μ μμµλ‹λ‹¤.

## μ•…μ© λ°©λ²•

[https://github.com/AonCyberLabs/PadBuster](https://github.com/AonCyberLabs/PadBuster)λ¥Ό μ‚¬μ©ν•μ—¬ μ΄λ¬ν• μΆ…λ¥μ μ·¨μ•½μ μ„ μ•…μ©ν•κ±°λ‚ λ‹¨μν μν–‰ν•  μ μμµλ‹λ‹¤.
```
sudo apt-get install padbuster
```
μ‚¬μ΄νΈμ μΏ ν‚¤κ°€ μ·¨μ•½ν•μ§€ ν…μ¤νΈν•λ ¤λ©΄ λ‹¤μμ„ μ‹λ„ν•  μ μμµλ‹λ‹¤:
```bash
perl ./padBuster.pl http://10.10.10.10/index.php "RVJDQrwUdTRWJUVUeBKkEA==" 8 -encoding 0 -cookies "login=RVJDQrwUdTRWJUVUeBKkEA=="
```
**μΈμ½”λ”© 0**μ€ **base64**κ°€ μ‚¬μ©λλ‹¤λ” κ²ƒμ„ μλ―Έν•©λ‹λ‹¤ (κ·Έλ¬λ‚ λ‹¤λ¥Έ κ²ƒλ“¤λ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤, λ„μ›€ λ©”λ‰΄λ¥Ό ν™•μΈν•μ„Έμ”).

λν• μ΄ μ·¨μ•½μ μ„ μ•…μ©ν•μ—¬ μƒ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•  μ μμµλ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μΏ ν‚¤μ λ‚΄μ©μ΄ "**_**user=MyUsername**_**"μΈ κ²½μ°, μ΄λ¥Ό "\_user=administrator\_"λ΅ λ³€κ²½ν•μ—¬ μ‘μ© ν”„λ΅κ·Έλ¨ λ‚΄μ—μ„ κ¶ν•μ„ μƒμΉμ‹ν‚¬ μ μμµλ‹λ‹¤. λν• `-plaintext` λ§¤κ°λ³€μλ¥Ό μ§€μ •ν•μ—¬ `paduster`λ¥Ό μ‚¬μ©ν•μ—¬ μ΄λ¥Ό μν–‰ν•  μλ„ μμµλ‹λ‹¤:
```bash
perl ./padBuster.pl http://10.10.10.10/index.php "RVJDQrwUdTRWJUVUeBKkEA==" 8 -encoding 0 -cookies "login=RVJDQrwUdTRWJUVUeBKkEA==" -plaintext "user=administrator"
```
λ§μ•½ μ‚¬μ΄νΈκ°€ μ·¨μ•½ν•λ‹¤λ©΄ `padbuster`λ” μλ™μΌλ΅ ν¨λ”© μ¤λ¥κ°€ λ°μƒν•  λ• μ°ΎμΌλ ¤κ³  μ‹λ„ν•  κ²ƒμ΄μ§€λ§, **-error** λ§¤κ°λ³€μλ¥Ό μ‚¬μ©ν•μ—¬ μ¤λ¥ λ©”μ‹μ§€λ¥Ό μ§€μ •ν•  μλ„ μμµλ‹λ‹¤.
```bash
perl ./padBuster.pl http://10.10.10.10/index.php "" 8 -encoding 0 -cookies "hcon=RVJDQrwUdTRWJUVUeBKkEA==" -error "Invalid padding"
```
## μ΄λ΅ 

**μ”μ•½**ν•λ©΄, λ¨λ“  **λ‹¤λ¥Έ ν¨λ”©**μ„ λ§λ“¤ μ μλ” μ¬λ°”λ¥Έ κ°’μ„ μ¶”μΈ΅ν•μ—¬ μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό λ³µνΈν™”ν•κΈ° μ‹μ‘ν•  μ μμµλ‹λ‹¤. κ·Έλ° λ‹¤μ, ν¨λ”© μ¤λΌν΄ κ³µκ²©μ€ **1, 2, 3 λ“±μ ν¨λ”©μ„ λ§λ“λ” μ¬λ°”λ¥Έ κ°’**μ„ μ¶”μΈ΅ν•μ—¬ μ‹μ‘ν•μ—¬ λμ—μ„ μ‹μ‘ν•μ—¬ λ°”μ΄νΈλ¥Ό λ³µνΈν™”ν•κΈ° μ‹μ‘ν•©λ‹λ‹¤.

![](<../.gitbook/assets/image (629) (1) (1).png>)

**E0μ—μ„ E15**κΉμ§€μ λ°”μ΄νΈλ΅ κµ¬μ„±λ **2κ° λΈ”λ΅**μ„ μ°¨μ§€ν•λ” μ•”νΈν™”λ ν…μ¤νΈκ°€ μλ‹¤κ³  μƒμƒν•΄λ³΄μ‹­μ‹μ¤.\
**λ§μ§€λ§‰ λΈ”λ΅(E8μ—μ„ E15)**μ„ **λ³µνΈν™”**ν•κΈ° μ„ν•΄ μ „μ²΄ λΈ”λ΅μ€ "λΈ”λ΅ μ•”νΈ λ³µνΈν™”"λ¥Ό ν†µν•΄ **μ¤‘κ°„ λ°”μ΄νΈ I0μ—μ„ I15**λ¥Ό μƒμ„±ν•©λ‹λ‹¤.\
λ§μ§€λ§‰μΌλ΅, κ° μ¤‘κ°„ λ°”μ΄νΈλ” μ΄μ „ μ•”νΈν™”λ λ°”μ΄νΈ(E0μ—μ„ E7)μ™€ **XOR**λ©λ‹λ‹¤. κ·Έλμ„:

* `C15 = D(E15) ^ E7 = I15 ^ E7`
* `C14 = I14 ^ E6`
* `C13 = I13 ^ E5`
* `C12 = I12 ^ E4`
* ...

μ΄μ , `C15`κ°€ `0x01`μ΄ λ  λ•κΉμ§€ `E7`μ„ μμ •ν•  μ μμµλ‹λ‹¤. μ΄κ²ƒλ„ μ¬λ°”λ¥Έ ν¨λ”©μ΄ λ  κ²ƒμ…λ‹λ‹¤. λ”°λΌμ„, μ΄ κ²½μ°μ—λ”: `\x01 = I15 ^ E'7`

κ·Έλμ„, `E'7`μ„ μ°ΎμΌλ©΄ **I15λ¥Ό κ³„μ‚°ν•  μ μμµλ‹λ‹¤**: `I15 = 0x01 ^ E'7`

μ΄λ΅μ¨ **C15λ¥Ό κ³„μ‚°ν•  μ μμµλ‹λ‹¤**: `C15 = E7 ^ I15 = E7 ^ \x01 ^ E'7`

**C15**λ¥Ό μ•κ² λλ©΄, μ΄μ  **C14λ¥Ό κ³„μ‚°ν•  μ μμµλ‹λ‹¤**. μ΄λ²μ—λ” ν¨λ”© `\x02\x02`λ¥Ό λΈλ£¨νΈ ν¬μ‹±ν•μ—¬ κ³„μ‚°ν•©λ‹λ‹¤.

μ΄ BFλ” μ΄μ „ κ²ƒλ§νΌ λ³µμ΅ν•©λ‹λ‹¤. `E''15`μ κ°’μ΄ 0x02μΈ `E''7 = \x02 ^ I15`λ¥Ό κ³„μ‚°ν•  μ μμΌλ―€λ΅ **`C14`κ°€ `0x02`μ™€ κ°™μ€ `E'14`λ¥Ό μ°ΎκΈ°λ§ ν•λ©΄ λ©λ‹λ‹¤**.\
κ·Έλ° λ‹¤μ, C14λ¥Ό λ³µνΈν™”ν•κΈ° μ„ν•΄ λ™μΌν• λ‹¨κ³„λ¥Ό μν–‰ν•©λ‹λ‹¤: **`C14 = E6 ^ I14 = E6 ^ \x02 ^ E''6`**

**μ „μ²΄ μ•”νΈν™”λ ν…μ¤νΈλ¥Ό λ³µνΈν™”ν•  λ•κΉμ§€ μ΄ μ²΄μΈμ„ λ”°λ¦…λ‹λ‹¤.**

## μ·¨μ•½μ  νƒμ§€

κ³„μ •μ„ λ“±λ΅ν•κ³  μ΄ κ³„μ •μΌλ΅ λ΅κ·ΈμΈν•©λ‹λ‹¤.\
**μ—¬λ¬ λ² λ΅κ·ΈμΈ**ν•κ³  ν•­μƒ **λ™μΌν• μΏ ν‚¤**λ¥Ό λ°›μΌλ©΄ μ‘μ© ν”„λ΅κ·Έλ¨μ— **λ¬Έμ κ°€ μμ„ μ μμµλ‹λ‹¤**. λ΅κ·ΈμΈν•  λ•λ§λ‹¤ **λ°λ“μ‹ κ³ μ ν• μΏ ν‚¤**κ°€ λ°ν™λμ–΄μ•Ό ν•©λ‹λ‹¤. μΏ ν‚¤κ°€ **ν•­μƒ** **λ™μΌν•λ©΄**, μ•„λ§λ„ ν•­μƒ μ ν¨ν•κ³  **λ¬΄ν¨ν™”ν•  μ μλ” λ°©λ²•μ΄ μ—†μ„ κ²ƒμ…λ‹λ‹¤**.

μ΄μ , **μΏ ν‚¤λ¥Ό μμ •**ν•λ ¤κ³  ν•λ©΄ μ‘μ© ν”„λ΅κ·Έλ¨μ—μ„ **μ¤λ¥**κ°€ λ°μƒν•λ” κ²ƒμ„ λ³Ό μ μμµλ‹λ‹¤.\
κ·Έλ¬λ‚ ν¨λ”©μ„ λΈλ£¨νΈ ν¬μ‹±ν•μ—¬ (μ: ν¨λ“λ²„μ¤ν„° μ‚¬μ©) λ‹¤λ¥Έ μ‚¬μ©μμ— λ€ν•΄ μ ν¨ν• λ‹¤λ¥Έ μΏ ν‚¤λ¥Ό μ–»μ„ μ μμµλ‹λ‹¤. μ΄ μ‹λ‚λ¦¬μ¤λ” ν¨λ“λ²„μ¤ν„°μ— μ·¨μ•½ν•  κ°€λ¥μ„±μ΄ λ†’μµλ‹λ‹¤.

## μ°Έκ³  μλ£

* [https://en.wikipedia.org/wiki/Block\_cipher\_mode\_of\_operation](https://en.wikipedia.org/wiki/Block\_cipher\_mode\_of\_operation)
