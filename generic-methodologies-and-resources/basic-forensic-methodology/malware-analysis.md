# Analiza zlonamernosti

{% hint style="success" %}
NauÄite i veÅ¾bajte hakovanje AWS-a:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## ForenziÄki CheatSheets

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/)

## Online Servisi

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)
* [Any.Run](https://any.run/)

## Offline Antivirus i Alati za Detekciju

### Yara

#### Instalacija
```bash
sudo apt-get install -y yara
```
#### Priprema pravila

Koristite ovaj skript za preuzimanje i spajanje svih yara pravila za zlonamjerni softver sa github-a: [https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\
Kreirajte direktorijum _**rules**_ i izvrÅ¡ite ga. Ovo Ä‡e kreirati datoteku nazvanu _**malware\_rules.yar**_ koja  koja sadrÅ¾i sva yara pravila za zlonamjerni softver.
```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```
#### Skeniranje
```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```
#### YaraGen: Provera malvera i kreiranje pravila

MoÅ¾ete koristiti alatku [**YaraGen**](https://github.com/Neo23x0/yarGen) za generisanje yara pravila iz binarnog fajla. Pogledajte ove tutorijale: [**Deo 1**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**Deo 2**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**Deo 3**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)
```bash
python3 yarGen.py --update
python3.exe yarGen.py --excludegood -m  ../../mals/
```
### ClamAV

#### Instalacija
```
sudo apt-get install -y clamav
```
#### Skeniranje
```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```
### [Capa](https://github.com/mandiant/capa)

**Capa** otkriva potencijalno zlonamerne **sposobnosti** u izvrÅ¡nim datotekama: PE, ELF, .NET. Tako Ä‡e pronaÄ‡i stvari poput Att\&ck taktika ili sumnjivih sposobnosti kao Å¡to su:

- provera greÅ¡ke OutputDebugString
- pokretanje kao servis
- kreiranje procesa

Preuzmite ga sa [**Github repozitorijuma**](https://github.com/mandiant/capa).

### IOCs

IOC znaÄi Indikator kompromitovanja. IOC je skup **uslova koji identifikuju** potencijalno neÅ¾eljen softver ili potvrÄ‘eni **malver**. Plave ekipe koriste ovu vrstu definicije da **traÅ¾e ovu vrstu zlonamernih datoteka** na svojim **sistemima** i **mreÅ¾ama**.\
Deljenje ovih definicija je veoma korisno jer kada se malver identifikuje na raÄunaru i IOC za taj malver bude kreiran, druge Plave ekipe ga mogu koristiti da identifikuju malver brÅ¾e.

Alat za kreiranje ili modifikaciju IOCa je [**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**.**\
MoÅ¾ete koristiti alate poput [**Redline**](https://www.fireeye.com/services/freeware/redline.html) da **traÅ¾ite definisane IOCe na ureÄ‘aju**.

### Loki

[**Loki**](https://github.com/Neo23x0/Loki) je skener za Jednostavne Indikatore kompromitovanja.\
Detekcija se zasniva na Äetiri metode detekcije:
```
1. File Name IOC
Regex match on full file path/name

2. Yara Rule Check
Yara signature matches on file data and process memory

3. Hash Check
Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files

4. C2 Back Connect Check
Compares process connection endpoints with C2 IOCs (new since version v.10)
```
### Linux Malware Detect

[**Linux Malware Detect (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/) je skener malvera za Linux koji je objavljen pod GNU GPLv2 licencom, a dizajniran je oko pretnji sa kojima se susreÄ‡u u deljenim hosting okruÅ¾enjima. Koristi podatke o pretnjama iz sistema za otkrivanje upada na mreÅ¾nom rubu kako bi izdvojio malver koji se aktivno koristi u napadima i generiÅ¡e potpise za detekciju. Pored toga, podaci o pretnjama takoÄ‘e potiÄu iz korisniÄkih podnesaka sa funkcijom provere LMD i resursima zajednice malvera.

### rkhunter

Alati poput [**rkhunter**](http://rkhunter.sourceforge.net) mogu se koristiti za proveru datoteÄnog sistema radi moguÄ‡ih **rootkitova** i malvera.
```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```
### FLOSS

[**FLOSS**](https://github.com/mandiant/flare-floss) je alatka koja Ä‡e pokuÅ¡ati da pronaÄ‘e prikrivene stringove unutar izvrÅ¡nih datoteka koristeÄ‡i razliÄite tehnike.

### PEpper

[PEpper ](https://github.com/Th3Hurrican3/PEpper) proverava neke osnovne stvari unutar izvrÅ¡ne datoteke (binarni podaci, entropija, URL-ovi i IP adrese, neka yara pravila).

### PEstudio

[PEstudio](https://www.winitor.com/download) je alatka koja omoguÄ‡ava dobijanje informacija o Windows izvrÅ¡nim datotekama kao Å¡to su uvozi, izvozi, zaglavlja, ali takoÄ‘e Ä‡e proveriti VirusTotal i pronaÄ‡i potencijalne Att\&ck tehnike.

### Detect It Easy(DiE)

[**DiE**](https://github.com/horsicq/Detect-It-Easy/) je alatka za otkrivanje da li je datoteka **Å¡ifrovana** i takoÄ‘e pronalazi **pakere**.

### NeoPI

[**NeoPI** ](https://github.com/CiscoCXSecurity/NeoPI) je Python skripta koja koristi razliÄite **statistiÄke metode** za otkrivanje **prikrivenog** i **Å¡ifrovanog** sadrÅ¾aja unutar tekstualnih/skript fajlova. Namera NeoPI-ja je da pomogne u **otkrivanju skrivenog koda web ljuski**.

### **php-malware-finder**

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder) daje sve od sebe da otkrije **prikriveni**/**sumnjivi kod** kao i fajlove koji koriste **PHP** funkcije Äesto koriÅ¡tene u **malverima**/web ljuskama.

### Apple Binary Signatures

Prilikom provere nekog **uzorka malvera** uvek treba **proveriti potpis** binarne datoteke jer **razvojni programer** koji ju je potpisao moÅ¾e veÄ‡ biti **povezan** sa **malverom**.
```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the appâ€™s contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```
## Tehnike otkrivanja

### Stapanje fajlova

Ako znate da je neki folder koji sadrÅ¾i **fajlove** veb servera **poslednji put aÅ¾uriran na odreÄ‘eni datum**. **Proverite** datum kada su **fajlovi** na **veb serveru kreirani i menjani** i ako je bilo koji datum **sumnjiv**, proverite taj fajl.

### Osnovne linije

Ako fajlovi u folderu **ne bi trebalo da su menjani**, moÅ¾ete izraÄunati **heÅ¡** **originalnih fajlova** iz foldera i **uporediti** ih sa **trenutnim**. Sve Å¡to je izmenjeno biÄ‡e **sumnjivo**.

### StatistiÄka analiza

Kada se informacije Äuvaju u logovima, moÅ¾ete **proveriti statistiku kao Å¡to je koliko puta je svaki fajl veb servera pristupan jer bi web ljuska mogla biti jedna od najÄeÅ¡Ä‡ih**.

{% hint style="success" %}
NauÄite i veÅ¾bajte hakovanje AWS-a:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Obuka AWS Crveni Tim StruÄnjak (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Obuka GCP Crveni Tim StruÄnjak (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
