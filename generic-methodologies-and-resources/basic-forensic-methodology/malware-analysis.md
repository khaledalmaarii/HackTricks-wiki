# ZararlÄ± YazÄ±lÄ±m Analizi

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hacklemeyi Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'da **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **pull request** gÃ¶ndererek paylaÅŸÄ±n.

</details>

## Forensik Hile KaÄŸÄ±tlarÄ±

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/)

## Ã‡evrimiÃ§i Hizmetler

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)
* [Any.Run](https://any.run/)

## Ã‡evrimdÄ±ÅŸÄ± AntivirÃ¼s ve AlgÄ±lama AraÃ§larÄ±

### Yara

#### Kurulum
```bash
sudo apt-get install -y yara
```
#### KurallarÄ± HazÄ±rla

Bu betiÄŸi kullanarak github'dan tÃ¼m yara kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±m kurallarÄ±nÄ± indirin ve birleÅŸtirin: [https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\
_**rules**_ dizinini oluÅŸturun ve betiÄŸi Ã§alÄ±ÅŸtÄ±rÄ±n. Bu, _**malware\_rules.yar**_ adÄ±nda tÃ¼m yara kurallarÄ±nÄ± iÃ§eren bir dosya oluÅŸturacaktÄ±r.
```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```
#### Tarama

Malware analizi yaparken, ilk adÄ±m olarak zararlÄ± yazÄ±lÄ±mÄ± taramanÄ±z gerekmektedir. Bu, zararlÄ± yazÄ±lÄ±mÄ±n dosya sisteminde veya bellekte var olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek anlamÄ±na gelir. Tarama iÅŸlemi, zararlÄ± yazÄ±lÄ±mÄ±n imzalarÄ±nÄ± veya davranÄ±ÅŸsal Ã¶zelliklerini algÄ±lamak iÃ§in kullanÄ±lan antivirÃ¼s programlarÄ± veya Ã¶zel araÃ§lar kullanÄ±larak gerÃ§ekleÅŸtirilebilir.

Tarama sonucunda zararlÄ± yazÄ±lÄ±m tespit edilirse, bu, analiz sÃ¼recinin devam etmesi gerektiÄŸi anlamÄ±na gelir. ZararlÄ± yazÄ±lÄ±m tespit edilmezse, analiz sÃ¼reci sonlandÄ±rÄ±labilir veya baÅŸka bir yÃ¶ntem denenebilir.
```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```
#### YaraGen: ZararlÄ± yazÄ±lÄ±m kontrolÃ¼ ve kurallar oluÅŸturma

[**YaraGen**](https://github.com/Neo23x0/yarGen) aracÄ±nÄ± kullanarak bir ikilik dosyadan yara kurallarÄ± oluÅŸturabilirsiniz. Bu Ã¶ÄŸreticilere gÃ¶z atÄ±n: [**BÃ¶lÃ¼m 1**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**BÃ¶lÃ¼m 2**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**BÃ¶lÃ¼m 3**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)
```bash
python3 yarGen.py --update
python3.exe yarGen.py --excludegood -m  ../../mals/
```
### ClamAV

#### Kurulum

ClamAV, aÃ§Ä±k kaynaklÄ± bir antivirÃ¼s yazÄ±lÄ±mÄ±dÄ±r. Bir sistemde kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlarÄ± tespit etmek ve temizlemek iÃ§in kullanÄ±lÄ±r. ClamAV'yi kurmak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyin:

1. **Ubuntu/Debian**:
   
   ```bash
   sudo apt-get update
   sudo apt-get install clamav
   ```

2. **CentOS/RHEL**:
   
   ```bash
   sudo yum update
   sudo yum install clamav
   ```

3. **Fedora**:
   
   ```bash
   sudo dnf update
   sudo dnf install clamav
   ```

4. **MacOS** (Homebrew kullanarak):
   
   ```bash
   brew update
   brew install clamav
   ```

5. **Windows**:
   
   ClamAV'nin Windows sÃ¼rÃ¼mÃ¼nÃ¼ [buradan](https://www.clamav.net/downloads#otherversions) indirin ve kurulum sihirbazÄ±nÄ± takip edin.

6. Kurulum tamamlandÄ±ktan sonra, ClamAV'yi gÃ¼ncellemek iÃ§in aÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rÄ±n:
   
   ```bash
   sudo freshclam
   ```

ClamAV baÅŸarÄ±yla kurulduÄŸunda, kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlarÄ± tespit etmek ve temizlemek iÃ§in kullanabilirsiniz.
```
sudo apt-get install -y clamav
```
#### Tarama

Malware analizi yaparken, ilk adÄ±m olarak zararlÄ± yazÄ±lÄ±mÄ± taramanÄ±z gerekmektedir. Bu, zararlÄ± yazÄ±lÄ±mÄ±n dosya sisteminde veya bellekte var olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek anlamÄ±na gelir. Tarama iÅŸlemi, zararlÄ± yazÄ±lÄ±mÄ±n imzalarÄ±nÄ± veya davranÄ±ÅŸsal Ã¶zelliklerini algÄ±lamak iÃ§in kullanÄ±lan antivirÃ¼s programlarÄ± veya Ã¶zel araÃ§lar kullanÄ±larak gerÃ§ekleÅŸtirilebilir.

Tarama sonucunda zararlÄ± yazÄ±lÄ±m tespit edilirse, bu, analiz sÃ¼recinin devam etmesi gerektiÄŸi anlamÄ±na gelir. ZararlÄ± yazÄ±lÄ±m tespit edilmezse, analiz sÃ¼reci sonlandÄ±rÄ±labilir veya baÅŸka bir yÃ¶ntem denenebilir.
```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```
### [Capa](https://github.com/mandiant/capa)

**Capa**, PE, ELF, .NET gibi yÃ¼rÃ¼tÃ¼lebilir dosyalarda potansiyel olarak zararlÄ± yetenekleri tespit eder. Bu nedenle, Att\&ck taktikleri veya ÅŸÃ¼pheli yetenekler gibi ÅŸeyleri bulur:

- OutputDebugString hatasÄ± kontrolÃ¼ yapar
- Bir hizmet olarak Ã§alÄ±ÅŸÄ±r
- Ä°ÅŸlem oluÅŸturur

[**Github deposunda**](https://github.com/mandiant/capa) bulabilirsiniz.

### IOC'ler

IOC, Compromise GÃ¶stergesi anlamÄ±na gelir. IOC, bazÄ± potansiyel istenmeyen yazÄ±lÄ±mlarÄ± veya doÄŸrulanmÄ±ÅŸ kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlarÄ± tanÄ±mlayan koÅŸullar kÃ¼mesidir. Mavi TakÄ±mlar, bu tÃ¼r tanÄ±mlarÄ± sistemlerinde ve aÄŸlarÄ±nda bu tÃ¼r kÃ¶tÃ¼ amaÃ§lÄ± dosyalarÄ± aramak iÃ§in kullanÄ±r.\
Bu tanÄ±mlarÄ± paylaÅŸmak, bir bilgisayarda kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±m tespit edildiÄŸinde ve bu kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±m iÃ§in bir IOC oluÅŸturulduÄŸunda, diÄŸer Mavi TakÄ±mlarÄ±n kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mÄ± daha hÄ±zlÄ± tanÄ±mlamasÄ±na yardÄ±mcÄ± olur.

IOC oluÅŸturmak veya deÄŸiÅŸtirmek iÃ§in bir araÃ§ [**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**'dÄ±r**.\
[**Redline**](https://www.fireeye.com/services/freeware/redline.html) gibi araÃ§larÄ± kullanarak bir cihazda tanÄ±mlanmÄ±ÅŸ IOC'leri arayabilirsiniz.

### Loki

[**Loki**](https://github.com/Neo23x0/Loki), Basit Kompromis GÃ¶stergeleri iÃ§in bir tarayÄ±cÄ±dÄ±r.\
Tespit, dÃ¶rt tespit yÃ¶ntemine dayanÄ±r:
```
1. File Name IOC
Regex match on full file path/name

2. Yara Rule Check
Yara signature matches on file data and process memory

3. Hash Check
Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files

4. C2 Back Connect Check
Compares process connection endpoints with C2 IOCs (new since version v.10)
```
### Linux ZararlÄ± YazÄ±lÄ±m Tespiti

[**Linux ZararlÄ± YazÄ±lÄ±m Tespiti (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/), GNU GPLv2 lisansÄ± altÄ±nda yayÄ±nlanan bir Linux zararlÄ± yazÄ±lÄ±m tarayÄ±cÄ±sÄ±dÄ±r ve paylaÅŸÄ±mlÄ± barÄ±ndÄ±rÄ±lan ortamlarda karÅŸÄ±laÅŸÄ±lan tehditlere odaklanmÄ±ÅŸtÄ±r. SaldÄ±rÄ±larda aktif olarak kullanÄ±lan zararlÄ± yazÄ±lÄ±mlarÄ± tespit etmek ve tespit iÃ§in imzalar oluÅŸturmak iÃ§in aÄŸ kenarÄ± sÄ±zma tespit sistemlerinden tehdit verileri kullanÄ±r. AyrÄ±ca, tehdit verileri LMD kontrol Ã¶zelliÄŸi ve zararlÄ± yazÄ±lÄ±m topluluk kaynaklarÄ±ndan kullanÄ±cÄ± gÃ¶nderimlerinden de elde edilir.

### rkhunter

[**rkhunter**](http://rkhunter.sourceforge.net) gibi araÃ§lar, dosya sisteminde olasÄ± **rootkit** ve zararlÄ± yazÄ±lÄ±m taramasÄ± yapmak iÃ§in kullanÄ±labilir.
```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```
### FLOSS

[**FLOSS**](https://github.com/mandiant/flare-floss) farklÄ± teknikler kullanarak yÃ¼rÃ¼tÃ¼lebilir dosyalarda ÅŸifrelenmiÅŸ dizeleri bulmaya Ã§alÄ±ÅŸan bir araÃ§tÄ±r.

### PEpper

[PEpper](https://github.com/Th3Hurrican3/PEpper), yÃ¼rÃ¼tÃ¼lebilir dosyanÄ±n iÃ§indeki bazÄ± temel bilgileri kontrol eder (ikili veri, entropi, URL'ler ve IP'ler, bazÄ± yara kurallarÄ±).

### PEstudio

[PEstudio](https://www.winitor.com/download), Windows yÃ¼rÃ¼tÃ¼lebilir dosyalarÄ±nÄ±n iÃ§indeki ithalatlar, ihracatlar, baÅŸlÄ±klar gibi bilgileri almanÄ±zÄ± saÄŸlayan bir araÃ§tÄ±r, ayrÄ±ca virÃ¼s taramasÄ± yapar ve potansiyel Att\&ck tekniklerini bulur.

### Detect It Easy(DiE)

[**DiE**](https://github.com/horsicq/Detect-It-Easy/), bir dosyanÄ±n **ÅŸifreli** olup olmadÄ±ÄŸÄ±nÄ± ve **paketleyicileri** bulmayÄ± saÄŸlayan bir araÃ§tÄ±r.

### NeoPI

[**NeoPI**](https://github.com/CiscoCXSecurity/NeoPI), metin/skript dosyalarÄ±nda **ÅŸifrelenmiÅŸ** ve **ÅŸifrelenmiÅŸ** iÃ§eriÄŸi tespit etmek iÃ§in Ã§eÅŸitli **istatistiksel yÃ¶ntemler** kullanan bir Python betiÄŸidir. NeoPI'nin amaÃ§lanan amacÄ±, gizli web kabuk kodunun tespitine yardÄ±mcÄ± olmaktÄ±r.

### **php-malware-finder**

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder), **ÅŸifrelenmiÅŸ**/**ÅŸÃ¼pheli kodu** ve **malware**/web kabuklarÄ±nda sÄ±kÃ§a kullanÄ±lan **PHP** iÅŸlevlerini kullanan dosyalarÄ± tespit etmek iÃ§in elinden geleni yapar.

### Apple Binary Ä°mzalarÄ±

Bir **malware Ã¶rneÄŸi** kontrol ederken, yÃ¼rÃ¼tÃ¼lebilir dosyanÄ±n **imzasÄ±nÄ± kontrol etmek** her zaman Ã¶nemlidir, Ã§Ã¼nkÃ¼ imzayÄ± atan **geliÅŸtirici** zaten **malware ile iliÅŸkili** olabilir.
```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the appâ€™s contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```
## Tespit Teknikleri

### Dosya YÄ±ÄŸÄ±tÄ±

EÄŸer bir web sunucusunun **dosyalarÄ±nÄ± iÃ§eren bir klasÃ¶rÃ¼n** en son ne zaman gÃ¼ncellendiÄŸini biliyorsanÄ±z. **Web sunucusundaki tÃ¼m dosyalarÄ±n oluÅŸturulma ve deÄŸiÅŸtirilme tarihlerini kontrol edin** ve herhangi bir tarih **ÅŸÃ¼pheli** ise o dosyayÄ± kontrol edin.

### Temel Ã‡izgiler

Bir klasÃ¶rÃ¼n dosyalarÄ±nÄ±n **deÄŸiÅŸtirilmemesi gerektiÄŸini** biliyorsanÄ±z, klasÃ¶rÃ¼n **orijinal dosyalarÄ±nÄ±n karma deÄŸerini hesaplayabilir** ve onlarÄ± **mevcut olanlarla karÅŸÄ±laÅŸtÄ±rabilirsiniz**. DeÄŸiÅŸtirilen herhangi bir ÅŸey **ÅŸÃ¼pheli** olacaktÄ±r.

### Ä°statistiksel Analiz

Bilgiler loglarda kaydedildiÄŸinde, bir web sunucusunun her bir dosyasÄ±nÄ±n kaÃ§ kez eriÅŸildiÄŸini gibi **istatistikleri kontrol edebilirsiniz**, Ã§Ã¼nkÃ¼ bir web kabuÄŸu en Ã§ok olanlardan biri olabilir.
