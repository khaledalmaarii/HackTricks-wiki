# æ¶æ„è½¯ä»¶åˆ†æ

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## å–è¯å¤‡å¿˜å•

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/)

## åœ¨çº¿æœåŠ¡

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)
* [Any.Run](https://any.run/)

## ç¦»çº¿é˜²ç—…æ¯’å’Œæ£€æµ‹å·¥å…·

### Yara

#### å®‰è£…
```bash
sudo apt-get install -y yara
```
#### å‡†å¤‡è§„åˆ™

ä½¿ç”¨æ­¤è„šæœ¬ä» github ä¸‹è½½å¹¶åˆå¹¶æ‰€æœ‰ yara æ¶æ„è½¯ä»¶è§„åˆ™ï¼š[https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\
åˆ›å»º _**rules**_ ç›®å½•å¹¶æ‰§è¡Œè¯¥è„šæœ¬ã€‚è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º _**malware\_rules.yar**_ çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æ¶æ„è½¯ä»¶çš„ yara è§„åˆ™ã€‚
```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```
#### æ‰«æ
```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```
#### YaraGen: æ£€æŸ¥æ¶æ„è½¯ä»¶å¹¶åˆ›å»ºè§„åˆ™

æ‚¨å¯ä»¥ä½¿ç”¨å·¥å…· [**YaraGen**](https://github.com/Neo23x0/yarGen) ä»äºŒè¿›åˆ¶æ–‡ä»¶ç”Ÿæˆ yara è§„åˆ™ã€‚æŸ¥çœ‹è¿™äº›æ•™ç¨‹ï¼š[**Part 1**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**Part 2**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**Part 3**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)
```bash
python3 yarGen.py --update
python3.exe yarGen.py --excludegood -m  ../../mals/
```
### ClamAV

#### å®‰è£…
```
sudo apt-get install -y clamav
```
#### æ‰«æ
```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```
### [Capa](https://github.com/mandiant/capa)

**Capa**æ£€æµ‹å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„æ½œåœ¨æ¶æ„åŠŸèƒ½ï¼šPEã€ELFã€.NETã€‚å› æ­¤ï¼Œå®ƒä¼šå‘ç°è¯¸å¦‚Att\&ckæˆ˜æœ¯æˆ–å¯ç–‘åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š

- æ£€æŸ¥OutputDebugStringé”™è¯¯
- ä½œä¸ºæœåŠ¡è¿è¡Œ
- åˆ›å»ºè¿›ç¨‹

è·å–å®ƒåœ¨[**Githubå­˜å‚¨åº“**](https://github.com/mandiant/capa)ä¸­ã€‚

### IOCs

IOCè¡¨ç¤ºå¨èƒæŒ‡æ ‡ã€‚IOCæ˜¯ä¸€ç»„**ç”¨äºè¯†åˆ«**ä¸€äº›æ½œåœ¨ä¸å—æ¬¢è¿çš„è½¯ä»¶æˆ–å·²ç¡®è®¤**æ¶æ„è½¯ä»¶**çš„æ¡ä»¶ã€‚è“é˜Ÿä½¿ç”¨è¿™ç§å®šä¹‰æ¥åœ¨å…¶**ç³»ç»Ÿ**å’Œ**ç½‘ç»œ**ä¸­**æœç´¢æ­¤ç±»æ¶æ„æ–‡ä»¶**ã€‚\
å…±äº«è¿™äº›å®šä¹‰éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå½“åœ¨è®¡ç®—æœºä¸­è¯†åˆ«æ¶æ„è½¯ä»¶å¹¶ä¸ºè¯¥æ¶æ„è½¯ä»¶åˆ›å»ºIOCæ—¶ï¼Œå…¶ä»–è“é˜Ÿå¯ä»¥ä½¿ç”¨å®ƒæ›´å¿«åœ°è¯†åˆ«æ¶æ„è½¯ä»¶ã€‚

åˆ›å»ºæˆ–ä¿®æ”¹IOCçš„å·¥å…·æ˜¯[**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**ã€‚**\
æ‚¨å¯ä»¥ä½¿ç”¨è¯¸å¦‚[**Redline**](https://www.fireeye.com/services/freeware/redline.html)ä¹‹ç±»çš„å·¥å…·åœ¨è®¾å¤‡ä¸­**æœç´¢å®šä¹‰çš„IOC**ã€‚

### Loki

[**Loki**](https://github.com/Neo23x0/Loki)æ˜¯ä¸€ä¸ªç”¨äºç®€å•å¨èƒæŒ‡æ ‡çš„æ‰«æå™¨ã€‚\
æ£€æµ‹åŸºäºå››ç§æ£€æµ‹æ–¹æ³•ï¼š
```
1. File Name IOC
Regex match on full file path/name

2. Yara Rule Check
Yara signature matches on file data and process memory

3. Hash Check
Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files

4. C2 Back Connect Check
Compares process connection endpoints with C2 IOCs (new since version v.10)
```
### Linux æ¶æ„è½¯ä»¶æ£€æµ‹

[**Linux æ¶æ„è½¯ä»¶æ£€æµ‹ (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/) æ˜¯ä¸€ä¸ªé’ˆå¯¹ Linux çš„æ¶æ„è½¯ä»¶æ‰«æå™¨ï¼Œé‡‡ç”¨ GNU GPLv2 è®¸å¯å‘å¸ƒï¼Œæ—¨åœ¨è§£å†³å…±äº«æ‰˜ç®¡ç¯å¢ƒä¸­é¢ä¸´çš„å¨èƒã€‚å®ƒåˆ©ç”¨æ¥è‡ªç½‘ç»œè¾¹ç¼˜å…¥ä¾µæ£€æµ‹ç³»ç»Ÿçš„å¨èƒæ•°æ®ï¼Œæå–æ­£åœ¨æ”»å‡»ä¸­ä½¿ç”¨çš„æ¶æ„è½¯ä»¶ï¼Œå¹¶ç”Ÿæˆç”¨äºæ£€æµ‹çš„ç­¾åã€‚æ­¤å¤–ï¼Œå¨èƒæ•°æ®è¿˜æ¥è‡ªç”¨æˆ·æäº¤çš„æ•°æ®ï¼Œä½¿ç”¨ LMD ç»“è´¦åŠŸèƒ½ä»¥åŠæ¶æ„è½¯ä»¶ç¤¾åŒºèµ„æºã€‚

### rkhunter

ç±»ä¼¼ [**rkhunter**](http://rkhunter.sourceforge.net) è¿™æ ·çš„å·¥å…·å¯ç”¨äºæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨çš„ **rootkits** å’Œæ¶æ„è½¯ä»¶ã€‚
```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```
### FLOSS

[**FLOSS**](https://github.com/mandiant/flare-floss) æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå°†å°è¯•ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­æŸ¥æ‰¾æ··æ·†çš„å­—ç¬¦ä¸²ã€‚

### PEpper

[PEpper](https://github.com/Th3Hurrican3/PEpper) æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä¸€äº›åŸºæœ¬å†…å®¹ï¼ˆäºŒè¿›åˆ¶æ•°æ®ã€ç†µã€URL å’Œ IPã€ä¸€äº› yara è§„åˆ™ï¼‰ã€‚

### PEstudio

[PEstudio](https://www.winitor.com/download) æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥è·å– Windows å¯æ‰§è¡Œæ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¦‚å¯¼å…¥ã€å¯¼å‡ºã€å¤´éƒ¨ï¼Œè¿˜ä¼šæ£€æŸ¥ç—…æ¯’æ€»æ•°å¹¶æŸ¥æ‰¾æ½œåœ¨çš„ Att\&ck æŠ€æœ¯ã€‚

### Detect It Easy(DiE)

[**DiE**](https://github.com/horsicq/Detect-It-Easy/) æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºæ£€æµ‹æ–‡ä»¶æ˜¯å¦åŠ å¯†ï¼Œå¹¶æŸ¥æ‰¾æ‰“åŒ…ç¨‹åºã€‚

### NeoPI

[**NeoPI**](https://github.com/CiscoCXSecurity/NeoPI) æ˜¯ä¸€ä¸ªä½¿ç”¨å„ç§ç»Ÿè®¡æ–¹æ³•æ¥æ£€æµ‹æ–‡æœ¬/è„šæœ¬æ–‡ä»¶ä¸­æ··æ·†å’ŒåŠ å¯†å†…å®¹çš„ Python è„šæœ¬ã€‚NeoPI çš„é¢„æœŸç›®çš„æ˜¯å¸®åŠ©æ£€æµ‹éšè—çš„ Web shell ä»£ç ã€‚

### **php-malware-finder**

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder) å°½æœ€å¤§åŠªåŠ›æ£€æµ‹æ··æ·†/å¯ç–‘ä»£ç ä»¥åŠä½¿ç”¨ PHP å‡½æ•°çš„æ–‡ä»¶ï¼Œè¿™äº›å‡½æ•°é€šå¸¸åœ¨æ¶æ„è½¯ä»¶/webshell ä¸­ä½¿ç”¨ã€‚

### Apple äºŒè¿›åˆ¶ç­¾å

åœ¨æ£€æŸ¥ä¸€äº›æ¶æ„è½¯ä»¶æ ·æœ¬æ—¶ï¼Œæ‚¨åº”å§‹ç»ˆæ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶çš„ç­¾åï¼Œå› ä¸ºç­¾ç½²å®ƒçš„å¼€å‘äººå‘˜å¯èƒ½å·²ä¸æ¶æ„è½¯ä»¶ç›¸å…³è”ã€‚
```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the appâ€™s contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```
## æ£€æµ‹æŠ€æœ¯

### æ–‡ä»¶å †å 

å¦‚æœä½ çŸ¥é“æŸä¸ªåŒ…å«**webæœåŠ¡å™¨æ–‡ä»¶**çš„æ–‡ä»¶å¤¹æ˜¯åœ¨**æŸä¸ªæ—¥æœŸ**ä¸Šæ¬¡æ›´æ–°çš„ã€‚**æ£€æŸ¥**æ‰€æœ‰**webæœåŠ¡å™¨æ–‡ä»¶**çš„åˆ›å»ºå’Œä¿®æ”¹æ—¥æœŸï¼Œå¦‚æœæœ‰ä»»ä½•**å¯ç–‘æ—¥æœŸ**ï¼Œåˆ™æ£€æŸ¥è¯¥æ–‡ä»¶ã€‚

### åŸºçº¿

å¦‚æœæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶**ä¸åº”è¯¥è¢«ä¿®æ”¹**ï¼Œä½ å¯ä»¥è®¡ç®—æ–‡ä»¶å¤¹ä¸­**åŸå§‹æ–‡ä»¶**çš„**å“ˆå¸Œå€¼**ï¼Œå¹¶å°†å…¶ä¸**å½“å‰æ–‡ä»¶**è¿›è¡Œ**æ¯”è¾ƒ**ã€‚ä»»ä½•è¢«ä¿®æ”¹çš„å†…å®¹éƒ½ä¼š**å¼•èµ·æ€€ç–‘**ã€‚

### ç»Ÿè®¡åˆ†æ

å½“ä¿¡æ¯ä¿å­˜åœ¨æ—¥å¿—ä¸­æ—¶ï¼Œä½ å¯ä»¥**æ£€æŸ¥ç»Ÿè®¡æ•°æ®ï¼Œæ¯”å¦‚æ¯ä¸ªwebæœåŠ¡å™¨æ–‡ä»¶è¢«è®¿é—®çš„æ¬¡æ•°ï¼Œå› ä¸ºweb shellå¯èƒ½æ˜¯å…¶ä¸­ä¹‹ä¸€**ã€‚
