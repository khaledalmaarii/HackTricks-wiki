# Analiza zlonamernog softvera

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## ForenziÄki CheatSheets

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/)

## Online usluge

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)
* [Any.Run](https://any.run/)

## Offline antivirusni i detekcioni alati

### Yara

#### Instalacija
```bash
sudo apt-get install -y yara
```
#### Priprema pravila

Koristite ovaj skript za preuzimanje i spajanje svih yara pravila za maliciozni softver sa github-a: [https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\
Kreirajte direktorijum _**rules**_ i izvrÅ¡ite skriptu. Ovo Ä‡e kreirati fajl nazvan _**malware\_rules.yar**_ koji sadrÅ¾i sva yara pravila za maliciozni softver.
```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```
#### Skeniranje

Skeniranje je prvi korak u analizi malvera. Cilj skeniranja je identifikacija malicioznih datoteka ili aktivnosti na sistemu. Postoje razliÄiti alati i tehnike koje se mogu koristiti za skeniranje malvera.

##### StatiÄko skeniranje

StatiÄko skeniranje se odnosi na analizu malvera bez njegovog izvrÅ¡avanja. Ovo se moÅ¾e postiÄ‡i pregledom binarnih datoteka, dekompilacijom izvrÅ¡nih datoteka ili analizom koda. StatiÄko skeniranje moÅ¾e otkriti poznate malvera na osnovu prepoznatljivih potpisa ili karakteristika.

##### DinamiÄko skeniranje

DinamiÄko skeniranje se odnosi na analizu malvera tokom njegovog izvrÅ¡avanja. Ovo se moÅ¾e postiÄ‡i pokretanjem malvera u kontrolisanom okruÅ¾enju i praÄ‡enjem njegovih aktivnosti. DinamiÄko skeniranje moÅ¾e otkriti skrivene ili promenljive funkcionalnosti malvera.

##### HeuristiÄko skeniranje

HeuristiÄko skeniranje se odnosi na upotrebu heuristiÄkih pravila ili algoritama za otkrivanje nepoznatih malvera. Ovo se moÅ¾e postiÄ‡i analizom ponaÅ¡anja malvera ili identifikacijom sumnjivih aktivnosti. HeuristiÄko skeniranje moÅ¾e otkriti nove ili prilagoÄ‘ene malvere koji se ne prepoznaju putem statiÄkog skeniranja.

##### Skeniranje mreÅ¾e

Skeniranje mreÅ¾e se odnosi na identifikaciju malvera na mreÅ¾nom nivou. Ovo se moÅ¾e postiÄ‡i analizom mreÅ¾nog saobraÄ‡aja, detekcijom sumnjivih veza ili identifikacijom malicioznih IP adresa. Skeniranje mreÅ¾e moÅ¾e otkriti malvere koji se Å¡ire putem mreÅ¾e ili koriste mreÅ¾ne resurse za svoje aktivnosti.

##### Skeniranje memorije

Skeniranje memorije se odnosi na analizu malvera u operativnoj memoriji. Ovo se moÅ¾e postiÄ‡i pregledom procesa, identifikacijom sumnjivih ili zaraÅ¾enih procesa, ili pronalaÅ¾enjem malicioznih injekcija u memoriji. Skeniranje memorije moÅ¾e otkriti malvere koji se izvrÅ¡avaju u memoriji i izbegavaju detekciju na disku.

##### Skeniranje registra

Skeniranje registra se odnosi na analizu malvera u Windows registru. Ovo se moÅ¾e postiÄ‡i identifikacijom sumnjivih unosa registra, pronalaÅ¾enjem malicioznih kljuÄeva ili analizom promena u registru. Skeniranje registra moÅ¾e otkriti malvere koji koriste registar za svoje aktivnosti ili za odrÅ¾avanje upornosti.

##### Skeniranje fajl sistema

Skeniranje fajl sistema se odnosi na analizu malvera na nivou fajl sistema. Ovo se moÅ¾e postiÄ‡i pregledom fajlova, identifikacijom sumnjivih ili zaraÅ¾enih fajlova, ili pronalaÅ¾enjem skrivenih fajlova. Skeniranje fajl sistema moÅ¾e otkriti malvere koji se kriju u fajlovima ili koriste fajl sistem za Å¡irenje.
```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```
#### YaraGen: Proverite za zlonamerni softver i kreirajte pravila

MoÅ¾ete koristiti alatku [**YaraGen**](https://github.com/Neo23x0/yarGen) da generiÅ¡ete yara pravila iz binarnog fajla. Pogledajte ove tutorijale: [**Deo 1**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**Deo 2**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**Deo 3**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)
```bash
python3 yarGen.py --update
python3.exe yarGen.py --excludegood -m  ../../mals/
```
### ClamAV

#### Instalacija

Da biste instalirali ClamAV, moÅ¾ete koristiti sledeÄ‡e komande:

```bash
sudo apt-get update
sudo apt-get install clamav
```

#### AÅ¾uriranje baza podataka

Nakon instalacije, trebali biste aÅ¾urirati baze podataka ClamAV-a. To moÅ¾ete uraditi pomoÄ‡u sledeÄ‡e komande:

```bash
sudo freshclam
```

#### Skeniranje fajlova

Da biste skenirali odreÄ‘eni fajl ili direktorijum, koristite sledeÄ‡u komandu:

```bash
clamscan <putanja_do_fajla_ili_direktorijuma>
```

#### IzveÅ¡taj o skeniranju

Da biste generisali izveÅ¡taj o skeniranju, koristite sledeÄ‡u komandu:

```bash
clamscan -r --bell -i <putanja_do_fajla_ili_direktorijuma> > izvestaj.txt
```

Ova komanda Ä‡e generisati izveÅ¡taj o skeniranju i saÄuvati ga u fajlu "izvestaj.txt".
```
sudo apt-get install -y clamav
```
#### Skeniranje

Skeniranje je prvi korak u analizi malvera. Cilj skeniranja je identifikacija malicioznih datoteka ili aktivnosti na sistemu. Postoje razliÄiti alati i tehnike koje se mogu koristiti za skeniranje malvera.

##### Antivirus skeniranje

Antivirusni softver je jedan od najÄeÅ¡Ä‡ih alata koji se koristi za skeniranje malvera. On analizira datoteke i sistem kako bi pronaÅ¡ao potencijalno zlonamerne ili sumnjive aktivnosti. Antivirusni softver koristi bazu podataka sa potpisima malvera kako bi prepoznao poznate maliciozne datoteke. MeÄ‘utim, ova metoda ima ograniÄenja jer se oslanja samo na prepoznavanje poznatih malvera.

##### HeuristiÄko skeniranje

HeuristiÄko skeniranje je tehnika koja se koristi za otkrivanje novih ili nepoznatih malvera. Umesto da se oslanja na bazu podataka sa potpisima, heuristiÄko skeniranje analizira ponaÅ¡anje datoteka i sistema kako bi identifikovalo sumnjive aktivnosti. Ova tehnika moÅ¾e biti efikasnija u otkrivanju novih malvera, ali takoÄ‘e moÅ¾e generisati laÅ¾no pozitivne rezultate.

##### Analiza paketa

Analiza paketa je proces pregledanja mreÅ¾nog saobraÄ‡aja kako bi se identifikovali maliciozni ili sumnjivi paketi. Ova tehnika moÅ¾e otkriti malver koji koristi mreÅ¾u za komunikaciju sa kontrolnim serverima ili za prenos podataka. Alati poput Wireshark-a mogu se koristiti za analizu paketa.

##### Analiza registra

Analiza registra je proces pregledanja registra sistema kako bi se identifikovali maliciozni unos ili promene. Malveri Äesto koriste registar za postavljanje svojih kljuÄeva i vrednosti kako bi ostali prisutni na sistemu. Pregledanje registra moÅ¾e otkriti sumnjive unose koji ukazuju na prisustvo malvera.

##### Analiza datoteka

Analiza datoteka ukljuÄuje pregledanje malicioznih datoteka kako bi se identifikovali njihovi karakteristiÄni atributi. Ovo moÅ¾e ukljuÄivati pregledanje metapodataka, analizu sadrÅ¾aja datoteke ili izvrÅ¡avanje datoteke u sandbox okruÅ¾enju radi identifikacije malicioznih aktivnosti.

##### Analiza ponaÅ¡anja

Analiza ponaÅ¡anja je proces praÄ‡enja aktivnosti malvera na sistemu kako bi se identifikovali njegovi koraci i efekti. Ovo moÅ¾e ukljuÄivati praÄ‡enje mreÅ¾ne komunikacije, promene u sistemskim datotekama ili registrovanje aktivnosti u logovima. PraÄ‡enje ponaÅ¡anja malvera moÅ¾e pruÅ¾iti uvid u njegove funkcionalnosti i ciljeve.

##### Analiza malvera u sandbox okruÅ¾enju

Sandbox okruÅ¾enje je izolovano okruÅ¾enje u kojem se malver moÅ¾e izvrÅ¡iti radi analize njegovih aktivnosti. Ovo omoguÄ‡ava istraÅ¾ivaÄima da prate ponaÅ¡anje malvera i identifikuju njegove funkcionalnosti bez rizika od infekcije sistema. Sandbox okruÅ¾enje moÅ¾e biti korisno za otkrivanje skrivenih funkcionalnosti malvera ili za identifikaciju novih varijanti.

##### Analiza malvera u virtualnoj maÅ¡ini

Virtualna maÅ¡ina je softversko okruÅ¾enje koje emulira fiziÄki raÄunar. Analiza malvera u virtualnoj maÅ¡ini omoguÄ‡ava istraÅ¾ivaÄima da izvrÅ¡e malver u kontrolisanom okruÅ¾enju i prate njegove aktivnosti. Ovo moÅ¾e biti korisno za identifikaciju malvera koji su dizajnirani da izbegnu otkrivanje u sandbox okruÅ¾enju.

##### Analiza malvera u kontejneru

Kontejner je izolovano okruÅ¾enje koje omoguÄ‡ava izvrÅ¡avanje aplikacija i procesa. Analiza malvera u kontejneru omoguÄ‡ava istraÅ¾ivaÄima da izvrÅ¡e malver u izolovanom okruÅ¾enju i prate njegove aktivnosti. Ovo moÅ¾e biti korisno za identifikaciju malvera koji su dizajnirani da izbegnu otkrivanje u virtualnim maÅ¡inama ili sandbox okruÅ¾enjima.

##### Analiza malvera u oblaku

Analiza malvera u oblaku omoguÄ‡ava istraÅ¾ivaÄima da izvrÅ¡e malver na udaljenom serveru i prate njegove aktivnosti. Ovo moÅ¾e biti korisno za identifikaciju malvera koji su dizajnirani da izbegnu otkrivanje u lokalnim okruÅ¾enjima.
```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```
### [Capa](https://github.com/mandiant/capa)

**Capa** otkriva potencijalno zlonamerne **sposobnosti** u izvrÅ¡nim datotekama: PE, ELF, .NET. Dakle, pronaÄ‡i Ä‡e stvari poput Att\&ck taktika ili sumnjivih sposobnosti kao Å¡to su:

* provera greÅ¡ke OutputDebugString
* pokretanje kao servis
* kreiranje procesa

Preuzmite ga sa [**Github repozitorijuma**](https://github.com/mandiant/capa).

### IOC-ovi

IOC znaÄi Indikator kompromitacije. IOC je skup **uslova koji identifikuju** potencijalno neÅ¾eljeni softver ili potvrÄ‘eni **malver**. Plavi timovi koriste ovu vrstu definicije da **traÅ¾e ovu vrstu zlonamernih datoteka** u svojim **sistemima** i **mreÅ¾ama**.\
Deljenje ovih definicija je veoma korisno jer kada se malver identifikuje na raÄunaru i IOC za taj malver se kreira, drugi Plavi timovi ga mogu koristiti da brÅ¾e identifikuju malver.

Alatka za kreiranje ili modifikaciju IOC-ova je [**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**.**\
MoÅ¾ete koristiti alatke poput [**Redline**](https://www.fireeye.com/services/freeware/redline.html) da **traÅ¾ite definisane IOC-ove na ureÄ‘aju**.

### Loki

[**Loki**](https://github.com/Neo23x0/Loki) je skener za jednostavne indikatore kompromitacije.\
Detekcija se zasniva na Äetiri metode detekcije:
```
1. File Name IOC
Regex match on full file path/name

2. Yara Rule Check
Yara signature matches on file data and process memory

3. Hash Check
Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files

4. C2 Back Connect Check
Compares process connection endpoints with C2 IOCs (new since version v.10)
```
### Linux Malware Detect

[**Linux Malware Detect (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/) je skener zlonamernog softvera za Linux koji je objavljen pod GNU GPLv2 licencom, a dizajniran je za pretnje sa kojima se susreÄ‡u u deljenim hosting okruÅ¾enjima. Koristi podatke o pretnjama sa sistema za otkrivanje upada na mreÅ¾nom rubu kako bi izdvojio zlonamerni softver koji se aktivno koristi u napadima i generiÅ¡e potpise za detekciju. Pored toga, podaci o pretnjama se takoÄ‘e dobijaju iz korisniÄkih prijava putem funkcije LMD checkout i resursa zajednice za zlonamerni softver.

### rkhunter

Alati poput [**rkhunter**](http://rkhunter.sourceforge.net) mogu se koristiti za proveru datoteÄnog sistema radi moguÄ‡ih **rootkitova** i zlonamernog softvera.
```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```
### FLOSS

[**FLOSS**](https://github.com/mandiant/flare-floss) je alat koji Ä‡e pokuÅ¡ati da pronaÄ‘e obfuskirane stringove unutar izvrÅ¡nih datoteka koristeÄ‡i razliÄite tehnike.

### PEpper

[PEpper](https://github.com/Th3Hurrican3/PEpper) proverava neke osnovne stvari unutar izvrÅ¡ne datoteke (binarni podaci, entropija, URL-ovi i IP adrese, neka pravila yara).

### PEstudio

[PEstudio](https://www.winitor.com/download) je alat koji omoguÄ‡ava dobijanje informacija o Windows izvrÅ¡nim datotekama kao Å¡to su uvozi, izvozi, zaglavlja, ali takoÄ‘e Ä‡e proveriti virus total i pronaÄ‡i potencijalne Att\&ck tehnike.

### Detect It Easy(DiE)

[**DiE**](https://github.com/horsicq/Detect-It-Easy/) je alat za otkrivanje da li je datoteka **Å¡ifrovana** i takoÄ‘e pronalazi **pakere**.

### NeoPI

[**NeoPI**](https://github.com/CiscoCXSecurity/NeoPI) je Python skripta koja koristi razne **statistiÄke metode** za otkrivanje **obfuskiranog** i **Å¡ifrovanog** sadrÅ¾aja unutar tekstualnih/skriptnih datoteka. Namera NeoPI-ja je da pomogne u **otkrivanju skrivenog koda web Å¡koljki**.

### **php-malware-finder**

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder) se najbolje trudi da otkrije **obfuskirani**/**sumnjivi kod** kao i datoteke koje koriste **PHP** funkcije Äesto koriÅ¡tene u **malverima**/web Å¡koljkama.

### Apple binarne potpise

Prilikom provere nekog **uzorka malvera** uvek treba **proveriti potpis** binarne datoteke jer se **razvijaÄ** koji ga je potpisao moÅ¾e veÄ‡ **povezivati** sa **malverom**.
```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the appâ€™s contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```
## Tehnike otkrivanja

### Stacking datoteka

Ako znate da se neki folder koji sadrÅ¾i **datoteke** veb servera **poslednji put aÅ¾urirao na neki datum**, **proverite** datum kada su sve **datoteke** na veb serveru kreirane i izmenjene, i ako je bilo koji datum **sumnjiv**, proverite tu datoteku.

### Referentne vrednosti

Ako se **datoteke** u folderu **ne bi trebale menjati**, moÅ¾ete izraÄunati **heÅ¡** **originalnih datoteka** u folderu i **uporediti** ih sa **trenutnim**. Sve Å¡to je izmenjeno biÄ‡e **sumnjivo**.

### StatistiÄka analiza

Kada se informacije Äuvaju u logovima, moÅ¾ete **proveriti statistiku kao Å¡to je koliko puta je svaka datoteka veb servera pristupana, jer web Å¡el moÅ¾e biti jedan od najÄeÅ¡Ä‡ih**.

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **oglaÅ¡avanje vaÅ¡e kompanije na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
