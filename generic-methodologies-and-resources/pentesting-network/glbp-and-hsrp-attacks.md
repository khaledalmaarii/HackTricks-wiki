# Napadi na GLBP i HSRP

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>


## Pregled FHRP preuzimanja

### Uvid u FHRP
FHRP je dizajniran da obezbedi otpornost mreÅ¾e spajanjem viÅ¡e rutera u jedinicu, Äime se poboljÅ¡ava raspodela optereÄ‡enja i tolerancija na greÅ¡ke. Cisco Systems je u ovoj grupi predstavio prominentne protokole kao Å¡to su GLBP i HSRP.

### Pregled GLBP protokola
GLBP, koji je kreirao Cisco, funkcioniÅ¡e na TCP/IP sloju, koristeÄ‡i UDP na portu 3222 za komunikaciju. Ruteri u GLBP grupi razmenjuju "hello" pakete na intervalima od 3 sekunde. Ako ruter ne poÅ¡alje ove pakete u roku od 10 sekundi, pretpostavlja se da je van mreÅ¾e. MeÄ‘utim, ovi tajmeri nisu fiksni i mogu se menjati.

### GLBP operacije i raspodela optereÄ‡enja
GLBP se istiÄe omoguÄ‡avanjem raspodele optereÄ‡enja izmeÄ‘u rutera koriÅ¡Ä‡enjem jedne virtuelne IP adrese u kombinaciji sa viÅ¡e virtuelnih MAC adresa. U GLBP grupi, svaki ruter uÄestvuje u prosleÄ‘ivanju paketa. Za razliku od HSRP/VRRP, GLBP pruÅ¾a pravo balansiranje optereÄ‡enja kroz nekoliko mehanizama:

- **Balansiranje optereÄ‡enja zavisno od hosta:** OdrÅ¾ava konzistentno dodeljivanje AVF MAC adrese hostu, Å¡to je vaÅ¾no za stabilne NAT konfiguracije.
- **Balansiranje optereÄ‡enja rotirajuÄ‡i:** Podrazumevani pristup, rotira dodeljivanje AVF MAC adrese meÄ‘u zahtevajuÄ‡im hostovima.
- **Balansiranje optereÄ‡enja sa teÅ¾inskim rotiranjem:** Raspodeljuje optereÄ‡enje na osnovu unapred definisanih "teÅ¾inskih" metrika.

### KljuÄni komponenti i terminologija u GLBP-u
- **AVG (Active Virtual Gateway):** Glavni ruter, odgovoran za dodeljivanje MAC adresa ruterima u grupi.
- **AVF (Active Virtual Forwarder):** Ruter koji je zaduÅ¾en za upravljanje mreÅ¾nim saobraÄ‡ajem.
- **GLBP prioritet:** Metrika koja odreÄ‘uje AVG, poÄevÅ¡i od podrazumevane vrednosti 100 i kreÄ‡uÄ‡i se u rasponu od 1 do 255.
- **GLBP teÅ¾ina:** OdraÅ¾ava trenutno optereÄ‡enje rutera, koje se moÅ¾e ruÄno podeÅ¡avati ili putem praÄ‡enja objekata.
- **GLBP virtuelna IP adresa:** SluÅ¾i kao podrazumevani gateway mreÅ¾e za sve povezane ureÄ‘aje.

Za interakciju, GLBP koristi rezervisanu multicast adresu 224.0.0.102 i UDP port 3222. Ruteri Å¡alju "hello" pakete na intervalima od 3 sekunde, a smatraju se neoperativnim ako se paket propusti tokom trajanja od 10 sekundi.

### Mekanizam napada na GLBP
NapadaÄ moÅ¾e postati primarni ruter slanjem GLBP paketa sa najviÅ¡om vrednoÅ¡Ä‡u prioriteta (255). Ovo moÅ¾e dovesti do DoS ili MITM napada, omoguÄ‡avajuÄ‡i presretanje ili preusmeravanje saobraÄ‡aja.

### IzvrÅ¡avanje napada na GLBP pomoÄ‡u Lokija
[Loki](https://github.com/raizo62/loki_on_kali) moÅ¾e izvrÅ¡iti napad na GLBP ubacivanjem paketa sa postavljenim prioritetom i teÅ¾inom na 255. Koraci pre napada ukljuÄuju prikupljanje informacija poput virtuelne IP adrese, prisustva autentifikacije i vrednosti prioriteta rutera koriÅ¡Ä‡enjem alata poput Wireshark-a.

Koraci napada:
1. Prebacite se u promiskuitetni reÅ¾im i omoguÄ‡ite prosleÄ‘ivanje IP paketa.
2. Identifikujte ciljni ruter i dobijte njegovu IP adresu.
3. GeneriÅ¡ite laÅ¾ni ARP zahtev.
4. Ubacite zlonamerni GLBP paket, predstavljajuÄ‡i se kao AVG.
5. Dodelite sekundarnu IP adresu mreÅ¾nom interfejsu napadaÄa, oponaÅ¡ajuÄ‡i GLBP virtuelnu IP adresu.
6. Implementirajte SNAT za potpunu vidljivost saobraÄ‡aja.
7. Podesite rutiranje kako biste obezbedili kontinuiran pristup internetu putem originalnog AVG rutera.

PrateÄ‡i ove korake, napadaÄ se pozicionira kao "Äovek u sredini", sposoban da presretne i analizira mreÅ¾ni saobraÄ‡aj, ukljuÄujuÄ‡i neÅ¡ifrovane ili osetljive podatke.

Za demonstraciju, ovde su potrebni delovi komandi:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
### Pasivno objaÅ¡njenje HSRP hakovanja sa detaljima komandi

#### Pregled HSRP (Hot Standby Router/Redundancy Protocol) protokola
HSRP je Cisco vlasniÄki protokol dizajniran za redundanciju mreÅ¾nih gateway-a. OmoguÄ‡ava konfiguraciju viÅ¡e fiziÄkih rutera u jedinicu sa zajedniÄkom IP adresom. Ova logiÄka jedinica se upravlja od strane primarnog rutera koji je odgovoran za usmeravanje saobraÄ‡aja. Za razliku od GLBP-a koji koristi metrike kao Å¡to su prioritet i teÅ¾ina za balansiranje optereÄ‡enja, HSRP se oslanja na jedan aktivni ruter za upravljanje saobraÄ‡ajem.

#### Uloge i terminologija u HSRP-u
- **HSRP Aktivni Ruter**: UreÄ‘aj koji deluje kao gateway i upravlja protokom saobraÄ‡aja.
- **HSRP Rezervni Ruter**: Rezervni ruter koji je spreman da preuzme ulogu aktivnog rutera ukoliko on prestane da funkcioniÅ¡e.
- **HSRP Grupa**: Skup rutera koji saraÄ‘uju kako bi formirali jedan otporan virtuelni ruter.
- **HSRP MAC Adresa**: Virtuelna MAC adresa dodeljena logiÄkom ruteru u HSRP konfiguraciji.
- **HSRP Virtuelna IP Adresa**: Virtuelna IP adresa HSRP grupe koja deluje kao podrazumevani gateway za povezane ureÄ‘aje.

#### Verzije HSRP-a
HSRP dolazi u dve verzije, HSRPv1 i HSRPv2, koje se razlikuju uglavnom po kapacitetu grupe, koriÅ¡Ä‡enju multicast IP adresa i strukturi virtuelne MAC adrese. Protokol koristi odreÄ‘ene multicast IP adrese za razmenu informacija o uslugama, pri Äemu se Hello paketi Å¡alju svake 3 sekunde. Ruter se smatra neaktivnim ako ne primi paket u roku od 10 sekundi.

#### Mekanizam HSRP napada
HSRP napadi ukljuÄuju prisvajanje uloge Aktivnog Rutera ubacivanjem maksimalne vrednosti prioriteta. Ovo moÅ¾e dovesti do napada Man-In-The-Middle (MITM). Bitni koraci pre napada ukljuÄuju prikupljanje podataka o HSRP konfiguraciji, Å¡to se moÅ¾e uraditi koriÅ¡Ä‡enjem Wireshark-a za analizu saobraÄ‡aja.

#### Koraci za zaobilaÅ¾enje HSRP autentifikacije
1. SaÄuvajte mreÅ¾ni saobraÄ‡aj koji sadrÅ¾i HSRP podatke kao .pcap fajl.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. Izdvojite MD5 heÅ¡ove iz .pcap fajla koristeÄ‡i hsrp2john.py.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. Provalite MD5 heÅ¡ove koristeÄ‡i John the Ripper.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**IzvrÅ¡avanje HSRP ubacivanja pomoÄ‡u Lokija**

1. Pokrenite Lokija da biste identifikovali HSRP reklame.
2. Postavite mreÅ¾ni interfejs u promiskuitetni reÅ¾im i omoguÄ‡ite prosleÄ‘ivanje IP paketa.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Koristite Lokija da ciljate odreÄ‘eni ruter, unesite provaljenu HSRP lozinku i izvrÅ¡ite neophodne konfiguracije kako biste se predstavili kao Aktivni Ruter.
4. Nakon Å¡to preuzmete ulogu Aktivnog Rutera, konfiguriÅ¡ite mreÅ¾ni interfejs i IP tabele da biste presreli legitimni saobraÄ‡aj.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Izmenite rutiranje da biste usmerili saobraÄ‡aj preko bivÅ¡eg Aktivnog Rutera.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Koristite net-creds.py ili sliÄan alat da biste uhvatili akreditive iz presretnutog saobraÄ‡aja.
```shell
sudo python2 net-creds.py -i eth0
```

IzvrÅ¡avanje ovih koraka stavlja napadaÄa u poziciju da presretne i manipuliÅ¡e saobraÄ‡ajem, sliÄno postupku za GLBP hakovanje. Ovo istiÄe ranjivost redundansnih protokola poput HSRP-a i potrebu za snaÅ¾nim sigurnosnim merama.


## Reference
- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)


<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
