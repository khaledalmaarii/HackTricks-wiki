# GLBP ve HSRP SaldÄ±rÄ±larÄ±

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **HackTricks** ve **HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## FHRP KaÃ§Ä±rma Genel BakÄ±ÅŸ

### FHRP HakkÄ±nda Bilgiler
FHRP, birden fazla yÃ¶nlendiriciyi tek bir sanal birim haline getirerek aÄŸÄ±n saÄŸlamlÄ±ÄŸÄ±nÄ± saÄŸlamayÄ± amaÃ§layan bir protokol grubudur, bÃ¶ylece yÃ¼k daÄŸÄ±tÄ±mÄ± ve hata toleransÄ± artÄ±rÄ±lÄ±r. Cisco Systems, bu pakette GLBP ve HSRP gibi Ã¶nde gelen protokoller tanÄ±ttÄ±.

### GLBP ProtokolÃ¼ HakkÄ±nda Bilgiler
Cisco'nun oluÅŸturduÄŸu GLBP, TCP/IP yÄ±ÄŸÄ±nÄ±nda Ã§alÄ±ÅŸÄ±r ve iletiÅŸim iÃ§in UDP'yi 3222 numaralÄ± portta kullanÄ±r. GLBP grubundaki yÃ¶nlendiriciler, 3 saniyelik aralÄ±klarla "hello" paketleri alÄ±ÅŸveriÅŸi yapar. Bir yÃ¶nlendirici bu paketleri 10 saniye boyunca gÃ¶ndermezse, Ã§evrimdÄ±ÅŸÄ± olarak kabul edilir. Bununla birlikte, bu zamanlayÄ±cÄ±lar sabit deÄŸildir ve deÄŸiÅŸtirilebilir.

### GLBP Ä°ÅŸlemleri ve YÃ¼k DaÄŸÄ±tÄ±mÄ±
GLBP, tek bir sanal IP ile birleÅŸtirilmiÅŸ birden fazla sanal MAC adresi kullanarak yÃ¶nlendiriciler arasÄ±nda yÃ¼k daÄŸÄ±tÄ±mÄ±nÄ± saÄŸlayarak Ã¶ne Ã§Ä±kar. Bir GLBP grubunda, her yÃ¶nlendirici paket iletimine dahil olur. HSRP/VRRP'nin aksine, GLBP, ÅŸu mekanizmalar aracÄ±lÄ±ÄŸÄ±yla gerÃ§ek yÃ¼k dengelemesi sunar:

- **Ana Bilgisayara BaÄŸÄ±mlÄ± YÃ¼k Dengeleme:** Bir ana bilgisayara sÃ¼rekli AVF MAC adresi atamasÄ±nÄ± saÄŸlar, istikrarlÄ± NAT yapÄ±landÄ±rmalarÄ± iÃ§in Ã¶nemlidir.
- **Round-Robin YÃ¼k Dengeleme:** Alternatif AVF MAC adresi atama yaklaÅŸÄ±mÄ±, istekte bulunan ana bilgisayarlar arasÄ±nda dÃ¶nÃ¼ÅŸÃ¼mlÃ¼dÃ¼r.
- **AÄŸÄ±rlÄ±klÄ± Round-Robin YÃ¼k Dengeleme:** Ã–nceden belirlenmiÅŸ "AÄŸÄ±rlÄ±k" metriklerine gÃ¶re yÃ¼kÃ¼ daÄŸÄ±tÄ±r.

### GLBP'de Ana BileÅŸenler ve Terimler
- **AVG (Aktif Sanal AÄŸ GeÃ§idi):** MAC adreslerini eÅŸ yÃ¶nlendiricilere atamaktan sorumlu ana yÃ¶nlendirici.
- **AVF (Aktif Sanal YÃ¶nlendirici):** AÄŸ trafiÄŸini yÃ¶netmek iÃ§in belirlenen bir yÃ¶nlendirici.
- **GLBP Ã–nceliÄŸi:** AVG'yi belirleyen bir Ã¶lÃ§Ã¼t, varsayÄ±lan olarak 100'den baÅŸlar ve 1 ile 255 arasÄ±nda deÄŸiÅŸir.
- **GLBP AÄŸÄ±rlÄ±k:** Bir yÃ¶nlendiricideki mevcut yÃ¼kÃ¼ yansÄ±tÄ±r, manuel olarak veya Nesne Ä°zleme aracÄ±lÄ±ÄŸÄ±yla ayarlanabilir.
- **GLBP Sanal IP Adresi:** BaÄŸlÄ± tÃ¼m cihazlar iÃ§in aÄŸÄ±n varsayÄ±lan aÄŸ geÃ§idi olarak hizmet verir.

EtkileÅŸimler iÃ§in GLBP, 224.0.0.102 ayrÄ±lmÄ±ÅŸ Ã§oklu yayÄ±n adresini ve UDP portunu 3222 kullanÄ±r. YÃ¶nlendiriciler, 3 saniyelik aralÄ±klarla "hello" paketleri gÃ¶nderir ve bir paket 10 saniyelik bir sÃ¼re iÃ§inde kaÃ§Ä±rÄ±lÄ±rsa iÅŸlevsiz kabul edilir.

### GLBP SaldÄ±rÄ± MekanizmasÄ±
Bir saldÄ±rgan, en yÃ¼ksek Ã¶ncelik deÄŸerine (255) sahip bir GLBP paketi gÃ¶ndererek ana yÃ¶nlendirici haline gelebilir. Bu, trafik yakalama veya yÃ¶nlendirme izni veren DoS veya MITM saldÄ±rÄ±larÄ±na yol aÃ§abilir.

### Loki ile GLBP SaldÄ±rÄ±sÄ± GerÃ§ekleÅŸtirme
[Loki](https://github.com/raizo62/loki_on_kali), Ã¶nceden Ã¶ncelik ve aÄŸÄ±rlÄ±k deÄŸerleri 255'e ayarlanmÄ±ÅŸ bir paket enjekte ederek bir GLBP saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirebilir. SaldÄ±rÄ± Ã¶ncesi adÄ±mlar, Wireshark gibi araÃ§lar kullanÄ±larak sanal IP adresi, kimlik doÄŸrulama varlÄ±ÄŸÄ± ve yÃ¶nlendirici Ã¶ncelik deÄŸerlerini toplamayÄ± iÃ§erir.

SaldÄ±rÄ± AdÄ±mlarÄ±:
1. PromiskÃ¼ moduna geÃ§in ve IP yÃ¶nlendirmeyi etkinleÅŸtirin.
2. Hedef yÃ¶nlendiriciyi tanÄ±mlayÄ±n ve IP'sini alÄ±n.
3. Bir Ä°stek Ãœzerine ARP oluÅŸturun.
4. AVG'yi taklit eden kÃ¶tÃ¼ amaÃ§lÄ± bir GLBP paketi enjekte edin.
5. SaldÄ±rganÄ±n aÄŸ arabirimine ikincil bir IP adresi atayÄ±n ve GLBP sanal IP'yi yansÄ±tacak ÅŸekilde yapÄ±landÄ±rÄ±n.
6. Tam trafik gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ iÃ§in SNAT uygulayÄ±n.
7. Ä°nternet eriÅŸimini orijinal AVG yÃ¶nlendiricisi Ã¼zerinden devam ettirmek iÃ§in yÃ¶nlendirmeyi ayarlayÄ±n.

Bu adÄ±mlarÄ± takip ederek, saldÄ±rgan kendisini aÄŸ trafiÄŸini, ÅŸifrelenmemiÅŸ veya hassas verileri de iÃ§eren bir "ortadaki adam" olarak konumlandÄ±rÄ±r.

Demonstrasyon iÃ§in gereken komut parÃ§alarÄ± aÅŸaÄŸÄ±da verilmiÅŸtir:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
### HSRP SaldÄ±rÄ± MekanizmasÄ±

HSRP saldÄ±rÄ±larÄ±, En YÃ¼ksek Ã–ncelik DeÄŸerini enjekte ederek Etkin YÃ¶nlendirici'nin rolÃ¼nÃ¼ zorla ele geÃ§irmeyi iÃ§erir. Bu, Orta Adam (MITM) saldÄ±rÄ±sÄ±na yol aÃ§abilir. Temel saldÄ±rÄ± Ã¶ncesi adÄ±mlar arasÄ±nda HSRP kurulumu hakkÄ±nda veri toplamak bulunur, bu Wireshark kullanÄ±larak trafiÄŸin analiz edilmesiyle gerÃ§ekleÅŸtirilebilir.

#### HSRP Kimlik DoÄŸrulamasÄ±nÄ± Atlayma AdÄ±mlarÄ±
1. HSRP verilerini iÃ§eren aÄŸ trafiÄŸini .pcap dosyasÄ± olarak kaydedin.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. .pcap dosyasÄ±ndan MD5 karma deÄŸerlerini hsrp2john.py kullanarak Ã§Ä±karÄ±n.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. John the Ripper kullanarak MD5 karma deÄŸerlerini kÄ±rÄ±n.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Loki ile HSRP Enjeksiyonu GerÃ§ekleÅŸtirme**

1. HSRP reklamlarÄ±nÄ± tanÄ±mlamak iÃ§in Loki'yi baÅŸlatÄ±n.
2. AÄŸ arayÃ¼zÃ¼nÃ¼ promiscuous moduna ayarlayÄ±n ve IP yÃ¶nlendirmeyi etkinleÅŸtirin.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Loki'yi belirli yÃ¶nlendiriciyi hedeflemek iÃ§in kullanÄ±n, kÄ±rÄ±lmÄ±ÅŸ HSRP ÅŸifresini girin ve Etkin YÃ¶nlendirici'yi taklit etmek iÃ§in gerekli yapÄ±landÄ±rmalarÄ± yapÄ±n.
4. Etkin YÃ¶nlendirici rolÃ¼nÃ¼ aldÄ±ktan sonra, aÄŸ arayÃ¼zÃ¼nÃ¼ ve IP tablolarÄ±nÄ± yapÄ±landÄ±rarak meÅŸru trafiÄŸi engelleyin.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Trafik yÃ¶nlendirmek iÃ§in yÃ¶nlendirme tablosunu deÄŸiÅŸtirin ve Ã¶nceki Etkin YÃ¶nlendirici Ã¼zerinden yÃ¶nlendirin.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Yakalanan trafiÄŸe ait kimlik bilgilerini almak iÃ§in net-creds.py veya benzer bir yardÄ±mcÄ± programÄ± kullanÄ±n.
```shell
sudo python2 net-creds.py -i eth0
```

Bu adÄ±mlarÄ± uygulamak, saldÄ±rganÄ± trafiÄŸi engellemek ve manipÃ¼le etmek iÃ§in bir konuma yerleÅŸtirir, GLBP ele geÃ§irmesi iÃ§in yapÄ±lan iÅŸleme benzer. Bu, HSRP gibi yedeklilik protokollerindeki zafiyeti ve saÄŸlam gÃ¼venlik Ã¶nlemlerine olan ihtiyacÄ± vurgular.
