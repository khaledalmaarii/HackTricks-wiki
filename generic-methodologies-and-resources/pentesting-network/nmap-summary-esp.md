# Podsumowanie Nmap (ESP)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
```
nmap -sV -sC -O -n -oA nmapscan 192.168.0.1/24
```
## Parametry

### Adresy IP do skanowania

* **`<ip>,<net/mask>`:** Wskazuje bezporednio adresy IP
* **`-iL <ips_file>`:** lista\_IPs
* **`-iR <number>`**: Liczba losowych adres贸w IP, mo偶na wykluczy mo偶liwe adresy IP za pomoc `--exclude <Ips>` lub `--excludefile <file>`.

### Odkrywanie urzdze

Domylnie Nmap uruchamia faz odkrywania skadajc si z: `-PA80 -PS443 -PE -PP`

* **`-sL`**: Nieinwazyjne, wywietla cele, wykonujc 偶dania **DNS** w celu rozwizania nazw. Jest przydatne, aby dowiedzie si, czy na przykad www.prueba.es/24 wszystkie adresy IP s naszymi celami.
* **`-Pn`**: **Brak pinga**. Jest to przydatne, jeli wiesz, 偶e wszystkie s aktywne (jeli nie, mo偶esz straci du偶o czasu, ale ta opcja r贸wnie偶 generuje faszywe negatywy m贸wice, 偶e nie s aktywne), zapobiega fazie odkrywania.
* **`-sn`** : **Brak skanowania port贸w**. Po zakoczeniu fazy rozpoznawczej nie skanuje port贸w. Jest stosunkowo dyskretny i umo偶liwia skanowanie maej sieci. Z uprawnieniami wysya ACK (-PA) do 80, SYN(-PS) do 443 oraz 偶danie echo i 偶danie Timestamp, bez uprawnie zawsze koczy poczenia. Jeli celem jest sie, u偶ywane jest tylko ARP(-PR). Jeli u偶ywane z inn opcj, odrzucane s tylko pakiety z tej innej opcji.
* **`-PR`**: **Ping ARP**. Jest u偶ywany domylnie podczas analizowania komputer贸w w naszej sieci, jest szybszy ni偶 pingi. Jeli nie chcesz u偶ywa pakiet贸w ARP, u偶yj `--send-ip`.
* **`-PS <ports>`**: Wysya pakiety SYN do port贸w, na kt贸re jeli odpowie SYN/ACK, oznacza to, 偶e port jest otwarty (odpowiada RST, aby nie zakoczy poczenia), jeli odpowie RST, port jest zamknity, a jeli nie odpowie, port jest nieosigalny. W przypadku braku uprawnie automatycznie u偶ywane jest pene poczenie. Jeli nie podano port贸w, wysyane jest na port 80.
* **`-PA <ports>`**: Jak poprzednia opcja, ale z ACK, poczenie obu daje lepsze wyniki.
* **`-PU <ports>`**: Celem jest przeciwno, wysyane s do port贸w, kt贸re powinny by zamknite. Niekt贸re firewalle sprawdzaj tylko poczenia TCP. Jeli port jest zamknity, odpowiada portem niedostpnym, jeli odpowiada innym icmp lub nie odpowiada, jest uznawany za niedostpny.
* **`-PE, -PP, -PM`** : ICMP PINGS: odpowied藕 echo, znacznik czasu i maska adresu. S wysyane, aby dowiedzie si, czy cel jest aktywny.
* **`-PY<ports>`**: Wysya sondy SCTP INIT domylnie do 80, mo偶e odpowiedzie INIT-ACK (otwarte) lub ABORT (zamknite) lub nic lub ICMP niedostpne (nieaktywne).
* **`-PO <protocols>`**: W nag贸wkach wskazany jest protok贸, domylnie 1 (ICMP), 2 (IGMP) i 4 (Encap IP). Dla protoko贸w ICMP, IGMP, TCP (6) i UDP (17) wysyane s nag贸wki protoko贸w, dla reszty wysyany jest tylko nag贸wek IP. Celem tego jest to, 偶e ze wzgldu na znieksztacenie nag贸wk贸w, odpowiedzi na niedostpny protok贸 lub odpowiedzi tego samego protokou s udzielane, aby dowiedzie si, czy jest dostpny.
* **`-n`**: Brak DNS
* **`-R`**: Zawsze DNS

### Techniki skanowania port贸w

* **`-sS`**: Nie koczy poczenia, wic nie pozostawia ladu, bardzo dobre, jeli mo偶na go u偶y (uprawnienia). Jest to domylnie u偶ywane.
* **`-sT`**: Koczy poczenie, wic pozostawia lad, ale mo偶na go u偶y bezpiecznie. Domylnie bez uprawnie.
* **`-sU`**: Wolniejsze, dla UDP. Najczciej: DNS(53), SNMP(161,162), DHCP(67 i 68), (-sU53,161,162,67,68): otwarte (odpowied藕), zamknite (port niedostpny), filtrowane (inny ICMP), otwarte/filtrowane (nic). W przypadku otwartych/filtrowanych, -sV wysya liczne 偶dania, aby wykry jedn z wersji obsugiwanych przez nmap i mo偶e wykry prawdziwy stan. Zwiksza to znacznie czas.
* **`-sY`**: Protok贸 SCTP nie mo偶e nawiza poczenia, wic nie ma log贸w, dziaa jak -PY
* **`-sN,-sX,-sF`:** Null, Fin, Xmas, mog przenika przez niekt贸re firewalle i wydobywa informacje. Opieraj si na tym, 偶e zgodne ze standardem maszyny powinny odpowiada RST na wszystkie 偶dania, kt贸re nie maj podniesionych flag SYN, RST lub ACK: otwarte/filtrowane (nic), zamknite (RST), filtrowane (ICMP niedostpne). Niepewne na systemach Windows, CIsco, BSDI i OS/400. Na systemach Unix tak.
* **`-sM`**: Skan Maimon: Wysya flagi FIN i ACK, u偶ywane dla BSD, obecnie wszystkie zwracaj zamknite.
* **`-sA, sW`**: ACK i Window, su偶y do wykrywania firewalli, aby dowiedzie si, czy porty s filtrowane czy nie. -sW rozr贸偶nia midzy otwartymi/zamknitymi, poniewa偶 otwarte odpowiadaj inn wartoci okna: otwarte (RST z wartoci okna inn ni偶 0), zamknite (RST okno = 0), filtrowane (ICMP niedostpne lub nic). Nie wszystkie komputery dziaaj w ten spos贸b, wic jeli wszystko jest zamknite, to nie dziaa, jeli kilka jest otwartych, to dziaa dobrze, a jeli jest wiele otwartych i niewielu zamknitych, to dziaa odwrotnie.
* **`-sI`:** Skan bezczynnociowy. W przypadkach, gdy istnieje aktywny firewall, ale wiemy, 偶e nie filtruje okrelonego adresu IP (lub gdy po prostu chcemy zachowa anonimowo), mo偶emy u偶y skanera zombie (dziaa dla wszystkich port贸w), aby znale藕 mo偶liwe zombi, mo偶emy u偶y skryptu ipidseq lub eksploitu auxiliary/scanner/ip/ipidseq. Ten skaner opiera si na numerze IPID pakiet贸w IP.
* **`--badsum`:** Wysya nieprawid
**--osscan-guess** Gdy wykrywanie systemu operacyjnego nie jest idealne, to zwiksza wysiek.

**Skrypty**

\--script _\<nazwapliku>_|_\<kategoria>_|_\<katalog>_|_\<wyra偶enie>_\[,...]

Aby u偶y domylnych skrypt贸w, wystarczy u偶y -sC lub --script=default

Dostpne kategorie to: auth, broadcast, default, discovery, dos, exploit, external, fuzzer, intrusive, malware, safe, version i vuln

* **Auth:** wykonuje wszystkie dostpne skrypty uwierzytelniania
* **Default:** wykonuje podstawowe domylne skrypty narzdzia
* **Discovery:** pobiera informacje o celu lub ofierze
* **External:** skrypt do korzystania z zewntrznych zasob贸w
* **Intrusive:** u偶ywa skrypt贸w uwa偶anych za natrtne dla ofiary lub celu
* **Malware:** sprawdza, czy istniej otwarte poczenia zoliwego oprogramowania lub tylnych drzwi (backdoor)
* **Safe:** wykonuje skrypty, kt贸re nie s natrtne
* **Vuln:** odkrywa najbardziej znane podatnoci
* **All:** wykonuje wszystkie dostpne skrypty NSE z rozszerzeniem

Aby wyszuka skrypty:

**nmap --script-help="http-\*" -> Te, kt贸re zaczynaj si od http-**

**nmap --script-help="not intrusive" -> Wszystkie opr贸cz tych**

**nmap --script-help="default or safe" -> Te, kt贸re s w jednym lub drugim lub obu**

**nmap --script-help="default and safe" --> Te, kt贸re s w obu**

**nmap --script-help="(default or safe or intrusive) and not http-\*"**

\--script-args _\<n1>_=_\<v1>_,_\<n2>_={_\<n3>_=_\<v3>_},_\<n4>_={_\<v4>_,_\<v5>_}

\--script-args-file _\<nazwapliku>_

\--script-help _\<nazwapliku>_|_\<kategoria>_|_\<katalog>_|_\<wyra偶enie>_|all\[,...]

\--script-trace ---> Udostpnia informacje o postpie skryptu

\--script-updatedb

Aby u偶y skryptu, wystarczy wpisa: nmap --script Nazwa\_skryptu cel --> Po wpisaniu skryptu zostanie wykonany zar贸wno skrypt, jak i skaner, wic mo偶na r贸wnie偶 doda opcje skanera, mo偶na doda **"safe=1"** aby wykona tylko bezpieczne skrypty.

Kontrola czasu

Nmap mo偶e zmienia czas w sekundach, minutach, ms: --host-timeout arguments 900000ms, 900, 900s, and 15m all do the same thing.

Nmap dzieli cakowit liczb host贸w do zeskanowania na grupy i analizuje te grupy blokami, tak 偶e dop贸ki wszystkie nie zostan zanalizowane, nie przechodzi do nastpnego bloku (i u偶ytkownik nie otrzymuje 偶adnych aktualizacji, dop贸ki blok nie zostanie zanalizowany). Dziki temu Nmap jest bardziej wydajny przy u偶yciu wikszych grup. Domylnie w klasie C u偶ywa 256.

Mo偶na to zmieni za pomoc **--min-hostgroup** _**\<liczba_host贸w>**_**;** **--max-hostgroup** _**\<liczba_host贸w>**_ (Dopasuj rozmiary grup skanowania r贸wnolegego)

Mo偶na kontrolowa liczb skaner贸w r贸wnolegych, ale lepiej tego nie robi (Nmap ma ju偶 wbudowan automatyczn kontrol na podstawie stanu sieci): **--min-parallelism** _**\<liczba_sond>**_**;** **--max-parallelism** _**\<liczba_sond>**_

Mo偶emy zmieni limit czasu RTT, ale zazwyczaj nie jest to konieczne: **--min-rtt-timeout** _**\<czas>**_**,** **--max-rtt-timeout** _**\<czas>**_**,** **--initial-rtt-timeout** _**\<czas>**_

Mo偶emy zmieni liczb pr贸b: **--max-retries** _**\<liczba_pr贸b>**_

Mo偶emy zmieni czas skanowania hosta: **--host-timeout** _**\<czas>**_

Mo偶emy zmieni czas midzy ka偶dym testem, aby dziaa wolniej: **--scan-delay** _**\<czas>**_**;** **--max-scan-delay** _**\<czas>**_

Mo偶emy zmieni liczb pakiet贸w na sekund: **--min-rate** _**\<liczba>**_**;** **--max-rate** _**\<liczba>**_

Wiele port贸w dugo odpowiada, gdy s filtrowane lub zamknite, jeli interesuj nas tylko otwarte, mo偶emy dziaa szybciej za pomoc: **--defeat-rst-ratelimit**

Aby okreli, jak agresywny ma by Nmap: -T paranoid|sneaky|polite|normal|aggressive|insane

\-T (0-1)

\-T0 --> Skanuje tylko 1 port na raz i czeka 5 minut przed kolejnym

\-T1 i T2 --> Bardzo podobne, ale czekaj tylko 15 i 0,4 sekundy midzy ka偶dym testem

\-T3 --> Domylne dziaanie, obejmuje r贸wnolegle

\-T4 --> --max-rtt-timeout 1250ms --min-rtt-timeout 100ms --initial-rtt-timeout 500ms --max-retries 6 --max-scan-delay 10ms

\-T5 --> --max-rtt-timeout 300ms --min-rtt-timeout 50ms --initial-rtt-timeout 250ms --max-retries 2 --host-timeout 15m --max-scan-delay 5ms

Firewall/IDS

Blokuje porty i analizuje pakiety.

**-f** Fragmentuje pakiety, domylnie fragmentuje je co 8 bajt贸w po nag贸wku, aby okreli ten rozmiar u偶ywamy ..mtu (zamiast -f), przesunicie musi by wielokrotnoci 8. **Skanery wersji i skrypty nie obsuguj fragmentacji**

**-D decoy1,decoy2,ME** Nmap wysya skanery, ale z innymi adresami IP jako 藕r贸dowymi, w ten spos贸b ukrywasz si. Jeli dodasz ME do listy, nmap umieci ci tam, lepiej doda 5 lub 6 przed tob, aby cakowicie ukry swoj to偶samo. Mo偶na generowa losowe adresy IP za pomoc RND:\<liczba> aby wygenerowa \<liczba> losowych adres贸w IP. Nie dziaaj z wykrywaniem wersji bez poczenia TCP. Jeli jeste wewntrz sieci, warto u偶ywa aktywnych adres贸w IP, w przeciwnym razie atwo bdzie ustali, 偶e jeste jedynym aktywnym.

Aby u偶y losowych adres贸w IP: nmap -D RND: 10 Cel\_IP

**-S IP** Gdy Nmap nie wykrywa twojego adresu IP, musisz go poda za pomoc tej opcji. Mo偶e r贸wnie偶 su偶y do zmylenia, 偶e inny cel przeprowadza skanowanie.

**-e \<interfejs>** Wyb贸r interfejsu

Wielu administrator贸w pozostawia otwarte porty wejciowe, aby wszystko dziaao poprawnie i 
**--proxies** _**\<Lista oddzielonych przecinkami adres贸w URL proxy>**_ Aby korzysta z proxy, czasami proxy nie utrzymuje takiej liczby otwartych pocze, jakiej oczekuje nmap, wic trzeba zmodyfikowa r贸wnolego: --max-parallelism

**-sP** Do odkrywania host贸w w sieci za pomoc ARP

Wielu administrator贸w tworzy regu w firewallu, kt贸ra pozwala na przepuszczenie wszystkich pakiet贸w pochodzcych z okrelonego portu (np. 20, 53 i 67), mo偶emy powiedzie nmapowi, aby wysya nasze pakiety z tych port贸w: **nmap --source-port 53 Ip**

**Wyjcia**

**-oN plik** Normalne wyjcie

**-oX plik** Wyjcie XML

**-oS plik** Wyjcie dla script kiddies

**-oG plik** Wyjcie w formacie grepable

**-oA plik** Wszystkie opr贸cz -oS

**-v poziom** poziom szczeg贸owoci

**-d poziom** poziom debugowania

**--reason** Pow贸d hosta i jego stanu

**--stats-every czas** Co jaki czas informuje nas o postpie

**--packet-trace** Aby zobaczy, jakie pakiety s wysyane, mo偶na okreli filtry, takie jak: --version-trace lub --script-trace

**--open** pokazuje otwarte, otwarte|filtrowane i niefiltrowane

**--resume plik** Generuje podsumowanie

**R贸偶ne**

**-6** Wcza ipv6

**-A** To samo co -O -sV -sC --traceroute

**Czas dziaania**

Podczas dziaania nmap mo偶emy zmienia opcje:

v / V Zwiksz / zmniejsz poziom szczeg贸owoci

d / D Zwiksz / zmniejsz poziom debugowania

p / P Wcz / wycz ledzenie pakiet贸w

? Wywietl pomoc dotyczc interakcji w czasie rzeczywistym

**Vulscan**

Skrypt nmap, kt贸ry sprawdza wersje usug na podstawie bazy danych offline (pobranej z innych wa偶nych 藕r贸de) i zwraca potencjalne podatnoci.

U偶ywane bazy danych to:

1. Scipvuldb.csv | [http://www.scip.ch/en/?vuldb](http://www.scip.ch/en/?vuldb)
2. Cve.csv | [http://cve.mitre.org](http://cve.mitre.org/)
3. Osvdb.csv | [http://www.osvdb.org](http://www.osvdb.org/)
4. Securityfocus.csv | [http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)
5. Securitytracker.csv | [http://www.securitytracker.com](http://www.securitytracker.com/)
6. Xforce.csv | [http://xforce.iss.net](http://xforce.iss.net/)
7. Exploitdb.csv | [http://www.exploit-db.com](http://www.exploit-db.com/)
8. Openvas.csv | [http://www.openvas.org](http://www.openvas.org/)

Aby go pobra i zainstalowa w folderze Nmap:

wget http://www.computec.ch/projekte/vulscan/download/nmap\_nse\_vulscan-2.0.tar.gz && tar -czvf nmap\_nse\_vulscan-2.0.tar.gz vulscan/ && sudo cp -r vulscan/ /usr/share/nmap/scripts/

Nale偶y r贸wnie偶 pobra pakiety z baz danych i doda je do /usr/share/nmap/scripts/vulscan/

U偶ycie:

Aby u偶y wszystkich: sudo nmap -sV --script=vulscan HOST\_DO\_Skanowania

Aby u偶y konkretnej bazy danych: sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv HOST\_DO\_Skanowania

## Przyspiesz skanowanie usug Nmap x16

Zgodnie z [**tym postem**](https://joshua.hu/nmap-speedup-service-scanning-16x) mo偶na przyspieszy analiz usug nmap, modyfikujc wszystkie wartoci **`totalwaitms`** w pliku **`/usr/share/nmap/nmap-service-probes`** na **300**, a **`tcpwrappedms`** na **200**.

Ponadto, sondy, kt贸re nie maj okrelonej wartoci **`servicewaitms`**, u偶ywaj domylnej wartoci **`5000`**. Dlatego mo偶emy albo doda wartoci do ka偶dej z sond, albo **skompilowa nmap** samodzielnie i zmieni domyln warto w [**service\_scan.h**](https://github.com/nmap/nmap/blob/master/service\_scan.h#L79).

Jeli nie chcesz w og贸le zmienia wartoci **`totalwaitms`** i **`tcpwrappedms`** w pliku `/usr/share/nmap/nmap-service-probes`, mo偶esz zmodyfikowa [kod parsowania](https://github.com/nmap/nmap/blob/master/service\_scan.cc#L1358), aby te wartoci w pliku `nmap-service-probes` byy cakowicie ignorowane.

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
