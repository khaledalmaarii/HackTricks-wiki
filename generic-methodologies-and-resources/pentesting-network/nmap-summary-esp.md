# Nmap Rezime (ESP)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
```
nmap -sV -sC -O -n -oA nmapscan 192.168.0.1/24
```
## Parametri

### IP adrese za skeniranje

* **`<ip>,<net/mask>`:** Ozna캜ava IP adrese direktno
* **`-iL <ips_file>`:** lista_IP adresa
* **`-iR <number>`**: Broj nasumi캜nih IP adresa, mo쬰te isklju캜iti mogu캖e IP adrese sa `--exclude <Ips>` ili `--excludefile <file>`.

### Otkrivanje opreme

Podrazumevano, Nmap pokre캖e fazu otkrivanja koja se sastoji od: `-PA80 -PS443 -PE -PP`

* **`-sL`**: Nije invazivan, izlistava ciljeve prave캖i **DNS** zahteve za re코avanje imena. Korisno je znati da li su sve IP adrese na primer www.prueba.es/24 na코i ciljevi.
* **`-Pn`**: **Bez pinga**. Ovo je korisno ako znate da su sve adrese aktivne (ako nisu, mo쬰te izgubiti puno vremena, ali ova opcija tako캠e mo쬰 dati la쬹e negativne rezultate govore캖i da nisu aktivne), spre캜ava fazu otkrivanja.
* **`-sn`** : **Bez skeniranja portova**. Nakon zavr코etka faze izvi캠anja, ne skenira portove. Relativno je neprimetan i omogu캖ava mali sken mre쬰. Sa privilegijama 코alje ACK (-PA) na 80, SYN(-PS) na 443 i zahtev za echo i zahtev za vremenski pe캜at, bez privilegija uvek zavr코ava konekcije. Ako je cilj mre쬬, koristi samo ARP(-PR). Ako se koristi sa drugom opcijom, samo se odbacuju paketi druge opcije.
* **`-PR`**: **Ping ARP**. Koristi se podrazumevano prilikom analize ra캜unara u na코oj mre쬴, br쬰 je od kori코캖enja pingova. Ako ne 쬰lite da koristite ARP pakete, koristite `--send-ip`.
* **`-PS <ports>`**: 마lje SYN pakete na koje ako odgovori SYN/ACK, port je otvoren (na koji odgovara sa RST da ne bi zavr코io konekciju), ako odgovori RST, port je zatvoren, a ako ne odgovori, port je nedostupan. U slu캜aju da nemate privilegije, automatski se koristi potpuna konekcija. Ako nisu navedeni portovi, 코alje se na 80.
* **`-PA <ports>`**: Kao prethodna opcija, ali sa ACK, kombinacija obe opcije daje bolje rezultate.
* **`-PU <ports>`**: Cilj je suprotan, 코alju se na portove za koje se o캜ekuje da su zatvoreni. Neke firewall-ove proveravaju samo TCP konekcije. Ako je port zatvoren, odgovara se sa "port unreachable", ako se odgovori sa drugim ICMP ili ako se ne odgovori, ostaje kao "destination unreachable".
* **`-PE, -PP, -PM`** : ICMP PING-ovi: echo replay, timestamp i addresmask. Pokre캖u se da bi se saznalo da li je cilj aktivan.
* **`-PY<ports>`**: 마lje SCTP INIT probe na 80 podrazumevano, mo쬰 se odgovoriti sa INIT-ACK(otvoren) ili ABORT(zatvoren) ili ni코ta ili ICMP nedostupno(neaktivno).
* **`-PO <protocols>`**: Protokol je nazna캜en u zaglavljima, podrazumevano 1(ICMP), 2(IGMP) i 4(Encap IP). Za ICMP, IGMP, TCP (6) i UDP (17) protokole se 코alju zaglavlja protokola, za ostale se 코alje samo IP zaglavlje. Svrha ovoga je da se zbog deformacije zaglavlja, odgovara sa "Protocol unreachable" ili odgovori istog protokola kako bi se saznalo da li je dostupan.
* **`-n`**: Bez DNS-a
* **`-R`**: Uvek DNS

### Tehnike skeniranja portova

* **`-sS`**: Ne zavr코ava konekciju tako da ne ostavlja trag, veoma dobro ako se mo쬰 koristiti (privilegije). Ovo je podrazumevana opcija.
* **`-sT`**: Zavr코ava konekciju, tako da ostavlja trag, ali se mo쬰 koristiti sigurno. Podrazumevano bez privilegija.
* **`-sU`**: Sporije, za UDP. Naj캜e코캖e: DNS(53), SNMP(161,162), DHCP(67 i 68), (-sU53,161,162,67,68): otvoren(odgovor), zatvoren(port nedostupan), filtriran (drugi ICMP), otvoren/filtriran (ni코ta). U slu캜aju otvoren/filtriran, -sV 코alje brojne zahteve da bi otkrio neku od verzija koje nmap podr쬬va i mo쬰 otkriti pravo stanje. To zna캜ajno pove캖ava vreme.
* **`-sY`**: SCTP protokol ne uspeva da uspostavi konekciju, tako da nema logova, radi kao -PY
* **`-sN,-sX,-sF`:** Null, Fin, Xmas, mogu pro캖i kroz neke firewall-ove i izvu캖i informacije. Baziraju se na 캜injenici da standardno uskla캠eni ure캠aji treba da odgovore sa RST na sve zahteve koji nemaju SYN, RST ili ACK postavljene zastavice: otvoren/filtriran(ni코ta), zatvoren(RST), filtriran (ICMP nedostupno). Nepouzdano na Windows-u, CIsco-u, BSDI i OS/400. Na Unix-u da.
* **`-sM`**: Maimon skeniranje: 마lje FIN i ACK zastavice, koristi se za BSD, trenutno 캖e sve vratiti kao zatvoreno.
* **`-sA, sW`**: ACK i Window, koristi se za otkrivanje firewall-ova, da bi se saznalo da li su portovi filtrirani ili ne. -sW razlikuje izme캠u otvorenih/zatvorenih jer otvoreni odgovaraju sa druga캜ijom vredno코캖u prozora: otvoren (RST sa prozorom razli캜itim od 0), zatvoren (RST prozor = 0), filtriran (ICMP nedostupno ili ni코ta). Ne svi ra캜unari rade na ovaj na캜in, pa ako su svi zatvoreni, ne radi, ako je nekoliko otvoreno, radi dobro, a ako je mnogo otvorenih i malo zatvorenih, radi na druga캜iji na캜in.
* **`-sI`:** Idle skeniranje. Za slu캜ajeve kada postoji aktivan firewall, ali znamo da ne filtrira odre캠enu IP adresu (ili kada jednostavno 쬰limo anonimnost), mo쬰mo koristiti skener zombija (radi za sve portove), da bismo prona코li mogu캖e zombije mo쬰mo koristiti skriptu ipidseq ili eksploit auxiliary/scanner/ip/ipidseq. Ovaj skener se bazira na broju IPID paketa IP adrese.
* **`--badsum`:** 마lje pogre코an zbir, ra캜unari bi odbacili pakete, ali firewall-ovi bi mogli odgovoriti ne코to, koristi se za otkrivanje firewall-ova.
* **`-sZ`:**
**--osscan-guess** Kada detekcija operativnog sistema nije savr코ena, ovo 캖e pove캖ati napor

**Skripte**

\--script _\<imefajla>_|_\<kategorija>_|_\<direktorijum>_|_\<izraz>_\[,...]

Za kori코캖enje podrazumevanih skripti, dovoljno je koristiti -sC ili --script=default

Vrste skripti su: auth, broadcast, default, discovery, dos, exploit, external, fuzzer, intrusive, malware, safe, version, i vuln

* **Auth:** izvr코ava sve dostupne skripte za autentifikaciju
* **Default:** izvr코ava osnovne podrazumevane skripte alata
* **Discovery:** prikuplja informacije o cilju ili rtvi
* **External:** skripta za kori코캖enje spoljnih resursa
* **Intrusive:** koristi skripte koje se smatraju napadnim za rtvu ili cilj
* **Malware:** proverava da li postoje otvorene veze putem zlonamernog koda ili zadnjih vrata (backdoors)
* **Safe:** izvr코ava skripte koje nisu napadne
* **Vuln:** otkriva najpoznatije ranjivosti
* **All:** izvr코ava sve dostupne NSE skripte

Za pretragu skripti:

**nmap --script-help="http-\*" -> One koje po캜inju sa http-**

**nmap --script-help="not intrusive" -> Sve osim tih**

**nmap --script-help="default or safe" -> One koje su u jednoj ili drugoj ili obema kategorijama**

**nmap --script-help="default and safe" --> One koje su u obema kategorijama**

**nmap --script-help="(default or safe or intrusive) and not http-\*"**

\--script-args _\<n1>_=_\<v1>_,_\<n2>_={_\<n3>_=_\<v3>_},_\<n4>_={_\<v4>_,_\<v5>_}

\--script-args-file _\<imefajla>_

\--script-help _\<imefajla>_|_\<kategorija>_|_\<direktorijum>_|_\<izraz>_|all\[,...]

\--script-trace ---> Daje informacije o tome kako skripta napreduje

\--script-updatedb

**Za kori코캖enje skripte samo treba uneti: nmap --script Ime\_skripte cilj** --> Kada se unese skripta, izvr코i캖e se i skripta i skener, tako da se mogu dodati i opcije skenera, mo쬰mo dodati **"safe=1"** da se izvr코e samo sigurne skripte.

**Kontrola vremena**

**Nmap mo쬰 menjati vreme u sekundama, minutama, ms:** --host-timeout arguments 900000ms, 900, 900s, and 15m sve rade istu stvar.

Nmap deli ukupan broj hostova za skeniranje u grupe i analizira te grupe blokovima, tako da ne prelazi na slede캖i blok dok svi nisu analizirani (i korisnik ne dobija a쬿riranja dok blok nije analiziran). Na taj na캜in, za Nmap je efikasnije koristiti ve캖e grupe. Podrazumevano koristi 256 za klasu C.

Mo쬰 se promeniti sa\*\*--min-hostgroup\*\* _**\<brojhostova>**_**;** **--max-hostgroup** _**\<brojhostova>**_ (Prilagodi veli캜ine grupa paralelnog skeniranja)

Mo쬰 se kontrolisati broj paralelnih skenera, ali je bolje ne koristiti (Nmap ve캖 ima automatsku kontrolu na osnovu stanja mre쬰): **--min-parallelism** _**\<brojproba>**_**;** **--max-parallelism** _**\<brojproba>**_

Mo쬰mo promeniti rtt timeout, ali obi캜no nije potrebno: **--min-rtt-timeout** _**\<vreme>**_**,** **--max-rtt-timeout** _**\<vreme>**_**,** **--initial-rtt-timeout** _**\<vreme>**_

Mo쬰mo promeniti broj poku코aja: **--max-retries** _**\<brojpokusaja>**_

Mo쬰mo promeniti vreme skeniranja hosta: **--host-timeout** _**\<vreme>**_

Mo쬰mo promeniti vreme izme캠u svakog testa da bude sporije: **--scan-delay** _**\<vreme>**_**;** **--max-scan-delay** _**\<vreme>**_

Mo쬰mo promeniti broj paketa po sekundi: **--min-rate** _**\<broj>**_**;** **--max-rate** _**\<broj>**_

Mnogi portovi dugo traju da odgovore jer su filtrirani ili zatvoreni, ako nas zanimaju samo otvoreni portovi, mo쬰mo biti br쬴 sa: **--defeat-rst-ratelimit**

Da bismo odredili koliko agresivan 쬰limo da bude nmap: -T paranoid|sneaky|polite|normal|aggressive|insane

\-T (0-1)

\-T0 --> Samo se skenira jedan port odjednom i 캜eka se 5 minuta do slede캖eg

\-T1 i T2 --> Veoma sli캜ni, ali 캜ekaju samo 15 i 0,4 sekundi izme캠u svakog testa

\-T3 --> Podrazumevano pona코anje, uklju캜uje paralelno skeniranje

\-T4 --> --max-rtt-timeout 1250ms --min-rtt-timeout 100ms --initial-rtt-timeout 500ms --max-retries 6 --max-scan-delay 10ms

\-T5 --> --max-rtt-timeout 300ms --min-rtt-timeout 50ms --initial-rtt-timeout 250ms --max-retries 2 --host-timeout 15m --max-scan-delay 5ms

**Firewall/IDS**

Onemogu캖avaju pristup portovima i analiziraju pakete.

**-f** Za fragmentaciju paketa, podrazumevano se fragmenti코u u 8 bajtova nakon zaglavlja, da bismo specificirali tu veli캜inu koristimo ..mtu (sa ovim, ne koristiti -f), offset mora biti vi코ekratnik od 8. **Skeneri verzija i skripte ne podr쬬vaju fragmentaciju**

**-D la쬹a1,la쬹a2,JA** Nmap 코alje skenere, ali sa drugim IP adresama kao izvor, na taj na캜in se sakrivate. Ako stavite JA na listu, nmap 캖e vas postaviti tamo, bolje je staviti 5 ili 6 pre vas da vas potpuno prikriju. Mo쬰te generisati slu캜ajne IP adrese sa RND:\<broj> da biste generisali \<broj> slu캜ajnih IP adresa. Ne funkcioni코u sa detektorom verzija bez TCP veze. Ako se nalazite unutar mre쬰, trebali biste koristiti IP adrese koje su aktivne, jer 캖e ina캜e biti vrlo lako otkriti da ste jedini aktivan.

Za kori코캖enje slu캜ajnih IP adresa: nmap-D RND: 10 Ciljni\_IP

**-S IP** Kada Nmap ne prepoznaje va코u IP adresu, morate je navesti sa tim. Tako캠e se mo쬰 koristiti da se stvori utisak da drugi cilj skenira njih.

**-e \<interfejs>** Za odabir interfejsa
**--proxies** _**\<Zarezom odvojeni popis URL-ova proxy servera>**_ Za kori코캖enje proxy servera, ponekad proxy server ne odr쬬va toliko otvorenih veza koliko nmap 쬰li, pa bi trebalo promeniti paralelizam: --max-parallelism

**-sP** Za otkrivanje hostova u mre쬴 putem ARP-a

Mnogi administratori kreiraju pravilo u firewall-u koje omogu캖ava prolaz svih paketa koji dolaze sa odre캠enog porta (kao 코to su 20, 53 i 67), mo쬰mo re캖i nmap-u da 코alje na코e pakete sa tih portova: **nmap --source-port 53 Ip**

**Izlazi**

**-oN file** Normalni izlaz

**-oX file** XML izlaz

**-oS file** Izlaz za script kidije

**-oG file** Grepable izlaz

**-oA file** Svi osim -oS

**-v level** verbose

**-d level** debug

**--reason** Razlog hosta i stanje

**--stats-every time** Svaki put kada nam ka쬰 kako ide

**--packet-trace** Da bismo videli koje pakete izlaze, mo쬰mo specificirati filtere kao 코to su: --version-trace ili --script-trace

**--open** prikazuje otvorene, otvorene|filtrirane i ne filtrirane

**--resume file** Izvla캜i rezime

**Razno**

**-6** Dozvoljava ipv6

**-A** isto kao -O -sV -sC --traceroute

**Vulscan**

Nmap skripta koja proverava verzije servisa dobijene iz offline baze podataka (koju preuzima sa drugih veoma va쬹ih mesta) i vra캖a mogu캖e ranjivosti

Baze podataka koje koristi su:

1. Scipvuldb.csv | [http://www.scip.ch/en/?vuldb](http://www.scip.ch/en/?vuldb)
2. Cve.csv | [http://cve.mitre.org](http://cve.mitre.org/)
3. Osvdb.csv | [http://www.osvdb.org](http://www.osvdb.org/)
4. Securityfocus.csv | [http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)
5. Securitytracker.csv | [http://www.securitytracker.com](http://www.securitytracker.com/)
6. Xforce.csv | [http://xforce.iss.net](http://xforce.iss.net/)
7. Exploitdb.csv | [http://www.exploit-db.com](http://www.exploit-db.com/)
8. Openvas.csv | [http://www.openvas.org](http://www.openvas.org/)

Da biste je preuzeli i instalirali u Nmap folder:

wget http://www.computec.ch/projekte/vulscan/download/nmap\_nse\_vulscan-2.0.tar.gz && tar -czvf nmap\_nse\_vulscan-2.0.tar.gz vulscan/ && sudo cp -r vulscan/ /usr/share/nmap/scripts/

Tako캠e, trebalo bi preuzeti pakete baza podataka i dodati ih u /usr/share/nmap/scripts/vulscan/

Upotreba:

Za kori코캖enje svih: sudo nmap -sV --script=vulscan HOST\_A\_ESCANEAR

Za kori코캖enje odre캠ene baze podataka: sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv HOST\_A\_ESCANEAR

## Ubrzanje Nmap Service skeniranja x16

Prema [**ovom postu**](https://joshua.hu/nmap-speedup-service-scanning-16x) mo쬰te ubrzati analizu nmap servisa tako 코to 캖ete izmeniti sve vrednosti **`totalwaitms`** u **`/usr/share/nmap/nmap-service-probes`** na **300** i **`tcpwrappedms`** na **200**.

Osim toga, probe koje nemaju posebno definisanu vrednost **`servicewaitms`** koriste podrazumevanu vrednost **`5000`**. Stoga, mo쬰mo dodati vrednosti za svaku od proba ili mo쬰mo **kompajlirati nmap** sami i promeniti podrazumevanu vrednost u [**service\_scan.h**](https://github.com/nmap/nmap/blob/master/service\_scan.h#L79).

Ako ne 쬰lite uop코te menjati vrednosti **`totalwaitms`** i **`tcpwrappedms`** u datoteci `/usr/share/nmap/nmap-service-probes`, mo쬰te izmeniti [kod za parsiranje](https://github.com/nmap/nmap/blob/master/service\_scan.cc#L1358) tako da se ove vrednosti u datoteci `nmap-service-probes` potpuno ignori코u.

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
