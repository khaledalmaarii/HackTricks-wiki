# WebRTC DoS

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

**Ten problem zosta znaleziony w tym wpisie na blogu:** [**https://www.rtcsec.com/article/novel-dos-vulnerability-affecting-webrtc-media-servers/**](https://www.rtcsec.com/article/novel-dos-vulnerability-affecting-webrtc-media-servers/)

Opisana podatno w serwerach medi贸w WebRTC wynika z **warunk贸w wycigu** podczas inicjalizacji sesji medi贸w, szczeg贸lnie midzy **weryfikacj zgody medi贸w ICE** a **inicjacj ruchu DTLS**. Oto szczeg贸owy opis:

### Pochodzenie podatnoci

1. **Alokacja port贸w UDP:** Gdy u偶ytkownik inicjuje poczenie WebRTC, serwer medi贸w alokuje porty UDP do obsugi strumieni medi贸w, a adres IP i port s komunikowane za pomoc sygnalizacji.
2. **Procesy ICE i STUN:** Przegldarka u偶ytkownika u偶ywa ICE do weryfikacji zgody medi贸w, wykorzystujc STUN do okrelenia cie偶ki poczenia do serwera medi贸w.
3. **Sesja DTLS:** Po pomylnej weryfikacji STUN rozpoczyna si sesja DTLS w celu ustanowienia kluczy g贸wnych SRTP, przechodzc do SRTP dla strumienia medi贸w.

### Mechanizm eksploatacji

* **Eksploatacja warunk贸w wycigu:** Atakujcy mo偶e wykorzysta warunki wycigu, wysyajc wiadomo DTLS ClientHello przed legalnym u偶ytkownikiem, potencjalnie u偶ywajc nieprawidowego zestawu szyfr贸w, takiego jak `TLS_NULL_WITH_NULL_NULL`. Powoduje to bd DTLS na serwerze, uniemo偶liwiajc ustanowienie sesji SRTP.

### Proces ataku

* **Skanowanie port贸w:** Atakujcy musi zgadn, kt贸re porty UDP obsuguj przychodzce sesje medi贸w, wysyajc wiadomoci ClientHello z zestawem szyfr贸w null do tych port贸w, aby wywoa podatno.
* **Diagram ataku:** Sekwencja obejmuje wiele wiadomoci ClientHello wysyanych przez atakujcego do serwera, przeplatanych z legaln sygnalizacj i wiadomociami DTLS, co prowadzi do niepowodzenia w uzgadnianiu z powodu bdnego zestawu szyfr贸w.

### Testowanie i agodzenie

* **Bezpieczne testowanie:** U偶ywajc narzdzi takich jak Scapy, atakujcy odtwarzaj wiadomoci DTLS ClientHello, celujc w konkretne porty medi贸w. Do etycznego testowania wprowadzono modyfikacje do Chromium (np. `JsepTransport::AddRemoteCandidates`), aby bezpiecznie naladowa zachowanie ofiary.
* **rodki agodzce:** Rozwizania obejmuj odrzucanie pakiet贸w z niezweryfikowanych adres贸w, co zostao wdro偶one w nowszych wersjach bibliotek, takich jak libnice. G贸wne rozwizanie podkrela zaufanie do procesu weryfikacji ICE i przetwarzanie tylko pakiet贸w z zweryfikowanymi kombinacjami IP i portu.

### Scenariusze niepodatne

* **Konfiguracje serwera DTLS:** Przypadki, w kt贸rych przegldarka dziaa jako serwer DTLS lub gdy serwer medi贸w nie u偶ywa port贸w ephemerowych do sesji medi贸w, nie s podatne na t podatno.

### Wnioski

Ta podatno podkrela delikatn r贸wnowag w procesach inicjalizacji sesji medi贸w oraz potrzeb precyzyjnego timingu i mechanizm贸w weryfikacji, aby zapobiec eksploatacji. Programici s zachcani do wdra偶ania zalecanych poprawek bezpieczestwa i zapewnienia solidnych proces贸w weryfikacji, aby zagodzi takie podatnoci.

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
