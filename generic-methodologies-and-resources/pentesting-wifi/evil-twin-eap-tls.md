# Evil Twin EAP-TLS

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Dica de recompensa por bugs**: **Inscreva-se** no **Intigriti**, uma plataforma premium de **recompensas por bugs criada por hackers, para hackers**! Junte-se a n√≥s em [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoje e comece a ganhar recompensas de at√© **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

Em algum momento, precisei usar a solu√ß√£o proposta no post abaixo, mas os passos em [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) n√£o estavam funcionando mais no kali moderno (2019v3).\
De qualquer forma, √© f√°cil faz√™-los funcionar.\
Voc√™ s√≥ precisa baixar o hostapd-2.6 daqui: [https://w1.fi/releases/](https://w1.fi/releases) e antes de compilar novamente o hostapd-wpe, instale: `apt-get install libssl1.0-dev`

### Analisando e Explorando EAP-TLS em Redes Sem Fio

#### Contexto: EAP-TLS em Redes Sem Fio
EAP-TLS √© um protocolo de seguran√ßa que fornece autentica√ß√£o m√∫tua entre cliente e servidor usando certificados. A conex√£o √© estabelecida somente se o cliente e o servidor autenticarem os certificados um do outro.

#### Desafio Encontrado
Durante uma avalia√ß√£o, um erro interessante foi encontrado ao usar a ferramenta `hostapd-wpe`. A ferramenta rejeitou a conex√£o do cliente devido ao certificado do cliente ser assinado por uma Autoridade de Certifica√ß√£o (CA) desconhecida. Isso indicou que o cliente n√£o confiava no certificado do servidor falso, apontando para configura√ß√µes de seguran√ßa frouxas no lado do cliente.

#### Objetivo: Configurar um Ataque Man-in-the-Middle (MiTM)
O objetivo era modificar a ferramenta para aceitar qualquer certificado de cliente. Isso permitiria o estabelecimento de uma conex√£o com a rede sem fio maliciosa e habilitaria um ataque MiTM, potencialmente capturando credenciais em texto simples ou outros dados sens√≠veis.

#### Solu√ß√£o: Modificando o `hostapd-wpe`
A an√°lise do c√≥digo-fonte do `hostapd-wpe` revelou que a valida√ß√£o do certificado do cliente era controlada por um par√¢metro (`verify_peer`) na fun√ß√£o OpenSSL `SSL_set_verify`. Ao alterar o valor desse par√¢metro de 1 (validar) para 0 (n√£o validar), a ferramenta foi configurada para aceitar qualquer certificado de cliente.

#### Execu√ß√£o do Ataque
1. **Verifica√ß√£o do Ambiente:** Use o `airodump-ng` para monitorar redes sem fio e identificar alvos.
2. **Configurar um AP Falso:** Execute o `hostapd-wpe` modificado para criar um Ponto de Acesso (AP) falso imitando a rede alvo.
3. **Customiza√ß√£o do Portal Cativo:** Personalize a p√°gina de login do portal cativo para parecer leg√≠tima e familiar ao usu√°rio alvo.
4. **Ataque de Desautentica√ß√£o:** Opcionalmente, execute um ataque de desautentica√ß√£o para desconectar o cliente da rede leg√≠tima e conect√°-lo ao AP falso.
5. **Capturando Credenciais:** Uma vez que o cliente se conecta ao AP falso e interage com o portal cativo, suas credenciais s√£o capturadas.

#### Observa√ß√µes do Ataque
- Em m√°quinas Windows, o sistema pode se conectar automaticamente ao AP falso, apresentando o portal cativo quando a navega√ß√£o na web √© tentada.
- Em um iPhone, o usu√°rio pode ser solicitado a aceitar um novo certificado e depois apresentado com o portal cativo.

#### Conclus√£o
Embora o EAP-TLS seja considerado seguro, sua efic√°cia depende fortemente da configura√ß√£o correta e do comportamento cauteloso dos usu√°rios finais. Dispositivos mal configurados ou usu√°rios desavisados aceitando certificados falsos podem comprometer a seguran√ßa de uma rede protegida por EAP-TLS.

Para mais detalhes, consulte https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Refer√™ncias
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Dica de recompensa por bugs**: **Inscreva-se** no **Intigriti**, uma plataforma premium de **recompensas por bugs criada por hackers, para hackers**! Junte-se a n√≥s em [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoje e comece a ganhar recompensas de at√© **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
