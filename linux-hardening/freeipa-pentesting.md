# FreeIPA Pentesting

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

FreeIPA рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ **рд╡реИрдХрд▓реНрдкрд┐рдХ** рд╣реИ Microsoft Windows **Active Directory** рдХрд╛, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **Unix** рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд▓рд┐рдПред рдпрд╣ рдПрдХ рдкреВрд░реНрдг **LDAP directory** рдХреЛ MIT **Kerberos** Key Distribution Center рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рддрд╛ рд╣реИ, рдЬреЛ Active Directory рдХреЗ рд╕рдорд╛рди рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП рд╣реИред CA рдФрд░ RA рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП Dogtag **Certificate System** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдпрд╣ рд╕реНрдорд╛рд░реНрдЯрдХрд╛рд░реНрдб рд╕рд╣рд┐рдд **multi-factor** рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред Unix рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП SSSD рдПрдХреАрдХреГрдд рд╣реИред

## Fingerprints

### Files & Environment Variables

* рдлрд╝рд╛рдЗрд▓ `/etc/krb5.conf` рдореЗрдВ Kerberos рдХреНрд▓рд╛рдЗрдВрдЯ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИ, рдЬреЛ рдбреЛрдореЗрди рдореЗрдВ рдирд╛рдорд╛рдВрдХрди рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред рдЗрд╕рдореЗрдВ KDCs рдФрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд╕реНрдерд╛рди, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдФрд░ рдореИрдкрд┐рдВрдЧ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
* IPA рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо-рд╡реНрдпрд╛рдкреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдлрд╝рд╛рдЗрд▓ `/etc/ipa/default.conf` рдореЗрдВ рд╕реЗрдЯ рд╣реЛрддреЗ рд╣реИрдВред
* рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рд╣реЛрд╕реНрдЯ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП `/etc/krb5.keytab` рдкрд░ `krb5.keytab` рдлрд╝рд╛рдЗрд▓ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред
* рд╡рд┐рднрд┐рдиреНрди рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ (`KRB5CCNAME`, `KRB5_KTNAME`, `KRB5_CONFIG`, `KRB5_KDC_PROFILE`, `KRB5RCACHETYPE`, `KRB5RCACHEDIR`, `KRB5_TRACE`, `KRB5_CLIENT_KTNAME`, `KPROP_PORT`) Kerberos рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

### Binaries

`ipa`, `kdestroy`, `kinit`, `klist`, `kpasswd`, `ksu`, `kswitch`, рдФрд░ `kvno` рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг FreeIPA рдбреЛрдореЗрди рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ, Kerberos рдЯрд┐рдХрдЯреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ, рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓рдиреЗ рдФрд░ рд╕реЗрд╡рд╛ рдЯрд┐рдХрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрдВрджреНрд░реАрдп рд╣реИрдВ, рдЕрдиреНрдп рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рдмреАрдЪред

### Network

рдПрдХ рдЪрд┐рддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп FreeIPA рд╕рд░реНрд╡рд░ рд╕реЗрдЯрдЕрдк рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред

## Authentication

FreeIPA рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг, **Kerberos** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, **Active Directory** рдореЗрдВ рд╕рдорд╛рди рд╣реИред рдбреЛрдореЗрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╛рдиреНрдп Kerberos рдЯрд┐рдХрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕реЗ FreeIPA рдбреЛрдореЗрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### **CCACHE Ticket Files**

CCACHE рдлрд╝рд╛рдЗрд▓реЗрдВ, рд╕рд╛рдорд╛рдиреНрдпрддрдГ **`/tmp`** рдореЗрдВ **600** рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВ, Kerberos рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдирд░реА рдкреНрд░рд╛рд░реВрдк рд╣реИрдВ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред CCACHE рдЯрд┐рдХрдЯ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `klist` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдПрдХ рдорд╛рдиреНрдп CCACHE рдЯрд┐рдХрдЯ рдХрд╛ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `KRB5CCNAME` рдХреЛ рдЯрд┐рдХрдЯ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдкрде рдкрд░ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред

### **Unix Keyring**

рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ, CCACHE рдЯрд┐рдХрдЯреЛрдВ рдХреЛ Linux рдХреА рдХреАрд░рд┐рдВрдЧ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдЯрд┐рдХрдЯ рдкреНрд░рдмрдВрдзрди рдкрд░ рдЕрдзрд┐рдХ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЯрд┐рдХрдЯ рд╕рдВрдЧреНрд░рд╣рдг рдХрд╛ рджрд╛рдпрд░рд╛ рднрд┐рдиреНрди рд╣реЛрддрд╛ рд╣реИ (`KEYRING:name`, `KEYRING:process:name`, `KEYRING:thread:name`, `KEYRING:session:name`, `KEYRING:persistent:uidnumber`), рдЬрд┐рд╕рдореЗрдВ `klist` рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдкрд╛рд░реНрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, Unix рдХреАрд░рд┐рдВрдЧ рд╕реЗ CCACHE рдЯрд┐рдХрдЯ рдХрд╛ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪреБрдиреМрддрд┐рдпреЛрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, Kerberos рдЯрд┐рдХрдЯреЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП **Tickey** рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг рдЙрдкрд▓рдмреНрдз рд╣реИрдВред

### Keytab

Keytab рдлрд╝рд╛рдЗрд▓реЗрдВ, рдЬреЛ Kerberos рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдФрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреА рд╣реИрдВ, рдорд╛рдиреНрдп рдЯрд┐рдХрдЯ рдЧреНрд░рд╛рдВрдЯрд┐рдВрдЧ рдЯрд┐рдХрдЯ (TGT) рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВ, рдмрд┐рдирд╛ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗред Keytab рдлрд╝рд╛рдЗрд▓реЛрдВ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдкрд╛рд░реНрд╕ рдФрд░ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ `klist` рдЬреИрд╕реЗ рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ рдФрд░ **KeytabParser** рдЬреИрд╕реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╛рде рдЖрд╕рд╛рдиреА рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### Cheatsheet

рдЖрдк рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдЯрд┐рдХрдЯреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ, рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд┐рдВрдХ рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="privilege-escalation/linux-active-directory.md" %}
[linux-active-directory.md](privilege-escalation/linux-active-directory.md)
{% endcontent-ref %}

## Enumeration

{% hint style="warning" %}
рдЖрдк **ldap** рдФрд░ рдЕрдиреНрдп **binary** рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **enumeration** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ **FreeIPA рд╕рд░реНрд╡рд░ рдХреЗ рдкреЛрд░реНрдЯ 443 рдореЗрдВ рд╡реЗрдм рдкреГрд╖реНрда рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдХреЗ**ред
{% endhint %}

### Hosts, Users, and Groups <a href="#id-4b3b" id="id-4b3b"></a>

**рд╣реЛрд╕реНрдЯ**, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдФрд░ **рд╕рдореВрд╣** рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред рд╣реЛрд╕реНрдЯ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ тАЬ**Host Groups**тАЭ рдФрд░ тАЬ**User Groups**тАЭ рдирд╛рдордХ рдХрдВрдЯреЗрдирд░реЛрдВ рдореЗрдВ рд╡рд░реНрдЧреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпреЗ **Organizational Units** (OU) рдХреЗ рд╕рдорд╛рди рд╣реИрдВред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ FreeIPA рдореЗрдВ, LDAP рд╕рд░реНрд╡рд░ **anonymous binds** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдбреЗрдЯрд╛ рдХрд╛ рдПрдХ рдмрдбрд╝рд╛ рд╣рд┐рд╕реНрд╕рд╛ **unauthenticated** рд░реВрдк рд╕реЗ enumerable рд╣реИред рдпрд╣ рд╕рднреА рдбреЗрдЯрд╛ рдХреЛ enumerate рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдЙрдкрд▓рдмреНрдз рд╣реИ:
```
ldapsearch -x
```
рдЕрдзрд┐рдХ **рдЬрд╛рдирдХрд╛рд░реА** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ **рдкреНрд░рдорд╛рдгрд┐рдд** рд╕рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдиреБрднрд╛рдЧ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдкреНрд░рдорд╛рдгрд┐рдд рд╕рддреНрд░ рддреИрдпрд╛рд░ рдХрд░рдирд╛ рд╕реАрдЦ рд╕рдХреЗрдВ)ред
```bash
# Get all users of domain
ldapsearch -Y gssapi -b "cn=users,cn=compat,dc=domain_name,dc=local"

# Get users groups
ldapsearch -Y gssapi -b "cn=groups,cn=accounts,dc=domain_name,dc=local"

# Get all the hosts
ldapsearch -Y gssapi -b "cn=computers,cn=accounts,dc=domain_name,dc=local"

# Get hosts groups
ldapsearch -Y gssapi -b "cn=hostgroups,cn=accounts,dc=domain_name,dc=local"
```
рдПрдХ рдбреЛрдореЗрди рд╕реЗ рдЬреБрдбрд╝реЗ рдорд╢реАрди рд╕реЗ рдЖрдк **рд╕реНрдерд╛рдкрд┐рдд рдмрд╛рдЗрдирд░реА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХреЗрдВрдЧреЗ:
```bash
ipa user-find
ipa usergroup-find
ipa host-find
ipa host-group-find

-------------------

ipa user-show <username> --all
ipa usergroup-show <user group> --all
ipa host-find <host> --all
ipa hostgroup-show <host group> --all
```
{% hint style="info" %}
**FreeIPA** рдХрд╛ **admin** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **AD** рдХреЗ **domain admins** рдХреЗ рд╕рдордХрдХреНрд╖ рд╣реИред
{% endhint %}

### Hashes <a href="#id-482b" id="id-482b"></a>

**IPA рд╕рд░реНрд╡рд░** рдХрд╛ **root** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб **hashes** рддрдХ рдкрд╣реБрдБрдЪ рд░рдЦрддрд╛ рд╣реИред

* рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ **userPassword** **attribute** рдореЗрдВ **base64** рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рд╣реИрд╢ **SSHA512** (FreeIPA рдХреЗ рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдг) рдпрд╛ **PBKDF2\_SHA256** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
* рдпрджрд┐ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ **AD** рдХреЗ рд╕рд╛рде **integration** рд╣реИ, рддреЛ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ **Nthash** **ipaNTHash** рдореЗрдВ **base64** рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИред

рдЗрди рд╣реИрд╢реЗрд╕ рдХреЛ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

тАв рдпрджрд┐ freeIPA рдХрд╛ AD рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг рд╣реИ, рддреЛ **ipaNTHash** рдХреЛ рдХреНрд░реИрдХ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИ: рдЖрдкрдХреЛ **base64** рдХреЛ **decode** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП -> рдЗрд╕реЗ **ASCII** hex рдХреЗ рд░реВрдк рдореЗрдВ рдлрд┐рд░ рд╕реЗ рдПрдиреНрдХреЛрдб рдХрд░реЗрдВ -> John The Ripper рдпрд╛ **hashcat** рдЖрдкрдХреЛ рдЗрд╕реЗ рддреЗрдЬреА рд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

тАв рдпрджрд┐ FreeIPA рдХрд╛ рдкреБрд░рд╛рдирд╛ рд╕рдВрд╕реНрдХрд░рдг рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ **SSHA512** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: рдЖрдкрдХреЛ **base64** рдХреЛ рдбрд┐рдХреЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП -> SSHA512 **hash** рдЦреЛрдЬреЗрдВ -> John The Ripper рдпрд╛ **hashcat** рдЖрдкрдХреЛ рдЗрд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

тАв рдпрджрд┐ FreeIPA рдХрд╛ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ **PBKDF2\_SHA256** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: рдЖрдкрдХреЛ **base64** рдХреЛ рдбрд┐рдХреЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП -> PBKDF2\_SHA256 рдЦреЛрдЬреЗрдВ -> рдЗрд╕рдХреА **length** 256 рдмрд╛рдЗрдЯ рд╣реИред John 256 рдмрд┐рдЯреНрд╕ (32 рдмрд╛рдЗрдЯ) рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ -> SHA-265 рдХрд╛ рдЙрдкрдпреЛрдЧ рдЫрджреНрдо-рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдмреНрд▓реЙрдХ рдЖрдХрд╛рд░ 32 рдмрд╛рдЗрдЯ рд╣реИ -> рдЖрдк рд╣рдорд╛рд░реЗ PBKDF2\_SHA256 рд╣реИрд╢ рдХреЗ рдХреЗрд╡рд▓ рдкрд╣рд▓реЗ 256 рдмрд┐рдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ -> John The Ripper рдпрд╛ hashcat рдЖрдкрдХреЛ рдЗрд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

<figure><img src="../.gitbook/assets/image (655).png" alt=""><figcaption></figcaption></figure>

рд╣реИрд╢реЗрд╕ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **FreeIPA рд╕рд░реНрд╡рд░ рдореЗрдВ root** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд╡рд╣рд╛рдБ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП **`dbscan`** рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../.gitbook/assets/image (293).png" alt=""><figcaption></figcaption></figure>

### HBAC-Rules <a href="#id-482b" id="id-482b"></a>

рдпреЗ рдирд┐рдпрдо рд╣реИрдВ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдпрд╛ рд╣реЛрд╕реНрдЯреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрдиреЛрдВ (рд╣реЛрд╕реНрдЯ, рд╕реЗрд╡рд╛рдПрдБ, рд╕реЗрд╡рд╛ рд╕рдореВрд╣...) рдкрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред
```bash
# Enumerate using ldap
ldapsearch -Y gssapi -b "cn=hbac,dc=domain_name,dc=local"
# Using ipa
ipa hbacrule-find
# Show info of rule
ipa hbacrule-show <hbacrule> --all
```
#### Sudo-Rules

FreeIPA **sudo permissions** рдХреЗ рд▓рд┐рдП рдХреЗрдВрджреНрд░реАрдХреГрдд рдирд┐рдпрдВрддреНрд░рдг рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИ sudo-rules рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред рдпреЗ рдирд┐рдпрдо рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рд╣реЛрд╕реНрдЯ рдкрд░ sudo рдХреЗ рд╕рд╛рде рдХрдорд╛рдВрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЕрдиреБрдорддрд┐ рдпрд╛ рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЗрди рдирд┐рдпрдореЛрдВ рдХреЗ рд╕реЗрдЯ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рд▓рд╛рдЧреВ рд╣реЛрд╕реНрдЯ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рдЕрдиреБрдордд рдХрдорд╛рдВрдб рдХреА рдкрд╣рдЪрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред
```bash
# Enumerate using ldap
ldapsearch -Y gssapi -b "cn=sudorules,cn=sudo,dc=domain_name,dc=local"
# Using ipa
ipa sudorule-find
# Show info of rule
ipa sudorule-show <sudorule> --all
```
### Role-Based Access Control

рдПрдХ **рднреВрдорд┐рдХрд╛** рд╡рд┐рднрд┐рдиреНрди **рдЕрдзрд┐рдХрд╛рд░реЛрдВ** рд╕реЗ рдорд┐рд▓рдХрд░ рдмрдиреА рд╣реЛрддреА рд╣реИ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдПрдХ **рдЕрдиреБрдорддрд┐** рдХрд╛ рд╕рдВрдЧреНрд░рд╣ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред рдЗрди рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рд╕рдореВрд╣реЛрдВ**, **рд╣реЛрд╕реНрдЯ**, рд╣реЛрд╕реНрдЯ рд╕рдореВрд╣реЛрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕реМрдВрдкрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рд╕рдВрд░рдЪрдирд╛ рдХреЛ рд╕реНрдкрд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП FreeIPA рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ" рднреВрдорд┐рдХрд╛ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред

рднреВрдорд┐рдХрд╛ `рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ` рдХреЗ рдкрд╛рд╕ рдпреЗ рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ:

* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ**
* **рд╕рдореВрд╣ рдкреНрд░рд╢рд╛рд╕рдХ**
* **рд╕реНрдЯреЗрдЬ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рднреВрдорд┐рдХрд╛рдУрдВ, рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдФрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```bash
# Using ldap
ldapsearch -Y gssapi -b "cn=roles,cn=accounts,dc=westeros,dc=local"
# Using ipa binary
ipa role-find
ipa role-show <role> --all
ipa privilege-find
ipa privilege-show <privilege> --all
ipa permission-find
ipa permission-show <permission> --all
```
### Attack Scenario Example

In [https://posts.specterops.io/attacking-freeipa-part-iii-finding-a-path-677405b5b95e](https://posts.specterops.io/attacking-freeipa-part-iii-finding-a-path-677405b5b95e) рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреБрдЫ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХреЛ рдХреИрд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### Linikatz/LinikatzV2

* [https://github.com/Orange-Cyberdefense/LinikatzV2](https://github.com/Orange-Cyberdefense/LinikatzV2)
* [https://github.com/CiscoCXSecurity/linikatz](https://github.com/CiscoCXSecurity/linikatz)

## Privesc

### ~~root user creation~~

{% hint style="warning" %}
рдпрджрд┐ рдЖрдк **`root` рдирд╛рдо рдХрд╛ рдПрдХ рдирдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк рдЙрд╕рдХреА рдирдХрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдк **рдХрд┐рд╕реА рднреА рдорд╢реАрди рдореЗрдВ root рдХреЗ рд░реВрдк рдореЗрдВ SSH рдХрд░ рд╕рдХреЗрдВрдЧреЗред**

**рдпрд╣ рдкреИрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред**
{% endhint %}

рдЖрдк рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╡реНрдпрд╛рдЦреНрдпрд╛ [https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b](https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b) рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

## References

* [https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b](https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b)
* [https://posts.specterops.io/attacking-freeipa-part-i-authentication-77e73d837d6a](https://posts.specterops.io/attacking-freeipa-part-i-authentication-77e73d837d6a)
* [https://posts.specterops.io/attacking-freeipa-part-ii-enumeration-ad27224371e1](https://posts.specterops.io/attacking-freeipa-part-ii-enumeration-ad27224371e1)
* [https://www.youtube.com/watch?v=9dOu-7BTwPQ](https://www.youtube.com/watch?v=9dOu-7BTwPQ)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
