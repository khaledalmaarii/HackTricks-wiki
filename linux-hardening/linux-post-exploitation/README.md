# Linux SonrasÄ± SÄ±zma

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## PAM ile Oturum AÃ§ma ParolalarÄ±nÄ± Yakalamak

Her kullanÄ±cÄ±nÄ±n giriÅŸ yaparken kullandÄ±ÄŸÄ± her parolayÄ± kaydetmek iÃ§in bir PAM modÃ¼lÃ¼ yapÄ±landÄ±ralÄ±m. PAM nedir bilmiyorsanÄ±z:

{% content-ref url="pam-pluggable-authentication-modules.md" %}
[pam-pluggable-authentication-modules.md](pam-pluggable-authentication-modules.md)
{% endcontent-ref %}

**Daha fazla ayrÄ±ntÄ± iÃ§in [orijinal yayÄ±na](https://embracethered.com/blog/posts/2022/post-exploit-pam-ssh-password-grabbing/) bakÄ±n**. Ä°ÅŸte sadece bir Ã¶zet:

**Teknik Genel BakÄ±ÅŸ:**
Pluggable Authentication Modules (PAM), Unix tabanlÄ± sistemlerde kimlik doÄŸrulama yÃ¶netiminde esneklik sunar. GiriÅŸ sÃ¼reÃ§lerini Ã¶zelleÅŸtirerek gÃ¼venliÄŸi artÄ±rabilirler, ancak yanlÄ±ÅŸ kullanÄ±lÄ±rsa risk oluÅŸturabilirler. Bu Ã¶zet, PAM kullanarak giriÅŸ kimlik bilgilerini yakalamak iÃ§in bir teknik ve azaltma stratejilerini aÃ§Ä±klar.

**Kimlik Bilgilerini Yakalama:**
- `toomanysecrets.sh` adÄ±nda bir bash betiÄŸi, giriÅŸ denemelerini kaydetmek iÃ§in oluÅŸturulur ve tarih, kullanÄ±cÄ± adÄ± (`$PAM_USER`), parola (stdin aracÄ±lÄ±ÄŸÄ±yla) ve uzak ana bilgisayar IP'si (`$PAM_RHOST`) bilgilerini `/var/log/toomanysecrets.log` dosyasÄ±na kaydeder.
- Betik Ã§alÄ±ÅŸtÄ±rÄ±labilir hale getirilir ve `pam_exec.so` modÃ¼lÃ¼ kullanÄ±larak PAM yapÄ±landÄ±rmasÄ±na (`common-auth`) entegre edilir. BetiÄŸe sessizce Ã§alÄ±ÅŸtÄ±rma ve kimlik doÄŸrulama belirtecinin betiÄŸe aÃ§Ä±k olmasÄ±nÄ± saÄŸlayan seÃ§enekler eklenir.
- Bu yaklaÅŸÄ±m, bir Linux ana bilgisayarÄ±n nasÄ±l istismar edilerek kimlik bilgilerinin gizlice kaydedilebileceÄŸini gÃ¶sterir.
```bash
#!/bin/sh
echo " $(date) $PAM_USER, $(cat -), From: $PAM_RHOST" >> /var/log/toomanysecrets.log
sudo touch /var/log/toomanysecrets.sh
sudo chmod 770 /var/log/toomanysecrets.sh
sudo nano /etc/pam.d/common-auth
# Add: auth optional pam_exec.so quiet expose_authtok /usr/local/bin/toomanysecrets.sh
sudo chmod 700 /usr/local/bin/toomanysecrets.sh
```
### PAM'e Arka KapÄ± Ekleme

**Daha fazla ayrÄ±ntÄ± iÃ§in [orijinal yazÄ±ya](https://infosecwriteups.com/creating-a-backdoor-in-pam-in-5-line-of-code-e23e99579cd9) bakÄ±n**. Ä°ÅŸte sadece bir Ã¶zet:

Pluggable Authentication Module (PAM), Linux altÄ±nda kullanÄ±cÄ± kimlik doÄŸrulamasÄ± iÃ§in kullanÄ±lan bir sistemdir. ÃœÃ§ temel kavram Ã¼zerinde Ã§alÄ±ÅŸÄ±r: **kullanÄ±cÄ± adÄ±**, **parola** ve **hizmet**. Her hizmet iÃ§in yapÄ±landÄ±rma dosyalarÄ± `/etc/pam.d/` dizininde bulunur ve kimlik doÄŸrulamasÄ±nÄ± paylaÅŸÄ±lan kÃ¼tÃ¼phaneler yÃ¶netir.

**AmaÃ§**: PAM'Ä± deÄŸiÅŸtirerek, gerÃ§ek kullanÄ±cÄ± parolasÄ±nÄ± atlayarak belirli bir parola ile kimlik doÄŸrulamasÄ±na izin vermek. Bu Ã¶zellikle, neredeyse tÃ¼m hizmetler iÃ§in parola doÄŸrulamasÄ± iÃ§in kullanÄ±lan `common-auth` dosyasÄ± tarafÄ±ndan dahil edilen `pam_unix.so` paylaÅŸÄ±lan kÃ¼tÃ¼phanesine odaklanÄ±r.

### `pam_unix.so`'yu DeÄŸiÅŸtirme AdÄ±mlarÄ±:

1. `common-auth` dosyasÄ±nda **Kimlik DoÄŸrulama YÃ¶nergesini** bulun:
- KullanÄ±cÄ±nÄ±n parolasÄ±nÄ± kontrol eden satÄ±r `pam_unix.so`'yu Ã§aÄŸÄ±rÄ±r.
2. **Kaynak Kodunu DeÄŸiÅŸtirin**:
- `pam_unix_auth.c` kaynak dosyasÄ±na, Ã¶nceden tanÄ±mlanmÄ±ÅŸ bir parola kullanÄ±lÄ±yorsa eriÅŸimi saÄŸlayan bir koÅŸullu ifade ekleyin, aksi takdirde normal kimlik doÄŸrulama sÃ¼recine devam eder.
3. DeÄŸiÅŸtirilmiÅŸ `pam_unix.so` kÃ¼tÃ¼phanesini uygun dizine **yeniden derleyin ve deÄŸiÅŸtirin**.
4. **Test Etme**:
- Ã–nceden tanÄ±mlanmÄ±ÅŸ parola ile Ã§eÅŸitli hizmetlere (giriÅŸ, ssh, sudo, su, ekran koruyucu) eriÅŸim saÄŸlanÄ±rken, normal kimlik doÄŸrulama sÃ¼reÃ§leri etkilenmez.

{% hint style="info" %}
Bu sÃ¼reci [https://github.com/zephrax/linux-pam-backdoor](https://github.com/zephrax/linux-pam-backdoor) ile otomatikleÅŸtirebilirsiniz.
{% endhint %}

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINA**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
