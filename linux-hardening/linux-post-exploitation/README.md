# Linux SaldÄ±rÄ± SonrasÄ± Ä°ÅŸlemler

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitimi AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitimi GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na katkÄ±da bulunun.**

</details>
{% endhint %}

## PAM ile Oturum AÃ§ma Åifrelerini Yakalama

Her kullanÄ±cÄ±nÄ±n giriÅŸ yaparken kullandÄ±ÄŸÄ± her ÅŸifreyi kaydetmek iÃ§in bir PAM modÃ¼lÃ¼ yapÄ±landÄ±ralÄ±m. PAM nedir bilmiyorsanÄ±z ÅŸuraya bakÄ±n:

{% content-ref url="pam-pluggable-authentication-modules.md" %}
[pam-pluggable-authentication-modules.md](pam-pluggable-authentication-modules.md)
{% endcontent-ref %}

**Daha fazla ayrÄ±ntÄ± iÃ§in [orijinal yazÄ±ya](https://embracethered.com/blog/posts/2022/post-exploit-pam-ssh-password-grabbing/) bakÄ±n**. Bu sadece bir Ã¶zet:

**Teknik Genel BakÄ±ÅŸ:**
Pluggable Authentication Modules (PAM), Unix tabanlÄ± sistemlerde kimlik doÄŸrulamayÄ± yÃ¶netmede esneklik sunar. GiriÅŸ sÃ¼reÃ§lerini Ã¶zelleÅŸtirerek gÃ¼venliÄŸi artÄ±rabilirler ancak yanlÄ±ÅŸ kullanÄ±ldÄ±ÄŸÄ±nda risk oluÅŸturabilirler. Bu Ã¶zet, PAM kullanarak giriÅŸ kimlik bilgilerini yakalamak iÃ§in bir teknik ve azaltma stratejilerini aÃ§Ä±klar.

**Kimlik Bilgilerini Yakalama:**
- `toomanysecrets.sh` adÄ±nda bir bash betiÄŸi oluÅŸturulur ve giriÅŸ denemelerini kaydetmek iÃ§in yapÄ±landÄ±rÄ±lÄ±r; tarih, kullanÄ±cÄ± adÄ± (`$PAM_USER`), ÅŸifre (stdin aracÄ±lÄ±ÄŸÄ±yla) ve uzak ana bilgisayar IP'si (`$PAM_RHOST`) `/var/log/toomanysecrets.log` dosyasÄ±na kaydedilir.
- Betik yÃ¼rÃ¼tÃ¼lebilir hale getirilir ve `pam_exec.so` modÃ¼lÃ¼ kullanÄ±larak sessizce Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ± ve kimlik doÄŸrulama belirtecinin betiÄŸe aÃ§Ä±k hale getirilmesi seÃ§enekleriyle PAM yapÄ±landÄ±rmasÄ±na (`common-auth`) entegre edilir.
- Bu yaklaÅŸÄ±m, bir Linux ana bilgisayarÄ±nÄ±n nasÄ±l istismar edilerek kimlik bilgilerinin gizlice kaydedilebileceÄŸini gÃ¶stermektedir.
```bash
#!/bin/sh
echo " $(date) $PAM_USER, $(cat -), From: $PAM_RHOST" >> /var/log/toomanysecrets.log
sudo touch /var/log/toomanysecrets.sh
sudo chmod 770 /var/log/toomanysecrets.sh
sudo nano /etc/pam.d/common-auth
# Add: auth optional pam_exec.so quiet expose_authtok /usr/local/bin/toomanysecrets.sh
sudo chmod 700 /usr/local/bin/toomanysecrets.sh
```
### PAM Arka KapÄ± Ekleme

**Daha fazla ayrÄ±ntÄ± iÃ§in [orijinal yazÄ±ya](https://infosecwriteups.com/creating-a-backdoor-in-pam-in-5-line-of-code-e23e99579cd9) bakÄ±n**. Bu sadece bir Ã¶zet:

Pluggable Authentication Module (PAM), Linux altÄ±nda kullanÄ±lan bir sistemdir ve kullanÄ±cÄ± kimlik doÄŸrulamasÄ± iÃ§in kullanÄ±lÄ±r. ÃœÃ§ ana kavram Ã¼zerinde Ã§alÄ±ÅŸÄ±r: **kullanÄ±cÄ± adÄ±**, **ÅŸifre** ve **hizmet**. Her hizmet iÃ§in yapÄ±landÄ±rma dosyalarÄ±, kimlik doÄŸrulamasÄ±nÄ± ele alan paylaÅŸÄ±lan kÃ¼tÃ¼phanelerin bulunduÄŸu `/etc/pam.d/` dizininde bulunur.

**AmaÃ§**: PAM'Ä± deÄŸiÅŸtirerek belirli bir ÅŸifre ile kimlik doÄŸrulamasÄ±na izin vermek ve gerÃ§ek kullanÄ±cÄ± ÅŸifresini atlamak. Bu Ã¶zellikle, neredeyse tÃ¼m hizmetler tarafÄ±ndan ÅŸifre doÄŸrulamasÄ± iÃ§in kullanÄ±lan `common-auth` dosyasÄ±nda bulunan `pam_unix.so` paylaÅŸÄ±lan kÃ¼tÃ¼phaneye odaklanmaktadÄ±r.

### `pam_unix.so`'yi DeÄŸiÅŸtirme AdÄ±mlarÄ±:

1. **Kimlik DoÄŸrulama YÃ¶nergesini Bulun** `common-auth` dosyasÄ±nda:
- KullanÄ±cÄ±nÄ±n ÅŸifresini kontrol etmekten sorumlu olan satÄ±r `pam_unix.so`'yu Ã§aÄŸÄ±rÄ±r.
2. **Kaynak Kodunu DeÄŸiÅŸtirin**:
- `pam_unix_auth.c` kaynak dosyasÄ±na, Ã¶nceden belirlenmiÅŸ bir ÅŸifre kullanÄ±ldÄ±ÄŸÄ±nda eriÅŸimi saÄŸlayan bir koÅŸullu ifade ekleyin, aksi takdirde normal kimlik doÄŸrulama sÃ¼recine devam eder.
3. **DeÄŸiÅŸtirilmiÅŸ `pam_unix.so` kÃ¼tÃ¼phanesini Yeniden Derleyin ve DeÄŸiÅŸtirin** uygun dizine.
4. **Test Etme**:
- Ã–nceden belirlenmiÅŸ ÅŸifre ile Ã§eÅŸitli hizmetlere (giriÅŸ, ssh, sudo, su, ekran koruyucu) eriÅŸim saÄŸlanÄ±rken normal kimlik doÄŸrulama sÃ¼reÃ§leri etkilenmez.

{% hint style="info" %}
Bu sÃ¼reci [https://github.com/zephrax/linux-pam-backdoor](https://github.com/zephrax/linux-pam-backdoor) ile otomatikleÅŸtirebilirsiniz.
{% endhint %}
