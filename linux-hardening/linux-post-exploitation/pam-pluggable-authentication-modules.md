<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Travaillez-vous dans une entreprise de cybersÃ©curitÃ© ? Voulez-vous voir votre entreprise annoncÃ©e dans HackTricks ? ou voulez-vous avoir accÃ¨s Ã  la derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


PAM est une collection de modules qui forment essentiellement une barriÃ¨re entre un service sur votre systÃ¨me et l'utilisateur du service. Les modules peuvent avoir des objectifs trÃ¨s diffÃ©rents, allant de l'interdiction de connexion aux utilisateurs d'un groupe UNIX particulier \(ou d'un groupe de rÃ©seau, ou d'un sous-rÃ©seau...\), Ã  la mise en place de limites de ressources afin que votre groupe de "recherche" ne puisse pas monopoliser les ressources systÃ¨me.

# Fichiers de configuration

Solaris et d'autres systÃ¨mes UNIX commerciaux ont un modÃ¨le de configuration lÃ©gÃ¨rement diffÃ©rent, centrÃ© autour d'un seul fichier, **`/etc/pam.conf`**. Sur la plupart des systÃ¨mes Linux, ces fichiers de configuration se trouvent dans **`/etc/pam.d`**, et sont nommÃ©s d'aprÃ¨s le service - par exemple, le fichier de configuration "login" s'appelle **`/etc/pam.d/login`**. Jetons un coup d'Å“il rapide Ã  une version de ce fichier :
```text
auth required /lib/security/pam_securetty.so
auth required /lib/security/pam_nologin.so
auth sufficient /lib/security/pam_ldap.so
auth required /lib/security/pam_unix_auth.so try_first_pass
account sufficient /lib/security/pam_ldap.so
account required /lib/security/pam_unix_acct.so
password required /lib/security/pam_cracklib.so
password required /lib/security/pam_ldap.so
password required /lib/security/pam_pwdb.so use_first_pass
session required /lib/security/pam_unix_session.so
```
## **Royaumes de gestion PAM**

La colonne de gauche peut contenir quatre mots uniques, qui reprÃ©sentent quatre royaumes de gestion PAM: **auth**, **account**, **password** et **session**. Bien qu'il existe de nombreux modules qui prennent en charge plus d'un de ces royaumes \(en effet, pam\_unix prend en charge tous les royaumes\), d'autres, comme pam\_cracklib par exemple, ne conviennent qu'Ã  un seul \(la fonctionnalitÃ© Â«passwordÂ» dans le cas de pam\_cracklib\).

* **auth**: Le royaume Â«authÂ» \(que j'appelle un royaume - les docs le dÃ©signent comme un Â«groupe de gestionÂ» ou une Â«facilitÃ©Â»\) est responsable de la vÃ©rification que l'utilisateur est bien celui qu'il prÃ©tend Ãªtre. Les modules qui peuvent Ãªtre rÃ©pertoriÃ©s dans cette zone prennent gÃ©nÃ©ralement en charge la demande d'un mot de passe.
* **account**: Cette zone est responsable d'une large gamme de fonctionnalitÃ©s de vÃ©rification de compte possibles. Il existe de nombreux modules disponibles pour cette facilitÃ©. Les contraintes Ã  l'utilisation d'un service basÃ©es sur la vÃ©rification de l'appartenance Ã  un groupe, l'heure de la journÃ©e, que le compte utilisateur est local ou distant, etc., sont gÃ©nÃ©ralement appliquÃ©es par des modules qui prennent en charge cette facilitÃ©.
* **password**: Les modules de cette zone sont responsables de toute fonctionnalitÃ© nÃ©cessaire dans le cadre de la mise Ã  jour des mots de passe pour un service donnÃ©. La plupart du temps, cette section est assez Â«banaleÂ», appelant simplement un module qui demandera un mot de passe actuel, et, en supposant que cela rÃ©ussisse, vous demandera un nouveau mot de passe. D'autres modules pourraient Ãªtre ajoutÃ©s pour effectuer une complexitÃ© de mot de passe ou une vÃ©rification de dictionnaire Ã©galement, comme celle effectuÃ©e par les modules pam\_cracklib et pam\_pwcheck.
* **session**: Les modules de cette zone effectuent un certain nombre de choses qui se produisent soit pendant la configuration ou le nettoyage d'un service pour un utilisateur donnÃ©. Cela peut inclure un certain nombre de choses; lancement d'un script d'initialisation Ã  l'Ã©chelle du systÃ¨me, rÃ©alisation d'une journalisation spÃ©ciale, montage du rÃ©pertoire personnel de l'utilisateur ou dÃ©finition de limites de ressources.

## **ContrÃ´les de module PAM**

La **colonne du milieu** contient un mot-clÃ© qui dÃ©termine essentiellement ce que PAM doit faire si le module rÃ©ussit ou Ã©choue. Ces mots-clÃ©s sont appelÃ©s Â«contrÃ´lesÂ» en langage PAM. Dans 90% des cas, vous pouvez utiliser l'un des mots-clÃ©s courants \(Â«requisÂ», Â«obligatoireÂ», Â«suffisantÂ» ou Â«facultatifÂ»\). Cependant, ce n'est que la pointe de l'iceberg en termes de libÃ©ration de la flexibilitÃ© et de la puissance de PAM.

* **required**: Si un module Â«requisÂ» renvoie un statut qui n'est pas Â«succÃ¨sÂ», l'opÃ©ration Ã©chouera toujours, mais seulement aprÃ¨s que les modules ci-dessous ont Ã©tÃ© invoquÃ©s. Cela semble absurde Ã  premiÃ¨re vue, je suppose, mais cela sert Ã  toujours agir de la mÃªme maniÃ¨re du point de vue de l'utilisateur essayant d'utiliser le service. L'effet net est qu'il devient impossible pour un pirate potentiel de dÃ©terminer quel module a causÃ© l'Ã©chec.
* **requisite**: Si un module Â«requisÂ» Ã©choue, l'opÃ©ration Ã©choue non seulement, mais l'opÃ©ration est immÃ©diatement interrompue avec une erreur sans invoquer d'autres modules.
* **sufficient**: Si un module Â«suffisantÂ» rÃ©ussit, il suffit de satisfaire les exigences des modules suffisants dans ce royaume pour l'utilisation du service, et les modules ci-dessous qui sont Ã©galement rÃ©pertoriÃ©s comme Â«suffisantsÂ» ne sont pas invoquÃ©s. S'il Ã©choue, l'opÃ©ration Ã©choue Ã  moins qu'un module invoquÃ© aprÃ¨s lui ne rÃ©ussisse.
* **optional**: Un module Â«facultatifÂ», selon la page de manuel pam\(8\), ne fera Ã©chouer une opÃ©ration que s'il est le seul module dans la pile pour cette facilitÃ©.

## Exemple

Dans notre fichier d'exemple, nous avons quatre modules empilÃ©s pour le royaume auth:
```text
auth       required     /lib/security/pam_securetty.so
auth       required     /lib/security/pam_env.so
auth       sufficient   /lib/security/pam_ldap.so
auth       required     /lib/security/pam_unix.so try_first_pass
```
Comme les modules sont invoquÃ©s dans l'ordre, voici ce qui se passera :

1. Le module '**pam_securetty**' vÃ©rifiera son fichier de configuration, **`/etc/securetty`**, et vÃ©rifiera si le terminal utilisÃ© pour cette connexion est rÃ©pertoriÃ© dans le fichier. Si **ce n'est pas le cas, les connexions root ne seront pas autorisÃ©es**. Si vous essayez de vous connecter en tant que root sur un terminal "mauvais", ce module Ã©chouera. Ã‰tant donnÃ© qu'il est "requis", il invoquera toujours tous les modules de la pile. Cependant, mÃªme si chacun d'entre eux rÃ©ussit, la connexion Ã©chouera. Il est intÃ©ressant de noter que si le module Ã©tait rÃ©pertoriÃ© comme "requis", l'opÃ©ration se terminerait immÃ©diatement par un Ã©chec, sans invoquer aucun des autres modules, quel que soit leur statut.
2. Le module '**pam_env**' **dÃ©finira des variables d'environnement** en fonction de ce que l'administrateur a configurÃ© dans /etc/security/pam_env.conf. Sur une configuration par dÃ©faut de Redhat 9, Fedora Core 1 et Mandrake 9.2, le fichier de configuration pour ce module ne dÃ©finit en fait aucune variable. Une bonne utilisation de cela pourrait Ãªtre de dÃ©finir automatiquement une variable d'environnement DISPLAY pour un utilisateur se connectant via SSH afin qu'il n'ait pas Ã  le dÃ©finir lui-mÃªme s'il veut envoyer un 'xterm' vers son bureau Ã  distance (bien que cela puisse Ãªtre pris en charge automatiquement par OpenSSH).
3. Le module '**pam_ldap**' **demandera** Ã  l'utilisateur un **mot de passe**, puis vÃ©rifiera le rÃ©pertoire ldap indiquÃ© dans **`/etc/ldap.conf`** pour authentifier l'utilisateur. Si cela Ã©choue, l'opÃ©ration peut toujours rÃ©ussir si 'pam_unix' rÃ©ussit Ã  authentifier l'utilisateur. Si pam_ldap rÃ©ussit, 'pam_unix' ne sera pas invoquÃ©.
4. Le module '**pam_unix**', dans ce cas, **ne demandera pas Ã  l'utilisateur de saisir un mot de passe**. L'argument 'try_first_pass' indiquera au module d'utiliser le mot de passe qui lui a Ã©tÃ© donnÃ© par le module prÃ©cÃ©dent (dans ce cas, pam_ldap). Il essaiera d'authentifier l'utilisateur en utilisant les appels systÃ¨me standard getpw\*. Si pam_unix Ã©choue et que pam_ldap a Ã©chouÃ©, l'opÃ©ration Ã©chouera. Si pam_ldap Ã©choue mais que pam_unix rÃ©ussit, l'opÃ©ration rÃ©ussira (ce qui est extrÃªmement utile dans les cas oÃ¹ root n'est pas dans le rÃ©pertoire ldap, mais est toujours dans le fichier local /etc/passwd !).
