# euid, ruid, suid

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### User Identification Variables

- **`ruid`**: **рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ рдХреАред
- **`euid`**: **рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рдЪрд╛рди рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд░рдгрд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреА рд╣реИред рд╕рд╛рдорд╛рдиреНрдпрддрдГ, `euid` `ruid` рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИ, рд╕рд┐рд╡рд╛рдп рдЙрди рдорд╛рдорд▓реЛрдВ рдХреЗ рдЬреИрд╕реЗ рдХрд┐ SetUID рдмрд╛рдЗрдирд░реА рдирд┐рд╖реНрдкрд╛рджрди, рдЬрд╣рд╛рдВ `euid` рдлрд╝рд╛рдЗрд▓ рдХреЗ рдорд╛рд▓рд┐рдХ рдХреА рдкрд╣рдЪрд╛рди рдЧреНрд░рд╣рдг рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрдЪрд╛рд▓рди рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
- **`suid`**: рдпрд╣ **рд╕рд╣реЗрдЬреА рдЧрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдЬрдм рдПрдХ рдЙрдЪреНрдЪ-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ (рдЖрдорддреМрд░ рдкрд░ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реА) рдХреЛ рдХреБрдЫ рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдЕрдкрдиреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдХреЗрд╡рд▓ рдмрд╛рдж рдореЗрдВ рдЕрдкрдиреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдКрдВрдЪреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

#### Important Note
рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЬреЛ рд░реВрдЯ рдХреЗ рддрд╣рдд рдХрд╛рд░реНрдп рдирд╣реАрдВ рдХрд░ рд░рд╣реА рд╣реИ, рдХреЗрд╡рд▓ рдЕрдкрдиреЗ `euid` рдХреЛ рд╡рд░реНрддрдорд╛рди `ruid`, `euid`, рдпрд╛ `suid` рдХреЗ рд╕рд╛рде рдореЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреА рд╣реИред

### Understanding set*uid Functions

- **`setuid`**: рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдзрд╛рд░рдгрд╛рдУрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, `setuid` рдореБрдЦреНрдп рд░реВрдк рд╕реЗ `euid` рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рди рдХрд┐ `ruid`ред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ `ruid`, `euid`, рдФрд░ `suid` рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рдЕрдХреНрд╕рд░ рд░реВрдЯ, рдХреЗ рд╕рд╛рде рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдЗрди рдЖрдИрдбреА рдХреЛ `suid` рджреНрд╡рд╛рд░рд╛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдХреЗ рдордЬрдмреВрдд рдХрд░рддрд╛ рд╣реИред рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА [setuid рдореИрди рдкреГрд╖реНрда](https://man7.org/linux/man-pages/man2/setuid.2.html) рдореЗрдВ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред
- **`setreuid`** рдФрд░ **`setresuid`**: рдпреЗ рдХрд╛рд░реНрдп `ruid`, `euid`, рдФрд░ `suid` рдХреЗ рд╕реВрдХреНрд╖реНрдо рд╕рдорд╛рдпреЛрдЬрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЙрдирдХреА рдХреНрд╖рдорддрд╛рдПрдБ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕реНрддрд░ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИрдВред рдЧреИрд░-рд░реВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рд╕рдВрд╢реЛрдзрди рд╡рд░реНрддрдорд╛рди `ruid`, `euid`, рдФрд░ `suid` рдХреЗ рдорд╛рдиреЛрдВ рддрдХ рд╕реАрдорд┐рдд рд╣реИрдВред рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, рд░реВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдпрд╛ рд╡реЗ рдЬрд┐рдирдХреЗ рдкрд╛рд╕ `CAP_SETUID` рдХреНрд╖рдорддрд╛ рд╣реИ, рдЗрди рдЖрдИрдбреА рдХреЛ рдордирдорд╛рдиреЗ рдорд╛рди рд╕реМрдВрдк рд╕рдХрддреА рд╣реИрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [setresuid рдореИрди рдкреГрд╖реНрда](https://man7.org/linux/man-pages/man2/setresuid.2.html) рдФрд░ [setreuid рдореИрди рдкреГрд╖реНрда](https://man7.org/linux/man-pages/man2/setreuid.2.html) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

рдпреЗ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдПрдБ рд╕реБрд░рдХреНрд╖рд╛ рддрдВрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ рдмрд▓реНрдХрд┐ рдЕрдкреЗрдХреНрд╖рд┐рдд рд╕рдВрдЪрд╛рд▓рди рдкреНрд░рд╡рд╛рд╣ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рдЬрдм рдПрдХ рдХрд╛рд░реНрдпрдХреНрд░рдо рдЕрдкрдиреА рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЛ рдмрджрд▓рдХрд░ рджреВрд╕рд░реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣рдЪрд╛рди рдЕрдкрдирд╛рддрд╛ рд╣реИред

рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдЬрдмрдХрд┐ `setuid` рд░реВрдЯ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рднреА рдЖрдИрдбреА рдХреЛ рд░реВрдЯ рдХреЗ рд╕рд╛рде рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рддрд╛ рд╣реИ), рдЗрди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдмреАрдЪ рднреЗрдж рдХрд░рдирд╛ рд╡рд┐рднрд┐рдиреНрди рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рд╕рдордЭрдиреЗ рдФрд░ рд╣реЗрд░рдлреЗрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред

### Program Execution Mechanisms in Linux

#### **`execve` System Call**
- **Functionality**: `execve` рдПрдХ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдкрд╣рд▓реЗ рддрд░реНрдХ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рджреЛ рдРрд░реЗ рддрд░реНрдХ рд▓реЗрддрд╛ рд╣реИ, `argv` рддрд░реНрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдФрд░ `envp` рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рд▓рд┐рдПред
- **Behavior**: рдпрд╣ рдХреЙрд▓рд░ рдХреА рдореЗрдореЛрд░реА рд╕реНрдкреЗрд╕ рдХреЛ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рд╕реНрдЯреИрдХ, рд╣реАрдк, рдФрд░ рдбреЗрдЯрд╛ рд╕реЗрдЧрдореЗрдВрдЯ рдХреЛ рддрд╛рдЬрд╝рд╛ рдХрд░рддрд╛ рд╣реИред рдХрд╛рд░реНрдпрдХреНрд░рдо рдХрд╛ рдХреЛрдб рдирдП рдХрд╛рд░реНрдпрдХреНрд░рдо рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
- **User ID Preservation**:
- `ruid`, `euid`, рдФрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдореВрд╣ рдЖрдИрдбреА рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд░рд╣рддреЗ рд╣реИрдВред
- рдпрджрд┐ рдирдП рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ SetUID рдмрд┐рдЯ рд╕реЗрдЯ рд╣реИ рддреЛ `euid` рдореЗрдВ рд╕реВрдХреНрд╖реНрдо рдкрд░рд┐рд╡рд░реНрддрди рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
- рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдмрд╛рдж `suid` рдХреЛ `euid` рд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
- **Documentation**: рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА [`execve` рдореИрди рдкреГрд╖реНрда](https://man7.org/linux/man-pages/man2/execve.2.html) рдкрд░ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред

#### **`system` Function**
- **Functionality**: `execve` рдХреЗ рд╡рд┐рдкрд░реАрдд, `system` рдПрдХ рдмрдЪреНрдЪреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрдирд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ `fork` рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕ рдмрдЪреНрдЪреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХ рдЖрджреЗрд╢ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ `execl` рдХрд░рддрд╛ рд╣реИред
- **Command Execution**: рдЖрджреЗрд╢ рдХреЛ `sh` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ `execl("/bin/sh", "sh", "-c", command, (char *) NULL);` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред
- **Behavior**: рдЪреВрдВрдХрд┐ `execl` `execve` рдХрд╛ рдПрдХ рд░реВрдк рд╣реИ, рдпрд╣ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдПрдХ рдирдП рдмрдЪреНрдЪреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВред
- **Documentation**: рдЖрдЧреЗ рдХреА рдЬрд╛рдирдХрд╛рд░реА [`system` рдореИрди рдкреГрд╖реНрда](https://man7.org/linux/man-pages/man3/system.3.html) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

#### **Behavior of `bash` and `sh` with SUID**
- **`bash`**:
- рдЗрд╕рдХрд╛ рдПрдХ `-p` рд╡рд┐рдХрд▓реНрдк рд╣реИ рдЬреЛ `euid` рдФрд░ `ruid` рдХреЗ рд╕рд╛рде рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред
- рдмрд┐рдирд╛ `-p` рдХреЗ, `bash` `euid` рдХреЛ `ruid` рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдпрджрд┐ рд╡реЗ рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ рднрд┐рдиреНрди рд╣реЛрддреЗ рд╣реИрдВред
- `-p` рдХреЗ рд╕рд╛рде, рдкреНрд░рд╛рд░рдВрднрд┐рдХ `euid` рдХреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
- рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг [`bash` рдореИрди рдкреГрд╖реНрда](https://linux.die.net/man/1/bash) рдкрд░ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
- **`sh`**:
- `bash` рдореЗрдВ `-p` рдХреЗ рд╕рдорд╛рди рдХреЛрдИ рддрдВрддреНрд░ рдирд╣реАрдВ рд╣реИред
- рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЙрд▓реНрд▓реЗрдЦрд┐рдд рдирд╣реАрдВ рд╣реИ, рд╕рд┐рд╡рд╛рдп `-i` рд╡рд┐рдХрд▓реНрдк рдХреЗ рддрд╣рдд, рдЬреЛ `euid` рдФрд░ `ruid` рдХреА рд╕рдорд╛рдирддрд╛ рдХреЛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдкрд░ рдЬреЛрд░ рджреЗрддрд╛ рд╣реИред
- рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА [`sh` рдореИрди рдкреГрд╖реНрда](https://man7.org/linux/man-pages/man1/sh.1p.html) рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред

рдпреЗ рддрдВрддреНрд░, рдЕрдкрдиреЗ рд╕рдВрдЪрд╛рд▓рди рдореЗрдВ рднрд┐рдиреНрди, рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдФрд░ рдЙрдирдХреЗ рдмреАрдЪ рд╕рдВрдХреНрд░рдордг рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣реБрдкрд░рдХрд╛рд░реА рд╡рд┐рдХрд▓реНрдк рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЗ рдкреНрд░рдмрдВрдзрди рдФрд░ рд╕рдВрд░рдХреНрд╖рдг рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реВрдХреНрд╖реНрдорддрд╛рдПрдБ рд╣реЛрддреА рд╣реИрдВред

### Testing User ID Behaviors in Executions

Examples taken from https://0xdf.gitlab.io/2022/05/31/setuid-rabbithole.html#testing-on-jail, check it for further information

#### Case 1: Using `setuid` with `system`

**Objective**: Understanding the effect of `setuid` in combination with `system` and `bash` as `sh`.

**C Code**:
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
system("id");
return 0;
}
```
**рд╕рдВрдХрд▓рди рдФрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдБ:**
```bash
oxdf@hacky$ gcc a.c -o /mnt/nfsshare/a;
oxdf@hacky$ chmod 4755 /mnt/nfsshare/a
```

```bash
bash-4.2$ $ ./a
uid=99(nobody) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* `ruid` рдФрд░ `euid` рдХреНрд░рдорд╢рдГ 99 (рдХреЛрдИ рдирд╣реАрдВ) рдФрд░ 1000 (рдлреНрд░реИрдВрдХ) рдХреЗ рд░реВрдк рдореЗрдВ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВред
* `setuid` рджреЛрдиреЛрдВ рдХреЛ 1000 рдкрд░ рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рддрд╛ рд╣реИред
* `system` `/bin/bash -c id` рдХреЛ sh рд╕реЗ bash рдХреЗ рд▓рд┐рдП symlink рдХреЗ рдХрд╛рд░рдг рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИред
* `bash`, рдмрд┐рдирд╛ `-p` рдХреЗ, `euid` рдХреЛ `ruid` рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рджреЛрдиреЛрдВ 99 (рдХреЛрдИ рдирд╣реАрдВ) рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред

#### рдорд╛рдорд▓рд╛ 2: рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рд╛рде setreuid рдХрд╛ рдЙрдкрдпреЛрдЧ

**C рдХреЛрдб**:
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setreuid(1000, 1000);
system("id");
return 0;
}
```
**рд╕рдВрдХрд▓рди рдФрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдБ:**
```bash
oxdf@hacky$ gcc b.c -o /mnt/nfsshare/b; chmod 4755 /mnt/nfsshare/b
```
**рдирд┐рд╖реНрдкрд╛рджрди рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./b
uid=1000(frank) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* `setreuid` рджреЛрдиреЛрдВ ruid рдФрд░ euid рдХреЛ 1000 рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред
* `system` bash рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЙрдирдХреА рд╕рдорд╛рдирддрд╛ рдХреЗ рдХрд╛рд░рдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЛ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ, рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ frank рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред

#### рдорд╛рдорд▓рд╛ 3: execve рдХреЗ рд╕рд╛рде setuid рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛
рдЙрджреНрджреЗрд╢реНрдп: setuid рдФрд░ execve рдХреЗ рдмреАрдЪ рдмрд╛рддрдЪреАрдд рдХрд╛ рдЕрдиреНрд╡реЗрд╖рдг рдХрд░рдирд╛ред
```bash
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
execve("/usr/bin/id", NULL, NULL);
return 0;
}
```
**рдирд┐рд╖реНрдкрд╛рджрди рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./c
uid=99(nobody) gid=99(nobody) euid=1000(frank) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* `ruid` 99 рдкрд░ рдмрдирд╛ рд░рд╣рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди euid 1000 рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ setuid рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЗ рдЕрдиреБрд░реВрдк рд╣реИред

**C рдХреЛрдб рдЙрджрд╛рд╣рд░рдг 2 (Bash рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛):**
```bash
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
execve("/bin/bash", NULL, NULL);
return 0;
}
```
**рдирд┐рд╖реНрдкрд╛рджрди рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./d
bash-4.2$ $ id
uid=99(nobody) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* рд╣рд╛рд▓рд╛рдБрдХрд┐ `euid` рдХреЛ `setuid` рджреНрд╡рд╛рд░рд╛ 1000 рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, `bash` `-p` рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдХрд╛рд░рдг euid рдХреЛ `ruid` (99) рдкрд░ рд░реАрд╕реЗрдЯ рдХрд░ рджреЗрддрд╛ рд╣реИред

**C рдХреЛрдб рдЙрджрд╛рд╣рд░рдг 3 (bash -p рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП):**
```bash
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
char *const paramList[10] = {"/bin/bash", "-p", NULL};
setuid(1000);
execve(paramList[0], paramList, NULL);
return 0;
}
```
**рдирд┐рд╖реНрдкрд╛рджрди рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./e
bash-4.2$ $ id
uid=99(nobody) gid=99(nobody) euid=100
```
## рд╕рдВрджрд░реНрдн
* [https://0xdf.gitlab.io/2022/05/31/setuid-rabbithole.html#testing-on-jail](https://0xdf.gitlab.io/2022/05/31/setuid-rabbithole.html#testing-on-jail)


{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
