# рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рдЪрд╛рди рдЪрд░

- **`ruid`**: **рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЖрд░рдВрдн рдХреАред
- **`euid`**: **рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рдкреНрд░рдгрд╛рд▓реА рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рдЪрд╛рди рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред рдЖрдорддреМрд░ рдкрд░, `euid` `ruid` рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди SetUID рдмрд╛рдЗрдирд░реА рдирд┐рд╖реНрдкрд╛рджрди рдЬреИрд╕реЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, `euid` рдлрд╛рдЗрд▓ рдорд╛рд▓рд┐рдХ рдХреА рдкрд╣рдЪрд╛рди рдЧреНрд░рд╣рдг рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрдЪрд╛рд▓рдирд╛рддреНрдордХ рдЕрдиреБрдорддрд┐рдпрд╛рдВ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИрдВред
- **`suid`**: рдпрд╣ **рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА** рддрдм рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдПрдХ рдЙрдЪреНрдЪ-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ (рдЖрдорддреМрд░ рдкрд░ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реА) рдХреЛ рдХреБрдЫ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдЕрдкрдиреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рддреНрдпрд╛рдЧрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдХреЗрд╡рд▓ рдмрд╛рдж рдореЗрдВ рдЕрдкрдиреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЙрдЪреНрдЪ рд╕реНрдерд┐рддрд┐ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

#### рдорд╣рддреНрд╡рдкреВрд░реНрдг рдиреЛрдЯ
рд░реВрдЯ рдХреЗ рддрд╣рдд рд╕рдВрдЪрд╛рд▓рд┐рдд рди рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗрд╡рд▓ рдЕрдкрдиреЗ `euid` рдХреЛ рдореМрдЬреВрджрд╛ `ruid`, `euid`, рдпрд╛ `suid` рдХреЗ рдЕрдиреБрд░реВрдк рдмрджрд▓ рд╕рдХрддреА рд╣реИред

### set*uid рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЛ рд╕рдордЭрдирд╛

- **`setuid`**: рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдзрд╛рд░рдгрд╛рдУрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, `setuid` рдореБрдЦреНрдп рд░реВрдк рд╕реЗ `ruid` рдХреЗ рдмрдЬрд╛рдп `euid` рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рдЕрдХреНрд╕рд░ рд░реВрдЯ рдХреЗ рд╕рд╛рде `ruid`, `euid`, рдФрд░ `suid` рдХреЛ рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдЗрди рдЖрдИрдбреА рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд `suid` рдХреЗ рдХрд╛рд░рдг рд╕реНрдерд┐рд░ рдХрд░рддрд╛ рд╣реИред рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА [setuid man page](https://man7.org/linux/man-pages/man2/setuid.2.html) рдкрд░ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред
- **`setreuid`** рдФрд░ **`setresuid`**: рдпреЗ рдлрдВрдХреНрд╢рдиреНрд╕ `ruid`, `euid`, рдФрд░ `suid` рдХреЗ рд╕реВрдХреНрд╖реНрдо рд╕рдорд╛рдпреЛрдЬрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЙрдирдХреА рдХреНрд╖рдорддрд╛рдПрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕реНрддрд░ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИрдВред рдЧреИрд░-рд░реВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рд╕рдВрд╢реЛрдзрди рдореМрдЬреВрджрд╛ `ruid`, `euid`, рдФрд░ `suid` рдХреЗ рдореВрд▓реНрдпреЛрдВ рддрдХ рд╕реАрдорд┐рдд рд╣реИрдВред рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, рд░реВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдпрд╛ рдЙрди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЬрд┐рдирдХреЗ рдкрд╛рд╕ `CAP_SETUID` рдХреНрд╖рдорддрд╛ рд╣реИ, рдЗрди рдЖрдИрдбреА рдХреЛ рдордирдорд╛рдиреЗ рдореВрд▓реНрдп рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [setresuid man page](https://man7.org/linux/man-pages/man2/setresuid.2.html) рдФрд░ [setreuid man page](https://man7.org/linux/man-pages/man2/setreuid.2.html) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

рдпреЗ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдПрдВ рд╕реБрд░рдХреНрд╖рд╛ рддрдВрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ рдмрд▓реНрдХрд┐ рдЗрдЪреНрдЫрд┐рдд рд╕рдВрдЪрд╛рд▓рдирд╛рддреНрдордХ рдкреНрд░рд╡рд╛рд╣ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рдЬрдм рдХреЛрдИ рдХрд╛рд░реНрдпрдХреНрд░рдо рдЕрдкрдиреА рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЛ рдмрджрд▓рдХрд░ рджреВрд╕рд░реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣рдЪрд╛рди рдЕрдкрдирд╛рддрд╛ рд╣реИред

рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдЬрдмрдХрд┐ `setuid` рд░реВрдЯ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЬрд╛рдиреЗ-рдорд╛рдиреЗ рддрд░реАрдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рднреА рдЖрдИрдбреА рдХреЛ рд░реВрдЯ рдХреЗ рд╕рд╛рде рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рддрд╛ рд╣реИ), рд╡рд┐рднрд┐рдиреНрди рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рд╡реНрдпрд╡рд╣рд╛рд░реЛрдВ рдХреЛ рд╕рдордЭрдиреЗ рдФрд░ рд╣реЗрд░рдлреЗрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрди рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред

### рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдХрд╛рд░реНрдпрдХреНрд░рдо рдирд┐рд╖реНрдкрд╛рджрди рддрдВрддреНрд░

#### **`execve` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓**
- **рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛**: `execve` рдкрд╣рд▓реЗ рддрд░реНрдХ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛ рдЖрд░рдВрдн рдХрд░рддрд╛ рд╣реИред рдпрд╣ рджреЛ рд╕рд░рдгреА рддрд░реНрдХреЛрдВ рдХреЛ рд▓реЗрддрд╛ рд╣реИ, `argv` рддрд░реНрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдФрд░ `envp` рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рд▓рд┐рдПред
- **рд╡реНрдпрд╡рд╣рд╛рд░**: рдпрд╣ рдХреЙрд▓рд░ рдХреЗ рдореЗрдореЛрд░реА рд╕реНрдкреЗрд╕ рдХреЛ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рд╕реНрдЯреИрдХ, рд╣реАрдк, рдФрд░ рдбреЗрдЯрд╛ рд╕реЗрдЧрдореЗрдВрдЯреНрд╕ рдХреЛ рддрд╛рдЬрд╝рд╛ рдХрд░рддрд╛ рд╣реИред рдХрд╛рд░реНрдпрдХреНрд░рдо рдХрд╛ рдХреЛрдб рдирдП рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕реЗ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
- **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рд╕рдВрд░рдХреНрд╖рдг**:
- `ruid`, `euid`, рдФрд░ рд╕рд╣рд╛рдпрдХ рд╕рдореВрд╣ рдЖрдИрдбреА рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд░рд╣рддреЗ рд╣реИрдВред
- `euid` рдореЗрдВ рд╕реВрдХреНрд╖реНрдо рдкрд░рд┐рд╡рд░реНрддрди рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдпрджрд┐ рдирдпрд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо SetUID рдмрд┐рдЯ рд╕реЗрдЯ рдХреЗ рд╕рд╛рде рд╣реЛред
- `suid` рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдмрд╛рдж `euid` рд╕реЗ рдЕрдкрдбреЗрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред
- **рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг**: рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА [`execve` man page](https://man7.org/linux/man-pages/man2/execve.2.html) рдкрд░ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред

#### **`system` рдлрдВрдХреНрд╢рди**
- **рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛**: `execve` рдХреЗ рд╡рд┐рдкрд░реАрдд, `system` `fork` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдмрдЪреНрдЪреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЙрд╕ рдмрдЪреНрдЪреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХ рдХрдорд╛рдВрдб рдХреЛ `execl` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИред
- **рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрди**: `execl("/bin/sh", "sh", "-c", command, (char *) NULL);` рдХреЗ рд╕рд╛рде `sh` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИред
- **рд╡реНрдпрд╡рд╣рд╛рд░**: рдЪреВрдВрдХрд┐ `execl` `execve` рдХрд╛ рдПрдХ рд░реВрдк рд╣реИ, рдпрд╣ рдЗрд╕реА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдПрдХ рдирдП рдмрдЪреНрдЪреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВред
- **рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг**: рдЖрдЧреЗ рдХреА рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐ [`system` man page](https://man7.org/linux/man-pages/man3/system.3.html) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

#### **SUID рдХреЗ рд╕рд╛рде `bash` рдФрд░ `sh` рдХрд╛ рд╡реНрдпрд╡рд╣рд╛рд░**
- **`bash`**:
- `-p` рд╡рд┐рдХрд▓реНрдк рд╣реЛрддрд╛ рд╣реИ рдЬреЛ `euid` рдФрд░ `ruid` рдХреЗ рдЙрдкрдЪрд╛рд░ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред
- `-p` рдХреЗ рдмрд┐рдирд╛, `bash` `euid` рдХреЛ `ruid` рдореЗрдВ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдпрджрд┐ рд╡реЗ рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ рднрд┐рдиреНрди рд╣реЛрддреЗ рд╣реИрдВред
- `-p` рдХреЗ рд╕рд╛рде, рдкреНрд░рд╛рд░рдВрднрд┐рдХ `euid` рд╕рдВрд░рдХреНрд╖рд┐рдд рд░рд╣рддрд╛ рд╣реИред
- рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг [`bash` man page](https://linux.die.net/man/1/bash) рдкрд░ рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред
- **`sh`**:
- `bash` рдореЗрдВ `-p` рдХреЗ рд╕рдорд╛рди рдПрдХ рддрдВрддреНрд░ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред
- рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрд▓реНрд▓реЗрдЦ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╕рд┐рд╡рд╛рдп `-i` рд╡рд┐рдХрд▓реНрдк рдХреЗ рддрд╣рдд, рдЬреЛ `euid` рдФрд░ `ruid` рдХреА рд╕рдорд╛рдирддрд╛ рдХреЗ рд╕рдВрд░рдХреНрд╖рдг рдкрд░ рдЬреЛрд░ рджреЗрддрд╛ рд╣реИред
- рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА [`sh` man page](https://man7.org/linux/man-pages/man1/sh.1p.html) рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред

рдпреЗ рддрдВрддреНрд░, рдЕрдкрдиреЗ рд╕рдВрдЪрд╛рд▓рди рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ, рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдФрд░ рд╕рдВрдХреНрд░рдордг рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣реБрдореБрдЦреА рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЗ рдкреНрд░рдмрдВрдзрди рдФрд░ рд╕рдВрд░рдХреНрд╖рдг рдореЗрдВ рдХреИрд╕реЗ рд╡рд┐рд╢рд┐рд╖реНрдЯрддрд╛рдПрдВ рд╣реЛрддреА рд╣реИрдВред

### рдирд┐рд╖реНрдкрд╛рджрди рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рд╡реНрдпрд╡рд╣рд╛рд░реЛрдВ рдХрд╛ рдкрд░реАрдХреНрд╖рдг

рдЙрджрд╛рд╣рд░рдг https://0xdf.gitlab.io/2022/05/31/setuid-rabbithole.html#testing-on-jail рд╕реЗ рд▓рд┐рдП рдЧрдП рд╣реИрдВ, рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рджреЗрдЦреЗрдВ

#### рдорд╛рдорд▓рд╛ 1: `setuid` рдХрд╛ рдЙрдкрдпреЛрдЧ `system` рдХреЗ рд╕рд╛рде

**рдЙрджреНрджреЗрд╢реНрдп**: `setuid`
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
system("id");
return 0;
}
```
**рд╕рдВрдХрд▓рди рдФрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдБ:**
```bash
oxdf@hacky$ gcc a.c -o /mnt/nfsshare/a;
oxdf@hacky$ chmod 4755 /mnt/nfsshare/a
```

```bash
bash-4.2$ $ ./a
uid=99(nobody) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* `ruid` рдФрд░ `euid` рдХреНрд░рдорд╢рдГ 99 (рдиреЛрдмрдбреА) рдФрд░ 1000 (рдлреНрд░реИрдВрдХ) рдХреЗ рд░реВрдк рдореЗрдВ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВред
* `setuid` рджреЛрдиреЛрдВ рдХреЛ 1000 рдкрд░ рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рддрд╛ рд╣реИред
* `system` `/bin/bash -c id` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ sh рд╕реЗ bash рдХреЗ рд▓рд┐рдП рд╕рд┐рдорд▓рд┐рдВрдХ рд╣реЛрддрд╛ рд╣реИред
* `bash`, `-p` рдХреЗ рдмрд┐рдирд╛, `euid` рдХреЛ `ruid` рдХреЗ рдЕрдиреБрд░реВрдк рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рджреЛрдиреЛрдВ 99 (рдиреЛрдмрдбреА) рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред

#### рдорд╛рдорд▓рд╛ 2: setreuid рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП system рдХреЗ рд╕рд╛рде

**C рдХреЛрдб**:
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setreuid(1000, 1000);
system("id");
return 0;
}
```
**рд╕рдВрдХрд▓рди рдФрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдБ:**
```bash
oxdf@hacky$ gcc b.c -o /mnt/nfsshare/b; chmod 4755 /mnt/nfsshare/b
```
**рдирд┐рд╖реНрдкрд╛рджрди рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./b
uid=1000(frank) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* `setreuid` ruid рдФрд░ euid рджреЛрдиреЛрдВ рдХреЛ 1000 рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред
* `system` bash рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЙрдирдХреА рд╕рдорд╛рдирддрд╛ рдХреЗ рдХрд╛рд░рдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЛ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ, рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ frank рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред

#### рдорд╛рдорд▓рд╛ 3: execve рдХреЗ рд╕рд╛рде setuid рдХрд╛ рдЙрдкрдпреЛрдЧ
рдЙрджреНрджреЗрд╢реНрдп: setuid рдФрд░ execve рдХреЗ рдмреАрдЪ рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ред
```bash
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
execve("/usr/bin/id", NULL, NULL);
return 0;
}
```
**рдирд┐рд╖реНрдкрд╛рджрди рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./c
uid=99(nobody) gid=99(nobody) euid=1000(frank) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* `ruid` 99 рдмрдирд╛ рд░рд╣рддрд╛ рд╣реИ, рдкрд░рдиреНрддреБ euid 1000 рдкрд░ рд╕реЗрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, setuid рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЗ рдЕрдиреБрд╕рд╛рд░ред

**C рдХреЛрдб рдЙрджрд╛рд╣рд░рдг 2 (Bash рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛):**
```bash
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
setuid(1000);
execve("/bin/bash", NULL, NULL);
return 0;
}
```
**рдирд┐рд╖реНрдкрд╛рджрди рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./d
bash-4.2$ $ id
uid=99(nobody) gid=99(nobody) groups=99(nobody) context=system_u:system_r:unconfined_service_t:s0
```
**рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

* рд╣рд╛рд▓рд╛рдВрдХрд┐ `setuid` рджреНрд╡рд╛рд░рд╛ `euid` рдХреЛ 1000 рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, `-p` рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдХрд╛рд░рдг `bash` `euid` рдХреЛ `ruid` (99) рдкрд░ рд░реАрд╕реЗрдЯ рдХрд░ рджреЗрддрд╛ рд╣реИред

**C рдХреЛрдб рдЙрджрд╛рд╣рд░рдг 3 (bash -p рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП):**
```bash
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>

int main(void) {
char *const paramList[10] = {"/bin/bash", "-p", NULL};
setuid(1000);
execve(paramList[0], paramList, NULL);
return 0;
}
```
**рдирд┐рд╖реНрдкрд╛рджрди рдФрд░ рдкрд░рд┐рдгрд╛рдо:**
```bash
bash-4.2$ $ ./e
bash-4.2$ $ id
uid=99(nobody) gid=99(nobody) euid=100
```
# рд╕рдВрджрд░реНрдн
* [https://0xdf.gitlab.io/2022/05/31/setuid-rabbithole.html#testing-on-jail](https://0xdf.gitlab.io/2022/05/31/setuid-rabbithole.html#testing-on-jail)


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рддрдХ рдкрд╣реБрдБрдЪ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **[**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [hacktricks repo](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ**.

</details>
