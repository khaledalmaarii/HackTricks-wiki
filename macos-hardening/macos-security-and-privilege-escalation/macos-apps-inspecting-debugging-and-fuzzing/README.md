# macOS Apps - рдирд┐рд░реАрдХреНрд╖рдг, рдбреАрдмрдЧрд┐рдВрдЧ рдФрд░ рдлрдЬрд┐рдВрдЧ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## рд╕реНрдереИрддрд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

### otool
```bash
otool -L /bin/ls #List dynamically linked libraries
otool -tv /bin/ps #Decompile application
```
### objdump

{% code overflow="wrap" %}
```bash
objdump -m --dylibs-used /bin/ls #List dynamically linked libraries
objdump -m -h /bin/ls # Get headers information
objdump -m --syms /bin/ls # Check if the symbol table exists to get function names
objdump -m --full-contents /bin/ls # Dump every section
objdump -d /bin/ls # Dissasemble the binary
objdump --disassemble-symbols=_hello --x86-asm-syntax=intel toolsdemo #Disassemble a function using intel flavour
```
{% endcode %}

### jtool2

рдпрд╣ рдЯреВрд▓ **codesign**, **otool**, рдФрд░ **objdump** рдХреЗ рд▓рд┐рдП рдПрдХ **рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди** рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдХреБрдЫ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред [**рдпрд╣рд╛рдБ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**](http://www.newosxbook.com/tools/jtool.html) рдпрд╛ `brew` рдХреЗ рд╕рд╛рде рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВред
```bash
# Install
brew install --cask jtool2

jtool2 -l /bin/ls # Get commands (headers)
jtool2 -L /bin/ls # Get libraries
jtool2 -S /bin/ls # Get symbol info
jtool2 -d /bin/ls # Dump binary
jtool2 -D /bin/ls # Decompile binary

# Get signature information
ARCH=x86_64 jtool2 --sig /System/Applications/Automator.app/Contents/MacOS/Automator

# Get MIG information
jtool2 -d __DATA.__const myipc_server | grep MIG
```
### Codesign / ldid

{% hint style="danger" %}
**`Codesign`** рдореИрдХрдУрдПрд╕ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдмрдХрд┐ **`ldid`** рдЖрдИрдУрдПрд╕ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}
```bash
# Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

# Check if the appтАЩs contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s <cert-name-keychain> toolsdemo

# Get signature info
ldid -h <binary>

# Get entitlements
ldid -e <binary>

# Change entilements
## /tmp/entl.xml is a XML file with the new entitlements to add
ldid -S/tmp/entl.xml <binary>
```
### SuspiciousPackage

[**SuspiciousPackage**](https://mothersruin.com/software/SuspiciousPackage/get.html) рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ **.pkg** рдлрд╝рд╛рдЗрд▓реЗрдВ (рдЗрдВрд╕реНрдЯреЙрд▓рд░) рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ рдФрд░ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рджреЗрдЦрдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред\
рдЗрди рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдореЗрдВ `preinstall` рдФрд░ `postinstall` рдмреИрд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдореИрд▓рд╡реЗрдпрд░ рд▓реЗрдЦрдХ рд╕рд╛рдорд╛рдиреНрдпрдд: рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ **рдореИрд▓рд╡реЗрдпрд░** **рдХреЛ** **рдЯрд┐рдХрд╛рдК** **рдмрдирд╛** **рд╕рдХреЗрдВ**ред

### hdiutil

рдпрд╣ рдЙрдкрдХрд░рдг Apple рдбрд┐рд╕реНрдХ рдЫрд╡рд┐рдпреЛрдВ (**.dmg**) рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ **рдорд╛рдЙрдВрдЯ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрдиреНрд╣реЗрдВ рдХреБрдЫ рдЪрд▓рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЬрд╛рдВрдЪ рд╕рдХреЗрдВ:
```bash
hdiutil attach ~/Downloads/Firefox\ 58.0.2.dmg
```
рдпрд╣ `/Volumes` рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

### Objective-C

#### рдореЗрдЯрд╛рдбреЗрдЯрд╛

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ Objective-C рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП рдХрд╛рд░реНрдпрдХреНрд░рдо [Mach-O binaries](../macos-files-folders-and-binaries/universal-binaries-and-mach-o-format.md) рдореЗрдВ рдХреЙрдореНрдкрд╛рдЗрд▓ рд╣реЛрдиреЗ рдкрд░ рдЕрдкрдиреА рдХреНрд▓рд╛рд╕ рдШреЛрд╖рдгрд╛рдПрдВ рдмрдирд╛рдП рд░рдЦрддреЗ рд╣реИрдВред рдРрд╕реА рдХреНрд▓рд╛рд╕ рдШреЛрд╖рдгрд╛рдПрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдирд╛рдо рдФрд░ рдкреНрд░рдХрд╛рд░ рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИ:
{% endhint %}

* рдХрдХреНрд╖рд╛
* рдХрдХреНрд╖рд╛ рдХреЗ рд╡рд┐рдзрд┐рдпрд╛рдБ
* рдХрдХреНрд╖рд╛ рдХреЗ рдЙрджрд╛рд╣рд░рдг рд╕рдВрджрд░реНрдн

рдЖрдк [**class-dump**](https://github.com/nygard/class-dump) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
class-dump Kindle.app
```
#### рдХрд╛рд░реНрдп рдХреЛ рдмреБрд▓рд╛рдирд╛

рдЬрдм рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдПрдХ Objective-C рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдмрд╛рдЗрдирд░реА рдореЗрдВ рд╣реИ, рддреЛ рдХреЙрдореНрдкрд╛рдЗрд▓ рдХреЛрдб рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмреБрд▓рд╛рдиреЗ рдХреА рдмрдЬрд╛рдп, **`objc_msgSend`** рдХреЛ рдмреБрд▓рд╛рдПрдЧрд╛ред рдЬреЛ рдЕрдВрддрд┐рдо рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмреБрд▓рд╛рдПрдЧрд╛:

![](<../../../.gitbook/assets/image (560).png>)

рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреА рдЙрдореНрдореАрдж рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВ:

- рдкрд╣рд▓рд╛ рдкреИрд░рд╛рдореАрдЯрд░ (**self**) "рдПрдХ рдкреЙрдЗрдВрдЯрд░ рд╣реИ рдЬреЛ **рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╡рд╛рд▓реА рдХрдХреНрд╖рд╛ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд░рддрд╛ рд╣реИ**"ред рдпрд╛ рдФрд░ рд╕рд░рд▓ рд╢рдмреНрджреЛрдВ рдореЗрдВ рдХрд╣реЗрдВ, рдпрд╣ рд╡рд╕реНрддреБ рд╣реИ рдЬрд┐рд╕ рдкрд░ рд╡рд┐рдзрд┐ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред рдпрджрд┐ рд╡рд┐рдзрд┐ рдПрдХ рдХрдХреНрд╖рд╛ рд╡рд┐рдзрд┐ рд╣реИ, рддреЛ рдпрд╣ рдХрдХреНрд╖рд╛ рд╡рд╕реНрддреБ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реЛрдЧрд╛ (рд╕рдореНрдкреВрд░реНрдг рд░реВрдк рд╕реЗ), рдЬрдмрдХрд┐ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП, self рдХрдХреНрд╖рд╛ рдХреЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЛ рдПрдХ рд╡рд╕реНрддреБ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдХреЗрдд рдХрд░реЗрдЧрд╛ред
- рджреВрд╕рд░рд╛ рдкреИрд░рд╛рдореАрдЯрд░, (**op**), "рд╕рдВрджреЗрд╢ рдХрд╛ рд╕рдВрднрд╛рд▓рдиреЗ рд╡рд╛рд▓реА рд╡рд┐рдзрд┐ рдХрд╛ рдЪрдпрдирдХрд░реНрддрд╛" рд╣реИред рдлрд┐рд░ рднреА, рдФрд░ рд╕рд░рд▓ рд╢рдмреНрджреЛрдВ рдореЗрдВ рдХрд╣реЗрдВ, рдпрд╣ рдмрд╕ **рд╡рд┐рдзрд┐ рдХрд╛ рдирд╛рдо** рд╣реИред
- рд╢реЗрд╖ рдкреИрд░рд╛рдореАрдЯрд░ рд╡рд╣ рдХреЛрдИ **рдорд╛рди рд╣реИрдВ рдЬреЛ рд╡рд┐рдзрд┐ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ** (op)ред

рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **`lldb` рдореЗрдВ ARM64** рдХреЗ рд╕рд╛рде рдЖрд╕рд╛рдиреА рд╕реЗ рдХреИрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рджреЗрдЦреЗрдВ:

{% content-ref url="arm64-basic-assembly.md" %}
[arm64-basic-assembly.md](arm64-basic-assembly.md)
{% endcontent-ref %}

x64:

| **рд╡рд┐рдзрд┐**          | **рд░рдЬрд┐рд╕реНрдЯрд░**                                                    | **(рдХреЗ рд▓рд┐рдП) objc\_msgSend**                                |
| ----------------- | --------------------------------------------------------------- | ------------------------------------------------------ |
| **1рд╡рд╛рдВ рдкреИрд░рд╛рдореАрдЯрд░**  | **rdi**                                                         | **self: рд╡рд╕реНрддреБ рдЬрд┐рд╕ рдкрд░ рд╡рд┐рдзрд┐ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ** |
| **2рд╡рд╛рдВ рдкреИрд░рд╛рдореАрдЯрд░**  | **rsi**                                                         | **op: рд╡рд┐рдзрд┐ рдХрд╛ рдирд╛рдо**                             |
| **3рд╡рд╛рдВ рдкреИрд░рд╛рдореАрдЯрд░**  | **rdx**                                                         | **рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП 1рд╡рд╛рдВ рдкреИрд░рд╛рдореАрдЯрд░**                         |
| **4рд╡рд╛рдВ рдкреИрд░рд╛рдореАрдЯрд░**  | **rcx**                                                         | **рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП 2рд╡рд╛рдВ рдкреИрд░рд╛рдореАрдЯрд░**                         |
| **5рд╡рд╛рдВ рдкреИрд░рд╛рдореАрдЯрд░**  | **r8**                                                          | **рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП 3рд╡рд╛рдВ рдкреИрд░рд╛рдореАрдЯрд░**                         |
| **6рд╡рд╛рдВ рдкреИрд░рд╛рдореАрдЯрд░**  | **r9**                                                          | **рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП 4рд╡рд╛рдВ рдкреИрд░рд╛рдореАрдЯрд░**                         |
| **7рд╡рд╛рдВ+ рдкреИрд░рд╛рдореАрдЯрд░** | <p><strong>rsp+</strong><br><strong>(рд╕реНрдЯреИрдХ рдкрд░)</strong></p> | **рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП 5рд╡рд╛рдВ+ рдкреИрд░рд╛рдореАрдЯрд░**                        |

### рд╕реНрд╡рд┐рдлреНрдЯ

рд╕реНрд╡рд┐рдлреНрдЯ рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рд╛рде, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣рд╛рдБ Objective-C рд╕рдВрдЧрддрддрд╛ рд╣реИ, рдХрднреА-рдХрднреА рдЖрдк [class-dump](https://github.com/nygard/class-dump/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдШреЛрд╖рдгрд╛рдПрдБ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рд╣рдореЗрд╢рд╛ рдирд╣реАрдВред

**`jtool -l`** рдпрд╛ **`otool -l`** рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдХреЗ рд╕рд╛рде рдХрдИ рдЦрдВрдб рдЦреЛрдЬрдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬреЛ **`__swift5`** рдЙрдкрд╕рд░реНрдЧ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВ:
```bash
jtool2 -l /Applications/Stocks.app/Contents/MacOS/Stocks
LC 00: LC_SEGMENT_64              Mem: 0x000000000-0x100000000    __PAGEZERO
LC 01: LC_SEGMENT_64              Mem: 0x100000000-0x100028000    __TEXT
[...]
Mem: 0x100026630-0x100026d54        __TEXT.__swift5_typeref
Mem: 0x100026d60-0x100027061        __TEXT.__swift5_reflstr
Mem: 0x100027064-0x1000274cc        __TEXT.__swift5_fieldmd
Mem: 0x1000274cc-0x100027608        __TEXT.__swift5_capture
[...]
```
рдЖрдк рдЗрд╕ [**рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдореЗрдВ рдЗрди рд╕реЗрдХреНрд╢рди рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ**](https://knight.sc/reverse%20engineering/2019/07/17/swift-metadata.html)ред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **рд╕реНрд╡рд┐рдлреНрдЯ рдмрд╛рдЗрдирд░реА рдореЗрдВ рдкреНрд░рддреАрдХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рдкреНрд░рддреАрдХ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рдЙрдирдХреЗ рдХрд╛рд░реНрдп рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ)ред **рдкреНрд░рддреАрдХреЛрдВ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдпрдд: рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдирд╛рдо рдФрд░ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдФрд░ рдпрд╣ рдПрдХ рдмреЗрд╣рдж рдЕрджреНрднреБрдд рддрд░реАрдХреЗ рд╕реЗ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡реЗ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рд╡рд╣рд╛рдБ "**рдбреАрдореИрдВрдЧрд▓рд░реНрд╕"** рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдореВрд▓ рдирд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Ghidra plugin
https://github.com/ghidraninja/ghidra_scripts/blob/master/swift_demangler.py

# Swift cli
swift demangle
```
### рдкреИрдХ рдХрд┐рдП рдЧрдП рдмрд╛рдЗрдирд░реА

* рдЙрдЪреНрдЪ рдПрдВрдЯреНрд░реЛрдкреА рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ
* рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ (рдХреНрдпрд╛ рдХреЛрдИ рд╕рдордЭрдиреЗ рдпреЛрдЧреНрдп рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реИ, рдкреИрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)
* MacOS рдХреЗ рд▓рд┐рдП UPX рдкреИрдХрд░ рдПрдХ рдзрд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ "\_\_XHDR" рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ

## рдЧрддрд┐рд╢реАрд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдмрд╛рдЗрдирд░реА рдХреЛ рдбреАрдмрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **SIP рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ** (`csrutil disable` рдпрд╛ `csrutil enable --without debug`) рдпрд╛ рдмрд╛рдЗрдирд░реА рдХреЛ рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдХреЙрдкреА рдХрд░рдирд╛ рдФрд░ `codesign --remove-signature <binary-path>` рдХреЗ рд╕рд╛рде **рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдХреЛ рд╣рдЯрд╛рдирд╛** рдпрд╛ рдмрд╛рдЗрдирд░реА рдХрд╛ рдбреАрдмрдЧрд┐рдВрдЧ рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ (рдЖрдк [рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ](https://gist.github.com/carlospolop/a66b8d72bb8f43913c4b5ae45672578b) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)
{% endhint %}

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рд╕рд┐рд╕реНрдЯрдо рдмрд╛рдЗрдирд░реА** (рдЬреИрд╕реЗ `cloudconfigurationd`) рдХреЛ **рдЗрдВрд╕реНрдЯреНрд░реБрдореЗрдВрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП macOS рдкрд░, **SIP рдХреЛ рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП** (рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдХреЛ рдмрд╕ рд╣рдЯрд╛рдирд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛)ред
{% endhint %}

### рдПрдХреАрдХреГрдд рд▓реЙрдЧ

MacOS рдмрд╣реБрдд рд╕рд╛рд░реЗ рд▓реЙрдЧ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЪрд▓рд╛рдиреЗ рдкрд░ **рдЙрд╕рдХреЗ рдХрд╛рд░реНрдп** рдХреЛ рд╕рдордЭрдиреЗ рдореЗрдВ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдХреБрдЫ рд▓реЙрдЧ рд╣реЛрдВрдЧреЗ рдЬрд┐рдирдореЗрдВ `<private>` рдЯреИрдЧ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдХреБрдЫ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдпрд╛ **рдХрдВрдкреНрдпреВрдЯрд░ рд╕рдВрджрд░реНрднреАрдп** **рдкрд╣рдЪрд╛рдирдиреАрдп** рдЬрд╛рдирдХрд╛рд░реА **рдЫреБрдкрд╛рдИ** рдЬрд╛ рд╕рдХреЗред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП **рдПрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ**ред [**рдпрд╣рд╛рдВ**](https://superuser.com/questions/1532031/how-to-show-private-data-in-macos-unified-log) рд╕реЗ рд╡рд┐рд╡рд░рдгреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред

### рд╣реЙрдкрд░

#### рдмрд╛рдПрдВ рдкреИрдирд▓

рд╣реЙрдкрд░ рдХреЗ рдмрд╛рдПрдВ рдкреИрдирд▓ рдореЗрдВ рдмрд╛рдЗрдирд░реА рдХреЗ рдкреНрд░рддреАрдХ (**рд▓реЗрдмрд▓**), рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдФрд░ рдХрд╛рд░реНрдп (**рдкреНрд░реЛрд╕реЗрдбреНрдпреВрд░реНрд╕**) рдХреА рд╕реВрдЪреА рдФрд░ рд╕реНрдЯреНрд░рд┐рдВрдЧ (**рд╕реНрдЯреНрд░**) рджреЗрдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИред рдпреЗ рд╕рднреА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдирд╣реАрдВ рд╣реИрдВ рд▓реЗрдХрд┐рди рд╡реЗ рдореИрдХ-рдУ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдХрдИ рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реИрдВ (рдЬреИрд╕реЗ _cstring рдпрд╛_ `objc_methname` рдХреА рддрд░рд╣)ред

#### рдордзреНрдп рдкреИрдирд▓

рдордзреНрдп рдкреИрдирд▓ рдореЗрдВ рдЖрдк **рдбрд┐рд╕рдПрдВрдмрд▓ рдХреЛрдб** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред рдФрд░ рдЖрдк рдЗрд╕реЗ **рд░реЙ** рдбрд┐рд╕рдПрдВрдмрд▓, **рдЧреНрд░рд╛рдл**, **рдбреАрдХрдВрдкрд╛рдЗрд▓реНрдб** рдФрд░ **рдмрд╛рдЗрдирд░реА** рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд╕рдВрдмрдВрдзрд┐рдд рдЖрдЗрдХрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

<figure><img src="../../../.gitbook/assets/image (2) (6).png" alt=""><figcaption></figcaption></figure>

рдХрд┐рд╕реА рдХреЛрдб рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рд░рд╛рдЗрдЯ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ рдЖрдк **рдЙрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реЗ/рдХреЗ рд▓рд┐рдП рд╕рдВрджрд░реНрдн** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЙрд╕рдХрд╛ рдирд╛рдо рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ (рдпрд╣ рдбрд┐рдХрдВрдкрд╛рдЗрд▓реНрдб рдкреНрдпреВрдбреЛрдХреЛрдб рдореЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛):

<figure><img src="../../../.gitbook/assets/image (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **рдиреАрдЪреЗ рдордзреНрдп рдореЗрдВ рдЖрдк рдкрд╛рдпрдерди рдХрдорд╛рдВрдб рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ**ред

#### рджрд╛рдПрдВ рдкреИрдирд▓

рджрд╛рдПрдВ рдкреИрдирд▓ рдореЗрдВ рдЖрдк **рдиреЗрд╡рд┐рдЧреЗрд╢рди рд╣рд┐рд╕реНрдЯреНрд░реА** (рддрд╛рдХрд┐ рдЖрдк рдЬрд╛рдиреЗрдВ рдХрд┐ рдЖрдк рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рддрдХ рдХреИрд╕реЗ рдкрд╣реБрдВрдЪреЗ), **рдХреЙрд▓ рдЧреНрд░рд╛рдл** рдЬрд╣рд╛рдВ рдЖрдк рд╕рднреА **рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЗрд╕ рдХрд╛рд░реНрдп рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ** рдФрд░ рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ **рдпрд╣ рдХрд╛рд░реНрдп рдХрд┐рд╕реЗ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ**, рдФрд░ **рд╕реНрдерд╛рдиреАрдп рдЪрд░** рдЬрд╛рдирдХрд╛рд░реА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

### dtrace

рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдПрдХ рдЕрддреНрдпрдзрд┐рдХ **рдирд┐рдЪрд▓реЗ рд╕реНрддрд░** рдкрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдФрд░ рдЙрдирдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдлреНрд▓реЛ рдХреЛ рдмрджрд▓рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред Dtrace **рдкреНрд░реЛрдмреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ **рдХрд░реНрдиреЗрд▓ рдХреЗ рднреАрддрд░ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд░рдЦреЗ рдЧрдП рд╣реЛрддреЗ рд╣реИрдВ** рдФрд░ рдРрд╕реЗ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╣реЛрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЗ рдЖрд░рдВрдн рдФрд░ рд╕рдорд╛рдкрдиред

DTrace рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рддреНрдпреЗрдХ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЗ рдкреНрд░рд╡реЗрд╢ рдФрд░ рдирд┐рдХрд╛рд╕ рд╕реНрдерд╛рди рдореЗрдВ рдкреНрд░реЛрдм рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП **`dtrace_probe_create`** рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдпреЗ рдкреНрд░реЛрдмреНрд╕ рдкреНрд░рддреНрдпреЗрдХ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЗ рдкреНрд░рд╡реЗрд╢ рдФрд░ рдирд┐рдХрд╛рд╕ рд╕реНрдерд╛рди рдореЗрдВ рдлрд╛рдпрд░ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред DTrace рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд /dev/dtrace рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрддреА рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рд╣реА рдЙрдкрд▓рдмреНрдз рд╣реИред

{% hint style="success" %}
SIP рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдХреНрд╖рдо рдХрд┐рдП рдмрд┐рдирд╛ Dtrace рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рд░рд┐рдХрд╡рд░реА рдореЛрдб рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `csrutil enable --without dtrace`

рдЖрдк рдЙрди рдмрд╛рдЗрдирд░реА рдХреЛ рднреА **`dtrace`** рдпрд╛ **`dtruss`** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рдЖрдкрдиреЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд┐рдпрд╛ рд╣реИ**ред
{% endhint %}

dtrace рдХреЗ рдЙрдкрд▓рдмреНрдз рдкреНрд░реЛрдмреНрд╕ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣ред
```bash
dtrace -l | head
ID   PROVIDER            MODULE                          FUNCTION NAME
1     dtrace                                                     BEGIN
2     dtrace                                                     END
3     dtrace                                                     ERROR
43    profile                                                     profile-97
44    profile                                                     profile-199
```
рдкреНрд░реЛрдм рдирд╛рдо рдЪрд╛рд░ рднрд╛рдЧреЛрдВ рд╕реЗ рдорд┐рд▓рдХрд░ рдмрдирддрд╛ рд╣реИ: рдкреНрд░рджрд╛рддрд╛, рдореЙрдбреНрдпреВрд▓, рдХрд╛рд░реНрдп, рдФрд░ рдирд╛рдо (`fbt:mach_kernel:ptrace:entry`). рдпрджрд┐ рдЖрдк рдирд╛рдо рдХреЗ рдХрд┐рд╕реА рднрд╛рдЧ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ Dtrace рдЙрд╕ рднрд╛рдЧ рдХреЛ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░реЗрдЧрд╛ред

рдкреНрд░реЛрдмреНрд╕ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдФрд░ рдЬрдм рд╡реЗ рдлрд╛рдпрд░ рд╣реЛрддреЗ рд╣реИрдВ рддреЛ рдХреНрдпрд╛ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░рдиреА рд╣реИ, рдЗрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдбреА рднрд╛рд╖рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

рдПрдХ рдФрд░ рд╡рд┐рд╕реНрддреГрдд рд╡реНрдпрд╛рдЦреНрдпрд╛ рдФрд░ рдЕрдзрд┐рдХ рдЙрджрд╛рд╣рд░рдг [https://illumos.org/books/dtrace/chp-intro.html](https://illumos.org/books/dtrace/chp-intro.html) рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

#### рдЙрджрд╛рд╣рд░рдг

`man -k dtrace` рдЪрд▓рд╛рдХрд░ **рдЙрдкрд▓рдмреНрдз DTrace рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдХреА рд╕реВрдЪреА рджреЗрдЦреЗрдВред рдЙрджрд╛рд╣рд░рдг: `sudo dtruss -n binary`

* рд▓рд╛рдЗрди рдореЗрдВ
```bash
#Count the number of syscalls of each running process
sudo dtrace -n 'syscall:::entry {@[execname] = count()}'
```
* рд╕реНрдХреНрд░рд┐рдкреНрдЯ
```bash
syscall:::entry
/pid == $1/
{
}

#Log every syscall of a PID
sudo dtrace -s script.d 1234
```

```bash
syscall::open:entry
{
printf("%s(%s)", probefunc, copyinstr(arg0));
}
syscall::close:entry
{
printf("%s(%d)\n", probefunc, arg0);
}

#Log files opened and closed by a process
sudo dtrace -s b.d -c "cat /etc/hosts"
```

```bash
syscall:::entry
{
;
}
syscall:::return
{
printf("=%d\n", arg1);
}

#Log sys calls with values
sudo dtrace -s syscalls_info.d -c "cat /etc/hosts"
```
### dtruss
```bash
dtruss -c ls #Get syscalls of ls
dtruss -c -p 1000 #get syscalls of PID 1000
```
### ktrace

рдЖрдк рдЗрд╕реЗ **SIP рд╕рдХреНрд░рд┐рдп** рд╣реЛрдиреЗ рдкрд░ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
```bash
ktrace trace -s -S -t c -c ls | grep "ls("
```
### ProcessMonitor

[**ProcessMonitor**](https://objective-see.com/products/utilities.html#ProcessMonitor) рдПрдХ рдмрд╣реБрдд рд╣реА рдЙрдкрдпреЛрдЧреА рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ рдХрд┐ рдХреЛрдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░ рд░рд╣реА рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рджреЗрдЦреЗрдВ рдХрд┐ рдХреЛрдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреМрди рд╕реЗ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдмрдирд╛ рд░рд╣реА рд╣реИ)ред

### SpriteTree

[**SpriteTree**](https://themittenmac.com/tools/) рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░рддрд╛ рд╣реИред\
рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдореИрдХ рдХреЛ рдПрдХ рдРрд╕реЗ рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдореЙрдирд┐рдЯрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ **`sudo eslogger fork exec rename create > cap.json`** (рдЗрд╕реЗ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯрд░реНрдорд┐рдирд▓ рдореЗрдВ FDA рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ)ред рдФрд░ рдлрд┐рд░ рдЖрдк рдЗрд╕ рдЙрдкрдХрд░рдг рдореЗрдВ JSON рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рд╕рднреА рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рджреЗрдЦ рд╕рдХреЗрдВ:

<figure><img src="../../../.gitbook/assets/image (710).png" alt="" width="375"><figcaption></figcaption></figure>

### FileMonitor

[**FileMonitor**](https://objective-see.com/products/utilities.html#FileMonitor) рдлрд╛рдЗрд▓ рдШрдЯрдирд╛рдУрдВ (рдЬреИрд╕реЗ рдирд┐рд░реНрдорд╛рдг, рд╕рдВрд╢реЛрдзрди рдФрд░ рд╣рдЯрд╛рдиреЗ) рдХрд╛ рдореЙрдирд┐рдЯрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдЗрди рдШрдЯрдирд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

### Crescendo

[**Crescendo**](https://github.com/SuprHackerSteve/Crescendo) рдПрдХ GUI рдЙрдкрдХрд░рдг рд╣реИ рдЬрд┐рд╕рдХрд╛ рд▓реБрдХ рдФрд░ рдлрд╝реАрд▓ Windows рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд╛рди рд╕рдХрддреЗ рд╣реИрдВ Microsoft SysinternalтАЩs _Procmon_ рд╕реЗред рдпрд╣ рдЙрдкрдХрд░рдг рд╡рд┐рднрд┐рдиреНрди рдШрдЯрдирд╛ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рд╢реБрд░реВ рдФрд░ рдмрдВрдж рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЗрди рдШрдЯрдирд╛рдУрдВ рдХреЛ рдлрд╝рд╛рдЗрд▓, рдкреНрд░рдХреНрд░рд┐рдпрд╛, рдиреЗрдЯрд╡рд░реНрдХ рдЖрджрд┐ рдЬреИрд╕реЗ рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдЬреЛ рдШрдЯрдирд╛рдПрдБ рдЬреЛрдбрд╝реА рдЧрдИ рд╣реИрдВ рдЙрдиреНрд╣реЗрдВ рдПрдХ JSON рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╕рд╣реЗрдЬрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

### Apple Instruments

[**Apple Instruments**](https://developer.apple.com/library/archive/documentation/Performance/Conceptual/CellularBestPractices/Appendix/Appendix.html) Xcode рдХреЗ рдбреЗрд╡рд▓рдкрд░ рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВ - рдЬреЛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдореЙрдирд┐рдЯрд░ рдХрд░рдиреЗ, рдореЗрдореЛрд░реА рд▓реАрдХреНрд╕ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдФрд░ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

![](<../../../.gitbook/assets/image (15).png>) 

### fs\_usage

рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
```bash
fs_usage -w -f filesys ls #This tracks filesystem actions of proccess names containing ls
fs_usage -w -f network curl #This tracks network actions
```
### TaskExplorer

[**Taskexplorer**](https://objective-see.com/products/taskexplorer.html) рдХрд┐рд╕реА рдмрд╛рдЗрдирд░реА рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА **рд▓рд╛рдЗрдмреНрд░реЗрд░реА**, рдЙрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд░рд╣реА **рдлрд╝рд╛рдЗрд▓реЗрдВ** рдФрд░ **рдиреЗрдЯрд╡рд░реНрдХ** рдХрдиреЗрдХреНрд╢рди рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИред\
рдпрд╣ рдмрд╛рдЗрдирд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ **virustotal** рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдФрд░ рдмрд╛рдЗрдирд░реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рджрд┐рдЦрд╛рддрд╛ рд╣реИред

## PT\_DENY\_ATTACH <a href="#page-title" id="page-title"></a>

[**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://knight.sc/debugging/2019/06/03/debugging-apple-binaries-that-use-pt-deny-attach.html) рдореЗрдВ рдЖрдкрдХреЛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдорд┐рд▓реЗрдЧрд╛ рдХрд┐ рдХреИрд╕реЗ **`PT_DENY_ATTACH`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪрд▓ рд░рд╣реЗ рдбреЗрдорди рдХреЛ рдбреАрдмрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдиреЗ рдбреАрдмрдЧрд┐рдВрдЧ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП SIP рднреА рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдерд╛ред

### lldb

**lldb** **macOS** рдмрд╛рдЗрдирд░реА **рдбреАрдмрдЧрд┐рдВрдЧ** рдХреЗ рд▓рд┐рдП рдбреА рдлреИрдХреНрдЯреЛ рдЯреВрд▓ рд╣реИред
```bash
lldb ./malware.bin
lldb -p 1122
lldb -n malware.bin
lldb -n malware.bin --waitfor
```
рдЬрдм рдЖрдк lldb рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реЛ рддреЛ рдЖрдк рдЗрдВрдЯреЗрд▓ рдлреНрд▓реЗрд╡рд░ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЕрдкрдиреЗ рд╣реЛрдо рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд╛рдЗрди рдХреЗ рд╕рд╛рде рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдХрд░ **`.lldbinit`** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ:
```bash
settings set target.x86-disassembly-flavor intel
```
{% hint style="warning" %}
рд▓реНрд▓рдбрдм рдореЗрдВ, `process save-core` рдХреЗ рд╕рд╛рде рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдбрдВрдк рдХрд░реЗрдВред
{% endhint %}

<table data-header-hidden><thead><tr><th width="225"></th><th></th></tr></thead><tbody><tr><td><strong>(lldb) рдХрдорд╛рдВрдб</strong></td><td><strong>рд╡рд┐рд╡рд░рдг</strong></td></tr><tr><td><strong>run (r)</strong></td><td>рдПрдХреНрд╕рд┐рдХреНрдпреВрд╢рди рд╢реБрд░реВ рдХрд░реЗрдВ, рдЬреЛ рдПрдХ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рд╣рд┐рдЯ рд╣реЛрдиреЗ рдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рддрдХ рдЬрд╛рд░реА рд░рд╣реЗрдЧрд╛ред</td></tr><tr><td><strong>continue (c)</strong></td><td>рдбреАрдмрдЧ рдХреА рдЧрдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдПрдХреНрд╕рд┐рдХреНрдпреВрд╢рди рдЬрд╛рд░реА рд░рдЦреЗрдВред</td></tr><tr><td><strong>nexti (n / ni)</strong></td><td>рдЕрдЧрд▓реЗ рдЗрдВрд╕реНрдЯреНрд░рдХреНрд╢рди рдХреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд░реЗрдВред рдпрд╣ рдХрдорд╛рдВрдб рдлрдВрдХреНрд╢рди рдХреЙрд▓ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдЧрд╛ред</td></tr><tr><td><strong>stepi (s / si)</strong></td><td>рдЕрдЧрд▓реЗ рдЗрдВрд╕реНрдЯреНрд░рдХреНрд╢рди рдХреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд░реЗрдВред nexti рдХрдорд╛рдВрдб рдХреА рддрд░рд╣, рдпрд╣ рдХрдорд╛рдВрдб рдлрдВрдХреНрд╢рди рдХреЙрд▓ рдореЗрдВ рд╕реНрдЯреЗрдк рдХрд░реЗрдЧрд╛ред</td></tr><tr><td><strong>finish (f)</strong></td><td>рд╡рд░реНрддрдорд╛рди рдлрдВрдХреНрд╢рди ("рдлреНрд░реЗрдо") рдореЗрдВ рд╢реЗрд╖ рдЗрдВрд╕реНрдЯреНрд░рдХреНрд╢рди рдХреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд░реЗрдВ рдФрд░ рд░реЛрдХреЗрдВред</td></tr><tr><td><strong>control + c</strong></td><td>рдПрдХреНрд╕реАрдХреНрдпреВрд╢рди рдХреЛ рд░реЛрдХреЗрдВред рдЕрдЧрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЪрд▓рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ (r) рдпрд╛ рдЬрд╛рд░реА рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИ (c), рддреЛ рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдХрд╣реАрдВ рднреА рд░реЛрдХ рджреЗрдЧрд╛ред</td></tr><tr><td><strong>breakpoint (b)</strong></td><td><p>b main #рдХреЛрдИ рдлрдВрдХреНрд╢рди рдЬрд┐рд╕реЗ рдореЗрди рдХрд╣рд╛ рдЧрдпрд╛ рд╣реИ</p><p>b &#x3C;binname>`main #рдмрд┐рди рдХрд╛ рдореБрдЦреНрдп рдлрдВрдХреНрд╢рди</p><p>b set -n main --shlib &#x3C;lib_name> #рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдмрд┐рди рдХрд╛ рдореБрдЦреНрдп рдлрдВрдХреНрд╢рди</p><p>b -[NSDictionary objectForKey:]</p><p>b -a 0x0000000100004bd9</p><p>br l #рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рд╕реВрдЪреА</p><p>br e/dis &#x3C;num> #рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдХреЛ рд╕рдХреНрд╖рдо/рдЕрдХреНрд╖рдо рдХрд░реЗрдВ</p><p>breakpoint delete &#x3C;num></p></td></tr><tr><td><strong>help</strong></td><td><p>help breakpoint #рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдХрдорд╛рдВрдб рдХреА рдорджрдж рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</p><p>help memory write #рдореЗрдореЛрд░реА рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдорджрдж рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</p></td></tr><tr><td><strong>reg</strong></td><td><p>reg read</p><p>reg read $rax</p><p>reg read $rax --format &#x3C;<a href="https://lldb.llvm.org/use/variable.html#type-format">format</a>></p><p>reg write $rip 0x100035cc0</p></td></tr><tr><td><strong>x/s &#x3C;reg/memory address></strong></td><td>рдореЗрдореЛрд░реА рдХреЛ рдПрдХ рдирд▓-рд╕рдорд╛рдкреНрдд рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВред</td></tr><tr><td><strong>x/i &#x3C;reg/memory address></strong></td><td>рдореЗрдореЛрд░реА рдХреЛ рдПрд╕реЗрдореНрдмрд▓реА рдЗрдВрд╕реНрдЯреНрд░рдХреНрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВред</td></tr><tr><td><strong>x/b &#x3C;reg/memory address></strong></td><td>рдореЗрдореЛрд░реА рдХреЛ рдмрд╛рдЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВред</td></tr><tr><td><strong>print object (po)</strong></td><td><p>рдпрд╣ рдкреИрд░рд╛рдореАрдЯрд░ рджреНрд╡рд╛рд░рд╛ рд╕рдВрджрд░реНрднрд┐рдд рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдЧрд╛</p><p>po $raw</p><p><code>{</code></p><p><code>dnsChanger = {</code></p><p><code>"affiliate" = "";</code></p><p><code>"blacklist_dns" = ();</code></p><p>рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЕрдзрд┐рдХрд╛рдВрд╢ Apple рдХреЗ Objective-C API рдпрд╛ рдореЗрдердбреНрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рд╡рд╛рдкрд╕ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕рд▓рд┐рдП "рдкреНрд░рд┐рдВрдЯ рдСрдмреНрдЬреЗрдХреНрдЯ" (po) рдХрдорд╛рдВрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдП рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрджрд┐ po рд╕реЗ рдХреЛрдИ рдЕрд░реНрдердкреВрд░реНрдг рдЖрдЙрдЯрдкреБрдЯ рдирд╣реАрдВ рдирд┐рдХрд╛рд▓рддрд╛ рд╣реИ, рддреЛ <code>x/b</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ</p></td></tr><tr><td><strong>memory</strong></td><td>memory read 0x000....<br>memory read $x0+0xf2a<br>memory write 0x100600000 -s 4 0x41414141 #рдЙрд╕ рдкрддреЗ рдореЗрдВ AAAA рд▓рд┐рдЦреЗрдВ<br>memory write -f s $rip+0x11f+7 "AAAA" #рдЙрд╕ рдкрддреЗ рдореЗрдВ AAAA рд▓рд┐рдЦреЗрдВ</td></tr><tr><td><strong>disassembly</strong></td><td><p>dis #рд╡рд░реНрддрдорд╛рди рдлрдВрдХреНрд╢рди рдХреЛ рдбрд┐рд╕реИрд╕реЗрдВрдмрд▓ рдХрд░реЗрдВ</p><p>dis -n &#x3C;funcname> #рдлрдВрдХреНрд╢рди рдХреЛ рдбрд┐рд╕реИрд╕реЗрдВрдмрд▓ рдХрд░реЗрдВ</p><p>dis -n &#x3C;funcname> -b &#x3C;basename> #рдлрдВрдХреНрд╢рди рдХреЛ рдбрд┐рд╕реИрд╕реЗрдВрдмрд▓ рдХрд░реЗрдВ<br>dis -c 6 #6 рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдбрд┐рд╕реИрд╕реЗрдВрдмрд▓ рдХрд░реЗрдВ<br>dis -c 0x100003764 -e 0x100003768 #рдПрдХ рд╕реЗ рджреВрд╕рд░реЗ рддрдХ<br>dis -p -c 4 #рд╡рд░реНрддрдорд╛рди рдкрддреЗ рд╕реЗ рдбрд┐рд╕реИрд╕реЗрдВрдмрд▓ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ</p></td></tr><tr><td><strong>parray</strong></td><td>parray 3 (char **)$x1 # x1 рд░реЗрдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ 3 рдШрдЯрдХреЛрдВ рдХреЗ рдПрд░реЗ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ</td></tr></tbody></table>

{% hint style="info" %}
**`objc_sendMsg`** рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╕рдордп, **rsi** рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ **рдореЗрдердб рдХрд╛ рдирд╛рдо** рдПрдХ рдирд▓-рд╕рдорд╛рдкреНрдд (тАЬрд╕реАтАЭ) рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред lldb рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд╛рдо рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

`(lldb) x/s $rsi: 0x1000f1576: "startMiningWithPort:password:coreCount:slowMemory:currency:"`

`(lldb) print (char*)$rsi:`\
`(char *) $1 = 0x00000001000f1576 "startMiningWithPort:password:coreCount:slowMemory:currency:"`

`(lldb) reg read $rsi: rsi = 0x00000001000f1576 "startMiningWithPort:password:coreCount:slowMemory:currency:"`
{% endhint %}

### рдПрдВрдЯреА-рдбрд╛рдпрдирд╛рдорд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

#### рд╡реАрдПрдо рдкрддрд╛ рд▓рдЧрд╛рдирд╛

* **`sysctl hw.model`** рдХрдорд╛рдВрдб "Mac" рд▓реМрдЯрд╛рддрд╛ рд╣реИ рдЬрдм **рд╣реЛрд╕реНрдЯ рдПрдХ MacOS** рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреБрдЫ рдЕрд▓рдЧ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдпрд╣ рдПрдХ рд╡реАрдПрдо рд╣реЛрддрд╛ рд╣реИред
* **`hw.logicalcpu`** рдФрд░ **`hw.physicalcpu`** рдХреЗ рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдЦреЗрд▓рдиреЗ рд╕реЗ рдХреБрдЫ рдореИрд▓рд╡реЗрдпрд░ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдПрдХ рд╡реАрдПрдо рд╣реИ рдпрд╛ рдирд╣реАрдВред
* рдХреБрдЫ рдореИрд▓рд╡реЗрдпрд░ рдпрд╣ рднреА **рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдХрд┐ рдорд╢реАрди **VMware** рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ MAC рдкрддреЗ (00:50:56) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ред
* рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА **рдбреАрдмрдЧрд┐рдВрдЧ рд╣реЛ рд░рд╣реА рд╣реИ** рдпрд╛ рдирд╣реАрдВ рдЗрд╕реЗ рдПрдХ рд╕рд░рд▓ рдХреЛрдб рдХреЗ рд╕рд╛рде рдЬреИрд╕реЗ:
* `if(P_TRACED == (info.kp_proc.p_flag & P_TRACED)){ //рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдбреАрдмрдЧ рд╣реЛ рд░рд╣реА рд╣реИ }`
* рдпрд╣ рднреА **`ptrace`** рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ **`PT_DENY_ATTACH`** рдлреНрд▓реИрдЧ рдХреЗ рд╕рд╛рде рдЖрд╡рдВрдЯрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдбреЗрдмрдЧрд░ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдФрд░ рдЯреНрд░реЗрд╕рд┐рдВрдЧ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИред
* рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ **`sysctl`** рдпрд╛ **`ptrace`** рдлрд╝рдВрдХреНрд╢рди **рдЖрдпрд╛рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ (рд▓реЗрдХрд┐рди рдореИрд▓рд╡реЗрдпрд░ рдЗрд╕реЗ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдЖрдпрд╛рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ)
* рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕ рд▓реЗрдЦрди рдореЗрдВ рджрд░реНрд╢рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, тАЬ[рдПрдВрдЯреА-рдбреАрдмрдЧ рддрдХрдиреАрдХреЛрдВ рдХреЛ рдкрд░рд╛рдЬрд┐рдд рдХрд░рдирд╛: macOS ptrace variants](https://alexomara.com/blog/defeating-anti-debug-techniques-macos-ptrace-variants/)тАЭ :\
тАЬ_рд╕рдВрджреЗрд╢ рдкреНрд░рдХреНрд░рд┐рдпрд╛ # рдХреЗ рд╕рд╛рде рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рдЧрдИ рдЬрд┐рд╕рдХреА **рд╕реНрдерд┐рддрд┐ = 45 (0x0000002d)** рд╣реИ рдЖрдо рддреМрд░ рдкрд░ рдПрдХ рд╕рдВрдХреЗрдд рд╣реИ рдХрд┐ рдбреАрдмрдЧ рд▓рдХреНрд╖реНрдп **PT\_DENY\_ATTACH** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ_тАЭ
## Fuzzing

### [ReportCrash](https://ss64.com/osx/reportcrash.html)

ReportCrash **рдХреНрд░реИрд╢ рд╣реЛ рд░рд╣реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯ рдХреЛ рдбрд┐рд╕реНрдХ рдкрд░ рд╕рд╣реЗрдЬрддрд╛ рд╣реИ**ред рдПрдХ рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреЛ **рдПрдХ рдбрд┐рд╡реЗрд▓рдкрд░ рдХреЛ рдХреНрд░реИрд╢ рдХреЗ рдХрд╛рд░рдг рдХрд╛ рдирд┐рджрд╛рди рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреА рд╣реИ**ред\
рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдФрд░ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП **рдкреНрд░рддрд┐-рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдиреНрдЪрдбреА рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓ рд░рд╣реЗ**, ReportCrash рдПрдХ рд▓реЙрдиреНрдЪрдПрдЬреЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ рдФрд░ рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ `~/Library/Logs/DiagnosticReports/` рдореЗрдВ рд╕рд╣реЗрдЬрддрд╛ рд╣реИред\
рдбреЗрдордиреНрд╕, рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ **рд╕рд┐рд╕реНрдЯрдо рд▓реЙрдиреНрдЪрдбреА рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓ рд░рд╣реА рд╣реИрдВ** рдФрд░ рдЕрдиреНрдп рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬреНрдб рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдХреЗ рд▓рд┐рдП, ReportCrash рдПрдХ рд▓реЙрдиреНрдЪрдбреЗрдорди рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ рдФрд░ рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯ рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ `/Library/Logs/DiagnosticReports` рдореЗрдВ рд╕рд╣реЗрдЬрддрд╛ рд╣реИред

рдЕрдЧрд░ рдЖрдк рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯ **рдХреЛ рдПрдкреНрдкрд▓ рдХреЛ рднреЗрдЬрдиреЗ** рдХреА рдЪрд┐рдВрддрд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЖрдк рдЗрдиреНрд╣реЗрдВ рдЕрдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдЧрд░ рдирд╣реАрдВ, рддреЛ рдХреНрд░реИрд╢ рд░рд┐рдкреЛрд░реНрдЯ **рд╕рд░реНрд╡рд░ рдХреНрд░реИрд╢ рдХреИрд╕реЗ рд╣реБрдЖ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ** рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
```bash
#To disable crash reporting:
launchctl unload -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist

#To re-enable crash reporting:
launchctl load -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist
```
### рдиреАрдВрдж

MacOS рдореЗрдВ рдлрдЬрд╝рд┐рдВрдЧ рдХрд░рддреЗ рд╕рдордп, Mac рдХреЛ рд╕реЛрдиреЗ рдирд╣реАрдВ рджреЗрдиреЗ рдХрд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ:

* systemsetup -setsleep Never
* pmset, рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдБ
* [KeepingYouAwake](https://github.com/newmarcel/KeepingYouAwake)

#### SSH рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ

рдпрджрд┐ рдЖрдк SSH рдХрдиреЗрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрдЬрд╝рд┐рдВрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╕рддреНрд░ рджрд┐рди рднрд░ рдирд╣реАрдВ рдЬрд╛ рд░рд╣рд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП sshd\_config рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реЗ рдмрджрд▓реЗрдВ:

* TCPKeepAlive Yes
* ClientAliveInterval 0
* ClientAliveCountMax 0
```bash
sudo launchctl unload /System/Library/LaunchDaemons/ssh.plist
sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist
```
### рдЖрдВрддрд░рд┐рдХ рд╣реИрдВрдбрд▓рд░

**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ** рддрд╛рдХрд┐ рдЖрдк рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХреЗрдВ рдХрд┐ **рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реНрдХреАрдо рдпрд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рд╣реИрдВрдбрд▓рд┐рдВрдЧ рдХреМрди рд╕рд╛ рдРрдк рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИ:**

{% content-ref url="../macos-file-extension-apps.md" %}
[macos-file-extension-apps.md](../macos-file-extension-apps.md)
{% endcontent-ref %}

### рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдЧрдгрдирд╛

рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рдбреЗрдЯрд╛ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░ рд░рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдЦреЛрдЬрдирд╛:
```bash
dtrace -n 'syscall::recv*:entry { printf("-> %s (pid=%d)", execname, pid); }' >> recv.log
#wait some time
sort -u recv.log > procs.txt
cat procs.txt
```
рдпрд╛ `netstat` рдпрд╛ `lsof` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

### Libgmalloc

<figure><img src="../../../.gitbook/assets/Pasted Graphic 14.png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```bash
lldb -o "target create `which some-binary`" -o "settings set target.env-vars DYLD_INSERT_LIBRARIES=/usr/lib/libgmalloc.dylib" -o "run arg1 arg2" -o "bt" -o "reg read" -o "dis -s \$pc-32 -c 24 -m -F intel" -o "quit"
```
{% endcode %}

### рдлрдЬрд╝рд░реНрд╕

#### [AFL++](https://github.com/AFLplusplus/AFLplusplus)

CLI рдЯреВрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ

#### [Litefuzz](https://github.com/sec-tools/litefuzz)

рдпрд╣ macOS GUI рдЯреВрд▓реНрд╕ рдХреЗ рд╕рд╛рде "**рдмрд╕ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ"**ред рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреБрдЫ macOS рдРрдкреНрд╕ рдХреЗ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЬреИрд╕реЗ рдЕрджреНрд╡рд┐рддреАрдп рдлрд╝рд╛рдЗрд▓ рдирд╛рдо, рд╕рд╣реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди, рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ (`~/Library/Containers/com.apple.Safari/Data`)...

рдХреБрдЫ рдЙрджрд╛рд╣рд░рдг:

{% code overflow="wrap" %}
```bash
# iBooks
litefuzz -l -c "/System/Applications/Books.app/Contents/MacOS/Books FUZZ" -i files/epub -o crashes/ibooks -t /Users/test/Library/Containers/com.apple.iBooksX/Data/tmp -x 10 -n 100000 -ez

# -l : Local
# -c : cmdline with FUZZ word (if not stdin is used)
# -i : input directory or file
# -o : Dir to output crashes
# -t : Dir to output runtime fuzzing artifacts
# -x : Tmeout for the run (default is 1)
# -n : Num of fuzzing iterations (default is 1)
# -e : enable second round fuzzing where any crashes found are reused as inputs
# -z : enable malloc debug helpers

# Font Book
litefuzz -l -c "/System/Applications/Font Book.app/Contents/MacOS/Font Book FUZZ" -i input/fonts -o crashes/font-book -x 2 -n 500000 -ez

# smbutil (using pcap capture)
litefuzz -lk -c "smbutil view smb://localhost:4455" -a tcp://localhost:4455 -i input/mac-smb-resp -p -n 100000 -z

# screensharingd (using pcap capture)
litefuzz -s -a tcp://localhost:5900 -i input/screenshared-session --reportcrash screensharingd -p -n 100000
```
{% endcode %}

### рдЕрдзрд┐рдХ Fuzzing MacOS рдЬрд╛рдирдХрд╛рд░реА

* [https://www.youtube.com/watch?v=T5xfL9tEg44](https://www.youtube.com/watch?v=T5xfL9tEg44)
* [https://github.com/bnagy/slides/blob/master/OSXScale.pdf](https://github.com/bnagy/slides/blob/master/OSXScale.pdf)
* [https://github.com/bnagy/francis/tree/master/exploitaben](https://github.com/bnagy/francis/tree/master/exploitaben)
* [https://github.com/ant4g0nist/crashwrangler](https://github.com/ant4g0nist/crashwrangler)

## рд╕рдВрджрд░реНрдн

* [**OS X Incident Response: Scripting and Analysis**](https://www.amazon.com/OS-Incident-Response-Scripting-Analysis-ebook/dp/B01FHOHHVS)
* [**https://www.youtube.com/watch?v=T5xfL9tEg44**](https://www.youtube.com/watch?v=T5xfL9tEg44)
* [**https://taomm.org/vol1/analysis.html**](https://taomm.org/vol1/analysis.html)
* [**The Art of Mac Malware: The Guide to Analyzing Malicious Software**](https://taomm.org/)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
