# macOS Apps - –Ü–Ω—Å–ø–µ–∫—Ü—ñ—è, –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è —Ç–∞ Fuzzing

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) - —Ü–µ **–ø–æ—à—É–∫–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞**, —â–æ –ø—Ä–∞—Ü—é—î –Ω–∞ –æ—Å–Ω–æ–≤—ñ **—Ç–µ–º–Ω–æ–≥–æ –≤–µ–±—É**, —è–∫–∞ –ø—Ä–æ–ø–æ–Ω—É—î **–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ** —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ –±—É–ª–∞ –∫–æ–º–ø–∞–Ω—ñ—è –∞–±–æ —ó—ó –∫–ª—ñ—î–Ω—Ç–∏ **—Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω—ñ** **—à–∫—ñ–¥–ª–∏–≤–∏–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞–º–∏-–∫—Ä–∞–¥—ñ—è–º–∏**.

–û—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞ WhiteIntel - –±–æ—Ä–æ—Ç–∏—Å—è –∑ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è–º–∏ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Ç–∞ –∞—Ç–∞–∫–∞–º–∏ –ø—Ä–æ–≥—Ä–∞–º-–≤–∏–º–∞–≥–∞—á—ñ–≤, —â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –≤–Ω–∞—Å–ª—ñ–¥–æ–∫ —à–∫—ñ–¥–ª–∏–≤–∏—Ö –ø—Ä–æ–≥—Ä–∞–º, —â–æ –∫—Ä–∞–¥—É—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ó—Ö–Ω—ñ–π –≤–µ–±—Å–∞–π—Ç —ñ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ó—Ö–Ω—ñ–π –¥–≤–∏–≥—É–Ω **–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ** –∑–∞ –∞–¥—Ä–µ—Å–æ—é:

{% embed url="https://whiteintel.io" %}

***

## –°—Ç–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑

### otool & objdump & nm
```bash
otool -L /bin/ls #List dynamically linked libraries
otool -tv /bin/ps #Decompile application
```
{% code overflow="wrap" %}
```bash
objdump -m --dylibs-used /bin/ls #List dynamically linked libraries
objdump -m -h /bin/ls # Get headers information
objdump -m --syms /bin/ls # Check if the symbol table exists to get function names
objdump -m --full-contents /bin/ls # Dump every section
objdump -d /bin/ls # Dissasemble the binary
objdump --disassemble-symbols=_hello --x86-asm-syntax=intel toolsdemo #Disassemble a function using intel flavour
```
{% endcode %}
```bash
nm -m ./tccd # List of symbols
```
### jtool2 & Disarm

–í–∏ –º–æ–∂–µ—Ç–µ [**–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ disarm –∑–≤—ñ–¥—Å–∏**](https://newosxbook.com/tools/disarm.html).
```bash
ARCH=arm64e disarm -c -i -I --signature /path/bin # Get bin info and signature
ARCH=arm64e disarm -c -l /path/bin # Get binary sections
ARCH=arm64e disarm -c -L /path/bin # Get binary commands (dependencies included)
ARCH=arm64e disarm -c -S /path/bin # Get symbols (func names, strings...)
ARCH=arm64e disarm -c -d /path/bin # Get disasembled
jtool2 -d __DATA.__const myipc_server | grep MIG # Get MIG info
```
–í–∏ –º–æ–∂–µ—Ç–µ [**–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ jtool2 —Ç—É—Ç**](http://www.newosxbook.com/tools/jtool.html) –∞–±–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –π–æ–≥–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `brew`.
```bash
# Install
brew install --cask jtool2

jtool2 -l /bin/ls # Get commands (headers)
jtool2 -L /bin/ls # Get libraries
jtool2 -S /bin/ls # Get symbol info
jtool2 -d /bin/ls # Dump binary
jtool2 -D /bin/ls # Decompile binary

# Get signature information
ARCH=x86_64 jtool2 --sig /System/Applications/Automator.app/Contents/MacOS/Automator

# Get MIG information
jtool2 -d __DATA.__const myipc_server | grep MIG
```
{% hint style="danger" %}
**jtool –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π –Ω–∞ –∫–æ—Ä–∏—Å—Ç—å disarm**
{% endhint %}

### Codesign / ldid

{% hint style="success" %}
**`Codesign`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ **macOS**, –∞ **`ldid`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ **iOS**
{% endhint %}
```bash
# Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

# Check if the app‚Äôs contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s <cert-name-keychain> toolsdemo

# Get signature info
ldid -h <binary>

# Get entitlements
ldid -e <binary>

# Change entilements
## /tmp/entl.xml is a XML file with the new entitlements to add
ldid -S/tmp/entl.xml <binary>
```
### SuspiciousPackage

[**SuspiciousPackage**](https://mothersruin.com/software/SuspiciousPackage/get.html) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ **.pkg** —Ñ–∞–π–ª—ñ–≤ (—ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä—ñ–≤) —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥—É —ó—Ö –≤–º—ñ—Å—Ç—É –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ—é.\
–¶—ñ —ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä–∏ –º–∞—é—Ç—å `preinstall` —Ç–∞ `postinstall` bash —Å–∫—Ä–∏–ø—Ç–∏, —è–∫—ñ –∞–≤—Ç–æ—Ä–∏ —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ –ü–ó –∑–∞–∑–≤–∏—á–∞–π –∑–ª–æ–≤–∂–∏–≤–∞—é—Ç—å –¥–ª—è **–ø–æ—Å—Ç—ñ–π–Ω–æ—Å—Ç—ñ** **—à–∫—ñ–¥–ª–∏–≤–æ–≥–æ** **–ü–ó**.

### hdiutil

–¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–∑–≤–æ–ª—è—î **–º–æ–Ω—Ç—É–≤–∞—Ç–∏** –æ–±—Ä–∞–∑–∏ –¥–∏—Å–∫—ñ–≤ Apple (**.dmg**) –¥–ª—è —ó—Ö –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —á–æ–≥–æ-–Ω–µ–±—É–¥—å:
```bash
hdiutil attach ~/Downloads/Firefox\ 58.0.2.dmg
```
It will be mounted in `/Volumes`

### Packed binaries

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞ –≤–∏—Å–æ–∫—É –µ–Ω—Ç—Ä–æ–ø—ñ—é
* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä—è–¥–∫–∏ (—è–∫—â–æ –º–∞–π–∂–µ –Ω–µ–º–∞—î –∑—Ä–æ–∑—É–º—ñ–ª–æ–≥–æ —Ä—è–¥–∫–∞, —É–ø–∞–∫–æ–≤–∞–Ω–æ)
* –£–ø–∞–∫–æ–≤—â–∏–∫ UPX –¥–ª—è MacOS –≥–µ–Ω–µ—Ä—É—î —Å–µ–∫—Ü—ñ—é –ø—ñ–¥ –Ω–∞–∑–≤–æ—é "\_\_XHDR"

## Static Objective-C analysis

### Metadata

{% hint style="danger" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –ø—Ä–æ–≥—Ä–∞–º–∏, –Ω–∞–ø–∏—Å–∞–Ω—ñ –Ω–∞ Objective-C, **–∑–±–µ—Ä—ñ–≥–∞—é—Ç—å** —Å–≤–æ—ó –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ **–ø—ñ–¥ —á–∞—Å** **–∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó** –≤ [Mach-O binaries](../macos-files-folders-and-binaries/universal-binaries-and-mach-o-format.md). –¢–∞–∫—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ **–≤–∫–ª—é—á–∞—é—Ç—å** —ñ–º'—è —Ç–∞ —Ç–∏–ø:
{% endhint %}

* –í–∏–∑–Ω–∞—á–µ–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏
* –ú–µ—Ç–æ–¥–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
* –ó–º—ñ–Ω–Ω—ñ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
* –í–∏–∑–Ω–∞—á–µ–Ω—ñ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü—ñ —ñ–º–µ–Ω–∞ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω—ñ, —â–æ–± —É—Å–∫–ª–∞–¥–Ω–∏—Ç–∏ —Ä–µ–≤–µ—Ä—Å—É–≤–∞–Ω–Ω—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É.

### Function calling

–ö–æ–ª–∏ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –≤ –±—ñ–Ω–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—ñ, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Objective-C, —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –∫–æ–¥ –∑–∞–º—ñ—Å—Ç—å –≤–∏–∫–ª–∏–∫—É —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó –≤–∏–∫–ª–∏–∫–∞—î **`objc_msgSend`**. –¶–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏–º–µ —Ñ—ñ–Ω–∞–ª—å–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é:

![](<../../../.gitbook/assets/image (305).png>)

–ü–∞—Ä–∞–º–µ—Ç—Ä–∏, —è–∫—ñ –æ—á—ñ–∫—É—î —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è:

* –ü–µ—Ä—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä (**self**) - "–≤–∫–∞–∑—ñ–≤–Ω–∏–∫, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ **–µ–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—É, —è–∫–∏–π –º–∞—î –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**". –Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —Ü–µ –æ–±'—î–∫—Ç, –Ω–∞ —è–∫–æ–º—É –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥. –Ø–∫—â–æ –º–µ—Ç–æ–¥ —î –∫–ª–∞—Å–æ–≤–∏–º, —Ü–µ –±—É–¥–µ –µ–∫–∑–µ–º–ø–ª—è—Ä –æ–±'—î–∫—Ç–∞ –∫–ª–∞—Å—É (–≤ —Ü—ñ–ª–æ–º—É), —Ç–æ–¥—ñ —è–∫ –¥–ª—è –º–µ—Ç–æ–¥—ñ–≤ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ self –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –µ–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—É —è–∫ –æ–±'—î–∫—Ç.
* –î—Ä—É–≥–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä (**op**) - "—Å–µ–ª–µ–∫—Ç–æ—Ä –º–µ—Ç–æ–¥—É, —è–∫–∏–π –æ–±—Ä–æ–±–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è". –ó–Ω–æ–≤—É –∂ —Ç–∞–∫–∏, –ø—Ä–æ—Å—Ç—ñ—à–µ –∫–∞–∂—É—á–∏, —Ü–µ –ø—Ä–æ—Å—Ç–æ **—ñ–º'—è –º–µ—Ç–æ–¥—É.**
* –†–µ—à—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ - —Ü–µ –±—É–¥—å-—è–∫—ñ **–∑–Ω–∞—á–µ–Ω–Ω—è, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –º–µ—Ç–æ–¥—É** (op).

–î–∏–≤—ñ—Ç—å—Å—è, —è–∫ **–ª–µ–≥–∫–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `lldb` –≤ ARM64** –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:

{% content-ref url="arm64-basic-assembly.md" %}
[arm64-basic-assembly.md](arm64-basic-assembly.md)
{% endcontent-ref %}

x64:

| **–ê—Ä–≥—É–º–µ–Ω—Ç**      | **–†–µ—î—Å—Ç—Ä**                                                    | **(–¥–ª—è) objc\_msgSend**                                |
| ----------------- | ------------------------------------------------------------- | ------------------------------------------------------ |
| **1-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rdi**                                                       | **self: –æ–±'—î–∫—Ç, –Ω–∞ —è–∫–æ–º—É –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥**         |
| **2-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rsi**                                                       | **op: —ñ–º'—è –º–µ—Ç–æ–¥—É**                                   |
| **3-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rdx**                                                       | **1-–π –∞—Ä–≥—É–º–µ–Ω—Ç –¥–ª—è –º–µ—Ç–æ–¥—É**                           |
| **4-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **rcx**                                                       | **2-–π –∞—Ä–≥—É–º–µ–Ω—Ç –¥–ª—è –º–µ—Ç–æ–¥—É**                           |
| **5-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **r8**                                                        | **3-–π –∞—Ä–≥—É–º–µ–Ω—Ç –¥–ª—è –º–µ—Ç–æ–¥—É**                           |
| **6-–π –∞—Ä–≥—É–º–µ–Ω—Ç**  | **r9**                                                        | **4-–π –∞—Ä–≥—É–º–µ–Ω—Ç –¥–ª—è –º–µ—Ç–æ–¥—É**                           |
| **7-–π+ –∞—Ä–≥—É–º–µ–Ω—Ç** | <p><strong>rsp+</strong><br><strong>(–≤ —Å—Ç–µ–∫—É)</strong></p> | **5-–π+ –∞—Ä–≥—É–º–µ–Ω—Ç –¥–ª—è –º–µ—Ç–æ–¥—É**                          |

### Dump ObjectiveC metadata

### Dynadump

[**Dynadump**](https://github.com/DerekSelander/dynadump) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∫–ª–∞—Å–æ–≤–æ–≥–æ –¥–∞–º–ø—É –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ Objective-C. GitHub –≤–∫–∞–∑—É—î –Ω–∞ dylibs, –∞–ª–µ —Ü–µ —Ç–∞–∫–æ–∂ –ø—Ä–∞—Ü—é—î –∑ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏.
```bash
./dynadump dump /path/to/bin
```
–ù–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è, —Ü–µ **–≤ –¥–∞–Ω–∏–π —á–∞—Å –Ω–∞–π–∫—Ä–∞—â–µ –ø—Ä–∞—Ü—é—î**.

#### –ó–≤–∏—á–∞–π–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
```bash
nm --dyldinfo-only /path/to/bin
otool -ov /path/to/bin
objdump --macho --objc-meta-data /path/to/bin
```
#### class-dump

[**class-dump**](https://github.com/nygard/class-dump/) - —Ü–µ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ–π –¥–ª—è –∫–ª–∞—Å—ñ–≤, –∫–∞—Ç–µ–≥–æ—Ä—ñ–π —Ç–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª—ñ–≤ —É —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–æ–º—É –∫–æ–¥—ñ ObjectiveC.

–í—ñ–Ω —Å—Ç–∞—Ä–∏–π —ñ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è, —Ç–æ–º—É, –π–º–æ–≤—ñ—Ä–Ω–æ, –Ω–µ –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º.

#### ICDump

[**iCDump**](https://github.com/romainthomas/iCDump) - —Ü–µ —Å—É—á–∞—Å–Ω–∏–π –∫—Ä–æ—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–∏–π –¥–∞–º–ø –∫–ª–∞—Å—ñ–≤ Objective-C. –£ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏, iCDump –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –µ–∫–æ—Å–∏—Å—Ç–µ–º–∏ Apple —ñ –Ω–∞–¥–∞—î –ø—Ä–∏–≤'—è–∑–∫–∏ –¥–æ Python.
```python
import icdump
metadata = icdump.objc.parse("/path/to/bin")

print(metadata.to_decl())
```
## –°—Ç–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ Swift

–ó –±—ñ–Ω–∞—Ä–Ω–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ Swift, –æ—Å–∫—ñ–ª—å–∫–∏ —î —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑ Objective-C, —ñ–Ω–æ–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ—ó –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é [class-dump](https://github.com/nygard/class-dump/), –∞–ª–µ –Ω–µ –∑–∞–≤–∂–¥–∏.

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥ **`jtool -l`** –∞–±–æ **`otool -l`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—Ü—ñ–π, —è–∫—ñ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–∞ **`__swift5`**:
```bash
jtool2 -l /Applications/Stocks.app/Contents/MacOS/Stocks
LC 00: LC_SEGMENT_64              Mem: 0x000000000-0x100000000    __PAGEZERO
LC 01: LC_SEGMENT_64              Mem: 0x100000000-0x100028000    __TEXT
[...]
Mem: 0x100026630-0x100026d54        __TEXT.__swift5_typeref
Mem: 0x100026d60-0x100027061        __TEXT.__swift5_reflstr
Mem: 0x100027064-0x1000274cc        __TEXT.__swift5_fieldmd
Mem: 0x1000274cc-0x100027608        __TEXT.__swift5_capture
[...]
```
–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ [**—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —â–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ —Ü–∏—Ö —Ä–æ–∑–¥—ñ–ª–∞—Ö, —É —Ü—å–æ–º—É –±–ª–æ–∑—ñ**](https://knight.sc/reverse%20engineering/2019/07/17/swift-metadata.html).

–ö—Ä—ñ–º —Ç–æ–≥–æ, **Swift –±—ñ–Ω–∞—Ä–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ —Å–∏–º–≤–æ–ª–∏** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å–∏–º–≤–æ–ª–∏, —â–æ–± —ó—Ö —Ñ—É–Ω–∫—Ü—ñ—ó –º–æ–∂–Ω–∞ –±—É–ª–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏). **–°–∏–º–≤–æ–ª–∏ –∑–∞–∑–≤–∏—á–∞–π –º—ñ—Å—Ç—è—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —ñ–º'—è —Ñ—É–Ω–∫—Ü—ñ—ó** —Ç–∞ –∞—Ç—Ä–∏–±—É—Ç–∏ –≤ –Ω–µ–æ—Ö–∞–π–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ, —Ç–æ–º—É –≤–æ–Ω–∏ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω—ñ, —ñ —ñ—Å–Ω—É—é—Ç—å "**–¥–µ–º–∞–Ω–≥–ª–µ—Ä–∏"**, —è–∫—ñ –º–æ–∂—É—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ —ñ–º'—è:
```bash
# Ghidra plugin
https://github.com/ghidraninja/ghidra_scripts/blob/master/swift_demangler.py

# Swift cli
swift demangle
```
## –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑

{% hint style="warning" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ **SIP –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–º–∫–Ω—É—Ç–∏** (`csrutil disable` –∞–±–æ `csrutil enable --without debug`) –∞–±–æ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ –≤ —Ç–∏–º—á–∞—Å–æ–≤—É –ø–∞–ø–∫—É —Ç–∞ **–≤–∏–¥–∞–ª–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `codesign --remove-signature <binary-path>` –∞–±–æ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É (–≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ [—Ü–µ–π —Å–∫—Ä–∏–ø—Ç](https://gist.github.com/carlospolop/a66b8d72bb8f43913c4b5ae45672578b))
{% endhint %}

{% hint style="warning" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è **—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤**, (—Ç–∞–∫–∏—Ö —è–∫ `cloudconfigurationd`) –Ω–∞ macOS, **SIP –º–∞—î –±—É—Ç–∏ –≤–∏–º–∫–Ω–µ–Ω–æ** (–ø—Ä–æ—Å—Ç–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É –Ω–µ —Å–ø—Ä–∞—Ü—é—î).
{% endhint %}

### API

macOS –Ω–∞–¥–∞—î –¥–µ—è–∫—ñ —Ü—ñ–∫–∞–≤—ñ API, —è–∫—ñ –Ω–∞–¥–∞—é—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å–∏:

* `proc_info`: –¶–µ –æ—Å–Ω–æ–≤–Ω–∏–π API, —è–∫–∏–π –Ω–∞–¥–∞—î –±–∞–≥–∞—Ç–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ–∂–µ–Ω –ø—Ä–æ—Ü–µ—Å. –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É—Ç–∏ root, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —ñ–Ω—à—ñ –ø—Ä–æ—Ü–µ—Å–∏, –∞–ª–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∞ –∞–±–æ mach –ø–æ—Ä—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ.
* `libsysmon.dylib`: –î–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å–∏ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—ó, —â–æ –Ω–∞–¥–∞—é—Ç—å—Å—è XPC, –æ–¥–Ω–∞–∫ –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ –ø—Ä–∞–≤–æ `com.apple.sysmond.client`.

### Stackshot —Ç–∞ –º—ñ–∫—Ä–æ—Å—Ç–µ–∫—à–æ—Ç–∏

**Stackshotting** ‚Äî —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –ø—Ä–æ—Ü–µ—Å—ñ–≤, –≤–∫–ª—é—á–∞—é—á–∏ —Å—Ç–µ–∫ –≤–∏–∫–ª–∏–∫—ñ–≤ —É—Å—ñ—Ö –∑–∞–ø—É—â–µ–Ω–∏—Ö –ø–æ—Ç–æ–∫—ñ–≤. –¶–µ –æ—Å–æ–±–ª–∏–≤–æ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è, –∞–Ω–∞–ª—ñ–∑—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ —Å–∏—Å—Ç–µ–º–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –º–æ–º–µ–Ω—Ç —á–∞—Å—É. –ù–∞ iOS —Ç–∞ macOS stackshotting –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫—ñ–ª—å–∫–æ—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —ñ –º–µ—Ç–æ–¥—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ **`sample`** —Ç–∞ **`spindump`**.

### Sysdiagnose

–¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (`/usr/bini/ysdiagnose`) –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∑–±–∏—Ä–∞—î –±–∞–≥–∞—Ç–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ –≤–∞—à–æ–≥–æ –∫–æ–º–ø'—é—Ç–µ—Ä–∞, –≤–∏–∫–æ–Ω—É—é—á–∏ –¥–µ—Å—è—Ç–∫–∏ —Ä—ñ–∑–Ω–∏—Ö –∫–æ–º–∞–Ω–¥, —Ç–∞–∫–∏—Ö —è–∫ `ps`, `zprint`...

–ô–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç–∏ —è–∫ **root**, –∞ –¥–µ–º–æ–Ω `/usr/libexec/sysdiagnosed` –º–∞—î –¥—É–∂–µ —Ü—ñ–∫–∞–≤—ñ –ø—Ä–∞–≤–∞, —Ç–∞–∫—ñ —è–∫ `com.apple.system-task-ports` —Ç–∞ `get-task-allow`.

–ô–æ–≥–æ plist —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π —É `/System/Library/LaunchDaemons/com.apple.sysdiagnose.plist`, —è–∫–∏–π –æ–≥–æ–ª–æ—à—É—î 3 MachServices:

* `com.apple.sysdiagnose.CacheDelete`: –í–∏–¥–∞–ª—è—î —Å—Ç–∞—Ä—ñ –∞—Ä—Ö—ñ–≤–∏ –≤ /var/rmp
* `com.apple.sysdiagnose.kernel.ipc`: –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –ø–æ—Ä—Ç 23 (—è–¥—Ä–æ)
* `com.apple.sysdiagnose.service.xpc`: –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–∂–∏–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–µ—Ä–µ–∑ –∫–ª–∞—Å `Libsysdiagnose` Obj-C. –¢—Ä–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –≤ —Å–ª–æ–≤–Ω–∏–∫—É –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–µ—Ä–µ–¥–∞–Ω—ñ (`compress`, `display`, `run`)

### –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –∂—É—Ä–Ω–∞–ª–∏

MacOS –≥–µ–Ω–µ—Ä—É—î –±–∞–≥–∞—Ç–æ –∂—É—Ä–Ω–∞–ª—ñ–≤, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–º–∏ –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–≥—Ä–∞–º–∏, –Ω–∞–º–∞–≥–∞—é—á–∏—Å—å –∑—Ä–æ–∑—É–º—ñ—Ç–∏ **—â–æ –≤–æ–Ω–∞ —Ä–æ–±–∏—Ç—å**.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —î –¥–µ—è–∫—ñ –∂—É—Ä–Ω–∞–ª–∏, —è–∫—ñ –º—ñ—Å—Ç–∏—Ç–∏–º—É—Ç—å —Ç–µ–≥ `<private>`, —â–æ–± **—Å—Ö–æ–≤–∞—Ç–∏** –¥–µ—è–∫—É **—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é**, —â–æ **—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î** **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –∞–±–æ **–∫–æ–º–ø'—é—Ç–µ—Ä**. –û–¥–Ω–∞–∫ –º–æ–∂–ª–∏–≤–æ **–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –¥–ª—è —Ä–æ–∑–∫—Ä–∏—Ç—Ç—è —Ü—ñ—î—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó**. –°–ª—ñ–¥—É–π—Ç–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è–º [**—Ç—É—Ç**](https://superuser.com/questions/1532031/how-to-show-private-data-in-macos-unified-log).

### Hopper

#### –õ—ñ–≤–∞ –ø–∞–Ω–µ–ª—å

–ù–∞ –ª—ñ–≤—ñ–π –ø–∞–Ω–µ–ª—ñ Hopper –º–æ–∂–Ω–∞ –ø–æ–±–∞—á–∏—Ç–∏ —Å–∏–º–≤–æ–ª–∏ (**Labels**) –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É, —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ–¥—É—Ä —ñ —Ñ—É–Ω–∫—Ü—ñ–π (**Proc**) —Ç–∞ —Ä—è–¥–∫–∏ (**Str**). –¶–µ –Ω–µ –≤—Å—ñ —Ä—è–¥–∫–∏, –∞ –ª–∏—à–µ —Ç—ñ, —â–æ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –≤ –∫—ñ–ª—å–∫–æ—Ö —á–∞—Å—Ç–∏–Ω–∞—Ö —Ñ–∞–π–ª—É Mac-O (—è–∫ _cstring –∞–±–æ_ `objc_methname`).

#### –°–µ—Ä–µ–¥–Ω—è –ø–∞–Ω–µ–ª—å

–ù–∞ —Å–µ—Ä–µ–¥–Ω—ñ–π –ø–∞–Ω–µ–ª—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –±–∞—á–∏—Ç–∏ **–¥–∏–∑–∞—Å–µ–º–±–ª—å–æ–≤–∞–Ω–∏–π –∫–æ–¥**. –Ü –≤–∏ –º–æ–∂–µ—Ç–µ –±–∞—á–∏—Ç–∏ –π–æ–≥–æ —É **—Å–∏—Ä–æ–º—É** –¥–∏–∑–∞—Å–µ–º–±–ª—é–≤–∞–Ω–Ω—ñ, —è–∫ **–≥—Ä–∞—Ñ**, —è–∫ **–¥–µ–∫–æ–¥–æ–≤–∞–Ω–∏–π** —Ç–∞ —è–∫ **–±—ñ–Ω–∞—Ä–Ω–∏–π**, –Ω–∞—Ç–∏—Å–∫–∞—é—á–∏ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É —ñ–∫–æ–Ω–∫—É:

<figure><img src="../../../.gitbook/assets/image (343).png" alt=""><figcaption></figcaption></figure>

–ö–ª–∞—Ü–Ω—É–≤—à–∏ –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ –æ–±'—î–∫—Ç—ñ –∫–æ–¥—É, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞/–∑ —Ü—å–æ–≥–æ –æ–±'—î–∫—Ç–∞** –∞–±–æ –Ω–∞–≤—ñ—Ç—å –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ –Ω–∞–∑–≤—É (—Ü–µ –Ω–µ –ø—Ä–∞—Ü—é—î –≤ –¥–µ–∫–æ–¥–æ–≤–∞–Ω–æ–º—É –ø—Å–µ–≤–¥–æ–∫–æ–¥—ñ):

<figure><img src="../../../.gitbook/assets/image (1117).png" alt=""><figcaption></figcaption></figure>

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –≤ **–Ω–∏–∂–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ —Å–µ—Ä–µ–¥–Ω—å–æ—ó –ø–∞–Ω–µ–ª—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ python**.

#### –ü—Ä–∞–≤–∞ –ø–∞–Ω–µ–ª—å

–ù–∞ –ø—Ä–∞–≤—ñ–π –ø–∞–Ω–µ–ª—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Ü—ñ–∫–∞–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —Ç–∞–∫—É —è–∫ **—ñ—Å—Ç–æ—Ä—ñ—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó** (—â–æ–± –≤–∏ –∑–Ω–∞–ª–∏, —è–∫ –≤–∏ –ø–æ—Ç—Ä–∞–ø–∏–ª–∏ –≤ –ø–æ—Ç–æ—á–Ω—É —Å–∏—Ç—É–∞—Ü—ñ—é), **–≥—Ä–∞—Ñ –≤–∏–∫–ª–∏–∫—ñ–≤**, –¥–µ –≤–∏ –º–æ–∂–µ—Ç–µ –±–∞—á–∏—Ç–∏ –≤—Å—ñ **—Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é**, —ñ –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ **–≤–∏–∫–ª–∏–∫–∞—î —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è**, –∞ —Ç–∞–∫–æ–∂ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ **–ª–æ–∫–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ**.

### dtrace

–¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø—Ä–æ–≥—Ä–∞–º –Ω–∞ –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ **–Ω–∏–∑—å–∫–æ–º—É —Ä—ñ–≤–Ω—ñ** —ñ –Ω–∞–¥–∞—î —Å–ø–æ—Å—ñ–± –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ **–≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏** **–ø—Ä–æ–≥—Ä–∞–º–∏** —ñ –Ω–∞–≤—ñ—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —ó—Ö–Ω—ñ–π –ø–æ—Ç—ñ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. Dtrace –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–ø—Ä–æ–±–Ω–∏–∫–∏**, —è–∫—ñ **—Ä–æ–∑–º—ñ—â–µ–Ω—ñ –ø–æ –≤—Å—å–æ–º—É —è–¥—Ä—É** —ñ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ —Ç–∞–∫–∏—Ö –º—ñ—Å—Ü—è—Ö, —è–∫ –ø–æ—á–∞—Ç–æ–∫ —ñ –∫—ñ–Ω–µ—Ü—å —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤.

DTrace –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ñ—É–Ω–∫—Ü—ñ—é **`dtrace_probe_create`** –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–±–Ω–∏–∫–∞ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É. –¶—ñ –ø—Ä–æ–±–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω—ñ –≤ **—Ç–æ—á–∫–∞—Ö –≤—Ö–æ–¥—É —Ç–∞ –≤–∏—Ö–æ–¥—É –∫–æ–∂–Ω–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É**. –í–∑–∞—î–º–æ–¥—ñ—è –∑ DTrace –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ /dev/dtrace, —è–∫–∏–π –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ root.

{% hint style="success" %}
–©–æ–± —É–≤—ñ–º–∫–Ω—É—Ç–∏ Dtrace, –Ω–µ –≤–∏–º–∏–∫–∞—é—á–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞—Ö–∏—Å—Ç SIP, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤ —Ä–µ–∂–∏–º—ñ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è: `csrutil enable --without dtrace`

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ **`dtrace`** –∞–±–æ **`dtruss`** –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏, —è–∫—ñ **–≤–∏ —Å–∫–æ–º–ø—ñ–ª—é–≤–∞–ª–∏**.
{% endhint %}

–î–æ—Å—Ç—É–ø–Ω—ñ –ø—Ä–æ–±–Ω–∏–∫–∏ dtrace –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
dtrace -l | head
ID   PROVIDER            MODULE                          FUNCTION NAME
1     dtrace                                                     BEGIN
2     dtrace                                                     END
3     dtrace                                                     ERROR
43    profile                                                     profile-97
44    profile                                                     profile-199
```
–ù–∞–∑–≤–∞ –∑–æ–Ω–¥–∞ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —á–æ—Ç–∏—Ä—å–æ—Ö —á–∞—Å—Ç–∏–Ω: –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞, –º–æ–¥—É–ª—è, —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–∞ –Ω–∞–∑–≤–∏ (`fbt:mach_kernel:ptrace:entry`). –Ø–∫—â–æ –≤–∏ –Ω–µ –≤–∫–∞–∂–µ—Ç–µ —è–∫—É—Å—å —á–∞—Å—Ç–∏–Ω—É –Ω–∞–∑–≤–∏, Dtrace –∑–∞—Å—Ç–æ—Å—É—î —Ü—é —á–∞—Å—Ç–∏–Ω—É —è–∫ —à–∞–±–ª–æ–Ω.

–©–æ–± –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ DTrace –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –∑–æ–Ω–¥—ñ–≤ —ñ –≤–∫–∞–∑–∞—Ç–∏, —è–∫—ñ –¥—ñ—ó –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏, –∫–æ–ª–∏ –≤–æ–Ω–∏ —Å–ø—Ä–∞—Ü—å–æ–≤—É—é—Ç—å, –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º–æ–≤—É D.

–ë—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ç–∞ –±—ñ–ª—å—à–µ –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [https://illumos.org/books/dtrace/chp-intro.html](https://illumos.org/books/dtrace/chp-intro.html)

#### –ü—Ä–∏–∫–ª–∞–¥–∏

–ó–∞–ø—É—Å—Ç—ñ—Ç—å `man -k dtrace`, —â–æ–± –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ **–¥–æ—Å—Ç—É–ø–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ DTrace**. –ü—Ä–∏–∫–ª–∞–¥: `sudo dtruss -n binary`
```bash
#Count the number of syscalls of each running process
sudo dtrace -n 'syscall:::entry {@[execname] = count()}'
```
* —Å–∫—Ä–∏–ø—Ç
```bash
syscall:::entry
/pid == $1/
{
}

#Log every syscall of a PID
sudo dtrace -s script.d 1234
```

```bash
syscall::open:entry
{
printf("%s(%s)", probefunc, copyinstr(arg0));
}
syscall::close:entry
{
printf("%s(%d)\n", probefunc, arg0);
}

#Log files opened and closed by a process
sudo dtrace -s b.d -c "cat /etc/hosts"
```

```bash
syscall:::entry
{
;
}
syscall:::return
{
printf("=%d\n", arg1);
}

#Log sys calls with values
sudo dtrace -s syscalls_info.d -c "cat /etc/hosts"
```
### dtruss
```bash
dtruss -c ls #Get syscalls of ls
dtruss -c -p 1000 #get syscalls of PID 1000
```
### kdebug

–¶–µ –∑–∞—Å—ñ–± —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è —è–¥—Ä–∞. –î–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω—ñ –∫–æ–¥–∏ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ **`/usr/share/misc/trace.codes`**.

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —Ç–∞–∫—ñ —è–∫ `latency`, `sc_usage`, `fs_usage` —Ç–∞ `trace`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –π–æ–≥–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ.

–î–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ `kdebug` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `sysctl` —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—ñ—Ä —ñ–º–µ–Ω `kern.kdebug`, –∞ MIB, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ `sys/sysctl.h`, –¥–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –≤ `bsd/kern/kdebug.c`.

–©–æ–± –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑ kdebug –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤–ª–∞—Å–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞, –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —Ç–∞–∫—ñ –∫—Ä–æ–∫–∏:

* –í–∏–¥–∞–ª–∏—Ç–∏ —ñ—Å–Ω—É—é—á—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑ KERN\_KDSETREMOVE
* –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è –∑ KERN\_KDSETBUF —Ç–∞ KERN\_KDSETUP
* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ KERN\_KDGETBUF, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ —É –±—É—Ñ–µ—Ä—ñ
* –û—Ç—Ä–∏–º–∞—Ç–∏ –≤–ª–∞—Å–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞ –∑ —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é KERN\_KDPINDEX
* –£–≤—ñ–º–∫–Ω—É—Ç–∏ —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è –∑ KERN\_KDENABLE
* –ü—Ä–æ—á–∏—Ç–∞—Ç–∏ –±—É—Ñ–µ—Ä, –≤–∏–∫–ª–∏–∫–∞–≤—à–∏ KERN\_KDREADTR
* –©–æ–± –∑—ñ—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ–∂–µ–Ω –ø–æ—Ç—ñ–∫ –∑ –π–æ–≥–æ –ø—Ä–æ—Ü–µ—Å–æ–º, –≤–∏–∫–ª–∏–∫–∞—Ç–∏ KERN\_KDTHRMAP.

–©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Apple **`trace`** –∞–±–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [kDebugView (kdv)](https://newosxbook.com/tools/kdv.html)**.**

**–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ Kdebug –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è 1 –∫–ª—ñ—î–Ω—Ç–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–æ.** –¢–æ–±—Ç–æ –ª–∏—à–µ –æ–¥–∏–Ω —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–∞ –±–∞–∑—ñ k-debug –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–∏–π –æ–¥–Ω–æ—á–∞—Å–Ω–æ.

### ktrace

API `ktrace_*` –ø–æ—Ö–æ–¥—è—Ç—å –∑ `libktrace.dylib`, —è–∫—ñ –æ–±–≥–æ—Ä—Ç—É—é—Ç—å —Ç—ñ, —â–æ –∑ `Kdebug`. –¢–æ–¥—ñ –∫–ª—ñ—î–Ω—Ç –º–æ–∂–µ –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `ktrace_session_create` —Ç–∞ `ktrace_events_[single/class]`, —â–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –∫–æ–¥—ñ–≤, –∞ –ø–æ—Ç—ñ–º –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –π–æ–≥–æ –∑ `ktrace_start`.

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ –Ω–∞–≤—ñ—Ç—å –∑ **–∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–º SIP**

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —É—Ç–∏–ª—ñ—Ç—É `ktrace` —è–∫ –∫–ª—ñ—î–Ω—Ç:
```bash
ktrace trace -s -S -t c -c ls | grep "ls("
```
Or `tailspin`.

### kperf

–¶–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø—Ä–æ—Ñ—ñ–ª—é–≤–∞–Ω–Ω—è –Ω–∞ —Ä—ñ–≤–Ω—ñ —è–¥—Ä–∞ —ñ –ø–æ–±—É–¥–æ–≤–∞–Ω–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤–∏–∫–ª–∏–∫—ñ–≤ `Kdebug`.

–í –æ—Å–Ω–æ–≤–Ω–æ–º—É, –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞ `kernel_debug_active`, —ñ —è–∫—â–æ –≤–æ–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è `kperf_kdebug_handler` –∑ –∫–æ–¥–æ–º `Kdebug` —Ç–∞ –∞–¥—Ä–µ—Å–æ—é –∫–∞–¥—Ä—É —è–¥—Ä–∞, —â–æ –≤–∏–∫–ª–∏–∫–∞—î. –Ø–∫—â–æ –∫–æ–¥ `Kdebug` –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –æ–¥–Ω–æ–º—É –∑ –≤–∏–±—Ä–∞–Ω–∏—Ö, –æ—Ç—Ä–∏–º—É—é—Ç—å—Å—è "–¥—ñ—ó", –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ —è–∫ –±—ñ—Ç–æ–≤–∞ –∫–∞—Ä—Ç–∞ (–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ `osfmk/kperf/action.h` –¥–ª—è –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤).

Kperf —Ç–∞–∫–æ–∂ –º–∞—î —Ç–∞–±–ª–∏—Ü—é MIB sysctl: (—è–∫ root) `sysctl kperf`. –¶—ñ –∫–æ–¥–∏ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ `osfmk/kperf/kperfbsd.c`.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –ø—ñ–¥–º–Ω–æ–∂–∏–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ Kperf –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `kpc`, —è–∫–∏–π –Ω–∞–¥–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –º–∞—à–∏–Ω–∏.

### ProcessMonitor

[**ProcessMonitor**](https://objective-see.com/products/utilities.html#ProcessMonitor) —î –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥—ñ–π, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ –ø—Ä–æ—Ü–µ—Å–∞–º–∏, —è–∫—ñ –≤–∏–∫–æ–Ω—É—î –ø—Ä–æ—Ü–µ—Å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –Ω–æ–≤–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, —è–∫—ñ —Å—Ç–≤–æ—Ä—é—î –ø—Ä–æ—Ü–µ—Å).

### SpriteTree

[**SpriteTree**](https://themittenmac.com/tools/) —î —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –≤—ñ–¥–Ω–æ—Å–∏–Ω –º—ñ–∂ –ø—Ä–æ—Ü–µ—Å–∞–º–∏.\
–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ –≤–∞—à mac –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ **`sudo eslogger fork exec rename create > cap.json`** (—Ç–µ—Ä–º—ñ–Ω–∞–ª, —â–æ –∑–∞–ø—É—Å–∫–∞—î —Ü–µ, –≤–∏–º–∞–≥–∞—î FDA). –ê –ø–æ—Ç—ñ–º –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ json –≤ —Ü–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏:

<figure><img src="../../../.gitbook/assets/image (1182).png" alt="" width="375"><figcaption></figcaption></figure>

### FileMonitor

[**FileMonitor**](https://objective-see.com/products/utilities.html#FileMonitor) –¥–æ–∑–≤–æ–ª—è—î –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ –ø–æ–¥—ñ—ó —Ñ–∞–π–ª—ñ–≤ (—Ç–∞–∫—ñ —è–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è), –Ω–∞–¥–∞—é—á–∏ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ç–∞–∫—ñ –ø–æ–¥—ñ—ó.

### Crescendo

[**Crescendo**](https://github.com/SuprHackerSteve/Crescendo) —î GUI-—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –∑ –≤–∏–≥–ª—è–¥–æ–º —ñ –≤—ñ–¥—á—É—Ç—Ç—è–º, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–Ω–∞–π–æ–º—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º Windows –∑ _Procmon_ –≤—ñ–¥ Microsoft Sysinternal. –¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–∑–≤–æ–ª—è—î –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏ –ø–æ–¥—ñ–π, —è–∫—ñ –º–æ–∂–Ω–∞ –ø–æ—á–∞—Ç–∏ —ñ –∑—É–ø–∏–Ω–∏—Ç–∏, –¥–æ–∑–≤–æ–ª—è—î —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ —Ü—ñ –ø–æ–¥—ñ—ó –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏, —Ç–∞–∫–∏–º–∏ —è–∫ —Ñ–∞–π–ª, –ø—Ä–æ—Ü–µ—Å, –º–µ—Ä–µ–∂–∞ —Ç–æ—â–æ, —ñ –Ω–∞–¥–∞—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞–ø–∏—Å–∞–Ω–∏—Ö –ø–æ–¥—ñ–π —É —Ñ–æ—Ä–º–∞—Ç—ñ json.

### Apple Instruments

[**Apple Instruments**](https://developer.apple.com/library/archive/documentation/Performance/Conceptual/CellularBestPractices/Appendix/Appendix.html) —î —á–∞—Å—Ç–∏–Ω–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ Xcode ‚Äì –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–æ–¥–∞—Ç–∫—ñ–≤, –≤–∏—è–≤–ª–µ–Ω–Ω—è –≤–∏—Ç–æ–∫—ñ–≤ –ø–∞–º'—è—Ç—ñ —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏.

![](<../../../.gitbook/assets/image (1138).png>)

### fs\_usage

–î–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –¥—ñ—ó, –≤–∏–∫–æ–Ω—É–≤–∞–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∞–º–∏:
```bash
fs_usage -w -f filesys ls #This tracks filesystem actions of proccess names containing ls
fs_usage -w -f network curl #This tracks network actions
```
### TaskExplorer

[**Taskexplorer**](https://objective-see.com/products/taskexplorer.html) –∫–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É **–±—ñ–±–ª—ñ–æ—Ç–µ–∫**, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –±—ñ–Ω–∞—Ä–Ω–∏–º —Ñ–∞–π–ª–æ–º, **—Ñ–∞–π–ª—ñ–≤**, —è–∫—ñ –≤—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î, —Ç–∞ **–º–µ—Ä–µ–∂–µ–≤–∏—Ö** –∑'—î–¥–Ω–∞–Ω—å.\
–í—ñ–Ω —Ç–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –±—ñ–Ω–∞—Ä–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ –Ω–∞ **virustotal** —ñ –ø–æ–∫–∞–∑—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª.

## PT\_DENY\_ATTACH <a href="#page-title" id="page-title"></a>

–£ [**—Ü—å–æ–º—É –±–ª–æ–∑—ñ**](https://knight.sc/debugging/2019/06/03/debugging-apple-binaries-that-use-pt-deny-attach.html) –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ —Ç–æ–≥–æ, —è–∫ **–Ω–∞–ª–∞–≥–æ–¥–∏—Ç–∏ –ø—Ä–∞—Ü—é—é—á–∏–π –¥–µ–º–æ–Ω**, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ **`PT_DENY_ATTACH`**, —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—é, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ SIP –±—É–≤ –≤–∏–º–∫–Ω–µ–Ω–∏–π.

### lldb

**lldb** —î –¥–µ **—Ñ–∞–∫—Ç–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º** –¥–ª—è **–Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è** –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ **macOS**.
```bash
lldb ./malware.bin
lldb -p 1122
lldb -n malware.bin
lldb -n malware.bin --waitfor
```
–í–∏ –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–º–∞–∫ intel, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ lldb, —Å—Ç–≤–æ—Ä–∏–≤—à–∏ —Ñ–∞–π–ª **`.lldbinit`** —É –≤–∞—à—ñ–π –¥–æ–º–∞—à–Ω—ñ–π –ø–∞–ø—Ü—ñ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —Ä—è–¥–∫–æ–º:
```bash
settings set target.x86-disassembly-flavor intel
```
{% hint style="warning" %}
–í—Å–µ—Ä–µ–¥–∏–Ω—ñ lldb, –∑–±–µ—Ä–µ–∂—ñ—Ç—å –ø—Ä–æ—Ü–µ—Å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `process save-core`
{% endhint %}

<table data-header-hidden><thead><tr><th width="225"></th><th></th></tr></thead><tbody><tr><td><strong>(lldb) –ö–æ–º–∞–Ω–¥–∞</strong></td><td><strong>–û–ø–∏—Å</strong></td></tr><tr><td><strong>run (r)</strong></td><td>–ü–æ—á–∞—Ç–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —è–∫–µ —Ç—Ä–∏–≤–∞—Ç–∏–º–µ –±–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–æ, –ø–æ–∫–∏ –Ω–µ –±—É–¥–µ –¥–æ—Å—è–≥–Ω—É—Ç–æ —Ç–æ—á–∫–∏ –∑—É–ø–∏–Ω–∫–∏ –∞–±–æ –ø—Ä–æ—Ü–µ—Å –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è.</td></tr><tr><td><strong>process launch --stop-at-entry</strong></td><td>–ü–æ—á–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –∑—É–ø–∏–Ω–∏–≤—à–∏—Å—å –Ω–∞ —Ç–æ—á—Ü—ñ –≤—Ö–æ–¥—É</td></tr><tr><td><strong>continue (c)</strong></td><td>–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–∞–ª–∞–≥–æ–¥–∂—É–≤–∞–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É.</td></tr><tr><td><strong>nexti (n / ni)</strong></td><td>–í–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é. –¶—è –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–∏–∫–ª–∏–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–π.</td></tr><tr><td><strong>stepi (s / si)</strong></td><td>–í–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ –∫–æ–º–∞–Ω–¥–∏ nexti, —Ü—è –∫–æ–º–∞–Ω–¥–∞ –∑–∞–π–¥–µ –≤ –≤–∏–∫–ª–∏–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–π.</td></tr><tr><td><strong>finish (f)</strong></td><td>–í–∏–∫–æ–Ω–∞—Ç–∏ —Ä–µ—à—Ç—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π —É –ø–æ—Ç–æ—á–Ω—ñ–π —Ñ—É–Ω–∫—Ü—ñ—ó (‚Äú—Ä–∞–º—Ü—ñ‚Äù), –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è —Ç–∞ –∑—É–ø–∏–Ω–∏—Ç–∏—Å—è.</td></tr><tr><td><strong>control + c</strong></td><td>–ü—Ä–∏–∑—É–ø–∏–Ω–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. –Ø–∫—â–æ –ø—Ä–æ—Ü–µ—Å –±—É–≤ –∑–∞–ø—É—â–µ–Ω–∏–π (r) –∞–±–æ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–∏–π (c), —Ü–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –∑—É–ø–∏–Ω–∫–∏ –ø—Ä–æ—Ü–µ—Å—É ...–¥–µ –± –≤—ñ–Ω –Ω–µ –≤–∏–∫–æ–Ω—É–≤–∞–≤—Å—è –≤ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç.</td></tr><tr><td><strong>breakpoint (b)</strong></td><td><p><code>b main</code> #–ë—É–¥—å-—è–∫–∞ —Ñ—É–Ω–∫—Ü—ñ—è, –Ω–∞–∑–≤–∞–Ω–∞ main</p><p><code>b &#x3C;binname>`main</code> #–ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É</p><p><code>b set -n main --shlib &#x3C;lib_name></code> #–ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∫–∞–∑–∞–Ω–æ–≥–æ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É</p><p><code>breakpoint set -r '\[NSFileManager .*\]$'</code> #–ë—É–¥—å-—è–∫–∏–π –º–µ—Ç–æ–¥ NSFileManager</p><p><code>breakpoint set -r '\[NSFileManager contentsOfDirectoryAtPath:.*\]$'</code></p><p><code>break set -r . -s libobjc.A.dylib</code> # –ó—É–ø–∏–Ω–∫–∞ –≤ —É—Å—ñ—Ö —Ñ—É–Ω–∫—Ü—ñ—è—Ö —Ü—ñ—î—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏</p><p><code>b -a 0x0000000100004bd9</code></p><p><code>br l</code> #–°–ø–∏—Å–æ–∫ —Ç–æ—á–æ–∫ –∑—É–ø–∏–Ω–∫–∏</p><p><code>br e/dis &#x3C;num></code> #–£–≤—ñ–º–∫–Ω—É—Ç–∏/–í–∏–º–∫–Ω—É—Ç–∏ —Ç–æ—á–∫—É –∑—É–ø–∏–Ω–∫–∏</p><p>breakpoint delete &#x3C;num></p></td></tr><tr><td><strong>help</strong></td><td><p>help breakpoint #–û—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ–ø–æ–º–æ–≥—É –∑ –∫–æ–º–∞–Ω–¥–∏ —Ç–æ—á–∫–∏ –∑—É–ø–∏–Ω–∫–∏</p><p>help memory write #–û—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ–ø–æ–º–æ–≥—É –¥–ª—è –∑–∞–ø–∏—Å—É –≤ –ø–∞–º'—è—Ç—å</p></td></tr><tr><td><strong>reg</strong></td><td><p>reg read</p><p>reg read $rax</p><p>reg read $rax --format &#x3C;<a href="https://lldb.llvm.org/use/variable.html#type-format">—Ñ–æ—Ä–º–∞—Ç</a>></p><p>reg write $rip 0x100035cc0</p></td></tr><tr><td><strong>x/s &#x3C;reg/memory address></strong></td><td>–í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –ø–∞–º'—è—Ç—å —è–∫ —Ä—è–¥–æ–∫ –∑ –Ω—É–ª—å–æ–≤–∏–º –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è–º.</td></tr><tr><td><strong>x/i &#x3C;reg/memory address></strong></td><td>–í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –ø–∞–º'—è—Ç—å —è–∫ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é –∞—Å–µ–º–±–ª–µ—Ä–∞.</td></tr><tr><td><strong>x/b &#x3C;reg/memory address></strong></td><td>–í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –ø–∞–º'—è—Ç—å —è–∫ –±–∞–π—Ç.</td></tr><tr><td><strong>print object (po)</strong></td><td><p>–¶–µ –Ω–∞–¥—Ä—É–∫—É—î –æ–±'—î–∫—Ç, –Ω–∞ —è–∫–∏–π –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä</p><p>po $raw</p><p><code>{</code></p><p><code>dnsChanger = {</code></p><p><code>"affiliate" = "";</code></p><p><code>"blacklist_dns" = ();</code></p><p>–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –±—ñ–ª—å—à—ñ—Å—Ç—å API –∞–±–æ –º–µ—Ç–æ–¥—ñ–≤ Objective-C –≤—ñ–¥ Apple –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –æ–±'—î–∫—Ç–∏, —ñ —Ç–æ–º—É —ó—Ö —Å–ª—ñ–¥ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ ‚Äú–¥—Ä—É–∫ –æ–±'—î–∫—Ç–∞‚Äù (po). –Ø–∫—â–æ po –Ω–µ –¥–∞—î –∑–º—ñ—Å—Ç–æ–≤–Ω–æ–≥–æ –≤–∏—Ö–æ–¥—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ <code>x/b</code></p></td></tr><tr><td><strong>memory</strong></td><td>memory read 0x000....<br>memory read $x0+0xf2a<br>memory write 0x100600000 -s 4 0x41414141 #–ó–∞–ø–∏—Å–∞—Ç–∏ AAAA –∑–∞ —Ü—ñ—î—é –∞–¥—Ä–µ—Å–æ—é<br>memory write -f s $rip+0x11f+7 "AAAA" #–ó–∞–ø–∏—Å–∞—Ç–∏ AAAA –∑–∞ –∞–¥—Ä–µ—Å–æ—é</td></tr><tr><td><strong>disassembly</strong></td><td><p>dis #–î–∏–∑–∞—Å–µ–º–±–ª—é–≤–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é</p><p>dis -n &#x3C;funcname> #–î–∏–∑–∞—Å–µ–º–±–ª—é–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é</p><p>dis -n &#x3C;funcname> -b &#x3C;basename> #–î–∏–∑–∞—Å–µ–º–±–ª—é–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é<br>dis -c 6 #–î–∏–∑–∞—Å–µ–º–±–ª—é–≤–∞—Ç–∏ 6 —Ä—è–¥–∫—ñ–≤<br>dis -c 0x100003764 -e 0x100003768 # –í—ñ–¥ –æ–¥–Ω—ñ—î—ó –∞–¥—Ä–µ—Å–∏ –¥–æ —ñ–Ω—à–æ—ó<br>dis -p -c 4 # –ü–æ—á–∞—Ç–∏ –≤ –ø–æ—Ç–æ—á–Ω—ñ–π –∞–¥—Ä–µ—Å—ñ –¥–∏–∑–∞—Å–µ–º–±–ª—é–≤–∞–Ω–Ω—è</p></td></tr><tr><td><strong>parray</strong></td><td>parray 3 (char **)$x1 # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–∞—Å–∏–≤ –∑ 3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —É —Ä–µ–≥—ñ—Å—Ç—Ä—ñ x1</td></tr><tr><td><strong>image dump sections</strong></td><td>–î—Ä—É–∫ –∫–∞—Ä—Ç–∏ –ø–∞–º'—è—Ç—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É</td></tr><tr><td><strong>image dump symtab &#x3C;library></strong></td><td><code>image dump symtab CoreNLP</code> #–û—Ç—Ä–∏–º–∞—Ç–∏ –∞–¥—Ä–µ—Å—É –≤—Å—ñ—Ö —Å–∏–º–≤–æ–ª—ñ–≤ –∑ CoreNLP</td></tr></tbody></table>

{% hint style="info" %}
–ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó **`objc_sendMsg`** —Ä–µ–≥—ñ—Å—Ç—Ä **rsi** –º—ñ—Å—Ç–∏—Ç—å **–Ω–∞–∑–≤—É –º–µ—Ç–æ–¥—É** —è–∫ —Ä—è–¥–æ–∫ –∑ –Ω—É–ª—å–æ–≤–∏–º –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è–º (‚ÄúC‚Äù). –©–æ–± –Ω–∞–¥—Ä—É–∫—É–≤–∞—Ç–∏ –Ω–∞–∑–≤—É —á–µ—Ä–µ–∑ lldb, –≤–∏–∫–æ–Ω–∞–π—Ç–µ:

`(lldb) x/s $rsi: 0x1000f1576: "startMiningWithPort:password:coreCount:slowMemory:currency:"`

`(lldb) print (char*)$rsi:`\
`(char *) $1 = 0x00000001000f1576 "startMiningWithPort:password:coreCount:slowMemory:currency:"`

`(lldb) reg read $rsi: rsi = 0x00000001000f1576 "startMiningWithPort:password:coreCount:slowMemory:currency:"`
{% endhint %}

### –ê–Ω—Ç–∏-–¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑

#### –í–∏—è–≤–ª–µ–Ω–Ω—è VM

* –ö–æ–º–∞–Ω–¥–∞ **`sysctl hw.model`** –ø–æ–≤–µ—Ä—Ç–∞—î "Mac", –∫–æ–ª–∏ **—Ö–æ—Å—Ç —î MacOS**, –∞–ª–µ —â–æ—Å—å —ñ–Ω—à–µ, –∫–æ–ª–∏ —Ü–µ VM.
* –ì—Ä–∞—é—á–∏ –∑ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ **`hw.logicalcpu`** —Ç–∞ **`hw.physicalcpu`**, –¥–µ—è–∫—ñ —à–∫—ñ–¥–ª–∏–≤—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –≤–∏—è–≤–∏—Ç–∏, —á–∏ —Ü–µ VM.
* –î–µ—è–∫—ñ —à–∫—ñ–¥–ª–∏–≤—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ —Ç–∞–∫–æ–∂ –º–æ–∂—É—Ç—å **–≤–∏—è–≤–∏—Ç–∏**, —á–∏ –º–∞—à–∏–Ω–∞ —î **VMware** –Ω–∞ –æ—Å–Ω–æ–≤—ñ MAC-–∞–¥—Ä–µ—Å–∏ (00:50:56).
* –¢–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, **—á–∏ –ø—Ä–æ—Ü–µ—Å –Ω–∞–ª–∞–≥–æ–¥–∂—É—î—Ç—å—Å—è** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä–æ—Å—Ç–æ–≥–æ –∫–æ–¥—É, —Ç–∞–∫–æ–≥–æ —è–∫:
* `if(P_TRACED == (info.kp_proc.p_flag & P_TRACED)){ //–ø—Ä–æ—Ü–µ—Å –Ω–∞–ª–∞–≥–æ–¥–∂—É—î—Ç—å—Å—è }`
* –í—ñ–Ω —Ç–∞–∫–æ–∂ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–∏–π –≤–∏–∫–ª–∏–∫ **`ptrace`** –∑ –ø—Ä–∞–ø–æ—Ä–æ–º **`PT_DENY_ATTACH`**. –¶–µ **–∑–∞–ø–æ–±—ñ–≥–∞—î** –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–Ω—é —Ç–∞ —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—é –Ω–∞–ª–∞–≥–æ–¥–∂—É–≤–∞—á–∞.
* –í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —Ñ—É–Ω–∫—Ü—ñ—è **`sysctl`** –∞–±–æ **`ptrace`** —ñ–º–ø–æ—Ä—Ç—É—î—Ç—å—Å—è (–∞–ª–µ —à–∫—ñ–¥–ª–∏–≤–µ –ü–ó –º–æ–∂–µ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —ó—ó –¥–∏–Ω–∞–º—ñ—á–Ω–æ)
* –Ø–∫ –∑–∞–∑–Ω–∞—á–µ–Ω–æ –≤ —Ü—å–æ–º—É –∑–≤—ñ—Ç—ñ, ‚Äú[Defeating Anti-Debug Techniques: macOS ptrace variants](https://alexomara.com/blog/defeating-anti-debug-techniques-macos-ptrace-variants/)‚Äù :\
‚Äú_–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è Process # exited with **status = 45 (0x0000002d)** –∑–∞–∑–≤–∏—á–∞–π —î —è–≤–Ω–æ—é –æ–∑–Ω–∞–∫–æ—é —Ç–æ–≥–æ, —â–æ —Ü—ñ–ª—å –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **PT\_DENY\_ATTACH**_‚Äù

## –Ø–¥—Ä–æ–≤—ñ –¥–∞–º–ø–∏

–Ø–¥—Ä–æ–≤—ñ –¥–∞–º–ø–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è, —è–∫—â–æ:

* `kern.coredump` sysctl –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 1 (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
* –Ø–∫—â–æ –ø—Ä–æ—Ü–µ—Å –Ω–µ –±—É–≤ suid/sgid –∞–±–æ `kern.sugid_coredump` –¥–æ—Ä—ñ–≤–Ω—é—î 1 (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 0)
* –õ—ñ–º—ñ—Ç `AS_CORE` –¥–æ–∑–≤–æ–ª—è—î –æ–ø–µ—Ä–∞—Ü—ñ—é. –ú–æ–∂–Ω–∞ –ø–æ–¥–∞–≤–∏—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∞–º–ø—ñ–≤ –∫–æ–¥—É, –≤–∏–∫–ª–∏–∫–∞–≤—à–∏ `ulimit -c 0` —ñ –∑–Ω–æ–≤—É —É–≤—ñ–º–∫–Ω—É—Ç–∏ —ó—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `ulimit -c unlimited`.

–£ —Ü–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö —è–¥—Ä–æ–≤—ñ –¥–∞–º–ø–∏ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ sysctl `kern.corefile` —ñ –∑–∞–∑–≤–∏—á–∞–π –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `/cores/core/.%P`.

## –§–∞–∑–∑–∏–Ω–≥

### [ReportCrash](https://ss64.com/osx/reportcrash.html)

ReportCrash **–∞–Ω–∞–ª—ñ–∑—É—î –ø—Ä–æ—Ü–µ—Å–∏, —â–æ –∑–∞–∑–Ω–∞–ª–∏ –∫—Ä–∞—Ö—É, —ñ –∑–±–µ—Ä—ñ–≥–∞—î –∑–≤—ñ—Ç –ø—Ä–æ –∫—Ä–∞—Ö –Ω–∞ –¥–∏—Å–∫**. –ó–≤—ñ—Ç –ø—Ä–æ –∫—Ä–∞—Ö –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —è–∫–∞ –º–æ–∂–µ **–¥–æ–ø–æ–º–æ–≥—Ç–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—É –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏** –ø—Ä–∏—á–∏–Ω—É –∫—Ä–∞—Ö—É.\
–î–ª—è –¥–æ–¥–∞—Ç–∫—ñ–≤ —Ç–∞ —ñ–Ω—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ **–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –∑–∞–ø—É—Å–∫—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, ReportCrash –ø—Ä–∞—Ü—é—î —è–∫ LaunchAgent —ñ –∑–±–µ—Ä—ñ–≥–∞—î –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∫—Ä–∞—Ö —É `~/Library/Logs/DiagnosticReports/` –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.\
–î–ª—è –¥–µ–º–æ–Ω—ñ–≤, —ñ–Ω—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ **–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É** —Ç–∞ —ñ–Ω—à–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, ReportCrash –ø—Ä–∞—Ü—é—î —è–∫ LaunchDaemon —ñ –∑–±–µ—Ä—ñ–≥–∞—î –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∫—Ä–∞—Ö —É `/Library/Logs/DiagnosticReports` —Å–∏—Å—Ç–µ–º–∏.

–Ø–∫—â–æ –≤–∏ —Ç—É—Ä–±—É—î—Ç–µ—Å—è –ø—Ä–æ –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∫—Ä–∞—Ö, **—è–∫—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –¥–æ Apple**, –≤–∏ –º–æ–∂–µ—Ç–µ —ó—Ö –≤–∏–º–∫–Ω—É—Ç–∏. –Ø–∫—â–æ –Ω—ñ, –∑–≤—ñ—Ç–∏ –ø—Ä–æ –∫—Ä–∞—Ö –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–∏–º–∏ –¥–ª—è **–∑'—è—Å—É–≤–∞–Ω–Ω—è, —è–∫ —Å–µ—Ä–≤–µ—Ä –∑–∞–∑–Ω–∞–≤ –∫—Ä–∞—Ö—É**.
```bash
#To disable crash reporting:
launchctl unload -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist

#To re-enable crash reporting:
launchctl load -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist
```
### –°–æ–Ω

–ü—ñ–¥ —á–∞—Å —Ñ—É–∑–∑–∏–Ω–≥—É –Ω–∞ MacOS –≤–∞–∂–ª–∏–≤–æ –Ω–µ –¥–æ–∑–≤–æ–ª—è—Ç–∏ Mac –∑–∞—Å–∏–Ω–∞—Ç–∏:

* systemsetup -setsleep Never
* pmset, –°–∏—Å—Ç–µ–º–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
* [KeepingYouAwake](https://github.com/newmarcel/KeepingYouAwake)

#### –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è SSH

–Ø–∫—â–æ –≤–∏ —Ñ—É–∑–∑–∏—Ç–µ —á–µ—Ä–µ–∑ SSH-–∑'—î–¥–Ω–∞–Ω–Ω—è, –≤–∞–∂–ª–∏–≤–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ —Å–µ—Å—ñ—è –Ω–µ –∑–∞–∫—Ä–∏—î—Ç—å—Å—è. –¢–æ–º—É –∑–º—ñ–Ω—ñ—Ç—å —Ñ–∞–π–ª sshd\_config –Ω–∞:

* TCPKeepAlive Yes
* ClientAliveInterval 0
* ClientAliveCountMax 0
```bash
sudo launchctl unload /System/Library/LaunchDaemons/ssh.plist
sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist
```
### Internal Handlers

**–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É**, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ **–æ–±—Ä–æ–±–∫—É –≤–∫–∞–∑–∞–Ω–æ—ó —Å—Ö–µ–º–∏ –∞–±–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É:**

{% content-ref url="../macos-file-extension-apps.md" %}
[macos-file-extension-apps.md](../macos-file-extension-apps.md)
{% endcontent-ref %}

### Enumerating Network Processes

–¶–µ —Ü—ñ–∫–∞–≤–æ, —â–æ–± –∑–Ω–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏, —è–∫—ñ –∫–µ—Ä—É—é—Ç—å –º–µ—Ä–µ–∂–µ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏:
```bash
dtrace -n 'syscall::recv*:entry { printf("-> %s (pid=%d)", execname, pid); }' >> recv.log
#wait some time
sort -u recv.log > procs.txt
cat procs.txt
```
–ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `netstat` –∞–±–æ `lsof`

### Libgmalloc

<figure><img src="../../../.gitbook/assets/Pasted Graphic 14.png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```bash
lldb -o "target create `which some-binary`" -o "settings set target.env-vars DYLD_INSERT_LIBRARIES=/usr/lib/libgmalloc.dylib" -o "run arg1 arg2" -o "bt" -o "reg read" -o "dis -s \$pc-32 -c 24 -m -F intel" -o "quit"
```
{% endcode %}

### Fuzzers

#### [AFL++](https://github.com/AFLplusplus/AFLplusplus)

–ü—Ä–∞—Ü—é—î –¥–ª—è CLI —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤

#### [Litefuzz](https://github.com/sec-tools/litefuzz)

–í—ñ–Ω "**–ø—Ä–æ—Å—Ç–æ –ø—Ä–∞—Ü—é—î"** –∑ macOS GUI —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–µ—è–∫—ñ macOS –¥–æ–¥–∞—Ç–∫–∏ –º–∞—é—Ç—å —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –≤–∏–º–æ–≥–∏, —Ç–∞–∫—ñ —è–∫ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ —ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤, –ø—Ä–∞–≤–∏–ª—å–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è, –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —á–∏—Ç–∞—Ç–∏ —Ñ–∞–π–ª–∏ –∑ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ (`~/Library/Containers/com.apple.Safari/Data`)...

–î–µ—è–∫—ñ –ø—Ä–∏–∫–ª–∞–¥–∏:

{% code overflow="wrap" %}
```bash
# iBooks
litefuzz -l -c "/System/Applications/Books.app/Contents/MacOS/Books FUZZ" -i files/epub -o crashes/ibooks -t /Users/test/Library/Containers/com.apple.iBooksX/Data/tmp -x 10 -n 100000 -ez

# -l : Local
# -c : cmdline with FUZZ word (if not stdin is used)
# -i : input directory or file
# -o : Dir to output crashes
# -t : Dir to output runtime fuzzing artifacts
# -x : Tmeout for the run (default is 1)
# -n : Num of fuzzing iterations (default is 1)
# -e : enable second round fuzzing where any crashes found are reused as inputs
# -z : enable malloc debug helpers

# Font Book
litefuzz -l -c "/System/Applications/Font Book.app/Contents/MacOS/Font Book FUZZ" -i input/fonts -o crashes/font-book -x 2 -n 500000 -ez

# smbutil (using pcap capture)
litefuzz -lk -c "smbutil view smb://localhost:4455" -a tcp://localhost:4455 -i input/mac-smb-resp -p -n 100000 -z

# screensharingd (using pcap capture)
litefuzz -s -a tcp://localhost:5900 -i input/screenshared-session --reportcrash screensharingd -p -n 100000
```
{% endcode %}

### –ë—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ Fuzzing MacOS

* [https://www.youtube.com/watch?v=T5xfL9tEg44](https://www.youtube.com/watch?v=T5xfL9tEg44)
* [https://github.com/bnagy/slides/blob/master/OSXScale.pdf](https://github.com/bnagy/slides/blob/master/OSXScale.pdf)
* [https://github.com/bnagy/francis/tree/master/exploitaben](https://github.com/bnagy/francis/tree/master/exploitaben)
* [https://github.com/ant4g0nist/crashwrangler](https://github.com/ant4g0nist/crashwrangler)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [**OS X Incident Response: Scripting and Analysis**](https://www.amazon.com/OS-Incident-Response-Scripting-Analysis-ebook/dp/B01FHOHHVS)
* [**https://www.youtube.com/watch?v=T5xfL9tEg44**](https://www.youtube.com/watch?v=T5xfL9tEg44)
* [**https://taomm.org/vol1/analysis.html**](https://taomm.org/vol1/analysis.html)
* [**The Art of Mac Malware: The Guide to Analyzing Malicious Software**](https://taomm.org/)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) —î **–ø–æ—à—É–∫–æ–≤–æ—é —Å–∏—Å—Ç–µ–º–æ—é** –Ω–∞ –æ—Å–Ω–æ–≤—ñ **—Ç–µ–º–Ω–æ–≥–æ –≤–µ–±—É**, —è–∫–∞ –ø—Ä–æ–ø–æ–Ω—É—î **–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ** —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ –±—É–ª–∞ –∫–æ–º–ø–∞–Ω—ñ—è –∞–±–æ —ó—ó –∫–ª—ñ—î–Ω—Ç–∏ **—Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω—ñ** **—à–∫—ñ–¥–ª–∏–≤–∏–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞–º–∏-–∫—Ä–∞–¥—ñ—è–º–∏**.

–û—Å–Ω–æ–≤–Ω–æ—é –º–µ—Ç–æ—é WhiteIntel —î –±–æ—Ä–æ—Ç—å–±–∞ –∑ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è–º –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Ç–∞ –∞—Ç–∞–∫–∞–º–∏ –ø—Ä–æ–≥—Ä–∞–º-–≤–∏–º–∞–≥–∞—á—ñ–≤, —â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –≤–Ω–∞—Å–ª—ñ–¥–æ–∫ —à–∫—ñ–¥–ª–∏–≤–∏—Ö –ø—Ä–æ–≥—Ä–∞–º, —è–∫—ñ –∫—Ä–∞–¥—É—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ó—Ö–Ω—ñ–π –≤–µ–±—Å–∞–π—Ç —ñ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ó—Ö–Ω—ñ–π –¥–≤–∏–≥—É–Ω **–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ** –∑–∞ –∞–¥—Ä–µ—Å–æ—é:

{% embed url="https://whiteintel.io" %}

{% hint style="success" %}
–í—á—ñ—Ç—å—Å—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ Hacking AWS:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
–í—á—ñ—Ç—å—Å—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ Hacking GCP: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
