# ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î£ÏÎ½Î´ÎµÏƒÎ·Ï‚ Î”Î¹ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ XPC ÏƒÏ„Î¿ macOS

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº Ï„Î¿Ï… AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs** ÏƒÏ„Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ÏƒÏ„Î¿ github.

</details>

## ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î£ÏÎ½Î´ÎµÏƒÎ·Ï‚ Î”Î¹ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ XPC

ÎŒÏ„Î±Î½ Î³Î¯Î½ÎµÏ„Î±Î¹ Î¼Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÎµ Î­Î½Î± XPC service, Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ Î¸Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Î±Î½ Î· ÏƒÏÎ½Î´ÎµÏƒÎ· ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹. Î‘Ï…Ï„Î¿Î¯ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ Î­Î»ÎµÎ³Ï‡Î¿Î¹ Ï€Î¿Ï… ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹:

1. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Î· ÏƒÏ…Î½Î´ÎµÏŒÎ¼ÎµÎ½Î· **Î´Î¹ÎµÏÎ³Î±ÏƒÎ¯Î± Î­Ï‡ÎµÎ¹ Ï…Ï€Î¿Î³ÏÎ±Ï†ÎµÎ¯ Î¼Îµ Î­Î½Î± Apple-signed Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÏŒ** (Ï€Î¿Ï… Î´Î¯Î½ÎµÏ„Î±Î¹ Î¼ÏŒÎ½Î¿ Î±Ï€ÏŒ Ï„Î·Î½ Apple).
* Î•Î¬Î½ Î±Ï…Ï„ÏŒ **Î´ÎµÎ½ ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Ï„ÎµÎ¯**, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± **ÏˆÎµÏÏ„Î¹ÎºÎ¿ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÏŒ** Î³Î¹Î± Î½Î± Ï„Î±Î¹ÏÎ¹Î¬Î¾ÎµÎ¹ Î¼Îµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Î¬Î»Î»Î¿ Î­Î»ÎµÎ³Ï‡Î¿.
2. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Î· ÏƒÏ…Î½Î´ÎµÏŒÎ¼ÎµÎ½Î· Î´Î¹ÎµÏÎ³Î±ÏƒÎ¯Î± Î­Ï‡ÎµÎ¹ Ï…Ï€Î¿Î³ÏÎ±Ï†ÎµÎ¯ Î¼Îµ Ï„Î¿ **Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÏŒ Ï„Î¿Ï… Î¿ÏÎ³Î±Î½Î¹ÏƒÎ¼Î¿Ï** (Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚ Ï„Î¿Ï… Î¿Î¼Î¬Î´Î±Ï‚).
* Î•Î¬Î½ Î±Ï…Ï„ÏŒ **Î´ÎµÎ½ ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Ï„ÎµÎ¯**, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÏŒ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚ Î±Ï€ÏŒ Ï„Î·Î½ Apple Î³Î¹Î± Ï„Î·Î½ Ï…Ï€Î¿Î³ÏÎ±Ï†Î® ÎºÎ±Î¹ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±.
3. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Î· ÏƒÏ…Î½Î´ÎµÏŒÎ¼ÎµÎ½Î· Î´Î¹ÎµÏÎ³Î±ÏƒÎ¯Î± **Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î­Î½Î±Î½ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î¿ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï€Î±ÎºÎ­Ï„Î¿Ï…**.
* Î•Î¬Î½ Î±Ï…Ï„ÏŒ **Î´ÎµÎ½ ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Ï„ÎµÎ¯**, Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ **Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ Ï…Ï€Î¿Î³ÏÎ±Ï†ÎµÎ¯ Î±Ï€ÏŒ Ï„Î¿Î½ Î¯Î´Î¹Î¿ Î¿ÏÎ³Î±Î½Î¹ÏƒÎ¼ÏŒ** Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Ï„Î·Î½ Î±Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Î¼Îµ Ï„Î·Î½ XPC Ï…Ï€Î·ÏÎµÏƒÎ¯Î±.
4. (4 Î® 5) ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Î· ÏƒÏ…Î½Î´ÎµÏŒÎ¼ÎµÎ½Î· Î´Î¹ÎµÏÎ³Î±ÏƒÎ¯Î± Î­Ï‡ÎµÎ¹ Î­Î½Î±Î½ **ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î¿ Î±ÏÎ¹Î¸Î¼ÏŒ Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÎ¿Ï**.
* Î•Î¬Î½ Î±Ï…Ï„ÏŒ **Î´ÎµÎ½ ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Ï„ÎµÎ¯**, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¼Î¹Î± Ï€Î±Î»Î¹Î¬, ÎµÏ…Î¬Î»Ï‰Ï„Î· Ï€ÎµÎ»Î¬Ï„Î·Ï‚ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î· ÏƒÏ„Î·Î½ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚ Î´Î¹ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ Î¼Îµ Ï„Î·Î½ XPC Ï…Ï€Î·ÏÎµÏƒÎ¯Î±, Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î¼Îµ Ï„Î¿Ï…Ï‚ Î¬Î»Î»Î¿Ï…Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î³Î¯Î½ÎµÎ¹.
5. (4 Î® 5) ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Î· ÏƒÏ…Î½Î´ÎµÏŒÎ¼ÎµÎ½Î· Î´Î¹ÎµÏÎ³Î±ÏƒÎ¯Î± Î­Ï‡ÎµÎ¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Ï„Î¿ hardened runtime Ï‡Ï‰ÏÎ¯Ï‚ ÎµÏ€Î¹ÎºÎ¯Î½Î´Ï…Î½Î± entitlements (ÏŒÏ€Ï‰Ï‚ Î±Ï…Ï„Î¬ Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Ï„Î· Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î±Ï…Î¸Î±Î¯ÏÎµÏ„Ï‰Î½ Î²Î¹Î²Î»Î¹Î¿Î¸Î·ÎºÏÎ½ Î® Ï„Î· Ï‡ÏÎ®ÏƒÎ· Î¼ÎµÏ„Î±Î²Î»Î·Ï„ÏÎ½ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ DYLD)
1. Î•Î¬Î½ Î±Ï…Ï„ÏŒ **Î´ÎµÎ½ ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Ï„ÎµÎ¯**, Î¿ Ï€ÎµÎ»Î¬Ï„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ **ÎµÏ…Î¬Î»Ï‰Ï„Î¿Ï‚ ÏƒÎµ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® ÎºÏÎ´Î¹ÎºÎ±**
6. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Î· ÏƒÏ…Î½Î´ÎµÏŒÎ¼ÎµÎ½Î· Î´Î¹ÎµÏÎ³Î±ÏƒÎ¯Î± Î­Ï‡ÎµÎ¹ Î­Î½Î± **entitlement** Ï€Î¿Ï… Ï„Î·Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ ÏƒÏ„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±. Î‘Ï…Ï„ÏŒ Î¹ÏƒÏ‡ÏÎµÎ¹ Î³Î¹Î± Ï„Î± Î´Ï…Î±Î´Î¹ÎºÎ¬ Î±ÏÏ‡ÎµÎ¯Î± Ï„Î·Ï‚ Apple.
7. Î— **ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·** Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î³Î¯Î½ÎµÏ„Î±Î¹ **Î²Î¬ÏƒÎµÎ¹** Ï„Î¿Ï… **Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÎ¿Ï ÎµÎ»Î­Î³Ï‡Î¿Ï… Ï„Î¿Ï… Ï€ÎµÎ»Î¬Ï„Î·** Î±Î½Ï„Î¯ Î³Î¹Î± Ï„Î¿ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Î´Î¹ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ (**PID**), ÎºÎ±Î¸ÏÏ‚ Ï„Î¿ Ï€ÏÏÏ„Î¿ Î±Ï€Î¿Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î¹Ï‚ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ ÎµÏ€Î±Î½Î±Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… PID.
* ÎŸÎ¹ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚ **ÏƒÏ€Î¬Î½Î¹Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ Ï„Î·Î½ ÎºÎ»Î®ÏƒÎ· API Ï„Î¿Ï… Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÎ¿Ï ÎµÎ»Î­Î³Ï‡Î¿Ï…** ÎºÎ±Î¸ÏÏ‚ ÎµÎ¯Î½Î±Î¹ **Î¹Î´Î¹Ï‰Ï„Î¹ÎºÎ®**, Î¿Ï€ÏŒÏ„Îµ Î· Apple Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î·Î½ **Î±Î»Î»Î¬Î¾ÎµÎ¹** Î±Î½Î¬ Ï€Î¬ÏƒÎ± ÏƒÏ„Î¹Î³Î¼Î®. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î· Ï‡ÏÎ®ÏƒÎ· Î¹Î´Î¹Ï‰Ï„Î¹ÎºÎ®Ï‚ API Î´ÎµÎ½ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ ÏƒÎµ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Ï„Î¿Ï… Mac App Store.
* Î•Î¬Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ **`processIdentifier`**, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î·
* Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ **`xpc_dictionary_get_audit_token`** Î±Î½Ï„Î¯ Ï„Î·Ï‚ **`xpc_connection_get_audit_token`**, ÎºÎ±Î¸ÏÏ‚ Î· Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î¼Ï€Î¿ÏÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± ÎµÎ¯Î½Î±Î¹ [ÎµÏ…Î¬Î»Ï‰Ï„Î· ÏƒÎµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚](https://sector7.computest.nl/post/2023-10-xpc-audit-token-spoofing/).

### Î•Ï€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î·Î½ ÎµÏ€Î¯Î¸ÎµÏƒÎ· ÎµÏ€Î±Î½Î±Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… PID, ÎµÎ»Î­Î³Î¾Ï„Îµ:

{% content-ref url="macos-pid-reuse.md" %}
[macos-pid-reuse.md](macos-pid-reuse.md)
{% endcontent-ref %}

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿Ï
```objectivec
- (BOOL)listener:(NSXPCListener *)listener shouldAcceptNewConnection:(NSXPCConnection *)newConnection {
//Check connection
return YES;
}
```
{% endcode %}

Î¤Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ NSXPCConnection Î­Ï‡ÎµÎ¹ Î¼Î¹Î± **Î¹Î´Î¹Ï‰Ï„Î¹ÎºÎ®** Î¹Î´Î¹ÏŒÏ„Î·Ï„Î± **`auditToken`** (Î±Ï…Ï„Î® Ï€Î¿Ï… Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î±Î»Î»Î¬ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹) ÎºÎ±Î¹ Î¼Î¹Î± **Î´Î·Î¼ÏŒÏƒÎ¹Î±** Î¹Î´Î¹ÏŒÏ„Î·Ï„Î± **`processIdentifier`** (Î±Ï…Ï„Î® Ï€Î¿Ï… Î´ÎµÎ½ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯).

Î— Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Ï„ÎµÎ¯ Î¼Îµ ÎºÎ¬Ï„Î¹ ÏŒÏ€Ï‰Ï‚:

{% code overflow="wrap" %}
```objectivec
[...]
SecRequirementRef requirementRef = NULL;
NSString requirementString = @"anchor apple generic and identifier \"xyz.hacktricks.service\" and certificate leaf [subject.CN] = \"TEAMID\" and info [CFBundleShortVersionString] >= \"1.0\"";
/* Check:
- Signed by a cert signed by Apple
- Check the bundle ID
- Check the TEAMID of the signing cert
- Check the version used
*/

// Check the requirements with the PID (vulnerable)
SecRequirementCreateWithString(requirementString, kSecCSDefaultFlags, &requirementRef);
SecCodeCheckValidity(code, kSecCSDefaultFlags, requirementRef);

// Check the requirements wuing the auditToken (secure)
SecTaskRef taskRef = SecTaskCreateWithAuditToken(NULL, ((ExtendedNSXPCConnection*)newConnection).auditToken);
SecTaskValidateForRequirement(taskRef, (__bridge CFStringRef)(requirementString))
```
{% endcode %}

Î‘Î½ Î­Î½Î±Ï‚ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÏ„Î®Ï‚ Î´ÎµÎ½ Î¸Î­Î»ÎµÎ¹ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… Ï€ÎµÎ»Î¬Ï„Î·, Î¼Ï€Î¿ÏÎµÎ¯ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ ÏŒÏ„Î¹ Î¿ Ï€ÎµÎ»Î¬Ï„Î·Ï‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î¿Ï‚ ÏƒÏ„Î·Î½ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚ Î´Î¹ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚:

{% code overflow="wrap" %}
```objectivec
[...]
CFDictionaryRef csInfo = NULL;
SecCodeCopySigningInformation(code, kSecCSDynamicInformation, &csInfo);
uint32_t csFlags = [((__bridge NSDictionary *)csInfo)[(__bridge NSString *)kSecCodeInfoStatus] intValue];
const uint32_t cs_hard = 0x100;        // don't load invalid page.
const uint32_t cs_kill = 0x200;        // Kill process if page is invalid
const uint32_t cs_restrict = 0x800;    // Prevent debugging
const uint32_t cs_require_lv = 0x2000; // Library Validation
const uint32_t cs_runtime = 0x10000;   // hardened runtime
if ((csFlags & (cs_hard | cs_require_lv)) {
return Yes; // Accept connection
}
```
{% endcode %}

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>
