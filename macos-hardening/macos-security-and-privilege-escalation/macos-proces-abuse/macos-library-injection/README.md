# macOS Library Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

{% hint style="danger" %}
–ö–æ–¥ **dyld —î –≤—ñ–¥–∫—Ä–∏—Ç–∏–º** —ñ –π–æ–≥–æ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∑–∞ –∞–¥—Ä–µ—Å–æ—é [https://opensource.apple.com/source/dyld/](https://opensource.apple.com/source/dyld/) —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ tar, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **URL, —Ç–∞–∫–∏–π —è–∫** [https://opensource.apple.com/tarballs/dyld/dyld-852.2.tar.gz](https://opensource.apple.com/tarballs/dyld/dyld-852.2.tar.gz)
{% endhint %}

## **Dyld Process**

–ü–æ–¥–∏–≤—ñ—Ç—å—Å—è, —è–∫ Dyld –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ —É:

{% content-ref url="macos-dyld-process.md" %}
[macos-dyld-process.md](macos-dyld-process.md)
{% endcontent-ref %}

## **DYLD\_INSERT\_LIBRARIES**

–¶–µ —Å—Ö–æ–∂–µ –Ω–∞ [**LD\_PRELOAD –Ω–∞ Linux**](../../../../linux-hardening/privilege-escalation/#ld\_preload). –¶–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∫–∞–∑–∞—Ç–∏ –ø—Ä–æ—Ü–µ—Å, —è–∫–∏–π –±—É–¥–µ –∑–∞–ø—É—â–µ–Ω–æ, —â–æ–± –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –∑ —à–ª—è—Ö—É (—è–∫—â–æ –∑–º—ñ–Ω–Ω–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ —É–≤—ñ–º–∫–Ω–µ–Ω–∞)

–¶—é —Ç–µ—Ö–Ω—ñ–∫—É —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —è–∫ —Ç–µ—Ö–Ω—ñ–∫—É ASEP**, –æ—Å–∫—ñ–ª—å–∫–∏ –∫–æ–∂–µ–Ω –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ –º–∞—î plist –ø—ñ–¥ –Ω–∞–∑–≤–æ—é "Info.plist", —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î **–ø—Ä–∏–∑–Ω–∞—á–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–ª—é—á–∞ `LSEnvironmental`.

{% hint style="info" %}
–ó 2012 —Ä–æ–∫—É **Apple —Ä—ñ–∑–∫–æ –∑–º–µ–Ω—à–∏–ª–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ** **`DYLD_INSERT_LIBRARIES`**.

–ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –∫–æ–¥—É —Ç–∞ **–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ `src/dyld.cpp`**. –£ —Ñ—É–Ω–∫—Ü—ñ—ó **`pruneEnvironmentVariables`** –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —â–æ **`DYLD_*`** –∑–º—ñ–Ω–Ω—ñ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è.

–£ —Ñ—É–Ω–∫—Ü—ñ—ó **`processRestricted`** –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏—á–∏–Ω–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏ —Ü–µ–π –∫–æ–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —â–æ –ø—Ä–∏—á–∏–Ω–∏ —Ç–∞–∫—ñ:

* –ë—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª —î `setuid/setgid`
* –ù–∞—è–≤–Ω—ñ—Å—Ç—å —Å–µ–∫—Ü—ñ—ó `__RESTRICT/__restrict` —É –±—ñ–Ω–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—ñ macho.
* –ü—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –º–∞—î –ø—Ä–∞–≤–∞ (–ø–æ—Å–∏–ª–µ–Ω–∞ —Å–µ—Ä–µ–¥–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è) –±–µ–∑ –ø—Ä–∞–≤ [`com.apple.security.cs.allow-dyld-environment-variables`](https://developer.apple.com/documentation/bundleresources/entitlements/com\_apple\_security\_cs\_allow-dyld-environment-variables)
* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **–ø—Ä–∞–≤–∞** –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `codesign -dv --entitlements :- </path/to/bin>`

–£ –±—ñ–ª—å—à –Ω–æ–≤–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ü—é –ª–æ–≥—ñ–∫—É –≤ –¥—Ä—É–≥—ñ–π —á–∞—Å—Ç–∏–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó **`configureProcessRestrictions`.** –û–¥–Ω–∞–∫ —Ç–µ, —â–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ –Ω–æ–≤—ñ—à–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö, —î **–ø–æ—á–∞—Ç–∫–æ–≤–∏–º–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞–º–∏ —Ñ—É–Ω–∫—Ü—ñ—ó** (–≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ if, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ iOS –∞–±–æ –µ–º—É–ª—è—Ü—ñ—î—é, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –Ω–µ –±—É–¥—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –≤ macOS.
{% endhint %}

### Library Validation

–ù–∞–≤—ñ—Ç—å —è–∫—â–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ **`DYLD_INSERT_LIBRARIES`**, —è–∫—â–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø—ñ–¥–ø–∏—Å –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –≤—ñ–Ω –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É.

–©–æ–± –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Å—Ç–æ–º–Ω—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É, –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –ø–æ–≤–∏–Ω–µ–Ω –º–∞—Ç–∏ **–æ–¥–Ω–µ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –ø—Ä–∞–≤**:

* [`com.apple.security.cs.disable-library-validation`](../../macos-security-protections/macos-dangerous-entitlements.md#com.apple.security.cs.disable-library-validation)
* [`com.apple.private.security.clear-library-validation`](../../macos-security-protections/macos-dangerous-entitlements.md#com.apple.private.security.clear-library-validation)

–∞–±–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª **–Ω–µ –ø–æ–≤–∏–Ω–µ–Ω** –º–∞—Ç–∏ **–ø—Ä–∞–ø–æ—Ä –ø–æ—Å–∏–ª–µ–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è** –∞–±–æ **–ø—Ä–∞–ø–æ—Ä –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫**.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–∞—î –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª **–ø–æ—Å–∏–ª–µ–Ω—É —Å–µ—Ä–µ–¥—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `codesign --display --verbose <bin>`, –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏ –ø—Ä–∞–ø–æ—Ä runtime —É **`CodeDirectory`** —Ç–∞–∫: **`CodeDirectory v=20500 size=767 flags=0x10000(runtime) hashes=13+7 location=embedded`**

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É, —è–∫—â–æ –≤–æ–Ω–∞ **–ø—ñ–¥–ø–∏—Å–∞–Ω–∞ —Ç–∏–º –∂–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º, —â–æ –π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª**.

–ó–Ω–∞–π–¥—ñ—Ç—å –ø—Ä–∏–∫–ª–∞–¥, —è–∫ (–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏) —Ü–∏–º —ñ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ–±–º–µ–∂–µ–Ω–Ω—è –≤:

{% content-ref url="macos-dyld-hijacking-and-dyld_insert_libraries.md" %}
[macos-dyld-hijacking-and-dyld\_insert\_libraries.md](macos-dyld-hijacking-and-dyld\_insert\_libraries.md)
{% endcontent-ref %}

## Dylib Hijacking

{% hint style="danger" %}
–ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ **–ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫ —Ç–∞–∫–æ–∂ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è** –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∞—Ç–∞–∫ –Ω–∞ –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è Dylib.
{% endhint %}

–Ø–∫ —ñ –≤ Windows, –≤ MacOS –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ **–≤–∏–∫—Ä–∞–¥–∞—Ç–∏ dylibs**, —â–æ–± –∑–º—É—Å–∏—Ç–∏ **–¥–æ–¥–∞—Ç–∫–∏** **–≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏** **–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∏–π** **–∫–æ–¥** (–Ω–∞—Å–ø—Ä–∞–≤–¥—ñ, –∑ –±–æ–∫—É –∑–≤–∏—á–∞–π–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ–º–æ–∂–ª–∏–≤–æ, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∞–º –º–æ–∂–µ –∑–Ω–∞–¥–æ–±–∏—Ç–∏—Å—è –¥–æ–∑–≤—ñ–ª TCC, —â–æ–± –∑–∞–ø–∏—Å–∞—Ç–∏ –≤ –ø–∞–∫–µ—Ç `.app` —ñ –≤–∏–∫—Ä–∞—Å—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É).\
–û–¥–Ω–∞–∫ —Å–ø–æ—Å—ñ–±, —è–∫–∏–º **–¥–æ–¥–∞—Ç–∫–∏ MacOS** **–∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å** –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, —î **–±—ñ–ª—å—à –æ–±–º–µ–∂–µ–Ω–∏–º**, –Ω—ñ–∂ —É Windows. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ **—Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∏ —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ –ü–ó** –≤—Å–µ —â–µ –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É –¥–ª—è **–ø—Ä–∏—Ö–æ–≤–∞–Ω–æ—Å—Ç—ñ**, –∞–ª–µ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ –≤–æ–Ω–∏ –∑–º–æ–∂—É—Ç—å **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü–∏–º –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤, –∑–Ω–∞—á–Ω–æ –Ω–∏–∂—á–∞**.

–ü–æ-–ø–µ—Ä—à–µ, **–±—ñ–ª—å—à –ø–æ—à–∏—Ä–µ–Ω–æ** –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏, —â–æ **–±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ MacOS –≤–∫–∞–∑—É—é—Ç—å –ø–æ–≤–Ω–∏–π —à–ª—è—Ö** –¥–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –ü–æ-–¥—Ä—É–≥–µ, **MacOS –Ω—ñ–∫–æ–ª–∏ –Ω–µ —à—É–∫–∞—î** –≤ –ø–∞–ø–∫–∞—Ö **$PATH** –¥–ª—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫.

**–û—Å–Ω–æ–≤–Ω–∞** —á–∞—Å—Ç–∏–Ω–∞ **–∫–æ–¥—É**, –ø–æ–≤'—è–∑–∞–Ω–∞ –∑ —Ü—ñ—î—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—é, –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ **`ImageLoader::recursiveLoadLibraries`** —É `ImageLoader.cpp`.

–Ü—Å–Ω—É—î **4 —Ä—ñ–∑–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞**, —è–∫—ñ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª macho –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫:

* **`LC_LOAD_DYLIB`** –∫–æ–º–∞–Ω–¥–∞ —î –∑–≤–∏—á–∞–π–Ω–æ—é –∫–æ–º–∞–Ω–¥–æ—é –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è dylib.
* **`LC_LOAD_WEAK_DYLIB`** –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–∞—Ü—é—î —è–∫ –ø–æ–ø–µ—Ä–µ–¥–Ω—è, –∞–ª–µ —è–∫—â–æ dylib –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–¥–æ–≤–∂—É—î—Ç—å—Å—è –±–µ–∑ –∂–æ–¥–Ω–æ—ó –ø–æ–º–∏–ª–∫–∏.
* **`LC_REEXPORT_DYLIB`** –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–∫—Å—ñ (–∞–±–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –µ–∫—Å–ø–æ—Ä—Ç—É—î) —Å–∏–º–≤–æ–ª–∏ –∑ —ñ–Ω—à–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏.
* **`LC_LOAD_UPWARD_DYLIB`** –∫–æ–º–∞–Ω–¥–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è, –∫–æ–ª–∏ –¥–≤—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –∑–∞–ª–µ–∂–∞—Ç—å –æ–¥–Ω–∞ –≤—ñ–¥ –æ–¥–Ω–æ—ó (—Ü–µ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è _–≤–≥–æ—Ä—É –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—é_).

–û–¥–Ω–∞–∫ —ñ—Å–Ω—É—î **2 —Ç–∏–ø–∏ –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è dylib**:

* **–í—ñ–¥—Å—É—Ç–Ω—ñ —Å–ª–∞–±–∫–æ –ø–æ–≤'—è–∑–∞–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**: –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –¥–æ–¥–∞—Ç–æ–∫ —Å–ø—Ä–æ–±—É—î –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É, —è–∫–∞ –Ω–µ —ñ—Å–Ω—É—î, –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—É –∑ **LC\_LOAD\_WEAK\_DYLIB**. –¢–æ–¥—ñ, **—è–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –ø–æ–º—ñ—Å—Ç–∏—Ç—å dylib —Ç—É–¥–∏, –¥–µ —ó—ó –æ—á—ñ–∫—É—é—Ç—å, –≤–æ–Ω–∞ –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞**.
* –¢–æ–π —Ñ–∞–∫—Ç, —â–æ –∑–≤'—è–∑–æ–∫ "—Å–ª–∞–±–∫–∏–π", –æ–∑–Ω–∞—á–∞—î, —â–æ –¥–æ–¥–∞—Ç–æ–∫ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞.
* **–ö–æ–¥, –ø–æ–≤'—è–∑–∞–Ω–∏–π** –∑ —Ü–∏–º, –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —É —Ñ—É–Ω–∫—Ü—ñ—ó `ImageLoaderMachO::doGetDependentLibraries` —É `ImageLoaderMachO.cpp`, –¥–µ `lib->required` —î –ª–∏—à–µ `false`, –∫–æ–ª–∏ `LC_LOAD_WEAK_DYLIB` —î true.
* **–ó–Ω–∞–π–¥—ñ—Ç—å —Å–ª–∞–±–∫–æ –ø–æ–≤'—è–∑–∞–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏** —É –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª–∞—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é (—É –≤–∞—Å –ø—ñ–∑–Ω—ñ—à–µ –±—É–¥–µ –ø—Ä–∏–∫–ª–∞–¥, —è–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –¥–ª—è –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è):
* ```bash
otool -l </path/to/bin> | grep LC_LOAD_WEAK_DYLIB -A 5 cmd LC_LOAD_WEAK_DYLIB
cmdsize 56
name /var/tmp/lib/libUtl.1.dylib (offset 24)
time stamp 2 Wed Jun 21 12:23:31 1969
current version 1.0.0
compatibility version 1.0.0
```
* **–ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –∑ @rpath**: –ë—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ Mach-O –º–æ–∂—É—Ç—å –º–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ **`LC_RPATH`** —Ç–∞ **`LC_LOAD_DYLIB`**. –í–∏—Ö–æ–¥—è—á–∏ –∑ **–∑–Ω–∞—á–µ–Ω—å** —Ü–∏—Ö –∫–æ–º–∞–Ω–¥, **–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏** –±—É–¥—É—Ç—å **–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ** –∑ **—Ä—ñ–∑–Ω–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π**.
* **`LC_RPATH`** –º—ñ—Å—Ç–∏—Ç—å —à–ª—è—Ö–∏ –¥–æ –¥–µ—è–∫–∏—Ö –ø–∞–ø–æ–∫, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –±—ñ–Ω–∞—Ä–Ω–∏–º —Ñ–∞–π–ª–æ–º.
* **`LC_LOAD_DYLIB`** –º—ñ—Å—Ç–∏—Ç—å —à–ª—è—Ö –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –¶—ñ —à–ª—è—Ö–∏ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ **`@rpath`**, —è–∫–∏–π –±—É–¥–µ **–∑–∞–º—ñ–Ω–µ–Ω–∏–π** –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –≤ **`LC_RPATH`**. –Ø–∫—â–æ –≤ **`LC_RPATH`** —î –∫—ñ–ª—å–∫–∞ —à–ª—è—Ö—ñ–≤, –≤—Å—ñ –≤–æ–Ω–∏ –±—É–¥—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è –ø–æ—à—É–∫—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –ü—Ä–∏–∫–ª–∞–¥:
* –Ø–∫—â–æ **`LC_LOAD_DYLIB`** –º—ñ—Å—Ç–∏—Ç—å `@rpath/library.dylib`, –∞ **`LC_RPATH`** –º—ñ—Å—Ç–∏—Ç—å `/application/app.app/Contents/Framework/v1/` —Ç–∞ `/application/app.app/Contents/Framework/v2/`. –û–±–∏–¥–≤—ñ –ø–∞–ø–∫–∏ –±—É–¥—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è `library.dylib`**.** –Ø–∫—â–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –Ω–µ —ñ—Å–Ω—É—î –≤ `[...]/v1/`, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –ø–æ–º—ñ—Å—Ç–∏—Ç–∏ —ó—ó —Ç—É–¥–∏, —â–æ–± –≤–∏–∫—Ä–∞—Å—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –≤ `[...]/v2/`, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–æ—Ä—è–¥–æ–∫ —à–ª—è—Ö—ñ–≤ —É **`LC_LOAD_DYLIB`** –¥–æ—Ç—Ä–∏–º—É—î—Ç—å—Å—è.
* **–ó–Ω–∞–π–¥—ñ—Ç—å —à–ª—è—Ö–∏ rpath —Ç–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏** —É –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª–∞—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `otool -l </path/to/binary> | grep -E "LC_RPATH|LC_LOAD_DYLIB" -A 5`

{% hint style="info" %}
**`@executable_path`**: –¶–µ **—à–ª—è—Ö** –¥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó, —â–æ –º—ñ—Å—Ç–∏—Ç—å **–æ—Å–Ω–æ–≤–Ω–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª**.

**`@loader_path`**: –¶–µ **—à–ª—è—Ö** –¥–æ **–¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó**, —â–æ –º—ñ—Å—Ç–∏—Ç—å **Mach-O –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª**, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.

* –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–º—É —Ñ–∞–π–ª—ñ, **`@loader_path`** —Ñ–∞–∫—Ç–∏—á–Ω–æ —î **—Ç–∏–º –∂–µ**, —â–æ –π **`@executable_path`**.
* –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ **dylib**, **`@loader_path`** –¥–∞—î **—à–ª—è—Ö** –¥–æ **dylib**.
{% endhint %}

–°–ø–æ—Å—ñ–± **–ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ —Ü—ñ—î—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—é, –±—É–¥–µ –≤ —Ä—ñ–¥–∫—ñ—Å–Ω–æ–º—É –≤–∏–ø–∞–¥–∫—É, –∫–æ–ª–∏ **–¥–æ–¥–∞—Ç–æ–∫**, —â–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **root**, **—à—É–∫–∞—î** —è–∫—É—Å—å **–±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –≤ —è–∫—ñ–π—Å—å –ø–∞–ø—Ü—ñ, –¥–µ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–∞—î –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å.**

{% hint style="success" %}
–ß—É–¥–æ–≤–∏–π **—Å–∫–∞–Ω–µ—Ä** –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è **–≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫** —É –¥–æ–¥–∞—Ç–∫–∞—Ö - —Ü–µ [**Dylib Hijack Scanner**](https://objective-see.com/products/dhs.html) –∞–±–æ [**CLI –≤–µ—Ä—Å—ñ—è**](https://github.com/pandazheng/DylibHijack).\
–ß—É–¥–æ–≤–∏–π **–∑–≤—ñ—Ç –∑ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–º–∏ –¥–µ—Ç–∞–ª—è–º–∏** –ø—Ä–æ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ [**—Ç—É—Ç**](https://www.virusbulletin.com/virusbulletin/2015/03/dylib-hijacking-os-x).
{% endhint %}

**Example**

{% content-ref url="macos-dyld-hijacking-and-dyld_insert_libraries.md" %}
[macos-dyld-hijacking-and-dyld\_insert\_libraries.md](macos-dyld-hijacking-and-dyld\_insert\_libraries.md)
{% endcontent-ref %}

## Dlopen Hijacking

{% hint style="danger" %}
–ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ **–ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫ —Ç–∞–∫–æ–∂ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è** –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∞—Ç–∞–∫ –Ω–∞ –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è Dlopen.
{% endhint %}

–ó **`man dlopen`**:

* –ö–æ–ª–∏ —à–ª—è—Ö **–Ω–µ –º—ñ—Å—Ç–∏—Ç—å —Å–∏–º–≤–æ–ª–∞ —Å–ª–µ—à—É** (—Ç–æ–±—Ç–æ —Ü–µ –ª–∏—à–µ —ñ–º'—è), **dlopen() –±—É–¥–µ —à—É–∫–∞—Ç–∏**. –Ø–∫—â–æ **`$DYLD_LIBRARY_PATH`** –±—É–ª–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É, dyld —Å–ø–æ—á–∞—Ç–∫—É **—à—É–∫–∞—Ç–∏–º–µ –≤ —Ü—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó**. –î–∞–ª—ñ, —è–∫—â–æ –≤–∏–∫–ª–∏–∫–∞—é—á–∏–π mach-o —Ñ–∞–π–ª –∞–±–æ –æ—Å–Ω–æ–≤–Ω–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª –≤–∫–∞–∑—É—é—Ç—å **`LC_RPATH`**, —Ç–æ–¥—ñ dyld **—à—É–∫–∞—Ç–∏–º–µ –≤ —Ü–∏—Ö** –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è—Ö. –î–∞–ª—ñ, —è–∫—â–æ –ø—Ä–æ—Ü–µ—Å —î **–Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–º**, dyld –±—É–¥–µ —à—É–∫–∞—Ç–∏ –≤ **–ø–æ—Ç–æ—á–Ω—ñ–π —Ä–æ–±–æ—á—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó**. –ù–∞—Ä–µ—à—Ç—ñ, –¥–ª—è —Å—Ç–∞—Ä–∏—Ö –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ dyld —Å–ø—Ä–æ–±—É—î –¥–µ—è–∫—ñ —Ä–µ–∑–µ—Ä–≤–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏. –Ø–∫—â–æ **`$DYLD_FALLBACK_LIBRARY_PATH`** –±—É–ª–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É, dyld –±—É–¥–µ —à—É–∫–∞—Ç–∏ –≤ **—Ü–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è—Ö**, —ñ–Ω–∞–∫—à–µ dyld –±—É–¥–µ —à—É–∫–∞—Ç–∏ –≤ **`/usr/local/lib/`** (—è–∫—â–æ –ø—Ä–æ—Ü–µ—Å —î –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–º), –∞ –ø–æ—Ç—ñ–º —É **`/usr/lib/`** (—Ü—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –±—É–ª–∞ –≤–∑—è—Ç–∞ –∑ **`man dlopen`**).
1. `$DYLD_LIBRARY_PATH`
2. `LC_RPATH`
3. `CWD`(—è–∫—â–æ –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–π)
4. `$DYLD_FALLBACK_LIBRARY_PATH`
5. `/usr/local/lib/` (—è–∫—â–æ –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–π)
6. `/usr/lib/`

{% hint style="danger" %}
–Ø–∫—â–æ –Ω–µ–º–∞—î —Å–ª–µ—à—ñ–≤ –≤ —ñ–º–µ–Ω—ñ, –±—É–¥–µ 2 —Å–ø–æ—Å–æ–±–∏ –∑—Ä–æ–±–∏—Ç–∏ –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è:

* –Ø–∫—â–æ –±—É–¥—å-—è–∫–∏–π **`LC_RPATH`** —î **–∑–∞–ø–∏—Å—É–≤–∞–Ω–∏–º** (–∞–ª–µ –ø—ñ–¥–ø–∏—Å –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —Ç–æ–º—É –¥–ª—è —Ü—å–æ–≥–æ –≤–∞–º —Ç–∞–∫–æ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –±—É–≤ –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–º)
* –Ø–∫—â–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª —î **–Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–º**, —Ç–æ–¥—ñ –º–æ–∂–ª–∏–≤–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —â–æ—Å—å –∑ CWD (–∞–±–æ –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –æ–¥–Ω—ñ—î—é –∑ –∑–≥–∞–¥–∞–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞)
{% endhint %}

* –ö–æ–ª–∏ —à–ª—è—Ö **—Å—Ö–æ–∂–∏–π –Ω–∞ —à–ª—è—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `/stuff/foo.framework/foo`), —è–∫—â–æ **`$DYLD_FRAMEWORK_PATH`** –±—É–ª–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É, dyld —Å–ø–æ—á–∞—Ç–∫—É —à—É–∫–∞—Ç–∏–º–µ –≤ —Ü—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –¥–ª—è **—á–∞—Å—Ç–∫–æ–≤–æ–≥–æ —à–ª—è—Ö—É —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `foo.framework/foo`). –î–∞–ª—ñ dyld —Å–ø—Ä–æ–±—É—î **–≤–∫–∞–∑–∞–Ω–∏–π —à–ª—è—Ö —è–∫ —î** (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø–æ—Ç–æ—á–Ω—É —Ä–æ–±–æ—á—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è –≤—ñ–¥–Ω–æ—Å–Ω–∏—Ö —à–ª—è—Ö—ñ–≤). –ù–∞—Ä–µ—à—Ç—ñ, –¥–ª—è —Å—Ç–∞—Ä–∏—Ö –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ dyld —Å–ø—Ä–æ–±—É—î –¥–µ—è–∫—ñ —Ä–µ–∑–µ—Ä–≤–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏. –Ø–∫—â–æ **`$DYLD_FALLBACK_FRAMEWORK_PATH`** –±—É–ª–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É, dyld –±—É–¥–µ —à—É–∫–∞—Ç–∏ –≤ —Ü–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è—Ö. –Ü–Ω–∞–∫—à–µ, –≤—ñ–Ω –±—É–¥–µ —à—É–∫–∞—Ç–∏ –≤ **`/Library/Frameworks`** (–Ω–∞ macOS, —è–∫—â–æ –ø—Ä–æ—Ü–µ—Å —î –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–º), –ø–æ—Ç—ñ–º **`/System/Library/Frameworks`**.
1. `$DYLD_FRAMEWORK_PATH`
2. –≤–∫–∞–∑–∞–Ω–∏–π —à–ª—è—Ö (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø–æ—Ç–æ—á–Ω—É —Ä–æ–±–æ—á—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è –≤—ñ–¥–Ω–æ—Å–Ω–∏—Ö —à–ª—è—Ö—ñ–≤, —è–∫—â–æ –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–π)
3. `$DYLD_FALLBACK_FRAMEWORK_PATH`
4. `/Library/Frameworks` (—è–∫—â–æ –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–π)
5. `/System/Library/Frameworks`

{% hint style="danger" %}
–Ø–∫—â–æ —à–ª—è—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞, —Å–ø–æ—Å—ñ–± –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è –ø–æ–ª—è–≥–∞—Ç–∏–º–µ –≤:

* –Ø–∫—â–æ –ø—Ä–æ—Ü–µ—Å —î **–Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–º**, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ **–≤—ñ–¥–Ω–æ—Å–Ω–∏–º —à–ª—è—Ö–æ–º –∑ CWD** —Ç–∞ –∑–≥–∞–¥–∞–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –Ω–µ —Å–∫–∞–∑–∞–Ω–æ, —â–æ —è–∫—â–æ –ø—Ä–æ—Ü–µ—Å –æ–±–º–µ–∂–µ–Ω–∏–π, –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ DYLD\_\* –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è)
{% endhint %}

* –ö–æ–ª–∏ —à–ª—è—Ö **–º—ñ—Å—Ç–∏—Ç—å —Å–ª–µ—à, –∞–ª–µ –Ω–µ —î —à–ª—è—Ö–æ–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞** (—Ç–æ–±—Ç–æ –ø–æ–≤–Ω–∏–π —à–ª—è—Ö –∞–±–æ —á–∞—Å—Ç–∫–æ–≤–∏–π —à–ª—è—Ö –¥–æ dylib), dlopen() —Å–ø–æ—á–∞—Ç–∫—É —à—É–∫–∞—î (—è–∫—â–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ) —É **`$DYLD_LIBRARY_PATH`** (–∑ —á–∞—Å—Ç–∏–Ω–æ—é —à–ª—è—Ö—É). –î–∞–ª—ñ dyld **–ø—Ä–æ–±—É—î –≤–∫–∞–∑–∞–Ω–∏–π —à–ª—è—Ö** (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø–æ—Ç–æ—á–Ω—É —Ä–æ–±–æ—á—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è –≤—ñ–¥–Ω–æ—Å–Ω–∏—Ö —à–ª—è—Ö—ñ–≤ (–∞–ª–µ –ª–∏—à–µ –¥–ª—è –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤)). –ù–∞—Ä–µ—à—Ç—ñ, –¥–ª—è —Å—Ç–∞—Ä—ñ—à–∏—Ö –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ dyld —Å–ø—Ä–æ–±—É—î —Ä–µ–∑–µ—Ä–≤–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏. –Ø–∫—â–æ **`$DYLD_FALLBACK_LIBRARY_PATH`** –±—É–ª–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É, dyld –±—É–¥–µ —à—É–∫–∞—Ç–∏ –≤ —Ü–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è—Ö, —ñ–Ω–∞–∫—à–µ dyld –±—É–¥–µ —à—É–∫–∞—Ç–∏ –≤ **`/usr/local/lib/`** (—è–∫—â–æ –ø—Ä–æ—Ü–µ—Å —î –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–º), –∞ –ø–æ—Ç—ñ–º —É **`/usr/lib/`**.
1. `$DYLD_LIBRARY_PATH`
2. –≤–∫–∞–∑–∞–Ω–∏–π —à–ª—è—Ö (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø–æ—Ç–æ—á–Ω—É —Ä–æ–±–æ—á—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è –≤—ñ–¥–Ω–æ—Å–Ω–∏—Ö —à–ª—è—Ö—ñ–≤, —è–∫—â–æ –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–π)
3. `$DYLD_FALLBACK_LIBRARY_PATH`
4. `/usr/local/lib/` (—è–∫—â–æ –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–π)
5. `/usr/lib/`

{% hint style="danger" %}
–Ø–∫—â–æ –≤ —ñ–º–µ–Ω—ñ —î —Å–ª–µ—à—ñ —ñ —Ü–µ –Ω–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, —Å–ø–æ—Å—ñ–± –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è –ø–æ–ª—è–≥–∞—Ç–∏–º–µ –≤:

* –Ø–∫—â–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª —î **–Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–º**, —Ç–æ–¥—ñ –º–æ–∂–ª–∏–≤–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —â–æ—Å—å –∑ CWD –∞–±–æ `/usr/local/lib` (–∞–±–æ –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –æ–¥–Ω—ñ—î—é –∑ –∑–≥–∞–¥–∞–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞)
{% endhint %}

{% hint style="info" %}
–ü—Ä–∏–º—ñ—Ç–∫–∞: –ù–µ–º–∞—î **–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –ø–æ—à—É–∫—É dlopen**.

–ü—Ä–∏–º—ñ—Ç–∫–∞: –Ø–∫—â–æ –æ—Å–Ω–æ–≤–Ω–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª —î **set\[ug]id –±—ñ–Ω–∞—Ä–Ω–∏–º —Ñ–∞–π–ª–æ–º –∞–±–æ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –∑ –ø—Ä–∞–≤–∞–º–∏**, —Ç–æ–¥—ñ **–≤—Å—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ —ñ–≥–Ω–æ—Ä—É—é—Ç—å—Å—è**, —ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ª–∏—à–µ –ø–æ–≤–Ω–∏–π —à–ª—è—Ö ([–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ–±–º–µ–∂–µ–Ω–Ω—è DYLD\_INSERT\_LIBRARIES](macos-dyld-hijacking-and-dyld\_insert\_libraries.md#check-dyld\_insert\_librery-restrictions) –¥–ª—è –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó)

–ü—Ä–∏–º—ñ—Ç–∫–∞: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∏ Apple –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å "—É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—ñ" —Ñ–∞–π–ª–∏ –¥–ª—è –ø–æ—î–¥–Ω–∞–Ω–Ω—è 32-–±—ñ—Ç–Ω–∏—Ö —ñ 64-–±—ñ—Ç–Ω–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ **–Ω–µ–º–∞—î –æ–∫—Ä–µ–º–∏—Ö 32-–±—ñ—Ç–Ω–∏—Ö —ñ 64-–±—ñ—Ç–Ω–∏—Ö —à–ª—è—Ö—ñ–≤ –ø–æ—à—É–∫—É**.

–ü—Ä–∏–º—ñ—Ç–∫–∞: –ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö Apple –±—ñ–ª—å—à—ñ—Å—Ç—å OS dylibs **–æ–±'—î–¥–Ω–∞–Ω—ñ –≤ –∫–µ—à dyld** —ñ –Ω–µ —ñ—Å–Ω—É—é—Ç—å –Ω–∞ –¥–∏—Å–∫—É. –¢–æ–º—É –≤–∏–∫–ª–∏–∫ **`stat()`** –¥–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ —ñ—Å–Ω—É—î OS dylib, **–Ω–µ —Å–ø—Ä–∞—Ü—é—î**. –û–¥–Ω–∞–∫ **`dlopen_preflight()`** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç—ñ –∂ –∫—Ä–æ–∫–∏, —â–æ –π **`dlopen()`**, —â–æ–± –∑–Ω–∞–π—Ç–∏ —Å—É–º—ñ—Å–Ω–∏–π mach-o —Ñ–∞–π–ª.
{% endhint %}

**Check paths**

–î–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ –≤—Å—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫–æ–¥—É:
```c
// gcc dlopentest.c -o dlopentest -Wl,-rpath,/tmp/test
#include <dlfcn.h>
#include <stdio.h>

int main(void)
{
void* handle;

fprintf("--- No slash ---\n");
handle = dlopen("just_name_dlopentest.dylib",1);
if (!handle) {
fprintf(stderr, "Error loading: %s\n\n\n", dlerror());
}

fprintf("--- Relative framework ---\n");
handle = dlopen("a/framework/rel_framework_dlopentest.dylib",1);
if (!handle) {
fprintf(stderr, "Error loading: %s\n\n\n", dlerror());
}

fprintf("--- Abs framework ---\n");
handle = dlopen("/a/abs/framework/abs_framework_dlopentest.dylib",1);
if (!handle) {
fprintf(stderr, "Error loading: %s\n\n\n", dlerror());
}

fprintf("--- Relative Path ---\n");
handle = dlopen("a/folder/rel_folder_dlopentest.dylib",1);
if (!handle) {
fprintf(stderr, "Error loading: %s\n\n\n", dlerror());
}

fprintf("--- Abs Path ---\n");
handle = dlopen("/a/abs/folder/abs_folder_dlopentest.dylib",1);
if (!handle) {
fprintf(stderr, "Error loading: %s\n\n\n", dlerror());
}

return 0;
}
```
–Ø–∫—â–æ –≤–∏ —Å–∫–æ–º–ø—ñ–ª—é—î—Ç–µ —Ç–∞ –≤–∏–∫–æ–Ω–∞—î—Ç–µ —Ü–µ, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **–¥–µ –∫–æ–∂–Ω—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É —à—É–∫–∞–ª–∏ –±–µ–∑—É—Å–ø—ñ—à–Ω–æ**. –¢–∞–∫–æ–∂ –≤–∏ –º–æ–∂–µ—Ç–µ **—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ FS**:
```bash
sudo fs_usage | grep "dlopentest"
```
## Relative Path Hijacking

–Ø–∫—â–æ **–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–π –±—ñ–Ω–∞—Ä/–¥–æ–¥–∞—Ç–æ–∫** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, SUID –∞–±–æ —è–∫–∏–π—Å—å –±—ñ–Ω–∞—Ä –∑ –ø–æ—Ç—É–∂–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏) **–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –∑ –≤—ñ–¥–Ω–æ—Å–Ω–∏–º —à–ª—è—Ö–æ–º** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `@executable_path` –∞–±–æ `@loader_path`) —ñ –º–∞—î **–≤—ñ–¥–∫–ª—é—á–µ–Ω—É –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –±—ñ–±–ª—ñ–æ—Ç–µ–∫**, –º–æ–∂–µ –±—É—Ç–∏ –º–æ–∂–ª–∏–≤–∏–º –ø–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –±—ñ–Ω–∞—Ä —É –º—ñ—Å—Ü–µ, –¥–µ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ **–º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –∑ –≤—ñ–¥–Ω–æ—Å–Ω–∏–º —à–ª—è—Ö–æ–º**, —ñ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü–∏–º –¥–ª—è —ñ–Ω'—î–∫—Ü—ñ—ó –∫–æ–¥—É –≤ –ø—Ä–æ—Ü–µ—Å.

## Prune `DYLD_*` and `LD_LIBRARY_PATH` env variables

–£ —Ñ–∞–π–ª—ñ `dyld-dyld-832.7.1/src/dyld2.cpp` –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é **`pruneEnvironmentVariables`**, —è–∫–∞ –≤–∏–¥–∞–ª–∏—Ç—å –±—É–¥—å-—è–∫—É –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, —â–æ **–ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `DYLD_`** —Ç–∞ **`LD_LIBRARY_PATH=`**.

–í–æ–Ω–∞ —Ç–∞–∫–æ–∂ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ **null** –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ **`DYLD_FALLBACK_FRAMEWORK_PATH`** —Ç–∞ **`DYLD_FALLBACK_LIBRARY_PATH`** –¥–ª—è **suid** —Ç–∞ **sgid** –±—ñ–Ω–∞—Ä—ñ–≤.

–¶—è —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑ —Ñ—É–Ω–∫—Ü—ñ—ó **`_main`** —Ç–æ–≥–æ –∂ —Ñ–∞–π–ª—É, —è–∫—â–æ –Ω–∞—Ü—ñ–ª–µ–Ω–∞ –Ω–∞ OSX —Ç–∞–∫–∏–º —á–∏–Ω–æ–º:
```cpp
#if TARGET_OS_OSX
if ( !gLinkContext.allowEnvVarsPrint && !gLinkContext.allowEnvVarsPath && !gLinkContext.allowEnvVarsSharedCache ) {
pruneEnvironmentVariables(envp, &apple);
```
—ñ —Ü—ñ –±—É–ª–µ–≤—ñ –ø—Ä–∞–ø–æ—Ä–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—é—Ç—å—Å—è –≤ –æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—ñ –≤ –∫–æ–¥—ñ:
```cpp
#if TARGET_OS_OSX
// support chrooting from old kernel
bool isRestricted = false;
bool libraryValidation = false;
// any processes with setuid or setgid bit set or with __RESTRICT segment is restricted
if ( issetugid() || hasRestrictedSegment(mainExecutableMH) ) {
isRestricted = true;
}
bool usingSIP = (csr_check(CSR_ALLOW_TASK_FOR_PID) != 0);
uint32_t flags;
if ( csops(0, CS_OPS_STATUS, &flags, sizeof(flags)) != -1 ) {
// On OS X CS_RESTRICT means the program was signed with entitlements
if ( ((flags & CS_RESTRICT) == CS_RESTRICT) && usingSIP ) {
isRestricted = true;
}
// Library Validation loosens searching but requires everything to be code signed
if ( flags & CS_REQUIRE_LV ) {
isRestricted = false;
libraryValidation = true;
}
}
gLinkContext.allowAtPaths                = !isRestricted;
gLinkContext.allowEnvVarsPrint           = !isRestricted;
gLinkContext.allowEnvVarsPath            = !isRestricted;
gLinkContext.allowEnvVarsSharedCache     = !libraryValidation || !usingSIP;
gLinkContext.allowClassicFallbackPaths   = !isRestricted;
gLinkContext.allowInsertFailures         = false;
gLinkContext.allowInterposing         	 = true;
```
–Ø–∫–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –æ–∑–Ω–∞—á–∞—î, —â–æ —è–∫—â–æ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª —î **suid** –∞–±–æ **sgid**, –∞–±–æ –º–∞—î —Å–µ–≥–º–µ–Ω—Ç **RESTRICT** —É –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö, –∞–±–æ –±—É–≤ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –∑ –ø—Ä–∞–ø–æ—Ä–æ–º **CS\_RESTRICT**, —Ç–æ–¥—ñ **`!gLinkContext.allowEnvVarsPrint && !gLinkContext.allowEnvVarsPath && !gLinkContext.allowEnvVarsSharedCache`** —î —ñ—Å—Ç–∏–Ω–Ω–∏–º, —ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –æ–±—Ä—ñ–∑–∞—é—Ç—å—Å—è.

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —è–∫—â–æ CS\_REQUIRE\_LV —î —ñ—Å—Ç–∏–Ω–Ω–∏–º, —Ç–æ–¥—ñ –∑–º—ñ–Ω–Ω—ñ –Ω–µ –±—É–¥—É—Ç—å –æ–±—Ä—ñ–∑–∞–Ω—ñ, –∞–ª–µ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å, —á–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –≤–æ–Ω–∏ —Ç–æ–π –∂–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç, —â–æ –π –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª.

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–±–º–µ–∂–µ–Ω—å

### SUID & SGID
```bash
# Make it owned by root and suid
sudo chown root hello
sudo chmod +s hello
# Insert the library
DYLD_INSERT_LIBRARIES=inject.dylib ./hello

# Remove suid
sudo chmod -s hello
```
### –†–æ–∑–¥—ñ–ª `__RESTRICT` –∑ —Å–µ–≥–º–µ–Ω—Ç–æ–º `__restrict`
```bash
gcc -sectcreate __RESTRICT __restrict /dev/null hello.c -o hello-restrict
DYLD_INSERT_LIBRARIES=inject.dylib ./hello-restrict
```
### –£—Å–∫–ª–∞–¥–Ω–µ–Ω–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π –∫–æ–¥

–°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —É –ö–ª—é—á–Ω–∏—Ü—ñ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –π–æ–≥–æ –¥–ª—è –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É:

{% code overflow="wrap" %}
```bash
# Apply runtime proetction
codesign -s <cert-name> --option=runtime ./hello
DYLD_INSERT_LIBRARIES=inject.dylib ./hello #Library won't be injected

# Apply library validation
codesign -f -s <cert-name> --option=library ./hello
DYLD_INSERT_LIBRARIES=inject.dylib ./hello-signed #Will throw an error because signature of binary and library aren't signed by same cert (signs must be from a valid Apple-signed developer certificate)

# Sign it
## If the signature is from an unverified developer the injection will still work
## If it's from a verified developer, it won't
codesign -f -s <cert-name> inject.dylib
DYLD_INSERT_LIBRARIES=inject.dylib ./hello-signed

# Apply CS_RESTRICT protection
codesign -f -s <cert-name> --option=restrict hello-signed
DYLD_INSERT_LIBRARIES=inject.dylib ./hello-signed # Won't work
```
{% endcode %}

{% hint style="danger" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —î –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏, –ø—ñ–¥–ø–∏—Å–∞–Ω—ñ –∑ –ø—Ä–∞–ø–æ—Ä–∞–º–∏ **`0x0(none)`**, –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∞–ø–æ—Ä **`CS_RESTRICT`** –¥–∏–Ω–∞–º—ñ—á–Ω–æ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —ñ —Ç–æ–º—É —Ü—è —Ç–µ—Ö–Ω—ñ–∫–∞ –Ω–µ —Å–ø—Ä–∞—Ü—é—î –≤ –Ω–∏—Ö.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–∞—î –ø—Ä–æ—Ü–µ—Å —Ü–µ–π –ø—Ä–∞–ø–æ—Ä –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é (–æ—Ç—Ä–∏–º–∞—Ç–∏ [**csops —Ç—É—Ç**](https://github.com/axelexic/CSOps)):
```bash
csops -status <pid>
```
—ñ –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ –ø—Ä–∞–ø–æ—Ä 0x800.
{% endhint %}

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://theevilbit.github.io/posts/dyld\_insert\_libraries\_dylib\_injection\_in\_macos\_osx\_deep\_dive/](https://theevilbit.github.io/posts/dyld\_insert\_libraries\_dylib\_injection\_in\_macos\_osx\_deep\_dive/)
* [**\*OS Internals, Volume I: User Mode. By Jonathan Levin**](https://www.amazon.com/MacOS-iOS-Internals-User-Mode/dp/099105556X)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
