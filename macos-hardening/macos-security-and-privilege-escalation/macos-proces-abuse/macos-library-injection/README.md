# macOS Library Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

{% hint style="danger" %}
**dyld рдХрд╛ рдХреЛрдб рдУрдкрди рд╕реЛрд░реНрд╕ рд╣реИ** рдФрд░ [https://opensource.apple.com/source/dyld/](https://opensource.apple.com/source/dyld/) рдкрд░ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ **URL рдЬреИрд╕реЗ** [https://opensource.apple.com/tarballs/dyld/dyld-852.2.tar.gz](https://opensource.apple.com/tarballs/dyld/dyld-852.2.tar.gz) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдЯрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

## **Dyld Process**

Dyld рдХреИрд╕реЗ рдмрд╛рдЗрдирд░реА рдХреЗ рдЕрдВрджрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд▓реЛрдб рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ:

{% content-ref url="macos-dyld-process.md" %}
[macos-dyld-process.md](macos-dyld-process.md)
{% endcontent-ref %}

## **DYLD\_INSERT\_LIBRARIES**

рдпрд╣ [**LD\_PRELOAD on Linux**](../../../../linux-hardening/privilege-escalation/#ld\_preload) рдХреЗ рд╕рдорд╛рди рд╣реИред рдпрд╣ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдЪрд▓рдиреЗ рд╡рд╛рд▓реА рд╣реИ рдХрд┐ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рдПрдХ рдкрде рд╕реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рдП (рдпрджрд┐ env var рд╕рдХреНрд╖рдо рд╣реИ)

рдпрд╣ рддрдХрдиреАрдХ **ASEP рддрдХрдиреАрдХ рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рд╣рд░ рд╕реНрдерд╛рдкрд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ "Info.plist" рдирд╛рдордХ рдПрдХ plist рд╣реЛрддреА рд╣реИ рдЬреЛ рдПрдХ рдХреБрдВрдЬреА `LSEnvironmental` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдкрд░реНрдпрд╛рд╡рд░рдгреАрдп рдЪрд░ рдЕрд╕рд╛рдЗрди рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

{% hint style="info" %}
2012 рд╕реЗ **Apple рдиреЗ `DYLD_INSERT_LIBRARIES`** рдХреА **рд╢рдХреНрддрд┐ рдХреЛ рдирд╛рдЯрдХреАрдп рд░реВрдк рд╕реЗ рдХрдо рдХрд░ рджрд┐рдпрд╛ рд╣реИ**ред

рдХреЛрдб рдкрд░ рдЬрд╛рдПрдВ рдФрд░ **`src/dyld.cpp`** рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред рдлрд╝рдВрдХреНрд╢рди **`pruneEnvironmentVariables`** рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **`DYLD_*`** рдЪрд░ рд╣рдЯрд╛ рджрд┐рдП рдЧрдП рд╣реИрдВред

рдлрд╝рдВрдХреНрд╢рди **`processRestricted`** рдореЗрдВ рдкреНрд░рддрд┐рдмрдВрдз рдХрд╛ рдХрд╛рд░рдг рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЙрд╕ рдХреЛрдб рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╕рдордп рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХрд╛рд░рдг рд╣реИрдВ:

* рдмрд╛рдЗрдирд░реА `setuid/setgid` рд╣реИ
* macho рдмрд╛рдЗрдирд░реА рдореЗрдВ `__RESTRICT/__restrict` рдЕрдиреБрднрд╛рдЧ рдХрд╛ рдЕрд╕реНрддрд┐рддреНрд╡ред
* рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдореЗрдВ рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ (рд╣рд░реНрдбрдирдб рд░рдирдЯрд╛рдЗрдо) рдмрд┐рдирд╛ [`com.apple.security.cs.allow-dyld-environment-variables`](https://developer.apple.com/documentation/bundleresources/entitlements/com\_apple\_security\_cs\_allow-dyld-environment-variables) рдЕрдзрд┐рдХрд╛рд░ рдХреЗ
* рдмрд╛рдЗрдирд░реА рдХреЗ **рдЕрдзрд┐рдХрд╛рд░** рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ: `codesign -dv --entitlements :- </path/to/bin>`

рдЕрдзрд┐рдХ рдЕрдкрдбреЗрдЯреЗрдб рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдЖрдк рдЗрд╕ рддрд░реНрдХ рдХреЛ рдлрд╝рдВрдХреНрд╢рди **`configureProcessRestrictions`** рдХреЗ рджреВрд╕рд░реЗ рднрд╛рдЧ рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЬреЛ рдирдП рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ рд╡рд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЗ **рд╢реБрд░реБрдЖрддреА рдЬрд╛рдВрдЪ** рд╣реИрдВ (рдЖрдк iOS рдпрд╛ рд╕рд┐рдореБрд▓реЗрд╢рди рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд ifs рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ macOS рдореЗрдВ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ)ред
{% endhint %}

### рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдорд╛рдиреНрдпрддрд╛

рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдпрджрд┐ рдмрд╛рдЗрдирд░реА **`DYLD_INSERT_LIBRARIES`** env рдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдпрджрд┐ рдмрд╛рдЗрдирд░реА рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреА рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рдХрд╕реНрдЯрдо рдХреЛ рд▓реЛрдб рдирд╣реАрдВ рдХрд░реЗрдЧреАред

рдПрдХ рдХрд╕реНрдЯрдо рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдмрд╛рдЗрдирд░реА рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдореЗрдВ рд╕реЗ **рдПрдХ** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП:

* [`com.apple.security.cs.disable-library-validation`](../../macos-security-protections/macos-dangerous-entitlements.md#com.apple.security.cs.disable-library-validation)
* [`com.apple.private.security.clear-library-validation`](../../macos-security-protections/macos-dangerous-entitlements.md#com.apple.private.security.clear-library-validation)

рдпрд╛ рдмрд╛рдЗрдирд░реА рдХреЛ **рд╣рд░реНрдбрдирдб рд░рдирдЯрд╛рдЗрдо рдлреНрд▓реИрдЧ** рдпрд╛ **рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдорд╛рдиреНрдпрддрд╛ рдлреНрд▓реИрдЧ** рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдмрд╛рдЗрдирд░реА рдореЗрдВ **рд╣рд░реНрдбрдирдб рд░рдирдЯрд╛рдЗрдо** рд╣реИ `codesign --display --verbose <bin>` рдХреЗ рд╕рд╛рде **`CodeDirectory`** рдореЗрдВ рд░рдирдЯрд╛рдЗрдо рдлреНрд▓реИрдЧ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реБрдП рдЬреИрд╕реЗ: **`CodeDirectory v=20500 size=767 flags=0x10000(runtime) hashes=13+7 location=embedded`**

рдЖрдк рдПрдХ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рднреА рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрджрд┐ рдпрд╣ **рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рдорд╛рди рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рде рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рд╣реИ**ред

рдЗрд╕рдХрд╛ (ab) рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдЦреЛрдЬреЗрдВ рдФрд░ рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="macos-dyld-hijacking-and-dyld_insert_libraries.md" %}
[macos-dyld-hijacking-and-dyld\_insert\_libraries.md](macos-dyld-hijacking-and-dyld\_insert\_libraries.md)
{% endcontent-ref %}

## Dylib Hijacking

{% hint style="danger" %}
рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ **рдкрд┐рдЫрд▓реЗ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рддрд┐рдмрдВрдз рднреА рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВ** Dylib рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рд╣рдорд▓реЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
{% endhint %}

Windows рдХреА рддрд░рд╣, MacOS рдореЗрдВ рдЖрдк рднреА **dylibs рдХреЛ рд╣рд╛рдЗрдЬреИрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди** **рдордирдорд╛рдиреЗ** **рдХреЛрдб** рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░ рд╕рдХреЗрдВ (рдареАрдХ рд╣реИ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдпрд╣ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХреЛ рдПрдХ TCC рдЕрдиреБрдорддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рддрд╛рдХрд┐ рдЖрдк рдПрдХ `.app` рдмрдВрдбрд▓ рдХреЗ рдЕрдВрджрд░ рд▓рд┐рдЦ рд╕рдХреЗрдВ рдФрд░ рдПрдХ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд╣рд╛рдЗрдЬреИрдХ рдХрд░ рд╕рдХреЗрдВ)ред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, **MacOS** рдПрдкреНрд▓рд┐рдХреЗрд╢рди **рд▓рд╛рдЗрдмреНрд░реЗрд░реА** рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ **Windows рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд** рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдореИрд▓рд╡реЗрдпрд░** рдбреЗрд╡рд▓рдкрд░реНрд╕ рдЕрднреА рднреА **рд╕реНрдЯреЗрд▓реНрде** рдХреЗ рд▓рд┐рдП рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди **рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрд╣реБрдд рдХрдо рд╣реИ**ред

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ **рдЕрдзрд┐рдХ рд╕рд╛рдорд╛рдиреНрдп** рд╣реИ рдХрд┐ **MacOS рдмрд╛рдЗрдирд░реА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрдг рдкрде** рдЗрдВрдЧрд┐рдд рдХрд░рддреА рд╣реИрдВред рдФрд░ рджреВрд╕рд░рд╛, **MacOS рдХрднреА рднреА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд▓рд┐рдП **$PATH** рдХреЗ рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдореЗрдВ рдЦреЛрдЬ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред

рдЗрд╕ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд **рдХреЛрдб** рдХрд╛ **рдореБрдЦреНрдп** рднрд╛рдЧ **`ImageLoader::recursiveLoadLibraries`** рдореЗрдВ рд╣реИ `ImageLoader.cpp`ред

рдПрдХ macho рдмрд╛рдЗрдирд░реА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **4 рд╡рд┐рднрд┐рдиреНрди рд╣реЗрдбрд░ рдХрдорд╛рдВрдб** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреА рд╣реИ:

* **`LC_LOAD_DYLIB`** рдХрдорд╛рдВрдб рдПрдХ dylib рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рдХрдорд╛рдВрдб рд╣реИред
* **`LC_LOAD_WEAK_DYLIB`** рдХрдорд╛рдВрдб рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рдХреА рддрд░рд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрджрд┐ dylib рдирд╣реАрдВ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдирд┐рд╖реНрдкрд╛рджрди рдмрд┐рдирд╛ рдХрд┐рд╕реА рддреНрд░реБрдЯрд┐ рдХреЗ рдЬрд╛рд░реА рд░рд╣рддрд╛ рд╣реИред
* **`LC_REEXPORT_DYLIB`** рдХрдорд╛рдВрдб рдпрд╣ рдкреНрд░рддреАрдХ рдПрдХ рдЕрд▓рдЧ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╕реЗ рдкреНрд░реЙрдХреНрд╕реА (рдпрд╛ рдлрд┐рд░ рд╕реЗ рдирд┐рд░реНрдпрд╛рдд) рдХрд░рддрд╛ рд╣реИред
* **`LC_LOAD_UPWARD_DYLIB`** рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рддрдм рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рджреЛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдПрдХ-рджреВрд╕рд░реЗ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИрдВ (рдЗрд╕реЗ _upward dependency_ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ)ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, **dylib рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ** рдХреЗ **2 рдкреНрд░рдХрд╛рд░** рд╣реИрдВ:

* **рдЧрд╛рдпрдм рдХрдордЬреЛрд░ рд▓рд┐рдВрдХ рдХреА рдЧрдИ рд▓рд╛рдЗрдмреНрд░реЗрд░реА**: рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдПрдХ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ рдЬреЛ **LC\_LOAD\_WEAK\_DYLIB** рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИ рдирд╣реАрдВ рд╣реИред рдлрд┐рд░, **рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ dylib рдХреЛ рдЙрд╕ рд╕реНрдерд╛рди рдкрд░ рд░рдЦрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЗрд╕реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЙрдореНрдореАрдж рд╣реИ**ред
* рд▓рд┐рдВрдХ "рдХрдордЬреЛрд░" рд╣реЛрдиреЗ рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдирд╣реАрдВ рдорд┐рд▓рдиреЗ рдкрд░ рднреА рдЪрд▓рдирд╛ рдЬрд╛рд░реА рд░рдЦреЗрдЧрд╛ред
* рдЗрд╕ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд **рдХреЛрдб** `ImageLoaderMachO::doGetDependentLibraries` рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╣реИ `ImageLoaderMachO.cpp` рдЬрд╣рд╛рдВ `lib->required` рдХреЗрд╡рд▓ рддрдм `false` рд╣реИ рдЬрдм `LC_LOAD_WEAK_DYLIB` рд╕рддреНрдп рд╣реИред
* **рдмрд╛рдЗрдирд░реА рдореЗрдВ рдХрдордЬреЛрд░ рд▓рд┐рдВрдХ рдХреА рдЧрдИ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЦреЛрдЬреЗрдВ** (рдЖрдкрдХреЗ рдкрд╛рд╕ рдмрд╛рдж рдореЗрдВ рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдмрдирд╛рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ):
* ```bash
otool -l </path/to/bin> | grep LC_LOAD_WEAK_DYLIB -A 5 cmd LC_LOAD_WEAK_DYLIB
cmdsize 56
name /var/tmp/lib/libUtl.1.dylib (offset 24)
time stamp 2 Wed Jun 21 12:23:31 1969
current version 1.0.0
compatibility version 1.0.0
```
* **@rpath рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛**: Mach-O рдмрд╛рдЗрдирд░реА рдореЗрдВ **`LC_RPATH`** рдФрд░ **`LC_LOAD_DYLIB`** рдХрдорд╛рдВрдб рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЙрди рдХрдорд╛рдВрдб рдХреЗ **рдорд╛рдиреЛрдВ** рдХреЗ рдЖрдзрд╛рд░ рдкрд░, **рд▓рд╛рдЗрдмреНрд░реЗрд░реА** **рд╡рд┐рднрд┐рдиреНрди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ** рд╕реЗ **рд▓реЛрдб** рдХреА рдЬрд╛рдПрдЧреАред
* **`LC_RPATH`** рдореЗрдВ рдХреБрдЫ рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдХреЗ рдкрде рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдмрд╛рдЗрдирд░реА рджреНрд╡рд╛рд░рд╛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред
* **`LC_LOAD_DYLIB`** рдореЗрдВ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢рд┐рд╖реНрдЯ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдкрде рд╣реЛрддрд╛ рд╣реИред рдпреЗ рдкрде **`@rpath`** рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ **`LC_RPATH`** рдореЗрдВ рдорд╛рдиреЛрдВ рджреНрд╡рд╛рд░рд╛ **рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред рдпрджрд┐ **`LC_RPATH`** рдореЗрдВ рдХрдИ рдкрде рд╣реИрдВ, рддреЛ рд╕рднреА рдХрд╛ рдЙрдкрдпреЛрдЧ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг:
* рдпрджрд┐ **`LC_LOAD_DYLIB`** рдореЗрдВ `@rpath/library.dylib` рд╣реИ рдФрд░ **`LC_RPATH`** рдореЗрдВ `/application/app.app/Contents/Framework/v1/` рдФрд░ `/application/app.app/Contents/Framework/v2/` рд╣реИред рджреЛрдиреЛрдВ рдлрд╝реЛрд▓реНрдбрд░ `library.dylib` рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред рдпрджрд┐ рд▓рд╛рдЗрдмреНрд░реЗрд░реА `[...]/v1/` рдореЗрдВ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ рдФрд░ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕реЗ `[...]/v2/` рдореЗрдВ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рдЦ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **`LC_LOAD_DYLIB`** рдореЗрдВ рдкрдереЛрдВ рдХрд╛ рдХреНрд░рдо рдЕрдиреБрд╕рд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* **рдмрд╛рдЗрдирд░реА рдореЗрдВ rpath рдкрде рдФрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЦреЛрдЬреЗрдВ**: `otool -l </path/to/binary> | grep -E "LC_RPATH|LC_LOAD_DYLIB" -A 5`

{% hint style="info" %}
**`@executable_path`**: рдпрд╣ **рдореБрдЦреНрдп рдирд┐рд╖реНрдкрд╛рджрди рдлрд╝рд╛рдЗрд▓** рд╡рд╛рд▓реЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ **рдкрде** рд╣реИред

**`@loader_path`**: рдпрд╣ **Mach-O рдмрд╛рдЗрдирд░реА** рд╡рд╛рд▓реЗ **рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** рдХрд╛ **рдкрде** рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд▓реЛрдб рдХрдорд╛рдВрдб рд╣реЛрддрд╛ рд╣реИред

* рдЬрдм рдЗрд╕реЗ рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **`@loader_path`** рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ **`@executable_path`** рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИред
* рдЬрдм рдЗрд╕реЗ рдПрдХ **dylib** рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **`@loader_path`** **dylib** рдХрд╛ **рдкрде** рджреЗрддрд╛ рд╣реИред
{% endhint %}

рдЗрд╕ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ** рдХрд╛ рддрд░реАрдХрд╛ рддрдм рд╣реЛрдЧрд╛ рдЬрдм рдПрдХ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдЬреЛ **рд░реВрдЯ** рджреНрд╡рд╛рд░рд╛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рдХрд┐рд╕реА **рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдХрд┐рд╕реА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреА рддрд▓рд╛рд╢ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред**

{% hint style="success" %}
рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдореЗрдВ **рдЧрд╛рдпрдм рд▓рд╛рдЗрдмреНрд░реЗрд░реА** рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдЪреНрдЫрд╛ **рд╕реНрдХреИрдирд░** [**Dylib Hijack Scanner**](https://objective-see.com/products/dhs.html) рд╣реИ рдпрд╛ рдПрдХ [**CLI рд╕рдВрд╕реНрдХрд░рдг**](https://github.com/pandazheng/DylibHijack).\
рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рддрдХрдиреАрдХреА рд╡рд┐рд╡рд░рдг рдХреЗ рд╕рд╛рде рдПрдХ рдЕрдЪреНрдЫрд╛ **рд░рд┐рдкреЛрд░реНрдЯ** [**рдпрд╣рд╛рдВ**](https://www.virusbulletin.com/virusbulletin/2015/03/dylib-hijacking-os-x) рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

**рдЙрджрд╛рд╣рд░рдг**

{% content-ref url="macos-dyld-hijacking-and-dyld_insert_libraries.md" %}
[macos-dyld-hijacking-and-dyld\_insert\_libraries.md](macos-dyld-hijacking-and-dyld\_insert\_libraries.md)
{% endcontent-ref %}

## Dlopen Hijacking

{% hint style="danger" %}
рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ **рдкрд┐рдЫрд▓реЗ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рддрд┐рдмрдВрдз рднреА рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВ** Dlopen рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рд╣рдорд▓реЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
{% endhint %}

**`man dlopen`** рд╕реЗ:

* рдЬрдм рдкрде **рд╕реНрд▓реИрд╢ рд╡рд░реНрдг** рдирд╣реАрдВ рд░рдЦрддрд╛ (рдпрд╛рдиреА рдпрд╣ рдХреЗрд╡рд▓ рдПрдХ рдкрддреНрддреЗ рдХрд╛ рдирд╛рдо рд╣реИ), **dlopen() рдЦреЛрдЬ рдХрд░реЗрдЧрд╛**ред рдпрджрд┐ **`$DYLD_LIBRARY_PATH`** рд▓реЙрдиреНрдЪ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рддреЛ dyld рдкрд╣рд▓реЗ рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ **рджреЗрдЦреЗрдЧрд╛**ред рдЕрдЧрд▓рд╛, рдпрджрд┐ рдХреЙрд▓рд┐рдВрдЧ mach-o рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдореБрдЦреНрдп рдирд┐рд╖реНрдкрд╛рджрди рдиреЗ **`LC_RPATH`** рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рд╣реИ, рддреЛ dyld рдЙрди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ **рджреЗрдЦреЗрдЧрд╛**ред рдЕрдЧрд▓рд╛, рдпрджрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ **рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд** рд╣реИ, рддреЛ dyld **рд╡рд░реНрддрдорд╛рди рдХрд╛рд░реНрдпрд╢реАрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** рдореЗрдВ рдЦреЛрдЬ рдХрд░реЗрдЧрд╛ред рдЕрдВрдд рдореЗрдВ, рдкреБрд░рд╛рдиреЗ рдмрд╛рдЗрдирд░реА рдХреЗ рд▓рд┐рдП, dyld рдХреБрдЫ рдлреЙрд▓рдмреИрдХ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдЧрд╛ред рдпрджрд┐ **`$DYLD_FALLBACK_LIBRARY_PATH`** рд▓реЙрдиреНрдЪ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рддреЛ dyld рдЙрди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЦреЛрдЬ рдХрд░реЗрдЧрд╛, рдЕрдиреНрдпрдерд╛, dyld **`/usr/local/lib/`** рдореЗрдВ рджреЗрдЦреЗрдЧрд╛ (рдпрджрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╣реИ), рдФрд░ рдлрд┐рд░ **`/usr/lib/`** рдореЗрдВ (рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА **`man dlopen`** рд╕реЗ рд▓реА рдЧрдИ рдереА)ред
1. `$DYLD_LIBRARY_PATH`
2. `LC_RPATH`
3. `CWD`(рдпрджрд┐ рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд)
4. `$DYLD_FALLBACK_LIBRARY_PATH`
5. `/usr/local/lib/` (рдпрджрд┐ рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд)
6. `/usr/lib/`

{% hint style="danger" %}
рдпрджрд┐ рдирд╛рдо рдореЗрдВ рдХреЛрдИ рд╕реНрд▓реИрд╢ рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 2 рддрд░реАрдХреЗ рд╣реЛрдВрдЧреЗ:

* рдпрджрд┐ рдХреЛрдИ **`LC_RPATH`** **рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп** рд╣реИ (рд▓реЗрдХрд┐рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдмрд╛рдЗрдирд░реА рдХреЛ рднреА рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП)
* рдпрджрд┐ рдмрд╛рдЗрдирд░реА **рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд** рд╣реИ рдФрд░ рдлрд┐рд░ CWD рд╕реЗ рдХреБрдЫ рд▓реЛрдб рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ (рдпрд╛ рдЙрд▓реНрд▓реЗрдЦрд┐рдд env рдЪрд░ рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛)
{% endhint %}

* рдЬрдм рдкрде **рдлреНрд░реЗрдорд╡рд░реНрдХ** рдкрде рдХреА рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ (рдЬреИрд╕реЗ `/stuff/foo.framework/foo`), рдпрджрд┐ **`$DYLD_FRAMEWORK_PATH`** рд▓реЙрдиреНрдЪ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рддреЛ dyld рдкрд╣рд▓реЗ рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ **рдлреНрд░реЗрдорд╡рд░реНрдХ рдЖрдВрд╢рд┐рдХ рдкрде** (рдЬреИрд╕реЗ `foo.framework/foo`) рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдЧрд╛ред рдЕрдЧрд▓рд╛, dyld **рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдкрде рдХреЛ рдЬреИрд╕рд╛ рд╣реИ** (рд╕рд╛рдкреЗрдХреНрд╖ рдкрдереЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдХрд╛рд░реНрдпрд╢реАрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП) рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдЧрд╛ред рдЕрдВрдд рдореЗрдВ, рдкреБрд░рд╛рдиреЗ рдмрд╛рдЗрдирд░реА рдХреЗ рд▓рд┐рдП, dyld рдХреБрдЫ рдлреЙрд▓рдмреИрдХ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдЧрд╛ред рдпрджрд┐ **`$DYLD_FALLBACK_FRAMEWORK_PATH`** рд▓реЙрдиреНрдЪ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рддреЛ dyld рдЙрди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЦреЛрдЬ рдХрд░реЗрдЧрд╛ред рдЕрдиреНрдпрдерд╛, рдпрд╣ **`/Library/Frameworks`** (macOS рдкрд░ рдпрджрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╣реИ), рдлрд┐рд░ **`/System/Library/Frameworks`** рдореЗрдВ рдЦреЛрдЬ рдХрд░реЗрдЧрд╛ред
1. `$DYLD_FRAMEWORK_PATH`
2. рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкрде (рдпрджрд┐ рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╣реИ рддреЛ рд╕рд╛рдкреЗрдХреНрд╖ рдкрдереЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдХрд╛рд░реНрдпрд╢реАрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛)
3. `$DYLD_FALLBACK_FRAMEWORK_PATH`
4. `/Library/Frameworks` (рдпрджрд┐ рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд)
5. `/System/Library/Frameworks`

{% hint style="danger" %}
рдпрджрд┐ рдПрдХ рдлреНрд░реЗрдорд╡рд░реНрдХ рдкрде рд╣реИ, рддреЛ рдЗрд╕реЗ рд╣рд╛рдЗрдЬреИрдХ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реЛрдЧрд╛:

* рдпрджрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ **рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд** рд╣реИ, рддреЛ CWD рд╕реЗ рд╕рд╛рдкреЗрдХреНрд╖ рдкрде рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдЙрд▓реНрд▓реЗрдЦрд┐рдд env рдЪрд░ (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдпрджрд┐ рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ рдирд╣реАрдВ рдХрд╣рд╛ рдЧрдпрд╛ рд╣реИ рдпрджрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╣реИ рддреЛ DYLD\_\* env vars рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ)
{% endhint %}

* рдЬрдм рдкрде **рд╕реНрд▓реИрд╢ рд░рдЦрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдлреНрд░реЗрдорд╡рд░реНрдХ рдкрде рдирд╣реАрдВ рд╣реИ** (рдпрд╛рдиреА рдПрдХ рдкреВрд░реНрдг рдкрде рдпрд╛ dylib рдХреЗ рд▓рд┐рдП рдЖрдВрд╢рд┐рдХ рдкрде), dlopen() рдкрд╣рд▓реЗ (рдпрджрд┐ рд╕реЗрдЯ рд╣реИ) **`$DYLD_LIBRARY_PATH`** рдореЗрдВ рджреЗрдЦрддрд╛ рд╣реИ (рдкрде рд╕реЗ рдкрддреНрддреЗ рдХрд╛ рднрд╛рдЧ)ред рдЕрдЧрд▓рд╛, dyld **рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдкрде рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ** (рд╕рд╛рдкреЗрдХреНрд╖ рдкрдереЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдХрд╛рд░реНрдпрд╢реАрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП (рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП))ред рдЕрдВрдд рдореЗрдВ, рдкреБрд░рд╛рдиреЗ рдмрд╛рдЗрдирд░реА рдХреЗ рд▓рд┐рдП, dyld рдлреЙрд▓рдмреИрдХ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдЧрд╛ред рдпрджрд┐ **`$DYLD_FALLBACK_LIBRARY_PATH`** рд▓реЙрдиреНрдЪ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рддреЛ dyld рдЙрди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЦреЛрдЬ рдХрд░реЗрдЧрд╛, рдЕрдиреНрдпрдерд╛, dyld **`/usr/local/lib/`** рдореЗрдВ рджреЗрдЦреЗрдЧрд╛ (рдпрджрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╣реИ), рдФрд░ рдлрд┐рд░ **`/usr/lib/`** рдореЗрдВред
1. `$DYLD_LIBRARY_PATH`
2. рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкрде (рдпрджрд┐ рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╣реИ рддреЛ рд╕рд╛рдкреЗрдХреНрд╖ рдкрдереЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдХрд╛рд░реНрдпрд╢реАрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛)
3. `$DYLD_FALLBACK_LIBRARY_PATH`
4. `/usr/local/lib/` (рдпрджрд┐ рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд)
5. `/usr/lib/`

{% hint style="danger" %}
рдпрджрд┐ рдирд╛рдо рдореЗрдВ рд╕реНрд▓реИрд╢ рд╣реИрдВ рдФрд░ рдлреНрд░реЗрдорд╡рд░реНрдХ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЗрд╕реЗ рд╣рд╛рдЗрдЬреИрдХ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реЛрдЧрд╛:

* рдпрджрд┐ рдмрд╛рдЗрдирд░реА **рдЕрдкреНрд░рддрд┐рдмрдВрдзрд┐рдд** рд╣реИ рдФрд░ рдлрд┐рд░ CWD рдпрд╛ `/usr/local/lib` рд╕реЗ рдХреБрдЫ рд▓реЛрдб рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ (рдпрд╛ рдЙрд▓реНрд▓реЗрдЦрд┐рдд env рдЪрд░ рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛)
{% endhint %}

{% hint style="info" %}
рдиреЛрдЯ: **dlopen рдЦреЛрдЬ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ **рдирд╣реАрдВ рд╣реИрдВ**ред

рдиреЛрдЯ: рдпрджрд┐ рдореБрдЦреНрдп рдирд┐рд╖реНрдкрд╛рджрди **set\[ug]id рдмрд╛рдЗрдирд░реА рдпрд╛ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрдбрд╕рд╛рдЗрди** рд╣реИ, рддреЛ **рд╕рднреА рдкрд░реНрдпрд╛рд╡рд░рдгреАрдп рдЪрд░ рдЕрдирджреЗрдЦрд╛ рдХрд░ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**, рдФрд░ рдХреЗрд╡рд▓ рдПрдХ рдкреВрд░реНрдг рдкрде рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ ([DYLD\_INSERT\_LIBRARIES рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ](macos-dyld-hijacking-and-dyld\_insert\_libraries.md#check-dyld\_insert\_librery-restrictions) рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП)

рдиреЛрдЯ: Apple рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдкрд░ "рдпреВрдирд┐рд╡рд░реНрд╕рд▓" рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ 32-рдмрд┐рдЯ рдФрд░ 64-рдмрд┐рдЯ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдХреЛрдИ рдЕрд▓рдЧ 32-рдмрд┐рдЯ рдФрд░ 64-рдмрд┐рдЯ рдЦреЛрдЬ рдкрде рдирд╣реАрдВ рд╣реИрдВ**ред

рдиреЛрдЯ: Apple рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдкрд░ рдЕрдзрд┐рдХрд╛рдВрд╢ OS dylibs **dyld рдХреИрд╢ рдореЗрдВ рд╕рдВрдпреЛрдЬрд┐рдд** рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдбрд┐рд╕реНрдХ рдкрд░ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **`stat()`** рдХреЙрд▓ рдХрд░рдирд╛ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ OS dylib рдореМрдЬреВрдж рд╣реИ **рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛**ред рд╣рд╛рд▓рд╛рдБрдХрд┐, **`dlopen_preflight()`** рдПрдХ рд╕рдВрдЧрдд mach-o рдлрд╝рд╛рдЗрд▓ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП **`dlopen()`** рдХреЗ рд╕рдорд╛рди рдЪрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред
{% endhint %}

**рдкрдереЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**

рдЖрдЗрдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХреЗ рд╕рд╛рде рд╕рднреА рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:
```c
// gcc dlopentest.c -o dlopentest -Wl,-rpath,/tmp/test
#include <dlfcn.h>
#include <stdio.h>

int main(void)
{
void* handle;

fprintf("--- No slash ---\n");
handle = dlopen("just_name_dlopentest.dylib",1);
if (!handle) {
fprintf(stderr, "Error loading: %s\n\n\n", dlerror());
}

fprintf("--- Relative framework ---\n");
handle = dlopen("a/framework/rel_framework_dlopentest.dylib",1);
if (!handle) {
fprintf(stderr, "Error loading: %s\n\n\n", dlerror());
}

fprintf("--- Abs framework ---\n");
handle = dlopen("/a/abs/framework/abs_framework_dlopentest.dylib",1);
if (!handle) {
fprintf(stderr, "Error loading: %s\n\n\n", dlerror());
}

fprintf("--- Relative Path ---\n");
handle = dlopen("a/folder/rel_folder_dlopentest.dylib",1);
if (!handle) {
fprintf(stderr, "Error loading: %s\n\n\n", dlerror());
}

fprintf("--- Abs Path ---\n");
handle = dlopen("/a/abs/folder/abs_folder_dlopentest.dylib",1);
if (!handle) {
fprintf(stderr, "Error loading: %s\n\n\n", dlerror());
}

return 0;
}
```
рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рд╕рдВрдХрд▓рд┐рдд рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ **рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рд▓рд┐рдП рдХрд╣рд╛рдБ рдЕрд╕рдлрд▓рддрд╛ рд╕реЗ рдЦреЛрдЬ рдХреА рдЧрдИ**ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдк **FS рд▓реЙрдЧ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
sudo fs_usage | grep "dlopentest"
```
## Relative Path Hijacking

рдпрджрд┐ рдПрдХ **privileged binary/app** (рдЬреИрд╕реЗ SUID рдпрд╛ рдХреБрдЫ рдмрд╛рдЗрдирд░реА рдЬрд┐рд╕рдореЗрдВ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ) рдПрдХ **рд╕рд╛рдкреЗрдХреНрд╖ рдкрде** рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ **рд▓реЛрдб рдХрд░ рд░рд╣рд╛ рд╣реИ** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `@executable_path` рдпрд╛ `@loader_path` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) рдФрд░ **Library Validation рдЕрдХреНрд╖рдо** рд╣реИ, рддреЛ рдпрд╣ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдмрд╛рдЗрдирд░реА рдХреЛ рдПрдХ рд╕реНрдерд╛рди рдкрд░ рд▓реЗ рдЬрд╛рдпрд╛ рдЬрд╛рдП рдЬрд╣рд╛рдБ рд╣рдорд▓рд╛рд╡рд░ **рд╕рд╛рдкреЗрдХреНрд╖ рдкрде рд▓реЛрдб рдХреА рдЧрдИ рд▓рд╛рдЗрдмреНрд░реЗрд░реА** рдХреЛ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХреЗ, рдФрд░ рдЗрд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗред

## Prune `DYLD_*` рдФрд░ `LD_LIBRARY_PATH` env variables

рдлрд╛рдЗрд▓ `dyld-dyld-832.7.1/src/dyld2.cpp` рдореЗрдВ **`pruneEnvironmentVariables`** рдирд╛рдордХ рдлрд╝рдВрдХреНрд╢рди рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдХрд┐рд╕реА рднреА env рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рд╣рдЯрд╛ рджреЗрдЧрд╛ рдЬреЛ **`DYLD_`** рдФрд░ **`LD_LIBRARY_PATH=`** рд╕реЗ **рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ**ред

рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **suid** рдФрд░ **sgid** рдмрд╛рдЗрдирд░реА рдХреЗ рд▓рд┐рдП env рд╡реЗрд░рд┐рдПрдмрд▓ **`DYLD_FALLBACK_FRAMEWORK_PATH`** рдФрд░ **`DYLD_FALLBACK_LIBRARY_PATH`** рдХреЛ **null** рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдЧрд╛ред

рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдЙрд╕реА рдлрд╝рд╛рдЗрд▓ рдХреЗ **`_main`** рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрджрд┐ OSX рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ:
```cpp
#if TARGET_OS_OSX
if ( !gLinkContext.allowEnvVarsPrint && !gLinkContext.allowEnvVarsPath && !gLinkContext.allowEnvVarsSharedCache ) {
pruneEnvironmentVariables(envp, &apple);
```
рдФрд░ рдЙрди рдмреВрд▓рд┐рдпрди рдлреНрд▓реИрдЧреНрд╕ рдХреЛ рдХреЛрдб рдореЗрдВ рдЙрд╕реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```cpp
#if TARGET_OS_OSX
// support chrooting from old kernel
bool isRestricted = false;
bool libraryValidation = false;
// any processes with setuid or setgid bit set or with __RESTRICT segment is restricted
if ( issetugid() || hasRestrictedSegment(mainExecutableMH) ) {
isRestricted = true;
}
bool usingSIP = (csr_check(CSR_ALLOW_TASK_FOR_PID) != 0);
uint32_t flags;
if ( csops(0, CS_OPS_STATUS, &flags, sizeof(flags)) != -1 ) {
// On OS X CS_RESTRICT means the program was signed with entitlements
if ( ((flags & CS_RESTRICT) == CS_RESTRICT) && usingSIP ) {
isRestricted = true;
}
// Library Validation loosens searching but requires everything to be code signed
if ( flags & CS_REQUIRE_LV ) {
isRestricted = false;
libraryValidation = true;
}
}
gLinkContext.allowAtPaths                = !isRestricted;
gLinkContext.allowEnvVarsPrint           = !isRestricted;
gLinkContext.allowEnvVarsPath            = !isRestricted;
gLinkContext.allowEnvVarsSharedCache     = !libraryValidation || !usingSIP;
gLinkContext.allowClassicFallbackPaths   = !isRestricted;
gLinkContext.allowInsertFailures         = false;
gLinkContext.allowInterposing         	 = true;
```
рдЬреЛ рдореВрд▓ рд░реВрдк рд╕реЗ рдпрд╣ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрджрд┐ рдмрд╛рдЗрдирд░реА **suid** рдпрд╛ **sgid** рд╣реИ, рдпрд╛ рдЗрд╕рдХреЗ рд╣реЗрдбрд░ рдореЗрдВ **RESTRICT** рдЦрдВрдб рд╣реИ рдпрд╛ рдЗрд╕реЗ **CS\_RESTRICT** рдзреНрд╡рдЬ рдХреЗ рд╕рд╛рде рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ **`!gLinkContext.allowEnvVarsPrint && !gLinkContext.allowEnvVarsPath && !gLinkContext.allowEnvVarsSharedCache`** рд╕рддреНрдп рд╣реИ рдФрд░ env рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЛ рд╣рдЯрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ CS\_REQUIRE\_LV рд╕рддреНрдп рд╣реИ, рддреЛ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЛ рдирд╣реАрдВ рд╣рдЯрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рд▓реЗрдХрд┐рди рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдорд╛рдиреНрдпрддрд╛ рдпрд╣ рдЬрд╛рдВрдЪреЗрдЧреА рдХрд┐ рд╡реЗ рдореВрд▓ рдмрд╛рдЗрдирд░реА рдХреЗ рд╕рдорд╛рди рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВред

## рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ

### SUID & SGID
```bash
# Make it owned by root and suid
sudo chown root hello
sudo chmod +s hello
# Insert the library
DYLD_INSERT_LIBRARIES=inject.dylib ./hello

# Remove suid
sudo chmod -s hello
```
### Section `__RESTRICT` with segment `__restrict`
```bash
gcc -sectcreate __RESTRICT __restrict /dev/null hello.c -o hello-restrict
DYLD_INSERT_LIBRARIES=inject.dylib ./hello-restrict
```
### Hardened runtime

Keychain рдореЗрдВ рдПрдХ рдирдпрд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдмрдирд╛рдПрдВ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрд╛рдЗрдирд░реА рдкрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВ:

{% code overflow="wrap" %}
```bash
# Apply runtime proetction
codesign -s <cert-name> --option=runtime ./hello
DYLD_INSERT_LIBRARIES=inject.dylib ./hello #Library won't be injected

# Apply library validation
codesign -f -s <cert-name> --option=library ./hello
DYLD_INSERT_LIBRARIES=inject.dylib ./hello-signed #Will throw an error because signature of binary and library aren't signed by same cert (signs must be from a valid Apple-signed developer certificate)

# Sign it
## If the signature is from an unverified developer the injection will still work
## If it's from a verified developer, it won't
codesign -f -s <cert-name> inject.dylib
DYLD_INSERT_LIBRARIES=inject.dylib ./hello-signed

# Apply CS_RESTRICT protection
codesign -f -s <cert-name> --option=restrict hello-signed
DYLD_INSERT_LIBRARIES=inject.dylib ./hello-signed # Won't work
```
{% endcode %}

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рднрд▓реЗ рд╣реА рдХреБрдЫ рдмрд╛рдЗрдирд░реАрдЬрд╝ **`0x0(none)`** рдлреНрд▓реИрдЧ рдХреЗ рд╕рд╛рде рд╕рд╛рдЗрди рдХреА рдЧрдИ рд╣реЛрдВ, рд╡реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдкрд░ **`CS_RESTRICT`** рдлреНрд▓реИрдЧ рдХреЛ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреА рд╣реИрдВ рдФрд░ рдЗрд╕рд▓рд┐рдП рдпрд╣ рддрдХрдиреАрдХ рдЙрди рдкрд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧреАред

рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХрд┐рд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдпрд╣ рдлреНрд▓реИрдЧ рд╣реИ рдпрд╛ рдирд╣реАрдВ (get [**csops here**](https://github.com/axelexic/CSOps)):
```bash
csops -status <pid>
```
рдФрд░ рдлрд┐рд░ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдлреНрд▓реИрдЧ 0x800 рд╕рдХреНрд╖рдо рд╣реИред
{% endhint %}

## рд╕рдВрджрд░реНрдн

* [https://theevilbit.github.io/posts/dyld\_insert\_libraries\_dylib\_injection\_in\_macos\_osx\_deep\_dive/](https://theevilbit.github.io/posts/dyld\_insert\_libraries\_dylib\_injection\_in\_macos\_osx\_deep\_dive/)
* [**\*OS Internals, Volume I: User Mode. By Jonathan Levin**](https://www.amazon.com/MacOS-iOS-Internals-User-Mode/dp/099105556X)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рд╣рдореЗрдВ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред**

</details>
{% endhint %}
