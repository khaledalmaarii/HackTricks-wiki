# macOS рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд░рдХреНрд╖рд╛

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## рдЧреЗрдЯрдХреАрдкрд░

рдЧреЗрдЯрдХреАрдкрд░ рдЖрдорддреМрд░ рдкрд░ **Quarantine + Gatekeeper + XProtect** рдХреЗ рд╕рдВрдпреЛрдЬрди рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ 3 macOS рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓ рд╣реИрдВ рдЬреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВрдЧреЗред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП:

{% content-ref url="macos-gatekeeper.md" %}
[macos-gatekeeper.md](macos-gatekeeper.md)
{% endcontent-ref %}

## рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рд╕реАрдорд╛рдПрдБ

### SIP - рд╕рд┐рд╕реНрдЯрдо рдЗрдВрдЯреАрдЧреНрд░рд┐рдЯреА рдкреНрд░реЛрдЯреЗрдХреНрд╢рди

{% content-ref url="macos-sip.md" %}
[macos-sip.md](macos-sip.md)
{% endcontent-ref %}

### рд╕реИрдВрдбрдмреЙрдХреНрд╕

MacOS рд╕реИрдВрдбрдмреЙрдХреНрд╕ **рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рдЕрдВрджрд░ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ** рдХреЛ **рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЕрдиреБрдордд рдХреНрд░рд┐рдпрд╛рдУрдВ** рддрдХ рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЗрд╡рд▓ рдЕрдкреЗрдХреНрд╖рд┐рдд рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд░рд╣рд╛ рд╣реИ**ред

{% content-ref url="macos-sandbox/" %}
[macos-sandbox](macos-sandbox/)
{% endcontent-ref %}

### TCC - **рдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛, рд╕рд╣рдорддрд┐, рдФрд░ рдирд┐рдпрдВрддреНрд░рдг**

**TCC (рдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛, рд╕рд╣рдорддрд┐, рдФрд░ рдирд┐рдпрдВрддреНрд░рдг)** рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдврд╛рдВрдЪрд╛ рд╣реИред рдпрд╣ **рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рддрдХ рдЙрдирдХреА рдкрд╣реБрдБрдЪ рдХреЛ рд╡рд┐рдирд┐рдпрдорд┐рдд рдХрд░рдХреЗред рдЗрд╕рдореЗрдВ **рд╕реНрдерд╛рди рд╕реЗрд╡рд╛рдПрдБ, рд╕рдВрдкрд░реНрдХ, рдлрд╝реЛрдЯреЛ, рдорд╛рдЗрдХреНрд░реЛрдлрд╝реЛрди, рдХреИрдорд░рд╛, рдкрд╣реБрдБрдЪ, рдФрд░ рдкреВрд░реНрдг рдбрд┐рд╕реНрдХ рдкрд╣реБрдБрдЪ** рдЬреИрд╕реА рддрддреНрд╡ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред TCC рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдРрдкреНрд╕ рдХреЗрд╡рд▓ рд╕реНрдкрд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рд╣рдорддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЗрди рд╕реБрд╡рд┐рдзрд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдбреЗрдЯрд╛ рдкрд░ рдЧреЛрдкрдиреАрдпрддрд╛ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИред

{% content-ref url="macos-tcc/" %}
[macos-tcc](macos-tcc/)
{% endcontent-ref %}

### рд▓реЙрдиреНрдЪ/рдкрд░реНрдпрд╛рд╡рд░рдг рдкреНрд░рддрд┐рдмрдВрдз рдФрд░ рдЯреНрд░рд╕реНрдЯ рдХреИрд╢

macOS рдореЗрдВ рд▓реЙрдиреНрдЪ рдкреНрд░рддрд┐рдмрдВрдз рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдЬреЛ **рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреНрд░рд╛рд░рдВрдн рдХреЛ рд╡рд┐рдирд┐рдпрдорд┐рдд** рдХрд░рддреА рд╣реИ, рдпрд╣ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдХреЗ рдХрд┐ **рдХреМрди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд▓реЙрдиреНрдЪ рдХрд░ рд╕рдХрддрд╛ рд╣реИ**, **рдХреИрд╕реЗ**, рдФрд░ **рдХрд╣рд╛рдБ рд╕реЗ**ред macOS рд╡реЗрдВрдЪреБрд░рд╛ рдореЗрдВ рдкреЗрд╢ рдХрд┐рдП рдЧрдП, рдпреЗ рд╕рд┐рд╕реНрдЯрдо рдмрд╛рдЗрдирд░реАрдЬрд╝ рдХреЛ **рдЯреНрд░рд╕реНрдЯ рдХреИрд╢** рдХреЗ рднреАрддрд░ рдкреНрд░рддрд┐рдмрдВрдз рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдореЗрдВ рд╡рд░реНрдЧреАрдХреГрдд рдХрд░рддреЗ рд╣реИрдВред рдкреНрд░рддреНрдпреЗрдХ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдмрд╛рдЗрдирд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ **рд▓реЙрдиреНрдЪ** рдХреЗ рд▓рд┐рдП **рдирд┐рдпрдо** рд╕реЗрдЯ рд╣реЛрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ **рд╕реНрд╡рдпрдВ**, **рдорд╛рддрд╛-рдкрд┐рддрд╛**, рдФрд░ **рдЬрд┐рдореНрдореЗрджрд╛рд░** рдкреНрд░рддрд┐рдмрдВрдз рд╢рд╛рдорд┐рд▓ рд╣реИрдВред macOS рд╕реЛрдиреЛрдорд╛ рдореЗрдВ рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ рдРрдкреНрд╕ рдХреЗ рд▓рд┐рдП **рдкрд░реНрдпрд╛рд╡рд░рдг** рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд, рдпреЗ рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд▓реЙрдиреНрдЪрд┐рдВрдЧ рдХреА рд╢рд░реНрддреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд рд╕рд┐рд╕реНрдЯрдо рд╢реЛрд╖рдг рдХреЛ рдХрдо рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреА рд╣реИрдВред

{% content-ref url="macos-launch-environment-constraints.md" %}
[macos-launch-environment-constraints.md](macos-launch-environment-constraints.md)
{% endcontent-ref %}

## MRT - рдореИрд▓рд╡реЗрдпрд░ рд╣рдЯрд╛рдиреЗ рдХрд╛ рдЙрдкрдХрд░рдг

рдореИрд▓рд╡реЗрдпрд░ рд╣рдЯрд╛рдиреЗ рдХрд╛ рдЙрдкрдХрд░рдг (MRT) macOS рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдЕрд╡рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдПрдХ рдФрд░ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред рдЬреИрд╕рд╛ рдХрд┐ рдирд╛рдо рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ, MRT рдХрд╛ рдореБрдЦреНрдп рдХрд╛рд░реНрдп **рд╕рдВрдХреНрд░рдорд┐рдд рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдЬреНрдЮрд╛рдд рдореИрд▓рд╡реЗрдпрд░ рдХреЛ рд╣рдЯрд╛рдирд╛** рд╣реИред

рдПрдХ рдмрд╛рд░ рдЬрдм рдореИрд▓рд╡реЗрдпрд░ Mac рдкрд░ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдпрд╛ рддреЛ XProtect рджреНрд╡рд╛рд░рд╛ рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рддрд░реАрдХреЗ рд╕реЗ), MRT рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ **рдореИрд▓рд╡реЗрдпрд░ рдХреЛ рд╣рдЯрд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред MRT рдЪреБрдкрдЪрд╛рдк рдкреГрд╖реНрдарднреВрдорд┐ рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЖрдорддреМрд░ рдкрд░ рддрдм рдЪрд▓рддрд╛ рд╣реИ рдЬрдм рд╕рд┐рд╕реНрдЯрдо рдЕрдкрдбреЗрдЯ рд╣реЛрддрд╛ рд╣реИ рдпрд╛ рдЬрдм рдПрдХ рдирдпрд╛ рдореИрд▓рд╡реЗрдпрд░ рдкрд░рд┐рднрд╛рд╖рд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдпрд╣ рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдореИрд▓рд╡реЗрдпрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП MRT рдХреЗ рдкрд╛рд╕ рдирд┐рдпрдо рдмрд╛рдЗрдирд░реА рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ)ред

рд╣рд╛рд▓рд╛рдВрдХрд┐ XProtect рдФрд░ MRT рджреЛрдиреЛрдВ macOS рдХреЗ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВ, рд╡реЗ рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реИрдВ:

* **XProtect** рдПрдХ рдирд┐рд╡рд╛рд░рдХ рдЙрдкрдХрд░рдг рд╣реИред рдпрд╣ **рдлрд╛рдЗрд▓реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕реЗ рд╣реА рд╡реЗ рдбрд╛рдЙрдирд▓реЛрдб рд╣реЛрддреА рд╣реИрдВ** (рдХреБрдЫ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ), рдФрд░ рдпрджрд┐ рдпрд╣ рдЬреНрдЮрд╛рдд рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрд┐рд╕реА рднреА рдореИрд▓рд╡реЗрдпрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ **рдлрд╛рдЗрд▓ рдХреЛ рдЦреЛрд▓рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ**, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдореИрд▓рд╡реЗрдпрд░ рдХреЛ рдЖрдкрдХреЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИред
* **MRT**, рджреВрд╕рд░реА рдУрд░, рдПрдХ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рд╢реАрд▓ рдЙрдкрдХрд░рдг** рд╣реИред рдпрд╣ рдЙрд╕ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдореИрд▓рд╡реЗрдпрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рдмрд╛рдж рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рд▓рдХреНрд╖реНрдп offending рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рд╣рдЯрд╛рдирд╛ рд╣реИ рддрд╛рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╕рд╛рдл рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

MRT рдПрдкреНрд▓рд┐рдХреЗрд╢рди **`/Library/Apple/System/Library/CoreServices/MRT.app`** рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред

## рдкреГрд╖реНрдарднреВрдорд┐ рдХрд╛рд░реНрдп рдкреНрд░рдмрдВрдзрди

**macOS** рдЕрдм **рд╣рд░ рдмрд╛рд░ рдПрдХ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рдЕрд▓рд░реНрдЯ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЬреНрдЮрд╛рдд рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ** (рдЬреИрд╕реЗ рд▓реЙрдЧрд┐рди рдЖрдЗрдЯрдо, рдбреЗрдорди...), рддрд╛рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмреЗрд╣рддрд░ рддрд░реАрдХреЗ рд╕реЗ рдЬрд╛рди рд╕рдХреЗ **рдХреМрди рд╕рд╛ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдмрдирд╛ рд╣реБрдЖ рд╣реИ**ред

<figure><img src="../../../.gitbook/assets/image (1183).png" alt=""><figcaption></figcaption></figure>

рдпрд╣ **`/System/Library/PrivateFrameworks/BackgroundTaskManagement.framework/Versions/A/Resources/backgroundtaskmanagementd`** рдореЗрдВ рд╕реНрдерд┐рдд рдПрдХ **рдбреЗрдорди** рдХреЗ рд╕рд╛рде рдЪрд▓рддрд╛ рд╣реИ рдФрд░ **рдПрдЬреЗрдВрдЯ** **`/System/Library/PrivateFrameworks/BackgroundTaskManagement.framework/Support/BackgroundTaskManagementAgent.app`** рдореЗрдВ рд╣реИред

**`backgroundtaskmanagementd`** рдХреЛ рдпрд╣ рдЬрд╛рдирдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ рдХрд┐ рдХреБрдЫ рд╕реНрдерд╛рдпреА рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рд╣реИ **FSEvents рдкреНрд░рд╛рдкреНрдд рдХрд░рдХреЗ** рдФрд░ рдЙрдирдХреЗ рд▓рд┐рдП рдХреБрдЫ **рд╣реИрдВрдбрд▓рд░реНрд╕** рдмрдирд╛рдХрд░ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ plist рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдЬреНрдЮрд╛рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ** рдХреА рд╕реВрдЪреА рд╣реИ рдЬреЛ рдЕрдХреНрд╕рд░ рдмрдирд╛рдП рд░рдЦреА рдЬрд╛рддреА рд╣реИ, рдЬреЛ рдПрдкреНрдкрд▓ рджреНрд╡рд╛рд░рд╛ рд░рдЦреА рдЬрд╛рддреА рд╣реИ, рдЬреЛ рд╕реНрдерд┐рдд рд╣реИ: **`/System/Library/PrivateFrameworks/BackgroundTaskManagement.framework/Versions/A/Resources/attributions.plist`**
```json
[...]
"us.zoom.ZoomDaemon" => {
"AssociatedBundleIdentifiers" => [
0 => "us.zoom.xos"
]
"Attribution" => "Zoom"
"Program" => "/Library/PrivilegedHelperTools/us.zoom.ZoomDaemon"
"ProgramArguments" => [
0 => "/Library/PrivilegedHelperTools/us.zoom.ZoomDaemon"
]
"TeamIdentifier" => "BJ4HAAB9B3"
}
[...]
```
### Enumeration

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рд╕рднреА** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдЖрдЗрдЯрдореНрд╕ рдХреЛ рдПрдкреНрдкрд▓ CLI рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧрд┐рдирддреА рдХреА рдЬрд╛рдП:
```bash
# The tool will always ask for the users password
sfltool dumpbtm
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ [**DumpBTM**](https://github.com/objective-see/DumpBTM) рдХреЗ рд╕рд╛рде рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИред
```bash
# You need to grant the Terminal Full Disk Access for this to work
chmod +x dumpBTM
xattr -rc dumpBTM # Remove quarantine attr
./dumpBTM
```
рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА **`/private/var/db/com.apple.backgroundtaskmanagement/BackgroundItems-v4.btm`** рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛ рд░рд╣реА рд╣реИ рдФрд░ рдЯрд░реНрдорд┐рдирд▓ рдХреЛ FDA рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

### BTM рдХреЗ рд╕рд╛рде рдЫреЗрдбрд╝рдЫрд╛рдбрд╝

рдЬрдм рдПрдХ рдирдИ рд╕реНрдерд┐рд░рддрд╛ рдкрд╛рдИ рдЬрд╛рддреА рд╣реИ, рддреЛ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА рдШрдЯрдирд╛ **`ES_EVENT_TYPE_NOTIFY_BTM_LAUNCH_ITEM_ADD`** рд╣реЛрддреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рдЗрд╕ **рдШрдЯрдирд╛** рдХреЛ рднреЗрдЬрдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдпрд╛ **рдПрдЬреЗрдВрдЯ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЪреЗрддрд╛рд╡рдиреА рджреЗрдиреЗ** рд╕реЗ рдХрд┐рд╕реА рд╣рдорд▓рд╛рд╡рд░ рдХреЛ BTM рдХреЛ _**рдмрд╛рдпрдкрд╛рд╕**_ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдорд┐рд▓реЗрдЧреАред

* **рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░рдирд╛**: рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдЪрд▓рд╛рдиреЗ рд╕реЗ рдбреЗрдЯрд╛рдмреЗрд╕ рд░реАрд╕реЗрдЯ рд╣реЛ рдЬрд╛рдПрдЧрд╛ (рдЗрд╕реЗ рдЬрдореАрди рд╕реЗ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рд┐рдП), рд╣рд╛рд▓рд╛рдБрдХрд┐, рдХрд┐рд╕реА рдХрд╛рд░рдгрд╡рд╢, рдЗрд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреЗ рдмрд╛рдж, **рдХреЛрдИ рдирдИ рд╕реНрдерд┐рд░рддрд╛ рддрдм рддрдХ рдЪреЗрддрд╛рд╡рдиреА рдирд╣реАрдВ рджреА рдЬрд╛рдПрдЧреА рдЬрдм рддрдХ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛**ред
* **root** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред
```bash
# Reset the database
sfltool resettbtm
```
* **рдПрдЬреЗрдВрдЯ рдХреЛ рд░реЛрдХреЗрдВ**: рдПрдЬреЗрдВрдЯ рдХреЛ рдПрдХ рд╕реНрдЯреЙрдк рд╕рд┐рдЧреНрдирд▓ рднреЗрдЬрдирд╛ рд╕рдВрднрд╡ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕реВрдЪрд┐рдд рди рдХрд░реЗ** рдЬрдм рдирдИ рдкрд╣рдЪрд╛рди рдХреА рдЬрд╛рддреА рд╣реИрдВред
```bash
# Get PID
pgrep BackgroundTaskManagementAgent
1011

# Stop it
kill -SIGSTOP 1011

# Check it's stopped (a T means it's stopped)
ps -o state 1011
T
```
* **рдмрдЧ**: рдпрджрд┐ **рд╕реНрдерд╛рдпреАрддрд╛ рдмрдирд╛рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рддреБрд░рдВрдд рдЙрд╕рдХреЗ рдмрд╛рдж рдореМрдЬреВрдж рд╣реИ**, рддреЛ рдбреЗрдорди **рдЗрд╕рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛, **рдЕрд╕рдлрд▓** рд╣реЛрдЧрд╛, рдФрд░ **рдирдП рдЪреАрдЬрд╝ рдХреЗ рд╕реНрдерд╛рдпреА рд╣реЛрдиреЗ** рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрдиреЗ рд╡рд╛рд▓рд╛ рдЗрд╡реЗрдВрдЯ рднреЗрдЬрдиреЗ рдореЗрдВ **рдЕрд╕рдорд░реНрде** рд╣реЛрдЧрд╛ред

рд╕рдВрджрд░реНрдн рдФрд░ **BTM рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**:

* [https://youtu.be/9hjUmT031tc?t=26481](https://youtu.be/9hjUmT031tc?t=26481)
* [https://www.patreon.com/posts/new-developer-77420730?l=fr](https://www.patreon.com/posts/new-developer-77420730?l=fr)
* [https://support.apple.com/en-gb/guide/deployment/depdca572563/web](https://support.apple.com/en-gb/guide/deployment/depdca572563/web)
{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
</details>
