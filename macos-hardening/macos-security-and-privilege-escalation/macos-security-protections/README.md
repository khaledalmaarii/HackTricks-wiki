# macOSå®‰å…¨ä¿æŠ¤

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## Gatekeeper

**Gatekeeper**æ˜¯ä¸ºMacæ“ä½œç³»ç»Ÿå¼€å‘çš„å®‰å…¨åŠŸèƒ½ï¼Œæ—¨åœ¨ç¡®ä¿ç”¨æˆ·åœ¨å…¶ç³»ç»Ÿä¸Š**åªè¿è¡Œå¯ä¿¡ä»»çš„è½¯ä»¶**ã€‚å®ƒé€šè¿‡**éªŒè¯ç”¨æˆ·ä»App Storeä¹‹å¤–çš„æ¥æºä¸‹è½½å¹¶å°è¯•æ‰“å¼€çš„è½¯ä»¶**ï¼ˆå¦‚åº”ç”¨ç¨‹åºã€æ’ä»¶æˆ–å®‰è£…ç¨‹åºåŒ…ï¼‰æ¥å®ç°ã€‚

Gatekeeperçš„å…³é”®æœºåˆ¶åœ¨äºå…¶**éªŒè¯**è¿‡ç¨‹ã€‚å®ƒæ£€æŸ¥ä¸‹è½½çš„è½¯ä»¶æ˜¯å¦ç”±**å·²çŸ¥å¼€å‘è€…ç­¾å**ï¼Œç¡®ä¿è½¯ä»¶çš„çœŸå®æ€§ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜ç¡®å®šè½¯ä»¶æ˜¯å¦ç»è¿‡äº†**Appleçš„å…¬è¯**ï¼Œä»¥ç¡®è®¤å…¶ä¸åŒ…å«å·²çŸ¥çš„æ¶æ„å†…å®¹ï¼Œå¹¶ä¸”åœ¨å…¬è¯åæ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

æ­¤å¤–ï¼ŒGatekeeperé€šè¿‡**æç¤ºç”¨æˆ·æ‰¹å‡†é¦–æ¬¡æ‰“å¼€**ä¸‹è½½çš„è½¯ä»¶æ¥åŠ å¼ºç”¨æˆ·æ§åˆ¶å’Œå®‰å…¨æ€§ã€‚è¿™ä¸ªä¿æŠ¤æªæ–½æœ‰åŠ©äºé˜²æ­¢ç”¨æˆ·æ— æ„ä¸­è¿è¡Œå¯èƒ½æœ‰å®³çš„å¯æ‰§è¡Œä»£ç ï¼Œè€Œä»–ä»¬å¯èƒ½å°†å…¶è¯¯è®¤ä¸ºæ˜¯æ— å®³çš„æ•°æ®æ–‡ä»¶ã€‚
```bash
# Check the status
spctl --status
# Enable Gatekeeper
sudo spctl --master-enable
# Disable Gatekeeper
sudo spctl --master-disable
```
### åº”ç”¨ç¨‹åºç­¾å

åº”ç”¨ç¨‹åºç­¾åï¼Œä¹Ÿç§°ä¸ºä»£ç ç­¾åï¼Œæ˜¯è‹¹æœå®‰å…¨åŸºç¡€è®¾æ–½çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚å®ƒä»¬ç”¨äºéªŒè¯è½¯ä»¶ä½œè€…ï¼ˆå¼€å‘è€…ï¼‰çš„èº«ä»½ï¼Œå¹¶ç¡®ä¿ä»£ç è‡ªä¸Šæ¬¡ç­¾åä»¥æ¥æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ä»¥ä¸‹æ˜¯å…¶å·¥ä½œåŸç†ï¼š

1. **ç­¾ç½²åº”ç”¨ç¨‹åºï¼š** å½“å¼€å‘è€…å‡†å¤‡åˆ†å‘ä»–ä»¬çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œä»–ä»¬ä½¿ç”¨ç§é’¥å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œç­¾åã€‚è¿™ä¸ªç§é’¥ä¸è‹¹æœå¼€å‘è€…è®¡åˆ’ä¸­å¼€å‘è€…æ³¨å†Œæ—¶è‹¹æœé¢å‘ç»™ä»–ä»¬çš„è¯ä¹¦ç›¸å…³è”ã€‚ç­¾åè¿‡ç¨‹æ¶‰åŠå¯¹åº”ç”¨ç¨‹åºçš„æ‰€æœ‰éƒ¨åˆ†åˆ›å»ºä¸€ä¸ªåŠ å¯†å“ˆå¸Œï¼Œå¹¶ä½¿ç”¨å¼€å‘è€…çš„ç§é’¥å¯¹è¯¥å“ˆå¸Œè¿›è¡ŒåŠ å¯†ã€‚
2. **åˆ†å‘åº”ç”¨ç¨‹åºï¼š** ç­¾åçš„åº”ç”¨ç¨‹åºéšåä¸å¼€å‘è€…çš„è¯ä¹¦ä¸€èµ·åˆ†å‘ç»™ç”¨æˆ·ï¼Œè¯¥è¯ä¹¦åŒ…å«ç›¸åº”çš„å…¬é’¥ã€‚
3. **éªŒè¯åº”ç”¨ç¨‹åºï¼š** å½“ç”¨æˆ·ä¸‹è½½å¹¶å°è¯•è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œä»–ä»¬çš„Macæ“ä½œç³»ç»Ÿä½¿ç”¨å¼€å‘è€…è¯ä¹¦ä¸­çš„å…¬é’¥æ¥è§£å¯†å“ˆå¸Œã€‚ç„¶åï¼Œå®ƒæ ¹æ®åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€é‡æ–°è®¡ç®—å“ˆå¸Œï¼Œå¹¶å°†å…¶ä¸è§£å¯†çš„å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå®ƒä»¬åŒ¹é…ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºè‡ªå¼€å‘è€…ç­¾åä»¥æ¥**æ²¡æœ‰è¢«ä¿®æ”¹**ï¼Œç³»ç»Ÿå…è®¸åº”ç”¨ç¨‹åºè¿è¡Œã€‚

åº”ç”¨ç¨‹åºç­¾åæ˜¯è‹¹æœGatekeeperæŠ€æœ¯çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å½“ç”¨æˆ·å°è¯•**æ‰“å¼€ä»äº’è”ç½‘ä¸‹è½½çš„åº”ç”¨ç¨‹åº**æ—¶ï¼ŒGatekeeperä¼šéªŒè¯åº”ç”¨ç¨‹åºçš„ç­¾åã€‚å¦‚æœå®ƒä½¿ç”¨è‹¹æœé¢å‘ç»™å·²çŸ¥å¼€å‘è€…çš„è¯ä¹¦è¿›è¡Œç­¾åï¼Œå¹¶ä¸”ä»£ç æ²¡æœ‰è¢«ç¯¡æ”¹ï¼ŒGatekeeperå…è®¸åº”ç”¨ç¨‹åºè¿è¡Œã€‚å¦åˆ™ï¼Œå®ƒä¼šé˜»æ­¢åº”ç”¨ç¨‹åºå¹¶å‘ç”¨æˆ·å‘å‡ºè­¦æŠ¥ã€‚

ä»macOS Catalinaå¼€å§‹ï¼ŒGatekeeperè¿˜ä¼šæ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦å·²è¢«è‹¹æœ**å…¬è¯**ï¼Œå¢åŠ äº†é¢å¤–çš„å®‰å…¨å±‚ã€‚å…¬è¯è¿‡ç¨‹ä¼šæ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦å­˜åœ¨å·²çŸ¥çš„å®‰å…¨é—®é¢˜å’Œæ¶æ„ä»£ç ï¼Œå¦‚æœè¿™äº›æ£€æŸ¥é€šè¿‡ï¼Œè‹¹æœä¼šå‘åº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ªGatekeeperå¯ä»¥éªŒè¯çš„å‡­è¯ã€‚

#### æ£€æŸ¥ç­¾å

åœ¨æ£€æŸ¥ä¸€äº›**æ¶æ„è½¯ä»¶æ ·æœ¬**æ—¶ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆ**æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶çš„ç­¾å**ï¼Œå› ä¸ºç­¾åå®ƒçš„**å¼€å‘è€…**å¯èƒ½å·²ç»ä¸**æ¶æ„è½¯ä»¶**æœ‰å…³ã€‚
```bash
# Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

# Check if the appâ€™s contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s <cert-name-keychain> toolsdemo
```
### éªŒè¯

è‹¹æœçš„éªŒè¯æµç¨‹æ˜¯ä¸ºäº†ä¿æŠ¤ç”¨æˆ·å…å—æ½œåœ¨æœ‰å®³è½¯ä»¶çš„é¢å¤–ä¿éšœã€‚å®ƒæ¶‰åŠå¼€å‘è€…å°†ä»–ä»¬çš„åº”ç”¨ç¨‹åºæäº¤ç»™è‹¹æœçš„éªŒè¯æœåŠ¡è¿›è¡Œå®¡æŸ¥ï¼Œè¿™ä¸åº”ç”¨å®¡æ ¸ä¸åŒã€‚è¿™ä¸ªæœåŠ¡æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–ç³»ç»Ÿï¼Œä¼šå¯¹æäº¤çš„è½¯ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œä»¥æŸ¥æ‰¾æ¶æ„å†…å®¹å’Œä»£ç ç­¾åå¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚

å¦‚æœè½¯ä»¶é€šè¿‡äº†è¿™ä¸ªæ£€æŸ¥è€Œæ²¡æœ‰å¼•èµ·ä»»ä½•å…³æ³¨ï¼ŒéªŒè¯æœåŠ¡ä¼šç”Ÿæˆä¸€ä¸ªéªŒè¯ç¥¨æ®ã€‚ç„¶åï¼Œå¼€å‘è€…éœ€è¦å°†è¿™ä¸ªç¥¨æ®é™„åŠ åˆ°ä»–ä»¬çš„è½¯ä»¶ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œè£…è®¢â€ã€‚æ­¤å¤–ï¼ŒéªŒè¯ç¥¨æ®ä¹Ÿä¼šåœ¨ç½‘ä¸Šå‘å¸ƒï¼Œè‹¹æœçš„å®‰å…¨æŠ€æœ¯Gatekeeperå¯ä»¥è®¿é—®å®ƒã€‚

å½“ç”¨æˆ·é¦–æ¬¡å®‰è£…æˆ–æ‰§è¡Œè½¯ä»¶æ—¶ï¼ŒéªŒè¯ç¥¨æ®çš„å­˜åœ¨ï¼ˆæ— è®ºæ˜¯é™„åŠ åˆ°å¯æ‰§è¡Œæ–‡ä»¶è¿˜æ˜¯åœ¨çº¿æ‰¾åˆ°çš„ï¼‰ä¼šé€šçŸ¥Gatekeeperè¯¥è½¯ä»¶å·²ç”±è‹¹æœè¿›è¡Œäº†éªŒè¯ã€‚å› æ­¤ï¼ŒGatekeeperåœ¨åˆå§‹å¯åŠ¨å¯¹è¯æ¡†ä¸­æ˜¾ç¤ºä¸€ä¸ªæè¿°æ€§æ¶ˆæ¯ï¼ŒæŒ‡ç¤ºè¯¥è½¯ä»¶å·²ç»ç»è¿‡è‹¹æœçš„æ¶æ„å†…å®¹æ£€æŸ¥ã€‚è¿™ä¸ªè¿‡ç¨‹å¢å¼ºäº†ç”¨æˆ·å¯¹ä»–ä»¬åœ¨ç³»ç»Ÿä¸Šå®‰è£…æˆ–è¿è¡Œçš„è½¯ä»¶çš„å®‰å…¨ä¿¡å¿ƒã€‚

### éš”ç¦»æ–‡ä»¶

åœ¨ä¸‹è½½åº”ç”¨ç¨‹åºæˆ–æ–‡ä»¶æ—¶ï¼Œç‰¹å®šçš„ macOS åº”ç”¨ç¨‹åºï¼ˆå¦‚ç½‘ç»œæµè§ˆå™¨æˆ–ç”µå­é‚®ä»¶å®¢æˆ·ç«¯ï¼‰ä¼šå°†ä¸€ä¸ªç§°ä¸ºâ€œéš”ç¦»æ ‡å¿—â€çš„æ‰©å±•æ–‡ä»¶å±æ€§é™„åŠ åˆ°ä¸‹è½½çš„æ–‡ä»¶ä¸Šã€‚è¿™ä¸ªå±æ€§ä½œä¸ºä¸€ä¸ªå®‰å…¨æªæ–½ï¼Œå°†æ–‡ä»¶æ ‡è®°ä¸ºæ¥è‡ªä¸å—ä¿¡ä»»çš„æ¥æºï¼ˆäº’è”ç½‘ï¼‰ï¼Œå¹¶å¯èƒ½å¸¦æœ‰é£é™©ã€‚ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½ä¼šé™„åŠ è¿™ä¸ªå±æ€§ï¼Œä¾‹å¦‚ï¼Œå¸¸è§çš„ BitTorrent å®¢æˆ·ç«¯è½¯ä»¶é€šå¸¸ä¼šç»•è¿‡è¿™ä¸ªè¿‡ç¨‹ã€‚

å½“ç”¨æˆ·å°è¯•æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œéš”ç¦»æ ‡å¿—çš„å­˜åœ¨ä¼šå‘ macOS çš„ Gatekeeper å®‰å…¨åŠŸèƒ½å‘å‡ºä¿¡å·ã€‚

åœ¨æ²¡æœ‰éš”ç¦»æ ‡å¿—çš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚é€šè¿‡æŸäº› BitTorrent å®¢æˆ·ç«¯ä¸‹è½½çš„æ–‡ä»¶ï¼‰ï¼ŒGatekeeper çš„æ£€æŸ¥å¯èƒ½ä¸ä¼šæ‰§è¡Œã€‚å› æ­¤ï¼Œç”¨æˆ·åœ¨æ‰“å¼€ä»ä¸å¤ªå®‰å…¨æˆ–æœªçŸ¥æ¥æºä¸‹è½½çš„æ–‡ä»¶æ—¶åº”è°¨æ…ã€‚

{% hint style="info" %}
éªŒè¯ä»£ç ç­¾åçš„æœ‰æ•ˆæ€§æ˜¯ä¸€ä¸ªèµ„æºå¯†é›†å‹çš„è¿‡ç¨‹ï¼Œå®ƒåŒ…æ‹¬ç”Ÿæˆä»£ç åŠå…¶æ‰€æœ‰æ†ç»‘èµ„æºçš„åŠ å¯†å“ˆå¸Œã€‚æ­¤å¤–ï¼Œæ£€æŸ¥è¯ä¹¦çš„æœ‰æ•ˆæ€§è¿˜æ¶‰åŠåœ¨çº¿æ£€æŸ¥è‹¹æœçš„æœåŠ¡å™¨ï¼Œä»¥æŸ¥çœ‹è¯ä¹¦æ˜¯å¦åœ¨å‘æ”¾åè¢«åŠé”€ã€‚å‡ºäºè¿™äº›åŸå› ï¼Œæ¯æ¬¡å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶è¿è¡Œå®Œæ•´çš„ä»£ç ç­¾åå’ŒéªŒè¯æ£€æŸ¥æ˜¯ä¸åˆ‡å®é™…çš„ã€‚

å› æ­¤ï¼Œè¿™äº›æ£€æŸ¥ä»…åœ¨æ‰§è¡Œå¸¦æœ‰éš”ç¦»å±æ€§çš„åº”ç”¨ç¨‹åºæ—¶è¿è¡Œã€‚
{% endhint %}

{% hint style="warning" %}
è¯·æ³¨æ„ï¼ŒSafari å’Œå…¶ä»–ç½‘ç»œæµè§ˆå™¨å’Œåº”ç”¨ç¨‹åºéœ€è¦æ ‡è®°ä¸‹è½½çš„æ–‡ä»¶ã€‚

æ­¤å¤–ï¼Œç”±æ²™ç®±è¿›ç¨‹åˆ›å»ºçš„æ–‡ä»¶ä¹Ÿä¼šé™„åŠ æ­¤å±æ€§ï¼Œä»¥é˜²æ­¢æ²™ç®±é€ƒé€¸ã€‚
{% endhint %}

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼ˆéœ€è¦ root æƒé™ï¼‰æ¥æ£€æŸ¥å…¶çŠ¶æ€å’Œå¯ç”¨/ç¦ç”¨ï¼š
```bash
spctl --status
assessments enabled

spctl --enable
spctl --disable
#You can also allow nee identifies to execute code using the binary "spctl"
```
æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤**æŸ¥æ‰¾æ–‡ä»¶æ˜¯å¦å…·æœ‰æ‰©å±•å±æ€§**ï¼š
```bash
xattr portada.png
com.apple.macl
com.apple.quarantine
```
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ‰©å±•å±æ€§çš„å€¼ï¼š
```bash
xattr -l portada.png
com.apple.macl:
00000000  03 00 53 DA 55 1B AE 4C 4E 88 9D CA B7 5C 50 F3  |..S.U..LN.....P.|
00000010  16 94 03 00 27 63 64 97 98 FB 4F 02 84 F3 D0 DB  |....'cd...O.....|
00000020  89 53 C3 FC 03 00 27 63 64 97 98 FB 4F 02 84 F3  |.S....'cd...O...|
00000030  D0 DB 89 53 C3 FC 00 00 00 00 00 00 00 00 00 00  |...S............|
00000040  00 00 00 00 00 00 00 00                          |........|
00000048
com.apple.quarantine: 0081;607842eb;Brave;F643CD5F-6071-46AB-83AB-390BA944DEC5
```
ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤**åˆ é™¤**è¯¥å±æ€§ï¼š
```bash
xattr -d com.apple.quarantine portada.png
#You can also remove this attribute from every file with
find . -iname '*' -print0 | xargs -0 xattr -d com.apple.quarantine
```
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾æ‰€æœ‰è¢«éš”ç¦»çš„æ–‡ä»¶ï¼š

{% code overflow="wrap" %}
```bash
find / -exec ls -ld {} \; 2>/dev/null | grep -E "[x\-]@ " | awk '{printf $9; printf "\n"}' | xargs -I {} xattr -lv {} | grep "com.apple.quarantine"
```
{% endcode %}

## XProtect

XProtectæ˜¯macOSä¸­å†…ç½®çš„åæ¶æ„è½¯ä»¶åŠŸèƒ½ã€‚å®ƒæ˜¯è‹¹æœçš„å®‰å…¨ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œé™é»˜åœ°åœ¨åå°å·¥ä½œï¼Œä¿æŠ¤æ‚¨çš„Macå…å—å·²çŸ¥æ¶æ„è½¯ä»¶å’Œæ¶æ„æ’ä»¶çš„ä¾µå®³ã€‚

XProtecté€šè¿‡å°†ä»»ä½•ä¸‹è½½çš„æ–‡ä»¶ä¸å…¶å·²çŸ¥æ¶æ„è½¯ä»¶å’Œä¸å®‰å…¨æ–‡ä»¶ç±»å‹çš„æ•°æ®åº“è¿›è¡Œæ£€æŸ¥æ¥å‘æŒ¥ä½œç”¨ã€‚å½“æ‚¨é€šè¿‡æŸäº›åº”ç”¨ç¨‹åºï¼ˆå¦‚Safariã€Mailæˆ–Messagesï¼‰ä¸‹è½½æ–‡ä»¶æ—¶ï¼ŒXProtectä¼šè‡ªåŠ¨æ‰«æè¯¥æ–‡ä»¶ã€‚å¦‚æœå®ƒåœ¨å…¶æ•°æ®åº“ä¸­ä¸ä»»ä½•å·²çŸ¥æ¶æ„è½¯ä»¶åŒ¹é…ï¼ŒXProtectå°†é˜»æ­¢è¯¥æ–‡ä»¶è¿è¡Œå¹¶å‘æ‚¨å‘å‡ºè­¦æŠ¥ã€‚

XProtectæ•°æ®åº“ç”±è‹¹æœå®šæœŸæ›´æ–°ï¼ŒåŒ…å«æ–°çš„æ¶æ„è½¯ä»¶å®šä¹‰ï¼Œå¹¶ä¸”è¿™äº›æ›´æ–°ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…åˆ°æ‚¨çš„Macä¸Šã€‚è¿™ç¡®ä¿äº†XProtectå§‹ç»ˆä¸æœ€æ–°çš„å·²çŸ¥å¨èƒä¿æŒåŒæ­¥ã€‚

ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒXProtectå¹¶ä¸æ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„é˜²ç—…æ¯’è§£å†³æ–¹æ¡ˆã€‚å®ƒåªæ£€æŸ¥ç‰¹å®šçš„å·²çŸ¥å¨èƒåˆ—è¡¨ï¼Œå¹¶ä¸”ä¸åƒå¤§å¤šæ•°é˜²ç—…æ¯’è½¯ä»¶é‚£æ ·æ‰§è¡Œå®æ—¶æ‰«æã€‚å› æ­¤ï¼Œè™½ç„¶XProtectæä¾›äº†å¯¹å·²çŸ¥æ¶æ„è½¯ä»¶çš„ä¸€å±‚ä¿æŠ¤ï¼Œä½†ä»å»ºè®®åœ¨ä»äº’è”ç½‘ä¸‹è½½æ–‡ä»¶æˆ–æ‰“å¼€ç”µå­é‚®ä»¶é™„ä»¶æ—¶è¦è°¨æ…ã€‚

æ‚¨å¯ä»¥è·å–æœ‰å…³æœ€æ–°XProtectæ›´æ–°çš„ä¿¡æ¯ï¼š

{% code overflow="wrap" %}
```bash
system_profiler SPInstallHistoryDataType 2>/dev/null | grep -A 4 "XProtectPlistConfigData" | tail -n 5
```
{% endcode %}

## MRT - æ¶æ„è½¯ä»¶ç§»é™¤å·¥å…·

æ¶æ„è½¯ä»¶ç§»é™¤å·¥å…·ï¼ˆMRTï¼‰æ˜¯ macOS å®‰å…¨åŸºç¡€è®¾æ–½çš„å¦ä¸€éƒ¨åˆ†ã€‚é¡¾åæ€ä¹‰ï¼ŒMRT çš„ä¸»è¦åŠŸèƒ½æ˜¯**ä»å—æ„ŸæŸ“çš„ç³»ç»Ÿä¸­ç§»é™¤å·²çŸ¥çš„æ¶æ„è½¯ä»¶**ã€‚

ä¸€æ—¦åœ¨ Mac ä¸Šæ£€æµ‹åˆ°æ¶æ„è½¯ä»¶ï¼ˆæ— è®ºæ˜¯é€šè¿‡ XProtect è¿˜æ˜¯å…¶ä»–æ–¹å¼ï¼‰ï¼Œå°±å¯ä»¥ä½¿ç”¨ MRT è‡ªåŠ¨**ç§»é™¤æ¶æ„è½¯ä»¶**ã€‚MRT åœ¨åå°é™é»˜è¿è¡Œï¼Œé€šå¸¸åœ¨ç³»ç»Ÿæ›´æ–°æˆ–ä¸‹è½½æ–°çš„æ¶æ„è½¯ä»¶å®šä¹‰æ—¶è¿è¡Œï¼ˆçœ‹èµ·æ¥ MRT ç”¨äºæ£€æµ‹æ¶æ„è½¯ä»¶çš„è§„åˆ™åµŒå…¥åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼‰ã€‚

è™½ç„¶ XProtect å’Œ MRT éƒ½æ˜¯ macOS çš„å®‰å…¨æªæ–½çš„ä¸€éƒ¨åˆ†ï¼Œä½†å®ƒä»¬å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼š

* **XProtect** æ˜¯ä¸€ç§é¢„é˜²å·¥å…·ã€‚å®ƒä¼šåœ¨æ–‡ä»¶ä¸‹è½½æ—¶ï¼ˆé€šè¿‡æŸäº›åº”ç”¨ç¨‹åºï¼‰**æ£€æŸ¥æ–‡ä»¶**ï¼Œå¦‚æœæ£€æµ‹åˆ°ä»»ä½•å·²çŸ¥ç±»å‹çš„æ¶æ„è½¯ä»¶ï¼Œå®ƒä¼š**é˜»æ­¢æ–‡ä»¶æ‰“å¼€**ï¼Œä»è€Œé˜²æ­¢æ¶æ„è½¯ä»¶é¦–æ¬¡æ„ŸæŸ“ç³»ç»Ÿã€‚
* å¦ä¸€æ–¹é¢ï¼Œ**MRT æ˜¯ä¸€ç§å“åº”å·¥å…·**ã€‚å®ƒåœ¨æ£€æµ‹åˆ°ç³»ç»Ÿä¸Šçš„æ¶æ„è½¯ä»¶åè¿è¡Œï¼Œç›®çš„æ˜¯ç§»é™¤æœ‰é—®é¢˜çš„è½¯ä»¶ä»¥æ¸…ç†ç³»ç»Ÿã€‚

## è¿›ç¨‹é™åˆ¶

### SIP - ç³»ç»Ÿå®Œæ•´æ€§ä¿æŠ¤

{% content-ref url="macos-sip.md" %}
[macos-sip.md](macos-sip.md)
{% endcontent-ref %}

### æ²™ç›’

macOS æ²™ç›’å°†åœ¨æ²™ç›’å†…è¿è¡Œçš„åº”ç”¨ç¨‹åº**é™åˆ¶ä¸ºæ²™ç›’é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„å…è®¸æ“ä½œ**ã€‚è¿™æœ‰åŠ©äºç¡®ä¿**åº”ç”¨ç¨‹åºåªèƒ½è®¿é—®é¢„æœŸçš„èµ„æº**ã€‚

{% content-ref url="macos-sandbox/" %}
[macos-sandbox](macos-sandbox/)
{% endcontent-ref %}

### TCC - é€æ˜åº¦ã€åŒæ„å’Œæ§åˆ¶

**TCCï¼ˆé€æ˜åº¦ã€åŒæ„å’Œæ§åˆ¶ï¼‰**æ˜¯ macOS ä¸­çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äº**é™åˆ¶å’Œæ§åˆ¶åº”ç”¨ç¨‹åºå¯¹æŸäº›åŠŸèƒ½çš„è®¿é—®**ï¼Œé€šå¸¸ä»éšç§è§’åº¦è€ƒè™‘ã€‚è¿™å¯èƒ½åŒ…æ‹¬ä½ç½®æœåŠ¡ã€è”ç³»äººã€ç…§ç‰‡ã€éº¦å…‹é£ã€æ‘„åƒå¤´ã€è¾…åŠ©åŠŸèƒ½ã€å®Œå…¨ç£ç›˜è®¿é—®ç­‰ç­‰ã€‚

{% content-ref url="macos-tcc/" %}
[macos-tcc](macos-tcc/)
{% endcontent-ref %}

## ä¿¡ä»»ç¼“å­˜

è‹¹æœ macOS ä¿¡ä»»ç¼“å­˜ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸º AMFIï¼ˆApple Mobile File Integrityï¼‰ç¼“å­˜ï¼Œæ˜¯ macOS ä¸­çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæ—¨åœ¨**é˜²æ­¢æœªç»æˆæƒæˆ–æ¶æ„è½¯ä»¶è¿è¡Œ**ã€‚å®è´¨ä¸Šï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿç”¨äº**éªŒè¯è½¯ä»¶çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§çš„åŠ å¯†å“ˆå¸Œåˆ—è¡¨**ã€‚

å½“åº”ç”¨ç¨‹åºæˆ–å¯æ‰§è¡Œæ–‡ä»¶å°è¯•åœ¨ macOS ä¸Šè¿è¡Œæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæ£€æŸ¥ AMFI ä¿¡ä»»ç¼“å­˜ã€‚å¦‚æœåœ¨ä¿¡ä»»ç¼“å­˜ä¸­æ‰¾åˆ°æ–‡ä»¶çš„å“ˆå¸Œå€¼ï¼Œåˆ™ç³»ç»Ÿä¼š**å…è®¸**è¯¥ç¨‹åºè¿è¡Œï¼Œå› ä¸ºå®ƒè¢«è¯†åˆ«ä¸ºå¯ä¿¡ä»»çš„ã€‚

## å¯åŠ¨é™åˆ¶

å®ƒæ§åˆ¶ä»ä½•å¤„ä»¥åŠä»€ä¹ˆå¯ä»¥å¯åŠ¨ Apple ç­¾åçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼š

* å¦‚æœåº”è¯¥ç”± launchd è¿è¡Œï¼Œåˆ™æ— æ³•ç›´æ¥å¯åŠ¨åº”ç”¨ç¨‹åºã€‚
* æ— æ³•åœ¨å—ä¿¡ä»»ä½ç½®ä¹‹å¤–è¿è¡Œåº”ç”¨ç¨‹åºï¼ˆå¦‚ /System/ï¼‰ã€‚

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨ HackTricks ä¸­**å®£ä¼ æ‚¨çš„å…¬å¸**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨ **Twitter** ä¸Š**å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
