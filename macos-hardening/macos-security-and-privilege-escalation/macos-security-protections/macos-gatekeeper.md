# macOS Gatekeeper / Quarantine / XProtect

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* рдХреНрдпрд╛ рдЖрдк рдПрдХ **рд╕рд╛рдЗрдмрд░рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛрддреЗ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХрд╛ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕рд╛рдорд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **Twitter** рдкрд░ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рдХреЛ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Gatekeeper

**Gatekeeper** рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдЬреЛ Mac рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╕рд┐рдд рдХреА рдЧрдИ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдкрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ **рдХреЗрд╡рд▓ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЪрд▓рд╛рдПрдБ**ред рдпрд╣ **рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рдорд╛рдиреНрдп рдХрд░рдХреЗ** рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдРрдк рд╕реНрдЯреЛрд░ рдХреЗ рдмрд╛рд╣рд░** рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдПрдХ рдРрдк, рдПрдХ рдкреНрд▓рдЧ-рдЗрди, рдпрд╛ рдПрдХ рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдкреИрдХреЗрдЬред

Gatekeeper рдХрд╛ рдореБрдЦреНрдп рддрдВрддреНрд░ рдЗрд╕рдХреЗ **рд╕рддреНрдпрд╛рдкрди** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдирд┐рд╣рд┐рдд рд╣реИред рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ **рдПрдХ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдбреЗрд╡рд▓рдкрд░ рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд** рд╣реИ, рдЬреЛ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рдкреНрд░рд╛рдорд╛рдгрд┐рдХрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ **Apple рджреНрд╡рд╛рд░рд╛ рдиреЛрдЯрд░рд╛рдЗрдЬ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**, рдпрд╣ рдкреБрд╖реНрдЯрд┐ рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдпрд╣ рдЬреНрдЮрд╛рдд рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рд╕рд╛рдордЧреНрд░реА рд╕реЗ рдореБрдХреНрдд рд╣реИ рдФрд░ рдиреЛрдЯрд░рд╛рдЗрдЬреЗрд╢рди рдХреЗ рдмрд╛рдж рдЗрд╕рдореЗрдВ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, Gatekeeper рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рдпрдВрддреНрд░рдг рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ **рдкрд╣рд▓реА рдмрд╛рд░ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рд╕реЗ рдЕрдиреБрдореЛрджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдХреЗ** рдордЬрдмреВрдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХреЛрдб рдХреЛ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рдЪрд▓рд╛рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╡реЗ рдПрдХ рд╣рд╛рдирд┐рд░рд╣рд┐рдд рдбреЗрдЯрд╛ рдлрд╝рд╛рдЗрд▓ рд╕рдордЭ рд╕рдХрддреЗ рд╣реИрдВред

### Application Signatures

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░, рдЬрд┐рдиреНрд╣реЗрдВ рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, Apple рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдЕрд╡рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдШрдЯрдХ рд╣реИрдВред рдЗрдиреНрд╣реЗрдВ **рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд▓реЗрдЦрдХ рдХреА рдкрд╣рдЪрд╛рди рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ** рдФрд░ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдХреЛ рдЕрдВрддрд┐рдо рдмрд╛рд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж рд╕реЗ рдЗрд╕рдореЗрдВ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИред

рдпрд╣рд╛рдБ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:

1. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд░рдирд╛:** рдЬрдм рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╡рд┐рддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ **рдПрдХ рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ**ред рдпрд╣ рдирд┐рдЬреА рдХреБрдВрдЬреА рдПрдХ **рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗ рдЬреБрдбрд╝реА рд╣реЛрддреА рд╣реИ рдЬреЛ Apple рдбреЗрд╡рд▓рдкрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рдирд╛рдорд╛рдВрдХрд┐рдд рд╣реЛрдиреЗ рдкрд░ рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдЬрд╛рд░реА рдХреА рдЬрд╛рддреА рд╣реИ**ред рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдРрдк рдХреЗ рд╕рднреА рднрд╛рдЧреЛрдВ рдХрд╛ рдПрдХ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рд╣реИрд╢ рдмрдирд╛рдирд╛ рдФрд░ рдЗрд╕ рд╣реИрд╢ рдХреЛ рдбреЗрд╡рд▓рдкрд░ рдХреА рдирд┐рдЬреА рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред
2. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рд╡рд┐рддрд░рдг:** рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдлрд┐рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдбреЗрд╡рд▓рдкрд░ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рде рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рд╣реЛрддреА рд╣реИред
3. **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рд╕рддреНрдпрд╛рдкрди:** рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЙрдирдХрд╛ Mac рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдбреЗрд╡рд▓рдкрд░ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реИрд╢ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИред рдлрд┐рд░ рдпрд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╣реИрд╢ рдХреА рдкреБрдирдГ рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯреЗрдб рд╣реИрд╢ рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рд╡реЗ рдореЗрд▓ рдЦрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╕рдВрд╢реЛрдзрди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рдЬрдм рд╕реЗ рдбреЗрд╡рд▓рдкрд░ рдиреЗ рдЗрд╕реЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд┐рдпрд╛ рдерд╛, рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ Apple рдХреЗ Gatekeeper рддрдХрдиреАрдХ рдХрд╛ рдПрдХ рдЖрд╡рд╢реНрдпрдХ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВред рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ**, рддреЛ Gatekeeper рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдпрд╣ рдПрдХ рдЬреНрдЮрд╛рдд рдбреЗрд╡рд▓рдкрд░ рдХреЛ Apple рджреНрд╡рд╛рд░рд╛ рдЬрд╛рд░реА рдХрд┐рдП рдЧрдП рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рде рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рд╣реИ рдФрд░ рдХреЛрдб рдореЗрдВ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИ, рддреЛ Gatekeeper рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЕрдиреНрдпрдерд╛, рдпрд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдмреНрд▓реЙрдХ рдХрд░ рджреЗрддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред

macOS Catalina рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░, **Gatekeeper рдпрд╣ рднреА рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ Apple рджреНрд╡рд╛рд░рд╛ рдиреЛрдЯрд░рд╛рдЗрдЬ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рдпрд╛ рдирд╣реАрдВ, рдЬреЛ рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдкрд░рдд рдЬреЛрдбрд╝рддрд╛ рд╣реИред рдиреЛрдЯрд░рд╛рдЗрдЬреЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЬреНрдЮрд╛рдд рд╕реБрд░рдХреНрд╖рд╛ рдореБрджреНрджреЛрдВ рдФрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪрддреА рд╣реИ, рдФрд░ рдпрджрд┐ рдпреЗ рдЬрд╛рдВрдЪ рдкрд╛рд╕ рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ, рддреЛ Apple рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдПрдХ рдЯрд┐рдХрдЯ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ Gatekeeper рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

#### Check Signatures

рдЬрдм рдХреБрдЫ **malware sample** рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рд╣рдореЗрд╢рд╛ **рдмрд╛рдЗрдирд░реА рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП** рдХреНрдпреЛрдВрдХрд┐ **рдбреЗрд╡рд▓рдкрд░** рдЬрд┐рд╕рдиреЗ рдЗрд╕реЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд┐рдпрд╛ рд╣реИ, рд╡рд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА **malware рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
```bash
# Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

# Check if the appтАЩs contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s <cert-name-keychain> toolsdemo
```
### Notarization

Apple рдХреА рдиреЛрдЯрд░реАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд╣рд╛рдирд┐рдХрд╛рд░рдХ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реЗ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреА рд╣реИред рдЗрд╕рдореЗрдВ **рдбреЗрд╡рд▓рдкрд░ рджреНрд╡рд╛рд░рд╛ рдЙрдирдХреЗ рдЖрд╡реЗрджрди рдХреЛ Apple's Notary Service** рджреНрд╡рд╛рд░рд╛ рдкрд░реАрдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕реНрддреБрдд рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬрд┐рд╕реЗ App Review рдХреЗ рд╕рд╛рде рднреНрд░рдорд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рд╕реЗрд╡рд╛ рдПрдХ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкреНрд░рдгрд╛рд▓реА** рд╣реИ рдЬреЛ рдкреНрд░рд╕реНрддреБрдд рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреА рд╣реИ рдХрд┐ рдЙрд╕рдореЗрдВ **рджреБрд╖реНрдЯ рд╕рд╛рдордЧреНрд░реА** рдФрд░ рдХреЛрдб-рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЗ рд╕рд╛рде рдХреЛрдИ рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╕реНрдпрд╛рдПрдБ рд╣реИрдВ рдпрд╛ рдирд╣реАрдВред

рдпрджрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЗрд╕ рдирд┐рд░реАрдХреНрд╖рдг рдХреЛ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдЪрд┐рдВрддрд╛ рдХреЗ **рдкрд╛рд╕** рдХрд░ рд▓реЗрддрд╛ рд╣реИ, рддреЛ Notary Service рдПрдХ рдиреЛрдЯрд░реАрдХрд░рдг рдЯрд┐рдХрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддреА рд╣реИред рдлрд┐рд░ рдбреЗрд╡рд▓рдкрд░ рдХреЛ **рдЗрд╕ рдЯрд┐рдХрдЯ рдХреЛ рдЕрдкрдиреЗ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реЗ рд╕рдВрд▓рдЧреНрди рдХрд░рдирд╛** рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЬрд┐рд╕реЗ 'рд╕реНрдЯреЗрдкрд▓рд┐рдВрдЧ' рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдиреЛрдЯрд░реАрдХрд░рдг рдЯрд┐рдХрдЯ рдХреЛ рдСрдирд▓рд╛рдЗрди рднреА рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдБ Gatekeeper, Apple рдХреА рд╕реБрд░рдХреНрд╖рд╛ рддрдХрдиреАрдХ, рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреА рд╣реИред

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рдкрд╣рд▓реА рд╕реНрдерд╛рдкрдирд╛ рдпрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдкрд░, рдиреЛрдЯрд░реАрдХрд░рдг рдЯрд┐рдХрдЯ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ - рдЪрд╛рд╣реЗ рд╡рд╣ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХреЗ рд╕рд╛рде рд╕реНрдЯреЗрдкрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ рдпрд╛ рдСрдирд▓рд╛рдЗрди рдкрд╛рдпрд╛ рдЧрдпрд╛ рд╣реЛ - **Gatekeeper рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ Apple рджреНрд╡рд╛рд░рд╛ рдиреЛрдЯрд░реАрдХрд░рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**ред рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, Gatekeeper рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд▓реЙрдиреНрдЪ рд╕рдВрд╡рд╛рдж рдореЗрдВ рдПрдХ рд╡рд░реНрдгрдирд╛рддреНрдордХ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдпрд╣ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ Apple рджреНрд╡рд╛рд░рд╛ рджреБрд╖реНрдЯ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЙрд╕ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЛ рдмрдврд╝рд╛рддреА рд╣реИ рдЬрд┐рд╕реЗ рд╡реЗ рдЕрдкрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдпрд╛ рдЪрд▓рд╛рддреЗ рд╣реИрдВред

### Enumerating GateKeeper

GateKeeper рджреЛрдиреЛрдВ рд╣реИ, **рдХрдИ рд╕реБрд░рдХреНрд╖рд╛ рдШрдЯрдХ** рдЬреЛ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдРрдкреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХрддреЗ рд╣реИрдВ рдФрд░ **рдПрдХ рдШрдЯрдХ** рднреА рд╣реИрдВред

рдЖрдк **GateKeeper рдХреА рд╕реНрдерд┐рддрд┐** рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Check the status
spctl --status
```
{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ GateKeeper рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдЬрд╛рдВрдЪ рдХреЗрд╡рд▓ **рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рд╡рд╛рд▓реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ** рдХреЗ рд▓рд┐рдП рдХреА рдЬрд╛рддреА рд╣реИ, рди рдХрд┐ рд╣рд░ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдПред
{% endhint %}

GateKeeper рдпрд╣ рдЬрд╛рдВрдЪреЗрдЧрд╛ рдХрд┐ **рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдФрд░ рд╕рд┐рдЧреНрдиреЗрдЪрд░** рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдПрдХ рдмрд╛рдЗрдирд░реА рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (1150).png" alt=""><figcaption></figcaption></figure>

рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд░рдЦрдиреЗ рд╡рд╛рд▓рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ **`/var/db/SystemPolicy`** рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред рдЖрдк рдЗрд╕реЗ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Open database
sqlite3 /var/db/SystemPolicy

# Get allowed rules
SELECT requirement,allow,disabled,label from authority where label != 'GKE' and disabled=0;
requirement|allow|disabled|label
anchor apple generic and certificate 1[subject.CN] = "Apple Software Update Certification Authority"|1|0|Apple Installer
anchor apple|1|0|Apple System
anchor apple generic and certificate leaf[field.1.2.840.113635.100.6.1.9] exists|1|0|Mac App Store
anchor apple generic and certificate 1[field.1.2.840.113635.100.6.2.6] exists and (certificate leaf[field.1.2.840.113635.100.6.1.14] or certificate leaf[field.1.2.840.113635.100.6.1.13]) and notarized|1|0|Notarized Developer ID
[...]
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрд╣рд▓рд╛ рдирд┐рдпрдо "**App Store**" рдкрд░ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рджреВрд╕рд░рд╛ "**Developer ID**" рдкрд░, рдФрд░ рдкрд┐рдЫрд▓реЗ рдЪрд┐рддреНрд░ рдореЗрдВ рдпрд╣ **App Store рдФрд░ рдкрд╣рдЪрд╛рдиреЗ рдЧрдП рдбреЗрд╡рд▓рдкрд░реНрд╕ рд╕реЗ рдРрдкреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рдерд╛**ред\
рдпрджрд┐ рдЖрдк рдЙрд╕ рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ App Store рдореЗрдВ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рддреЗ рд╣реИрдВ, рддреЛ "**Notarized Developer ID" рдирд┐рдпрдо рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ **рдкреНрд░рдХрд╛рд░ GKE** рдХреЗ рд╣рдЬрд╛рд░реЛрдВ рдирд┐рдпрдо рднреА рд╣реИрдВ:
```bash
SELECT requirement,allow,disabled,label from authority where label = 'GKE' limit 5;
cdhash H"b40281d347dc574ae0850682f0fd1173aa2d0a39"|1|0|GKE
cdhash H"5fd63f5342ac0c7c0774ebcbecaf8787367c480f"|1|0|GKE
cdhash H"4317047eefac8125ce4d44cab0eb7b1dff29d19a"|1|0|GKE
cdhash H"0a71962e7a32f0c2b41ddb1fb8403f3420e1d861"|1|0|GKE
cdhash H"8d0d90ff23c3071211646c4c9c607cdb601cb18f"|1|0|GKE
```
рдпреЗ рд╣реИрд╢реЗрд╕ **`/var/db/SystemPolicyConfiguration/gke.bundle/Contents/Resources/gke.auth`, `/var/db/gke.bundle/Contents/Resources/gk.db`** рдФрд░ **`/var/db/gkopaque.bundle/Contents/Resources/gkopaque.db`** рд╕реЗ рдЖрддреЗ рд╣реИрдВред

рдпрд╛ рдЖрдк рдкрд┐рдЫрд▓реЗ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
sudo spctl --list
```
The options **`--master-disable`** and **`--global-disable`** of **`spctl`** will completely **рдЕрдХреНрд╖рдо** these signature checks:
```bash
# Disable GateKeeper
spctl --global-disable
spctl --master-disable

# Enable it
spctl --global-enable
spctl --master-enable
```
рдЬрдм рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдПрдХ рдирдпрд╛ рд╡рд┐рдХрд▓реНрдк рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛:

<figure><img src="../../../.gitbook/assets/image (1151).png" alt=""><figcaption></figcaption></figure>

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдРрдк GateKeeper рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдПрдЧреА**:
```bash
spctl --assess -v /Applications/App.app
```
GateKeeper рдореЗрдВ рдХреБрдЫ рдРрдкреНрд╕ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдирдП рдирд┐рдпрдо рдЬреЛрдбрд╝рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```bash
# Check if allowed - nop
spctl --assess -v /Applications/App.app
/Applications/App.app: rejected
source=no usable signature

# Add a label and allow this label in GateKeeper
sudo spctl --add --label "whitelist" /Applications/App.app
sudo spctl --enable --label "whitelist"

# Check again - yep
spctl --assess -v /Applications/App.app
/Applications/App.app: accepted
```
### Quarantine Files

рдЬрдм **рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдпрд╛ рдлрд╝рд╛рдЗрд▓ **рдбрд╛рдЙрдирд▓реЛрдб** рдХреА рдЬрд╛рддреА рд╣реИ, рддреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ macOS **рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдЬреИрд╕реЗ рд╡реЗрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдпрд╛ рдИрдореЗрд▓ рдХреНрд▓рд╛рдЗрдВрдЯ **рдПрдХ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдлрд╝рд╛рдЗрд▓ рд╡рд┐рд╢реЗрд╖рддрд╛** рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рд╕рд╛рдорд╛рдиреНрдпрддрдГ "**рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлреНрд▓реИрдЧ**" рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдкрд░ред рдпрд╣ рд╡рд┐рд╢реЗрд╖рддрд╛ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреА рд╣реИ рддрд╛рдХрд┐ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕реНрд░реЛрдд (рдЗрдВрдЯрд░рдиреЗрдЯ) рд╕реЗ рдЖрдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ **рдЪрд┐рдиреНрд╣рд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЬреЛрдЦрд┐рдо рдЙрдард╛рдиреЗ рд╡рд╛рд▓реА рд╣реЛред рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╕рднреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрд╕ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рдирд╣реАрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕рд╛рдорд╛рдиреНрдп BitTorrent рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЖрдорддреМрд░ рдкрд░ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИред

**рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлреНрд▓реИрдЧ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ macOS рдХреЗ рдЧреЗрдЯрдХреАрдкрд░ рд╕реБрд░рдХреНрд╖рд╛ рдлрд╝реАрдЪрд░ рдХреЛ рд╕рдВрдХреЗрдд рджреЗрддреА рд╣реИ рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ**ред

рдпрджрд┐ **рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдлреНрд▓реИрдЧ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ** (рдЬреИрд╕реЗ рдХреБрдЫ BitTorrent рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде), рддреЛ рдЧреЗрдЯрдХреАрдкрд░ рдХреЗ **рдЪреЗрдХ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдХрдо рд╕реБрд░рдХреНрд╖рд┐рдд рдпрд╛ рдЕрдЬреНрдЮрд╛рдд рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЦреЛрд▓рддреЗ рд╕рдордп рд╕рд╛рд╡рдзрд╛рдиреА рдмрд░рддрдиреА рдЪрд╛рд╣рд┐рдПред

{% hint style="info" %}
**рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рдХреА** **рд╡реИрдзрддрд╛** рдХреА **рдЬрд╛рдВрдЪ рдХрд░рдирд╛** рдПрдХ **рд╕рдВрд╕рд╛рдзрди-рдЧрд╣рди** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЛрдб рдФрд░ рдЗрд╕рдХреЗ рд╕рднреА рдмрдВрдбрд▓ рдХрд┐рдП рдЧрдП рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд╝рд┐рдХ **рд╣реИрд╢** рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рд╡реИрдзрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдореЗрдВ Apple рдХреЗ рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рдПрдХ **рдСрдирд▓рд╛рдЗрди рдЬрд╛рдВрдЪ** рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЗрд╕реЗ рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж рд░рджреНрдж рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрди рдХрд╛рд░рдгреЛрдВ рд╕реЗ, рдПрдХ рдкреВрд░реНрдг рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдФрд░ рдиреЛрдЯрд░реАрдХрд░рдг рдЬрд╛рдВрдЪ **рд╣рд░ рдмрд╛рд░ рдПрдХ рдРрдк рд▓реЙрдиреНрдЪ рд╣реЛрдиреЗ рдкрд░ рдЪрд▓рд╛рдирд╛ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдирд╣реАрдВ рд╣реИ**ред

рдЗрд╕рд▓рд┐рдП, рдпреЗ рдЬрд╛рдВрдЪреЗрдВ **рдХреЗрд╡рд▓ рдЙрди рдРрдкреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдЪрд▓рддреА рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реЛрддреА рд╣реИред**
{% endhint %}

{% hint style="warning" %}
рдпрд╣ рд╡рд┐рд╢реЗрд╖рддрд╛ **рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ/рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рд╕реЗрдЯ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬреЛ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреА рдЧрдИ рд╣реИрдВ, рд╡реЗ рд╣рд░ рдлрд╝рд╛рдЗрд▓ рдкрд░ рдпрд╣ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╕реЗрдЯ рдХрд░реЗрдВрдЧреА рдЬреЛ рд╡реЗ рдмрдирд╛рддреА рд╣реИрдВред рдФрд░ рдЧреИрд░-рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдРрдкреНрд╕ рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ **Info.plist** рдореЗрдВ [**LSFileQuarantineEnabled**](https://developer.apple.com/documentation/bundleresources/information_property_list/lsfilequarantineenabled?language=objc) рдХреБрдВрдЬреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдкрд░ `com.apple.quarantine` рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдПрдЧреА,
{% endhint %}

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдИ рдЧрдИ рд╕рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ **`qtn_proc_apply_to_self`** рдХреЛ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╛ API **`qtn_file_apply_to_path`** рдПрдХ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдлрд╝рд╛рдЗрд▓ рдкрде рдкрд░ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рдЬреЛрдбрд╝рддрд╛ рд╣реИред

рдпрд╣ **рдЗрд╕рдХреЗ рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рдФрд░ рд╕рдХреНрд╖рдо/рдЕрдХреНрд╖рдо рдХрд░рдирд╛** (рд░реВрдЯ рдЖрд╡рд╢реНрдпрдХ) рд╕рдВрднрд╡ рд╣реИ:
```bash
spctl --status
assessments enabled

spctl --enable
spctl --disable
#You can also allow nee identifies to execute code using the binary "spctl"
```
рдЖрдк рдпрд╣ рднреА **рдЬрд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ**:
```bash
xattr file.png
com.apple.macl
com.apple.quarantine
```
рдЪреЗрдХ рдХрд░реЗрдВ **value** **extended** **attributes** рдХрд╛ рдФрд░ рдкрддрд╛ рдХрд░реЗрдВ рдХрд┐ рдХреМрди рд╕рд╛ рдРрдк рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди attr рдХреЛ рд▓рд┐рдЦрд╛:
```bash
xattr -l portada.png
com.apple.macl:
00000000  03 00 53 DA 55 1B AE 4C 4E 88 9D CA B7 5C 50 F3  |..S.U..LN.....P.|
00000010  16 94 03 00 27 63 64 97 98 FB 4F 02 84 F3 D0 DB  |....'cd...O.....|
00000020  89 53 C3 FC 03 00 27 63 64 97 98 FB 4F 02 84 F3  |.S....'cd...O...|
00000030  D0 DB 89 53 C3 FC 00 00 00 00 00 00 00 00 00 00  |...S............|
00000040  00 00 00 00 00 00 00 00                          |........|
00000048
com.apple.quarantine: 00C1;607842eb;Brave;F643CD5F-6071-46AB-83AB-390BA944DEC5
# 00c1 -- It has been allowed to eexcute this file (QTN_FLAG_USER_APPROVED = 0x0040)
# 607842eb -- Timestamp
# Brave -- App
# F643CD5F-6071-46AB-83AB-390BA944DEC5 -- UID assigned to the file downloaded
```
рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ "рдЬреЛ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╡рд╣ рдмрдирд╛рддреА рд╣реИ, рдЙрди рдкрд░ рд╕рдВрдЧрд░реЛрдз рдзреНрд╡рдЬ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреА рд╣реИ" (рдореИрдВрдиреЗ рдПрдХ рдмрдирд╛рдИ рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ USER_APPROVED рдзреНрд╡рдЬ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рд▓реЗрдХрд┐рди рдпрд╣ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реБрдЖ):

<details>

<summary>рд╕реНрд░реЛрдд рдХреЛрдб рд╕рдВрдЧрд░реЛрдз рдзреНрд╡рдЬ рд▓рд╛рдЧреВ рдХрд░реЗрдВ</summary>
```c
#include <stdio.h>
#include <stdlib.h>

enum qtn_flags {
QTN_FLAG_DOWNLOAD = 0x0001,
QTN_FLAG_SANDBOX = 0x0002,
QTN_FLAG_HARD = 0x0004,
QTN_FLAG_USER_APPROVED = 0x0040,
};

#define qtn_proc_alloc _qtn_proc_alloc
#define qtn_proc_apply_to_self _qtn_proc_apply_to_self
#define qtn_proc_free _qtn_proc_free
#define qtn_proc_init _qtn_proc_init
#define qtn_proc_init_with_self _qtn_proc_init_with_self
#define qtn_proc_set_flags _qtn_proc_set_flags
#define qtn_file_alloc _qtn_file_alloc
#define qtn_file_init_with_path _qtn_file_init_with_path
#define qtn_file_free _qtn_file_free
#define qtn_file_apply_to_path _qtn_file_apply_to_path
#define qtn_file_set_flags _qtn_file_set_flags
#define qtn_file_get_flags _qtn_file_get_flags
#define qtn_proc_set_identifier _qtn_proc_set_identifier

typedef struct _qtn_proc *qtn_proc_t;
typedef struct _qtn_file *qtn_file_t;

int qtn_proc_apply_to_self(qtn_proc_t);
void qtn_proc_init(qtn_proc_t);
int qtn_proc_init_with_self(qtn_proc_t);
int qtn_proc_set_flags(qtn_proc_t, uint32_t flags);
qtn_proc_t qtn_proc_alloc();
void qtn_proc_free(qtn_proc_t);
qtn_file_t qtn_file_alloc(void);
void qtn_file_free(qtn_file_t qf);
int qtn_file_set_flags(qtn_file_t qf, uint32_t flags);
uint32_t qtn_file_get_flags(qtn_file_t qf);
int qtn_file_apply_to_path(qtn_file_t qf, const char *path);
int qtn_file_init_with_path(qtn_file_t qf, const char *path);
int qtn_proc_set_identifier(qtn_proc_t qp, const char* bundleid);

int main() {

qtn_proc_t qp = qtn_proc_alloc();
qtn_proc_set_identifier(qp, "xyz.hacktricks.qa");
qtn_proc_set_flags(qp, QTN_FLAG_DOWNLOAD | QTN_FLAG_USER_APPROVED);
qtn_proc_apply_to_self(qp);
qtn_proc_free(qp);

FILE *fp;
fp = fopen("thisisquarantined.txt", "w+");
fprintf(fp, "Hello Quarantine\n");
fclose(fp);

return 0;

}
```
</details>

рдФрд░ **рд╣рдЯрд╛рдПрдВ** рд╡рд╣ рд╡рд┐рд╢реЗрд╖рддрд╛:
```bash
xattr -d com.apple.quarantine portada.png
#You can also remove this attribute from every file with
find . -iname '*' -print0 | xargs -0 xattr -d com.apple.quarantine
```
рдФрд░ рд╕рднреА рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВ: 

{% code overflow="wrap" %}
```bash
find / -exec ls -ld {} \; 2>/dev/null | grep -E "[x\-]@ " | awk '{printf $9; printf "\n"}' | xargs -I {} xattr -lv {} | grep "com.apple.quarantine"
```
{% endcode %}

рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдЬрд╛рдирдХрд╛рд░реА рдПрдХ рдХреЗрдВрджреНрд░реАрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рднреА рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ LaunchServices рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ **`~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2`**ред

#### **Quarantine.kext**

рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗрд╡рд▓ **рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдХрд░реНрдиреЗрд▓ рдХреИрд╢** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрд▓рдмреНрдз рд╣реИ; рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЖрдк **Kernel Debug Kit рдХреЛ https://developer.apple.com/** рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рдПрдХ рдкреНрд░рддреАрдХрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рд╣реЛрдЧрд╛ред

### XProtect

XProtect macOS рдореЗрдВ рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд **рдПрдВрдЯреА-рдореИрд▓рд╡реЗрдпрд░** рд╕реБрд╡рд┐рдзрд╛ рд╣реИред XProtect **рдХрд┐рд╕реА рднреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЙрд╕рдХреЗ рдкрд╣рд▓реЗ рд▓реЙрдиреНрдЪ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рд╣реЛрдиреЗ рдкрд░ рдЬреНрдЮрд╛рдд рдореИрд▓рд╡реЗрдпрд░ рдФрд░ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд╛рдВрдЪрддрд╛ рд╣реИ**ред рдЬрдм рдЖрдк рдХреБрдЫ рдРрдкреНрд╕, рдЬреИрд╕реЗ Safari, Mail, рдпрд╛ Messages рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, рддреЛ XProtect рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕реНрдХреИрди рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдпрд╣ рдЕрдкрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдХрд┐рд╕реА рдЬреНрдЮрд╛рдд рдореИрд▓рд╡реЗрдпрд░ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ XProtect **рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЪрд▓рдиреЗ рд╕реЗ рд░реЛрдХ рджреЗрдЧрд╛** рдФрд░ рдЖрдкрдХреЛ рдЦрддрд░реЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реВрдЪрд┐рдд рдХрд░реЗрдЧрд╛ред

XProtect рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ **рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ** Apple рджреНрд╡рд╛рд░рд╛ рдирдП рдореИрд▓рд╡реЗрдпрд░ рдкрд░рд┐рднрд╛рд╖рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдпреЗ рдЕрдкрдбреЗрдЯ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЖрдкрдХреЗ Mac рдкрд░ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ XProtect рд╣рдореЗрд╢рд╛ рдирд╡реАрдирддрдо рдЬреНрдЮрд╛рдд рдЦрддрд░реЛрдВ рдХреЗ рд╕рд╛рде рдЕрджреНрдпрддрд┐рдд рд╣реИред

рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ **XProtect рдПрдХ рдкреВрд░реНрдг-рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рд╡рд╛рд▓рд╛ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ**ред рдпрд╣ рдХреЗрд╡рд▓ рдЬреНрдЮрд╛рдд рдЦрддрд░реЛрдВ рдХреА рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реВрдЪреА рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдзрд┐рдХрд╛рдВрд╢ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рддрд░рд╣ рдСрди-рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреИрдирд┐рдВрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред

рдЖрдк рдирд╡реАрдирддрдо XProtect рдЕрдкрдбреЗрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: 

{% code overflow="wrap" %}
```bash
system_profiler SPInstallHistoryDataType 2>/dev/null | grep -A 4 "XProtectPlistConfigData" | tail -n 5
```
{% endcode %}

XProtect **/Library/Apple/System/Library/CoreServices/XProtect.bundle** рдкрд░ рд╕реНрдерд┐рдд рд╣реИ рдФрд░ рдмрдВрдбрд▓ рдХреЗ рдЕрдВрджрд░ рдЖрдк рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ XProtect рдХрд░рддрд╛ рд╣реИ:

* **`XProtect.bundle/Contents/Resources/LegacyEntitlementAllowlist.plist`**: рдЙрди cdhashes рдХреЗ рд╕рд╛рде рдХреЛрдб рдХреЛ рд╡рд┐рд░рд╛рд╕рдд рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
* **`XProtect.bundle/Contents/Resources/XProtect.meta.plist`**: рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреЛрдВ рдХреА рд╕реВрдЪреА рдЬреЛ BundleID рдФрд░ TeamID рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ рдпрд╛ рдиреНрдпреВрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреА рд╣реИред
* **`XProtect.bundle/Contents/Resources/XProtect.yara`**: рдореИрд▓рд╡реЗрдпрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛рд░рд╛ рдирд┐рдпрдоред
* **`XProtect.bundle/Contents/Resources/gk.db`**: рдЕрд╡рд░реБрджреНрдз рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдФрд░ TeamIDs рдХреЗ рд╣реИрд╢ рдХреЗ рд╕рд╛рде SQLite3 рдбреЗрдЯрд╛рдмреЗрд╕ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`/Library/Apple/System/Library/CoreServices/XProtect.app`** рдореЗрдВ XProtect рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдПрдХ рдФрд░ рдРрдк рд╣реИ рдЬреЛ Gatekeeper рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИред

### Not Gatekeeper

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ Gatekeeper **рд╣рд░ рдмрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрддрд╛** рдЬрдм рдЖрдк рдПрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдХреЗрд╡рд▓ _**AppleMobileFileIntegrity**_ (AMFI) рдХреЗрд╡рд▓ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреЛрдб рд╣рд╕реНрддрд╛рдХреНрд╖рд░** рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдЧрд╛ рдЬрдм рдЖрдк рдПрдХ рдРрдк рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдкрд╣рд▓реЗ Gatekeeper рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдФрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
{% endhint %}

рдЗрд╕рд▓рд┐рдП, рдкрд╣рд▓реЗ рдпрд╣ рд╕рдВрднрд╡ рдерд╛ рдХрд┐ рдПрдХ рдРрдк рдХреЛ Gatekeeper рдХреЗ рд╕рд╛рде рдХреИрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рдлрд┐рд░ **рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреА рдЧреИрд░-рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ** (рдЬреИрд╕реЗ Electron asar рдпрд╛ NIB рдлрд╝рд╛рдЗрд▓реЗрдВ) рдФрд░ рдпрджрд┐ рдХреЛрдИ рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдирд╣реАрдВ рдереЗ, рддреЛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рдерд╛ **рджреБрд╖реНрдЯ** рдкрд░рд┐рд╡рд░реНрдзрдиреЛрдВ рдХреЗ рд╕рд╛рдеред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдм рдпрд╣ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ macOS **рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдмрдВрдбрд▓реЛрдВ рдХреЗ рдЕрдВрджрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк [Dirty NIB](../macos-proces-abuse/macos-dirty-nib.md) рд╣рдорд▓реЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдкрд╛рдПрдВрдЧреЗ рдХрд┐ рдЗрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрдм рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ Gatekeeper рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рдХреИрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдРрдк рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рдмрдВрдбрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗред рдФрд░ рдпрджрд┐ рдЖрдк рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП Contents рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдирд╛рдо NotCon рдореЗрдВ рдмрджрд▓рддреЗ рд╣реИрдВ (рдЬреИрд╕рд╛ рдХрд┐ рд╢реЛрд╖рдг рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ), рдФрд░ рдлрд┐рд░ рдРрдк рдХреЗ рдореБрдЦреНрдп рдмрд╛рдЗрдирд░реА рдХреЛ Gatekeeper рдХреЗ рд╕рд╛рде рдХреИрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧрд╛ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ред

## Gatekeeper Bypasses

Gatekeeper рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рднреА рддрд░реАрдХрд╛ (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреБрдЫ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдирд╛ рдЬрдм Gatekeeper рдЗрд╕реЗ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП) macOS рдореЗрдВ рдПрдХ рднреЗрджреНрдпрддрд╛ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдпреЗ рдХреБрдЫ CVEs рд╣реИрдВ рдЬреЛ рддрдХрдиреАрдХреЛрдВ рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП рд╣реИрдВ рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ рдЕрддреАрдд рдореЗрдВ Gatekeeper рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА:

### [CVE-2021-1810](https://labs.withsecure.com/publications/the-discovery-of-cve-2021-1810)

рдпрд╣ рджреЗрдЦрд╛ рдЧрдпрд╛ рдХрд┐ рдпрджрд┐ **Archive Utility** рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд┐рд╖реНрдХрд░реНрд╖рдг рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **886 рд╡рд░реНрдгреЛрдВ рд╕реЗ рдЕрдзрд┐рдХ рдкрде** рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓реЗрдВ com.apple.quarantine рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░рддреА рд╣реИрдВред рдпрд╣ рд╕реНрдерд┐рддрд┐ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ **Gatekeeper рдХреА** рд╕реБрд░рдХреНрд╖рд╛ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ **рдмрд╛рдпрдкрд╛рд╕** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://labs.withsecure.com/publications/the-discovery-of-cve-2021-1810) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

### [CVE-2021-30990](https://ronmasas.com/posts/bypass-macos-gatekeeper)

рдЬрдм рдПрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ **Automator** рдХреЗ рд╕рд╛рде рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдирдХрд╛рд░реА `application.app/Contents/document.wflow` рдХреЗ рдЕрдВрджрд░ рд╣реЛрддреА рд╣реИ, рди рдХрд┐ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдореЗрдВред рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреЗрд╡рд▓ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп Automator рдмрд╛рдЗрдирд░реА рд╣реИ рдЬрд┐рд╕реЗ **Automator Application Stub** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдЖрдк `application.app/Contents/MacOS/Automator\ Application\ Stub` рдХреЛ **рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ рдПрдХ рдЕрдиреНрдп Automator Application Stub рдХреА рдУрд░ рдПрдХ рдкреНрд░рддреАрдХрд╛рддреНрдордХ рд▓рд┐рдВрдХ рдХреЗ рд╕рд╛рде рдЗрдВрдЧрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдпрд╣ `document.wflow` (рдЖрдкрдХрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ) рдХреЗ рдЕрдВрджрд░ рдЬреЛ рд╣реИ рдЙрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ **рдмрд┐рдирд╛ Gatekeeper рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдП** рдХреНрдпреЛрдВрдХрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди xattr рдирд╣реАрдВ рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЕрдкреЗрдХреНрд╖рд┐рдд рд╕реНрдерд╛рди: `/System/Library/CoreServices/Automator\ Application\ Stub.app/Contents/MacOS/Automator\ Application\ Stub`

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://ronmasas.com/posts/bypass-macos-gatekeeper) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

### [CVE-2022-22616](https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/)

рдЗрд╕ рдмрд╛рдпрдкрд╛рд╕ рдореЗрдВ рдПрдХ рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдИ рдЧрдИ рдереА рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ `application.app/Contents` рд╕реЗ рд╕рдВрдХреБрдЪрди рд╢реБрд░реВ рдХрд░ рд░рд╣рд╛ рдерд╛ рди рдХрд┐ `application.app` рд╕реЗред рдЗрд╕рд▓рд┐рдП, **рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛** рд╕рднреА **рдлрд╛рдЗрд▓реЛрдВ рдкрд░ рд▓рд╛рдЧреВ рдХреА рдЧрдИ рдереА `application.app/Contents`** рд▓реЗрдХрд┐рди **`application.app` рдкрд░ рдирд╣реАрдВ**, рдЬрд┐рд╕реЗ Gatekeeper рдЬрд╛рдВрдЪ рд░рд╣рд╛ рдерд╛, рдЗрд╕рд▓рд┐рдП Gatekeeper рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЬрдм `application.app` рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рддреЛ **рдЗрд╕рдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рдереАред**
```bash
zip -r test.app/Contents test.zip
```
Check the [**original report**](https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/) for more information.

### [CVE-2022-32910](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-32910)

рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдпрджрд┐ рдШрдЯрдХ рднрд┐рдиреНрди рд╣реИрдВ, рддреЛ рдЗрд╕ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рдХреЗ рд╕рдорд╛рди рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо **`application.app/Contents`** рд╕реЗ рдПрдХ Apple Archive рдмрдирд╛рдПрдВрдЧреЗ рддрд╛рдХрд┐ **`application.app`** рдХреЛ **Archive Utility** рджреНрд╡рд╛рд░рд╛ рдЕрдирдЬрд┐рдк рдХрд░рддреЗ рд╕рдордп рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рди рдорд┐рд▓реЗред
```bash
aa archive -d test.app/Contents -o test.app.aar
```
Check the [**original report**](https://www.jamf.com/blog/jamf-threat-labs-macos-archive-utility-vulnerability/) for more information.

### [CVE-2022-42821](https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/)

ACL **`writeextattr`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рдХреЛ рднреА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╡рд┐рд╢реЗрд╖рддрд╛ рд▓рд┐рдЦрдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
touch /tmp/no-attr
chmod +a "everyone deny writeextattr" /tmp/no-attr
xattr -w attrname vale /tmp/no-attr
xattr: [Errno 13] Permission denied: '/tmp/no-attr'
```
Moreover, **AppleDouble** рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЙрд╕рдХреЗ ACEs рд╕рд╣рд┐рдд рдХреЙрдкреА рдХрд░рддрд╛ рд╣реИред

In the [**source code**](https://opensource.apple.com/source/Libc/Libc-391/darwin/copyfile.c.auto.html) рдпрд╣ рджреЗрдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ xattr рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣реАрдд ACL рдкрд╛рда рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ **`com.apple.acl.text`** рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдиреЗ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ **AppleDouble** рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдПрдХ рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдХреБрдЪрд┐рдд рдХрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ ACL рд╣реИ рдЬреЛ рдЕрдиреНрдп xattrs рдХреЛ рдЗрд╕рдореЗрдВ рд▓рд┐рдЦрдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ... рддреЛ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди xattr рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:

{% code overflow="wrap" %}
```bash
chmod +a "everyone deny write,writeattr,writeextattr" /tmp/test
ditto -c -k test test.zip
python3 -m http.server
# Download the zip from the browser and decompress it, the file should be without a quarantine xattr
```
{% endcode %}

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ**](https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/) рджреЗрдЦреЗрдВред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕реЗ AppleArchives рдХреЗ рд╕рд╛рде рднреА рд╢реЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
mkdir app
touch app/test
chmod +a "everyone deny write,writeattr,writeextattr" app/test
aa archive -d app -o test.aar
```
### [CVE-2023-27943](https://blog.f-secure.com/discovery-of-gatekeeper-bypass-cve-2023-27943/)

рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ **Google Chrome рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рдерд╛** рдХреБрдЫ macOS рдЖрдВрддрд░рд┐рдХ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдХрд╛рд░рдгред

### [CVE-2023-27951](https://redcanary.com/blog/gatekeeper-bypass-vulnerabilities/)

AppleDouble рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЧреБрдгреЛрдВ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ `._` рд╕реЗ рд╢реБрд░реВ рдХрд░рдХреЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВ, рдпрд╣ **macOS рдорд╢реАрдиреЛрдВ рдХреЗ рдмреАрдЪ рдлрд╝рд╛рдЗрд▓ рдЧреБрдгреЛрдВ рдХреА рдХреЙрдкреА рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ**ред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рджреЗрдЦрд╛ рдЧрдпрд╛ рдХрд┐ рдПрдХ AppleDouble рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЕрдирдЬрд╝рд┐рдк рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, `._` рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдХреЛ **рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рджреА рдЧрдИ**ред

{% code overflow="wrap" %}
```bash
mkdir test
echo a > test/a
echo b > test/b
echo ._a > test/._a
aa archive -d test/ -o test.aar

# If you downloaded the resulting test.aar and decompress it, the file test/._a won't have a quarantitne attribute
```
{% endcode %}

рдПрдХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЬрд┐рд╕рдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реЛрдЧреА, рдпрд╣ **рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ред** рдЪрд╛рд▓ рдпрд╣ рдереА рдХрд┐ **рдПрдкреНрдкрд▓рдбрдмрд▓ рдирд╛рдо рд╕рдореНрдореЗрд▓рди** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдПрдХ DMG рдлрд╝рд╛рдЗрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдмрдирд╛рдирд╛ (рдЗрд╕реЗ `._` рд╕реЗ рд╢реБрд░реВ рдХрд░рдирд╛) рдФрд░ рдЗрд╕ рдЫрд┐рдкреА рд╣реБрдИ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП **рдПрдХ рджреГрд╢реНрдп рдлрд╝рд╛рдЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╕рд┐рдо рд▓рд┐рдВрдХ рдмрдирд╛рдирд╛** рдЬрд┐рд╕рдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рд╣реЛред\
рдЬрдм **dmg рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рд╣реИ, рдпрд╣ **рдЧреЗрдЯрдХреАрдкрд░ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рджреЗрдЧрд╛ред**
```bash
# Create an app bundle with the backdoor an call it app.app

echo "[+] creating disk image with app"
hdiutil create -srcfolder app.app app.dmg

echo "[+] creating directory and files"
mkdir
mkdir -p s/app
cp app.dmg s/app/._app.dmg
ln -s ._app.dmg s/app/app.dmg

echo "[+] compressing files"
aa archive -d s/ -o app.aar
```
### uchg (from this [talk](https://codeblue.jp/2023/result/pdf/cb23-bypassing-macos-security-and-privacy-mechanisms-from-gatekeeper-to-system-integrity-protection-by-koh-nakagawa.pdf))

* рдПрдХ рдРрдк рд╡рд╛рд▓рд╛ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдмрдирд╛рдПрдВред
* рдРрдк рдореЗрдВ uchg рдЬреЛрдбрд╝реЗрдВред
* рдРрдк рдХреЛ tar.gz рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдХреБрдЪрд┐рдд рдХрд░реЗрдВред
* tar.gz рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХ рдкреАрдбрд╝рд┐рдд рдХреЛ рднреЗрдЬреЗрдВред
* рдкреАрдбрд╝рд┐рдд tar.gz рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓рддрд╛ рд╣реИ рдФрд░ рдРрдк рдЪрд▓рд╛рддрд╛ рд╣реИред
* Gatekeeper рдРрдк рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред

### Prevent Quarantine xattr

рдПрдХ ".app" рдмрдВрдбрд▓ рдореЗрдВ рдпрджрд┐ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди xattr рдЬреЛрдбрд╝рд╛ рдирд╣реАрдВ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп **Gatekeeper рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реЛрдЧрд╛**ред

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
