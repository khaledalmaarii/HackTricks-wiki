# macOS Office Sandbox Bypasses

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Word Sandbox bypass via Launch Agents

рдпрд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди **`com.apple.security.temporary-exception.sbpl`** рдЕрдзрд┐рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ **рдХрд╕реНрдЯрдо рд╕реИрдВрдбрдмреЙрдХреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдХрд╕реНрдЯрдо рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХрд╣реАрдВ рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрдм рддрдХ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдирд╛рдо `~$` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ: `(require-any (require-all (vnode-type REGULAR-FILE) (regex #"(^|/)~$[^/]+$")))`

рдЗрд╕рд▓рд┐рдП, рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **`~/Library/LaunchAgents/~$escape.plist`** рдореЗрдВ рдПрдХ `plist` LaunchAgent рд▓рд┐рдЦрдирд╛ рдЙрддрдирд╛ рд╣реА рдЖрд╕рд╛рди рдерд╛ред

[**рдпрд╣рд╛рдВ рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рджреЗрдЦреЗрдВ**](https://www.mdsec.co.uk/2018/08/escaping-the-sandbox-microsoft-office-on-macos/)ред

### Word Sandbox bypass via Login Items and zip

рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдкрд╣рд▓реЗ рдХреЗ рдмрдЪрд╛рд╡ рд╕реЗ, Word рдордирдорд╛рдиреЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдирдХрд╛ рдирд╛рдо `~$` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдкрд┐рдЫрд▓реЗ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЗ рдкреИрдЪ рдХреЗ рдмрд╛рдж `/Library/Application Scripts` рдпрд╛ `/Library/LaunchAgents` рдореЗрдВ рд▓рд┐рдЦрдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рдерд╛ред

рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рднреАрддрд░ рдПрдХ **Login Item** (рдРрдкреНрд╕ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдВрдЧреЗ) рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпреЗ рдРрдкреНрд╕ **рддрдм рддрдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ** рдЬрдм рддрдХ рдХрд┐ рд╡реЗ **рдиреЛрдЯрд░рд╛рдЗрдЬреНрдб** рди рд╣реЛрдВ рдФрд░ **рдЖрд░реНрдЧреНрд╕ рдЬреЛрдбрд╝рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ** (рдЗрд╕рд▓рд┐рдП рдЖрдк рдХреЗрд╡рд▓ **`bash`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдирд╣реАрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ)ред

рдкрд┐рдЫрд▓реЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдпрдкрд╛рд╕ рд╕реЗ, Microsoft рдиреЗ `~/Library/LaunchAgents` рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦрдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдЕрдХреНрд╖рдо рдХрд░ рджрд┐рдпрд╛ред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рдпрджрд┐ рдЖрдк рдПрдХ **рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдХреЛ Login Item рдХреЗ рд░реВрдк рдореЗрдВ рд░рдЦрддреЗ рд╣реИрдВ** рддреЛ `Archive Utility` рдмрд╕ рдЗрд╕реЗ рдЙрд╕рдХреЗ рд╡рд░реНрддрдорд╛рди рд╕реНрдерд╛рди рдкрд░ **рдЕрдирдЬрд╝рд┐рдк** рдХрд░ рджреЗрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдЪреВрдВрдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `~/Library` рд╕реЗ `LaunchAgents` рдлрд╝реЛрд▓реНрдбрд░ рдирд╣реАрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП **`LaunchAgents/~$escape.plist`** рдореЗрдВ рдПрдХ plist рдХреЛ **рдЬрд╝рд┐рдк рдХрд░рдирд╛** рдФрд░ **рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдХреЛ `~/Library` рдореЗрдВ рд░рдЦрдирд╛** рд╕рдВрднрд╡ рдерд╛ рддрд╛рдХрд┐ рдЬрдм рдЗрд╕реЗ рдЕрдирдХрдВрдкреНрд░реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдП рддреЛ рдпрд╣ рд╕реНрдерд╛рдпреА рдЧрдВрддрд╡реНрдп рддрдХ рдкрд╣реБрдБрдЪ рдЬрд╛рдПред

[**рдпрд╣рд╛рдВ рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рджреЗрдЦреЗрдВ**](https://objective-see.org/blog/blog\_0x4B.html)уАВ

### Word Sandbox bypass via Login Items and .zshenv

(рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдкрд╣рд▓реЗ рдХреЗ рдмрдЪрд╛рд╡ рд╕реЗ, Word рдордирдорд╛рдиреЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдирдХрд╛ рдирд╛рдо `~$` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ)ред

рд╣рд╛рд▓рд╛рдБрдХрд┐, рдкрд┐рдЫрд▓реЗ рддрдХрдиреАрдХ рдореЗрдВ рдПрдХ рд╕реАрдорд╛ рдереА, рдпрджрд┐ рдлрд╝реЛрд▓реНрдбрд░ **`~/Library/LaunchAgents`** рдореМрдЬреВрдж рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рдЕрдиреНрдп рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдиреЗ рдЗрд╕реЗ рдмрдирд╛рдпрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ Login Items рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЧрдпрд╛ред

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдлрд╝рд╛рдЗрд▓реЗрдВ **`.bash_profile`** рдФрд░ **`.zshenv`** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЗрд▓реЛрдб рд╣реЛ рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рдЬрд╝рд┐рдк рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдЬрд╝рд┐рдк рдХреЛ рдкреАрдбрд╝рд┐рдд** рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ: **`~/~$escape.zip`**ред

рдлрд┐рд░, рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдХреЛ **Login Items** рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдлрд┐рд░ **`Terminal`** рдРрдкред рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд┐рд░ рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЕрдирдХрдВрдкреНрд░реЗрд╕ рдХреА рдЬрд╛рдПрдЧреА, **`.bash_profile`** рдФрд░ **`.zshenv`** рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рддреЗ рд╣реБрдП рдФрд░ рдЗрд╕рд▓рд┐рдП, рдЯрд░реНрдорд┐рдирд▓ рдЗрдирдореЗрдВ рд╕реЗ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ (рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реБрдП рдХрд┐ bash рдпрд╛ zsh рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)ред

[**рдпрд╣рд╛рдВ рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рджреЗрдЦреЗрдВ**](https://desi-jarvis.medium.com/office365-macos-sandbox-escape-fcce4fa4123c)уАВ

### Word Sandbox Bypass with Open and env variables

рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХрд┐рдП рдЧрдП рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рд╕реЗ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ **`open`** рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмреБрд▓рд╛рдирд╛ рдЕрднреА рднреА рд╕рдВрднрд╡ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ **рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕** рдХреЗ рднреАрддрд░ рдЪрд▓реЗрдВрдЧреАред

рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рдУрдкрди рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдореЗрдВ **`--env`** рд╡рд┐рдХрд▓реНрдк рд╣реИ рдЬрд┐рд╕рд╕реЗ рдПрдХ рдРрдк рдХреЛ **рд╡рд┐рд╢рд┐рд╖реНрдЯ env** рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╕рдВрднрд╡ рдерд╛ рдХрд┐ **рд╕реИрдВрдбрдмреЙрдХреНрд╕** рдХреЗ рднреАрддрд░ рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ **`.zshenv` рдлрд╝рд╛рдЗрд▓** рдмрдирд╛рдИ рдЬрд╛рдП рдФрд░ `open` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `--env` рдХреЗ рд╕рд╛рде **`HOME` рд╡реЗрд░рд┐рдПрдмрд▓** рдХреЛ рдЙрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдП, рдЬрд┐рд╕рд╕реЗ рд╡рд╣ `Terminal` рдРрдк рдЦреЛрд▓реЗ, рдЬреЛ `.zshenv` рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ (рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ `__OSINSTALL_ENVIROMENT` рд╡реЗрд░рд┐рдПрдмрд▓ рд╕реЗрдЯ рдХрд░рдирд╛ рднреА рдЖрд╡рд╢реНрдпрдХ рдерд╛)ред

[**рдпрд╣рд╛рдВ рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рджреЗрдЦреЗрдВ**](https://perception-point.io/blog/technical-analysis-of-cve-2021-30864/)ред

### Word Sandbox Bypass with Open and stdin

**`open`** рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдиреЗ **`--stdin`** рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рднреА рд╕рдорд░реНрдерди рдХрд┐рдпрд╛ (рдФрд░ рдкрд┐рдЫрд▓реЗ рдмрд╛рдпрдкрд╛рд╕ рдХреЗ рдмрд╛рдж `--env` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рдерд╛)ред

рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рднрд▓реЗ рд╣реА **`python`** Apple рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рдпрд╣ **`quarantine`** рд╡рд┐рд╢реЗрд╖рддрд╛ рд╡рд╛рд▓реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд░реЗрдЧрд╛**ред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрд╕реЗ stdin рд╕реЗ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрд╛рд╕ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ рддрд╛рдХрд┐ рдпрд╣ рди рджреЗрдЦреЗ рдХрд┐ рдпрд╣ рдХреНрд╡рд╛рд░рдВрдЯрд╛рдЗрди рдореЗрдВ рдерд╛ рдпрд╛ рдирд╣реАрдВ:&#x20;

1. рдПрдХ **`~$exploit.py`** рдлрд╝рд╛рдЗрд▓ рдЫреЛрдбрд╝реЗрдВ рдЬрд┐рд╕рдореЗрдВ рдордирдорд╛рдиреЗ Python рдХрдорд╛рдВрдб рд╣реЛрдВред
2. _open_ **`тАУstdin='~$exploit.py' -a Python`** рдЪрд▓рд╛рдПрдБ, рдЬреЛ Python рдРрдк рдХреЛ рд╣рдорд╛рд░реЗ рдЫреЛрдбрд╝реЗ рдЧрдП рдлрд╝рд╛рдЗрд▓ рдХреЗ рдорд╛рдирдХ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рддрд╛ рд╣реИред Python рдЦреБрд╢реА-рдЦреБрд╢реА рд╣рдорд╛рд░реЗ рдХреЛрдб рдХреЛ рдЪрд▓рд╛рддрд╛ рд╣реИ, рдФрд░ рдЪреВрдВрдХрд┐ рдпрд╣ _launchd_ рдХрд╛ рдПрдХ рдЪрд╛рдЗрд▓реНрдб рдкреНрд░реЛрд╕реЗрд╕ рд╣реИ, рдпрд╣ Word рдХреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдирд┐рдпрдореЛрдВ рд╕реЗ рдмрдВрдзрд╛ рдирд╣реАрдВ рд╣реИред

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
