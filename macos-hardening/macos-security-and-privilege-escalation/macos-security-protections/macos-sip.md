# macOS SIP

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## **Basic Information**

**System Integrity Protection (SIP)** macOS рдореЗрдВ рдПрдХ рддрдВрддреНрд░ рд╣реИ рдЬреЛ рд╕рдмрд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рднреА рдкреНрд░рдореБрдЦ рд╕рд┐рд╕реНрдЯрдо рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдореЗрдВ рдЕрдирдзрд┐рдХреГрдд рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рд╕рд┐рд╕реНрдЯрдо рдХреА рдЕрдЦрдВрдбрддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддреА рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛, рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдпрд╛ рд╣рдЯрд╛рдирд╛ред SIP рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдкреНрд░рдореБрдЦ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* **/System**
* **/bin**
* **/sbin**
* **/usr**

SIP рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдирд┐рдпрдо **`/System/Library/Sandbox/rootless.conf`** рдореЗрдВ рд╕реНрдерд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реИрдВред рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ, рдЙрди рдкрдереЛрдВ рдХреЛ рдЬреЛ рдПрдХ рддрд╛рд░рд╛рдВрдХрд┐рдд (\*) рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рд░рдВрдн рд╣реЛрддреЗ рд╣реИрдВ, рдЕрдиреНрдпрдерд╛ рдХрдареЛрд░ SIP рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд░реВрдк рдореЗрдВ рджрд░реНрд╢рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ:
```javascript
/usr
* /usr/libexec/cups
* /usr/local
* /usr/share/man
```
рдпрд╣ рд╕реНрдирд┐рдкреЗрдЯ рдпрд╣ рд╕рдВрдХреЗрдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЬрдмрдХрд┐ SIP рд╕рд╛рдорд╛рдиреНрдпрддрдГ **`/usr`** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдХреБрдЫ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ (`/usr/libexec/cups`, `/usr/local`, рдФрд░ `/usr/share/man`) рд╣реИрдВ рдЬрд╣рд╛рдБ рд╕рдВрд╢реЛрдзрди рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдЙрдирдХреЗ рдкрдереЛрдВ рдХреЗ рдкрд╣рд▓реЗ рдЕsterisk (\*) рджреНрд╡рд╛рд░рд╛ рд╕рдВрдХреЗрддрд┐рдд рд╣реИред

рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдпрд╛ рдлрд╝рд╛рдЗрд▓ SIP рджреНрд╡рд╛рд░рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ, рдЖрдк **`ls -lOd`** рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ **`restricted`** рдпрд╛ **`sunlnk`** рдзреНрд╡рдЬ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд╕рдХреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```bash
ls -lOd /usr/libexec/cups
drwxr-xr-x  11 root  wheel  sunlnk 352 May 13 00:29 /usr/libexec/cups
```
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, **`sunlnk`** рдзреНрд╡рдЬ рдпрд╣ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ `/usr/libexec/cups` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реНрд╡рдпрдВ **рд╣рдЯрд╛рдИ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддреА**, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЗрд╕рдХреЗ рднреАрддрд░ рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрдирд╛рдИ, рд╕рдВрд╢реЛрдзрд┐рдд рдпрд╛ рд╣рдЯрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред

рджреВрд╕рд░реА рдУрд░:
```bash
ls -lOd /usr/libexec
drwxr-xr-x  338 root  wheel  restricted 10816 May 13 00:29 /usr/libexec
```
рдпрд╣рд╛рдБ, **`restricted`** рдзреНрд╡рдЬ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ `/usr/libexec` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ SIP рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рд╣реИред SIP-рд╕рдВрд░рдХреНрд╖рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрдирд╛рдИ, рд╕рдВрд╢реЛрдзрд┐рдд рдпрд╛ рд╣рдЯрд╛рдИ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддреАрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **`com.apple.rootless`** рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд **attribute** рд╣реИ, рддреЛ рд╡рд╣ рдлрд╝рд╛рдЗрд▓ рднреА **SIP рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд** рд╣реЛрдЧреАред

**SIP рдЕрдиреНрдп рд░реВрдЯ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рднреА рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИ** рдЬреИрд╕реЗ:

* рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд▓реЛрдб рдХрд░рдирд╛
* Apple-рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдп-ports рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛
* NVRAM рдЪрд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛
* рдХрд░реНрдиреЗрд▓ рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛

рд╡рд┐рдХрд▓реНрдк nvram рдЪрд░ рдореЗрдВ рдПрдХ рдмрд┐рдЯрдлреНрд▓реИрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдмрдирд╛рдП рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ (`csr-active-config` Intel рдкрд░ рдФрд░ `lp-sip0` ARM рдХреЗ рд▓рд┐рдП рдмреВрдЯ рдХрд┐рдП рдЧрдП рдбрд┐рд╡рд╛рдЗрд╕ рдЯреНрд░реА рд╕реЗ рдкрдврд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ)ред рдЖрдк XNU рд╕реНрд░реЛрдд рдХреЛрдб рдореЗрдВ `csr.sh` рдореЗрдВ рдзреНрд╡рдЬ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../../../.gitbook/assets/image (1192).png" alt=""><figcaption></figcaption></figure>

### SIP рд╕реНрдерд┐рддрд┐

рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ SIP рдЖрдкрдХреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╕рдХреНрд╖рдо рд╣реИ:
```bash
csrutil status
```
рдпрджрд┐ рдЖрдкрдХреЛ SIP рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ рд░рд┐рдХрд╡рд░реА рдореЛрдб рдореЗрдВ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдХреЗ рджреМрд░рд╛рди Command+R рджрдмрд╛рдХрд░), рдлрд┐рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ:
```bash
csrutil disable
```
рдпрджрд┐ рдЖрдк SIP рдХреЛ рд╕рдХреНрд╖рдо рд░рдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдбрд┐рдмрдЧрд┐рдВрдЧ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рд╣рдЯрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
csrutil enable --without debug
```
### рдЕрдиреНрдп рдкреНрд░рддрд┐рдмрдВрдз

* **рдЕрд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди** (kexts) рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреЗрд╡рд▓ рд╕рддреНрдпрд╛рдкрд┐рдд рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╕рд┐рд╕реНрдЯрдо рдХрд░реНрдиреЗрд▓ рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░реЗрдВред
* **macOS рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ** рдХрд╛ рдбрд┐рдмрдЧрд┐рдВрдЧ рд░реЛрдХрддрд╛ рд╣реИ, рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рд╕рдВрд╢реЛрдзрди рд╕реЗ рдХреЛрд░ рд╕рд┐рд╕реНрдЯрдо рдШрдЯрдХреЛрдВ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред
* **dtrace рдЬреИрд╕реЗ рдЙрдкрдХрд░рдгреЛрдВ** рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ, рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреА рдЕрдЦрдВрдбрддрд╛ рдХреА рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред

[**рдЗрд╕ рд╡рд╛рд░реНрддрд╛ рдореЗрдВ SIP рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ**](https://www.slideshare.net/i0n1c/syscan360-stefan-esser-os-x-el-capitan-sinking-the-ship)**ред**

## SIP рдмрд╛рдпрдкрд╛рд╕

SIP рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рд╕реЗ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ:

* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ**: рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЛрдВ рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдЬреИрд╕реЗ рдореЗрд▓, рд╕рдВрджреЗрд╢ рдФрд░ рд╕рдлрд╛рд░реА рдЗрддрд┐рд╣рд╛рд╕ рдкрдврд╝реЗрдВред
* **TCC рдмрд╛рдпрдкрд╛рд╕**: TCC (Transparency, Consent, and Control) рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рд╕реАрдзреЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рд╡реЗрдмрдХреИрдо, рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рдФрд░ рдЕрдиреНрдп рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛ рд╕рдХреЗред
* **рд╕реНрдерд╛рдпреАрддрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ**: SIP-рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдореИрд▓рд╡реЗрдпрд░ рд░рдЦреЗрдВ, рдЗрд╕реЗ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рд░реЛрдзреА рдмрдирд╛рддреЗ рд╣реБрдП, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рднреАред рдЗрд╕рдореЗрдВ рдореИрд▓рд╡реЗрдпрд░ рд╣рдЯрд╛рдиреЗ рдХреЗ рдЙрдкрдХрд░рдг (MRT) рдХреЗ рд╕рд╛рде рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИред
* **рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд▓реЛрдб рдХрд░реЗрдВ**: рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рд╣реИрдВ, SIP рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рдЕрд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддрд╛ рд╣реИред

### рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдкреИрдХреЗрдЬ

**рдПрдкреНрдкрд▓ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдкреИрдХреЗрдЬ** рдЗрд╕рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрджрд┐ рд╡реЗ SIP-рд╕реБрд░рдХреНрд╖рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдорд╛рдирдХ рдбреЗрд╡рд▓рдкрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдкреИрдХреЗрдЬ рднреА рдЕрд╡рд░реБрджреНрдз рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред

### рдЕрд╕реНрддрд┐рддреНрд╡рд╣реАрди SIP рдлрд╝рд╛рдЗрд▓

рдПрдХ рд╕рдВрднрд╛рд╡рд┐рдд рдЫрд┐рджреНрд░ рдпрд╣ рд╣реИ рдХрд┐ рдпрджрд┐ рдПрдХ рдлрд╝рд╛рдЗрд▓ **`rootless.conf` рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реИ рд▓реЗрдХрд┐рди рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ**, рддреЛ рдЗрд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдореИрд▓рд╡реЗрдпрд░ рдЗрд╕рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдХрд░ **рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╕реНрдерд╛рдпреАрддрд╛ рд╕реНрдерд╛рдкрд┐рдд** рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдкреНрд░реЛрдЧреНрд░рд╛рдо `/System/Library/LaunchDaemons` рдореЗрдВ рдПрдХ .plist рдлрд╝рд╛рдЗрд▓ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдпрд╣ `rootless.conf` рдореЗрдВ рд╕реВрдЪреАрдмрджреНрдз рд╣реИ рд▓реЗрдХрд┐рди рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИред

### com.apple.rootless.install.heritable

{% hint style="danger" %}
рдЕрдзрд┐рдХрд╛рд░ **`com.apple.rootless.install.heritable`** SIP рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ
{% endhint %}

#### [CVE-2019-8561](https://objective-see.org/blog/blog\_0x42.html) <a href="#cve" id="cve"></a>

рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ **рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рдЗрд╕рдХреЗ рдХреЛрдб** рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдкреИрдХреЗрдЬ рдХреЛ **рд╕реНрд╡реИрдк рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛** рдФрд░ рдлрд┐рд░, рд╕рд┐рд╕реНрдЯрдо рдореВрд▓ рдкреИрдХреЗрдЬ рдХреЗ рдмрдЬрд╛рдп рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдкреИрдХреЗрдЬ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдЧрд╛ред рдЪреВрдВрдХрд┐ рдпреЗ рдХреНрд░рд┐рдпрд╛рдПрдБ **`system_installd`** рджреНрд╡рд╛рд░рд╛ рдХреА рдЧрдИ рдереАрдВ, рдпрд╣ SIP рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред

#### [CVE-2020тАУ9854](https://objective-see.org/blog/blog\_0x4D.html) <a href="#cve-unauthd-chain" id="cve-unauthd-chain"></a>

рдпрджрд┐ рдПрдХ рдкреИрдХреЗрдЬ рдПрдХ рдорд╛рдЙрдВрдЯреЗрдб рдЗрдореЗрдЬ рдпрд╛ рдмрд╛рд╣рд░реА рдбреНрд░рд╛рдЗрд╡ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рддреЛ **рдЗрдВрд╕реНрдЯреЙрд▓рд░** **рдЙрд╕ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо** рд╕реЗ рдмрд╛рдЗрдирд░реА рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░реЗрдЧрд╛ (SIP-рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рди рд╕реЗ рдирд╣реАрдВ), рдЬрд┐рд╕рд╕реЗ **`system_installd`** рдПрдХ рдордирдорд╛рдирд╛ рдмрд╛рдЗрдирд░реА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред

#### CVE-2021-30892 - Shrootless

[**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдХреЗ рд╢реЛрдзрдХрд░реНрддрд╛рдУрдВ**](https://www.microsoft.com/en-us/security/blog/2021/10/28/microsoft-finds-new-macos-vulnerability-shrootless-that-could-bypass-system-integrity-protection/) рдиреЗ macOS рдХреЗ рд╕рд┐рд╕реНрдЯрдо рдЗрдВрдЯреАрдЧреНрд░рд┐рдЯреА рдкреНрд░реЛрдЯреЗрдХреНрд╢рди (SIP) рддрдВрддреНрд░ рдореЗрдВ рдПрдХ рднреЗрджреНрдпрддрд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛, рдЬрд┐рд╕реЗ 'Shrootless' рднреЗрджреНрдпрддрд╛ рдХрд╣рд╛ рдЧрдпрд╛ред рдпрд╣ рднреЗрджреНрдпрддрд╛ **`system_installd`** рдбреЗрдорди рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдХреЗрдВрджреНрд░рд┐рдд рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдЕрдзрд┐рдХрд╛рд░ рд╣реИ, **`com.apple.rootless.install.heritable`**, рдЬреЛ рдЗрд╕рдХреЗ рдХрд┐рд╕реА рднреА рдмрд╛рд▓ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ SIP рдХреЗ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

**`system_installd`** рдбреЗрдорди рдЙрди рдкреИрдХреЗрдЬреЛрдВ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдЧрд╛ рдЬреЛ **Apple** рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рд╣реИрдВред

рд╢реЛрдзрдХрд░реНрддрд╛рдУрдВ рдиреЗ рдкрд╛рдпрд╛ рдХрд┐ Apple-рд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП рдкреИрдХреЗрдЬ (.pkg рдлрд╝рд╛рдЗрд▓) рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рджреМрд░рд╛рди, **`system_installd`** рдкреИрдХреЗрдЬ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рд╕реА рднреА **рдкреЛрд╕реНрдЯ-рдЗрдВрд╕реНрдЯреЙрд▓** рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ **рдЪрд▓рд╛рддрд╛ рд╣реИ**ред рдпреЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╢реЗрд▓, **`zsh`** рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ **`/etc/zshenv`** рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдЖрджреЗрд╢ рдЪрд▓рд╛рддреА рд╣реИ, рдпрджрд┐ рдпрд╣ рдореМрдЬреВрдж рд╣реИ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЧреИрд░-рдЗрдВрдЯрд░рдПрдХреНрдЯрд┐рд╡ рдореЛрдб рдореЗрдВ рднреАред рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдорд▓рд╛рд╡рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг `/etc/zshenv` рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдХрд░ рдФрд░ **`system_installd` рдХреЗ `zsh` рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдХреЗ**, рд╡реЗ рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рдордирдорд╛рдиреЗ рдСрдкрд░реЗрд╢рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ **`/etc/zshenv` рдХреЛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╣рдорд▓реЗ рдХреА рддрдХрдиреАрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**, рди рдХрд┐ рдХреЗрд╡рд▓ SIP рдмрд╛рдпрдкрд╛рд╕ рдХреЗ рд▓рд┐рдПред рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ `~/.zshenv` рдлрд╝рд╛рдЗрд▓ рд╣реЛрддреА рд╣реИ, рдЬреЛ `/etc/zshenv` рдХреА рддрд░рд╣ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд░рддреА рд╣реИ рд▓реЗрдХрд┐рди рд░реВрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреАред рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рд╕реНрдерд╛рдпреАрддрд╛ рддрдВрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╣рд░ рдмрд╛рд░ `zsh` рд╢реБрд░реВ рд╣реЛрдиреЗ рдкрд░ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИ, рдпрд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рддрдВрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВред рдпрджрд┐ рдПрдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `sudo -s` рдпрд╛ `sudo <command>` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░реВрдЯ рдореЗрдВ рдмрдврд╝рддрд╛ рд╣реИ, рддреЛ `~/.zshenv` рдлрд╝рд╛рдЗрд▓ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдЧреА, рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рд░реВрдЯ рдореЗрдВ рдмрдврд╝рддреЗ рд╣реБрдПред

#### [**CVE-2022-22583**](https://perception-point.io/blog/technical-analysis-cve-2022-22583/)

[**CVE-2022-22583**](https://perception-point.io/blog/technical-analysis-cve-2022-22583/) рдореЗрдВ рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рд╡рд╣реА **`system_installd`** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрднреА рднреА рджреБрд░реБрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **`/tmp` рдХреЗ рдЕрдВрджрд░ SIP рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдирд╛рдорд┐рдд рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рдкреЛрд╕реНрдЯ-рдЗрдВрд╕реНрдЯреЙрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдбрд╛рд▓ рд░рд╣реА рдереА**ред рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ **`/tmp` рд╕реНрд╡рдпрдВ SIP рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдПрдХ **рд╡рд░реНрдЪреБрдЕрд▓ рдЗрдореЗрдЬ рдХреЛ рдЙрд╕ рдкрд░ рдорд╛рдЙрдВрдЯ** рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛, рдлрд┐рд░ **рдЗрдВрд╕реНрдЯреЙрд▓рд░** рд╡рд╣рд╛рдВ **рдкреЛрд╕реНрдЯ-рдЗрдВрд╕реНрдЯреЙрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдбрд╛рд▓рддрд╛, **рд╡рд░реНрдЪреБрдЕрд▓ рдЗрдореЗрдЬ рдХреЛ рдЕрдирдорд╛рдЙрдВрдЯ** рдХрд░рддрд╛, **рд╕рднреА рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рддрд╛** рдФрд░ **рдкреЗрд▓реЛрдб рдХреЗ рд╕рд╛рде рдкреЛрд╕реНрдЯ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди** рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝рддрд╛ред

#### [fsck\_cs рдЙрдкрдпреЛрдЧрд┐рддрд╛](https://www.theregister.com/2016/03/30/apple\_os\_x\_rootless/)

рдПрдХ рднреЗрджреНрдпрддрд╛ рдХреА рдкрд╣рдЪрд╛рди рдХреА рдЧрдИ рдЬрд╣рд╛рдВ **`fsck_cs`** рдХреЛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдлрд╝рд╛рдЗрд▓ рдХреЛ рднреНрд░рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреБрдорд░рд╛рд╣ рдХрд┐рдпрд╛ рдЧрдпрд╛, рдЗрд╕рдХреА **рд╕рд╛рдВрдХреЗрддрд┐рдХ рд▓рд┐рдВрдХ** рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреЗ рдХрд╛рд░рдгред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдиреЗ _`/dev/diskX`_ рд╕реЗ рдлрд╝рд╛рдЗрд▓ `/System/Library/Extensions/AppleKextExcludeList.kext/Contents/Info.plist` рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рд┐рдВрдХ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ред _`/dev/diskX`_ рдкрд░ **`fsck_cs`** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рд╕реЗ `Info.plist` рдХрд╛ рднреНрд░рд╖реНрдЯрд╛рдЪрд╛рд░ рд╣реБрдЖред рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреА рдЕрдЦрдВрдбрддрд╛ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ SIP (рд╕рд┐рд╕реНрдЯрдо рдЗрдВрдЯреАрдЧреНрд░рд┐рдЯреА рдкреНрд░реЛрдЯреЗрдХреНрд╢рди) рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдЬреЛ рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд▓реЛрдбрд┐рдВрдЧ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдПрдХ рдмрд╛рд░ рднреНрд░рд╖реНрдЯ рд╣реЛрдиреЗ рдкрд░, SIP рдХреА рдХрд░реНрдиреЗрд▓ рдЕрдкрд╡рд╛рдж рдкреНрд░рдмрдВрдзрди рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛрддреА рд╣реИред

рдЗрд╕ рднреЗрджреНрдпрддрд╛ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрджреЗрд╢ рд╣реИрдВ:
```bash
ln -s /System/Library/Extensions/AppleKextExcludeList.kext/Contents/Info.plist /dev/diskX
fsck_cs /dev/diskX 1>&-
touch /Library/Extensions/
reboot
```
рдЗрд╕ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЗ рд╢реЛрд╖рдг рдХреЗ рдЧрдВрднреАрд░ рдкрд░рд┐рдгрд╛рдо рд╣реИрдВред `Info.plist` рдлрд╝рд╛рдЗрд▓, рдЬреЛ рд╕рд╛рдорд╛рдиреНрдпрддрдГ рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрддреА рд╣реИ, рдЕрдкреНрд░рднрд╛рд╡реА рд╣реЛ рдЬрд╛рддреА рд╣реИред рдЗрд╕рдореЗрдВ рдХреБрдЫ рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреЛрдВ, рдЬреИрд╕реЗ `AppleHWAccess.kext` рдХреЛ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдХрд░рдиреЗ рдХреА рдЕрд╕рдорд░реНрдерддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, SIP рдХреЗ рдирд┐рдпрдВрддреНрд░рдг рддрдВрддреНрд░ рдХреЗ рдЦрд░рд╛рдм рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рдЗрд╕ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рдХреА RAM рддрдХ рдЕрдирдзрд┐рдХреГрдд рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

#### [SIP рд╕рдВрд░рдХреНрд╖рд┐рдд рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдкрд░ рдорд╛рдЙрдВрдЯ рдХрд░реЗрдВ](https://www.slideshare.net/i0n1c/syscan360-stefan-esser-os-x-el-capitan-sinking-the-ship)

**рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП SIP рд╕рдВрд░рдХреНрд╖рд┐рдд рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдкрд░ рдПрдХ рдирдИ рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдгрд╛рд▓реА рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ред**
```bash
mkdir evil
# Add contento to the folder
hdiutil create -srcfolder evil evil.dmg
hdiutil attach -mountpoint /System/Library/Snadbox/ evil.dmg
```
#### [Upgrader bypass (2016)](https://objective-see.org/blog/blog\_0x14.html)

рд╕рд┐рд╕реНрдЯрдо рдХреЛ `Install macOS Sierra.app` рдХреЗ рднреАрддрд░ рдПрдХ рдПрдореНрдмреЗрдбреЗрдб рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдбрд┐рд╕реНрдХ рдЗрдореЗрдЬ рд╕реЗ рдмреВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддрд╛рдХрд┐ OS рдХреЛ рдЕрдкрдЧреНрд░реЗрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, `bless` рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдПред рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдХрдорд╛рдВрдб рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ:
```bash
/usr/sbin/bless -setBoot -folder /Volumes/Macintosh HD/macOS Install Data -bootefi /Volumes/Macintosh HD/macOS Install Data/boot.efi -options config="\macOS Install Data\com.apple.Boot" -label macOS Installer
```
рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЦрддрд░рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдмреВрдЯ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЕрдкрдЧреНрд░реЗрдб рдЗрдореЗрдЬ (`InstallESD.dmg`) рдХреЛ рдмрджрд▓рддрд╛ рд╣реИред рд░рдгрдиреАрддрд┐ рдореЗрдВ рдПрдХ рдбрд╛рдпрдирд╛рдорд┐рдХ рд▓реЛрдбрд░ (dyld) рдХреЛ рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рд╕рдВрд╕реНрдХрд░рдг (`libBaseIA.dylib`) рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдпрд╣ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдЗрдВрд╕реНрдЯреЙрд▓рд░ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдХреЛрдб рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рд╣реЛрддрд╛ рд╣реИред

рд╣рдорд▓рд╛рд╡рд░ рдХрд╛ рдХреЛрдб рдЕрдкрдЧреНрд░реЗрдб рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдкрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рддреЗ рд╣реБрдПред рд╣рдорд▓рд╛ `InstallESD.dmg` рдЗрдореЗрдЬ рдХреЛ рдореЗрдердб рд╕реНрд╡рд┐рдЬрд╝рд▓рд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрджрд▓рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЖрдЧреЗ рдмрдврд╝рддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ `extractBootBits` рдореЗрдердб рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕рд╕реЗ рдбрд┐рд╕реНрдХ рдЗрдореЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдХрд╛ рдЗрдВрдЬреЗрдХреНрд╢рди рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, `InstallESD.dmg` рдХреЗ рднреАрддрд░, рдПрдХ `BaseSystem.dmg` рд╣реИ, рдЬреЛ рдЕрдкрдЧреНрд░реЗрдб рдХреЛрдб рдХреА рд░реВрдЯ рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдгрд╛рд▓реА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рдбрд╛рдпрдирд╛рдорд┐рдХ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд░рдиреЗ рд╕реЗ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдПрдХ рдРрд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рднреАрддрд░ рдХрд╛рд░реНрдп рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ OS-рд╕реНрддрд░реАрдп рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдмрджрд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рдордЭреМрддреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрд╛рдлреА рдмрдврд╝ рдЬрд╛рддреА рд╣реИред

#### [systemmigrationd (2023)](https://www.youtube.com/watch?v=zxZesAN-TEk)

[**DEF CON 31**](https://www.youtube.com/watch?v=zxZesAN-TEk) рд╕реЗ рдЗрд╕ рд╡рд╛рд░реНрддрд╛ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ **`systemmigrationd`** (рдЬреЛ SIP рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИ) рдПрдХ **bash** рдФрд░ рдПрдХ **perl** рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ env рд╡реЗрд░рд┐рдПрдмрд▓ **`BASH_ENV`** рдФрд░ **`PERL5OPT`** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

#### CVE-2023-42860 <a href="#cve-a-detailed-look" id="cve-a-detailed-look"></a>

рдЬреИрд╕рд╛ рдХрд┐ [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдореЗрдВ рд╡рд┐рд╕реНрддреГрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**](https://blog.kandji.io/apple-mitigates-vulnerabilities-installer-scripts), `InstallAssistant.pkg` рдкреИрдХреЗрдЬ рд╕реЗ рдПрдХ `postinstall` рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ рд░рд╣реА рдереА:
```bash
/usr/bin/chflags┬а-h┬аnorestricted┬а"${SHARED_SUPPORT_PATH}/SharedSupport.dmg"
```
and рдпрд╣ рд╕рдВрднрд╡ рдерд╛ рдХрд┐ `${SHARED_SUPPORT_PATH}/SharedSupport.dmg` рдореЗрдВ рдПрдХ symlink рдмрдирд╛рдпрд╛ рдЬрд╛рдП рдЬреЛ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЕрдирд░рд┐рд╕реНрдЯреНрд░рд┐рдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, SIP рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддреЗ рд╣реБрдП**ред

### **com.apple.rootless.install**

{% hint style="danger" %}
рдЕрдзрд┐рдХрд╛рд░ **`com.apple.rootless.install`** SIP рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ
{% endhint %}

рдЕрдзрд┐рдХрд╛рд░ `com.apple.rootless.install` macOS рдкрд░ рд╕рд┐рд╕реНрдЯрдо рдЗрдВрдЯреАрдЧреНрд░рд┐рдЯреА рдкреНрд░реЛрдЯреЗрдХреНрд╢рди (SIP) рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ [**CVE-2022-26712**](https://jhftss.github.io/CVE-2022-26712-The-POC-For-SIP-Bypass-Is-Even-Tweetable/) рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓реЗ рдореЗрдВ, `/System/Library/PrivateFrameworks/ShoveService.framework/Versions/A/XPCServices/SystemShoveService.xpc` рдкрд░ рд╕реНрдерд┐рдд рд╕рд┐рд╕реНрдЯрдо XPC рд╕реЗрд╡рд╛ рдХреЗ рдкрд╛рд╕ рдпрд╣ рдЕрдзрд┐рдХрд╛рд░ рд╣реИред рдпрд╣ рд╕рдВрдмрдВрдзрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ SIP рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рд╕реЗрд╡рд╛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдПрдХ рд╡рд┐рдзрд┐ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреА рд╣реИ рдЬреЛ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдП рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

## рд╕реАрд▓ рдХрд┐рдП рдЧрдП рд╕рд┐рд╕реНрдЯрдо рд╕реНрдиреИрдкрд╢реЙрдЯ

рд╕реАрд▓ рдХрд┐рдП рдЧрдП рд╕рд┐рд╕реНрдЯрдо рд╕реНрдиреИрдкрд╢реЙрдЯ рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ Apple рдиреЗ **macOS Big Sur (macOS 11)** рдореЗрдВ **рд╕рд┐рд╕реНрдЯрдо рдЗрдВрдЯреАрдЧреНрд░рд┐рдЯреА рдкреНрд░реЛрдЯреЗрдХреНрд╢рди (SIP)** рддрдВрддреНрд░ рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рд╕реНрдерд┐рд░рддрд╛ рдХреА рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдкрд░рдд рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЗрд╢ рдХрд┐рдпрд╛ рд╣реИред рдпреЗ рдореВрд▓ рд░реВрдк рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рд╡реЙрд▓реНрдпреВрдо рдХреЗ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп рд╕рдВрд╕реНрдХрд░рдг рд╣реИрдВред

рдпрд╣рд╛рдБ рдПрдХ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдирдЬрд╝рд░ рд╣реИ:

1. **рдЕрдкрд░рд┐рд╡рд░реНрддрдиреАрдп рд╕рд┐рд╕реНрдЯрдо**: рд╕реАрд▓ рдХрд┐рдП рдЧрдП рд╕рд┐рд╕реНрдЯрдо рд╕реНрдиреИрдкрд╢реЙрдЯ macOS рд╕рд┐рд╕реНрдЯрдо рд╡реЙрд▓реНрдпреВрдо рдХреЛ "рдЕрдкрд░рд┐рд╡рд░реНрддрдиреАрдп" рдмрдирд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдЗрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдпрд╛ рд╕рд┐рд╕реНрдЯрдо рд╕реНрдерд┐рд░рддрд╛ рдХреЛ рдЦрддрд░реЗ рдореЗрдВ рдбрд╛рд▓рдиреЗ рд╡рд╛рд▓реЗ рдХрд┐рд╕реА рднреА рдЕрдирдзрд┐рдХреГрдд рдпрд╛ рдЖрдХрд╕реНрдорд┐рдХ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд░реЛрдХрддрд╛ рд╣реИред
2. **рд╕рд┐рд╕реНрдЯрдо рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЕрдкрдбреЗрдЯ**: рдЬрдм рдЖрдк macOS рдЕрдкрдбреЗрдЯ рдпрд╛ рдЕрдкрдЧреНрд░реЗрдб рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ macOS рдПрдХ рдирдпрд╛ рд╕рд┐рд╕реНрдЯрдо рд╕реНрдиреИрдкрд╢реЙрдЯ рдмрдирд╛рддрд╛ рд╣реИред рдлрд┐рд░ macOS рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рд╡реЙрд▓реНрдпреВрдо рдЗрд╕ рдирдП рд╕реНрдиреИрдкрд╢реЙрдЯ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **APFS (Apple File System)** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЕрдкрдбреЗрдЯ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдкреВрд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрдзрд┐рдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реЛ рдЬрд╛рддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рдЕрдкрдбреЗрдЯ рдХреЗ рджреМрд░рд╛рди рдХреБрдЫ рдЧрд▓рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╕рд┐рд╕реНрдЯрдо рд╣рдореЗрд╢рд╛ рдкрд┐рдЫрд▓реЗ рд╕реНрдиреИрдкрд╢реЙрдЯ рдкрд░ рд╡рд╛рдкрд╕ рд▓реМрдЯ рд╕рдХрддрд╛ рд╣реИред
3. **рдбреЗрдЯрд╛ рдкреГрдердХреНрдХрд░рдг**: macOS рдХреИрдЯрд╛рд▓рд┐рдирд╛ рдореЗрдВ рдкреЗрд╢ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рд╡реЙрд▓реНрдпреВрдо рдкреГрдердХреНрдХрд░рдг рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрдд рдХреЗ рд╕рд╛рде, рд╕реАрд▓ рдХрд┐рдП рдЧрдП рд╕рд┐рд╕реНрдЯрдо рд╕реНрдиреИрдкрд╢реЙрдЯ рд╕реБрд╡рд┐рдзрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рд╕рднреА рдбреЗрдЯрд╛ рдФрд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдПрдХ рдЕрд▓рдЧ "**рдбреЗрдЯрд╛**" рд╡реЙрд▓реНрдпреВрдо рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВред рдпрд╣ рдкреГрдердХреНрдХрд░рдг рдЖрдкрдХреЗ рдбреЗрдЯрд╛ рдХреЛ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рд╕реНрд╡рддрдВрддреНрд░ рдмрдирд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рдЕрдкрдбреЗрдЯ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИред

рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдпреЗ рд╕реНрдиреИрдкрд╢реЙрдЯ macOS рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЗ рдбрд┐рд╕реНрдХ рдкрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдирд╣реАрдВ рд▓реЗрддреЗ рд╣реИрдВ, APFS рдХреА рд╕реНрдерд╛рди рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рджред рдпрд╣ рднреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдпреЗ рд╕реНрдиреИрдкрд╢реЙрдЯ **рдЯрд╛рдЗрдо рдорд╢реАрди рд╕реНрдиреИрдкрд╢реЙрдЯ** рд╕реЗ рднрд┐рдиреНрди рд╣реЛрддреЗ рд╣реИрдВ, рдЬреЛ рдкреВрд░реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рд╕реБрд▓рдн рдмреИрдХрдЕрдк рд╣реЛрддреЗ рд╣реИрдВред

### рд╕реНрдиреИрдкрд╢реЙрдЯ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ

рдХрдорд╛рдВрдб **`diskutil apfs list`** **APFS рд╡реЙрд▓реНрдпреВрдо рдХреЗ рд╡рд┐рд╡рд░рдг** рдФрд░ рдЙрдирдХреЗ рд▓реЗрдЖрдЙрдЯ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рддрд╛ рд╣реИ:

<pre><code>+-- Container disk3 966B902E-EDBA-4775-B743-CF97A0556A13
|   ====================================================
|   APFS Container Reference:     disk3
|   Size (Capacity Ceiling):      494384795648 B (494.4 GB)
|   Capacity In Use By Volumes:   219214536704 B (219.2 GB) (44.3% used)
|   Capacity Not Allocated:       275170258944 B (275.2 GB) (55.7% free)
|   |
|   +-&#x3C; Physical Store disk0s2 86D4B7EC-6FA5-4042-93A7-D3766A222EBE
|   |   -----------------------------------------------------------
|   |   APFS Physical Store Disk:   disk0s2
|   |   Size:                       494384795648 B (494.4 GB)
|   |
|   +-> Volume disk3s1 7A27E734-880F-4D91-A703-FB55861D49B7
|   |   ---------------------------------------------------
<strong>|   |   APFS Volume Disk (Role):   disk3s1 (System)
</strong>|   |   Name:                      Macintosh HD (Case-insensitive)
<strong>|   |   Mount Point:               /System/Volumes/Update/mnt1
</strong>|   |   Capacity Consumed:         12819210240 B (12.8 GB)
|   |   Sealed:                    Broken
|   |   FileVault:                 Yes (Unlocked)
|   |   Encrypted:                 No
|   |   |
|   |   Snapshot:                  FAA23E0C-791C-43FF-B0E7-0E1C0810AC61
|   |   Snapshot Disk:             disk3s1s1
<strong>|   |   Snapshot Mount Point:      /
</strong><strong>|   |   Snapshot Sealed:           Yes
</strong>[...]
+-> Volume disk3s5 281959B7-07A1-4940-BDDF-6419360F3327
|   ---------------------------------------------------
|   APFS Volume Disk (Role):   disk3s5 (Data)
|   Name:                      Macintosh HD - Data (Case-insensitive)
<strong>    |   Mount Point:               /System/Volumes/Data
</strong><strong>    |   Capacity Consumed:         412071784448 B (412.1 GB)
</strong>    |   Sealed:                    No
|   FileVault:                 Yes (Unlocked)
</code></pre>

рдкрд┐рдЫрд▓реЗ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдпрд╣ рджреЗрдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рд╕реБрд▓рдн рд╕реНрдерд╛рди** `/System/Volumes/Data` рдХреЗ рддрд╣рдд рдорд╛рдЙрдВрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **macOS рд╕рд┐рд╕реНрдЯрдо рд╡реЙрд▓реНрдпреВрдо рд╕реНрдиреИрдкрд╢реЙрдЯ** `/` рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдпрд╣ **рд╕реАрд▓** рд╣реИ (OS рджреНрд╡рд╛рд░рд╛ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рд░реВрдк рд╕реЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд)ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ SIP рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **OS рдЕрдм рдмреВрдЯ рдирд╣реАрдВ рд╣реЛрдЧрд╛**ред

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╕реАрд▓ рд╕рдХреНрд╖рдо рд╣реИ** рдЪрд▓рд╛рдХрд░:
```bash
csrutil authenticated-root status
Authenticated Root status: enabled
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕реНрдиреИрдкрд╢реЙрдЯ рдбрд┐рд╕реНрдХ рдХреЛ **рдХреЗрд╡рд▓-рдкрдврд╝рдиреЗ** рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдорд╛рдЙрдВрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```bash
mount
/dev/disk3s1s1 on / (apfs, sealed, local, read-only, journaled)
```
{% hint style="success" %}
рд╕реАрдЦреЗрдВ рдФрд░ AWS рд╣реИрдХрд┐рдВрдЧ рдХрд╛ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
рд╕реАрдЦреЗрдВ рдФрд░ GCP рд╣реИрдХрд┐рдВрдЧ рдХрд╛ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
</details>
