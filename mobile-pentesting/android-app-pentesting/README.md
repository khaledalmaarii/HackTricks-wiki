# Teste de Penetra√ß√£o em Aplica√ß√µes Android

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Insights de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo do hacking em ritmo acelerado atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

## Fundamentos de Aplica√ß√µes Android

√â altamente recomend√°vel come√ßar a ler esta p√°gina para conhecer as **partes mais importantes relacionadas √† seguran√ßa do Android e os componentes mais perigosos em uma aplica√ß√£o Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Esta √© a principal ferramenta que voc√™ precisa para se conectar a um dispositivo android (emulado ou f√≠sico).\
**ADB** permite controlar dispositivos tanto via **USB** quanto **Rede** a partir de um computador. Esta utilidade possibilita a **c√≥pia** de arquivos em ambas as dire√ß√µes, **instala√ß√£o** e **desinstala√ß√£o** de aplicativos, **execu√ß√£o** de comandos shell, **backup** de dados, **leitura** de logs, entre outras fun√ß√µes.

D√™ uma olhada na seguinte lista de [**Comandos ADB**](adb-commands.md) para aprender como usar o adb.

## Smali

√Äs vezes, √© interessante **modificar o c√≥digo da aplica√ß√£o** para acessar **informa√ß√µes ocultas** (talvez senhas ou flags bem ofuscadas). Ent√£o, pode ser interessante descompilar o apk, modificar o c√≥digo e recompil√°-lo.\
[**Neste tutorial** voc√™ pode **aprender como descompilar um APK, modificar o c√≥digo Smali e recompilar o APK** com a nova funcionalidade](smali-changes.md). Isso pode ser muito √∫til como uma **alternativa para v√°rios testes durante a an√°lise din√¢mica** que ser√£o apresentados. Ent√£o, **mantenha sempre em mente essa possibilidade**.

## Outros truques interessantes

* [Falsificando sua localiza√ß√£o na Play Store](spoofing-your-location-in-play-store.md)
* **Baixar APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/), [https://github.com/kiber-io/apkd](https://github.com/kiber-io/apkd)
* Extrair APK do dispositivo:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
* Mescle todos os splits e apks base com [APKEditor](https://github.com/REAndroid/APKEditor):
```bash
mkdir splits
adb shell pm path com.android.insecurebankv2 | cut -d ':' -f 1 | xargs -n1 -i adb pull {} splits
java -jar ../APKEditor.jar m -i splits/ -o merged.apk

# after merging, you will need to align and sign the apk, personally, I like to use the uberapksigner
java -jar uber-apk-signer.jar -a merged.apk --allowResign -o merged_signed
```
## An√°lise Est√°tica

Primeiramente, para analisar um APK voc√™ deve **dar uma olhada no c√≥digo Java** usando um decompilador.\
Por favor, [**leia aqui para encontrar informa√ß√µes sobre diferentes decompiladores dispon√≠veis**](apk-decompilers.md).

### Procurando informa√ß√µes interessantes

Apenas dando uma olhada nas **strings** do APK voc√™ pode procurar por **senhas**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **chaves** **api**, **criptografia**, **bluetooth uuids**, **tokens** e qualquer coisa interessante... procure at√© por **backdoors** de execu√ß√£o de c√≥digo ou backdoors de autentica√ß√£o (credenciais de admin hardcoded para o app).

**Firebase**

Preste aten√ß√£o especial √†s **URLs do firebase** e verifique se est√° mal configurado. [Mais informa√ß√µes sobre o que √© o Firebase e como explor√°-lo aqui.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Compreens√£o b√°sica da aplica√ß√£o - Manifest.xml, strings.xml

A **examina√ß√£o dos arquivos \_Manifest.xml**_\*\* e \*\*_**strings.xml**\_\*\* pode revelar potenciais vulnerabilidades de seguran√ßa\*\*. Esses arquivos podem ser acessados usando decompiladores ou renomeando a extens√£o do arquivo APK para .zip e, em seguida, descompactando-o.

**Vulnerabilidades** identificadas a partir do **Manifest.xml** incluem:

* **Aplica√ß√µes Debug√°veis**: Aplica√ß√µes configuradas como debuggable (`debuggable="true"`) no arquivo _Manifest.xml_ representam um risco, pois permitem conex√µes que podem levar √† explora√ß√£o. Para uma melhor compreens√£o sobre como explorar aplica√ß√µes debuggable, consulte um tutorial sobre como encontrar e explorar aplica√ß√µes debuggable em um dispositivo.
* **Configura√ß√µes de Backup**: O atributo `android:allowBackup="false"` deve ser explicitamente definido para aplica√ß√µes que lidam com informa√ß√µes sens√≠veis para evitar backups de dados n√£o autorizados via adb, especialmente quando a depura√ß√£o USB est√° habilitada.
* **Seguran√ßa de Rede**: Configura√ß√µes de seguran√ßa de rede personalizadas (`android:networkSecurityConfig="@xml/network_security_config"`) em _res/xml/_ podem especificar detalhes de seguran√ßa como pins de certificado e configura√ß√µes de tr√°fego HTTP. Um exemplo √© permitir tr√°fego HTTP para dom√≠nios espec√≠ficos.
* **Atividades e Servi√ßos Exportados**: Identificar atividades e servi√ßos exportados no manifesto pode destacar componentes que podem ser mal utilizados. Uma an√°lise mais aprofundada durante os testes din√¢micos pode revelar como explorar esses componentes.
* **Content Providers e FileProviders**: Content providers expostos podem permitir acesso ou modifica√ß√£o n√£o autorizada de dados. A configura√ß√£o de FileProviders tamb√©m deve ser analisada.
* **Broadcast Receivers e Esquemas de URL**: Esses componentes podem ser aproveitados para explora√ß√£o, com aten√ß√£o especial a como os esquemas de URL s√£o gerenciados para vulnerabilidades de entrada.
* **Vers√µes do SDK**: Os atributos `minSdkVersion`, `targetSDKVersion` e `maxSdkVersion` indicam as vers√µes do Android suportadas, destacando a import√¢ncia de n√£o suportar vers√µes do Android desatualizadas e vulner√°veis por raz√µes de seguran√ßa.

A partir do arquivo **strings.xml**, informa√ß√µes sens√≠veis como chaves de API, esquemas personalizados e outras notas de desenvolvedor podem ser descobertas, sublinhando a necessidade de uma revis√£o cuidadosa desses recursos.

### Tapjacking

**Tapjacking** √© um ataque onde uma **aplica√ß√£o maliciosa** √© lan√ßada e **se posiciona em cima de uma aplica√ß√£o v√≠tima**. Uma vez que obscurece visivelmente o app v√≠tima, sua interface de usu√°rio √© projetada de tal forma a enganar o usu√°rio para interagir com ela, enquanto passa a intera√ß√£o para o app v√≠tima.\
Na pr√°tica, isso **cega o usu√°rio para saber que ele est√° realmente realizando a√ß√µes no app v√≠tima**.

Encontre mais informa√ß√µes em:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Sequestro de Tarefa

Uma **atividade** com o **`launchMode`** definido como **`singleTask` sem qualquer `taskAffinity`** definido √© vulner√°vel ao sequestro de tarefa. Isso significa que uma **aplica√ß√£o** pode ser instalada e, se lan√ßada antes da aplica√ß√£o real, pode **sequestrar a tarefa da aplica√ß√£o real** (ent√£o o usu√°rio estar√° interagindo com a **aplica√ß√£o maliciosa pensando que est√° usando a real**).

Mais informa√ß√µes em:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Armazenamento de dados inseguro

**Armazenamento Interno**

No Android, arquivos **armazenados** no **armazenamento interno** s√£o **projetados** para serem **acess√≠veis** exclusivamente pelo **app** que os **criou**. Essa medida de seguran√ßa √© **imposta** pelo sistema operacional Android e geralmente √© adequada para as necessidades de seguran√ßa da maioria das aplica√ß√µes. No entanto, os desenvolvedores √†s vezes utilizam modos como `MODE_WORLD_READABLE` e `MODE_WORLD_WRITABLE` para **permitir** que arquivos sejam **compartilhados** entre diferentes aplica√ß√µes. No entanto, esses modos **n√£o restringem o acesso** a esses arquivos por outras aplica√ß√µes, incluindo aquelas potencialmente maliciosas.

1. **An√°lise Est√°tica:**
* **Assegure-se** de que o uso de `MODE_WORLD_READABLE` e `MODE_WORLD_WRITABLE` seja **cuidadosamente analisado**. Esses modos **podem potencialmente expor** arquivos a **acessos n√£o intencionais ou n√£o autorizados**.
2. **An√°lise Din√¢mica:**
* **Verifique** as **permiss√µes** definidas em arquivos criados pelo app. Especificamente, **verifique** se algum arquivo est√° **definido para ser leg√≠vel ou grav√°vel globalmente**. Isso pode representar um risco significativo √† seguran√ßa, pois permitiria que **qualquer aplica√ß√£o** instalada no dispositivo, independentemente de sua origem ou inten√ß√£o, **lesse ou modificasse** esses arquivos.

**Armazenamento Externo**

Ao lidar com arquivos no **armazenamento externo**, como Cart√µes SD, certas precau√ß√µes devem ser tomadas:

1. **Acessibilidade**:
* Arquivos no armazenamento externo s√£o **globalmente leg√≠veis e grav√°veis**. Isso significa que qualquer aplica√ß√£o ou usu√°rio pode acessar esses arquivos.
2. **Preocupa√ß√µes de Seguran√ßa**:
* Dada a facilidade de acesso, √© aconselh√°vel **n√£o armazenar informa√ß√µes sens√≠veis** no armazenamento externo.
* O armazenamento externo pode ser removido ou acessado por qualquer aplica√ß√£o, tornando-o menos seguro.
3. **Manipula√ß√£o de Dados do Armazenamento Externo**:
* Sempre **realize valida√ß√£o de entrada** nos dados recuperados do armazenamento externo. Isso √© crucial porque os dados v√™m de uma fonte n√£o confi√°vel.
* Armazenar execut√°veis ou arquivos de classe no armazenamento externo para carregamento din√¢mico √© fortemente desencorajado.
* Se sua aplica√ß√£o precisar recuperar arquivos execut√°veis do armazenamento externo, assegure-se de que esses arquivos sejam **assinados e verificados criptograficamente** antes de serem carregados dinamicamente. Essa etapa √© vital para manter a integridade de seguran√ßa da sua aplica√ß√£o.

O armazenamento externo pode ser **acessado** em `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
A partir do Android 4.4 (**API 17**), o cart√£o SD possui uma estrutura de diret√≥rio que **limita o acesso de um app √† diret√≥rio que √© especificamente para aquele app**. Isso impede que aplica√ß√µes maliciosas ganhem acesso de leitura ou grava√ß√£o aos arquivos de outro app.
{% endhint %}

**Dados sens√≠veis armazenados em texto claro**

* **Prefer√™ncias compartilhadas**: O Android permite que cada aplica√ß√£o salve facilmente arquivos xml no caminho `/data/data/<packagename>/shared_prefs/` e √†s vezes √© poss√≠vel encontrar informa√ß√µes sens√≠veis em texto claro nessa pasta.
* **Bancos de dados**: O Android permite que cada aplica√ß√£o salve facilmente bancos de dados sqlite no caminho `/data/data/<packagename>/databases/` e √†s vezes √© poss√≠vel encontrar informa√ß√µes sens√≠veis em texto claro nessa pasta.

### TLS Quebrado

**Aceitar Todos os Certificados**

Por algum motivo, √†s vezes os desenvolvedores aceitam todos os certificados, mesmo que, por exemplo, o nome do host n√£o corresponda a linhas de c√≥digo como a seguinte:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
A good way to test this is to try to capture the traffic using some proxy like Burp without authorising Burp CA inside the device. Also, you can generate with Burp a certificate for a different hostname and use it.

### Quebra de Criptografia

**Processos de Gerenciamento de Chaves Ruins**

Alguns desenvolvedores salvam dados sens√≠veis no armazenamento local e os criptografam com uma chave codificada/previs√≠vel no c√≥digo. Isso n√£o deve ser feito, pois alguma engenharia reversa pode permitir que atacantes extraiam as informa√ß√µes confidenciais.

**Uso de Algoritmos Inseguros e/ou Obsoletos**

Os desenvolvedores n√£o devem usar **algoritmos obsoletos** para realizar **verifica√ß√µes de autoriza√ß√£o**, **armazenar** ou **enviar** dados. Alguns desses algoritmos s√£o: RC4, MD4, MD5, SHA1... Se **hashes** forem usados para armazenar senhas, por exemplo, hashes resistentes a for√ßa bruta devem ser usados com sal.

### Outras verifica√ß√µes

* √â recomendado **ofuscar o APK** para dificultar o trabalho de engenharia reversa para os atacantes.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve realizar suas **pr√≥prias verifica√ß√µes para ver se o celular est√° rooteado** e agir em consequ√™ncia.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve verificar se um **emulador** est√° sendo usado.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve **verificar sua pr√≥pria integridade antes de executar** para checar se foi modificado.
* Use [**APKiD**](https://github.com/rednaga/APKiD) para verificar qual compilador/pacote/ofuscador foi usado para construir o APK

### Aplica√ß√£o React Native

Read the following page to learn how to easily access javascript code of React applications:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplica√ß√µes Xamarin

Read the following page to learn how to easily access C# code of a xamarin applications:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Aplica√ß√µes Superpacked

According to this [**blog post**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/) superpacked is a Meta algorithm that compress the content of an application into a single file. The blog talks about the possibility of creating an app that decompress these kind of apps... and a faster way which involves to **execute the application and gather the decompressed files from the filesystem.**

### An√°lise Est√°tica Automatizada de C√≥digo

The tool [**mariana-trench**](https://github.com/facebook/mariana-trench) is capable of finding **vulnerabilities** by **scanning** the **code** of the application. This tool contains a series of **known sources** (that indicates to the tool the **places** where the **input** is **controlled by the user**), **sinks** (which indicates to the tool **dangerous** **places** where malicious user input could cause damages) and **rules**. These rules indicates the **combination** of **sources-sinks** that indicates a vulnerability.

With this knowledge, **mariana-trench will review the code and find possible vulnerabilities on it**.

### Segredos vazados

An application may contain secrets (API keys, passwords, hidden urls, subdomains...) inside of it that you might be able to discover. You could us a tool such as [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Bypass de Autentica√ß√£o Biom√©trica

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Outras fun√ß√µes interessantes

* **Execu√ß√£o de c√≥digo**: `Runtime.exec(), ProcessBuilder(), native code:system()`
* **Enviar SMSs**: `sendTextMessage, sendMultipartTestMessage`
* **Fun√ß√µes nativas** declaradas como `native`: `public native, System.loadLibrary, System.load`
* [Read this to learn **how to reverse native functions**](reversing-native-libraries.md)

### **Outras dicas**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

***

## An√°lise Din√¢mica

> First of all, you need an environment where you can install the application and all the environment (Burp CA cert, Drozer and Frida mainly). Therefore, a rooted device (emulated or not) is extremely recommended.

### An√°lise din√¢mica online

You can create a **free account** in: [https://appetize.io/](https://appetize.io). This platform allows you to **upload** and **execute** APKs, so it is useful to see how an apk is behaving.

You can even **see the logs of your application** in the web and connect through **adb**.

![](<../../.gitbook/assets/image (831).png>)

Thanks to the ADB connection you can use **Drozer** and **Frida** inside the emulators.

### An√°lise din√¢mica local

#### Usando um emulador

* [**Android Studio**](https://developer.android.com/studio) (You can create **x86** and **arm** devices, and according to [**this** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**latest x86** versions **support ARM libraries** without needing an slow arm emulator).
* Learn to set it up in this page:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Vers√£o gratuita:** Edi√ß√£o Pessoal, voc√™ precisa criar uma conta. _√â recomend√°vel **baixar** a vers√£o **COM**_ _**VirtualBox** para evitar erros potenciais._)
* [**Nox**](https://es.bignox.com) (Gratuito, mas n√£o suporta Frida ou Drozer).

{% hint style="info" %}
When creating a new emulator on any platform remember that the bigger the screen is, the slower the emulator will run. So select small screens if possible.
{% endhint %}

To **install google services** (like AppStore) in Genymotion you need to click on the red marked button of the following image:

![](<../../.gitbook/assets/image (277).png>)

Also, notice that in the **configuration of the Android VM in Genymotion** you can select **Bridge Network mode** (this will be useful if you will be connecting to the Android VM from a different VM with the tools).

#### Use um dispositivo f√≠sico

You need to activate the **debugging** options and it will be cool if you can **root** it:

1. **Configura√ß√µes**.
2. (A partir do Android 8.0) Selecione **Sistema**.
3. Selecione **Sobre o telefone**.
4. Pressione **N√∫mero da vers√£o** 7 vezes.
5. Volte e voc√™ encontrar√° as **Op√ß√µes de desenvolvedor**.

> Once you have installed the application, the first thing you should do is to try it and investigate what does it do, how does it work and get comfortable with it.\
> I will suggest to **perform this initial dynamic analysis using MobSF dynamic analysis + pidcat**, so we will be able to **learn how the application works** while MobSF **captures** a lot of **interesting** **data** you can review later on.

### Vazamento de Dados N√£o Intencionais

**Registro**

Os desenvolvedores devem ter cuidado ao expor **informa√ß√µes de depura√ß√£o** publicamente, pois isso pode levar a vazamentos de dados sens√≠veis. As ferramentas [**pidcat**](https://github.com/JakeWharton/pidcat) e `adb logcat` s√£o recomendadas para monitorar os logs da aplica√ß√£o para identificar e proteger informa√ß√µes sens√≠veis. **Pidcat** √© preferido por sua facilidade de uso e legibilidade.

{% hint style="warning" %}
Note that from **later newer than Android 4.0**, **applications are only able to access their own logs**. So applications cannot access other apps logs.\
Anyway, it's still recommended to **not log sensitive information**.
{% endhint %}

**Cache de Buffer de Copiar/Colar**

O framework **baseado em clipboard** do Android permite a funcionalidade de copiar e colar em aplicativos, mas apresenta um risco, pois **outros aplicativos** podem **acessar** a √°rea de transfer√™ncia, potencialmente expondo dados sens√≠veis. √â crucial **desativar fun√ß√µes de copiar/colar** para se√ß√µes sens√≠veis de um aplicativo, como detalhes de cart√£o de cr√©dito, para evitar vazamentos de dados.

**Logs de Falhas**

Se um aplicativo **falhar** e **salvar logs**, esses logs podem ajudar atacantes, especialmente quando o aplicativo n√£o pode ser descomposto. Para mitigar esse risco, evite registrar em falhas e, se os logs precisarem ser transmitidos pela rede, certifique-se de que sejam enviados por um canal SSL para seguran√ßa.

As a pentester, **try to take a look to these logs**.

**Dados de An√°lise Enviados a Terceiros**

Os aplicativos frequentemente integram servi√ßos como Google Adsense, que podem inadvertidamente **vazar dados sens√≠veis** devido √† implementa√ß√£o inadequada pelos desenvolvedores. Para identificar poss√≠veis vazamentos de dados, √© aconselh√°vel **interceptar o tr√°fego do aplicativo** e verificar se h√° informa√ß√µes sens√≠veis sendo enviadas para servi√ßos de terceiros.

### Bancos de Dados SQLite

A maioria dos aplicativos usar√° **bancos de dados SQLite internos** para salvar informa√ß√µes. Durante o pentest, d√™ uma **olhada** nos **bancos de dados** criados, os nomes das **tabelas** e **colunas** e todos os **dados** salvos, pois voc√™ pode encontrar **informa√ß√µes sens√≠veis** (o que seria uma vulnerabilidade).\
Os bancos de dados devem estar localizados em `/data/data/the.package.name/databases` como `/data/data/com.mwr.example.sieve/databases`

Se o banco de dados estiver salvando informa√ß√µes confidenciais e estiver **criptografado**, mas voc√™ conseguir **encontrar** a **senha** dentro do aplicativo, ainda √© uma **vulnerabilidade**.

Enumere as tabelas usando `.tables` e enumere as colunas das tabelas fazendo `.schema <table_name>`

### Drozer (Exploit Activities, Content Providers and Services)

From [Drozer Docs](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** allows you to **assume the role of an Android app** and interact with other apps. It can do **anything that an installed application can do**, such as make use of Android‚Äôs Inter-Process Communication (IPC) mechanism and interact with the underlying operating system. .\
Drozer is s useful tool to **exploit exported activities, exported services and Content Providers** as you will learn in the following sections.

### Explorando Atividades Exportadas

[**Read this if you want to refresh what is an Android Activity.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Also remember that the code of an activity starts in the **`onCreate`** method.

**Bypass de Autoriza√ß√£o**

Quando uma Atividade √© exportada, voc√™ pode invocar sua tela de um aplicativo externo. Portanto, se uma atividade com **informa√ß√µes sens√≠veis** for **exportada**, voc√™ poderia **burlar** os mecanismos de **autentica√ß√£o** **para acess√°-la.**

[**Learn how to exploit exported activities with Drozer.**](drozer-tutorial/#activities)

You can also start an exported activity from adb:

* PackageName is com.example.demo
* Exported ActivityName is com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTA**: O MobSF detectar√° como malicioso o uso de _**singleTask/singleInstance**_ como `android:launchMode` em uma atividade, mas devido a [isso](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), aparentemente isso √© perigoso apenas em vers√µes antigas (vers√µes da API < 21).

{% hint style="info" %}
Observe que uma bypass de autoriza√ß√£o nem sempre √© uma vulnerabilidade, isso depender√° de como o bypass funciona e quais informa√ß√µes s√£o expostas.
{% endhint %}

**Vazamento de informa√ß√µes sens√≠veis**

**Atividades tamb√©m podem retornar resultados**. Se voc√™ conseguir encontrar uma atividade exportada e desprotegida chamando o **`setResult`** e **retornando informa√ß√µes sens√≠veis**, h√° um vazamento de informa√ß√µes sens√≠veis.

#### Tapjacking

Se o tapjacking n√£o for prevenido, voc√™ pode abusar da atividade exportada para fazer o **usu√°rio realizar a√ß√µes inesperadas**. Para mais informa√ß√µes sobre [**o que √© Tapjacking siga o link**](./#tapjacking).

### Explorando Provedores de Conte√∫do - Acessando e manipulando informa√ß√µes sens√≠veis

[**Leia isso se voc√™ quiser relembrar o que √© um Provedor de Conte√∫do.**](android-applications-basics.md#content-provider)\
Provedores de conte√∫do s√£o basicamente usados para **compartilhar dados**. Se um aplicativo tiver provedores de conte√∫do dispon√≠veis, voc√™ pode ser capaz de **extrair dados sens√≠veis** deles. Tamb√©m √© interessante testar poss√≠veis **inje√ß√µes SQL** e **Path Traversals**, pois podem ser vulner√°veis.

[**Aprenda como explorar Provedores de Conte√∫do com Drozer.**](drozer-tutorial/#content-providers)

### **Explorando Servi√ßos**

[**Leia isso se voc√™ quiser relembrar o que √© um Servi√ßo.**](android-applications-basics.md#services)\
Lembre-se de que as a√ß√µes de um Servi√ßo come√ßam no m√©todo `onStartCommand`.

Um servi√ßo √© basicamente algo que **pode receber dados**, **process√°-los** e **retornar** (ou n√£o) uma resposta. Ent√£o, se um aplicativo estiver exportando alguns servi√ßos, voc√™ deve **verificar** o **c√≥digo** para entender o que ele est√° fazendo e **test√°-lo** **dinamicamente** para extrair informa√ß√µes confidenciais, contornar medidas de autentica√ß√£o...\
[**Aprenda como explorar Servi√ßos com Drozer.**](drozer-tutorial/#services)

### **Explorando Broadcast Receivers**

[**Leia isso se voc√™ quiser relembrar o que √© um Broadcast Receiver.**](android-applications-basics.md#broadcast-receivers)\
Lembre-se de que as a√ß√µes de um Broadcast Receiver come√ßam no m√©todo `onReceive`.

Um broadcast receiver estar√° aguardando um tipo de mensagem. Dependendo de como o receptor lida com a mensagem, ele pode ser vulner√°vel.\
[**Aprenda como explorar Broadcast Receivers com Drozer.**](./#exploiting-broadcast-receivers)

### **Explorando Schemes / Deep links**

Voc√™ pode procurar por deep links manualmente, usando ferramentas como MobSF ou scripts como [este](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Voc√™ pode **abrir** um **schema** declarado usando **adb** ou um **navegador**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Observe que voc√™ pode **omitir o nome do pacote** e o celular chamar√° automaticamente o aplicativo que deve abrir esse link._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**C√≥digo executado**

Para encontrar o **c√≥digo que ser√° executado no App**, v√° para a atividade chamada pelo deeplink e procure a fun√ß√£o **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informa√ß√µes sens√≠veis**

Toda vez que voc√™ encontrar um deep link, verifique se **n√£o est√° recebendo dados sens√≠veis (como senhas) via par√¢metros de URL**, porque qualquer outro aplicativo poderia **impersonar o deep link e roubar esses dados!**

**Par√¢metros no caminho**

Voc√™ **tamb√©m deve verificar se algum deep link est√° usando um par√¢metro dentro do caminho** da URL como: `https://api.example.com/v1/users/{username}`, nesse caso voc√™ pode for√ßar uma travessia de caminho acessando algo como: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Note que se voc√™ encontrar os endpoints corretos dentro da aplica√ß√£o, pode ser capaz de causar um **Open Redirect** (se parte do caminho for usada como nome de dom√≠nio), **assumir a conta** (se voc√™ puder modificar os detalhes dos usu√°rios sem o token CSRF e o endpoint vulner√°vel usar o m√©todo correto) e qualquer outra vulnerabilidade. Mais [informa√ß√µes sobre isso aqui](http://dphoeniixx.com/2020/12/13-2/).

**Mais exemplos**

Um [relat√≥rio de bug bounty interessante](https://hackerone.com/reports/855618) sobre links (_/.well-known/assetlinks.json_).

### Falhas de Inspe√ß√£o e Verifica√ß√£o da Camada de Transporte

* **Os certificados nem sempre s√£o inspecionados corretamente** por aplicativos Android. √â comum que esses aplicativos ignorem avisos e aceitem certificados autoassinados ou, em alguns casos, revertam para o uso de conex√µes HTTP.
* **As negocia√ß√µes durante o handshake SSL/TLS √†s vezes s√£o fracas**, empregando su√≠tes de cifra inseguras. Essa vulnerabilidade torna a conex√£o suscet√≠vel a ataques man-in-the-middle (MITM), permitindo que atacantes decifrem os dados.
* **Vazamento de informa√ß√µes privadas** √© um risco quando aplicativos se autenticam usando canais seguros, mas depois se comunicam por canais n√£o seguros para outras transa√ß√µes. Essa abordagem n√£o protege dados sens√≠veis, como cookies de sess√£o ou detalhes do usu√°rio, de intercepta√ß√£o por entidades maliciosas.

#### Verifica√ß√£o de Certificado

Focaremos na **verifica√ß√£o de certificado**. A integridade do certificado do servidor deve ser verificada para aumentar a seguran√ßa. Isso √© crucial porque configura√ß√µes TLS inseguras e a transmiss√£o de dados sens√≠veis por canais n√£o criptografados podem representar riscos significativos. Para etapas detalhadas sobre como verificar certificados de servidor e abordar vulnerabilidades, [**este recurso**](https://manifestsecurity.com/android-application-security-part-10/) fornece orienta√ß√µes abrangentes.

#### SSL Pinning

SSL Pinning √© uma medida de seguran√ßa onde o aplicativo verifica o certificado do servidor contra uma c√≥pia conhecida armazenada dentro do pr√≥prio aplicativo. Esse m√©todo √© essencial para prevenir ataques MITM. Implementar SSL Pinning √© fortemente recomendado para aplicativos que lidam com informa√ß√µes sens√≠veis.

#### Inspe√ß√£o de Tr√°fego

Para inspecionar o tr√°fego HTTP, √© necess√°rio **instalar o certificado da ferramenta de proxy** (por exemplo, Burp). Sem instalar esse certificado, o tr√°fego criptografado pode n√£o ser vis√≠vel atrav√©s do proxy. Para um guia sobre como instalar um certificado CA personalizado, [**clique aqui**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine).

Aplicativos que visam **API Level 24 e acima** requerem modifica√ß√µes na Configura√ß√£o de Seguran√ßa da Rede para aceitar o certificado CA do proxy. Este passo √© cr√≠tico para inspecionar tr√°fego criptografado. Para instru√ß√µes sobre como modificar a Configura√ß√£o de Seguran√ßa da Rede, [**consulte este tutorial**](make-apk-accept-ca-certificate.md).

#### Contornando SSL Pinning

Quando o SSL Pinning √© implementado, contorn√°-lo se torna necess√°rio para inspecionar o tr√°fego HTTPS. V√°rios m√©todos est√£o dispon√≠veis para esse prop√≥sito:

* Modifique automaticamente o **apk** para **contornar** SSLPinning com [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). O melhor ponto positivo dessa op√ß√£o √© que voc√™ n√£o precisar√° de root para contornar o SSL Pinning, mas precisar√° excluir o aplicativo e reinstalar o novo, e isso nem sempre funcionar√°.
* Voc√™ pode usar **Frida** (discutido abaixo) para contornar essa prote√ß√£o. Aqui est√° um guia para usar Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Voc√™ tamb√©m pode tentar **contornar automaticamente o SSL Pinning** usando [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Voc√™ tamb√©m pode tentar **contornar automaticamente o SSL Pinning** usando **an√°lise din√¢mica do MobSF** (explicado abaixo)
* Se voc√™ ainda acha que h√° algum tr√°fego que n√£o est√° capturando, pode tentar **encaminhar o tr√°fego para o burp usando iptables**. Leia este blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### Procurando Vulnerabilidades Comuns na Web

√â importante tamb√©m procurar vulnerabilidades comuns na web dentro do aplicativo. Informa√ß√µes detalhadas sobre como identificar e mitigar essas vulnerabilidades est√£o al√©m do escopo deste resumo, mas s√£o amplamente cobertas em outros lugares.

### Frida

[Frida](https://www.frida.re) √© uma ferramenta de instrumenta√ß√£o din√¢mica para desenvolvedores, engenheiros reversos e pesquisadores de seguran√ßa.\
**Voc√™ pode acessar aplicativos em execu√ß√£o e conectar m√©todos em tempo de execu√ß√£o para mudar o comportamento, alterar valores, extrair valores, executar c√≥digos diferentes...**\
Se voc√™ deseja fazer pentesting em aplicativos Android, precisa saber como usar o Frida.

* Aprenda a usar o Frida: [**Tutorial Frida**](frida-tutorial/)
* Algumas "GUI" para a√ß√µes com Frida: [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection √© √≥timo para automatizar o uso do Frida: [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* Voc√™ pode encontrar alguns scripts Frida incr√≠veis aqui: [**https://codeshare.frida.re/**](https://codeshare.frida.re)
* Tente contornar mecanismos de anti-debugging / anti-frida carregando o Frida como indicado em [https://erfur.github.io/blog/dev/code-injection-without-ptrace](https://erfur.github.io/blog/dev/code-injection-without-ptrace) (ferramenta [linjector](https://github.com/erfur/linjector-rs))

### **Dump de Mem√≥ria - Fridump**

Verifique se o aplicativo est√° armazenando informa√ß√µes sens√≠veis na mem√≥ria que n√£o deveria estar armazenando, como senhas ou mnem√¥nicos.

Usando [**Fridump3**](https://github.com/rootbsd/fridump3), voc√™ pode despejar a mem√≥ria do aplicativo com:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Isso ir√° despejar a mem√≥ria na pasta ./dump, e l√° voc√™ pode usar grep com algo como: 

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Dados sens√≠veis no Keystore**

No Android, o Keystore √© o melhor lugar para armazenar dados sens√≠veis, no entanto, com privil√©gios suficientes, ainda √© **poss√≠vel acess√°-lo**. Como as aplica√ß√µes tendem a armazenar aqui **dados sens√≠veis em texto claro**, os pentests devem verificar isso como usu√°rio root ou algu√©m com acesso f√≠sico ao dispositivo poderia ser capaz de roubar esses dados.

Mesmo que um aplicativo armazene dados no keystore, os dados devem ser criptografados.

Para acessar os dados dentro do keystore, voc√™ pode usar este script Frida: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Bypass de Impress√£o Digital/Biom√©tricos**

Usando o seguinte script Frida, pode ser poss√≠vel **bypassar a autentica√ß√£o por impress√£o digital** que aplicativos Android podem estar realizando para **proteger certas √°reas sens√≠veis:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Imagens de Fundo**

Quando voc√™ coloca um aplicativo em segundo plano, o Android armazena um **instant√¢neo do aplicativo** para que, quando ele for recuperado para o primeiro plano, comece a carregar a imagem antes do aplicativo, fazendo parecer que o aplicativo foi carregado mais r√°pido.

No entanto, se esse instant√¢neo contiver **informa√ß√µes sens√≠veis**, algu√©m com acesso ao instant√¢neo pode **roubar essas informa√ß√µes** (note que voc√™ precisa de root para acess√°-lo).

Os instant√¢neos geralmente s√£o armazenados em: **`/data/system_ce/0/snapshots`**

O Android fornece uma maneira de **prevenir a captura de tela definindo o par√¢metro de layout FLAG\_SECURE**. Ao usar essa flag, o conte√∫do da janela √© tratado como seguro, impedindo que apare√ßa em capturas de tela ou seja visualizado em displays n√£o seguros.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analisador de Aplica√ß√µes Android**

Esta ferramenta pode ajudar voc√™ a gerenciar diferentes ferramentas durante a an√°lise din√¢mica: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Inje√ß√£o de Intent

Os desenvolvedores frequentemente criam componentes proxy como atividades, servi√ßos e receptores de broadcast que manipulam esses Intents e os passam para m√©todos como `startActivity(...)` ou `sendBroadcast(...)`, o que pode ser arriscado.

O perigo reside em permitir que atacantes acionem componentes de aplicativo n√£o exportados ou acessem provedores de conte√∫do sens√≠veis ao redirecionar esses Intents. Um exemplo not√°vel √© o componente `WebView` convertendo URLs em objetos `Intent` via `Intent.parseUri(...)` e, em seguida, executando-os, potencialmente levando a inje√ß√µes de Intent maliciosas.

### Principais Conclus√µes

* **Inje√ß√£o de Intent** √© semelhante ao problema de Redirecionamento Aberto da web.
* Explora√ß√µes envolvem passar objetos `Intent` como extras, que podem ser redirecionados para executar opera√ß√µes inseguras.
* Pode expor componentes n√£o exportados e provedores de conte√∫do a atacantes.
* A convers√£o de URL para `Intent` do `WebView` pode facilitar a√ß√µes n√£o intencionais.

### Inje√ß√µes do Lado do Cliente Android e outros

Provavelmente voc√™ conhece esse tipo de vulnerabilidades da Web. Voc√™ deve ter cuidado especial com essas vulnerabilidades em uma aplica√ß√£o Android:

* **Inje√ß√£o SQL:** Ao lidar com consultas din√¢micas ou Content-Providers, certifique-se de usar consultas parametrizadas.
* **Inje√ß√£o de JavaScript (XSS):** Verifique se o suporte a JavaScript e Plugins est√° desativado para quaisquer WebViews (desativado por padr√£o). [Mais informa√ß√µes aqui](webview-attacks.md#javascript-enabled).
* **Inclus√£o de Arquivo Local:** WebViews devem ter acesso ao sistema de arquivos desativado (ativado por padr√£o) - `(webview.getSettings().setAllowFileAccess(false);)`. [Mais informa√ß√µes aqui](webview-attacks.md#javascript-enabled).
* **Cookies Eternos**: Em v√°rios casos, quando a aplica√ß√£o android finaliza a sess√£o, o cookie n√£o √© revogado ou pode at√© ser salvo no disco.
* [**Secure Flag** em cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Insights de Hacking**\
Engaje-se com conte√∫do que mergulha na emo√ß√£o e nos desafios do hacking.

**Not√≠cias de Hack em Tempo Real**\
Mantenha-se atualizado com o mundo do hacking em ritmo acelerado atrav√©s de not√≠cias e insights em tempo real.

**√öltimos An√∫ncios**\
Fique informado sobre os novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais da plataforma.

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

## An√°lise Autom√°tica

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**An√°lise est√°tica**

![](<../../.gitbook/assets/image (866).png>)

**Avalia√ß√£o de vulnerabilidade da aplica√ß√£o** usando uma interface web agrad√°vel. Voc√™ tamb√©m pode realizar an√°lise din√¢mica (mas precisa preparar o ambiente).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Notice que o MobSF pode analisar **Android**(apk)**, IOS**(ipa) **e Windows**(apx) aplica√ß√µes (_As aplica√ß√µes do Windows devem ser analisadas a partir de um MobSF instalado em um host Windows_).\
Al√©m disso, se voc√™ criar um **ZIP** com o c√≥digo-fonte de um aplicativo **Android** ou **IOS** (v√° para a pasta raiz do aplicativo, selecione tudo e crie um arquivo ZIP), ele tamb√©m poder√° analis√°-lo.

O MobSF tamb√©m permite que voc√™ **diff/Compare** an√°lises e integre **VirusTotal** (voc√™ precisar√° definir sua chave de API em _MobSF/settings.py_ e habilit√°-la: `VT_ENABLED = TRUE` `VT_API_KEY = <Sua chave de API>` `VT_UPLOAD = TRUE`). Voc√™ tamb√©m pode definir `VT_UPLOAD` como `False`, ent√£o o **hash** ser√° **upload** em vez do arquivo.

### An√°lise Din√¢mica Assistida com MobSF

**MobSF** tamb√©m pode ser muito √∫til para **an√°lise din√¢mica** em **Android**, mas nesse caso voc√™ precisar√° instalar o MobSF e **genymotion** em seu host (uma VM ou Docker n√£o funcionar√°). _Nota: Voc√™ precisa **iniciar primeiro uma VM no genymotion** e **depois o MobSF.**_\
O **analisador din√¢mico do MobSF** pode:

* **Dump de dados da aplica√ß√£o** (URLs, logs, √°rea de transfer√™ncia, capturas de tela feitas por voc√™, capturas de tela feitas por "**Exported Activity Tester**", e-mails, bancos de dados SQLite, arquivos XML e outros arquivos criados). Tudo isso √© feito automaticamente, exceto pelas capturas de tela, voc√™ precisa pressionar quando quiser uma captura de tela ou precisa pressionar "**Exported Activity Tester**" para obter capturas de tela de todas as atividades exportadas.
* Capturar **tr√°fego HTTPS**
* Usar **Frida** para obter **informa√ß√µes em tempo de execu√ß√£o**

A partir das vers√µes **Android > 5**, ele **iniciar√° automaticamente o Frida** e definir√° configura√ß√µes de **proxy** globais para **capturar** tr√°fego. Ele capturar√° apenas o tr√°fego do aplicativo testado.

**Frida**

Por padr√£o, ele tamb√©m usar√° alguns Scripts Frida para **burlar SSL pinning**, **detec√ß√£o de root** e **detec√ß√£o de depurador** e para **monitorar APIs interessantes**.\
O MobSF tamb√©m pode **invocar atividades exportadas**, capturar **capturas de tela** delas e **salv√°-las** para o relat√≥rio.

Para **iniciar** o teste din√¢mico, pressione o bot√£o verde: "**Start Instrumentation**". Pressione "**Frida Live Logs**" para ver os logs gerados pelos scripts Frida e "**Live API Monitor**" para ver todas as invoca√ß√µes para m√©todos hookeados, argumentos passados e valores retornados (isso aparecer√° ap√≥s pressionar "Start Instrumentation").\
O MobSF tamb√©m permite que voc√™ carregue seus pr√≥prios **scripts Frida** (para enviar os resultados dos seus scripts Frida para o MobSF, use a fun√ß√£o `send()`). Ele tamb√©m possui **v√°rios scripts pr√©-escritos** que voc√™ pode carregar (voc√™ pode adicionar mais em `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), basta **selecion√°-los**, pressionar "**Load**" e pressionar "**Start Instrumentation**" (voc√™ poder√° ver os logs desses scripts dentro de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (419).png>)

Al√©m disso, voc√™ tem algumas funcionalidades auxiliares do Frida:

* **Enumerar Classes Carregadas**: Ele imprimir√° todas as classes carregadas
* **Capturar Strings**: Ele imprimir√° todas as strings capturadas enquanto usa o aplicativo (muito barulhento)
* **Capturar Compara√ß√µes de Strings**: Pode ser muito √∫til. Ele **mostrar√° as 2 strings sendo comparadas** e se o resultado foi Verdadeiro ou Falso.
* **Enumerar M√©todos de Classe**: Coloque o nome da classe (como "java.io.File") e ele imprimir√° todos os m√©todos da classe.
* **Pesquisar Padr√£o de Classe**: Pesquisar classes por padr√£o
* **Rastrear M√©todos de Classe**: **Rastrear** uma **classe inteira** (ver entradas e sa√≠das de todos os m√©todos da classe). Lembre-se de que, por padr√£o, o MobSF rastreia v√°rios m√©todos interessantes da API do Android.

Uma vez que voc√™ tenha selecionado o m√≥dulo auxiliar que deseja usar, voc√™ precisa pressionar "**Start Intrumentation**" e ver√° todas as sa√≠das em "**Frida Live Logs**".

**Shell**

O MobSF tamb√©m traz um shell com alguns comandos **adb**, comandos **MobSF** e comandos comuns de **shell** na parte inferior da p√°gina de an√°lise din√¢mica. Alguns comandos interessantes:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Ferramentas HTTP**

Quando o tr√°fego http √© capturado, voc√™ pode ver uma vis√£o feia do tr√°fego capturado no "**Tr√°fego HTTP(S)**" na parte inferior ou uma vis√£o mais agrad√°vel no bot√£o verde "**Iniciar HTTPTools**". A partir da segunda op√ß√£o, voc√™ pode **enviar** as **requisi√ß√µes capturadas** para **proxies** como Burp ou Owasp ZAP.\
Para fazer isso, _ligue o Burp -->_ _desative o Intercept --> no MobSB HTTPTools selecione a requisi√ß√£o_ --> pressione "**Enviar para Fuzzer**" --> _selecione o endere√ßo do proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Uma vez que voc√™ termine a an√°lise din√¢mica com MobSF, voc√™ pode pressionar em "**Iniciar Web API Fuzzer**" para **fuzz http requests** e procurar por vulnerabilidades.

{% hint style="info" %}
Ap√≥s realizar uma an√°lise din√¢mica com MobSF, as configura√ß√µes do proxy podem estar mal configuradas e voc√™ n√£o conseguir√° corrigi-las pela GUI. Voc√™ pode corrigir as configura√ß√µes do proxy fazendo:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### An√°lise Din√¢mica Assistida com Inspeckage

Voc√™ pode obter a ferramenta em [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Esta ferramenta usar√° alguns **Hooks** para te informar **o que est√° acontecendo na aplica√ß√£o** enquanto voc√™ realiza uma **an√°lise din√¢mica**.

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Esta √© uma **√≥tima ferramenta para realizar an√°lise est√°tica com uma GUI**

![](<../../.gitbook/assets/image (741).png>)

### [Qark](https://github.com/linkedin/qark)

Esta ferramenta √© projetada para procurar v√°rias **vulnerabilidades relacionadas √† seguran√ßa em aplica√ß√µes Android**, seja no **c√≥digo-fonte** ou em **APKs empacotados**. A ferramenta tamb√©m √© **capaz de criar um APK "Proof-of-Concept" implant√°vel** e **comandos ADB**, para explorar algumas das vulnerabilidades encontradas (Atividades expostas, intents, tapjacking...). Assim como com o Drozer, n√£o h√° necessidade de rootear o dispositivo de teste.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Exibe todos os arquivos extra√≠dos para f√°cil refer√™ncia
* Descompila automaticamente arquivos APK para os formatos Java e Smali
* Analisa AndroidManifest.xml em busca de vulnerabilidades e comportamentos comuns
* An√°lise est√°tica de c√≥digo-fonte para vulnerabilidades e comportamentos comuns
* Informa√ß√µes do dispositivo
* e mais
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER √© um aplicativo de linha de comando que pode ser usado no Windows, MacOS X e Linux, que analisa arquivos _.apk_ em busca de vulnerabilidades. Ele faz isso descompactando APKs e aplicando uma s√©rie de regras para detectar essas vulnerabilidades.

Todas as regras est√£o centradas em um arquivo `rules.json`, e cada empresa ou testador pode criar suas pr√≥prias regras para analisar o que precisam.

Baixe os bin√°rios mais recentes na [p√°gina de download](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (297).png>)

StaCoAn √© uma ferramenta **multiplataforma** que ajuda desenvolvedores, ca√ßadores de bugs e hackers √©ticos a realizar [an√°lise de c√≥digo est√°tico](https://en.wikipedia.org/wiki/Static\_program\_analysis) em aplicativos m√≥veis.

O conceito √© que voc√™ arraste e solte seu arquivo de aplicativo m√≥vel (um arquivo .apk ou .ipa) na aplica√ß√£o StaCoAn e ela gerar√° um relat√≥rio visual e port√°til para voc√™. Voc√™ pode ajustar as configura√ß√µes e listas de palavras para obter uma experi√™ncia personalizada.

Baixe[ a vers√£o mais recente](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework √© um sistema de an√°lise de vulnerabilidades Android que ajuda desenvolvedores ou hackers a encontrar potenciais vulnerabilidades de seguran√ßa em aplica√ß√µes Android.\
[Windows releases](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** √© uma ferramenta cujo principal objetivo √© detectar e alertar o usu√°rio sobre comportamentos potencialmente maliciosos desenvolvidos por um aplicativo Android.

A detec√ß√£o √© realizada com a **an√°lise est√°tica** do bytecode Dalvik do aplicativo, representado como **Smali**, com a biblioteca [`androguard`](https://github.com/androguard/androguard).

Esta ferramenta procura por **comportamentos comuns de aplicativos "ruins"** como: exfiltra√ß√£o de identificadores de telefonia, intercepta√ß√£o de fluxo de √°udio/v√≠deo, modifica√ß√£o de dados PIM, execu√ß√£o de c√≥digo arbitr√°rio...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA\_Framework)

![](<../../.gitbook/assets/image (595).png>)

**MARA** √© um **M**obile **A**pplication **R**everse engineering e **A**nalysis Framework. √â uma ferramenta que re√∫ne ferramentas comumente usadas para engenharia reversa e an√°lise de aplicativos m√≥veis, para auxiliar na testagem de aplicativos m√≥veis contra as amea√ßas de seguran√ßa m√≥vel da OWASP. Seu objetivo √© tornar essa tarefa mais f√°cil e amig√°vel para desenvolvedores de aplicativos m√≥veis e profissionais de seguran√ßa.

√â capaz de:

* Extrair c√≥digo Java e Smali usando diferentes ferramentas
* Analisar APKs usando: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs\_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extrair informa√ß√µes privadas do APK usando regexps.
* Analisar o Manifest.
* Analisar dom√≠nios encontrados usando: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) e [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Deofuscar APK via [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

√ötil para detectar malware: [https://koodous.com/](https://koodous.com)

## Obfuscating/Deobfuscating code

Observe que dependendo do servi√ßo e configura√ß√£o que voc√™ usa para ofuscar o c√≥digo. Segredos podem ou n√£o acabar ofuscados.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

Do [Wikipedia](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** √© uma ferramenta de linha de comando de c√≥digo aberto que reduz, otimiza e ofusca c√≥digo Java. √â capaz de otimizar bytecode, bem como detectar e remover instru√ß√µes n√£o utilizadas. ProGuard √© software livre e √© distribu√≠do sob a Licen√ßa P√∫blica Geral GNU, vers√£o 2.

ProGuard √© distribu√≠do como parte do SDK do Android e √© executado ao construir o aplicativo em modo de lan√ßamento.

### [DexGuard](https://www.guardsquare.com/dexguard)

Encontre um guia passo a passo para deofuscar o apk em [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Daquele guia) Na √∫ltima vez que verificamos, o modo de opera√ß√£o do Dexguard era:

* carregar um recurso como um InputStream;
* alimentar o resultado a uma classe que herda de FilterInputStream para descriptograf√°-lo;
* fazer alguma ofusca√ß√£o in√∫til para desperdi√ßar alguns minutos do tempo de um reversor;
* alimentar o resultado descriptografado a um ZipInputStream para obter um arquivo DEX;
* finalmente carregar o DEX resultante como um Recurso usando o m√©todo `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard reverte o processo de ofusca√ß√£o realizado por ferramentas de ofusca√ß√£o do Android. Isso permite in√∫meras an√°lises de seguran√ßa, incluindo inspe√ß√£o de c√≥digo e previs√£o de bibliotecas.**

Voc√™ pode enviar um APK ofuscado para a plataforma deles.

### [Simplify](https://github.com/CalebFenton/simplify)

√â um **deofuscador android gen√©rico.** Simplify **executa virtualmente um aplicativo** para entender seu comportamento e ent√£o **tenta otimizar o c√≥digo** para que se comporte de forma id√™ntica, mas seja mais f√°cil para um humano entender. Cada tipo de otimiza√ß√£o √© simples e gen√©rico, ent√£o n√£o importa qual o tipo espec√≠fico de ofusca√ß√£o utilizado.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD fornece informa√ß√µes sobre **como um APK foi feito**. Ele identifica muitos **compiladores**, **empacotadores**, **ofuscadores** e outras coisas estranhas. √â o [_PEiD_](https://www.aldeid.com/wiki/PEiD) para Android.

### Manual

[Leia este tutorial para aprender alguns truques sobre **como reverter ofusca√ß√£o personalizada**](manual-deobfuscation.md)

## Labs

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b √© uma m√°quina virtual de seguran√ßa Android baseada em ubuntu-mate que inclui a cole√ß√£o dos √∫ltimos frameworks, tutoriais e laborat√≥rios de diferentes especialistas em seguran√ßa e pesquisadores para engenharia reversa e an√°lise de malware.

## References

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) √â uma √≥tima lista de recursos
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Curso r√°pido de Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Yet to try

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Hacking Insights**\
Engaje-se com conte√∫do que mergulha na emo√ß√£o e nos desafios da hacking

**Real-Time Hack News**\
Mantenha-se atualizado com o mundo acelerado da hacking atrav√©s de not√≠cias e insights em tempo real

**Latest Announcements**\
Fique informado sobre os novos bugs bounties lan√ßando e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
