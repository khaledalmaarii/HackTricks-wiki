# Android Aplikacije Pentesting

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Hakerski uvidi**\
UkljuÄite se u sadrÅ¾aj koji istraÅ¾uje uzbuÄ‘enje i izazove hakovanja

**Hakerske vesti u realnom vremenu**\
Budite u toku sa brzim svetom hakovanja kroz vesti i uvide u realnom vremenu

**Najnovije objave**\
Ostanite informisani o najnovijim pokretanjima nagrada za pronalaÅ¾enje bagova i vaÅ¾nim aÅ¾uriranjima platforme

**PridruÅ¾ite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poÄnite da saraÄ‘ujete sa vrhunskim hakerima danas!

## Osnove Android Aplikacija

Visoko se preporuÄuje da poÄnete Äitati ovu stranicu kako biste saznali o **najvaÅ¾nijim delovima vezanim za Android bezbednost i najopasnijim komponentama u Android aplikaciji**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Ovo je glavni alat koji vam je potreban za povezivanje sa Android ureÄ‘ajem (emuliranim ili fiziÄkim).\
**ADB** omoguÄ‡ava kontrolu ureÄ‘aja preko **USB-a** ili **MreÅ¾e** sa raÄunara. Ova alatka omoguÄ‡ava **kopiranje** fajlova u oba smera, **instalaciju** i **deinstalaciju** aplikacija, **izvrÅ¡avanje** shell komandi, **bekapovanje** podataka, **Äitanje** logova, meÄ‘u ostalim funkcijama.

Pogledajte sledeÄ‡u listu [**ADB Komandi**](adb-commands.md) kako biste nauÄili kako koristiti adb.

## Smali

Ponekad je interesantno **izmeniti kod aplikacije** kako biste pristupili **skrivenim informacijama** (moÅ¾da dobro obfuskirane lozinke ili zastavice). Zatim, moÅ¾e biti interesantno dekompajlirati apk, izmeniti kod i rekompajlirati ga.\
[**U ovom tutorijalu** moÅ¾ete **nauÄiti kako dekompajlirati APK, izmeniti Smali kod i rekompajlirati APK** sa novom funkcionalnoÅ¡Ä‡u](smali-changes.md). Ovo moÅ¾e biti veoma korisno kao **alternativa za nekoliko testova tokom dinamiÄke analize** koji Ä‡e biti predstavljeni. Zatim, **uvek imajte na umu ovu moguÄ‡nost**.

## Ostali interesantni trikovi

* [LaÅ¾iranje vaÅ¡e lokacije u Play Store-u](spoofing-your-location-in-play-store.md)
* **Preuzmite APK-ove**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Izvucite APK sa ureÄ‘aja:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## StatiÄka analiza

Prvo, za analizu APK datoteke trebali biste **pogledati Java kod** koristeÄ‡i dekompajler.\
Molimo, [**proÄitajte ovdje kako biste pronaÅ¡li informacije o dostupnim dekompajlerima**](apk-decompilers.md).

### TraÅ¾enje zanimljivih informacija

Samo pogledom na **stringove** APK datoteke moÅ¾ete traÅ¾iti **lozinke**, **URL-ove** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **API** kljuÄeve, **enkripciju**, **Bluetooth UUID-ove**, **tokene** i bilo Å¡to zanimljivo... Äak traÅ¾ite i **straÅ¾nje ulazne vrata** za izvrÅ¡avanje koda ili straÅ¾nje ulazne vrata za autentifikaciju (unaprijed zadane administratorske vjerodajnice za aplikaciju).

**Firebase**

Posebno obratite paÅ¾nju na **Firebase URL-ove** i provjerite je li loÅ¡e konfiguriran. [ViÅ¡e informacija o tome Å¡to je Firebase i kako ga iskoristiti ovdje.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Osnovno razumijevanje aplikacije - Manifest.xml, strings.xml

**Pregled _Manifest.xml_ i _strings.xml_ datoteka aplikacije moÅ¾e otkriti potencijalne sigurnosne ranjivosti**. Do ovih datoteka moÅ¾e se pristupiti pomoÄ‡u dekompajlera ili preimenovanjem ekstenzije APK datoteke u .zip i zatim raspakiranjem.

**Ranjivosti** identificirane iz **Manifest.xml** ukljuÄuju:

* **Aplikacije u debug naÄinu**: Aplikacije postavljene kao debuggable (`debuggable="true"`) u _Manifest.xml_ datoteci predstavljaju rizik jer omoguÄ‡uju veze koje mogu dovesti do iskoriÅ¡tavanja. Za daljnje razumijevanje kako iskoristiti aplikacije u debug naÄinu, pogledajte vodiÄ o pronalaÅ¾enju i iskoriÅ¡tavanju aplikacija u debug naÄinu na ureÄ‘aju.

* **Postavke sigurnosne kopije**: Atribut `android:allowBackup="false"` treba biti eksplicitno postavljen za aplikacije koje se bave osjetljivim informacijama kako bi se sprijeÄilo neovlaÅ¡teno sigurnosno kopiranje podataka putem adb-a, posebno kada je omoguÄ‡eno USB ispravljanje pogreÅ¡aka.

* **Sigurnost mreÅ¾e**: PrilagoÄ‘ene konfiguracije sigurnosti mreÅ¾e (`android:networkSecurityConfig="@xml/network_security_config"`) u _res/xml/_ mogu specificirati sigurnosne pojedinosti poput certifikatnih pinova i postavki HTTP prometa. Primjer je dopuÅ¡tanje HTTP prometa za odreÄ‘ene domene.

* **IzloÅ¾ene aktivnosti i usluge**: Identifikacija izloÅ¾enih aktivnosti i usluga u manifestu moÅ¾e ukazivati na komponente koje mogu biti zloupotrijebljene. Daljnja analiza tijekom dinamiÄkog testiranja moÅ¾e otkriti kako iskoristiti ove komponente.

* **Provajderi sadrÅ¾aja i FileProvideri**: IzloÅ¾eni provajderi sadrÅ¾aja mogu omoguÄ‡iti neovlaÅ¡ten pristup ili izmjenu podataka. TakoÄ‘er treba provjeriti konfiguraciju FileProvidera.

* **Broadcast prijemnici i URL sheme**: Ove komponente mogu se iskoristiti za iskoriÅ¡tavanje, posebno obratite paÅ¾nju na upravljanje URL shemama za ranjivosti unosa.

* **SDK verzije**: Atributi `minSdkVersion`, `targetSDKVersion` i `maxSdkVersion` ukazuju na podrÅ¾ane verzije Androida, naglaÅ¡avajuÄ‡i vaÅ¾nost ne podrÅ¾avanja zastarjelih, ranjivih verzija Androida iz sigurnosnih razloga.

Iz **strings.xml** datoteke mogu se otkriti osjetljive informacije poput API kljuÄeva, prilagoÄ‘enih shema i drugih biljeÅ¡ki razvijatelja, Å¡to naglaÅ¡ava potrebu za paÅ¾ljivim pregledom ovih resursa.


### Tapjacking

**Tapjacking** je napad u kojem se **zlonamjerna aplikacija** pokreÄ‡e i **pozicionira iznad aplikacije Å¾rtve**. Kada vidljivo prekrije aplikaciju Å¾rtve, njen korisniÄki suÄelje je dizajnirano na naÄin da prevari korisnika da s njom interagira, dok prenosi interakciju na aplikaciju Å¾rtve.\
U suÅ¡tini, **zaslijepljuje korisnika da zna da zapravo izvrÅ¡ava radnje na aplikaciji Å¾rtve**.

PronaÄ‘ite viÅ¡e informacija u:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Preuzimanje zadatka

Aktivnost s postavljenim **`launchMode`** na **`singleTask` bez definirane `taskAffinity`** ranjiva je na preuzimanje zadatka. To znaÄi da se **aplikacija** moÅ¾e instalirati i ako se pokrene prije prave aplikacije, moÅ¾e **preuzeti zadatak prave aplikacije** (tako da Ä‡e korisnik interagirati s **zlonamjernom aplikacijom misleÄ‡i da koristi pravu**).

ViÅ¡e informacija u:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Nesigurno pohranjivanje podataka

**Interna pohrana**

U Androidu, datoteke **pohranjene** u **internoj pohrani** dizajnirane su da budu **dostupne** iskljuÄivo od strane **aplikacije koja ih je stvorila**. Ova sigurnosna mjera provodi se putem Android operativnog sustava i opÄ‡enito je dovoljna za sigurnosne potrebe veÄ‡ine aplikacija. MeÄ‘utim, razvijatelji ponekad koriste naÄine poput `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE` kako bi **omoguÄ‡ili** dijeljenje datoteka izmeÄ‘u razliÄitih aplikacija. Ipak, ovi naÄini **ne ograniÄavaju pristup** tim datotekama drugim aplikacijama, ukljuÄujuÄ‡i potencijalno zlonamjerne.

1. **StatiÄka analiza:**
- **Provjerite** je li upotreba `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE` **paÅ¾ljivo pregledana**. Ovi naÄini **mogu potencijalno izloÅ¾iti** datoteke **neÅ¾eljenom ili neovlaÅ¡tenom pristupu**.

2. **DinamiÄka analiza:**
- **Provjerite** dozvole postavljene na datoteke koje je aplikacija stvorila. Posebno **provjerite** jesu li neke datoteke **postavljene da budu Äitljive ili pisive svugdje**. To moÅ¾e predstavljati znaÄajan sigurnosni rizik jer bi to omoguÄ‡ilo **bilo kojoj aplikaciji** instaliranoj na ureÄ‘aju, bez obzira na njezinu svrhu ili podrijetlo, da **Äita ili mijenja** te datoteke.

**Vanjska pohrana**

Kada se radi s datotekama na **vanjskoj pohrani**, poput SD kartica, treba poduzeti odreÄ‘ene mjere opreza:

1. **Dostupnost**:
- Datoteke na vanjskoj pohrani su **globalno Äitljive i pisive**. To znaÄi da bilo koja aplikacija ili korisnik moÅ¾e pristupiti tim datotekama.

2. **Sigurnosne brige**:
- S obzirom na jednostavan pristup, savjetuje se **ne pohranjivati osjetljive informacije** na vanjsku pohranu.
- Vanjska pohrana moÅ¾e se ukloniti ili pristupiti bilo kojoj aplikaciji, Å¡to je manje sigurno.

3. **Obrada podataka s vanjske pohrane**:
- Uvijek **provjeravajte valjanost unosa** podataka koji se dohvaÄ‡aju s vanjske pohrane. To je kljuÄno jer podaci dolaze iz nepouzdanih izvora.
- Spremanje izvrÅ¡nih datoteka ili klasnih datoteka na vanjsku pohranu za dinamiÄko uÄitavanje snaÅ¾no se ne preporuÄuje.
- Ako vaÅ¡a aplikacija mora dohvaÄ‡ati izvrÅ¡ne datoteke s vanjske pohrane, provjerite jesu li te datoteke **potpisane i kriptografski provjerene** prije
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
Dobar naÄin da testirate ovo je da pokuÅ¡ate da uhvatite saobraÄ‡aj koristeÄ‡i neki proxy kao Å¡to je Burp, bez autorizacije Burp CA unutar ureÄ‘aja. TakoÄ‘e, moÅ¾ete generisati sertifikat za drugi naziv hosta i koristiti ga.

### Slomljena kriptografija

**LoÅ¡i procesi upravljanja kljuÄevima**

Neki programeri Äuvaju osetljive podatke u lokalnom skladiÅ¡tu i Å¡ifruju ih kljuÄem koji je unapred definisan/predvidljiv u kodu. Ovo ne bi trebalo raditi jer neko ko vrÅ¡i reverzno inÅ¾enjerstvo moÅ¾e izvuÄ‡i poverljive informacije.

**KoriÅ¡Ä‡enje nesigurnih i/ili zastarelih algoritama**

Programeri ne bi trebali koristiti **zastarele algoritme** za izvrÅ¡avanje **provere autorizacije**, **skladiÅ¡tenje** ili **slanje** podataka. Neki od ovih algoritama su: RC4, MD4, MD5, SHA1... Ako se koriste **heÅ¡evi** za skladiÅ¡tenje lozinki, na primer, treba koristiti heÅ¡eve koji su otporni na napade brute force uz upotrebu soli.

### Ostale provere

* PreporuÄuje se **obfuskacija APK datoteke** kako bi se oteÅ¾alo reverzno inÅ¾enjerstvo napadaÄima.
* Ako je aplikacija osetljiva (kao Å¡to su bankovne aplikacije), trebalo bi da izvrÅ¡i **sopstvene provere da vidi da li je mobilni ureÄ‘aj rutovan** i da deluje u skladu sa tim.
* Ako je aplikacija osetljiva (kao Å¡to su bankovne aplikacije), trebalo bi da proveri da li se koristi **emulator**.
* Ako je aplikacija osetljiva (kao Å¡to su bankovne aplikacije), trebalo bi da **proveri svoju celovitost pre izvrÅ¡avanja** kako bi se utvrdilo da li je izmenjena.
* Koristite [**APKiD**](https://github.com/rednaga/APKiD) da biste proverili koji je kompajler/paker/obfuskator koriÅ¡Ä‡en za izgradnju APK datoteke.

### React Native aplikacija

ProÄitajte sledeÄ‡u stranicu da biste saznali kako lako pristupiti JavaScript kodu React aplikacija:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Xamarin aplikacije

ProÄitajte sledeÄ‡u stranicu da biste saznali kako lako pristupiti C# kodu Xamarin aplikacija:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Superpacked aplikacije

Prema ovom [**blog postu**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/), superpacked je meta algoritam koji komprimuje sadrÅ¾aj aplikacije u jednu datoteku. Blog govori o moguÄ‡nosti kreiranja aplikacije koja dekompresuje ovakve vrste aplikacija... i brÅ¾em naÄinu koji ukljuÄuje **izvrÅ¡avanje aplikacije i prikupljanje dekompresovanih datoteka iz fajl sistema**.

### Automatizovana statiÄka analiza koda

Alat [**mariana-trench**](https://github.com/facebook/mariana-trench) je sposoban da pronaÄ‘e **ranjivosti** skeniranjem **koda** aplikacije. Ovaj alat sadrÅ¾i niz **poznatih izvora** (koji alatu pokazuju **mesta** gde je **ulaz kontrolisan od strane korisnika**), **izvoriÅ¡ta** (koja alatu pokazuju **opasna mesta** gde zlonamerni unos korisnika moÅ¾e izazvati Å¡tetu) i **pravila**. Ova pravila ukazuju na **kombinaciju izvora-izvoriÅ¡ta** koja ukazuje na ranjivost.

Na osnovu ovog znanja, **mariana-trench Ä‡e pregledati kod i pronaÄ‡i moguÄ‡e ranjivosti**.

### Procureli tajni podaci

Aplikacija moÅ¾e sadrÅ¾ati tajne podatke (API kljuÄeve, lozinke, skrivene URL-ove, poddomene...) unutar sebe koje biste mogli otkriti. MoÅ¾ete koristiti alat kao Å¡to je [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### ZaobilaÅ¾enje biometrijske autentifikacije

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Ostale interesantne funkcije

* **IzvrÅ¡avanje koda**: `Runtime.exec(), ProcessBuilder(), native code:system()`
* **Slanje SMS poruka**: `sendTextMessage, sendMultipartTestMessage`
* **Nativne funkcije** deklarisane kao `native`: `public native, System.loadLibrary, System.load`
* [ProÄitajte ovo da biste nauÄili **kako da reverzujete nativne funkcije**](reversing-native-libraries.md)

### **Ostali trikovi**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Hacking Insights**\
UkljuÄite se u sadrÅ¾aj koji istraÅ¾uje uzbuÄ‘enje i izazove hakovanja

**Vesti o hakovanju u realnom vremenu**\
Budite u toku sa brzim svetom hakovanja kroz vesti i uvide u realnom vremenu

**Najnovije objave**\
Budite informisani o najnovijim pokretanjima bagova i vaÅ¾nim aÅ¾uriranjima platforme

**PridruÅ¾ite nam se na** [**Discordu**](https://discord.com/invite/N3FrSbmwdy) i poÄnite da saraÄ‘ujete sa vrhunskim hakerima danas!

***

## DinamiÄka analiza

> Prvo, trebate okruÅ¾enje u kojem moÅ¾ete instalirati aplikaciju i sve potrebne alate (Burp CA sertifikat, Drozer i Frida). Stoga, preporuÄuje se koriÅ¡Ä‡enje rutiranog ureÄ‘aja (emuliranog ili ne).

### Online dinamiÄka analiza

MoÅ¾ete kreirati **besplatan nalog** na: [https://appetize.io/](https://appetize.io). Ova platforma vam omoguÄ‡ava da **uploadujete** i **izvrÅ¡ite** APK datoteke, pa je korisna za praÄ‡enje ponaÅ¡anja APK datoteke.

ÄŒak moÅ¾ete **videti logove vaÅ¡e aplikacije** na vebu i povezati se preko **adb**.

![](<../../.gitbook/assets/image (60).png>)

ZahvaljujuÄ‡i ADB vezi, moÅ¾ete koristiti **Drozer** i **Frida** unutar emulatora.

### Lokalna dinamiÄka analiza

#### KoriÅ¡Ä‡enje emulatora

* [**Android Studio**](https://developer.android.com/studio) (MoÅ¾ete kreirati **x86** i **arm** ureÄ‘aje, a prema [**ovom** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**najnovijem x86** verzije **podrÅ¾avaju ARM biblioteke** bez potrebe za sporim ARM emulatorom).
* NauÄite kako ga podesiti na ovoj stranici:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Besplatna verzija:** Personal Edition, trebate kreirati nalog. _PreporuÄuje se **preuzimanje** verzije **SA**_ _**VirtualBoxom** da biste izbegli moguÄ‡e greÅ¡ke._)
* [**Nox**](https://es.bignox.com) (Besplatno, ali ne podrÅ¾ava Fridu ili Drozer).

{% hint style="info" %}
Prilikom kreiranja novog emulatora na bilo kojoj platformi, zapamtite da Ä‡e emulator sporije raditi Å¡to je veÄ‡i ekran. Stoga odaberite manje ekrane ako je moguÄ‡e.
{% endhint %}

Da biste **instalirali Google usluge** (poput AppStore-a) u Genymotionu, trebate kliknuti na crveno oznaÄeno dugme na sledeÄ‡oj slici:

![](<../../.gitbook/assets/image (200) (1).png>)
#### Koristite fiziÄki ureÄ‘aj

Potrebno je aktivirati opcije za **debugiranje**, a bilo bi dobro ako ga moÅ¾ete **rootovati**:

1. **Postavke**.
2. (Od Android 8.0) Odaberite **Sistem**.
3. Odaberite **O telefonu**.
4. Pritisnite **Broj izgradnje** 7 puta.
5. Vratite se nazad i pronaÄ‡i Ä‡ete **Opcije za razvoj**.

> Nakon Å¡to ste instalirali aplikaciju, prva stvar koju trebate uraditi je da je isprobate i istraÅ¾ite Å¡ta radi, kako radi i da se s njom osjeÄ‡ate ugodno.\
> PredlaÅ¾em da **izvrÅ¡ite ovu poÄetnu dinamiÄku analizu koristeÄ‡i MobSF dinamiÄku analizu + pidcat**, tako da Ä‡emo moÄ‡i **saznati kako aplikacija radi** dok MobSF **snima** mnogo **zanimljivih** **podataka** koje moÅ¾ete kasnije pregledati.

### NeÅ¾eljeno curenje podataka

**Logovanje**

Razvojni programeri trebaju biti oprezni prilikom javnog izlaganja **informacija za debugiranje**, jer to moÅ¾e dovesti do curenja osjetljivih podataka. PreporuÄuje se koriÅ¡tenje alata [**pidcat**](https://github.com/JakeWharton/pidcat) i `adb logcat` za praÄ‡enje logova aplikacije kako bi se identifikovali i zaÅ¡titili osjetljivi podaci. **Pidcat** je preferiran zbog svoje jednostavnosti upotrebe i Äitljivosti.

{% hint style="warning" %}
Imajte na umu da od **kasnijih verzija Androida 4.0**, **aplikacije mogu pristupiti samo svojim vlastitim logovima**. Dakle, aplikacije ne mogu pristupiti logovima drugih aplikacija.\
U svakom sluÄaju, i dalje se preporuÄuje **ne logovati osjetljive informacije**.
{% endhint %}

**KeÅ¡iranje kopiranja/lepljenja izmeÄ‘u aplikacija**

Android-ov okvir zasnovan na **clipboard-u** omoguÄ‡ava funkcionalnost kopiranja i lepljenja u aplikacijama, ali predstavlja rizik jer **druge aplikacije** mogu **pristupiti** clipboard-u, potencijalno otkrivajuÄ‡i osjetljive podatke. VaÅ¾no je **onemoguÄ‡iti funkcije kopiranja/lepljenja** za osjetljive dijelove aplikacije, poput podataka o kreditnim karticama, kako bi se sprijeÄilo curenje podataka.

**Logovi o ruÅ¡enju aplikacije**

Ako se aplikacija **ruÅ¡i** i **snima logove**, ti logovi mogu pomoÄ‡i napadaÄima, posebno kada se aplikacija ne moÅ¾e reverzno inÅ¾enjerisati. Da biste smanjili ovaj rizik, izbjegavajte logovanje prilikom ruÅ¡enja, a ako logovi moraju biti preneseni preko mreÅ¾e, pobrinite se da se Å¡alju putem SSL kanala radi sigurnosti.

Kao pentester, **pokuÅ¡ajte pogledati ove logove**.

**Podaci o analitici poslati treÄ‡im stranama**

Aplikacije Äesto integriÅ¡u usluge poput Google Adsense-a, Å¡to moÅ¾e nenamjerno **procuriti osjetljive podatke** zbog nepravilne implementacije od strane programera. Da biste identifikovali potencijalno curenje podataka, preporuÄuje se **presretanje saobraÄ‡aja aplikacije** i provjera da li se Å¡alju osjetljive informacije treÄ‡im stranama.

### SQLite baze podataka

VeÄ‡ina aplikacija Ä‡e koristiti **interne SQLite baze podataka** za Äuvanje informacija. Tokom pentesta, pogledajte **kreirane baze podataka**, imena **tabela** i **kolona** i sve **podatke** saÄuvane jer biste mogli pronaÄ‡i **osjetljive informacije** (Å¡to bi predstavljalo ranjivost).\
Baze podataka trebaju se nalaziti u `/data/data/naziv.paketa/baze` kao Å¡to je `/data/data/com.mwr.example.sieve/baze`

Ako baza podataka Äuva povjerljive informacije i **enkriptovana je**, ali moÅ¾ete **pronaÄ‡i** lozinku **unutar aplikacije**, to i dalje predstavlja **ranjivost**.

Nabrajajte tabele koristeÄ‡i `.tables` i nabrajajte kolone tabela koristeÄ‡i `.schema <ime_tabele>`

### Drozer (Exploit aktivnosti, pruÅ¾atelja sadrÅ¾aja i usluga)

Iz [Drozer Dokumentacije](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** vam omoguÄ‡ava da **preuzmete ulogu Android aplikacije** i da komunicirate s drugim aplikacijama. MoÅ¾e raditi **sve Å¡to i instalirana aplikacija moÅ¾e**, kao Å¡to je koriÅ¡tenje Android-ovog mehanizma za meÄ‘uprocesnu komunikaciju (IPC) i interakcija s osnovnim operativnim sistemom.\
Drozer je koristan alat za **eksploataciju izvezenih aktivnosti, izvezenih usluga i pruÅ¾atelja sadrÅ¾aja**, kako Ä‡ete nauÄiti u narednim sekcijama.

### Eksploatacija izvezenih aktivnosti

[**ProÄitajte ovo ako Å¾elite osvjeÅ¾iti Å¡ta je Android aktivnost.**](android-applications-basics.md#launcher-activity-and-other-activities)\
TakoÄ‘e zapamtite da kod aktivnosti poÄinje u metodi **`onCreate`**.

**Bypass autorizacije**

Kada je aktivnost izvezena, moÅ¾ete je pozvati sa vanjske aplikacije. Dakle, ako je aktivnost sa **osjetljivim informacijama** **izvezena**, mogli biste **zaobiÄ‡i** mehanizme **autentifikacije** kako biste joj **pristupili**.

[**Saznajte kako eksploatisati izvezene aktivnosti pomoÄ‡u Drozera.**](drozer-tutorial/#activities)

TakoÄ‘e moÅ¾ete pokrenuti izvezenu aktivnost putem adb-a:

* PackageName je com.example.demo
* Izvezeno ime aktivnosti je com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NAPOMENA**: MobSF Ä‡e otkriti kao zlonamjernu upotrebu _**singleTask/singleInstance**_ kao `android:launchMode` u aktivnosti, ali zbog [ovoga](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), oÄigledno je da je ovo opasno samo na starim verzijama (API verzije < 21).

{% hint style="info" %}
Imajte na umu da zaobilaÅ¾enje autorizacije nije uvijek ranjivost, to bi zavisilo o tome kako zaobilaÅ¾enje radi i koje informacije su izloÅ¾ene.
{% endhint %}

**Curenje osjetljivih informacija**

**Aktivnosti takoÄ‘er mogu vratiti rezultate**. Ako uspijete pronaÄ‡i izloÅ¾enu i nezaÅ¡tiÄ‡enu aktivnost koja poziva metodu **`setResult`** i **vraÄ‡a osjetljive informacije**, to je curenje osjetljivih informacija.

#### Tapjacking

Ako se tapjacking ne sprijeÄi, moÅ¾ete zloupotrijebiti izloÅ¾enu aktivnost da **korisnik izvrÅ¡i neoÄekivane radnje**. Za viÅ¡e informacija o [**Å¡ta je Tapjacking slijedite link**](./#tapjacking).

### IskoriÅ¡tavanje pruÅ¾atelja sadrÅ¾aja - Pristupanje i manipulacija osjetljivim informacijama

[**ProÄitajte ovo ako Å¾elite osvjeÅ¾iti Å¡ta je pruÅ¾atelj sadrÅ¾aja.**](android-applications-basics.md#content-provider)\
PruÅ¾atelji sadrÅ¾aja se uglavnom koriste za **dijeljenje podataka**. Ako aplikacija ima dostupne pruÅ¾atelje sadrÅ¾aja, moÅ¾da Ä‡ete moÄ‡i **izvuÄ‡i osjetljive** podatke iz njih. TakoÄ‘er je zanimljivo testirati moguÄ‡e **SQL ubrizgavanje** i **putne traversale** jer bi mogli biti ranjivi.

[**NauÄite kako iskoristiti pruÅ¾atelje sadrÅ¾aja pomoÄ‡u Drozera.**](drozer-tutorial/#content-providers)

### **IskoriÅ¡tavanje usluga**

[**ProÄitajte ovo ako Å¾elite osvjeÅ¾iti Å¡ta je usluga.**](android-applications-basics.md#services)\
Zapamtite da se radnje usluge pokreÄ‡u u metodi `onStartCommand`.

Usluga je u osnovi neÅ¡to Å¡to **moÅ¾e primiti podatke**, **obraditi** ih i **vratiti** (ili ne) odgovor. Zatim, ako aplikacija izvozi neke usluge, trebali biste **provjeriti** kod da biste razumjeli Å¡to radi i **testirati** je **dinamiÄki** kako biste izvukli povjerljive informacije, zaobiÅ¡li mjere autentifikacije...\
[**NauÄite kako iskoristiti usluge pomoÄ‡u Drozera.**](drozer-tutorial/#services)

### **IskoriÅ¡tavanje prijemnika emitiranja**

[**ProÄitajte ovo ako Å¾elite osvjeÅ¾iti Å¡ta je prijemnik emitiranja.**](android-applications-basics.md#broadcast-receivers)\
Zapamtite da se radnje prijemnika emitiranja pokreÄ‡u u metodi `onReceive`.

Prijemnik emitiranja Ä‡e Äekati odreÄ‘enu vrstu poruke. Ovisno o tome kako prijemnik obraÄ‘uje poruku, moÅ¾e biti ranjiv.\
[**NauÄite kako iskoristiti prijemnike emitiranja pomoÄ‡u Drozera.**](./#exploiting-broadcast-receivers)

### **IskoriÅ¡tavanje shema / dubokih veza**

MoÅ¾ete ruÄno traÅ¾iti duboke veze koristeÄ‡i alate poput MobSF-a ili skripte poput [ove](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
MoÅ¾ete **otvoriti** deklariranu **shemu** koristeÄ‡i **adb** ili **preglednik**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Napomena da moÅ¾ete **izostaviti ime paketa** i mobilni ureÄ‘aj Ä‡e automatski pozvati aplikaciju koja treba otvoriti taj link._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**IzvrÅ¡eni kod**

Da biste pronaÅ¡li **kod koji Ä‡e se izvrÅ¡iti u aplikaciji**, idite na aktivnost koju poziva dubinska veza i potraÅ¾ite funkciju **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Osetljive informacije**

Svaki put kada pronaÄ‘ete dubinsku vezu, proverite da **ne prima osetljive podatke (kao Å¡to su lozinke) putem URL parametara**, jer bilo koja druga aplikacija moÅ¾e **preuzeti identitet dubinske veze i ukrasti te podatke!**

**Parametri u putanji**

TakoÄ‘e **morate proveriti da li dubinska veza koristi parametar unutar putanje** URL-a kao Å¡to je: `https://api.example.com/v1/users/{username}`, u tom sluÄaju moÅ¾ete izazvati putanju pretrage pristupom neÄemu poput: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Imajte na umu da ako pronaÄ‘ete ispravne krajnje taÄke unutar aplikacije, moÅ¾ete izazvati **Preusmeravanje otvorenih veza** (ako se deo putanje koristi kao ime domena), **preuzimanje naloga** (ako moÅ¾ete izmeniti detalje korisnika bez CSRF tokena i ranjiva krajnja taÄka koristi ispravnu metodu) i bilo koju drugu ranjivost. ViÅ¡e [informacija o tome ovde](http://dphoeniixx.com/2020/12/13-2/).

**JoÅ¡ primera**

[Interesantan izveÅ¡taj o otkrivanju greÅ¡aka](https://hackerone.com/reports/855618) o vezama (_/.well-known/assetlinks.json_).

### Pregled i neuspeh provere sloja transportnog sloja

- **Sertifikati se ne uvek pravilno proveravaju** u Android aplikacijama. ÄŒesto se deÅ¡ava da ove aplikacije ignoriÅ¡u upozorenja i prihvataju samopotpisane sertifikate ili, u nekim sluÄajevima, prelaze na koriÅ¡Ä‡enje HTTP veza.
- **Pregovori tokom SSL/TLS handshake-a ponekad su slabi**, koristeÄ‡i nesigurne kriptografske algoritme. Ova ranjivost Äini vezu podloÅ¾nom napadima "man-in-the-middle" (MITM), omoguÄ‡avajuÄ‡i napadaÄima da deÅ¡ifruju podatke.
- **Curenje privatnih informacija** je rizik kada aplikacije koriste sigurne kanale za autentifikaciju, ali zatim komuniciraju preko nesigurnih kanala za druge transakcije. Ovaj pristup ne Å¡titi osetljive podatke, poput sesijskih kolaÄiÄ‡a ili detalja korisnika, od presretanja od strane zlonamernih entiteta.

#### Provera sertifikata

FokusiraÄ‡emo se na **proveru sertifikata**. Integritet serverskog sertifikata mora biti proveren kako bi se poboljÅ¡ala bezbednost. Ovo je kljuÄno jer nesigurne TLS konfiguracije i prenos osetljivih podataka preko neÅ¡ifrovanih kanala mogu predstavljati znaÄajne rizike. Za detaljne korake o proveri serverskih sertifikata i reÅ¡avanju ranjivosti, **[ovaj resurs](https://manifestsecurity.com/android-application-security-part-10/)** pruÅ¾a sveobuhvatno uputstvo.

#### SSL Pinning

SSL Pinning je sigurnosna mera u kojoj aplikacija proverava serverski sertifikat prema poznatoj kopiji koja se Äuva unutar same aplikacije. Ova metoda je kljuÄna za spreÄavanje napada "man-in-the-middle" (MITM). SnaÅ¾no se preporuÄuje implementacija SSL Pinninga za aplikacije koje obraÄ‘uju osetljive informacije.

#### Inspekcija saobraÄ‡aja

Da biste pregledali HTTP saobraÄ‡aj, neophodno je **instalirati sertifikat alata za proxy** (npr. Burp). Bez instaliranja ovog sertifikata, Å¡ifrovani saobraÄ‡aj moÅ¾da neÄ‡e biti vidljiv kroz proxy. Uputstvo za instaliranje prilagoÄ‘enog CA sertifikata moÅ¾ete pronaÄ‡i **[ovde](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine)**.

Aplikacije koje ciljaju **API nivo 24 i viÅ¡e** zahtevaju izmene u konfiguraciji mreÅ¾ne sigurnosti kako bi prihvatile CA sertifikat proksija. Ovaj korak je kljuÄan za pregledanje Å¡ifrovanog saobraÄ‡aja. Uputstva za izmenu konfiguracije mreÅ¾ne sigurnosti moÅ¾ete pronaÄ‡i **[ovde](make-apk-accept-ca-certificate.md)**.

#### ZaobilaÅ¾enje SSL Pinninga

Kada je implementiran SSL Pinning, neophodno je zaobiÄ‡i ga kako biste pregledali HTTPS saobraÄ‡aj. Za ove svrhe dostupne su razliÄite metode:

* Automatski **izmenite** **apk** da biste **zaobiÅ¡li** SSL Pinning pomoÄ‡u [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). NajveÄ‡a prednost ove opcije je da vam nije potreban root za zaobilaÅ¾enje SSL Pinninga, ali Ä‡e biti potrebno da obriÅ¡ete aplikaciju i ponovo je instalirate, i ovo neÄ‡e uvek raditi.
* MoÅ¾ete koristiti **Frida** (opisano u nastavku) da biste zaobiÅ¡li ovu zaÅ¡titu. Ovde imate vodiÄ za koriÅ¡Ä‡enje Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* TakoÄ‘e moÅ¾ete pokuÅ¡ati **automatski zaobiÄ‡i SSL Pinning** koriÅ¡Ä‡enjem [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* TakoÄ‘e moÅ¾ete pokuÅ¡ati **automatski zaobiÄ‡i SSL Pinning** koriÅ¡Ä‡enjem **MobSF dinamiÄke analize** (objaÅ¡njeno u nastavku)
* Ako i dalje mislite da postoji neki saobraÄ‡aj koji ne snimate, moÅ¾ete pokuÅ¡ati da **prosledite saobraÄ‡aj burp-u koriÅ¡Ä‡enjem iptables**. ProÄitajte ovaj blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### Pretraga uobiÄajenih ranjivosti veb aplikacija

VaÅ¾no je takoÄ‘e pretraÅ¾ivati uobiÄajene ranjivosti veb aplikacija unutar same aplikacije. Detaljne informacije o identifikaciji i otklanjanju ovih ranjivosti su van opsega ovog saÅ¾etka, ali se detaljno obraÄ‘uju drugde.

### Frida

[Frida](https://www.frida.re) je alat za dinamiÄku instrumentaciju namenjen programerima, inÅ¾enjerima za reverzno inÅ¾enjerstvo i istraÅ¾ivaÄima bezbednosti.\
**MoÅ¾ete pristupiti pokrenutoj aplikaciji i povezati se sa metodama tokom izvrÅ¡avanja kako biste promenili ponaÅ¡anje, vrednosti, izvukli vrednosti, izvrÅ¡ili drugaÄiji kod...**\
Ako Å¾elite da testirate Android aplikacije, morate znati kako koristiti Fridu.

* NauÄite kako koristiti Fridu: [**Frida tutorial**](frida-tutorial/)
* Neke "GUI" opcije za rad sa Fridom: [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection je odliÄan za automatizaciju upotrebe Frida: [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* Ovde moÅ¾ete pronaÄ‡i neke sjajne Frida skripte: [**https://codeshare.frida.re/**](https://codeshare.frida.re)

### **Ispisivanje memorije - Fridump**

Proverite da li aplikacija Äuva osetljive informacije u memoriji koje ne bi trebala Äuvati, poput lozinki ili mnemonika.

KoristeÄ‡i [**Fridump3**](https://github.com/rootbsd/fridump3), moÅ¾ete ispisati memoriju aplikacije sa:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Ovo Ä‡e izbaciti memoriju u ./dump folderu, a tamo moÅ¾ete koristiti grep sa neÄim kao Å¡to je:

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Osetljivi podaci u Keystore-u**

U Androidu je Keystore najbolje mesto za Äuvanje osetljivih podataka, meÄ‘utim, sa dovoljno privilegija i dalje je **moguÄ‡e pristupiti njima**. PoÅ¡to aplikacije Äesto Äuvaju ovde **osetljive podatke u Äistom tekstu**, pentesteri bi trebali da provere da li je to sluÄaj, jer korisnik sa root pristupom ili neko ko ima fiziÄki pristup ureÄ‘aju moÅ¾e da ukrade ove podatke.

ÄŒak i ako aplikacija Äuva podatke u keystore-u, podaci bi trebali biti enkriptovani.

Da biste pristupili podacima unutar keystore-a, moÅ¾ete koristiti ovaj Frida skript: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Bypassiranje otiska prsta/biometrije**

KoriÅ¡Ä‡enjem sledeÄ‡eg Frida skripta moguÄ‡e je **bypass-ovati autentifikaciju otiska prsta** koju Android aplikacije mogu koristiti kako bi **zaÅ¡titile odreÄ‘ene osetljive oblasti:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Pozadinske slike**

Kada stavite aplikaciju u pozadinu, Android Äuva **snimak aplikacije** tako da kada se vrati na prednji plan, poÄinje uÄitavanje slike pre aplikacije kako bi izgledalo da je aplikacija uÄitana brÅ¾e.

MeÄ‘utim, ako ovaj snimak sadrÅ¾i **osetljive informacije**, neko ko ima pristup snimku moÅ¾e **ukrasti te informacije** (napomena: potreban je root pristup).

Snimci se obiÄno Äuvaju na lokaciji: **`/data/system_ce/0/snapshots`**

Android pruÅ¾a naÄin da **onemoguÄ‡i snimanje ekrana postavljanjem FLAG\_SECURE** parametra izgleda. KoriÅ¡Ä‡enjem ovog parametra, sadrÅ¾aj prozora se tretira kao siguran, spreÄavajuÄ‡i prikazivanje na snimcima ekrana ili na nebezbednim prikazima.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analizator Android aplikacija**

Ovaj alat moÅ¾e vam pomoÄ‡i u upravljanju razliÄitim alatima tokom dinamiÄke analize: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Injekcija namera

Razvojni programeri Äesto stvaraju proxy komponente poput aktivnosti, servisa i prijemnika emitovanja koji obraÄ‘uju ove namere i prosleÄ‘uju ih metodama poput `startActivity(...)` ili `sendBroadcast(...)`, Å¡to moÅ¾e biti riziÄno.

Opasnost leÅ¾i u tome Å¡to se napadaÄima omoguÄ‡ava pokretanje neizloÅ¾enih komponenti aplikacije ili pristup osetljivim pruÅ¾aocima sadrÅ¾aja preusmeravanjem ovih namera. ZnaÄajan primer je komponenta `WebView` koja konvertuje URL-ove u objekte `Intent` putem `Intent.parseUri(...)` i zatim ih izvrÅ¡ava, Å¡to moÅ¾e dovesti do zlonamernih injekcija namera.

### KljuÄne taÄke
- **Injekcija namera** je sliÄna problemu otvorenog preusmeravanja na vebu.
- Eksploatacija ukljuÄuje prosleÄ‘ivanje objekata `Intent` kao dodatnih podataka, koji mogu biti preusmereni da izvrÅ¡e nesigurne operacije.
- MoÅ¾e otkriti neizloÅ¾ene komponente i pruÅ¾aoce sadrÅ¾aja napadaÄima.
- Konverzija URL-a u `Intent` u `WebView`-u moÅ¾e olakÅ¡ati neÅ¾eljene radnje.

### Injekcije na klijentskoj strani Androida i ostale

Verovatno ste upoznati sa ovom vrstom ranjivosti na vebu. Morate biti posebno oprezni sa ovim ranjivostima u Android aplikaciji:

* **SQL Injection:** Prilikom rukovanja dinamiÄkim upitima ili pruÅ¾aocima sadrÅ¾aja, proverite da li koristite parametrizovane upite.
* **JavaScript Injection (XSS):** Proverite da li je podrÅ¡ka za JavaScript i dodatke onemoguÄ‡ena za sve WebView-ove (podrazumevano onemoguÄ‡eno). [ViÅ¡e informacija ovde](webview-attacks.md#javascript-enabled).
* **UkljuÄivanje lokalnih datoteka:** WebView-ovi bi trebalo da nemaju pristup sistemu datoteka (podrazumevano omoguÄ‡eno) - `(webview.getSettings().setAllowFileAccess(false);)`. [ViÅ¡e informacija ovde](webview-attacks.md#javascript-enabled).
* **VeÄni kolaÄiÄ‡i**: U nekoliko sluÄajeva, kada se Android aplikacija zavrÅ¡i, kolaÄiÄ‡ nije opozvan ili Äak moÅ¾e biti saÄuvan na disku.
* [**Sigurna oznaka** u kolaÄiÄ‡ima](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Uvidi u hakovanje**\
UkljuÄite se u sadrÅ¾aj koji istraÅ¾uje uzbuÄ‘enje i izazove hakovanja

**Hakovanje u realnom vremenu**\
Budite u toku sa brzim svetom hakovanja putem vesti i uvida u realnom vremenu

**Najnovije objave**\
Budite informisani o najnovijim pokretanjima nagrada za pronalaÅ¾enje bagova i vaÅ¾nim aÅ¾uriranjima platforme

**PridruÅ¾ite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poÄnite da saraÄ‘ujete sa vrhunskim hakerima danas!

## Automatska analiza

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**StatiÄka analiza**

![](<../../.gitbook/assets/image (61).png>)

**Procena ranjivosti aplikacije** koriÅ¡Ä‡enjem lepog veb baziranog korisniÄkog interfejsa. TakoÄ‘e moÅ¾ete izvrÅ¡iti dinamiÄku analizu (ali morate pripremiti okruÅ¾enje).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Primetite da MobSF moÅ¾e analizirati **Android** (apk), **IOS** (ipa) i **Windows** (apx) aplikacije (_Windows aplikacije se moraju analizirati sa MobSF instaliranim na Windows hostu_).\
TakoÄ‘e, ako napravite **ZIP** fajl sa izvornim kodom **Android** ili **IOS** aplikacije (idite u korenski folder aplikacije, izaberite sve i napravite ZIP fajl), MobSF Ä‡e moÄ‡i da ga analizira.

MobSF takoÄ‘e omoguÄ‡ava **diff/UporeÄ‘ivanje** analize i integraciju sa **VirusTotal** (morate postaviti svoj API kljuÄ u _MobSF/settings.py_ i omoguÄ‡iti ga: `VT_ENABLED = TRUE` `VT_API_KEY = <VaÅ¡ API kljuÄ>` `VT_UPLOAD = TRUE`). TakoÄ‘e moÅ¾ete postaviti `VT_UPLOAD` na `False`, tada Ä‡e se **hash** uploadovati umesto fajla.

### PomoÄ‡na dinamiÄka analiza sa MobSF

**MobSF** takoÄ‘e moÅ¾e biti veoma koristan za **dinamiÄku analizu** na **Androidu**, ali u tom sluÄaju morate instalirati MobSF i **genymotion** na svom hostu (VM ili Docker neÄ‡e raditi). _Napomena: Prvo morate **pokrenuti VM u genymotionu** a zatim MobSF._\
**MobSF dinamiÄki analizator** moÅ¾e:

* **IzvuÄ‡i podatke aplikacije** (URL-ove, logove, clipboard, screenshotove koje ste napravili, screenshotove koje je napravio "**Exported Activity Tester**", emailove, SQLite baze podataka, XML fajlove i druge kreirane fajlove). Sve ovo se radi automatski osim screenshotova, morate pritisnuti kada Å¾elite screenshot ili pritisnuti "**Exported Activity Tester**" da biste dobili screenshotove svih izvezenih aktivnosti.
* Snimiti **HTTPS saobraÄ‡aj**
* Koristiti **Frida** da dobije **informacije o izvrÅ¡avanju**

Od verzije **5** Androida, automatski Ä‡e pokrenuti Fridu i postaviti globalne **proxy** podeÅ¡avanja za **snimanje** saobraÄ‡aja. SnimaÄ‡e samo saobraÄ‡aj iz testirane aplikacije.

**Frida**

Podrazumevano, takoÄ‘e Ä‡e koristiti neke Frida skripte za **bypass SSL pinning**, **detekciju root-a** i **detekciju debugger-a** i za **praÄ‡enje interesantnih API-ja**.\
MobSF takoÄ‘e moÅ¾e **pokrenuti izvezene aktivnosti**, uhvatiti **screenshotove** i **saÄuvati** ih za izveÅ¡taj.

Da biste **pokrenuli** dinamiÄko testiranje, pritisnite zeleno dugme: "**Start Instrumentation**". Pritisnite "**Frida Live Logs**" da biste videli logove generisane od strane Frida skripti i "**Live API Monitor**" da biste videli sve pozive kukaÄkih metoda, prosleÄ‘ene argumente i vraÄ‡ene vrednosti (ovo Ä‡e se pojaviti nakon pritiskanja "Start Instrumentation").\
MobSF vam takoÄ‘e omoguÄ‡ava da uÄitate svoje **Frida skripte** (da biste poslali rezultate svojih Frida skripti u MobSF koristite funkciju `send()`). TakoÄ‘e ima **nekoliko unapred napisanih skripti** koje moÅ¾ete uÄitati (moÅ¾ete dodati viÅ¡e u `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), samo ih **izaberite**, pritisnite "**Load**" i pritisnite "**Start Instrumentation**" (moÄ‡i Ä‡ete videti logove te skripte unutar "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Osim toga, imate neke pomoÄ‡ne Frida funkcionalnosti:

* **Enumerate Loaded Classes**: Ispisuje sve uÄitane klase
* **Capture Strings**: Ispisuje sve uhvaÄ‡ene stringove prilikom koriÅ¡Ä‡enja aplikacije (veoma buÄno)
* **Capture String Comparisons**: MoÅ¾e biti veoma korisno. Pokazuje **dva uporeÄ‘ivana stringa** i da li je rezultat bio TaÄno ili NetaÄno.
* **Enumerate Class Methods**: Unesite ime klase (kao Å¡to je "java.io.File") i ispisuje sve metode klase.
* **Search Class Pattern**: PretraÅ¾uje klase po obrascu
* **Trace Class Methods**: **Prati** celu **klasu** (vidi ulaze i izlaze svih metoda klase). Zapamtite da MobSF podrazumevano prati nekoliko interesantnih Android Api metoda.

Kada ste izabrali pomoÄ‡ni modul koji Å¾elite da koristite, trebate pritisnuti "**Start Intrumentation**" i videÄ‡ete sve izlaze u "**Frida Live Logs**".

**Shell**

Mobsf takoÄ‘e pruÅ¾a shell sa nekim **adb** komandama, **MobSF komandama** i uobiÄajenim **shell komandama** na dnu stranice dinamiÄke analize. Neke interesantne komande:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**HTTP alati**

Kada se uhvati http saobraÄ‡aj, moÅ¾ete videti ruÅ¾an prikaz uhvaÄ‡enog saobraÄ‡aja na dnu "**HTTP(S) Traffic**" ili lepÅ¡i prikaz na zelenom dugmetu "**Start HTTPTools**". Iz druge opcije, moÅ¾ete **poslati** uhvaÄ‡ene zahteve na **proxy servere** poput Burp-a ili Owasp ZAP-a.\
Da biste to uradili, _ukljuÄite Burp -->_ _iskljuÄite Intercept --> u MobSB HTTPTools izaberite zahtev_ --> pritisnite "**Send to Fuzzer**" --> _izaberite adresu proxy servera_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Nakon zavrÅ¡etka dinamiÄke analize sa MobSF-om, moÅ¾ete pritisnuti "**Start Web API Fuzzer**" da biste **fuzz-ovali http zahteve** i traÅ¾ili ranjivosti.

{% hint style="info" %}
Nakon izvrÅ¡avanja dinamiÄke analize sa MobSF-om, postavke proxy servera mogu biti pogreÅ¡no konfigurisane i neÄ‡ete moÄ‡i da ih popravite putem korisniÄkog interfejsa. MoÅ¾ete popraviti postavke proxy servera na sledeÄ‡i naÄin:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Asistirana dinamiÄka analiza pomoÄ‡u Inspeckage-a

MoÅ¾ete preuzeti alat sa [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Ovaj alat koristi neke **Hooks** kako bi vam omoguÄ‡io da saznate **Å¡ta se deÅ¡ava u aplikaciji** dok vrÅ¡ite **dinamiÄku analizu**.


### [Yaazhini](https://www.vegabird.com/yaazhini/)

Ovo je **odliÄan alat za izvoÄ‘enje statiÄke analize sa grafiÄkim korisniÄkim interfejsom**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Ovaj alat je dizajniran da pronaÄ‘e nekoliko **bezbednosno vezanih ranjivosti Android aplikacija**, bilo u **izvornom kodu** ili **pakovanom APK-u**. Alat je takoÄ‘e **sposoban da kreira "Proof-of-Concept" APK** i **ADB komande**, kako bi iskoristio neke od pronaÄ‘enih ranjivosti (izloÅ¾ene aktivnosti, namere, tapjacking...). Kao i sa Drozer-om, nije potrebno rutovati testni ureÄ‘aj.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Prikazuje sve izvuÄene datoteke radi lakÅ¡eg referenciranja
* Automatski dekompilira APK datoteke u Java i Smali format
* Analizira AndroidManifest.xml za uobiÄajene ranjivosti i ponaÅ¡anje
* StatiÄka analiza izvornog koda za uobiÄajene ranjivosti i ponaÅ¡anje
* Informacije o ureÄ‘aju
* i joÅ¡ mnogo toga
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER je aplikacija za komandnu liniju koja se moÅ¾e koristiti u Windows-u, MacOS X-u i Linux-u, a koja analizira _.apk_ fajlove u potrazi za ranjivostima. To radi dekompresijom APK fajlova i primenom niza pravila za otkrivanje tih ranjivosti.

Sva pravila su smeÅ¡tena u `rules.json` fajlu, i svaka kompanija ili tester moÅ¾e kreirati svoja pravila za analizu onoga Å¡to im je potrebno.

Preuzmite najnovije binarne fajlove sa [stranice za preuzimanje](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn je **univerzalni** alat koji pomaÅ¾e programerima, lovcima na bagove i etiÄkim hakerima da izvrÅ¡e [statiÄku analizu koda](https://en.wikipedia.org/wiki/Static\_program\_analysis) mobilnih aplikacija.

Koncept je da prevuÄete i ispustite datoteku vaÅ¡e mobilne aplikacije (apk ili ipa datoteku) na StaCoAn aplikaciju i ona Ä‡e generisati vizuelni i prenosivi izveÅ¡taj za vas. MoÅ¾ete prilagoditi podeÅ¡avanja i liste reÄi da biste dobili prilagoÄ‘eno iskustvo.

Preuzmite [najnovije izdanje](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework je sistem za analizu ranjivosti Androida koji pomaÅ¾e programerima ili hakerima da pronaÄ‘u potencijalne sigurnosne ranjivosti u Android aplikacijama.\
[Windows izdanja](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** je alat Äiji je glavni cilj da otkrije i upozori korisnika na potencijalno zlonamerne radnje razvijene od strane Android aplikacije.

Detekcija se vrÅ¡i **statistiÄkom analizom** Dalvik bajtkoda aplikacije, koji je predstavljen kao **Smali**, pomoÄ‡u biblioteke [`androguard`](https://github.com/androguard/androguard).

Ovaj alat traÅ¾i **uobiÄajeno ponaÅ¡anje "loÅ¡ih" aplikacija** kao Å¡to su: izvlaÄenje telefonskih identifikatora, presretanje audio/video tokova, modifikacija PIM podataka, izvrÅ¡avanje proizvoljnog koda...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** je okvir za obrnuti inÅ¾enjering i analizu mobilnih aplikacija. To je alat koji objedinjuje Äesto koriÅ¡tene alate za obrnuti inÅ¾enjering i analizu mobilnih aplikacija, kako bi pomogao u testiranju mobilnih aplikacija protiv OWASP mobilnih sigurnosnih prijetnji. Cilj mu je olakÅ¡ati ovaj zadatak i uÄiniti ga prijateljskim prema razvojnim programerima mobilnih aplikacija i sigurnosnim struÄnjacima.

MoÅ¾e:

* IzvuÄ‡i Java i Smali kod koristeÄ‡i razliÄite alate
* Analizirati APK datoteke koristeÄ‡i: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* IzvuÄ‡i privatne informacije iz APK datoteka koristeÄ‡i regexps.
* Analizirati Manifest datoteke.
* Analizirati pronaÄ‘ene domene koristeÄ‡i: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) i [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Deobfuskirati APK putem [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

Korisno za otkrivanje zlonamjernog softvera: [https://koodous.com/](https://koodous.com)

## Obfuskacija/deobfuskacija koda

Imajte na umu da ovisno o usluzi i konfiguraciji koju koristite za obfuskaciju koda, tajne se mogu ili ne moraju zavrÅ¡iti obfuskirane.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

Prema [Wikipediji](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** je alat za obrnuti inÅ¾enjering otvorenog koda koji smanjuje, optimizira i obfuskira Java kod. MoÅ¾e optimizirati bajtkod kao i otkriti i ukloniti nekoriÅ¡tene instrukcije. ProGuard je besplatan softver i distribuira se pod GNU General Public License, verzija 2.

ProGuard se distribuira kao dio Android SDK-a i pokreÄ‡e se prilikom izgradnje aplikacije u naÄinu rada za objavljivanje.

### [DexGuard](https://www.guardsquare.com/dexguard)

PronaÄ‘ite vodiÄ korak po korak za deobfuskaciju APK datoteke na [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Iz tog vodiÄa) Posljednji put kad smo provjerili, naÄin rada Dexguarda bio je:

* uÄitavanje resursa kao InputStream;
* rezultat se prosljeÄ‘uje klasi koja nasljeÄ‘uje FilterInputStream za deÅ¡ifriranje;
* obavljanje beskorisne obfuskacije kako bi se gubilo nekoliko minuta vremena od osobe koja pokuÅ¡ava obrnuti inÅ¾enjering;
* deÅ¡ifrirani rezultat se prosljeÄ‘uje ZipInputStreamu kako bi se dobio DEX datoteka;
* konaÄno se rezultirajuÄ‡i DEX uÄitava kao resurs koristeÄ‡i metodu `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard vraÄ‡a postupak obfuskacije koji su izvrÅ¡ili alati za obfuskaciju Androida. To omoguÄ‡uje brojne sigurnosne analize, ukljuÄujuÄ‡i inspekciju koda i predviÄ‘anje biblioteka.**

MoÅ¾ete prenijeti obfuskiranu APK datoteku na njihovu platformu.

### [Simplify](https://github.com/CalebFenton/simplify)

To je **generiÄki deobfuskator za Android.** Simplify **virtuelno izvrÅ¡ava aplikaciju** kako bi razumio njezino ponaÅ¡anje, a zatim **pokuÅ¡ava optimizirati kod** tako da se ponaÅ¡a identiÄno, ali je lakÅ¡i za razumijevanje Äovjeka. Svaka vrsta optimizacije je jednostavna i generiÄka, pa nije vaÅ¾no koja se specifiÄna vrsta obfuskacije koristi.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD vam pruÅ¾a informacije o **naÄinu izrade APK datoteke**. Identificira mnoge **kompajlere**, **pakere**, **obfuskatore** i druge Äudne stvari. To je [_PEiD_](https://www.aldeid.com/wiki/PEiD) za Android.

### RuÄno

[ProÄitajte ovaj tutorial da biste nauÄili neke trikove o **kako obrnuti prilagoÄ‘enu obfuskaciju**](manual-deobfuscation.md)

## Laboratorije

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b je virtualna maÅ¡ina za sigurnost Androida bazirana na ubuntu-mate koja ukljuÄuje kolekciju najnovijih okvira, tutorijala i laboratorija od razliÄitih sigurnosnih struÄnjaka i istraÅ¾ivaÄa za obrnuti inÅ¾enjering i analizu zlonamjernog softvera.

## Reference

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) To je odliÄan popis resursa
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Brzi teÄaj za Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## JoÅ¡ nije isprobano

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali s iskusnim hakerima i lovcima na greÅ¡ke!

**Hacking Insights**\
UkljuÄite se u sadrÅ¾aj koji istraÅ¾uje uzbuÄ‘enje i izazove hakiranja

**Vijesti o hakiranju u stvarnom vremenu**\
Budite u toku s brzim svijetom hakiranja putem vijesti i saznanja u stvarnom vremenu

**Najnovije objave**\
Ostanite informirani o najnovijim nagradama za otkrivanje greÅ¡aka i vaÅ¾nim aÅ¾uriranjima platforme

**PridruÅ¾ite nam se na** [**Discordu**](https://discord.com/invite/N3FrSbmwdy) i poÄnite suraÄ‘ivati s vrhunskim hakerima danas!

<details>

<summary><strong>NauÄite hakiranje AWS-a od poÄetnika do struÄnjaka s</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricksu:

* Ako Å¾elite vidjeti **oglaÅ¡avanje svoje tvrtke u HackTricksu** ili **preuzeti HackTricks u PDF formatu**, provjerite [**PLANOVE PRETPLATE**](https://github.com/sponsors/carlospolop)!
* Nabavite [**sluÅ¾benu PEASS & HackTricks opremu**](https://peass.creator-spring.com)
* Otkrijte [**The PE
