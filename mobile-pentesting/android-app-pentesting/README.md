# Android Applications Pentesting

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Docz do [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serwera, aby komunikowa si z dowiadczonymi hackerami i owcami bug贸w!

**Hacking Insights**\
Zaanga偶uj si w treci, kt贸re zagbiaj si w emocje i wyzwania zwizane z hackingiem

**Real-Time Hack News**\
Bd藕 na bie偶co z dynamicznym wiatem hackingu dziki wiadomociom i spostrze偶eniom w czasie rzeczywistym

**Latest Announcements**\
Bd藕 informowany o najnowszych programach bug bounty oraz istotnych aktualizacjach platformy

**Docz do nas na** [**Discord**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hackerami ju偶 dzi!

## Android Applications Basics

Zaleca si rozpoczcie od przeczytania tej strony, aby pozna **najwa偶niejsze elementy zwizane z bezpieczestwem Androida oraz najbardziej niebezpieczne komponenty w aplikacji Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

To g贸wne narzdzie, kt贸rego potrzebujesz, aby poczy si z urzdzeniem android (emulowanym lub fizycznym).\
**ADB** pozwala na kontrolowanie urzdze zar贸wno przez **USB**, jak i **sie** z komputera. To narzdzie umo偶liwia **kopiowanie** plik贸w w obie strony, **instalacj** i **odinstalacj** aplikacji, **wykonywanie** polece powoki, **tworzenie kopii zapasowych** danych, **odczytywanie** log贸w, wr贸d innych funkcji.

Zobacz poni偶sz list [**komend ADB**](adb-commands.md), aby dowiedzie si, jak u偶ywa adb.

## Smali

Czasami interesujce jest **modyfikowanie kodu aplikacji**, aby uzyska dostp do **ukrytych informacji** (mo偶e dobrze obfuskowanych hase lub flag). Wtedy mo偶e by interesujce dekompilowanie apk, modyfikowanie kodu i ponowne kompilowanie go.\
[**W tym samouczku** mo偶esz **nauczy si, jak dekompilowa APK, modyfikowa kod Smali i ponownie kompilowa APK** z now funkcjonalnoci](smali-changes.md). Mo偶e to by bardzo przydatne jako **alternatywa dla kilku test贸w podczas analizy dynamicznej**, kt贸re bd przedstawione. Dlatego **zawsze miej na uwadze t mo偶liwo**.

## Inne interesujce triki

* [Spoofing your location in Play Store](spoofing-your-location-in-play-store.md)
* **Pobierz APK**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/), [https://github.com/kiber-io/apkd](https://github.com/kiber-io/apkd)
* Wyodrbnij APK z urzdzenia:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
* Pocz wszystkie podziay i podstawowe pliki APK za pomoc [APKEditor](https://github.com/REAndroid/APKEditor):
```bash
mkdir splits
adb shell pm path com.android.insecurebankv2 | cut -d ':' -f 2 | xargs -n1 -i adb pull {} splits
java -jar ../APKEditor.jar m -i splits/ -o merged.apk

# after merging, you will need to align and sign the apk, personally, I like to use the uberapksigner
java -jar uber-apk-signer.jar -a merged.apk --allowResign -o merged_signed
```
## Analiza statyczna

Przede wszystkim, aby przeanalizowa APK, powiniene **rzuci okiem na kod Java** za pomoc dekompilatora.\
Prosz, [**przeczytaj tutaj, aby znale藕 informacje o r贸偶nych dostpnych dekompilatorach**](apk-decompilers.md).

### Szukanie interesujcych informacji

Samo rzucenie okiem na **cigi** APK pozwala na wyszukiwanie **hase**, **URL** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **kluczy** **api**, **szyfrowania**, **uuid bluetooth**, **token贸w** i wszystkiego, co mo偶e by interesujce... szukaj nawet **tylnych drzwi** do wykonania kodu lub tylnych drzwi autoryzacyjnych (twardo zakodowane dane administratora w aplikacji).

**Firebase**

Zwr贸 szczeg贸ln uwag na **adresy URL Firebase** i sprawd藕, czy s 藕le skonfigurowane. [Wicej informacji na temat tego, czym jest Firebase i jak go wykorzysta, znajdziesz tutaj.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Podstawowe zrozumienie aplikacji - Manifest.xml, strings.xml

**Badanie plik贸w \_Manifest.xml**_\*\* i \*\*_**strings.xml**\_\*\* mo偶e ujawni potencjalne luki w zabezpieczeniach\*\*. Pliki te mo偶na uzyska za pomoc dekompilator贸w lub przez zmian rozszerzenia pliku APK na .zip, a nastpnie rozpakowanie go.

**Luki** zidentyfikowane w **Manifest.xml** obejmuj:

* **Aplikacje debugowalne**: Aplikacje ustawione jako debugowalne (`debuggable="true"`) w pliku _Manifest.xml_ stanowi ryzyko, poniewa偶 pozwalaj na poczenia, kt贸re mog prowadzi do wykorzystania. Aby uzyska dalsze zrozumienie, jak wykorzysta aplikacje debugowalne, zapoznaj si z samouczkiem na temat znajdowania i wykorzystywania aplikacji debugowalnych na urzdzeniu.
* **Ustawienia kopii zapasowej**: Atrybut `android:allowBackup="false"` powinien by wyra藕nie ustawiony dla aplikacji zajmujcych si wra偶liwymi informacjami, aby zapobiec nieautoryzowanym kopiom zapasowym danych za pomoc adb, szczeg贸lnie gdy debugowanie USB jest wczone.
* **Bezpieczestwo sieci**: Niestandardowe konfiguracje bezpieczestwa sieci (`android:networkSecurityConfig="@xml/network_security_config"`) w _res/xml/_ mog okrela szczeg贸y bezpieczestwa, takie jak przypinanie certyfikat贸w i ustawienia ruchu HTTP. Przykadem jest zezwolenie na ruch HTTP dla okrelonych domen.
* **Eksportowane aktywnoci i usugi**: Identyfikacja eksportowanych aktywnoci i usug w manifecie mo偶e uwydatni komponenty, kt贸re mog by nadu偶ywane. Dalsza analiza podczas test贸w dynamicznych mo偶e ujawni, jak wykorzysta te komponenty.
* **Dostawcy treci i FileProviders**: Ujawnieni dostawcy treci mog umo偶liwi nieautoryzowany dostp lub modyfikacj danych. Konfiguracja FileProviders powinna by r贸wnie偶 dokadnie sprawdzona.
* **Odbiorniki rozgoszeniowe i schematy URL**: Te komponenty mog by wykorzystywane do eksploatacji, z szczeg贸ln uwag na to, jak zarzdzane s schematy URL w kontekcie luk wejciowych.
* **Wersje SDK**: Atrybuty `minSdkVersion`, `targetSDKVersion` i `maxSdkVersion` wskazuj obsugiwane wersje Androida, podkrelajc znaczenie nieobsugiwania przestarzaych, podatnych wersji Androida z powod贸w bezpieczestwa.

Z pliku **strings.xml** mo偶na odkry wra偶liwe informacje, takie jak klucze API, niestandardowe schematy i inne notatki dewelopera, co podkrela potrzeb starannego przegldu tych zasob贸w.

### Tapjacking

**Tapjacking** to atak, w kt贸rym **zoliwa** **aplikacja** jest uruchamiana i **pozycjonuje si na wierzchu aplikacji ofiary**. Gdy widocznie zasania aplikacj ofiary, jej interfejs u偶ytkownika jest zaprojektowany w taki spos贸b, aby oszuka u偶ytkownika, aby wchodzi z ni w interakcj, podczas gdy przekazuje interakcj do aplikacji ofiary.\
W efekcie, **olepia u偶ytkownika, aby nie wiedzia, 偶e faktycznie wykonuje akcje w aplikacji ofiary**.

Wicej informacji znajdziesz w:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Przechwytywanie zada

**Aktywno** z ustawionym **`launchMode`** na **`singleTask`** bez zdefiniowanego `taskAffinity` jest podatna na przechwytywanie zada. Oznacza to, 偶e **aplikacja** mo偶e by zainstalowana i jeli zostanie uruchomiona przed prawdziw aplikacj, mo偶e **przechwyci zadanie prawdziwej aplikacji** (wic u偶ytkownik bdzie wchodzi w interakcj z **zoliw aplikacj, mylc, 偶e u偶ywa prawdziwej**).

Wicej informacji w:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Niebezpieczne przechowywanie danych

**Przechowywanie wewntrzne**

W Androidzie pliki **przechowywane** w **przechowywaniu wewntrznym** s **zaplanowane** do **dostpu** wycznie przez **aplikacj**, kt贸ra je **utworzya**. Ten rodek bezpieczestwa jest **egzekwowany** przez system operacyjny Android i jest zazwyczaj wystarczajcy dla potrzeb bezpieczestwa wikszoci aplikacji. Jednak deweloperzy czasami wykorzystuj tryby takie jak `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE`, aby **pozwoli** na **dzielenie si** plikami midzy r贸偶nymi aplikacjami. Niemniej jednak, te tryby **nie ograniczaj dostpu** do tych plik贸w przez inne aplikacje, w tym potencjalnie zoliwe.

1. **Analiza statyczna:**
* **Upewnij si**, 偶e u偶ycie `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE` jest **dokadnie sprawdzane**. Te tryby **mog potencjalnie ujawnia** pliki dla **niezamierzonego lub nieautoryzowanego dostpu**.
2. **Analiza dynamiczna:**
* **Zweryfikuj** **uprawnienia** ustawione na plikach utworzonych przez aplikacj. W szczeg贸lnoci **sprawd藕**, czy jakiekolwiek pliki s **ustawione na bycie czytelnymi lub zapisywalnymi na caym wiecie**. Mo偶e to stanowi istotne ryzyko bezpieczestwa, poniewa偶 pozwolioby to **jakiejkolwiek aplikacji** zainstalowanej na urzdzeniu, niezale偶nie od jej pochodzenia lub zamiaru, na **odczyt lub modyfikacj** tych plik贸w.

**Przechowywanie zewntrzne**

Podczas pracy z plikami na **przechowywaniu zewntrznym**, takim jak karty SD, nale偶y podj pewne rodki ostro偶noci:

1. **Dostpno**:
* Pliki na zewntrznym przechowywaniu s **globalnie czytelne i zapisywalne**. Oznacza to, 偶e ka偶da aplikacja lub u偶ytkownik mo偶e uzyska dostp do tych plik贸w.
2. **Problemy z bezpieczestwem**:
* Biorc pod uwag atwo dostpu, zaleca si **nieprzechowywanie wra偶liwych informacji** na zewntrznym przechowywaniu.
* Zewntrzne przechowywanie mo偶e by usunite lub dostpne przez ka偶d aplikacj, co czyni je mniej bezpiecznym.
3. **Obsuga danych z zewntrznego przechowywania**:
* Zawsze **przeprowadzaj walidacj wejcia** na danych pobranych z zewntrznego przechowywania. Jest to kluczowe, poniewa偶 dane pochodz z nieznanego 藕r贸da.
* Przechowywanie plik贸w wykonywalnych lub klas na zewntrznym przechowywaniu do dynamicznego adowania jest zdecydowanie odradzane.
* Jeli Twoja aplikacja musi pobiera pliki wykonywalne z zewntrznego przechowywania, upewnij si, 偶e te pliki s **podpisane i weryfikowane kryptograficznie** przed ich dynamicznym zaadowaniem. Ten krok jest kluczowy dla utrzymania integralnoci bezpieczestwa Twojej aplikacji.

Zewntrzne przechowywanie mo偶na **uzyska** w `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
Poczwszy od Androida 4.4 (**API 17**), karta SD ma struktur katalog贸w, kt贸ra **ogranicza dostp aplikacji do katalogu, kt贸ry jest specjalnie przeznaczony dla tej aplikacji**. To zapobiega zoliwej aplikacji uzyskiwaniu dostpu do plik贸w innej aplikacji w trybie odczytu lub zapisu.
{% endhint %}

**Wra偶liwe dane przechowywane w postaci niezaszyfrowanej**

* **Preferencje wsp贸dzielone**: Android pozwala ka偶dej aplikacji atwo zapisywa pliki xml w cie偶ce `/data/data/<packagename>/shared_prefs/` i czasami mo偶liwe jest znalezienie wra偶liwych informacji w postaci niezaszyfrowanej w tym folderze.
* **Bazy danych**: Android pozwala ka偶dej aplikacji atwo zapisywa bazy danych sqlite w cie偶ce `/data/data/<packagename>/databases/` i czasami mo偶liwe jest znalezienie wra偶liwych informacji w postaci niezaszyfrowanej w tym folderze.

### Uszkodzony TLS

**Akceptuj wszystkie certyfikaty**

Z jakiego powodu czasami deweloperzy akceptuj wszystkie certyfikaty, nawet jeli na przykad nazwa hosta nie pasuje do linii kodu, jak w poni偶szym przykadzie:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
A good way to test this is to try to capture the traffic using some proxy like Burp without authorising Burp CA inside the device. Also, you can generate with Burp a certificate for a different hostname and use it.

### Broken Cryptography

**Poor Key Management Processes**

Niekt贸rzy deweloperzy zapisuj wra偶liwe dane w lokalnej pamici i szyfruj je kluczem zakodowanym/atwym do przewidzenia w kodzie. Nie powinno si tego robi, poniewa偶 pewne odwracanie in偶ynieryjne mo偶e pozwoli atakujcym na wydobycie poufnych informacji.

**Use of Insecure and/or Deprecated Algorithms**

Deweloperzy nie powinni u偶ywa **przestarzaych algorytm贸w** do przeprowadzania **sprawdzania** **autoryzacji**, **przechowywania** lub **wysyania** danych. Niekt贸re z tych algorytm贸w to: RC4, MD4, MD5, SHA1... Jeli **hashe** s u偶ywane do przechowywania hase, powinny by u偶ywane hashe odporne na brute-force z sol.

### Other checks

* Zaleca si **obfuskacj APK**, aby utrudni atakujcym prac in偶ynieryjn.
* Jeli aplikacja jest wra偶liwa (jak aplikacje bankowe), powinna przeprowadza **wasne kontrole, aby sprawdzi, czy urzdzenie jest zrootowane** i dziaa w konsekwencji.
* Jeli aplikacja jest wra偶liwa (jak aplikacje bankowe), powinna sprawdzi, czy u偶ywany jest **emulator**.
* Jeli aplikacja jest wra偶liwa (jak aplikacje bankowe), powinna **sprawdzi swoj integralno przed wykonaniem**, aby sprawdzi, czy zostaa zmodyfikowana.
* U偶yj [**APKiD**](https://github.com/rednaga/APKiD), aby sprawdzi, kt贸ry kompilator/pakiet/obfuskator zosta u偶yty do zbudowania APK

### React Native Application

Read the following page to learn how to easily access javascript code of React applications:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Xamarin Applications

Read the following page to learn how to easily access C# code of a xamarin applications:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Superpacked Applications

According to this [**blog post**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/) superpacked is a Meta algorithm that compress the content of an application into a single file. The blog talks about the possibility of creating an app that decompress these kind of apps... and a faster way which involves to **execute the application and gather the decompressed files from the filesystem.**

### Automated Static Code Analysis

The tool [**mariana-trench**](https://github.com/facebook/mariana-trench) is capable of finding **vulnerabilities** by **scanning** the **code** of the application. This tool contains a series of **known sources** (that indicates to the tool the **places** where the **input** is **controlled by the user**), **sinks** (which indicates to the tool **dangerous** **places** where malicious user input could cause damages) and **rules**. These rules indicates the **combination** of **sources-sinks** that indicates a vulnerability.

With this knowledge, **mariana-trench will review the code and find possible vulnerabilities on it**.

### Secrets leaked

An application may contain secrets (API keys, passwords, hidden urls, subdomains...) inside of it that you might be able to discover. You could us a tool such as [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Bypass Biometric Authentication

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Other interesting functions

* **Code execution**: `Runtime.exec(), ProcessBuilder(), native code:system()`
* **Send SMSs**: `sendTextMessage, sendMultipartTestMessage`
* **Native functions** declared as `native`: `public native, System.loadLibrary, System.load`
* [Read this to learn **how to reverse native functions**](reversing-native-libraries.md)

### **Other tricks**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

***

## Dynamic Analysis

> First of all, you need an environment where you can install the application and all the environment (Burp CA cert, Drozer and Frida mainly). Therefore, a rooted device (emulated or not) is extremely recommended.

### Online Dynamic analysis

You can create a **free account** in: [https://appetize.io/](https://appetize.io). This platform allows you to **upload** and **execute** APKs, so it is useful to see how an apk is behaving.

You can even **see the logs of your application** in the web and connect through **adb**.

![](<../../.gitbook/assets/image (831).png>)

Thanks to the ADB connection you can use **Drozer** and **Frida** inside the emulators.

### Local Dynamic Analysis

#### Using an emulator

* [**Android Studio**](https://developer.android.com/studio) (You can create **x86** and **arm** devices, and according to [**this** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**latest x86** versions **support ARM libraries** without needing an slow arm emulator).
* Learn to set it up in this page:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Free version:** Personal Edition, you need to create an account. _It's recommend to **download** the version **WITH**_ _**VirtualBox** to avoid potential errors._)
* [**Nox**](https://es.bignox.com) (Free, but it doesn't support Frida or Drozer).

{% hint style="info" %}
When creating a new emulator on any platform remember that the bigger the screen is, the slower the emulator will run. So select small screens if possible.
{% endhint %}

To **install google services** (like AppStore) in Genymotion you need to click on the red marked button of the following image:

![](<../../.gitbook/assets/image (277).png>)

Also, notice that in the **configuration of the Android VM in Genymotion** you can select **Bridge Network mode** (this will be useful if you will be connecting to the Android VM from a different VM with the tools).

#### Use a physical device

You need to activate the **debugging** options and it will be cool if you can **root** it:

1. **Settings**.
2. (FromAndroid 8.0) Select **System**.
3. Select **About phone**.
4. Press **Build number** 7 times.
5. Go back and you will find the **Developer options**.

> Once you have installed the application, the first thing you should do is to try it and investigate what does it do, how does it work and get comfortable with it.\
> I will suggest to **perform this initial dynamic analysis using MobSF dynamic analysis + pidcat**, so we will be able to **learn how the application works** while MobSF **captures** a lot of **interesting** **data** you can review later on.

### Unintended Data Leakage

**Logging**

Deweloperzy powinni by ostro偶ni w ujawnianiu **informacji debugowania** publicznie, poniewa偶 mo偶e to prowadzi do wyciek贸w wra偶liwych danych. Narzdzia [**pidcat**](https://github.com/JakeWharton/pidcat) i `adb logcat` s zalecane do monitorowania log贸w aplikacji w celu identyfikacji i ochrony wra偶liwych informacji. **Pidcat** jest preferowane ze wzgldu na atwo u偶ycia i czytelno.

{% hint style="warning" %}
Note that from **later newer than Android 4.0**, **applications are only able to access their own logs**. So applications cannot access other apps logs.\
Anyway, it's still recommended to **not log sensitive information**.
{% endhint %}

**Copy/Paste Buffer Caching**

Android's **clipboard-based** framework enables copy-paste functionality in apps, yet poses a risk as **other applications** can **access** the clipboard, potentially exposing sensitive data. It's crucial to **disable copy/paste** functions for sensitive sections of an application, like credit card details, to prevent data leaks.

**Crash Logs**

If an application **crashes** and **saves logs**, these logs can assist attackers, particularly when the application cannot be reverse-engineered. To mitigate this risk, avoid logging on crashes, and if logs must be transmitted over the network, ensure they are sent via an SSL channel for security.

As pentester, **try to take a look to these logs**.

**Analytics Data Sent To 3rd Parties**

Aplikacje czsto integruj usugi takie jak Google Adsense, kt贸re mog nieumylnie **ujawnia wra偶liwe dane** z powodu niewaciwej implementacji przez deweloper贸w. Aby zidentyfikowa potencjalne wycieki danych, zaleca si **przechwycenie ruchu aplikacji** i sprawdzenie, czy jakiekolwiek wra偶liwe informacje s wysyane do usug stron trzecich.

### SQLite DBs

Wikszo aplikacji bdzie u偶ywa **wewntrznych baz danych SQLite** do zapisywania informacji. Podczas pentest贸w zwr贸 uwag na **bazy danych** utworzone, nazwy **tabel** i **kolumn** oraz wszystkie **dane** zapisane, poniewa偶 mo偶esz znale藕 **wra偶liwe informacje** (co byoby luk).\
Bazy danych powinny znajdowa si w `/data/data/the.package.name/databases` jak `/data/data/com.mwr.example.sieve/databases`

If the database is saving confidential information and is **encrypted b**ut you can **find** the **password** inside the application it's still a **vulnerability**.

Enumerate the tables using `.tables` and enumerate the columns of the tables doing `.schema <table_name>`

### Drozer (Exploit Activities, Content Providers and Services)

From [Drozer Docs](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** allows you to **assume the role of an Android app** and interact with other apps. It can do **anything that an installed application can do**, such as make use of Androids Inter-Process Communication (IPC) mechanism and interact with the underlying operating system. .\
Drozer is s useful tool to **exploit exported activities, exported services and Content Providers** as you will learn in the following sections.

### Exploiting exported Activities

[**Read this if you want to refresh what is an Android Activity.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Also remember that the code of an activity starts in the **`onCreate`** method.

**Authorisation bypass**

When an Activity is exported you can invoke its screen from an external app. Therefore, if an activity with **sensitive information** is **exported** you could **bypass** the **authentication** mechanisms **to access it.**

[**Learn how to exploit exported activities with Drozer.**](drozer-tutorial/#activities)

You can also start an exported activity from adb:

* PackageName is com.example.demo
* Exported ActivityName is com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**UWAGA**: MobSF wykryje jako zoliwe u偶ycie _**singleTask/singleInstance**_ jako `android:launchMode` w aktywnoci, ale z powodu [tego](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), najwyra藕niej jest to niebezpieczne tylko w starych wersjach (wersje API < 21).

{% hint style="info" %}
Zauwa偶, 偶e obejcie autoryzacji nie zawsze jest luk, zale偶y to od tego, jak dziaa obejcie i jakie informacje s ujawniane.
{% endhint %}

**Wycieki wra偶liwych informacji**

**Aktywnoci mog r贸wnie偶 zwraca wyniki**. Jeli uda ci si znale藕 eksportowan i niechronion aktywno wywoujc metod **`setResult`** i **zwracajc wra偶liwe informacje**, dochodzi do wycieku wra偶liwych informacji.

#### Tapjacking

Jeli tapjacking nie jest zapobiegany, mo偶esz nadu偶y eksportowanej aktywnoci, aby **zmusi u偶ytkownika do wykonania nieoczekiwanych dziaa**. Aby uzyska wicej informacji o [**tym, czym jest Tapjacking, kliknij tutaj**](./#tapjacking).

### Wykorzystywanie dostawc贸w treci - Uzyskiwanie dostpu i manipulowanie wra偶liwymi informacjami

[**Przeczytaj to, jeli chcesz odwie偶y, czym jest dostawca treci.**](android-applications-basics.md#content-provider)\
Dostawcy treci s zasadniczo u偶ywani do **dzielenia si danymi**. Jeli aplikacja ma dostpne dostawc贸w treci, mo偶esz by w stanie **wyodrbni wra偶liwe** dane z nich. Interesujce jest r贸wnie偶 testowanie mo偶liwych **iniekcji SQL** i **przechodzenia po cie偶kach**, poniewa偶 mog by podatne.

[**Dowiedz si, jak wykorzystywa dostawc贸w treci za pomoc Drozer.**](drozer-tutorial/#content-providers)

### **Wykorzystywanie usug**

[**Przeczytaj to, jeli chcesz odwie偶y, czym jest usuga.**](android-applications-basics.md#services)\
Pamitaj, 偶e dziaania usugi zaczynaj si w metodzie `onStartCommand`.

Usuga to zasadniczo co, co **mo偶e odbiera dane**, **przetwarza** je i **zwraca** (lub nie) odpowied藕. Jeli aplikacja eksportuje jakie usugi, powiniene **sprawdzi** **kod**, aby zrozumie, co robi, i **testowa** j **dynamicznie**, aby wyodrbni poufne informacje, omijajc rodki autoryzacji...\
[**Dowiedz si, jak wykorzystywa usugi za pomoc Drozer.**](drozer-tutorial/#services)

### **Wykorzystywanie odbiornik贸w rozgoszeniowych**

[**Przeczytaj to, jeli chcesz odwie偶y, czym jest odbiornik rozgoszeniowy.**](android-applications-basics.md#broadcast-receivers)\
Pamitaj, 偶e dziaania odbiornika rozgoszeniowego zaczynaj si w metodzie `onReceive`.

Odbiornik rozgoszeniowy bdzie czeka na rodzaj wiadomoci. W zale偶noci od tego, jak odbiornik obsuguje wiadomo, mo偶e by podatny.\
[**Dowiedz si, jak wykorzystywa odbiorniki rozgoszeniowe za pomoc Drozer.**](./#exploiting-broadcast-receivers)

### **Wykorzystywanie schemat贸w / gbokich link贸w**

Mo偶esz rcznie szuka gbokich link贸w, u偶ywajc narzdzi takich jak MobSF lub skrypt贸w jak [ten](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Mo偶esz **otworzy** zadeklarowany **schemat** u偶ywajc **adb** lub **przegldarki**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Uwaga, 偶e mo偶esz **pomin nazw pakietu** a urzdzenie mobilne automatycznie otworzy aplikacj, kt贸ra powinna otworzy ten link._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**Kod wykonany**

Aby znale藕 **kod, kt贸ry bdzie wykonany w aplikacji**, przejd藕 do aktywnoci wywoywanej przez deeplink i wyszukaj funkcj **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Wra偶liwe informacje**

Za ka偶dym razem, gdy znajdziesz deep link, sprawd藕, czy **nie odbiera wra偶liwych danych (jak hasa) za pomoc parametr贸w URL**, poniewa偶 ka偶da inna aplikacja mo偶e **podszy si pod deep link i ukra te dane!**

**Parametry w cie偶ce**

Musisz r贸wnie偶 sprawdzi, czy jakikolwiek deep link u偶ywa parametru wewntrz cie偶ki URL, jak: `https://api.example.com/v1/users/{username}`, w takim przypadku mo偶esz wymusi przejcie przez cie偶k, uzyskujc dostp do czego takiego jak: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Zauwa偶, 偶e jeli znajdziesz poprawne punkty kocowe w aplikacji, mo偶esz by w stanie spowodowa **Open Redirect** (jeli cz cie偶ki jest u偶ywana jako nazwa domeny), **przejcie konta** (jeli mo偶esz zmodyfikowa dane u偶ytkownik贸w bez tokena CSRF, a podatny punkt kocowy u偶ywa poprawnej metody) i inne podatnoci. Wicej [informacji na ten temat tutaj](http://dphoeniixx.com/2020/12/13-2/).

**Wicej przykad贸w**

Ciekawy raport o bug bounty [tutaj](https://hackerone.com/reports/855618) dotyczcy link贸w (_/.well-known/assetlinks.json_).

### Wykrywanie i weryfikacja warstwy transportowej

* **Certyfikaty nie zawsze s odpowiednio sprawdzane** przez aplikacje Android. Czsto te aplikacje ignoruj ostrze偶enia i akceptuj certyfikaty samopodpisane lub, w niekt贸rych przypadkach, wracaj do u偶ywania pocze HTTP.
* **Negocjacje podczas handshake SSL/TLS s czasami sabe**, stosujc niebezpieczne zestawy szyfr贸w. Ta podatno sprawia, 偶e poczenie jest podatne na ataki typu man-in-the-middle (MITM), co pozwala atakujcym na odszyfrowanie danych.
* **Wycieki prywatnych informacji** s ryzykiem, gdy aplikacje uwierzytelniaj si za pomoc bezpiecznych kana贸w, ale nastpnie komunikuj si przez niebezpieczne kanay w innych transakcjach. Takie podejcie nie chroni wra偶liwych danych, takich jak ciasteczka sesyjne czy dane u偶ytkownik贸w, przed przechwyceniem przez zoliwe podmioty.

#### Weryfikacja certyfikatu

Skupimy si na **weryfikacji certyfikatu**. Integralno certyfikatu serwera musi by weryfikowana, aby zwikszy bezpieczestwo. Jest to kluczowe, poniewa偶 niebezpieczne konfiguracje TLS i przesyanie wra偶liwych danych przez niezaszyfrowane kanay mog stwarza powa偶ne ryzyko. Aby uzyska szczeg贸owe kroki dotyczce weryfikacji certyfikat贸w serwera i rozwizywania podatnoci, [**to 藕r贸do**](https://manifestsecurity.com/android-application-security-part-10/) oferuje kompleksowe wskaz贸wki.

#### SSL Pinning

SSL Pinning to rodek bezpieczestwa, w kt贸rym aplikacja weryfikuje certyfikat serwera w por贸wnaniu do znanej kopii przechowywanej w samej aplikacji. Ta metoda jest niezbdna do zapobiegania atakom MITM. Wdro偶enie SSL Pinning jest zdecydowanie zalecane dla aplikacji obsugujcych wra偶liwe informacje.

#### Inspekcja ruchu

Aby zainstalowa ruch HTTP, konieczne jest **zainstalowanie certyfikatu narzdzia proxy** (np. Burp). Bez zainstalowania tego certyfikatu zaszyfrowany ruch mo偶e by niewidoczny przez proxy. Aby uzyska przewodnik dotyczcy instalacji niestandardowego certyfikatu CA, [**kliknij tutaj**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine).

Aplikacje celujce w **API Level 24 i wy偶ej** wymagaj modyfikacji konfiguracji bezpieczestwa sieci, aby zaakceptowa certyfikat CA proxy. Ten krok jest kluczowy do inspekcji zaszyfrowanego ruchu. Aby uzyska instrukcje dotyczce modyfikacji konfiguracji bezpieczestwa sieci, [**odwoaj si do tego samouczka**](make-apk-accept-ca-certificate.md).

#### Obejcie SSL Pinning

Gdy SSL Pinning jest wdro偶one, konieczne staje si jego obejcie, aby zainspirowa ruch HTTPS. Istnieje wiele metod w tym celu:

* Automatycznie **zmodyfikuj** **apk**, aby **obej** SSLPinning za pomoc [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). Najwiksz zalet tej opcji jest to, 偶e nie bdziesz potrzebowa roota, aby obej SSL Pinning, ale bdziesz musia usun aplikacj i zainstalowa now, co nie zawsze dziaa.
* Mo偶esz u偶y **Frida** (om贸wione poni偶ej), aby obej t ochron. Oto przewodnik, jak u偶ywa Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Mo偶esz r贸wnie偶 spr贸bowa **automatycznie obej SSL Pinning** za pomoc [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Mo偶esz r贸wnie偶 spr贸bowa **automatycznie obej SSL Pinning** za pomoc **analizy dynamicznej MobSF** (wyjanionej poni偶ej)
* Jeli nadal uwa偶asz, 偶e istnieje jaki ruch, kt贸rego nie przechwytujesz, mo偶esz spr贸bowa **przekierowa ruch do burp za pomoc iptables**. Przeczytaj ten blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### Szukanie powszechnych podatnoci w sieci

Wa偶ne jest r贸wnie偶, aby szuka powszechnych podatnoci w sieci w aplikacji. Szczeg贸owe informacje na temat identyfikacji i agodzenia tych podatnoci wykraczaj poza zakres tego podsumowania, ale s szeroko om贸wione w innych miejscach.

### Frida

[Frida](https://www.frida.re) to zestaw narzdzi do dynamicznej instrumentacji dla programist贸w, in偶ynier贸w odwrotnych i badaczy bezpieczestwa.\
**Mo偶esz uzyska dostp do dziaajcej aplikacji i podczy metody w czasie rzeczywistym, aby zmieni zachowanie, zmieni wartoci, wyodrbni wartoci, uruchomi inny kod...**\
Jeli chcesz przeprowadzi pentesting aplikacji Android, musisz wiedzie, jak u偶ywa Frida.

* Naucz si, jak u偶ywa Frida: [**Samouczek Frida**](frida-tutorial/)
* Nieco "GUI" do dziaa z Frida: [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection jest wietny do automatyzacji u偶ycia Frida: [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* Mo偶esz znale藕 kilka niesamowitych skrypt贸w Frida tutaj: [**https://codeshare.frida.re/**](https://codeshare.frida.re)
* Spr贸buj obej mechanizmy anty-debugging / anty-frida, adujc Frida, jak wskazano w [https://erfur.github.io/blog/dev/code-injection-without-ptrace](https://erfur.github.io/blog/dev/code-injection-without-ptrace) (narzdzie [linjector](https://github.com/erfur/linjector-rs))

### **Zrzut pamici - Fridump**

Sprawd藕, czy aplikacja przechowuje wra偶liwe informacje w pamici, kt贸rych nie powinna przechowywa, takie jak hasa lub mnemoniki.

U偶ywajc [**Fridump3**](https://github.com/rootbsd/fridump3), mo偶esz zrzuci pami aplikacji za pomoc:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
To bdzie zrzut pamici w folderze ./dump, a tam mo偶esz u偶y grep z czym takim jak: 

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Wra偶liwe dane w Keystore**

W Androidzie Keystore to najlepsze miejsce do przechowywania wra偶liwych danych, jednak przy wystarczajcych uprawnieniach **mo偶liwe jest ich uzyskanie**. Poniewa偶 aplikacje maj tendencj do przechowywania tutaj **wra偶liwych danych w postaci niezaszyfrowanej**, testy penetracyjne powinny to sprawdzi jako u偶ytkownik root lub kto z fizycznym dostpem do urzdzenia m贸gby by w stanie ukra te dane.

Nawet jeli aplikacja przechowuje dane w keystore, dane powinny by zaszyfrowane.

Aby uzyska dostp do danych wewntrz keystore, mo偶esz u偶y tego skryptu Frida: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Ominicie odcisku palca/biometrii**

U偶ywajc poni偶szego skryptu Frida, mo偶liwe jest **ominicie uwierzytelniania odciskiem palca**, kt贸re aplikacje na Androida mog stosowa w celu **ochrony niekt贸rych wra偶liwych obszar贸w:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Obrazy ta**

Kiedy umieszczasz aplikacj w tle, Android przechowuje **zrzut ekranu aplikacji**, aby po przywr贸ceniu do pierwszego planu zacza adowa obraz przed aplikacj, co sprawia, 偶e wyglda na to, 偶e aplikacja zostaa zaadowana szybciej.

Jednak偶e, jeli ten zrzut ekranu zawiera **wra偶liwe informacje**, kto z dostpem do zrzutu mo偶e **ukra te informacje** (zauwa偶, 偶e potrzebujesz roota, aby uzyska do niego dostp).

Zrzuty ekranu s zazwyczaj przechowywane w: **`/data/system_ce/0/snapshots`**

Android zapewnia spos贸b na **zapobieganie przechwytywaniu zrzut贸w ekranu, ustawiajc parametr ukadu FLAG\_SECURE**. U偶ywajc tej flagi, zawarto okna jest traktowana jako bezpieczna, co zapobiega jej pojawianiu si w zrzutach ekranu lub wywietlaniu na niezabezpieczonych wywietlaczach.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analizator Aplikacji Android**

To narzdzie mo偶e pom贸c w zarzdzaniu r贸偶nymi narzdziami podczas analizy dynamicznej: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Wstrzykiwanie Intencji

Programici czsto tworz komponenty proxy, takie jak aktywnoci, usugi i odbiorniki rozgoszeniowe, kt贸re obsuguj te Intencje i przekazuj je do metod takich jak `startActivity(...)` lub `sendBroadcast(...)`, co mo偶e by ryzykowne.

Niebezpieczestwo polega na umo偶liwieniu atakujcym wywoywania komponent贸w aplikacji, kt贸re nie s eksportowane, lub uzyskiwania dostpu do wra偶liwych dostawc贸w treci poprzez bdne kierowanie tych Intencji. Znaczcym przykadem jest komponent `WebView`, kt贸ry konwertuje adresy URL na obiekty `Intent` za pomoc `Intent.parseUri(...)`, a nastpnie je wykonuje, co mo偶e prowadzi do zoliwych wstrzykni Intencji.

### Kluczowe Wnioski

* **Wstrzykiwanie Intencji** jest podobne do problemu Open Redirect w sieci.
* Wykorzystania polegaj na przekazywaniu obiekt贸w `Intent` jako dodatkowych, kt贸re mog by przekierowywane do wykonywania niebezpiecznych operacji.
* Mo偶e to ujawnia komponenty, kt贸re nie s eksportowane, oraz dostawc贸w treci atakujcym.
* Konwersja URL na `Intent` w `WebView` mo偶e uatwia niezamierzone dziaania.

### Wstrzyknicia po stronie klienta Androida i inne

Prawdopodobnie znasz ten rodzaj podatnoci z sieci. Musisz by szczeg贸lnie ostro偶ny z tymi podatnociami w aplikacji Android:

* **Wstrzykiwanie SQL:** Przy obsudze dynamicznych zapyta lub dostawc贸w treci upewnij si, 偶e u偶ywasz zapyta parametryzowanych.
* **Wstrzykiwanie JavaScript (XSS):** Sprawd藕, czy obsuga JavaScript i wtyczek jest wyczona dla wszelkich WebView (domylnie wyczona). [Wicej informacji tutaj](webview-attacks.md#javascript-enabled).
* **Inkluzja lokalnych plik贸w:** WebView powinny mie wyczony dostp do systemu plik贸w (domylnie wczony) - `(webview.getSettings().setAllowFileAccess(false);)`. [Wicej informacji tutaj](webview-attacks.md#javascript-enabled).
* **Wieczne ciasteczka**: W kilku przypadkach, gdy aplikacja androidowa koczy sesj, ciastko nie jest uniewa偶niane lub mo偶e by nawet zapisywane na dysku.
* [**Bezpieczna flaga** w ciastkach](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Docz do [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hackerami i owcami bd贸w!

**Wgld w Hacking**\
Zaanga偶uj si w treci, kt贸re zagbiaj si w emocje i wyzwania zwizane z hackingiem.

**Aktualnoci Hackingowe w Czasie Rzeczywistym**\
Bd藕 na bie偶co z dynamicznym wiatem hackingu dziki aktualnym wiadomociom i wgldom.

**Najnowsze Ogoszenia**\
Bd藕 informowany o najnowszych nagrodach za bdy oraz istotnych aktualizacjach platformy.

**Docz do nas na** [**Discord**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hackerami ju偶 dzi!

## Analiza Automatyczna

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**Analiza statyczna**

![](<../../.gitbook/assets/image (866).png>)

**Ocena podatnoci aplikacji** przy u偶yciu adnego interfejsu internetowego. Mo偶esz r贸wnie偶 przeprowadzi analiz dynamiczn (ale musisz przygotowa rodowisko).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Zauwa偶, 偶e MobSF mo偶e analizowa **Android**(apk)**, IOS**(ipa) **i Windows**(apx) aplikacje (_Aplikacje Windows musz by analizowane z MobSF zainstalowanym na hocie Windows_).\
Ponadto, jeli stworzysz plik **ZIP** z kodem 藕r贸dowym aplikacji **Android** lub **IOS** (przejd藕 do folderu g贸wnego aplikacji, wybierz wszystko i stw贸rz plik ZIP), r贸wnie偶 bdzie mogo to analizowa.

MobSF pozwala r贸wnie偶 na **diff/Compare** analizy oraz na integracj z **VirusTotal** (bdziesz musia ustawi sw贸j klucz API w _MobSF/settings.py_ i wczy go: `VT_ENABLED = TRUE` `VT_API_KEY = <Tw贸j klucz API>` `VT_UPLOAD = TRUE`). Mo偶esz r贸wnie偶 ustawi `VT_UPLOAD` na `False`, wtedy **hash** zostanie **przesany** zamiast pliku.

### Wspomagana analiza dynamiczna z MobSF

**MobSF** mo偶e by r贸wnie偶 bardzo pomocny w **analizie dynamicznej** w **Android**, ale w tym przypadku bdziesz musia zainstalowa MobSF i **genymotion** na swoim hocie (VM lub Docker nie zadziaa). _Uwaga: Musisz **najpierw uruchomi VM w genymotion** a **potem MobSF.**_\
**MobSF dynamic analyser** mo偶e:

* **Zrzuci dane aplikacji** (URL-e, logi, schowek, zrzuty ekranu wykonane przez Ciebie, zrzuty ekranu wykonane przez "**Exported Activity Tester**", e-maile, bazy danych SQLite, pliki XML i inne utworzone pliki). Wszystko to odbywa si automatycznie, z wyjtkiem zrzut贸w ekranu, musisz nacisn, gdy chcesz zrzut ekranu lub musisz nacisn "**Exported Activity Tester**", aby uzyska zrzuty ekranu wszystkich eksportowanych aktywnoci.
* Przechwytywa **ruch HTTPS**
* U偶ywa **Frida** do uzyskiwania **informacji w czasie rzeczywistym**

Od wersji Android **> 5**, **automatycznie uruchomi Frida** i ustawi globalne ustawienia **proxy** do **przechwytywania** ruchu. Bdzie przechwytywa ruch tylko z testowanej aplikacji.

**Frida**

Domylnie bdzie r贸wnie偶 u偶ywa niekt贸rych skrypt贸w Frida do **obejcia SSL pinning**, **wykrywania root** i **wykrywania debuggera** oraz do **monitorowania interesujcych API**.\
MobSF mo偶e r贸wnie偶 **wywoywa eksportowane aktywnoci**, robi **zrzuty ekranu** z nich i **zapisywa** je do raportu.

Aby **rozpocz** testowanie dynamiczne, nacinij zielony przycisk: "**Start Instrumentation**". Nacinij "**Frida Live Logs**", aby zobaczy logi generowane przez skrypty Frida i "**Live API Monitor**", aby zobaczy wszystkie wywoania do podczonych metod, przekazywane argumenty i zwracane wartoci (to pojawi si po naciniciu "Start Instrumentation").\
MobSF pozwala r贸wnie偶 na zaadowanie wasnych **skrypt贸w Frida** (aby wysa wyniki swoich skrypt贸w Frida do MobSF, u偶yj funkcji `send()`). Ma r贸wnie偶 **kilka wstpnie napisanych skrypt贸w**, kt贸re mo偶esz zaadowa (mo偶esz doda wicej w `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), wystarczy **je wybra**, nacisn "**Load**" i nacisn "**Start Instrumentation**" (bdziesz m贸g zobaczy logi tych skrypt贸w w "**Frida Live Logs**").

![](<../../.gitbook/assets/image (419).png>)

Ponadto masz kilka dodatkowych funkcji Frida:

* **Enumerate Loaded Classes**: Wydrukuje wszystkie zaadowane klasy
* **Capture Strings**: Wydrukuje wszystkie przechwycone cigi podczas korzystania z aplikacji (bardzo haaliwe)
* **Capture String Comparisons**: Mo偶e by bardzo przydatne. Poka偶e **2 por贸wnywane cigi** i czy wynik by prawdziwy czy faszywy.
* **Enumerate Class Methods**: Podaj nazw klasy (np. "java.io.File") i wydrukuje wszystkie metody klasy.
* **Search Class Pattern**: Wyszukaj klasy wedug wzoru
* **Trace Class Methods**: **led藕** **ca klas** (zobacz wejcia i wyjcia wszystkich metod klasy). Pamitaj, 偶e domylnie MobSF ledzi kilka interesujcych metod Android API.

Gdy wybierzesz modu pomocniczy, kt贸ry chcesz u偶y, musisz nacisn "**Start Instrumentation**" i zobaczysz wszystkie wyniki w "**Frida Live Logs**".

**Shell**

Mobsf oferuje r贸wnie偶 powok z niekt贸rymi poleceniami **adb**, **komendami MobSF** i powszechnymi **poleceniami powoki** na dole strony analizy dynamicznej. Niekt贸re interesujce polecenia:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Narzdzia HTTP**

Gdy ruch http jest przechwytywany, mo偶esz zobaczy brzydki widok przechwyconego ruchu na "**HTTP(S) Traffic**" na dole lub adniejszy widok w "**Start HTTPTools**" na zielonym przycisku. Z drugiej opcji mo偶esz **wysa** **przechwycone 偶dania** do **proxy** takich jak Burp lub Owasp ZAP.\
Aby to zrobi, _wcz Burp -->_ _wycz Intercept --> w MobSB HTTPTools wybierz 偶danie_ --> nacinij "**Send to Fuzzer**" --> _wybierz adres proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Gdy zakoczysz analiz dynamiczn z MobSF, mo偶esz nacisn "**Start Web API Fuzzer**", aby **fuzzowa 偶dania http** i szuka luk.

{% hint style="info" %}
Po przeprowadzeniu analizy dynamicznej z MobSF ustawienia proxy mog by 藕le skonfigurowane i nie bdziesz w stanie ich naprawi z GUI. Mo偶esz naprawi ustawienia proxy, wykonujc:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Analiza dynamiczna wspomagana przez Inspeckage

Mo偶esz pobra narzdzie z [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
To narzdzie u偶ywa kilku **Hook贸w**, aby poinformowa Ci **co si dzieje w aplikacji** podczas przeprowadzania **analizy dynamicznej**.

### [Yaazhini](https://www.vegabird.com/yaazhini/)

To **wietne narzdzie do przeprowadzania analizy statycznej z interfejsem graficznym**

![](<../../.gitbook/assets/image (741).png>)

### [Qark](https://github.com/linkedin/qark)

To narzdzie zostao zaprojektowane w celu wyszukiwania kilku **zwizanych z bezpieczestwem podatnoci aplikacji Android**, zar贸wno w **kodzie 藕r贸dowym**, jak i **spakowanych APK**. Narzdzie jest r贸wnie偶 **zdolne do tworzenia "Dowodu Koncepcji" wdra偶alnego APK** oraz **komend ADB**, aby wykorzysta niekt贸re z wykrytych podatnoci (ujawnione aktywnoci, intencje, tapjacking...). Podobnie jak w przypadku Drozer, nie ma potrzeby rootowania urzdzenia testowego.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Wywietla wszystkie wyodrbnione pliki dla atwego odniesienia
* Automatycznie dekompiluje pliki APK do formatu Java i Smali
* Analizuje AndroidManifest.xml pod ktem powszechnych luk i zachowa
* Statyczna analiza kodu 藕r贸dowego pod ktem powszechnych luk i zachowa
* Informacje o urzdzeniu
* i wicej
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER to aplikacja dziaajca w wierszu polece, kt贸ra mo偶e by u偶ywana w systemach Windows, MacOS X i Linux, analizujca pliki _.apk_ w poszukiwaniu luk. Robi to, dekompresujc APK i stosujc szereg regu w celu wykrycia tych luk.

Wszystkie reguy s zgrupowane w pliku `rules.json`, a ka偶da firma lub tester mo偶e stworzy wasne reguy, aby analizowa to, czego potrzebuj.

Pobierz najnowsze pliki binarne z [strony pobierania](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (297).png>)

StaCoAn to **narzdzie wieloplatformowe**, kt贸re wspomaga programist贸w, owc贸w bd贸w i etycznych haker贸w w przeprowadzaniu [analizy statycznej kodu](https://en.wikipedia.org/wiki/Static\_program\_analysis) aplikacji mobilnych.

Koncepcja polega na tym, 偶e przecigasz i upuszczasz plik swojej aplikacji mobilnej (plik .apk lub .ipa) na aplikacj StaCoAn, a ona wygeneruje dla Ciebie wizualny i przenony raport. Mo偶esz dostosowa ustawienia i listy s贸w, aby uzyska spersonalizowane dowiadczenie.

Pobierz [najnowsz wersj](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework to system analizy podatnoci na Androida, kt贸ry pomaga deweloperom lub hakerom znale藕 potencjalne luki w zabezpieczeniach aplikacji na Androida.\
[Wydania dla Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** to narzdzie, kt贸rego g贸wnym celem jest wykrywanie i ostrzeganie u偶ytkownika o potencjalnych zoliwych zachowaniach rozwijanych przez aplikacj na Androida.

Wykrywanie odbywa si za pomoc **analizy statycznej** bajtkodu Dalvik aplikacji, reprezentowanego jako **Smali**, z u偶yciem biblioteki [`androguard`](https://github.com/androguard/androguard).

To narzdzie szuka **typowych zachowa "zych" aplikacji**, takich jak: eksfiltracja identyfikator贸w telekomunikacyjnych, przechwytywanie strumieni audio/wideo, modyfikacja danych PIM, wykonanie dowolnego kodu...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA\_Framework)

![](<../../.gitbook/assets/image (595).png>)

**MARA** to **M**obile **A**pplication **R**everse engineering i **A**nalysis Framework. Jest to narzdzie, kt贸re czy powszechnie u偶ywane narzdzia do in偶ynierii wstecznej i analizy aplikacji mobilnych, aby wspiera testowanie aplikacji mobilnych w kontekcie zagro偶e bezpieczestwa OWASP. Jego celem jest uatwienie tego zadania programistom aplikacji mobilnych i specjalistom ds. bezpieczestwa.

Mo偶e:

* Ekstrahowa kod Java i Smali przy u偶yciu r贸偶nych narzdzi
* Analizowa APK za pomoc: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs\_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Ekstrahowa prywatne informacje z APK przy u偶yciu regex贸w.
* Analizowa Manifest.
* Analizowa znalezione domeny za pomoc: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) i [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Deobfuskowa APK za pomoc [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

Przydatne do wykrywania zoliwego oprogramowania: [https://koodous.com/](https://koodous.com)

## Obfuscating/Deobfuscating code

Zauwa偶, 偶e w zale偶noci od usugi i konfiguracji, kt贸rej u偶ywasz do obfuskacji kodu, sekrety mog by obfuskowane lub nie.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

Z [Wikipedia](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** to narzdzie wiersza polece typu open source, kt贸re zmniejsza, optymalizuje i obfuskowao kod Java. Potrafi optymalizowa kod bajtowy oraz wykrywa i usuwa nieu偶ywane instrukcje. ProGuard jest oprogramowaniem darmowym i jest dystrybuowane na licencji GNU General Public License, wersja 2.

ProGuard jest dystrybuowane jako cz Android SDK i dziaa podczas budowania aplikacji w trybie release.

### [DexGuard](https://www.guardsquare.com/dexguard)

Znajd藕 przewodnik krok po kroku, jak deobfuskowa apk w [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Z tego przewodnika) Ostatnim razem, gdy sprawdzalimy, tryb dziaania Dexguard by:

* zaaduj zas贸b jako InputStream;
* przeka偶 wynik do klasy dziedziczcej z FilterInputStream, aby go odszyfrowa;
* wykonaj kilka bezu偶ytecznych obfuskacji, aby zmarnowa kilka minut czasu odwracajcego;
* przeka偶 odszyfrowany wynik do ZipInputStream, aby uzyska plik DEX;
* w kocu zaaduj wynikowy DEX jako zas贸b, u偶ywajc metody `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard odwraca proces obfuskacji wykonywany przez narzdzia obfuskacyjne Androida. Umo偶liwia to liczne analizy bezpieczestwa, w tym inspekcj kodu i przewidywanie bibliotek.**

Mo偶esz przesa obfuskowane APK na ich platform.

### [Simplify](https://github.com/CalebFenton/simplify)

To **og贸lny deobfuskator androidowy.** Simplify **wirtualnie wykonuje aplikacj**, aby zrozumie jej zachowanie, a nastpnie **stara si zoptymalizowa kod**, aby dziaa identycznie, ale by atwiejszy do zrozumienia dla czowieka. Ka偶dy typ optymalizacji jest prosty i og贸lny, wic nie ma znaczenia, jaki konkretny typ obfuskacji jest u偶ywany.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD dostarcza informacji o **tym, jak stworzono APK**. Identyfikuje wiele **kompilator贸w**, **packer贸w**, **obfuskator贸w** i innych dziwnych rzeczy. To [_PEiD_](https://www.aldeid.com/wiki/PEiD) dla Androida.

### Manual

[Przeczytaj ten samouczek, aby pozna kilka sztuczek na **temat odwracania niestandardowej obfuskacji**](manual-deobfuscation.md)

## Labs

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b to wirtualna maszyna bezpieczestwa Androida oparta na ubuntu-mate, kt贸ra zawiera zbi贸r najnowszych framework贸w, samouczk贸w i laboratori贸w od r贸偶nych geek贸w i badaczy bezpieczestwa do in偶ynierii wstecznej i analizy zoliwego oprogramowania.

## References

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) To wietna lista zasob贸w
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Szybki kurs Androida
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Yet to try

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Docz do [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hackerami i owcami bug贸w!

**Hacking Insights**\
Zaanga偶uj si w treci, kt贸re zagbiaj si w emocje i wyzwania zwizane z hackingiem

**Real-Time Hack News**\
Bd藕 na bie偶co z dynamicznym wiatem hackingu dziki wiadomociom i spostrze偶eniom w czasie rzeczywistym

**Latest Announcements**\
Bd藕 na bie偶co z najnowszymi nagrodami za bdy i istotnymi aktualizacjami platformy

**Docz do nas na** [**Discord**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hackerami ju偶 dzi!

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
