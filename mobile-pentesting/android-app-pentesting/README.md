# Android Applications Pentesting

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

## Android Applications Basics

PreporuÄuje se da zapoÄnete Äitanje ove stranice kako biste saznali o **najvaÅ¾nijim delovima vezanim za Android bezbednost i najopasnijim komponentama u Android aplikaciji**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Ovo je glavni alat koji vam je potreban za povezivanje sa android ureÄ‘ajem (emuliranim ili fiziÄkim).\
**ADB** omoguÄ‡ava kontrolu ureÄ‘aja preko **USB** ili **mreÅ¾e** sa raÄunara. Ova alatka omoguÄ‡ava **kopiranje** fajlova u oba pravca, **instalaciju** i **deinstalaciju** aplikacija, **izvrÅ¡avanje** shell komandi, **pravljenje rezervnih kopija** podataka, **Äitanje** logova, izmeÄ‘u ostalih funkcija.

Pogledajte sledeÄ‡u listu [**ADB Commands**](adb-commands.md) da biste nauÄili kako koristiti adb.

## Smali

Ponekad je zanimljivo **modifikovati kod aplikacije** kako biste pristupili **skrivenim informacijama** (moÅ¾da dobro obfuskovanim lozinkama ili zastavicama). Tada bi moglo biti zanimljivo dekompilirati apk, modifikovati kod i ponovo ga kompajlirati.\
[**U ovom tutorijalu** moÅ¾ete **nauÄiti kako dekompilirati APK, modifikovati Smali kod i ponovo kompajlirati APK** sa novom funkcionalnoÅ¡Ä‡u](smali-changes.md). Ovo moÅ¾e biti veoma korisno kao **alternativa za nekoliko testova tokom dinamiÄke analize** koji Ä‡e biti predstavljeni. Tada, **uvek imajte na umu ovu moguÄ‡nost**.

## Other interesting tricks

* [Spoofing your location in Play Store](spoofing-your-location-in-play-store.md)
* **Download APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/), [https://github.com/kiber-io/apkd](https://github.com/kiber-io/apkd)
* Extract APK from device:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
* Spojite sve delove i osnovne apk-ove sa [APKEditor](https://github.com/REAndroid/APKEditor):
```bash
mkdir splits
adb shell pm path com.android.insecurebankv2 | cut -d ':' -f 2 | xargs -n1 -i adb pull {} splits
java -jar ../APKEditor.jar m -i splits/ -o merged.apk

# after merging, you will need to align and sign the apk, personally, I like to use the uberapksigner
java -jar uber-apk-signer.jar -a merged.apk --allowResign -o merged_signed
```
## Staticka Analiza

Prvo, za analizu APK-a trebate **pogledati Java kod** koristeÄ‡i dekompajler.\
Molimo, [**proÄitajte ovde da biste pronaÅ¡li informacije o razliÄitim dostupnim dekompajlerima**](apk-decompilers.md).

### TraÅ¾enje zanimljivih informacija

Samo gledajuÄ‡i **stringove** APK-a moÅ¾ete traÅ¾iti **lozinke**, **URL-ove** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **api** kljuÄeve, **enkripciju**, **bluetooth uuids**, **tokene** i sve Å¡to je zanimljivo... potraÅ¾ite Äak i **backdoor-e** za izvrÅ¡avanje koda ili backdoor-e za autentifikaciju (hardkodirane admin kredencijale za aplikaciju).

**Firebase**

Obratite posebnu paÅ¾nju na **firebase URL-ove** i proverite da li je loÅ¡e konfigurisano. [ViÅ¡e informacija o tome Å¡ta je Firebase i kako ga iskoristiti ovde.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Osnovno razumevanje aplikacije - Manifest.xml, strings.xml

**IstraÅ¾ivanje \_Manifest.xml**_\*\* i \*\*_**strings.xml**\_\*\* datoteka moÅ¾e otkriti potencijalne sigurnosne ranjivosti\*\*. Ove datoteke se mogu pristupiti koristeÄ‡i dekompajlere ili preimenovanjem ekstenzije APK datoteke u .zip i zatim raspakivanjem.

**Ranjivosti** identifikovane iz **Manifest.xml** ukljuÄuju:

* **Debuggable aplikacije**: Aplikacije postavljene kao debuggable (`debuggable="true"`) u _Manifest.xml_ datoteci predstavljaju rizik jer omoguÄ‡avaju veze koje mogu dovesti do eksploatacije. Za dalju razumevanje kako iskoristiti debuggable aplikacije, pogledajte tutorijal o pronalaÅ¾enju i eksploataciji debuggable aplikacija na ureÄ‘aju.
* **PodeÅ¡avanja rezervne kopije**: Atribut `android:allowBackup="false"` treba eksplicitno postaviti za aplikacije koje se bave osetljivim informacijama kako bi se spreÄile neovlaÅ¡Ä‡ene rezervne kopije podataka putem adb, posebno kada je usb debugging omoguÄ‡en.
* **MreÅ¾na sigurnost**: PrilagoÄ‘ene konfiguracije mreÅ¾ne sigurnosti (`android:networkSecurityConfig="@xml/network_security_config"`) u _res/xml/_ mogu specificirati sigurnosne detalje kao Å¡to su pinovi sertifikata i podeÅ¡avanja HTTP saobraÄ‡aja. Primer je omoguÄ‡avanje HTTP saobraÄ‡aja za odreÄ‘ene domene.
* **Izvezene aktivnosti i servisi**: Identifikacija izvezenih aktivnosti i servisa u manifestu moÅ¾e istaknuti komponente koje bi mogle biti zloupotrebljene. Dalja analiza tokom dinamiÄkog testiranja moÅ¾e otkriti kako iskoristiti ove komponente.
* **Content Providers i FileProviders**: IzloÅ¾eni content provider-i mogli bi omoguÄ‡iti neovlaÅ¡Ä‡en pristup ili modifikaciju podataka. Konfiguracija FileProvider-a takoÄ‘e treba biti paÅ¾ljivo ispitana.
* **Broadcast Receivers i URL sheme**: Ove komponente se mogu iskoristiti za eksploataciju, sa posebnim naglaskom na to kako se URL sheme upravljaju za ranjivosti unosa.
* **SDK verzije**: Atributi `minSdkVersion`, `targetSDKVersion` i `maxSdkVersion` ukazuju na podrÅ¾ane Android verzije, istiÄuÄ‡i vaÅ¾nost ne podrÅ¾avanja zastarelih, ranjivih Android verzija iz sigurnosnih razloga.

Iz **strings.xml** datoteke, osetljive informacije kao Å¡to su API kljuÄevi, prilagoÄ‘ene sheme i druge beleÅ¡ke programera mogu se otkriti, naglaÅ¡avajuÄ‡i potrebu za paÅ¾ljivim pregledom ovih resursa.

### Tapjacking

**Tapjacking** je napad gde se **maliciozna** **aplikacija** pokreÄ‡e i **pozicionira iznad aplikacije Å¾rtve**. Kada vidljivo prikrije aplikaciju Å¾rtve, njen korisniÄki interfejs je dizajniran na naÄin da prevari korisnika da interaguje s njom, dok zapravo prosleÄ‘uje interakciju aplikaciji Å¾rtve.\
U suÅ¡tini, to je **oslepljivanje korisnika da ne zna da zapravo izvrÅ¡ava radnje na aplikaciji Å¾rtve**.

PronaÄ‘ite viÅ¡e informacija u:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Preuzimanje zadataka

**Aktivnost** sa **`launchMode`** postavljenim na **`singleTask` bez definisanog `taskAffinity`** je ranjiva na preuzimanje zadataka. To znaÄi da se **aplikacija** moÅ¾e instalirati i ako se pokrene pre stvarne aplikacije, mogla bi **preuzeti zadatak stvarne aplikacije** (tako da Ä‡e korisnik interagovati sa **malicioznom aplikacijom misleÄ‡i da koristi pravu**).

ViÅ¡e informacija u:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Nesigurno skladiÅ¡tenje podataka

**Interno skladiÅ¡te**

U Androidu, datoteke **smeÅ¡tene** u **interno** skladiÅ¡te su **dizajnirane** da budu **pristupaÄne** iskljuÄivo od strane **aplikacije** koja ih je **napravila**. Ova sigurnosna mera je **sprovedena** od strane Android operativnog sistema i obiÄno je adekvatna za sigurnosne potrebe veÄ‡ine aplikacija. MeÄ‘utim, programeri ponekad koriste reÅ¾ime kao Å¡to su `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE` da **omoguÄ‡e** deljenje datoteka izmeÄ‘u razliÄitih aplikacija. Ipak, ovi reÅ¾imi **ne ograniÄavaju pristup** ovim datotekama od strane drugih aplikacija, ukljuÄujuÄ‡i potencijalno maliciozne.

1. **Staticka analiza:**
* **Osigurajte** da se koriÅ¡Ä‡enje `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE` **paÅ¾ljivo ispita**. Ovi reÅ¾imi **mogu potencijalno izloÅ¾iti** datoteke **neprikladnom ili neovlaÅ¡Ä‡enom pristupu**.
2. **DinamiÄka analiza:**
* **Proverite** **dozvole** postavljene na datotekama koje kreira aplikacija. Konkretno, **proverite** da li su neke datoteke **postavljene da budu Äitljive ili zapisive globalno**. Ovo moÅ¾e predstavljati znaÄajan sigurnosni rizik, jer bi omoguÄ‡ilo **bilo kojoj aplikaciji** instaliranoj na ureÄ‘aju, bez obzira na njen izvor ili nameru, da **Äita ili modifikuje** ove datoteke.

**Eksterno skladiÅ¡te**

Kada se radi o datotekama na **eksternom skladiÅ¡tu**, kao Å¡to su SD kartice, treba preduzeti odreÄ‘ene mere opreza:

1. **PristupaÄnost**:
* Datoteke na eksternom skladiÅ¡tu su **globalno Äitljive i zapisive**. To znaÄi da bilo koja aplikacija ili korisnik moÅ¾e pristupiti ovim datotekama.
2. **Sigurnosne brige**:
* S obzirom na lakoÄ‡u pristupa, savetuje se **da se ne Äuvaju osetljive informacije** na eksternom skladiÅ¡tu.
* Eksterno skladiÅ¡te moÅ¾e biti uklonjeno ili dostupno bilo kojoj aplikaciji, Å¡to ga Äini manje sigurnim.
3. **Rukovanje podacima iz eksternog skladiÅ¡ta**:
* Uvek **izvrÅ¡ite validaciju unosa** na podacima preuzetim iz eksternog skladiÅ¡ta. Ovo je kljuÄno jer su podaci iz nepouzdanog izvora.
* ÄŒuvanje izvrÅ¡nih ili klasa datoteka na eksternom skladiÅ¡tu za dinamiÄko uÄitavanje se snaÅ¾no ne preporuÄuje.
* Ako vaÅ¡a aplikacija mora preuzeti izvrÅ¡ne datoteke iz eksternog skladiÅ¡ta, osigurajte da su ove datoteke **potpisane i kriptografski verifikovane** pre nego Å¡to se dinamiÄki uÄitaju. Ovaj korak je vitalan za odrÅ¾avanje sigurnosne integriteta vaÅ¡e aplikacije.

Eksterno skladiÅ¡te moÅ¾e biti **pristupaÄno** u `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
PoÄevÅ¡i od Android 4.4 (**API 17**), SD kartica ima strukturu direktorijuma koja **ograniÄava pristup aplikaciji na direktorijum koji je specifiÄno za tu aplikaciju**. Ovo spreÄava malicioznu aplikaciju da dobije pristup za Äitanje ili pisanje datoteka druge aplikacije.
{% endhint %}

**Osetljivi podaci pohranjeni u Äistom tekstu**

* **Deljene preferencije**: Android omoguÄ‡ava svakoj aplikaciji da lako saÄuva xml datoteke na putanji `/data/data/<packagename>/shared_prefs/` i ponekad je moguÄ‡e pronaÄ‡i osetljive informacije u Äistom tekstu u toj fascikli.
* **Baze podataka**: Android omoguÄ‡ava svakoj aplikaciji da lako saÄuva sqlite baze podataka na putanji `/data/data/<packagename>/databases/` i ponekad je moguÄ‡e pronaÄ‡i osetljive informacije u Äistom tekstu u toj fascikli.

### Slomljeni TLS

**Prihvati sve sertifikate**

Iz nekog razloga, ponekad programeri prihvataju sve sertifikate Äak i ako, na primer, ime hosta ne odgovara sa linijama koda kao Å¡to je sledeÄ‡a:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
A good way to test this is to try to capture the traffic using some proxy like Burp without authorising Burp CA inside the device. Also, you can generate with Burp a certificate for a different hostname and use it.

### Broken Cryptography

**LoÅ¡i procesi upravljanja kljuÄevima**

Neki programeri Äuvaju osetljive podatke u lokalnoj memoriji i Å¡ifruju ih sa kljuÄem koji je hardkodiran/predvidljiv u kodu. To ne bi trebalo da se radi jer bi neki proces obrnute inÅ¾enjeringa mogao omoguÄ‡iti napadaÄima da izvuku poverljive informacije.

**KoriÅ¡Ä‡enje nesigurnih i/ili zastarelih algoritama**

Programeri ne bi trebali koristiti **zastarele algoritme** za obavljanje **provera** autorizacije, **Äuvanje** ili **slanje** podataka. Neki od ovih algoritama su: RC4, MD4, MD5, SHA1... Ako se **hash** koriste za Äuvanje lozinki, na primer, treba koristiti hash koji je otporan na brute-force sa solju.

### Ostale provere

* PreporuÄuje se da se **obfuskira APK** kako bi se oteÅ¾ao posao obrnute inÅ¾enjeringa napadaÄima.
* Ako je aplikacija osetljiva (kao Å¡to su bankarske aplikacije), treba da izvrÅ¡i **svoje provere da vidi da li je mobilni ureÄ‘aj root-ovan** i da deluje u skladu s tim.
* Ako je aplikacija osetljiva (kao Å¡to su bankarske aplikacije), treba da proveri da li se koristi **emulator**.
* Ako je aplikacija osetljiva (kao Å¡to su bankarske aplikacije), treba da **proveri svoju integritet pre izvrÅ¡avanja** kako bi se uverila da nije modifikovana.
* Koristite [**APKiD**](https://github.com/rednaga/APKiD) da proverite koji je kompajler/paker/obfuskator koriÅ¡Ä‡en za izradu APK-a.

### React Native Application

Read the following page to learn how to easily access javascript code of React applications:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Xamarin Applications

Read the following page to learn how to easily access C# code of a xamarin applications:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Superpacked Applications

According to this [**blog post**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/) superpacked is a Meta algorithm that compress the content of an application into a single file. The blog talks about the possibility of creating an app that decompress these kind of apps... and a faster way which involves to **execute the application and gather the decompressed files from the filesystem.**

### Automated Static Code Analysis

The tool [**mariana-trench**](https://github.com/facebook/mariana-trench) is capable of finding **vulnerabilities** by **scanning** the **code** of the application. This tool contains a series of **known sources** (that indicates to the tool the **places** where the **input** is **controlled by the user**), **sinks** (which indicates to the tool **dangerous** **places** where malicious user input could cause damages) and **rules**. These rules indicates the **combination** of **sources-sinks** that indicates a vulnerability.

With this knowledge, **mariana-trench will review the code and find possible vulnerabilities on it**.

### Secrets leaked

An application may contain secrets (API keys, passwords, hidden urls, subdomains...) inside of it that you might be able to discover. You could us a tool such as [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Bypass Biometric Authentication

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Other interesting functions

* **IzvrÅ¡avanje koda**: `Runtime.exec(), ProcessBuilder(), native code:system()`
* **Slanje SMS-ova**: `sendTextMessage, sendMultipartTestMessage`
* **Nativne funkcije** deklarisane kao `native`: `public native, System.loadLibrary, System.load`
* [Read this to learn **how to reverse native functions**](reversing-native-libraries.md)

### **Other tricks**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

***

## DinamiÄka analiza

> Prvo, potrebna vam je okruÅ¾enje gde moÅ¾ete instalirati aplikaciju i sve potrebne alate (Burp CA cert, Drozer i Frida uglavnom). Stoga, ureÄ‘aj koji je root-ovan (emuliran ili ne) je izuzetno preporuÄen.

### Online dinamiÄka analiza

You can create a **free account** in: [https://appetize.io/](https://appetize.io). This platform allows you to **upload** and **execute** APKs, so it is useful to see how an apk is behaving.

You can even **see the logs of your application** in the web and connect through **adb**.

![](<../../.gitbook/assets/image (831).png>)

Thanks to the ADB connection you can use **Drozer** and **Frida** inside the emulators.

### Lokalna dinamiÄka analiza

#### KoriÅ¡Ä‡enje emulatore

* [**Android Studio**](https://developer.android.com/studio) (MoÅ¾ete kreirati **x86** i **arm** ureÄ‘aje, a prema [**ovim**](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**najnovijim x86** verzijama **podrÅ¾avaju ARM biblioteke** bez potrebe za sporim arm emulatorom).
* Learn to set it up in this page:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Besplatna verzija:** Personal Edition, potrebno je da napravite nalog. _PreporuÄuje se da **preuzmete** verziju **SA**_ _**VirtualBox** kako biste izbegli potencijalne greÅ¡ke._)
* [**Nox**](https://es.bignox.com) (Besplatno, ali ne podrÅ¾ava Frida ili Drozer).

{% hint style="info" %}
When creating a new emulator on any platform remember that the bigger the screen is, the slower the emulator will run. So select small screens if possible.
{% endhint %}

To **install google services** (like AppStore) in Genymotion you need to click on the red marked button of the following image:

![](<../../.gitbook/assets/image (277).png>)

Also, notice that in the **configuration of the Android VM in Genymotion** you can select **Bridge Network mode** (this will be useful if you will be connecting to the Android VM from a different VM with the tools).

#### Koristite fiziÄki ureÄ‘aj

Potrebno je aktivirati **debugging** opcije i bilo bi dobro ako moÅ¾ete **root**-ovati ureÄ‘aj:

1. **PodeÅ¡avanja**.
2. (Od Android 8.0) Izaberite **Sistem**.
3. Izaberite **O telefonu**.
4. Pritisnite **Broj izrade** 7 puta.
5. Vratite se i naÄ‡i Ä‡ete **Opcije za programere**.

> Kada instalirate aplikaciju, prva stvar koju treba da uradite je da je isprobate i istraÅ¾ite Å¡ta radi, kako funkcioniÅ¡e i da se upoznate sa njom.\
> PreporuÄujem da **izvrÅ¡ite ovu inicijalnu dinamiÄku analizu koristeÄ‡i MobSF dinamiÄku analizu + pidcat**, tako da Ä‡emo moÄ‡i da **nauÄimo kako aplikacija funkcioniÅ¡e** dok MobSF **prikuplja** mnogo **zanimljivih** **podataka** koje moÅ¾ete kasnije pregledati.

### Neprikazano curenje podataka

**Logovanje**

Programeri bi trebali biti oprezni da ne izlaÅ¾u **informacije za debagovanje** javno, jer to moÅ¾e dovesti do curenja osetljivih podataka. PreporuÄuju se alati [**pidcat**](https://github.com/JakeWharton/pidcat) i `adb logcat` za praÄ‡enje logova aplikacije kako bi se identifikovale i zaÅ¡titile osetljive informacije. **Pidcat** je omiljen zbog svoje jednostavnosti koriÅ¡Ä‡enja i Äitljivosti.

{% hint style="warning" %}
Note that from **later newer than Android 4.0**, **applications are only able to access their own logs**. So applications cannot access other apps logs.\
Anyway, it's still recommended to **not log sensitive information**.
{% endhint %}

**KeÅ¡iranje Copy/Paste Bufe**

Androidov **okvir zasnovan na clipboard-u** omoguÄ‡ava funkcionalnost kopiranja i lepljenja u aplikacijama, ali predstavlja rizik jer **druge aplikacije** mogu **pristupiti** clipboard-u, potencijalno izlaÅ¾uÄ‡i osetljive podatke. KljuÄno je **onemoguÄ‡iti copy/paste** funkcije za osetljive delove aplikacije, kao Å¡to su podaci o kreditnim karticama, kako bi se spreÄilo curenje podataka.

**Logovi greÅ¡aka**

Ako aplikacija **pukne** i **saÄuva logove**, ovi logovi mogu pomoÄ‡i napadaÄima, posebno kada aplikaciju nije moguÄ‡e obrnuti inÅ¾enjering. Da biste umanjili ovaj rizik, izbegavajte logovanje prilikom greÅ¡aka, a ako logovi moraju biti poslati preko mreÅ¾e, osigurajte da se Å¡alju putem SSL kanala radi sigurnosti.

Kao pentester, **pokuÅ¡ajte da pogledate ove logove**.

**Podaci o analitici poslati treÄ‡im stranama**

Aplikacije Äesto integriÅ¡u usluge poput Google Adsense, Å¡to moÅ¾e nenamerno **curiti osetljive podatke** zbog nepravilne implementacije od strane programera. Da biste identifikovali potencijalna curenja podataka, preporuÄuje se da **presretnete saobraÄ‡aj aplikacije** i proverite da li se Å¡alju osetljive informacije treÄ‡im stranama.

### SQLite DBs

VeÄ‡ina aplikacija Ä‡e koristiti **internu SQLite bazu podataka** za Äuvanje informacija. Tokom pentesta obratite paÅ¾nju na **baze podataka** koje su kreirane, imena **tabela** i **kolona** i sve **podatke** koji su saÄuvani jer biste mogli pronaÄ‡i **osetljive informacije** (Å¡to bi bila ranjivost).\
Baze podataka bi trebale biti locirane u `/data/data/the.package.name/databases` kao `/data/data/com.mwr.example.sieve/databases`.

Ako baza podataka Äuva poverljive informacije i je **Å¡ifrovana**, ali moÅ¾ete **pronaÄ‡i** **lozinku** unutar aplikacije, to je i dalje **ranjivost**.

EnumeriÅ¡ite tabele koristeÄ‡i `.tables` i enumeriÅ¡ite kolone tabela koristeÄ‡i `.schema <table_name>`.

### Drozer (Eksploatacija aktivnosti, provajdera sadrÅ¾aja i usluga)

From [Drozer Docs](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** allows you to **assume the role of an Android app** and interact with other apps. It can do **anything that an installed application can do**, such as make use of Androidâ€™s Inter-Process Communication (IPC) mechanism and interact with the underlying operating system. .\
Drozer is s useful tool to **exploit exported activities, exported services and Content Providers** as you will learn in the following sections.

### Eksploatacija eksportovanih aktivnosti

[**Read this if you want to refresh what is an Android Activity.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Also remember that the code of an activity starts in the **`onCreate`** method.

**ZaobilaÅ¾enje autorizacije**

Kada je aktivnost eksportovana, moÅ¾ete pozvati njen ekran iz spoljne aplikacije. Stoga, ako je aktivnost sa **osetljivim informacijama** **eksportovana**, mogli biste **zaobiÄ‡i** **mehanizme** **autentifikacije** **da biste joj pristupili.**

[**Learn how to exploit exported activities with Drozer.**](drozer-tutorial/#activities)

You can also start an exported activity from adb:

* PackageName is com.example.demo
* Exported ActivityName is com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NAPOMENA**: MobSF Ä‡e detektovati kao malicioznu upotrebu _**singleTask/singleInstance**_ kao `android:launchMode` u aktivnosti, ali zbog [ovoga](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), oÄigledno je da je ovo opasno samo na starim verzijama (API verzije < 21).

{% hint style="info" %}
Imajte na umu da zaobilaÅ¾enje autorizacije nije uvek ranjivost, to zavisi od naÄina na koji zaobilaÅ¾enje funkcioniÅ¡e i koje informacije su izloÅ¾ene.
{% endhint %}

**Curjenje osetljivih informacija**

**Aktivnosti takoÄ‘e mogu vraÄ‡ati rezultate**. Ako uspete da pronaÄ‘ete izvezenu i nezaÅ¡tiÄ‡enu aktivnost koja poziva **`setResult`** metodu i **vraÄ‡a osetljive informacije**, dolazi do curenja osetljivih informacija.

#### Tapjacking

Ako tapjacking nije spreÄen, mogli biste zloupotrebiti izvezenu aktivnost da naterate **korisnika da izvrÅ¡i neoÄekivane radnje**. Za viÅ¡e informacija o [**Å¡ta je Tapjacking pratite link**](./#tapjacking).

### Eksploatacija Content Providers - Pristup i manipulacija osetljivim informacijama

[**ProÄitajte ovo ako Å¾elite da osveÅ¾ite Å¡ta je Content Provider.**](android-applications-basics.md#content-provider)\
Content providers se osnovno koriste za **deljenje podataka**. Ako aplikacija ima dostupne content providers, moÅ¾da Ä‡ete moÄ‡i da **izvuÄete osetljive** podatke iz njih. TakoÄ‘e je zanimljivo testirati moguÄ‡e **SQL injekcije** i **Path Traversals** jer bi mogli biti ranjivi.

[**Saznajte kako da eksploatiÅ¡ete Content Providers sa Drozer-om.**](drozer-tutorial/#content-providers)

### **Eksploatacija Servisa**

[**ProÄitajte ovo ako Å¾elite da osveÅ¾ite Å¡ta je Service.**](android-applications-basics.md#services)\
Zapamtite da akcije Servisa poÄinju u metodi `onStartCommand`.

Servis je osnovno neÅ¡to Å¡to **moÅ¾e primati podatke**, **obraÄ‘ivati** ih i **vraÄ‡ati** (ili ne) odgovor. Dakle, ako aplikacija izlaÅ¾e neke servise, trebali biste **proveriti** **kod** da biste razumeli Å¡ta radi i **testirati** ga **dinamiÄki** za izvlaÄenje poverljivih informacija, zaobilaÅ¾enje mera autentifikacije...\
[**Saznajte kako da eksploatiÅ¡ete Servise sa Drozer-om.**](drozer-tutorial/#services)

### **Eksploatacija Broadcast Receivers**

[**ProÄitajte ovo ako Å¾elite da osveÅ¾ite Å¡ta je Broadcast Receiver.**](android-applications-basics.md#broadcast-receivers)\
Zapamtite da akcije Broadcast Receiver-a poÄinju u metodi `onReceive`.

Broadcast receiver Ä‡e Äekati na odreÄ‘enu vrstu poruke. U zavisnosti od toga kako receiver obraÄ‘uje poruku, mogao bi biti ranjiv.\
[**Saznajte kako da eksploatiÅ¡ete Broadcast Receivers sa Drozer-om.**](./#exploiting-broadcast-receivers)

### **Eksploatacija Schemes / Deep links**

MoÅ¾ete ruÄno traÅ¾iti deep links, koristeÄ‡i alate kao Å¡to je MobSF ili skripte poput [ove](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
MoÅ¾ete **otvoriti** deklarisani **scheme** koristeÄ‡i **adb** ili **pregledaÄ**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Napomena da moÅ¾ete **izostaviti ime paketa** i mobilni ureÄ‘aj Ä‡e automatski pozvati aplikaciju koja treba da otvori tu vezu._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**IzvrÅ¡eni kod**

Da biste pronaÅ¡li **kod koji Ä‡e biti izvrÅ¡en u aplikaciji**, idite na aktivnost koju poziva deeplink i potraÅ¾ite funkciju **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Osetljive informacije**

Svaki put kada pronaÄ‘ete deep link, proverite da **ne prima osetljive podatke (kao Å¡to su lozinke) putem URL parametara**, jer bi bilo koja druga aplikacija mogla **da se pretvara da je deep link i ukrade te podatke!**

**Parametri u putanji**

Trebalo bi da **proverite i da li neki deep link koristi parametar unutar putanje** URL-a kao Å¡to je: `https://api.example.com/v1/users/{username}`, u tom sluÄaju moÅ¾ete primorati putanju da preÄ‘e na neÅ¡to poput: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Imajte na umu da ako pronaÄ‘ete ispravne krajnje taÄke unutar aplikacije, moÅ¾da Ä‡ete moÄ‡i da izazovete **Open Redirect** (ako je deo putanje koriÅ¡Ä‡en kao naziv domena), **preuzimanje naloga** (ako moÅ¾ete da modifikujete podatke o korisnicima bez CSRF tokena i ranjiva krajnja taÄka koristi ispravnu metodu) i bilo koju drugu ranjivost. ViÅ¡e [informacija o ovome ovde](http://dphoeniixx.com/2020/12/13-2/).

**JoÅ¡ primera**

Jedan [zanimljiv izveÅ¡taj o bug bounty](https://hackerone.com/reports/855618) o linkovima (_/.well-known/assetlinks.json_).

### Neuspeh inspekcije i verifikacije transportnog sloja

* **Sertifikati se ne proveravaju uvek pravilno** od strane Android aplikacija. UobiÄajeno je da ove aplikacije zanemaruju upozorenja i prihvataju samopotpisane sertifikate ili, u nekim sluÄajevima, vraÄ‡aju se na koriÅ¡Ä‡enje HTTP veza.
* **Pregovori tokom SSL/TLS rukovanja su ponekad slabi**, koristeÄ‡i nesigurne kriptografske suite. Ova ranjivost Äini vezu podloÅ¾nom napadima Äoveka u sredini (MITM), omoguÄ‡avajuÄ‡i napadaÄima da dekriptuju podatke.
* **Curjenje privatnih informacija** je rizik kada aplikacije autentifikuju koristeÄ‡i sigurne kanale, ali zatim komuniciraju preko nesigurnih kanala za druge transakcije. Ovaj pristup ne Å¡titi osetljive podatke, kao Å¡to su sesijski kolaÄiÄ‡i ili podaci o korisnicima, od presretanja od strane zlonamernih entiteta.

#### Verifikacija sertifikata

FokusiraÄ‡emo se na **verifikaciju sertifikata**. Integritet sertifikata servera mora biti verifikovan kako bi se poboljÅ¡ala sigurnost. Ovo je kljuÄno jer nesigurne TLS konfiguracije i prenos osetljivih podataka preko nekriptovanih kanala mogu predstavljati znaÄajne rizike. Za detaljne korake o verifikaciji sertifikata servera i reÅ¡avanju ranjivosti, [**ovaj resurs**](https://manifestsecurity.com/android-application-security-part-10/) pruÅ¾a sveobuhvatne smernice.

#### SSL Pinning

SSL Pinning je mera sigurnosti gde aplikacija proverava sertifikat servera u odnosu na poznatu kopiju smeÅ¡tenu unutar same aplikacije. Ova metoda je kljuÄna za spreÄavanje MITM napada. Implementacija SSL Pinning-a se snaÅ¾no preporuÄuje za aplikacije koje obraÄ‘uju osetljive informacije.

#### Inspekcija saobraÄ‡aja

Da biste inspekciju HTTP saobraÄ‡aja, potrebno je **instalirati sertifikat alata za proxy** (npr. Burp). Bez instalacije ovog sertifikata, kriptovani saobraÄ‡aj moÅ¾da neÄ‡e biti vidljiv kroz proxy. Za vodiÄ o instalaciji prilagoÄ‘enog CA sertifikata, [**kliknite ovde**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine).

Aplikacije koje ciljaju **API nivo 24 i viÅ¡e** zahtevaju izmene u Network Security Config-u kako bi prihvatile CA sertifikat proxy-a. Ovaj korak je kljuÄan za inspekciju kriptovanog saobraÄ‡aja. Za uputstva o izmeni Network Security Config-a, [**pogledajte ovaj tutorijal**](make-apk-accept-ca-certificate.md).

#### ObilaÅ¾enje SSL Pinning-a

Kada je SSL Pinning implementiran, obilaÅ¾enje postaje neophodno za inspekciju HTTPS saobraÄ‡aja. RazliÄite metode su dostupne za ovu svrhu:

* Automatski **modifikujte** **apk** da **obidjete** SSLPinning koristeÄ‡i [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). NajveÄ‡a prednost ove opcije je Å¡to vam neÄ‡e biti potreban root da obidjete SSL Pinning, ali Ä‡ete morati da obriÅ¡ete aplikaciju i ponovo instalirate novu, a to neÄ‡e uvek funkcionisati.
* MoÅ¾ete koristiti **Frida** (o kojoj se govori u nastavku) da obidjete ovu zaÅ¡titu. Ovde imate vodiÄ za koriÅ¡Ä‡enje Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* TakoÄ‘e moÅ¾ete pokuÅ¡ati da **automatski obidjete SSL Pinning** koristeÄ‡i [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* TakoÄ‘e moÅ¾ete pokuÅ¡ati da **automatski obidjete SSL Pinning** koristeÄ‡i **MobSF dinamiÄku analizu** (objaÅ¡njeno u nastavku)
* Ako i dalje mislite da postoji neki saobraÄ‡aj koji ne presreÄ‡ete, moÅ¾ete pokuÅ¡ati da **prosledite saobraÄ‡aj do burp-a koristeÄ‡i iptables**. ProÄitajte ovaj blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### TraÅ¾enje uobiÄajenih web ranjivosti

VaÅ¾no je takoÄ‘e traÅ¾iti uobiÄajene web ranjivosti unutar aplikacije. Detaljne informacije o identifikaciji i ublaÅ¾avanju ovih ranjivosti su van okvira ovog saÅ¾etka, ali su opÅ¡irno pokrivene drugde.

### Frida

[Frida](https://www.frida.re) je alat za dinamiÄku instrumentaciju za programere, inÅ¾enjere obrnutog inÅ¾enjeringa i istraÅ¾ivaÄe bezbednosti.\
**MoÅ¾ete pristupiti pokrenutim aplikacijama i povezati metode u vreme izvoÄ‘enja da promenite ponaÅ¡anje, promenite vrednosti, izvuÄete vrednosti, pokrenete razliÄit kod...**\
Ako Å¾elite da radite pentesting Android aplikacija, morate znati kako koristiti Frida.

* NauÄite kako koristiti Frida: [**Frida tutorijal**](frida-tutorial/)
* Neki "GUI" za akcije sa Frida: [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection je odliÄan za automatizaciju koriÅ¡Ä‡enja Frida: [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* MoÅ¾ete pronaÄ‡i neke sjajne Frida skripte ovde: [**https://codeshare.frida.re/**](https://codeshare.frida.re)
* PokuÅ¡ajte da obidjete mehanizme protiv debagovanja / anti-frida uÄitavanjem Frida kao Å¡to je naznaÄeno u [https://erfur.github.io/blog/dev/code-injection-without-ptrace](https://erfur.github.io/blog/dev/code-injection-without-ptrace) (alat [linjector](https://github.com/erfur/linjector-rs))

### **Dump Memorija - Fridump**

Proverite da li aplikacija Äuva osetljive informacije unutar memorije koje ne bi trebala da Äuva, kao Å¡to su lozinke ili mnemoniÄke fraze.

KoriÅ¡Ä‡enjem [**Fridump3**](https://github.com/rootbsd/fridump3) moÅ¾ete dumpovati memoriju aplikacije sa:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Ovo Ä‡e isprazniti memoriju u ./dump folder, i tamo moÅ¾ete pretraÅ¾ivati sa neÄim poput: 

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Osetljivi podaci u Keystore-u**

U Androidu, Keystore je najbolje mesto za Äuvanje osetljivih podataka, meÄ‘utim, uz dovoljno privilegija, joÅ¡ uvek je **moguÄ‡e pristupiti mu**. Kako aplikacije obiÄno Äuvaju **osetljive podatke u Äistom tekstu**, pentestovi bi trebali proveriti to kao root korisnik ili neko ko ima fiziÄki pristup ureÄ‘aju mogao bi biti u moguÄ‡nosti da ukrade ove podatke.

ÄŒak i ako aplikacija Äuva podatke u keystore-u, podaci bi trebali biti enkriptovani.

Da biste pristupili podacima unutar keystore-a, moÅ¾ete koristiti ovaj Frida skript: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **ZaobilaÅ¾enje otiska prsta/bio-metrike**

KoriÅ¡Ä‡enjem sledeÄ‡eg Frida skripta moÅ¾e biti moguÄ‡e **zaobiÄ‡i autentifikaciju otiskom prsta** koju Android aplikacije mogu izvoditi kako bi **zaÅ¡titile odreÄ‘ena osetljiva podruÄja:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Pozadine Slike**

Kada stavite aplikaciju u pozadinu, Android Äuva **snimak aplikacije** tako da kada se vrati u fokus, poÄinje da uÄitava sliku pre aplikacije, tako da izgleda kao da je aplikacija uÄitana brÅ¾e.

MeÄ‘utim, ako ovaj snimak sadrÅ¾i **osetljive informacije**, neko ko ima pristup snimku moÅ¾e **ukrasti te informacije** (napomena: potrebno je imati root pristup da biste mu pristupili).

Snimci se obiÄno Äuvaju na: **`/data/system_ce/0/snapshots`**

Android pruÅ¾a naÄin da se **spreÄi snimanje ekrana postavljanjem FLAG\_SECURE** parametra rasporeda. KoriÅ¡Ä‡enjem ove oznake, sadrÅ¾aj prozora se tretira kao siguran, spreÄavajuÄ‡i da se pojavi na snimcima ekrana ili da se vidi na nesigurnim ekranima.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Android Application Analyzer**

Ovaj alat moÅ¾e pomoÄ‡i u upravljanju razliÄitim alatima tokom dinamiÄke analize: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Intent Injection

Programeri Äesto kreiraju proxy komponente kao Å¡to su aktivnosti, servisi i prijemnici emitovanja koji obraÄ‘uju ove Intente i prosleÄ‘uju ih metodama kao Å¡to su `startActivity(...)` ili `sendBroadcast(...)`, Å¡to moÅ¾e biti riziÄno.

Opasnost leÅ¾i u omoguÄ‡avanju napadaÄima da aktiviraju neizvezene komponente aplikacije ili pristupe osetljivim provajderima sadrÅ¾aja preusmeravanjem ovih Intenta. ZnaÄajan primer je `WebView` komponenta koja konvertuje URL-ove u `Intent` objekte putem `Intent.parseUri(...)` i zatim ih izvrÅ¡ava, Å¡to moÅ¾e dovesti do zlonamernih Intent injekcija.

### Essential Takeaways

* **Intent Injection** je sliÄan problemu Open Redirect na webu.
* Eksploati ukljuÄuju prosleÄ‘ivanje `Intent` objekata kao dodataka, koji mogu biti preusmereni da izvrÅ¡e nesigurne operacije.
* MoÅ¾e izloÅ¾iti neizvezene komponente i provajdere sadrÅ¾aja napadaÄima.
* Konverzija URL-a u `Intent` u `WebView` moÅ¾e olakÅ¡ati nepredviÄ‘ene radnje.

### Android Client Side Injections and others

Verovatno znate o ovim vrstama ranjivosti sa weba. Morate biti posebno oprezni sa ovim ranjivostima u Android aplikaciji:

* **SQL Injection:** Kada se bavite dinamiÄkim upitima ili Content-Providers, osigurajte da koristite parametarske upite.
* **JavaScript Injection (XSS):** Proverite da li je podrÅ¡ka za JavaScript i Plugin onemoguÄ‡ena za bilo koje WebViews (onemoguÄ‡ena po defaultu). [ViÅ¡e informacija ovde](webview-attacks.md#javascript-enabled).
* **Local File Inclusion:** WebViews bi trebale imati onemoguÄ‡en pristup sistemu datoteka (omoguÄ‡en po defaultu) - `(webview.getSettings().setAllowFileAccess(false);)`. [ViÅ¡e informacija ovde](webview-attacks.md#javascript-enabled).
* **Eternal cookies**: U nekoliko sluÄajeva kada Android aplikacija zavrÅ¡i sesiju, kolaÄiÄ‡ nije opozvan ili moÅ¾e Äak biti saÄuvan na disku.
* [**Secure Flag** u kolaÄiÄ‡ima](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru da komunicirate sa iskusnim hakerima i lovcima na greÅ¡ke!

**Hacking Insights**\
UkljuÄite se u sadrÅ¾aj koji se bavi uzbuÄ‘enjem i izazovima hakovanja.

**Real-Time Hack News**\
Budite u toku sa brzim svetom hakovanja kroz vesti i uvide u realnom vremenu.

**Latest Announcements**\
Budite informisani o najnovijim nagradama za greÅ¡ke i vaÅ¾nim aÅ¾uriranjima platforme.

**PridruÅ¾ite nam se na** [**Discord**](https://discord.com/invite/N3FrSbmwdy) i poÄnite da saraÄ‘ujete sa vrhunskim hakerima danas!

## Automatic Analysis

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**Static analysis**

![](<../../.gitbook/assets/image (866).png>)

**Procena ranjivosti aplikacije** koristeÄ‡i lep web-baziran frontend. TakoÄ‘e moÅ¾ete izvrÅ¡iti dinamiÄku analizu (ali morate pripremiti okruÅ¾enje).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Notice that MobSF can analyse **Android**(apk)**, IOS**(ipa) **and Windows**(apx) applications (_Windows aplikacije moraju biti analizirane sa MobSF instaliranim na Windows hostu_).\
Also, if you create a **ZIP** file with the source code if an **Android** or an **IOS** app (go to the root folder of the application, select everything and create a ZIPfile), it will be able to analyse it also.

MobSF also allows you to **diff/Compare** analysis and to integrate **VirusTotal** (you will need to set your API key in _MobSF/settings.py_ and enable it: `VT_ENABLED = TRUE` `VT_API_KEY = <Your API key>` `VT_UPLOAD = TRUE`). You can also set `VT_UPLOAD` to `False`, then the **hash** will be **upload** instead of the file.

### Assisted Dynamic analysis with MobSF

**MobSF** can also be very helpful for **dynamic analysis** in **Android**, but in that case you will need to install MobSF and **genymotion** in your host (a VM or Docker won't work). _Napomena: Prvo treba da **pokrenete VM u genymotion** i **onda MobSF.**_\
The **MobSF dynamic analyser** can:

* **Dump application data** (URLs, logs, clipboard, screenshots made by you, screenshots made by "**Exported Activity Tester**", emails, SQLite databases, XML files, and other created files). All of this is done automatically except for the screenshots, you need to press when you want a screenshot or you need to press "**Exported Activity Tester**" to obtain screenshots of all the exported activities.
* Capture **HTTPS traffic**
* Use **Frida** to obtain **runtime** **information**

From android **versions > 5**, it will **automatically start Frida** and will set global **proxy** settings to **capture** traffic. It will only capture traffic from the tested application.

**Frida**

By default, it will also use some Frida Scripts to **bypass SSL pinning**, **root detection** and **debugger detection** and to **monitor interesting APIs**.\
MobSF can also **invoke exported activities**, grab **screenshots** of them and **save** them for the report.

To **start** the dynamic testing press the green bottom: "**Start Instrumentation**". Press the "**Frida Live Logs**" to see the logs generated by the Frida scripts and "**Live API Monitor**" to see all the invocation to hooked methods, arguments passed and returned values (this will appear after pressing "Start Instrumentation").\
MobSF also allows you to load your own **Frida scripts** (to send the results of your Friday scripts to MobSF use the function `send()`). It also has **several pre-written scripts** you can load (you can add more in `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), just **select them**, press "**Load**" and press "**Start Instrumentation**" (you will be able to see the logs of that scripts inside "**Frida Live Logs**").

![](<../../.gitbook/assets/image (419).png>)

Moreover, you have some Auxiliary Frida functionalities:

* **Enumerate Loaded Classes**: It will print all the loaded classes
* **Capture Strings**: It will print all the capture strings while using the application (super noisy)
* **Capture String Comparisons**: Could be very useful. It will **show the 2 strings being compared** and if the result was True or False.
* **Enumerate Class Methods**: Put the class name (like "java.io.File") and it will print all the methods of the class.
* **Search Class Pattern**: Search classes by pattern
* **Trace Class Methods**: **Trace** a **whole class** (see inputs and outputs of all methods of th class). Remember that by default MobSF traces several interesting Android Api methods.

Once you have selected the auxiliary module you want to use you need to press "**Start Intrumentation**" and you will see all the outputs in "**Frida Live Logs**".

**Shell**

Mobsf also brings you a shell with some **adb** commands, **MobSF commands**, and common **shell** **commands** at the bottom of the dynamic analysis page. Some interesting commands:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**HTTP alati**

Kada se http saobraÄ‡aj uhvati, moÅ¾ete videti ruÅ¾an prikaz uhvaÄ‡enog saobraÄ‡aja na "**HTTP(S) SaobraÄ‡aj**" donjem delu ili lepÅ¡i prikaz u "**Start HTTPTools**" zelenom dugmetu. Iz druge opcije, moÅ¾ete **poslati** **uhvaÄ‡ene zahteve** na **proksije** kao Å¡to su Burp ili Owasp ZAP.\
Da biste to uradili, _ukljuÄite Burp -->_ _iskljuÄite Intercept --> u MobSB HTTPTools izaberite zahtev_ --> pritisnite "**Send to Fuzzer**" --> _izaberite adresu proksija_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Kada zavrÅ¡ite dinamiÄku analizu sa MobSF, moÅ¾ete pritisnuti na "**Start Web API Fuzzer**" da **fuzz-ujete http zahteve** i traÅ¾ite ranjivosti.

{% hint style="info" %}
Nakon izvoÄ‘enja dinamiÄke analize sa MobSF, podeÅ¡avanja proksija mogu biti pogreÅ¡no konfigurisana i neÄ‡ete moÄ‡i da ih popravite iz GUI-a. MoÅ¾ete popraviti podeÅ¡avanja proksija tako Å¡to Ä‡ete:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Assisted Dynamic Analysis with Inspeckage

MoÅ¾ete preuzeti alat sa [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Ovaj alat koristi neke **Hooks** da vam omoguÄ‡i **da znate Å¡ta se deÅ¡ava u aplikaciji** dok vrÅ¡ite **dinamiÄku analizu**.

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Ovo je **sjajan alat za izvoÄ‘enje statiÄke analize sa GUI-jem**

![](<../../.gitbook/assets/image (741).png>)

### [Qark](https://github.com/linkedin/qark)

Ovaj alat je dizajniran da traÅ¾i nekoliko **ranjivosti vezanih za sigurnost Android aplikacija**, bilo u **izvor kodu** ili **pakovanim APK-ima**. Alat je takoÄ‘e **sposoban da kreira "Proof-of-Concept" deployable APK** i **ADB komande**, da iskoristi neke od pronaÄ‘enih ranjivosti (IzloÅ¾ene aktivnosti, intencije, tapjacking...). Kao i sa Drozer-om, nije potrebno root-ovati test ureÄ‘aj.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Prikazuje sve ekstrahovane datoteke radi lakÅ¡eg referenciranja
* Automatski dekompajlira APK datoteke u Java i Smali format
* Analizira AndroidManifest.xml za uobiÄajene ranjivosti i ponaÅ¡anje
* Staticka analiza izvornog koda za uobiÄajene ranjivosti i ponaÅ¡anje
* Informacije o ureÄ‘aju
* i joÅ¡ mnogo toga
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER je aplikacija za komandnu liniju koja se moÅ¾e koristiti na Windows, MacOS X i Linux, koja analizira _.apk_ datoteke u potrazi za ranjivostima. To radi dekompresovanjem APK-ova i primenom niza pravila za otkrivanje tih ranjivosti.

Sva pravila su centrirana u `rules.json` datoteci, a svaka kompanija ili tester moÅ¾e kreirati svoja pravila za analizu onoga Å¡to im je potrebno.

Preuzmite najnovije binarne datoteke sa [stranice za preuzimanje](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (297).png>)

StaCoAn je **crossplatform** alat koji pomaÅ¾e programerima, lovcima na greÅ¡ke i etiÄkim hakerima u izvoÄ‘enju [static code analysis](https://en.wikipedia.org/wiki/Static\_program\_analysis) na mobilnim aplikacijama.

Koncept je da prevuÄete i ispustite datoteku vaÅ¡e mobilne aplikacije (datoteka .apk ili .ipa) na StaCoAn aplikaciju i ona Ä‡e generisati vizuelni i prenosivi izveÅ¡taj za vas. MoÅ¾ete prilagoditi postavke i liste reÄi kako biste dobili prilagoÄ‘eno iskustvo.

Preuzmite [najnovije izdanje](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework je sistem za analizu ranjivosti na Androidu koji pomaÅ¾e programerima ili hakerima da pronaÄ‘u potencijalne sigurnosne ranjivosti u Android aplikacijama.\
[Windows izdanja](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** je alat Äija je glavna svrha da detektuje i upozori korisnika na potencijalno zloÄ‡udno ponaÅ¡anje koje razvija Android aplikacija.

Detekcija se vrÅ¡i **statistiÄkom analizom** Dalvik bytecode-a aplikacije, predstavljenog kao **Smali**, uz pomoÄ‡ biblioteke [`androguard`](https://github.com/androguard/androguard).

Ovaj alat traÅ¾i **uobiÄajeno ponaÅ¡anje "loÅ¡ih" aplikacija** kao Å¡to su: Ekstrakcija telekomunikacionih identifikatora, presretanje audio/video toka, modifikacija PIM podataka, izvrÅ¡avanje proizvoljnog koda...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA\_Framework)

![](<../../.gitbook/assets/image (595).png>)

**MARA** je **M**obila **A**plikacija **R**everzno inÅ¾enjerstvo i **A**naliza Framework. To je alat koji okuplja Äesto koriÅ¡Ä‡ene alate za reverzno inÅ¾enjerstvo i analizu mobilnih aplikacija, kako bi pomogao u testiranju mobilnih aplikacija protiv OWASP mobilnih bezbednosnih pretnji. Njegov cilj je da olakÅ¡a ovaj zadatak i uÄini ga prijatnijim za programere mobilnih aplikacija i struÄnjake za bezbednost.

MoÅ¾e da:

* IzvlaÄi Java i Smali kod koristeÄ‡i razliÄite alate
* Analizira APK-ove koristeÄ‡i: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs\_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* IzvlaÄi privatne informacije iz APK-a koristeÄ‡i regex.
* Analizira Manifest.
* Analizira pronaÄ‘ene domene koristeÄ‡i: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) i [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Deobfuskira APK putem [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

Koristan za otkrivanje malvera: [https://koodous.com/](https://koodous.com)

## Obfuskacija/Deobfuskacija koda

Imajte na umu da zavisno od usluge i konfiguracije koju koristite za obfuskaciju koda. Tajne mogu ili ne moraju biti obfuskirane.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

Sa [Wikipedia](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** je open source alat za komandnu liniju koji smanjuje, optimizuje i obfuskira Java kod. U stanju je da optimizuje bajtkod kao i da detektuje i ukloni neiskoriÅ¡Ä‡ene instrukcije. ProGuard je besplatan softver i distribuira se pod GNU General Public License, verzija 2.

ProGuard se distribuira kao deo Android SDK-a i pokreÄ‡e se prilikom izgradnje aplikacije u reÅ¾imu objavljivanja.

### [DexGuard](https://www.guardsquare.com/dexguard)

PronaÄ‘ite vodiÄ korak po korak za deobfuskaciju apk-a na [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Prema tom vodiÄu) Poslednji put kada smo proveravali, Dexguard naÄin rada je bio:

* uÄitati resurs kao InputStream;
* proslediti rezultat klasi koja nasleÄ‘uje FilterInputStream da bi ga dekriptovali;
* uraditi neku beskorisnu obfuskaciju da bi se izgubilo nekoliko minuta vremena od reverzera;
* proslediti dekriptovani rezultat ZipInputStream-u da bi dobili DEX datoteku;
* konaÄno uÄitati dobijeni DEX kao Resurs koristeÄ‡i metodu `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard preokreÄ‡e proces obfuskacije koji izvode Android alati za obfuskaciju. Ovo omoguÄ‡ava brojne analize bezbednosti, ukljuÄujuÄ‡i inspekciju koda i predikciju biblioteka.**

MoÅ¾ete da otpremite obfuskovani APK na njihovu platformu.

### [Simplify](https://github.com/CalebFenton/simplify)

To je **generiÄki android deobfuskator.** Simplify **virtuelno izvrÅ¡ava aplikaciju** da bi razumeo njeno ponaÅ¡anje i zatim **pokuÅ¡ava da optimizuje kod** tako da se ponaÅ¡a identiÄno, ali je lakÅ¡e za razumevanje ljudima. Svaka vrsta optimizacije je jednostavna i generiÄka, tako da nije vaÅ¾no koja specifiÄna vrsta obfuskacije se koristi.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD vam daje informacije o **kako je APK napravljen**. Identifikuje mnoge **kompilatore**, **pakere**, **obfuskatore** i druge Äudne stvari. To je [_PEiD_](https://www.aldeid.com/wiki/PEiD) za Android.

### Manual

[ProÄitajte ovaj tutorijal da nauÄite neke trikove o **kako da reverzujete prilagoÄ‘enu obfuskaciju**](manual-deobfuscation.md)

## Labs

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b je Android bezbednosna virtuelna maÅ¡ina zasnovana na ubuntu-mate koja ukljuÄuje kolekciju najnovijih framework-a, tutorijala i labova od razliÄitih bezbednosnih entuzijasta i istraÅ¾ivaÄa za reverzno inÅ¾enjerstvo i analizu malvera.

## References

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) To je odliÄna lista resursa
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Brzi kurs o Androidu
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Yet to try

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
