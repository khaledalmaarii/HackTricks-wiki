# Pentesting des Applications Android

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Rejoignez le [**serveur Discord HackenProof**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de bugs !

**Aper√ßus du Hacking**\
Engagez-vous avec du contenu qui explore le frisson et les d√©fis du hacking

**Actualit√©s de Hacking en Temps R√©el**\
Restez √† jour avec le monde du hacking en rapide √©volution gr√¢ce √† des nouvelles et des aper√ßus en temps r√©el

**Derni√®res Annonces**\
Restez inform√© des nouveaux programmes de bug bounty lanc√©s et des mises √† jour cruciales des plateformes

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

## Bases des Applications Android

Il est fortement recommand√© de commencer par lire cette page pour conna√Ætre les **parties les plus importantes li√©es √† la s√©curit√© Android et les composants les plus dangereux d'une application Android** :

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

C'est l'outil principal dont vous avez besoin pour vous connecter √† un appareil android (√©mul√© ou physique).\
**ADB** permet de contr√¥ler les appareils soit par **USB** soit par **r√©seau** depuis un ordinateur. Cet utilitaire permet le **copie** de fichiers dans les deux sens, **installation** et **d√©sinstallation** d'applications, **ex√©cution** de commandes shell, **sauvegarde** de donn√©es, **lecture** de journaux, entre autres fonctions.

Jetez un ≈ìil √† la liste suivante de [**Commandes ADB**](adb-commands.md) pour apprendre √† utiliser adb.

## Smali

Parfois, il est int√©ressant de **modifier le code de l'application** pour acc√©der √† des **informations cach√©es** (peut-√™tre des mots de passe ou des drapeaux bien obfusqu√©s). Ensuite, il pourrait √™tre int√©ressant de d√©compiler l'apk, de modifier le code et de le recompiler.\
[**Dans ce tutoriel**, vous pouvez **apprendre √† d√©compiler un APK, modifier le code Smali et recompiler l'APK** avec la nouvelle fonctionnalit√©](smali-changes.md). Cela pourrait √™tre tr√®s utile comme **alternative pour plusieurs tests lors de l'analyse dynamique** qui vont √™tre pr√©sent√©s. Ensuite, **gardez toujours √† l'esprit cette possibilit√©**.

## Autres astuces int√©ressantes

* [Usurpation de votre emplacement dans le Play Store](spoofing-your-location-in-play-store.md)
* **T√©l√©charger des APK** : [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/), [https://github.com/kiber-io/apkd](https://github.com/kiber-io/apkd)
* Extraire l'APK de l'appareil :
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
* Fusionnez tous les splits et les apks de base avec [APKEditor](https://github.com/REAndroid/APKEditor):
```bash
mkdir splits
adb shell pm path com.android.insecurebankv2 | cut -d ':' -f 2 | xargs -n1 -i adb pull {} splits
java -jar ../APKEditor.jar m -i splits/ -o merged.apk

# after merging, you will need to align and sign the apk, personally, I like to use the uberapksigner
java -jar uber-apk-signer.jar -a merged.apk --allowResign -o merged_signed
```
## Analyse Statique

Tout d'abord, pour analyser un APK, vous devriez **jeter un ≈ìil au code Java** en utilisant un d√©compilateur.\
Veuillez, [**lire ici pour trouver des informations sur les diff√©rents d√©compilateurs disponibles**](apk-decompilers.md).

### Recherche d'informations int√©ressantes

En regardant simplement les **cha√Ænes** de l'APK, vous pouvez rechercher des **mots de passe**, des **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), des cl√©s **api**, des **chiffrements**, des **bluetooth uuids**, des **tokens** et tout ce qui est int√©ressant... cherchez m√™me des **backdoors** d'ex√©cution de code ou des backdoors d'authentification (identifiants administratifs cod√©s en dur dans l'application).

**Firebase**

Faites particuli√®rement attention aux **URLs Firebase** et v√©rifiez si elles sont mal configur√©es. [Plus d'informations sur ce qu'est Firebase et comment l'exploiter ici.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Compr√©hension de base de l'application - Manifest.xml, strings.xml

L'**examen des fichiers \_Manifest.xml**_\*\* et \*\*_**strings.xml**\_\*\* d'une application peut r√©v√©ler des vuln√©rabilit√©s de s√©curit√© potentielles\*\*. Ces fichiers peuvent √™tre accessibles en utilisant des d√©compilateurs ou en renommant l'extension du fichier APK en .zip puis en le d√©compressant.

Les **vuln√©rabilit√©s** identifi√©es dans le **Manifest.xml** incluent :

* **Applications d√©bogables** : Les applications d√©finies comme d√©bogables (`debuggable="true"`) dans le fichier _Manifest.xml_ posent un risque car elles permettent des connexions pouvant mener √† une exploitation. Pour une compr√©hension plus approfondie sur la fa√ßon d'exploiter les applications d√©bogables, r√©f√©rez-vous √† un tutoriel sur la recherche et l'exploitation des applications d√©bogables sur un appareil.
* **Param√®tres de sauvegarde** : L'attribut `android:allowBackup="false"` doit √™tre explicitement d√©fini pour les applications traitant des informations sensibles afin d'emp√™cher les sauvegardes de donn√©es non autoris√©es via adb, surtout lorsque le d√©bogage USB est activ√©.
* **S√©curit√© r√©seau** : Les configurations de s√©curit√© r√©seau personnalis√©es (`android:networkSecurityConfig="@xml/network_security_config"`) dans _res/xml/_ peuvent sp√©cifier des d√©tails de s√©curit√© comme les certificats et les param√®tres de trafic HTTP. Un exemple est de permettre le trafic HTTP pour des domaines sp√©cifiques.
* **Activit√©s et services export√©s** : Identifier les activit√©s et services export√©s dans le manifeste peut mettre en √©vidence des composants qui pourraient √™tre mal utilis√©s. Une analyse plus approfondie lors des tests dynamiques peut r√©v√©ler comment exploiter ces composants.
* **Fournisseurs de contenu et FileProviders** : Les fournisseurs de contenu expos√©s pourraient permettre un acc√®s ou une modification non autoris√©s des donn√©es. La configuration des FileProviders doit √©galement √™tre examin√©e.
* **Receveurs de diffusion et sch√©mas d'URL** : Ces composants pourraient √™tre exploit√©s, en pr√™tant une attention particuli√®re √† la fa√ßon dont les sch√©mas d'URL sont g√©r√©s pour les vuln√©rabilit√©s d'entr√©e.
* **Versions SDK** : Les attributs `minSdkVersion`, `targetSDKVersion` et `maxSdkVersion` indiquent les versions Android prises en charge, soulignant l'importance de ne pas prendre en charge des versions Android obsol√®tes et vuln√©rables pour des raisons de s√©curit√©.

√Ä partir du fichier **strings.xml**, des informations sensibles telles que des cl√©s API, des sch√©mas personnalis√©s et d'autres notes de d√©veloppeur peuvent √™tre d√©couvertes, soulignant la n√©cessit√© d'un examen attentif de ces ressources.

### Tapjacking

**Tapjacking** est une attaque o√π une **application malveillante** est lanc√©e et **se positionne au-dessus d'une application victime**. Une fois qu'elle obscurcit visiblement l'application victime, son interface utilisateur est con√ßue de mani√®re √† tromper l'utilisateur pour qu'il interagisse avec elle, tout en transmettant l'interaction √† l'application victime.\
En effet, cela **aveugle l'utilisateur sur le fait qu'il effectue r√©ellement des actions sur l'application victime**.

Trouvez plus d'informations dans :

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### D√©tournement de t√¢che

Une **activit√©** avec le **`launchMode`** d√©fini sur **`singleTask` sans aucune `taskAffinity`** d√©finie est vuln√©rable au d√©tournement de t√¢che. Cela signifie qu'une **application** peut √™tre install√©e et si elle est lanc√©e avant la v√©ritable application, elle pourrait **d√©tourner la t√¢che de la v√©ritable application** (de sorte que l'utilisateur interagira avec l'**application malveillante en pensant qu'il utilise la v√©ritable**).

Plus d'infos dans :

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Stockage de donn√©es non s√©curis√©

**Stockage interne**

Dans Android, les fichiers **stock√©s** dans le **stockage interne** sont **con√ßus** pour √™tre **accessibles** exclusivement par l'**application** qui les **a cr√©√©s**. Cette mesure de s√©curit√© est **appliqu√©e** par le syst√®me d'exploitation Android et est g√©n√©ralement ad√©quate pour les besoins de s√©curit√© de la plupart des applications. Cependant, les d√©veloppeurs utilisent parfois des modes tels que `MODE_WORLD_READABLE` et `MODE_WORLD_WRITABLE` pour **permettre** aux fichiers d'√™tre **partag√©s** entre diff√©rentes applications. Pourtant, ces modes **ne restreignent pas l'acc√®s** √† ces fichiers par d'autres applications, y compris celles potentiellement malveillantes.

1. **Analyse statique :**
* **Assurez-vous** que l'utilisation de `MODE_WORLD_READABLE` et `MODE_WORLD_WRITABLE` est **soigneusement examin√©e**. Ces modes **peuvent potentiellement exposer** des fichiers √† un **acc√®s non intentionnel ou non autoris√©**.
2. **Analyse dynamique :**
* **V√©rifiez** les **permissions** d√©finies sur les fichiers cr√©√©s par l'application. En particulier, **v√©rifiez** si des fichiers sont **d√©finis comme lisibles ou modifiables dans le monde entier**. Cela peut poser un risque de s√©curit√© significatif, car cela permettrait √† **n'importe quelle application** install√©e sur l'appareil, quelle que soit son origine ou son intention, de **lire ou de modifier** ces fichiers.

**Stockage externe**

Lorsqu'il s'agit de fichiers sur le **stockage externe**, comme les cartes SD, certaines pr√©cautions doivent √™tre prises :

1. **Accessibilit√©** :
* Les fichiers sur le stockage externe sont **globalement lisibles et modifiables**. Cela signifie que n'importe quelle application ou utilisateur peut acc√©der √† ces fichiers.
2. **Pr√©occupations de s√©curit√©** :
* √âtant donn√© la facilit√© d'acc√®s, il est conseill√© de **ne pas stocker d'informations sensibles** sur le stockage externe.
* Le stockage externe peut √™tre retir√© ou accessible par n'importe quelle application, ce qui le rend moins s√©curis√©.
3. **Gestion des donn√©es provenant du stockage externe** :
* Toujours **effectuer une validation des entr√©es** sur les donn√©es r√©cup√©r√©es du stockage externe. Cela est crucial car les donn√©es proviennent d'une source non fiable.
* Il est fortement d√©conseill√© de stocker des ex√©cutables ou des fichiers de classe sur le stockage externe pour un chargement dynamique.
* Si votre application doit r√©cup√©rer des fichiers ex√©cutables √† partir du stockage externe, assurez-vous que ces fichiers sont **sign√©s et v√©rifi√©s cryptographiquement** avant d'√™tre charg√©s dynamiquement. Cette √©tape est vitale pour maintenir l'int√©grit√© de la s√©curit√© de votre application.

Le stockage externe peut √™tre **acc√©d√©** dans `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
√Ä partir d'Android 4.4 (**API 17**), la carte SD a une structure de r√©pertoire qui **limite l'acc√®s d'une application au r√©pertoire sp√©cifiquement destin√© √† cette application**. Cela emp√™che une application malveillante d'obtenir un acc√®s en lecture ou en √©criture aux fichiers d'une autre application.
{% endhint %}

**Donn√©es sensibles stock√©es en texte clair**

* **Pr√©f√©rences partag√©es** : Android permet √† chaque application de sauvegarder facilement des fichiers xml dans le chemin `/data/data/<packagename>/shared_prefs/` et il est parfois possible de trouver des informations sensibles en texte clair dans ce dossier.
* **Bases de donn√©es** : Android permet √† chaque application de sauvegarder facilement des bases de donn√©es sqlite dans le chemin `/data/data/<packagename>/databases/` et il est parfois possible de trouver des informations sensibles en texte clair dans ce dossier.

### TLS cass√©

**Accepter tous les certificats**

Pour une raison quelconque, parfois les d√©veloppeurs acceptent tous les certificats m√™me si, par exemple, le nom d'h√¥te ne correspond pas √† des lignes de code comme celle-ci :
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
A good way to test this is to try to capture the traffic using some proxy like Burp without authorising Burp CA inside the device. Also, you can generate with Burp a certificate for a different hostname and use it.

### Cryptographie cass√©e

**Mauvais processus de gestion des cl√©s**

Certains d√©veloppeurs enregistrent des donn√©es sensibles dans le stockage local et les cryptent avec une cl√© cod√©e en dur/pr√©visible dans le code. Cela ne devrait pas √™tre fait car un certain reverse engineering pourrait permettre aux attaquants d'extraire les informations confidentielles.

**Utilisation d'algorithmes non s√©curis√©s et/ou obsol√®tes**

Les d√©veloppeurs ne devraient pas utiliser **d'algorithmes obsol√®tes** pour effectuer des **v√©rifications d'autorisation**, **stocker** ou **envoyer** des donn√©es. Certains de ces algorithmes sont : RC4, MD4, MD5, SHA1... Si des **hashs** sont utilis√©s pour stocker des mots de passe par exemple, des hashs r√©sistants √† la **force brute** devraient √™tre utilis√©s avec un sel.

### Autres v√©rifications

* Il est recommand√© de **d'obfusquer l'APK** pour rendre le travail de reverse engineering plus difficile pour les attaquants.
* Si l'application est sensible (comme les applications bancaires), elle devrait effectuer ses **propres v√©rifications pour voir si le mobile est root√©** et agir en cons√©quence.
* Si l'application est sensible (comme les applications bancaires), elle devrait v√©rifier si un **√©mulateur** est utilis√©.
* Si l'application est sensible (comme les applications bancaires), elle devrait **v√©rifier sa propre int√©grit√© avant de s'ex√©cuter** pour v√©rifier si elle a √©t√© modifi√©e.
* Utilisez [**APKiD**](https://github.com/rednaga/APKiD) pour v√©rifier quel compilateur/emballeur/obfuscateur a √©t√© utilis√© pour construire l'APK.

### Application React Native

Read the following page to learn how to easily access javascript code of React applications:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Applications Xamarin

Read the following page to learn how to easily access C# code of a xamarin applications:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Applications Superpack√©es

According to this [**blog post**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/) superpacked is a Meta algorithm that compress the content of an application into a single file. The blog talks about the possibility of creating an app that decompress these kind of apps... and a faster way which involves to **execute the application and gather the decompressed files from the filesystem.**

### Analyse statique automatis√©e

The tool [**mariana-trench**](https://github.com/facebook/mariana-trench) is capable of finding **vulnerabilities** by **scanning** the **code** of the application. This tool contains a series of **known sources** (that indicates to the tool the **places** where the **input** is **controlled by the user**), **sinks** (which indicates to the tool **dangerous** **places** where malicious user input could cause damages) and **rules**. These rules indicates the **combination** of **sources-sinks** that indicates a vulnerability.

With this knowledge, **mariana-trench will review the code and find possible vulnerabilities on it**.

### Secrets leaked

An application may contain secrets (API keys, passwords, hidden urls, subdomains...) inside of it that you might be able to discover. You could us a tool such as [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Bypass Biometric Authentication

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Autres fonctions int√©ressantes

* **Ex√©cution de code** : `Runtime.exec(), ProcessBuilder(), native code:system()`
* **Envoyer des SMS** : `sendTextMessage, sendMultipartTestMessage`
* **Fonctions natives** d√©clar√©es comme `native` : `public native, System.loadLibrary, System.load`
* [Read this to learn **how to reverse native functions**](reversing-native-libraries.md)

### **Autres astuces**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

***

## Analyse dynamique

> First of all, you need an environment where you can install the application and all the environment (Burp CA cert, Drozer and Frida mainly). Therefore, a rooted device (emulated or not) is extremely recommended.

### Analyse dynamique en ligne

You can create a **free account** in: [https://appetize.io/](https://appetize.io). This platform allows you to **upload** and **execute** APKs, so it is useful to see how an apk is behaving.

You can even **see the logs of your application** in the web and connect through **adb**.

![](<../../.gitbook/assets/image (831).png>)

Thanks to the ADB connection you can use **Drozer** and **Frida** inside the emulators.

### Analyse dynamique locale

#### Utilisation d'un √©mulateur

* [**Android Studio**](https://developer.android.com/studio) (You can create **x86** and **arm** devices, and according to [**this** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**latest x86** versions **support ARM libraries** without needing an slow arm emulator).
* Learn to set it up in this page:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Version gratuite :** √âdition personnelle, vous devez cr√©er un compte. _Il est recommand√© de **t√©l√©charger** la version **AVEC**_ _**VirtualBox** pour √©viter des erreurs potentielles._)
* [**Nox**](https://es.bignox.com) (Gratuit, mais il ne prend pas en charge Frida ou Drozer).

{% hint style="info" %}
When creating a new emulator on any platform remember that the bigger the screen is, the slower the emulator will run. So select small screens if possible.
{% endhint %}

To **install google services** (like AppStore) in Genymotion you need to click on the red marked button of the following image:

![](<../../.gitbook/assets/image (277).png>)

Also, notice that in the **configuration of the Android VM in Genymotion** you can select **Bridge Network mode** (this will be useful if you will be connecting to the Android VM from a different VM with the tools).

#### Utiliser un appareil physique

You need to activate the **debugging** options and it will be cool if you can **root** it:

1. **Param√®tres**.
2. (√Ä partir d'Android 8.0) S√©lectionnez **Syst√®me**.
3. S√©lectionnez **√Ä propos du t√©l√©phone**.
4. Appuyez sur **Num√©ro de build** 7 fois.
5. Revenez en arri√®re et vous trouverez les **Options pour les d√©veloppeurs**.

> Once you have installed the application, the first thing you should do is to try it and investigate what does it do, how does it work and get comfortable with it.\
> I will suggest to **perform this initial dynamic analysis using MobSF dynamic analysis + pidcat**, so we will be able to **learn how the application works** while MobSF **captures** a lot of **interesting** **data** you can review later on.

### Fuite de donn√©es non intentionnelle

**Journalisation**

Les d√©veloppeurs doivent √™tre prudents de ne pas exposer **des informations de d√©bogage** publiquement, car cela peut entra√Æner des fuites de donn√©es sensibles. Les outils [**pidcat**](https://github.com/JakeWharton/pidcat) et `adb logcat` sont recommand√©s pour surveiller les journaux d'application afin d'identifier et de prot√©ger les informations sensibles. **Pidcat** est privil√©gi√© pour sa facilit√© d'utilisation et sa lisibilit√©.

{% hint style="warning" %}
Note that from **later newer than Android 4.0**, **applications are only able to access their own logs**. So applications cannot access other apps logs.\
Anyway, it's still recommended to **not log sensitive information**.
{% endhint %}

**Mise en cache du presse-papiers**

Le cadre bas√© sur le **presse-papiers** d'Android permet la fonctionnalit√© de copier-coller dans les applications, mais pose un risque car **d'autres applications** peuvent **acc√©der** au presse-papiers, exposant potentiellement des donn√©es sensibles. Il est crucial de **d√©sactiver les fonctions de copier/coller** pour les sections sensibles d'une application, comme les d√©tails de carte de cr√©dit, afin de pr√©venir les fuites de donn√©es.

**Journaux de plantage**

Si une application **plante** et **enregistre des journaux**, ces journaux peuvent aider les attaquants, en particulier lorsque l'application ne peut pas √™tre reverse-engineered. Pour att√©nuer ce risque, √©vitez de journaliser lors des plantages, et si des journaux doivent √™tre transmis sur le r√©seau, assurez-vous qu'ils sont envoy√©s via un canal SSL pour la s√©curit√©.

As pentester, **try to take a look to these logs**.

**Donn√©es analytiques envoy√©es √† des tiers**

Les applications int√®grent souvent des services comme Google Adsense, ce qui peut involontairement **fuir des donn√©es sensibles** en raison d'une mise en ≈ìuvre incorrecte par les d√©veloppeurs. Pour identifier les fuites de donn√©es potentielles, il est conseill√© de **intercepter le trafic de l'application** et de v√©rifier toute information sensible envoy√©e √† des services tiers.

### Bases de donn√©es SQLite

La plupart des applications utiliseront des **bases de donn√©es SQLite internes** pour enregistrer des informations. Lors du pentest, jetez un **≈ìil** aux **bases de donn√©es** cr√©√©es, aux noms des **tables** et des **colonnes** et √† toutes les **donn√©es** enregistr√©es car vous pourriez trouver des **informations sensibles** (ce qui constituerait une vuln√©rabilit√©).\
Les bases de donn√©es devraient √™tre situ√©es dans `/data/data/the.package.name/databases` comme `/data/data/com.mwr.example.sieve/databases`.

Si la base de donn√©es enregistre des informations confidentielles et est **crypt√©e** mais que vous pouvez **trouver** le **mot de passe** √† l'int√©rieur de l'application, c'est toujours une **vuln√©rabilit√©**.

√ânum√©rez les tables en utilisant `.tables` et √©num√©rez les colonnes des tables en faisant `.schema <table_name>`.

### Drozer (Exploitation des activit√©s export√©es, des fournisseurs de contenu et des services)

From [Drozer Docs](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** allows you to **assume the role of an Android app** and interact with other apps. It can do **anything that an installed application can do**, such as make use of Android‚Äôs Inter-Process Communication (IPC) mechanism and interact with the underlying operating system. .\
Drozer is s useful tool to **exploit exported activities, exported services and Content Providers** as you will learn in the following sections.

### Exploitation des activit√©s export√©es

[**Read this if you want to refresh what is an Android Activity.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Also remember that the code of an activity starts in the **`onCreate`** method.

**Bypass d'autorisation**

When an Activity is exported you can invoke its screen from an external app. Therefore, if an activity with **sensitive information** is **exported** you could **bypass** the **authentication** mechanisms **to access it.**

[**Learn how to exploit exported activities with Drozer.**](drozer-tutorial/#activities)

You can also start an exported activity from adb:

* PackageName is com.example.demo
* Exported ActivityName is com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTE**: MobSF d√©tectera comme malveillant l'utilisation de _**singleTask/singleInstance**_ comme `android:launchMode` dans une activit√©, mais en raison de [cela](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), apparemment cela n'est dangereux que sur les anciennes versions (versions API < 21).

{% hint style="info" %}
Notez qu'un contournement d'autorisation n'est pas toujours une vuln√©rabilit√©, cela d√©pend de la mani√®re dont le contournement fonctionne et des informations qui sont expos√©es.
{% endhint %}

**Fuite d'informations sensibles**

**Les activit√©s peuvent √©galement renvoyer des r√©sultats**. Si vous parvenez √† trouver une activit√© export√©e et non prot√©g√©e appelant la m√©thode **`setResult`** et **renvoyant des informations sensibles**, il y a une fuite d'informations sensibles.

#### Tapjacking

Si le tapjacking n'est pas pr√©venu, vous pourriez abuser de l'activit√© export√©e pour faire en sorte que **l'utilisateur effectue des actions inattendues**. Pour plus d'informations sur [**ce qu'est le Tapjacking, suivez le lien**](./#tapjacking).

### Exploitation des Content Providers - Acc√©der et manipuler des informations sensibles

[**Lisez ceci si vous voulez rafra√Æchir ce qu'est un Content Provider.**](android-applications-basics.md#content-provider)\
Les content providers sont essentiellement utilis√©s pour **partager des donn√©es**. Si une application a des content providers disponibles, vous pourriez √™tre en mesure d'**extraire des donn√©es sensibles** √† partir d'eux. Il est √©galement int√©ressant de tester d'√©ventuelles **injections SQL** et **Path Traversals** car elles pourraient √™tre vuln√©rables.

[**Apprenez √† exploiter les Content Providers avec Drozer.**](drozer-tutorial/#content-providers)

### **Exploitation des Services**

[**Lisez ceci si vous voulez rafra√Æchir ce qu'est un Service.**](android-applications-basics.md#services)\
Rappelez-vous que les actions d'un Service commencent dans la m√©thode `onStartCommand`.

Un service est essentiellement quelque chose qui **peut recevoir des donn√©es**, **les traiter** et **renvoyer** (ou non) une r√©ponse. Donc, si une application exporte certains services, vous devriez **v√©rifier** le **code** pour comprendre ce qu'il fait et **le tester** **dynamiquement** pour extraire des informations confidentielles, contourner des mesures d'authentification...\
[**Apprenez √† exploiter les Services avec Drozer.**](drozer-tutorial/#services)

### **Exploitation des Broadcast Receivers**

[**Lisez ceci si vous voulez rafra√Æchir ce qu'est un Broadcast Receiver.**](android-applications-basics.md#broadcast-receivers)\
Rappelez-vous que les actions d'un Broadcast Receiver commencent dans la m√©thode `onReceive`.

Un broadcast receiver attendra un type de message. Selon la mani√®re dont le r√©cepteur g√®re le message, il pourrait √™tre vuln√©rable.\
[**Apprenez √† exploiter les Broadcast Receivers avec Drozer.**](./#exploiting-broadcast-receivers)

### **Exploitation des Sch√©mas / Liens profonds**

Vous pouvez rechercher des liens profonds manuellement, en utilisant des outils comme MobSF ou des scripts comme [celui-ci](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Vous pouvez **ouvrir** un **sch√©ma** d√©clar√© en utilisant **adb** ou un **navigateur** :

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Remarque que vous pouvez **omettre le nom du package** et le mobile appellera automatiquement l'application qui devrait ouvrir ce lien._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**Code ex√©cut√©**

Pour trouver le **code qui sera ex√©cut√© dans l'App**, allez √† l'activit√© appel√©e par le deeplink et recherchez la fonction **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informations sensibles**

Chaque fois que vous trouvez un deep link, v√©rifiez qu'il **ne re√ßoit pas de donn√©es sensibles (comme des mots de passe) via des param√®tres d'URL**, car toute autre application pourrait **imiter le deep link et voler ces donn√©es !**

**Param√®tres dans le chemin**

Vous **devez √©galement v√©rifier si un deep link utilise un param√®tre √† l'int√©rieur du chemin** de l'URL comme : `https://api.example.com/v1/users/{username}`, dans ce cas, vous pouvez forcer un parcours de chemin en acc√©dant √† quelque chose comme : `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Notez que si vous trouvez les bons points de terminaison √† l'int√©rieur de l'application, vous pourriez √™tre en mesure de provoquer un **Open Redirect** (si une partie du chemin est utilis√©e comme nom de domaine), **prise de contr√¥le de compte** (si vous pouvez modifier les d√©tails des utilisateurs sans token CSRF et que le point de terminaison vuln√©rable utilise la bonne m√©thode) et toute autre vuln√©rabilit√©. Plus [d'infos √† ce sujet ici](http://dphoeniixx.com/2020/12/13-2/).

**Plus d'exemples**

Un [rapport de bug bounty int√©ressant](https://hackerone.com/reports/855618) concernant des liens (_/.well-known/assetlinks.json_).

### √âchecs d'inspection et de v√©rification de la couche de transport

* **Les certificats ne sont pas toujours inspect√©s correctement** par les applications Android. Il est courant que ces applications ignorent les avertissements et acceptent des certificats auto-sign√©s ou, dans certains cas, reviennent √† utiliser des connexions HTTP.
* **Les n√©gociations lors de la poign√©e de main SSL/TLS sont parfois faibles**, utilisant des suites de chiffrement non s√©curis√©es. Cette vuln√©rabilit√© rend la connexion susceptible aux attaques de type homme du milieu (MITM), permettant aux attaquants de d√©chiffrer les donn√©es.
* **La fuite d'informations priv√©es** est un risque lorsque les applications s'authentifient via des canaux s√©curis√©s mais communiquent ensuite par des canaux non s√©curis√©s pour d'autres transactions. Cette approche ne prot√®ge pas les donn√©es sensibles, telles que les cookies de session ou les d√©tails des utilisateurs, contre l'interception par des entit√©s malveillantes.

#### V√©rification des certificats

Nous allons nous concentrer sur la **v√©rification des certificats**. L'int√©grit√© du certificat du serveur doit √™tre v√©rifi√©e pour am√©liorer la s√©curit√©. Cela est crucial car des configurations TLS non s√©curis√©es et la transmission de donn√©es sensibles par des canaux non chiffr√©s peuvent poser des risques significatifs. Pour des √©tapes d√©taill√©es sur la v√©rification des certificats de serveur et le traitement des vuln√©rabilit√©s, [**cette ressource**](https://manifestsecurity.com/android-application-security-part-10/) fournit des conseils complets.

#### SSL Pinning

Le SSL Pinning est une mesure de s√©curit√© o√π l'application v√©rifie le certificat du serveur par rapport √† une copie connue stock√©e dans l'application elle-m√™me. Cette m√©thode est essentielle pour pr√©venir les attaques MITM. Il est fortement recommand√© de mettre en ≈ìuvre le SSL Pinning pour les applications traitant des informations sensibles.

#### Inspection du trafic

Pour inspecter le trafic HTTP, il est n√©cessaire d'**installer le certificat de l'outil proxy** (par exemple, Burp). Sans l'installation de ce certificat, le trafic chiffr√© pourrait ne pas √™tre visible via le proxy. Pour un guide sur l'installation d'un certificat CA personnalis√©, [**cliquez ici**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine).

Les applications ciblant **API Level 24 et sup√©rieur** n√©cessitent des modifications de la configuration de s√©curit√© r√©seau pour accepter le certificat CA du proxy. Cette √©tape est cruciale pour inspecter le trafic chiffr√©. Pour des instructions sur la modification de la configuration de s√©curit√© r√©seau, [**reportez-vous √† ce tutoriel**](make-apk-accept-ca-certificate.md).

#### Contournement du SSL Pinning

Lorsque le SSL Pinning est mis en ≈ìuvre, le contournement devient n√©cessaire pour inspecter le trafic HTTPS. Diverses m√©thodes sont disponibles √† cet effet :

* Modifiez automatiquement l'**apk** pour **contourner** le SSL Pinning avec [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). Le meilleur avantage de cette option est que vous n'aurez pas besoin de root pour contourner le SSL Pinning, mais vous devrez supprimer l'application et r√©installer la nouvelle, et cela ne fonctionnera pas toujours.
* Vous pourriez utiliser **Frida** (discut√© ci-dessous) pour contourner cette protection. Voici un guide pour utiliser Burp+Frida+Genymotion : [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Vous pouvez √©galement essayer de **contourner automatiquement le SSL Pinning** en utilisant [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Vous pouvez √©galement essayer de **contourner automatiquement le SSL Pinning** en utilisant **l'analyse dynamique MobSF** (expliqu√© ci-dessous)
* Si vous pensez toujours qu'il y a du trafic que vous ne capturez pas, vous pouvez essayer de **rediriger le trafic vers burp en utilisant iptables**. Lisez ce blog : [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### Recherche de vuln√©rabilit√©s web courantes

Il est √©galement important de rechercher des vuln√©rabilit√©s web courantes au sein de l'application. Des informations d√©taill√©es sur l'identification et l'att√©nuation de ces vuln√©rabilit√©s d√©passent le cadre de ce r√©sum√© mais sont largement couvertes ailleurs.

### Frida

[Frida](https://www.frida.re) est un outil d'instrumentation dynamique pour les d√©veloppeurs, les ing√©nieurs en r√©tro-ing√©nierie et les chercheurs en s√©curit√©.\
**Vous pouvez acc√©der √† l'application en cours d'ex√©cution et accrocher des m√©thodes en temps r√©el pour changer le comportement, modifier des valeurs, extraire des valeurs, ex√©cuter un code diff√©rent...**\
Si vous souhaitez effectuer un pentesting sur des applications Android, vous devez savoir comment utiliser Frida.

* Apprenez √† utiliser Frida : [**Tutoriel Frida**](frida-tutorial/)
* Une "GUI" pour les actions avec Frida : [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection est excellent pour automatiser l'utilisation de Frida : [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* Vous pouvez trouver des scripts Frida int√©ressants ici : [**https://codeshare.frida.re/**](https://codeshare.frida.re)
* Essayez de contourner les m√©canismes anti-debugging / anti-frida en chargeant Frida comme indiqu√© dans [https://erfur.github.io/blog/dev/code-injection-without-ptrace](https://erfur.github.io/blog/dev/code-injection-without-ptrace) (outil [linjector](https://github.com/erfur/linjector-rs))

### **Dump M√©moire - Fridump**

V√©rifiez si l'application stocke des informations sensibles dans la m√©moire qu'elle ne devrait pas stocker, comme des mots de passe ou des mn√©moniques.

En utilisant [**Fridump3**](https://github.com/rootbsd/fridump3), vous pouvez dumper la m√©moire de l'application avec :
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Cela va vider la m√©moire dans le dossier ./dump, et l√†-dedans, vous pourriez grep avec quelque chose comme : 

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Donn√©es sensibles dans le Keystore**

Dans Android, le Keystore est le meilleur endroit pour stocker des donn√©es sensibles, cependant, avec suffisamment de privil√®ges, il est toujours **possible d'y acc√©der**. Comme les applications ont tendance √† stocker ici **des donn√©es sensibles en texte clair**, les pentests devraient v√©rifier cela en tant qu'utilisateur root ou quelqu'un ayant un acc√®s physique √† l'appareil pourrait √™tre en mesure de voler ces donn√©es.

M√™me si une application stocke des donn√©es dans le keystore, les donn√©es devraient √™tre chiffr√©es.

Pour acc√©der aux donn√©es √† l'int√©rieur du keystore, vous pouvez utiliser ce script Frida : [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Contourner l'authentification par empreinte digitale/Biom√©trie**

En utilisant le script Frida suivant, il pourrait √™tre possible de **contourner l'authentification par empreinte digitale** que les applications Android pourraient effectuer afin de **prot√©ger certaines zones sensibles :**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Images de Fond**

Lorsque vous mettez une application en arri√®re-plan, Android stocke un **instantan√© de l'application** afin que, lorsqu'elle est r√©cup√©r√©e au premier plan, elle commence √† charger l'image avant l'application, ce qui donne l'impression que l'application a √©t√© charg√©e plus rapidement.

Cependant, si cet instantan√© contient des **informations sensibles**, quelqu'un ayant acc√®s √† l'instantan√© pourrait **voler ces informations** (notez que vous avez besoin de root pour y acc√©der).

Les instantan√©s sont g√©n√©ralement stock√©s autour de : **`/data/system_ce/0/snapshots`**

Android fournit un moyen de **pr√©venir la capture d'√©cran en d√©finissant le param√®tre de mise en page FLAG\_SECURE**. En utilisant ce drapeau, le contenu de la fen√™tre est trait√© comme s√©curis√©, emp√™chant son apparition dans les captures d'√©cran ou d'√™tre visualis√© sur des affichages non s√©curis√©s.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analyseur d'Application Android**

Cet outil peut vous aider √† g√©rer diff√©rents outils lors de l'analyse dynamique : [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Injection d'Intent

Les d√©veloppeurs cr√©ent souvent des composants proxy comme des activit√©s, des services et des r√©cepteurs de diffusion qui g√®rent ces Intents et les transmettent √† des m√©thodes telles que `startActivity(...)` ou `sendBroadcast(...)`, ce qui peut √™tre risqu√©.

Le danger r√©side dans le fait de permettre aux attaquants de d√©clencher des composants d'application non export√©s ou d'acc√©der √† des fournisseurs de contenu sensibles en d√©tournant ces Intents. Un exemple notable est le composant `WebView` qui convertit les URL en objets `Intent` via `Intent.parseUri(...)` et les ex√©cute ensuite, ce qui peut entra√Æner des injections d'Intent malveillantes.

### Points Essentiels

* **Injection d'Intent** est similaire au probl√®me de redirection ouverte du web.
* Les exploits impliquent de passer des objets `Intent` en tant qu'extras, qui peuvent √™tre redirig√©s pour ex√©cuter des op√©rations non s√©curis√©es.
* Cela peut exposer des composants non export√©s et des fournisseurs de contenu aux attaquants.
* La conversion d'URL en `Intent` de `WebView` peut faciliter des actions non intentionnelles.

### Injections C√¥t√© Client Android et autres

Vous connaissez probablement ce type de vuln√©rabilit√©s sur le Web. Vous devez √™tre particuli√®rement prudent avec ces vuln√©rabilit√©s dans une application Android :

* **Injection SQL :** Lors de la gestion de requ√™tes dynamiques ou de Content-Providers, assurez-vous d'utiliser des requ√™tes param√©tr√©es.
* **Injection JavaScript (XSS) :** V√©rifiez que le support JavaScript et Plugin est d√©sactiv√© pour tous les WebViews (d√©sactiv√© par d√©faut). [Plus d'infos ici](webview-attacks.md#javascript-enabled).
* **Inclusion de Fichiers Locaux :** Les WebViews ne devraient pas avoir acc√®s au syst√®me de fichiers (activ√© par d√©faut) - `(webview.getSettings().setAllowFileAccess(false);)`. [Plus d'infos ici](webview-attacks.md#javascript-enabled).
* **Cookies √©ternels :** Dans plusieurs cas, lorsque l'application Android termine la session, le cookie n'est pas r√©voqu√© ou peut m√™me √™tre enregistr√© sur le disque.
* [**Drapeau S√©curis√©** dans les cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de bugs !

**Aper√ßus de Hacking**\
Engagez-vous avec du contenu qui plonge dans le frisson et les d√©fis du hacking.

**Actualit√©s de Hacking en Temps R√©el**\
Restez √† jour avec le monde du hacking en rapide √©volution gr√¢ce √† des nouvelles et des aper√ßus en temps r√©el.

**Derni√®res Annonces**\
Restez inform√© des nouvelles primes de bugs lanc√©es et des mises √† jour cruciales de la plateforme.

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

## Analyse Automatique

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**Analyse statique**

![](<../../.gitbook/assets/image (866).png>)

**√âvaluation de la vuln√©rabilit√© de l'application** √† l'aide d'une belle interface web. Vous pouvez √©galement effectuer une analyse dynamique (mais vous devez pr√©parer l'environnement).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Notice that MobSF can analyse **Android**(apk)**, IOS**(ipa) **and Windows**(apx) applications (_Les applications Windows doivent √™tre analys√©es depuis un MobSF install√© sur un h√¥te Windows_).\
Also, if you create a **ZIP** file with the source code if an **Android** or an **IOS** app (allez dans le dossier racine de l'application, s√©lectionnez tout et cr√©ez un fichier ZIP), it will be able to analyse it also.

MobSF also allows you to **diff/Compare** analysis and to integrate **VirusTotal** (vous devrez d√©finir votre cl√© API dans _MobSF/settings.py_ et l'activer : `VT_ENABLED = TRUE` `VT_API_KEY = <Votre cl√© API>` `VT_UPLOAD = TRUE`). You can also set `VT_UPLOAD` to `False`, then the **hash** will be **upload** instead of the file.

### Assisted Dynamic analysis with MobSF

**MobSF** can also be very helpful for **dynamic analysis** in **Android**, but in that case you will need to install MobSF and **genymotion** in your host (une VM ou Docker ne fonctionnera pas). _Note : Vous devez **d'abord d√©marrer une VM dans genymotion** et **ensuite MobSF.**_\
The **MobSF dynamic analyser** can:

* **Dump application data** (URLs, logs, clipboard, screenshots made by you, screenshots made by "**Exported Activity Tester**", emails, SQLite databases, XML files, and other created files). All of this is done automatically except for the screenshots, you need to press when you want a screenshot or you need to press "**Exported Activity Tester**" to obtain screenshots of all the exported activities.
* Capture **HTTPS traffic**
* Use **Frida** to obtain **runtime** **information**

From android **versions > 5**, it will **automatically start Frida** and will set global **proxy** settings to **capture** traffic. It will only capture traffic from the tested application.

**Frida**

By default, it will also use some Frida Scripts to **bypass SSL pinning**, **root detection** and **debugger detection** and to **monitor interesting APIs**.\
MobSF can also **invoke exported activities**, grab **screenshots** of them and **save** them for the report.

To **start** the dynamic testing press the green bottom: "**Start Instrumentation**". Press the "**Frida Live Logs**" to see the logs generated by the Frida scripts and "**Live API Monitor**" to see all the invocation to hooked methods, arguments passed and returned values (this will appear after pressing "Start Instrumentation").\
MobSF also allows you to load your own **Frida scripts** (to send the results of your Friday scripts to MobSF use the function `send()`). It also has **several pre-written scripts** you can load (you can add more in `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), just **select them**, press "**Load**" and press "**Start Instrumentation**" (you will be able to see the logs of that scripts inside "**Frida Live Logs**").

![](<../../.gitbook/assets/image (419).png>)

Moreover, you have some Auxiliary Frida functionalities:

* **Enumerate Loaded Classes**: It will print all the loaded classes
* **Capture Strings**: It will print all the capture strings while using the application (super noisy)
* **Capture String Comparisons**: Could be very useful. It will **show the 2 strings being compared** and if the result was True or False.
* **Enumerate Class Methods**: Put the class name (like "java.io.File") and it will print all the methods of the class.
* **Search Class Pattern**: Search classes by pattern
* **Trace Class Methods**: **Trace** a **whole class** (see inputs and outputs of all methods of th class). Remember that by default MobSF traces several interesting Android Api methods.

Once you have selected the auxiliary module you want to use you need to press "**Start Intrumentation**" and you will see all the outputs in "**Frida Live Logs**".

**Shell**

Mobsf also brings you a shell with some **adb** commands, **MobSF commands**, and common **shell** **commands** at the bottom of the dynamic analysis page. Some interesting commands:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Outils HTTP**

Lorsque le trafic http est captur√©, vous pouvez voir une vue peu attrayante du trafic captur√© en bas sur "**HTTP(S) Traffic**" ou une vue plus agr√©able dans le bouton vert "**Start HTTPTools**". √Ä partir de la deuxi√®me option, vous pouvez **envoyer** les **requ√™tes captur√©es** √† des **proxies** comme Burp ou Owasp ZAP.\
Pour ce faire, _allumez Burp -->_ _d√©sactivez Intercept --> dans MobSB HTTPTools, s√©lectionnez la requ√™te_ --> appuyez sur "**Send to Fuzzer**" --> _s√©lectionnez l'adresse du proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Une fois que vous avez termin√© l'analyse dynamique avec MobSF, vous pouvez appuyer sur "**Start Web API Fuzzer**" pour **fuzzer les requ√™tes http** et rechercher des vuln√©rabilit√©s.

{% hint style="info" %}
Apr√®s avoir effectu√© une analyse dynamique avec MobSF, les param√®tres du proxy peuvent √™tre mal configur√©s et vous ne pourrez pas les corriger depuis l'interface graphique. Vous pouvez corriger les param√®tres du proxy en faisant :
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Analyse Dynamique Assist√©e avec Inspeckage

Vous pouvez obtenir l'outil depuis [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Cet outil utilise des **Hooks** pour vous informer **de ce qui se passe dans l'application** pendant que vous effectuez une **analyse dynamique**.

### [Yaazhini](https://www.vegabird.com/yaazhini/)

C'est un **excellent outil pour effectuer une analyse statique avec une interface graphique**

![](<../../.gitbook/assets/image (741).png>)

### [Qark](https://github.com/linkedin/qark)

Cet outil est con√ßu pour rechercher plusieurs **vuln√©rabilit√©s li√©es √† la s√©curit√© des applications Android**, que ce soit dans le **code source** ou les **APKs empaquet√©s**. L'outil est √©galement **capable de cr√©er un APK d√©ployable "Proof-of-Concept"** et des **commandes ADB**, pour exploiter certaines des vuln√©rabilit√©s trouv√©es (Activit√©s expos√©es, intents, tapjacking...). Comme avec Drozer, il n'est pas n√©cessaire de rooter l'appareil de test.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Affiche tous les fichiers extraits pour une r√©f√©rence facile
* D√©compile automatiquement les fichiers APK en format Java et Smali
* Analyse AndroidManifest.xml pour des vuln√©rabilit√©s et comportements courants
* Analyse statique du code source pour des vuln√©rabilit√©s et comportements courants
* Informations sur l'appareil
* et plus
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER est une application en ligne de commande qui peut √™tre utilis√©e sous Windows, MacOS X et Linux, qui analyse les fichiers _.apk_ √† la recherche de vuln√©rabilit√©s. Elle le fait en d√©compressant les APK et en appliquant une s√©rie de r√®gles pour d√©tecter ces vuln√©rabilit√©s.

Toutes les r√®gles sont centr√©es dans un fichier `rules.json`, et chaque entreprise ou testeur peut cr√©er ses propres r√®gles pour analyser ce dont ils ont besoin.

T√©l√©chargez les derniers binaires sur la [page de t√©l√©chargement](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (297).png>)

StaCoAn est un outil **multiplateforme** qui aide les d√©veloppeurs, les chasseurs de bugs et les hackers √©thiques √† effectuer une [analyse de code statique](https://en.wikipedia.org/wiki/Static\_program\_analysis) sur des applications mobiles.

Le concept est que vous faites glisser et d√©poser votre fichier d'application mobile (un fichier .apk ou .ipa) sur l'application StaCoAn et elle g√©n√©rera un rapport visuel et portable pour vous. Vous pouvez ajuster les param√®tres et les listes de mots pour obtenir une exp√©rience personnalis√©e.

T√©l√©chargez [la derni√®re version](https://github.com/vincentcox/StaCoAn/releases) :
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework est un syst√®me d'analyse de vuln√©rabilit√©s Android qui aide les d√©veloppeurs ou les hackers √† trouver des vuln√©rabilit√©s de s√©curit√© potentielles dans les applications Android.\
[Versions Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** est un outil dont le principal objectif est de d√©tecter et d'avertir l'utilisateur des comportements malveillants potentiels d√©velopp√©s par une application Android.

La d√©tection est effectu√©e par l'**analyse statique** du bytecode Dalvik de l'application, repr√©sent√© sous forme de **Smali**, avec la biblioth√®que [`androguard`](https://github.com/androguard/androguard).

Cet outil recherche des **comportements courants des applications "malveillantes"** tels que : exfiltration d'identifiants de t√©l√©phonie, interception de flux audio/vid√©o, modification de donn√©es PIM, ex√©cution de code arbitraire...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA\_Framework)

![](<../../.gitbook/assets/image (595).png>)

**MARA** est un **M**obile **A**pplication **R**everse engineering et **A**nalysis Framework. C'est un outil qui regroupe des outils couramment utilis√©s pour l'ing√©nierie inverse et l'analyse des applications mobiles, afin d'assister dans le test des applications mobiles contre les menaces de s√©curit√© mobile OWASP. Son objectif est de rendre cette t√¢che plus facile et plus conviviale pour les d√©veloppeurs d'applications mobiles et les professionnels de la s√©curit√©.

Il est capable de :

* Extraire du code Java et Smali en utilisant diff√©rents outils
* Analyser des APKs en utilisant : [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs\_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extraire des informations priv√©es de l'APK en utilisant des regexps.
* Analyser le Manifest.
* Analyser les domaines trouv√©s en utilisant : [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) et [whatweb](https://github.com/urbanadventurer/WhatWeb)
* D√©obfusquer l'APK via [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

Utile pour d√©tecter les malwares : [https://koodous.com/](https://koodous.com)

## Obfuscating/Deobfuscating code

Notez qu'en fonction du service et de la configuration que vous utilisez pour obfusquer le code. Les secrets peuvent ou non √™tre obfusqu√©s.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

De [Wikipedia](https://en.wikipedia.org/wiki/ProGuard\_\(software\)) : **ProGuard** est un outil en ligne de commande open source qui r√©duit, optimise et obfusque le code Java. Il est capable d'optimiser le bytecode ainsi que de d√©tecter et de supprimer les instructions inutilis√©es. ProGuard est un logiciel libre et est distribu√© sous la GNU General Public License, version 2.

ProGuard est distribu√© dans le cadre du SDK Android et s'ex√©cute lors de la construction de l'application en mode release.

### [DexGuard](https://www.guardsquare.com/dexguard)

Trouvez un guide √©tape par √©tape pour d√©obfusquer l'apk sur [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(De ce guide) La derni√®re fois que nous avons v√©rifi√©, le mode de fonctionnement de Dexguard √©tait :

* charger une ressource en tant qu'InputStream ;
* alimenter le r√©sultat √† une classe h√©ritant de FilterInputStream pour le d√©chiffrer ;
* faire une obfuscation inutile pour faire perdre quelques minutes √† un reverseur ;
* alimenter le r√©sultat d√©chiffr√© √† un ZipInputStream pour obtenir un fichier DEX ;
* enfin charger le DEX r√©sultant en tant que ressource en utilisant la m√©thode `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard inverse le processus d'obfuscation effectu√© par les outils d'obfuscation Android. Cela permet de nombreuses analyses de s√©curit√©, y compris l'inspection du code et la pr√©diction des biblioth√®ques.**

Vous pouvez t√©l√©charger un APK obfusqu√© sur leur plateforme.

### [Simplify](https://github.com/CalebFenton/simplify)

C'est un **d√©obfuscateur android g√©n√©rique.** Simplify **ex√©cute virtuellement une application** pour comprendre son comportement et ensuite **essaie d'optimiser le code** afin qu'il se comporte de mani√®re identique mais soit plus facile √† comprendre pour un humain. Chaque type d'optimisation est simple et g√©n√©rique, donc peu importe le type sp√©cifique d'obfuscation utilis√©.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD vous donne des informations sur **comment un APK a √©t√© cr√©√©**. Il identifie de nombreux **compilateurs**, **packers**, **obfuscateurs**, et d'autres choses √©tranges. C'est [_PEiD_](https://www.aldeid.com/wiki/PEiD) pour Android.

### Manual

[Lisez ce tutoriel pour apprendre quelques astuces sur **comment inverser une obfuscation personnalis√©e**](manual-deobfuscation.md)

## Labs

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b est une machine virtuelle de s√©curit√© Android bas√©e sur ubuntu-mate qui inclut la collection des derniers frameworks, tutoriels et laboratoires de diff√©rents geeks de la s√©curit√© et chercheurs pour l'ing√©nierie inverse et l'analyse des malwares.

## References

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) C'est une excellente liste de ressources
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Cours rapide sur Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Yet to try

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de bugs !

**Hacking Insights**\
Engagez-vous avec du contenu qui plonge dans le frisson et les d√©fis du hacking

**Real-Time Hack News**\
Restez √† jour avec le monde du hacking en rapide √©volution gr√¢ce √† des nouvelles et des insights en temps r√©el

**Latest Announcements**\
Restez inform√© des nouveaux bug bounties lanc√©s et des mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers aujourd'hui !

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
