# Pentesting de Aplicaciones Android

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

춰칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de bugs!

**Perspectivas de Hacking**\
Invol칰crate con contenido que profundiza en la emoci칩n y los desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente al d칤a con el mundo del hacking de ritmo r치pido a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre las nuevas recompensas por bugs que se lanzan y actualizaciones cruciales de la plataforma

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo!

## Fundamentos de Aplicaciones Android

Se recomienda encarecidamente comenzar a leer esta p치gina para conocer las **partes m치s importantes relacionadas con la seguridad de Android y los componentes m치s peligrosos en una aplicaci칩n Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Esta es la herramienta principal que necesitas para conectarte a un dispositivo Android (emulado o f칤sico).\
**ADB** permite controlar dispositivos ya sea por **USB** o **Red** desde una computadora. Esta utilidad permite la **copia** de archivos en ambas direcciones, **instalaci칩n** y **desinstalaci칩n** de aplicaciones, **ejecuci칩n** de comandos de shell, **respaldo** de datos, **lectura** de registros, entre otras funciones.

Echa un vistazo a la siguiente lista de [**Comandos ADB**](adb-commands.md) para aprender a usar adb.

## Smali

A veces es interesante **modificar el c칩digo de la aplicaci칩n** para acceder a **informaci칩n oculta** (quiz치s contrase침as o flags bien ofuscadas). Entonces, podr칤a ser interesante descompilar el apk, modificar el c칩digo y recompilarlo.\
[**En este tutorial** puedes **aprender a descompilar un APK, modificar el c칩digo Smali y recompilar el APK** con la nueva funcionalidad](smali-changes.md). Esto podr칤a ser muy 칰til como una **alternativa para varias pruebas durante el an치lisis din치mico** que se van a presentar. Entonces, **siempre ten en mente esta posibilidad**.

## Otros trucos interesantes

* [Suplantar tu ubicaci칩n en Play Store](spoofing-your-location-in-play-store.md)
* **Descargar APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/), [https://github.com/kiber-io/apkd](https://github.com/kiber-io/apkd)
* Extraer APK del dispositivo:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
* Fusiona todos los splits y apks base con [APKEditor](https://github.com/REAndroid/APKEditor):
```bash
mkdir splits
adb shell pm path com.android.insecurebankv2 | cut -d ':' -f 2 | xargs -n1 -i adb pull {} splits
java -jar ../APKEditor.jar m -i splits/ -o merged.apk

# after merging, you will need to align and sign the apk, personally, I like to use the uberapksigner
java -jar uber-apk-signer.jar -a merged.apk --allowResign -o merged_signed
```
## An치lisis Est치tico

Primero que nada, para analizar un APK deber칤as **echar un vistazo al c칩digo Java** usando un descompilador.\
Por favor, [**lee aqu칤 para encontrar informaci칩n sobre diferentes descompiladores disponibles**](apk-decompilers.md).

### Buscando informaci칩n interesante

Solo echando un vistazo a las **cadenas** del APK puedes buscar **contrase침as**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **claves** de **api**, **cifrado**, **bluetooth uuids**, **tokens** y cualquier cosa interesante... busca incluso **backdoors** de ejecuci칩n de c칩digo o backdoors de autenticaci칩n (credenciales de administrador codificadas en la aplicaci칩n).

**Firebase**

Presta especial atenci칩n a las **URLs de firebase** y verifica si est치 mal configurado. [M치s informaci칩n sobre qu칠 es Firebase y c칩mo explotarlo aqu칤.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Comprensi칩n b치sica de la aplicaci칩n - Manifest.xml, strings.xml

La **examinaci칩n de los archivos \_Manifest.xml**_\*\* y \*\*_**strings.xml**\_\*\* de una aplicaci칩n puede revelar posibles vulnerabilidades de seguridad\*\*. Estos archivos se pueden acceder usando descompiladores o renombrando la extensi칩n del archivo APK a .zip y luego descomprimi칠ndolo.

**Vulnerabilidades** identificadas en el **Manifest.xml** incluyen:

* **Aplicaciones Depurables**: Las aplicaciones configuradas como depurables (`debuggable="true"`) en el archivo _Manifest.xml_ representan un riesgo ya que permiten conexiones que pueden llevar a la explotaci칩n. Para una mejor comprensi칩n sobre c칩mo explotar aplicaciones depurables, consulta un tutorial sobre c칩mo encontrar y explotar aplicaciones depurables en un dispositivo.
* **Configuraciones de Respaldo**: El atributo `android:allowBackup="false"` debe ser establecido expl칤citamente para aplicaciones que manejan informaci칩n sensible para prevenir respaldos de datos no autorizados a trav칠s de adb, especialmente cuando la depuraci칩n por usb est치 habilitada.
* **Seguridad de Red**: Configuraciones de seguridad de red personalizadas (`android:networkSecurityConfig="@xml/network_security_config"`) en _res/xml/_ pueden especificar detalles de seguridad como pines de certificado y configuraciones de tr치fico HTTP. Un ejemplo es permitir tr치fico HTTP para dominios espec칤ficos.
* **Actividades y Servicios Exportados**: Identificar actividades y servicios exportados en el manifiesto puede resaltar componentes que podr칤an ser mal utilizados. Un an치lisis adicional durante las pruebas din치micas puede revelar c칩mo explotar estos componentes.
* **Proveedores de Contenido y FileProviders**: Proveedores de contenido expuestos podr칤an permitir acceso no autorizado o modificaci칩n de datos. La configuraci칩n de los FileProviders tambi칠n debe ser examinada.
* **Receptores de Difusi칩n y Esquemas de URL**: Estos componentes podr칤an ser aprovechados para explotaci칩n, prestando especial atenci칩n a c칩mo se gestionan los esquemas de URL para vulnerabilidades de entrada.
* **Versiones de SDK**: Los atributos `minSdkVersion`, `targetSDKVersion` y `maxSdkVersion` indican las versiones de Android soportadas, destacando la importancia de no soportar versiones de Android obsoletas y vulnerables por razones de seguridad.

Del archivo **strings.xml**, se puede descubrir informaci칩n sensible como claves de API, esquemas personalizados y otras notas de desarrollador, subrayando la necesidad de una revisi칩n cuidadosa de estos recursos.

### Tapjacking

**Tapjacking** es un ataque donde una **aplicaci칩n maliciosa** se lanza y **se posiciona encima de una aplicaci칩n v칤ctima**. Una vez que oculta visiblemente la aplicaci칩n v칤ctima, su interfaz de usuario est치 dise침ada de tal manera que enga침a al usuario para interactuar con ella, mientras pasa la interacci칩n a la aplicaci칩n v칤ctima.\
En efecto, est치 **cegando al usuario para que no sepa que realmente est치 realizando acciones en la aplicaci칩n v칤ctima**.

Encuentra m치s informaci칩n en:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Secuestro de Tareas

Una **actividad** con el **`launchMode`** configurado como **`singleTask` sin ning칰n `taskAffinity`** definido es vulnerable al secuestro de tareas. Esto significa que una **aplicaci칩n** puede ser instalada y si se lanza antes de la aplicaci칩n real, podr칤a **secuestrar la tarea de la aplicaci칩n real** (por lo que el usuario estar치 interactuando con la **aplicaci칩n maliciosa pensando que est치 usando la real**).

M치s informaci칩n en:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Almacenamiento de datos inseguro

**Almacenamiento Interno**

En Android, los archivos **almacenados** en el **almacenamiento interno** est치n **dise침ados** para ser **accesibles** exclusivamente por la **aplicaci칩n** que los **cre칩**. Esta medida de seguridad es **aplicada** por el sistema operativo Android y generalmente es adecuada para las necesidades de seguridad de la mayor칤a de las aplicaciones. Sin embargo, los desarrolladores a veces utilizan modos como `MODE_WORLD_READABLE` y `MODE_WORLD_WRITABLE` para **permitir** que los archivos sean **compartidos** entre diferentes aplicaciones. Sin embargo, estos modos **no restringen el acceso** a estos archivos por otras aplicaciones, incluidas las potencialmente maliciosas.

1. **An치lisis Est치tico:**
* **Aseg칰rate** de que el uso de `MODE_WORLD_READABLE` y `MODE_WORLD_WRITABLE` sea **examinado cuidadosamente**. Estos modos **pueden potencialmente exponer** archivos a **acceso no intencionado o no autorizado**.
2. **An치lisis Din치mico:**
* **Verifica** los **permisos** establecidos en los archivos creados por la aplicaci칩n. Espec칤ficamente, **verifica** si alg칰n archivo est치 **configurado para ser legible o escribible a nivel mundial**. Esto puede representar un riesgo de seguridad significativo, ya que permitir칤a que **cualquier aplicaci칩n** instalada en el dispositivo, independientemente de su origen o intenci칩n, **lea o modifique** estos archivos.

**Almacenamiento Externo**

Al tratar con archivos en **almacenamiento externo**, como tarjetas SD, se deben tomar ciertas precauciones:

1. **Accesibilidad**:
* Los archivos en almacenamiento externo son **globalmente legibles y escribibles**. Esto significa que cualquier aplicaci칩n o usuario puede acceder a estos archivos.
2. **Preocupaciones de Seguridad**:
* Dada la facilidad de acceso, se aconseja **no almacenar informaci칩n sensible** en almacenamiento externo.
* El almacenamiento externo puede ser removido o accedido por cualquier aplicaci칩n, haci칠ndolo menos seguro.
3. **Manejo de Datos desde Almacenamiento Externo**:
* Siempre **realiza validaci칩n de entrada** en los datos recuperados del almacenamiento externo. Esto es crucial porque los datos provienen de una fuente no confiable.
* Almacenar ejecutables o archivos de clase en almacenamiento externo para carga din치mica est치 fuertemente desaconsejado.
* Si tu aplicaci칩n debe recuperar archivos ejecutables del almacenamiento externo, aseg칰rate de que estos archivos est칠n **firmados y verificados criptogr치ficamente** antes de ser cargados din치micamente. Este paso es vital para mantener la integridad de seguridad de tu aplicaci칩n.

El almacenamiento externo puede ser **accedido** en `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
A partir de Android 4.4 (**API 17**), la tarjeta SD tiene una estructura de directorio que **limita el acceso de una aplicaci칩n al directorio que es espec칤ficamente para esa aplicaci칩n**. Esto previene que aplicaciones maliciosas obtengan acceso de lectura o escritura a los archivos de otra aplicaci칩n.
{% endhint %}

**Datos sensibles almacenados en texto claro**

* **Preferencias compartidas**: Android permite a cada aplicaci칩n guardar f치cilmente archivos xml en la ruta `/data/data/<packagename>/shared_prefs/` y a veces es posible encontrar informaci칩n sensible en texto claro en esa carpeta.
* **Bases de datos**: Android permite a cada aplicaci칩n guardar f치cilmente bases de datos sqlite en la ruta `/data/data/<packagename>/databases/` y a veces es posible encontrar informaci칩n sensible en texto claro en esa carpeta.

### TLS Roto

**Aceptar Todos los Certificados**

Por alguna raz칩n, a veces los desarrolladores aceptan todos los certificados incluso si, por ejemplo, el nombre de host no coincide con l칤neas de c칩digo como la siguiente:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
Una buena manera de probar esto es intentar capturar el tr치fico usando alg칰n proxy como Burp sin autorizar Burp CA dentro del dispositivo. Tambi칠n puedes generar con Burp un certificado para un nombre de host diferente y usarlo.

### Criptograf칤a Rota

**Procesos de Gesti칩n de Claves Pobres**

Algunos desarrolladores guardan datos sensibles en el almacenamiento local y los encriptan con una clave codificada/predictible en el c칩digo. Esto no deber칤a hacerse, ya que alguna ingenier칤a inversa podr칤a permitir a los atacantes extraer la informaci칩n confidencial.

**Uso de Algoritmos Inseguros y/o Obsoletos**

Los desarrolladores no deber칤an usar **algoritmos obsoletos** para realizar **verificaciones de autorizaci칩n**, **almacenar** o **enviar** datos. Algunos de estos algoritmos son: RC4, MD4, MD5, SHA1... Si se utilizan **hashes** para almacenar contrase침as, por ejemplo, se deber칤an usar hashes resistentes a **fuerza bruta** con sal.

### Otras verificaciones

* Se recomienda **ofuscar el APK** para dificultar el trabajo de ingenier칤a inversa a los atacantes.
* Si la aplicaci칩n es sensible (como las aplicaciones bancarias), deber칤a realizar sus **propias verificaciones para ver si el m칩vil est치 rooteado** y actuar en consecuencia.
* Si la aplicaci칩n es sensible (como las aplicaciones bancarias), deber칤a verificar si se est치 utilizando un **emulador**.
* Si la aplicaci칩n es sensible (como las aplicaciones bancarias), deber칤a **verificar su propia integridad antes de ejecutarse** para comprobar si ha sido modificada.
* Usa [**APKiD**](https://github.com/rednaga/APKiD) para verificar qu칠 compilador/empaquetador/ofuscador se utiliz칩 para construir el APK.

### Aplicaci칩n React Native

Lee la siguiente p치gina para aprender c칩mo acceder f치cilmente al c칩digo javascript de aplicaciones React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplicaciones Xamarin

Lee la siguiente p치gina para aprender c칩mo acceder f치cilmente al c칩digo C# de aplicaciones xamarin:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Aplicaciones Superempaquetadas

Seg칰n este [**blog**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/), superempaquetado es un algoritmo Meta que comprime el contenido de una aplicaci칩n en un solo archivo. El blog habla sobre la posibilidad de crear una aplicaci칩n que descomprima este tipo de aplicaciones... y una forma m치s r치pida que implica **ejecutar la aplicaci칩n y recopilar los archivos descomprimidos del sistema de archivos.**

### An치lisis Est치tico Automatizado de C칩digo

La herramienta [**mariana-trench**](https://github.com/facebook/mariana-trench) es capaz de encontrar **vulnerabilidades** mediante el **escaneo** del **c칩digo** de la aplicaci칩n. Esta herramienta contiene una serie de **fuentes conocidas** (que indican a la herramienta los **lugares** donde la **entrada** es **controlada por el usuario**), **sumideros** (que indican a la herramienta **lugares peligrosos** donde la entrada maliciosa del usuario podr칤a causar da침os) y **reglas**. Estas reglas indican la **combinaci칩n** de **fuentes-sumideros** que indica una vulnerabilidad.

Con este conocimiento, **mariana-trench revisar치 el c칩digo y encontrar치 posibles vulnerabilidades en 칠l**.

### Secretos filtrados

Una aplicaci칩n puede contener secretos (claves API, contrase침as, URLs ocultas, subdominios...) dentro de ella que podr칤as descubrir. Podr칤as usar una herramienta como [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks).

### Bypass de Autenticaci칩n Biom칠trica

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Otras funciones interesantes

* **Ejecuci칩n de c칩digo**: `Runtime.exec(), ProcessBuilder(), native code:system()`
* **Enviar SMS**: `sendTextMessage, sendMultipartTestMessage`
* **Funciones nativas** declaradas como `native`: `public native, System.loadLibrary, System.load`
* [Lee esto para aprender **c칩mo revertir funciones nativas**](reversing-native-libraries.md)

### **Otros trucos**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

춰칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de bugs!

**Perspectivas de Hacking**\
Invol칰crate con contenido que profundiza en la emoci칩n y los desaf칤os del hacking.

**Noticias de Hackeo en Tiempo Real**\
Mantente al d칤a con el mundo del hacking de ritmo r치pido a trav칠s de noticias e informaci칩n en tiempo real.

**칔ltimos Anuncios**\
Mantente informado sobre las nuevas recompensas por bugs que se lanzan y actualizaciones cruciales de la plataforma.

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo!

***

## An치lisis Din치mico

> Primero que nada, necesitas un entorno donde puedas instalar la aplicaci칩n y todo el entorno (certificado Burp CA, Drozer y Frida principalmente). Por lo tanto, se recomienda encarecidamente un dispositivo rooteado (emulado o no).

### An치lisis din치mico en l칤nea

Puedes crear una **cuenta gratuita** en: [https://appetize.io/](https://appetize.io). Esta plataforma te permite **subir** y **ejecutar** APKs, por lo que es 칰til para ver c칩mo se comporta un apk.

Incluso puedes **ver los registros de tu aplicaci칩n** en la web y conectarte a trav칠s de **adb**.

![](<../../.gitbook/assets/image (831).png>)

Gracias a la conexi칩n ADB, puedes usar **Drozer** y **Frida** dentro de los emuladores.

### An치lisis Din치mico Local

#### Usando un emulador

* [**Android Studio**](https://developer.android.com/studio) (Puedes crear dispositivos **x86** y **arm**, y seg칰n [**esto**](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html) **las 칰ltimas versiones x86** **soportan bibliotecas ARM** sin necesidad de un emulador arm lento).
* Aprende a configurarlo en esta p치gina:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Versi칩n gratuita:** Edici칩n Personal, necesitas crear una cuenta. _Se recomienda **descargar** la versi칩n **CON** _**VirtualBox** para evitar errores potenciales._)
* [**Nox**](https://es.bignox.com) (Gratis, pero no soporta Frida o Drozer).

{% hint style="info" %}
Al crear un nuevo emulador en cualquier plataforma, recuerda que cuanto m치s grande sea la pantalla, m치s lento funcionar치 el emulador. As칤 que selecciona pantallas peque침as si es posible.
{% endhint %}

Para **instalar servicios de google** (como AppStore) en Genymotion, necesitas hacer clic en el bot칩n marcado en rojo de la siguiente imagen:

![](<../../.gitbook/assets/image (277).png>)

Adem치s, ten en cuenta que en la **configuraci칩n de la VM de Android en Genymotion** puedes seleccionar **Modo de Red Bridge** (esto ser치 칰til si te conectar치s a la VM de Android desde una VM diferente con las herramientas).

#### Usar un dispositivo f칤sico

Necesitas activar las **opciones de depuraci칩n** y ser칤a genial si puedes **rootearlo**:

1. **Configuraci칩n**.
2. (Desde Android 8.0) Selecciona **Sistema**.
3. Selecciona **Acerca del tel칠fono**.
4. Presiona **N칰mero de compilaci칩n** 7 veces.
5. Regresa y encontrar치s las **Opciones de desarrollador**.

> Una vez que hayas instalado la aplicaci칩n, lo primero que debes hacer es probarla e investigar qu칠 hace, c칩mo funciona y familiarizarte con ella.\
> Sugerir칤a **realizar este an치lisis din치mico inicial usando MobSF an치lisis din치mico + pidcat**, para que podamos **aprender c칩mo funciona la aplicaci칩n** mientras MobSF **captura** muchos **datos interesantes** que puedes revisar m치s tarde.

### Filtraci칩n de Datos No Intencionada

**Registro**

Los desarrolladores deben tener cuidado de exponer **informaci칩n de depuraci칩n** p칰blicamente, ya que puede llevar a filtraciones de datos sensibles. Se recomiendan las herramientas [**pidcat**](https://github.com/JakeWharton/pidcat) y `adb logcat` para monitorear los registros de la aplicaci칩n y proteger la informaci칩n sensible. **Pidcat** es preferido por su facilidad de uso y legibilidad.

{% hint style="warning" %}
Ten en cuenta que desde **versiones posteriores a Android 4.0**, **las aplicaciones solo pueden acceder a sus propios registros**. As칤 que las aplicaciones no pueden acceder a los registros de otras aplicaciones.\
De todos modos, sigue siendo recomendable **no registrar informaci칩n sensible**.
{% endhint %}

**Cach칠 del Portapapeles**

El marco **basado en portapapeles** de Android permite la funcionalidad de copiar y pegar en las aplicaciones, pero presenta un riesgo ya que **otras aplicaciones** pueden **acceder** al portapapeles, exponiendo potencialmente datos sensibles. Es crucial **deshabilitar las funciones de copiar/pegar** para secciones sensibles de una aplicaci칩n, como los detalles de tarjetas de cr칠dito, para prevenir filtraciones de datos.

**Registros de Fallos**

Si una aplicaci칩n **se bloquea** y **guarda registros**, estos registros pueden ayudar a los atacantes, especialmente cuando la aplicaci칩n no puede ser revertida. Para mitigar este riesgo, evita registrar en caso de fallos, y si los registros deben ser transmitidos a trav칠s de la red, aseg칰rate de que se env칤en a trav칠s de un canal SSL por seguridad.

Como pentester, **intenta echar un vistazo a estos registros**.

**Datos de An치lisis Enviados a Terceros**

Las aplicaciones a menudo integran servicios como Google Adsense, que pueden inadvertidamente **filtrar datos sensibles** debido a una implementaci칩n incorrecta por parte de los desarrolladores. Para identificar posibles filtraciones de datos, es aconsejable **interceptar el tr치fico de la aplicaci칩n** y verificar si se est치 enviando informaci칩n sensible a servicios de terceros.

### Bases de Datos SQLite

La mayor칤a de las aplicaciones utilizar치n **bases de datos SQLite internas** para guardar informaci칩n. Durante el pentest, echa un **vistazo** a las **bases de datos** creadas, los nombres de las **tablas** y **columnas** y todos los **datos** guardados porque podr칤as encontrar **informaci칩n sensible** (lo que ser칤a una vulnerabilidad).\
Las bases de datos deber칤an estar ubicadas en `/data/data/the.package.name/databases` como `/data/data/com.mwr.example.sieve/databases`.

Si la base de datos est치 guardando informaci칩n confidencial y est치 **encriptada** pero puedes **encontrar** la **contrase침a** dentro de la aplicaci칩n, sigue siendo una **vulnerabilidad**.

Enumera las tablas usando `.tables` y enumera las columnas de las tablas haciendo `.schema <table_name>`.

### Drozer (Explotar Actividades, Proveedores de Contenido y Servicios)

De [Drozer Docs](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** te permite **asumir el rol de una aplicaci칩n Android** e interactuar con otras aplicaciones. Puede hacer **cualquier cosa que una aplicaci칩n instalada puede hacer**, como hacer uso del mecanismo de Comunicaci칩n entre Procesos (IPC) de Android e interactuar con el sistema operativo subyacente.\
Drozer es una herramienta 칰til para **explotar actividades exportadas, servicios exportados y Proveedores de Contenido** como aprender치s en las siguientes secciones.

### Explotando Actividades Exportadas

[**Lee esto si quieres refrescar qu칠 es una Actividad de Android.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Tambi칠n recuerda que el c칩digo de una actividad comienza en el **m칠todo `onCreate`**.

**Bypass de Autorizaci칩n**

Cuando una Actividad es exportada, puedes invocar su pantalla desde una aplicaci칩n externa. Por lo tanto, si una actividad con **informaci칩n sensible** est치 **exportada**, podr칤as **eludir** los mecanismos de **autenticaci칩n** **para acceder a ella.**

[**Aprende c칩mo explotar actividades exportadas con Drozer.**](drozer-tutorial/#activities)

Tambi칠n puedes iniciar una actividad exportada desde adb:

* PackageName es com.example.demo
* Exported ActivityName es com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTA**: MobSF detectar치 como malicioso el uso de _**singleTask/singleInstance**_ como `android:launchMode` en una actividad, pero debido a [esto](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), aparentemente esto solo es peligroso en versiones antiguas (versiones de API < 21).

{% hint style="info" %}
Ten en cuenta que un bypass de autorizaci칩n no siempre es una vulnerabilidad, depender치 de c칩mo funcione el bypass y qu칠 informaci칩n est칠 expuesta.
{% endhint %}

**Filtraci칩n de informaci칩n sensible**

**Las actividades tambi칠n pueden devolver resultados**. Si logras encontrar una actividad exportada y desprotegida que llame al m칠todo **`setResult`** y **devuelva informaci칩n sensible**, hay una filtraci칩n de informaci칩n sensible.

#### Tapjacking

Si el tapjacking no se previene, podr칤as abusar de la actividad exportada para hacer que el **usuario realice acciones inesperadas**. Para m치s informaci칩n sobre [**qu칠 es Tapjacking sigue el enlace**](./#tapjacking).

### Explotando Proveedores de Contenido - Accediendo y manipulando informaci칩n sensible

[**Lee esto si quieres refrescar qu칠 es un Proveedor de Contenido.**](android-applications-basics.md#content-provider)\
Los proveedores de contenido se utilizan b치sicamente para **compartir datos**. Si una aplicaci칩n tiene proveedores de contenido disponibles, es posible que puedas **extraer datos sensibles** de ellos. Tambi칠n es interesante probar posibles **inyecciones SQL** y **traversales de ruta** ya que podr칤an ser vulnerables.

[**Aprende c칩mo explotar Proveedores de Contenido con Drozer.**](drozer-tutorial/#content-providers)

### **Explotando Servicios**

[**Lee esto si quieres refrescar qu칠 es un Servicio.**](android-applications-basics.md#services)\
Recuerda que las acciones de un Servicio comienzan en el m칠todo `onStartCommand`.

Un servicio es b치sicamente algo que **puede recibir datos**, **procesarlos** y **devolver** (o no) una respuesta. Entonces, si una aplicaci칩n est치 exportando algunos servicios, deber칤as **verificar** el **c칩digo** para entender qu칠 est치 haciendo y **probarlo** **din치micamente** para extraer informaci칩n confidencial, eludir medidas de autenticaci칩n...\
[**Aprende c칩mo explotar Servicios con Drozer.**](drozer-tutorial/#services)

### **Explotando Receptores de Difusi칩n**

[**Lee esto si quieres refrescar qu칠 es un Receptor de Difusi칩n.**](android-applications-basics.md#broadcast-receivers)\
Recuerda que las acciones de un Receptor de Difusi칩n comienzan en el m칠todo `onReceive`.

Un receptor de difusi칩n estar치 esperando un tipo de mensaje. Dependiendo de c칩mo el receptor maneje el mensaje, podr칤a ser vulnerable.\
[**Aprende c칩mo explotar Receptores de Difusi칩n con Drozer.**](./#exploiting-broadcast-receivers)

### **Explotando Esquemas / Enlaces profundos**

Puedes buscar enlaces profundos manualmente, utilizando herramientas como MobSF o scripts como [este](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Puedes **abrir** un **esquema** declarado usando **adb** o un **navegador**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Tenga en cuenta que puede **omitir el nombre del paquete** y el m칩vil llamar치 autom치ticamente a la aplicaci칩n que deber칤a abrir ese enlace._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**C칩digo ejecutado**

Para encontrar el **c칩digo que se ejecutar치 en la App**, ve a la actividad llamada por el deeplink y busca la funci칩n **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informaci칩n sensible**

Cada vez que encuentres un deep link verifica que **no est칠 recibiendo datos sensibles (como contrase침as) a trav칠s de par치metros de URL**, porque cualquier otra aplicaci칩n podr칤a **suplantar el deep link y robar esos datos!**

**Par치metros en la ruta**

Debes **verificar tambi칠n si alg칰n deep link est치 utilizando un par치metro dentro de la ruta** de la URL como: `https://api.example.com/v1/users/{username}`, en ese caso puedes forzar un recorrido de ruta accediendo a algo como: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Ten en cuenta que si encuentras los endpoints correctos dentro de la aplicaci칩n, podr칤as causar un **Open Redirect** (si parte de la ruta se usa como nombre de dominio), **toma de control de cuenta** (si puedes modificar los detalles de los usuarios sin un token CSRF y el endpoint vulnerable us칩 el m칠todo correcto) y cualquier otra vulnerabilidad. M치s [info sobre esto aqu칤](http://dphoeniixx.com/2020/12/13-2/).

**M치s ejemplos**

Un [informe de bug bounty interesante](https://hackerone.com/reports/855618) sobre enlaces (_/.well-known/assetlinks.json_).

### Fallos en la Inspecci칩n y Verificaci칩n de la Capa de Transporte

* **Los certificados no siempre son inspeccionados adecuadamente** por las aplicaciones de Android. Es com칰n que estas aplicaciones pasen por alto advertencias y acepten certificados autofirmados o, en algunos casos, vuelvan a usar conexiones HTTP.
* **Las negociaciones durante el apret칩n de manos SSL/TLS a veces son d칠biles**, empleando suites de cifrado inseguras. Esta vulnerabilidad hace que la conexi칩n sea susceptible a ataques de hombre en el medio (MITM), permitiendo a los atacantes descifrar los datos.
* **La filtraci칩n de informaci칩n privada** es un riesgo cuando las aplicaciones se autentican utilizando canales seguros pero luego se comunican a trav칠s de canales no seguros para otras transacciones. Este enfoque no protege los datos sensibles, como cookies de sesi칩n o detalles del usuario, de la interceptaci칩n por entidades maliciosas.

#### Verificaci칩n de Certificados

Nos centraremos en la **verificaci칩n de certificados**. La integridad del certificado del servidor debe ser verificada para mejorar la seguridad. Esto es crucial porque configuraciones TLS inseguras y la transmisi칩n de datos sensibles a trav칠s de canales no encriptados pueden representar riesgos significativos. Para pasos detallados sobre c칩mo verificar certificados de servidor y abordar vulnerabilidades, [**este recurso**](https://manifestsecurity.com/android-application-security-part-10/) proporciona una gu칤a completa.

#### SSL Pinning

SSL Pinning es una medida de seguridad donde la aplicaci칩n verifica el certificado del servidor contra una copia conocida almacenada dentro de la propia aplicaci칩n. Este m칠todo es esencial para prevenir ataques MITM. Se recomienda encarecidamente implementar SSL Pinning para aplicaciones que manejan informaci칩n sensible.

#### Inspecci칩n de Tr치fico

Para inspeccionar el tr치fico HTTP, es necesario **instalar el certificado de la herramienta proxy** (por ejemplo, Burp). Sin instalar este certificado, el tr치fico encriptado podr칤a no ser visible a trav칠s del proxy. Para una gu칤a sobre c칩mo instalar un certificado CA personalizado, [**haz clic aqu칤**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine).

Las aplicaciones que apuntan a **API Level 24 y superiores** requieren modificaciones en la Configuraci칩n de Seguridad de Red para aceptar el certificado CA del proxy. Este paso es cr칤tico para inspeccionar tr치fico encriptado. Para instrucciones sobre c칩mo modificar la Configuraci칩n de Seguridad de Red, [**consulta este tutorial**](make-apk-accept-ca-certificate.md).

#### Bypass de SSL Pinning

Cuando se implementa SSL Pinning, es necesario eludirlo para inspeccionar el tr치fico HTTPS. Existen varios m칠todos disponibles para este prop칩sito:

* Modificar **autom치ticamente** el **apk** para **eludir** SSLPinning con [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). La mejor ventaja de esta opci칩n es que no necesitar치s root para eludir el SSL Pinning, pero deber치s eliminar la aplicaci칩n y reinstalar la nueva, y esto no siempre funcionar치.
* Podr칤as usar **Frida** (discutido a continuaci칩n) para eludir esta protecci칩n. Aqu칤 tienes una gu칤a para usar Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Tambi칠n puedes intentar **eludir autom치ticamente SSL Pinning** usando [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Tambi칠n puedes intentar **eludir autom치ticamente SSL Pinning** usando **an치lisis din치mico de MobSF** (explicado a continuaci칩n)
* Si a칰n piensas que hay tr치fico que no est치s capturando, puedes intentar **redirigir el tr치fico a burp usando iptables**. Lee este blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### B칰squeda de Vulnerabilidades Web Comunes

Tambi칠n es importante buscar vulnerabilidades web comunes dentro de la aplicaci칩n. La informaci칩n detallada sobre c칩mo identificar y mitigar estas vulnerabilidades est치 m치s all치 del alcance de este resumen, pero se cubre extensamente en otros lugares.

### Frida

[Frida](https://www.frida.re) es un kit de herramientas de instrumentaci칩n din치mica para desarrolladores, ingenieros de reversa e investigadores de seguridad.\
**Puedes acceder a la aplicaci칩n en ejecuci칩n y enganchar m칠todos en tiempo de ejecuci칩n para cambiar el comportamiento, cambiar valores, extraer valores, ejecutar diferentes c칩digos...**\
Si deseas hacer pentesting en aplicaciones de Android, necesitas saber c칩mo usar Frida.

* Aprende a usar Frida: [**Tutorial de Frida**](frida-tutorial/)
* Algunas "GUI" para acciones con Frida: [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection es excelente para automatizar el uso de Frida: [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* Puedes encontrar algunos scripts de Frida geniales aqu칤: [**https://codeshare.frida.re/**](https://codeshare.frida.re)
* Intenta eludir mecanismos de anti-debugging / anti-frida cargando Frida como se indica en [https://erfur.github.io/blog/dev/code-injection-without-ptrace](https://erfur.github.io/blog/dev/code-injection-without-ptrace) (herramienta [linjector](https://github.com/erfur/linjector-rs))

### **Volcar Memoria - Fridump**

Verifica si la aplicaci칩n est치 almacenando informaci칩n sensible en la memoria que no deber칤a estar almacenando, como contrase침as o mnemot칠cnicas.

Usando [**Fridump3**](https://github.com/rootbsd/fridump3) puedes volcar la memoria de la app con:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Esto volcar치 la memoria en la carpeta ./dump, y all칤 podr칤as grep con algo como: 

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Datos sensibles en Keystore**

En Android, el Keystore es el mejor lugar para almacenar datos sensibles, sin embargo, con suficientes privilegios, **es posible acceder a 칠l**. Dado que las aplicaciones tienden a almacenar aqu칤 **datos sensibles en texto claro**, las pruebas de penetraci칩n deber칤an verificarlo como usuario root o alguien con acceso f칤sico al dispositivo podr칤a ser capaz de robar estos datos.

Incluso si una aplicaci칩n almacena datos en el keystore, los datos deber칤an estar cifrados.

Para acceder a los datos dentro del keystore, podr칤as usar este script de Frida: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Bypass de huellas dactilares/bio-m칠tricas**

Usando el siguiente script de Frida, podr칤a ser posible **eludir la autenticaci칩n por huellas dactilares** que las aplicaciones de Android podr칤an estar realizando para **proteger ciertas 치reas sensibles:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Im치genes de Fondo**

Cuando pones una aplicaci칩n en segundo plano, Android almacena un **instant치nea de la aplicaci칩n** para que cuando se recupere al primer plano, comience a cargar la imagen antes de que la aplicaci칩n, por lo que parece que la aplicaci칩n se carg칩 m치s r치pido.

Sin embargo, si esta instant치nea contiene **informaci칩n sensible**, alguien con acceso a la instant치nea podr칤a **robar esa informaci칩n** (ten en cuenta que necesitas root para acceder a ella).

Las instant치neas generalmente se almacenan en: **`/data/system_ce/0/snapshots`**

Android proporciona una manera de **prevenir la captura de pantalla configurando el par치metro de dise침o FLAG\_SECURE**. Al usar esta bandera, el contenido de la ventana se trata como seguro, impidiendo que aparezca en capturas de pantalla o que se vea en pantallas no seguras.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analizador de Aplicaciones Android**

Esta herramienta puede ayudarte a gestionar diferentes herramientas durante el an치lisis din치mico: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Inyecci칩n de Intents

Los desarrolladores a menudo crean componentes proxy como actividades, servicios y receptores de difusi칩n que manejan estos Intents y los pasan a m칠todos como `startActivity(...)` o `sendBroadcast(...)`, lo que puede ser arriesgado.

El peligro radica en permitir que los atacantes activen componentes de la aplicaci칩n no exportados o accedan a proveedores de contenido sensibles al desviar estos Intents. Un ejemplo notable es el componente `WebView` que convierte URLs en objetos `Intent` a trav칠s de `Intent.parseUri(...)` y luego los ejecuta, lo que puede llevar a inyecciones de Intent maliciosas.

### Puntos Clave Esenciales

* **Inyecci칩n de Intents** es similar al problema de Redirecci칩n Abierta en la web.
* Los exploits implican pasar objetos `Intent` como extras, que pueden ser redirigidos para ejecutar operaciones inseguras.
* Puede exponer componentes no exportados y proveedores de contenido a los atacantes.
* La conversi칩n de URL a `Intent` de `WebView` puede facilitar acciones no intencionadas.

### Inyecciones del Lado del Cliente de Android y otros

Probablemente conozcas este tipo de vulnerabilidades de la web. Debes tener especial cuidado con estas vulnerabilidades en una aplicaci칩n Android:

* **Inyecci칩n SQL:** Al tratar con consultas din치micas o Content-Providers, aseg칰rate de usar consultas parametrizadas.
* **Inyecci칩n de JavaScript (XSS):** Verifica que el soporte de JavaScript y Plugins est칠 deshabilitado para cualquier WebView (deshabilitado por defecto). [M치s informaci칩n aqu칤](webview-attacks.md#javascript-enabled).
* **Inclusi칩n de Archivos Locales:** Los WebViews deben tener el acceso al sistema de archivos deshabilitado (habilitado por defecto) - `(webview.getSettings().setAllowFileAccess(false);)`. [M치s informaci칩n aqu칤](webview-attacks.md#javascript-enabled).
* **Cookies Eternas**: En varios casos, cuando la aplicaci칩n android finaliza la sesi칩n, la cookie no se revoca o incluso podr칤a guardarse en el disco.
* [**Secure Flag** en cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

춰칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores!

**Perspectivas de Hacking**\
Participa en contenido que profundiza en la emoci칩n y los desaf칤os del hacking.

**Noticias de Hackeo en Tiempo Real**\
Mantente al d칤a con el mundo del hacking de ritmo r치pido a trav칠s de noticias e informaci칩n en tiempo real.

**칔ltimos Anuncios**\
Mantente informado sobre las nuevas recompensas por errores que se lanzan y actualizaciones cruciales de la plataforma.

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo!

## An치lisis Autom치tico

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**An치lisis est치tico**

![](<../../.gitbook/assets/image (866).png>)

**Evaluaci칩n de vulnerabilidades de la aplicaci칩n** utilizando un bonito frontend basado en la web. Tambi칠n puedes realizar an치lisis din치mico (pero necesitas preparar el entorno).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Notice que MobSF puede analizar **Android**(apk)**, IOS**(ipa) **y Windows**(apx) aplicaciones (_Las aplicaciones de Windows deben ser analizadas desde un MobSF instalado en un host de Windows_).\
Adem치s, si creas un **ZIP** con el c칩digo fuente de una **Android** o una **IOS** app (ve a la carpeta ra칤z de la aplicaci칩n, selecciona todo y crea un archivo ZIP), tambi칠n podr치 analizarlo.

MobSF tambi칠n te permite **diff/Comparar** an치lisis e integrar **VirusTotal** (necesitar치s configurar tu clave API en _MobSF/settings.py_ y habilitarlo: `VT_ENABLED = TRUE` `VT_API_KEY = <Tu clave API>` `VT_UPLOAD = TRUE`). Tambi칠n puedes establecer `VT_UPLOAD` en `False`, entonces el **hash** ser치 **subido** en lugar del archivo.

### An치lisis din치mico asistido con MobSF

**MobSF** tambi칠n puede ser muy 칰til para el **an치lisis din치mico** en **Android**, pero en ese caso necesitar치s instalar MobSF y **genymotion** en tu host (una VM o Docker no funcionar치). _Nota: Necesitas **iniciar primero una VM en genymotion** y **luego MobSF.**_\
El **analizador din치mico de MobSF** puede:

* **Volcar datos de la aplicaci칩n** (URLs, registros, portapapeles, capturas de pantalla hechas por ti, capturas de pantalla hechas por "**Exported Activity Tester**", correos electr칩nicos, bases de datos SQLite, archivos XML y otros archivos creados). Todo esto se hace autom치ticamente excepto por las capturas de pantalla, necesitas presionar cuando quieras una captura de pantalla o necesitas presionar "**Exported Activity Tester**" para obtener capturas de pantalla de todas las actividades exportadas.
* Capturar **tr치fico HTTPS**
* Usar **Frida** para obtener **informaci칩n** **en tiempo de ejecuci칩n**

Desde las versiones de Android **> 5**, **iniciar치 autom치ticamente Frida** y establecer치 configuraciones de **proxy** globales para **capturar** tr치fico. Solo capturar치 tr치fico de la aplicaci칩n probada.

**Frida**

Por defecto, tambi칠n usar치 algunos scripts de Frida para **eludir la fijaci칩n de SSL**, **detecci칩n de root** y **detecci칩n de depurador** y para **monitorear APIs interesantes**.\
MobSF tambi칠n puede **invocar actividades exportadas**, tomar **capturas de pantalla** de ellas y **guardarlas** para el informe.

Para **iniciar** la prueba din치mica presiona el bot칩n verde: "**Start Instrumentation**". Presiona "**Frida Live Logs**" para ver los registros generados por los scripts de Frida y "**Live API Monitor**" para ver todas las invocaciones a m칠todos enganchados, argumentos pasados y valores devueltos (esto aparecer치 despu칠s de presionar "Start Instrumentation").\
MobSF tambi칠n te permite cargar tus propios **scripts de Frida** (para enviar los resultados de tus scripts de Frida a MobSF usa la funci칩n `send()`). Tambi칠n tiene **varios scripts preescritos** que puedes cargar (puedes agregar m치s en `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), solo **selecci칩nalos**, presiona "**Load**" y presiona "**Start Instrumentation**" (podr치s ver los registros de esos scripts dentro de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (419).png>)

Adem치s, tienes algunas funcionalidades auxiliares de Frida:

* **Enumerar Clases Cargadas**: Imprimir치 todas las clases cargadas
* **Capturar Cadenas**: Imprimir치 todas las cadenas capturadas mientras usas la aplicaci칩n (muy ruidoso)
* **Capturar Comparaciones de Cadenas**: Podr칤a ser muy 칰til. **Mostrar치 las 2 cadenas que se est치n comparando** y si el resultado fue Verdadero o Falso.
* **Enumerar M칠todos de Clase**: Pon el nombre de la clase (como "java.io.File") e imprimir치 todos los m칠todos de la clase.
* **Buscar Patr칩n de Clase**: Buscar clases por patr칩n
* **Rastrear M칠todos de Clase**: **Rastrear** una **clase completa** (ver entradas y salidas de todos los m칠todos de la clase). Recuerda que por defecto MobSF rastrea varios m칠todos interesantes de la API de Android.

Una vez que hayas seleccionado el m칩dulo auxiliar que deseas usar, necesitas presionar "**Start Intrumentation**" y ver치s todas las salidas en "**Frida Live Logs**".

**Shell**

MobSF tambi칠n te ofrece una shell con algunos comandos **adb**, **comandos de MobSF**, y comandos comunes de **shell** en la parte inferior de la p치gina de an치lisis din치mico. Algunos comandos interesantes:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Herramientas HTTP**

Cuando se captura el tr치fico http, puedes ver una vista fea del tr치fico capturado en "**HTTP(S) Traffic**" en la parte inferior o una vista m치s agradable en el bot칩n verde "**Start HTTPTools**". Desde la segunda opci칩n, puedes **enviar** las **solicitudes capturadas** a **proxies** como Burp o Owasp ZAP.\
Para hacerlo, _enciende Burp -->_ _apaga Intercept --> en MobSB HTTPTools selecciona la solicitud_ --> presiona "**Send to Fuzzer**" --> _selecciona la direcci칩n del proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Una vez que termines el an치lisis din치mico con MobSF, puedes presionar en "**Start Web API Fuzzer**" para **fuzz http requests** y buscar vulnerabilidades.

{% hint style="info" %}
Despu칠s de realizar un an치lisis din치mico con MobSF, la configuraci칩n del proxy puede estar mal configurada y no podr치s solucionarlo desde la GUI. Puedes corregir la configuraci칩n del proxy haciendo:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### An치lisis Din치mico Asistido con Inspeckage

Puedes obtener la herramienta de [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Esta herramienta utilizar치 algunos **Hooks** para informarte **qu칠 est치 sucediendo en la aplicaci칩n** mientras realizas un **an치lisis din치mico**.

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Esta es una **gran herramienta para realizar an치lisis est치tico con una GUI**

![](<../../.gitbook/assets/image (741).png>)

### [Qark](https://github.com/linkedin/qark)

Esta herramienta est치 dise침ada para buscar varias **vulnerabilidades relacionadas con la seguridad de aplicaciones Android**, ya sea en **c칩digo fuente** o **APKs empaquetados**. La herramienta tambi칠n es **capaz de crear un APK "Proof-of-Concept" desplegable** y **comandos ADB**, para explotar algunas de las vulnerabilidades encontradas (Actividades expuestas, intents, tapjacking...). Al igual que con Drozer, no es necesario rootear el dispositivo de prueba.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Muestra todos los archivos extra칤dos para una f치cil referencia
* Descompone autom치ticamente archivos APK a formato Java y Smali
* Analiza AndroidManifest.xml en busca de vulnerabilidades comunes y comportamiento
* An치lisis est치tico del c칩digo fuente para vulnerabilidades y comportamiento comunes
* Informaci칩n del dispositivo
* y m치s
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER es una aplicaci칩n de l칤nea de comandos que se puede utilizar en Windows, MacOS X y Linux, que analiza archivos _.apk_ en busca de vulnerabilidades. Lo hace descomprimiendo APKs y aplicando una serie de reglas para detectar esas vulnerabilidades.

Todas las reglas est치n centradas en un archivo `rules.json`, y cada empresa o probador podr칤a crear sus propias reglas para analizar lo que necesiten.

Descargue los 칰ltimos binarios en la [p치gina de descarga](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (297).png>)

StaCoAn es una herramienta **multiplataforma** que ayuda a desarrolladores, cazadores de bugs y hackers 칠ticos a realizar [an치lisis de c칩digo est치tico](https://en.wikipedia.org/wiki/Static\_program\_analysis) en aplicaciones m칩viles.

El concepto es que arrastras y sueltas tu archivo de aplicaci칩n m칩vil (un archivo .apk o .ipa) en la aplicaci칩n StaCoAn y generar치 un informe visual y port치til para ti. Puedes ajustar la configuraci칩n y las listas de palabras para obtener una experiencia personalizada.

Descargar [칰ltima versi칩n](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework es un sistema de an치lisis de vulnerabilidades de Android que ayuda a los desarrolladores o hackers a encontrar posibles vulnerabilidades de seguridad en aplicaciones de Android.\
[Windows releases](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** es una herramienta cuyo objetivo principal es detectar y advertir al usuario sobre comportamientos potencialmente maliciosos desarrollados por una aplicaci칩n de Android.

La detecci칩n se realiza con el **an치lisis est치tico** del bytecode Dalvik de la aplicaci칩n, representado como **Smali**, con la biblioteca [`androguard`](https://github.com/androguard/androguard).

Esta herramienta busca **comportamientos comunes de aplicaciones "malas"** como: exfiltraci칩n de identificadores de telefon칤a, interceptaci칩n de flujos de audio/video, modificaci칩n de datos PIM, ejecuci칩n de c칩digo arbitrario...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA\_Framework)

![](<../../.gitbook/assets/image (595).png>)

**MARA** es un **M**obile **A**pplication **R**everse engineering y **A**nalysis Framework. Es una herramienta que re칰ne herramientas com칰nmente utilizadas para la ingenier칤a inversa y an치lisis de aplicaciones m칩viles, para ayudar en la prueba de aplicaciones m칩viles contra las amenazas de seguridad m칩vil de OWASP. Su objetivo es facilitar esta tarea y hacerla m치s amigable para los desarrolladores de aplicaciones m칩viles y profesionales de seguridad.

Es capaz de:

* Extraer c칩digo Java y Smali usando diferentes herramientas
* Analizar APKs usando: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs\_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extraer informaci칩n privada del APK usando regexps.
* Analizar el Manifest.
* Analizar dominios encontrados usando: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) y [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Deofuscar APK a trav칠s de [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

칔til para detectar malware: [https://koodous.com/](https://koodous.com)

## Ofuscando/Deofuscando c칩digo

Tenga en cuenta que dependiendo del servicio y la configuraci칩n que utilice para ofuscar el c칩digo. Los secretos pueden o no terminar ofuscados.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

De [Wikipedia](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** es una herramienta de l칤nea de comandos de c칩digo abierto que reduce, optimiza y ofusca c칩digo Java. Es capaz de optimizar bytecode as칤 como detectar y eliminar instrucciones no utilizadas. ProGuard es software libre y se distribuye bajo la Licencia P칰blica General de GNU, versi칩n 2.

ProGuard se distribuye como parte del SDK de Android y se ejecuta al construir la aplicaci칩n en modo de lanzamiento.

### [DexGuard](https://www.guardsquare.com/dexguard)

Encuentra una gu칤a paso a paso para deofuscar el apk en [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(De esa gu칤a) La 칰ltima vez que verificamos, el modo de operaci칩n de Dexguard era:

* cargar un recurso como un InputStream;
* alimentar el resultado a una clase que hereda de FilterInputStream para descifrarlo;
* hacer alguna ofuscaci칩n in칰til para desperdiciar unos minutos del tiempo de un reversor;
* alimentar el resultado descifrado a un ZipInputStream para obtener un archivo DEX;
* finalmente cargar el DEX resultante como un Recurso usando el m칠todo `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard revierte el proceso de ofuscaci칩n realizado por herramientas de ofuscaci칩n de Android. Esto permite numerosos an치lisis de seguridad, incluyendo inspecci칩n de c칩digo y predicci칩n de bibliotecas.**

Puedes subir un APK ofuscado a su plataforma.

### [Simplify](https://github.com/CalebFenton/simplify)

Es un **deofuscador gen칠rico de android.** Simplify **ejecuta virtualmente una aplicaci칩n** para entender su comportamiento y luego **intenta optimizar el c칩digo** para que se comporte de manera id칠ntica pero sea m치s f치cil de entender para un humano. Cada tipo de optimizaci칩n es simple y gen칠rico, por lo que no importa qu칠 tipo espec칤fico de ofuscaci칩n se utilice.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD te da informaci칩n sobre **c칩mo se hizo un APK**. Identifica muchos **compiladores**, **empaquetadores**, **ofuscadores**, y otras cosas extra침as. Es [_PEiD_](https://www.aldeid.com/wiki/PEiD) para Android.

### Manual

[Lee este tutorial para aprender algunos trucos sobre **c칩mo revertir la ofuscaci칩n personalizada**](manual-deobfuscation.md)

## Labs

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b es una m치quina virtual de seguridad de Android basada en ubuntu-mate que incluye la colecci칩n de los 칰ltimos frameworks, tutoriales y laboratorios de diferentes expertos en seguridad e investigadores para ingenier칤a inversa y an치lisis de malware.

## Referencias

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) Es una gran lista de recursos
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Curso r치pido de Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## A칰n por probar

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

칔nete al [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores!

**Perspectivas de Hacking**\
Participa en contenido que profundiza en la emoci칩n y los desaf칤os del hacking

**Noticias de Hackeo en Tiempo Real**\
Mantente al d칤a con el mundo del hacking de ritmo r치pido a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre las nuevas recompensas por errores que se lanzan y actualizaciones cruciales de la plataforma

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
