# Testowanie penetracyjne aplikacji na Androida

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Spojrzenie na Hacking**\
Zajmij si treciami, kt贸re zagbiaj si w emocje i wyzwania hackowania

**Aktualnoci z Hackingu na 呕ywo**\
Bd藕 na bie偶co z szybkim tempem wiata hackowania dziki aktualnociom i spojrzeniom na 偶ywo

**Najnowsze Ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i istotnymi aktualizacjami platform

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

## Podstawy Aplikacji na Androida

Zaleca si rozpoczcie czytania tej strony, aby dowiedzie si o **najwa偶niejszych czciach zwizanych z bezpieczestwem Androida i najbardziej niebezpiecznych komponentach w aplikacji na Androida**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

To g贸wne narzdzie, kt贸rego potrzebujesz do poczenia z urzdzeniem Android (emulowanym lub fizycznym).\
**ADB** pozwala na kontrol urzdze zar贸wno przez **USB**, jak i przez **Sie** z komputera. Narzdzie to umo偶liwia **kopiowanie** plik贸w w obie strony, **instalacj** i **odinstalowanie** aplikacji, **wykonywanie** polece powoki, **tworzenie kopii zapasowych** danych, **czytanie** log贸w, midzy innymi funkcje.

Zajrzyj do poni偶szej listy [**Polecenia ADB**](adb-commands.md), aby dowiedzie si, jak korzysta z adb.

## Smali

Czasami interesujce jest **modyfikowanie kodu aplikacji**, aby uzyska dostp do **ukrytych informacji** (by mo偶e dobrze zaszyfrowanych hase lub flag). W takim przypadku mo偶e by interesujce zdekompilowanie pliku apk, zmodyfikowanie kodu i ponowne skompilowanie go.\
[W tym samouczku](smali-changes.md) mo偶esz **dowiedzie si, jak zdekompilowa plik APK, zmodyfikowa kod Smali i ponownie skompilowa APK** z now funkcjonalnoci. Mo偶e to by bardzo przydatne jako **alternatywa dla kilku test贸w podczas analizy dynamicznej**, kt贸re zostan przedstawione. Nastpnie **zawsze pamitaj o tej mo偶liwoci**.

## Inne interesujce sztuczki

* [Podrabianie lokalizacji w Sklepie Play](spoofing-your-location-in-play-store.md)
* **Pobierz APK**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Wyodrbnij APK z urzdzenia:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## Analiza statyczna

Po pierwsze, aby przeanalizowa plik APK, powiniene **przejrze kod Javy** za pomoc dekompilatora.\
Prosz, [**zapoznaj si tutaj z informacjami o dostpnych dekompilatorach**](apk-decompilers.md).

### Szukanie interesujcych informacji

Po prostu przegldajc **cigi znak贸w** w pliku APK, mo偶esz szuka **hase**, **adres贸w URL** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **kluczy API**, **szyfrowania**, **identyfikator贸w bluetooth**, **token贸w** i wszystkiego, co mo偶e by interesujce... poszukaj nawet **tylnych drzwi** do wykonania kodu lub tylnych drzwi uwierzytelniania (wbudowane powiadczenia administratora w aplikacji).

**Firebase**

Zwr贸 szczeg贸ln uwag na **adresy URL Firebase** i sprawd藕, czy s 藕le skonfigurowane. [Wicej informacji na temat Firebase i jak go wykorzysta znajdziesz tutaj.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Podstawowe zrozumienie aplikacji - Manifest.xml, strings.xml

**Analiza plik贸w \_Manifest.xml** i **strings.xml** aplikacji mo偶e ujawni potencjalne podatnoci bezpieczestwa. Te pliki mo偶na uzyska za pomoc dekompilator贸w lub zmieniajc rozszerzenie pliku APK na .zip, a nastpnie rozpakowujc go.

Zidentyfikowane z **Manifest.xml** **podatnoci** obejmuj:

* **Aplikacje debugowalne**: Aplikacje ustawione jako debugowalne (`debuggable="true"`) w pliku _Manifest.xml_ stanowi ryzyko, poniewa偶 pozwalaj na poczenia, kt贸re mog prowadzi do eksploatacji. Aby lepiej zrozumie, jak wykorzysta aplikacje debugowalne, zapoznaj si z samouczkiem dotyczcym znajdowania i eksploatowania aplikacji debugowalnych na urzdzeniu.
* **Ustawienia kopii zapasowych**: Atrybut `android:allowBackup="false"` powinien by jawnie ustawiony dla aplikacji zajmujcych si wra偶liwymi informacjami, aby zapobiec nieautoryzowanym kopiom zapasowym danych za pomoc adb, zwaszcza gdy jest wczone debugowanie USB.
* **Bezpieczestwo sieci**: Niestandardowe konfiguracje bezpieczestwa sieciowego (`android:networkSecurityConfig="@xml/network_security_config"`) w _res/xml/_ mog okrela szczeg贸y dotyczce bezpieczestwa, takie jak pinezki certyfikat贸w i ustawienia ruchu HTTP. Przykadem jest zezwolenie na ruch HTTP dla okrelonych domen.
* **Eksportowane aktywnoci i usugi**: Identyfikacja eksportowanych aktywnoci i usug w manifecie mo偶e ujawni komponenty, kt贸re mog by nadu偶ywane. Dalsza analiza podczas test贸w dynamicznych mo偶e ujawni, jak wykorzysta te komponenty.
* **Dostawcy treci i dostawcy plik贸w**: Eksponowani dostawcy treci mog umo偶liwi nieautoryzowany dostp lub modyfikacj danych. Konfiguracja dostawc贸w plik贸w r贸wnie偶 powinna by dokadnie przeanalizowana.
* **Odbiorniki nadawcze i schematy URL**: Te komponenty mog by wykorzystane do eksploatacji, ze szczeg贸lnym uwzgldnieniem zarzdzania schematami URL w celu wykrycia podatnoci na wejcie.
* **Wersje SDK**: Atrybuty `minSdkVersion`, `targetSDKVersion` i `maxSdkVersion` wskazuj obsugiwane wersje Androida, podkrelajc wa偶no nieobsugiwania przestarzaych, podatnych wersji Androida ze wzgld贸w bezpieczestwa.

Z pliku **strings.xml** mo偶na odkry wra偶liwe informacje, takie jak klucze API, niestandardowe schematy i inne notatki dewelopera, podkrelajc potrzeb dokadnego przejrzenia tych zasob贸w.

### Tapjacking

**Tapjacking** to atak, w kt贸rym **zoliwa aplikacja** jest uruchamiana i **pozycjonuje si na wierzchu aplikacji ofiary**. Gdy zasania widocznie aplikacj ofiary, jej interfejs u偶ytkownika jest zaprojektowany w taki spos贸b, aby oszuka u偶ytkownika do interakcji z ni, podczas gdy przekazuje interakcj do aplikacji ofiary.\
W rezultacie **oszukuje u偶ytkownika, aby nie zdawa sobie sprawy, 偶e faktycznie wykonuje akcje w aplikacji ofiary**.

Znajd藕 wicej informacji tutaj:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Przechwytywanie zada

**Aktywno** z ustawionym **`launchMode`** na **`singleTask` bez zdefiniowanego `taskAffinity`** jest podatna na przechwytywanie zada. Oznacza to, 偶e **aplikacja** mo偶e zosta zainstalowana i jeli zostanie uruchomiona przed prawdziw aplikacj, mo偶e **przechwyci zadanie prawdziwej aplikacji** (u偶ytkownik bdzie wic interagowa z **zoliw aplikacj mylc, 偶e u偶ywa tej prawdziwej**).

Wicej informacji:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Nieszyfrowane przechowywanie danych

**Pami wewntrzna**

W systemie Android pliki **przechowywane** w **pamici wewntrznej** s **przeznaczone** do **dostpu** wycznie przez **aplikacj**, kt贸ra je **utworzya**. Ta zabezpieczenie jest **egzekwowane** przez system operacyjny Android i zazwyczaj jest wystarczajce dla wikszoci aplikacji. Jednak deweloperzy czasami korzystaj z tryb贸w takich jak `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE`, aby **umo偶liwi** udostpnianie plik贸w midzy r贸偶nymi aplikacjami. Niemniej jednak te tryby **nie ograniczaj dostpu** do tych plik贸w przez inne aplikacje, w tym potencjalnie zoliwe.

1. **Analiza statyczna:**
* **Upewnij si**, 偶e korzystanie z `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE` jest **dokadnie przeanalizowane**. Te tryby **mog potencjalnie ujawni** pliki do **niezamierzonego lub nieautoryzowanego dostpu**.
2. **Analiza dynamiczna:**
* **Zweryfikuj** uprawnienia ustawione dla plik贸w utworzonych przez aplikacj. W szczeg贸lnoci **sprawd藕**, czy jakiekolwiek pliki s **ustawione jako czytelne lub zapisywalne globalnie**. Mo偶e to stanowi znaczne ryzyko bezpieczestwa, poniewa偶 pozwolioby to **dowolnej aplikacji** zainstalowanej na urzdzeniu, bez wzgldu na jej pochodzenie lub intencje, na **odczytanie lub modyfikacj** tych plik贸w.

**Pami zewntrzna**

Przy pracy z plikami na **pamici zewntrznej**, takich jak karty SD, nale偶y podj pewne rodki ostro偶noci:

1. **Dostpno**:
* Pliki na pamici zewntrznej s **globalnie czytelne i zapisywalne**. Oznacza to, 偶e dowolna aplikacja lub u偶ytkownik mo偶e uzyska dostp do tych plik贸w.
2. **Zagro偶enia bezpieczestwa**:
* Ze wzgldu na atwo dostpu, zaleca si **nie przechowywa wra偶liwych informacji** na pamici zewntrznej.
* Pami zewntrzna mo偶e by usunita lub dostpna dla dowolnej aplikacji, co czyni j mniej bezpieczn.
3. **Obsuga danych z pamici zewntrznej**:
* Zawsze **wykonuj walidacj danych** pobranych z pamici zewntrznej. Jest to istotne, poniewa偶 dane pochodz z niezaufanego 藕r贸da.
* Przechowywanie plik贸w wykonywalnych lub plik贸w klas na pamici zewntrznej w celu dynamicznego adowania jest zdecydowanie odradzane.
* Jeli Twoja aplikacja musi pobiera pliki wykonywalne z pamici zewntrznej, upewnij si, 偶e te pliki s **podpisane i weryfikowane kryptograficznie** przed ich dynamicznym adowaniem. Ten krok jest kluczowy dla zachowania integralnoci bezpieczestwa Twojej aplikacji.

Do pamici zewntrznej mo偶na **uzyska dostp** w `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
Poczwszy od Androida 4.4 (**API 17**), karta SD ma struktur katalog贸w, kt贸ra **ogranicza dostp z aplikacji do katalogu przeznaczonego specjalnie dla tej aplikacji**. Zapobiega to zoliwej aplikacji uzyskania dostpu do odczytu lub zapisu plik贸w innej aplikacji.
{% endhint %}

**Wra偶liwe dane przechowywane w tekcie jawnym**

* **Udostpnione preferencje**: Android pozwala ka偶dej aplikacji atwo zapisa pliki XML w cie偶ce `/data/data/<nazwapakietu>/shared_prefs/` i czasami mo偶liwe jest znalezienie wra偶liwych informacji w tekcie jawnym w tym folderze.
* **Bazy danych**: Android pozwala ka偶dej aplikacji atwo zapisa bazy danych sqlite w cie偶ce `/data/data/<nazwapakietu>/databases/` i czasami mo偶liwe jest znalezienie wra偶liwych informacji w tekcie jawnym w tym folderze.

### Uszkodzone TLS

**Akceptuj wszystkie certyfikaty**

Z jakiego powodu czasami deweloperzy akceptuj wszystkie certyfikaty, nawet jeli na przykad nazwa hosta nie pasuje, jak w poni偶szym kodzie:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
### Uszkodzona kryptografia

**Sabe procesy zarzdzania kluczami**

Niekt贸rzy programici zapisuj wra偶liwe dane w pamici lokalnej i szyfruj je kluczem zapisanym/wykonalnym w kodzie. Nie powinno si tego robi, poniewa偶 odwr贸cenie procesu mo偶e pozwoli atakujcym wydoby poufne informacje.

**U偶ycie niebezpiecznych i/lub przestarzaych algorytm贸w**

Programici nie powinni u偶ywa **przestarzaych algorytm贸w** do wykonywania **sprawdze autoryzacyjnych**, **przechowywania** lub **wysyania** danych. Niekt贸re z tych algorytm贸w to: RC4, MD4, MD5, SHA1... Jeli **hasa** s u偶ywane do przechowywania hase na przykad, nale偶y u偶ywa hashy odporne na ataki brutalnej siy z sol.

### Inne sprawdzenia

* Zaleca si **zaciemnienie APK**, aby utrudni odwr贸cenie in偶ynierii atakujcym.
* Jeli aplikacja jest wra偶liwa (np. aplikacje bankowe), powinna przeprowadza **wasne sprawdzenia, czy urzdzenie mobilne jest zrootowane** i dziaa odpowiednio.
* Jeli aplikacja jest wra偶liwa (np. aplikacje bankowe), powinna sprawdzi, czy jest u偶ywany **emulator**.
* Jeli aplikacja jest wra偶liwa (np. aplikacje bankowe), powinna **sprawdzi swoj integralno przed wykonaniem**, aby sprawdzi, czy zostaa zmodyfikowana.
* U偶yj [**APKiD**](https://github.com/rednaga/APKiD), aby sprawdzi, kt贸ry kompilator/packer/zaciemniacz zosta u偶yty do zbudowania APK

### Aplikacja React Native

Przeczytaj nastpujc stron, aby dowiedzie si, jak atwo uzyska dostp do kodu JavaScript aplikacji React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplikacje Xamarin

Przeczytaj nastpujc stron, aby dowiedzie si, jak atwo uzyska dostp do kodu C# aplikacji Xamarin:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Aplikacje Superpacked

Zgodnie z tym [**postem na blogu**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/) superpacked to meta algorytm, kt贸ry kompresuje zawarto aplikacji do jednego pliku. Blog omawia mo偶liwo stworzenia aplikacji, kt贸ra dekompresuje tego rodzaju aplikacje... oraz szybszy spos贸b, kt贸ry polega na **uruchomieniu aplikacji i zebraniu zdekompresowanych plik贸w z systemu plik贸w**.

### Automatyczna statyczna analiza kodu

Narzdzie [**mariana-trench**](https://github.com/facebook/mariana-trench) jest zdolne do znajdowania **podatnoci** poprzez **skanowanie** kodu aplikacji. Narzdzie to zawiera szereg **znanych 藕r贸de** (kt贸re wskazuj narzdziu **miejsca**, gdzie **dane wejciowe s kontrolowane przez u偶ytkownika**), **sinks** (kt贸re wskazuj narzdziu **niebezpieczne miejsca**, gdzie zoliwe dane wejciowe mog powodowa szkody) i **reguy**. Te reguy wskazuj **kombinacj 藕r贸de-sinks**, kt贸re wskazuj na podatno.

Dziki tej wiedzy **mariana-trench przejrzy kod i znajdzie mo偶liwe podatnoci**.

### Wycieki sekret贸w

Aplikacja mo偶e zawiera sekrety (klucze API, hasa, ukryte adresy URL, subdomeny...) wewntrz niej, kt贸re mo偶esz odkry. Mo偶esz u偶y narzdzia takiego jak [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Ominicie uwierzytelniania biometrycznego

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Inne interesujce funkcje

* **Wykonanie kodu**: `Runtime.exec(), ProcessBuilder(), kod natywny:system()`
* **Wysyanie SMS-贸w**: `sendTextMessage, sendMultipartTestMessage`
* **Funkcje natywne** zadeklarowane jako `native`: `public native, System.loadLibrary, System.load`
* [Przeczytaj to, aby dowiedzie si, **jak odwr贸ci funkcje natywne**](reversing-native-libraries.md)

### **Inne sztuczki**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Spostrze偶enia dotyczce hakerstwa**\
Zapoznaj si z treciami, kt贸re zagbiaj si w emocje i wyzwania hakerstwa

**Aktualnoci na 偶ywo z hakerstwa**\
Bd藕 na bie偶co z szybkim tempem wiata hakerstwa dziki aktualnociom i spostrze偶eniom na 偶ywo

**Najnowsze ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i istotnymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

***

## Analiza dynamiczna

> Po pierwsze, potrzebujesz rodowiska, w kt贸rym mo偶esz zainstalowa aplikacj i wszystkie narzdzia (certyfikat Burp CA, Drozer i Frida g贸wnie). Dlatego zaleca si korzystanie z urzdzenia zrootowanego (emulowanego lub nie).

### Analiza dynamiczna online

Mo偶esz utworzy **darmowe konto** na: [https://appetize.io/](https://appetize.io). Ta platforma pozwala **przesya** i **wykonywa** APK, co jest przydatne do zobaczenia, jak zachowuje si apk.

Mo偶esz nawet **zobaczy logi swojej aplikacji** w sieci i poczy si za pomoc **adb**.

![](<../../.gitbook/assets/image (831).png>)

Dziki poczeniu ADB mo偶esz u偶ywa **Drozera** i **Fridy** wewntrz emulator贸w.

### Lokalna analiza dynamiczna

#### Korzystanie z emulatora

* [**Android Studio**](https://developer.android.com/studio) (Mo偶esz tworzy urzdzenia **x86** i **arm**, a wedug [**tego** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**najnowsze wersje x86** obsuguj biblioteki ARM bez koniecznoci wolnego emulowania arm).
* Dowiedz si, jak to skonfigurowa na tej stronie:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Wersja darmowa:** Personal Edition, musisz utworzy konto. _Zaleca si **pobranie** wersji **Z**_ _**VirtualBox** aby unikn potencjalnych bd贸w._)
* [**Nox**](https://es.bignox.com) (Darmowy, ale nie obsuguje Fridy ani Drozera).

{% hint style="info" %}
Tworzc nowy emulator na dowolnej platformie, pamitaj, 偶e im wikszy ekran, tym wolniej bdzie dziaa emulator. Wybierz wic mae ekrany, jeli to mo偶liwe.
{% endhint %}

Aby **zainstalowa usugi Google** (np. Sklep Play) w Genymotion, musisz klikn na czerwony przycisk zaznaczony na poni偶szym obrazie:

![](<../../.gitbook/assets/image (277).png>)

Zauwa偶 r贸wnie偶, 偶e w **konfiguracji maszyny wirtualnej Androida w Genymotion** mo偶esz wybra **tryb sieci mostkowej** (bdzie to przydatne, jeli bdziesz czy si z maszyn wirtualn Androida z innej maszyny wirtualnej z narzdziami).

#### U偶yj fizycznego urzdzenia

Musisz aktywowa opcje **debugowania**, a byoby fajnie, gdyby m贸g je **zrootowa**:

1. **Ustawienia**.
2. (Od Androida 8.0) Wybierz **System**.
3. Wybierz **Informacje o telefonie**.
4. Nacinij **Numer kompilacji** 7 razy.
5. Wr贸 i znajdziesz **Opcje programistyczne**.

> Po zainstalowaniu aplikacji, pierwsz rzecz, jak powiniene zrobi, jest jej przetestowanie i zbadanie, co robi, jak dziaa i zapoznanie si z ni.\
> Zalecam **wykonanie tej pocztkowej analizy dynamicznej za pomoc analizy dynamicznej MobSF + pidcat**, dziki czemu bdziemy mogli **dowiedzie si, jak dziaa aplikacja**, podczas gdy MobSF **przechwytuje** wiele **interesujcych danych**, kt贸re mo偶na p贸藕niej przejrze.
### Niezamierzone wycieki danych

**Logowanie**

Deweloperzy powinni by ostro偶ni przy ujawnianiu publicznie **informacji debugowania**, poniewa偶 mo偶e to prowadzi do wyciek贸w danych. Narzdzia [**pidcat**](https://github.com/JakeWharton/pidcat) i `adb logcat` s zalecane do monitorowania log贸w aplikacji w celu identyfikacji i ochrony wra偶liwych informacji. **Pidcat** jest preferowany ze wzgldu na atwo u偶ycia i czytelno.

{% hint style="warning" %}
Zauwa偶, 偶e od **nowszych wersji Androida nowszych ni偶 4.0**, **aplikacje mog uzyska dostp tylko do swoich wasnych log贸w**. Dlatego aplikacje nie mog uzyska dostpu do log贸w innych aplikacji.\
Mimo to zaleca si **nie logowanie wra偶liwych informacji**.
{% endhint %}

**Bufor schowka kopiuj/wklej**

Framework **oparty na schowku** systemu Android umo偶liwia funkcjonalno kopiuj/wklej w aplikacjach, ale stanowi ryzyko, poniewa偶 **inne aplikacje** mog **uzyska dostp** do schowka, potencjalnie ujawniajc wra偶liwe dane. Wa偶ne jest **wyczenie funkcji kopiuj/wklej** dla wra偶liwych sekcji aplikacji, takich jak dane karty kredytowej, aby zapobiec wyciekom danych.

**Logi awarii**

Jeli aplikacja **zawiesi si** i **zapisze logi**, te logi mog pom贸c atakujcym, zwaszcza gdy aplikacja nie mo偶e by zdekompilowana. Aby zmniejszy to ryzyko, unikaj logowania w przypadku awarii, a jeli logi musz by przesyane przez sie, upewnij si, 偶e s wysyane za porednictwem kanau SSL w celu zapewnienia bezpieczestwa.

Jako pentester, **spr贸buj przyjrze si tym logom**.

**Dane analityczne wysyane do stron trzecich**

Aplikacje czsto integruj usugi takie jak Google Adsense, kt贸re nieumylnie **wyciekaj wra偶liwe dane** z powodu niewaciwej implementacji przez deweloper贸w. Aby zidentyfikowa potencjalne wycieki danych, zaleca si **przechwycenie ruchu aplikacji** i sprawdzenie, czy jakiekolwiek wra偶liwe informacje s wysyane do usug stron trzecich.

### Bazy danych SQLite

Wikszo aplikacji bdzie korzysta z **wewntrznych baz danych SQLite** do zapisywania informacji. Podczas pentestu przyjrzyj si **utworzonym bazom danych**, nazwom **tabel** i **kolumn** oraz wszystkim **danych** zapisanym, poniewa偶 mo偶esz znale藕 **wra偶liwe informacje** (co stanowioby luk w zabezpieczeniach).\
Bazy danych powinny znajdowa si w `/data/data/nazwa.pakietu/bazy danych` np. `/data/data/com.mwr.example.sieve/bazy danych`

Jeli baza danych zapisuje poufne informacje i jest **zaszyfrowana**, ale mo偶esz **znale藕** haso **wewntrz aplikacji**, to nadal jest to **luka w zabezpieczeniach**.

Wylicz tabele za pomoc `.tables` i wylicz kolumny tabel za pomoc `.schema <nazwa_tabeli>`

### Drozer (Wykorzystywanie dziaa, dostawc贸w treci i usug)

Z [Dokumentacji Drozera](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** pozwala ci **przyj rol aplikacji Android** i wsp贸dziaa z innymi aplikacjami. Mo偶e robi **wszystko, co mo偶e zrobi zainstalowana aplikacja**, takie jak korzystanie z mechanizmu Komunikacji Midzyprocesowej (IPC) systemu Android i wsp贸dziaanie z podstawowym systemem operacyjnym. .\
Drozer to przydatne narzdzie do **wykorzystywania eksportowanych dziaa, eksportowanych usug i dostawc贸w treci**, o czym dowiesz si w kolejnych sekcjach.

### Wykorzystywanie eksportowanych dziaa

[**Przeczytaj to, jeli chcesz odwie偶y sobie, co to jest dziaanie w aplikacji Android.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Pamitaj r贸wnie偶, 偶e kod dziaania zaczyna si w metodzie **`onCreate`**.

**Ominicie autoryzacji**

Gdy dziaanie jest eksportowane, mo偶na wywoa jego ekran z zewntrznej aplikacji. Dlatego jeli dziaanie z **wra偶liwymi informacjami** jest **eksportowane**, mo偶na **omin** mechanizmy **uwierzytelniania**, aby uzyska do niego **dostp**.

[Dowiedz si, jak wykorzysta eksportowane dziaania za pomoc Drozera.](drozer-tutorial/#activities)

Mo偶esz tak偶e uruchomi eksportowane dziaanie z adb:

* NazwaPakietu to com.example.demo
* NazwaEksportowanegoDziaania to com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**UWAGA**: MobSF wykryje jako zoliwe u偶ycie _**singleTask/singleInstance**_ jako `android:launchMode` w aktywnoci, ale ze wzgldu na [to](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), wydaje si, 偶e jest to niebezpieczne tylko w starych wersjach (wersje API < 21).

{% hint style="info" %}
Zauwa偶, 偶e bypass autoryzacji nie zawsze jest podatnoci, to zale偶y od tego, jak dziaa bypass i jakie informacje s ujawnione.
{% endhint %}

**Ujawnienie wra偶liwych informacji**

**Aktywnoci mog r贸wnie偶 zwraca wyniki**. Jeli uda ci si znale藕 zewntrzn i niechronion aktywno wywoujc metod **`setResult`** i **zwracajc wra偶liwe informacje**, to mamy do czynienia z ujawnieniem wra偶liwych informacji.

#### Tapjacking

Jeli tapjacking nie jest zapobiegany, mo偶esz nadu偶y zewntrznej aktywnoci, aby **u偶ytkownik wykona nieoczekiwane akcje**. Aby uzyska wicej informacji na temat [**czym jest Tapjacking, kliknij w link**](./#tapjacking).

### Wykorzystywanie dostawc贸w treci - Dostp i manipulacja wra偶liwymi informacjami

[**Przeczytaj to, jeli chcesz odwie偶y sobie, czym jest dostawca treci.**](android-applications-basics.md#content-provider)\
Dostawcy treci s podstawowo u偶ywani do **udostpniania danych**. Jeli aplikacja udostpnia dostawc贸w treci, mo偶esz **wydoby wra偶liwe** dane z nich. Warto r贸wnie偶 przetestowa mo偶liwe **wstrzyknicia SQL** i **trawersacje cie偶ek**, poniewa偶 mog by podatne.

[**Dowiedz si, jak wykorzysta dostawc贸w treci za pomoc Drozera.**](drozer-tutorial/#content-providers)

### **Wykorzystywanie Usug**

[**Przeczytaj to, jeli chcesz odwie偶y sobie, czym jest Usuga.**](android-applications-basics.md#services)\
Pamitaj, 偶e dziaania Usugi rozpoczynaj si w metodzie `onStartCommand`.

Usuga to podstawowo co, co **mo偶e otrzyma dane**, je **przetworzy** i **zwr贸ci** (lub nie) odpowied藕. Jeli aplikacja eksportuje jakie usugi, powiniene **sprawdzi** kod, aby zrozumie, co robi, i **testowa** go **dynamicznie** w celu wydobycia poufnych informacji, omijania rodk贸w autoryzacji...\
[**Dowiedz si, jak wykorzysta Usugi za pomoc Drozera.**](drozer-tutorial/#services)

### **Wykorzystywanie Odbiornik贸w Nadawczych**

[**Przeczytaj to, jeli chcesz odwie偶y sobie, czym jest Odbiornik Nadawczy.**](android-applications-basics.md#broadcast-receivers)\
Pamitaj, 偶e dziaania Odbiornika Nadawczego rozpoczynaj si w metodzie `onReceive`.

Odbiornik nadawczy bdzie oczekiwa na rodzaj wiadomoci. W zale偶noci od tego, jak odbiornik obsuguje wiadomo, mo偶e by podatny.\
[**Dowiedz si, jak wykorzysta Odbiorniki Nadawcze za pomoc Drozera.**](./#exploiting-broadcast-receivers)

### **Wykorzystywanie Schemat贸w / Gbokich link贸w**

Mo偶esz rcznie szuka gbokich link贸w, u偶ywajc narzdzi takich jak MobSF lub skrypt贸w takich jak [ten](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Mo偶esz **otworzy** zadeklarowany **schemat** za pomoc **adb** lub **przegldarki**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Nale偶y zauwa偶y, 偶e mo偶na **pomin nazw pakietu** i telefon kom贸rkowy automatycznie wywoa aplikacj, kt贸ra powinna otworzy ten link._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**Wykonany kod**

Aby znale藕 **kod, kt贸ry zostanie wykonany w aplikacji**, przejd藕 do aktywnoci wywoanej przez link gboki i wyszukaj funkcj **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informacje poufne**

Zawsze, gdy znajdziesz link gboki, sprawd藕, czy **nie otrzymuje on poufnych danych (takich jak hasa) za pomoc parametr贸w URL**, poniewa偶 inna aplikacja mo偶e **podrobi link gboki i ukra te dane!**

**Parametry w cie偶ce**

Musisz r贸wnie偶 sprawdzi, czy jakikolwiek link gboki u偶ywa parametru wewntrz cie偶ki URL, na przykad: `https://api.example.com/v1/users/{username}`, w takim przypadku mo偶na wymusi przegldanie cie偶ki, uzyskujc dostp do czego takiego jak: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Zauwa偶, 偶e jeli znajdziesz poprawne punkty kocowe w aplikacji, mo偶esz spowodowa **przekierowanie otwarte** (jeli cz cie偶ki jest u偶ywana jako nazwa domeny), **przejcie konta** (jeli mo偶esz modyfikowa szczeg贸y u偶ytkownik贸w bez tokenu CSRF, a podatny punkt kocowy u偶ywa poprawnej metody) i inne podatnoci. Wicej [informacji na ten temat tutaj](http://dphoeniixx.com/2020/12/13-2/).

**Wicej przykad贸w**

Interesujcy raport z programu bug bounty znajdziesz [tutaj](https://hackerone.com/reports/855618) dotyczcy link贸w (_/.well-known/assetlinks.json_).

### Bdy w Inspekcji i Weryfikacji Warstwy Transportowej

* **Certyfikaty nie zawsze s odpowiednio sprawdzane** przez aplikacje Android. Czsto te aplikacje pomijaj ostrze偶enia i akceptuj certyfikaty samopodpisane lub, w niekt贸rych przypadkach, wracaj do korzystania z pocze HTTP.
* **Negocjacje podczas ucisku rki SSL/TLS s czasami sabe**, korzystajc z niebezpiecznych zestaw贸w szyfr贸w. Ta podatno sprawia, 偶e poczenie jest podatne na ataki typu man-in-the-middle (MITM), umo偶liwiajc atakujcym odszyfrowanie danych.
* **Wyciek prywatnych informacji** stanowi ryzyko, gdy aplikacje uwierzytelniaj si za pomoc bezpiecznych kana贸w, a nastpnie komunikuj si za pomoc kana贸w nieszyfrowanych w innych transakcjach. Ten spos贸b nie chroni danych poufnych, takich jak ciasteczka sesji lub szczeg贸y u偶ytkownika, przed przechwyceniem przez zoliwe podmioty.

#### Weryfikacja Certyfikatu

Skupimy si na **weryfikacji certyfikatu**. Integralno certyfikatu serwera musi by zweryfikowana, aby zwikszy bezpieczestwo. Jest to istotne, poniewa偶 niebezpieczne konfiguracje TLS i przesyanie danych poufnych przez niezaszyfrowane kanay mog stanowi znaczne ryzyko. Aby uzyska szczeg贸owe kroki dotyczce weryfikacji certyfikat贸w serwera i rozwizywania podatnoci, [**ten zas贸b**](https://manifestsecurity.com/android-application-security-part-10/) zapewnia wszechstronne wskaz贸wki.

#### SSL Pinning

SSL Pinning to rodek bezpieczestwa, w kt贸rym aplikacja weryfikuje certyfikat serwera wzgldem znanego egzemplarza przechowywanego w samej aplikacji. Ta metoda jest niezbdna do zapobiegania atakom typu man-in-the-middle (MITM). Zaleca si zdecydowanie wdro偶enie SSL Pinning w aplikacjach obsugujcych informacje poufne.

#### Inspekcja Ruchu

Aby inspirowa ruch HTTP, konieczne jest **zainstalowanie certyfikatu narzdzia proxy** (np. Burp). Bez zainstalowania tego certyfikatu, zaszyfrowany ruch mo偶e nie by widoczny przez proxy. Aby uzyska przewodnik po instalacji niestandardowego certyfikatu CA, [**kliknij tutaj**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine).

Aplikacje kierowane do **poziomu API 24 i wy偶szego** wymagaj modyfikacji konfiguracji bezpieczestwa sieciowego, aby zaakceptowa certyfikat CA proxy. Ten krok jest kluczowy dla inspekcji zaszyfrowanego ruchu. Aby uzyska instrukcje dotyczce modyfikacji konfiguracji bezpieczestwa sieciowego, [**odwoaj si do tego samouczka**](make-apk-accept-ca-certificate.md).

#### Omijanie SSL Pinning

Gdy jest wdro偶ony SSL Pinning, konieczne staje si jego obejcie w celu inspekcji ruchu HTTPS. Dostpne s r贸偶ne metody w tym celu:

* Automatycznie **zmodyfikuj** **apk**, aby **obej** SSL Pinning za pomoc [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). G贸wn zalet tej opcji jest brak koniecznoci uzyskiwania uprawnie root do obejcia SSL Pinning, ale konieczne bdzie usunicie aplikacji i zainstalowanie nowej, a to nie zawsze zadziaa.
* Mo偶esz u偶y **Frida** (om贸wionego poni偶ej), aby omin t ochron. Oto przewodnik dotyczcy korzystania z Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Mo偶esz r贸wnie偶 spr贸bowa **automatycznie omin SSL Pinning** za pomoc [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Mo偶esz r贸wnie偶 spr贸bowa **automatycznie omin SSL Pinning** za pomoc **analizy dynamicznej MobSF** (wyjanionej poni偶ej)
* Jeli uwa偶asz, 偶e istnieje ruch, kt贸rego nie przechwytujesz, mo偶esz spr贸bowa **przekierowa ruch do burp za pomoc iptables**. Przeczytaj ten blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### Wyszukiwanie Powszechnych Podatnoci Sieci Web

Wa偶ne jest r贸wnie偶 wyszukiwanie powszechnych podatnoci sieci web w aplikacji. Szczeg贸owe informacje na temat identyfikacji i agodzenia tych podatnoci wykraczaj poza zakres tego podsumowania, ale s szeroko om贸wione gdzie indziej.

### Frida

[Frida](https://www.frida.re) to dynamiczne narzdzie do instrumentacji dla programist贸w, in偶ynier贸w odwracajcych i badaczy bezpieczestwa.\
**Mo偶esz uzyska dostp do dziaajcej aplikacji i podczy metody w czasie rzeczywistym, aby zmieni zachowanie, zmieni wartoci, wydoby wartoci, uruchomi inny kod...**\
Jeli chcesz przetestowa penetracyjnie aplikacje Android, musisz wiedzie, jak korzysta z Fridy.

* Dowiedz si, jak korzysta z Fridy: [**Samouczek Frida**](frida-tutorial/)
* Pewne "GUI" do dziaa z Frid: [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection wietnie automatyzuje korzystanie z Fridy: [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* Mo偶esz znale藕 niekt贸re niesamowite skrypty Fridy tutaj: [**https://codeshare.frida.re/**](https://codeshare.frida.re)
* Spr贸buj omin mechanizmy anty-debugowania / anty-Fridy, adujc Frid, jak wskazano tutaj [https://erfur.github.io/blog/dev/code-injection-without-ptrace](https://erfur.github.io/blog/dev/code-injection-without-ptrace) (narzdzie [linjector](https://github.com/erfur/linjector-rs))

### **Dump Pamici - Fridump**

Sprawd藕, czy aplikacja przechowuje wra偶liwe informacje w pamici, kt贸rych nie powinna przechowywa, takie jak hasa lub mnemoniki.

Korzystajc z [**Fridump3**](https://github.com/rootbsd/fridump3), mo偶esz zrzuci pami aplikacji za pomoc:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
To spowoduje wyciek pamici do folderu ./dump, a nastpnie mo偶esz przeszuka go za pomoc polecenia grep, na przykad:
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Czue dane w Keystore**

W systemie Android Keystore jest najlepszym miejscem do przechowywania danych czuych, jednak偶e przy wystarczajcych uprawnieniach jest wci偶 **mo偶liwe uzyskanie do nich dostpu**. Poniewa偶 aplikacje maj tendencj do przechowywania tutaj **czuych danych w postaci zwykego tekstu**, testy penetracyjne powinny to sprawdza, poniewa偶 u偶ytkownik root lub osoba majca fizyczny dostp do urzdzenia mo偶e by w stanie je ukra.

Nawet jeli aplikacja przechowuje dane w keystore, dane te powinny by zaszyfrowane.

Aby uzyska dostp do danych przechowywanych w keystore, mo偶na skorzysta z tego skryptu Frida: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Ominicie odcisku palca/biometrii**

Za pomoc poni偶szego skryptu Frida mo偶na pr贸bowa **omin uwierzytelnianie odciskiem palca** kt贸re aplikacje na Androida mog stosowa w celu **ochrony okrelonych wra偶liwych obszar贸w:**
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Obrazy ta**

Gdy przeniesiesz aplikacj do ta, Android przechowuje **zrzut aplikacji**, wic gdy zostanie przywr贸cona do pierwszego planu, zaczyna adowa obraz przed aplikacj, dziki czemu wydaje si, 偶e aplikacja zostaa wczytana szybciej.

Jednak jeli ten zrzut zawiera **wra偶liwe informacje**, kto majcy dostp do zrzutu mo偶e **ukra te informacje** (zauwa偶, 偶e potrzebujesz uprawnie roota, aby uzyska do niego dostp).

Zrzuty s zazwyczaj przechowywane w okolicach: **`/data/system_ce/0/snapshots`**

Android zapewnia spos贸b **zapobiegania przechwytywaniu zrzut贸w ekranu poprzez ustawienie parametru ukadu FLAG\_SECURE**. Korzystajc z tego flaga, zawarto okna jest traktowana jako bezpieczna, co zapobiega pojawianiu si jej na zrzutach ekranu lub ogldaniu na niezabezpieczonych wywietlaczach.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analizator Aplikacji Android**

To narzdzie mo偶e pom贸c Ci w zarzdzaniu r贸偶nymi narzdziami podczas analizy dynamicznej: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Wstrzyknicie Intencji

Programici czsto tworz komponenty poredniczce, takie jak aktywnoci, usugi i odbiorniki nadawcze, kt贸re obsuguj te Intencje i przekazuj je do metod takich jak `startActivity(...)` lub `sendBroadcast(...)`, co mo偶e by ryzykowne.

Niebezpieczestwo polega na umo偶liwieniu atakujcym wywoania nieeksportowanych komponent贸w aplikacji lub uzyskanie dostpu do poufnych dostawc贸w treci poprzez przekierowanie tych Intencji. Przykadem jest komponent `WebView`, kt贸ry konwertuje adresy URL na obiekty `Intent` za pomoc `Intent.parseUri(...)` a nastpnie wykonuje je, co potencjalnie prowadzi do zoliwych wstrzykni Intencji.

### Podstawowe Wnioski

* **Wstrzyknicie Intencji** jest podobne do problemu przekierowania otwartego w sieci web.
* Wykorzystanie polega na przekazywaniu obiekt贸w `Intent` jako dodatk贸w, kt贸re mog by przekierowane do wykonania niebezpiecznych operacji.
* Mo偶e ujawni nieeksportowane komponenty i dostawc贸w treci atakujcym.
* Konwersja adresu URL do obiektu `Intent` przez `WebView` mo偶e uatwi niezamierzone dziaania.

### Wstrzyknicia po stronie klienta Androida i inne

Prawdopodobnie znasz tego rodzaju podatnoci z sieci web. Musisz by szczeg贸lnie ostro偶ny z tymi podatnociami w aplikacji Android:

* **Wstrzyknicie SQL:** Podczas pracy z zapytaniami dynamicznymi lub dostawcami treci upewnij si, 偶e u偶ywasz zapyta z parametrami.
* **Wstrzyknicie JavaScript (XSS):** Sprawd藕, czy obsuga JavaScriptu i wtyczek jest wyczona dla wszystkich WebViews (domylnie wyczone). [Wicej informacji tutaj](webview-attacks.md#javascript-enabled).
* **Lokalne Doczanie Plik贸w:** WebViews powinny mie wyczony dostp do systemu plik贸w (domylnie wczony) - `(webview.getSettings().setAllowFileAccess(false);)`. [Wicej informacji tutaj](webview-attacks.md#javascript-enabled).
* **Wieczyste ciasteczka**: W kilku przypadkach, gdy aplikacja Android koczy sesj, ciasteczko nie jest uniewa偶niane lub mo偶e nawet by zapisane na dysku.
* [**Flaga Bezpieczestwa** w ciasteczkach](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Spostrze偶enia z Hackingu**\
Zajmij si treciami, kt贸re zagbiaj si w emocje i wyzwania zwizane z hakowaniem

**Aktualnoci z Hackingu na 呕ywo**\
Bd藕 na bie偶co z szybkim tempem wiata hakowania dziki aktualnociom i spostrze偶eniom na 偶ywo

**Najnowsze Ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i istotnymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

## Automatyczna Analiza

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**Analiza statyczna**

![](<../../.gitbook/assets/image (866).png>)

**Ocena podatnoci aplikacji** za pomoc przyjaznego interfejsu internetowego. Mo偶esz r贸wnie偶 przeprowadzi analiz dynamiczn (ale musisz przygotowa rodowisko).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Zauwa偶, 偶e MobSF mo偶e analizowa aplikacje **Android**(apk), **IOS**(ipa) oraz Windows(apx) (_aplikacje Windows musz by analizowane z MobSF zainstalowanym na hocie z systemem Windows_).\
Dodatkowo, jeli utworzysz plik **ZIP** z kodem 藕r贸dowym aplikacji **Android** lub **IOS** (przejd藕 do g贸wnego folderu aplikacji, zaznacz wszystko i utw贸rz plik ZIP), bdzie mo偶na go r贸wnie偶 przeanalizowa.

MobSF pozwala r贸wnie偶 na **por贸wnywanie** analiz oraz integracj z **VirusTotal** (musisz ustawi sw贸j klucz API w _MobSF/settings.py_ i wczy go: `VT_ENABLED = TRUE` `VT_API_KEY = <Tw贸j klucz API>` `VT_UPLOAD = TRUE`). Mo偶esz tak偶e ustawi `VT_UPLOAD` na `False`, wtedy **skr贸t** zostanie **wysany** zamiast pliku.

### Asystowana analiza dynamiczna z MobSF

**MobSF** mo偶e by r贸wnie偶 bardzo pomocny w **analizie dynamicznej** w **Androidzie**, ale w tym przypadku bdziesz musia zainstalowa MobSF i **genymotion** na swoim hocie (maszyna wirtualna lub Docker nie zadziaa). _Uwaga: Musisz **najpierw uruchomi maszyn wirtualn w genymotion** a nastpnie MobSF._\
Analizator dynamiczny **MobSF** mo偶e:

* **Wycign dane aplikacji** (adresy URL, logi, schowek, zrzuty ekranu wykonane przez ciebie, zrzuty ekranu wykonane przez "**Eksportowane narzdzie aktywnoci**", e-maile, bazy danych SQLite, pliki XML i inne utworzone pliki). Wszystko to odbywa si automatycznie, z wyjtkiem zrzut贸w ekranu, musisz nacisn, gdy chcesz zrobi zrzut ekranu lub musisz nacisn "**Eksportowane narzdzie aktywnoci**", aby uzyska zrzuty ekranu wszystkich wyeksportowanych aktywnoci.
* Przechwytywa ruch **HTTPS**
* U偶ywa **Fridy** do uzyskania **informacji w czasie rzeczywistym**

Od wersji **Androida > 5**, automatycznie uruchomi Frid i ustawia globalne ustawienia **proxy** do **przechwytywania** ruchu. Bdzie przechwytywa ruch tylko z testowanej aplikacji.

**Frida**

Domylnie bdzie r贸wnie偶 u偶ywa niekt贸rych skrypt贸w Fridy do **omijania przypicia SSL**, **wykrywania roota** i **wykrywania debugera** oraz do **monitorowania interesujcych API**.\
MobSF mo偶e r贸wnie偶 **wywoywa wyeksportowane aktywnoci**, przechwytywa z nich **zrzuty ekranu** i **zapisywa** je do raportu.

Aby **rozpocz** testowanie dynamiczne, nacinij zielony przycisk: "**Rozpocznij instrumentacj**". Nacinij "**Dzienniki na 偶ywo Fridy**", aby zobaczy dzienniki generowane przez skrypty Fridy i "**Monitor API na 偶ywo**", aby zobaczy wszystkie wywoania do podpitych metod, przekazane argumenty i zwr贸cone wartoci (to pojawi si po naciniciu "Rozpocznij instrumentacj").\
MobSF pozwala r贸wnie偶 na zaadowanie wasnych **skrypt贸w Fridy** (aby przesa wyniki swoich skrypt贸w Fridy do MobSF, u偶yj funkcji `send()`). Posiada r贸wnie偶 **kilka gotowych skrypt贸w**, kt贸re mo偶na zaadowa (mo偶esz doda wicej w `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), po prostu **wybierz je**, nacinij "**Zaaduj**" i nacinij "**Rozpocznij instrumentacj**" (bdziesz m贸g zobaczy dzienniki tych skrypt贸w wewntrz "**Dziennik贸w na 偶ywo Fridy**").

![](<../../.gitbook/assets/image (419).png>)

Co wicej, masz kilka pomocniczych funkcji Fridy:

* **Wylicz zaadowane klasy**: Wywietli wszystkie zaadowane klasy
* **Przechwy cigi znak贸w**: Wywietli wszystkie przechwycone cigi znak贸w podczas korzystania z aplikacji (bardzo haaliwe)
* **Przechwy por贸wnania cig贸w**: Mo偶e by bardzo przydatne. **Poka偶e 2 por贸wnywane cigi** i czy wynik by Prawdziwy czy Faszywy.
* **Wylicz metody klasy**: Wprowad藕 nazw klasy (np. "java.io.File") i wywietli wszystkie metody klasy.
* **Wyszukaj wzorzec klasy**: Wyszukaj klasy wedug wzorca
* **led藕 metody klasy**: **ledzi** ca **klas** (zobacz wejcia i wyjcia wszystkich metod klasy). Pamitaj, 偶e domylnie MobSF ledzi kilka interesujcych metod Android Api.

Po wybraniu moduu pomocniczego, kt贸rego chcesz u偶y, musisz nacisn "**Rozpocznij instrumentacj**", a zobaczysz wszystkie wyniki w "**Dziennikach na 偶ywo Fridy**".

**Powoka**

MobSF dostarcza r贸wnie偶 powok z kilkoma poleceniami **adb**, **poleceniami MobSF** i standardowymi **poleceniami powoki** na dole strony analizy dynamicznej. Kilka interesujcych polece:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Narzdzia HTTP**

Gdy ruch http jest przechwytywany, mo偶esz zobaczy nieestetyczny widok przechwyconego ruchu na dole "**HTTP(S) Traffic**" lub adniejszy widok w zielonym przycisku "**Start HTTPTools**". Z drugiej opcji, mo偶esz **wysa** przechwycone 偶dania do **serwer贸w proxy** takich jak Burp lub Owasp ZAP.\
Aby to zrobi, _wcz Burp -->_ _wycz Intercept --> w MobSB HTTPTools wybierz 偶danie_ --> nacinij "**Send to Fuzzer**" --> _wybierz adres serwera proxy_ ([http://127.0.0.1:8080\\](http://127.0.1:8080)).

Po zakoczeniu analizy dynamicznej za pomoc MobSF, mo偶esz nacisn "**Start Web API Fuzzer**" aby **testowa 偶dania http** i szuka podatnoci.

{% hint style="info" %}
Po wykonaniu analizy dynamicznej za pomoc MobSF, ustawienia serwera proxy mog by 藕le skonfigurowane i nie bdzie mo偶na ich naprawi z poziomu interfejsu graficznego. Mo偶esz naprawi ustawienia serwera proxy wykonujc:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Wspomagana analiza dynamiczna za pomoc Inspeckage

Mo偶esz pobra narzdzie z [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
To narzdzie u偶ywa pewnych **hook贸w**, aby m贸g dowiedzie si, **co dzieje si w aplikacji** podczas wykonywania **analizy dynamicznej**.

### [Yaazhini](https://www.vegabird.com/yaazhini/)

To **wspaniae narzdzie do przeprowadzania analizy statycznej za pomoc interfejsu graficznego**

![](<../../.gitbook/assets/image (741).png>)

### [Qark](https://github.com/linkedin/qark)

To narzdzie zostao zaprojektowane do wyszukiwania kilku **zwizanych z bezpieczestwem podatnoci aplikacji na Androida**, zar贸wno w **kodzie 藕r贸dowym**, jak i **spakowanych plikach APK**. Narzdzie to jest r贸wnie偶 **zdolne do tworzenia "dowod贸w koncepcji" w postaci APK do wdro偶enia** oraz **komend ADB**, aby wykorzysta niekt贸re z odnalezionych podatnoci (odsonite aktywnoci, intencje, tapjacking...). Podobnie jak w przypadku Drozera, nie ma potrzeby rootowania urzdzenia testowego.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Wywietla wszystkie wycignite pliki dla atwego odniesienia
* Automatycznie dekompiluje pliki APK do formatu Java i Smali
* Analizuje AndroidManifest.xml pod ktem powszechnych podatnoci i zachowa
* Statyczna analiza kodu 藕r贸dowego pod ktem powszechnych podatnoci i zachowa
* Informacje o urzdzeniu
* i wiele wicej
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER to aplikacja wiersza polece, kt贸ra mo偶e by u偶ywana w systemach Windows, MacOS X i Linux do analizy plik贸w _.apk_ w poszukiwaniu podatnoci. Robi to poprzez dekompresj plik贸w APK i stosowanie serii regu do wykrywania tych podatnoci.

Wszystkie reguy s skoncentrowane w pliku `rules.json`, i ka偶da firma lub tester mo偶e stworzy swoje wasne reguy do analizy tego, czego potrzebuj.

Pobierz najnowsze binaria ze strony [pobierania](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (297).png>)

StaCoAn to narzdzie **wieloplatformowe**, kt贸re pomaga programistom, owcom luk bug贸w i etycznym hakerom przeprowadza [analiz statycznego kodu](https://en.wikipedia.org/wiki/Static\_program\_analysis) aplikacji mobilnych.

Idea polega na tym, 偶e przecigasz i upuszczasz plik aplikacji mobilnej (plik .apk lub .ipa) na aplikacj StaCoAn, a ta wygeneruje dla Ciebie raport wizualny i przenony. Mo偶esz dostosowa ustawienia i listy s贸w, aby uzyska spersonalizowane dowiadczenie.

Pobierz [najnowsze wydanie](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework to system analizy podatnoci Androida, kt贸ry pomaga programistom lub hakerom znale藕 potencjalne luki w zabezpieczeniach aplikacji na Androida.\
[Wydania dla systemu Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** to narzdzie, kt贸rego g贸wnym celem jest wykrywanie i ostrzeganie u偶ytkownika o potencjalnych zachowaniach zoliwych rozwijanych przez aplikacj na platform Android.

Wykrycie odbywa si poprzez **analiz statyczn** kodu bajtowego Dalvika aplikacji, reprezentowanego jako **Smali**, przy u偶yciu biblioteki [`androguard`](https://github.com/androguard/androguard).

To narzdzie szuka **powszechnych zachowa "zych" aplikacji** takich jak: wyciek identyfikator贸w telefonicznych, przechwytywanie strumieni audio/wideo, modyfikacja danych PIM, wykonanie arbitralnego kodu...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [Framework MARA](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (595).png>)

**MARA** to **M**obilny **A**narzdzie do **R**everse engineeringu i **A**nalizy aplikacji. Jest to narzdzie, kt贸re czy popularne narzdzia do reverse engineeringu i analizy aplikacji mobilnych, aby pom贸c w testowaniu aplikacji mobilnych pod ktem zagro偶e bezpieczestwa mobilnego zgodnie z OWASP. Jego celem jest uatwienie i uczynienie przyjaznym dla deweloper贸w aplikacji mobilnych oraz specjalist贸w ds. bezpieczestwa.

Mo偶e:

* Wydobywa kod Java i Smali za pomoc r贸偶nych narzdzi
* Analizowa pliki APK za pomoc: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Wydobywa prywatne informacje z pliku APK za pomoc wyra偶e regularnych.
* Analizowa Manifest.
* Analizowa znalezione domeny za pomoc: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) i [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Deobfuskowa plik APK za pomoc [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

Przydatne do wykrywania zoliwego oprogramowania: [https://koodous.com/](https://koodous.com)

## Zasanianie/Dezaktywowanie kodu

Zauwa偶, 偶e w zale偶noci od usugi i konfiguracji, kt贸re u偶ywasz do zasaniania kodu, tajemnice mog by lub nie by zasonite.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

Z [Wikipedii](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** to narzdzie wiersza polece typu open source, kt贸re zmniejsza, optymalizuje i zasania kod Javy. Potrafi zoptymalizowa kod bajtowy oraz wykrywa i usuwa nieu偶ywane instrukcje. ProGuard jest oprogramowaniem darmowym i jest dystrybuowany na licencji GNU General Public License, wersja 2.

ProGuard jest dystrybuowany jako cz Android SDK i uruchamiany jest podczas budowania aplikacji w trybie wydania.

### [DexGuard](https://www.guardsquare.com/dexguard)

Znajd藕 przewodnik krok po kroku do deobfuskacji pliku APK na [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Z tego przewodnika) Ostatnim razem, gdy sprawdzilimy, tryb dziaania Dexguarda by nastpujcy:

* zaaduj zas贸b jako InputStream;
* przeka偶 wynik do klasy dziedziczcej po FilterInputStream, aby go odszyfrowa;
* wykonaj kilka bezu偶ytecznych obfuskacji, aby straci kilka minut czasu odwracajcego;
* przeka偶 odszyfrowany wynik do ZipInputStream, aby uzyska plik DEX;
* w kocu zaaduj uzyskany plik DEX jako zas贸b za pomoc metody `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard odwraca proces obfuskacji wykonywany przez narzdzia do obfuskacji Androida. Umo偶liwia to wiele analiz zwizanych z bezpieczestwem, w tym inspekcj kodu i przewidywanie bibliotek.**

Mo偶esz przesa zasonity plik APK na ich platform.

### [Simplify](https://github.com/CalebFenton/simplify)

To **og贸lny deobfuskator Androida.** Simplify **wirtualnie wykonuje aplikacj** w celu zrozumienia jej zachowania, a nastpnie **stara si zoptymalizowa kod** tak, aby zachowywa si identycznie, ale by atwiejszy do zrozumienia dla czowieka. Ka偶dy rodzaj optymalizacji jest prosty i og贸lny, wic nie ma znaczenia, jaki konkretny rodzaj obfuskacji jest u偶ywany.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD dostarcza informacje na temat **sposobu tworzenia pliku APK**. Identyfikuje wiele **kompilator贸w**, **pakowaczy**, **obfuskator贸w** i innych dziwnych rzeczy. To jest [_PEiD_](https://www.aldeid.com/wiki/PEiD) dla Androida.

### Manual

[Zobacz ten samouczek, aby nauczy si kilku sztuczek dotyczcych **odwracania niestandardowej obfuskacji**](manual-deobfuscation.md)

## Laboratoria

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b to maszyna wirtualna zabezpiecze Androida oparta na ubuntu-mate, zawierajca najnowsze frameworki, samouczki i laboratoria od r贸偶nych maniak贸w bezpieczestwa i badaczy do reverse engineeringu i analizy zoliwego oprogramowania.

## Odnoniki

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) To wietna lista zasob贸w
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Szybki kurs Androida
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Jeszcze do wypr贸bowania

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Docz do [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Spostrze偶enia dotyczce hakerstwa**\
Zajmij si treciami, kt贸re zagbiaj si w emocje i wyzwania hakerstwa

**Aktualnoci na 偶ywo dotyczce hakerstwa**\
Bd藕 na bie偶co z szybkim tempem wiata hakerstwa dziki aktualnociom i spostrze偶eniom na 偶ywo

**Najnowsze ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami nagr贸d za bdy i istotnymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub grupy [**telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>
