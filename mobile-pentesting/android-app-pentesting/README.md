# Testowanie penetracyjne aplikacji Android

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami nagr贸d za bdy!

**Wgld w hakerstwo**\
Zajmuj si treciami, kt贸re zagbiaj si w emocje i wyzwania hakerstwa

**Aktualnoci na 偶ywo z hakerstwa**\
Bd藕 na bie偶co z szybkim tempem wiata hakerstwa dziki aktualnym wiadomociom i wgldom

**Najnowsze ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami nagr贸d za bdy i wa偶nymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

## Podstawy aplikacji Android

Zaleca si zapoznanie si z t stron, aby dowiedzie si o **najwa偶niejszych czciach zwizanych z bezpieczestwem Androida i najbardziej niebezpiecznych komponentach w aplikacji Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

To jest g贸wne narzdzie, kt贸re potrzebujesz do poczenia si z urzdzeniem Android (emulowanym lub fizycznym).\
**ADB** umo偶liwia kontrolowanie urzdze zar贸wno przez **USB**, jak i przez **sie** z komputera. Narzdzie to umo偶liwia **kopiowanie** plik贸w w obie strony, **instalowanie** i **odinstalowywanie** aplikacji, **wykonywanie** polece powoki, **tworzenie kopii zapasowych** danych, **odczytywanie** log贸w i wiele innych funkcji.

Zajrzyj do poni偶szej listy [**Polecenia ADB**](adb-commands.md), aby dowiedzie si, jak korzysta z adb.

## Smali

Czasami interesujce jest **modyfikowanie kodu aplikacji**, aby uzyska dostp do **ukrytych informacji** (mo偶e to by dobrze zaszyfrowane hasa lub flagi). W takim przypadku warto zdekompilowa plik apk, zmodyfikowa kod i ponownie go skompilowa.\
[**W tym samouczku** mo偶esz **nauczy si, jak zdekompilowa APK, zmodyfikowa kod Smali i ponownie skompilowa APK** z now funkcjonalnoci](smali-changes.md). Mo偶e to by bardzo przydatne jako **alternatywa dla kilku test贸w podczas analizy dynamicznej**, kt贸re zostan przedstawione. Pamitaj zawsze o tej mo偶liwoci.

## Inne interesujce sztuczki

* [Podrabianie lokalizacji w Sklepie Play](spoofing-your-location-in-play-store.md)
* **Pobierz APK**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Wyodrbnij APK z urzdzenia:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## Analiza statyczna

Po pierwsze, do analizy pliku APK powiniene **przejrze kod Java** za pomoc dekompilatora.\
Prosz, [**przeczytaj tutaj, aby znale藕 informacje o dostpnych dekompilatorach**](apk-decompilers.md).

### Szukanie interesujcych informacji

Po prostu przegldajc **cigi znak贸w** w pliku APK, mo偶esz szuka **hase**, **adres贸w URL** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **kluczy API**, **szyfrowania**, **identyfikator贸w UUID Bluetooth**, **token贸w** i wszystkiego, co mo偶e by interesujce... poszukaj nawet **tylnych drzwi** do wykonania kodu lub tylnych drzwi uwierzytelniania (domylne dane uwierzytelniania dla aplikacji).

**Firebase**

Zwr贸 szczeg贸ln uwag na **adresy URL Firebase** i sprawd藕, czy s 藕le skonfigurowane. [Wicej informacji na temat tego, czym jest Firebase i jak go wykorzysta, znajdziesz tutaj.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Podstawowe zrozumienie aplikacji - Manifest.xml, strings.xml

**Badanie plik贸w _Manifest.xml_ i _strings.xml_ aplikacji mo偶e ujawni potencjalne podatnoci bezpieczestwa**. Te pliki mo偶na uzyska za pomoc dekompilator贸w lub zmieniajc rozszerzenie pliku APK na .zip, a nastpnie rozpakowujc go.

**Podatnoci** zidentyfikowane w pliku **Manifest.xml** obejmuj:

* **Aplikacje debugowalne**: Aplikacje oznaczone jako debugowalne (`debuggable="true"`) w pliku _Manifest.xml_ stanowi ryzyko, poniewa偶 pozwalaj na poczenia, kt贸re mog prowadzi do wykorzystania. Aby lepiej zrozumie, jak wykorzysta aplikacje debugowalne, zapoznaj si z samouczkiem dotyczcym wyszukiwania i wykorzystywania aplikacji debugowalnych na urzdzeniu.

* **Ustawienia kopii zapasowych**: Atrybut `android:allowBackup="false"` powinien by jawnie ustawiony dla aplikacji zajmujcych si wra偶liwymi informacjami, aby zapobiec nieautoryzowanym kopiom zapasowym danych za pomoc adb, zwaszcza gdy wczone jest debugowanie USB.

* **Bezpieczestwo sieci**: Niestandardowe konfiguracje bezpieczestwa sieciowego (`android:networkSecurityConfig="@xml/network_security_config"`) w _res/xml/_ mog okrela szczeg贸y dotyczce zabezpiecze, takie jak piny certyfikat贸w i ustawienia ruchu HTTP. Przykadem jest zezwolenie na ruch HTTP dla okrelonych domen.

* **Eksportowane aktywnoci i usugi**: Identyfikacja eksportowanych aktywnoci i usug w manifecie mo偶e wskaza na komponenty, kt贸re mog by nadu偶ywane. Dalsza analiza podczas test贸w dynamicznych mo偶e ujawni, jak wykorzysta te komponenty.

* **Dostawcy treci i dostawcy plik贸w**: Ujawnione dostawcy treci mog umo偶liwia nieautoryzowany dostp lub modyfikacj danych. Konfiguracja dostawc贸w plik贸w powinna r贸wnie偶 by dokadnie przeanalizowana.

* **Odbiorniki rozgoszeniowe i schematy URL**: Te komponenty mog by wykorzystane do wykorzystania, szczeg贸ln uwag nale偶y zwr贸ci na zarzdzanie schematami URL w celu wykrycia podatnoci wejciowych.

* **Wersje SDK**: Atrybuty `minSdkVersion`, `targetSDKVersion` i `maxSdkVersion` wskazuj obsugiwane wersje Androida, podkrelajc wa偶no nieobsugiwania przestarzaych, podatnych wersji Androida ze wzgld贸w bezpieczestwa.

Z pliku **strings.xml** mo偶na odkry wra偶liwe informacje, takie jak klucze API, niestandardowe schematy i inne notatki dla programist贸w, co podkrela konieczno dokadnego przegldu tych zasob贸w.


### Tapjacking

**Tapjacking** to atak, w kt贸rym **zoliwa aplikacja** jest uruchamiana i **umieszcza si na wierzchu aplikacji ofiary**. Gdy zasania ona widocznie aplikacj ofiary, jej interfejs u偶ytkownika jest zaprojektowany w taki spos贸b, aby oszuka u偶ytkownika do interakcji z ni, podczas gdy przekazuje interakcj do aplikacji ofiary.\
W efekcie, **lepi u偶ytkownika, aby nie wiedzia, 偶e faktycznie wykonuje czynnoci na aplikacji ofiary**.

Dowiedz si wicej:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Przechwytywanie zada

Aktywno z ustawionym **`launchMode`** na **`singleTask` bez zdefiniowanego `taskAffinity`** jest podatna na przechwytywanie zada. Oznacza to, 偶e **aplikacja** mo偶e zosta zainstalowana i jeli zostanie uruchomiona przed prawdziw aplikacj, mo偶e **przechwyci zadanie prawdziwej aplikacji** (u偶ytkownik bdzie wic korzysta z **zoliwej aplikacji, mylc, 偶e korzysta z prawdziwej**).

Wicej informacji:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Niewaciwe przechowywanie danych

**Wewntrzne przechowywanie**

W systemie Android pliki **przechowywane** w **wewntrznym** przechowywaniu s **przeznaczone** do **dostpu** wycznie przez **aplikacj**, kt贸ra je **utworzya**. Ta rodek bezpieczestwa jest **egzekwowany** przez system operacyjny Android i jest zazwyczaj wystarczajcy dla wikszoci aplikacji. Jednak programici czasami korzystaj z tryb贸w takich jak `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE`, aby **umo偶liwi** udostpnianie plik贸w midzy r贸偶nymi aplikacjami. Niemniej jednak te tryby **nie ograniczaj dostpu** do tych plik贸w przez inne aplikacje, w tym potencjalnie zoliwe.

1. **Analiza statyczna:**
- **Upewnij si**, 偶e korzystanie z `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE` jest **dokadnie sprawdzane**. Te tryby **mog potencjalnie ujawni** pliki **niezamierzonego lub nieautoryzowanego dostpu**.

2. **Analiza dynamiczna:**
- **Zweryfikuj** uprawnienia ustawione dla plik贸w utworzonych przez aplikacj. W szczeg贸lnoci **sprawd藕**, czy jakiekolwiek pliki s **ustawione jako czytelne lub zapisywalne dla wszystkich**. Mo偶e to stanowi powa偶ne ryzyko bezpieczestwa, poniewa偶 pozwolioby to **dowolnej aplikacji** zainstalowanej na urzdzeniu, niezale偶nie od jej pochodzenia lub intencji, na **odczytanie lub modyfikacj** tych plik贸w.

**Zewntrzne przechowywanie**

Przy pracy z plikami na **zewntrznym przechowywaniu**, takim jak karty SD, nale偶y podj pewne rodki ostro偶noci:

1. **Dostpno**:
- Pliki na zewntrznym przechowywaniu s **globalnie czytelne i zapisywalne**. Oznacza to, 偶e dowolna aplikacja lub u偶ytkownik mo偶e uzyska do nich dostp.

2. **Kwestie bezpieczestwa**:
- Ze wzgldu na atwo dostpu, zaleca si **nie przechowywa wra偶liwych informacji** na zewntrznym przechowywaniu.
- Zewntrzne przechowywanie mo偶na usun lub uzyska do niego dostp przez dowoln aplikacj, co czyni je mniej bezpiecznym.

3. **Obsuga danych z zewntrznego przechowywania**:
- Zawsze **przeprowadzaj walidacj danych** pobranych z zewntrznego przechowywania. Jest to istotne, poniewa偶 dane pochodz z niewiarygodnego 藕r贸da.
- Silnie odradza si przechowywanie plik贸w wykonywalnych lub plik贸w klas na zewn
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
Dobrym sposobem na przetestowanie tego jest pr贸ba przechwycenia ruchu za pomoc takiego proxy jak Burp, bez autoryzacji certyfikatu CA Burp w urzdzeniu. Mo偶na r贸wnie偶 wygenerowa za pomoc Burp certyfikat dla innego hosta i go u偶y.

### Sabe szyfrowanie

**Niewaciwe procesy zarzdzania kluczami**

Niekt贸rzy programici zapisuj wra偶liwe dane w lokalnym magazynie i szyfruj je kluczem wpisanym/wykrywalnym w kodzie. Nie powinno si tego robi, poniewa偶 odwr贸cenie tego mo偶e umo偶liwi atakujcym wydobycie poufnych informacji.

**U偶ycie niebezpiecznych i/lub przestarzaych algorytm贸w**

Programici nie powinni u偶ywa **przestarzaych algorytm贸w** do wykonywania **sprawdze** autoryzacji, **przechowywania** lub **wysyania** danych. Niekt贸re z tych algorytm贸w to: RC4, MD4, MD5, SHA1... Jeli u偶ywane s **skr贸ty** do przechowywania hase na przykad, powinny by u偶ywane odporne na ataki brute-force skr贸ty z sol.

### Inne sprawdzenia

* Zaleca si **zaciemnienie APK**, aby utrudni odwr贸cenie in偶ynierii przez atakujcych.
* Jeli aplikacja jest wra偶liwa (np. aplikacje bankowe), powinna sprawdza, czy urzdzenie mobilne jest zrootowane i dziaa odpowiednio.
* Jeli aplikacja jest wra偶liwa (np. aplikacje bankowe), powinna sprawdza, czy u偶ywany jest emulator.
* Jeli aplikacja jest wra偶liwa (np. aplikacje bankowe), powinna **sprawdza swoj integralno przed wykonaniem**, aby sprawdzi, czy nie zostaa zmodyfikowana.
* U偶yj [**APKiD**](https://github.com/rednaga/APKiD), aby sprawdzi, jakiego kompilatora/pakera/zaciemniacza u偶yto do budowy APK.

### Aplikacja React Native

Przeczytaj nastpujc stron, aby dowiedzie si, jak atwo uzyska dostp do kodu JavaScript aplikacji React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplikacje Xamarin

Przeczytaj nastpujc stron, aby dowiedzie si, jak atwo uzyska dostp do kodu C# aplikacji Xamarin:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Superpacked Applications

Wedug tego [**postu na blogu**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/) superpacked to metaalgorytm, kt贸ry kompresuje zawarto aplikacji do jednego pliku. Blog omawia mo偶liwo stworzenia aplikacji, kt贸ra dekompresuje tego rodzaju aplikacje... oraz szybszy spos贸b, kt贸ry polega na **wykonaniu aplikacji i zebraniu zdekompresowanych plik贸w z systemu plik贸w**.

### Automatyczna statyczna analiza kodu

Narzdzie [**mariana-trench**](https://github.com/facebook/mariana-trench) jest zdolne do znajdowania **podatnoci** poprzez **skanowanie** kodu aplikacji. Narzdzie to zawiera szereg **znanych 藕r贸de** (kt贸re wskazuj narzdziu **miejsca**, w kt贸rych **wejcie** jest **kontrolowane przez u偶ytkownika**), **uj** (kt贸re wskazuj narzdziu **niebezpieczne miejsca**, w kt贸rych zoliwe wejcie u偶ytkownika mo偶e spowodowa szkody) i **regu**. Te reguy wskazuj **kombinacj 藕r贸de-uj**, kt贸ra wskazuje na podatno.

Dziki tej wiedzy **mariana-trench przejrzy kod i znajdzie w nim mo偶liwe podatnoci**.

### Wycieki poufnych informacji

Aplikacja mo偶e zawiera poufne informacje (klucze API, hasa, ukryte adresy URL, subdomeny...), kt贸re mo偶na odkry. Mo偶na u偶y narzdzia takiego jak [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Ominicie uwierzytelniania biometrycznego

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Inne interesujce funkcje

* **Wykonanie kodu**: `Runtime.exec(), ProcessBuilder(), native code:system()`
* **Wysyanie SMS-贸w**: `sendTextMessage, sendMultipartTestMessage`
* **Funkcje natywne** zadeklarowane jako `native`: `public native, System.loadLibrary, System.load`
* [Przeczytaj to, aby dowiedzie si, **jak odwr贸ci funkcje natywne**](reversing-native-libraries.md)

### **Inne sztuczki**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Wgld w hakerstwo**\
Zajmuj si treciami, kt贸re zagbiaj si w emocje i wyzwania hakerstwa

**Aktualnoci na 偶ywo z hakerstwa**\
Bd藕 na bie偶co z szybkim tempem wiata hakerstwa dziki aktualnym wiadomociom i wgldom

**Najnowsze ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i wa偶nymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

***

## Analiza dynamiczna

> Przede wszystkim potrzebujesz rodowiska, w kt贸rym mo偶esz zainstalowa aplikacj i cae rodowisko (certyfikat CA Burp, Drozer i Frida przede wszystkim). Dlatego te偶 zaleca si korzystanie z zrootowanego urzdzenia (emulowanego lub nie).

### Analiza dynamiczna online

Mo偶esz zao偶y **darmowe konto** na stronie: [https://appetize.io/](https://appetize.io). Ta platforma pozwala na **przesyanie** i **wykonywanie** APK, wic jest przydatna do sprawdzania zachowania aplikacji.

Mo偶esz nawet **obejrze dzienniki swojej aplikacji** w sieci i poczy si za pomoc **adb**.

![](<../../.gitbook/assets/image (60).png>)

Dziki poczeniu ADB mo偶esz u偶ywa narzdzi **Drozer** i **Frida** w emulatorach.

### Lokalna analiza dynamiczna

#### U偶ywanie emulatora

* [**Android Studio**](https://developer.android.com/studio) (Mo偶esz tworzy urzdzenia **x86** i **arm**, a wedug [**tego** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**najnowsze wersje x86** **obsuguj biblioteki ARM** bez potrzeby wolnego emulatora arm).
* Dowiedz si, jak go skonfigurowa na tej stronie:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Wersja darmowa:** Personal Edition, musisz zao偶y konto. _Zaleca si **pobranie** wersji **Z**_ _**VirtualBoxem**_, aby unikn potencjalnych bd贸w._)
* [**Nox**](https://es.bignox.com) (Darmowy, ale nie obsuguje Fridy ani Drozera).

{% hint style="info" %}
Tworzc nowy emulator na dowolnej platformie, pamitaj, 偶e im wikszy jest ekran, tym wolniej bdzie dziaa emulator. Wybieraj wic mae ekrany, jeli to mo偶liwe.
{% endhint %}

Aby **zainstalowa usugi Google** (takie jak AppStore) w Genymotion, musisz klikn na oznaczony na czerwono przycisk na poni偶szym obrazie:

![](<../../.gitbook/assets/image (200) (1).png>)

Zauwa偶 r贸wnie偶, 偶e w **konfiguracji maszyny wirtualnej
#### U偶yj fizycznego urzdzenia

Musisz aktywowa opcje **debugowania**, a jeli mo偶esz, to **zrootowa** urzdzenie:

1. **Ustawienia**.
2. (Od Androida 8.0) Wybierz **System**.
3. Wybierz **Informacje o telefonie**.
4. Nacinij **Numer kompilacji** 7 razy.
5. Wr贸 i znajd藕 **Opcje programistyczne**.

> Po zainstalowaniu aplikacji, pierwsz rzecz, kt贸r powiniene zrobi, to przetestowa j i zbada, co robi, jak dziaa i zapozna si z ni.\
> Sugeruj **wykona t pocztkow analiz dynamiczn za pomoc analizy dynamicznej MobSF + pidcat**, dziki czemu bdziemy mogli **zrozumie, jak dziaa aplikacja**, podczas gdy MobSF **przechwytuje** wiele **ciekawych** **danych**, kt贸re mo偶na p贸藕niej przejrze.

### Niewaciwe wycieki danych

**Logowanie**

Deweloperzy powinni by ostro偶ni przy publicznym ujawnianiu informacji **debugowania**, poniewa偶 mo偶e to prowadzi do wycieku poufnych danych. Zaleca si korzystanie z narzdzi [**pidcat**](https://github.com/JakeWharton/pidcat) i `adb logcat` do monitorowania log贸w aplikacji w celu identyfikacji i ochrony poufnych informacji. **Pidcat** jest preferowany ze wzgldu na atwo u偶ycia i czytelno.

{% hint style="warning" %}
Zauwa偶, 偶e od **nowszych wersji Androida ni偶 4.0**, **aplikacje mog uzyska dostp tylko do swoich wasnych log贸w**. Aplikacje nie mog uzyska dostpu do log贸w innych aplikacji.\
W ka偶dym przypadku zaleca si **nie logowa poufnych informacji**.
{% endhint %}

**Bufor schowka**

Androidowa struktura oparta na **schowku** umo偶liwia funkcj kopiuj-wklej w aplikacjach, ale stanowi ryzyko, poniewa偶 **inne aplikacje** mog **uzyska dostp** do schowka, co mo偶e prowadzi do ujawnienia poufnych danych. Wa偶ne jest **wyczenie funkcji kopiuj-wklej** dla wra偶liwych sekcji aplikacji, takich jak dane karty kredytowej, aby zapobiec wyciekom danych.

**Logi awarii**

Jeli aplikacja **zawiesi si** i **zapisze logi**, te logi mog pom贸c atakujcym, zwaszcza gdy aplikacja nie mo偶e by zreversowana. Aby zmniejszy to ryzyko, unikaj logowania podczas awarii, a jeli logi musz by przesyane przez sie, upewnij si, 偶e s wysyane za pomoc kanau SSL w celu zapewnienia bezpieczestwa.

Jako pentester, **spr贸buj przejrze te logi**.

**Wysyanie danych analitycznych do stron trzecich**

Aplikacje czsto integruj usugi takie jak Google Adsense, kt贸re nieumylnie mog **wycieka poufne dane** z powodu niewaciwej implementacji przez deweloper贸w. Aby zidentyfikowa potencjalne wycieki danych, zaleca si **przechwycenie ruchu aplikacji** i sprawdzenie, czy wysyane s jakiekolwiek poufne informacje do usug stron trzecich.

### Bazy danych SQLite

Wikszo aplikacji korzysta z **wewntrznych baz danych SQLite** do przechowywania informacji. Podczas pentestu **sprawd藕** utworzone **bazy danych**, nazwy **tabel** i **kolumny** oraz wszystkie **dane**, poniewa偶 mo偶esz znale藕 **wra偶liwe informacje** (co stanowioby podatno).\
Bazy danych powinny znajdowa si w lokalizacji `/data/data/nazwa.pakietu/bazydanych`, na przykad `/data/data/com.mwr.example.sieve/bazydanych`

Jeli baza danych przechowuje poufne informacje i jest **zaszyfrowana**, ale mo偶esz **znale藕** haso **wewntrz aplikacji**, to wci偶 jest to **podatno**.

Wylicz tabele za pomoc `.tables` i wylicz kolumny tabel za pomoc `.schema <nazwa_tabeli>`

### Drozer (Wykorzystywanie dziaa, dostawc贸w treci i usug)

Z [Dokumentacji Drozer](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** pozwala ci **przyj rol aplikacji Androidowej** i wsp贸dziaa z innymi aplikacjami. Mo偶e robi **wszystko, co mo偶e zrobi zainstalowana aplikacja**, takie jak korzystanie z mechanizmu komunikacji midzyprocesowej (IPC) Androida i wsp贸dziaanie z podstawowym systemem operacyjnym.\
Drozer jest przydatnym narzdziem do **wykorzystywania dziaa, dostawc贸w treci i usug eksportowanych**, o czym dowiesz si w kolejnych sekcjach.

### Wykorzystywanie dziaa eksportowanych

[**Przeczytaj to, jeli chcesz odwie偶y sobie, czym jest Android Activity.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Pamitaj r贸wnie偶, 偶e kod aktywnoci zaczyna si w metodzie **`onCreate`**.

**Ominicie autoryzacji**

Gdy aktywno jest eksportowana, mo偶na j wywoa z zewntrznej aplikacji. Dlatego jeli aktywno zawiera **wra偶liwe informacje** i jest **eksportowana**, mo偶na **omin** mechanizmy **uwierzytelniania**, aby uzyska do niej dostp.

[**Dowiedz si, jak wykorzysta eksportowane aktywnoci za pomoc Drozera.**](drozer-tutorial/#activities)

Mo偶esz r贸wnie偶 uruchomi eksportowan aktywno z poziomu adb:

* Nazwa pakietu to com.example.demo
* Nazwa eksportowanej aktywnoci to com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**UWAGA**: MobSF wykryje jako zoliwe u偶ycie _**singleTask/singleInstance**_ jako `android:launchMode` w aktywnoci, ale ze wzgldu na [to](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), wydaje si, 偶e jest to niebezpieczne tylko w starych wersjach (wersje API < 21).

{% hint style="info" %}
Nale偶y pamita, 偶e bypass autoryzacji nie zawsze jest podatnoci, zale偶y to od tego, jak dziaa bypass i jakie informacje s ujawniane.
{% endhint %}

**Wyciek wra偶liwych informacji**

**Aktywnoci mog r贸wnie偶 zwraca wyniki**. Jeli uda ci si znale藕 eksportowan i niechronion aktywno, kt贸ra wywouje metod **`setResult`** i **zwraca wra偶liwe informacje**, mamy do czynienia z wyciekiem wra偶liwych informacji.

#### Tapjacking

Jeli nie jest zapobiegane tapjackingowi, mo偶esz wykorzysta eksportowan aktywno, aby **u偶ytkownik wykona nieoczekiwane czynnoci**. Aby uzyska wicej informacji na temat [**czym jest Tapjacking, kliknij tutaj**](./#tapjacking).

### Wykorzystywanie dostawc贸w treci - dostp i manipulacja wra偶liwymi informacjami

[**Przeczytaj to, jeli chcesz odwie偶y sobie, czym jest dostawca treci.**](android-applications-basics.md#content-provider)\
Dostawcy treci s u偶ywani do **udostpniania danych**. Jeli aplikacja udostpnia dostawc贸w treci, mo偶esz pr贸bowa **wydoby wra偶liwe** dane z nich. Warto r贸wnie偶 przetestowa mo偶liwe **wstrzyknicia SQL** i **przechodzenie cie偶ek**, poniewa偶 mog by podatne na ataki.

[**Dowiedz si, jak wykorzysta dostawc贸w treci za pomoc Drozera.**](drozer-tutorial/#content-providers)

### **Wykorzystywanie usug**

[**Przeczytaj to, jeli chcesz odwie偶y sobie, czym jest usuga.**](android-applications-basics.md#services)\
Pamitaj, 偶e dziaania usugi rozpoczynaj si w metodzie `onStartCommand`.

Usuga to podstawowo co, co **mo偶e otrzymywa dane**, **przetwarza** je i **zwraca** (lub nie) odpowied藕. Jeli aplikacja eksportuje jakie usugi, powiniene **sprawdzi** kod, aby zrozumie, co robi, i **testowa** go **dynamicznie**, aby wydobywa poufne informacje, omija rodki autoryzacji...\
[**Dowiedz si, jak wykorzysta usugi za pomoc Drozera.**](drozer-tutorial/#services)

### **Wykorzystywanie odbiornik贸w rozgosze**

[**Przeczytaj to, jeli chcesz odwie偶y sobie, czym jest odbiornik rozgosze.**](android-applications-basics.md#broadcast-receivers)\
Pamitaj, 偶e dziaania odbiornika rozgosze rozpoczynaj si w metodzie `onReceive`.

Odbiornik rozgosze bdzie oczekiwa na okrelony typ wiadomoci. W zale偶noci od tego, jak odbiornik obsuguje wiadomo, mo偶e by podatny na ataki.\
[**Dowiedz si, jak wykorzysta odbiorniki rozgosze za pomoc Drozera.**](./#exploiting-broadcast-receivers)

### **Wykorzystywanie schemat贸w / gbokich link贸w**

Mo偶esz rcznie szuka gbokich link贸w, u偶ywajc narzdzi takich jak MobSF lub skrypt贸w, na przykad [ten](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Mo偶esz **otworzy** deklarowany **schemat** za pomoc **adb** lub **przegldarki**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Zauwa偶, 偶e mo偶esz **pomin nazw pakietu** i telefon automatycznie wywoa aplikacj, kt贸ra powinna otworzy ten link._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**Wykonany kod**

Aby znale藕 **kod, kt贸ry zostanie wykonany w aplikacji**, przejd藕 do aktywnoci wywoanej przez deep link i wyszukaj funkcj **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Czue informacje**

Zawsze, gdy znajdziesz deep link, sprawd藕, czy **nie otrzymuje on wra偶liwych danych (takich jak hasa) za pomoc parametr贸w URL**, poniewa偶 inna aplikacja mo偶e **udawa deep link i kra te dane!**

**Parametry w cie偶ce**

Musisz r贸wnie偶 sprawdzi, czy jakikolwiek deep link u偶ywa parametru wewntrz cie偶ki URL, na przykad: `https://api.example.com/v1/users/{username}`, w takim przypadku mo偶esz wymusi przechodzenie cie偶ki, uzyskujc dostp do czego takiego jak: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Zauwa偶, 偶e jeli znajdziesz poprawne punkty kocowe w aplikacji, mo偶esz spowodowa **przekierowanie otwarte** (jeli cz cie偶ki jest u偶ywana jako nazwa domeny), **przejcie konta** (jeli mo偶esz modyfikowa dane u偶ytkownik贸w bez tokenu CSRF i podatny punkt kocowy u偶ywa poprawnej metody) i inne podatnoci. Wicej [informacji na ten temat tutaj](http://dphoeniixx.com/2020/12/13-2/).

**Wicej przykad贸w**

[Interesujcy raport o nagrodach za bdy](https://hackerone.com/reports/855618) dotyczcy link贸w (_/.well-known/assetlinks.json_).

### Bdy weryfikacji i inspekcji warstwy transportowej

- **Certyfikaty nie s zawsze odpowiednio sprawdzane** przez aplikacje Android. Czsto te aplikacje pomijaj ostrze偶enia i akceptuj samopodpisane certyfikaty lub, w niekt贸rych przypadkach, wracaj do korzystania z pocze HTTP.
- **Negocjacje podczas ustanawiania poczenia SSL/TLS s czasami sabe**, korzystajc z niebezpiecznych zestaw贸w szyfr贸w. Ta podatno sprawia, 偶e poczenie jest podatne na ataki typu man-in-the-middle (MITM), umo偶liwiajc atakujcym odszyfrowanie danych.
- **Wyciek prywatnych informacji** stanowi ryzyko, gdy aplikacje uwierzytelniaj si za pomoc bezpiecznych kana贸w, a nastpnie komunikuj si za pomoc niezabezpieczonych kana贸w w przypadku innych transakcji. Taki spos贸b postpowania nie chroni wra偶liwych danych, takich jak ciasteczka sesji lub dane u偶ytkownika, przed przechwyceniem przez zoliwe podmioty.

#### Weryfikacja certyfikatu

Skupimy si na **weryfikacji certyfikatu**. Aby zwikszy bezpieczestwo, konieczne jest sprawdzenie integralnoci certyfikatu serwera. Jest to istotne, poniewa偶 niebezpieczne konfiguracje TLS i przesyanie wra偶liwych danych przez niezaszyfrowane kanay mo偶e stanowi znaczne ryzyko. Szczeg贸owe kroki dotyczce weryfikacji certyfikat贸w serwera i usuwania podatnoci znajdziesz w **[tym 藕r贸dle](https://manifestsecurity.com/android-application-security-part-10/)**.

#### SSL Pinning

SSL Pinning to rodek bezpieczestwa, w kt贸rym aplikacja weryfikuje certyfikat serwera w stosunku do znanego egzemplarza przechowywanego w samej aplikacji. Ta metoda jest niezbdna do zapobiegania atakom typu man-in-the-middle (MITM). Zaleca si zdecydowanie implementacj SSL Pinning w aplikacjach obsugujcych wra偶liwe informacje.

#### Inspekcja ruchu

Aby inspirowa ruch HTTP, konieczne jest **zainstalowanie certyfikatu narzdzia proxy** (np. Burp). Bez zainstalowania tego certyfikatu, zaszyfrowany ruch mo偶e nie by widoczny przez proxy. Przewodnik dotyczcy instalacji niestandardowego certyfikatu CA znajdziesz **[tutaj](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine)**.

Aplikacje docelowe **API Level 24 i wy偶sze** wymagaj modyfikacji konfiguracji zabezpiecze sieciowych w celu zaakceptowania certyfikatu CA proxy. Ten krok jest kluczowy dla inspekcji zaszyfrowanego ruchu. Instrukcje dotyczce modyfikacji konfiguracji zabezpiecze sieciowych znajdziesz **[w tym samouczku](make-apk-accept-ca-certificate.md)**.

#### Omijanie SSL Pinning

Kiedy jest wdro偶one SSL Pinning, konieczne jest jego ominicie w celu inspekcji ruchu HTTPS. Dostpne s r贸偶ne metody w tym celu:

* Automatyczne **modyfikowanie** **apk** w celu **ominicia** SSL Pinning za pomoc [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). Najwiksz zalet tej opcji jest to, 偶e nie bdziesz potrzebowa uprawnie root do ominicia SSL Pinning, ale bdziesz musia usun aplikacj i zainstalowa now, a to nie zawsze zadziaa.
* Mo偶esz u偶y **Frida** (om贸wione poni偶ej), aby omin t ochron. Oto przewodnik dotyczcy korzystania z Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Mo偶esz r贸wnie偶 spr贸bowa **automatycznego omijania SSL Pinning** za pomoc [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Mo偶esz r贸wnie偶 spr贸bowa **automatycznego omijania SSL Pinning** za pomoc **analizy dynamicznej MobSF** (wyjanionej poni偶ej)
* Jeli nadal uwa偶asz, 偶e istnieje jaki ruch, kt贸rego nie przechwytujesz, mo偶esz spr贸bowa **przekierowa ruch do burp za pomoc iptables**. Przeczytaj ten blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### Wyszukiwanie powszechnych podatnoci sieciowych

Wa偶ne jest r贸wnie偶 wyszukiwanie powszechnych podatnoci sieciowych w aplikacji. Szczeg贸owe informacje dotyczce identyfikacji i agodzenia tych podatnoci wykraczaj poza zakres tego podsumowania, ale s szeroko om贸wione w innych miejscach.

### Frida

[Frida](https://www.frida.re) to dynamiczne narzdzie do instrumentacji dla programist贸w, in偶ynier贸w odwracajcych i badaczy zabezpiecze.\
**Mo偶esz uzyska dostp do dziaajcej aplikacji i podczy si do metod w czasie rzeczywistym, aby zmieni zachowanie, zmieni wartoci, wyodrbni wartoci, uruchomi inny kod...**\
Jeli chcesz przeprowadza testy penetracyjne aplikacji Android, musisz wiedzie, jak korzysta z Fridy.

* Dowiedz si, jak korzysta z Fridy: [**Samouczek Frida**](frida-tutorial/)
* Kilka "GUI" do dziaa z Frid: [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection jest wietne do automatyzacji korzystania z Fridy: [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* Kilka niesamowitych skrypt贸w Frida znajdziesz tutaj: [**https://codeshare.frida.re/**](https://codeshare.frida.re)

### **Dumpowanie pamici - Fridump**

Sprawd藕, czy aplikacja przechowuje wra偶liwe informacje w pamici, kt贸rych nie powinna przechowywa, takie jak hasa lub mnemoniki.

Za pomoc [**Fridump3**](https://github.com/rootbsd/fridump3) mo偶esz zrzuci pami aplikacji za pomoc:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
To spowoduje zrzut pamici do folderu ./dump, a nastpnie mo偶esz u偶y polecenia grep, na przykad: 

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Wra偶liwe dane w Keystore**

W systemie Android Keystore jest najlepszym miejscem do przechowywania wra偶liwych danych, jednak偶e, przy odpowiednich uprawnieniach wci偶 jest **mo偶liwe uzyskanie do nich dostpu**. Poniewa偶 aplikacje maj tendencj do przechowywania tutaj **wra偶liwych danych w postaci tekstu jawnego**, testy penetracyjne powinny to sprawdzi, poniewa偶 u偶ytkownik z uprawnieniami root lub osoba majca fizyczny dostp do urzdzenia mo偶e je ukra.

Nawet jeli aplikacja przechowuje dane w keystore, dane te powinny by zaszyfrowane.

Aby uzyska dostp do danych wewntrz keystore, mo偶na u偶y tego skryptu Frida: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Ominicie odcisku palca/biometrii**

Za pomoc poni偶szego skryptu Frida mo偶na pr贸bowa **omin uwierzytelnianie odciskiem palca** wykonywane przez aplikacje Android w celu **ochrony okrelonych obszar贸w o du偶ej wra偶liwoci:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Obrazy ta**

Gdy przenosisz aplikacj do ta, Android przechowuje **zdjcie aplikacji**, wic gdy zostanie przywr贸cona do pierwszego planu, zaczyna adowa obraz przed aplikacj, dziki czemu wydaje si, 偶e aplikacja zostaa wczytana szybciej.

Jednak jeli to zdjcie zawiera **wra偶liwe informacje**, osoba majca dostp do tego zdjcia mo偶e je **ukra** (zauwa偶, 偶e potrzebujesz uprawnie roota, aby uzyska do niego dostp).

Zdjcia s zazwyczaj przechowywane w okolicy: **`/data/system_ce/0/snapshots`**

Android umo偶liwia **zapobieganie przechwytywaniu zrzut贸w ekranu poprzez ustawienie parametru ukadu FLAG\_SECURE**. Korzystajc z tej flagi, zawarto okna jest traktowana jako bezpieczna, co uniemo偶liwia jej pojawienie si na zrzutach ekranu lub wywietlanie na niezabezpieczonych ekranach.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analizator aplikacji Android**

To narzdzie mo偶e pom贸c w zarzdzaniu r贸偶nymi narzdziami podczas analizy dynamicznej: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Wstrzykiwanie Intencji

Programici czsto tworz komponenty poredniczce, takie jak aktywnoci, usugi i odbiorniki nadawcze, kt贸re obsuguj te Intencje i przekazuj je do metod takich jak `startActivity(...)` lub `sendBroadcast(...)`, co mo偶e by ryzykowne.

Niebezpieczestwo polega na umo偶liwieniu atakujcym wywoania nieeksportowanych komponent贸w aplikacji lub dostpu do wra偶liwych dostawc贸w treci poprzez przekierowanie tych Intencji. Znaczcym przykadem jest komponent `WebView`, kt贸ry konwertuje adresy URL na obiekty `Intent` za pomoc `Intent.parseUri(...)` i nastpnie je wykonuje, co potencjalnie prowadzi do zoliwego wstrzykiwania Intencji.

### Podstawowe wnioski
- **Wstrzykiwanie Intencji** jest podobne do problemu przekierowania otwartego w sieci web.
- Ataki polegaj na przekazywaniu obiekt贸w `Intent` jako dodatk贸w, kt贸re mog by przekierowane do wykonania niebezpiecznych operacji.
- Mo偶e ujawni nieeksportowane komponenty i dostawc贸w treci atakujcym.
- Konwersja adresu URL do `Intent` w `WebView` mo偶e uatwi niezamierzone dziaania.

### Wstrzykiwanie po stronie klienta Androida i inne

Prawdopodobnie znasz tego rodzaju podatnoci z sieci web. Musisz by szczeg贸lnie ostro偶ny w przypadku tych podatnoci w aplikacji Android:

* **Wstrzykiwanie SQL:** Podczas pracy z dynamicznymi zapytaniami lub dostawcami treci upewnij si, 偶e u偶ywasz zapyta z parametrami.
* **Wstrzykiwanie JavaScript (XSS):** Sprawd藕, czy obsuga JavaScriptu i wtyczek jest wyczona dla wszystkich WebView (domylnie wyczone). [Wicej informacji tutaj](webview-attacks.md#javascript-enabled).
* **Lokalne wczenie plik贸w:** WebView powinien mie wyczony dostp do systemu plik贸w (domylnie wczony) - `(webview.getSettings().setAllowFileAccess(false);)`. [Wicej informacji tutaj](webview-attacks.md#javascript-enabled).
* **Wieczne ciasteczka**: W wielu przypadkach, gdy aplikacja Android koczy sesj, ciasteczko nie jest uniewa偶niane lub mo偶e by nawet zapisane na dysku.
* [**Flaga bezpieczestwa** w ciasteczkach](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Wnioski z Hackingu**\
Zajmuj si treciami, kt贸re zagbiaj si w emocje i wyzwania zwizane z hakerstwem

**Aktualnoci na 偶ywo z Hackingu**\
Bd藕 na bie偶co z szybkim tempem wiata hakerstwa dziki aktualnym wiadomociom i spostrze偶eniom

**Najnowsze ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i wa偶nymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

## Automatyczna analiza

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**Analiza statyczna**

![](<../../.gitbook/assets/image (61).png>)

**Ocena podatnoci aplikacji** za pomoc przyjaznego interfejsu internetowego. Mo偶esz r贸wnie偶 przeprowadzi analiz dynamiczn (ale musisz przygotowa rodowisko).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Zauwa偶, 偶e MobSF mo偶e analizowa aplikacje **Android** (apk), **IOS** (ipa) i **Windows** (apx) (_aplikacje Windows musz by analizowane z zainstalowanym MobSF na hocie z systemem Windows_).\
Dodatkowo, jeli utworzysz plik **ZIP** z kodem 藕r贸dowym aplikacji **Android** lub **IOS** (przejd藕 do g贸wnego folderu aplikacji, zaznacz wszystko i utw贸rz plik ZIP), bdzie mo偶na go r贸wnie偶 zanalizowa.

MobSF umo偶liwia r贸wnie偶 **por贸wnywanie** analizy i integracj z **VirusTotal** (musisz ustawi sw贸j klucz API w _MobSF/settings.py_ i wczy go: `VT_ENABLED = TRUE` `VT_API_KEY = <Tw贸j klucz API>` `VT_UPLOAD = TRUE`). Mo偶esz r贸wnie偶 ustawi `VT_UPLOAD` na `False`, wtedy **skr贸t** zostanie **przesany**, a nie plik.

### Wspomagana analiza dynamiczna z u偶yciem MobSF

MobSF mo偶e by r贸wnie偶 bardzo pomocny przy **analizie dynamicznej** w systemie **Android**, ale w tym przypadku musisz zainstalowa MobSF i **genymotion** na swoim hocie (maszyna wirtualna lub Docker nie bd dziaa). _Uwaga: Najpierw musisz **uruchomi maszyn wirtualn w genymotion**, a nastpnie MobSF._\
Analizator dynamiczny MobSF mo偶e:

* **Zrzuci dane aplikacji** (adresy URL, logi, schowek, zrzuty ekranu wykonane przez Ciebie, zrzuty ekranu wykonane przez "**Exported Activity Tester**", e-maile, bazy danych SQLite, pliki XML i inne utworzone pliki). Wszystko to odbywa si automatycznie, z wyjtkiem zrzut贸w ekranu, musisz nacisn, gdy chcesz zrobi zrzut ekranu, lub musisz nacisn "**Exported Activity Tester**", aby uzyska zrzuty ekranu wszystkich wyeksportowanych aktywnoci.
* Przechwytywa **ruch HTTPS**
* U偶ywa **Frida** do uzyskiwania **informacji o dziaaniu w czasie rzeczywistym**

Od wersji **Android > 5**, automatycznie uruchomi Frid i ustawia globalne ustawienia **proxy** do przechwytywania ruchu. Bdzie przechwytywa tylko ruch z testowanej aplikacji.

**Frida**

Domylnie u偶ywa r贸wnie偶 niekt贸rych skrypt贸w Fridy do **omijania weryfikacji SSL**, **wykrywania roota** i **wykrywania debugera**, a tak偶e do **monitorowania interesujcych interfejs贸w API**.\
MobSF mo偶e r贸wnie偶 **wywoywa wyeksportowane aktywnoci**, przechwytywa **zrzuty ekranu** z nich i **zapisywa** je do raportu.

Aby **rozpocz** testowanie dynamiczne, nacinij zielony przycisk: "**Start Instrumentation**". Nacinij "**Frida Live Logs**", aby zobaczy logi generowane przez skrypty Fridy, a "**Live API Monitor**", aby zobaczy wszystkie wywoania podczonych metod, przekazane argumenty i zwracane wartoci (to pojawi si po naciniciu "Start Instrumentation").\
MobSF umo偶liwia r贸wnie偶 adowanie wasnych **skrypt贸w Fridy** (aby przesa wyniki swoich skrypt贸w Fridy do MobSF, u偶yj funkcji `send()`). Posiada r贸wnie偶 **kilka gotowych skrypt贸w**, kt贸re mo偶na zaadowa (mo偶na doda wicej w `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), po prostu **wybierz je**, nacinij "**Load**" i nacinij "**Start Instrumentation**" (bdziesz m贸g zobaczy logi tych skrypt贸w wewntrz "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Ponadto, masz kilka pomocniczych funkcji Fridy:

* **Wypisz zaadowane klasy**: Wywietli wszystkie zaadowane klasy
* **Przechwy cigi**: Wywietli wszystkie przechwycone cigi podczas korzystania z aplikacji (bardzo gone)
* **Przechwy por贸wnania cig贸w**: Mo偶e by bardzo przydatne. Poka偶e **dwa por贸wnywane cigi** i wynik True lub False.
* **Wypisz metody klasy**: Wprowad藕 nazw klasy (np. "java.io.File") i wywietli wszystkie metody klasy.
* **Wyszukaj wzorzec klasy**: Wyszukaj klasy wedug wzorca
* **led藕 metody klasy**: **led藕** ca **klas** (zobacz wejcia i wyjcia wszystkich metod klasy). Pamitaj, 偶e domylnie MobSF ledzi kilka interesujcych metod Android Api.

Po wybraniu moduu pomocniczego, kt贸rego chcesz u偶y, musisz nacisn "**Start Intrumentation**", a wszystkie wyniki zostan wywietlone w "**Frida Live Logs**".

**Shell**

Mobsf oferuje r贸wnie偶 powok z niekt贸rymi poleceniami **adb**, **poleceniami MobSF** i powszechnymi **poleceniami powoki** na dole strony analizy dynamicznej. Kilka interesujcych polece:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**Narzdzia HTTP**

Gdy przechwytujesz ruch HTTP, mo偶esz zobaczy nieestetyczne widoki przechwyconego ruchu na dole "**Ruch HTTP(S)**" lub adniejszy widok w zielonym przycisku "**Uruchom narzdzia HTTP**". Z drugiej opcji mo偶esz **wysya** przechwycone **偶dania** do **proxy** takich jak Burp lub Owasp ZAP.\
Aby to zrobi, _wcz Burp -->_ _wycz Intercept --> w MobSB HTTPTools wybierz 偶danie_ --> nacinij "**Wylij do Fuzzer**" --> _wybierz adres proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Po zakoczeniu analizy dynamicznej z MobSF mo偶esz nacisn "**Uruchom Fuzzer interfejsu API sieciowego**" aby **fuzzowa 偶dania HTTP** i szuka podatnoci.

{% hint style="info" %}
Po wykonaniu analizy dynamicznej z MobSF ustawienia proxy mog by 藕le skonfigurowane i nie bdziesz w stanie ich naprawi z poziomu interfejsu graficznego. Mo偶esz naprawi ustawienia proxy wykonujc:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Asystowana analiza dynamiczna za pomoc Inspeckage

Mo偶esz pobra narzdzie z [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
To narzdzie u偶ywa pewnych **Hook贸w**, aby wiedzia, **co dzieje si w aplikacji** podczas wykonywania **analizy dynamicznej**.


### [Yaazhini](https://www.vegabird.com/yaazhini/)

To wietne narzdzie do przeprowadzania analizy statycznej z interfejsem graficznym (GUI).

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

To narzdzie zostao zaprojektowane w celu wyszukiwania kilku **zwizanych z bezpieczestwem podatnoci aplikacji Android**, zar贸wno w **kodzie 藕r贸dowym**, jak i w **pakietowanych APK**. Narzdzie to jest r贸wnie偶 **zdolne do tworzenia "Proof-of-Concept" APK** i **komend ADB**, aby wykorzysta niekt贸re z odnalezionych podatnoci (nara偶one aktywnoci, intencje, tapjacking...). Podobnie jak w przypadku Drozera, nie ma potrzeby rootowania urzdzenia testowego.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Wywietla wszystkie wyodrbnione pliki dla atwego odniesienia
* Automatycznie dekompiluje pliki APK do formatu Java i Smali
* Analizuje AndroidManifest.xml pod ktem powszechnych podatnoci i zachowa
* Statyczna analiza kodu 藕r贸dowego pod ktem powszechnych podatnoci i zachowa
* Informacje o urzdzeniu
* i wiele wicej
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER to aplikacja wiersza polece, kt贸ra mo偶e by u偶ywana w systemach Windows, MacOS X i Linux do analizy plik贸w _.apk_ w poszukiwaniu podatnoci. Robi to poprzez dekompresj plik贸w APK i zastosowanie serii regu w celu wykrycia tych podatnoci.

Wszystkie reguy s zawarte w pliku `rules.json`, a ka偶da firma lub tester mo偶e stworzy swoje wasne reguy, aby analizowa to, czego potrzebuj.

Pobierz najnowsze binaria ze [strony pobierania](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn to **platformowo-niezale偶ne** narzdzie, kt贸re pomaga programistom, owcom bd贸w i etycznym hackerom w przeprowadzaniu [statycznej analizy kodu](https://en.wikipedia.org/wiki/Static\_program\_analysis) aplikacji mobilnych.

Idea polega na przecigniciu i upuszczeniu pliku aplikacji mobilnej (plik .apk lub .ipa) na aplikacj StaCoAn, kt贸ra wygeneruje dla Ciebie raport wizualny i przenony. Mo偶esz dostosowa ustawienia i listy s贸w, aby uzyska spersonalizowane dowiadczenie.

Pobierz [najnowsze wydanie](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework to system analizy podatnoci Androida, kt贸ry pomaga programistom lub hakerom znale藕 potencjalne luki w zabezpieczeniach aplikacji Androidowych.\
[Wersje dla systemu Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** to narzdzie, kt贸rego g贸wnym celem jest wykrywanie i ostrzeganie u偶ytkownika o potencjalnie szkodliwym zachowaniu aplikacji Android.

Wykrywanie odbywa si poprzez **statyczn analiz** kodu bajtowego Dalvik aplikacji, reprezentowanego jako **Smali**, przy u偶yciu biblioteki [`androguard`](https://github.com/androguard/androguard).

To narzdzie szuka **typowych zachowa "zych" aplikacji**, takich jak: wyciek identyfikator贸w telefonicznych, przechwytywanie strumieni audio/wideo, modyfikacja danych PIM, wykonanie dowolnego kodu...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [Framework MARA](https://github.com/xtiankisutsa/MARA_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** to narzdzie do **odwracania in偶ynierii i analizy aplikacji mobilnych**. Jest to narzdzie, kt贸re czy popularne narzdzia do odwracania in偶ynierii i analizy aplikacji mobilnych, aby pom贸c w testowaniu aplikacji mobilnych pod ktem zagro偶e zwizanych z bezpieczestwem OWASP. Jego celem jest uatwienie i przyjazne dla programist贸w aplikacji mobilnych oraz specjalist贸w ds. bezpieczestwa.

Narzdzie to umo偶liwia:

* Wyodrbnianie kodu Java i Smali za pomoc r贸偶nych narzdzi
* Analizowanie plik贸w APK za pomoc: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Wyodrbnianie prywatnych informacji z plik贸w APK za pomoc wyra偶e regularnych.
* Analizowanie manifestu.
* Analizowanie znalezionych domen za pomoc: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) i [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Deobfuskacja plik贸w APK za pomoc [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

Przydatne narzdzie do wykrywania zoliwego oprogramowania: [https://koodous.com/](https://koodous.com)

## Obfuskacja/Deobfuskacja kodu

Nale偶y pamita, 偶e w zale偶noci od usugi i konfiguracji u偶ytej do obfuskacji kodu, tajemnice mog by lub nie by obfuskowane.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

Z [Wikipedia](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** to narzdzie wiersza polece o otwartym kodzie 藕r贸dowym, kt贸re zmniejsza, optymalizuje i obfuskuje kod Java. Potrafi optymalizowa kod bajtowy oraz wykrywa i usuwa nieu偶ywane instrukcje. ProGuard jest oprogramowaniem darmowym i jest dystrybuowany na licencji GNU General Public License, wersja 2.

ProGuard jest dystrybuowany jako cz Android SDK i uruchamiany podczas budowania aplikacji w trybie wydania.

### [DexGuard](https://www.guardsquare.com/dexguard)

Znajd藕 przewodnik krok po kroku, jak deobfuskowa plik APK na stronie [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Z tego przewodnika) Ostatnio sprawdzilimy, 偶e tryb dziaania Dexguard to:

* zaaduj zas贸b jako InputStream;
* przeka偶 wynik do klasy dziedziczcej po FilterInputStream, aby go zaszyfrowa;
* wykonaj niepotrzebn obfuskacj, aby straci kilka minut czasu od odwracacza;
* przeka偶 zdeszyfrowany wynik do ZipInputStream, aby uzyska plik DEX;
* w kocu zaaduj wynikowy DEX jako zas贸b za pomoc metody `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard odwraca proces obfuskacji wykonywanej przez narzdzia do obfuskacji Androida. Umo偶liwia to wiele analiz zwizanych z bezpieczestwem, w tym inspekcj kodu i przewidywanie bibliotek.**

Mo偶esz przesa zobfuskowany plik APK na ich platform.

### [Simplify](https://github.com/CalebFenton/simplify)

Jest to **og贸lny deobfuskator Androida**. Simplify **wirtualnie wykonuje aplikacj**, aby zrozumie jej zachowanie, a nastpnie **stara si zoptymalizowa kod**, aby zachowywa si identycznie, ale by atwiejszy do zrozumienia dla czowieka. Ka偶dy rodzaj optymalizacji jest prosty i og贸lny, wic nie ma znaczenia, jaki konkretny rodzaj obfuskacji jest u偶ywany.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD dostarcza informacje na temat **sposobu tworzenia pliku APK**. Rozpoznaje wiele **kompilator贸w**, **pakowaczy**, **obfuskator贸w** i innych dziwnych rzeczy. To jest [_PEiD_](https://www.aldeid.com/wiki/PEiD) dla Androida.

### Manual

[Przeczytaj ten samouczek, aby nauczy si kilku sztuczek dotyczcych **odwracania niestandardowej obfuskacji**](manual-deobfuscation.md)

## Laboratoria

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b to wirtualna maszyna z systemem Android oparta na ubuntu-mate, zawierajca najnowsze frameworki, samouczki i laboratoria od r贸偶nych ekspert贸w ds. bezpieczestwa i badaczy do odwracania in偶ynierii i analizy zoliwego oprogramowania.

## Odnoniki

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) To wietna lista zasob贸w
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Szybki kurs Androida
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Jeszcze do wypr贸bowania

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Docz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowa si z dowiadczonymi hakerami i owcami bd贸w!

**Wnioski z hakerstwa**\
Zajmuj si treciami, kt贸re zagbiaj si w emocje i wyzwania hakerstwa

**Aktualne wiadomoci o hakerstwie**\
Bd藕 na bie偶co z szybkim tempem wiata hakerstwa dziki aktualnym wiadomociom i spostrze偶eniom

**Najnowsze ogoszenia**\
Bd藕 na bie偶co z najnowszymi programami bug bounty i wa偶nymi aktualizacjami platformy

**Docz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wsp贸pracowa z najlepszymi hakerami ju偶 dzi!

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy **reklam swojej firmy w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/c
