# Android-Anwendungen Pentesting

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Tritt dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Einblicke**\
Engagiere dich mit Inhalten, die in den Nervenkitzel und die Herausforderungen des Hackens eintauchen

**Echtzeit-Hack-Nachrichten**\
Bleibe auf dem Laufenden √ºber die schnelllebige Hacking-Welt durch Echtzeit-Nachrichten und Einblicke

**Neueste Ank√ºndigungen**\
Bleibe informiert √ºber die neuesten Bug-Bounties und wichtige Plattform-Updates

**Tritt uns auf** [**Discord**](https://discord.com/invite/N3FrSbmwdy) bei und beginne noch heute mit den besten Hackern zusammenzuarbeiten!

## Grundlagen der Android-Anwendungen

Es wird dringend empfohlen, diese Seite zu lesen, um √ºber die **wichtigsten Teile in Bezug auf die Android-Sicherheit und die gef√§hrlichsten Komponenten in einer Android-Anwendung** informiert zu sein:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Dies ist das Hauptwerkzeug, das du ben√∂tigst, um eine Verbindung zu einem Android-Ger√§t (emuliert oder physisch) herzustellen.\
**ADB** erm√∂glicht die Steuerung von Ger√§ten entweder √ºber **USB** oder **Netzwerk** von einem Computer aus. Dieses Dienstprogramm erm√∂glicht das **Kopieren** von Dateien in beide Richtungen, die **Installation** und **Deinstallation** von Apps, die **Ausf√ºhrung** von Shell-Befehlen, das **Sichern** von Daten, das **Lesen** von Protokollen und andere Funktionen.

Sieh dir die folgende Liste von [**ADB-Befehlen**](adb-commands.md) an, um zu lernen, wie man ADB verwendet.

## Smali

Manchmal ist es interessant, den **Anwendungscode zu √§ndern**, um auf **versteckte Informationen** (vielleicht gut obfuskierte Passw√∂rter oder Flags) zuzugreifen. Dann k√∂nnte es interessant sein, die APK zu dekompilieren, den Code zu √§ndern und sie neu zu kompilieren.\
[**In diesem Tutorial** kannst du **lernen, wie man eine APK dekompiliert, Smali-Code √§ndert und die APK** mit der neuen Funktionalit√§t neu kompiliert](smali-changes.md). Dies k√∂nnte sehr n√ºtzlich sein als **Alternative f√ºr mehrere Tests w√§hrend der dynamischen Analyse**, die pr√§sentiert werden. Denke immer an diese M√∂glichkeit.

## Weitere interessante Tricks

* [Standort im Play Store f√§lschen](spoofing-your-location-in-play-store.md)
* **APK herunterladen**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/), [https://github.com/kiber-io/apkd](https://github.com/kiber-io/apkd)
* APK vom Ger√§t extrahieren:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
* F√ºgen Sie alle Splits und Basis-APKs mit [APKEditor](https://github.com/REAndroid/APKEditor) zusammen:
```bash
mkdir splits
adb shell pm path com.android.insecurebankv2 | cut -d ':' -f 2 | xargs -n1 -i adb pull {} splits
java -jar ../APKEditor.jar m -i splits/ -o merged.apk

# after merging, you will need to align and sign the apk, personally, I like to use the uberapksigner
java -jar uber-apk-signer.jar -a merged.apk --allowResign -o merged_signed
```
## Statische Analyse

Zun√§chst sollten Sie beim Analysieren einer APK **einen Blick auf den Java-Code werfen** mithilfe eines Decompilers.\
Bitte, [**lesen Sie hier, um Informationen √ºber verschiedene verf√ºgbare Decompiler zu finden**](apk-decompilers.md).

### Auf der Suche nach interessanten Informationen

Wenn Sie sich die **Strings** der APK ansehen, k√∂nnen Sie nach **Passw√∂rtern**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **API**-Schl√ºsseln, **Verschl√ºsselung**, **Bluetooth UUIDs**, **Tokens** und allem Interessanten suchen... schauen Sie sogar nach Codeausf√ºhrungs-**Backdoors** oder Authentifizierungs-Backdoors (hardcodierte Admin-Anmeldeinformationen f√ºr die App).

**Firebase**

Achten Sie besonders auf **Firebase-URLs** und √ºberpr√ºfen Sie, ob sie schlecht konfiguriert sind. [Weitere Informationen dar√ºber, was Firebase ist und wie man es ausnutzen kann, finden Sie hier.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Grundverst√§ndnis der Anwendung - Manifest.xml, strings.xml

Die **Untersuchung der \_Manifest.xml**_\*\* und \*\*_**strings.xml**\_\*\* Dateien kann potenzielle Sicherheitsanf√§lligkeiten aufdecken\*\*. Diese Dateien k√∂nnen mithilfe von Decompilern oder durch Umbenennen der APK-Dateierweiterung in .zip und anschlie√üendes Entpacken darauf zugegriffen werden.

**Sicherheitsanf√§lligkeiten**, die aus der **Manifest.xml** identifiziert wurden, umfassen:

* **Debuggable Anwendungen**: Anwendungen, die im _Manifest.xml_ Datei als debuggable (`debuggable="true"`) festgelegt sind, stellen ein Risiko dar, da sie Verbindungen zulassen, die zu einer Ausnutzung f√ºhren k√∂nnen. F√ºr ein besseres Verst√§ndnis, wie man debuggable Anwendungen ausnutzt, verweisen Sie auf ein Tutorial zum Finden und Ausnutzen von debuggable Anwendungen auf einem Ger√§t.
* **Backup-Einstellungen**: Das Attribut `android:allowBackup="false"` sollte ausdr√ºcklich f√ºr Anwendungen festgelegt werden, die mit sensiblen Informationen umgehen, um unbefugte Datenbackups √ºber adb zu verhindern, insbesondere wenn USB-Debugging aktiviert ist.
* **Netzwerksicherheit**: Benutzerdefinierte Netzwerksicherheitskonfigurationen (`android:networkSecurityConfig="@xml/network_security_config"`) in _res/xml/_ k√∂nnen Sicherheitsdetails wie Zertifikatspinning und HTTP-Verkehrseinstellungen festlegen. Ein Beispiel ist das Zulassen von HTTP-Verkehr f√ºr bestimmte Domains.
* **Exportierte Aktivit√§ten und Dienste**: Das Identifizieren exportierter Aktivit√§ten und Dienste im Manifest kann Komponenten hervorheben, die missbraucht werden k√∂nnten. Eine weitere Analyse w√§hrend des dynamischen Testens kann aufzeigen, wie man diese Komponenten ausnutzen kann.
* **Content Provider und FileProviders**: Exponierte Content Provider k√∂nnten unbefugten Zugriff oder Modifikationen von Daten erm√∂glichen. Die Konfiguration von FileProviders sollte ebenfalls √ºberpr√ºft werden.
* **Broadcast-Empf√§nger und URL-Schemata**: Diese Komponenten k√∂nnten f√ºr Ausnutzungen verwendet werden, wobei besonderes Augenmerk darauf gelegt werden sollte, wie URL-Schemata f√ºr Eingabeverwundbarkeiten verwaltet werden.
* **SDK-Versionen**: Die Attribute `minSdkVersion`, `targetSDKVersion` und `maxSdkVersion` geben die unterst√ºtzten Android-Versionen an und heben die Bedeutung hervor, veraltete, anf√§llige Android-Versionen aus Sicherheitsgr√ºnden nicht zu unterst√ºtzen.

Aus der **strings.xml** Datei k√∂nnen sensible Informationen wie API-Schl√ºssel, benutzerdefinierte Schemata und andere Entwicklernotizen entdeckt werden, was die Notwendigkeit einer sorgf√§ltigen √úberpr√ºfung dieser Ressourcen unterstreicht.

### Tapjacking

**Tapjacking** ist ein Angriff, bei dem eine **b√∂sartige** **Anwendung** gestartet wird und **sich √ºber eine Opferanwendung positioniert**. Sobald sie die Opfer-App sichtbar verdeckt, ist ihre Benutzeroberfl√§che so gestaltet, dass sie den Benutzer dazu verleitet, mit ihr zu interagieren, w√§hrend sie die Interaktion an die Opfer-App weiterleitet.\
In der Tat **blindet es den Benutzer, sodass er nicht wei√ü, dass er tats√§chlich Aktionen auf der Opfer-App ausf√ºhrt**.

Weitere Informationen finden Sie in:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Task Hijacking

Eine **Aktivit√§t**, deren **`launchMode`** auf **`singleTask`** ohne definierte `taskAffinity` festgelegt ist, ist anf√§llig f√ºr Task Hijacking. Das bedeutet, dass eine **Anwendung** installiert werden kann und, wenn sie vor der echten Anwendung gestartet wird, **die Aufgabe der echten Anwendung √ºbernehmen k√∂nnte** (sodass der Benutzer mit der **b√∂sartigen Anwendung interagiert, w√§hrend er denkt, er benutze die echte**).

Weitere Informationen finden Sie in:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Unsichere Datenspeicherung

**Interner Speicher**

In Android sind Dateien, die im **internen** Speicher **gespeichert** werden, **so konzipiert**, dass sie **ausschlie√ülich** von der **App**, die sie **erstellt** hat, **zug√§nglich** sind. Diese Sicherheitsma√ünahme wird vom Android-Betriebssystem **durchgesetzt** und ist im Allgemeinen ausreichend f√ºr die Sicherheitsbed√ºrfnisse der meisten Anwendungen. Entwickler nutzen jedoch manchmal Modi wie `MODE_WORLD_READABLE` und `MODE_WORLD_WRITABLE`, um **Dateien** zwischen verschiedenen Anwendungen **zu teilen**. Diese Modi **beschr√§nken jedoch nicht den Zugriff** auf diese Dateien durch andere Anwendungen, einschlie√ülich potenziell b√∂sartiger.

1. **Statische Analyse:**
* **Stellen Sie sicher**, dass die Verwendung von `MODE_WORLD_READABLE` und `MODE_WORLD_WRITABLE` **sorgf√§ltig √ºberpr√ºft** wird. Diese Modi **k√∂nnten potenziell** Dateien **unbeabsichtigt oder unbefugt zug√§nglich machen**.
2. **Dynamische Analyse:**
* **√úberpr√ºfen** Sie die **Berechtigungen**, die f√ºr Dateien festgelegt sind, die von der App erstellt wurden. √úberpr√ºfen Sie insbesondere, ob Dateien **so festgelegt sind, dass sie weltweit lesbar oder schreibbar sind**. Dies kann ein erhebliches Sicherheitsrisiko darstellen, da es **jeder Anwendung**, die auf dem Ger√§t installiert ist, unabh√§ngig von ihrer Herkunft oder Absicht, **erm√∂glicht, diese Dateien zu lesen oder zu √§ndern**.

**Externer Speicher**

Beim Umgang mit Dateien auf **externem Speicher**, wie SD-Karten, sollten bestimmte Vorsichtsma√ünahmen getroffen werden:

1. **Zug√§nglichkeit**:
* Dateien auf externem Speicher sind **global lesbar und schreibbar**. Das bedeutet, dass jede Anwendung oder jeder Benutzer auf diese Dateien zugreifen kann.
2. **Sicherheitsbedenken**:
* Angesichts der einfachen Zug√§nglichkeit wird geraten, **keine sensiblen Informationen** auf externem Speicher zu speichern.
* Externer Speicher kann entfernt oder von jeder Anwendung zugegriffen werden, was ihn weniger sicher macht.
3. **Umgang mit Daten vom externen Speicher**:
* F√ºhren Sie immer **Eingangsvalidierungen** f√ºr Daten durch, die vom externen Speicher abgerufen werden. Dies ist entscheidend, da die Daten aus einer nicht vertrauensw√ºrdigen Quelle stammen.
* Das Speichern von ausf√ºhrbaren Dateien oder Klassen auf externem Speicher f√ºr dynamisches Laden wird dringend abgeraten.
* Wenn Ihre Anwendung ausf√ºhrbare Dateien vom externen Speicher abrufen muss, stellen Sie sicher, dass diese Dateien **signiert und kryptografisch verifiziert** sind, bevor sie dynamisch geladen werden. Dieser Schritt ist entscheidend f√ºr die Aufrechterhaltung der Sicherheitsintegrit√§t Ihrer Anwendung.

Externer Speicher kann in `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard` **zugegriffen** werden.

{% hint style="info" %}
Beginnend mit Android 4.4 (**API 17**) hat die SD-Karte eine Verzeichnisstruktur, die **den Zugriff einer App auf das Verzeichnis, das speziell f√ºr diese App vorgesehen ist, einschr√§nkt**. Dies verhindert, dass b√∂sartige Anwendungen Lese- oder Schreibzugriff auf die Dateien einer anderen App erhalten.
{% endhint %}

**Sensible Daten im Klartext gespeichert**

* **Geteilte Pr√§ferenzen**: Android erm√∂glicht es jeder Anwendung, XML-Dateien im Pfad `/data/data/<packagename>/shared_prefs/` einfach zu speichern, und manchmal ist es m√∂glich, sensible Informationen im Klartext in diesem Ordner zu finden.
* **Datenbanken**: Android erm√∂glicht es jeder Anwendung, SQLite-Datenbanken im Pfad `/data/data/<packagename>/databases/` einfach zu speichern, und manchmal ist es m√∂glich, sensible Informationen im Klartext in diesem Ordner zu finden.

### Gebrochene TLS

**Alle Zertifikate akzeptieren**

Aus irgendeinem Grund akzeptieren Entwickler manchmal alle Zertifikate, selbst wenn beispielsweise der Hostname nicht mit Zeilen von Code wie der folgenden √ºbereinstimmt:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
Ein guter Weg, dies zu testen, besteht darin, den Datenverkehr mit einem Proxy wie Burp zu erfassen, ohne Burp CA auf dem Ger√§t zu autorisieren. Au√üerdem k√∂nnen Sie mit Burp ein Zertifikat f√ºr einen anderen Hostnamen generieren und es verwenden.

### Broken Cryptography

**Schlechte Schl√ºsselverwaltungsprozesse**

Einige Entwickler speichern sensible Daten im lokalen Speicher und verschl√ºsseln sie mit einem im Code hardcodierten/vorhersehbaren Schl√ºssel. Dies sollte nicht getan werden, da einige Reverse-Engineering-Aktivit√§ten Angreifern erm√∂glichen k√∂nnten, die vertraulichen Informationen zu extrahieren.

**Verwendung unsicherer und/oder veralteter Algorithmen**

Entwickler sollten keine **veralteten Algorithmen** verwenden, um **Autorisierungspr√ºfungen** durchzuf√ºhren, **Daten zu speichern** oder **zu senden**. Einige dieser Algorithmen sind: RC4, MD4, MD5, SHA1... Wenn **Hashes** beispielsweise zum Speichern von Passw√∂rtern verwendet werden, sollten hash-brute-force **resistente** Hashes mit Salt verwendet werden.

### Weitere √úberpr√ºfungen

* Es wird empfohlen, die **APK zu obfuskieren**, um die Reverse-Engineering-Arbeit f√ºr Angreifer zu erschweren.
* Wenn die App sensibel ist (wie Bank-Apps), sollte sie ihre **eigenen √úberpr√ºfungen durchf√ºhren, um zu sehen, ob das Mobilger√§t gerootet ist**, und entsprechend handeln.
* Wenn die App sensibel ist (wie Bank-Apps), sollte sie √ºberpr√ºfen, ob ein **Emulator** verwendet wird.
* Wenn die App sensibel ist (wie Bank-Apps), sollte sie **ihre eigene Integrit√§t √ºberpr√ºfen, bevor sie ausgef√ºhrt wird**, um zu √ºberpr√ºfen, ob sie modifiziert wurde.
* Verwenden Sie [**APKiD**](https://github.com/rednaga/APKiD), um zu √ºberpr√ºfen, welcher Compiler/Packer/Obfuskator verwendet wurde, um die APK zu erstellen.

### React Native Anwendung

Lesen Sie die folgende Seite, um zu erfahren, wie Sie einfach auf den JavaScript-Code von React-Anwendungen zugreifen k√∂nnen:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Xamarin-Anwendungen

Lesen Sie die folgende Seite, um zu erfahren, wie Sie einfach auf den C#-Code von Xamarin-Anwendungen zugreifen k√∂nnen:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Superpacked Anwendungen

Laut diesem [**Blogbeitrag**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/) ist superpacked ein Meta-Algorithmus, der den Inhalt einer Anwendung in einer einzigen Datei komprimiert. Der Blog spricht √ºber die M√∂glichkeit, eine App zu erstellen, die diese Art von Apps dekomprimiert... und einen schnelleren Weg, der darin besteht, die **Anwendung auszuf√ºhren und die dekomprimierten Dateien vom Dateisystem zu sammeln.**

### Automatisierte statische Codeanalyse

Das Tool [**mariana-trench**](https://github.com/facebook/mariana-trench) ist in der Lage, **Schwachstellen** durch **Scannen** des **Codes** der Anwendung zu finden. Dieses Tool enth√§lt eine Reihe von **bekannten Quellen** (die dem Tool die **Stellen** anzeigen, an denen die **Eingabe** **vom Benutzer** **kontrolliert** wird), **Senken** (die dem Tool **gef√§hrliche** **Stellen** anzeigen, an denen b√∂sartige Benutzereingaben Sch√§den verursachen k√∂nnten) und **Regeln**. Diese Regeln zeigen die **Kombination** von **Quellen-Senken**, die auf eine Schwachstelle hinweisen.

Mit diesem Wissen wird **mariana-trench den Code √ºberpr√ºfen und m√∂gliche Schwachstellen darin finden**.

### Geheimnisse geleakt

Eine Anwendung kann Geheimnisse (API-Schl√ºssel, Passw√∂rter, versteckte URLs, Subdomains...) enthalten, die Sie m√∂glicherweise entdecken k√∂nnen. Sie k√∂nnten ein Tool wie [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks) verwenden.

### Umgehung der biometrischen Authentifizierung

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Weitere interessante Funktionen

* **Codeausf√ºhrung**: `Runtime.exec(), ProcessBuilder(), native code:system()`
* **SMS senden**: `sendTextMessage, sendMultipartTestMessage`
* **Native Funktionen** deklariert als `native`: `public native, System.loadLibrary, System.load`
* [Lesen Sie dies, um zu lernen, **wie man native Funktionen zur√ºckverfolgt**](reversing-native-libraries.md)

### **Weitere Tricks**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Insights**\
Engagieren Sie sich mit Inhalten, die in die Aufregung und die Herausforderungen des Hackens eintauchen.

**Echtzeit-Hack-Nachrichten**\
Bleiben Sie auf dem Laufenden √ºber die schnelllebige Hackerwelt durch Echtzeitnachrichten und Einblicke.

**Neueste Ank√ºndigungen**\
Bleiben Sie informiert √ºber die neuesten Bug-Bounties und wichtige Plattform-Updates.

**Treten Sie uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) und beginnen Sie noch heute mit der Zusammenarbeit mit Top-Hackern!

***

## Dynamische Analyse

> Zun√§chst ben√∂tigen Sie eine Umgebung, in der Sie die Anwendung und die gesamte Umgebung (Burp CA-Zertifikat, Drozer und Frida haupts√§chlich) installieren k√∂nnen. Daher wird ein gerootetes Ger√§t (emuliert oder nicht) dringend empfohlen.

### Online-Dynamische Analyse

Sie k√∂nnen ein **kostenloses Konto** unter [https://appetize.io/](https://appetize.io) erstellen. Diese Plattform erm√∂glicht es Ihnen, APKs **hochzuladen** und **auszuf√ºhren**, sodass es n√ºtzlich ist, um zu sehen, wie sich eine APK verh√§lt.

Sie k√∂nnen sogar **die Protokolle Ihrer Anwendung** im Web sehen und √ºber **adb** verbinden.

![](<../../.gitbook/assets/image (831).png>)

Dank der ADB-Verbindung k√∂nnen Sie **Drozer** und **Frida** innerhalb der Emulatoren verwenden.

### Lokale dynamische Analyse

#### Verwendung eines Emulators

* [**Android Studio**](https://developer.android.com/studio) (Sie k√∂nnen **x86** und **arm** Ger√§te erstellen, und laut [**diesem**](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**neueste x86** Versionen **unterst√ºtzen ARM-Bibliotheken** ohne einen langsamen ARM-Emulator zu ben√∂tigen).
* Lernen Sie, wie Sie es auf dieser Seite einrichten:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Kostenlose Version:** Personal Edition, Sie m√ºssen ein Konto erstellen. _Es wird empfohlen, die Version **MIT** _**VirtualBox** herunterzuladen, um potenzielle Fehler zu vermeiden._)
* [**Nox**](https://es.bignox.com) (Kostenlos, unterst√ºtzt jedoch kein Frida oder Drozer).

{% hint style="info" %}
Beim Erstellen eines neuen Emulators auf einer beliebigen Plattform denken Sie daran, dass je gr√∂√üer der Bildschirm ist, desto langsamer der Emulator l√§uft. W√§hlen Sie also nach M√∂glichkeit kleine Bildschirme aus.
{% endhint %}

Um **Google-Dienste** (wie den App Store) in Genymotion zu installieren, m√ºssen Sie auf die rot markierte Schaltfl√§che im folgenden Bild klicken:

![](<../../.gitbook/assets/image (277).png>)

Beachten Sie auch, dass Sie in der **Konfiguration der Android-VM in Genymotion** den **Bridge-Netzwerkmodus** ausw√§hlen k√∂nnen (dies wird n√ºtzlich sein, wenn Sie von einer anderen VM mit den Tools auf die Android-VM zugreifen m√∂chten).

#### Verwendung eines physischen Ger√§ts

Sie m√ºssen die **Debugging**-Optionen aktivieren, und es w√§re gut, wenn Sie es **rooten** k√∂nnen:

1. **Einstellungen**.
2. (Ab Android 8.0) W√§hlen Sie **System**.
3. W√§hlen Sie **√úber das Telefon**.
4. Dr√ºcken Sie **Build-Nummer** 7 Mal.
5. Gehen Sie zur√ºck und Sie finden die **Entwickleroptionen**.

> Sobald Sie die Anwendung installiert haben, sollten Sie zun√§chst versuchen, sie zu verwenden und zu untersuchen, was sie tut, wie sie funktioniert und sich damit vertraut zu machen.\
> Ich empfehle, diese erste dynamische Analyse mit MobSF-Dynamikanalyse + pidcat durchzuf√ºhren, damit wir **lernen k√∂nnen, wie die Anwendung funktioniert**, w√§hrend MobSF eine Menge **interessanter** **Daten** erfasst, die Sie sp√§ter √ºberpr√ºfen k√∂nnen.

### Unbeabsichtigte Datenlecks

**Protokollierung**

Entwickler sollten vorsichtig sein, **Debugging-Informationen** √∂ffentlich zug√§nglich zu machen, da dies zu sensiblen Datenlecks f√ºhren kann. Die Tools [**pidcat**](https://github.com/JakeWharton/pidcat) und `adb logcat` werden empfohlen, um Anwendungsprotokolle zu √ºberwachen, um sensible Informationen zu identifizieren und zu sch√ºtzen. **Pidcat** wird wegen seiner Benutzerfreundlichkeit und Lesbarkeit bevorzugt.

{% hint style="warning" %}
Beachten Sie, dass ab **neueren Versionen als Android 4.0** **Anwendungen nur auf ihre eigenen Protokolle zugreifen k√∂nnen**. Anwendungen k√∂nnen also nicht auf die Protokolle anderer Apps zugreifen.\
Dennoch wird empfohlen, **sensible Informationen nicht zu protokollieren**.
{% endhint %}

**Zwischenspeicherung der Copy/Paste-Puffer**

Das **Clipboard-basierte** Framework von Android erm√∂glicht die Copy-Paste-Funktionalit√§t in Apps, birgt jedoch ein Risiko, da **andere Anwendungen** auf die Zwischenablage **zugreifen** k√∂nnen, was potenziell sensible Daten offenlegt. Es ist wichtig, die **Copy/Paste**-Funktionen f√ºr sensible Abschnitte einer Anwendung, wie z. B. Kreditkartendetails, zu deaktivieren, um Datenlecks zu verhindern.

**Absturzprotokolle**

Wenn eine Anwendung **abst√ºrzt** und **Protokolle speichert**, k√∂nnen diese Protokolle Angreifern helfen, insbesondere wenn die Anwendung nicht zur√ºckverfolgt werden kann. Um dieses Risiko zu mindern, vermeiden Sie das Protokollieren bei Abst√ºrzen, und wenn Protokolle √ºber das Netzwerk √ºbertragen werden m√ºssen, stellen Sie sicher, dass sie √ºber einen SSL-Kanal zur Sicherheit gesendet werden.

Als Pentester sollten Sie **diese Protokolle √ºberpr√ºfen**.

**Analysedaten, die an Dritte gesendet werden**

Anwendungen integrieren h√§ufig Dienste wie Google Adsense, die unbeabsichtigt **sensible Daten** aufgrund unsachgem√§√üer Implementierung durch Entwickler **leaken** k√∂nnen. Um potenzielle Datenlecks zu identifizieren, ist es ratsam, den **Datenverkehr der Anwendung abzufangen** und nach sensiblen Informationen zu suchen, die an Dritte gesendet werden.

### SQLite-Datenbanken

Die meisten Anwendungen verwenden **interne SQLite-Datenbanken**, um Informationen zu speichern. W√§hrend des Pentests sollten Sie einen **Blick** auf die **erstellten Datenbanken**, die Namen der **Tabellen** und **Spalten** sowie alle **gespeicherten Daten** werfen, da Sie **sensible Informationen** finden k√∂nnten (was eine Schwachstelle darstellen w√ºrde).\
Datenbanken sollten sich in `/data/data/the.package.name/databases` wie `/data/data/com.mwr.example.sieve/databases` befinden.

Wenn die Datenbank vertrauliche Informationen speichert und **verschl√ºsselt** ist, Sie jedoch das **Passwort** innerhalb der Anwendung **finden**, ist dies immer noch eine **Schwachstelle**.

Z√§hlen Sie die Tabellen mit `.tables` und z√§hlen Sie die Spalten der Tabellen mit `.schema <table_name>`.

### Drozer (Exploiting Activities, Content Providers und Services)

Laut [Drozer-Dokumentation](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** erm√∂glicht es Ihnen, **die Rolle einer Android-App zu √ºbernehmen** und mit anderen Apps zu interagieren. Es kann **alles tun, was eine installierte Anwendung tun kann**, wie die Nutzung des Inter-Process Communication (IPC)-Mechanismus von Android und die Interaktion mit dem zugrunde liegenden Betriebssystem.\
Drozer ist ein n√ºtzliches Tool, um **exportierte Aktivit√§ten, exportierte Dienste und Content Provider** auszunutzen, wie Sie in den folgenden Abschnitten lernen werden.

### Ausnutzen exportierter Aktivit√§ten

[**Lesen Sie dies, wenn Sie auffrischen m√∂chten, was eine Android-Aktivit√§t ist.**](android-applications-basics.md#launcher-activity-and-other-activities)\
Denken Sie auch daran, dass der Code einer Aktivit√§t in der **`onCreate`**-Methode beginnt.

**Autorisierungsumgehung**

Wenn eine Aktivit√§t exportiert wird, k√∂nnen Sie ihren Bildschirm von einer externen App aus aufrufen. Daher k√∂nnten Sie, wenn eine Aktivit√§t mit **sensiblen Informationen** **exportiert** wird, die **Authentifizierungs**-Mechanismen **umgehen**, um darauf zuzugreifen.

[**Erfahren Sie, wie Sie exportierte Aktivit√§ten mit Drozer ausnutzen.**](drozer-tutorial/#activities)

Sie k√∂nnen auch eine exportierte Aktivit√§t von adb starten:

* Paketname ist com.example.demo
* Exportierte Aktivit√§tsname ist com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**HINWEIS**: MobSF wird die Verwendung von _**singleTask/singleInstance**_ als `android:launchMode` in einer Aktivit√§t als b√∂sartig erkennen, aber aufgrund von [diesem](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750) ist dies anscheinend nur in alten Versionen (API-Versionen < 21) gef√§hrlich.

{% hint style="info" %}
Beachten Sie, dass ein Autorisierungsumgehung nicht immer eine Schwachstelle ist; es h√§ngt davon ab, wie die Umgehung funktioniert und welche Informationen offengelegt werden.
{% endhint %}

**Sensibler Informationsleck**

**Aktivit√§ten k√∂nnen auch Ergebnisse zur√ºckgeben**. Wenn Sie es schaffen, eine exportierte und ungesch√ºtzte Aktivit√§t zu finden, die die **`setResult`**-Methode aufruft und **sensible Informationen zur√ºckgibt**, gibt es ein sensibles Informationsleck.

#### Tapjacking

Wenn Tapjacking nicht verhindert wird, k√∂nnten Sie die exportierte Aktivit√§t missbrauchen, um den **Benutzer unerwartete Aktionen** ausf√ºhren zu lassen. F√ºr weitere Informationen √ºber [**was Tapjacking ist, folgen Sie dem Link**](./#tapjacking).

### Ausnutzen von Content Providern - Zugriff auf und Manipulation von sensiblen Informationen

[**Lesen Sie dies, wenn Sie auffrischen m√∂chten, was ein Content Provider ist.**](android-applications-basics.md#content-provider)\
Content Provider werden im Grunde verwendet, um **Daten zu teilen**. Wenn eine App verf√ºgbare Content Provider hat, k√∂nnen Sie m√∂glicherweise **sensible** Daten von ihnen **extrahieren**. Es ist auch interessant, m√∂gliche **SQL-Injektionen** und **Path Traversals** zu testen, da sie anf√§llig sein k√∂nnten.

[**Erfahren Sie, wie Sie Content Provider mit Drozer ausnutzen.**](drozer-tutorial/#content-providers)

### **Ausnutzen von Services**

[**Lesen Sie dies, wenn Sie auffrischen m√∂chten, was ein Service ist.**](android-applications-basics.md#services)\
Denken Sie daran, dass die Aktionen eines Services in der Methode `onStartCommand` beginnen.

Ein Service ist im Grunde etwas, das **Daten empfangen**, **verarbeiten** und **eine Antwort** (oder nicht) **zur√ºckgeben** kann. Wenn eine Anwendung einige Services exportiert, sollten Sie den **Code** √ºberpr√ºfen, um zu verstehen, was er tut, und ihn **dynamisch** testen, um vertrauliche Informationen zu extrahieren, Authentifizierungsma√ünahmen zu umgehen...\
[**Erfahren Sie, wie Sie Services mit Drozer ausnutzen.**](drozer-tutorial/#services)

### **Ausnutzen von Broadcast Receivers**

[**Lesen Sie dies, wenn Sie auffrischen m√∂chten, was ein Broadcast Receiver ist.**](android-applications-basics.md#broadcast-receivers)\
Denken Sie daran, dass die Aktionen eines Broadcast Receivers in der Methode `onReceive` beginnen.

Ein Broadcast Receiver wartet auf eine Art von Nachricht. Je nachdem, wie der Receiver die Nachricht verarbeitet, k√∂nnte er anf√§llig sein.\
[**Erfahren Sie, wie Sie Broadcast Receivers mit Drozer ausnutzen.**](./#exploiting-broadcast-receivers)

### **Ausnutzen von Schemes / Deep Links**

Sie k√∂nnen manuell nach Deep Links suchen, indem Sie Tools wie MobSF oder Skripte wie [dieses](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py) verwenden.\
Sie k√∂nnen ein deklariertes **Scheme** mit **adb** oder einem **Browser** **√∂ffnen**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Beachten Sie, dass Sie **den Paketnamen weglassen** k√∂nnen und das Mobilger√§t automatisch die App aufruft, die diesen Link √∂ffnen sollte._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**Code ausgef√ºhrt**

Um den **Code zu finden, der in der App ausgef√ºhrt wird**, gehe zu der Aktivit√§t, die durch den Deeplink aufgerufen wird, und suche die Funktion **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Sensible Informationen**

Jedes Mal, wenn du einen Deep Link findest, √ºberpr√ºfe, dass **er keine sensiblen Daten (wie Passw√∂rter) √ºber URL-Parameter empf√§ngt**, da jede andere Anwendung **den Deep Link nachahmen und diese Daten stehlen k√∂nnte!**

**Parameter im Pfad**

Du **musst auch √ºberpr√ºfen, ob ein Deep Link einen Parameter im Pfad** der URL verwendet, wie: `https://api.example.com/v1/users/{username}`. In diesem Fall kannst du eine Pfadtraversierung erzwingen, indem du auf etwas wie: `example://app/users?username=../../unwanted-endpoint%3fparam=value` zugreifst.\
Beachte, dass du, wenn du die richtigen Endpunkte innerhalb der Anwendung findest, m√∂glicherweise eine **Open Redirect** (wenn ein Teil des Pfades als Domainname verwendet wird), **Account√ºbernahme** (wenn du die Benutzerdetails ohne CSRF-Token √§ndern kannst und der verwundbare Endpunkt die richtige Methode verwendet) und jede andere Verwundbarkeit verursachen kannst. Mehr [Info dazu hier](http://dphoeniixx.com/2020/12/13-2/).

**Weitere Beispiele**

Ein [interessanter Bug-Bounty-Bericht](https://hackerone.com/reports/855618) √ºber Links (_/.well-known/assetlinks.json_).

### Transport Layer Inspektion und Verifizierungsfehler

* **Zertifikate werden von Android-Anwendungen nicht immer ordnungsgem√§√ü √ºberpr√ºft**. Es ist √ºblich, dass diese Anwendungen Warnungen ignorieren und selbstsignierte Zertifikate akzeptieren oder in einigen F√§llen auf HTTP-Verbindungen zur√ºckgreifen.
* **Verhandlungen w√§hrend des SSL/TLS-Handshakes sind manchmal schwach**, da unsichere Cipher-Suiten verwendet werden. Diese Verwundbarkeit macht die Verbindung anf√§llig f√ºr Man-in-the-Middle (MITM)-Angriffe, die es Angreifern erm√∂glichen, die Daten zu entschl√ºsseln.
* **Leckage privater Informationen** ist ein Risiko, wenn Anwendungen √ºber sichere Kan√§le authentifizieren, dann jedoch √ºber unsichere Kan√§le f√ºr andere Transaktionen kommunizieren. Dieser Ansatz sch√ºtzt sensible Daten, wie Sitzungscookies oder Benutzerdetails, nicht vor der Abfangung durch b√∂swillige Akteure.

#### Zertifikatsverifizierung

Wir werden uns auf die **Zertifikatsverifizierung** konzentrieren. Die Integrit√§t des Serverzertifikats muss √ºberpr√ºft werden, um die Sicherheit zu erh√∂hen. Dies ist entscheidend, da unsichere TLS-Konfigurationen und die √úbertragung sensibler Daten √ºber unverschl√ºsselte Kan√§le erhebliche Risiken darstellen k√∂nnen. F√ºr detaillierte Schritte zur √úberpr√ºfung von Serverzertifikaten und zur Behebung von Verwundbarkeiten bietet [**dieses Ressourcen**](https://manifestsecurity.com/android-application-security-part-10/) umfassende Anleitungen.

#### SSL-Pinning

SSL-Pinning ist eine Sicherheitsma√ünahme, bei der die Anwendung das Serverzertifikat mit einer bekannten Kopie vergleicht, die innerhalb der Anwendung selbst gespeichert ist. Diese Methode ist entscheidend, um MITM-Angriffe zu verhindern. Die Implementierung von SSL-Pinning wird f√ºr Anwendungen, die mit sensiblen Informationen umgehen, dringend empfohlen.

#### Verkehrsinspektion

Um HTTP-Verkehr zu inspizieren, ist es notwendig, **das Zertifikat des Proxy-Tools zu installieren** (z. B. Burp). Ohne die Installation dieses Zertifikats ist der verschl√ºsselte Verkehr m√∂glicherweise nicht √ºber den Proxy sichtbar. F√ºr eine Anleitung zur Installation eines benutzerdefinierten CA-Zertifikats, [**klicke hier**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine).

Anwendungen, die **API Level 24 und h√∂her** anvisieren, erfordern √Ñnderungen an der Network Security Config, um das CA-Zertifikat des Proxys zu akzeptieren. Dieser Schritt ist entscheidend f√ºr die Inspektion von verschl√ºsseltem Verkehr. F√ºr Anweisungen zur √Ñnderung der Network Security Config, [**siehe dieses Tutorial**](make-apk-accept-ca-certificate.md).

#### Umgehung von SSL-Pinning

Wenn SSL-Pinning implementiert ist, wird es notwendig, es zu umgehen, um HTTPS-Verkehr zu inspizieren. Verschiedene Methoden stehen daf√ºr zur Verf√ºgung:

* Automatisch **modifizieren** des **apk**, um SSL-Pinning mit [**apk-mitm**](https://github.com/shroudedcode/apk-mitm) zu **umgehen**. Der gr√∂√üte Vorteil dieser Option ist, dass du kein Root ben√∂tigst, um das SSL-Pinning zu umgehen, aber du musst die Anwendung deinstallieren und die neue installieren, und das funktioniert nicht immer.
* Du k√∂nntest **Frida** (unten besprochen) verwenden, um diesen Schutz zu umgehen. Hier hast du eine Anleitung zur Verwendung von Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Du kannst auch versuchen, **SSL-Pinning automatisch zu umgehen** mit [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Du kannst auch versuchen, **SSL-Pinning automatisch zu umgehen** mit **MobSF dynamischer Analyse** (unten erkl√§rt).
* Wenn du immer noch denkst, dass es Verkehr gibt, den du nicht erfasst, kannst du versuchen, **den Verkehr mit iptables an Burp weiterzuleiten**. Lies diesen Blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### Suche nach h√§ufigen Webverwundbarkeiten

Es ist auch wichtig, nach h√§ufigen Webverwundbarkeiten innerhalb der Anwendung zu suchen. Detaillierte Informationen zur Identifizierung und Minderung dieser Verwundbarkeiten gehen √ºber den Rahmen dieser Zusammenfassung hinaus, werden jedoch an anderer Stelle umfassend behandelt.

### Frida

[Frida](https://www.frida.re) ist ein dynamisches Instrumentierungstoolkit f√ºr Entwickler, Reverse-Engineers und Sicherheitsforscher.\
**Du kannst laufende Anwendungen zugreifen und Methoden zur Laufzeit hooken, um das Verhalten zu √§ndern, Werte zu √§ndern, Werte zu extrahieren, anderen Code auszuf√ºhren...**\
Wenn du Android-Anwendungen pentesten m√∂chtest, musst du wissen, wie man Frida verwendet.

* Lerne, wie man Frida verwendet: [**Frida-Tutorial**](frida-tutorial/)
* Eine "GUI" f√ºr Aktionen mit Frida: [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection ist gro√üartig, um die Verwendung von Frida zu automatisieren: [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* Du kannst einige gro√üartige Frida-Skripte hier finden: [**https://codeshare.frida.re/**](https://codeshare.frida.re)
* Versuche, Anti-Debugging / Anti-Frida-Mechanismen zu umgehen, indem du Frida wie in [https://erfur.github.io/blog/dev/code-injection-without-ptrace](https://erfur.github.io/blog/dev/code-injection-without-ptrace) angegeben l√§dst (Tool [linjector](https://github.com/erfur/linjector-rs))

### **Speicher dumpen - Fridump**

√úberpr√ºfe, ob die Anwendung sensible Informationen im Speicher speichert, die sie nicht speichern sollte, wie Passw√∂rter oder mnemonische S√§tze.

Mit [**Fridump3**](https://github.com/rootbsd/fridump3) kannst du den Speicher der App dumpen mit:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Dies wird den Speicher im ./dump-Ordner ausgeben, und dort k√∂nnten Sie mit etwas wie grep suchen: 

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Sensible Daten im Keystore**

In Android ist der Keystore der beste Ort, um sensible Daten zu speichern, jedoch ist es mit ausreichenden Berechtigungen immer noch **m√∂glich, darauf zuzugreifen**. Da Anwendungen dazu neigen, hier **sensible Daten im Klartext** zu speichern, sollten die Pentests dies als Root-Benutzer oder jemand mit physischem Zugriff auf das Ger√§t √ºberpr√ºfen, da diese Person in der Lage sein k√∂nnte, diese Daten zu stehlen.

Selbst wenn eine App Daten im Keystore gespeichert hat, sollten die Daten verschl√ºsselt sein.

Um auf die Daten im Keystore zuzugreifen, k√∂nntest du dieses Frida-Skript verwenden: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Fingerprint/Biometrics Bypass**

Mit dem folgenden Frida-Skript k√∂nnte es m√∂glich sein, die **Fingerabdruckauthentifizierung** zu umgehen, die Android-Anwendungen m√∂glicherweise durchf√ºhren, um **bestimmte sensible Bereiche zu sch√ºtzen:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Hintergrundbilder**

Wenn Sie eine Anwendung in den Hintergrund setzen, speichert Android einen **Schnappschuss der Anwendung**, sodass beim Wiederherstellen in den Vordergrund das Bild geladen wird, bevor die App geladen wird, sodass es so aussieht, als w√§re die App schneller geladen worden.

Wenn dieser Schnappschuss jedoch **sensible Informationen** enth√§lt, k√∂nnte jemand mit Zugriff auf den Schnappschuss diese **Informationen stehlen** (beachten Sie, dass Sie Root-Rechte ben√∂tigen, um darauf zuzugreifen).

Die Schnappsch√ºsse werden normalerweise unter folgendem Pfad gespeichert: **`/data/system_ce/0/snapshots`**

Android bietet eine M√∂glichkeit, die **Screenshot-Erfassung zu verhindern, indem der FLAG\_SECURE** Layoutparameter gesetzt wird. Durch die Verwendung dieses Flags werden die Fensterinhalte als sicher behandelt, wodurch sie nicht in Screenshots erscheinen oder auf nicht sicheren Displays angezeigt werden k√∂nnen.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Android Application Analyzer**

Dieses Tool kann Ihnen helfen, verschiedene Tools w√§hrend der dynamischen Analyse zu verwalten: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Intent Injection

Entwickler erstellen h√§ufig Proxy-Komponenten wie Aktivit√§ten, Dienste und Broadcast-Receiver, die diese Intents verarbeiten und an Methoden wie `startActivity(...)` oder `sendBroadcast(...)` weitergeben, was riskant sein kann.

Die Gefahr liegt darin, Angreifern zu erm√∂glichen, nicht exportierte App-Komponenten auszul√∂sen oder auf sensible Content-Provider zuzugreifen, indem sie diese Intents fehlleiten. Ein bemerkenswertes Beispiel ist die `WebView`-Komponente, die URLs in `Intent`-Objekte √ºber `Intent.parseUri(...)` umwandelt und sie dann ausf√ºhrt, was potenziell zu b√∂sartigen Intent-Injektionen f√ºhren kann.

### Wesentliche Erkenntnisse

* **Intent Injection** ist √§hnlich wie das Open Redirect-Problem im Web.
* Exploits beinhalten das √úbergeben von `Intent`-Objekten als Extras, die umgeleitet werden k√∂nnen, um unsichere Operationen auszuf√ºhren.
* Es kann nicht exportierte Komponenten und Content-Provider Angreifern aussetzen.
* Die URL-zu-`Intent`-Umwandlung von `WebView` kann unbeabsichtigte Aktionen erleichtern.

### Android Client Side Injections und andere

Wahrscheinlich kennen Sie diese Art von Schwachstellen aus dem Web. Sie m√ºssen bei diesen Schwachstellen in einer Android-Anwendung besonders vorsichtig sein:

* **SQL Injection:** Stellen Sie beim Umgang mit dynamischen Abfragen oder Content-Providern sicher, dass Sie parametrisierte Abfragen verwenden.
* **JavaScript Injection (XSS):** √úberpr√ºfen Sie, ob JavaScript- und Plugin-Unterst√ºtzung f√ºr alle WebViews deaktiviert ist (standardm√§√üig deaktiviert). [Mehr Informationen hier](webview-attacks.md#javascript-enabled).
* **Local File Inclusion:** WebViews sollten keinen Zugriff auf das Dateisystem haben (standardm√§√üig aktiviert) - `(webview.getSettings().setAllowFileAccess(false);)`. [Mehr Informationen hier](webview-attacks.md#javascript-enabled).
* **Eternal cookies**: In mehreren F√§llen, wenn die Android-Anwendung die Sitzung beendet, wird das Cookie nicht widerrufen oder k√∂nnte sogar auf der Festplatte gespeichert werden.
* [**Secure Flag** in cookies](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Insights**\
Engagieren Sie sich mit Inhalten, die in die Aufregung und Herausforderungen des Hackens eintauchen.

**Echtzeit-Hack-Nachrichten**\
Bleiben Sie auf dem Laufenden √ºber die schnelllebige Hackerwelt durch Echtzeitnachrichten und Einblicke.

**Neueste Ank√ºndigungen**\
Bleiben Sie informiert √ºber die neuesten Bug-Bounties und wichtige Plattform-Updates.

**Treten Sie uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) und beginnen Sie noch heute mit den besten Hackern zusammenzuarbeiten!

## Automatische Analyse

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**Statische Analyse**

![](<../../.gitbook/assets/image (866).png>)

**Schwachstellenbewertung der Anwendung** mithilfe eines sch√∂nen webbasierten Frontends. Sie k√∂nnen auch eine dynamische Analyse durchf√ºhren (aber Sie m√ºssen die Umgebung vorbereiten).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Notice that MobSF can analyse **Android**(apk)**, IOS**(ipa) **and Windows**(apx) applications (_Windows-Anwendungen m√ºssen von einem in einem Windows-Host installierten MobSF analysiert werden_).\
Also, if you create a **ZIP** file with the source code if an **Android** or an **IOS** app (go to the root folder of the application, select everything and create a ZIPfile), it will be able to analyse it also.

MobSF also allows you to **diff/Compare** analysis and to integrate **VirusTotal** (you will need to set your API key in _MobSF/settings.py_ and enable it: `VT_ENABLED = TRUE` `VT_API_KEY = <Your API key>` `VT_UPLOAD = TRUE`). You can also set `VT_UPLOAD` to `False`, then the **hash** will be **upload** instead of the file.

### Assisted Dynamic analysis with MobSF

**MobSF** can also be very helpful for **dynamic analysis** in **Android**, but in that case you will need to install MobSF and **genymotion** in your host (a VM or Docker won't work). _Hinweis: Sie m√ºssen **zuerst eine VM in Genymotion starten** und **dann MobSF.**_\
The **MobSF dynamic analyser** can:

* **Dump application data** (URLs, Logs, Zwischenablage, Screenshots, die von Ihnen gemacht wurden, Screenshots, die von "**Exported Activity Tester**" gemacht wurden, E-Mails, SQLite-Datenbanken, XML-Dateien und andere erstellte Dateien). All of this is done automatically except for the screenshots, you need to press when you want a screenshot or you need to press "**Exported Activity Tester**" to obtain screenshots of all the exported activities.
* Capture **HTTPS traffic**
* Use **Frida** to obtain **runtime** **information**

From android **versions > 5**, it will **automatically start Frida** and will set global **proxy** settings to **capture** traffic. It will only capture traffic from the tested application.

**Frida**

By default, it will also use some Frida Scripts to **bypass SSL pinning**, **root detection** and **debugger detection** and to **monitor interesting APIs**.\
MobSF can also **invoke exported activities**, grab **screenshots** of them and **save** them for the report.

To **start** the dynamic testing press the green bottom: "**Start Instrumentation**". Press the "**Frida Live Logs**" to see the logs generated by the Frida scripts and "**Live API Monitor**" to see all the invocation to hooked methods, arguments passed and returned values (this will appear after pressing "Start Instrumentation").\
MobSF also allows you to load your own **Frida scripts** (to send the results of your Friday scripts to MobSF use the function `send()`). It also has **several pre-written scripts** you can load (you can add more in `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), just **select them**, press "**Load**" and press "**Start Instrumentation**" (you will be able to see the logs of that scripts inside "**Frida Live Logs**").

![](<../../.gitbook/assets/image (419).png>)

Moreover, you have some Auxiliary Frida functionalities:

* **Enumerate Loaded Classes**: It will print all the loaded classes
* **Capture Strings**: It will print all the capture strings while using the application (super noisy)
* **Capture String Comparisons**: Could be very useful. It will **show the 2 strings being compared** and if the result was True or False.
* **Enumerate Class Methods**: Put the class name (like "java.io.File") and it will print all the methods of the class.
* **Search Class Pattern**: Search classes by pattern
* **Trace Class Methods**: **Trace** a **whole class** (see inputs and outputs of all methods of th class). Remember that by default MobSF traces several interesting Android Api methods.

Once you have selected the auxiliary module you want to use you need to press "**Start Intrumentation**" and you will see all the outputs in "**Frida Live Logs**".

**Shell**

Mobsf also brings you a shell with some **adb** commands, **MobSF commands**, and common **shell** **commands** at the bottom of the dynamic analysis page. Some interesting commands:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**HTTP-Tools**

Wenn der HTTP-Verkehr erfasst wird, k√∂nnen Sie eine unsch√∂ne Ansicht des erfassten Verkehrs auf dem "**HTTP(S) Traffic**" unteren Bereich oder eine sch√∂nere Ansicht im "**Start HTTPTools**" gr√ºnen Bereich sehen. Von der zweiten Option aus k√∂nnen Sie die **erfassten Anfragen** an **Proxys** wie Burp oder Owasp ZAP **senden**.\
Um dies zu tun, _Burp einschalten -->_ _Intercept ausschalten --> in MobSB HTTPTools die Anfrage ausw√§hlen_ --> dr√ºcken Sie auf "**Send to Fuzzer**" --> _Proxy-Adresse ausw√§hlen_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Sobald Sie die dynamische Analyse mit MobSF abgeschlossen haben, k√∂nnen Sie auf "**Start Web API Fuzzer**" dr√ºcken, um **HTTP-Anfragen zu fuzzern** und nach Schwachstellen zu suchen.

{% hint style="info" %}
Nach der Durchf√ºhrung einer dynamischen Analyse mit MobSF k√∂nnen die Proxy-Einstellungen falsch konfiguriert sein, und Sie k√∂nnen sie nicht √ºber die GUI beheben. Sie k√∂nnen die Proxy-Einstellungen folgenderma√üen korrigieren:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Unterst√ºtzte dynamische Analyse mit Inspeckage

Sie k√∂nnen das Tool von [**Inspeckage**](https://github.com/ac-pm/Inspeckage) herunterladen.\
Dieses Tool verwendet einige **Hooks**, um Ihnen mitzuteilen, **was in der Anwendung passiert**, w√§hrend Sie eine **dynamische Analyse** durchf√ºhren.

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Dies ist ein **gro√üartiges Tool zur Durchf√ºhrung statischer Analysen mit einer GUI**

![](<../../.gitbook/assets/image (741).png>)

### [Qark](https://github.com/linkedin/qark)

Dieses Tool wurde entwickelt, um nach mehreren **sicherheitsrelevanten Android-Anwendungsschwachstellen** zu suchen, entweder im **Quellcode** oder in **verpackten APKs**. Das Tool ist auch **in der Lage, ein "Proof-of-Concept" deploybares APK** und **ADB-Befehle** zu erstellen, um einige der gefundenen Schwachstellen auszunutzen (Exponierte Aktivit√§ten, Intents, Tapjacking...). Wie bei Drozer ist es nicht erforderlich, das Testger√§t zu rooten.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Zeigt alle extrahierten Dateien zur einfachen Referenz an
* Dekompiliert APK-Dateien automatisch in Java- und Smali-Format
* Analysiert AndroidManifest.xml auf h√§ufige Sicherheitsanf√§lligkeiten und Verhalten
* Statische Quellcodeanalyse auf h√§ufige Sicherheitsanf√§lligkeiten und Verhalten
* Ger√§teinformationen
* und mehr
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER ist eine Befehlszeilenanwendung, die unter Windows, MacOS X und Linux verwendet werden kann und _.apk_ Dateien auf Schwachstellen analysiert. Dies geschieht durch das Dekomprimieren von APKs und das Anwenden einer Reihe von Regeln, um diese Schwachstellen zu erkennen.

Alle Regeln sind in einer `rules.json` Datei zentriert, und jedes Unternehmen oder Tester kann seine eigenen Regeln erstellen, um das zu analysieren, was sie ben√∂tigen.

Laden Sie die neuesten Bin√§rdateien von der [Download-Seite](https://superanalyzer.rocks/download.html) herunter.
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (297).png>)

StaCoAn ist ein **plattform√ºbergreifendes** Tool, das Entwicklern, Bug-Bounty-J√§gern und ethischen Hackern hilft, [statische Codeanalyse](https://en.wikipedia.org/wiki/Static\_program\_analysis) von mobilen Anwendungen durchzuf√ºhren.

Das Konzept besteht darin, dass Sie Ihre mobile Anwendungsdatei (eine .apk- oder .ipa-Datei) auf die StaCoAn-Anwendung ziehen und ablegen, und sie wird einen visuellen und tragbaren Bericht f√ºr Sie erstellen. Sie k√∂nnen die Einstellungen und Wortlisten anpassen, um ein individuelles Erlebnis zu erhalten.

Laden Sie [die neueste Version](https://github.com/vincentcox/StaCoAn/releases) herunter:
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework ist ein Android-Sicherheitsanalyse-System, das Entwicklern oder Hackern hilft, potenzielle Sicherheitsanf√§lligkeiten in Android-Anwendungen zu finden.\
[Windows-Versionen](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** ist ein Tool, dessen Hauptziel es ist, den Benutzer √ºber potenziell b√∂sartiges Verhalten, das von einer Android-Anwendung entwickelt wurde, zu erkennen und zu warnen.

Die Erkennung erfolgt durch die **statische Analyse** des Dalvik-Bytecodes der Anwendung, dargestellt als **Smali**, mit der [`androguard`](https://github.com/androguard/androguard) Bibliothek.

Dieses Tool sucht nach **h√§ufigem Verhalten von "schlechten" Anwendungen** wie: Exfiltration von Telefondaten, Abfangen von Audio-/Video-Streams, Modifikation von PIM-Daten, Ausf√ºhrung beliebigen Codes...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA\_Framework)

![](<../../.gitbook/assets/image (595).png>)

**MARA** ist ein **M**obile **A**pplication **R**everse Engineering und **A**nalysis Framework. Es ist ein Tool, das h√§ufig verwendete Tools zur Reverse-Engineering und Analyse von mobilen Anwendungen zusammenf√ºhrt, um bei der Pr√ºfung mobiler Anwendungen gegen die OWASP-Sicherheitsbedrohungen zu helfen. Ziel ist es, diese Aufgabe f√ºr Entwickler mobiler Anwendungen und Sicherheitsfachleute einfacher und benutzerfreundlicher zu gestalten.

Es kann:

* Java- und Smali-Code mit verschiedenen Tools extrahieren
* APKs analysieren mit: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs\_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Private Informationen aus der APK mit regexps extrahieren.
* Das Manifest analysieren.
* Gefundene Domains analysieren mit: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) und [whatweb](https://github.com/urbanadventurer/WhatWeb)
* APK √ºber [apk-deguard.com](http://www.apk-deguard.com) deobfuskieren

### Koodous

N√ºtzlich zur Erkennung von Malware: [https://koodous.com/](https://koodous.com)

## Obfuscating/Deobfuscating code

Beachten Sie, dass je nach Dienst und Konfiguration, die Sie zur Obfuskation des Codes verwenden, Geheimnisse m√∂glicherweise obfuskiert oder nicht obfuskiert enden.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

Von [Wikipedia](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** ist ein Open-Source-Befehlszeilentool, das Java-Code verkleinert, optimiert und obfuskiert. Es kann Bytecode optimieren sowie ungenutzte Anweisungen erkennen und entfernen. ProGuard ist freie Software und wird unter der GNU General Public License, Version 2, vertrieben.

ProGuard wird als Teil des Android SDK verteilt und l√§uft beim Erstellen der Anwendung im Release-Modus.

### [DexGuard](https://www.guardsquare.com/dexguard)

Finden Sie eine Schritt-f√ºr-Schritt-Anleitung zur Deobfuskation der APK unter [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Von dieser Anleitung) Das letzte Mal, als wir √ºberpr√ºft haben, war der Dexguard-Betriebsmodus:

* eine Ressource als InputStream laden;
* das Ergebnis an eine Klasse weitergeben, die von FilterInputStream erbt, um es zu entschl√ºsseln;
* einige nutzlose Obfuskation durchf√ºhren, um dem Reverser ein paar Minuten Zeit zu stehlen;
* das entschl√ºsselte Ergebnis an einen ZipInputStream weitergeben, um eine DEX-Datei zu erhalten;
* schlie√ülich die resultierende DEX als Ressource mit der Methode `loadDex` laden.

### [DeGuard](http://apk-deguard.com)

**DeGuard kehrt den Obfuskationsprozess um, der von Android-Obfuskationstools durchgef√ºhrt wird. Dies erm√∂glicht zahlreiche Sicherheitsanalysen, einschlie√ülich Codeinspektion und Vorhersage von Bibliotheken.**

Sie k√∂nnen eine obfuskierte APK auf ihre Plattform hochladen.

### [Simplify](https://github.com/CalebFenton/simplify)

Es ist ein **generischer Android-Deobfuskator.** Simplify **f√ºhrt eine App virtuell aus**, um ihr Verhalten zu verstehen, und **versucht dann, den Code zu optimieren**, sodass er identisch funktioniert, aber f√ºr einen Menschen leichter zu verstehen ist. Jeder Optimierungstyp ist einfach und generisch, sodass es keine Rolle spielt, welcher spezifische Obfuskationstyp verwendet wird.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD gibt Ihnen Informationen dar√ºber, **wie eine APK erstellt wurde**. Es identifiziert viele **Compiler**, **Packer**, **Obfuskatoren** und andere seltsame Dinge. Es ist [_PEiD_](https://www.aldeid.com/wiki/PEiD) f√ºr Android.

### Manual

[Lesen Sie dieses Tutorial, um einige Tricks zu lernen, **wie man benutzerdefinierte Obfuskation umkehrt**](manual-deobfuscation.md)

## Labs

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b ist eine Android-Sicherheitsvirtualmaschine, die auf ubuntu-mate basiert und die Sammlung der neuesten Frameworks, Tutorials und Labs von verschiedenen Sicherheitsgeeks und Forschern f√ºr Reverse Engineering und Malware-Analyse umfasst.

## References

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) Es ist eine gro√üartige Liste von Ressourcen
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Android Schnellkurs
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Yet to try

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Insights**\
Engagieren Sie sich mit Inhalten, die in die Aufregung und Herausforderungen des Hackens eintauchen

**Echtzeit-Hack-Nachrichten**\
Bleiben Sie auf dem Laufenden √ºber die schnelllebige Hackerwelt durch Echtzeitnachrichten und Einblicke

**Neueste Ank√ºndigungen**\
Bleiben Sie informiert √ºber die neuesten Bug-Bounties und wichtige Plattform-Updates

**Treten Sie uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) und beginnen Sie noch heute mit der Zusammenarbeit mit Top-Hackern!

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
