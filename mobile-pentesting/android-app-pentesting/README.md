# Testiranje bezbednosti Android aplikacija

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Uvidi u hakovanje**\
UkljuÄite se u sadrÅ¾aj koji istraÅ¾uje uzbuÄ‘enje i izazove hakovanja

**Vesti o hakovanju u realnom vremenu**\
Budite u toku sa brzim svetom hakovanja kroz vesti i uvide u realnom vremenu

**Najnovije najave**\
Budite informisani o najnovijim nagradama za pronalaÅ¾enje bagova i vaÅ¾nim aÅ¾uriranjima platformi

**PridruÅ¾ite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poÄnite da saraÄ‘ujete sa vrhunskim hakerima danas!

## Osnove Android aplikacija

Visoko se preporuÄuje da poÄnete Äitati ovu stranicu kako biste saznali o **najvaÅ¾nijim delovima vezanim za bezbednost Androida i najopasnijim komponentama u Android aplikaciji**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Ovo je glavni alat koji vam je potreban da se poveÅ¾ete sa Android ureÄ‘ajem (emuliranim ili fiziÄkim).\
**ADB** omoguÄ‡ava kontrolu ureÄ‘aja preko **USB-a** ili **MreÅ¾e** sa raÄunara. Ova alatka omoguÄ‡ava **kopiranje** fajlova u oba smera, **instalaciju** i **deinstalaciju** aplikacija, **izvrÅ¡avanje** shell komandi, **bekapovanje** podataka, **Äitanje** logova, meÄ‘u ostalim funkcijama.

Pogledajte sledeÄ‡u listu [**ADB komandi**](adb-commands.md) da biste nauÄili kako koristiti adb.

## Smali

Ponekad je interesantno **modifikovati kod aplikacije** kako biste pristupili **skrivenim informacijama** (moÅ¾da dobro obfuskovanim lozinkama ili zastavama). Zatim, moÅ¾e biti korisno dekompilirati apk, modifikovati kod i rekompilirati ga.\
[**U ovom tutorijalu** moÅ¾ete **nauÄiti kako da dekompilirate APK, modifikujete Smali kod i rekompilirate APK** sa novom funkcionalnoÅ¡Ä‡u](smali-changes.md). Ovo moÅ¾e biti veoma korisno kao **alternativa za nekoliko testova tokom dinamiÄke analize** koji Ä‡e biti predstavljeni. Zatim, **uvek imajte na umu ovu moguÄ‡nost**.

## Druge interesantne trikove

* [LaÅ¾iranje lokacije u Play prodavnici](spoofing-your-location-in-play-store.md)
* **Preuzimanje APK-ova**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Izdvajanje APK sa ureÄ‘aja:
```bash
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
## StatistiÄka analiza

Prvo, za analizu APK datoteke trebalo bi **pogledati Java kod** koristeÄ‡i dekompajler.\
Molimo, [**proÄitajte ovde da biste pronaÅ¡li informacije o razliÄitim dostupnim dekompajlerima**](apk-decompilers.md).

### TraÅ¾enje zanimljivih informacija

Samo pogledom na **stringove** APK datoteke moÅ¾ete traÅ¾iti **Å¡ifre**, **URL-ove** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **API** kljuÄeve, **enkripciju**, **bluetooth UUID-ove**, **tokene** i bilo Å¡ta zanimljivo... traÅ¾ite Äak i **backdoor** za izvrÅ¡avanje koda ili backdoor za autentifikaciju (hardkodirane administratorske akreditacije za aplikaciju).

**Firebase**

Posvetite posebnu paÅ¾nju **Firebase URL-ovima** i proverite da li je loÅ¡e konfigurisan. [ViÅ¡e informacija o tome Å¡ta je Firebase i kako ga iskoristiti ovde.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Osnovno razumevanje aplikacije - Manifest.xml, strings.xml

**Pregled aplikacije **_**Manifest.xml**_** i **_**strings.xml**_** fajlova moÅ¾e otkriti potencijalne sigurnosne ranjivosti**. Ovim fajlovima se moÅ¾e pristupiti koriÅ¡Ä‡enjem dekompajlera ili preimenovanjem ekstenzije APK fajla u .zip, a zatim raspakivanjem.

**Ranjivosti** identifikovane iz **Manifest.xml** ukljuÄuju:

* **Aplikacije u Debug reÅ¾imu**: Aplikacije postavljene kao debuggable (`debuggable="true"`) u _Manifest.xml_ fajlu predstavljaju rizik jer omoguÄ‡avaju veze koje mogu dovesti do eksploatacije. Za dalje razumevanje kako eksploatisati aplikacije u Debug reÅ¾imu, pogledajte tutorijal o pronalaÅ¾enju i eksploataciji aplikacija u Debug reÅ¾imu na ureÄ‘aju.
* **PodeÅ¡avanja za Bekapovanje**: Atribut `android:allowBackup="false"` treba eksplicitno postaviti za aplikacije koje se bave osetljivim informacijama kako bi se spreÄilo neovlaÅ¡Ä‡eno bekapovanje podataka putem adb, posebno kada je omoguÄ‡eno USB debugovanje.
* **MreÅ¾na sigurnost**: PrilagoÄ‘ena podeÅ¡avanja mreÅ¾ne sigurnosti (`android:networkSecurityConfig="@xml/network_security_config"`) u _res/xml/_ mogu specificirati detalje sigurnosti poput sertifikata i podeÅ¡avanja HTTP saobraÄ‡aja. Primer je dozvola HTTP saobraÄ‡aja za odreÄ‘ene domene.
* **IzloÅ¾ene Aktivnosti i Servisi**: Identifikacija izloÅ¾enih aktivnosti i servisa u manifestu moÅ¾e ukazati na komponente koje mogu biti zloupotrebljene. Dalja analiza tokom dinamiÄkog testiranja moÅ¾e otkriti kako eksploatisati ove komponente.
* **Provajderi sadrÅ¾aja i FileProvideri**: IzloÅ¾eni provajderi sadrÅ¾aja mogu dozvoliti neovlaÅ¡Ä‡en pristup ili modifikaciju podataka. Konfiguracija FileProvidera takoÄ‘e treba biti paÅ¾ljivo pregledana.
* **Broadcast prijemnici i URL Å¡eme**: Ove komponente mogu biti iskoriÅ¡Ä‡ene za eksploataciju, sa posebnom paÅ¾njom na to kako se upravljaju URL Å¡eme radi ranjivosti unosa.
* **SDK verzije**: Atributi `minSdkVersion`, `targetSDKVersion` i `maxSdkVersion` ukazuju na podrÅ¾ane verzije Androida, istiÄuÄ‡i vaÅ¾nost ne podrÅ¾avanja zastarelih, ranjivih verzija Androida iz sigurnosnih razloga.

Iz **strings.xml** fajla, osetljive informacije poput API kljuÄeva, prilagoÄ‘enih Å¡ema i drugih beleÅ¡ki razvojnog tima mogu biti otkrivene, naglaÅ¡avajuÄ‡i potrebu za paÅ¾ljivim pregledom ovih resursa.

### Tapjacking

**Tapjacking** je napad gde se **zlonamerna aplikacija** pokreÄ‡e i **pozicionira iznad aplikacije Å¾rtve**. Kada vidljivo prekrije aplikaciju Å¾rtve, njen korisniÄki interfejs je dizajniran na naÄin da prevari korisnika da interaguje sa njom, dok zapravo prenosi interakciju aplikaciji Å¾rtve.\
Na taj naÄin, **korisnik nije svestan da zapravo obavlja radnje na aplikaciji Å¾rtve**.

PronaÄ‘ite viÅ¡e informacija u:

{% content-ref url="tapjacking.md" %}
[tapjacking.md](tapjacking.md)
{% endcontent-ref %}

### Preuzimanje zadatka

**Aktivnost** sa postavljenim **`launchMode`** na **`singleTask` bez definisane `taskAffinity`** je ranjiva na preuzimanje zadatka. To znaÄi da se **aplikacija** moÅ¾e instalirati i ako se pokrene pre prave aplikacije, moÅ¾e **preuzeti zadatak prave aplikacije** (tako da Ä‡e korisnik interagovati sa **zlonamernom aplikacijom misleÄ‡i da koristi pravu**).

ViÅ¡e informacija na:

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Nesigurno skladiÅ¡tenje podataka

**Interni skladiÅ¡tenje**

U Androidu, fajlovi **skladiÅ¡teni** u **internom** skladiÅ¡tu su **dizajnirani** da budu **pristupaÄni** iskljuÄivo od strane **aplikacije koja ih je** **kreirala**. Ova sigurnosna mera je **sprovedena** od strane Android operativnog sistema i generalno je dovoljna za sigurnosne potrebe veÄ‡ine aplikacija. MeÄ‘utim, developeri ponekad koriste reÅ¾ime poput `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE` da bi **omoguÄ‡ili** fajlove da se **dijele** izmeÄ‘u razliÄitih aplikacija. Ipak, ovi reÅ¾imi **ne ograniÄavaju pristup** ovim fajlovima od strane drugih aplikacija, ukljuÄujuÄ‡i potencijalno zlonamerne.

1. **StatistiÄka analiza:**
* **Proverite** da li se upotreba `MODE_WORLD_READABLE` i `MODE_WORLD_WRITABLE` **paÅ¾ljivo razmatra**. Ovi reÅ¾imi **mogu potencijalno izloÅ¾iti** fajlove **neÅ¾eljenom ili neovlaÅ¡Ä‡enom pristupu**.
2. **DinamiÄka analiza:**
* **Proverite** dozvole postavljene na fajlove koje je kreirala aplikacija. Konkretno, **proverite** da li su neki fajlovi **postavljeni da budu Äitljivi ili upisivi globalno**. Ovo moÅ¾e predstavljati znaÄajan sigurnosni rizik, jer bi dozvolilo **bilo kojoj aplikaciji** instaliranoj na ureÄ‘aju, bez obzira na poreklo ili nameru, da **Äita ili modifikuje** ove fajlove.

**Spoljno skladiÅ¡tenje**

Kada se radi sa fajlovima na **spoljnom skladiÅ¡tu**, poput SD kartica, treba preduzeti odreÄ‘ene mere opreza:

1. **PristupaÄnost**:
* Fajlovi na spoljnom skladiÅ¡tu su **globalno Äitljivi i upisivi**. To znaÄi da bilo koja aplikacija ili korisnik moÅ¾e pristupiti ovim fajlovima.
2. **Sigurnosne zabrinutosti**:
* S obzirom na laku dostupnost, savetuje se **ne skladiÅ¡titi osetljive informacije** na spoljnom skladiÅ¡tu.
* Spoljno skladiÅ¡te moÅ¾e biti uklonjeno ili pristupljeno od strane bilo koje aplikacije, ÄineÄ‡i ga manje sigurnim.
3. **Obrada podataka sa spoljnog skladiÅ¡ta**:
* Uvek **vrÅ¡ite validaciju unosa** podataka dobijenih sa spoljnog skladiÅ¡ta. Ovo je kljuÄno jer podaci potiÄu od nepoverljivog izvora.
* SkladiÅ¡tenje izvrÅ¡nih ili klasnih fajlova na spoljnom skladiÅ¡tu radi dinamiÄkog uÄitavanja se snaÅ¾no ne preporuÄuje.
* Ako vaÅ¡a aplikacija mora da preuzme izvrÅ¡ne fajlove sa spoljnog skladiÅ¡ta, obezbedite da su ovi fajlovi **potpisani i kriptografski verifikovani** pre nego Å¡to budu dinamiÄki uÄitani. Ovaj korak je od vitalnog znaÄaja za odrÅ¾avanje sigurnosne celovitosti vaÅ¡e aplikacije.

Spoljno skladiÅ¡te se moÅ¾e **pristupiti** u `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
PoÄevÅ¡i od Android 4.4 (**API 17**), SD kartica ima strukturu direktorijuma koja **ograniÄava pristup aplikacije direktorijumu koji je specifiÄan samo za tu aplikaciju**. Ovo spreÄava zlonamerne aplikacije da dobiju pristup Äitanju ili pisanju drugih fajlova aplikacije.
{% endhint %}

**Osetljivi podaci skladiÅ¡teni u Äistom tekstu**

* **Deljeni podaci**: Android omoguÄ‡ava svakoj aplikaciji da lako saÄuva XML fajlove na putanji `/data/data/<imepaketa>/shared_prefs/` i ponekad je moguÄ‡e pronaÄ‡i osetljive informacije u Äistom tekstu u tom folderu.
* **Baze podataka**: Android omoguÄ‡ava svakoj aplikaciji da lako saÄuva SQLite baze podataka na putanji `/data/data/<imepaketa>/databases/` i ponekad je moguÄ‡e pronaÄ‡i osetljive informacije u Äistom tekstu u tom folderu.

### Slomljen TLS

**Prihvatanje svih sertifikata**

Iz nekog razloga, ponekad developeri prihvataju sve sertifikate Äak i ako na primer ime hosta ne odgovara sa linijama koda kao Å¡to je sledeÄ‡a:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
### Slom kriptografije

**LoÅ¡i procesi upravljanja kljuÄevima**

Neki programeri Äuvaju osetljive podatke u lokalnom skladiÅ¡tu i Å¡ifriraju ih kljuÄem koji je unapred definisan/predvidljiv u kodu. Ovo ne bi trebalo raditi jer neko ko vrÅ¡i reverzni inÅ¾enjering moÅ¾e izvuÄ‡i poverljive informacije.

**KoriÅ¡Ä‡enje nesigurnih i/ili zastarelih algoritama**

Programeri ne bi trebalo da koriste **zastarele algoritme** za izvoÄ‘enje **provere autorizacije**, **Äuvanje** ili **slanje** podataka. Neki od ovih algoritama su: RC4, MD4, MD5, SHA1... Ako se koriste **heÅ¡evi** za Äuvanje lozinki na primer, trebalo bi koristiti heÅ¡eve otporne na **bruteforce napade** sa solju.

### Ostale provere

* PreporuÄuje se **obfuskacija APK datoteke** kako bi se oteÅ¾ao rad osobama koje vrÅ¡e reverzni inÅ¾enjering.
* Ako je aplikacija osetljiva (kao Å¡to su bankarske aplikacije), trebalo bi da vrÅ¡i **svoje provere da vidi da li je mobilni ureÄ‘aj rutovan** i da postupi u skladu sa tim.
* Ako je aplikacija osetljiva (kao Å¡to su bankarske aplikacije), trebalo bi proveriti da li se koristi **emulator**.
* Ako je aplikacija osetljiva (kao Å¡to su bankarske aplikacije), trebalo bi **proveriti svoju celovitost pre izvrÅ¡avanja** kako bi se proverilo da li je bila izmenjena.
* Koristite [**APKiD**](https://github.com/rednaga/APKiD) da proverite koji je kompajler/paker/obfuskator koriÅ¡Ä‡en za izgradnju APK datoteke.

### Aplikacija napravljena u React Native-u

ProÄitajte sledeÄ‡u stranicu da biste saznali kako lako pristupiti JavaScript kodu React aplikacija:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplikacije napravljene u Xamarin-u

ProÄitajte sledeÄ‡u stranicu da biste saznali kako lako pristupiti C# kodu Xamarin aplikacija:

{% content-ref url="../xamarin-apps.md" %}
[xamarin-apps.md](../xamarin-apps.md)
{% endcontent-ref %}

### Aplikacije sa superpakovanjem

Prema ovom [**blog postu**](https://clearbluejar.github.io/posts/desuperpacking-meta-superpacked-apks-with-github-actions/) superpakovanje je Meta algoritam koji komprimuje sadrÅ¾aj aplikacije u jednu datoteku. Blog govori o moguÄ‡nosti kreiranja aplikacije koja dekompresuje ovakve vrste aplikacija... i brÅ¾em naÄinu koji ukljuÄuje **izvrÅ¡avanje aplikacije i prikupljanje dekompresovanih datoteka iz fajl sistema.**

### Automatizovana statiÄka analiza koda

Alatka [**mariana-trench**](https://github.com/facebook/mariana-trench) je sposobna da pronaÄ‘e **ranjivosti** skeniranjem **koda** aplikacije. Ovaj alat sadrÅ¾i niz **poznatih izvora** (koji pokazuju alatki **mesta** gde je **unos kontrolisan od strane korisnika**), **sinks** (koji pokazuju alatki **opasna mesta** gde zlonamerni korisniÄki unos moÅ¾e prouzrokovati Å¡tetu) i **pravila**. Ova pravila pokazuju **kombinaciju** **izvora-sinks** koji ukazuju na ranjivost.

Sa ovim znanjem, **mariana-trench Ä‡e pregledati kod i pronaÄ‡i moguÄ‡e ranjivosti u njemu**.

### Procureli tajni podaci

Aplikacija moÅ¾e sadrÅ¾ati tajne podatke (API kljuÄeve, lozinke, skrivene URL-ove, poddomene...) unutar sebe koje moÅ¾ete otkriti. MoÅ¾ete koristiti alatku poput [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### ZaobilaÅ¾enje biometrijske autentifikacije

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Druge interesantne funkcije

* **IzvrÅ¡avanje koda**: `Runtime.exec(), ProcessBuilder(), native code:system()`
* **Slanje SMS poruka**: `sendTextMessage, sendMultipartTestMessage`
* **Nativne funkcije** deklarisane kao `native`: `public native, System.loadLibrary, System.load`
* [ProÄitajte ovo da biste saznali **kako da reverzujete nativne funkcije**](reversing-native-libraries.md)

### **Druge trikove**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Uvidi u hakovanje**\
UkljuÄite se u sadrÅ¾aj koji istraÅ¾uje uzbuÄ‘enje i izazove hakovanja

**Vesti o hakovanju u realnom vremenu**\
Budite u toku sa brzim svetom hakovanja kroz vesti i uvide u realnom vremenu

**Najnovije najave**\
Budite informisani o najnovijim programima nagraÄ‘ivanja za pronalaÅ¾enje bagova i vaÅ¾nim aÅ¾uriranjima platforme

**PridruÅ¾ite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poÄnite da saraÄ‘ujete sa vrhunskim hakerima danas!

***

## DinamiÄka analiza

> Prvo, potrebno je okruÅ¾enje gde moÅ¾ete instalirati aplikaciju i sve potrebne alatke (Burp CA sertifikat, Drozer i Frida pre svega). Stoga, preporuÄuje se korenovan ureÄ‘aj (emuliran ili ne).

### Online dinamiÄka analiza

MoÅ¾ete kreirati **besplatan nalog** na: [https://appetize.io/](https://appetize.io). Ova platforma vam omoguÄ‡ava da **uÄitate** i **izvrÅ¡ite** APK datoteke, pa je korisno videti kako se APK ponaÅ¡a.

ÄŒak moÅ¾ete **videti dnevnike vaÅ¡e aplikacije** na vebu i povezati se putem **adb**.

![](<../../.gitbook/assets/image (60).png>)

ZahvaljujuÄ‡i ADB vezi, moÅ¾ete koristiti **Drozer** i **Frida** unutar emulatora.

### Lokalna dinamiÄka analiza

#### KoriÅ¡Ä‡enje emulatora

* [**Android Studio**](https://developer.android.com/studio) (MoÅ¾ete kreirati **x86** i **arm** ureÄ‘aje, a prema [**ovom** ](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html)**najnovijem x86** verzije **podrÅ¾avaju ARM biblioteke** bez potrebe za sporim arm emulatorom).
* NauÄite kako da ga podesite na ovoj stranici:

{% content-ref url="avd-android-virtual-device.md" %}
[avd-android-virtual-device.md](avd-android-virtual-device.md)
{% endcontent-ref %}

* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Besplatna verzija:** Personal Edition, treba da kreirate nalog. _PreporuÄuje se da **preuzmete** verziju **SA**_ _**VirtualBox** da biste izbegli potencijalne greÅ¡ke._)
* [**Nox**](https://es.bignox.com) (Besplatan, ali ne podrÅ¾ava Fridu ili Drozera).

{% hint style="info" %}
Prilikom kreiranja novog emulatora na bilo kojoj platformi, zapamtite da Å¡to je veÄ‡i ekran, to Ä‡e emulator sporije raditi. Dakle, odaberite manje ekrane ako je moguÄ‡e.
{% endhint %}

Da biste **instalirali Google usluge** (kao Å¡to je AppStore) u Genymotionu, treba da kliknete na crveno oznaÄeno dugme na sledeÄ‡oj slici:

![](<../../.gitbook/assets/image (200) (1).png>)

TakoÄ‘e, obratite paÅ¾nju da u **konfiguraciji Android VM u Genymotionu** moÅ¾ete odabrati **Bridge Network mode** (ovo Ä‡e biti korisno ako Ä‡ete se povezivati sa Android VM iz drugog VM-a sa alatkama).
#### Koristite fiziÄki ureÄ‘aj

Potrebno je aktivirati **opcije za otklanjanje greÅ¡aka** i bilo bi dobro ako moÅ¾ete da ga **root**-ujete:

1. **PodeÅ¡avanja**.
2. (Od Android 8.0) Izaberite **Sistem**.
3. Izaberite **O telefonu**.
4. Pritisnite **Broj izdanja** 7 puta.
5. Vratite se nazad i pronaÄ‡i Ä‡ete **Opcije za razvoj**.

> Nakon Å¡to instalirate aplikaciju, prva stvar koju treba da uradite je da je isprobate i istraÅ¾ite Å¡ta radi, kako funkcioniÅ¡e i da se udobno oseÄ‡ate s njom.\
> PredlaÅ¾em da **izvrÅ¡ite ovu poÄetnu dinamiÄku analizu koristeÄ‡i MobSF dinamiÄku analizu + pidcat**, tako da Ä‡emo moÄ‡i **da saznamo kako aplikacija funkcioniÅ¡e** dok MobSF **snima** mnogo **zanimljivih** **podataka** koje moÅ¾ete kasnije pregledati.

### NeÅ¾eljeno curenje podataka

**Logovanje**

Programeri treba da budu oprezni prilikom izlaganja **informacija za otklanjanje greÅ¡aka** javno, jer to moÅ¾e dovesti do curenja osetljivih podataka. Alati [**pidcat**](https://github.com/JakeWharton/pidcat) i `adb logcat` se preporuÄuju za praÄ‡enje logova aplikacije radi identifikacije i zaÅ¡tite osetljivih informacija. **Pidcat** je preferiran zbog jednostavnosti koriÅ¡Ä‡enja i Äitljivosti.

{% hint style="warning" %}
Imajte na umu da od **kasnijih verzija novijih od Android 4.0**, **aplikacije mogu pristupiti samo svojim logovima**. Dakle, aplikacije ne mogu pristupiti logovima drugih aplikacija.\
U svakom sluÄaju, i dalje se preporuÄuje **ne logovati osetljive informacije**.
{% endhint %}

**KeÅ¡iranje kopiranja/lepljenja u baferu**

Android-ov **sistem zasnovan na klipbordu** omoguÄ‡ava funkcionalnost kopiranja i lepljenja u aplikacijama, ali predstavlja rizik jer **druge aplikacije** mogu **pristupiti** klipbordu, potencijalno izlaÅ¾uÄ‡i osetljive podatke. VaÅ¾no je **onemoguÄ‡iti funkcije kopiranja/lepljenja** za osetljive delove aplikacije, poput detalja kreditne kartice, kako bi se spreÄilo curenje podataka.

**Logovi o padu**

Ako aplikacija **padne i saÄuva logove**, ti logovi mogu pomoÄ‡i napadaÄima, posebno kada aplikacija ne moÅ¾e biti reverzno inÅ¾enjerisana. Da biste umanjili ovaj rizik, izbegavajte logovanje prilikom pada, a ako logovi moraju biti preneti preko mreÅ¾e, osigurajte da se Å¡alju putem SSL kanala radi bezbednosti.

Kao pentester, **pokuÅ¡ajte da pogledate ove logove**.

**AnalitiÄki podaci poslati treÄ‡im stranama**

Aplikacije Äesto integriÅ¡u usluge poput Google Adsense-a, Å¡to moÅ¾e nenamerno **procureti osetljive podatke** zbog nepravilne implementacije od strane programera. Da biste identifikovali potencijalna curenja podataka, preporuÄljivo je **interceptovati saobraÄ‡aj aplikacije** i proveriti da li se Å¡alju osetljive informacije treÄ‡im stranama.

### SQLite baze podataka

VeÄ‡ina aplikacija Ä‡e koristiti **interne SQLite baze podataka** za Äuvanje informacija. Tokom pentesta pogledajte **baze podataka** koje su kreirane, imena **tabela** i **kolona** i sve **podatke** saÄuvane jer biste mogli pronaÄ‡i **osetljive informacije** (Å¡to bi predstavljalo ranjivost).\
Baze podataka bi trebalo da se nalaze u `/data/data/naziv.paketa/baze podataka` poput `/data/data/com.mwr.example.sieve/baze podataka`

Ako baza podataka Äuva poverljive informacije i **enkriptovana je** ali moÅ¾ete **pronaÄ‡i** lozinku unutar aplikacije, to i dalje predstavlja **ranjivost**.

EnumeriÅ¡ite tabele koristeÄ‡i `.tables` i enumeriÅ¡ite kolone tabela koristeÄ‡i `.schema <ime_tabele>`

### Drozer (Aktivnosti eksploatacije, pruÅ¾aoci sadrÅ¾aja i servisi)

Iz [Drozer Dokumenata](https://labs.mwrinfosecurity.com/assets/BlogFiles/mwri-drozer-user-guide-2015-03-23.pdf): **Drozer** vam omoguÄ‡ava da **preuzmete ulogu Android aplikacije** i interagujete sa drugim aplikacijama. MoÅ¾e raditi **sve Å¡to instalirana aplikacija moÅ¾e**, kao Å¡to je koriÅ¡Ä‡enje mehanizma Android-ovog meÄ‘uprocesnog komuniciranja (IPC) i interakcija sa osnovnim operativnim sistemom. .\
Drozer je koristan alat za **eksploataciju izloÅ¾enih aktivnosti, izloÅ¾enih servisa i pruÅ¾alaca sadrÅ¾aja** kako Ä‡ete nauÄiti u sledeÄ‡im sekcijama.

### Eksploatisanje izloÅ¾enih aktivnosti

[**ProÄitajte ovo ako Å¾elite da osveÅ¾ite Å¡ta je Android Aktivnost.**](android-applications-basics.md#launcher-activity-and-other-activities)\
TakoÄ‘e zapamtite da kod aktivnosti poÄinje u metodi **`onCreate`**.

**Bajpas autorizacije**

Kada je Aktivnost izloÅ¾ena, moÅ¾ete pozvati njen ekran iz spoljne aplikacije. Dakle, ako je aktivnost sa **osetljivim informacijama** **izloÅ¾ena**, mogli biste **bajpasovati** mehanizme **autentifikacije** da biste joj **pristupili**.

[**NauÄite kako da eksploatiÅ¡ete izloÅ¾ene aktivnosti pomoÄ‡u Drozera.**](drozer-tutorial/#activities)

TakoÄ‘e moÅ¾ete pokrenuti izloÅ¾enu aktivnost putem adb-a:

* NazivPaketa je com.example.demo
* NazivIzloÅ¾eneAktivnosti je com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NAPOMENA**: MobSF Ä‡e otkriti kao zlonamjernu upotrebu _**singleTask/singleInstance**_ kao `android:launchMode` u aktivnosti, ali zbog [ovoga](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), oÄigledno je da je ovo opasno samo na starim verzijama (API verzije < 21).

{% hint style="info" %}
Imajte na umu da zaobilazak autorizacije nije uvek ranjivost, to bi zavisilo od toga kako zaobilazak funkcioniÅ¡e i koje informacije su izloÅ¾ene.
{% endhint %}

**Curenje osetljivih informacija**

**Aktivnosti takoÄ‘e mogu vraÄ‡ati rezultate**. Ako uspete da pronaÄ‘ete izloÅ¾enu i nezaÅ¡tiÄ‡enu aktivnost koja poziva metodu **`setResult`** i **vraÄ‡a osetljive informacije**, to predstavlja curenje osetljivih informacija.

#### Tapjacking

Ako tapjacking nije spreÄen, mogli biste zloupotrebiti izloÅ¾enu aktivnost da naterate **korisnika da izvrÅ¡i neoÄekivane radnje**. Za viÅ¡e informacija o [**Å¡ta je Tapjacking pratite link**](./#tapjacking).

### IskoriÅ¡Ä‡avanje Provajdera SadrÅ¾aja - Pristupanje i manipulisanje osetljivim informacijama

[**ProÄitajte ovo ako Å¾elite da osveÅ¾ite Å¡ta je Provajder SadrÅ¾aja.**](android-applications-basics.md#content-provider)\
Provajderi sadrÅ¾aja se uglavnom koriste za **deljenje podataka**. Ako aplikacija ima dostupne provajdere sadrÅ¾aja, moÅ¾da Ä‡ete moÄ‡i da **izvuÄete osetljive** podatke iz njih. TakoÄ‘e je zanimljivo testirati moguÄ‡e **SQL ubacivanja** i **putanjske prelaske** jer bi mogli biti ranjivi.

[**NauÄite kako da iskoristite Provajdere SadrÅ¾aja sa Drozerom.**](drozer-tutorial/#content-providers)

### **IskoriÅ¡Ä‡avanje Servisa**

[**ProÄitajte ovo ako Å¾elite da osveÅ¾ite Å¡ta je Servis.**](android-applications-basics.md#services)\
Zapamtite da akcije Servisa poÄinju u metodi `onStartCommand`.

Servis je uglavnom neÅ¡to Å¡to **moÅ¾e primiti podatke**, ih **obraditi** i **vratiti** (ili ne) odgovor. Zatim, ako aplikacija izvozi neke servise, trebalo bi da **proverite** kod da biste razumeli Å¡ta radi i **testirali** ga **dinamiÄki** kako biste izvukli poverljive informacije, zaobiÅ¡li mere autentifikacije...\
[**NauÄite kako da iskoristite Servise sa Drozerom.**](drozer-tutorial/#services)

### **IskoriÅ¡Ä‡avanje Prijemnika Emitovanja**

[**ProÄitajte ovo ako Å¾elite da osveÅ¾ite Å¡ta je Prijemnik Emitovanja.**](android-applications-basics.md#broadcast-receivers)\
Zapamtite da akcije Prijemnika Emitovanja poÄinju u metodi `onReceive`.

Prijemnik emitovanja Ä‡e Äekati odreÄ‘enu vrstu poruke. Zavisno o tome kako prijemnik obraÄ‘uje poruku, moÅ¾e biti ranjiv.\
[**NauÄite kako da iskoristite Prijemnike Emitovanja sa Drozerom.**](./#exploiting-broadcast-receivers)

### **IskoriÅ¡Ä‡avanje Å ema / Dubokih linkova**

MoÅ¾ete ruÄno traÅ¾iti duboke linkove, koristeÄ‡i alate poput MobSF-a ili skripte poput [ove](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
MoÅ¾ete **otvoriti** deklarisano **Å¡ema** koristeÄ‡i **adb** ili **pregledaÄ**:

{% code overflow="wrap" %}
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
{% endcode %}

_Napomena da moÅ¾ete **izostaviti ime paketa** i mobilni Ä‡e automatski pozvati aplikaciju koja treba da otvori taj link._

{% code overflow="wrap" %}
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
{% endcode %}

**IzvrÅ¡eni kod**

Da biste pronaÅ¡li **kod koji Ä‡e se izvrÅ¡iti u aplikaciji**, idite na aktivnost pozvanu preko dubinskog linka i potraÅ¾ite funkciju **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Osetljive informacije**

Svaki put kada pronaÄ‘ete duboki link, proverite da **ne prima osetljive podatke (kao Å¡to su lozinke) putem URL parametara**, jer bi bilo koja druga aplikacija mogla **preuzeti identitet dubinskog linka i ukrasti te podatke!**

**Parametri u putanji**

TakoÄ‘e **morate proveriti da li bilo koji duboki link koristi parametar unutar putanje** URL-a kao Å¡to je: `https://api.example.com/v1/users/{username}`, u tom sluÄaju moÅ¾ete izazvati prolazak putanje pristupanjem neÄemu poput: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Imajte na umu da ako pronaÄ‘ete taÄne krajnje taÄke unutar aplikacije, moÅ¾da Ä‡ete moÄ‡i izazvati **Otvoreno preusmeravanje** (ako je deo putanje koriÅ¡Ä‡en kao ime domena), **preuzimanje naloga** (ako moÅ¾ete izmeniti detalje korisnika bez CSRF tokena i ranjiva krajnja taÄka koristi odgovarajuÄ‡u metodu) i bilo koju drugu ranjivost. ViÅ¡e [informacija o tome ovde](http://dphoeniixx.com/2020/12/13-2/).

**JoÅ¡ primera**

Interesantan izveÅ¡taj o otkrivanju greÅ¡aka moÅ¾ete pronaÄ‡i [ovde](https://hackerone.com/reports/855618) o linkovima (_/.well-known/assetlinks.json_).

### Inspekcija i neuspesi provere sloja transportnog sloja

* **Sertifikati se ne inspiciraju uvek pravilno** od strane Android aplikacija. ÄŒesto je za ove aplikacije uobiÄajeno da zanemare upozorenja i prihvate samopotpisane sertifikate ili, u nekim sluÄajevima, da se vrate na koriÅ¡Ä‡enje HTTP veza.
* **Pregovori tokom SSL/TLS rukovanja su ponekad slabi**, koristeÄ‡i nesigurne skupove Å¡ifri. Ova ranjivost Äini vezu podloÅ¾nom napadima Äoveka u sredini (MITM), omoguÄ‡avajuÄ‡i napadaÄima da deÅ¡ifruju podatke.
* **Otkrivanje privatnih informacija** je rizik kada aplikacije autentifikuju koriÅ¡Ä‡enjem sigurnih kanala, ali zatim komuniciraju preko nezaÅ¡tiÄ‡enih kanala za druge transakcije. Ovaj pristup ne Å¡titi osetljive podatke, poput sesijskih kolaÄiÄ‡a ili detalja korisnika, od presretanja od strane zlonamernih entiteta.

#### Provera sertifikata

FokusiraÄ‡emo se na **proveru sertifikata**. Integritet serverskog sertifikata mora biti proveren radi poboljÅ¡anja bezbednosti. Ovo je kljuÄno jer nesigurne TLS konfiguracije i prenos osetljivih podataka preko neÅ¡ifrovanih kanala mogu predstavljati znaÄajne rizike. Za detaljne korake o proveri serverskih sertifikata i reÅ¡avanju ranjivosti, [**ovaj resurs**](https://manifestsecurity.com/android-application-security-part-10/) pruÅ¾a sveobuhvatno voÄ‘stvo.

#### SSL Pinning

SSL Pinning je sigurnosna mera gde aplikacija proverava serverski sertifikat prema poznatoj kopiji koja je smeÅ¡tena unutar same aplikacije. Ova metoda je kljuÄna za spreÄavanje napada Äoveka u sredini. Implementacija SSL Pinninga se snaÅ¾no preporuÄuje za aplikacije koje rukuju osetljivim informacijama.

#### Inspekcija saobraÄ‡aja

Da biste inspicirali HTTP saobraÄ‡aj, neophodno je **instalirati sertifikat alata za proksiranje** (npr. Burp). Bez instaliranja ovog sertifikata, Å¡ifrovani saobraÄ‡aj moÅ¾da neÄ‡e biti vidljiv kroz proksi. Za vodiÄ o instaliranju prilagoÄ‘enog CA sertifikata, [**kliknite ovde**](avd-android-virtual-device.md#install-burp-certificate-on-a-virtual-machine).

Aplikacije koje ciljaju **API nivo 24 i viÅ¡e** zahtevaju modifikacije Network Security Config-a kako bi prihvatile CA sertifikat proksija. Ovaj korak je kljuÄan za inspiciranje Å¡ifrovanog saobraÄ‡aja. Za uputstva o modifikaciji Network Security Config-a, [**pogledajte ovaj tutorijal**](make-apk-accept-ca-certificate.md).

#### Zaobilazak SSL Pinninga

Kada je implementiran SSL Pinning, postaje neophodno zaobiÄ‡i ga radi inspiciranja HTTPS saobraÄ‡aja. RazliÄite metode su dostupne u tu svrhu:

* Automatski **modifikujte** **apk** da **zaobiÄ‘ete** SSLPinning sa [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). NajveÄ‡a prednost ove opcije je Å¡to vam nije potreban root za zaobilaÅ¾enje SSL Pinninga, ali Ä‡e biti potrebno da obriÅ¡ete aplikaciju i ponovo instalirate novu, i ovo neÄ‡e uvek raditi.
* MoÅ¾ete koristiti **Frida** (opisano ispod) da zaobiÄ‘ete ovu zaÅ¡titu. Evo vodiÄa za koriÅ¡Ä‡enje Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* MoÅ¾ete takoÄ‘e pokuÅ¡ati **automatski zaobiÄ‡i SSL Pinning** koriÅ¡Ä‡enjem [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* MoÅ¾ete takoÄ‘e pokuÅ¡ati **automatski zaobiÄ‡i SSL Pinning** koriÅ¡Ä‡enjem **MobSF dinamiÄke analize** (objaÅ¡njeno ispod)
* Ako i dalje mislite da postoji neki saobraÄ‡aj koji ne snimate, moÅ¾ete pokuÅ¡ati **proslediti saobraÄ‡aj ka burp koriÅ¡Ä‡enjem iptables**. ProÄitajte ovaj blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

#### TraÅ¾enje uobiÄajenih ranjivosti veb aplikacija

VaÅ¾no je takoÄ‘e traÅ¾iti uobiÄajene ranjivosti veb aplikacija unutar aplikacije. Detaljne informacije o identifikaciji i ublaÅ¾avanju ovih ranjivosti su van obima ovog saÅ¾etka, ali su obuhvaÄ‡ene na drugim mestima.

### Frida

[Frida](https://www.frida.re) je alat za dinamiÄku instrumentaciju za programere, inÅ¾enjere za reverzno inÅ¾enjerstvo i istraÅ¾ivaÄe sigurnosti.\
**MoÅ¾ete pristupiti pokrenutoj aplikaciji i hakovati metode u vreme izvrÅ¡avanja da promenite ponaÅ¡anje, vrednosti, izvuÄete vrednosti, pokrenete razliÄiti kod...**\
Ako Å¾elite da testirate sigurnost Android aplikacija, morate znati kako koristiti Fridu.

* NauÄite kako koristiti Fridu: [**Frida tutorial**](frida-tutorial/)
* Neke "GUI" za akcije sa Fridom: [**https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security**](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)
* Ojection je odliÄan za automatizaciju koriÅ¡Ä‡enja Fride: [**https://github.com/sensepost/objection**](https://github.com/sensepost/objection) **,** [**https://github.com/dpnishant/appmon**](https://github.com/dpnishant/appmon)
* MoÅ¾ete pronaÄ‡i neke sjajne Frida skripte ovde: [**https://codeshare.frida.re/**](https://codeshare.frida.re)

### **Izdvajanje memorije - Fridump**

Proverite da li aplikacija Äuva osetljive informacije unutar memorije koje ne bi trebalo da Äuva, poput lozinki ili mnemonika.

KoriÅ¡Ä‡enjem [**Fridump3**](https://github.com/rootbsd/fridump3) moÅ¾ete izdvojiti memoriju aplikacije sa:
```bash
# With PID
python3 fridump3.py -u <PID>

# With name
frida-ps -Uai
python3 fridump3.py -u "<Name>"
```
Ovo Ä‡e izbaciti memoriju u ./dump fascikli, a zatim moÅ¾ete koristiti grep sa neÄim poput:

{% code overflow="wrap" %}
```bash
strings * | grep -E "^[a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+ [a-z]+$"
```
{% endcode %}

### **Osetljivi podaci u Keystore-u**

U Androidu je Keystore najbolje mesto za Äuvanje osetljivih podataka, meÄ‘utim, sa dovoljno privilegija i dalje je **moguÄ‡e pristupiti**. PoÅ¡to aplikacije Äesto ovde Äuvaju **osetljive podatke u obliku Äistog teksta**, pentesteri bi trebalo da provere da li su takvi podaci dostupni, jer korisnik sa root privilegijama ili fiziÄkim pristupom ureÄ‘aju moÅ¾e ukrasti ove podatke.

ÄŒak i ako je aplikacija saÄuvala podatke u keystore-u, podaci bi trebalo da budu enkriptovani.

Da biste pristupili podacima unutar keystore-a, moÅ¾ete koristiti ovaj Frida skript: [https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js](https://github.com/WithSecureLabs/android-keystore-audit/blob/master/frida-scripts/tracer-cipher.js)
```bash
frida -U -f com.example.app -l frida-scripts/tracer-cipher.js
```
### **Bypass otiska prsta/biometrije**

KoriÅ¡Ä‡enjem sledeÄ‡eg Frida skripta moguÄ‡e je **zaobiÄ‡i autentifikaciju otiskom prsta** koju Android aplikacije moÅ¾da vrÅ¡e kako bi **zaÅ¡titile odreÄ‘ena osetljiva podruÄja:**

{% code overflow="wrap" %}
```bash
frida --codeshare krapgras/android-biometric-bypass-update-android-11 -U -f <app.package>
```
{% endcode %}

### **Pozadinske slike**

Kada stavite aplikaciju u pozadinu, Android Äuva **snapshot aplikacije** tako da kada se vrati u prednji plan, poÄinje da uÄitava sliku pre aplikacije kako bi izgledalo da je aplikacija uÄitana brÅ¾e.

MeÄ‘utim, ako ovaj snapshot sadrÅ¾i **osetljive informacije**, osoba sa pristupom snapshotu moÅ¾e **ukrasti te informacije** (imajte na umu da je potreban root pristup).

Snapshotovi se obiÄno Äuvaju na lokaciji: **`/data/system_ce/0/snapshots`**

Android pruÅ¾a naÄin da **spreÄite snimanje ekrana postavljanjem FLAG\_SECURE** parametra rasporeda. KoriÅ¡Ä‡enjem ovog flaga, sadrÅ¾aj prozora se tretira kao siguran, spreÄavajuÄ‡i ga da se pojavi na snimcima ekrana ili da bude prikazan na nebezbednim ekranima.
```bash
getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE);
```
### **Analizator Android aplikacija**

Ovaj alat moÅ¾e vam pomoÄ‡i u upravljanju razliÄitim alatima tokom dinamiÄke analize: [https://github.com/NotSoSecure/android\_application\_analyzer](https://github.com/NotSoSecure/android\_application\_analyzer)

### Injekcija Intenata

Programeri Äesto kreiraju proxy komponente poput aktivnosti, servisa i broadcast receivera koji obraÄ‘uju ove Intente i prosleÄ‘uju ih metodama poput `startActivity(...)` ili `sendBroadcast(...)`, Å¡to moÅ¾e biti riziÄno.

Opasnost leÅ¾i u tome Å¡to omoguÄ‡ava napadaÄima da pokrenu neizloÅ¾ene komponente aplikacije ili pristupe osetljivim provajderima sadrÅ¾aja preusmeravanjem ovih Intenata. ZnaÄajan primer je komponenta `WebView` koja konvertuje URL-ove u `Intent` objekte putem `Intent.parseUri(...)` i zatim ih izvrÅ¡ava, potencijalno dovodeÄ‡i do zlonamernih Injekcija Intenata.

### KljuÄne informacije

* **Injekcija Intenata** je sliÄna problemu otvorenog preusmeravanja na vebu.
* Eksploatacije ukljuÄuju prosleÄ‘ivanje `Intent` objekata kao dodatnih informacija, koje mogu biti preusmerene da izvrÅ¡e nesigurne operacije.
* MoÅ¾e otkriti neizloÅ¾ene komponente i provajdere sadrÅ¾aja napadaÄima.
* Konverzija URL-ova u `Intent` objekte u `WebView`-u moÅ¾e olakÅ¡ati neÅ¾eljene akcije.

### Injekcije na Android klijentskoj strani i ostalo

Verovatno ste upoznati sa ovom vrstom ranjivosti sa veba. Morate biti posebno oprezni sa ovim ranjivostima u Android aplikaciji:

* **SQL Injection:** Prilikom rukovanja dinamiÄkim upitima ili Content-Providerima, osigurajte da koristite parametrizovane upite.
* **JavaScript Injection (XSS):** Proverite da li je podrÅ¡ka za JavaScript i dodatke onemoguÄ‡ena za sve WebViews (podrazumevano onemoguÄ‡eno). [ViÅ¡e informacija ovde](webview-attacks.md#javascript-enabled).
* **UkljuÄivanje lokalnih fajlova:** WebViews bi trebalo da imaju onemoguÄ‡en pristup fajl sistemu (podrazumevano omoguÄ‡eno) - `(webview.getSettings().setAllowFileAccess(false);)`. [ViÅ¡e informacija ovde](webview-attacks.md#javascript-enabled).
* **VeÄni kolaÄiÄ‡i**: U nekoliko sluÄajeva, kada Android aplikacija zavrÅ¡i sesiju, kolaÄiÄ‡ nije povuÄen ili Äak moÅ¾e biti saÄuvan na disku.
* [**Bezbedna oznaka** u kolaÄiÄ‡ima](../../pentesting-web/hacking-with-cookies/#cookies-flags)

***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Uvidi u hakovanje**\
UkljuÄite se u sadrÅ¾aj koji istraÅ¾uje uzbuÄ‘enje i izazove hakovanja

**Vesti o hakovanju u realnom vremenu**\
Budite u toku sa dinamiÄnim svetom hakovanja putem vesti i uvida u realnom vremenu

**Najnovije objave**\
Budite informisani o najnovijim nagradama za pronalaÅ¾enje bagova i vaÅ¾nim aÅ¾uriranjima platforme

**PridruÅ¾ite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poÄnite da saraÄ‘ujete sa vrhunskim hakerima danas!

## Automatska analiza

### [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF)

**StatiÄka analiza**

![](<../../.gitbook/assets/image (61).png>)

**Procena ranjivosti aplikacije** koriÅ¡Ä‡enjem lepog web-based korisniÄkog interfejsa. TakoÄ‘e moÅ¾ete izvrÅ¡iti dinamiÄku analizu (ali morate pripremiti okruÅ¾enje).
```bash
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Primetite da MobSF moÅ¾e analizirati **Android**(apk)**, IOS**(ipa) **i Windows**(apx) aplikacije (_Windows aplikacije moraju biti analizirane sa MobSF instaliranim na Windows hostu_).\
TakoÄ‘e, ako kreirate **ZIP** fajl sa izvornim kodom **Android** ili **IOS** aplikacije (idite u korenski folder aplikacije, izaberite sve i kreirajte ZIP fajl), MobSF Ä‡e moÄ‡i da ga analizira.

MobSF takoÄ‘e omoguÄ‡ava **diff/UporeÄ‘ivanje** analize i integraciju **VirusTotal** (treba da postavite svoj API kljuÄ u _MobSF/settings.py_ i omoguÄ‡ite ga: `VT_ENABLED = TRUE` `VT_API_KEY = <VaÅ¡ API kljuÄ>` `VT_UPLOAD = TRUE`). TakoÄ‘e moÅ¾ete postaviti `VT_UPLOAD` na `False`, tada Ä‡e **hash** biti **uploadovan** umesto fajla.

### Asistirana dinamiÄka analiza sa MobSF

**MobSF** takoÄ‘e moÅ¾e biti veoma koristan za **dinamiÄku analizu** u **Androidu**, ali u tom sluÄaju morate instalirati MobSF i **genymotion** na svom hostu (VM ili Docker neÄ‡e raditi). _Napomena: Morate **prvo pokrenuti VM u genymotionu** a zatim **MobSF.**_\
**MobSF dinamiÄki analizator** moÅ¾e:

* **IzvuÄ‡i podatke aplikacije** (URL-ove, logove, clipboard, screenshotove koje ste napravili, screenshotove koje je napravio "**Exported Activity Tester**", emailove, SQLite baze podataka, XML fajlove i druge kreirane fajlove). Sve ovo se radi automatski osim screenshotova, morate pritisnuti kada Å¾elite screenshot ili pritisnuti "**Exported Activity Tester**" da biste dobili screenshotove svih izvezenih aktivnosti.
* Snimiti **HTTPS saobraÄ‡aj**
* Koristiti **Fridu** da dobije **informacije u toku izvrÅ¡avanja**

Od android **verzije > 5**, automatski Ä‡e pokrenuti Fridu i postaviti globalne **proxy** postavke za **hvatanje** saobraÄ‡aja. HvataÄ‡e saobraÄ‡aj samo od testirane aplikacije.

**Frida**

Podrazumevano, takoÄ‘e Ä‡e koristiti neke Frida skripte da **zaobiÄ‘e SSL pinning**, **detekciju root-a** i **detekciju debugger-a** i da **prati interesantne API-je**.\
MobSF takoÄ‘e moÅ¾e **pozvati izvezene aktivnosti**, uhvatiti njihove **screenshotove** i **saÄuvati** ih za izveÅ¡taj.

Za **pokretanje** dinamiÄkog testiranja pritisnite zeleno dugme: "**Start Instrumentation**". Pritisnite "**Frida Live Logs**" da vidite logove generisane od Frida skripti i "**Live API Monitor**" da vidite sve pozive ka hakovanim metodama, prosleÄ‘ene argumente i vraÄ‡ene vrednosti (ovo Ä‡e se pojaviti nakon Å¡to pritisnete "Start Instrumentation").\
MobSF vam takoÄ‘e dozvoljava da uÄitate svoje **Frida skripte** (da biste poslali rezultate vaÅ¡ih Frida skripti MobSF-u koristite funkciju `send()`). TakoÄ‘e ima **nekoliko unapred napisanih skripti** koje moÅ¾ete uÄitati (moÅ¾ete dodati viÅ¡e u `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), samo ih **izaberite**, pritisnite "**Load**" i pritisnite "**Start Instrumentation**" (moÄ‡i Ä‡ete da vidite logove tih skripti unutar "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Osim toga, imate neke pomoÄ‡ne Frida funkcionalnosti:

* **Enumerate Loaded Classes**: IspisaÄ‡e sve uÄitane klase
* **Capture Strings**: IspisaÄ‡e sve uhvaÄ‡ene stringove prilikom koriÅ¡Ä‡enja aplikacije (vrlo buÄno)
* **Capture String Comparisons**: MoÅ¾e biti veoma korisno. PokazaÄ‡e **2 uporeÄ‘ena stringa** i da li je rezultat bio TaÄan ili NetaÄan.
* **Enumerate Class Methods**: Unesite ime klase (kao "java.io.File") i ispisuje sve metode klase.
* **Search Class Pattern**: PretraÅ¾uje klase po obrascu
* **Trace Class Methods**: **Prati** celu **klasu** (vidi ulaze i izlaze svih metoda te klase). Zapamtite da MobSF podrazumevano prati nekoliko interesantnih Android Api metoda.

Kada odaberete pomoÄ‡ni modul koji Å¾elite da koristite, treba da pritisnete "**Start Intrumentation**" i videÄ‡ete sve izlaze u "**Frida Live Logs**".

**Shell**

Mobsf takoÄ‘e donosi shell sa nekim **adb** komandama, **MobSF komandama**, i uobiÄajenim **shell** **komandama** na dnu stranice dinamiÄke analize. Neke interesantne komande:
```bash
help
shell ls
activities
exported_activities
services
receivers
```
**HTTP alati**

Kada se uhvati http saobraÄ‡aj, moÅ¾ete videti ruÅ¾an prikaz uhvaÄ‡enog saobraÄ‡aja na dnu "**HTTP(S) Traffic**" ili lepÅ¡i prikaz na zelenom dugmetu "**Start HTTPTools**". Iz drugih opcija, moÅ¾ete **poslati** uhvaÄ‡ene zahteve ka **proxy** serverima poput Burp-a ili Owasp ZAP-a.\
Da biste to uradili, _ukljuÄite Burp -->_ _iskljuÄite Intercept --> u MobSB HTTPTools izaberite zahtev_ --> pritisnite "**Send to Fuzzer**" --> _izaberite adresu proxy servera_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Kada zavrÅ¡ite dinamiÄku analizu sa MobSF-om, moÅ¾ete pritisnuti "**Start Web API Fuzzer**" da **fuzzujete http zahteve** i traÅ¾ite ranjivosti.

{% hint style="info" %}
Nakon obavljanja dinamiÄke analize sa MobSF-om, postavke proxy servera mogu biti netaÄno konfigurisane i neÄ‡ete moÄ‡i da ih popravite iz GUI-ja. MoÅ¾ete popraviti postavke proxy servera tako Å¡to Ä‡ete:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### Asistirana dinamiÄka analiza pomoÄ‡u Inspeckage alata

MoÅ¾ete preuzeti alat sa [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Ovaj alat koristi neke **kuke** kako bi vam omoguÄ‡io da saznate **Å¡ta se deÅ¡ava u aplikaciji** dok vrÅ¡ite **dinamiÄku analizu**.

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Ovo je **odliÄan alat za obavljanje statiÄke analize sa grafiÄkim korisniÄkim interfejsom**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Ovaj alat je dizajniran da traÅ¾i nekoliko **bezbednosno povezanih ranjivosti Android aplikacija**, bilo u **izvornom kodu** ili **zapakovanim APK datotekama**. Alat je takoÄ‘e **sposoban da kreira "Proof-of-Concept" APK koji se moÅ¾e implementirati** i **ADB komande**, kako bi iskoristio neke od pronaÄ‘enih ranjivosti (izloÅ¾ene aktivnosti, namere, tapjacking...). Kao i sa Drozer-om, nije potrebno rutovati test ureÄ‘aj.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Prikazuje sve izvuÄene datoteke radi lakÅ¡eg referisanja
* Automatski dekompajlira APK datoteke u Java i Smali format
* Analizira AndroidManifest.xml radi uobiÄajenih ranjivosti i ponaÅ¡anja
* StatistiÄka analiza izvornog koda za uobiÄajene ranjivosti i ponaÅ¡anja
* Informacije o ureÄ‘aju
* i joÅ¡ viÅ¡e
```bash
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

SUPER je aplikacija za komandnu liniju koja se moÅ¾e koristiti u Windows-u, MacOS X-u i Linux-u, koja analizira _.apk_ fajlove u potrazi za ranjivostima. To radi dekompresovanjem APK-ova i primenom niza pravila za otkrivanje tih ranjivosti.

Sva pravila su centrirana u `rules.json` fajlu, i svaka kompanija ili testera moÅ¾e kreirati svoja pravila za analizu onoga Å¡to im je potrebno.

Preuzmite najnovije binarne fajlove sa [stranice za preuzimanje](https://superanalyzer.rocks/download.html)
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn je alat koji radi na viÅ¡e platformi i pomaÅ¾e developerima, lovcima na bagove i etiÄkim hakerima da vrÅ¡e statiÄku analizu koda mobilnih aplikacija.

Koncept je da prevuÄete i otpustite datoteku vaÅ¡e mobilne aplikacije (datoteku .apk ili .ipa) na aplikaciju StaCoAn i ona Ä‡e generisati vizuelni i prenosivi izveÅ¡taj za vas. MoÅ¾ete prilagoditi postavke i liste reÄi da biste dobili personalizovano iskustvo.

Preuzmite [najnovije izdanje](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

AndroBugs Framework je sistem analize ranjivosti Androida koji pomaÅ¾e developerima ili hakerima da pronaÄ‘u potencijalne sigurnosne ranjivosti u Android aplikacijama.\
[Windows izdanja](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** je alat Äiji je glavni cilj da otkrije i upozori korisnika na potencijalno zlonamerne radnje razvijene od strane Android aplikacije.

Otkrivanje se vrÅ¡i **statiÄkom analizom** Dalvik bajtkoda aplikacije, predstavljenog kao **Smali**, pomoÄ‡u biblioteke [`androguard`](https://github.com/androguard/androguard).

Ovaj alat traÅ¾i **uobiÄajeno ponaÅ¡anje "loÅ¡ih" aplikacija** poput: ekstrakcije telefonskih identifikatora, presretanja audio/video tokova, modifikacije PIM podataka, izvrÅ¡avanja proizvoljnog koda...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA\_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** je **M**obilni **A**plikacija za **R**everzno inÅ¾enjerstvo i **A**nalizu okvira. To je alat koji objedinjuje Äesto koriÅ¡Ä‡ene alate za reverzno inÅ¾enjerstvo i analizu mobilnih aplikacija, kako bi pomogao u testiranju mobilnih aplikacija protiv OWASP mobilnih sigurnosnih pretnji. Njegov cilj je da olakÅ¡a ovaj zadatak i da bude prijateljski nastrojen prema razvojnim programerima mobilnih aplikacija i profesionalcima za sigurnost.

MoÅ¾e:

* IzvuÄ‡i Java i Smali kod koristeÄ‡i razliÄite alate
* Analizirati APK-ove koristeÄ‡i: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs\_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* IzvuÄ‡i privatne informacije iz APK-a koristeÄ‡i regexps.
* Analizirati Manifest.
* Analizirati pronaÄ‘ene domene koristeÄ‡i: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) i [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Deobfuskovati APK putem [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

Korisno za otkrivanje malvera: [https://koodous.com/](https://koodous.com)

## Obfuskacija/Deobfuskacija koda

Imajte na umu da zavisi od usluge i konfiguracije koju koristite za obfuskaciju koda. Tajne mogu ili ne moraju biti obfuskovane.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

Sa [Vikipedije](https://en.wikipedia.org/wiki/ProGuard\_\(software\)): **ProGuard** je alat otvorenog koda za komandnu liniju koji smanjuje, optimizuje i obfuskira Java kod. MoÅ¾e optimizovati bajtkod kao i otkriti i ukloniti nekoriÅ¡Ä‡ene instrukcije. ProGuard je besplatan softver i distribuira se pod GNU General Public License, verzija 2.

ProGuard se distribuira kao deo Android SDK-a i pokreÄ‡e se prilikom izgradnje aplikacije u reÅ¾imu izdanja.

### [DexGuard](https://www.guardsquare.com/dexguard)

PronaÄ‘ite vodiÄ korak po korak za deobfuskaciju apk-a na [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Iz tog vodiÄa) Poslednji put kada smo proverili, naÄin rada Dexguard-a bio je:

* uÄitavanje resursa kao InputStream;
* prosleÄ‘ivanje rezultata klasi koja nasleÄ‘uje od FilterInputStream-a da ga deÅ¡ifruje;
* obaviti nekoliko beskorisnih obfuskacija kako bi se potroÅ¡ilo nekoliko minuta vremena od osobe koja reverzira;
* prosleÄ‘ivanje deÅ¡ifrovanog rezultata ZipInputStream-u da dobijete DEX datoteku;
* konaÄno uÄitavanje rezultujuÄ‡eg DEX-a kao Resurs koristeÄ‡i metod `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard vraÄ‡a proces obfuskacije koji su obavili alati za obfuskaciju Androida. To omoguÄ‡ava brojne sigurnosne analize, ukljuÄujuÄ‡i inspekciju koda i predviÄ‘anje biblioteka.**

MoÅ¾ete otpremiti obfuskovan APK na njihovu platformu.

### [Simplify](https://github.com/CalebFenton/simplify)

To je **generiÄki deobfuskator za Android.** Simplify **virtuelno izvrÅ¡ava aplikaciju** kako bi razumeo njen ponaÅ¡anje, a zatim **pokuÅ¡ava da optimizuje kod** tako da se ponaÅ¡a identiÄno, ali je lakÅ¡i za razumevanje ljudima. Svaka vrsta optimizacije je jednostavna i generiÄka, pa nije vaÅ¾no koji je specifiÄan tip obfuskacije koriÅ¡Ä‡en.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD vam pruÅ¾a informacije o **kako je napravljen APK**. Identifikuje mnoge **kompajlere**, **pakere**, **obfuskatore** i druge Äudne stvari. To je [_PEiD_](https://www.aldeid.com/wiki/PEiD) za Android.

### RuÄno

[ProÄitajte ovaj tutorijal da biste nauÄili neke trikove o **kako da reverzujete prilagoÄ‘enu obfuskaciju**](manual-deobfuscation.md)

## Laboratorije

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b je Android sigurnosna virtuelna maÅ¡ina zasnovana na ubuntu-mate koja ukljuÄuje kolekciju najnovijih okvira, tutorijala i laboratorija od razliÄitih sigurnosnih entuzijasta i istraÅ¾ivaÄa za reverzno inÅ¾enjerstvo i analizu malvera.

## Reference

* [https://owasp.org/www-project-mobile-app-security/](https://owasp.org/www-project-mobile-app-security/)
* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) To je odliÄan spisak resursa
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Brzi kurs za Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)
* [https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## JoÅ¡ uvek treba probati

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Uvidi u hakovanje**\
UkljuÄite se u sadrÅ¾aj koji istraÅ¾uje uzbuÄ‘enje i izazove hakovanja

**Vesti o hakovanju u realnom vremenu**\
Budite u toku sa brzim svetom hakovanja kroz vesti i uvide u realnom vremenu

**Najnovije objave**\
Budite informisani o najnovijim nagradama za pronalaÅ¾enje bagova i vaÅ¾nim aÅ¾uriranjima platforme

**PridruÅ¾ite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poÄnite da saraÄ‘ujete sa vrhunskim hakerima danas!

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
