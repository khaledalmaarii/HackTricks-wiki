# Podstawy Aplikacji na Androida

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## Model Bezpieczestwa Androida

**Skada si z dw贸ch warstw:**

* **Systemu operacyjnego (OS)**, kt贸ry izoluje zainstalowane aplikacje od siebie.
* **Samej aplikacji**, kt贸ra pozwala deweloperom **udostpnia okrelone funkcjonalnoci** i konfigurowa zdolnoci aplikacji.

### Separacja UID

**Ka偶da aplikacja jest przypisana okrelone ID u偶ytkownika (UID)**. Jest to wykonywane podczas instalacji aplikacji, dziki czemu **aplikacja mo偶e komunikowa si tylko z plikami nale偶cymi do swojego UID lub plikami wsp贸dzielonymi**. Dlatego tylko sama aplikacja, pewne komponenty systemu operacyjnego i u偶ytkownik root mog uzyska dostp do danych aplikacji.

### Wsp贸dzielenie UID

**Dwie aplikacje mog by skonfigurowane do korzystania z tego samego UID**. Mo偶e to by przydatne do udostpniania informacji, ale jeli jedna z nich zostanie skompromitowana, dane obu aplikacji zostan naruszone. Dlatego ten spos贸b postpowania jest **niezalecany**.\
**Aby wsp贸dzieli to samo UID, aplikacje musz zdefiniowa t sam warto `android:sharedUserId` w swoich manifestach.**

### Izolacja

**Piaskownica Aplikacji Androida** pozwala uruchamia **ka偶d aplikacj** jako **oddzielny proces pod oddzielnym identyfikatorem u偶ytkownika**. Ka偶dy proces ma swoj wasn maszyn wirtualn, wic kod aplikacji dziaa w izolacji od innych aplikacji.\
Od Androida 5.0(L) jest stosowany **SELinux**. W skr贸cie, SELinux odrzuca wszystkie interakcje proces贸w, a nastpnie tworzy zasady, aby **zezwoli tylko na oczekiwane interakcje midzy nimi**.

### Uprawnienia

Podczas instalacji **aplikacji i proby o uprawnienia**, aplikacja prosi o uprawnienia skonfigurowane w elementach **`uses-permission`** w pliku **AndroidManifest.xml**. Element **uses-permission** wskazuje nazw 偶danego uprawnienia w atrybucie **name**. Ma r贸wnie偶 atrybut **maxSdkVersion**, kt贸ry przestaje prosi o uprawnienia w wersjach wy偶szych ni偶 okrelona.\
Zauwa偶, 偶e aplikacje na Androida nie musz prosi o wszystkie uprawnienia na pocztku, mog r贸wnie偶 **prosi o uprawnienia dynamicznie**, ale wszystkie uprawnienia musz by **zadeklarowane** w **manifecie**.

Gdy aplikacja udostpnia funkcjonalno, mo偶e ograniczy **dostp tylko do aplikacji posiadajcych okrelone uprawnienie**.\
Element uprawnienia ma trzy atrybuty:

* Nazw uprawnienia
* Atrybut **permission-group**, kt贸ry pozwala na grupowanie powizanych uprawnie.
* **Poziom ochrony**, kt贸ry wskazuje, w jaki spos贸b uprawnienia s udzielane. Istniej cztery typy:
* **Normal**: U偶ywane, gdy nie ma **znanych zagro偶e** dla aplikacji. U偶ytkownik **nie musi go zatwierdza**.
* **Niebezpieczne**: Wskazuje, 偶e uprawnienie nadaje 偶dajcej aplikacji pewne **podwy偶szone uprawnienia**. **U偶ytkownicy s proszeni o ich zatwierdzenie**.
* **Podpis**: Tylko **aplikacje podpisane tym samym certyfikatem co ta**, eksportujca komponent, mog uzyska uprawnienie. Jest to najwy偶szy poziom ochrony.
* **PodpisLubSystem**: Tylko **aplikacje podpisane tym samym certyfikatem co ta**, eksportujca komponent, lub **aplikacje dziaajce z poziomem dostpu systemowego** mog uzyska uprawnienia.

## Zainstalowane Wstpnie Aplikacje

Te aplikacje zazwyczaj znajduj si w katalogach **`/system/app`** lub **`/system/priv-app`**, a niekt贸re z nich s **zoptymalizowane** (mo偶esz nawet nie znale藕 pliku `classes.dex`). Warto sprawdzi te aplikacje, poniewa偶 czasami dziaaj zbyt wieloma uprawnieniami (jako root).

* Te dostarczone z **AOSP** (Android OpenSource Project) **ROM**
* Dodane przez **producenta urzdzenia**
* Dodane przez **dostawc telefonu kom贸rkowego** (jeli zakupione od nich)

## Rootowanie

Aby uzyska dostp roota do fizycznego urzdzenia z systemem Android, zazwyczaj trzeba **wykorzysta** 1 lub 2 **luki**, kt贸re zazwyczaj s **specyficzne** dla **urzdzenia** i **wersji**.\
Gdy exploit zadziaa, zazwyczaj binarny `su` systemu Linux jest kopiowany do lokalizacji okrelonej w zmiennej rodowiskowej PATH u偶ytkownika, np. `/system/xbin`.

Po skonfigurowaniu binarnego su, inna aplikacja na Androida jest u偶ywana do interakcji z binarnym `su` i **przetwarzania 偶da dostpu roota** jak **Superuser** i **SuperSU** (dostpne w sklepie Google Play).

{% hint style="danger" %}
Zauwa偶, 偶e proces rootowania jest bardzo niebezpieczny i mo偶e powa偶nie uszkodzi urzdzenie
{% endhint %}

### ROM-y

Mo偶liwe jest **zastpienie systemu operacyjnego instalujc niestandardowe oprogramowanie**. Dziki temu mo偶na rozszerzy u偶yteczno starego urzdzenia, omin ograniczenia oprogramowania lub uzyska dostp do najnowszego kodu Androida.\
**OmniROM** i **LineageOS** to dwa z najpopularniejszych oprogramowa do u偶ytku.

Zauwa偶, 偶e **nie zawsze jest konieczne zrootowanie urzdzenia** do zainstalowania niestandardowego oprogramowania. **Niekt贸rzy producenci pozwalaj** na odblokowanie ich bootloader贸w w spos贸b dobrze udokumentowany i bezpieczny.

### Konsekwencje

Po zrootowaniu urzdzenia, dowolna aplikacja mo偶e 偶da dostpu jako root. Jeli zoliwa aplikacja go uzyska, bdzie miaa dostp do prawie wszystkiego i bdzie moga uszkodzi telefon.

## Podstawy Aplikacji na Androida <a href="#2-android-application-fundamentals" id="2-android-application-fundamentals"></a>

- Format aplikacji na Androida nazywany jest _formatem pliku APK_. Jest to w zasadzie **plik ZIP** (poprzez zmian rozszerzenia pliku na .zip, zawarto mo偶na wyodrbni i przeglda).
- Zawarto APK (niepena)
- **AndroidManifest.xml**
- resources.arsc/strings.xml
- resources.arsc: zawiera skompilowane zasoby, takie jak binarne XML.
- res/xml/files\_paths.xml
- META-INF/
- Tutaj znajduje si Certyfikat!
- **classes.dex**
- Zawiera kod bajtowy Dalvika, reprezentujcy skompilowany kod Java (lub Kotlin), kt贸ry aplikacja wykonuje domylnie.
- lib/
- Zawiera biblioteki natywne, podzielone wedug architektury CPU w podkatalogach.
- `armeabi`: kod dla procesor贸w opartych na ARM
- `armeabi-v7a`: kod dla procesor贸w opartych na ARMv7 i nowszych
- `x86`: kod dla procesor贸w X86
- `mips`: kod tylko dla procesor贸w MIPS
- assets/
- Przechowuje r贸偶ne pliki potrzebne przez aplikacj, potencjalnie zawierajce dodatkowe biblioteki natywne lub pliki DEX, czasami u偶ywane przez autor贸w zoliwego oprogramowania do ukrycia dodatkowego kodu.
- res/
- Zawiera zasoby, kt贸re nie s skompilowane do resources.arsc
### **Dalvik & Smali**

W rozwoju aplikacji na Androida u偶ywa si **Javy lub Kotlin**. Zamiast korzysta z JVM jak w aplikacjach na komputery stacjonarne, Android kompiluje ten kod do **wykonywalnego kodu Dalvika (DEX)**. Wczeniej ten kod obsugiwaa maszyna wirtualna Dalvika, ale teraz w nowszych wersjach Androida przejmuje to Android Runtime (ART).

W przypadku in偶ynierii wstecznej **Smali** staje si kluczowy. Jest to czytelna dla czowieka wersja kodu DEX, dziaajca jak jzyk asemblera, tumaczca kod 藕r贸dowy na instrukcje bajtowe. Smali i baksmali odnosz si do narzdzi monta偶u i demonta偶u w tym kontekcie.

## Intents

Intents s g贸wnym rodkiem komunikacji midzy komponentami aplikacji na Androida lub z innymi aplikacjami. Obiekty tych wiadomoci mog r贸wnie偶 przekazywa dane midzy aplikacjami lub komponentami, podobnie jak w przypadku 偶da GET/POST w komunikacji HTTP.

Wic Intent to w zasadzie **wiadomo przekazywana midzy komponentami**. Intents **mog by kierowane** do konkretnych komponent贸w lub aplikacji, **lub mog by wysyane bez okrelonego odbiorcy**.\
Aby to uproci, Intent mo偶na u偶y:

* Do uruchamiania Activity, zazwyczaj otwierajc interfejs u偶ytkownika aplikacji
* Jako transmisje, informujce system i aplikacje o zmianach
* Do uruchamiania, zatrzymywania i komunikowania si z usug w tle
* Do uzyskiwania dostpu do danych za porednictwem dostawc贸w treci
* Jako wywoania zwrotne do obsugi zdarze

Jeli s podatne, **Intents mog by wykorzystane do przeprowadzenia r贸偶norodnych atak贸w**.

### Intent-Filter

**Filtry Intents** definiuj **jak aktywno, usuga lub odbiornik nadawany mo偶e wsp贸dziaa z r贸偶nymi typami Intents**. W zasadzie opisuj one mo偶liwoci tych komponent贸w, takie jak jakie dziaania mog wykonywa lub jakie rodzaje transmisji mog przetwarza. G贸wnym miejscem deklaracji tych filtr贸w jest plik **AndroidManifest.xml**, chocia偶 dla odbiornik贸w nadawanych istnieje r贸wnie偶 opcja ich kodowania.

Filtry Intents skadaj si z kategorii, dziaa i filtr贸w danych, z mo偶liwoci dodania dodatkowych metadanych. Taka konfiguracja pozwala komponentom obsugiwa konkretne Intents, kt贸re speniaj okrelone kryteria.

Krytycznym aspektem komponent贸w Androida (aktywnoci/usug/dostawc贸w treci/odbiorc贸w nadawanych) jest ich widoczno lub **status publiczny**. Komponent jest uwa偶any za publiczny i mo偶e wsp贸dziaa z innymi aplikacjami, jeli jest **`eksportowany`** z wartoci **`true`** lub jeli dla niego zadeklarowany jest filtr Intent w manifecie. Jednak deweloperzy maj mo偶liwo jawnego zachowania tych komponent贸w jako prywatnych, zapewniajc, 偶e nie bd one niezamierzenie wsp贸dziaa z innymi aplikacjami. Mo偶na to osign, ustawiajc atrybut **`eksportowany`** na **`false`** w ich definicjach manifestu.

Co wicej, deweloperzy maj mo偶liwo dodatkowego zabezpieczenia dostpu do tych komponent贸w, wymagajc okrelonych uprawnie. Atrybut **`permission`** mo偶e by ustawiony, aby wymusi, 偶e tylko aplikacje z okrelonym uprawnieniem mog uzyska dostp do komponentu, dodajc dodatkow warstw bezpieczestwa i kontroli nad tym, kto mo偶e z nim wsp贸dziaa.
```java
<activity android:name=".MyActivity" android:exported="false">
<!-- Intent filters go here -->
</activity>
```
### Impliitytne Intencje

Intencje s tworzone programistycznie za pomoc konstruktora Intent:
```java
Intent email = new Intent(Intent.ACTION_SEND, Uri.parse("mailto:"));
```
Akcja **Action** wczeniej zadeklarowanego zamiaru to **ACTION\_SEND**, a **Extra** to mailto **Uri** (Extra to dodatkowe informacje, kt贸rych oczekuje zamiar).

Ten zamiar powinien by zadeklarowany wewntrz manifestu, jak w poni偶szym przykadzie:
```xml
<activity android:name="ShareActivity">
<intent-filter>
<action android:name="android.intent.action.SEND" />
<category android:name="android.intent.category.DEFAULT" />
</intent-filter>
</activity>
```
Intent-filter musi pasowa do **dziaania**, **danych** i **kategorii**, aby otrzyma wiadomo.

Proces "Rozstrzygania intencji" okrela, kt贸ra aplikacja powinna otrzyma ka偶d wiadomo. Proces ten uwzgldnia atrybut **priorytetu**, kt贸ry mo偶e by ustawiony w deklaracji **intent-filter**, a **ten z wy偶szym priorytetem zostanie wybrany**. Priorytet ten mo偶na ustawi midzy -1000 a 1000, a aplikacje mog u偶ywa wartoci `SYSTEM_HIGH_PRIORITY`. Jeli **wystpi konflikt**, pojawia si okno "wyboru", dziki czemu **u偶ytkownik mo偶e zdecydowa**.

### Jawne intencje

Jawna intencja okrela nazw klasy, do kt贸rej jest kierowana:
```java
Intent downloadIntent = new (this, DownloadService.class):
```
W innych aplikacjach, aby uzyska dostp do wczeniej zadeklarowanego zamiaru, mo偶na u偶y:
```java
Intent intent = new Intent();
intent.setClassName("com.other.app", "com.other.app.ServiceName");
context.startService(intent);
```
### Intencje oczekujce

Pozwalaj innym aplikacjom **wykonywa czynnoci w imieniu Twojej aplikacji**, korzystajc z to偶samoci i uprawnie Twojej aplikacji. Konstruujc Intencj oczekujc, nale偶y **okreli intencj i akcj do wykonania**. Jeli **zadeklarowana intencja nie jest jawna** (nie okrela, kt贸ra intencja mo偶e j wywoa), **zoliwa aplikacja mo偶e wykona zadeklarowan akcj** w imieniu aplikacji ofiary. Ponadto, **jeli akcja nie jest okrelona**, zoliwa aplikacja bdzie moga wykona **dowoln akcj w imieniu ofiary**.

### Intencje rozgoszeniowe

W przeciwiestwie do poprzednich intencji, kt贸re s odbierane tylko przez jedn aplikacj, intencje rozgoszeniowe **mog by odbierane przez wiele aplikacji**. Jednak偶e, poczwszy od wersji API 14, jest **mo偶liwe okrelenie aplikacji, kt贸ra powinna otrzyma** wiadomo, korzystajc z Intent.set Package.

Alternatywnie, jest r贸wnie偶 mo偶liwe **okrelenie uprawnienia podczas wysyania rozgoszenia**. Aplikacja odbiorcza bdzie musiaa posiada to uprawnienie.

Istniej **dwa rodzaje** rozgosze: **Normalne** (asynchroniczne) i **Uporzdkowane** (synchroniczne). **Kolejno** jest ustalana na podstawie **skonfigurowanego priorytetu w elemencie odbiorcy**. **Ka偶da aplikacja mo偶e przetwarza, przekazywa lub odrzuca rozgoszenie**.

Mo偶liwe jest **wysanie** rozgoszenia za pomoc funkcji `sendBroadcast(intent, receiverPermission)` z klasy `Context`.\
Mo偶na r贸wnie偶 u偶y funkcji **`sendBroadcast`** z **`LocalBroadCastManager`**, co zapewnia, 偶e **wiadomo nigdy nie opuci aplikacji**. Dziki temu nie bdzie nawet konieczne eksportowanie komponentu odbiorcy.

### Rozgoszenia trwae

Ten rodzaj rozgosze **mo偶e by dostpny dugo po ich wysaniu**.\
Zostay one oznaczone jako przestarzae w poziomie API 21 i zaleca si **nie korzystanie z nich**.\
**Pozwalaj one dowolnej aplikacji na podsuchanie danych, ale tak偶e na ich modyfikacj**.

Jeli znajdziesz funkcje zawierajce sowo "trwae" jak **`sendStickyBroadcast`** lub **`sendStickyBroadcastAsUser`**, **sprawd藕 wpyw i spr贸buj je usun**.

## Gbokie linki / schematy URL

W aplikacjach Androida, **gbokie linki** s u偶ywane do uruchamiania akcji (Intencji) bezporednio za pomoc adresu URL. Jest to realizowane poprzez zadeklarowanie okrelonego **schematu URL** wewntrz aktywnoci. Gdy urzdzenie z systemem Android pr贸buje **uzyska dostp do adresu URL z tym schematem**, uruchamiana jest okrelona aktywno w aplikacji.

Schemat musi by zadeklarowany w pliku **`AndroidManifest.xml`**:
```xml
[...]
<activity android:name=".MyActivity">
<intent-filter>
<action android:name="android.intent.action.VIEW" />
<category android:name="android.intent.category.DEFAULT" />
<category android:name="android.intent.category.BROWSABLE" />
<data android:scheme="examplescheme" />
</intent-filter>
[...]
```
Schemat z poprzedniego przykadu to `exampleapp://` (zauwa偶 r贸wnie偶 **`kategoria BROWSABLE`**)

Nastpnie, w polu danych, mo偶esz okreli **host** i **cie偶k**:
```xml
<data android:scheme="examplescheme"
android:host="example"
/>
```
Aby uzyska do niego dostp z sieci, mo偶na ustawi link w ten spos贸b:
```xml
<a href="examplescheme://example/something">click here</a>
<a href="examplescheme://example/javascript://%250dalert(1)">click here</a>
```
Aby znale藕 **kod, kt贸ry zostanie wykonany w aplikacji**, przejd藕 do aktywnoci wywoanej przez deeplink i wyszukaj funkcj **`onNewIntent`**.

Dowiedz si, jak [wywoywa gbokie linki bez u偶ycia stron HTML](./#exploiting-schemes-deep-links).

## AIDL - Android Interface Definition Language

**Android Interface Definition Language (AIDL)** zosta zaprojektowany w celu uatwienia komunikacji midzy klientem a usug w aplikacjach Android za pomoc **komunikacji midzyprocesowej** (IPC). Poniewa偶 bezporedni dostp do pamici innego procesu nie jest dozwolony w systemie Android, AIDL upraszcza proces poprzez marshaling obiekt贸w do formatu zrozumiaego przez system operacyjny, uatwiajc tym samym komunikacj midzy r贸偶nymi procesami.

### Kluczowe koncepcje

- **Usugi powizane**: Te usugi wykorzystuj AIDL do IPC, umo偶liwiajc aktywnociom lub komponentom powizanie si z usug, skadanie 偶da i odbieranie odpowiedzi. Metoda `onBind` w klasie usugi jest kluczowa dla inicjowania interakcji, co czyni j istotnym obszarem do przegldu pod ktem bezpieczestwa w poszukiwaniu podatnoci.

- **Messenger**: Dziaajc jako usuga powizana, Messenger uatwia IPC z naciskiem na przetwarzanie danych za pomoc metody `onBind`. Istotne jest dokadne sprawdzenie tej metody pod ktem niebezpiecznego przetwarzania danych lub wykonywania funkcji wymagajcych ochrony.

- **Binder**: Chocia偶 bezporednie u偶ycie klasy Binder jest mniej powszechne ze wzgldu na abstrakcj AIDL, warto zrozumie, 偶e Binder dziaa jako sterownik na poziomie jdra uatwiajcy transfer danych midzy przestrzeniami pamici r贸偶nych proces贸w. Dla lepszego zrozumienia dostpny jest zas贸b pod adresem [https://www.youtube.com/watch?v=O-UHvFjxwZ8](https://www.youtube.com/watch?v=O-UHvFjxwZ8).

## Komponenty

Obejmuj one: **Aktywnoci, Usugi, Odbiorniki nadawcze i Dostawcy.**

### Aktywno uruchamiajca i inne aktywnoci

W aplikacjach Android **aktywnoci** s jak ekrany, prezentujce r贸偶ne czci interfejsu u偶ytkownika aplikacji. Aplikacja mo偶e mie wiele aktywnoci, z kt贸rych ka偶da prezentuje u偶ytkownikowi unikalny ekran.

**Aktywno uruchamiajca** jest g贸wnym wejciem do aplikacji, uruchamianym po naciniciu ikony aplikacji. Jest zdefiniowana w pliku manifestu aplikacji za pomoc konkretnych intencji MAIN i LAUNCHER:
```markup
<activity android:name=".LauncherActivity">
<intent-filter>
<action android:name="android.intent.action.MAIN" />
<category android:name="android.intent.category.LAUNCHER" />
</intent-filter>
</activity>
```
Nie wszystkie aplikacje potrzebuj aktywnoci uruchomieniowej, zwaszcza te bez interfejsu u偶ytkownika, takie jak usugi w tle.

Aby udostpni aktywnoci innym aplikacjom lub procesom, mo偶na oznaczy je jako "eksportowane" w pliku manifestu. Ta opcja pozwala innym aplikacjom uruchamia t aktywno:
```markdown
<service android:name=".ExampleExportedService" android:exported="true"/>
```
Jednak偶e dostp do aktywnoci z innej aplikacji nie zawsze stanowi ryzyko dla bezpieczestwa. Obawa pojawia si, jeli poufne dane s udostpniane nieprawidowo, co mo偶e prowadzi do wycieku informacji.

Cykl 偶ycia aktywnoci **rozpoczyna si od metody onCreate**, kt贸ra ustawia interfejs u偶ytkownika i przygotowuje aktywno do interakcji z u偶ytkownikiem.

### Podklasa aplikacji

W rozwoju aplikacji na Androida, aplikacja ma opcj utworzenia **podklasy** klasy [Application](https://developer.android.com/reference/android/app/Application), chocia偶 nie jest to obowizkowe. Gdy taka podklasa jest zdefiniowana, staje si pierwsz klas do zainicjowania w aplikacji. Metoda **`attachBaseContext`**, jeli zaimplementowana w tej podklasie, jest wykonywana przed metod **`onCreate`**. To ustawienie pozwala na wczesn inicjalizacj przed uruchomieniem reszty aplikacji.
```java
public class MyApp extends Application {
@Override
protected void attachBaseContext(Context base) {
super.attachBaseContext(base);
// Initialization code here
}

@Override
public void onCreate() {
super.onCreate();
// More initialization code
}
}
```
### Usugi

[Usugi](https://developer.android.com/guide/components/services) to **operacje w tle** zdolne do wykonywania zada bez interfejsu u偶ytkownika. Te zadania mog kontynuowa dziaanie nawet gdy u偶ytkownicy przeczaj si na inne aplikacje, co czyni usugi niezbdnymi do **dugotrwaych operacji**.

Usugi s wszechstronne; mog by uruchamiane na r贸偶ne sposoby, przy u偶yciu **Intents** jako g贸wnego sposobu uruchamiania jako punktu wejcia aplikacji. Gdy usuga zostanie uruchomiona za pomoc metody `startService`, jej metoda `onStart` rozpoczyna dziaanie i dziaa do momentu wywoania metody `stopService`. Alternatywnie, jeli rola usugi zale偶y od aktywnego poczenia klienta, u偶ywana jest metoda `bindService` do powizania klienta z usug, wywoujc metod `onBind` do przekazywania danych.

Interesujcym zastosowaniem usug jest odtwarzanie muzyki w tle lub pobieranie danych z sieci bez zak贸cania interakcji u偶ytkownika z aplikacj. Ponadto, usugi mog by udostpnione innym procesom na tym samym urzdzeniu poprzez **eksportowanie**. To nie jest zachowanie domylne i wymaga jawnego skonfigurowania w pliku Android Manifest:
```xml
<service android:name=".ExampleExportedService" android:exported="true"/>
```
### Odbiorniki nadawcze

**Odbiorniki nadawcze** dziaaj jako suchacze w systemie komunikacyjnym, pozwalajc wielu aplikacjom reagowa na te same wiadomoci z systemu. Aplikacja mo偶e **zarejestrowa odbiornik** na **dwa podstawowe sposoby**: poprzez **Manifest** aplikacji lub **dynamicznie** w kodzie aplikacji za pomoc interfejsu API **`registerReceiver`**. W przypadku Manifestu, nadawane s filtrowane z uprawnieniami, podczas gdy dynamicznie zarejestrowane odbiorniki mog r贸wnie偶 okreli uprawnienia podczas rejestracji.

**Filtry intencji** s kluczowe w obu metodach rejestracji, okrelajc, kt贸re nadawane s wyzwalane przez odbiornik. Po wysaniu pasujcego nadawania, metoda **`onReceive`** odbiornika jest wywoywana, umo偶liwiajc aplikacji reagowanie odpowiednio, na przykad dostosowanie zachowania w odpowiedzi na alert o niskim poziomie baterii.

Nadawania mog by albo **asynchroniczne**, docierajc do wszystkich odbiornik贸w bez kolejnoci, albo **synchroniczne**, gdzie odbiorniki otrzymuj nadawanie na podstawie ustawionych priorytet贸w. Jednak wa偶ne jest zauwa偶enie potencjalnego ryzyka bezpieczestwa, poniewa偶 dowolna aplikacja mo偶e nada sobie priorytet, aby przechwyci nadawanie.

Aby zrozumie funkcjonalno odbiornika, nale偶y szuka metody **`onReceive`** wewntrz jego klasy. Kod tej metody mo偶e manipulowa otrzyman intencj, podkrelajc potrzeb walidacji danych przez odbiorniki, zwaszcza w przypadku **Nadawa uporzdkowanych**, kt贸re mog modyfikowa lub odrzuca intencj.

### Dostawca treci

**Dostawcy treci** s niezbdne do **udostpniania strukturyzowanych danych** midzy aplikacjami, podkrelajc znaczenie implementacji **uprawnie** w celu zapewnienia bezpieczestwa danych. Pozwalaj aplikacjom uzyskiwa dostp do danych z r贸偶nych 藕r贸de, w tym baz danych, system贸w plik贸w lub sieci. Okrelone uprawnienia, takie jak **`readPermission`** i **`writePermission`**, s kluczowe dla kontroli dostpu. Dodatkowo, tymczasowy dostp mo偶na udzieli za pomoc ustawie **`grantUriPermission`** w manifestacji aplikacji, wykorzystujc atrybuty takie jak `path`, `pathPrefix` i `pathPattern` do szczeg贸owej kontroli dostpu.

Walidacja danych jest kluczowa dla zapobiegania podatnociom, takim jak wstrzyknicie SQL. Dostawcy treci obsuguj podstawowe operacje: `insert()`, `update()`, `delete()` i `query()`, uatwiajc manipulacj danymi i ich udostpnianie midzy aplikacjami.

**FileProvider**, specjalizowany dostawca treci, skupia si na bezpiecznym udostpnianiu plik贸w. Jest zdefiniowany w manifestacji aplikacji z okrelonymi atrybutami do kontroli dostpu do folder贸w, oznaczonych przez `android:exported` i `android:resource` wskazujce na konfiguracje folder贸w. Zaleca si ostro偶no podczas udostpniania katalog贸w, aby unikn przypadkowego ujawnienia wra偶liwych danych.

Przykadowe owiadczenie manifestu dla FileProvider:
```xml
<provider android:name="androidx.core.content.FileProvider"
android:authorities="com.example.myapp.fileprovider"
android:grantUriPermissions="true"
android:exported="false">
<meta-data android:name="android.support.FILE_PROVIDER_PATHS"
android:resource="@xml/filepaths" />
</provider>
```
I przykad okrelenia wsp贸dzielonych folder贸w w `filepaths.xml`:
```xml
<paths>
<files-path path="images/" name="myimages" />
</paths>
```
Dla dalszych informacji sprawd藕:
- [Deweloperzy Androida: Dostawcy treci](https://developer.android.com/guide/topics/providers/content-providers)
- [Deweloperzy Androida: FileProvider](https://developer.android.com/training/secure-file-sharing/setup-sharing)

## WebViews

WebViews s jak **mini przegldarki internetowe** wewntrz aplikacji na Androida, pobierajce treci z sieci lub z plik贸w lokalnych. Stoj w obliczu podobnych zagro偶e jak zwyke przegldarki, ale istniej sposoby na **zmniejszenie tych zagro偶e** poprzez konkretne **ustawienia**.

Android oferuje dwa g贸wne typy WebView:

- **WebViewClient** jest wietny do podstawowego HTML, ale nie obsuguje funkcji alert JavaScript, co wpywa na spos贸b testowania atak贸w XSS.
- **WebChromeClient** dziaa bardziej jak pene dowiadczenie przegldarki Chrome.

Kluczowym punktem jest to, 偶e przegldarki WebView **nie dziel plik贸w cookie** z g贸wn przegldark urzdzenia.

Do adowania treci dostpne s metody takie jak ````loadUrl````, ````loadData````, i ````loadDataWithBaseURL````. Wa偶ne jest, aby upewni si, 偶e te adresy URL lub pliki s **bezpieczne do u偶ycia**. Ustawienia zabezpiecze mo偶na zarzdza za pomoc klasy ````WebSettings````. Na przykad, wyczenie JavaScript za pomoc ````setJavaScriptEnabled(false)```` mo偶e zapobiec atakom XSS.

Most JavaScript "Bridge" pozwala obiektom Javy wsp贸dziaa z JavaScript, wymagajc oznaczenia metod za pomoc ````@JavascriptInterface```` dla bezpieczestwa od wersji Androida 4.2.

Zezwalanie na dostp do treci (````setAllowContentAccess(true)````) pozwala WebView na dostp do dostawc贸w treci, co mo偶e stanowi ryzyko, chyba 偶e adresy URL treci s zweryfikowane jako bezpieczne.

Aby kontrolowa dostp do plik贸w:
- Wyczenie dostpu do plik贸w (````setAllowFileAccess(false)````) ogranicza dostp do systemu plik贸w, z wyjtkami dla okrelonych zasob贸w, zapewniajc, 偶e s one u偶ywane tylko do treci niewra偶liwej.

## Inne skadniki aplikacji i zarzdzanie urzdzeniami mobilnymi

### **Cyfrowe podpisywanie aplikacji**

- **Cyfrowe podpisywanie** jest konieczne dla aplikacji na Androida, zapewniajc, 偶e s **autentycznie autoryzowane** przed instalacj. Proces ten wykorzystuje certyfikat do identyfikacji aplikacji i musi zosta zweryfikowany przez mened偶era pakiet贸w urzdzenia podczas instalacji. Aplikacje mog by **podpisane przez siebie lub certyfikowane przez zewntrzne CA**, chronic przed nieautoryzowanym dostpem i zapewniajc, 偶e aplikacja pozostaje nietknita podczas dostarczania na urzdzenie.

### **Weryfikacja aplikacji dla zwikszonego bezpieczestwa**

- Poczwszy od **Androida 4.2**, funkcja o nazwie **Weryfikuj aplikacje** pozwala u偶ytkownikom sprawdza aplikacje pod ktem bezpieczestwa przed instalacj. Ten **proces weryfikacji** mo偶e ostrzega u偶ytkownik贸w przed potencjalnie szkodliwymi aplikacjami lub nawet uniemo偶liwia instalacj szczeg贸lnie zoliwych, zwikszajc bezpieczestwo u偶ytkownika.

### **Zarzdzanie urzdzeniami mobilnymi (MDM)**

- **Rozwizania MDM** zapewniaj **nadz贸r i bezpieczestwo** dla urzdze mobilnych za pomoc **API Administracji urzdze**. Wymagaj one instalacji aplikacji na Androida do skutecznego zarzdzania i zabezpieczania urzdze mobilnych. Kluczowe funkcje obejmuj **narzucanie polityk hase**, **obowizkowe szyfrowanie pamici**, i **zezwolenie na zdalne wymazywanie danych**, zapewniajc kompleksow kontrol i bezpieczestwo nad urzdzeniami mobilnymi.
```java
// Example of enforcing a password policy with MDM
DevicePolicyManager dpm = (DevicePolicyManager) getSystemService(Context.DEVICE_POLICY_SERVICE);
ComponentName adminComponent = new ComponentName(context, AdminReceiver.class);

if (dpm.isAdminActive(adminComponent)) {
// Set minimum password length
dpm.setPasswordMinimumLength(adminComponent, 8);
}
```
**Grupa Try Hard Security**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>Zdobd藕 wiedz na temat hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
