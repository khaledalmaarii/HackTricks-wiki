# Android Task Hijacking

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## Aufgabe, Back Stack und Vordergrundaktivit√§ten

In Android ist eine **Aufgabe** im Wesentlichen eine Reihe von Aktivit√§ten, mit denen Benutzer interagieren, um eine bestimmte Aufgabe abzuschlie√üen, organisiert innerhalb eines **Back Stacks**. Dieser Stack ordnet Aktivit√§ten basierend darauf, wann sie ge√∂ffnet wurden, wobei die aktuellste Aktivit√§t oben als **Vordergrundaktivit√§t** angezeigt wird. Zu jedem Zeitpunkt ist nur diese Aktivit√§t auf dem Bildschirm sichtbar, was sie Teil der **Vordergrundaufgabe** macht.

Hier ist eine kurze √úbersicht √ºber Aktivit√§ts√ºberg√§nge:

* **Aktivit√§t 1** beginnt als einzige Aktivit√§t im Vordergrund.
* Das Starten von **Aktivit√§t 2** schiebt **Aktivit√§t 1** in den Back Stack und bringt **Aktivit√§t 2** in den Vordergrund.
* Das Starten von **Aktivit√§t 3** verschiebt **Aktivit√§t 1** und **Aktivit√§t 2** weiter nach hinten im Stack, wobei **Aktivit√§t 3** jetzt vorne ist.
* Das Schlie√üen von **Aktivit√§t 3** bringt **Aktivit√§t 2** zur√ºck in den Vordergrund und zeigt das optimierte Navigationsmechanismus von Android.

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (698).png>)

## Task Affinity Angriff

### √úbersicht √ºber Task Affinity und Startmodi

In Android-Anwendungen gibt **Task Affinity** an, welche Aufgabe eine Aktivit√§t bevorzugt, typischerweise in √úbereinstimmung mit dem Paketnamen der App. Diese Einrichtung ist entscheidend f√ºr die Erstellung einer Proof-of-Concept (PoC) App zur Demonstration des Angriffs.

### Startmodi

Das Attribut `launchMode` steuert die Handhabung von Aktivit√§tsinstanzen innerhalb von Aufgaben. Der **singleTask** Modus ist entscheidend f√ºr diesen Angriff und diktiert drei Szenarien basierend auf den vorhandenen Aktivit√§tsinstanzen und √úbereinstimmungen der Task Affinity. Der Exploit beruht auf der F√§higkeit der App des Angreifers, die Task Affinity der Ziel-App zu imitieren, wodurch das Android-System in die Irre gef√ºhrt wird, die App des Angreifers anstelle der beabsichtigten Ziel-App zu starten.

### Detaillierte Angriffs Schritte

1. **Installation der b√∂sartigen App**: Das Opfer installiert die App des Angreifers auf seinem Ger√§t.
2. **Erste Aktivierung**: Das Opfer √∂ffnet zuerst die b√∂sartige App und bereitet das Ger√§t f√ºr den Angriff vor.
3. **Versuch, die Ziel-App zu starten**: Das Opfer versucht, die Ziel-App zu √∂ffnen.
4. **Ausf√ºhrung der Hijack**: Aufgrund der √ºbereinstimmenden Task Affinity wird die b√∂sartige App anstelle der Ziel-App gestartet.
5. **T√§uschung**: Die b√∂sartige App zeigt einen gef√§lschten Anmeldebildschirm, der der Ziel-App √§hnelt, und t√§uscht den Benutzer, sensible Informationen einzugeben.

F√ºr eine praktische Umsetzung dieses Angriffs verweisen Sie auf das Task Hijacking Strandhogg Repository auf GitHub: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### Pr√§ventionsma√ünahmen

Um solche Angriffe zu verhindern, k√∂nnen Entwickler `taskAffinity` auf einen leeren String setzen und den `singleInstance` Startmodus w√§hlen, um die Isolation ihrer App von anderen zu gew√§hrleisten. Die Anpassung der Funktion `onBackPressed()` bietet zus√§tzlichen Schutz gegen Task Hijacking.

## **Referenzen**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
