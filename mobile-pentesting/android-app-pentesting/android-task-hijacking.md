<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


# TÃ¢che, pile arriÃ¨re et activitÃ©s en premier plan

Une tÃ¢che est une collection d'activitÃ©s avec lesquelles les utilisateurs interagissent lorsqu'ils effectuent une certaine tÃ¢che. Les activitÃ©s sont organisÃ©es dans une pile - la _**pile arriÃ¨re**_ - dans l'ordre dans lequel chaque activitÃ© est ouverte.

L'activitÃ© qui est **affichÃ©e** Ã  l'Ã©cran est appelÃ©e une **activitÃ© en premier plan** et sa **tÃ¢che** est appelÃ©e la **tÃ¢che en premier plan**. Ã€ un moment donnÃ©, **une seule tÃ¢che en premier plan est visible Ã  l'Ã©cran**.

Voici un flux d'activitÃ© simple :

* Il n'y a que l'activitÃ© 1 en premier plan.
* L'activitÃ© 2 est dÃ©marrÃ©e, ce qui pousse l'activitÃ© 1 vers la pile arriÃ¨re. Maintenant, l'activitÃ© 2 est en premier plan.
* L'activitÃ© 3 est dÃ©marrÃ©e, ce qui pousse les activitÃ©s 1 et 2 vers la pile arriÃ¨re.
* Maintenant, lorsque l'activitÃ© 3 est fermÃ©e, l'activitÃ© prÃ©cÃ©dente, c'est-Ã -dire 2, est automatiquement ramenÃ©e en premier plan. C'est ainsi que fonctionne la navigation des tÃ¢ches dans Android.

![](<../../.gitbook/assets/image (548).png>)

## MultitÃ¢che Android - Une tÃ¢che

Une tÃ¢che est composÃ©e de plusieurs activitÃ©s

![](<../../.gitbook/assets/image (549).png>)

## MultitÃ¢che Android - Plusieurs tÃ¢ches

Android gÃ¨re gÃ©nÃ©ralement plusieurs tÃ¢ches

![](<../../.gitbook/assets/image (550).png>)

# Boutons de contrÃ´le de tÃ¢che

![](<../../.gitbook/assets/image (551).png>)

# Attaque d'affinitÃ© de tÃ¢che

## AffinitÃ© de tÃ¢che et modes de lancement

L'**affinitÃ© de tÃ¢che** est un attribut dÃ©fini dans chaque balise `<activity>` dans le fichier `AndroidManifest.xml`. Il dÃ©crit Ã  quelle tÃ¢che une activitÃ© prÃ©fÃ¨re se joindre.\
Par dÃ©faut, chaque activitÃ© a la mÃªme affinitÃ© que le nom du **package**.

Nous utiliserons cela lors de la crÃ©ation de notre application PoC.
```markup
<activity android:taskAffinity=""/>
```
Les **modes de lancement** vous permettent de dÃ©finir comment une nouvelle instance d'une activitÃ© est associÃ©e Ã  la tÃ¢che en cours. L'attribut [`launchMode`](https://developer.android.com/guide/topics/manifest/activity-element#lmode) spÃ©cifie une instruction sur la faÃ§on dont l'activitÃ© doit Ãªtre lancÃ©e dans une tÃ¢che.\
Il existe quatre **modes de lancement** diffÃ©rents :

1. standard (par dÃ©faut)
2. singleTop
3. **singleTask**
4. singleInstance

Lorsque le mode de lancement est dÃ©fini sur `singleTask`, le systÃ¨me Android Ã©value trois possibilitÃ©s et l'une d'entre elles est la raison pour laquelle notre attaque est possible. Les voici :

* **Si l'instance de l'activitÃ© existe dÃ©jÃ ** :\
  Android reprend l'instance existante au lieu d'en crÃ©er une nouvelle. Cela signifie qu'il y a au plus une instance d'activitÃ© dans le systÃ¨me sous ce mode.
* **Si la crÃ©ation d'une nouvelle instance d'activitÃ© est nÃ©cessaire** :\
  Le service de gestionnaire d'activitÃ© (AMS) sÃ©lectionne une tÃ¢che pour hÃ©berger la nouvelle instance crÃ©Ã©e en trouvant une tÃ¢che Â« **correspondante** Â» dans toutes les tÃ¢ches existantes. **Une activitÃ© Â« correspond Â» Ã  une tÃ¢che si elles ont la mÃªme affinitÃ© de tÃ¢che**. C'est la raison pour laquelle nous pouvons **spÃ©cifier la mÃªme affinitÃ© de tÃ¢che que l'application vulnÃ©rable dans notre application malveillante/attaquante afin qu'elle se lance dans leur tÃ¢che au lieu de crÃ©er la sienne**.
* **Sans trouver de tÃ¢che Â« correspondante Â»** :\
  L'AMS crÃ©e une nouvelle tÃ¢che et fait de la nouvelle instance d'activitÃ© l'activitÃ© racine de la tÃ¢che nouvellement crÃ©Ã©e.

## Attaque

La victime doit avoir l'**application malveillante** **installÃ©e** sur son appareil. Ensuite, il doit **l'ouvrir** **avant** d'ouvrir l'**application vulnÃ©rable**. Ensuite, lorsque l'**application vulnÃ©rable** est **ouverte**, l'**application malveillante** sera **ouverte** **Ã  la place**. Si cette application malveillante prÃ©sente le **mÃªme** **login** que l'application vulnÃ©rable, **l'utilisateur n'aura aucun moyen de savoir qu'il saisit ses informations d'identification dans une application malveillante**.

**Vous pouvez trouver une attaque mise en Å“uvre ici :** [**https://github.com/az0mb13/Task\_Hijacking\_Strandhogg**](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg)

# PrÃ©vention du dÃ©tournement de tÃ¢ches

DÃ©finir `taskAffinity=""` peut Ãªtre une solution rapide Ã  ce problÃ¨me. Le mode de lancement peut Ã©galement Ãªtre dÃ©fini sur **singleInstance** si l'application ne veut pas que d'autres activitÃ©s rejoignent les tÃ¢ches qui lui appartiennent. Une fonction personnalisÃ©e **onBackPressed()** peut Ã©galement Ãªtre ajoutÃ©e pour remplacer le comportement par dÃ©faut.

# **RÃ©fÃ©rences**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au repo [hacktricks](https://github.com/carlospolop/hacktricks) et [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
