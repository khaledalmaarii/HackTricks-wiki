# Android Task Hijacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## Zadanie, Stos Wsteczny i Aktywnoci na Pierwszym Planie

W Androidzie, **zadanie** to zasadniczo zestaw aktywnoci, z kt贸rymi u偶ytkownicy wchodz w interakcj, aby wykona okrelone zadanie, zorganizowane w **stosie wstecznym**. Stos ten porzdkuje aktywnoci na podstawie momentu ich otwarcia, z najnowsz aktywnoci wywietlan na g贸rze jako **aktywno na pierwszym planie**. W ka偶dej chwili tylko ta aktywno jest widoczna na ekranie, co czyni j czci **zadania na pierwszym planie**.

Oto szybkie podsumowanie przej midzy aktywnociami:

* **Aktywno 1** zaczyna jako jedyna aktywno na pierwszym planie.
* Uruchomienie **Aktywnoci 2** przesuwa **Aktywno 1** do stosu wstecznego, przynoszc **Aktywno 2** na pierwszy plan.
* Rozpoczcie **Aktywnoci 3** przesuwa **Aktywno 1** i **Aktywno 2** dalej w stosie, z **Aktywnoci 3** teraz na przodzie.
* Zamknicie **Aktywnoci 3** przywraca **Aktywno 2** na pierwszy plan, pokazujc uproszczony mechanizm nawigacji zada w Androidzie.

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (698).png>)

## Atak na afinity zadania

### Przegld afinity zadania i tryb贸w uruchamiania

W aplikacjach Android, **afinity zadania** okrela preferowane zadanie dla aktywnoci, zazwyczaj zgodne z nazw pakietu aplikacji. Ta konfiguracja jest kluczowa w tworzeniu aplikacji dowodowej (PoC) do demonstrowania ataku.

### Tryby uruchamiania

Atrybut `launchMode` kieruje obsug instancji aktywnoci w ramach zada. Tryb **singleTask** jest kluczowy dla tego ataku, dyktujc trzy scenariusze w oparciu o istniejce instancje aktywnoci i dopasowania afinity zadania. Wykorzystanie opiera si na zdolnoci aplikacji atakujcego do naladowania afinity zadania aplikacji docelowej, wprowadzajc system Android w bd, aby uruchomi aplikacj atakujcego zamiast zamierzonej aplikacji docelowej.

### Szczeg贸owe kroki ataku

1. **Instalacja zoliwej aplikacji**: Ofiara instaluje aplikacj atakujcego na swoim urzdzeniu.
2. **Pocztkowa aktywacja**: Ofiara najpierw otwiera zoliw aplikacj, przygotowujc urzdzenie do ataku.
3. **Pr贸ba uruchomienia aplikacji docelowej**: Ofiara pr贸buje otworzy aplikacj docelow.
4. **Wykonanie przejcia**: Z powodu dopasowanej afinity zadania, zoliwa aplikacja jest uruchamiana zamiast aplikacji docelowej.
5. **Oszustwo**: Zoliwa aplikacja wywietla faszywy ekran logowania przypominajcy aplikacj docelow, oszukujc u偶ytkownika, aby wprowadzi wra偶liwe informacje.

Aby uzyska praktyczn implementacj tego ataku, zapoznaj si z repozytorium Task Hijacking Strandhogg na GitHubie: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### rodki zapobiegawcze

Aby zapobiec takim atakom, deweloperzy mog ustawi `taskAffinity` na pusty cig i wybra tryb uruchamiania `singleInstance`, zapewniajc izolacj ich aplikacji od innych. Dostosowanie funkcji `onBackPressed()` oferuje dodatkow ochron przed przejciem zada.

## **Referencje**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
