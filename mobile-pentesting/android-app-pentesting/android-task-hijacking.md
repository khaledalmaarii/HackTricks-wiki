# Android Task Hijacking

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## Task, Back Stack i Foreground Activities

U Androidu, **task** je u suÅ¡tini skup aktivnosti sa kojima korisnici interaguju da bi zavrÅ¡ili odreÄ‘eni posao, organizovan unutar **back stack**. Ova stek organizuje aktivnosti na osnovu vremena kada su otvorene, pri Äemu je najnovija aktivnost prikazana na vrhu kao **foreground activity**. U bilo kojem trenutku, samo je ova aktivnost vidljiva na ekranu, ÄineÄ‡i je delom **foreground task**.

Evo brzog pregleda prelaza izmeÄ‘u aktivnosti:

* **Activity 1** poÄinje kao jedina aktivnost u foreground-u.
* Pokretanje **Activity 2** pomera **Activity 1** u back stack, dovodeÄ‡i **Activity 2** u foreground.
* Pokretanje **Activity 3** pomera **Activity 1** i **Activity 2** dalje nazad u steku, pri Äemu je **Activity 3** sada ispred.
* Zatvaranje **Activity 3** vraÄ‡a **Activity 2** nazad u foreground, prikazujuÄ‡i Androidov pojednostavljeni mehanizam navigacije kroz zadatke.

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (698).png>)

## Napad na task affinity

### Pregled Task Affinity i Launch Modes

U Android aplikacijama, **task affinity** specificira preferirani task aktivnosti, obiÄno usklaÄ‘en sa imenom paketa aplikacije. Ova postavka je kljuÄna za kreiranje aplikacije za dokazivanje koncepta (PoC) za demonstraciju napada.

### Launch Modes

Atribut `launchMode` usmerava rukovanje instancama aktivnosti unutar zadataka. **singleTask** reÅ¾im je kljuÄan za ovaj napad, odreÄ‘ujuÄ‡i tri scenarija na osnovu postojeÄ‡ih instanci aktivnosti i podudaranja task affinity. Eksploatacija se oslanja na sposobnost napadaÄeve aplikacije da imitira task affinity ciljne aplikacije, obmanjujuÄ‡i Android sistem da pokrene napadaÄevu aplikaciju umesto nameravane mete.

### Detaljni koraci napada

1. **Instalacija zlonamerne aplikacije**: Å½rtva instalira napadaÄevu aplikaciju na svom ureÄ‘aju.
2. **Prva aktivacija**: Å½rtva prvo otvara zlonamernu aplikaciju, pripremajuÄ‡i ureÄ‘aj za napad.
3. **PokuÅ¡aj pokretanja ciljne aplikacije**: Å½rtva pokuÅ¡ava da otvori ciljnu aplikaciju.
4. **IzvrÅ¡enje otmice**: Zbog podudaranja task affinity, zlonamerna aplikacija se pokreÄ‡e umesto ciljne aplikacije.
5. **Obmana**: Zlonamerna aplikacija prikazuje laÅ¾ni ekran za prijavu koji podseÄ‡a na ciljnu aplikaciju, obmanjujuÄ‡i korisnika da unese osetljive informacije.

Za praktiÄnu implementaciju ovog napada, pogledajte Task Hijacking Strandhogg repozitorijum na GitHub-u: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### Mere prevencije

Da bi se spreÄili ovakvi napadi, programeri mogu postaviti `taskAffinity` na prazan string i odabrati `singleInstance` reÅ¾im pokretanja, osiguravajuÄ‡i izolaciju svoje aplikacije od drugih. PrilagoÄ‘avanje funkcije `onBackPressed()` pruÅ¾a dodatnu zaÅ¡titu protiv otmice zadataka.

## **Reference**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
