# Android Task Hijacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Task, Back Stack and Foreground Activities

ì•ˆë“œë¡œì´ë“œì—ì„œ **task**ëŠ” ì‚¬ìš©ìê°€ íŠ¹ì • ì‘ì—…ì„ ì™„ë£Œí•˜ê¸° ìœ„í•´ ìƒí˜¸ì‘ìš©í•˜ëŠ” í™œë™ì˜ ì§‘í•©ìœ¼ë¡œ, **back stack** ë‚´ì— ì¡°ì§ë©ë‹ˆë‹¤. ì´ ìŠ¤íƒì€ í™œë™ì´ ì—´ë¦° ìˆœì„œì— ë”°ë¼ í™œë™ì„ ì •ë ¬í•˜ë©°, ê°€ì¥ ìµœê·¼ì˜ í™œë™ì´ ê°€ì¥ ìœ„ì— í‘œì‹œë˜ì–´ **foreground activity**ê°€ ë©ë‹ˆë‹¤. ì–¸ì œë“ ì§€ ì´ í™œë™ë§Œ í™”ë©´ì— í‘œì‹œë˜ì–´ **foreground task**ì˜ ì¼ë¶€ê°€ ë©ë‹ˆë‹¤.

í™œë™ ì „í™˜ì— ëŒ€í•œ ê°„ë‹¨í•œ ìš”ì•½ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* **Activity 1**ì€ ì „ë©´ì—ì„œ ìœ ì¼í•œ í™œë™ìœ¼ë¡œ ì‹œì‘ë©ë‹ˆë‹¤.
* **Activity 2**ë¥¼ ì‹œì‘í•˜ë©´ **Activity 1**ì´ ë°± ìŠ¤íƒìœ¼ë¡œ ë°€ë ¤ë‚˜ê³ , **Activity 2**ê°€ ì „ë©´ìœ¼ë¡œ ë‚˜ì˜µë‹ˆë‹¤.
* **Activity 3**ì„ ì‹œì‘í•˜ë©´ **Activity 1**ê³¼ **Activity 2**ê°€ ìŠ¤íƒì—ì„œ ë” ë’¤ë¡œ ë°€ë ¤ë‚˜ê³ , **Activity 3**ì´ ì´ì œ ì•ì— ìœ„ì¹˜í•©ë‹ˆë‹¤.
* **Activity 3**ì„ ë‹«ìœ¼ë©´ **Activity 2**ê°€ ë‹¤ì‹œ ì „ë©´ìœ¼ë¡œ ë‚˜ì™€ ì•ˆë“œë¡œì´ë“œì˜ ê°„ì†Œí™”ëœ ì‘ì—… íƒìƒ‰ ë©”ì»¤ë‹ˆì¦˜ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (698).png>)

## Task affinity attack

### Overview of Task Affinity and Launch Modes

ì•ˆë“œë¡œì´ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ **task affinity**ëŠ” í™œë™ì˜ ì„ í˜¸ ì‘ì—…ì„ ì§€ì •í•˜ë©°, ì¼ë°˜ì ìœ¼ë¡œ ì•±ì˜ íŒ¨í‚¤ì§€ ì´ë¦„ê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤. ì´ ì„¤ì •ì€ ê³µê²©ì„ ì‹œì—°í•˜ê¸° ìœ„í•œ ê°œë… ì¦ëª…(PoC) ì•±ì„ ë§Œë“œëŠ” ë° ì¤‘ìš”í•©ë‹ˆë‹¤.

### Launch Modes

`launchMode` ì†ì„±ì€ ì‘ì—… ë‚´ì—ì„œ í™œë™ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì§€ì‹œí•©ë‹ˆë‹¤. **singleTask** ëª¨ë“œëŠ” ì´ ê³µê²©ì— ì¤‘ì¶”ì ì´ë©°, ê¸°ì¡´ í™œë™ ì¸ìŠ¤í„´ìŠ¤ì™€ ì‘ì—… ì¹œí™”ì„± ì¼ì¹˜ì— ë”°ë¼ ì„¸ ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì§€ì‹œí•©ë‹ˆë‹¤. ì´ ê³µê²©ì€ ê³µê²©ìì˜ ì•±ì´ ëŒ€ìƒ ì•±ì˜ ì‘ì—… ì¹œí™”ì„±ì„ ëª¨ë°©í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì— ì˜ì¡´í•˜ì—¬, ì•ˆë“œë¡œì´ë“œ ì‹œìŠ¤í…œì´ ì˜ë„í•œ ëŒ€ìƒì„ ëŒ€ì‹ í•˜ì—¬ ê³µê²©ìì˜ ì•±ì„ ì‹¤í–‰í•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤.

### Detailed Attack Steps

1. **ì•…ì„± ì•± ì„¤ì¹˜**: í”¼í•´ìê°€ ìì‹ ì˜ ì¥ì¹˜ì— ê³µê²©ìì˜ ì•±ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.
2. **ì´ˆê¸° í™œì„±í™”**: í”¼í•´ìê°€ ì²˜ìŒìœ¼ë¡œ ì•…ì„± ì•±ì„ ì—´ì–´ ê³µê²©ì„ ìœ„í•œ ì¥ì¹˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
3. **ëŒ€ìƒ ì•± ì‹¤í–‰ ì‹œë„**: í”¼í•´ìê°€ ëŒ€ìƒ ì•±ì„ ì—´ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤.
4. **í•˜ì´ì¬í‚¹ ì‹¤í–‰**: ì¼ì¹˜í•˜ëŠ” ì‘ì—… ì¹œí™”ì„±ìœ¼ë¡œ ì¸í•´ ì•…ì„± ì•±ì´ ëŒ€ìƒ ì•± ëŒ€ì‹  ì‹¤í–‰ë©ë‹ˆë‹¤.
5. **ê¸°ë§Œ**: ì•…ì„± ì•±ì´ ëŒ€ìƒ ì•±ê³¼ ìœ ì‚¬í•œ ê°€ì§œ ë¡œê·¸ì¸ í™”ë©´ì„ í‘œì‹œí•˜ì—¬ ì‚¬ìš©ìê°€ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì…ë ¥í•˜ë„ë¡ ì†ì…ë‹ˆë‹¤.

ì´ ê³µê²©ì˜ ì‹¤ì œ êµ¬í˜„ì„ ìœ„í•´ GitHubì˜ Task Hijacking Strandhogg ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### Prevention Measures

ì´ëŸ¬í•œ ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ê°œë°œìëŠ” `taskAffinity`ë¥¼ ë¹ˆ ë¬¸ìì—´ë¡œ ì„¤ì •í•˜ê³  `singleInstance` ì‹¤í–‰ ëª¨ë“œë¥¼ ì„ íƒí•˜ì—¬ ìì‹ ì˜ ì•±ì´ ë‹¤ë¥¸ ì•±ê³¼ ê²©ë¦¬ë˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `onBackPressed()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©ì ì •ì˜í•˜ë©´ ì‘ì—… í•˜ì´ì¬í‚¹ì— ëŒ€í•œ ì¶”ê°€ ë³´í˜¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## **References**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
