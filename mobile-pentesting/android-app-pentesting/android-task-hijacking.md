# Android Task Hijacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## рдХрд╛рд░реНрдп, рдмреИрдХ рд╕реНрдЯреИрдХ рдФрд░ рдЕрдЧреНрд░рднреВрдорд┐ рдЧрддрд┐рд╡рд┐рдзрд┐рдпрд╛рдБ

Android рдореЗрдВ, рдПрдХ **рдХрд╛рд░реНрдп** рдореВрд▓ рд░реВрдк рд╕реЗ рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╣реИ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдп рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рддрдЪреАрдд рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ **рдмреИрдХ рд╕реНрдЯреИрдХ** рдХреЗ рднреАрддрд░ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рд╕реНрдЯреИрдХ рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдЗрд╕ рдЖрдзрд╛рд░ рдкрд░ рдХреНрд░рдордмрджреНрдз рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдХрдм рдЦреЛрд▓рд╛ рдЧрдпрд╛ рдерд╛, рд╕рдмрд╕реЗ рд╣рд╛рд▓ рдХреА рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рд╢реАрд░реНрд╖ рдкрд░ **рдЕрдЧреНрд░рднреВрдорд┐ рдЧрддрд┐рд╡рд┐рдзрд┐** рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред рдХрд┐рд╕реА рднреА рд╕рдордп, рдХреЗрд╡рд▓ рдпрд╣ рдЧрддрд┐рд╡рд┐рдзрд┐ рд╕реНрдХреНрд░реАрди рдкрд░ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ **рдЕрдЧреНрд░рднреВрдорд┐ рдХрд╛рд░реНрдп** рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдмрди рдЬрд╛рддреА рд╣реИред

рдЧрддрд┐рд╡рд┐рдзрд┐ рд╕рдВрдХреНрд░рдордг рдХрд╛ рддреНрд╡рд░рд┐рдд рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдпрд╣рд╛рдБ рд╣реИ:

* **рдЧрддрд┐рд╡рд┐рдзрд┐ 1** рдЕрдЧреНрд░рднреВрдорд┐ рдореЗрдВ рдПрдХрдорд╛рддреНрд░ рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИред
* **рдЧрддрд┐рд╡рд┐рдзрд┐ 2** рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рд╕реЗ **рдЧрддрд┐рд╡рд┐рдзрд┐ 1** рдмреИрдХ рд╕реНрдЯреИрдХ рдореЗрдВ рдзрдХреЗрд▓ рджреА рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ **рдЧрддрд┐рд╡рд┐рдзрд┐ 2** рдЕрдЧреНрд░рднреВрдорд┐ рдореЗрдВ рдЖ рдЬрд╛рддреА рд╣реИред
* **рдЧрддрд┐рд╡рд┐рдзрд┐ 3** рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ **рдЧрддрд┐рд╡рд┐рдзрд┐ 1** рдФрд░ **рдЧрддрд┐рд╡рд┐рдзрд┐ 2** рд╕реНрдЯреИрдХ рдореЗрдВ рдФрд░ рдкреАрдЫреЗ рдЪрд▓реА рдЬрд╛рддреА рд╣реИрдВ, **рдЧрддрд┐рд╡рд┐рдзрд┐ 3** рдЕрдм рд╕рд╛рдордиреЗ рд╣реЛрддреА рд╣реИред
* **рдЧрддрд┐рд╡рд┐рдзрд┐ 3** рдХреЛ рдмрдВрдж рдХрд░рдиреЗ рд╕реЗ **рдЧрддрд┐рд╡рд┐рдзрд┐ 2** рдлрд┐рд░ рд╕реЗ рдЕрдЧреНрд░рднреВрдорд┐ рдореЗрдВ рдЖ рдЬрд╛рддреА рд╣реИ, рдЬреЛ Android рдХреЗ рд╕реБрд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд╛рд░реНрдп рдиреЗрд╡рд┐рдЧреЗрд╢рди рддрдВрддреНрд░ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреА рд╣реИред

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (698).png>)

## рдХрд╛рд░реНрдп рд╕рдВрдмрдВрдзреА рд╣рдорд▓реЗ

### рдХрд╛рд░реНрдп рд╕рдВрдмрдВрдз рдФрд░ рд▓реЙрдиреНрдЪ рдореЛрдб рдХрд╛ рдЕрд╡рд▓реЛрдХрди

Android рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ, **рдХрд╛рд░реНрдп рд╕рдВрдмрдВрдз** рдПрдХ рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЗ рдкрд╕рдВрджреАрджрд╛ рдХрд╛рд░реНрдп рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЖрдорддреМрд░ рдкрд░ рдРрдк рдХреЗ рдкреИрдХреЗрдЬ рдирд╛рдо рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред рдпрд╣ рд╕реЗрдЯрдЕрдк рд╣рдорд▓реЗ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рдорд╛рдг-рдХреА-рдзрд╛рд░рдгрд╛ (PoC) рдРрдк рдмрдирд╛рдиреЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред

### рд▓реЙрдиреНрдЪ рдореЛрдб

`launchMode` рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рднреАрддрд░ рдЧрддрд┐рд╡рд┐рдзрд┐ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рдкреНрд░рдмрдВрдзрди рдХреЛ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддреА рд╣реИред **singleTask** рдореЛрдб рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдЬреЛ рдореМрдЬреВрджрд╛ рдЧрддрд┐рд╡рд┐рдзрд┐ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдФрд░ рдХрд╛рд░реНрдп рд╕рдВрдмрдВрдз рдореЗрд▓ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рддреАрди рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╢реЛрд╖рдг рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдРрдк рдХреА рдХреНрд╖рдорддрд╛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ рд▓рдХреНрд╖рд┐рдд рдРрдк рдХреЗ рдХрд╛рд░реНрдп рд╕рдВрдмрдВрдз рдХреА рдирдХрд▓ рдХрд░ рд╕рдХреЗ, рдЬрд┐рд╕рд╕реЗ Android рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдРрдк рдХреЛ рд▓рдХреНрд╖рд┐рдд рдРрдк рдХреЗ рдмрдЬрд╛рдп рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреБрдорд░рд╛рд╣ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

### рд╡рд┐рд╕реНрддреГрдд рд╣рдорд▓реЗ рдХреЗ рдЪрд░рдг

1. **рджреБрд╖реНрдЯ рдРрдк рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди**: рдкреАрдбрд╝рд┐рдд рдЕрдкрдиреЗ рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рд╣рдорд▓рд╛рд╡рд░ рдХрд╛ рдРрдк рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рддрд╛ рд╣реИред
2. **рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕рдХреНрд░рд┐рдпрдг**: рдкреАрдбрд╝рд┐рдд рдкрд╣рд▓реЗ рджреБрд╖реНрдЯ рдРрдк рдХреЛ рдЦреЛрд▓рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдбрд┐рд╡рд╛рдЗрд╕ рд╕реЗрдЯрдЕрдк рд╣реЛрддрд╛ рд╣реИред
3. **рд▓рдХреНрд╖рд┐рдд рдРрдк рд▓реЙрдиреНрдЪ рдкреНрд░рдпрд╛рд╕**: рдкреАрдбрд╝рд┐рдд рд▓рдХреНрд╖рд┐рдд рдРрдк рдХреЛ рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИред
4. **рд╣рд╛рдЗрдЬреИрдХ рдирд┐рд╖реНрдкрд╛рджрди**: рдореЗрд▓ рдЦрд╛рддреЗ рдХрд╛рд░реНрдп рд╕рдВрдмрдВрдз рдХреЗ рдХрд╛рд░рдг, рджреБрд╖реНрдЯ рдРрдк рд▓рдХреНрд╖рд┐рдд рдРрдк рдХреЗ рд╕реНрдерд╛рди рдкрд░ рд▓реЙрдиреНрдЪ рд╣реЛрддрд╛ рд╣реИред
5. **рдзреЛрдЦрд╛**: рджреБрд╖реНрдЯ рдРрдк рд▓рдХреНрд╖рд┐рдд рдРрдк рдХреЗ рд╕рдорд╛рди рдПрдХ рдирдХрд▓реА рд▓реЙрдЧрд┐рди рд╕реНрдХреНрд░реАрди рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рджрд░реНрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдзреЛрдЦрд╛ рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП, GitHub рдкрд░ Task Hijacking Strandhogg рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рджреЗрдЦреЗрдВ: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### рд░реЛрдХрдерд╛рдо рдХреЗ рдЙрдкрд╛рдп

рдРрд╕реЗ рд╣рдорд▓реЛрдВ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рдбреЗрд╡рд▓рдкрд░реНрд╕ `taskAffinity` рдХреЛ рдПрдХ рдЦрд╛рд▓реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдкрд░ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ `singleInstance` рд▓реЙрдиреНрдЪ рдореЛрдб рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЙрдирдХреЗ рдРрдк рдХрд╛ рдЕрдиреНрдп рдРрдкреНрд╕ рд╕реЗ рдЕрд▓рдЧрд╛рд╡ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрддрд╛ рд╣реИред `onBackPressed()` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдирд╛ рдХрд╛рд░реНрдп рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

## **рд╕рдВрджрд░реНрдн**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
