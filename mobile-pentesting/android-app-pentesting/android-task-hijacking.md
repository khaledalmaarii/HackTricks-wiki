# Android Task Hijacking

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## ä»»åŠ¡ã€åæ ˆå’Œå‰å°æ´»åŠ¨

åœ¨ Android ä¸­ï¼Œ**ä»»åŠ¡** æœ¬è´¨ä¸Šæ˜¯ä¸€ç»„ç”¨æˆ·äº¤äº’ä»¥å®Œæˆç‰¹å®šå·¥ä½œçš„æ´»åŠ¨ï¼Œç»„ç»‡åœ¨ **åæ ˆ** ä¸­ã€‚è¯¥æ ˆæ ¹æ®æ´»åŠ¨æ‰“å¼€çš„æ—¶é—´å¯¹æ´»åŠ¨è¿›è¡Œæ’åºï¼Œæœ€è¿‘çš„æ´»åŠ¨æ˜¾ç¤ºåœ¨é¡¶éƒ¨ï¼Œç§°ä¸º **å‰å°æ´»åŠ¨**ã€‚åœ¨ä»»ä½•æ—¶åˆ»ï¼Œåªæœ‰æ­¤æ´»åŠ¨åœ¨å±å¹•ä¸Šå¯è§ï¼Œä½¿å…¶æˆä¸º **å‰å°ä»»åŠ¡** çš„ä¸€éƒ¨åˆ†ã€‚

ä»¥ä¸‹æ˜¯æ´»åŠ¨è½¬æ¢çš„å¿«é€Ÿæ¦‚è¿°ï¼š

* **æ´»åŠ¨ 1** ä½œä¸ºå‰å°çš„å”¯ä¸€æ´»åŠ¨å¼€å§‹ã€‚
* å¯åŠ¨ **æ´»åŠ¨ 2** å°† **æ´»åŠ¨ 1** æ¨å…¥åæ ˆï¼Œä½¿ **æ´»åŠ¨ 2** è¿›å…¥å‰å°ã€‚
* å¯åŠ¨ **æ´»åŠ¨ 3** å°† **æ´»åŠ¨ 1** å’Œ **æ´»åŠ¨ 2** è¿›ä¸€æ­¥æ¨å…¥æ ˆä¸­ï¼Œ**æ´»åŠ¨ 3** ç°åœ¨åœ¨å‰é¢ã€‚
* å…³é—­ **æ´»åŠ¨ 3** å°† **æ´»åŠ¨ 2** é‡æ–°å¸¦å›å‰å°ï¼Œå±•ç¤ºäº† Android çš„ç®€åŒ–ä»»åŠ¡å¯¼èˆªæœºåˆ¶ã€‚

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (698).png>)

## ä»»åŠ¡äº²å’ŒåŠ›æ”»å‡»

### ä»»åŠ¡äº²å’ŒåŠ›å’Œå¯åŠ¨æ¨¡å¼æ¦‚è¿°

åœ¨ Android åº”ç”¨ç¨‹åºä¸­ï¼Œ**ä»»åŠ¡äº²å’ŒåŠ›** æŒ‡å®šæ´»åŠ¨çš„é¦–é€‰ä»»åŠ¡ï¼Œé€šå¸¸ä¸åº”ç”¨ç¨‹åºçš„åŒ…åå¯¹é½ã€‚æ­¤è®¾ç½®åœ¨åˆ¶ä½œç”¨äºæ¼”ç¤ºæ”»å‡»çš„æ¦‚å¿µéªŒè¯ (PoC) åº”ç”¨ç¨‹åºæ—¶è‡³å…³é‡è¦ã€‚

### å¯åŠ¨æ¨¡å¼

`launchMode` å±æ€§æŒ‡å¯¼æ´»åŠ¨å®ä¾‹åœ¨ä»»åŠ¡ä¸­çš„å¤„ç†ã€‚**singleTask** æ¨¡å¼å¯¹è¯¥æ”»å‡»è‡³å…³é‡è¦ï¼Œæ ¹æ®ç°æœ‰æ´»åŠ¨å®ä¾‹å’Œä»»åŠ¡äº²å’ŒåŠ›åŒ¹é…æƒ…å†µè§„å®šä¸‰ç§åœºæ™¯ã€‚è¯¥æ¼æ´ä¾èµ–äºæ”»å‡»è€…çš„åº”ç”¨èƒ½å¤Ÿæ¨¡ä»¿ç›®æ ‡åº”ç”¨çš„ä»»åŠ¡äº²å’ŒåŠ›ï¼Œè¯¯å¯¼ Android ç³»ç»Ÿå¯åŠ¨æ”»å‡»è€…çš„åº”ç”¨è€Œä¸æ˜¯é¢„æœŸçš„ç›®æ ‡ã€‚

### è¯¦ç»†æ”»å‡»æ­¥éª¤

1. **æ¶æ„åº”ç”¨å®‰è£…**ï¼šå—å®³è€…åœ¨å…¶è®¾å¤‡ä¸Šå®‰è£…æ”»å‡»è€…çš„åº”ç”¨ã€‚
2. **åˆå§‹æ¿€æ´»**ï¼šå—å®³è€…é¦–æ¬¡æ‰“å¼€æ¶æ„åº”ç”¨ï¼Œä¸ºæ”»å‡»åšå¥½å‡†å¤‡ã€‚
3. **ç›®æ ‡åº”ç”¨å¯åŠ¨å°è¯•**ï¼šå—å®³è€…å°è¯•æ‰“å¼€ç›®æ ‡åº”ç”¨ã€‚
4. **åŠ«æŒæ‰§è¡Œ**ï¼šç”±äºä»»åŠ¡äº²å’ŒåŠ›åŒ¹é…ï¼Œæ¶æ„åº”ç”¨è¢«å¯åŠ¨ï¼Œå–ä»£ç›®æ ‡åº”ç”¨ã€‚
5. **æ¬ºéª—**ï¼šæ¶æ„åº”ç”¨å±•ç¤ºä¸€ä¸ªå‡ç™»å½•ç•Œé¢ï¼Œç±»ä¼¼äºç›®æ ‡åº”ç”¨ï¼Œæ¬ºéª—ç”¨æˆ·è¾“å…¥æ•æ„Ÿä¿¡æ¯ã€‚

æœ‰å…³æ­¤æ”»å‡»çš„å®é™…å®æ–½ï¼Œè¯·å‚è€ƒ GitHub ä¸Šçš„ä»»åŠ¡åŠ«æŒ Strandhogg ä»“åº“ï¼š[Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg)ã€‚

### é¢„é˜²æªæ–½

ä¸ºäº†é˜²æ­¢æ­¤ç±»æ”»å‡»ï¼Œå¼€å‘äººå‘˜å¯ä»¥å°† `taskAffinity` è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¹¶é€‰æ‹© `singleInstance` å¯åŠ¨æ¨¡å¼ï¼Œç¡®ä¿å…¶åº”ç”¨ä¸å…¶ä»–åº”ç”¨éš”ç¦»ã€‚è‡ªå®šä¹‰ `onBackPressed()` å‡½æ•°æä¾›é¢å¤–çš„ä¿æŠ¤ï¼Œä»¥é˜²æ­¢ä»»åŠ¡åŠ«æŒã€‚

## **å‚è€ƒæ–‡çŒ®**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)


{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
