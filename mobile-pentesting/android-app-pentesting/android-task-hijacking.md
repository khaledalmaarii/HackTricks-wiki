# D√©tournement de T√¢che Android

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}

## T√¢che, Back Stack et Activit√©s au Premier Plan

Dans Android, une **t√¢che** est essentiellement un ensemble d'activit√©s avec lesquelles les utilisateurs interagissent pour accomplir un travail sp√©cifique, organis√©es dans un **back stack**. Cette pile ordonne les activit√©s en fonction de leur ouverture, l'activit√© la plus r√©cente √©tant affich√©e en haut comme l'**activit√© au premier plan**. √Ä tout moment, seule cette activit√© est visible √† l'√©cran, faisant partie de la **t√¢che au premier plan**.

Voici un aper√ßu rapide des transitions d'activit√© :

* **Activit√© 1** commence comme la seule activit√© au premier plan.
* Le lancement de **l'Activit√© 2** pousse **l'Activit√© 1** dans le back stack, amenant **l'Activit√© 2** au premier plan.
* Le d√©marrage de **l'Activit√© 3** d√©place **l'Activit√© 1** et **l'Activit√© 2** plus loin dans la pile, avec **l'Activit√© 3** maintenant devant.
* La fermeture de **l'Activit√© 3** ram√®ne **l'Activit√© 2** au premier plan, mettant en avant le m√©canisme de navigation des t√¢ches simplifi√© d'Android.

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (698).png>)

## Attaque par Affinit√© de T√¢che

### Aper√ßu de l'Affinit√© de T√¢che et des Modes de Lancement

Dans les applications Android, l'**affinit√© de t√¢che** sp√©cifie la t√¢che pr√©f√©r√©e d'une activit√©, s'alignant g√©n√©ralement avec le nom du package de l'application. Cette configuration est essentielle pour cr√©er une application de preuve de concept (PoC) pour d√©montrer l'attaque.

### Modes de Lancement

L'attribut `launchMode` dirige le traitement des instances d'activit√© au sein des t√¢ches. Le mode **singleTask** est crucial pour cette attaque, dictant trois sc√©narios bas√©s sur les instances d'activit√© existantes et les correspondances d'affinit√© de t√¢che. L'exploitation repose sur la capacit√© de l'application de l'attaquant √† imiter l'affinit√© de t√¢che de l'application cible, induisant le syst√®me Android en erreur pour lancer l'application de l'attaquant au lieu de la cible pr√©vue.

### √âtapes D√©tail√©es de l'Attaque

1. **Installation de l'Application Malveillante** : La victime installe l'application de l'attaquant sur son appareil.
2. **Activation Initiale** : La victime ouvre d'abord l'application malveillante, pr√©parant l'appareil pour l'attaque.
3. **Tentative de Lancement de l'Application Cible** : La victime tente d'ouvrir l'application cible.
4. **Ex√©cution du D√©tournement** : En raison de l'affinit√© de t√¢che correspondante, l'application malveillante est lanc√©e √† la place de l'application cible.
5. **Tromperie** : L'application malveillante pr√©sente un faux √©cran de connexion ressemblant √† l'application cible, trompant l'utilisateur pour qu'il saisisse des informations sensibles.

Pour une mise en ≈ìuvre pratique de cette attaque, consultez le d√©p√¥t Task Hijacking Strandhogg sur GitHub : [Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### Mesures de Pr√©vention

Pour pr√©venir de telles attaques, les d√©veloppeurs peuvent d√©finir `taskAffinity` sur une cha√Æne vide et opter pour le mode de lancement `singleInstance`, garantissant l'isolement de leur application par rapport aux autres. La personnalisation de la fonction `onBackPressed()` offre une protection suppl√©mentaire contre le d√©tournement de t√¢che.

## **R√©f√©rences**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)


{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}
