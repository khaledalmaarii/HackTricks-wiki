# AVD - Androidè™šæ‹Ÿè®¾å¤‡

## AVD - Androidè™šæ‹Ÿè®¾å¤‡

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

éå¸¸æ„Ÿè°¢[**@offsecjay**](https://twitter.com/offsecjay)åœ¨åˆ›å»ºæ­¤å†…å®¹æ—¶çš„å¸®åŠ©ã€‚

## ä»€ä¹ˆæ˜¯

Android Studioå…è®¸**è¿è¡ŒAndroidçš„è™šæ‹Ÿæœºï¼Œç”¨äºæµ‹è¯•APKæ–‡ä»¶**ã€‚ä¸ºäº†ä½¿ç”¨å®ƒä»¬ï¼Œæ‚¨éœ€è¦ï¼š

* **Android SDKå·¥å…·** - [åœ¨è¿™é‡Œä¸‹è½½](https://developer.android.com/studio/releases/sdk-tools)ã€‚
* æˆ–è€…**Android Studio**ï¼ˆå¸¦æœ‰Android SDKå·¥å…·ï¼‰ - [åœ¨è¿™é‡Œä¸‹è½½](https://developer.android.com/studio)ã€‚

åœ¨Windowsä¸­ï¼ˆä»¥æˆ‘çš„æƒ…å†µä¸ºä¾‹ï¼‰ï¼Œ**å®‰è£…Android Studioå**ï¼Œæˆ‘å°†**SDKå·¥å…·å®‰è£…åœ¨**ï¼š`C:\Users\<ç”¨æˆ·å>\AppData\Local\Android\Sdk\tools`

åœ¨Macä¸Šï¼Œæ‚¨å¯ä»¥**ä¸‹è½½SDKå·¥å…·**å¹¶å°†å…¶æ”¾åœ¨PATHä¸­è¿è¡Œï¼š
```bash
brew tap homebrew/cask
brew install --cask android-sdk
```
æˆ–è€…ä»**Android Studio GUI**ä¸­å®‰è£…ï¼Œå¦‚[https://stackoverflow.com/questions/46402772/failed-to-install-android-sdk-java-lang-noclassdeffounderror-javax-xml-bind-a](https://stackoverflow.com/questions/46402772/failed-to-install-android-sdk-java-lang-noclassdeffounderror-javax-xml-bind-a)æ‰€ç¤ºï¼Œå®ƒä»¬å°†å®‰è£…åœ¨`~/Library/Android/sdk/cmdline-tools/latest/bin/`å’Œ`~/Library/Android/sdk/platform-tools/`å’Œ`~/Library/Android/sdk/emulator/`ã€‚

å¯¹äºJavaé—®é¢˜ï¼š&#x20;
```java
export JAVA_HOME=/Applications/Android\ Studio.app/Contents/jbr/Contents/Home
```
## GUI

### å‡†å¤‡è™šæ‹Ÿæœº

å¦‚æœä½ å·²ç»å®‰è£…äº†Android Studioï¼Œä½ å¯ä»¥æ‰“å¼€ä¸»é¡¹ç›®è§†å›¾å¹¶è®¿é—®ï¼š_**å·¥å…·**_ --> _**AVDç®¡ç†å™¨**_ã€‚

![](<../../.gitbook/assets/image (330).png>)

ç„¶åï¼Œç‚¹å‡» _**åˆ›å»ºè™šæ‹Ÿè®¾å¤‡**_ï¼Œ_**é€‰æ‹©**_ ä½ æƒ³è¦ä½¿ç”¨çš„æ‰‹æœºï¼Œå¹¶ç‚¹å‡» _**ä¸‹ä¸€æ­¥**_ã€‚\
åœ¨å½“å‰è§†å›¾ä¸­ï¼Œä½ å°†èƒ½å¤Ÿ**é€‰æ‹©å’Œä¸‹è½½**æ‰‹æœºå°†è¦è¿è¡Œçš„Androidé•œåƒï¼š

![](<../../.gitbook/assets/image (331).png>)

æ‰€ä»¥ï¼Œé€‰æ‹©å®ƒå¹¶ç‚¹å‡» _**ä¸‹è½½**_ï¼ˆ**ç°åœ¨ç­‰å¾…é•œåƒä¸‹è½½å®Œæˆï¼‰ã€‚**\
**ä¸€æ—¦é•œåƒä¸‹è½½å®Œæˆï¼Œåªéœ€é€‰æ‹©** `ä¸‹ä¸€æ­¥` å’Œ `å®Œæˆ`ã€‚

![](<../../.gitbook/assets/image (332).png>)

è™šæ‹Ÿæœºå°†è¢«åˆ›å»ºã€‚ç°åœ¨ï¼Œ**æ¯æ¬¡è®¿é—®AVDç®¡ç†å™¨æ—¶ï¼Œå®ƒéƒ½ä¼šå‡ºç°**ã€‚

### è¿è¡Œè™šæ‹Ÿæœº

ä¸ºäº†**è¿è¡Œ**å®ƒï¼Œåªéœ€ç‚¹å‡» _**å¯åŠ¨æŒ‰é’®**_ã€‚

![](<../../.gitbook/assets/image (334).png>)

## å‘½ä»¤è¡Œå·¥å…·

é¦–å…ˆï¼Œä½ éœ€è¦**å†³å®šè¦ä½¿ç”¨å“ªä¸ªæ‰‹æœº**ï¼Œä¸ºäº†æŸ¥çœ‹å¯èƒ½çš„æ‰‹æœºåˆ—è¡¨ï¼Œè¯·æ‰§è¡Œï¼š
```
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\bin\avdmanager.bat list device

d: 0 or "automotive_1024p_landscape"
Name: Automotive (1024p landscape)
OEM : Google
Tag : android-automotive-playstore
---------
id: 1 or "Galaxy Nexus"
Name: Galaxy Nexus
OEM : Google
---------
id: 2 or "desktop_large"
Name: Large Desktop
OEM : Google
Tag : android-desktop
---------
id: 3 or "desktop_medium"
Name: Medium Desktop
OEM : Google
Tag : android-desktop
---------
id: 4 or "Nexus 10"
Name: Nexus 10
OEM : Google
[...]
```
ä¸€æ—¦æ‚¨å†³å®šè¦ä½¿ç”¨çš„è®¾å¤‡åç§°ï¼Œæ‚¨éœ€è¦**å†³å®šåœ¨æ­¤è®¾å¤‡ä¸Šè¿è¡Œå“ªä¸ªAndroidæ˜ åƒ**ã€‚\
æ‚¨å¯ä»¥ä½¿ç”¨`sdkmanager`åˆ—å‡ºæ‰€æœ‰é€‰é¡¹ï¼š
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\bin\sdkmanager.bat --list
```
å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤**ä¸‹è½½**æ‚¨æƒ³è¦ä½¿ç”¨çš„ä¸€ä¸ªï¼ˆæˆ–å…¨éƒ¨ï¼‰ï¼š

{% code overflow="wrap" %}
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\bin\sdkmanager.bat "platforms;android-28" "system-images;android-28;google_apis;x86_64"
```
{% endcode %}

ä¸€æ—¦ä½ ä¸‹è½½äº†æƒ³è¦ä½¿ç”¨çš„Androidæ˜ åƒï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤**åˆ—å‡ºæ‰€æœ‰å·²ä¸‹è½½çš„Androidæ˜ åƒ**ï¼š
```
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\bin\avdmanager.bat list target
----------
id: 1 or "android-28"
Name: Android API 28
Type: Platform
API level: 28
Revision: 6
----------
id: 2 or "android-29"
Name: Android API 29
Type: Platform
API level: 29
Revision: 4
```
æ­¤æ—¶ï¼Œæ‚¨å·²ç»å†³å®šè¦ä½¿ç”¨çš„è®¾å¤‡ï¼Œå¹¶ä¸”å·²ç»ä¸‹è½½äº†Androidæ˜ åƒï¼Œå› æ­¤**æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤åˆ›å»ºè™šæ‹Ÿæœº**ï¼š

{% code overflow="wrap" %}
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\bin\avdmanager.bat -v create avd -k "system-images;android-28;google_apis;x86_64" -n "AVD9" -d "Nexus 5X"
```
{% endcode %}

åœ¨ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­ï¼Œæˆ‘ä½¿ç”¨è®¾å¤‡â€œNexus 5Xâ€å’ŒAndroidé•œåƒâ€œsystem-images;android-28;google\_apis;x86\_64â€åˆ›å»ºäº†ä¸€ä¸ªåä¸ºâ€œ_AVD9_â€çš„è™šæ‹Ÿæœºã€‚\
ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºæ‚¨åˆ›å»ºçš„è™šæ‹Ÿæœºï¼š
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\bin\avdmanager.bat list avd

Name: AVD9
Device: Nexus 5X (Google)
Path: C:\Users\cpolo\.android\avd\AVD9.avd
Target: Google APIs (Google Inc.)
Based on: Android API 28 Tag/ABI: google_apis/x86_64

The following Android Virtual Devices could not be loaded:
Name: Pixel_2_API_27
Path: C:\Users\cpolo\.android\avd\Pixel_2_API_27_1.avd
Error: Google pixel_2 no longer exists as a device
```
### è¿è¡Œè™šæ‹Ÿæœº

æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•åˆ—å‡ºåˆ›å»ºçš„è™šæ‹Ÿæœºï¼Œä½†æ˜¯**ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åˆ—å‡ºå®ƒä»¬**ï¼š
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -list-avds
AVD9
Pixel_2_API_27
```
æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤**è¿è¡Œä»»ä½•åˆ›å»ºçš„è™šæ‹Ÿæœº**ï¼š

{% code overflow="wrap" %}
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -avd "VirtualMachineName"
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -avd "AVD9"
```
{% endcode %}

æˆ–è€…ä½¿ç”¨æ›´é«˜çº§çš„é€‰é¡¹ï¼Œæ‚¨å¯ä»¥è¿è¡Œä¸€ä¸ªè™šæ‹Ÿæœºï¼Œæ¯”å¦‚ï¼š 

{% code overflow="wrap" %}
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -avd "AVD9" -http-proxy 192.168.1.12:8080 -writable-system
```
{% endcode %}

### å‘½ä»¤è¡Œé€‰é¡¹

ç„¶è€Œï¼Œæœ‰å¾ˆå¤šä¸åŒçš„å‘½ä»¤è¡Œé€‰é¡¹å¯ä»¥ç”¨æ¥å¯åŠ¨è™šæ‹Ÿæœºã€‚ä¸‹é¢æ˜¯ä¸€äº›æœ‰è¶£çš„é€‰é¡¹ï¼Œä½†ä½ å¯ä»¥åœ¨[è¿™é‡Œæ‰¾åˆ°å®Œæ•´çš„åˆ—è¡¨](https://developer.android.com/studio/run/emulator-commandline)ã€‚

**å¯åŠ¨**

* `-snapshot name`ï¼šå¯åŠ¨è™šæ‹Ÿæœºå¿«ç…§
* `-snapshot-list -snapstorage ~/.android/avd/Nexus_5X_API_23.avd/snapshots-test.img`ï¼šåˆ—å‡ºæ‰€æœ‰è®°å½•çš„å¿«ç…§

**ç½‘ç»œ**

* `-dns-server 192.0.2.0, 192.0.2.255`ï¼šå…è®¸æŒ‡å®šé€—å·åˆ†éš”çš„DNSæœåŠ¡å™¨ç»™è™šæ‹Ÿæœºã€‚
* **`-http-proxy 192.168.1.12:8080`**ï¼šå…è®¸æŒ‡å®šè¦ä½¿ç”¨çš„HTTPä»£ç†ï¼ˆéå¸¸æœ‰ç”¨ï¼Œå¯ä»¥ä½¿ç”¨Burpæ¥æ•è·æµé‡ï¼‰
* `-port 5556`ï¼šè®¾ç½®ç”¨äºæ§åˆ¶å°å’Œadbçš„TCPç«¯å£å·ã€‚
* `-ports 5556,5559`ï¼šè®¾ç½®ç”¨äºæ§åˆ¶å°å’Œadbçš„TCPç«¯å£ã€‚
* **`-tcpdump /path/dumpfile.cap`**ï¼šå°†æ‰€æœ‰æµé‡æ•è·åˆ°æ–‡ä»¶ä¸­

**ç³»ç»Ÿ**

* `-selinux {disabled|permissive}`ï¼šåœ¨Linuxæ“ä½œç³»ç»Ÿä¸Šå°†Security-Enhanced Linuxå®‰å…¨æ¨¡å—è®¾ç½®ä¸ºç¦ç”¨æˆ–å®½å®¹æ¨¡å¼ã€‚
* `-timezone Europe/Paris`ï¼šè®¾ç½®è™šæ‹Ÿè®¾å¤‡çš„æ—¶åŒº
* `-screen {touch(default)|multi-touch|o-touch}`ï¼šè®¾ç½®æ¨¡æ‹Ÿçš„è§¦æ‘¸å±æ¨¡å¼ã€‚
* **`-writable-system`**ï¼šåœ¨ä»¿çœŸä¼šè¯æœŸé—´ä½¿ç”¨æ­¤é€‰é¡¹æ¥æ‹¥æœ‰å¯å†™çš„ç³»ç»Ÿæ˜ åƒã€‚æ‚¨è¿˜éœ€è¦è¿è¡Œ`adb root; adb remount`ã€‚è¿™å¯¹äºåœ¨ç³»ç»Ÿä¸­å®‰è£…æ–°è¯ä¹¦éå¸¸æœ‰ç”¨ã€‚

## åœ¨è™šæ‹Ÿæœºä¸Šå®‰è£…Burpè¯ä¹¦

é¦–å…ˆï¼Œæ‚¨éœ€è¦ä»Burpä¸­ä¸‹è½½Derè¯ä¹¦ã€‚æ‚¨å¯ä»¥åœ¨_Proxy_ --> _Options_ --> _Import / Export CA certificate_ ä¸­å®Œæˆæ­¤æ“ä½œã€‚

![](<../../.gitbook/assets/image (367).png>)

ä»¥Deræ ¼å¼**å¯¼å‡ºè¯ä¹¦**ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸º**Android**èƒ½å¤Ÿ**ç†è§£çš„å½¢å¼**ã€‚è¯·æ³¨æ„ï¼Œä¸ºäº†åœ¨AVDä¸­é…ç½®Burpè¯ä¹¦ï¼Œæ‚¨éœ€è¦ä½¿ç”¨**`-writable-system`**é€‰é¡¹è¿è¡Œæ­¤è™šæ‹Ÿæœºã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è¿™æ ·è¿è¡Œå®ƒï¼š

{% code overflow="wrap" %}
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -avd "AVD9" -http-proxy 192.168.1.12:8080 -writable-system
```
{% endcode %}

ç„¶åï¼Œè¦**é…ç½®Burpçš„è¯ä¹¦**ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
```bash
openssl x509 -inform DER -in burp_cacert.der -out burp_cacert.pem
CERTHASHNAME="`openssl x509 -inform PEM -subject_hash_old -in burp_cacert.pem | head -1`.0"
mv burp_cacert.pem $CERTHASHNAME #Correct name
adb root && sleep 2 && adb remount #Allow to write on /syste
adb push $CERTHASHNAME /sdcard/ #Upload certificate
adb shell mv /sdcard/$CERTHASHNAME /system/etc/security/cacerts/ #Move to correct location
adb shell chmod 644 /system/etc/security/cacerts/$CERTHASHNAME #Assign privileges
adb reboot #Now, reboot the machine
```
ä¸€æ—¦**æœºå™¨å®Œæˆé‡å¯**ï¼Œburpè¯ä¹¦å°†è¢«å…¶ä½¿ç”¨ï¼

## æ‹æ‘„å¿«ç…§

æ‚¨å¯ä»¥ä½¿ç”¨GUIéšæ—¶æ‹æ‘„è™šæ‹Ÿæœºçš„å¿«ç…§ï¼š

![](<../../.gitbook/assets/image (336).png>)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTæ”¶è—å“**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
