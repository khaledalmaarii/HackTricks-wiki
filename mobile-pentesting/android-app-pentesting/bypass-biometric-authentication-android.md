# Bypass Biometric Authentication (Android)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Method 1 â€“ Bypassing with No Crypto Object Usage**

Fokus ovde je na *onAuthenticationSucceeded* povratnom pozivu, koji je kljuÄan u procesu autentifikacije. IstraÅ¾ivaÄi iz WithSecure-a razvili su [Frida skriptu](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js), koja omoguÄ‡ava zaobilaÅ¾enje NULL *CryptoObject* u *onAuthenticationSucceeded(...)*. Skripta prisiljava automatsko zaobilaÅ¾enje autentifikacije otiska prsta prilikom poziva metode. Ispod je pojednostavljeni isjeÄak koji prikazuje zaobilaÅ¾enje u kontekstu Android otiska prsta, sa punom aplikacijom dostupnom na [GitHub](https://github.com/St3v3nsS/InsecureBanking).
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ·Ğ° Ğ¿Ğ¾ĞºÑ€ĞµÑ‚Ğ°ÑšĞµ Frida ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğµ:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **Metod 2 â€“ Pristup upravljanju izuzecima**

JoÅ¡ jedan [Frida skript](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) od WithSecure se bavi zaobilaÅ¾enjem nesigurne upotrebe kripto objekata. Skript poziva *onAuthenticationSucceeded* sa *CryptoObject* koji nije autorizovan otiskom prsta. Ako aplikacija pokuÅ¡a da koristi drugi objekat Å¡ifriranja, izazvaÄ‡e izuzetak. Skript se priprema da pozove *onAuthenticationSucceeded* i obradi *javax.crypto.IllegalBlockSizeException* u klasi _Cipher_, osiguravajuÄ‡i da su sledeÄ‡i objekti koje koristi aplikacija Å¡ifrovani novim kljuÄem.

Komanda za pokretanje Frida skripta:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
Upon reaching the fingerprint screen and the initiation of `authenticate()`, type `bypass()`` in the Frida console to activate the bypass: 

Kada doÄ‘ete do ekrana otiska prsta i pokrenete `authenticate()`, otkucajte `bypass()`` u Frida konzoli da aktivirate zaobilaÅ¾enje:
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **Metod 3 â€“ Instrumentacijski Okviri**

Instrumentacijski okviri kao Å¡to su Xposed ili Frida mogu se koristiti za povezivanje sa metodama aplikacije u vreme izvoÄ‘enja. Za autentifikaciju otiskom prsta, ovi okviri mogu:

1. **LaÅ¾irati Pozive za Autentifikaciju**: Povezivanjem sa metodama `onAuthenticationSucceeded`, `onAuthenticationFailed` ili `onAuthenticationError` iz `BiometricPrompt.AuthenticationCallback`, moÅ¾ete kontrolisati ishod procesa autentifikacije otiskom prsta.
2. **ObiÄ‡i SSL Pinovanje**: Ovo omoguÄ‡ava napadaÄu da presretne i izmeni saobraÄ‡aj izmeÄ‘u klijenta i servera, potencijalno menjajuÄ‡i proces autentifikacije ili kraduÄ‡i osetljive podatke.

Primer komande za Frida:
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **Metod 4 â€“ Reverzno inÅ¾enjerstvo i modifikacija koda**

Alati za reverzno inÅ¾enjerstvo kao Å¡to su `APKTool`, `dex2jar` i `JD-GUI` mogu se koristiti za dekompilaciju Android aplikacije, Äitanje njenog izvornog koda i razumevanje njenog mehanizma autentifikacije. Koraci obiÄno ukljuÄuju:

1. **Dekompilacija APK-a**: Pretvorite APK datoteku u Äitljiviji format (kao Å¡to je Java kod).
2. **Analiza koda**: PotraÅ¾ite implementaciju autentifikacije otiskom prsta i identifikujte potencijalne slabosti (kao Å¡to su mehanizmi povratka ili nepravilne provere validacije).
3. **Rekompilacija APK-a**: Nakon modifikacije koda za zaobilaÅ¾enje autentifikacije otiskom prsta, aplikacija se rekompajlira, potpisuje i instalira na ureÄ‘aj za testiranje.

## **Metod 5 â€“ KoriÅ¡Ä‡enje prilagoÄ‘enih alata za autentifikaciju**

Postoje specijalizovani alati i skripte dizajnirane za testiranje i zaobilaÅ¾enje mehanizama autentifikacije. Na primer:

1. **MAGISK moduli**: MAGISK je alat za Android koji omoguÄ‡ava korisnicima da root-uju svoje ureÄ‘aje i dodaju module koji mogu modifikovati ili laÅ¾irati informacije na hardverskom nivou, ukljuÄujuÄ‡i otiske prstiju.
2. **PrilagoÄ‘ene skripte**: Skripte se mogu napisati za interakciju sa Android Debug Bridge (ADB) ili direktno sa backend-om aplikacije kako bi simulirale ili zaobiÅ¡le autentifikaciju otiskom prsta.

## Reference
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
