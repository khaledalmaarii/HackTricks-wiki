# ZaobilaÅ¾enje biometrijske autentifikacije (Android)


<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetiÄku bezbednost**? Å½elite li da vidite svoju **kompaniju reklamiranu na HackTricks-u**? Ili Å¾elite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **PridruÅ¾ite se** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## **Metod 1 - ZaobilaÅ¾enje bez koriÅ¡Ä‡enja Crypto Object-a**

Fokus je ovde na *onAuthenticationSucceeded* povratnom pozivu, koji je kljuÄan u procesu autentifikacije. IstraÅ¾ivaÄi iz WithSecure-a razvili su [Frida skriptu](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js), koja omoguÄ‡ava zaobilaÅ¾enje NULL *CryptoObject*-a u *onAuthenticationSucceeded(...)*. Skripta automatski zaobilazi biometrijsku autentifikaciju prilikom poziva metode. U nastavku je prikazan pojednostavljeni iseÄak koji demonstrira zaobilaÅ¾enje u kontekstu Android otiska prsta, a cela aplikacija je dostupna na [GitHub-u](https://github.com/St3v3nsS/InsecureBanking).
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
Komanda za pokretanje Frida skripte:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **Metod 2 - Pristup obradi izuzetaka**

JoÅ¡ jedan [Frida skript](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) od strane WithSecure se bavi zaobilaÅ¾enjem nebezbedne upotrebe kripto objekta. Skript poziva *onAuthenticationSucceeded* sa *CryptoObject* koji nije autorizovan otiskom prsta. Ako aplikacija pokuÅ¡a da koristi drugi kripto objekat, izazvaÄ‡e izuzetak. Skript priprema poziv *onAuthenticationSucceeded* i obraÄ‘uje *javax.crypto.IllegalBlockSizeException* u klasi _Cipher_, obezbeÄ‘ujuÄ‡i da se naknadni objekti koje koristi aplikacija Å¡ifruju novim kljuÄem.

Komanda za pokretanje Frida skripta:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
Po dostizanju ekrana otiska prsta i pokretanju `authenticate()`, u Frida konzoli unesite `bypass()` da biste aktivirali zaobilaÅ¾enje:
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **Metod 3 - Instrumentacioni okviri**

Instrumentacioni okviri poput Xposed ili Frida mogu se koristiti za povezivanje sa metodama aplikacije tokom izvrÅ¡avanja. Za biometrijsku autentifikaciju, ovi okviri mogu:

1. **LaÅ¾irati povratne pozive autentifikacije**: Povezivanjem sa metodama `onAuthenticationSucceeded`, `onAuthenticationFailed` ili `onAuthenticationError` u klasi `BiometricPrompt.AuthenticationCallback`, moÅ¾ete kontrolisati ishod procesa biometrijske autentifikacije.
2. **Obilaziti SSL Pinning**: Ovo omoguÄ‡ava napadaÄu da presretne i izmeni saobraÄ‡aj izmeÄ‘u klijenta i servera, potencijalno menjajuÄ‡i proces autentifikacije ili kraÄ‘u osetljivih podataka.

Primer komande za Frida:
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **Metoda 4 - Reverse inÅ¾enjering i modifikacija koda**

Alati za reverse inÅ¾enjering poput `APKTool`, `dex2jar` i `JD-GUI` mogu se koristiti za dekompilaciju Android aplikacije, Äitanje njenog izvornog koda i razumevanje mehanizma autentifikacije. Koraci ukljuÄuju:

1. **Dekompilacija APK-a**: Pretvorite APK datoteku u format koji je Äitljiviji ljudima (poput Java koda).
2. **Analiza koda**: PotraÅ¾ite implementaciju autentifikacije otiska prsta i identifikujte potencijalne slabosti (poput rezervnih mehanizama ili nepravilnih provera validacije).
3. **Rekompilacija APK-a**: Nakon modifikacije koda za zaobilaÅ¾enje autentifikacije otiska prsta, aplikacija se rekompilira, potpisuje i instalira na ureÄ‘aju radi testiranja.

## **Metoda 5 - KoriÅ¡Ä‡enje prilagoÄ‘enih alata za autentifikaciju**

Postoje specijalizovani alati i skripte dizajnirane za testiranje i zaobilaÅ¾enje mehanizama autentifikacije. Na primer:

1. **MAGISK moduli**: MAGISK je alat za Android koji korisnicima omoguÄ‡ava rootovanje ureÄ‘aja i dodavanje modula koji mogu menjati ili laÅ¾irati informacije na nivou hardvera, ukljuÄujuÄ‡i otiske prstiju.
2. **PrilagoÄ‘ene skripte**: Skripte se mogu pisati kako bi se komuniciralo sa Android Debug Bridge (ADB) ili direktno sa pozadinskim sistemom aplikacije kako bi se simulirala ili zaobiÅ¡la autentifikacija otiska prsta.

## Reference
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetiÄku bezbednost**? Å½elite li da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u**? Ili Å¾elite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **PridruÅ¾ite se** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikova slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
