# OminiÄ™cie uwierzytelniania biometrycznego (Android)


<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujÄ…cej siÄ™ cyberbezpieczeÅ„stwem**? Chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks**? A moÅ¼e chcesz mieÄ‡ dostÄ™p do **najnowszej wersji PEASS lub pobraÄ‡ HackTricks w formacie PDF**? SprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **DoÅ‚Ä…cz do** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## **Metoda 1 - OminiÄ™cie bez uÅ¼ycia obiektu kryptograficznego**

Skupiamy siÄ™ tutaj na wywoÅ‚aniu zwrotnym *onAuthenticationSucceeded*, ktÃ³re jest kluczowe w procesie uwierzytelniania. Badacze z WithSecure opracowali [skrypt Frida](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js), umoÅ¼liwiajÄ…cy ominiÄ™cie pustego obiektu *CryptoObject* w *onAuthenticationSucceeded(...)*. Skrypt wymusza automatyczne ominiÄ™cie uwierzytelniania odciskiem palca podczas wywoÅ‚ania tej metody. PoniÅ¼ej znajduje siÄ™ uproszczony fragment kodu demonstrujÄ…cy ominiÄ™cie w kontekÅ›cie odcisku palca w systemie Android, a peÅ‚na aplikacja jest dostÄ™pna na [GitHubie](https://github.com/St3v3nsS/InsecureBanking).
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
Polecenie do uruchomienia skryptu Frida:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **Metoda 2 - podejÅ›cie obsÅ‚ugi wyjÄ…tkÃ³w**

Inny [skrypt Frida](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) autorstwa WithSecure zajmuje siÄ™ omijaniem niebezpiecznego uÅ¼ycia obiektu kryptograficznego. Skrypt wywoÅ‚uje *onAuthenticationSucceeded* z *CryptoObject*, ktÃ³ry nie zostaÅ‚ autoryzowany przez odcisk palca. JeÅ›li aplikacja sprÃ³buje uÅ¼yÄ‡ innego obiektu szyfrujÄ…cego, spowoduje to wyjÄ…tek. Skrypt przygotowuje siÄ™ do wywoÅ‚ania *onAuthenticationSucceeded* i obsÅ‚ugi *javax.crypto.IllegalBlockSizeException* w klasie _Cipher_, zapewniajÄ…c, Å¼e kolejne obiekty uÅ¼ywane przez aplikacjÄ™ sÄ… szyfrowane nowym kluczem.

Polecenie do uruchomienia skryptu Frida:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
Po dotarciu do ekranu odcisku palca i uruchomieniu `authenticate()`, wpisz `bypass()` w konsoli Frida, aby aktywowaÄ‡ bypass:
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **Metoda 3 - Frameworki Instrumentacyjne**

Frameworki instrumentacyjne, takie jak Xposed lub Frida, mogÄ… byÄ‡ uÅ¼ywane do podÅ‚Ä…czania siÄ™ do metod aplikacji w czasie wykonywania. Dla uwierzytelniania odciskiem palca, te frameworki mogÄ…:

1. **PodrobiÄ‡ wywoÅ‚ania uwierzytelniania**: PodÅ‚Ä…czajÄ…c siÄ™ do metod `onAuthenticationSucceeded`, `onAuthenticationFailed` lub `onAuthenticationError` w klasie `BiometricPrompt.AuthenticationCallback`, moÅ¼na kontrolowaÄ‡ wynik procesu uwierzytelniania odciskiem palca.
2. **OminiÄ™cie SSL Pinning**: Pozwala to atakujÄ…cemu przechwyciÄ‡ i modyfikowaÄ‡ ruch miÄ™dzy klientem a serwerem, potencjalnie zmieniajÄ…c proces uwierzytelniania lub kradnÄ…c wraÅ¼liwe dane.

PrzykÅ‚adowe polecenie dla Fridy:
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **Metoda 4 â€“ Reverse Engineering i Modyfikacja Kodu**

NarzÄ™dzia do reverse engineeringu, takie jak `APKTool`, `dex2jar` i `JD-GUI`, mogÄ… byÄ‡ uÅ¼ywane do dekompilacji aplikacji Android, odczytania jej kodu ÅºrÃ³dÅ‚owego i zrozumienia mechanizmu uwierzytelniania. OgÃ³lne kroki obejmujÄ…:

1. **Dekompilacja pliku APK**: Konwersja pliku APK na bardziej czytelnÄ… dla czÅ‚owieka formÄ™ (np. kod Java).
2. **Analiza kodu**: Szukanie implementacji uwierzytelniania odciskiem palca i identyfikowanie potencjalnych sÅ‚aboÅ›ci (np. mechanizmÃ³w fallback lub nieprawidÅ‚owych sprawdzeÅ„ walidacji).
3. **Rekompilacja pliku APK**: Po zmodyfikowaniu kodu w celu ominiÄ™cia uwierzytelniania odciskiem palca, aplikacja jest rekompilowana, podpisywana i instalowana na urzÄ…dzeniu w celu przetestowania.

## **Metoda 5 â€“ UÅ¼ycie Niestandardowych NarzÄ™dzi do Uwierzytelniania**

IstniejÄ… specjalistyczne narzÄ™dzia i skrypty przeznaczone do testowania i omijania mechanizmÃ³w uwierzytelniania. Na przykÅ‚ad:

1. **ModuÅ‚y MAGISK**: MAGISK to narzÄ™dzie dla systemu Android, ktÃ³re umoÅ¼liwia uÅ¼ytkownikom zrootowanie swoich urzÄ…dzeÅ„ i dodawanie moduÅ‚Ã³w, ktÃ³re mogÄ… modyfikowaÄ‡ lub podszywaÄ‡ siÄ™ pod informacje na poziomie sprzÄ™tu, w tym odciski palcÃ³w.
2. **Niestandardowe skrypty**: MoÅ¼na napisaÄ‡ skrypty do interakcji z Android Debug Bridge (ADB) lub bezpoÅ›rednio z backendem aplikacji w celu symulowania lub omijania uwierzytelniania odciskiem palca.

## Referencje
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Czy pracujesz w **firmie zajmujÄ…cej siÄ™ cyberbezpieczeÅ„stwem**? Chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… na HackTricks**? A moÅ¼e chcesz mieÄ‡ dostÄ™p do **najnowszej wersji PEASS lub pobraÄ‡ HackTricks w formacie PDF**? SprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **DoÅ‚Ä…cz do** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi trikami hakerskimi, przesyÅ‚ajÄ…c PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
