# ãƒã‚¤ãƒ‘ã‚¹ç”Ÿä½“èªè¨¼ (Android)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## **æ–¹æ³•1 â€“ æš—å·ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã›ãšã«ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹**

ã“ã“ã§ã®ç„¦ç‚¹ã¯ã€èªè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã«ãŠã„ã¦é‡è¦ãª*onAuthenticationSucceeded*ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ã™ã€‚WithSecureã®ç ”ç©¶è€…ãŸã¡ã¯ã€*onAuthenticationSucceeded(...)*å†…ã®NULL *CryptoObject*ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã®[Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js)ã‚’é–‹ç™ºã—ã¾ã—ãŸã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€ãƒ¡ã‚½ãƒƒãƒ‰ã®å‘¼ã³å‡ºã—æ™‚ã«æŒ‡ç´‹èªè¨¼ã®è‡ªå‹•ãƒã‚¤ãƒ‘ã‚¹ã‚’å¼·åˆ¶ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ã€Androidã®æŒ‡ç´‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã®ãƒã‚¤ãƒ‘ã‚¹ã‚’ç¤ºã™ç°¡ç•¥åŒ–ã•ã‚ŒãŸã‚¹ãƒ‹ãƒšãƒƒãƒˆã§ã€å®Œå…¨ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯[GitHub](https://github.com/St3v3nsS/InsecureBanking)ã§å…¥æ‰‹ã§ãã¾ã™ã€‚
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ï¼š
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **æ–¹æ³•2 â€“ ä¾‹å¤–å‡¦ç†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**

WithSecureã«ã‚ˆã‚‹åˆ¥ã®[Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js)ã¯ã€å®‰å…¨ã§ãªã„æš—å·ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½¿ç”¨ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ã«å¯¾å‡¦ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€æŒ‡ç´‹ã«ã‚ˆã£ã¦æ‰¿èªã•ã‚Œã¦ã„ãªã„*CryptoObject*ã‚’ä½¿ç”¨ã—ã¦*onAuthenticationSucceeded*ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒç•°ãªã‚‹æš—å·ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€*onAuthenticationSucceeded*ã‚’å‘¼ã³å‡ºã—ã€_Cipher_ã‚¯ãƒ©ã‚¹å†…ã®*javax.crypto.IllegalBlockSizeException*ã‚’å‡¦ç†ã™ã‚‹æº–å‚™ã‚’ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹å¾Œç¶šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ–°ã—ã„ã‚­ãƒ¼ã§æš—å·åŒ–ã•ã‚Œã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
æŒ‡ç´‹ç”»é¢ã«åˆ°é”ã—ã€`authenticate()`ãŒé–‹å§‹ã•ã‚Œã‚‹ã¨ã€Fridaã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§`bypass()`ã¨å…¥åŠ›ã—ã¦ãƒã‚¤ãƒ‘ã‚¹ã‚’æœ‰åŠ¹ã«ã—ã¾ã™:
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **Method 3 â€“ Instrumentation Frameworks**

Instrumentation frameworks like Xposed or Frida can be used to hook into application methods at runtime. For fingerprint authentication, these frameworks can:

1. **ãƒ¢ãƒƒã‚¯èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯**: `BiometricPrompt.AuthenticationCallback`ã®`onAuthenticationSucceeded`ã€`onAuthenticationFailed`ã€ã¾ãŸã¯`onAuthenticationError`ãƒ¡ã‚½ãƒƒãƒ‰ã«ãƒ•ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€æŒ‡ç´‹èªè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã®çµæœã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚
2. **SSLãƒ”ãƒ³ãƒ‹ãƒ³ã‚°ã‚’ãƒã‚¤ãƒ‘ã‚¹**: ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼é–“ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å‚å—ã—ã€å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã€èªè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¤‰æ›´ã—ãŸã‚Šã€æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’ç›—ã‚“ã ã‚Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

Example command for Frida:
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **æ–¹æ³•4 â€“ ãƒªãƒãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã¨ã‚³ãƒ¼ãƒ‰ä¿®æ­£**

`APKTool`ã€`dex2jar`ã€`JD-GUI`ã®ã‚ˆã†ãªãƒªãƒãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€Androidã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã€ãã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿ã€èªè¨¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¸€èˆ¬çš„ãªæ‰‹é †ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

1. **APKã®é€†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«**: APKãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ˆã‚Šäººé–“ãŒèª­ã¿ã‚„ã™ã„å½¢å¼ï¼ˆJavaã‚³ãƒ¼ãƒ‰ãªã©ï¼‰ã«å¤‰æ›ã—ã¾ã™ã€‚
2. **ã‚³ãƒ¼ãƒ‰ã®åˆ†æ**: æŒ‡ç´‹èªè¨¼ã®å®Ÿè£…ã‚’æ¢ã—ã€æ½œåœ¨çš„ãªå¼±ç‚¹ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚„ä¸é©åˆ‡ãªæ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãªã©ï¼‰ã‚’ç‰¹å®šã—ã¾ã™ã€‚
3. **APKã®å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«**: æŒ‡ç´‹èªè¨¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ãŸå¾Œã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã€ç½²åã•ã‚Œã€ãƒ†ã‚¹ãƒˆã®ãŸã‚ã«ãƒ‡ãƒã‚¤ã‚¹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

## **æ–¹æ³•5 â€“ ã‚«ã‚¹ã‚¿ãƒ èªè¨¼ãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨**

èªè¨¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ãƒ†ã‚¹ãƒˆãŠã‚ˆã³ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸå°‚é–€çš„ãªãƒ„ãƒ¼ãƒ«ã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ï¼š

1. **MAGISKãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**: MAGISKã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‡ãƒã‚¤ã‚¹ã‚’ãƒ«ãƒ¼ãƒˆåŒ–ã—ã€æŒ‡ç´‹ã‚’å«ã‚€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ¬ãƒ™ãƒ«ã®æƒ…å ±ã‚’ä¿®æ­£ã¾ãŸã¯å½è£…ã§ãã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã®Androidç”¨ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
2. **ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€Androidãƒ‡ãƒãƒƒã‚°ãƒ–ãƒªãƒƒã‚¸ï¼ˆADBï¼‰ã¨å¯¾è©±ã™ã‚‹ã‹ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ç›´æ¥å¯¾è©±ã—ã¦æŒ‡ç´‹èªè¨¼ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã¾ãŸã¯ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«æ›¸ã‹ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
