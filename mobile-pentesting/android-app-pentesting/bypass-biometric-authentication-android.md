# Bypass Biometric Authentication (Android)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Methode 1 ‚Äì Umgehung ohne Verwendung von CryptoObject**

Der Fokus liegt hier auf dem *onAuthenticationSucceeded* Callback, der im Authentifizierungsprozess entscheidend ist. Forscher von WithSecure entwickelten ein [Frida-Skript](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js), das die Umgehung des NULL *CryptoObject* in *onAuthenticationSucceeded(...)* erm√∂glicht. Das Skript erzwingt eine automatische Umgehung der Fingerabdruckauthentifizierung bei der Aufruf des Verfahrens. Unten ist ein vereinfachter Ausschnitt, der die Umgehung im Kontext von Android-Fingerabdruck zeigt, mit der vollst√§ndigen Anwendung verf√ºgbar auf [GitHub](https://github.com/St3v3nsS/InsecureBanking).
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
Befehl zum Ausf√ºhren des Frida-Skripts:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **Methode 2 ‚Äì Ausnahmebehandlungsansatz**

Ein weiteres [Frida-Skript](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) von WithSecure befasst sich mit dem Umgehen der unsicheren Verwendung von Kryptoobjekten. Das Skript ruft *onAuthenticationSucceeded* mit einem *CryptoObject* auf, das nicht durch einen Fingerabdruck autorisiert wurde. Wenn die Anwendung versucht, ein anderes Cipher-Objekt zu verwenden, wird eine Ausnahme ausgel√∂st. Das Skript bereitet sich darauf vor, *onAuthenticationSucceeded* aufzurufen und die *javax.crypto.IllegalBlockSizeException* in der _Cipher_-Klasse zu behandeln, um sicherzustellen, dass nachfolgende Objekte, die von der Anwendung verwendet werden, mit dem neuen Schl√ºssel verschl√ºsselt sind.

Befehl zum Ausf√ºhren des Frida-Skripts:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
Beim Erreichen des Fingerabdruckbildschirms und der Initiierung von `authenticate()`, geben Sie `bypass()` in die Frida-Konsole ein, um den Bypass zu aktivieren:
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **Methode 3 ‚Äì Instrumentierungs-Frameworks**

Instrumentierungs-Frameworks wie Xposed oder Frida k√∂nnen verwendet werden, um zur Laufzeit in Anwendungs-Methoden einzugreifen. F√ºr die Fingerabdruck-Authentifizierung k√∂nnen diese Frameworks:

1. **Die Authentifizierungs-Callbacks nachahmen**: Durch das Hooken in die Methoden `onAuthenticationSucceeded`, `onAuthenticationFailed` oder `onAuthenticationError` des `BiometricPrompt.AuthenticationCallback` k√∂nnen Sie den Ausgang des Fingerabdruck-Authentifizierungsprozesses steuern.
2. **SSL-Pinning umgehen**: Dies erm√∂glicht es einem Angreifer, den Datenverkehr zwischen dem Client und dem Server abzufangen und zu modifizieren, wodurch der Authentifizierungsprozess potenziell ver√§ndert oder sensible Daten gestohlen werden k√∂nnen.

Beispielbefehl f√ºr Frida:
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **Methode 4 ‚Äì Reverse Engineering & Code-Modifikation**

Reverse Engineering-Tools wie `APKTool`, `dex2jar` und `JD-GUI` k√∂nnen verwendet werden, um eine Android-Anwendung zu dekompilieren, ihren Quellcode zu lesen und ihren Authentifizierungsmechanismus zu verstehen. Die Schritte umfassen in der Regel:

1. **Dekompilieren der APK**: Konvertieren Sie die APK-Datei in ein menschenlesbareres Format (wie Java-Code).
2. **Analysieren des Codes**: Suchen Sie nach der Implementierung der Fingerabdruckauthentifizierung und identifizieren Sie potenzielle Schw√§chen (wie Fallback-Mechanismen oder unsachgem√§√üe Validierungspr√ºfungen).
3. **Rekompilieren der APK**: Nach der Modifikation des Codes, um die Fingerabdruckauthentifizierung zu umgehen, wird die Anwendung neu kompiliert, signiert und auf dem Ger√§t zur Pr√ºfung installiert.

## **Methode 5 ‚Äì Verwendung von benutzerdefinierten Authentifizierungswerkzeugen**

Es gibt spezialisierte Werkzeuge und Skripte, die entwickelt wurden, um Authentifizierungsmechanismen zu testen und zu umgehen. Zum Beispiel:

1. **MAGISK-Module**: MAGISK ist ein Tool f√ºr Android, das es Benutzern erm√∂glicht, ihre Ger√§te zu rooten und Module hinzuzuf√ºgen, die hardwarebezogene Informationen, einschlie√ülich Fingerabdr√ºcke, modifizieren oder f√§lschen k√∂nnen.
2. **Benutzerdefinierte Skripte**: Skripte k√∂nnen geschrieben werden, um mit dem Android Debug Bridge (ADB) oder direkt mit dem Backend der Anwendung zu interagieren, um die Fingerabdruckauthentifizierung zu simulieren oder zu umgehen.

## Referenzen
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
