# ç»•è¿‡ç”Ÿç‰©è¯†åˆ«è®¤è¯ (Android)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## **æ–¹æ³• 1 â€“ æ— åŠ å¯†å¯¹è±¡ä½¿ç”¨çš„ç»•è¿‡**

è¿™é‡Œçš„é‡ç‚¹æ˜¯ *onAuthenticationSucceeded* å›è°ƒï¼Œå®ƒåœ¨è®¤è¯è¿‡ç¨‹ä¸­è‡³å…³é‡è¦ã€‚WithSecure çš„ç ”ç©¶äººå‘˜å¼€å‘äº†ä¸€ä¸ª [Frida è„šæœ¬](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js)ï¼Œä½¿å¾—å¯ä»¥ç»•è¿‡ *onAuthenticationSucceeded(...)* ä¸­çš„ NULL *CryptoObject*ã€‚è¯¥è„šæœ¬åœ¨æ–¹æ³•è°ƒç”¨æ—¶å¼ºåˆ¶è‡ªåŠ¨ç»•è¿‡æŒ‡çº¹è®¤è¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä»£ç ç‰‡æ®µï¼Œæ¼”ç¤ºäº†åœ¨ Android æŒ‡çº¹ä¸Šä¸‹æ–‡ä¸­çš„ç»•è¿‡ï¼Œå®Œæ•´åº”ç”¨ç¨‹åºå¯åœ¨ [GitHub](https://github.com/St3v3nsS/InsecureBanking) ä¸Šè·å–ã€‚
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
è¿è¡Œ Frida è„šæœ¬çš„å‘½ä»¤ï¼š
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **æ–¹æ³• 2 â€“ å¼‚å¸¸å¤„ç†æ–¹æ³•**

å¦ä¸€ä¸ª [Frida è„šæœ¬](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) æ¥è‡ª WithSecureï¼Œæ—¨åœ¨ç»•è¿‡ä¸å®‰å…¨çš„åŠ å¯†å¯¹è±¡ä½¿ç”¨ã€‚è¯¥è„šæœ¬è°ƒç”¨ *onAuthenticationSucceeded*ï¼Œå¹¶ä½¿ç”¨æœªé€šè¿‡æŒ‡çº¹æˆæƒçš„ *CryptoObject*ã€‚å¦‚æœåº”ç”¨ç¨‹åºå°è¯•ä½¿ç”¨ä¸åŒçš„å¯†ç å¯¹è±¡ï¼Œå°†ä¼šè§¦å‘å¼‚å¸¸ã€‚è¯¥è„šæœ¬å‡†å¤‡è°ƒç”¨ *onAuthenticationSucceeded* å¹¶å¤„ç† _Cipher_ ç±»ä¸­çš„ *javax.crypto.IllegalBlockSizeException*ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºåç»­ä½¿ç”¨çš„å¯¹è±¡ä½¿ç”¨æ–°å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚

è¿è¡Œ Frida è„šæœ¬çš„å‘½ä»¤ï¼š
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
åœ¨åˆ°è¾¾æŒ‡çº¹å±å¹•å¹¶å¯åŠ¨ `authenticate()` æ—¶ï¼Œåœ¨ Frida æ§åˆ¶å°ä¸­è¾“å…¥ `bypass()` ä»¥æ¿€æ´»ç»•è¿‡ï¼š
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **æ–¹æ³• 3 â€“ æ’æ¡©æ¡†æ¶**

æ’æ¡©æ¡†æ¶å¦‚ Xposed æˆ– Frida å¯ç”¨äºåœ¨è¿è¡Œæ—¶é’©å…¥åº”ç”¨ç¨‹åºæ–¹æ³•ã€‚å¯¹äºæŒ‡çº¹è®¤è¯ï¼Œè¿™äº›æ¡†æ¶å¯ä»¥ï¼š

1. **æ¨¡æ‹Ÿè®¤è¯å›è°ƒ**ï¼šé€šè¿‡é’©å…¥ `BiometricPrompt.AuthenticationCallback` çš„ `onAuthenticationSucceeded`ã€`onAuthenticationFailed` æˆ– `onAuthenticationError` æ–¹æ³•ï¼Œæ‚¨å¯ä»¥æ§åˆ¶æŒ‡çº¹è®¤è¯è¿‡ç¨‹çš„ç»“æœã€‚
2. **ç»•è¿‡ SSL é’‰æ‰**ï¼šè¿™å…è®¸æ”»å‡»è€…æ‹¦æˆªå¹¶ä¿®æ”¹å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„æµé‡ï¼Œå¯èƒ½ä¼šæ”¹å˜è®¤è¯è¿‡ç¨‹æˆ–çªƒå–æ•æ„Ÿæ•°æ®ã€‚

Frida çš„ç¤ºä¾‹å‘½ä»¤ï¼š
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **æ–¹æ³• 4 â€“ é€†å‘å·¥ç¨‹ä¸ä»£ç ä¿®æ”¹**

é€†å‘å·¥ç¨‹å·¥å…·å¦‚ `APKTool`ã€`dex2jar` å’Œ `JD-GUI` å¯ç”¨äºåç¼–è¯‘ Android åº”ç”¨ç¨‹åºï¼Œé˜…è¯»å…¶æºä»£ç ï¼Œå¹¶ç†è§£å…¶èº«ä»½éªŒè¯æœºåˆ¶ã€‚æ­¥éª¤é€šå¸¸åŒ…æ‹¬ï¼š

1. **åç¼–è¯‘ APK**ï¼šå°† APK æ–‡ä»¶è½¬æ¢ä¸ºæ›´æ˜“è¯»çš„æ ¼å¼ï¼ˆå¦‚ Java ä»£ç ï¼‰ã€‚
2. **åˆ†æä»£ç **ï¼šæŸ¥æ‰¾æŒ‡çº¹èº«ä»½éªŒè¯çš„å®ç°ï¼Œå¹¶è¯†åˆ«æ½œåœ¨çš„å¼±ç‚¹ï¼ˆå¦‚åå¤‡æœºåˆ¶æˆ–ä¸å½“çš„éªŒè¯æ£€æŸ¥ï¼‰ã€‚
3. **é‡æ–°ç¼–è¯‘ APK**ï¼šåœ¨ä¿®æ”¹ä»£ç ä»¥ç»•è¿‡æŒ‡çº¹èº«ä»½éªŒè¯åï¼Œåº”ç”¨ç¨‹åºè¢«é‡æ–°ç¼–è¯‘ã€ç­¾åå¹¶å®‰è£…åˆ°è®¾å¤‡ä¸Šè¿›è¡Œæµ‹è¯•ã€‚

## **æ–¹æ³• 5 â€“ ä½¿ç”¨è‡ªå®šä¹‰èº«ä»½éªŒè¯å·¥å…·**

æœ‰ä¸“é—¨çš„å·¥å…·å’Œè„šæœ¬è®¾è®¡ç”¨äºæµ‹è¯•å’Œç»•è¿‡èº«ä»½éªŒè¯æœºåˆ¶ã€‚ä¾‹å¦‚ï¼š

1. **MAGISK æ¨¡å—**ï¼šMAGISK æ˜¯ä¸€ä¸ª Android å·¥å…·ï¼Œå…è®¸ç”¨æˆ·è·å–è®¾å¤‡çš„ root æƒé™å¹¶æ·»åŠ å¯ä»¥ä¿®æ”¹æˆ–ä¼ªé€ ç¡¬ä»¶çº§ä¿¡æ¯ï¼ˆåŒ…æ‹¬æŒ‡çº¹ï¼‰çš„æ¨¡å—ã€‚
2. **è‡ªå®šä¹‰è„šæœ¬**ï¼šå¯ä»¥ç¼–å†™è„šæœ¬ä¸ Android è°ƒè¯•æ¡¥ï¼ˆADBï¼‰æˆ–ç›´æ¥ä¸åº”ç”¨ç¨‹åºçš„åç«¯äº¤äº’ï¼Œä»¥æ¨¡æ‹Ÿæˆ–ç»•è¿‡æŒ‡çº¹èº«ä»½éªŒè¯ã€‚

## å‚è€ƒæ–‡çŒ®
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
