# Bypass Biometric Authentication (Android)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Metoda 1 â€“ OminiÄ™cie bez uÅ¼ycia obiektu Crypto**

Skupiamy siÄ™ tutaj na *onAuthenticationSucceeded* callback, ktÃ³ry jest kluczowy w procesie uwierzytelniania. Badacze z WithSecure opracowali [skrypt Frida](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js), umoÅ¼liwiajÄ…cy ominiÄ™cie NULL *CryptoObject* w *onAuthenticationSucceeded(...)*. Skrypt wymusza automatyczne ominiÄ™cie uwierzytelniania odciskiem palca po wywoÅ‚aniu metody. PoniÅ¼ej znajduje siÄ™ uproszczony fragment demonstrujÄ…cy ominiÄ™cie w kontekÅ›cie Android Fingerprint, z peÅ‚nÄ… aplikacjÄ… dostÄ™pnÄ… na [GitHub](https://github.com/St3v3nsS/InsecureBanking).
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
Polecenie do uruchomienia skryptu Frida:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **Metoda 2 â€“ PodejÅ›cie do obsÅ‚ugi wyjÄ…tkÃ³w**

Inny [skrypt Frida](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) od WithSecure dotyczy omijania niebezpiecznego uÅ¼ycia obiektu kryptograficznego. Skrypt wywoÅ‚uje *onAuthenticationSucceeded* z *CryptoObject*, ktÃ³ry nie zostaÅ‚ autoryzowany przez odcisk palca. JeÅ›li aplikacja sprÃ³buje uÅ¼yÄ‡ innego obiektu szyfrujÄ…cego, spowoduje to wystÄ…pienie wyjÄ…tku. Skrypt przygotowuje siÄ™ do wywoÅ‚ania *onAuthenticationSucceeded* i obsÅ‚ugi *javax.crypto.IllegalBlockSizeException* w klasie _Cipher_, zapewniajÄ…c, Å¼e kolejne obiekty uÅ¼ywane przez aplikacjÄ™ sÄ… szyfrowane nowym kluczem.

Polecenie do uruchomienia skryptu Frida:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
Po dotarciu do ekranu odcisku palca i rozpoczÄ™ciu `authenticate()`, wpisz `bypass()` w konsoli Frida, aby aktywowaÄ‡ obejÅ›cie:
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **Metoda 3 â€“ Ramy Instrumentacji**

Ramy instrumentacji, takie jak Xposed lub Frida, mogÄ… byÄ‡ uÅ¼ywane do podÅ‚Ä…czania siÄ™ do metod aplikacji w czasie rzeczywistym. W przypadku uwierzytelniania za pomocÄ… odcisku palca, te ramy mogÄ…:

1. **ZasymulowaÄ‡ WywoÅ‚ania Uwierzytelniania**: Poprzez podÅ‚Ä…czenie siÄ™ do metod `onAuthenticationSucceeded`, `onAuthenticationFailed` lub `onAuthenticationError` klasy `BiometricPrompt.AuthenticationCallback`, moÅ¼esz kontrolowaÄ‡ wynik procesu uwierzytelniania odcisku palca.
2. **ObejÅ›Ä‡ SSL Pinning**: To pozwala atakujÄ…cemu na przechwycenie i modyfikacjÄ™ ruchu miÄ™dzy klientem a serwerem, potencjalnie zmieniajÄ…c proces uwierzytelniania lub kradnÄ…c wraÅ¼liwe dane.

PrzykÅ‚adowe polecenie dla Frida:
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **Metoda 4 â€“ InÅ¼ynieria wsteczna i modyfikacja kodu**

NarzÄ™dzia do inÅ¼ynierii wstecznej, takie jak `APKTool`, `dex2jar` i `JD-GUI`, mogÄ… byÄ‡ uÅ¼ywane do dekompilacji aplikacji na Androida, odczytania jej kodu ÅºrÃ³dÅ‚owego i zrozumienia mechanizmu uwierzytelniania. Kroki zazwyczaj obejmujÄ…:

1. **Dekompilacja APK**: Konwersja pliku APK na bardziej czytelny format (np. kod Java).
2. **Analiza kodu**: Szukanie implementacji uwierzytelniania za pomocÄ… odcisku palca i identyfikacja potencjalnych sÅ‚aboÅ›ci (np. mechanizmy zapasowe lub niewÅ‚aÅ›ciwe kontrole walidacji).
3. **Rekompilacja APK**: Po modyfikacji kodu w celu ominiÄ™cia uwierzytelniania za pomocÄ… odcisku palca, aplikacja jest rekompilowana, podpisywana i instalowana na urzÄ…dzeniu do testowania.

## **Metoda 5 â€“ UÅ¼ycie niestandardowych narzÄ™dzi uwierzytelniajÄ…cych**

IstniejÄ… specjalistyczne narzÄ™dzia i skrypty zaprojektowane do testowania i omijania mechanizmÃ³w uwierzytelniania. Na przykÅ‚ad:

1. **ModuÅ‚y MAGISK**: MAGISK to narzÄ™dzie dla Androida, ktÃ³re pozwala uÅ¼ytkownikom na rootowanie swoich urzÄ…dzeÅ„ i dodawanie moduÅ‚Ã³w, ktÃ³re mogÄ… modyfikowaÄ‡ lub faÅ‚szowaÄ‡ informacje na poziomie sprzÄ™towym, w tym odciski palcÃ³w.
2. **Niestandardowe skrypty**: Skrypty mogÄ… byÄ‡ pisane w celu interakcji z Android Debug Bridge (ADB) lub bezpoÅ›rednio z backendem aplikacji, aby symulowaÄ‡ lub omijaÄ‡ uwierzytelnianie za pomocÄ… odcisku palca.

## Odniesienia
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ trikami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na GitHubie.

</details>
{% endhint %}
