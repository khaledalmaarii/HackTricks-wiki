# Bypass Biometric Authentication (Android)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **M√©todo 1 ‚Äì Bypass sem Uso de Crypto Object**

O foco aqui est√° no callback *onAuthenticationSucceeded*, que √© crucial no processo de autentica√ß√£o. Pesquisadores da WithSecure desenvolveram um [script Frida](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js), permitindo o bypass do *CryptoObject* NULL em *onAuthenticationSucceeded(...)*. O script for√ßa um bypass autom√°tico da autentica√ß√£o por impress√£o digital ao invocar o m√©todo. Abaixo est√° um trecho simplificado demonstrando o bypass em um contexto de Impress√£o Digital Android, com a aplica√ß√£o completa dispon√≠vel no [GitHub](https://github.com/St3v3nsS/InsecureBanking).
```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```
Comando para executar o script Frida:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```
## **M√©todo 2 ‚Äì Abordagem de Tratamento de Exce√ß√µes**

Outro [script Frida](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) da WithSecure aborda a contornagem do uso inseguro de objetos criptogr√°ficos. O script invoca *onAuthenticationSucceeded* com um *CryptoObject* que n√£o foi autorizado por uma impress√£o digital. Se o aplicativo tentar usar um objeto de cifra diferente, isso acionar√° uma exce√ß√£o. O script se prepara para invocar *onAuthenticationSucceeded* e tratar a *javax.crypto.IllegalBlockSizeException* na classe _Cipher_, garantindo que os objetos subsequentes usados pelo aplicativo sejam criptografados com a nova chave.

Comando para executar o script Frida:
```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```
Ao chegar na tela de impress√£o digital e na inicia√ß√£o de `authenticate()`, digite `bypass()` no console do Frida para ativar o bypass:
```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```
## **M√©todo 3 ‚Äì Frameworks de Instrumenta√ß√£o**

Frameworks de instrumenta√ß√£o como Xposed ou Frida podem ser usados para interceptar m√©todos de aplicativos em tempo de execu√ß√£o. Para autentica√ß√£o por impress√£o digital, esses frameworks podem:

1. **Simular os Callbacks de Autentica√ß√£o**: Ao interceptar os m√©todos `onAuthenticationSucceeded`, `onAuthenticationFailed` ou `onAuthenticationError` do `BiometricPrompt.AuthenticationCallback`, voc√™ pode controlar o resultado do processo de autentica√ß√£o por impress√£o digital.
2. **Contornar o SSL Pinning**: Isso permite que um atacante intercepte e modifique o tr√°fego entre o cliente e o servidor, potencialmente alterando o processo de autentica√ß√£o ou roubando dados sens√≠veis.

Exemplo de comando para Frida:
```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```
## **M√©todo 4 ‚Äì Engenharia Reversa & Modifica√ß√£o de C√≥digo**

Ferramentas de engenharia reversa como `APKTool`, `dex2jar` e `JD-GUI` podem ser usadas para descompilar um aplicativo Android, ler seu c√≥digo-fonte e entender seu mecanismo de autentica√ß√£o. Os passos geralmente incluem:

1. **Descompilando o APK**: Converter o arquivo APK para um formato mais leg√≠vel por humanos (como c√≥digo Java).
2. **Analisando o C√≥digo**: Procurar pela implementa√ß√£o da autentica√ß√£o por impress√£o digital e identificar poss√≠veis fraquezas (como mecanismos de fallback ou verifica√ß√µes de valida√ß√£o inadequadas).
3. **Recompilando o APK**: Ap√≥s modificar o c√≥digo para contornar a autentica√ß√£o por impress√£o digital, o aplicativo √© recompilado, assinado e instalado no dispositivo para testes.

## **M√©todo 5 ‚Äì Usando Ferramentas de Autentica√ß√£o Personalizadas**

Existem ferramentas e scripts especializados projetados para testar e contornar mecanismos de autentica√ß√£o. Por exemplo:

1. **M√≥dulos MAGISK**: MAGISK √© uma ferramenta para Android que permite aos usu√°rios fazer root em seus dispositivos e adicionar m√≥dulos que podem modificar ou falsificar informa√ß√µes em n√≠vel de hardware, incluindo impress√µes digitais.
2. **Scripts Personalizados**: Scripts podem ser escritos para interagir com o Android Debug Bridge (ADB) ou diretamente com o backend do aplicativo para simular ou contornar a autentica√ß√£o por impress√£o digital.

## Refer√™ncias
* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
