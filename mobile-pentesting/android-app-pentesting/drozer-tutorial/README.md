# Samouczek Drozera

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Wskaz贸wka dotyczca nagr贸d za bdy**: **Zarejestruj si** na platformie **Intigriti**, premium **platformie nagr贸d za bdy stworzonej przez haker贸w, dla haker贸w**! Docz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ju偶 dzi i zacznij zarabia nagrody a偶 do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## APKs do testowania

* [Sieve](https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk) (od mrwlabs)
* [DIVA](https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz)

**Czci tego samouczka zostay wyodrbnione z** [**dokumentacji Drozera w formacie pdf**](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)**.**

## Instalacja

Zainstaluj klienta Drozera w swoim hostingu. Pobierz go z [najnowszych wyda](https://github.com/mwrlabs/drozer/releases).
```bash
pip install drozer-2.4.4-py2-none-any.whl
pip install twisted
pip install service_identity
```
Pobierz i zainstaluj plik APK drozera z [najnowszych wyda](https://github.com/mwrlabs/drozer/releases). W tym momencie jest to [ten](https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk).
```bash
adb install drozer.apk
```
### Uruchamianie serwera

Agent dziaa na porcie 31415, musimy przekierowa port, aby nawiza komunikacj midzy klientem Drozer a Agentem, oto polecenie do wykonania:
```bash
adb forward tcp:31415 tcp:31415
```
Wreszcie **uruchom** **aplikacj** i nacinij przycisk "**ON**" na dole

![](<../../../.gitbook/assets/image (459).png>)

Nastpnie pocz si z ni:
```bash
drozer console connect
```
## Interesujce polecenia

| **Polecenia**   | **Opis**                                                                                                                                                |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Help MODULE** | Wywietla pomoc wybranego moduu                                                                                                                       |
| **list**        | Pokazuje list wszystkich modu贸w drozera, kt贸re mo偶na wykona w bie偶cej sesji. Ukrywa moduy, kt贸rych nie masz odpowiednich uprawnie do uruchomienia. |
| **shell**       | Uruchamia interaktywn powok Linux na urzdzeniu, w kontekcie Agenta.                                                                               |
| **clean**       | Usuwa tymczasowe pliki przechowywane przez drozera na urzdzeniu z systemem Android.                                                                   |
| **load**        | Wczytuje plik zawierajcy polecenia drozera i wykonuje je sekwencyjnie.                                                                                 |
| **module**      | Znajduje i instaluje dodatkowe moduy drozera z Internetu.                                                                                             |
| **unset**       | Usuwa nazwan zmienn, kt贸r drozer przekazuje do wszystkich powok Linuxa, kt贸re uruchamia.                                                            |
| **set**         | Przechowuje warto w zmiennej, kt贸ra zostanie przekazana jako zmienna rodowiskowa do wszystkich powok Linuxa uruchamianych przez drozera.            |
| **shell**       | Uruchamia interaktywn powok Linux na urzdzeniu, w kontekcie Agenta.                                                                               |
| **run MODULE**  | Wykonuje modu drozera.                                                                                                                                |
| **exploit**     | Drozer mo偶e tworzy eksploity do wykonania na urzdzeniu. `drozer exploit list`                                                                         |
| **payload**     | Eksploity wymagaj adunku. `drozer payload list`                                                                                                       |

### Pakiet

Znajd藕 **nazw** pakietu, filtrowanie po czci nazwy:
```bash
dz> run app.package.list -f sieve
com.mwr.example.sieve
```
**Podstawowe informacje** o pakiecie:
```bash
dz> run app.package.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Process Name: com.mwr.example.sieve
Version: 1.0
Data Directory: /data/data/com.mwr.example.sieve
APK Path: /data/app/com.mwr.example.sieve-2.apk
UID: 10056
GID: [1028, 1015, 3003]
Shared Libraries: null
Shared User ID: null
Uses Permissions:
- android.permission.READ_EXTERNAL_STORAGE
- android.permission.WRITE_EXTERNAL_STORAGE
- android.permission.INTERNET
Defines Permissions:
- com.mwr.example.sieve.READ_KEYS
- com.mwr.example.sieve.WRITE_KEYS
```
Przeczytaj **Manifest**:
```bash
run app.package.manifest jakhar.aseem.diva
```
**Powierzchnia ataku** pakietu:
```bash
dz> run app.package.attacksurface com.mwr.example.sieve
Attack Surface:
3 activities exported
0 broadcast receivers exported
2 content providers exported
2 services exported
is debuggable
```
* **Aktywnoci**: By mo偶e mo偶esz uruchomi aktywno i omin pewnego rodzaju autoryzacj, kt贸ra powinna ci powstrzyma przed jej uruchomieniem.
* **Dostawcy treci**: By mo偶e mo偶esz uzyska dostp do prywatnych danych lub wykorzysta jakie podatnoci (wstrzyknicie SQL lub Traversal cie偶ki).
* **Usugi**:
* **is debuggable**: [Dowiedz si wicej](./#is-debuggeable)

### Aktywnoci

Warto "android:exported" skonfigurowana na **"true"** dla skadowej aktywnoci eksportowanej w pliku AndroidManifest.xml:
```markup
<activity android:name="com.my.app.Initial" android:exported="true">
</activity>
```
**Lista wyeksportowanych aktywnoci**:
```bash
dz> run app.activity.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList
```
**Rozpoczcie aktywnoci**:

By mo偶e mo偶esz rozpocz aktywno i omin pewnego rodzaju autoryzacj, kt贸ra powinna ci powstrzyma przed jej uruchomieniem.

{% code overflow="wrap" %}
```bash
dz> run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
```
{% endcode %}

Mo偶esz tak偶e uruchomi wyeksportowan aktywno za pomoc **adb**:

* Nazwa pakietu to com.example.demo
* Nazwa wyeksportowanej aktywnoci to com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
### Dostawcy treci

Ten post by tak du偶y, 偶eby by tutaj, wic **mo偶esz** [**uzyska do niego dostp na wasnej stronie tutaj**](exploiting-content-providers.md).

### Usugi

Usuga eksportowana jest deklarowana wewntrz Manifest.xml:

{% code overflow="wrap" %}
```markup
<service android:name=".AuthService" android:exported="true" android:process=":remote"/>
```
{% endcode %}

Wewntrz kodu **sprawd藕** funkcj \*\*`handleMessage`\*\*, kt贸ra bdzie **odbiera** **wiadomo**:

![](<../../../.gitbook/assets/image (82).png>)

#### Lista usug
```bash
dz> run app.service.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.AuthService
Permission: null
com.mwr.example.sieve.CryptoService
Permission: null
```
#### **Komunikacja** z usug
```bash
app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
```
#### Przykad

Sp贸jrz na pomoc **drozera** dla `app.service.send`:

![](<../../../.gitbook/assets/image (1079).png>)

Zauwa偶, 偶e najpierw zostan wysane dane znajdujce si w "_msg.what_", nastpnie "_msg.arg1_" i "_msg.arg2_", powiniene sprawdzi w kodzie **jakie informacje s u偶ywane** i gdzie.\
Korzystajc z opcji `--extra`, mo偶esz wysa co zinterpretowanego przez "_msg.replyTo"_, a korzystajc z `--bundle-as-obj` tworzysz obiekt z podanymi szczeg贸ami.

W poni偶szym przykadzie:

* `what == 2354`
* `arg1 == 9234`
* `arg2 == 1`
* `replyTo == object(string com.mwr.example.sieve.PIN 1337)`
```bash
run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg 2354 9234 1 --extra string com.mwr.example.sieve.PIN 1337 --bundle-as-obj
```
![](<../../../.gitbook/assets/image (647).png>)

### Odbiorniki nadawcze

**W sekcji podstawowych informacji o Androidzie mo偶esz zobaczy, co to jest odbiornik nadawczy**.

Po odkryciu tych odbiornik贸w nadawczych powiniene **sprawdzi ich kod**. Zwr贸 szczeg贸ln uwag na funkcj **`onReceive`**, poniewa偶 to wanie ona bdzie obsugiwa otrzymane wiadomoci.

#### Wykryj wszystkie odbiorniki nadawcze
```bash
run app.broadcast.info #Detects all
```
#### Sprawd藕 odbiorniki nadawcze aplikacji
```bash
#Check one negative
run app.broadcast.info -a jakhar.aseem.diva
Package: jakhar.aseem.diva
No matching receivers.

# Check one positive
run app.broadcast.info -a com.google.android.youtube
Package: com.google.android.youtube
com.google.android.libraries.youtube.player.PlayerUiModule$LegacyMediaButtonIntentReceiver
Permission: null
com.google.android.apps.youtube.app.common.notification.GcmBroadcastReceiver
Permission: com.google.android.c2dm.permission.SEND
com.google.android.apps.youtube.app.PackageReplacedReceiver
Permission: null
com.google.android.libraries.youtube.account.AccountsChangedReceiver
Permission: null
com.google.android.apps.youtube.app.application.system.LocaleUpdatedReceiver
Permission: null
```
#### Interakcje **Broadcast**
```bash
app.broadcast.info          Get information about broadcast receivers
app.broadcast.send          Send broadcast using an intent
app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
```
#### Wylij wiadomo

W tym przykadzie wykorzystujc apk [FourGoats apk](https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk) Content Provider mo偶esz **wysa dowolny SMS** do dowolnego niepremiumowego odbiorcy **bez pytania** u偶ytkownika o zgod.

![](<../../../.gitbook/assets/image (415).png>)

![](<../../../.gitbook/assets/image (573).png>)

Jeli przeczytasz kod, parametry "_phoneNumber_" i "_message_" musz zosta przesane do Content Providera.
```bash
run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message "Hello mate!"
```
### Jest mo偶liwe debugowanie

Produkcyjny plik APK nigdy nie powinien by debuggowalny.\
Oznacza to, 偶e mo偶esz **doczy debugger Javy** do dziaajcej aplikacji, inspekcjonowa j w czasie rzeczywistym, ustawia punkty przerwania, krok po kroku przechodzi przez kod, zbiera wartoci zmiennych, a nawet je zmienia. [Instytut InfoSec ma doskonay artyku](../exploiting-a-debuggeable-application.md) na temat zagbiania si w aplikacj debuggowaln i wstrzykiwania kodu w czasie wykonania.

Gdy aplikacja jest debuggowalna, pojawi si to w manifecie:
```xml
<application theme="@2131296387" debuggable="true"
```
Mo偶esz znale藕 wszystkie aplikacje z mo偶liwoci debugowania za pomoc **Drozera**:
```bash
run app.package.debuggable
```
## Samouczki

* [https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref](https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref)
* [https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md](https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md)
* [https://www.hackingarticles.in/android-penetration-testing-drozer/](https://www.hackingarticles.in/android-penetration-testing-drozer/)
* [https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac](https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac)

## Wicej informacji

* [https://blog.dixitaditya.com/android-pentesting-cheatsheet/](https://blog.dixitaditya.com/android-pentesting-cheatsheet/)

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Wskaz贸wka dotyczca nagrody za bd**: **zarejestruj si** na platformie **Intigriti**, premium **platformie do nagr贸d za bdy stworzonej przez haker贸w, dla haker贸w**! Docz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ju偶 dzi i zacznij zarabia nagrody a偶 do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Zacznij od zera i zosta ekspertem AWS w dziedzinie hakerskiej z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
