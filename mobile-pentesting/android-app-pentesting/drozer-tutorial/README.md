# Drozer Tutorial

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty ipucu**: **Intigriti'ye kaydolun**, hackerlar tarafÄ±ndan, hackerlar iÃ§in oluÅŸturulmuÅŸ bir premium **bug bounty platformu**! BugÃ¼n [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresine katÄ±lÄ±n ve **$100,000**'a kadar Ã¶dÃ¼ller kazanmaya baÅŸlayÄ±n!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Test edilecek APK'lar

* [Sieve](https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk) (mrwlabs'dan)
* [DIVA](https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz)

**Bu eÄŸitimin bazÄ± bÃ¶lÃ¼mleri** [**Drozer belgeleri pdf'inden**](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)** alÄ±nmÄ±ÅŸtÄ±r.**

## Kurulum

Drozer Client'Ä± ana bilgisayarÄ±nÄ±za kurun. [en son sÃ¼rÃ¼mlerden](https://github.com/mwrlabs/drozer/releases) indirin.
```bash
pip install drozer-2.4.4-py2-none-any.whl
pip install twisted
pip install service_identity
```
drozer APK'sÄ±nÄ± [en son sÃ¼rÃ¼mlerden](https://github.com/mwrlabs/drozer/releases) indirin ve kurun. Åu anda bu [sÃ¼rÃ¼m](https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk).
```bash
adb install drozer.apk
```
### Sunucuyu BaÅŸlatma

Agent 31415 portunda Ã§alÄ±ÅŸÄ±yor, Drozer Client ve Agent arasÄ±nda iletiÅŸimi saÄŸlamak iÃ§in [port yÃ¶nlendirmesi](https://en.wikipedia.org/wiki/Port\_forwarding) yapmamÄ±z gerekiyor, iÅŸte bunu yapmak iÃ§in komut:
```bash
adb forward tcp:31415 tcp:31415
```
Son olarak, **uygulamayÄ±** baÅŸlatÄ±n ve alt kÄ±sÄ±mdaki "**AÃ‡**" butonuna basÄ±n.

![](<../../../.gitbook/assets/image (459).png>)

Ve ona baÄŸlanÄ±n:
```bash
drozer console connect
```
## Ä°lginÃ§ Komutlar

| **Komutlar**    | **AÃ§Ä±klama**                                                                                                                                         |
| --------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Help MODULE** | SeÃ§ilen modÃ¼lÃ¼n yardÄ±mÄ±nÄ± gÃ¶sterir                                                                                                                 |
| **list**        | Mevcut oturumda Ã§alÄ±ÅŸtÄ±rÄ±labilecek tÃ¼m drozer modÃ¼llerinin listesini gÃ¶sterir. Bu, Ã§alÄ±ÅŸtÄ±rmak iÃ§in uygun izinlere sahip olmadÄ±ÄŸÄ±nÄ±z modÃ¼lleri gizler. |
| **shell**       | Cihazda, Agent baÄŸlamÄ±nda etkileÅŸimli bir Linux kabuÄŸu baÅŸlatÄ±r.                                                                                     |
| **clean**       | Android cihazÄ±nda drozer tarafÄ±ndan saklanan geÃ§ici dosyalarÄ± kaldÄ±rÄ±r.                                                                              |
| **load**        | Drozer komutlarÄ±nÄ± iÃ§eren bir dosyayÄ± yÃ¼kler ve bunlarÄ± sÄ±rayla Ã§alÄ±ÅŸtÄ±rÄ±r.                                                                          |
| **module**      | Ä°nternetten ek drozer modÃ¼llerini bulur ve yÃ¼kler.                                                                                                   |
| **unset**       | Drozer'in oluÅŸturduÄŸu herhangi bir Linux kabuÄŸuna geÃ§irdiÄŸi adlandÄ±rÄ±lmÄ±ÅŸ bir deÄŸiÅŸkeni kaldÄ±rÄ±r.                                                   |
| **set**         | Drozer tarafÄ±ndan oluÅŸturulan herhangi bir Linux kabuÄŸuna Ã§evresel deÄŸiÅŸken olarak geÃ§irilecek bir deÄŸiÅŸkende bir deÄŸeri saklar.                     |
| **shell**       | Cihazda, Agent baÄŸlamÄ±nda etkileÅŸimli bir Linux kabuÄŸu baÅŸlatÄ±r.                                                                                     |
| **run MODULE**  | Bir drozer modÃ¼lÃ¼nÃ¼ Ã§alÄ±ÅŸtÄ±rÄ±r                                                                                                                       |
| **exploit**     | Drozer, cihazda Ã§alÄ±ÅŸtÄ±rmak iÃ§in istismarlar oluÅŸturabilir. `drozer exploit list`                                                                    |
| **payload**     | Ä°stismarlarÄ±n bir yÃ¼kÃ¼ gereklidir. `drozer payload list`                                                                                             |

### Paket

**Ad** kÄ±smÄ±nÄ± filtreleyerek paketin **adÄ±nÄ±** bulun:
```bash
dz> run app.package.list -f sieve
com.mwr.example.sieve
```
**Paketin Temel Bilgileri:**
```bash
dz> run app.package.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Process Name: com.mwr.example.sieve
Version: 1.0
Data Directory: /data/data/com.mwr.example.sieve
APK Path: /data/app/com.mwr.example.sieve-2.apk
UID: 10056
GID: [1028, 1015, 3003]
Shared Libraries: null
Shared User ID: null
Uses Permissions:
- android.permission.READ_EXTERNAL_STORAGE
- android.permission.WRITE_EXTERNAL_STORAGE
- android.permission.INTERNET
Defines Permissions:
- com.mwr.example.sieve.READ_KEYS
- com.mwr.example.sieve.WRITE_KEYS
```
**Manifest**'i Oku:
```bash
run app.package.manifest jakhar.aseem.diva
```
**Paketin** saldÄ±rÄ± yÃ¼zeyi:
```bash
dz> run app.package.attacksurface com.mwr.example.sieve
Attack Surface:
3 activities exported
0 broadcast receivers exported
2 content providers exported
2 services exported
is debuggable
```
* **Aktiviteler**: Belki bir aktivite baÅŸlatabilir ve sizi baÅŸlatmaktan alÄ±koymasÄ± gereken bir tÃ¼r yetkilendirmeyi atlayabilirsiniz.
* **Ä°Ã§erik saÄŸlayÄ±cÄ±larÄ±**: Belki Ã¶zel verilere eriÅŸebilir veya bazÄ± zayÄ±flÄ±klarÄ± (SQL Injection veya Path Traversal) istismar edebilirsiniz.
* **Hizmetler**:
* **debuggable**: [Daha fazla bilgi edinin](./#is-debuggeable)

### Aktiviteler

Bir dÄ±ÅŸa aktarÄ±lmÄ±ÅŸ aktivite bileÅŸeninin â€œandroid:exportedâ€ deÄŸeri AndroidManifest.xml dosyasÄ±nda **â€œtrueâ€** olarak ayarlanmÄ±ÅŸtÄ±r:
```markup
<activity android:name="com.my.app.Initial" android:exported="true">
</activity>
```
**DÄ±ÅŸa aktarÄ±lan aktiviteleri listele**:
```bash
dz> run app.activity.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList
```
**EtkinliÄŸi baÅŸlat**:

Belki bir etkinliÄŸi baÅŸlatabilir ve sizi baÅŸlatmaktan alÄ±koymasÄ± gereken bir tÃ¼r yetkilendirmeyi atlayabilirsiniz.

{% code overflow="wrap" %}
```bash
dz> run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
```
{% endcode %}

**adb** Ã¼zerinden bir dÄ±ÅŸa aktarÄ±lan aktiviteyi de baÅŸlatabilirsiniz:

* Paket AdÄ± com.example.demo
* DÄ±ÅŸa AktarÄ±lan Aktivite AdÄ± com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
### Ä°Ã§erik SaÄŸlayÄ±cÄ±larÄ±

Bu gÃ¶nderi burada Ã§ok bÃ¼yÃ¼k olduÄŸu iÃ§in **buradan** [**kendi sayfasÄ±nda eriÅŸebilirsiniz**](exploiting-content-providers.md).

### Hizmetler

DÄ±ÅŸa aktarÄ±lan bir hizmet, Manifest.xml iÃ§inde tanÄ±mlanÄ±r:

{% code overflow="wrap" %}
```markup
<service android:name=".AuthService" android:exported="true" android:process=":remote"/>
```
{% endcode %}

Kodun iÃ§inde **check** iÃ§in \*\*`handleMessage`\*\* fonksiyonunu kontrol edin, bu fonksiyon **mesajÄ±** **alacaktÄ±r**:

![](<../../../.gitbook/assets/image (82).png>)

#### Liste hizmeti
```bash
dz> run app.service.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.AuthService
Permission: null
com.mwr.example.sieve.CryptoService
Permission: null
```
#### **Bir hizmetle** etkileÅŸim kurun
```bash
app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
```
#### Ã–rnek

Take a look to the **drozer** help for `app.service.send`:

![](<../../../.gitbook/assets/image (1079).png>)

Not edin ki Ã¶nce "_msg.what_" iÃ§indeki veriyi, sonra "_msg.arg1_" ve "_msg.arg2_" gÃ¶ndereceksiniz, **hangi bilginin kullanÄ±ldÄ±ÄŸÄ±nÄ±** ve nerede olduÄŸunu kod iÃ§inde kontrol etmelisiniz.\
`--extra` seÃ§eneÄŸini kullanarak "_msg.replyTo"_'dan yorumlanan bir ÅŸey gÃ¶nderebilirsiniz ve `--bundle-as-obj` kullanarak saÄŸlanan detaylarla bir nesne oluÅŸturursunuz.

AÅŸaÄŸÄ±daki Ã¶rnekte:

* `what == 2354`
* `arg1 == 9234`
* `arg2 == 1`
* `replyTo == object(string com.mwr.example.sieve.PIN 1337)`
```bash
run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg 2354 9234 1 --extra string com.mwr.example.sieve.PIN 1337 --bundle-as-obj
```
![](<../../../.gitbook/assets/image (647).png>)

### Broadcast AlÄ±cÄ±larÄ±

**Android temel bilgi bÃ¶lÃ¼mÃ¼nde Broadcast AlÄ±cÄ±sÄ±nÄ±n ne olduÄŸunu gÃ¶rebilirsiniz**.

Bu Broadcast AlÄ±cÄ±larÄ±nÄ± keÅŸfettikten sonra, **kodlarÄ±nÄ± kontrol etmelisiniz**. AlÄ±nan mesajlarÄ± iÅŸleyen **`onReceive`** fonksiyonuna Ã¶zel dikkat gÃ¶sterin.

#### **TÃ¼m** broadcast alÄ±cÄ±larÄ±nÄ± tespit et
```bash
run app.broadcast.info #Detects all
```
#### Bir uygulamanÄ±n yayÄ±n alÄ±cÄ±larÄ±nÄ± kontrol et
```bash
#Check one negative
run app.broadcast.info -a jakhar.aseem.diva
Package: jakhar.aseem.diva
No matching receivers.

# Check one positive
run app.broadcast.info -a com.google.android.youtube
Package: com.google.android.youtube
com.google.android.libraries.youtube.player.PlayerUiModule$LegacyMediaButtonIntentReceiver
Permission: null
com.google.android.apps.youtube.app.common.notification.GcmBroadcastReceiver
Permission: com.google.android.c2dm.permission.SEND
com.google.android.apps.youtube.app.PackageReplacedReceiver
Permission: null
com.google.android.libraries.youtube.account.AccountsChangedReceiver
Permission: null
com.google.android.apps.youtube.app.application.system.LocaleUpdatedReceiver
Permission: null
```
#### YayÄ±n **EtkileÅŸimleri**
```bash
app.broadcast.info          Get information about broadcast receivers
app.broadcast.send          Send broadcast using an intent
app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
```
#### Mesaj GÃ¶nder

Bu Ã¶rnekte [FourGoats apk](https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk) Ä°Ã§erik SaÄŸlayÄ±cÄ±sÄ±nÄ± kÃ¶tÃ¼ye kullanarak, kullanÄ±cÄ±dan izin **istemeden** herhangi bir premium olmayan hedefe **rastgele bir SMS** gÃ¶nderebilirsiniz.

![](<../../../.gitbook/assets/image (415).png>)

![](<../../../.gitbook/assets/image (573).png>)

Kodu okursanÄ±z, "_phoneNumber_" ve "_message_" parametrelerinin Ä°Ã§erik SaÄŸlayÄ±cÄ±sÄ±na gÃ¶nderilmesi gerektiÄŸini gÃ¶receksiniz.
```bash
run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message "Hello mate!"
```
### Debuggeable mÄ±

Bir prodÃ¼ksiyon APK'sÄ± asla debuggeable olmamalÄ±dÄ±r.\
Bu, Ã§alÄ±ÅŸmakta olan uygulamaya **java debugger** ekleyebileceÄŸiniz, Ã§alÄ±ÅŸma zamanÄ±nda inceleyebileceÄŸiniz, kesme noktalarÄ± ayarlayabileceÄŸiniz, adÄ±m adÄ±m ilerleyebileceÄŸiniz, deÄŸiÅŸken deÄŸerlerini toplayabileceÄŸiniz ve hatta bunlarÄ± deÄŸiÅŸtirebileceÄŸiniz anlamÄ±na gelir. [InfoSec institute'un harika bir makalesi var](../exploiting-a-debuggeable-applciation.md) uygulamanÄ±z debuggeable olduÄŸunda daha derinlemesine incelemek ve Ã§alÄ±ÅŸma zamanÄ± kodu enjekte etmek iÃ§in.

Bir uygulama debuggeable olduÄŸunda, Manifest'te gÃ¶rÃ¼necektir:
```xml
<application theme="@2131296387" debuggable="true"
```
**Drozer** ile tÃ¼m hata ayÄ±klanabilir uygulamalarÄ± bulabilirsiniz:
```bash
run app.package.debuggable
```
## EÄŸitimler

* [https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref](https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref)
* [https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md](https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md)
* [https://www.hackingarticles.in/android-penetration-testing-drozer/](https://www.hackingarticles.in/android-penetration-testing-drozer/)
* [https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac](https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac)

## Daha fazla bilgi

* [https://blog.dixitaditya.com/android-pentesting-cheatsheet/](https://blog.dixitaditya.com/android-pentesting-cheatsheet/)

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Hata Ã¶dÃ¼lÃ¼ ipucu**: **hackerlar tarafÄ±ndan, hackerlar iÃ§in oluÅŸturulmuÅŸ premium** **Intigriti**'ye **kaydolun**! BugÃ¼n [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresine katÄ±lÄ±n ve **$100,000**'a kadar Ã¶dÃ¼ller kazanmaya baÅŸlayÄ±n!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± Ekip UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± Ekip UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
