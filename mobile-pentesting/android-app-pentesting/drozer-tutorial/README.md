# Drozer æ•™ç¨‹

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶ **ç½‘ç»œå®‰å…¨å…¬å¸** å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„ **å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾— **PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬**å—ï¼Ÿè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘çš„ **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**èµé‡‘æ¼æ´æç¤º**ï¼š**æ³¨å†Œ** Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§ **èµé‡‘æ¼æ´å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾ **$100,000** çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## è¦æµ‹è¯•çš„ APK

* [Sieve](https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk) (æ¥è‡ª mrwlabs)
* [DIVA](https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz)

## å®‰è£…

åœ¨ä¸»æœºä¸Šå®‰è£… Drozer å®¢æˆ·ç«¯ã€‚ä» [æœ€æ–°ç‰ˆæœ¬](https://github.com/mwrlabs/drozer/releases) ä¸‹è½½å®ƒã€‚
```bash
pip install drozer-2.4.4-py2-none-any.whl
pip install twisted
pip install service_identity
```
ä»[æœ€æ–°ç‰ˆæœ¬](https://github.com/mwrlabs/drozer/releases)ä¸‹è½½å¹¶å®‰è£…drozer APKã€‚ç›®å‰çš„ç‰ˆæœ¬æ˜¯[è¿™ä¸ª](https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk)ã€‚
```
adb install drozer.apk
```
### å¯åŠ¨æœåŠ¡å™¨

ä»£ç†æ­£åœ¨ç«¯å£31415ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ[ç«¯å£è½¬å‘](https://en.wikipedia.org/wiki/Port\_forwarding)ä»¥å»ºç«‹Drozerå®¢æˆ·ç«¯å’Œä»£ç†ä¹‹é—´çš„é€šä¿¡ï¼Œä»¥ä¸‹æ˜¯æ‰§è¡Œæ­¤æ“ä½œçš„å‘½ä»¤ï¼š
```
adb forward tcp:31415 tcp:31415
```
æœ€åï¼Œ**å¯åŠ¨**åº”ç”¨ç¨‹åºå¹¶ç‚¹å‡»åº•éƒ¨çš„â€œ**ON**â€æŒ‰é’®ã€‚

![](<../../../.gitbook/assets/image (63).png>)

ç„¶åè¿æ¥åˆ°å®ƒï¼š
```
drozer console connect
```
## æœ‰è¶£çš„å‘½ä»¤

| **å‘½ä»¤**        | **æè¿°**                                                                                                                                                |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Help MODULE** | æ˜¾ç¤ºæ‰€é€‰æ¨¡å—çš„å¸®åŠ©ä¿¡æ¯                                                                                                                                  |
| **list**        | æ˜¾ç¤ºå½“å‰ä¼šè¯ä¸­å¯ä»¥æ‰§è¡Œçš„æ‰€æœ‰drozeræ¨¡å—çš„åˆ—è¡¨ã€‚è¿™å°†éšè—æ‚¨æ²¡æœ‰é€‚å½“æƒé™è¿è¡Œçš„æ¨¡å—ã€‚                                                                         |
| **shell**       | åœ¨è®¾å¤‡ä¸Šä»¥Agentçš„ä¸Šä¸‹æ–‡å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼Linux shellã€‚                                                                                                       |
| **clean**       | åˆ é™¤Androidè®¾å¤‡ä¸Šdrozerå­˜å‚¨çš„ä¸´æ—¶æ–‡ä»¶ã€‚                                                                                                                 |
| **load**        | åŠ è½½åŒ…å«drozerå‘½ä»¤å¹¶æŒ‰é¡ºåºæ‰§è¡Œå®ƒä»¬çš„æ–‡ä»¶ã€‚                                                                                                             |
| **module**      | ä»äº’è”ç½‘ä¸ŠæŸ¥æ‰¾å¹¶å®‰è£…é¢å¤–çš„drozeræ¨¡å—ã€‚                                                                                                                  |
| **unset**       | åˆ é™¤drozerä¼ é€’ç»™å®ƒç”Ÿæˆçš„ä»»ä½•Linux shellçš„å‘½åå˜é‡ã€‚                                                                                                      |
| **set**         | å°†ä¸€ä¸ªå€¼å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œè¯¥å˜é‡å°†ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ç»™drozerç”Ÿæˆçš„ä»»ä½•Linux shellã€‚                                                                              |
| **shell**       | åœ¨è®¾å¤‡ä¸Šä»¥Agentçš„ä¸Šä¸‹æ–‡å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼Linux shellã€‚                                                                                                       |
| **run MODULE**  | æ‰§è¡Œä¸€ä¸ªdrozeræ¨¡å—ã€‚                                                                                                                                    |
| **exploit**     | Drozerå¯ä»¥åˆ›å»ºåœ¨è®¾å¤‡ä¸Šæ‰§è¡Œçš„åˆ©ç”¨ç¨‹åºã€‚`drozer exploit list`                                                                                             |
| **payload**     | åˆ©ç”¨ç¨‹åºéœ€è¦ä¸€ä¸ªæœ‰æ•ˆè½½è·ã€‚`drozer payload list`                                                                                                         |

### åŒ…

é€šè¿‡éƒ¨åˆ†åç§°è¿‡æ»¤ï¼Œæ‰¾åˆ°åŒ…çš„**åç§°**ï¼š
```
dz> run app.package.list -f sieve
com.mwr.example.sieve
```
**è½¯ä»¶åŒ…çš„åŸºæœ¬ä¿¡æ¯**ï¼š

- **Package Name**: com.example.app
- **Version**: 1.0
- **Target SDK Version**: 28
- **Min SDK Version**: 21
- **Permissions**: INTERNET, ACCESS_NETWORK_STATE, READ_EXTERNAL_STORAGE, WRITE_EXTERNAL_STORAGE

---

**Installation**:

1. Download the APK file from the [link](https://example.com/app.apk).
2. Connect your Android device to your computer.
3. Open a terminal and navigate to the directory where the APK file is located.
4. Install the APK using the following command: `adb install app.apk`

---

**Usage**:

1. Launch the app on your Android device.
2. Explore the app's features and functionalities.
3. Take note of any suspicious behavior or vulnerabilities.
4. Use drozer to perform dynamic analysis and penetration testing on the app.

---

**Drozer Commands**:

- **`drozer console connect`**: Connects to the drozer server running on the Android device.
- **`run app.package.info -a com.example.app`**: Retrieves information about the target app.
- **`run app.package.attacksurface -a com.example.app`**: Identifies the attack surface of the target app.
- **`run app.package.manifest -a com.example.app`**: Retrieves the app's manifest file.
- **`run app.package.permissions -a com.example.app`**: Lists the permissions requested by the app.
- **`run app.package.broadcasts -a com.example.app`**: Lists the broadcast receivers registered by the app.
- **`run app.package.activities -a com.example.app`**: Lists the activities defined by the app.
- **`run app.package.services -a com.example.app`**: Lists the services provided by the app.
- **`run app.package.providers -a com.example.app`**: Lists the content providers exposed by the app.
- **`run app.package.exported -a com.example.app`**: Lists the exported components of the app.
- **`run app.package.urlschemes -a com.example.app`**: Lists the URL schemes handled by the app.
- **`run app.package.broadcast.send -a com.example.app --extra string message "Hello, World!"`**: Sends a broadcast to the app with an extra string message.
- **`run app.activity.start --component com.example.app/.MainActivity`**: Starts the specified activity of the app.
- **`run app.provider.query -a com.example.app --uri content://com.example.app/data`**: Queries the specified content provider of the app.
- **`run app.provider.insert -a com.example.app --uri content://com.example.app/data --string name "John Doe" --string email "johndoe@example.com"`**: Inserts data into the specified content provider of the app.
- **`run app.provider.delete -a com.example.app --uri content://com.example.app/data/1`**: Deletes data from the specified content provider of the app.
- **`run app.provider.update -a com.example.app --uri content://com.example.app/data/1 --string name "Jane Doe"`**: Updates data in the specified content provider of the app.
- **`run app.service.start -a com.example.app --action com.example.app.ACTION_START_SERVICE`**: Starts the specified service of the app.
- **`run app.service.stop -a com.example.app --action com.example.app.ACTION_STOP_SERVICE`**: Stops the specified service of the app.

---

**References**:

- [Drozer Documentation](https://github.com/FSecureLABS/drozer/wiki)
- [Drozer GitHub Repository](https://github.com/FSecureLABS/drozer)
```
dz> run app.package.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Process Name: com.mwr.example.sieve
Version: 1.0
Data Directory: /data/data/com.mwr.example.sieve
APK Path: /data/app/com.mwr.example.sieve-2.apk
UID: 10056
GID: [1028, 1015, 3003]
Shared Libraries: null
Shared User ID: null
Uses Permissions:
- android.permission.READ_EXTERNAL_STORAGE
- android.permission.WRITE_EXTERNAL_STORAGE
- android.permission.INTERNET
Defines Permissions:
- com.mwr.example.sieve.READ_KEYS
- com.mwr.example.sieve.WRITE_KEYS
```
é˜…è¯»**æ¸…å•**ï¼š
```
run app.package.manifest jakhar.aseem.diva
```
**æ”»å‡»é¢**çš„èŒƒå›´ï¼š
```
dz> run app.package.attacksurface com.mwr.example.sieve
Attack Surface:
3 activities exported
0 broadcast receivers exported
2 content providers exported
2 services exported
is debuggable
```
* **æ´»åŠ¨**ï¼šä¹Ÿè®¸ä½ å¯ä»¥å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨å¹¶ç»•è¿‡æŸç§åº”è¯¥é˜»æ­¢ä½ å¯åŠ¨çš„æˆæƒã€‚
* **å†…å®¹æä¾›è€…**ï¼šä¹Ÿè®¸ä½ å¯ä»¥è®¿é—®ç§æœ‰æ•°æ®æˆ–åˆ©ç”¨ä¸€äº›æ¼æ´ï¼ˆSQLæ³¨å…¥æˆ–è·¯å¾„éå†ï¼‰ã€‚
* **æœåŠ¡**ï¼š
* **is debuggable**ï¼š[äº†è§£æ›´å¤š](./#is-debuggeable)

### æ´»åŠ¨

åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­ï¼Œå¯¼å‡ºçš„æ´»åŠ¨ç»„ä»¶çš„â€œandroid:exportedâ€å€¼è¢«è®¾ç½®ä¸º**â€œtrueâ€**ï¼š
```markup
<activity android:name="com.my.app.Initial" android:exported="true">
</activity>
```
**åˆ—å‡ºå¯¼å‡ºçš„æ´»åŠ¨**ï¼š

To list the exported activities of an Android app, you can use the `drozer` tool. The exported activities are components of an app that can be accessed by other apps or external entities. These activities are declared in the app's manifest file with the `exported` attribute set to `true`.

To list the exported activities using `drozer`, follow these steps:

1. Install `drozer` on your computer and connect your Android device to it.
2. Open a terminal or command prompt and run the following command to start the `drozer` console:

   ```
   drozer console connect
   ```

3. Once the `drozer` console is open, run the following command to start the app's package:

   ```
   run app.package.list -f <package_name>
   ```

   Replace `<package_name>` with the package name of the app you want to analyze.

4. After running the above command, you will see a list of packages installed on the device. Find the package name of the app you want to analyze and note it down.

5. Run the following command to list the exported activities of the app:

   ```
   run app.activity.info -a <package_name>
   ```

   Replace `<package_name>` with the package name of the app you want to analyze.

6. The `drozer` tool will display a list of exported activities along with their corresponding details, such as the activity name, exported status, and intent filters.

By listing the exported activities of an Android app, you can identify potential security vulnerabilities and assess the app's security posture.
```bash
dz> run app.activity.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList
```
**å¯åŠ¨æ´»åŠ¨**ï¼š

ä¹Ÿè®¸ä½ å¯ä»¥å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨å¹¶ç»•è¿‡æŸç§åº”è¯¥é˜»æ­¢ä½ å¯åŠ¨å®ƒçš„æˆæƒã€‚ 

{% code overflow="wrap" %}
```bash
dz> run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
```
{% endcode %}

æ‚¨è¿˜å¯ä»¥é€šè¿‡**adb**å¯åŠ¨å¯¼å‡ºçš„æ´»åŠ¨ï¼š

* åŒ…åä¸ºcom.example.demo
* å¯¼å‡ºçš„æ´»åŠ¨åä¸ºcom.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
### å†…å®¹æä¾›è€…

è¿™ç¯‡æ–‡ç« å¤ªé•¿äº†ï¼Œæ‰€ä»¥**ä½ å¯ä»¥**[**åœ¨è¿™é‡Œè®¿é—®å®ƒçš„ç‹¬ç«‹é¡µé¢**](exploiting-content-providers.md)ã€‚

### æœåŠ¡

ä¸€ä¸ªå¯¼å‡ºçš„æœåŠ¡åœ¨ Manifest.xml ä¸­å£°æ˜ï¼š

{% code overflow="wrap" %}
```markup
<service android:name=".AuthService" android:exported="true" android:process=":remote"/>
```
{% endcode %}

åœ¨ä»£ç ä¸­æŸ¥æ‰¾`handleMessage`å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ¥æ”¶æ¶ˆæ¯ï¼š

![](<../../../.gitbook/assets/image (194).png>)

#### åˆ—å‡ºæœåŠ¡
```bash
dz> run app.service.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.AuthService
Permission: null
com.mwr.example.sieve.CryptoService
Permission: null
```
#### ä¸æœåŠ¡è¿›è¡Œäº¤äº’

To interact with a service, you can use the `run` command in drozer. This command allows you to execute various actions on the target service. The syntax for the `run` command is as follows:

```
run <module> <action> [options]
```

Here, `<module>` refers to the module you want to use, `<action>` refers to the action you want to perform, and `[options]` refers to any additional options or parameters required by the action.

For example, to interact with the `activity` module and launch an activity, you can use the following command:

```
run app.activity.start --component <component_name>
```

Replace `<component_name>` with the name of the component you want to launch.

You can also use the `run` command to perform other actions, such as sending intents, querying content providers, and executing shell commands. Each module has its own set of actions and options, so make sure to refer to the module's documentation for more information.

Remember to always exercise caution when interacting with a service, as certain actions may have unintended consequences or security implications.
```
app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
```
#### ç¤ºä¾‹

æŸ¥çœ‹`drozer`ä¸­`app.service.send`çš„å¸®åŠ©æ–‡æ¡£ï¼š

![](<../../../.gitbook/assets/image (196) (1).png>)

è¯·æ³¨æ„ï¼Œæ‚¨å°†é¦–å…ˆå‘é€ä½äº"_msg.what_"ã€"_msg.arg1_"å’Œ"_msg.arg2_"ä¸­çš„æ•°æ®ï¼Œæ‚¨åº”è¯¥åœ¨ä»£ç ä¸­æ£€æŸ¥**æ­£åœ¨ä½¿ç”¨çš„ä¿¡æ¯**ä»¥åŠå…¶ä½ç½®ã€‚\
ä½¿ç”¨`--extra`é€‰é¡¹ï¼Œæ‚¨å¯ä»¥å‘é€ç”±"_msg.replyTo"è§£é‡Šçš„å†…å®¹ï¼Œå¹¶ä½¿ç”¨`--bundle-as-obj`åˆ›å»ºä¸€ä¸ªåŒ…å«æä¾›çš„è¯¦ç»†ä¿¡æ¯çš„å¯¹è±¡ã€‚

åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼š

* `what == 2354`
* `arg1 == 9234`
* `arg2 == 1`
* `replyTo == object(string com.mwr.example.sieve.PIN 1337)`
```
run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg 2354 9234 1 --extra string com.mwr.example.sieve.PIN 1337 --bundle-as-obj
```
![](<../../../.gitbook/assets/image (195).png>)

### å¹¿æ’­æ¥æ”¶å™¨

Androidåº”ç”¨ç¨‹åºå¯ä»¥ä»Androidç³»ç»Ÿå’Œå…¶ä»–Androidåº”ç”¨ç¨‹åºå‘é€æˆ–æ¥æ”¶å¹¿æ’­æ¶ˆæ¯ï¼Œç±»ä¼¼äº[å‘å¸ƒ-è®¢é˜…](https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern)è®¾è®¡æ¨¡å¼ã€‚è¿™äº›å¹¿æ’­åœ¨æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿæ—¶å‘é€ã€‚ä¾‹å¦‚ï¼Œå½“ç³»ç»Ÿå¯åŠ¨æˆ–è®¾å¤‡å¼€å§‹å……ç”µæ—¶ï¼ŒAndroidç³»ç»Ÿä¼šå‘é€å¹¿æ’­ã€‚åº”ç”¨ç¨‹åºè¿˜å¯ä»¥å‘é€è‡ªå®šä¹‰å¹¿æ’­ï¼Œä¾‹å¦‚ï¼Œé€šçŸ¥å…¶ä»–åº”ç”¨ç¨‹åºå¯èƒ½æ„Ÿå…´è¶£çš„å†…å®¹ï¼ˆä¾‹å¦‚ï¼Œå·²ä¸‹è½½äº†ä¸€äº›æ–°æ•°æ®ï¼‰ã€‚

åº”ç”¨ç¨‹åºå¯ä»¥æ³¨å†Œæ¥æ”¶ç‰¹å®šçš„å¹¿æ’­ã€‚å½“å‘é€å¹¿æ’­æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†å¹¿æ’­è·¯ç”±åˆ°å·²è®¢é˜…æ¥æ”¶è¯¥ç‰¹å®šç±»å‹å¹¿æ’­çš„åº”ç”¨ç¨‹åºã€‚

è¿™å¯èƒ½ä¼šå‡ºç°åœ¨Manifest.xmlæ–‡ä»¶ä¸­ï¼š
```markup
<receiver android:name=".MyBroadcastReceiver"  android:exported="true">
<intent-filter>
<action android:name="android.intent.action.BOOT_COMPLETED"/>
<action android:name="android.intent.action.INPUT_METHOD_CHANGED" />
</intent-filter>
</receiver>
```
ä»ï¼š[https://developer.android.com/guide/components/broadcasts](https://developer.android.com/guide/components/broadcasts)

åœ¨å‘ç°è¿™äº›å¹¿æ’­æ¥æ”¶å™¨ä¹‹åï¼Œæ‚¨åº”è¯¥**æ£€æŸ¥å®ƒä»¬çš„ä»£ç **ã€‚ç‰¹åˆ«æ³¨æ„**`onReceive`**å‡½æ•°ï¼Œå› ä¸ºå®ƒå°†å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚

#### **æ£€æµ‹æ‰€æœ‰**å¹¿æ’­æ¥æ”¶å™¨
```bash
run app.broadcast.info #Detects all
```
#### æ£€æŸ¥åº”ç”¨ç¨‹åºçš„å¹¿æ’­æ¥æ”¶å™¨

To check the broadcast receivers of an app, you can use the `drozer` tool. This tool allows you to interact with the Android operating system at the application layer and perform various security assessments.

è¦æ£€æŸ¥åº”ç”¨ç¨‹åºçš„å¹¿æ’­æ¥æ”¶å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `drozer` å·¥å…·ã€‚è¯¥å·¥å…·å…è®¸æ‚¨åœ¨åº”ç”¨ç¨‹åºå±‚ä¸ Android æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œå¹¶æ‰§è¡Œå„ç§å®‰å…¨è¯„ä¼°ã€‚

To begin, you need to install `drozer` on your machine and connect your Android device to it. Once connected, you can start the `drozer` console by running the command `drozer console`.

é¦–å…ˆï¼Œæ‚¨éœ€è¦åœ¨è®¡ç®—æœºä¸Šå®‰è£… `drozer` å¹¶å°† Android è®¾å¤‡è¿æ¥åˆ°è®¡ç®—æœºã€‚è¿æ¥æˆåŠŸåï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œå‘½ä»¤ `drozer console` æ¥å¯åŠ¨ `drozer` æ§åˆ¶å°ã€‚

In the `drozer` console, you can use the `app.package.list` command to list all the installed packages on the device. Find the package name of the app you want to assess.

åœ¨ `drozer` æ§åˆ¶å°ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `app.package.list` å‘½ä»¤åˆ—å‡ºè®¾å¤‡ä¸Šå®‰è£…çš„æ‰€æœ‰åŒ…ã€‚æ‰¾åˆ°æ‚¨æƒ³è¦è¯„ä¼°çš„åº”ç”¨ç¨‹åºçš„åŒ…åã€‚

Next, use the `app.broadcast.info` command followed by the package name to retrieve information about the broadcast receivers in the app. This command will display details such as the receiver's name, exported status, and the intent filters it listens for.

æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ `app.broadcast.info` å‘½ä»¤ï¼Œåè·ŸåŒ…åï¼Œä»¥æ£€ç´¢æœ‰å…³åº”ç”¨ç¨‹åºä¸­å¹¿æ’­æ¥æ”¶å™¨çš„ä¿¡æ¯ã€‚æ­¤å‘½ä»¤å°†æ˜¾ç¤ºæ¥æ”¶å™¨çš„åç§°ã€å¯¼å‡ºçŠ¶æ€ä»¥åŠå®ƒç›‘å¬çš„æ„å›¾è¿‡æ»¤å™¨ç­‰è¯¦ç»†ä¿¡æ¯ã€‚

For example, to check the broadcast receivers of an app with the package name `com.example.app`, you would run the command `app.broadcast.info com.example.app`.

ä¾‹å¦‚ï¼Œè¦æ£€æŸ¥åŒ…åä¸º `com.example.app` çš„åº”ç”¨ç¨‹åºçš„å¹¿æ’­æ¥æ”¶å™¨ï¼Œæ‚¨å¯ä»¥è¿è¡Œå‘½ä»¤ `app.broadcast.info com.example.app`ã€‚

By examining the output of this command, you can identify any potential security vulnerabilities related to the app's broadcast receivers, such as exported receivers that may be susceptible to unauthorized access.

é€šè¿‡æ£€æŸ¥æ­¤å‘½ä»¤çš„è¾“å‡ºï¼Œæ‚¨å¯ä»¥ç¡®å®šä¸åº”ç”¨ç¨‹åºçš„å¹¿æ’­æ¥æ”¶å™¨ç›¸å…³çš„ä»»ä½•æ½œåœ¨å®‰å…¨æ¼æ´ï¼Œä¾‹å¦‚å¯èƒ½å®¹æ˜“å—åˆ°æœªç»æˆæƒè®¿é—®çš„å¯¼å‡ºæ¥æ”¶å™¨ã€‚

It is important to assess the security of an app's broadcast receivers as they can be potential entry points for attackers to exploit and gain unauthorized access to sensitive information.

è¯„ä¼°åº”ç”¨ç¨‹åºçš„å¹¿æ’­æ¥æ”¶å™¨çš„å®‰å…¨æ€§éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½æˆä¸ºæ”»å‡»è€…åˆ©ç”¨çš„æ½œåœ¨å…¥å£ç‚¹ï¼Œå¹¶è·å¾—å¯¹æ•æ„Ÿä¿¡æ¯çš„æœªç»æˆæƒè®¿é—®ã€‚
```bash
#Check one negative
run app.broadcast.info -a jakhar.aseem.diva
Package: jakhar.aseem.diva
No matching receivers.

# Check one positive
run app.broadcast.info -a com.google.android.youtube
Package: com.google.android.youtube
com.google.android.libraries.youtube.player.PlayerUiModule$LegacyMediaButtonIntentReceiver
Permission: null
com.google.android.apps.youtube.app.common.notification.GcmBroadcastReceiver
Permission: com.google.android.c2dm.permission.SEND
com.google.android.apps.youtube.app.PackageReplacedReceiver
Permission: null
com.google.android.libraries.youtube.account.AccountsChangedReceiver
Permission: null
com.google.android.apps.youtube.app.application.system.LocaleUpdatedReceiver
Permission: null
```
#### å¹¿æ’­ **äº¤äº’**

Broadcasts are a way for different components within an Android app to communicate with each other. They allow one component to send a message, called an intent, and other components can receive and respond to that message.

å¹¿æ’­æ˜¯Androidåº”ç”¨ç¨‹åºä¸­ä¸åŒç»„ä»¶ä¹‹é—´è¿›è¡Œé€šä¿¡çš„ä¸€ç§æ–¹å¼ã€‚å®ƒä»¬å…è®¸ä¸€ä¸ªç»„ä»¶å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œç§°ä¸ºæ„å›¾ï¼ˆintentï¼‰ï¼Œå…¶ä»–ç»„ä»¶å¯ä»¥æ¥æ”¶å¹¶å“åº”è¯¥æ¶ˆæ¯ã€‚

Broadcasts can be sent within an app or even between different apps. This makes them a powerful tool for inter-app communication.

å¹¿æ’­å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨å‘é€ï¼Œç”šè‡³å¯ä»¥åœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºä¹‹é—´å‘é€ã€‚è¿™ä½¿å¾—å®ƒä»¬æˆä¸ºåº”ç”¨ç¨‹åºé—´é€šä¿¡çš„å¼ºå¤§å·¥å…·ã€‚

In the context of mobile app pentesting, understanding how broadcasts work is important because they can be used to exploit vulnerabilities in an app. For example, an attacker could send a malicious broadcast to an app and trigger unintended behavior or gain unauthorized access to sensitive information.

åœ¨ç§»åŠ¨åº”ç”¨ç¨‹åºæ¸—é€æµ‹è¯•çš„èƒŒæ™¯ä¸‹ï¼Œäº†è§£å¹¿æ’­çš„å·¥ä½œåŸç†éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥ç”¨äºåˆ©ç”¨åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥å‘åº”ç”¨ç¨‹åºå‘é€æ¶æ„å¹¿æ’­ï¼Œè§¦å‘æ„å¤–è¡Œä¸ºæˆ–æœªç»æˆæƒè®¿é—®æ•æ„Ÿä¿¡æ¯ã€‚

In this tutorial, we will explore how to use the drozer tool to interact with broadcasts in Android apps. Drozer is a powerful security testing framework for Android that allows us to analyze and manipulate Android apps.

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•ä½¿ç”¨drozerå·¥å…·ä¸Androidåº”ç”¨ç¨‹åºä¸­çš„å¹¿æ’­è¿›è¡Œäº¤äº’ã€‚Drozeræ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç”¨äºAndroidçš„å®‰å…¨æµ‹è¯•æ¡†æ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬åˆ†æå’Œæ“ä½œAndroidåº”ç”¨ç¨‹åºã€‚
```
app.broadcast.info          Get information about broadcast receivers
app.broadcast.send          Send broadcast using an intent
app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
```
#### å‘é€æ¶ˆæ¯

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡æ»¥ç”¨ [FourGoats apk](https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk) çš„å†…å®¹æä¾›è€…ï¼Œä½ å¯ä»¥å‘ä»»ä½•éé«˜çº§ç›®çš„åœ°**å‘é€ä»»æ„çŸ­ä¿¡**ï¼Œè€Œæ— éœ€è¯·æ±‚ç”¨æˆ·çš„æƒé™ã€‚

![](<../../../.gitbook/assets/image (199).png>)

![](<../../../.gitbook/assets/image (197) (1).png>)

å¦‚æœä½ é˜…è¯»ä»£ç ï¼Œä½ ä¼šå‘ç°éœ€è¦å°†å‚æ•° "_phoneNumber_" å’Œ "_message_" å‘é€ç»™å†…å®¹æä¾›è€…ã€‚
```
run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message "Hello mate!"
```
### æ˜¯å¦å¯è°ƒè¯•

ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒçš„ APK åº”è¯¥æ°¸è¿œä¸å¯è°ƒè¯•ã€‚\
è¿™æ„å‘³ç€ä½ å¯ä»¥**é™„åŠ  Java è°ƒè¯•å™¨**åˆ°æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œå®æ—¶æ£€æŸ¥å®ƒï¼Œè®¾ç½®æ–­ç‚¹ï¼Œé€æ­¥æ‰§è¡Œï¼Œæ”¶é›†å˜é‡å€¼ç”šè‡³ä¿®æ”¹å®ƒä»¬ã€‚[InfoSec ç ”ç©¶æ‰€æœ‰ä¸€ç¯‡å¾ˆå¥½çš„æ–‡ç« ](../exploiting-a-debuggeable-applciation.md)ä»‹ç»äº†å½“ä½ çš„åº”ç”¨ç¨‹åºå¯è°ƒè¯•æ—¶å¦‚ä½•æ·±å…¥æŒ–æ˜å¹¶æ³¨å…¥è¿è¡Œæ—¶ä»£ç ã€‚

å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯è°ƒè¯•æ—¶ï¼Œå®ƒä¼šå‡ºç°åœ¨æ¸…å•æ–‡ä»¶ä¸­ï¼š
```html
<application theme="@2131296387" debuggable="true"
```
æ‚¨å¯ä»¥ä½¿ç”¨**Drozer**æ‰¾åˆ°æ‰€æœ‰å¯è°ƒè¯•çš„åº”ç”¨ç¨‹åºï¼š
```bash
run app.package.debuggable
```
## æ•™ç¨‹

* [https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref](https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref)
* [http://mobiletools.mwrinfosecurity.com/Using-Drozer-for-application-security-assessments/](http://mobiletools.mwrinfosecurity.com/Using-Drozer-for-application-security-assessments/)

## æ›´å¤šä¿¡æ¯

* [https://blog.dixitaditya.com/android-pentesting-cheatsheet/](https://blog.dixitaditya.com/android-pentesting-cheatsheet/)

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bugèµé‡‘æç¤º**: **æ³¨å†Œ**Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**Bugèµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬çš„[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
