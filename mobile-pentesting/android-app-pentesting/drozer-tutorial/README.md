# Drozer Tutorial

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**WskazÃ³wka dotyczÄ…ca bug bounty**: **zarejestruj siÄ™** w **Intigriti**, premium **platformie bug bounty stworzonej przez hackerÃ³w, dla hackerÃ³w**! DoÅ‚Ä…cz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) juÅ¼ dziÅ› i zacznij zarabiaÄ‡ nagrody do **100 000 $**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## APKs do testowania

* [Sieve](https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk) (od mrwlabs)
* [DIVA](https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz)

**CzÄ™Å›ci tego samouczka zostaÅ‚y wyciÄ…gniÄ™te z** [**dokumentacji Drozer pdf**](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)**.**

## Instalacja

Zainstaluj klienta Drozer na swoim hoÅ›cie. Pobierz go z [najnowszych wydaÅ„](https://github.com/mwrlabs/drozer/releases).
```bash
pip install drozer-2.4.4-py2-none-any.whl
pip install twisted
pip install service_identity
```
Pobierz i zainstaluj APK drozer z [najnowszych wydaÅ„](https://github.com/mwrlabs/drozer/releases). W tej chwili jest to [to](https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk).
```bash
adb install drozer.apk
```
### Uruchamianie serwera

Agent dziaÅ‚a na porcie 31415, musimy [przekierowaÄ‡ port](https://en.wikipedia.org/wiki/Port\_forwarding), aby nawiÄ…zaÄ‡ komunikacjÄ™ miÄ™dzy klientem Drozer a agentem, oto polecenie, aby to zrobiÄ‡:
```bash
adb forward tcp:31415 tcp:31415
```
Na koniec, **uruchom** **aplikacjÄ™** i naciÅ›nij przycisk "**ON**"

![](<../../../.gitbook/assets/image (459).png>)

I poÅ‚Ä…cz siÄ™ z niÄ…:
```bash
drozer console connect
```
## Ciekawe Komendy

| **Komendy**     | **Opis**                                                                                                                                               |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Help MODULE** | Pokazuje pomoc dla wybranego moduÅ‚u                                                                                                                 |
| **list**        | Pokazuje listÄ™ wszystkich moduÅ‚Ã³w drozer, ktÃ³re moÅ¼na wykonaÄ‡ w bieÅ¼Ä…cej sesji. Ukrywa moduÅ‚y, do ktÃ³rych nie masz odpowiednich uprawnieÅ„.            |
| **shell**       | Uruchamia interaktywnÄ… powÅ‚okÄ™ Linux na urzÄ…dzeniu, w kontekÅ›cie Agenta.                                                                             |
| **clean**       | Usuwa tymczasowe pliki przechowywane przez drozer na urzÄ…dzeniu z Androidem.                                                                         |
| **load**        | Åaduje plik zawierajÄ…cy polecenia drozer i wykonuje je w kolejnoÅ›ci.                                                                                 |
| **module**      | Znajduje i instaluje dodatkowe moduÅ‚y drozer z Internetu.                                                                                             |
| **unset**       | Usuwa nazwanÄ… zmiennÄ…, ktÃ³rÄ… drozer przekazuje do wszelkich powÅ‚ok Linux, ktÃ³re uruchamia.                                                           |
| **set**         | Przechowuje wartoÅ›Ä‡ w zmiennej, ktÃ³ra zostanie przekazana jako zmienna Å›rodowiskowa do wszelkich powÅ‚ok Linux uruchamianych przez drozer.              |
| **shell**       | Uruchamia interaktywnÄ… powÅ‚okÄ™ Linux na urzÄ…dzeniu, w kontekÅ›cie Agenta                                                                               |
| **run MODULE**  | Wykonuje moduÅ‚ drozer                                                                                                                                 |
| **exploit**     | Drozer moÅ¼e tworzyÄ‡ exploity do wykonania na urzÄ…dzeniu. `drozer exploit list`                                                                        |
| **payload**     | Exploity potrzebujÄ… Å‚adunku. `drozer payload list`                                                                                                    |

### Pakiet

ZnajdÅº **nazwÄ™** pakietu filtrujÄ…c wedÅ‚ug czÄ™Å›ci nazwy:
```bash
dz> run app.package.list -f sieve
com.mwr.example.sieve
```
**Podstawowe informacje** o pakiecie:
```bash
dz> run app.package.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Process Name: com.mwr.example.sieve
Version: 1.0
Data Directory: /data/data/com.mwr.example.sieve
APK Path: /data/app/com.mwr.example.sieve-2.apk
UID: 10056
GID: [1028, 1015, 3003]
Shared Libraries: null
Shared User ID: null
Uses Permissions:
- android.permission.READ_EXTERNAL_STORAGE
- android.permission.WRITE_EXTERNAL_STORAGE
- android.permission.INTERNET
Defines Permissions:
- com.mwr.example.sieve.READ_KEYS
- com.mwr.example.sieve.WRITE_KEYS
```
Przeczytaj **Manifest**:
```bash
run app.package.manifest jakhar.aseem.diva
```
**Powierzchnia ataku** pakietu:
```bash
dz> run app.package.attacksurface com.mwr.example.sieve
Attack Surface:
3 activities exported
0 broadcast receivers exported
2 content providers exported
2 services exported
is debuggable
```
* **AktywnoÅ›ci**: MoÅ¼e uda ci siÄ™ uruchomiÄ‡ aktywnoÅ›Ä‡ i obejÅ›Ä‡ jakiÅ› rodzaj autoryzacji, ktÃ³ra powinna uniemoÅ¼liwiÄ‡ jej uruchomienie.
* **Dostawcy treÅ›ci**: MoÅ¼e uda ci siÄ™ uzyskaÄ‡ dostÄ™p do prywatnych danych lub wykorzystaÄ‡ jakÄ…Å› lukÄ™ (SQL Injection lub Path Traversal).
* **UsÅ‚ugi**:
* **is debuggable**: [Dowiedz siÄ™ wiÄ™cej](./#is-debuggeable)

### AktywnoÅ›ci

WartoÅ›Ä‡ komponentu aktywnoÅ›ci eksportowanej â€œandroid:exportedâ€ jest ustawiona na **â€œtrueâ€** w pliku AndroidManifest.xml:
```markup
<activity android:name="com.my.app.Initial" android:exported="true">
</activity>
```
**Lista wyeksportowanych aktywnoÅ›ci**:
```bash
dz> run app.activity.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList
```
**Rozpocznij aktywnoÅ›Ä‡**:

MoÅ¼esz rozpoczÄ…Ä‡ aktywnoÅ›Ä‡ i obejÅ›Ä‡ pewnego rodzaju autoryzacjÄ™, ktÃ³ra powinna uniemoÅ¼liwiÄ‡ jej uruchomienie.

{% code overflow="wrap" %}
```bash
dz> run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
```
{% endcode %}

MoÅ¼esz rÃ³wnieÅ¼ uruchomiÄ‡ wyeksportowanÄ… aktywnoÅ›Ä‡ z **adb**:

* PackageName to com.example.demo
* Exported ActivityName to com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
### Content Providers

Ten post byÅ‚ zbyt duÅ¼y, aby tutaj go umieÅ›ciÄ‡, wiÄ™c **moÅ¼esz** [**uzyskaÄ‡ do niego dostÄ™p na osobnej stronie tutaj**](exploiting-content-providers.md).

### Services

Eksportowana usÅ‚uga jest zadeklarowana w pliku Manifest.xml:

{% code overflow="wrap" %}
```markup
<service android:name=".AuthService" android:exported="true" android:process=":remote"/>
```
{% endcode %}

WewnÄ…trz kodu **sprawdÅº** funkcjÄ™ \*\*`handleMessage`\*\*, ktÃ³ra **otrzyma** **wiadomoÅ›Ä‡**:

![](<../../../.gitbook/assets/image (82).png>)

#### Lista usÅ‚ug
```bash
dz> run app.service.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.AuthService
Permission: null
com.mwr.example.sieve.CryptoService
Permission: null
```
#### **Interakcja** z usÅ‚ugÄ…
```bash
app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
```
#### PrzykÅ‚ad

Zobacz pomoc **drozer** dla `app.service.send`:

![](<../../../.gitbook/assets/image (1079).png>)

ZauwaÅ¼, Å¼e najpierw wyÅ›lesz dane wewnÄ…trz "_msg.what_", nastÄ™pnie "_msg.arg1_" i "_msg.arg2_", powinieneÅ› sprawdziÄ‡ w kodzie **jakie informacje sÄ… uÅ¼ywane** i gdzie.\
UÅ¼ywajÄ…c opcji `--extra`, moÅ¼esz wysÅ‚aÄ‡ coÅ› interpretowanego przez "_msg.replyTo_", a uÅ¼ywajÄ…c `--bundle-as-obj`, tworzysz obiekt z podanymi szczegÃ³Å‚ami.

W nastÄ™pujÄ…cym przykÅ‚adzie:

* `what == 2354`
* `arg1 == 9234`
* `arg2 == 1`
* `replyTo == object(string com.mwr.example.sieve.PIN 1337)`
```bash
run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg 2354 9234 1 --extra string com.mwr.example.sieve.PIN 1337 --bundle-as-obj
```
![](<../../../.gitbook/assets/image (647).png>)

### Odbiorniki rozgÅ‚oszeniowe

**W sekcji podstawowych informacji o Androidzie moÅ¼esz zobaczyÄ‡, czym jest Odbiornik rozgÅ‚oszeniowy**.

Po odkryciu tych OdbiornikÃ³w rozgÅ‚oszeniowych powinieneÅ› **sprawdziÄ‡ kod** ich. ZwrÃ³Ä‡ szczegÃ³lnÄ… uwagÄ™ na funkcjÄ™ **`onReceive`**, poniewaÅ¼ bÄ™dzie ona obsÅ‚ugiwaÄ‡ otrzymane wiadomoÅ›ci.

#### **Wykryj wszystkie** odbiorniki rozgÅ‚oszeniowe
```bash
run app.broadcast.info #Detects all
```
#### SprawdÅº odbiorniki rozgÅ‚oszeniowe aplikacji
```bash
#Check one negative
run app.broadcast.info -a jakhar.aseem.diva
Package: jakhar.aseem.diva
No matching receivers.

# Check one positive
run app.broadcast.info -a com.google.android.youtube
Package: com.google.android.youtube
com.google.android.libraries.youtube.player.PlayerUiModule$LegacyMediaButtonIntentReceiver
Permission: null
com.google.android.apps.youtube.app.common.notification.GcmBroadcastReceiver
Permission: com.google.android.c2dm.permission.SEND
com.google.android.apps.youtube.app.PackageReplacedReceiver
Permission: null
com.google.android.libraries.youtube.account.AccountsChangedReceiver
Permission: null
com.google.android.apps.youtube.app.application.system.LocaleUpdatedReceiver
Permission: null
```
#### Broadcast **Interakcje**
```bash
app.broadcast.info          Get information about broadcast receivers
app.broadcast.send          Send broadcast using an intent
app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
```
#### WyÅ›lij wiadomoÅ›Ä‡

W tym przykÅ‚adzie wykorzystujÄ…c [FourGoats apk](https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk) Content Provider moÅ¼esz **wysÅ‚aÄ‡ dowolny SMS** do dowolnego niepremium miejsca **bez pytania** uÅ¼ytkownika o pozwolenie.

![](<../../../.gitbook/assets/image (415).png>)

![](<../../../.gitbook/assets/image (573).png>)

JeÅ›li przeczytasz kod, parametry "_phoneNumber_" i "_message_" muszÄ… byÄ‡ wysÅ‚ane do Content Provider.
```bash
run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message "Hello mate!"
```
### Is debuggeable

A prodduction APK should never be debuggeable.\
To oznacza, Å¼e moÅ¼esz **przyÅ‚Ä…czyÄ‡ debuger java** do dziaÅ‚ajÄ…cej aplikacji, sprawdziÄ‡ jÄ… w czasie rzeczywistym, ustawiÄ‡ punkty przerwania, przechodziÄ‡ krok po kroku, zbieraÄ‡ wartoÅ›ci zmiennych, a nawet je zmieniaÄ‡. [Instytut InfoSec ma doskonaÅ‚y artykuÅ‚](../exploiting-a-debuggeable-applciation.md) na temat gÅ‚Ä™bszego badania, gdy twoja aplikacja jest debugowalna i wstrzykiwania kodu w czasie rzeczywistym.

When an application is debuggable, it will appear in the Manifest:
```xml
<application theme="@2131296387" debuggable="true"
```
MoÅ¼esz znaleÅºÄ‡ wszystkie aplikacje z moÅ¼liwoÅ›ciÄ… debugowania za pomocÄ… **Drozer**:
```bash
run app.package.debuggable
```
## Tutorials

* [https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref](https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref)
* [https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md](https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md)
* [https://www.hackingarticles.in/android-penetration-testing-drozer/](https://www.hackingarticles.in/android-penetration-testing-drozer/)
* [https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac](https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac)

## WiÄ™cej informacji

* [https://blog.dixitaditya.com/android-pentesting-cheatsheet/](https://blog.dixitaditya.com/android-pentesting-cheatsheet/)

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**WskazÃ³wka dotyczÄ…ca bug bounty**: **zarejestruj siÄ™** w **Intigriti**, premium **platformie bug bounty stworzonej przez hakerÃ³w, dla hakerÃ³w**! DoÅ‚Ä…cz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) juÅ¼ dziÅ› i zacznij zarabiaÄ‡ nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
