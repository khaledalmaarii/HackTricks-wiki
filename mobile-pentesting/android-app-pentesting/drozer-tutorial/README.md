# Drozer æ•™ç¨‹

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm) ä¸Š**å…³æ³¨**æˆ‘ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**æ¼æ´èµé‡‘æç¤º**ï¼š**æ³¨å†Œ** Intigritiï¼Œè¿™æ˜¯ä¸€å®¶ç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**æ¼æ´èµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬ï¼Œè®¿é—® [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## è¦æµ‹è¯•çš„ APK

* [Sieve](https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk)ï¼ˆæ¥è‡ª mrwlabsï¼‰
* [DIVA](https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz)


**æœ¬æ•™ç¨‹çš„éƒ¨åˆ†å†…å®¹æ‘˜è‡ª[Drozer æ–‡æ¡£ pdf](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)ã€‚**

## å®‰è£…

åœ¨ä¸»æœºä¸Šå®‰è£… Drozer å®¢æˆ·ç«¯ã€‚ä»[æœ€æ–°ç‰ˆæœ¬å‘å¸ƒé¡µé¢](https://github.com/mwrlabs/drozer/releases)ä¸‹è½½ã€‚
```bash
pip install drozer-2.4.4-py2-none-any.whl
pip install twisted
pip install service_identity
```
ä¸‹è½½å¹¶å®‰è£… drozer APK æ–‡ä»¶ä»[æœ€æ–°å‘å¸ƒç‰ˆæœ¬](https://github.com/mwrlabs/drozer/releases)ã€‚æ­¤åˆ»å®ƒæ˜¯[è¿™ä¸ª](https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk)ã€‚
```bash
adb install drozer.apk
```
### å¯åŠ¨æœåŠ¡å™¨

ä»£ç†æ­£åœ¨ç«¯å£31415ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ[ç«¯å£è½¬å‘](https://en.wikipedia.org/wiki/Port\_forwarding)ä»¥å»ºç«‹Drozerå®¢æˆ·ç«¯å’Œä»£ç†ä¹‹é—´çš„é€šä¿¡ï¼Œä»¥ä¸‹æ˜¯æ‰§è¡Œæ­¤æ“ä½œçš„å‘½ä»¤ï¼š
```bash
adb forward tcp:31415 tcp:31415
```
æœ€åï¼Œ**å¯åŠ¨**è¯¥**åº”ç”¨ç¨‹åº**å¹¶æŒ‰ä¸‹åº•éƒ¨çš„ "**ON**"

![](<../../../.gitbook/assets/image (63).png>) 

ç„¶åè¿æ¥åˆ°å®ƒï¼š
```bash
drozer console connect
```
## æœ‰è¶£çš„å‘½ä»¤

| **å‘½ä»¤**        | **æè¿°**                                                                                                                                        |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Help MODULE** | æ˜¾ç¤ºæ‰€é€‰æ¨¡å—çš„å¸®åŠ©ä¿¡æ¯                                                                                                                      |
| **list**        | æ˜¾ç¤ºå¯ä»¥åœ¨å½“å‰ä¼šè¯ä¸­æ‰§è¡Œçš„æ‰€æœ‰drozeræ¨¡å—çš„åˆ—è¡¨ã€‚è¿™ä¼šéšè—æ‚¨æ²¡æœ‰é€‚å½“æƒé™è¿è¡Œçš„æ¨¡å—ã€‚ |
| **shell**       | åœ¨è®¾å¤‡ä¸Šä»¥ä»£ç†çš„ä¸Šä¸‹æ–‡å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼Linux shellã€‚                                                                           |
| **clean**       | åˆ é™¤Androidè®¾å¤‡ä¸Šdrozerå­˜å‚¨çš„ä¸´æ—¶æ–‡ä»¶ã€‚                                                                                         |
| **load**        | åŠ è½½åŒ…å«drozerå‘½ä»¤å¹¶æŒ‰é¡ºåºæ‰§è¡Œå®ƒä»¬çš„æ–‡ä»¶ã€‚                                                                                   |
| **module**      | ä»äº’è”ç½‘æŸ¥æ‰¾å¹¶å®‰è£…é¢å¤–çš„drozeræ¨¡å—ã€‚                                                                                          |
| **unset**       | åˆ é™¤drozerä¼ é€’ç»™ä»»ä½•Linux shellçš„å‘½åå˜é‡ã€‚                                                                         |
| **set**         | å°†ä¸€ä¸ªå€¼å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œè¯¥å€¼å°†ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ç»™drozerç”Ÿæˆçš„ä»»ä½•Linux shellã€‚                                   |
| **shell**       | åœ¨è®¾å¤‡ä¸Šä»¥ä»£ç†çš„ä¸Šä¸‹æ–‡å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼Linux shellã€‚                                                                           |
| **run MODULE**  | æ‰§è¡Œä¸€ä¸ªdrozeræ¨¡å—                                                                                                                                |
| **exploit**     | Drozerå¯ä»¥åˆ›å»ºç”¨äºåœ¨è®¾å¤‡ä¸Šæ‰§è¡Œçš„åˆ©ç”¨ç¨‹åºã€‚`drozer exploit list`                                                                             |
| **payload**     | åˆ©ç”¨ç¨‹åºéœ€è¦ä¸€ä¸ªæœ‰æ•ˆè½½è·ã€‚`drozer payload list`                                                                                                     |

### åŒ…

é€šè¿‡åŒ…åçš„ä¸€éƒ¨åˆ†æ¥æŸ¥æ‰¾åŒ…çš„**åç§°**ï¼š
```bash
dz> run app.package.list -f sieve
com.mwr.example.sieve
```
**è½¯ä»¶åŒ…çš„åŸºæœ¬ä¿¡æ¯**ï¼š
```bash
dz> run app.package.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Process Name: com.mwr.example.sieve
Version: 1.0
Data Directory: /data/data/com.mwr.example.sieve
APK Path: /data/app/com.mwr.example.sieve-2.apk
UID: 10056
GID: [1028, 1015, 3003]
Shared Libraries: null
Shared User ID: null
Uses Permissions:
- android.permission.READ_EXTERNAL_STORAGE
- android.permission.WRITE_EXTERNAL_STORAGE
- android.permission.INTERNET
Defines Permissions:
- com.mwr.example.sieve.READ_KEYS
- com.mwr.example.sieve.WRITE_KEYS
```
é˜…è¯» **æ¸…å•**ï¼š
```bash
run app.package.manifest jakhar.aseem.diva
```
**è½¯ä»¶åŒ…çš„æ”»å‡»é¢**ï¼š
```bash
dz> run app.package.attacksurface com.mwr.example.sieve
Attack Surface:
3 activities exported
0 broadcast receivers exported
2 content providers exported
2 services exported
is debuggable
```
* **Activities**: ä¹Ÿè®¸æ‚¨å¯ä»¥å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨å¹¶ç»•è¿‡æŸç§åº”è¯¥é˜»æ­¢æ‚¨å¯åŠ¨å®ƒçš„æˆæƒã€‚
* **Content providers**: ä¹Ÿè®¸æ‚¨å¯ä»¥è®¿é—®ç§äººæ•°æ®æˆ–åˆ©ç”¨ä¸€äº›æ¼æ´ï¼ˆSQLæ³¨å…¥æˆ–è·¯å¾„éå†ï¼‰ã€‚
* **Services**:
* **is debuggable**: [äº†è§£æ›´å¤š](./#is-debuggeable)

### Activities

åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­ï¼Œå¯¼å‡ºçš„æ´»åŠ¨ç»„ä»¶çš„â€œandroid:exportedâ€å€¼è®¾ç½®ä¸º**â€œtrueâ€**ï¼š
```markup
<activity android:name="com.my.app.Initial" android:exported="true">
</activity>
```
**åˆ—å‡ºå¯¼å‡ºçš„æ´»åŠ¨**ï¼š
```bash
dz> run app.activity.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList
```
**å¯åŠ¨æ´»åŠ¨**ï¼š

ä¹Ÿè®¸ä½ å¯ä»¥å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨ï¼Œå¹¶ç»•è¿‡æŸç§åº”è¯¥é˜»æ­¢ä½ å¯åŠ¨å®ƒçš„æˆæƒã€‚
```bash
dz> run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
```
{% endcode %}

æ‚¨è¿˜å¯ä»¥é€šè¿‡ **adb** å¯åŠ¨ä¸€ä¸ªå¯¼å‡ºçš„æ´»åŠ¨ï¼š

* PackageName ä¸º com.example.demo
* å¯¼å‡ºçš„ ActivityName ä¸º com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
### å†…å®¹æä¾›è€…

è¿™ç¯‡æ–‡ç« å†…å®¹å¤ªå¤šäº†ï¼Œ**ä½ å¯ä»¥** [**åœ¨è¿™é‡Œçš„å•ç‹¬é¡µé¢ä¸­è®¿é—®å®ƒ**](exploiting-content-providers.md)ã€‚

### æœåŠ¡

ä¸€ä¸ªå¯¼å‡ºçš„æœåŠ¡åœ¨ Manifest.xml ä¸­å£°æ˜ï¼š
```markup
<service android:name=".AuthService" android:exported="true" android:process=":remote"/>
```
{% endcode %}

åœ¨ä»£ç ä¸­**æ£€æŸ¥**`handleMessage`å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†**æ¥æ”¶**æ¶ˆæ¯ï¼š

![](<../../../.gitbook/assets/image (194).png>)

#### åˆ—å‡ºæœåŠ¡
```bash
dz> run app.service.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.AuthService
Permission: null
com.mwr.example.sieve.CryptoService
Permission: null
```
#### ä¸æœåŠ¡è¿›è¡Œäº¤äº’
```bash
app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
```
#### ç¤ºä¾‹

æŸ¥çœ‹`app.service.send`çš„**drozer**å¸®åŠ©ï¼š

![](<../../../.gitbook/assets/image (196) (1).png>)

è¯·æ³¨æ„ï¼Œæ‚¨å°†é¦–å…ˆå‘é€"_msg.what_"ä¸­çš„æ•°æ®ï¼Œç„¶åæ˜¯"_msg.arg1_"å’Œ"_msg.arg2_"ï¼Œæ‚¨åº”è¯¥æ£€æŸ¥ä»£ç ä¸­**ä½¿ç”¨äº†å“ªäº›ä¿¡æ¯**ä»¥åŠåœ¨å“ªé‡Œä½¿ç”¨ã€‚\
ä½¿ç”¨`--extra`é€‰é¡¹ï¼Œæ‚¨å¯ä»¥å‘é€ç”±"_msg.replyTo"è§£é‡Šçš„å†…å®¹ï¼Œå¹¶ä½¿ç”¨`--bundle-as-obj`åˆ›å»ºä¸€ä¸ªåŒ…å«æä¾›çš„è¯¦ç»†ä¿¡æ¯çš„å¯¹è±¡ã€‚

åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼š

* `what == 2354`
* `arg1 == 9234`
* `arg2 == 1`
* `replyTo == object(string com.mwr.example.sieve.PIN 1337)`
```bash
run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg 2354 9234 1 --extra string com.mwr.example.sieve.PIN 1337 --bundle-as-obj
```
### å¹¿æ’­æ¥æ”¶å™¨

**åœ¨AndroidåŸºæœ¬ä¿¡æ¯éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä»€ä¹ˆæ˜¯å¹¿æ’­æ¥æ”¶å™¨**ã€‚

å‘ç°è¿™äº›å¹¿æ’­æ¥æ”¶å™¨åï¼Œæ‚¨åº”è¯¥**æ£€æŸ¥å®ƒä»¬çš„ä»£ç **ã€‚ç‰¹åˆ«æ³¨æ„**`onReceive`**å‡½æ•°ï¼Œå› ä¸ºå®ƒå°†å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚

#### **æ£€æµ‹æ‰€æœ‰**å¹¿æ’­æ¥æ”¶å™¨
```bash
run app.broadcast.info #Detects all
```
#### æ£€æŸ¥åº”ç”¨ç¨‹åºçš„å¹¿æ’­æ¥æ”¶å™¨
```bash
#Check one negative
run app.broadcast.info -a jakhar.aseem.diva
Package: jakhar.aseem.diva
No matching receivers.

# Check one positive
run app.broadcast.info -a com.google.android.youtube
Package: com.google.android.youtube
com.google.android.libraries.youtube.player.PlayerUiModule$LegacyMediaButtonIntentReceiver
Permission: null
com.google.android.apps.youtube.app.common.notification.GcmBroadcastReceiver
Permission: com.google.android.c2dm.permission.SEND
com.google.android.apps.youtube.app.PackageReplacedReceiver
Permission: null
com.google.android.libraries.youtube.account.AccountsChangedReceiver
Permission: null
com.google.android.apps.youtube.app.application.system.LocaleUpdatedReceiver
Permission: null
```
#### å¹¿æ’­**äº¤äº’**
```bash
app.broadcast.info          Get information about broadcast receivers
app.broadcast.send          Send broadcast using an intent
app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
```
#### å‘é€æ¶ˆæ¯

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡æ»¥ç”¨[FourGoats apk](https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk)çš„å†…å®¹æä¾›ç¨‹åºï¼Œæ‚¨å¯ä»¥å‘ä»»ä½•éé«˜çº§ç›®çš„åœ°**å‘é€ä»»æ„çŸ­ä¿¡**ï¼Œè€Œæ— éœ€**è¯·æ±‚**ç”¨æˆ·çš„æƒé™ã€‚

![](<../../../.gitbook/assets/image (199).png>)

![](<../../../.gitbook/assets/image (197) (1).png>)

å¦‚æœæ‚¨é˜…è¯»ä»£ç ï¼Œå¿…é¡»å°†å‚æ•°"_phoneNumber_"å’Œ"_message_"å‘é€åˆ°å†…å®¹æä¾›ç¨‹åºã€‚
```bash
run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message "Hello mate!"
```
### æ˜¯å¦å¯è°ƒè¯•

ç”Ÿäº§ APK æ°¸è¿œä¸åº”è¯¥æ˜¯å¯è°ƒè¯•çš„ã€‚\
è¿™æ„å‘³ç€ä½ å¯ä»¥**é™„åŠ  Java è°ƒè¯•å™¨**åˆ°è¿è¡Œä¸­çš„åº”ç”¨ç¨‹åºï¼Œå®æ—¶æ£€æŸ¥å®ƒï¼Œè®¾ç½®æ–­ç‚¹ï¼Œé€æ­¥æ‰§è¡Œï¼Œæ”¶é›†å˜é‡å€¼ç”šè‡³ä¿®æ”¹å®ƒä»¬ã€‚[InfoSec ç ”ç©¶æ‰€æœ‰ä¸€ç¯‡å‡ºè‰²çš„æ–‡ç« ](../exploiting-a-debuggeable-applciation.md)ä»‹ç»äº†å½“åº”ç”¨ç¨‹åºæ˜¯å¯è°ƒè¯•çš„æ—¶å€™å¦‚ä½•æ·±å…¥æŒ–æ˜å¹¶æ³¨å…¥è¿è¡Œæ—¶ä»£ç ã€‚

å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜¯å¯è°ƒè¯•çš„æ—¶å€™ï¼Œå®ƒä¼šå‡ºç°åœ¨æ¸…å•æ–‡ä»¶ä¸­ï¼š
```xml
<application theme="@2131296387" debuggable="true"
```
æ‚¨å¯ä»¥ä½¿ç”¨**Drozer**æ‰¾åˆ°æ‰€æœ‰å¯è°ƒè¯•çš„åº”ç”¨ç¨‹åºï¼š
```bash
run app.package.debuggable
```
## æ•™ç¨‹

* [https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref](https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref)
* [https://github.com/mgcfish/mobiletools/blob/master/_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md](https://github.com/mgcfish/mobiletools/blob/master/_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md)
* [https://www.hackingarticles.in/android-penetration-testing-drozer/](https://www.hackingarticles.in/android-penetration-testing-drozer/)
* [https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac](https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac)

## æ›´å¤šä¿¡æ¯

* [https://blog.dixitaditya.com/android-pentesting-cheatsheet/](https://blog.dixitaditya.com/android-pentesting-cheatsheet/)

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**æ¼æ´èµé‡‘æç¤º**ï¼š**æ³¨å†Œ** Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**æ¼æ´èµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm) ä¸Š**å…³æ³¨**æˆ‘ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
