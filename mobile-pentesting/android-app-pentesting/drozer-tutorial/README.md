# Drozer Tutorial

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**æ¼æ´èµé‡‘æç¤º**: **æ³¨å†Œ** **Intigriti**ï¼Œä¸€ä¸ªç”±é»‘å®¢ä¸ºé»‘å®¢åˆ›å»ºçš„é«˜çº§ **æ¼æ´èµé‡‘å¹³å°**ï¼ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾ **$100,000** çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## å¾…æµ‹è¯•çš„ APK

* [Sieve](https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk) (æ¥è‡ª mrwlabs)
* [DIVA](https://payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz)

**æœ¬æ•™ç¨‹çš„éƒ¨åˆ†å†…å®¹æ‘˜è‡ª** [**Drozer æ–‡æ¡£ pdf**](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)**.**

## å®‰è£…

åœ¨æ‚¨çš„ä¸»æœºä¸Šå®‰è£… Drozer Clientã€‚å¯ä»¥ä» [æœ€æ–°ç‰ˆæœ¬](https://github.com/mwrlabs/drozer/releases) ä¸‹è½½ã€‚
```bash
pip install drozer-2.4.4-py2-none-any.whl
pip install twisted
pip install service_identity
```
ä¸‹è½½å¹¶å®‰è£…æ¥è‡ª[æœ€æ–°ç‰ˆæœ¬](https://github.com/mwrlabs/drozer/releases)çš„drozer APKã€‚ç›®å‰æ˜¯[è¿™ä¸ª](https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk)ã€‚
```bash
adb install drozer.apk
```
### å¯åŠ¨æœåŠ¡å™¨

Agent æ­£åœ¨ 31415 ç«¯å£ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦ [ç«¯å£è½¬å‘](https://en.wikipedia.org/wiki/Port\_forwarding) ä»¥å»ºç«‹ Drozer å®¢æˆ·ç«¯å’Œ Agent ä¹‹é—´çš„é€šä¿¡ï¼Œä»¥ä¸‹æ˜¯æ‰§è¡Œæ­¤æ“ä½œçš„å‘½ä»¤ï¼š
```bash
adb forward tcp:31415 tcp:31415
```
æœ€åï¼Œ**å¯åŠ¨** **åº”ç”¨ç¨‹åº**ï¼Œå¹¶æŒ‰ä¸‹åº•éƒ¨çš„ "**å¼€å¯**"

![](<../../../.gitbook/assets/image (459).png>)

å¹¶è¿æ¥åˆ°å®ƒï¼š
```bash
drozer console connect
```
## Interesting Commands

| **Commands**    | **Description**                                                                                                                                        |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Help MODULE** | æ˜¾ç¤ºæ‰€é€‰æ¨¡å—çš„å¸®åŠ©                                                                                                                                    |
| **list**        | æ˜¾ç¤ºå½“å‰ä¼šè¯ä¸­å¯ä»¥æ‰§è¡Œçš„æ‰€æœ‰ drozer æ¨¡å—çš„åˆ—è¡¨ã€‚è¿™ä¼šéšè—æ‚¨æ²¡æœ‰é€‚å½“æƒé™è¿è¡Œçš„æ¨¡å—ã€‚                                                                 |
| **shell**       | åœ¨è®¾å¤‡ä¸Šå¯åŠ¨ä¸€ä¸ªäº¤äº’å¼ Linux shellï¼Œå¤„äº Agent çš„ä¸Šä¸‹æ–‡ä¸­ã€‚                                                                                       |
| **clean**       | åˆ é™¤ drozer åœ¨ Android è®¾å¤‡ä¸Šå­˜å‚¨çš„ä¸´æ—¶æ–‡ä»¶ã€‚                                                                                                       |
| **load**        | åŠ è½½åŒ…å« drozer å‘½ä»¤çš„æ–‡ä»¶å¹¶æŒ‰é¡ºåºæ‰§è¡Œå®ƒä»¬ã€‚                                                                                                         |
| **module**      | ä»äº’è”ç½‘æŸ¥æ‰¾å¹¶å®‰è£…é¢å¤–çš„ drozer æ¨¡å—ã€‚                                                                                                              |
| **unset**       | åˆ é™¤ drozer ä¼ é€’ç»™å…¶ç”Ÿæˆçš„ä»»ä½• Linux shell çš„å‘½åå˜é‡ã€‚                                                                                             |
| **set**         | åœ¨å˜é‡ä¸­å­˜å‚¨ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼å°†ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ç»™ drozer ç”Ÿæˆçš„ä»»ä½• Linux shellã€‚                                                                         |
| **shell**       | åœ¨è®¾å¤‡ä¸Šå¯åŠ¨ä¸€ä¸ªäº¤äº’å¼ Linux shellï¼Œå¤„äº Agent çš„ä¸Šä¸‹æ–‡ä¸­                                                                                         |
| **run MODULE**  | æ‰§è¡Œä¸€ä¸ª drozer æ¨¡å—                                                                                                                                 |
| **exploit**     | Drozer å¯ä»¥åˆ›å»ºåœ¨è®¾å¤‡ä¸Šæ‰§è¡Œçš„æ¼æ´ã€‚ `drozer exploit list`                                                                                          |
| **payload**     | æ¼æ´éœ€è¦ä¸€ä¸ªæœ‰æ•ˆè½½è·ã€‚ `drozer payload list`                                                                                                         |

### Package

æŸ¥æ‰¾ **name** çš„åŒ…ï¼Œé€šè¿‡éƒ¨åˆ†åç§°è¿›è¡Œè¿‡æ»¤ï¼š
```bash
dz> run app.package.list -f sieve
com.mwr.example.sieve
```
**åŒ…çš„åŸºæœ¬ä¿¡æ¯**:
```bash
dz> run app.package.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Process Name: com.mwr.example.sieve
Version: 1.0
Data Directory: /data/data/com.mwr.example.sieve
APK Path: /data/app/com.mwr.example.sieve-2.apk
UID: 10056
GID: [1028, 1015, 3003]
Shared Libraries: null
Shared User ID: null
Uses Permissions:
- android.permission.READ_EXTERNAL_STORAGE
- android.permission.WRITE_EXTERNAL_STORAGE
- android.permission.INTERNET
Defines Permissions:
- com.mwr.example.sieve.READ_KEYS
- com.mwr.example.sieve.WRITE_KEYS
```
é˜…è¯» **Manifest**:
```bash
run app.package.manifest jakhar.aseem.diva
```
**æ”»å‡»é¢** of the package:
```bash
dz> run app.package.attacksurface com.mwr.example.sieve
Attack Surface:
3 activities exported
0 broadcast receivers exported
2 content providers exported
2 services exported
is debuggable
```
* **æ´»åŠ¨**: ä¹Ÿè®¸ä½ å¯ä»¥å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨å¹¶ç»•è¿‡æŸç§æˆæƒï¼Œè¿™åº”è¯¥é˜»æ­¢ä½ å¯åŠ¨å®ƒã€‚
* **å†…å®¹æä¾›è€…**: ä¹Ÿè®¸ä½ å¯ä»¥è®¿é—®ç§æœ‰æ•°æ®æˆ–åˆ©ç”¨æŸäº›æ¼æ´ï¼ˆSQLæ³¨å…¥æˆ–è·¯å¾„éå†ï¼‰ã€‚
* **æœåŠ¡**:
* **å¯è°ƒè¯•**: [äº†è§£æ›´å¤š](./#is-debuggeable)

### æ´»åŠ¨

å¯¼å‡ºçš„æ´»åŠ¨ç»„ä»¶çš„â€œandroid:exportedâ€å€¼åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­è®¾ç½®ä¸º**â€œtrueâ€**:
```markup
<activity android:name="com.my.app.Initial" android:exported="true">
</activity>
```
**åˆ—å‡ºå¯¼å‡ºæ´»åŠ¨**:
```bash
dz> run app.activity.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.FileSelectActivity
com.mwr.example.sieve.MainLoginActivity
com.mwr.example.sieve.PWList
```
**å¯åŠ¨æ´»åŠ¨**ï¼š

ä¹Ÿè®¸æ‚¨å¯ä»¥å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨å¹¶ç»•è¿‡æŸç§æˆæƒï¼Œè¿™åº”è¯¥é˜»æ­¢æ‚¨å¯åŠ¨å®ƒã€‚

{% code overflow="wrap" %}
```bash
dz> run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList
```
{% endcode %}

æ‚¨è¿˜å¯ä»¥ä» **adb** å¯åŠ¨å¯¼å‡ºçš„æ´»åŠ¨ï¼š

* åŒ…åæ˜¯ com.example.demo
* å¯¼å‡ºæ´»åŠ¨åç§°æ˜¯ com.example.test.MainActivity
```bash
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
### å†…å®¹æä¾›è€…

è¿™ç¯‡æ–‡ç« å¤ªé•¿äº†ï¼Œæ‰€ä»¥ **ä½ å¯ä»¥** [**åœ¨è¿™é‡Œè®¿é—®å®ƒçš„ç‹¬ç«‹é¡µé¢**](exploiting-content-providers.md)ã€‚

### æœåŠ¡

ä¸€ä¸ªå¯¼å‡ºçš„æœåŠ¡åœ¨ Manifest.xml ä¸­å£°æ˜ï¼š 

{% code overflow="wrap" %}
```markup
<service android:name=".AuthService" android:exported="true" android:process=":remote"/>
```
{% endcode %}

åœ¨ä»£ç ä¸­**æ£€æŸ¥**\*\*`handleMessage`\*\*å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†**æ¥æ”¶****æ¶ˆæ¯**ï¼š

![](<../../../.gitbook/assets/image (82).png>)

#### åˆ—å‡ºæœåŠ¡
```bash
dz> run app.service.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
com.mwr.example.sieve.AuthService
Permission: null
com.mwr.example.sieve.CryptoService
Permission: null
```
#### **ä¸æœåŠ¡äº¤äº’**
```bash
app.service.send            Send a Message to a service, and display the reply
app.service.start           Start Service
app.service.stop            Stop Service
```
#### ç¤ºä¾‹

æŸ¥çœ‹ **drozer** å¯¹ `app.service.send` çš„å¸®åŠ©ï¼š

![](<../../../.gitbook/assets/image (1079).png>)

è¯·æ³¨æ„ï¼Œæ‚¨å°†é¦–å…ˆå‘é€ "_msg.what_" ä¸­çš„æ•°æ®ï¼Œç„¶åæ˜¯ "_msg.arg1_" å’Œ "_msg.arg2_"ï¼Œæ‚¨åº”è¯¥æ£€æŸ¥ä»£ç  **ä½¿ç”¨äº†å“ªäº›ä¿¡æ¯** ä»¥åŠåœ¨å“ªé‡Œã€‚\
ä½¿ç”¨ `--extra` é€‰é¡¹ï¼Œæ‚¨å¯ä»¥å‘é€ç”± "_msg.replyTo"_" è§£é‡Šçš„å†…å®¹ï¼Œä½¿ç”¨ `--bundle-as-obj`ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å«æä¾›çš„è¯¦ç»†ä¿¡æ¯çš„å¯¹è±¡ã€‚

åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼š

* `what == 2354`
* `arg1 == 9234`
* `arg2 == 1`
* `replyTo == object(string com.mwr.example.sieve.PIN 1337)`
```bash
run app.service.send com.mwr.example.sieve com.mwr.example.sieve.AuthService --msg 2354 9234 1 --extra string com.mwr.example.sieve.PIN 1337 --bundle-as-obj
```
![](<../../../.gitbook/assets/image (647).png>)

### å¹¿æ’­æ¥æ”¶å™¨

**åœ¨AndroidåŸºæœ¬ä¿¡æ¯éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä»€ä¹ˆæ˜¯å¹¿æ’­æ¥æ”¶å™¨**ã€‚

åœ¨å‘ç°è¿™äº›å¹¿æ’­æ¥æ”¶å™¨åï¼Œæ‚¨åº”è¯¥**æ£€æŸ¥å®ƒä»¬çš„ä»£ç **ã€‚ç‰¹åˆ«æ³¨æ„**`onReceive`**å‡½æ•°ï¼Œå› ä¸ºå®ƒå°†å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚

#### **æ£€æµ‹æ‰€æœ‰** å¹¿æ’­æ¥æ”¶å™¨
```bash
run app.broadcast.info #Detects all
```
#### æ£€æŸ¥åº”ç”¨çš„å¹¿æ’­æ¥æ”¶å™¨
```bash
#Check one negative
run app.broadcast.info -a jakhar.aseem.diva
Package: jakhar.aseem.diva
No matching receivers.

# Check one positive
run app.broadcast.info -a com.google.android.youtube
Package: com.google.android.youtube
com.google.android.libraries.youtube.player.PlayerUiModule$LegacyMediaButtonIntentReceiver
Permission: null
com.google.android.apps.youtube.app.common.notification.GcmBroadcastReceiver
Permission: com.google.android.c2dm.permission.SEND
com.google.android.apps.youtube.app.PackageReplacedReceiver
Permission: null
com.google.android.libraries.youtube.account.AccountsChangedReceiver
Permission: null
com.google.android.apps.youtube.app.application.system.LocaleUpdatedReceiver
Permission: null
```
#### å¹¿æ’­ **äº¤äº’**
```bash
app.broadcast.info          Get information about broadcast receivers
app.broadcast.send          Send broadcast using an intent
app.broadcast.sniff         Register a broadcast receiver that can sniff particular intents
```
#### å‘é€æ¶ˆæ¯

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ©ç”¨ [FourGoats apk](https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk) å†…å®¹æä¾›è€…ï¼Œä½ å¯ä»¥ **å‘é€ä»»æ„çŸ­ä¿¡** åˆ°ä»»ä½•éé«˜çº§ç›®çš„åœ° **è€Œæ— éœ€** ç”¨æˆ·çš„è®¸å¯ã€‚

![](<../../../.gitbook/assets/image (415).png>)

![](<../../../.gitbook/assets/image (573).png>)

å¦‚æœä½ é˜…è¯»ä»£ç ï¼Œå‚æ•° "_phoneNumber_" å’Œ "_message_" å¿…é¡»å‘é€åˆ°å†…å®¹æä¾›è€…ã€‚
```bash
run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --component org.owasp.goatdroid.fourgoats.broadcastreceivers SendSMSNowReceiver --extra string phoneNumber 123456789 --extra string message "Hello mate!"
```
### æ˜¯å¦å¯è°ƒè¯•

ç”Ÿäº§APKç»ä¸åº”è¯¥æ˜¯å¯è°ƒè¯•çš„ã€‚\
è¿™æ„å‘³ç€æ‚¨å¯ä»¥**é™„åŠ Javaè°ƒè¯•å™¨**åˆ°æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œå®æ—¶æ£€æŸ¥ï¼Œè®¾ç½®æ–­ç‚¹ï¼Œé€æ­¥æ‰§è¡Œï¼Œæ”¶é›†å˜é‡å€¼ç”šè‡³æ›´æ”¹å®ƒä»¬ã€‚[InfoSec Instituteæœ‰ä¸€ç¯‡ä¼˜ç§€çš„æ–‡ç« ](../exploiting-a-debuggeable-applciation.md)å…³äºå½“æ‚¨çš„åº”ç”¨ç¨‹åºå¯è°ƒè¯•æ—¶æ·±å…¥æŒ–æ˜å’Œæ³¨å…¥è¿è¡Œæ—¶ä»£ç ã€‚

å½“åº”ç”¨ç¨‹åºå¯è°ƒè¯•æ—¶ï¼Œå®ƒå°†åœ¨Manifestä¸­å‡ºç°ï¼š
```xml
<application theme="@2131296387" debuggable="true"
```
æ‚¨å¯ä»¥ä½¿ç”¨ **Drozer** æ‰¾åˆ°æ‰€æœ‰å¯è°ƒè¯•çš„åº”ç”¨ç¨‹åºï¼š
```bash
run app.package.debuggable
```
## æ•™ç¨‹

* [https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref](https://resources.infosecinstitute.com/android-penetration-tools-walkthrough-series-drozer/#gref)
* [https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md](https://github.com/mgcfish/mobiletools/blob/master/\_posts/2016-08-01-Using-Drozer-for-application-security-assessments.md)
* [https://www.hackingarticles.in/android-penetration-testing-drozer/](https://www.hackingarticles.in/android-penetration-testing-drozer/)
* [https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac](https://medium.com/@ashrafrizvi3006/how-to-test-android-application-security-using-drozer-edc002c5dcac)

## æ›´å¤šä¿¡æ¯

* [https://blog.dixitaditya.com/android-pentesting-cheatsheet/](https://blog.dixitaditya.com/android-pentesting-cheatsheet/)

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**æ¼æ´èµé‡‘æç¤º**ï¼š**æ³¨å†Œ** **Intigriti**ï¼Œä¸€ä¸ªç”±é»‘å®¢ä¸ºé»‘å®¢åˆ›å»ºçš„é«˜çº§**æ¼æ´èµé‡‘å¹³å°**ï¼ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æ”»å‡»ï¼š <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
