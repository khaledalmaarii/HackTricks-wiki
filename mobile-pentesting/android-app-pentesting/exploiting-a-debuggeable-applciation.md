# Exploiter une application d√©bogable

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supportez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

# **Contourner les v√©rifications de root et d√©bogage**

Cette section du post est un r√©sum√© du post [**https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0**](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)

## √âtapes pour rendre une application Android d√©bogable et contourner les v√©rifications

### **Rendre l'application d√©bogable**

Contenu bas√© sur https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0

1. **D√©compiler l'APK :**
- Utilisez l'outil APK-GUI pour d√©compiler l'APK.
- Dans le fichier _android-manifest_, ins√©rez `android:debuggable=true` pour activer le mode d√©bogage.
- Recompilez, signez et zipalign l'application modifi√©e.

2. **Installer l'application modifi√©e :**
- Utilisez la commande : `adb install <application_name>`.

3. **R√©cup√©rer le nom du package :**
- Ex√©cutez `adb shell pm list packages ‚Äì3` pour lister les applications tierces et trouver le nom du package.

4. **Configurer l'application pour attendre la connexion du d√©bogueur :**
- Commande : `adb shell am setup-debug-app ‚Äìw <package_name>`.
- **Remarque :** Cette commande doit √™tre ex√©cut√©e chaque fois avant de d√©marrer l'application pour s'assurer qu'elle attend le d√©bogueur.
- Pour la persistance, utilisez `adb shell am setup-debug-app ‚Äìw -‚Äìpersistent <package_name>`.
- Pour supprimer tous les drapeaux, utilisez `adb shell am clear-debug-app <package_name>`.

5. **Pr√©parer le d√©bogage dans Android Studio :**
- Naviguez dans Android Studio vers _File -> Open Profile or APK_.
- Ouvrez l'APK recompil√©.

6. **D√©finir des points d'arr√™t dans des fichiers Java cl√©s :**
- Placez des points d'arr√™t dans `MainActivity.java` (sp√©cifiquement dans la m√©thode `onCreate`), `b.java`, et `ContextWrapper.java`.

### **Contourner les v√©rifications**

L'application, √† certains moments, v√©rifiera si elle est d√©bogable et v√©rifiera √©galement la pr√©sence de binaires indiquant un appareil root√©. Le d√©bogueur peut √™tre utilis√© pour modifier les informations de l'application, d√©sactiver le bit d√©bogable et alt√©rer les noms des binaires recherch√©s pour contourner ces v√©rifications.

Pour la v√©rification d√©bogable :

1. **Modifier les param√®tres de drapeau :**
- Dans la section des variables de la console du d√©bogueur, naviguez vers : `this mLoadedAPK -> mApplicationInfo -> flags = 814267974`.
- **Remarque :** La repr√©sentation binaire de `flags = 814267974` est `11000011100111011110`, indiquant que le "Flag_debuggable" est actif.

![https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png](https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png)

Ces √©tapes garantissent collectivement que l'application peut √™tre d√©bogu√©e et que certaines v√©rifications de s√©curit√© peuvent √™tre contourn√©es √† l'aide du d√©bogueur, facilitant une analyse ou une modification plus approfondie du comportement de l'application.

L'√©tape 2 consiste √† changer une valeur de drapeau √† 814267972, qui est repr√©sent√©e en binaire comme 110000101101000000100010100.

# **Exploiter une vuln√©rabilit√©**

Une d√©monstration a √©t√© fournie en utilisant une application vuln√©rable contenant un bouton et un textview. Au d√©part, l'application affiche "Crack Me". L'objectif est de modifier le message de "Try Again" √† "Hacked" √† l'ex√©cution, sans modifier le code source.

## **V√©rification de la vuln√©rabilit√©**
- L'application a √©t√© d√©compil√©e √† l'aide de `apktool` pour acc√©der au fichier `AndroidManifest.xml`.
- La pr√©sence de `android_debuggable="true"` dans le AndroidManifest.xml indique que l'application est d√©bogable et susceptible d'exploitation.
- Il convient de noter que `apktool` est utilis√© uniquement pour v√©rifier le statut d√©bogable sans modifier de code.

## **Pr√©paration de la configuration**
- Le processus a impliqu√© le lancement d'un √©mulateur, l'installation de l'application vuln√©rable et l'utilisation de `adb jdwp` pour identifier les ports Dalvik VM √† l'√©coute.
- Le JDWP (Java Debug Wire Protocol) permet de d√©boguer une application s'ex√©cutant dans une VM en exposant un port unique.
- Le transfert de port √©tait n√©cessaire pour le d√©bogage √† distance, suivi de l'attachement de JDB √† l'application cible.

## **Injection de code √† l'ex√©cution**
- L'exploitation a √©t√© r√©alis√©e en d√©finissant des points d'arr√™t et en contr√¥lant le flux de l'application.
- Des commandes comme `classes` et `methods <class_name>` ont √©t√© utilis√©es pour d√©couvrir la structure de l'application.
- Un point d'arr√™t a √©t√© d√©fini dans la m√©thode `onClick`, et son ex√©cution a √©t√© contr√¥l√©e.
- Les commandes `locals`, `next` et `set` ont √©t√© utilis√©es pour inspecter et modifier les variables locales, en particulier en changeant le message "Try Again" en "Hacked".
- Le code modifi√© a √©t√© ex√©cut√© √† l'aide de la commande `run`, modifiant avec succ√®s la sortie de l'application en temps r√©el.

Cet exemple a d√©montr√© comment le comportement d'une application d√©bogable peut √™tre manipul√©, soulignant le potentiel d'exploits plus complexes comme l'obtention d'un acc√®s shell sur l'appareil dans le contexte de l'application.

## R√©f√©rences
* [https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)
* [https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications](https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications)

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supportez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
