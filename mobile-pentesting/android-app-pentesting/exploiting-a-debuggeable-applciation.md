# Ausnutzen einer debuggebaren Anwendung

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

# **Umgehen von Root- und Debugging-√úberpr√ºfungen**

Dieser Abschnitt des Beitrags ist eine Zusammenfassung des Beitrags [**https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0**](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)

## Schritte, um eine Android-App debuggebar zu machen und √úberpr√ºfungen zu umgehen

### **Die App debuggebar machen**

Inhalt basiert auf https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0

1. **APK dekompilieren:**
- Verwenden Sie das APK-GUI-Tool zum Dekompilieren der APK.
- F√ºgen Sie in der _android-manifest_-Datei `android:debuggable=true` hinzu, um den Debugging-Modus zu aktivieren.
- Kompilieren Sie die modifizierte Anwendung neu, signieren Sie sie und zipalignen Sie sie.

2. **Die modifizierte Anwendung installieren:**
- Verwenden Sie den Befehl: `adb install <application_name>`.

3. **Den Paketnamen abrufen:**
- F√ºhren Sie `adb shell pm list packages ‚Äì3` aus, um Drittanbieteranwendungen aufzulisten und den Paketnamen zu finden.

4. **Die App so einstellen, dass sie auf eine Debugger-Verbindung wartet:**
- Befehl: `adb shell am setup-debug-app ‚Äìw <package_name>`.
- **Hinweis:** Dieser Befehl muss jedes Mal ausgef√ºhrt werden, bevor die Anwendung gestartet wird, um sicherzustellen, dass sie auf den Debugger wartet.
- F√ºr Persistenz verwenden Sie `adb shell am setup-debug-app ‚Äìw -‚Äìpersistent <package_name>`.
- Um alle Flags zu entfernen, verwenden Sie `adb shell am clear-debug-app <package_name>`.

5. **F√ºr das Debugging in Android Studio vorbereiten:**
- Navigieren Sie in Android Studio zu _Datei -> Profil oder APK √∂ffnen_.
- √ñffnen Sie die neu kompilierte APK.

6. **Breakpoints in wichtigen Java-Dateien setzen:**
- Setzen Sie Breakpoints in `MainActivity.java` (insbesondere in der `onCreate`-Methode), `b.java` und `ContextWrapper.java`.

### **√úberpr√ºfungen umgehen**

Die Anwendung wird an bestimmten Punkten √ºberpr√ºfen, ob sie debuggebar ist, und auch nach Bin√§rdateien suchen, die auf ein gerootetes Ger√§t hinweisen. Der Debugger kann verwendet werden, um Anwendungsinformationen zu √§ndern, das debuggebare Bit zur√ºckzusetzen und die Namen der gesuchten Bin√§rdateien zu √§ndern, um diese √úberpr√ºfungen zu umgehen.

F√ºr die debuggebare √úberpr√ºfung:

1. **Flag-Einstellungen √§ndern:**
- Navigieren Sie im Variablenbereich der Debugger-Konsole zu: `this mLoadedAPK -> mApplicationInfo -> flags = 814267974`.
- **Hinweis:** Die bin√§re Darstellung von `flags = 814267974` ist `11000011100111011110`, was darauf hinweist, dass das "Flag_debuggable" aktiv ist.

![https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png](https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png)

Diese Schritte stellen gemeinsam sicher, dass die Anwendung debugged werden kann und dass bestimmte Sicherheits√ºberpr√ºfungen mithilfe des Debuggers umgangen werden k√∂nnen, was eine eingehendere Analyse oder Modifikation des Verhaltens der Anwendung erm√∂glicht.

Schritt 2 beinhaltet das √Ñndern eines Flag-Werts auf 814267972, der bin√§r als 110000101101000000100010100 dargestellt wird.

# **Eine Schwachstelle ausnutzen**

Eine Demonstration wurde mit einer verwundbaren Anwendung bereitgestellt, die einen Button und ein Textfeld enth√§lt. Zun√§chst zeigt die Anwendung "Crack Me" an. Ziel ist es, die Nachricht von "Try Again" zu "Hacked" zur Laufzeit zu √§ndern, ohne den Quellcode zu modifizieren.

## **√úberpr√ºfung auf Schwachstellen**
- Die Anwendung wurde mit `apktool` dekompiliert, um auf die `AndroidManifest.xml`-Datei zuzugreifen.
- Das Vorhandensein von `android_debuggable="true"` in der AndroidManifest.xml zeigt an, dass die Anwendung debuggebar und anf√§llig f√ºr Ausnutzung ist.
- Es ist erw√§hnenswert, dass `apktool` ausschlie√ülich verwendet wird, um den debuggebaren Status zu √ºberpr√ºfen, ohne den Code zu √§ndern.

## **Vorbereitung des Setups**
- Der Prozess umfasste das Starten eines Emulators, das Installieren der verwundbaren Anwendung und die Verwendung von `adb jdwp`, um die Dalvik-VM-Ports zu identifizieren, die lauschen.
- Das JDWP (Java Debug Wire Protocol) erm√∂glicht das Debuggen einer Anwendung, die in einer VM l√§uft, indem ein einzigartiger Port bereitgestellt wird.
- Portweiterleitung war notwendig f√ºr das Remote-Debugging, gefolgt von der Anbindung von JDB an die Zielanwendung.

## **Code zur Laufzeit injizieren**
- Die Ausnutzung wurde durch das Setzen von Breakpoints und das Steuern des Anwendungsflusses durchgef√ºhrt.
- Befehle wie `classes` und `methods <class_name>` wurden verwendet, um die Struktur der Anwendung aufzudecken.
- Ein Breakpoint wurde in der `onClick`-Methode gesetzt, und ihre Ausf√ºhrung wurde kontrolliert.
- Die Befehle `locals`, `next` und `set` wurden verwendet, um lokale Variablen zu inspizieren und zu √§ndern, insbesondere um die Nachricht "Try Again" in "Hacked" zu √§ndern.
- Der modifizierte Code wurde mit dem Befehl `run` ausgef√ºhrt, wodurch die Ausgabe der Anwendung in Echtzeit erfolgreich ge√§ndert wurde.

Dieses Beispiel demonstrierte, wie das Verhalten einer debuggebaren Anwendung manipuliert werden kann, was das Potenzial f√ºr komplexere Ausnutzungen wie den Zugriff auf die Shell des Ger√§ts im Kontext der Anwendung hervorhebt.

## Referenzen
* [https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)
* [https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications](https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
