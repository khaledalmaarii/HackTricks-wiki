# Wykorzystywanie aplikacji z moÅ¼liwoÅ›ciÄ… debugowania

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

# **Omijanie kontroli root i debugowalnoÅ›ci**

Ta sekcja posta jest podsumowaniem z posta [**https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0**](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)

## Kroki, aby uczyniÄ‡ aplikacjÄ™ Android debugowalnÄ… i ominÄ…Ä‡ kontrole

### **Uczynienie aplikacji debugowalnÄ…**

TreÅ›Ä‡ oparta na https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0

1. **Dezkompilacja APK:**
- Wykorzystaj narzÄ™dzie APK-GUI do dezkompilacji APK.
- W pliku _android-manifest_ wstaw `android:debuggable=true`, aby wÅ‚Ä…czyÄ‡ tryb debugowania.
- Ponownie skompiluj, podpisz i zipalignuj zmodyfikowanÄ… aplikacjÄ™.

2. **Zainstaluj zmodyfikowanÄ… aplikacjÄ™:**
- UÅ¼yj polecenia: `adb install <application_name>`.

3. **Pobierz nazwÄ™ pakietu:**
- Wykonaj `adb shell pm list packages â€“3`, aby wylistowaÄ‡ aplikacje firm trzecich i znaleÅºÄ‡ nazwÄ™ pakietu.

4. **Ustaw aplikacjÄ™ na oczekiwanie na poÅ‚Ä…czenie debugera:**
- Polecenie: `adb shell am setup-debug-app â€“w <package_name>`.
- **Uwaga:** To polecenie musi byÄ‡ uruchamiane za kaÅ¼dym razem przed uruchomieniem aplikacji, aby upewniÄ‡ siÄ™, Å¼e czeka na debuger.
- Aby uzyskaÄ‡ trwaÅ‚oÅ›Ä‡, uÅ¼yj `adb shell am setup-debug-app â€“w -â€“persistent <package_name>`.
- Aby usunÄ…Ä‡ wszystkie flagi, uÅ¼yj `adb shell am clear-debug-app <package_name>`.

5. **Przygotuj siÄ™ do debugowania w Android Studio:**
- PrzejdÅº w Android Studio do _File -> Open Profile or APK_.
- OtwÃ³rz ponownie skompilowane APK.

6. **Ustaw punkty przerwania w kluczowych plikach Java:**
- UmieÅ›Ä‡ punkty przerwania w `MainActivity.java` (szczegÃ³lnie w metodzie `onCreate`), `b.java` i `ContextWrapper.java`.

### **Omijanie kontroli**

Aplikacja w pewnych momentach bÄ™dzie weryfikowaÄ‡, czy jest debugowalna, a takÅ¼e sprawdzi, czy istniejÄ… binaria wskazujÄ…ce na zrootowane urzÄ…dzenie. Debugger moÅ¼e byÄ‡ uÅ¼yty do modyfikacji informacji o aplikacji, usuniÄ™cia bitu debugowalnoÅ›ci i zmiany nazw wyszukiwanych binariÃ³w, aby ominÄ…Ä‡ te kontrole.

Dla kontroli debugowalnoÅ›ci:

1. **Modyfikacja ustawieÅ„ flag:**
- W sekcji zmiennych konsoli debuggera przejdÅº do: `this mLoadedAPK -> mApplicationInfo -> flags = 814267974`.
- **Uwaga:** Reprezentacja binarna `flags = 814267974` to `11000011100111011110`, co wskazuje, Å¼e "Flag_debuggable" jest aktywna.

![https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png](https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png)

Te kroki zbiorczo zapewniajÄ…, Å¼e aplikacja moÅ¼e byÄ‡ debugowana i Å¼e pewne kontrole bezpieczeÅ„stwa mogÄ… byÄ‡ omijane przy uÅ¼yciu debuggera, co uÅ‚atwia bardziej szczegÃ³Å‚owÄ… analizÄ™ lub modyfikacjÄ™ zachowania aplikacji.

Krok 2 polega na zmianie wartoÅ›ci flagi na 814267972, ktÃ³ra jest reprezentowana w postaci binarnej jako 110000101101000000100010100.

# **Wykorzystywanie luki**

Demonstrowano to przy uÅ¼yciu podatnej aplikacji zawierajÄ…cej przycisk i textview. PoczÄ…tkowo aplikacja wyÅ›wietla "Crack Me". Celem jest zmiana wiadomoÅ›ci z "Try Again" na "Hacked" w czasie rzeczywistym, bez modyfikacji kodu ÅºrÃ³dÅ‚owego.

## **Sprawdzanie podatnoÅ›ci**
- Aplikacja zostaÅ‚a dezkompilowana przy uÅ¼yciu `apktool`, aby uzyskaÄ‡ dostÄ™p do pliku `AndroidManifest.xml`.
- ObecnoÅ›Ä‡ `android_debuggable="true"` w AndroidManifest.xml wskazuje, Å¼e aplikacja jest debugowalna i podatna na wykorzystanie.
- Warto zauwaÅ¼yÄ‡, Å¼e `apktool` jest uÅ¼ywane wyÅ‚Ä…cznie do sprawdzenia statusu debugowalnoÅ›ci bez modyfikacji jakiegokolwiek kodu.

## **Przygotowanie ustawienia**
- Proces obejmowaÅ‚ uruchomienie emulatora, zainstalowanie podatnej aplikacji i uÅ¼ycie `adb jdwp`, aby zidentyfikowaÄ‡ porty Dalvik VM, ktÃ³re nasÅ‚uchujÄ….
- JDWP (Java Debug Wire Protocol) umoÅ¼liwia debugowanie aplikacji dziaÅ‚ajÄ…cej w VM, udostÄ™pniajÄ…c unikalny port.
- Przekierowanie portÃ³w byÅ‚o konieczne do zdalnego debugowania, a nastÄ™pnie doÅ‚Ä…czenia JDB do docelowej aplikacji.

## **Wstrzykiwanie kodu w czasie rzeczywistym**
- Wykorzystanie luki odbyÅ‚o siÄ™ poprzez ustawienie punktÃ³w przerwania i kontrolowanie przepÅ‚ywu aplikacji.
- UÅ¼yto poleceÅ„ takich jak `classes` i `methods <class_name>`, aby odkryÄ‡ strukturÄ™ aplikacji.
- Ustawiono punkt przerwania w metodzie `onClick`, a jego wykonanie byÅ‚o kontrolowane.
- UÅ¼yto poleceÅ„ `locals`, `next` i `set`, aby sprawdziÄ‡ i zmodyfikowaÄ‡ zmienne lokalne, szczegÃ³lnie zmieniajÄ…c wiadomoÅ›Ä‡ "Try Again" na "Hacked".
- Zmodyfikowany kod zostaÅ‚ wykonany przy uÅ¼yciu polecenia `run`, skutecznie zmieniajÄ…c wynik aplikacji w czasie rzeczywistym.

Ten przykÅ‚ad demonstruje, jak moÅ¼na manipulowaÄ‡ zachowaniem debugowalnej aplikacji, podkreÅ›lajÄ…c potencjaÅ‚ bardziej zÅ‚oÅ¼onych exploitÃ³w, takich jak uzyskanie dostÄ™pu do powÅ‚oki na urzÄ…dzeniu w kontekÅ›cie aplikacji.

## Referencje
* [https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)
* [https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications](https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications)

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
