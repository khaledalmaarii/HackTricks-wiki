# Wykorzystywanie debugowalnej aplikacji

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

# **OminiÄ™cie sprawdzeÅ„ roota i debugowalnoÅ›ci**

Ta sekcja pochodzi z posta [**https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0**](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)

## Kroki do zrobienia aplikacji Android debugowalnej i ominiÄ™cia sprawdzeÅ„

### **Ustawienie aplikacji jako debugowalnej**

ZawartoÅ›Ä‡ oparta na https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0

1. **Dekompilacja pliku APK:**
- Wykorzystaj narzÄ™dzie APK-GUI do dekompilacji pliku APK.
- W pliku _android-manifest_ wstaw `android:debuggable=true`, aby wÅ‚Ä…czyÄ‡ tryb debugowania.
- Przebuduj, podpisz i zipalignuj zmodyfikowanÄ… aplikacjÄ™.

2. **Zainstaluj zmodyfikowanÄ… aplikacjÄ™:**
- UÅ¼yj polecenia: `adb install <nazwa_aplikacji>`.

3. **Pobierz nazwÄ™ pakietu:**
- Wykonaj polecenie `adb shell pm list packages â€“3`, aby wyÅ›wietliÄ‡ listÄ™ aplikacji innych firm i znaleÅºÄ‡ nazwÄ™ pakietu.

4. **Ustaw aplikacjÄ™ w trybie oczekiwania na poÅ‚Ä…czenie debugera:**
- Polecenie: `adb shell am setup-debug-app â€“w <nazwa_pakietu>`.
- **Uwaga:** To polecenie musi byÄ‡ uruchamiane za kaÅ¼dym razem przed uruchomieniem aplikacji, aby zapewniÄ‡ oczekiwanie na debugger.
- Aby zachowaÄ‡ trwaÅ‚oÅ›Ä‡, uÅ¼yj `adb shell am setup-debug-app â€“w -â€“persistent <nazwa_pakietu>`.
- Aby usunÄ…Ä‡ wszystkie flagi, uÅ¼yj `adb shell am clear-debug-app <nazwa_pakietu>`.

5. **Przygotuj siÄ™ do debugowania w Android Studio:**
- PrzejdÅº w Android Studio do _Plik -> OtwÃ³rz profil lub APK_.
- OtwÃ³rz przebudowany plik APK.

6. **Ustaw punkty przerwania w kluczowych plikach Java:**
- UmieÅ›Ä‡ punkty przerwania w plikach `MainActivity.java` (szczegÃ³lnie w metodzie `onCreate`), `b.java` i `ContextWrapper.java`.

### **OminiÄ™cie sprawdzeÅ„**

Aplikacja w okreÅ›lonych momentach sprawdzi, czy jest debugowalna, a takÅ¼e sprawdzi, czy istniejÄ… binarne wskazujÄ…ce na zrootowane urzÄ…dzenie. Debugger moÅ¼e byÄ‡ uÅ¼ywany do modyfikowania informacji o aplikacji, odznaczania bitu debugowalnoÅ›ci i zmiany nazw wyszukiwanych binarnych w celu ominiÄ™cia tych sprawdzeÅ„.

Dla sprawdzenia debugowalnoÅ›ci:

1. **Modyfikacja ustawieÅ„ flag:**
- W sekcji zmiennych konsoli debugera przejdÅº do: `this mLoadedAPK -> mApplicationInfo -> flags = 814267974`.
- **Uwaga:** Reprzezentacja binarna `flags = 814267974` to `11000011100111011110`, co oznacza, Å¼e "Flag_debuggable" jest aktywny.

![https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png](https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png)

Te kroki zapewniajÄ…, Å¼e aplikacja moÅ¼e byÄ‡ debugowana i Å¼e pewne sprawdzenia bezpieczeÅ„stwa mogÄ… byÄ‡ ominiÄ™te przy uÅ¼yciu debugera, uÅ‚atwiajÄ…c bardziej szczegÃ³Å‚owÄ… analizÄ™ lub modyfikacjÄ™ zachowania aplikacji.

Krok 2 polega na zmianie wartoÅ›ci flagi na 814267972, co jest reprezentowane binarnie jako 110000101101000000100010100.

# **Wykorzystanie podatnoÅ›ci**

Przedstawiono demonstracjÄ™ z wykorzystaniem podatnej aplikacji zawierajÄ…cej przycisk i pole tekstowe. PoczÄ…tkowo aplikacja wyÅ›wietla "Crack Me". Celem jest zmiana wiadomoÅ›ci z "Try Again" na "Hacked" w czasie rzeczywistym, bez modyfikowania kodu ÅºrÃ³dÅ‚owego.

## **Sprawdzanie podatnoÅ›ci**
- Aplikacja zostaÅ‚a zdekompilowana przy uÅ¼yciu `apktool`, aby uzyskaÄ‡ dostÄ™p do pliku `AndroidManifest.xml`.
- ObecnoÅ›Ä‡ `android_debuggable="true"` w pliku AndroidManifest.xml wskazuje, Å¼e aplikacja jest debugowalna i podatna na wykorzystanie.
- Warto zauwaÅ¼yÄ‡, Å¼e narzÄ™dzie `apktool` jest uÅ¼ywane wyÅ‚Ä…cznie do sprawdzenia statusu debugowalnoÅ›ci bez zmieniania jakiegokolwiek kodu.

## **Przygotowanie konfiguracji**
- Proces obejmowaÅ‚ uruchomienie emulatora, zainstalowanie podatnej aplikacji i uÅ¼ycie `adb jdwp`, aby zidentyfikowaÄ‡ porty Dalvik VM, ktÃ³re nasÅ‚uchujÄ….
- JDWP (Java Debug Wire Protocol) umoÅ¼liwia debugowanie aplikacji dziaÅ‚ajÄ…cej w maszynie wirtualnej poprzez udostÄ™pnienie unikalnego portu.
- Przekierowanie portÃ³w byÅ‚o konieczne do zdalnego debugowania, a nastÄ™pnie doÅ‚Ä…czenie JDB do docelowej aplikacji.

## **Wstrzykiwanie kodu w czasie rzeczywistym**
- Wykorzystano punkty przerwania i kontrolowano przebieg aplikacji.
- UÅ¼ywano poleceÅ„ takich jak `classes` i `methods <nazwa_klasy>`, aby poznaÄ‡ strukturÄ™ aplikacji.
- Ustawiono punkt przerwania w metodzie `onClick` i kontrolowano jej wykonanie.
- Wykorzystano polecenia `locals`, `next` i `set`, aby sprawdziÄ‡ i zmodyfikowaÄ‡ zmienne lokalne, szczegÃ³lnie zmieniajÄ…c wiadomoÅ›Ä‡ "Try Again" na "Hacked".
- Zmodyfikowany kod zostaÅ‚ wykonany przy uÅ¼yciu polecenia `run`, co skutkowaÅ‚o pomyÅ›lnÄ… zmianÄ… wyniku aplikacji w czasie rzeczywistym.

Ten przykÅ‚ad pokazaÅ‚, jak moÅ¼na manipulowaÄ‡ zachowaniem
