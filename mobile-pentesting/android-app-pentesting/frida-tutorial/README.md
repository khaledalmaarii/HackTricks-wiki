# Fridaæ•™ç¨‹

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘å¹³å° â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**èµé‡‘çŒäººæç¤º**ï¼š**æ³¨å†Œ**Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**èµé‡‘çŒäººå¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬çš„[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## å®‰è£…

å®‰è£…**fridaå·¥å…·**ï¼š
```bash
pip install frida-tools
pip install frida
```
**ä¸‹è½½å¹¶å®‰è£…** Android ä¸Šçš„ **Frida æœåŠ¡å™¨**ï¼ˆ[ä¸‹è½½æœ€æ–°ç‰ˆæœ¬](https://github.com/frida/frida/releases)ï¼‰ã€‚\
ä¸€è¡Œå‘½ä»¤ä»¥ root æ¨¡å¼é‡æ–°å¯åŠ¨ adbï¼Œè¿æ¥åˆ°å®ƒï¼Œä¸Šä¼  frida-serverï¼Œèµ‹äºˆæ‰§è¡Œæƒé™å¹¶åœ¨åå°è¿è¡Œï¼š
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
**æ£€æŸ¥**æ˜¯å¦**æ­£å¸¸å·¥ä½œ**ï¼š
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## æ•™ç¨‹

### [æ•™ç¨‹ 1](frida-tutorial-1.md)

**æ¥æº**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**æºä»£ç **: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

ç‚¹å‡»[é“¾æ¥é˜…è¯»](frida-tutorial-1.md)ã€‚

### [æ•™ç¨‹ 2](frida-tutorial-2.md)

**æ¥æº**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (ç¬¬2ã€3å’Œ4éƒ¨åˆ†)\
**APKs å’Œæºä»£ç **: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

ç‚¹å‡»[é“¾æ¥é˜…è¯»](frida-tutorial-2.md)ã€‚

### [æ•™ç¨‹ 3](owaspuncrackable-1.md)

**æ¥æº**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk)

ç‚¹å‡»[é“¾æ¥é˜…è¯»](owaspuncrackable-1.md)ã€‚\
**ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ä¸€äº›å¾ˆæ£’çš„ Frida è„šæœ¬:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## å¿«é€Ÿç¤ºä¾‹

åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥æ‰¾åˆ° Frida çš„æ›´åŸºæœ¬å’Œæœ‰è¶£çš„åŠŸèƒ½ï¼Œä»¥ä¾¿å¿«é€Ÿç¼–å†™è„šæœ¬ï¼š

### ä»å‘½ä»¤è¡Œè°ƒç”¨ Frida
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### åŸºæœ¬çš„Pythonè„šæœ¬

```python
import frida

# Attach to the target process
session = frida.attach("com.example.app")

# Define the JavaScript code to be injected
js_code = """
Java.perform(function () {
    // Hook the target method
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // Modify the behavior of the target method
        console.log("Target method hooked!");
        // Call the original method
        this.targetMethod();
    };
});
"""

# Create a script from the JavaScript code
script = session.create_script(js_code)

# Load the script into the target process
script.load()

# Detach from the target process
session.detach()
```

### åŸºæœ¬çš„Pythonè„šæœ¬

```python
import frida

# è¿æ¥åˆ°ç›®æ ‡è¿›ç¨‹
session = frida.attach("com.example.app")

# å®šä¹‰è¦æ³¨å…¥çš„JavaScriptä»£ç 
js_code = """
Java.perform(function () {
    // é’©ä½ç›®æ ‡æ–¹æ³•
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // ä¿®æ”¹ç›®æ ‡æ–¹æ³•çš„è¡Œä¸º
        console.log("ç›®æ ‡æ–¹æ³•å·²é’©ä½ï¼");
        // è°ƒç”¨åŸå§‹æ–¹æ³•
        this.targetMethod();
    };
});
"""

# ä»JavaScriptä»£ç åˆ›å»ºè„šæœ¬
script = session.create_script(js_code)

# å°†è„šæœ¬åŠ è½½åˆ°ç›®æ ‡è¿›ç¨‹ä¸­
script.load()

# ä»ç›®æ ‡è¿›ç¨‹ä¸­åˆ†ç¦»
session.detach()
```
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### æ²¡æœ‰å‚æ•°çš„å‡½æ•°æŒ‚é’©

æŒ‚é’©ç±» `sg.vantagepoint.a.c` çš„å‡½æ•° `a()`
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
# Frida Tutorial: Hooking `exit()` in Java

In this tutorial, we will learn how to use Frida to hook the `exit()` function in Java. By hooking this function, we can intercept the program's exit and perform additional actions before the application terminates.

## Prerequisites

Before we begin, make sure you have the following:

- A rooted Android device or an emulator
- Frida installed on your machine
- Basic knowledge of Java and JavaScript

## Steps

1. Launch the target application on your Android device or emulator.

2. Open a terminal and start the Frida server by running the following command:

   ```bash
   frida-server
   ```

3. Create a new JavaScript file, for example `hook_exit.js`, and add the following code:

   ```javascript
   Java.perform(function() {
       var System = Java.use('java.lang.System');
       var Runtime = Java.use('java.lang.Runtime');

       // Hook the exit() function
       System.exit.overload('int').implementation = function(code) {
           console.log('Exit code: ' + code);

           // Perform additional actions here

           // Call the original exit() function
           this.exit(code);
       };
   });
   ```

4. Save the JavaScript file and use Frida to inject it into the target application by running the following command:

   ```bash
   frida -U -l hook_exit.js -f <package_name>
   ```

   Replace `<package_name>` with the package name of the target application.

5. You should see the output of the `console.log()` statement whenever the `exit()` function is called in the target application.

6. Customize the code inside the `implementation` block to perform your desired actions before the application exits.

That's it! You have successfully hooked the `exit()` function in Java using Frida. You can now intercept the program's exit and add your own logic or perform any necessary actions.
```javascript
var sysexit = Java.use("java.lang.System");
sysexit.exit.overload("int").implementation = function(var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)");
};
```
# Frida Tutorial: Hook MainActivity `.onStart()` & `.onCreate()`

In this tutorial, we will learn how to use Frida to hook the `.onStart()` and `.onCreate()` methods of the MainActivity class in an Android app.

## Prerequisites

Before we begin, make sure you have the following:

- A rooted Android device or an emulator
- Frida installed on your machine
- A basic understanding of JavaScript

## Step 1: Set Up the Environment

First, we need to set up the environment by installing the necessary tools. Follow these steps:

1. Install Frida on your machine by running the following command:

   ```
   $ pip install frida-tools
   ```

2. Install the Frida server on your Android device or emulator. You can download the server from the [Frida releases page](https://github.com/frida/frida/releases). Make sure to choose the correct version for your device.

3. Connect your Android device or emulator to your machine using a USB cable.

4. Start the Frida server on your Android device or emulator by running the following command:

   ```
   $ adb shell
   $ su
   $ cd /data/local/tmp
   $ ./frida-server
   ```

## Step 2: Write the Frida Script

Next, we will write a Frida script to hook the `.onStart()` and `.onCreate()` methods of the MainActivity class. Create a new file called `hook.js` and add the following code:

```javascript
Java.perform(function() {
  var MainActivity = Java.use('com.example.app.MainActivity');

  MainActivity.onStart.implementation = function() {
    console.log('onStart() hooked');
    this.onStart();
  };

  MainActivity.onCreate.implementation = function() {
    console.log('onCreate() hooked');
    this.onCreate();
  };
});
```

## Step 3: Hook the Methods

Now, we can use Frida to hook the methods. Follow these steps:

1. Compile the Frida script by running the following command:

   ```
   $ frida -c -o compiled_hook.js hook.js
   ```

2. Launch the target app on your Android device or emulator.

3. Attach Frida to the target app by running the following command:

   ```
   $ frida -U -l compiled_hook.js -f com.example.app
   ```

   Replace `com.example.app` with the package name of the target app.

4. You should see the output `onStart() hooked` and `onCreate() hooked` in the console, indicating that the methods have been successfully hooked.

## Conclusion

In this tutorial, we learned how to use Frida to hook the `.onStart()` and `.onCreate()` methods of the MainActivity class in an Android app. This technique can be useful for analyzing and modifying the behavior of Android apps during runtime.
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity");
mainactivity.onStart.overload().implementation = function() {
send("MainActivity.onStart() HIT!!!");
var ret = this.onStart.overload().call(this);
};
mainactivity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("MainActivity.onCreate() HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
# Frida Tutorial: Hook android `.onCreate()`

In this tutorial, we will learn how to hook the `.onCreate()` method in an Android application using Frida. By hooking this method, we can intercept and modify the behavior of the application during its initialization process.

## Prerequisites

Before we begin, make sure you have the following:

- An Android device or emulator
- Frida installed on your machine
- Basic knowledge of JavaScript and Android development

## Steps

1. Start by launching the target application on your Android device or emulator.

2. Open a terminal and navigate to the directory where you have Frida installed.

3. Use the following command to spawn a new Frida server process on the target device:

   ```
   frida-server -D
   ```

4. In a new terminal window, navigate to the directory where you have your Frida scripts.

5. Create a new JavaScript file, for example `hook_oncreate.js`, and open it in a text editor.

6. In the JavaScript file, write the following code to hook the `.onCreate()` method:

   ```javascript
   Java.perform(function() {
       var targetClass = Java.use('com.example.TargetClass');
       targetClass.onCreate.implementation = function() {
           console.log('Hooked .onCreate()');
           // Add your custom code here
           this.onCreate();
       };
   });
   ```

   Replace `com.example.TargetClass` with the actual package and class name of the target application.

7. Save the JavaScript file and return to the terminal.

8. Use the following command to inject the Frida script into the target application:

   ```
   frida -U -l hook_oncreate.js -f com.example.targetapp
   ```

   Replace `com.example.targetapp` with the actual package name of the target application.

9. If everything is set up correctly, you should see the message "Hooked .onCreate()" in the terminal.

10. Now, when the target application is launched, the `.onCreate()` method will be hooked, and your custom code will be executed alongside the original code.

## Conclusion

By hooking the `.onCreate()` method using Frida, you can gain control over the initialization process of an Android application and modify its behavior as desired. This technique can be useful for various purposes, such as bypassing security measures or analyzing the application's behavior.
```javascript
var activity = Java.use("android.app.Activity");
activity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("Activity HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
### ä½¿ç”¨å‚æ•°é’©å–å‡½æ•°å¹¶æ£€ç´¢å€¼

é’©å–è§£å¯†å‡½æ•°ã€‚æ‰“å°è¾“å…¥ï¼Œè°ƒç”¨åŸå§‹å‡½æ•°è§£å¯†è¾“å…¥ï¼Œæœ€åæ‰“å°æ˜æ–‡æ•°æ®ï¼š
```javascript
function getString(data){
var ret = "";
for (var i=0; i < data.length; i++){
ret += data[i].toString();
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a");
aes_decrypt.a.overload("[B","[B").implementation = function(var_0,var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding");
send("Key       : " + getString(var_0));
send("Encrypted : " + getString(var_1));
var ret = this.a.overload("[B","[B").call(this,var_0,var_1);
send("Decrypted : " + ret);

var flag = "";
for (var i=0; i < ret.length; i++){
flag += String.fromCharCode(ret[i]);
}
send("Decrypted flag: " + flag);
return ret; //[B
};
```
### é’©ä½å‡½æ•°å¹¶ä½¿ç”¨æˆ‘ä»¬çš„è¾“å…¥è°ƒç”¨å®ƒ

é’©ä½ä¸€ä¸ªæ¥æ”¶å­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œå¹¶ä½¿ç”¨å…¶ä»–å­—ç¬¦ä¸²è°ƒç”¨å®ƒï¼ˆæ¥è‡ª[è¿™é‡Œ](https://11x256.github.io/Frida-hooking-android-part-2/)ï¼‰
```javascript
var string_class = Java.use("java.lang.String"); // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function(x){ //hooking the new function
var my_string = string_class.$new("My TeSt String#####"); //creating a new String by using `new` operator
console.log("Original arg: " +x );
var ret =  this.fun(my_string); // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: "+ret);
return ret;
};
```
### è·å–å·²åˆ›å»ºçš„ç±»çš„å¯¹è±¡

å¦‚æœæ‚¨æƒ³æå–å·²åˆ›å»ºå¯¹è±¡çš„æŸä¸ªå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ã€‚

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä½•è·å–ç±»my\_activityçš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å‡½æ•°.secret()ï¼Œè¯¥å‡½æ•°å°†æ‰“å°å¯¹è±¡çš„ç§æœ‰å±æ€§ï¼š
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity" , {
onMatch : function(instance){ //This function will be called for every instance found by frida
console.log("Found instance: "+instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete:function(){}
});
```
<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bugèµé‡‘æç¤º**ï¼š**æ³¨å†Œ**Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**Bugèµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
