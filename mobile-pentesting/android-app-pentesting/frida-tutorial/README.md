# Frida æ•™ç¨‹

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live) ä¸Š **å…³æ³¨**æˆ‘ä»¬**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**æ¼æ´èµé‡‘æç¤º**ï¼š**æ³¨å†Œ** Intigritiï¼Œè¿™æ˜¯ä¸€å®¶ç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**æ¼æ´èµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬ï¼Œè®¿é—® [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## å®‰è£…

å®‰è£… **frida å·¥å…·**ï¼š
```bash
pip install frida-tools
pip install frida
```
**ä¸‹è½½å¹¶å®‰è£…**å®‰å“è®¾å¤‡ä¸Šçš„**frida server**ï¼ˆ[ä¸‹è½½æœ€æ–°ç‰ˆæœ¬](https://github.com/frida/frida/releases)ï¼‰ã€‚
ä¸€è¡Œå‘½ä»¤ä»¥rootæ¨¡å¼é‡æ–°å¯åŠ¨adbï¼Œè¿æ¥åˆ°adbï¼Œä¸Šä¼ frida-serverï¼Œèµ‹äºˆæ‰§è¡Œæƒé™å¹¶åœ¨åå°è¿è¡Œï¼š
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
{% endcode %}

**æ£€æŸ¥**æ˜¯å¦**æœ‰æ•ˆ**ï¼š
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## æ•™ç¨‹

### [æ•™ç¨‹ 1](frida-tutorial-1.md)

**æ¥æº**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**æºä»£ç **: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

**ç‚¹å‡»[é“¾æ¥é˜…è¯»](frida-tutorial-1.md).**

### [æ•™ç¨‹ 2](frida-tutorial-2.md)

**æ¥æº**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (ç¬¬2ã€3å’Œ4éƒ¨åˆ†)\
**APKå’Œæºä»£ç **: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

**ç‚¹å‡»[é“¾æ¥é˜…è¯»](frida-tutorial-2.md).**

### [æ•™ç¨‹ 3](owaspuncrackable-1.md)

**æ¥æº**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk)

**ç‚¹å‡»[é“¾æ¥é˜…è¯»](owaspuncrackable-1.md).**

**æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šä»¤äººæ•¬ç•çš„Fridaè„šæœ¬:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## å¿«é€Ÿç¤ºä¾‹

### ä»å‘½ä»¤è¡Œè°ƒç”¨Frida
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### åŸºæœ¬Pythonè„šæœ¬
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### æ²¡æœ‰å‚æ•°çš„å‡½æ•°æŒ‚é’©

æŒ‚é’©ç±»`sg.vantagepoint.a.c`çš„å‡½æ•°`a()`
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
Hook java `exit()`

### Translate:

### Hook java `exit()`

### ç¿»è¯‘ï¼š

### é’©ä½java `exit()`
```javascript
var sysexit = Java.use("java.lang.System");
sysexit.exit.overload("int").implementation = function(var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)");
};
```
### Hook MainActivity `.onStart()` & `.onCreate()`

#### English
```markdown
1. Open the `hook_main_activity.js` file.
2. Add the following code to hook the `onStart()` and `onCreate()` methods of the MainActivity class:

```javascript
Java.perform(function() {
    var MainActivity = Java.use('com.example.app.MainActivity');
    
    MainActivity.onStart.implementation = function() {
        console.log('onStart() is called');
        this.onStart();
    };
    
    MainActivity.onCreate.implementation = function() {
        console.log('onCreate() is called');
        this.onCreate();
    };
});
```
```

#### Chinese
```markdown
1. æ‰“å¼€`hook_main_activity.js`æ–‡ä»¶ã€‚
2. æ·»åŠ ä»¥ä¸‹ä»£ç ä»¥é’©ä½MainActivityç±»çš„`onStart()`å’Œ`onCreate()`æ–¹æ³•ï¼š

```javascript
Java.perform(function() {
    var MainActivity = Java.use('com.example.app.MainActivity');
    
    MainActivity.onStart.implementation = function() {
        console.log('onStart()è¢«è°ƒç”¨');
        this.onStart();
    };
    
    MainActivity.onCreate.implementation = function() {
        console.log('onCreate()è¢«è°ƒç”¨');
        this.onCreate();
    };
});
```
```
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity");
mainactivity.onStart.overload().implementation = function() {
send("MainActivity.onStart() HIT!!!");
var ret = this.onStart.overload().call(this);
};
mainactivity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("MainActivity.onCreate() HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
## Hook android `.onCreate()`

### English
```markdown
To hook the `.onCreate()` method of an Android application, you can use Frida to intercept the method call and execute your custom code. This can be useful for various purposes such as dynamic analysis, debugging, or modifying the behavior of the application.

Here is an example of how you can hook the `.onCreate()` method using Frida:

1. Write a Frida script to intercept the `.onCreate()` method.
2. Load the script into the target Android application using Frida.
3. Run the application and observe the custom code execution when `.onCreate()` is called.

By hooking the `.onCreate()` method, you can gain insights into the application's initialization process and potentially modify its behavior in real-time.
```

### Chinese
```markdown
è¦é’©ä½Androidåº”ç”¨ç¨‹åºçš„`.onCreate()`æ–¹æ³•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Fridaæ‹¦æˆªæ–¹æ³•è°ƒç”¨å¹¶æ‰§è¡Œè‡ªå®šä¹‰ä»£ç ã€‚è¿™å¯¹äºåŠ¨æ€åˆ†æã€è°ƒè¯•æˆ–ä¿®æ”¹åº”ç”¨ç¨‹åºè¡Œä¸ºç­‰å„ç§ç›®çš„éƒ½å¾ˆæœ‰ç”¨ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨Fridaé’©ä½`.onCreate()`æ–¹æ³•çš„ç¤ºä¾‹ï¼š

1. ç¼–å†™ä¸€ä¸ªFridaè„šæœ¬æ¥æ‹¦æˆª`.onCreate()`æ–¹æ³•ã€‚
2. ä½¿ç”¨Fridaå°†è„šæœ¬åŠ è½½åˆ°ç›®æ ‡Androidåº”ç”¨ç¨‹åºä¸­ã€‚
3. è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå¹¶è§‚å¯Ÿåœ¨è°ƒç”¨`.onCreate()`æ—¶è‡ªå®šä¹‰ä»£ç çš„æ‰§è¡Œæƒ…å†µã€‚

é€šè¿‡é’©ä½`.onCreate()`æ–¹æ³•ï¼Œæ‚¨å¯ä»¥æ·±å…¥äº†è§£åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¹¶åœ¨å®æ—¶ä¸­æ½œåœ¨åœ°ä¿®æ”¹å…¶è¡Œä¸ºã€‚
```javascript
var activity = Java.use("android.app.Activity");
activity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("Activity HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
### ä½¿ç”¨å‚æ•°æŒ‚é’©å‡½æ•°å¹¶æ£€ç´¢å€¼

æŒ‚é’©è§£å¯†å‡½æ•°ã€‚æ‰“å°è¾“å…¥ï¼Œè°ƒç”¨åŸå§‹å‡½æ•°è§£å¯†è¾“å…¥ï¼Œæœ€åæ‰“å°æ˜æ–‡æ•°æ®ï¼š
```javascript
function getString(data){
var ret = "";
for (var i=0; i < data.length; i++){
ret += data[i].toString();
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a");
aes_decrypt.a.overload("[B","[B").implementation = function(var_0,var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding");
send("Key       : " + getString(var_0));
send("Encrypted : " + getString(var_1));
var ret = this.a.overload("[B","[B").call(this,var_0,var_1);
send("Decrypted : " + ret);

var flag = "";
for (var i=0; i < ret.length; i++){
flag += String.fromCharCode(ret[i]);
}
send("Decrypted flag: " + flag);
return ret; //[B
};
```
### é’©ä½å‡½æ•°å¹¶ä½¿ç”¨æˆ‘ä»¬çš„è¾“å…¥è°ƒç”¨å®ƒ

é’©ä½ä¸€ä¸ªæ¥æ”¶å­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œå¹¶ç”¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²è°ƒç”¨å®ƒï¼ˆæ¥è‡ª[è¿™é‡Œ](https://11x256.github.io/Frida-hooking-android-part-2/)ï¼‰
```javascript
var string_class = Java.use("java.lang.String"); // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function(x){ //hooking the new function
var my_string = string_class.$new("My TeSt String#####"); //creating a new String by using `new` operator
console.log("Original arg: " +x );
var ret =  this.fun(my_string); // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: "+ret);
return ret;
};
```
### è·å–å·²åˆ›å»ºç±»çš„å¯¹è±¡

å¦‚æœæ‚¨æƒ³æå–å·²åˆ›å»ºå¯¹è±¡çš„æŸä¸ªå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ã€‚

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä½•è·å–ç±»my\_activityçš„å¯¹è±¡ï¼Œä»¥åŠå¦‚ä½•è°ƒç”¨å‡½æ•°.secret()æ¥æ‰“å°å¯¹è±¡çš„ç§æœ‰å±æ€§ï¼š
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity" , {
onMatch : function(instance){ //This function will be called for every instance found by frida
console.log("Found instance: "+instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete:function(){}
});
```
## å…¶ä»–Fridaæ•™ç¨‹

* [https://github.com/DERE-ad2001/Frida-Labs](https://github.com/DERE-ad2001/Frida-Labs)
* [é«˜çº§Fridaç”¨æ³•åšå®¢ç³»åˆ—ç¬¬1éƒ¨åˆ†ï¼šIOSåŠ å¯†åº“](https://8ksec.io/advanced-frida-usage-part-1-ios-encryption-libraries-8ksec-blogs/)



<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**æ¼æ´èµé‡‘æç¤º**ï¼š**æ³¨å†Œ**Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**æ¼æ´èµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬ï¼Œè®¿é—®[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
