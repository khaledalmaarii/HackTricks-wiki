# Frida Tutorial 2

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**Bug bounty tip**: **sign up** for **Intigriti**, Î¼Î¹Î± premium **Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î± bug bounty Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î±Ï€ÏŒ hackers, Î³Î¹Î± hackers**! Join us at [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) today, and start earning bounties up to **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

**This is a summary of the post**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (Parts 2, 3 & 4)\
**APKs and Source code**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

Î¤Î¿ Î¼Î­ÏÎ¿Ï‚ 1 ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï ÎµÏÎºÎ¿Î»Î¿.

**ÎŸÏÎ¹ÏƒÎ¼Î­Î½Î± Î¼Î­ÏÎ· Ï„Î¿Ï… Î±ÏÏ‡Î¹ÎºÎ¿Ï ÎºÏÎ´Î¹ÎºÎ± Î´ÎµÎ½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÎ½ ÎºÎ±Î¹ Î­Ï‡Î¿Ï…Î½ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÎµÎ´Ï.**

## Part 2

Î•Î´Ï Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Î­Î½Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï„Î¿Ï… Ï€ÏÏ‚ Î½Î± **hook 2 functions Î¼Îµ Ï„Î¿ Î¯Î´Î¹Î¿ ÏŒÎ½Î¿Î¼Î±** Î±Î»Î»Î¬ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚.\
Î•Ï€Î¯ÏƒÎ·Ï‚, Î¸Î± Î¼Î¬Î¸ÎµÏ„Îµ Ï€ÏÏ‚ Î½Î± **ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ Î¼Î¹Î± function Î¼Îµ Ï„Î¹Ï‚ Î´Î¹ÎºÎ­Ï‚ ÏƒÎ±Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚**.\
ÎšÎ±Î¹ Ï„Î­Î»Î¿Ï‚, Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î½Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï„Î¿Ï… Ï€ÏÏ‚ Î½Î± **Î²ÏÎµÎ¯Ï„Îµ Î¼Î¹Î± instance Î¼Î¹Î±Ï‚ ÎºÎ»Î¬ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î½Î± Ï„Î·Î½ ÎºÎ¬Î½ÎµÏ„Îµ Î½Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹ Î¼Î¹Î± function**.
```javascript
//s2.js
console.log("Script loaded successfully ");
Java.perform(function x() {
console.log("Inside java perform function");
var my_class = Java.use("com.example.a11x256.frida_test.my_activity");
//Hook "fun" with parameters (int, int)
my_class.fun.overload("int", "int").implementation = function (x, y) { //hooking the old function
console.log("original call: fun(" + x + ", " + y + ")");
var ret_value = this.fun(2, 5);
return ret_value;
};
//Hook "fun" with paramater(String)
var string_class = Java.use("java.lang.String");
my_class.fun.overload("java.lang.String").implementation = function (x) { //hooking the new function
console.log("*")
//Create a new String and call the function with your input.
var my_string = string_class.$new("My TeSt String#####");
console.log("Original arg: " + x);
var ret = this.fun(my_string);
console.log("Return value: " + ret);
console.log("*")
return ret;
};
//Find an instance of the class and call "secret" function.
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
console.log(tring, and the it has"Found instance: " + instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete: function () { }
});
});
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± String Ï€ÏÏÏ„Î± Î­Ï‡ÎµÎ¹ Î±Î½Î±Ï†ÎµÏÎ¸ÎµÎ¯ Î· ÎºÎ»Î¬ÏƒÎ· _java.lang.String_ ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î­Ï‡ÎµÎ¹ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î­Î½Î± _$new_ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÎºÎ»Î¬ÏƒÎ·Ï‚ Î¼Îµ Î¼Î¹Î± String Ï‰Ï‚ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿. Î‘Ï…Ï„Î® ÎµÎ¯Î½Î±Î¹ Î· ÏƒÏ‰ÏƒÏ„Î® Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± Î½Î­Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î¼Î¹Î±Ï‚ ÎºÎ»Î¬ÏƒÎ·Ï‚. Î‘Î»Î»Î¬, ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ·, Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Ï„Îµ Î±Ï€Î»Î¬ Î½Î± Ï€ÎµÏÎ¬ÏƒÎµÏ„Îµ ÏƒÏ„Î· `this.fun()` Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ String ÏŒÏ€Ï‰Ï‚: `this.fun("hey there!")`

### Python
```python
//loader.py
import frida
import time

device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1) #Without it Java.perform silently fails
session = device.attach(pid)
script = session.create_script(open("s2.js").read())
script.load()

#prevent the python script from terminating
raw_input()
```

```
python loader.py
```
## ÎœÎ­ÏÎ¿Ï‚ 3

### Python

Î¤ÏÏÎ± Î¸Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ ÎµÎ½Ï„Î¿Î»Î­Ï‚ ÏƒÏ„Î·Î½ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î· ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î¼Î­ÏƒÏ‰ Python Î³Î¹Î± Î½Î± ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·:
```python
//loader.py
import time
import frida

def my_message_handler(message, payload):
print message
print payload


device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1)  # Without it Java.perform silently fails
session = device.attach(pid)
with open("s3.js") as f:
script = session.create_script(f.read())
script.on("message", my_message_handler)
script.load()

command = ""
while 1 == 1:
command = raw_input("Enter command:\n1: Exit\n2: Call secret function\n3: Hook Secret\nchoice:")
if command == "1":
break
elif command == "2":
script.exports.callsecretfunction()
elif command == "3":
script.exports.hooksecretfunction()
```
Î— ÎµÎ½Ï„Î¿Î»Î® "**1**" Î¸Î± **Î­Î¾Î¿Î´Î¿**, Î· ÎµÎ½Ï„Î¿Î»Î® "**2**" Î¸Î± Î²ÏÎµÎ¹ ÎºÎ±Î¹ Î¸Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î¼Î¹Î± Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï„Î·Ï‚ ÎºÎ»Î¬ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î¸Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï„Î· Î¹Î´Î¹Ï‰Ï„Î¹ÎºÎ® ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·** _**secret()**_ ÎºÎ±Î¹ Î· ÎµÎ½Ï„Î¿Î»Î® "**3**" Î¸Î± **hook** Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· _**secret()**_ Î­Ï„ÏƒÎ¹ ÏÏƒÏ„Îµ Î½Î± **ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹** Î¼Î¹Î± **Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ® ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬**.

ÎˆÏ„ÏƒÎ¹, Î±Î½ ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ "**2**" Î¸Î± Ï€Î¬ÏÎµÏ„Îµ Ï„Î¿ **Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Î¼Ï…ÏƒÏ„Î¹ÎºÏŒ**, Î±Î»Î»Î¬ Î±Î½ ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ "**3**" ÎºÎ±Î¹ Î¼ÎµÏ„Î¬ "**2**" Î¸Î± Ï€Î¬ÏÎµÏ„Îµ Ï„Î¿ **ÏˆÎµÏÏ„Î¹ÎºÎ¿ Î¼Ï…ÏƒÏ„Î¹ÎºÏŒ**.

### JS
```javascript
console.log("Script loaded successfully ");
var instances_array = [];
function callSecretFun() {
Java.perform(function () {
if (instances_array.length == 0) { // if array is empty
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
console.log("Found instance: " + instance);
instances_array.push(instance)
console.log("Result of secret func: " + instance.secret());
},
onComplete: function () { }

});
}
else {//else if the array has some values
console.log("Result of secret func: " + instances_array[0].secret());
}

});
}

function hookSecret() {
Java.perform(function () {
var my_class = Java.use("com.example.a11x256.frida_test.my_activity");
var string_class = Java.use("java.lang.String");
my_class.secret.overload().implementation = function(){
var my_string = string_class.$new("TE ENGANNNNEEE");
return my_string;
}
});
}
rpc.exports = {
callsecretfunction: callSecretFun,
hooksecretfunction: hookSecret
};
```
## Part 4

Î•Î´Ï Î¸Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ **Python ÎºÎ±Î¹ JS Î½Î± Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¿ÏÎ½** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± JSON. Î— JS Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `send()` Î³Î¹Î± Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÏ„Î¿Î½ Ï€ÎµÎ»Î¬Ï„Î· Python, ÎºÎ±Î¹ Î· Python Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¹Ï‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ `post()` Î³Î¹Î± Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÏ„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ JS. Î— **JS Î¸Î± Î¼Ï€Î»Î¿ÎºÎ¬ÏÎµÎ¹ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·** Î¼Î­Ï‡ÏÎ¹ Î½Î± Î»Î¬Î²ÎµÎ¹ Î¼Î¹Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î±Ï€ÏŒ Ï„Î·Î½ Python.

### Python
```python
//loader.py
import time
import frida

def my_message_handler(message, payload):
print message
print payload
if message["type"] == "send":
print message["payload"]
data = message["payload"].split(":")[1].strip()
print 'message:', message
data = data.decode("base64")
user, pw = data.split(":")
data = ("admin" + ":" + pw).encode("base64")
print "encoded data:", data
script.post({"my_data": data})  # send JSON object
print "Modified data sent"


device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1)
session = device.attach(pid)
with open("s4.js") as f:
script = session.create_script(f.read())
script.on("message", my_message_handler)  # register the message handler
script.load()
raw_input()
```
### JS
```javascript
console.log("Script loaded successfully ");
Java.perform(function () {
var tv_class = Java.use("android.widget.TextView");
tv_class.setText.overload('java.lang.CharSequence').implementation = function (x) {
var string_to_send = x.toString();
var string_to_recv = "";
send(string_to_send); // send data to python code
recv(function (received_json_object) {
string_to_recv = received_json_object.my_data;
}).wait(); //block execution till the message is received
console.log("Final string_to_recv: "+ string_to_recv)
return this.setText(string_to_recv);
}
});
```
There is a part 5 that I am not going to explain because there isn't anything new. But if you want to read it is here: [https://11x256.github.io/Frida-hooking-android-part-5/](https://11x256.github.io/Frida-hooking-android-part-5/)

<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**Tip Î³Î¹Î± bug bounty**: **ÎµÎ³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ** ÏƒÏ„Î¿ **Intigriti**, Î¼Î¹Î± premium **Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î± bug bounty Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î±Ï€ÏŒ hackers, Î³Î¹Î± hackers**! Î•Î»Î¬Ï„Îµ Î¼Î±Î¶Î¯ Î¼Î±Ï‚ ÏƒÏ„Î¿ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ÏƒÎ®Î¼ÎµÏÎ±, ÎºÎ±Î¹ Î±ÏÏ‡Î¯ÏƒÏ„Îµ Î½Î± ÎºÎµÏÎ´Î¯Î¶ÎµÏ„Îµ Î²ÏÎ±Î²ÎµÎ¯Î± Î­Ï‰Ï‚ **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î»Î¬Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
