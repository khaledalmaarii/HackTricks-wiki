# Frida íŠœí† ë¦¬ì–¼ 2

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬**ì—ì„œ ì¼í•˜ì‹œë‚˜ìš”? **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”**? ë˜ëŠ” **PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•´ë³´ì„¸ìš”. ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **[hacktricks repo](https://github.com/carlospolop/hacktricks)ì™€ [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**ì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°êµë¥¼ ê³µìœ í•˜ì„¸ìš”.

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FwdlXOpyZOVGNzyhOiiFK%2Fimage%20(1).png?alt=media&#x26;token=13f4d279-7d3f-47ce-a68e-35f9a906973f" alt=""><figcaption></figcaption></figure>

**í•´í‚¹ ê²½ë ¥**ì— ê´€ì‹¬ì´ ìˆë‹¤ë©´, í•´í‚¹í•  ìˆ˜ ì—†ëŠ” ê²ƒì„ í•´í‚¹í•´ë³´ì„¸ìš” - **ì €í¬ê°€ ê³ ìš© ì¤‘ì…ë‹ˆë‹¤!** (_ìœ ì°½í•œ í´ë€ë“œì–´ í•„ìˆ˜_).

{% embed url="https://www.stmcyber.com/careers" %}



**ì´ ê¸€ì€ ë‹¤ìŒ ê¸€ì˜ ìš”ì•½ì…ë‹ˆë‹¤**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (íŒŒíŠ¸ 2, 3 ë° 4)\
**APK ë° ì†ŒìŠ¤ ì½”ë“œ**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

1ë¶€ëŠ” ì•„ì£¼ ì‰½ìŠµë‹ˆë‹¤.

**ì¼ë¶€ ì›ë³¸ ì½”ë“œëŠ” ì‘ë™í•˜ì§€ ì•Šê³  ì—¬ê¸°ì—ì„œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.**

## íŒŒíŠ¸ 2

ì—¬ê¸°ì—ì„œëŠ” **ë™ì¼í•œ ì´ë¦„ì„ ê°€ì§„ 2ê°œì˜ í•¨ìˆ˜ë¥¼ í›„í‚¹í•˜ëŠ” ì˜ˆì œ**ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë˜í•œ, **ìì²´ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë°©ë²•**ì„ ë°°ìš°ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.\
ë§ˆì§€ë§‰ìœ¼ë¡œ, **í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ê³  í•´ë‹¹ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ë§Œë“œëŠ” ì˜ˆì œ**ê°€ ìˆìŠµë‹ˆë‹¤.
```javascript
//s2.js
console.log("Script loaded successfully ");
Java.perform(function x() {
console.log("Inside java perform function");
var my_class = Java.use("com.example.a11x256.frida_test.my_activity");
//Hook "fun" with parameters (int, int)
my_class.fun.overload("int", "int").implementation = function (x, y) { //hooking the old function
console.log("original call: fun(" + x + ", " + y + ")");
var ret_value = this.fun(2, 5);
return ret_value;
};
//Hook "fun" with paramater(String)
var string_class = Java.use("java.lang.String");
my_class.fun.overload("java.lang.String").implementation = function (x) { //hooking the new function
console.log("*")
//Create a new String and call the function with your input.
var my_string = string_class.$new("My TeSt String#####");
console.log("Original arg: " + x);
var ret = this.fun(my_string);
console.log("Return value: " + ret);
console.log("*")
return ret;
};
//Find an instance of the class and call "secret" function.
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
console.log(tring, and the it has"Found instance: " + instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete: function () { }
});
});
```
ë‹¤ìŒì€ Stringì„ ìƒì„±í•˜ê¸° ìœ„í•´ ë¨¼ì € _java.lang.String_ í´ë˜ìŠ¤ë¥¼ ì°¸ì¡°í•˜ê³ , ê·¸ëŸ° ë‹¤ìŒ í•´ë‹¹ í´ë˜ìŠ¤ì˜ _$new_ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ë‚´ìš©ìœ¼ë¡œ Stringì„ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ í´ë˜ìŠ¤ì˜ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì˜¬ë°”ë¥¸ ë°©ë²•ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ê²½ìš°ì—ëŠ” `this.fun()`ì— "hey there!"ì™€ ê°™ì€ ì–´ë–¤ Stringì´ë“  ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Python
```python
//loader.py
import frida
import time

device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1) #Without it Java.perform silently fails
session = device.attach(pid)
script = session.create_script(open("s2.js").read())
script.load()

#prevent the python script from terminating
raw_input()
```

```
python loader.py
```
## íŒŒíŠ¸ 3

### íŒŒì´ì¬

ì´ì œ íŒŒì´ì¬ì„ ì‚¬ìš©í•˜ì—¬ í›„í‚¹ëœ ì•±ì— ëª…ë ¹ì„ ë³´ë‚´ì–´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤:
```python
//loader.py
import time
import frida

def my_message_handler(message, payload):
print message
print payload


device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1)  # Without it Java.perform silently fails
session = device.attach(pid)
with open("s3.js") as f:
script = session.create_script(f.read())
script.on("message", my_message_handler)
script.load()

command = ""
while 1 == 1:
command = raw_input("Enter command:\n1: Exit\n2: Call secret function\n3: Hook Secret\nchoice:")
if command == "1":
break
elif command == "2":
script.exports.callsecretfunction()
elif command == "3":
script.exports.hooksecretfunction()
```
ëª…ë ¹ì–´ "**1**"ì€ **ì¢…ë£Œ**í•˜ê³ , ëª…ë ¹ì–´ "**2**"ëŠ” í´ë˜ìŠ¤ì˜ **ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ì•„ì„œ ë¹„ê³µê°œ í•¨ìˆ˜ì¸ _**secret()**_ë¥¼ í˜¸ì¶œ**í•˜ë©°, ëª…ë ¹ì–´ "**3**"ì€ í•¨ìˆ˜ _**secret()**_ë¥¼ **í›„í‚¹**í•˜ì—¬ **ë‹¤ë¥¸ ë¬¸ìì—´ì„ ë°˜í™˜**í•˜ë„ë¡ í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ, "**2**"ë¥¼ í˜¸ì¶œí•˜ë©´ **ì§„ì§œ ë¹„ë°€**ì„ ì–»ì„ ìˆ˜ ìˆì§€ë§Œ, "**3**"ì„ í˜¸ì¶œí•œ í›„ "**2**"ë¥¼ í˜¸ì¶œí•˜ë©´ **ê°€ì§œ ë¹„ë°€**ì„ ì–»ê²Œ ë©ë‹ˆë‹¤.

### JS
```javascript
console.log("Script loaded successfully ");
var instances_array = [];
function callSecretFun() {
Java.perform(function () {
if (instances_array.length == 0) { // if array is empty
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
console.log("Found instance: " + instance);
instances_array.push(instance)
console.log("Result of secret func: " + instance.secret());
},
onComplete: function () { }

});
}
else {//else if the array has some values
console.log("Result of secret func: " + instances_array[0].secret());
}

});
}

function hookSecret() {
Java.perform(function () {
var my_class = Java.use("com.example.a11x256.frida_test.my_activity");
var string_class = Java.use("java.lang.String");
my_class.secret.overload().implementation = function(){
var my_string = string_class.$new("TE ENGANNNNEEE");
return my_string;
}
});
}
rpc.exports = {
callsecretfunction: callSecretFun,
hooksecretfunction: hookSecret
};
```
## íŒŒíŠ¸ 4

ì—¬ê¸°ì—ì„œëŠ” JSON ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ **Pythonê³¼ JSê°€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë°©ë²•**ì„ ì‚´í´ë³¼ ê²ƒì…ë‹ˆë‹¤. JSëŠ” `send()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ Python í´ë¼ì´ì–¸íŠ¸ë¡œ ë³´ë‚´ê³ , Pythonì€ `post()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ JS ìŠ¤í¬ë¦½íŠ¸ë¡œ ë³´ëƒ…ë‹ˆë‹¤. **JSëŠ” Pythonìœ¼ë¡œë¶€í„° ì‘ë‹µì„ ë°›ì„ ë•Œê¹Œì§€ ì‹¤í–‰ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤**.

### Python
```python
//loader.py
import time
import frida

def my_message_handler(message, payload):
print message
print payload
if message["type"] == "send":
print message["payload"]
data = message["payload"].split(":")[1].strip()
print 'message:', message
data = data.decode("base64")
user, pw = data.split(":")
data = ("admin" + ":" + pw).encode("base64")
print "encoded data:", data
script.post({"my_data": data})  # send JSON object
print "Modified data sent"


device = frida.get_usb_device()
pid = device.spawn(["com.example.a11x256.frida_test"])
device.resume(pid)
time.sleep(1)
session = device.attach(pid)
with open("s4.js") as f:
script = session.create_script(f.read())
script.on("message", my_message_handler)  # register the message handler
script.load()
raw_input()
```
### JS

JavaScript (JS)ëŠ” ì›¹ í˜ì´ì§€ë¥¼ ë™ì ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì…ë‹ˆë‹¤. JSëŠ” ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë˜ë©°, HTMLê³¼ CSSì™€ í•¨ê»˜ ì‚¬ìš©ë˜ì–´ ì›¹ í˜ì´ì§€ì˜ ë™ì‘ì„ ì œì–´í•˜ê³  ìƒí˜¸ì‘ìš©ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

JSëŠ” ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ë©°, ë³€ìˆ˜, í•¨ìˆ˜, ì¡°ê±´ë¬¸, ë°˜ë³µë¬¸ ë“±ì„ ì‚¬ìš©í•˜ì—¬ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, JSëŠ” ì´ë²¤íŠ¸ ì²˜ë¦¬, DOM ì¡°ì‘, AJAX ìš”ì²­ ë“±ê³¼ ê°™ì€ ì›¹ ê°œë°œì— í•„ìš”í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

FridaëŠ” JSë¥¼ ì‚¬ìš©í•˜ì—¬ ì•±ì˜ ë™ì‘ì„ ì¡°ì‘í•˜ê³  ë¶„ì„í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤. Fridaë¥¼ ì‚¬ìš©í•˜ë©´ ì•±ì˜ ì½”ë“œì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìœ¼ë©°, ì•±ì˜ ë™ì‘ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Fridaë¥¼ ì‚¬ìš©í•˜ì—¬ ì•±ì„ í•´í‚¹í•˜ë ¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¥´ë©´ ë©ë‹ˆë‹¤.

1. Fridaë¥¼ ì„¤ì¹˜í•˜ê³  ì„¤ì •í•©ë‹ˆë‹¤.
2. Frida ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ì•±ì— ì£¼ì…í•©ë‹ˆë‹¤.
3. ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì•±ì˜ ë™ì‘ì„ ì¡°ì‘í•˜ê³  ë¶„ì„í•©ë‹ˆë‹¤.

Fridaë¥¼ ì‚¬ìš©í•˜ë©´ ì•±ì˜ ì½”ë“œë¥¼ ë™ì ìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì•±ì˜ ë³´ì•ˆ ì·¨ì•½ì ì„ ì°¾ê³  ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ê¸°ìˆ ì€ í•©ë²•ì ì¸ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ì–´ì•¼ í•˜ë©°, ë¶ˆë²•ì ì¸ í™œë™ì—ëŠ” ì‚¬ìš©í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.
```javascript
console.log("Script loaded successfully ");
Java.perform(function () {
var tv_class = Java.use("android.widget.TextView");
tv_class.setText.overload('java.lang.CharSequence').implementation = function (x) {
var string_to_send = x.toString();
var string_to_recv = "";
send(string_to_send); // send data to python code
recv(function (received_json_object) {
string_to_recv = received_json_object.my_data;
}).wait(); //block execution till the message is received
console.log("Final string_to_recv: "+ string_to_recv)
return this.setText(string_to_recv);
}
});
```
5ë¶€ëŠ” ìƒˆë¡œìš´ ë‚´ìš©ì´ ì—†ìœ¼ë¯€ë¡œ ì„¤ëª…í•˜ì§€ ì•Šê² ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì½ê³  ì‹¶ë‹¤ë©´ ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://11x256.github.io/Frida-hooking-android-part-5/](https://11x256.github.io/Frida-hooking-android-part-5/)



<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FwdlXOpyZOVGNzyhOiiFK%2Fimage%20(1).png?alt=media&#x26;token=13f4d279-7d3f-47ce-a68e-35f9a906973f" alt=""><figcaption></figcaption></figure>

**í•´í‚¹ ê²½ë ¥**ì— ê´€ì‹¬ì´ ìˆë‹¤ë©´, í•´í‚¹í•  ìˆ˜ ì—†ëŠ” ê²ƒì„ í•´í‚¹í•˜ê³  ì‹¶ë‹¤ë©´ - **ì €í¬ê°€ ê³ ìš© ì¤‘ì…ë‹ˆë‹¤!** (_ìœ ì°½í•œ í´ë€ë“œì–´ ì‘ë¬¸ ë° êµ¬ì‚¬ ëŠ¥ë ¥ í•„ìš”_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬**ì—ì„œ ì¼í•˜ê³  ê³„ì‹ ê°€ìš”? **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”**? ë˜ëŠ” **PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•´ë³´ì„¸ìš”. ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ ì €ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **[hacktricks repo](https://github.com/carlospolop/hacktricks) ë° [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**ì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•´ì£¼ì„¸ìš”.

</details>
