# Samouczek Objection

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Wskaz贸wka dotyczca nagrody za bd**: **Zarejestruj si** na platformie **Intigriti**, premium **platformie nagr贸d za bdy stworzonej przez haker贸w, dla haker贸w**! Docz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ju偶 dzi i zacznij zarabia nagrody a偶 do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Wprowadzenie**

**Objection - Badanie uruchomieniowe aplikacji mobilnych**

[**Objection**](https://github.com/sensepost/objection) to narzdzie do badania uruchomieniowego aplikacji mobilnych, zasilane przez [Frida](https://www.frida.re). Zostao zbudowane w celu pomocy w ocenie aplikacji mobilnych i ich stanu bezpieczestwa bez koniecznoci posiadania zrootowanego urzdzenia mobilnego.

**Uwaga:** To nie jest forma ominicia jailbreaka / roota. Korzystajc z `objection`, nadal jeste ograniczony przez wszystkie restrykcje narzucone przez odpowiedni sandbox, z kt贸rym si zmagasz.

### Podsumowanie

Celem **objection** jest umo偶liwienie u偶ytkownikowi wywoania **g贸wnych akcji oferowanych przez Frid**. **W przeciwnym razie**, u偶ytkownik bdzie musia stworzy **pojedynczy skrypt dla ka偶dej aplikacji**, kt贸r chce przetestowa.

## Samouczek

W tym samouczku bd korzysta z pliku APK, kt贸ry mo偶esz pobra tutaj:

{% file src="../../../.gitbook/assets/app-release.zip" %}

Lub ze [oryginalnego repozytorium ](https://github.com/asvid/FridaApp)(pobierz app-release.apk)

### Instalacja
```bash
pip3 install objection
```
### Poczenie

Nawi偶 **zwyke poczenie ADB** i **uruchom** serwer **frida** na urzdzeniu (i sprawd藕, czy frida dziaa zar贸wno po stronie klienta, jak i serwera).

Jeli korzystasz z **zrootowanego urzdzenia**, konieczne jest wybranie aplikacji, kt贸r chcesz przetestowa w opcji _**--gadget**_. W tym przypadku:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Podstawowe czynnoci

Nie wszystkie mo偶liwe polecenia objections zostan wymienione w tym samouczku, tylko te, kt贸re uwa偶am za bardziej przydatne.

#### rodowisko

W rodowisku mo偶na znale藕 pewne interesujce informacje (takie jak hasa czy cie偶ki).
```bash
env
```
#### Informacje o Fridzie
```bash
frida
```
#### Przesyanie/Pobieranie
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importowanie skryptu frida
```bash
import <local path frida-script>
```
#### SSLPinning

#### SSLPinning
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Wykrywanie roota
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Wykonaj polecenie
```bash
android shell_exec whoami
```
#### Zrzuty ekranu
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Analiza statyczna staje si dynamiczna

W rzeczywistej aplikacji powinnimy zna wszystkie informacje odkryte w tej czci przed u偶yciem sprzeciwu dziki **analizie statycznej**. W ka偶dym razie w ten spos贸b mo偶esz zobaczy **co nowego**, poniewa偶 tutaj bdziesz mie tylko kompletn list klas, metod i obiekt贸w eksportowanych.

Jest to r贸wnie偶 przydatne, jeli w jaki spos贸b **nie mo偶esz uzyska czytelnego kodu 藕r贸dowego** aplikacji.

#### Wywietl list aktywnoci, odbiornik贸w i usug
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (1013).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida wywoa bd, jeli 偶aden nie zostanie znaleziony

#### Pobieranie bie偶cej aktywnoci
```bash
android hooking get current_activity
```
#### Wyszukiwanie klas

Zacznijmy szuka klas w naszej aplikacji
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (504).png>)

#### Metody wyszukiwania klasy

Teraz wyodrbnijmy metody wewntrz klasy _MainActivity:_
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (926).png>)

#### Lista zadeklarowanych metod klasy wraz z ich parametrami

Sprawd藕my, jakie parametry s wymagane przez metody klasy:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (296).png>)

#### Wywietlanie listy klas

Mo偶esz r贸wnie偶 wywietli wszystkie klasy zaadowane w bie偶cej aplikacji:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
To jest bardzo przydatne, jeli chcesz **przypi metod klasy i znasz tylko nazw klasy**. Mo偶esz u偶y tej funkcji do **znalezienia moduu, kt贸ry jest wacicielem klasy**, a nastpnie przypi jego metod.

### atwe przypinanie

#### Przypinanie (obserwowanie) metody

Z [kodu 藕r贸dowego](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) aplikacji wiemy, 偶e **funkcja** _**sum()**_ **z klasy** _**MainActivity**_ jest wywoywana **co sekund**. Spr贸bujmy **wypisa wszystkie mo偶liwe informacje** za ka偶dym razem, gdy funkcja jest wywoywana (argumenty, warto zwracana i lad wsteczny):
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (1083).png>)

#### Podpicie (obserwowanie) caej klasy

Faktycznie uwa偶am, 偶e wszystkie metody klasy MainActivity s naprawd interesujce, po prostu **podpimy je wszystkie**. Bd藕 ostro偶ny, to mo偶e spowodowa **zawieszenie** aplikacji.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Jeli grasz w aplikacj podczas podpicia klasy, zobaczysz, kiedy **ka偶da funkcja jest wywoywana**, jej **argumenty** i **warto zwracana**.

![](<../../../.gitbook/assets/image (858).png>)

#### Zmiana wartoci logicznej zwracanej przez funkcj

Z kodu 藕r贸dowego wida, 偶e funkcja _checkPin_ otrzymuje _String_ jako argument i zwraca _boolean_. Zmodyfikujmy funkcj tak, aby zawsze zwracaa **true**:

![](<../../../.gitbook/assets/image (880).png>)

Teraz, jeli wpiszesz cokolwiek w polu tekstowym dla kodu PIN, zobaczysz, 偶e wszystko jest uznawane za poprawne:

![](<../../../.gitbook/assets/image (225).png>)

### Instancje klasy

Wyszukaj i wydrukuj **aktywne instancje okrelonej klasy Java**, okrelonej pen nazw klasy. Wynik to pr贸ba uzyskania wartoci acuchowej dla odkrytego zarzutu, kt贸ry zazwyczaj **zawiera wartoci waciwoci obiektu**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (1092).png>)

### Keystore/Intents

Mo偶esz bawi si keystore i intents u偶ywajc:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
### Pami

#### Zrzut
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Lista
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (283).png>)

Na dole listy mo偶esz zobaczy frid:

![](<../../../.gitbook/assets/image (1094).png>)

Sprawd藕my, co eksportuje frida:

![](<../../../.gitbook/assets/image (295).png>)

#### Szukaj/Pisz

Mo偶esz r贸wnie偶 wyszukiwa i pisa w pamici za pomoc objection:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Mo偶esz u偶y polecenia `sqlite`, aby interaktywnie dziaa z bazami danych sqlite.

### Wyjcie
```bash
exit
```
## Czego mi brakuje w Objection

* Metody hakowania czasami powoduj awarie aplikacji (to tak偶e z powodu Fridy).
* Nie mo偶na u偶ywa instancji klas do wywoywania funkcji instancji. Nie mo偶na r贸wnie偶 tworzy nowych instancji klas i u偶ywa ich do wywoywania funkcji.
* Nie ma skr贸tu (podobnego do tego dla sslpinnin), aby hakowa wszystkie wsp贸lne metody kryptograficzne u偶ywane przez aplikacj, aby zobaczy zaszyfrowany tekst, tekst czysty, klucze, IV i u偶ywane algorytmy.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Wskaz贸wka dotyczca nagrody za bd**: **Zarejestruj si** na platformie **Intigriti**, premium **platformie do nagr贸d za bdy stworzonej przez haker贸w, dla haker贸w**! Docz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ju偶 dzi i zacznij zarabia nagrody do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**Grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
