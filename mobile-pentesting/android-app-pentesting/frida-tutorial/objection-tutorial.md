# Objection Tutorial

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty tip**: **prijavite se** za **Intigriti**, premium **bug bounty platformu koju su kreirali hakeri, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas, i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introduction**

**objection - Runtime Mobile Exploration**

[**Objection**](https://github.com/sensepost/objection) je alat za istraÅ¾ivanje mobilnih aplikacija u realnom vremenu, pokretan [Frida](https://www.frida.re). IzgraÄ‘en je s ciljem da pomogne u proceni mobilnih aplikacija i njihovog bezbednosnog stanja bez potrebe za jailbreak-ovanim ili root-ovanim mobilnim ureÄ‘ajem.

**Napomena:** Ovo nije neka vrsta jailbreak / root zaobilaÅ¾enja. KoriÅ¡Ä‡enjem `objection`, i dalje ste ograniÄeni svim ograniÄenjima koja nameÄ‡e odgovarajuÄ‡i sandbox s kojim se suoÄavate.

### Resume

**Cilj** **objection** je omoguÄ‡iti korisniku da pozove **glavne akcije koje nudi Frida**. **U suprotnom**, korisnik Ä‡e morati da kreira **jedan skript za svaku aplikaciju** koju Å¾eli da testira.

## Tutorial

Za ovaj tutorijal Ä‡u koristiti APK koji moÅ¾ete preuzeti ovde:

{% file src="../../../.gitbook/assets/app-release.zip" %}

Ili iz njegovog [originalnog repozitorijuma](https://github.com/asvid/FridaApp)(preuzmite app-release.apk)

### Installation
```bash
pip3 install objection
```
### Connection

Napravite **redovnu ADB konekciju** i **pokrenite** **frida** server na ureÄ‘aju (i proverite da li frida radi i na klijentu i na serveru).

Ako koristite **rootovani ureÄ‘aj**, potrebno je odabrati aplikaciju koju Å¾elite da testirate unutar _**--gadget**_ opcije. u ovom sluÄaju:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Osnovne Akcije

Nisu sve moguÄ‡e komande objekcija navedene u ovom tutorijalu, samo one koje sam smatrao korisnijim.

#### OkruÅ¾enje

Neke zanimljive informacije (kao Å¡to su lozinke ili putanje) mogu se naÄ‡i unutar okruÅ¾enja.
```bash
env
```
![](<../../../.gitbook/assets/image (220).png>)

#### Frida Informacije
```bash
frida
```
![](<../../../.gitbook/assets/image (1093).png>)

#### UÄitavanje/Preuzimanje
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Uvezi frida skript
```bash
import <local path frida-script>
```
#### SSLPinning
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Detekcija root-a
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Exec Command
```bash
android shell_exec whoami
```
#### Screenshots
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Staticka analiza postala dinamiÄka

U pravoj aplikaciji trebali bismo znati sve informacije otkrivene u ovom delu pre nego Å¡to koristimo objection zahvaljujuÄ‡i **statickoj analizi**. U svakom sluÄaju, na ovaj naÄin moÅ¾da moÅ¾ete videti **neÅ¡to novo** jer Ä‡ete ovde imati samo potpunu listu klasa, metoda i eksportovanih objekata.

Ovo je takoÄ‘e korisno ako nekako niste **u moguÄ‡nosti da dobijete neki Äitljiv izvorni kod** aplikacije.

#### Lista aktivnosti, prijemnika i servisa
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (1016).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida Ä‡e pokrenuti greÅ¡ku ako nijedna nije pronaÄ‘ena

#### Dobijanje trenutne aktivnosti
```bash
android hooking get current_activity
```
![](<../../../.gitbook/assets/image (813).png>)

#### PretraÅ¾i klase

Hajde da poÄnemo da traÅ¾imo klase unutar naÅ¡e aplikacije.
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (507).png>)

#### Metode pretrage klase

Sada hajde da izdvojimo metode unutar klase _MainActivity:_
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (929).png>)

#### Lista deklarisanih metoda klase sa njihovim parametrima

Hajde da otkrijemo koji parametri su potrebni metodama klase:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (299).png>)

#### Lista klasa

TakoÄ‘e moÅ¾ete nabrojati sve klase koje su uÄitane unutar trenutne aplikacije:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Ovo je veoma korisno ako Å¾elite da **hook-ujete metodu klase i samo znate ime klase**. MoÅ¾ete koristiti ovu funkciju da **pretraÅ¾ite koji modul poseduje klasu** i zatim hook-ujete njenu metodu.

### Hook-ovanje je lako

#### Hook-ovanje (posmatranje) metode

Iz [izvornog koda](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) aplikacije znamo da se **funkcija** _**sum()**_ **iz** _**MainActivity**_ izvrÅ¡ava **svake sekunde**. PokuÅ¡ajmo da **izvuÄemo sve moguÄ‡e informacije** svaki put kada se funkcija pozove (argumenti, povratna vrednost i backtrace):
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (1086).png>)

#### Hooking (posmatranje) cele klase

Zapravo, smatram da su sve metode klase MainActivity zaista zanimljive, hajde da **hook-ujemo sve**. Budite oprezni, ovo moÅ¾e **sruÅ¡iti** aplikaciju.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Ako igrate sa aplikacijom dok je klasa povezana, videÄ‡ete kada se **svaka funkcija poziva**, njene **argumente** i **vraÄ‡enu** vrednost.

![](<../../../.gitbook/assets/image (861).png>)

#### Promena boolean vraÄ‡ene vrednosti funkcije

Iz izvornog koda moÅ¾ete videti da funkcija _checkPin_ prima _String_ kao argument i vraÄ‡a _boolean_. Hajde da funkcija **uvek vraÄ‡a true**:

![](<../../../.gitbook/assets/image (883).png>)

Sada, ako napiÅ¡ete bilo Å¡ta u tekstualno polje za PIN kod, videÄ‡ete da je bilo Å¡ta vaÅ¾eÄ‡e:

![](<../../../.gitbook/assets/image (228).png>)

### Instance klasa

PretraÅ¾ite i odÅ¡tampajte **Å¾ive instance specifiÄne Java klase**, navedene punim imenom klase. Rezultat je pokuÅ¡aj dobijanja string vrednosti za otkrivenu primedbu koja bi obiÄno **sadrÅ¾ala vrednosti svojstava za objekat**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (1095).png>)

### Keystore/Intents

MoÅ¾ete se igrati sa keystore-om i intencijama koristeÄ‡i:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
### Memorija

#### Ispis
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Lista
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (286).png>)

Na dnu liste moÅ¾ete videti frida:

![](<../../../.gitbook/assets/image (1097).png>)

Hajde da proverimo Å¡ta frida izvozi:

![](<../../../.gitbook/assets/image (298).png>)

#### PretraÅ¾i/PiÅ¡i

TakoÄ‘e moÅ¾ete pretraÅ¾ivati i pisati unutar memorije sa objection:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

MoÅ¾ete koristiti komandu `sqlite` za interakciju sa sqlite bazama podataka.

### Exit
```bash
exit
```
## Å ta mi nedostaje u Objection

* Metode za hooking ponekad sruÅ¡e aplikaciju (to je takoÄ‘e zbog Frida).
* Ne moÅ¾ete koristiti instance klasa za pozivanje funkcija instance. I ne moÅ¾ete kreirati nove instance klasa i koristiti ih za pozivanje funkcija.
* Ne postoji preÄica (poput one za sslpinnin) za hooking svih uobiÄajenih kripto metoda koje koristi aplikacija da biste videli Å¡ifrovani tekst, obiÄan tekst, kljuÄeve, IV-ove i koriÅ¡Ä‡ene algoritme.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty saveta**: **prijavite se** za **Intigriti**, premium **bug bounty platformu koju su kreirali hakeri, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas, i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
