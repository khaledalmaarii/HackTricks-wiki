# Objection Tutorijal

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini da podrÅ¾ite HackTricks:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty savet**: **registrujte se** za **Intigriti**, premium **platformu za bug bounty kreiranu od strane hakera, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Uvod**

**objection - Runtime Mobile Exploration**

**[Objection](https://github.com/sensepost/objection)** je alat za istraÅ¾ivanje mobilnih aplikacija u toku izvrÅ¡avanja, pokretan od strane [Frida](https://www.frida.re). Napravljen je sa ciljem da pomogne u proceni mobilnih aplikacija i njihovoj bezbednosti, bez potrebe za jailbroken ili root-ovanim mobilnim ureÄ‘ajem.

**Napomena:** Ovo nije neka vrsta jailbreak / root zaobilaÅ¾enja. KoriÅ¡Ä‡enjem `objection`, i dalje ste ograniÄeni svim restrikcijama koje nameÄ‡e odgovarajuÄ‡i sandbox sa kojim se suoÄavate.

### Rezime

**Cilj** objekcije je omoguÄ‡iti korisniku da pozove **glavne akcije koje nudi Frida**. **InaÄe**, korisnik Ä‡e morati da napravi **jedan skript za svaku aplikaciju** koju Å¾eli da testira.

## Tutorijal

Za ovaj tutorijal Ä‡u koristiti APK koji moÅ¾ete preuzeti ovde:

{% file src="../../../.gitbook/assets/app-release.zip" %}

Ili sa njegovog [originalnog repozitorijuma](https://github.com/asvid/FridaApp)(preuzmite app-release.apk)

### Instalacija
```bash
pip3 install objection
```
### Povezivanje

Napravite **obiÄnu ADB konekciju** i **pokrenite** Frida server na ureÄ‘aju (i proverite da li Frida radi i na klijentu i na serveru).

Ako koristite **rootovani ureÄ‘aj**, potrebno je odabrati aplikaciju koju Å¾elite testirati unutar opcije _**--gadget**_. U ovom sluÄaju:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Osnovne radnje

NeÄ‡e biti navedene sve moguÄ‡e komande objections u ovom tutorijalu, samo one koje sam smatrao korisnima.

#### OkruÅ¾enje

Neki zanimljivi podaci (poput lozinki ili putanja) mogu se pronaÄ‡i unutar okruÅ¾enja.
```bash
env
```
![](<../../../.gitbook/assets/image (64).png>)

#### Informacije o Fridi

Frida je open-source alat koji omoguÄ‡ava dinamiÄko analiziranje i manipulaciju aplikacija na Android platformi. Koristi se za pentestiranje mobilnih aplikacija i otkrivanje ranjivosti. Frida pruÅ¾a moguÄ‡nost da se prati i modifikuje izvrÅ¡avanje koda u realnom vremenu, omoguÄ‡avajuÄ‡i istraÅ¾ivaÄima da analiziraju i testiraju aplikacije na dubljem nivou.

Frida se sastoji od dva dela: Frida Server i Frida Client. Frida Server se instalira na ciljanom ureÄ‘aju, dok se Frida Client koristi na napadaÄevom raÄunaru. Frida Client se koristi za komunikaciju sa Frida Serverom i izvrÅ¡avanje razliÄitih komandi.

Da biste koristili Fridu, potrebno je da imate root pristup na ciljanom ureÄ‘aju ili da koristite ureÄ‘aj sa Android verzijom 5.0 ili novijom, gde je podrÅ¾ana funkcionalnost "debuggable".

Frida pruÅ¾a mnoge korisne funkcionalnosti za analizu i manipulaciju aplikacija, kao Å¡to su:

- Interception: OmoguÄ‡ava praÄ‡enje i modifikaciju poziva funkcija u aplikaciji.
- Enumeration: PruÅ¾a informacije o instaliranim aplikacijama, procesima, servisima, aktivnostima i drugim komponentama.
- Injection: OmoguÄ‡ava ubacivanje koda u aplikaciju kako bi se izvrÅ¡ile odreÄ‘ene akcije.
- Scripting: OmoguÄ‡ava pisanje skripti za automatizaciju odreÄ‘enih zadataka.
- SSL Pinning Bypass: OmoguÄ‡ava zaobilaÅ¾enje SSL povezivanja kako bi se analizirao saobraÄ‡aj izmeÄ‘u aplikacije i servera.

Frida je veoma moÄ‡an alat za analizu i testiranje Android aplikacija. Kombinovanje Frida sa drugim alatima i tehnikama moÅ¾e pruÅ¾iti dublji uvid u bezbednost aplikacija i otkrivanje ranjivosti koje bi mogle biti iskoriÅ¡Ä‡ene.
```bash
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### UÄitavanje/Preuzimanje
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Uvoz frida skripte

```javascript
const script = await Session.createScript(`
// Frida script code here
`);
```

#### Load frida script into the application

```javascript
await script.load();
```

#### Hook a function with frida script

```javascript
await script.exports.functionName();
```

#### Unload frida script from the application

```javascript
await script.unload();
```

#### Importuj frida skriptu

```javascript
const script = await Session.createScript(`
// Frida kod skripte ovde
`);
```

#### UÄitaj frida skriptu u aplikaciju

```javascript
await script.load();
```

#### Hook-uj funkciju sa frida skriptom

```javascript
await script.exports.functionName();
```

#### IskljuÄi frida skriptu iz aplikacije

```javascript
await script.unload();
```
```bash
import <local path frida-script>
```
#### SSLPinning

SSLPinning je tehnika koja se koristi u Android aplikacijama kako bi se osiguralo da se komunikacija izmeÄ‘u aplikacije i servera odvija samo preko validnog SSL sertifikata. Ova tehnika spreÄava napadaÄe da presretnu ili modifikuju podatke koji se prenose izmeÄ‘u aplikacije i servera.

Kada se koristi SSLPinning, aplikacija proverava da li SSL sertifikat koji je izdat od strane servera odgovara oÄekivanom sertifikatu. Ako se sertifikati ne podudaraju, aplikacija prekida komunikaciju sa serverom.

NapadaÄi mogu pokuÅ¡ati da zaobiÄ‘u SSLPinning kako bi presreli ili modifikovali podatke. Jedan od naÄina za to je koriÅ¡Ä‡enje alata kao Å¡to je Frida i Objection. Ovi alati omoguÄ‡avaju hakerima da izvrÅ¡e "hooking" funkcija u aplikaciji i promene njen ponaÅ¡anje.

Da biste zaobiÅ¡li SSLPinning pomoÄ‡u Objection alata, moÅ¾ete koristiti komandu `android sslpinning disable`. Ova komanda Ä‡e onemoguÄ‡iti SSLPinning u aplikaciji, omoguÄ‡avajuÄ‡i vam da presretnete i modifikujete podatke koji se prenose izmeÄ‘u aplikacije i servera.

VaÅ¾no je napomenuti da je zaobiÄ‘anje SSLPinninga nezakonito i moÅ¾e imati ozbiljne pravne posledice. Ove tehnike treba koristiti samo u okviru zakonitog pentestinga ili u svrhu obrazovanja.
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Otkrivanje root pristupa

Root pristup na Android ureÄ‘aju omoguÄ‡ava korisniku da ima potpunu kontrolu nad operativnim sistemom. MeÄ‘utim, u nekim sluÄajevima, aplikacije mogu pokuÅ¡ati da otkriju da li je ureÄ‘aj rootovan kako bi spreÄile njihovo izvrÅ¡avanje na takvim ureÄ‘ajima. Ovo se Äesto radi iz sigurnosnih razloga, jer root pristup moÅ¾e predstavljati potencijalnu pretnju za aplikaciju.

Da bi se otkrilo da li je ureÄ‘aj rootovan, aplikacije mogu koristiti razliÄite tehnike. Neki od najÄeÅ¡Ä‡ih naÄina su:

- Provera postojanja poznatih fajlova ili direktorijuma koji su karakteristiÄni za root pristup.
- Provera postojanja poznatih binarnih fajlova koji se koriste za root pristup.
- Provera postojanja privilegovanih komandi koje su dostupne samo sa root pristupom.
- Provera postojanja privilegovanih sistemskih propertija koji su karakteristiÄni za root pristup.

Da biste zaobiÅ¡li ove tehnike otkrivanja root pristupa, moÅ¾ete koristiti alate kao Å¡to je Magisk Hide ili Xposed Framework. Ovi alati omoguÄ‡avaju sakrivanje root pristupa od aplikacija koje pokuÅ¡avaju da ga otkriju.

TakoÄ‘e, moÅ¾ete koristiti alate kao Å¡to je Frida ili Objection kako biste izmenili ili zaobisli kod koji se koristi za otkrivanje root pristupa. Ovi alati omoguÄ‡avaju dinamiÄku analizu aplikacija i manipulaciju njihovim izvrÅ¡nim kodom.
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### IzvrÅ¡avanje komande

The `exec` command in Objection allows you to execute shell commands on the target Android device. This can be useful for various purposes, such as exploring the device's file system, running additional tools, or performing actions that require shell access.

To use the `exec` command, you need to specify the command you want to execute as an argument. For example, to list the files in the current directory, you can use the following command:

```
objection> exec ls
```

The output of the command will be displayed in the Objection console. You can also redirect the output to a file by using the `>` operator. For example, to save the output of the `ls` command to a file named `files.txt`, you can use the following command:

```
objection> exec ls > files.txt
```

Keep in mind that the `exec` command runs the specified command as the user running the target application. Therefore, the available commands and their outputs may vary depending on the permissions and restrictions of the application.

It's important to use the `exec` command responsibly and only execute commands that you have permission to run. Unauthorized execution of commands can lead to unintended consequences and may be illegal. Always ensure that you have proper authorization and follow ethical guidelines when performing any actions on a target device.
```bash
android shell_exec whoami
```
#### Snimci ekrana
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### StatiÄka analiza postaje DinamiÄka

U stvarnoj aplikaciji trebali bismo znati sve informacije otkrivene u ovom dijelu prije koriÅ¡tenja objekcije zahvaljujuÄ‡i **statiÄkoj analizi**. U svakom sluÄaju, na ovaj naÄin moÅ¾da moÅ¾ete vidjeti **neÅ¡to novo**, jer Ä‡ete ovdje imati samo potpuni popis klasa, metoda i izvezenih objekata.

Ovo je takoÄ‘er korisno ako iz nekog razloga **ne moÅ¾ete dobiti Äitljiv izvorni kod** aplikacije.

#### Popis aktivnosti, prijemnika i usluga
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida Ä‡e prikazati greÅ¡ku ako ne pronaÄ‘e nijednu.

#### Dobijanje trenutne aktivnosti
```bash
android hooking get current_activity
```
![](<../../../.gitbook/assets/image (73) (1).png>)

#### Pretraga klasa

Hajde da poÄnemo sa traÅ¾enjem klasa unutar naÅ¡e aplikacije
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### Pretraga metoda u klasi

Sada Ä‡emo izvuÄ‡i metode unutar klase _MainActivity:_
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### Lista deklarisanih metoda klase sa njihovim parametrima

Hajde da saznamo koje parametre metode klase zahtevaju:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### Lista klasa

TakoÄ‘e moÅ¾ete izlistati sve klase koje su uÄitane unutar trenutne aplikacije:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Ovo je veoma korisno ako Å¾elite da **poveÅ¾ete metodu klase, a znate samo ime klase**. MoÅ¾ete koristiti ovu funkciju da **pretraÅ¾ite koja modul poseduje klasu** i zatim poveÅ¾ete njenu metodu.

### Povezivanje je jednostavno

#### Povezivanje (praÄ‡enje) metode

Iz [izvornog koda](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) aplikacije znamo da se **funkcija** _**sum()**_ **iz klase** _**MainActivity**_ izvrÅ¡ava **svaku sekundu**. Hajde da pokuÅ¡amo da **izbacimo sve moguÄ‡e informacije** svaki put kada se funkcija pozove (argumente, povratnu vrednost i trag izvrÅ¡avanja):
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### Hookovanje (praÄ‡enje) cele klase

Zapravo, smatram da su svi metodi klase MainActivity veoma interesantni, hajde da ih **hookujemo sve**. Budite oprezni, ovo moÅ¾e **pokrenuti pad** aplikacije.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Ako igrate sa aplikacijom dok je klasa povezana, videÄ‡ete kada se poziva **svaka funkcija**, njene **argumente** i **vrednost povratka**.

![](<../../../.gitbook/assets/image (72).png>)

#### Menjanje boolean vrednosti funkcije

Iz izvornog koda moÅ¾ete videti da funkcija _checkPin_ prima _String_ kao argument i vraÄ‡a _boolean_. Hajde da funkcija **uvek vraÄ‡a true**:

![](<../../../.gitbook/assets/image (74).png>)

Sada, ako unesete bilo Å¡ta u polje za unos PIN koda, videÄ‡ete da je sve validno:

![](<../../../.gitbook/assets/image (77).png>)

### Instance klase

PretraÅ¾ite i ispiÅ¡ite **aktivne instance odreÄ‘ene Java klase**, koje su navedene pomoÄ‡u potpunog imena klase. Rezultat je pokuÅ¡aj dobijanja string vrednosti za otkrivenu primedbu koja obiÄno **sadrÅ¾i vrednosti svojstava objekta**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

MoÅ¾ete se igrati sa keystore-om i intentima koristeÄ‡i:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
#### Memorija

#### Dumpovanje
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Lista
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

Na dnu liste moÅ¾ete videti fridu:

![](<../../../.gitbook/assets/image (67).png>)

Pogledajmo Å¡ta frida izvozi:

![](<../../../.gitbook/assets/image (68).png>)

#### Pretraga/Pisanje

TakoÄ‘e moÅ¾ete pretraÅ¾ivati i pisati unutar memorije pomoÄ‡u objection-a:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

MoÅ¾ete koristiti komandu `sqlite` za interakciju sa SQLite bazama podataka.

### Izlaz
```bash
exit
```
## Å ta mi nedostaje u Objection-u

* Metode za hakovanje ponekad ruÅ¡e aplikaciju (ovo je takoÄ‘e zbog Frida-e).
* Ne moÅ¾ete koristiti instance klasa da biste pozvali funkcije instance. I ne moÅ¾ete kreirati nove instance klasa i koristiti ih za pozivanje funkcija.
* Ne postoji preÄica (poput one za sslpinnin) za hakovanje svih uobiÄajenih kripto metoda koje koristi aplikacija kako biste videli Å¡ifrovani tekst, obiÄan tekst, kljuÄeve, IV-ove i koriÅ¡Ä‡ene algoritme.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Savet za bug bounty**: **Prijavite se** za **Intigriti**, premium **platformu za bug bounty kreiranu od strane hakera, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje trikove hakovanja slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
