# Samouczek Objection

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Wskaz贸wka dotyczca bug bounty**: **zarejestruj si** na platformie **Intigriti**, premium **platformie bug bounty stworzonej przez haker贸w, dla haker贸w**! Docz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ju偶 dzi i zacznij zarabia nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Wprowadzenie**

**Objection - Eksploracja uruchomieniowa na urzdzeniach mobilnych**

**[Objection](https://github.com/sensepost/objection)** to narzdzie do eksploracji uruchomieniowej na urzdzeniach mobilnych, oparte na [Frida](https://www.frida.re). Zostao stworzone w celu pomocy w ocenie aplikacji mobilnych i ich bezpieczestwa bez koniecznoci posiadania urzdzenia mobilnego z jailbreakiem lub rootem.

**Uwaga:** To nie jest forma omijania jailbreaka / roota. Korzystajc z `objection`, nadal jeste ograniczony przez wszystkie ograniczenia narzucane przez odpowiedni sandbox, z kt贸rym si spotykasz.

### Podsumowanie

**Celem** narzdzia **objection** jest umo偶liwienie u偶ytkownikowi wywoywania **g贸wnych akcji oferowanych przez Frid**. W przeciwnym razie u偶ytkownik bdzie musia stworzy **pojedynczy skrypt dla ka偶dej aplikacji**, kt贸r chce przetestowa.

## Samouczek

W tym samouczku bd korzysta z pliku APK, kt贸ry mo偶na pobra tutaj:

{% file src="../../../.gitbook/assets/app-release.zip" %}

Lub z [oryginalnego repozytorium](https://github.com/asvid/FridaApp)(pobierz app-release.apk)

### Instalacja
```bash
pip3 install objection
```
### Poczenie

Nawi偶 **zwyke poczenie ADB** i **uruchom** serwer frida na urzdzeniu (i sprawd藕, czy frida dziaa zar贸wno po stronie klienta, jak i serwera).

Jeli u偶ywasz **urzdzenia z rootem**, konieczne jest wybranie aplikacji, kt贸r chcesz przetestowa w opcji _**--gadget**_. W tym przypadku:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Podstawowe dziaania

W tym samouczku nie bd wymienione wszystkie mo偶liwe polecenia objections, tylko te, kt贸re uwa偶am za bardziej przydatne.

#### rodowisko

W rodowisku mo偶na znale藕 interesujce informacje (takie jak hasa czy cie偶ki).
```bash
env
```
![](<../../../.gitbook/assets/image (64).png>)

#### Informacje o Fridzie

Frida to pot偶ne narzdzie do dynamicznej analizy i manipulacji aplikacji mobilnych. Dziaa na r贸偶nych platformach, w tym na systemie Android. Frida umo偶liwia interakcj z aplikacj w czasie rzeczywistym, co pozwala na monitorowanie i modyfikacj jej dziaania.

#### Objection

Objection to rozszerzenie Fridy, kt贸re dostarcza zestaw narzdzi do testowania penetracyjnego aplikacji mobilnych na platformie Android. Objection uatwia analiz aplikacji, identyfikacj podatnoci i manipulacj zasobami aplikacji.

#### Instalacja

Aby zainstalowa Objection, wykonaj nastpujce kroki:

1. Zainstaluj Frid, wykonujc polecenie `pip install frida-tools`.
2. Zainstaluj Objection, wykonujc polecenie `pip install objection`.

#### Uruchamianie Objection

Aby uruchomi Objection, wykonaj polecenie `objection`. Po uruchomieniu zostanie wywietlone interaktywne rodowisko Objection, w kt贸rym mo偶na wykonywa r贸偶ne operacje.

#### Podstawowe funkcje Objection

Objection oferuje wiele przydatnych funkcji, takich jak:

- **Device**: Pozwala na interakcj z urzdzeniem mobilnym, na kt贸rym dziaa aplikacja.
- **App**: Umo偶liwia manipulacj aplikacj, tak jak uruchamianie, zatrzymywanie, przeadowywanie itp.
- **Explore**: Pozwala na eksploracj struktury aplikacji i identyfikacj podatnoci.
- **Interact**: Umo偶liwia interakcj z aplikacj w czasie rzeczywistym, tak jak wywoywanie metod, modyfikowanie zmiennych itp.
- **Inject**: Pozwala na wstrzykiwanie kodu do aplikacji w celu manipulacji jej dziaaniem.
- **Watch**: Umo偶liwia monitorowanie zdarze w aplikacji, takich jak wywoania metod, zmienne itp.

#### Podsumowanie

Objection to pot偶ne narzdzie, kt贸re w poczeniu z Frid umo偶liwia penetracj aplikacji mobilnych na platformie Android. Dziki Objection mo偶na analizowa aplikacje, identyfikowa podatnoci i manipulowa ich dziaaniem w czasie rzeczywistym.
```bash
frida
```
![](<../../../.gitbook/assets/image (65).png>)

#### Przesyanie/Pobieranie
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importuj skrypt frida

```javascript
const script = await Session.createScript(`
// Your script code here
`);
```

#### Load frida script into the target app

```javascript
await script.load();
```

#### Hook a function in the target app

```javascript
await script.exports.functionName();
```

#### Interact with the target app

```javascript
await script.exports.functionName(parameter);
```

#### Unload frida script from the target app

```javascript
await script.unload();
```

#### Detach from the target app

```javascript
await session.detach();
```
```bash
import <local path frida-script>
```
#### SSLPinning

SSLPinning to mechanizm bezpieczestwa, kt贸ry chroni aplikacje mobilne przed atakami typu Man-in-the-Middle (MitM). Polega na sprawdzaniu i weryfikacji certyfikat贸w SSL podczas nawizywania poczenia z serwerem. 

W przypadku ataku MitM, gdzie atakujcy przechwytuje i podszywa si pod komunikacj midzy aplikacj a serwerem, SSLPinning uniemo偶liwia atakujcemu podszywanie si pod serwer poprzez sprawdzenie, czy certyfikat SSL serwera jest poprawny i zaufany.

Obiekt `objection` oferuje narzdzia do obejcia mechanizmu SSLPinning w aplikacjach mobilnych. Dziki temu mo偶emy analizowa i testowa aplikacje podatne na ataki MitM.
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Wykrywanie roota

Root detection, also known as root checking, is a technique used to determine whether a mobile device has been rooted or not. Rooting a device gives the user administrative privileges, allowing them to access and modify system files and settings that are typically restricted. 

Wykrywanie roota, znane r贸wnie偶 jako sprawdzanie roota, to technika u偶ywana do okrelenia, czy urzdzenie mobilne zostao zrootowane czy nie. Zrootowanie urzdzenia daje u偶ytkownikowi uprawnienia administratora, umo偶liwiajc mu dostp i modyfikacj plik贸w i ustawie systemowych, kt贸re zwykle s ograniczone. 

Mobile app developers often implement root detection mechanisms in their applications to prevent them from running on rooted devices. This is done to protect the app's integrity and prevent potential security risks that may arise from running on a rooted device. 

Tw贸rcy aplikacji mobilnych czsto implementuj mechanizmy wykrywania roota w swoich aplikacjach, aby uniemo偶liwi ich uruchamianie na zrootowanych urzdzeniach. Robi to w celu ochrony integralnoci aplikacji i zapobiegania potencjalnym zagro偶eniom dla bezpieczestwa, kt贸re mog wynika z uruchamiania na zrootowanym urzdzeniu. 

Root detection techniques can vary, but they often involve checking for the presence of certain files or binaries that are commonly associated with rooting. Some apps may also use more advanced techniques, such as checking for the presence of specific system properties or using native code to perform root checks. 

Techniki wykrywania roota mog si r贸偶ni, ale czsto polegaj na sprawdzaniu obecnoci okrelonych plik贸w lub binarnych, kt贸re s powszechnie zwizane z rootowaniem. Niekt贸re aplikacje mog r贸wnie偶 u偶ywa bardziej zaawansowanych technik, takich jak sprawdzanie obecnoci okrelonych waciwoci systemowych lub korzystanie z kodu natywnego do wykonywania sprawdzania roota. 

As a mobile penetration tester, it is important to understand and bypass root detection mechanisms in order to assess the security of an application on rooted devices. This can be done using various techniques, such as modifying the app's code or using tools like Frida or Objection to dynamically analyze and manipulate the app's behavior. 

Jako tester penetracji mobilnej wa偶ne jest zrozumienie i obejcie mechanizm贸w wykrywania roota w celu oceny bezpieczestwa aplikacji na zrootowanych urzdzeniach. Mo偶na to zrobi za pomoc r贸偶nych technik, takich jak modyfikowanie kodu aplikacji lub korzystanie z narzdzi takich jak Frida lub Objection do dynamicznej analizy i manipulacji zachowaniem aplikacji.
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Wykonaj polecenie

The `exec` command in objection allows you to execute shell commands on the target Android device. This can be useful for various purposes during a mobile penetration test.

To use the `exec` command, you need to specify the command you want to execute as an argument. For example, to execute the `ls` command to list the files in the current directory, you can use the following syntax:

```
objection> exec ls
```

The output of the command will be displayed in the console.

Keep in mind that the `exec` command runs the specified command on the target device, so be cautious when executing potentially harmful commands.
```bash
android shell_exec whoami
```
#### Zrzuty ekranu
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Analiza statyczna staje si dynamiczna

W rzeczywistej aplikacji powinnimy zna wszystkie informacje odkryte w tej czci przed u偶yciem objection dziki **analizie statycznej**. W ka偶dym razie, w ten spos贸b mo偶e by mo偶liwe zobaczenie **czego nowego**, poniewa偶 tutaj bdziesz mie tylko pen list klas, metod i obiekt贸w eksportowanych.

Jest to r贸wnie偶 przydatne, jeli w jaki spos贸b jeste **niezdolny do uzyskania czytelnego kodu 藕r贸dowego** aplikacji.

#### Wywietl list aktywnoci, odbiornik贸w i usug
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (78).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida wywoa bd, jeli nie zostanie znaleziona 偶adna.

#### Pobieranie bie偶cej aktywnoci
```bash
android hooking get current_activity
```
#### Wyszukiwanie klas

Zacznijmy od szukania klas w naszej aplikacji.
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### Metody wyszukiwania klasy

Teraz wyodrbnijmy metody wewntrz klasy _MainActivity:_
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### Wywietlanie zadeklarowanych metod klasy wraz z ich parametrami

Sprawd藕my, jakie parametry s potrzebne do metod klasy:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### Wywietlanie listy klas

Mo偶esz r贸wnie偶 wywietli list wszystkich klas, kt贸re zostay zaadowane w bie偶cej aplikacji:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
To jest bardzo przydatne, jeli chcesz **podpi metod klasy i znasz tylko nazw klasy**. Mo偶esz u偶y tej funkcji, aby **znale藕 modu, do kt贸rego nale偶y klasa**, a nastpnie podpi jego metod.

### Podpicie jest proste

#### Podpicie (obserwowanie) metody

Z [kodu 藕r贸dowego](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) aplikacji wiemy, 偶e **funkcja** _**sum()**_ **z klasy** _**MainActivity**_ jest uruchamiana **co sekund**. Spr贸bujmy **zrzuci wszystkie mo偶liwe informacje** za ka偶dym razem, gdy funkcja jest wywoywana (argumenty, warto zwracana i lad wsteczny):
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### Hookowanie (obserwowanie) caej klasy

Waciwie uwa偶am, 偶e wszystkie metody klasy MainActivity s naprawd interesujce, wic **zahookujmy je wszystkie**. Bd藕 ostro偶ny, mo偶e to **spowodowa awari** aplikacji.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Jeli grasz z aplikacj podczas gdy klasa jest podpita, zobaczysz kiedy **ka偶da funkcja jest wywoywana**, jej **argumenty** i **warto zwracana**.

![](<../../../.gitbook/assets/image (72).png>)

#### Zmiana wartoci logicznej zwracanej przez funkcj

Z kodu 藕r贸dowego mo偶na zobaczy, 偶e funkcja _checkPin_ otrzymuje argument typu _String_ i zwraca warto logiczn. Zmiemy funkcj tak, aby **zawsze zwracaa true**:

![](<../../../.gitbook/assets/image (74).png>)

Teraz, jeli wpiszesz cokolwiek w polu tekstowym dla kodu PIN, zobaczysz, 偶e wszystko jest poprawne:

![](<../../../.gitbook/assets/image (77).png>)

### Instancje klasy

Wyszukaj i wywietl **aktywne instancje okrelonej klasy Java**, okrelonej przez pen nazw klasy. Wynik to pr贸ba uzyskania wartoci acuchowej dla odkrytego zarzutu, kt贸ry zwykle **zawiera wartoci waciwoci obiektu**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

Mo偶esz bawi si keystore i intents u偶ywajc:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
#### Zrzut pamici

##### Opis

Zrzut pamici to proces pozyskiwania zawartoci pamici urzdzenia mobilnego w celu analizy. Pozwala to na odkrycie poufnych informacji, takich jak klucze szyfrowania, tokeny uwierzytelniajce, dane u偶ytkownika itp.

##### Wykorzystanie

Aby wykona zrzut pamici, mo偶emy skorzysta z narzdzia Objection. Oto przykadowe polecenie:

```bash
objection -g <nazwa_aplikacji> explore
```

Gdzie `<nazwa_aplikacji>` to nazwa aplikacji, kt贸rej chcemy dokona zrzutu pamici.

##### Wynik

Po wykonaniu polecenia, Objection utworzy plik zrzutu pamici w formacie `.dmp`. Mo偶emy nastpnie przeglda ten plik przy u偶yciu narzdzi do analizy pamici, takich jak Volatility.

##### Uwaga

Zrzut pamici mo偶e by nielegalny lub narusza prywatno, jeli jest wykonywany na urzdzeniu bez zgody waciciela. Zawsze pamitaj o przestrzeganiu prawa i etyki podczas wykonywania zrzut贸w pamici.
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Lista
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

Na dole listy mo偶esz zobaczy frid:

![](<../../../.gitbook/assets/image (67).png>)

Sprawd藕my, co frida eksportuje:

![](<../../../.gitbook/assets/image (68).png>)

#### Wyszukiwanie/Zapisywanie

Mo偶esz r贸wnie偶 wyszukiwa i zapisywa w pamici za pomoc objection:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Mo偶ecie u偶y polecenia `sqlite` do interakcji z bazami danych SQLite.

### Wyjcie
```bash
exit
```
## Czego mi brakuje w Objection

* Metody hookowania czasami powoduj awarie aplikacji (to r贸wnie偶 z powodu Fridy).
* Nie mo偶na u偶ywa instancji klas do wywoywania funkcji instancji. Nie mo偶na r贸wnie偶 tworzy nowych instancji klas i u偶ywa ich do wywoywania funkcji.
* Nie ma skr贸tu (podobnego do sslpinnin), kt贸ry umo偶liwiaby hookowanie wszystkich wsp贸lnych metod kryptograficznych u偶ywanych przez aplikacj w celu zobaczenia zaszyfrowanego tekstu, tekstu jawnego, kluczy, IV i u偶ywanych algorytm贸w.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Wskaz贸wka dotyczca bug bounty**: **Zarejestruj si** na platformie **Intigriti**, premium platformie **bug bounty stworzonej przez haker贸w, dla haker贸w**! Docz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ju偶 dzi i zacznij zarabia nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
