# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ Burp

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## –ù–∞ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ–π –º–∞—à–∏–Ω—ñ

–ü–æ-–ø–µ—Ä—à–µ, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç Der –∑ Burp. –í–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –≤ _**Proxy**_ --> _**Options**_ --> _**Import / Export CA certificate**_

![](<../../.gitbook/assets/image (367).png>)

**–ï–∫—Å–ø–æ—Ä—Ç—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ Der** —ñ –¥–∞–≤–∞–π—Ç–µ **–ø–µ—Ä–µ—Ç–≤–æ—Ä–∏–º–æ** –π–æ–≥–æ –≤ —Ñ–æ—Ä–º—É, —è–∫—É **Android** –∑–º–æ–∂–µ **–∑—Ä–æ–∑—É–º—ñ—Ç–∏.** –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **–¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ burp –Ω–∞ Android –º–∞—à–∏–Ω—ñ –≤ AVD** –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–∑–∞–ø—É—Å—Ç–∏—Ç–∏** —Ü—é –º–∞—à–∏–Ω—É **–∑** –æ–ø—Ü—ñ—î—é **`-writable-system`**.\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —ó—ó —Ç–∞–∫:

{% code overflow="wrap" %}
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -avd "AVD9" -http-proxy 192.168.1.12:8080 -writable-system
```
{% endcode %}

–¢–æ–¥—ñ, —â–æ–± **–Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç burp**:

{% code overflow="wrap" %}
```bash
openssl x509 -inform DER -in burp_cacert.der -out burp_cacert.pem
CERTHASHNAME="`openssl x509 -inform PEM -subject_hash_old -in burp_cacert.pem | head -1`.0"
mv burp_cacert.pem $CERTHASHNAME #Correct name
adb root && sleep 2 && adb remount #Allow to write on /syste
adb push $CERTHASHNAME /sdcard/ #Upload certificate
adb shell mv /sdcard/$CERTHASHNAME /system/etc/security/cacerts/ #Move to correct location
adb shell chmod 644 /system/etc/security/cacerts/$CERTHASHNAME #Assign privileges
adb reboot #Now, reboot the machine
```
{% endcode %}

–Ø–∫ —Ç—ñ–ª—å–∫–∏ **–º–∞—à–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**, —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç burp –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è!

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Magisc

–Ø–∫—â–æ –≤–∏ **—Ä—É—Ç–Ω—É–ª–∏ —Å–≤—ñ–π –ø—Ä–∏—Å—Ç—Ä—ñ–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Magisc** (–º–æ–∂–ª–∏–≤–æ, –µ–º—É–ª—è—Ç–æ—Ä), —ñ –≤–∏ **–Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏** –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ **–∫—Ä–æ–∫–∏** –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ Burp, –æ—Å–∫—ñ–ª—å–∫–∏ **—Ñ–∞–π–ª–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ —î —Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è** —ñ –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –∑–º–æ–Ω—Ç—É–≤–∞—Ç–∏ —ó—ó –¥–ª—è –∑–∞–ø–∏—Å—É, —î —ñ–Ω—à–∏–π —Å–ø–æ—Å—ñ–±.

–ü–æ—è—Å–Ω–µ–Ω–æ –≤ [**—Ü—å–æ–º—É –≤—ñ–¥–µ–æ**](https://www.youtube.com/watch?v=qQicUW0svB8), –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ:

1. **–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç CA**: –ü—Ä–æ—Å—Ç–æ **–ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å** DER —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç Burp, **–∑–º—ñ–Ω–∏–≤—à–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è** –Ω–∞ `.crt` –Ω–∞ –º–æ–±—ñ–ª—å–Ω–æ–º—É, —â–æ–± –≤—ñ–Ω –∑–±–µ—Ä—ñ–≥—Å—è –≤ –ø–∞–ø—Ü—ñ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —ñ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ `–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç` -> `CA —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç`

<figure><img src="../../.gitbook/assets/image (53).png" alt="" width="164"><figcaption></figcaption></figure>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –±—É–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π, –ø–µ—Ä–µ–π—à–æ–≤—à–∏ –¥–æ `–î–æ–≤—ñ—Ä–µ–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ` -> `–ö–û–†–ò–°–¢–£–í–ê–ß`

<figure><img src="../../.gitbook/assets/image (54).png" alt="" width="334"><figcaption></figcaption></figure>

2. **–ó—Ä–æ–±—ñ—Ç—å –π–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ –¥–æ–≤—ñ—Ä–µ–Ω–∏–º**: –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –º–æ–¥—É–ª—å Magisc [MagiskTrustUserCerts](https://github.com/NVISOsecurity/MagiskTrustUserCerts) (—Ñ–∞–π–ª .zip), **–ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –π–æ–≥–æ** –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω, –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ **–¥–æ–¥–∞—Ç–∫—É Magics** –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ –≤ —Ä–æ–∑–¥—ñ–ª **`–ú–æ–¥—É–ª—ñ`**, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å **`–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑ –ø–∞–º'—è—Ç—ñ`**, –≤–∏–±–µ—Ä—ñ—Ç—å –º–æ–¥—É–ª—å `.zip` —ñ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è **–ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ** —Ç–µ–ª–µ—Ñ–æ–Ω:

<figure><img src="../../.gitbook/assets/image (55).png" alt="" width="345"><figcaption></figcaption></figure>

* –ü—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ `–î–æ–≤—ñ—Ä–µ–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ` -> `–°–ò–°–¢–ï–ú–ê` —ñ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç Postswigger —Ç–∞–º

<figure><img src="../../.gitbook/assets/image (56).png" alt="" width="314"><figcaption></figcaption></figure>

## –ü—ñ—Å–ª—è Android 14

–£ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É –≤–∏–ø—É—Å–∫—É Android 14 —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∑–Ω–∞—á–Ω–∞ –∑–º—ñ–Ω–∞ –≤ –æ–±—Ä–æ–±—Ü—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π–Ω–∏—Ö –æ—Ä–≥–∞–Ω—ñ–≤ (CA), —è–∫–∏–º –¥–æ–≤—ñ—Ä—è—î —Å–∏—Å—Ç–µ–º–∞. –†–∞–Ω—ñ—à–µ —Ü—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞–ª–∏—Å—è –≤ **`/system/etc/security/cacerts/`**, –¥–æ—Å—Ç—É–ø–Ω—ñ —Ç–∞ –∑–º—ñ–Ω—é–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ –∑ –ø—Ä–∞–≤–∞–º–∏ root, —â–æ –¥–æ–∑–≤–æ–ª—è–ª–æ –Ω–µ–≥–∞–π–Ω–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø–æ –≤—Å—ñ–π —Å–∏—Å—Ç–µ–º—ñ. –û–¥–Ω–∞–∫ –∑ Android 14 –º—ñ—Å—Ü–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –±—É–ª–æ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ –¥–æ **`/apex/com.android.conscrypt/cacerts`**, –∫–∞—Ç–∞–ª–æ–≥—É –≤ –º–µ–∂–∞—Ö —à–ª—è—Ö—É **`/apex`**, —è–∫–∏–π –∑–∞ —Å–≤–æ—î—é –ø—Ä–∏—Ä–æ–¥–æ—é —î –Ω–µ–∑–º—ñ–Ω–Ω–∏–º.

–°–ø—Ä–æ–±–∏ –∑–º–æ–Ω—Ç—É–≤–∞—Ç–∏ **—à–ª—è—Ö APEX cacerts** —è–∫ –∑–∞–ø–∏—Å—É–≤–∞–Ω–∏–π –∑–∞–∑–Ω–∞—é—Ç—å –Ω–µ–≤–¥–∞—á—ñ, –æ—Å–∫—ñ–ª—å–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –¥–æ–∑–≤–æ–ª—è—î —Ç–∞–∫—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó. –ù–∞–≤—ñ—Ç—å —Å–ø—Ä–æ–±–∏ –¥–µ–º–æ–Ω—Ç—É–≤–∞—Ç–∏ –∞–±–æ –Ω–∞–∫–ª–∞—Å—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥ –∑ —Ç–∏–º—á–∞—Å–æ–≤–æ—é —Ñ–∞–π–ª–æ–≤–æ—é —Å–∏—Å—Ç–µ–º–æ—é (tmpfs) –Ω–µ –æ–±—Ö–æ–¥—è—Ç—å –Ω–µ–∑–º—ñ–Ω–Ω—ñ—Å—Ç—å; –ø—Ä–æ–≥—Ä–∞–º–∏ –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞, –Ω–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ –∑–º—ñ–Ω–∏ –Ω–∞ —Ä—ñ–≤–Ω—ñ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏. –¶—è —Å—Ç—ñ–π–∫—ñ—Å—Ç—å –∑—É–º–æ–≤–ª–µ–Ω–∞ —Ç–∏–º, —â–æ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è **`/apex`** –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–µ –∑ PRIVATE –ø—Ä–æ–ø–∞–≥–∞–Ω–¥–æ—é, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ–± –±—É–¥—å-—è–∫—ñ –∑–º—ñ–Ω–∏ –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ **`/apex`** –Ω–µ –≤–ø–ª–∏–≤–∞–ª–∏ –Ω–∞ —ñ–Ω—à—ñ –ø—Ä–æ—Ü–µ—Å–∏.

–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Android –≤–∫–ª—é—á–∞—î –ø—Ä–æ—Ü–µ—Å `init`, —è–∫–∏–π, –∑–∞–ø—É—Å–∫–∞—é—á–∏ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—É —Å–∏—Å—Ç–µ–º—É, —Ç–∞–∫–æ–∂ —ñ–Ω—ñ—Ü—ñ—é—î –ø—Ä–æ—Ü–µ—Å Zygote. –¶–µ–π –ø—Ä–æ—Ü–µ—Å –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—ñ–≤ –¥–æ–¥–∞—Ç–∫—ñ–≤ –∑ –Ω–æ–≤–∏–º –ø—Ä–æ—Å—Ç–æ—Ä–æ–º –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è, —è–∫–∏–π –≤–∫–ª—é—á–∞—î –ø—Ä–∏–≤–∞—Ç–Ω–µ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è **`/apex`**, —Ç–∞–∫–∏–º —á–∏–Ω–æ–º —ñ–∑–æ–ª—é—é—á–∏ –∑–º—ñ–Ω–∏ –≤ —Ü—å–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ –≤—ñ–¥ —ñ–Ω—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤.

–ü—Ä–æ—Ç–µ —ñ—Å–Ω—É—î –æ–±—Ö—ñ–¥–Ω–∏–π —à–ª—è—Ö –¥–ª—è —Ç–∏—Ö, —Ö—Ç–æ –ø–æ—Ç—Ä–µ–±—É—î –∑–º—ñ–Ω–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ CA, —è–∫–∏–º –¥–æ–≤—ñ—Ä—è—î —Å–∏—Å—Ç–µ–º–∞, —É –∫–∞—Ç–∞–ª–æ–∑—ñ **`/apex`**. –¶–µ –ø–µ—Ä–µ–¥–±–∞—á–∞—î —Ä—É—á–Ω–µ –∑–º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è **`/apex`** –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è PRIVATE –ø—Ä–æ–ø–∞–≥–∞–Ω–¥–∏, —â–æ —Ä–æ–±–∏—Ç—å –π–æ–≥–æ –∑–∞–ø–∏—Å—É–≤–∞–Ω–∏–º. –ü—Ä–æ—Ü–µ—Å –≤–∫–ª—é—á–∞—î –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤–º—ñ—Å—Ç—É **`/apex/com.android.conscrypt`** –≤ —ñ–Ω—à–µ –º—ñ—Å—Ü–µ, –¥–µ–º–æ–Ω—Ç–∞–∂ –∫–∞—Ç–∞–ª–æ–≥—É **`/apex/com.android.conscrypt`** –¥–ª—è —É—Å—É–Ω–µ–Ω–Ω—è –æ–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è, –∞ –ø–æ—Ç—ñ–º –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–º—ñ—Å—Ç—É –Ω–∞ —ó—Ö–Ω—î –ø–µ—Ä–≤—ñ—Å–Ω–µ –º—ñ—Å—Ü–µ –≤ –º–µ–∂–∞—Ö **`/apex`**. –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –≤–∏–º–∞–≥–∞—î —à–≤–∏–¥–∫–∏—Ö –¥—ñ–π, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∑–±–æ—ó–≤ —Å–∏—Å—Ç–µ–º–∏. –©–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ü–∏—Ö –∑–º—ñ–Ω, —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ `system_server`, —â–æ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î –≤—Å—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î —Å–∏—Å—Ç–µ–º—É –¥–æ —É–∑–≥–æ–¥–∂–µ–Ω–æ–≥–æ —Å—Ç–∞–Ω—É.
```bash
# Create a separate temp directory, to hold the current certificates
# Otherwise, when we add the mount we can't read the current certs anymore.
mkdir -p -m 700 /data/local/tmp/tmp-ca-copy

# Copy out the existing certificates
cp /apex/com.android.conscrypt/cacerts/* /data/local/tmp/tmp-ca-copy/

# Create the in-memory mount on top of the system certs folder
mount -t tmpfs tmpfs /system/etc/security/cacerts

# Copy the existing certs back into the tmpfs, so we keep trusting them
mv /data/local/tmp/tmp-ca-copy/* /system/etc/security/cacerts/

# Copy our new cert in, so we trust that too
mv $CERTIFICATE_PATH /system/etc/security/cacerts/

# Update the perms & selinux context labels
chown root:root /system/etc/security/cacerts/*
chmod 644 /system/etc/security/cacerts/*
chcon u:object_r:system_file:s0 /system/etc/security/cacerts/*

# Deal with the APEX overrides, which need injecting into each namespace:

# First we get the Zygote process(es), which launch each app
ZYGOTE_PID=$(pidof zygote || true)
ZYGOTE64_PID=$(pidof zygote64 || true)
# N.b. some devices appear to have both!

# Apps inherit the Zygote's mounts at startup, so we inject here to ensure
# all newly started apps will see these certs straight away:
for Z_PID in "$ZYGOTE_PID" "$ZYGOTE64_PID"; do
if [ -n "$Z_PID" ]; then
nsenter --mount=/proc/$Z_PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
fi
done

# Then we inject the mount into all already running apps, so they
# too see these CA certs immediately:

# Get the PID of every process whose parent is one of the Zygotes:
APP_PIDS=$(
echo "$ZYGOTE_PID $ZYGOTE64_PID" | \
xargs -n1 ps -o 'PID' -P | \
grep -v PID
)

# Inject into the mount namespace of each of those apps:
for PID in $APP_PIDS; do
nsenter --mount=/proc/$PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts &
done
wait # Launched in parallel - wait for completion here

echo "System certificate injected"
```
### Bind-mounting through NSEnter

1. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É–≤–∞–Ω–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó**: –°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑–∞–ø–∏—Å—É–≤–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è —à–ª—è—Ö–æ–º –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è `tmpfs` –Ω–∞–¥ —ñ—Å–Ω—É—é—á–æ—é –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—î—é —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤, —â–æ –Ω–µ —î APEX. –¶–µ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏:
```bash
mount -t tmpfs tmpfs /system/etc/security/cacerts
```
2. **–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ CA —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤**: –ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É–≤–∞–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É, CA —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏, —è–∫—ñ –ø–ª–∞–Ω—É—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, —Å–ª—ñ–¥ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤ —Ü–µ–π –∫–∞—Ç–∞–ª–æ–≥. –¶–µ –º–æ–∂–µ –≤–∫–ª—é—á–∞—Ç–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ –∑ `/apex/com.android.conscrypt/cacerts/`. –í–∞–∂–ª–∏–≤–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∏ —Ç–∞ –º—ñ—Ç–∫–∏ SELinux –¥–ª—è —Ü–∏—Ö —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤.  
3. **–ü—Ä–∏–≤'—è–∑–∫–∞ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è Zygote**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `nsenter`, –≤—Ö–æ–¥—è—Ç—å —É –ø—Ä–æ—Å—Ç—ñ—Ä —ñ–º–µ–Ω –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è Zygote. Zygote, –±—É–¥—É—á–∏ –ø—Ä–æ—Ü–µ—Å–æ–º, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–º –∑–∞ –∑–∞–ø—É—Å–∫ Android –¥–æ–¥–∞—Ç–∫—ñ–≤, –≤–∏–º–∞–≥–∞—î —Ü—å–æ–≥–æ –∫—Ä–æ–∫—É, —â–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏, —â–æ –≤—Å—ñ –¥–æ–¥–∞—Ç–∫–∏, —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞–ø—É—â–µ–Ω—ñ –Ω–∞–¥–∞–ª—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –Ω–æ–≤–æ–Ω–∞–∫–æ–Ω—Ñ—ñ–≥—É—Ä–æ–≤–∞–Ω—ñ CA —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–∞:
```bash
nsenter --mount=/proc/$ZYGOTE_PID/ns/mnt -- /bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```
–¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –∫–æ–∂–µ–Ω –Ω–æ–≤–∏–π –¥–æ–¥–∞—Ç–æ–∫, —è–∫–∏–π –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è, –±—É–¥–µ –¥–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—è –æ–Ω–æ–≤–ª–µ–Ω–æ—ó –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó CA —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤.

4. **–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω –¥–æ –∑–∞–ø—É—â–µ–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤**: –©–æ–± –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–∏ –¥–æ –≤–∂–µ –∑–∞–ø—É—â–µ–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤, –∑–Ω–æ–≤—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `nsenter`, —â–æ–± —É–≤—ñ–π—Ç–∏ –≤ –ø—Ä–æ—Å—Ç—ñ—Ä —ñ–º–µ–Ω –∫–æ–∂–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫–∞ –æ–∫—Ä–µ–º–æ —Ç–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø–æ–¥—ñ–±–Ω–µ –∑–≤'—è–∑—É–≤–∞–Ω–Ω—è. –ù–µ–æ–±—Ö—ñ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞:
```bash
nsenter --mount=/proc/$APP_PID/ns/mnt -- /bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```
5. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ - –ú'—è–∫–∏–π –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–¥–±–∞—á–∞—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–∏–≤'—è–∑–∫–∏ –¥–æ –ø—Ä–æ—Ü–µ—Å—É `init` (PID 1), –ø—ñ—Å–ª—è —á–æ–≥–æ —Å–ª—ñ–¥—É—î –º'—è–∫–µ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ –∑ –∫–æ–º–∞–Ω–¥–∞–º–∏ `stop && start`. –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ–∑–≤–æ–ª–∏—Ç—å –ø–æ—à–∏—Ä–∏—Ç–∏ –∑–º—ñ–Ω–∏ –Ω–∞ –≤—Å—ñ –ø—Ä–æ—Å—Ç–æ—Ä–∏ —ñ–º–µ–Ω, —É–Ω–∏–∫–∞—é—á–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –æ–∫—Ä–µ–º–æ –≤–∏—Ä—ñ—à—É–≤–∞—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è –∑ –∫–æ–∂–Ω–∏–º –∑–∞–ø—É—â–µ–Ω–∏–º –¥–æ–¥–∞—Ç–∫–æ–º. –û–¥–Ω–∞–∫ —Ü–µ–π –º–µ—Ç–æ–¥ –∑–∞–∑–≤–∏—á–∞–π –º–µ–Ω—à –±–∞–∂–∞–Ω–∏–π —á–µ—Ä–µ–∑ –Ω–µ–∑—Ä—É—á–Ω—ñ—Å—Ç—å –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://httptoolkit.com/blog/android-14-install-system-ca-certificate/](https://httptoolkit.com/blog/android-14-install-system-ca-certificate/)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
