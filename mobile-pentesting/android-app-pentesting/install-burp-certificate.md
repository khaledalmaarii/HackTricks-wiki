# Burpè¨¼æ˜æ›¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## ä»®æƒ³ãƒã‚·ãƒ³ä¸Šã§

ã¾ãšæœ€åˆã«ã€Burpã‹ã‚‰Derå½¢å¼ã®è¨¼æ˜æ›¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€_**Proxy**_ --> _**Options**_ --> _**Import / Export CA certificate**_ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

![](<../../.gitbook/assets/image (367).png>)

**Derå½¢å¼ã§è¨¼æ˜æ›¸ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**ã—ã€**Android**ãŒ**ç†è§£ã§ãã‚‹å½¢å¼ã«å¤‰æ›**ã—ã¾ã™ã€‚**AVDã®Androidãƒã‚·ãƒ³ã§Burpè¨¼æ˜æ›¸ã‚’è¨­å®šã™ã‚‹ã«ã¯ã€**ã“ã®ãƒã‚·ãƒ³ã‚’**`-writable-system`**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§**å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\
ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ã«å®Ÿè¡Œã§ãã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
C:\Users\<UserName>\AppData\Local\Android\Sdk\tools\emulator.exe -avd "AVD9" -http-proxy 192.168.1.12:8080 -writable-system
```
{% endcode %}

æ¬¡ã«ã€**burpã®è¨¼æ˜æ›¸ã‚’è¨­å®šã™ã‚‹ã«ã¯**:

{% code overflow="wrap" %}
```bash
openssl x509 -inform DER -in burp_cacert.der -out burp_cacert.pem
CERTHASHNAME="`openssl x509 -inform PEM -subject_hash_old -in burp_cacert.pem | head -1`.0"
mv burp_cacert.pem $CERTHASHNAME #Correct name
adb root && sleep 2 && adb remount #Allow to write on /syste
adb push $CERTHASHNAME /sdcard/ #Upload certificate
adb shell mv /sdcard/$CERTHASHNAME /system/etc/security/cacerts/ #Move to correct location
adb shell chmod 644 /system/etc/security/cacerts/$CERTHASHNAME #Assign privileges
adb reboot #Now, reboot the machine
```
{% endcode %}

**ãƒã‚·ãƒ³ãŒå†èµ·å‹•ã‚’å®Œäº†ã™ã‚‹ã¨**ã€Burpè¨¼æ˜æ›¸ãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼

## Magiscã‚’ä½¿ç”¨ã™ã‚‹

ã‚‚ã—ã‚ãªãŸãŒ**Magiscã§ãƒ‡ãƒã‚¤ã‚¹ã‚’ãƒ«ãƒ¼ãƒˆåŒ–ã—ãŸ**ï¼ˆãŠãã‚‰ãã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼‰ã€ãã—ã¦**å‰ã®æ‰‹é †**ã«å¾“ã£ã¦Burpè¨¼æ˜æ›¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„å ´åˆã€**ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãŒèª­ã¿å–ã‚Šå°‚ç”¨**ã§ã‚ã‚Šã€æ›¸ãè¾¼ã¿å¯èƒ½ã«å†ãƒã‚¦ãƒ³ãƒˆã§ããªã„å ´åˆã€åˆ¥ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

[**ã“ã®ãƒ“ãƒ‡ã‚ª**](https://www.youtube.com/watch?v=qQicUW0svB8)ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€æ¬¡ã®ã“ã¨ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

1. **CAè¨¼æ˜æ›¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹**ï¼šDER Burpè¨¼æ˜æ›¸ã‚’**ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—**ã—ã¦ã€ãƒ¢ãƒã‚¤ãƒ«ã§æ‹¡å¼µå­ã‚’`.crt`ã«å¤‰æ›´ã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«ä¿å­˜ã—ã€`è¨¼æ˜æ›¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«` -> `CAè¨¼æ˜æ›¸`ã«é€²ã¿ã¾ã™ã€‚

<figure><img src="../../.gitbook/assets/image (53).png" alt="" width="164"><figcaption></figcaption></figure>

* `ä¿¡é ¼ã§ãã‚‹è³‡æ ¼æƒ…å ±` -> `ãƒ¦ãƒ¼ã‚¶ãƒ¼`ã«é€²ã‚“ã§ã€è¨¼æ˜æ›¸ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

<figure><img src="../../.gitbook/assets/image (54).png" alt="" width="334"><figcaption></figcaption></figure>

2. **ã‚·ã‚¹ãƒ†ãƒ ä¿¡é ¼ã«ã™ã‚‹**ï¼šMagiscãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«[MagiskTrustUserCerts](https://github.com/NVISOsecurity/MagiskTrustUserCerts)ï¼ˆ.zipãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€**ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—**ã—ã¦é›»è©±ã«ç§»å‹•ã—ã€é›»è©±ã®**Magicsã‚¢ãƒ—ãƒª**ã®**`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«`**ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¡Œãã€**`ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«`**ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`.zip`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é¸æŠã—ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã«**å†èµ·å‹•**ã—ã¾ã™ï¼š

<figure><img src="../../.gitbook/assets/image (55).png" alt="" width="345"><figcaption></figcaption></figure>

* å†èµ·å‹•å¾Œã€`ä¿¡é ¼ã§ãã‚‹è³‡æ ¼æƒ…å ±` -> `ã‚·ã‚¹ãƒ†ãƒ `ã«é€²ã¿ã€Postswiggerè¨¼æ˜æ›¸ãŒãã“ã«ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

<figure><img src="../../.gitbook/assets/image (56).png" alt="" width="314"><figcaption></figcaption></figure>

## Android 14ä»¥é™

æœ€æ–°ã®Android 14ãƒªãƒªãƒ¼ã‚¹ã§ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ä¿¡é ¼ã®è¨¼æ˜æ›¸æ©Ÿé–¢ï¼ˆCAï¼‰è¨¼æ˜æ›¸ã®å–ã‚Šæ‰±ã„ã«å¤§ããªå¤‰åŒ–ãŒè¦‹ã‚‰ã‚Œã¾ã—ãŸã€‚ä»¥å‰ã¯ã€ã“ã‚Œã‚‰ã®è¨¼æ˜æ›¸ã¯**`/system/etc/security/cacerts/`**ã«æ ¼ç´ã•ã‚Œã¦ãŠã‚Šã€ãƒ«ãƒ¼ãƒˆæ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ãŠã‚ˆã³å¤‰æ›´å¯èƒ½ã§ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã«å³åº§ã«é©ç”¨ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ã—ã‹ã—ã€Android 14ã§ã¯ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å ´æ‰€ãŒ**`/apex/com.android.conscrypt/cacerts`**ã«ç§»å‹•ã•ã‚Œã€ã“ã‚Œã¯**`/apex`**ãƒ‘ã‚¹å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã‚ã‚Šã€æœ¬è³ªçš„ã«ä¸å¤‰ã§ã™ã€‚

**APEX cacertsãƒ‘ã‚¹**ã‚’èª­ã¿æ›¸ãå¯èƒ½ã¨ã—ã¦å†ãƒã‚¦ãƒ³ãƒˆã—ã‚ˆã†ã¨ã™ã‚‹ã¨å¤±æ•—ã—ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã¯ãã®ã‚ˆã†ãªæ“ä½œã‚’è¨±å¯ã—ã¾ã›ã‚“ã€‚ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ï¼ˆtmpfsï¼‰ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã¾ãŸã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã—ã‚ˆã†ã¨ã™ã‚‹è©¦ã¿ã‚‚ä¸å¤‰æ€§ã‚’å›é¿ã™ã‚‹ã“ã¨ã¯ã§ããšã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«ã§ã®å¤‰æ›´ã«é–¢ä¿‚ãªãã€å…ƒã®è¨¼æ˜æ›¸ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ç¶šã‘ã¾ã™ã€‚ã“ã®è€æ€§ã¯ã€**`/apex`**ãƒã‚¦ãƒ³ãƒˆãŒPRIVATEä¼æ’­ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã§ã‚ã‚Šã€**`/apex`**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®å¤‰æ›´ãŒä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

Androidã®åˆæœŸåŒ–ã«ã¯`init`ãƒ—ãƒ­ã‚»ã‚¹ãŒé–¢ä¸ã—ã¦ãŠã‚Šã€ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•ã™ã‚‹ã¨åŒæ™‚ã«Zygoteãƒ—ãƒ­ã‚»ã‚¹ã‚‚é–‹å§‹ã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯ã€æ–°ã—ã„ãƒã‚¦ãƒ³ãƒˆãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŒã¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•ã™ã‚‹è²¬ä»»ãŒã‚ã‚Šã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãª**`/apex`**ãƒã‚¦ãƒ³ãƒˆã‚’å«ã‚€ãŸã‚ã€ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®å¤‰æ›´ã‚’ä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰éš”é›¢ã—ã¾ã™ã€‚

ãã‚Œã§ã‚‚ã€**`/apex`**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ã‚·ã‚¹ãƒ†ãƒ ä¿¡é ¼ã®CAè¨¼æ˜æ›¸ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã®å›é¿ç­–ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€PRIVATEä¼æ’­ã‚’å‰Šé™¤ã™ã‚‹ãŸã‚ã«**`/apex`**ã‚’æ‰‹å‹•ã§å†ãƒã‚¦ãƒ³ãƒˆã—ã€æ›¸ãè¾¼ã¿å¯èƒ½ã«ã™ã‚‹ã“ã¨ã‚’å«ã¿ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã«ã¯ã€**`/apex/com.android.conscrypt`**ã®å†…å®¹ã‚’åˆ¥ã®å ´æ‰€ã«ã‚³ãƒ”ãƒ¼ã—ã€èª­ã¿å–ã‚Šå°‚ç”¨åˆ¶ç´„ã‚’æ’é™¤ã™ã‚‹ãŸã‚ã«**`/apex/com.android.conscrypt`**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã—ã€ãã®å¾Œã€å†…å®¹ã‚’**`/apex`**å†…ã®å…ƒã®å ´æ‰€ã«å¾©å…ƒã™ã‚‹ã“ã¨ãŒå«ã¾ã‚Œã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’é¿ã‘ã‚‹ãŸã‚ã«è¿…é€Ÿãªè¡Œå‹•ã‚’å¿…è¦ã¨ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®å¤‰æ›´ã‚’ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã«é©ç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€`system_server`ã‚’å†èµ·å‹•ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã«ã‚ˆã‚Šã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†èµ·å‹•ã•ã‚Œã€ã‚·ã‚¹ãƒ†ãƒ ãŒä¸€è²«ã—ãŸçŠ¶æ…‹ã«æˆ»ã‚Šã¾ã™ã€‚
```bash
# Create a separate temp directory, to hold the current certificates
# Otherwise, when we add the mount we can't read the current certs anymore.
mkdir -p -m 700 /data/local/tmp/tmp-ca-copy

# Copy out the existing certificates
cp /apex/com.android.conscrypt/cacerts/* /data/local/tmp/tmp-ca-copy/

# Create the in-memory mount on top of the system certs folder
mount -t tmpfs tmpfs /system/etc/security/cacerts

# Copy the existing certs back into the tmpfs, so we keep trusting them
mv /data/local/tmp/tmp-ca-copy/* /system/etc/security/cacerts/

# Copy our new cert in, so we trust that too
mv $CERTIFICATE_PATH /system/etc/security/cacerts/

# Update the perms & selinux context labels
chown root:root /system/etc/security/cacerts/*
chmod 644 /system/etc/security/cacerts/*
chcon u:object_r:system_file:s0 /system/etc/security/cacerts/*

# Deal with the APEX overrides, which need injecting into each namespace:

# First we get the Zygote process(es), which launch each app
ZYGOTE_PID=$(pidof zygote || true)
ZYGOTE64_PID=$(pidof zygote64 || true)
# N.b. some devices appear to have both!

# Apps inherit the Zygote's mounts at startup, so we inject here to ensure
# all newly started apps will see these certs straight away:
for Z_PID in "$ZYGOTE_PID" "$ZYGOTE64_PID"; do
if [ -n "$Z_PID" ]; then
nsenter --mount=/proc/$Z_PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
fi
done

# Then we inject the mount into all already running apps, so they
# too see these CA certs immediately:

# Get the PID of every process whose parent is one of the Zygotes:
APP_PIDS=$(
echo "$ZYGOTE_PID $ZYGOTE64_PID" | \
xargs -n1 ps -o 'PID' -P | \
grep -v PID
)

# Inject into the mount namespace of each of those apps:
for PID in $APP_PIDS; do
nsenter --mount=/proc/$PID/ns/mnt -- \
/bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts &
done
wait # Launched in parallel - wait for completion here

echo "System certificate injected"
```
### Bind-mounting through NSEnter

1. **æ›¸ãè¾¼ã¿å¯èƒ½ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®š**: æœ€åˆã«ã€æ—¢å­˜ã®éAPEXã‚·ã‚¹ãƒ†ãƒ è¨¼æ˜æ›¸ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸Šã«`tmpfs`ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã“ã¨ã§ã€æ›¸ãè¾¼ã¿å¯èƒ½ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒç¢ºç«‹ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿç¾ã•ã‚Œã¾ã™:
```bash
mount -t tmpfs tmpfs /system/etc/security/cacerts
```
2. **CAè¨¼æ˜æ›¸ã®æº–å‚™**: æ›¸ãè¾¼ã¿å¯èƒ½ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ç¶šã„ã¦ã€ä½¿ç”¨ã™ã‚‹CAè¨¼æ˜æ›¸ã‚’ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã¯ã€`/apex/com.android.conscrypt/cacerts/`ã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨¼æ˜æ›¸ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã“ã¨ãŒå«ã¾ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®è¨¼æ˜æ›¸ã®æ¨©é™ã¨SELinuxãƒ©ãƒ™ãƒ«ã‚’é©åˆ‡ã«èª¿æ•´ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚  
3. **Zygoteã®ãƒã‚¤ãƒ³ãƒ‰ãƒã‚¦ãƒ³ãƒˆ**: `nsenter`ã‚’ä½¿ç”¨ã—ã¦ã€Zygoteã®ãƒã‚¦ãƒ³ãƒˆãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«å…¥ã‚Šã¾ã™ã€‚Zygoteã¯Androidã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã™ã‚‹è²¬ä»»ã‚’æŒã¤ãƒ—ãƒ­ã‚»ã‚¹ã§ã‚ã‚Šã€ä»¥é™ã«èµ·å‹•ã•ã‚Œã‚‹ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ–°ã—ãæ§‹æˆã•ã‚ŒãŸCAè¨¼æ˜æ›¸ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒå¿…è¦ã§ã™ã€‚ä½¿ç”¨ã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ã¯:
```bash
nsenter --mount=/proc/$ZYGOTE_PID/ns/mnt -- /bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```
ã“ã‚Œã«ã‚ˆã‚Šã€é–‹å§‹ã•ã‚Œã‚‹ã™ã¹ã¦ã®æ–°ã—ã„ã‚¢ãƒ—ãƒªãŒæ›´æ–°ã•ã‚ŒãŸCAè¨¼æ˜æ›¸ã®è¨­å®šã«å¾“ã†ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

4. **å®Ÿè¡Œä¸­ã®ã‚¢ãƒ—ãƒªã¸ã®å¤‰æ›´ã®é©ç”¨**: æ—¢ã«å®Ÿè¡Œä¸­ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¤‰æ›´ã‚’é©ç”¨ã™ã‚‹ã«ã¯ã€`nsenter`ã‚’å†åº¦ä½¿ç”¨ã—ã¦å„ã‚¢ãƒ—ãƒªã®åå‰ç©ºé–“ã«å€‹åˆ¥ã«å…¥ã‚Šã€åŒæ§˜ã®ãƒã‚¤ãƒ³ãƒ‰ãƒã‚¦ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚å¿…è¦ãªã‚³ãƒãƒ³ãƒ‰ã¯:
```bash
nsenter --mount=/proc/$APP_PID/ns/mnt -- /bin/mount --bind /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts
```
5. **ä»£æ›¿ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ - ã‚½ãƒ•ãƒˆãƒªãƒ–ãƒ¼ãƒˆ**: ä»£æ›¿æ‰‹æ³•ã¯ã€`init`ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆPID 1ï¼‰ã§ãƒã‚¤ãƒ³ãƒ‰ãƒã‚¦ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã€ãã®å¾Œã«`stop && start`ã‚³ãƒãƒ³ãƒ‰ã§ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚½ãƒ•ãƒˆãƒªãƒ–ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚’å«ã¿ã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€ã™ã¹ã¦ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«å¤‰æ›´ã‚’ä¼æ’­ã•ã›ã€å„å®Ÿè¡Œä¸­ã®ã‚¢ãƒ—ãƒªã‚’å€‹åˆ¥ã«å¯¾å‡¦ã™ã‚‹å¿…è¦ã‚’å›é¿ã—ã¾ã™ã€‚ã—ã‹ã—ã€ã“ã®æ–¹æ³•ã¯ãƒªãƒ–ãƒ¼ãƒˆã®ä¸ä¾¿ã•ã‹ã‚‰ä¸€èˆ¬çš„ã«ã¯ã‚ã¾ã‚Šå¥½ã¾ã‚Œã¾ã›ã‚“ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://httptoolkit.com/blog/android-14-install-system-ca-certificate/](https://httptoolkit.com/blog/android-14-install-system-ca-certificate/)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
