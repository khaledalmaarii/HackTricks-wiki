# Tapjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Podstawowe informacje**

**Tapjacking** to atak, w ktÃ³rym **zÅ‚oÅ›liwa** **aplikacja** jest uruchamiana i **pozycjonuje siÄ™ na wierzchu aplikacji ofiary**. Gdy widocznie zasÅ‚ania aplikacjÄ™ ofiary, jej interfejs uÅ¼ytkownika jest zaprojektowany w taki sposÃ³b, aby oszukaÄ‡ uÅ¼ytkownika do interakcji z niÄ…, podczas gdy przekazuje interakcjÄ™ do aplikacji ofiary.\
W efekcie, **oÅ›lepia uÅ¼ytkownika, uniemoÅ¼liwiajÄ…c mu wiedzÄ™, Å¼e faktycznie wykonuje akcje w aplikacji ofiary**.

### Wykrywanie

Aby wykryÄ‡ aplikacje podatne na ten atak, naleÅ¼y szukaÄ‡ **eksportowanych aktywnoÅ›ci** w manifeÅ›cie androida (zauwaÅ¼, Å¼e aktywnoÅ›Ä‡ z intencjÄ…-filtrujÄ…cÄ… jest automatycznie eksportowana domyÅ›lnie). Gdy znajdziesz eksportowane aktywnoÅ›ci, **sprawdÅº, czy wymagajÄ… jakichkolwiek uprawnieÅ„**. Dzieje siÄ™ tak, poniewaÅ¼ **zÅ‚oÅ›liwa aplikacja rÃ³wnieÅ¼ bÄ™dzie potrzebowaÄ‡ tych uprawnieÅ„**.

### Ochrona

#### Android 12 (API 31,32) i wyÅ¼sze

[**Zgodnie z tym ÅºrÃ³dÅ‚em**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** ataki tapjacking sÄ… automatycznie zapobiegane przez Androida od wersji 12 (API 31 i 30) i wyÅ¼szych. Tak wiÄ™c, nawet jeÅ›li aplikacja jest podatna, **nie bÄ™dziesz w stanie jej wykorzystaÄ‡**.

#### `filterTouchesWhenObscured`

JeÅ›li **`android:filterTouchesWhenObscured`** jest ustawione na **`true`**, `View` nie otrzyma dotykÃ³w, gdy okno widoku jest zasÅ‚oniÄ™te przez inne widoczne okno.

#### **`setFilterTouchesWhenObscured`**

Atrybut **`setFilterTouchesWhenObscured`** ustawiony na true moÅ¼e rÃ³wnieÅ¼ zapobiec wykorzystaniu tej podatnoÅ›ci, jeÅ›li wersja Androida jest niÅ¼sza.\
JeÅ›li ustawione na **`true`**, na przykÅ‚ad, przycisk moÅ¼e byÄ‡ automatycznie **wyÅ‚Ä…czony, jeÅ›li jest zasÅ‚oniÄ™ty**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Eksploatacja

### Tapjacking-ExportedActivity

Najbardziej **najnowsza aplikacja na Androida** przeprowadzajÄ…ca atak Tapjacking (+ wywoÅ‚anie przed eksportowanÄ… aktywnoÅ›ciÄ… atakowanej aplikacji) moÅ¼na znaleÅºÄ‡ pod adresem: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

PostÄ™puj zgodnie z **instrukcjami w README, aby z niej skorzystaÄ‡**.

### FloatingWindowApp

PrzykÅ‚adowy projekt implementujÄ…cy **FloatingWindowApp**, ktÃ³ry moÅ¼na uÅ¼yÄ‡ do naÅ‚oÅ¼enia na inne aktywnoÅ›ci w celu przeprowadzenia ataku clickjacking, moÅ¼na znaleÅºÄ‡ w [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (trochÄ™ stary, powodzenia w budowaniu apk).

### Qark

{% hint style="danger" %}
WyglÄ…da na to, Å¼e ten projekt nie jest juÅ¼ utrzymywany i ta funkcjonalnoÅ›Ä‡ nie dziaÅ‚a juÅ¼ poprawnie
{% endhint %}

MoÅ¼esz uÅ¼yÄ‡ [**qark**](https://github.com/linkedin/qark) z parametrami `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk`, aby stworzyÄ‡ zÅ‚oÅ›liwÄ… aplikacjÄ™ do testowania moÅ¼liwych **vulnerabilities Tapjacking**.\

Mitigacja jest stosunkowo prosta, poniewaÅ¼ deweloper moÅ¼e zdecydowaÄ‡, Å¼e nie chce odbieraÄ‡ zdarzeÅ„ dotykowych, gdy widok jest zasÅ‚oniÄ™ty przez inny. KorzystajÄ…c z [Dokumentacji Dewelopera Androida](https://developer.android.com/reference/android/view/View#security):

> Czasami istotne jest, aby aplikacja mogÅ‚a zweryfikowaÄ‡, Å¼e akcja jest wykonywana z peÅ‚nÄ… wiedzÄ… i zgodÄ… uÅ¼ytkownika, na przykÅ‚ad przyznawanie Å¼Ä…dania uprawnieÅ„, dokonywanie zakupu lub klikanie w reklamÄ™. Niestety, zÅ‚oÅ›liwa aplikacja mogÅ‚aby prÃ³bowaÄ‡ oszukaÄ‡ uÅ¼ytkownika, aby wykonaÅ‚ te akcje, nieÅ›wiadomie, ukrywajÄ…c zamierzony cel widoku. W ramach remediÃ³w, framework oferuje mechanizm filtrowania dotykÃ³w, ktÃ³ry moÅ¼na wykorzystaÄ‡ do poprawy bezpieczeÅ„stwa widokÃ³w, ktÃ³re zapewniajÄ… dostÄ™p do wraÅ¼liwej funkcjonalnoÅ›ci.
>
> Aby wÅ‚Ä…czyÄ‡ filtrowanie dotykÃ³w, wywoÅ‚aj [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) lub ustaw atrybut layout android:filterTouchesWhenObscured na true. Po wÅ‚Ä…czeniu framework odrzuci dotyki, ktÃ³re sÄ… odbierane, gdy okno widoku jest zasÅ‚oniÄ™te przez inne widoczne okno. W rezultacie widok nie otrzyma dotykÃ³w, gdy nad oknem widoku pojawi siÄ™ toast, dialog lub inne okno.

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
