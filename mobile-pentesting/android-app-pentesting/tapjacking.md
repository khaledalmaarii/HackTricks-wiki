# Tapjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Informazioni di base**

**Tapjacking** √® un attacco in cui un **applicazione** **maligna** viene lanciata e **si posiziona sopra un'applicazione vittima**. Una volta che oscura visibilmente l'app vittima, la sua interfaccia utente √® progettata in modo da ingannare l'utente a interagire con essa, mentre passa l'interazione all'app vittima.\
In effetti, sta **ciecando l'utente dal sapere che sta effettivamente eseguendo azioni sull'app vittima**.

### Rilevamento

Per rilevare le app vulnerabili a questo attacco, dovresti cercare **attivit√† esportate** nel manifest android (nota che un'attivit√† con un intent-filter √® automaticamente esportata per impostazione predefinita). Una volta trovate le attivit√† esportate, **controlla se richiedono qualche permesso**. Questo perch√© l'**applicazione maligna avr√† bisogno di quel permesso**.

### Protezione

#### Android 12 (API 31,32) e superiori

[**Secondo questa fonte**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** gli attacchi di tapjacking sono automaticamente prevenuti da Android a partire da Android 12 (API 31 & 30) e superiori. Quindi, anche se l'applicazione √® vulnerabile, **non sarai in grado di sfruttarla**.

#### `filterTouchesWhenObscured`

Se **`android:filterTouchesWhenObscured`** √® impostato su **`true`**, il `View` non ricever√† tocchi ogni volta che la finestra della vista √® oscurata da un'altra finestra visibile.

#### **`setFilterTouchesWhenObscured`**

L'attributo **`setFilterTouchesWhenObscured`** impostato su true pu√≤ anche prevenire lo sfruttamento di questa vulnerabilit√† se la versione di Android √® inferiore.\
Se impostato su **`true`**, ad esempio, un pulsante pu√≤ essere automaticamente **disabilitato se √® oscurato**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Exploitation

### Tapjacking-ExportedActivity

L'**ultima applicazione Android** che esegue un attacco Tapjacking (+ invocando prima un'attivit√† esportata dell'applicazione attaccata) pu√≤ essere trovata in: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

Segui le **istruzioni del README per utilizzarla**.

### FloatingWindowApp

Un progetto di esempio che implementa **FloatingWindowApp**, che pu√≤ essere utilizzato per sovrapporsi ad altre attivit√† per eseguire un attacco clickjacking, pu√≤ essere trovato in [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (un po' vecchio, buona fortuna a costruire l'apk).

### Qark

{% hint style="danger" %}
Sembra che questo progetto non sia pi√π mantenuto e questa funzionalit√† non funzioni pi√π correttamente
{% endhint %}

Puoi utilizzare [**qark**](https://github.com/linkedin/qark) con i parametri `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` per creare un'applicazione malevola per testare possibili vulnerabilit√† di **Tapjacking**.\

La mitigazione √® relativamente semplice poich√© lo sviluppatore pu√≤ scegliere di non ricevere eventi touch quando una vista √® coperta da un'altra. Utilizzando il [Riferimento per sviluppatori Android](https://developer.android.com/reference/android/view/View#security):

> A volte √® essenziale che un'applicazione possa verificare che un'azione venga eseguita con la piena conoscenza e il consenso dell'utente, come concedere una richiesta di autorizzazione, effettuare un acquisto o cliccare su un annuncio. Sfortunatamente, un'applicazione malevola potrebbe cercare di ingannare l'utente per eseguire queste azioni, senza che se ne accorga, nascondendo lo scopo previsto della vista. Come rimedio, il framework offre un meccanismo di filtraggio dei tocchi che pu√≤ essere utilizzato per migliorare la sicurezza delle viste che forniscono accesso a funzionalit√† sensibili.
>
> Per abilitare il filtraggio dei tocchi, chiama [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) o imposta l'attributo di layout android:filterTouchesWhenObscured su true. Quando abilitato, il framework scarter√† i tocchi ricevuti ogni volta che la finestra della vista √® oscurata da un'altra finestra visibile. Di conseguenza, la vista non ricever√† tocchi ogni volta che un toast, un dialogo o un'altra finestra appare sopra la finestra della vista.

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Impara e pratica il hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Impara e pratica il hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
{% endhint %}
