# Tapjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Informa√ß√µes B√°sicas**

**Tapjacking** √© um ataque onde um **aplicativo malicioso** √© lan√ßado e **se posiciona em cima de um aplicativo v√≠tima**. Uma vez que ele obscurece visivelmente o aplicativo v√≠tima, sua interface de usu√°rio √© projetada de tal forma a enganar o usu√°rio para interagir com ele, enquanto passa a intera√ß√£o para o aplicativo v√≠tima.\
Na pr√°tica, isso **cega o usu√°rio para saber que ele est√° realmente realizando a√ß√µes no aplicativo v√≠tima**.

### Detec√ß√£o

Para detectar aplicativos vulner√°veis a este ataque, voc√™ deve procurar por **atividades exportadas** no manifesto do android (note que uma atividade com um intent-filter √© automaticamente exportada por padr√£o). Uma vez que voc√™ tenha encontrado as atividades exportadas, **verifique se elas requerem alguma permiss√£o**. Isso porque o **aplicativo malicioso tamb√©m precisar√° dessa permiss√£o**.

### Prote√ß√£o

#### Android 12 (API 31,32) e superior

[**De acordo com esta fonte**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** ataques de tapjacking s√£o automaticamente prevenidos pelo Android a partir do Android 12 (API 31 & 30) e superior. Portanto, mesmo que o aplicativo seja vulner√°vel, voc√™ **n√£o poder√° explor√°-lo**.

#### `filterTouchesWhenObscured`

Se **`android:filterTouchesWhenObscured`** estiver definido como **`true`**, a `View` n√£o receber√° toques sempre que a janela da view estiver obscurecida por outra janela vis√≠vel.

#### **`setFilterTouchesWhenObscured`**

O atributo **`setFilterTouchesWhenObscured`** definido como verdadeiro tamb√©m pode prevenir a explora√ß√£o dessa vulnerabilidade se a vers√£o do Android for inferior.\
Se definido como **`true`**, por exemplo, um bot√£o pode ser automaticamente **desativado se estiver obscurecido**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Explora√ß√£o

### Tapjacking-ExportedActivity

O mais **recente aplicativo Android** realizando um ataque de Tapjacking (+ invocando antes de uma atividade exportada do aplicativo atacado) pode ser encontrado em: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

Siga as **instru√ß√µes do README para us√°-lo**.

### FloatingWindowApp

Um projeto de exemplo implementando **FloatingWindowApp**, que pode ser usado para sobrepor outras atividades para realizar um ataque de clickjacking, pode ser encontrado em [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (um pouco antigo, boa sorte construindo o apk).

### Qark

{% hint style="danger" %}
Parece que este projeto agora n√£o est√° mais sendo mantido e essa funcionalidade n√£o est√° funcionando corretamente
{% endhint %}

Voc√™ pode usar [**qark**](https://github.com/linkedin/qark) com os par√¢metros `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` para criar um aplicativo malicioso para testar poss√≠veis vulnerabilidades de **Tapjacking**.\

A mitiga√ß√£o √© relativamente simples, pois o desenvolvedor pode optar por n√£o receber eventos de toque quando uma visualiza√ß√£o est√° coberta por outra. Usando a [Refer√™ncia do Desenvolvedor Android](https://developer.android.com/reference/android/view/View#security):

> √Äs vezes, √© essencial que um aplicativo possa verificar se uma a√ß√£o est√° sendo realizada com o pleno conhecimento e consentimento do usu√°rio, como conceder um pedido de permiss√£o, fazer uma compra ou clicar em um an√∫ncio. Infelizmente, um aplicativo malicioso poderia tentar enganar o usu√°rio para realizar essas a√ß√µes, sem que ele perceba, ocultando o prop√≥sito pretendido da visualiza√ß√£o. Como rem√©dio, o framework oferece um mecanismo de filtragem de toque que pode ser usado para melhorar a seguran√ßa das visualiza√ß√µes que fornecem acesso a funcionalidades sens√≠veis.
>
> Para habilitar a filtragem de toque, chame [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) ou defina o atributo de layout android:filterTouchesWhenObscured como verdadeiro. Quando habilitado, o framework descartar√° toques que forem recebidos sempre que a janela da visualiza√ß√£o estiver obscurecida por outra janela vis√≠vel. Como resultado, a visualiza√ß√£o n√£o receber√° toques sempre que um toast, di√°logo ou outra janela aparecer acima da janela da visualiza√ß√£o.

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
