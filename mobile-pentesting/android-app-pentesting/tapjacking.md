# Tapjacking

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## **åŸºæœ¬ä¿¡æ¯**

**Tapjacking**æ˜¯ä¸€ç§æ”»å‡»ï¼Œå…¶ä¸­å¯åŠ¨ä¸€ä¸ª**æ¶æ„åº”ç”¨ç¨‹åº**ï¼Œå¹¶**å®šä½åœ¨å—å®³è€…åº”ç”¨ç¨‹åºçš„é¡¶éƒ¨**ã€‚ä¸€æ—¦å®ƒæ˜æ˜¾é®æŒ¡äº†å—å®³è€…åº”ç”¨ç¨‹åºï¼Œå…¶ç”¨æˆ·ç•Œé¢è¢«è®¾è®¡æˆä»¥ä¸€ç§æ–¹å¼æ¬ºéª—ç”¨æˆ·ä¸å…¶äº¤äº’ï¼ŒåŒæ—¶å°†äº¤äº’ä¼ é€’ç»™å—å®³è€…åº”ç”¨ç¨‹åºã€‚\
å®é™…ä¸Šï¼Œå®ƒ**ä½¿ç”¨æˆ·æ— æ³•æ„è¯†åˆ°ä»–ä»¬å®é™…ä¸Šæ˜¯åœ¨å—å®³è€…åº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œæ“ä½œ**ã€‚

### æ£€æµ‹

ä¸ºäº†æ£€æµ‹å®¹æ˜“å—åˆ°æ­¤æ”»å‡»çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨åº”è¯¥æœç´¢Androidæ¸…å•ä¸­çš„**å¯¼å‡ºæ´»åŠ¨**ï¼ˆè¯·æ³¨æ„ï¼Œå…·æœ‰æ„å›¾è¿‡æ»¤å™¨çš„æ´»åŠ¨é»˜è®¤æƒ…å†µä¸‹ä¼šè‡ªåŠ¨å¯¼å‡ºï¼‰ã€‚æ‰¾åˆ°å¯¼å‡ºçš„æ´»åŠ¨åï¼Œ**æ£€æŸ¥å®ƒä»¬æ˜¯å¦éœ€è¦ä»»ä½•æƒé™**ã€‚è¿™æ˜¯å› ä¸º**æ¶æ„åº”ç”¨ç¨‹åºä¹Ÿå°†éœ€è¦è¯¥æƒé™**ã€‚

### ä¿æŠ¤

#### Android 12ï¼ˆAPI 31,32ï¼‰åŠæ›´é«˜ç‰ˆæœ¬

[**æ ¹æ®æ­¤æ¥æº**](https://www.geeksforgeeks.org/tapjacking-in-android/)**ï¼Œ**ä»Android 12ï¼ˆAPI 31å’Œ30ï¼‰åŠæ›´é«˜ç‰ˆæœ¬å¼€å§‹ï¼ŒAndroidä¼šè‡ªåŠ¨é˜»æ­¢Tapjackingæ”»å‡»ã€‚å› æ­¤ï¼Œå³ä½¿åº”ç”¨ç¨‹åºå­˜åœ¨æ¼æ´ï¼Œæ‚¨**ä¹Ÿæ— æ³•åˆ©ç”¨å®ƒ**ã€‚

#### `filterTouchesWhenObscured`

å¦‚æœ**`android:filterTouchesWhenObscured`**è®¾ç½®ä¸º**`true`**ï¼Œå½“è§†å›¾çš„çª—å£è¢«å¦ä¸€ä¸ªå¯è§çª—å£é®æŒ¡æ—¶ï¼Œè¯¥`View`å°†ä¸ä¼šæ¥æ”¶è§¦æ‘¸äº‹ä»¶ã€‚

#### **`setFilterTouchesWhenObscured`**

å¦‚æœå°†å±æ€§**`setFilterTouchesWhenObscured`**è®¾ç½®ä¸ºtrueï¼Œè¿˜å¯ä»¥é˜²æ­¢åœ¨Androidç‰ˆæœ¬è¾ƒä½æ—¶åˆ©ç”¨æ­¤æ¼æ´ã€‚\
ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®ä¸º**`true`**ï¼Œåˆ™æŒ‰é’®åœ¨è¢«é®æŒ¡æ—¶å¯ä»¥è‡ªåŠ¨**ç¦ç”¨**ï¼š
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Exploitation

### Tapjacking-ExportedActivity

æœ€è¿‘çš„Androidåº”ç”¨ç¨‹åºæ‰§è¡ŒTapjackingæ”»å‡»ï¼ˆ+åœ¨è¢«æ”»å‡»åº”ç”¨ç¨‹åºçš„å¯¼å‡ºæ´»åŠ¨ä¹‹å‰è°ƒç”¨ï¼‰å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°ï¼š[**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity)ã€‚

æŒ‰ç…§**READMEè¯´æ˜**æ¥ä½¿ç”¨å®ƒã€‚

### FloatingWindowApp

ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®å®ç°äº†**FloatingWindowApp**ï¼Œå¯ä»¥æ”¾ç½®åœ¨å…¶ä»–æ´»åŠ¨çš„é¡¶éƒ¨ä»¥æ‰§è¡Œç‚¹å‡»åŠ«æŒæ”»å‡»ï¼Œå¯ä»¥åœ¨[**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp)ä¸­æ‰¾åˆ°ï¼ˆæœ‰ç‚¹è€ï¼Œç¥ä½ æ„å»ºapkå¥½è¿ï¼‰ã€‚

### Qark

{% hint style="danger" %}
çœ‹èµ·æ¥è¿™ä¸ªé¡¹ç›®ç°åœ¨æ²¡æœ‰ç»´æŠ¤äº†ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸å†æ­£å¸¸å·¥ä½œ
{% endhint %}

æ‚¨å¯ä»¥ä½¿ç”¨[**qark**](https://github.com/linkedin/qark)ä¸`--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk`å‚æ•°æ¥åˆ›å»ºä¸€ä¸ªæ¶æ„åº”ç”¨ç¨‹åºï¼Œä»¥æµ‹è¯•å¯èƒ½çš„**Tapjacking**æ¼æ´ã€‚

ç¼“è§£æªæ–½ç›¸å¯¹ç®€å•ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©åœ¨ä¸€ä¸ªè§†å›¾è¢«å¦ä¸€ä¸ªè§†å›¾è¦†ç›–æ—¶ä¸æ¥æ”¶è§¦æ‘¸äº‹ä»¶ã€‚ä½¿ç”¨[Androidå¼€å‘è€…å‚è€ƒ](https://developer.android.com/reference/android/view/View#security)ï¼š

> æœ‰æ—¶ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»èƒ½å¤ŸéªŒè¯ç”¨æˆ·å…¨çŸ¥å…¨æ„åœ°æ‰§è¡ŒæŸä¸ªæ“ä½œï¼Œä¾‹å¦‚æˆäºˆæƒé™è¯·æ±‚ã€è¿›è¡Œè´­ä¹°æˆ–ç‚¹å‡»å¹¿å‘Šã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ¶æ„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šè¯•å›¾æ¬ºéª—ç”¨æˆ·æ‰§è¡Œè¿™äº›æ“ä½œï¼Œè€Œç”¨æˆ·å´ä¸çŸ¥æƒ…ï¼Œé€šè¿‡éšè—è§†å›¾çš„é¢„æœŸç›®çš„ã€‚ä½œä¸ºè¡¥æ•‘æªæ–½ï¼Œæ¡†æ¶æä¾›äº†ä¸€ä¸ªè§¦æ‘¸è¿‡æ»¤æœºåˆ¶ï¼Œå¯ç”¨äºæé«˜æä¾›å¯¹æ•æ„ŸåŠŸèƒ½çš„è®¿é—®çš„è§†å›¾çš„å®‰å…¨æ€§ã€‚
>
> è¦å¯ç”¨è§¦æ‘¸è¿‡æ»¤ï¼Œè¯·è°ƒç”¨[`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29)æˆ–å°†android:filterTouchesWhenObscuredå¸ƒå±€å±æ€§è®¾ç½®ä¸ºtrueã€‚å¯ç”¨åï¼Œæ¡†æ¶å°†ä¸¢å¼ƒåœ¨è§†å›¾çš„çª—å£è¢«å¦ä¸€ä¸ªå¯è§çª—å£é®æŒ¡æ—¶æ¥æ”¶åˆ°çš„è§¦æ‘¸ã€‚å› æ­¤ï¼Œæ¯å½“toastã€å¯¹è¯æ¡†æˆ–å…¶ä»–çª—å£å‡ºç°åœ¨è§†å›¾çš„çª—å£ä¸Šæ–¹æ—¶ï¼Œè§†å›¾å°†ä¸ä¼šæ¥æ”¶è§¦æ‘¸ã€‚

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ä¸Šå…³æ³¨**æˆ‘ä»¬ã€‚
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
