# Tapjacking

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Podstawowe informacje**

**Tapjacking** to atak, w ktÃ³rym **zÅ‚oÅ›liwa** **aplikacja** jest uruchamiana i **pozycjonuje siÄ™ na wierzchu aplikacji ofiary**. Gdy zasÅ‚ania widocznie aplikacjÄ™ ofiary, jej interfejs uÅ¼ytkownika jest zaprojektowany w taki sposÃ³b, aby oszukaÄ‡ uÅ¼ytkownika do interakcji z niÄ…, podczas gdy przekazuje interakcjÄ™ do aplikacji ofiary.\
W rezultacie **oszukuje uÅ¼ytkownika, Å¼e wykonuje dziaÅ‚ania w aplikacji ofiary**.

### Wykrywanie

Aby wykryÄ‡ aplikacje podatne na ten atak, naleÅ¼y szukaÄ‡ **eksportowanych aktywnoÅ›ci** w manifeÅ›cie androida (zauwaÅ¼, Å¼e aktywnoÅ›Ä‡ z filtrem intencji jest automatycznie eksportowana domyÅ›lnie). Gdy juÅ¼ znajdziesz eksportowane aktywnoÅ›ci, **sprawdÅº, czy wymagajÄ… jakiegokolwiek uprawnienia**. Jest to dlatego, Å¼e **zÅ‚oÅ›liwa aplikacja bÄ™dzie rÃ³wnieÅ¼ potrzebowaÄ‡ tego uprawnienia**.

### Ochrona

#### Android 12 (API 31,32) i nowsze

[Zgodnie z tym ÅºrÃ³dÅ‚em](https://www.geeksforgeeks.org/tapjacking-in-android/), ataki tapjacking sÄ… automatycznie blokowane przez Androida od wersji 12 (API 31 i 30) i nowszych. Dlatego nawet jeÅ›li aplikacja jest podatna, **nie bÄ™dzie moÅ¼na jej wykorzystaÄ‡**.

#### `filterTouchesWhenObscured`

JeÅ›li **`android:filterTouchesWhenObscured`** jest ustawione na **`true`**, `View` nie bÄ™dzie otrzymywaÄ‡ dotkniÄ™Ä‡, gdy okno widoku jest zasÅ‚oniÄ™te przez inne widoczne okno.

#### **`setFilterTouchesWhenObscured`**

Atrybut **`setFilterTouchesWhenObscured`** ustawiony na true rÃ³wnieÅ¼ moÅ¼e zapobiec wykorzystaniu tej podatnoÅ›ci, jeÅ›li wersja Androida jest niÅ¼sza.\
JeÅ›li ustawione na **`true`**, na przykÅ‚ad przycisk moÅ¼e byÄ‡ automatycznie **wyÅ‚Ä…czony, jeÅ›li jest zasÅ‚oniÄ™ty**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Wykorzystanie

### Tapjacking-ExportedActivity

NajnowszÄ… aplikacjÄ™ na platformÄ™ Android wykonujÄ…cÄ… atak Tapjacking (+ wywoÅ‚ujÄ…cÄ… przed wyeksportowanÄ… aktywnoÅ›ciÄ… atakowanej aplikacji) moÅ¼na znaleÅºÄ‡ pod adresem: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

PostÄ™puj zgodnie z instrukcjami **README, aby z niej skorzystaÄ‡**.

### FloatingWindowApp

PrzykÅ‚adowy projekt implementujÄ…cy **FloatingWindowApp**, ktÃ³ry moÅ¼na uÅ¼yÄ‡ do umieszczenia na wierzchu innych aktywnoÅ›ci w celu przeprowadzenia ataku clickjacking, moÅ¼na znaleÅºÄ‡ pod adresem [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (trochÄ™ przestarzaÅ‚y, powodzenia z budowaniem pliku apk).

### Qark

{% hint style="danger" %}
WyglÄ…da na to, Å¼e ten projekt nie jest juÅ¼ rozwijany, a ta funkcjonalnoÅ›Ä‡ nie dziaÅ‚a poprawnie.
{% endhint %}

MoÅ¼esz uÅ¼yÄ‡ [**qark**](https://github.com/linkedin/qark) z parametrami `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` aby stworzyÄ‡ zÅ‚oÅ›liwÄ… aplikacjÄ™ do testowania potencjalnych podatnoÅ›ci na atak **Tapjacking**.

Åšrodki zaradcze sÄ… stosunkowo proste, poniewaÅ¼ deweloper moÅ¼e zdecydowaÄ‡, Å¼e widok nie bÄ™dzie otrzymywaÅ‚ zdarzeÅ„ dotyku, gdy jest zasÅ‚oniÄ™ty przez inny. KorzystajÄ…c z [Android Developerâ€™s Reference](https://developer.android.com/reference/android/view/View#security):

> Czasami istotne jest, aby aplikacja mogÅ‚a zweryfikowaÄ‡, czy dziaÅ‚anie jest wykonywane z peÅ‚nÄ… wiedzÄ… i zgodÄ… uÅ¼ytkownika, na przykÅ‚ad przy udzielaniu Å¼Ä…dania uprawnienia, dokonywaniu zakupu lub klikniÄ™ciu w reklamÄ™. Niestety zÅ‚oÅ›liwa aplikacja mogÅ‚aby prÃ³bowaÄ‡ oszukaÄ‡ uÅ¼ytkownika, aby wykonaÅ‚ te dziaÅ‚ania, nieÅ›wiadomy, ukrywajÄ…c zamierzony cel widoku. Jako Å›rodek zaradczy, framework oferuje mechanizm filtrowania dotyku, ktÃ³ry moÅ¼na uÅ¼yÄ‡ do poprawy bezpieczeÅ„stwa widokÃ³w zapewniajÄ…cych dostÄ™p do funkcji wymagajÄ…cych poufnoÅ›ci.
>
> Aby wÅ‚Ä…czyÄ‡ filtrowanie dotyku, naleÅ¼y wywoÅ‚aÄ‡ [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) lub ustawiÄ‡ atrybut ukÅ‚adu android:filterTouchesWhenObscured na true. Po wÅ‚Ä…czeniu framework odrzuci dotkniÄ™cia, ktÃ³re sÄ… odbierane, gdy okno widoku jest zasÅ‚oniÄ™te przez inne widoczne okno. W rezultacie widok nie bÄ™dzie otrzymywaÅ‚ dotkniÄ™Ä‡, gdy pojawi siÄ™ toast, okno dialogowe lub inne okno nad oknem widoku.

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}
