# Tapjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Temel Bilgiler**

**Tapjacking**, **kÃ¶tÃ¼ niyetli** bir **uygulamanÄ±n** baÅŸlatÄ±ldÄ±ÄŸÄ± ve **bir kurban uygulamanÄ±n Ã¼zerine yerleÅŸtiÄŸi** bir saldÄ±rÄ±dÄ±r. Kurban uygulamayÄ± gÃ¶rÃ¼nÃ¼r bir ÅŸekilde gizlediÄŸinde, kullanÄ±cÄ± arayÃ¼zÃ¼, kullanÄ±cÄ±nÄ±n onunla etkileÅŸimde bulunmasÄ±nÄ± saÄŸlamak iÃ§in tasarlanmÄ±ÅŸtÄ±r, bu sÄ±rada etkileÅŸim kurban uygulamaya iletilmektedir.\
SonuÃ§ olarak, bu durum **kullanÄ±cÄ±nÄ±n aslÄ±nda kurban uygulamasÄ±nda eylem gerÃ§ekleÅŸtirdiÄŸini bilmesini engellemektedir**.

### Tespit

Bu saldÄ±rÄ±ya karÅŸÄ± savunmasÄ±z uygulamalarÄ± tespit etmek iÃ§in, android manifestinde **dÄ±ÅŸa aktarÄ±lan aktiviteleri** aramalÄ±sÄ±nÄ±z (bir intent-filter ile bir aktivitenin varsayÄ±lan olarak otomatik olarak dÄ±ÅŸa aktarÄ±ldÄ±ÄŸÄ±nÄ± unutmayÄ±n). DÄ±ÅŸa aktarÄ±lan aktiviteleri bulduktan sonra, **herhangi bir izin gerektirip gerektirmediÄŸini kontrol edin**. Bunun nedeni, **kÃ¶tÃ¼ niyetli uygulamanÄ±n da o izne ihtiyaÃ§ duymasÄ±dÄ±r**.

### Koruma

#### Android 12 (API 31,32) ve Ã¼zeri

[**Bu kaynaÄŸa gÃ¶re**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** tapjacking saldÄ±rÄ±larÄ± Android 12 (API 31 & 30) ve Ã¼zeri sÃ¼rÃ¼mlerde otomatik olarak engellenmektedir. Yani, uygulama savunmasÄ±z olsa bile **onu istismar edemeyeceksiniz**.

#### `filterTouchesWhenObscured`

EÄŸer **`android:filterTouchesWhenObscured`** **`true`** olarak ayarlandÄ±ysa, `View`, gÃ¶rÃ¼nÃ¼mÃ¼n penceresi baÅŸka bir gÃ¶rÃ¼nÃ¼r pencere tarafÄ±ndan gizlendiÄŸinde dokunuÅŸlarÄ± almayacaktÄ±r.

#### **`setFilterTouchesWhenObscured`**

**`setFilterTouchesWhenObscured`** Ã¶zelliÄŸi true olarak ayarlandÄ±ÄŸÄ±nda, Android sÃ¼rÃ¼mÃ¼ daha dÃ¼ÅŸÃ¼kse bu zafiyetin istismarÄ±nÄ± da engelleyebilir.\
Ã–rneÄŸin, **`true`** olarak ayarlandÄ±ÄŸÄ±nda, bir buton otomatik olarak **gizlendiÄŸinde devre dÄ±ÅŸÄ± bÄ±rakÄ±labilir**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Exploitation

### Tapjacking-ExportedActivity

En **son Android uygulamasÄ±** olan Tapjacking saldÄ±rÄ±sÄ±nÄ± gerÃ§ekleÅŸtiren (+ saldÄ±rÄ±ya uÄŸrayan uygulamanÄ±n dÄ±ÅŸa aktarÄ±lan bir aktivitesinden Ã¶nce Ã§aÄŸÄ±rma) bulmak iÃ§in: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

**Kullanmak iÃ§in README talimatlarÄ±nÄ± takip edin**.

### FloatingWindowApp

**FloatingWindowApp**'i uygulayan bir Ã¶rnek proje, tÄ±klama saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirmek iÃ§in diÄŸer aktivitelerin Ã¼zerine yerleÅŸtirilebilecek bir proje [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) iÃ§inde bulunabilir (biraz eski, apk oluÅŸturma konusunda iyi ÅŸanslar).

### Qark

{% hint style="danger" %}
Bu projenin artÄ±k bakÄ±msÄ±z olduÄŸu ve bu iÅŸlevselliÄŸin dÃ¼zgÃ¼n Ã§alÄ±ÅŸmadÄ±ÄŸÄ± gÃ¶rÃ¼nÃ¼yor
{% endhint %}

OlasÄ± **Tapjacking** zafiyetlerini test etmek iÃ§in kÃ¶tÃ¼ niyetli bir uygulama oluÅŸturmak Ã¼zere `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` parametreleri ile [**qark**](https://github.com/linkedin/qark) kullanabilirsiniz.\

ZayÄ±flatma oldukÃ§a basittir, Ã§Ã¼nkÃ¼ geliÅŸtirici bir gÃ¶rÃ¼nÃ¼m baÅŸka bir gÃ¶rÃ¼nÃ¼m tarafÄ±ndan kaplandÄ±ÄŸÄ±nda dokunma olaylarÄ±nÄ± almamayÄ± seÃ§ebilir. [Android GeliÅŸtirici ReferansÄ±](https://developer.android.com/reference/android/view/View#security) kullanarak:

> Bazen bir uygulamanÄ±n, bir izin isteÄŸi verme, bir satÄ±n alma yapma veya bir reklama tÄ±klama gibi bir eylemin kullanÄ±cÄ±nÄ±n tam bilgisi ve rÄ±zasÄ±yla gerÃ§ekleÅŸtirildiÄŸini doÄŸrulamasÄ± Ã¶nemlidir. Ne yazÄ±k ki, kÃ¶tÃ¼ niyetli bir uygulama, gÃ¶rÃ¼nÃ¼mÃ¼n amaÃ§lanan amacÄ±nÄ± gizleyerek kullanÄ±cÄ±nÄ±n bu eylemleri bilmeden gerÃ§ekleÅŸtirmesini saÄŸlamaya Ã§alÄ±ÅŸabilir. Bir Ã§Ã¶zÃ¼m olarak, Ã§erÃ§eve, hassas iÅŸlevselliÄŸe eriÅŸim saÄŸlayan gÃ¶rÃ¼nÃ¼mlerin gÃ¼venliÄŸini artÄ±rmak iÃ§in kullanÄ±labilecek bir dokunma filtreleme mekanizmasÄ± sunar.
>
> Dokunma filtrelemeyi etkinleÅŸtirmek iÃ§in [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) Ã§aÄŸrÄ±sÄ±nÄ± yapÄ±n veya android:filterTouchesWhenObscured dÃ¼zenleme Ã¶zniteliÄŸini true olarak ayarlayÄ±n. EtkinleÅŸtirildiÄŸinde, Ã§erÃ§eve, gÃ¶rÃ¼nÃ¼mÃ¼n penceresi baÅŸka bir gÃ¶rÃ¼nÃ¼r pencere tarafÄ±ndan kaplandÄ±ÄŸÄ±nda alÄ±nan dokunmalarÄ± atlayacaktÄ±r. SonuÃ§ olarak, bir toast, diyalog veya baÅŸka bir pencere gÃ¶rÃ¼nÃ¼mÃ¼n penceresinin Ã¼zerinde belirdiÄŸinde gÃ¶rÃ¼nÃ¼m dokunmalarÄ± almayacaktÄ±r.

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
