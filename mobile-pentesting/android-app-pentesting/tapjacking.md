# Tapjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Basic Information**

**Tapjacking**ëŠ” **ì•…ì˜ì ì¸** **ì• í”Œë¦¬ì¼€ì´ì…˜**ì´ ì‹¤í–‰ë˜ì–´ **í¬ìƒ ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ„ì— ìœ„ì¹˜í•˜ëŠ” ê³µê²©**ì…ë‹ˆë‹¤. í¬ìƒ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°€ì‹œì ìœ¼ë¡œ ê°€ë¦¬ë©´, ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ëŠ” ì‚¬ìš©ìê°€ ìƒí˜¸ì‘ìš©í•˜ë„ë¡ ì†ì´ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆìœ¼ë©°, ì´ ìƒí˜¸ì‘ìš©ì€ í¬ìƒ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.\
ê²°ê³¼ì ìœ¼ë¡œ, ì´ëŠ” **ì‚¬ìš©ìê°€ ì‹¤ì œë¡œ í¬ìƒ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ ì•Œì§€ ëª»í•˜ê²Œ í•©ë‹ˆë‹¤**.

### Detection

ì´ ê³µê²©ì— ì·¨ì•½í•œ ì•±ì„ íƒì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ì•ˆë“œë¡œì´ë“œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì—ì„œ **ë‚´ë³´ë‚´ì§„ í™œë™**ì„ ê²€ìƒ‰í•´ì•¼ í•©ë‹ˆë‹¤ (intent-filterê°€ ìˆëŠ” í™œë™ì€ ê¸°ë³¸ì ìœ¼ë¡œ ìë™ìœ¼ë¡œ ë‚´ë³´ë‚´ì§‘ë‹ˆë‹¤). ë‚´ë³´ë‚´ì§„ í™œë™ì„ ì°¾ì€ í›„, **ê¶Œí•œì´ í•„ìš”í•œì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤**. ì´ëŠ” **ì•…ì˜ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ë„ í•´ë‹¹ ê¶Œí•œì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤**.

### Protection

#### Android 12 (API 31,32) ë° ê·¸ ì´ìƒ

[**ì´ ì¶œì²˜ì— ë”°ë¥´ë©´**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** Android 12 (API 31 & 30) ì´ìƒì—ì„œëŠ” tapjacking ê³µê²©ì´ ìë™ìœ¼ë¡œ ë°©ì§€ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì·¨ì•½í•˜ë”ë¼ë„ **ì•…ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**.

#### `filterTouchesWhenObscured`

**`android:filterTouchesWhenObscured`**ê°€ **`true`**ë¡œ ì„¤ì •ë˜ë©´, `View`ëŠ” ë‹¤ë¥¸ ê°€ì‹œì ì¸ ì°½ì— ì˜í•´ ì°½ì´ ê°€ë ¤ì§ˆ ë•Œ í„°ì¹˜ë¥¼ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤.

#### **`setFilterTouchesWhenObscured`**

**`setFilterTouchesWhenObscured`** ì†ì„±ì´ trueë¡œ ì„¤ì •ë˜ë©´, ì•ˆë“œë¡œì´ë“œ ë²„ì „ì´ ë‚®ë”ë¼ë„ ì´ ì·¨ì•½ì ì˜ ì•…ìš©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì˜ˆë¥¼ ë“¤ì–´, **`true`**ë¡œ ì„¤ì •í•˜ë©´ ë²„íŠ¼ì´ ê°€ë ¤ì§ˆ ê²½ìš° ìë™ìœ¼ë¡œ **ë¹„í™œì„±í™”**ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Exploitation

### Tapjacking-ExportedActivity

ê°€ì¥ **ìµœê·¼ì˜ Android ì• í”Œë¦¬ì¼€ì´ì…˜**ìœ¼ë¡œ Tapjacking ê³µê²©ì„ ìˆ˜í–‰í•˜ëŠ” (+ ê³µê²©ë°›ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë‚´ë³´ë‚¸ í™œë™ ì´ì „ì— í˜¸ì¶œ) ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë‹¤ìŒì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

**README ì§€ì¹¨ì— ë”°ë¼ ì‚¬ìš©í•˜ì„¸ìš”**.

### FloatingWindowApp

í´ë¦­ì¬í‚¹ ê³µê²©ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ë‹¤ë¥¸ í™œë™ ìœ„ì— ì˜¬ë¦´ ìˆ˜ ìˆëŠ” **FloatingWindowApp**ì„ êµ¬í˜„í•œ ì˜ˆì œ í”„ë¡œì íŠ¸ëŠ” [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì¡°ê¸ˆ ì˜¤ë˜ëœ í”„ë¡œì íŠ¸ë¡œ, apk ë¹Œë“œì— í–‰ìš´ì„ ë¹•ë‹ˆë‹¤).

### Qark

{% hint style="danger" %}
ì´ í”„ë¡œì íŠ¸ëŠ” í˜„ì¬ ìœ ì§€ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ìœ¼ë©° ì´ ê¸°ëŠ¥ì´ ë” ì´ìƒ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
{% endhint %}

`--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` ë§¤ê°œë³€ìˆ˜ì™€ í•¨ê»˜ [**qark**](https://github.com/linkedin/qark)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ëŠ¥í•œ **Tapjacking** ì·¨ì•½ì ì„ í…ŒìŠ¤íŠ¸í•  ì•…ì„± ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\

ì™„í™” ë°©ë²•ì€ ìƒëŒ€ì ìœ¼ë¡œ ê°„ë‹¨í•©ë‹ˆë‹¤. ê°œë°œìëŠ” ë‹¤ë¥¸ ë·°ì— ì˜í•´ ê°€ë ¤ì§ˆ ë•Œ í„°ì¹˜ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ì§€ ì•Šë„ë¡ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [Android ê°œë°œì ì°¸ì¡°](https://developer.android.com/reference/android/view/View#security)ë¥¼ ì‚¬ìš©í•˜ì—¬:

> ë•Œë•Œë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©ìì˜ ì™„ì „í•œ ì§€ì‹ê³¼ ë™ì˜ í•˜ì— ì‘ì—…ì´ ìˆ˜í–‰ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê¶Œí•œ ìš”ì²­ì„ ìŠ¹ì¸í•˜ê±°ë‚˜, êµ¬ë§¤ë¥¼ í•˜ê±°ë‚˜, ê´‘ê³ ë¥¼ í´ë¦­í•˜ëŠ” ê²½ìš°ì…ë‹ˆë‹¤. ë¶ˆí–‰íˆë„, ì•…ì˜ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì‚¬ìš©ìê°€ ì˜ë„ëœ ëª©ì ì„ ì•Œì§€ ëª»í•œ ì±„ ì´ëŸ¬í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë„ë¡ ì†ì´ë ¤ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í”„ë ˆì„ì›Œí¬ëŠ” ë¯¼ê°í•œ ê¸°ëŠ¥ì— ëŒ€í•œ ì ‘ê·¼ì„ ê°œì„ í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í„°ì¹˜ í•„í„°ë§ ë©”ì»¤ë‹ˆì¦˜ì„ ì œê³µí•©ë‹ˆë‹¤.
>
> í„°ì¹˜ í•„í„°ë§ì„ í™œì„±í™”í•˜ë ¤ë©´ [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29)ë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜ android:filterTouchesWhenObscured ë ˆì´ì•„ì›ƒ ì†ì„±ì„ trueë¡œ ì„¤ì •í•©ë‹ˆë‹¤. í™œì„±í™”ë˜ë©´ í”„ë ˆì„ì›Œí¬ëŠ” ë·°ì˜ ì°½ì´ ë‹¤ë¥¸ ë³´ì´ëŠ” ì°½ì— ì˜í•´ ê°€ë ¤ì§ˆ ë•Œ ìˆ˜ì‹ ëœ í„°ì¹˜ë¥¼ ë¬´ì‹œí•©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ, ë·°ì˜ ì°½ ìœ„ì— í† ìŠ¤íŠ¸, ëŒ€í™”ìƒì ë˜ëŠ” ë‹¤ë¥¸ ì°½ì´ ë‚˜íƒ€ë‚  ë•Œ ë·°ëŠ” í„°ì¹˜ë¥¼ ìˆ˜ì‹ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
