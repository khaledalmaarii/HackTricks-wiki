# Tapjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Basic Information**

**Tapjacking** est une attaque o√π une **application malveillante** est lanc√©e et **se positionne au-dessus d'une application victime**. Une fois qu'elle obscurcit visiblement l'application victime, son interface utilisateur est con√ßue de mani√®re √† tromper l'utilisateur pour qu'il interagisse avec elle, tout en transmettant l'interaction √† l'application victime.\
En effet, cela **aveugle l'utilisateur sur le fait qu'il effectue r√©ellement des actions sur l'application victime**.

### Detection

Pour d√©tecter les applications vuln√©rables √† cette attaque, vous devez rechercher des **activit√©s export√©es** dans le manifeste android (notez qu'une activit√© avec un intent-filter est automatiquement export√©e par d√©faut). Une fois que vous avez trouv√© les activit√©s export√©es, **v√©rifiez si elles n√©cessitent une autorisation**. Cela est d√ª au fait que **l'application malveillante aura √©galement besoin de cette autorisation**.

### Protection

#### Android 12 (API 31,32) et sup√©rieur

[**Selon cette source**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** les attaques de tapjacking sont automatiquement pr√©venues par Android √† partir d'Android 12 (API 31 & 30) et sup√©rieur. Donc, m√™me si l'application est vuln√©rable, vous **ne pourrez pas l'exploiter**.

#### `filterTouchesWhenObscured`

Si **`android:filterTouchesWhenObscured`** est d√©fini sur **`true`**, la `View` ne recevra pas de touches chaque fois que la fen√™tre de la vue est obscurcie par une autre fen√™tre visible.

#### **`setFilterTouchesWhenObscured`**

L'attribut **`setFilterTouchesWhenObscured`** d√©fini sur true peut √©galement emp√™cher l'exploitation de cette vuln√©rabilit√© si la version d'Android est inf√©rieure.\
S'il est d√©fini sur **`true`**, par exemple, un bouton peut √™tre automatiquement **d√©sactiv√© s'il est obscurci**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Exploitation

### Tapjacking-ExportedActivity

La **derni√®re application Android** effectuant une attaque Tapjacking (+ invocation avant une activit√© export√©e de l'application attaqu√©e) peut √™tre trouv√©e ici : [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

Suivez les **instructions du README pour l'utiliser**.

### FloatingWindowApp

Un projet d'exemple impl√©mentant **FloatingWindowApp**, qui peut √™tre utilis√© pour se superposer √† d'autres activit√©s afin d'effectuer une attaque clickjacking, peut √™tre trouv√© dans [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (un peu ancien, bonne chance pour construire l'apk).

### Qark

{% hint style="danger" %}
Il semble que ce projet ne soit plus maintenu et que cette fonctionnalit√© ne fonctionne plus correctement.
{% endhint %}

Vous pouvez utiliser [**qark**](https://github.com/linkedin/qark) avec les param√®tres `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` pour cr√©er une application malveillante afin de tester les √©ventuelles vuln√©rabilit√©s **Tapjacking**.\

L'att√©nuation est relativement simple car le d√©veloppeur peut choisir de ne pas recevoir d'√©v√©nements tactiles lorsqu'une vue est recouverte par une autre. En utilisant la [R√©f√©rence des d√©veloppeurs Android](https://developer.android.com/reference/android/view/View#security) :

> Parfois, il est essentiel qu'une application puisse v√©rifier qu'une action est effectu√©e avec la pleine connaissance et le consentement de l'utilisateur, comme accorder une demande de permission, effectuer un achat ou cliquer sur une publicit√©. Malheureusement, une application malveillante pourrait essayer de tromper l'utilisateur pour qu'il effectue ces actions, √† son insu, en dissimulant le but pr√©vu de la vue. En guise de rem√®de, le framework offre un m√©canisme de filtrage des touches qui peut √™tre utilis√© pour am√©liorer la s√©curit√© des vues qui fournissent un acc√®s √† des fonctionnalit√©s sensibles.
>
> Pour activer le filtrage des touches, appelez [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) ou d√©finissez l'attribut de mise en page android:filterTouchesWhenObscured sur true. Lorsqu'il est activ√©, le framework rejettera les touches re√ßues chaque fois que la fen√™tre de la vue est obscurcie par une autre fen√™tre visible. En cons√©quence, la vue ne recevra pas de touches chaque fois qu'un toast, un dialogue ou une autre fen√™tre appara√Æt au-dessus de la fen√™tre de la vue.

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
