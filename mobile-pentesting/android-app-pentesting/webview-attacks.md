# Webview SaldÄ±rÄ±larÄ±

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± Ekip UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± Ekip UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Bize katÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi** **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## WebView YapÄ±landÄ±rmalarÄ± ve GÃ¼venlik Rehberi

### WebView AÃ§Ä±klarÄ±nÄ±n Genel GÃ¶rÃ¼nÃ¼mÃ¼

Android geliÅŸtirmesinin kritik bir yÃ¶nÃ¼, WebView'larÄ±n doÄŸru bir ÅŸekilde yÃ¶netilmesidir. Bu rehber, WebView kullanÄ±mÄ±na iliÅŸkin riskleri azaltmak iÃ§in ana yapÄ±landÄ±rmalarÄ± ve gÃ¼venlik uygulamalarÄ±nÄ± vurgulamaktadÄ±r.

![WebView Ã–rneÄŸi](<../../.gitbook/assets/image (1190).png>)

### **WebView'larda Dosya EriÅŸimi**

VarsayÄ±lan olarak, WebView'lar dosya eriÅŸimine izin verir. Bu iÅŸlevsellik, Android API seviyesi 3 (Cupcake 1.5) itibarÄ±yla mevcut olan `setAllowFileAccess()` metodu ile kontrol edilir. **android.permission.READ\_EXTERNAL\_STORAGE** iznine sahip uygulamalar, dÄ±ÅŸ depolamadan dosyalarÄ± dosya URL ÅŸemasÄ± (`file://path/to/file`) kullanarak okuyabilir.

#### **KaldÄ±rÄ±lan Ã–zellikler: Evrensel ve URL'lerden Dosya EriÅŸimi**

* **Dosya URL'lerinden Evrensel EriÅŸim**: Bu kaldÄ±rÄ±lan Ã¶zellik, dosya URL'lerinden Ã§apraz kÃ¶kenli istekleri mÃ¼mkÃ¼n kÄ±lmakta olup, potansiyel XSS saldÄ±rÄ±larÄ± nedeniyle Ã¶nemli bir gÃ¼venlik riski taÅŸÄ±maktadÄ±r. VarsayÄ±lan ayar, Android Jelly Bean ve daha yeni sÃ¼rÃ¼mler iÃ§in devre dÄ±ÅŸÄ±dÄ±r (`false`).
* Bu ayarÄ± kontrol etmek iÃ§in `getAllowUniversalAccessFromFileURLs()` kullanÄ±n.
* Bu ayarÄ± deÄŸiÅŸtirmek iÃ§in `setAllowUniversalAccessFromFileURLs(boolean)` kullanÄ±n.
* **Dosya URL'lerinden Dosya EriÅŸimi**: Bu Ã¶zellik de kaldÄ±rÄ±lmÄ±ÅŸtÄ±r ve diÄŸer dosya ÅŸemasÄ± URL'lerinden iÃ§erik eriÅŸimini kontrol etmiÅŸtir. Evrensel eriÅŸimde olduÄŸu gibi, varsayÄ±lan ayarÄ± gÃ¼venliÄŸi artÄ±rmak iÃ§in devre dÄ±ÅŸÄ±dÄ±r.
* Kontrol etmek iÃ§in `getAllowFileAccessFromFileURLs()` ve ayarlamak iÃ§in `setAllowFileAccessFromFileURLs(boolean)` kullanÄ±n.

#### **GÃ¼venli Dosya YÃ¼kleme**

VarlÄ±klara ve kaynaklara eriÅŸirken dosya sistemi eriÅŸimini devre dÄ±ÅŸÄ± bÄ±rakmak iÃ§in `setAllowFileAccess()` metodu kullanÄ±lÄ±r. Android R ve Ã¼zeri sÃ¼rÃ¼mlerde varsayÄ±lan ayar `false`'dÄ±r.

* `getAllowFileAccess()` ile kontrol edin.
* `setAllowFileAccess(boolean)` ile etkinleÅŸtirin veya devre dÄ±ÅŸÄ± bÄ±rakÄ±n.

#### **WebViewAssetLoader**

**WebViewAssetLoader** sÄ±nÄ±fÄ±, yerel dosyalarÄ± yÃ¼klemek iÃ§in modern bir yaklaÅŸÄ±mdÄ±r. Yerel varlÄ±klara ve kaynaklara eriÅŸmek iÃ§in http(s) URL'leri kullanÄ±r ve AynÄ±-KÃ¶ken politikasÄ± ile uyumlu olup CORS yÃ¶netimini kolaylaÅŸtÄ±rÄ±r.

### loadUrl

Bu, bir webview'de rastgele URL'leri yÃ¼klemek iÃ§in kullanÄ±lan yaygÄ±n bir iÅŸlevdir:
```java
webview.loadUrl("<url here>")
```
Ofc, potansiyel bir saldÄ±rganÄ±n bir uygulamanÄ±n yÃ¼kleyeceÄŸi **URL'yi** asla kontrol edememesi gerekir.

### **JavaScript ve Intent ÅemasÄ± YÃ¶netimi**

* **JavaScript**: WebView'larda varsayÄ±lan olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸtÄ±r, `setJavaScriptEnabled()` ile etkinleÅŸtirilebilir. JavaScript'i uygun korumalar olmadan etkinleÅŸtirmenin gÃ¼venlik aÃ§Ä±klarÄ± oluÅŸturabileceÄŸi iÃ§in dikkatli olunmalÄ±dÄ±r.
* **Intent ÅemasÄ±**: WebView'lar `intent` ÅŸemasÄ±nÄ± iÅŸleyebilir, dikkatli yÃ¶netilmezse istismar durumlarÄ±na yol aÃ§abilir. Bir Ã¶rnek gÃ¼venlik aÃ§Ä±ÄŸÄ±, Ã§apraz site betikleme (XSS) saldÄ±rÄ±larÄ±nÄ± gerÃ§ekleÅŸtirmek iÃ§in istismar edilebilecek "support\_url" adlÄ± bir WebView parametresinin aÃ§Ä±ÄŸa Ã§Ä±kmasÄ±yla ilgiliydi.

![Vulnerable WebView](<../../.gitbook/assets/image (1191).png>)

adb kullanarak istismar Ã¶rneÄŸi:

{% code overflow="wrap" %}
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView â€“es support_url "https://example.com/xss.html"
```
{% endcode %}

### Javascript KÃ¶prÃ¼sÃ¼

Android, **JavaScript**'in bir WebView iÃ§inde **yerel Android uygulama fonksiyonlarÄ±nÄ±** Ã§aÄŸÄ±rmasÄ±nÄ± saÄŸlayan bir Ã¶zellik sunar. Bu, JavaScript'i yerel Android iÅŸlevleriyle entegre eden `addJavascriptInterface` yÃ¶nteminin kullanÄ±lmasÄ±yla gerÃ§ekleÅŸtirilir ve buna _WebView JavaScript kÃ¶prÃ¼sÃ¼_ denir. Dikkatli olunmasÄ± Ã¶nerilir Ã§Ã¼nkÃ¼ bu yÃ¶ntem, WebView iÃ§indeki tÃ¼m sayfalarÄ±n kayÄ±tlÄ± JavaScript ArayÃ¼z nesnesine eriÅŸmesine izin verir ve bu arayÃ¼zler aracÄ±lÄ±ÄŸÄ±yla hassas bilgilerin ifÅŸa edilmesi durumunda bir gÃ¼venlik riski oluÅŸturur.

* **AÅŸÄ±rÄ± dikkat gereklidir** Ã§Ã¼nkÃ¼ 4.2'nin altÄ±ndaki Android sÃ¼rÃ¼mlerini hedefleyen uygulamalar iÃ§in kÃ¶tÃ¼ niyetli JavaScript aracÄ±lÄ±ÄŸÄ±yla uzaktan kod yÃ¼rÃ¼tme olanaÄŸÄ± saÄŸlayan bir zafiyet bulunmaktadÄ±r.

#### JavaScript KÃ¶prÃ¼sÃ¼ UygulamasÄ±

* **JavaScript arayÃ¼zleri**, bir sÄ±nÄ±f yÃ¶nteminin JavaScript'e aÃ§Ä±ldÄ±ÄŸÄ± Ã¶rneklerde gÃ¶sterildiÄŸi gibi, yerel kodla etkileÅŸimde bulunabilir:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
* JavaScript KÃ¶prÃ¼sÃ¼, WebView'a bir arayÃ¼z ekleyerek etkinleÅŸtirilir:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
* JavaScript aracÄ±lÄ±ÄŸÄ±yla potansiyel istismar, Ã¶rneÄŸin, bir XSS saldÄ±rÄ±sÄ± yoluyla, aÃ§Ä±ÄŸa Ã§Ä±karÄ±lmÄ±ÅŸ Java yÃ¶ntemlerinin Ã§aÄŸrÄ±lmasÄ±nÄ± saÄŸlar:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
* Riskleri azaltmak iÃ§in, **JavaScript kÃ¶prÃ¼ kullanÄ±mÄ±nÄ±** APK ile gÃ¶nderilen kodla sÄ±nÄ±rlayÄ±n ve uzaktan kaynaklardan JavaScript yÃ¼klenmesini engelleyin. Eski cihazlar iÃ§in minimum API seviyesini 17 olarak ayarlayÄ±n.

### YansÄ±ma TabanlÄ± Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma (RCE)

* Belirli bir yÃ¼kÃ¼ Ã§alÄ±ÅŸtÄ±rarak RCE elde etmeyi saÄŸlayan belgelenmiÅŸ bir yÃ¶ntem vardÄ±r. Ancak, `@JavascriptInterface` notasyonu yetkisiz yÃ¶ntem eriÅŸimini engelleyerek saldÄ±rÄ± yÃ¼zeyini sÄ±nÄ±rlar.

### Uzaktan Hata AyÄ±klama

* **Uzaktan hata ayÄ±klama**, **Chrome GeliÅŸtirici AraÃ§larÄ±** ile mÃ¼mkÃ¼ndÃ¼r ve WebView iÃ§eriÄŸinde etkileÅŸim ve keyfi JavaScript Ã§alÄ±ÅŸtÄ±rma imkanÄ± saÄŸlar.

#### Uzaktan Hata AyÄ±klamayÄ± EtkinleÅŸtirme

* Uzaktan hata ayÄ±klama, bir uygulama iÃ§indeki tÃ¼m WebView'lar iÃ§in etkinleÅŸtirilebilir:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
* UygulamanÄ±n hata ayÄ±klanabilir durumuna baÄŸlÄ± olarak hata ayÄ±klamayÄ± koÅŸullu olarak etkinleÅŸtirmek iÃ§in:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Rastgele dosyalarÄ± dÄ±ÅŸarÄ± aktarma

* XMLHttpRequest kullanarak rastgele dosyalarÄ±n dÄ±ÅŸarÄ± aktarÄ±mÄ±nÄ± gÃ¶sterir:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Referanslar

* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)
* [https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1](https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1)
* [https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I](https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± Ekip UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± Ekip UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
