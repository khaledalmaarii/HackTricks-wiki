# Webview Attacks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Przewodnik po konfiguracjach WebView i bezpieczestwie

### Przegld podatnoci WebView

Krytycznym aspektem rozwoju aplikacji na Androida jest prawidowe zarzdzanie WebView. Ten przewodnik podkrela kluczowe konfiguracje i praktyki bezpieczestwa, aby zminimalizowa ryzyko zwizane z u偶ywaniem WebView.

![WebView Example](<../../.gitbook/assets/image (1190).png>)

### **Dostp do plik贸w w WebView**

Domylnie WebView zezwala na dostp do plik贸w. Ta funkcjonalno jest kontrolowana przez metod `setAllowFileAccess()`, dostpn od poziomu API Androida 3 (Cupcake 1.5). Aplikacje z uprawnieniem **android.permission.READ\_EXTERNAL\_STORAGE** mog odczytywa pliki z pamici zewntrznej, u偶ywajc schematu URL pliku (`file://path/to/file`).

#### **Wycofane funkcje: Uniwersalny dostp i dostp do plik贸w z URL**

* **Uniwersalny dostp z URL plik贸w**: Ta wycofana funkcja pozwalaa na 偶dania midzy 藕r贸dami z URL plik贸w, co stanowio istotne ryzyko bezpieczestwa z powodu potencjalnych atak贸w XSS. Domylne ustawienie jest wyczone (`false`) dla aplikacji celujcych w Android Jelly Bean i nowsze.
* Aby sprawdzi to ustawienie, u偶yj `getAllowUniversalAccessFromFileURLs()`.
* Aby zmodyfikowa to ustawienie, u偶yj `setAllowUniversalAccessFromFileURLs(boolean)`.
* **Dostp do plik贸w z URL plik贸w**: Ta funkcja, r贸wnie偶 wycofana, kontrolowaa dostp do treci z innych URL schematu pliku. Podobnie jak uniwersalny dostp, jej domylne ustawienie jest wyczone dla zwikszenia bezpieczestwa.
* U偶yj `getAllowFileAccessFromFileURLs()` do sprawdzenia i `setAllowFileAccessFromFileURLs(boolean)` do ustawienia.

#### **Bezpieczne adowanie plik贸w**

Aby wyczy dostp do systemu plik贸w, jednoczenie uzyskujc dostp do zasob贸w i aktyw贸w, u偶ywa si metody `setAllowFileAccess()`. W przypadku Androida R i nowszych domylne ustawienie to `false`.

* Sprawd藕 za pomoc `getAllowFileAccess()`.
* Wcz lub wycz za pomoc `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

Klasa **WebViewAssetLoader** to nowoczesne podejcie do adowania lokalnych plik贸w. U偶ywa URL http(s) do uzyskiwania dostpu do lokalnych zasob贸w i aktyw贸w, zgodnie z zasad tej samej lokalizacji, co uatwia zarzdzanie CORS.

### loadUrl

To powszechna funkcja u偶ywana do adowania dowolnych URL w webview:
```java
webview.loadUrl("<url here>")
```
Ofc, potencjalny atakujcy nigdy nie powinien mie mo偶liwoci **kontrolowania URL**, kt贸ry aplikacja ma zaadowa.

### **Obsuga JavaScript i schematu Intent**

* **JavaScript**: Domylnie wyczony w WebView, mo偶na go wczy za pomoc `setJavaScriptEnabled()`. Nale偶y zachowa ostro偶no, poniewa偶 wczenie JavaScript bez odpowiednich zabezpiecze mo偶e wprowadzi luki w zabezpieczeniach.
* **Schemat Intent**: WebView mo偶e obsugiwa schemat `intent`, co mo偶e prowadzi do exploit贸w, jeli nie jest starannie zarzdzane. Przykadowa luka polegaa na ujawnionym parametrze WebView "support\_url", kt贸ry m贸g by wykorzystany do przeprowadzenia atak贸w cross-site scripting (XSS).

![Vulnerable WebView](<../../.gitbook/assets/image (1191).png>)

Przykad eksploatacji przy u偶yciu adb:

{% code overflow="wrap" %}
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView es support_url "https://example.com/xss.html"
```
{% endcode %}

### Mostek JavaScript

Funkcja ta jest dostarczana przez Androida, kt贸ra umo偶liwia **JavaScript** w WebView wywoywanie **funkcji natywnych aplikacji Android**. Osiga si to poprzez wykorzystanie metody `addJavascriptInterface`, kt贸ra integruje JavaScript z natywnymi funkcjonalnociami Androida, okrelan jako _mostek JavaScript WebView_. Nale偶y zachowa ostro偶no, poniewa偶 ta metoda pozwala wszystkim stronom w WebView na dostp do zarejestrowanego obiektu Interfejsu JavaScript, co stanowi ryzyko bezpieczestwa, jeli wra偶liwe informacje s ujawniane przez te interfejsy.

* **Wymagana jest ekstremalna ostro偶no** dla aplikacji celujcych w wersje Androida poni偶ej 4.2 z powodu luki umo偶liwiajcej zdalne wykonanie kodu przez zoliwy JavaScript, wykorzystujc refleksj.

#### Implementacja Mostka JavaScript

* **Interfejsy JavaScript** mog wchodzi w interakcje z kodem natywnym, jak pokazano w przykadach, gdzie metoda klasy jest udostpniana JavaScript:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
* Mostek JavaScript jest wczony poprzez dodanie interfejsu do WebView:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
* Potencjalne wykorzystanie przez JavaScript, na przykad, za pomoc ataku XSS, umo偶liwia wywoywanie wystawionych metod Java:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
* Aby zminimalizowa ryzyko, **ogranicz u偶ycie mostka JavaScript** do kodu dostarczonego z APK i zapobiec adowaniu JavaScript z zdalnych 藕r贸de. Dla starszych urzdze ustaw minimalny poziom API na 17.

### Wykonanie zdalnego kodu oparte na refleksji (RCE)

* Udokumentowana metoda pozwala na osignicie RCE poprzez refleksj, wykonujc okrelony adunek. Jednak adnotacja `@JavascriptInterface` zapobiega nieautoryzowanemu dostpowi do metod, ograniczajc powierzchni ataku.

### Zdalne debugowanie

* **Zdalne debugowanie** jest mo偶liwe za pomoc **Narzdzi dewelopera Chrome**, co umo偶liwia interakcj i dowolne wykonanie JavaScript w treci WebView.

#### Wczanie zdalnego debugowania

* Zdalne debugowanie mo偶na wczy dla wszystkich WebView w aplikacji poprzez:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
* Aby warunkowo wczy debugowanie w zale偶noci od stanu debugowalnoci aplikacji:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Ekstrahowanie dowolnych plik贸w

* Demonstruje ekstrahowanie dowolnych plik贸w za pomoc XMLHttpRequest:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Odniesienia

* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)
* [https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1](https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1)
* [https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I](https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
