# ì›¹ë·° ê³µê²©

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## WebView êµ¬ì„± ë° ë³´ì•ˆì— ëŒ€í•œ ë‹¨ìˆœí™”ëœ ê°€ì´ë“œ

### WebView ì·¨ì•½ì  ê°œìš”

Android ê°œë°œì˜ ì¤‘ìš”í•œ ì¸¡ë©´ì€ WebViewì˜ ì˜¬ë°”ë¥¸ ì²˜ë¦¬ì…ë‹ˆë‹¤. ì´ ê°€ì´ë“œëŠ” WebView ì‚¬ìš©ê³¼ ê´€ë ¨ëœ ìœ„í—˜ì„ ì™„í™”í•˜ê¸° ìœ„í•œ ì£¼ìš” êµ¬ì„± ë° ë³´ì•ˆ ê´€í–‰ì„ ê°•ì¡°í•©ë‹ˆë‹¤.

![WebView ì˜ˆì œ](../../.gitbook/assets/image%20(718).png)

### **WebViewì—ì„œì˜ íŒŒì¼ ì•¡ì„¸ìŠ¤**

ê¸°ë³¸ì ìœ¼ë¡œ WebViewëŠ” íŒŒì¼ ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ Android API ë ˆë²¨ 3 (Cupcake 1.5)ë¶€í„° ì‚¬ìš© ê°€ëŠ¥í•œ `setAllowFileAccess()` ë©”ì„œë“œë¡œ ì œì–´ë©ë‹ˆë‹¤. **android.permission.READ_EXTERNAL_STORAGE** ê¶Œí•œì„ ê°€ì§„ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ íŒŒì¼ URL scheme (`file://path/to/file`)ì„ ì‚¬ìš©í•˜ì—¬ ì™¸ë¶€ ì €ì¥ì†Œì—ì„œ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### **ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥: Universal ë° URLì—ì„œì˜ íŒŒì¼ ì•¡ì„¸ìŠ¤**

- **URLì—ì„œì˜ Universal ì•¡ì„¸ìŠ¤**: ì´ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì€ íŒŒì¼ URLì—ì„œì˜ êµì°¨ ì¶œì²˜ ìš”ì²­ì„ í—ˆìš©í•˜ì—¬ ì ì¬ì ì¸ XSS ê³µê²©ìœ¼ë¡œ ì¸í•œ ì¤‘ëŒ€í•œ ë³´ì•ˆ ìœ„í—˜ì„ ì´ˆë˜í–ˆìŠµë‹ˆë‹¤. ê¸°ë³¸ ì„¤ì •ì€ Android Jelly Bean ì´ìƒì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ì•±ì— ëŒ€í•´ ë¹„í™œì„±í™”(`false`)ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- ì´ ì„¤ì •ì„ í™•ì¸í•˜ë ¤ë©´ `getAllowUniversalAccessFromFileURLs()`ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
- ì´ ì„¤ì •ì„ ìˆ˜ì •í•˜ë ¤ë©´ `setAllowUniversalAccessFromFileURLs(boolean)`ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

- **URLì—ì„œì˜ íŒŒì¼ ì•¡ì„¸ìŠ¤**: ì´ ë˜í•œ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì€ ë‹¤ë¥¸ íŒŒì¼ scheme URLì—ì„œì˜ ì½˜í…ì¸  ì•¡ì„¸ìŠ¤ë¥¼ ì œì–´í–ˆìŠµë‹ˆë‹¤. Universal ì•¡ì„¸ìŠ¤ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ê¸°ë³¸ ì„¤ì •ì€ ë³´ì•ˆì„ ê°•í™”í•˜ê¸° ìœ„í•´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- í™•ì¸í•˜ë ¤ë©´ `getAllowFileAccessFromFileURLs()`ë¥¼ ì‚¬ìš©í•˜ê³ , ì„¤ì •í•˜ë ¤ë©´ `setAllowFileAccessFromFileURLs(boolean)`ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

#### **ì•ˆì „í•œ íŒŒì¼ ë¡œë”©**

ìì‚° ë° ë¦¬ì†ŒìŠ¤ì— ì—¬ì „íˆ ì•¡ì„¸ìŠ¤í•˜ë©´ì„œ íŒŒì¼ ì‹œìŠ¤í…œ ì•¡ì„¸ìŠ¤ë¥¼ ë¹„í™œì„±í™”í•˜ê¸° ìœ„í•´ `setAllowFileAccess()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. Android R ì´ìƒì—ì„œ ê¸°ë³¸ ì„¤ì •ì€ `false`ì…ë‹ˆë‹¤.
- `getAllowFileAccess()`ë¡œ í™•ì¸í•˜ì„¸ìš”.
- `setAllowFileAccess(boolean)`ë¡œ í™œì„±í™” ë˜ëŠ” ë¹„í™œì„±í™”í•˜ì„¸ìš”.

#### **WebViewAssetLoader**

**WebViewAssetLoader** í´ë˜ìŠ¤ëŠ” ë¡œì»¬ íŒŒì¼ì„ ë¡œë“œí•˜ê¸° ìœ„í•œ í˜„ëŒ€ì ì¸ ì ‘ê·¼ ë°©ì‹ì…ë‹ˆë‹¤. ë¡œì»¬ ìì‚° ë° ë¦¬ì†ŒìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ http(s) URLì„ ì‚¬ìš©í•˜ë©°, ë™ì¼ ì¶œì²˜ ì •ì±…ê³¼ ì¼ì¹˜í•˜ì—¬ CORS ê´€ë¦¬ë¥¼ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤.

### **JavaScript ë° Intent Scheme ì²˜ë¦¬**

- **JavaScript**: WebViewì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©°, `setJavaScriptEnabled()`ë¥¼ í†µí•´ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì ˆí•œ ë³´ì•ˆ ì¡°ì¹˜ ì—†ì´ JavaScriptë¥¼ í™œì„±í™”í•˜ëŠ” ê²ƒì€ ë³´ì•ˆ ì·¨ì•½ì ì„ ë„ì…í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

- **Intent Scheme**: WebViewëŠ” `intent` schemeì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì‹ ì¤‘í•˜ê²Œ ê´€ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë…¸ì¶œëœ WebView ë§¤ê°œë³€ìˆ˜ "support_url"ì„ ì•…ìš©í•˜ì—¬ í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ… (XSS) ê³µê²©ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

![ì·¨ì•½í•œ WebView](../../.gitbook/assets/image%20(719).png)

adbë¥¼ ì‚¬ìš©í•œ ê³µê²© ì˜ˆì‹œ:
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView â€“es support_url "https://example.com/xss.html"
```
### Javascript Bridge

ì•ˆë“œë¡œì´ë“œì—ì„œëŠ” WebViewì—ì„œ **JavaScript**ì´ ë„¤ì´í‹°ë¸Œ ì•ˆë“œë¡œì´ë“œ ì•± ê¸°ëŠ¥ì„ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” `addJavascriptInterface` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ JavaScriptë¥¼ ë„¤ì´í‹°ë¸Œ ì•ˆë“œë¡œì´ë“œ ê¸°ëŠ¥ê³¼ í†µí•©í•˜ëŠ” ê²ƒìœ¼ë¡œ, _WebView JavaScript bridge_ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤. ì´ ë©”ì†Œë“œëŠ” WebView ë‚´ì˜ ëª¨ë“  í˜ì´ì§€ê°€ ë“±ë¡ëœ JavaScript ì¸í„°í˜ì´ìŠ¤ ê°ì²´ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ê¸° ë•Œë¬¸ì—, ë¯¼ê°í•œ ì •ë³´ê°€ ì´ëŸ¬í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ë…¸ì¶œë  ê²½ìš° ë³´ì•ˆ ìœ„í—˜ì´ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

### ì¤‘ìš”í•œ ê³ ë ¤ ì‚¬í•­

- ì•ˆë“œë¡œì´ë“œ ë²„ì „ 4.2 ë¯¸ë§Œì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ì•±ì˜ ê²½ìš° **ë§¤ìš° ì£¼ì˜ê°€ í•„ìš”**í•©ë‹ˆë‹¤. ì´ëŠ” ì•…ì„± JavaScriptë¥¼ í†µí•´ ë¦¬í”Œë ‰ì…˜ì„ ì´ìš©í•˜ì—¬ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì  ë•Œë¬¸ì…ë‹ˆë‹¤.

#### JavaScript Bridge êµ¬í˜„

- **JavaScript ì¸í„°í˜ì´ìŠ¤**ëŠ” ë„¤ì´í‹°ë¸Œ ì½”ë“œì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ë‹¤ìŒ ì˜ˆì œì—ì„œëŠ” í´ë˜ìŠ¤ ë©”ì†Œë“œê°€ JavaScriptì— ë…¸ì¶œë˜ëŠ” ê²ƒì„ ë³´ì—¬ì¤ë‹ˆë‹¤:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
- WebViewì— ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ JavaScript Bridgeë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
- ì ì¬ì ìœ¼ë¡œ JavaScriptë¥¼ í†µí•œ ì•…ìš©ì€ XSS ê³µê²©ì„ í†µí•´ ë…¸ì¶œëœ Java ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
- ìœ„í—˜ì„ ì™„í™”í•˜ê¸° ìœ„í•´ **JavaScript ë¸Œë¦¬ì§€ ì‚¬ìš©ì„ ì œí•œ**í•˜ê³  APKì™€ í•¨ê»˜ ì œê³µëœ ì½”ë“œì—ì„œë§Œ JavaScriptë¥¼ ë¡œë“œí•˜ë„ë¡ í•©ë‹ˆë‹¤. ì˜¤ë˜ëœ ê¸°ê¸°ì˜ ê²½ìš° ìµœì†Œ API ë ˆë²¨ì„ 17ë¡œ ì„¤ì •í•˜ì„¸ìš”.

### Reflection ê¸°ë°˜ ì›ê²© ì½”ë“œ ì‹¤í–‰ (RCE)

- ë¬¸ì„œí™”ëœ ë°©ë²•ì„ í†µí•´ íŠ¹ì • í˜ì´ë¡œë“œë¥¼ ì‹¤í–‰í•˜ì—¬ Reflectionì„ í†µí•´ RCEë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `@JavascriptInterface` ì£¼ì„ì€ ë¬´ë‹¨ ë©”ì„œë“œ ì•¡ì„¸ìŠ¤ë¥¼ ë°©ì§€í•˜ì—¬ ê³µê²© í‘œë©´ì„ ì œí•œí•©ë‹ˆë‹¤.

### ì›ê²© ë””ë²„ê¹…

- **Chrome ê°œë°œì ë„êµ¬**ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì›ê²© ë””ë²„ê¹…**ì´ ê°€ëŠ¥í•˜ë©°, WebView ì½˜í…ì¸  ë‚´ì—ì„œ ìƒí˜¸ì‘ìš© ë° ì„ì˜ì˜ JavaScript ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

#### ì›ê²© ë””ë²„ê¹… í™œì„±í™”

- ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì˜ ëª¨ë“  WebViewì— ëŒ€í•´ ì›ê²© ë””ë²„ê¹…ì„ í™œì„±í™”í•˜ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
- ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ debuggable ìƒíƒœì— ë”°ë¼ ë””ë²„ê¹…ì„ ì¡°ê±´ë¶€ë¡œ í™œì„±í™”í•˜ë ¤ë©´:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## ì„ì˜ì˜ íŒŒì¼ ìœ ì¶œ

- XMLHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ì˜ì˜ íŒŒì¼ì„ ìœ ì¶œí•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## ì°¸ê³  ìë£Œ
* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
