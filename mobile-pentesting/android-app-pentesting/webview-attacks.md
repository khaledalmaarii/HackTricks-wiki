# Ataki na WebView

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

## Przewodnik po Konfiguracjach i Bezpieczestwie WebView

### Przegld Zagro偶e WebView

Krytycznym aspektem rozwoju aplikacji na Androida jest poprawne zarzdzanie WebViews. Ten przewodnik podkrela kluczowe konfiguracje i praktyki bezpieczestwa majce na celu zmniejszenie ryzyka zwizanego z u偶yciem WebView.

![Przykad WebView](<../../.gitbook/assets/image (718).png>)

### **Dostp do Plik贸w w WebViews**

Domylnie WebViews pozwalaj na dostp do plik贸w. Funkcjonalno ta jest kontrolowana przez metod `setAllowFileAccess()`, dostpn od poziomu API Androida 3 (Cupcake 1.5). Aplikacje z uprawnieniem **android.permission.READ\_EXTERNAL\_STORAGE** mog odczytywa pliki z zewntrznego przechowywania za pomoc schematu adresu URL pliku (`file://cie偶ka/do/pliku`).

#### **Funkcje przestarzae: Uniwersalny dostp i Dostp do plik贸w z adres贸w URL**

* **Uniwersalny dostp z adres贸w URL pliku**: Ta funkcja, kt贸ra zostaa oznaczona jako przestarzaa, umo偶liwiaa 偶dania midzydomenowe z adres贸w URL pliku, stanowic znaczce ryzyko bezpieczestwa zwizanego z potencjalnymi atakami XSS. Domylne ustawienie jest wyczone (`false`) dla aplikacji kierowanych na Androida Jelly Bean i nowsze.
* Aby sprawdzi to ustawienie, u偶yj `getAllowUniversalAccessFromFileURLs()`.
* Aby zmodyfikowa to ustawienie, u偶yj `setAllowUniversalAccessFromFileURLs(boolean)`.
* **Dostp do plik贸w z adres贸w URL pliku**: Ta r贸wnie偶 przestarzaa funkcja kontrolowaa dostp do treci z innych adres贸w URL schematu pliku. Podobnie jak uniwersalny dostp, domylnie jest wyczona dla zwikszonego bezpieczestwa.
* U偶yj `getAllowFileAccessFromFileURLs()` do sprawdzenia i `setAllowFileAccessFromFileURLs(boolean)` do ustawienia.

#### **Bezpieczne adowanie Plik贸w**

Aby wyczy dostp do systemu plik贸w, zachowujc jednoczenie dostp do zasob贸w i zasob贸w, u偶ywana jest metoda `setAllowFileAccess()`. W przypadku Androida R i nowszych, domylne ustawienie to `false`.

* Sprawd藕 za pomoc `getAllowFileAccess()`.
* Wcz lub wycz za pomoc `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

Klasa **WebViewAssetLoader** to nowoczesne podejcie do adowania plik贸w lokalnych. Wykorzystuje adresy URL http(s) do dostpu do lokalnych zasob贸w i zasob贸w, zgodnie z zasad tego samego pochodzenia, uatwiajc zarzdzanie CORS.

### loadUrl

To powszechna funkcja u偶ywana do adowania dowolnych adres贸w URL w WebView:
```java
webview.loadUrl("<url here>")
```
Oczywicie, potencjalny atakujcy nigdy nie powinien m贸c **kontrolowa adresu URL**, kt贸ry ma zosta zaadowany przez aplikacj.

### **Obsuga JavaScriptu i schematu Intent**

* **JavaScript**: Domylnie wyczony w WebViews, mo偶e by wczony za pomoc `setJavaScriptEnabled()`. Nale偶y zachowa ostro偶no, poniewa偶 wczenie JavaScriptu bez odpowiednich zabezpiecze mo偶e wprowadzi podatnoci na ataki.
* **Schemat Intent**: WebViews mog obsugiwa schemat `intent`, co potencjalnie prowadzi do eksploatacji, jeli nie jest ostro偶nie zarzdzany. Przykadem podatnoci byo ujawnione parametru WebView "support\_url", kt贸ry m贸g by wykorzystany do wykonania atak贸w typu cross-site scripting (XSS).

![Podatna WebView](<../../.gitbook/assets/image (719).png>)

Przykad eksploatacji za pomoc adb:

{% code overflow="wrap" %}
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView es support_url "https://example.com/xss.html"
```
### Most JavaScript Bridge

Android udostpnia funkcj, kt贸ra umo偶liwia **JavaScriptowi** w WebView wywoywanie **funkcji natywnych aplikacji Android**. Jest to osigane poprzez wykorzystanie metody `addJavascriptInterface`, kt贸ra integruje JavaScript z funkcjami natywnymi Androida, okrelanymi jako _mostek JavaScript WebView_. Zaleca si ostro偶no, poniewa偶 ta metoda pozwala wszystkim stronom w WebView na dostp do zarejestrowanego obiektu interfejsu JavaScript, co stanowi ryzyko bezpieczestwa, jeli wra偶liwe informacje s ujawnione poprzez te interfejsy.

* **Wymagana jest skrajna ostro偶no** dla aplikacji kierowanych na wersje Androida poni偶ej 4.2 z powodu podatnoci umo偶liwiajcej zdalne wykonanie kodu poprzez zoliwy JavaScript, wykorzystujcy odbicie.

#### Implementacja mostka JavaScript

* **Interfejsy JavaScript** mog wsp贸dziaa z kodem natywnym, jak pokazano w przykadach, gdzie metoda klasy jest udostpniana JavaScriptowi:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
* JavaScript Bridge jest wczony poprzez dodanie interfejsu do WebView:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
* Potencjalne wykorzystanie poprzez JavaScript, na przykad za pomoc ataku XSS, umo偶liwia wywoanie odsonitych metod Javy:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
* Aby zmniejszy ryzyko, **ogranicz u偶ywanie mostka JavaScript** do kodu dostarczonego w pliku APK i zapobiegaj adowaniu JavaScript z zdalnych 藕r贸de. Dla starszych urzdze ustaw minimalny poziom API na 17.

### Wykonanie zdalnego kodu (RCE) oparte na refleksji

* Udokumentowana metoda pozwala osign RCE poprzez refleksj poprzez wykonanie okrelonego adunku. Jednak adnotacja `@JavascriptInterface` zapobiega nieautoryzowanemu dostpowi do metody, ograniczajc powierzchni ataku.

### Zdalne debugowanie

* **Zdalne debugowanie** jest mo偶liwe dziki **Chrome Developer Tools**, umo偶liwiajc interakcj i dowolne wykonanie JavaScript w treci WebView.

#### Wczanie zdalnego debugowania

* Zdalne debugowanie mo偶na wczy dla wszystkich widok贸w WebView w aplikacji poprzez:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
* Aby warunkowo wczy debugowanie na podstawie stanu debugowania aplikacji:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Wyciek dowolnych plik贸w

* Demonstruje wyciek dowolnych plik贸w za pomoc obiektu XMLHttpRequest:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Odnoniki

* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)
* [https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1](https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1)
* [https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I](https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I)

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakowania, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
