# Webview Attacks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## VodiÄ o WebView konfiguracijama i bezbednosti

### Pregled WebView ranjivosti

KritiÄan aspekt Android razvoja ukljuÄuje pravilno rukovanje WebView-ima. Ovaj vodiÄ istiÄe kljuÄne konfiguracije i bezbednosne prakse za smanjenje rizika povezanih sa koriÅ¡Ä‡enjem WebView-a.

![WebView Example](<../../.gitbook/assets/image (1190).png>)

### **Pristup datotekama u WebView-ima**

Po defaultu, WebView-ima je dozvoljen pristup datotekama. Ova funkcionalnost se kontroliÅ¡e metodom `setAllowFileAccess()`, dostupnom od Android API nivoa 3 (Cupcake 1.5). Aplikacije sa dozvolom **android.permission.READ\_EXTERNAL\_STORAGE** mogu Äitati datoteke sa spoljnog skladiÅ¡ta koristeÄ‡i shemu URL-a za datoteke (`file://path/to/file`).

#### **Zastarjele funkcije: Univerzalni i pristup datotekama sa URL-ova**

* **Univerzalni pristup sa URL-ova datoteka**: Ova zastarela funkcija je omoguÄ‡avala cross-origin zahteve sa URL-ova datoteka, predstavljajuÄ‡i znaÄajan bezbednosni rizik zbog potencijalnih XSS napada. Podrazumevana postavka je onemoguÄ‡ena (`false`) za aplikacije koje cilÑ˜aju Android Jelly Bean i novije.
* Da biste proverili ovu postavku, koristite `getAllowUniversalAccessFromFileURLs()`.
* Da biste izmenili ovu postavku, koristite `setAllowUniversalAccessFromFileURLs(boolean)`.
* **Pristup datotekama sa URL-ova datoteka**: Ova funkcija, takoÄ‘e zastarela, kontrolisala je pristup sadrÅ¾aju sa drugih URL-ova sheme datoteka. Kao i univerzalni pristup, njena podrazumevana postavka je onemoguÄ‡ena radi poboljÅ¡ane bezbednosti.
* Koristite `getAllowFileAccessFromFileURLs()` da proverite i `setAllowFileAccessFromFileURLs(boolean)` da postavite.

#### **Sigurno uÄitavanje datoteka**

Za onemoguÄ‡avanje pristupa sistemu datoteka dok se i dalje pristupa resursima i sredstvima, koristi se metoda `setAllowFileAccess()`. Sa Android R i novijim, podrazumevana postavka je `false`.

* Proverite sa `getAllowFileAccess()`.
* OmoguÄ‡ite ili onemoguÄ‡ite sa `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

Klasa **WebViewAssetLoader** je savremeni pristup za uÄitavanje lokalnih datoteka. Koristi http(s) URL-ove za pristup lokalnim sredstvima i resursima, usklaÄ‘ujuÄ‡i se sa politikom iste porekla, Äime se olakÅ¡ava upravljanje CORS-om.

### loadUrl

Ovo je uobiÄajena funkcija koja se koristi za uÄitavanje proizvoljnih URL-ova u webview:
```java
webview.loadUrl("<url here>")
```
Ofc, potencijalni napadaÄ nikada ne bi trebao moÄ‡i **kontrolisati URL** koji aplikacija uÄitava.

### **JavaScript i rukovanje Intent shemama**

* **JavaScript**: OnemoguÄ‡en po defaultu u WebView-ima, moÅ¾e se omoguÄ‡iti putem `setJavaScriptEnabled()`. PreporuÄuje se oprez jer omoguÄ‡avanje JavaScript-a bez odgovarajuÄ‡ih zaÅ¡tita moÅ¾e uvesti sigurnosne ranjivosti.
* **Intent shema**: WebView-ovi mogu obraditi `intent` shemu, Å¡to moÅ¾e dovesti do eksploatacija ako se ne upravlja paÅ¾ljivo. Jedna ranjivost ukljuÄivala je izloÅ¾eni WebView parametar "support\_url" koji se mogao iskoristiti za izvrÅ¡avanje napada skriptiranja izmeÄ‘u sajtova (XSS).

![Vulnerable WebView](<../../.gitbook/assets/image (1191).png>)

Primer eksploatacije koristeÄ‡i adb:

{% code overflow="wrap" %}
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView â€“es support_url "https://example.com/xss.html"
```
{% endcode %}

### Javascript Bridge

Funkcija koju pruÅ¾a Android omoguÄ‡ava **JavaScript-u** u WebView-u da poziva **nativne Android funkcije aplikacije**. To se postiÅ¾e koriÅ¡Ä‡enjem `addJavascriptInterface` metode, koja integriÅ¡e JavaScript sa nativnim Android funkcionalnostima, nazvanim _WebView JavaScript bridge_. Potrebna je opreznost jer ova metoda omoguÄ‡ava svim stranicama unutar WebView-a da pristupe registrovanom JavaScript Interface objektu, Å¡to predstavlja sigurnosni rizik ako se osetljive informacije izloÅ¾e putem ovih interfejsa.

* **Ekstremna opreznost je potrebna** za aplikacije koje cilÑ˜aju Android verzije ispod 4.2 zbog ranjivosti koja omoguÄ‡ava dalÑ˜insko izvrÅ¡avanje koda putem zlonamernog JavaScript-a, koristeÄ‡i refleksiju.

#### Implementacija JavaScript Bridge-a

* **JavaScript interfejsi** mogu interagovati sa nativnim kodom, kao Å¡to je prikazano u primerima gde je metoda klase izloÅ¾ena JavaScript-u:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
* JavaScript Bridge se omoguÄ‡ava dodavanjem interfejsa u WebView:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
* Potencijalna eksploatacija putem JavaScript-a, na primer, putem XSS napada, omoguÄ‡ava pozivanje izloÅ¾enih Java metoda:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
* Da biste smanjili rizike, **ograniÄite koriÅ¡Ä‡enje JavaScript mosta** na kod koji je isporuÄen sa APK-om i spreÄite uÄitavanje JavaScript-a iz udaljenih izvora. Za starije ureÄ‘aje, postavite minimalni API nivo na 17.

### IzvrÅ¡enje daljinskog koda zasnovano na refleksiji (RCE)

* Dokumentovana metoda omoguÄ‡ava postizanje RCE putem refleksije izvrÅ¡avanjem specifiÄnog payload-a. MeÄ‘utim, `@JavascriptInterface` anotacija spreÄava neovlaÅ¡Ä‡en pristup metodama, ograniÄavajuÄ‡i povrÅ¡inu napada.

### Daljinsko debagovanje

* **Daljinsko debagovanje** je moguÄ‡e sa **Chrome Developer Tools**, omoguÄ‡avajuÄ‡i interakciju i proizvoljno izvrÅ¡avanje JavaScript-a unutar WebView sadrÅ¾aja.

#### OmoguÄ‡avanje daljinskog debagovanja

* Daljinsko debagovanje moÅ¾e biti omoguÄ‡eno za sve WebView-ove unutar aplikacije na sledeÄ‡i naÄin:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
* Da uslovno omoguÄ‡ite debagovanje na osnovu stanja debagovanja aplikacije:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Ekstrakcija proizvoljnih fajlova

* Prikazuje ekstrakciju proizvoljnih fajlova koristeÄ‡i XMLHttpRequest:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## Reference

* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)
* [https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1](https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1)
* [https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I](https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I)

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
