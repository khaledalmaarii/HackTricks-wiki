# iOS æ¸—é€æµ‹è¯•

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS æ¸—é€æµ‹è¯•ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒ HackTricks çš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„æ¸—é€æµ‹è¯•æŠ€å·§**ã€‚

</details>

## iOS åŸºç¡€

{% content-ref url="ios-basics.md" %}
[ios-basics.md](ios-basics.md)
{% endcontent-ref %}

## æµ‹è¯•ç¯å¢ƒ

åœ¨æ­¤é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æœ‰å…³**iOS æ¨¡æ‹Ÿå™¨**ã€**ä»¿çœŸå™¨**å’Œ**è¶Šç‹±**çš„ä¿¡æ¯ï¼š

{% content-ref url="ios-testing-environment.md" %}
[ios-testing-environment.md](ios-testing-environment.md)
{% endcontent-ref %}

## åˆå§‹åˆ†æ

### åŸºæœ¬çš„ iOS æµ‹è¯•æ“ä½œ

åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­**å°†ä¼šå»ºè®®æ‰§è¡Œå¤šç§æ“ä½œ**ï¼ˆè¿æ¥è®¾å¤‡ã€è¯»å–/å†™å…¥/ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶ã€ä½¿ç”¨ä¸€äº›å·¥å…·ç­‰ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä¸çŸ¥é“å¦‚ä½•æ‰§è¡Œè¿™äº›æ“ä½œï¼Œè¯·**å¼€å§‹é˜…è¯»é¡µé¢**ï¼š

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

{% hint style="info" %}
å¯¹äºä»¥ä¸‹æ­¥éª¤ï¼Œ**åº”è¯¥å·²ç»åœ¨è®¾å¤‡ä¸Šå®‰è£…äº†åº”ç”¨ç¨‹åº**ï¼Œå¹¶ä¸”å·²ç»è·å¾—äº†åº”ç”¨ç¨‹åºçš„**IPA æ–‡ä»¶**ã€‚
é˜…è¯»[åŸºæœ¬çš„ iOS æµ‹è¯•æ“ä½œ](basic-ios-testing-operations.md)é¡µé¢ä»¥äº†è§£å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚
{% endhint %}

### åŸºæœ¬é™æ€åˆ†æ

å»ºè®®ä½¿ç”¨å·¥å…· [**MobSF**](https://github.com/MobSF/Mobile-Security-Framework-MobSF) å¯¹ IPA æ–‡ä»¶æ‰§è¡Œè‡ªåŠ¨é™æ€åˆ†æã€‚

è¯†åˆ«äºŒè¿›åˆ¶æ–‡ä»¶ä¸­å­˜åœ¨çš„**ä¿æŠ¤æªæ–½**ï¼š

*   **PIE (ä½ç½®ç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶)**ï¼šå¯ç”¨æ—¶ï¼Œåº”ç”¨ç¨‹åºæ¯æ¬¡å¯åŠ¨æ—¶éƒ½ä¼šåŠ è½½åˆ°ä¸€ä¸ªéšæœºå†…å­˜åœ°å€ï¼Œä½¿å…¶åˆå§‹å†…å­˜åœ°å€æ›´éš¾é¢„æµ‹ã€‚

```bash
otool -hv <app-binary> | grep PIE   # åº”è¯¥åŒ…å« PIE æ ‡å¿—
```
*   **æ ˆé‡‘ä¸é›€**ï¼šä¸ºäº†éªŒè¯æ ˆçš„å®Œæ•´æ€§ï¼Œåœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰ä¼šåœ¨æ ˆä¸Šæ”¾ç½®ä¸€ä¸ªâ€˜é‡‘ä¸é›€â€™å€¼ï¼Œå¹¶åœ¨å‡½æ•°ç»“æŸåå†æ¬¡éªŒè¯ã€‚

```bash
otool -I -v <app-binary> | grep stack_chk   # åº”è¯¥åŒ…å«ç¬¦å·ï¼šstack_chk_guard å’Œ stack_chk_fail
```
*   **ARC (è‡ªåŠ¨å¼•ç”¨è®¡æ•°)**ï¼šä¸ºäº†é˜²æ­¢å¸¸è§çš„å†…å­˜æŸåç¼ºé™·

```bash
otool -I -v <app-binary> | grep objc_release   # åº”è¯¥åŒ…å« _objc_release ç¬¦å·
```
*   **åŠ å¯†çš„äºŒè¿›åˆ¶æ–‡ä»¶**ï¼šäºŒè¿›åˆ¶æ–‡ä»¶åº”è¯¥æ˜¯åŠ å¯†çš„

```bash
otool -arch all -Vl <app-binary> | grep -A5 LC_ENCRYPT   # cryptid åº”è¯¥æ˜¯ 1
```

**è¯†åˆ«æ•æ„Ÿ/ä¸å®‰å…¨å‡½æ•°**

*   **å¼±å“ˆå¸Œç®—æ³•**

```bash
# åœ¨ iOS è®¾å¤‡ä¸Š
otool -Iv <app> | grep -w "_CC_MD5"
otool -Iv <app> | grep -w "_CC_SHA1"

# åœ¨ linux ä¸Š
grep -iER "_CC_MD5"
grep -iER "_CC_SHA1"
```
*   **ä¸å®‰å…¨çš„éšæœºå‡½æ•°**

```bash
# åœ¨ iOS è®¾å¤‡ä¸Š
otool -Iv <app> | grep -w "_random"
otool -Iv <app> | grep -w "_srand"
otool -Iv <app> | grep -w "_rand"

# åœ¨ linux ä¸Š
grep -iER "_random"
grep -iER "_srand"
grep -iER "_rand"
```
*   **ä¸å®‰å…¨çš„â€˜Mallocâ€™å‡½æ•°**

```bash
# åœ¨ iOS è®¾å¤‡ä¸Š
otool -Iv <app> | grep -w "_malloc"

# åœ¨ linux ä¸Š
grep -iER "_malloc"
```
*   **ä¸å®‰å…¨ä¸”æ˜“å—æ”»å‡»çš„å‡½æ•°**

```bash
# åœ¨ iOS è®¾å¤‡ä¸Š
otool -Iv <app> | grep -w "_gets"
otool -Iv <app> | grep -w "_memcpy"
otool -Iv <app> | grep -w "_strncpy"
otool -Iv <app> | grep -w "_strlen"
otool -Iv <app> | grep -w "_vsnprintf"
otool -Iv <app> | grep -w "_sscanf"
otool -Iv <app> | grep -w "_strtok"
otool -Iv <app> | grep -w "_alloca"
otool -Iv <app> | grep -w "_sprintf"
otool -Iv <app> | grep -w "_printf"
otool -Iv <app> | grep -w "_vsprintf"

# åœ¨ linux ä¸Š
grep -R "_gets"
grep -iER "_memcpy"
grep -iER "_strncpy"
grep -iER "_strlen"
grep -iER "_vsnprintf"
grep -iER "_sscanf"
grep -iER "_strtok"
grep -iER "_alloca"
grep -iER "_sprintf"
grep -iER "_printf"
grep -iER "_vsprintf"
```

### åŸºæœ¬åŠ¨æ€åˆ†æ

æŸ¥çœ‹ [**MobSF**](https://github.com/MobSF/Mobile-Security-Framework-MobSF) æ‰§è¡Œçš„åŠ¨æ€åˆ†æã€‚æ‚¨éœ€è¦æµè§ˆä¸åŒçš„è§†å›¾å¹¶ä¸å®ƒä»¬äº’åŠ¨ï¼Œä½†å®ƒå°†ä¼šæŒ‚é’©å‡ ä¸ªç±»å¹¶åšå…¶ä»–äº‹æƒ…ï¼Œå¹¶åœ¨æ‚¨å®Œæˆåå‡†å¤‡æŠ¥å‘Šã€‚

### åˆ—å‡ºå·²å®‰è£…çš„åº”ç”¨ç¨‹åº

å½“é’ˆå¯¹å·²å®‰è£…åœ¨è®¾å¤‡ä¸Šçš„åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨é¦–å…ˆéœ€è¦ç¡®å®šæ‚¨æƒ³è¦åˆ†æçš„åº”ç”¨ç¨‹åºçš„æ­£ç¡®æ†ç»‘æ ‡è¯†ç¬¦ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ `frida-ps -Uai` è·å–æ‰€æœ‰åº”ç”¨ç¨‹åºï¼ˆ`-a`ï¼‰å½“å‰å®‰è£…ï¼ˆ`-i`ï¼‰åœ¨è¿æ¥çš„ USB è®¾å¤‡ï¼ˆ`-U`ï¼‰ä¸Šï¼š
```bash
$ frida-ps -Uai
PID  Name                 Identifier
----  -------------------  -----------------------------------------
6847  Calendar             com.apple.mobilecal
6815  Mail                 com.apple.mobilemail
-  App Store            com.apple.AppStore
-  Apple Store          com.apple.store.Jolly
-  Calculator           com.apple.calculator
-  Camera               com.apple.camera
-  iGoat-Swift          OWASP.iGoat-Swift
```
### åŸºæœ¬æšä¸¾ä¸æŒ‚é’©

å­¦ä¹ å¦‚ä½•**æšä¸¾åº”ç”¨ç¨‹åºçš„ç»„ä»¶**ä»¥åŠå¦‚ä½•ä½¿ç”¨objectionè½»æ¾**æŒ‚é’©æ–¹æ³•å’Œç±»**ï¼š

{% content-ref url="ios-hooking-with-objection.md" %}
[ios-hooking-with-objection.md](ios-hooking-with-objection.md)
{% endcontent-ref %}

### IPA ç»“æ„

`.ipa` æ–‡ä»¶æ˜¯**å‹ç¼©çš„** **åŒ…**ï¼Œå› æ­¤æ‚¨å¯ä»¥å°†æ‰©å±•åæ›´æ”¹ä¸º `.zip` å¹¶**è§£å‹ç¼©**å®ƒä»¬ã€‚ä¸€ä¸ª**å®Œæ•´çš„** **æ‰“åŒ…**åº”ç”¨ç¨‹åºå‡†å¤‡å®‰è£…é€šå¸¸è¢«ç§°ä¸º**Bundle**ã€‚\
è§£å‹ç¼©åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ° `<NAME>.app`ï¼Œä¸€ä¸ªåŒ…å«å…¶ä½™èµ„æºçš„å‹ç¼©æ¡£æ¡ˆã€‚

* `Info.plist`ï¼šåŒ…å«ä¸€äº›åº”ç”¨ç¨‹åºç‰¹å®šé…ç½®çš„æ–‡ä»¶ã€‚
* `_CodeSignature/` åŒ…å«ä¸€ä¸ª plist æ–‡ä»¶ï¼Œå¯¹åŒ…ä¸­çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œç­¾åã€‚
* `Assets.car`ï¼šå¦ä¸€ä¸ªåŒ…å«èµ„äº§ï¼ˆå›¾æ ‡ï¼‰çš„å‹ç¼©æ¡£æ¡ˆã€‚
* `Frameworks/` åŒ…å«åº”ç”¨ç¨‹åºçš„æœ¬æœºåº“ï¼Œå¦‚ .dylib æˆ– .framework æ–‡ä»¶ã€‚
* `PlugIns/` å¯èƒ½åŒ…å«åº”ç”¨ç¨‹åºæ‰©å±•åä¸º .appex çš„æ–‡ä»¶ï¼ˆç¤ºä¾‹ä¸­æœªå‡ºç°ï¼‰ã€‚
* [`Core Data`](https://developer.apple.com/documentation/coredata)ï¼šç”¨äºä¿å­˜åº”ç”¨ç¨‹åºçš„æ°¸ä¹…æ•°æ®ä»¥ä¾›ç¦»çº¿ä½¿ç”¨ï¼Œç¼“å­˜ä¸´æ—¶æ•°æ®ï¼Œå¹¶ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ·»åŠ æ’¤é”€åŠŸèƒ½åœ¨å•ä¸ªè®¾å¤‡ä¸Šã€‚ä¸ºäº†åœ¨å•ä¸ª iCloud å¸æˆ·ä¸­çš„å¤šä¸ªè®¾å¤‡ä¸ŠåŒæ­¥æ•°æ®ï¼ŒCore Data ä¼šè‡ªåŠ¨å°†æ‚¨çš„æ¶æ„é•œåƒåˆ° CloudKit å®¹å™¨ä¸­ã€‚
* [`PkgInfo`](https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPRuntimeConfig/Articles/ConfigApplications.html)ï¼š`PkgInfo` æ–‡ä»¶æ˜¯æŒ‡å®šåº”ç”¨ç¨‹åºæˆ–åŒ…çš„ç±»å‹å’Œåˆ›å»ºè€…ä»£ç çš„å¦ä¸€ç§æ–¹å¼ã€‚
* **en.lproj, fr.proj, Base.lproj**ï¼šæ˜¯åŒ…å«ç‰¹å®šè¯­è¨€èµ„æºçš„è¯­è¨€åŒ…ï¼Œä»¥åŠåœ¨ä¸æ”¯æŒè¯­è¨€çš„æƒ…å†µä¸‹çš„é»˜è®¤èµ„æºã€‚

iOS åº”ç”¨ç¨‹åºå®šä¹‰ UI æœ‰å¤šç§æ–¹å¼ï¼š_storyboard_ã€_nib_ æˆ– _xib_ æ–‡ä»¶ã€‚

**Info.plist**

ä¿¡æ¯å±æ€§åˆ—è¡¨æˆ– `Info.plist` æ˜¯ iOS åº”ç”¨ç¨‹åºçš„ä¸»è¦ä¿¡æ¯æ¥æºã€‚å®ƒç”±ä¸€ä¸ªç»“æ„åŒ–æ–‡ä»¶ç»„æˆï¼ŒåŒ…å«æè¿°åº”ç”¨ç¨‹åºåŸºæœ¬é…ç½®ä¿¡æ¯çš„**é”®å€¼**å¯¹ã€‚å®é™…ä¸Šï¼Œæ‰€æœ‰æ†ç»‘çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆåº”ç”¨ç¨‹åºæ‰©å±•ã€æ¡†æ¶å’Œåº”ç”¨ç¨‹åºï¼‰éƒ½**é¢„æœŸæœ‰**ä¸€ä¸ª `Info.plist` æ–‡ä»¶ã€‚æ‚¨å¯ä»¥åœ¨ [**Apple Developer Documentation**](https://developer.apple.com/documentation/bundleresources/information_property_list?language=objc) ä¸­æ‰¾åˆ°æ‰€æœ‰å¯èƒ½çš„é”®ã€‚

è¯¥æ–‡ä»¶å¯èƒ½ä»¥ **XML æˆ–äºŒè¿›åˆ¶ (bplist)** æ ¼å¼æ ¼å¼åŒ–ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å‘½ä»¤å°†å…¶**è½¬æ¢ä¸º XML** æ ¼å¼ï¼š

*   åœ¨ macOS ä¸Šä½¿ç”¨ `plutil`ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ macOS 10.2 åŠä»¥ä¸Šç‰ˆæœ¬è‡ªå¸¦çš„å·¥å…·ï¼ˆç›®å‰æ²¡æœ‰å®˜æ–¹åœ¨çº¿æ–‡æ¡£ï¼‰ï¼š

```bash
$ plutil -convert xml1 Info.plist
```
*   åœ¨ Linux ä¸Šï¼š

```bash
$ apt install libplist-utils
$ plistutil -i Info.plist -o Info_xml.plist
```

ä»¥ä¸‹æ˜¯ä¸€äº›ä¿¡æ¯å’Œç›¸åº”å…³é”®è¯çš„éè¯¦å°½åˆ—è¡¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ£€æŸ¥æ–‡ä»¶æˆ–ä½¿ç”¨ `grep -i <keyword> Info.plist` åœ¨ `Info.plist` æ–‡ä»¶ä¸­è½»æ¾æœç´¢ï¼š

* åº”ç”¨ç¨‹åºæƒé™ç›®çš„å­—ç¬¦ä¸²ï¼š`UsageDescription`
* è‡ªå®šä¹‰ URL æ–¹æ¡ˆï¼š`CFBundleURLTypes`
* å¯¼å‡º/å¯¼å…¥ _è‡ªå®šä¹‰æ–‡æ¡£ç±»å‹_ï¼š`UTExportedTypeDeclarations` / `UTImportedTypeDeclarations`
* åº”ç”¨ç¨‹åºä¼ è¾“å®‰å…¨æ€§ (ATS) é…ç½®ï¼š`NSAppTransportSecurity`

è¯·å‚è€ƒæåˆ°çš„ç« èŠ‚ä»¥äº†è§£æ›´å¤šå…³äºå¦‚ä½•æµ‹è¯•è¿™äº›ç‚¹çš„ä¿¡æ¯ã€‚

**æ•°æ®è·¯å¾„**

åœ¨ iOS ä¸Šï¼Œ**ç³»ç»Ÿåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ `/Applications`** ç›®å½•ä¸­æ‰¾åˆ°ï¼Œè€Œ**ç”¨æˆ·å®‰è£…çš„** åº”ç”¨ç¨‹åºå¯åœ¨ **`/private/var/containers/`** ä¸‹æ‰¾åˆ°ã€‚ç„¶è€Œï¼Œä»…é€šè¿‡å¯¼èˆªæ–‡ä»¶ç³»ç»Ÿæ¥æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶å¤¹å¹¶éæ˜“äº‹ï¼Œå› ä¸º**æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªéšæœºçš„ 128 ä½ UUID**ï¼ˆé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼‰ä½œä¸ºå…¶ç›®å½•åç§°ã€‚

ä¸ºäº†è½»æ¾è·å–ç”¨æˆ·å®‰è£…çš„åº”ç”¨ç¨‹åºçš„å®‰è£…ç›®å½•ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ **objection çš„å‘½ä»¤ `env`**ï¼Œå®ƒè¿˜ä¼šå‘æ‚¨æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„æ‰€æœ‰ç›®å½•ä¿¡æ¯ï¼š
```bash
OWASP.iGoat-Swift on (iPhone: 11.1.2) [usb] # env

Name               Path
-----------------  -------------------------------------------------------------------------------------------
BundlePath         /var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app
CachesDirectory    /var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/Library/Caches
DocumentDirectory  /var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/Documents
LibraryDirectory   /var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/Library
```
æ‚¨è¿˜å¯ä»¥åœ¨ **`/private/var/containers`** ä¸­æœç´¢åº”ç”¨åç§°ï¼š
```bash
find /private/var/containers -name "Progname*"
```
æˆ–ä½¿ç”¨ **`ps`** å’Œ **`lsof`**ï¼š
```bash
ps -ef | grep -i <app-name>
lsof -p <pid> | grep -i "/containers" | head -n 1
```
å¦‚æ‚¨æ‰€è§ï¼Œåº”ç”¨ç¨‹åºæœ‰ä¸¤ä¸ªä¸»è¦ä½ç½®ï¼š

* **Bundle ç›®å½•** (`/var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/`)ã€‚
* **Data ç›®å½•** (`/var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/`)ã€‚

è¿™äº›æ–‡ä»¶å¤¹åŒ…å«åœ¨åº”ç”¨ç¨‹åºå®‰å…¨è¯„ä¼°æœŸé—´å¿…é¡»ä»”ç»†æ£€æŸ¥çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œåœ¨åˆ†æå­˜å‚¨çš„æ•°æ®ä»¥æŸ¥æ‰¾æ•æ„Ÿæ•°æ®æ—¶ï¼‰ã€‚

**Bundle ç›®å½•ï¼š**

* **AppName.app**
* è¿™æ˜¯ä¹‹å‰åœ¨ IPA ä¸­çœ‹åˆ°çš„åº”ç”¨ç¨‹åº Bundleï¼Œå®ƒåŒ…å«å¿…è¦çš„åº”ç”¨ç¨‹åºæ•°æ®ã€é™æ€å†…å®¹ä»¥åŠåº”ç”¨ç¨‹åºçš„ç¼–è¯‘åäºŒè¿›åˆ¶æ–‡ä»¶ã€‚
* è¯¥ç›®å½•å¯¹ç”¨æˆ·å¯è§ï¼Œä½†**ç”¨æˆ·æ— æ³•å†™å…¥**ã€‚
* è¯¥ç›®å½•çš„å†…å®¹**ä¸ä¼šè¢«å¤‡ä»½**ã€‚
* è¯¥æ–‡ä»¶å¤¹çš„å†…å®¹ç”¨äº**éªŒè¯ä»£ç ç­¾å**ã€‚

**Data ç›®å½•ï¼š**

* **Documents/**
* åŒ…å«æ‰€æœ‰ç”¨æˆ·ç”Ÿæˆçš„æ•°æ®ã€‚åº”ç”¨ç¨‹åºæœ€ç»ˆç”¨æˆ·å¯åŠ¨è¿™äº›æ•°æ®çš„åˆ›å»ºã€‚
* å¯¹ç”¨æˆ·å¯è§ä¸”**ç”¨æˆ·å¯ä»¥å†™å…¥**ã€‚
* è¯¥ç›®å½•çš„å†…å®¹**ä¼šè¢«å¤‡ä»½**ã€‚
* åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è®¾ç½® `NSURLIsExcludedFromBackupKey` æ¥ç¦ç”¨è·¯å¾„ã€‚
* **Library/**
* åŒ…å«æ‰€æœ‰**éç”¨æˆ·ç‰¹å®šçš„æ–‡ä»¶**ï¼Œä¾‹å¦‚**ç¼“å­˜**ã€**åå¥½è®¾ç½®**ã€**cookies** å’Œå±æ€§åˆ—è¡¨ï¼ˆplistï¼‰é…ç½®æ–‡ä»¶ã€‚
* iOS åº”ç”¨ç¨‹åºé€šå¸¸ä½¿ç”¨ `Application Support` å’Œ `Caches` å­ç›®å½•ï¼Œä½†åº”ç”¨ç¨‹åºå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰å­ç›®å½•ã€‚
* **Library/Caches/**
* åŒ…å«**åŠæŒä¹…çš„ç¼“å­˜æ–‡ä»¶**ã€‚
* å¯¹ç”¨æˆ·ä¸å¯è§ä¸”**ç”¨æˆ·æ— æ³•å†™å…¥**ã€‚
* è¯¥ç›®å½•çš„å†…å®¹**ä¸ä¼šè¢«å¤‡ä»½**ã€‚
* å½“åº”ç”¨ç¨‹åºæœªè¿è¡Œä¸”å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šè‡ªåŠ¨åˆ é™¤è¯¥ç›®å½•çš„æ–‡ä»¶ã€‚
* **Library/Application Support/**
* åŒ…å«è¿è¡Œåº”ç”¨ç¨‹åºæ‰€å¿…éœ€çš„**æŒä¹…æ–‡ä»¶**ã€‚
* å¯¹**ç”¨æˆ·ä¸å¯è§**ä¸”ç”¨æˆ·æ— æ³•å†™å…¥ã€‚
* è¯¥ç›®å½•çš„å†…å®¹**ä¼šè¢«å¤‡ä»½**ã€‚
* åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è®¾ç½® `NSURLIsExcludedFromBackupKey` æ¥ç¦ç”¨è·¯å¾„ã€‚
* **Library/Preferences/**
* ç”¨äºå­˜å‚¨å³ä½¿åœ¨åº”ç”¨ç¨‹åºé‡å¯åä¹Ÿèƒ½**æŒä¹…å­˜åœ¨çš„å±æ€§**ã€‚
* ä¿¡æ¯ä»¥æœªåŠ å¯†çš„å½¢å¼ä¿å­˜åœ¨åº”ç”¨ç¨‹åºæ²™ç›’ä¸­åä¸º \[BUNDLE_ID].plist çš„ plist æ–‡ä»¶å†…ã€‚
* ä½¿ç”¨ `NSUserDefaults` å­˜å‚¨çš„æ‰€æœ‰é”®/å€¼å¯¹éƒ½å¯ä»¥åœ¨æ­¤æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚
* **tmp/**
* ä½¿ç”¨æ­¤ç›®å½•ç¼–å†™åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨ä¹‹é—´**ä¸éœ€è¦æŒä¹…å­˜åœ¨çš„ä¸´æ—¶æ–‡ä»¶**ã€‚
* åŒ…å«éæŒä¹…çš„ç¼“å­˜æ–‡ä»¶ã€‚
* å¯¹ç”¨æˆ·**ä¸å¯è§**ã€‚
* è¯¥ç›®å½•çš„å†…å®¹ä¸ä¼šè¢«å¤‡ä»½ã€‚
* å½“åº”ç”¨ç¨‹åºæœªè¿è¡Œä¸”å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šè‡ªåŠ¨åˆ é™¤è¯¥ç›®å½•çš„æ–‡ä»¶ã€‚

è®©æˆ‘ä»¬æ›´ä»”ç»†åœ°çœ‹çœ‹ iGoat-Swift çš„åº”ç”¨ç¨‹åº Bundleï¼ˆ.appï¼‰ç›®å½•ï¼Œå®ƒä½äº Bundle ç›®å½•å†…ï¼ˆ`/var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app`ï¼‰ï¼š
```bash
OWASP.iGoat-Swift on (iPhone: 11.1.2) [usb] # ls
NSFileType      Perms  NSFileProtection    ...  Name
------------  -------  ------------------  ...  --------------------------------------
Regular           420  None                ...  rutger.html
Regular           420  None                ...  mansi.html
Regular           420  None                ...  splash.html
Regular           420  None                ...  about.html

Regular           420  None                ...  LICENSE.txt
Regular           420  None                ...  Sentinel.txt
Regular           420  None                ...  README.txt
```
### äºŒè¿›åˆ¶é€†å‘

åœ¨ `<application-name>.app` æ–‡ä»¶å¤¹ä¸­ï¼Œä½ ä¼šæ‰¾åˆ°ä¸€ä¸ªåä¸º `<application-name>` çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™æ˜¯å°†è¦**æ‰§è¡Œ**çš„æ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨ **`otool`** å·¥å…·å¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡ŒåŸºæœ¬æ£€æŸ¥ï¼š
```bash
otool -Vh DVIA-v2 #Check some compilation attributes
magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags
MH_MAGIC_64    ARM64        ALL  0x00     EXECUTE    65       7112   NOUNDEFS DYLDLINK TWOLEVEL WEAK_DEFINES BINDS_TO_WEAK PIE

otool -L DVIA-v2 #Get third party libraries
DVIA-v2:
/usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 400.9.1)
/usr/lib/libsqlite3.dylib (compatibility version 9.0.0, current version 274.6.0)
/usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.11)
@rpath/Bolts.framework/Bolts (compatibility version 1.0.0, current version 1.0.0)
[...]
```
**æ£€æŸ¥åº”ç”¨æ˜¯å¦åŠ å¯†**

æŸ¥çœ‹ä»¥ä¸‹å‘½ä»¤æ˜¯å¦æœ‰è¾“å‡ºï¼š
```bash
otool -l <app-binary> | grep -A 4 LC_ENCRYPTION_INFO
```
**æ‹†è§£äºŒè¿›åˆ¶æ–‡ä»¶**

æ‹†è§£æ–‡æœ¬æ®µï¼š
```bash
otool -tV DVIA-v2
DVIA-v2:
(__TEXT,__text) section
+[DDLog initialize]:
0000000100004ab8    sub    sp, sp, #0x60
0000000100004abc    stp    x29, x30, [sp, #0x50]   ; Latency: 6
0000000100004ac0    add    x29, sp, #0x50
0000000100004ac4    sub    x8, x29, #0x10
0000000100004ac8    mov    x9, #0x0
0000000100004acc    adrp    x10, 1098 ; 0x10044e000
0000000100004ad0    add    x10, x10, #0x268
```
æ‰“å°ç¤ºä¾‹åº”ç”¨ç¨‹åºçš„**Objective-C æ®µ**ï¼Œå¯ä»¥ä½¿ç”¨ï¼š
```bash
otool -oV DVIA-v2
DVIA-v2:
Contents of (__DATA,__objc_classlist) section
00000001003dd5b8 0x1004423d0 _OBJC_CLASS_$_DDLog
isa        0x1004423a8 _OBJC_METACLASS_$_DDLog
superclass 0x0 _OBJC_CLASS_$_NSObject
cache      0x0 __objc_empty_cache
vtable     0x0
data       0x1003de748
flags          0x80
instanceStart  8
```
ä¸ºäº†è·å¾—æ›´ç´§å‡‘çš„Objective-Cä»£ç ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[**class-dump**](http://stevenygard.com/projects/class-dump/)ï¼š
```bash
class-dump some-app
//
//     Generated by class-dump 3.5 (64 bit).
//
//     class-dump is Copyright (C) 1997-1998, 2000-2001, 2004-2013 by Steve Nygard.
//

#pragma mark Named Structures

struct CGPoint {
double _field1;
double _field2;
};

struct CGRect {
struct CGPoint _field1;
struct CGSize _field2;
};

struct CGSize {
double _field1;
double _field2;
};
```
ç„¶è€Œï¼Œæ‹†è§£äºŒè¿›åˆ¶æ–‡ä»¶çš„æœ€ä½³é€‰æ‹©æ˜¯ï¼š[**Hopper**](https://www.hopperapp.com/download.html?) å’Œ [**IDA**](https://www.hex-rays.com/products/ida/support/download_freeware/)ã€‚

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## æ•°æ®å­˜å‚¨

è¦äº†è§£ iOS å¦‚ä½•åœ¨è®¾å¤‡ä¸­å­˜å‚¨æ•°æ®ï¼Œè¯·é˜…è¯»æ­¤é¡µé¢ï¼š

{% content-ref url="ios-basics.md" %}
[ios-basics.md](ios-basics.md)
{% endcontent-ref %}

{% hint style="warning" %}
ä»¥ä¸‹å­˜å‚¨ä¿¡æ¯çš„åœ°æ–¹åº”è¯¥åœ¨**å®‰è£…åº”ç”¨ç¨‹åºåç«‹å³æ£€æŸ¥**ï¼Œåœ¨**æ£€æŸ¥åº”ç”¨ç¨‹åºçš„æ‰€æœ‰åŠŸèƒ½å**ï¼Œç”šè‡³åœ¨**ä»ä¸€ä¸ªç”¨æˆ·æ³¨é”€å¹¶ç™»å½•åˆ°å¦ä¸€ä¸ªç”¨æˆ·å**ä¹Ÿè¦æ£€æŸ¥ã€‚
ç›®æ ‡æ˜¯æ‰¾åˆ°åº”ç”¨ç¨‹åºçš„**æœªå—ä¿æŠ¤çš„æ•æ„Ÿä¿¡æ¯**ï¼ˆå¯†ç ã€ä»¤ç‰Œï¼‰ï¼Œå½“å‰ç”¨æˆ·å’Œä¹‹å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ã€‚
{% endhint %}

### Plist

**plist** æ–‡ä»¶æ˜¯ç»“æ„åŒ–çš„ XML æ–‡ä»¶ï¼Œ**åŒ…å«é”®å€¼å¯¹**ã€‚å®ƒæ˜¯ä¸€ç§å­˜å‚¨æŒä¹…æ•°æ®çš„æ–¹å¼ï¼Œå› æ­¤æœ‰æ—¶ä½ å¯èƒ½ä¼šåœ¨è¿™äº›æ–‡ä»¶ä¸­å‘ç°**æ•æ„Ÿä¿¡æ¯**ã€‚å»ºè®®åœ¨å®‰è£…åº”ç”¨ç¨‹åºåä»¥åŠå¯†é›†ä½¿ç”¨åæ£€æŸ¥è¿™äº›æ–‡ä»¶ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦å†™å…¥äº†æ–°æ•°æ®ã€‚

åœ¨ plist æ–‡ä»¶ä¸­æŒä¹…åŒ–æ•°æ®çš„æœ€å¸¸è§æ–¹å¼æ˜¯é€šè¿‡ä½¿ç”¨ **NSUserDefaults**ã€‚è¿™ä¸ª plist æ–‡ä»¶ä¿å­˜åœ¨åº”ç”¨ç¨‹åºæ²™ç›’ä¸­çš„ **`Library/Preferences/<appBundleID>.plist`**

[`NSUserDefaults`](https://developer.apple.com/documentation/foundation/nsuserdefaults) ç±»æä¾›äº†ä¸€ä¸ªä¸é»˜è®¤ç³»ç»Ÿäº¤äº’çš„ç¼–ç¨‹æ¥å£ã€‚é»˜è®¤ç³»ç»Ÿå…è®¸åº”ç”¨ç¨‹åºæ ¹æ®**ç”¨æˆ·åå¥½**è‡ªå®šä¹‰å…¶è¡Œä¸ºã€‚ç”± `NSUserDefaults` ä¿å­˜çš„æ•°æ®å¯ä»¥åœ¨åº”ç”¨ç¨‹åºåŒ…ä¸­æŸ¥çœ‹ã€‚è¿™ä¸ªç±»å°†**æ•°æ®**å­˜å‚¨åœ¨**plist** **æ–‡ä»¶**ä¸­ï¼Œä½†å®ƒæ—¨åœ¨ç”¨äºå°‘é‡æ•°æ®ã€‚

è¿™äº›æ•°æ®ä¸èƒ½å†é€šè¿‡å¯ä¿¡è®¡ç®—æœºç›´æ¥è®¿é—®ï¼Œä½†å¯ä»¥é€šè¿‡æ‰§è¡Œ**å¤‡ä»½**æ¥è®¿é—®ã€‚

ä½ å¯ä»¥ä½¿ç”¨ objection çš„ `ios nsuserdefaults get` **è½¬å‚¨**ä½¿ç”¨ **`NSUserDefaults`** ä¿å­˜çš„ä¿¡æ¯ã€‚

è¦æ‰¾åˆ°åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ‰€æœ‰ plistï¼Œä½ å¯ä»¥è®¿é—® `/private/var/mobile/Containers/Data/Application/{APPID}` å¹¶è¿è¡Œï¼š
```bash
find ./ -name "*.plist"
```
æ–‡ä»¶å¯èƒ½æ˜¯**XMLæˆ–äºŒè¿›åˆ¶(bplist)**æ ¼å¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å‘½ä»¤å°†å…¶**è½¬æ¢ä¸ºXML**æ ¼å¼ï¼š

*   åœ¨macOSä¸Šä½¿ç”¨`plutil`ï¼Œè¿™æ˜¯ä¸€ä¸ªè‡ªmacOS 10.2åŠä»¥ä¸Šç‰ˆæœ¬è‡ªå¸¦çš„å·¥å…·ï¼ˆç›®å‰æ²¡æœ‰å®˜æ–¹åœ¨çº¿æ–‡æ¡£ï¼‰ï¼š

```bash
$ plutil -convert xml1 Info.plist
```
*   åœ¨Linuxä¸Šï¼š

```bash
$ apt install libplist-utils
$ plistutil -i Info.plist -o Info_xml.plist
```
*   åœ¨ä¸€ä¸ªobjectionçš„ä¼šè¯ä¸­ï¼š

```bash
ios plist cat /private/var/mobile/Containers/Data/Application/AF1F534B-1B8F-0825-ACB21-C0301AB7E56D/Library/Preferences/com.some.package.app.plist
```

### Core Data

[`Core Data`](https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreData/nsfetchedresultscontroller.html#//apple_ref/doc/uid/TP40001075-CH8-SW1) æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºç®¡ç†åº”ç”¨ç¨‹åºä¸­å¯¹è±¡çš„æ¨¡å‹å±‚ã€‚[Core Dataå¯ä»¥ä½¿ç”¨SQLiteä½œä¸ºå…¶æŒä¹…å­˜å‚¨](https://cocoacasts.com/what-is-the-difference-between-core-data-and-sqlite/)ï¼Œä½†è¯¥æ¡†æ¶æœ¬èº«ä¸æ˜¯æ•°æ®åº“ã€‚\
é»˜è®¤æƒ…å†µä¸‹ï¼ŒCoreDataä¸ä¼šåŠ å¯†å…¶æ•°æ®ã€‚ç„¶è€Œï¼Œå¯ä»¥å‘CoreDataæ·»åŠ é¢å¤–çš„åŠ å¯†å±‚ã€‚æ›´å¤šè¯¦æƒ…è¯·æŸ¥çœ‹[GitHubä»“åº“](https://github.com/project-imas/encrypted-core-data)ã€‚

æ‚¨å¯ä»¥åœ¨è·¯å¾„`/private/var/mobile/Containers/Data/Application/{APPID}/Library/Application Support`ä¸­æ‰¾åˆ°åº”ç”¨ç¨‹åºçš„SQLite Core Dataä¿¡æ¯ã€‚

**å¦‚æœæ‚¨èƒ½æ‰“å¼€SQLiteå¹¶è®¿é—®æ•æ„Ÿä¿¡æ¯ï¼Œé‚£ä¹ˆæ‚¨å‘ç°äº†ä¸€ä¸ªé…ç½®é”™è¯¯ã€‚**

{% code title="æ¥è‡ªiGoatçš„ä»£ç " %}
```objectivec
-(void)storeDetails {
AppDelegate * appDelegate = (AppDelegate *)(UIApplication.sharedApplication.delegate);

NSManagedObjectContext *context =[appDelegate managedObjectContext];

User *user = [self fetchUser];
if (user) {
return;
}
user = [NSEntityDescription insertNewObjectForEntityForName:@"User"
inManagedObjectContext:context];
user.email = CoreDataEmail;
user.password = CoreDataPassword;
NSError *error;
if (![context save:&error]) {
NSLog(@"Error in saving data: %@", [error localizedDescription]);

}else{
NSLog(@"data stored in core data");
}
}
```
{% endcode %}

### YapDatabase

[YapDatabase](https://github.com/yapstudios/YapDatabase) æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨ SQLite ä¹‹ä¸Šçš„é”®/å€¼å­˜å‚¨åº“ã€‚\
ç”±äº Yap æ•°æ®åº“æ˜¯ sqlite æ•°æ®åº“ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸Šä¸€èŠ‚ä¸­æå‡ºçš„å‘½ä»¤æ‰¾åˆ°å®ƒä»¬ã€‚

### å…¶ä»– SQLite æ•°æ®åº“

åº”ç”¨ç¨‹åºåˆ›å»ºè‡ªå·±çš„ sqlite æ•°æ®åº“æ˜¯å¾ˆå¸¸è§çš„ã€‚å®ƒä»¬å¯èƒ½ä¼šåœ¨è¿™äº›æ•°æ®åº“ä¸Š**å­˜å‚¨** **æ•æ„Ÿ** **æ•°æ®**ï¼Œå¹¶ä¸”ç•™ä¸‹æœªåŠ å¯†çš„æ•°æ®ã€‚å› æ­¤ï¼Œæ£€æŸ¥åº”ç”¨ç¨‹åºç›®å½•å†…çš„æ¯ä¸€ä¸ªæ•°æ®åº“æ€»æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ã€‚æ‰€ä»¥è¯·å‰å¾€ä¿å­˜æ•°æ®çš„åº”ç”¨ç¨‹åºç›®å½•ï¼ˆ`/private/var/mobile/Containers/Data/Application/{APPID}`ï¼‰
```bash
find ./ -name "*.sqlite" -or -name "*.db"
```
### Firebase å®æ—¶æ•°æ®åº“

å®ƒå¯ä»¥è¢«åº”ç”¨ç¨‹åºå¼€å‘è€…åˆ©ç”¨æ¥**å­˜å‚¨å’ŒåŒæ­¥æ•°æ®åˆ°ä¸€ä¸ª NoSQL äº‘æ‰˜ç®¡æ•°æ®åº“**ã€‚æ•°æ®ä»¥ JSON å½¢å¼å­˜å‚¨ï¼Œå¹¶å®æ—¶åŒæ­¥åˆ°æ¯ä¸ªè¿æ¥çš„å®¢æˆ·ç«¯ï¼Œå³ä½¿åº”ç”¨ç¨‹åºç¦»çº¿ï¼Œæ•°æ®ä¹Ÿä¾ç„¶å¯ç”¨ã€‚

æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å¦‚ä½•æ£€æŸ¥é…ç½®ä¸å½“çš„ Firebase æ•°æ®åº“çš„æ–¹æ³•ï¼š

{% content-ref url="../../network-services-pentesting/pentesting-web/buckets/firebase-database.md" %}
[firebase-database.md](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)
{% endcontent-ref %}

### Realm æ•°æ®åº“

[Realm Objective-C](https://realm.io/docs/objc/latest/) å’Œ [Realm Swift](https://realm.io/docs/swift/latest/) å¹¶éç”±è‹¹æœæä¾›ï¼Œä½†å®ƒä»¬ä»ç„¶å€¼å¾—æ³¨æ„ã€‚å®ƒä»¬**å­˜å‚¨æ‰€æœ‰å†…å®¹æœªåŠ å¯†ï¼Œé™¤éé…ç½®å¯ç”¨äº†åŠ å¯†**ã€‚

æ‚¨å¯ä»¥åœ¨ `/private/var/mobile/Containers/Data/Application/{APPID}` æ‰¾åˆ°è¿™äº›æ•°æ®åº“ã€‚
```bash
iPhone:/private/var/mobile/Containers/Data/Application/A079DF84-726C-4AEA-A194-805B97B3684A/Documents root# ls
default.realm  default.realm.lock  default.realm.management/  default.realm.note|

$ find ./ -name "*.realm*"
```
```markdown
æ‚¨å¯ä»¥ä½¿ç”¨å·¥å…· [**Realm Studio**](https://github.com/realm/realm-studio) æ¥æ‰“å¼€è¿™äº›æ•°æ®åº“æ–‡ä»¶ã€‚

ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨Realmæ•°æ®åº“ä¸­ä½¿ç”¨åŠ å¯†ï¼š
```
```swift
// Open the encrypted Realm file where getKey() is a method to obtain a key from the Keychain or a server
let config = Realm.Configuration(encryptionKey: getKey())
do {
let realm = try Realm(configuration: config)
// Use the Realm as normal
} catch let error as NSError {
// If the encryption key is wrong, `error` will say that it's an invalid database
fatalError("Error opening realm: \(error)")
}
```
### Couchbaseè½»é‡çº§æ•°æ®åº“

[Couchbase Lite](https://github.com/couchbase/couchbase-lite-ios) æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€åµŒå…¥å¼çš„ã€é¢å‘æ–‡æ¡£çš„ï¼ˆNoSQLï¼‰æ•°æ®åº“å¼•æ“ï¼Œå¯ä»¥è¿›è¡ŒåŒæ­¥ã€‚å®ƒä¸ºiOSå’ŒmacOSæä¾›äº†åŸç”Ÿç¼–è¯‘ã€‚

æ£€æŸ¥å¯èƒ½å­˜åœ¨çš„couchbaseæ•°æ®åº“ï¼Œåœ¨ `/private/var/mobile/Containers/Data/Application/{APPID}/Library/Application Support/` è·¯å¾„ä¸‹ã€‚

### Cookies

iOSå°†åº”ç”¨çš„cookieså­˜å‚¨åœ¨æ¯ä¸ªåº”ç”¨æ–‡ä»¶å¤¹å†…çš„ **`Library/Cookies/cookies.binarycookies`** ä¸­ã€‚ç„¶è€Œï¼Œå¼€å‘è€…æœ‰æ—¶å†³å®šå°†å®ƒä»¬ä¿å­˜åœ¨ **keychain** ä¸­ï¼Œå› ä¸ºä¸Šè¿°çš„ **cookieæ–‡ä»¶å¯ä»¥åœ¨å¤‡ä»½ä¸­è¢«è®¿é—®**ã€‚

è¦æ£€æŸ¥cookiesæ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨[**è¿™ä¸ªpythonè„šæœ¬**](https://github.com/mdegrazia/Safari-Binary-Cookie-Parser) æˆ–ä½¿ç”¨objectionçš„ **`ios cookies get`.**\
**ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨objection** å°†è¿™äº›æ–‡ä»¶è½¬æ¢ä¸ºJSONæ ¼å¼å¹¶æ£€æŸ¥æ•°æ®ã€‚
```bash
...itudehacks.DVIAswiftv2.develop on (iPhone: 13.2.3) [usb] # ios cookies get --json
[
{
"domain": "highaltitudehacks.com",
"expiresDate": "2051-09-15 07:46:43 +0000",
"isHTTPOnly": "false",
"isSecure": "false",
"name": "username",
"path": "/",
"value": "admin123",
"version": "0"
}
]
```
### ç¼“å­˜

é»˜è®¤æƒ…å†µä¸‹ï¼ŒNSURLSession ä¼šå°†æ•°æ®ï¼ˆå¦‚ **HTTP è¯·æ±‚å’Œå“åº”å­˜å‚¨åœ¨ Cache.db** æ•°æ®åº“ä¸­ï¼‰ã€‚å¦‚æœç¼“å­˜äº†ä»¤ç‰Œã€ç”¨æˆ·åæˆ–ä»»ä½•å…¶ä»–æ•æ„Ÿä¿¡æ¯ï¼Œè¿™ä¸ªæ•°æ®åº“å¯èƒ½åŒ…å«**æ•æ„Ÿæ•°æ®**ã€‚è¦æŸ¥æ‰¾ç¼“å­˜çš„ä¿¡æ¯ï¼Œè¯·æ‰“å¼€åº”ç”¨çš„æ•°æ®ç›®å½•ï¼ˆ`/var/mobile/Containers/Data/Application/<UUID>`ï¼‰ï¼Œç„¶åè½¬åˆ° `/Library/Caches/<Bundle Identifier>`ã€‚**WebKit ç¼“å­˜ä¹Ÿå­˜å‚¨åœ¨ Cache.db** æ–‡ä»¶ä¸­ã€‚**Objection** å¯ä»¥ä½¿ç”¨å‘½ä»¤ `sqlite connect Cache.db` æ‰“å¼€å¹¶ä¸æ•°æ®åº“äº¤äº’ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª**æ™®é€šçš„ SQLite æ•°æ®åº“**ã€‚

**å»ºè®®ç¦ç”¨ç¼“å­˜è¿™äº›æ•°æ®**ï¼Œå› ä¸ºè¯·æ±‚æˆ–å“åº”ä¸­å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚ä¸‹é¢çš„åˆ—è¡¨æ˜¾ç¤ºäº†å®ç°è¿™ä¸€ç›®æ ‡çš„ä¸åŒæ–¹æ³•ï¼š

1. å»ºè®®åœ¨æ³¨é”€ååˆ é™¤ç¼“å­˜çš„å“åº”ã€‚è¿™å¯ä»¥é€šè¿‡ Apple æä¾›çš„åä¸º [`removeAllCachedResponses`](https://developer.apple.com/documentation/foundation/urlcache/1417802-removeallcachedresponses) çš„æ–¹æ³•æ¥å®Œæˆã€‚æ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è°ƒç”¨æ­¤æ–¹æ³•ï¼š

`URLCache.shared.removeAllCachedResponses()`

æ­¤æ–¹æ³•å°†ä» Cache.db æ–‡ä»¶ä¸­åˆ é™¤æ‰€æœ‰ç¼“å­˜çš„è¯·æ±‚å’Œå“åº”ã€‚
2. å¦‚æœæ‚¨ä¸éœ€è¦ä½¿ç”¨ cookies çš„ä¼˜åŠ¿ï¼Œå»ºè®®åªä½¿ç”¨ URLSession çš„ [.ephemeral](https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1410529-ephemeral) é…ç½®å±æ€§ï¼Œè¿™å°†ç¦ç”¨ä¿å­˜ cookies å’Œç¼“å­˜ã€‚

[Apple æ–‡æ¡£](https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1410529-ephemeral)ï¼š

`ä¸€ä¸ªä¸´æ—¶ä¼šè¯é…ç½®å¯¹è±¡ç±»ä¼¼äºé»˜è®¤ä¼šè¯é…ç½®ï¼ˆè§ defaultï¼‰ï¼Œé™¤äº†ç›¸åº”çš„ä¼šè¯å¯¹è±¡ä¸ä¼šå°†ç¼“å­˜ã€å‡­è¯å­˜å‚¨æˆ–ä»»ä½•ä¼šè¯ç›¸å…³æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ã€‚ç›¸åï¼Œä¼šè¯ç›¸å…³æ•°æ®å­˜å‚¨åœ¨ RAM ä¸­ã€‚ä¸´æ—¶ä¼šè¯å°†æ•°æ®å†™å…¥ç£ç›˜çš„å”¯ä¸€æ—¶é—´æ˜¯å½“æ‚¨å‘Šè¯‰å®ƒå°† URL çš„å†…å®¹å†™å…¥æ–‡ä»¶æ—¶ã€‚`
3. ä¹Ÿå¯ä»¥é€šè¿‡å°†ç¼“å­˜ç­–ç•¥è®¾ç½®ä¸º [.notAllowed](https://developer.apple.com/documentation/foundation/urlcache/storagepolicy/notallowed) æ¥ç¦ç”¨ç¼“å­˜ã€‚å®ƒå°†ç¦ç”¨ä»¥ä»»ä½•æ–¹å¼å­˜å‚¨ç¼“å­˜ï¼Œæ— è®ºæ˜¯åœ¨å†…å­˜ä¸­è¿˜æ˜¯åœ¨ç£ç›˜ä¸Šã€‚

### å¿«ç…§

æ¯å½“æ‚¨æŒ‰ä¸‹ä¸»å±å¹•æŒ‰é’®æ—¶ï¼ŒiOS **ä¼šå¯¹å½“å‰å±å¹•è¿›è¡Œå¿«ç…§**ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ›´å¹³æ»‘åœ°è¿‡æ¸¡åˆ°åº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼Œå¦‚æœå½“å‰å±å¹•ä¸­å­˜åœ¨**æ•æ„Ÿ** **æ•°æ®**ï¼Œå®ƒå°†è¢«**ä¿å­˜**åœ¨**å›¾åƒ**ä¸­ï¼ˆè¿™**æŒç»­** **è·¨è¶Š** **é‡å¯**ï¼‰ã€‚è¿™äº›å¿«ç…§ä¹Ÿå¯ä»¥é€šè¿‡åŒå‡»ä¸»å±å¹•æŒ‰é’®åœ¨åº”ç”¨ä¹‹é—´åˆ‡æ¢æ—¶è®¿é—®ã€‚

é™¤é iPhone è¢«è¶Šç‹±ï¼Œå¦åˆ™**æ”»å‡»è€…**éœ€è¦æœ‰**è®¿é—®** **è®¾å¤‡** **æœªé”å®š**çš„æƒé™æ‰èƒ½çœ‹åˆ°è¿™äº›æˆªå›¾ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€åä¸€ä¸ªå¿«ç…§å­˜å‚¨åœ¨åº”ç”¨ç¨‹åºçš„æ²™ç›’ä¸­çš„ `Library/Caches/Snapshots/` æˆ– `Library/SplashBoard/Snapshots` æ–‡ä»¶å¤¹ä¸­ï¼ˆä» iOS 7.0 å¼€å§‹ï¼Œå—ä¿¡ä»»çš„è®¡ç®—æœºæ— æ³•è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚

é˜²æ­¢è¿™ç§ä¸è‰¯è¡Œä¸ºçš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨ä½¿ç”¨ `ApplicationDidEnterBackground()` å‡½æ•°è¿›è¡Œå¿«ç…§ä¹‹å‰æ”¾ç½®ä¸€ä¸ªç©ºç™½å±å¹•æˆ–åˆ é™¤æ•æ„Ÿæ•°æ®ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªè®¾ç½®é»˜è®¤æˆªå›¾çš„æ ·æœ¬ä¿®å¤æ–¹æ³•ã€‚

Swiftï¼š
```swift
private var backgroundImage: UIImageView?

func applicationDidEnterBackground(_ application: UIApplication) {
let myBanner = UIImageView(image: #imageLiteral(resourceName: "overlayImage"))
myBanner.frame = UIScreen.main.bounds
backgroundImage = myBanner
window?.addSubview(myBanner)
}

func applicationWillEnterForeground(_ application: UIApplication) {
backgroundImage?.removeFromSuperview()
}
```
Objective-C:
```
@property (UIImageView *)backgroundImage;

- (void)applicationDidEnterBackground:(UIApplication *)application {
UIImageView *myBanner = [[UIImageView alloc] initWithImage:@"overlayImage.png"];
self.backgroundImage = myBanner;
self.backgroundImage.bounds = UIScreen.mainScreen.bounds;
[self.window addSubview:myBanner];
}

- (void)applicationWillEnterForeground:(UIApplication *)application {
[self.backgroundImage removeFromSuperview];
}
```
è¿™å°†åœ¨åº”ç”¨ç¨‹åºè¿›å…¥åå°æ—¶å°†èƒŒæ™¯å›¾ç‰‡è®¾ç½®ä¸º`overlayImage.png`ã€‚å®ƒå¯ä»¥é˜²æ­¢æ•æ„Ÿæ•°æ®æ³„éœ²ï¼Œå› ä¸º`overlayImage.png`å°†å§‹ç»ˆè¦†ç›–å½“å‰è§†å›¾ã€‚

### é’¥åŒ™ä¸²

å·¥å…·å¦‚ [**Keychain-Dumper**](https://github.com/ptoomey3/Keychain-Dumper) å¯ç”¨äºè½¬å‚¨é’¥åŒ™ä¸²ï¼ˆè®¾å¤‡å¿…é¡»è¶Šç‹±ï¼‰ã€‚\
æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ [**Objection**](https://github.com/sensepost/objection) ä¸­çš„ `ios keychain dump`**ã€‚**

**NSURLCredential**

**NSURLCredential** æ˜¯å°†**ç”¨æˆ·åå’Œå¯†ç å­˜å‚¨åœ¨é’¥åŒ™ä¸²ä¸­**çš„å®Œç¾ç±»ã€‚æ— éœ€çƒ¦æ¼ NSUserDefaults æˆ–ä»»ä½•é’¥åŒ™ä¸²åŒ…è£…å™¨ã€‚\
ä¸€æ—¦ç”¨æˆ·ç™»å½•ï¼Œæ‚¨å¯ä»¥å°†ä»–çš„ç”¨æˆ·åå’Œå¯†ç å­˜å‚¨åˆ°é’¥åŒ™ä¸²ï¼š
```swift
NSURLCredential *credential;

credential = [NSURLCredential credentialWithUser:username password:password persistence:NSURLCredentialPersistencePermanent];
[[NSURLCredentialStorage sharedCredentialStorage] setCredential:credential forProtectionSpace:self.loginProtectionSpace];
```
æ‚¨å¯ä»¥ä½¿ç”¨ **Objection** çš„ `ios nsurlcredentialstorage dump` æ¥å¯¼å‡ºè¿™äº›ç§˜å¯†ä¿¡æ¯ã€‚

## è‡ªå®šä¹‰é”®ç›˜/é”®ç›˜ç¼“å­˜

ä»iOS 8.0å¼€å§‹ï¼Œè‹¹æœå…è®¸ä¸ºiOSå®‰è£…è‡ªå®šä¹‰æ‰©å±•ï¼Œå¦‚è‡ªå®šä¹‰é”®ç›˜ã€‚\
å·²å®‰è£…çš„é”®ç›˜å¯ä»¥é€šè¿‡ **è®¾ç½®** > **é€šç”¨** > **é”®ç›˜** > **é”®ç›˜** ç®¡ç†ã€‚\
è‡ªå®šä¹‰é”®ç›˜å¯ä»¥ç”¨æ¥**å—…æ¢** **æŒ‰é”®æ“ä½œ**å¹¶å°†å®ƒä»¬å‘é€åˆ°æ”»å‡»è€…æœåŠ¡å™¨ã€‚ä½†è¯·æ³¨æ„ï¼Œ**éœ€è¦ç½‘ç»œè¿æ¥çš„è‡ªå®šä¹‰é”®ç›˜ä¼šé€šçŸ¥ç”¨æˆ·ã€‚**\
æ­¤å¤–ï¼Œ**ç”¨æˆ·å¯ä»¥åˆ‡æ¢åˆ°ä¸åŒçš„**ï¼ˆæ›´å€¼å¾—ä¿¡èµ–çš„ï¼‰**é”®ç›˜**æ¥è¾“å…¥å‡­æ®ã€‚

æ­¤å¤–ï¼Œ**åº”ç”¨ç¨‹åºå¯ä»¥é˜»æ­¢ç”¨æˆ·åœ¨åº”ç”¨å†…ä½¿ç”¨è‡ªå®šä¹‰é”®ç›˜**ï¼ˆæˆ–è‡³å°‘å¯¹åº”ç”¨çš„æ•æ„Ÿéƒ¨åˆ†ï¼‰ã€‚

{% hint style="warning" %}
å¦‚æœæ‚¨è®¤ä¸ºç”¨æˆ·ä¸éœ€è¦ç¬¬ä¸‰æ–¹é”®ç›˜ï¼Œå»ºè®®ä¸å…è®¸ä½¿ç”¨ç¬¬ä¸‰æ–¹é”®ç›˜ã€‚
{% endhint %}

è¯·æ³¨æ„ï¼Œç”±äºè‡ªåŠ¨æ›´æ­£å’Œè‡ªåŠ¨å»ºè®®åŠŸèƒ½ï¼Œå¦‚æœæ²¡æœ‰å°†å±æ€§ **secureTextEntry** è®¾ç½®ä¸º **true** æˆ– **autoCorrectionType** è®¾ç½®ä¸º **UITextAutoCorrectionTypeNo**ï¼Œé»˜è®¤çš„iOSé”®ç›˜ä¼šåœ¨ç¼“å­˜æ–‡ä»¶ä¸­æ•è·å¹¶å­˜å‚¨æ¯ä¸ªéæ ‡å‡†å•è¯ã€‚\
é»˜è®¤æƒ…å†µä¸‹ï¼Œé”®ç›˜ä¼šåœ¨åº”ç”¨ç¨‹åºæ²™ç›’çš„ `Library/Keyboard/{locale}-dynamic-text.dat` æ–‡ä»¶æˆ– `/private/var/mobile/Library/Keyboard/dynamic-text.dat` ä¸­**å­˜å‚¨è¿™ä¸ªç¼“å­˜**ã€‚ç„¶è€Œï¼Œå®ƒå¯èƒ½ä¼šå°†æ•°æ®ä¿å­˜åœ¨å…¶ä»–åœ°æ–¹ã€‚\
å¯ä»¥åœ¨ _**è®¾ç½®**_ > _**é€šç”¨**_ > _**é‡ç½®**_ > _**é‡ç½®é”®ç›˜å­—å…¸**_ ä¸­é‡ç½®ç¼“å­˜ã€‚

{% hint style="info" %}
å› æ­¤ï¼Œ**å§‹ç»ˆæ£€æŸ¥è¿™äº›æ–‡ä»¶**å¹¶æœç´¢å¯èƒ½çš„**æ•æ„Ÿ** **ä¿¡æ¯**ã€‚\
**æ‹¦æˆªç½‘ç»œæµé‡**æ˜¯å¦ä¸€ç§æ£€æŸ¥è‡ªå®šä¹‰é”®ç›˜æ˜¯å¦å°†æŒ‰é”®æ“ä½œå‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æ–¹æ³•ã€‚
{% endhint %}

[UITextInputTraits åè®®](https://developer.apple.com/reference/uikit/uitextinputtraits) ç”¨äºé”®ç›˜ç¼“å­˜ã€‚UITextFieldã€UITextView å’Œ UISearchBar ç±»è‡ªåŠ¨æ”¯æŒæ­¤åè®®ï¼Œå¹¶æä¾›ä»¥ä¸‹å±æ€§ï¼š

* `var autocorrectionType: UITextAutocorrectionType` å†³å®šåœ¨æ‰“å­—æ—¶æ˜¯å¦å¯ç”¨è‡ªåŠ¨æ›´æ­£ã€‚å½“å¯ç”¨è‡ªåŠ¨æ›´æ­£æ—¶ï¼Œæ–‡æœ¬å¯¹è±¡ä¼šè·Ÿè¸ªæœªçŸ¥å•è¯å¹¶å»ºè®®åˆé€‚çš„æ›¿æ¢è¯ï¼Œé™¤éç”¨æˆ·è¦†ç›–æ›¿æ¢ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨æ›¿æ¢è¾“å…¥çš„æ–‡æœ¬ã€‚æ­¤å±æ€§çš„é»˜è®¤å€¼æ˜¯ `UITextAutocorrectionTypeDefault`ï¼Œå¯¹äºå¤§å¤šæ•°è¾“å…¥æ–¹æ³•æ¥è¯´ï¼Œä¼šå¯ç”¨è‡ªåŠ¨æ›´æ­£ã€‚
* `var secureTextEntry: BOOL` å†³å®šæ˜¯å¦ç¦ç”¨æ–‡æœ¬å¤åˆ¶å’Œæ–‡æœ¬ç¼“å­˜ï¼Œå¹¶éšè— `UITextField` è¾“å…¥çš„æ–‡æœ¬ã€‚æ­¤å±æ€§çš„é»˜è®¤å€¼æ˜¯ `NO`ã€‚

**è¦åœ¨ä»£ç ä¸­è¯†åˆ«æ­¤è¡Œä¸ºï¼š**

* æœç´¢æºä»£ç ä¸­çš„ç±»ä¼¼å®ç°ï¼Œä¾‹å¦‚
```objectivec
textObject.autocorrectionType = UITextAutocorrectionTypeNo;
textObject.secureTextEntry = YES;
```
* åœ¨Xcodeçš„`Interface Builder`ä¸­æ‰“å¼€xibå’Œstoryboardæ–‡ä»¶ï¼Œå¹¶åœ¨`Attributes Inspector`ä¸­éªŒè¯é€‚å½“å¯¹è±¡çš„`Secure Text Entry`å’Œ`Correction`çš„çŠ¶æ€ã€‚

åº”ç”¨ç¨‹åºå¿…é¡»é˜²æ­¢æ•æ„Ÿä¿¡æ¯è¾“å…¥åˆ°æ–‡æœ¬å­—æ®µä¸­çš„ç¼“å­˜ã€‚æ‚¨å¯ä»¥é€šè¿‡ç¼–ç¨‹ç¦ç”¨ç¼“å­˜ï¼Œä½¿ç”¨`textObject.autocorrectionType = UITextAutocorrectionTypeNo`æŒ‡ä»¤åœ¨æ‰€éœ€çš„UITextFieldsã€UITextViewså’ŒUISearchBarsä¸­å®ç°ã€‚å¯¹äºåº”è¯¥æ©ç çš„æ•°æ®ï¼Œå¦‚PINç å’Œå¯†ç ï¼Œè®¾ç½®`textObject.secureTextEntry`ä¸º`YES`ã€‚
```objectivec
UITextField *textField = [ [ UITextField alloc ] initWithFrame: frame ];
textField.autocorrectionType = UITextAutocorrectionTypeNo;
```
## **æ—¥å¿—**

è°ƒè¯•ä»£ç æœ€å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ—¥å¿—è®°å½•ï¼Œåº”ç”¨ç¨‹åº**å¯èƒ½ä¼šåœ¨æ—¥å¿—ä¸­æ‰“å°æ•æ„Ÿä¿¡æ¯**ã€‚\
åœ¨iOS 6åŠä»¥ä¸‹ç‰ˆæœ¬ä¸­ï¼Œæ—¥å¿—æ˜¯å…¨çƒå¯è¯»çš„ï¼ˆæ¶æ„åº”ç”¨ç¨‹åºå¯ä»¥è¯»å–å…¶ä»–åº”ç”¨ç¨‹åºçš„æ—¥å¿—å¹¶ä»ä¸­æå–æ•æ„Ÿä¿¡æ¯ï¼‰ã€‚**å¦‚ä»Šï¼Œåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®å®ƒä»¬è‡ªå·±çš„æ—¥å¿—**ã€‚

ç„¶è€Œï¼Œæ‹¥æœ‰**ç‰©ç†** **è®¿é—®**æƒé™çš„**æ”»å‡»è€…**å¯ä»¥å°†è®¾å¤‡è¿æ¥åˆ°è®¡ç®—æœºå¹¶**è¯»å–æ—¥å¿—**ï¼ˆè¯·æ³¨æ„ï¼Œå¦‚æœåº”ç”¨ç¨‹åºè¢«å¸è½½ï¼Œç”±åº”ç”¨ç¨‹åºå†™å…¥ç£ç›˜çš„æ—¥å¿—ä¸ä¼šè¢«åˆ é™¤ï¼‰ã€‚

å»ºè®®**æµè§ˆåº”ç”¨ç¨‹åºçš„æ‰€æœ‰å±å¹•**ï¼Œä¸**æ¯ä¸ª**ç”¨æˆ·ç•Œé¢å…ƒç´ å’Œ**åŠŸèƒ½**è¿›è¡Œ**äº¤äº’**ï¼Œåœ¨æ‰€æœ‰æ–‡æœ¬å­—æ®µä¸­æä¾›è¾“å…¥æ–‡æœ¬ï¼Œå¹¶**æŸ¥çœ‹æ—¥å¿—**ï¼Œå¯»æ‰¾æš´éœ²çš„**æ•æ„Ÿ** **ä¿¡æ¯**ã€‚

ä½¿ç”¨ä»¥ä¸‹å…³é”®è¯æ£€æŸ¥åº”ç”¨ç¨‹åºæºä»£ç ä¸­çš„é¢„å®šä¹‰å’Œè‡ªå®šä¹‰æ—¥å¿—è®°å½•è¯­å¥ï¼š

* å¯¹äºé¢„å®šä¹‰å’Œå†…ç½®å‡½æ•°ï¼š
* NSLog
* NSAssert
* NSCAssert
* fprintf
* å¯¹äºè‡ªå®šä¹‰å‡½æ•°ï¼š
* Logging
* Logfile

**ç›‘æ§ç³»ç»Ÿæ—¥å¿—**

è®¸å¤šåº”ç”¨ç¨‹åºä¼šå°†ä¿¡æ¯æ€§ï¼ˆå¹¶ä¸”å¯èƒ½æ˜¯æ•æ„Ÿçš„ï¼‰æ¶ˆæ¯è®°å½•åˆ°æ§åˆ¶å°æ—¥å¿—ä¸­ã€‚æ—¥å¿—è¿˜åŒ…å«å´©æºƒæŠ¥å‘Šå’Œå…¶ä»–æœ‰ç”¨ä¿¡æ¯ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·ï¼š
```bash
idevice_id --list   # To find the device ID
idevicesyslog -u <id> (| grep <app>)   # To get the device logs
```
æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é€šè¿‡Xcode **è®¾å¤‡**çª—å£æ”¶é›†æ§åˆ¶å°æ—¥å¿—ï¼š

1. å¯åŠ¨Xcodeã€‚
2. å°†æ‚¨çš„è®¾å¤‡è¿æ¥åˆ°ä¸»æœºç”µè„‘ã€‚
3. é€‰æ‹© **çª—å£** -> **è®¾å¤‡ä¸æ¨¡æ‹Ÿå™¨**ã€‚
4. åœ¨è®¾å¤‡çª—å£çš„å·¦ä¾§éƒ¨åˆ†ç‚¹å‡»æ‚¨å·²è¿æ¥çš„iOSè®¾å¤‡ã€‚
5. å¤ç°é—®é¢˜ã€‚
6. ç‚¹å‡»ä½äºè®¾å¤‡çª—å£å³ä¸Šè§’çš„ **æ‰“å¼€æ§åˆ¶å°** æŒ‰é’®ï¼Œåœ¨å•ç‹¬çš„çª—å£ä¸­æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ã€‚

![](<../../.gitbook/assets/image (466) (2) (2) (2) (2) (2) (2) (2) (3) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (15).png>)

æ‚¨è¿˜å¯ä»¥æŒ‰ç…§åœ¨è®¿é—®è®¾å¤‡Shellä¸­è§£é‡Šçš„æ–¹æ³•è¿æ¥åˆ°è®¾å¤‡Shellï¼Œé€šè¿‡ **apt-get** å®‰è£… **socat** å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
iPhone:~ root# socat - UNIX-CONNECT:/var/run/lockdown/syslog.sock

========================
ASL is here to serve you
> watch
OK

Jun  7 13:42:14 iPhone chmod[9705] <Notice>: MS:Notice: Injecting: (null) [chmod] (1556.00)
Jun  7 13:42:14 iPhone readlink[9706] <Notice>: MS:Notice: Injecting: (null) [readlink] (1556.00)
Jun  7 13:42:14 iPhone rm[9707] <Notice>: MS:Notice: Injecting: (null) [rm] (1556.00)
Jun  7 13:42:14 iPhone touch[9708] <Notice>: MS:Notice: Injecting: (null) [touch] (1556.00)
...
```
<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) æ¥è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œè¿™äº›å·¥ä½œæµç¨‹ç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›çš„**ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## å¤‡ä»½

iOS åŒ…å«è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½ï¼Œå¯ä»¥åˆ›å»ºå­˜å‚¨åœ¨è®¾å¤‡ä¸Šçš„æ•°æ®çš„å‰¯æœ¬ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ iTunesï¼ˆç›´åˆ° macOS Catalinaï¼‰æˆ– Finderï¼ˆä» macOS Catalina å¼€å§‹ï¼‰ä»ä¸»æœºè®¡ç®—æœº**åˆ›å»º iOS å¤‡ä»½**ï¼Œæˆ–é€šè¿‡ iCloud å¤‡ä»½åŠŸèƒ½ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå¤‡ä»½å‡ ä¹åŒ…æ‹¬ iOS è®¾å¤‡ä¸Šå­˜å‚¨çš„æ‰€æœ‰æ•°æ®ï¼Œé™¤äº†åƒ Apple Pay ä¿¡æ¯å’Œ Touch ID è®¾ç½®è¿™æ ·çš„é«˜åº¦æ•æ„Ÿæ•°æ®ã€‚

ç”±äº iOS ä¼šå¤‡ä»½å·²å®‰è£…çš„åº”ç”¨åŠå…¶æ•°æ®ï¼Œä¸€ä¸ªæ˜æ˜¾çš„æ‹…å¿§æ˜¯åº”ç”¨å­˜å‚¨çš„**æ•æ„Ÿç”¨æˆ·æ•°æ®**æ˜¯å¦å¯èƒ½**é€šè¿‡å¤‡ä»½æ— æ„ä¸­æ³„éœ²**ã€‚å¦ä¸€ä¸ªè¾ƒä¸æ˜æ˜¾çš„æ‹…å¿§æ˜¯ï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡ä¿®æ”¹å¤‡ä»½æ¥æ›´æ”¹åº”ç”¨è¡Œä¸ºï¼Œä»¥æ­¤æ¥ç¯¡æ”¹ç”¨äºä¿æŠ¤æ•°æ®æˆ–é™åˆ¶åº”ç”¨åŠŸèƒ½çš„**æ•æ„Ÿé…ç½®è®¾ç½®**ã€‚è¿™ä¸¤ç§æ‹…å¿§éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™äº›æ¼æ´åœ¨å½“ä»Šå¤§é‡åº”ç”¨ä¸­è¢«è¯å®å­˜åœ¨ã€‚

åœ¨å®‰è£…äº†ç§»åŠ¨åº”ç”¨çš„è®¾å¤‡ä¸Šçš„å¤‡ä»½å°†åŒ…æ‹¬ [åº”ç”¨çš„ç§æœ‰ç›®å½•](https://developer.apple.com/library/content/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html#//apple\_ref/doc/uid/TP40010672-CH2-SW12) ä¸­çš„æ‰€æœ‰å­ç›®å½•ï¼ˆ`Library/Caches/` é™¤å¤–ï¼‰å’Œæ–‡ä»¶ã€‚\
å› æ­¤ï¼Œ**é¿å…åœ¨åº”ç”¨çš„ç§æœ‰ç›®å½•æˆ–å­ç›®å½•ä¸­çš„ä»»ä½•æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å†…ä»¥æ˜æ–‡å­˜å‚¨æ•æ„Ÿæ•°æ®**ã€‚

å°½ç®¡ `Documents/` å’Œ `Library/Application Support/` ä¸­çš„æ‰€æœ‰æ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹éƒ½ä¼šè¢«å¤‡ä»½ï¼Œä½†æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ `NSURL setResourceValue:forKey:error:` å¹¶ä½¿ç”¨ `NSURLIsExcludedFromBackupKey` é”®æ¥[ä»å¤‡ä»½ä¸­æ’é™¤æ–‡ä»¶](https://developer.apple.com/library/content/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html#//apple\_ref/doc/uid/TP40010672-CH2-SW28)ã€‚\
æ‚¨å¯ä»¥ä½¿ç”¨ [NSURLIsExcludedFromBackupKey](https://developer.apple.com/reference/foundation/nsurl#//apple\_ref/c/data/NSURLIsExcludedFromBackupKey) å’Œ [CFURLIsExcludedFromBackupKey](https://developer.apple.com/reference/corefoundation/cfurl-rd7#//apple\_ref/c/data/kCFURLIsExcludedFromBackupKey) æ–‡ä»¶ç³»ç»Ÿå±æ€§æ¥æ’é™¤å¤‡ä»½ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚

{% hint style="warning" %}
å› æ­¤ï¼Œåœ¨æ£€æŸ¥åº”ç”¨çš„å¤‡ä»½æ—¶ï¼Œæ‚¨åº”è¯¥æ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®**ä»»ä½•æ•æ„Ÿä¿¡æ¯**ï¼Œä»¥åŠæ˜¯å¦å¯ä»¥é€šè¿‡**ä¿®æ”¹å¤‡ä»½çš„æŸäº›è®¾ç½®**æ¥**ä¿®æ”¹åº”ç”¨çš„ä»»ä½•æ•æ„Ÿè¡Œä¸º**å¹¶æ¢å¤å¤‡ä»½
{% endhint %}

**å¦‚ä½•æµ‹è¯•**

é¦–å…ˆ**åˆ›å»ºè®¾å¤‡çš„å¤‡ä»½**ï¼ˆæ‚¨å¯ä»¥ä½¿ç”¨ Finder è¿›è¡Œï¼‰ï¼Œå¹¶æ‰¾å‡ºå¤‡ä»½å­˜å‚¨çš„ä½ç½®ã€‚å®˜æ–¹ Apple æ–‡æ¡£å°†å¸®åŠ©æ‚¨[æ‰¾åˆ°æ‚¨çš„ iPhoneã€iPad å’Œ iPod touch çš„å¤‡ä»½](https://support.apple.com/en-us/HT204215)ã€‚

ä¸€æ—¦æ‚¨æ‰¾åˆ°äº†è®¾å¤‡çš„å¤‡ä»½ï¼ˆ`/Users/carlos.martin/Library/Application Support/MobileSync/Backup/{deviceID}`ï¼‰ï¼Œæ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨ grep ç­‰å·¥å…·ï¼Œæˆ–ä½¿ç”¨åƒ [iMazing](https://imazing.com) è¿™æ ·çš„å·¥å…·æ¥å¯»æ‰¾æ•æ„Ÿä¿¡æ¯ã€‚

è¦è¯†åˆ«å¤‡ä»½æ˜¯å¦åŠ å¯†ï¼Œæ‚¨å¯ä»¥ä»ä½äºå¤‡ä»½ç›®å½•æ ¹ç›®å½•çš„ "Manifest.plist" æ–‡ä»¶ä¸­æ£€æŸ¥åä¸º "IsEncrypted" çš„é”®ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†è¡¨æ˜å¤‡ä»½å·²åŠ å¯†çš„é…ç½®ï¼š
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
...
<key>Date</key>
<date>2021-03-12T17:43:33Z</date>
<key>IsEncrypted</key>
<true/>
...
</plist>
```
```markdown
å¦‚æœæ‚¨éœ€è¦å¤„ç†åŠ å¯†å¤‡ä»½ï¼Œå¯ä»¥åœ¨ [DinoSec çš„ GitHub ä»“åº“](https://github.com/dinosec/iphone-dataprotection/tree/master/python_scripts)ä¸­æ‰¾åˆ°ä¸€äº› Python è„šæœ¬ï¼Œä¾‹å¦‚ **backup_tool.py** å’Œ **backup_passwd.py**ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ã€‚ä½†è¯·æ³¨æ„ï¼Œå®ƒä»¬å¯èƒ½ä¸é€‚ç”¨äºæœ€æ–°çš„ iTunes/Finder ç‰ˆæœ¬ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ã€‚

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å·¥å…· [**iOSbackup**](https://pypi.org/project/iOSbackup/) æ¥è½»æ¾è¯»å–å’Œæå–å¯†ç åŠ å¯†çš„ iOS å¤‡ä»½ä¸­çš„æ–‡ä»¶ã€‚

**å¦‚ä½•ä¿®æ”¹è¡Œä¸º**

åœ¨å¼€æºæ¯”ç‰¹å¸é’±åŒ…åº”ç”¨ [Bither](https://github.com/bither/bither-ios) ä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°å¯ä»¥é…ç½® PIN æ¥é”å®š UIã€‚\
è¿™ä¸ª PIN å­˜å‚¨åœ¨åä¸º `net.bither.plist` çš„æ–‡ä»¶ä¸­çš„ **pin_code** **é”®** ä¸­ã€‚\
å¦‚æœæ‚¨ä»å¤‡ä»½ä¸­æ¸…é™¤è¿™ä¸ªé”®å¹¶æ¢å¤å¤‡ä»½ï¼Œæ‚¨å°†èƒ½å¤Ÿè®¿é—®é’±åŒ…ã€‚

## æµ‹è¯•å†…å­˜ä¸­çš„æ•æ„Ÿæ•°æ®

æ•æ„Ÿä¿¡æ¯ç»ˆå°†å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ç›®æ ‡æ˜¯ç¡®ä¿è¿™äº›ä¿¡æ¯å°½å¯èƒ½çŸ­æš‚åœ°æš´éœ²ã€‚

è¦è°ƒæŸ¥åº”ç”¨ç¨‹åºçš„å†…å­˜ï¼Œè¯·é¦–å…ˆåˆ›å»ºä¸€ä¸ª **å†…å­˜è½¬å‚¨**ã€‚æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä¾‹å¦‚è°ƒè¯•å™¨ä¹‹ç±»çš„å·¥å…·**å®æ—¶åˆ†æå†…å­˜**ã€‚æ— è®ºæ‚¨ä½¿ç”¨å“ªç§æ–¹æ³•ï¼Œè¿™éƒ½æ˜¯ä¸€ä¸ªéå¸¸å®¹æ˜“å‡ºé”™çš„è¿‡ç¨‹ï¼Œå› ä¸ºè½¬å‚¨æä¾›äº†å·²æ‰§è¡Œå‡½æ•°ç•™ä¸‹çš„æ•°æ®ï¼Œæ‚¨å¯èƒ½ä¼šé”™è¿‡æ‰§è¡Œå…³é”®æ­¥éª¤ã€‚æ­¤å¤–ï¼Œé™¤éæ‚¨çŸ¥é“æ‚¨æ­£åœ¨å¯»æ‰¾çš„æ•°æ®çš„è¶³è¿¹ï¼ˆå®ƒçš„ç¡®åˆ‡å€¼æˆ–å…¶æ ¼å¼ï¼‰ï¼Œå¦åˆ™åœ¨åˆ†æè¿‡ç¨‹ä¸­å¿½è§†æ•°æ®æ˜¯éå¸¸å®¹æ˜“çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ ¹æ®éšæœºç”Ÿæˆçš„å¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œé™¤éæ‚¨é€šè¿‡å…¶ä»–æ–¹å¼æ‰¾åˆ°å…¶å€¼ï¼Œå¦åˆ™æ‚¨ä¸å¤ªå¯èƒ½åœ¨å†…å­˜ä¸­å‘ç°è¯¥å¯†é’¥ã€‚

**æ£€ç´¢å’Œåˆ†æå†…å­˜è½¬å‚¨**

æ— è®ºæ‚¨æ˜¯ä½¿ç”¨è¶Šç‹±è®¾å¤‡è¿˜æ˜¯éè¶Šç‹±è®¾å¤‡ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ [objection](https://github.com/sensepost/objection) å’Œ [Fridump](https://github.com/Nightbringer21/fridump) æ¥è½¬å‚¨åº”ç”¨ç¨‹åºçš„è¿›ç¨‹å†…å­˜ã€‚

åœ¨å†…å­˜è¢«è½¬å‚¨åï¼ˆä¾‹å¦‚åˆ°ä¸€ä¸ªåä¸º "memory" çš„æ–‡ä»¶ï¼‰ï¼Œæ ¹æ®æ‚¨æ­£åœ¨å¯»æ‰¾çš„æ•°æ®çš„æ€§è´¨ï¼Œæ‚¨å°†éœ€è¦ä¸€ç³»åˆ—ä¸åŒçš„å·¥å…·æ¥å¤„ç†å’Œåˆ†æè¯¥å†…å­˜è½¬å‚¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å…³æ³¨çš„æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰§è¡Œå‘½ä»¤ `strings` æˆ– `rabin2 -zz` æ¥æå–è¿™äº›å­—ç¬¦ä¸²å¯èƒ½å°±è¶³å¤Ÿäº†ã€‚
```
```bash
# using strings
$ strings memory > strings.txt

# using rabin2
$ rabin2 -ZZ memory > strings.txt
```
åœ¨æ‚¨å–œæ¬¢çš„ç¼–è¾‘å™¨ä¸­æ‰“å¼€ `strings.txt` å¹¶ä»”ç»†ç ”ç©¶ä»¥è¯†åˆ«æ•æ„Ÿä¿¡æ¯ã€‚

ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³æ£€æŸ¥å…¶ä»–ç±»å‹çš„æ•°æ®ï¼Œæ‚¨å¯èƒ½æ›´æ„¿æ„ä½¿ç”¨ radare2 åŠå…¶æœç´¢åŠŸèƒ½ã€‚æœ‰å…³æœç´¢å‘½ä»¤ï¼ˆ`/?`ï¼‰çš„æ›´å¤šä¿¡æ¯å’Œé€‰é¡¹åˆ—è¡¨ï¼Œè¯·å‚é˜… radare2 çš„å¸®åŠ©ã€‚ä»¥ä¸‹ä»…æ˜¾ç¤ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼š
```bash
$ r2 <name_of_your_dump_file>

[0x00000000]> /?
Usage: /[!bf] [arg]  Search stuff (see 'e??search' for options)
|Use io.va for searching in non virtual addressing spaces
| / foo\x00                    search for string 'foo\0'
| /c[ar]                       search for crypto materials
| /e /E.F/i                    match regular expression
| /i foo                       search for string 'foo' ignoring case
| /m[?][ebm] magicfile         search for magic, filesystems or binary headers
| /v[1248] value               look for an `cfg.bigendian` 32bit value
| /w foo                       search for wide string 'f\0o\0o\0'
| /x ff0033                    search for hex string
| /z min max                   search for strings of given size
...
```
**è¿è¡Œæ—¶å†…å­˜åˆ†æ**

é€šè¿‡ä½¿ç”¨ [**r2frida**](https://github.com/nowsecure/r2frida)ï¼Œæ‚¨å¯ä»¥åœ¨åº”ç”¨è¿è¡Œæ—¶åˆ†æå’Œæ£€æŸ¥å†…å­˜ï¼Œè€Œæ— éœ€è¿›è¡Œè½¬å‚¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è¿è¡Œä¹‹å‰çš„ r2frida æœç´¢å‘½ä»¤ï¼Œå¹¶æœç´¢å†…å­˜ä¸­çš„å­—ç¬¦ä¸²ã€åå…­è¿›åˆ¶å€¼ç­‰ã€‚åœ¨æ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œè¯·è®°ä½ï¼Œåœ¨ä½¿ç”¨ `r2 frida://usb//<name_of_your_app>` å¯åŠ¨ä¼šè¯åï¼Œè¦åœ¨æœç´¢å‘½ä»¤ï¼ˆä»¥åŠä»»ä½•å…¶ä»– r2frida ç‰¹å®šå‘½ä»¤ï¼‰å‰åŠ ä¸Šåæ–œæ  `\`ã€‚

## ç ´æŸçš„åŠ å¯†æŠ€æœ¯

### ç³Ÿç³•çš„å¯†é’¥ç®¡ç†æµç¨‹

ä¸€äº›å¼€å‘è€…å°†æ•æ„Ÿæ•°æ®ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Œå¹¶ä½¿ç”¨ä»£ç ä¸­ç¡¬ç¼–ç /å¯é¢„æµ‹çš„å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚è¿™æ ·åšæ˜¯ä¸åº”è¯¥çš„ï¼Œå› ä¸ºä¸€äº›é€†å‘å·¥ç¨‹å¯èƒ½å…è®¸æ”»å‡»è€…æå–æœºå¯†ä¿¡æ¯ã€‚

### ä½¿ç”¨ä¸å®‰å…¨å’Œ/æˆ–å·²å¼ƒç”¨çš„ç®—æ³•

å¼€å‘è€…ä¸åº”ä½¿ç”¨**å·²å¼ƒç”¨çš„ç®—æ³•**æ¥æ‰§è¡Œæˆæƒ**æ£€æŸ¥**ã€**å­˜å‚¨**æˆ–**å‘é€**æ•°æ®ã€‚è¿™äº›ç®—æ³•åŒ…æ‹¬ï¼šRC4ã€MD4ã€MD5ã€SHA1... å¦‚æœä½¿ç”¨**å“ˆå¸Œ**æ¥å­˜å‚¨å¯†ç ï¼Œä¾‹å¦‚ï¼Œåº”ä½¿ç”¨å¸¦ç›çš„æŠ—æš´åŠ›ç ´è§£**å“ˆå¸Œ**ã€‚

### æ£€æŸ¥

ä¸»è¦çš„æ£€æŸ¥æ˜¯æ‰¾å‡ºæ‚¨æ˜¯å¦å¯ä»¥åœ¨ä»£ç ä¸­æ‰¾åˆ°**ç¡¬ç¼–ç **çš„å¯†ç /ç§˜å¯†ï¼Œæˆ–è€…è¿™äº›æ˜¯å¦æ˜¯**å¯é¢„æµ‹çš„**ï¼Œä»¥åŠä»£ç æ˜¯å¦ä½¿ç”¨äº†æŸç§**å¼±**çš„**åŠ å¯†**ç®—æ³•ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ **objection** è‡ªåŠ¨**ç›‘æ§**ä¸€äº›**åŠ å¯†** **åº“**ï¼š
```swift
ios monitor crypt
```
```markdown
æœ‰å…³iOSåŠ å¯†APIå’Œåº“è®¿é—®çš„**æ›´å¤šä¿¡æ¯**ï¼Œè¯·è®¿é—® [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06e-testing-cryptography](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06e-testing-cryptography)

## æœ¬åœ°è®¤è¯

æµ‹è¯•äººå‘˜åº”è¯¥æ„è¯†åˆ°**æœ¬åœ°è®¤è¯åº”å§‹ç»ˆåœ¨è¿œç¨‹ç«¯ç‚¹å¼ºåˆ¶æ‰§è¡Œ**æˆ–åŸºäºåŠ å¯†åŸè¯­ã€‚å¦‚æœè®¤è¯è¿‡ç¨‹æ²¡æœ‰è¿”å›æ•°æ®ï¼Œæ”»å‡»è€…å¯ä»¥è½»æ¾ç»•è¿‡æœ¬åœ°è®¤è¯ã€‚

[**Local Authentication framework**](https://developer.apple.com/documentation/localauthentication) æä¾›äº†ä¸€ç»„APIï¼Œä¾›å¼€å‘äººå‘˜å‘ç”¨æˆ·æ‰©å±•è®¤è¯å¯¹è¯æ¡†ã€‚åœ¨è¿æ¥åˆ°è¿œç¨‹æœåŠ¡çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¯ä»¥ï¼ˆå¹¶ä¸”æ¨èï¼‰åˆ©ç”¨ [keychain](https://developer.apple.com/library/content/documentation/Security/Conceptual/keychainServConcepts/01introduction/introduction.html) æ¥å®ç°æœ¬åœ°è®¤è¯ã€‚

**æŒ‡çº¹ID** ä¼ æ„Ÿå™¨ç”± [SecureEnclaveå®‰å…¨åå¤„ç†å™¨](https://www.blackhat.com/docs/us-16/materials/us-16-Mandt-Demystifying-The-Secure-Enclave-Processor.pdf) æ“ä½œï¼Œå¹¶ä¸”ä¸ä¼šå°†æŒ‡çº¹æ•°æ®æš´éœ²ç»™ç³»ç»Ÿçš„ä»»ä½•å…¶ä»–éƒ¨åˆ†ã€‚é™¤äº†Touch IDï¼Œè‹¹æœè¿˜æ¨å‡ºäº†_Face ID_ï¼šå…è®¸åŸºäºé¢éƒ¨è¯†åˆ«çš„è®¤è¯ã€‚

å¼€å‘äººå‘˜æœ‰ä¸¤ä¸ªé€‰é¡¹å¯ä»¥æ•´åˆTouch ID/Face IDè®¤è¯ï¼š

* `LocalAuthentication.framework` æ˜¯ä¸€ä¸ªé«˜çº§APIï¼Œå¯ç”¨äº**é€šè¿‡Touch IDè®¤è¯ç”¨æˆ·**ã€‚åº”ç”¨ç¨‹åºæ— æ³•è®¿é—®ä¸æ³¨å†ŒæŒ‡çº¹ç›¸å…³çš„ä»»ä½•æ•°æ®ï¼Œåªä¼šé€šçŸ¥è®¤è¯æ˜¯å¦æˆåŠŸã€‚
* `Security.framework` æ˜¯ä¸€ä¸ªè¾ƒä½çº§åˆ«çš„APIï¼Œç”¨äºè®¿é—® [keychain services](https://developer.apple.com/documentation/security/keychain\_services)ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦**ç”¨ç”Ÿç‰©è¯†åˆ«è®¤è¯ä¿æŠ¤ä¸€äº›ç§˜å¯†æ•°æ®**ï¼Œè¿™æ˜¯ä¸€ä¸ªå®‰å…¨çš„é€‰é¡¹ï¼Œå› ä¸ºè®¿é—®æ§åˆ¶æ˜¯åœ¨ç³»ç»Ÿçº§åˆ«ç®¡ç†çš„ï¼Œä¸å®¹æ˜“è¢«ç»•è¿‡ã€‚`Security.framework` æœ‰ä¸€ä¸ªC APIï¼Œä½†æœ‰å‡ ä¸ª [å¼€æºå°è£…å¯ç”¨](https://www.raywenderlich.com/147308/secure-ios-user-data-keychain-touch-id)ï¼Œä½¿å¾—è®¿é—®keychainåƒè®¿é—®NSUserDefaultsä¸€æ ·ç®€å•ã€‚

{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œä½¿ç”¨`LocalAuthentication.framework` æˆ– `Security.framework`ï¼Œå°†æ˜¯ä¸€ä¸ªå¯ä»¥è¢«æ”»å‡»è€…ç»•è¿‡çš„æ§åˆ¶ï¼Œå› ä¸ºå®ƒåªè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œæ²¡æœ‰æ•°æ®å¯ä»¥ç»§ç»­è¿›è¡Œã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ [Don't touch me that way, by David Lindner et al](https://www.youtube.com/watch?v=XhXIHVGCFFM)ã€‚
{% endhint %}

### æœ¬åœ°è®¤è¯æ¡†æ¶

å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ä½¿ç”¨ **`LAContext`** ç±»çš„ **`evaluatePolicy`** å‡½æ•°æ¥æ˜¾ç¤º**è®¤è¯æç¤º**ã€‚ä¸¤ä¸ªå¯ç”¨çš„ç­–ç•¥å®šä¹‰äº†å¯æ¥å—çš„è®¤è¯å½¢å¼ï¼š

* `deviceOwnerAuthentication`(Swift) æˆ– `LAPolicyDeviceOwnerAuthentication`(Objective-C)ï¼šå¦‚æœå¯ç”¨ï¼Œç”¨æˆ·å°†è¢«æç¤ºè¿›è¡ŒTouch IDè®¤è¯ã€‚å¦‚æœæ²¡æœ‰æ¿€æ´»Touch IDï¼Œåˆ™ä¼šè¯·æ±‚è®¾å¤‡å¯†ç ã€‚å¦‚æœæœªå¯ç”¨è®¾å¤‡å¯†ç ï¼Œç­–ç•¥è¯„ä¼°å°†å¤±è´¥ã€‚
* `deviceOwnerAuthenticationWithBiometrics` (Swift) æˆ– `LAPolicyDeviceOwnerAuthenticationWithBiometrics`(Objective-C)ï¼šè®¤è¯é™åˆ¶ä¸ºç”Ÿç‰©è¯†åˆ«ï¼Œç”¨æˆ·å°†è¢«æç¤ºTouch IDã€‚

**`evaluatePolicy` å‡½æ•°è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼**ï¼ŒæŒ‡ç¤ºç”¨æˆ·æ˜¯å¦å·²æˆåŠŸè®¤è¯ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥è¢«è½»æ¾ç»•è¿‡ï¼ˆè§ä¸‹æ–‡ï¼‰

### ä½¿ç”¨Keychainçš„æœ¬åœ°è®¤è¯

**iOS keychain APIå¯ä»¥ï¼ˆå¹¶ä¸”åº”è¯¥ï¼‰ç”¨æ¥å®ç°æœ¬åœ°è®¤è¯**ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨ç¨‹åºå°†ä¸€ä¸ªç§˜å¯†è®¤è¯ä»¤ç‰Œæˆ–å¦ä¸€å—æ ‡è¯†ç”¨æˆ·çš„ç§˜å¯†æ•°æ®å­˜å‚¨åœ¨keychainä¸­ã€‚ä¸ºäº†è®¤è¯åˆ°è¿œç¨‹æœåŠ¡ï¼Œç”¨æˆ·å¿…é¡»ä½¿ç”¨ä»–ä»¬çš„å¯†ç æˆ–æŒ‡çº¹è§£é”keychainï¼Œä»¥è·å–ç§˜å¯†æ•°æ®ã€‚

keychainå…è®¸ä½¿ç”¨ç‰¹æ®Šçš„`SecAccessControl`å±æ€§ä¿å­˜é¡¹ç›®ï¼Œè¯¥å±æ€§å°†ä»…åœ¨ç”¨æˆ·é€šè¿‡Touch IDè®¤è¯ï¼ˆæˆ–å¯†ç ï¼Œå¦‚æœå±æ€§å‚æ•°å…è®¸æ­¤ç±»å›é€€ï¼‰åå…è®¸ä»keychainè®¿é—®é¡¹ç›®ã€‚

åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å­—ç¬¦ä¸²"test\_strong\_password"ä¿å­˜åˆ°keychainã€‚è¯¥å­—ç¬¦ä¸²åªèƒ½åœ¨å½“å‰è®¾å¤‡ä¸Šè®¿é—®ï¼ŒåŒæ—¶è®¾ç½®äº†å¯†ç ï¼ˆ`kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly` å‚æ•°ï¼‰å¹¶ä¸”ä»…åœ¨å½“å‰æ³¨å†Œçš„æŒ‡çº¹é€šè¿‡Touch IDè®¤è¯åï¼ˆ`SecAccessControlCreateFlags.biometryCurrentSet` å‚æ•°ï¼‰ï¼š

{% tabs %}
{% tab title="Swift" %}
```
```swift
// 1. create AccessControl object that will represent authentication settings

var error: Unmanaged<CFError>?

guard let accessControl = SecAccessControlCreateWithFlags(kCFAllocatorDefault,
kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly,
SecAccessControlCreateFlags.biometryCurrentSet,
&error) else {
// failed to create AccessControl object

return
}

// 2. define keychain services query. Pay attention that kSecAttrAccessControl is mutually exclusive with kSecAttrAccessible attribute

var query: [String: Any] = [:]

query[kSecClass as String] = kSecClassGenericPassword
query[kSecAttrLabel as String] = "com.me.myapp.password" as CFString
query[kSecAttrAccount as String] = "OWASP Account" as CFString
query[kSecValueData as String] = "test_strong_password".data(using: .utf8)! as CFData
query[kSecAttrAccessControl as String] = accessControl

// 3. save item

let status = SecItemAdd(query as CFDictionary, nil)

if status == noErr {
// successfully saved
} else {
// error while saving
}
```
{% endtab %}

{% tab title="Objective-C" %}
```objectivec
// 1. create AccessControl object that will represent authentication settings
CFErrorRef *err = nil;

SecAccessControlRef sacRef = SecAccessControlCreateWithFlags(kCFAllocatorDefault,
kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly,
kSecAccessControlUserPresence,
err);

// 2. define keychain services query. Pay attention that kSecAttrAccessControl is mutually exclusive with kSecAttrAccessible attribute
NSDictionary* query = @{
(_ _bridge id)kSecClass: (__bridge id)kSecClassGenericPassword,
(__bridge id)kSecAttrLabel: @"com.me.myapp.password",
(__bridge id)kSecAttrAccount: @"OWASP Account",
(__bridge id)kSecValueData: [@"test_strong_password" dataUsingEncoding:NSUTF8StringEncoding],
(__bridge id)kSecAttrAccessControl: (__bridge_transfer id)sacRef
};

// 3. save item
OSStatus status = SecItemAdd((__bridge CFDictionaryRef)query, nil);

if (status == noErr) {
// successfully saved
} else {
// error while saving
}
```
{% endtab %}
{% endtabs %}

ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»é’¥åŒ™ä¸²è¯·æ±‚ä¿å­˜çš„é¡¹ç›®ã€‚é’¥åŒ™ä¸²æœåŠ¡å°†å‘ç”¨æˆ·å±•ç¤ºè®¤è¯å¯¹è¯æ¡†ï¼Œå¹¶æ ¹æ®æ˜¯å¦æä¾›äº†åˆé€‚çš„æŒ‡çº¹ï¼Œè¿”å›æ•°æ®æˆ–nilã€‚

{% tabs %}
{% tab title="Swift" %}
```swift
// 1. define query
var query = [String: Any]()
query[kSecClass as String] = kSecClassGenericPassword
query[kSecReturnData as String] = kCFBooleanTrue
query[kSecAttrAccount as String] = "My Name" as CFString
query[kSecAttrLabel as String] = "com.me.myapp.password" as CFString
query[kSecUseOperationPrompt as String] = "Please, pass authorisation to enter this area" as CFString

// 2. get item
var queryResult: AnyObject?
let status = withUnsafeMutablePointer(to: &queryResult) {
SecItemCopyMatching(query as CFDictionary, UnsafeMutablePointer($0))
}

if status == noErr {
let password = String(data: queryResult as! Data, encoding: .utf8)!
// successfully received password
} else {
// authorization not passed
}
```
{% endtab %}

{% tab title="Objective-C" %}
```objectivec
// 1. define query
NSDictionary *query = @{(__bridge id)kSecClass: (__bridge id)kSecClassGenericPassword,
(__bridge id)kSecReturnData: @YES,
(__bridge id)kSecAttrAccount: @"My Name1",
(__bridge id)kSecAttrLabel: @"com.me.myapp.password",
(__bridge id)kSecUseOperationPrompt: @"Please, pass authorisation to enter this area" };

// 2. get item
CFTypeRef queryResult = NULL;
OSStatus status = SecItemCopyMatching((__bridge CFDictionaryRef)query, &queryResult);

if (status == noErr){
NSData* resultData = ( __bridge_transfer NSData* )queryResult;
NSString* password = [[NSString alloc] initWithData:resultData encoding:NSUTF8StringEncoding];
NSLog(@"%@", password);
} else {
NSLog(@"Something went wrong");
}
```
{% endtab %}
{% endtabs %}

### æ£€æµ‹

é€šè¿‡åˆ†æåº”ç”¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­å…±äº«åŠ¨æ€åº“çš„åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ£€æµ‹åˆ°æ¡†æ¶çš„ä½¿ç”¨æƒ…å†µã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ `otool` æ¥å®Œæˆï¼š
```bash
$ otool -L <AppName>.app/<AppName>
```
å¦‚æœåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨äº†`LocalAuthentication.framework`ï¼Œè¾“å‡ºå°†åŒ…å«ä»¥ä¸‹ä¸¤è¡Œï¼ˆè®°ä½`LocalAuthentication.framework`åœ¨åº•å±‚ä½¿ç”¨äº†`Security.framework`ï¼‰ï¼š
```bash
/System/Library/Frameworks/LocalAuthentication.framework/LocalAuthentication
/System/Library/Frameworks/Security.framework/Security
```
### æœ¬åœ°è®¤è¯æ¡†æ¶ç»•è¿‡

#### Objection

[**Objection ç”Ÿç‰©è¯†åˆ«ç»•è¿‡**](https://github.com/sensepost/objection/wiki/Understanding-the-iOS-Biometrics-Bypass) å¯ç”¨äºç»•è¿‡LocalAuthenticationã€‚Objection **ä½¿ç”¨Fridaæ¥æ¤å…¥`evaluatePolicy`å‡½æ•°ï¼Œä½¿å…¶å³ä½¿åœ¨æœªæˆåŠŸè¿›è¡Œè®¤è¯çš„æƒ…å†µä¸‹ä¹Ÿè¿”å›`True`**ã€‚ä½¿ç”¨`ios ui biometrics_bypass`å‘½ä»¤æ¥ç»•è¿‡ä¸å®‰å…¨çš„ç”Ÿç‰©è¯†åˆ«è®¤è¯ã€‚Objectionå°†æ³¨å†Œä¸€ä¸ªä½œä¸šï¼Œè¯¥ä½œä¸šå°†æ›¿æ¢`evaluatePolicy`çš„ç»“æœã€‚å®ƒåœ¨Swiftå’ŒObjective-Cå®ç°ä¸­éƒ½æœ‰æ•ˆã€‚
```bash
...itudehacks.DVIAswiftv2.develop on (iPhone: 13.2.3) [usb] # ios ui biometrics_bypass
(agent) Registering job 3mhtws9x47q. Type: ios-biometrics-disable
...itudehacks.DVIAswiftv2.develop on (iPhone: 13.2.3) [usb] # (agent) [3mhtws9x47q] Localized Reason for auth requirement: Please authenticate yourself
(agent) [3mhtws9x47q] OS authentication response: false
(agent) [3mhtws9x47q] Marking OS response as True instead
(agent) [3mhtws9x47q] Biometrics bypass hook complete
```
#### Frida

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ **`evaluatePolicy`** çš„ä¾‹å­ï¼Œæ¥è‡ª [DVIA-v2 åº”ç”¨ç¨‹åº](https://github.com/prateek147/DVIA-v2)ï¼š
```swift
+(void)authenticateWithTouchID {
LAContext *myContext = [[LAContext alloc] init];
NSError *authError = nil;
NSString *myLocalizedReasonString = @"Please authenticate yourself";

if ([myContext canEvaluatePolicy:LAPolicyDeviceOwnerAuthenticationWithBiometrics error:&authError]) {
[myContext evaluatePolicy:LAPolicyDeviceOwnerAuthenticationWithBiometrics
localizedReason:myLocalizedReasonString
reply:^(BOOL success, NSError *error) {
if (success) {
dispatch_async(dispatch_get_main_queue(), ^{
[TouchIDAuthentication showAlert:@"Authentication Successful" withTitle:@"Success"];
});
} else {
dispatch_async(dispatch_get_main_queue(), ^{
[TouchIDAuthentication showAlert:@"Authentication Failed !" withTitle:@"Error"];
});
}
}];
} else {
dispatch_async(dispatch_get_main_queue(), ^{
[TouchIDAuthentication showAlert:@"Your device doesn't support Touch ID or you haven't configured Touch ID authentication on your device" withTitle:@"Error"];
});
}
}
```
ä¸ºäº†ç»•è¿‡æœ¬åœ°è®¤è¯ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªFridaè„šæœ¬æ¥**ç»•è¿‡**ä¸Šè¿°çš„ _**evaluatePolicy**_ æ£€æŸ¥ã€‚æ­£å¦‚ä½ åœ¨ä¸Šé¢ç²˜è´´çš„ä»£ç ç‰‡æ®µä¸­çœ‹åˆ°çš„ï¼Œ**evaluatePolicy** ä½¿ç”¨äº†ä¸€ä¸ª**å›è°ƒ**æ¥å†³å®š**ç»“æœ**ã€‚å› æ­¤ï¼Œå®ç°è¿™ä¸ªé»‘å®¢æ”»å‡»çš„æœ€ç®€å•æ–¹æ³•æ˜¯æ‹¦æˆªé‚£ä¸ªå›è°ƒï¼Œå¹¶ç¡®ä¿å®ƒæ€»æ˜¯è¿”å›_**success=1**ã€‚
```swift
// from https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/
if(ObjC.available) {
console.log("Injecting...");
var hook = ObjC.classes.LAContext["- evaluatePolicy:localizedReason:reply:"];
Interceptor.attach(hook.implementation, {
onEnter: function(args) {
var block = new ObjC.Block(args[4]);
const callback = block.implementation;
block.implementation = function (error, value)  {

console.log("Changing the result value to true")
const result = callback(1, null);
return result;
};
},
});
} else {
console.log("Objective-C Runtime is not available!");
}
```

```
frida -U -f com.highaltitudehacks.DVIAswiftv2 --no-pause -l fingerprint-bypass-ios.js
```
## é€šè¿‡ IPC æš´éœ²æ•æ„ŸåŠŸèƒ½

### è‡ªå®šä¹‰ URI å¤„ç†ç¨‹åº / æ·±å±‚é“¾æ¥ / è‡ªå®šä¹‰æ–¹æ¡ˆ

{% content-ref url="ios-custom-uri-handlers-deeplinks-custom-schemes.md" %}
[ios-custom-uri-handlers-deeplinks-custom-schemes.md](ios-custom-uri-handlers-deeplinks-custom-schemes.md)
{% endcontent-ref %}

### é€šç”¨é“¾æ¥

{% content-ref url="ios-universal-links.md" %}
[ios-universal-links.md](ios-universal-links.md)
{% endcontent-ref %}

### UIActivity åˆ†äº«

{% content-ref url="ios-uiactivity-sharing.md" %}
[ios-uiactivity-sharing.md](ios-uiactivity-sharing.md)
{% endcontent-ref %}

### UIPasteboard

{% content-ref url="ios-uipasteboard.md" %}
[ios-uipasteboard.md](ios-uipasteboard.md)
{% endcontent-ref %}

### åº”ç”¨æ‰©å±•

{% content-ref url="ios-app-extensions.md" %}
[ios-app-extensions.md](ios-app-extensions.md)
{% endcontent-ref %}

### WebViews

{% content-ref url="ios-webviews.md" %}
[ios-webviews.md](ios-webviews.md)
{% endcontent-ref %}

### åºåˆ—åŒ–å’Œç¼–ç 

{% content-ref url="ios-serialisation-and-encoding.md" %}
[ios-serialisation-and-encoding.md](ios-serialisation-and-encoding.md)
{% endcontent-ref %}

## ç½‘ç»œé€šä¿¡

æ£€æŸ¥æ˜¯å¦æœ‰**æœªåŠ å¯†**çš„é€šä¿¡å‘ç”Ÿéå¸¸é‡è¦ï¼ŒåŒæ—¶ä¹Ÿè¦ç¡®ä¿åº”ç”¨ç¨‹åºæ­£ç¡®**éªŒè¯æœåŠ¡å™¨çš„ TLS è¯ä¹¦**ã€‚\
è¦æ£€æŸ¥è¿™äº›é—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨åƒ **Burp** è¿™æ ·çš„ä»£ç†ï¼š

{% content-ref url="burp-configuration-for-ios.md" %}
[burp-configuration-for-ios.md](burp-configuration-for-ios.md)
{% endcontent-ref %}

### ä¸»æœºåæ£€æŸ¥

éªŒè¯ TLS è¯ä¹¦æ—¶çš„ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯æ£€æŸ¥è¯ä¹¦æ˜¯å¦ç”±**å—ä¿¡ä»»çš„ CA**ç­¾åï¼Œä½†**ä¸æ£€æŸ¥**è¯ä¹¦çš„**ä¸»æœºå**æ˜¯å¦æ˜¯æ­£åœ¨è®¿é—®çš„ä¸»æœºåã€‚\
ä¸ºäº†ä½¿ç”¨ Burp æ£€æŸ¥è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ iPhone ä¸Šä¿¡ä»» Burp CA åï¼Œä½ å¯ä»¥**ä½¿ç”¨ Burp ä¸ºä¸åŒçš„ä¸»æœºååˆ›å»ºä¸€ä¸ªæ–°è¯ä¹¦**å¹¶ä½¿ç”¨å®ƒã€‚å¦‚æœåº”ç”¨ç¨‹åºä»ç„¶å¯ä»¥å·¥ä½œï¼Œé‚£ä¹ˆï¼Œå®ƒå¯èƒ½å­˜åœ¨æ¼æ´ã€‚

### è¯ä¹¦é”å®š

å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºæ­£ç¡®ä½¿ç”¨äº† SSL Pinningï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºåªä¼šåœ¨è¯ä¹¦æ˜¯é¢„æœŸä¸­çš„è¯ä¹¦æ—¶å·¥ä½œã€‚åœ¨æµ‹è¯•åº”ç”¨ç¨‹åºæ—¶ï¼Œ**è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸º Burp ä¼šæä¾›å®ƒè‡ªå·±çš„è¯ä¹¦ã€‚**\
ä¸ºäº†åœ¨è¶Šç‹±è®¾å¤‡ä¸­ç»•è¿‡è¿™ç§ä¿æŠ¤ï¼Œä½ å¯ä»¥å®‰è£…åº”ç”¨ç¨‹åº [**SSL Kill Switch**](https://github.com/nabla-c0d3/ssl-kill-switch2) æˆ–å®‰è£… [**Burp Mobile Assistant**](https://portswigger.net/burp/documentation/desktop/mobile/config-ios-device)

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ **objection** çš„ `ios sslpinning disable`

## æ‚é¡¹

* åœ¨ **`/System/Library`** ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°æ‰‹æœºä¸­ç”±ç³»ç»Ÿåº”ç”¨ç¨‹åºä½¿ç”¨çš„æ¡†æ¶
* ç”¨æˆ·ä» App Store å®‰è£…çš„åº”ç”¨ç¨‹åºä½äº **`/User/Applications`** å†…
* è€Œ **`/User/Library`** åŒ…å«ç”¨æˆ·çº§åº”ç”¨ç¨‹åºä¿å­˜çš„æ•°æ®
* ä½ å¯ä»¥è®¿é—® **`/User/Library/Notes/notes.sqlite`** æ¥é˜…è¯»åº”ç”¨ç¨‹åºå†…ä¿å­˜çš„ç¬”è®°ã€‚
* åœ¨å·²å®‰è£…åº”ç”¨ç¨‹åºçš„æ–‡ä»¶å¤¹å†…ï¼ˆ**`/User/Applications/<APP ID>/`**ï¼‰ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸€äº›æœ‰è¶£çš„æ–‡ä»¶ï¼š
  * **`iTunesArtwork`**ï¼šåº”ç”¨ç¨‹åºä½¿ç”¨çš„å›¾æ ‡
  * **`iTunesMetadata.plist`**ï¼šåœ¨ App Store ä¸­ä½¿ç”¨çš„åº”ç”¨ä¿¡æ¯
  * **`/Library/*`**ï¼šåŒ…å«åå¥½è®¾ç½®å’Œç¼“å­˜ã€‚åœ¨ **`/Library/Cache/Snapshots/*`** ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°åœ¨å°†åº”ç”¨ç¨‹åºå‘é€åˆ°åå°ä¹‹å‰å¯¹å…¶æ‰§è¡Œçš„å¿«ç…§ã€‚

### çƒ­ä¿®å¤/å¼ºåˆ¶æ›´æ–°

å¼€å‘è€…å¯ä»¥è¿œç¨‹**ç«‹å³ä¿®è¡¥ä»–ä»¬åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å®‰è£…**ï¼Œè€Œæ— éœ€é‡æ–°æäº¤åº”ç”¨ç¨‹åºåˆ° App Store å¹¶ç­‰å¾…å®ƒè¢«æ‰¹å‡†ã€‚\
é€šå¸¸ä½¿ç”¨ [**JSPatch**](https://github.com/bang590/JSPatch) æ¥å®ç°è¿™ä¸€ç›®çš„ã€‚ä½†ä¹Ÿæœ‰å…¶ä»–é€‰é¡¹ï¼Œå¦‚ [Siren](https://github.com/ArtSabintsev/Siren) å’Œ [react-native-appstore-version-checker](https://www.npmjs.com/package/react-native-appstore-version-checker)ã€‚\
**è¿™æ˜¯ä¸€ä¸ªå¯èƒ½è¢«æ¶æ„ç¬¬ä¸‰æ–¹ SDK æ»¥ç”¨çš„å±é™©æœºåˆ¶ï¼Œå› æ­¤å»ºè®®æ£€æŸ¥ç”¨äºè‡ªåŠ¨æ›´æ–°çš„æ–¹æ³•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å¹¶å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚** ä½ å¯ä»¥å°è¯•ä¸‹è½½åº”ç”¨ç¨‹åºçš„æ—§ç‰ˆæœ¬æ¥å®ç°è¿™ä¸€ç›®çš„ã€‚

### ç¬¬ä¸‰æ–¹

ç¬¬ä¸‰æ–¹ SDK çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¯¹ SDK æä¾›çš„åŠŸèƒ½**æ²¡æœ‰ç»†ç²’åº¦æ§åˆ¶**ã€‚ä½ å¯ä»¥ä½¿ç”¨ SDK å¹¶æ‹¥æœ‰æ‰€æœ‰åŠŸèƒ½ï¼ˆåŒ…æ‹¬è¯Šæ–­æ³„éœ²å’Œä¸å®‰å…¨çš„ HTTP è¿æ¥ï¼‰ï¼Œæˆ–è€…ä¸ä½¿ç”¨å®ƒã€‚æ­¤å¤–ï¼Œé€šå¸¸åº”ç”¨ç¨‹åºå¼€å‘è€…æ— æ³•**ä¿®è¡¥** SDK ä¸­çš„æ¼æ´ã€‚\
æ­¤å¤–ï¼Œä¸€äº› SDK ä¸€æ—¦è¢«ç¤¾åŒºéå¸¸ä¿¡ä»»ï¼Œå°±å¼€å§‹**åŒ…å«æ¶æ„è½¯ä»¶**ã€‚

æ­¤å¤–ï¼Œè¿™äº›æœåŠ¡æä¾›çš„åŠŸèƒ½å¯èƒ½æ¶‰åŠ**è·Ÿè¸ªæœåŠ¡ä»¥ç›‘æ§ç”¨æˆ·ä½¿ç”¨åº”ç”¨ç¨‹åºæ—¶çš„è¡Œä¸º**ï¼Œé”€å”®æ¨ªå¹…å¹¿å‘Šï¼Œæˆ–æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚ç¬¬ä¸‰æ–¹æœåŠ¡çš„ç¼ºç‚¹æ˜¯å¼€å‘è€…ä¸çŸ¥é“é€šè¿‡ç¬¬ä¸‰æ–¹åº“æ‰§è¡Œçš„ä»£ç çš„è¯¦ç»†ä¿¡æ¯ã€‚å› æ­¤ï¼Œä¸åº”å‘æœåŠ¡å‘é€è¶…å‡ºå¿…è¦çš„ä¿¡æ¯ï¼Œä¹Ÿä¸åº”æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚

ç¼ºç‚¹æ˜¯ï¼Œ**å¼€å‘è€…ä¸è¯¦ç»†äº†è§£é€šè¿‡ç¬¬ä¸‰æ–¹åº“æ‰§è¡Œçš„ä»£ç **ï¼Œå› æ­¤æ”¾å¼ƒäº†å¯è§æ€§ã€‚å› æ­¤ï¼Œåº”ç¡®ä¿åªå‘æœåŠ¡å‘é€æ‰€éœ€çš„ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚

å¤§å¤šæ•°ç¬¬ä¸‰æ–¹æœåŠ¡æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š

* ä½¿ç”¨ç‹¬ç«‹åº“
* ä½¿ç”¨å®Œæ•´çš„ SDK

å‘é€ç»™ç¬¬ä¸‰æ–¹æœåŠ¡çš„æ‰€æœ‰æ•°æ®éƒ½åº”è¯¥æ˜¯åŒ¿åçš„ï¼Œä»¥é˜²æ­¢æš´éœ² PIIï¼ˆä¸ªäººå¯è¯†åˆ«ä¿¡æ¯ï¼‰ï¼Œè¿™å°†å…è®¸ç¬¬ä¸‰æ–¹è¯†åˆ«ç”¨æˆ·è´¦æˆ·ã€‚

ä½ å¯ä»¥é€šè¿‡è¿è¡Œ **`otool`** å¯¹åº”ç”¨ç¨‹åºï¼ˆå¹¶**å¯¹**æ¯ä¸ªå…±äº«**åº“è¿è¡Œ**å®ƒä»¥æ‰¾åˆ°æ›´å¤šä½¿ç”¨çš„å…±äº«åº“ï¼‰æ¥æ‰¾åˆ°åº”ç”¨ç¨‹åºä½¿ç”¨çš„**åº“**ã€‚

## **å‚è€ƒèµ„æ–™**

* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06b-basic-security-testing#information-gathering](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06b-basic-security-testing#information-gathering)
* [iOS & Mobile App Pentesting - INE](https://my.ine.com/CyberSecurity/courses/089d060b/ios-mobile-app-pentesting)

## æ›´å¤šä¿¡æ¯

* [https://github.com/ivRodriguezCA/RE-iOS-Apps/](https://github.com/ivRodriguezCA/RE-iOS-Apps/) IOS å…è´¹è¯¾ç¨‹([https://syrion.me/blog/ios-swift-antijailbreak-bypass-frida/](https://syrion.me/blog/ios-swift-antijailbreak-bypass-frida/))
* [https://www.sans.org/reading-room/whitepapers/testing/ipwn-apps-pentesting-ios-applications-34577](https://www.sans.org/reading-room/whitepapers/testing/ipwn-apps-pentesting-ios-applications-34577)
* [https://www.slideshare.net/RyanISI/ios-appsecurityminicourse](https://www.slideshare.net/RyanISI/ios-appsecurityminicourse)
* [https://github.com/prateek147/DVIA](https://github.com/prateek147/DVIA)
* [https://github.com/prateek147/DVIA-v2](https://github.com/prateek147/DVIA-v2)
* [https://github.com/OWASP/MSTG-Hacking-Playground%20](https://github.com/OWASP/MSTG-Hacking-Playground)
* OWASP iGoat [_https://github.com/OWASP/igoat_](https://github.com/OWASP/igoat) <<< Objective-C ç‰ˆæœ¬ [_https://github.com/OWASP/iGoat-Swift_](https://github.com/OWASP/iGoat-Swift) <<< Swift ç‰ˆæœ¬
* [https://github.com/authenticationfailure/WheresMyBrowser.iOS](https://github.com/authenticationfailure/WheresMyBrowser.iOS)
* [https://github.com/nabla-c0d3/ssl-kill-switch2](https://github.com/nabla-c0d3/ssl-kill-switch2)

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›çš„**ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>
