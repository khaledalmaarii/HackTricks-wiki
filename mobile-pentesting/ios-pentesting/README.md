# Testowanie iOS

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby Å‚atwo tworzyÄ‡ i **automatyzowaÄ‡ zadania** przy uÅ¼yciu najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ci.\
Otrzymaj dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Zacznij od zera i zostaÅ„ mistrzem hakowania AWS z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawy iOS

{% content-ref url="ios-basics.md" %}
[ios-basics.md](ios-basics.md)
{% endcontent-ref %}

## Åšrodowisko testowe

Na tej stronie znajdziesz informacje na temat **symulatora iOS**, **emulatorÃ³w** i **jailbreakingu:**

{% content-ref url="ios-testing-environment.md" %}
[ios-testing-environment.md](ios-testing-environment.md)
{% endcontent-ref %}

## Analiza poczÄ…tkowa

### Podstawowe operacje testowania iOS

Podczas testowania **zostanÄ… zaproponowane kilka operacji** (poÅ‚Ä…czenie z urzÄ…dzeniem, odczyt/zapis/przesyÅ‚anie/pobieranie plikÃ³w, korzystanie z niektÃ³rych narzÄ™dzi...). Dlatego jeÅ›li nie wiesz, jak wykonaÄ‡ ktÃ³rekolwiek z tych dziaÅ‚aÅ„, **zacznij od przeczytania strony**:

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

{% hint style="info" %}
Przed wykonaniem kolejnych krokÃ³w **aplikacja powinna byÄ‡ zainstalowana** na urzÄ…dzeniu i naleÅ¼y juÅ¼ posiadaÄ‡ plik **IPA** aplikacji.\
Przeczytaj stronÄ™ [Podstawowe operacje testowania iOS](basic-ios-testing-operations.md), aby dowiedzieÄ‡ siÄ™, jak to zrobiÄ‡.
{% endhint %}

### Podstawowa analiza statyczna

Zaleca siÄ™ uÅ¼ycie narzÄ™dzia [**MobSF**](https://github.com/MobSF/Mobile-Security-Framework-MobSF) do przeprowadzenia automatycznej analizy statycznej pliku IPA.

Identyfikacja **zabezpieczeÅ„ obecnych w binarnym pliku**:

*   **PIE (Position Independent Executable)**: Gdy jest wÅ‚Ä…czony, aplikacja Å‚aduje siÄ™ pod losowy adres pamiÄ™ci za kaÅ¼dym razem, gdy jest uruchamiana, co sprawia, Å¼e trudniej jest przewidzieÄ‡ jej poczÄ…tkowy adres pamiÄ™ci.

```bash
otool -hv <app-binary> | grep PIE   # Powinno zawieraÄ‡ flagÄ™ PIE
```
*   **Stack Canaries**: Do sprawdzenia integralnoÅ›ci stosu, wartoÅ›Ä‡ â€kanarkaâ€ jest umieszczana na stosie przed wywoÅ‚aniem funkcji i ponownie sprawdzana po zakoÅ„czeniu funkcji.

```bash
otool -I -v <app-binary> | grep stack_chk   # Powinno zawieraÄ‡ symbole: stack_chk_guard i stack_chk_fail
```
*   **ARC (Automatic Reference Counting)**: Aby zapobiec powszechnym bÅ‚Ä™dom korupcji pamiÄ™ci

```bash
otool -I -v <app-binary> | grep objc_release   # Powinno zawieraÄ‡ symbol _objc_release
```
*   **Zaszyfrowany binarny plik**: Binarny plik powinien byÄ‡ zaszyfrowany

```bash
otool -arch all -Vl <app-binary> | grep -A5 LC_ENCRYPT   # WartoÅ›Ä‡ cryptid powinna wynosiÄ‡ 1
```

**Identyfikacja funkcji wraÅ¼liwych/niebezpiecznych**

*   **SÅ‚abe algorytmy haszujÄ…ce**

```bash
# Na urzÄ…dzeniu iOS
otool -Iv <app> | grep -w "_CC_MD5"
otool -Iv <app> | grep -w "_CC_SHA1"

# Na systemie Linux
grep -iER "_CC_MD5"
grep -iER "_CC_SHA1"
```
*   **Niebezpieczne funkcje losujÄ…ce**

```bash
# Na urzÄ…dzeniu iOS
otool -Iv <app> | grep -w "_random"
otool -Iv <app> | grep -w "_srand"
otool -Iv <app> | grep -w "_rand"

# Na systemie Linux
grep -iER "_random"
grep -iER "_srand"
grep -iER "_rand"
```
*   **Niebezpieczna funkcja â€Mallocâ€**

```bash
# Na urzÄ…dzeniu iOS
otool -Iv <app> | grep -w "_malloc"

# Na systemie Linux
grep -iER "_malloc"
```
*   **Niebezpieczne i podatne funkcje**

```bash
# Na urzÄ…dzeniu iOS
otool -Iv <app> | grep -w "_gets"
otool -Iv <app> | grep -w "_memcpy"
otool -Iv <app> | grep -w "_strncpy"
otool -Iv <app> | grep -w "_strlen"
otool -Iv <app> | grep -w "_vsnprintf"
otool -Iv <app> | grep -w "_sscanf"
otool -Iv <app> | grep -w "_strtok"
otool -Iv <app> | grep -w "_alloca"
otool -Iv <app> | grep -w "_sprintf"
otool -Iv <app> | grep -w "_printf"
otool -Iv <app> | grep -w "_vsprintf"

# Na systemie Linux
grep -R "_gets"
grep -iER "_memcpy"
grep -iER "_strncpy"
grep -iER "_strlen"
grep -iER "_vsnprintf"
grep -iER "_sscanf"
grep -iER "_strtok"
grep -iER "_alloca"
grep -iER "_sprintf"
grep -iER "_printf"
grep -iER "_vsprintf"
```

### Podstawowa analiza dynamiczna

SprawdÅº analizÄ™ dynamicznÄ…, ktÃ³rÄ… wykonuje [**MobSF**](https://github.com/MobSF/Mobile-Security-Framework-MobSF). BÄ™dziesz musiaÅ‚ poruszaÄ‡ siÄ™ po rÃ³Å¼nych widokach i wchodziÄ‡ w interakcje z nimi, ale narzÄ™dzie to bÄ™dzie podÅ‚Ä…czaÄ‡ wiele klas i wykonywaÄ‡ inne czynnoÅ›ci, a nastÄ™pnie przygotuje raport po zakoÅ„czeniu.

### Lista zainstalowanych aplikacji

UÅ¼yj polecenia `frida-ps -Uai`, aby okreÅ›liÄ‡ **identyfikator pakietu** zainstalowanych aplikacji:
```bash
$ frida-ps -Uai
PID  Name                 Identifier
----  -------------------  -----------------------------------------
6847  Calendar             com.apple.mobilecal
6815  Mail                 com.apple.mobilemail
-  App Store            com.apple.AppStore
-  Apple Store          com.apple.store.Jolly
-  Calculator           com.apple.calculator
-  Camera               com.apple.camera
-  iGoat-Swift          OWASP.iGoat-Swift
```
### Podstawowa enumeracja i hooking

Dowiedz siÄ™, jak **wyliczyÄ‡ skÅ‚adniki aplikacji** i jak Å‚atwo **hookowaÄ‡ metody i klasy** za pomocÄ… narzÄ™dzia objection:

{% content-ref url="ios-hooking-with-objection.md" %}
[ios-hooking-with-objection.md](ios-hooking-with-objection.md)
{% endcontent-ref %}

### Struktura pliku IPA

Struktura pliku **IPA** jest w zasadzie strukturÄ… **spakowanego pakietu**. ZmieniajÄ…c jego rozszerzenie na `.zip`, moÅ¼na go **rozpakowaÄ‡**, aby ujawniÄ‡ jego zawartoÅ›Ä‡. W tej strukturze **Bundle** reprezentuje w peÅ‚ni spakowanÄ… aplikacjÄ™ gotowÄ… do instalacji. WewnÄ…trz znajdziesz katalog o nazwie `<NAME>.app`, ktÃ³ry zawiera zasoby aplikacji.

* **`Info.plist`**: Ten plik przechowuje konkretne szczegÃ³Å‚y konfiguracji aplikacji.
* **`_CodeSignature/`**: Ten katalog zawiera plik plist, ktÃ³ry zawiera sygnaturÄ™, zapewniajÄ…c integralnoÅ›Ä‡ wszystkich plikÃ³w w pakiecie.
* **`Assets.car`**: Skompresowane archiwum przechowujÄ…ce pliki zasobÃ³w, takie jak ikony.
* **`Frameworks/`**: Ten folder zawiera biblioteki natywne aplikacji, ktÃ³re mogÄ… przyjmowaÄ‡ postaÄ‡ plikÃ³w `.dylib` lub `.framework`.
* **`PlugIns/`**: MoÅ¼e zawieraÄ‡ rozszerzenia aplikacji, znane jako pliki `.appex`, chociaÅ¼ nie zawsze sÄ… obecne.
* [**`Core Data`**](https://developer.apple.com/documentation/coredata): SÅ‚uÅ¼y do zapisywania trwaÅ‚ych danych aplikacji do uÅ¼ytku offline, do buforowania danych tymczasowych i dodawania funkcji cofania w aplikacji na jednym urzÄ…dzeniu. Aby zsynchronizowaÄ‡ dane miÄ™dzy wieloma urzÄ…dzeniami w jednym koncie iCloud, Core Data automatycznie odbija schemat w kontenerze CloudKit.
* [**`PkgInfo`**](https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPRuntimeConfig/Articles/ConfigApplications.html): Plik `PkgInfo` to alternatywny sposÃ³b okreÅ›lenia kodÃ³w typu i twÃ³rcy twojej aplikacji lub pakietu.
* **en.lproj, fr.proj, Base.lproj**: To pakiety jÄ™zykowe zawierajÄ…ce zasoby dla tych konkretnych jÄ™zykÃ³w oraz domyÅ›lny zasÃ³b w przypadku braku obsÅ‚ugi danego jÄ™zyka.
* **BezpieczeÅ„stwo**: Katalog `_CodeSignature/` odgrywa kluczowÄ… rolÄ™ w bezpieczeÅ„stwie aplikacji, weryfikujÄ…c integralnoÅ›Ä‡ wszystkich spakowanych plikÃ³w za pomocÄ… podpisÃ³w cyfrowych.
* **ZarzÄ…dzanie zasobami**: Plik `Assets.car` wykorzystuje kompresjÄ™ do efektywnego zarzÄ…dzania zasobami graficznymi, co jest kluczowe dla optymalizacji wydajnoÅ›ci aplikacji i zmniejszenia jej caÅ‚kowitego rozmiaru.
* **Frameworks i PlugIns**: Te katalogi podkreÅ›lajÄ… modularnoÅ›Ä‡ aplikacji iOS, pozwalajÄ…c programistom na doÅ‚Ä…czanie bibliotek kodu do ponownego uÅ¼ycia (`Frameworks/`) i rozszerzanie funkcjonalnoÅ›ci aplikacji (`PlugIns/`).
* **Lokalizacja**: Struktura wspiera wiele jÄ™zykÃ³w, uÅ‚atwiajÄ…c globalne dotarcie aplikacji poprzez doÅ‚Ä…czenie zasobÃ³w dla konkretnych pakietÃ³w jÄ™zykowych.

**Info.plist**

**Info.plist** peÅ‚ni rolÄ™ kamienia wÄ™gielnego dla aplikacji iOS, zawierajÄ…c kluczowe dane konfiguracyjne w postaci par **klucz-wartoÅ›Ä‡**. Ten plik jest niezbÄ™dny nie tylko dla aplikacji, ale takÅ¼e dla rozszerzeÅ„ aplikacji i frameworkÃ³w doÅ‚Ä…czonych w pakiecie. Jest on strukturyzowany w formacie XML lub binarnym i zawiera istotne informacje od uprawnieÅ„ aplikacji po konfiguracje zabezpieczeÅ„. Aby dokÅ‚adniej zbadaÄ‡ dostÄ™pne klucze, moÅ¼na odwoÅ‚aÄ‡ siÄ™ do [**Dokumentacji deweloperskiej Apple**](https://developer.apple.com/documentation/bundleresources/information\_property\_list?language=objc).

Dla osÃ³b chcÄ…cych pracowaÄ‡ z tym plikiem w bardziej dostÄ™pnym formacie, konwersjÄ™ XML moÅ¼na Å‚atwo osiÄ…gnÄ…Ä‡ za pomocÄ… `plutil` na macOS (dostÄ™pny domyÅ›lnie w wersjach 10.2 i nowszych) lub `plistutil` na Linuxie. Polecenia konwersji sÄ… nastÄ™pujÄ…ce:

* **Dla macOS**:
```bash
$ plutil -convert xml1 Info.plist
```
* **Dla systemu Linux**:
```bash
$ apt install libplist-utils
$ plistutil -i Info.plist -o Info_xml.plist
```
WÅ›rÃ³d licznych informacji, ktÃ³re plik **Info.plist** moÅ¼e ujawniÄ‡, godne uwagi wpisy obejmujÄ… ciÄ…gi uprawnieÅ„ aplikacji (`UsageDescription`), niestandardowe schematy URL (`CFBundleURLTypes`) oraz konfiguracje dotyczÄ…ce bezpieczeÅ„stwa transportu aplikacji (`NSAppTransportSecurity`). Te wpisy, wraz z innymi, takimi jak eksportowane/importowane niestandardowe typy dokumentÃ³w (`UTExportedTypeDeclarations` / `UTImportedTypeDeclarations`), moÅ¼na Å‚atwo zlokalizowaÄ‡, sprawdzajÄ…c plik lub uÅ¼ywajÄ…c prostego polecenia `grep`:
```bash
$ grep -i <keyword> Info.plist
```
**ÅšcieÅ¼ki danych**

W Å›rodowisku iOS katalogi sÄ… przeznaczone specjalnie dla **aplikacji systemowych** i **aplikacji zainstalowanych przez uÅ¼ytkownika**. Aplikacje systemowe znajdujÄ… siÄ™ w katalogu `/Applications`, podczas gdy aplikacje zainstalowane przez uÅ¼ytkownika umieszczone sÄ… w `/var/mobile/containers/Data/Application/`. Te aplikacje sÄ… przypisane unikalny identyfikator znany jako **128-bitowy UUID**, co sprawia, Å¼e rÄ™czne zlokalizowanie folderu aplikacji jest trudne ze wzglÄ™du na losowoÅ›Ä‡ nazw katalogÃ³w.

{% hint style="warning" %}
PoniewaÅ¼ aplikacje w iOS muszÄ… byÄ‡ zabezpieczone w piaskownicy, kaÅ¼da aplikacja bÄ™dzie miaÅ‚a rÃ³wnieÅ¼ folder wewnÄ…trz **`$HOME/Library/Containers`** o nazwie folderu aplikacji **`CFBundleIdentifier`**.

Jednak oba foldery (foldery danych i kontenerowe) zawierajÄ… plik **`.com.apple.mobile_container_manager.metadata.plist`**, ktÃ³ry Å‚Ä…czy oba pliki w kluczu `MCMetadataIdentifier`).
{% endhint %}

Aby uÅ‚atwiÄ‡ odkrywanie katalogu instalacyjnego aplikacji zainstalowanej przez uÅ¼ytkownika, narzÄ™dzie **objection** udostÄ™pnia przydatne polecenie `env`. To polecenie ujawnia szczegÃ³Å‚owe informacje o katalogu dla danej aplikacji. PoniÅ¼ej znajduje siÄ™ przykÅ‚ad uÅ¼ycia tego polecenia:
```bash
OWASP.iGoat-Swift on (iPhone: 11.1.2) [usb] # env

Name               Path
-----------------  -------------------------------------------------------------------------------------------
BundlePath         /var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app
CachesDirectory    /var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/Library/Caches
DocumentDirectory  /var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/Documents
LibraryDirectory   /var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693/Library
```
Alternatywnie nazwÄ™ aplikacji moÅ¼na wyszukaÄ‡ w `/private/var/containers` za pomocÄ… polecenia `find`:
```bash
find /private/var/containers -name "Progname*"
```
Polecenia takie jak `ps` i `lsof` mogÄ… rÃ³wnieÅ¼ byÄ‡ wykorzystane do zidentyfikowania procesu aplikacji i wylistowania otwartych plikÃ³w, odpowiednio, dostarczajÄ…c wglÄ…du w aktywne Å›cieÅ¼ki katalogÃ³w aplikacji:
```bash
ps -ef | grep -i <app-name>
lsof -p <pid> | grep -i "/containers" | head -n 1
```
**Katalog pakietÃ³w:**

* **NazwaAplikacji.app**
* To jest Pakiet Aplikacji, jak widziano wczeÅ›niej w IPA, zawiera podstawowe dane aplikacji, statycznÄ… zawartoÅ›Ä‡ oraz skompilowany plik binarny aplikacji.
* Ten katalog jest widoczny dla uÅ¼ytkownikÃ³w, ale **uÅ¼ytkownicy nie mogÄ… w nim zapisywaÄ‡**.
* ZawartoÅ›Ä‡ tego katalogu **nie jest tworzona kopii zapasowej**.
* ZawartoÅ›Ä‡ tego folderu jest uÅ¼ywana do **weryfikacji podpisu kodu**.

**Katalog danych:**

* **Dokumenty/**
* Zawiera wszystkie dane generowane przez uÅ¼ytkownika. UÅ¼ytkownik koÅ„cowy aplikacji inicjuje tworzenie tych danych.
* Widoczne dla uÅ¼ytkownikÃ³w i **uÅ¼ytkownicy mogÄ… w nim zapisywaÄ‡**.
* ZawartoÅ›Ä‡ tego katalogu **jest tworzona kopii zapasowej**.
* Aplikacja moÅ¼e wyÅ‚Ä…czyÄ‡ Å›cieÅ¼ki, ustawiajÄ…c `NSURLIsExcludedFromBackupKey`.
* **Biblioteka/**
* Zawiera wszystkie **pliki, ktÃ³re nie sÄ… specyficzne dla uÅ¼ytkownika**, takie jak **pamiÄ™Ä‡ podrÄ™czna**, **preferencje**, **ciasteczka** oraz pliki konfiguracyjne listy wÅ‚aÅ›ciwoÅ›ci (plist).
* Aplikacje iOS zazwyczaj uÅ¼ywajÄ… podkatalogÃ³w `Application Support` i `Caches`, ale aplikacja moÅ¼e tworzyÄ‡ niestandardowe podkatalogi.
* **Biblioteka/Caches/**
* Zawiera **pliki pamiÄ™ci podrÄ™cznej pÃ³Å‚trwaÅ‚ej**.
* Niewidoczne dla uÅ¼ytkownikÃ³w i **uÅ¼ytkownicy nie mogÄ… w nim zapisywaÄ‡**.
* ZawartoÅ›Ä‡ tego katalogu **nie jest tworzona kopii zapasowej**.
* System operacyjny moÅ¼e automatycznie usuwaÄ‡ pliki tego katalogu, gdy aplikacja nie jest uruchomiona, a miejsce na dysku jest niskie.
* **Biblioteka/Application Support/**
* Zawiera **pliki trwaÅ‚e** **niezbÄ™dne do uruchomienia aplikacji**.
* **Niewidoczne** **dla** **uÅ¼ytkownikÃ³w** i uÅ¼ytkownicy nie mogÄ… w nim zapisywaÄ‡.
* ZawartoÅ›Ä‡ tego katalogu **jest tworzona kopii zapasowej**.
* Aplikacja moÅ¼e wyÅ‚Ä…czyÄ‡ Å›cieÅ¼ki, ustawiajÄ…c `NSURLIsExcludedFromBackupKey`.
* **Biblioteka/Preferences/**
* UÅ¼ywane do przechowywania wÅ‚aÅ›ciwoÅ›ci, ktÃ³re mogÄ… **utrzymywaÄ‡ siÄ™ nawet po ponownym uruchomieniu aplikacji**.
* Informacje sÄ… zapisywane, niezaszyfrowane, wewnÄ…trz piaskownicy aplikacji w pliku plist o nazwie \[BUNDLE\_ID].plist.
* Wszystkie pary klucz/wartoÅ›Ä‡ przechowywane za pomocÄ… `NSUserDefaults` moÅ¼na znaleÅºÄ‡ w tym pliku.
* **tmp/**
* UÅ¼yj tego katalogu do zapisywania **plikÃ³w tymczasowych**, ktÃ³re nie muszÄ… przetrwaÄ‡ miÄ™dzy uruchomieniami aplikacji.
* Zawiera pliki pamiÄ™ci podrÄ™cznej nietrwaÅ‚ej.
* **Niewidoczne** dla uÅ¼ytkownikÃ³w.
* ZawartoÅ›Ä‡ tego katalogu **nie jest tworzona kopii zapasowej**.
* System operacyjny moÅ¼e automatycznie usuwaÄ‡ pliki tego katalogu, gdy aplikacja nie jest uruchomiona, a miejsce na dysku jest niskie.

Przyjrzyjmy siÄ™ bliÅ¼ej katalogowi Pakietu Aplikacji (.app) iGoat-Swift znajdujÄ…cemu siÄ™ w katalogu Bundle (`/var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app`):
```bash
OWASP.iGoat-Swift on (iPhone: 11.1.2) [usb] # ls
NSFileType      Perms  NSFileProtection    ...  Name
------------  -------  ------------------  ...  --------------------------------------
Regular           420  None                ...  rutger.html
Regular           420  None                ...  mansi.html
Regular           420  None                ...  splash.html
Regular           420  None                ...  about.html

Regular           420  None                ...  LICENSE.txt
Regular           420  None                ...  Sentinel.txt
Regular           420  None                ...  README.txt
```
### Odwracanie binarne

WewnÄ…trz folderu `<application-name>.app` znajdziesz plik binarny o nazwie `<application-name>`. To jest plik, ktÃ³ry zostanie **wykonany**. MoÅ¼esz przeprowadziÄ‡ podstawowÄ… inspekcjÄ™ binarnego pliku za pomocÄ… narzÄ™dzia **`otool`**:
```bash
otool -Vh DVIA-v2 #Check some compilation attributes
magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags
MH_MAGIC_64    ARM64        ALL  0x00     EXECUTE    65       7112   NOUNDEFS DYLDLINK TWOLEVEL WEAK_DEFINES BINDS_TO_WEAK PIE

otool -L DVIA-v2 #Get third party libraries
DVIA-v2:
/usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 400.9.1)
/usr/lib/libsqlite3.dylib (compatibility version 9.0.0, current version 274.6.0)
/usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.11)
@rpath/Bolts.framework/Bolts (compatibility version 1.0.0, current version 1.0.0)
[...]
```
**SprawdÅº, czy aplikacja jest zaszyfrowana**

SprawdÅº, czy istnieje jakiekolwiek wyjÅ›cie dla:
```bash
otool -l <app-binary> | grep -A 4 LC_ENCRYPTION_INFO
```
**RozkÅ‚adanie binarnego pliku**

RozkÅ‚adanie sekcji tekstowej:
```bash
otool -tV DVIA-v2
DVIA-v2:
(__TEXT,__text) section
+[DDLog initialize]:
0000000100004ab8    sub    sp, sp, #0x60
0000000100004abc    stp    x29, x30, [sp, #0x50]   ; Latency: 6
0000000100004ac0    add    x29, sp, #0x50
0000000100004ac4    sub    x8, x29, #0x10
0000000100004ac8    mov    x9, #0x0
0000000100004acc    adrp    x10, 1098 ; 0x10044e000
0000000100004ad0    add    x10, x10, #0x268
```
Aby wydrukowaÄ‡ **segment Objective-C** przykÅ‚adowej aplikacji, moÅ¼na uÅ¼yÄ‡:
```bash
otool -oV DVIA-v2
DVIA-v2:
Contents of (__DATA,__objc_classlist) section
00000001003dd5b8 0x1004423d0 _OBJC_CLASS_$_DDLog
isa        0x1004423a8 _OBJC_METACLASS_$_DDLog
superclass 0x0 _OBJC_CLASS_$_NSObject
cache      0x0 __objc_empty_cache
vtable     0x0
data       0x1003de748
flags          0x80
instanceStart  8
```
Aby uzyskaÄ‡ bardziej zwiÄ™zÅ‚y kod Objective-C, moÅ¼na uÅ¼yÄ‡ [**class-dump**](http://stevenygard.com/projects/class-dump/):
```bash
class-dump some-app
//
//     Generated by class-dump 3.5 (64 bit).
//
//     class-dump is Copyright (C) 1997-1998, 2000-2001, 2004-2013 by Steve Nygard.
//

#pragma mark Named Structures

struct CGPoint {
double _field1;
double _field2;
};

struct CGRect {
struct CGPoint _field1;
struct CGSize _field2;
};

struct CGSize {
double _field1;
double _field2;
};
```
Jednak najlepsze opcje do rozÅ‚oÅ¼enia binarnego to: [**Hopper**](https://www.hopperapp.com/download.html?) i [**IDA**](https://www.hex-rays.com/products/ida/support/download_freeware/).

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) do Å‚atwego tworzenia i **automatyzacji prac** z wykorzystaniem najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ciowych na Å›wiecie.\
Otrzymaj dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Przechowywanie danych

Aby dowiedzieÄ‡ siÄ™, w jaki sposÃ³b iOS przechowuje dane na urzÄ…dzeniu, przeczytaj tÄ™ stronÄ™:

{% content-ref url="ios-basics.md" %}
[ios-basics.md](ios-basics.md)
{% endcontent-ref %}

{% hint style="warning" %}
NastÄ™pujÄ…ce miejsca do przechowywania informacji powinny byÄ‡ sprawdzone **bezpoÅ›rednio po zainstalowaniu aplikacji**, **po sprawdzeniu wszystkich funkcji** aplikacji, a nawet po **wylogowaniu siÄ™ z jednego uÅ¼ytkownika i zalogowaniu siÄ™ na innego**.\
Celem jest znalezienie **niezabezpieczonych wraÅ¼liwych informacji** aplikacji (hasÅ‚a, tokeny), bieÅ¼Ä…cego uÅ¼ytkownika i wczeÅ›niej zalogowanych uÅ¼ytkownikÃ³w.
{% endhint %}

### Plist

Pliki **plist** to strukturalne pliki XML zawierajÄ…ce pary klucz-wartoÅ›Ä‡. Jest to sposÃ³b przechowywania danych trwaÅ‚ych, dlatego czasami moÅ¼na w nich znaleÅºÄ‡ **wraÅ¼liwe informacje**. Zaleca siÄ™ sprawdzenie tych plikÃ³w po zainstalowaniu aplikacji i po intensywnym jej uÅ¼yciu, aby zobaczyÄ‡, czy zapisano nowe dane.

NajczÄ™stszym sposobem trwaÅ‚ego przechowywania danych w plikach plist jest korzystanie z **NSUserDefaults**. Ten plik plist jest zapisywany wewnÄ…trz piaskownicy aplikacji w **`Library/Preferences/<appBundleID>.plist`**

Klasa [`NSUserDefaults`](https://developer.apple.com/documentation/foundation/nsuserdefaults) zapewnia interfejs programistyczny do interakcji z systemem domyÅ›lnym. System domyÅ›lny pozwala aplikacji dostosowaÄ‡ swoje zachowanie zgodnie z **preferencjami uÅ¼ytkownika**. Dane zapisane przez `NSUserDefaults` moÅ¼na zobaczyÄ‡ w pakiecie aplikacji. Ta klasa przechowuje **dane** w pliku **plist**, ale jest przeznaczona do uÅ¼ytku z maÅ‚ymi iloÅ›ciami danych.

Te dane nie mogÄ… byÄ‡ bezpoÅ›rednio dostÄ™pne za pomocÄ… zaufanego komputera, ale moÅ¼na uzyskaÄ‡ do nich dostÄ™p wykonujÄ…c **backup**.

MoÅ¼esz **wydobyÄ‡** informacje zapisane za pomocÄ… **`NSUserDefaults`** za pomocÄ… `ios nsuserdefaults get` z objection.

Aby znaleÅºÄ‡ wszystkie pliki plist uÅ¼ywane przez aplikacjÄ™, moÅ¼esz uzyskaÄ‡ dostÄ™p do `/private/var/mobile/Containers/Data/Application/{APPID}` i uruchomiÄ‡:
```bash
find ./ -name "*.plist"
```
Aby przekonwertowaÄ‡ pliki z formatu **XML lub binarnego (bplist)** na XML, dostÄ™pne sÄ… rÃ³Å¼ne metody w zaleÅ¼noÅ›ci od systemu operacyjnego:

**Dla uÅ¼ytkownikÃ³w macOS:** Skorzystaj z polecenia `plutil`. Jest to wbudowane narzÄ™dzie w macOS (10.2+), zaprojektowane do tego celu:
```bash
$ plutil -convert xml1 Info.plist
```
**Dla uÅ¼ytkownikÃ³w Linuxa:** Najpierw zainstaluj `libplist-utils`, a nastÄ™pnie uÅ¼yj `plistutil`, aby przekonwertowaÄ‡ swÃ³j plik:
```bash
$ apt install libplist-utils
$ plistutil -i Info.plist -o Info_xml.plist
```
**W trakcie sesji Objection:** Do analizy aplikacji mobilnych, konkretna komenda pozwala na bezpoÅ›rednie konwertowanie plikÃ³w plist:
```bash
ios plist cat /private/var/mobile/Containers/Data/Application/<Application-UUID>/Library/Preferences/com.some.package.app.plist
```
### Core Data

[`Core Data`](https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreData/nsfetchedresultscontroller.html#//apple_ref/doc/uid/TP40001075-CH8-SW1) to framework do zarzÄ…dzania warstwÄ… modelu obiektÃ³w w Twojej aplikacji. [Core Data moÅ¼e uÅ¼ywaÄ‡ SQLite jako swojego trwaÅ‚ego magazynu](https://cocoacasts.com/what-is-the-difference-between-core-data-and-sqlite/), ale sam framework nie jest bazÄ… danych.\
CoreData domyÅ›lnie nie szyfruje swoich danych. Jednak dodatkowa warstwa szyfrowania moÅ¼e zostaÄ‡ dodana do CoreData. Zobacz [Repozytorium na GitHubie](https://github.com/project-imas/encrypted-core-data) po wiÄ™cej szczegÃ³Å‚Ã³w.

Informacje o SQLite Core Data aplikacji znajdziesz w Å›cieÅ¼ce `/private/var/mobile/Containers/Data/Application/{APPID}/Library/Application Support`

**JeÅ›li moÅ¼esz otworzyÄ‡ SQLite i uzyskaÄ‡ dostÄ™p do wraÅ¼liwych informacji, to znalazÅ‚eÅ› bÅ‚Ä…d konfiguracji.**

{% code title="Kod z iGoat" %}
```objectivec
-(void)storeDetails {
AppDelegate * appDelegate = (AppDelegate *)(UIApplication.sharedApplication.delegate);

NSManagedObjectContext *context =[appDelegate managedObjectContext];

User *user = [self fetchUser];
if (user) {
return;
}
user = [NSEntityDescription insertNewObjectForEntityForName:@"User"
inManagedObjectContext:context];
user.email = CoreDataEmail;
user.password = CoreDataPassword;
NSError *error;
if (![context save:&error]) {
NSLog(@"Error in saving data: %@", [error localizedDescription]);

}else{
NSLog(@"data stored in core data");
}
}
```
{% endcode %}

### YapDatabase

[YapDatabase](https://github.com/yapstudios/YapDatabase) to magazyn typu klucz/wartoÅ›Ä‡ zbudowany na bazie SQLite.\
PoniewaÅ¼ bazy danych Yap to bazy danych sqlite, moÅ¼na je znaleÅºÄ‡, korzystajÄ…c z polecenia zaproponowanego w poprzednim rozdziale.

### Inne bazy danych SQLite

Jest powszechne, Å¼e aplikacje tworzÄ… swoje wÅ‚asne bazy danych sqlite. MogÄ… one przechowywaÄ‡ na nich **wraÅ¼liwe dane** i pozostawiaÄ‡ je niezaszyfrowane. Dlatego zawsze warto sprawdziÄ‡ kaÅ¼dÄ… bazÄ™ danych w katalogu aplikacji. PrzejdÅº do katalogu aplikacji, gdzie dane sÄ… zapisywane (`/private/var/mobile/Containers/Data/Application/{APPID}`).
```bash
find ./ -name "*.sqlite" -or -name "*.db"
```
### Bazy danych Firebase Real-Time

Deweloperzy majÄ… moÅ¼liwoÅ›Ä‡ **przechowywania i synchronizacji danych** w **bazie danych hostowanej w chmurze NoSQL** za poÅ›rednictwem Firebase Real-Time Databases. Dane przechowywane sÄ… w formacie JSON, a nastÄ™pnie synchronizowane z wszystkimi podÅ‚Ä…czonymi klientami w czasie rzeczywistym.

MoÅ¼esz dowiedzieÄ‡ siÄ™, jak sprawdziÄ‡ bÅ‚Ä™dnie skonfigurowane bazy danych Firebase tutaj:

{% content-ref url="../../network-services-pentesting/pentesting-web/buckets/firebase-database.md" %}
[firebase-database.md](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)
{% endcontent-ref %}

### Bazy danych Realm

[Realm Objective-C](https://realm.io/docs/objc/latest/) i [Realm Swift](https://realm.io/docs/swift/latest/) oferujÄ… potÄ™Å¼nÄ… alternatywÄ™ dla przechowywania danych, niedostÄ™pnÄ… w ofercie Apple. DomyÅ›lnie **przechowujÄ… dane w formie niezaszyfrowanej**, z moÅ¼liwoÅ›ciÄ… szyfrowania poprzez okreÅ›lonÄ… konfiguracjÄ™.

Bazy danych znajdujÄ… siÄ™ pod Å›cieÅ¼kÄ…: `/private/var/mobile/Containers/Data/Application/{APPID}`. Aby zbadaÄ‡ te pliki, moÅ¼na skorzystaÄ‡ z poleceÅ„ takich jak:
```bash
iPhone:/private/var/mobile/Containers/Data/Application/A079DF84-726C-4AEA-A194-805B97B3684A/Documents root# ls
default.realm  default.realm.lock  default.realm.management/  default.realm.note|

$ find ./ -name "*.realm*"
```
Do przeglÄ…dania tych plikÃ³w bazy danych zaleca siÄ™ narzÄ™dzie [**Realm Studio**](https://github.com/realm/realm-studio).

Aby zaimplementowaÄ‡ szyfrowanie w bazie danych Realm, moÅ¼na uÅ¼yÄ‡ poniÅ¼szego fragmentu kodu:
```swift
// Open the encrypted Realm file where getKey() is a method to obtain a key from the Keychain or a server
let config = Realm.Configuration(encryptionKey: getKey())
do {
let realm = try Realm(configuration: config)
// Use the Realm as normal
} catch let error as NSError {
// If the encryption key is wrong, `error` will say that it's an invalid database
fatalError("Error opening realm: \(error)")
}
```
### Bazy danych Couchbase Lite

[Couchbase Lite](https://github.com/couchbase/couchbase-lite-ios) jest opisany jako **lekki** i **wbudowany** silnik baz danych, ktÃ³ry stosuje podejÅ›cie **zorientowane na dokumenty** (NoSQL). Zaprojektowany tak, aby byÅ‚ natywny dla systemÃ³w **iOS** i **macOS**, oferuje moÅ¼liwoÅ›Ä‡ synchronizacji danych w sposÃ³b bezproblemowy.

Aby zidentyfikowaÄ‡ potencjalne bazy danych Couchbase na urzÄ…dzeniu, naleÅ¼y sprawdziÄ‡ nastÄ™pujÄ…cy katalog:
```bash
ls /private/var/mobile/Containers/Data/Application/{APPID}/Library/Application Support/
```
### Ciasteczka

iOS przechowuje ciasteczka aplikacji w **`Library/Cookies/cookies.binarycookies`** wewnÄ…trz folderu kaÅ¼dej aplikacji. Jednak deweloperzy czasami decydujÄ… siÄ™ je zapisaÄ‡ w **keychain**, poniewaÅ¼ wspomniany **plik cookie moÅ¼e byÄ‡ dostÄ™pny w kopii zapasowej**.

Aby przejrzeÄ‡ plik ciasteczek, moÅ¼na skorzystaÄ‡ z [**tego skryptu w jÄ™zyku Python**](https://github.com/mdegrazia/Safari-Binary-Cookie-Parser) lub uÅ¼yÄ‡ polecenia **`ios cookies get`** w narzÄ™dziu objection.\
**MoÅ¼na rÃ³wnieÅ¼ uÅ¼yÄ‡ narzÄ™dzia objection do** konwersji tych plikÃ³w na format JSON i przejrzenia danych.
```bash
...itudehacks.DVIAswiftv2.develop on (iPhone: 13.2.3) [usb] # ios cookies get --json
[
{
"domain": "highaltitudehacks.com",
"expiresDate": "2051-09-15 07:46:43 +0000",
"isHTTPOnly": "false",
"isSecure": "false",
"name": "username",
"path": "/",
"value": "admin123",
"version": "0"
}
]
```
### PamiÄ™Ä‡ podrÄ™czna

DomyÅ›lnie NSURLSession przechowuje dane, takie jak **Å¼Ä…dania i odpowiedzi HTTP w bazie danych Cache.db**. Ta baza danych moÅ¼e zawieraÄ‡ **dane wraÅ¼liwe**, jeÅ›li tokeny, nazwy uÅ¼ytkownikÃ³w lub jakiekolwiek inne informacje wraÅ¼liwe zostaÅ‚y zapisane w pamiÄ™ci podrÄ™cznej. Aby znaleÅºÄ‡ zapisane informacje, otwÃ³rz katalog danych aplikacji (`/var/mobile/Containers/Data/Application/<UUID>`) i przejdÅº do `/Library/Caches/<Bundle Identifier>`. **PamiÄ™Ä‡ podrÄ™czna WebKit jest rÃ³wnieÅ¼ przechowywana w pliku Cache.db**. **Objection** moÅ¼e otworzyÄ‡ i interakcjonowaÄ‡ z bazÄ… danych za pomocÄ… polecenia `sqlite connect Cache.db`, poniewaÅ¼ jest to **zwykÅ‚a baza danych SQLite**.

**Zaleca siÄ™ wyÅ‚Ä…czenie pamiÄ™ci podrÄ™cznej dla tych danych**, poniewaÅ¼ mogÄ… one zawieraÄ‡ informacje wraÅ¼liwe w Å¼Ä…daniu lub odpowiedzi. PoniÅ¼ej przedstawiono rÃ³Å¼ne sposoby osiÄ…gniÄ™cia tego:

1. Zaleca siÄ™ usuniÄ™cie zapisanych odpowiedzi po wylogowaniu. MoÅ¼na to zrobiÄ‡ za pomocÄ… udostÄ™pnionej metody Apple o nazwie [`removeAllCachedResponses`](https://developer.apple.com/documentation/foundation/urlcache/1417802-removeallcachedresponses). MoÅ¼na wywoÅ‚aÄ‡ tÄ™ metodÄ™ w nastÄ™pujÄ…cy sposÃ³b:

`URLCache.shared.removeAllCachedResponses()`

Ta metoda usunie wszystkie zapisane Å¼Ä…dania i odpowiedzi z pliku Cache.db.
2. JeÅ›li nie potrzebujesz korzystaÄ‡ z zalet plikÃ³w cookie, zaleca siÄ™ po prostu uÅ¼ycie wÅ‚aÅ›ciwoÅ›ci konfiguracji [.ephemeral](https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1410529-ephemeral) URLSession, ktÃ³ra wyÅ‚Ä…czy zapisywanie plikÃ³w cookie i pamiÄ™ci podrÄ™cznej.

[Dokumentacja Apple](https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1410529-ephemeral):

`Obiekt konfiguracji sesji efemerycznej jest podobny do domyÅ›lnej konfiguracji sesji (patrz domyÅ›lna), z tym wyjÄ…tkiem, Å¼e odpowiadajÄ…cy obiekt sesji nie przechowuje pamiÄ™ci podrÄ™cznej, magazynÃ³w poÅ›wiadczeÅ„ ani Å¼adnych danych zwiÄ…zanych z sesjÄ… na dysku. Zamiast tego dane zwiÄ…zane z sesjÄ… sÄ… przechowywane w pamiÄ™ci RAM. Jedynym momentem, kiedy sesja efemeryczna zapisuje dane na dysku, jest wtedy, gdy mÃ³wisz jej, aby zapisaÅ‚a zawartoÅ›Ä‡ adresu URL do pliku.`
3. PamiÄ™Ä‡ podrÄ™czna moÅ¼e byÄ‡ rÃ³wnieÅ¼ wyÅ‚Ä…czona poprzez ustawienie polityki pamiÄ™ci podrÄ™cznej na [.notAllowed](https://developer.apple.com/documentation/foundation/urlcache/storagepolicy/notallowed). WyÅ‚Ä…czy to przechowywanie pamiÄ™ci podrÄ™cznej w dowolny sposÃ³b, zarÃ³wno w pamiÄ™ci, jak i na dysku.

### Zrzuty ekranu

Za kaÅ¼dym razem, gdy naciÅ›niesz przycisk domowy, iOS **robi zrzut ekranu** bieÅ¼Ä…cego ekranu, aby umoÅ¼liwiÄ‡ pÅ‚ynne przejÅ›cie do aplikacji. JednakÅ¼e, jeÅ›li na bieÅ¼Ä…cym ekranie znajdujÄ… siÄ™ **dane wraÅ¼liwe**, zostanÄ… one **zapisane** w **obrazie** (ktÃ³ry **utrzymuje siÄ™** **po** **ponownym** **uruchomieniu**). SÄ… to zrzuty ekranu, do ktÃ³rych moÅ¼na rÃ³wnieÅ¼ uzyskaÄ‡ dostÄ™p, podwÃ³jnie klikajÄ…c ekran gÅ‚Ã³wny, aby przeÅ‚Ä…czaÄ‡ siÄ™ miÄ™dzy aplikacjami.

Chyba Å¼e iPhone jest zÅ‚amany, **atakujÄ…cy** musi mieÄ‡ **dostÄ™p** do **odblokowanego** **urzÄ…dzenia**, aby zobaczyÄ‡ te zrzuty ekranu. DomyÅ›lnie ostatni zrzut ekranu jest przechowywany w piaskownicy aplikacji w folderze `Library/Caches/Snapshots/` lub `Library/SplashBoard/Snapshots` (zaufane komputery nie mogÄ… uzyskaÄ‡ dostÄ™pu do systemu plikÃ³w od wersji iOS 7.0).

Jednym ze sposobÃ³w zapobieÅ¼enia temu zÅ‚emu zachowaniu jest umieszczenie pustego ekranu lub usuniÄ™cie danych wraÅ¼liwych przed zrobieniem zrzutu ekranu za pomocÄ… funkcji `ApplicationDidEnterBackground()`.

PoniÅ¼ej znajduje siÄ™ przykÅ‚adowa metoda naprawcza, ktÃ³ra ustawia domyÅ›lny zrzut ekranu.

Swift:
```swift
private var backgroundImage: UIImageView?

func applicationDidEnterBackground(_ application: UIApplication) {
let myBanner = UIImageView(image: #imageLiteral(resourceName: "overlayImage"))
myBanner.frame = UIScreen.main.bounds
backgroundImage = myBanner
window?.addSubview(myBanner)
}

func applicationWillEnterForeground(_ application: UIApplication) {
backgroundImage?.removeFromSuperview()
}
```
**Objective-C:**  
**Cel-C:**
```
@property (UIImageView *)backgroundImage;

- (void)applicationDidEnterBackground:(UIApplication *)application {
UIImageView *myBanner = [[UIImageView alloc] initWithImage:@"overlayImage.png"];
self.backgroundImage = myBanner;
self.backgroundImage.bounds = UIScreen.mainScreen.bounds;
[self.window addSubview:myBanner];
}

- (void)applicationWillEnterForeground:(UIApplication *)application {
[self.backgroundImage removeFromSuperview];
}
```
To ustawia obraz tÅ‚a na `overlayImage.png` za kaÅ¼dym razem, gdy aplikacja jest w tle. Zapobiega to wyciekom wraÅ¼liwych danych, poniewaÅ¼ `overlayImage.png` zawsze bÄ™dzie nadpisywaÄ‡ bieÅ¼Ä…cy widok.

### Keychain

Do dostÄ™pu i zarzÄ…dzania schowkiem iOS dostÄ™pne sÄ… narzÄ™dzia takie jak [**Keychain-Dumper**](https://github.com/ptoomey3/Keychain-Dumper), odpowiednie dla urzÄ…dzeÅ„ z jailbreakiem. Dodatkowo [**Objection**](https://github.com/sensepost/objection) udostÄ™pnia polecenie `ios keychain dump` do podobnych celÃ³w.

#### **Przechowywanie PoÅ›wiadczeÅ„**

Klasa **NSURLCredential** jest idealna do przechowywania wraÅ¼liwych informacji bezpoÅ›rednio w schowku, omijajÄ…c koniecznoÅ›Ä‡ korzystania z NSUserDefaults lub innych opakowaÅ„. Aby przechowywaÄ‡ poÅ›wiadczenia po zalogowaniu, uÅ¼ywany jest nastÄ™pujÄ…cy kod w jÄ™zyku Swift:
```swift
NSURLCredential *credential;
credential = [NSURLCredential credentialWithUser:username password:password persistence:NSURLCredentialPersistencePermanent];
[[NSURLCredentialStorage sharedCredentialStorage] setCredential:credential forProtectionSpace:self.loginProtectionSpace];
```
Aby wydobyÄ‡ te przechowywane poÅ›wiadczenia, uÅ¼ywane jest polecenie Objection `ios nsurlcredentialstorage dump`.

## **Niestandardowe klawiatury i pamiÄ™Ä‡ podrÄ™czna klawiatury**

Od wersji iOS 8.0 uÅ¼ytkownicy mogÄ… instalowaÄ‡ rozszerzenia niestandardowych klawiatur, ktÃ³re moÅ¼na zarzÄ…dzaÄ‡ w **Ustawienia > OgÃ³lne > Klawiatura > Klawiatury**. ChociaÅ¼ te klawiatury oferujÄ… rozszerzonÄ… funkcjonalnoÅ›Ä‡, stanowiÄ… ryzyko rejestrowania klawiszy i przesyÅ‚ania danych do zewnÄ™trznych serwerÃ³w, chociaÅ¼ uÅ¼ytkownicy sÄ… informowani o klawiaturach wymagajÄ…cych dostÄ™pu do sieci. Aplikacje mogÄ… i powinny ograniczaÄ‡ korzystanie z niestandardowych klawiatur do wprowadzania informacji poufnych.

**Zalecenia dotyczÄ…ce bezpieczeÅ„stwa:**

* Zaleca siÄ™ wyÅ‚Ä…czenie klawiatur stron trzecich dla zwiÄ™kszonego bezpieczeÅ„stwa.
* NaleÅ¼y uwaÅ¼aÄ‡ na funkcje autokorekty i automatycznych sugestii domyÅ›lnej klawiatury iOS, ktÃ³re mogÄ… przechowywaÄ‡ poufne informacje w plikach pamiÄ™ci podrÄ™cznej znajdujÄ…cych siÄ™ w `Library/Keyboard/{locale}-dynamic-text.dat` lub `/private/var/mobile/Library/Keyboard/dynamic-text.dat`. Te pliki pamiÄ™ci podrÄ™cznej powinny byÄ‡ regularnie sprawdzane pod kÄ…tem danych poufnych. Zaleca siÄ™ resetowanie sÅ‚ownika klawiatury za pomocÄ… **Ustawienia > OgÃ³lne > Resetuj > Resetuj sÅ‚ownik klawiatury** w celu wyczyszczenia danych pamiÄ™ci podrÄ™cznej.
* Przechwycenie ruchu sieciowego moÅ¼e ujawniÄ‡, czy niestandardowa klawiatura przesyÅ‚a klawisze zdalnie.

### **Zapobieganie buforowaniu pÃ³l tekstowych**

ProtokÃ³Å‚ [UITextInputTraits](https://developer.apple.com/reference/uikit/uitextinputtraits) oferuje wÅ‚aÅ›ciwoÅ›ci do zarzÄ…dzania autokorektÄ… i wprowadzaniem tekstu zabezpieczonego, co jest istotne dla zapobiegania buforowaniu informacji poufnych. Na przykÅ‚ad wyÅ‚Ä…czenie autokorekty i wÅ‚Ä…czenie wprowadzania tekstu zabezpieczonego moÅ¼na osiÄ…gnÄ…Ä‡ za pomocÄ…:
```objectivec
textObject.autocorrectionType = UITextAutocorrectionTypeNo;
textObject.secureTextEntry = YES;
```
Dodatkowo, programiÅ›ci powinni upewniÄ‡ siÄ™, Å¼e pola tekstowe, zwÅ‚aszcza te sÅ‚uÅ¼Ä…ce do wprowadzania wraÅ¼liwych informacji, takich jak hasÅ‚a i PIN-y, wyÅ‚Ä…czajÄ… buforowanie, ustawiajÄ…c `autocorrectionType` na `UITextAutocorrectionTypeNo` i `secureTextEntry` na `YES`.
```objectivec
UITextField *textField = [[UITextField alloc] initWithFrame:frame];
textField.autocorrectionType = UITextAutocorrectionTypeNo;
```
## **Dzienniki**

Debugowanie kodu czÄ™sto wymaga uÅ¼ycia **logowania**. Istnieje ryzyko, poniewaÅ¼ **dzienniki mogÄ… zawieraÄ‡ informacje poufne**. WczeÅ›niej, w iOS 6 i wczeÅ›niejszych wersjach, dzienniki byÅ‚y dostÄ™pne dla wszystkich aplikacji, co stanowiÅ‚o ryzyko wycieku poufnych danych. **Obecnie aplikacje majÄ… ograniczony dostÄ™p tylko do swoich dziennikÃ³w**.

Mimo tych ograniczeÅ„, **atakujÄ…cy majÄ…cy fizyczny dostÄ™p** do odblokowanego urzÄ…dzenia nadal moÅ¼e to wykorzystaÄ‡, podÅ‚Ä…czajÄ…c urzÄ…dzenie do komputera i **czytajÄ…c dzienniki**. Warto zauwaÅ¼yÄ‡, Å¼e dzienniki pozostajÄ… na dysku nawet po odinstalowaniu aplikacji.

Aby zmniejszyÄ‡ ryzyko, zaleca siÄ™ **dokÅ‚adne interakcje z aplikacjÄ…**, eksplorujÄ…c wszystkie jej funkcjonalnoÅ›ci i dane wejÅ›ciowe, aby upewniÄ‡ siÄ™, Å¼e nie sÄ… logowane nieumyÅ›lnie Å¼adne poufne informacje.

Podczas przeglÄ…dania kodu ÅºrÃ³dÅ‚owego aplikacji w poszukiwaniu potencjalnych wyciekÃ³w, szukaj zarÃ³wno **predefiniowanych** jak i **niestandardowych instrukcji logowania** za pomocÄ… sÅ‚Ã³w kluczowych takich jak `NSLog`, `NSAssert`, `NSCAssert`, `fprintf` dla wbudowanych funkcji oraz wszelkich wzmianek o `Logging` lub `Logfile` dla niestandardowych implementacji.

### **Monitorowanie DziennikÃ³w Systemowych**

Aplikacje rejestrujÄ… rÃ³Å¼ne informacje, ktÃ³re mogÄ… byÄ‡ poufne. Aby monitorowaÄ‡ te dzienniki, narzÄ™dzia i polecenia takie jak:
```bash
idevice_id --list   # To find the device ID
idevicesyslog -u <id> (| grep <app>)   # To capture the device logs
```
SÄ… przydatne. Dodatkowo **Xcode** zapewnia sposÃ³b na zbieranie logÃ³w konsoli:

1. OtwÃ³rz Xcode.
2. PodÅ‚Ä…cz urzÄ…dzenie iOS.
3. PrzejdÅº do **Okno** -> **UrzÄ…dzenia i Symulatory**.
4. Wybierz swoje urzÄ…dzenie.
5. WywoÅ‚aj problem, ktÃ³ry badasz.
6. UÅ¼yj przycisku **OtwÃ³rz KonsolÄ™**, aby zobaczyÄ‡ logi w nowym oknie.

Dla bardziej zaawansowanego logowania, poÅ‚Ä…czenie z powÅ‚okÄ… urzÄ…dzenia i uÅ¼ycie **socat** moÅ¼e zapewniÄ‡ monitorowanie logÃ³w w czasie rzeczywistym:
```bash
iPhone:~ root# socat - UNIX-CONNECT:/var/run/lockdown/syslog.sock
```
NastÄ™pnie wykonaj polecenia, aby obserwowaÄ‡ aktywnoÅ›Ä‡ dziennika, ktÃ³ra moÅ¼e byÄ‡ nieoceniona przy diagnozowaniu problemÃ³w lub identyfikowaniu potencjalnych wyciekÃ³w danych w dziennikach.

***

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) do Å‚atwego tworzenia i **automatyzacji prac** z wykorzystaniem najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ciowych na Å›wiecie.\
Otrzymaj DostÄ™p DziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Kopie zapasowe

Funkcje **automatycznych kopii zapasowych** sÄ… zintegrowane w system iOS, uÅ‚atwiajÄ…c tworzenie kopii danych urzÄ…dzenia za pomocÄ… iTunes (do macOS Catalina), Finder (od macOS Catalina) lub iCloud. Kopie te obejmujÄ… niemal wszystkie dane urzÄ…dzenia, z wyjÄ…tkiem bardzo wraÅ¼liwych elementÃ³w, takich jak szczegÃ³Å‚y Apple Pay i konfiguracje Touch ID.

### Ryzyka bezpieczeÅ„stwa

UwzglÄ™dnienie **zainstalowanych aplikacji i ich danych** w kopii zapasowej stwarza ryzyko potencjalnego **wycieku danych** i zagroÅ¼enie, Å¼e **modyfikacje kopii zapasowej mogÄ… zmieniÄ‡ funkcjonalnoÅ›Ä‡ aplikacji**. Zaleca siÄ™ **nie przechowywaÄ‡ wraÅ¼liwych informacji w postaci tekstowej** w katalogu Å¼adnej aplikacji ani jej podkatalogach, aby zminimalizowaÄ‡ te ryzyka.

### Wykluczanie plikÃ³w z kopii zapasowych

Pliki w `Documents/` i `Library/Application Support/` sÄ… domyÅ›lnie kopiowane. Deweloperzy mogÄ… wykluczyÄ‡ okreÅ›lone pliki lub katalogi z kopii zapasowych, uÅ¼ywajÄ…c `NSURL setResourceValue:forKey:error:` z `NSURLIsExcludedFromBackupKey`. Ta praktyka jest kluczowa dla ochrony wraÅ¼liwych danych przed uwzglÄ™dnieniem ich w kopii zapasowej.

### Testowanie pod kÄ…tem podatnoÅ›ci

Aby oceniÄ‡ bezpieczeÅ„stwo kopii zapasowej aplikacji, zacznij od **utworzenia kopii zapasowej** za pomocÄ… Finder, a nastÄ™pnie zlokalizuj jÄ…, korzystajÄ…c z porad zawartych w [oficjalnej dokumentacji Apple](https://support.apple.com/en-us/HT204215). Analizuj kopiÄ™ zapasowÄ… pod kÄ…tem wraÅ¼liwych danych lub konfiguracji, ktÃ³re mogÄ… zostaÄ‡ zmienione, aby wpÅ‚ynÄ…Ä‡ na zachowanie aplikacji.

Informacje wraÅ¼liwe moÅ¼na wyszukaÄ‡ za pomocÄ… narzÄ™dzi wiersza poleceÅ„ lub aplikacji takich jak [iMazing](https://imazing.com). Dla zaszyfrowanych kopii zapasowych obecnoÅ›Ä‡ szyfrowania moÅ¼na potwierdziÄ‡, sprawdzajÄ…c klucz "IsEncrypted" w pliku "Manifest.plist" w gÅ‚Ã³wnym katalogu kopii zapasowej.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
...
<key>Date</key>
<date>2021-03-12T17:43:33Z</date>
<key>IsEncrypted</key>
<true/>
...
</plist>
```
Do radzenia sobie z zaszyfrowanymi kopiami zapasowymi, skrypty Python dostÄ™pne w [repozytorium GitHub DinoSec](https://github.com/dinosec/iphone-dataprotection/tree/master/python\_scripts), takie jak **backup\_tool.py** i **backup\_passwd.py**, mogÄ… byÄ‡ przydatne, chociaÅ¼ mogÄ… wymagaÄ‡ dostosowania do najnowszych wersji iTunes/Finder. NarzÄ™dzie [**iOSbackup**](https://pypi.org/project/iOSbackup/) to kolejna opcja pozwalajÄ…ca uzyskaÄ‡ dostÄ™p do plikÃ³w w zabezpieczonych hasÅ‚em kopii zapasowych.

### Modyfikowanie zachowania aplikacji

PrzykÅ‚ad zmiany zachowania aplikacji poprzez modyfikacje kopii zapasowej jest pokazany w aplikacji portfela bitcoin Bither ([Bither bitcoin wallet app](https://github.com/bither/bither-ios)), gdzie PIN blokady interfejsu uÅ¼ytkownika jest przechowywany w `net.bither.plist` pod kluczem **pin\_code**. UsuniÄ™cie tego klucza z pliku plist i przywrÃ³cenie kopii zapasowej usuwa wymaganie PIN, zapewniajÄ…c niograniczony dostÄ™p.

## Podsumowanie dotyczÄ…ce testowania pamiÄ™ci wraÅ¼liwych danych

Podczas pracy z wraÅ¼liwymi informacjami przechowywanymi w pamiÄ™ci aplikacji, kluczowe jest ograniczenie czasu ekspozycji tych danych. IstniejÄ… dwie podstawowe metody badania zawartoÅ›ci pamiÄ™ci: **tworzenie zrzutu pamiÄ™ci** i **analiza pamiÄ™ci w czasie rzeczywistym**. Obie metody majÄ… swoje wyzwania, w tym potencjalnÄ… moÅ¼liwoÅ›Ä‡ pominiÄ™cia istotnych danych podczas procesu zrzucania lub analizy.

## **Pobieranie i Analiza Zrzutu PamiÄ™ci**

Dla urzÄ…dzeÅ„ zarÃ³wno z jailbreakiem, jak i bez, narzÄ™dzia takie jak [objection](https://github.com/sensepost/objection) i [Fridump](https://github.com/Nightbringer21/fridump) pozwalajÄ… na zrzucanie pamiÄ™ci procesu aplikacji. Po zrzuceniu, analiza tych danych wymaga rÃ³Å¼nych narzÄ™dzi, w zaleÅ¼noÅ›ci od charakteru poszukiwanych informacji.

Aby wydobyÄ‡ ciÄ…gi znakÃ³w z zrzutu pamiÄ™ci, moÅ¼na uÅ¼yÄ‡ poleceÅ„ takich jak `strings` lub `rabin2 -zz`:
```bash
# Extracting strings using strings command
$ strings memory > strings.txt

# Extracting strings using rabin2
$ rabin2 -ZZ memory > strings.txt
```
Dla bardziej szczegÃ³Å‚owej analizy, w tym wyszukiwania konkretnych typÃ³w danych lub wzorcÃ³w, **radare2** oferuje rozlegÅ‚e moÅ¼liwoÅ›ci wyszukiwania:
```bash
$ r2 <name_of_your_dump_file>
[0x00000000]> /?
...
```
## **Analiza pamiÄ™ci w czasie rzeczywistym**

**r2frida** zapewnia potÄ™Å¼nÄ… alternatywÄ™ do inspekcji pamiÄ™ci aplikacji w czasie rzeczywistym, bez koniecznoÅ›ci tworzenia zrzutu pamiÄ™ci. To narzÄ™dzie umoÅ¼liwia wykonywanie poleceÅ„ wyszukiwania bezpoÅ›rednio w pamiÄ™ci dziaÅ‚ajÄ…cej aplikacji:
```bash
$ r2 frida://usb//<name_of_your_app>
[0x00000000]> /\ <search_command>
```
## Uszkodzona kryptografia

### SÅ‚abe procesy zarzÄ…dzania kluczami

NiektÃ³rzy programiÅ›ci zapisujÄ… wraÅ¼liwe dane w lokalnym magazynie i szyfrujÄ… je kluczem zapisanym/wykonalnym w kodzie. Nie powinno siÄ™ tego robiÄ‡, poniewaÅ¼ odwrÃ³cenie procesu moÅ¼e umoÅ¼liwiÄ‡ atakujÄ…cym wydobycie poufnych informacji.

### UÅ¼ycie niebezpiecznych i/lub przestarzaÅ‚ych algorytmÃ³w

ProgramiÅ›ci nie powinni uÅ¼ywaÄ‡ **przestarzaÅ‚ych algorytmÃ³w** do przeprowadzania **sprawdzeÅ„** autoryzacji, **przechowywania** lub **wysyÅ‚ania** danych. NiektÃ³re z tych algorytmÃ³w to: RC4, MD4, MD5, SHA1... JeÅ›li **hashe** sÄ… uÅ¼ywane do przechowywania haseÅ‚ na przykÅ‚ad, naleÅ¼y uÅ¼ywaÄ‡ hashy odporne na ataki brutalnej siÅ‚y wraz z solÄ….

### Sprawdzenie

GÅ‚Ã³wne sprawdzenia do przeprowadzenia to znalezienie **hardcoded** haseÅ‚/tajemnic w kodzie, lub czy sÄ… one **przewidywalne**, oraz czy kod uÅ¼ywa jakiegoÅ› rodzaju **sÅ‚abych** algorytmÃ³w **kryptograficznych**.

Warto wiedzieÄ‡, Å¼e moÅ¼na **monitorowaÄ‡** niektÃ³re **biblioteki kryptograficzne** automatycznie uÅ¼ywajÄ…c **objection** z:
```swift
ios monitor crypt
```
Dla **wiÄ™cej informacji** na temat interfejsÃ³w API i bibliotek kryptograficznych iOS odwiedÅº [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06e-testing-cryptography](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06e-testing-cryptography)

## Lokalna autoryzacja

**Lokalna autoryzacja** odgrywa kluczowÄ… rolÄ™, zwÅ‚aszcza jeÅ›li chodzi o zabezpieczenie dostÄ™pu do zdalnego punktu koÅ„cowego za pomocÄ… metod kryptograficznych. IstotÄ… tutaj jest to, Å¼e bez wÅ‚aÅ›ciwej implementacji mechanizmy lokalnej autoryzacji mogÄ… zostaÄ‡ obejÅ›cia.

[**Framework autoryzacji lokalnej Apple**](https://developer.apple.com/documentation/localauthentication) oraz [**keychain**](https://developer.apple.com/library/content/documentation/Security/Conceptual/keychainServConcepts/01introduction/introduction.html) zapewniajÄ… deweloperom solidne interfejsy API do uÅ‚atwiania dialogÃ³w autoryzacyjnych uÅ¼ytkownika i bezpiecznego zarzÄ…dzania tajnymi danymi. Enklawa bezpieczeÅ„stwa zabezpiecza identyfikator odcisku palca dla Touch ID, podczas gdy Face ID opiera siÄ™ na rozpoznawaniu twarzy bez naruszania danych biometrycznych.

Aby zintegrowaÄ‡ Touch ID/Face ID, deweloperzy majÄ… do wyboru dwie opcje API:

* **`LocalAuthentication.framework`** dla autoryzacji uÅ¼ytkownika na wysokim poziomie bez dostÄ™pu do danych biometrycznych.
* **`Security.framework`** dla dostÄ™pu do usÅ‚ug schowka na niÅ¼szym poziomie, zabezpieczajÄ…c tajne dane za pomocÄ… autoryzacji biometrycznej. RÃ³Å¼ne [opakowania open-source](https://www.raywenderlich.com/147308/secure-ios-user-data-keychain-touch-id) uÅ‚atwiajÄ… dostÄ™p do schowka.

{% hint style="danger" %}
Jednak zarÃ³wno `LocalAuthentication.framework`, jak i `Security.framework` posiadajÄ… podatnoÅ›ci, poniewaÅ¼ gÅ‚Ã³wnie zwracajÄ… wartoÅ›ci logiczne bez przesyÅ‚ania danych do procesÃ³w autoryzacyjnych, co czyni je podatnymi na obejÅ›cie (patrz [Don't touch me that way, by David Lindner et al](https://www.youtube.com/watch?v=XhXIHVGCFFM)).
{% endhint %}

### Implementacja lokalnej autoryzacji

Aby poprosiÄ‡ uÅ¼ytkownikÃ³w o autoryzacjÄ™, deweloperzy powinni wykorzystaÄ‡ metodÄ™ **`evaluatePolicy`** w klasie **`LAContext`**, wybierajÄ…c spoÅ›rÃ³d:

* **`deviceOwnerAuthentication`**: Prosi o Touch ID lub kod dostÄ™pu do urzÄ…dzenia, nie powiedzie siÄ™, jeÅ›li Å¼aden z nich nie jest wÅ‚Ä…czony.
* **`deviceOwnerAuthenticationWithBiometrics`**: WyÅ‚Ä…cznie prosi o Touch ID.

PomyÅ›lna autoryzacja jest sygnalizowana przez wartoÅ›Ä‡ logicznÄ… zwrÃ³conÄ… z **`evaluatePolicy`**, co ujawnia potencjalnÄ… lukÄ™ w zabezpieczeniach.

### Lokalna autoryzacja za pomocÄ… schowka

Implementacja **lokalnej autoryzacji** w aplikacjach iOS polega na wykorzystaniu **interfejsÃ³w API schowka** do bezpiecznego przechowywania tajnych danych, takich jak tokeny autoryzacyjne. Ten proces zapewnia, Å¼e dane mogÄ… byÄ‡ dostÄ™pne tylko przez uÅ¼ytkownika, korzystajÄ…c z kodu dostÄ™pu do urzÄ…dzenia lub autoryzacji biometrycznej, takiej jak Touch ID.

Schowek oferuje moÅ¼liwoÅ›Ä‡ ustawienia elementÃ³w z atrybutem `SecAccessControl`, ktÃ³ry ogranicza dostÄ™p do elementu do momentu pomyÅ›lnej autoryzacji przez uÅ¼ytkownika za pomocÄ… Touch ID lub kodu dostÄ™pu do urzÄ…dzenia. Ta funkcja jest kluczowa dla zwiÄ™kszenia bezpieczeÅ„stwa.

PoniÅ¼ej znajdujÄ… siÄ™ przykÅ‚ady kodu w jÄ™zyku Swift i Objective-C, ktÃ³re pokazujÄ…, jak zapisaÄ‡ i odzyskaÄ‡ ciÄ…g znakÃ³w do/z schowka, wykorzystujÄ…c te funkcje zabezpieczeÅ„. PrzykÅ‚ady pokazujÄ… specyficznie, jak skonfigurowaÄ‡ kontrolÄ™ dostÄ™pu, aby wymagaÅ‚a autoryzacji Touch ID i zapewniÄ‡, Å¼e dane sÄ… dostÄ™pne tylko na urzÄ…dzeniu, na ktÃ³rym zostaÅ‚y skonfigurowane, pod warunkiem, Å¼e skonfigurowano kod dostÄ™pu do urzÄ…dzenia.

{% tabs %}
{% tab title="Swift" %}
```swift
// From https://github.com/mufambisi/owasp-mstg/blob/master/Document/0x06f-Testing-Local-Authentication.md

// 1. create AccessControl object that will represent authentication settings

var error: Unmanaged<CFError>?

guard let accessControl = SecAccessControlCreateWithFlags(kCFAllocatorDefault,
kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly,
SecAccessControlCreateFlags.biometryCurrentSet,
&error) else {
// failed to create AccessControl object

return
}

// 2. define keychain services query. Pay attention that kSecAttrAccessControl is mutually exclusive with kSecAttrAccessible attribute

var query: [String: Any] = [:]

query[kSecClass as String] = kSecClassGenericPassword
query[kSecAttrLabel as String] = "com.me.myapp.password" as CFString
query[kSecAttrAccount as String] = "OWASP Account" as CFString
query[kSecValueData as String] = "test_strong_password".data(using: .utf8)! as CFData
query[kSecAttrAccessControl as String] = accessControl

// 3. save item

let status = SecItemAdd(query as CFDictionary, nil)

if status == noErr {
// successfully saved
} else {
// error while saving
}
```
{% endtab %}

{% tab title="Objective-C" %} 
### Cel-C

W tej sekcji omÃ³wimy techniki testowania penetracyjnego dla aplikacji iOS napisanych w jÄ™zyku Objective-C. 
{% endtab %}
```objectivec
// 1. create AccessControl object that will represent authentication settings
CFErrorRef *err = nil;

SecAccessControlRef sacRef = SecAccessControlCreateWithFlags(kCFAllocatorDefault,
kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly,
kSecAccessControlUserPresence,
err);

// 2. define keychain services query. Pay attention that kSecAttrAccessControl is mutually exclusive with kSecAttrAccessible attribute
NSDictionary* query = @{
(_ _bridge id)kSecClass: (__bridge id)kSecClassGenericPassword,
(__bridge id)kSecAttrLabel: @"com.me.myapp.password",
(__bridge id)kSecAttrAccount: @"OWASP Account",
(__bridge id)kSecValueData: [@"test_strong_password" dataUsingEncoding:NSUTF8StringEncoding],
(__bridge id)kSecAttrAccessControl: (__bridge_transfer id)sacRef
};

// 3. save item
OSStatus status = SecItemAdd((__bridge CFDictionaryRef)query, nil);

if (status == noErr) {
// successfully saved
} else {
// error while saving
}
```
{% endtab %}
{% endtabs %}

Teraz moÅ¼emy poprosiÄ‡ o zapisany element z Keychain. UsÅ‚ugi Keychain przedstawiÄ… okno dialogowe uwierzytelniania uÅ¼ytkownikowi i zwrÃ³cÄ… dane lub nil, w zaleÅ¼noÅ›ci od tego, czy zostaÅ‚ podany odpowiedni odcisk palca czy nie.
```swift
// 1. define query
var query = [String: Any]()
query[kSecClass as String] = kSecClassGenericPassword
query[kSecReturnData as String] = kCFBooleanTrue
query[kSecAttrAccount as String] = "My Name" as CFString
query[kSecAttrLabel as String] = "com.me.myapp.password" as CFString
query[kSecUseOperationPrompt as String] = "Please, pass authorisation to enter this area" as CFString

// 2. get item
var queryResult: AnyObject?
let status = withUnsafeMutablePointer(to: &queryResult) {
SecItemCopyMatching(query as CFDictionary, UnsafeMutablePointer($0))
}

if status == noErr {
let password = String(data: queryResult as! Data, encoding: .utf8)!
// successfully received password
} else {
// authorization not passed
}
```
{% endtab %}

{% tab title="Objective-C" %} 
### Cel-C

W celu przeprowadzenia testÃ³w penetracyjnych aplikacji iOS, naleÅ¼y zrozumieÄ‡ podstawowe koncepcje zwiÄ…zane z jÄ™zykiem programowania Objective-C oraz sposoby, w jakie sÄ… one wykorzystywane do tworzenia aplikacji na platformÄ™ iOS.
```objectivec
// 1. define query
NSDictionary *query = @{(__bridge id)kSecClass: (__bridge id)kSecClassGenericPassword,
(__bridge id)kSecReturnData: @YES,
(__bridge id)kSecAttrAccount: @"My Name1",
(__bridge id)kSecAttrLabel: @"com.me.myapp.password",
(__bridge id)kSecUseOperationPrompt: @"Please, pass authorisation to enter this area" };

// 2. get item
CFTypeRef queryResult = NULL;
OSStatus status = SecItemCopyMatching((__bridge CFDictionaryRef)query, &queryResult);

if (status == noErr){
NSData* resultData = ( __bridge_transfer NSData* )queryResult;
NSString* password = [[NSString alloc] initWithData:resultData encoding:NSUTF8StringEncoding];
NSLog(@"%@", password);
} else {
NSLog(@"Something went wrong");
}
```
### Wykrywanie

Wykorzystanie frameworkÃ³w w aplikacji moÅ¼na rÃ³wnieÅ¼ wykryÄ‡, analizujÄ…c listÄ™ wspÃ³Å‚dzielonych bibliotek dynamicznych aplikacji. MoÅ¼na to zrobiÄ‡, korzystajÄ…c z `otool`:
```bash
$ otool -L <AppName>.app/<AppName>
```
JeÅ›li w aplikacji jest uÅ¼ywany `LocalAuthentication.framework`, wynik bÄ™dzie zawieraÅ‚ obie z poniÅ¼szych linii (pamiÄ™taj, Å¼e `LocalAuthentication.framework` korzysta z `Security.framework` pod spodem):
```bash
/System/Library/Frameworks/LocalAuthentication.framework/LocalAuthentication
/System/Library/Frameworks/Security.framework/Security
```
JeÅ›li jest uÅ¼ywany `Security.framework`, zostanie pokazany tylko drugi.

### OminiÄ™cie ramki lokalnej autoryzacji

#### **Zarzut**

Poprzez **OminiÄ™cie Biometryczne Objection**, dostÄ™pne na [tej stronie GitHub](https://github.com/sensepost/objection/wiki/Understanding-the-iOS-Biometrics-Bypass), dostÄ™pna jest technika ominiÄ™cia mechanizmu **LocalAuthentication**. IstotÄ… tego podejÅ›cia jest wykorzystanie **Frida** do manipulowania funkcjÄ… `evaluatePolicy`, zapewniajÄ…c, Å¼e zawsze zwraca ona wynik `True`, niezaleÅ¼nie od faktycznego sukcesu uwierzytelnienia. Jest to szczegÃ³lnie przydatne do obejÅ›cia wadliwych procesÃ³w uwierzytelniania biometrycznego.

Aby aktywowaÄ‡ to ominiÄ™cie, uÅ¼ywane jest nastÄ™pujÄ…ce polecenie:
```bash
...itudehacks.DVIAswiftv2.develop on (iPhone: 13.2.3) [usb] # ios ui biometrics_bypass
(agent) Registering job 3mhtws9x47q. Type: ios-biometrics-disable
...itudehacks.DVIAswiftv2.develop on (iPhone: 13.2.3) [usb] # (agent) [3mhtws9x47q] Localized Reason for auth requirement: Please authenticate yourself
(agent) [3mhtws9x47q] OS authentication response: false
(agent) [3mhtws9x47q] Marking OS response as True instead
(agent) [3mhtws9x47q] Biometrics bypass hook complete
```
To polecenie uruchamia sekwencjÄ™, w ktÃ³rej Objection rejestruje zadanie, ktÃ³re efektywnie zmienia wynik sprawdzenia `evaluatePolicy` na `True`.

#### Frida

PrzykÅ‚ad uÅ¼ycia **`evaluatePolicy`** z aplikacji [DVIA-v2](https://github.com/prateek147/DVIA-v2):
```swift
+(void)authenticateWithTouchID {
LAContext *myContext = [[LAContext alloc] init];
NSError *authError = nil;
NSString *myLocalizedReasonString = @"Please authenticate yourself";

if ([myContext canEvaluatePolicy:LAPolicyDeviceOwnerAuthenticationWithBiometrics error:&authError]) {
[myContext evaluatePolicy:LAPolicyDeviceOwnerAuthenticationWithBiometrics
localizedReason:myLocalizedReasonString
reply:^(BOOL success, NSError *error) {
if (success) {
dispatch_async(dispatch_get_main_queue(), ^{
[TouchIDAuthentication showAlert:@"Authentication Successful" withTitle:@"Success"];
});
} else {
dispatch_async(dispatch_get_main_queue(), ^{
[TouchIDAuthentication showAlert:@"Authentication Failed !" withTitle:@"Error"];
});
}
}];
} else {
dispatch_async(dispatch_get_main_queue(), ^{
[TouchIDAuthentication showAlert:@"Your device doesn't support Touch ID or you haven't configured Touch ID authentication on your device" withTitle:@"Error"];
});
}
}
```
Aby osiÄ…gnÄ…Ä‡ **ominiÄ™cie** Lokalnej Autentykacji, napisany jest skrypt Fridy. Skrypt ten jest ukierunkowany na sprawdzenie **evaluatePolicy**, przechwytujÄ…c jego wywoÅ‚anie zwrotne, aby upewniÄ‡ siÄ™, Å¼e zwraca **success=1**. ZmieniajÄ…c zachowanie wywoÅ‚ania zwrotnego, sprawdzenie autoryzacji jest efektywnie omijane.

PoniÅ¼szy skrypt jest wstrzykiwany, aby zmodyfikowaÄ‡ wynik metody **evaluatePolicy**. Zmienia on wynik wywoÅ‚ania zwrotnego, aby zawsze wskazywaÅ‚ sukces.
```swift
// from https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/
if(ObjC.available) {
console.log("Injecting...");
var hook = ObjC.classes.LAContext["- evaluatePolicy:localizedReason:reply:"];
Interceptor.attach(hook.implementation, {
onEnter: function(args) {
var block = new ObjC.Block(args[4]);
const callback = block.implementation;
block.implementation = function (error, value)  {

console.log("Changing the result value to true")
const result = callback(1, null);
return result;
};
},
});
} else {
console.log("Objective-C Runtime is not available!");
}
```
Aby wstrzyknÄ…Ä‡ skrypt Frida i ominÄ…Ä‡ uwierzytelnianie biometryczne, uÅ¼ywane jest poniÅ¼sze polecenie:
```bash
frida -U -f com.highaltitudehacks.DVIAswiftv2 --no-pause -l fingerprint-bypass-ios.js
```
## Ujawnienie WraÅ¼liwej FunkcjonalnoÅ›ci Poprzez IPC

### WÅ‚asne ObsÅ‚ugiwane URI / Linki GÅ‚Ä™bokie / WÅ‚asne Schematy

{% content-ref url="ios-custom-uri-handlers-deeplinks-custom-schemes.md" %}
[ios-custom-uri-handlers-deeplinks-custom-schemes.md](ios-custom-uri-handlers-deeplinks-custom-schemes.md)
{% endcontent-ref %}

### Uniwersalne Linki

{% content-ref url="ios-universal-links.md" %}
[ios-universal-links.md](ios-universal-links.md)
{% endcontent-ref %}

### UdostÄ™pnianie UIActivity

{% content-ref url="ios-uiactivity-sharing.md" %}
[ios-uiactivity-sharing.md](ios-uiactivity-sharing.md)
{% endcontent-ref %}

### UIPasteboard

{% content-ref url="ios-uipasteboard.md" %}
[ios-uipasteboard.md](ios-uipasteboard.md)
{% endcontent-ref %}

### Rozszerzenia Aplikacji

{% content-ref url="ios-app-extensions.md" %}
[ios-app-extensions.md](ios-app-extensions.md)
{% endcontent-ref %}

### WebViews

{% content-ref url="ios-webviews.md" %}
[ios-webviews.md](ios-webviews.md)
{% endcontent-ref %}

### Serializacja i Kodowanie

{% content-ref url="ios-serialisation-and-encoding.md" %}
[ios-serialisation-and-encoding.md](ios-serialisation-and-encoding.md)
{% endcontent-ref %}

## Komunikacja Sieciowa

WaÅ¼ne jest sprawdzenie, czy nie wystÄ™puje **komunikacja bez szyfrowania** oraz czy aplikacja poprawnie **sprawdza certyfikat TLS** serwera.\
Aby sprawdziÄ‡ tego rodzaju problemy, moÅ¼na uÅ¼yÄ‡ proxy takie jak **Burp**:

{% content-ref url="burp-configuration-for-ios.md" %}
[burp-configuration-for-ios.md](burp-configuration-for-ios.md)
{% endcontent-ref %}

### Sprawdzanie Nazwy Hosta

Jednym z powszechnych problemÃ³w podczas weryfikacji certyfikatu TLS jest sprawdzenie, czy certyfikat zostaÅ‚ podpisany przez **zaufanÄ… instytucjÄ™ certyfikujÄ…cÄ…**, ale **nie sprawdzenie**, czy **nazwa hosta** certyfikatu jest nazwÄ… hosta, do ktÃ³rej uzyskano dostÄ™p.\
Aby sprawdziÄ‡ ten problem za pomocÄ… Burp, po zaufaniu CA Burp na iPhonie, moÅ¼na **utworzyÄ‡ nowy certyfikat z Burp dla innej nazwy hosta** i go uÅ¼yÄ‡. JeÅ›li aplikacja nadal dziaÅ‚a, to oznacza, Å¼e jest podatna na atak.

### Pinowanie Certyfikatu

JeÅ›li aplikacja poprawnie uÅ¼ywa Pinowania SSL, to aplikacja bÄ™dzie dziaÅ‚aÄ‡ tylko wtedy, gdy certyfikat bÄ™dzie oczekiwanym certyfikatem. Podczas testowania aplikacji **moÅ¼e to byÄ‡ problemem, poniewaÅ¼ Burp bÄ™dzie serwowaÅ‚ swÃ³j wÅ‚asny certyfikat.**\
Aby ominÄ…Ä‡ tÄ™ ochronÄ™ w urzÄ…dzeniu z jailbreakiem, moÅ¼na zainstalowaÄ‡ aplikacjÄ™ [**SSL Kill Switch**](https://github.com/nabla-c0d3/ssl-kill-switch2) lub zainstalowaÄ‡ [**Burp Mobile Assistant**](https://portswigger.net/burp/documentation/desktop/mobile/config-ios-device)

MoÅ¼na rÃ³wnieÅ¼ uÅ¼yÄ‡ `ios sslpinning disable` z **objection's**

## RÃ³Å¼ne

* W **`/System/Library`** znajdujÄ… siÄ™ frameworki zainstalowane w telefonie, uÅ¼ywane przez aplikacje systemowe
* Aplikacje zainstalowane przez uÅ¼ytkownika ze Sklepu App Store znajdujÄ… siÄ™ w **`/User/Applications`**
* Natomiast **`/User/Library`** zawiera dane zapisane przez aplikacje na poziomie uÅ¼ytkownika
* MoÅ¼na uzyskaÄ‡ dostÄ™p do **`/User/Library/Notes/notes.sqlite`** w celu odczytania zapisanych notatek wewnÄ…trz aplikacji.
* WewnÄ…trz folderu z zainstalowanÄ… aplikacjÄ… (**`/User/Applications/<ID APLIKACJI>/`**) moÅ¼na znaleÅºÄ‡ kilka interesujÄ…cych plikÃ³w:
* **`iTunesArtwork`**: Ikona uÅ¼ywana przez aplikacjÄ™
* **`iTunesMetadata.plist`**: Informacje o aplikacji uÅ¼ywane w Sklepie App Store
* **`/Library/*`**: Zawiera preferencje i pamiÄ™Ä‡ podrÄ™cznÄ…. W **`/Library/Cache/Snapshots/*`** moÅ¼na znaleÅºÄ‡ zrzut wykonany z aplikacji przed wysÅ‚aniem jej do tÅ‚a.

### GorÄ…ce Poprawki/Aktualizacje Wymuszone

Deweloperzy mogÄ… zdalnie **poprawiÄ‡ wszystkie instalacje swojej aplikacji natychmiast**, bez koniecznoÅ›ci ponownego przesÅ‚ania aplikacji do Sklepu App Store i oczekiwania na zatwierdzenie.\
W tym celu zazwyczaj uÅ¼ywa siÄ™ [**JSPatch**](https://github.com/bang590/JSPatch)**.** IstniejÄ… rÃ³wnieÅ¼ inne opcje, takie jak [Siren](https://github.com/ArtSabintsev/Siren) i [react-native-appstore-version-checker](https://www.npmjs.com/package/react-native-appstore-version-checker).\
**To jest mechanizm ryzykowny, ktÃ³ry moÅ¼e byÄ‡ naduÅ¼yty przez zÅ‚oÅ›liwe zewnÄ™trzne SDK, dlatego zaleca siÄ™ sprawdzenie, jakie metody sÄ… uÅ¼ywane do automatycznej aktualizacji (jeÅ›li takie istniejÄ…) i przetestowanie ich.** MoÅ¼na sprÃ³bowaÄ‡ pobraÄ‡ poprzedniÄ… wersjÄ™ aplikacji w tym celu.

### ZewnÄ™trzne UsÅ‚ugi

ZnaczÄ…cym wyzwaniem zwiÄ…zanym z **SDK firm trzecich** jest **brak precyzyjnej kontroli** nad ich funkcjonalnoÅ›ciami. Deweloperzy stojÄ… przed wyborem: zintegrowaÄ‡ SDK i zaakceptowaÄ‡ wszystkie jego funkcje, w tym potencjalne podatnoÅ›ci na ryzyko bezpieczeÅ„stwa i obawy o prywatnoÅ›Ä‡, lub caÅ‚kowicie zrezygnowaÄ‡ z jego korzyÅ›ci. CzÄ™sto deweloperzy nie sÄ… w stanie Å‚ataÄ‡ podatnoÅ›ci w tych SDK samodzielnie. Ponadto, gdy SDK zyskujÄ… zaufanie w spoÅ‚ecznoÅ›ci, niektÃ³re z nich mogÄ… zaczÄ…Ä‡ zawieraÄ‡ zÅ‚oÅ›liwe oprogramowanie.

UsÅ‚ugi Å›wiadczone przez SDK firm trzecich mogÄ… obejmowaÄ‡ Å›ledzenie zachowaÅ„ uÅ¼ytkownikÃ³w, wyÅ›wietlanie reklam lub ulepszenia w doÅ›wiadczeniu uÅ¼ytkownika. JednakÅ¼e wprowadza to ryzyko, poniewaÅ¼ deweloperzy mogÄ… nie byÄ‡ w peÅ‚ni Å›wiadomi kodu wykonywanego przez te biblioteki, co prowadzi do potencjalnych zagroÅ¼eÅ„ dla prywatnoÅ›ci i bezpieczeÅ„stwa. WaÅ¼ne jest ograniczenie udostÄ™pnianych zewnÄ™trznym usÅ‚ugom informacji do niezbÄ™dnych oraz zapewnienie, Å¼e Å¼adne wraÅ¼liwe dane nie sÄ… ujawniane.

Implementacja usÅ‚ug firm trzecich zazwyczaj przyjmuje dwie formy: samodzielnej biblioteki lub peÅ‚nego SDK. Aby chroniÄ‡ prywatnoÅ›Ä‡ uÅ¼ytkownika, wszelkie dane udostÄ™pniane tym usÅ‚ugom powinny byÄ‡ **anonimizowane**, aby zapobiec ujawnieniu Osobistych Informacji IdentyfikujÄ…cych (PII).

Aby zidentyfikowaÄ‡ biblioteki uÅ¼ywane przez aplikacjÄ™, moÅ¼na skorzystaÄ‡ z polecenia **`otool`**. NarzÄ™dzie to powinno byÄ‡ uruchomione przeciwko aplikacji i kaÅ¼dej uÅ¼ywanej bibliotece, aby odkryÄ‡ dodatkowe biblioteki.
```bash
otool -L <application_path>
```
## **OdnoÅ›niki i WiÄ™cej ZasobÃ³w**

* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06b-basic-security-testing#information-gathering](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06b-basic-security-testing#information-gathering)
* [iOS & Mobile App Pentesting - INE](https://my.ine.com/CyberSecurity/courses/089d060b/ios-mobile-app-pentesting)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0057/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0057/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0058/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0058/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0059/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0059/)
* [https://mas.owasp.org/MASTG/iOS/0x06d-Testing-Data-Storage](https://mas.owasp.org/MASTG/iOS/0x06d-Testing-Data-Storage)
* [https://coderwall.com/p/kjb3lw/storing-password-in-keychain-the-smart-way](https://coderwall.com/p/kjb3lw/storing-password-in-keychain-the-smart-way)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-STORAGE/MASTG-TEST-0055/](https://mas.owasp.org/MASTG/tests/ios/MASVS-STORAGE/MASTG-TEST-0055/)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-STORAGE/MASTG-TEST-0053](https://mas.owasp.org/MASTG/tests/ios/MASVS-STORAGE/MASTG-TEST-0053)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0060/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0060/)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-STORAGE/MASTG-TEST-0058](https://mas.owasp.org/MASTG/tests/ios/MASVS-STORAGE/MASTG-TEST-0058)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-STORAGE/MASTG-TEST-0060](https://mas.owasp.org/MASTG/tests/ios/MASVS-STORAGE/MASTG-TEST-0060)
* [https://mas.owasp.org/MASTG/Android/0x05f-Testing-Local-Authentication/](https://mas.owasp.org/MASTG/Android/0x05f-Testing-Local-Authentication/)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-AUTH/MASTG-TEST-0064](https://mas.owasp.org/MASTG/tests/ios/MASVS-AUTH/MASTG-TEST-0064)
* [https://medium.com/securing/bypassing-your-apps-biometric-checks-on-ios-c2555c81a2dc](https://medium.com/securing/bypassing-your-apps-biometric-checks-on-ios-c2555c81a2dc)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-STORAGE/MASTG-TEST-0054](https://mas.owasp.org/MASTG/tests/ios/MASVS-STORAGE/MASTG-TEST-0054)
* [https://github.com/ivRodriguezCA/RE-iOS-Apps/](https://github.com/ivRodriguezCA/RE-iOS-Apps/) Kurs iOS za darmo ([https://syrion.me/blog/ios-swift-antijailbreak-bypass-frida/](https://syrion.me/blog/ios-swift-antijailbreak-bypass-frida/))
* [https://www.sans.org/reading-room/whitepapers/testing/ipwn-apps-pentesting-ios-applications-34577](https://www.sans.org/reading-room/whitepapers/testing/ipwn-apps-pentesting-ios-applications-34577)
* [https://www.slideshare.net/RyanISI/ios-appsecurityminicourse](https://www.slideshare.net/RyanISI/ios-appsecurityminicourse)
* [https://github.com/prateek147/DVIA](https://github.com/prateek147/DVIA)
* [https://github.com/prateek147/DVIA-v2](https://github.com/prateek147/DVIA-v2)
* [https://github.com/OWASP/MSTG-Hacking-Playground%20](https://github.com/OWASP/MSTG-Hacking-Playground)
* OWASP iGoat [_https://github.com/OWASP/igoat_](https://github.com/OWASP/igoat) <<< Wersja Objective-C [_https://github.com/OWASP/iGoat-Swift_](https://github.com/OWASP/iGoat-Swift) <<< Wersja Swift
* [https://github.com/authenticationfailure/WheresMyBrowser.iOS](https://github.com/authenticationfailure/WheresMyBrowser.iOS)
* [https://github.com/nabla-c0d3/ssl-kill-switch2](https://github.com/nabla-c0d3/ssl-kill-switch2)

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby Å‚atwo tworzyÄ‡ i **automatyzowaÄ‡ zadania** przy uÅ¼yciu najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ci.\
Otrzymaj DostÄ™p DziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na githubie.

</details>
