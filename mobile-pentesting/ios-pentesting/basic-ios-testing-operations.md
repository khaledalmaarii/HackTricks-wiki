# iOS Osnovne Operacije Testiranja

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Obuka AWS Red Team Ekspert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Obuka GCP Red Team Ekspert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## **SaÅ¾etak Identifikacije i Pristupa iOS UreÄ‘aju**

### **Identifikacija UDID-a iOS UreÄ‘aja**

Da bi se jedinstveno identifikovao iOS ureÄ‘aj, koristi se 40-cifreni niz poznat kao UDID. Na macOS Catalina ili novijim verzijama, ovo se moÅ¾e pronaÄ‡i u **Finder aplikaciji**, poÅ¡to iTunes viÅ¡e nije prisutan. UreÄ‘aj, kada je povezan putem USB-a i odabran u Finder-u, otkriva svoj UDID meÄ‘u ostalim informacijama kada se klikne na detalje ispod njegovog imena.

Za verzije macOS-a pre Cataline, iTunes olakÅ¡ava otkrivanje UDID-a. Detaljna uputstva moÅ¾ete pronaÄ‡i [ovde](http://www.iclarified.com/52179/how-to-find-your-iphones-udid).

Alati komandne linije nude alternativne metode za preuzimanje UDID-a:

* **KoriÅ¡Ä‡enje I/O Registry Explorer alata `ioreg`:**
```bash
$ ioreg -p IOUSB -l | grep "USB Serial"
```
* **KoriÅ¡Ä‡enje `ideviceinstaller` za macOS (i Linux):**
```bash
$ brew install ideviceinstaller
$ idevice_id -l
```
* **KoriÅ¡Ä‡enje `system_profiler`:**
```bash
$ system_profiler SPUSBDataType | sed -n -e '/iPad/,/Serial/p;/iPhone/,/Serial/p;/iPod/,/Serial/p' | grep "Serial Number:"
```
* **KoriÅ¡Ä‡enje `instruments` za listanje ureÄ‘aja:**
```bash
$ instruments -s devices
```
### **Pristupanje Shell-u UreÄ‘aja**

**SSH pristup** se omoguÄ‡ava instalacijom **OpenSSH paketa** nakon jailbreak-a, Å¡to omoguÄ‡ava veze putem `ssh root@<device_ip_address>`. KljuÄno je promeniti podrazumevane lozinke (`alpine`) za korisnike `root` i `mobile` kako bi se osigurao ureÄ‘aj.

**SSH preko USB-a** postaje neophodan u odsustvu Wi-Fi-a, koristeÄ‡i `iproxy` za mapiranje portova ureÄ‘aja za SSH veze. Ova konfiguracija omoguÄ‡ava SSH pristup putem USB-a pokretanjem:
```bash
$ iproxy 2222 22
$ ssh -p 2222 root@localhost
```
**Aplikacije za shell na ureÄ‘aju**, poput NewTerm 2, olakÅ¡avaju direktnu interakciju sa ureÄ‘ajem, Å¡to je posebno korisno za reÅ¡avanje problema. **Reverse SSH shell-ovi** se takoÄ‘e mogu uspostaviti za daljinski pristup sa host raÄunara.

### **Resetovanje Zaboravljenih Lozinki**

Da biste resetovali zaboravljenu lozinku na podrazumevanu (`alpine`), potrebno je urediti datoteku `/private/etc/master.passwd`. To ukljuÄuje zamenu postojeÄ‡eg heÅ¡a sa heÅ¡em za `alpine` pored unosa korisnika `root` i `mobile`.

## **Tehnike Prenosa Podataka**

### **Prenos Datoteka Aplikacija**

**Arhiviranje i Preuzimanje putem SSH i SCP:** Jednostavno je arhivirati direktorijum podataka aplikacije koristeÄ‡i `tar` i zatim ga preneti koristeÄ‡i `scp`. Komanda ispod arhivira direktorijum podataka u .tgz datoteku, koja se zatim preuzima sa ureÄ‘aja:
```bash
tar czvf /tmp/data.tgz /private/var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693
exit
scp -P 2222 root@localhost:/tmp/data.tgz .
```
### **Graphical User Interface Tools**

**Using iFunbox and iExplorer:** Ovi GUI alati su korisni za upravljanje datotekama na iOS ureÄ‘ajima. MeÄ‘utim, poÄevÅ¡i od iOS 8.4, Apple je ograniÄio pristup ovim alatima aplikacionom sandbox-u osim ako ureÄ‘aj nije jailbreak-ovan.

### **Using Objection for File Management**

**Interactive Shell with Objection:** Pokretanje objection-a omoguÄ‡ava pristup Bundle direktorijumu aplikacije. Odatle moÅ¾ete navigirati do direktorijuma Documents aplikacije i upravljati datotekama, ukljuÄujuÄ‡i preuzimanje i otpremanje njih na i sa iOS ureÄ‘aja.
```bash
objection --gadget com.apple.mobilesafari explorer
cd /var/mobile/Containers/Data/Application/72C7AAFB-1D75-4FBA-9D83-D8B4A2D44133/Documents
file download <filename>
```
## **Dobijanje i Ekstrakcija Aplikacija**

### **Sticanje IPA Fajla**

**Over-The-Air (OTA) Distribucioni Link:** Aplikacije distribuirane za testiranje putem OTA mogu se preuzeti koristeÄ‡i ITMS usluge alat za preuzimanje sredstava, koji se instalira putem npm i koristi za Äuvanje IPA fajla lokalno.
```bash
npm install -g itms-services
itms-services -u "itms-services://?action=download-manifest&url=https://s3-ap-southeast-1.amazonaws.com/test-uat/manifest.plist" -o - > out.ipa
```
### **Ekstrakcija binarnog fajla aplikacije**

1. **Iz IPA:** Raspakujte IPA da biste pristupili dekriptovanom binarnom fajlu aplikacije.
2. **Sa Jailbroken ureÄ‘aja:** Instalirajte aplikaciju i ekstraktujte dekriptovani binarni fajl iz memorije.

### **Proces dekripcije**

**Pregled ruÄne dekripcije:** iOS binarni fajlovi aplikacija su enkriptovani od strane Apple-a koristeÄ‡i FairPlay. Da bi se izvrÅ¡ila obrnuta inÅ¾enjering, potrebno je dumpovati dekriptovani binarni fajl iz memorije. Proces dekripcije ukljuÄuje proveru PIE zastavice, prilagoÄ‘avanje memorijskih zastavica, identifikaciju enkriptovanog dela, a zatim dumpovanje i zamenu ovog dela sa njegovom dekriptovanom verzijom.

**Proveravanje i modifikovanje PIE zastavice:**
```bash
otool -Vh Original_App
python change_macho_flags.py --no-pie Original_App
otool -Vh Hello_World
```
**Identifying Encrypted Section and Dumping Memory:**

Odredite poÄetne i zavrÅ¡ne adrese enkriptovane sekcije koristeÄ‡i `otool` i ispraznite memoriju sa jailbroken ureÄ‘aja koristeÄ‡i gdb.
```bash
otool -l Original_App | grep -A 4 LC_ENCRYPTION_INFO
dump memory dump.bin 0x8000 0x10a4000
```
**Prepisivanje Enkriptovanog Odeljka:**

Zamenite enkriptovani odeljak u originalnom binarnom fajlu aplikacije sa dekriptovanim dump-om.
```bash
dd bs=1 seek=<starting_address> conv=notrunc if=dump.bin of=Original_App
```
**Finalizacija dekripcije:** Izmenite metapodatke binarnog fajla da oznaÄite odsustvo enkripcije koristeÄ‡i alate kao Å¡to je **MachOView**, postavljajuÄ‡i `cryptid` na 0.

### **Dekripcija (Automatski)**

#### **frida-ios-dump**
Alat [**frida-ios-dump**](https://github.com/AloneMonkey/frida-ios-dump) se koristi za **automatsko dekriptovanje i ekstrakciju aplikacija** sa iOS ureÄ‘aja. Prvo, potrebno je konfigurisati `dump.py` da se poveÅ¾e sa iOS ureÄ‘ajem, Å¡to se moÅ¾e uraditi preko localhost-a na portu 2222 putem **iproxy** ili direktno putem IP adrese ureÄ‘aja i porta.

Aplikacije instalirane na ureÄ‘aju mogu se nabrojati komandom:
```bash
$ python dump.py -l
```
Da biste dumpovali odreÄ‘enu aplikaciju, kao Å¡to je Telegram, koristi se sledeÄ‡a komanda:
```bash
$ python3 dump.py -u "root" -p "<PASSWORD>" ph.telegra.Telegraph
```
Ova komanda pokreÄ‡e dump aplikacije, Å¡to rezultira kreiranjem `Telegram.ipa` fajla u trenutnom direktorijumu. Ovaj proces je pogodan za jailbroken ureÄ‘aje, jer se nesigned ili laÅ¾no potpisane aplikacije mogu ponovo instalirati koristeÄ‡i alate kao Å¡to je [**ios-deploy**](https://github.com/ios-control/ios-deploy).

#### **flexdecrypt**
Alat [**flexdecrypt**](https://github.com/JohnCoates/flexdecrypt), zajedno sa svojim wrapper-om [**flexdump**](https://gist.github.com/defparam/71d67ee738341559c35c684d659d40ac), omoguÄ‡ava ekstrakciju IPA fajlova iz instaliranih aplikacija. Komande za instalaciju **flexdecrypt** na ureÄ‘aju ukljuÄuju preuzimanje i instalaciju `.deb` paketa. **flexdump** se moÅ¾e koristiti za listanje i dump aplikacija, kao Å¡to je prikazano u komandama ispod:
```bash
apt install zip unzip
wget https://gist.githubusercontent.com/defparam/71d67ee738341559c35c684d659d40ac/raw/30c7612262f1faf7871ba8e32fbe29c0f3ef9e27/flexdump -P /usr/local/bin; chmod +x /usr/local/bin/flexdump
flexdump list
flexdump dump Twitter.app
```
#### **bagbak**
[**bagbak**](https://github.com/ChiChou/bagbak), joÅ¡ jedan alat zasnovan na Fridi, zahteva jailbreak-ovan ureÄ‘aj za dekripciju aplikacija:
```bash
bagbak --raw Chrome
```
#### **r2flutch**
**r2flutch**, koristeÄ‡i radare i frida, sluÅ¾i za dekripciju i dumpovanje aplikacija. ViÅ¡e informacija moÅ¾ete pronaÄ‡i na njegovoj [**GitHub stranici**](https://github.com/as0ler/r2flutch).

### **Instalacija Aplikacija**

**Sideloading** se odnosi na instalaciju aplikacija van zvaniÄne App Store. Ovaj proces upravlja **installd daemon** i zahteva da aplikacije budu potpisane Apple-ovim sertifikatom. Jailbroken ureÄ‘aji mogu to zaobiÄ‡i putem **AppSync**, omoguÄ‡avajuÄ‡i instalaciju laÅ¾no potpisanih IPA paketa.

#### **Alati za Sideloading**

- **Cydia Impactor**: Alat za potpisivanje i instalaciju IPA datoteka na iOS-u i APK datoteka na Androidu. VodiÄi i reÅ¡enja za probleme mogu se pronaÄ‡i na [yalujailbreak.net](https://yalujailbreak.net/how-to-use-cydia-impactor/).

- **libimobiledevice**: Biblioteka za Linux i macOS za komunikaciju sa iOS ureÄ‘ajima. Komande za instalaciju i primeri koriÅ¡Ä‡enja za ideviceinstaller su obezbeÄ‘eni za instalaciju aplikacija preko USB-a.

- **ipainstaller**: Ovaj alat za komandnu liniju omoguÄ‡ava direktnu instalaciju aplikacija na iOS ureÄ‘ajima.

- **ios-deploy**: Za korisnike macOS-a, ios-deploy instalira iOS aplikacije iz komandne linije. DeÅ¡ifrovanje IPA i koriÅ¡Ä‡enje `-m` oznake za direktno pokretanje aplikacije su deo procesa.

- **Xcode**: Koristite Xcode za instalaciju aplikacija navigirajuÄ‡i do **Window/Devices and Simulators** i dodajuÄ‡i aplikaciju u **Installed Apps**.

#### **Dozvolite Instalaciju Aplikacija na Ne-iPad UreÄ‘ajima**
Da biste instalirali aplikacije specifiÄne za iPad na iPhone ili iPod touch ureÄ‘aje, potrebno je promeniti **UIDeviceFamily** vrednost u **Info.plist** datoteci na **1**. Ova modifikacija, meÄ‘utim, zahteva ponovo potpisivanje IPA datoteke zbog provere validacije potpisa.

**Napomena**: Ova metoda moÅ¾e propasti ako aplikacija zahteva moguÄ‡nosti koje su ekskluzivne za novije modele iPad-a dok se koristi stariji iPhone ili iPod touch.

## Reference
* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](ttps://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0052/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0052/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0053/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0053/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0054/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0054/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0056/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0056/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
