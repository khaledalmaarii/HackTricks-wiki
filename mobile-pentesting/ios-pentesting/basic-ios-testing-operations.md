# Podstawowe operacje testowania iOS

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## **Podsumowanie identyfikacji i dostpu do urzdze iOS**

### **Identyfikacja UDID urzdzenia iOS**

Aby jednoznacznie zidentyfikowa urzdzenie iOS, u偶ywany jest 40-znakowy cig znak贸w znany jako UDID. W systemie macOS Catalina lub nowszym mo偶na go znale藕 w aplikacji **Finder**, poniewa偶 iTunes ju偶 nie istnieje. Po podczeniu urzdzenia za pomoc USB i wybraniu go w Finderze, UDID zostaje ujawniony wraz z innymi informacjami po klikniciu szczeg贸贸w pod jego nazw.

Wersje macOS wczeniejsze ni偶 Catalina umo偶liwiaj odkrycie UDID za pomoc iTunes. Szczeg贸owe instrukcje mo偶na znale藕 [tutaj](http://www.iclarified.com/52179/how-to-find-your-iphones-udid).

Narzdzia wiersza polece oferuj alternatywne metody pobierania UDID:

* **Za pomoc narzdzia I/O Registry Explorer `ioreg`:**
```bash
$ ioreg -p IOUSB -l | grep "USB Serial"
```
* **U偶ywanie `ideviceinstaller` dla macOS (i Linux):**
```bash
$ brew install ideviceinstaller
$ idevice_id -l
```
* **Wykorzystanie `system_profiler`:**
```bash
$ system_profiler SPUSBDataType | sed -n -e '/iPad/,/Serial/p;/iPhone/,/Serial/p;/iPod/,/Serial/p' | grep "Serial Number:"
```
* **Wykorzystanie narzdzia `instruments` do wywietlania listy urzdze:**
```bash
$ instruments -s devices
```
### **Dostp do powoki urzdzenia**

Dostp **SSH** jest wczony poprzez zainstalowanie pakietu **OpenSSH** po jailbreaku, umo偶liwiajc poczenia za pomoc `ssh root@<adres_ip_urzdzenia>`. Wa偶ne jest zmienienie domylnych hase (`alpine`) dla u偶ytkownik贸w `root` i `mobile`, aby zabezpieczy urzdzenie.

**SSH przez USB** staje si konieczny w przypadku braku Wi-Fi, korzystajc z `iproxy` do mapowania port贸w urzdzenia dla pocze SSH. Ta konfiguracja umo偶liwia dostp SSH przez USB, uruchamiajc:
```bash
$ iproxy 2222 22
$ ssh -p 2222 root@localhost
```
**Aplikacje powoki na urzdzeniu**, takie jak NewTerm 2, uatwiaj bezporedni interakcj z urzdzeniem, szczeg贸lnie przydatne do rozwizywania problem贸w. **Odwr贸cone powoki SSH** mog r贸wnie偶 by ustanawiane w celu zdalnego dostpu z komputera hosta.

### **Resetowanie zapomnianych hase**

Aby zresetowa zapomniane haso z powrotem do domylnego (`alpine`), konieczne jest edytowanie pliku `/private/etc/master.passwd`. Polega to na zastpieniu istniejcego skr贸tu skr贸tem dla `alpine` obok wpis贸w u偶ytkownik贸w `root` i `mobile`.

## **Techniki transferu danych**

### **Transferowanie plik贸w danych aplikacji**

**Archiwizacja i pobieranie za pomoc SSH i SCP:** Proste jest zarchiwizowanie katalogu Data aplikacji za pomoc `tar`, a nastpnie przesanie go za pomoc `scp`. Poni偶sze polecenie archiwizuje katalog Data do pliku .tgz, kt贸ry nastpnie jest pobierany z urzdzenia:
```bash
tar czvf /tmp/data.tgz /private/var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693
exit
scp -P 2222 root@localhost:/tmp/data.tgz .
```
### **Narzdzia z graficznym interfejsem u偶ytkownika**

**Korzystanie z iFunbox i iExplorer:** Te narzdzia z graficznym interfejsem u偶ytkownika s przydatne do zarzdzania plikami na urzdzeniach iOS. Jednak poczwszy od wersji iOS 8.4, Apple ograniczyo dostp tych narzdzi do piaskownicy aplikacji, chyba 偶e urzdzenie jest jailbroken.

### **Korzystanie z Objection do zarzdzania plikami**

**Interaktywna powoka z Objection:** Uruchomienie Objection umo偶liwia dostp do katalogu Bundle aplikacji. Std mo偶na nawigowa do katalogu Documents aplikacji i zarzdza plikami, w tym pobiera je i przesya na urzdzenie iOS.
```bash
objection --gadget com.apple.mobilesafari explorer
cd /var/mobile/Containers/Data/Application/72C7AAFB-1D75-4FBA-9D83-D8B4A2D44133/Documents
file download <filename>
```
## **Pobieranie i wyodrbnianie aplikacji**

### **Pobieranie pliku IPA**

**Link dystrybucji Over-The-Air (OTA):** Aplikacje dystrybuowane do test贸w za pomoc OTA mo偶na pobra za pomoc narzdzia do pobierania zasob贸w ITMS services asset downloader, kt贸re jest zainstalowane za pomoc npm i su偶y do zapisywania pliku IPA lokalnie.
```bash
npm install -g itms-services
itms-services -u "itms-services://?action=download-manifest&url=https://s3-ap-southeast-1.amazonaws.com/test-uat/manifest.plist" -o - > out.ipa
```
### **Wyodrbnianie binarnego pliku aplikacji**

1. **Z pliku IPA:** Rozpakuj plik IPA, aby uzyska dostp do zdeszyfrowanego binarnego pliku aplikacji.
2. **Z urzdzenia z jailbreakiem:** Zainstaluj aplikacj i wyodrbnij z pamici zdeszyfrowany binarny plik.

### **Proces deszyfrowania**

**Przegld rcznego deszyfrowania:** Binarne pliki aplikacji iOS s szyfrowane przez Apple za pomoc FairPlay. Aby przeprowadzi in偶ynieri wsteczn, konieczne jest wyodrbnienie z pamici zdeszyfrowanego binarnego pliku. Proces deszyfrowania polega na sprawdzeniu flagi PIE, dostosowaniu flag pamici, zidentyfikowaniu zaszyfrowanej sekcji, a nastpnie wyodrbnieniu i zastpieniu tej sekcji jej zdeszyfrowan form.

**Sprawdzanie i modyfikowanie flagi PIE:**
```bash
otool -Vh Original_App
python change_macho_flags.py --no-pie Original_App
otool -Vh Hello_World
```
**Identyfikowanie zaszyfrowanej sekcji i wydobywanie pamici:**

Aby zidentyfikowa pocztek i koniec zaszyfrowanej sekcji, u偶yj polecenia `otool`, a nastpnie wydobyj pami z urzdzenia z jailbreakiem za pomoc gdb.
```bash
otool -l Original_App | grep -A 4 LC_ENCRYPTION_INFO
dump memory dump.bin 0x8000 0x10a4000
```
**Nadpisywanie sekcji zaszyfrowanej:**

Zastp zaszyfrowan sekcj w oryginalnym pliku binarnym aplikacji zdeszyfrowanym zrzutem.
```bash
dd bs=1 seek=<starting_address> conv=notrunc if=dump.bin of=Original_App
```
**Finalizowanie Deszyfrowania:** Zmodyfikuj metadane binarne, aby wskazyway brak szyfrowania za pomoc narzdzi takich jak **MachOView**, ustawiajc `cryptid` na 0.

### **Deszyfrowanie (Automatycznie)**

#### **frida-ios-dump**
Narzdzie [**frida-ios-dump**](https://github.com/AloneMonkey/frida-ios-dump) jest u偶ywane do **automatycznego deszyfrowania i ekstrakcji aplikacji** z urzdze iOS. Na pocztku nale偶y skonfigurowa `dump.py`, aby poczy si z urzdzeniem iOS, co mo偶na zrobi za pomoc localhost na porcie 2222 za porednictwem **iproxy** lub bezporednio za pomoc adresu IP i portu urzdzenia.

Zainstalowane aplikacje na urzdzeniu mo偶na wywietli za pomoc polecenia:
```bash
$ python dump.py -l
```
Aby wykona zrzut konkretnej aplikacji, takiej jak Telegram, u偶ywane jest poni偶sze polecenie:
```bash
$ python3 dump.py -u "root" -p "<PASSWORD>" ph.telegra.Telegraph
```
Ten polecenie inicjuje zrzut aplikacji, co skutkuje utworzeniem pliku `Telegram.ipa` w bie偶cym katalogu. Ten proces jest odpowiedni dla urzdze z jailbreakiem, poniewa偶 niesygnowane lub faszywie podpisane aplikacje mo偶na ponownie zainstalowa za pomoc narzdzi takich jak [**ios-deploy**](https://github.com/ios-control/ios-deploy).

#### **flexdecrypt**
Narzdzie [**flexdecrypt**](https://github.com/JohnCoates/flexdecrypt) wraz z jego opakowaniem [**flexdump**](https://gist.github.com/defparam/71d67ee738341559c35c684d659d40ac) umo偶liwiaj wyodrbnianie plik贸w IPA z zainstalowanych aplikacji. Polecenia instalacyjne dla **flexdecrypt** na urzdzeniu obejmuj pobranie i zainstalowanie pakietu `.deb`. **flexdump** mo偶na u偶y do wywietlania listy i zrzutu aplikacji, jak pokazano poni偶ej:
```bash
apt install zip unzip
wget https://gist.githubusercontent.com/defparam/71d67ee738341559c35c684d659d40ac/raw/30c7612262f1faf7871ba8e32fbe29c0f3ef9e27/flexdump -P /usr/local/bin; chmod +x /usr/local/bin/flexdump
flexdump list
flexdump dump Twitter.app
```
#### **bagbak**
[**bagbak**](https://github.com/ChiChou/bagbak), kolejne narzdzie oparte na Frida, wymaga zrootowanego urzdzenia do deszyfrowania aplikacji:
```bash
bagbak --raw Chrome
```
#### **r2flutch**
**r2flutch**, wykorzystujcy zar贸wno radare, jak i frida, su偶y do deszyfrowania i dumpowania aplikacji. Wicej informacji mo偶na znale藕 na [**stronie GitHub**](https://github.com/as0ler/r2flutch).

### **Instalowanie aplikacji**

**Sideloading** odnosi si do instalowania aplikacji spoza oficjalnego sklepu App Store. Proces ten jest obsugiwany przez demona **installd** i wymaga, aby aplikacje byy podpisane certyfikatem wydanym przez Apple. Zdjcia IPA podpisane faszywie mo偶na zainstalowa na urzdzeniach z jailbreakiem za pomoc **AppSync**.

#### **Narzdzia do Sideloadingu**

- **Cydia Impactor**: Narzdzie do podpisywania i instalowania plik贸w IPA na iOS oraz plik贸w APK na Androidzie. Przewodniki i rozwizywanie problem贸w mo偶na znale藕 na [yalujailbreak.net](https://yalujailbreak.net/how-to-use-cydia-impactor/).

- **libimobiledevice**: Biblioteka dla system贸w Linux i macOS do komunikacji z urzdzeniami iOS. Przedstawione s polecenia instalacji i przykady u偶ycia dla ideviceinstaller do instalowania aplikacji przez USB.

- **ipainstaller**: To narzdzie wiersza polece umo偶liwia bezporedni instalacj aplikacji na urzdzeniach iOS.

- **ios-deploy**: Dla u偶ytkownik贸w macOS, ios-deploy instaluje aplikacje iOS z wiersza polece. Rozpakowanie pliku IPA i u偶ycie flagi `-m` do bezporedniego uruchomienia aplikacji s czci procesu.

- **Xcode**: Wykorzystaj Xcode do instalowania aplikacji, przechodzc do **Window/Devices and Simulators** i dodajc aplikacj do **Installed Apps**.

#### **Zezw贸l na instalacj aplikacji na urzdzeniach innych ni偶 iPad**
Aby zainstalowa aplikacje specyficzne dla iPada na urzdzeniach iPhone lub iPod touch, warto **UIDeviceFamily** w pliku **Info.plist** musi zosta zmieniona na **1**. Ta modyfikacja jednak wymaga ponownego podpisania pliku IPA ze wzgldu na sprawdzanie poprawnoci podpisu.

**Uwaga**: Ta metoda mo偶e nie powie si, jeli aplikacja wymaga funkcji dostpnych tylko na nowszych modelach iPada, podczas korzystania z starszego iPhone'a lub iPod touch.



## References
* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](ttps://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0052/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0052/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0053/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0053/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0054/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0054/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0056/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0056/)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
