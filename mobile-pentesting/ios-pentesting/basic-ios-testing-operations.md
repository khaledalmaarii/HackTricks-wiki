# iOS Grundlegende Testoperationen

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## **Zusammenfassung der Identifizierung und des Zugriffs auf iOS-Ger√§te**

### **Identifizierung der UDID eines iOS-Ger√§ts**

Um ein iOS-Ger√§t eindeutig zu identifizieren, wird eine 40-stellige Sequenz verwendet, die als UDID bekannt ist. Auf macOS Catalina oder neuer kann dies in der **Finder-App** gefunden werden, da iTunes nicht mehr vorhanden ist. Das Ger√§t, einmal √ºber USB verbunden und im Finder ausgew√§hlt, zeigt seine UDID neben anderen Informationen an, wenn die Details unter seinem Namen durchgeklickt werden.

F√ºr Versionen von macOS vor Catalina erleichtert iTunes die Entdeckung der UDID. Detaillierte Anweisungen finden Sie [hier](http://www.iclarified.com/52179/how-to-find-your-iphones-udid).

Befehlszeilenwerkzeuge bieten alternative Methoden zum Abrufen der UDID:

* **Verwendung des I/O Registry Explorer-Tools `ioreg`:**
```bash
$ ioreg -p IOUSB -l | grep "USB Serial"
```
* **Verwendung von `ideviceinstaller` f√ºr macOS (und Linux):**
```bash
$ brew install ideviceinstaller
$ idevice_id -l
```
* **Verwendung von `system_profiler`:**
```bash
$ system_profiler SPUSBDataType | sed -n -e '/iPad/,/Serial/p;/iPhone/,/Serial/p;/iPod/,/Serial/p' | grep "Serial Number:"
```
* **Einsatz von `instruments`, um Ger√§te aufzulisten:**
```bash
$ instruments -s devices
```
### **Zugriff auf die Ger√§teshell**

**SSH-Zugriff** wird durch die Installation des **OpenSSH-Pakets** nach dem Jailbreak aktiviert, was Verbindungen √ºber `ssh root@<device_ip_address>` erm√∂glicht. Es ist entscheidend, die Standardpassw√∂rter (`alpine`) f√ºr die Benutzer `root` und `mobile` zu √§ndern, um das Ger√§t abzusichern.

**SSH √ºber USB** wird notwendig, wenn kein Wi-Fi verf√ºgbar ist, indem `iproxy` verwendet wird, um die Ger√§teports f√ºr SSH-Verbindungen zuzuordnen. Diese Einrichtung erm√∂glicht den SSH-Zugriff √ºber USB, indem Folgendes ausgef√ºhrt wird:
```bash
$ iproxy 2222 22
$ ssh -p 2222 root@localhost
```
**On-device shell applications**, wie NewTerm 2, erleichtern die direkte Interaktion mit dem Ger√§t, was besonders n√ºtzlich f√ºr die Fehlersuche ist. **Reverse SSH shells** k√∂nnen ebenfalls f√ºr den Remote-Zugriff vom Host-Computer eingerichtet werden.

### **Zur√ºcksetzen vergessener Passw√∂rter**

Um ein vergessenes Passwort auf das Standardpasswort (`alpine`) zur√ºckzusetzen, ist es notwendig, die Datei `/private/etc/master.passwd` zu bearbeiten. Dies beinhaltet das Ersetzen des vorhandenen Hashes durch den Hash f√ºr `alpine` neben den Eintr√§gen f√ºr die Benutzer `root` und `mobile`.

## **Daten√ºbertragungstechniken**

### **√úbertragen von App-Daten-Dateien**

**Archivierung und Abruf √ºber SSH und SCP:** Es ist einfach, das Data-Verzeichnis der Anwendung mit `tar` zu archivieren und dann mit `scp` zu √ºbertragen. Der folgende Befehl archiviert das Data-Verzeichnis in eine .tgz-Datei, die dann vom Ger√§t abgerufen wird:
```bash
tar czvf /tmp/data.tgz /private/var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693
exit
scp -P 2222 root@localhost:/tmp/data.tgz .
```
### **Graphische Benutzeroberfl√§chen-Tools**

**Verwendung von iFunbox und iExplorer:** Diese GUI-Tools sind n√ºtzlich f√ºr die Verwaltung von Dateien auf iOS-Ger√§ten. Mit iOS 8.4 hat Apple jedoch den Zugriff dieser Tools auf den Anwendungs-Sandbox eingeschr√§nkt, es sei denn, das Ger√§t ist jailbroken.

### **Verwendung von Objection zur Dateiverwaltung**

**Interaktive Shell mit Objection:** Das Starten von Objection erm√∂glicht den Zugriff auf das Bundle-Verzeichnis einer App. Von hier aus k√∂nnen Sie zum Dokumentenverzeichnis der App navigieren und Dateien verwalten, einschlie√ülich des Herunterladens und Hochladens von und zu dem iOS-Ger√§t.
```bash
objection --gadget com.apple.mobilesafari explorer
cd /var/mobile/Containers/Data/Application/72C7AAFB-1D75-4FBA-9D83-D8B4A2D44133/Documents
file download <filename>
```
## **Erhalten und Extrahieren von Apps**

### **Erwerb der IPA-Datei**

**Over-The-Air (OTA) Verteilungslink:** Apps, die zur Testzwecken √ºber OTA verteilt werden, k√∂nnen mit dem ITMS-Dienst-Asset-Downloader-Tool heruntergeladen werden, das √ºber npm installiert wird und verwendet wird, um die IPA-Datei lokal zu speichern.
```bash
npm install -g itms-services
itms-services -u "itms-services://?action=download-manifest&url=https://s3-ap-southeast-1.amazonaws.com/test-uat/manifest.plist" -o - > out.ipa
```
### **Extrahieren der App-Bin√§rdatei**

1. **Von einer IPA:** Entpacken Sie die IPA, um auf die entschl√ºsselte App-Bin√§rdatei zuzugreifen.
2. **Von einem Jailbroken-Ger√§t:** Installieren Sie die App und extrahieren Sie die entschl√ºsselte Bin√§rdatei aus dem Speicher.

### **Entschl√ºsselungsprozess**

**√úberblick √ºber die manuelle Entschl√ºsselung:** iOS-App-Bin√§rdateien sind von Apple mit FairPlay verschl√ºsselt. Um eine Reverse-Engineering durchzuf√ºhren, muss man die entschl√ºsselte Bin√§rdatei aus dem Speicher dumpen. Der Entschl√ºsselungsprozess umfasst das √úberpr√ºfen des PIE-Flags, das Anpassen der Speicherflags, das Identifizieren des verschl√ºsselten Abschnitts und dann das Dumpen und Ersetzen dieses Abschnitts durch seine entschl√ºsselte Form.

**√úberpr√ºfen und √Ñndern des PIE-Flags:**
```bash
otool -Vh Original_App
python change_macho_flags.py --no-pie Original_App
otool -Vh Hello_World
```
**Identifying Encrypted Section and Dumping Memory:**

Bestimmen Sie die Start- und Endadressen des verschl√ºsselten Abschnitts mit `otool` und dumpen Sie den Speicher vom jailbroken Ger√§t mit gdb.
```bash
otool -l Original_App | grep -A 4 LC_ENCRYPTION_INFO
dump memory dump.bin 0x8000 0x10a4000
```
**√úberschreiben des verschl√ºsselten Abschnitts:**

Ersetzen Sie den verschl√ºsselten Abschnitt im urspr√ºnglichen App-Bin√§r mit dem entschl√ºsselten Dump.
```bash
dd bs=1 seek=<starting_address> conv=notrunc if=dump.bin of=Original_App
```
**Finalisierung der Entschl√ºsselung:** √Ñndern Sie die Metadaten der Bin√§rdatei, um das Fehlen von Verschl√ºsselung anzuzeigen, indem Sie Tools wie **MachOView** verwenden und `cryptid` auf 0 setzen.

### **Entschl√ºsselung (Automatisch)**

#### **frida-ios-dump**
Das [**frida-ios-dump**](https://github.com/AloneMonkey/frida-ios-dump) Tool wird verwendet, um **Apps automatisch zu entschl√ºsseln und zu extrahieren** von iOS-Ger√§ten. Zun√§chst muss `dump.py` konfiguriert werden, um eine Verbindung zum iOS-Ger√§t herzustellen, was √ºber localhost an Port 2222 √ºber **iproxy** oder direkt √ºber die IP-Adresse und den Port des Ger√§ts erfolgen kann.

Anwendungen, die auf dem Ger√§t installiert sind, k√∂nnen mit dem Befehl aufgelistet werden:
```bash
$ python dump.py -l
```
Um eine bestimmte App, wie Telegram, zu dumpen, wird der folgende Befehl verwendet:
```bash
$ python3 dump.py -u "root" -p "<PASSWORD>" ph.telegra.Telegraph
```
Dieser Befehl initiiert den App-Dump, was zur Erstellung einer `Telegram.ipa`-Datei im aktuellen Verzeichnis f√ºhrt. Dieser Prozess ist f√ºr jailbroken Ger√§te geeignet, da nicht signierte oder gef√§lscht signierte Apps mit Tools wie [**ios-deploy**](https://github.com/ios-control/ios-deploy) neu installiert werden k√∂nnen.

#### **flexdecrypt**
Das [**flexdecrypt**](https://github.com/JohnCoates/flexdecrypt) Tool, zusammen mit seinem Wrapper [**flexdump**](https://gist.github.com/defparam/71d67ee738341559c35c684d659d40ac), erm√∂glicht das Extrahieren von IPA-Dateien aus installierten Anwendungen. Die Installationsbefehle f√ºr **flexdecrypt** auf dem Ger√§t umfassen das Herunterladen und Installieren des `.deb`-Pakets. **flexdump** kann verwendet werden, um Apps aufzulisten und zu dumpen, wie in den folgenden Befehlen gezeigt:
```bash
apt install zip unzip
wget https://gist.githubusercontent.com/defparam/71d67ee738341559c35c684d659d40ac/raw/30c7612262f1faf7871ba8e32fbe29c0f3ef9e27/flexdump -P /usr/local/bin; chmod +x /usr/local/bin/flexdump
flexdump list
flexdump dump Twitter.app
```
#### **bagbak**
[**bagbak**](https://github.com/ChiChou/bagbak), ein weiteres auf Frida basierendes Tool, erfordert ein gejailbreaktes Ger√§t f√ºr die App-Dekodierung:
```bash
bagbak --raw Chrome
```
#### **r2flutch**
**r2flutch**, das sowohl radare als auch frida nutzt, dient der App-Dekodierung und dem Dumping. Weitere Informationen finden Sie auf seiner [**GitHub-Seite**](https://github.com/as0ler/r2flutch).

### **Apps installieren**

**Sideloading** bezieht sich auf die Installation von Anwendungen au√üerhalb des offiziellen App Stores. Dieser Prozess wird vom **installd-Daemon** verwaltet und erfordert, dass Apps mit einem von Apple ausgestellten Zertifikat signiert sind. Jailbroken Ger√§te k√∂nnen dies durch **AppSync** umgehen, was die Installation von gef√§lscht signierten IPA-Paketen erm√∂glicht.

#### **Sideloading-Tools**

- **Cydia Impactor**: Ein Tool zum Signieren und Installieren von IPA-Dateien auf iOS und APK-Dateien auf Android. Anleitungen und Fehlersuche finden Sie auf [yalujailbreak.net](https://yalujailbreak.net/how-to-use-cydia-impactor/).

- **libimobiledevice**: Eine Bibliothek f√ºr Linux und macOS zur Kommunikation mit iOS-Ger√§ten. Installationsbefehle und Anwendungsbeispiele f√ºr ideviceinstaller werden bereitgestellt, um Apps √ºber USB zu installieren.

- **ipainstaller**: Dieses Kommandozeilen-Tool erm√∂glicht die direkte Installation von Apps auf iOS-Ger√§ten.

- **ios-deploy**: F√ºr macOS-Nutzer installiert ios-deploy iOS-Apps √ºber die Kommandozeile. Das Entpacken der IPA und die Verwendung des `-m`-Flags f√ºr den direkten App-Start sind Teil des Prozesses.

- **Xcode**: Verwenden Sie Xcode, um Apps zu installieren, indem Sie zu **Window/Devices and Simulators** navigieren und die App zu **Installed Apps** hinzuf√ºgen.

#### **Anwendung Installation auf Nicht-iPad-Ger√§ten erlauben**
Um iPad-spezifische Anwendungen auf iPhone- oder iPod touch-Ger√§ten zu installieren, muss der **UIDeviceFamily**-Wert in der **Info.plist**-Datei auf **1** ge√§ndert werden. Diese Modifikation erfordert jedoch eine erneute Signierung der IPA-Datei aufgrund von Signaturvalidierungspr√ºfungen.

**Hinweis**: Diese Methode k√∂nnte fehlschlagen, wenn die Anwendung F√§higkeiten verlangt, die exklusiv f√ºr neuere iPad-Modelle sind, w√§hrend ein √§lteres iPhone oder iPod touch verwendet wird.

## References
* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](ttps://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0052/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0052/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0053/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0053/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0054/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0054/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0056/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0056/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
