# Osnovne operacije testiranja iOS-a

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## **SaÅ¾etak identifikacije i pristupa iOS ureÄ‘aju**

### **Identifikacija UDID-a iOS ureÄ‘aja**

Za jedinstvenu identifikaciju iOS ureÄ‘aja koristi se 40-cifreni niz poznat kao UDID. Na macOS Catalina ili novijim verzijama, to se moÅ¾e pronaÄ‡i u aplikaciji **Finder**, jer iTunes viÅ¡e nije prisutan. UreÄ‘aj, jednom povezan preko USB-a i izabran u Finder-u, otkriva svoj UDID meÄ‘u ostalim informacijama kada se klikne na detalje ispod njegovog imena.

Za verzije macOS-a pre Cataline, iTunes omoguÄ‡ava otkrivanje UDID-a. Detaljne instrukcije mogu se pronaÄ‡i [ovde](http://www.iclarified.com/52179/how-to-find-your-iphones-udid).

Alati komandne linije nude alternativne metode za dobijanje UDID-a:

* **KoriÅ¡Ä‡enje alata I/O Registry Explorer `ioreg`:**
```bash
$ ioreg -p IOUSB -l | grep "USB Serial"
```
* **KoriÅ¡Ä‡enje `ideviceinstaller` alata za macOS (i Linux):**
```bash
$ brew install ideviceinstaller
$ idevice_id -l
```
* **KoriÅ¡Ä‡enje `system_profiler` alata:**
```bash
$ system_profiler SPUSBDataType | sed -n -e '/iPad/,/Serial/p;/iPhone/,/Serial/p;/iPod/,/Serial/p' | grep "Serial Number:"
```
* **KoriÅ¡Ä‡enje `instruments` alata za listanje ureÄ‘aja:**
```bash
$ instruments -s devices
```
### **Pristupanje Shell ureÄ‘aju**

**SSH pristup** je omoguÄ‡en instaliranjem **OpenSSH paketa** nakon jailbreak-a, Å¡to omoguÄ‡ava konekcije putem `ssh root@<device_ip_address>`. VaÅ¾no je promeniti podrazumevane lozinke (`alpine`) za korisnike `root` i `mobile` kako bi se osigurao ureÄ‘aj.

**SSH preko USB-a** postaje neophodan u sluÄaju nedostatka Wi-Fi mreÅ¾e, koristeÄ‡i `iproxy` za mapiranje portova ureÄ‘aja za SSH konekcije. Ova postavka omoguÄ‡ava SSH pristup preko USB-a pokretanjem:
```bash
$ iproxy 2222 22
$ ssh -p 2222 root@localhost
```
### **Aplikacije za pristup ureÄ‘aju**, poput NewTerm 2, olakÅ¡avaju direktnu interakciju sa ureÄ‘ajem, posebno korisno za reÅ¡avanje problema. **Obrnuti SSH Å¡koljke** takoÄ‘e se mogu uspostaviti za daljinski pristup sa raÄunara domaÄ‡ina.

### **Resetovanje zaboravljenih lozinki**

Da biste resetovali zaboravljenu lozinku na podrazumevanu (`alpine`), neophodno je izmeniti datoteku `/private/etc/master.passwd`. To ukljuÄuje zamenu postojeÄ‡eg heÅ¡a sa heÅ¡om za `alpine` pored unosa korisnika `root` i `mobile`.

## **Tehnike prenosa podataka**

### **Prenos datoteka aplikacije**

**Arhiviranje i preuzimanje putem SSH i SCP:** Jednostavno je arhivirati direktorijum podataka aplikacije koristeÄ‡i `tar`, a zatim ga preneti koristeÄ‡i `scp`. Komanda ispod arhivira direktorijum podataka u .tgz datoteku, koja se zatim preuzima sa ureÄ‘aja:
```bash
tar czvf /tmp/data.tgz /private/var/mobile/Containers/Data/Application/8C8E7EB0-BC9B-435B-8EF8-8F5560EB0693
exit
scp -P 2222 root@localhost:/tmp/data.tgz .
```
### **GrafiÄki alati sa korisniÄkim interfejsom**

**KoriÅ¡Ä‡enje iFunbox-a i iExplorer-a:** Ovi grafiÄki alati su korisni za upravljanje fajlovima na iOS ureÄ‘ajima. MeÄ‘utim, poÄevÅ¡i od iOS 8.4, Apple je ograniÄio pristup ovim alatima do aplikacionog sandbox-a, osim ako je ureÄ‘aj jailbroken.

### **KoriÅ¡Ä‡enje Objection-a za upravljanje fajlovima**

**Interaktivna komandna linija sa Objection-om:** Pokretanje Objection-a omoguÄ‡ava pristup Bundle direktorijumu aplikacije. Odavde moÅ¾ete navigirati do Documents direktorijuma aplikacije i upravljati fajlovima, ukljuÄujuÄ‡i njihovo preuzimanje i otpremanje sa iOS ureÄ‘aja.
```bash
objection --gadget com.apple.mobilesafari explorer
cd /var/mobile/Containers/Data/Application/72C7AAFB-1D75-4FBA-9D83-D8B4A2D44133/Documents
file download <filename>
```
## **Dobijanje i izdvajanje aplikacija**

### **Dobijanje IPA fajla**

**Veza za distribuciju preko mreÅ¾e (OTA):** Aplikacije distribuirane za testiranje putem OTA mogu se preuzeti koristeÄ‡i alat za preuzimanje ITMS usluga, koji se instalira putem npm-a i koristi se za lokalno Äuvanje IPA fajla.
```bash
npm install -g itms-services
itms-services -u "itms-services://?action=download-manifest&url=https://s3-ap-southeast-1.amazonaws.com/test-uat/manifest.plist" -o - > out.ipa
```
### **Izdvajanje binarnog koda aplikacije**

1. **Iz IPA datoteke:** Dekompresirajte IPA datoteku kako biste pristupili deÅ¡ifrovanom binarnom kodu aplikacije.
2. **Sa Jailbroken ureÄ‘aja:** Instalirajte aplikaciju i izvucite deÅ¡ifrovanu binarnu datoteku iz memorije.

### **Proces deÅ¡ifrovanja**

**Pregled ruÄnog deÅ¡ifrovanja:** Binarni kod iOS aplikacija je enkriptovan od strane Apple-a koristeÄ‡i FairPlay. Da biste izvrÅ¡ili reverzno inÅ¾enjerstvo, morate izvuÄ‡i deÅ¡ifrovanu binarnu datoteku iz memorije. Proces deÅ¡ifrovanja ukljuÄuje proveru PIE zastavice, podeÅ¡avanje zastavica memorije, identifikaciju enkriptovane sekcije, a zatim izvlaÄenje i zamenu ove sekcije sa njenom deÅ¡ifrovanom formom.

**Provera i izmena PIE zastavice:**
```bash
otool -Vh Original_App
python change_macho_flags.py --no-pie Original_App
otool -Vh Hello_World
```
**Identifikacija Å¡ifrovane sekcije i ispuÅ¡tanje memorije:**

Koristite `otool` da odredite poÄetnu i krajnju adresu Å¡ifrovane sekcije, a zatim koristite gdb da ispuÅ¡tate memoriju sa jailbroken ureÄ‘aja.
```bash
otool -l Original_App | grep -A 4 LC_ENCRYPTION_INFO
dump memory dump.bin 0x8000 0x10a4000
```
**Prepisivanje Å¡ifrovanog dela:**

Zamenite Å¡ifrovanu sekciju u originalnom binarnom fajlu aplikacije sa deÅ¡ifrovanim dumpom.
```bash
dd bs=1 seek=<starting_address> conv=notrunc if=dump.bin of=Original_App
```
**ZavrÅ¡avanje Dekripcije:** Izmenite metapodatke binarnog fajla kako biste naznaÄili odsustvo enkripcije koristeÄ‡i alate poput **MachOView**, postavljajuÄ‡i `cryptid` na 0.

### **Dekripcija (Automatski)**

#### **frida-ios-dump**
Alat [**frida-ios-dump**](https://github.com/AloneMonkey/frida-ios-dump) se koristi za **automatsko dekriptovanje i izdvajanje aplikacija** sa iOS ureÄ‘aja. Prvo, treba konfigurisati `dump.py` da se poveÅ¾e sa iOS ureÄ‘ajem, Å¡to se moÅ¾e uraditi preko localhost-a na portu 2222 putem **iproxy**-ja ili direktno putem IP adrese ureÄ‘aja i porta.

Instalirane aplikacije na ureÄ‘aju mogu se prikazati komandom:
```bash
$ python dump.py -l
```
Da biste izvrÅ¡ili dump odreÄ‘ene aplikacije, kao Å¡to je Telegram, koristite sledeÄ‡u komandu:
```bash
$ python3 dump.py -u "root" -p "<PASSWORD>" ph.telegra.Telegraph
```
Ova komanda pokreÄ‡e izvlaÄenje aplikacije, rezultirajuÄ‡i stvaranjem `Telegram.ipa` datoteke u trenutnom direktorijumu. Ovaj proces je pogodan za jailbroken ureÄ‘aje, jer se nepotpisane ili laÅ¾no potpisane aplikacije mogu ponovo instalirati pomoÄ‡u alata kao Å¡to je [**ios-deploy**](https://github.com/ios-control/ios-deploy).

#### **flexdecrypt**
Alat [**flexdecrypt**](https://github.com/JohnCoates/flexdecrypt), zajedno sa svojim omotaÄem [**flexdump**](https://gist.github.com/defparam/71d67ee738341559c35c684d659d40ac), omoguÄ‡ava izvlaÄenje IPA datoteka iz instaliranih aplikacija. Komande za instalaciju **flexdecrypt** na ureÄ‘aju ukljuÄuju preuzimanje i instaliranje `.deb` paketa. **flexdump** se moÅ¾e koristiti za listanje i izvlaÄenje aplikacija, kao Å¡to je prikazano u sledeÄ‡im komandama:
```bash
apt install zip unzip
wget https://gist.githubusercontent.com/defparam/71d67ee738341559c35c684d659d40ac/raw/30c7612262f1faf7871ba8e32fbe29c0f3ef9e27/flexdump -P /usr/local/bin; chmod +x /usr/local/bin/flexdump
flexdump list
flexdump dump Twitter.app
```
#### **bagbak**
[**bagbak**](https://github.com/ChiChou/bagbak), joÅ¡ jedan alat zasnovan na Fridi, zahteva jailbroken ureÄ‘aj za deÅ¡ifrovanje aplikacija:
```bash
bagbak --raw Chrome
```
#### **r2flutch**
**r2flutch**, koristeÄ‡i i radare i fridu, sluÅ¾i za deÅ¡ifrovanje i iskopiranje aplikacija. ViÅ¡e informacija moÅ¾ete pronaÄ‡i na njegovoj [**GitHub stranici**](https://github.com/as0ler/r2flutch).

### **Instaliranje aplikacija**

**Sideloading** se odnosi na instaliranje aplikacija van zvaniÄne App Store prodavnice. Ovaj proces obavlja **installd daemon** i zahteva da aplikacije budu potpisane Apple-ovim sertifikatom. Jailbroken ureÄ‘aji mogu zaobiÄ‡i ovo koriÅ¡Ä‡enjem **AppSync**-a, omoguÄ‡avajuÄ‡i instaliranje laÅ¾no potpisanih IPA paketa.

#### **Alati za sideloading**

- **Cydia Impactor**: Alat za potpisivanje i instaliranje IPA fajlova na iOS i APK fajlova na Androidu. VodiÄi i reÅ¡avanje problema mogu se pronaÄ‡i na [yalujailbreak.net](https://yalujailbreak.net/how-to-use-cydia-impactor/).

- **libimobiledevice**: Biblioteka za Linux i macOS za komunikaciju sa iOS ureÄ‘ajima. Komande za instalaciju i primeri koriÅ¡Ä‡enja za ideviceinstaller su dostupni za instaliranje aplikacija preko USB-a.

- **ipainstaller**: Ovaj alat komandne linije omoguÄ‡ava direktnu instalaciju aplikacija na iOS ureÄ‘ajima.

- **ios-deploy**: Za korisnike macOS-a, ios-deploy instalira iOS aplikacije sa komandne linije. Dekompresovanje IPA fajla i koriÅ¡Ä‡enje opcije `-m` za direktno pokretanje aplikacije su deo procesa.

- **Xcode**: Koristite Xcode za instaliranje aplikacija tako Å¡to Ä‡ete otiÄ‡i na **Window/Devices and Simulators** i dodati aplikaciju u **Installed Apps**.

#### **Dozvoljavanje instalacije aplikacija na ureÄ‘ajima koji nisu iPad**
Da biste instalirali aplikacije specifiÄne za iPad na ureÄ‘ajima iPhone ili iPod touch, vrednost **UIDeviceFamily** u fajlu **Info.plist** treba promeniti u **1**. MeÄ‘utim, ova modifikacija zahteva ponovno potpisivanje IPA fajla zbog provere potpisa.

**Napomena**: Ovaj metod moÅ¾e da ne uspe ako aplikacija zahteva moguÄ‡nosti koje su ekskluzivne za novije modele iPada dok se koristi stariji iPhone ili iPod touch.



## Reference
* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](ttps://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0052/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0052/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0053/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0053/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0054/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0054/)
* [https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0056/](https://mas.owasp.org/MASTG/techniques/ios/MASTG-TECH-0056/)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
