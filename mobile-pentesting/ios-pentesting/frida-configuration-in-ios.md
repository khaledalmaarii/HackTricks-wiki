# iOS Frida Configuration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Installing Frida

**íƒˆì˜¥ëœ ì¥ì¹˜ì— Fridaë¥¼ ì„¤ì¹˜í•˜ëŠ” ë‹¨ê³„:**

1. Cydia/Sileo ì•±ì„ ì—½ë‹ˆë‹¤.
2. ê´€ë¦¬ -> ì†ŒìŠ¤ -> í¸ì§‘ -> ì¶”ê°€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
3. URLë¡œ "https://build.frida.re"ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
4. ìƒˆë¡œ ì¶”ê°€ëœ Frida ì†ŒìŠ¤ë¡œ ì´ë™í•©ë‹ˆë‹¤.
5. Frida íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

**Corellium**ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° [https://github.com/frida/frida/releases](https://github.com/frida/frida/releases)ì—ì„œ Frida ë¦´ë¦¬ìŠ¤ë¥¼ ë‹¤ìš´ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤ (`frida-gadget-[yourversion]-ios-universal.dylib.gz`) ê·¸ë¦¬ê³  ì••ì¶•ì„ í’€ê³  Fridaê°€ ìš”ì²­í•˜ëŠ” dylib ìœ„ì¹˜ì— ë³µì‚¬í•©ë‹ˆë‹¤, ì˜ˆ: `/Users/[youruser]/.cache/frida/gadget-ios.dylib`

ì„¤ì¹˜ í›„, PCì—ì„œ **`frida-ls-devices`** ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ì¥ì¹˜ê°€ ë‚˜íƒ€ë‚˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (PCê°€ ì¥ì¹˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤).\
ë˜í•œ **`frida-ps -Uia`**ë¥¼ ì‹¤í–‰í•˜ì—¬ ì „í™”ê¸°ì˜ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

## íƒˆì˜¥ë˜ì§€ ì•Šì€ ì¥ì¹˜ì—ì„œ Frida ì‚¬ìš© ë° ì•± íŒ¨ì¹˜ ì—†ì´

íƒˆì˜¥ë˜ì§€ ì•Šì€ ì¥ì¹˜ì—ì„œ ì•±ì„ íŒ¨ì¹˜í•˜ì§€ ì•Šê³  Fridaë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì„ í™•ì¸í•˜ì„¸ìš”: [https://mrbypass.medium.com/unlocking-potential-exploring-frida-objection-on-non-jailbroken-devices-without-application-ed0367a84f07](https://mrbypass.medium.com/unlocking-potential-exploring-frida-objection-on-non-jailbroken-devices-without-application-ed0367a84f07)

## Frida Client Installation

**frida tools** ì„¤ì¹˜:
```bash
pip install frida-tools
pip install frida
```
Frida ì„œë²„ê°€ ì„¤ì¹˜ë˜ê³  ì¥ì¹˜ê°€ ì‹¤í–‰ ì¤‘ì´ë©° ì—°ê²°ëœ ìƒíƒœì—ì„œ **í´ë¼ì´ì–¸íŠ¸ê°€ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸**í•˜ì‹­ì‹œì˜¤:
```bash
frida-ls-devices  # List devices
frida-ps -Uia     # Get running processes
```
## Frida Trace
```bash
# Functions
## Trace all functions with the word "log" in their name
frida-trace -U <program> -i "*log*"
frida-trace -U <program> -i "*log*" | swift demangle # Demangle names

# Objective-C
## Trace all methods of all classes
frida-trace -U <program> -m "*[* *]"

## Trace all methods with the word "authentication" from classes that start with "NE"
frida-trace -U <program> -m "*[NE* *authentication*]"

# Plug-In
## To hook a plugin that is momentarely executed prepare Frida indicating the ID of the Plugin binary
frida-trace -U -W <if-plugin-bin> -m '*[* *]'
```
### ëª¨ë“  í´ë˜ìŠ¤ ë° ë©”ì„œë“œ ê°€ì ¸ì˜¤ê¸°

* ìë™ ì™„ì„±: `frida -U <program>`ì„ ì‹¤í–‰í•˜ì„¸ìš”.

<figure><img src="../../.gitbook/assets/image (1159).png" alt=""><figcaption></figcaption></figure>

* **ëª¨ë“ ** ì‚¬ìš© ê°€ëŠ¥í•œ **í´ë˜ìŠ¤** ê°€ì ¸ì˜¤ê¸° (ë¬¸ìì—´ë¡œ í•„í„°ë§)

{% code title="/tmp/script.js" %}
```javascript
// frida -U <program> -l /tmp/script.js

var filterClass = "filterstring";

if (ObjC.available) {
for (var className in ObjC.classes) {
if (ObjC.classes.hasOwnProperty(className)) {
if (!filterClass || className.includes(filterClass)) {
console.log(className);
}
}
}
} else {
console.log("Objective-C runtime is not available.");
}
```
{% endcode %}

* **í´ë˜ìŠ¤**ì˜ **ëª¨ë“ ** **ë©”ì„œë“œ** ê°€ì ¸ì˜¤ê¸° (ë¬¸ìì—´ë¡œ í•„í„°ë§)

{% code title="/tmp/script.js" %}
```javascript
// frida -U <program> -l /tmp/script.js

var specificClass = "YourClassName";
var filterMethod = "filtermethod";

if (ObjC.available) {
if (ObjC.classes.hasOwnProperty(specificClass)) {
var methods = ObjC.classes[specificClass].$ownMethods;
for (var i = 0; i < methods.length; i++) {
if (!filterMethod || methods[i].includes(filterClass)) {
console.log(specificClass + ': ' + methods[i]);
}
}
} else {
console.log("Class not found.");
}
} else {
console.log("Objective-C runtime is not available.");
}
```
{% endcode %}

* **í•¨ìˆ˜ í˜¸ì¶œ**
```javascript
// Find the address of the function to call
const func_addr = Module.findExportByName("<Prog Name>", "<Func Name>");
// Declare the function to call
const func = new NativeFunction(
func_addr,
"void", ["pointer", "pointer", "pointer"], {
});

var arg0 = null;

// In this case to call this function we need to intercept a call to it to copy arg0
Interceptor.attach(wg_log_addr, {
onEnter: function(args) {
arg0 = new NativePointer(args[0]);
}
});

// Wait untill a call to the func occurs
while (! arg0) {
Thread.sleep(1);
console.log("waiting for ptr");
}


var arg1 = Memory.allocUtf8String('arg1');
var txt = Memory.allocUtf8String('Some text for arg2');
wg_log(arg0, arg1, txt);

console.log("loaded");
```
## Frida Fuzzing

### Frida Stalker

[ë¬¸ì„œì—ì„œ](https://frida.re/docs/stalker/): StalkerëŠ” Fridaì˜ ì½”ë“œ **ì¶”ì  ì—”ì§„**ì…ë‹ˆë‹¤. ì´ëŠ” ìŠ¤ë ˆë“œë¥¼ **ë”°ë¼ê°€ë©°**, ì‹¤í–‰ë˜ëŠ” ëª¨ë“  í•¨ìˆ˜, **ëª¨ë“  ë¸”ë¡**, ì‹¬ì§€ì–´ ëª¨ë“  ëª…ë ¹ì–´ë¥¼ **ìº¡ì²˜**í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

Frida Stalkerë¥¼ êµ¬í˜„í•œ ì˜ˆì œëŠ” [ì—¬ê¸°](https://github.com/poxyran/misc/blob/master/frida-stalker-example.py)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ê²ƒì€ í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ Frida Stalkerë¥¼ ì—°ê²°í•˜ëŠ” ë˜ ë‹¤ë¥¸ ì˜ˆì œì…ë‹ˆë‹¤:
```javascript
console.log("loading");
const wg_log_addr = Module.findExportByName("<Program>", "<function_name>");
const wg_log = new NativeFunction(
wg_log_addr,
"void", ["pointer", "pointer", "pointer"], {
});

Interceptor.attach(wg_log_addr, {
onEnter: function(args) {
console.log(`logging the following message: ${args[2].readCString()}`);

Stalker.follow({
events: {
// only collect coverage for newly encountered blocks
compile: true,
},
onReceive: function (events) {
const bbs = Stalker.parse(events, {
stringify: false,
annotate: false
});
console.log("Stalker trace of write_msg_to_log: \n" + bbs.flat().map(DebugSymbol.fromAddress).join('\n'));
}
});
},
onLeave: function(retval) {
Stalker.unfollow();
Stalker.flush();  // this is important to get all events
}
});
```
{% hint style="danger" %}
ë””ë²„ê¹… ëª©ì ì—ì„œëŠ” í¥ë¯¸ë¡­ì§€ë§Œ, í¼ì§•ì„ ìœ„í•´ **`.follow()`** ë° **`.unfollow()`**ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ë§¤ìš° ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.
{% endhint %}

## [Fpicker](https://github.com/ttdennis/fpicker)

[**fpicker**](https://github.com/ttdennis/fpicker)ëŠ” AFL++ ëª¨ë“œ ë˜ëŠ” ìˆ˜ë™ ì¶”ì  ëª¨ë“œì™€ ê°™ì€ í”„ë¡œì„¸ìŠ¤ ë‚´ í¼ì§•ì„ ìœ„í•œ ë‹¤ì–‘í•œ í¼ì§• ëª¨ë“œë¥¼ ì œê³µí•˜ëŠ” **Frida ê¸°ë°˜ í¼ì§• ìŠ¤ìœ„íŠ¸**ì…ë‹ˆë‹¤. Fridaê°€ ì§€ì›í•˜ëŠ” ëª¨ë“  í”Œë«í¼ì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

* [**fpicker ì„¤ì¹˜í•˜ê¸°**](https://github.com/ttdennis/fpicker#requirements-and-installation) **& radamsa**
```bash
# Get fpicker
git clone https://github.com/ttdennis/fpicker
cd fpicker

# Get Frida core devkit and prepare fpicker
wget https://github.com/frida/frida/releases/download/16.1.4/frida-core-devkit-16.1.4-[yourOS]-[yourarchitecture].tar.xz
# e.g. https://github.com/frida/frida/releases/download/16.1.4/frida-core-devkit-16.1.4-macos-arm64.tar.xz
tar -xf ./*tar.xz
cp libfrida-core.a libfrida-core-[yourOS].a #libfrida-core-macos.a

# Install fpicker
make fpicker-[yourOS] # fpicker-macos
# This generates ./fpicker

# Install radamsa (fuzzer generator)
brew install radamsa
```
* **FS ì¤€ë¹„:**
```bash
# From inside fpicker clone
mkdir -p examples/wg-log # Where the fuzzing script will be
mkdir -p examples/wg-log/out # For code coverage and crashes
mkdir -p examples/wg-log/in # For starting inputs

# Create at least 1 input for the fuzzer
echo Hello World > examples/wg-log/in/0
```
* **í¼ì € ìŠ¤í¬ë¦½íŠ¸** (`examples/wg-log/myfuzzer.js`):

{% code title="examples/wg-log/myfuzzer.js" %}
```javascript
// Import the fuzzer base class
import { Fuzzer } from "../../harness/fuzzer.js";

class WGLogFuzzer extends Fuzzer {

constructor() {
console.log("WGLogFuzzer constructor called")

// Get and declare the function we are going to fuzz
var wg_log_addr = Module.findExportByName("<Program name>", "<func name to fuzz>");
var wg_log_func = new NativeFunction(
wg_log_addr,
"void", ["pointer", "pointer", "pointer"], {
});

// Initialize the object
super("<Program nane>", wg_log_addr, wg_log_func);
this.wg_log_addr = wg_log_addr; // We cannot use "this" before calling "super"

console.log("WGLogFuzzer in the middle");

// Prepare the second argument to pass to the fuzz function
this.tag = Memory.allocUtf8String("arg2");

// Get the first argument we need to pass from a call to the functino we want to fuzz
var wg_log_global_ptr = null;
console.log(this.wg_log_addr);
Interceptor.attach(this.wg_log_addr, {
onEnter: function(args) {
console.log("Entering in the function to get the first argument");
wg_log_global_ptr = new NativePointer(args[0]);
}
});

while (! wg_log_global_ptr) {
Thread.sleep(1)
}
this.wg_log_global_ptr = wg_log_global_ptr;
console.log("WGLogFuzzer prepare ended")
}


// This function is called by the fuzzer with the first argument being a pointer into memory
// where the payload is stored and the second the length of the input.
fuzz(payload, len) {
// Get a pointer to payload being a valid C string (with a null byte at the end)
var payload_cstring = payload.readCString(len);
this.payload = Memory.allocUtf8String(payload_cstring);

// Debug and fuzz
this.debug_log(this.payload, len);
// Pass the 2 first arguments we know the function needs and finally the payload to fuzz
this.target_function(this.wg_log_global_ptr, this.tag, this.payload);
}
}

const f = new WGLogFuzzer();
rpc.exports.fuzzer = f;
```
{% endcode %}

* **í¼ì €**ë¥¼ **ì»´íŒŒì¼**í•©ë‹ˆë‹¤:
```bash
# From inside fpicker clone
## Compile from "myfuzzer.js" to "harness.js"
frida-compile examples/wg-log/myfuzzer.js -o harness.js
```
* **`radamsa`**ë¥¼ ì‚¬ìš©í•˜ì—¬ fuzzer **`fpicker`** í˜¸ì¶œ:

{% code overflow="wrap" %}
```bash
# Indicate fpicker to fuzz a program with the harness.js script and which folders to use
fpicker -v --fuzzer-mode active -e attach -p <Program to fuzz> -D usb -o examples/wg-log/out/ -i examples/wg-log/in/ -f harness.js --standalone-mutator cmd --mutator-command "radamsa"
# You can find code coverage and crashes in examples/wg-log/out/
```
{% endcode %}

{% hint style="danger" %}
ì´ ê²½ìš° ìš°ë¦¬ëŠ” **ê° í˜ì´ë¡œë“œ í›„ì— ì•±ì„ ì¬ì‹œì‘í•˜ê±°ë‚˜ ìƒíƒœë¥¼ ë³µì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ë”°ë¼ì„œ Fridaê°€ **ì¶©ëŒ**ì„ ë°œê²¬í•˜ë©´, ê·¸ í˜ì´ë¡œë“œ ì´í›„ì˜ **ë‹¤ìŒ ì…ë ¥**ë„ **ì•±ì„ ì¶©ëŒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤** (ì•±ì´ ë¶ˆì•ˆì •í•œ ìƒíƒœì´ê¸° ë•Œë¬¸ì—) ë¹„ë¡ **ì…ë ¥ì´ ì•±ì„ ì¶©ëŒì‹œì¼œì„œëŠ” ì•ˆ ë˜ë”ë¼ë„** ë§ì…ë‹ˆë‹¤.

ê²Œë‹¤ê°€, FridaëŠ” iOSì˜ ì˜ˆì™¸ ì‹ í˜¸ì— í›„í‚¹í•˜ë¯€ë¡œ, **Fridaê°€ ì¶©ëŒì„ ë°œê²¬í•˜ë©´**, ì•„ë§ˆë„ **iOS ì¶©ëŒ ë³´ê³ ì„œê°€ ìƒì„±ë˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤**.

ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´, ì˜ˆë¥¼ ë“¤ì–´, ìš°ë¦¬ëŠ” ê° Frida ì¶©ëŒ í›„ì— ì•±ì„ ì¬ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### ë¡œê·¸ ë° ì¶©ëŒ

**macOS ì½˜ì†”** ë˜ëŠ” **`log`** CLIë¥¼ ì‚¬ìš©í•˜ì—¬ macOS ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë˜í•œ **`idevicesyslog`**ë¥¼ ì‚¬ìš©í•˜ì—¬ iOSì˜ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì¼ë¶€ ë¡œê·¸ëŠ” ì •ë³´ë¥¼ ìƒëµí•˜ë©° **`<private>`**ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ëª¨ë“  ì •ë³´ë¥¼ í‘œì‹œí•˜ë ¤ë©´ [https://developer.apple.com/bug-reporting/profiles-and-logs/](https://developer.apple.com/bug-reporting/profiles-and-logs/)ì—ì„œ ì¼ë¶€ í”„ë¡œíŒŒì¼ì„ ì„¤ì¹˜í•˜ì—¬ í•´ë‹¹ ê°œì¸ ì •ë³´ë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤.

ë¬´ì—‡ì„ í•´ì•¼ í• ì§€ ëª¨ë¥¸ë‹¤ë©´:
```sh
vim /Library/Preferences/Logging/com.apple.system.logging.plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>Enable-Private-Data</key>
<true/>
</dict>
</plist>

killall -9 logd
```
You can check the crashes in:

* **iOS**
* ì„¤ì • â†’ ê°œì¸ ì •ë³´ ë³´í˜¸ â†’ ë¶„ì„ ë° ê°œì„  â†’ ë¶„ì„ ë°ì´í„°
* `/private/var/mobile/Library/Logs/CrashReporter/`
* **macOS**:
* `/Library/Logs/DiagnosticReports/`
* `~/Library/Logs/DiagnosticReports`

{% hint style="warning" %}
iOSëŠ” ë™ì¼í•œ ì•±ì˜ ì¶©ëŒì„ 25ê°œë§Œ ì €ì¥í•˜ë¯€ë¡œ, ì´ë¥¼ ì •ë¦¬í•´ì•¼ í•˜ë©° ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ iOSê°€ ì¶©ëŒì„ ìƒì„±í•˜ëŠ” ê²ƒì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.
{% endhint %}

## Frida Android Tutorials

{% content-ref url="../android-app-pentesting/frida-tutorial/" %}
[frida-tutorial](../android-app-pentesting/frida-tutorial/)
{% endcontent-ref %}

## References

* [https://www.briskinfosec.com/blogs/blogsdetail/Getting-Started-with-Frida](https://www.briskinfosec.com/blogs/blogsdetail/Getting-Started-with-Frida)


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
