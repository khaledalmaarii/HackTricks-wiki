# iOS Frida YapÄ±landÄ±rmasÄ±

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramanlÄ±k seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Frida Kurulumu

**Jailbreak yapÄ±lmÄ±ÅŸ bir cihaza Frida kurulumu adÄ±mlarÄ±:**

1. Cydia/Sileo uygulamasÄ±nÄ± aÃ§Ä±n.
2. YÃ¶net -> Kaynaklar -> DÃ¼zenle -> Ekle bÃ¶lÃ¼mÃ¼ne gidin.
3. URL olarak "https://build.frida.re" adresini girin.
4. Yeni eklenen Frida kaynaÄŸÄ±na gidin.
5. Frida paketini kurun.

EÄŸer **Corellium** kullanÄ±yorsanÄ±z, Frida'yÄ± [https://github.com/frida/frida/releases](https://github.com/frida/frida/releases) adresinden indirmeniz gerekecek (`frida-gadget-[sÃ¼rÃ¼mÃ¼nÃ¼z]-ios-universal.dylib.gz`) ve Frida'nÄ±n istediÄŸi dylib konumuna aÃ§Ä±p kopyalamanÄ±z gerekecek, Ã¶rneÄŸin: `/Users/[kullanÄ±cÄ±adÄ±nÄ±z]/.cache/frida/gadget-ios.dylib`

Kurulum tamamlandÄ±ktan sonra, PC'nizde **`frida-ls-devices`** komutunu kullanarak cihazÄ±n gÃ¶rÃ¼nÃ¼p gÃ¶rÃ¼nmediÄŸini kontrol edebilirsiniz (PC'nizin buna eriÅŸebilmesi gerekmektedir).\
AyrÄ±ca **`frida-ps -Uia`** komutunu da Ã§alÄ±ÅŸtÄ±rarak telefonun Ã§alÄ±ÅŸan iÅŸlemlerini kontrol edebilirsiniz.

## Jailbreak yapÄ±lmamÄ±ÅŸ cihazlarda ve uygulama yamasÄ± yapmadan Frida kullanÄ±mÄ±

Frida'yÄ± jailbreak yapÄ±lmamÄ±ÅŸ cihazlarda ve uygulama yamasÄ± yapmadan nasÄ±l kullanacaÄŸÄ±nÄ±z hakkÄ±nda bu blog yazÄ±sÄ±na gÃ¶z atÄ±n: [https://mrbypass.medium.com/unlocking-potential-exploring-frida-objection-on-non-jailbroken-devices-without-application-ed0367a84f07](https://mrbypass.medium.com/unlocking-potential-exploring-frida-objection-on-non-jailbroken-devices-without-application-ed0367a84f07)

## Frida Ä°stemci Kurulumu

**frida araÃ§larÄ±nÄ±** kurun:
```bash
pip install frida-tools
pip install frida
```
Frida sunucusu yÃ¼klendikten ve cihaz Ã§alÄ±ÅŸÄ±r durumdayken ve baÄŸlÄ±yken, istemcinin Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± **kontrol edin**:
```bash
frida-ls-devices  # List devices
frida-ps -Uia     # Get running processes
```
## Frida Ä°zleme

Frida is a dynamic instrumentation toolkit that allows you to inject JavaScript code into running processes. With Frida, you can trace and manipulate the behavior of iOS applications at runtime.

Frida bir dinamik enstrÃ¼mantasyon aracÄ±dÄ±r ve Ã§alÄ±ÅŸan iÅŸlemlere JavaScript kodu enjekte etmenizi saÄŸlar. Frida ile iOS uygulamalarÄ±nÄ±n Ã§alÄ±ÅŸma zamanÄ±nda davranÄ±ÅŸlarÄ±nÄ± izleyebilir ve manipÃ¼le edebilirsiniz.

To configure Frida for iOS pentesting, follow these steps:

iOS pentesting iÃ§in Frida'yÄ± yapÄ±landÄ±rmak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyin:

1. Install Frida on your machine by running the following command:

   Makinenize Frida'yÄ± aÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rarak yÃ¼kleyin:

   ```
   $ pip install frida-tools
   ```

2. Connect your iOS device to your machine using a USB cable.

   USB kablosu kullanarak iOS cihazÄ±nÄ±zÄ± makinenize baÄŸlayÄ±n.

3. Install Frida on your iOS device by running the following command:

   AÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rarak iOS cihazÄ±nÄ±za Frida'yÄ± yÃ¼kleyin:

   ```
   $ frida-ps -U
   ```

4. Verify that Frida is installed on your iOS device by running the following command:

   AÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rarak Frida'nÄ±n iOS cihazÄ±nÄ±za yÃ¼klendiÄŸini doÄŸrulayÄ±n:

   ```
   $ frida-ps -U
   ```

5. Start the Frida server on your iOS device by running the following command:

   AÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rarak iOS cihazÄ±nÄ±zda Frida sunucusunu baÅŸlatÄ±n:

   ```
   $ frida-server -D
   ```

6. Verify that the Frida server is running on your iOS device by running the following command:

   AÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rarak Frida sunucusunun iOS cihazÄ±nÄ±zda Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± doÄŸrulayÄ±n:

   ```
   $ frida-ps -U
   ```

Once Frida is configured, you can start using it to trace and analyze iOS applications for security vulnerabilities and weaknesses.

Frida yapÄ±landÄ±rÄ±ldÄ±ktan sonra, iOS uygulamalarÄ±nÄ± gÃ¼venlik aÃ§Ä±klarÄ± ve zayÄ±flÄ±klar iÃ§in izlemek ve analiz etmek iÃ§in kullanmaya baÅŸlayabilirsiniz.
```bash
# Functions
## Trace all functions with the word "log" in their name
frida-trace -U <program> -i "*log*"
frida-trace -U <program> -i "*log*" | swift demangle # Demangle names

# Objective-C
## Trace all methods of all classes
frida-trace -U <program> -m "*[* *]"

## Trace all methods with the word "authentication" from classes that start with "NE"
frida-trace -U <program> -m "*[NE* *authentication*]"

# Plug-In
## To hook a plugin that is momentarely executed prepare Frida indicating the ID of the Plugin binary
frida-trace -U -W <if-plugin-bin> -m '*[* *]'
```
### TÃ¼m sÄ±nÄ±flarÄ± ve yÃ¶ntemleri alÄ±n

* Otomatik tamamlama: Sadece `frida -U <program>` komutunu Ã§alÄ±ÅŸtÄ±rÄ±n

<figure><img src="../../.gitbook/assets/image (687).png" alt=""><figcaption></figcaption></figure>

* Mevcut **tÃ¼m** **sÄ±nÄ±flarÄ±** alÄ±n (dizeye gÃ¶re filtreleme)

{% code title="/tmp/script.js" %}
```javascript
// frida -U <program> -l /tmp/script.js

var filterClass = "filterstring";

if (ObjC.available) {
for (var className in ObjC.classes) {
if (ObjC.classes.hasOwnProperty(className)) {
if (!filterClass || className.includes(filterClass)) {
console.log(className);
}
}
}
} else {
console.log("Objective-C runtime is not available.");
}
```
{% endcode %}

* Bir **sÄ±nÄ±fÄ±n** **tÃ¼m** **metotlarÄ±nÄ±** (dize ile filtrele) alÄ±n

{% code title="/tmp/script.js" %}
```javascript
// frida -U <program> -l /tmp/script.js

var specificClass = "YourClassName";
var filterMethod = "filtermethod";

if (ObjC.available) {
if (ObjC.classes.hasOwnProperty(specificClass)) {
var methods = ObjC.classes[specificClass].$ownMethods;
for (var i = 0; i < methods.length; i++) {
if (!filterMethod || methods[i].includes(filterClass)) {
console.log(specificClass + ': ' + methods[i]);
}
}
} else {
console.log("Class not found.");
}
} else {
console.log("Objective-C runtime is not available.");
}
```
{% endcode %}

* **Bir fonksiyonu Ã§aÄŸÄ±rÄ±n**
```javascript
// Find the address of the function to call
const func_addr = Module.findExportByName("<Prog Name>", "<Func Name>");
// Declare the function to call
const func = new NativeFunction(
func_addr,
"void", ["pointer", "pointer", "pointer"], {
});

var arg0 = null;

// In this case to call this function we need to intercept a call to it to copy arg0
Interceptor.attach(wg_log_addr, {
onEnter: function(args) {
arg0 = new NativePointer(args[0]);
}
});

// Wait untill a call to the func occurs
while (! arg0) {
Thread.sleep(1);
console.log("waiting for ptr");
}


var arg1 = Memory.allocUtf8String('arg1');
var txt = Memory.allocUtf8String('Some text for arg2');
wg_log(arg0, arg1, txt);

console.log("loaded");
```
## Frida Fuzzing

### Frida Stalker

[DÃ¶kÃ¼mantasyondan](https://frida.re/docs/stalker/#:~:text=Stalker%20is%20Frida's%20code%20tracing,every%20instruction%20which%20is%20executed.) alÄ±ntÄ±: Stalker, Frida'nÄ±n kod **izleme motoru**dur. Ä°ÅŸlenen her iÅŸlevi, her bloÄŸu ve hatta her talimatÄ± **takip ederek** **yakalar**.

Frida Stalker'Ä± uygulayan bir Ã¶rnek [https://github.com/poxyran/misc/blob/master/frida-stalker-example.py](https://github.com/poxyran/misc/blob/master/frida-stalker-example.py) adresinde bulunmaktadÄ±r.

AÅŸaÄŸÄ±daki Ã¶rnek, bir iÅŸlev Ã§aÄŸrÄ±ldÄ±ÄŸÄ±nda Frida Stalker'Ä± eklemek iÃ§in kullanÄ±labilir:
```javascript
console.log("loading");
const wg_log_addr = Module.findExportByName("<Program>", "<function_name>");
const wg_log = new NativeFunction(
wg_log_addr,
"void", ["pointer", "pointer", "pointer"], {
});

Interceptor.attach(wg_log_addr, {
onEnter: function(args) {
console.log(`logging the following message: ${args[2].readCString()}`);

Stalker.follow({
events: {
// only collect coverage for newly encountered blocks
compile: true,
},
onReceive: function (events) {
const bbs = Stalker.parse(events, {
stringify: false,
annotate: false
});
console.log("Stalker trace of write_msg_to_log: \n" + bbs.flat().map(DebugSymbol.fromAddress).join('\n'));
}
});
},
onLeave: function(retval) {
Stalker.unfollow();
Stalker.flush();  // this is important to get all events
}
});
```
{% hint style="danger" %}
Bu, hata ayÄ±klama amaÃ§larÄ± iÃ§in ilginÃ§ olsa da, sÃ¼rekli olarak **`.follow()`** ve **`.unfollow()`** yapmak Ã§ok verimsizdir.
{% endhint %}

## [Fpicker](https://github.com/ttdennis/fpicker)

[**fpicker**](https://github.com/ttdennis/fpicker), in-process fuzzing iÃ§in Ã§eÅŸitli fuzzing modlarÄ± sunan bir **Frida tabanlÄ± fuzzing paketi**dir. AFL++ modu veya pasif izleme modu gibi modlarÄ± destekleyen bu paket, Frida tarafÄ±ndan desteklenen tÃ¼m platformlarda Ã§alÄ±ÅŸmalÄ±dÄ±r.

* [**fpicker**'Ä± yÃ¼kleyin](https://github.com/ttdennis/fpicker#requirements-and-installation) **& radamsa**
```bash
# Get fpicker
git clone https://github.com/ttdennis/fpicker
cd fpicker

# Get Frida core devkit and prepare fpicker
wget https://github.com/frida/frida/releases/download/16.1.4/frida-core-devkit-16.1.4-[yourOS]-[yourarchitecture].tar.xz
# e.g. https://github.com/frida/frida/releases/download/16.1.4/frida-core-devkit-16.1.4-macos-arm64.tar.xz
tar -xf ./*tar.xz
cp libfrida-core.a libfrida-core-[yourOS].a #libfrida-core-macos.a

# Install fpicker
make fpicker-[yourOS] # fpicker-macos
# This generates ./fpicker

# Install radamsa (fuzzer generator)
brew install radamsa
```
* **Dosya Sistemi HazÄ±rlÄ±ÄŸÄ±:**
```bash
# From inside fpicker clone
mkdir -p examples/wg-log # Where the fuzzing script will be
mkdir -p examples/wg-log/out # For code coverage and crashes
mkdir -p examples/wg-log/in # For starting inputs

# Create at least 1 input for the fuzzer
echo Hello World > examples/wg-log/in/0
```
* **Fuzzer script** (`examples/wg-log/myfuzzer.js`):

{% code title="examples/wg-log/myfuzzer.js" %}
```javascript
// Import the fuzzer base class
import { Fuzzer } from "../../harness/fuzzer.js";

class WGLogFuzzer extends Fuzzer {

constructor() {
console.log("WGLogFuzzer constructor called")

// Get and declare the function we are going to fuzz
var wg_log_addr = Module.findExportByName("<Program name>", "<func name to fuzz>");
var wg_log_func = new NativeFunction(
wg_log_addr,
"void", ["pointer", "pointer", "pointer"], {
});

// Initialize the object
super("<Program nane>", wg_log_addr, wg_log_func);
this.wg_log_addr = wg_log_addr; // We cannot use "this" before calling "super"

console.log("WGLogFuzzer in the middle");

// Prepare the second argument to pass to the fuzz function
this.tag = Memory.allocUtf8String("arg2");

// Get the first argument we need to pass from a call to the functino we want to fuzz
var wg_log_global_ptr = null;
console.log(this.wg_log_addr);
Interceptor.attach(this.wg_log_addr, {
onEnter: function(args) {
console.log("Entering in the function to get the first argument");
wg_log_global_ptr = new NativePointer(args[0]);
}
});

while (! wg_log_global_ptr) {
Thread.sleep(1)
}
this.wg_log_global_ptr = wg_log_global_ptr;
console.log("WGLogFuzzer prepare ended")
}


// This function is called by the fuzzer with the first argument being a pointer into memory
// where the payload is stored and the second the length of the input.
fuzz(payload, len) {
// Get a pointer to payload being a valid C string (with a null byte at the end)
var payload_cstring = payload.readCString(len);
this.payload = Memory.allocUtf8String(payload_cstring);

// Debug and fuzz
this.debug_log(this.payload, len);
// Pass the 2 first arguments we know the function needs and finally the payload to fuzz
this.target_function(this.wg_log_global_ptr, this.tag, this.payload);
}
}

const f = new WGLogFuzzer();
rpc.exports.fuzzer = f;
```
{% endcode %}

* **Fuzzer'Ä± derleyin**:
```bash
# From inside fpicker clone
## Compile from "myfuzzer.js" to "harness.js"
frida-compile examples/wg-log/myfuzzer.js -o harness.js
```
* **`radamsa`** kullanarak **`fpicker`** fuzzer'Ä±nÄ± Ã§aÄŸÄ±rÄ±n:

{% code overflow="wrap" %}
```bash
# Indicate fpicker to fuzz a program with the harness.js script and which folders to use
fpicker -v --fuzzer-mode active -e attach -p <Program to fuzz> -D usb -o examples/wg-log/out/ -i examples/wg-log/in/ -f harness.js --standalone-mutator cmd --mutator-command "radamsa"
# You can find code coverage and crashes in examples/wg-log/out/
```
{% endcode %}

{% hint style="danger" %}
Bu durumda her bir payload'dan sonra uygulamayÄ± yeniden baÅŸlatmÄ±yor veya durumu geri yÃ¼klemediÄŸimizi belirtmek Ã¶nemlidir. Bu nedenle, Frida bir **Ã§Ã¶kme** bulursa, o payload'dan sonra gelen **sonraki giriÅŸler** uygulamayÄ± Ã§Ã¶kertecek olabilir (Ã§Ã¼nkÃ¼ uygulama kararsÄ±z bir durumdadÄ±r), hatta **giriÅŸ uygulamayÄ± Ã§Ã¶kertmemesi gerekiyor**.

AyrÄ±ca, Frida iOS'un istisna sinyallerine baÄŸlanacak, bu nedenle **Frida bir Ã§Ã¶kme bulduÄŸunda**, muhtemelen bir **iOS Ã§Ã¶kme raporu oluÅŸturulmayacak**.

Bunu Ã¶nlemek iÃ§in Ã¶rneÄŸin, her Frida Ã§Ã¶kmesinden sonra uygulamayÄ± yeniden baÅŸlatabiliriz.
{% endhint %}

### GÃ¼nlÃ¼kler ve Ã‡Ã¶kmeler

macOS gÃ¼nlÃ¼klerini kontrol etmek iÃ§in **macOS konsolunu** veya **`log`** komut satÄ±rÄ±nÄ± kullanabilirsiniz.\
iOS'tan gelen gÃ¼nlÃ¼kleri kontrol etmek iÃ§in **`idevicesyslog`** kullanabilirsiniz.\
BazÄ± gÃ¼nlÃ¼kler, Ã¶zel bilgileri ekleyerek **`<private>`** olarak gÃ¶sterilebilir. TÃ¼m bilgileri gÃ¶stermek iÃ§in [https://developer.apple.com/bug-reporting/profiles-and-logs/](https://developer.apple.com/bug-reporting/profiles-and-logs/) adresinden bazÄ± profilleri yÃ¼klemeniz gerekmektedir.

Ne yapmanÄ±z gerektiÄŸini bilmiyorsanÄ±z:
```sh
vim /Library/Preferences/Logging/com.apple.system.logging.plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>Enable-Private-Data</key>
<true/>
</dict>
</plist>

killall -9 logd
```
Ã‡Ã¶kmeleri aÅŸaÄŸÄ±daki yerlerde kontrol edebilirsiniz: 

- **iOS**
- Ayarlar â†’ Gizlilik â†’ Analitik ve Ä°yileÅŸtirmeler â†’ Analitik Veriler
- `/private/var/mobile/Library/Logs/CrashReporter/`
- **macOS**:
- `/Library/Logs/DiagnosticReports/`
- `~/Library/Logs/DiagnosticReports`

{% hint style="warning" %}
iOS yalnÄ±zca aynÄ± uygulamanÄ±n 25 Ã§Ã¶kmesini saklar, bu yÃ¼zden bunu temizlemeniz gerekiyor aksi takdirde iOS Ã§Ã¶kme oluÅŸturmayÄ± durdurur.
{% endhint %}

## Frida Android Ã–ÄŸreticileri

{% content-ref url="../android-app-pentesting/frida-tutorial/" %}
[frida-tutorial](../android-app-pentesting/frida-tutorial/)
{% endcontent-ref %}

## Referanslar
* [https://www.briskinfosec.com/blogs/blogsdetail/Getting-Started-with-Frida](https://www.briskinfosec.com/blogs/blogsdetail/Getting-Started-with-Frida)

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramanla Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
