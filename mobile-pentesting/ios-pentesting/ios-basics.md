<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

# AyrÄ±calÄ±k AyrÄ±mÄ± ve Kum SandÄ±ÄŸÄ±

iOS'ta, kullanÄ±cÄ± eriÅŸilebilir uygulamalar ile sistem Ã§ekirdeÄŸinin temel iÅŸlemleri arasÄ±nda bir ayrÄ±calÄ±k ayrÄ±mÄ± bulunur. Uygulamalar **`mobile`** kullanÄ±cÄ± kimliÄŸi altÄ±nda Ã§alÄ±ÅŸÄ±rken, Ã¶nemli sistem iÅŸlemleri **`root`** olarak Ã§alÄ±ÅŸÄ±r. Bu ayrÄ±m, uygulamalarÄ±n hangi eylemleri gerÃ§ekleÅŸtirebileceÄŸi konusunda sÄ±kÄ± kÄ±sÄ±tlamalar getiren bir kum sandÄ±ÄŸÄ± mekanizmasÄ± tarafÄ±ndan gÃ¼Ã§lendirilir. Ã–rneÄŸin, uygulamalar aynÄ± kullanÄ±cÄ± kimliÄŸini paylaÅŸsalar bile, birbirlerinin verilerine eriÅŸmeleri veya deÄŸiÅŸtirmeleri yasaktÄ±r.

Uygulamalar belirli bir dizine (`private/var/mobile/Applications/{rastgele ID}`) kurulur ve SMS ve telefon gÃ¶rÃ¼ÅŸmeleri gibi belirli sistem alanlarÄ±na ve iÅŸlevlere sÄ±nÄ±rlÄ± okuma eriÅŸimi vardÄ±r. Korunan alanlara eriÅŸim, kullanÄ±cÄ± izni iÃ§in bir aÃ§Ä±lÄ±r pencere isteÄŸi tetikler.

# Veri Koruma

iOS, veri koruma bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ saÄŸlamak iÃ§in Secure Enclave Processor (SEP) Ã¼zerine inÅŸa edilen **Veri Koruma API'leri** sunar - ÅŸifreleme iÅŸlemleri ve anahtar yÃ¶netimi iÃ§in ayrÄ±lmÄ±ÅŸ bir yardÄ±mcÄ± iÅŸlemci. SEP, iÃ§ine gÃ¶mÃ¼lÃ¼ olan cihaza Ã¶zgÃ¼ bir anahtar olan cihaz UID'si aracÄ±lÄ±ÄŸÄ±yla veri korumasÄ± bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ saÄŸlar.

Bir dosya oluÅŸturulduÄŸunda, dosyanÄ±n iÃ§eriÄŸini ÅŸifreleyen benzersiz bir 256-bit AES ÅŸifreleme anahtarÄ± oluÅŸturulur. Bu ÅŸifreleme anahtarÄ±, bir sÄ±nÄ±f anahtarÄ±yla ÅŸifrelenir ve dosyanÄ±n meta verilerine depolanÄ±r. Bir dosyanÄ±n ÅŸifresini Ã§Ã¶zmek iÃ§in, sistemin anahtarÄ±nÄ± kullanarak meta verilere eriÅŸilir, sÄ±nÄ±f kimliÄŸiyle sÄ±nÄ±f anahtarÄ±nÄ± alÄ±nÄ±r ve ardÄ±ndan dosyanÄ±n benzersiz ÅŸifreleme anahtarÄ± Ã§Ã¶zÃ¼lÃ¼r.

iOS, veri gÃ¼venliÄŸi iÃ§in **dÃ¶rt koruma sÄ±nÄ±fÄ±** tanÄ±mlar, verinin ne zaman ve nasÄ±l eriÅŸilebileceÄŸini belirler:

- **Tam Koruma (NSFileProtectionComplete)**: Veri, kullanÄ±cÄ±nÄ±n ÅŸifresini kullanarak cihazÄ±n kilidini aÃ§ana kadar eriÅŸilemez.
- **AÃ§Ä±k OlmadÄ±kÃ§a Korunan (NSFileProtectionCompleteUnlessOpen)**: Dosya, cihaz kilitlendiÄŸinde bile eriÅŸilebilir, ancak dosya cihaz kilidini aÃ§Ä±ldÄ±ÄŸÄ±nda aÃ§Ä±ldÄ±ysa.
- **Ä°lk KullanÄ±cÄ± Kimlik DoÄŸrulamasÄ±na Kadar Korunan (NSFileProtectionCompleteUntilFirstUserAuthentication)**: Veri, ilk kullanÄ±cÄ± aÃ§Ä±lÄ±ÅŸÄ±ndan sonra yapÄ±lan ilk kullanÄ±cÄ± kimlik doÄŸrulamasÄ±ndan sonra eriÅŸilebilir hale gelir ve cihaz tekrar kilitlense bile eriÅŸilebilir kalÄ±r.
- **Koruma Yok (NSFileProtectionNone)**: Veri, cihaz UID'si tarafÄ±ndan korunur ve hÄ±zlÄ± uzaktan veri silmeyi kolaylaÅŸtÄ±rÄ±r.

`NSFileProtectionNone` hariÃ§ tÃ¼m sÄ±nÄ±flarÄ±n ÅŸifrelemesi, cihaz UID'si ve kullanÄ±cÄ±nÄ±n ÅŸifresinden tÃ¼retilen bir anahtarla yapÄ±lÄ±r, bÃ¶ylece doÄŸru ÅŸifreyle sadece cihazda Ã§Ã¶zme mÃ¼mkÃ¼n olur. iOS 7'den itibaren, varsayÄ±lan koruma sÄ±nÄ±fÄ± "Ä°lk KullanÄ±cÄ± Kimlik DoÄŸrulamasÄ±na Kadar Korunan" olarak belirlenmiÅŸtir.

GeliÅŸtiriciler, bir iPhone'daki dosyalarÄ±n veri koruma sÄ±nÄ±fÄ±nÄ± incelemek iÃ§in [**FileDP**](https://github.com/abjurato/FileDp-Source) adlÄ± bir araÃ§ kullanabilirler.
```python
# Example code to use FileDP for checking file protection class
# Note: Ensure your device is jailbroken and has Python installed to use FileDP.
# Installation and usage of FileDP:
git clone https://github.com/abjurato/FileDp-Source
cd FileDp-Source
python filedp.py /path/to/check
```
## **Anahtar Zinciri**

iOS'ta, bir **Anahtar Zinciri**, yalnÄ±zca onu depolayan uygulama veya aÃ§Ä±kÃ§a yetkilendirilenler tarafÄ±ndan eriÅŸilebilen **hassas bilgilerin** gÃ¼venli bir **ÅŸifrelenmiÅŸ konteyner** olarak hizmet eder. Bu ÅŸifreleme, iOS tarafÄ±ndan oluÅŸturulan benzersiz bir **ÅŸifre** tarafÄ±ndan gÃ¼Ã§lendirilir ve kendisi **AES** ile ÅŸifrelenir. Bu ÅŸifreleme iÅŸlemi, kullanÄ±cÄ±nÄ±n parolasÄ±nÄ± cihazÄ±n **UID**'den tÃ¼retilen bir tuzla birleÅŸtiren bir **PBKDF2 iÅŸlevi** kullanÄ±r ve yalnÄ±zca **gÃ¼venli kripto birimi yongasÄ±**'nÄ±n eriÅŸebileceÄŸi bir bileÅŸendir. SonuÃ§ olarak, kullanÄ±cÄ±nÄ±n parolasÄ± bilinse bile, Anahtar Zinciri iÃ§eriÄŸi yalnÄ±zca orijinal olarak ÅŸifrelendiÄŸi cihaz dÄ±ÅŸÄ±nda hiÃ§bir cihazda eriÅŸilemez kalÄ±r.

Anahtar Zinciri verilerinin **yÃ¶netimi ve eriÅŸimi**, `Keychain-access-groups` ve `application-identifier` gibi belirli uygulama yetkilendirmelerine dayalÄ± olarak **`securityd` hizmeti** tarafÄ±ndan ele alÄ±nÄ±r.

### **Anahtar Zinciri API Ä°ÅŸlemleri**

Anahtar Zinciri API'si, [Apple'Ä±n Anahtar Zinciri Hizmetleri belgelerinde](https://developer.apple.com/library/content/documentation/Security/Conceptual/keychainServConcepts/02concepts/concepts.html) ayrÄ±ntÄ±lÄ± olarak aÃ§Ä±klanan gÃ¼venli depolama yÃ¶netimi iÃ§in temel iÅŸlevleri saÄŸlar:

- **`SecItemAdd`**: Anahtar Zinciri'ne yeni bir Ã¶ÄŸe ekler.
- **`SecItemUpdate`**: Anahtar Zinciri'ndeki mevcut bir Ã¶ÄŸeyi gÃ¼nceller.
- **`SecItemCopyMatching`**: Anahtar Zinciri'nden bir Ã¶ÄŸe alÄ±r.
- **`SecItemDelete`**: Anahtar Zinciri'nden bir Ã¶ÄŸeyi kaldÄ±rÄ±r.

Anahtar Zinciri parolasÄ±nÄ± kaba kuvvet saldÄ±rÄ±sÄ±yla Ã§Ã¶zmek, ÅŸifrelenmiÅŸ anahtara doÄŸrudan saldÄ±rmak veya cihazdaki parolayÄ± tahmin etmeye Ã§alÄ±ÅŸmak anlamÄ±na gelir, ancak gÃ¼venli kripto birimi yongasÄ±nÄ±n baÅŸarÄ±sÄ±z denemeler arasÄ±nda bir gecikme uygulamasÄ± nedeniyle Ã¶nemli Ã¶lÃ§Ã¼de zorlaÅŸÄ±r.

### **Anahtar Zinciri Ã–ÄŸe Veri KorumasÄ±nÄ± YapÄ±landÄ±rma**

Anahtar Zinciri Ã¶ÄŸelerinin veri koruma seviyeleri, Ã¶ÄŸe oluÅŸturma veya gÃ¼ncelleme sÄ±rasÄ±nda `kSecAttrAccessible` Ã¶zniteliÄŸi kullanÄ±larak ayarlanÄ±r. Bu seviyeler, [Apple tarafÄ±ndan belirtilen](https://developer.apple.com/documentation/security/keychain_services/keychain_items/item_attribute_keys_and_values#1679100) ÅŸekilde, Anahtar Zinciri Ã¶ÄŸelerinin ne zaman ve nasÄ±l eriÅŸilebilir olduÄŸunu belirler:

- **`kSecAttrAccessibleAlways`**: Her zaman eriÅŸilebilir, cihaz kilidi durumundan baÄŸÄ±msÄ±z olarak.
- **`kSecAttrAccessibleAlwaysThisDeviceOnly`**: Her zaman eriÅŸilebilir, ancak yedeklemelere dahil edilmez.
- **`kSecAttrAccessibleAfterFirstUnlock`**: Ä°lk yeniden baÅŸlatmadan sonra eriÅŸilebilir.
- **`kSecAttrAccessibleAfterFirstUnlockThisDeviceOnly`**: YukarÄ±dakiyle aynÄ±, ancak yeni cihazlara aktarÄ±lamaz.
- **`kSecAttrAccessibleWhenUnlocked`**: YalnÄ±zca cihaz kilidinin aÃ§Ä±k olduÄŸu durumlarda eriÅŸilebilir.
- **`kSecAttrAccessibleWhenUnlockedThisDeviceOnly`**: Kilidi aÃ§Ä±k olduÄŸunda eriÅŸilebilir, yedeklemelere dahil edilmez.
- **`kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly`**: Cihaz parolasÄ± gerektirir, yedeklemelere dahil edilmez.

**`AccessControlFlags`**, biyometrik kimlik doÄŸrulama veya parola kullanÄ±mÄ±na izin vererek eriÅŸim yÃ¶ntemlerini daha da geliÅŸtirir.

### **Jailbreakli Cihaz UyarÄ±sÄ±**

{% hint style="warning" %}
**Jailbreakli cihazlarda**, Anahtar Zinciri'nin korumalarÄ± tehlikeye girer ve Ã¶nemli bir gÃ¼venlik riski oluÅŸturur.
{% endhint %}

### **Anahtar Zinciri Verilerinin KalÄ±cÄ±lÄ±ÄŸÄ±**

Uygulama kaldÄ±rÄ±ldÄ±ÄŸÄ±nda uygulama Ã¶zel verilerinin silinmesinin aksine, **Anahtar Zinciri verileri** cihazda kalÄ±cÄ±dÄ±r. Bu Ã¶zellik, ikinci el bir cihazÄ±n yeni sahiplerinin uygulama verilerine Ã¶nceki sahibin sadece uygulamalarÄ± yeniden yÃ¼kleyerek eriÅŸmesine olanak tanÄ±yabilir. GeliÅŸtiricilere, bu riski azaltmak iÃ§in uygulama yÃ¼kleme sÄ±rasÄ±nda veya oturumu kapatma sÄ±rasÄ±nda proaktif olarak Anahtar Zinciri verilerini temizlemeleri Ã¶nerilir. Ä°ÅŸte Anahtar Zinciri verilerini ilk uygulama baÅŸlatmasÄ±nda nasÄ±l temizleyeceÄŸinizi gÃ¶steren bir Swift kodu Ã¶rneÄŸi:
```swift
let userDefaults = UserDefaults.standard

if userDefaults.bool(forKey: "hasRunBefore") == false {
// Remove Keychain items here

// Update the flag indicator
userDefaults.set(true, forKey: "hasRunBefore")
userDefaults.synchronize() // Forces the app to update UserDefaults
}
```
# **Uygulama Yetenekleri**

Uygulama geliÅŸtirme alanÄ±nda, **sandboxing** gÃ¼venliÄŸi artÄ±rmada Ã¶nemli bir rol oynar. Bu sÃ¼reÃ§, her uygulamanÄ±n kendi benzersiz ana dizininde Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlayarak, sistem dosyalarÄ±na veya diÄŸer uygulamalara ait verilere eriÅŸmesini engeller. Bu kÄ±sÄ±tlamalarÄ±n uygulanmasÄ±, **Trusted BSD (MAC) Mandatory Access Control Framework**'Ã¼n bir parÃ§asÄ± olan sandbox politikalarÄ± aracÄ±lÄ±ÄŸÄ±yla gerÃ§ekleÅŸtirilir.

GeliÅŸtiriciler, uygulamalarÄ± iÃ§in **Veri Koruma** veya **Anahtar Zinciri PaylaÅŸÄ±mÄ±** gibi belirli **yetenekler veya izinler** yapÄ±landÄ±rma yeteneÄŸine sahiptir. Bu izinler, uygulama yÃ¼klendikten hemen sonra uygulanÄ±r. Bununla birlikte, belirli korumalÄ± kaynaklara eriÅŸmek iÃ§in uygulamanÄ±n ilk denemede kullanÄ±cÄ±dan aÃ§Ä±k onay almasÄ± gerekmektedir. Bu, kullanÄ±cÄ±lara izin isteÄŸi uyarÄ±sÄ±nda sunulan _amaÃ§ dizeleri_ veya _kullanÄ±m aÃ§Ä±klama dizeleri_ kullanÄ±larak gerÃ§ekleÅŸtirilir.

Kaynak koduna eriÅŸimi olanlar iÃ§in, `Info.plist` dosyasÄ±nda bulunan izinlerin doÄŸrulanmasÄ± ÅŸu adÄ±mlarla yapÄ±labilir:

1. Xcode'da projeyi aÃ§ma.
2. `Info.plist` dosyasÄ±nÄ± bulma ve aÃ§ma.
3. Netlik iÃ§in, `"Privacy -"` ile baÅŸlayan anahtarlarÄ±/deÄŸerleri gÃ¶rÃ¼ntÃ¼leme seÃ§eneÄŸiyle arama.

IPA dosyasÄ±yla uÄŸraÅŸÄ±rken, aÅŸaÄŸÄ±daki adÄ±mlar izlenebilir:

1. IPA dosyasÄ±nÄ± aÃ§ma.
2. `Payload/<uygulamaadÄ±>.app/` iÃ§indeki `Info.plist` dosyasÄ±nÄ± bulma.
3. Ä°ncelemeyi kolaylaÅŸtÄ±rmak iÃ§in dosyayÄ± XML formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼rme gerekiyorsa dÃ¶nÃ¼ÅŸtÃ¼rme.

Ã–rneÄŸin, `Info.plist` dosyasÄ±ndaki amaÃ§ dizeleri ÅŸu ÅŸekilde olabilir:
```xml
<plist version="1.0">
<dict>
<key>NSLocationWhenInUseUsageDescription</key>
<string>Your location is used to provide turn-by-turn directions to your destination.</string>
```
## Cihaz Yetenekleri
Bir uygulamanÄ±n `Info.plist` dosyasÄ±, App Store'un cihaz uyumluluÄŸuna gÃ¶re uygulamalarÄ± filtrelemesine yardÄ±mcÄ± olan **cihaz yeteneklerini** belirtir. Bunlar **`UIRequiredDeviceCapabilities`** anahtarÄ± altÄ±nda tanÄ±mlanÄ±r. Ã–rneÄŸin:
```xml
<key>UIRequiredDeviceCapabilities</key>
<array>
<string>armv7</string>
</array>
```
Bu Ã¶rnek, uygulamanÄ±n armv7 komut kÃ¼mesiyle uyumlu olduÄŸunu gÃ¶stermektedir. GeliÅŸtiriciler, NFC'yi destekleyen cihazlara sadece uygulamanÄ±n eriÅŸilebilir olmasÄ±nÄ± saÄŸlamak iÃ§in nfc gibi yetenekleri de belirtebilirler.

## Yetkilendirmeler

**Yetkilendirmeler**, iOS uygulama geliÅŸtirmede baÅŸka bir Ã¶nemli unsurdur ve Ã§alÄ±ÅŸma zamanÄ± denetimlerinin Ã¶tesinde uygulamalara belirli iÅŸlemleri gerÃ§ekleÅŸtirme izni veren anahtar-deÄŸer Ã§iftleri olarak hizmet eder. Ã–rneÄŸin, bir uygulamada **Veri Koruma**'yÄ± etkinleÅŸtirmek, Xcode projesine belirli bir yetkilendirme eklemeyi gerektirir ve bu daha sonra uygulamanÄ±n yetkilendirme dosyasÄ±nda veya IPAlar iÃ§in gÃ¶mÃ¼lÃ¼ mobil saÄŸlama dosyasÄ±nda yansÄ±tÄ±lÄ±r.


# Referanslar
* [https://mas.owasp.org/MASTG/iOS/0x06d-Testing-Data-Storage](https://mas.owasp.org/MASTG/iOS/0x06d-Testing-Data-Storage)
* [https://github.com/OWASP/owasp-mastg/blob/master/Document/0x06h-Testing-Platform-Interaction.md](https://github.com/OWASP/owasp-mastg/blob/master/Document/0x06h-Testing-Platform-Interaction.md)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0069/](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0069/)
* [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/)



<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki Ã¶zel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
