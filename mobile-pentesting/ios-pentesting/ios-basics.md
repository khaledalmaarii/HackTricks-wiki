{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

# AyrÄ±calÄ±k AyrÄ±mÄ± ve Sandbox

iOS'ta, kullanÄ±cÄ± eriÅŸimine aÃ§Ä±k uygulamalar ile sistemin temel sÃ¼reÃ§leri arasÄ±nda bir ayrÄ±calÄ±k ayrÄ±mÄ± vardÄ±r. Uygulamalar **`mobile`** kullanÄ±cÄ± kimliÄŸi altÄ±nda Ã§alÄ±ÅŸÄ±rken, kritik sistem sÃ¼reÃ§leri **`root`** olarak Ã§alÄ±ÅŸÄ±r. Bu ayrÄ±m, uygulamalarÄ±n gerÃ§ekleÅŸtirebileceÄŸi eylemler Ã¼zerinde katÄ± sÄ±nÄ±rlamalar getiren bir sandbox mekanizmasÄ± ile gÃ¼Ã§lendirilmiÅŸtir. Ã–rneÄŸin, uygulamalar aynÄ± kullanÄ±cÄ± kimliÄŸini paylaÅŸsalar bile, birbirlerinin verilerine eriÅŸmeleri veya bunlarÄ± deÄŸiÅŸtirmeleri yasaktÄ±r.

Uygulamalar belirli bir dizine (`private/var/mobile/Applications/{random ID}`) yÃ¼klenir ve SMS ve telefon gÃ¶rÃ¼ÅŸmeleri gibi belirli sistem alanlarÄ±na ve iÅŸlevlerine sÄ±nÄ±rlÄ± okuma eriÅŸimine sahiptir. Korunan alanlara eriÅŸim, kullanÄ±cÄ± izni iÃ§in bir pop-up isteÄŸi tetikler.

# Veri Koruma

iOS, geliÅŸtiricilere **Veri Koruma API'leri** sunar; bu API'ler, kriptografik iÅŸlemler ve anahtar yÃ¶netimi iÃ§in Ã¶zel bir yardÄ±mcÄ± iÅŸlemci olan Secure Enclave Processor (SEP) Ã¼zerine inÅŸa edilmiÅŸtir. SEP, iÃ§inde yer alan cihaz UID'si ile birlikte, cihaz koruma bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ saÄŸlar.

Dosya oluÅŸturulduÄŸunda, dosyanÄ±n iÃ§eriÄŸini ÅŸifreleyen benzersiz bir 256-bit AES ÅŸifreleme anahtarÄ± Ã¼retilir. Bu ÅŸifreleme anahtarÄ±, bir sÄ±nÄ±f kimliÄŸi ile birlikte, bir sÄ±nÄ±f anahtarÄ± kullanÄ±larak ÅŸifrelenir ve dosyanÄ±n meta verileri iÃ§inde saklanÄ±r. Bir dosyayÄ± ÅŸifre Ã§Ã¶zmek, sistemin anahtarÄ±nÄ± kullanarak meta verilere eriÅŸmeyi, sÄ±nÄ±f kimliÄŸi ile sÄ±nÄ±f anahtarÄ±nÄ± almayÄ± ve ardÄ±ndan dosyanÄ±n benzersiz ÅŸifreleme anahtarÄ±nÄ± Ã§Ã¶zmeyi iÃ§erir.

iOS, veri gÃ¼venliÄŸi iÃ§in **dÃ¶rt koruma sÄ±nÄ±fÄ±** tanÄ±mlar; bu sÄ±nÄ±flar, verilerin ne zaman ve nasÄ±l eriÅŸilebileceÄŸini belirler:

- **Tam Koruma (NSFileProtectionComplete)**: Veri, cihaz kullanÄ±cÄ±nÄ±n ÅŸifresi ile kilidi aÃ§Ä±lana kadar eriÅŸilemez.
- **AÃ§Ä±k OlmadÄ±kÃ§a Koruma (NSFileProtectionCompleteUnlessOpen)**: Cihaz kilitli olsa bile, dosya aÃ§Ä±ldÄ±ÄŸÄ±nda eriÅŸime izin verir.
- **Ä°lk KullanÄ±cÄ± Kimlik DoÄŸrulamasÄ±na Kadar Koruma (NSFileProtectionCompleteUntilFirstUserAuthentication)**: Veri, cihazÄ±n ilk aÃ§Ä±lÄ±ÅŸÄ±ndan sonra eriÅŸilebilir, cihaz tekrar kilitlense bile eriÅŸim devam eder.
- **Koruma Yok (NSFileProtectionNone)**: Veri yalnÄ±zca cihaz UID'si ile korunur, hÄ±zlÄ± uzaktan veri silmeyi kolaylaÅŸtÄ±rÄ±r.

`NSFileProtectionNone` dÄ±ÅŸÄ±ndaki tÃ¼m sÄ±nÄ±flarÄ±n ÅŸifrelemesi, hem cihaz UID'sinden hem de kullanÄ±cÄ±nÄ±n ÅŸifresinden tÃ¼retilen bir anahtar iÃ§erir; bu, ÅŸifre Ã§Ã¶zmenin yalnÄ±zca doÄŸru ÅŸifreye sahip cihazda mÃ¼mkÃ¼n olmasÄ±nÄ± saÄŸlar. iOS 7'den itibaren, varsayÄ±lan koruma sÄ±nÄ±fÄ± "Ä°lk KullanÄ±cÄ± Kimlik DoÄŸrulamasÄ±na Kadar Koruma"dÄ±r.

GeliÅŸtiriciler, bir iPhone'daki dosyalarÄ±n veri koruma sÄ±nÄ±fÄ±nÄ± incelemek iÃ§in [**FileDP**](https://github.com/abjurato/FileDp-Source) adlÄ± aracÄ± kullanabilirler.
```python
# Example code to use FileDP for checking file protection class
# Note: Ensure your device is jailbroken and has Python installed to use FileDP.
# Installation and usage of FileDP:
git clone https://github.com/abjurato/FileDp-Source
cd FileDp-Source
python filedp.py /path/to/check
```
## **Anahtar Zinciri**

iOS'ta, bir **Anahtar Zinciri**, yalnÄ±zca onu depolayan uygulama veya aÃ§Ä±kÃ§a yetkilendirilmiÅŸ olanlar tarafÄ±ndan eriÅŸilebilen **hassas bilgileri** depolamak iÃ§in gÃ¼venli bir **ÅŸifreli konteyner** olarak hizmet eder. Bu ÅŸifreleme, iOS tarafÄ±ndan Ã¼retilen benzersiz bir **ÅŸifre** ile gÃ¼Ã§lendirilmiÅŸtir ve bu ÅŸifre **AES** ile ÅŸifrelenmiÅŸtir. Bu ÅŸifreleme sÃ¼reci, kullanÄ±cÄ±nÄ±n ÅŸifresini bir cihazÄ±n **UID**'sinden tÃ¼retilen bir tuz ile birleÅŸtiren bir **PBKDF2 fonksiyonu** kullanÄ±r; bu bileÅŸen yalnÄ±zca **gÃ¼venli enclave yongasÄ±** tarafÄ±ndan eriÅŸilebilir. SonuÃ§ olarak, kullanÄ±cÄ±nÄ±n ÅŸifresi bilinse bile, Anahtar Zinciri iÃ§eriÄŸi yalnÄ±zca orijinal olarak ÅŸifrelendiÄŸi cihaz dÄ±ÅŸÄ±nda herhangi bir cihazda eriÅŸilemez durumda kalÄ±r.

Anahtar Zinciri verilerine **yÃ¶netim ve eriÅŸim**, `Keychain-access-groups` ve `application-identifier` gibi belirli uygulama yetkilerine dayanan **`securityd` daemon** tarafÄ±ndan yÃ¶netilmektedir.

### **Anahtar Zinciri API Ä°ÅŸlemleri**

Anahtar Zinciri API'si, [Apple'Ä±n Anahtar Zinciri Hizmetleri belgelerinde](https://developer.apple.com/library/content/documentation/Security/Conceptual/keychainServConcepts/02concepts/concepts.html) detaylandÄ±rÄ±lmÄ±ÅŸtÄ±r ve gÃ¼venli depolama yÃ¶netimi iÃ§in temel iÅŸlevler sunar:

- **`SecItemAdd`**: Anahtar Zincirine yeni bir Ã¶ÄŸe ekler.
- **`SecItemUpdate`**: Anahtar Zincirindeki mevcut bir Ã¶ÄŸeyi gÃ¼nceller.
- **`SecItemCopyMatching`**: Anahtar Zincirinden bir Ã¶ÄŸe alÄ±r.
- **`SecItemDelete`**: Anahtar Zincirinden bir Ã¶ÄŸeyi kaldÄ±rÄ±r.

Anahtar Zinciri ÅŸifresini zorlamak, ya ÅŸifrelenmiÅŸ anahtara doÄŸrudan saldÄ±rmayÄ± ya da cihazda ÅŸifreyi tahmin etmeyi iÃ§erir; bu, gÃ¼venli enclave'in baÅŸarÄ±sÄ±z denemeler arasÄ±nda bir gecikme uygulamasÄ±yla Ã¶nemli Ã¶lÃ§Ã¼de engellenir.

### **Anahtar Zinciri Ã–ÄŸesi Veri Koruma YapÄ±landÄ±rmasÄ±**

Anahtar Zinciri Ã¶ÄŸeleri iÃ§in veri koruma seviyeleri, Ã¶ÄŸe oluÅŸturma veya gÃ¼ncelleme sÄ±rasÄ±nda `kSecAttrAccessible` niteliÄŸi kullanÄ±larak ayarlanÄ±r. Bu seviyeler, [Apple tarafÄ±ndan belirtilen](https://developer.apple.com/documentation/security/keychain_services/keychain_items/item_attribute_keys_and_values#1679100) Anahtar Zinciri Ã¶ÄŸelerinin ne zaman ve nasÄ±l eriÅŸilebilir olduÄŸunu belirler:

- **`kSecAttrAccessibleAlways`**: Cihaz kilit durumu ne olursa olsun her zaman eriÅŸilebilir.
- **`kSecAttrAccessibleAlwaysThisDeviceOnly`**: Her zaman eriÅŸilebilir, ancak yedeklemelere dahil edilmez.
- **`kSecAttrAccessibleAfterFirstUnlock`**: Yeniden baÅŸlatmadan sonra ilk aÃ§Ä±lÄ±ÅŸta eriÅŸilebilir.
- **`kSecAttrAccessibleAfterFirstUnlockThisDeviceOnly`**: YukarÄ±dakiyle aynÄ±, ancak yeni cihazlara aktarÄ±lmaz.
- **`kSecAttrAccessibleWhenUnlocked`**: Cihaz aÃ§Ä±kken yalnÄ±zca eriÅŸilebilir.
- **`kSecAttrAccessibleWhenUnlockedThisDeviceOnly`**: AÃ§Ä±kken eriÅŸilebilir, yedeklemelere dahil edilmez.
- **`kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly`**: Cihaz ÅŸifresi gerektirir, yedeklemelere dahil edilmez.

**`AccessControlFlags`** eriÅŸim yÃ¶ntemlerini daha da rafine eder, biyometrik kimlik doÄŸrulama veya ÅŸifre kullanÄ±mÄ± saÄŸlar.

### **Jailbroken Cihazlar UyarÄ±sÄ±**

{% hint style="warning" %}
**Jailbroken cihazlarda**, Anahtar Zinciri'nin korumalarÄ± tehlikeye girer ve Ã¶nemli bir gÃ¼venlik riski oluÅŸturur.
{% endhint %}

### **Anahtar Zinciri Verilerinin SÃ¼rekliliÄŸi**

Uygulama kaldÄ±rÄ±ldÄ±ÄŸÄ±nda silinen uygulama Ã¶zel verilerinin aksine, **Anahtar Zinciri verileri** cihazda kalÄ±r. Bu Ã¶zellik, ikinci el bir cihazÄ±n yeni sahiplerinin, uygulamalarÄ± yeniden yÃ¼kleyerek Ã¶nceki sahibin uygulama verilerine eriÅŸim saÄŸlamasÄ±na olanak tanÄ±yabilir. GeliÅŸtiricilerin, bu riski azaltmak iÃ§in uygulama kurulumu sÄ±rasÄ±nda veya Ã§Ä±kÄ±ÅŸ yaparken Anahtar Zinciri verilerini proaktif olarak temizlemeleri Ã¶nerilir. Ä°ÅŸte ilk uygulama aÃ§Ä±lÄ±ÅŸÄ±nda Anahtar Zinciri verilerini temizlemeyi gÃ¶steren bir Swift kod Ã¶rneÄŸi:
```swift
let userDefaults = UserDefaults.standard

if userDefaults.bool(forKey: "hasRunBefore") == false {
// Remove Keychain items here

// Update the flag indicator
userDefaults.set(true, forKey: "hasRunBefore")
userDefaults.synchronize() // Forces the app to update UserDefaults
}
```
# **Uygulama Yetenekleri**

Uygulama geliÅŸtirme alanÄ±nda, **sandboxing** gÃ¼venliÄŸi artÄ±rmada kritik bir rol oynamaktadÄ±r. Bu sÃ¼reÃ§, her uygulamanÄ±n kendi benzersiz ana dizininde Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlar ve bÃ¶ylece sistem dosyalarÄ±na veya diÄŸer uygulamalara ait verilere eriÅŸimini engeller. Bu kÄ±sÄ±tlamalarÄ±n uygulanmasÄ±, **Trusted BSD (MAC) Mandatory Access Control Framework**'Ã¼n bir parÃ§asÄ± olan sandbox politikalarÄ± aracÄ±lÄ±ÄŸÄ±yla gerÃ§ekleÅŸtirilir.

GeliÅŸtiriciler, uygulamalarÄ± iÃ§in **Data Protection** veya **Keychain Sharing** gibi belirli **yetenekler veya izinler** yapÄ±landÄ±rma yeteneÄŸine sahiptir. Bu izinler, uygulama yÃ¼klendikten hemen sonra uygulanÄ±r. Ancak, belirli korunan kaynaklara eriÅŸim iÃ§in uygulamanÄ±n, ilk deneme sÄ±rasÄ±nda kullanÄ±cÄ±dan aÃ§Ä±k onay almasÄ± gerekmektedir. Bu, kullanÄ±cÄ±lara bir izin talep uyarÄ±sÄ±nda sunulan _amaÃ§ dizeleri_ veya _kullanÄ±m aÃ§Ä±klama dizeleri_ aracÄ±lÄ±ÄŸÄ±yla gerÃ§ekleÅŸtirilir.

Kaynak koduna eriÅŸimi olanlar iÃ§in, `Info.plist` dosyasÄ±ndaki izinlerin doÄŸrulanmasÄ± ÅŸu ÅŸekilde yapÄ±labilir:

1. Projeyi Xcode'da aÃ§Ä±n.
2. `Info.plist` dosyasÄ±nÄ± bulun ve aÃ§Ä±n.
3. AÃ§Ä±klÄ±k iÃ§in `"Privacy -"` ile baÅŸlayan anahtarlarÄ± arayÄ±n ve ham anahtar/deÄŸerleri gÃ¶rÃ¼ntÃ¼leme seÃ§eneÄŸini kullanÄ±n.

Bir IPA dosyasÄ± ile Ã§alÄ±ÅŸÄ±rken, aÅŸaÄŸÄ±daki adÄ±mlar izlenebilir:

1. IPA dosyasÄ±nÄ± aÃ§Ä±n.
2. `Payload/<appname>.app/` iÃ§inde `Info.plist` dosyasÄ±nÄ± bulun.
3. Gerekirse, dosyayÄ± daha kolay inceleme iÃ§in XML formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼rÃ¼n.

Ã–rneÄŸin, `Info.plist` dosyasÄ±ndaki amaÃ§ dizeleri ÅŸu ÅŸekilde gÃ¶rÃ¼nebilir:
```xml
<plist version="1.0">
<dict>
<key>NSLocationWhenInUseUsageDescription</key>
<string>Your location is used to provide turn-by-turn directions to your destination.</string>
```
## Device Capabilities
Bir uygulamanÄ±n `Info.plist` dosyasÄ±, App Store'un uygulamalarÄ± cihaz uyumluluÄŸu iÃ§in filtrelemesine yardÄ±mcÄ± olan **cihaz yeteneklerini** belirtir. Bunlar **`UIRequiredDeviceCapabilities`** anahtarÄ± altÄ±nda tanÄ±mlanÄ±r. Ã–rneÄŸin:
```xml
<key>UIRequiredDeviceCapabilities</key>
<array>
<string>armv7</string>
</array>
```
Bu Ã¶rnek, uygulamanÄ±n armv7 talimat seti ile uyumlu olduÄŸunu gÃ¶stermektedir. GeliÅŸtiriciler, uygulamalarÄ±nÄ±n yalnÄ±zca NFC'yi destekleyen cihazlarda kullanÄ±labilir olmasÄ±nÄ± saÄŸlamak iÃ§in nfc gibi yetenekleri de belirtebilirler.

## Yetkiler

**Yetkiler**, iOS uygulama geliÅŸtirmesinin bir diÄŸer kritik yÃ¶nÃ¼dÃ¼r ve uygulamalara Ã§alÄ±ÅŸma zamanÄ± kontrollerinin Ã¶tesinde belirli iÅŸlemleri gerÃ§ekleÅŸtirme izni veren anahtar-deÄŸer Ã§iftleri olarak hizmet eder. Ã–rneÄŸin, bir uygulamada **Veri KorumasÄ±**nÄ± etkinleÅŸtirmek, Xcode projesine belirli bir yetki eklemeyi iÃ§erir; bu, uygulamanÄ±n yetki dosyasÄ±nda veya IPA'lar iÃ§in gÃ¶mÃ¼lÃ¼ mobil saÄŸlama dosyasÄ±nda yansÄ±tÄ±lÄ±r.


# Referanslar
* [https://mas.owasp.org/MASTG/iOS/0x06d-Testing-Data-Storage](https://mas.owasp.org/MASTG/iOS/0x06d-Testing-Data-Storage)
* [https://github.com/OWASP/owasp-mastg/blob/master/Document/0x06h-Testing-Platform-Interaction.md](https://github.com/OWASP/owasp-mastg/blob/master/Document/0x06h-Testing-Platform-Interaction.md)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0069/](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0069/)
* [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/)



{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
