# iOS Custom URI Handlers / Deeplinks / Custom Schemes

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

ã‚«ã‚¹ã‚¿ãƒ URLã‚¹ã‚­ãƒ¼ãƒ ã¯ã€ã‚¢ãƒ—ãƒªãŒã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦é€šä¿¡ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚è©³ç´°ã¯[Apple Developer Documentation](https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple\_ref/doc/uid/TP40007072-CH6-SW1)ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¹ã‚­ãƒ¼ãƒ ã¯ã‚¢ãƒ—ãƒªã«ã‚ˆã£ã¦å®£è¨€ã•ã‚Œã€ã‚¢ãƒ—ãƒªã¯ãã®ã‚¹ã‚­ãƒ¼ãƒ ã«å¾“ã£ã¦å—ä¿¡ã—ãŸURLã‚’å‡¦ç†ã—ã¾ã™ã€‚ã™ã¹ã¦ã®URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’**æ¤œè¨¼ã—**ã€**ä¸æ­£ãªURLã‚’ç ´æ£„ã™ã‚‹**ã“ã¨ãŒé‡è¦ã§ã™ã€‚ã“ã®ãƒ™ã‚¯ã‚¿ãƒ¼ã‚’é€šã˜ãŸæ”»æ’ƒã‚’é˜²ããŸã‚ã§ã™ã€‚

ä¾‹ã¨ã—ã¦ã€URI `myapp://hostname?data=123876123` ãŒç‰¹å®šã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚æ³¨ç›®ã™ã¹ãè„†å¼±æ€§ã¯ã€Skype Mobileã‚¢ãƒ—ãƒªã«ã‚ã‚Šã€`skype://`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä»‹ã—ã¦è¨±å¯ã•ã‚Œã¦ã„ãªã„é€šè©±ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¯èƒ½ã«ã—ã¾ã—ãŸã€‚ç™»éŒ²ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒ ã¯ã€ã‚¢ãƒ—ãƒªã®`Info.plist`ã®`CFBundleURLTypes`ã«ã‚ã‚Šã¾ã™ã€‚æ‚ªæ„ã®ã‚ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€URIã‚’å†ç™»éŒ²ã™ã‚‹ã“ã¨ã§æ©Ÿå¯†æƒ…å ±ã‚’å‚å—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ã‚¨ãƒªã‚¹ã‚­ãƒ¼ãƒ ã®ç™»éŒ²

iOS 9.0ä»¥é™ã€ã‚¢ãƒ—ãƒªãŒåˆ©ç”¨å¯èƒ½ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€`canOpenURL:`ã¯`Info.plist`ã®`LSApplicationQueriesSchemes`ã«URLã‚¹ã‚­ãƒ¼ãƒ ã‚’å®£è¨€ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªãŒã‚¯ã‚¨ãƒªã§ãã‚‹ã‚¹ã‚­ãƒ¼ãƒ ã¯50ã«åˆ¶é™ã•ã‚Œã€ã‚¢ãƒ—ãƒªã®åˆ—æŒ™ã‚’é˜²ãã“ã¨ã§ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãŒå‘ä¸Šã—ã¾ã™ã€‚
```xml
<key>LSApplicationQueriesSchemes</key>
<array>
<string>url_scheme1</string>
<string>url_scheme2</string>
</array>
```
### URLå‡¦ç†ã¨æ¤œè¨¼ã®ãƒ†ã‚¹ãƒˆ

é–‹ç™ºè€…ã¯ã€`application:didFinishLaunchingWithOptions:`ã‚„`application:openURL:options:`ãªã©ã€URLãƒ‘ã‚¹ã®æ§‹ç¯‰ã¨æ¤œè¨¼ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ç‰¹å®šã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ¤œæŸ»ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€Telegramã¯URLã‚’é–‹ããŸã‚ã«ã•ã¾ã–ã¾ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ï¼š
```swift
func application(_ application: UIApplication, open url: URL, sourceApplication: String?) -> Bool {
self.openUrl(url: url)
return true
}

func application(_ application: UIApplication, open url: URL, sourceApplication: String?,
annotation: Any) -> Bool {
self.openUrl(url: url)
return true
}

func application(_ app: UIApplication, open url: URL,
options: [UIApplicationOpenURLOptionsKey : Any] = [:]) -> Bool {
self.openUrl(url: url)
return true
}

func application(_ application: UIApplication, handleOpen url: URL) -> Bool {
self.openUrl(url: url)
return true
}
```
### ä»–ã®ã‚¢ãƒ—ãƒªã¸ã®URLãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆ

`openURL:options:completionHandler:`ã®ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ä»–ã®ã‚¢ãƒ—ãƒªã¨å¯¾è©±ã™ã‚‹ãŸã‚ã«URLã‚’é–‹ãã®ã«é‡è¦ã§ã™ã€‚ã‚¢ãƒ—ãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…ã§ãã®ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã®ä½¿ç”¨ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ã¯ã€å¤–éƒ¨é€šä¿¡ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®éµã§ã™ã€‚

### éæ¨å¥¨ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆ

`application:handleOpenURL:`ã‚„`openURL:`ã®ã‚ˆã†ãªURLã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ã‚’æ‰±ã†éæ¨å¥¨ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ç‰¹å®šã—ã¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¸ã®å½±éŸ¿ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### URLã‚¹ã‚­ãƒ¼ãƒ ã®ãƒ•ã‚¡ã‚¸ãƒ³ã‚°

URLã‚¹ã‚­ãƒ¼ãƒ ã®ãƒ•ã‚¡ã‚¸ãƒ³ã‚°ã¯ã€ãƒ¡ãƒ¢ãƒªç ´æãƒã‚°ã‚’ç‰¹å®šã§ãã¾ã™ã€‚[Frida](https://codeshare.frida.re/@dki/ios-url-scheme-fuzzing/)ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã¯ã€ã•ã¾ã–ã¾ãªãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã§URLã‚’é–‹ã„ã¦ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’ç›£è¦–ã™ã‚‹ã“ã¨ã§ã€ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’è‡ªå‹•åŒ–ã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€iGoat-Swiftã‚¢ãƒ—ãƒªã§ã®URLã®æ“ä½œã«ã‚ˆã£ã¦ç¤ºã•ã‚Œã¾ã™ï¼š
```bash
$ frida -U SpringBoard -l ios-url-scheme-fuzzing.js
[iPhone::SpringBoard]-> fuzz("iGoat", "iGoat://?contactNumber={0}&message={0}")
Watching for crashes from iGoat...
No logs were moved.
Opened URL: iGoat://?contactNumber=0&message=0
```
## ã‚«ã‚¹ã‚¿ãƒ URLã‚¹ã‚­ãƒ¼ãƒ ã®ãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯

[**ã“ã®æŠ•ç¨¿**](https://evanconnelly.github.io/post/ios-oauth/)ã«ã‚ˆã‚‹ã¨ã€æ‚ªæ„ã®ã‚ã‚‹ã‚¢ãƒ—ãƒªã¯**ä»–ã®ã‚¢ãƒ—ãƒªã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚­ãƒ¼ãƒ ã‚’ç™»éŒ²**ã™ã‚‹ã“ã¨ãŒã§ãã€ãã®å¾Œã€æ‚ªæ„ã®ã‚ã‚‹ã‚¢ãƒ—ãƒªã¯[ASWebAuthenticationSession](https://developer.apple.com/documentation/authenticationservices/aswebauthenticationsession/2990952-init#parameters)ã‚’ä½¿ç”¨ã—ã¦ã€Safariã‚¢ãƒ—ãƒªã®ã™ã¹ã¦ã®ã‚¯ãƒƒã‚­ãƒ¼ã‚’æŒã¤ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ãã“ã¨ãŒã§ãã¾ã™ã€‚&#x20;

ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ç”¨ã—ã¦ã€æ‚ªæ„ã®ã‚ã‚‹ã‚¢ãƒ—ãƒªã¯æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ã€TCCã¯ãƒ¢ãƒã‚¤ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãã®ã‚¢ãƒ—ãƒªã‚’é–‹ããŸã‚ã®æ¨©é™ã‚’æ±‚ã‚ã¾ã™ã€‚æ¬¡ã«ã€æ‚ªæ„ã®ã‚ã‚‹ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã¯ã€ä¾‹ãˆã°`prompt=none`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒã¤OAuthãƒ•ãƒ­ãƒ¼ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã™ã§ã«OAuthãƒ•ãƒ­ãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹å ´åˆã€OAuthãƒ•ãƒ­ãƒ¼ã¯è¢«å®³è€…ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç§˜å¯†ã‚’ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚­ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ã¦é€ä¿¡ã—ã¾ã™ã€‚\
ã—ã‹ã—ã€æ‚ªæ„ã®ã‚ã‚‹ã‚¢ãƒ—ãƒªã‚‚ãã‚Œã‚’ç™»éŒ²ã—ã¦ãŠã‚Šã€ä½¿ç”¨ã•ã‚Œã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ãŒæ‚ªæ„ã®ã‚ã‚‹ã‚¢ãƒ—ãƒªå†…ã«ã‚ã‚‹ãŸã‚ã€ã“ã®å ´åˆã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚­ãƒ¼ãƒ ã¯æ‚ªæ„ã®ã‚ã‚‹ã‚¢ãƒ—ãƒªã«ã‚ˆã£ã¦å‡¦ç†ã•ã‚Œã€OAuthãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã‚€ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0075/](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0075/)
* [https://evanconnelly.github.io/post/ios-oauth/](https://evanconnelly.github.io/post/ios-oauth/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
