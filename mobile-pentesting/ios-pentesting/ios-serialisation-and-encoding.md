{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Code and more information in [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence).

## iOSé–‹ç™ºã«ãŠã‘ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚·ãƒªã‚¢ãƒ«åŒ–

iOSã«ãŠã„ã¦ã€**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚·ãƒªã‚¢ãƒ«åŒ–**ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç°¡å˜ã«ä¿å­˜ã¾ãŸã¯é€ä¿¡ã§ãã‚‹å½¢å¼ã«å¤‰æ›ã—ã€å¿…è¦ã«å¿œã˜ã¦ã“ã®å½¢å¼ã‹ã‚‰å†æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚’å«ã¿ã¾ã™ã€‚ä¸»ã«2ã¤ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€**`NSCoding`**ã¨**`NSSecureCoding`**ãŒã€Objective-Cã¾ãŸã¯`NSObject`ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã«å¯¾ã—ã¦ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®¹æ˜“ã«ã—ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’**`NSData`**ã«ã‚·ãƒªã‚¢ãƒ«åŒ–ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã®å½¢å¼ã¯ãƒã‚¤ãƒˆãƒãƒƒãƒ•ã‚¡ã‚’ãƒ©ãƒƒãƒ—ã—ã¾ã™ã€‚

### **`NSCoding`**ã®å®Ÿè£…
`NSCoding`ã‚’å®Ÿè£…ã™ã‚‹ã«ã¯ã€ã‚¯ãƒ©ã‚¹ãŒ`NSObject`ã‹ã‚‰ç¶™æ‰¿ã™ã‚‹ã‹ã€`@objc`ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ãƒ‡ã‚³ãƒ¼ãƒ‰ã®ãŸã‚ã«2ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ã‚’ç¾©å‹™ä»˜ã‘ã¦ã„ã¾ã™ï¼š
```swift
class CustomPoint: NSObject, NSCoding {
var x: Double = 0.0
var name: String = ""

func encode(with aCoder: NSCoder) {
aCoder.encode(x, forKey: "x")
aCoder.encode(name, forKey: "name")
}

required convenience init?(coder aDecoder: NSCoder) {
guard let name = aDecoder.decodeObject(forKey: "name") as? String else { return nil }
self.init(x: aDecoder.decodeDouble(forKey: "x"), name: name)
}
}
```
### **`NSSecureCoding`ã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¼·åŒ–**
æ”»æ’ƒè€…ãŒæ—¢ã«æ§‹ç¯‰ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’æ³¨å…¥ã™ã‚‹è„†å¼±æ€§ã‚’è»½æ¸›ã™ã‚‹ãŸã‚ã«ã€**`NSSecureCoding`**ã¯å¼·åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æä¾›ã—ã¾ã™ã€‚`NSSecureCoding`ã«æº–æ‹ ã™ã‚‹ã‚¯ãƒ©ã‚¹ã¯ã€ãƒ‡ã‚³ãƒ¼ãƒ‰ä¸­ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¿ã‚¤ãƒ—ã‚’æ¤œè¨¼ã—ã€æœŸå¾…ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ã®ã¿ãŒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ã€`NSSecureCoding`ãŒã‚¿ã‚¤ãƒ—ã®å®‰å…¨æ€§ã‚’å¼·åŒ–ã™ã‚‹ä¸€æ–¹ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ãŸã‚Šã€ãã®æ•´åˆæ€§ã‚’ä¿è¨¼ã—ãŸã‚Šã™ã‚‹ã‚ã‘ã§ã¯ãªã„ãŸã‚ã€æ©Ÿå¯†æƒ…å ±ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã®è¿½åŠ ã®å¯¾ç­–ãŒå¿…è¦ã§ã™ã€‚
```swift
static var supportsSecureCoding: Bool {
return true
}

let obj = decoder.decodeObject(of: MyClass.self, forKey: "myKey")
```
## Data Archiving with `NSKeyedArchiver`
`NSKeyedArchiver` ã¨ãã®å¯¾å¿œç‰©ã§ã‚ã‚‹ `NSKeyedUnarchiver` ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã€å¾Œã§ãã‚Œã‚‰ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ã“ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ°¸ç¶šåŒ–ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ï¼š
```swift
NSKeyedArchiver.archiveRootObject(customPoint, toFile: "/path/to/archive")
let customPoint = NSKeyedUnarchiver.unarchiveObjectWithFile("/path/to/archive") as? CustomPoint
```
### Using `Codable` for Simplified Serialization
Swiftã®`Codable`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯`Decodable`ã¨`Encodable`ã‚’çµ„ã¿åˆã‚ã›ã¦ãŠã‚Šã€`String`ã€`Int`ã€`Double`ãªã©ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã®æ‰‹é–“ãªã—ã«å®¹æ˜“ã«ã—ã¾ã™ï¼š
```swift
struct CustomPointStruct: Codable {
var x: Double
var name: String
}
```
ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒªã‚¹ãƒˆã¨JSONã¸ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚·ãƒªã‚¢ãƒ«åŒ–ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€Swiftã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’å¼·åŒ–ã—ã¾ã™ã€‚

## JSONã¨XMLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ä»£æ›¿
ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆã«åŠ ãˆã¦ã€ã„ãã¤ã‹ã®ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒJSONãŠã‚ˆã³XMLã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°/ãƒ‡ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãŠã‚Šã€ãã‚Œãã‚Œã«ç‹¬è‡ªã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç‰¹æ€§ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è€ƒæ…®äº‹é …ãŒã‚ã‚Šã¾ã™ã€‚ç‰¹ã«ã€å¤–éƒ¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å‡¦ç†ã‚’é˜²ããŸã‚ã«ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€XXEï¼ˆXMLå¤–éƒ¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰æ”»æ’ƒã®ã‚ˆã†ãªè„†å¼±æ€§ã‚’è»½æ¸›ã™ã‚‹ãŸã‚ã«ã€ã“ã‚Œã‚‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ…é‡ã«é¸æŠã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è€ƒæ…®äº‹é …
ãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒªã‚¢ãƒ«åŒ–ã™ã‚‹éš›ã€ç‰¹ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ã‚·ãƒªã‚¢ãƒ«åŒ–ã«ãŠã„ã¦ã¯ã€æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ã«æ³¨æ„ã‚’æ‰•ã†ã“ã¨ãŒä¸å¯æ¬ ã§ã™ã€‚ã‚·ãƒªã‚¢ãƒ«åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¯ã€å‚å—ã•ã‚ŒãŸã‚Šä¸é©åˆ‡ã«å‡¦ç†ã•ã‚ŒãŸã‚Šã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸æ­£ãªæ“ä½œã‚„ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã®ãƒªã‚¹ã‚¯ã«ã•ã‚‰ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–ã™ã‚‹ãŸã‚ã«ã€ã‚·ãƒªã‚¢ãƒ«åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–ã¨ç½²åã‚’æ¨å¥¨ã—ã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®
* [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
