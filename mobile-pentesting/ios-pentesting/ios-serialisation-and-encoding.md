<details>

<summary><strong>é›¶åŸºç¡€å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ç›´è‡³æˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>




### NSCoding å’Œ NSSecureCoding

iOSä¸ºObjective-Cæˆ–`NSObject`æä¾›äº†ä¸¤ä¸ªå¯¹è±¡**åºåˆ—åŒ–**åè®®ï¼š**`NSCoding`** å’Œ **`NSSecureCoding`**ã€‚å½“ä¸€ä¸ª**ç±»éµå¾ª**è¿™äº›åè®®ä¸­çš„ä»»ä½•ä¸€ä¸ªæ—¶ï¼Œæ•°æ®ä¼šè¢«åºåˆ—åŒ–ä¸º**`NSData`**ï¼šä¸€ä¸ª**å­—èŠ‚ç¼“å†²åŒº**çš„åŒ…è£…å™¨ã€‚æ³¨æ„ï¼Œåœ¨Swiftä¸­çš„`Data`ä¸`NSData`æˆ–å…¶å¯å˜å¯¹åº”ç‰©ï¼š`NSMutableData`ç›¸åŒã€‚`NSCoding`åè®®å£°æ˜äº†å¿…é¡»å®ç°çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œä»¥ä¾¿å¯¹å…¶å®ä¾‹å˜é‡è¿›è¡Œç¼–ç /è§£ç ã€‚**ä½¿ç”¨`NSCoding`çš„ç±»éœ€è¦å®ç°`NSObject`æˆ–è¢«æ ‡æ³¨ä¸º@objcç±»**ã€‚`NSCoding`åè®®è¦æ±‚å®ç°ç¼–ç å’Œåˆå§‹åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚
```swift
class CustomPoint: NSObject, NSCoding {

//required by NSCoding:
func encode(with aCoder: NSCoder) {
aCoder.encode(x, forKey: "x")
aCoder.encode(name, forKey: "name")
}

var x: Double = 0.0
var name: String = ""

init(x: Double, name: String) {
self.x = x
self.name = name
}

// required by NSCoding: initialize members using a decoder.
required convenience init?(coder aDecoder: NSCoder) {
guard let name = aDecoder.decodeObject(forKey: "name") as? String
else {return nil}
self.init(x:aDecoder.decodeDouble(forKey:"x"),
name:name)
}

//getters/setters/etc.
}
```
`NSCoding`çš„é—®é¢˜åœ¨äºï¼Œå¯¹è±¡é€šå¸¸åœ¨æ‚¨èƒ½å¤Ÿè¯„ä¼°ç±»ç±»å‹ä¹‹å‰å°±å·²ç»**æ„å»ºå¹¶æ’å…¥**ã€‚è¿™**å…è®¸æ”»å‡»è€…è½»æ¾æ³¨å…¥å„ç§æ•°æ®**ã€‚å› æ­¤ï¼Œå¼•å…¥äº†**`NSSecureCoding`**åè®®ã€‚å½“éµå¾ª[`NSSecureCoding`](https://developer.apple.com/documentation/foundation/NSSecureCoding)æ—¶ï¼Œæ‚¨éœ€è¦åŒ…æ‹¬ï¼š
```swift
static var supportsSecureCoding: Bool {
return true
}
```
å½“ `init(coder:)` æ˜¯ç±»çš„ä¸€éƒ¨åˆ†æ—¶ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨è§£ç å¯¹è±¡æ—¶ï¼Œåº”è¯¥è¿›è¡Œæ£€æŸ¥ï¼Œä¾‹å¦‚ï¼š
```swift
let obj = decoder.decodeObject(of:MyClass.self, forKey: "myKey")
```
éµå®ˆ `NSSecureCoding` ç¡®ä¿äº†è¢«å®ä¾‹åŒ–çš„å¯¹è±¡ç¡®å®æ˜¯é¢„æœŸçš„å¯¹è±¡ã€‚ç„¶è€Œï¼Œå¯¹æ•°æ®**æ²¡æœ‰é¢å¤–çš„å®Œæ•´æ€§æ£€æŸ¥**ï¼Œä¸”æ•°æ®æœªè¢«åŠ å¯†ã€‚å› æ­¤ï¼Œä»»ä½•éœ€è¦ä¿å¯†çš„æ•°æ®éƒ½éœ€è¦é¢å¤–çš„**åŠ å¯†**ï¼Œè€Œéœ€è¦ä¿æŠ¤å®Œæ•´æ€§çš„æ•°æ®ï¼Œåº”è¯¥å¢åŠ ä¸€ä¸ªé¢å¤–çš„ HMACã€‚

### ä½¿ç”¨ NSKeyedArchiver çš„å¯¹è±¡å½’æ¡£

`NSKeyedArchiver` æ˜¯ `NSCoder` çš„ä¸€ä¸ªå…·ä½“å­ç±»ï¼Œæä¾›äº†ä¸€ç§ç¼–ç å¯¹è±¡å¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„æ–¹æ³•ã€‚`NSKeyedUnarchiver` è§£ç æ•°æ®å¹¶é‡å»ºåŸå§‹æ•°æ®ã€‚è®©æˆ‘ä»¬ä»¥ `NSCoding` éƒ¨åˆ†çš„ä¾‹å­ä¸ºä¾‹ï¼Œç°åœ¨å¯¹å®ƒä»¬è¿›è¡Œå½’æ¡£å’Œè§£æ¡£ï¼š
```swift
// archiving:
NSKeyedArchiver.archiveRootObject(customPoint, toFile: "/path/to/archive")

// unarchiving:
guard let customPoint = NSKeyedUnarchiver.unarchiveObjectWithFile("/path/to/archive") as?
CustomPoint else { return nil }
```
æ‚¨è¿˜å¯ä»¥å°†ä¿¡æ¯ä¿å­˜åœ¨ä¸»è¦çš„ plist `NSUserDefaults` ä¸­ï¼š
```swift
// archiving:
let data = NSKeyedArchiver.archivedDataWithRootObject(customPoint)
NSUserDefaults.standardUserDefaults().setObject(data, forKey: "customPoint")

// unarchiving:
if let data = NSUserDefaults.standardUserDefaults().objectForKey("customPoint") as? NSData {
let customPoint = NSKeyedUnarchiver.unarchiveObjectWithData(data)
}
```
### Codable

å®ƒæ˜¯ `Decodable` å’Œ `Encodable` åè®®çš„ç»„åˆã€‚`String`ã€`Int`ã€`Double`ã€`Date`ã€`Data` å’Œ `URL` æœ¬è´¨ä¸Šæ˜¯ `Codable`ï¼šè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥è½»æ¾åœ°è¿›è¡Œç¼–ç å’Œè§£ç ï¼Œæ— éœ€ä»»ä½•é¢å¤–å·¥ä½œã€‚è®©æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š
```swift
struct CustomPointStruct:Codable {
var x: Double
var name: String
}
```
åœ¨ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡å°† `Codable` æ·»åŠ åˆ° `CustomPointStruct` çš„ç»§æ‰¿åˆ—è¡¨ä¸­ï¼Œè‡ªåŠ¨æ”¯æŒäº† `init(from:)` å’Œ `encode(to:)` æ–¹æ³•ã€‚æœ‰å…³ `Codable` å·¥ä½œåŸç†çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[è‹¹æœå¼€å‘è€…æ–‡æ¡£](https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types)ã€‚

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ codable å°†æ•°æ®ä¿å­˜åœ¨ä¸»å±æ€§åˆ—è¡¨ `NSUserDefaults` ä¸­ï¼š
```swift
struct CustomPointStruct: Codable {
var point: Double
var name: String
}

var points: [CustomPointStruct] = [
CustomPointStruct(point: 1, name: "test"),
CustomPointStruct(point: 2, name: "test"),
CustomPointStruct(point: 3, name: "test"),
]

UserDefaults.standard.set(try? PropertyListEncoder().encode(points), forKey: "points")
if let data = UserDefaults.standard.value(forKey: "points") as? Data {
let points2 = try? PropertyListDecoder().decode([CustomPointStruct].self, from: data)
}
```
### JSON ç¼–ç 

æœ‰è®¸å¤šç¬¬ä¸‰æ–¹åº“å¯ä»¥å°†æ•°æ®ç¼–ç ä¸º JSONï¼ˆå¦‚[æ­¤å¤„](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#json-and-codable)æ‰€ç¤ºï¼‰ã€‚ç„¶è€Œï¼Œè‹¹æœé€šè¿‡ç»“åˆ `Codable` ä¸ `JSONEncoder` å’Œ `JSONDecoder` ç›´æ¥æä¾›äº†å¯¹ JSON ç¼–ç /è§£ç çš„æ”¯æŒï¼š
```swift
struct CustomPointStruct: Codable {
var point: Double
var name: String
}

let encoder = JSONEncoder()
encoder.outputFormatting = .prettyPrinted

let test = CustomPointStruct(point: 10, name: "test")
let data = try encoder.encode(test)
let stringData = String(data: data, encoding: .utf8)

// stringData = Optional ({
// "point" : 10,
// "name" : "test"
// })
```
### XML

æœ‰å¤šç§æ–¹å¼å¯ä»¥è¿›è¡ŒXMLç¼–ç ã€‚ç±»ä¼¼äºJSONè§£æï¼Œæœ‰å„ç§ç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚ï¼š[Fuzi](https://github.com/cezheng/Fuzi)ã€[Ono](https://github.com/mattt/Ono)ã€[AEXML](https://github.com/tadija/AEXML)ã€[RaptureXML](https://github.com/ZaBlanc/RaptureXML)ã€[SwiftyXMLParser](https://github.com/yahoojapan/SwiftyXMLParser)ã€[SWXMLHash](https://github.com/drmohundro/SWXMLHash)

å®ƒä»¬åœ¨é€Ÿåº¦ã€å†…å­˜ä½¿ç”¨ã€å¯¹è±¡æŒä¹…æ€§æ–¹é¢å„ä¸ç›¸åŒï¼Œæ›´é‡è¦çš„æ˜¯ï¼šå®ƒä»¬å¤„ç†XMLå¤–éƒ¨å®ä½“çš„æ–¹å¼ä¸åŒã€‚ä»¥[XXE in the Apple iOS Office viewer](https://nvd.nist.gov/vuln/detail/CVE-2015-3784)ä¸ºä¾‹ã€‚å› æ­¤ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œç¦ç”¨å¤–éƒ¨å®ä½“è§£ææ˜¯å…³é”®ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[OWASP XXEé¢„é˜²å¤‡å¿˜å•](https://cheatsheetseries.owasp.org/cheatsheets/XML\_External\_Entity\_Prevention\_Cheat\_Sheet.html)ã€‚é™¤äº†åº“ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨Appleçš„[`XMLParser`ç±»](https://developer.apple.com/documentation/foundation/xmlparser)

å½“ä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œè€Œæ˜¯ä½¿ç”¨Appleçš„`XMLParser`æ—¶ï¼Œç¡®ä¿è®©`shouldResolveExternalEntities`è¿”å›`false`ã€‚

{% hint style="danger" %}
æ‰€æœ‰è¿™äº›åºåˆ—åŒ–/ç¼–ç æ•°æ®çš„æ–¹å¼éƒ½å¯ä»¥**ç”¨äºåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å­˜å‚¨æ•°æ®**ã€‚åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œæ£€æŸ¥å­˜å‚¨çš„æ•°æ®æ˜¯å¦åŒ…å«ä»»ä½•ç±»å‹çš„**æ•æ„Ÿä¿¡æ¯**ã€‚\
æ­¤å¤–ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿ**æ»¥ç”¨ä¸€äº›åºåˆ—åŒ–**çš„æ•°æ®ï¼ˆé€šè¿‡MitMæ•è·æˆ–åœ¨æ–‡ä»¶ç³»ç»Ÿå†…ä¿®æ”¹å®ƒï¼‰ååºåˆ—åŒ–ä»»æ„æ•°æ®å¹¶**ä½¿åº”ç”¨ç¨‹åºæ‰§è¡Œæ„å¤–çš„æ“ä½œ**ï¼ˆå‚è§[ååºåˆ—åŒ–é¡µé¢](../../pentesting-web/deserialization/)ï¼‰ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå»ºè®®åŠ å¯†å¹¶ç­¾åå‘é€/ä¿å­˜åºåˆ—åŒ–æ•°æ®ã€‚
{% endhint %}

## å‚è€ƒèµ„æ–™

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
