{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Code and more information in [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence).

## iOS ê°œë°œì—ì„œì˜ ê°ì²´ ì§ë ¬í™”

iOSì—ì„œ **ê°ì²´ ì§ë ¬í™”**ëŠ” ê°ì²´ë¥¼ ì‰½ê²Œ ì €ì¥í•˜ê±°ë‚˜ ì „ì†¡í•  ìˆ˜ ìˆëŠ” í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•œ ë‹¤ìŒ, í•„ìš”í•  ë•Œ ì´ í˜•ì‹ì—ì„œ ë‹¤ì‹œ ì¬êµ¬ì„±í•˜ëŠ” ê³¼ì •ì„ í¬í•¨í•©ë‹ˆë‹¤. ë‘ ê°€ì§€ ì£¼ìš” í”„ë¡œí† ì½œì¸ **`NSCoding`**ê³¼ **`NSSecureCoding`**ì€ Objective-C ë˜ëŠ” `NSObject` ì„œë¸Œí´ë˜ìŠ¤ì— ëŒ€í•´ ì´ ê³¼ì •ì„ ìš©ì´í•˜ê²Œ í•˜ì—¬ ê°ì²´ë¥¼ **`NSData`**ë¡œ ì§ë ¬í™”í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ëŠ” ë°”ì´íŠ¸ ë²„í¼ë¥¼ ê°ì‹¸ëŠ” í˜•ì‹ì…ë‹ˆë‹¤.

### **`NSCoding`** êµ¬í˜„
`NSCoding`ì„ êµ¬í˜„í•˜ë ¤ë©´ í´ë˜ìŠ¤ê°€ `NSObject`ì—ì„œ ìƒì†ë°›ê±°ë‚˜ `@objc`ë¡œ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ í”„ë¡œí† ì½œì€ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¥¼ ì¸ì½”ë”©í•˜ê³  ë””ì½”ë”©í•˜ê¸° ìœ„í•œ ë‘ ê°€ì§€ ë©”ì„œë“œì˜ êµ¬í˜„ì„ ìš”êµ¬í•©ë‹ˆë‹¤:
```swift
class CustomPoint: NSObject, NSCoding {
var x: Double = 0.0
var name: String = ""

func encode(with aCoder: NSCoder) {
aCoder.encode(x, forKey: "x")
aCoder.encode(name, forKey: "name")
}

required convenience init?(coder aDecoder: NSCoder) {
guard let name = aDecoder.decodeObject(forKey: "name") as? String else { return nil }
self.init(x: aDecoder.decodeDouble(forKey: "x"), name: name)
}
}
```
### **`NSSecureCoding`ë¡œ ë³´ì•ˆ ê°•í™”í•˜ê¸°**
ê³µê²©ìê°€ ì´ë¯¸ êµ¬ì„±ëœ ê°ì²´ì— ë°ì´í„°ë¥¼ ì£¼ì…í•˜ëŠ” ì·¨ì•½ì ì„ ì™„í™”í•˜ê¸° ìœ„í•´, **`NSSecureCoding`**ì€ í–¥ìƒëœ í”„ë¡œí† ì½œì„ ì œê³µí•©ë‹ˆë‹¤. `NSSecureCoding`ì— ì¤€ìˆ˜í•˜ëŠ” í´ë˜ìŠ¤ëŠ” ë””ì½”ë”© ì¤‘ ê°ì²´ì˜ ìœ í˜•ì„ í™•ì¸í•´ì•¼ í•˜ë©°, ì˜ˆìƒë˜ëŠ” ê°ì²´ ìœ í˜•ë§Œ ì¸ìŠ¤í„´ìŠ¤í™”ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `NSSecureCoding`ì´ ìœ í˜• ì•ˆì „ì„±ì„ í–¥ìƒì‹œí‚¤ëŠ” ë™ì•ˆ ë°ì´í„° ì•”í˜¸í™”ë‚˜ ë¬´ê²°ì„±ì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ë¯¼ê°í•œ ì •ë³´ë¥¼ ë³´í˜¸í•˜ê¸° ìœ„í•œ ì¶”ê°€ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤:
```swift
static var supportsSecureCoding: Bool {
return true
}

let obj = decoder.decodeObject(of: MyClass.self, forKey: "myKey")
```
## Data Archiving with `NSKeyedArchiver`
`NSKeyedArchiver`ì™€ ê·¸ ëŒ€ì‘ì¸ `NSKeyedUnarchiver`ëŠ” ê°ì²´ë¥¼ íŒŒì¼ë¡œ ì¸ì½”ë”©í•˜ê³  ë‚˜ì¤‘ì— ì´ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì´ ë©”ì»¤ë‹ˆì¦˜ì€ ê°ì²´ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤:
```swift
NSKeyedArchiver.archiveRootObject(customPoint, toFile: "/path/to/archive")
let customPoint = NSKeyedUnarchiver.unarchiveObjectWithFile("/path/to/archive") as? CustomPoint
```
### Using `Codable` for Simplified Serialization
Swiftì˜ `Codable` í”„ë¡œí† ì½œì€ `Decodable`ê³¼ `Encodable`ì„ ê²°í•©í•˜ì—¬ `String`, `Int`, `Double` ë“±ê³¼ ê°™ì€ ê°ì²´ì˜ ì¸ì½”ë”© ë° ë””ì½”ë”©ì„ ì¶”ê°€ì ì¸ ë…¸ë ¥ ì—†ì´ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤:
```swift
struct CustomPointStruct: Codable {
var x: Double
var name: String
}
```
ì´ ì ‘ê·¼ ë°©ì‹ì€ ì†ì„± ëª©ë¡ ë° JSONìœ¼ë¡œì˜ ê°„ë‹¨í•œ ì§ë ¬í™”ë¥¼ ì§€ì›í•˜ì—¬ Swift ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë°ì´í„° ì²˜ë¦¬ë¥¼ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

## JSON ë° XML ì¸ì½”ë”© ëŒ€ì•ˆ
ë„¤ì´í‹°ë¸Œ ì§€ì› ì™¸ì—ë„ ì—¬ëŸ¬ ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ JSON ë° XML ì¸ì½”ë”©/ë””ì½”ë”© ê¸°ëŠ¥ì„ ì œê³µí•˜ë©°, ê° ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ê³ ìœ í•œ ì„±ëŠ¥ íŠ¹ì„±ê³¼ ë³´ì•ˆ ê³ ë ¤ ì‚¬í•­ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‹ ì¤‘í•˜ê²Œ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë©°, íŠ¹íˆ ì™¸ë¶€ ì—”í‹°í‹° ì²˜ë¦¬ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ íŒŒì„œë¥¼ êµ¬ì„±í•˜ì—¬ XXE(XML External Entities) ê³µê²©ê³¼ ê°™ì€ ì·¨ì•½ì ì„ ì™„í™”í•´ì•¼ í•©ë‹ˆë‹¤.

### ë³´ì•ˆ ê³ ë ¤ ì‚¬í•­
ë°ì´í„°ë¥¼ ì§ë ¬í™”í•  ë•Œ, íŠ¹íˆ íŒŒì¼ ì‹œìŠ¤í…œìœ¼ë¡œ ì§ë ¬í™”í•  ë•ŒëŠ” ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ë  ê°€ëŠ¥ì„±ì— ëŒ€í•´ ê²½ê³„ë¥¼ ìœ ì§€í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤. ì§ë ¬í™”ëœ ë°ì´í„°ëŠ” ê°€ë¡œì±„ì´ê±°ë‚˜ ë¶€ì ì ˆí•˜ê²Œ ì²˜ë¦¬ë  ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¬´ë‹¨ ì‘ì—…ì´ë‚˜ ë°ì´í„° ìœ ì¶œê³¼ ê°™ì€ ìœ„í—˜ì— ë…¸ì¶œì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³´ì•ˆì„ ê°•í™”í•˜ê¸° ìœ„í•´ ì§ë ¬í™”ëœ ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•˜ê³  ì„œëª…í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.

## References
* [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
