{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Code et plus d'informations sur [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence).

## S√©rialisation d'objets dans le d√©veloppement iOS

Dans iOS, **la s√©rialisation d'objets** implique de convertir des objets en un format qui peut √™tre facilement stock√© ou transmis, puis de les reconstruire √† partir de ce format lorsque n√©cessaire. Deux protocoles principaux, **`NSCoding`** et **`NSSecureCoding`**, facilitent ce processus pour les sous-classes Objective-C ou `NSObject`, permettant aux objets d'√™tre s√©rialis√©s en **`NSData`**, un format qui enveloppe des tampons d'octets.

### **`NSCoding`** Implementation
Pour impl√©menter `NSCoding`, une classe doit h√©riter de `NSObject` ou √™tre marqu√©e comme `@objc`. Ce protocole impose l'impl√©mentation de deux m√©thodes pour l'encodage et le d√©codage des variables d'instance :
```swift
class CustomPoint: NSObject, NSCoding {
var x: Double = 0.0
var name: String = ""

func encode(with aCoder: NSCoder) {
aCoder.encode(x, forKey: "x")
aCoder.encode(name, forKey: "name")
}

required convenience init?(coder aDecoder: NSCoder) {
guard let name = aDecoder.decodeObject(forKey: "name") as? String else { return nil }
self.init(x: aDecoder.decodeDouble(forKey: "x"), name: name)
}
}
```
### **Am√©liorer la s√©curit√© avec `NSSecureCoding`**
Pour att√©nuer les vuln√©rabilit√©s o√π des attaquants injectent des donn√©es dans des objets d√©j√† construits, **`NSSecureCoding`** offre un protocole am√©lior√©. Les classes conformes √† `NSSecureCoding` doivent v√©rifier le type des objets lors du d√©codage, garantissant que seuls les types d'objets attendus sont instanci√©s. Cependant, il est crucial de noter que bien que `NSSecureCoding` am√©liore la s√©curit√© des types, il ne crypte pas les donn√©es ni n'assure leur int√©grit√©, n√©cessitant des mesures suppl√©mentaires pour prot√©ger les informations sensibles :
```swift
static var supportsSecureCoding: Bool {
return true
}

let obj = decoder.decodeObject(of: MyClass.self, forKey: "myKey")
```
## Archivage de donn√©es avec `NSKeyedArchiver`
`NSKeyedArchiver` et son homologue, `NSKeyedUnarchiver`, permettent d'encoder des objets dans un fichier et de les r√©cup√©rer ult√©rieurement. Ce m√©canisme est utile pour la persistance des objets :
```swift
NSKeyedArchiver.archiveRootObject(customPoint, toFile: "/path/to/archive")
let customPoint = NSKeyedUnarchiver.unarchiveObjectWithFile("/path/to/archive") as? CustomPoint
```
### Utilisation de `Codable` pour une s√©rialisation simplifi√©e
Le protocole `Codable` de Swift combine `Decodable` et `Encodable`, facilitant l'encodage et le d√©codage d'objets comme `String`, `Int`, `Double`, etc., sans effort suppl√©mentaire :
```swift
struct CustomPointStruct: Codable {
var x: Double
var name: String
}
```
Cette approche prend en charge la s√©rialisation simple vers et depuis des listes de propri√©t√©s et JSON, am√©liorant ainsi la gestion des donn√©es dans les applications Swift.

## Alternatives d'encodage JSON et XML
Au-del√† du support natif, plusieurs biblioth√®ques tierces offrent des capacit√©s d'encodage/d√©codage JSON et XML, chacune ayant ses propres caract√©ristiques de performance et consid√©rations de s√©curit√©. Il est imp√©ratif de s√©lectionner ces biblioth√®ques avec soin, en particulier pour att√©nuer les vuln√©rabilit√©s telles que les attaques XXE (XML External Entities) en configurant les analyseurs pour emp√™cher le traitement des entit√©s externes.

### Consid√©rations de s√©curit√©
Lors de la s√©rialisation des donn√©es, en particulier vers le syst√®me de fichiers, il est essentiel de rester vigilant quant √† l'inclusion potentielle d'informations sensibles. Les donn√©es s√©rialis√©es, si elles sont intercept√©es ou mal g√©r√©es, peuvent exposer les applications √† des risques tels que des actions non autoris√©es ou des fuites de donn√©es. Il est recommand√© de chiffrer et de signer les donn√©es s√©rialis√©es pour am√©liorer la s√©curit√©.

## R√©f√©rences
* [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
