<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“ï¼š[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>




### NSCodingå’ŒNSSecureCoding

iOSæä¾›äº†ä¸¤ä¸ªç”¨äºObjective-Cæˆ–`NSObject`å¯¹è±¡**åºåˆ—åŒ–**çš„åè®®ï¼š**`NSCoding`**å’Œ**`NSSecureCoding`**ã€‚å½“ä¸€ä¸ª**ç±»ç¬¦åˆ**è¿™ä¸¤ä¸ªåè®®ä¹‹ä¸€æ—¶ï¼Œæ•°æ®å°†è¢«åºåˆ—åŒ–ä¸º**`NSData`**ï¼šä¸€ä¸ª**å­—èŠ‚ç¼“å†²åŒº**çš„åŒ…è£…å™¨ã€‚è¯·æ³¨æ„ï¼ŒSwiftä¸­çš„`Data`ä¸`NSData`æˆ–å…¶å¯å˜å¯¹åº”ç‰©ï¼š`NSMutableData`æ˜¯ç›¸åŒçš„ã€‚`NSCoding`åè®®å£°æ˜äº†å¿…é¡»å®ç°çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œä»¥ä¾¿å¯¹å…¶å®ä¾‹å˜é‡è¿›è¡Œç¼–ç /è§£ç ã€‚**ä½¿ç”¨`NSCoding`çš„ç±»éœ€è¦å®ç°`NSObject`æˆ–è¢«æ³¨è§£ä¸º@objcç±»**ã€‚`NSCoding`åè®®è¦æ±‚å®ç°å¦‚ä¸‹çš„ç¼–ç å’Œåˆå§‹åŒ–æ–¹æ³•ã€‚
```swift
class CustomPoint: NSObject, NSCoding {

//required by NSCoding:
func encode(with aCoder: NSCoder) {
aCoder.encode(x, forKey: "x")
aCoder.encode(name, forKey: "name")
}

var x: Double = 0.0
var name: String = ""

init(x: Double, name: String) {
self.x = x
self.name = name
}

// required by NSCoding: initialize members using a decoder.
required convenience init?(coder aDecoder: NSCoder) {
guard let name = aDecoder.decodeObject(forKey: "name") as? String
else {return nil}
self.init(x:aDecoder.decodeDouble(forKey:"x"),
name:name)
}

//getters/setters/etc.
}
```
`NSCoding`å­˜åœ¨çš„é—®é¢˜æ˜¯å¯¹è±¡é€šå¸¸åœ¨ä½ èƒ½å¤Ÿè¯„ä¼°ç±»ç±»å‹ä¹‹å‰å·²ç»è¢«æ„å»ºå’Œæ’å…¥ã€‚è¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥è½»æ¾åœ°æ³¨å…¥å„ç§æ•°æ®ã€‚å› æ­¤ï¼Œå¼•å…¥äº†`NSSecureCoding`åè®®ã€‚å½“éµå¾ª[`NSSecureCoding`](https://developer.apple.com/documentation/foundation/NSSecureCoding)æ—¶ï¼Œä½ éœ€è¦åŒ…æ‹¬ï¼š
```swift
static var supportsSecureCoding: Bool {
return true
}
```
å½“`init(coder:)`æ˜¯ç±»çš„ä¸€éƒ¨åˆ†æ—¶ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨è§£ç å¯¹è±¡æ—¶ï¼Œåº”è¿›è¡Œæ£€æŸ¥ï¼Œä¾‹å¦‚ï¼š
```swift
let obj = decoder.decodeObject(of:MyClass.self, forKey: "myKey")
```
éµå¾ª`NSSecureCoding`ç¡®ä¿å®ä¾‹åŒ–çš„å¯¹è±¡ç¡®å®æ˜¯é¢„æœŸçš„å¯¹è±¡ã€‚ç„¶è€Œï¼Œå¯¹æ•°æ®æ²¡æœ‰è¿›è¡Œé¢å¤–çš„å®Œæ•´æ€§æ£€æŸ¥ï¼Œæ•°æ®ä¹Ÿæ²¡æœ‰åŠ å¯†ã€‚å› æ­¤ï¼Œä»»ä½•ç§˜å¯†æ•°æ®éƒ½éœ€è¦é¢å¤–çš„åŠ å¯†ï¼Œéœ€è¦ä¿æŠ¤å®Œæ•´æ€§çš„æ•°æ®åº”è¯¥è·å¾—é¢å¤–çš„HMACã€‚

### ä½¿ç”¨NSKeyedArchiverè¿›è¡Œå¯¹è±¡å½’æ¡£

`NSKeyedArchiver`æ˜¯`NSCoder`çš„å…·ä½“å­ç±»ï¼Œæä¾›äº†ä¸€ç§ç¼–ç å¯¹è±¡å¹¶å°†å…¶å­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„æ–¹æ³•ã€‚`NSKeyedUnarchiver`è§£ç æ•°æ®å¹¶é‡æ–°åˆ›å»ºåŸå§‹æ•°æ®ã€‚è®©æˆ‘ä»¬ä»¥`NSCoding`éƒ¨åˆ†çš„ç¤ºä¾‹ä¸ºä¾‹ï¼Œç°åœ¨å¯¹å®ƒä»¬è¿›è¡Œå½’æ¡£å’Œè§£æ¡£ï¼š
```swift
// archiving:
NSKeyedArchiver.archiveRootObject(customPoint, toFile: "/path/to/archive")

// unarchiving:
guard let customPoint = NSKeyedUnarchiver.unarchiveObjectWithFile("/path/to/archive") as?
CustomPoint else { return nil }
```
æ‚¨è¿˜å¯ä»¥å°†ä¿¡æ¯ä¿å­˜åœ¨ä¸»è¦çš„plist `NSUserDefaults`ä¸­ï¼š
```swift
// archiving:
let data = NSKeyedArchiver.archivedDataWithRootObject(customPoint)
NSUserDefaults.standardUserDefaults().setObject(data, forKey: "customPoint")

// unarchiving:
if let data = NSUserDefaults.standardUserDefaults().objectForKey("customPoint") as? NSData {
let customPoint = NSKeyedUnarchiver.unarchiveObjectWithData(data)
}
```
### Codable

å®ƒæ˜¯`Decodable`å’Œ`Encodable`åè®®çš„ç»„åˆã€‚`String`ã€`Int`ã€`Double`ã€`Date`ã€`Data`å’Œ`URL`æœ¬è´¨ä¸Šæ˜¯`Codable`çš„ï¼šè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°è¿›è¡Œç¼–ç å’Œè§£ç ï¼Œæ— éœ€é¢å¤–çš„å·¥ä½œã€‚è®©æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š
```swift
struct CustomPointStruct:Codable {
var x: Double
var name: String
}
```
é€šè¿‡åœ¨ç¤ºä¾‹ä¸­å°†`CustomPointStruct`çš„ç»§æ‰¿åˆ—è¡¨ä¸­æ·»åŠ `Codable`ï¼Œè‡ªåŠ¨æ”¯æŒ`init(from:)`å’Œ`encode(to:)`æ–¹æ³•ã€‚æœ‰å…³`Codable`çš„å·¥ä½œåŸç†çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[Appleå¼€å‘è€…æ–‡æ¡£](https://developer.apple.com/documentation/foundation/archives\_and\_serialization/encoding\_and\_decoding\_custom\_types)ã€‚

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨`Codable`å°†æ•°æ®ä¿å­˜åœ¨ä¸»å±æ€§åˆ—è¡¨`NSUserDefaults`ä¸­ï¼š
```swift
struct CustomPointStruct: Codable {
var point: Double
var name: String
}

var points: [CustomPointStruct] = [
CustomPointStruct(point: 1, name: "test"),
CustomPointStruct(point: 2, name: "test"),
CustomPointStruct(point: 3, name: "test"),
]

UserDefaults.standard.set(try? PropertyListEncoder().encode(points), forKey: "points")
if let data = UserDefaults.standard.value(forKey: "points") as? Data {
let points2 = try? PropertyListDecoder().decode([CustomPointStruct].self, from: data)
}
```
### JSON ç¼–ç 

æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹åº“å¯ä»¥ç”¨æ¥å°†æ•°æ®ç¼–ç ä¸º JSONï¼ˆå¦‚æ­¤å¤„æ‰€ç¤ºï¼š[é“¾æ¥](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#json-and-codable)ï¼‰ã€‚ç„¶è€Œï¼Œè‹¹æœæä¾›äº†ç›´æ¥ä½¿ç”¨ `Codable` ç»“åˆ `JSONEncoder` å’Œ `JSONDecoder` æ¥è¿›è¡Œ JSON ç¼–ç /è§£ç çš„æ”¯æŒï¼š
```swift
struct CustomPointStruct: Codable {
var point: Double
var name: String
}

let encoder = JSONEncoder()
encoder.outputFormatting = .prettyPrinted

let test = CustomPointStruct(point: 10, name: "test")
let data = try encoder.encode(test)
let stringData = String(data: data, encoding: .utf8)

// stringData = Optional ({
// "point" : 10,
// "name" : "test"
// })
```
### XML

æœ‰å¤šç§æ–¹æ³•å¯ä»¥è¿›è¡ŒXMLç¼–ç ã€‚ä¸JSONè§£æç±»ä¼¼ï¼Œæœ‰å„ç§ç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚ï¼š[Fuzi](https://github.com/cezheng/Fuzi)ï¼Œ[Ono](https://github.com/mattt/Ono)ï¼Œ[AEXML](https://github.com/tadija/AEXML)ï¼Œ[RaptureXML](https://github.com/ZaBlanc/RaptureXML)ï¼Œ[SwiftyXMLParser](https://github.com/yahoojapan/SwiftyXMLParser)ï¼Œ[SWXMLHash](https://github.com/drmohundro/SWXMLHash)ã€‚

å®ƒä»¬åœ¨é€Ÿåº¦ã€å†…å­˜ä½¿ç”¨ã€å¯¹è±¡æŒä¹…æ€§ç­‰æ–¹é¢æœ‰æ‰€ä¸åŒï¼Œæ›´é‡è¦çš„æ˜¯å®ƒä»¬åœ¨å¤„ç†XMLå¤–éƒ¨å®ä½“æ—¶çš„æ–¹å¼ä¹Ÿä¸åŒã€‚ä¾‹å¦‚ï¼Œå‚è€ƒ[è‹¹æœiOSåŠå…¬æŸ¥çœ‹å™¨ä¸­çš„XXE](https://nvd.nist.gov/vuln/detail/CVE-2015-3784)ã€‚å› æ­¤ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œç¦ç”¨å¤–éƒ¨å®ä½“è§£ææ˜¯å…³é”®ã€‚è¯·å‚é˜…[OWASP XXEé¢„é˜²å¤‡å¿˜å•](https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html)äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚é™¤äº†è¿™äº›åº“ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨è‹¹æœçš„[`XMLParser`ç±»](https://developer.apple.com/documentation/foundation/xmlparser)ã€‚

å½“ä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“è€Œæ˜¯ä½¿ç”¨è‹¹æœçš„`XMLParser`æ—¶ï¼Œè¯·ç¡®ä¿è®©`shouldResolveExternalEntities`è¿”å›`false`ã€‚

{% hint style="danger" %}
æ‰€æœ‰è¿™äº›åºåˆ—åŒ–/ç¼–ç æ•°æ®çš„æ–¹å¼éƒ½å¯ä»¥**ç”¨äºå°†æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­**ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ£€æŸ¥å­˜å‚¨çš„æ•°æ®æ˜¯å¦åŒ…å«ä»»ä½•**æ•æ„Ÿä¿¡æ¯**ã€‚æ­¤å¤–ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿ**æ»¥ç”¨æŸäº›åºåˆ—åŒ–**æ•°æ®ï¼ˆé€šè¿‡MitMæ•è·å®ƒæˆ–åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¿®æ”¹å®ƒï¼‰ï¼Œååºåˆ—åŒ–ä»»æ„æ•°æ®å¹¶**ä½¿åº”ç”¨ç¨‹åºæ‰§è¡Œæ„å¤–æ“ä½œ**ï¼ˆå‚è§[ååºåˆ—åŒ–é¡µé¢](../../pentesting-web/deserialization/)ï¼‰ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå»ºè®®å‘é€/ä¿å­˜åŠ å¯†å’Œç­¾åçš„åºåˆ—åŒ–æ•°æ®ã€‚
{% endhint %}

## å‚è€ƒèµ„æ–™

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTæ”¶è—å“](https://opensea.io/collection/the-peass-family)â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTricksè¡£ç‰©**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
