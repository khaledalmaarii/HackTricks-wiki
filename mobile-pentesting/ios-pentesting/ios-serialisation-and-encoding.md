{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

Kod i wicej informacji w [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence).

## Serializacja obiekt贸w w rozwoju iOS

W iOS, **serializacja obiekt贸w** polega na konwertowaniu obiekt贸w na format, kt贸ry mo偶na atwo przechowywa lub przesya, a nastpnie rekonstruowaniu ich z tego formatu w razie potrzeby. Dwa g贸wne protokoy, **`NSCoding`** i **`NSSecureCoding`**, uatwiaj ten proces dla Objective-C lub podklas `NSObject`, pozwalajc na serializacj obiekt贸w do **`NSData`**, formatu, kt贸ry opakowuje bufor bajt贸w.

### **`NSCoding`** Implementacja
Aby zaimplementowa `NSCoding`, klasa musi dziedziczy po `NSObject` lub by oznaczona jako `@objc`. Ten protok贸 wymaga implementacji dw贸ch metod do kodowania i dekodowania zmiennych instancyjnych:
```swift
class CustomPoint: NSObject, NSCoding {
var x: Double = 0.0
var name: String = ""

func encode(with aCoder: NSCoder) {
aCoder.encode(x, forKey: "x")
aCoder.encode(name, forKey: "name")
}

required convenience init?(coder aDecoder: NSCoder) {
guard let name = aDecoder.decodeObject(forKey: "name") as? String else { return nil }
self.init(x: aDecoder.decodeDouble(forKey: "x"), name: name)
}
}
```
### **Zwikszanie bezpieczestwa za pomoc `NSSecureCoding`**
Aby zminimalizowa luki, w kt贸rych atakujcy wstrzykuj dane do ju偶 skonstruowanych obiekt贸w, **`NSSecureCoding`** oferuje ulepszony protok贸. Klasy zgodne z `NSSecureCoding` musz weryfikowa typ obiekt贸w podczas dekodowania, zapewniajc, 偶e tylko oczekiwane typy obiekt贸w s instancjonowane. Nale偶y jednak zauwa偶y, 偶e chocia偶 `NSSecureCoding` zwiksza bezpieczestwo typ贸w, nie szyfruje danych ani nie zapewnia ich integralnoci, co wymaga dodatkowych rodk贸w w celu ochrony wra偶liwych informacji:
```swift
static var supportsSecureCoding: Bool {
return true
}

let obj = decoder.decodeObject(of: MyClass.self, forKey: "myKey")
```
## Archiwizacja danych za pomoc `NSKeyedArchiver`
`NSKeyedArchiver` i jego odpowiednik, `NSKeyedUnarchiver`, umo偶liwiaj kodowanie obiekt贸w do pliku i p贸藕niejsze ich odzyskiwanie. Mechanizm ten jest przydatny do utrwalania obiekt贸w:
```swift
NSKeyedArchiver.archiveRootObject(customPoint, toFile: "/path/to/archive")
let customPoint = NSKeyedUnarchiver.unarchiveObjectWithFile("/path/to/archive") as? CustomPoint
```
### Using `Codable` for Simplified Serialization
Protok贸 `Codable` w Swift czy `Decodable` i `Encodable`, uatwiajc kodowanie i dekodowanie obiekt贸w takich jak `String`, `Int`, `Double` itd., bez dodatkowego wysiku:
```swift
struct CustomPointStruct: Codable {
var x: Double
var name: String
}
```
To podejcie wspiera proste serializowanie do i z list waciwoci oraz JSON, co poprawia obsug danych w aplikacjach Swift.

## Alternatywy kodowania JSON i XML
Poza natywnym wsparciem, kilka bibliotek firm trzecich oferuje mo偶liwoci kodowania/odkodowywania JSON i XML, z kt贸rych ka偶da ma swoje wasne cechy wydajnociowe i kwestie bezpieczestwa. Niezwykle wa偶ne jest staranne wybieranie tych bibliotek, szczeg贸lnie w celu zagodzenia luk, takich jak ataki XXE (XML External Entities), poprzez konfigurowanie parser贸w w celu zapobiegania przetwarzaniu zewntrznych encji.

### Kwestie bezpieczestwa
Podczas serializowania danych, szczeg贸lnie do systemu plik贸w, istotne jest zachowanie czujnoci wobec potencjalnego wczenia wra偶liwych informacji. Zserializowane dane, jeli zostan przechwycone lub niewaciwie obsu偶one, mog nara偶a aplikacje na ryzyko, takie jak nieautoryzowane dziaania lub wyciek danych. Zaleca si szyfrowanie i podpisywanie zserializowanych danych w celu zwikszenia bezpieczestwa.

## Referencje
* [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
