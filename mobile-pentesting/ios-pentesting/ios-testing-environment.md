# iOS Testing Environment

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
{% endhint %}

## Apple Developer Program

**プロビジョニングアイデンティティ**は、Apple開発者アカウントに関連付けられた公開鍵と秘密鍵のコレクションです。**アプリに署名する**には、**99$/年**を支払って**Apple Developer Program**に登録し、プロビジョニングアイデンティティを取得する必要があります。これがないと、物理デバイスでソースコードからアプリケーションを実行することはできません。これを行う別の方法は、**脱獄デバイス**を使用することです。

Xcode 7.2以降、Appleは実際のiPhoneでアプリケーションを書いてテストすることを可能にする**無料のiOS開発プロビジョニングプロファイル**を作成するオプションを提供しています。_Xcode_ --> _Preferences_ --> _Accounts_ --> _+_（あなたの資格情報で新しいアプリIDを追加）--> _作成したApple IDをクリック_ --> _Manage Certificates_ --> _+_（Apple Development）--> _Done_\
\_\_次に、iPhoneでアプリケーションを実行するには、まず**iPhoneにコンピュータを信頼させる必要があります。**その後、Xcodeからモバイルで**アプリケーションを実行しようとしますが、エラーが表示されます。設定に移動して、_Settings_ --> _General_ --> _Profiles and Device Management_ --> 信頼されていないプロファイルを選択し、**「信頼」**をクリックします。

**同じ署名証明書で署名されたアプリケーションは、キーチェーンアイテムのように安全にリソースを共有できます**。

プロビジョニングプロファイルは、電話の中の**`/Library/MobileDevice/ProvisioningProfiles`**に保存されています。

## **Simulator**

{% hint style="info" %}
**シミュレーターはエミュレーターとは異なる**ことに注意してください。シミュレーターはデバイスの動作と機能をシミュレートするだけで、実際にはそれらを使用しません。
{% endhint %}

### **Simulator**

最初に知っておくべきことは、**シミュレーター内でのペンテストは、脱獄デバイスで行うよりもはるかに制限される**ということです。

iOSアプリを構築およびサポートするために必要なすべてのツールは、**Mac OSでのみ公式にサポートされています**。\
Appleの事実上のツールは、iOSアプリケーションを作成/デバッグ/計測するための**Xcode**です。これを使用して、アプリを構築および**テスト**するために必要な他のコンポーネント（**シミュレーター**や異なる**SDK** **バージョン**など）をダウンロードできます。\
**公式アプリストア**からXcodeを**ダウンロード**することを強くお勧めします。他のバージョンにはマルウェアが含まれている可能性があります。

シミュレーターのファイルは`/Users/<username>/Library/Developer/CoreSimulator/Devices`にあります。

シミュレーターを開くには、Xcodeを実行し、次に_Xcodeタブ_ --> _Open Developer tools_ --> _Simulator_を押します。\
\_\_次の画像で「iPod touch \[...\]」をクリックすると、テストする他のデバイスを選択できます：

![](<../../.gitbook/assets/image (270).png>)

![](<../../.gitbook/assets/image (520).png>)

### Applications in the Simulator

`/Users/<username>/Library/Developer/CoreSimulator/Devices`内には、すべての**インストールされたシミュレーター**が見つかります。エミュレーターの1つ内で作成されたアプリケーションのファイルにアクセスしたい場合、**どのエミュレーターにアプリがインストールされているかを知るのが難しい**ことがあります。**正しいUIDを見つける**ための簡単な方法は、シミュレーターでアプリを実行し、次のコマンドを実行することです：
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Once you know the UID the apps installed within it can be found in `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

しかし、驚くべきことに、ここではアプリケーションを見つけることはできません。`/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`にアクセスする必要があります。

そして、このフォルダーで**アプリケーションのパッケージを見つけることができます。**

## エミュレーター

Corelliumは唯一の公開されているiOSエミュレーターです。これは、ユーザーごとのライセンスモデルを持つ企業向けSaaSソリューションであり、トライアルライセンスは提供されていません。

## ジェイルブレイキング

Appleは、iPhone上で実行されるコードが**Appleによって発行された証明書で署名されている必要がある**と厳格に要求しています。**ジェイルブレイキング**は、そのような制限やOSによって設けられた他のセキュリティ制御を**回避する**プロセスです。したがって、デバイスがジェイルブレイクされると、アプリがインストールされているかどうかを確認する**整合性チェック**がパッチされ、**バイパスされます**。

{% hint style="info" %}
Androidとは異なり、iOSではデバイス上で署名されていない/信頼されていないコードを実行するために「開発者モード」に切り替えることはできません。
{% endhint %}

### Androidのルート化とiOSのジェイルブレイキング

しばしば比較されますが、Androidの**ルート化**とiOSの**ジェイルブレイキング**は根本的に異なるプロセスです。Androidデバイスのルート化には、**`su`バイナリのインストール**や**ルート化されたカスタムROMへのシステムの置き換え**が含まれることがありますが、ブートローダーがアンロックされていれば必ずしもエクスプロイトを必要としません。**カスタムROMのフラッシュ**は、ブートローダーをアンロックした後にデバイスのOSを置き換え、時にはエクスプロイトが必要です。

対照的に、iOSデバイスはブートローダーがApple署名のイメージのみをブートする制限のため、カスタムROMをフラッシュすることができません。**iOSのジェイルブレイキング**は、署名されていないコードを実行するためにAppleのコード署名保護を回避することを目的としており、Appleの継続的なセキュリティ強化によって複雑化しています。

### ジェイルブレイキングの課題

Appleが脆弱性を迅速にパッチするため、iOSのジェイルブレイキングはますます困難になっています。**iOSのダウングレード**はリリース後の限られた時間内でのみ可能であり、ジェイルブレイキングは時間に敏感な問題です。セキュリティテストに使用されるデバイスは、再ジェイルブレイキングが保証されない限り、更新しない方が良いです。

iOSの更新は**チャレンジレスポンスメカニズム**（SHSH blobs）によって制御されており、Apple署名のレスポンスに対してのみインストールが許可されます。このメカニズムは「署名ウィンドウ」として知られ、OTAファームウェアパッケージを保存し、後で使用する能力を制限します。[IPSW Downloads website](https://ipsw.me)は、現在の署名ウィンドウを確認するためのリソースです。

### ジェイルブレイクの種類

* **テザードジェイルブレイク**は、各再起動のためにコンピュータ接続を必要とします。
* **セミテザードジェイルブレイク**は、コンピュータなしで非ジェイルブレイクモードにブートすることを許可します。
* **セミアンテザードジェイルブレイク**は、コンピュータなしで手動で再ジェイルブレイキングを必要とします。
* **アンテザードジェイルブレイク**は、再適用なしで恒久的なジェイルブレイクソリューションを提供します。

### ジェイルブレイキングツールとリソース

ジェイルブレイキングツールはiOSのバージョンとデバイスによって異なります。[Can I Jailbreak?](https://canijailbreak.com)、[The iPhone Wiki](https://www.theiphonewiki.com)、および[Reddit Jailbreak](https://www.reddit.com/r/jailbreak/)などのリソースは最新の情報を提供します。例としては：

* A7-A11チップデバイス用の[Checkra1n](https://checkra.in/)。
* iOS 15.0-16.5のCheckm8デバイス（A8-A11）用の[Palera1n](https://palera.in/)。
* iOSバージョン14.8までの[Unc0ver](https://unc0ver.dev/)。

デバイスを変更することにはリスクが伴い、ジェイルブレイキングは慎重に行うべきです。

### ジェイルブレイキングの利点とリスク

ジェイルブレイキングは**OSによって課せられたサンドボックスを解除し**、アプリがファイルシステム全体にアクセスできるようにします。この自由により、未承認のアプリのインストールやより多くのAPIへのアクセスが可能になります。しかし、一般ユーザーにとって、ジェイルブレイキングは**推奨されません**。潜在的なセキュリティリスクやデバイスの不安定さがあるためです。

### **ジェイルブレイキング後**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **ジェイルブレイク検出**

**いくつかのアプリケーションは、モバイルがジェイルブレイクされているかどうかを検出しようとし、その場合アプリケーションは実行されません**

* iOSをジェイルブレイクした後、**ファイルとフォルダーが通常インストールされ**、これらを検索してデバイスがジェイルブレイクされているかどうかを判断できます。
* ジェイルブレイクされたデバイスでは、アプリケーションが**サンドボックスの外の新しいファイルに対して読み書きアクセスを得ます**
* 一部の**API** **呼び出し**は**異なる動作をします**
* **OpenSSH**サービスの存在
* `/bin/sh`を呼び出すと**0ではなく1を返します**

**ジェイルブレイキングを検出する方法についての詳細情報は**[**こちら**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**。**

この検出を回避するために、**objectionの**`ios jailbreak disable`を使用することができます。

## **ジェイルブレイク検出バイパス**

* この検出を回避するために、**objectionの**`ios jailbreak disable`を使用することができます。
* また、ツール**Liberty Lite**（https://ryleyangus.com/repo/）をインストールすることもできます。リポジトリが追加されると、アプリは「検索」タブに表示されるはずです。

## 参考文献

* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
</details>
{% endhint %}
