# Environnement de test iOS

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR au** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
{% endhint %}

## Programme de d√©veloppement Apple

Une **identit√© de provisionnement** est un ensemble de cl√©s publiques et priv√©es associ√©es √† un compte d√©veloppeur Apple. Pour **signer des applications**, vous devez payer **99$/an** pour vous inscrire au **Programme de d√©veloppement Apple** afin d'obtenir votre identit√© de provisionnement. Sans cela, vous ne pourrez pas ex√©cuter des applications √† partir du code source sur un appareil physique. Une autre option est d'utiliser un **appareil jailbreak√©**.

√Ä partir de Xcode 7.2, Apple a fourni une option pour cr√©er un **profil de provisionnement de d√©veloppement iOS gratuit** qui permet d'√©crire et de tester votre application sur un v√©ritable iPhone. Allez dans _Xcode_ --> _Pr√©f√©rences_ --> _Comptes_ --> _+_ (Ajouter un nouvel ID Appli avec vos identifiants) --> _Cliquez sur l'Apple ID cr√©√©_ --> _G√©rer les certificats_ --> _+_ (D√©veloppement Apple) --> _Termin√©_\
\_\_Ensuite, pour ex√©cuter votre application sur votre iPhone, vous devez d'abord **indiquer √† l'iPhone de faire confiance √† l'ordinateur.** Ensuite, vous pouvez essayer de **lancer l'application sur le mobile depuis Xcode**, mais une erreur appara√Ætra. Allez donc dans _R√©glages_ --> _G√©n√©ral_ --> _Profils et gestion des appareils_ --> S√©lectionnez le profil non approuv√© et cliquez sur "**Faire confiance**".

Notez que **les applications sign√©es par le m√™me certificat de signature peuvent partager des ressources de mani√®re s√©curis√©e, comme les √©l√©ments du trousseau**.

Les profils de provisionnement sont stock√©s dans le t√©l√©phone dans **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulateur**

{% hint style="info" %}
Notez qu'un **simulateur n'est pas la m√™me chose qu'un √©mulateur**. Le simulateur simule simplement le comportement et les fonctions de l'appareil, mais ne les utilise pas r√©ellement.
{% endhint %}

### **Simulateur**

La premi√®re chose que vous devez savoir est que **r√©aliser un pentest dans un simulateur sera beaucoup plus limit√© que de le faire sur un appareil jailbreak√©**.

Tous les outils n√©cessaires pour cr√©er et prendre en charge une application iOS sont **uniquement officiellement pris en charge sur Mac OS**.\
L'outil de facto d'Apple pour cr√©er/d√©boguer/instrumenter des applications iOS est **Xcode**. Il peut √™tre utilis√© pour t√©l√©charger d'autres composants tels que des **simulateurs** et diff√©rentes **versions de SDK** n√©cessaires pour construire et **tester** votre application.\
Il est fortement recommand√© de **t√©l√©charger** Xcode depuis le **magasin d'applications officiel**. D'autres versions peuvent contenir des logiciels malveillants.

Les fichiers du simulateur peuvent √™tre trouv√©s dans `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Pour ouvrir le simulateur, ex√©cutez Xcode, puis appuyez sur l'onglet _Xcode_ --> _Ouvrir les outils de d√©veloppement_ --> _Simulateur_\
\_\_Dans l'image suivante, en cliquant sur "iPod touch \[...\]", vous pouvez s√©lectionner un autre appareil √† tester :

![](<../../.gitbook/assets/image (270).png>)

![](<../../.gitbook/assets/image (520).png>)

### Applications dans le Simulateur

Dans `/Users/<username>/Library/Developer/CoreSimulator/Devices`, vous pouvez trouver tous les **simulateurs install√©s**. Si vous souhaitez acc√©der aux fichiers d'une application cr√©√©e dans l'un des √©mulateurs, il peut √™tre difficile de savoir **dans lequel l'application est install√©e**. Un moyen rapide de **trouver le bon UID** est d'ex√©cuter l'application dans le simulateur et d'ex√©cuter :
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Une fois que vous connaissez le UID, les applications install√©es peuvent √™tre trouv√©es dans `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

Cependant, √©tonnamment, vous ne trouverez pas l'application ici. Vous devez acc√©der √† `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

Et dans ce dossier, vous pouvez **trouver le package de l'application.**

## √âmulateur

Corellium est le seul √©mulateur iOS disponible publiquement. C'est une solution SaaS d'entreprise avec un mod√®le de licence par utilisateur et ne propose pas de licence d'essai.

## Jailbreaking

Apple exige strictement que le code ex√©cut√© sur l'iPhone soit **sign√© par un certificat d√©livr√© par Apple**. **Le jailbreak** est le processus de contournement actif de telles restrictions et d'autres contr√¥les de s√©curit√© mis en place par le syst√®me d'exploitation. Par cons√©quent, une fois que l'appareil est jailbreak√©, le **contr√¥le d'int√©grit√©** qui est responsable de la v√©rification des applications install√©es est patch√©, donc il est **contourn√©**.

{% hint style="info" %}
Contrairement √† Android, **vous ne pouvez pas passer en "Mode D√©veloppeur"** sur iOS pour ex√©cuter du code non sign√©/non fiable sur l'appareil.
{% endhint %}

### Rooting Android vs. Jailbreaking iOS

Bien que souvent compar√©s, **le rooting** sur Android et **le jailbreak** sur iOS sont des processus fondamentalement diff√©rents. Le rooting des appareils Android peut impliquer **l'installation du binaire `su`** ou **le remplacement du syst√®me par un ROM personnalis√© root√©**, ce qui ne n√©cessite pas n√©cessairement d'exploits si le bootloader est d√©verrouill√©. **Flasher des ROM personnalis√©es** remplace le syst√®me d'exploitation de l'appareil apr√®s le d√©verrouillage du bootloader, n√©cessitant parfois un exploit.

En revanche, les appareils iOS ne peuvent pas flasher des ROM personnalis√©es en raison de la restriction du bootloader √† ne d√©marrer que des images sign√©es par Apple. **Le jailbreak iOS** vise √† contourner les protections de signature de code d'Apple pour ex√©cuter du code non sign√©, un processus compliqu√© par les am√©liorations de s√©curit√© continues d'Apple.

### D√©fis du Jailbreaking

Le jailbreak iOS devient de plus en plus difficile car Apple corrige rapidement les vuln√©rabilit√©s. **Le downgrade d'iOS** n'est possible que pendant une p√©riode limit√©e apr√®s une version, rendant le jailbreak une affaire sensible au temps. Les appareils utilis√©s pour les tests de s√©curit√© ne doivent pas √™tre mis √† jour √† moins que le re-jailbreaking ne soit garanti.

Les mises √† jour iOS sont contr√¥l√©es par un **m√©canisme de d√©fi-r√©ponse** (blobs SHSH), permettant l'installation uniquement pour les r√©ponses sign√©es par Apple. Ce m√©canisme, connu sous le nom de "fen√™tre de signature", limite la capacit√© de stocker et d'utiliser ult√©rieurement des packages de firmware OTA. Le site [IPSW Downloads](https://ipsw.me) est une ressource pour v√©rifier les fen√™tres de signature actuelles.

### Vari√©t√©s de Jailbreak

* **Les jailbreaks tethered** n√©cessitent une connexion √† un ordinateur pour chaque red√©marrage.
* **Les jailbreaks semi-tethered** permettent de d√©marrer en mode non jailbreak√© sans ordinateur.
* **Les jailbreaks semi-untethered** n√©cessitent un re-jailbreaking manuel sans avoir besoin d'un ordinateur.
* **Les jailbreaks untethered** offrent une solution de jailbreak permanente sans besoin de r√©application.

### Outils et Ressources de Jailbreaking

Les outils de jailbreak varient selon la version d'iOS et l'appareil. Des ressources telles que [Can I Jailbreak?](https://canijailbreak.com), [The iPhone Wiki](https://www.theiphonewiki.com), et [Reddit Jailbreak](https://www.reddit.com/r/jailbreak/) fournissent des informations √† jour. Des exemples incluent :

* [Checkra1n](https://checkra.in/) pour les appareils avec puces A7-A11.
* [Palera1n](https://palera.in/) pour les appareils Checkm8 (A8-A11) sur iOS 15.0-16.5.
* [Unc0ver](https://unc0ver.dev/) pour les versions iOS jusqu'√† 14.8.

Modifier votre appareil comporte des risques, et le jailbreak doit √™tre abord√© avec prudence.

### Avantages et Risques du Jailbreaking

Le jailbreak **supprime le sandboxing impos√© par le syst√®me d'exploitation**, permettant aux applications d'acc√©der √† l'ensemble du syst√®me de fichiers. Cette libert√© permet l'installation d'applications non approuv√©es et l'acc√®s √† plus d'API. Cependant, pour les utilisateurs r√©guliers, le jailbreak **n'est pas recommand√©** en raison des risques potentiels pour la s√©curit√© et de l'instabilit√© de l'appareil.

### **Apr√®s le Jailbreaking**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **D√©tection de Jailbreak**

**Plusieurs applications essaieront de d√©tecter si le mobile est jailbreak√© et dans ce cas, l'application ne fonctionnera pas**

* Apr√®s le jailbreak, des **fichiers et dossiers sont g√©n√©ralement install√©s**, ceux-ci peuvent √™tre recherch√©s pour d√©terminer si l'appareil est jailbreak√©.
* Dans un appareil jailbreak√©, les applications obtiennent un **acc√®s en lecture/√©criture √† de nouveaux fichiers** en dehors du sandbox
* Certains **appels d'API** **se comporteront diff√©remment**
* La pr√©sence du service **OpenSSH**
* L'appel de `/bin/sh` renverra **1** au lieu de 0

**Plus d'informations sur la fa√ßon de d√©tecter le jailbreak** [**ici**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Vous pouvez essayer d'√©viter ces d√©tections en utilisant **l'option `ios jailbreak disable` d'objection**

## **Contournement de la D√©tection de Jailbreak**

* Vous pouvez essayer d'√©viter ces d√©tections en utilisant **l'option `ios jailbreak disable` d'objection**
* Vous pourriez √©galement installer l'outil **Liberty Lite** (https://ryleyangus.com/repo/). Une fois le d√©p√¥t ajout√©, l'application devrait appara√Ætre dans l'onglet 'Recherche'

## R√©f√©rences

* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR au** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}
</details>
{% endhint %}
