# iOS Testing Environment

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
{% endhint %}

## Apple Developer Program

Uma **identidade de provisionamento** √© uma cole√ß√£o de chaves p√∫blicas e privadas associadas a uma conta de desenvolvedor Apple. Para **assinar aplicativos**, voc√™ precisa pagar **99$/ano** para se registrar no **Apple Developer Program** e obter sua identidade de provisionamento. Sem isso, voc√™ n√£o poder√° executar aplicativos a partir do c√≥digo-fonte em um dispositivo f√≠sico. Outra op√ß√£o para fazer isso √© usar um **dispositivo com jailbreak**.

A partir do Xcode 7.2, a Apple forneceu uma op√ß√£o para criar um **perfil de provisionamento de desenvolvimento iOS gratuito** que permite escrever e testar seu aplicativo em um iPhone real. V√° para _Xcode_ --> _Preferences_ --> _Accounts_ --> _+_ (Adicionar novo Apple ID com suas credenciais) --> _Clique no Apple ID criado_ --> _Manage Certificates_ --> _+_ (Apple Development) --> _Done_\
\_\_Ent√£o, para executar seu aplicativo no seu iPhone, voc√™ precisa primeiro **indicar ao iPhone para confiar no computador.** Depois, voc√™ pode tentar **executar o aplicativo no celular a partir do Xcode,** mas um erro aparecer√°. Ent√£o v√° para _Settings_ --> _General_ --> _Profiles and Device Management_ --> Selecione o perfil n√£o confi√°vel e clique em "**Trust**".

Note que **aplicativos assinados pelo mesmo certificado de assinatura podem compartilhar recursos de maneira segura, como itens do keychain**.

Os perfis de provisionamento s√£o armazenados dentro do telefone em **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulator**

{% hint style="info" %}
Note que um **simulador n√£o √© o mesmo que um emulador**. O simulador apenas simula o comportamento e as fun√ß√µes do dispositivo, mas n√£o os utiliza realmente.
{% endhint %}

### **Simulator**

A primeira coisa que voc√™ precisa saber √© que **realizar um pentest dentro de um simulador ser√° muito mais limitado do que faz√™-lo em um dispositivo com jailbreak**.

Todas as ferramentas necess√°rias para construir e suportar um aplicativo iOS s√£o **apenas oficialmente suportadas no Mac OS**.\
A ferramenta de fato da Apple para criar/debugar/instrumentar aplicativos iOS √© o **Xcode**. Ele pode ser usado para baixar outros componentes, como **simuladores** e diferentes **vers√µes de SDK** necess√°rias para construir e **testar** seu aplicativo.\
√â altamente recomend√°vel **baixar** o Xcode da **loja de aplicativos oficial**. Outras vers√µes podem conter malware.

Os arquivos do simulador podem ser encontrados em `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Para abrir o simulador, execute o Xcode, depois pressione na _aba Xcode_ --> _Open Developer tools_ --> _Simulator_\
\_\_Na imagem a seguir, clicando em "iPod touch \[...\]" voc√™ pode selecionar outro dispositivo para testar:

![](<../../.gitbook/assets/image (270).png>)

![](<../../.gitbook/assets/image (520).png>)

### Applications in the Simulator

Dentro de `/Users/<username>/Library/Developer/CoreSimulator/Devices`, voc√™ pode encontrar todos os **simuladores instalados**. Se voc√™ quiser acessar os arquivos de um aplicativo criado dentro de um dos emuladores, pode ser dif√≠cil saber **em qual o aplicativo est√° instalado**. Uma maneira r√°pida de **encontrar o UID correto** √© executar o aplicativo no simulador e executar:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Uma vez que voc√™ conhece o UID, os aplicativos instalados dentro dele podem ser encontrados em `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

No entanto, surpreendentemente, voc√™ n√£o encontrar√° o aplicativo aqui. Voc√™ precisa acessar `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

E nesta pasta voc√™ pode **encontrar o pacote do aplicativo.**

## Emulador

Corellium √© o √∫nico emulador iOS dispon√≠vel publicamente. √â uma solu√ß√£o SaaS empresarial com um modelo de licen√ßa por usu√°rio e n√£o oferece nenhuma licen√ßa de teste.

## Jailbeaking

A Apple exige estritamente que o c√≥digo executado no iPhone deve ser **assinado por um certificado emitido pela Apple**. **Jailbreaking** √© o processo de **contornar ativamente tais restri√ß√µes** e outros controles de seguran√ßa impostos pelo sistema operacional. Portanto, uma vez que o dispositivo √© jailbroken, a **verifica√ß√£o de integridade** respons√°vel por verificar a instala√ß√£o de aplicativos √© corrigida, de modo que √© **contornada**.

{% hint style="info" %}
Ao contr√°rio do Android, **voc√™ n√£o pode mudar para "Modo Desenvolvedor"** no iOS para executar c√≥digo n√£o assinado/n√£o confi√°vel no dispositivo.
{% endhint %}

### Rooting Android vs. Jailbreaking iOS

Embora frequentemente comparados, **rooting** no Android e **jailbreaking** no iOS s√£o processos fundamentalmente diferentes. O rooting de dispositivos Android pode envolver **instalar o bin√°rio `su`** ou **substituir o sistema por um ROM personalizado com root**, o que n√£o requer necessariamente exploits se o bootloader estiver desbloqueado. **Flashing de ROMs personalizadas** substitui o sistema operacional do dispositivo ap√≥s desbloquear o bootloader, √†s vezes exigindo um exploit.

Em contraste, dispositivos iOS n√£o podem flashar ROMs personalizadas devido √† restri√ß√£o do bootloader de apenas inicializar imagens assinadas pela Apple. **Jailbreaking iOS** visa contornar as prote√ß√µes de assinatura de c√≥digo da Apple para executar c√≥digo n√£o assinado, um processo complicado pelas cont√≠nuas melhorias de seguran√ßa da Apple.

### Desafios do Jailbreaking

Jailbreaking iOS est√° se tornando cada vez mais dif√≠cil, pois a Apple corrige vulnerabilidades rapidamente. **Fazer downgrade do iOS** √© poss√≠vel apenas por um tempo limitado ap√≥s um lan√ßamento, tornando o jailbreaking uma quest√£o sens√≠vel ao tempo. Dispositivos usados para testes de seguran√ßa n√£o devem ser atualizados a menos que o re-jailbreaking seja garantido.

As atualiza√ß√µes do iOS s√£o controladas por um **mecanismo de desafio-resposta** (blobs SHSH), permitindo a instala√ß√£o apenas para respostas assinadas pela Apple. Este mecanismo, conhecido como "janela de assinatura", limita a capacidade de armazenar e usar posteriormente pacotes de firmware OTA. O [site de Downloads IPSW](https://ipsw.me) √© um recurso para verificar as janelas de assinatura atuais.

### Variedades de Jailbreak

* **Jailbreaks tethered** requerem uma conex√£o com o computador para cada reinicializa√ß√£o.
* **Jailbreaks semi-tethered** permitem inicializar em modo n√£o jailbroken sem um computador.
* **Jailbreaks semi-untethered** requerem re-jailbreaking manual sem precisar de um computador.
* **Jailbreaks untethered** oferecem uma solu√ß√£o de jailbreak permanente sem a necessidade de reaplica√ß√£o.

### Ferramentas e Recursos de Jailbreaking

As ferramentas de jailbreaking variam de acordo com a vers√£o do iOS e o dispositivo. Recursos como [Can I Jailbreak?](https://canijailbreak.com), [The iPhone Wiki](https://www.theiphonewiki.com) e [Reddit Jailbreak](https://www.reddit.com/r/jailbreak/) fornecem informa√ß√µes atualizadas. Exemplos incluem:

* [Checkra1n](https://checkra.in/) para dispositivos com chip A7-A11.
* [Palera1n](https://palera.in/) para dispositivos Checkm8 (A8-A11) no iOS 15.0-16.5.
* [Unc0ver](https://unc0ver.dev/) para vers√µes do iOS at√© 14.8.

Modificar seu dispositivo traz riscos, e o jailbreaking deve ser abordado com cautela.

### Benef√≠cios e Riscos do Jailbreaking

O jailbreaking **remove o sandboxing imposto pelo OS**, permitindo que os aplicativos acessem todo o sistema de arquivos. Essa liberdade possibilita a instala√ß√£o de aplicativos n√£o aprovados e o acesso a mais APIs. No entanto, para usu√°rios regulares, o jailbreaking **n√£o √© recomendado** devido a potenciais riscos de seguran√ßa e instabilidade do dispositivo.

### **Ap√≥s o Jailbreaking**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Detec√ß√£o de Jailbreak**

**V√°rios aplicativos tentar√£o detectar se o celular est√° jailbroken e, nesse caso, o aplicativo n√£o ser√° executado**

* Ap√≥s o jailbreaking, arquivos e pastas do iOS **s√£o geralmente instalados**, estes podem ser pesquisados para determinar se o dispositivo est√° jailbroken.
* Em um dispositivo jailbroken, os aplicativos obt√™m **acesso de leitura/grava√ß√£o a novos arquivos** fora do sandbox.
* Algumas **chamadas de API** **comportar-se-√£o de maneira diferente**.
* A presen√ßa do servi√ßo **OpenSSH**.
* Chamar `/bin/sh` retornar√° **1** em vez de 0.

**Mais informa√ß√µes sobre como detectar jailbreaking** [**aqui**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Voc√™ pode tentar evitar essas detec√ß√µes usando **o comando `ios jailbreak disable` do objection**

## **Bypass de Detec√ß√£o de Jailbreak**

* Voc√™ pode tentar evitar essas detec√ß√µes usando **o comando `ios jailbreak disable` do objection**
* Voc√™ tamb√©m pode instalar a ferramenta **Liberty Lite** (https://ryleyangus.com/repo/). Uma vez que o reposit√≥rio √© adicionado, o aplicativo deve aparecer na aba ‚ÄòSearch‚Äô

## Refer√™ncias

* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
</details>
{% endhint %}
