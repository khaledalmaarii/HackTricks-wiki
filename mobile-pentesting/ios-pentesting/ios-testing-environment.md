# iOS Testing Environment

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
{% endhint %}

## Apple Developer Program

Una **identidad de aprovisionamiento** es una colecci√≥n de claves p√∫blicas y privadas que est√°n asociadas a una cuenta de desarrollador de Apple. Para **firmar aplicaciones** necesitas pagar **99$/a√±o** para registrarte en el **Apple Developer Program** y obtener tu identidad de aprovisionamiento. Sin esto, no podr√°s ejecutar aplicaciones desde el c√≥digo fuente en un dispositivo f√≠sico. Otra opci√≥n para hacer esto es usar un **dispositivo con jailbreak**.

A partir de Xcode 7.2, Apple ha proporcionado una opci√≥n para crear un **perfil de aprovisionamiento de desarrollo de iOS gratuito** que permite escribir y probar tu aplicaci√≥n en un iPhone real. Ve a _Xcode_ --> _Preferences_ --> _Accounts_ --> _+_ (Agregar nuevo Apple ID con tus credenciales) --> _Haz clic en el Apple ID creado_ --> _Manage Certificates_ --> _+_ (Desarrollo de Apple) --> _Done_\
\_\_Luego, para ejecutar tu aplicaci√≥n en tu iPhone, primero necesitas **indicar al iPhone que conf√≠e en la computadora.** Luego, puedes intentar **ejecutar la aplicaci√≥n en el m√≥vil desde Xcode,** pero aparecer√° un error. As√≠ que ve a _Settings_ --> _General_ --> _Profiles and Device Management_ --> Selecciona el perfil no confiable y haz clic en "**Trust**".

Ten en cuenta que **las aplicaciones firmadas por el mismo certificado de firma pueden compartir recursos de manera segura, como elementos del llavero**.

Los perfiles de aprovisionamiento se almacenan dentro del tel√©fono en **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulator**

{% hint style="info" %}
Ten en cuenta que un **simulador no es lo mismo que un emulador**. El simulador solo simula el comportamiento del dispositivo y las funciones, pero no las utiliza realmente.
{% endhint %}

### **Simulator**

Lo primero que necesitas saber es que **realizar un pentest dentro de un simulador ser√° mucho m√°s limitado que hacerlo en un dispositivo con jailbreak**.

Todas las herramientas necesarias para construir y soportar una aplicaci√≥n de iOS son **solo oficialmente soportadas en Mac OS**.\
La herramienta de facto de Apple para crear/debuggear/instrumentar aplicaciones de iOS es **Xcode**. Se puede usar para descargar otros componentes como **simuladores** y diferentes **versiones de SDK** requeridas para construir y **probar** tu aplicaci√≥n.\
Se recomienda encarecidamente **descargar** Xcode desde la **tienda de aplicaciones oficial**. Otras versiones pueden contener malware.

Los archivos del simulador se pueden encontrar en `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Para abrir el simulador, ejecuta Xcode, luego presiona en la _pesta√±a de Xcode_ --> _Open Developer tools_ --> _Simulator_\
\_\_En la siguiente imagen, al hacer clic en "iPod touch \[...\]" puedes seleccionar otro dispositivo para probar:

![](<../../.gitbook/assets/image (270).png>)

![](<../../.gitbook/assets/image (520).png>)

### Applications in the Simulator

Dentro de `/Users/<username>/Library/Developer/CoreSimulator/Devices` puedes encontrar todos los **simuladores instalados**. Si deseas acceder a los archivos de una aplicaci√≥n creada dentro de uno de los emuladores, puede ser dif√≠cil saber **en cu√°l est√° instalada la aplicaci√≥n**. Una forma r√°pida de **encontrar el UID correcto** es ejecutar la aplicaci√≥n en el simulador y ejecutar:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Una vez que conozcas el UID, las aplicaciones instaladas dentro de √©l se pueden encontrar en `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

Sin embargo, sorprendentemente no encontrar√°s la aplicaci√≥n aqu√≠. Necesitas acceder a `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

Y en esta carpeta puedes **encontrar el paquete de la aplicaci√≥n.**

## Emulador

Corellium es el √∫nico emulador de iOS disponible p√∫blicamente. Es una soluci√≥n SaaS empresarial con un modelo de licencia por usuario y no ofrece ninguna licencia de prueba.

## Jailbeaking

Apple requiere estrictamente que el c√≥digo que se ejecuta en el iPhone debe estar **firmado por un certificado emitido por Apple**. **Jailbreaking** es el proceso de **eludir tales restricciones** y otros controles de seguridad impuestos por el sistema operativo. Por lo tanto, una vez que el dispositivo est√° jailbroken, la **verificaci√≥n de integridad** que es responsable de verificar las aplicaciones que se instalan est√° parcheada, por lo que es **eludida**.

{% hint style="info" %}
A diferencia de Android, **no puedes cambiar a "Modo Desarrollador"** en iOS para ejecutar c√≥digo no firmado/no confiable en el dispositivo.
{% endhint %}

### Android Rooting vs. iOS Jailbreaking

Aunque a menudo se comparan, **rooting** en Android y **jailbreaking** en iOS son procesos fundamentalmente diferentes. Rootear dispositivos Android puede implicar **instalar el binario `su`** o **reemplazar el sistema con un ROM personalizado con root**, lo que no necesariamente requiere exploits si el bootloader est√° desbloqueado. **Flashear ROMs personalizados** reemplaza el sistema operativo del dispositivo despu√©s de desbloquear el bootloader, a veces requiriendo un exploit.

En contraste, los dispositivos iOS no pueden flashear ROMs personalizados debido a la restricci√≥n del bootloader de solo arrancar im√°genes firmadas por Apple. **Jailbreaking iOS** tiene como objetivo eludir las protecciones de firma de c√≥digo de Apple para ejecutar c√≥digo no firmado, un proceso complicado por las continuas mejoras de seguridad de Apple.

### Desaf√≠os del Jailbreaking

Jailbreaking iOS es cada vez m√°s dif√≠cil ya que Apple parchea las vulnerabilidades r√°pidamente. **Downgrading iOS** solo es posible por un tiempo limitado despu√©s de un lanzamiento, lo que hace que el jailbreaking sea un asunto sensible al tiempo. Los dispositivos utilizados para pruebas de seguridad no deben actualizarse a menos que se garantice el re-jailbreaking.

Las actualizaciones de iOS est√°n controladas por un **mecanismo de desaf√≠o-respuesta** (blobs SHSH), permitiendo la instalaci√≥n solo para respuestas firmadas por Apple. Este mecanismo, conocido como "ventana de firma", limita la capacidad de almacenar y usar m√°s tarde paquetes de firmware OTA. El [sitio web de descargas IPSW](https://ipsw.me) es un recurso para verificar las ventanas de firma actuales.

### Variedades de Jailbreak

* **Jailbreaks atados** requieren una conexi√≥n a computadora para cada reinicio.
* **Jailbreaks semi-atados** permiten arrancar en modo no jailbroken sin una computadora.
* **Jailbreaks semi-desatados** requieren re-jailbreaking manual sin necesidad de una computadora.
* **Jailbreaks desatados** ofrecen una soluci√≥n de jailbreak permanente sin necesidad de re-aplicaci√≥n.

### Herramientas y Recursos de Jailbreaking

Las herramientas de jailbreaking var√≠an seg√∫n la versi√≥n de iOS y el dispositivo. Recursos como [¬øPuedo hacer Jailbreak?](https://canijailbreak.com), [The iPhone Wiki](https://www.theiphonewiki.com) y [Reddit Jailbreak](https://www.reddit.com/r/jailbreak/) proporcionan informaci√≥n actualizada. Ejemplos incluyen:

* [Checkra1n](https://checkra.in/) para dispositivos con chip A7-A11.
* [Palera1n](https://palera.in/) para dispositivos Checkm8 (A8-A11) en iOS 15.0-16.5.
* [Unc0ver](https://unc0ver.dev/) para versiones de iOS hasta 14.8.

Modificar tu dispositivo conlleva riesgos, y el jailbreaking debe abordarse con precauci√≥n.

### Beneficios y Riesgos del Jailbreaking

El jailbreaking **elimina el sandboxing impuesto por el sistema operativo**, permitiendo que las aplicaciones accedan a todo el sistema de archivos. Esta libertad permite la instalaci√≥n de aplicaciones no aprobadas y el acceso a m√°s APIs. Sin embargo, para los usuarios regulares, el jailbreaking **no se recomienda** debido a los posibles riesgos de seguridad y la inestabilidad del dispositivo.

### **Despu√©s del Jailbreaking**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Detecci√≥n de Jailbreak**

**Varias aplicaciones intentar√°n detectar si el m√≥vil est√° jailbroken y en ese caso la aplicaci√≥n no se ejecutar√°**

* Despu√©s de hacer jailbreak a un iOS, **archivos y carpetas suelen ser instalados**, estos pueden ser buscados para determinar si el dispositivo est√° jailbroken.
* En un dispositivo jailbroken, las aplicaciones obtienen **acceso de lectura/escritura a nuevos archivos** fuera del sandbox.
* Algunas **llamadas de API** **se comportar√°n de manera diferente**.
* La presencia del servicio **OpenSSH**.
* Llamar a `/bin/sh` devolver√° **1** en lugar de 0.

**M√°s informaci√≥n sobre c√≥mo detectar el jailbreaking** [**aqu√≠**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Puedes intentar evitar estas detecciones usando **objection's** `ios jailbreak disable`.

## **Evasi√≥n de Detecci√≥n de Jailbreak**

* Puedes intentar evitar estas detecciones usando **objection's** `ios jailbreak disable`.
* Tambi√©n podr√≠as instalar la herramienta **Liberty Lite** (https://ryleyangus.com/repo/). Una vez que se agregue el repositorio, la aplicaci√≥n deber√≠a aparecer en la pesta√±a ‚ÄòBuscar‚Äô.

## Referencias

* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)
{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
</details>
{% endhint %}
