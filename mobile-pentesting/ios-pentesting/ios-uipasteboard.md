<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ä¸Š**å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘ [hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks) å’Œ [hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud) æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


[`UIPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard) å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨å’Œåº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ•°æ®ã€‚æœ‰ä¸¤ç§ç±»å‹çš„å‰ªè´´æ¿ï¼š

* **ç³»ç»ŸèŒƒå›´çš„é€šç”¨å‰ªè´´æ¿**ï¼šç”¨äºä¸**ä»»ä½•åº”ç”¨ç¨‹åº**å…±äº«æ•°æ®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè®¾å¤‡é‡æ–°å¯åŠ¨å’Œåº”ç”¨ç¨‹åºå¸è½½åä»ç„¶ä¿ç•™ï¼ˆè‡ª iOS 10 èµ·ï¼‰ã€‚
* **è‡ªå®šä¹‰/å‘½åçš„å‰ªè´´æ¿**ï¼šç”¨äºä¸**å¦ä¸€ä¸ªåº”ç”¨ç¨‹åº**ï¼ˆä¸è¦å…±äº«çš„åº”ç”¨ç¨‹åºå…·æœ‰ç›¸åŒçš„å›¢é˜Ÿ IDï¼‰æˆ–**åº”ç”¨ç¨‹åºæœ¬èº«**å…±äº«æ•°æ®ï¼ˆå®ƒä»¬ä»…åœ¨åˆ›å»ºå®ƒä»¬çš„è¿›ç¨‹ä¸­å¯ç”¨ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒéæŒä¹…æ€§ï¼ˆè‡ª iOS 10 èµ·ï¼‰ï¼Œå³å®ƒä»¬ä»…åœ¨æ‹¥æœ‰ï¼ˆåˆ›å»ºï¼‰åº”ç”¨ç¨‹åºé€€å‡ºä¹‹å‰å­˜åœ¨ã€‚

ä¸€äº›å®‰å…¨æ³¨æ„äº‹é¡¹ï¼š

* ç”¨æˆ·**æ— æ³•æˆäºˆæˆ–æ‹’ç»**åº”ç”¨ç¨‹åºè¯»å–**å‰ªè´´æ¿**çš„æƒé™ã€‚
* è‡ª iOS 9 èµ·ï¼Œåº”ç”¨ç¨‹åº[æ— æ³•åœ¨åå°è®¿é—®å‰ªè´´æ¿](https://forums.developer.apple.com/thread/13760)ï¼Œè¿™å¯ä»¥å‡è½»åå°å‰ªè´´æ¿ç›‘æ§çš„é£é™©ã€‚
* [Apple è­¦å‘Šå…³äºæŒä¹…å‘½åçš„å‰ªè´´æ¿](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc)å¹¶**ä¸é¼“åŠ±ä½¿ç”¨**ã€‚åº”è¯¥ä½¿ç”¨å…±äº«å®¹å™¨ã€‚
* ä» iOS 10 å¼€å§‹ï¼Œæœ‰ä¸€ä¸ªåä¸º**é€šç”¨å‰ªè´´æ¿**çš„æ–°çš„ Handoff åŠŸèƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ç”¨ã€‚å®ƒå…è®¸**é€šç”¨å‰ªè´´æ¿å†…å®¹åœ¨è®¾å¤‡ä¹‹é—´è‡ªåŠ¨ä¼ è¾“**ã€‚å¦‚æœå¼€å‘äººå‘˜é€‰æ‹©è¿™æ ·åšï¼Œå¯ä»¥ç¦ç”¨æ­¤åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ä¸ºå¤åˆ¶çš„æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´å’Œæ—¥æœŸã€‚

å› æ­¤ï¼Œé‡è¦çš„æ˜¯**æ£€æŸ¥æ•æ„Ÿä¿¡æ¯æ˜¯å¦ä¿å­˜åœ¨å…¨å±€å‰ªè´´æ¿ä¸­**ã€‚\
è¿˜è¦æ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦ä½¿ç”¨å…¨å±€å‰ªè´´æ¿æ•°æ®æ‰§è¡Œæ“ä½œï¼Œå› ä¸ºæ¶æ„åº”ç”¨ç¨‹åºå¯èƒ½ç¯¡æ”¹è¿™äº›æ•°æ®ã€‚

ä¸€ä¸ªåº”ç”¨ç¨‹åºè¿˜å¯ä»¥é˜»æ­¢å…¶ç”¨æˆ·å°†æ•æ„Ÿæ•°æ®å¤åˆ¶åˆ°å‰ªè´´æ¿ä¸­ï¼ˆè¿™æ˜¯æ¨èçš„åšæ³•ï¼‰ã€‚

## é™æ€åˆ†æ

å¯ä»¥ä½¿ç”¨ [`generalPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard/1622106-generalpasteboard?language=objc) è·å–**ç³»ç»ŸèŒƒå›´çš„é€šç”¨å‰ªè´´æ¿**ï¼Œæœç´¢æºä»£ç æˆ–ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä»¥æŸ¥æ‰¾æ­¤æ–¹æ³•ã€‚åœ¨å¤„ç†æ•æ„Ÿæ•°æ®æ—¶ï¼Œåº”é¿å…ä½¿ç”¨ç³»ç»ŸèŒƒå›´çš„é€šç”¨å‰ªè´´æ¿ã€‚

å¯ä»¥ä½¿ç”¨ [`pasteboardWithName:create:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622074-pasteboardwithname?language=objc) æˆ– [`pasteboardWithUniqueName`](https://developer.apple.com/documentation/uikit/uipasteboard/1622087-pasteboardwithuniquename?language=objc) åˆ›å»º**è‡ªå®šä¹‰å‰ªè´´æ¿**ã€‚éªŒè¯è‡ªå®šä¹‰å‰ªè´´æ¿æ˜¯å¦è®¾ç½®ä¸ºæŒä¹…æ€§ï¼Œå› ä¸ºè‡ª iOS 10 èµ·å·²å¼ƒç”¨æ­¤åŠŸèƒ½ã€‚åº”æ”¹ç”¨å…±äº«å®¹å™¨ã€‚

## åŠ¨æ€åˆ†æ

Hook æˆ–è·Ÿè¸ªä»¥ä¸‹å†…å®¹ï¼š

* å¯¹äºç³»ç»ŸèŒƒå›´çš„é€šç”¨å‰ªè´´æ¿ï¼Œä½¿ç”¨ `generalPasteboard`ã€‚
* å¯¹äºè‡ªå®šä¹‰å‰ªè´´æ¿ï¼Œä½¿ç”¨ `pasteboardWithName:create:` å’Œ `pasteboardWithUniqueName`ã€‚

è¿˜å¯ä»¥ Hook æˆ–è·Ÿè¸ªå·²å¼ƒç”¨çš„ [`setPersistent:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622096-setpersistent?language=objc) æ–¹æ³•ï¼Œå¹¶éªŒè¯æ˜¯å¦è°ƒç”¨äº†è¯¥æ–¹æ³•ã€‚

åœ¨**ç›‘è§†**å‰ªè´´æ¿æ—¶ï¼Œå¯ä»¥åŠ¨æ€æ£€ç´¢ä»¥ä¸‹**è¯¦ç»†ä¿¡æ¯**ï¼š

* é€šè¿‡ Hook `pasteboardWithName:create:` å¹¶æ£€æŸ¥å…¶è¾“å…¥å‚æ•°æˆ– `pasteboardWithUniqueName` å¹¶æ£€æŸ¥å…¶è¿”å›å€¼ï¼Œè·å–**å‰ªè´´æ¿åç§°**ã€‚
* è·å–**ç¬¬ä¸€ä¸ªå¯ç”¨çš„å‰ªè´´æ¿é¡¹**ï¼šä¾‹å¦‚ï¼Œå¯¹äºå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `string` æ–¹æ³•ã€‚æˆ–ä½¿ç”¨å…¶ä»–æ–¹æ³•è·å–[æ ‡å‡†æ•°æ®ç±»å‹](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#1654275)çš„æ•°æ®ã€‚
* ä½¿ç”¨ `numberOfItems` è·å–**é¡¹ç›®æ•°é‡**ã€‚
* ä½¿ç”¨[ä¾¿æ·æ–¹æ³•](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#2107142)ï¼ˆè‡ª iOS 10 èµ·ï¼‰æ£€æŸ¥**æ ‡å‡†æ•°æ®ç±»å‹**çš„å­˜åœ¨ï¼Œä¾‹å¦‚ `hasImages`ã€`hasStrings`ã€`hasURLs`ã€‚
* ä½¿ç”¨ [`containsPasteboardTypes:inItemSet:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622100-containspasteboardtypes?language=objc) æ£€æŸ¥**å…¶ä»–æ•°æ®ç±»å‹**ï¼ˆé€šå¸¸æ˜¯ UTIï¼‰ã€‚å¯ä»¥æ£€æŸ¥æ›´å…·ä½“çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚å…¬å…±.png å’Œå…¬å…±.tiffï¼ˆ[UTI](http://web.archive.org/web/20190616231857/https://developer.apple.com/documentation/mobilecoreservices/uttype)ï¼‰ï¼Œæˆ–è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ com.mycompany.myapp.mytypeã€‚è¯·è®°ä½ï¼Œåªæœ‰é‚£äº›â€œå£°æ˜äº†äº†è§£â€è¯¥ç±»å‹çš„åº”ç”¨ç¨‹åºæ‰èƒ½ç†è§£å†™å…¥å‰ªè´´æ¿çš„æ•°æ®ã€‚ä½¿ç”¨ [`itemSetWithPasteboardTypes:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622071-itemsetwithpasteboardtypes?language=objc) å¹¶è®¾ç½®ç›¸åº”çš„ UTI æ¥æ£€ç´¢å®ƒä»¬ã€‚
* é€šè¿‡ Hook `setItems:options:` å¹¶æ£€æŸ¥å…¶é€‰é¡¹ä¸­çš„ `UIPasteboardOptionLocalOnly` æˆ– `UIPasteboardOptionExpirationDate`ï¼Œæ£€æŸ¥æ’é™¤æˆ–è¿‡æœŸçš„é¡¹ç›®ã€‚

å¦‚æœåªæƒ³æŸ¥æ‰¾å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ **objection** çš„ `ios pasteboard monitor` å‘½ä»¤ï¼š

> é’©å…¥ iOS UIPasteboard ç±»å¹¶æ¯ 5 ç§’è½®è¯¢ generalPasteboard ä»¥è·å–æ•°æ®ã€‚å¦‚æœæ‰¾åˆ°ä¸ä¸Šä¸€æ¬¡è½®è¯¢ä¸åŒçš„æ–°æ•°æ®ï¼Œå°†å°†å…¶è¾“å‡ºåˆ°å±å¹•ä¸Šã€‚

æ‚¨è¿˜å¯ä»¥æ„å»ºè‡ªå·±çš„å‰ªè´´æ¿ç›‘è§†å™¨ï¼Œç›‘è§†ä¸Šè¿°ç‰¹å®šä¿¡æ¯ã€‚
ä¾‹å¦‚ï¼Œè¿™ä¸ªè„šæœ¬ï¼ˆçµæ„Ÿæ¥è‡ªäº[objectionçš„å‰ªè´´æ¿ç›‘è§†å™¨](https://github.com/sensepost/objection/blob/b39ee53b5ba2e9a271797d2f3931d79c46dccfdb/agent/src/ios/pasteboard.ts)çš„è„šæœ¬ï¼‰æ¯5ç§’è¯»å–ä¸€æ¬¡å‰ªè´´æ¿é¡¹ç›®ï¼Œå¦‚æœæœ‰æ–°å†…å®¹ï¼Œå°†æ‰“å°å‡ºæ¥ï¼š
```javascript
const UIPasteboard = ObjC.classes.UIPasteboard;
const Pasteboard = UIPasteboard.generalPasteboard();
var items = "";
var count = Pasteboard.changeCount().toString();

setInterval(function () {
const currentCount = Pasteboard.changeCount().toString();
const currentItems = Pasteboard.items().toString();

if (currentCount === count) { return; }

items = currentItems;
count = currentCount;

console.log('[* Pasteboard changed] count: ' + count +
' hasStrings: ' + Pasteboard.hasStrings().toString() +
' hasURLs: ' + Pasteboard.hasURLs().toString() +
' hasImages: ' + Pasteboard.hasImages().toString());
console.log(items);

}, 1000 * 5);
```
# å‚è€ƒèµ„æ–™

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…æƒ³è¦**è·å– PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**æ¨ç‰¹**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud)æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
