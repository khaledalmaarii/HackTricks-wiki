```markdown
<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>


[`UIPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard) ä½¿å¾—åœ¨åº”ç”¨å†…éƒ¨ä»¥åŠåº”ç”¨ä¹‹é—´å…±äº«æ•°æ®æˆä¸ºå¯èƒ½ã€‚æœ‰ä¸¤ç§ç±»å‹çš„å‰ªè´´æ¿ï¼š

* **ç³»ç»Ÿçº§é€šç”¨å‰ªè´´æ¿**ï¼šç”¨äºä¸**ä»»ä½•åº”ç”¨**å…±äº«æ•°æ®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè®¾å¤‡é‡å¯å’Œåº”ç”¨å¸è½½åæ•°æ®ä»ç„¶æŒä¹…å­˜åœ¨ï¼ˆè‡ªiOS 10èµ·ï¼‰ã€‚
* **è‡ªå®šä¹‰/å‘½åå‰ªè´´æ¿**ï¼šç”¨äºä¸**å¦ä¸€ä¸ªåº”ç”¨**ï¼ˆå…·æœ‰ä¸åˆ†äº«åº”ç”¨ç›¸åŒçš„å›¢é˜ŸIDï¼‰æˆ–**åº”ç”¨æœ¬èº«**å…±äº«æ•°æ®ï¼ˆå®ƒä»¬ä»…åœ¨åˆ›å»ºå®ƒä»¬çš„è¿›ç¨‹ä¸­å¯ç”¨ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¯éæŒä¹…çš„ï¼ˆè‡ªiOS 10èµ·ï¼‰ï¼Œå³å®ƒä»¬åªå­˜åœ¨äºæ‹¥æœ‰ï¼ˆåˆ›å»ºï¼‰åº”ç”¨é€€å‡ºä¹‹å‰ã€‚

ä¸€äº›å®‰å…¨è€ƒè™‘ï¼š

* ç”¨æˆ·**æ— æ³•æˆäºˆæˆ–æ‹’ç»**åº”ç”¨è¯»å–**å‰ªè´´æ¿**çš„æƒé™ã€‚
* è‡ªiOS 9èµ·ï¼Œåº”ç”¨[æ— æ³•åœ¨åå°è®¿é—®å‰ªè´´æ¿](https://forums.developer.apple.com/thread/13760)ï¼Œè¿™å‡å°‘äº†åå°å‰ªè´´æ¿ç›‘æ§çš„å¯èƒ½æ€§ã€‚
* [è‹¹æœè­¦å‘ŠæŒä¹…åŒ–å‘½åå‰ªè´´æ¿](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc)å¹¶**ä¸æ¨èä½¿ç”¨**ã€‚ç›¸åï¼Œåº”ä½¿ç”¨å…±äº«å®¹å™¨ã€‚
* ä»iOS 10å¼€å§‹ï¼Œæœ‰ä¸€ä¸ªåä¸º**é€šç”¨å‰ªè´´æ¿**çš„æ–°HandoffåŠŸèƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å¯ç”¨çš„ã€‚å®ƒå…è®¸**é€šç”¨å‰ªè´´æ¿å†…å®¹åœ¨è®¾å¤‡ä¹‹é—´è‡ªåŠ¨ä¼ è¾“**ã€‚å¦‚æœå¼€å‘è€…é€‰æ‹©ï¼Œå¯ä»¥ç¦ç”¨æ­¤åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ä¸ºå¤åˆ¶çš„æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´å’Œæ—¥æœŸã€‚

å› æ­¤ï¼Œé‡è¦çš„æ˜¯**æ£€æŸ¥æ•æ„Ÿä¿¡æ¯æ˜¯å¦è¢«ä¿å­˜åœ¨å…¨å±€å‰ªè´´æ¿ä¸­**ã€‚\
åŒæ ·é‡è¦çš„æ˜¯æ£€æŸ¥**åº”ç”¨æ˜¯å¦ä½¿ç”¨å…¨å±€å‰ªè´´æ¿æ•°æ®æ‰§è¡Œæ“ä½œ**ï¼Œå› ä¸ºæ¶æ„åº”ç”¨å¯èƒ½ç¯¡æ”¹è¿™äº›æ•°æ®ã€‚

**åº”ç”¨ä¹Ÿå¯ä»¥é˜»æ­¢ç”¨æˆ·å°†æ•æ„Ÿæ•°æ®å¤åˆ¶åˆ°å‰ªè´´æ¿**ï¼ˆè¿™æ˜¯æ¨èçš„åšæ³•ï¼‰ã€‚

## é™æ€åˆ†æ

å¯ä»¥é€šè¿‡ä½¿ç”¨[`generalPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard/1622106-generalpasteboard?language=objc)è·å–**ç³»ç»Ÿçº§é€šç”¨å‰ªè´´æ¿**ï¼Œæœç´¢æºä»£ç æˆ–ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„è¿™ä¸ªæ–¹æ³•ã€‚å¤„ç†æ•æ„Ÿæ•°æ®æ—¶åº”é¿å…ä½¿ç”¨ç³»ç»Ÿçº§é€šç”¨å‰ªè´´æ¿ã€‚

**è‡ªå®šä¹‰å‰ªè´´æ¿**å¯ä»¥é€šè¿‡[`pasteboardWithName:create:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622074-pasteboardwithname?language=objc)æˆ–[`pasteboardWithUniqueName`](https://developer.apple.com/documentation/uikit/uipasteboard/1622087-pasteboardwithuniquename?language=objc)åˆ›å»ºã€‚éªŒè¯è‡ªå®šä¹‰å‰ªè´´æ¿æ˜¯å¦è®¾ç½®ä¸ºæŒä¹…åŒ–ï¼Œå› ä¸ºè¿™è‡ªiOS 10èµ·å·²è¢«å¼ƒç”¨ã€‚åº”è¯¥ä½¿ç”¨å…±äº«å®¹å™¨ä»£æ›¿ã€‚

## åŠ¨æ€åˆ†æ

Hookæˆ–è¿½è¸ªä»¥ä¸‹å†…å®¹ï¼š

* `generalPasteboard` ç”¨äºç³»ç»Ÿçº§é€šç”¨å‰ªè´´æ¿ã€‚
* `pasteboardWithName:create:` å’Œ `pasteboardWithUniqueName` ç”¨äºè‡ªå®šä¹‰å‰ªè´´æ¿ã€‚

æ‚¨è¿˜å¯ä»¥Hookæˆ–è¿½è¸ªå·²å¼ƒç”¨çš„[`setPersistent:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622096-setpersistent?language=objc)æ–¹æ³•å¹¶éªŒè¯æ˜¯å¦è°ƒç”¨äº†å®ƒã€‚

åœ¨**ç›‘æ§**å‰ªè´´æ¿æ—¶ï¼Œæœ‰å‡ ä¸ª**ç»†èŠ‚**å¯ä»¥åŠ¨æ€**æ£€ç´¢**ï¼š

* é€šè¿‡Hook `pasteboardWithName:create:` å¹¶æ£€æŸ¥å…¶è¾“å…¥å‚æ•°æˆ– `pasteboardWithUniqueName` å¹¶æ£€æŸ¥å…¶è¿”å›å€¼æ¥è·å–**å‰ªè´´æ¿åç§°**ã€‚
* è·å–**ç¬¬ä¸€ä¸ªå¯ç”¨çš„å‰ªè´´æ¿é¡¹**ï¼šä¾‹å¦‚ï¼Œå¯¹äºå­—ç¬¦ä¸²ä½¿ç”¨`string`æ–¹æ³•ã€‚æˆ–è€…ä½¿ç”¨å…¶ä»–æ–¹æ³•æ¥å¤„ç†[æ ‡å‡†æ•°æ®ç±»å‹](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#1654275)ã€‚
* ä½¿ç”¨`numberOfItems`è·å–**é¡¹ç›®æ•°é‡**ã€‚
* ä½¿ç”¨[ä¾¿æ·æ–¹æ³•](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#2107142)æ£€æŸ¥**æ ‡å‡†æ•°æ®ç±»å‹çš„å­˜åœ¨**ï¼Œä¾‹å¦‚`hasImages`ã€`hasStrings`ã€`hasURLs`ï¼ˆä»iOS 10å¼€å§‹ï¼‰ã€‚
* ä½¿ç”¨[`containsPasteboardTypes:inItemSet:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622100-containspasteboardtypes?language=objc)æ£€æŸ¥**å…¶ä»–æ•°æ®ç±»å‹**ï¼ˆé€šå¸¸æ˜¯UTIsï¼‰ã€‚æ‚¨å¯ä»¥æ£€æŸ¥æ›´å…·ä½“çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚public.pngå’Œpublic.tiffï¼ˆ[UTIs](http://web.archive.org/web/20190616231857/https://developer.apple.com/documentation/mobilecoreservices/uttype)ï¼‰æˆ–è‡ªå®šä¹‰æ•°æ®ï¼Œå¦‚com.mycompany.myapp.mytypeã€‚è¯·è®°ä½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰é‚£äº›_å£°æ˜äº†å¯¹è¯¥ç±»å‹äº†è§£_çš„åº”ç”¨æ‰èƒ½ç†è§£å†™å…¥å‰ªè´´æ¿çš„æ•°æ®ã€‚ä½¿ç”¨[`itemSetWithPasteboardTypes:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622071-itemsetwithpasteboardtypes?language=objc)å¹¶è®¾ç½®ç›¸åº”çš„UTIsæ¥æ£€ç´¢å®ƒä»¬ã€‚
* é€šè¿‡Hook `setItems:options:` å¹¶æ£€æŸ¥å…¶é€‰é¡¹ä¸­çš„ `UIPasteboardOptionLocalOnly` æˆ– `UIPasteboardOptionExpirationDate` æ¥æ£€æŸ¥æ’é™¤æˆ–å³å°†è¿‡æœŸçš„é¡¹ç›®ã€‚

å¦‚æœåªå¯»æ‰¾å­—ç¬¦ä¸²ï¼Œæ‚¨å¯èƒ½æƒ³ä½¿ç”¨**objection**çš„å‘½ä»¤`ios pasteboard monitor`ï¼š

> Hookè¿›iOS UIPasteboardç±»å¹¶æ¯5ç§’è½®è¯¢ä¸€æ¬¡generalPasteboardä¸­çš„æ•°æ®ã€‚å¦‚æœå‘ç°æ–°æ•°æ®ï¼Œä¸ä¸Šä¸€æ¬¡è½®è¯¢çš„æ•°æ®ä¸åŒï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®å°†è¢«æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚

æ‚¨ä¹Ÿå¯ä»¥æ„å»ºè‡ªå·±çš„å‰ªè´´æ¿ç›‘æ§å™¨ï¼Œç›‘æ§ä¸Šè¿°ç‰¹å®šä¿¡æ¯ã€‚

ä¾‹å¦‚ï¼Œè¿™ä¸ªè„šæœ¬ï¼ˆå—åˆ°[objectionçš„å‰ªè´´æ¿ç›‘æ§å™¨](https://github.com/sensepost/objection/blob/b39ee53b5ba2e9a271797d2f3931d79c46dccfdb/agent/src/ios/pasteboard.ts)è„šæœ¬çš„å¯å‘ï¼‰æ¯5ç§’è¯»å–ä¸€æ¬¡å‰ªè´´æ¿é¡¹ç›®ï¼Œå¦‚æœæœ‰æ–°å†…å®¹ï¼Œå®ƒå°†æ‰“å°å‡ºæ¥ï¼š
```
```javascript
const UIPasteboard = ObjC.classes.UIPasteboard;
const Pasteboard = UIPasteboard.generalPasteboard();
var items = "";
var count = Pasteboard.changeCount().toString();

setInterval(function () {
const currentCount = Pasteboard.changeCount().toString();
const currentItems = Pasteboard.items().toString();

if (currentCount === count) { return; }

items = currentItems;
count = currentCount;

console.log('[* Pasteboard changed] count: ' + count +
' hasStrings: ' + Pasteboard.hasStrings().toString() +
' hasURLs: ' + Pasteboard.hasURLs().toString() +
' hasImages: ' + Pasteboard.hasImages().toString());
console.log(items);

}, 1000 * 5);
```
# å‚è€ƒèµ„æ–™

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
