{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


Le partage de donn√©es au sein et entre les applications sur les appareils iOS est facilit√© par le m√©canisme [`UIPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard), qui est divis√© en deux cat√©gories principales :

- **Presse-papiers g√©n√©ral √† l'√©chelle du syst√®me** : Cela est utilis√© pour partager des donn√©es avec **n'importe quelle application** et est con√ßu pour persister les donn√©es √† travers les red√©marrages de l'appareil et les d√©sinstallations d'applications, une fonctionnalit√© disponible depuis iOS 10.
- **Presse-papiers personnalis√©s / nomm√©s** : Ceux-ci sont sp√©cifiquement destin√©s au partage de donn√©es **au sein d'une application ou avec une autre application** qui partage le m√™me identifiant d'√©quipe, et ne sont pas con√ßus pour persister au-del√† de la dur√©e du processus d'application qui les cr√©e, suivant les changements introduits dans iOS 10.

**Les consid√©rations de s√©curit√©** jouent un r√¥le significatif lors de l'utilisation des presse-papiers. Par exemple :
- Il n'existe aucun m√©canisme permettant aux utilisateurs de g√©rer les autorisations des applications pour acc√©der au **presse-papiers**.
- Pour att√©nuer le risque de surveillance non autoris√©e en arri√®re-plan du presse-papiers, l'acc√®s est restreint aux moments o√π l'application est au premier plan (depuis iOS 9).
- L'utilisation de presse-papiers nomm√©s persistants est d√©courag√©e au profit de conteneurs partag√©s en raison de pr√©occupations en mati√®re de confidentialit√©.
- La fonctionnalit√© **Universal Clipboard** introduite avec iOS 10, permettant de partager du contenu entre les appareils via le presse-papiers g√©n√©ral, peut √™tre g√©r√©e par les d√©veloppeurs pour d√©finir l'expiration des donn√©es et d√©sactiver le transfert automatique de contenu.

Il est crucial de s'assurer que **les informations sensibles ne sont pas stock√©es par inadvertance** sur le presse-papiers global. De plus, les applications doivent √™tre con√ßues pour emp√™cher l'utilisation abusive des donn√©es du presse-papiers global pour des actions non intentionnelles, et les d√©veloppeurs sont encourag√©s √† mettre en ≈ìuvre des mesures pour emp√™cher la copie d'informations sensibles dans le presse-papiers.

### Analyse statique

Pour l'analyse statique, recherchez dans le code source ou le binaire :
- `generalPasteboard` pour identifier l'utilisation du **presse-papiers g√©n√©ral √† l'√©chelle du syst√®me**.
- `pasteboardWithName:create:` et `pasteboardWithUniqueName` pour cr√©er des **presse-papiers personnalis√©s**. V√©rifiez si la persistance est activ√©e, bien que cela soit obsol√®te.

### Analyse dynamique

L'analyse dynamique implique de brancher ou de tracer des m√©thodes sp√©cifiques :
- Surveillez `generalPasteboard` pour une utilisation √† l'√©chelle du syst√®me.
- Tracez `pasteboardWithName:create:` et `pasteboardWithUniqueName` pour des impl√©mentations personnalis√©es.
- Observez les appels de m√©thode obsol√®tes `setPersistent:` pour v√©rifier les param√®tres de persistance.

Les d√©tails cl√©s √† surveiller incluent :
- **Noms de presse-papiers** et **contenus** (par exemple, v√©rifier les cha√Ænes, les URL, les images).
- **Nombre d'√©l√©ments** et **types de donn√©es** pr√©sents, en utilisant des v√©rifications de types de donn√©es standard et personnalis√©s.
- **Options d'expiration et locales uniquement** en inspectant la m√©thode `setItems:options:`.

Un exemple d'utilisation d'outil de surveillance est le **moniteur de presse-papiers d'objection**, qui interroge le generalPasteboard toutes les 5 secondes pour d√©tecter les changements et affiche les nouvelles donn√©es.

Voici un exemple simple de script JavaScript, inspir√© de l'approche d'objection, pour lire et enregistrer les changements du presse-papiers toutes les 5 secondes :
```javascript
const UIPasteboard = ObjC.classes.UIPasteboard;
const Pasteboard = UIPasteboard.generalPasteboard();
var items = "";
var count = Pasteboard.changeCount().toString();

setInterval(function () {
const currentCount = Pasteboard.changeCount().toString();
const currentItems = Pasteboard.items().toString();

if (currentCount === count) { return; }

items = currentItems;
count = currentCount;

console.log('[* Pasteboard changed] count: ' + count +
' hasStrings: ' + Pasteboard.hasStrings().toString() +
' hasURLs: ' + Pasteboard.hasURLs().toString() +
' hasImages: ' + Pasteboard.hasImages().toString());
console.log(items);

}, 1000 * 5);
```
## R√©f√©rences

* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)
* [https://hackmd.io/@robihamanto/owasp-robi](https://hackmd.io/@robihamanto/owasp-robi)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0073/](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0073/)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
