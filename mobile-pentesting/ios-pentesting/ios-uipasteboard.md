{% hint style="success" %}
Aprenda e pratique AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


O compartilhamento de dados dentro e entre aplicativos em dispositivos iOS √© facilitado pelo mecanismo [`UIPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard), que √© dividido em duas categorias principais:

- **√Årea de transfer√™ncia geral do sistema**: Esta √© usada para compartilhar dados com **qualquer aplicativo** e √© projetada para persistir dados entre reinicializa√ß√µes do dispositivo e desinstala√ß√µes de aplicativos, um recurso que est√° dispon√≠vel desde o iOS 10.
- **√Åreas de transfer√™ncia personalizadas / nomeadas**: Estas s√£o especificamente para compartilhamento de dados **dentro de um aplicativo ou com outro aplicativo** que compartilha o mesmo ID de equipe, e n√£o s√£o projetadas para persistir al√©m da vida do processo do aplicativo que as cria, seguindo as mudan√ßas introduzidas no iOS 10.

**Considera√ß√µes de seguran√ßa** desempenham um papel significativo ao utilizar √°reas de transfer√™ncia. Por exemplo:
- N√£o h√° mecanismo para os usu√°rios gerenciarem permiss√µes de aplicativos para acessar a **√°rea de transfer√™ncia**.
- Para mitigar o risco de monitoramento n√£o autorizado em segundo plano da √°rea de transfer√™ncia, o acesso √© restrito a quando o aplicativo est√° em primeiro plano (desde o iOS 9).
- O uso de √°reas de transfer√™ncia nomeadas persistentes √© desencorajado em favor de cont√™ineres compartilhados devido a preocupa√ß√µes de privacidade.
- O recurso **Clipboard Universal** introduzido com o iOS 10, permitindo que o conte√∫do seja compartilhado entre dispositivos via a √°rea de transfer√™ncia geral, pode ser gerenciado pelos desenvolvedores para definir a expira√ß√£o de dados e desativar a transfer√™ncia autom√°tica de conte√∫do.

Garantir que **informa√ß√µes sens√≠veis n√£o sejam armazenadas inadvertidamente** na √°rea de transfer√™ncia global √© crucial. Al√©m disso, os aplicativos devem ser projetados para evitar o uso indevido de dados da √°rea de transfer√™ncia global para a√ß√µes n√£o intencionais, e os desenvolvedores s√£o incentivados a implementar medidas para evitar a c√≥pia de informa√ß√µes sens√≠veis para a √°rea de transfer√™ncia.

### An√°lise Est√°tica

Para an√°lise est√°tica, procure no c√≥digo-fonte ou bin√°rio por:
- `generalPasteboard` para identificar o uso da **√°rea de transfer√™ncia geral do sistema**.
- `pasteboardWithName:create:` e `pasteboardWithUniqueName` para criar **√°reas de transfer√™ncia personalizadas**. Verifique se a persist√™ncia est√° habilitada, embora isso esteja obsoleto.

### An√°lise Din√¢mica

A an√°lise din√¢mica envolve a intercepta√ß√£o ou rastreamento de m√©todos espec√≠ficos:
- Monitore `generalPasteboard` para uso em todo o sistema.
- Rastreie `pasteboardWithName:create:` e `pasteboardWithUniqueName` para implementa√ß√µes personalizadas.
- Observe chamadas de m√©todo obsoleto `setPersistent:` para verificar configura√ß√µes de persist√™ncia.

Detalhes importantes a serem monitorados incluem:
- **Nomes da √°rea de transfer√™ncia** e **conte√∫dos** (por exemplo, verificando strings, URLs, imagens).
- **N√∫mero de itens** e **tipos de dados** presentes, aproveitando verifica√ß√µes de tipos de dados padr√£o e personalizados.
- **Op√ß√µes de expira√ß√£o e locais apenas** inspecionando o m√©todo `setItems:options:`.

Um exemplo de uso de ferramenta de monitoramento √© o **monitor de √°rea de transfer√™ncia do objection**, que verifica a generalPasteboard a cada 5 segundos em busca de altera√ß√µes e exibe os novos dados.

Aqui est√° um exemplo simples de script JavaScript, inspirado na abordagem do objection, para ler e registrar altera√ß√µes da √°rea de transfer√™ncia a cada 5 segundos:
```javascript
const UIPasteboard = ObjC.classes.UIPasteboard;
const Pasteboard = UIPasteboard.generalPasteboard();
var items = "";
var count = Pasteboard.changeCount().toString();

setInterval(function () {
const currentCount = Pasteboard.changeCount().toString();
const currentItems = Pasteboard.items().toString();

if (currentCount === count) { return; }

items = currentItems;
count = currentCount;

console.log('[* Pasteboard changed] count: ' + count +
' hasStrings: ' + Pasteboard.hasStrings().toString() +
' hasURLs: ' + Pasteboard.hasURLs().toString() +
' hasImages: ' + Pasteboard.hasImages().toString());
console.log(items);

}, 1000 * 5);
```
## Refer√™ncias

* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)
* [https://hackmd.io/@robihamanto/owasp-robi](https://hackmd.io/@robihamanto/owasp-robi)
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0073/](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0073/)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
