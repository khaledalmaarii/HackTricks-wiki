<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Travaillez-vous dans une entreprise de **cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **groupe Discord** ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [dÃ©pÃ´t hacktricks](https://github.com/carlospolop/hacktricks) et au [dÃ©pÃ´t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


Le [`UIPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard) permet de partager des donnÃ©es au sein d'une application et entre une application et d'autres applications. Il existe deux types de pasteboards :

* **pasteboard gÃ©nÃ©ral Ã  l'Ã©chelle du systÃ¨me** : pour partager des donnÃ©es avec **n'importe quelle application**. Persistant par dÃ©faut aprÃ¨s le redÃ©marrage de l'appareil et la dÃ©sinstallation de l'application (depuis iOS 10).
* **pasteboards personnalisÃ©s / nommÃ©s** : pour partager des donnÃ©es **avec une autre application** (ayant le mÃªme ID d'Ã©quipe que l'application Ã  partir de laquelle partager) ou avec **l'application elle-mÃªme** (ils ne sont disponibles que dans le processus qui les crÃ©e). Non persistant par dÃ©faut (depuis iOS 10), c'est-Ã -dire qu'il n'existe que jusqu'Ã  ce que l'application propriÃ©taire (crÃ©atrice) se ferme.

Quelques considÃ©rations de sÃ©curitÃ© :

* Les utilisateurs **ne peuvent pas accorder ou refuser l'autorisation** aux applications de lire le **pasteboard**.
* Depuis iOS 9, les applications [ne peuvent pas accÃ©der au pasteboard en arriÃ¨re-plan](https://forums.developer.apple.com/thread/13760), ce qui attÃ©nue la surveillance du pasteboard en arriÃ¨re-plan.
* [Apple met en garde contre les pasteboards nommÃ©s persistants](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc) et **dÃ©conseille leur utilisation**. Ã€ la place, des conteneurs partagÃ©s doivent Ãªtre utilisÃ©s.
* Ã€ partir d'iOS 10, il existe une nouvelle fonctionnalitÃ© Handoff appelÃ©e **Presse-papiers universel** qui est activÃ©e par dÃ©faut. Elle permet le **transfert automatique du contenu du pasteboard gÃ©nÃ©ral entre les appareils**. Cette fonctionnalitÃ© peut Ãªtre dÃ©sactivÃ©e si le dÃ©veloppeur choisit de le faire et il est Ã©galement possible de dÃ©finir une date et une heure d'expiration pour les donnÃ©es copiÃ©es.

Il est donc important de **vÃ©rifier que des informations sensibles ne sont pas enregistrÃ©es dans le pasteboard gÃ©nÃ©ral**.\
Il est Ã©galement important de vÃ©rifier qu'une **application n'utilise pas les donnÃ©es du pasteboard gÃ©nÃ©ral pour effectuer des actions**, car une application malveillante pourrait altÃ©rer ces donnÃ©es.

Une **application peut Ã©galement empÃªcher ses utilisateurs de copier des donnÃ©es sensibles dans le presse-papiers** (ce qui est recommandÃ©).

## Analyse statique

Le **pasteboard gÃ©nÃ©ral Ã  l'Ã©chelle du systÃ¨me** peut Ãªtre obtenu en utilisant [`generalPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard/1622106-generalpasteboard?language=objc), recherchez dans le code source ou le binaire compilÃ© cette mÃ©thode. L'utilisation du pasteboard gÃ©nÃ©ral Ã  l'Ã©chelle du systÃ¨me doit Ãªtre Ã©vitÃ©e lorsqu'il s'agit de donnÃ©es sensibles.

Des **pasteboards personnalisÃ©s** peuvent Ãªtre crÃ©Ã©s avec [`pasteboardWithName:create:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622074-pasteboardwithname?language=objc) ou [`pasteboardWithUniqueName`](https://developer.apple.com/documentation/uikit/uipasteboard/1622087-pasteboardwithuniquename?language=objc). VÃ©rifiez si les pasteboards personnalisÃ©s sont dÃ©finis comme persistants car cela est dÃ©conseillÃ© depuis iOS 10. Un conteneur partagÃ© doit Ãªtre utilisÃ© Ã  la place.

## Analyse dynamique

Accrochez ou tracez les Ã©lÃ©ments suivants :

* `generalPasteboard` pour le pasteboard gÃ©nÃ©ral Ã  l'Ã©chelle du systÃ¨me.
* `pasteboardWithName:create:` et `pasteboardWithUniqueName` pour les pasteboards personnalisÃ©s.

Vous pouvez Ã©galement accrocher ou tracer la mÃ©thode dÃ©prÃ©ciÃ©e [`setPersistent:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622096-setpersistent?language=objc) et vÃ©rifier si elle est appelÃ©e.

Lors de la **surveillance** des **pasteboards**, plusieurs **dÃ©tails** peuvent Ãªtre rÃ©cupÃ©rÃ©s de maniÃ¨re dynamique :

* Obtenez le **nom du pasteboard** en accrochant `pasteboardWithName:create:` et en inspectant ses paramÃ¨tres d'entrÃ©e ou `pasteboardWithUniqueName` et en inspectant sa valeur de retour.
* Obtenez le **premier Ã©lÃ©ment de pasteboard disponible** : par exemple, pour les chaÃ®nes, utilisez la mÃ©thode `string`. Ou utilisez l'une des autres mÃ©thodes pour les [types de donnÃ©es standard](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#1654275).
* Obtenez le **nombre d'Ã©lÃ©ments** avec `numberOfItems`.
* VÃ©rifiez l'**existence de types de donnÃ©es standard** avec les [mÃ©thodes de commoditÃ©](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#2107142), par exemple `hasImages`, `hasStrings`, `hasURLs` (Ã  partir d'iOS 10).
* VÃ©rifiez les **autres types de donnÃ©es** (gÃ©nÃ©ralement des UTI) avec [`containsPasteboardTypes:inItemSet:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622100-containspasteboardtypes?language=objc). Vous pouvez inspecter des types de donnÃ©es plus concrets, tels qu'une image en tant que public.png et public.tiff ([UTIs](http://web.archive.org/web/20190616231857/https://developer.apple.com/documentation/mobilecoreservices/uttype)) ou des donnÃ©es personnalisÃ©es telles que com.mycompany.myapp.mytype. N'oubliez pas que, dans ce cas, seules les applications qui _dÃ©clarent leur connaissance_ du type sont capables de comprendre les donnÃ©es Ã©crites dans le pasteboard. RÃ©cupÃ©rez-les Ã  l'aide de [`itemSetWithPasteboardTypes:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622071-itemsetwithpasteboardtypes?language=objc) et en dÃ©finissant les UTI correspondants.
* VÃ©rifiez les Ã©lÃ©ments exclus ou expirants en accrochant `setItems:options:` et en inspectant ses options pour `UIPasteboardOptionLocalOnly` ou `UIPasteboardOptionExpirationDate`.

Si vous ne recherchez que des chaÃ®nes, vous pouvez utiliser la commande **objection** `ios pasteboard monitor` :

> Se connecte Ã  la classe UIPasteboard d'iOS et interroge le pasteboard gÃ©nÃ©ral toutes les 5 secondes pour obtenir des donnÃ©es. Si de nouvelles donnÃ©es sont trouvÃ©es, diffÃ©rentes de la prÃ©cÃ©dente interrogation, ces donnÃ©es seront affichÃ©es Ã  l'Ã©cran.

Vous pouvez Ã©galement crÃ©er votre propre moniteur de pasteboard qui surveille des informations spÃ©cifiques comme indiquÃ© ci-dessus.

Par exemple, ce script (inspirÃ© du script derriÃ¨re [le moniteur de pasteboard d'objection](https://github.com/sensepost/objection/blob/b39ee53b5ba2e9a271797d2f3931d79c46dccfdb/agent/src/ios/pasteboard.ts)) lit les Ã©lÃ©ments du pasteboard toutes les 5 secondes, s'il y a quelque chose de nouveau, il l'imprime :
```javascript
const UIPasteboard = ObjC.classes.UIPasteboard;
    const Pasteboard = UIPasteboard.generalPasteboard();
    var items = "";
    var count = Pasteboard.changeCount().toString();

setInterval(function () {
      const currentCount = Pasteboard.changeCount().toString();
      const currentItems = Pasteboard.items().toString();

      if (currentCount === count) { return; }

      items = currentItems;
      count = currentCount;

      console.log('[* Pasteboard changed] count: ' + count +
      ' hasStrings: ' + Pasteboard.hasStrings().toString() +
      ' hasURLs: ' + Pasteboard.hasURLs().toString() +
      ' hasImages: ' + Pasteboard.hasImages().toString());
      console.log(items);

    }, 1000 * 5);
```
# RÃ©fÃ©rences

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Travaillez-vous dans une entreprise de **cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
