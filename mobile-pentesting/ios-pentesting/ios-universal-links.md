# iOS Universal Links


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## Wprowadzenie

Linki uniwersalne oferuj **bezproblemowe przekierowanie** u偶ytkownik贸w, otwierajc bezporednio treci w aplikacji, omijajc potrzeb przekierowania do Safari. Te linki s **unikalne** i bezpieczne, poniewa偶 nie mog by przejte przez inne aplikacje. Zapewnia to umieszczenie pliku `apple-app-site-association` w katalogu g贸wnym witryny, ustanawiajc weryfikowalny link midzy witryn a aplikacj. W przypadkach, gdy aplikacja nie jest zainstalowana, Safari przejmuje kontrol i kieruje u偶ytkownika na stron internetow, utrzymujc obecno aplikacji.

Dla tester贸w penetracyjnych plik `apple-app-site-association` jest szczeg贸lnie interesujcy, poniewa偶 mo偶e ujawnia **wra偶liwe cie偶ki**, potencjalnie w tym te zwizane z niewydanymi funkcjami.

### **Analiza uprawnie zwizanych z domenami**

Programici wczaj linki uniwersalne, konfigurujc **Zwizane Domeny** w zakadce Capabilities w Xcode lub przegldajc plik `.entitlements`. Ka偶da domena jest poprzedzona `applinks:`. Na przykad, konfiguracja Telegrama mo偶e wyglda nastpujco:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Dla bardziej szczeg贸owych informacji, zapoznaj si z [archiwaln dokumentacj dewelopera Apple](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Jeli pracujesz z skompilowan aplikacj, uprawnienia mo偶na wyodrbni zgodnie z opisem w [tym przewodniku](extracting-entitlements-from-compiled-application.md).

### **Pobieranie pliku Apple App Site Association**

Plik `apple-app-site-association` powinien by pobrany z serwera przy u偶yciu domen okrelonych w uprawnieniach. Upewnij si, 偶e plik jest dostpny przez HTTPS bezporednio pod adresem `https://<domain>/apple-app-site-association`. Narzdzia takie jak [Apple App Site Association (AASA) Validator](https://branch.io/resources/aasa-validator/) mog pom贸c w tym procesie.

### **Obsuga link贸w uniwersalnych w aplikacji**

Aplikacja musi zaimplementowa konkretne metody, aby poprawnie obsugiwa linki uniwersalne. G贸wn metod, na kt贸r nale偶y zwr贸ci uwag, jest [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Wa偶ne jest, aby schemat obsugiwanych URL-i by HTTP lub HTTPS, poniewa偶 inne nie bd wspierane.

#### **Weryfikacja metody obsugi danych**

Gdy link uniwersalny otwiera aplikacj, obiekt `NSUserActivity` jest przekazywany do aplikacji z URL-em. Przed przetworzeniem tego URL-a, wa偶ne jest, aby go zweryfikowa i oczyci, aby zapobiec ryzyku bezpieczestwa. Oto przykad w Swift, kt贸ry ilustruje ten proces:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
URLs powinny by starannie analizowane i walidowane, szczeg贸lnie jeli zawieraj parametry, aby chroni przed potencjalnym podszywaniem si lub 藕le sformatowanymi danymi. API `NSURLComponents` jest przydatne w tym celu, jak pokazano poni偶ej:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
Przez **starann konfiguracj i walidacj** deweloperzy mog zapewni, 偶e uniwersalne linki poprawiaj dowiadczenia u偶ytkownik贸w, jednoczenie utrzymujc standardy bezpieczestwa i prywatnoci.


## Narzdzia
* [GetUniversal.link](https://getuniversal.link/): Pomaga uproci testowanie i zarzdzanie uniwersalnymi linkami oraz plikiem AASA Twojej aplikacji. Wystarczy wpisa swoj domen, aby zweryfikowa integralno pliku AASA lub skorzysta z niestandardowego panelu, aby atwo testowa zachowanie link贸w. To narzdzie pomaga r贸wnie偶 okreli, kiedy Apple ponownie zindeksuje Tw贸j plik AASA.

## Odniesienia
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)



{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
