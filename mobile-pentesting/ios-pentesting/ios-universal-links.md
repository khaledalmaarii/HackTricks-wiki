# iOS Universal Links


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## Introduction

Les liens universels offrent une **exp√©rience de redirection fluide** aux utilisateurs en ouvrant directement le contenu dans l'application, contournant ainsi la n√©cessit√© d'une redirection Safari. Ces liens sont **uniques** et s√©curis√©s, car ils ne peuvent pas √™tre revendiqu√©s par d'autres applications. Cela est assur√© par l'h√©bergement d'un fichier JSON `apple-app-site-association` dans le r√©pertoire racine du site web, √©tablissant un lien v√©rifiable entre le site web et l'application. Dans les cas o√π l'application n'est pas install√©e, Safari prendra le relais et dirigera l'utilisateur vers la page web, maintenant ainsi la pr√©sence de l'application.

Pour les testeurs de p√©n√©tration, le fichier `apple-app-site-association` est d'un int√©r√™t particulier car il peut r√©v√©ler des **chemins sensibles**, pouvant inclure ceux li√©s √† des fonctionnalit√©s non publi√©es.

### **Analyzing the Associated Domains Entitlement**

Les d√©veloppeurs activent les liens universels en configurant les **Domaines Associ√©s** dans l'onglet Capacit√©s de Xcode ou en inspectant le fichier `.entitlements`. Chaque domaine est pr√©fix√© par `applinks:`. Par exemple, la configuration de Telegram pourrait appara√Ætre comme suit :
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Pour des informations plus compl√®tes, consultez la [documentation Apple Developer archiv√©e](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Si vous travaillez avec une application compil√©e, les droits peuvent √™tre extraits comme indiqu√© dans [ce guide](extracting-entitlements-from-compiled-application.md).

### **R√©cup√©ration du fichier Apple App Site Association**

Le fichier `apple-app-site-association` doit √™tre r√©cup√©r√© depuis le serveur en utilisant les domaines sp√©cifi√©s dans les droits. Assurez-vous que le fichier est accessible via HTTPS directement √† `https://<domain>/apple-app-site-association`. Des outils comme le [validateur Apple App Site Association (AASA)](https://branch.io/resources/aasa-validator/) peuvent aider dans ce processus.

### **Gestion des liens universels dans l'application**

L'application doit impl√©menter des m√©thodes sp√©cifiques pour g√©rer correctement les liens universels. La m√©thode principale √† rechercher est [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Il est crucial que le sch√©ma des URL g√©r√©es soit HTTP ou HTTPS, car d'autres ne seront pas prises en charge.

#### **Validation de la m√©thode de gestion des donn√©es**

Lorsqu'un lien universel ouvre une application, un objet `NSUserActivity` est pass√© √† l'application avec l'URL. Avant de traiter cette URL, il est essentiel de la valider et de la nettoyer pour √©viter les risques de s√©curit√©. Voici un exemple en Swift qui d√©montre le processus :
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
Les URL doivent √™tre soigneusement analys√©es et valid√©es, surtout si elles incluent des param√®tres, pour se prot√©ger contre un √©ventuel spoofing ou des donn√©es malform√©es. L'API `NSURLComponents` est utile √† cet effet, comme d√©montr√© ci-dessous :
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
√Ä travers une **configuration et validation diligentes**, les d√©veloppeurs peuvent s'assurer que les liens universels am√©liorent l'exp√©rience utilisateur tout en maintenant des normes de s√©curit√© et de confidentialit√©.

## Outils
* [GetUniversal.link](https://getuniversal.link/): Aide √† simplifier le test et la gestion des liens universels de votre application et du fichier AASA. Il suffit d'entrer votre domaine pour v√©rifier l'int√©grit√© du fichier AASA ou d'utiliser le tableau de bord personnalis√© pour tester facilement le comportement des liens. Cet outil vous aide √©galement √† d√©terminer quand Apple indexera √† nouveau votre fichier AASA.

## R√©f√©rences
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
