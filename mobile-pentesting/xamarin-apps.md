# Xamarin åº”ç”¨ç¨‹åº

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* å¦‚æœæ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œï¼Œæƒ³åœ¨**HackTricks**ä¸Šçœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Œæˆ–è€…æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)ç³»åˆ—ã€‚
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)ã€‚
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricksä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloudä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## **åŸºæœ¬ä¿¡æ¯**

Xamarin æ˜¯ä¸€ä¸ªå¼€æºå¹³å°ï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç³»åˆ—å·¥å…·å’Œé™„åŠ ç»„ä»¶ï¼Œå…è®¸ä»–ä»¬ä½¿ç”¨ .NET å’Œ C# æ¡†æ¶**åˆ›å»ºç°ä»£çš„iOSã€Androidå’ŒWindowsåº”ç”¨ç¨‹åº**ã€‚

### Xamarin Android æ¶æ„

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Xamarin æä¾›äº†å¯¹ Android.\* å’Œ Java.\* å‘½åç©ºé—´çš„ .NET ç»‘å®šã€‚Xamarin.

Android åº”ç”¨ç¨‹åºåœ¨ Mono æ‰§è¡Œç¯å¢ƒä¸‹è¿è¡Œï¼Œä¸ Android Runtime (ART) è™šæ‹Ÿæœºå¹¶è¡Œè¿è¡Œã€‚

Mono æ‰§è¡Œç¯å¢ƒé€šè¿‡ Managed Callable Wrappers (MCW) è°ƒç”¨è¿™äº›å‘½åç©ºé—´ï¼Œå¹¶ä¸º ART æä¾› Android Callable Wrappers (ACW)ã€‚

è¿™ä¸¤ä¸ªç¯å¢ƒéƒ½åœ¨ Linux å†…æ ¸ä¹‹ä¸Šè¿è¡Œï¼Œå¹¶è°ƒç”¨å„ç§ API åˆ°ç”¨æˆ·ä»£ç ã€‚è¿™ç§å®‰æ’å…è®¸å¼€å‘è€…è®¿é—®åº•å±‚ç³»ç»Ÿã€‚

### Xamarin iOS é¡¹ç›®

Xamarin.iOS åº”ç”¨ç¨‹åºåœ¨ Mono è¿è¡Œæ—¶ç¯å¢ƒä¸‹è¿è¡Œï¼Œå¹¶ä½¿ç”¨å®Œæ•´çš„ Ahead of Time (AOT) ç¼–è¯‘å°† C# .NET ä»£ç ç¼–è¯‘ä¸º ARM æ±‡ç¼–è¯­è¨€ã€‚

å®ƒä¸ Objective-C è¿è¡Œæ—¶ä¸€èµ·è¿è¡Œã€‚è¿è¡Œæ—¶ç¯å¢ƒåœ¨ç±» UNIX å†…æ ¸ä¹‹ä¸Šè¿è¡Œï¼Œå¹¶è°ƒç”¨å¤šä¸ª API åˆ°ç”¨æˆ·ä»£ç ï¼Œè¿™å…è®¸å¼€å‘è€…è®¿é—®åº•å±‚çš„æ‰˜ç®¡æˆ–æœ¬åœ°ç³»ç»Ÿã€‚

ä¸‹é¢ç»™å‡ºçš„å›¾è¡¨æè¿°äº†è¿™ç§æ¶æ„ï¼š

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### ä»€ä¹ˆæ˜¯ .Net è¿è¡Œæ—¶å’Œ Mono æ¡†æ¶ï¼Ÿ

**.Net æ¡†æ¶æ˜¯ä¸€ç»„ç¨‹åºé›†ã€ç±»å’Œå‘½åç©ºé—´**ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥åˆ›å»ºåº”ç”¨ç¨‹åºï¼›.Net è¿è¡Œæ—¶è¿è¡Œç¼–è¯‘åçš„ä»£ç ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ‰˜ç®¡ä»£ç æ‰§è¡Œã€‚.NET è¿è¡Œæ—¶æä¾›äº†å¤šç§ç‰¹æ€§ï¼Œç¡®ä¿äº†å¹³å°ç‹¬ç«‹æ€§ï¼Œå¹¶ä¸”ä¸æ—§ç‰ˆæœ¬çš„æ¡†æ¶å…¼å®¹ã€‚

**Mono æ¡†æ¶**å§‹äº2005å¹´ï¼Œæ˜¯ Linux (Ximian/SuSe/Novell) ä¸Š .NET æ¡†æ¶çš„å®ç°ã€‚åœ¨ Microsoft çš„èµåŠ©å’Œ Xamarin çš„é¢†å¯¼ä¸‹ï¼ŒMono æ˜¯åŸºäº ECMA æ ‡å‡†çš„ Common Language Runtime å’Œ C# çš„ .NET æ¡†æ¶çš„å¼€æºå®ç°ã€‚

## Xamarin åº”ç”¨ç¨‹åºçš„é€†å‘å·¥ç¨‹æŠ€æœ¯

### Xamarin ç¨‹åºé›†çš„åç¼–è¯‘

åç¼–è¯‘æ˜¯ä»ç¼–è¯‘ä»£ç ç”Ÿæˆæºä»£ç çš„è¿‡ç¨‹ã€‚è¦è·å–æœ‰å…³å½“å‰å†…å­˜ä¸­çš„ç¨‹åºé›†å’Œå¯æ‰§è¡Œæ–‡ä»¶çš„ä¿¡æ¯ï¼ŒWindows æ˜¯ä¸€ä¸ªç»ä½³çš„åœ°æ–¹ã€‚

è¦æ‰“å¼€æ¨¡å—çª—å£ï¼Œè¯·é€‰æ‹© Debug > Windows > Modulesã€‚ä¸€æ—¦æ‚¨æ£€æµ‹åˆ°éœ€è¦åç¼–è¯‘çš„æ¨¡å—ï¼Œå³é”®å•å‡»å¹¶é€‰æ‹©â€œDecompile Source to Symbol Fileâ€ã€‚è¿™ä¸ªæ“ä½œ**åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«åç¼–è¯‘æºçš„ç¬¦å·æ–‡ä»¶**ï¼Œåè¿‡æ¥ï¼Œè®©æ‚¨å¯ä»¥ç›´æ¥ä»æ‚¨çš„æºä»£ç è¿›å…¥ç¬¬ä¸‰æ–¹ä»£ç ã€‚

**Visual Studio**å³ä½¿æ²¡æœ‰ç¬¦å·ï¼Œä¹Ÿèƒ½åç¼–è¯‘æ‰˜ç®¡ä»£ç ï¼Œå…è®¸æ‚¨æŸ¥çœ‹ä»£ç ï¼Œæ£€æŸ¥å˜é‡å¹¶è®¾ç½®æ–­ç‚¹ã€‚è¦å°†æºä»£ç æå–åˆ°ç£ç›˜ï¼Œè¯·å³é”®å•å‡»åµŒå…¥æºçš„æ¨¡å—å¹¶ç‚¹å‡»â€œExtract Embedded Sourceâ€ã€‚è¿™å°†å¯¼å‡ºæºæ–‡ä»¶åˆ° Miscellaneous files æ–‡ä»¶å¤¹ä»¥ä¾›è¿›ä¸€æ­¥åˆ†æã€‚

### Xamarin åº”ç”¨ç¨‹åºçš„ JIT ä¸ AOT ç¼–è¯‘

è¿™ä¸¤ä¸ªé€‰é¡¹ç”¨äºå°†åŸºäº C# çš„ Xamarin ä»£ç ç¼–è¯‘æˆåº”ç”¨ç¨‹åºï¼Œå³**å³æ—¶ç¼–è¯‘å’Œæå‰ç¼–è¯‘**ã€‚ç¼–è¯‘æ–¹å¼å½±å“åº”ç”¨ç¨‹åºä»£ç åœ¨ apk æˆ– ipa æ–‡ä»¶ä¸­çš„æ‰“åŒ…æ–¹å¼ã€‚è®©æˆ‘ä»¬å¿«é€Ÿçœ‹ä¸€ä¸‹ä¸‹é¢çš„å†…å®¹ï¼š

\- **Android**ï¼šXamarin å…è®¸æ‚¨ä½¿ç”¨**androidçš„ JIT å’Œ AOT æ ‡å¿—è¿›è¡Œç¼–è¯‘**ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨ Hybrid AOT æ¨¡å¼åœ¨ä¸¤è€…ä¹‹é—´å–å¾—æœ€å¿«çš„æ‰§è¡Œé€Ÿåº¦ã€‚è¯·æ³¨æ„ï¼Œå®Œæ•´çš„ AOT æ¨¡å¼ä»…é€‚ç”¨äºä¼ä¸šè®¸å¯è¯ã€‚

\- **iOS**ï¼šåœ¨ iOS çš„æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ç§é€‰æ‹©ï¼Œå³**æå‰ç¼–è¯‘**ã€‚è¿™æ˜¯ç”±äºè‹¹æœçš„æ”¿ç­–ï¼Œç¦æ­¢åœ¨è®¾å¤‡ä¸Šæ‰§è¡ŒåŠ¨æ€ç”Ÿæˆçš„ä»£ç ã€‚

{% hint style="info" %}
å¦‚æœæ‚¨é‡åˆ°ä¸€ä¸ªå®Œæ•´çš„ AOT ç¼–è¯‘åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å¼€å‘è€…ä¸ºäº†å‡å°‘æ„å»ºå¤§å°è€Œç§»é™¤äº† IL ç¨‹åºé›†æ–‡ä»¶ï¼Œé‚£ä¹ˆé€†å‘è¿‡ç¨‹éœ€è¦ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤ï¼Œä» lib æ–‡ä»¶å¤¹æˆ– `libmonodroid_bundle_app.so` æ–‡ä»¶ä¸­æå– dll æ–‡ä»¶ã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ª Hybrid AOT ç¼–è¯‘çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸” IL æ–‡ä»¶ä»ç„¶ä¿ç•™åœ¨åº”ç”¨ç¨‹åºåŒ…ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥é€†å‘å·¥ç¨‹åº”ç”¨ç¨‹åºã€‚
{% endhint %}

## ä» APK/IPA è·å– dll æ–‡ä»¶

åªéœ€**è§£å‹ apk/ipa** æ–‡ä»¶å¹¶å¤åˆ¶ assemblies ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼š

<figure><img src="../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

åœ¨ Android **APKs çš„æƒ…å†µä¸‹ï¼Œè¿™äº› dll æ–‡ä»¶æ˜¯å‹ç¼©çš„**ï¼Œä¸èƒ½ç›´æ¥ç”¨äºåç¼–è¯‘ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·¥å…·æ¥**è§£å‹è¿™äº› dll æ–‡ä»¶**ï¼Œå¦‚ [XamAsmUnZ](https://github.com/cihansol/XamAsmUnZ) å’Œ [xamarin-decompress](https://github.com/NickstaDB/xamarin-decompress)ã€‚
```
python3 xamarin-decompress.py -o /path/to/decompressed/apk
```
åœ¨assembliesç›®å½•ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°`assemblies.blob`å’Œ`assemblies.manifest`æ–‡ä»¶ï¼Œè€Œä¸æ˜¯dllæ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªXamarin AssemblyStoreï¼Œæ˜¯ç›®å‰æ¨èç”¨äºåœ¨Androidåº”ç”¨ç¨‹åºä¸­æ‰“åŒ…dllsçš„æ–¹å¼ã€‚`assemblies.manifest`æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œæè¿°äº†äºŒè¿›åˆ¶æ–‡ä»¶`assemblies.blob`çš„å†…å®¹ã€‚è¦è§£åŒ…è¿™äº›æ–‡ä»¶ï¼Œä½ éœ€è¦ä½¿ç”¨[pyxamstore](https://github.com/jakev/pyxamstore)ã€‚
```
pyxamstore unpack -d /path/to/decompressed/apk/assemblies/
```
åœ¨iOSçš„æƒ…å†µä¸‹ï¼Œ**IPAæ–‡ä»¶ä¸­çš„dllæ–‡ä»¶å¯ä»¥ç›´æ¥åŠ è½½**åˆ°åç¼–è¯‘å™¨ä¸­ï¼ˆæ— éœ€è§£å‹ä»»ä½•å†…å®¹ï¼‰ã€‚

**å½“æˆ‘ä»¬åç¼–è¯‘dllæ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰¾åˆ°å¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºä»£ç ã€‚** åŒæ—¶è¯·æ³¨æ„ï¼ŒåŸºäºXamarinæ¡†æ¶çš„åº”ç”¨ç¨‹åºåœ¨æ‰€æœ‰å¹³å°ï¼ˆå¦‚iOSå’ŒAndroidç­‰ï¼‰çš„æ„å»ºä¸­åŒ…å«90%çš„é€šç”¨ä»£ç ã€‚

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

ä»ä¸Šé¢åˆ—å‡ºapkä¸­å­˜åœ¨çš„dllæ–‡ä»¶çš„æˆªå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤è¿™æ˜¯ä¸€ä¸ªXamarinåº”ç”¨ã€‚å®ƒåŒ…å«äº†åº”ç”¨ç¨‹åºç‰¹å®šçš„dllæ–‡ä»¶ä»¥åŠè¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„åº“æ–‡ä»¶ï¼Œä¾‹å¦‚`Xamarin.Essentails.dll`æˆ–`Mono.Security.dll`ã€‚

{% hint style="success" %}
æœ€åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[**è¿™äº›æ¨èå·¥å…·**](../reversing/reversing-tools-basic-methods/#net-decompiler)æ¥è®¿é—®DLLä¸­çš„**C#ä»£ç **ã€‚
{% endhint %}

## åŠ¨æ€åˆ†æ

å°è¯•æ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦æœ‰ä»»ä½•å½¢å¼çš„SSLå›ºå®šã€‚å¦‚æœæ²¡æœ‰ï¼Œä½¿ç”¨Burpä½œä¸ºç³»ç»ŸCAåº”è¯¥å¯ä»¥ç”¨äºæ‹¦æˆªè¯·æ±‚ã€‚**Fridaä¸Javaæˆ–ObjCè¿è¡Œæ—¶åœ¨è¿™é‡Œä¸èµ·ä½œç”¨**ï¼Œä½†å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªå·¥å…·å¯ä»¥ç”¨äºé’©å…¥æ–¹æ³•ã€‚

[**Fridax**](https://github.com/NorthwaveSecurity/fridax)å…è®¸æ‚¨è½»æ¾**ä¿®æ”¹è¿è¡Œæ—¶Xamarinåº”ç”¨ç¨‹åºå†…çš„.NETäºŒè¿›åˆ¶æ–‡ä»¶**ã€‚é™æ€åˆ†æå°†å¸®åŠ©æ‚¨è¯†åˆ«åº”ç”¨ç¨‹åºä¸­å­˜åœ¨çš„ä¸åŒæ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥ç¨åä½¿ç”¨Fridaxè¿›è¡ŒåŠ¨æ€åˆ†ææ—¶é’©å…¥ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›Fridaè„šæœ¬ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç»•è¿‡æ ¹æ£€æµ‹æˆ–SSLå›ºå®šï¼š

* [**xamarin-antiroot**](https://codeshare.frida.re/@Gand3lf/xamarin-antiroot/)
* [**xamarin-root-detect-bypass**](https://codeshare.frida.re/@nuschpl/xamarin-root-detect-bypass/)
* [**Frida-xamarin-unpin**](https://github.com/GoSecure/frida-xamarin-unpin)

## å‚è€ƒèµ„æ–™

* [https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers](https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers)
* [https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/](https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* å¦‚æœæ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œï¼Œæƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Œæˆ–è€…æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)ç³»åˆ—ã€‚
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)ã€‚
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/)[**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**hacktricks repo**](https://github.com/carlospolop/hacktricks)å’Œ[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRï¼Œ**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
