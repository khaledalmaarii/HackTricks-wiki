# 11211 - Memcache íœí…ŒìŠ¤íŒ…

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì„¸ìš”.**

</details>
{% endhint %}

## í”„ë¡œí† ì½œ ì •ë³´

[wikipedia](https://en.wikipedia.org/wiki/Memcached)ì—ì„œ:

> **Memcached** (ë°œìŒ: mem-cashed, mem-cash-dee)ëŠ” ì¼ë°˜ ëª©ì ì˜ ë¶„ì‚° [ë©”ëª¨ë¦¬ ìºì‹±](https://en.wikipedia.org/wiki/Memory\_caching) ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ë°ì´í„°ì™€ ê°ì²´ë¥¼ RAMì— ìºì‹±í•˜ì—¬ ì™¸ë¶€ ë°ì´í„° ì†ŒìŠ¤(ì˜ˆ: ë°ì´í„°ë² ì´ìŠ¤ ë˜ëŠ” API)ë¥¼ ì½ì–´ì•¼ í•˜ëŠ” íšŸìˆ˜ë¥¼ ì¤„ì„ìœ¼ë¡œì¨ ë™ì  ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ ì›¹ì‚¬ì´íŠ¸ì˜ ì†ë„ë¥¼ ë†’ì´ëŠ” ë° ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤.

MemcachedëŠ” SASLì„ ì§€ì›í•˜ì§€ë§Œ, ëŒ€ë¶€ë¶„ì˜ ì¸ìŠ¤í„´ìŠ¤ëŠ” **ì¸ì¦ ì—†ì´ ë…¸ì¶œë˜ì–´ ìˆìŠµë‹ˆë‹¤**.

**ê¸°ë³¸ í¬íŠ¸:** 11211
```
PORT      STATE SERVICE
11211/tcp open  unknown
```
## Enumeration

### Manual

memcache ì¸ìŠ¤í„´ìŠ¤ì— ì €ì¥ëœ ëª¨ë“  ì •ë³´ë¥¼ ì¶”ì¶œí•˜ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤:

1. **í™œì„± í•­ëª©**ì´ ìˆëŠ” **ìŠ¬ë©** ì°¾ê¸°
2. ì´ì „ì— ê°ì§€ëœ ìŠ¬ë©ì˜ **í‚¤ ì´ë¦„** ê°€ì ¸ì˜¤ê¸°
3. **í‚¤ ì´ë¦„**ì„ ê°€ì ¸ì™€ì„œ **ì €ì¥ëœ ë°ì´í„°**ë¥¼ ì¶”ì¶œí•˜ê¸°

ì´ ì„œë¹„ìŠ¤ëŠ” ë‹¨ì§€ **ìºì‹œ**ë¼ëŠ” ì ì„ ê¸°ì–µí•˜ì„¸ìš”, ê·¸ë˜ì„œ **ë°ì´í„°ê°€ ë‚˜íƒ€ë‚˜ê³  ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
```bash
echo "version" | nc -vn -w 1 <IP> 11211      #Get version
echo "stats" | nc -vn -w 1 <IP> 11211        #Get status
echo "stats slabs" | nc -vn -w 1 <IP> 11211  #Get slabs
echo "stats items" | nc -vn -w 1 <IP> 11211  #Get items of slabs with info
echo "stats cachedump <number> 0" | nc -vn -w 1 <IP> 11211  #Get key names (the 0 is for unlimited output size)
echo "get <item_name>" | nc -vn -w 1 <IP> 11211  #Get saved info

#This php will just dump the keys, you need to use "get <item_name> later"
sudo apt-get install php-memcached
php -r '$c = new Memcached(); $c->addServer("localhost", 11211); var_dump( $c->getAllKeys() );'
```
### ë§¤ë‰´ì–¼2
```bash
sudo apt install libmemcached-tools
memcstat --servers=127.0.0.1 #Get stats
memcdump --servers=127.0.0.1 #Get all items
memccat  --servers=127.0.0.1 <item1> <item2> <item3> #Get info inside the item(s)
```
### ìë™í™”
```bash
nmap -n -sV --script memcached-info -p 11211 <IP>   #Just gather info
msf > use auxiliary/gather/memcached_extractor      #Extracts saved data
msf > use auxiliary/scanner/memcached/memcached_amp #Check is UDP DDoS amplification attack is possible
```
## **Dumping Memcache Keys**

memcache ì˜ì—­ì—ì„œ, ë°ì´í„°ë¥¼ ìŠ¬ë©ìœ¼ë¡œ ì¡°ì§í•˜ëŠ” ë° ë„ì›€ì„ ì£¼ëŠ” í”„ë¡œí† ì½œë¡œ, ì €ì¥ëœ ë°ì´í„°ë¥¼ ê²€ì‚¬í•˜ê¸° ìœ„í•œ íŠ¹ì • ëª…ë ¹ì´ ì¡´ì¬í•˜ì§€ë§Œ, ì£¼ëª©í•  ë§Œí•œ ì œì•½ì´ ìˆìŠµë‹ˆë‹¤:

1. í‚¤ëŠ” ìŠ¬ë© í´ë˜ìŠ¤ë³„ë¡œë§Œ ë¤í”„í•  ìˆ˜ ìˆìœ¼ë©°, ìœ ì‚¬í•œ ì½˜í…ì¸  í¬ê¸°ì˜ í‚¤ë¥¼ ê·¸ë£¹í™”í•©ë‹ˆë‹¤.
2. ìŠ¬ë© í´ë˜ìŠ¤ë‹¹ í•œ í˜ì´ì§€ì˜ ì œí•œì´ ìˆìœ¼ë©°, ì´ëŠ” 1MBì˜ ë°ì´í„°ì— í•´ë‹¹í•©ë‹ˆë‹¤.
3. ì´ ê¸°ëŠ¥ì€ ë¹„ê³µì‹ì ì´ë©°, ì–¸ì œë“ ì§€ ì¤‘ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” [ì»¤ë®¤ë‹ˆí‹° í¬ëŸ¼](https://groups.google.com/forum/?fromgroups=#!topic/memcached/1-T8I-RVGKM)ì—ì„œ ë…¼ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.

ì ì¬ì ìœ¼ë¡œ ê¸°ê°€ë°”ì´íŠ¸ì˜ ë°ì´í„°ì—ì„œ 1MBë§Œ ë¤í”„í•  ìˆ˜ ìˆë‹¤ëŠ” ì œí•œì€ íŠ¹íˆ ì¤‘ìš”í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ê¸°ëŠ¥ì€ íŠ¹ì • ìš”êµ¬ ì‚¬í•­ì— ë”°ë¼ í‚¤ ì‚¬ìš© íŒ¨í„´ì— ëŒ€í•œ í†µì°°ë ¥ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë©”ì»¤ë‹ˆì¦˜ì— ëœ ê´€ì‹¬ì´ ìˆëŠ” ê²½ìš°, [ë„êµ¬ ì„¹ì…˜](https://lzone.de/cheat-sheet/memcached#tools)ì„ ë°©ë¬¸í•˜ë©´ í¬ê´„ì ì¸ ë¤í”„ë¥¼ ìœ„í•œ ìœ í‹¸ë¦¬í‹°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜ëŠ”, memcached ì„¤ì •ê³¼ì˜ ì§ì ‘ ìƒí˜¸ì‘ìš©ì„ ìœ„í•œ telnet ì‚¬ìš© ê³¼ì •ì€ ì•„ë˜ì— ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### **How it Works**

memcacheì˜ ë©”ëª¨ë¦¬ ì¡°ì§ì€ ì¤‘ìš”í•©ë‹ˆë‹¤. "-vv" ì˜µì…˜ìœ¼ë¡œ memcacheë¥¼ ì‹œì‘í•˜ë©´ ìƒì„±ëœ ìŠ¬ë© í´ë˜ìŠ¤ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
$ memcached -vv
slab class   1: chunk size        96 perslab   10922
[...]
```
í˜„ì¬ ì¡´ì¬í•˜ëŠ” ëª¨ë“  ìŠ¬ë©ì„ í‘œì‹œí•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:
```bash
stats slabs
```
memcached 1.4.13ì— ë‹¨ì¼ í‚¤ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì€ ìŠ¬ë© í´ë˜ìŠ¤ê°€ ì–´ë–»ê²Œ ì±„ì›Œì§€ê³  ê´€ë¦¬ë˜ëŠ”ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:
```bash
set mykey 0 60 1
1
STORED
```
"stats slabs" ëª…ë ¹ì„ í‚¤ ì¶”ê°€ í›„ ì‹¤í–‰í•˜ë©´ ìŠ¬ë© í™œìš©ì— ëŒ€í•œ ìì„¸í•œ í†µê³„ë¥¼ ì œê³µí•©ë‹ˆë‹¤:
```bash
stats slabs
[...]
```
ì´ ì¶œë ¥ì€ í™œì„± ìŠ¬ë© ìœ í˜•, ì‚¬ìš©ëœ ì²­í¬ ë° ìš´ì˜ í†µê³„ë¥¼ ë³´ì—¬ì£¼ë©°, ì½ê¸° ë° ì“°ê¸° ì‘ì—…ì˜ íš¨ìœ¨ì„±ì— ëŒ€í•œ í†µì°°ë ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

ë˜ ë‹¤ë¥¸ ìœ ìš©í•œ ëª…ë ¹ì–´ì¸ "stats items"ëŠ” í‡´ì¶œ, ë©”ëª¨ë¦¬ ì œì•½ ë° í•­ëª© ìƒì•  ì£¼ê¸°ì— ëŒ€í•œ ë°ì´í„°ë¥¼ ì œê³µí•©ë‹ˆë‹¤:
```bash
stats items
[...]
```
ì´ í†µê³„ëŠ” ë‹¤ì–‘í•œ ì½˜í…ì¸  í¬ê¸°ì— ëŒ€í•œ ìºì‹œ íš¨ìœ¨ì„±, ë©”ëª¨ë¦¬ í• ë‹¹ ë° ëŒ€í˜• ê°ì²´ ìºì‹± ìš©ëŸ‰ì„ í¬í•¨í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ìºì‹± ë™ì‘ì— ëŒ€í•œ êµìœ¡ëœ ê°€ì •ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

### **í‚¤ ë¤í”„í•˜ê¸°**

1.4.31 ì´ì „ ë²„ì „ì—ì„œëŠ” í‚¤ê°€ ìŠ¬ë© í´ë˜ìŠ¤ë³„ë¡œ ë¤í”„ë©ë‹ˆë‹¤:
```bash
stats cachedump <slab class> <number of items to dump>
```
ì˜ˆë¥¼ ë“¤ì–´, í´ë˜ìŠ¤ #1ì—ì„œ í‚¤ë¥¼ ë¤í”„í•˜ë ¤ë©´:
```bash
stats cachedump 1 1000
ITEM mykey [1 b; 1350677968 s]
END
```
ì´ ë°©ë²•ì€ ìŠ¬ë© í´ë˜ìŠ¤ë¥¼ ë°˜ë³µí•˜ì—¬ í‚¤ ê°’ì„ ì¶”ì¶œí•˜ê³  ì„ íƒì ìœ¼ë¡œ ë¤í”„í•©ë‹ˆë‹¤.

### **MEMCACHE í‚¤ ë¤í”„ (VER 1.4.31+)**

memcache ë²„ì „ 1.4.31 ì´ìƒì—ì„œëŠ” í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ í‚¤ë¥¼ ë¤í”„í•˜ê¸° ìœ„í•œ ìƒˆë¡œìš´ ì•ˆì „í•œ ë°©ë²•ì´ ë„ì…ë˜ì—ˆìœ¼ë©°, ì´ëŠ” [ë¦´ë¦¬ìŠ¤ ë…¸íŠ¸](https://github.com/memcached/memcached/wiki/ReleaseNotes1431)ì—ì„œ ìì„¸íˆ ì„¤ëª…ëœ ë¹„ì°¨ë‹¨ ëª¨ë“œë¥¼ í™œìš©í•©ë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ ë°©ëŒ€í•œ ì¶œë ¥ì„ ìƒì„±í•˜ë¯€ë¡œ íš¨ìœ¨ì„±ì„ ìœ„í•´ 'nc' ëª…ë ¹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤. ì˜ˆì‹œë¡œëŠ”:
```bash
echo 'lru_crawler metadump all' | nc 127.0.0.1 11211 | head -1
echo 'lru_crawler metadump all' | nc 127.0.0.1 11211 | grep ee6ba58566e234ccbbce13f9a24f9a28
```
### **DUMPING TOOLS**

Table [from here](https://lzone.de/blog).

| Programming Languages | Tools                                                                                                                              | Functionality                                                                                                                                                          |                                                                             |         |
| --------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------- | ------- |
| PHP                   | [simple script](http://snipt.org/xtP)                                                                                              | í‚¤ ì´ë¦„ì„ ì¶œë ¥í•©ë‹ˆë‹¤.                                                                                                                                                      |                                                                             |         |
| Perl                  | [simple script](https://wiki.jasig.org/download/attachments/13572172/memcached-clean.pl?version=1\&modificationDate=1229693957401) | í‚¤ì™€ ê°’ì„ ì¶œë ¥í•©ë‹ˆë‹¤.                                                                                                                                                 |                                                                             |         |
| Ruby                  | [simple script](https://gist.github.com/1365005)                                                                                   | í‚¤ ì´ë¦„ì„ ì¶œë ¥í•©ë‹ˆë‹¤.                                                                                                                                                      |                                                                             |         |
| Perl                  | [memdump](https://search.cpan.org/\~dmaki/Memcached-libmemcached-0.4202/src/libmemcached/docs/memdump.pod)                         | CPAN ëª¨ë“ˆì˜ ë„êµ¬                                                                                                                                                    | [Memcached-libmemcached](https://search.cpan.org/\~dmaki/Memcached-libmemc) | ached/) |
| PHP                   | [memcache.php](http://livebookmark.net/journal/2008/05/21/memcachephp-stats-like-apcphp/)                                          | í‚¤ ë¤í”„ë¥¼ í—ˆìš©í•˜ëŠ” Memcache ëª¨ë‹ˆí„°ë§ GUI                                                                                                                  |                                                                             |         |
| libmemcached          | [peep](http://blog.evanweaver.com/2009/04/20/peeping-into-memcached/)                                                              | **memcached í”„ë¡œì„¸ìŠ¤ë¥¼ ì¤‘ë‹¨ì‹œí‚µë‹ˆë‹¤!!!** í”„ë¡œë•ì…˜ì—ì„œ ì‚¬ìš©í•  ë•Œ ì£¼ì˜í•˜ì„¸ìš”. ì—¬ì „íˆ ì‚¬ìš©í•˜ë©´ 1MB ì œí•œì„ ìš°íšŒí•˜ê³  **ëª¨ë“ ** í‚¤ë¥¼ ë¤í”„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. |                                                                             |         |

## Troubleshooting <a href="#troubleshooting" id="troubleshooting"></a>

### 1MB Data Limit <a href="#1mb-data-limit" id="1mb-data-limit"></a>

memcached 1.4 ì´ì „ì—ëŠ” ê¸°ë³¸ ìµœëŒ€ ìŠ¬ë© í¬ê¸°ë¡œ ì¸í•´ 1MBë³´ë‹¤ í° ê°ì²´ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

### Never Set a Timeout > 30 Days! <a href="#never-set-a-timeout--30-days" id="never-set-a-timeout--30-days"></a>

í—ˆìš©ëœ ìµœëŒ€ê°’ë³´ë‹¤ í° íƒ€ì„ì•„ì›ƒìœ¼ë¡œ í‚¤ë¥¼ â€œì„¤ì •â€í•˜ê±°ë‚˜ â€œì¶”ê°€â€í•˜ë ¤ê³  í•˜ë©´ memcachedê°€ ê°’ì„ Unix íƒ€ì„ìŠ¤íƒ¬í”„ë¡œ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— ì˜ˆìƒí•œ ëŒ€ë¡œ ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ê³¼ê±°ì— ìˆìœ¼ë©´ ì•„ë¬´ ì‘ì—…ë„ ìˆ˜í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ëª…ë ¹ì´ ì¡°ìš©íˆ ì‹¤íŒ¨í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ ìµœëŒ€ ìˆ˜ëª…ì„ ì‚¬ìš©í•˜ë ¤ë©´ 2592000ì„ ì§€ì •í•˜ì„¸ìš”. ì˜ˆ:
```
set my_key 0 2592000 1
1
```
### Disappearing Keys on Overflow <a href="#disappearing-keys-on-overflow" id="disappearing-keys-on-overflow"></a>

ë¬¸ì„œì—ì„œëŠ” â€œincrâ€ë¥¼ ì‚¬ìš©í•˜ì—¬ 64ë¹„íŠ¸ ê°’ì´ ì˜¤ë²„í”Œë¡œìš°ë˜ë©´ ê°’ì´ ì‚¬ë¼ì§„ë‹¤ê³  ì–¸ê¸‰í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ â€œaddâ€/â€setâ€ì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.

### Replication <a href="#replication" id="replication"></a>

memcached ìì²´ëŠ” ë³µì œë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì •ë§ í•„ìš”í•˜ë‹¤ë©´ 3rd party ì†”ë£¨ì…˜ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤:

* [repcached](http://repcached.lab.klab.org/): ë‹¤ì¤‘ ë§ˆìŠ¤í„° ë¹„ë™ê¸° ë³µì œ (memcached 1.2 íŒ¨ì¹˜ ì„¸íŠ¸)
* [Couchbase memcached interface](http://www.couchbase.com/memcached): CouchBaseë¥¼ memcached ë“œë¡­ì¸ìœ¼ë¡œ ì‚¬ìš©
* [yrmcds](https://cybozu.github.io/yrmcds/): memcached í˜¸í™˜ ë§ˆìŠ¤í„°-ìŠ¬ë ˆì´ë¸Œ í‚¤ ê°’ ì €ì¥ì†Œ
* [twemproxy](https://github.com/twitter/twemproxy) (aka nutcracker): memcached ì§€ì› í”„ë¡ì‹œ

### Commands Cheat-Sheet

{% content-ref url="memcache-commands.md" %}
[memcache-commands.md](memcache-commands.md)
{% endcontent-ref %}

### **Shodan**

* `port:11211 "STAT pid"`
* `"STAT pid"`

## References

* [https://lzone.de/cheat-sheet/memcached](https://lzone.de/cheat-sheet/memcached)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
