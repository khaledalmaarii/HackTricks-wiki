# Memcache å‘½ä»¤

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶ **ç½‘ç»œå®‰å…¨å…¬å¸** å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„ **å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾— **PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—å“ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨ **Twitter** ä¸Š **å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## å‘½ä»¤é€ŸæŸ¥è¡¨

**æ¥è‡ª** [**https://lzone.de/cheat-sheet/memcached**](https://lzone.de/cheat-sheet/memcached)\*\*\*\*

æ”¯æŒçš„å‘½ä»¤ï¼ˆå®˜æ–¹å‘½ä»¤å’Œä¸€äº›éå®˜æ–¹å‘½ä»¤ï¼‰åœ¨ [doc/protocol.txt](https://github.com/memcached/memcached/blob/master/doc/protocol.txt) æ–‡æ¡£ä¸­æœ‰è®°å½•ã€‚

é—æ†¾çš„æ˜¯ï¼Œè¯­æ³•æè¿°å¹¶ä¸æ¸…æ™°ï¼Œä¸€ä¸ªç®€å•çš„å¸®åŠ©å‘½ä»¤åˆ—å‡ºç°æœ‰çš„å‘½ä»¤ä¼šæ›´å¥½ã€‚ä»¥ä¸‹æ˜¯ä½ å¯ä»¥åœ¨ [source](https://github.com/memcached/memcached) ä¸­æ‰¾åˆ°çš„å‘½ä»¤æ¦‚è¿°ï¼ˆæˆªè‡³ 2016 å¹´ 8 æœˆ 19 æ—¥ï¼‰ï¼š

| å‘½ä»¤                  | æè¿°                                                         | ç¤ºä¾‹                                                                                                                                                                                                                                     |
| --------------------- | ----------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| get                   | è¯»å–å€¼                                                       | `get mykey`                                                                                                                                                                                                                                 |
| set                   | æ— æ¡ä»¶è®¾ç½®é”®                                                 | <p><code>set mykey &#x3C;flags> &#x3C;ttl> &#x3C;size></code><br><br>&#x3C;p>åœ¨ä½¿ç”¨ Unix CLI å·¥å…·æ—¶ï¼Œè¯·ç¡®ä¿ä½¿ç”¨ \r\n ä½œä¸ºæ¢è¡Œç¬¦ã€‚ä¾‹å¦‚&#x3C;/p> <code>printf "set mykey 0 60 4\r\ndata\r\n" | nc localhost 11211</code></p> |
| add                   | æ·»åŠ æ–°é”®                                                     | `add newkey 0 60 5`                                                                                                                                                                                                                         |
| replace               | è¦†ç›–ç°æœ‰é”®                                                   | `replace key 0 60 5`                                                                                                                                                                                                                        |
| append                | è¿½åŠ æ•°æ®åˆ°ç°æœ‰é”®                                             | `append key 0 60 15`                                                                                                                                                                                                                        |
| prepend               | åœ¨ç°æœ‰é”®å‰æ·»åŠ æ•°æ®                                           | `prepend key 0 60 15`                                                                                                                                                                                                                       |
| incr                  | å°†æ•°å€¼é”®çš„å€¼å¢åŠ ç»™å®šçš„æ•°å­—                                   | `incr mykey 2`                                                                                                                                                                                                                              |
| decr                  | å°†æ•°å€¼é”®çš„å€¼å‡å»ç»™å®šçš„æ•°å­—                                   | `decr mykey 5`                                                                                                                                                                                                                              |
| delete                | åˆ é™¤ç°æœ‰é”®                                                   | `delete mykey`                                                                                                                                                                                                                              |
| flush\_all            | ç«‹å³ä½¿æ‰€æœ‰é¡¹ç›®å¤±æ•ˆ                                           | `flush_all`                                                                                                                                                                                                                                 |
| flush\_all            | åœ¨ n ç§’å†…ä½¿æ‰€æœ‰é¡¹ç›®å¤±æ•ˆ                                      | `flush_all 900`                                                                                                                                                                                                                             |
| stats                 | æ‰“å°å¸¸è§„ç»Ÿè®¡ä¿¡æ¯                                             | `stats`                                                                                                                                                                                                                                     |
|                       | æ‰“å°å†…å­˜ç»Ÿè®¡ä¿¡æ¯                                             | `stats slabs`                                                                                                                                                                                                                               |
|                       | æ‰“å°æ›´é«˜çº§åˆ«çš„åˆ†é…ç»Ÿè®¡ä¿¡æ¯                                   | `stats malloc`                                                                                                                                                                                                                              |
|                       | æ‰“å°é¡¹ç›®ä¿¡æ¯                                                 | `stats items`                                                                                                                                                                                                                               |
|                       |                                                               | `stats detail`                                                                                                                                                                                                                              |
|                       |                                                               | `stats sizes`                                                                                                                                                                                                                               |
|                       | é‡ç½®ç»Ÿè®¡è®¡æ•°å™¨                                               | `stats reset`                                                                                                                                                                                                                               |
| lru\_crawler metadump | è½¬å‚¨ç¼“å­˜ä¸­ï¼ˆå¤§éƒ¨åˆ†ï¼‰é¡¹ç›®çš„å…ƒæ•°æ®                             | `lru_crawler metadump all`                                                                                                                                                                                                                  |
| version               | æ‰“å°æœåŠ¡å™¨ç‰ˆæœ¬                                               | `version`                                                                                                                                                                                                                                   |
| verbosity             | å¢åŠ æ—¥å¿—çº§åˆ«                                                 | `verbosity`                                                                                                                                                                                                                                 |
| quit                  | ç»ˆæ­¢ä¼šè¯                                                     | `quit`                                                                                                                                                                                                                                      |

#### æµé‡ç»Ÿè®¡ <a href="#traffic-statistics" id="traffic-statistics"></a>

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢å½“å‰çš„æµé‡ç»Ÿè®¡ä¿¡æ¯
```
stats
```
æ‚¨å°†è·å¾—ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«è¿æ¥æ•°ã€å­—èŠ‚è¾“å…¥/è¾“å‡ºç­‰ä¿¡æ¯ã€‚

ç¤ºä¾‹è¾“å‡ºï¼š
```
STAT pid 14868
STAT uptime 175931
STAT time 1220540125
STAT version 1.2.2
STAT pointer_size 32
STAT rusage_user 620.299700
STAT rusage_system 1545.703017
STAT curr_items 228
STAT total_items 779
STAT bytes 15525
STAT curr_connections 92
STAT total_connections 1740
STAT connection_structures 165
STAT cmd_get 7411
STAT cmd_set 28445156
STAT get_hits 5183
STAT get_misses 2228
STAT evictions 0
STAT bytes_read 2112768087
STAT bytes_written 1000038245
STAT limit_maxbytes 52428800
STAT threads 1
END
```
#### å†…å­˜ç»Ÿè®¡ <a href="#memory-statistics" id="memory-statistics"></a>

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢å½“å‰çš„å†…å­˜ç»Ÿè®¡ä¿¡æ¯ï¼š
```
stats slabs
```
# Memcache Commands

Memcache is a widely used distributed memory caching system. It is often used to speed up dynamic database-driven websites by caching data and objects in memory to reduce the need for repeated database queries.

## Basic Commands

### SET

**Command**: `set <key> <flags> <exptime> <bytes> [noreply]`

**Description**: Stores the specified value in the cache under the given key. The `flags` parameter is used to store metadata about the value, such as its data type or compression method. The `exptime` parameter specifies the expiration time in seconds. The `bytes` parameter indicates the size of the value in bytes. The optional `noreply` parameter tells the server not to send a response.

**Example**: `set mykey 0 3600 5\r\nhello\r\n`

### GET

**Command**: `get <key>`

**Description**: Retrieves the value stored in the cache under the given key.

**Example**: `get mykey`

### DELETE

**Command**: `delete <key> [noreply]`

**Description**: Deletes the value stored in the cache under the given key. The optional `noreply` parameter tells the server not to send a response.

**Example**: `delete mykey`

## Advanced Commands

### INCR

**Command**: `incr <key> <value>`

**Description**: Increments the value stored in the cache under the given key by the specified amount. If the value is not numeric, an error is returned.

**Example**: `incr mykey 10`

### DECR

**Command**: `decr <key> <value>`

**Description**: Decrements the value stored in the cache under the given key by the specified amount. If the value is not numeric, an error is returned.

**Example**: `decr mykey 5`

### APPEND

**Command**: `append <key> <bytes> [noreply]`

**Description**: Appends the specified value to the value stored in the cache under the given key. The `bytes` parameter indicates the size of the value to be appended. The optional `noreply` parameter tells the server not to send a response.

**Example**: `append mykey 5\r\nworld\r\n`

### PREPEND

**Command**: `prepend <key> <bytes> [noreply]`

**Description**: Prepends the specified value to the value stored in the cache under the given key. The `bytes` parameter indicates the size of the value to be prepended. The optional `noreply` parameter tells the server not to send a response.

**Example**: `prepend mykey 5\r\nhello\r\n`

### CAS

**Command**: `cas <key> <flags> <exptime> <bytes> <cas_unique> [noreply]`

**Description**: Stores the specified value in the cache under the given key, but only if the value has not been modified since the last retrieval. The `cas_unique` parameter is a unique identifier for the value. The `flags`, `exptime`, and `bytes` parameters have the same meaning as in the `set` command. The optional `noreply` parameter tells the server not to send a response.

**Example**: `cas mykey 0 3600 5 12345\r\nhello\r\n`

## Conclusion

These are some of the basic and advanced commands available in Memcache. Understanding and utilizing these commands can greatly enhance your ability to work with Memcache and optimize the performance of your applications.
```
STAT 1:chunk_size 80
STAT 1:chunks_per_page 13107
STAT 1:total_pages 1
STAT 1:total_chunks 13107
STAT 1:used_chunks 13106
STAT 1:free_chunks 1
STAT 1:free_chunks_end 12886
STAT 2:chunk_size 100
STAT 2:chunks_per_page 10485
STAT 2:total_pages 1
STAT 2:total_chunks 10485
STAT 2:used_chunks 10484
STAT 2:free_chunks 1
STAT 2:free_chunks_end 10477
[...]
STAT active_slabs 3
STAT total_malloced 3145436
END
```
å¦‚æœæ‚¨ä¸ç¡®å®šæ‚¨çš„memcachedå®ä¾‹æ˜¯å¦æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œè¯·å§‹ç»ˆå…³æ³¨â€œstatsâ€å‘½ä»¤ç»™å‡ºçš„â€œevictionsâ€è®¡æ•°å™¨ã€‚å¦‚æœæ‚¨çš„å®ä¾‹æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œé‚£ä¹ˆâ€œevictionsâ€è®¡æ•°å™¨åº”è¯¥ä¸º0ï¼Œæˆ–è€…è‡³å°‘ä¸ä¼šå¢åŠ ã€‚

#### ä½¿ç”¨äº†å“ªäº›é”®ï¼Ÿ<a href="#which-keys-are-used" id="which-keys-are-used"></a>

æ²¡æœ‰å†…ç½®å‡½æ•°å¯ä»¥ç›´æ¥ç¡®å®šå½“å‰ä½¿ç”¨çš„é”®é›†ã€‚ä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```
stats items
```
### Command to Determine How Many Keys Exist

To determine the number of keys that exist in a Memcache server, you can use the `stats` command. This command provides statistics about the server, including the total number of keys stored.

```bash
stats items
```

This command will return a list of items with their corresponding statistics. Look for the line that starts with `STAT items:`, which indicates the total number of items (keys) stored in the Memcache server.

For example:

```bash
STAT items:1:number 10
```

In this example, the Memcache server has a total of 10 keys stored.
```
stats items
STAT items:1:number 220
STAT items:1:age 83095
STAT items:2:number 7
STAT items:2:age 1405
[...]
END
```
è¿™è‡³å°‘æœ‰åŠ©äºæŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ä»»ä½•é”®ã€‚è¦ä»å·²ç»æ‰§è¡Œäº†memcacheè®¿é—®çš„PHPè„šæœ¬ä¸­è½¬å‚¨é”®åç§°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ¥è‡ª[100days.de](http://100days.de/serendipity/archives/55-Dumping-MemcacheD-Content-Keys-with-PHP.html)çš„PHPä»£ç ã€‚

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTæ”¶è—å“](https://opensea.io/collection/the-peass-family)â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
