# Memcache å‘½ä»¤

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live) ä¸Š**å…³æ³¨**æˆ‘ä»¬ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## å‘½ä»¤é€ŸæŸ¥è¡¨

**æ¥æº** [**https://lzone.de/cheat-sheet/memcached**](https://lzone.de/cheat-sheet/memcached)

æ”¯æŒçš„å‘½ä»¤ï¼ˆå®˜æ–¹å‘½ä»¤å’Œä¸€äº›éå®˜æ–¹å‘½ä»¤ï¼‰åœ¨ [doc/protocol.txt](https://github.com/memcached/memcached/blob/master/doc/protocol.txt) æ–‡æ¡£ä¸­æœ‰è®°å½•ã€‚

é—æ†¾çš„æ˜¯è¯­æ³•æè¿°å¹¶ä¸æ¸…æ™°ï¼Œä¸€ä¸ªç®€å•çš„å¸®åŠ©å‘½ä»¤åˆ—å‡ºç°æœ‰å‘½ä»¤ä¼šæ›´å¥½ã€‚ä»¥ä¸‹æ˜¯æ‚¨å¯ä»¥åœ¨ [æºä»£ç ](https://github.com/memcached/memcached) ä¸­æ‰¾åˆ°çš„å‘½ä»¤æ¦‚è¿°ï¼ˆæˆªè‡³ 2016 å¹´ 8 æœˆ 19 æ—¥ï¼‰ï¼š

| å‘½ä»¤               | æè¿°                                                     | ç¤ºä¾‹                                                                                                                                                                                                                                     |
| --------------------- | --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| get                   | è¯»å–å€¼                                                   | `get mykey`                                                                                                                                                                                                                                 |
| set                   | æ— æ¡ä»¶è®¾ç½®å¯†é’¥                                       | <p><code>set mykey &#x3C;flags> &#x3C;ttl> &#x3C;size></code><br><br>&#x3C;p>åœ¨ä½¿ç”¨ Unix CLI å·¥å…·æ—¶ï¼Œè¯·ç¡®ä¿ä½¿ç”¨ \r\n ä½œä¸ºæ¢è¡Œç¬¦ã€‚ä¾‹å¦‚&#x3C;/p> <code>printf "set mykey 0 60 4\r\ndata\r\n" | nc localhost 11211</code></p> |
| add                   | æ·»åŠ æ–°å¯†é’¥                                                   | `add newkey 0 60 5`                                                                                                                                                                                                                         |
| replace               | è¦†ç›–ç°æœ‰å¯†é’¥                                          | `replace key 0 60 5`                                                                                                                                                                                                                        |
| append                | å°†æ•°æ®é™„åŠ åˆ°ç°æœ‰å¯†é’¥                                     | `append key 0 60 15`                                                                                                                                                                                                                        |
| prepend               | å°†æ•°æ®å‰ç½®åˆ°ç°æœ‰å¯†é’¥                                    | `prepend key 0 60 15`                                                                                                                                                                                                                       |
| incr                  | å°†ç»™å®šæ•°å­—åŠ åˆ°å¯†é’¥å€¼ä¸Š                  | `incr mykey 2`                                                                                                                                                                                                                              |
| decr                  | å°†ç»™å®šæ•°å­—å‡å»å¯†é’¥å€¼                  | `decr mykey 5`                                                                                                                                                                                                                              |
| delete                | åˆ é™¤ç°æœ‰å¯†é’¥                                         | `delete mykey`                                                                                                                                                                                                                              |
| flush\_all            | ç«‹å³ä½¿æ‰€æœ‰é¡¹ç›®æ— æ•ˆ                                | `flush_all`                                                                                                                                                                                                                                 |
| flush\_all            | åœ¨ n ç§’å†…ä½¿æ‰€æœ‰é¡¹ç›®æ— æ•ˆ                               | `flush_all 900`                                                                                                                                                                                                                             |
| stats                 | æ‰“å°ä¸€èˆ¬ç»Ÿè®¡ä¿¡æ¯                                       | `stats`                                                                                                                                                                                                                                     |
|                       | æ‰“å°å†…å­˜ç»Ÿè®¡ä¿¡æ¯                                        | `stats slabs`                                                                                                                                                                                                                               |
|                       | æ‰“å°æ›´é«˜çº§åˆ«çš„åˆ†é…ç»Ÿè®¡ä¿¡æ¯                        | `stats malloc`                                                                                                                                                                                                                              |
|                       | æ‰“å°é¡¹ç›®ä¿¡æ¯                                             | `stats items`                                                                                                                                                                                                                               |
|                       |                                                                 | `stats detail`                                                                                                                                                                                                                              |
|                       |                                                                 | `stats sizes`                                                                                                                                                                                                                               |
|                       | é‡ç½®ç»Ÿè®¡è®¡æ•°å™¨                                      | `stats reset`                                                                                                                                                                                                                               |
| lru\_crawler metadump | è½¬å‚¨ç¼“å­˜ä¸­æ‰€æœ‰é¡¹ç›®çš„ï¼ˆå¤§éƒ¨åˆ†ï¼‰å…ƒæ•°æ® | `lru_crawler metadump all`                                                                                                                                                                                                                  |
| version               | æ‰“å°æœåŠ¡å™¨ç‰ˆæœ¬ã€‚                                      | `version`                                                                                                                                                                                                                                   |
| verbosity             | å¢åŠ æ—¥å¿—çº§åˆ«                                         | `verbosity`                                                                                                                                                                                                                                 |
| quit                  | ç»ˆæ­¢ä¼šè¯                                               | `quit`                                                                                                                                                                                                                                      |

#### æµé‡ç»Ÿè®¡ <a href="#traffic-statistics" id="traffic-statistics"></a>

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢å½“å‰æµé‡ç»Ÿè®¡ä¿¡æ¯
```
stats
```
æ‚¨å°†è·å¾—ä¸€ä¸ªåˆ—å‡ºè¿æ¥æ•°ã€æ”¶å‘å­—èŠ‚æ•°ç­‰ä¿¡æ¯çš„æ¸…å•ã€‚

ç¤ºä¾‹è¾“å‡ºï¼š
```
STAT pid 14868
STAT uptime 175931
STAT time 1220540125
STAT version 1.2.2
STAT pointer_size 32
STAT rusage_user 620.299700
STAT rusage_system 1545.703017
STAT curr_items 228
STAT total_items 779
STAT bytes 15525
STAT curr_connections 92
STAT total_connections 1740
STAT connection_structures 165
STAT cmd_get 7411
STAT cmd_set 28445156
STAT get_hits 5183
STAT get_misses 2228
STAT evictions 0
STAT bytes_read 2112768087
STAT bytes_written 1000038245
STAT limit_maxbytes 52428800
STAT threads 1
END
```
#### å†…å­˜ç»Ÿè®¡ <a href="#memory-statistics" id="memory-statistics"></a>

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢å½“å‰å†…å­˜ç»Ÿè®¡ä¿¡æ¯
```
stats slabs
```
```markdown
## Memcache Commands

### Stats Command

The `stats` command is used to retrieve general statistics about the Memcached server. This command can provide information such as total number of connections, memory usage, hit and miss ratio, and more.

To use the `stats` command, you can simply run:

```bash
stats
```

This will return a list of statistics that can help you analyze the performance and usage of the Memcached server.

### Set Command

The `set` command is used to store a new key with some data on the Memcached server. This command requires the key, flags, expiration time, and the length of data in bytes.

To use the `set` command, you can run:

```bash
set mykey 0 3600 5
hello
```

In this example, we are setting a key `mykey` with a value of `hello` that expires in 3600 seconds.

### Get Command

The `get` command is used to retrieve the data stored with a specific key on the Memcached server.

To use the `get` command, you can run:

```bash
get mykey
```

This will return the value associated with the key `mykey`, if it exists in the Memcached server.
```
```
STAT 1:chunk_size 80
STAT 1:chunks_per_page 13107
STAT 1:total_pages 1
STAT 1:total_chunks 13107
STAT 1:used_chunks 13106
STAT 1:free_chunks 1
STAT 1:free_chunks_end 12886
STAT 2:chunk_size 100
STAT 2:chunks_per_page 10485
STAT 2:total_pages 1
STAT 2:total_chunks 10485
STAT 2:used_chunks 10484
STAT 2:free_chunks 1
STAT 2:free_chunks_end 10477
[...]
STAT active_slabs 3
STAT total_malloced 3145436
END
```
å¦‚æœæ‚¨ä¸ç¡®å®šæ‚¨çš„memcachedå®ä¾‹æ˜¯å¦æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œè¯·å§‹ç»ˆå…³æ³¨â€œstatsâ€å‘½ä»¤æä¾›çš„â€œevictionsâ€è®¡æ•°å™¨ã€‚å¦‚æœå®ä¾‹æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œâ€œevictionsâ€è®¡æ•°å™¨åº”ä¸º0ï¼Œæˆ–è€…è‡³å°‘ä¸ä¼šå¢åŠ ã€‚

#### ä½¿ç”¨äº†å“ªäº›é”®ï¼Ÿ <a href="#which-keys-are-used" id="which-keys-are-used"></a>

æ²¡æœ‰å†…ç½®å‡½æ•°å¯ä»¥ç›´æ¥ç¡®å®šå½“å‰çš„é”®é›†ã€‚ä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨
```
stats items
```
### Command to determine how many keys do exist.

æŸ¥è¯¢å­˜åœ¨å¤šå°‘ä¸ªé”®çš„å‘½ä»¤ã€‚
```
stats items
STAT items:1:number 220
STAT items:1:age 83095
STAT items:2:number 7
STAT items:2:age 1405
[...]
END
```
è¿™è‡³å°‘æœ‰åŠ©äºæŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ä»»ä½•é”®ã€‚è¦ä»å·²ç»æ‰§è¡Œmemcacheè®¿é—®çš„PHPè„šæœ¬ä¸­è½¬å‚¨é”®åç§°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ¥è‡ª[100days.de](http://100days.de/serendipity/archives/55-Dumping-MemcacheD-Content-Keys-with-PHP.html)çš„PHPä»£ç ã€‚

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ä¸Šå…³æ³¨**æˆ‘ä»¬ã€‚
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
