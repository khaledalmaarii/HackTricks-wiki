# 135, 593 - MSRPCì˜ Pentesting

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking Tricksë¥¼ ê³µìœ í•˜ë ¤ë©´ PRì„** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ë°** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ì €ì¥ì†Œì— ì œì¶œ**í•˜ì„¸ìš”.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ìˆëŠ” í•´ì»¤ì™€ ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ì™€ ì†Œí†µí•˜ê¸° ìœ„í•´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°ë ¥**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ ì‘ìš©í•˜ì„¸ìš”.

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ ë”°ë¼ê°€ì„¸ìš”.

**ìµœì‹  ê³µì§€ì‚¬í•­**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ìµœì‹  ì •ë³´ë¥¼ ë°›ì•„ë³´ì„¸ìš”.

**[Discord](https://discord.com/invite/N3FrSbmwdy)ì— ì°¸ì—¬í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!**

## ê¸°ë³¸ ì •ë³´

Microsoft ì›ê²© í”„ë¡œì‹œì € í˜¸ì¶œ(MSRPC) í”„ë¡œí† ì½œì€ í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ëª¨ë¸ë¡œ, ë„¤íŠ¸ì›Œí¬ì˜ ì„¸ë¶€ ì‚¬í•­ì„ ì´í•´í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ì»´í“¨í„°ì— ìœ„ì¹˜í•œ í”„ë¡œê·¸ë¨ìœ¼ë¡œë¶€í„° ì„œë¹„ìŠ¤ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í”„ë¡œí† ì½œì…ë‹ˆë‹¤. ì´ í”„ë¡œí† ì½œì€ ì›ë˜ ì˜¤í”ˆ ì†ŒìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ íŒŒìƒë˜ì—ˆìœ¼ë©°, í›„ì— Microsoftì—ì„œ ê°œë°œ ë° ì €ì‘ê¶Œì„ ì·¨ë“í–ˆìŠµë‹ˆë‹¤.

RPC ì—”ë“œí¬ì¸íŠ¸ ë§¤í¼ëŠ” TCP ë° UDP í¬íŠ¸ 135ë¥¼ í†µí•´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë©°, TCP 139 ë° 445ì—ì„œ SMB(ì¸ì¦ë˜ì§€ ì•Šì€ ë˜ëŠ” ì¸ì¦ëœ ì„¸ì…˜)ìœ¼ë¡œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë©°, TCP í¬íŠ¸ 593ì—ì„œ ì›¹ ì„œë¹„ìŠ¤ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## MSRPCëŠ” ì–´ë–»ê²Œ ì‘ë™í•˜ë‚˜ìš”?

í´ë¼ì´ì–¸íŠ¸ ì‘ìš© í”„ë¡œê·¸ë¨ì— ì˜í•´ ì‹œì‘ë˜ëŠ” MSRPC í”„ë¡œì„¸ìŠ¤ëŠ” ë¡œì»¬ ìŠ¤í… í”„ë¡œì‹œì €ë¥¼ í˜¸ì¶œí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ëŸ°íƒ€ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ìƒí˜¸ ì‘ìš©í•˜ì—¬ ìš”ì²­ì„ ì„œë²„ë¡œ ì¤€ë¹„í•˜ê³  ì „ì†¡í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ëŠ” ë§¤ê°œ ë³€ìˆ˜ë¥¼ í‘œì¤€ ë„¤íŠ¸ì›Œí¬ ë°ì´í„° í‘œí˜„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒë„ í¬í•¨ë©ë‹ˆë‹¤. ì „ì†¡ í”„ë¡œí† ì½œì˜ ì„ íƒì€ ì„œë²„ê°€ ì›ê²©ì¸ ê²½ìš° ëŸ°íƒ€ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜í•´ ê²°ì •ë˜ë©°, RPCê°€ ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒì„ í†µí•´ ì „ë‹¬ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **ë…¸ì¶œëœ RPC ì„œë¹„ìŠ¤ ì‹ë³„í•˜ê¸°**

RPC ë¡œì¼€ì´í„° ì„œë¹„ìŠ¤ì™€ ê°œë³„ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¿¼ë¦¬í•¨ìœ¼ë¡œì¨ TCP, UDP, HTTP ë° SMBë¥¼ í†µí•œ RPC ì„œë¹„ìŠ¤ì˜ ë…¸ì¶œ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. rpcdumpì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³ ìœ í•œ RPC ì„œë¹„ìŠ¤(IFID ê°’ìœ¼ë¡œ í‘œì‹œë¨)ë¥¼ ì‹ë³„í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ì„¸ë¶€ ì •ë³´ì™€ í†µì‹  ë°”ì¸ë”©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
RPC ë¡œì¼€ì´í„° ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ëŠ” íŠ¹ì • í”„ë¡œí† ì½œì„ í†µí•´ í™œì„±í™”ë©ë‹ˆë‹¤: í¬íŠ¸ 135ë¥¼ í†µí•œ ì•¡ì„¸ìŠ¤ë¥¼ ìœ„í•œ ncacn\_ip\_tcp ë° ncadg\_ip\_udp, SMB ì—°ê²°ì„ ìœ„í•œ ncacn\_np, ì›¹ ê¸°ë°˜ RPC í†µì‹ ì„ ìœ„í•œ ncacn\_http. ë‹¤ìŒ ëª…ë ¹ì€ Metasploit ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ MSRPC ì„œë¹„ìŠ¤ë¥¼ ê°ì‚¬í•˜ê³  ìƒí˜¸ ì‘ìš©í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤. ì£¼ë¡œ í¬íŠ¸ 135ì— ì´ˆì ì„ ë§ì¶¥ë‹ˆë‹¤:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
`tcp_dcerpc_auditor`ë¥¼ ì œì™¸í•œ ëª¨ë“  ì˜µì…˜ì€ í¬íŠ¸ 135ì˜ MSRPCë¥¼ ëŒ€ìƒìœ¼ë¡œ íŠ¹ë³„íˆ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

#### ì£¼ëª©í• ë§Œí•œ RPC ì¸í„°í˜ì´ìŠ¤

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Named Pipe**: `\pipe\lsarpc`
* **Description**: ì‚¬ìš©ìë¥¼ ì—´ê±°í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” LSA ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.


* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Named Pipe**: `\pipe\lsarpc`
* **Description**: ë„ë©”ì¸ ë° ì‹ ë¢° ê´€ê³„ë¥¼ ì—´ê±°í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” LSA ë””ë ‰í„°ë¦¬ ì„œë¹„ìŠ¤(DS) ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.


* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Named Pipe**: `\pipe\samr`
* **Description**: ê³„ì • ì ê¸ˆ ì •ì±…ê³¼ ê´€ê³„ì—†ì´ ê³µê°œ SAM ë°ì´í„°ë² ì´ìŠ¤ ìš”ì†Œ(ì˜ˆ: ì‚¬ìš©ì ì´ë¦„)ì— ì•¡ì„¸ìŠ¤í•˜ê³  ì‚¬ìš©ì ì•”í˜¸ë¥¼ ë¬´ì°¨ë³„ ëŒ€ì…í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” LSA SAMR ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.


* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Named Pipe**: `\pipe\atsvc`
* **Description**: ì›ê²©ìœ¼ë¡œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ì…ë‹ˆë‹¤.


* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Named Pipe**: `\pipe\winreg`
* **Description**: ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì•¡ì„¸ìŠ¤í•˜ê³  ìˆ˜ì •í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì›ê²© ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.


* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Named Pipe**: `\pipe\svcctl`
* **Description**: ì„œë¹„ìŠ¤ ì œì–´ ê´€ë¦¬ì ë° ì„œë²„ ì„œë¹„ìŠ¤ë¥¼ ì›ê²©ìœ¼ë¡œ ì‹œì‘í•˜ê³  ì¤‘ì§€í•˜ë©° ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.


* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Named Pipe**: `\pipe\srvsvc`
* **Description**: ì„œë¹„ìŠ¤ ì œì–´ ê´€ë¦¬ì ë° ì„œë²„ ì„œë¹„ìŠ¤ë¥¼ ì›ê²©ìœ¼ë¡œ ì‹œì‘í•˜ê³  ì¤‘ì§€í•˜ë©° ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.


* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Named Pipe**: `\pipe\epmapper`
* **Description**: DCOM ì¸í„°í˜ì´ìŠ¤ë¡œ, ì•”í˜¸ ëŒ€ì… ë° ì •ë³´ ìˆ˜ì§‘ì„ ìœ„í•´ WMì„ í†µí•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

### IP ì£¼ì†Œ ì‹ë³„

[https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver)ë¥¼ ì‚¬ìš©í•˜ì—¬ _**IOXIDResolver**_ ì¸í„°í˜ì´ìŠ¤ ë‚´ë¶€ì˜ _**ServerAlive2**_ ë©”ì„œë“œë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ë°©ë²•ì€ HTB ìƒì _APT_ì—ì„œ **IPv6** ì£¼ì†Œì™€ ê°™ì€ ì¸í„°í˜ì´ìŠ¤ ì •ë³´ë¥¼ ì–»ëŠ” ë° ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. 0xdfì˜ APT writeupì¸ [ì—¬ê¸°](https://0xdf.gitlab.io/2021/04/10/htb-apt.html)ì—ì„œëŠ” rpcmap.pyë¥¼ ì‚¬ìš©í•˜ì—¬ _stringbinding_ì„ í†µí•´ ëŒ€ì²´ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

## í¬íŠ¸ 593

[rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools)ì˜ **rpcdump.exe**ë¥¼ ì´ í¬íŠ¸ì™€ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#â€‹# ì°¸ê³  ìë£Œ
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ ë§ì€ í•´ì»¤ì™€ ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ì™€ ì†Œí†µí•˜ë ¤ë©´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ì°¸ì—¬í•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°ë ¥**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì„ ë‹¤ë£¨ëŠ” ì½˜í…ì¸ ì— ì°¸ì—¬í•˜ì„¸ìš”.

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ ë”°ë¼ê°€ì„¸ìš”.

**ìµœì‹  ê³µì§€ì‚¬í•­**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ë°›ì•„ë³´ì„¸ìš”.

**ì˜¤ëŠ˜ ë°”ë¡œ** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **ì— ê°€ì…í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!**

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* íšŒì‚¬ë¥¼ **HackTricksì—ì„œ ê´‘ê³ **í•˜ê±°ë‚˜ **PDFë¡œ HackTricks ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”.
* ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì¸ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
