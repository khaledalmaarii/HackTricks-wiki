# 135, 593 - æ¸—é€æµ‹è¯• MSRPC

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆçš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨**æˆ‘ä»¬ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œèµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢è§è§£**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€å’ŒæŒ‘æˆ˜çš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£åŠæ—¶äº†è§£å¿«èŠ‚å¥çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
é€šè¿‡æœ€æ–°çš„èµé‡‘è®¡åˆ’å‘å¸ƒå’Œé‡è¦å¹³å°æ›´æ–°ä¿æŒä¿¡æ¯æ›´æ–°

**åŠ å…¥æˆ‘ä»¬çš„** [**Discord**](https://discord.com/invite/N3FrSbmwdy)ï¼Œç«‹å³ä¸é¡¶å°–é»‘å®¢åˆä½œï¼

## åŸºæœ¬ä¿¡æ¯

Microsoft è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆMSRPCï¼‰åè®®æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ï¼Œä½¿ç¨‹åºèƒ½å¤Ÿä»ä½äºå¦ä¸€å°è®¡ç®—æœºä¸Šçš„ç¨‹åºè¯·æ±‚æœåŠ¡ï¼Œè€Œæ— éœ€äº†è§£ç½‘ç»œçš„å…·ä½“ç»†èŠ‚ã€‚è¯¥åè®®æœ€åˆæºè‡ªå¼€æºè½¯ä»¶ï¼Œåæ¥ç”± Microsoft å¼€å‘å¹¶æ‹¥æœ‰ç‰ˆæƒã€‚

RPC ç«¯ç‚¹æ˜ å°„å™¨å¯ä»¥é€šè¿‡ TCP å’Œ UDP ç«¯å£ 135 è®¿é—®ï¼ŒSMB å¯ä»¥é€šè¿‡ TCP 139 å’Œ 445ï¼ˆä½¿ç”¨ç©ºä¼šè¯æˆ–ç»è¿‡èº«ä»½éªŒè¯çš„ä¼šè¯ï¼‰è®¿é—®ï¼Œä¹Ÿå¯ä»¥ä½œä¸º Web æœåŠ¡åœ¨ TCP ç«¯å£ 593 ä¸Šè®¿é—®ã€‚
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## MSRPCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

ç”±å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå‘èµ·ï¼ŒMSRPCè¿‡ç¨‹æ¶‰åŠè°ƒç”¨æœ¬åœ°å­˜æ ¹è¿‡ç¨‹ï¼Œç„¶åä¸å®¢æˆ·ç«¯è¿è¡Œæ—¶åº“äº¤äº’ï¼Œå‡†å¤‡å¹¶ä¼ è¾“è¯·æ±‚åˆ°æœåŠ¡å™¨ã€‚è¿™åŒ…æ‹¬å°†å‚æ•°è½¬æ¢ä¸ºæ ‡å‡†çš„ç½‘ç»œæ•°æ®è¡¨ç¤ºæ ¼å¼ã€‚å¦‚æœæœåŠ¡å™¨æ˜¯è¿œç¨‹çš„ï¼Œä¼ è¾“åè®®çš„é€‰æ‹©ç”±è¿è¡Œæ—¶åº“ç¡®å®šï¼Œç¡®ä¿RPCé€šè¿‡ç½‘ç»œå †æ ˆä¼ é€’ã€‚

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **è¯†åˆ«æš´éœ²çš„RPCæœåŠ¡**

é€šè¿‡æŸ¥è¯¢RPCå®šä½å™¨æœåŠ¡å’Œå„ä¸ªç«¯ç‚¹ï¼Œå¯ä»¥ç¡®å®šRPCæœåŠ¡åœ¨TCPã€UDPã€HTTPå’ŒSMBä¸Šçš„æš´éœ²æƒ…å†µã€‚è¯¸å¦‚rpcdumpä¹‹ç±»çš„å·¥å…·æœ‰åŠ©äºè¯†åˆ«ç‹¬ç‰¹çš„RPCæœåŠ¡ï¼Œç”±**IFID**å€¼è¡¨ç¤ºï¼Œæ­ç¤ºæœåŠ¡è¯¦ç»†ä¿¡æ¯å’Œé€šä¿¡ç»‘å®šï¼š
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
è®¿é—®RPCå®šä½å™¨æœåŠ¡æ˜¯é€šè¿‡ç‰¹å®šåè®®å¯ç”¨çš„ï¼šncacn_ip_tcp å’Œ ncadg_ip_udp ç”¨äºé€šè¿‡ç«¯å£ 135 è®¿é—®ï¼Œncacn_np ç”¨äº SMB è¿æ¥ï¼Œncacn_http ç”¨äºåŸºäº Web çš„ RPC é€šä¿¡ã€‚ä»¥ä¸‹å‘½ä»¤ç¤ºä¾‹å±•ç¤ºäº†åˆ©ç”¨ Metasploit æ¨¡å—å®¡è®¡å’Œä¸ MSRPC æœåŠ¡äº¤äº’ï¼Œä¸»è¦é›†ä¸­åœ¨ç«¯å£ 135 ä¸Šï¼š
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
é™¤äº†`tcp_dcerpc_auditor`ä¹‹å¤–ï¼Œæ‰€æœ‰é€‰é¡¹éƒ½æ˜¯ä¸“é—¨è®¾è®¡ç”¨äºé’ˆå¯¹ç«¯å£135ä¸Šçš„MSRPCã€‚

#### æ˜¾è‘—çš„RPCæ¥å£

- **IFID**ï¼š12345778-1234-abcd-ef00-0123456789ab
- **å‘½åç®¡é“**ï¼š`\pipe\lsarpc`
- **æè¿°**ï¼šLSAæ¥å£ï¼Œç”¨äºæšä¸¾ç”¨æˆ·ã€‚
- **IFID**ï¼š3919286a-b10c-11d0-9ba8-00c04fd92ef5
- **å‘½åç®¡é“**ï¼š`\pipe\lsarpc`
- **æè¿°**ï¼šLSAç›®å½•æœåŠ¡ï¼ˆDSï¼‰æ¥å£ï¼Œç”¨äºæšä¸¾åŸŸå’Œä¿¡ä»»å…³ç³»ã€‚
- **IFID**ï¼š12345778-1234-abcd-ef00-0123456789ac
- **å‘½åç®¡é“**ï¼š`\pipe\samr`
- **æè¿°**ï¼šLSA SAMRæ¥å£ï¼Œç”¨äºè®¿é—®å…¬å…±SAMæ•°æ®åº“å…ƒç´ ï¼ˆä¾‹å¦‚ç”¨æˆ·åï¼‰å¹¶å¯¹ç”¨æˆ·å¯†ç è¿›è¡Œæš´åŠ›ç ´è§£ï¼Œè€Œä¸å—å¸æˆ·é”å®šç­–ç•¥çš„å½±å“ã€‚
- **IFID**ï¼š1ff70682-0a51-30e8-076d-740be8cee98b
- **å‘½åç®¡é“**ï¼š`\pipe\atsvc`
- **æè¿°**ï¼šä»»åŠ¡è®¡åˆ’ç¨‹åºï¼Œç”¨äºè¿œç¨‹æ‰§è¡Œå‘½ä»¤ã€‚
- **IFID**ï¼š338cd001-2244-31f1-aaaa-900038001003
- **å‘½åç®¡é“**ï¼š`\pipe\winreg`
- **æè¿°**ï¼šè¿œç¨‹æ³¨å†Œè¡¨æœåŠ¡ï¼Œç”¨äºè®¿é—®å’Œä¿®æ”¹ç³»ç»Ÿæ³¨å†Œè¡¨ã€‚
- **IFID**ï¼š367abb81-9844-35f1-ad32-98f038001003
- **å‘½åç®¡é“**ï¼š`\pipe\svcctl`
- **æè¿°**ï¼šæœåŠ¡æ§åˆ¶ç®¡ç†å™¨å’ŒæœåŠ¡å™¨æœåŠ¡ï¼Œç”¨äºè¿œç¨‹å¯åŠ¨å’Œåœæ­¢æœåŠ¡ä»¥åŠæ‰§è¡Œå‘½ä»¤ã€‚
- **IFID**ï¼š4b324fc8-1670-01d3-1278-5a47bf6ee188
- **å‘½åç®¡é“**ï¼š`\pipe\srvsvc`
- **æè¿°**ï¼šæœåŠ¡æ§åˆ¶ç®¡ç†å™¨å’ŒæœåŠ¡å™¨æœåŠ¡ï¼Œç”¨äºè¿œç¨‹å¯åŠ¨å’Œåœæ­¢æœåŠ¡ä»¥åŠæ‰§è¡Œå‘½ä»¤ã€‚
- **IFID**ï¼š4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
- **å‘½åç®¡é“**ï¼š`\pipe\epmapper`
- **æè¿°**ï¼šDCOMæ¥å£ï¼Œç”¨äºé€šè¿‡WMè¿›è¡Œæš´åŠ›ç ´è§£å¯†ç å’Œä¿¡æ¯æ”¶é›†ã€‚

### è¯†åˆ«IPåœ°å€

ä½¿ç”¨[https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver)ï¼Œæ¥è‡ª[ç©ºä¸­å®¢è½¦ç ”ç©¶](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)ï¼Œå¯ä»¥æ»¥ç”¨_IOXIDResolver_æ¥å£å†…çš„_ServerAlive2_æ–¹æ³•ã€‚

æ­¤æ–¹æ³•å·²ç”¨äºä»HTBç›’å­_APT_ä¸­è·å–**IPv6**åœ°å€çš„æ¥å£ä¿¡æ¯ã€‚æŸ¥çœ‹[è¿™é‡Œ](https://0xdf.gitlab.io/2021/04/10/htb-apt.html)äº†è§£0xdf APTçš„è§£æï¼Œå…¶ä¸­åŒ…æ‹¬ä½¿ç”¨[Impacket](https://github.com/SecureAuthCorp/impacket/)çš„rpcmap.pyå’Œ_stringbinding_çš„æ›¿ä»£æ–¹æ³•ï¼ˆè¯·å‚è§ä¸Šæ–‡ï¼‰ã€‚

### ä½¿ç”¨æœ‰æ•ˆå‡­æ®æ‰§è¡ŒRCE

å¦‚æœå…·æœ‰æœ‰æ•ˆç”¨æˆ·çš„å‡­æ®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨[impacketæ¡†æ¶](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py)ä¸­çš„dcomexec.pyåœ¨è®¡ç®—æœºä¸Šæ‰§è¡Œè¿œç¨‹ä»£ç ã€‚

**è®°å¾—å°è¯•ä½¿ç”¨ä¸åŒçš„å¯ç”¨å¯¹è±¡**

- ShellWindows
- ShellBrowserWindow
- MMC20

## ç«¯å£593

æ¥è‡ª[rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools)çš„**rpcdump.exe**å¯ä»¥ä¸æ­¤ç«¯å£è¿›è¡Œäº¤äº’ã€‚

## å‚è€ƒèµ„æ–™

- [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
- [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
- [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œèµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢è§è§£**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€å’ŒæŒ‘æˆ˜çš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ä¿æŒä¸å¿«èŠ‚å¥çš„é»‘å®¢ä¸–ç•ŒåŒæ­¥

**æœ€æ–°å…¬å‘Š**\
é€šè¿‡æœ€æ–°çš„èµé‡‘è®¡åˆ’å¯åŠ¨å’Œé‡è¦å¹³å°æ›´æ–°ä¿æŒä¿¡æ¯æ›´æ–°

**åŠ å…¥æˆ‘ä»¬çš„** [**Discord**](https://discord.com/invite/N3FrSbmwdy)ï¼Œç«‹å³ä¸é¡¶å°–é»‘å®¢åˆä½œï¼
