# 135, 593 - MSRPC Pentesting

<details>

<summary><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)</strong>ë¥¼ í†µí•´ ì œë¡œë¶€í„° ì˜ì›…ì´ ë˜ëŠ” AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ ë§ì€ í•´ì»¤ ë° ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ì™€ ì†Œí†µí•˜ë ¤ë©´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì— ëŒ€í•´ íƒêµ¬í•˜ëŠ” ì½˜í…ì¸ ì™€ ê´€ë ¨

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ì˜ ìµœì‹  ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ ìœ ì§€í•˜ì„¸ìš”

**ìµœì‹  ê³µì§€**\
ìµœì‹  ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ì •ë³´ë¥¼ ìœ ì§€í•˜ì„¸ìš”

**[**Discord**](https://discord.com/invite/N3FrSbmwdy)ì— ì°¸ì—¬í•˜ì—¬ ì˜¤ëŠ˜ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

## ê¸°ë³¸ ì •ë³´

Microsoft ì›ê²© í”„ë¡œì‹œì € í˜¸ì¶œ(MSRPC) í”„ë¡œí† ì½œì€ í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ëª¨ë¸ë¡œ, í”„ë¡œê·¸ë¨ì´ ë„¤íŠ¸ì›Œí¬ì˜ êµ¬ì²´ì ì¸ ë‚´ìš©ì„ ì´í•´í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ì»´í“¨í„°ì— ìœ„ì¹˜í•œ í”„ë¡œê·¸ë¨ìœ¼ë¡œë¶€í„° ì„œë¹„ìŠ¤ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” í”„ë¡œí† ì½œë¡œ, ì›ë˜ ì˜¤í”ˆ ì†ŒìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ íŒŒìƒë˜ì—ˆìœ¼ë©° í›„ì— Microsoftì—ì„œ ê°œë°œ ë° ì €ì‘ê¶Œì„ ë³´ìœ í•˜ì˜€ìŠµë‹ˆë‹¤.

RPC ì—”ë“œí¬ì¸íŠ¸ ë§¤í¼ëŠ” TCP ë° UDP í¬íŠ¸ 135ë¥¼ í†µí•´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë©°, TCP 139 ë° 445ì—ì„œ SMB(ë„ ë˜ëŠ” ì¸ì¦ëœ ì„¸ì…˜)ë¡œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë©°, TCP í¬íŠ¸ 593ì—ì„œ ì›¹ ì„œë¹„ìŠ¤ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## MSRPCëŠ” ì–´ë–»ê²Œ ì‘ë™í•˜ë‚˜ìš”?

í´ë¼ì´ì–¸íŠ¸ ì‘ìš© í”„ë¡œê·¸ë¨ì— ì˜í•´ ì‹œì‘ëœ MSRPC í”„ë¡œì„¸ìŠ¤ëŠ” ë¡œì»¬ ìŠ¤í… í”„ë¡œì‹œì €ë¥¼ í˜¸ì¶œí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ëŸ°íƒ€ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ìƒí˜¸ ì‘ìš©í•˜ì—¬ ìš”ì²­ì„ ì¤€ë¹„í•˜ê³  ì „ì†¡í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ í‘œì¤€ ë„¤íŠ¸ì›Œí¬ ë°ì´í„° í‘œí˜„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì´ í¬í•¨ë©ë‹ˆë‹¤. ì„œë²„ê°€ ì›ê²©ì¸ ê²½ìš° ëŸ°íƒ€ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì „ì†¡ í”„ë¡œí† ì½œì„ ì„ íƒí•˜ì—¬ RPCê°€ ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒì„ í†µí•´ ì „ë‹¬ë˜ë„ë¡ í•©ë‹ˆë‹¤.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **ë…¸ì¶œëœ RPC ì„œë¹„ìŠ¤ ì‹ë³„**

RPC ë¡œì¼€ì´í„° ì„œë¹„ìŠ¤ ë° ê°œë³„ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¿¼ë¦¬í•˜ì—¬ TCP, UDP, HTTP ë° SMBë¥¼ í†µí•´ ë…¸ì¶œëœ RPC ì„œë¹„ìŠ¤ë¥¼ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. rpcdumpì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ **IFID** ê°’ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ê³ ìœ í•œ RPC ì„œë¹„ìŠ¤ë¥¼ ì‹ë³„í•˜ê³  ì„œë¹„ìŠ¤ ì„¸ë¶€ ì •ë³´ ë° í†µì‹  ë°”ì¸ë”©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
RPC ë¡œì¼€ì´í„° ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” íŠ¹ì • í”„ë¡œí† ì½œì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: í¬íŠ¸ 135ë¥¼ í†µí•´ ì•¡ì„¸ìŠ¤í•˜ëŠ” ê²½ìš° ncacn_ip_tcp ë° ncadg_ip_udp, SMB ì—°ê²°ì˜ ê²½ìš° ncacn_np ë° ì›¹ ê¸°ë°˜ RPC í†µì‹ ì˜ ê²½ìš° ncacn_httpì…ë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì–´ëŠ” Metasploit ëª¨ë“ˆì„ í™œìš©í•˜ì—¬ MSRPC ì„œë¹„ìŠ¤ë¥¼ ê°ì‚¬í•˜ê³  ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì£¼ë¡œ í¬íŠ¸ 135ì— ì´ˆì ì„ ë§ì¶¥ë‹ˆë‹¤:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
ëª¨ë“  ì˜µì…˜ ì¤‘ `tcp_dcerpc_auditor`ë¥¼ ì œì™¸í•œ ì˜µì…˜ì€ í¬íŠ¸ 135ì—ì„œ MSRPCë¥¼ ëŒ€ìƒìœ¼ë¡œ íŠ¹ë³„íˆ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

#### ì£¼ëª©í• ë§Œí•œ RPC ì¸í„°í˜ì´ìŠ¤

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Named Pipe**: `\pipe\lsarpc`
* **Description**: ì‚¬ìš©ìë¥¼ ë‚˜ì—´í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” LSA ì¸í„°í˜ì´ìŠ¤.
* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Named Pipe**: `\pipe\lsarpc`
* **Description**: ë„ë©”ì¸ ë° ì‹ ë¢° ê´€ê³„ë¥¼ ë‚˜ì—´í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” LSA ë””ë ‰í„°ë¦¬ ì„œë¹„ìŠ¤ (DS) ì¸í„°í˜ì´ìŠ¤.
* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Named Pipe**: `\pipe\samr`
* **Description**: ê³„ì • ì ê¸ˆ ì •ì±…ì— ê´€ê³„ì—†ì´ ê³µê°œ SAM ë°ì´í„°ë² ì´ìŠ¤ ìš”ì†Œ (ì˜ˆ: ì‚¬ìš©ì ì´ë¦„)ì— ì•¡ì„¸ìŠ¤í•˜ê³  ì‚¬ìš©ì ì•”í˜¸ë¥¼ ë¬´ì°¨ë³„ ëŒ€ì…í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” LSA SAMR ì¸í„°í˜ì´ìŠ¤.
* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Named Pipe**: `\pipe\atsvc`
* **Description**: ì›ê²©ìœ¼ë¡œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬.
* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Named Pipe**: `\pipe\winreg`
* **Description**: ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì•¡ì„¸ìŠ¤í•˜ê³  ìˆ˜ì •í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì›ê²© ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì„œë¹„ìŠ¤.
* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Named Pipe**: `\pipe\svcctl`
* **Description**: ì„œë¹„ìŠ¤ ì œì–´ ê´€ë¦¬ì ë° ì„œë²„ ì„œë¹„ìŠ¤ë¡œ ì›ê²©ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì‹œì‘ ë° ì¤‘ì§€ ë° ëª…ë ¹ ì‹¤í–‰ì— ì‚¬ìš©ë¨.
* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Named Pipe**: `\pipe\srvsvc`
* **Description**: ì„œë¹„ìŠ¤ ì œì–´ ê´€ë¦¬ì ë° ì„œë²„ ì„œë¹„ìŠ¤ë¡œ ì›ê²©ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì‹œì‘ ë° ì¤‘ì§€ ë° ëª…ë ¹ ì‹¤í–‰ì— ì‚¬ìš©ë¨.
* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Named Pipe**: `\pipe\epmapper`
* **Description**: WMì„ í†µí•´ ë¬´ì°¨ë³„ ëŒ€ì… ì•”í˜¸ ê·¸ë¼ì¸ë”© ë° ì •ë³´ ìˆ˜ì§‘ì— ì‚¬ìš©ë˜ëŠ” DCOM ì¸í„°í˜ì´ìŠ¤.

### IP ì£¼ì†Œ ì‹ë³„

[https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver)ë¥¼ ì‚¬ìš©í•˜ë©´ _**IOXIDResolver**_ ì¸í„°í˜ì´ìŠ¤ ë‚´ì˜ _**ServerAlive2**_ ë©”ì„œë“œë¥¼ ë‚¨ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” [Airbus research](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)ì—ì„œ ë‚˜ì˜¨ ê²ƒì…ë‹ˆë‹¤.

ì´ ë°©ë²•ì€ **IPv6** ì£¼ì†Œë¡œë¶€í„° ì¸í„°í˜ì´ìŠ¤ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‚¬ìš©ë˜ì—ˆìœ¼ë©° HTB ìƒì _APT_ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 0xdf APT writeupì—ì„œëŠ” rpcmap.pyë¥¼ ì‚¬ìš©í•˜ì—¬ [Impacket](https://github.com/SecureAuthCorp/impacket/)ì—ì„œ _stringbinding_ì„ ì‚¬ìš©í•˜ëŠ” ëŒ€ì²´ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

### ìœ íš¨í•œ ìê²© ì¦ëª…ìœ¼ë¡œ RCE ì‹¤í–‰

ìœ íš¨í•œ ì‚¬ìš©ìì˜ ìê²© ì¦ëª…ì´ ìˆëŠ” ê²½ìš° [impacket framework](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py)ì˜ dcomexec.pyë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ê³„ì—ì„œ ì›ê²© ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¤ì–‘í•œ ì‚¬ìš© ê°€ëŠ¥í•œ ê°ì²´ë¡œ ì‹œë„í•´ë³´ê¸°ë¥¼ ê¸°ì–µí•˜ì„¸ìš”**

* ShellWindows
* ShellBrowserWindow
* MMC20

## í¬íŠ¸ 593

**rpctools**ì˜ **rpcdump.exe**ëŠ” ì´ í¬íŠ¸ì™€ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ

* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì—¬ ê²½í—˜ ë§ì€ í•´ì»¤ ë° ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ë“¤ê³¼ ì†Œí†µí•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°**\
í•´í‚¹ì˜ ì¦ê±°ì›€ê³¼ ë„ì „ì— ëŒ€í•´ íƒêµ¬í•˜ëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ ì‘ìš©í•˜ì„¸ìš”

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ ë”°ë¼ê°€ì„¸ìš”

**ìµœì‹  ê³µì§€**\
ìµœì‹  ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ì•Œì•„ë³´ì„¸ìš”

**[**Discord**](https://discord.com/invite/N3FrSbmwdy)**ì— ì°¸ì—¬í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!**
