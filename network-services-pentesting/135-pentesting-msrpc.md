# 135, 593 - Pentesting MSRPC

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve bug bounty avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ± ve zorluklarÄ±na dalan iÃ§eriklerle etkileÅŸimde bulunun

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
GerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle hÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nda gÃ¼ncel kalÄ±n

**Son Duyurular**\
Yeni baÅŸlayan bug bounty'ler ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi sahibi olun

BugÃ¼n [**Discord**](https://discord.com/invite/N3FrSbmwdy) Ã¼zerinden bize katÄ±lÄ±n ve en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

## Temel Bilgiler

Microsoft Uzaktan ProsedÃ¼r Ã‡aÄŸrÄ±sÄ± (MSRPC) protokolÃ¼, bir programÄ±n baÅŸka bir bilgisayarda bulunan bir programdan hizmet talep etmesini saÄŸlayan bir istemci-sunucu modelidir ve aÄŸÄ±n ayrÄ±ntÄ±larÄ±nÄ± anlamadan Ã§alÄ±ÅŸÄ±r. Ä°lk olarak aÃ§Ä±k kaynak yazÄ±lÄ±mdan tÃ¼retilmiÅŸ ve daha sonra Microsoft tarafÄ±ndan geliÅŸtirilip telif hakkÄ± alÄ±nmÄ±ÅŸtÄ±r.

RPC uÃ§ noktasÄ± haritalayÄ±cÄ±, TCP ve UDP port 135, TCP 139 ve 445 Ã¼zerinde SMB (null veya kimlik doÄŸrulamalÄ± oturum ile) ve TCP port 593 Ã¼zerinde bir web hizmeti aracÄ±lÄ±ÄŸÄ±yla eriÅŸilebilir.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## MSRPC nasÄ±l Ã§alÄ±ÅŸÄ±r?

Ä°stemci uygulamasÄ± tarafÄ±ndan baÅŸlatÄ±lan MSRPC sÃ¼reci, istemci Ã§alÄ±ÅŸma zamanÄ± kÃ¼tÃ¼phanesi ile etkileÅŸime giren yerel bir stub prosedÃ¼rÃ¼nÃ¼ Ã§aÄŸÄ±rmayÄ± iÃ§erir ve ardÄ±ndan isteÄŸi sunucuya hazÄ±rlayÄ±p iletir. Bu, parametrelerin standart AÄŸ Veri Temsili formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lmesini iÃ§erir. TaÅŸÄ±ma protokolÃ¼ seÃ§imi, sunucu uzaktaysa Ã§alÄ±ÅŸma zamanÄ± kÃ¼tÃ¼phanesi tarafÄ±ndan belirlenir ve RPC'nin aÄŸ yÄ±ÄŸÄ±nÄ± Ã¼zerinden iletilmesini saÄŸlar.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **AÃ§Ä±k RPC Hizmetlerini Belirleme**

TCP, UDP, HTTP ve SMB Ã¼zerinden RPC hizmetlerinin aÃ§Ä±ÄŸÄ±, RPC yer bulucu hizmeti ve bireysel uÃ§ noktalar sorgulanarak belirlenebilir. rpcdump gibi araÃ§lar, **IFID** deÄŸerleri ile belirtilen benzersiz RPC hizmetlerinin tanÄ±mlanmasÄ±na yardÄ±mcÄ± olur ve hizmet detaylarÄ± ile iletiÅŸim baÄŸlarÄ±nÄ± ortaya Ã§Ä±karÄ±r:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
RPC yer bulucu hizmetine eriÅŸim, belirli protokoller aracÄ±lÄ±ÄŸÄ±yla etkinleÅŸtirilmiÅŸtir: port 135 Ã¼zerinden eriÅŸim iÃ§in ncacn\_ip\_tcp ve ncadg\_ip\_udp, SMB baÄŸlantÄ±larÄ± iÃ§in ncacn\_np ve web tabanlÄ± RPC iletiÅŸimi iÃ§in ncacn\_http. AÅŸaÄŸÄ±daki komutlar, esasen port 135'e odaklanarak, MSRPC hizmetlerini denetlemek ve etkileÅŸimde bulunmak iÃ§in Metasploit modÃ¼llerinin kullanÄ±mÄ±nÄ± Ã¶rneklemektedir:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
TÃ¼m seÃ§enekler `tcp_dcerpc_auditor` hariÃ§, 135 numaralÄ± portta MSRPC'yi hedef almak iÃ§in Ã¶zel olarak tasarlanmÄ±ÅŸtÄ±r.

#### Dikkate DeÄŸer RPC arayÃ¼zleri

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\lsarpc`
* **AÃ§Ä±klama**: KullanÄ±cÄ±larÄ± listelemek iÃ§in kullanÄ±lan LSA arayÃ¼zÃ¼.
* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\lsarpc`
* **AÃ§Ä±klama**: AlanlarÄ± ve gÃ¼ven iliÅŸkilerini listelemek iÃ§in kullanÄ±lan LSA Dizin Hizmetleri (DS) arayÃ¼zÃ¼.
* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\samr`
* **AÃ§Ä±klama**: Kamu SAM veritabanÄ± Ã¶ÄŸelerine (Ã¶rneÄŸin, kullanÄ±cÄ± adlarÄ±) eriÅŸmek ve kullanÄ±cÄ± ÅŸifrelerini hesap kilitleme politikasÄ± gÃ¶zetmeksizin zorlamak iÃ§in kullanÄ±lan LSA SAMR arayÃ¼zÃ¼.
* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\atsvc`
* **AÃ§Ä±klama**: Uzakta komutlarÄ± yÃ¼rÃ¼tmek iÃ§in kullanÄ±lan gÃ¶rev zamanlayÄ±cÄ±.
* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\winreg`
* **AÃ§Ä±klama**: Sistemin kayÄ±t defterine eriÅŸmek ve deÄŸiÅŸtirmek iÃ§in kullanÄ±lan uzak kayÄ±t defteri hizmeti.
* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\svcctl`
* **AÃ§Ä±klama**: Uzakta hizmetleri baÅŸlatmak ve durdurmak ve komutlarÄ± yÃ¼rÃ¼tmek iÃ§in kullanÄ±lan hizmet kontrol yÃ¶neticisi ve sunucu hizmetleri.
* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\srvsvc`
* **AÃ§Ä±klama**: Uzakta hizmetleri baÅŸlatmak ve durdurmak ve komutlarÄ± yÃ¼rÃ¼tmek iÃ§in kullanÄ±lan hizmet kontrol yÃ¶neticisi ve sunucu hizmetleri.
* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\epmapper`
* **AÃ§Ä±klama**: WM aracÄ±lÄ±ÄŸÄ±yla ÅŸifre zorlamasÄ± ve bilgi toplama iÃ§in kullanÄ±lan DCOM arayÃ¼zÃ¼.

### IP adreslerini belirleme

[https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver) kullanarak, [Airbus araÅŸtÄ±rmasÄ±](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/) ile _**IOXIDResolver**_ arayÃ¼zÃ¼ iÃ§indeki _**ServerAlive2**_ yÃ¶ntemini kÃ¶tÃ¼ye kullanmak mÃ¼mkÃ¼ndÃ¼r.

Bu yÃ¶ntem, HTB kutusundan _APT_ olarak **IPv6** adresi gibi arayÃ¼z bilgilerini almak iÃ§in kullanÄ±lmÄ±ÅŸtÄ±r. 0xdf APT yazÄ±sÄ± iÃ§in [buraya](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) bakÄ±n, rpcmap.py kullanarak alternatif bir yÃ¶ntem iÃ§ermektedir [Impacket](https://github.com/SecureAuthCorp/impacket/) ile _stringbinding_ (yukarÄ±ya bakÄ±n).

### GeÃ§erli kimlik bilgileri ile RCE yÃ¼rÃ¼tme

GeÃ§erli bir kullanÄ±cÄ±nÄ±n kimlik bilgileri mevcutsa, [dcomexec.py](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py) kullanarak bir makinede uzaktan kod yÃ¼rÃ¼tmek mÃ¼mkÃ¼ndÃ¼r.

**Mevcut farklÄ± nesnelerle denemeyi unutmayÄ±n**

* ShellWindows
* ShellBrowserWindow
* MMC20

## Port 593

[rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) iÃ§indeki **rpcdump.exe** bu port ile etkileÅŸimde bulunabilir.

## Referanslar

* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve bug bounty avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ± ve zorluklarÄ±na dalan iÃ§eriklerle etkileÅŸimde bulunun

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zla deÄŸiÅŸen hacking dÃ¼nyasÄ±nda gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle gÃ¼ncel kalÄ±n

**Son Duyurular**\
Yeni baÅŸlayan bug bounty'ler ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi sahibi olun

BugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmak iÃ§in [**Discord**](https://discord.com/invite/N3FrSbmwdy) sunucumuza katÄ±lÄ±n!

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
