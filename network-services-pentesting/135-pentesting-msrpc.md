# 135, 593 - Testowanie penetracyjne MSRPC

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

DoÅ‚Ä…cz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowaÄ‡ siÄ™ z doÅ›wiadczonymi hakerami i Å‚owcami nagrÃ³d za bÅ‚Ä™dy!

**SpostrzeÅ¼enia dotyczÄ…ce hakerstwa**\
Zajmuj siÄ™ treÅ›ciami, ktÃ³re zagÅ‚Ä™biajÄ… siÄ™ w emocje i wyzwania hakerstwa

**AktualnoÅ›ci na Å¼ywo o hakerstwie**\
BÄ…dÅº na bieÅ¼Ä…co z szybkim tempem Å›wiata hakerstwa dziÄ™ki aktualnym wiadomoÅ›ciom i spostrzeÅ¼eniom

**Najnowsze ogÅ‚oszenia**\
BÄ…dÅº na bieÅ¼Ä…co z najnowszymi programami bug bounty i waÅ¼nymi aktualizacjami platformy

**DoÅ‚Ä…cz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wspÃ³Å‚pracowaÄ‡ z najlepszymi hakerami juÅ¼ dziÅ›!

## Podstawowe informacje

ProtokÃ³Å‚ Microsoft Remote Procedure Call (MSRPC), model klient-serwer umoÅ¼liwiajÄ…cy programowi Å¼Ä…danie usÅ‚ugi od programu znajdujÄ…cego siÄ™ na innym komputerze bez koniecznoÅ›ci zrozumienia szczegÃ³Å‚Ã³w sieci, poczÄ…tkowo zostaÅ‚ opracowany na podstawie oprogramowania open-source, a nastÄ™pnie rozwiniÄ™ty i opatentowany przez firmÄ™ Microsoft.

Maper punktÃ³w koÅ„cowych RPC moÅ¼na uzyskaÄ‡ za poÅ›rednictwem portu TCP i UDP 135, SMB na porcie TCP 139 i 445 (z pustÄ… lub uwierzytelnionÄ… sesjÄ…) oraz jako usÅ‚ugÄ™ sieciowÄ… na porcie TCP 593.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## Jak dziaÅ‚a MSRPC?

Proces MSRPC rozpoczyna siÄ™ od aplikacji klienta, ktÃ³ra wywoÅ‚uje lokalnÄ… procedurÄ™ pomocniczÄ…, ktÃ³ra nastÄ™pnie wspÃ³Å‚dziaÅ‚a z bibliotekÄ… czasu wykonania klienta w celu przygotowania i przesÅ‚ania Å¼Ä…dania do serwera. Proces ten obejmuje konwersjÄ™ parametrÃ³w na standardowy format reprezentacji danych sieciowych. WybÃ³r protokoÅ‚u transportowego jest determinowany przez bibliotekÄ™ czasu wykonania, jeÅ›li serwer jest zdalny, zapewniajÄ…c dostarczenie RPC przez stos sieciowy.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Identyfikowanie wystawionych usÅ‚ug RPC**

Wystawienie usÅ‚ug RPC poprzez TCP, UDP, HTTP i SMB moÅ¼na okreÅ›liÄ‡, kwerujÄ…c usÅ‚ugÄ™ lokalizatora RPC oraz poszczegÃ³lne punkty koÅ„cowe. NarzÄ™dzia takie jak rpcdump uÅ‚atwiajÄ… identyfikacjÄ™ unikalnych usÅ‚ug RPC, oznaczonych wartoÅ›ciami **IFID**, ujawniajÄ…c szczegÃ³Å‚y usÅ‚ugi i powiÄ…zania komunikacyjne:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
DostÄ™p do usÅ‚ugi lokalizatora RPC jest wÅ‚Ä…czony za pomocÄ… okreÅ›lonych protokoÅ‚Ã³w: ncacn\_ip\_tcp i ncadg\_ip\_udp do dostÄ™pu przez port 135, ncacn\_np do poÅ‚Ä…czeÅ„ SMB oraz ncacn\_http do komunikacji opartej na protokole RPC przez sieÄ‡ web. PoniÅ¼sze polecenia przedstawiajÄ… przykÅ‚ady wykorzystania moduÅ‚Ã³w Metasploit do audytu i interakcji z usÅ‚ugami MSRPC, skupiajÄ…c siÄ™ gÅ‚Ã³wnie na porcie 135:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
Wszystkie opcje oprÃ³cz `tcp_dcerpc_auditor` sÄ… specjalnie zaprojektowane do atakowania MSRPC na porcie 135.

#### ZnaczÄ…ce interfejsy RPC

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Named Pipe**: `\pipe\lsarpc`
* **Opis**: Interfejs LSA, uÅ¼ywany do wyliczania uÅ¼ytkownikÃ³w.


* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Named Pipe**: `\pipe\lsarpc`
* **Opis**: Interfejs LSA Directory Services (DS), uÅ¼ywany do wyliczania domen i relacji zaufania.


* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Named Pipe**: `\pipe\samr`
* **Opis**: Interfejs LSA SAMR, uÅ¼ywany do dostÄ™pu do publicznych elementÃ³w bazy danych SAM (np. nazwy uÅ¼ytkownikÃ³w) i Å‚amania haseÅ‚ uÅ¼ytkownikÃ³w niezaleÅ¼nie od polityki blokady konta.


* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Named Pipe**: `\pipe\atsvc`
* **Opis**: Harmonogram zadaÅ„, uÅ¼ywany do zdalnego wykonywania poleceÅ„.


* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Named Pipe**: `\pipe\winreg`
* **Opis**: UsÅ‚uga zdalnego rejestru, uÅ¼ywana do dostÄ™pu i modyfikacji rejestru systemowego.


* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Named Pipe**: `\pipe\svcctl`
* **Opis**: MenedÅ¼er kontroli usÅ‚ug i usÅ‚ugi serwera, uÅ¼ywane do zdalnego uruchamiania i zatrzymywania usÅ‚ug oraz wykonywania poleceÅ„.


* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Named Pipe**: `\pipe\srvsvc`
* **Opis**: MenedÅ¼er kontroli usÅ‚ug i usÅ‚ugi serwera, uÅ¼ywane do zdalnego uruchamiania i zatrzymywania usÅ‚ug oraz wykonywania poleceÅ„.


* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Named Pipe**: `\pipe\epmapper`
* **Opis**: Interfejs DCOM, uÅ¼ywany do Å‚amania haseÅ‚ metodÄ… brute-force i zbierania informacji za pomocÄ… WM.

### Identyfikacja adresÃ³w IP

KorzystajÄ…c z [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver), pochodzÄ…cego z [badaÅ„ Airbusa](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/), moÅ¼liwe jest wykorzystanie metody _**ServerAlive2**_ w interfejsie _**IOXIDResolver**_.

Ta metoda zostaÅ‚a uÅ¼yta do uzyskania informacji o interfejsie jako adres **IPv6** z maszyny HTB _APT_. Zobacz [tutaj](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) dla opisu APT 0xdf, zawiera on alternatywnÄ… metodÄ™ korzystajÄ…cÄ… z rpcmap.py z [Impacket](https://github.com/SecureAuthCorp/impacket/) z _stringbinding_ (patrz powyÅ¼ej).

## Port 593

Program **rpcdump.exe** z [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) moÅ¼e komunikowaÄ‡ siÄ™ z tym portem.

#â€‹# Referencje
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

DoÅ‚Ä…cz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowaÄ‡ siÄ™ z doÅ›wiadczonymi hakerami i Å‚owcami bÅ‚Ä™dÃ³w!

**Wnioski z Hackingu**\
Zajmuj siÄ™ treÅ›ciami, ktÃ³re zagÅ‚Ä™biajÄ… siÄ™ w emocje i wyzwania zwiÄ…zane z hakerstwem.

**Aktualne wiadomoÅ›ci o hakerstwie na Å¼ywo**\
BÄ…dÅº na bieÅ¼Ä…co z szybkim tempem Å›wiata hakerstwa dziÄ™ki aktualnym wiadomoÅ›ciom i wnioskom.

**Najnowsze ogÅ‚oszenia**\
BÄ…dÅº na bieÅ¼Ä…co z najnowszymi programami bug bounty i waÅ¼nymi aktualizacjami platformy.

**DoÅ‚Ä…cz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wspÃ³Å‚pracowaÄ‡ z najlepszymi hakerami juÅ¼ dziÅ›!

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi trikami hakerskimi, przesyÅ‚ajÄ…c PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
