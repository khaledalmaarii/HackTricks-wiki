# 135, 593 - MSRPC Pentesting

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Bize katÄ±lÄ±n** ğŸ’¬ [**Discord grubunda**](https://discord.gg/hRep4RUj7f) veya [**telegram grubunda**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek katkÄ±da bulunun.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hackleme Ä°puÃ§larÄ±**\
Hackleme heyecanÄ±nÄ± ve zorluklarÄ±nÄ± inceleyen iÃ§eriklerle etkileÅŸime geÃ§in

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hack dÃ¼nyasÄ±nda gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle gÃ¼ncel kalÄ±n

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avÄ± baÅŸlatmalarÄ± ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgilenin

**Bize katÄ±lÄ±n** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸine baÅŸlayÄ±n!

## Temel Bilgiler

Microsoft Uzak Yordam Ã‡aÄŸrÄ±sÄ± (MSRPC) protokolÃ¼, bir programÄ±n aÄŸÄ±n ayrÄ±ntÄ±larÄ±nÄ± anlamadan baÅŸka bir bilgisayardaki bir programdan hizmet istemesine olanak tanÄ±yan istemci-sunucu modelidir. BaÅŸlangÄ±Ã§ta aÃ§Ä±k kaynak yazÄ±lÄ±mlardan tÃ¼retilen ve daha sonra Microsoft tarafÄ±ndan geliÅŸtirilen ve telif hakkÄ± alÄ±nan bir protokoldÃ¼r.

RPC uÃ§ nokta eÅŸleyicisine TCP ve UDP port 135 Ã¼zerinden, SMB Ã¼zerinden TCP 139 ve 445'te (boÅŸ veya kimlik doÄŸrulamalÄ± oturumla) ve bir web hizmeti olarak TCP port 593 Ã¼zerinden eriÅŸilebilir.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## MSRPC nasÄ±l Ã§alÄ±ÅŸÄ±r?

Ä°stemci uygulamasÄ± tarafÄ±ndan baÅŸlatÄ±lan MSRPC sÃ¼reci, yerel bir kÄ±sayol prosedÃ¼rÃ¼nÃ¼ Ã§aÄŸÄ±rarak isteÄŸi sunucuya iletmek iÃ§in istemci Ã§alÄ±ÅŸma zamanÄ± kitaplÄ±ÄŸÄ±yla etkileÅŸime giren bir sÃ¼reci iÃ§erir. Bu, parametreleri standart Bir AÄŸ Veri Temsili formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼rmeyi iÃ§erir. Sunucu uzakta ise, taÅŸÄ±ma protokolÃ¼nÃ¼n seÃ§imi Ã§alÄ±ÅŸma zamanÄ± kitaplÄ±ÄŸÄ± tarafÄ±ndan belirlenir ve RPC'nin aÄŸ yÄ±ÄŸÄ±nÄ± Ã¼zerinden iletilmesini saÄŸlar.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **AÃ§Ä±ÄŸa Ã‡Ä±karÄ±lmÄ±ÅŸ RPC Hizmetlerini TanÄ±mlama**

RPC hizmetlerinin TCP, UDP, HTTP ve SMB Ã¼zerinde aÃ§Ä±ÄŸa Ã§Ä±karÄ±lmasÄ±, RPC yer bulma servisine ve bireysel uÃ§ noktalara sorgu gÃ¶nderilerek belirlenebilir. rpcdump gibi araÃ§lar, benzersiz RPC hizmetlerini tanÄ±mlamaya yardÄ±mcÄ± olur, **IFID** deÄŸerleri ile belirtilen hizmet ayrÄ±ntÄ±larÄ±nÄ± ve iletiÅŸim baÄŸlantÄ±larÄ±nÄ± ortaya Ã§Ä±karÄ±r.
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
RPC yer bulucu servisine eriÅŸim belirli protokoller aracÄ±lÄ±ÄŸÄ±yla etkinleÅŸtirilir: port 135 Ã¼zerinden eriÅŸim iÃ§in ncacn\_ip\_tcp ve ncadg\_ip\_udp, SMB baÄŸlantÄ±larÄ± iÃ§in ncacn\_np ve web tabanlÄ± RPC iletiÅŸimi iÃ§in ncacn\_http. AÅŸaÄŸÄ±daki komutlar, Metasploit modÃ¼llerinin MSRPC hizmetlerini denetlemek ve etkileÅŸimde bulunmak iÃ§in nasÄ±l kullanÄ±labileceÄŸini Ã¶rneklemektedir:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
TÃ¼m seÃ§enekler, `tcp_dcerpc_auditor` hariÃ§ MSRPC'yi hedeflemek Ã¼zere Ã¶zel olarak tasarlanmÄ±ÅŸtÄ±r.

#### Dikkate DeÄŸer RPC ArayÃ¼zleri

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\lsarpc`
* **AÃ§Ä±klama**: KullanÄ±cÄ±larÄ± sÄ±ralamak iÃ§in kullanÄ±lan LSA arayÃ¼zÃ¼.


* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\lsarpc`
* **AÃ§Ä±klama**: AlanlarÄ± ve gÃ¼ven iliÅŸkilerini sÄ±ralamak iÃ§in kullanÄ±lan LSA Dizin Hizmetleri (DS) arayÃ¼zÃ¼.


* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\samr`
* **AÃ§Ä±klama**: Hesap kilit politikasÄ±ndan baÄŸÄ±msÄ±z olarak genel SAM veritabanÄ± Ã¶ÄŸelerine (Ã¶rneÄŸin, kullanÄ±cÄ± adlarÄ±) eriÅŸmek ve kullanÄ±cÄ± ÅŸifrelerini kaba kuvvet yÃ¶ntemiyle bulmak iÃ§in kullanÄ±lan LSA SAMR arayÃ¼zÃ¼.


* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\atsvc`
* **AÃ§Ä±klama**: KomutlarÄ± uzaktan yÃ¼rÃ¼tmek iÃ§in kullanÄ±lan GÃ¶rev ZamanlayÄ±cÄ±sÄ±.


* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\winreg`
* **AÃ§Ä±klama**: Sistem kayÄ±t defterine eriÅŸmek ve deÄŸiÅŸtirmek iÃ§in kullanÄ±lan Uzak kayÄ±t defteri hizmeti.


* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\svcctl`
* **AÃ§Ä±klama**: Hizmet kontrol yÃ¶neticisi ve sunucu hizmetleri, hizmetleri uzaktan baÅŸlatmak ve durdurmak ve komutlarÄ± yÃ¼rÃ¼tmek iÃ§in kullanÄ±lÄ±r.


* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\srvsvc`
* **AÃ§Ä±klama**: Hizmet kontrol yÃ¶neticisi ve sunucu hizmetleri, hizmetleri uzaktan baÅŸlatmak ve durdurmak ve komutlarÄ± yÃ¼rÃ¼tmek iÃ§in kullanÄ±lÄ±r.


* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **AdlandÄ±rÄ±lmÄ±ÅŸ Boru**: `\pipe\epmapper`
* **AÃ§Ä±klama**: DCOM arayÃ¼zÃ¼, WM aracÄ±lÄ±ÄŸÄ±yla kaba kuvvet ÅŸifre Ã¶ÄŸÃ¼tme ve bilgi toplama iÃ§in kullanÄ±lÄ±r.

### IP adreslerini tanÄ±mlama

[https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver) kullanarak, [Airbus araÅŸtÄ±rmasÄ±](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/) tarafÄ±ndan gelen _**ServerAlive2**_ yÃ¶ntemini _**IOXIDResolver**_ arayÃ¼zÃ¼ iÃ§inde kÃ¶tÃ¼ye kullanmak mÃ¼mkÃ¼ndÃ¼r.

Bu yÃ¶ntem, HTB kutusu _APT_'den **IPv6** adresi olarak arayÃ¼z bilgilerini almak iÃ§in kullanÄ±lmÄ±ÅŸtÄ±r. 0xdf APT yazÄ±sÄ±na [buradan](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) ulaÅŸabilirsiniz, Impacket'ten [rpcmap.py](https://github.com/SecureAuthCorp/impacket/) kullanarak _stringbinding_ ile alternatif bir yÃ¶ntem iÃ§ermektedir (yukarÄ±ya bakÄ±nÄ±z).

### GeÃ§erli kimlik bilgileriyle RCE yÃ¼rÃ¼tme

GeÃ§erli bir kullanÄ±cÄ±nÄ±n kimlik bilgileri mevcutsa, [impacket Ã§erÃ§evesinden dcomexec.py](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py) kullanÄ±larak bir makinede uzaktan kod yÃ¼rÃ¼tmek mÃ¼mkÃ¼ndÃ¼r.

**FarklÄ± mevcut nesnelerle denemeyi unutmayÄ±n**
* ShellWindows
* ShellBrowserWindow
* MMC20


## Port 593

**rpctools**'dan [rpcdump.exe](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) bu porta etkileÅŸimde bulunabilir.

## Referanslar
* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve hata avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Insights**\
Hacking'in heyecanÄ±nÄ± ve zorluklarÄ±nÄ± inceleyen iÃ§eriklerle etkileÅŸime geÃ§in

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nÄ± gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle takip edin

**En Son Duyurular**\
Yeni hata avcÄ±lÄ±klarÄ±nÄ± ve Ã¶nemli platform gÃ¼ncellemelerini takip edin

**Bize** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **katÄ±lÄ±n ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸine baÅŸlayÄ±n!**
