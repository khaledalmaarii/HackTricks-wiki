# 135, 593 - Pentesting MSRPC

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

## ê¸°ë³¸ ì •ë³´

Microsoft ì›ê²© í”„ë¡œì‹œì € í˜¸ì¶œ(MSRPC) í”„ë¡œí† ì½œì€ í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ëª¨ë¸ë¡œ, í”„ë¡œê·¸ë¨ì´ ë„¤íŠ¸ì›Œí¬ì˜ ì„¸ë¶€ ì‚¬í•­ì„ ì´í•´í•˜ì§€ ì•Šê³ ë„ ë‹¤ë¥¸ ì»´í“¨í„°ì— ìœ„ì¹˜í•œ í”„ë¡œê·¸ë¨ìœ¼ë¡œë¶€í„° ì„œë¹„ìŠ¤ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì´ í”„ë¡œí† ì½œì€ ì²˜ìŒì— ì˜¤í”ˆ ì†ŒìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ íŒŒìƒë˜ì—ˆìœ¼ë©°, ì´í›„ Microsoftì— ì˜í•´ ê°œë°œë˜ê³  ì €ì‘ê¶Œì´ ë¶€ì—¬ë˜ì—ˆìŠµë‹ˆë‹¤.

RPC ì—”ë“œí¬ì¸íŠ¸ ë§¤í¼ëŠ” TCP ë° UDP í¬íŠ¸ 135, SMBëŠ” TCP 139 ë° 445(ë„ ë˜ëŠ” ì¸ì¦ëœ ì„¸ì…˜)ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ì›¹ ì„œë¹„ìŠ¤ë¡œëŠ” TCP í¬íŠ¸ 593ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## MSRPCëŠ” ì–´ë–»ê²Œ ì‘ë™í•˜ë‚˜ìš”?

í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì˜í•´ ì‹œì‘ëœ MSRPC í”„ë¡œì„¸ìŠ¤ëŠ” ë¡œì»¬ ìŠ¤í… í”„ë¡œì‹œì €ë¥¼ í˜¸ì¶œí•œ ë‹¤ìŒ í´ë¼ì´ì–¸íŠ¸ ëŸ°íƒ€ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ìƒí˜¸ì‘ìš©í•˜ì—¬ ìš”ì²­ì„ ì„œë²„ë¡œ ì¤€ë¹„í•˜ê³  ì „ì†¡í•˜ëŠ” ê³¼ì •ì„ í¬í•¨í•©ë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ í‘œì¤€ ë„¤íŠ¸ì›Œí¬ ë°ì´í„° í‘œí˜„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì´ í¬í•¨ë©ë‹ˆë‹¤. ì„œë²„ê°€ ì›ê²©ì¸ ê²½ìš° ëŸ°íƒ€ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜í•´ ì „ì†¡ í”„ë¡œí† ì½œì´ ê²°ì •ë˜ì–´ RPCê°€ ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒì„ í†µí•´ ì „ë‹¬ë˜ë„ë¡ í•©ë‹ˆë‹¤.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **ë…¸ì¶œëœ RPC ì„œë¹„ìŠ¤ ì‹ë³„í•˜ê¸°**

TCP, UDP, HTTP ë° SMBë¥¼ í†µí•œ RPC ì„œë¹„ìŠ¤ì˜ ë…¸ì¶œì€ RPC ë¡œì¼€ì´í„° ì„œë¹„ìŠ¤ ë° ê°œë³„ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¿¼ë¦¬í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. rpcdumpì™€ ê°™ì€ ë„êµ¬ëŠ” **IFID** ê°’ìœ¼ë¡œ í‘œì‹œëœ ê³ ìœ í•œ RPC ì„œë¹„ìŠ¤ì˜ ì‹ë³„ì„ ìš©ì´í•˜ê²Œ í•˜ì—¬ ì„œë¹„ìŠ¤ ì„¸ë¶€ì •ë³´ ë° í†µì‹  ë°”ì¸ë”©ì„ ë“œëŸ¬ëƒ…ë‹ˆë‹¤:
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
RPC ë¡œì¼€ì´í„° ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ì€ íŠ¹ì • í”„ë¡œí† ì½œì„ í†µí•´ í™œì„±í™”ë©ë‹ˆë‹¤: ncacn\_ip\_tcp ë° ncadg\_ip\_udpëŠ” í¬íŠ¸ 135ë¥¼ í†µí•´ ì ‘ê·¼í•˜ê¸° ìœ„í•œ ê²ƒì´ê³ , ncacn\_npëŠ” SMB ì—°ê²°ì„ ìœ„í•œ ê²ƒì´ë©°, ncacn\_httpëŠ” ì›¹ ê¸°ë°˜ RPC í†µì‹ ì„ ìœ„í•œ ê²ƒì…ë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì–´ëŠ” ì£¼ë¡œ í¬íŠ¸ 135ì— ì´ˆì ì„ ë§ì¶° MSRPC ì„œë¹„ìŠ¤ë¥¼ ê°ì‚¬í•˜ê³  ìƒí˜¸ì‘ìš©í•˜ê¸° ìœ„í•´ Metasploit ëª¨ë“ˆì„ í™œìš©í•˜ëŠ” ì˜ˆë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤:
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
ëª¨ë“  ì˜µì…˜ì€ `tcp_dcerpc_auditor`ë¥¼ ì œì™¸í•˜ê³  í¬íŠ¸ 135ì—ì„œ MSRPCë¥¼ íƒ€ê²ŸíŒ…í•˜ê¸° ìœ„í•´ íŠ¹ë³„íˆ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

#### ì£¼ëª©í•  ë§Œí•œ RPC ì¸í„°í˜ì´ìŠ¤

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Named Pipe**: `\pipe\lsarpc`
* **ì„¤ëª…**: LSA ì¸í„°í˜ì´ìŠ¤, ì‚¬ìš©ì ì—´ê±°ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Named Pipe**: `\pipe\lsarpc`
* **ì„¤ëª…**: LSA ë””ë ‰í„°ë¦¬ ì„œë¹„ìŠ¤(DS) ì¸í„°í˜ì´ìŠ¤, ë„ë©”ì¸ ë° ì‹ ë¢° ê´€ê³„ ì—´ê±°ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Named Pipe**: `\pipe\samr`
* **ì„¤ëª…**: LSA SAMR ì¸í„°í˜ì´ìŠ¤, ê³µê°œ SAM ë°ì´í„°ë² ì´ìŠ¤ ìš”ì†Œ(ì˜ˆ: ì‚¬ìš©ì ì´ë¦„)ì— ì ‘ê·¼í•˜ê³  ê³„ì • ì ê¸ˆ ì •ì±…ì— ê´€ê³„ì—†ì´ ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¬´ì°¨ë³„ ëŒ€ì…í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Named Pipe**: `\pipe\atsvc`
* **ì„¤ëª…**: ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬, ì›ê²©ìœ¼ë¡œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Named Pipe**: `\pipe\winreg`
* **ì„¤ëª…**: ì›ê²© ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì„œë¹„ìŠ¤, ì‹œìŠ¤í…œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì ‘ê·¼í•˜ê³  ìˆ˜ì •í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Named Pipe**: `\pipe\svcctl`
* **ì„¤ëª…**: ì„œë¹„ìŠ¤ ì œì–´ ê´€ë¦¬ì ë° ì„œë²„ ì„œë¹„ìŠ¤, ì›ê²©ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘ ë° ì¤‘ì§€í•˜ê³  ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Named Pipe**: `\pipe\srvsvc`
* **ì„¤ëª…**: ì„œë¹„ìŠ¤ ì œì–´ ê´€ë¦¬ì ë° ì„œë²„ ì„œë¹„ìŠ¤, ì›ê²©ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘ ë° ì¤‘ì§€í•˜ê³  ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Named Pipe**: `\pipe\epmapper`
* **ì„¤ëª…**: DCOM ì¸í„°í˜ì´ìŠ¤, ë¹„ë°€ë²ˆí˜¸ ë¬´ì°¨ë³„ ëŒ€ì… ë° WMì„ í†µí•œ ì •ë³´ ìˆ˜ì§‘ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

### IP ì£¼ì†Œ ì‹ë³„

[https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver)ë¥¼ ì‚¬ìš©í•˜ë©´ [Airbus ì—°êµ¬](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)ì—ì„œ _**IOXIDResolver**_ ì¸í„°í˜ì´ìŠ¤ ë‚´ì˜ _**ServerAlive2**_ ë©”ì„œë“œë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ë©”ì„œë“œëŠ” HTB ë°•ìŠ¤ _APT_ì—ì„œ **IPv6** ì£¼ì†Œë¡œ ì¸í„°í˜ì´ìŠ¤ ì •ë³´ë¥¼ ì–»ëŠ” ë° ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. 0xdf APT ì‘ì„±ë¬¼ì€ [ì—¬ê¸°](https://0xdf.gitlab.io/2021/04/10/htb-apt.html)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, _stringbinding_ì„ ì‚¬ìš©í•˜ëŠ” [Impacket](https://github.com/SecureAuthCorp/impacket/)ì˜ rpcmap.pyë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì²´ ë°©ë²•ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### ìœ íš¨í•œ ìê²© ì¦ëª…ìœ¼ë¡œ RCE ì‹¤í–‰

ìœ íš¨í•œ ì‚¬ìš©ìì˜ ìê²© ì¦ëª…ì´ ìˆëŠ” ê²½ìš° [dcomexec.py](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py)ì—ì„œ ì›ê²© ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì‚¬ìš© ê°€ëŠ¥í•œ ë‹¤ì–‘í•œ ê°ì²´ë¡œ ì‹œë„í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”**

* ShellWindows
* ShellBrowserWindow
* MMC20

## í¬íŠ¸ 593

[rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools)ì˜ **rpcdump.exe**ëŠ” ì´ í¬íŠ¸ì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì°¸ê³  ë¬¸í—Œ

* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ì´ í’ë¶€í•œ í•´ì»¤ ë° ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ì™€ ì†Œí†µí•˜ê¸° ìœ„í•´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ì°¸ì—¬í•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°ë ¥**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì— ëŒ€í•œ ë‚´ìš©ì„ íƒêµ¬í•˜ì„¸ìš”.

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ ë”°ë¼ê°€ì„¸ìš”.

**ìµœì‹  ê³µì§€ì‚¬í•­**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ìœ ì§€í•˜ì„¸ìš”.

ì˜¤ëŠ˜ [**Discord**](https://discord.com/invite/N3FrSbmwdy)ì— ê°€ì…í•˜ê³  ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter**ì—ì„œ **@hacktricks\_live**ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}
