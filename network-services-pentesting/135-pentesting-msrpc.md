# 135, 593 - Pentesting MSRPC

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

## åŸºæœ¬æƒ…å ±

Microsoft Remote Procedure Call (MSRPC) ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µãƒ¼ãƒãƒ¼ãƒ¢ãƒ‡ãƒ«ã§ã‚ã‚Šã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒåˆ¥ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«ã‚ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦æ±‚ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è©³ç´°ã‚’ç†è§£ã™ã‚‹ã“ã¨ãªãæ©Ÿèƒ½ã—ã¾ã™ã€‚æœ€åˆã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‹ã‚‰æ´¾ç”Ÿã—ã€ãã®å¾ŒMicrosoftã«ã‚ˆã£ã¦é–‹ç™ºã•ã‚Œã€è‘—ä½œæ¨©ãŒä»˜ä¸ã•ã‚Œã¾ã—ãŸã€‚

RPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒãƒƒãƒ‘ãƒ¼ã¯ã€TCPãŠã‚ˆã³UDPãƒãƒ¼ãƒˆ135ã€TCP 139ãŠã‚ˆã³445ã®SMBï¼ˆãƒŒãƒ«ã¾ãŸã¯èªè¨¼ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ï¼‰ã€ãŠã‚ˆã³TCPãƒãƒ¼ãƒˆ593ã®Webã‚µãƒ¼ãƒ“ã‚¹ã‚’ä»‹ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
```
135/tcp   open     msrpc         Microsoft Windows RPC
```
## MSRPCã¯ã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã—ã¾ã™ã‹ï¼Ÿ

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦é–‹å§‹ã•ã‚Œã‚‹MSRPCãƒ—ãƒ­ã‚»ã‚¹ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ã‚¿ãƒ–ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã‚’å‘¼ã³å‡ºã—ã€ãã®å¾Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ç›¸äº’ä½œç”¨ã—ã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚µãƒ¼ãƒãƒ¼ã«æº–å‚™ã—ã¦é€ä¿¡ã—ã¾ã™ã€‚ã“ã‚Œã«ã¯ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¨™æº–ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿è¡¨ç¾å½¢å¼ã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒå«ã¾ã‚Œã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ãŒãƒªãƒ¢ãƒ¼ãƒˆã®å ´åˆã€ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®é¸æŠã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦æ±ºå®šã•ã‚Œã€RPCãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ã‚¿ãƒƒã‚¯ã‚’é€šã˜ã¦é…ä¿¡ã•ã‚Œã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **å…¬é–‹ã•ã‚Œã¦ã„ã‚‹RPCã‚µãƒ¼ãƒ“ã‚¹ã®ç‰¹å®š**

TCPã€UDPã€HTTPã€ãŠã‚ˆã³SMBã‚’ä»‹ã—ãŸRPCã‚µãƒ¼ãƒ“ã‚¹ã®å…¬é–‹ã¯ã€RPCãƒ­ã‚±ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ãŠã‚ˆã³å€‹ã€…ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ã‚¯ã‚¨ãƒªã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦åˆ¤æ–­ã§ãã¾ã™ã€‚rpcdumpãªã©ã®ãƒ„ãƒ¼ãƒ«ã¯ã€**IFID**å€¤ã«ã‚ˆã£ã¦ç¤ºã•ã‚Œã‚‹ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªRPCã‚µãƒ¼ãƒ“ã‚¹ã®ç‰¹å®šã‚’å®¹æ˜“ã«ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ã®è©³ç´°ã¨é€šä¿¡ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ˜ã‚‰ã‹ã«ã—ã¾ã™ï¼š
```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```
RPCãƒ­ã‚±ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã€ç‰¹å®šã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’é€šã˜ã¦æœ‰åŠ¹ã«ãªã‚Šã¾ã™ï¼šãƒãƒ¼ãƒˆ135ã‚’ä»‹ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ncacn\_ip\_tcpãŠã‚ˆã³ncadg\_ip\_udpã€SMBæ¥ç¶šã®ãŸã‚ã®ncacn\_npã€ã‚¦ã‚§ãƒ–ãƒ™ãƒ¼ã‚¹ã®RPCé€šä¿¡ã®ãŸã‚ã®ncacn\_httpã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ä¸»ã«ãƒãƒ¼ãƒˆ135ã«ç„¦ç‚¹ã‚’å½“ã¦ã¦ã€MSRPCã‚µãƒ¼ãƒ“ã‚¹ã‚’ç›£æŸ»ãŠã‚ˆã³å¯¾è©±ã™ã‚‹ãŸã‚ã®Metasploitãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®åˆ©ç”¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼š
```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```
All options except `tcp_dcerpc_auditor` are specifically designed for targeting MSRPC on port 135.

#### Notable RPC interfaces

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Named Pipe**: `\pipe\lsarpc`
* **Description**: LSAã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åˆ—æŒ™ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Named Pipe**: `\pipe\lsarpc`
* **Description**: LSAãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚µãƒ¼ãƒ“ã‚¹ï¼ˆDSï¼‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ä¿¡é ¼é–¢ä¿‚ã‚’åˆ—æŒ™ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Named Pipe**: `\pipe\samr`
* **Description**: LSA SAMRã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€å…¬é–‹SAMãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¦ç´ ï¼ˆä¾‹ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒãƒªã‚·ãƒ¼ã«é–¢ä¿‚ãªããƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Named Pipe**: `\pipe\atsvc`
* **Description**: ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã€ãƒªãƒ¢ãƒ¼ãƒˆã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Named Pipe**: `\pipe\winreg`
* **Description**: ãƒªãƒ¢ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚µãƒ¼ãƒ“ã‚¹ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å¤‰æ›´ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Named Pipe**: `\pipe\svcctl`
* **Description**: ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŠã‚ˆã³ã‚µãƒ¼ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã€ãƒªãƒ¢ãƒ¼ãƒˆã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹å§‹ãŠã‚ˆã³åœæ­¢ã—ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Named Pipe**: `\pipe\srvsvc`
* **Description**: ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŠã‚ˆã³ã‚µãƒ¼ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã€ãƒªãƒ¢ãƒ¼ãƒˆã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹å§‹ãŠã‚ˆã³åœæ­¢ã—ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Named Pipe**: `\pipe\epmapper`
* **Description**: DCOMã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚°ãƒ©ã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŠã‚ˆã³WMã‚’ä»‹ã—ãŸæƒ…å ±åé›†ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

### Identifying IP addresses

Using [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver), comes from [Airbus research](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/) is possible to abuse the _**ServerAlive2**_ method inside the _**IOXIDResolver**_ interface.

This method has been used to get interface information as **IPv6** address from the HTB box _APT_. See [here](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) for 0xdf APT writeup, it includes an alternative method using rpcmap.py from [Impacket](https://github.com/SecureAuthCorp/impacket/) with _stringbinding_ (see above).

### Executing a RCE with valid credentials

It is possible to execute remote code on a machine, if the credentials of a valid user are available using [dcomexec.py](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py) from impacket framework.

**Remember to try with the different objects available**

* ShellWindows
* ShellBrowserWindow
* MMC20

## Port 593

The **rpcdump.exe** from [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) can interact with this port.

## References

* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
