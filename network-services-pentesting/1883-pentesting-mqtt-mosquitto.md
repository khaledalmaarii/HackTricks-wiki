# 1883 - MQTTæ¸—é€æµ‹è¯•ï¼ˆMosquittoï¼‰

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## åŸºæœ¬ä¿¡æ¯

MQTTä»£è¡¨MQ Telemetry Transportã€‚å®ƒæ˜¯ä¸€ç§å‘å¸ƒ/è®¢é˜…çš„**æå…¶ç®€å•å’Œè½»é‡çº§çš„æ¶ˆæ¯ä¼ é€’åè®®**ï¼Œä¸“ä¸ºå—é™è®¾å¤‡å’Œå¸¦å®½æœ‰é™ã€å»¶è¿Ÿé«˜æˆ–ä¸å¯é çš„ç½‘ç»œè®¾è®¡ã€‚è®¾è®¡åŸåˆ™æ˜¯åœ¨å°½é‡å‡å°‘ç½‘ç»œå¸¦å®½å’Œè®¾å¤‡èµ„æºéœ€æ±‚çš„åŒæ—¶ï¼Œä¹Ÿå°½é‡ç¡®ä¿å¯é æ€§å’Œä¸€å®šç¨‹åº¦çš„ä¼ é€’ä¿è¯ã€‚è¿™äº›åŸåˆ™ä¹Ÿä½¿å¾—è¯¥åè®®æˆä¸ºæ–°å…´çš„â€œæœºå™¨å¯¹æœºå™¨â€ï¼ˆM2Mï¼‰æˆ–â€œç‰©è”ç½‘â€ä¸–ç•Œä¸­è¿æ¥è®¾å¤‡çš„ç†æƒ³é€‰æ‹©ï¼Œå¹¶é€‚ç”¨äºå¸¦å®½å’Œç”µæ± åŠŸè€—æœ‰é™çš„ç§»åŠ¨åº”ç”¨ã€‚

**é»˜è®¤ç«¯å£ï¼š** 1883
```
PORT     STATE SERVICE                 REASON
1883/tcp open  mosquitto version 1.4.8 syn-ack
```
## æ£€æŸ¥æµé‡

MQTTä»£ç†åœ¨æ”¶åˆ°CONNECTæ•°æ®åŒ…åä¼šå‘é€CONNACKæ•°æ®åŒ…ä½œä¸ºå“åº”ã€‚è¿”å›ç 0x00è¡¨ç¤ºå‡­æ®æœ‰æ•ˆï¼Œè¿”å›ç 0x05è¡¨ç¤ºå‡­æ®æ— æ•ˆã€‚0x05ç¤ºä¾‹ï¼š

![](<../.gitbook/assets/image (645) (1).png>)

### [**æš´åŠ›ç ´è§£MQTT**](../generic-methodologies-and-resources/brute-force.md#mqtt)

## MQTTæ¸—é€æµ‹è¯•

**èº«ä»½éªŒè¯æ˜¯å®Œå…¨å¯é€‰çš„**ï¼Œå³ä½¿æ­£åœ¨æ‰§è¡Œèº«ä»½éªŒè¯ï¼Œ**é»˜è®¤æƒ…å†µä¸‹ä¸ä½¿ç”¨åŠ å¯†**ï¼ˆå‡­æ®ä»¥æ˜æ–‡å½¢å¼å‘é€ï¼‰ã€‚ä»ç„¶å¯ä»¥æ‰§è¡Œä¸­é—´äººæ”»å‡»æ¥çªƒå–å¯†ç ã€‚

è¦è¿æ¥åˆ°MQTTæœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ï¼š[https://github.com/bapowell/python-mqtt-client-shell](https://github.com/bapowell/python-mqtt-client-shell)ï¼Œå¹¶è®¢é˜…æ‰€æœ‰ä¸»é¢˜ï¼š
```
> connect (NOTICE that you need to indicate before this the params of the connection, by default 127.0.0.1:1883)
> subscribe "#" 1
> subscribe "$SYS/#"
```
ä½ è¿˜å¯ä»¥ä½¿ç”¨[**https://github.com/akamai-threat-research/mqtt-pwn**](https://github.com/akamai-threat-research/mqtt-pwn)

ä½ è¿˜å¯ä»¥ä½¿ç”¨ï¼š
```bash
apt-get install mosquitto mosquitto-clients
mosquitto_sub -t 'test/topic' -v #Subscriribe to 'test/topic'
```
æˆ–è€…ä½ å¯ä»¥è¿è¡Œä»¥ä¸‹ä»£ç å°è¯•è¿æ¥åˆ°ä¸€ä¸ªæ²¡æœ‰èº«ä»½éªŒè¯çš„MQTTæœåŠ¡ï¼Œè®¢é˜…æ‰€æœ‰ä¸»é¢˜å¹¶ç›‘å¬å®ƒä»¬ï¼š
```python
#This is a modified version of https://github.com/Warflop/IOT-MQTT-Exploit/blob/master/mqtt.py
import paho.mqtt.client as mqtt
import time
import os

HOST = "127.0.0.1"
PORT = 1883

def on_connect(client, userdata, flags, rc):
client.subscribe('#', qos=1)
client.subscribe('$SYS/#')

def on_message(client, userdata, message):
print('Topic: %s | QOS: %s  | Message: %s' % (message.topic, message.qos, message.payload))

def main():
client = mqtt.Client()
client.on_connect = on_connect
client.on_message = on_message
client.connect(HOST, PORT)
client.loop_start()
#time.sleep(10)
#client.loop_stop()

if __name__ == "__main__":
main()
```
## æ›´å¤šä¿¡æ¯

æ¥è‡ªè¿™é‡Œï¼š[https://morphuslabs.com/hacking-the-iot-with-mqtt-8edaf0d07b9b](https://morphuslabs.com/hacking-the-iot-with-mqtt-8edaf0d07b9b)

### å‘å¸ƒ/è®¢é˜…æ¨¡å¼ <a href="#b667" id="b667"></a>

å‘å¸ƒ/è®¢é˜…æ¨¡å¼ç”±ä»¥ä¸‹ç»„æˆï¼š

* **å‘å¸ƒè€…**ï¼šå°†æ¶ˆæ¯å‘å¸ƒåˆ°ä»£ç†ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜ã€‚
* **è®¢é˜…è€…**ï¼šè®¢é˜…ä»£ç†ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜ï¼Œå¹¶æ¥æ”¶å‘å¸ƒè€…å‘é€çš„æ‰€æœ‰æ¶ˆæ¯ã€‚
* **ä»£ç†**ï¼šå°†å‘å¸ƒè€…çš„æ‰€æœ‰æ¶ˆæ¯è·¯ç”±åˆ°è®¢é˜…è€…ã€‚
* **ä¸»é¢˜**ï¼šç”±ä¸€ä¸ªæˆ–å¤šä¸ªçº§åˆ«ç»„æˆï¼Œçº§åˆ«ä¹‹é—´ç”¨æ­£æ–œæ åˆ†éš”ï¼ˆä¾‹å¦‚ï¼Œ/smartshouse/livingroom/temperatureï¼‰ã€‚

![](https://miro.medium.com/max/1073/1\*sIxvchdgHSqAGebJjFHBAg.png)

### æ•°æ®åŒ…æ ¼å¼ <a href="#f15a" id="f15a"></a>

æ¯ä¸ª MQTT æ•°æ®åŒ…éƒ½åŒ…å«ä¸€ä¸ªå›ºå®šçš„æ ‡å¤´ï¼ˆå›¾ 02ï¼‰ã€‚å›¾ 02ï¼šå›ºå®šæ ‡å¤´

![](https://miro.medium.com/max/838/1\*k6RkAHEk0576geQGUcKSTA.png)

å›ºå®šæ ‡å¤´çš„ç¬¬ä¸€ä¸ªå­—æ®µè¡¨ç¤º MQTT æ•°æ®åŒ…çš„ç±»å‹ã€‚æ‰€æœ‰æ•°æ®åŒ…ç±»å‹éƒ½åˆ—åœ¨è¡¨ 01 ä¸­ã€‚è¡¨ 01ï¼šMQTT æ•°æ®åŒ…ç±»å‹

![](https://miro.medium.com/max/1469/1\*z0fhdUVzGa0PLikH\_cyBmQ.png)

## Shodan

* `port:1883 MQTT`

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud)æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
