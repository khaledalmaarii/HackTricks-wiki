# 27017,27018 - MongoDB æ¸—é€æµ‹è¯•

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„å…¬å¸åœ¨ HackTricks ä¸­è¢«å¹¿å‘Šï¼Œæˆ–è€…**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œèµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢è§è§£**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€å’ŒæŒ‘æˆ˜çš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£åŠæ—¶äº†è§£å¿«èŠ‚å¥çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
éšæ—¶äº†è§£æœ€æ–°çš„èµé‡‘è®¡åˆ’å‘å¸ƒå’Œé‡è¦å¹³å°æ›´æ–°

**åŠ å…¥æˆ‘ä»¬çš„** [**Discord**](https://discord.com/invite/N3FrSbmwdy)ï¼Œç«‹å³å¼€å§‹ä¸é¡¶å°–é»‘å®¢åˆä½œï¼ 

## åŸºæœ¬ä¿¡æ¯

**MongoDB** æ˜¯ä¸€ç§ä½¿ç”¨**é¢å‘æ–‡æ¡£çš„æ•°æ®åº“æ¨¡å‹**å¤„ç†å„ç§å½¢å¼æ•°æ®çš„**å¼€æº**æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚å®ƒæä¾›äº†çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œç”¨äºç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„éç»“æ„åŒ–æˆ–åŠç»“æ„åŒ–æ•°æ®ï¼Œå¦‚å¤§æ•°æ®åˆ†æå’Œå†…å®¹ç®¡ç†ã€‚**é»˜è®¤ç«¯å£ï¼š**27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## æšä¸¾

### æ‰‹åŠ¨
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**ä¸€äº› MongoDB å‘½ä»¤ï¼š**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### è‡ªåŠ¨åŒ–
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

* æ‰€æœ‰mongodbï¼š`"mongodbæœåŠ¡å™¨ä¿¡æ¯"`
* æœç´¢å®Œå…¨å¼€æ”¾çš„mongodbæœåŠ¡å™¨ï¼š`"mongodbæœåŠ¡å™¨ä¿¡æ¯" -"éƒ¨åˆ†å¯ç”¨"`
* ä»…éƒ¨åˆ†å¯ç”¨è®¤è¯ï¼š`"mongodbæœåŠ¡å™¨ä¿¡æ¯" "éƒ¨åˆ†å¯ç”¨"`

## ç™»å½•

é»˜è®¤æƒ…å†µä¸‹ï¼ŒMongo ä¸éœ€è¦å¯†ç ã€‚\
**Admin** æ˜¯ä¸€ä¸ªå¸¸è§çš„ Mongo æ•°æ®åº“ã€‚
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
nmapè„šæœ¬ï¼š_**mongodb-brute**_ å°†æ£€æŸ¥æ˜¯å¦éœ€è¦å‡­æ®ã€‚
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**æš´åŠ›ç ´è§£**](../generic-methodologies-and-resources/brute-force.md#mongo)

æŸ¥çœ‹ _/opt/bitnami/mongodb/mongodb.conf_ æ–‡ä»¶ä»¥äº†è§£æ˜¯å¦éœ€è¦å‡­æ®ï¼š
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid é¢„æµ‹

ç¤ºä¾‹[åœ¨è¿™é‡Œ](https://techkranti.com/idor-through-mongodb-object-ids-prediction/)ã€‚

Mongo Object IDs æ˜¯**12å­—èŠ‚çš„åå…­è¿›åˆ¶**å­—ç¬¦ä¸²ï¼š

![http://techidiocy.com/\_id-objectid-in-mongodb/](../.gitbook/assets/id-and-ObjectIds-in-MongoDB.png)

ä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯å¦‚ä½•è§£æåº”ç”¨ç¨‹åºè¿”å›çš„å®é™… Object IDï¼š5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 è½¬æ¢ä¸ºåè¿›åˆ¶ = 2020å¹´7æœˆ31æ—¥æ˜ŸæœŸäº” 17:49:32
2. 9fa6dc: æœºå™¨æ ‡è¯†ç¬¦
3. 2500: è¿›ç¨‹ ID
4. 314019: é€’å¢è®¡æ•°å™¨

åœ¨ä¸Šè¿°å…ƒç´ ä¸­ï¼Œæœºå™¨æ ‡è¯†ç¬¦å°†åœ¨æ•°æ®åº“è¿è¡Œåœ¨ç›¸åŒçš„ç‰©ç†/è™šæ‹Ÿæœºå™¨ä¸Šæ—¶ä¿æŒä¸å˜ã€‚å¦‚æœ MongoDB è¿›ç¨‹é‡æ–°å¯åŠ¨ï¼Œè¿›ç¨‹ ID å°†ä¼šæ”¹å˜ã€‚æ—¶é—´æˆ³å°†æ¯ç§’æ›´æ–°ä¸€æ¬¡ã€‚é€šè¿‡ç®€å•é€’å¢è®¡æ•°å™¨å’Œæ—¶é—´æˆ³å€¼æ¥çŒœæµ‹ Object ID çš„å”¯ä¸€æŒ‘æˆ˜åœ¨äº Mongo DB ç”Ÿæˆ Object IDs å¹¶åœ¨ç³»ç»Ÿçº§åˆ«åˆ†é… Object IDsã€‚

è¯¥å·¥å…·[https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict)ï¼Œç»™å®šä¸€ä¸ªèµ·å§‹ Object IDï¼ˆæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸æˆ·å¹¶è·å–ä¸€ä¸ªèµ·å§‹ IDï¼‰ï¼Œå®ƒä¼šè¿”å›å¤§çº¦ 1000 ä¸ªå¯èƒ½è¢«åˆ†é…ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡çš„ Object IDsï¼Œå› æ­¤æ‚¨åªéœ€è¦å¯¹å®ƒä»¬è¿›è¡Œæš´åŠ›ç ´è§£ã€‚

## å¸–å­

å¦‚æœæ‚¨æ˜¯ root ç”¨æˆ·ï¼Œæ‚¨å¯ä»¥**ä¿®æ”¹** **mongodb.conf** æ–‡ä»¶ï¼Œä»¥ä¾¿ä¸éœ€è¦å‡­æ®ï¼ˆ_noauth = true_ï¼‰å¹¶**æ— å‡­è¯ç™»å½•**ã€‚

***

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œèµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢è§è§£**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢è¡Œä¸ºçš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£åŠæ—¶äº†è§£å¿«èŠ‚å¥çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
é€šè¿‡æœ€æ–°çš„èµé‡‘è®¡åˆ’å‘å¸ƒå’Œé‡è¦å¹³å°æ›´æ–°ä¿æŒä¿¡æ¯æ›´æ–°

**åŠ å…¥æˆ‘ä»¬çš„** [**Discord**](https://discord.com/invite/N3FrSbmwdy) å¹¶å¼€å§‹ä¸é¡¶å°–é»‘å®¢åˆä½œï¼
