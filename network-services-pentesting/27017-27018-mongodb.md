# 27017,27018 - Pentesting MongoDB

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢è§è§£**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€ä¸æŒ‘æˆ˜çš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ï¼Œè·Ÿä¸Šå¿«é€Ÿå˜åŒ–çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
äº†è§£æœ€æ–°çš„æ¼æ´èµé‡‘è®¡åˆ’å’Œé‡è¦å¹³å°æ›´æ–°

**ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬çš„** [**Discord**](https://discord.com/invite/N3FrSbmwdy)ï¼Œä¸é¡¶å°–é»‘å®¢å¼€å§‹åˆä½œå§ï¼

## åŸºæœ¬ä¿¡æ¯

**MongoDB** æ˜¯ä¸€ä¸ª **å¼€æº** æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç”¨ **æ–‡æ¡£å¯¼å‘æ•°æ®åº“æ¨¡å‹** æ¥å¤„ç†å¤šç§å½¢å¼çš„æ•°æ®ã€‚å®ƒä¸ºç®¡ç†éç»“æ„åŒ–æˆ–åŠç»“æ„åŒ–æ•°æ®æä¾›äº†çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œé€‚ç”¨äºå¤§æ•°æ®åˆ†æå’Œå†…å®¹ç®¡ç†ç­‰åº”ç”¨ã€‚**é»˜è®¤ç«¯å£ï¼š** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## æšä¸¾

### æ‰‹åŠ¨
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**ä¸€äº›MongoDBå‘½ä»¤ï¼š**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### è‡ªåŠ¨
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

* æ‰€æœ‰ mongodb: `"mongodb server information"`
* æœç´¢å®Œå…¨å¼€æ”¾çš„ mongodb æœåŠ¡å™¨: `"mongodb server information" -"partially enabled"`
* ä»…éƒ¨åˆ†å¯ç”¨è®¤è¯: `"mongodb server information" "partially enabled"`

## ç™»å½•

é»˜è®¤æƒ…å†µä¸‹ï¼Œmongo ä¸éœ€è¦å¯†ç ã€‚\
**Admin** æ˜¯ä¸€ä¸ªå¸¸è§çš„ mongo æ•°æ®åº“ã€‚
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
nmapè„šæœ¬ï¼š_**mongodb-brute**_ å°†æ£€æŸ¥æ˜¯å¦éœ€è¦å‡­æ®ã€‚
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**æš´åŠ›ç ´è§£**](../generic-methodologies-and-resources/brute-force.md#mongo)

æŸ¥çœ‹ _/opt/bitnami/mongodb/mongodb.conf_ ä»¥äº†è§£æ˜¯å¦éœ€è¦å‡­æ®ï¼š
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid é¢„æµ‹

ç¤ºä¾‹ [æ¥è‡ªè¿™é‡Œ](https://techkranti.com/idor-through-mongodb-object-ids-prediction/)ã€‚

Mongo å¯¹è±¡ ID æ˜¯ **12 å­—èŠ‚åå…­è¿›åˆ¶** å­—ç¬¦ä¸²ï¼š

![http://techidiocy.com/\_id-objectid-in-mongodb/](../.gitbook/assets/id-and-ObjectIds-in-MongoDB.png)

ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬å¦‚ä½•è§£æåº”ç”¨ç¨‹åºè¿”å›çš„å®é™…å¯¹è±¡ IDï¼š5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772ï¼ˆåè¿›åˆ¶ï¼‰= 2020å¹´7æœˆ31æ—¥æ˜ŸæœŸäº” 17:49:32
2. 9fa6dc: æœºå™¨æ ‡è¯†ç¬¦
3. 2500: è¿›ç¨‹ ID
4. 314019: å¢é‡è®¡æ•°å™¨

åœ¨ä¸Šè¿°å…ƒç´ ä¸­ï¼Œæœºå™¨æ ‡è¯†ç¬¦åœ¨æ•°æ®åº“è¿è¡Œåœ¨åŒä¸€ç‰©ç†/è™šæ‹Ÿæœºä¸Šæ—¶å°†ä¿æŒä¸å˜ã€‚è¿›ç¨‹ ID ä»…åœ¨ MongoDB è¿›ç¨‹é‡å¯æ—¶æ›´æ”¹ã€‚æ—¶é—´æˆ³æ¯ç§’æ›´æ–°ä¸€æ¬¡ã€‚é€šè¿‡ç®€å•åœ°é€’å¢è®¡æ•°å™¨å’Œæ—¶é—´æˆ³å€¼æ¥çŒœæµ‹å¯¹è±¡ ID çš„å”¯ä¸€æŒ‘æˆ˜æ˜¯ Mongo DB åœ¨ç³»ç»Ÿçº§åˆ«ç”Ÿæˆå’Œåˆ†é…å¯¹è±¡ IDã€‚

å·¥å…· [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict)ï¼Œç»™å®šä¸€ä¸ªèµ·å§‹å¯¹è±¡ IDï¼ˆæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸æˆ·å¹¶è·å–èµ·å§‹ IDï¼‰ï¼Œå®ƒä¼šè¿”å›å¤§çº¦ 1000 ä¸ªå¯èƒ½åˆ†é…ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¯¹è±¡ IDï¼Œå› æ­¤æ‚¨åªéœ€å¯¹å®ƒä»¬è¿›è¡Œæš´åŠ›ç ´è§£ã€‚

## Post

å¦‚æœæ‚¨æ˜¯ rootï¼Œæ‚¨å¯ä»¥ **ä¿®æ”¹** **mongodb.conf** æ–‡ä»¶ï¼Œä»¥ä¾¿ä¸éœ€è¦å‡­æ®ï¼ˆ_noauth = true_ï¼‰å¹¶ä¸” **æ— éœ€å‡­æ®ç™»å½•**ã€‚

***

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢è§è§£**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€å’ŒæŒ‘æˆ˜çš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ï¼Œè·Ÿä¸Šå¿«é€Ÿå˜åŒ–çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
äº†è§£æœ€æ–°çš„æ¼æ´èµé‡‘å¯åŠ¨å’Œé‡è¦å¹³å°æ›´æ–°

**åŠ å…¥æˆ‘ä»¬** [**Discord**](https://discord.com/invite/N3FrSbmwdy)ï¼Œä»Šå¤©å°±å¼€å§‹ä¸é¡¶çº§é»‘å®¢åˆä½œï¼

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
