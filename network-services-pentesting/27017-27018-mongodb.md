# 27017,27018 - MongoDBæ¸—é€æµ‹è¯•

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProofæ˜¯æ‰€æœ‰åŠ å¯†æ¼æ´èµé‡‘çš„å®¶å›­ã€‚**

**æ— éœ€ç­‰å¾…å³å¯è·å¾—å¥–åŠ±**\
HackenProofçš„èµé‡‘åªæœ‰åœ¨å®¢æˆ·å­˜å…¥å¥–åŠ±é¢„ç®—åæ‰ä¼šå¯åŠ¨ã€‚åœ¨æ¼æ´éªŒè¯åï¼Œæ‚¨å°†è·å¾—å¥–åŠ±ã€‚

**åœ¨web3æ¸—é€æµ‹è¯•ä¸­ç§¯ç´¯ç»éªŒ**\
åŒºå—é“¾åè®®å’Œæ™ºèƒ½åˆçº¦æ˜¯æ–°çš„äº’è”ç½‘ï¼åœ¨å…¶å…´èµ·çš„æ—¶ä»£æŒæ¡web3å®‰å…¨ã€‚

**æˆä¸ºweb3é»‘å®¢ä¼ å¥‡**\
æ¯æ¬¡éªŒè¯çš„æ¼æ´éƒ½ä¼šè·å¾—å£°æœ›ç§¯åˆ†ï¼Œå¹¶å æ®æ¯å‘¨æ’è¡Œæ¦œçš„æ¦œé¦–ã€‚

[**åœ¨HackenProofä¸Šæ³¨å†Œ**](https://hackenproof.com/register)å¼€å§‹ä»æ‚¨çš„é»‘å®¢æ”»å‡»ä¸­è·åˆ©ï¼

{% embed url="https://hackenproof.com/register" %}

## åŸºæœ¬ä¿¡æ¯

MongoDBæ˜¯ä¸€ä¸ªä½¿ç”¨é¢å‘æ–‡æ¡£çš„æ•°æ®åº“æ¨¡å‹çš„[å¼€æº](https://whatis.techtarget.com/definition/open-source)æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ï¼Œæ”¯æŒå„ç§å½¢å¼çš„æ•°æ®ã€‚ï¼ˆæ¥è‡ª[è¿™é‡Œ](https://searchdatamanagement.techtarget.com/definition/MongoDB)ï¼‰

**é»˜è®¤ç«¯å£ï¼š** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## æšä¸¾

### æ‰‹åŠ¨æšä¸¾

MongoDBé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šç»‘å®šåˆ°ç‰¹å®šçš„IPåœ°å€ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è¿æ¥åˆ°ç›®æ ‡IPåœ°å€çš„27017å’Œ27018ç«¯å£æ¥å°è¯•è®¿é—®MongoDBå®ä¾‹ã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿æ¥åˆ°MongoDBå®ä¾‹ï¼š

```bash
mongo --host <target_ip> --port <port>
```

å¦‚æœæˆåŠŸè¿æ¥åˆ°MongoDBå®ä¾‹ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªæç¤ºç¬¦ï¼Œå¯ä»¥åœ¨å…¶ä¸­æ‰§è¡ŒMongoDBå‘½ä»¤ã€‚

### è‡ªåŠ¨åŒ–æšä¸¾

å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ¥æšä¸¾MongoDBå®ä¾‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å·¥å…·ï¼š

- **MongoDB Compass**ï¼šå®˜æ–¹æä¾›çš„å›¾å½¢åŒ–ç•Œé¢å·¥å…·ï¼Œå¯ç”¨äºè¿æ¥å’Œç®¡ç†MongoDBå®ä¾‹ã€‚
- **Nmap**ï¼šä½¿ç”¨Nmapçš„è„šæœ¬æ‰«æåŠŸèƒ½ï¼Œå¯ä»¥å‘ç°MongoDBå®ä¾‹å¹¶æä¾›æœ‰å…³å®ä¾‹çš„ä¿¡æ¯ã€‚
- **Metasploit**ï¼šMetasploitæ¡†æ¶ä¸­çš„MongoDBæ¨¡å—å¯ç”¨äºæšä¸¾å’Œæ”»å‡»MongoDBå®ä¾‹ã€‚

ä½¿ç”¨è¿™äº›å·¥å…·ä¹‹ä¸€ï¼Œå¯ä»¥è‡ªåŠ¨å‘ç°å’Œæšä¸¾MongoDBå®ä¾‹ï¼Œä»¥è·å–æœ‰å…³ç›®æ ‡ç³»ç»Ÿçš„æ›´å¤šä¿¡æ¯ã€‚
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**ä¸€äº›MongoDBå‘½ä»¤ï¼š**

```bash
# Show all databases
show dbs

# Switch to a specific database
use <database_name>

# Show all collections in the current database
show collections

# Show all documents in a collection
db.<collection_name>.find()

# Insert a document into a collection
db.<collection_name>.insertOne({<document>})

# Update a document in a collection
db.<collection_name>.updateOne({<filter>}, {$set: {<update>}})

# Delete a document from a collection
db.<collection_name>.deleteOne({<filter>})
```

**Note:** Replace `<database_name>` with the name of the desired database, `<collection_name>` with the name of the desired collection, `<document>` with the document to be inserted, `<filter>` with the filter to identify the document to be updated or deleted, and `<update>` with the fields to be updated in the document.
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### è‡ªåŠ¨åŒ–

MongoDB is a popular NoSQL database that is widely used in web applications. It uses a binary protocol for communication, which makes it vulnerable to attacks if not properly secured. In this section, we will discuss some automated techniques that can be used to exploit MongoDB.

#### Enumeration

Enumeration is the process of gathering information about the target system. In the case of MongoDB, we can use automated tools like **mongo** and **mongoaudit** to enumerate the databases, collections, and documents present in the database.

```bash
mongo --host <target_ip> --port <target_port>
show dbs
use <database_name>
show collections
db.<collection_name>.find()
```

#### Brute-forcing

Brute-forcing is a technique used to guess the correct username and password combination. In the case of MongoDB, we can use automated tools like **Hydra** and **Nmap** to perform brute-force attacks.

```bash
hydra -l <username> -P <password_list> <target_ip> mongodb
nmap -p <target_port> --script mongodb-brute <target_ip>
```

#### Exploiting Weak Configuration

Weak configuration settings can make a MongoDB database vulnerable to attacks. Automated tools like **mongoaudit** can be used to identify weak configuration settings and suggest remediation steps.

```bash
mongoaudit --host <target_ip> --port <target_port>
```

#### Exploiting Default Credentials

MongoDB comes with default credentials that are often left unchanged by administrators. Automated tools like **mongo** and **mongoaudit** can be used to check if the default credentials are still in use.

```bash
mongo --host <target_ip> --port <target_port> -u <username> -p <password> --authenticationDatabase admin
mongoaudit --host <target_ip> --port <target_port> --username <username> --password <password> --authenticationDatabase admin
```

#### Exploiting Injection Vulnerabilities

Injection vulnerabilities in MongoDB can allow an attacker to execute arbitrary commands on the database. Automated tools like **NoSQLMap** can be used to exploit these vulnerabilities.

```bash
nosqlmap -u "mongodb://<target_ip>:<target_port>/<database_name>" --passwords <password_list> --dbs
```

#### Conclusion

Automated techniques can greatly simplify the process of exploiting MongoDB. However, it is important to note that these techniques should only be used for ethical purposes, such as penetration testing or securing your own systems.
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

* æ‰€æœ‰çš„mongodb: `"mongodbæœåŠ¡å™¨ä¿¡æ¯"`
* æœç´¢å®Œå…¨å¼€æ”¾çš„mongodbæœåŠ¡å™¨: `"mongodbæœåŠ¡å™¨ä¿¡æ¯" -"éƒ¨åˆ†å¯ç”¨"`
* åªéƒ¨åˆ†å¯ç”¨èº«ä»½éªŒè¯: `"mongodbæœåŠ¡å™¨ä¿¡æ¯" "éƒ¨åˆ†å¯ç”¨"`

## ç™»å½•

é»˜è®¤æƒ…å†µä¸‹ï¼Œmongoä¸éœ€è¦å¯†ç ã€‚\
**Admin** æ˜¯ä¸€ä¸ªå¸¸è§çš„mongoæ•°æ®åº“ã€‚
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
nmapè„šæœ¬ï¼š_**mongodb-brute**_ å°†æ£€æŸ¥æ˜¯å¦éœ€è¦å‡­æ®ã€‚
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**æš´åŠ›ç ´è§£**](../generic-methodologies-and-resources/brute-force.md#mongo)

æŸ¥çœ‹ _/opt/bitnami/mongodb/mongodb.conf_ æ–‡ä»¶ä»¥ç¡®å®šæ˜¯å¦éœ€è¦å‡­æ®ï¼š
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid é¢„æµ‹

Mongo Object ID æ˜¯**12å­—èŠ‚çš„åå…­è¿›åˆ¶**å­—ç¬¦ä¸²ï¼š

![](../.gitbook/assets/id-and-objectids-in-mongodb.png)

ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªå®é™…åº”ç”¨è¿”å›çš„ Object ID çš„è§£æç¤ºä¾‹ï¼š5f2459ac9fa6dc2500314019

1. 5f2459acï¼š1596217772 çš„åè¿›åˆ¶è¡¨ç¤º = 2020å¹´7æœˆ31æ—¥æ˜ŸæœŸäº” 17:49:32
2. 9fa6dcï¼šæœºå™¨æ ‡è¯†ç¬¦
3. 2500ï¼šè¿›ç¨‹ ID
4. 314019ï¼šé€’å¢è®¡æ•°å™¨

åœ¨ä¸Šè¿°å…ƒç´ ä¸­ï¼Œæœºå™¨æ ‡è¯†ç¬¦åœ¨æ•°æ®åº“è¿è¡Œç›¸åŒçš„ç‰©ç†/è™šæ‹Ÿæœºçš„æ—¶é—´å†…ä¿æŒä¸å˜ã€‚åªæœ‰åœ¨ MongoDB è¿›ç¨‹é‡æ–°å¯åŠ¨æ—¶ï¼Œè¿›ç¨‹ ID æ‰ä¼šæ›´æ”¹ã€‚æ—¶é—´æˆ³æ¯ç§’æ›´æ–°ä¸€æ¬¡ã€‚é€šè¿‡ç®€å•åœ°é€’å¢è®¡æ•°å™¨å’Œæ—¶é—´æˆ³å€¼æ¥çŒœæµ‹ Object ID çš„å”¯ä¸€æŒ‘æˆ˜åœ¨äºï¼ŒMongo DB ç”Ÿæˆ Object ID å¹¶åœ¨ç³»ç»Ÿçº§åˆ«åˆ†é… Object IDã€‚

å·¥å…· [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict) å¯ä»¥æ ¹æ®ä¸€ä¸ªèµ·å§‹ Object IDï¼ˆæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸æˆ·å¹¶è·å–ä¸€ä¸ªèµ·å§‹ IDï¼‰ï¼Œè¿”å›å¤§çº¦ 1000 ä¸ªå¯èƒ½å·²åˆ†é…ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡çš„ Object IDï¼Œå› æ­¤æ‚¨åªéœ€è¦ä½¿ç”¨æš´åŠ›ç ´è§£æ¥å°è¯•å®ƒä»¬ã€‚

## å‘å¸ƒ

å¦‚æœæ‚¨æ˜¯ root ç”¨æˆ·ï¼Œå¯ä»¥**ä¿®æ”¹** **mongodb.conf** æ–‡ä»¶ï¼Œä»¥ä¾¿ä¸éœ€è¦å‡­æ®ï¼ˆ_noauth = true_ï¼‰å¹¶**æ— éœ€å‡­æ®ç™»å½•**ã€‚

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof æ˜¯æ‰€æœ‰åŠ å¯†æ¼æ´èµé‡‘çš„å®¶å›­ã€‚**

**å³æ—¶è·å¾—å¥–åŠ±**\
HackenProof çš„èµé‡‘åªæœ‰åœ¨å®¢æˆ·å­˜å…¥å¥–åŠ±é¢„ç®—åæ‰ä¼šå¯åŠ¨ã€‚åœ¨æ¼æ´éªŒè¯åï¼Œæ‚¨å°†è·å¾—å¥–åŠ±ã€‚

**åœ¨ web3 æ¸—é€æµ‹è¯•ä¸­ç§¯ç´¯ç»éªŒ**\
åŒºå—é“¾åè®®å’Œæ™ºèƒ½åˆçº¦æ˜¯æ–°çš„äº’è”ç½‘ï¼åœ¨å®ƒå´›èµ·çš„æ—¶ä»£æŒæ¡ web3 å®‰å…¨ã€‚

**æˆä¸º web3 é»‘å®¢ä¼ å¥‡**\
æ¯æ¬¡éªŒè¯çš„æ¼æ´éƒ½ä¼šè·å¾—å£°æœ›ç§¯åˆ†ï¼Œå¹¶å æ®æ¯å‘¨æ’è¡Œæ¦œçš„æ¦œé¦–ã€‚

[**åœ¨ HackenProof ä¸Šæ³¨å†Œ**](https://hackenproof.com/register) å¼€å§‹ä»æ‚¨çš„é»‘å®¢è¡ŒåŠ¨ä¸­è·åˆ©ï¼

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šå—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨ **Twitter** ä¸Š **å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
