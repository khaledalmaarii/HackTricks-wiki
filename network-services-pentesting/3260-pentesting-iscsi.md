# 3260 - ISCSI Pentesting

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Temel Bilgiler

[Wikipedia](https://en.wikipedia.org/wiki/ISCSI)'dan alÄ±nan bilgilere gÃ¶re:

> Bilgisayar biliminde, **iSCSI**, veri depolama tesislerini baÄŸlamak iÃ§in bir Ä°nternet ProtokolÃ¼ (IP) tabanlÄ± depolama aÄŸÄ± standardÄ± olan **Internet Small Computer Systems Interface** kÄ±saltmasÄ±dÄ±r. SCSI komutlarÄ±nÄ± bir TCP/IP aÄŸÄ± Ã¼zerinden taÅŸÄ±yarak depolama cihazlarÄ±na blok dÃ¼zeyinde eriÅŸim saÄŸlar. iSCSI, veri transferlerini intranetler Ã¼zerinden gerÃ§ekleÅŸtirmek ve uzun mesafelerde depolama yÃ¶netimi yapmak iÃ§in kullanÄ±lÄ±r. Yerel aÄŸlar (LAN'lar), geniÅŸ alan aÄŸlarÄ± (WAN'lar) veya Ä°nternet Ã¼zerinden veri iletimini saÄŸlayabilir ve konum baÄŸÄ±msÄ±z veri depolama ve geri alma imkanÄ± sunabilir.
>
> Bu protokol, istemcilerin (baÅŸlatÄ±cÄ±lar olarak adlandÄ±rÄ±lÄ±r) uzak sunuculardaki depolama cihazlarÄ±na SCSI komutlarÄ±nÄ± (CDB'ler) gÃ¶ndermesine olanak tanÄ±r. Bu, bir depolama alanÄ± aÄŸÄ± (SAN) protokolÃ¼dÃ¼r ve organizasyonlara depolamayÄ± depolama dizilerine konsolide etme imkanÄ± saÄŸlarken, istemcilere (veritabanÄ± ve web sunucularÄ± gibi) yerel olarak baÄŸlÄ± SCSI disklerin yanÄ±lsamasÄ±nÄ± sunar. Genellikle Ã¶zel kablolar gerektiren geleneksel Fibre Channel ile baÅŸlÄ±ca rekabet ederken, iSCSI mevcut aÄŸ altyapÄ±sÄ±nÄ± kullanarak uzun mesafelerde Ã§alÄ±ÅŸtÄ±rÄ±labilir.

**VarsayÄ±lan port:** 3260
```
PORT     STATE SERVICE VERSION
3260/tcp open  iscsi?
```
## Saptama

iSCSI, bir aÄŸ protokolÃ¼dÃ¼r ve aÄŸ Ã¼zerinden depolama alanÄ± saÄŸlamak iÃ§in kullanÄ±lÄ±r. iSCSI hedefleri, IP adresleri veya DNS isimleriyle belirtilen sunucular olarak tanÄ±mlanÄ±r. iSCSI hedeflerini belirlemek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. **Port TaramasÄ±**: iSCSI hedeflerini bulmak iÃ§in bir port taramasÄ± yapÄ±n. iSCSI, genellikle TCP 3260 portunu kullanÄ±r.

2. **iSCSI KeÅŸfi**: iSCSI hedeflerini keÅŸfetmek iÃ§in iSCSI keÅŸif komutlarÄ±nÄ± kullanÄ±n. Ã–rneÄŸin, `iscsiadm -m discovery -t sendtargets -p <hedef_IP>` komutunu kullanabilirsiniz.

3. **iSCSI Hedefleri Listeleme**: KeÅŸfedilen iSCSI hedeflerini listelemek iÃ§in `iscsiadm -m node` komutunu kullanÄ±n.

4. **iSCSI Hedefleri AyrÄ±ntÄ±larÄ±**: KeÅŸfedilen iSCSI hedeflerinin ayrÄ±ntÄ±larÄ±nÄ± almak iÃ§in `iscsiadm -m node -T <hedef_adÄ±> -p <hedef_IP> -l` komutunu kullanÄ±n.

5. **iSCSI Hedefleri BaÄŸlantÄ± Durumu**: KeÅŸfedilen iSCSI hedeflerinin baÄŸlantÄ± durumunu kontrol etmek iÃ§in `iscsiadm -m session` komutunu kullanÄ±n.

6. **iSCSI Hedefleri BaÄŸlantÄ±sÄ±nÄ± Kesme**: BaÄŸlantÄ±yÄ± kesmek iÃ§in `iscsiadm -m node -T <hedef_adÄ±> -p <hedef_IP> -u` komutunu kullanÄ±n.

7. **iSCSI Hedefleri Oturumunu SonlandÄ±rma**: Oturumu sonlandÄ±rmak iÃ§in `iscsiadm -m node -T <hedef_adÄ±> -p <hedef_IP> -o delete` komutunu kullanÄ±n.

Bu adÄ±mlarÄ± takip ederek iSCSI hedeflerini saptayabilir ve ayrÄ±ntÄ±larÄ±nÄ± alabilirsiniz.
```
nmap -sV --script=iscsi-info -p 3260 192.168.xx.xx
```
Bu komut dosyasÄ± kimlik doÄŸrulamasÄ±nÄ±n gerekip gerekmediÄŸini belirtecektir.

### [Brute force](../generic-methodologies-and-resources/brute-force.md#iscsi)

### [Linux'ta ISCSI baÄŸlama](https://www.synology.com/en-us/knowledgebase/DSM/tutorial/Virtualization/How\_to\_set\_up\_and\_use\_iSCSI\_target\_on\_Linux)

**Not:** Hedeflerinizin keÅŸfedildiÄŸinde farklÄ± bir IP adresi altÄ±nda listelendiÄŸini fark edebilirsiniz. Bu genellikle iSCSI hizmetinin NAT veya sanal bir IP Ã¼zerinden aÃ§Ä±k olduÄŸunda olur. Bu durumlarda, `iscsiadmin` baÄŸlantÄ± kurmada baÅŸarÄ±sÄ±z olur. Bu, keÅŸif faaliyetleriniz tarafÄ±ndan otomatik olarak oluÅŸturulan dÃ¼ÄŸÃ¼m dizini adÄ±na ve bu dizin iÃ§indeki `default` dosyasÄ±na iki dÃ¼zeltme gerektirir.

Ã–rneÄŸin, 123.123.123.123 IP adresindeki bir iSCSI hedefine 3260 numaralÄ± baÄŸlantÄ± noktasÄ±ndan baÄŸlanmaya Ã§alÄ±ÅŸÄ±yorsunuz. iSCSI hedefini sunan sunucu aslÄ±nda 192.168.1.2 adresinde ancak NAT Ã¼zerinden aÃ§Ä±k. isciadm, _genel_ adres yerine _dahili_ adresi kaydedecektir.
```
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
192.168.1.2:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[...]
```
Bu komut, dosya sisteminizde ÅŸu ÅŸekilde bir dizin oluÅŸturacaktÄ±r:
```
/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/
```
Dizin iÃ§inde, hedefe baÄŸlanmak iÃ§in gerekli tÃ¼m ayarlarÄ± iÃ§eren varsayÄ±lan bir dosya bulunur.

1. `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/` dizinini `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/` olarak yeniden adlandÄ±rÄ±n.
2. `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default` iÃ§inde, `node.conn[0].address` ayarÄ±nÄ± 192.168.1.2 yerine 123.123.123.123'e yÃ¶nlendirecek ÅŸekilde deÄŸiÅŸtirin. Bu, `sed -i 's/192.168.1.2/123.123.123.123/g' /etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default` gibi bir komutla yapÄ±labilir.

Åimdi, baÄŸlantÄ±yÄ± talimatlara gÃ¶re baÄŸlayabilirsiniz.

### [Windows'ta ISCSI BaÄŸlama](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee338476\(v=ws.10\)?redirectedfrom=MSDN)

## **El ile numaralandÄ±rma**
```bash
sudo apt-get install open-iscsi
```
Ã–ncelikle, IP'nin arkasÄ±ndaki hedeflerin adÄ±nÄ± **keÅŸfetmeniz** gerekmektedir:
```bash
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
123.123.123.123:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[2a01:211:7b7:1223:211:32ff:fea9:fab9]:3260,1 iqn.2000-01.com.synology:asd3.Target-1.d0280fd382
[fe80::211:3232:fab9:1223]:3260,1 iqn.2000-01.com.synology:Oassdx.Target-1.d0280fd382
```
_Not edin ki, hedeflere ulaÅŸabileceÄŸiniz arayÃ¼zlerin I**P ve baÄŸlantÄ± noktasÄ±nÄ±** gÃ¶sterecektir. Hatta kullandÄ±ÄŸÄ±nÄ±zdan farklÄ± **dahili IP'leri veya farklÄ± IP'leri** bile gÃ¶sterebilir._

ArdÄ±ndan, her satÄ±rÄ±n **yazdÄ±rÄ±lan dize'nin ikinci bÃ¶lÃ¼mÃ¼nÃ¼ yakalayÄ±n** (ilk satÄ±rdan _iqn.1992-05.com.emc:fl1001433000190000-3-vnxe_) ve **giriÅŸ yapmaya Ã§alÄ±ÅŸÄ±n**:
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --login
Logging in to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] (multiple)
Login to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
ArdÄ±ndan, `â€“logout` kullanarak **Ã§Ä±kÄ±ÅŸ yapabilirsiniz**.
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --logout
Logging out of session [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260]
Logout of [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
Sadece `--login`/`--logout` parametresi kullanmadan **daha fazla bilgi** bulabiliriz.
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260
# BEGIN RECORD 2.0-873
node.name = iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
node.tpgt = 1
node.startup = manual
node.leading_login = No
iface.hwaddress = <empty>
iface.ipaddress = <empty>
iface.iscsi_ifacename = default
iface.net_ifacename = <empty>
iface.transport_name = tcp
iface.initiatorname = <empty>
iface.bootproto = <empty>
iface.subnet_mask = <empty>
iface.gateway = <empty>
iface.ipv6_autocfg = <empty>
iface.linklocal_autocfg = <empty>
iface.router_autocfg = <empty>
iface.ipv6_linklocal = <empty>
iface.ipv6_router = <empty>
iface.state = <empty>
iface.vlan_id = 0
iface.vlan_priority = 0
iface.vlan_state = <empty>
iface.iface_num = 0
iface.mtu = 0
iface.port = 0
node.discovery_address = 192.168.xx.xx
node.discovery_port = 3260
node.discovery_type = send_targets
node.session.initial_cmdsn = 0
node.session.initial_login_retry_max = 8
node.session.xmit_thread_priority = -20
node.session.cmds_max = 128
node.session.queue_depth = 32
node.session.nr_sessions = 1
node.session.auth.authmethod = None
node.session.auth.username = <empty>
node.session.auth.password = <empty>
node.session.auth.username_in = <empty>
node.session.auth.password_in = <empty>
node.session.timeo.replacement_timeout = 120
node.session.err_timeo.abort_timeout = 15
node.session.err_timeo.lu_reset_timeout = 30
node.session.err_timeo.tgt_reset_timeout = 30
node.session.err_timeo.host_reset_timeout = 60
node.session.iscsi.FastAbort = Yes
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
node.session.iscsi.FirstBurstLength = 262144
node.session.iscsi.MaxBurstLength = 16776192
node.session.iscsi.DefaultTime2Retain = 0
node.session.iscsi.DefaultTime2Wait = 2
node.session.iscsi.MaxConnections = 1
node.session.iscsi.MaxOutstandingR2T = 1
node.session.iscsi.ERL = 0
node.conn[0].address = 192.168.xx.xx
node.conn[0].port = 3260
node.conn[0].startup = manual
node.conn[0].tcp.window_size = 524288
node.conn[0].tcp.type_of_service = 0
node.conn[0].timeo.logout_timeout = 15
node.conn[0].timeo.login_timeout = 15
node.conn[0].timeo.auth_timeout = 45
node.conn[0].timeo.noop_out_interval = 5
node.conn[0].timeo.noop_out_timeout = 5
node.conn[0].iscsi.MaxXmitDataSegmentLength = 0
node.conn[0].iscsi.MaxRecvDataSegmentLength = 262144
node.conn[0].iscsi.HeaderDigest = None
node.conn[0].iscsi.DataDigest = None
node.conn[0].iscsi.IFMarker = No
node.conn[0].iscsi.OFMarker = No
# END RECORD
```
**Temel alt aÄŸ numaralandÄ±rma sÃ¼recini otomatikleÅŸtiren bir betik mevcuttur** [**iscsiadm**](https://github.com/bitvijays/Pentest-Scripts/tree/master/Vulnerability\_Analysis/isciadm)

## **Shodan**

* `port:3260 AuthMethod`

## **Referanslar**

* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm](https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
