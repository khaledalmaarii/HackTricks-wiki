# 3260 - Pentesting ISCSI

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

From [Wikipedia](https://en.wikipedia.org/wiki/ISCSI):

> In computing, **iSCSI**ëŠ” **Internet Small Computer Systems Interface**ì˜ ì•½ì–´ë¡œ, ë°ì´í„° ì €ì¥ ì‹œì„¤ì„ ì—°ê²°í•˜ê¸° ìœ„í•œ ì¸í„°ë„· í”„ë¡œí† ì½œ(IP) ê¸°ë°˜ì˜ ìŠ¤í† ë¦¬ì§€ ë„¤íŠ¸ì›Œí‚¹ í‘œì¤€ì…ë‹ˆë‹¤. TCP/IP ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ SCSI ëª…ë ¹ì„ ì „ì†¡í•˜ì—¬ ìŠ¤í† ë¦¬ì§€ ì¥ì¹˜ì— ë¸”ë¡ ìˆ˜ì¤€ ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. iSCSIëŠ” ì¸íŠ¸ë¼ë„·ì„ í†µí•œ ë°ì´í„° ì „ì†¡ì„ ìš©ì´í•˜ê²Œ í•˜ê³  ì¥ê±°ë¦¬ì—ì„œ ìŠ¤í† ë¦¬ì§€ë¥¼ ê´€ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ë¡œì»¬ ì˜ì—­ ë„¤íŠ¸ì›Œí¬(LAN), ê´‘ì—­ ë„¤íŠ¸ì›Œí¬(WAN) ë˜ëŠ” ì¸í„°ë„·ì„ í†µí•´ ë°ì´í„°ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆìœ¼ë©°, ìœ„ì¹˜ì— êµ¬ì• ë°›ì§€ ì•ŠëŠ” ë°ì´í„° ì €ì¥ ë° ê²€ìƒ‰ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.
>
> ì´ í”„ë¡œí† ì½œì€ í´ë¼ì´ì–¸íŠ¸(ì´ˆê¸°í™”ìë¼ê³  í•¨)ê°€ ì›ê²© ì„œë²„ì˜ ìŠ¤í† ë¦¬ì§€ ì¥ì¹˜(ëŒ€ìƒ)ë¡œ SCSI ëª…ë ¹(CDB)ì„ ì „ì†¡í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. ì´ëŠ” ìŠ¤í† ë¦¬ì§€ ì˜ì—­ ë„¤íŠ¸ì›Œí¬(SAN) í”„ë¡œí† ì½œë¡œ, ì¡°ì§ì´ ìŠ¤í† ë¦¬ì§€ë¥¼ ìŠ¤í† ë¦¬ì§€ ë°°ì—´ë¡œ í†µí•©í•˜ë©´ì„œ ë°ì´í„°ë² ì´ìŠ¤ ë° ì›¹ ì„œë²„ì™€ ê°™ì€ í´ë¼ì´ì–¸íŠ¸ì— ë¡œì»¬ì— ì—°ê²°ëœ SCSI ë””ìŠ¤í¬ì˜ í™˜ìƒì„ ì œê³µí•©ë‹ˆë‹¤. ì£¼ë¡œ íŒŒì´ë²„ ì±„ë„ê³¼ ê²½ìŸí•˜ì§€ë§Œ, ì „í†µì ì¸ íŒŒì´ë²„ ì±„ë„ì€ ì¼ë°˜ì ìœ¼ë¡œ ì „ìš© ì¼€ì´ë¸”ë§ì´ í•„ìš”í•œ ë°˜ë©´, iSCSIëŠ” ê¸°ì¡´ ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¥ê±°ë¦¬ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Default port:** 3260
```
PORT     STATE SERVICE VERSION
3260/tcp open  iscsi?
```
## ì—´ê±°
```
nmap -sV --script=iscsi-info -p 3260 192.168.xx.xx
```
ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì¸ì¦ì´ í•„ìš”í•œì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

### [ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©](../generic-methodologies-and-resources/brute-force.md#iscsi)

### [ë¦¬ëˆ…ìŠ¤ì—ì„œ ISCSI ë§ˆìš´íŠ¸í•˜ê¸°](https://www.synology.com/en-us/knowledgebase/DSM/tutorial/Virtualization/How\_to\_set\_up\_and\_use\_iSCSI\_target\_on\_Linux)

**ì°¸ê³ :** ëŒ€ìƒì´ ë°œê²¬ë  ë•Œ ë‹¤ë¥¸ IP ì£¼ì†Œ ì•„ë˜ì— ë‚˜ì—´ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” iSCSI ì„œë¹„ìŠ¤ê°€ NAT ë˜ëŠ” ê°€ìƒ IPë¥¼ í†µí•´ ë…¸ì¶œë  ë•Œ ë°œìƒí•˜ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ìš° `iscsiadmin`ì€ ì—°ê²°ì— ì‹¤íŒ¨í•©ë‹ˆë‹¤. ì´ëŠ” ë°œê²¬ í™œë™ì— ì˜í•´ ìë™ìœ¼ë¡œ ìƒì„±ëœ ë…¸ë“œì˜ ë””ë ‰í† ë¦¬ ì´ë¦„ê³¼ ì´ ë””ë ‰í† ë¦¬ì— í¬í•¨ëœ `default` íŒŒì¼ì— ëŒ€í•œ ë‘ ê°€ì§€ ì¡°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, 123.123.123.123ì˜ í¬íŠ¸ 3260ì—ì„œ iSCSI ëŒ€ìƒì„ ì—°ê²°í•˜ë ¤ê³  í•©ë‹ˆë‹¤. iSCSI ëŒ€ìƒì„ ë…¸ì¶œí•˜ëŠ” ì„œë²„ëŠ” ì‹¤ì œë¡œ 192.168.1.2ì— ìˆì§€ë§Œ NATë¥¼ í†µí•´ ë…¸ì¶œë©ë‹ˆë‹¤. isciadmì€ _ê³µì‹_ ì£¼ì†Œê°€ ì•„ë‹Œ _ë‚´ë¶€_ ì£¼ì†Œë¥¼ ë“±ë¡í•©ë‹ˆë‹¤:
```
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
192.168.1.2:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[...]
```
ì´ ëª…ë ¹ì€ íŒŒì¼ ì‹œìŠ¤í…œì— ë‹¤ìŒê³¼ ê°™ì€ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:
```
/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/
```
ë””ë ‰í† ë¦¬ ë‚´ì—ëŠ” ëŒ€ìƒì— ì—°ê²°í•˜ëŠ” ë° í•„ìš”í•œ ëª¨ë“  ì„¤ì •ì´ í¬í•¨ëœ ê¸°ë³¸ íŒŒì¼ì´ ìˆìŠµë‹ˆë‹¤.

1. `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/`ì˜ ì´ë¦„ì„ `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/`ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
2. `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default` ë‚´ì—ì„œ `node.conn[0].address` ì„¤ì •ì„ 192.168.1.2 ëŒ€ì‹  123.123.123.123ë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ë³€ê²½í•©ë‹ˆë‹¤. ì´ëŠ” `sed -i 's/192.168.1.2/123.123.123.123/g' /etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default`ì™€ ê°™ì€ ëª…ë ¹ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì œ ë§í¬ì˜ ì§€ì¹¨ì— ë”°ë¼ ëŒ€ìƒì„ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### [Windowsì—ì„œ ISCSI ë§ˆìš´íŠ¸í•˜ê¸°](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee338476\(v=ws.10\)?redirectedfrom=MSDN)

## **ìˆ˜ë™ ì—´ê±°**
```bash
sudo apt-get install open-iscsi
```
Example from [iscsiadm docs](https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm):

ë¨¼ì € IP ë’¤ì— ìˆëŠ” **ëŒ€ìƒ** ì´ë¦„ì„ **ë°œê²¬í•´ì•¼** í•©ë‹ˆë‹¤:
```bash
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
123.123.123.123:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[2a01:211:7b7:1223:211:32ff:fea9:fab9]:3260,1 iqn.2000-01.com.synology:asd3.Target-1.d0280fd382
[fe80::211:3232:fab9:1223]:3260,1 iqn.2000-01.com.synology:Oassdx.Target-1.d0280fd382
```
_ë‹¤ìŒì€ í•´ë‹¹ **ëŒ€ìƒ**ì— **ë„ë‹¬í•  ìˆ˜ ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ì˜ I**P ë° í¬íŠ¸ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤**. ì‹¬ì§€ì–´ ì‚¬ìš©í•œ ê²ƒê³¼ ë‹¤ë¥¸ **ë‚´ë¶€ IP ë˜ëŠ” ë‹¤ë¥¸ IPë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**._

ê·¸ëŸ° ë‹¤ìŒ **ê° ì¤„ì˜ ì¸ì‡„ëœ ë¬¸ìì—´ì˜ ë‘ ë²ˆì§¸ ë¶€ë¶„ì„ ì¡ê³ ** (_iqn.1992-05.com.emc:fl1001433000190000-3-vnxe_ ì²« ë²ˆì§¸ ì¤„ì—ì„œ) **ë¡œê·¸ì¸ ì‹œë„**:
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --login
Logging in to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] (multiple)
Login to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
ê·¸ëŸ° ë‹¤ìŒ `â€“logout`ì„ ì‚¬ìš©í•˜ì—¬ **ë¡œê·¸ì•„ì›ƒ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --logout
Logging out of session [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260]
Logout of [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
ìš°ë¦¬ëŠ” `--login`/`--logout` ë§¤ê°œë³€ìˆ˜ ì—†ì´ **ë” ë§ì€ ì •ë³´**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260
# BEGIN RECORD 2.0-873
node.name = iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
node.tpgt = 1
node.startup = manual
node.leading_login = No
iface.hwaddress = <empty>
iface.ipaddress = <empty>
iface.iscsi_ifacename = default
iface.net_ifacename = <empty>
iface.transport_name = tcp
iface.initiatorname = <empty>
iface.bootproto = <empty>
iface.subnet_mask = <empty>
iface.gateway = <empty>
iface.ipv6_autocfg = <empty>
iface.linklocal_autocfg = <empty>
iface.router_autocfg = <empty>
iface.ipv6_linklocal = <empty>
iface.ipv6_router = <empty>
iface.state = <empty>
iface.vlan_id = 0
iface.vlan_priority = 0
iface.vlan_state = <empty>
iface.iface_num = 0
iface.mtu = 0
iface.port = 0
node.discovery_address = 192.168.xx.xx
node.discovery_port = 3260
node.discovery_type = send_targets
node.session.initial_cmdsn = 0
node.session.initial_login_retry_max = 8
node.session.xmit_thread_priority = -20
node.session.cmds_max = 128
node.session.queue_depth = 32
node.session.nr_sessions = 1
node.session.auth.authmethod = None
node.session.auth.username = <empty>
node.session.auth.password = <empty>
node.session.auth.username_in = <empty>
node.session.auth.password_in = <empty>
node.session.timeo.replacement_timeout = 120
node.session.err_timeo.abort_timeout = 15
node.session.err_timeo.lu_reset_timeout = 30
node.session.err_timeo.tgt_reset_timeout = 30
node.session.err_timeo.host_reset_timeout = 60
node.session.iscsi.FastAbort = Yes
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
node.session.iscsi.FirstBurstLength = 262144
node.session.iscsi.MaxBurstLength = 16776192
node.session.iscsi.DefaultTime2Retain = 0
node.session.iscsi.DefaultTime2Wait = 2
node.session.iscsi.MaxConnections = 1
node.session.iscsi.MaxOutstandingR2T = 1
node.session.iscsi.ERL = 0
node.conn[0].address = 192.168.xx.xx
node.conn[0].port = 3260
node.conn[0].startup = manual
node.conn[0].tcp.window_size = 524288
node.conn[0].tcp.type_of_service = 0
node.conn[0].timeo.logout_timeout = 15
node.conn[0].timeo.login_timeout = 15
node.conn[0].timeo.auth_timeout = 45
node.conn[0].timeo.noop_out_interval = 5
node.conn[0].timeo.noop_out_timeout = 5
node.conn[0].iscsi.MaxXmitDataSegmentLength = 0
node.conn[0].iscsi.MaxRecvDataSegmentLength = 262144
node.conn[0].iscsi.HeaderDigest = None
node.conn[0].iscsi.DataDigest = None
node.conn[0].iscsi.IFMarker = No
node.conn[0].iscsi.OFMarker = No
# END RECORD
```
**ê¸°ë³¸ ì„œë¸Œë„· ì—´ê±° í”„ë¡œì„¸ìŠ¤ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ëŠ”** [**iscsiadm**](https://github.com/bitvijays/Pentest-Scripts/tree/master/Vulnerability\_Analysis/isciadm) **ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

## **Shodan**

* `port:3260 AuthMethod`

## **References**

* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm](https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
