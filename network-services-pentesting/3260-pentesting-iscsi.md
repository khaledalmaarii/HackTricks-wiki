# 3260 - ISCSIæ¸—é€æµ‹è¯•

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTsæ”¶è—å“](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

æ¥è‡ª[Wikipedia](https://en.wikipedia.org/wiki/ISCSI)ï¼š

> åœ¨è®¡ç®—æœºé¢†åŸŸï¼Œ**iSCSI**æ˜¯**Internet Small Computer Systems Interface**çš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§åŸºäºInternetåè®®ï¼ˆIPï¼‰çš„å­˜å‚¨ç½‘ç»œæ ‡å‡†ï¼Œç”¨äºè¿æ¥æ•°æ®å­˜å‚¨è®¾å¤‡ã€‚å®ƒé€šè¿‡åœ¨TCP/IPç½‘ç»œä¸Šä¼ è¾“SCSIå‘½ä»¤æ¥æä¾›å¯¹å­˜å‚¨è®¾å¤‡çš„å—çº§è®¿é—®ã€‚iSCSIç”¨äºåœ¨ä¼ä¸šå†…éƒ¨è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå¹¶ç”¨äºè¿œè·ç¦»ç®¡ç†å­˜å‚¨ã€‚å®ƒå¯ç”¨äºåœ¨å±€åŸŸç½‘ï¼ˆLANï¼‰ã€å¹¿åŸŸç½‘ï¼ˆWANï¼‰æˆ–äº’è”ç½‘ä¸Šä¼ è¾“æ•°æ®ï¼Œå¹¶å¯å®ç°ç‹¬ç«‹äºä½ç½®çš„æ•°æ®å­˜å‚¨å’Œæ£€ç´¢ã€‚
>
> è¯¥åè®®å…è®¸å®¢æˆ·ç«¯ï¼ˆç§°ä¸ºå‘èµ·è€…ï¼‰å‘è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å­˜å‚¨è®¾å¤‡ï¼ˆç›®æ ‡ï¼‰å‘é€SCSIå‘½ä»¤ï¼ˆCDBsï¼‰ã€‚å®ƒæ˜¯ä¸€ç§å­˜å‚¨åŒºåŸŸç½‘ç»œï¼ˆSANï¼‰åè®®ï¼Œå…è®¸ç»„ç»‡å°†å­˜å‚¨åˆå¹¶åˆ°å­˜å‚¨é˜µåˆ—ä¸­ï¼ŒåŒæ—¶ä¸ºå®¢æˆ·ç«¯ï¼ˆå¦‚æ•°æ®åº“å’ŒWebæœåŠ¡å™¨ï¼‰æä¾›æœ¬åœ°è¿æ¥çš„SCSIç£ç›˜çš„é”™è§‰ã€‚å®ƒä¸»è¦ä¸å…‰çº¤é€šé“ç«äº‰ï¼Œä½†ä¸é€šå¸¸éœ€è¦ä¸“ç”¨å¸ƒçº¿çš„ä¼ ç»Ÿå…‰çº¤é€šé“ä¸åŒï¼ŒiSCSIå¯ä»¥é€šè¿‡ç°æœ‰ç½‘ç»œåŸºç¡€è®¾æ–½åœ¨é•¿è·ç¦»ä¸Šè¿è¡Œã€‚ 

**é»˜è®¤ç«¯å£ï¼š** 3260
```
PORT     STATE SERVICE VERSION
3260/tcp open  iscsi?
```
## æšä¸¾
```
nmap -sV --script=iscsi-info -p 3260 192.168.xx.xx
```
è¿™ä¸ªè„šæœ¬å°†æŒ‡ç¤ºæ˜¯å¦éœ€è¦èº«ä»½éªŒè¯ã€‚

### [æš´åŠ›ç ´è§£](../generic-methodologies-and-resources/brute-force.md#iscsi)

### [åœ¨Linuxä¸ŠæŒ‚è½½ISCSI](https://www.synology.com/en-us/knowledgebase/DSM/tutorial/Virtualization/How\_to\_set\_up\_and\_use\_iSCSI\_target\_on\_Linux)

**æ³¨æ„ï¼š** å½“æ‚¨çš„ç›®æ ‡è¢«å‘ç°æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°å®ƒä»¬åˆ—åœ¨ä¸åŒçš„IPåœ°å€ä¸‹ã€‚å¦‚æœiSCSIæœåŠ¡é€šè¿‡NATæˆ–è™šæ‹ŸIPå…¬å¼€ï¼Œåˆ™å¾€å¾€ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`iscsiadmin` å°†æ— æ³•è¿æ¥ã€‚è¿™éœ€è¦ä¸¤ä¸ªè°ƒæ•´ï¼šä¸€ä¸ªæ˜¯æ ¹æ®æ‚¨çš„å‘ç°æ´»åŠ¨è‡ªåŠ¨åˆ›å»ºçš„èŠ‚ç‚¹ç›®å½•åç§°ï¼Œå¦ä¸€ä¸ªæ˜¯è¯¥ç›®å½•ä¸­åŒ…å«çš„ `default` æ–‡ä»¶ã€‚

ä¾‹å¦‚ï¼Œæ‚¨æ­£åœ¨å°è¯•è¿æ¥åˆ°ä½äº123.123.123.123ç«¯å£3260çš„iSCSIç›®æ ‡ã€‚å…¬å¼€iSCSIç›®æ ‡çš„æœåŠ¡å™¨å®é™…ä¸Šä½äº192.168.1.2ï¼Œä½†é€šè¿‡NATå…¬å¼€ã€‚isciadmå°†æ³¨å†Œ_å†…éƒ¨_åœ°å€è€Œä¸æ˜¯_å…¬å…±_åœ°å€ï¼š
```
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
192.168.1.2:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[...]
```
è¿™ä¸ªå‘½ä»¤å°†åœ¨ä½ çš„æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„ç›®å½•ï¼š
```
/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/
```
åœ¨ç›®å½•ä¸­ï¼Œæœ‰ä¸€ä¸ªé»˜è®¤æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«è¿æ¥åˆ°ç›®æ ‡æ‰€éœ€çš„æ‰€æœ‰è®¾ç½®ã€‚

1. å°†`/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/`é‡å‘½åä¸º`/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/`
2. åœ¨`/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default`ä¸­ï¼Œå°†`node.conn[0].address`è®¾ç½®æ›´æ”¹ä¸ºæŒ‡å‘123.123.123.123è€Œä¸æ˜¯192.168.1.2ã€‚å¯ä»¥ä½¿ç”¨ç±»ä¼¼`sed -i 's/192.168.1.2/123.123.123.123/g' /etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default`çš„å‘½ä»¤æ¥å®Œæˆæ­¤æ“ä½œã€‚

ç°åœ¨ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§é“¾æ¥ä¸­çš„è¯´æ˜æŒ‚è½½ç›®æ ‡ã€‚

### [åœ¨Windowsä¸ŠæŒ‚è½½ ISCSI](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee338476\(v=ws.10\)?redirectedfrom=MSDN)

## **æ‰‹åŠ¨æšä¸¾**
```bash
sudo apt-get install open-iscsi
```
æ¥è‡ª[iscsiadmæ–‡æ¡£](https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm)ï¼š

é¦–å…ˆï¼Œæ‚¨éœ€è¦**å‘ç°**IPåœ°å€åé¢çš„ç›®æ ‡åç§°ï¼š
```bash
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
123.123.123.123:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[2a01:211:7b7:1223:211:32ff:fea9:fab9]:3260,1 iqn.2000-01.com.synology:asd3.Target-1.d0280fd382
[fe80::211:3232:fab9:1223]:3260,1 iqn.2000-01.com.synology:Oassdx.Target-1.d0280fd382
```
æ³¨æ„ï¼Œå®ƒä¼šæ˜¾ç¤ºæ‚¨å¯ä»¥è®¿é—®è¿™äº›ç›®æ ‡çš„æ¥å£çš„IPå’Œç«¯å£ã€‚å®ƒç”šè‡³å¯ä»¥æ˜¾ç¤ºå†…éƒ¨IPæˆ–ä¸æ‚¨ä½¿ç”¨çš„IPä¸åŒçš„IPã€‚

ç„¶åï¼Œæ‚¨æ•è·æ¯è¡Œæ‰“å°å­—ç¬¦ä¸²çš„ç¬¬äºŒéƒ¨åˆ†ï¼ˆä»ç¬¬ä¸€è¡Œçš„_iqn.1992-05.com.emc:fl1001433000190000-3-vnxe_å¼€å§‹ï¼‰ï¼Œå¹¶å°è¯•ç™»å½•ï¼š
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --login
Logging in to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] (multiple)
Login to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `â€“logout` è¿›è¡Œ**æ³¨é”€**
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --logout
Logging out of session [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260]
Logout of [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…ä½¿ç”¨ä»»ä½•`--login`/`--logout`å‚æ•°æ¥æ‰¾åˆ°æ›´å¤šå…³äºå®ƒçš„ä¿¡æ¯ã€‚
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260
# BEGIN RECORD 2.0-873
node.name = iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
node.tpgt = 1
node.startup = manual
node.leading_login = No
iface.hwaddress = <empty>
iface.ipaddress = <empty>
iface.iscsi_ifacename = default
iface.net_ifacename = <empty>
iface.transport_name = tcp
iface.initiatorname = <empty>
iface.bootproto = <empty>
iface.subnet_mask = <empty>
iface.gateway = <empty>
iface.ipv6_autocfg = <empty>
iface.linklocal_autocfg = <empty>
iface.router_autocfg = <empty>
iface.ipv6_linklocal = <empty>
iface.ipv6_router = <empty>
iface.state = <empty>
iface.vlan_id = 0
iface.vlan_priority = 0
iface.vlan_state = <empty>
iface.iface_num = 0
iface.mtu = 0
iface.port = 0
node.discovery_address = 192.168.xx.xx
node.discovery_port = 3260
node.discovery_type = send_targets
node.session.initial_cmdsn = 0
node.session.initial_login_retry_max = 8
node.session.xmit_thread_priority = -20
node.session.cmds_max = 128
node.session.queue_depth = 32
node.session.nr_sessions = 1
node.session.auth.authmethod = None
node.session.auth.username = <empty>
node.session.auth.password = <empty>
node.session.auth.username_in = <empty>
node.session.auth.password_in = <empty>
node.session.timeo.replacement_timeout = 120
node.session.err_timeo.abort_timeout = 15
node.session.err_timeo.lu_reset_timeout = 30
node.session.err_timeo.tgt_reset_timeout = 30
node.session.err_timeo.host_reset_timeout = 60
node.session.iscsi.FastAbort = Yes
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
node.session.iscsi.FirstBurstLength = 262144
node.session.iscsi.MaxBurstLength = 16776192
node.session.iscsi.DefaultTime2Retain = 0
node.session.iscsi.DefaultTime2Wait = 2
node.session.iscsi.MaxConnections = 1
node.session.iscsi.MaxOutstandingR2T = 1
node.session.iscsi.ERL = 0
node.conn[0].address = 192.168.xx.xx
node.conn[0].port = 3260
node.conn[0].startup = manual
node.conn[0].tcp.window_size = 524288
node.conn[0].tcp.type_of_service = 0
node.conn[0].timeo.logout_timeout = 15
node.conn[0].timeo.login_timeout = 15
node.conn[0].timeo.auth_timeout = 45
node.conn[0].timeo.noop_out_interval = 5
node.conn[0].timeo.noop_out_timeout = 5
node.conn[0].iscsi.MaxXmitDataSegmentLength = 0
node.conn[0].iscsi.MaxRecvDataSegmentLength = 262144
node.conn[0].iscsi.HeaderDigest = None
node.conn[0].iscsi.DataDigest = None
node.conn[0].iscsi.IFMarker = No
node.conn[0].iscsi.OFMarker = No
# END RECORD
```
**æœ‰ä¸€ä¸ªç”¨äºè‡ªåŠ¨åŒ–åŸºæœ¬å­ç½‘æšä¸¾è¿‡ç¨‹çš„è„šæœ¬å¯åœ¨** [**iscsiadm**](https://github.com/bitvijays/Pentest-Scripts/tree/master/Vulnerability\_Analysis/isciadm) **æ‰¾åˆ°**

## **Shodan**

* `port:3260 AuthMethod`

## **å‚è€ƒèµ„æ–™**

* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm](https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
