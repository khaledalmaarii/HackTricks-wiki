# 3260 - ISCSI æ¸—é€æµ‹è¯•

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸Š**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud)æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## åŸºæœ¬ä¿¡æ¯

> åœ¨è®¡ç®—æœºé¢†åŸŸï¼Œ**iSCSI** æ˜¯ **Internet Small Computer Systems Interface** çš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºäº’è”ç½‘åè®®ï¼ˆIPï¼‰çš„å­˜å‚¨ç½‘ç»œæ ‡å‡†ï¼Œç”¨äºè¿æ¥æ•°æ®å­˜å‚¨è®¾å¤‡ã€‚å®ƒé€šè¿‡åœ¨ TCP/IP ç½‘ç»œä¸Šä¼ è¾“ SCSI å‘½ä»¤ï¼Œæä¾›å¯¹å­˜å‚¨è®¾å¤‡çš„å—çº§è®¿é—®ã€‚iSCSI ç”¨äºåœ¨ä¼ä¸šå†…éƒ¨ä¼ è¾“æ•°æ®ï¼Œå¹¶åœ¨è¿œè·ç¦»ç®¡ç†å­˜å‚¨ã€‚å®ƒå¯ä»¥ç”¨äºåœ¨å±€åŸŸç½‘ï¼ˆLANï¼‰ã€å¹¿åŸŸç½‘ï¼ˆWANï¼‰æˆ–äº’è”ç½‘ä¸Šä¼ è¾“æ•°æ®ï¼Œå¹¶å®ç°ä½ç½®æ— å…³çš„æ•°æ®å­˜å‚¨å’Œæ£€ç´¢ã€‚
>
> è¯¥åè®®å…è®¸å®¢æˆ·ç«¯ï¼ˆç§°ä¸ºå‘èµ·è€…ï¼‰å‘è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å­˜å‚¨è®¾å¤‡ï¼ˆç›®æ ‡ï¼‰å‘é€ SCSI å‘½ä»¤ï¼ˆCDBsï¼‰ã€‚å®ƒæ˜¯ä¸€ç§å­˜å‚¨åŒºåŸŸç½‘ç»œï¼ˆSANï¼‰åè®®ï¼Œå…è®¸ç»„ç»‡å°†å­˜å‚¨é›†ä¸­åˆ°å­˜å‚¨é˜µåˆ—ä¸­ï¼ŒåŒæ—¶ä¸ºå®¢æˆ·ç«¯ï¼ˆå¦‚æ•°æ®åº“å’Œ Web æœåŠ¡å™¨ï¼‰æä¾›æœ¬åœ°è¿æ¥çš„ SCSI ç£ç›˜çš„é”™è§‰ã€‚å®ƒä¸»è¦ä¸å…‰çº¤é€šé“ç«äº‰ï¼Œä½†ä¸é€šå¸¸éœ€è¦ä¸“ç”¨å¸ƒçº¿çš„ä¼ ç»Ÿå…‰çº¤é€šé“ä¸åŒï¼ŒiSCSI å¯ä»¥åœ¨ç°æœ‰çš„ç½‘ç»œåŸºç¡€è®¾æ–½ä¸Šé•¿è·ç¦»è¿è¡Œã€‚

**é»˜è®¤ç«¯å£ï¼š**3260
```
PORT     STATE SERVICE VERSION
3260/tcp open  iscsi?
```
## æšä¸¾

### iSCSI Discovery

### iSCSIå‘ç°

iSCSI discovery is the process of identifying iSCSI targets on a network. There are two methods for discovering iSCSI targets: 

iSCSIå‘ç°æ˜¯è¯†åˆ«ç½‘ç»œä¸Šçš„iSCSIç›®æ ‡çš„è¿‡ç¨‹ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å‘ç°iSCSIç›®æ ‡ï¼š

1. **SendTargets**: This method involves sending an iSCSI command to a specific IP address and port number. The target responds with a list of available targets.

1. **SendTargets**ï¼šè¿™ç§æ–¹æ³•æ¶‰åŠå‘ç‰¹å®šçš„IPåœ°å€å’Œç«¯å£å·å‘é€ä¸€ä¸ªiSCSIå‘½ä»¤ã€‚ç›®æ ‡ä¼šå›å¤ä¸€ä¸ªå¯ç”¨ç›®æ ‡çš„åˆ—è¡¨ã€‚

2. **iSNS**: Internet Storage Name Service (iSNS) is a protocol that allows iSCSI initiators to discover and manage iSCSI targets. It uses a central iSNS server to maintain a database of available targets.

2. **iSNS**ï¼šInternet Storage Name Serviceï¼ˆiSNSï¼‰æ˜¯ä¸€ç§å…è®¸iSCSIåˆå§‹åŒ–ç¨‹åºå‘ç°å’Œç®¡ç†iSCSIç›®æ ‡çš„åè®®ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªä¸­å¤®iSNSæœåŠ¡å™¨æ¥ç»´æŠ¤ä¸€ä¸ªå¯ç”¨ç›®æ ‡çš„æ•°æ®åº“ã€‚

### iSCSI Target Discovery

### iSCSIç›®æ ‡å‘ç°

Once the iSCSI targets have been discovered, the next step is to determine the available LUNs (Logical Unit Numbers) on each target. This can be done using the following methods:

ä¸€æ—¦å‘ç°äº†iSCSIç›®æ ‡ï¼Œä¸‹ä¸€æ­¥æ˜¯ç¡®å®šæ¯ä¸ªç›®æ ‡ä¸Šå¯ç”¨çš„é€»è¾‘å•å…ƒå·ï¼ˆLUNsï¼‰ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥å®Œæˆï¼š

1. **iSCSI SendTargets**: This method involves sending an iSCSI command to the target IP address and port number. The target responds with a list of available LUNs.

1. **iSCSI SendTargets**ï¼šè¿™ç§æ–¹æ³•æ¶‰åŠå‘ç›®æ ‡IPåœ°å€å’Œç«¯å£å·å‘é€ä¸€ä¸ªiSCSIå‘½ä»¤ã€‚ç›®æ ‡ä¼šå›å¤ä¸€ä¸ªå¯ç”¨LUNsçš„åˆ—è¡¨ã€‚

2. **iSCSI Report LUNs**: This method involves sending an iSCSI command to the target IP address and port number. The target responds with a list of available LUNs along with their attributes.

2. **iSCSI Report LUNs**ï¼šè¿™ç§æ–¹æ³•æ¶‰åŠå‘ç›®æ ‡IPåœ°å€å’Œç«¯å£å·å‘é€ä¸€ä¸ªiSCSIå‘½ä»¤ã€‚ç›®æ ‡ä¼šå›å¤ä¸€ä¸ªå¯ç”¨LUNsåŠå…¶å±æ€§çš„åˆ—è¡¨ã€‚

### iSCSI Authentication

### iSCSIèº«ä»½éªŒè¯

iSCSI authentication is used to ensure that only authorized initiators can access the iSCSI targets. There are several methods of iSCSI authentication:

iSCSIèº«ä»½éªŒè¯ç”¨äºç¡®ä¿åªæœ‰æˆæƒçš„åˆå§‹åŒ–ç¨‹åºå¯ä»¥è®¿é—®iSCSIç›®æ ‡ã€‚æœ‰å‡ ç§iSCSIèº«ä»½éªŒè¯æ–¹æ³•ï¼š

1. **CHAP (Challenge-Handshake Authentication Protocol)**: This method involves a three-way handshake process between the initiator and the target. The initiator sends a CHAP request to the target, which responds with a CHAP challenge. The initiator then sends a CHAP response, and if it matches the target's challenge, authentication is successful.

1. **CHAPï¼ˆChallenge-Handshake Authentication Protocolï¼‰**ï¼šè¿™ç§æ–¹æ³•æ¶‰åŠåˆå§‹åŒ–ç¨‹åºå’Œç›®æ ‡ä¹‹é—´çš„ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ã€‚åˆå§‹åŒ–ç¨‹åºå‘ç›®æ ‡å‘é€ä¸€ä¸ªCHAPè¯·æ±‚ï¼Œç›®æ ‡å›å¤ä¸€ä¸ªCHAPæŒ‘æˆ˜ã€‚ç„¶ååˆå§‹åŒ–ç¨‹åºå‘é€ä¸€ä¸ªCHAPå“åº”ï¼Œå¦‚æœå®ƒä¸ç›®æ ‡çš„æŒ‘æˆ˜åŒ¹é…ï¼Œè®¤è¯æˆåŠŸã€‚

2. **Mutual CHAP**: This method is similar to CHAP, but both the initiator and the target authenticate each other using CHAP.

2. **Mutual CHAP**ï¼šè¿™ç§æ–¹æ³•ä¸CHAPç±»ä¼¼ï¼Œä½†æ˜¯åˆå§‹åŒ–ç¨‹åºå’Œç›®æ ‡éƒ½ä½¿ç”¨CHAPè¿›è¡Œç›¸äº’è®¤è¯ã€‚

3. **IKE (Internet Key Exchange)**: This method uses a pre-shared key or digital certificates to authenticate the initiator and the target.

3. **IKEï¼ˆInternet Key Exchangeï¼‰**ï¼šè¿™ç§æ–¹æ³•ä½¿ç”¨é¢„å…±äº«å¯†é’¥æˆ–æ•°å­—è¯ä¹¦æ¥å¯¹åˆå§‹åŒ–ç¨‹åºå’Œç›®æ ‡è¿›è¡Œèº«ä»½éªŒè¯ã€‚

### iSCSI Security

### iSCSIå®‰å…¨

To ensure the security of iSCSI communications, it is important to implement the following measures:

ä¸ºäº†ç¡®ä¿iSCSIé€šä¿¡çš„å®‰å…¨æ€§ï¼Œé‡è¦çš„æ˜¯è¦å®æ–½ä»¥ä¸‹æªæ–½ï¼š

1. **IPsec (Internet Protocol Security)**: IPsec can be used to encrypt and authenticate iSCSI traffic between the initiator and the target.

1. **IPsecï¼ˆInternet Protocol Securityï¼‰**ï¼šIPsecå¯ä»¥ç”¨äºåŠ å¯†å’Œè®¤è¯åˆå§‹åŒ–ç¨‹åºå’Œç›®æ ‡ä¹‹é—´çš„iSCSIæµé‡ã€‚

2. **CHAP or Mutual CHAP**: Enabling CHAP or Mutual CHAP authentication can help prevent unauthorized access to iSCSI targets.

2. **CHAPæˆ–Mutual CHAP**ï¼šå¯ç”¨CHAPæˆ–Mutual CHAPèº«ä»½éªŒè¯å¯ä»¥å¸®åŠ©é˜²æ­¢æœªç»æˆæƒè®¿é—®iSCSIç›®æ ‡ã€‚

3. **Access Control Lists (ACLs)**: Implementing ACLs can restrict access to iSCSI targets based on IP addresses or initiator IQNs (iSCSI Qualified Names).

3. **è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLsï¼‰**ï¼šå®æ–½ACLså¯ä»¥åŸºäºIPåœ°å€æˆ–åˆå§‹åŒ–ç¨‹åºIQNsï¼ˆiSCSI Qualified Namesï¼‰é™åˆ¶å¯¹iSCSIç›®æ ‡çš„è®¿é—®ã€‚

4. **Firewalls**: Configuring firewalls to allow only authorized iSCSI traffic can help protect against unauthorized access.

4. **é˜²ç«å¢™**ï¼šé…ç½®é˜²ç«å¢™åªå…è®¸æˆæƒçš„iSCSIæµé‡å¯ä»¥å¸®åŠ©é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€‚

5. **Secure Network Segmentation**: Isolating iSCSI traffic on a separate network segment can help prevent unauthorized access and reduce the attack surface.

5. **å®‰å…¨ç½‘ç»œåˆ†å‰²**ï¼šå°†iSCSIæµé‡éš”ç¦»åœ¨ä¸€ä¸ªå•ç‹¬çš„ç½‘ç»œæ®µä¸Šå¯ä»¥å¸®åŠ©é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®å¹¶å‡å°‘æ”»å‡»é¢ã€‚

### iSCSI Vulnerabilities

### iSCSIæ¼æ´

There are several vulnerabilities that can be exploited in iSCSI implementations. Some common vulnerabilities include:

iSCSIå®ç°ä¸­å­˜åœ¨ä¸€äº›å¯ä»¥è¢«åˆ©ç”¨çš„æ¼æ´ã€‚ä¸€äº›å¸¸è§çš„æ¼æ´åŒ…æ‹¬ï¼š

1. **Weak Authentication**: If weak authentication methods are used, attackers may be able to bypass authentication and gain unauthorized access to iSCSI targets.

1. **å¼±èº«ä»½éªŒè¯**ï¼šå¦‚æœä½¿ç”¨å¼±èº«ä»½éªŒè¯æ–¹æ³•ï¼Œæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯å¹¶æœªç»æˆæƒåœ°è®¿é—®iSCSIç›®æ ‡ã€‚

2. **Default Credentials**: If default credentials are not changed, attackers can easily guess or find them and gain unauthorized access.

2. **é»˜è®¤å‡­æ®**ï¼šå¦‚æœé»˜è®¤å‡­æ®æ²¡æœ‰æ›´æ”¹ï¼Œæ”»å‡»è€…å¯ä»¥è½»æ¾åœ°çŒœæµ‹æˆ–æ‰¾åˆ°å®ƒä»¬å¹¶æœªç»æˆæƒåœ°è®¿é—®ã€‚

3. **Insecure Configuration**: Misconfigurations in iSCSI implementations can lead to vulnerabilities that can be exploited by attackers.

3. **ä¸å®‰å…¨çš„é…ç½®**ï¼šiSCSIå®ç°ä¸­çš„é…ç½®é”™è¯¯å¯èƒ½å¯¼è‡´æ”»å‡»è€…å¯ä»¥åˆ©ç”¨çš„æ¼æ´ã€‚

4. **Man-in-the-Middle Attacks**: If iSCSI traffic is not properly encrypted, attackers can intercept and modify the traffic, leading to unauthorized access or data manipulation.

4. **ä¸­é—´äººæ”»å‡»**ï¼šå¦‚æœiSCSIæµé‡æ²¡æœ‰æ­£ç¡®åŠ å¯†ï¼Œæ”»å‡»è€…å¯ä»¥æ‹¦æˆªå’Œä¿®æ”¹æµé‡ï¼Œå¯¼è‡´æœªç»æˆæƒçš„è®¿é—®æˆ–æ•°æ®ç¯¡æ”¹ã€‚

5. **Denial of Service (DoS)**: Attackers can launch DoS attacks against iSCSI targets, causing them to become unavailable to legitimate users.

5. **æ‹’ç»æœåŠ¡ï¼ˆDoSï¼‰**ï¼šæ”»å‡»è€…å¯ä»¥å¯¹iSCSIç›®æ ‡å‘èµ·DoSæ”»å‡»ï¼Œå¯¼è‡´å®ƒä»¬å¯¹åˆæ³•ç”¨æˆ·ä¸å¯ç”¨ã€‚

### Countermeasures

### å¯¹ç­–

To mitigate the risks associated with iSCSI vulnerabilities, the following countermeasures can be implemented:

ä¸ºäº†å‡è½»ä¸iSCSIæ¼æ´ç›¸å…³çš„é£é™©ï¼Œå¯ä»¥å®æ–½ä»¥ä¸‹å¯¹ç­–ï¼š

1. **Strong Authentication**: Implement strong authentication methods, such as CHAP or Mutual CHAP, to ensure only authorized initiators can access iSCSI targets.

1. **å¼ºèº«ä»½éªŒè¯**ï¼šå®æ–½å¼ºèº«ä»½éªŒè¯æ–¹æ³•ï¼Œå¦‚CHAPæˆ–Mutual CHAPï¼Œä»¥ç¡®ä¿åªæœ‰æˆæƒçš„åˆå§‹åŒ–ç¨‹åºå¯ä»¥è®¿é—®iSCSIç›®æ ‡ã€‚

2. **Change Default Credentials**: Always change default credentials to unique and strong passwords to prevent unauthorized access.

2. **æ›´æ”¹é»˜è®¤å‡­æ®**ï¼šå§‹ç»ˆå°†é»˜è®¤å‡­æ®æ›´æ”¹ä¸ºå”¯ä¸€ä¸”å¼ºå¯†ç ï¼Œä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€‚

3. **Secure Configuration**: Ensure that iSCSI implementations are properly configured and follow security best practices.

3. **å®‰å…¨é…ç½®**ï¼šç¡®ä¿iSCSIå®ç°å·²æ­£ç¡®é…ç½®å¹¶éµå¾ªå®‰å…¨æœ€ä½³å®è·µã€‚

4. **Encrypt iSCSI Traffic**: Use IPsec or other encryption methods to protect iSCSI traffic from interception and modification.

4. **åŠ å¯†iSCSIæµé‡**ï¼šä½¿ç”¨IPsecæˆ–å…¶ä»–åŠ å¯†æ–¹æ³•ä¿æŠ¤iSCSIæµé‡å…å—æ‹¦æˆªå’Œä¿®æ”¹ã€‚

5. **Implement Access Controls**: Use ACLs to restrict access to iSCSI targets based on IP addresses or initiator IQNs.

5. **å®æ–½è®¿é—®æ§åˆ¶**ï¼šä½¿ç”¨ACLsæ ¹æ®IPåœ°å€æˆ–åˆå§‹åŒ–ç¨‹åºIQNsé™åˆ¶å¯¹iSCSIç›®æ ‡çš„è®¿é—®ã€‚

6. **Monitor for Anomalies**: Implement monitoring and logging mechanisms to detect and respond to any suspicious activity or unauthorized access attempts.

6. **ç›‘æ§å¼‚å¸¸æƒ…å†µ**ï¼šå®æ–½ç›‘æ§å’Œæ—¥å¿—è®°å½•æœºåˆ¶ï¼Œä»¥æ£€æµ‹å’Œå“åº”ä»»ä½•å¯ç–‘æ´»åŠ¨æˆ–æœªç»æˆæƒçš„è®¿é—®å°è¯•ã€‚

7. **Regular Updates and Patching**: Keep iSCSI implementations up to date with the latest security patches and updates to address any known vulnerabilities.

7. **å®šæœŸæ›´æ–°å’Œä¿®è¡¥**ï¼šåŠæ—¶æ›´æ–°iSCSIå®ç°çš„æœ€æ–°å®‰å…¨è¡¥ä¸å’Œæ›´æ–°ï¼Œä»¥è§£å†³å·²çŸ¥æ¼æ´ã€‚

By implementing these countermeasures, the security of iSCSI implementations can be significantly improved, reducing the risk of unauthorized access and data breaches.
```
nmap -sV --script=iscsi-info -p 3260 192.168.xx.xx
```
æ­¤è„šæœ¬å°†æŒ‡ç¤ºæ˜¯å¦éœ€è¦èº«ä»½éªŒè¯ã€‚

### [æš´åŠ›ç ´è§£](../generic-methodologies-and-resources/brute-force.md#iscsi)

### [åœ¨Linuxä¸ŠæŒ‚è½½iSCSI](https://www.synology.com/en-us/knowledgebase/DSM/tutorial/Virtualization/How\_to\_set\_up\_and\_use\_iSCSI\_target\_on\_Linux)

**æ³¨æ„ï¼š**æ‚¨å¯èƒ½ä¼šå‘ç°ï¼Œå½“æ‚¨çš„ç›®æ ‡è¢«å‘ç°æ—¶ï¼Œå®ƒä»¬ä¼šåˆ—åœ¨ä¸åŒçš„IPåœ°å€ä¸‹ã€‚å¦‚æœiSCSIæœåŠ¡é€šè¿‡NATæˆ–è™šæ‹ŸIPå…¬å¼€ï¼Œé€šå¸¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`iscsiadmin`å°†æ— æ³•è¿æ¥ã€‚è¿™éœ€è¦å¯¹ç”±æ‚¨çš„å‘ç°æ´»åŠ¨è‡ªåŠ¨åˆ›å»ºçš„èŠ‚ç‚¹çš„ç›®å½•åç§°è¿›è¡Œä¸¤ä¸ªè°ƒæ•´ï¼Œå¹¶å¯¹æ­¤ç›®å½•ä¸­åŒ…å«çš„`default`æ–‡ä»¶è¿›è¡Œä¸€ä¸ªè°ƒæ•´ã€‚

ä¾‹å¦‚ï¼Œæ‚¨æ­£åœ¨å°è¯•è¿æ¥åˆ°ä½äº123.123.123.123ç«¯å£3260çš„iSCSIç›®æ ‡ã€‚å…¬å¼€iSCSIç›®æ ‡çš„æœåŠ¡å™¨å®é™…ä¸Šä½äº192.168.1.2ï¼Œä½†é€šè¿‡NATå…¬å¼€ã€‚iscsiadmå°†æ³¨å†Œ_internal_åœ°å€è€Œä¸æ˜¯_public_åœ°å€ï¼š
```
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
192.168.1.2:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[...]
```
è¿™ä¸ªå‘½ä»¤å°†åœ¨ä½ çš„æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå°±åƒè¿™æ ·ï¼š
```
/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/
```
åœ¨ç›®å½•ä¸­ï¼Œæœ‰ä¸€ä¸ªé»˜è®¤æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«è¿æ¥åˆ°ç›®æ ‡æ‰€éœ€çš„æ‰€æœ‰è®¾ç½®ã€‚

1. å°†`/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/`é‡å‘½åä¸º`/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/`
2. åœ¨`/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default`ä¸­ï¼Œå°†`node.conn[0].address`è®¾ç½®æ›´æ”¹ä¸ºæŒ‡å‘123.123.123.123è€Œä¸æ˜¯192.168.1.2ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®Œæˆæ­¤æ“ä½œï¼š`sed -i 's/192.168.1.2/123.123.123.123/g' /etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default`

ç°åœ¨ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§é“¾æ¥ä¸­çš„è¯´æ˜æŒ‚è½½ç›®æ ‡ã€‚

### [åœ¨Windowsä¸ŠæŒ‚è½½ISCSI](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee338476\(v=ws.10\)?redirectedfrom=MSDN)

## **æ‰‹åŠ¨æšä¸¾**
```bash
sudo apt-get install open-iscsi
```
é¦–å…ˆï¼Œæ‚¨éœ€è¦å‘ç°IPåœ°å€èƒŒåçš„ç›®æ ‡åç§°ï¼š
```
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
123.123.123.123:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[2a01:211:7b7:1223:211:32ff:fea9:fab9]:3260,1 iqn.2000-01.com.synology:asd3.Target-1.d0280fd382
[fe80::211:3232:fab9:1223]:3260,1 iqn.2000-01.com.synology:Oassdx.Target-1.d0280fd382
```
_è¯·æ³¨æ„ï¼Œå®ƒå°†æ˜¾ç¤ºæ‚¨å¯ä»¥è®¿é—®è¿™äº›ç›®æ ‡çš„æ¥å£çš„IPå’Œç«¯å£ã€‚å®ƒç”šè‡³å¯ä»¥æ˜¾ç¤ºå†…éƒ¨IPæˆ–ä¸æ‚¨ä½¿ç”¨çš„IPä¸åŒçš„IPã€‚_

ç„¶åï¼Œæ‚¨**æ•è·æ¯è¡Œæ‰“å°å­—ç¬¦ä¸²çš„ç¬¬äºŒéƒ¨åˆ†**ï¼ˆä»ç¬¬ä¸€è¡Œå¼€å§‹çš„_iqn.1992-05.com.emc:fl1001433000190000-3-vnxe_ï¼‰ï¼Œå¹¶**å°è¯•ç™»å½•**ï¼š
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --login
Logging in to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] (multiple)
Login to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`â€“logout`å‘½ä»¤**æ³¨é”€**ã€‚
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --logout
Logging out of session [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260]
Logout of [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…ä½¿ç”¨ä»»ä½•`--login`/`--logout`å‚æ•°æ¥è·å–æœ‰å…³å®ƒçš„**æ›´å¤šä¿¡æ¯**ã€‚
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260
# BEGIN RECORD 2.0-873
node.name = iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
node.tpgt = 1
node.startup = manual
node.leading_login = No
iface.hwaddress = <empty>
iface.ipaddress = <empty>
iface.iscsi_ifacename = default
iface.net_ifacename = <empty>
iface.transport_name = tcp
iface.initiatorname = <empty>
iface.bootproto = <empty>
iface.subnet_mask = <empty>
iface.gateway = <empty>
iface.ipv6_autocfg = <empty>
iface.linklocal_autocfg = <empty>
iface.router_autocfg = <empty>
iface.ipv6_linklocal = <empty>
iface.ipv6_router = <empty>
iface.state = <empty>
iface.vlan_id = 0
iface.vlan_priority = 0
iface.vlan_state = <empty>
iface.iface_num = 0
iface.mtu = 0
iface.port = 0
node.discovery_address = 192.168.xx.xx
node.discovery_port = 3260
node.discovery_type = send_targets
node.session.initial_cmdsn = 0
node.session.initial_login_retry_max = 8
node.session.xmit_thread_priority = -20
node.session.cmds_max = 128
node.session.queue_depth = 32
node.session.nr_sessions = 1
node.session.auth.authmethod = None
node.session.auth.username = <empty>
node.session.auth.password = <empty>
node.session.auth.username_in = <empty>
node.session.auth.password_in = <empty>
node.session.timeo.replacement_timeout = 120
node.session.err_timeo.abort_timeout = 15
node.session.err_timeo.lu_reset_timeout = 30
node.session.err_timeo.tgt_reset_timeout = 30
node.session.err_timeo.host_reset_timeout = 60
node.session.iscsi.FastAbort = Yes
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
node.session.iscsi.FirstBurstLength = 262144
node.session.iscsi.MaxBurstLength = 16776192
node.session.iscsi.DefaultTime2Retain = 0
node.session.iscsi.DefaultTime2Wait = 2
node.session.iscsi.MaxConnections = 1
node.session.iscsi.MaxOutstandingR2T = 1
node.session.iscsi.ERL = 0
node.conn[0].address = 192.168.xx.xx
node.conn[0].port = 3260
node.conn[0].startup = manual
node.conn[0].tcp.window_size = 524288
node.conn[0].tcp.type_of_service = 0
node.conn[0].timeo.logout_timeout = 15
node.conn[0].timeo.login_timeout = 15
node.conn[0].timeo.auth_timeout = 45
node.conn[0].timeo.noop_out_interval = 5
node.conn[0].timeo.noop_out_timeout = 5
node.conn[0].iscsi.MaxXmitDataSegmentLength = 0
node.conn[0].iscsi.MaxRecvDataSegmentLength = 262144
node.conn[0].iscsi.HeaderDigest = None
node.conn[0].iscsi.DataDigest = None
node.conn[0].iscsi.IFMarker = No
node.conn[0].iscsi.OFMarker = No
# END RECORD
```
**æœ‰ä¸€ä¸ªè„šæœ¬å¯ä»¥è‡ªåŠ¨åŒ–åŸºæœ¬å­ç½‘æšä¸¾è¿‡ç¨‹ï¼Œå¯ä»¥åœ¨** [**iscsiadm**](https://github.com/bitvijays/Pentest-Scripts/tree/master/Vulnerability\_Analysis/isciadm) **æ‰¾åˆ°ã€‚**

## **Shodan**

* `port:3260 AuthMethod`

## **å‚è€ƒèµ„æ–™**

{% embed url="https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) **æˆ–**[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) **æˆ–åœ¨Twitterä¸Š**[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ä¸Šå…³æ³¨æˆ‘**ã€‚

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
