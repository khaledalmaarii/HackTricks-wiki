{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
This is a summary of the post from [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)

## Verst√§ndnis der SAProuter-Penetration mit Metasploit

SAProuter fungiert als Reverse-Proxy f√ºr SAP-Systeme, haupts√§chlich um den Zugriff zwischen dem Internet und internen SAP-Netzwerken zu steuern. Es wird h√§ufig dem Internet ausgesetzt, indem der TCP-Port 3299 durch die organisatorischen Firewalls zugelassen wird. Diese Konfiguration macht SAProuter zu einem attraktiven Ziel f√ºr Pentesting, da es als Gateway zu wertvollen internen Netzwerken dienen k√∂nnte.

**Scannen und Informationssammlung**

Zun√§chst wird ein Scan durchgef√ºhrt, um festzustellen, ob ein SAP-Router auf einer bestimmten IP-Adresse l√§uft, indem das Modul **sap_service_discovery** verwendet wird. Dieser Schritt ist entscheidend, um die Pr√§senz eines SAP-Routers und seinen offenen Port festzustellen.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
Nach der Entdeckung wird eine weitere Untersuchung der Konfiguration des SAP-Routers mit dem **sap_router_info_request**-Modul durchgef√ºhrt, um m√∂glicherweise interne Netzwerkdetails offenzulegen.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**Auflisten interner Dienste**

Mit den gewonnenen Einblicken in das interne Netzwerk wird das **sap_router_portscanner**-Modul verwendet, um interne Hosts und Dienste √ºber den SAProuter zu untersuchen, was ein tieferes Verst√§ndnis der internen Netzwerke und Dienstkonfigurationen erm√∂glicht.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
Die Flexibilit√§t dieses Moduls, spezifische SAP-Instanzen und Ports anzusprechen, macht es zu einem effektiven Werkzeug f√ºr eine detaillierte interne Netzwerkexploration.

**Erweiterte Aufz√§hlung und ACL-Abbildung**

Weiteres Scannen kann aufzeigen, wie die Access Control Lists (ACLs) auf dem SAProuter konfiguriert sind, und detaillieren, welche Verbindungen erlaubt oder blockiert sind. Diese Informationen sind entscheidend f√ºr das Verst√§ndnis von Sicherheitsrichtlinien und potenziellen Schwachstellen.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**Blind Enumeration von internen Hosts**

In Szenarien, in denen direkte Informationen vom SAProuter begrenzt sind, k√∂nnen Techniken wie die blinde Enumeration angewendet werden. Dieser Ansatz versucht, die Existenz interner Hostnamen zu erraten und zu √ºberpr√ºfen, wodurch potenzielle Ziele ohne direkte IP-Adressen offengelegt werden.

**Nutzung von Informationen f√ºr Penetrationstests**

Nachdem das Netzwerk kartiert und zug√§ngliche Dienste identifiziert wurden, k√∂nnen Penetrationstester die Proxy-Funktionen von Metasploit nutzen, um √ºber den SAProuter weiter zu erkunden und interne SAP-Dienste auszunutzen.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**Fazit**

Dieser Ansatz unterstreicht die Bedeutung sicherer SAProuter-Konfigurationen und hebt das Potenzial hervor, √ºber gezielte Penetrationstests auf interne Netzwerke zuzugreifen. Die ordnungsgem√§√üe Sicherung von SAP-Routern und das Verst√§ndnis ihrer Rolle in der Netzwerksicherheitsarchitektur sind entscheidend, um sich gegen unbefugten Zugriff zu sch√ºtzen.

F√ºr detailliertere Informationen zu Metasploit-Modulen und deren Verwendung besuchen Sie die [Datenbank von Rapid7](http://www.rapid7.com/db).


## **Referenzen**

* [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

* `port:3299 !HTTP Netzwerkpaket zu gro√ü`



{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
