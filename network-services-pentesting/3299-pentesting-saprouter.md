{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
To jest podsumowanie posta z [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)

## Zrozumienie penetracji SAProutera z Metasploit

SAProuter dziaa jako odwrotny serwer proxy dla system贸w SAP, g贸wnie w celu kontrolowania dostpu midzy internetem a wewntrznymi sieciami SAP. Jest czsto wystawiany na internet, pozwalajc na dostp do portu TCP 3299 przez zapory ogniowe organizacji. Taka konfiguracja czyni SAProutera atrakcyjnym celem dla pentestingu, poniewa偶 mo偶e su偶y jako brama do cennych wewntrznych sieci.

**Skanowanie i zbieranie informacji**

Pocztkowo przeprowadza si skanowanie, aby zidentyfikowa, czy na danym adresie IP dziaa router SAP, u偶ywajc moduu **sap_service_discovery**. Ten krok jest kluczowy dla ustalenia obecnoci routera SAP i jego otwartego portu.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
Po odkryciu przeprowadzono dalsze badania nad konfiguracj routera SAP za pomoc moduu **sap_router_info_request**, aby potencjalnie ujawni szczeg贸y wewntrznej sieci.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**Enumerowanie usug wewntrznych**

Dziki uzyskanym informacjom o wewntrznej sieci, modu **sap_router_portscanner** jest u偶ywany do badania wewntrznych host贸w i usug przez SAProuter, co pozwala na gbsze zrozumienie wewntrznych sieci i konfiguracji usug.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
Elastyczno tego moduu w celowaniu w konkretne instancje SAP i porty czyni go skutecznym narzdziem do szczeg贸owego badania wewntrznej sieci.

**Zaawansowana enumeracja i mapowanie ACL**

Dalsze skanowanie mo偶e ujawni, jak s skonfigurowane listy kontroli dostpu (ACL) na SAProuterze, szczeg贸owo opisujc, kt贸re poczenia s dozwolone lub zablokowane. Informacje te s kluczowe dla zrozumienia polityki bezpieczestwa i potencjalnych luk.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**lepe enumerowanie wewntrznych host贸w**

W scenariuszach, w kt贸rych bezporednie informacje z SAProutera s ograniczone, mo偶na zastosowa techniki takie jak lepe enumerowanie. Podejcie to pr贸buje zgadn i zweryfikowa istnienie wewntrznych nazw host贸w, ujawniajc potencjalne cele bez bezporednich adres贸w IP.

**Wykorzystanie informacji do pentestingu**

Majc zmapowan sie i zidentyfikowane dostpne usugi, testerzy penetracyjni mog wykorzysta mo偶liwoci proxy Metasploit do przejcia przez SAProuter w celu dalszego badania i eksploatacji wewntrznych usug SAP.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**Wnioski**

Podejcie to podkrela znaczenie bezpiecznych konfiguracji SAProutera i wskazuje na potencja dostpu do sieci wewntrznych poprzez ukierunkowane pentesty. Odpowiednie zabezpieczenie router贸w SAP oraz zrozumienie ich roli w architekturze bezpieczestwa sieci jest kluczowe dla ochrony przed nieautoryzowanym dostpem.

Aby uzyska bardziej szczeg贸owe informacje na temat modu贸w Metasploit i ich zastosowania, odwied藕 [baz danych Rapid7](http://www.rapid7.com/db).


## **Bibliografia**

* [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

* `port:3299 !HTTP Network packet too big`



{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
