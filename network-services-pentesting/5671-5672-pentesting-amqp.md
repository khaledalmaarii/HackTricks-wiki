# 5671,5672 - AMQP Pentesting

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Temel Bilgiler

[cloudamqp](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html)'den alÄ±nan bilgilere gÃ¶re:

> **RabbitMQ**, bir _mesaj kuyruÄŸu yazÄ±lÄ±mÄ±_ olarak da bilinen bir _mesaj aracÄ±sÄ±_ veya _kuyruk yÃ¶neticisi_ dir. BasitÃ§e sÃ¶ylemek gerekirse; uygulamalarÄ±n bir mesajÄ± veya mesajlarÄ± aktarmak iÃ§in baÄŸlandÄ±ÄŸÄ± kuyruklarÄ±n tanÄ±mlandÄ±ÄŸÄ± bir yazÄ±lÄ±mdÄ±r.\
> Bir **mesaj her tÃ¼rlÃ¼ bilgiyi iÃ§erebilir**. Ã–rneÄŸin, baÅŸka bir uygulamada (hatta baÅŸka bir sunucuda bile olabilir) baÅŸlamasÄ± gereken bir sÃ¼reÃ§ veya gÃ¶rev hakkÄ±nda bilgi iÃ§erebilir veya sadece basit bir metin mesajÄ± olabilir. Kuyruk yÃ¶neticisi yazÄ±lÄ±mÄ±, mesajlarÄ± bir alÄ±cÄ± uygulama baÄŸlandÄ±ÄŸÄ±nda ve kuyruktan bir mesaj alÄ±ndÄ±ÄŸÄ±nda depolar. AlÄ±cÄ± uygulama daha sonra mesajÄ± iÅŸler.\
TanÄ±mÄ±ndan .

**VarsayÄ±lan port**: 5672,5671
```
PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
```
AMQP (Advanced Message Queuing Protocol) hedef sistemdeki mesaj kuyruklarÄ±nÄ± yÃ¶netmek iÃ§in kullanÄ±lan bir protokoldÃ¼r. AMQP, mesajlarÄ±n gÃ¼venli ve gÃ¼venilir bir ÅŸekilde iletilmesini saÄŸlar. AMQP hedef sistemdeki mesaj kuyruklarÄ±nÄ± keÅŸfetmek iÃ§in Ã§eÅŸitli yÃ¶ntemler kullanabiliriz.

#### Port TaramasÄ±

AMQP genellikle 5671 ve 5672 numaralÄ± portlarda Ã§alÄ±ÅŸÄ±r. Bu nedenle, hedef sistemde bu portlarÄ±n aÃ§Ä±k olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek Ã¶nemlidir. Port taramasÄ± yapmak iÃ§in Ã§eÅŸitli araÃ§lar kullanabiliriz, Ã¶rneÄŸin:

- Nmap: `nmap -p 5671,5672 <hedef_ip>`
- Masscan: `masscan -p5671,5672 <hedef_ip>`

#### Banner Grabbing

AMQP sunucusunun banner bilgilerini elde etmek, hedef sistem hakkÄ±nda daha fazla bilgi edinmemizi saÄŸlar. Banner bilgileri, sunucunun sÃ¼rÃ¼mÃ¼, yapÄ±landÄ±rma ve diÄŸer Ã¶nemli bilgileri iÃ§erebilir. Banner bilgilerini elde etmek iÃ§in Ã§eÅŸitli araÃ§lar kullanabiliriz, Ã¶rneÄŸin:

- Telnet: `telnet <hedef_ip> 5672`
- Netcat: `nc <hedef_ip> 5672`

#### AMQP KeÅŸfi

AMQP sunucusunda mevcut olan mesaj kuyruklarÄ±nÄ± keÅŸfetmek iÃ§in Ã§eÅŸitli yÃ¶ntemler kullanabiliriz. Bu yÃ¶ntemler arasÄ±nda aÅŸaÄŸÄ±dakiler bulunur:

- AMQP komut satÄ±rÄ± araÃ§larÄ±: AMQP sunucusuna baÄŸlanmak ve mevcut kuyruklarÄ± listelemek iÃ§in Ã§eÅŸitli komut satÄ±rÄ± araÃ§larÄ± mevcuttur. Ã–rneÄŸin, RabbitMQ iÃ§in `rabbitmqadmin` aracÄ±nÄ± kullanabiliriz.
- AMQP istemci kÃ¼tÃ¼phaneleri: AMQP istemci kÃ¼tÃ¼phaneleri, hedef sistemdeki mesaj kuyruklarÄ±nÄ± keÅŸfetmek iÃ§in kullanÄ±labilir. Ã–rneÄŸin, Python'da `pika` kÃ¼tÃ¼phanesini kullanabiliriz.

### Otomatik

AMQP hedef sistemdeki mesaj kuyruklarÄ±nÄ± otomatik olarak keÅŸfetmek iÃ§in Ã§eÅŸitli araÃ§lar ve yÃ¶ntemler mevcuttur. Bu araÃ§lar ve yÃ¶ntemler, hedef sistemdeki AMQP sunucusuna baÄŸlanarak mevcut kuyruklarÄ± listeler.

#### AMQPScan

AMQPScan, hedef sistemdeki AMQP sunucusuna baÄŸlanarak mevcut kuyruklarÄ± listeler. AMQPScan, Python tabanlÄ± bir araÃ§tÄ±r ve kullanÄ±mÄ± oldukÃ§a basittir. AÅŸaÄŸÄ±daki komutu kullanarak AMQPScan aracÄ±nÄ± Ã§alÄ±ÅŸtÄ±rabilirsiniz:

```
python amqp_scan.py <hedef_ip>
```

#### RabbitMQ Management API

RabbitMQ Management API, RabbitMQ sunucusuna HTTP Ã¼zerinden eriÅŸim saÄŸlar ve mevcut kuyruklarÄ± listeler. API'ye eriÅŸmek iÃ§in aÅŸaÄŸÄ±daki URL'yi kullanabilirsiniz:

```
http://<hedef_ip>:15672/api/queues
```

Bu URL'ye GET isteÄŸi gÃ¶ndererek mevcut kuyruklarÄ± listeleyebilirsiniz. API, kullanÄ±cÄ± adÄ± ve ÅŸifre gerektirebilir, bu nedenle kimlik doÄŸrulama bilgilerini de saÄŸlamanÄ±z gerekebilir.

#### DiÄŸer AraÃ§lar

BunlarÄ±n yanÄ± sÄ±ra, AMQP sunucusunda mevcut kuyruklarÄ± keÅŸfetmek iÃ§in diÄŸer araÃ§lar ve yÃ¶ntemler de mevcuttur. Bu araÃ§lar ve yÃ¶ntemler, hedef sistemdeki AMQP sunucusuna baÄŸlanarak mevcut kuyruklarÄ± listeler.
```python
import amqp
#By default it uses default credentials "guest":"guest"
conn = amqp.connection.Connection(host="<IP>", port=5672, virtual_host="/")
conn.connect()
for k, v in conn.server_properties.items():
print(k, v)
```
### Otomatik

AMQP (Advanced Message Queuing Protocol), mesaj tabanlÄ± bir iletiÅŸim protokolÃ¼dÃ¼r. AMQP, mesajlarÄ±n gÃ¼venli ve gÃ¼venilir bir ÅŸekilde iletilmesini saÄŸlar. Bu protokol, birÃ§ok farklÄ± uygulama arasÄ±nda mesaj alÄ±ÅŸveriÅŸi yapmak iÃ§in kullanÄ±lÄ±r.

AMQP, birÃ§ok farklÄ± Ã¶zelliÄŸi destekler. Bu Ã¶zellikler arasÄ±nda mesajlarÄ±n gÃ¼venli bir ÅŸekilde ÅŸifrelenmesi, mesajlarÄ±n gÃ¼venilir bir ÅŸekilde iletilmesi, mesajlarÄ±n yÃ¶nlendirilmesi ve mesajlarÄ±n sÄ±ralÄ± bir ÅŸekilde teslim edilmesi bulunur.

AMQP, birÃ§ok farklÄ± uygulama tarafÄ±ndan kullanÄ±lan bir protokoldÃ¼r. Bu uygulamalar arasÄ±nda mesaj kuyruklama sistemleri, daÄŸÄ±tÄ±k sistemler ve mikro hizmetler yer alÄ±r.

AMQP, birÃ§ok farklÄ± gÃ¼venlik zafiyeti iÃ§erebilir. Bu zafiyetler arasÄ±nda kimlik doÄŸrulama eksiklikleri, yetkilendirme hatalarÄ± ve mesajlarÄ±n ÅŸifrelenmemesi bulunur. Bu zafiyetler, bir saldÄ±rganÄ±n AMQP protokolÃ¼nÃ¼ kullanarak bir sistemdeki mesajlarÄ± ele geÃ§irmesine veya deÄŸiÅŸtirmesine olanak tanÄ±r.

AMQP protokolÃ¼nÃ¼ pentest etmek iÃ§in birkaÃ§ farklÄ± yÃ¶ntem vardÄ±r. Bu yÃ¶ntemler arasÄ±nda gÃ¼venlik aÃ§Ä±klarÄ±nÄ± tespit etmek, kimlik doÄŸrulama ve yetkilendirme mekanizmalarÄ±nÄ± test etmek ve mesajlarÄ± ele geÃ§irmek veya deÄŸiÅŸtirmek yer alÄ±r. Bu yÃ¶ntemler, bir saldÄ±rganÄ±n AMQP protokolÃ¼nÃ¼ kullanarak bir sistemdeki zayÄ±f noktalarÄ± tespit etmesine ve istismar etmesine olanak tanÄ±r.
```bash
nmap -sV -Pn -n -T4 -p 5672 --script amqp-info <IP>

PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
| amqp-info:
|   capabilities:
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2013 GoPivotal, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 3.1.5
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US
```
### Brute Force

* [**AMQP ProtokolÃ¼ Brute Force**](../generic-methodologies-and-resources/brute-force.md#amqp-activemq-rabbitmq-qpid-joram-and-solace)
* [**STOMP ProtokolÃ¼ Brute Force**](../generic-methodologies-and-resources/brute-force.md#stomp-activemq-rabbitmq-hornetq-and-openmq)

## DiÄŸer RabbitMQ portlarÄ±

[https://www.rabbitmq.com/networking.html](https://www.rabbitmq.com/networking.html) adresinde **rabbitmq'nun birkaÃ§ port** kullandÄ±ÄŸÄ±nÄ± bulabilirsiniz:

* **1883, 8883**: ([MQTT istemcileri](http://mqtt.org) ve TLS ile MQTT istemcileri, [MQTT eklentisi](https://www.rabbitmq.com/mqtt.html) etkinleÅŸtirilmiÅŸse. [**MQTT'nin nasÄ±l pentest edileceÄŸi hakkÄ±nda daha fazla bilgi edinin**](1883-pentesting-mqtt-mosquitto.md).
* **4369: epmd**, RabbitMQ dÃ¼ÄŸÃ¼mleri ve CLI araÃ§larÄ± tarafÄ±ndan kullanÄ±lan bir eÅŸ keÅŸif hizmeti. [**Bu hizmetin nasÄ±l pentest edileceÄŸi hakkÄ±nda daha fazla bilgi edinin**](4369-pentesting-erlang-port-mapper-daemon-epmd.md).
* **5672, 5671**: AMQP 0-9-1 ve 1.0 istemcileri tarafÄ±ndan TLS olmadan ve TLS ile kullanÄ±lÄ±r
* **15672**: [HTTP API](https://www.rabbitmq.com/management.html) istemcileri, [yÃ¶netim arayÃ¼zÃ¼](https://www.rabbitmq.com/management.html) ve [rabbitmqadmin](https://www.rabbitmq.com/management-cli.html) (sadece [yÃ¶netim eklentisi](https://www.rabbitmq.com/management.html) etkinleÅŸtirilmiÅŸse). [**Bu hizmetin nasÄ±l pentest edileceÄŸi hakkÄ±nda daha fazla bilgi edinin**](15672-pentesting-rabbitmq-management.md).
* 15674: STOMP-over-WebSockets istemcileri (sadece [Web STOMP eklentisi](https://www.rabbitmq.com/web-stomp.html) etkinleÅŸtirilmiÅŸse)
* 15675: MQTT-over-WebSockets istemcileri (sadece [Web MQTT eklentisi](https://www.rabbitmq.com/web-mqtt.html) etkinleÅŸtirilmiÅŸse)
* 15692: Prometheus metrikleri (sadece [Prometheus eklentisi](https://www.rabbitmq.com/prometheus.html) etkinleÅŸtirilmiÅŸse)
* 25672: dÃ¼ÄŸÃ¼mler arasÄ± ve CLI araÃ§larÄ± ile iletiÅŸim iÃ§in kullanÄ±lÄ±r (Erlang daÄŸÄ±tÄ±m sunucusu portu) ve varsayÄ±lan olarak bir dinamik aralÄ±ktan (AMQP portu + 20000 olarak hesaplanan) tek bir porta tahsis edilir. Bu portlara dÄ±ÅŸ baÄŸlantÄ±lar gerÃ§ekten gerekli deÄŸilse (Ã¶rneÄŸin kÃ¼me [federasyon](https://www.rabbitmq.com/federation.html) kullanÄ±yorsa veya CLI araÃ§larÄ± alt aÄŸ dÄ±ÅŸÄ±ndaki makinelerde kullanÄ±lÄ±yorsa), bu portlar genel olarak aÃ§Ä±k olmamalÄ±dÄ±r. AyrÄ±ntÄ±lar iÃ§in [aÄŸ kÄ±lavuzuna](https://www.rabbitmq.com/networking.html) bakÄ±n. **Sadece 9 adet bu port internet Ã¼zerinde aÃ§Ä±ktÄ±r**.
* 35672-35682: CLI araÃ§larÄ± tarafÄ±ndan (Erlang daÄŸÄ±tÄ±m istemci portlarÄ±) dÃ¼ÄŸÃ¼mlerle iletiÅŸim iÃ§in kullanÄ±lÄ±r ve bir dinamik aralÄ±ktan tahsis edilir (sunucu daÄŸÄ±tÄ±m portu + 10000 ile sunucu daÄŸÄ±tÄ±m portu + 10010 arasÄ±nda hesaplanÄ±r). AyrÄ±ntÄ±lar iÃ§in [aÄŸ kÄ±lavuzuna](https://www.rabbitmq.com/networking.html) bakÄ±n.
* 61613, 61614: TLS olmadan ve TLS ile [STOMP istemcileri](https://stomp.github.io/stomp-specification-1.2.html) (sadece [STOMP eklentisi](https://www.rabbitmq.com/stomp.html) etkinleÅŸtirilmiÅŸse). Bu porta sahip olan cihaz sayÄ±sÄ± 10'dan azdÄ±r ve Ã§oÄŸunlukla DHT dÃ¼ÄŸÃ¼mleri iÃ§in UDP kullanÄ±lÄ±r.

## Shodan

* `AMQP`

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINA**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u takip edin.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
