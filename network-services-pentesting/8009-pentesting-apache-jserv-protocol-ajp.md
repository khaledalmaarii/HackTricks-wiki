# 8009 - æ¸—é€æµ‹è¯•Apache JServåè®®ï¼ˆAJPï¼‰

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProofæ˜¯æ‰€æœ‰åŠ å¯†æ¼æ´èµé‡‘çš„å®¶å›­ã€‚**

**æ— éœ€ç­‰å¾…å³å¯è·å¾—å¥–åŠ±**\
HackenProofçš„èµé‡‘åªæœ‰åœ¨å®¢æˆ·å­˜å…¥å¥–åŠ±é¢„ç®—åæ‰ä¼šå¯åŠ¨ã€‚åœ¨æ¼æ´éªŒè¯åï¼Œæ‚¨å°†è·å¾—å¥–åŠ±ã€‚

**åœ¨web3æ¸—é€æµ‹è¯•ä¸­ç§¯ç´¯ç»éªŒ**\
åŒºå—é“¾åè®®å’Œæ™ºèƒ½åˆçº¦æ˜¯æ–°çš„äº’è”ç½‘ï¼åœ¨å…¶å…´èµ·çš„æ—¥å­é‡ŒæŒæ¡web3å®‰å…¨ã€‚

**æˆä¸ºweb3é»‘å®¢ä¼ å¥‡**\
æ¯æ¬¡éªŒè¯çš„æ¼æ´éƒ½ä¼šè·å¾—å£°èª‰ç§¯åˆ†ï¼Œå¹¶å æ®æ¯å‘¨æ’è¡Œæ¦œçš„æ¦œé¦–ã€‚

[**åœ¨HackenProofä¸Šæ³¨å†Œ**](https://hackenproof.com/register)å¼€å§‹ä»æ‚¨çš„é»‘å®¢æ”»å‡»ä¸­è·åˆ©ï¼

{% embed url="https://hackenproof.com/register" %}

## åŸºæœ¬ä¿¡æ¯

æ¥æºï¼š[https://diablohorn.com/2011/10/19/8009-the-forgotten-tomcat-port/](https://diablohorn.com/2011/10/19/8009-the-forgotten-tomcat-port/)

> AJPæ˜¯ä¸€ç§ä¼ è¾“åè®®ã€‚å®ƒæ˜¯HTTPåè®®çš„ä¼˜åŒ–ç‰ˆæœ¬ï¼Œå…è®¸ç‹¬ç«‹çš„WebæœåŠ¡å™¨ï¼ˆå¦‚[Apache](http://httpd.apache.org/)ï¼‰ä¸Tomcatè¿›è¡Œé€šä¿¡ã€‚ä»å†å²ä¸Šçœ‹ï¼ŒApacheåœ¨æä¾›é™æ€å†…å®¹æ–¹é¢æ¯”Tomcatå¿«å¾—å¤šã€‚è¿™ä¸ªæƒ³æ³•æ˜¯è®©Apacheåœ¨å¯èƒ½çš„æƒ…å†µä¸‹æä¾›é™æ€å†…å®¹ï¼Œä½†å°†ä¸Tomcatç›¸å…³çš„å†…å®¹ä»£ç†åˆ°Tomcatã€‚

è¿˜æœ‰è¶£çš„æ˜¯ï¼š

> ajp13åè®®æ˜¯é¢å‘æ•°æ®åŒ…çš„ã€‚å‡ºäºæ€§èƒ½åŸå› ï¼ŒäºŒè¿›åˆ¶æ ¼å¼å¯èƒ½æ˜¯ä¸ºäº†é€‰æ‹©æ¯”æ›´æ˜“è¯»çš„çº¯æ–‡æœ¬ã€‚WebæœåŠ¡å™¨é€šè¿‡TCPè¿æ¥ä¸Servletå®¹å™¨é€šä¿¡ã€‚ä¸ºäº†å‡å°‘æ˜‚è´µçš„å¥—æ¥å­—åˆ›å»ºè¿‡ç¨‹ï¼ŒWebæœåŠ¡å™¨å°†å°è¯•ç»´æŠ¤ä¸Servletå®¹å™¨çš„æŒä¹…TCPè¿æ¥ï¼Œå¹¶é‡ç”¨è¿æ¥è¿›è¡Œå¤šä¸ªè¯·æ±‚/å“åº”å‘¨æœŸã€‚

**é»˜è®¤ç«¯å£ï¼š**8009
```
PORT     STATE SERVICE
8009/tcp open  ajp13
```
## CVE-2020-1938 ['Ghostcat'](https://www.chaitin.cn/en/ghostcat)

å¦‚æœAJPç«¯å£æš´éœ²ï¼ŒTomcatå¯èƒ½ä¼šå—åˆ°Ghostcatæ¼æ´çš„å½±å“ã€‚è¿™æ˜¯ä¸€ä¸ªä¸æ­¤é—®é¢˜é…å¥—çš„[åˆ©ç”¨å·¥å…·](https://www.exploit-db.com/exploits/48143)ã€‚

Ghostcatæ˜¯ä¸€ç§LFIæ¼æ´ï¼Œä½†å—åˆ°ä¸€å®šé™åˆ¶ï¼šåªèƒ½è·å–ç‰¹å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¯èƒ½åŒ…æ‹¬åƒ`WEB-INF/web.xml`è¿™æ ·çš„æ–‡ä»¶ï¼Œæ ¹æ®æœåŠ¡å™¨è®¾ç½®ï¼Œè¿™äº›æ–‡ä»¶å¯èƒ½ä¼šæ³„éœ²é‡è¦ä¿¡æ¯ï¼Œå¦‚Tomcatæ¥å£çš„å‡­æ®ã€‚

ä¿®å¤æ­¤é—®é¢˜çš„ç‰ˆæœ¬ä¸º9.0.31åŠä»¥ä¸Šã€8.5.51åŠä»¥ä¸Šå’Œ7.0.100åŠä»¥ä¸Šã€‚

## æšä¸¾

### è‡ªåŠ¨åŒ–æšä¸¾
```bash
nmap -sV --script ajp-auth,ajp-headers,ajp-methods,ajp-request -n -p 8009 <IP>
```
### [**æš´åŠ›ç ´è§£**](../generic-methodologies-and-resources/brute-force.md#ajp)

## AJPä»£ç†

### Apache AJPä»£ç†

å¾ˆå°‘é‡åˆ°åªæœ‰8009ç«¯å£å¼€æ”¾è€Œæ²¡æœ‰å…¶ä»–Webç«¯å£å¼€æ”¾çš„æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ç°æœ‰çš„å·¥å…·å¦‚metasploitä»ç„¶å¯ä»¥æ§åˆ¶å®ƒï¼Œæ˜¯ä¸æ˜¯å¾ˆå¥½ï¼Ÿæ­£å¦‚å¼•ç”¨ä¸­æ‰€è¿°ï¼Œæ‚¨å¯ä»¥ï¼ˆæ»¥ç”¨ï¼‰Apacheå°†è¯·æ±‚ä»£ç†åˆ°Tomcatçš„8009ç«¯å£ã€‚åœ¨å‚è€ƒèµ„æ–™ä¸­ï¼Œæ‚¨å°†æ‰¾åˆ°ä¸€ä¸ªå¾ˆå¥½çš„æŒ‡å—ï¼Œä»‹ç»äº†å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼ˆå…ˆé˜…è¯»å®ƒï¼‰ï¼Œä¸‹é¢æ˜¯æˆ‘åœ¨è‡ªå·±çš„æœºå™¨ä¸Šä½¿ç”¨çš„å‘½ä»¤çš„æ¦‚è¿°ã€‚æˆ‘çœç•¥äº†ä¸€äº›åŸå§‹æŒ‡ä»¤ï¼Œå› ä¸ºå®ƒä»¬ä¼¼ä¹ä¸æ˜¯å¿…è¦çš„ã€‚
```bash
sudo apt-get install libapache2-mod-jk
sudo vim /etc/apache2/apache2.conf # append the following line to the config
Include ajp.conf
sudo vim /etc/apache2/ajp.conf     # create the following file, change HOST to the target address
ProxyRequests Off
<Proxy *>
Order deny,allow
Deny from all
Allow from localhost
</Proxy>
ProxyPass       / ajp://HOST:8009/
ProxyPassReverse    / ajp://HOST:8009/
sudo a2enmod proxy_http
sudo a2enmod proxy_ajp
sudo systemctl restart apache2
```
ä½¿ç”¨è¿™ç§è®¾ç½®çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œä½ å¯èƒ½ä¼šé˜»æ­¢å·²ç»å­˜åœ¨çš„IDS/IPSç³»ç»Ÿï¼Œå› ä¸ºAJPåè®®æ˜¯äºŒè¿›åˆ¶çš„ï¼Œä½†æˆ‘è¿˜æ²¡æœ‰éªŒè¯è¿‡è¿™ä¸€ç‚¹ã€‚ç°åœ¨ä½ å¯ä»¥å°†ä½ çš„å¸¸è§„metasploit tomcat exploitæŒ‡å‘127.0.0.1:80å¹¶æ¥ç®¡è¯¥ç³»ç»Ÿã€‚ä»¥ä¸‹æ˜¯metasploitçš„è¾“å‡ºï¼š
```bash
msf  exploit(tomcat_mgr_deploy) > show options

Module options (exploit/multi/http/tomcat_mgr_deploy):

Name      Current Setting  Required  Description
----      ---------------  --------  -----------
PASSWORD  tomcat           no        The password for the specified username
PATH      /manager         yes       The URI path of the manager app (/deploy and /undeploy will be used)
Proxies                    no        Use a proxy chain
RHOST     localhost        yes       The target address
RPORT     80               yes       The target port
USERNAME  tomcat           no        The username to authenticate as
VHOST                      no        HTTP server virtual host
```
### Nginxåå‘ä»£ç†å’ŒAJP

[æŸ¥çœ‹DockeråŒ–ç‰ˆæœ¬](#DockeråŒ–ç‰ˆæœ¬)

å½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªå¼€æ”¾çš„AJPä»£ç†ç«¯å£ï¼ˆ8009 TCPï¼‰æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦æœ‰`ajp_module`çš„Nginxæ¥è®¿é—®â€œéšè—â€çš„Tomcatç®¡ç†å™¨ã€‚è¿™å¯ä»¥é€šè¿‡ç¼–è¯‘Nginxæºä»£ç å¹¶æ·»åŠ æ‰€éœ€çš„æ¨¡å—æ¥å®ç°ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

* ä¸‹è½½Nginxæºä»£ç 
* ä¸‹è½½æ‰€éœ€çš„æ¨¡å—
* ä½¿ç”¨`ajp_module`ç¼–è¯‘Nginxæºä»£ç ã€‚
* åˆ›å»ºä¸€ä¸ªæŒ‡å‘AJPç«¯å£çš„é…ç½®æ–‡ä»¶
```bash
# Download Nginx code
wget https://nginx.org/download/nginx-1.21.3.tar.gz
tar -xzvf nginx-1.21.3.tar.gz

# Compile Nginx source code with the ajp module
git clone https://github.com/dvershinin/nginx_ajp_module.git
cd nginx-1.21.3
sudo apt install libpcre3-dev
./configure --add-module=`pwd`/../nginx_ajp_module --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules
make
sudo make install
nginx -V
```
åœ¨`/etc/nginx/conf/nginx.conf`æ–‡ä»¶ä¸­ï¼Œå°†æ•´ä¸ª`server`å—æ³¨é‡Šæ‰ï¼Œå¹¶åœ¨`http`å—å†…æ·»åŠ ä»¥ä¸‹è¡Œã€‚
```shell-session
upstream tomcats {
server <TARGET_SERVER>:8009;
keepalive 10;
}
server {
listen 80;
location / {
ajp_keep_conn on;
ajp_pass tomcats;
}
}
```
å¯åŠ¨Nginxå¹¶é€šè¿‡å‘æœ¬åœ°ä¸»æœºå‘é€cURLè¯·æ±‚æ¥æ£€æŸ¥ä¸€åˆ‡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚
```html
sudo nginx
curl http://127.0.0.1:80

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Apache Tomcat/X.X.XX</title>
<link href="favicon.ico" rel="icon" type="image/x-icon" />
<link href="favicon.ico" rel="shortcut icon" type="image/x-icon" />
<link href="tomcat.css" rel="stylesheet" type="text/css" />
</headas
<body>
<div id="wrapper">
<div id="navigation" class="curved container">
<span id="nav-home"><a href="https://tomcat.apache.org/">Home</a></span>
<span id="nav-hosts"><a href="/docs/">Documentation</a></span>
<span id="nav-config"><a href="/docs/config/">Configuration</a></span>
<span id="nav-examples"><a href="/examples/">Examples</a></span>
<span id="nav-wiki"><a href="https://wiki.apache.org/tomcat/FrontPage">Wiki</a></span>
<span id="nav-lists"><a href="https://tomcat.apache.org/lists.html">Mailing Lists</a></span>
<span id="nav-help"><a href="https://tomcat.apache.org/findhelp.html">Find Help</a></span>
<br class="separator" />
</div>
<div id="asf-box">
<h1>Apache Tomcat/X.X.XX</h1>
</div>
<div id="upper" class="curved container">
<div id="congrats" class="curved container">
<h2>If you're seeing this, you've successfully installed Tomcat. Congratulations!</h2>
<SNIP>
```
### DockeråŒ–ç‰ˆæœ¬

The Dockerized version of Apache JServ Protocol (AJP) is a convenient way to deploy and test AJP-based applications. By containerizing the AJP server, you can easily set up and tear down testing environments without the need for manual installation and configuration.

To create a Dockerized version of AJP, you can use the official Apache Tomcat Docker image as a base. Apache Tomcat is a popular Java Servlet container that supports the AJP protocol. 

Here are the steps to create a Dockerized version of AJP:

1. Create a Dockerfile with the following content:

```dockerfile
FROM tomcat:latest
EXPOSE 8009
```

2. Build the Docker image using the following command:

```bash
docker build -t ajp-server .
```

3. Run the Docker container using the following command:

```bash
docker run -d -p 8009:8009 --name ajp-container ajp-server
```

4. Verify that the AJP server is running by accessing the following URL in your browser:

```
http://localhost:8009
```

If the AJP server is running correctly, you should see the default Apache Tomcat homepage.

You can now deploy your AJP-based applications to the Dockerized AJP server and test them in a controlled environment. Remember to properly secure your AJP server by configuring authentication and access controls to prevent unauthorized access.

By using Docker, you can easily replicate and distribute your AJP testing environment, making it easier to collaborate with other team members and share your findings.
```bash
git clone https://github.com/ScribblerCoder/nginx-ajp-docker
cd nginx-ajp-docker
```
å°†`nginx.conf`ä¸­çš„`TARGET-IP`æ›¿æ¢ä¸ºAJP IPï¼Œç„¶åæ„å»ºå¹¶è¿è¡Œã€‚
``` bash
docker build . -t nginx-ajp-proxy
docker run -it --rm -p 80:80 nginx-ajp-proxy
```
## å‚è€ƒèµ„æ–™

* [https://academy.hackthebox.com/module/145/section/1295](https://academy.hackthebox.com/module/145/section/1295)

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof æ˜¯æ‰€æœ‰åŠ å¯†æ¼æ´èµé‡‘çš„å®¶å›­ã€‚**

**å³åˆ»è·å¾—å¥–åŠ±**\
HackenProof çš„èµé‡‘åªæœ‰åœ¨å®¢æˆ·å­˜å…¥å¥–åŠ±é¢„ç®—åæ‰ä¼šå¯åŠ¨ã€‚åœ¨æ¼æ´éªŒè¯åï¼Œæ‚¨å°†è·å¾—å¥–åŠ±ã€‚

**åœ¨ web3 æ¸—é€æµ‹è¯•ä¸­ç§¯ç´¯ç»éªŒ**\
åŒºå—é“¾åè®®å’Œæ™ºèƒ½åˆçº¦æ˜¯æ–°çš„äº’è”ç½‘ï¼åœ¨å…¶å…´èµ·ä¹‹æ—¶æŒæ¡ web3 å®‰å…¨ã€‚

**æˆä¸º web3 é»‘å®¢ä¼ å¥‡**\
æ¯æ¬¡éªŒè¯çš„æ¼æ´éƒ½ä¼šå¢åŠ å£°èª‰ç§¯åˆ†ï¼Œå¾æœæ¯å‘¨æ’è¡Œæ¦œçš„é¡¶ç«¯ã€‚

[**åœ¨ HackenProof ä¸Šæ³¨å†Œ**](https://hackenproof.com/register) å¹¶ä»æ‚¨çš„é»‘å®¢æ”»å‡»ä¸­è·åˆ©ï¼

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—**PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks**ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
