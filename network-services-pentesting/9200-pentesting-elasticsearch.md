# 9200 - Pentesting Elasticsearch

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬ä¿¡æ¯

Elasticsearch æ˜¯ä¸€ä¸ª **åˆ†å¸ƒå¼**ã€**å¼€æº** çš„æœç´¢å’Œåˆ†æå¼•æ“ï¼Œé€‚ç”¨äº **æ‰€æœ‰ç±»å‹çš„æ•°æ®**ã€‚å®ƒä»¥ **é€Ÿåº¦**ã€**å¯æ‰©å±•æ€§** å’Œ **ç®€å•çš„ REST API** è€Œé—»åã€‚åŸºäº Apache Luceneï¼Œå®ƒäº 2010 å¹´é¦–æ¬¡ç”± Elasticsearch N.V.ï¼ˆç°åœ¨ç§°ä¸º Elasticï¼‰å‘å¸ƒã€‚Elasticsearch æ˜¯ Elastic Stack çš„æ ¸å¿ƒç»„ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºæ•°æ®æ‘„å–ã€ä¸°å¯Œã€å­˜å‚¨ã€åˆ†æå’Œå¯è§†åŒ–çš„å¼€æºå·¥å…·é›†åˆã€‚è¿™ä¸ªå †æ ˆé€šå¸¸è¢«ç§°ä¸º ELK Stackï¼Œè¿˜åŒ…æ‹¬ Logstash å’Œ Kibanaï¼Œç°åœ¨è¿˜æœ‰ç§°ä¸º Beats çš„è½»é‡çº§æ•°æ®ä¼ è¾“ä»£ç†ã€‚

### ä»€ä¹ˆæ˜¯ Elasticsearch ç´¢å¼•ï¼Ÿ

Elasticsearch **ç´¢å¼•** æ˜¯ä¸€ç»„ **ç›¸å…³æ–‡æ¡£**ï¼Œä»¥ **JSON** æ ¼å¼å­˜å‚¨ã€‚æ¯ä¸ªæ–‡æ¡£ç”± **é”®** å’Œç›¸åº”çš„ **å€¼**ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ã€æ—¥æœŸã€æ•°ç»„ã€åœ°ç†ä½ç½®ç­‰ï¼‰ç»„æˆã€‚

Elasticsearch ä½¿ç”¨ä¸€ç§ç§°ä¸º **å€’æ’ç´¢å¼•** çš„é«˜æ•ˆæ•°æ®ç»“æ„æ¥ä¿ƒè¿›å¿«é€Ÿçš„å…¨æ–‡æœç´¢ã€‚è¯¥ç´¢å¼•åˆ—å‡ºäº†æ–‡æ¡£ä¸­çš„æ¯ä¸ªå”¯ä¸€å•è¯ï¼Œå¹¶è¯†åˆ«æ¯ä¸ªå•è¯å‡ºç°çš„æ–‡æ¡£ã€‚

åœ¨ç´¢å¼•è¿‡ç¨‹ä¸­ï¼ŒElasticsearch å­˜å‚¨æ–‡æ¡£å¹¶æ„å»ºå€’æ’ç´¢å¼•ï¼Œä»è€Œå®ç°è¿‘å®æ—¶æœç´¢ã€‚**ç´¢å¼• API** ç”¨äºåœ¨ç‰¹å®šç´¢å¼•ä¸­æ·»åŠ æˆ–æ›´æ–° JSON æ–‡æ¡£ã€‚

**é»˜è®¤ç«¯å£**ï¼š9200/tcp

## æ‰‹åŠ¨æšä¸¾

### æ¨ªå¹…

ç”¨äºè®¿é—® Elasticsearch çš„åè®®æ˜¯ **HTTP**ã€‚å½“æ‚¨é€šè¿‡ HTTP è®¿é—®æ—¶ï¼Œæ‚¨ä¼šå‘ç°ä¸€äº›æœ‰è¶£çš„ä¿¡æ¯ï¼š`http://10.10.10.115:9200/`

![](<../.gitbook/assets/image (294).png>)

å¦‚æœæ‚¨åœ¨è®¿é—® `/` æ—¶æ²¡æœ‰çœ‹åˆ°è¯¥å“åº”ï¼Œè¯·å‚è§ä»¥ä¸‹éƒ¨åˆ†ã€‚

### è®¤è¯

**é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearch æ²¡æœ‰å¯ç”¨è®¤è¯**ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åœ¨ä¸ä½¿ç”¨ä»»ä½•å‡­æ®çš„æƒ…å†µä¸‹è®¿é—®æ•°æ®åº“ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚

æ‚¨å¯ä»¥é€šè¿‡è¯·æ±‚æ¥éªŒè¯è®¤è¯æ˜¯å¦å·²ç¦ç”¨ï¼š
```bash
curl -X GET "ELASTICSEARCH-SERVER:9200/_xpack/security/user"
{"error":{"root_cause":[{"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."}],"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."},"status":500}
```
**ç„¶è€Œ**ï¼Œå¦‚æœä½ å‘ `/` å‘é€è¯·æ±‚å¹¶æ”¶åˆ°å¦‚ä¸‹å“åº”ï¼š
```bash
{"error":{"root_cause":[{"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}}],"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}},"status":401}
```
è¿™æ„å‘³ç€èº«ä»½éªŒè¯å·²é…ç½®ï¼Œ**æ‚¨éœ€è¦æœ‰æ•ˆçš„å‡­æ®**æ‰èƒ½ä»elasticsearchè·å–ä»»ä½•ä¿¡æ¯ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥[**å°è¯•æš´åŠ›ç ´è§£**](../generic-methodologies-and-resources/brute-force.md#elasticsearch)ï¼ˆå®ƒä½¿ç”¨HTTPåŸºæœ¬èº«ä»½éªŒè¯ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä»»ä½•å¯ä»¥æš´åŠ›ç ´è§£HTTPåŸºæœ¬èº«ä»½éªŒè¯çš„å·¥å…·ï¼‰ã€‚\
è¿™é‡Œæœ‰ä¸€ä¸ª**é»˜è®¤ç”¨æˆ·ååˆ—è¡¨**ï¼š_**elastic**ï¼ˆè¶…çº§ç”¨æˆ·ï¼‰ï¼Œremote\_monitoring\_userï¼Œbeats\_systemï¼Œlogstash\_systemï¼Œkibanaï¼Œkibana\_systemï¼Œapm\_systemï¼Œ_ \_anonymous\_ã€‚_ Elasticsearchçš„æ—§ç‰ˆæœ¬å¯¹è¯¥ç”¨æˆ·çš„é»˜è®¤å¯†ç æ˜¯**changeme**ã€‚
```
curl -X GET http://user:password@IP:9200/
```
### åŸºæœ¬ç”¨æˆ·æšä¸¾
```bash
#List all roles on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/role"

#List all users on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user"

#Get more information about the rights of an user:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user/<USERNAME>"
```
### Elastic Info

è¿™é‡Œæœ‰ä¸€äº›ä½ å¯ä»¥é€šè¿‡ **GET** è®¿é—®çš„ç«¯ç‚¹ï¼Œä»¥ **è·å–** æœ‰å…³ elasticsearch çš„ä¸€äº› **ä¿¡æ¯**ï¼š

| \_cat                           | /\_cluster                    | /\_security               |
| ------------------------------- | ----------------------------- | ------------------------- |
| /\_cat/segments                 | /\_cluster/allocation/explain | /\_security/user          |
| /\_cat/shards                   | /\_cluster/settings           | /\_security/privilege     |
| /\_cat/repositories             | /\_cluster/health             | /\_security/role\_mapping |
| /\_cat/recovery                 | /\_cluster/state              | /\_security/role          |
| /\_cat/plugins                  | /\_cluster/stats              | /\_security/api\_key      |
| /\_cat/pending\_tasks           | /\_cluster/pending\_tasks     |                           |
| /\_cat/nodes                    | /\_nodes                      |                           |
| /\_cat/tasks                    | /\_nodes/usage                |                           |
| /\_cat/templates                | /\_nodes/hot\_threads         |                           |
| /\_cat/thread\_pool             | /\_nodes/stats                |                           |
| /\_cat/ml/trained\_models       | /\_tasks                      |                           |
| /\_cat/transforms/\_all         | /\_remote/info                |                           |
| /\_cat/aliases                  |                               |                           |
| /\_cat/allocation               |                               |                           |
| /\_cat/ml/anomaly\_detectors    |                               |                           |
| /\_cat/count                    |                               |                           |
| /\_cat/ml/data\_frame/analytics |                               |                           |
| /\_cat/ml/datafeeds             |                               |                           |
| /\_cat/fielddata                |                               |                           |
| /\_cat/health                   |                               |                           |
| /\_cat/indices                  |                               |                           |
| /\_cat/master                   |                               |                           |
| /\_cat/nodeattrs                |                               |                           |
| /\_cat/nodes                    |                               |                           |

è¿™äº›ç«¯ç‚¹æ˜¯ [**å–è‡ªæ–‡æ¡£**](https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html)ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œ **æ‰¾åˆ°æ›´å¤š**ã€‚\
æ­¤å¤–ï¼Œå¦‚æœä½ è®¿é—® `/_cat`ï¼Œå“åº”å°†åŒ…å«å®ä¾‹æ”¯æŒçš„ `/_cat/*` ç«¯ç‚¹ã€‚

åœ¨ `/_security/user`ï¼ˆå¦‚æœå¯ç”¨äº†èº«ä»½éªŒè¯ï¼‰ï¼Œä½ å¯ä»¥çœ‹åˆ°å“ªä¸ªç”¨æˆ·å…·æœ‰ `superuser` è§’è‰²ã€‚

### Indices

ä½ å¯ä»¥é€šè¿‡è®¿é—® `http://10.10.10.115:9200/_cat/indices?v` **æ”¶é›†æ‰€æœ‰ç´¢å¼•**ã€‚
```
health status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   .kibana 6tjAYZrgQ5CwwR0g6VOoRg   1   0          1            0        4kb            4kb
yellow open   quotes  ZG2D1IqkQNiNZmi2HRImnQ   5   1        253            0    262.7kb        262.7kb
yellow open   bank    eSVpNfCfREyYoVigNWcrMw   5   1       1000            0    483.2kb        483.2kb
```
è¦è·å–**æœ‰å…³ç´¢å¼•ä¸­ä¿å­˜çš„æ•°æ®ç±»å‹çš„ä¿¡æ¯**ï¼Œæ‚¨å¯ä»¥è®¿é—®ï¼š`http://host:9200/<index>`ï¼Œä¾‹å¦‚åœ¨è¿™ç§æƒ…å†µä¸‹`http://10.10.10.115:9200/bank`

![](<../.gitbook/assets/image (342).png>)

### è½¬å‚¨ç´¢å¼•

å¦‚æœæ‚¨æƒ³**è½¬å‚¨ç´¢å¼•çš„æ‰€æœ‰å†…å®¹**ï¼Œå¯ä»¥è®¿é—®ï¼š`http://host:9200/<index>/_search?pretty=true`ï¼Œä¾‹å¦‚`http://10.10.10.115:9200/bank/_search?pretty=true`

![](<../.gitbook/assets/image (914).png>)

_èŠ±ç‚¹æ—¶é—´æ¯”è¾ƒé“¶è¡Œç´¢å¼•ä¸­æ¯ä¸ªæ–‡æ¡£ï¼ˆæ¡ç›®ï¼‰çš„å†…å®¹ä»¥åŠæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­çœ‹åˆ°çš„è¯¥ç´¢å¼•çš„å­—æ®µã€‚_

æ‰€ä»¥ï¼Œæ­¤æ—¶æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°**åœ¨â€œhitsâ€ä¸­æœ‰ä¸€ä¸ªåä¸ºâ€œtotalâ€çš„å­—æ®µ**ï¼Œå®ƒè¡¨ç¤º**åœ¨æ­¤ç´¢å¼•ä¸­æ‰¾åˆ°äº†1000ä¸ªæ–‡æ¡£**ï¼Œä½†ä»…æ£€ç´¢äº†10ä¸ªã€‚è¿™æ˜¯å› ä¸º**é»˜è®¤æƒ…å†µä¸‹é™åˆ¶ä¸º10ä¸ªæ–‡æ¡£**ã€‚\
ä½†æ˜¯ï¼Œç°åœ¨æ‚¨çŸ¥é“**æ­¤ç´¢å¼•åŒ…å«1000ä¸ªæ–‡æ¡£**ï¼Œæ‚¨å¯ä»¥**è½¬å‚¨æ‰€æœ‰æ–‡æ¡£**ï¼Œåœ¨**`size`**å‚æ•°ä¸­æŒ‡æ˜è¦è½¬å‚¨çš„æ¡ç›®æ•°ï¼š`http://10.10.10.115:9200/quotes/_search?pretty=true&size=1000`asd\
_æ³¨æ„ï¼šå¦‚æœæ‚¨æŒ‡æ˜æ›´å¤§çš„æ•°å­—ï¼Œæ‰€æœ‰æ¡ç›®ä»ç„¶ä¼šè¢«è½¬å‚¨ï¼Œä¾‹å¦‚æ‚¨å¯ä»¥æŒ‡æ˜`size=9999`ï¼Œå¦‚æœæœ‰æ›´å¤šæ¡ç›®ä¼šå¾ˆå¥‡æ€ªï¼ˆä½†æ‚¨åº”è¯¥æ£€æŸ¥ï¼‰ã€‚_

### è½¬å‚¨æ‰€æœ‰

ä¸ºäº†è½¬å‚¨æ‰€æœ‰å†…å®¹ï¼Œæ‚¨åªéœ€è®¿é—®**ä¸ä¹‹å‰ç›¸åŒçš„è·¯å¾„ï¼Œä½†ä¸æŒ‡æ˜ä»»ä½•ç´¢å¼•**`http://host:9200/_search?pretty=true`ï¼Œä¾‹å¦‚`http://10.10.10.115:9200/_search?pretty=true`\
è¯·è®°ä½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å°†åº”ç”¨**é»˜è®¤çš„10**ä¸ªç»“æœé™åˆ¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`size`å‚æ•°è½¬å‚¨**æ›´å¤šç»“æœ**ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»ä¸Šä¸€èŠ‚ã€‚

### æœç´¢

å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾æŸäº›ä¿¡æ¯ï¼Œå¯ä»¥åœ¨æ‰€æœ‰ç´¢å¼•ä¸Šè¿›è¡Œ**åŸå§‹æœç´¢**ï¼Œè®¿é—®`http://host:9200/_search?pretty=true&q=<search_term>`ï¼Œä¾‹å¦‚`http://10.10.10.115:9200/_search?pretty=true&q=Rockwell`

![](<../.gitbook/assets/image (335).png>)

å¦‚æœæ‚¨åªæƒ³**åœ¨ä¸€ä¸ªç´¢å¼•ä¸­æœç´¢**ï¼Œå¯ä»¥åœ¨**è·¯å¾„**ä¸­**æŒ‡å®š**å®ƒï¼š`http://host:9200/<index>/_search?pretty=true&q=<search_term>`

_æ³¨æ„ï¼Œqå‚æ•°ç”¨äºæœç´¢å†…å®¹**æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼**_

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ç±»ä¼¼[https://github.com/misalabs/horuz](https://github.com/misalabs/horuz)çš„å·¥å…·æ¥æ¨¡ç³Šæµ‹è¯•elasticsearchæœåŠ¡ã€‚

### å†™æƒé™

æ‚¨å¯ä»¥é€šè¿‡å°è¯•åœ¨æ–°ç´¢å¼•ä¸­åˆ›å»ºæ–°æ–‡æ¡£æ¥æ£€æŸ¥æ‚¨çš„å†™æƒé™ï¼Œè¿è¡Œç±»ä¼¼ä»¥ä¸‹å†…å®¹çš„å‘½ä»¤ï¼š
```bash
curl -X POST '10.10.10.115:9200/bookindex/books' -H 'Content-Type: application/json' -d'
{
"bookId" : "A00-3",
"author" : "Sankaran",
"publisher" : "Mcgrahill",
"name" : "how to get a job"
}'
```
è¯¥å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º `bookindex` çš„ **æ–°ç´¢å¼•**ï¼Œå…¶æ–‡æ¡£ç±»å‹ä¸º `books`ï¼Œå…·æœ‰å±æ€§ "_bookId_"ã€"_author_"ã€"_publisher_" å’Œ "_name_"ã€‚

æ³¨æ„ **æ–°ç´¢å¼•ç°åœ¨å‡ºç°åœ¨åˆ—è¡¨ä¸­**ï¼š

![](<../.gitbook/assets/image (130).png>)

å¹¶æ³¨æ„ **è‡ªåŠ¨åˆ›å»ºçš„å±æ€§**ï¼š

![](<../.gitbook/assets/image (434).png>)

## è‡ªåŠ¨æšä¸¾

ä¸€äº›å·¥å…·å°†è·å–ä¹‹å‰å‘ˆç°çš„ä¸€äº›æ•°æ®ï¼š
```bash
msf > use auxiliary/scanner/elasticsearch/indices_enum
```
{% embed url="https://github.com/theMiddleBlue/nmap-elasticsearch-nse" %}

## Shodan

* `port:9200 elasticsearch`

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
