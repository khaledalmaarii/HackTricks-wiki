# 9200 - Pentesting Elasticsearch

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Temel bilgiler

Elasticsearch, **daÄŸÄ±tÄ±k**, **aÃ§Ä±k kaynak** bir arama ve analiz motorudur ve **her tÃ¼rlÃ¼ veri** iÃ§in kullanÄ±lÄ±r. **HÄ±zÄ±**, **Ã¶lÃ§eklenebilirliÄŸi** ve **basit REST API'leri** ile bilinir. Apache Lucene Ã¼zerine inÅŸa edilmiÅŸtir ve ilk olarak 2010 yÄ±lÄ±nda Elasticsearch N.V. (ÅŸimdi Elastic olarak bilinir) tarafÄ±ndan piyasaya sÃ¼rÃ¼lmÃ¼ÅŸtÃ¼r. Elasticsearch, veri alÄ±mÄ±, zenginleÅŸtirme, depolama, analiz ve gÃ¶rselleÅŸtirme iÃ§in aÃ§Ä±k kaynak araÃ§larÄ±n bir koleksiyonu olan Elastic Stack'in temel bileÅŸenidir. Genellikle ELK Stack olarak adlandÄ±rÄ±lan bu yÄ±ÄŸÄ±n, ayrÄ±ca Logstash ve Kibana'yÄ± iÃ§erir ve ÅŸimdi Beats adÄ± verilen hafif veri taÅŸÄ±ma ajanlarÄ±na sahiptir.

### Elasticsearch indeksi nedir?

Elasticsearch **indeksi**, **JSON** olarak saklanan **iliÅŸkili belgelerin** bir koleksiyonudur. Her belge, **anahtarlar** ve bunlarÄ±n karÅŸÄ±lÄ±k gelen **deÄŸerleri** (dizeler, sayÄ±lar, booleanlar, tarihler, diziler, coÄŸrafi konumlar vb.) iÃ§erir.

Elasticsearch, hÄ±zlÄ± tam metin aramalarÄ± saÄŸlamak iÃ§in **ters indeks** adÄ± verilen verimli bir veri yapÄ±sÄ± kullanÄ±r. Bu indeks, belgelerdeki her benzersiz kelimeyi listeler ve her kelimenin gÃ¶rÃ¼ndÃ¼ÄŸÃ¼ belgeleri tanÄ±mlar.

Ä°ndeksleme sÃ¼reci sÄ±rasÄ±nda, Elasticsearch belgeleri saklar ve ters indeksi oluÅŸturur, bu da neredeyse gerÃ§ek zamanlÄ± arama yapÄ±lmasÄ±na olanak tanÄ±r. **Ä°ndeks API'si**, belirli bir indeks iÃ§inde JSON belgelerini eklemek veya gÃ¼ncellemek iÃ§in kullanÄ±lÄ±r.

**VarsayÄ±lan port**: 9200/tcp

## Manuel SayÄ±m

### Banner

Elasticsearch'e eriÅŸmek iÃ§in kullanÄ±lan protokol **HTTP**'dir. HTTP Ã¼zerinden eriÅŸtiÄŸinizde bazÄ± ilginÃ§ bilgiler bulacaksÄ±nÄ±z: `http://10.10.10.115:9200/`

![](<../.gitbook/assets/image (294).png>)

EÄŸer `/` eriÅŸirken bu yanÄ±tÄ± gÃ¶rmÃ¼yorsanÄ±z, aÅŸaÄŸÄ±daki bÃ¶lÃ¼me bakÄ±n.

### Kimlik DoÄŸrulama

**VarsayÄ±lan olarak Elasticsearch'te kimlik doÄŸrulama etkin deÄŸildir**, bu nedenle varsayÄ±lan olarak veritabanÄ±nÄ±n iÃ§indeki her ÅŸeye herhangi bir kimlik bilgisi kullanmadan eriÅŸebilirsiniz.

Kimlik doÄŸrulamanÄ±n devre dÄ±ÅŸÄ± olduÄŸunu bir istekle doÄŸrulayabilirsiniz:
```bash
curl -X GET "ELASTICSEARCH-SERVER:9200/_xpack/security/user"
{"error":{"root_cause":[{"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."}],"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."},"status":500}
```
**Ancak**, eÄŸer `/` adresine bir istek gÃ¶nderirseniz ve aÅŸaÄŸÄ±daki gibi bir yanÄ±t alÄ±rsanÄ±z:
```bash
{"error":{"root_cause":[{"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}}],"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}},"status":401}
```
Bu, kimlik doÄŸrulamanÄ±n yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ± ve **geÃ§erli kimlik bilgilerine** sahip olmanÄ±z gerektiÄŸi anlamÄ±na gelir. ArdÄ±ndan, [**bunu brute force ile denemek**](../generic-methodologies-and-resources/brute-force.md#elasticsearch) (HTTP temel kimlik doÄŸrulamasÄ± kullanÄ±r, bu nedenle BF HTTP temel kimlik doÄŸrulamasÄ± ile kullanÄ±labilecek her ÅŸey kullanÄ±labilir).\
Ä°ÅŸte bir **varsayÄ±lan kullanÄ±cÄ± adÄ± listesi**: _**elastic** (superuser), remote\_monitoring\_user, beats\_system, logstash\_system, kibana, kibana\_system, apm\_system,_ \_anonymous\_.\_ Elasticsearch'in eski sÃ¼rÃ¼mleri iÃ§in bu kullanÄ±cÄ± iÃ§in varsayÄ±lan ÅŸifre **changeme**dir.
```
curl -X GET http://user:password@IP:9200/
```
### Temel KullanÄ±cÄ± SayÄ±mÄ±
```bash
#List all roles on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/role"

#List all users on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user"

#Get more information about the rights of an user:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user/<USERNAME>"
```
### Elastic Bilgisi

Elasticsearch hakkÄ±nda bazÄ± **bilgiler** **edinmek** iÃ§in **GET** ile **eriÅŸebileceÄŸiniz** bazÄ± uÃ§ noktalar:

| \_cat                           | /\_cluster                    | /\_security               |
| ------------------------------- | ----------------------------- | ------------------------- |
| /\_cat/segments                 | /\_cluster/allocation/explain | /\_security/user          |
| /\_cat/shards                   | /\_cluster/settings           | /\_security/privilege     |
| /\_cat/repositories             | /\_cluster/health             | /\_security/role\_mapping |
| /\_cat/recovery                 | /\_cluster/state              | /\_security/role          |
| /\_cat/plugins                  | /\_cluster/stats              | /\_security/api\_key      |
| /\_cat/pending\_tasks           | /\_cluster/pending\_tasks     |                           |
| /\_cat/nodes                    | /\_nodes                      |                           |
| /\_cat/tasks                    | /\_nodes/usage                |                           |
| /\_cat/templates                | /\_nodes/hot\_threads         |                           |
| /\_cat/thread\_pool             | /\_nodes/stats                |                           |
| /\_cat/ml/trained\_models       | /\_tasks                      |                           |
| /\_cat/transforms/\_all         | /\_remote/info                |                           |
| /\_cat/aliases                  |                               |                           |
| /\_cat/allocation               |                               |                           |
| /\_cat/ml/anomaly\_detectors    |                               |                           |
| /\_cat/count                    |                               |                           |
| /\_cat/ml/data\_frame/analytics |                               |                           |
| /\_cat/ml/datafeeds             |                               |                           |
| /\_cat/fielddata                |                               |                           |
| /\_cat/health                   |                               |                           |
| /\_cat/indices                  |                               |                           |
| /\_cat/master                   |                               |                           |
| /\_cat/nodeattrs                |                               |                           |
| /\_cat/nodes                    |                               |                           |

Bu uÃ§ noktalar [**belgeden alÄ±nmÄ±ÅŸtÄ±r**](https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html) burada daha fazla **bulabilirsiniz**.\
AyrÄ±ca, `/_cat`'e eriÅŸirseniz, yanÄ±t `/_cat/*` uÃ§ noktalarÄ±nÄ± iÃ§erecektir.

`/_security/user`'da (eÄŸer kimlik doÄŸrulama etkinse) hangi kullanÄ±cÄ±nÄ±n `superuser` rolÃ¼ne sahip olduÄŸunu gÃ¶rebilirsiniz.

### Ä°ndeksler

`http://10.10.10.115:9200/_cat/indices?v` adresine eriÅŸerek **tÃ¼m indeksleri** **toplayabilirsiniz**.
```
health status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   .kibana 6tjAYZrgQ5CwwR0g6VOoRg   1   0          1            0        4kb            4kb
yellow open   quotes  ZG2D1IqkQNiNZmi2HRImnQ   5   1        253            0    262.7kb        262.7kb
yellow open   bank    eSVpNfCfREyYoVigNWcrMw   5   1       1000            0    483.2kb        483.2kb
```
**Bir indeksin iÃ§inde hangi tÃ¼r verilerin kaydedildiÄŸi hakkÄ±nda bilgi almak iÃ§in** `http://host:9200/<index>` adresine eriÅŸebilirsiniz, bu durumda Ã¶rneÄŸin `http://10.10.10.115:9200/bank`

![](<../.gitbook/assets/image (342).png>)

### Ä°ndeksi DÃ¶kme

EÄŸer bir indeksin **tÃ¼m iÃ§eriÄŸini dÃ¶kmek** istiyorsanÄ±z, `http://host:9200/<index>/_search?pretty=true` adresine eriÅŸebilirsiniz, Ã¶rneÄŸin `http://10.10.10.115:9200/bank/_search?pretty=true`

![](<../.gitbook/assets/image (914).png>)

_Bank indeksindeki her belgenin (giriÅŸin) iÃ§eriÄŸini ve Ã¶nceki bÃ¶lÃ¼mde gÃ¶rdÃ¼ÄŸÃ¼mÃ¼z bu indeksin alanlarÄ±nÄ± karÅŸÄ±laÅŸtÄ±rmak iÃ§in bir an durun._

Bu noktada, **"hits" iÃ§inde "total" adÄ±nda bir alan olduÄŸunu** fark edebilirsiniz; bu, **bu indekste 1000 belgenin bulunduÄŸunu** ancak yalnÄ±zca 10'unun geri alÄ±ndÄ±ÄŸÄ±nÄ± gÃ¶sterir. Bunun nedeni, **varsayÄ±lan olarak 10 belge sÄ±nÄ±rÄ±nÄ±n** olmasÄ±dÄ±r.\
Ama, artÄ±k **bu indeksin 1000 belge iÃ§erdiÄŸini** bildiÄŸinize gÃ¶re, **hepsini dÃ¶kebilirsiniz**; dÃ¶kmek istediÄŸiniz giriÅŸ sayÄ±sÄ±nÄ± **`size`** parametresinde belirtebilirsiniz: `http://10.10.10.115:9200/quotes/_search?pretty=true&size=1000`asd\
_Not: Daha bÃ¼yÃ¼k bir sayÄ± belirtirseniz, tÃ¼m giriÅŸler yine de dÃ¶kÃ¼lecektir; Ã¶rneÄŸin `size=9999` belirtebilirsiniz ve daha fazla giriÅŸ varsa garip olur (ama kontrol etmelisiniz)._

### Hepsini DÃ¶kme

Hepsini dÃ¶kmek iÃ§in, **Ã¶nceki yolla aynÄ± yola gidebilir ancak herhangi bir indeks belirtmeden** `http://host:9200/_search?pretty=true` adresine gidebilirsiniz, Ã¶rneÄŸin `http://10.10.10.115:9200/_search?pretty=true`\
Bu durumda **varsayÄ±lan 10** sonuÃ§ sÄ±nÄ±rÄ±nÄ±n uygulanacaÄŸÄ±nÄ± unutmayÄ±n. Daha **bÃ¼yÃ¼k bir sonuÃ§ miktarÄ±nÄ±** dÃ¶kmek iÃ§in `size` parametresini kullanabilirsiniz. Daha fazla bilgi iÃ§in Ã¶nceki bÃ¶lÃ¼mÃ¼ okuyun.

### Arama

EÄŸer bazÄ± bilgiler arÄ±yorsanÄ±z, tÃ¼m indekslerde **ham bir arama** yapmak iÃ§in `http://host:9200/_search?pretty=true&q=<search_term>` adresine gidebilirsiniz, Ã¶rneÄŸin `http://10.10.10.115:9200/_search?pretty=true&q=Rockwell`

![](<../.gitbook/assets/image (335).png>)

EÄŸer sadece bir indekste **arama yapmak** istiyorsanÄ±z, **yolu** belirterek **bunu yapabilirsiniz**: `http://host:9200/<index>/_search?pretty=true&q=<search_term>`

_K iÃ§erik aramak iÃ§in kullanÄ±lan q parametresinin **dÃ¼zenli ifadeleri desteklediÄŸini** unutmayÄ±n._

AyrÄ±ca bir elasticsearch hizmetini fuzzlamak iÃ§in [https://github.com/misalabs/horuz](https://github.com/misalabs/horuz) gibi bir ÅŸey de kullanabilirsiniz.

### Yazma Ä°zinleri

Yeni bir indekste yeni bir belge oluÅŸturmayÄ± deneyerek yazma izinlerinizi kontrol edebilirsiniz; aÅŸaÄŸÄ±daki gibi bir ÅŸey Ã§alÄ±ÅŸtÄ±rarak:
```bash
curl -X POST '10.10.10.115:9200/bookindex/books' -H 'Content-Type: application/json' -d'
{
"bookId" : "A00-3",
"author" : "Sankaran",
"publisher" : "Mcgrahill",
"name" : "how to get a job"
}'
```
O cmd, "_bookId_", "_author_", "_publisher_" ve "_name_" Ã¶zelliklerine sahip `books` tÃ¼rÃ¼nde bir belge ile `bookindex` adÄ±nda **yeni bir indeks** oluÅŸturacaktÄ±r.

**Yeni indeksin ÅŸimdi listede gÃ¶rÃ¼ndÃ¼ÄŸÃ¼ne** dikkat edin:

![](<../.gitbook/assets/image (130).png>)

Ve **otomatik olarak oluÅŸturulan Ã¶zelliklere** dikkat edin:

![](<../.gitbook/assets/image (434).png>)

## Otomatik SayÄ±m

BazÄ± araÃ§lar, daha Ã¶nce sunulan verilerden bazÄ±larÄ±nÄ± elde edecektir:
```bash
msf > use auxiliary/scanner/elasticsearch/indices_enum
```
{% embed url="https://github.com/theMiddleBlue/nmap-elasticsearch-nse" %}

## Shodan

* `port:9200 elasticsearch`

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
