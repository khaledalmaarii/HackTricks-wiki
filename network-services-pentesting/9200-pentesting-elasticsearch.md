# 9200 - Elasticsearch Pentesting

<details>

<summary><strong>AWS hackleme becerilerini sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Temel bilgiler

Elasticsearch, **tÃ¼m veri tÃ¼rleri** iÃ§in **daÄŸÄ±tÄ±k**, **aÃ§Ä±k kaynaklÄ±** bir arama ve analitik motorudur. HÄ±zÄ±, Ã¶lÃ§eklenebilirliÄŸi ve basit REST API'leri ile tanÄ±nÄ±r. Apache Lucene Ã¼zerine inÅŸa edilen Elasticsearch, ilk olarak 2010 yÄ±lÄ±nda Elasticsearch N.V. (ÅŸimdi Elastic olarak bilinir) tarafÄ±ndan piyasaya sÃ¼rÃ¼lmÃ¼ÅŸtÃ¼r. Elasticsearch, veri alÄ±mÄ±, zenginleÅŸtirme, depolama, analiz ve gÃ¶rselleÅŸtirme iÃ§in aÃ§Ä±k kaynaklÄ± araÃ§larÄ±n bir koleksiyonu olan Elastic Stack'in temel bileÅŸenidir. Bu yÄ±ÄŸÄ±n, genellikle ELK Stack olarak adlandÄ±rÄ±lÄ±r ve Logstash ve Kibana'yÄ± da iÃ§erir ve ÅŸimdi Beats adÄ± verilen hafif veri taÅŸÄ±ma ajanlarÄ±na sahiptir.

### Elasticsearch indeksi nedir?

Bir Elasticsearch **indeksi**, **JSON** olarak depolanan **ilgili belgelerin bir koleksiyonudur**. Her belge, **anahtarlarÄ±** ve bunlara karÅŸÄ±lÄ±k gelen **deÄŸerleri** (dizeler, sayÄ±lar, boole'lar, tarihler, diziler, coÄŸrafi konumlar vb.) iÃ§erir.

Elasticsearch, hÄ±zlÄ± tam metin aramalarÄ±nÄ± kolaylaÅŸtÄ±rmak iÃ§in **ters indeks** adÄ± verilen verimli bir veri yapÄ±sÄ± kullanÄ±r. Bu indeks, belgelerdeki her benzersiz kelimeyi listeler ve her kelimenin hangi belgelerde gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nÃ¼ belirler.

Ä°ndeksleme sÃ¼reci sÄ±rasÄ±nda Elasticsearch, belgeleri depolar ve ters indeksi oluÅŸturur, bÃ¶ylece neredeyse gerÃ§ek zamanlÄ± arama yapÄ±labilir. **Ä°ndeks API'si**, belirli bir indeks iÃ§inde JSON belgeleri eklemek veya gÃ¼ncellemek iÃ§in kullanÄ±lÄ±r.

**VarsayÄ±lan port**: 9200/tcp

## El ile NumaralandÄ±rma

### Banner

Elasticsearch'e eriÅŸmek iÃ§in kullanÄ±lan protokol **HTTP**'dir. HTTP Ã¼zerinden eriÅŸtiÄŸinizde bazÄ± ilginÃ§ bilgiler bulacaksÄ±nÄ±z: `http://10.10.10.115:9200/`

![](<../.gitbook/assets/image (264).png>)

`/`'ye eriÅŸirken bu yanÄ±tÄ± gÃ¶rmÃ¼yorsanÄ±z, aÅŸaÄŸÄ±daki bÃ¶lÃ¼me bakÄ±n.

### Kimlik DoÄŸrulama

**VarsayÄ±lan olarak Elasticsearch kimlik doÄŸrulamasÄ± etkin deÄŸildir**, bu nedenle varsayÄ±lan olarak herhangi bir kimlik bilgisi kullanmadan veritabanÄ±nÄ±n iÃ§indeki her ÅŸeye eriÅŸebilirsiniz.

Kimlik doÄŸrulamasÄ±nÄ±n devre dÄ±ÅŸÄ± olduÄŸunu doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki isteÄŸi yapabilirsiniz:
```bash
curl -X GET "ELASTICSEARCH-SERVER:9200/_xpack/security/user"
{"error":{"root_cause":[{"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."}],"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."},"status":500}
```
**Ancak**, `/` adresine bir istek gÃ¶nderirseniz ve aÅŸaÄŸÄ±daki gibi bir yanÄ±t alÄ±rsanÄ±z:
```bash
{"error":{"root_cause":[{"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}}],"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}},"status":401}
```
Bu, kimlik doÄŸrulamanÄ±n yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ± ve herhangi bir bilgi elde etmek iÃ§in geÃ§erli kimlik bilgilerine ihtiyaÃ§ duyduÄŸu anlamÄ±na gelir. ArdÄ±ndan, [**brute force**](../generic-methodologies-and-resources/brute-force.md#elasticsearch) deneyebilirsiniz (HTTP temel kimlik doÄŸrulama kullanÄ±r, bu nedenle HTTP temel kimlik doÄŸrulamayÄ± BF yapabilen herhangi bir ÅŸey kullanÄ±labilir).\
Ä°ÅŸte **varsayÄ±lan kullanÄ±cÄ± adlarÄ± listesi**: _**elastic** (sÃ¼per kullanÄ±cÄ±), remote\_monitoring\_user, beats\_system, logstash\_system, kibana, kibana\_system, apm\_system,_ \_anonymous\_.\_ Eski Elasticsearch sÃ¼rÃ¼mlerinde bu kullanÄ±cÄ± iÃ§in varsayÄ±lan ÅŸifre **changeme**'dir.
```
curl -X GET http://user:password@IP:9200/
```
### Temel KullanÄ±cÄ± Saptama

#### Elasticsearch KullanÄ±cÄ±larÄ±

Elasticsearch, kullanÄ±cÄ±larÄ±n belirli izinlere sahip olabileceÄŸi bir kullanÄ±cÄ± tabanÄ± yÃ¶netim sistemine sahiptir. KullanÄ±cÄ±lar, Elasticsearch API'sini kullanarak belirli eylemleri gerÃ§ekleÅŸtirebilirler. Bu nedenle, hedef Elasticsearch sunucusunda mevcut olan kullanÄ±cÄ±larÄ± saptamak Ã¶nemlidir.

KullanÄ±cÄ±larÄ± saptamak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. **_cat/users API'sini kullanarak kullanÄ±cÄ±larÄ± listeleme:** Elasticsearch, `_cat/users` API'sini kullanarak mevcut kullanÄ±cÄ±larÄ± listeler. Bu API'yi kullanarak kullanÄ±cÄ± adlarÄ±nÄ± ve rollerini elde edebilirsiniz.

   ```bash
   curl -XGET 'http://<elasticsearch-ip>:9200/_cat/users?v'
   ```

2. **KullanÄ±cÄ± adÄ± ve parola kombinasyonlarÄ±nÄ± deneme:** Elasticsearch, kullanÄ±cÄ± adÄ± ve parola kombinasyonlarÄ±nÄ± deneyerek doÄŸru kimlik bilgilerini bulmanÄ±za izin verir. Bu, zayÄ±f parola kullanÄ±mÄ±nÄ± tespit etmek iÃ§in kullanÄ±ÅŸlÄ± bir yÃ¶ntem olabilir.

#### Elasticsearch Ä°ndeksleri

Elasticsearch, verileri indeksler halinde saklar. Bu nedenle, hedef Elasticsearch sunucusunda mevcut olan indeksleri saptamak da Ã¶nemlidir.

Ä°ndeksleri saptamak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. **_cat/indices API'sini kullanarak indeksleri listeleme:** Elasticsearch, `_cat/indices` API'sini kullanarak mevcut indeksleri listeler. Bu API'yi kullanarak indeks adlarÄ±nÄ± ve diÄŸer bilgileri elde edebilirsiniz.

   ```bash
   curl -XGET 'http://<elasticsearch-ip>:9200/_cat/indices?v'
   ```

2. **Ä°ndeks adlarÄ±nÄ± inceleme:** Ä°ndeks adlarÄ±, hedef sistemdeki veriler hakkÄ±nda ipuÃ§larÄ± saÄŸlayabilir. Ã–rneÄŸin, bir indeks adÄ± "customer" ise, bu indeksin mÃ¼ÅŸteri verilerini iÃ§erdiÄŸi anlamÄ±na gelebilir.

Bu temel kullanÄ±cÄ± saptama adÄ±mlarÄ±, hedef Elasticsearch sunucusunda mevcut olan kullanÄ±cÄ±larÄ± ve indeksleri belirlemenize yardÄ±mcÄ± olacaktÄ±r. Bu bilgiler, daha fazla saldÄ±rÄ± vektÃ¶rÃ¼ belirlemek ve hedef sistemdeki zayÄ±f noktalarÄ± keÅŸfetmek iÃ§in kullanÄ±labilir.
```bash
#List all roles on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/role"

#List all users on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user"

#Get more information about the rights of an user:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user/<USERNAME>"
```
### Elastic Bilgisi

Elasticsearch hakkÄ±nda bazÄ± bilgileri **edinmek iÃ§in GET ile eriÅŸebileceÄŸiniz** bazÄ± uÃ§ noktalar aÅŸaÄŸÄ±da listelenmiÅŸtir:

| \_cat                           | /\_cluster                    | /\_security               |
| ------------------------------- | ----------------------------- | ------------------------- |
| /\_cat/segments                 | /\_cluster/allocation/explain | /\_security/user          |
| /\_cat/shards                   | /\_cluster/settings           | /\_security/privilege     |
| /\_cat/repositories             | /\_cluster/health             | /\_security/role\_mapping |
| /\_cat/recovery                 | /\_cluster/state              | /\_security/role          |
| /\_cat/plugins                  | /\_cluster/stats              | /\_security/api\_key      |
| /\_cat/pending\_tasks           | /\_cluster/pending\_tasks     |                           |
| /\_cat/nodes                    | /\_nodes                      |                           |
| /\_cat/tasks                    | /\_nodes/usage                |                           |
| /\_cat/templates                | /\_nodes/hot\_threads         |                           |
| /\_cat/thread\_pool             | /\_nodes/stats                |                           |
| /\_cat/ml/trained\_models       | /\_tasks                      |                           |
| /\_cat/transforms/\_all         | /\_remote/info                |                           |
| /\_cat/aliases                  |                               |                           |
| /\_cat/allocation               |                               |                           |
| /\_cat/ml/anomaly\_detectors    |                               |                           |
| /\_cat/count                    |                               |                           |
| /\_cat/ml/data\_frame/analytics |                               |                           |
| /\_cat/ml/datafeeds             |                               |                           |
| /\_cat/fielddata                |                               |                           |
| /\_cat/health                   |                               |                           |
| /\_cat/indices                  |                               |                           |
| /\_cat/master                   |                               |                           |
| /\_cat/nodeattrs                |                               |                           |
| /\_cat/nodes                    |                               |                           |

Bu uÃ§ noktalar [**belgelerden alÄ±nmÄ±ÅŸtÄ±r**](https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html) ve daha fazlasÄ±nÄ± **bulabilirsiniz**.\
AyrÄ±ca, `/_cat`'e eriÅŸirseniz, yanÄ±tta Ã¶rneÄŸin desteklenen `/_cat/*` uÃ§ noktalarÄ± bulunur.

`/_security/user` (eÄŸer yetkilendirme etkinse) Ã¼zerinden `superuser` rolÃ¼ne sahip kullanÄ±cÄ±yÄ± gÃ¶rebilirsiniz.

### Ä°ndeksler

TÃ¼m indeksleri **edinmek iÃ§in** `http://10.10.10.115:9200/_cat/indices?v` adresine eriÅŸebilirsiniz.
```
health status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   .kibana 6tjAYZrgQ5CwwR0g6VOoRg   1   0          1            0        4kb            4kb
yellow open   quotes  ZG2D1IqkQNiNZmi2HRImnQ   5   1        253            0    262.7kb        262.7kb
yellow open   bank    eSVpNfCfREyYoVigNWcrMw   5   1       1000            0    483.2kb        483.2kb
```
**Bir dizinde hangi tÃ¼r verilerin saklandÄ±ÄŸÄ± hakkÄ±nda bilgi almak** iÃ§in ÅŸu adrese eriÅŸebilirsiniz: `http://host:9200/<index>`, Ã¶rneÄŸin bu durumda `http://10.10.10.115:9200/bank`

![](<../.gitbook/assets/image (265).png>)

### Dizin dÃ¶kÃ¼mÃ¼

Bir dizinin **tÃ¼m iÃ§eriÄŸini dÃ¶kmek** isterseniz, ÅŸu adrese eriÅŸebilirsiniz: `http://host:9200/<index>/_search?pretty=true`, Ã¶rneÄŸin `http://10.10.10.115:9200/bank/_search?pretty=true`

![](<../.gitbook/assets/image (266).png>)

_Bank dizini iÃ§indeki her belgenin (giriÅŸin) iÃ§eriÄŸini ve bu dizindeki alanlarÄ± Ã¶nceki bÃ¶lÃ¼mde gÃ¶rdÃ¼ÄŸÃ¼mÃ¼zle karÅŸÄ±laÅŸtÄ±rmak iÃ§in biraz zaman ayÄ±rÄ±n._

Bu noktada, **"hits" iÃ§inde "total" adÄ±nda bir alan olduÄŸunu** fark edebilirsiniz. Bu alan, bu dizinde **1000 belgenin bulunduÄŸunu** ancak yalnÄ±zca 10'unun alÄ±ndÄ±ÄŸÄ±nÄ± gÃ¶sterir. Bu, **varsayÄ±lan olarak 10 belirli bir sÄ±nÄ±rlama olduÄŸu iÃ§in**.\
Ancak, ÅŸimdi **bu dizinin 1000 belge iÃ§erdiÄŸini** bildiÄŸinize gÃ¶re, hepsini dÃ¶kebilirsiniz. **`size`** parametresinde dÃ¶kÃ¼lecek giriÅŸ sayÄ±sÄ±nÄ± belirterek: `http://10.10.10.115:9200/quotes/_search?pretty=true&size=1000`\
_Not: Daha bÃ¼yÃ¼k bir sayÄ± belirtirseniz, tÃ¼m giriÅŸler yine dÃ¶kÃ¼lecektir, Ã¶rneÄŸin `size=9999` belirtebilirsiniz ve daha fazla giriÅŸ varsa garip olur (ancak kontrol etmelisiniz)._

### TÃ¼mÃ¼nÃ¼ dÃ¶k

TÃ¼mÃ¼nÃ¼ dÃ¶kmek iÃ§in, **Ã¶ncekiyle aynÄ± yolu izleyebilirsiniz, ancak herhangi bir dizin belirtmeden** `http://host:9200/_search?pretty=true` adresine gidebilirsiniz, Ã¶rneÄŸin `http://10.10.10.115:9200/_search?pretty=true`\
UnutmayÄ±n ki bu durumda **varsayÄ±lan 10** sonuÃ§ sÄ±nÄ±rÄ± uygulanacaktÄ±r. Daha fazla sonuÃ§ dÃ¶kmek iÃ§in `size` parametresini kullanabilirsiniz. Daha fazla bilgi iÃ§in Ã¶nceki bÃ¶lÃ¼mÃ¼ okuyun.

### Arama

Bir bilgi arÄ±yorsanÄ±z, **tÃ¼m dizinlerde raw bir arama yapabilirsiniz**. `http://host:9200/_search?pretty=true&q=<arama_terimi>` ÅŸeklinde `http://10.10.10.115:9200/_search?pretty=true&q=Rockwell` gibi

![](<../.gitbook/assets/image (267).png>)

Sadece bir dizinde **arama yapmak** isterseniz, **yolu** belirtmeniz yeterlidir: `http://host:9200/<index>/_search?pretty=true&q=<arama_terimi>`

_Arama iÃ§eriÄŸi aramak iÃ§in kullanÄ±lan q parametresinin **dÃ¼zenli ifadeleri desteklediÄŸini** unutun_

AyrÄ±ca, bir Elasticsearch hizmetini fuzz etmek iÃ§in [https://github.com/misalabs/horuz](https://github.com/misalabs/horuz) gibi bir ÅŸey kullanabilirsiniz.

### Yazma izinleri

Yazma izinlerinizi kontrol etmek iÃ§in aÅŸaÄŸÄ±daki gibi yeni bir belgeyi yeni bir dizine oluÅŸturmayÄ± deneyerek kontrol edebilirsiniz:
```bash
curl -X POST '10.10.10.115:9200/bookindex/books' -H 'Content-Type: application/json' -d'
{
"bookId" : "A00-3",
"author" : "Sankaran",
"publisher" : "Mcgrahill",
"name" : "how to get a job"
}'
```
Bu komut, "_bookId_", "_author_", "_publisher_" ve "_name_" Ã¶zniteliklerine sahip bir `books` tÃ¼rÃ¼nde bir belgeye sahip olan `bookindex` adÄ±nda bir **yeni indeks** oluÅŸturur.

Dikkat edin, **yeni indeks ÅŸimdi listede gÃ¶rÃ¼nÃ¼yor**:

![](<../.gitbook/assets/image (268).png>)

Ve **otomatik olarak oluÅŸturulan Ã¶zelliklere** dikkat edin:

![](<../.gitbook/assets/image (269).png>)

## Otomatik NumaralandÄ±rma

BazÄ± araÃ§lar, Ã¶nceden sunulan verilerin bir kÄ±smÄ±nÄ± elde eder:
```bash
msf > use auxiliary/scanner/elasticsearch/indices_enum
```
{% embed url="https://github.com/theMiddleBlue/nmap-elasticsearch-nse" %}

## Shodan

* `port:9200 elasticsearch`

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
