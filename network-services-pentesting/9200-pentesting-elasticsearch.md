# 9200 - æ¸—é€æµ‹è¯• Elasticsearch

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆçš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
- **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨**æˆ‘ä»¬ã€‚
- é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

Elasticsearch æ˜¯ä¸€æ¬¾ç”¨äº**å„ç§ç±»å‹æ•°æ®**çš„**åˆ†å¸ƒå¼**ã€**å¼€æº**æœç´¢å’Œåˆ†æå¼•æ“ã€‚ä»¥å…¶**é€Ÿåº¦**ã€**å¯æ‰©å±•æ€§**å’Œ**ç®€å•çš„ REST API** è€Œé—»åã€‚å®ƒæ˜¯åŸºäº Apache Lucene æ„å»ºçš„ï¼Œç”± Elasticsearch N.V.ï¼ˆç°åœ¨ç§°ä¸º Elasticï¼‰äº 2010 å¹´é¦–æ¬¡å‘å¸ƒã€‚Elasticsearch æ˜¯ Elastic Stack çš„æ ¸å¿ƒç»„ä»¶ï¼Œè¿™æ˜¯ä¸€å¥—ç”¨äºæ•°æ®æ‘„å…¥ã€ä¸°å¯Œã€å­˜å‚¨ã€åˆ†æå’Œå¯è§†åŒ–çš„å¼€æºå·¥å…·é›†ã€‚è¿™ä¸ªå †æ ˆé€šå¸¸è¢«ç§°ä¸º ELK Stackï¼Œè¿˜åŒ…æ‹¬ Logstash å’Œ Kibanaï¼Œç°åœ¨è¿˜æœ‰ç§°ä¸º Beats çš„è½»é‡çº§æ•°æ®ä¼ è¾“ä»£ç†ã€‚

### ä»€ä¹ˆæ˜¯ Elasticsearch ç´¢å¼•ï¼Ÿ

Elasticsearch **ç´¢å¼•**æ˜¯å­˜å‚¨ä¸º **JSON** çš„**ç›¸å…³æ–‡æ¡£**é›†åˆã€‚æ¯ä¸ªæ–‡æ¡£ç”±**é”®**åŠå…¶å¯¹åº”çš„**å€¼**ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ã€æ—¥æœŸã€æ•°ç»„ã€åœ°ç†ä½ç½®ç­‰ï¼‰ç»„æˆã€‚

Elasticsearch ä½¿ç”¨ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ç§°ä¸º**å€’æ’ç´¢å¼•**æ¥å®ç°å¿«é€Ÿå…¨æ–‡æœç´¢ã€‚è¯¥ç´¢å¼•åˆ—å‡ºäº†æ–‡æ¡£ä¸­çš„æ¯ä¸ªå”¯ä¸€å•è¯ï¼Œå¹¶æ ‡è¯†æ¯ä¸ªå•è¯å‡ºç°åœ¨å“ªäº›æ–‡æ¡£ä¸­ã€‚

åœ¨ç´¢å¼•è¿‡ç¨‹ä¸­ï¼ŒElasticsearch å­˜å‚¨æ–‡æ¡£å¹¶æ„å»ºå€’æ’ç´¢å¼•ï¼Œä»è€Œå®ç°å‡ ä¹å®æ—¶çš„æœç´¢ã€‚**ç´¢å¼• API** ç”¨äºåœ¨ç‰¹å®šç´¢å¼•ä¸­æ·»åŠ æˆ–æ›´æ–° JSON æ–‡æ¡£ã€‚

**é»˜è®¤ç«¯å£**ï¼š9200/tcp

## æ‰‹åŠ¨æšä¸¾

### æ¨ªå¹…

è®¿é—® Elasticsearch çš„åè®®æ˜¯ **HTTP**ã€‚å½“é€šè¿‡ HTTP è®¿é—®æ—¶ï¼Œæ‚¨å°†æ‰¾åˆ°ä¸€äº›æœ‰è¶£çš„ä¿¡æ¯ï¼š`http://10.10.10.115:9200/`

![](<../.gitbook/assets/image (294).png>)

å¦‚æœåœ¨è®¿é—® `/` æ—¶æœªçœ‹åˆ°è¯¥å“åº”ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹éƒ¨åˆ†ã€‚

### è®¤è¯

**é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearch æœªå¯ç”¨èº«ä»½éªŒè¯**ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åœ¨ä¸ä½¿ç”¨ä»»ä½•å‡­æ®çš„æƒ…å†µä¸‹è®¿é—®æ•°æ®åº“ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚

æ‚¨å¯ä»¥é€šè¿‡è¯·æ±‚éªŒè¯èº«ä»½éªŒè¯æ˜¯å¦å·²ç¦ç”¨ï¼š
```bash
curl -X GET "ELASTICSEARCH-SERVER:9200/_xpack/security/user"
{"error":{"root_cause":[{"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."}],"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."},"status":500}
```
**ç„¶è€Œ**ï¼Œå¦‚æœæ‚¨å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° `/` å¹¶æ”¶åˆ°ä»¥ä¸‹ç±»ä¼¼çš„å“åº”ï¼š
```bash
{"error":{"root_cause":[{"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}}],"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}},"status":401}
```
è¿™æ„å‘³ç€èº«ä»½éªŒè¯å·²é…ç½®ï¼Œ**æ‚¨éœ€è¦æœ‰æ•ˆçš„å‡­æ®**æ‰èƒ½ä»Elasticsearchè·å–ä»»ä½•ä¿¡æ¯ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥[**å°è¯•æš´åŠ›ç ´è§£**](../generic-methodologies-and-resources/brute-force.md#elasticsearch)ï¼ˆå®ƒä½¿ç”¨HTTPåŸºæœ¬èº«ä»½éªŒè¯ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä»»ä½•é€‚ç”¨äºBF HTTPåŸºæœ¬èº«ä»½éªŒè¯çš„æ–¹æ³•ï¼‰ã€‚\
è¿™é‡Œæœ‰ä¸€ä¸ª**é»˜è®¤ç”¨æˆ·ååˆ—è¡¨**ï¼š_**elastic**ï¼ˆè¶…çº§ç”¨æˆ·ï¼‰ï¼Œremote\_monitoring\_userï¼Œbeats\_systemï¼Œlogstash\_systemï¼Œkibanaï¼Œkibana\_systemï¼Œapm\_systemï¼Œ_ \_anonymous\_.\_ Elasticsearchçš„æ—§ç‰ˆæœ¬ä½¿ç”¨æ­¤ç”¨æˆ·çš„é»˜è®¤å¯†ç ä¸º**changeme**ã€‚
```
curl -X GET http://user:password@IP:9200/
```
### åŸºæœ¬ç”¨æˆ·æšä¸¾
```bash
#List all roles on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/role"

#List all users on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user"

#Get more information about the rights of an user:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user/<USERNAME>"
```
### Elastic Info

ä»¥ä¸‹æ˜¯ä¸€äº›ç«¯ç‚¹ï¼Œæ‚¨å¯ä»¥é€šè¿‡GETè®¿é—®ä»¥è·å–æœ‰å…³elasticsearchçš„ä¸€äº›ä¿¡æ¯ï¼š

| \_cat                           | /\_cluster                    | /\_security               |
| ------------------------------- | ----------------------------- | ------------------------- |
| /\_cat/segments                 | /\_cluster/allocation/explain | /\_security/user          |
| /\_cat/shards                   | /\_cluster/settings           | /\_security/privilege     |
| /\_cat/repositories             | /\_cluster/health             | /\_security/role\_mapping |
| /\_cat/recovery                 | /\_cluster/state              | /\_security/role          |
| /\_cat/plugins                  | /\_cluster/stats              | /\_security/api\_key      |
| /\_cat/pending\_tasks           | /\_cluster/pending\_tasks     |                           |
| /\_cat/nodes                    | /\_nodes                      |                           |
| /\_cat/tasks                    | /\_nodes/usage                |                           |
| /\_cat/templates                | /\_nodes/hot\_threads         |                           |
| /\_cat/thread\_pool             | /\_nodes/stats                |                           |
| /\_cat/ml/trained\_models       | /\_tasks                      |                           |
| /\_cat/transforms/\_all         | /\_remote/info                |                           |
| /\_cat/aliases                  |                               |                           |
| /\_cat/allocation               |                               |                           |
| /\_cat/ml/anomaly\_detectors    |                               |                           |
| /\_cat/count                    |                               |                           |
| /\_cat/ml/data\_frame/analytics |                               |                           |
| /\_cat/ml/datafeeds             |                               |                           |
| /\_cat/fielddata                |                               |                           |
| /\_cat/health                   |                               |                           |
| /\_cat/indices                  |                               |                           |
| /\_cat/master                   |                               |                           |
| /\_cat/nodeattrs                |                               |                           |
| /\_cat/nodes                    |                               |                           |

è¿™äº›ç«¯ç‚¹æ˜¯ä»[**æ–‡æ¡£ä¸­è·å–çš„**](https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html)ï¼Œæ‚¨å¯ä»¥åœ¨é‚£é‡Œ**æ‰¾åˆ°æ›´å¤š**ã€‚\
æ­¤å¤–ï¼Œå¦‚æœè®¿é—®`/_cat`ï¼Œå“åº”å°†åŒ…å«å®ä¾‹æ”¯æŒçš„`/_cat/*`ç«¯ç‚¹ã€‚

åœ¨`/_security/user`ï¼ˆå¦‚æœå¯ç”¨äº†èº«ä»½éªŒè¯ï¼‰ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å…·æœ‰`superuser`è§’è‰²çš„ç”¨æˆ·ã€‚

### Indices

æ‚¨å¯ä»¥é€šè¿‡è®¿é—®`http://10.10.10.115:9200/_cat/indices?v`æ¥**æ”¶é›†æ‰€æœ‰ç´¢å¼•**ã€‚
```
health status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   .kibana 6tjAYZrgQ5CwwR0g6VOoRg   1   0          1            0        4kb            4kb
yellow open   quotes  ZG2D1IqkQNiNZmi2HRImnQ   5   1        253            0    262.7kb        262.7kb
yellow open   bank    eSVpNfCfREyYoVigNWcrMw   5   1       1000            0    483.2kb        483.2kb
```
è¦è·å–**ä¿å­˜åœ¨ç´¢å¼•ä¸­çš„æ•°æ®ç±»å‹ä¿¡æ¯**ï¼Œæ‚¨å¯ä»¥è®¿é—®ï¼š`http://host:9200/<index>`ï¼Œä¾‹å¦‚åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯`http://10.10.10.115:9200/bank`

![](<../.gitbook/assets/image (342).png>)

### è½¬å‚¨ç´¢å¼•

å¦‚æœæ‚¨æƒ³**è½¬å‚¨ç´¢å¼•çš„æ‰€æœ‰å†…å®¹**ï¼Œæ‚¨å¯ä»¥è®¿é—®ï¼š`http://host:9200/<index>/_search?pretty=true`ï¼Œå¦‚`http://10.10.10.115:9200/bank/_search?pretty=true`

![](<../.gitbook/assets/image (914).png>)

_èŠ±ç‚¹æ—¶é—´æ¯”è¾ƒé“¶è¡Œç´¢å¼•ä¸­æ¯ä¸ªæ–‡æ¡£ï¼ˆæ¡ç›®ï¼‰çš„å†…å®¹å’Œæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­çœ‹åˆ°çš„è¯¥ç´¢å¼•çš„å­—æ®µã€‚_

å› æ­¤ï¼Œæ­¤æ—¶æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°**"hits"å†…æœ‰ä¸€ä¸ªåä¸º"total"çš„å­—æ®µ**ï¼ŒæŒ‡ç¤ºåœ¨æ­¤ç´¢å¼•ä¸­æ‰¾åˆ°äº†**1000ä¸ªæ–‡æ¡£**ï¼Œä½†åªæ£€ç´¢äº†10ä¸ªã€‚è¿™æ˜¯å› ä¸º**é»˜è®¤æƒ…å†µä¸‹é™åˆ¶ä¸º10ä¸ªæ–‡æ¡£**ã€‚\
ä½†æ˜¯ï¼Œç°åœ¨æ‚¨çŸ¥é“**æ­¤ç´¢å¼•åŒ…å«1000ä¸ªæ–‡æ¡£**ï¼Œæ‚¨å¯ä»¥æŒ‡å®šè¦åœ¨**`size`**å‚æ•°ä¸­è½¬å‚¨çš„æ¡ç›®æ•°æ¥**è½¬å‚¨æ‰€æœ‰è¿™äº›æ–‡æ¡£**ï¼š`http://10.10.10.115:9200/quotes/_search?pretty=true&size=1000`asd\
_æ³¨æ„ï¼šå¦‚æœæŒ‡å®šæ›´å¤§çš„æ•°å­—ï¼Œæ‰€æœ‰æ¡ç›®éƒ½å°†è¢«è½¬å‚¨ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æŒ‡å®š`size=9999`ï¼Œå¦‚æœæœ‰æ›´å¤šæ¡ç›®ï¼Œé‚£å°†å¾ˆå¥‡æ€ªï¼ˆä½†æ‚¨åº”è¯¥æ£€æŸ¥ï¼‰ã€‚_

### è½¬å‚¨æ‰€æœ‰

ä¸ºäº†è½¬å‚¨æ‰€æœ‰å†…å®¹ï¼Œæ‚¨å¯ä»¥ç›´æ¥è½¬åˆ°**ä¹‹å‰çš„ç›¸åŒè·¯å¾„ï¼Œä½†ä¸æŒ‡å®šä»»ä½•ç´¢å¼•**`http://host:9200/_search?pretty=true`ï¼Œå¦‚`http://10.10.10.115:9200/_search?pretty=true`\
è¯·è®°ä½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å°†åº”ç”¨**é»˜è®¤çš„10ä¸ª**ç»“æœé™åˆ¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`size`å‚æ•°æ¥è½¬å‚¨**æ›´å¤šçš„ç»“æœ**ã€‚é˜…è¯»ä¸Šä¸€èŠ‚è·å–æ›´å¤šä¿¡æ¯ã€‚

### æœç´¢

å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾æŸäº›ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å¯¹**æ‰€æœ‰ç´¢å¼•è¿›è¡ŒåŸå§‹æœç´¢**ï¼Œè½¬åˆ°`http://host:9200/_search?pretty=true&q=<search_term>`ï¼Œå¦‚`http://10.10.10.115:9200/_search?pretty=true&q=Rockwell`

![](<../.gitbook/assets/image (335).png>)

å¦‚æœæ‚¨åªæƒ³åœ¨**ä¸€ä¸ªç´¢å¼•ä¸Šæœç´¢**ï¼Œæ‚¨å¯ä»¥åœ¨**è·¯å¾„**ä¸Š**æŒ‡å®š**å®ƒï¼š`http://host:9200/<index>/_search?pretty=true&q=<search_term>`

_è¯·æ³¨æ„ï¼Œç”¨äºæœç´¢å†…å®¹çš„qå‚æ•°**æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼**_

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ç±»ä¼¼[https://github.com/misalabs/horuz](https://github.com/misalabs/horuz)çš„å·¥å…·æ¥æ¨¡ç³Šæœç´¢elasticsearchæœåŠ¡ã€‚

### å†™å…¥æƒé™

æ‚¨å¯ä»¥é€šè¿‡å°è¯•åœ¨æ–°ç´¢å¼•ä¸­åˆ›å»ºæ–°æ–‡æ¡£æ¥æ£€æŸ¥æ‚¨çš„å†™å…¥æƒé™ï¼Œè¿è¡Œç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š
```bash
curl -X POST '10.10.10.115:9200/bookindex/books' -H 'Content-Type: application/json' -d'
{
"bookId" : "A00-3",
"author" : "Sankaran",
"publisher" : "Mcgrahill",
"name" : "how to get a job"
}'
```
è¯¥å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º`bookindex`çš„**æ–°ç´¢å¼•**ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º`books`çš„æ–‡æ¡£ï¼Œè¯¥æ–‡æ¡£å…·æœ‰å±æ€§"_bookId_"ã€"_author_"ã€"_publisher_"å’Œ"_name_"

æ³¨æ„**ç°åœ¨åˆ—è¡¨ä¸­å‡ºç°çš„æ–°ç´¢å¼•**ï¼š

![](<../.gitbook/assets/image (130).png>)

å¹¶æ³¨æ„**è‡ªåŠ¨ç”Ÿæˆçš„å±æ€§**ï¼š

![](<../.gitbook/assets/image (434).png>)

## è‡ªåŠ¨æšä¸¾

ä¸€äº›å·¥å…·å°†è·å–ä¹‹å‰å‘ˆç°çš„ä¸€äº›æ•°æ®ï¼š
```bash
msf > use auxiliary/scanner/elasticsearch/indices_enum
```
{% embed url="https://github.com/theMiddleBlue/nmap-elasticsearch-nse" %}

## Shodan

* `port:9200 elasticsearch`

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
