# 9200 - Elasticsearchæ¸—é€æµ‹è¯•

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## åŸºæœ¬ä¿¡æ¯

ä»[ä¸»é¡µ](https://www.elastic.co/what-is/elasticsearch)ä¸Šï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€äº›æœ‰ç”¨çš„æè¿°ï¼š

> Elasticsearchæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¼€æºæœç´¢å’Œåˆ†æå¼•æ“ï¼Œé€‚ç”¨äºæ‰€æœ‰ç±»å‹çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€æ•°å­—ã€åœ°ç†ç©ºé—´ã€ç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®ã€‚ElasticsearchåŸºäºApache Luceneæ„å»ºï¼Œç”±Elasticsearch N.V.ï¼ˆç°åœ¨ç§°ä¸ºElasticï¼‰äº2010å¹´é¦–æ¬¡å‘å¸ƒã€‚ä»¥å…¶ç®€å•çš„REST APIã€åˆ†å¸ƒå¼ç‰¹æ€§ã€é€Ÿåº¦å’Œå¯æ‰©å±•æ€§è€Œé—»åï¼ŒElasticsearchæ˜¯Elastic Stackçš„æ ¸å¿ƒç»„ä»¶ï¼ŒElastic Stackæ˜¯ä¸€å¥—å¼€æºå·¥å…·ï¼Œç”¨äºæ•°æ®æ‘„å–ã€ä¸°å¯Œã€å­˜å‚¨ã€åˆ†æå’Œå¯è§†åŒ–ã€‚é€šå¸¸è¢«ç§°ä¸ºELK Stackï¼ˆå–è‡ªElasticsearchã€Logstashå’ŒKibanaï¼‰ï¼ŒElastic Stackç°åœ¨åŒ…æ‹¬ä¸€ç³»åˆ—ç§°ä¸ºBeatsçš„è½»é‡çº§æ•°æ®ä¼ è¾“ä»£ç†ï¼Œç”¨äºå°†æ•°æ®å‘é€åˆ°Elasticsearchã€‚

### ä»€ä¹ˆæ˜¯Elasticsearchç´¢å¼•ï¼Ÿ

Elasticsearch _ç´¢å¼•_ **æ˜¯ä¸€ç»„ç›¸å…³æ–‡æ¡£çš„é›†åˆ**ã€‚Elasticsearchå°†æ•°æ®å­˜å‚¨ä¸ºJSONæ–‡æ¡£ã€‚æ¯ä¸ªæ–‡æ¡£å°†ä¸€ç»„_keys_ï¼ˆå­—æ®µæˆ–å±æ€§çš„åç§°ï¼‰ä¸å…¶å¯¹åº”çš„_values_ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ã€æ—¥æœŸã€_values_æ•°ç»„ã€åœ°ç†ä½ç½®æˆ–å…¶ä»–ç±»å‹çš„æ•°æ®ï¼‰ç›¸å…³è”ã€‚

Elasticsearchä½¿ç”¨ä¸€ç§ç§°ä¸º_å€’æ’ç´¢å¼•_çš„æ•°æ®ç»“æ„ï¼Œè¯¥ç»“æ„æ—¨åœ¨å…è®¸éå¸¸å¿«é€Ÿçš„å…¨æ–‡æœç´¢ã€‚å€’æ’ç´¢å¼•åˆ—å‡ºäº†åœ¨ä»»ä½•æ–‡æ¡£ä¸­å‡ºç°çš„æ¯ä¸ªç‹¬ç‰¹å•è¯ï¼Œå¹¶æ ‡è¯†äº†æ¯ä¸ªå•è¯å‡ºç°çš„æ‰€æœ‰æ–‡æ¡£ã€‚

åœ¨ç´¢å¼•è¿‡ç¨‹ä¸­ï¼ŒElasticsearchå­˜å‚¨æ–‡æ¡£å¹¶æ„å»ºå€’æ’ç´¢å¼•ï¼Œä»¥ä¾¿åœ¨è¿‘ä¹å®æ—¶çš„æƒ…å†µä¸‹ä½¿æ–‡æ¡£æ•°æ®å¯æœç´¢ã€‚ç´¢å¼•æ˜¯é€šè¿‡ç´¢å¼•APIå¯åŠ¨çš„ï¼Œé€šè¿‡è¯¥APIï¼Œæ‚¨å¯ä»¥åœ¨ç‰¹å®šç´¢å¼•ä¸­æ·»åŠ æˆ–æ›´æ–°JSONæ–‡æ¡£ã€‚

**é»˜è®¤ç«¯å£**ï¼š9200/tcp

## æ‰‹åŠ¨æšä¸¾

### æ¨ªå¹…

ç”¨äºè®¿é—®Elasticsearchçš„åè®®æ˜¯**HTTP**ã€‚å½“æ‚¨é€šè¿‡HTTPè®¿é—®å®ƒæ—¶ï¼Œæ‚¨ä¼šå‘ç°ä¸€äº›æœ‰è¶£çš„ä¿¡æ¯ï¼š`http://10.10.10.115:9200/`

![](<../.gitbook/assets/image (264).png>)

å¦‚æœæ‚¨åœ¨è®¿é—®`/`æ—¶æ²¡æœ‰çœ‹åˆ°è¯¥å“åº”ï¼Œè¯·å‚é˜…ä»¥ä¸‹éƒ¨åˆ†ã€‚

### è®¤è¯

**é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchæ²¡æœ‰å¯ç”¨è®¤è¯**ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åœ¨ä¸ä½¿ç”¨ä»»ä½•å‡­æ®çš„æƒ…å†µä¸‹è®¿é—®æ•°æ®åº“å†…çš„æ‰€æœ‰å†…å®¹ã€‚

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯·æ±‚æ¥éªŒè¯è®¤è¯æ˜¯å¦è¢«ç¦ç”¨ï¼š
```bash
curl -X GET "ELASTICSEARCH-SERVER:9200/_xpack/security/user"
{"error":{"root_cause":[{"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."}],"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."},"status":500}
```
**ç„¶è€Œ**ï¼Œå¦‚æœä½ å‘ `/` å‘é€è¯·æ±‚å¹¶æ”¶åˆ°å¦‚ä¸‹å“åº”ï¼š
```bash
{"error":{"root_cause":[{"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}}],"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}},"status":401}
```
è¿™æ„å‘³ç€é…ç½®äº†è®¤è¯ï¼Œ**ä½ éœ€è¦æœ‰æ•ˆçš„å‡­æ®**æ‰èƒ½ä»elasticsearchè·å–ä»»ä½•ä¿¡æ¯ã€‚ç„¶åï¼Œä½ å¯ä»¥[**å°è¯•æš´åŠ›ç ´è§£**](../generic-methodologies-and-resources/brute-force.md#elasticsearch)ï¼ˆå®ƒä½¿ç”¨HTTPåŸºæœ¬è®¤è¯ï¼Œæ‰€ä»¥ä»»ä½•å¯ä»¥æš´åŠ›ç ´è§£HTTPåŸºæœ¬è®¤è¯çš„å·¥å…·éƒ½å¯ä»¥ä½¿ç”¨ï¼‰ã€‚\
è¿™é‡Œæœ‰ä¸€ä¸ª**é»˜è®¤ç”¨æˆ·ååˆ—è¡¨**ï¼š_**elastic**ï¼ˆè¶…çº§ç”¨æˆ·ï¼‰ï¼Œremote\_monitoring\_user, beats\_system, logstash\_system, kibana, kibana\_system, apm\_system,_ \_anonymous\_ã€‚\_æ—§ç‰ˆæœ¬çš„Elasticsearché»˜è®¤å¯†ç ä¸º**changeme**ã€‚
```
curl -X GET http://user:password@IP:9200/
```
### åŸºæœ¬ç”¨æˆ·æšä¸¾
```bash
#List all roles on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/role"

#List all users on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user"

#Get more information about the rights of an user:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user/<USERNAME>"
```
### Elasticä¿¡æ¯

ä»¥ä¸‹æ˜¯ä¸€äº›ç«¯ç‚¹ï¼Œæ‚¨å¯ä»¥é€šè¿‡**GETè®¿é—®**ä»¥è·å–æœ‰å…³elasticsearchçš„ä¸€äº›**ä¿¡æ¯**ï¼š

| \_cat                           | /\_cluster                    | /\_security               |
| ------------------------------- | ----------------------------- | ------------------------- |
| /\_cat/segments                 | /\_cluster/allocation/explain | /\_security/user          |
| /\_cat/shards                   | /\_cluster/settings           | /\_security/privilege     |
| /\_cat/repositories             | /\_cluster/health             | /\_security/role\_mapping |
| /\_cat/recovery                 | /\_cluster/state              | /\_security/role          |
| /\_cat/plugins                  | /\_cluster/stats              | /\_security/api\_key      |
| /\_cat/pending\_tasks           | /\_cluster/pending\_tasks     |                           |
| /\_cat/nodes                    | /\_nodes                      |                           |
| /\_cat/tasks                    | /\_nodes/usage                |                           |
| /\_cat/templates                | /\_nodes/hot\_threads         |                           |
| /\_cat/thread\_pool             | /\_nodes/stats                |                           |
| /\_cat/ml/trained\_models       | /\_tasks                      |                           |
| /\_cat/transforms/\_all         | /\_remote/info                |                           |
| /\_cat/aliases                  |                               |                           |
| /\_cat/allocation               |                               |                           |
| /\_cat/ml/anomaly\_detectors    |                               |                           |
| /\_cat/count                    |                               |                           |
| /\_cat/ml/data\_frame/analytics |                               |                           |
| /\_cat/ml/datafeeds             |                               |                           |
| /\_cat/fielddata                |                               |                           |
| /\_cat/health                   |                               |                           |
| /\_cat/indices                  |                               |                           |
| /\_cat/master                   |                               |                           |
| /\_cat/nodeattrs                |                               |                           |
| /\_cat/nodes                    |                               |                           |

è¿™äº›ç«¯ç‚¹æ˜¯ä»[**æ–‡æ¡£ä¸­è·å–çš„**](https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html)ï¼Œæ‚¨å¯ä»¥åœ¨é‚£é‡Œ**æ‰¾åˆ°æ›´å¤šä¿¡æ¯**ã€‚\
æ­¤å¤–ï¼Œå¦‚æœæ‚¨è®¿é—®`/_cat`ï¼Œå“åº”å°†åŒ…å«å®ä¾‹æ”¯æŒçš„`/_cat/*`ç«¯ç‚¹ã€‚

åœ¨`/_security/user`ä¸­ï¼ˆå¦‚æœå¯ç”¨äº†authï¼‰ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å“ªä¸ªç”¨æˆ·å…·æœ‰`superuser`è§’è‰²ã€‚

### ç´¢å¼•

æ‚¨å¯ä»¥é€šè¿‡è®¿é—®`http://10.10.10.115:9200/_cat/indices?v`**æ”¶é›†æ‰€æœ‰ç´¢å¼•**ã€‚
```
health status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   .kibana 6tjAYZrgQ5CwwR0g6VOoRg   1   0          1            0        4kb            4kb
yellow open   quotes  ZG2D1IqkQNiNZmi2HRImnQ   5   1        253            0    262.7kb        262.7kb
yellow open   bank    eSVpNfCfREyYoVigNWcrMw   5   1       1000            0    483.2kb        483.2kb
```
è¦è·å–**æœ‰å…³ç´¢å¼•å†…ä¿å­˜äº†å“ªç§æ•°æ®çš„ä¿¡æ¯**ï¼Œæ‚¨å¯ä»¥è®¿é—®ï¼š`http://host:9200/<index>`ï¼Œä¾‹å¦‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­æ˜¯ `http://10.10.10.115:9200/bank`

![](<../.gitbook/assets/image (265).png>)

### è½¬å‚¨ç´¢å¼•

å¦‚æœæ‚¨æƒ³è¦**è½¬å‚¨ç´¢å¼•çš„æ‰€æœ‰å†…å®¹**ï¼Œæ‚¨å¯ä»¥è®¿é—®ï¼š`http://host:9200/<index>/_search?pretty=true`ï¼Œå¦‚ `http://10.10.10.115:9200/bank/_search?pretty=true`

![](<../.gitbook/assets/image (266).png>)

_èŠ±ç‚¹æ—¶é—´æ¯”è¾ƒä¸€ä¸‹é“¶è¡Œç´¢å¼•å†…æ¯ä¸ªæ–‡æ¡£ï¼ˆæ¡ç›®ï¼‰çš„å†…å®¹ä»¥åŠæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­çœ‹åˆ°çš„è¿™ä¸ªç´¢å¼•çš„å­—æ®µã€‚_

æ­¤æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°**åœ¨ "hits" ä¸­æœ‰ä¸€ä¸ªåä¸º "total" çš„å­—æ®µ**ï¼Œå®ƒè¡¨æ˜åœ¨æ­¤ç´¢å¼•å†…**å‘ç°äº†1000ä¸ªæ–‡æ¡£**ï¼Œä½†åªæ£€ç´¢äº†10ä¸ªã€‚è¿™æ˜¯å› ä¸º**é»˜è®¤æƒ…å†µä¸‹æœ‰ä¸€ä¸ª10ä¸ªæ–‡æ¡£çš„é™åˆ¶**ã€‚\
ä½†æ˜¯ï¼Œç°åœ¨æ‚¨çŸ¥é“**è¿™ä¸ªç´¢å¼•åŒ…å«1000ä¸ªæ–‡æ¡£**ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨**`size`** å‚æ•°ä¸­æŒ‡å®šæ‚¨æƒ³è¦è½¬å‚¨çš„æ¡ç›®æ•°é‡æ¥**è½¬å‚¨æ‰€æœ‰è¿™äº›æ–‡æ¡£**ï¼š`http://10.10.10.115:9200/quotes/_search?pretty=true&size=1000`asd\
_æ³¨æ„ï¼šå¦‚æœæ‚¨æŒ‡å®šæ›´å¤§çš„æ•°å­—ï¼Œæ‰€æœ‰æ¡ç›®éƒ½ä¼šè¢«è½¬å‚¨ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æŒ‡å®š `size=9999`ï¼Œå¦‚æœæœ‰æ›´å¤šæ¡ç›®ï¼ˆä½†æ‚¨åº”è¯¥æ£€æŸ¥ï¼‰ï¼Œè¿™å°†æ˜¯å¥‡æ€ªçš„ã€‚_

### è½¬å‚¨å…¨éƒ¨

ä¸ºäº†è½¬å‚¨å…¨éƒ¨ï¼Œæ‚¨å¯ä»¥ç›´æ¥è®¿é—®**ä¸ä¹‹å‰ç›¸åŒçš„è·¯å¾„ï¼Œä½†ä¸æŒ‡å®šä»»ä½•ç´¢å¼•**`http://host:9200/_search?pretty=true`ï¼Œå¦‚ `http://10.10.10.115:9200/_search?pretty=true`\
è¯·è®°ä½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†åº”ç”¨**é»˜è®¤çš„10ä¸ªç»“æœé™åˆ¶**ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ `size` å‚æ•°æ¥è½¬å‚¨**æ›´å¤šçš„ç»“æœ**ã€‚é˜…è¯»ä¸Šä¸€èŠ‚ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚

### æœç´¢

å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä¸€äº›ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å¯¹æ‰€æœ‰ç´¢å¼•è¿›è¡Œ**åŸå§‹æœç´¢**ï¼Œè®¿é—® `http://host:9200/_search?pretty=true&q=<search_term>`ï¼Œå¦‚åœ¨ `http://10.10.10.115:9200/_search?pretty=true&q=Rockwell`

![](<../.gitbook/assets/image (267).png>)

å¦‚æœæ‚¨åªæƒ³åœ¨ä¸€ä¸ªç´¢å¼•ä¸Š**æœç´¢**ï¼Œæ‚¨å¯ä»¥åœ¨**è·¯å¾„**ä¸Š**æŒ‡å®š**å®ƒï¼š`http://host:9200/<index>/_search?pretty=true&q=<search_term>`

_è¯·æ³¨æ„ï¼Œç”¨äºæœç´¢å†…å®¹çš„ q å‚æ•°**æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼**_

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼ [https://github.com/misalabs/horuz](https://github.com/misalabs/horuz) çš„å·¥å…·æ¥å¯¹elasticsearchæœåŠ¡è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ã€‚

### å†™å…¥æƒé™

æ‚¨å¯ä»¥å°è¯•åœ¨ä¸€ä¸ªæ–°ç´¢å¼•å†…åˆ›å»ºä¸€ä¸ªæ–°æ–‡æ¡£æ¥æ£€æŸ¥æ‚¨çš„å†™å…¥æƒé™ï¼Œè¿è¡Œç±»ä¼¼ä»¥ä¸‹çš„æ“ä½œï¼š
```bash
curl -X POST '10.10.10.115:9200/bookindex/books' -H 'Content-Type: application/json' -d'
{
"bookId" : "A00-3",
"author" : "Sankaran",
"publisher" : "Mcgrahill",
"name" : "how to get a job"
}'
```
è¯¥å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º `bookindex` çš„**æ–°ç´¢å¼•**ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç±»å‹ä¸º `books` çš„æ–‡æ¡£ï¼Œè¯¥æ–‡æ¡£å…·æœ‰å±æ€§ "_bookId_"ã€"_author_"ã€"_publisher_" å’Œ "_name_"

æ³¨æ„**æ–°ç´¢å¼•ç°åœ¨å‡ºç°åœ¨åˆ—è¡¨ä¸­**ï¼š

![](<../.gitbook/assets/image (268).png>)

å¹¶æ³¨æ„**è‡ªåŠ¨åˆ›å»ºçš„å±æ€§**ï¼š

![](<../.gitbook/assets/image (269).png>)

## è‡ªåŠ¨æšä¸¾

ä¸€äº›å·¥å…·å°†è·å–ä¹‹å‰å‘ˆç°çš„ä¸€äº›æ•°æ®ï¼š
```bash
msf > use auxiliary/scanner/elasticsearch/indices_enum
```
{% embed url="https://github.com/theMiddleBlue/nmap-elasticsearch-nse" %}

## Shodan

* `port:9200 elasticsearch`

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
