# 2049 - Pentesting NFS Service

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Grundinformationen**

**NFS** ist ein System, das f√ºr **Client/Server** konzipiert wurde und es Benutzern erm√∂glicht, nahtlos auf Dateien √ºber ein Netzwerk zuzugreifen, als ob sich diese Dateien in einem lokalen Verzeichnis befinden w√ºrden.

Ein bemerkenswerter Aspekt dieses Protokolls ist das Fehlen von integrierten **Authentifizierungs-** oder **Autorisierungsmechanismen**. Stattdessen beruht die Autorisierung auf **Dateisysteminformationen**, wobei der Server daf√ºr verantwortlich ist, die **vom Client bereitgestellten Benutzerinformationen** in das erforderliche **Autorisierungsformat** des Dateisystems genau zu √ºbersetzen, haupts√§chlich gem√§√ü der **UNIX-Syntax**.

Die Authentifizierung beruht h√§ufig auf **UNIX `UID`/`GID`-Identifikatoren und Gruppenmitgliedschaften**. Ein Problem ergibt sich jedoch aufgrund der m√∂glichen Diskrepanz in den **`UID`/`GID`-Zuordnungen** zwischen Clients und Servern, was keinen Raum f√ºr zus√§tzliche √úberpr√ºfungen durch den Server l√§sst. Folglich ist das Protokoll am besten f√ºr die Verwendung innerhalb von **vertrauensw√ºrdigen Netzwerken** geeignet, da es auf dieser Methode der Authentifizierung basiert.

**Standardport**: 2049/TCP/UDP (au√üer Version 4, es ben√∂tigt nur TCP oder UDP).&#x20;
```
2049/tcp open  nfs     2-3 (RPC #100003
```
### Versionen

- **NFSv2**: Diese Version ist bekannt f√ºr ihre breite Kompatibilit√§t mit verschiedenen Systemen und markiert ihre Bedeutung mit anf√§nglichen Operationen √ºberwiegend √ºber UDP. Als die **√§lteste** in der Reihe legte sie den Grundstein f√ºr zuk√ºnftige Entwicklungen.

- **NFSv3**: Eingef√ºhrt mit einer Reihe von Verbesserungen, erweiterte NFSv3 seinen Vorg√§nger, indem es variable Dateigr√∂√üen unterst√ºtzte und verbesserte Fehlerberichterstattungsmechanismen bot. Trotz seiner Fortschritte hatte es Einschr√§nkungen in der vollst√§ndigen R√ºckw√§rtskompatibilit√§t mit NFSv2-Clients.

- **NFSv4**: Eine wegweisende Version in der NFS-Serie, brachte NFSv4 eine Reihe von Funktionen mit sich, die darauf abzielen, die Dateifreigabe √ºber Netzwerke zu modernisieren. Zu den bemerkenswerten Verbesserungen geh√∂ren die Integration von Kerberos f√ºr **hohe Sicherheit**, die F√§higkeit, Firewalls zu durchqueren und √ºber das Internet ohne die Notwendigkeit von Portmappern zu arbeiten, Unterst√ºtzung f√ºr Access Control Lists (ACLs) und die Einf√ºhrung von zustandsbasierten Operationen. Die Leistungsverbesserungen und die Annahme eines zustandsbehafteten Protokolls heben NFSv4 als einen entscheidenden Fortschritt in der Technologie der Netzwerkdateifreigabe hervor.

Jede Version von NFS wurde mit dem Ziel entwickelt, den sich entwickelnden Bed√ºrfnissen von Netzwerkumgebungen gerecht zu werden und dabei Sicherheit, Kompatibilit√§t und Leistung schrittweise zu verbessern.

## Enumeration

### N√ºtzliche nmap-Skripte
```bash
nfs-ls #List NFS exports and check permissions
nfs-showmount #Like showmount -e
nfs-statfs #Disk statistics and info from NFS share
```
### N√ºtzliche Metasploit-Module
```bash
scanner/nfs/nfsmount #Scan NFS mounts and list permissions
```
### Mounting

Um zu wissen, **welcher Ordner** dem Server **verf√ºgbar** ist, um ihn zu mounten, k√∂nnen Sie ihn fragen mit:
```bash
showmount -e <IP>
```
Dann mounten Sie es mit:
```bash
mount -t nfs [-o vers=2] <ip>:<remote_folder> <local_folder> -o nolock
```
Sie sollten **Version 2** **verwenden**, da sie **keine** **Authentifizierung** oder **Autorisierung** hat.

**Beispiel:**
```bash
mkdir /mnt/new_back
mount -t nfs [-o vers=2] 10.12.0.150:/backup /mnt/new_back -o nolock
```
## Berechtigungen

Wenn Sie einen Ordner einh√§ngen, der **Dateien oder Ordner enth√§lt, die nur von einem bestimmten Benutzer** (durch **UID**) zug√§nglich sind. Sie k√∂nnen **lokal** einen Benutzer mit dieser **UID** erstellen und mit diesem **Benutzer** werden Sie in der Lage sein, auf die Datei/den Ordner zu **zugreifen**.

## NSFShell

Um Dateien einfach aufzulisten, einzuh√§ngen und UID sowie GID zu √§ndern, um Zugriff auf Dateien zu erhalten, k√∂nnen Sie [nfsshell](https://github.com/NetDirect/nfsshell) verwenden.

[Nice NFSShell tutorial.](https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/)

## Konfigurationsdateien
```
/etc/exports
/etc/lib/nfs/etab
```
### Gef√§hrliche Einstellungen

- **Lese- und Schreibberechtigungen (`rw`):** Diese Einstellung erlaubt sowohl das Lesen als auch das Schreiben im Dateisystem. Es ist wichtig, die Auswirkungen einer so breiten Zugriffsgew√§hrung zu ber√ºcksichtigen.

- **Verwendung unsicherer Ports (`insecure`):** Wenn aktiviert, erlaubt dies dem System, Ports √ºber 1024 zu nutzen. Die Sicherheit von Ports in diesem Bereich kann weniger streng sein, was das Risiko erh√∂ht.

- **Sichtbarkeit von verschachtelten Dateisystemen (`nohide`):** Diese Konfiguration macht Verzeichnisse sichtbar, selbst wenn ein anderes Dateisystem unter einem exportierten Verzeichnis gemountet ist. Jedes Verzeichnis ben√∂tigt seinen eigenen Exporteintrag f√ºr eine ordnungsgem√§√üe Verwaltung.

- **Besitz von Root-Dateien (`no_root_squash`):** Mit dieser Einstellung behalten Dateien, die vom Root-Benutzer erstellt werden, ihre urspr√ºngliche UID/GID von 0, was das Prinzip der minimalen Berechtigung missachtet und potenziell √ºberm√§√üige Berechtigungen gew√§hrt.

- **Nicht-Squashing aller Benutzer (`no_all_squash`):** Diese Option stellt sicher, dass die Benutzeridentit√§ten im gesamten System erhalten bleiben, was zu Berechtigungs- und Zugriffssteuerungsproblemen f√ºhren kann, wenn es nicht korrekt behandelt wird.

## Privilegieneskalation durch NFS-Misconfigurationen

[NFS no\_root\_squash und no\_all\_squash Privilegieneskalation](../linux-hardening/privilege-escalation/nfs-no\_root\_squash-misconfiguration-pe.md)

## HackTricks Automatische Befehle
```
Protocol_Name: NFS    #Protocol Abbreviation if there is one.
Port_Number:  2049     #Comma separated if there is more than one.
Protocol_Description: Network File System         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for NFS
Note: |
NFS is a system designed for client/server that enables users to seamlessly access files over a network as though these files were located within a local directory.

#apt install nfs-common
showmount 10.10.10.180      ~or~showmount -e 10.10.10.180
should show you available shares (example /home)

mount -t nfs -o ver=2 10.10.10.180:/home /mnt/
cd /mnt
nano into /etc/passwd and change the uid (probably 1000 or 1001) to match the owner of the files if you are not able to get in

https://book.hacktricks.xyz/pentesting/nfs-service-pentesting

Entry_2:
Name: Nmap
Description: Nmap with NFS Scripts
Command: nmap --script=nfs-ls.nse,nfs-showmount.nse,nfs-statfs.nse -p 2049 {IP}
```
{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
