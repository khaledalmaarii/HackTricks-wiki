# 2049 - NFS Servisini Pentest Etme

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## **Temel Bilgiler**

**NFS**, kullanÄ±cÄ±larÄ±n dosyalara bir aÄŸ Ã¼zerinden, bu dosyalarÄ±n yerel bir dizinde bulunuyormuÅŸ gibi sorunsuz bir ÅŸekilde eriÅŸmelerini saÄŸlayan **istemci/sunucu** iÃ§in tasarlanmÄ±ÅŸ bir sistemdir.

Bu protokolÃ¼n dikkat Ã§ekici bir yÃ¶nÃ¼, yerleÅŸik **kimlik doÄŸrulama** veya **yetkilendirme mekanizmalarÄ±nÄ±n** olmamasÄ±dÄ±r. Bunun yerine, yetkilendirme **dosya sistemi bilgilerine** dayanÄ±r ve sunucu, **istemci tarafÄ±ndan saÄŸlanan kullanÄ±cÄ± bilgilerini** dosya sisteminin gerektirdiÄŸi **yetkilendirme formatÄ±na** doÄŸru bir ÅŸekilde Ã§evirmekle gÃ¶revlidir; bu genellikle **UNIX sÃ¶zdizimini** takip eder.

Kimlik doÄŸrulama genellikle **UNIX `UID`/`GID` tanÄ±mlayÄ±cÄ±larÄ± ve grup Ã¼yeliklerine** dayanÄ±r. Ancak, istemciler ve sunucular arasÄ±ndaki **`UID`/`GID` eÅŸleÅŸtirmelerindeki** olasÄ± uyumsuzluk nedeniyle bir zorluk ortaya Ã§Ä±kar; bu durum sunucu tarafÄ±ndan ek bir doÄŸrulama yapÄ±lmasÄ±na olanak tanÄ±maz. SonuÃ§ olarak, bu protokol, bu kimlik doÄŸrulama yÃ¶ntemine dayanmasÄ± nedeniyle en iyi ÅŸekilde **gÃ¼venilir aÄŸlar** iÃ§inde kullanÄ±lmak iÃ§in uygundur.

**VarsayÄ±lan port**: 2049/TCP/UDP (sadece versiyon 4 iÃ§in, TCP veya UDP yeterlidir).&#x20;
```
2049/tcp open  nfs     2-3 (RPC #100003
```
### Versiyonlar

- **NFSv2**: Bu versiyon, Ã§eÅŸitli sistemlerle geniÅŸ uyumluluÄŸu ile tanÄ±nÄ±r ve ilk iÅŸlemlerinin Ã§oÄŸunlukla UDP Ã¼zerinden gerÃ§ekleÅŸmesi ile Ã¶nemini vurgular. Serinin **en eski** versiyonu olarak, gelecekteki geliÅŸmeler iÃ§in bir temel oluÅŸturmuÅŸtur.

- **NFSv3**: Bir dizi iyileÅŸtirme ile tanÄ±tÄ±lan NFSv3, deÄŸiÅŸken dosya boyutlarÄ±nÄ± destekleyerek ve geliÅŸtirilmiÅŸ hata raporlama mekanizmalarÄ± sunarak selefinin Ã¼zerine Ã§Ä±kmÄ±ÅŸtÄ±r. GeliÅŸmelerine raÄŸmen, NFSv2 istemcileri ile tam geriye dÃ¶nÃ¼k uyumlulukta sÄ±nÄ±rlamalarla karÅŸÄ±laÅŸmÄ±ÅŸtÄ±r.

- **NFSv4**: NFS serisinde bir dÃ¶nÃ¼m noktasÄ± olan NFSv4, aÄŸlar Ã¼zerinden dosya paylaÅŸÄ±mÄ±nÄ± modernize etmek iÃ§in tasarlanmÄ±ÅŸ bir dizi Ã¶zellik getirmiÅŸtir. Dikkate deÄŸer iyileÅŸtirmeler arasÄ±nda **yÃ¼ksek gÃ¼venlik** iÃ§in Kerberos entegrasyonu, gÃ¼venlik duvarlarÄ±nÄ± aÅŸabilme ve port haritalayÄ±cÄ±larÄ±na ihtiyaÃ§ duymadan Ä°nternet Ã¼zerinden Ã§alÄ±ÅŸabilme yeteneÄŸi, EriÅŸim Kontrol Listeleri (ACL'ler) desteÄŸi ve durum tabanlÄ± iÅŸlemlerin tanÄ±tÄ±mÄ± bulunmaktadÄ±r. Performans iyileÅŸtirmeleri ve durum bilgisi olan bir protokolÃ¼n benimsenmesi, NFSv4'Ã¼ aÄŸ dosya paylaÅŸÄ±m teknolojilerinde Ã¶nemli bir ilerleme olarak ayÄ±rmaktadÄ±r.

NFS'nin her versiyonu, aÄŸ ortamlarÄ±nÄ±n geliÅŸen ihtiyaÃ§larÄ±nÄ± karÅŸÄ±lamak amacÄ±yla geliÅŸtirilmiÅŸ, gÃ¼venlik, uyumluluk ve performansÄ± kademeli olarak artÄ±rmÄ±ÅŸtÄ±r.

## SayÄ±m

### KullanÄ±ÅŸlÄ± nmap betikleri
```bash
nfs-ls #List NFS exports and check permissions
nfs-showmount #Like showmount -e
nfs-statfs #Disk statistics and info from NFS share
```
### KullanÄ±ÅŸlÄ± metasploit modÃ¼lleri
```bash
scanner/nfs/nfsmount #Scan NFS mounts and list permissions
```
### Mounting

Hangi **klasÃ¶rÃ¼n** sunucu tarafÄ±ndan **mevcut** olduÄŸunu Ã¶ÄŸrenmek iÃ§in ona ÅŸu ÅŸekilde sorabilirsiniz:
```bash
showmount -e <IP>
```
Sonra bunu kullanarak baÄŸlayÄ±n:
```bash
mount -t nfs [-o vers=2] <ip>:<remote_folder> <local_folder> -o nolock
```
**SÃ¼rÃ¼m 2'yi kullanmayÄ± belirtmelisiniz** Ã§Ã¼nkÃ¼ **herhangi bir** **kimlik doÄŸrulama** veya **yetkilendirme** iÃ§ermez.

**Ã–rnek:**
```bash
mkdir /mnt/new_back
mount -t nfs [-o vers=2] 10.12.0.150:/backup /mnt/new_back -o nolock
```
## Ä°zinler

EÄŸer yalnÄ±zca bazÄ± kullanÄ±cÄ±lar tarafÄ±ndan eriÅŸilebilen **dosyalar veya klasÃ¶rler** iÃ§eren bir klasÃ¶rÃ¼ baÄŸlarsanÄ±z (**UID** ile). O **UID** ile **yerel** olarak bir kullanÄ±cÄ± **oluÅŸturabilir** ve bu **kullanÄ±cÄ±** ile dosya/klasÃ¶re **eriÅŸebilirsiniz**.

## NSFShell

DosyalarÄ± eriÅŸmek iÃ§in UID ve GID'yi kolayca listelemek, baÄŸlamak ve deÄŸiÅŸtirmek iÃ§in [nfsshell](https://github.com/NetDirect/nfsshell) kullanabilirsiniz.

[GÃ¼zel NFSShell eÄŸitimi.](https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/)

## YapÄ±landÄ±rma dosyalarÄ±
```
/etc/exports
/etc/lib/nfs/etab
```
### Tehlikeli ayarlar

- **Okuma ve Yazma Ä°zinleri (`rw`):** Bu ayar, dosya sisteminden hem okuma hem de yazma iÅŸlemlerine izin verir. Bu kadar geniÅŸ bir eriÅŸim izni vermenin sonuÃ§larÄ±nÄ± dikkate almak Ã¶nemlidir.

- **GÃ¼vensiz PortlarÄ±n KullanÄ±mÄ± (`insecure`):** Bu etkinleÅŸtirildiÄŸinde, sistemin 1024'Ã¼n Ã¼zerindeki portlarÄ± kullanmasÄ±na izin verir. Bu aralÄ±ktaki portlarÄ±n gÃ¼venliÄŸi daha az katÄ± olabilir ve riski artÄ±rabilir.

- **Ä°Ã§ Ä°Ã§e Dosya Sistemlerinin GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ (`nohide`):** Bu yapÄ±landÄ±rma, baÅŸka bir dosya sistemi bir dÄ±ÅŸa aktarÄ±lmÄ±ÅŸ dizinin altÄ±nda monte edilse bile dizinlerin gÃ¶rÃ¼nÃ¼r olmasÄ±nÄ± saÄŸlar. Her dizin, uygun yÃ¶netim iÃ§in kendi dÄ±ÅŸa aktarma giriÅŸine ihtiyaÃ§ duyar.

- **KÃ¶k DosyalarÄ±nÄ±n SahipliÄŸi (`no_root_squash`):** Bu ayar ile, kÃ¶k kullanÄ±cÄ± tarafÄ±ndan oluÅŸturulan dosyalar, 0 olan orijinal UID/GID'lerini korur, bu da en az ayrÄ±calÄ±k ilkesini gÃ¶z ardÄ± eder ve aÅŸÄ±rÄ± izinler verebilir.

- **TÃ¼m KullanÄ±cÄ±larÄ±n Squash Edilmemesi (`no_all_squash`):** Bu seÃ§enek, kullanÄ±cÄ± kimliklerinin sistem genelinde korunmasÄ±nÄ± saÄŸlar, bu da doÄŸru bir ÅŸekilde ele alÄ±nmadÄ±ÄŸÄ±nda izin ve eriÅŸim kontrol sorunlarÄ±na yol aÃ§abilir.

## NFS yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± ile AyrÄ±calÄ±k YÃ¼kseltme

[NFS no\_root\_squash ve no\_all\_squash ayrÄ±calÄ±k yÃ¼kseltmesi](../linux-hardening/privilege-escalation/nfs-no\_root\_squash-misconfiguration-pe.md)

## HackTricks Otomatik Komutlar
```
Protocol_Name: NFS    #Protocol Abbreviation if there is one.
Port_Number:  2049     #Comma separated if there is more than one.
Protocol_Description: Network File System         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for NFS
Note: |
NFS is a system designed for client/server that enables users to seamlessly access files over a network as though these files were located within a local directory.

#apt install nfs-common
showmount 10.10.10.180      ~or~showmount -e 10.10.10.180
should show you available shares (example /home)

mount -t nfs -o ver=2 10.10.10.180:/home /mnt/
cd /mnt
nano into /etc/passwd and change the uid (probably 1000 or 1001) to match the owner of the files if you are not able to get in

https://book.hacktricks.xyz/pentesting/nfs-service-pentesting

Entry_2:
Name: Nmap
Description: Nmap with NFS Scripts
Command: nmap --script=nfs-ls.nse,nfs-showmount.nse,nfs-statfs.nse -p 2049 {IP}
```
{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
