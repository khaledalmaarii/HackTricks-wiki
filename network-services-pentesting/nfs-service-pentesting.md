# 2049 - Pentestiranje NFS servisa

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **cybersecurity kompaniji**? Å½elite li da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u**? Ili Å¾elite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **PridruÅ¾ite se** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## **Osnovne informacije**

**NFS** je sistem dizajniran za **klijent/server** koji omoguÄ‡ava korisnicima da na mreÅ¾i pristupaju datotekama kao da se one nalaze u lokalnom direktorijumu.

ZnaÄajan aspekt ovog protokola je nedostatak ugraÄ‘enih **mekanizama za autentifikaciju** ili **autorizaciju**. Umesto toga, autorizacija se oslanja na **informacije o fajl sistemu**, pri Äemu je server zaduÅ¾en za taÄno prevoÄ‘enje **informacija o korisniku koje pruÅ¾a klijent** u potrebni **format autorizacije** fajl sistema, uglavnom prateÄ‡i **UNIX sintaksu**.

Autentifikacija se obiÄno oslanja na **UNIX `UID`/`GID` identifikatore i Älanstvo u grupama**. MeÄ‘utim, izazov se javlja zbog potencijalne neusklaÄ‘enosti u **mapiranjima `UID`/`GID`** izmeÄ‘u klijenata i servera, ne ostavljajuÄ‡i prostora za dodatnu verifikaciju od strane servera. Stoga je protokol najbolje prilagoÄ‘en za upotrebu unutar **poverenih mreÅ¾a**, s obzirom na njegovu oslanjanje na ovaj metod autentifikacije.

**Podrazumevani port**: 2049/TCP/UDP (osim verzije 4, koja zahteva samo TCP ili UDP).&#x20;
```
2049/tcp open  nfs     2-3 (RPC #100003
```
### Verzije

- **NFSv2**: Ova verzija je poznata po svojoj Å¡irokoj kompatibilnosti sa razliÄitim sistemima, a njen znaÄaj se ogleda u tome Å¡to su poÄetne operacije uglavnom izvrÅ¡avane preko UDP-a. Kao **najstarija** u seriji, postavila je temelje za buduÄ‡i razvoj.

- **NFSv3**: Uvedena sa nizom poboljÅ¡anja, NFSv3 je proÅ¡irio svoje prethodnika podrÅ¾avajuÄ‡i promenljive veliÄine fajlova i nudeÄ‡i unapreÄ‘eni mehanizam za prijavu greÅ¡aka. Uprkos svojim napredovanjima, suoÄavao se sa ograniÄenjima u potpunoj kompatibilnosti sa NFSv2 klijentima.

- **NFSv4**: Pionirska verzija u seriji NFS, NFSv4 je donela niz funkcionalnosti dizajniranih za modernizaciju deljenja fajlova preko mreÅ¾e. ZnaÄajna poboljÅ¡anja ukljuÄuju integraciju Kerberosa za **visoku bezbednost**, moguÄ‡nost prolaska kroz firewall-ove i rad preko interneta bez potrebe za portmaperima, podrÅ¡ku za Access Control List (ACL) i uvoÄ‘enje operacija zasnovanih na stanju. Njegova poboljÅ¡anja performansi i usvajanje protokola sa stanjem izdvajaju NFSv4 kao kljuÄni napredak u tehnologijama deljenja fajlova preko mreÅ¾e.

Svaka verzija NFS-a je razvijena sa namerom da se adresiraju evoluirajuÄ‡e potrebe mreÅ¾nih okruÅ¾enja, postepeno unapreÄ‘ujuÄ‡i bezbednost, kompatibilnost i performanse.

## Enumeracija

### Korisni nmap skriptovi
```bash
nfs-ls #List NFS exports and check permissions
nfs-showmount #Like showmount -e
nfs-statfs #Disk statistics and info from NFS share
```
### Korisni metasploit moduli

Metasploit je moÄ‡an alat za testiranje penetracije koji pruÅ¾a Å¡irok spektar modula za iskoriÅ¡Ä‡avanje ranjivosti. Ovi moduli omoguÄ‡avaju hakerima da automatizuju proces pronalaÅ¾enja i iskoriÅ¡Ä‡avanja ranjivosti u ciljnom sistemu. Evo nekoliko korisnih metasploit modula koji se mogu koristiti u testiranju penetracije:

- `exploit/multi/handler`: Ovaj modul omoguÄ‡ava hakerima da postave "ruÄni" iskoriÅ¡Ä‡avaÄ koji Ä‡e osluÅ¡kivati dolazne veze i preuzeti kontrolu nad ranjivim sistemom.

- `exploit/windows/smb/ms17_010_eternalblue`: Ovaj modul iskoriÅ¡Ä‡ava ranjivost EternalBlue u Windows SMB protokolu kako bi omoguÄ‡io hakerima da izvrÅ¡e udaljeni kod na ciljnom Windows sistemu.

- `exploit/linux/ftp/vsftpd_234_backdoor`: Ovaj modul iskoriÅ¡Ä‡ava ranjivost u vsftpd FTP serveru verzije 2.3.4 koja omoguÄ‡ava hakerima da dobiju udaljeni pristup sistemu.

- `exploit/multi/http/php_cgi_arg_injection`: Ovaj modul iskoriÅ¡Ä‡ava ranjivost u PHP CGI skriptama koja omoguÄ‡ava hakerima da izvrÅ¡e proizvoljan kod na ciljnom sistemu.

- `exploit/multi/misc/java_rmi_server`: Ovaj modul iskoriÅ¡Ä‡ava ranjivost u Java RMI serverima koja omoguÄ‡ava hakerima da izvrÅ¡e proizvoljan kod na ciljnom sistemu.

- `exploit/multi/browser/java_signed_applet`: Ovaj modul iskoriÅ¡Ä‡ava ranjivost u Java potpisanim appletima koja omoguÄ‡ava hakerima da izvrÅ¡e proizvoljan kod na ciljnom sistemu.

Ovi moduli su samo neki od mnogih dostupnih u Metasploit okruÅ¾enju. Hakeri mogu koristiti ove module kao deo svoje strategije testiranja penetracije kako bi identifikovali i iskoristili ranjivosti u ciljnom sistemu.
```bash
scanner/nfs/nfsmount #Scan NFS mounts and list permissions
```
### Montiranje

Da biste saznali **koji folder** na serveru je **dostupan** za montiranje, moÅ¾ete ga pitati koristeÄ‡i:
```bash
showmount -e <IP>
```
Zatim ga montirajte koristeÄ‡i:
```bash
mount -t nfs [-o vers=2] <ip>:<remote_folder> <local_folder> -o nolock
```
Treba da specificirate da **koristite verziju 2** jer ona nema **nikakvu** **autentifikaciju** ili **autorizaciju**.

**Primer:**
```bash
mkdir /mnt/new_back
mount -t nfs [-o vers=2] 10.12.0.150:/backup /mnt/new_back -o nolock
```
## Dozvole

Ako montirate fasciklu koja sadrÅ¾i **datoteke ili fascikle kojima je pristup dozvoljen samo odreÄ‘enom korisniku** (preko **UID**-a), moÅ¾ete **lokalno kreirati** korisnika sa tim **UID**-om i koristiti tog korisnika da biste **pristupili** datoteci/fascikli.

## NSFShell

Da biste lako izlistali, montirali i promenili UID i GID kako biste imali pristup datotekama, moÅ¾ete koristiti [nfsshell](https://github.com/NetDirect/nfsshell).

[Lepe uputstva za koriÅ¡Ä‡enje NFSShell-a.](https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/)

## Konfiguracione datoteke
```
/etc/exports
/etc/lib/nfs/etab
```
### Opasne postavke

- **Dozvole za Äitanje i pisanje (`rw`):** Ova postavka omoguÄ‡ava i Äitanje i pisanje u fajl sistem. VaÅ¾no je razmotriti posledice davanja tako Å¡iroke pristupne dozvole.

- **KoriÅ¡Ä‡enje nesigurnih portova (`insecure`):** Kada je omoguÄ‡eno, ovo omoguÄ‡ava sistemu da koristi portove iznad 1024. Sigurnost portova iznad ove opsega moÅ¾e biti manje stroga, poveÄ‡avajuÄ‡i rizik.

- **Vidljivost ugnjeÅ¾denih fajl sistema (`nohide`):** Ova konfiguracija Äini direktorijume vidljivim Äak i ako je drugi fajl sistem montiran ispod izvezenog direktorijuma. Svaki direktorijum zahteva svoj sopstveni unos za izvoz radi pravilnog upravljanja.

- **VlasniÅ¡tvo fajlova od strane korisnika root (`no_root_squash`):** Sa ovom postavkom, fajlovi kreirani od strane korisnika root zadrÅ¾avaju svoj originalni UID/GID od 0, ignorirajuÄ‡i princip najmanjih privilegija i potencijalno dodeljujuÄ‡i prekomerne dozvole.

- **Nesquashing svih korisnika (`no_all_squash`):** Ova opcija obezbeÄ‘uje da se identiteti korisnika oÄuvaju u celom sistemu, Å¡to moÅ¾e dovesti do problema sa dozvolama i kontrolom pristupa ako se ne rukuje ispravno.

## Eskalacija privilegija koriÅ¡Ä‡enjem loÅ¡e konfigurisanih NFS-a

[NFS no\_root\_squash i no\_all\_squash eskalacija privilegija](../linux-hardening/privilege-escalation/nfs-no\_root\_squash-misconfiguration-pe.md)

## HackTricks Automatske Komande
```
Protocol_Name: NFS    #Protocol Abbreviation if there is one.
Port_Number:  2049     #Comma separated if there is more than one.
Protocol_Description: Network File System         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for NFS
Note: |
NFS is a system designed for client/server that enables users to seamlessly access files over a network as though these files were located within a local directory.

#apt install nfs-common
showmount 10.10.10.180      ~or~showmount -e 10.10.10.180
should show you available shares (example /home)

mount -t nfs -o ver=2 10.10.10.180:/home /mnt/
cd /mnt
nano into /etc/passwd and change the uid (probably 1000 or 1001) to match the owner of the files if you are not able to get in

https://book.hacktricks.xyz/pentesting/nfs-service-pentesting

Entry_2:
Name: Nmap
Description: Nmap with NFS Scripts
Command: nmap --script=nfs-ls.nse,nfs-showmount.nse,nfs-statfs.nse -p 2049 {IP}
```
<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **cybersecurity kompaniji**? Å½elite li da vidite svoju **kompaniju reklamiranu na HackTricks-u**? Ili Å¾elite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **PridruÅ¾ite se** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
