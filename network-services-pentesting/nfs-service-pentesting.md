# 2049 - Pentesting NFS Service

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Osnovne informacije**

**NFS** je sistem dizajniran za **klijent/server** koji omogu캖ava korisnicima da besprekorno pristupaju datotekama preko mre쬰 kao da su te datoteke sme코tene unutar lokalnog direktorijuma.

Zna캜ajan aspekt ovog protokola je njegov nedostatak ugra캠enih **mehanizama autentifikacije** ili **autorizacije**. Umesto toga, autorizacija se oslanja na **informacije o datote캜nom sistemu**, pri 캜emu je server zadu쬰n za ta캜no prevo캠enje **informacija o korisniku koje pru쬬 klijent** u potrebni **format autorizacije** datote캜nog sistema, prvenstveno prate캖i **UNIX sintaksu**.

Autentifikacija se obi캜no oslanja na **UNIX `UID`/`GID` identifikatore i 캜lanstva u grupama**. Me캠utim, izazov nastaje zbog potencijalne nesaglasnosti u **`UID`/`GID` mapiranju** izme캠u klijenata i servera, ostavljaju캖i bez prostora za dodatnu verifikaciju od strane servera. Kao rezultat, protokol je najbolje koristiti unutar **pouzdanih mre쬬**, s obzirom na to da se oslanja na ovu metodu autentifikacije.

**Podrazumevani port**: 2049/TCP/UDP (osim verzije 4, potrebni su samo TCP ili UDP).&#x20;
```
2049/tcp open  nfs     2-3 (RPC #100003
```
### Verzije

- **NFSv2**: Ova verzija je prepoznata po 코irokoj kompatibilnosti sa raznim sistemima, ozna캜avaju캖i njen zna캜aj sa po캜etnim operacijama prete쬹o preko UDP-a. Kao **najstarija** u seriji, postavila je temelje za budu캖e razvoj.

- **NFSv3**: Uvedena sa nizom pobolj코anja, NFSv3 je pro코irila svog prethodnika podr쬬vaju캖i promenljive veli캜ine datoteka i nude캖i pobolj코ane mehanizme izve코tavanja o gre코kama. I pored svojih napredaka, suo캜ila se sa ograni캜enjima u punoj unazadnoj kompatibilnosti sa NFSv2 klijentima.

- **NFSv4**: Prelomna verzija u NFS seriji, NFSv4 je donela niz funkcija dizajniranih da modernizuju deljenje datoteka preko mre쬬. Zna캜ajna pobolj코anja uklju캜uju integraciju Kerberosa za **visoku sigurnost**, sposobnost prelaska kroz vatrozidove i rad preko Interneta bez potrebe za portmaperima, podr코ku za liste kontrole pristupa (ACL), i uvo캠enje operacija zasnovanih na stanju. Njena pobolj코anja u performansama i usvajanje protokola zasnovanog na stanju izdvajaju NFSv4 kao klju캜ni napredak u tehnologijama deljenja mre쬹ih datoteka.

Svaka verzija NFS-a je razvijena sa namerom da odgovori na evoluiraju캖e potrebe mre쬹ih okru쬰nja, postepeno pobolj코avaju캖i sigurnost, kompatibilnost i performanse.

## Enumeracija

### Korisni nmap skripti
```bash
nfs-ls #List NFS exports and check permissions
nfs-showmount #Like showmount -e
nfs-statfs #Disk statistics and info from NFS share
```
### Korisni metasploit moduli
```bash
scanner/nfs/nfsmount #Scan NFS mounts and list permissions
```
### Mounting

Da biste saznali **koju fasciklu** server ima **dostupnu** za montiranje, mo쬰te ga pitati koriste캖i:
```bash
showmount -e <IP>
```
Zatim ga montirajte koriste캖i:
```bash
mount -t nfs [-o vers=2] <ip>:<remote_folder> <local_folder> -o nolock
```
Trebalo bi da navedete da **koristite verziju 2** jer nema **nikakvu** **autentifikaciju** ili **autorizaciju**.

**Primer:**
```bash
mkdir /mnt/new_back
mount -t nfs [-o vers=2] 10.12.0.150:/backup /mnt/new_back -o nolock
```
## Dozvole

Ako montirate folder koji sadr쬴 **fajlove ili foldere koji su dostupni samo nekim korisnicima** (preko **UID**). Mo쬰te **napraviti** **lokalno** korisnika sa tim **UID** i koriste캖i tog **korisnika** mo캖i 캖ete da **pristupite** fajlu/folderu.

## NSFShell

Da biste lako listali, montirali i menjali UID i GID kako biste imali pristup fajlovima, mo쬰te koristiti [nfsshell](https://github.com/NetDirect/nfsshell).

[Nice NFSShell tutorial.](https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/)

## Konfiguracione datoteke
```
/etc/exports
/etc/lib/nfs/etab
```
### Opasne postavke

- **Dozvole za 캜itanje i pisanje (`rw`):** Ova postavka omogu캖ava i 캜itanje i pisanje u fajl sistem. Va쬹o je razmotriti posledice davanja tako 코irokog pristupa.

- **Kori코캖enje nesigurnih portova (`insecure`):** Kada je omogu캖eno, ovo omogu캖ava sistemu da koristi portove iznad 1024. Bezbednost portova iznad ovog opsega mo쬰 biti manje stroga, pove캖avaju캖i rizik.

- **Vidljivost ugnje쬯enih fajl sistema (`nohide`):** Ova konfiguracija 캜ini direktorijume vidljivim 캜ak i ako je drugi fajl sistem montiran ispod izvezenog direktorijuma. Svakom direktorijumu je potrebna sopstvena izvozna stavka za pravilno upravljanje.

- **Vlasni코tvo fajlova od strane root korisnika (`no_root_squash`):** Sa ovom postavkom, fajlovi koje kreira root korisnik zadr쬬vaju svoj originalni UID/GID od 0, zanemaruju캖i princip minimalnih privilegija i potencijalno dodeljuju캖i prekomerne dozvole.

- **Nesmanjenje svih korisnika (`no_all_squash`):** Ova opcija osigurava da identiteti korisnika budu o캜uvani 코irom sistema, 코to mo쬰 dovesti do problema sa dozvolama i kontrolom pristupa ako se ne upravlja pravilno.

## Eskalacija privilegija kori코캖enjem NFS pogre코nih konfiguracija

[NFS no\_root\_squash i no\_all\_squash eskalacija privilegija](../linux-hardening/privilege-escalation/nfs-no\_root\_squash-misconfiguration-pe.md)

## HackTricks Automatske komande
```
Protocol_Name: NFS    #Protocol Abbreviation if there is one.
Port_Number:  2049     #Comma separated if there is more than one.
Protocol_Description: Network File System         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for NFS
Note: |
NFS is a system designed for client/server that enables users to seamlessly access files over a network as though these files were located within a local directory.

#apt install nfs-common
showmount 10.10.10.180      ~or~showmount -e 10.10.10.180
should show you available shares (example /home)

mount -t nfs -o ver=2 10.10.10.180:/home /mnt/
cd /mnt
nano into /etc/passwd and change the uid (probably 1000 or 1001) to match the owner of the files if you are not able to get in

https://book.hacktricks.xyz/pentesting/nfs-service-pentesting

Entry_2:
Name: Nmap
Description: Nmap with NFS Scripts
Command: nmap --script=nfs-ls.nse,nfs-showmount.nse,nfs-statfs.nse -p 2049 {IP}
```
{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
