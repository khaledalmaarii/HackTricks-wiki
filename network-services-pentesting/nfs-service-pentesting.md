# 2049 - NFS Hizmeti Pentesting

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana dÃ¶nÃ¼ÅŸÃ¼n</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>ile Ã¶ÄŸrenin!</strong></summary>

* Bir **cybersecurity ÅŸirketinde** Ã§alÄ±ÅŸÄ±yor musunuz? **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** ister misiniz? veya **PEASS'Ä±n en son sÃ¼rÃ¼mÃ¼ne veya HackTricks'i PDF olarak indirmek** ister misiniz? [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonunu.
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter**'da ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi [hacktricks repo](https://github.com/carlospolop/hacktricks) ve [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**'ya PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## **Temel Bilgiler**

**NFS**, kullanÄ±cÄ±larÄ±n aÄŸ Ã¼zerinden dosyalara yerel bir dizin iÃ§indeymiÅŸ gibi sorunsuz eriÅŸim saÄŸlamasÄ±nÄ± saÄŸlayan bir **istemci/sunucu** sistemi olarak tasarlanmÄ±ÅŸtÄ±r.

Bu protokolÃ¼n dikkate deÄŸer bir yÃ¶nÃ¼, yerleÅŸik bir **kimlik doÄŸrulama** veya **yetkilendirme mekanizmasÄ±** olmamasÄ±dÄ±r. Bunun yerine, yetkilendirme, **dosya sistemi bilgilerine** dayanÄ±r ve sunucu, **istemci tarafÄ±ndan saÄŸlanan kullanÄ±cÄ± bilgilerini** dosya sisteminin gerektirdiÄŸi **yetkilendirme formatÄ±na** doÄŸru bir ÅŸekilde Ã§evirmekle gÃ¶revlidir, temel olarak **UNIX sÃ¶zdizimini** takip eder.

Kimlik doÄŸrulama genellikle **UNIX `UID`/`GID` tanÄ±mlayÄ±cÄ±larÄ± ve grup Ã¼yelikleri**ne dayanÄ±r. Ancak, istemciler ve sunucular arasÄ±ndaki **`UID`/`GID` eÅŸlemelerindeki** potansiyel uyumsuzluk nedeniyle bir zorluk ortaya Ã§Ä±kar ve sunucu tarafÄ±ndan ek doÄŸrulama yapÄ±lamaz. SonuÃ§ olarak, bu protokol, bu kimlik doÄŸrulama yÃ¶ntemine dayandÄ±ÄŸÄ± iÃ§in **gÃ¼venilen aÄŸlar** iÃ§inde kullanmak iÃ§in en uygun olanÄ±dÄ±r.

**VarsayÄ±lan port**: 2049/TCP/UDP (sadece 4. sÃ¼rÃ¼m iÃ§in TCP veya UDP gereklidir).&#x20;
```
2049/tcp open  nfs     2-3 (RPC #100003
```
### SÃ¼rÃ¼mler

- **NFSv2**: Bu sÃ¼rÃ¼m, Ã§eÅŸitli sistemlerle geniÅŸ uyumluluÄŸuyla tanÄ±nÄ±r ve baÅŸlangÄ±Ã§ iÅŸlemlerini Ã§oÄŸunlukla UDP Ã¼zerinden gerÃ§ekleÅŸtirerek Ã¶nemini belirtir. Serinin en **eski** sÃ¼rÃ¼mÃ¼ olan NFSv2, gelecekteki geliÅŸmeler iÃ§in temel oluÅŸturdu.

- **NFSv3**: Bir dizi geliÅŸtirme ile tanÄ±tÄ±lan NFSv3, Ã¶nceki sÃ¼rÃ¼mÃ¼nÃ¼ destekleyen deÄŸiÅŸken dosya boyutlarÄ±nÄ± destekleyerek ve geliÅŸmiÅŸ hata raporlama mekanizmalarÄ± sunarak Ã¶nceki sÃ¼rÃ¼mÃ¼nÃ¼ geniÅŸletti. GeliÅŸmelerine raÄŸmen, NFSv2 istemcileriyle tam geriye dÃ¶nÃ¼k uyumlulukta sÄ±nÄ±rlamalarla karÅŸÄ±laÅŸtÄ±.

- **NFSv4**: NFS serisinin dÃ¶nÃ¼m noktasÄ± olan NFSv4, aÄŸlar arasÄ±nda dosya paylaÅŸÄ±mÄ±nÄ± modernize etmek iÃ§in tasarlanmÄ±ÅŸ bir dizi Ã¶zellik getirdi. Dikkate deÄŸer iyileÅŸtirmeler arasÄ±nda **yÃ¼ksek gÃ¼venlik** iÃ§in Kerberos'un entegrasyonu, port eÅŸlemcilerine ihtiyaÃ§ duymadan gÃ¼venlik duvarlarÄ±nÄ± aÅŸabilme ve Ä°nternet Ã¼zerinden Ã§alÄ±ÅŸabilme yeteneÄŸi, EriÅŸim Kontrol Listeleri (ACL'ler) iÃ§in destek ve durum tabanlÄ± iÅŸlemlerin tanÄ±tÄ±lmasÄ± bulunur. Performans iyileÅŸtirmeleri ve durum tabanlÄ± bir protokolÃ¼n benimsenmesi, NFSv4'Ã¼ aÄŸ dosya paylaÅŸÄ±m teknolojilerinde Ã¶nemli bir ilerleme olarak ayÄ±rt eder.

Her NFS sÃ¼rÃ¼mÃ¼, aÄŸ ortamlarÄ±nÄ±n geliÅŸen ihtiyaÃ§larÄ±nÄ± ele almak, gÃ¼venliÄŸi, uyumluluÄŸu ve performansÄ± aÅŸamalÄ± olarak artÄ±rmak amacÄ±yla geliÅŸtirilmiÅŸtir.

## NumaralandÄ±rma

### KullanÄ±ÅŸlÄ± nmap komut dosyalarÄ±
```bash
nfs-ls #List NFS exports and check permissions
nfs-showmount #Like showmount -e
nfs-statfs #Disk statistics and info from NFS share
```
### KullanÄ±ÅŸlÄ± metasploit modÃ¼lleri

Metasploit, birÃ§ok farklÄ± aÄŸ hizmetini hedef almak iÃ§in kullanÄ±lan gÃ¼Ã§lÃ¼ bir araÃ§tÄ±r. AÅŸaÄŸÄ±da, NFS hizmeti iÃ§in kullanÄ±ÅŸlÄ± olan bazÄ± Metasploit modÃ¼llerini bulabilirsiniz:

- `auxiliary/scanner/nfs/nfsmount`: Bu modÃ¼l, NFS sunucularÄ±nÄ± taramak ve paylaÅŸÄ±mlarÄ± listelemek iÃ§in kullanÄ±lÄ±r.
- `auxiliary/scanner/nfs/nfsenum`: Bu modÃ¼l, NFS sunucularÄ±nda dosya ve dizinleri keÅŸfetmek iÃ§in kullanÄ±lÄ±r.
- `exploit/linux/nfs/nfsd`: Bu modÃ¼l, NFS sunucularÄ±nda gÃ¼venlik aÃ§Ä±klarÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in kullanÄ±lÄ±r.
- `exploit/solaris/nfs/nfsd`: Bu modÃ¼l, Solaris iÅŸletim sistemli NFS sunucularÄ±nda gÃ¼venlik aÃ§Ä±klarÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in kullanÄ±lÄ±r.
- `exploit/windows/nfs/nfsd`: Bu modÃ¼l, Windows iÅŸletim sistemli NFS sunucularÄ±nda gÃ¼venlik aÃ§Ä±klarÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in kullanÄ±lÄ±r.

Bu modÃ¼ller, NFS hizmetini hedef almak ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± tespit etmek veya sÃ¶mÃ¼rmek iÃ§in kullanÄ±labilir. Metasploit'in sunduÄŸu diÄŸer modÃ¼llerle birlikte, kapsamlÄ± bir NFS pentesting deneyimi saÄŸlarlar.
```bash
scanner/nfs/nfsmount #Scan NFS mounts and list permissions
```
### BaÄŸlama

Hangi klasÃ¶rÃ¼n sunucunun baÄŸlamaya uygun olduÄŸunu bilmek iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:
```bash
showmount -e <IP>
```
ArdÄ±ndan ÅŸunu kullanarak baÄŸlayÄ±n:
```bash
mount -t nfs [-o vers=2] <ip>:<remote_folder> <local_folder> -o nolock
```
**Ã–rnek:**
```bash
mkdir /mnt/new_back
mount -t nfs [-o vers=2] 10.12.0.150:/backup /mnt/new_back -o nolock
```
## Ä°zinler

EÄŸer **UID** tarafÄ±ndan sadece bazÄ± kullanÄ±cÄ±larÄ±n eriÅŸebildiÄŸi **dosya veya klasÃ¶rleri iÃ§eren bir klasÃ¶rÃ¼** baÄŸlarsanÄ±z. Bu **UID**'ye sahip bir **kullanÄ±cÄ±yÄ± yerel olarak oluÅŸturabilir** ve bu **kullanÄ±cÄ±yÄ± kullanarak** dosya/klasÃ¶re eriÅŸebilirsiniz.

## NSFShell

Dosyalara eriÅŸmek iÃ§in UID ve GID'yi kolayca listelemek, baÄŸlamak ve deÄŸiÅŸtirmek iÃ§in [nfsshell](https://github.com/NetDirect/nfsshell) kullanabilirsiniz.

[GÃ¼zel bir NFSShell Ã¶ÄŸretici.](https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/)

## YapÄ±landÄ±rma dosyalarÄ±
```
/etc/exports
/etc/lib/nfs/etab
```
### Tehlikeli Ayarlar

- **Okuma ve Yazma Ä°zinleri (`rw`):** Bu ayar, dosya sisteminden hem okuma hem de yazma iÅŸlemlerine izin verir. Bu geniÅŸ eriÅŸimin sonuÃ§larÄ±nÄ± dÃ¼ÅŸÃ¼nmek Ã¶nemlidir.

- **GÃ¼vensiz PortlarÄ±n KullanÄ±mÄ± (`insecure`):** Bu etkinleÅŸtirildiÄŸinde, sistem 1024'den bÃ¼yÃ¼k portlarÄ± kullanabilir. Bu aralÄ±ktaki portlarÄ±n gÃ¼venliÄŸi daha az sÄ±kÄ± olabilir ve riski artÄ±rabilir.

- **GÃ¶mÃ¼lÃ¼ Dosya Sistemlerinin GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ (`nohide`):** Bu yapÄ±landÄ±rma, baÅŸka bir dosya sistemi bir ihracat edilen dizinin altÄ±na baÄŸlandÄ±ÄŸÄ±nda bile dizinleri gÃ¶rÃ¼nÃ¼r hale getirir. Her dizin, uygun yÃ¶netim iÃ§in kendi ihracat giriÅŸine ihtiyaÃ§ duyar.

- **KÃ¶k DosyalarÄ±nÄ±n SahipliÄŸi (`no_root_squash`):** Bu ayarla, kÃ¶k kullanÄ±cÄ±sÄ± tarafÄ±ndan oluÅŸturulan dosyalar, en az ayrÄ±calÄ±k ilkesini gÃ¶z ardÄ± ederek orijinal UID/GID deÄŸerlerini korur ve aÅŸÄ±rÄ± izinler saÄŸlayabilir.

- **TÃ¼m KullanÄ±cÄ±larÄ±n SÄ±kÄ±ÅŸtÄ±rÄ±lmamasÄ± (`no_all_squash`):** Bu seÃ§enek, kullanÄ±cÄ± kimliklerinin sistem genelinde korunmasÄ±nÄ± saÄŸlar, ancak doÄŸru ÅŸekilde yÃ¶netilmezse izin ve eriÅŸim kontrol sorunlarÄ±na yol aÃ§abilir.

## NFS hatalÄ± yapÄ±landÄ±rmalarÄ±nÄ± kullanarak AyrÄ±calÄ±k YÃ¼kseltme

[NFS no\_root\_squash ve no\_all\_squash ayrÄ±calÄ±k yÃ¼kseltme](../linux-hardening/privilege-escalation/nfs-no\_root\_squash-misconfiguration-pe.md)

## HackTricks Otomatik KomutlarÄ±
```
Protocol_Name: NFS    #Protocol Abbreviation if there is one.
Port_Number:  2049     #Comma separated if there is more than one.
Protocol_Description: Network File System         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for NFS
Note: |
NFS is a system designed for client/server that enables users to seamlessly access files over a network as though these files were located within a local directory.

#apt install nfs-common
showmount 10.10.10.180      ~or~showmount -e 10.10.10.180
should show you available shares (example /home)

mount -t nfs -o ver=2 10.10.10.180:/home /mnt/
cd /mnt
nano into /etc/passwd and change the uid (probably 1000 or 1001) to match the owner of the files if you are not able to get in

https://book.hacktricks.xyz/pentesting/nfs-service-pentesting

Entry_2:
Name: Nmap
Description: Nmap with NFS Scripts
Command: nmap --script=nfs-ls.nse,nfs-showmount.nse,nfs-statfs.nse -p 2049 {IP}
```
<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmaya kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

* Bir **cybersecurity ÅŸirketinde mi Ã§alÄ±ÅŸÄ±yorsunuz**? **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** ister misiniz? veya **PEASS'Ä±n en son sÃ¼rÃ¼mÃ¼ne veya HackTricks'i PDF olarak indirmek** ister misiniz? [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family), Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin.
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter**'da beni takip edin ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Hacking hilelerinizi [hacktricks repo](https://github.com/carlospolop/hacktricks) ve [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)'ya PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
