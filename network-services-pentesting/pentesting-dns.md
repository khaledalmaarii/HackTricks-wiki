# 53 - Testowanie penetracyjne DNS

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Natychmiastowe dostpne narzdzie do oceny podatnoci i testowania penetracyjnego**. Uruchom pene testowanie penetracyjne z dowolnego miejsca za pomoc ponad 20 narzdzi i funkcji, kt贸re obejmuj od rozpoznania po raportowanie. Nie zastpujemy tester贸w penetracyjnych - opracowujemy niestandardowe narzdzia, moduy wykrywania i eksploatacji, aby da im wicej czasu na gbsze dr偶enie, otwieranie powok i dobr zabaw.

{% embed url="https://pentest-tools.com/" %}

## **Podstawowe informacje**

**System nazw domenowych (DNS)** peni funkcj katalogu internetowego, umo偶liwiajc u偶ytkownikom dostp do witryn za pomoc **atwych do zapamitania nazw domenowych**, takich jak google.com lub facebook.com, zamiast numerycznych adres贸w protokou internetowego (IP). Przez tumaczenie nazw domenowych na adresy IP, DNS zapewnia, 偶e przegldarki internetowe mog szybko adowa zasoby internetowe, upraszczajc spos贸b poruszania si po wiecie online.

**Domylny port:** 53
```
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
5353/udp open  zeroconf udp-response
53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```
### R贸偶ne serwery DNS

- **Serwery korzeniowe DNS**: S one na szczycie hierarchii DNS, zarzdzajc domenami najwy偶szego poziomu i interweniuj tylko wtedy, gdy serwery ni偶szego poziomu nie odpowiadaj. Internet Corporation for Assigned Names and Numbers (**ICANN**) nadzoruje ich dziaanie, a ich globalna liczba wynosi 13.

- **Serwery autorytatywne**: Te serwery maj ostatnie sowo w kwestii zapyta w swoich strefach, oferujc ostateczne odpowiedzi. Jeli nie mog udzieli odpowiedzi, zapytanie jest eskalowane do serwer贸w korzeniowych.

- **Serwery nieautorytatywne**: Nie posiadajc wasnoci nad strefami DNS, te serwery zbieraj informacje o domenie poprzez zapytania do innych serwer贸w.

- **Serwer DNS z buforowaniem**: Ten rodzaj serwera zapamituje poprzednie odpowiedzi na zapytania przez okrelony czas, aby przyspieszy czas odpowiedzi na przysze 偶dania, a czas buforowania jest okrelany przez serwer autorytatywny.

- **Serwer przekierowujcy**: Penic prost rol, serwery przekierowujce po prostu przekazuj zapytania do innego serwera.

- **Resolver**: Zintegrowane w komputerach lub routerach, resolwery wykonuj lokalne rozwizywanie nazw i nie s uwa偶ane za autorytatywne.


## Wyliczanie

### **Pobieranie baner贸w**

W DNS nie ma baner贸w, ale mo偶na pobra magiczne zapytanie dla `version.bind. CHAOS TXT`, kt贸re bdzie dziaa na wikszoci serwer贸w nazw BIND.\
Mo偶esz wykona to zapytanie za pomoc `dig`:
```bash
dig version.bind CHAOS TXT @DNS
```
Ponadto narzdzie [`fpdns`](https://github.com/kirei/fpdns) mo偶e r贸wnie偶 zidentyfikowa serwer.

Mo偶liwe jest r贸wnie偶 pobranie baneru za pomoc skryptu **nmap**:
```
--script dns-nsid
```
### **Dowolny rekord**

Rekord **ANY** poprosi serwer DNS o **zwr贸cenie** wszystkich dostpnych **wpis贸w**, kt贸re **jest gotowy ujawni**.
```bash
dig any victim.com @<DNS_IP>
```
### **Transfer strefy**

Ta procedura jest skr贸tem od `Asynchronous Full Transfer Zone` (`AXFR`).
```bash
dig axfr @<DNS_IP> #Try zone transfer without domain
dig axfr @<DNS_IP> <DOMAIN> #Try zone transfer guessing the domain
fierce --domain <DOMAIN> --dns-servers <DNS_IP> #Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack
```
### Wicej informacji

DNS (Domain Name System) jest protokoem u偶ywanym do przypisywania nazw domenowych do adres贸w IP. Jest to niezbdne do przegldania stron internetowych, wysyania poczty elektronicznej i innych usug internetowych. W procesie pentestowania DNS mo偶na wykorzysta r贸偶ne techniki, aby zidentyfikowa podatnoci i potencjalne luki w zabezpieczeniach.

#### Rekordy DNS

Rekordy DNS zawieraj informacje o domenie, takie jak adres IP, serwery poczty elektronicznej, serwery nazw i inne. Kilka przykad贸w popularnych rekord贸w DNS to:

- **A**: Przypisuje adres IP do nazwy domeny.
- **CNAME**: Tworzy alias dla innej nazwy domeny.
- **MX**: Okrela serwery poczty elektronicznej dla domeny.
- **NS**: Okrela serwery nazw dla domeny.
- **TXT**: Przechowuje dowolne informacje tekstowe.

#### Techniki pentestowania DNS

Poni偶ej przedstawiono kilka technik pentestowania DNS:

1. **Zbieranie informacji**: Wykorzystanie narzdzi takich jak `nslookup` lub `dig` do zbierania informacji o domenie, takich jak rekordy DNS, serwery nazw i adresy IP.

2. **Zamiana rekord贸w**: Sprawdzenie, czy mo偶na zmieni rekordy DNS, takie jak rekord A, aby przekierowa ruch na inny adres IP.

3. **Spoofing DNS**: Atakowanie serwera DNS, aby przekierowa ruch na kontrolowane przez nas adresy IP. Mo偶e to prowadzi do przechwycenia danych lub przekierowania u偶ytkownik贸w na zoliwe strony.

4. **Zatrucie pamici podrcznej DNS**: Wykorzystanie bd贸w w implementacji DNS, aby wprowadzi faszywe rekordy do pamici podrcznej serwera DNS. Mo偶e to prowadzi do przekierowania ruchu na kontrolowane przez nas adresy IP.

5. **Zalepienie DNS**: Wykorzystanie bd贸w w implementacji DNS, aby zmusi serwer DNS do akceptowania faszywych odpowiedzi, co mo偶e prowadzi do przekierowania ruchu na kontrolowane przez nas adresy IP.

6. **Ataki sownikowe**: Pr贸ba odgadnicia nazw domenowych lub rekord贸w DNS, wykorzystujc sowniki lub listy popularnych nazw.

7. **Ataki na serwery DNS**: Wykorzystanie bd贸w w oprogramowaniu serwera DNS, takich jak bdy wersji, bdy konfiguracji lub sabe hasa, aby uzyska nieautoryzowany dostp.

#### Narzdzia pentestowania DNS

Istnieje wiele narzdzi dostpnych do pentestowania DNS, takich jak:

- **dnsrecon**: Narzdzie do zbierania informacji o domenie, wyszukiwania rekord贸w DNS i identyfikowania podatnoci.
- **dnswalk**: Narzdzie do analizy i audytu serwer贸w DNS.
- **dnsenum**: Narzdzie do zbierania informacji o domenie, wyszukiwania rekord贸w DNS i identyfikowania podatnoci.
- **fierce**: Narzdzie do zbierania informacji o domenie, wyszukiwania rekord贸w DNS i identyfikowania podatnoci.
- **dnsmap**: Narzdzie do mapowania struktury DNS i identyfikowania podatnoci.
- **dnschef**: Narzdzie do przekierowywania ruchu DNS na kontrolowane przez nas adresy IP.
- **dnsspoof**: Narzdzie do przekierowywania ruchu DNS na kontrolowane przez nas adresy IP.

#### Podsumowanie

Pentestowanie DNS jest wa偶nym elementem test贸w penetracyjnych, kt贸re pomaga identyfikowa podatnoci i luki w zabezpieczeniach. Wykorzystujc r贸偶ne techniki i narzdzia, mo偶na zwikszy bezpieczestwo infrastruktury sieciowej i chroni dane u偶ytkownik贸w.
```bash
dig ANY @<DNS_IP> <DOMAIN>     #Any information
dig A @<DNS_IP> <DOMAIN>       #Regular DNS request
dig AAAA @<DNS_IP> <DOMAIN>    #IPv6 DNS request
dig TXT @<DNS_IP> <DOMAIN>     #Information
dig MX @<DNS_IP> <DOMAIN>      #Emails related
dig NS @<DNS_IP> <DOMAIN>      #DNS that resolves that name
dig -x 192.168.0.2 @<DNS_IP>   #Reverse lookup
dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup

#Use [-p PORT]  or  -6 (to use ivp6 address of dns)
```
#### Automatyzacja
```bash
for sub in $(cat <WORDLIST>);do dig $sub.<DOMAIN> @<DNS_IP> | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done

dnsenum --dnsserver <DNS_IP> --enum -p 0 -s 0 -o subdomains.txt -f <WORDLIST> <DOMAIN>
```
#### U偶ywanie nslookup

The `nslookup` command is a powerful tool for querying DNS (Domain Name System) servers. It allows you to retrieve information about DNS records, such as IP addresses associated with domain names.

To use `nslookup`, open a command prompt and type `nslookup` followed by the domain name or IP address you want to query. Press Enter to execute the command.

For example, to retrieve the IP address of a domain name, type:

```
nslookup example.com
```

This will display the IP address associated with the domain name `example.com`.

You can also specify the DNS server to use for the query by typing `server` followed by the IP address of the DNS server. For example:

```
server 8.8.8.8
```

This will set the DNS server to `8.8.8.8` (Google's public DNS server). Subsequent `nslookup` queries will use this DNS server.

To exit `nslookup`, type `exit` and press Enter.

`nslookup` is a useful tool for troubleshooting DNS issues and gathering information during a penetration test. It can help you identify misconfigured DNS records, check DNS propagation, and gather information about a target's infrastructure.
```bash
nslookup
> SERVER <IP_DNS> #Select dns server
> 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...
> <IP_MACHINE> #Reverse lookup of a machine, maybe...
```
### Przydatne moduy metasploit

Metasploit to popularne narzdzie do testowania penetracyjnego, kt贸re zawiera wiele modu贸w, kt贸re mog by u偶yteczne podczas testowania usug sieciowych. Oto kilka przykadowych modu贸w, kt贸re warto zna:

- `auxiliary/scanner/dns/dns_cache_snoop`: Modu ten pozwala na przeprowadzenie ataku typu DNS cache snoop, kt贸ry umo偶liwia uzyskanie informacji o zapytaniach DNS przechowywanych w pamici podrcznej serwera DNS.
- `auxiliary/scanner/dns/dns_enum`: Ten modu umo偶liwia przeprowadzenie enumeracji DNS, kt贸ra polega na zbieraniu informacji o rekordach DNS dla okrelonej domeny.
- `auxiliary/scanner/dns/dns_forward`: Modu ten pozwala na przekierowanie ruchu DNS z jednego serwera na inny, co mo偶e by przydatne podczas testowania infrastruktury sieciowej.
- `auxiliary/scanner/dns/dns_reverser`: Ten modu umo偶liwia przeprowadzenie odwr贸conej analizy DNS, kt贸ra polega na wyszukiwaniu nazw host贸w na podstawie adres贸w IP.
- `auxiliary/scanner/dns/dns_transfer`: Modu ten umo偶liwia przeprowadzenie ataku typu DNS zone transfer, kt贸ry pozwala na uzyskanie kopii strefy DNS z serwera DNS.

Te moduy s tylko kilkoma przykadami zasob贸w, jakie oferuje Metasploit. Istnieje wiele innych modu贸w, kt贸re mo偶na wykorzysta w celu testowania penetracyjnego usug sieciowych.
```bash
auxiliary/gather/enum_dns #Perform enumeration actions
```
### Przydatne skrypty nmap

Nmap to pot偶ne narzdzie do skanowania sieci, kt贸re mo偶e by u偶ywane do badania bezpieczestwa usug sieciowych. Nmap posiada wiele wbudowanych skrypt贸w, kt贸re mog pom贸c w identyfikacji podatnoci i odkrywaniu ukrytych funkcji. Poni偶ej znajduje si lista kilku przydatnych skrypt贸w nmap:

- **dns-brute**: Ten skrypt su偶y do przeprowadzania brutalnego ataku na serwer DNS w celu odkrycia ukrytych subdomen.
- **dns-zone-transfer**: Skrypt ten pozwala na przeprowadzenie transferu strefy DNS, co mo偶e pom贸c w identyfikacji podatnoci zwizanych z konfiguracj serwera DNS.
- **dns-reverse-lookup**: Skrypt ten wykonuje odwr贸cone wyszukiwanie DNS, co pozwala na identyfikacj host贸w na podstawie ich adres贸w IP.
- **dns-cache-snoop**: Ten skrypt pozwala na przeprowadzenie ataku na pami podrczn serwera DNS w celu odkrycia informacji o odwiedzanych stronach internetowych.
- **dns-blacklist**: Skrypt ten sprawdza, czy adresy IP znajduj si na czarnej licie DNS, co mo偶e wskazywa na obecno zoliwego oprogramowania lub podejrzanej aktywnoci.

Te skrypty nmap mog by u偶yteczne podczas test贸w penetracyjnych, aby zidentyfikowa potencjalne podatnoci i zabezpieczy usugi sieciowe.
```bash
#Perform enumeration actions
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP>
```
### DNS - Odwr贸cone BF

Reverse BF (Backward Forcing) to technika ataku na serwer DNS, kt贸ra polega na pr贸bie odgadnicia nazw domen, kt贸re s zarejestrowane na serwerze DNS. Atakujcy rozpoczyna od pr贸by odgadnicia najpopularniejszych nazw domen, takich jak "www", "mail", "ftp", a nastpnie przechodzi do mniej popularnych nazw. 

Atak Reverse BF jest skuteczny w przypadku sabych ustawie serwera DNS, kt贸re pozwalaj na atwe odgadywanie nazw domen. Atakujcy mo偶e wykorzysta t technik do uzyskania informacji o infrastrukturze sieciowej i potencjalnych celach ataku. 

Aby przeprowadzi atak Reverse BF, atakujcy mo偶e skorzysta z narzdzi do automatycznego generowania nazw domen lub rcznie wprowadza r贸偶ne kombinacje nazw. Atakujcy mo偶e r贸wnie偶 wykorzysta sowniki nazw domen, kt贸re zawieraj popularne sowa i frazy. 

Aby zabezpieczy serwer DNS przed atakiem Reverse BF, zaleca si stosowanie silnych hase i ustawie zabezpiecze. Administracja serwera DNS powinna r贸wnie偶 monitorowa logi i wykrywa podejrzane aktywnoci, takie jak du偶e iloci nieudanych pr贸b odpytywania o nazwy domen.
```bash
dnsrecon -r 127.0.0.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r 127.0.1.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r <IP_DNS>/24 -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d active.htb -a -n <IP_DNS> #Zone transfer
```
{% hint style="info" %}
Jeli uda ci si znale藕 subdomeny rozwizujce si na adresy IP wewntrzne, powiniene spr贸bowa przeprowadzi odwr贸cony DNS BF do NSs domeny, pytajc o ten zakres IP.
{% endhint %}

Inne narzdzie do tego celu: [https://github.com/amine7536/reverse-scan](https://github.com/amine7536/reverse-scan)

Mo偶esz zapyta o odwr贸cone zakresy IP na [https://bgp.he.net/net/205.166.76.0/24#\_dns](https://bgp.he.net/net/205.166.76.0/24#\_dns) (to narzdzie jest r贸wnie偶 pomocne przy BGP).

### DNS - Przegldanie subdomen
```bash
dnsenum --dnsserver <IP_DNS> --enum -p 0 -s 0 -o subdomains.txt -f subdomains-1000.txt <DOMAIN>
dnsrecon -D subdomains-1000.txt -d <DOMAIN> -n <IP_DNS>
dnscan -d <domain> -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan
```
### Serwery Active Directory

Active Directory (AD) to usuga katalogowa opracowana przez firm Microsoft, kt贸ra umo偶liwia zarzdzanie u偶ytkownikami, grupami i zasobami w sieci. Serwery Active Directory s kluczowym elementem infrastruktury AD i peni rol kontroler贸w domeny. Kontrolery domeny przechowuj informacje o obiektach w domenie, takie jak konta u偶ytkownik贸w, grupy, uprawnienia itp.

Podczas testowania penetracyjnego, serwery Active Directory s czsto celem atak贸w, poniewa偶 posiadaj wiele wra偶liwych informacji, takich jak hasa u偶ytkownik贸w, kt贸re mog by wykorzystane do uzyskania dostpu do innych zasob贸w w sieci. Poni偶ej przedstawiam kilka technik, kt贸re mo偶na zastosowa podczas testowania penetracyjnego serwer贸w Active Directory.

#### 1. Enumeracja u偶ytkownik贸w

Podstawowym krokiem podczas testowania penetracyjnego serwera Active Directory jest enumeracja u偶ytkownik贸w. Mo偶na to zrobi za pomoc narzdzi takich jak `ldapsearch`, `enum4linux` lub `PowerView`. Enumeracja u偶ytkownik贸w pozwala uzyska informacje o kontach u偶ytkownik贸w, takie jak nazwy, identyfikatory SID, grupy, uprawnienia itp.

#### 2. Ataki sownikowe

Ataki sownikowe s popularnym sposobem na pr贸b zamania hase u偶ytkownik贸w na serwerze Active Directory. Mo偶na to zrobi za pomoc narzdzi takich jak `Hydra`, `Medusa` lub `CrackMapExec`. Ataki sownikowe polegaj na pr贸bie logowania si na konto u偶ytkownika, u偶ywajc r贸偶nych kombinacji hase z listy sownikowej.

#### 3. Ataki hase jednorazowych (OTP)

W przypadku, gdy serwer Active Directory korzysta z hase jednorazowych (OTP), ataki sownikowe nie bd skuteczne. W takim przypadku mo偶na spr贸bowa ataku brute-force na hasa jednorazowe. Mo偶na to zrobi za pomoc narzdzi takich jak `Hydra` lub `Medusa`, kt贸re obsuguj ataki na protokoy takie jak RDP, SSH, HTTP itp.

#### 4. Ataki na protokoy uwierzytelniania

Serwery Active Directory obsuguj r贸偶ne protokoy uwierzytelniania, takie jak Kerberos, NTLM itp. Ataki na te protokoy mog umo偶liwi zamanie hase u偶ytkownik贸w lub uzyskanie dostpu do innych zasob贸w w sieci. Mo偶na to zrobi za pomoc narzdzi takich jak `Kerberoast`, `Pass-the-Hash` lub `Golden Ticket`.

#### 5. Ataki na usugi powizane z Active Directory

Serwery Active Directory czsto korzystaj z innych usug, takich jak DNS, LDAP, SMB itp. Ataki na te usugi mog umo偶liwi uzyskanie dostpu do serwera Active Directory lub innych zasob贸w w sieci. Mo偶na to zrobi za pomoc technik takich jak ataki DNS spoofing, ataki LDAP injection lub ataki SMB relay.

#### 6. Ataki na podatnoci serwera Active Directory

Podczas testowania penetracyjnego serwera Active Directory warto r贸wnie偶 sprawdzi, czy serwer jest podatny na znane luki bezpieczestwa. Mo偶na to zrobi za pomoc narzdzi takich jak `Metasploit`, `Nessus` lub `OpenVAS`, kt贸re posiadaj moduy do skanowania podatnoci serwera Active Directory.

#### 7. Ataki na infrastruktur fizyczn

W niekt贸rych przypadkach, ataki na serwer Active Directory mog obejmowa r贸wnie偶 ataki na infrastruktur fizyczn, tak jak serwery, routery, przeczniki itp. Ataki te mog umo偶liwi uzyskanie dostpu do serwera Active Directory lub innych zasob贸w w sieci. Mo偶na to zrobi za pomoc technik takich jak ataki fizyczne, ataki na urzdzenia sieciowe lub ataki na systemy zarzdzania.

#### 8. Ataki na aplikacje powizane z Active Directory

Serwery Active Directory czsto s powizane z r贸偶nymi aplikacjami, takimi jak serwery poczty elektronicznej, serwery plik贸w, serwery baz danych itp. Ataki na te aplikacje mog umo偶liwi uzyskanie dostpu do serwera Active Directory lub innych zasob贸w w sieci. Mo偶na to zrobi za pomoc technik takich jak ataki na aplikacje webowe, ataki SQL injection lub ataki na protokoy komunikacyjne.

#### 9. Ataki na u偶ytkownik贸w

Ostatnim, ale nie mniej wa偶nym, aspektem testowania penetracyjnego serwera Active Directory jest atak na u偶ytkownik贸w. Ataki na u偶ytkownik贸w mog obejmowa in偶ynieri spoeczn, phishing, ataki na hasa itp. Ataki te mog umo偶liwi uzyskanie dostpu do serwera Active Directory lub innych zasob贸w w sieci.
```bash
dig -t _gc._tcp.lab.domain.com
dig -t _ldap._tcp.lab.domain.com
dig -t _kerberos._tcp.lab.domain.com
dig -t _kpasswd._tcp.lab.domain.com

nslookup -type=srv _kerberos._tcp.<CLIENT_DOMAIN>
nslookup -type=srv _kerberos._tcp.domain.com

nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='domain.com'"
```
### DNSSec

DNSSec (Domain Name System Security Extensions) to zestaw rozszerze bezpieczestwa dla systemu DNS, kt贸re maj na celu zapobieganie atakom na integralno i autentyczno danych DNS. DNSSec wprowadza mechanizmy, kt贸re umo偶liwiaj weryfikacj podpis贸w cyfrowych dla rekord贸w DNS, co zapewnia wiksze zaufanie do dostarczanych informacji.

DNSSec dziaa na zasadzie hierarchicznej struktury zaufania, w kt贸rej ka偶da domena jest odpowiedzialna za podpisanie swoich rekord贸w DNS. Podpisy cyfrowe s przechowywane w rekordach DS (Delegation Signer) w domenie nadrzdnej, co umo偶liwia weryfikacj autentycznoci rekord贸w DNS dla danej domeny.

Atakujcy pr贸bujcy przechwyci lub zmieni dane DNS napotkaj trudnoci w przypadku domen zabezpieczonych DNSSec. W przypadku pr贸by zmiany rekord贸w DNS, podpis cyfrowy zostanie naruszony, co spowoduje odrzucenie zmienionych danych przez klienta.

DNSSec jest wa偶nym narzdziem w zapewnianiu bezpieczestwa dla infrastruktury DNS i powinien by wdra偶any tam, gdzie to mo偶liwe.
```bash
#Query paypal subdomains to ns3.isc-sns.info
nmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=paypal.com ns3.isc-sns.info
```
### IPv6

Brute force wykorzystujcy 偶dania "AAAA" w celu zebrania adres贸w IPv6 subdomen.
```bash
dnsdict6 -s -t <domain>
```
# Bruteforce reverse DNS in using IPv6 addresses

## Introduction

Reverse DNS (rDNS) is a technique used to resolve an IP address to its corresponding domain name. In the case of IPv6 addresses, the process is similar to that of IPv4 addresses, but with some differences due to the longer address format.

## Bruteforcing rDNS for IPv6 addresses

To bruteforce rDNS for IPv6 addresses, you can follow these steps:

1. Generate a list of possible domain names based on the target's domain name or any other relevant information.
2. Convert the IPv6 address to its hexadecimal representation.
3. Append the hexadecimal representation of the IPv6 address to each domain name in the list.
4. Use a DNS resolver or a DNS lookup tool to query the rDNS for each domain name in the list.
5. Analyze the responses to identify any potential matches between the domain names and the target's IP address.

## Tools for bruteforcing rDNS

There are several tools available that can assist in the bruteforcing of rDNS for IPv6 addresses. Some popular ones include:

- **dnsrecon**: A powerful DNS enumeration and information gathering tool that supports IPv6.
- **dnsenum**: A Perl script that can perform various DNS enumeration tasks, including rDNS bruteforcing.
- **fierce**: A DNS reconnaissance tool that can be used to discover non-contiguous IP space and perform rDNS bruteforcing.

## Conclusion

Bruteforcing rDNS for IPv6 addresses can be a useful technique in penetration testing or other security assessments. By systematically querying different domain names with the target's IPv6 address, you may uncover additional information or potential vulnerabilities. However, it is important to note that bruteforcing rDNS should only be performed with proper authorization and in compliance with applicable laws and regulations.
```bash
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48 #Will use the dns pri.authdns.ripe.net
```
### Atak DDoS na rekursj DNS

Jeli **rekursja DNS jest wczona**, atakujcy mo偶e **podrobi** **pochodzenie** w pakiecie UDP, aby **DNS wysa odpowied藕 do serwera ofiary**. Atakujcy mo偶e wykorzysta dowolne typy rekord贸w, takie jak **ANY** lub **DNSSEC**, poniewa偶 generuj one wiksze odpowiedzi.\
Spos贸b **sprawdzenia**, czy DNS obsuguje **rekursj**, polega na zapytaniu o nazw domeny i **sprawdzeniu**, czy w odpowiedzi znajduje si flaga "ra" (_dostpna rekursja_):
```bash
dig google.com A @<IP>
```
**Niedostpne**:

![](<../.gitbook/assets/image (275).png>)

**Dostpne**:

![](<../.gitbook/assets/image (276).png>)

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Natychmiastowe dostpne narzdzia do oceny podatnoci i testowania penetracyjnego**. Uruchom pene testowanie penetracyjne z dowolnego miejsca za pomoc ponad 20 narzdzi i funkcji, kt贸re obejmuj rozpoznanie i raportowanie. Nie zastpujemy tester贸w penetracyjnych - opracowujemy niestandardowe narzdzia, moduy wykrywania i eksploatacji, aby umo偶liwi im zagbianie si, zdobywanie dostpu i dobr zabaw.

{% embed url="https://pentest-tools.com/" %}

### Wysyka wiadomoci na nieistniejce konto

Podczas analizy powiadomienia o niemo偶liwoci dostarczenia (NDN), kt贸re zostao wywoane przez wysanie wiadomoci e-mail na nieprawidowy adres w domenie docelowej, czsto ujawniane s cenne szczeg贸y dotyczce wewntrznej sieci.

Przedstawione powiadomienie o niemo偶liwoci dostarczenia zawiera informacje takie jak:

- Generujcy serwer zosta zidentyfikowany jako `server.example.com`.
- Powiadomienie o niepowodzeniu dla `user@example.com` z kodem bdu `#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found` zostao zwr贸cone.
- W oryginalnych nag贸wkach wiadomoci ujawnione zostay wewntrzne adresy IP i nazwy host贸w.
```markdown
The original message headers were modified for anonymity and now present randomized data:

Generating server: server.example.com

user@example.com
#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found ##

Original message headers:

Received: from MAILSERVER01.domain.example.com (192.168.1.1) by
mailserver02.domain.example.com (192.168.2.2) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:52:22 -0700
Received: from filter.example.com (203.0.113.1) by
MAILSERVER01.domain.example.com (192.168.1.1) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Mon, 25 May 2015 14:51:22 -0700
X-ASG-Debug-ID: 1432576343-0614671716190e0d0001-zOQ9WJ
Received: from gateway.domainhost.com (gateway.domainhost.com [198.51.100.37]) by
filter.example.com with ESMTP id xVNPkwaqGgdyH5Ag for user@example.com; Mon,
25 May 2015 14:52:13 -0700 (PDT)
X-Envelope-From: sender@anotherdomain.org
X-Apparent-Source-IP: 198.51.100.37
```
## Pliki konfiguracyjne

Config files are an important aspect of DNS pentesting. These files contain the configuration settings for DNS servers and can provide valuable information for attackers. Here are some common config files to look out for:

### BIND

BIND is a popular DNS server software used on Unix-like operating systems. The main config file for BIND is usually located at `/etc/named.conf`. This file contains global configuration options, zone definitions, and other settings.

### Windows DNS Server

On Windows systems, the DNS server configuration is stored in the Windows Registry. The relevant keys can be found under `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\DNS\Parameters`.

### dnsmasq

dnsmasq is a lightweight DNS forwarder and DHCP server commonly used in small networks or as a local DNS cache. Its config file is typically located at `/etc/dnsmasq.conf` or `/etc/dnsmasq.d/*.conf`.

### PowerDNS

PowerDNS is a versatile DNS server software that supports various backends. Its main config file is usually located at `/etc/pdns.conf` or `/etc/powerdns/pdns.conf`.

### Unbound

Unbound is a validating, recursive, and caching DNS resolver. Its config file is typically located at `/etc/unbound/unbound.conf`.

### Other DNS Servers

Different DNS servers may have their own config file locations and formats. It's important to research the specific DNS server software being used to find the relevant config files.

Remember to check for any sensitive information, such as passwords or IP addresses, that may be stored in these config files. Attackers can leverage this information to gain unauthorized access or perform other malicious activities.
```
host.conf
/etc/resolv.conf
/etc/bind/named.conf
/etc/bind/named.conf.local
/etc/bind/named.conf.options
/etc/bind/named.conf.log
/etc/bind/*
```
Niebezpieczne ustawienia podczas konfigurowania serwera Bind:

| **Opcja**         | **Opis**                                                                 |
| ----------------- | ----------------------------------------------------------------------- |
| `allow-query`     | Okrela, kt贸re hosty maj prawo wysya 偶dania do serwera DNS.          |
| `allow-recursion` | Okrela, kt贸re hosty maj prawo wysya rekurencyjne 偶dania do serwera DNS. |
| `allow-transfer`  | Okrela, kt贸re hosty maj prawo otrzymywa transfer strefy od serwera DNS. |
| `zone-statistics` | Zbiera dane statystyczne dotyczce stref.                                |

## Referencje
* [https://www.myrasecurity.com/en/knowledge-hub/dns/](https://www.myrasecurity.com/en/knowledge-hub/dns/)
* Ksi偶ka: **Network Security Assessment 3rd edition**

## HackTricks Automatyczne Polecenia
```
Protocol_Name: DNS    #Protocol Abbreviation if there is one.
Port_Number:  53     #Comma separated if there is more than one.
Protocol_Description: Domain Name Service        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for DNS
Note: |
#These are the commands I run every time I see an open DNS port

dnsrecon -r 127.0.0.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r 127.0.1.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r {Network}{CIDR} -n {IP} -d {Domain_Name}
dig axfr @{IP}
dig axfr {Domain_Name} @{IP}
nslookup
SERVER {IP}
127.0.0.1
{IP}
Domain_Name
exit

https://book.hacktricks.xyz/pentesting/pentesting-dns

Entry_2:
Name: Banner Grab
Description: Grab DNS Banner
Command: dig version.bind CHAOS TXT @DNS

Entry_3:
Name: Nmap Vuln Scan
Description: Scan for Vulnerabilities with Nmap
Command: nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" {IP}

Entry_4:
Name: Zone Transfer
Description: Three attempts at forcing a zone transfer
Command: dig axfr @{IP} && dix axfr @{IP} {Domain_Name} && fierce --dns-servers {IP} --domain {Domain_Name}


Entry_5:
Name: Active Directory
Description: Eunuerate a DC via DNS
Command: dig -t _gc._{Domain_Name} && dig -t _ldap._{Domain_Name} && dig -t _kerberos._{Domain_Name} && dig -t _kpasswd._{Domain_Name} && nmap --script dns-srv-enum --script-args "dns-srv-enum.domain={Domain_Name}"

Entry_6:
Name: consolesless mfs enumeration
Description: DNS enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/dns/dns_amp; set RHOSTS {IP}; set RPORT 53; run; exit' && msfconsole -q -x 'use auxiliary/gather/enum_dns; set RHOSTS {IP}; set RPORT 53; run; exit'
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Natychmiastowo dostpne narzdzia do oceny podatnoci i testowania penetracyjnego**. Uruchom peny test penetracyjny z dowolnego miejsca za pomoc ponad 20 narzdzi i funkcji, kt贸re obejmuj rozpoznanie i raportowanie. Nie zastpujemy tester贸w penetracyjnych - opracowujemy niestandardowe narzdzia, moduy wykrywania i eksploatacji, aby umo偶liwi im zagbianie si, zdobywanie powok i dobr zabaw.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy **reklam swojej firmy w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) **i** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repozytori贸w GitHub.**

</details>
