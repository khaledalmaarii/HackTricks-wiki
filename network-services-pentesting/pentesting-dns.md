# 53 - DNSæ¸—é€æµ‹è¯•

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€… **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conferenceæ˜¯ä¸€åœºå›½é™…ç½‘ç»œå®‰å…¨æ´»åŠ¨**](https://www.dragonjarcon.org/)ï¼Œå·²ç»ä¸¾åŠäº†åå¤šå¹´ï¼Œå°†äº2023å¹´9æœˆ7æ—¥è‡³8æ—¥åœ¨å“¥ä¼¦æ¯”äºšæ³¢å“¥å¤§ä¸¾è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªå†…å®¹ä¸°å¯Œçš„æŠ€æœ¯æ´»åŠ¨ï¼Œå±•ç¤ºäº†å¸å¼•å…¨çƒé»‘å®¢å’Œç ”ç©¶äººå‘˜çš„æœ€æ–°ç ”ç©¶æˆæœã€‚\
ç«‹å³åœ¨ä»¥ä¸‹é“¾æ¥æ³¨å†Œï¼Œä¸è¦é”™è¿‡è¿™ä¸ªé‡è¦çš„ä¼šè®®ï¼:

{% embed url="https://www.dragonjarcon.org/" %}

## **åŸºæœ¬ä¿¡æ¯**

åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰æ˜¯äº’è”ç½‘çš„ç”µè¯ç°¿ã€‚äººä»¬é€šè¿‡åŸŸåè®¿é—®åœ¨çº¿ä¿¡æ¯ï¼Œä¾‹å¦‚nytimes.comæˆ–espn.comã€‚Webæµè§ˆå™¨é€šè¿‡Internetåè®®ï¼ˆIPï¼‰åœ°å€è¿›è¡Œäº¤äº’ã€‚DNSå°†åŸŸåè½¬æ¢ä¸º[IPåœ°å€](https://www.cloudflare.com/learning/dns/glossary/what-is-my-ip-address/)ï¼Œä»¥ä¾¿æµè§ˆå™¨å¯ä»¥åŠ è½½äº’è”ç½‘èµ„æºã€‚\
æ¥æºï¼š[è¿™é‡Œ](https://www.cloudflare.com/learning/dns/what-is-dns/)ã€‚

**é»˜è®¤ç«¯å£ï¼š** 53
```
PORT     STATE SERVICE  REASON
53/tcp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
5353/udp open  zeroconf udp-response
53/udp   open  domain  Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
```
### ä¸åŒçš„DNSæœåŠ¡å™¨

æ¥è‡ª[https://academy.hackthebox.com/module/112/section/1069](https://academy.hackthebox.com/module/112/section/1069)çš„ä¿¡æ¯

| **æœåŠ¡å™¨ç±»å‹**                | **æè¿°**                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `DNSæ ¹æœåŠ¡å™¨`              | DNSçš„æ ¹æœåŠ¡å™¨è´Ÿè´£é¡¶çº§åŸŸåï¼ˆTLDï¼‰ã€‚ä½œä¸ºæœ€åçš„å®ä¾‹ï¼Œåªæœ‰åœ¨åç§°æœåŠ¡å™¨ä¸å“åº”æ—¶æ‰ä¼šè¯·æ±‚å®ƒä»¬ã€‚å› æ­¤ï¼Œæ ¹æœåŠ¡å™¨æ˜¯ç”¨æˆ·å’Œäº’è”ç½‘ä¸Šå†…å®¹ä¹‹é—´çš„ä¸­å¤®æ¥å£ï¼Œå®ƒå°†åŸŸåå’ŒIPåœ°å€è¿›è¡Œå…³è”ã€‚[äº’è”ç½‘åç§°ä¸æ•°å­—åœ°å€åˆ†é…æœºæ„](https://www.icann.org/)ï¼ˆICANNï¼‰åè°ƒæ ¹åç§°æœåŠ¡å™¨çš„å·¥ä½œã€‚å…¨çƒå…±æœ‰13ä¸ªè¿™æ ·çš„æ ¹æœåŠ¡å™¨ã€‚ |
| `æƒå¨åç§°æœåŠ¡å™¨`     | æƒå¨åç§°æœåŠ¡å™¨å¯¹ç‰¹å®šåŒºåŸŸæ‹¥æœ‰æˆæƒã€‚å®ƒä»¬åªå›ç­”æ¥è‡ªå…¶è´£ä»»åŒºåŸŸçš„æŸ¥è¯¢ï¼Œå¹¶ä¸”å®ƒä»¬çš„ä¿¡æ¯æ˜¯å…·æœ‰çº¦æŸåŠ›çš„ã€‚å¦‚æœæƒå¨åç§°æœåŠ¡å™¨æ— æ³•å›ç­”å®¢æˆ·ç«¯çš„æŸ¥è¯¢ï¼Œåˆ™æ ¹åç§°æœåŠ¡å™¨æ¥ç®¡è¯¥æŸ¥è¯¢ã€‚                                                                                                                                                                                                            |
| `éæƒå¨åç§°æœåŠ¡å™¨` | éæƒå¨åç§°æœåŠ¡å™¨ä¸è´Ÿè´£ç‰¹å®šçš„DNSåŒºåŸŸã€‚ç›¸åï¼Œå®ƒä»¬é€šè¿‡é€’å½’æˆ–è¿­ä»£DNSæŸ¥è¯¢è‡ªå·±æ”¶é›†ç‰¹å®šDNSåŒºåŸŸçš„ä¿¡æ¯ã€‚                                                                                                                                                                                                                                                                               |
| `ç¼“å­˜DNSæœåŠ¡å™¨`           | ç¼“å­˜DNSæœåŠ¡å™¨åœ¨æŒ‡å®šçš„æ—¶é—´æ®µå†…ç¼“å­˜æ¥è‡ªå…¶ä»–åç§°æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚è¿™ä¸ªå­˜å‚¨çš„æŒç»­æ—¶é—´ç”±æƒå¨åç§°æœåŠ¡å™¨ç¡®å®šã€‚                                                                                                                                                                                                                                                                                                                             |
| `è½¬å‘æœåŠ¡å™¨`            | è½¬å‘æœåŠ¡å™¨åªæ‰§è¡Œä¸€ä¸ªåŠŸèƒ½ï¼šå°†DNSæŸ¥è¯¢è½¬å‘åˆ°å¦ä¸€ä¸ªDNSæœåŠ¡å™¨ã€‚                                                                                                                                                                                                                                                                                                                                                                                            |
| `è§£æå™¨`                     | è§£æå™¨ä¸æ˜¯æƒå¨DNSæœåŠ¡å™¨ï¼Œè€Œæ˜¯åœ¨è®¡ç®—æœºæˆ–è·¯ç”±å™¨ä¸­æœ¬åœ°æ‰§è¡Œåç§°è§£æã€‚                                                                                                                                                                                                                                                                                                                                                                               |

## æšä¸¾

### **æ¨ªå¹…æŠ“å–**

DNSæ²¡æœ‰å¯æŠ“å–çš„â€œæ¨ªå¹…â€ã€‚æœ€æ¥è¿‘çš„ç­‰æ•ˆç‰©æ˜¯å¯¹å¤§å¤šæ•°BINDåç§°æœåŠ¡å™¨æœ‰æ•ˆçš„`version.bind. CHAOS TXT`çš„é­”æœ¯æŸ¥è¯¢ã€‚\
æ‚¨å¯ä»¥ä½¿ç”¨`dig`æ‰§è¡Œæ­¤æŸ¥è¯¢ï¼š
```bash
dig version.bind CHAOS TXT @DNS
```
å¦‚æœé‚£ä¸èµ·ä½œç”¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æŒ‡çº¹è¯†åˆ«æŠ€æœ¯æ¥ç¡®å®šè¿œç¨‹æœåŠ¡å™¨çš„ç‰ˆæœ¬--[`fpdns`](https://github.com/kirei/fpdns)å·¥å…·æ˜¯å…¶ä¸­ä¸€ä¸ªé€‰æ‹©ï¼Œä½†è¿˜æœ‰å…¶ä»–é€‰æ‹©ã€‚

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨**nmap**è„šæœ¬æ¥è·å–æ¨ªå¹…ï¼š
```
--script dns-nsid
```
### **ä»»æ„è®°å½•**

è®°å½•**ANY**å°†è¦æ±‚DNSæœåŠ¡å™¨**è¿”å›**æ‰€æœ‰å¯ç”¨çš„**æ¡ç›®**ï¼Œå®ƒæ„¿æ„**æŠ«éœ²**çš„ã€‚
```bash
dig any victim.com @<DNS_IP>
```
### **åŒºåŸŸä¼ è¾“**

è¯¥è¿‡ç¨‹ç®€ç§°ä¸º`å¼‚æ­¥å®Œå…¨ä¼ è¾“åŒºåŸŸ`ï¼ˆ`AXFR`ï¼‰ã€‚
```bash
dig axfr @<DNS_IP> #Try zone transfer without domain
dig axfr @<DNS_IP> <DOMAIN> #Try zone transfer guessing the domain
fierce --domain <DOMAIN> --dns-servers <DNS_IP> #Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack
```
### æ›´å¤šä¿¡æ¯

DNSï¼ˆDomain Name Systemï¼‰æ˜¯äº’è”ç½‘ä¸­ç”¨äºå°†åŸŸåè§£æä¸ºIPåœ°å€çš„ç³»ç»Ÿã€‚åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼ŒDNSæ¸—é€æµ‹è¯•æ˜¯ä¸€ç§å¸¸è§çš„æŠ€æœ¯ï¼Œç”¨äºå‘ç°å’Œåˆ©ç”¨ä¸DNSç›¸å…³çš„æ¼æ´å’Œå¼±ç‚¹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„DNSæ¸—é€æµ‹è¯•æŠ€æœ¯ï¼š

#### DNSä¿¡æ¯æ”¶é›†

åœ¨è¿›è¡ŒDNSæ¸—é€æµ‹è¯•ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦æ”¶é›†ç›®æ ‡åŸŸåçš„ç›¸å…³ä¿¡æ¯ã€‚è¿™åŒ…æ‹¬åŸŸåæ³¨å†Œä¿¡æ¯ã€DNSæœåŠ¡å™¨ä¿¡æ¯ã€å­åŸŸåä¿¡æ¯ç­‰ã€‚å¯ä»¥ä½¿ç”¨WHOISæŸ¥è¯¢ã€DNSæŸ¥è¯¢å·¥å…·å’Œåœ¨çº¿åŸŸåæœç´¢å¼•æ“æ¥æ”¶é›†è¿™äº›ä¿¡æ¯ã€‚

#### å­åŸŸåæšä¸¾

å­åŸŸåæšä¸¾æ˜¯ä¸€ç§é€šè¿‡æŸ¥è¯¢ç›®æ ‡åŸŸåçš„DNSè®°å½•æ¥å‘ç°å…¶å­åŸŸåçš„æŠ€æœ¯ã€‚å¸¸ç”¨çš„å­åŸŸåæšä¸¾å·¥å…·åŒ…æ‹¬`dnsenum`ã€`sublist3r`å’Œ`amass`ç­‰ã€‚é€šè¿‡æšä¸¾å­åŸŸåï¼Œå¯ä»¥å‘ç°å¯èƒ½å­˜åœ¨çš„æ¼æ´å’Œå¼±ç‚¹ã€‚

#### DNSç¼“å­˜æŠ•æ¯’

DNSç¼“å­˜æŠ•æ¯’æ˜¯ä¸€ç§æ”»å‡»æŠ€æœ¯ï¼Œé€šè¿‡å‘DNSæœåŠ¡å™¨å‘é€æ¶æ„çš„DNSå“åº”ï¼Œå°†é”™è¯¯çš„DNSè®°å½•ç¼“å­˜åˆ°æœåŠ¡å™¨ä¸­ï¼Œä»è€Œå¯¼è‡´ç”¨æˆ·è®¿é—®è¢«åŠ«æŒçš„ç½‘ç«™ã€‚å¸¸ç”¨çš„DNSç¼“å­˜æŠ•æ¯’å·¥å…·åŒ…æ‹¬`dnsspooq`å’Œ`mitm6`ç­‰ã€‚

#### DNSéš§é“

DNSéš§é“æ˜¯ä¸€ç§åˆ©ç”¨DNSåè®®è¿›è¡Œæ•°æ®ä¼ è¾“çš„æŠ€æœ¯ã€‚é€šè¿‡åœ¨DNSæŸ¥è¯¢å’Œå“åº”ä¸­éšè—æ•°æ®ï¼Œå¯ä»¥ç»•è¿‡ç½‘ç»œé˜²ç«å¢™å’ŒIDS/IPSç³»ç»Ÿçš„æ£€æµ‹ã€‚å¸¸ç”¨çš„DNSéš§é“å·¥å…·åŒ…æ‹¬`iodine`å’Œ`dnscat2`ç­‰ã€‚

#### DNSåŠ«æŒ

DNSåŠ«æŒæ˜¯ä¸€ç§æ”»å‡»æŠ€æœ¯ï¼Œé€šè¿‡ç¯¡æ”¹DNSå“åº”ï¼Œå°†ç”¨æˆ·çš„åŸŸåè§£æè¯·æ±‚é‡å®šå‘åˆ°æ¶æ„çš„IPåœ°å€ã€‚è¿™å¯ä»¥ç”¨äºè¿›è¡Œé’“é±¼æ”»å‡»ã€ä¸­é—´äººæ”»å‡»ç­‰ã€‚å¸¸ç”¨çš„DNSåŠ«æŒå·¥å…·åŒ…æ‹¬`dnsmasq`å’Œ`mitmproxy`ç­‰ã€‚

#### DNSæ¼æ´åˆ©ç”¨

åœ¨è¿›è¡ŒDNSæ¸—é€æµ‹è¯•æ—¶ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ä¸€äº›å·²çŸ¥çš„DNSæ¼æ´æ¥è·å–ç›®æ ‡ç³»ç»Ÿçš„æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚å¸¸è§çš„DNSæ¼æ´åŒ…æ‹¬DNSåŒºåŸŸä¼ è¾“æ¼æ´ã€DNSé‡ç»‘å®šæ¼æ´å’ŒDNSè§£æå™¨æ¼æ´ç­‰ã€‚

ä»¥ä¸Šæ˜¯ä¸€äº›å¸¸è§çš„DNSæ¸—é€æµ‹è¯•æŠ€æœ¯ï¼Œæ¸—é€æµ‹è¯•äººå‘˜å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ¥å‘ç°å’Œåˆ©ç”¨ç›®æ ‡ç³»ç»Ÿä¸­çš„DNSæ¼æ´å’Œå¼±ç‚¹ã€‚
```bash
dig ANY @<DNS_IP> <DOMAIN>     #Any information
dig A @<DNS_IP> <DOMAIN>       #Regular DNS request
dig AAAA @<DNS_IP> <DOMAIN>    #IPv6 DNS request
dig TXT @<DNS_IP> <DOMAIN>     #Information
dig MX @<DNS_IP> <DOMAIN>      #Emails related
dig NS @<DNS_IP> <DOMAIN>      #DNS that resolves that name
dig -x 192.168.0.2 @<DNS_IP>   #Reverse lookup
dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup

#Use [-p PORT]  or  -6 (to use ivp6 address of dns)
```
#### è‡ªåŠ¨åŒ–

Automation plays a crucial role in the field of DNS pentesting. It helps in streamlining the process and saves time and effort. There are various tools available that can automate different tasks involved in DNS pentesting.

è‡ªåŠ¨åŒ–åœ¨DNSæ¸—é€æµ‹è¯•é¢†åŸŸèµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚å®ƒæœ‰åŠ©äºç®€åŒ–æµç¨‹ï¼ŒèŠ‚çœæ—¶é—´å’Œç²¾åŠ›ã€‚æœ‰å„ç§å·¥å…·å¯ç”¨äºè‡ªåŠ¨åŒ–DNSæ¸—é€æµ‹è¯•ä¸­æ¶‰åŠçš„ä¸åŒä»»åŠ¡ã€‚

#### Enumeration

#### æšä¸¾

Enumeration is the process of gathering information about a target DNS server. It involves finding all the DNS records associated with the target domain. Automated enumeration tools can perform this task efficiently and quickly.

æšä¸¾æ˜¯æ”¶é›†æœ‰å…³ç›®æ ‡DNSæœåŠ¡å™¨çš„ä¿¡æ¯çš„è¿‡ç¨‹ã€‚å®ƒæ¶‰åŠæŸ¥æ‰¾ä¸ç›®æ ‡åŸŸå…³è”çš„æ‰€æœ‰DNSè®°å½•ã€‚è‡ªåŠ¨åŒ–æšä¸¾å·¥å…·å¯ä»¥é«˜æ•ˆå¿«é€Ÿåœ°æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚

#### Zone Transfer

#### åŒºåŸŸä¼ è¾“

Zone transfer is a mechanism that allows DNS servers to share DNS records with each other. It can be exploited to gather valuable information about the target domain. Automated tools can perform zone transfer checks to identify if the target DNS server is vulnerable to zone transfer attacks.

åŒºåŸŸä¼ è¾“æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸DNSæœåŠ¡å™¨å½¼æ­¤å…±äº«DNSè®°å½•ã€‚å¯ä»¥åˆ©ç”¨å®ƒæ¥æ”¶é›†æœ‰å…³ç›®æ ‡åŸŸçš„æœ‰ä»·å€¼ä¿¡æ¯ã€‚è‡ªåŠ¨åŒ–å·¥å…·å¯ä»¥æ‰§è¡ŒåŒºåŸŸä¼ è¾“æ£€æŸ¥ï¼Œä»¥ç¡®å®šç›®æ ‡DNSæœåŠ¡å™¨æ˜¯å¦å®¹æ˜“å—åˆ°åŒºåŸŸä¼ è¾“æ”»å‡»ã€‚

#### DNS Cache Poisoning

#### DNSç¼“å­˜æŠ•æ¯’

DNS cache poisoning is a technique used to manipulate the DNS cache of a target DNS server. It involves injecting malicious DNS records into the cache, which can redirect users to malicious websites or intercept their traffic. Automated tools can be used to perform DNS cache poisoning attacks and identify vulnerable DNS servers.

DNSç¼“å­˜æŠ•æ¯’æ˜¯ä¸€ç§ç”¨äºæ“çºµç›®æ ‡DNSæœåŠ¡å™¨çš„DNSç¼“å­˜çš„æŠ€æœ¯ã€‚å®ƒæ¶‰åŠå°†æ¶æ„DNSè®°å½•æ³¨å…¥ç¼“å­˜ï¼Œå¯ä»¥å°†ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„ç½‘ç«™æˆ–æ‹¦æˆªå…¶æµé‡ã€‚å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ‰§è¡ŒDNSç¼“å­˜æŠ•æ¯’æ”»å‡»å¹¶è¯†åˆ«æ˜“å—æ”»å‡»çš„DNSæœåŠ¡å™¨ã€‚

#### Brute-Force Attacks

#### æš´åŠ›ç ´è§£æ”»å‡»

Brute-force attacks involve systematically trying all possible combinations of characters to guess a password or key. In the context of DNS pentesting, brute-force attacks can be used to guess subdomains or hostnames associated with the target domain. Automated tools can perform brute-force attacks on DNS servers to identify potential vulnerabilities.

æš´åŠ›ç ´è§£æ”»å‡»æ¶‰åŠç³»ç»Ÿåœ°å°è¯•æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦ç»„åˆæ¥çŒœæµ‹å¯†ç æˆ–å¯†é’¥ã€‚åœ¨DNSæ¸—é€æµ‹è¯•çš„èƒŒæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æš´åŠ›ç ´è§£æ”»å‡»æ¥çŒœæµ‹ä¸ç›®æ ‡åŸŸå…³è”çš„å­åŸŸæˆ–ä¸»æœºåã€‚è‡ªåŠ¨åŒ–å·¥å…·å¯ä»¥å¯¹DNSæœåŠ¡å™¨æ‰§è¡Œæš´åŠ›ç ´è§£æ”»å‡»ï¼Œä»¥è¯†åˆ«æ½œåœ¨çš„æ¼æ´ã€‚

#### Conclusion

#### ç»“è®º

Automation is a valuable asset in DNS pentesting as it simplifies and speeds up the process. By using automated tools, pentesters can efficiently perform tasks such as enumeration, zone transfer checks, DNS cache poisoning attacks, and brute-force attacks. This allows for a more comprehensive assessment of the target DNS server's security posture.

è‡ªåŠ¨åŒ–æ˜¯DNSæ¸—é€æµ‹è¯•ä¸­çš„å®è´µèµ„äº§ï¼Œå› ä¸ºå®ƒç®€åŒ–å¹¶åŠ é€Ÿäº†è¿‡ç¨‹ã€‚é€šè¿‡ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·ï¼Œæ¸—é€æµ‹è¯•äººå‘˜å¯ä»¥é«˜æ•ˆåœ°æ‰§è¡Œæšä¸¾ã€åŒºåŸŸä¼ è¾“æ£€æŸ¥ã€DNSç¼“å­˜æŠ•æ¯’æ”»å‡»å’Œæš´åŠ›ç ´è§£æ”»å‡»ç­‰ä»»åŠ¡ã€‚è¿™å¯ä»¥æ›´å…¨é¢åœ°è¯„ä¼°ç›®æ ‡DNSæœåŠ¡å™¨çš„å®‰å…¨çŠ¶å†µã€‚
```bash
for sub in $(cat <WORDLIST>);do dig $sub.<DOMAIN> @<DNS_IP> | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done

dnsenum --dnsserver <DNS_IP> --enum -p 0 -s 0 -o subdomains.txt -f <WORDLIST> <DOMAIN>
```
#### ä½¿ç”¨ nslookup

The `nslookup` command is a powerful tool for querying DNS (Domain Name System) servers to obtain information about domain names and IP addresses. It is commonly used in network reconnaissance and troubleshooting.

To use `nslookup`, open a command prompt or terminal and type `nslookup` followed by the domain name or IP address you want to query. Press Enter to execute the command.

For example, to obtain the IP address of a domain name, type:

```
nslookup example.com
```

This will display the IP address associated with the domain name `example.com`, along with the DNS server that provided the response.

You can also perform reverse DNS lookups by specifying an IP address instead of a domain name. For example:

```
nslookup 192.168.0.1
```

This will display the domain name associated with the IP address `192.168.0.1`, along with the DNS server that provided the response.

`nslookup` also supports various options and commands that can be used to customize the query and obtain specific information. To view the available options and commands, type `nslookup` and press Enter.
```bash
nslookup
> SERVER <IP_DNS> #Select dns server
> 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...
> <IP_MACHINE> #Reverse lookup of a machine, maybe...
```
### æœ‰ç”¨çš„Metasploitæ¨¡å—

Metasploitæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œæä¾›äº†è®¸å¤šæœ‰ç”¨çš„æ¨¡å—ï¼Œç”¨äºæ‰§è¡Œå„ç§ç½‘ç»œæœåŠ¡çš„æ¸—é€æµ‹è¯•ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„Metasploitæ¨¡å—ï¼š

- `auxiliary/scanner/dns/dns_enum`ï¼šç”¨äºæ‰§è¡ŒDNSæšä¸¾ï¼Œè·å–ç›®æ ‡åŸŸåçš„ç›¸å…³ä¿¡æ¯ã€‚
- `auxiliary/scanner/dns/dns_recon`ï¼šç”¨äºæ‰§è¡ŒDNSä¾¦å¯Ÿï¼Œæ”¶é›†ç›®æ ‡åŸŸåçš„å­åŸŸåå’Œä¸»æœºè®°å½•ã€‚
- `auxiliary/scanner/dns/dns_brute`ï¼šç”¨äºæ‰§è¡ŒDNSæš´åŠ›ç ´è§£ï¼Œå°è¯•çŒœæµ‹ç›®æ ‡åŸŸåçš„å­åŸŸåå’Œä¸»æœºè®°å½•ã€‚
- `auxiliary/scanner/dns/dns_cache_snoop`ï¼šç”¨äºæ‰§è¡ŒDNSç¼“å­˜çª¥è§†ï¼Œè·å–ç›®æ ‡åŸŸåçš„ç¼“å­˜è®°å½•ã€‚
- `auxiliary/scanner/dns/dns_reverse_lookup`ï¼šç”¨äºæ‰§è¡ŒDNSåå‘æŸ¥æ‰¾ï¼Œè·å–ç›®æ ‡IPåœ°å€çš„åŸŸåã€‚

è¿™äº›æ¨¡å—å¯ä»¥å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å‘ç°ç›®æ ‡ç½‘ç»œä¸­å­˜åœ¨çš„DNSç›¸å…³æ¼æ´å’Œå¼±ç‚¹ï¼Œä»è€Œè¿›è¡Œè¿›ä¸€æ­¥çš„æ”»å‡»å’Œæ¸—é€ã€‚åœ¨ä½¿ç”¨è¿™äº›æ¨¡å—æ—¶ï¼ŒåŠ¡å¿…éµå®ˆæ³•å¾‹å’Œé“å¾·è§„èŒƒï¼Œä»…ç”¨äºåˆæ³•çš„æ¸—é€æµ‹è¯•æ´»åŠ¨ã€‚
```bash
auxiliary/gather/enum_dns #Perform enumeration actions
```
### æœ‰ç”¨çš„nmapè„šæœ¬

Nmapæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç½‘ç»œæ‰«æå·¥å…·ï¼Œå®ƒæä¾›äº†è®¸å¤šæœ‰ç”¨çš„è„šæœ¬ï¼Œç”¨äºè¿›è¡Œç½‘ç»œæœåŠ¡æ¸—é€æµ‹è¯•ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„nmapè„šæœ¬ï¼š

- **dns-brute.nse**ï¼šç”¨äºè¿›è¡ŒDNSæš´åŠ›ç ´è§£ï¼Œå°è¯•çŒœæµ‹ç›®æ ‡åŸŸåçš„å­åŸŸåã€‚
- **dns-cache-snoop.nse**ï¼šç”¨äºæ£€æŸ¥ç›®æ ‡DNSæœåŠ¡å™¨çš„ç¼“å­˜ï¼ŒæŸ¥æ‰¾å¯èƒ½çš„ä¿¡æ¯æ³„æ¼ã€‚
- **dns-zone-transfer.nse**ï¼šç”¨äºæ‰§è¡ŒDNSåŒºåŸŸä¼ è¾“ï¼Œè·å–ç›®æ ‡åŸŸåçš„å®Œæ•´DNSè®°å½•ã€‚
- **dns-blacklist.nse**ï¼šç”¨äºæ£€æŸ¥ç›®æ ‡åŸŸåæ˜¯å¦è¢«åˆ—å…¥DNSé»‘åå•ã€‚
- **dns-reverse-query.nse**ï¼šç”¨äºæ‰§è¡Œåå‘DNSæŸ¥è¯¢ï¼ŒæŸ¥æ‰¾ç›®æ ‡IPåœ°å€å¯¹åº”çš„åŸŸåã€‚
- **dns-service-discovery.nse**ï¼šç”¨äºå‘ç°ç›®æ ‡ä¸»æœºä¸Šè¿è¡Œçš„DNSæœåŠ¡ã€‚

è¿™äº›è„šæœ¬å¯ä»¥å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å‘ç°ç›®æ ‡ç½‘ç»œä¸­çš„æ½œåœ¨æ¼æ´å’Œå®‰å…¨é£é™©ã€‚åœ¨ä½¿ç”¨è¿™äº›è„šæœ¬æ—¶ï¼Œè¯·ç¡®ä¿éµå®ˆæ³•å¾‹å’Œé“å¾·è§„èŒƒï¼Œå¹¶è·å¾—åˆæ³•çš„æˆæƒã€‚
```bash
#Perform enumeration actions
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP>
```
### DNS - åå‘æš´åŠ›ç ´è§£

åœ¨DNSæ¸—é€æµ‹è¯•ä¸­ï¼Œåå‘æš´åŠ›ç ´è§£æ˜¯ä¸€ç§å¸¸ç”¨çš„æŠ€æœ¯ï¼Œç”¨äºè·å–ç›®æ ‡ç½‘ç»œä¸­çš„ä¸»æœºåå’ŒIPåœ°å€çš„å…³è”ä¿¡æ¯ã€‚è¿™ç§æŠ€æœ¯åˆ©ç”¨äº†DNSæœåŠ¡å™¨çš„ç‰¹æ€§ï¼Œé€šè¿‡å°è¯•ä¸åŒçš„ä¸»æœºåæ¥æŸ¥è¯¢å…¶å¯¹åº”çš„IPåœ°å€ï¼Œä»è€Œè·å–ç›®æ ‡ç½‘ç»œä¸­çš„æ½œåœ¨ç›®æ ‡ã€‚

åå‘æš´åŠ›ç ´è§£çš„è¿‡ç¨‹é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š

1. æ”¶é›†ç›®æ ‡ç½‘ç»œçš„åŸŸåä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåã€å­åŸŸåç­‰ã€‚
2. æ„å»ºä¸€ä¸ªä¸»æœºåå­—å…¸ï¼ŒåŒ…å«å¸¸è§çš„ä¸»æœºåå’Œå¯èƒ½çš„å˜ä½“ã€‚
3. ä½¿ç”¨å­—å…¸ä¸­çš„ä¸»æœºåé€ä¸ªè¿›è¡ŒDNSæŸ¥è¯¢ï¼Œè·å–å…¶å¯¹åº”çš„IPåœ°å€ã€‚
4. åˆ†ææŸ¥è¯¢ç»“æœï¼Œè¯†åˆ«å‡ºç›®æ ‡ç½‘ç»œä¸­çš„æ½œåœ¨ç›®æ ‡ã€‚

åå‘æš´åŠ›ç ´è§£çš„å…³é”®åœ¨äºæ„å»ºä¸€ä¸ªæœ‰æ•ˆçš„ä¸»æœºåå­—å…¸ã€‚è¿™å¯ä»¥é€šè¿‡æ”¶é›†ç›®æ ‡ç½‘ç»œçš„å…¬å¼€ä¿¡æ¯ã€ä½¿ç”¨å¸¸è§çš„ä¸»æœºåç”Ÿæˆè§„åˆ™ä»¥åŠä½¿ç”¨å·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆå­—å…¸æ¥å®ç°ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿›è¡Œåå‘æš´åŠ›ç ´è§£æ—¶ï¼Œåº”éµå®ˆæ³•å¾‹å’Œé“å¾·è§„èŒƒï¼Œå¹¶è·å¾—åˆæ³•çš„æˆæƒã€‚å¦åˆ™ï¼Œè¿™ç§è¡Œä¸ºå°†è¢«è§†ä¸ºéæ³•å…¥ä¾µï¼Œå¹¶å¯èƒ½å¯¼è‡´ä¸¥é‡çš„æ³•å¾‹åæœã€‚
```bash
dnsrecon -r 127.0.0.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r 127.0.1.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r <IP_DNS>/24 -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d active.htb -a -n <IP_DNS> #Zone transfer
```
{% hint style="info" %}
å¦‚æœæ‚¨èƒ½æ‰¾åˆ°è§£æä¸ºå†…éƒ¨IPåœ°å€çš„å­åŸŸåï¼Œåº”å°è¯•å¯¹è¯¥IPèŒƒå›´çš„NSæ‰§è¡Œåå‘DNS BFã€‚
{% endhint %}

æ‰§è¡Œæ­¤æ“ä½œçš„å¦ä¸€ä¸ªå·¥å…·ï¼š[https://github.com/amine7536/reverse-scan](https://github.com/amine7536/reverse-scan)

æ‚¨å¯ä»¥æŸ¥è¯¢åå‘IPèŒƒå›´åˆ°[https://bgp.he.net/net/205.166.76.0/24#\_dns](https://bgp.he.net/net/205.166.76.0/24#\_dns)ï¼ˆæ­¤å·¥å…·åœ¨BGPæ–¹é¢ä¹Ÿå¾ˆæœ‰å¸®åŠ©ï¼‰ã€‚

### DNS - å­åŸŸåBF
```bash
dnsenum --dnsserver <IP_DNS> --enum -p 0 -s 0 -o subdomains.txt -f subdomains-1000.txt <DOMAIN>
dnsrecon -D subdomains-1000.txt -d <DOMAIN> -n <IP_DNS>
dnscan -d <domain> -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan
```
### Active Directory æœåŠ¡å™¨

Active Directoryï¼ˆADï¼‰æ˜¯ä¸€ç§ç”±å¾®è½¯å¼€å‘çš„ç›®å½•æœåŠ¡ï¼Œç”¨äºåœ¨ç½‘ç»œä¸­ç®¡ç†å’Œç»„ç»‡ç”¨æˆ·ã€è®¡ç®—æœºå’Œå…¶ä»–ç½‘ç»œèµ„æºã€‚åœ¨è¿›è¡Œç½‘ç»œæœåŠ¡æ¸—é€æµ‹è¯•æ—¶ï¼Œäº†è§£å’Œè¯„ä¼°ç›®æ ‡ç½‘ç»œä¸­çš„Active DirectoryæœåŠ¡å™¨æ˜¯éå¸¸é‡è¦çš„ã€‚

#### DNSè®°å½•

åœ¨Active Directoryç¯å¢ƒä¸­ï¼ŒDNSè®°å½•å¯¹äºæœåŠ¡å™¨çš„å‘ç°å’Œé€šä¿¡è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„DNSè®°å½•ç±»å‹ï¼š

- Aè®°å½•ï¼šå°†ä¸»æœºåæ˜ å°„åˆ°IPv4åœ°å€ã€‚
- AAAAè®°å½•ï¼šå°†ä¸»æœºåæ˜ å°„åˆ°IPv6åœ°å€ã€‚
- CNAMEè®°å½•ï¼šä¸ºä¸»æœºååˆ›å»ºåˆ«åã€‚
- MXè®°å½•ï¼šæŒ‡å®šé‚®ä»¶æœåŠ¡å™¨çš„ä¼˜å…ˆçº§ã€‚
- SRVè®°å½•ï¼šæŒ‡å®šæœåŠ¡çš„ä½ç½®ã€‚

#### DNSæšä¸¾

é€šè¿‡è¿›è¡ŒDNSæšä¸¾ï¼Œæˆ‘ä»¬å¯ä»¥æ”¶é›†æœ‰å…³ç›®æ ‡ç½‘ç»œä¸­çš„DNSè®°å½•çš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£ç½‘ç»œæ‹“æ‰‘ã€æœåŠ¡å™¨é…ç½®å’Œå¯èƒ½å­˜åœ¨çš„æ¼æ´ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„DNSæšä¸¾å·¥å…·ï¼š

- `nslookup`ï¼šç”¨äºæŸ¥è¯¢DNSè®°å½•ã€‚
- `dig`ï¼šç”¨äºæ‰§è¡Œé«˜çº§DNSæŸ¥è¯¢ã€‚
- `dnsenum`ï¼šç”¨äºè‡ªåŠ¨åŒ–DNSæšä¸¾ã€‚

#### DNSåŠ«æŒ

DNSåŠ«æŒæ˜¯ä¸€ç§æ”»å‡»æŠ€æœ¯ï¼Œé€šè¿‡ç¯¡æ”¹DNSå“åº”æ¥å°†ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„ç½‘ç«™æˆ–æœåŠ¡å™¨ã€‚è¿™å¯ä»¥ç”¨äºè¿›è¡Œé’“é±¼æ”»å‡»ã€ä¸­é—´äººæ”»å‡»æˆ–çªƒå–ç”¨æˆ·å‡­æ®ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„DNSåŠ«æŒæŠ€æœ¯ï¼š

- DNSç¼“å­˜æŠ•æ¯’ï¼šé€šè¿‡å‘DNSç¼“å­˜ä¸­æ’å…¥æ¶æ„è®°å½•æ¥ç¯¡æ”¹DNSå“åº”ã€‚
- DNSæ¬ºéª—ï¼šé€šè¿‡å‘é€ä¼ªé€ çš„DNSå“åº”æ¥æ¬ºéª—ç”¨æˆ·ã€‚
- DNSé‡ç»‘å®šï¼šé€šè¿‡å°†æ¶æ„ç½‘ç«™çš„IPåœ°å€åŠ¨æ€æ›´æ”¹ä¸ºåˆæ³•ç½‘ç«™çš„IPåœ°å€æ¥ç»•è¿‡é˜²ç«å¢™ã€‚

#### DNSæ¼æ´åˆ©ç”¨

åœ¨è¿›è¡Œç½‘ç»œæœåŠ¡æ¸—é€æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€äº›å·²çŸ¥çš„DNSæ¼æ´æ¥è·å–æœªæˆæƒè®¿é—®ã€æ‰§è¡Œè¿œç¨‹ä»£ç æˆ–ç»•è¿‡å®‰å…¨æªæ–½ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„DNSæ¼æ´ï¼š

- DNSåŒºåŸŸä¼ è¾“ï¼šæœªæ­£ç¡®é…ç½®çš„DNSæœåŠ¡å™¨å¯èƒ½å…è®¸åŒºåŸŸä¼ è¾“ï¼Œä»è€Œæ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚
- DNSéš§é“ï¼šé€šè¿‡DNSåè®®ä¼ è¾“æ•°æ®ï¼Œç»•è¿‡ç½‘ç»œé˜²ç«å¢™å’ŒIDS/IPSç³»ç»Ÿã€‚
- DNSé‡ç»‘å®šï¼šåˆ©ç”¨DNSé‡ç»‘å®šæŠ€æœ¯ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡é˜²ç«å¢™å¹¶è®¿é—®å†…éƒ¨ç½‘ç»œèµ„æºã€‚

#### æ€»ç»“

åœ¨è¿›è¡Œç½‘ç»œæœåŠ¡æ¸—é€æµ‹è¯•æ—¶ï¼Œäº†è§£å’Œè¯„ä¼°ç›®æ ‡ç½‘ç»œä¸­çš„Active DirectoryæœåŠ¡å™¨æ˜¯è‡³å…³é‡è¦çš„ã€‚é€šè¿‡è¿›è¡ŒDNSæšä¸¾å’Œåˆ©ç”¨å·²çŸ¥çš„DNSæ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥æ”¶é›†æœ‰å…³ç›®æ ‡ç½‘ç»œçš„ä¿¡æ¯ï¼Œå¹¶å‘ç°æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚
```
dig -t _gc._tcp.lab.domain.com
dig -t _ldap._tcp.lab.domain.com
dig -t _kerberos._tcp.lab.domain.com
dig -t _kpasswd._tcp.lab.domain.com
nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='domain.com'"
```
### DNSSec

DNSSecï¼ˆDomain Name System Security Extensionsï¼‰æ˜¯ä¸€ç§ç”¨äºå¢å¼ºDNSå®‰å…¨æ€§çš„æ‰©å±•åè®®ã€‚å®ƒé€šè¿‡æ•°å­—ç­¾åå’ŒéªŒè¯DNSæ•°æ®çš„å®Œæ•´æ€§ï¼Œé˜²æ­¢DNSåŠ«æŒå’Œæ¬ºéª—æ”»å‡»ã€‚DNSSecä½¿ç”¨å…¬é’¥åŠ å¯†æŠ€æœ¯ï¼Œç¡®ä¿DNSå“åº”çš„çœŸå®æ€§å’Œå¯ä¿¡æ€§ã€‚

DNSSecçš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š

1. **æ•°å­—ç­¾å**ï¼šDNSæœåŠ¡å™¨ä½¿ç”¨ç§é’¥å¯¹DNSæ•°æ®è¿›è¡Œæ•°å­—ç­¾åï¼Œä»¥è¯æ˜æ•°æ®çš„çœŸå®æ€§å’Œå®Œæ•´æ€§ã€‚
2. **å…¬é’¥åˆ†å‘**ï¼šDNSæœåŠ¡å™¨å°†å…¬é’¥å‘å¸ƒåˆ°DNSåŒºåŸŸçš„DNSKEYè®°å½•ä¸­ï¼Œä»¥ä¾›å…¶ä»–æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éªŒè¯ç­¾åã€‚
3. **éªŒè¯ç­¾å**ï¼šå®¢æˆ·ç«¯ä½¿ç”¨DNSKEYè®°å½•ä¸­çš„å…¬é’¥æ¥éªŒè¯DNSå“åº”çš„ç­¾åï¼Œç¡®ä¿æ•°æ®æœªè¢«ç¯¡æ”¹ã€‚
4. **é“¾å¼éªŒè¯**ï¼šDNSSecä½¿ç”¨é“¾å¼éªŒè¯æ¥éªŒè¯æ•´ä¸ªDNSæŸ¥è¯¢è·¯å¾„ä¸Šçš„æ¯ä¸ªDNSæœåŠ¡å™¨çš„ç­¾åï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚

DNSSecçš„éƒ¨ç½²å¯ä»¥æä¾›ä»¥ä¸‹å®‰å…¨ä¿æŠ¤ï¼š

- **æ•°æ®å®Œæ•´æ€§**ï¼šDNSSecé˜²æ­¢DNSæ•°æ®è¢«ç¯¡æ”¹ï¼Œç¡®ä¿æ¥æ”¶åˆ°çš„æ•°æ®ä¸å‘é€çš„æ•°æ®ä¸€è‡´ã€‚
- **èº«ä»½éªŒè¯**ï¼šDNSSecä½¿ç”¨æ•°å­—ç­¾åéªŒè¯DNSæ•°æ®çš„çœŸå®æ€§ï¼Œé˜²æ­¢DNSæ¬ºéª—æ”»å‡»ã€‚
- **é˜²æ­¢DNSåŠ«æŒ**ï¼šDNSSecé€šè¿‡éªŒè¯DNSå“åº”çš„ç­¾åï¼Œé˜²æ­¢æ¶æ„æ”»å‡»è€…ç¯¡æ”¹DNSå“åº”ï¼Œå°†ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„ç½‘ç«™ã€‚

å°½ç®¡DNSSecæä¾›äº†æ›´å¼ºçš„DNSå®‰å…¨æ€§ï¼Œä½†å…¶éƒ¨ç½²ä»ç„¶é¢ä¸´ä¸€äº›æŒ‘æˆ˜ã€‚å…¶ä¸­åŒ…æ‹¬ï¼š

- **éƒ¨ç½²å¤æ‚æ€§**ï¼šDNSSecçš„éƒ¨ç½²éœ€è¦å¯¹DNSåŸºç¡€æ¶æ„è¿›è¡Œä¿®æ”¹å’Œé…ç½®ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›ä¸“ä¸šçŸ¥è¯†å’ŒæŠ€èƒ½ã€‚
- **æ€§èƒ½å½±å“**ï¼šDNSSecçš„æ•°å­—ç­¾åå’ŒéªŒè¯è¿‡ç¨‹å¯èƒ½ä¼šå¢åŠ DNSæŸ¥è¯¢çš„å»¶è¿Ÿå’Œè´Ÿè½½ã€‚
- **å…¼å®¹æ€§é—®é¢˜**ï¼šä¸æ˜¯æ‰€æœ‰çš„DNSæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½æ”¯æŒDNSSecï¼Œè¿™å¯èƒ½å¯¼è‡´å…¼å®¹æ€§é—®é¢˜å’Œéƒ¨ç½²å›°éš¾ã€‚

å°½ç®¡å­˜åœ¨è¿™äº›æŒ‘æˆ˜ï¼ŒDNSSecä»ç„¶æ˜¯æé«˜DNSå®‰å…¨æ€§çš„é‡è¦å·¥å…·ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›éœ€è¦ä¿æŠ¤æ•æ„Ÿæ•°æ®å’Œé˜²æ­¢DNSæ”»å‡»çš„ç»„ç»‡æ¥è¯´ã€‚
```bash
#Query paypal subdomains to ns3.isc-sns.info
nmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=paypal.com ns3.isc-sns.info
```
### IPv6

ä½¿ç”¨"AAAA"è¯·æ±‚è¿›è¡Œæš´åŠ›ç ´è§£ï¼Œä»¥æ”¶é›†å­åŸŸåçš„IPv6åœ°å€ã€‚
```bash
dnsdict6 -s -t <domain>
```
# IPv6åœ°å€çš„åå‘DNSæš´åŠ›ç ´è§£

åœ¨è¿›è¡Œç½‘ç»œæœåŠ¡æ¸—é€æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦è·å–ç›®æ ‡ä¸»æœºçš„è¯¦ç»†ä¿¡æ¯ã€‚å…¶ä¸­ä¸€ä¸ªé‡è¦çš„ä¿¡æ¯æ˜¯ç›®æ ‡ä¸»æœºçš„DNSè®°å½•ã€‚é€šè¿‡åå‘DNSæŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®IPv6åœ°å€è·å–ä¸»æœºåã€‚

åå‘DNSæš´åŠ›ç ´è§£æ˜¯ä¸€ç§å¸¸ç”¨çš„æŠ€æœ¯ï¼Œç”¨äºå°è¯•çŒœæµ‹ä¸ç‰¹å®šIPv6åœ°å€ç›¸å…³è”çš„ä¸»æœºåã€‚è¿™ç§æŠ€æœ¯é€šå¸¸ç”¨äºå‘ç°éšè—åœ¨ç½‘ç»œä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å†…éƒ¨æœåŠ¡å™¨çš„åç§°æˆ–å…¶ä»–æ•æ„Ÿè®¾å¤‡ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨IPv6åœ°å€è¿›è¡Œåå‘DNSæš´åŠ›ç ´è§£çš„ä¸€èˆ¬æ­¥éª¤ï¼š

1. ç¡®å®šç›®æ ‡IPv6åœ°å€èŒƒå›´ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šç›®æ ‡ç½‘ç»œçš„IPv6åœ°å€èŒƒå›´ã€‚è¿™å¯ä»¥é€šè¿‡ç½‘ç»œæ‰«æå·¥å…·ï¼ˆå¦‚Nmapï¼‰æˆ–å…¶ä»–ä¿¡æ¯æ”¶é›†æŠ€æœ¯æ¥å®Œæˆã€‚

2. æšä¸¾IPv6åœ°å€ï¼šä½¿ç”¨ç¡®å®šçš„IPv6åœ°å€èŒƒå›´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·¥å…·ï¼ˆå¦‚IPv6åœ°å€ç”Ÿæˆå™¨ï¼‰æ¥ç”Ÿæˆå¯èƒ½çš„IPv6åœ°å€åˆ—è¡¨ã€‚

3. è¿›è¡Œåå‘DNSæŸ¥è¯¢ï¼šä½¿ç”¨ç”Ÿæˆçš„IPv6åœ°å€åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·¥å…·ï¼ˆå¦‚Digï¼‰æ¥è¿›è¡Œåå‘DNSæŸ¥è¯¢ï¼Œå°è¯•è·å–ä¸æ¯ä¸ªIPv6åœ°å€ç›¸å…³è”çš„ä¸»æœºåã€‚

4. åˆ†æç»“æœï¼šåˆ†æåå‘DNSæŸ¥è¯¢çš„ç»“æœï¼ŒæŸ¥æ‰¾å¯èƒ½çš„æ•æ„Ÿä¿¡æ¯æˆ–ç›®æ ‡ä¸»æœºçš„å…¶ä»–è¯¦ç»†ä¿¡æ¯ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåå‘DNSæš´åŠ›ç ´è§£å¯èƒ½ä¼šå—åˆ°ç›®æ ‡ç½‘ç»œçš„é˜²å¾¡æªæ–½çš„é™åˆ¶ï¼Œä¾‹å¦‚DNSé˜²ç«å¢™æˆ–åå‘DNSæŸ¥è¯¢é™åˆ¶ã€‚å› æ­¤ï¼Œåœ¨è¿›è¡Œæ­¤ç±»æ´»åŠ¨æ—¶ï¼Œåº”è°¨æ…è¡Œäº‹ï¼Œå¹¶éµå®ˆé€‚ç”¨çš„æ³•å¾‹å’Œé“å¾·å‡†åˆ™ã€‚

é€šè¿‡ä½¿ç”¨IPv6åœ°å€è¿›è¡Œåå‘DNSæš´åŠ›ç ´è§£ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ å¯¹ç›®æ ‡ç½‘ç»œçš„äº†è§£ï¼Œå¹¶å‘ç°æ½œåœ¨çš„å®‰å…¨æ¼æ´æˆ–æ•æ„Ÿä¿¡æ¯ã€‚è¿™å¯¹äºç½‘ç»œæ¸—é€æµ‹è¯•äººå‘˜æ¥è¯´æ˜¯ä¸€é¡¹æœ‰ä»·å€¼çš„æŠ€æœ¯ã€‚
```bash
dnsrevenum6 pri.authdns.ripe.net 2001:67c:2e8::/48 #Will use the dns pri.authdns.ripe.net
```
### DNSé€’å½’DDoS

å¦‚æœ**å¯ç”¨äº†DNSé€’å½’**ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä¼ªé€ UDPæ•°æ®åŒ…çš„**æºåœ°å€**ï¼Œä½¿DNSå°†å“åº”å‘é€åˆ°å—å®³æœåŠ¡å™¨ã€‚æ”»å‡»è€…å¯ä»¥æ»¥ç”¨**ANY**æˆ–**DNSSEC**è®°å½•ç±»å‹ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸å…·æœ‰æ›´å¤§çš„å“åº”ã€‚\
æ£€æŸ¥DNSæ˜¯å¦æ”¯æŒé€’å½’çš„æ–¹æ³•æ˜¯æŸ¥è¯¢ä¸€ä¸ªåŸŸåï¼Œå¹¶**æ£€æŸ¥**å“åº”ä¸­æ˜¯å¦åŒ…å«**"ra"æ ‡å¿—**ï¼ˆ_é€’å½’å¯ç”¨_ï¼‰ï¼š
```bash
dig google.com A @<IP>
```
**ä¸å¯ç”¨**ï¼š

![](<../.gitbook/assets/image (275).png>)

**å¯ç”¨**ï¼š

![](<../.gitbook/assets/image (276).png>)

<figure><img src="../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conferenceæ˜¯ä¸€åœºå›½é™…ç½‘ç»œå®‰å…¨æ´»åŠ¨**](https://www.dragonjarcon.org/)ï¼Œå·²ç»ä¸¾åŠäº†åå¤šå¹´ï¼Œå°†äº2023å¹´9æœˆ7æ—¥è‡³8æ—¥åœ¨å“¥ä¼¦æ¯”äºšæ³¢å“¥å¤§ä¸¾è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªå†…å®¹ä¸°å¯Œçš„æŠ€æœ¯æ´»åŠ¨ï¼Œå±•ç¤ºäº†æœ€æ–°çš„è¥¿ç­ç‰™è¯­ç ”ç©¶æˆæœï¼Œå¸å¼•äº†æ¥è‡ªä¸–ç•Œå„åœ°çš„é»‘å®¢å’Œç ”ç©¶äººå‘˜ã€‚
ç«‹å³åœ¨ä»¥ä¸‹é“¾æ¥æ³¨å†Œï¼Œä¸è¦é”™è¿‡è¿™ä¸ªé‡è¦çš„ä¼šè®®ï¼ï¼š

{% embed url="https://www.dragonjarcon.org/" %}

### å‘é€é‚®ä»¶åˆ°ä¸å­˜åœ¨çš„è´¦æˆ·

æ¥è‡ªä¹¦ç±ï¼šã€Šç½‘ç»œå®‰å…¨è¯„ä¼°ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ã€‹

ä»…ä»…å‘ç›®æ ‡åŸŸå‘é€ä¸€å°é‚®ä»¶åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡_ä¸å¯æŠ•é€’é€šçŸ¥_ï¼ˆNDNï¼‰æ­ç¤ºæœ‰ç”¨çš„å†…éƒ¨ç½‘ç»œä¿¡æ¯ã€‚
```
Generating server: noa.nintendo.com

blah@nintendo.com
#550 5.1.1 RESOLVER.ADR.RecipNotFound; not found ##

Original message headers:

Received: from ONERDEDGE02.one.nintendo.com (10.13.20.35) by
onerdexch08.one.nintendo.com (10.13.30.39) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Sat, 26 Apr 2014 16:52:22 -0700
Received: from barracuda.noa.nintendo.com (205.166.76.35) by
ONERDEDGE02.one.nintendo.com (10.13.20.35) with Microsoft SMTP Server (TLS)
id 14.3.174.1; Sat, 26 Apr 2014 16:51:22 -0700
X-ASG-Debug-ID: 1398556333-0614671716199b0d0001-zOQ9WJ
Received: from gateway05.websitewelcome.com (gateway05.websitewelcome.com  [69.93.154.37]) by
barracuda.noa.nintendo.com with ESMTP id xVNPkwaqGgdyH5Ag for <blah@nintendo.com>; Sat,
26 Apr 2014 16:52:13 -0700 (PDT)
X-Barracuda-Envelope-From: chris@example.org
X-Barracuda-Apparent-Source-IP: 69.93.154.37
```
ä»¥ä¸‹æ˜¯æ­¤è®°å½•ä¸­æœ‰ç”¨çš„æ•°æ®ï¼š

* å†…éƒ¨ä¸»æœºåã€IPåœ°å€å’Œå­åŸŸå¸ƒå±€
* é‚®ä»¶æœåŠ¡å™¨æ­£åœ¨è¿è¡ŒMicrosoft Exchange Server 2010 SP3
* ä½¿ç”¨Barracuda Networksè®¾å¤‡è¿›è¡Œå†…å®¹è¿‡æ»¤

## é…ç½®æ–‡ä»¶
```
host.conf
/etc/resolv.conf
/etc/bind/named.conf
/etc/bind/named.conf.local
/etc/bind/named.conf.options
/etc/bind/named.conf.log
/etc/bind/*
```
é…ç½®BindæœåŠ¡å™¨æ—¶çš„å±é™©è®¾ç½®ï¼š

| **é€‰é¡¹**           | **æè¿°**                                                                 |
| ----------------- | ----------------------------------------------------------------------- |
| `allow-query`     | å®šä¹‰å…è®¸å‘DNSæœåŠ¡å™¨å‘é€è¯·æ±‚çš„ä¸»æœºã€‚                                      |
| `allow-recursion` | å®šä¹‰å…è®¸å‘DNSæœåŠ¡å™¨å‘é€é€’å½’è¯·æ±‚çš„ä¸»æœºã€‚                                  |
| `allow-transfer`  | å®šä¹‰å…è®¸ä»DNSæœåŠ¡å™¨æ¥æ”¶åŒºåŸŸä¼ è¾“çš„ä¸»æœºã€‚                                  |
| `zone-statistics` | æ”¶é›†åŒºåŸŸçš„ç»Ÿè®¡æ•°æ®ã€‚                                                     |

## HackTricksè‡ªåŠ¨å‘½ä»¤
```
Protocol_Name: DNS    #Protocol Abbreviation if there is one.
Port_Number:  53     #Comma separated if there is more than one.
Protocol_Description: Domain Name Service        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for DNS
Note: |
#These are the commands I run every time I see an open DNS port

dnsrecon -r 127.0.0.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r 127.0.1.0/24 -n {IP} -d {Domain_Name}
dnsrecon -r {Network}{CIDR} -n {IP} -d {Domain_Name}
dig axfr @{IP}
dig axfr {Domain_Name} @{IP}
nslookup
SERVER {IP}
127.0.0.1
{IP}
Domain_Name
exit

https://book.hacktricks.xyz/pentesting/pentesting-dns

Entry_2:
Name: Banner Grab
Description: Grab DNS Banner
Command: dig version.bind CHAOS TXT @DNS

Entry_3:
Name: Nmap Vuln Scan
Description: Scan for Vulnerabilities with Nmap
Command: nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" {IP}

Entry_4:
Name: Zone Transfer
Description: Three attempts at forcing a zone transfer
Command: dig axfr @{IP} && dix axfr @{IP} {Domain_Name} && fierce --dns-servers {IP} --domain {Domain_Name}


Entry_5:
Name: Active Directory
Description: Eunuerate a DC via DNS
Command: dig -t _gc._{Domain_Name} && dig -t _ldap._{Domain_Name} && dig -t _kerberos._{Domain_Name} && dig -t _kpasswd._{Domain_Name} && nmap --script dns-srv-enum --script-args "dns-srv-enum.domain={Domain_Name}"

Entry_6:
Name: consolesless mfs enumeration
Description: DNS enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/dns/dns_amp; set RHOSTS {IP}; set RPORT 53; run; exit' && msfconsole -q -x 'use auxiliary/gather/enum_dns; set RHOSTS {IP}; set RPORT 53; run; exit'
```
<figure><img src="../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conferenceæ˜¯ä¸€åœºå›½é™…ç½‘ç»œå®‰å…¨æ´»åŠ¨**](https://www.dragonjarcon.org/)ï¼Œå°†äº2023å¹´9æœˆ7æ—¥è‡³8æ—¥åœ¨å“¥ä¼¦æ¯”äºšæ³¢å“¥å¤§ä¸¾è¡Œã€‚è¿™æ˜¯ä¸€åœºå†…å®¹ä¸°å¯Œçš„æŠ€æœ¯æ´»åŠ¨ï¼Œå±•ç¤ºäº†æœ€æ–°çš„è¥¿ç­ç‰™è¯­ç ”ç©¶æˆæœï¼Œå¸å¼•äº†æ¥è‡ªä¸–ç•Œå„åœ°çš„é»‘å®¢å’Œç ”ç©¶äººå‘˜ã€‚\
ç«‹å³åœ¨ä»¥ä¸‹é“¾æ¥æ³¨å†Œï¼Œä¸è¦é”™è¿‡è¿™ä¸ªé‡è¦çš„ä¼šè®®ï¼:

{% embed url="https://www.dragonjarcon.org/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
