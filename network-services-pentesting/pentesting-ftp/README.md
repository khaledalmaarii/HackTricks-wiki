# 21 - Pentesting FTP

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Temel Bilgiler

**Dosya Transfer ProtokolÃ¼ (FTP)**, bir sunucu ile bir istemci arasÄ±nda bir bilgisayar aÄŸÄ± Ã¼zerinden dosya transferi iÃ§in standart bir protokol olarak hizmet eder.\
Bu, **dÃ¼z metin** protokolÃ¼dÃ¼r ve **yeni satÄ±r karakteri `0x0d 0x0a`** kullanÄ±r, bu nedenle bazen **`telnet`** veya **`nc -C`** kullanarak **baÄŸlanmanÄ±z** gerekebilir.

**VarsayÄ±lan Port:** 21
```
PORT   STATE SERVICE
21/tcp open  ftp
```
### BaÄŸlantÄ±lar Aktif & Pasif

**Aktif FTP**'de FTP **istemcisi** Ã¶nce kontrol **baÄŸlantÄ±sÄ±nÄ±** kendi N portundan FTP Sunucusunun komut portuna - port 21'e **baÅŸlatÄ±r**. **Ä°stemci** daha sonra **N+1** portunu dinler ve N+1 portunu FTP Sunucusuna gÃ¶nderir. FTP **Sunucusu** daha sonra veri **baÄŸlantÄ±sÄ±nÄ±** **M portundan FTP Ä°stemcisinin N+1 portuna** **baÅŸlatÄ±r**.

Ancak, eÄŸer FTP Ä°stemcisinin dÄ±ÅŸarÄ±dan gelen veri baÄŸlantÄ±larÄ±nÄ± kontrol eden bir gÃ¼venlik duvarÄ± varsa, o zaman aktif FTP bir sorun olabilir. Bunun iÃ§in uygulanabilir bir Ã§Ã¶zÃ¼m Pasif FTP'dir.

**Pasif FTP**'de istemci kontrol baÄŸlantÄ±sÄ±nÄ± kendi N portundan FTP Sunucusunun 21 portuna baÅŸlatÄ±r. Bunun ardÄ±ndan istemci bir **passv komutu** gÃ¶nderir. Sunucu daha sonra istemciye kendi port numarasÄ±ndan birini M gÃ¶nderir. Ve **istemci** veri **baÄŸlantÄ±sÄ±nÄ±** **P portundan FTP Sunucusunun M portuna** **baÅŸlatÄ±r**.

Kaynak: [https://www.thesecuritybuddy.com/vulnerabilities/what-is-ftp-bounce-attack/](https://www.thesecuritybuddy.com/vulnerabilities/what-is-ftp-bounce-attack/)

### BaÄŸlantÄ± hata ayÄ±klama

**FTP** komutlarÄ± **`debug`** ve **`trace`** **ile iletiÅŸimin nasÄ±l gerÃ§ekleÅŸtiÄŸini** gÃ¶rebilirsiniz.

## SayÄ±m

### AfiÅŸ Alma
```bash
nc -vn <IP> 21
openssl s_client -connect crossfit.htb:21 -starttls ftp #Get certificate if any
```
### Starttls kullanarak FTP'ye baÄŸlanÄ±n
```
lftp
lftp :~> set ftp:ssl-force true
lftp :~> set ssl:verify-certificate no
lftp :~> connect 10.10.10.208
lftp 10.10.10.208:~> login
Usage: login <user|URL> [<pass>]
lftp 10.10.10.208:~> login username Password
```
### Unauth enum

**nmap** ile
```bash
sudo nmap -sV -p21 -sC -A 10.10.10.10
```
FTP sunucusundan bazÄ± bilgileri almak iÃ§in `HELP` ve `FEAT` komutlarÄ±nÄ± kullanabilirsiniz:
```
HELP
214-The following commands are recognized (* =>'s unimplemented):
214-CWD     XCWD    CDUP    XCUP    SMNT*   QUIT    PORT    PASV
214-EPRT    EPSV    ALLO*   RNFR    RNTO    DELE    MDTM    RMD
214-XRMD    MKD     XMKD    PWD     XPWD    SIZE    SYST    HELP
214-NOOP    FEAT    OPTS    AUTH    CCC*    CONF*   ENC*    MIC*
214-PBSZ    PROT    TYPE    STRU    MODE    RETR    STOR    STOU
214-APPE    REST    ABOR    USER    PASS    ACCT*   REIN*   LIST
214-NLST    STAT    SITE    MLSD    MLST
214 Direct comments to root@drei.work

FEAT
211-Features:
PROT
CCC
PBSZ
AUTH TLS
MFF modify;UNIX.group;UNIX.mode;
REST STREAM
MLST modify*;perm*;size*;type*;unique*;UNIX.group*;UNIX.mode*;UNIX.owner*;
UTF8
EPRT
EPSV
LANG en-US
MDTM
SSCN
TVFS
MFMT
SIZE
211 End

STAT
#Info about the FTP server (version, configs, status...)
```
### Anonymous login

_anonymous : anonim_\
_anonymous :_\
_ftp : ftp_
```bash
ftp <IP>
>anonymous
>anonymous
>ls -a # List all files (even hidden) (yes, they could be hidden)
>binary #Set transmission to binary instead of ascii
>ascii #Set transmission to ascii instead of binary
>bye #exit
```
### [Brute force](../../generic-methodologies-and-resources/brute-force.md#ftp)

Burada varsayÄ±lan ftp kimlik bilgileriyle ilgili gÃ¼zel bir liste bulabilirsiniz: [https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt)

### Automated

Anon giriÅŸ ve bounce FTP kontrolleri, nmap ile varsayÄ±lan olarak **-sC** seÃ§eneÄŸiyle gerÃ§ekleÅŸtirilir veya:
```bash
nmap --script ftp-* -p 21 <ip>
```
## TarayÄ±cÄ± baÄŸlantÄ±sÄ±

Bir FTP sunucusuna bir URL kullanarak (Firefox gibi) baÄŸlanabilirsiniz:
```bash
ftp://anonymous:anonymous@10.10.10.98
```
Not edin ki eÄŸer bir **web uygulamasÄ±** kullanÄ±cÄ± tarafÄ±ndan kontrol edilen verileri **doÄŸrudan bir FTP sunucusuna** gÃ¶nderiyorsa, Ã§ift URL kodlamasÄ± `%0d%0a` (Ã§ift URL kodlamada bu `%250d%250a`) baytlarÄ±nÄ± gÃ¶nderebilir ve **FTP sunucusunun keyfi eylemler** gerÃ§ekleÅŸtirmesini saÄŸlayabilirsiniz. Bu olasÄ± keyfi eylemlerden biri, bir kullanÄ±cÄ±nÄ±n kontrolÃ¼ndeki sunucudan iÃ§erik indirmek, port taramasÄ± yapmak veya diÄŸer dÃ¼z metin tabanlÄ± hizmetlerle (Ã¶rneÄŸin http) iletiÅŸim kurmaya Ã§alÄ±ÅŸmaktÄ±r.

## FTP'den tÃ¼m dosyalarÄ± indirin
```bash
wget -m ftp://anonymous:anonymous@10.10.10.98 #Donwload all
wget -m --no-passive ftp://anonymous:anonymous@10.10.10.98 #Download all
```
EÄŸer kullanÄ±cÄ±/adÄ±nÄ±zda Ã¶zel karakterler varsa, [aÅŸaÄŸÄ±daki komut](https://stackoverflow.com/a/113900/13647948) kullanÄ±labilir:
```bash
wget -r --user="USERNAME" --password="PASSWORD" ftp://server.com/
```
## BazÄ± FTP komutlarÄ±

* **`USER kullanÄ±cÄ±_adÄ±`**
* **`PASS ÅŸifre`**
* **`HELP`** Sunucu hangi komutlarÄ±n desteklendiÄŸini belirtir
* \*\*`PORT 127,0,0,1,0,80`\*\* Bu, FTP sunucusuna 127.0.0.1 IP'si ile 80 numaralÄ± portta bir baÄŸlantÄ± kurmasÄ±nÄ± belirtir (_5. karakteri "0" ve 6. karakteri ondalÄ±k olarak port olarak koymalÄ±sÄ±nÄ±z ya da 5. ve 6. karakteri hex olarak portu ifade etmek iÃ§in kullanmalÄ±sÄ±nÄ±z_).
* \*\*`EPRT |2|127.0.0.1|80|`\*\* Bu, FTP sunucusuna 127.0.0.1 IP'si ile 80 numaralÄ± portta bir TCP baÄŸlantÄ±sÄ± kurmasÄ±nÄ± belirtir (_"2" ile belirtilmiÅŸtir_). Bu komut **IPv6 destekler**.
* **`LIST`** Bu, mevcut klasÃ¶rdeki dosyalarÄ±n listesini gÃ¶nderir
* **`LIST -R`** RekÃ¼rsif listeleme (sunucu tarafÄ±ndan izin verilirse)
* **`APPE /path/something.txt`** Bu, FTP'ye **pasif** bir baÄŸlantÄ±dan veya **PORT/EPRT** baÄŸlantÄ±sÄ±ndan alÄ±nan verileri bir dosyaya kaydetmesini belirtir. Dosya adÄ± mevcutsa, verileri ekler.
* **`STOR /path/something.txt`** `APPE` gibi ama dosyalarÄ± Ã¼zerine yazar
* **`STOU /path/something.txt`** `APPE` gibi, ama mevcutsa hiÃ§bir ÅŸey yapmaz.
* **`RETR /path/to/file`** Pasif veya bir port baÄŸlantÄ±sÄ± kurulmalÄ±dÄ±r. ArdÄ±ndan, FTP sunucusu belirtilen dosyayÄ± bu baÄŸlantÄ± Ã¼zerinden gÃ¶nderir
* **`REST 6`** Bu, sunucuya bir sonraki `RETR` kullanÄ±ldÄ±ÄŸÄ±nda 6. bayttan baÅŸlamasÄ± gerektiÄŸini belirtir.
* **`TYPE i`** Transferi ikili olarak ayarlar
* **`PASV`** Bu, pasif bir baÄŸlantÄ± aÃ§ar ve kullanÄ±cÄ±ya nereden baÄŸlanabileceÄŸini belirtir
* **`PUT /tmp/file.txt`** Belirtilen dosyayÄ± FTP'ye yÃ¼kler

![](<../../.gitbook/assets/image (386).png>)

## FTPBounce saldÄ±rÄ±sÄ±

BazÄ± FTP sunucularÄ± PORT komutuna izin verir. Bu komut, sunucuya baÅŸka bir FTP sunucusuna belirli bir portta baÄŸlanmak istediÄŸinizi belirtmek iÃ§in kullanÄ±labilir. ArdÄ±ndan, bunu bir FTP sunucusu aracÄ±lÄ±ÄŸÄ±yla bir ana bilgisayarÄ±n hangi portlarÄ±nÄ±n aÃ§Ä±k olduÄŸunu taramak iÃ§in kullanabilirsiniz.

[**Burada bir FTP sunucusunu kullanarak portlarÄ± nasÄ±l tarayacaÄŸÄ±nÄ±zÄ± Ã¶ÄŸrenin.**](ftp-bounce-attack.md)

Bu davranÄ±ÅŸÄ±, bir FTP sunucusunun diÄŸer protokollerle etkileÅŸimde bulunmasÄ±nÄ± saÄŸlamak iÃ§in de kÃ¶tÃ¼ye kullanabilirsiniz. **Bir HTTP isteÄŸi iÃ§eren bir dosya yÃ¼kleyebilir** ve savunmasÄ±z FTP sunucusunun **bunu rastgele bir HTTP sunucusuna gÃ¶ndermesini** saÄŸlayabilirsiniz (_belki yeni bir yÃ¶netici kullanÄ±cÄ±sÄ± eklemek iÃ§in?_) veya hatta bir FTP isteÄŸi yÃ¼kleyip savunmasÄ±z FTP sunucusunun farklÄ± bir FTP sunucusundan bir dosya indirmesini saÄŸlayabilirsiniz.\
Teori basit:

1. **Ä°steÄŸi (bir metin dosyasÄ± iÃ§inde) savunmasÄ±z sunucuya yÃ¼kleyin.** BaÅŸka bir HTTP veya FTP sunucusuyla konuÅŸmak istiyorsanÄ±z, satÄ±rlarÄ± `0x0d 0x0a` ile deÄŸiÅŸtirmeniz gerektiÄŸini unutmayÄ±n
2. **GÃ¶ndermek istemediÄŸiniz karakterleri gÃ¶ndermemek iÃ§in `REST X` kullanÄ±n** (belki isteÄŸi dosya iÃ§inde yÃ¼klemek iÃ§in baÅŸta bazÄ± resim baÅŸlÄ±klarÄ± koymanÄ±z gerekiyordu)
3. **Rastgele sunucu ve hizmete baÄŸlanmak iÃ§in `PORT` kullanÄ±n**
4. **Kaydedilen isteÄŸi sunucuya gÃ¶ndermek iÃ§in `RETR` kullanÄ±n.**

Bu **hata verecektir** _**Socket yazÄ±labilir deÄŸil**_ **Ã§Ã¼nkÃ¼ baÄŸlantÄ±, verileri `RETR` ile gÃ¶ndermek iÃ§in yeterince uzun sÃ¼rmez**. Bunu Ã¶nlemeye Ã§alÄ±ÅŸmak iÃ§in Ã¶neriler:

* EÄŸer bir HTTP isteÄŸi gÃ¶nderiyorsanÄ±z, **aynÄ± isteÄŸi birbiri ardÄ±na koyun** en az **\~0.5MB** kadar. BÃ¶ylece:

{% file src="../../.gitbook/assets/posts.txt" %}
posts.txt
{% endfile %}

* Ä°steÄŸi **protokole gÃ¶re "Ã§Ã¶p" verilerle doldurmaya Ã§alÄ±ÅŸÄ±n** (FTP ile konuÅŸurken belki sadece Ã§Ã¶p komutlar veya dosyayÄ± almak iÃ§in `RETR` talimatÄ±nÄ± tekrarlamak)
* Sadece **isteÄŸi birÃ§ok null karakter veya diÄŸerleriyle doldurun** (satÄ±rlara bÃ¶lÃ¼nmÃ¼ÅŸ veya bÃ¶lÃ¼nmemiÅŸ)

Her neyse, burada [bu davranÄ±ÅŸÄ± kullanarak bir FTP sunucusunun farklÄ± bir FTP sunucusundan bir dosya indirmesi hakkÄ±nda eski bir Ã¶rnek var.](ftp-bounce-download-2oftp-file.md)

## Filezilla Sunucu AÃ§Ä±ÄŸÄ±

**FileZilla** genellikle **yerel** bir **YÃ¶netim hizmetine** **FileZilla-Server** iÃ§in (port 14147) **baÄŸlanÄ±r**. EÄŸer **makinenizden** bu porta eriÅŸmek iÃ§in bir **tÃ¼nel** oluÅŸturabilirseniz, **boÅŸ bir ÅŸifre** kullanarak **baÄŸlanabilir** ve FTP hizmeti iÃ§in **yeni bir kullanÄ±cÄ± oluÅŸturabilirsiniz**.

## KonfigÃ¼rasyon dosyalarÄ±
```
ftpusers
ftp.conf
proftpd.conf
vsftpd.conf
```
### Post-Exploitation

vsFTPd'nin varsayÄ±lan yapÄ±landÄ±rmasÄ± `/etc/vsftpd.conf` dosyasÄ±nda bulunabilir. Burada bazÄ± tehlikeli ayarlarÄ± bulabilirsiniz:

* `anonymous_enable=YES`
* `anon_upload_enable=YES`
* `anon_mkdir_write_enable=YES`
* `anon_root=/home/username/ftp` - Anonim iÃ§in dizin.
* `chown_uploads=YES` - Anonim olarak yÃ¼klenen dosyalarÄ±n sahipliÄŸini deÄŸiÅŸtir
* `chown_username=username` - Anonim olarak yÃ¼klenen dosyalarÄ±n sahipliÄŸini alan kullanÄ±cÄ±
* `local_enable=YES` - Yerel kullanÄ±cÄ±larÄ±n giriÅŸ yapmasÄ±na izin ver
* `no_anon_password=YES` - Anonimden ÅŸifre isteme
* `write_enable=YES` - AÅŸaÄŸÄ±daki komutlara izin ver: STOR, DELE, RNFR, RNTO, MKD, RMD, APPE ve SITE

### Shodan

* `ftp`
* `port:21`


## HackTricks Automatic Commands
```
Protocol_Name: FTP    #Protocol Abbreviation if there is one.
Port_Number:  21     #Comma separated if there is more than one.
Protocol_Description: File Transfer Protocol          #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for FTP
Note: |
Anonymous Login
-bi     <<< so that your put is done via binary

wget --mirror 'ftp://ftp_user:UTDRSCH53c"$6hys@10.10.10.59'
^^to download all dirs and files

wget --no-passive-ftp --mirror 'ftp://anonymous:anonymous@10.10.10.98'
if PASV transfer is disabled

https://book.hacktricks.xyz/pentesting/pentesting-ftp

Entry_2:
Name: Banner Grab
Description: Grab FTP Banner via telnet
Command: telnet -n {IP} 21

Entry_3:
Name: Cert Grab
Description: Grab FTP Certificate if existing
Command: openssl s_client -connect {IP}:21 -starttls ftp

Entry_4:
Name: nmap ftp
Description: Anon login and bounce FTP checks are performed
Command: nmap --script ftp-* -p 21 {IP}

Entry_5:
Name: Browser Connection
Description: Connect with Browser
Note: ftp://anonymous:anonymous@{IP}

Entry_6:
Name: Hydra Brute Force
Description: Need Username
Command: hydra -t 1 -l {Username} -P {Big_Passwordlist} -vV {IP} ftp

Entry_7:
Name: consolesless mfs enumeration ftp
Description: FTP enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/ftp/anonymous; set RHOSTS {IP}; set RPORT 21; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ftp/ftp_version; set RHOSTS {IP}; set RPORT 21; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ftp/bison_ftp_traversal; set RHOSTS {IP}; set RPORT 21; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ftp/colorado_ftp_traversal; set RHOSTS {IP}; set RPORT 21; run; exit' &&  msfconsole -q -x 'use auxiliary/scanner/ftp/titanftp_xcrc_traversal; set RHOSTS {IP}; set RPORT 21; run; exit'
```
{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
