# 143,993 - IMAP Pentesting

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

En Ã¶nemli olan zayÄ±flÄ±klarÄ± bulun, bÃ¶ylece daha hÄ±zlÄ± dÃ¼zeltebilirsiniz. Intruder saldÄ±rÄ± yÃ¼zeyinizi takip eder, proaktif tehdit taramalarÄ± yapar, API'lerden web uygulamalarÄ±na ve bulut sistemlerine kadar tÃ¼m teknoloji yÄ±ÄŸÄ±nÄ±nÄ±zda sorunlarÄ± bulur. [**Ãœcretsiz deneyin**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) bugÃ¼n.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Internet Mesaj EriÅŸim ProtokolÃ¼

**Internet Mesaj EriÅŸim ProtokolÃ¼ (IMAP)**, kullanÄ±cÄ±larÄ±n **herhangi bir konumdan e-posta mesajlarÄ±na eriÅŸmelerini** saÄŸlamak amacÄ±yla tasarlanmÄ±ÅŸtÄ±r, Ã¶ncelikle bir Ä°nternet baÄŸlantÄ±sÄ± aracÄ±lÄ±ÄŸÄ±yla. Temel olarak, e-postalar, bireyin kiÅŸisel cihazÄ±na indirilip depolanmak yerine bir sunucuda **saklanÄ±r**. Bu, bir e-posta eriÅŸildiÄŸinde veya okunduÄŸunda, bunun **doÄŸrudan sunucudan** yapÄ±ldÄ±ÄŸÄ± anlamÄ±na gelir. Bu yetenek, kullanÄ±lan cihaza bakÄ±lmaksÄ±zÄ±n e-postalarÄ±n **Ã§oklu cihazlardan** kontrol edilmesini saÄŸlar, bÃ¶ylece hiÃ§bir mesaj gÃ¶zden kaÃ§maz.

VarsayÄ±lan olarak, IMAP protokolÃ¼ iki baÄŸlantÄ± noktasÄ±nda Ã§alÄ±ÅŸÄ±r:

* **Port 143** - bu, varsayÄ±lan IMAP ÅŸifrelenmemiÅŸ baÄŸlantÄ± noktasÄ±dÄ±r
* **Port 993** - IMAP ile gÃ¼venli bir ÅŸekilde baÄŸlanmak istiyorsanÄ±z kullanmanÄ±z gereken baÄŸlantÄ± noktasÄ±dÄ±r
```
PORT    STATE SERVICE REASON
143/tcp open  imap    syn-ack
```
## Banner yakalama

Banner yakalama, bir hedef IMAP sunucusuyla iletiÅŸim kurarken sunucunun banner mesajÄ±nÄ± almak iÃ§in kullanÄ±lan bir tekniktir. Banner mesajÄ±, sunucunun kendisini tanÄ±ttÄ±ÄŸÄ± ve genellikle sunucu yazÄ±lÄ±mÄ±nÄ±n ve sÃ¼rÃ¼mÃ¼nÃ¼n bilgisini iÃ§erir. Bu bilgi, saldÄ±rganÄ±n hedef sistem hakkÄ±nda daha fazla bilgi edinmesine yardÄ±mcÄ± olabilir.

Banner yakalama iÅŸlemi genellikle bir IMAP istemcisi kullanÄ±larak gerÃ§ekleÅŸtirilir. Ä°stemci, sunucuya baÄŸlandÄ±ÄŸÄ±nda sunucudan gelen banner mesajÄ±nÄ± alÄ±r. Bu mesaj, istemci tarafÄ±ndan okunabilir ve analiz edilebilir.

Banner yakalama, saldÄ±rganÄ±n hedef sistemdeki zayÄ±f noktalarÄ± belirlemesine yardÄ±mcÄ± olabilir. Ã–rneÄŸin, sunucu yazÄ±lÄ±mÄ±nÄ±n eski bir sÃ¼rÃ¼mÃ¼nÃ¼ kullanÄ±yorsa, bu sÃ¼rÃ¼mde bilinen bir gÃ¼venlik aÃ§Ä±ÄŸÄ± olabilir. SaldÄ±rgan, bu bilgiyi kullanarak hedef sistemdeki bir saldÄ±rÄ± vektÃ¶rÃ¼ belirleyebilir.

Banner yakalama iÅŸlemi, bir IMAP sunucusunun gÃ¼venlik durumunu deÄŸerlendirmek iÃ§in kullanÄ±lan bir adÄ±mdÄ±r. Ancak, bu tekniÄŸin yasal ve etik sÄ±nÄ±rlar iÃ§inde kullanÄ±lmasÄ± Ã¶nemlidir. Sadece izinli sistemler Ã¼zerinde gerÃ§ekleÅŸtirilmelidir ve hedef sistem sahibinin izni olmadan yapÄ±lmamalÄ±dÄ±r.
```bash
nc -nv <IP> 143
openssl s_client -connect <IP>:993 -quiet
```
### NTLM Auth - Bilgi sÄ±zdÄ±rma

EÄŸer sunucu NTLM kimlik doÄŸrulamayÄ± destekliyorsa (Windows), hassas bilgileri (sÃ¼rÃ¼mler) elde edebilirsiniz:
```
root@kali: telnet example.com 143
* OK The Microsoft Exchange IMAP4 service is ready.
>> a1 AUTHENTICATE NTLM
+
>> TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA=
+ TlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAA
```
Veya bunu **nmap** eklentisi `imap-ntlm-info.nse` ile **otomatikleÅŸtirin**.

### [IMAP Bruteforce](../generic-methodologies-and-resources/brute-force.md#imap)

## SÃ¶zdizimi

[Ä°ÅŸte](https://donsutherland.org/crib/imap) IAMP KomutlarÄ±ndan Ã¶rnekler:
```
Login
A1 LOGIN username password
Values can be quoted to enclose spaces and special characters. A " must then be escape with a \
A1 LOGIN "username" "password"

List Folders/Mailboxes
A1 LIST "" *
A1 LIST INBOX *
A1 LIST "Archive" *

Create new Folder/Mailbox
A1 CREATE INBOX.Archive.2012
A1 CREATE "To Read"

Delete Folder/Mailbox
A1 DELETE INBOX.Archive.2012
A1 DELETE "To Read"

Rename Folder/Mailbox
A1 RENAME "INBOX.One" "INBOX.Two"

List Subscribed Mailboxes
A1 LSUB "" *

Status of Mailbox (There are more flags than the ones listed)
A1 STATUS INBOX (MESSAGES UNSEEN RECENT)

Select a mailbox
A1 SELECT INBOX

List messages
A1 FETCH 1:* (FLAGS)
A1 UID FETCH 1:* (FLAGS)

Retrieve Message Content
A1 FETCH 2 body[text]
A1 FETCH 2 all
A1 UID FETCH 102 (UID RFC822.SIZE BODY.PEEK[])

Close Mailbox
A1 CLOSE

Logout
A1 LOGOUT
```
### Evrim

IMAP (Internet Message Access Protocol), elektronik posta iletiÅŸimi iÃ§in kullanÄ±lan bir protokoldÃ¼r. IMAP, e-posta istemcilerinin sunucu Ã¼zerindeki e-posta kutularÄ±na eriÅŸmesine ve yÃ¶netmesine olanak tanÄ±r. Bu protokol, e-posta mesajlarÄ±nÄ± sunucuda tutar ve istemciye sadece gerektiÄŸinde iletiÅŸim kurmasÄ±nÄ± saÄŸlar.

IMAP, POP3'e (Post Office Protocol 3) gÃ¶re daha geliÅŸmiÅŸ bir protokoldÃ¼r. POP3, e-posta mesajlarÄ±nÄ± istemciye indirirken sunucuda silerken, IMAP sunucuda kopyalarÄ±nÄ± tutar ve istemciye sadece gÃ¶rÃ¼ntÃ¼lemek veya indirmek iÃ§in gÃ¶nderir. Bu, birden fazla cihazda e-posta eriÅŸimi saÄŸlamak iÃ§in idealdir.

IMAP protokolÃ¼, e-posta kutularÄ±nÄ± yÃ¶netmek iÃ§in bir dizi komut ve yanÄ±t kullanÄ±r. Bu komutlar, e-posta mesajlarÄ±nÄ± okuma, yazma, silme, taÅŸÄ±ma ve klasÃ¶rlere eriÅŸim gibi iÅŸlemleri gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±lÄ±r. IMAP sunucularÄ± genellikle TCP Ã¼zerinden 143 numaralÄ± portu kullanÄ±r.

IMAP protokolÃ¼nÃ¼ kullanarak yapÄ±labilecek bazÄ± saldÄ±rÄ±lar ÅŸunlardÄ±r:

- Brute force saldÄ±rÄ±larÄ±: Kaba kuvvet saldÄ±rÄ±larÄ±, IMAP sunucusuna giriÅŸ yapmak iÃ§in kullanÄ±cÄ± adÄ± ve ÅŸifre kombinasyonlarÄ±nÄ± denemek iÃ§in kullanÄ±lÄ±r.
- Kimlik avÄ± saldÄ±rÄ±larÄ±: Kimlik avÄ± saldÄ±rÄ±larÄ±, kullanÄ±cÄ±larÄ± sahte e-posta veya web sitelerine yÃ¶nlendirerek kullanÄ±cÄ± adÄ± ve ÅŸifrelerini ele geÃ§irmeyi amaÃ§lar.
- IMAP sunucusu zafiyetleri: IMAP sunucularÄ±, gÃ¼venlik aÃ§Ä±klarÄ±na sahip olabilir ve bu aÃ§Ä±klar kullanÄ±larak saldÄ±rganlar tarafÄ±ndan istismar edilebilir.
- Veri sÄ±zÄ±ntÄ±sÄ±: IMAP sunucusunda depolanan e-posta mesajlarÄ±, saldÄ±rganlar tarafÄ±ndan ele geÃ§irilebilir ve hassas bilgilerin sÄ±zdÄ±rÄ±lmasÄ±na neden olabilir.

IMAP protokolÃ¼nÃ¼ anlamak ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± tespit etmek, bir aÄŸ hizmeti pentestinde Ã¶nemli bir adÄ±mdÄ±r. Bu, saldÄ±rganlarÄ±n e-posta sunucusuna yetkisiz eriÅŸim saÄŸlamasÄ±nÄ± ve hassas bilgilere eriÅŸmesini Ã¶nlemek iÃ§in yapÄ±lan bir gÃ¼venlik Ã¶nlemidir.
```
apt install evolution
```
![](<../.gitbook/assets/image (528).png>)

### CURL

Temel gezinme iÅŸlemleri [CURL](https://ec.haxx.se/usingcurl/usingcurl-reademail#imap) ile mÃ¼mkÃ¼ndÃ¼r, ancak belgeler ayrÄ±ntÄ±lardan yoksundur, bu nedenle kesin ayrÄ±ntÄ±lar iÃ§in [kaynaÄŸa](https://github.com/curl/curl/blob/master/lib/imap.c) bakmanÄ±z Ã¶nerilir.

1.  Posta kutularÄ±nÄ± listeleme (imap komutu `LIST "" "*"`)
```bash
curl -k 'imaps://1.2.3.4/' --user user:pass
```
2. Bir posta kutusundaki iletileri listeleme (imap komutu `SELECT INBOX` ve ardÄ±ndan `SEARCH ALL`)

```bash
curl -k 'imaps://1.2.3.4/INBOX?ALL' --user kullanÄ±cÄ±:parola
```

The result of this search is a list of message indicies.

Its also possible to provide more complex search terms. e.g. searching for drafts with password in mail body:

```bash
```markdown
curl -k 'imaps://1.2.3.4/Drafts?TEXT password' --user user:pass
```

Bu komut, `1.2.3.4` IP adresine sahip bir sunucuya baÄŸlanarak `Drafts` klasÃ¶rÃ¼ndeki e-postalarÄ± almayÄ± amaÃ§lar. `--user` parametresiyle kullanÄ±cÄ± adÄ± ve ÅŸifre belirtilir.
```

A nice overview of the search terms possible is located [here](https://www.atmail.com/blog/imap-commands/).

3.  Downloading a message (imap command `SELECT Drafts` and then `FETCH 1 BODY[]`)

```bash
```markdown
curl -k 'imaps://1.2.3.4/Drafts;MAILINDEX=1' --user user:pass
```

Bu komut, bir IMAP sunucusuna baÄŸlanmak iÃ§in kullanÄ±lÄ±r. `1.2.3.4` IP adresine sahip sunucunun `Drafts` klasÃ¶rÃ¼ne baÄŸlanÄ±r ve `MAILINDEX=1` parametresini kullanÄ±r. `--user user:pass` ise kimlik doÄŸrulama iÃ§in kullanÄ±cÄ± adÄ± ve ÅŸifreyi belirtir.
```

The mail index will be the same index returned from the search operation.

It is also possible to use `UID` (unique id) to access messages, however it is less conveniant as the search command needs to be manually formatted. E.g.

```bash
```markdown
Kod parÃ§acÄ±ÄŸÄ±ndaki `curl` komutlarÄ±, IMAP sunucusuna baÄŸlanmak ve belirli eylemleri gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±lÄ±r. Ä°lk komut, IMAP sunucusuna baÄŸlanÄ±r ve tÃ¼m e-posta kimliklerini arar. Ä°kinci komut ise belirli bir e-posta kimliÄŸini alÄ±r.

Ã‡eviri:

curl -k 'imaps://1.2.3.4/INBOX' -X 'UID SEARCH ALL' --user user:pass
curl -k 'imaps://1.2.3.4/INBOX;UID=1' --user user:pass

```html
```markdown
Kod parÃ§acÄ±ÄŸÄ±ndaki `curl` komutlarÄ±, IMAP sunucusuna baÄŸlanmak ve belirli eylemleri gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±lÄ±r. Ä°lk komut, IMAP sunucusuna baÄŸlanÄ±r ve tÃ¼m e-posta kimliklerini arar. Ä°kinci komut ise belirli bir e-posta kimliÄŸini alÄ±r.

Ã‡eviri:

curl -k 'imaps://1.2.3.4/INBOX' -X 'UID SEARCH ALL' --user user:pass
curl -k 'imaps://1.2.3.4/INBOX;UID=1' --user user:pass

```
```

Also, possible to download just parts of a message, e.g. subject and sender of first 5 messages (the `-v` is required to see the subject and sender):

```bash
```markdown
```bash
$ curl -k 'imaps://1.2.3.4/INBOX' -X 'FETCH 1:5 BODY[HEADER.FIELDS (SUBJECT FROM)]' --user user:pass -v 2>&1 | grep '^<'
```
```

```bash
$ curl -k 'imaps://1.2.3.4/INBOX' -X 'FETCH 1:5 BODY[HEADER.FIELDS (SUBJECT FROM)]' --user user:pass -v 2>&1 | grep '^<'
```
```
```

Although, its probably cleaner to just write a little for loop:

```bash
```bash
for m in {1..5}; do
echo $m
curl "imap://1.2.3.4/INBOX;MAILINDEX=$m;SECTION=HEADER.FIELDS%20(SUBJECT%20FROM)" --user user:pass
done
```

Bu komut, IMAP sunucusuna bir dizi istek gÃ¶nderir ve belirli bir e-posta indeksine ve baÅŸlÄ±k alanlarÄ±na eriÅŸir. Ä°ndeks numarasÄ± deÄŸiÅŸken olan `m` ile belirtilir ve 1'den 5'e kadar olan deÄŸerleri alÄ±r. Ä°stek, `curl` komutu kullanÄ±larak gÃ¶nderilir ve kullanÄ±cÄ± adÄ± ve ÅŸifre belirtilir.
```

## Shodan

* `port:143 CAPABILITY`
* `port:993 CAPABILITY`

## HackTricks Automatic Commands

```
Protocol_AdÄ±: IMAP    #EÄŸer varsa, Protokol KÄ±saltmasÄ±.
Port_NumarasÄ±:  143,993     #Birden fazla ise, virgÃ¼lle ayrÄ±lmÄ±ÅŸ.
Protokol_AÃ§Ä±klamasÄ±: Internet Mesaj EriÅŸim ProtokolÃ¼         #Protokol KÄ±saltmasÄ± tam olarak yazÄ±lmÄ±ÅŸ

Entry_1:
Ad: Notlar
AÃ§Ä±klama: WHOIS iÃ§in Notlar
Not: |
Internet Mesaj EriÅŸim ProtokolÃ¼ (IMAP), kullanÄ±cÄ±larÄ±n herhangi bir konumdan e-posta mesajlarÄ±na eriÅŸmelerini saÄŸlamak amacÄ±yla tasarlanmÄ±ÅŸtÄ±r, Ã¶ncelikle bir Ä°nternet baÄŸlantÄ±sÄ± aracÄ±lÄ±ÄŸÄ±yla. Temel olarak, e-postalar bir sunucuda saklanÄ±r ve bir bireyin kiÅŸisel cihazÄ±na indirilip depolanmak yerine sunucudan doÄŸrudan eriÅŸilir veya okunur. Bu yetenek, birden fazla cihazdan e-postalarÄ± kontrol etme kolaylÄ±ÄŸÄ± saÄŸlar ve kullanÄ±lan cihaza bakÄ±lmaksÄ±zÄ±n hiÃ§bir mesajÄ±n kaÃ§Ä±rÄ±lmamasÄ±nÄ± saÄŸlar.

https://book.hacktricks.xyz/pentesting/pentesting-imap

Entry_2:
Ad: Banner Yakalama
AÃ§Ä±klama: Banner Yakalama 143
Komut: nc -nv {IP} 143

Entry_3:
Ad: GÃ¼venli Banner Yakalama
AÃ§Ä±klama: Banner Yakalama 993
Komut: openssl s_client -connect {IP}:993 -quiet

Entry_4:
Ad: msfconsole'suz mfs numaralandÄ±rma
AÃ§Ä±klama: msfconsole Ã§alÄ±ÅŸtÄ±rmadan IMAP numaralandÄ±rma
Not: https://github.com/carlospolop/legion'dan alÄ±nmÄ±ÅŸtÄ±r
Komut: msfconsole -q -x 'use auxiliary/scanner/imap/imap_version; set RHOSTS {IP}; set RPORT 143; run; exit'
```

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Find vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems. [**Try it for free**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) today.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
