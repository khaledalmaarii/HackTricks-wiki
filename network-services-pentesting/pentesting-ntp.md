# 123/udp - NTPæ¸—é€æµ‹è¯•

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProofæ˜¯æ‰€æœ‰åŠ å¯†æ¼æ´èµé‡‘çš„å®¶å›­ã€‚**

**æ— éœ€ç­‰å¾…å³å¯è·å¾—å¥–åŠ±**\
HackenProofçš„èµé‡‘åªæœ‰åœ¨å®¢æˆ·å­˜å…¥å¥–åŠ±é¢„ç®—åæ‰ä¼šå¯åŠ¨ã€‚åœ¨æ¼æ´éªŒè¯åï¼Œæ‚¨å°†è·å¾—å¥–åŠ±ã€‚

**åœ¨web3æ¸—é€æµ‹è¯•ä¸­ç§¯ç´¯ç»éªŒ**\
åŒºå—é“¾åè®®å’Œæ™ºèƒ½åˆçº¦æ˜¯æ–°çš„äº’è”ç½‘ï¼åœ¨å…¶å…´èµ·çš„æ—¶ä»£æŒæ¡web3å®‰å…¨ã€‚

**æˆä¸ºweb3é»‘å®¢ä¼ å¥‡**\
æ¯æ¬¡éªŒè¯çš„æ¼æ´éƒ½ä¼šè·å¾—å£°èª‰ç§¯åˆ†ï¼Œå¹¶å æ®æ¯å‘¨æ’è¡Œæ¦œçš„æ¦œé¦–ã€‚

[**åœ¨HackenProofä¸Šæ³¨å†Œ**](https://hackenproof.com/register)å¼€å§‹ä»æ‚¨çš„é»‘å®¢æ”»å‡»ä¸­è·åˆ©ï¼

{% embed url="https://hackenproof.com/register" %}

## åŸºæœ¬ä¿¡æ¯

ç½‘ç»œæ—¶é—´åè®®ï¼ˆ**NTP**ï¼‰æ˜¯ä¸€ç§ç”¨äºåœ¨åˆ†ç»„äº¤æ¢ã€å¯å˜å»¶è¿Ÿæ•°æ®ç½‘ç»œä¸Šè¿›è¡Œè®¡ç®—æœºç³»ç»Ÿæ—¶é’ŸåŒæ­¥çš„ç½‘ç»œåè®®ã€‚

**é»˜è®¤ç«¯å£ï¼š** 123/udp
```
PORT    STATE SERVICE REASON
123/udp open  ntp     udp-response
```
## æšä¸¾

### NTP Enumeration

### NTP æšä¸¾

NTP (Network Time Protocol) is a protocol used to synchronize the clocks of computers over a network. It is commonly used to ensure accurate timekeeping on computer systems.

NTP (Network Time Protocol) æ˜¯ä¸€ç§ç”¨äºåœ¨ç½‘ç»œä¸ŠåŒæ­¥è®¡ç®—æœºæ—¶é’Ÿçš„åè®®ã€‚å®ƒé€šå¸¸ç”¨äºç¡®ä¿è®¡ç®—æœºç³»ç»Ÿçš„å‡†ç¡®æ—¶é—´ã€‚

#### NTP Enumeration with nmap

#### ä½¿ç”¨ nmap è¿›è¡Œ NTP æšä¸¾

Nmap can be used to perform NTP enumeration by scanning for open NTP ports (123/udp) on target systems. This can be done using the following command:

å¯ä»¥ä½¿ç”¨ nmap æ‰«æç›®æ ‡ç³»ç»Ÿä¸Šçš„å¼€æ”¾ NTP ç«¯å£ï¼ˆ123/udpï¼‰æ¥æ‰§è¡Œ NTP æšä¸¾ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®Œæˆæ­¤æ“ä½œï¼š

```plaintext
nmap -p 123 -sU <target>
```

#### NTP Enumeration with ntpq

#### ä½¿ç”¨ ntpq è¿›è¡Œ NTP æšä¸¾

The `ntpq` command-line utility can also be used to perform NTP enumeration. It allows you to query NTP servers for information about their configuration and status. To use `ntpq`, you can run the following command:

`ntpq` å‘½ä»¤è¡Œå®ç”¨ç¨‹åºä¹Ÿå¯ä»¥ç”¨äºæ‰§è¡Œ NTP æšä¸¾ã€‚å®ƒå…è®¸æ‚¨æŸ¥è¯¢ NTP æœåŠ¡å™¨ä»¥è·å–æœ‰å…³å…¶é…ç½®å’ŒçŠ¶æ€çš„ä¿¡æ¯ã€‚è¦ä½¿ç”¨ `ntpq`ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```plaintext
ntpq -p <target>
```

This will display a list of NTP servers and their associated information, such as the server's IP address, stratum level, and reachability.

è¿™å°†æ˜¾ç¤º NTP æœåŠ¡å™¨çš„åˆ—è¡¨åŠå…¶ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚æœåŠ¡å™¨çš„ IP åœ°å€ã€å±‚çº§å’Œå¯è¾¾æ€§ã€‚

#### NTP Enumeration with ntptrace

#### ä½¿ç”¨ ntptrace è¿›è¡Œ NTP æšä¸¾

The `ntptrace` command-line utility can be used to trace the path of NTP packets from the local system to a target NTP server. This can help identify the NTP servers in the network and their relationships. To use `ntptrace`, you can run the following command:

`ntptrace` å‘½ä»¤è¡Œå®ç”¨ç¨‹åºå¯ç”¨äºè·Ÿè¸ªä»æœ¬åœ°ç³»ç»Ÿåˆ°ç›®æ ‡ NTP æœåŠ¡å™¨çš„ NTP æ•°æ®åŒ…çš„è·¯å¾„ã€‚è¿™å¯ä»¥å¸®åŠ©è¯†åˆ«ç½‘ç»œä¸­çš„ NTP æœåŠ¡å™¨åŠå…¶å…³ç³»ã€‚è¦ä½¿ç”¨ `ntptrace`ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```plaintext
ntptrace <target>
```

This will display the path of NTP packets and the IP addresses of the NTP servers along the way.

è¿™å°†æ˜¾ç¤º NTP æ•°æ®åŒ…çš„è·¯å¾„ä»¥åŠæ²¿é€”çš„ NTP æœåŠ¡å™¨çš„ IP åœ°å€ã€‚

#### NTP Enumeration with ntpdc

#### ä½¿ç”¨ ntpdc è¿›è¡Œ NTP æšä¸¾

The `ntpdc` command-line utility can be used to query and control an NTP server. It provides various commands to retrieve information about the server's configuration and status. To use `ntpdc`, you can run the following command:

`ntpdc` å‘½ä»¤è¡Œå®ç”¨ç¨‹åºå¯ç”¨äºæŸ¥è¯¢å’Œæ§åˆ¶ NTP æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†å„ç§å‘½ä»¤æ¥è·å–æœ‰å…³æœåŠ¡å™¨é…ç½®å’ŒçŠ¶æ€çš„ä¿¡æ¯ã€‚è¦ä½¿ç”¨ `ntpdc`ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```plaintext
ntpdc -c monlist <target>
```

This will display a list of the last 600 clients that have connected to the NTP server, along with their IP addresses and timestamps.

è¿™å°†æ˜¾ç¤ºæœ€è¿‘è¿æ¥åˆ° NTP æœåŠ¡å™¨çš„æœ€å 600 ä¸ªå®¢æˆ·ç«¯çš„åˆ—è¡¨ï¼Œä»¥åŠå®ƒä»¬çš„ IP åœ°å€å’Œæ—¶é—´æˆ³ã€‚

### NTP Enumeration with Metasploit

### ä½¿ç”¨ Metasploit è¿›è¡Œ NTP æšä¸¾

Metasploit, a popular penetration testing framework, also provides modules for NTP enumeration. These modules can be used to scan for NTP servers, gather information about them, and even exploit vulnerabilities if any are found.

Metasploit æ˜¯ä¸€ä¸ªæµè¡Œçš„æ¸—é€æµ‹è¯•æ¡†æ¶ï¼Œè¿˜æä¾›äº†ç”¨äº NTP æšä¸¾çš„æ¨¡å—ã€‚è¿™äº›æ¨¡å—å¯ç”¨äºæ‰«æ NTP æœåŠ¡å™¨ã€æ”¶é›†æœ‰å…³å®ƒä»¬çš„ä¿¡æ¯ï¼Œç”šè‡³åœ¨å‘ç°æ¼æ´æ—¶åˆ©ç”¨å®ƒä»¬ã€‚

To use Metasploit for NTP enumeration, you can follow these steps:

è¦ä½¿ç”¨ Metasploit è¿›è¡Œ NTP æšä¸¾ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š

1. Start Metasploit by running the `msfconsole` command.

   è¿è¡Œ `msfconsole` å‘½ä»¤å¯åŠ¨ Metasploitã€‚

2. Search for NTP-related modules using the `search` command.

   ä½¿ç”¨ `search` å‘½ä»¤æœç´¢ä¸ NTP ç›¸å…³çš„æ¨¡å—ã€‚

3. Select a module that suits your needs and load it using the `use` command.

   é€‰æ‹©é€‚åˆæ‚¨éœ€æ±‚çš„æ¨¡å—ï¼Œå¹¶ä½¿ç”¨ `use` å‘½ä»¤åŠ è½½å®ƒã€‚

4. Set the required options for the module using the `set` command.

   ä½¿ç”¨ `set` å‘½ä»¤è®¾ç½®æ¨¡å—çš„å¿…éœ€é€‰é¡¹ã€‚

5. Run the module using the `run` command.

   ä½¿ç”¨ `run` å‘½ä»¤è¿è¡Œæ¨¡å—ã€‚

6. Review the results and gather the necessary information.

   æŸ¥çœ‹ç»“æœå¹¶æ”¶é›†å¿…è¦çš„ä¿¡æ¯ã€‚

Metasploit provides a wide range of NTP enumeration modules, allowing you to choose the most suitable one for your specific needs.

Metasploit æä¾›äº†å¹¿æ³›çš„ NTP æšä¸¾æ¨¡å—ï¼Œä½¿æ‚¨å¯ä»¥æ ¹æ®ç‰¹å®šéœ€æ±‚é€‰æ‹©æœ€åˆé€‚çš„æ¨¡å—ã€‚
```bash
ntpq -c readlist <IP_ADDRESS>
ntpq -c readvar <IP_ADDRESS>
ntpq -c peers <IP_ADDRESS>
ntpq -c associations <IP_ADDRESS>
ntpdc -c monlist <IP_ADDRESS>
ntpdc -c listpeers <IP_ADDRESS>
ntpdc -c sysinfo <IP_ADDRESS>
```

```bash
nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 <IP>
```
## æ£€æŸ¥é…ç½®æ–‡ä»¶

* ntp.conf

## NTPæ”¾å¤§æ”»å‡»

[**NTP DDoSæ”»å‡»çš„å·¥ä½œåŸç†**](https://resources.infosecinstitute.com/network-time-protocol-ntp-threats-countermeasures/#gref)

NTPåè®®çš„è®¾è®¡ä½¿ç”¨UDPè¿›è¡Œæ“ä½œï¼Œä¸éœ€è¦åƒTCPé‚£æ ·è¿›è¡Œæ¡æ‰‹ï¼Œå› æ­¤æ²¡æœ‰è¯·æ±‚çš„è®°å½•ã€‚å› æ­¤ï¼ŒNTP DDoSæ”¾å¤§æ”»å‡»å¼€å§‹äºæ”»å‡»è€…ä¼ªé€ å¸¦æœ‰æ¬ºéª—æ€§æºIPçš„æ•°æ®åŒ…ï¼Œä½¿æ•°æ®åŒ…çœ‹èµ·æ¥æ¥è‡ªç›®æ ‡æœåŠ¡å™¨ï¼Œå¹¶å°†å…¶å‘é€åˆ°NTPæœåŠ¡å™¨ã€‚æ”»å‡»è€…æœ€åˆæ„é€ äº†å‡ ä¸ªå­—èŠ‚çš„æ•°æ®åŒ…ï¼Œä½†NTPä¼šä»¥å¤§é‡æ•°æ®è¿›è¡Œå“åº”ï¼Œä»è€Œæ”¾å¤§äº†è¿™æ¬¡æ”»å‡»ã€‚

_MONLISTå‘½ä»¤_ï¼šè¿™æ˜¯ä¸€ä¸ªNTPåè®®å‘½ä»¤ï¼Œå‡ ä¹æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ï¼Œä½†æ­£æ˜¯è¿™ä¸ªå‘½ä»¤æ˜¯è¿™æ¬¡æ”»å‡»çš„ä¸»è¦ç½ªé­ç¥¸é¦–ã€‚ç„¶è€Œï¼ŒMONLISTå‘½ä»¤çš„ç”¨é€”æ˜¯æä¾›è¿æ¥åˆ°NTPæ—¶é—´æœåŠ¡çš„æœ€è¿‘600ä¸ªå®¢æˆ·ç«¯çš„è¯¦ç»†ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯å‘½ä»¤çš„è¯­æ³•ï¼š
```bash
ntpdc -n -c monlist <IP>
```
## Shodan

* `ntp`

## HackTricks è‡ªåŠ¨å‘½ä»¤
```
Protocol_Name: NTP    #Protocol Abbreviation if there is one.
Port_Number:  123     #Comma separated if there is more than one.
Protocol_Description: Network Time Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for NTP
Note: |
The Network Time Protocol (NTP) is a networking protocol for clock synchronization between computer systems over packet-switched, variable-latency data networks.

https://book.hacktricks.xyz/pentesting/pentesting-ntp

Entry_2:
Name: Nmap
Description: Enumerate NTP
Command: nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 {IP}
```
<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProofæ˜¯æ‰€æœ‰åŠ å¯†æ¼æ´èµé‡‘çš„å®¶å›­ã€‚**

**å³æ—¶è·å¾—å¥–åŠ±**\
HackenProofçš„èµé‡‘åªæœ‰åœ¨å®¢æˆ·å­˜å…¥å¥–åŠ±é¢„ç®—åæ‰ä¼šå¯åŠ¨ã€‚åœ¨æ¼æ´éªŒè¯åï¼Œæ‚¨å°†è·å¾—å¥–åŠ±ã€‚

**åœ¨web3æ¸—é€æµ‹è¯•ä¸­ç§¯ç´¯ç»éªŒ**\
åŒºå—é“¾åè®®å’Œæ™ºèƒ½åˆçº¦æ˜¯æ–°çš„äº’è”ç½‘ï¼åœ¨å…¶å…´èµ·çš„æ—¶ä»£æŒæ¡web3å®‰å…¨ã€‚

**æˆä¸ºweb3é»‘å®¢ä¼ å¥‡**\
æ¯æ¬¡éªŒè¯çš„æ¼æ´éƒ½ä¼šè·å¾—å£°æœ›ç§¯åˆ†ï¼Œå¹¶ç™»ä¸Šæ¯å‘¨æ’è¡Œæ¦œçš„æ¦œé¦–ã€‚

[**åœ¨HackenProofä¸Šæ³¨å†Œ**](https://hackenproof.com/register)å¹¶ä»æ‚¨çš„é»‘å®¢æ”»å‡»ä¸­è·åˆ©ï¼

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
