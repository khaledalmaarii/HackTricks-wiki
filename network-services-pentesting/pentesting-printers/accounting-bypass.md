<details>

<summary><strong>é›¶åŸºç¡€å­¦ä¹ AWSé»‘å®¢æ”»å‡»åˆ°é«˜çº§æŠ€å·§</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


# **ä»‹ç»**

**æœªç»è®¸å¯çš„æ‰“å°**æœ¬èº«å¯èƒ½æ˜¯ä¸€ä¸ªå®‰å…¨é£é™©æˆ–è¿åå…¬å¸æ”¿ç­–ã€‚åœ¨æ‰“å°ä½œä¸šéœ€è¦æ”¶è´¹çš„ç¯å¢ƒä¸­ï¼Œå†…éƒ¨æ”»å‡»è€…æœ‰åŠ¨æœºç»•è¿‡è®¡è´¹ç³»ç»Ÿã€‚æ­¤å¤–ï¼Œèƒ½å¤Ÿâ€˜æ‰“å°â€™æ˜¯é’ˆå¯¹ç½‘ç»œæ‰“å°æœºçš„å¤§å¤šæ•°æ”»å‡»çš„å…ˆå†³æ¡ä»¶ã€‚

åœ¨æ‰“å°ä½œä¸šè®¡è´¹æ–¹é¢æœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼šè¦ä¹ˆ**ç›´æ¥è®©æ‰“å°æœºå¤„ç†ï¼Œè¦ä¹ˆä½¿ç”¨æ‰“å°æœåŠ¡å™¨ä½œä¸ºä¸­ä»‹**ã€‚ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ç‰¹å®šäºä¾›åº”å•†çš„ï¼Œé€šå¸¸æ¶‰åŠæŸç§ç‰¹æ®Šçš„â€˜æ‰“å°æœºé©±åŠ¨ç¨‹åºâ€™ï¼Œåœ¨æ­¤ä¸å†è®¨è®ºã€‚å¦ä¸€ç§æ–¹æ³•æ¶‰åŠä½¿ç”¨å•ç‹¬çš„æ‰“å°æœåŠ¡å™¨ - é€šå¸¸æ˜¯åƒ[CUPS](https://en.wikipedia.org/wiki/CUPS)æˆ–[LPRng](https://en.wikipedia.org/wiki/LPRng)è¿™æ ·çš„è½¯ä»¶å®ç° - æ¥å¤„ç†è®¡è´¹ï¼Œè¿™åœ¨å…¬å¸å’Œæœºæ„ä¸­éå¸¸å¸¸è§ã€‚æ‰“å°æœåŠ¡å™¨å¯èƒ½ä½¿ç”¨LPDã€IPPæˆ–å…¶ä»–æ‰“å°åè®®ï¼Œå¹¶å°†ä½œä¸šè½¬å‘ç»™å®é™…çš„æ‰“å°æœºã€‚**é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œå¿…é¡»é™åˆ¶å¯¹æ‰“å°æœºçš„ç›´æ¥ç½‘ç»œè®¿é—®**ï¼Œå¦åˆ™æ”»å‡»è€…å¯ä»¥**è½»æ¾ç»•è¿‡æ‰“å°æœåŠ¡å™¨**åŠå…¶è®¡è´¹æœºåˆ¶ã€‚è¿™æ„å‘³ç€è¦è¿‡æ»¤å¯¹å…¸å‹å’Œéå…¸å‹ç«¯å£ï¼ˆLPDã€IPPã€rawã€HTTPã€SMBã€FTPã€SNMPï¼‰çš„è®¿é—®ã€‚

åŸºæœ¬ä¸Šæœ‰ä¸¤ç§æ–¹æ³•æ¥è§„é¿æ‰“å°ä½œä¸šè®¡è´¹ç³»ç»Ÿï¼šè¦ä¹ˆ**å†’å……å¦ä¸€ä¸ªç”¨æˆ·ï¼Œè¦ä¹ˆæ“çºµæ‰“å°é¡µæ•°çš„è®¡æ•°å™¨**ã€‚ä»¥ä¸‹é’ˆå¯¹LPRngï¼ˆv3.8.Bï¼‰å’ŒCUPSï¼ˆv2.1.4ï¼‰å®‰è£…è¿›è¡Œäº†è®¨è®ºï¼Œè¿™äº›æ˜¯åœ¨å­¦æœ¯å’Œä¼ä¸šç¯å¢ƒä¸­ä½¿ç”¨çš„æµè¡Œå¼€æºæ‰“å°ç³»ç»Ÿã€‚ä¸‹é¢ç»™å‡ºäº†ä¸¤ç§ç³»ç»Ÿçš„å®‰å…¨åŠŸèƒ½æ¯”è¾ƒã€‚

| æ‰“å°ç³»ç»Ÿ | åè®® | åŠ å¯† | è®¤è¯ | é¡µæ•°è®¡æ•°å™¨ |
| --------------- | -------- | ---------- | -------------- | ------------ |
| **LPRng**       | LPD      | SSL/TLS    | Kerberos, PGP  | ç¡¬ä»¶     |
| **CUPS**        | IPP      | SSL/TLS    | Kerberos, HTTP | è½¯ä»¶     |

# è®¤è¯ç»•è¿‡

LPRngå’ŒCUPSéƒ½æä¾›åŸºäºSSLçš„é€šé“åŠ å¯†å’Œåƒ[Kerberos](https://en.wikipedia.org/wiki/Kerberos\_\(protocol\))ã€[PGP](https://en.wikipedia.org/wiki/Pretty\_Good\_Privacy)ç­¾åæ‰“å°ä½œä¸šæˆ–HTTP [åŸºæœ¬](https://en.wikipedia.org/wiki/Basic\_access\_authentication)/[æ‘˜è¦](https://en.wikipedia.org/wiki/Digest\_access\_authentication)è®¤è¯çš„å®‰å…¨è®¤è¯æ–¹æ¡ˆã€‚å¦‚æœ**é…ç½®å¾—å½“**ï¼Œå¹¶ä¸”æ”»å‡»è€…æ— æ³•ç›´æ¥è®¿é—®æ‰“å°æœºï¼Œå¥¹å°†**æ— æ³•å†’å……å…¶ä»–ç”¨æˆ·**ã€‚ç„¶è€Œï¼Œè¿™äº›å®‰å…¨åŠŸèƒ½æ˜¯**å¯é€‰çš„ï¼Œè€Œä¸”åœ¨ç°å®ä¸–ç•Œçš„æ‰“å°æœåŠ¡å™¨ä¸­å¾ˆå°‘åº”ç”¨**ã€‚ç›¸åï¼Œä½œä¸ºLPDï¼ˆLPRngï¼‰æˆ–IPPï¼ˆCUPSï¼‰å‚æ•°ç»™å‡ºçš„**ç”¨æˆ·åè¢«è®°å½•å’Œè®¡è´¹** - è¿™å¯ä»¥ç”±å®¢æˆ·ç«¯è®¾ç½®ä¸ºä»»æ„å€¼ã€‚è¿™æ ·åšçš„åŸå› æ˜¯å¤§å¤šæ•°æœºæ„çš„ç®€å•æˆæœ¬æ•ˆç›Šè€ƒè™‘ï¼š**Kerberoséœ€è¦åœ¨æ¯ä¸ªå®¢æˆ·ç«¯ä¸Šè¿›è¡Œç‰¹æ®Šè®¾ç½®**ï¼Œè€Œ**HTTP**è®¤è¯**è¦æ±‚**ç”¨æˆ·åœ¨æƒ³è¦æ‰“å°æŸäº›ä¸œè¥¿æ—¶è¾“å…¥**å¯†ç **ï¼Œè€Œå°‘é‡æœªè®¡è´¹çš„æ‰“å°è¾“å‡ºçš„æˆæœ¬æ˜¯å¯ä»¥æ‰¿å—çš„ã€‚

æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨**è‡ªå®šä¹‰ç”¨æˆ·å**æ‰“å°æ¥**éªŒè¯é€‚å½“çš„è®¤è¯**ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```
lp -U nobody test.ps
```
# é¡µé¢è®¡æ•°å™¨æ“çºµ

## ç¡¬ä»¶é¡µé¢è®¡æ•°å™¨

ä¸ºäº†æ­£ç¡®çš„è®¡è´¹ï¼Œ**å¿…é¡»ç”±æ‰“å°ç³»ç»Ÿç¡®å®šæ‰“å°çš„é¡µé¢æ•°é‡**ï¼Œè¿™ä¸æ˜¯ä¸€é¡¹ç®€å•çš„ä»»åŠ¡ã€‚**LPRng** çš„ä½œè€…ä»¬_å‡è®¾æ‰“å°æœºå…·æœ‰æŸç§éæ˜“å¤±æ€§é¡µé¢è®¡æ•°å™¨æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å¯é ä¸”ä¸å—å¼€/å…³ç”µæºå‘¨æœŸçš„å½±å“_ã€‚è¿™ç§**ç¡¬ä»¶é¡µé¢è®¡æ•°å™¨**å¾—åˆ°äº†å¤§å¤šæ•°æ‰“å°æœºçš„æ”¯æŒï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡**æ‰“å°**ä½œä¸šåï¼Œé€šè¿‡LPRng **ä½¿ç”¨PJLè¯»å–**ã€‚**HP**ç”šè‡³è®°å½•äº†ä¸€é¡¹é€šè¿‡å°†æ‰“å°æœºç½®äºæœåŠ¡æ¨¡å¼æ¥**å†™å…¥**åˆ°**é¡µé¢è®¡æ•°å™¨**å˜é‡çš„åŠŸèƒ½ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ_HP LaserJet 1200ã€HP LaserJet 4200N_ å’Œ _HP LaserJet 4250N_ çš„**é¡µé¢è®¡æ•°å™¨**å¯ä»¥åœ¨æ‰“å°ä½œä¸šä¸­è¢«æ“çºµã€‚åœ¨è¦æ‰“å°çš„æ–‡æ¡£çš„æœ«å°¾ï¼Œå¹¶é€šè¿‡[UEL](./#uel)åˆ†éš”ï¼Œåªéœ€å°†è®¡æ•°å™¨é‡ç½®ä¸ºå…¶åŸå§‹å€¼ï¼ˆä¾‹å¦‚ï¼Œ`2342`ï¼‰ï¼š
```
\x1b%-12345X@PJL JOB
This page was printed for free
\x1b%-12345X@PJL EOJ
\x1b%-12345X@PJL JOB
@PJL SET SERVICEMODE=HPBOISEID
@PJL SET PAGES=2342
\x1b%-12345X@PJL EOJ
```
æ”»å‡»è€…å¯èƒ½ä¼šè®¾ç½®æ‰“å°é¡µæ•°ä¸ºè´Ÿæ•°ã€‚è¯·æ³¨æ„ï¼Œå°†è®¾å¤‡é‡ç½®ä¸º[å‡ºå‚é»˜è®¤è®¾ç½®](factory-defaults.md)ä¹Ÿä¼š**åœ¨æŸäº›æµ‹è¯•è®¾å¤‡ä¸Šå°†é¡µé¢è®¡æ•°å™¨é‡ç½®ä¸ºé›¶**ã€‚\
é™ä½é¡µé¢è®¡æ•°å™¨ä¹Ÿå¯ä»¥ç”¨æ¥**ä»¥é«˜äºå…¶ä»·å€¼çš„ä»·æ ¼å‡ºå”®æ‰“å°æœº**ï¼Œè¿™å¯ä»¥ä¸è´­ä¹°äºŒæ‰‹è½¦æ—¶çš„é‡Œç¨‹è¡¨ç›¸æ¯”è¾ƒã€‚ç„¶è€Œï¼Œå€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œ**é‡ç½®é¡µé¢è®¡æ•°å™¨å¹¶ä¸ä¸€å®šæ˜¯å‡ºäºæ¶æ„ç›®çš„**ï¼šå‡ºå”®ä»·æ ¼è¿‡é«˜çš„å¢¨æ°´ç»™ä½æˆæœ¬çš„å–·å¢¨æ‰“å°è®¾å¤‡ï¼Œå¹¶é€šè¿‡æ‹’ç»åœ¨æ‰“å°ä¸€å®šæ•°é‡çš„é¡µé¢åä½¿ç”¨ç¬¬ä¸‰æ–¹è¡¥å……å¥—ä»¶æ¥å°é”ï¼Œæ˜¯ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„å•†ä¸šæ¨¡å¼â€”â€”ä¸ºäº†å¤„ç†è¿™ç§ä¸é“å¾·çš„åšæ³•ï¼Œé‡ç½®é¡µé¢è®¡æ•°å™¨æ˜¯å®Œå…¨åˆç†çš„ã€‚

åœ¨è¾ƒæ—§çš„HPæ¿€å…‰æ‰“å°æœºä¸Šï¼Œå¯ä»¥ä½¿ç”¨[PRET](https://github.com/RUB-NDS/PRET)çš„`pagecount`å‘½ä»¤æ¥è½»æ¾è®¾ç½®ç¡¬ä»¶é¡µé¢è®¡æ•°å™¨ï¼š
```
./pret.py -q printer pjl
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> pagecount 10
Old pagecounter: 53214
New pagecounter: 10
```
## è½¯ä»¶é¡µé¢è®¡æ•°å™¨

**CUPS** ä½¿ç”¨äº†ä¸ºæ‰€æœ‰ä¸»è¦é¡µé¢æè¿°è¯­è¨€å®ç°çš„**è½¯ä»¶é¡µé¢è®¡æ•°å™¨**ã€‚å¯¹äºPostScriptï¼Œç»•è¿‡è®¡æ•°çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯åœ¨å®é™…æ‰“å°æ–‡æ¡£ä¹‹å‰æ£€æŸ¥PageCountç³»ç»Ÿå‚æ•°æ˜¯å¦å­˜åœ¨â€”â€”åœ¨CUPS/Ghostscriptä¸­è§£é‡Šæ—¶ä¼šè¿”å›falseï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚
```
currentsystemparams (PageCount) known {
<@\textit{[...] code which is only executed on a printer device [...]}@>
} if
```
è¿™ç§æ–¹å¼ä¸‹ï¼ŒCUPS ä½¿ç”¨çš„è®¡è´¹è½¯ä»¶æ¸²æŸ“çš„æ–‡æ¡£ä¸æ‰“å°æœºçš„ä¸åŒã€‚**CUPS åªè®¡ç®—ä¸€é¡µ** â€”â€” è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ª**ç¡¬ç¼–ç çš„æœ€å°å€¼** â€”â€” è€Œ**å®é™…**çš„æ‰“å°ä½œä¸šå¯èƒ½åŒ…å«**æ•°ç™¾** **é¡µ**ã€‚è¯·æ³¨æ„ï¼Œä½¿ç”¨ IPP çš„â€˜rawâ€™é˜Ÿåˆ—/é€‰é¡¹æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™ CUPS ä¼šåœ¨ä½œä¸šåˆ°è¾¾é¡µé¢è®¡æ•°å™¨ä¹‹å‰ï¼Œä½¿ç”¨ PostScript åˆ° PostScript è¿‡æ»¤å™¨ï¼ˆGhostscript çš„ ps2writeï¼‰è§£æä»£ç ã€‚

**å¦‚ä½•æµ‹è¯•è¿™ç§æ”»å‡»ï¼Ÿ**

**å°†**ä»»æ„**å¤šé¡µ PostScript æ–‡æ¡£**åŒ…è£¹åœ¨**ä¸Šè¿°ä»£ç **ä¸­å¹¶æ‰“å°ã€‚ç„¶åè®¿é—® [`http://printserver:631/jobs?which_jobs=all`](http://printserver:631/jobs?which\_jobs=all) å¹¶æ£€æŸ¥ CUPS çš„é¡µé¢è®¡æ•°å™¨å¯¹äºè¿™ä¸ªæ‰“å°ä½œä¸šçš„è®°å½•ã€‚è¯·æ³¨æ„ï¼Œä½ å¿…é¡»å»ºç«‹ä¸€ä¸ª raw é˜Ÿåˆ—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªä¸æ¶‰åŠè¿‡æ»¤ç³»ç»Ÿçš„é˜Ÿåˆ—ï¼Œæ‰“å°ä½œä¸šç›´æ¥å‘é€åˆ°æ‰“å°æœºã€‚å¯¹äº CUPSï¼Œè¿™æ˜¯é€šè¿‡å°†å†…å®¹ç±»å‹è®¾ç½®ä¸º `application/vnd.cups-raw` æ¥å®Œæˆçš„ã€‚å¦‚æœä½ çš„ç³»ç»Ÿå·²ç»é…ç½®ä¸ºä½¿ç”¨è¦æµ‹è¯•çš„æ‰“å°æœåŠ¡å™¨ï¼Œåªéœ€ä½¿ç”¨ï¼š
```
lp -o raw test.ps
```
<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä»¥PDFæ ¼å¼ä¸‹è½½HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
