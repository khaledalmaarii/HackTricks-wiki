<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


# **ä»‹ç»**

**æœªç»è®¸å¯æ‰“å°**æœ¬èº«å¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é£é™©æˆ–è¿åå…¬å¸æ”¿ç­–ã€‚åœ¨éœ€è¦ä¸ºæ‰“å°ä½œä¸šä»˜è´¹çš„ç¯å¢ƒä¸­ï¼Œå†…éƒ¨æ”»å‡»è€…æœ‰åŠ¨æœºç»•è¿‡è®¡è´¹ç³»ç»Ÿã€‚æ­¤å¤–ï¼Œèƒ½å¤Ÿâ€œæ‰“å°â€æ˜¯é’ˆå¯¹ç½‘ç»œæ‰“å°æœºçš„å¤§å¤šæ•°æ”»å‡»çš„å…ˆå†³æ¡ä»¶ã€‚

åœ¨æ‰“å°ä½œä¸šè®¡è´¹æ–¹é¢æœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼š**è¦ä¹ˆè®©æ‰“å°æœºç›´æ¥å¤„ç†ï¼Œè¦ä¹ˆä½¿ç”¨æ‰“å°æœåŠ¡å™¨**ã€‚ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ç‰¹å®šäºä¾›åº”å•†çš„ï¼Œé€šå¸¸æ¶‰åŠæŸç§ç‰¹æ®Šçš„â€œæ‰“å°æœºé©±åŠ¨ç¨‹åºâ€ï¼Œè¿™é‡Œä¸å†è®¨è®ºã€‚å¦ä¸€ç§æ–¹æ³•æ¶‰åŠä¸€ä¸ªå•ç‹¬çš„æ‰“å°æœåŠ¡å™¨ - é€šå¸¸æ˜¯åƒ[CUPS](https://en.wikipedia.org/wiki/CUPS)æˆ–[LPRng](https://en.wikipedia.org/wiki/LPRng)è¿™æ ·çš„è½¯ä»¶å®ç° - æ¥å¤„ç†è®¡è´¹ï¼Œå¹¶ä¸”åœ¨å…¬å¸å’Œæœºæ„ä¸­éå¸¸å¸¸è§ã€‚æ‰“å°æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨LPDã€IPPæˆ–å…¶ä»–æ‰“å°åè®®è¿›è¡Œé€šä¿¡ï¼Œå¹¶å°†ä½œä¸šè½¬å‘ç»™å®é™…çš„æ‰“å°æœºã€‚**é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œå¿…é¡»é™åˆ¶å¯¹æ‰“å°æœºçš„ç›´æ¥ç½‘ç»œè®¿é—®**ï¼Œå¦åˆ™æ”»å‡»è€…å¯ä»¥è½»æ¾ç»•è¿‡æ‰“å°æœåŠ¡å™¨åŠå…¶è®¡è´¹æœºåˆ¶ã€‚è¿™æ„å‘³ç€è¿‡æ»¤å¯¹å…¸å‹å’Œéå…¸å‹ç«¯å£ï¼ˆLPDã€IPPã€åŸå§‹ã€HTTPã€SMBã€FTPã€SNMPï¼‰çš„è®¿é—®ã€‚

åŸºæœ¬ä¸Šæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ç»•è¿‡æ‰“å°ä½œä¸šè®¡è´¹ç³»ç»Ÿï¼šè¦ä¹ˆ**å†’å……å…¶ä»–ç”¨æˆ·ï¼Œè¦ä¹ˆæ“çºµæ‰“å°é¡µæ•°è®¡æ•°å™¨**ã€‚ä¸‹é¢å°†è®¨è®ºLPRngï¼ˆv3.8.Bï¼‰å’ŒCUPSï¼ˆv2.1.4ï¼‰å®‰è£…çš„è¿™ä¸¤ç§é€‰é¡¹ï¼Œå®ƒä»¬æ˜¯åœ¨å­¦æœ¯å’Œä¼ä¸šç¯å¢ƒä¸­ä½¿ç”¨çš„æµè¡Œå¼€æºæ‰“å°ç³»ç»Ÿã€‚ä¸‹é¢ç»™å‡ºäº†ä¸¤ä¸ªç³»ç»Ÿå®‰å…¨åŠŸèƒ½çš„æ¯”è¾ƒã€‚

| æ‰“å°ç³»ç»Ÿ | åè®® | åŠ å¯† | è®¤è¯ | é¡µæ•°è®¡æ•°å™¨ |
| --------------- | -------- | ---------- | -------------- | ------------ |
| **LPRng**       | LPD      | SSL/TLS    | Kerberos, PGP  | ç¡¬ä»¶     |
| **CUPS**        | IPP      | SSL/TLS    | Kerberos, HTTP | è½¯ä»¶     |

# è®¤è¯ç»•è¿‡

LPRngå’ŒCUPSéƒ½æä¾›åŸºäºSSLçš„é€šé“åŠ å¯†å’Œå®‰å…¨è®¤è¯æ–¹æ¡ˆï¼Œå¦‚[Kerberos](https://en.wikipedia.org/wiki/Kerberos\_\(protocol\))ã€[PGP](https://en.wikipedia.org/wiki/Pretty\_Good\_Privacy)ç­¾åçš„æ‰“å°ä½œä¸šæˆ–HTTP [åŸºæœ¬](https://en.wikipedia.org/wiki/Basic\_access\_authentication)/[æ‘˜è¦](https://en.wikipedia.org/wiki/Digest\_access\_authentication)è®¤è¯ã€‚å¦‚æœ**æ­£ç¡®é…ç½®**ï¼Œå¹¶ä¸”æ”»å‡»è€…æ— æ³•ç›´æ¥è®¿é—®æ‰“å°æœºï¼Œå¥¹å°†**æ— æ³•å†’å……å…¶ä»–ç”¨æˆ·**ã€‚ç„¶è€Œï¼Œè¿™äº›å®‰å…¨åŠŸèƒ½åœ¨å®é™…çš„æ‰“å°æœåŠ¡å™¨ä¸­å¾ˆå°‘åº”ç”¨ï¼Œå› ä¸ºå®ƒä»¬æ˜¯**å¯é€‰çš„**ã€‚ç›¸åï¼Œ**ä½œä¸ºLPDï¼ˆLPRngï¼‰æˆ–IPPï¼ˆCUPSï¼‰å‚æ•°ç»™å‡ºçš„ç”¨æˆ·åè¢«è®°å½•å’Œè®¡è´¹** - å®¢æˆ·ç«¯å¯ä»¥å°†å…¶è®¾ç½®ä¸ºä»»æ„å€¼ã€‚è¿™æ ·åšçš„åŸå› æ˜¯å¤§å¤šæ•°æœºæ„éƒ½è¿›è¡Œäº†ç®€å•çš„æˆæœ¬æ•ˆç›Šè€ƒè™‘ï¼šKerberoséœ€è¦åœ¨æ¯ä¸ªå®¢æˆ·ç«¯ä¸Šè¿›è¡Œç‰¹æ®Šè®¾ç½®ï¼Œè€ŒHTTPè®¤è¯è¦æ±‚ç”¨æˆ·åœ¨æ‰“å°æ—¶è¾“å…¥å¯†ç ï¼Œè€Œå°‘æ•°æœªè®¡è´¹çš„æ‰“å°è¾“å‡ºçš„æˆæœ¬æ˜¯å¯ä»¥æ‰¿å—çš„ã€‚

æ‚¨å¯ä»¥é€šè¿‡å°è¯•ä½¿ç”¨**è‡ªå®šä¹‰ç”¨æˆ·å**æ‰“å°æ¥**éªŒè¯æ­£ç¡®çš„è®¤è¯**ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```
lp -U nobody test.ps
```
# é¡µé¢è®¡æ•°å™¨æ“çºµ

## ç¡¬ä»¶é¡µé¢è®¡æ•°å™¨

ä¸ºäº†æ­£ç¡®è®¡ç®—æ‰“å°é¡µæ•°ï¼Œå¿…é¡»ç”±æ‰“å°ç³»ç»Ÿç¡®å®šï¼Œè¿™å¹¶ä¸æ˜¯ä¸€é¡¹ç®€å•çš„ä»»åŠ¡ã€‚**LPRng**çš„ä½œè€…ä»¬_å‡è®¾æ‰“å°æœºå…·æœ‰æŸç§å¯é ä¸”ä¸å—å¼€å…³æœºå¾ªç¯å½±å“çš„éæ˜“å¤±æ€§é¡µé¢è®¡æ•°å™¨æœºåˆ¶_ã€‚å¤§å¤šæ•°æ‰“å°æœºéƒ½æ”¯æŒè¿™ç§**ç¡¬ä»¶é¡µé¢è®¡æ•°å™¨**ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡æ‰“å°ä½œä¸šåï¼ŒLPRngä¼šä½¿ç”¨PJLæ¥**è¯»å–**å®ƒä»¬ã€‚**HP**ç”šè‡³è®°å½•äº†ä¸€ç§åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡å°†æ‰“å°æœºè®¾ç½®ä¸ºæœåŠ¡æ¨¡å¼æ¥**å†™å…¥**é¡µé¢è®¡æ•°å™¨å˜é‡ã€‚è¿™æ ·ï¼Œå¯ä»¥åœ¨æ‰“å°ä½œä¸šä¸­**æ“çºµ**_HP LaserJet 1200ï¼ŒHP LaserJet 4200N_å’Œ_HP LaserJet 4250N_çš„**é¡µé¢è®¡æ•°å™¨**ã€‚åœ¨è¦æ‰“å°çš„æ–‡æ¡£æœ«å°¾ï¼Œå¹¶åœ¨[UEL](./#uel)ä¹‹åï¼Œåªéœ€å°†è®¡æ•°å™¨é‡ç½®ä¸ºå…¶åŸå§‹å€¼ï¼ˆä¾‹å¦‚ï¼Œ`2342`ï¼‰ï¼š
```
\x1b%-12345X@PJL JOB
This page was printed for free
\x1b%-12345X@PJL EOJ
\x1b%-12345X@PJL JOB
@PJL SET SERVICEMODE=HPBOISEID
@PJL SET PAGES=2342
\x1b%-12345X@PJL EOJ
```
æ”»å‡»è€…å¯ä»¥è®¾ç½®è´Ÿæ•°çš„æ‰“å°é¡µæ•°ã€‚è¯·æ³¨æ„ï¼Œå°†è®¾å¤‡æ¢å¤ä¸º[å‡ºå‚é»˜è®¤è®¾ç½®](factory-defaults.md)ä¹Ÿä¼šåœ¨æŸäº›æµ‹è¯•è®¾å¤‡ä¸Šå°†é¡µé¢è®¡æ•°å™¨é‡ç½®ä¸ºé›¶ã€‚\
é™ä½é¡µé¢è®¡æ•°å™¨ä¹Ÿå¯ä»¥ç”¨äº**ä»¥é«˜äºå…¶ä»·æ ¼å‡ºå”®æ‰“å°æœº**ï¼Œå°±åƒè´­ä¹°äºŒæ‰‹è½¦æ—¶å¯ä»¥ä¸é‡Œç¨‹è¡¨è¿›è¡Œæ¯”è¾ƒä¸€æ ·ã€‚ç„¶è€Œï¼Œå€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œ**é‡ç½®é¡µé¢è®¡æ•°å™¨å¹¶ä¸ä¸€å®šæ˜¯å‡ºäºæ¶æ„ç›®çš„**ï¼šä»¥é«˜ä»·é”€å”®ä½æˆæœ¬å–·å¢¨æ‰“å°æœºçš„å¢¨æ°´æ˜¯ä¸€ç§ä¼—æ‰€å‘¨çŸ¥çš„å•†ä¸šæ¨¡å¼ï¼Œå¹¶é€šè¿‡åœ¨ä¸€å®šæ•°é‡çš„é¡µé¢åæ‹’ç»æ‰“å°æ¥é˜»æ­¢ç¬¬ä¸‰æ–¹åŠ å¢¨å¥—ä»¶ - ä¸ºäº†åº”å¯¹è¿™ç§ä¸é“å¾·çš„åšæ³•ï¼Œé‡ç½®é¡µé¢è®¡æ•°å™¨æ˜¯å®Œå…¨åˆç†çš„ã€‚

åœ¨æ—§ç‰ˆHPæ¿€å…‰æ‰“å°æœºä¸Šï¼Œå¯ä»¥ä½¿ç”¨[PRET](https://github.com/RUB-NDS/PRET)çš„`pagecount`å‘½ä»¤è½»æ¾è®¾ç½®ç¡¬ä»¶é¡µé¢è®¡æ•°å™¨ï¼š
```
./pret.py -q printer pjl
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> pagecount 10
Old pagecounter: 53214
New pagecounter: 10
```
## è½¯ä»¶é¡µé¢è®¡æ•°å™¨

**CUPS** ä½¿ç”¨äº†å·²ç»ä¸ºæ‰€æœ‰ä¸»è¦é¡µé¢æè¿°è¯­è¨€å®ç°çš„**è½¯ä»¶é¡µé¢è®¡æ•°å™¨**ã€‚å¯¹äºPostScriptï¼Œç»•è¿‡è®¡è´¹çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯åœ¨å®é™…æ‰“å°æ–‡æ¡£ä¹‹å‰ï¼Œæ£€æŸ¥PageCountç³»ç»Ÿå‚æ•°æ˜¯å¦å­˜åœ¨ - å½“åœ¨CUPS / Ghostscriptä¸­è§£é‡Šæ—¶ï¼Œå°†è¿”å›falseï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚
```
currentsystemparams (PageCount) known {
<@\textit{[...] code which is only executed on a printer device [...]}@>
} if
```
è¿™ç§æƒ…å†µä¸‹ï¼ŒCUPSä½¿ç”¨çš„ä¼šè®¡è½¯ä»¶å‘ˆç°çš„æ–‡æ¡£ä¸æ‰“å°æœºä¸åŒã€‚CUPSåªè®°å½•äº†ä¸€é¡µ - è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªç¡¬ç¼–ç çš„æœ€å°å€¼ - è€Œå®é™…çš„æ‰“å°ä½œä¸šå¯èƒ½åŒ…å«æ•°ç™¾é¡µã€‚è¯·æ³¨æ„ï¼Œä½¿ç”¨IPPçš„â€œrawâ€é˜Ÿåˆ—/é€‰é¡¹æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå¦åˆ™CUPSä¼šåœ¨åˆ°è¾¾é¡µé¢è®¡æ•°å™¨ä¹‹å‰ä½¿ç”¨PostScript-to-PostScriptè¿‡æ»¤å™¨ï¼ˆGhostscriptçš„ps2writeï¼‰è§£æä»£ç ã€‚

**å¦‚ä½•æµ‹è¯•æ­¤æ”»å‡»ï¼Ÿ**

å°†ä»»æ„çš„å¤šé¡µPostScriptæ–‡æ¡£åŒ…è£…åœ¨ä¸Šè¿°ä»£ç ä¸­å¹¶è¿›è¡Œæ‰“å°ã€‚ç„¶åè½¬åˆ°[`http://printserver:631/jobs?which_jobs=all`](http://printserver:631/jobs?which_jobs=all)å¹¶æ£€æŸ¥CUPSçš„é¡µé¢è®¡æ•°å™¨ä»¥è·å–æ­¤æ‰“å°ä½œä¸šçš„ä¿¡æ¯ã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¿…é¡»å»ºç«‹ä¸€ä¸ªåŸå§‹é˜Ÿåˆ—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªä¸æ¶‰åŠè¿‡æ»¤ç³»ç»Ÿçš„é˜Ÿåˆ—ï¼Œæ‰“å°ä½œä¸šç›´æ¥å‘é€åˆ°æ‰“å°æœºã€‚å¯¹äºCUPSï¼Œå¯ä»¥é€šè¿‡å°†å†…å®¹ç±»å‹è®¾ç½®ä¸º`application/vnd.cups-raw`æ¥å®ç°ã€‚å¦‚æœæ‚¨çš„ç³»ç»Ÿå·²ç»é…ç½®ä¸ºä½¿ç”¨è¦æµ‹è¯•çš„æ‰“å°æœåŠ¡å™¨ï¼Œåªéœ€ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```
lp -o raw test.ps
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
