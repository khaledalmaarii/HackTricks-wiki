# 3389 - Pentesting RDP

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Trenutno dostupna postavka za procenu ranjivosti i testiranje penetracije**. Pokrenite puni pentest sa bilo kog mesta sa preko 20 alata i funkcija koje idu od rekonstrukcije do izveÅ¡tavanja. Mi ne zamenjujemo pentestere - mi razvijamo prilagoÄ‘ene alate, module za detekciju i eksploataciju kako bismo im vratili neko vreme da dublje kopaju, otvaraju ljuske i zabavljaju se.

{% embed url="https://pentest-tools.com/" %}

## Osnovne informacije

Razvijen od strane Microsoft-a, **Remote Desktop Protocol** (**RDP**) je dizajniran da omoguÄ‡i grafiÄko povezivanje izmeÄ‘u raÄunara preko mreÅ¾e. Da bi se uspostavila takva veza, korisnik koristi **RDP** klijentski softver, a istovremeno, udaljeni raÄunar mora da koristi **RDP** serverski softver. Ova postavka omoguÄ‡ava besprekidnu kontrolu i pristup desktop okruÅ¾enju udaljenog raÄunara, suÅ¡tinski donoseÄ‡i njegov interfejs na lokalni ureÄ‘aj korisnika.

**Podrazumevani port:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## Enumeracija

### Automatska

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

Proverava dostupno Å¡ifrovanje i ranjivost DoS-a (bez izazivanja DoS-a na usluzi) i dobija NTLM Windows informacije (verzije).

### [Brute force](../generic-methodologies-and-resources/brute-force.md#rdp)

**Budite oprezni, moÅ¾ete zakljuÄati naloge**

### **Password Spraying**

**Budite oprezni, moÅ¾ete zakljuÄati naloge**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### Povezivanje sa poznatim pristupnim podacima/hashom

Kada pokuÅ¡avate da se poveÅ¾ete sa RDP (Remote Desktop Protocol) serverom, moÅ¾ete koristiti poznate pristupne podatke ili hash vrednosti za autentifikaciju. Ovo moÅ¾e biti korisno ako imate pristupnim podacima ili hash vrednostima koje su ranije procurele ili su vam dostupne iz drugih izvora.

Da biste se povezali sa RDP serverom koristeÄ‡i poznate pristupne podatke, moÅ¾ete koristiti RDP klijent aplikaciju i uneti korisniÄko ime i lozinku. Ako su pristupni podaci ispravni, biÄ‡ete uspeÅ¡no povezani sa serverom.

Alternativno, moÅ¾ete koristiti hash vrednosti pristupnih podataka umesto samih podataka. Ovo je korisno kada imate hash vrednosti pristupnih podataka koje su ranije procurele ili su vam dostupne iz drugih izvora. Da biste se povezali sa RDP serverom koristeÄ‡i hash vrednosti, moÅ¾ete koristiti alate kao Å¡to su `rdp-sec-check` ili `rdp-sec-check2` koji podrÅ¾avaju autentifikaciju putem hash vrednosti.

VaÅ¾no je napomenuti da je koriÅ¡Ä‡enje poznatih pristupnih podataka ili hash vrednosti za povezivanje sa RDP serverom ilegalno, osim ako imate izriÄitu dozvolu vlasnika sistema. Ove tehnike se koriste samo u okviru legalnih aktivnosti testiranja penetracije.
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### Provera poznatih pristupnih podataka za RDP servise

rdp\_check.py iz impacket-a vam omoguÄ‡ava da proverite da li su neki pristupni podaci validni za RDP servis:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Odmah dostupno podeÅ¡avanje za procenu ranjivosti i testiranje prodiranja**. Pokrenite potpuni test prodiranja sa bilo kog mesta sa viÅ¡e od 20 alata i funkcija koje idu od prikupljanja informacija do izveÅ¡tavanja. Mi ne zamenjujemo testere prodiranja - mi razvijamo prilagoÄ‘ene alate, module za otkrivanje i eksploataciju kako bismo im vratili neko vreme da dublje istraÅ¾uju, otvaraju ljuske i zabavljaju se.

{% embed url="https://pentest-tools.com/" %}

## **Napadi**

### KraÄ‘a sesije

Sa **SYSTEM dozvolama** moÅ¾ete pristupiti bilo kojoj **otvorenoj RDP sesiji od strane bilo kog korisnika** bez potrebe da znate lozinku vlasnika.

**Dobijanje otvorenih sesija:**
```
query user
```
**Pristup odabranoj sesiji**

Da biste dobili pristup odabranoj sesiji, moÅ¾ete koristiti nekoliko razliÄitih metoda. Evo nekoliko tehnika koje moÅ¾ete primijeniti:

1. **Brute force napad**: Ova tehnika ukljuÄuje pokuÅ¡aj pronalaÅ¾enja ispravnih korisniÄkih imena i lozinki metodom pokuÅ¡aja i pogreÅ¡ke. MoÅ¾ete koristiti alate poput Hydra ili Medusa za automatizaciju ovog procesa.

2. **Sniffing**: Sniffing je proces presretanja i analiziranja mreÅ¾nog prometa kako biste pronaÅ¡li korisniÄka imena i lozinke. MoÅ¾ete koristiti alate poput Wiresharka za ovu svrhu.

3. **KraÄ‘a sesije**: Ova tehnika ukljuÄuje kraÄ‘u aktivne sesije od drugog korisnika. MoÅ¾ete koristiti alate poput SessionGopher ili RDPY za izvoÄ‘enje ovog napada.

4. **Exploiting vulnerabilities**: Ako postoje poznate ranjivosti u RDP protokolu ili aplikaciji koju koristite, moÅ¾ete ih iskoristiti kako biste dobili pristup sesiji. Ovdje je vaÅ¾no redovito pratiti sigurnosne zakrpe i aÅ¾uriranja.

5. **Social engineering**: Ova tehnika ukljuÄuje manipulaciju ljudima kako biste dobili pristup njihovim korisniÄkim imenima i lozinkama. MoÅ¾ete koristiti razne tehnike poput phishinga ili prevarnih telefonskih poziva.

VaÅ¾no je napomenuti da je neovlaÅ¡ten pristup tuÄ‘oj sesiji ilegalan i moÅ¾e imati ozbiljne pravne posljedice. Ove tehnike treba primjenjivati samo u okviru zakona i etiÄkih smjernica.
```bash
tscon <ID> /dest:<SESSIONNAME>
```
Sada Ä‡ete biti unutar odabrane RDP sesije i moraÄ‡ete se predstaviti kao korisnik koristeÄ‡i samo Windows alate i funkcije.

**VaÅ¾no**: Kada pristupite aktivnoj RDP sesiji, izbaciÄ‡ete korisnika koji je koristio tu sesiju.

MoÅ¾ete dobiti lozinke iz procesa tako Å¡to Ä‡ete ih izvuÄ‡i, ali ovaj metod je mnogo brÅ¾i i omoguÄ‡ava vam interakciju sa virtuelnim desktopom korisnika (lozinke u Notepadu bez Äuvanja na disku, druge RDP sesije otvorene na drugim maÅ¡inama...)

#### **Mimikatz**

TakoÄ‘e moÅ¾ete koristiti Mimikatz za ovo:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Lepkavi tasteri i Utilman

Kombinovanjem ove tehnike sa **lepkavim tasterima** ili **utilmanom, moÄ‡i Ä‡ete da pristupite administrativnom CMD-u i bilo kojoj RDP sesiji u bilo koje vreme**

MoÅ¾ete pretraÅ¾iti RDP-ove koji su veÄ‡ zaraÅ¾eni jednom od ovih tehnika sa: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### Injekcija procesa RDP-a

Ako se neko iz druge domene ili sa **boljim privilegijama prijavi putem RDP-a** na raÄunar gde **vi imate administratorske privilegije**, moÅ¾ete **ubaciti** svoj beacon u njegov **proces RDP sesije** i delovati kao on:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Dodavanje korisnika u RDP grupu
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Automatski alati

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

**AutoRDPwn** je post-eksploatacijski okvir kreiran u Powershell-u, dizajniran prvenstveno za automatizaciju **Shadow** napada na raÄunare sa Microsoft Windows operativnim sistemom. Ova ranjivost (koju je Microsoft navela kao funkcionalnost) omoguÄ‡ava udaljenom napadaÄu da **pregleda desktop Å¾rtve bez njenog pristanka**, Äak i da ga kontroliÅ¡e po potrebi, koristeÄ‡i alate koji su inherentni samom operativnom sistemu.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* Kontrola miÅ¡a i tastature na automatizovan naÄin putem komandne linije
* Kontrola clipboard-a na automatizovan naÄin putem komandne linije
* Pokretanje SOCKS proxy-ja sa klijenta koji usmerava mreÅ¾nu komunikaciju ka cilju putem RDP-a
* IzvrÅ¡avanje proizvoljnih SHELL i PowerShell komandi na cilju bez otpremanja fajlova
* Preuzimanje i otpremanje fajlova sa/na cilj Äak i kada su transferi fajlova onemoguÄ‡eni na cilju

## HackTricks Automatske Komande
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Odmah dostupno podeÅ¡avanje za procenu ranjivosti i testiranje prodiranja**. Pokrenite potpuni test prodiranja sa bilo kog mesta sa preko 20 alata i funkcija koje idu od istraÅ¾ivanja do izveÅ¡tavanja. Mi ne zamenjujemo testere prodiranja - mi razvijamo prilagoÄ‘ene alate, module za otkrivanje i iskoriÅ¡Ä‡avanje kako bismo im vratili neko vreme da dublje istraÅ¾uju, otvaraju ljuske i zabavljaju se.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju oglaÅ¡enu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Pogledajte [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
