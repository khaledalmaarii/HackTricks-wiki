# 3389 - Pentesting RDP

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**ì·¨ì•½ì  í‰ê°€ ë° ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ì„¤ì •**. 20ê°œ ì´ìƒì˜ ë„êµ¬ ë° ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë””ì„œë‚˜ ì „ì²´ ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” íƒìƒ‰ì—ì„œ ë³´ê³ ì— ì´ë¥´ê¸°ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì¹¨íˆ¬ í…ŒìŠ¤í„°ë¥¼ ëŒ€ì²´í•˜ì§€ ì•Šìœ¼ë©°, ê·¸ë“¤ì´ ë” ê¹Šì´ íŒŒê³ ë“¤ê³ , ì‰˜ì„ í„°ëœ¨ë¦¬ê³ , ì¬ë¯¸ë¥¼ ëŠë‚„ ìˆ˜ ìˆë„ë¡ ë§ì¶¤í˜• ë„êµ¬, íƒì§€ ë° ì•…ìš© ëª¨ë“ˆì„ ê°œë°œí•©ë‹ˆë‹¤.

{% embed url="https://pentest-tools.com/" %}

## ê¸°ë³¸ ì •ë³´

Microsoftì—ì„œ ê°œë°œí•œ **ì›ê²© ë°ìŠ¤í¬í†± í”„ë¡œí† ì½œ** (**RDP**)ì€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì»´í“¨í„° ê°„ì˜ ê·¸ë˜í”½ ì¸í„°í˜ì´ìŠ¤ ì—°ê²°ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì—°ê²°ì„ ì„¤ì •í•˜ê¸° ìœ„í•´ ì‚¬ìš©ìëŠ” **RDP** í´ë¼ì´ì–¸íŠ¸ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ê³ , ë™ì‹œì— ì›ê²© ì»´í“¨í„°ëŠ” **RDP** ì„œë²„ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ìš´ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ì„¤ì •ì€ ì›ê²© ì»´í“¨í„°ì˜ ë°ìŠ¤í¬í†± í™˜ê²½ì„ ì›í™œí•˜ê²Œ ì œì–´í•˜ê³  ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•˜ì—¬, ë³¸ì§ˆì ìœ¼ë¡œ ê·¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©ìì˜ ë¡œì»¬ ì¥ì¹˜ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.

**ê¸°ë³¸ í¬íŠ¸:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## ì—´ê±°

### ìë™

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

ì‚¬ìš© ê°€ëŠ¥í•œ ì•”í˜¸í™” ë° DoS ì·¨ì•½ì„±ì„ í™•ì¸í•˜ê³ (ì„œë¹„ìŠ¤ì— DoSë¥¼ ìœ ë°œí•˜ì§€ ì•ŠìŒ) NTLM Windows ì •ë³´(ë²„ì „)ë¥¼ ì–»ìŠµë‹ˆë‹¤.

### [ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©](../generic-methodologies-and-resources/brute-force.md#rdp)

**ì£¼ì˜í•˜ì„¸ìš”, ê³„ì •ì´ ì ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤**

### **ë¹„ë°€ë²ˆí˜¸ ìŠ¤í”„ë ˆì´ ê³µê²©**

**ì£¼ì˜í•˜ì„¸ìš”, ê³„ì •ì´ ì ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### ì•Œë ¤ì§„ ìê²© ì¦ëª…/í•´ì‹œë¡œ ì—°ê²°í•˜ê¸°
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### RDP ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì•Œë ¤ì§„ ìê²© ì¦ëª… í™•ì¸

impacketì˜ rdp\_check.pyë¥¼ ì‚¬ìš©í•˜ë©´ ì¼ë¶€ ìê²© ì¦ëª…ì´ RDP ì„œë¹„ìŠ¤ì— ëŒ€í•´ ìœ íš¨í•œì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**ì·¨ì•½ì  í‰ê°€ ë° ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ì„¤ì •**. 20ê°œ ì´ìƒì˜ ë„êµ¬ ë° ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë””ì„œë‚˜ ì „ì²´ ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” íƒìƒ‰ì—ì„œ ë³´ê³ ì— ì´ë¥´ê¸°ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì¹¨íˆ¬ í…ŒìŠ¤í„°ë¥¼ ëŒ€ì²´í•˜ì§€ ì•Šìœ¼ë©°, ê·¸ë“¤ì´ ë” ê¹Šì´ íŒŒê³ ë“¤ê³ , ì‰˜ì„ í„°ëœ¨ë¦¬ê³ , ì¬ë¯¸ë¥¼ ëŠë‚„ ìˆ˜ ìˆë„ë¡ ë§ì¶¤í˜• ë„êµ¬, íƒì§€ ë° ì•…ìš© ëª¨ë“ˆì„ ê°œë°œí•©ë‹ˆë‹¤.

{% embed url="https://pentest-tools.com/" %}

## **ê³µê²©**

### ì„¸ì…˜ íƒˆì·¨

**SYSTEM ê¶Œí•œ**ìœ¼ë¡œ **ì–´ë–¤ ì‚¬ìš©ìì— ì˜í•´ì„œë„ ì—´ë¦° RDP ì„¸ì…˜ì—** ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ì†Œìœ ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

**ì—´ë¦° ì„¸ì…˜ ê°€ì ¸ì˜¤ê¸°:**
```
query user
```
**ì„ íƒí•œ ì„¸ì…˜ì— ëŒ€í•œ ì ‘ê·¼**
```bash
tscon <ID> /dest:<SESSIONNAME>
```
ì´ì œ ì„ íƒí•œ RDP ì„¸ì…˜ì— ë“¤ì–´ê°€ê²Œ ë˜ë©°, Windows ë„êµ¬ì™€ ê¸°ëŠ¥ë§Œì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë¥¼ ê°€ì¥í•˜ê²Œ ë©ë‹ˆë‹¤.

**ì¤‘ìš”**: í™œì„± RDP ì„¸ì…˜ì— ì ‘ê·¼í•˜ë©´ í•´ë‹¹ ì„¸ì…˜ì„ ì‚¬ìš© ì¤‘ì¸ ì‚¬ìš©ìê°€ ê°•ì œë¡œ ë¡œê·¸ì•„ì›ƒë©ë‹ˆë‹¤.

í”„ë¡œì„¸ìŠ¤ë¥¼ ë¤í”„í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì–»ì„ ìˆ˜ ìˆì§€ë§Œ, ì´ ë°©ë²•ì€ í›¨ì”¬ ë¹ ë¥´ë©° ì‚¬ìš©ìì˜ ê°€ìƒ ë°ìŠ¤í¬íƒ‘ê³¼ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤ (ë¹„ë°€ë²ˆí˜¸ê°€ ë””ìŠ¤í¬ì— ì €ì¥ë˜ì§€ ì•Šì€ ë©”ëª¨ì¥, ë‹¤ë¥¸ ë¨¸ì‹ ì—ì„œ ì—´ë¦° ë‹¤ë¥¸ RDP ì„¸ì…˜ ë“±...).

#### **Mimikatz**

ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ mimikatzë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Sticky-keys & Utilman

ì´ ê¸°ìˆ ì„ **stickykeys** ë˜ëŠ” **utilman**ê³¼ ê²°í•©í•˜ë©´ ì–¸ì œë“ ì§€ ê´€ë¦¬ CMDì™€ RDP ì„¸ì…˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê¸°ìˆ  ì¤‘ í•˜ë‚˜ë¡œ ë°±ë„ì–´ê°€ ì„¤ì •ëœ RDPë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### RDP Process Injection

ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œ ë˜ëŠ” **ë” ë‚˜ì€ ê¶Œí•œìœ¼ë¡œ RDPë¥¼ í†µí•´** **ë‹¹ì‹ ì´ ê´€ë¦¬ì**ì¸ PCì— ë¡œê·¸ì¸í•˜ëŠ” ê²½ìš°, ê·¸ì˜ **RDP ì„¸ì…˜ í”„ë¡œì„¸ìŠ¤**ì— ë‹¹ì‹ ì˜ ë¹„ì½˜ì„ **ì£¼ì…**í•˜ê³  ê·¸ë¡œ í–‰ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Adding User to RDP group
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Automatic Tools

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

**AutoRDPwn**ì€ Microsoft Windows ì»´í“¨í„°ì—ì„œ **Shadow** ê³µê²©ì„ ìë™í™”í•˜ê¸° ìœ„í•´ ì£¼ë¡œ ì„¤ê³„ëœ Powershellë¡œ ìƒì„±ëœ í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. ì´ ì·¨ì•½ì (ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ì—ì„œ ê¸°ëŠ¥ìœ¼ë¡œ ë‚˜ì—´ë¨)ì€ ì›ê²© ê³µê²©ìê°€ **í”¼í•´ìì˜ ë™ì˜ ì—†ì´ ê·¸ì˜ ë°ìŠ¤í¬íƒ‘ì„ ë³¼ ìˆ˜ ìˆê²Œ** í•˜ë©°, ì‹¬ì§€ì–´ ìš´ì˜ ì²´ì œ ìì²´ì˜ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ í•„ìš”ì— ë”°ë¼ ì´ë¥¼ ì œì–´í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* ëª…ë ¹ì¤„ì—ì„œ ìë™í™”ëœ ë°©ì‹ìœ¼ë¡œ ë§ˆìš°ìŠ¤ì™€ í‚¤ë³´ë“œë¥¼ ì œì–´
* ëª…ë ¹ì¤„ì—ì„œ ìë™í™”ëœ ë°©ì‹ìœ¼ë¡œ í´ë¦½ë³´ë“œë¥¼ ì œì–´
* RDPë¥¼ í†µí•´ ëŒ€ìƒì— ëŒ€í•œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ì±„ë„ë§í•˜ëŠ” SOCKS í”„ë¡ì‹œë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±
* íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì§€ ì•Šê³ ë„ ëŒ€ìƒì—ì„œ ì„ì˜ì˜ SHELL ë° PowerShell ëª…ë ¹ì„ ì‹¤í–‰
* íŒŒì¼ ì „ì†¡ì´ ëŒ€ìƒì—ì„œ ë¹„í™œì„±í™”ë˜ì–´ ìˆì–´ë„ ëŒ€ìƒì— íŒŒì¼ì„ ì—…ë¡œë“œ ë° ë‹¤ìš´ë¡œë“œ

## HackTricks Automatic Commands
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

**ì·¨ì•½ì  í‰ê°€ ë° ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ì„¤ì •**. 20ê°œ ì´ìƒì˜ ë„êµ¬ì™€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë””ì„œë‚˜ ì „ì²´ ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”. ìš°ë¦¬ëŠ” ì¹¨íˆ¬ í…ŒìŠ¤í„°ë¥¼ ëŒ€ì²´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ - ê·¸ë“¤ì´ ë” ê¹Šì´ íŒŒê³ ë“¤ê³ , ì‰˜ì„ í„°ëœ¨ë¦¬ê³ , ì¬ë¯¸ë¥¼ ëŠë‚„ ìˆ˜ ìˆë„ë¡ ë§ì¶¤í˜• ë„êµ¬, íƒì§€ ë° ì•…ìš© ëª¨ë“ˆì„ ê°œë°œí•©ë‹ˆë‹¤.

{% embed url="https://pentest-tools.com/" %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
