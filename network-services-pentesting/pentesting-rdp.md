# 3389 - Testowanie penetracyjne RDP

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Natychmiastowe dostpne narzdzie do oceny podatnoci i testowania penetracyjnego**. Uruchom pene testowanie penetracyjne z dowolnego miejsca za pomoc ponad 20 narzdzi i funkcji, kt贸re obejmuj od rozpoznania po raportowanie. Nie zastpujemy tester贸w penetracyjnych - opracowujemy niestandardowe narzdzia, moduy wykrywania i eksploatacji, aby umo偶liwi im zagbianie si, zdobywanie powok i dobr zabaw.

{% embed url="https://pentest-tools.com/" %}

## Podstawowe informacje

Rozwinity przez firm Microsoft, **Protok贸 zdalnego pulpitu** (**RDP**) ma na celu umo偶liwienie poczenia interfejsu graficznego midzy komputerami w sieci. Aby nawiza takie poczenie, u偶ytkownik korzysta z oprogramowania klienta **RDP**, a jednoczenie zdalny komputer musi dziaa jako serwer **RDP**. Taka konfiguracja umo偶liwia pynne sterowanie i dostp do pulpitu zdalnego komputera, co pozwala na wywietlanie jego interfejsu na lokalnym urzdzeniu u偶ytkownika.

**Domylny port:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## Wyliczanie

### Automatyczne

{% code overflow="wrap" %}
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
{% endcode %}

Sprawdza dostpne szyfrowanie i podatno na DoS (bez powodowania DoS dla usugi) oraz uzyskuje informacje o systemie Windows NTLM (wersje).

### [Brute force](../generic-methodologies-and-resources/brute-force.md#rdp)

**Bd藕 ostro偶ny, mo偶esz zablokowa konta**

### **Password Spraying**

**Bd藕 ostro偶ny, mo偶esz zablokowa konta**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### Pocz si za pomoc znanych powiadcze/haszowania

Jeli masz dostp do znanych powiadcze lub haszowania, mo偶esz spr贸bowa poczy si z usug RDP. W przypadku posiadania powiadcze, mo偶esz je wprowadzi rcznie podczas logowania. Jeli masz dostp tylko do haszowania, mo偶esz u偶y narzdzi do amania hasa, takich jak John the Ripper lub Hashcat, aby odzyska oryginalne haso.

Aby poczy si z usug RDP za pomoc znanych powiadcze, wykonaj nastpujce kroki:

1. Uruchom klienta RDP na swoim komputerze.
2. Wprowad藕 adres IP lub nazw hosta zdalnego komputera.
3. Wprowad藕 nazw u偶ytkownika i haso, kt贸re znasz.
4. Kliknij przycisk "Pocz" lub nacinij Enter, aby rozpocz sesj RDP.

Jeli masz dostp tylko do haszowania, wykonaj nastpujce kroki:

1. Skorzystaj z narzdzia do amania hasa, takiego jak John the Ripper lub Hashcat, aby odzyska oryginalne haso na podstawie hasza.
2. Po odzyskaniu hasa, wykonaj kroki opisane powy偶ej, aby poczy si z usug RDP za pomoc znanych powiadcze.

Pamitaj, 偶e pr贸ba poczenia si z usug RDP za pomoc nieautoryzowanych powiadcze lub haszowania jest nielegalna i narusza prywatno innych os贸b. Wykorzystuj te techniki tylko w legalnych i uprawnionych celach, takich jak testowanie penetracyjne.
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### Sprawdzanie znanych powiadcze w usugach RDP

rdp\_check.py z pakietu impacket pozwala sprawdzi, czy okrelone powiadczenia s poprawne dla usugi RDP:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Natychmiastowe dostpne narzdzia do oceny podatnoci i testowania penetracyjnego**. Uruchom peny test penetracyjny z dowolnego miejsca za pomoc ponad 20 narzdzi i funkcji, kt贸re obejmuj odzyskiwanie informacji i raportowanie. Nie zastpujemy tester贸w penetracyjnych - rozwijamy niestandardowe narzdzia, moduy wykrywania i eksploatacji, aby umo偶liwi im zagbianie si, zdobywanie dostpu i dobr zabaw.

{% embed url="https://pentest-tools.com/" %}

## **Ataki**

### Kradzie偶 sesji

Z uprawnieniami **SYSTEM** mo偶esz uzyska dostp do dowolnej **otwartej sesji RDP przez dowolnego u偶ytkownika** bez koniecznoci znajomoci hasa waciciela.

**Pobierz otwarte sesje:**
```
query user
```
**Dostp do wybranej sesji**

Aby uzyska dostp do wybranej sesji, mo偶esz skorzysta z r贸偶nych technik. Poni偶ej przedstawiam kilka sposob贸w, kt贸re mo偶esz wypr贸bowa:

1. **Brute force**: Wypr贸buj atak brute force, pr贸bujc r贸偶ne kombinacje nazw u偶ytkownik贸w i hase, a偶 znajdziesz poprawne dane uwierzytelniajce.

2. **Sownik atak**: Wykorzystaj sownik zawierajcy popularne hasa i nazwy u偶ytkownik贸w, aby przyspieszy proces ataku brute force.

3. **Podsuch sieciowy**: Monitoruj ruch sieciowy w poszukiwaniu danych uwierzytelniajcych, kt贸re s przesyane w otwartej formie.

4. **Atak Man-in-the-Middle**: Wykorzystaj atak Man-in-the-Middle, aby przechwyci dane uwierzytelniajce podczas komunikacji midzy klientem a serwerem RDP.

5. **Wykorzystanie sabych hase**: Sprawd藕, czy u偶ytkownicy korzystaj z atwych do odgadnicia hase, takich jak "password" lub "123456". Wykorzystaj te sabe hasa do uzyskania dostpu.

6. **Wykorzystanie podatnoci**: Sprawd藕, czy serwer RDP jest podatny na znane luki bezpieczestwa. Jeli tak, wykorzystaj te podatnoci do uzyskania dostpu.

Pamitaj, 偶e przed przeprowadzeniem jakiejkolwiek pr贸by uzyskania dostpu do sesji, upewnij si, 偶e masz odpowiednie uprawnienia i zgod na przeprowadzenie test贸w penetracyjnych.
```bash
tscon <ID> /dest:<SESSIONNAME>
```
Teraz bdziesz wewntrz wybranej sesji RDP i bdziesz musia poda si za u偶ytkownika, korzystajc tylko z narzdzi i funkcji systemu Windows.

**Wa偶ne**: Gdy uzyskasz dostp do aktywnej sesji RDP, wylogujesz u偶ytkownika, kt贸ry z niej korzysta.

Mo偶esz uzyska hasa, dumpujc proces, ale ta metoda jest znacznie szybsza i pozwala na interakcj z wirtualnym pulpitem u偶ytkownika (hasa w notatniku, kt贸re nie s zapisywane na dysku, inne otwarte sesje RDP na innych maszynach...)

#### **Mimikatz**

Mo偶esz r贸wnie偶 u偶y narzdzia mimikatz do tego:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Sticky-keys & Utilman

Kombinujc t technik z **stickykeys** lub **utilman, bdziesz w stanie uzyska dostp do administracyjnego CMD i dowolnej sesji RDP w dowolnym momencie**

Mo偶esz wyszuka RDP, kt贸re zostay ju偶 zainfekowane jedn z tych technik za pomoc: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### Wstrzykiwanie procesu RDP

Jeli kto z innej domeny lub z **lepszymi uprawnieniami zaloguje si przez RDP** do komputera, na kt贸rym **jeste administratorem**, mo偶esz **wstrzykn** sw贸j beacon w jego **proces sesji RDP** i dziaa jak on:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Dodawanie u偶ytkownika do grupy RDP
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Automatyczne narzdzia

* [**AutoRDPwn**](https://github.com/JoelGMSec/AutoRDPwn)

**AutoRDPwn** to framework do post-eksploatacji stworzony w Powershell, zaprojektowany g贸wnie do automatyzacji ataku **Shadow** na komputery z systemem Microsoft Windows. Ta podatno (zgoszona przez Microsoft jako funkcja) pozwala zdalnemu atakujcemu **obejrze pulpit swojej ofiary bez jej zgody**, a nawet kontrolowa go na 偶danie, korzystajc z narzdzi wbudowanych w sam system operacyjny.

* [**EvilRDP**](https://github.com/skelsec/evilrdp)
* Kontroluj myszk i klawiatur w spos贸b zautomatyzowany z wiersza polece
* Kontroluj schowek w spos贸b zautomatyzowany z wiersza polece
* Uruchom proxy SOCKS z klienta, kt贸re kieruje komunikacj sieciow do celu za porednictwem RDP
* Wykonuj dowolne polecenia SHELL i PowerShell na celu bez przesyania plik贸w
* Przesyaj pliki do/czytaj pliki z celu, nawet gdy przesyanie plik贸w jest wyczone na celu

## Automatyczne polecenia HackTricks
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for RDP
Note: |
Developed by Microsoft, the Remote Desktop Protocol (RDP) is designed to enable a graphical interface connection between computers over a network. To establish such a connection, RDP client software is utilized by the user, and concurrently, the remote computer is required to operate RDP server software. This setup allows for the seamless control and access of a distant computer's desktop environment, essentially bringing its interface to the user's local device.

https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
Name: Nmap
Description: Nmap with RDP Scripts
Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**Natychmiastowe dostpne narzdzia do oceny podatnoci i testowania penetracyjnego**. Uruchom peny test penetracyjny z dowolnego miejsca za pomoc ponad 20 narzdzi i funkcji, kt贸re obejmuj rozpoznanie i raportowanie. Nie zastpujemy tester贸w penetracyjnych - opracowujemy niestandardowe narzdzia, moduy wykrywania i eksploatacji, aby umo偶liwi im zagbianie si, zdobywanie powok i dobr zabaw.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) **i** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repozytori贸w GitHub.**

</details>
