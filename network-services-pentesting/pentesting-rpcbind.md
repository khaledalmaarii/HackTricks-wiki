# 111/TCP/UDP - Testowanie penetracyjne Portmappera

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

**Portmapper** to usuga, kt贸ra su偶y do mapowania port贸w usug sieciowych na numery program贸w **RPC** (Remote Procedure Call). Jest ona kluczowym komponentem w systemach opartych na **Unix**, uatwiajcym wymian informacji midzy tymi systemami. **Port** zwizany z **Portmapperem** jest czsto skanowany przez atakujcych, poniewa偶 mo偶e ujawni cenne informacje. Informacje te obejmuj rodzaj dziaajcego systemu operacyjnego **Unix** oraz szczeg贸y dotyczce usug dostpnych w systemie. Ponadto, **Portmapper** jest czsto u偶ywany w poczeniu z **NFS (Network File System)**, **NIS (Network Information Service)** i innymi usugami opartymi na **RPC**, aby efektywnie zarzdza usugami sieciowymi.

**Domylny port:** 111/TCP/UDP, 32771 w Oracle Solaris
```
PORT    STATE SERVICE
111/tcp open  rpcbind
```
## Wyliczanie

### rpcinfo

`rpcinfo` jest narzdziem, kt贸re su偶y do wyliczania informacji o usugach RPC (Remote Procedure Call) dostpnych na zdalnym hocie. Mo偶na go u偶y do uzyskania listy usug RPC, kt贸re s uruchomione na danym hocie, wraz z informacjami o numerach port贸w i protokoach, kt贸re s u偶ywane.

Aby u偶y `rpcinfo`, wykonaj polecenie:

```plaintext
rpcinfo -p <adres_hosta>
```

### showmount

`showmount` jest narzdziem, kt贸re su偶y do wyliczania informacji o eksportowanych systemach plik贸w NFS (Network File System) na zdalnym hocie. Mo偶na go u偶y do uzyskania listy eksportowanych system贸w plik贸w NFS, wraz z informacjami o cie偶kach i dostpnych uprawnieniach.

Aby u偶y `showmount`, wykonaj polecenie:

```plaintext
showmount -e <adres_hosta>
```

### enum4linux

`enum4linux` jest narzdziem, kt贸re su偶y do wyliczania informacji o usugach SMB/CIFS (Server Message Block/Common Internet File System) dostpnych na zdalnym hocie. Mo偶na go u偶y do uzyskania listy udostpnionych zasob贸w, kont u偶ytkownik贸w, grup, polityk bezpieczestwa i innych informacji zwizanych z usug SMB/CIFS.

Aby u偶y `enum4linux`, wykonaj polecenie:

```plaintext
enum4linux <adres_hosta>
```

### nmap

`nmap` jest popularnym narzdziem do skanowania sieci, kt贸re mo偶na r贸wnie偶 u偶y do wyliczania informacji o usugach dostpnych na zdalnym hocie. Mo偶na go skonfigurowa do skanowania konkretnych port贸w lub wykrywania usug automatycznie.

Aby u偶y `nmap` do wyliczania usug, wykonaj polecenie:

```plaintext
nmap -p- <adres_hosta>
```

### Metasploit

Metasploit to framework do testowania penetracyjnego, kt贸ry zawiera wiele modu贸w do wyliczania informacji o usugach dostpnych na zdalnym hocie. Mo偶na go u偶y do automatycznego skanowania i wyliczania informacji o usugach, w tym portach, protokoach, wersjach oprogramowania i innych szczeg贸ach.

Aby u偶y Metasploita do wyliczania usug, wykonaj polecenie:

```plaintext
use auxiliary/scanner/portscan/tcp
set RHOSTS <adres_hosta>
run
```

### Inne narzdzia

Opr贸cz wymienionych narzdzi istnieje wiele innych narzdzi, kt贸re mo偶na u偶y do wyliczania informacji o usugach dostpnych na zdalnym hocie. Niekt贸re z tych narzdzi to:

- `nbtscan`: Skanuje sie w poszukiwaniu host贸w SMB/CIFS i wylicza informacje o nich.
- `smbclient`: Pozwala na interakcj z usug SMB/CIFS i uzyskanie informacji o dostpnych zasobach.
- `ldapsearch`: Wykonuje zapytania LDAP (Lightweight Directory Access Protocol) do zdalnego serwera i wylicza informacje o katalogu.
- `snmpwalk`: Wykonuje zapytania SNMP (Simple Network Management Protocol) do zdalnego hosta i wylicza informacje o urzdzeniu.

W zale偶noci od celu i rodowiska, r贸偶ne narzdzia mog by bardziej lub mniej skuteczne w wyliczaniu informacji o usugach dostpnych na zdalnym hocie. Warto eksperymentowa z r贸偶nymi narzdziami i technikami, aby uzyska jak najwicej informacji.
```
rpcinfo irked.htb
nmap -sSUC -p111 192.168.10.1
```
Czasami nie dostajesz 偶adnych informacji, innym razem otrzymasz co takiego:

![](<../.gitbook/assets/image (230).png>)

### Shodan

* `port:111 portmap`

## RPCBind + NFS

Jeli znajdziesz usug NFS, prawdopodobnie bdziesz m贸g wywietla i pobiera (a mo偶e nawet przesya) pliki:

![](<../.gitbook/assets/image (232).png>)

Przeczytaj [2049 - Testowanie penetracyjne usugi NFS](nfs-service-pentesting.md), aby dowiedzie si wicej na temat testowania tego protokou.

## NIS

Badanie podatnoci **NIS** obejmuje dwuetapowy proces, rozpoczynajcy si od identyfikacji usugi `ypbind`. Kamieniem wgielnym tego badania jest odkrycie **nazwy domeny NIS**, bez kt贸rej postp zostaje zatrzymany.

![](<../.gitbook/assets/image (233).png>)

Podr贸偶 badawcza rozpoczyna si od instalacji niezbdnych pakiet贸w (`apt-get install nis`). Kolejnym krokiem jest u偶ycie polecenia `ypwhich`, aby potwierdzi obecno serwera NIS, pingujc go za pomoc nazwy domeny i adresu IP serwera, przy czym te elementy s anonimizowane w celu zapewnienia bezpieczestwa.

Ostatnim i kluczowym krokiem jest u偶ycie polecenia `ypcat`, aby wydoby wra偶liwe dane, zwaszcza zaszyfrowane hasa u偶ytkownik贸w. Te skr贸ty, po zamaniu ich za pomoc narzdzi takich jak **John the Ripper**, ujawniaj informacje o dostpie do systemu i uprawnieniach.
```bash
# Install NIS tools
apt-get install nis
# Ping the NIS server to confirm its presence
ypwhich -d <domain-name> <server-ip>
# Extract user credentials
ypcat d <domain-name> h <server-ip> passwd.byname
```
### Pliki NIF

| **Plik g贸wny** | **Mapy**                    | **Notatki**                           |
| --------------- | --------------------------- | ------------------------------------- |
| /etc/hosts      | hosts.byname, hosts.byaddr  | Zawiera nazwy host贸w i szczeg贸y IP   |
| /etc/passwd     | passwd.byname, passwd.byuid | Plik hasa u偶ytkownika NIS             |
| /etc/group      | group.byname, group.bygid   | Plik grupy NIS                         |
| /usr/lib/aliases| mail.aliases                | Szczeg贸y alias贸w poczty elektronicznej|

## U偶ytkownicy RPC

Jeli znajdziesz usug **rusersd** wymienion w ten spos贸b:

![](<../.gitbook/assets/image (231).png>)

Mo偶esz wyliczy u偶ytkownik贸w na maszynie. Aby dowiedzie si jak to zrobi, przeczytaj [1026 - Pentesting Rsusersd](1026-pentesting-rusersd.md).

## Ominicie zablokowanego portu Portmapper

Podczas przeprowadzania skanu **nmap** i odkrywania otwartych port贸w NFS, gdzie port 111 jest zablokowany, bezporednie wykorzystanie tych port贸w jest niemo偶liwe. Jednak poprzez **symulacj lokalnej usugi portmappera i utworzenie tunelu z Twojego komputera** do celu, mo偶liwe staje si wykorzystanie narzdzi standardowych. Ta technika umo偶liwia ominicie zablokowanego stanu portu 111, umo偶liwiajc dostp do usug NFS. Szczeg贸owe wskaz贸wki dotyczce tej metody znajduj si w artykule dostpnym pod [tym linkiem](https://medium.com/@sebnemK/how-to-bypass-filtered-portmapper-port-111-27cee52416bc).

## Shodan

* `Portmap`

## Laboratoria do praktyki

* Wypr贸buj te techniki na maszynie [**Irked HTB**](https://app.hackthebox.com/machines/Irked).

## Automatyczne polecenia HackTricks
```
Protocol_Name: Portmapper    #Protocol Abbreviation if there is one.
Port_Number:  43     #Comma separated if there is more than one.
Protocol_Description: PM or RPCBind        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for PortMapper
Note: |
Portmapper is a service that is utilized for mapping network service ports to RPC (Remote Procedure Call) program numbers. It acts as a critical component in Unix-based systems, facilitating the exchange of information between these systems. The port associated with Portmapper is frequently scanned by attackers as it can reveal valuable information. This information includes the type of Unix Operating System (OS) running and details about the services that are available on the system. Additionally, Portmapper is commonly used in conjunction with NFS (Network File System), NIS (Network Information Service), and other RPC-based services to manage network services effectively.

https://book.hacktricks.xyz/pentesting/pentesting-rpcbind

Entry_2:
Name: rpc info
Description: May give netstat-type info
Command: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43

Entry_3:
Name: nmap
Description: May give netstat-type info
Command: nmap -sSUC -p 111 {IP}
```
<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
