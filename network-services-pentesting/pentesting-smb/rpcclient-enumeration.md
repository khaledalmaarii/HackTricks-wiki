# rpcclientæšä¸¾

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

### **ä»€ä¹ˆæ˜¯RID**

[ç›¸å¯¹æ ‡è¯†ç¬¦ï¼ˆRIDï¼‰](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers)æ˜¯Windowsç”¨äº**è·Ÿè¸ªå’Œè¯†åˆ«å¯¹è±¡**çš„**å”¯ä¸€æ ‡è¯†ç¬¦**ï¼ˆä»¥åå…­è¿›åˆ¶æ ¼å¼è¡¨ç¤ºï¼‰ã€‚ä¸ºäº†è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­ï¼š

* NAME\_DOMAIN.LOCALåŸŸçš„[SID](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers)æ˜¯ï¼š`S-1-5-21-1038751438-1834703946-36937684957`ã€‚
* å½“åœ¨åŸŸä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¸Šè¿°æ•°å­—ï¼ˆSIDï¼‰å°†ä¸RIDç»„åˆï¼Œä»¥ç”Ÿæˆç”¨äºè¡¨ç¤ºè¯¥å¯¹è±¡çš„å”¯ä¸€å€¼ã€‚
* å› æ­¤ï¼Œå…·æœ‰RIDï¼š\[0x457] Hex 0x457ç­‰äºåè¿›åˆ¶`1111`çš„åŸŸç”¨æˆ·`john`å°†å…·æœ‰å®Œæ•´çš„ç”¨æˆ·SIDï¼š`S-1-5-21-1038751438-1834703946-36937684957-1111`ã€‚
* è¿™å¯¹äºNAME\_DOMAIN.LOCALåŸŸä¸­çš„`john`å¯¹è±¡æ˜¯å”¯ä¸€çš„ï¼Œæ‚¨å°†æ°¸è¿œä¸ä¼šçœ‹åˆ°æ­¤é…å¯¹å€¼ä¸è¯¥åŸŸæˆ–ä»»ä½•å…¶ä»–åŸŸä¸­çš„å¦ä¸€ä¸ªå¯¹è±¡ç›¸å…³è”ã€‚

å®šä¹‰æ¥è‡ª[**è¿™é‡Œ**](https://academy.hackthebox.com/module/143/section/1269)ã€‚

### **ä½¿ç”¨rpcclientè¿›è¡Œæšä¸¾**

**æœ¬èŠ‚çš„ä¸€éƒ¨åˆ†æ‘˜è‡ªä¹¦ç± "**_**ç½‘ç»œå®‰å…¨è¯„ä¼°ç¬¬ä¸‰ç‰ˆ**_**"**

æ‚¨å¯ä»¥ä½¿ç”¨Sambaçš„**`rpcclient`**å®ç”¨ç¨‹åºé€šè¿‡å‘½åç®¡é“ä¸**RPCç«¯ç‚¹**è¿›è¡Œäº¤äº’ã€‚ä»¥ä¸‹æ˜¯æ‚¨å¯ä»¥åœ¨**å»ºç«‹**SMBä¼šè¯åï¼ˆé€šå¸¸éœ€è¦å‡­æ®ï¼‰å‘SAMRã€LSARPCå’ŒLSARPC-DSæ¥å£å‘å‡ºçš„å‘½ä»¤åˆ—è¡¨ã€‚

#### æœåŠ¡å™¨ä¿¡æ¯

* **æœåŠ¡å™¨ä¿¡æ¯**ï¼š`srvinfo`

#### ç”¨æˆ·æšä¸¾

* **åˆ—å‡ºç”¨æˆ·**ï¼š`querydispinfo`å’Œ`enumdomusers`
* **è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯**ï¼š`queryuser <0xrid>`
* **è·å–ç”¨æˆ·ç»„**ï¼š`queryusergroups <0xrid>`
* **è·å–ç”¨æˆ·çš„SID**ï¼š`lookupnames <username>`
* **è·å–ç”¨æˆ·åˆ«å**ï¼š`queryuseraliases [builtin|domain] <sid>`
```bash
# Brute-Force users RIDs
for i in $(seq 500 1100); do
rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# You can also use samrdump.py for this purpose
```
#### æšä¸¾ç»„

* **åˆ—å‡ºç»„**: `enumdomgroups`
* **è·å–ç»„è¯¦ç»†ä¿¡æ¯**: `querygroup <0xrid>`
* **è·å–ç»„æˆå‘˜**: `querygroupmem <0xrid>`

#### æšä¸¾åˆ«åç»„

* **åˆ—å‡ºåˆ«å**: `enumalsgroups <builtin|domain>`
* **è·å–æˆå‘˜**: `queryaliasmem builtin|domain <0xrid>`

#### æšä¸¾åŸŸ

* **åˆ—å‡ºåŸŸ**: `enumdomains`
* **è·å–SID**: `lsaquery`
* **åŸŸä¿¡æ¯**: `querydominfo`

#### æšä¸¾å…±äº«

* **æšä¸¾æ‰€æœ‰å¯ç”¨å…±äº«**: `netshareenumall`
* **å…±äº«ä¿¡æ¯**: `netsharegetinfo <share>`

#### æ›´å¤šSID

* **é€šè¿‡åç§°æŸ¥æ‰¾SID**: `lookupnames <username>`
* **æŸ¥æ‰¾æ›´å¤šSID**: `lsaenumsid`
* **RIDå¾ªç¯ï¼ˆæ£€æŸ¥æ›´å¤šSIDï¼‰**: `lookupsids <sid>`

#### **é¢å¤–å‘½ä»¤**

| **å‘½ä»¤**             | **æ¥å£**                                                                                                                                         | **æè¿°**                                                                                                                             |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | æ£€ç´¢ç”¨æˆ·ä¿¡æ¯                                                                                                                         |
| querygroup          | æ£€ç´¢ç»„ä¿¡æ¯                                                                                                                                        |                                                                                                                                     |
| querydominfo        | æ£€ç´¢åŸŸä¿¡æ¯                                                                                                                                       |                                                                                                                                     |
| enumdomusers        | æšä¸¾åŸŸç”¨æˆ·                                                                                                                                        |                                                                                                                                     |
| enumdomgroups       | æšä¸¾åŸŸç»„                                                                                                                                          |                                                                                                                                     |
| createdomuser       | åˆ›å»ºåŸŸç”¨æˆ·                                                                                                                                        |                                                                                                                                     |
| deletedomuser       | åˆ é™¤åŸŸç”¨æˆ·                                                                                                                                        |                                                                                                                                     |
| lookupnames         | LSARPC                                                                                                                                            | æŸ¥æ‰¾ç”¨æˆ·ååˆ°SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8)å€¼ |
| lookupsids          | æŸ¥æ‰¾SIDåˆ°ç”¨æˆ·åï¼ˆRID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)å¾ªç¯ï¼‰ |                                                                                                                                     |
| lsaaddacctrights    | å‘ç”¨æˆ·å¸æˆ·æ·»åŠ æƒé™                                                                                                                               |                                                                                                                                     |
| lsaremoveacctrights | ä»ç”¨æˆ·å¸æˆ·ä¸­åˆ é™¤æƒé™                                                                                                                             |                                                                                                                                     |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | è·å–ä¸»åŸŸä¿¡æ¯                                                                                                                         |
| dsenumdomtrusts     | æšä¸¾ADæ£®æ—ä¸­çš„å—ä¿¡ä»»åŸŸ                                                                                                                           |                                                                                                                                     |

è¦æ›´å¥½åœ°**äº†è§£**å·¥å…·_**samrdump**_å’Œ_**rpcdump**_çš„å·¥ä½œåŸç†ï¼Œæ‚¨åº”è¯¥é˜…è¯»[**Pentesting MSRPC**](../135-pentesting-msrpc.md)ã€‚

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­**ä¸ºæ‚¨çš„å…¬å¸åšå¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTricksè¡£ç‰©**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
