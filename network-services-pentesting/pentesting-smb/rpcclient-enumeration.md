# rpcclient enumeration

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿ æƒ³è¦çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­å®£ä¼ **å—ï¼Ÿ æˆ–è€…æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿ è¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[NFTæ”¶è—å“](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

å‘ç°æœ€é‡è¦çš„æ¼æ´ï¼Œä»¥ä¾¿æ›´å¿«åœ°ä¿®å¤å®ƒä»¬ã€‚Intruderè·Ÿè¸ªæ‚¨çš„æ”»å‡»é¢ï¼Œè¿è¡Œä¸»åŠ¨å¨èƒæ‰«æï¼Œå‘ç°æ•´ä¸ªæŠ€æœ¯å †æ ˆä¸­çš„é—®é¢˜ï¼Œä»APIåˆ°Webåº”ç”¨ç¨‹åºå’Œäº‘ç³»ç»Ÿã€‚[**ç«‹å³å…è´¹è¯•ç”¨**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **ä»€ä¹ˆæ˜¯RID**

### ç›¸å¯¹æ ‡è¯†ç¬¦ï¼ˆRIDï¼‰å’Œå®‰å…¨æ ‡è¯†ç¬¦ï¼ˆSIDï¼‰æ¦‚è¿°

**ç›¸å¯¹æ ‡è¯†ç¬¦ï¼ˆRIDï¼‰**å’Œ**å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆSIDï¼‰**æ˜¯Windowsæ“ä½œç³»ç»Ÿä¸­ç”¨äºå”¯ä¸€æ ‡è¯†å’Œç®¡ç†ç½‘ç»œåŸŸå†…å¯¹è±¡ï¼ˆå¦‚ç”¨æˆ·å’Œç»„ï¼‰çš„å…³é”®ç»„ä»¶ã€‚

- **SIDs**ç”¨ä½œåŸŸçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç¡®ä¿æ¯ä¸ªåŸŸæ˜¯å¯åŒºåˆ†çš„ã€‚
- **RIDs**é™„åŠ åˆ°SIDsä»¥åˆ›å»ºè¿™äº›åŸŸå†…å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚æ­¤ç»„åˆå…è®¸å¯¹å¯¹è±¡æƒé™å’Œè®¿é—®æ§åˆ¶è¿›è¡Œç²¾ç¡®è·Ÿè¸ªå’Œç®¡ç†ã€‚

ä¾‹å¦‚ï¼Œåä¸º`pepe`çš„ç”¨æˆ·å¯èƒ½å…·æœ‰å°†åŸŸçš„SIDä¸å…¶ç‰¹å®šRIDç»“åˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä»¥åå…­è¿›åˆ¶ï¼ˆ`0x457`ï¼‰å’Œåè¿›åˆ¶ï¼ˆ`1111`ï¼‰æ ¼å¼è¡¨ç¤ºã€‚è¿™å¯¼è‡´äº†pepeåœ¨åŸŸå†…çš„å®Œæ•´ä¸”å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¦‚ï¼š`S-1-5-21-1074507654-1937615267-42093643874-1111`ã€‚


### **ä½¿ç”¨rpcclientè¿›è¡Œæšä¸¾**

æ¥è‡ªSambaçš„**`rpcclient`**å®ç”¨ç¨‹åºç”¨äºé€šè¿‡å‘½åç®¡é“ä¸**RPCç«¯ç‚¹è¿›è¡Œäº¤äº’**ã€‚åœ¨**å»ºç«‹SMBä¼šè¯**åï¼Œé€šå¸¸éœ€è¦å‡­æ®ï¼Œå¯ä»¥å‘å‡ºä»¥ä¸‹å‘½ä»¤åˆ°SAMRã€LSARPCå’ŒLSARPC-DSæ¥å£ã€‚

#### æœåŠ¡å™¨ä¿¡æ¯

* è¦è·å–**æœåŠ¡å™¨ä¿¡æ¯**ï¼šä½¿ç”¨`srvinfo`å‘½ä»¤ã€‚

#### ç”¨æˆ·æšä¸¾

* å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡º**ç”¨æˆ·**ï¼š`querydispinfo`å’Œ`enumdomusers`ã€‚
* é€šè¿‡`queryuser <0xrid>`æŸ¥çœ‹**ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯**ã€‚
* ä½¿ç”¨`queryusergroups <0xrid>`æŸ¥çœ‹**ç”¨æˆ·çš„ç»„**ã€‚
* é€šè¿‡`lookupnames <username>`æ£€ç´¢**ç”¨æˆ·çš„SID**ã€‚
* é€šè¿‡`queryuseraliases [builtin|domain] <sid>`æŸ¥çœ‹**ç”¨æˆ·çš„åˆ«å**ã€‚
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### æšä¸¾ç»„

- ä½¿ç”¨`enumdomgroups`æ¥æšä¸¾**ç»„**ã€‚
- ä½¿ç”¨`querygroup <0xrid>`æ¥è·å–**ç»„çš„è¯¦ç»†ä¿¡æ¯**ã€‚
- é€šè¿‡`querygroupmem <0xrid>`æ¥æŸ¥çœ‹**ç»„çš„æˆå‘˜**ã€‚

#### æšä¸¾åˆ«åç»„

- ä½¿ç”¨`enumalsgroups <builtin|domain>`æ¥æšä¸¾**åˆ«åç»„**ã€‚
- ä½¿ç”¨`queryaliasmem builtin|domain <0xrid>`æ¥æŸ¥çœ‹**åˆ«åç»„çš„æˆå‘˜**ã€‚

#### æšä¸¾åŸŸ

- ä½¿ç”¨`enumdomains`æ¥æšä¸¾**åŸŸ**ã€‚
- é€šè¿‡`lsaquery`æ¥æ£€ç´¢**åŸŸçš„SID**ã€‚
- ä½¿ç”¨`querydominfo`æ¥è·å–**åŸŸä¿¡æ¯**ã€‚

#### æšä¸¾å…±äº«

- ä½¿ç”¨`netshareenumall`æ¥åˆ—å‡º**æ‰€æœ‰å¯ç”¨çš„å…±äº«**ã€‚
- ä½¿ç”¨`netsharegetinfo <share>`æ¥è·å–ç‰¹å®šå…±äº«çš„**ä¿¡æ¯**ã€‚

#### ä½¿ç”¨SIDçš„é™„åŠ æ“ä½œ

- ä½¿ç”¨`lookupnames <username>`æ¥æ ¹æ®åç§°è·å–**SID**ã€‚
- é€šè¿‡`lsaenumsid`æ¥è·å–**æ›´å¤šçš„SID**ã€‚
- ä½¿ç”¨`lookupsids <sid>`è¿›è¡Œ**RIDå¾ªç¯**ä»¥æ£€æŸ¥æ›´å¤šçš„SIDã€‚

#### **é¢å¤–å‘½ä»¤**

| **å‘½ä»¤**             | **æ¥å£**                                                                                                                                     | **æè¿°**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | æ£€ç´¢ç”¨æˆ·ä¿¡æ¯                                                                                                                 |
| querygroup          | æ£€ç´¢ç»„ä¿¡æ¯                                                                                                                        |                                                                                                                                           |
| querydominfo        | æ£€ç´¢åŸŸä¿¡æ¯                                                                                                                       |                                                                                                                                           |
| enumdomusers        | æšä¸¾åŸŸç”¨æˆ·                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | æšä¸¾åŸŸç»„                                                                                                                           |                                                                                                                                           |
| createdomuser       | åˆ›å»ºåŸŸç”¨æˆ·                                                                                                                              |                                                                                                                                           |
| deletedomuser       | åˆ é™¤åŸŸç”¨æˆ·                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | æŸ¥æ‰¾ç”¨æˆ·ååˆ°SIDçš„å€¼                                                                                                                 |
| lookupsids          | æŸ¥æ‰¾SIDåˆ°ç”¨æˆ·åï¼ˆRIDå¾ªç¯ï¼‰                                                                 |                                                                                                                                           |
| lsaaddacctrights    | ä¸ºç”¨æˆ·å¸æˆ·æ·»åŠ æƒé™                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | ä»ç”¨æˆ·å¸æˆ·ä¸­åˆ é™¤æƒé™                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | è·å–ä¸»åŸŸä¿¡æ¯                                                                                                            |
| dsenumdomtrusts     | æšä¸¾ADæ£®æ—ä¸­çš„å—ä¿¡ä»»åŸŸ                                                                                                     |                                                                                                                                           |

è¦æ›´å¥½åœ°äº†è§£å·¥å…·**samrdump**å’Œ**rpcdump**çš„å·¥ä½œåŸç†ï¼Œè¯·é˜…è¯»[**Pentesting MSRPC**](../135-pentesting-msrpc.md)ã€‚

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

æ‰¾åˆ°æœ€é‡è¦çš„æ¼æ´ï¼Œä»¥ä¾¿æ›´å¿«åœ°ä¿®å¤å®ƒä»¬ã€‚Intruderè·Ÿè¸ªæ‚¨çš„æ”»å‡»é¢ï¼Œè¿è¡Œä¸»åŠ¨å¨èƒæ‰«æï¼Œå‘ç°æ•´ä¸ªæŠ€æœ¯å †æ ˆä¸­çš„é—®é¢˜ï¼Œä»APIåˆ°Webåº”ç”¨ç¨‹åºå’Œäº‘ç³»ç»Ÿã€‚[**ç«‹å³å…è´¹è¯•ç”¨**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆçš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTsæ”¶è—å“**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã€‚
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)ã€‚
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
