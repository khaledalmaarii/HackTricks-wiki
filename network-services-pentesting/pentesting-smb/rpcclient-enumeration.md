# rpcclient enumeration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Relative Identifiers (RID) ë° Security Identifiers (SID) ê°œìš”

**Relative Identifiers (RID)**ì™€ **Security Identifiers (SID)**ëŠ” Windows ìš´ì˜ ì²´ì œì—ì„œ ë„¤íŠ¸ì›Œí¬ ë„ë©”ì¸ ë‚´ì˜ ì‚¬ìš©ì ë° ê·¸ë£¹ê³¼ ê°™ì€ ê°ì²´ë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë° ì¤‘ìš”í•œ êµ¬ì„± ìš”ì†Œì…ë‹ˆë‹¤.

- **SID**ëŠ” ë„ë©”ì¸ì˜ ê³ ìœ  ì‹ë³„ìë¡œ, ê° ë„ë©”ì¸ì´ êµ¬ë³„ë  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
- **RID**ëŠ” SIDì— ì¶”ê°€ë˜ì–´ í•´ë‹¹ ë„ë©”ì¸ ë‚´ì˜ ê°ì²´ì— ëŒ€í•œ ê³ ìœ  ì‹ë³„ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ ì¡°í•©ì€ ê°ì²´ ê¶Œí•œ ë° ì ‘ê·¼ ì œì–´ë¥¼ ì •í™•í•˜ê²Œ ì¶”ì í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, `pepe`ë¼ëŠ” ì‚¬ìš©ìëŠ” ë„ë©”ì¸ì˜ SIDì™€ ê·¸ì˜ íŠ¹ì • RIDë¥¼ ê²°í•©í•œ ê³ ìœ  ì‹ë³„ìë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” 16ì§„ìˆ˜(`0x457`) ë° 10ì§„ìˆ˜(`1111`) í˜•ì‹ìœ¼ë¡œ í‘œí˜„ë©ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ë„ë©”ì¸ ë‚´ì—ì„œ pepeì— ëŒ€í•œ ì™„ì „í•˜ê³  ê³ ìœ í•œ ì‹ë³„ìê°€ ìƒì„±ë©ë‹ˆë‹¤: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **rpcclientë¥¼ í†µí•œ ì—´ê±°**

Sambaì˜ **`rpcclient`** ìœ í‹¸ë¦¬í‹°ëŠ” **ì´ë¦„ì´ ì§€ì •ëœ íŒŒì´í”„ë¥¼ í†µí•œ RPC ì—”ë“œí¬ì¸íŠ¸ì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤**. ì•„ë˜ ëª…ë ¹ì€ **SMB ì„¸ì…˜ì´ ì„¤ì •ëœ í›„** SAMR, LSARPC ë° LSARPC-DS ì¸í„°í˜ì´ìŠ¤ì— ë°œí–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¢…ì¢… ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.

#### ì„œë²„ ì •ë³´

* **ì„œë²„ ì •ë³´ë¥¼ ì–»ìœ¼ë ¤ë©´**: `srvinfo` ëª…ë ¹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### ì‚¬ìš©ì ì—´ê±°

* **ì‚¬ìš©ìë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**: `querydispinfo` ë° `enumdomusers`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
* **ì‚¬ìš©ìì˜ ì„¸ë¶€ì •ë³´**: `queryuser <0xrid>`ë¡œ í™•ì¸í•©ë‹ˆë‹¤.
* **ì‚¬ìš©ìì˜ ê·¸ë£¹**: `queryusergroups <0xrid>`ë¡œ í™•ì¸í•©ë‹ˆë‹¤.
* **ì‚¬ìš©ìì˜ SIDëŠ”**: `lookupnames <username>`ì„ í†µí•´ ê²€ìƒ‰ë©ë‹ˆë‹¤.
* **ì‚¬ìš©ìì˜ ë³„ì¹­**: `queryuseraliases [builtin|domain] <sid>`ë¡œ í™•ì¸í•©ë‹ˆë‹¤.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### ê·¸ë£¹ ì—´ê±°

* **ê·¸ë£¹**: `enumdomgroups`.
* **ê·¸ë£¹ì˜ ì„¸ë¶€ì •ë³´**: `querygroup <0xrid>`.
* **ê·¸ë£¹ì˜ êµ¬ì„±ì›**: `querygroupmem <0xrid>`.

#### ë³„ì¹­ ê·¸ë£¹ ì—´ê±°

* **ë³„ì¹­ ê·¸ë£¹**: `enumalsgroups <builtin|domain>`.
* **ë³„ì¹­ ê·¸ë£¹ì˜ êµ¬ì„±ì›**: `queryaliasmem builtin|domain <0xrid>`.

#### ë„ë©”ì¸ ì—´ê±°

* **ë„ë©”ì¸**: `enumdomains`.
* **ë„ë©”ì¸ì˜ SIDë¥¼ ê²€ìƒ‰**: `lsaquery`.
* **ë„ë©”ì¸ ì •ë³´ ì–»ê¸°**: `querydominfo`.

#### ê³µìœ  ì—´ê±°

* **ëª¨ë“  ì‚¬ìš© ê°€ëŠ¥í•œ ê³µìœ **: `netshareenumall`.
* **íŠ¹ì • ê³µìœ ì— ëŒ€í•œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°**: `netsharegetinfo <share>`.

#### SIDì™€ ê´€ë ¨ëœ ì¶”ê°€ ì‘ì—…

* **ì´ë¦„ìœ¼ë¡œ SIDs**: `lookupnames <username>`.
* **ë” ë§ì€ SIDs**: `lsaenumsid`.
* **ë” ë§ì€ SIDsë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ RID ìˆœí™˜**: `lookupsids <sid>`.

#### **ì¶”ê°€ ëª…ë ¹ì–´**

| **ëª…ë ¹ì–´**         | **ì¸í„°í˜ì´ìŠ¤**                                                                                                                                     | **ì„¤ëª…**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | ì‚¬ìš©ì ì •ë³´ ê²€ìƒ‰                                                                                                                 |
| querygroup          | ê·¸ë£¹ ì •ë³´ ê²€ìƒ‰                                                                                                                        |                                                                                                                                           |
| querydominfo        | ë„ë©”ì¸ ì •ë³´ ê²€ìƒ‰                                                                                                                       |                                                                                                                                           |
| enumdomusers        | ë„ë©”ì¸ ì‚¬ìš©ì ì—´ê±°                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | ë„ë©”ì¸ ê·¸ë£¹ ì—´ê±°                                                                                                                           |                                                                                                                                           |
| createdomuser       | ë„ë©”ì¸ ì‚¬ìš©ì ìƒì„±                                                                                                                              |                                                                                                                                           |
| deletedomuser       | ë„ë©”ì¸ ì‚¬ìš©ì ì‚­ì œ                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | ì‚¬ìš©ì ì´ë¦„ì„ SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) ê°’ìœ¼ë¡œ ì¡°íšŒ |
| lookupsids          | ì‚¬ìš©ì ì´ë¦„ì— ëŒ€í•œ SIDs ì¡°íšŒ (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) ìˆœí™˜) |                                                                                                                                           |
| lsaaddacctrights    | ì‚¬ìš©ì ê³„ì •ì— ê¶Œí•œ ì¶”ê°€                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | ì‚¬ìš©ì ê³„ì •ì—ì„œ ê¶Œí•œ ì œê±°                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | ê¸°ë³¸ ë„ë©”ì¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°                                                                                                            |
| dsenumdomtrusts     | AD í¬ë ˆìŠ¤íŠ¸ ë‚´ì˜ ì‹ ë¢°ëœ ë„ë©”ì¸ ì—´ê±°                                                                                                     |                                                                                                                                           |

ë„êµ¬ _**samrdump**_ **ì™€** _**rpcdump**_ ì˜ ì‘ë™ ë°©ì‹ì„ **ë” ì˜ ì´í•´í•˜ê¸° ìœ„í•´** [**Pentesting MSRPC**](../135-pentesting-msrpc.md)ë¥¼ ì½ì–´ì•¼ í•©ë‹ˆë‹¤.

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
