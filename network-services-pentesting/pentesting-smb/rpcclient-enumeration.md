# rpcclient opsporing

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Oorsig van Relatiewe Identifiseerders (RID) en Sekuriteitsidentifiseerders (SID)

**Relatiewe Identifiseerders (RID)** en **Sekuriteitsidentifiseerders (SID)** is sleutelkomponente in Windows-bedryfstelsels vir die unieke identifisering en bestuur van voorwerpe, soos gebruikers en groepe, binne 'n netwerkdomein.

- **SIDs** dien as unieke identifiseerders vir domeine, wat verseker dat elke domein onderskeibaar is.
- **RIDs** word by SIDs gevoeg om unieke identifiseerders vir voorwerpe binne daardie domeine te skep. Hierdie kombinasie maak presiese opsporing en bestuur van voorwerptoestemmings en toegangbeheer moontlik.

Byvoorbeeld, 'n gebruiker genaamd `pepe` mag 'n unieke identifiseerder h√™ wat die domein se SID met sy spesifieke RID kombineer, voorgestel in beide heksadesimale (`0x457`) en desimale (`1111`) formate. Dit lei tot 'n volledige en unieke identifiseerder vir pepe binne die domein soos: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **Opsporing met rpcclient**

Die **`rpcclient`** nut van Samba word gebruik om te kommunikeer met **RPC eindpunte deur naamgebaseerde pype**. Hieronder is opdragte wat aan die SAMR, LSARPC, en LSARPC-DS interfaces gegee kan word nadat 'n **SMB sessie gevestig is**, wat dikwels geloofsbriewe vereis.

#### Bediener Inligting

* Om **Bediener Inligting** te verkry: `srvinfo` opdrag word gebruik.

#### Opsporing van Gebruikers

* **Gebruikers kan gelys word** met: `querydispinfo` en `enumdomusers`.
* **Besonderhede van 'n gebruiker** deur: `queryuser <0xrid>`.
* **Groepen van 'n gebruiker** met: `queryusergroups <0xrid>`.
* **'n Gebruiker se SID word verkry** deur: `lookupnames <username>`.
* **Alias van gebruikers** deur: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Enumeration of Groups

* **Groep** deur: `enumdomgroups`.
* **Besonderhede van 'n groep** met: `querygroup <0xrid>`.
* **Lede van 'n groep** deur: `querygroupmem <0xrid>`.

#### Enumeration of Alias Groups

* **Alias groepe** deur: `enumalsgroups <builtin|domain>`.
* **Lede van 'n alias groep** met: `queryaliasmem builtin|domain <0xrid>`.

#### Enumeration of Domains

* **Domeine** met: `enumdomains`.
* **'n Domein se SID word verkry** deur: `lsaquery`.
* **Domein inligting word verkry** deur: `querydominfo`.

#### Enumeration of Shares

* **Alle beskikbare gedeeltes** deur: `netshareenumall`.
* **Inligting oor 'n spesifieke gedeelte word verkry** met: `netsharegetinfo <share>`.

#### Additional Operations with SIDs

* **SIDs volgens naam** met: `lookupnames <username>`.
* **Meer SIDs** deur: `lsaenumsid`.
* **RID siklusse om meer SIDs te kontroleer** word uitgevoer deur: `lookupsids <sid>`.

#### **Extra commands**

| **Opdrag**          | **Koppelvlak**                                                                                                                                     | **Beskrywing**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Verkry gebruikersinligting                                                                                                                 |
| querygroup          | Verkry groepinligting                                                                                                                            |                                                                                                                                           |
| querydominfo        | Verkry domeininligting                                                                                                                           |                                                                                                                                           |
| enumdomusers        | Enumereer domein gebruikers                                                                                                                      |                                                                                                                                           |
| enumdomgroups       | Enumereer domein groepe                                                                                                                         |                                                                                                                                           |
| createdomuser       | Skep 'n domein gebruiker                                                                                                                          |                                                                                                                                           |
| deletedomuser       | Verwyder 'n domein gebruiker                                                                                                                     |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Soek gebruikersname na SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) waardes |
| lookupsids          | Soek SIDs na gebruikersname (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) siklusse) |                                                                                                                                           |
| lsaaddacctrights    | Voeg regte by 'n gebruikersrekening                                                                                                              |                                                                                                                                           |
| lsaremoveacctrights | Verwyder regte van 'n gebruikersrekening                                                                                                          |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Verkry prim√™re domeininligting                                                                                                            |
| dsenumdomtrusts     | Enumereer vertroude domeine binne 'n AD woud                                                                                                     |                                                                                                                                           |

To **understand** better how the tools _**samrdump**_ **and** _**rpcdump**_ works you should read [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
