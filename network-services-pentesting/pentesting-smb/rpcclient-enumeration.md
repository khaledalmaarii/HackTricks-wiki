# rpcclient enumeration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Vis√£o Geral dos Identificadores Relativos (RID) e Identificadores de Seguran√ßa (SID)

**Identificadores Relativos (RID)** e **Identificadores de Seguran√ßa (SID)** s√£o componentes chave nos sistemas operacionais Windows para identificar e gerenciar objetos, como usu√°rios e grupos, dentro de um dom√≠nio de rede.

- **SIDs** servem como identificadores √∫nicos para dom√≠nios, garantindo que cada dom√≠nio seja distingu√≠vel.
- **RIDs** s√£o anexados aos SIDs para criar identificadores √∫nicos para objetos dentro desses dom√≠nios. Essa combina√ß√£o permite um rastreamento e gerenciamento precisos das permiss√µes de objetos e controles de acesso.

Por exemplo, um usu√°rio chamado `pepe` pode ter um identificador √∫nico combinando o SID do dom√≠nio com seu RID espec√≠fico, representado em formatos hexadecimal (`0x457`) e decimal (`1111`). Isso resulta em um identificador completo e √∫nico para pepe dentro do dom√≠nio como: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **Enumera√ß√£o com rpcclient**

O utilit√°rio **`rpcclient`** do Samba √© utilizado para interagir com **pontos finais RPC atrav√©s de pipes nomeados**. Abaixo est√£o os comandos que podem ser emitidos para as interfaces SAMR, LSARPC e LSARPC-DS ap√≥s uma **sess√£o SMB ser estabelecida**, frequentemente necessitando de credenciais.

#### Informa√ß√µes do Servidor

* Para obter **Informa√ß√µes do Servidor**: o comando `srvinfo` √© utilizado.

#### Enumera√ß√£o de Usu√°rios

* **Usu√°rios podem ser listados** usando: `querydispinfo` e `enumdomusers`.
* **Detalhes de um usu√°rio** por: `queryuser <0xrid>`.
* **Grupos de um usu√°rio** com: `queryusergroups <0xrid>`.
* **O SID de um usu√°rio √© recuperado** atrav√©s de: `lookupnames <username>`.
* **Aliases de usu√°rios** por: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Enumera√ß√£o de Grupos

* **Grupos** por: `enumdomgroups`.
* **Detalhes de um grupo** com: `querygroup <0xrid>`.
* **Membros de um grupo** atrav√©s de: `querygroupmem <0xrid>`.

#### Enumera√ß√£o de Grupos de Alias

* **Grupos de alias** por: `enumalsgroups <builtin|domain>`.
* **Membros de um grupo de alias** com: `queryaliasmem builtin|domain <0xrid>`.

#### Enumera√ß√£o de Dom√≠nios

* **Dom√≠nios** usando: `enumdomains`.
* **O SID de um dom√≠nio √© recuperado** atrav√©s de: `lsaquery`.
* **Informa√ß√µes do dom√≠nio s√£o obtidas** por: `querydominfo`.

#### Enumera√ß√£o de Compartilhamentos

* **Todos os compartilhamentos dispon√≠veis** por: `netshareenumall`.
* **Informa√ß√µes sobre um compartilhamento espec√≠fico s√£o obtidas** com: `netsharegetinfo <share>`.

#### Opera√ß√µes Adicionais com SIDs

* **SIDs por nome** usando: `lookupnames <username>`.
* **Mais SIDs** atrav√©s de: `lsaenumsid`.
* **Ciclo RID para verificar mais SIDs** √© realizado por: `lookupsids <sid>`.

#### **Comandos extras**

| **Comando**         | **Interface**                                                                                                                                     | **Descri√ß√£o**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Recuperar informa√ß√µes do usu√°rio                                                                                                         |
| querygroup          | Recuperar informa√ß√µes do grupo                                                                                                                   |                                                                                                                                           |
| querydominfo        | Recuperar informa√ß√µes do dom√≠nio                                                                                                                  |                                                                                                                                           |
| enumdomusers        | Enumerar usu√°rios do dom√≠nio                                                                                                                     |                                                                                                                                           |
| enumdomgroups       | Enumerar grupos do dom√≠nio                                                                                                                      |                                                                                                                                           |
| createdomuser       | Criar um usu√°rio do dom√≠nio                                                                                                                      |                                                                                                                                           |
| deletedomuser       | Deletar um usu√°rio do dom√≠nio                                                                                                                    |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Procurar nomes de usu√°rios para valores SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) |
| lookupsids          | Procurar SIDs para nomes de usu√°rios (ciclo RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)) |                                                                                                                                           |
| lsaaddacctrights    | Adicionar direitos a uma conta de usu√°rio                                                                                                         |                                                                                                                                           |
| lsaremoveacctrights | Remover direitos de uma conta de usu√°rio                                                                                                          |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Obter informa√ß√µes do dom√≠nio prim√°rio                                                                                                   |
| dsenumdomtrusts     | Enumerar dom√≠nios confi√°veis dentro de uma floresta AD                                                                                           |                                                                                                                                           |

Para **entender** melhor como as ferramentas _**samrdump**_ **e** _**rpcdump**_ funcionam, voc√™ deve ler [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
