# rpcclient enumeration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

### Overview of Relative Identifiers (RID) and Security Identifiers (SID)

**Relative Identifiers (RID)** ÎºÎ±Î¹ **Security Identifiers (SID)** ÎµÎ¯Î½Î±Î¹ Î²Î±ÏƒÎ¹ÎºÎ¬ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÏ„Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ¬ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± Windows Î³Î¹Î± Ï„Î·Î½ Î¼Î¿Î½Î±Î´Î¹ÎºÎ® Î±Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Ï‰Î½, ÏŒÏ€Ï‰Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÎºÎ±Î¹ Î¿Î¼Î¬Î´ÎµÏ‚, ÎµÎ½Ï„ÏŒÏ‚ ÎµÎ½ÏŒÏ‚ Î´Î¹ÎºÏ„ÏÎ¿Ï….

- **SIDs** Ï‡ÏÎ·ÏƒÎ¹Î¼ÎµÏÎ¿Ï…Î½ Ï‰Ï‚ Î¼Î¿Î½Î±Î´Î¹ÎºÎ¿Î¯ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î­Ï‚ Î³Î¹Î± Ï„Î¿Î¼ÎµÎ¯Ï‚, Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶Î¿Î½Ï„Î±Ï‚ ÏŒÏ„Î¹ ÎºÎ¬Î¸Îµ Ï„Î¿Î¼Î­Î±Ï‚ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±ÎºÏÎ¹Ï„ÏŒÏ‚.
- **RIDs** Ï€ÏÎ¿ÏƒÏ„Î¯Î¸ÎµÎ½Ï„Î±Î¹ ÏƒÏ„Î± SIDs Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î½ Î¼Î¿Î½Î±Î´Î¹ÎºÎ¿ÏÏ‚ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î­Ï‚ Î³Î¹Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± ÎµÎ½Ï„ÏŒÏ‚ Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ Ï„Î¿Î¼Î­Ï‰Î½. Î‘Ï…Ï„Î® Î· ÏƒÏ…Î½Î´Ï…Î±ÏƒÏ„Î¹ÎºÎ® Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±ÎºÏÎ¹Î²Î® Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÎºÎ±Î¹ Ï„Ï‰Î½ ÎµÎ»Î­Î³Ï‡Ï‰Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï„Ï‰Î½ Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Ï‰Î½.

Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î­Î½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¼Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± `pepe` Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Î­Î½Î±Î½ Î¼Î¿Î½Î±Î´Î¹ÎºÏŒ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î® Ï€Î¿Ï… ÏƒÏ…Î½Î´Ï…Î¬Î¶ÎµÎ¹ Ï„Î¿ SID Ï„Î¿Ï… Ï„Î¿Î¼Î­Î± Î¼Îµ Ï„Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ RID Ï„Î¿Ï…, Ï€Î¿Ï… Î±Î½Î±Ï€Î±ÏÎ¯ÏƒÏ„Î±Ï„Î±Î¹ Ï„ÏŒÏƒÎ¿ ÏƒÎµ Î´ÎµÎºÎ±ÎµÎ¾Î±Î´Î¹ÎºÎ® (`0x457`) ÏŒÏƒÎ¿ ÎºÎ±Î¹ ÏƒÎµ Î´ÎµÎºÎ±Î´Î¹ÎºÎ® (`1111`) Î¼Î¿ÏÏ†Î®. Î‘Ï…Ï„ÏŒ Î­Ï‡ÎµÎ¹ Ï‰Ï‚ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Î­Î½Î±Î½ Ï€Î»Î®ÏÎ· ÎºÎ±Î¹ Î¼Î¿Î½Î±Î´Î¹ÎºÏŒ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î® Î³Î¹Î± Ï„Î¿Î½ pepe ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… Ï„Î¿Î¼Î­Î± ÏŒÏ€Ï‰Ï‚: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **Enumeration with rpcclient**

Î¤Î¿ **`rpcclient`** ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î±Ï€ÏŒ Ï„Î¿ Samba Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ Î±Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Î¼Îµ **RPC endpoints Î¼Î­ÏƒÏ‰ Î¿Î½Î¿Î¼Î±ÏƒÎ¼Î­Î½Ï‰Î½ ÏƒÏ‰Î»Î®Î½Ï‰Î½**. Î Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ ÎµÎ½Ï„Î¿Î»Î­Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎºÎ´Î¿Î¸Î¿ÏÎ½ ÏƒÏ„Î¹Ï‚ Î´Î¹ÎµÏ€Î±Ï†Î­Ï‚ SAMR, LSARPC ÎºÎ±Î¹ LSARPC-DS Î±Ï†Î¿Ï Î­Ï‡ÎµÎ¹ **Î¹Î´ÏÏ…Î¸ÎµÎ¯ Î¼Î¹Î± ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± SMB**, ÏƒÏ…Ï‡Î½Î¬ Î±Ï€Î±Î¹Ï„ÏÎ½Ï„Î±Ï‚ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±.

#### Server Information

* Î“Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ **Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î”Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®**: Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î· ÎµÎ½Ï„Î¿Î»Î® `srvinfo`.

#### Enumeration of Users

* **ÎŸÎ¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î¿ÏÎ½** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚: `querydispinfo` ÎºÎ±Î¹ `enumdomusers`.
* **Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÎµÎ½ÏŒÏ‚ Ï‡ÏÎ®ÏƒÏ„Î·** Î¼Îµ: `queryuser <0xrid>`.
* **ÎŸÎ¼Î¬Î´ÎµÏ‚ ÎµÎ½ÏŒÏ‚ Ï‡ÏÎ®ÏƒÏ„Î·** Î¼Îµ: `queryusergroups <0xrid>`.
* **Î¤Î¿ SID ÎµÎ½ÏŒÏ‚ Ï‡ÏÎ®ÏƒÏ„Î· Î±Î½Î±ÎºÏ„Î¬Ï„Î±Î¹** Î¼Î­ÏƒÏ‰: `lookupnames <username>`.
* **Î¨ÎµÏ…Î´ÏÎ½Ï…Î¼Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½** Î¼Îµ: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Enumeration of Groups

* **Groups** by: `enumdomgroups`.
* **Details of a group** with: `querygroup <0xrid>`.
* **Members of a group** through: `querygroupmem <0xrid>`.

#### Enumeration of Alias Groups

* **Alias groups** by: `enumalsgroups <builtin|domain>`.
* **Members of an alias group** with: `queryaliasmem builtin|domain <0xrid>`.

#### Enumeration of Domains

* **Domains** using: `enumdomains`.
* **A domain's SID is retrieved** through: `lsaquery`.
* **Domain information is obtained** by: `querydominfo`.

#### Enumeration of Shares

* **All available shares** by: `netshareenumall`.
* **Information about a specific share is fetched** with: `netsharegetinfo <share>`.

#### Additional Operations with SIDs

* **SIDs by name** using: `lookupnames <username>`.
* **More SIDs** through: `lsaenumsid`.
* **RID cycling to check more SIDs** is performed by: `lookupsids <sid>`.

#### **Extra commands**

| **Command**         | **Interface**                                                                                                                                     | **Description**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ· Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Ï‡ÏÎ®ÏƒÏ„Î·                                                                                                             |
| querygroup          | Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ· Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Î¿Î¼Î¬Î´Î±Ï‚                                                                                                                     |                                                                                                                                           |
| querydominfo        | Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ· Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Ï„Î¿Î¼Î­Î±                                                                                                                      |                                                                                                                                           |
| enumdomusers        | ÎšÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Ï„Î¿Î¼Î­Î±                                                                                                                        |                                                                                                                                           |
| enumdomgroups       | ÎšÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· Î¿Î¼Î¬Î´Ï‰Î½ Ï„Î¿Î¼Î­Î±                                                                                                                         |                                                                                                                                           |
| createdomuser       | Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï‡ÏÎ®ÏƒÏ„Î· Ï„Î¿Î¼Î­Î±                                                                                                                          |                                                                                                                                           |
| deletedomuser       | Î”Î¹Î±Î³ÏÎ±Ï†Î® Ï‡ÏÎ®ÏƒÏ„Î· Ï„Î¿Î¼Î­Î±                                                                                                                            |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ ÏƒÎµ SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) Ï„Î¹Î¼Î­Ï‚ |
| lookupsids          | Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· SIDs ÏƒÎµ Î¿Î½ÏŒÎ¼Î±Ï„Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½ (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) cycling) |                                                                                                                                           |
| lsaaddacctrights    | Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÏƒÎµ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Ï‡ÏÎ®ÏƒÏ„Î·                                                                                                        |                                                                                                                                           |
| lsaremoveacctrights | Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Î±Ï€ÏŒ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Ï‡ÏÎ®ÏƒÏ„Î·                                                                                                       |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Î›Î®ÏˆÎ· Ï€ÏÏ‰Ï„Î¿Î³ÎµÎ½ÏÎ½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Ï„Î¿Î¼Î­Î±                                                                                                        |
| dsenumdomtrusts     | ÎšÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Ï‰Î½ Ï„Î¿Î¼Î­Ï‰Î½ ÎµÎ½Ï„ÏŒÏ‚ ÎµÎ½ÏŒÏ‚ AD Î´Î¬ÏƒÎ¿Ï…Ï‚                                                                                                 |                                                                                                                                           |

To **understand** better how the tools _**samrdump**_ **and** _**rpcdump**_ works you should read [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
