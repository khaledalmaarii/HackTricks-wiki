# rpcclient enumeration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Relative Identifiers (RID) рдФрд░ Security Identifiers (SID) рдХрд╛ рдЕрд╡рд▓реЛрдХрди

**Relative Identifiers (RID)** рдФрд░ **Security Identifiers (SID)** Windows рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдиреЗрдЯрд╡рд░реНрдХ рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рд╕рдореВрд╣реЛрдВ рдЬреИрд╕реЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреА рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рди рдФрд░ рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП рдкреНрд░рдореБрдЦ рдШрдЯрдХ рд╣реИрдВред

- **SIDs** рдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реИрдВ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдбреЛрдореЗрди рдЕрд▓рдЧ рд╣реИред
- **RIDs** рдХреЛ SIDs рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрди рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдмрдирд╛рдП рдЬрд╛ рд╕рдХреЗрдВред рдпрд╣ рд╕рдВрдпреЛрдЬрди рдСрдмреНрдЬреЗрдХреНрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдФрд░ рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд╕рдЯреАрдХ рдЯреНрд░реИрдХрд┐рдВрдЧ рдФрд░ рдкреНрд░рдмрдВрдзрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо `pepe` рд╣реИ, рдЙрд╕рдХреЗ рдкрд╛рд╕ рдбреЛрдореЗрди рдХреЗ SID рдХреЗ рд╕рд╛рде рдЙрд╕рдХреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ RID рдХреЛ рдорд┐рд▓рд╛рдХрд░ рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ (`0x457`) рдФрд░ рджрд╢рдорд▓рд╡ (`1111`) рдкреНрд░рд╛рд░реВрдкреЛрдВ рдореЗрдВ рджрд░реНрд╢рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ pepe рдХреЗ рд▓рд┐рдП рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рдПрдХ рдкреВрд░реНрдг рдФрд░ рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИ рдЬреИрд╕реЗ: `S-1-5-21-1074507654-1937615267-42093643874-1111`ред

### **rpcclient рдХреЗ рд╕рд╛рде Enumeration**

Samba рдХрд╛ **`rpcclient`** рдЙрдкрдпреЛрдЧрд┐рддрд╛ **RPC endpoints рдХреЗ рд╕рд╛рде рдирд╛рдорд┐рдд рдкрд╛рдЗрдк рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИред рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХрдорд╛рдВрдб SAMR, LSARPC, рдФрд░ LSARPC-DS рдЗрдВрдЯрд░рдлреЗрд╕ рдкрд░ рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдм рдПрдХ **SMB рд╕рддреНрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**, рдЬреЛ рдЕрдХреНрд╕рд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

#### рд╕рд░реНрд╡рд░ рдЬрд╛рдирдХрд╛рд░реА

* **рд╕рд░реНрд╡рд░ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**: `srvinfo` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

#### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА Enumeration

* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**: `querydispinfo` рдФрд░ `enumdomusers` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред
* **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг**: `queryuser <0xrid>` рджреНрд╡рд╛рд░рд╛ред
* **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдореВрд╣**: `queryusergroups <0xrid>` рдХреЗ рд╕рд╛рдеред
* **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ SID рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**: `lookupnames <username>` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдЙрдкрдирд╛рдо**: `queryuseraliases [builtin|domain] <sid>` рджреНрд╡рд╛рд░рд╛ред
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### рд╕рдореВрд╣реЛрдВ рдХреА рдЧрдгрдирд╛

* **рд╕рдореВрд╣** рджреНрд╡рд╛рд░рд╛: `enumdomgroups`.
* **рдПрдХ рд╕рдореВрд╣ рдХрд╛ рд╡рд┐рд╡рд░рдг** рдХреЗ рд╕рд╛рде: `querygroup <0xrid>`.
* **рдПрдХ рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ: `querygroupmem <0xrid>`.

#### рдЙрдкрдирд╛рдо рд╕рдореВрд╣реЛрдВ рдХреА рдЧрдгрдирд╛

* **рдЙрдкрдирд╛рдо рд╕рдореВрд╣** рджреНрд╡рд╛рд░рд╛: `enumalsgroups <builtin|domain>`.
* **рдПрдХ рдЙрдкрдирд╛рдо рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп** рдХреЗ рд╕рд╛рде: `queryaliasmem builtin|domain <0xrid>`.

#### рдбреЛрдореЗрди рдХреА рдЧрдгрдирд╛

* **рдбреЛрдореЗрди** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ: `enumdomains`.
* **рдПрдХ рдбреЛрдореЗрди рдХрд╛ SID рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ: `lsaquery`.
* **рдбреЛрдореЗрди рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛рддреА рд╣реИ** рджреНрд╡рд╛рд░рд╛: `querydominfo`.

#### рд╢реЗрдпрд░реЛрдВ рдХреА рдЧрдгрдирд╛

* **рд╕рднреА рдЙрдкрд▓рдмреНрдз рд╢реЗрдпрд░** рджреНрд╡рд╛рд░рд╛: `netshareenumall`.
* **рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╢реЗрдпрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛рддреА рд╣реИ** рдХреЗ рд╕рд╛рде: `netsharegetinfo <share>`.

#### SIDs рдХреЗ рд╕рд╛рде рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдВрдЪрд╛рд▓рди

* **рдирд╛рдо рджреНрд╡рд╛рд░рд╛ SIDs** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ: `lookupnames <username>`.
* **рдЕрдзрд┐рдХ SIDs** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ: `lsaenumsid`.
* **рдЕрдзрд┐рдХ SIDs рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП RID рд╕рд╛рдЗрдХреНрд▓рд┐рдВрдЧ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: `lookupsids <sid>`.

#### **рдЕрддрд┐рд░рд┐рдХреНрдд рдХрдорд╛рдВрдб**

| **рдХрдорд╛рдВрдб**           | **рдЗрдВрдЯрд░рдлреЗрд╕**                                                                                                                                     | **рд╡рд┐рд╡рд░рдг**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                                                                                                                 |
| querygroup          | рд╕рдореВрд╣ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                                                                                                                        |                                                                                                                                           |
| querydominfo        | рдбреЛрдореЗрди рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                                                                                                                       |                                                                                                                                           |
| enumdomusers        | рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | рдбреЛрдореЗрди рд╕рдореВрд╣реЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ                                                                                                                           |                                                                                                                                           |
| createdomuser       | рдПрдХ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдПрдВ                                                                                                                              |                                                                                                                                           |
| deletedomuser       | рдПрдХ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣рдЯрд╛рдПрдВ                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЛ SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) рдорд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ |
| lookupsids          | рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП SIDs рджреЗрдЦреЗрдВ (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) рд╕рд╛рдЗрдХреНрд▓рд┐рдВрдЧ) |                                                                                                                                           |
| lsaaddacctrights    | рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЗ рдореЗрдВ рдЕрдзрд┐рдХрд╛рд░ рдЬреЛрдбрд╝реЗрдВ                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЗ рд╕реЗ рдЕрдзрд┐рдХрд╛рд░ рд╣рдЯрд╛рдПрдВ                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | рдкреНрд░рд╛рдердорд┐рдХ рдбреЛрдореЗрди рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ                                                                                                            |
| dsenumdomtrusts     | рдПрдХ AD рд╡рди рдореЗрдВ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрдиреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ                                                                                                     |                                                                                                                                           |

**рд╕рдордЭрдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐ рдЙрдкрдХрд░рдг _**samrdump**_ **рдФрд░** _**rpcdump**_ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдЖрдкрдХреЛ [**Pentesting MSRPC**](../135-pentesting-msrpc.md) рдкрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдПред

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
