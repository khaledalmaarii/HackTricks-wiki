# rpcclientæšä¸¾

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> - <a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿ æƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Ÿ æˆ–è€…æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Ÿ è¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTsæ”¶è—å“**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã€‚
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)ã€‚
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– **ç”µæŠ¥ç¾¤ç»„** æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘**ğŸ¦**[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

å‘ç°æœ€é‡è¦çš„æ¼æ´ï¼Œä»¥ä¾¿æ›´å¿«ä¿®å¤ã€‚Intruderè·Ÿè¸ªæ‚¨çš„æ”»å‡»é¢ï¼Œè¿è¡Œä¸»åŠ¨å¨èƒæ‰«æï¼Œå‘ç°æ•´ä¸ªæŠ€æœ¯å †æ ˆä¸­çš„é—®é¢˜ï¼Œä»APIåˆ°Webåº”ç”¨ç¨‹åºå’Œäº‘ç³»ç»Ÿã€‚[**ç«‹å³å…è´¹è¯•ç”¨**](https://www.intruder.io/?utm_source=referral\&utm_campaign=hacktricks)ã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **ä»€ä¹ˆæ˜¯RID**

[ç›¸å¯¹æ ‡è¯†ç¬¦ï¼ˆRIDï¼‰](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers)æ˜¯Windowsç”¨äº**è·Ÿè¸ªå’Œè¯†åˆ«å¯¹è±¡**çš„**å”¯ä¸€æ ‡è¯†ç¬¦**ï¼ˆä»¥åå…­è¿›åˆ¶æ ¼å¼è¡¨ç¤ºï¼‰ã€‚ä¸ºäº†è§£é‡Šå…¶ä½œç”¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼š

* NAME\_DOMAIN.LOCALåŸŸçš„[SID](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers)æ˜¯ï¼š`S-1-5-21-1038751438-1834703946-36937684957`ã€‚
* å½“åœ¨åŸŸä¸­åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¸Šè¿°æ•°å­—ï¼ˆSIDï¼‰å°†ä¸RIDç»„åˆï¼Œä»¥ç”Ÿæˆç”¨äºè¡¨ç¤ºå¯¹è±¡çš„å”¯ä¸€å€¼ã€‚
* å› æ­¤ï¼ŒåŸŸç”¨æˆ·`john`çš„RIDï¼š\[0x457] åå…­è¿›åˆ¶0x457å°†ç­‰äºåè¿›åˆ¶`1111`ï¼Œå°†å…·æœ‰å®Œæ•´çš„ç”¨æˆ·SIDï¼š`S-1-5-21-1038751438-1834703946-36937684957-1111`ã€‚
* è¿™æ˜¯åœ¨NAME\_DOMAIN.LOCALåŸŸä¸­å”¯ä¸€çš„`john`å¯¹è±¡ï¼Œæ‚¨æ°¸è¿œä¸ä¼šçœ‹åˆ°æ­¤é…å¯¹å€¼ä¸è¯¥åŸŸæˆ–ä»»ä½•å…¶ä»–åŸŸä¸­çš„å¦ä¸€ä¸ªå¯¹è±¡ç›¸å…³è”ã€‚

æ¥è‡ª[**æ­¤å¤„**](https://academy.hackthebox.com/module/143/section/1269)çš„å®šä¹‰ã€‚

### **ä½¿ç”¨rpcclientè¿›è¡Œæšä¸¾**

æ¥è‡ªSambaçš„**`rpcclient`**å®ç”¨ç¨‹åºç”¨äºé€šè¿‡å‘½åç®¡é“ä¸**RPCç«¯ç‚¹è¿›è¡Œäº¤äº’**ã€‚åœ¨**å»ºç«‹SMBä¼šè¯**åï¼Œé€šå¸¸éœ€è¦å‡­æ®ï¼Œå¯ä»¥å‘å‡ºä»¥ä¸‹å‘½ä»¤åˆ°SAMRã€LSARPCå’ŒLSARPC-DSæ¥å£ã€‚

#### æœåŠ¡å™¨ä¿¡æ¯

* è¦è·å–**æœåŠ¡å™¨ä¿¡æ¯**ï¼šä½¿ç”¨`srvinfo`å‘½ä»¤ã€‚

#### ç”¨æˆ·æšä¸¾

* ä½¿ç”¨`querydispinfo`å’Œ`enumdomusers`å¯ä»¥**åˆ—å‡ºç”¨æˆ·**ã€‚
* é€šè¿‡`queryuser <0xrid>`å¯ä»¥æŸ¥çœ‹**ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯**ã€‚
* ä½¿ç”¨`queryusergroups <0xrid>`å¯ä»¥æŸ¥çœ‹**ç”¨æˆ·çš„ç»„**ã€‚
* é€šè¿‡`lookupnames <username>`å¯ä»¥æ£€ç´¢**ç”¨æˆ·çš„SID**ã€‚
* ä½¿ç”¨`queryuseraliases [builtin|domain] <sid>`å¯ä»¥æŸ¥çœ‹**ç”¨æˆ·çš„åˆ«å**ã€‚
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### æšä¸¾ç»„

* ä½¿ç”¨`enumdomgroups`æ¥æšä¸¾**ç»„**ã€‚
* ä½¿ç”¨`querygroup <0xrid>`æ¥è·å–**ç»„çš„è¯¦ç»†ä¿¡æ¯**ã€‚
* é€šè¿‡`querygroupmem <0xrid>`æ¥æŸ¥çœ‹**ç»„çš„æˆå‘˜**ã€‚

#### æšä¸¾åˆ«åç»„

* ä½¿ç”¨`enumalsgroups <builtin|domain>`æ¥æšä¸¾**åˆ«åç»„**ã€‚
* ä½¿ç”¨`queryaliasmem builtin|domain <0xrid>`æ¥æŸ¥çœ‹**åˆ«åç»„çš„æˆå‘˜**ã€‚

#### æšä¸¾åŸŸ

* ä½¿ç”¨`enumdomains`æ¥æšä¸¾**åŸŸ**ã€‚
* é€šè¿‡`lsaquery`æ¥æ£€ç´¢**åŸŸçš„SID**ã€‚
* ä½¿ç”¨`querydominfo`æ¥è·å–**åŸŸä¿¡æ¯**ã€‚

#### æšä¸¾å…±äº«

* ä½¿ç”¨`netshareenumall`æ¥æšä¸¾**æ‰€æœ‰å¯ç”¨å…±äº«**ã€‚
* ä½¿ç”¨`netsharegetinfo <share>`æ¥è·å–**ç‰¹å®šå…±äº«çš„ä¿¡æ¯**ã€‚

#### ä½¿ç”¨SIDçš„é™„åŠ æ“ä½œ

* ä½¿ç”¨`lookupnames <username>`æ¥æ ¹æ®åç§°æŸ¥æ‰¾**SID**ã€‚
* é€šè¿‡`lsaenumsid`æ¥è·å–**æ›´å¤šSID**ã€‚
* ä½¿ç”¨`lookupsids <sid>`è¿›è¡Œ**RIDå¾ªç¯**ä»¥æ£€æŸ¥æ›´å¤šSIDã€‚

#### **é¢å¤–å‘½ä»¤**

| **å‘½ä»¤**             | **æ¥å£**                                                                                                                                     | **æè¿°**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | æ£€ç´¢ç”¨æˆ·ä¿¡æ¯                                                                                                                 |
| querygroup          | æ£€ç´¢ç»„ä¿¡æ¯                                                                                                                        |                                                                                                                                           |
| querydominfo        | æ£€ç´¢åŸŸä¿¡æ¯                                                                                                                       |                                                                                                                                           |
| enumdomusers        | æšä¸¾åŸŸç”¨æˆ·                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | æšä¸¾åŸŸç»„                                                                                                                           |                                                                                                                                           |
| createdomuser       | åˆ›å»ºåŸŸç”¨æˆ·                                                                                                                              |                                                                                                                                           |
| deletedomuser       | åˆ é™¤åŸŸç”¨æˆ·                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | æŸ¥æ‰¾ç”¨æˆ·ååˆ°SIDçš„å€¼                                                                                                                 |
| lookupsids          | æŸ¥æ‰¾SIDåˆ°ç”¨æˆ·åï¼ˆRIDå¾ªç¯ï¼‰                                                                                                                 |                                                                                                                                           |
| lsaaddacctrights    | ä¸ºç”¨æˆ·å¸æˆ·æ·»åŠ æƒé™                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | ä»ç”¨æˆ·å¸æˆ·ä¸­åˆ é™¤æƒé™                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | è·å–ä¸»åŸŸä¿¡æ¯                                                                                                            |
| dsenumdomtrusts     | æšä¸¾ADæ£®æ—ä¸­çš„å—ä¿¡ä»»åŸŸ                                                                                                     |                                                                                                                                           |

è¦æ›´å¥½åœ°äº†è§£å·¥å…·**samrdump**å’Œ**rpcdump**çš„å·¥ä½œåŸç†ï¼Œè¯·é˜…è¯»[**Pentesting MSRPC**](../135-pentesting-msrpc.md)ã€‚

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

æ‰¾åˆ°æœ€é‡è¦çš„æ¼æ´ï¼Œä»¥ä¾¿æ›´å¿«ä¿®å¤ã€‚Intruderè·Ÿè¸ªæ‚¨çš„æ”»å‡»é¢ï¼Œè¿è¡Œä¸»åŠ¨å¨èƒæ‰«æï¼Œå‘ç°æ•´ä¸ªæŠ€æœ¯å †æ ˆä¸­çš„é—®é¢˜ï¼Œä»APIåˆ°Webåº”ç”¨ç¨‹åºå’Œäº‘ç³»ç»Ÿã€‚[**ç«‹å³å…è´¹è¯•ç”¨**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆçš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTsæ”¶è—å“**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã€‚
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)ã€‚
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **Discordç¾¤**](https://discord.gg/hRep4RUj7f)æˆ–**ç”µæŠ¥ç¾¤**æˆ–åœ¨**Twitter**ä¸Š**ğŸ¦**[**@carlospolopm**](https://twitter.com/hacktricks_live)**ä¸Šå…³æ³¨**æˆ‘ã€‚
* é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
