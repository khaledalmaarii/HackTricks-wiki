# rpcclientæšä¸¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿ æƒ³è¦çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**å—ï¼Ÿ æˆ–è€…æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿ è¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[NFTæ”¶è—å“](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

### ç›¸å¯¹æ ‡è¯†ç¬¦ï¼ˆRIDï¼‰å’Œå®‰å…¨æ ‡è¯†ç¬¦ï¼ˆSIDï¼‰æ¦‚è¿°

**ç›¸å¯¹æ ‡è¯†ç¬¦ï¼ˆRIDï¼‰**å’Œ**å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆSIDï¼‰**æ˜¯Windowsæ“ä½œç³»ç»Ÿä¸­ç”¨äºå”¯ä¸€æ ‡è¯†å’Œç®¡ç†ç½‘ç»œåŸŸå†…å¯¹è±¡ï¼ˆå¦‚ç”¨æˆ·å’Œç»„ï¼‰çš„å…³é”®ç»„ä»¶ã€‚

- **SIDs** ç”¨ä½œåŸŸçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç¡®ä¿æ¯ä¸ªåŸŸéƒ½æ˜¯å¯åŒºåˆ†çš„ã€‚
- **RIDs** é™„åŠ åˆ°SIDsä»¥åˆ›å»ºè¿™äº›åŸŸå†…å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚æ­¤ç»„åˆå…è®¸å¯¹å¯¹è±¡æƒé™å’Œè®¿é—®æ§åˆ¶è¿›è¡Œç²¾ç¡®è·Ÿè¸ªå’Œç®¡ç†ã€‚

ä¾‹å¦‚ï¼Œåä¸º`pepe`çš„ç”¨æˆ·å¯èƒ½å…·æœ‰å°†åŸŸçš„SIDä¸å…¶ç‰¹å®šRIDç»“åˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä»¥åå…­è¿›åˆ¶ï¼ˆ`0x457`ï¼‰å’Œåè¿›åˆ¶ï¼ˆ`1111`ï¼‰æ ¼å¼è¡¨ç¤ºã€‚è¿™å¯¼è‡´åœ¨åŸŸå†…pepeçš„å®Œæ•´ä¸”å”¯ä¸€æ ‡è¯†ç¬¦å¦‚ä¸‹ï¼š`S-1-5-21-1074507654-1937615267-42093643874-1111`ã€‚


### ä½¿ç”¨rpcclientè¿›è¡Œæšä¸¾

æ¥è‡ªSambaçš„**`rpcclient`**å®ç”¨ç¨‹åºç”¨äºé€šè¿‡å‘½åç®¡é“ä¸**RPCç«¯ç‚¹è¿›è¡Œäº¤äº’**ã€‚åœ¨**å»ºç«‹SMBä¼šè¯**åï¼Œé€šå¸¸éœ€è¦å‡­æ®ï¼Œå¯ä»¥å‘å‡ºä»¥ä¸‹å‘½ä»¤åˆ°SAMRã€LSARPCå’ŒLSARPC-DSæ¥å£ã€‚

#### æœåŠ¡å™¨ä¿¡æ¯

* è¦è·å–**æœåŠ¡å™¨ä¿¡æ¯**ï¼šä½¿ç”¨`srvinfo`å‘½ä»¤ã€‚

#### ç”¨æˆ·æšä¸¾

* ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤**åˆ—å‡ºç”¨æˆ·**ï¼š`querydispinfo`å’Œ`enumdomusers`ã€‚
* é€šè¿‡ï¼š`queryuser <0xrid>`æŸ¥çœ‹**ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯**ã€‚
* ä½¿ç”¨`queryusergroups <0xrid>`æŸ¥çœ‹**ç”¨æˆ·çš„ç»„**ã€‚
* é€šè¿‡ï¼š`lookupnames <username>`æ£€ç´¢**ç”¨æˆ·çš„SID**ã€‚
* ä½¿ç”¨`queryuseraliases [builtin|domain] <sid>`æŸ¥çœ‹**ç”¨æˆ·çš„åˆ«å**ã€‚
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### æšä¸¾ç»„

- é€šè¿‡`enumdomgroups`è·å–**ç»„**ã€‚
- ä½¿ç”¨`querygroup <0xrid>`è·å–**ç»„çš„è¯¦ç»†ä¿¡æ¯**ã€‚
- é€šè¿‡`querygroupmem <0xrid>`æŸ¥çœ‹**ç»„çš„æˆå‘˜**ã€‚

#### æšä¸¾åˆ«åç»„

- ä½¿ç”¨`enumalsgroups <builtin|domain>`æšä¸¾**åˆ«åç»„**ã€‚
- é€šè¿‡`queryaliasmem builtin|domain <0xrid>`æŸ¥çœ‹**åˆ«åç»„çš„æˆå‘˜**ã€‚

#### æšä¸¾åŸŸ

- ä½¿ç”¨`enumdomains`æ¥æšä¸¾**åŸŸ**ã€‚
- é€šè¿‡`lsaquery`æ£€ç´¢**åŸŸçš„SID**ã€‚
- ä½¿ç”¨`querydominfo`è·å–**åŸŸä¿¡æ¯**ã€‚

#### æšä¸¾å…±äº«

- é€šè¿‡`netshareenumall`è·å–**æ‰€æœ‰å¯ç”¨å…±äº«**ã€‚
- ä½¿ç”¨`netsharegetinfo <share>`è·å–ç‰¹å®šå…±äº«çš„**ä¿¡æ¯**ã€‚

#### ä½¿ç”¨SIDçš„é™„åŠ æ“ä½œ

- ä½¿ç”¨`lookupnames <username>`æŒ‰åç§°æŸ¥æ‰¾**SIDs**ã€‚
- é€šè¿‡`lsaenumsid`è·å–**æ›´å¤šSIDs**ã€‚
- ä½¿ç”¨`lookupsids <sid>`æ‰§è¡Œ**RIDå¾ªç¯**ä»¥æ£€æŸ¥æ›´å¤š**SIDs**ã€‚

#### **é¢å¤–å‘½ä»¤**

| **å‘½ä»¤**             | **æ¥å£**                                                                                                                                     | **æè¿°**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | æ£€ç´¢ç”¨æˆ·ä¿¡æ¯                                                                                                                 |
| querygroup          | æ£€ç´¢ç»„ä¿¡æ¯                                                                                                                        |                                                                                                                                           |
| querydominfo        | æ£€ç´¢åŸŸä¿¡æ¯                                                                                                                       |                                                                                                                                           |
| enumdomusers        | æšä¸¾åŸŸç”¨æˆ·                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | æšä¸¾åŸŸç»„                                                                                                                           |                                                                                                                                           |
| createdomuser       | åˆ›å»ºåŸŸç”¨æˆ·                                                                                                                              |                                                                                                                                           |
| deletedomuser       | åˆ é™¤åŸŸç”¨æˆ·                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | æŸ¥æ‰¾ç”¨æˆ·ååˆ°SIDçš„å€¼                                                                                                                 |
| lookupsids          | æŸ¥æ‰¾SIDsåˆ°ç”¨æˆ·åï¼ˆRIDå¾ªç¯ï¼‰                                                                                                                                           |                                                                                                                                           |
| lsaaddacctrights    | ä¸ºç”¨æˆ·å¸æˆ·æ·»åŠ æƒé™                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | ä»ç”¨æˆ·å¸æˆ·ä¸­åˆ é™¤æƒé™                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | è·å–ä¸»åŸŸä¿¡æ¯                                                                                                            |
| dsenumdomtrusts     | æšä¸¾ADæ£®æ—ä¸­çš„å—ä¿¡ä»»åŸŸ                                                                                                     |                                                                                                                                           |

è¦æ›´å¥½åœ°äº†è§£å·¥å…·**samrdump**å’Œ**rpcdump**çš„å·¥ä½œåŸç†ï¼Œè¯·é˜…è¯»[**Pentesting MSRPC**](../135-pentesting-msrpc.md)ã€‚

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­è¢«å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTricksè¡£æœ**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
