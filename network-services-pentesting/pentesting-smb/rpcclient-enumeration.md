# rpcclient enumeration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### ç›¸å…³æ ‡è¯†ç¬¦ (RID) å’Œå®‰å…¨æ ‡è¯†ç¬¦ (SID) æ¦‚è¿°

**ç›¸å¯¹æ ‡è¯†ç¬¦ (RID)** å’Œ **å®‰å…¨æ ‡è¯†ç¬¦ (SID)** æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸­ç”¨äºå”¯ä¸€æ ‡è¯†å’Œç®¡ç†ç½‘ç»œåŸŸå†…å¯¹è±¡ï¼ˆå¦‚ç”¨æˆ·å’Œç»„ï¼‰çš„å…³é”®ç»„ä»¶ã€‚

- **SID** ä½œä¸ºåŸŸçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç¡®ä¿æ¯ä¸ªåŸŸéƒ½æ˜¯å¯åŒºåˆ†çš„ã€‚
- **RID** é™„åŠ åˆ° SID ä¸Šï¼Œä»¥åˆ›å»ºè¯¥åŸŸå†…å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚è¿™ç§ç»„åˆå…è®¸ç²¾ç¡®è·Ÿè¸ªå’Œç®¡ç†å¯¹è±¡æƒé™å’Œè®¿é—®æ§åˆ¶ã€‚

ä¾‹å¦‚ï¼Œä¸€ä¸ªåä¸º `pepe` çš„ç”¨æˆ·å¯èƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè¯¥æ ‡è¯†ç¬¦ç»“åˆäº†åŸŸçš„ SID å’Œä»–çš„ç‰¹å®š RIDï¼Œä»¥åå…­è¿›åˆ¶ (`0x457`) å’Œåè¿›åˆ¶ (`1111`) æ ¼å¼è¡¨ç¤ºã€‚è¿™å¯¼è‡´åœ¨åŸŸå†…ä¸º pepe ç”Ÿæˆä¸€ä¸ªå®Œæ•´ä¸”å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¦‚ï¼š`S-1-5-21-1074507654-1937615267-42093643874-1111`ã€‚

### **ä½¿ç”¨ rpcclient è¿›è¡Œæšä¸¾**

Samba çš„ **`rpcclient`** å·¥å…·ç”¨äºé€šè¿‡å‘½åç®¡é“ä¸ **RPC ç«¯ç‚¹** è¿›è¡Œäº¤äº’ã€‚ä»¥ä¸‹å‘½ä»¤å¯ä»¥åœ¨å»ºç«‹ **SMB ä¼šè¯** åå‘å‡ºï¼Œé€šå¸¸éœ€è¦å‡­æ®ã€‚

#### æœåŠ¡å™¨ä¿¡æ¯

* è¦è·å– **æœåŠ¡å™¨ä¿¡æ¯**ï¼šä½¿ç”¨ `srvinfo` å‘½ä»¤ã€‚

#### ç”¨æˆ·æšä¸¾

* **å¯ä»¥åˆ—å‡ºç”¨æˆ·**ï¼šä½¿ç”¨ `querydispinfo` å’Œ `enumdomusers`ã€‚
* **è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯**ï¼šä½¿ç”¨ `queryuser <0xrid>`ã€‚
* **è·å–ç”¨æˆ·çš„ç»„**ï¼šä½¿ç”¨ `queryusergroups <0xrid>`ã€‚
* **é€šè¿‡ä»¥ä¸‹æ–¹å¼æ£€ç´¢ç”¨æˆ·çš„ SID**ï¼šä½¿ç”¨ `lookupnames <username>`ã€‚
* **ç”¨æˆ·çš„åˆ«å**ï¼šä½¿ç”¨ `queryuseraliases [builtin|domain] <sid>`ã€‚
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### ç»„çš„æšä¸¾

* **é€šè¿‡**: `enumdomgroups` **è·å–ç»„**ã€‚
* **ä½¿ç”¨**: `querygroup <0xrid>` **è·å–ç»„çš„è¯¦ç»†ä¿¡æ¯**ã€‚
* **é€šè¿‡**: `querygroupmem <0xrid>` **è·å–ç»„çš„æˆå‘˜**ã€‚

#### åˆ«åç»„çš„æšä¸¾

* **é€šè¿‡**: `enumalsgroups <builtin|domain>` **è·å–åˆ«åç»„**ã€‚
* **ä½¿ç”¨**: `queryaliasmem builtin|domain <0xrid>` **è·å–åˆ«åç»„çš„æˆå‘˜**ã€‚

#### åŸŸçš„æšä¸¾

* **ä½¿ç”¨**: `enumdomains` **è·å–åŸŸ**ã€‚
* **é€šè¿‡**: `lsaquery` **æ£€ç´¢åŸŸçš„SID**ã€‚
* **é€šè¿‡**: `querydominfo` **è·å–åŸŸä¿¡æ¯**ã€‚

#### å…±äº«çš„æšä¸¾

* **é€šè¿‡**: `netshareenumall` **è·å–æ‰€æœ‰å¯ç”¨çš„å…±äº«**ã€‚
* **ä½¿ç”¨**: `netsharegetinfo <share>` **è·å–ç‰¹å®šå…±äº«çš„ä¿¡æ¯**ã€‚

#### ä½¿ç”¨SIDçš„é™„åŠ æ“ä½œ

* **é€šè¿‡åç§°è·å–SID**: `lookupnames <username>`ã€‚
* **é€šè¿‡**: `lsaenumsid` **è·å–æ›´å¤šSID**ã€‚
* **é€šè¿‡**: `lookupsids <sid>` **è¿›è¡ŒRIDå¾ªç¯ä»¥æ£€æŸ¥æ›´å¤šSID**ã€‚

#### **é¢å¤–å‘½ä»¤**

| **å‘½ä»¤**             | **æ¥å£**                                                                                                                                     | **æè¿°**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | æ£€ç´¢ç”¨æˆ·ä¿¡æ¯                                                                                                                 |
| querygroup          | æ£€ç´¢ç»„ä¿¡æ¯                                                                                                                        |                                                                                                                                           |
| querydominfo        | æ£€ç´¢åŸŸä¿¡æ¯                                                                                                                       |                                                                                                                                           |
| enumdomusers        | æšä¸¾åŸŸç”¨æˆ·                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | æšä¸¾åŸŸç»„                                                                                                                           |                                                                                                                                           |
| createdomuser       | åˆ›å»ºåŸŸç”¨æˆ·                                                                                                                              |                                                                                                                                           |
| deletedomuser       | åˆ é™¤åŸŸç”¨æˆ·                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | æŸ¥æ‰¾ç”¨æˆ·ååˆ°SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8)å€¼ |
| lookupsids          | æŸ¥æ‰¾SIDåˆ°ç”¨æˆ·åï¼ˆRID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)å¾ªç¯ï¼‰ |                                                                                                                                           |
| lsaaddacctrights    | å‘ç”¨æˆ·è´¦æˆ·æ·»åŠ æƒé™                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | ä»ç”¨æˆ·è´¦æˆ·ç§»é™¤æƒé™                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | è·å–ä¸»è¦åŸŸä¿¡æ¯                                                                                                            |
| dsenumdomtrusts     | æšä¸¾ADæ£®æ—ä¸­çš„å—ä¿¡åŸŸ                                                                                                     |                                                                                                                                           |

è¦**æ›´å¥½åœ°ç†è§£**å·¥å…· _**samrdump**_ **å’Œ** _**rpcdump**_ çš„å·¥ä½œåŸç†ï¼Œæ‚¨åº”è¯¥é˜…è¯» [**Pentesting MSRPC**](../135-pentesting-msrpc.md)ã€‚

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ä¸Šå…³æ³¨æˆ‘ä»¬**ã€‚
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
