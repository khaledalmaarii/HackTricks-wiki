# Wyliczanie usug rpcclient

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujcej si cyberbezpieczestwem**? Chcesz zobaczy swoj **firm reklamowan w HackTricks**? A mo偶e chcesz mie dostp do **najnowszej wersji PEASS lub pobra HackTricks w formacie PDF**? Sprawd藕 [**PLAN SUBSKRYPCYJNY**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Docz do** [****](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze** [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Znajd藕 najwa偶niejsze podatnoci, aby m贸c je szybko naprawi. Intruder ledzi powierzchni ataku, wykonuje skanowanie zagro偶e, znajduje problemy w caym stosie technologicznym, od interfejs贸w API po aplikacje internetowe i systemy chmurowe. [**Wypr贸buj go za darmo**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) ju偶 dzi.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **Czym jest RID**

### Przegld identyfikator贸w wzgldnych (RID) i identyfikator贸w zabezpiecze (SID)

**Identyfikatory wzgldne (RID)** i **Identyfikatory zabezpiecze (SID)** s kluczowymi skadnikami system贸w operacyjnych Windows do unikalnego identyfikowania i zarzdzania obiektami, takimi jak u偶ytkownicy i grupy, w domenie sieciowej.

- **SID** su偶 jako unikalne identyfikatory dla domen, zapewniajc rozr贸偶nialno ka偶dej domeny.
- **RID** s doczane do SID w celu utworzenia unikalnych identyfikator贸w dla obiekt贸w w tych domenach. Ta kombinacja umo偶liwia precyzyjne ledzenie i zarzdzanie uprawnieniami obiekt贸w oraz kontrol dostpu.

Na przykad, u偶ytkownik o nazwie `pepe` mo偶e mie unikalny identyfikator, czcy SID domeny z jego konkretnym RID, reprezentowany zar贸wno w formacie szesnastkowym (`0x457`), jak i dziesitnym (`1111`). Wynikiem jest kompletny i unikalny identyfikator dla pepe w domenie: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **Wyliczanie za pomoc rpcclient**

U偶yteczno **`rpcclient`** z Samba jest wykorzystywana do interakcji z punktami kocowymi **RPC za pomoc nazwanych potok贸w**. Poni偶ej przedstawione s polecenia, kt贸re mo偶na wyda do interfejs贸w SAMR, LSARPC i LSARPC-DS po ustanowieniu sesji SMB, co czsto wymaga powiadcze.

#### Informacje o serwerze

* Aby uzyska **informacje o serwerze**: u偶ywa si polecenia `srvinfo`.

#### Wyliczanie u偶ytkownik贸w

* **U偶ytkownicy mog by wymienieni** za pomoc polece: `querydispinfo` i `enumdomusers`.
* **Szczeg贸y u偶ytkownika** za pomoc: `queryuser <0xrid>`.
* **Grupy u偶ytkownika** za pomoc: `queryusergroups <0xrid>`.
* **SID u偶ytkownika jest pobierany** za pomoc: `lookupnames <nazwa_u偶ytkownika>`.
* **Aliasy u偶ytkownik贸w** za pomoc: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Wyliczanie grup

* **Grupy** za pomoc: `enumdomgroups`.
* **Szczeg贸y grupy** za pomoc: `querygroup <0xrid>`.
* **Czonkowie grupy** za pomoc: `querygroupmem <0xrid>`.

#### Wyliczanie grup alias贸w

* **Grupy alias贸w** za pomoc: `enumalsgroups <builtin|domain>`.
* **Czonkowie grupy alias贸w** za pomoc: `queryaliasmem builtin|domain <0xrid>`.

#### Wyliczanie domen

* **Domeny** za pomoc: `enumdomains`.
* **SID domeny jest pobierane** za pomoc: `lsaquery`.
* **Informacje o domenie s uzyskiwane** za pomoc: `querydominfo`.

#### Wyliczanie udzia贸w

* **Wszystkie dostpne udziay** za pomoc: `netshareenumall`.
* **Pobranie informacji o konkretnym udziale** za pomoc: `netsharegetinfo <share>`.

#### Dodatkowe operacje z SID

* **SID wedug nazwy** za pomoc: `lookupnames <username>`.
* **Wicej SID** za pomoc: `lsaenumsid`.
* **Cykliczne sprawdzanie RID w celu sprawdzenia wikszej liczby SID** za pomoc: `lookupsids <sid>`.

#### **Dodatkowe polecenia**

| **Polecenie**         | **Interfejs**                                                                                                                                     | **Opis**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Pobierz informacje o u偶ytkowniku                                                                                                                 |
| querygroup          | Pobierz informacje o grupie                                                                                                                        |                                                                                                                                           |
| querydominfo        | Pobierz informacje o domenie                                                                                                                       |                                                                                                                                           |
| enumdomusers        | Wylicz u偶ytkownik贸w domeny                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | Wylicz grupy domeny                                                                                                                           |                                                                                                                                           |
| createdomuser       | Utw贸rz u偶ytkownika domeny                                                                                                                              |                                                                                                                                           |
| deletedomuser       | Usu u偶ytkownika domeny                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Wyszukaj nazwy u偶ytkownik贸w do wartoci SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) |
| lookupsids          | Wyszukaj SID do nazw u偶ytkownik贸w (cykl RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)) |                                                                                                                                           |
| lsaaddacctrights    | Dodaj uprawnienia do konta u偶ytkownika                                                                                                                      |                                                                                                                                           |
| lsaremoveacctrights | Usu uprawnienia z konta u偶ytkownika                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Uzyskaj informacje o g贸wnej domenie                                                                                                            |
| dsenumdomtrusts     | Wylicz zaufane domeny w obrbie lasu AD                                                                                                     |                                                                                                                                           |

Aby **lepiej zrozumie**, jak dziaaj narzdzia _**samrdump**_ **i** _**rpcdump**_, przeczytaj [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Znajd藕 najwa偶niejsze podatnoci, aby m贸c je szybko naprawi. Intruder ledzi powierzchni ataku, wykonuje skanowanie zagro偶e proaktywnych, znajduje problemy w caym stosie technologicznym, od interfejs贸w API po aplikacje internetowe i systemy chmurowe. [**Wypr贸buj go za darmo**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) ju偶 dzi.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie cyberbezpieczestwa**? Chcesz zobaczy swoj **firm reklamowan w HackTricks**? A mo偶e chcesz mie dostp do **najnowszej wersji PEASS lub pobra HackTricks w formacie PDF**? Sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Docz do** [****](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze** [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
