# rpcclientæšä¸¾

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> - <a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿ æƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Ÿ æˆ–è€…æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Ÿ è¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTsæ”¶è—å“**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã€‚
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)ã€‚
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ–**ç”µæŠ¥ç¾¤**æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚
* é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

å‘ç°æœ€é‡è¦çš„æ¼æ´ï¼Œä»¥ä¾¿æ›´å¿«ä¿®å¤ã€‚Intruderè·Ÿè¸ªæ‚¨çš„æ”»å‡»é¢ï¼Œè¿è¡Œä¸»åŠ¨å¨èƒæ‰«æï¼Œå‘ç°æ•´ä¸ªæŠ€æœ¯å †æ ˆä¸­çš„é—®é¢˜ï¼Œä»APIåˆ°Webåº”ç”¨ç¨‹åºå’Œäº‘ç³»ç»Ÿã€‚[**ç«‹å³å…è´¹è¯•ç”¨**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **ä»€ä¹ˆæ˜¯RID**

[ç›¸å¯¹æ ‡è¯†ç¬¦ï¼ˆRIDï¼‰](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers)æ˜¯Windowsç”¨äº**è·Ÿè¸ªå’Œè¯†åˆ«å¯¹è±¡**çš„**å”¯ä¸€æ ‡è¯†ç¬¦**ï¼ˆä»¥åå…­è¿›åˆ¶æ ¼å¼è¡¨ç¤ºï¼‰ã€‚ä¸ºäº†è§£é‡Šå…¶ä½œç”¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼š

* NAME\_DOMAIN.LOCALåŸŸçš„[SID](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers)æ˜¯ï¼š`S-1-5-21-1038751438-1834703946-36937684957`ã€‚
* å½“åœ¨åŸŸä¸­åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¸Šè¿°æ•°å­—ï¼ˆSIDï¼‰å°†ä¸RIDç»„åˆï¼Œä»¥ç”Ÿæˆç”¨äºè¡¨ç¤ºå¯¹è±¡çš„å”¯ä¸€å€¼ã€‚
* å› æ­¤ï¼Œå…·æœ‰RIDï¼š\[0x457] å³åå…­è¿›åˆ¶0x457ï¼Œå³åè¿›åˆ¶`1111`çš„åŸŸç”¨æˆ·`john`ï¼Œå°†å…·æœ‰å®Œæ•´çš„ç”¨æˆ·SIDï¼š`S-1-5-21-1038751438-1834703946-36937684957-1111`ã€‚
* è¿™æ˜¯ä¸“å±äºNAME\_DOMAIN.LOCALåŸŸä¸­çš„`john`å¯¹è±¡ï¼Œæ‚¨æ°¸è¿œä¸ä¼šçœ‹åˆ°æ­¤é…å¯¹å€¼ä¸è¯¥åŸŸæˆ–ä»»ä½•å…¶ä»–åŸŸä¸­çš„å¦ä¸€ä¸ªå¯¹è±¡ç›¸å…³è”ã€‚

æ¥è‡ª[**æ­¤å¤„**](https://academy.hackthebox.com/module/143/section/1269)çš„å®šä¹‰ã€‚

### **ä½¿ç”¨rpcclientè¿›è¡Œæšä¸¾**

æ¥è‡ªSambaçš„**`rpcclient`**å®ç”¨ç¨‹åºç”¨äºé€šè¿‡å‘½åç®¡é“ä¸**RPCç«¯ç‚¹è¿›è¡Œäº¤äº’**ã€‚åœ¨**å»ºç«‹SMBä¼šè¯**åï¼Œé€šå¸¸éœ€è¦å‡­æ®æ‰èƒ½å‘å‡ºä»¥ä¸‹å‘½ä»¤åˆ°SAMRã€LSARPCå’ŒLSARPC-DSæ¥å£ã€‚

#### æœåŠ¡å™¨ä¿¡æ¯

* è¦è·å–**æœåŠ¡å™¨ä¿¡æ¯**ï¼šä½¿ç”¨`srvinfo`å‘½ä»¤ã€‚

#### ç”¨æˆ·æšä¸¾

* å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡º**ç”¨æˆ·**ï¼š`querydispinfo`å’Œ`enumdomusers`ã€‚
* é€šè¿‡`queryuser <0xrid>`å¯ä»¥æŸ¥çœ‹**ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯**ã€‚
* ä½¿ç”¨`queryusergroups <0xrid>`æŸ¥çœ‹**ç”¨æˆ·çš„ç»„**ã€‚
* é€šè¿‡`lookupnames <username>`æ£€ç´¢**ç”¨æˆ·çš„SID**ã€‚
* ä½¿ç”¨`queryuseraliases [builtin|domain] <sid>`æŸ¥çœ‹**ç”¨æˆ·çš„åˆ«å**ã€‚
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### æšä¸¾ç»„

* ä½¿ç”¨`enumdomgroups`æ¥æšä¸¾**ç»„**ã€‚
* ä½¿ç”¨`querygroup <0xrid>`æ¥è·å–**ç»„çš„è¯¦ç»†ä¿¡æ¯**ã€‚
* é€šè¿‡`querygroupmem <0xrid>`æ¥æŸ¥çœ‹**ç»„çš„æˆå‘˜**ã€‚

#### æšä¸¾åˆ«åç»„

* ä½¿ç”¨`enumalsgroups <builtin|domain>`æ¥æšä¸¾**åˆ«åç»„**ã€‚
* ä½¿ç”¨`queryaliasmem builtin|domain <0xrid>`æ¥æŸ¥çœ‹**åˆ«åç»„çš„æˆå‘˜**ã€‚

#### æšä¸¾åŸŸ

* ä½¿ç”¨`enumdomains`æ¥æš
