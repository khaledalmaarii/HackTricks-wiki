# SMTP Smuggling

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Ovaj tip ranjivosti je [**originalno otkriven u ovom postu**](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/) gde je obja코njeno da je mogu캖e **iskoristiti razlike u tuma캜enju SMTP protokola** prilikom zavr코avanja e-po코te, omogu캖avaju캖i napada캜u da prokrijum캜ari vi코e e-poruka u telo legitimne poruke, omogu캖avaju캖i da se predstavi kao drugi korisnici pogo캠ene domene (kao 코to je admin@outlook.com) zaobilaze캖i odbrane poput SPF-a.

### Za코to

Ovo je zato 코to u SMTP protokolu, **podaci poruke** koja se 코alje putem e-po코te su kontrolisani od strane korisnika (napada캜a) koji bi mogao poslati posebno oblikovane podatke zloupotrebljavaju캖i razlike u parserima koji 캖e prokrijum캜ariti dodatne e-poruke u primaoca. Pogledajte ovaj ilustrovani primer iz originalnog posta:

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption><p><a href="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png">https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png</a></p></figcaption></figure>

### Kako

Da bi iskoristio ovu ranjivost, napada캜 mora poslati neke podatke koje **Odlazni SMTP server smatra da je samo 1 e-poruka, ali Ulazni SMTP server misli da ima vi코e e-poruka**.

Istra쬴va캜i su otkrili da razli캜iti **Ulazni serveri smatraju razli캜ite karaktere kao kraj podataka** e-poruke koje Odlazni serveri ne smatraju.\
Na primer, redovan kraj podataka je `\r\n.\r`. Ali ako Ulazni SMTP server tako캠e podr쬬va `\n.`, napada캜 bi mogao samo dodati **te podatke u svoju e-po코tu i po캜eti da navodi SMTP komande** novih kako bi je prokrijum캜ario ba코 kao na prethodnoj slici.

Naravno, ovo bi moglo raditi samo ako **Odlazni SMTP server tako캠e ne tretira ove podatke** kao kraj podataka poruke, jer u tom slu캜aju 캖e videti 2 e-poruke umesto samo 1, tako da je na kraju ovo nesinhronizacija koja se zloupotrebljava u ovoj ranjivosti.

Potencijalni podaci nesinhronizacije:

* `\n.`
* `\n.\r`

Tako캠e obratite pa쬹ju da se SPF zaobilazi jer ako prokrijum캜arite e-poruku sa `admin@outlook.com` iz e-po코te `user@outlook.com`, **po코iljalac je i dalje `outlook.com`.**

## **Reference**

* [https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
