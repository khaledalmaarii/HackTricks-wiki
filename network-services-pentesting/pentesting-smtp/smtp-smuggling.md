# SMTP Smuggling

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.**

</details>

## Temel Bilgiler

Bu tÃ¼r bir zayÄ±flÄ±k [**bu yazÄ±da orijinal olarak keÅŸfedildi**](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/) ve SMTP protokolÃ¼nÃ¼n bir e-postayÄ± sonlandÄ±rÄ±rken nasÄ±l yorumlandÄ±ÄŸÄ±ndaki farklÄ±lÄ±klardan yararlanarak, bir saldÄ±rganÄ±n meÅŸru bir e-postanÄ±n gÃ¶vdesine daha fazla e-posta sokmasÄ±na izin verdiÄŸi aÃ§Ä±klanmÄ±ÅŸtÄ±r, etkilenen alanÄ±n diÄŸer kullanÄ±cÄ±larÄ±nÄ± (Ã¶rneÄŸin admin@outlook.com gibi) taklit etmesine olanak tanÄ±rken SPF gibi savunmalarÄ± atlamasÄ±na izin verir.

### Neden

Bu, SMTP protokolÃ¼nde, e-postada gÃ¶nderilecek olan **mesaj verisinin** bir kullanÄ±cÄ± (saldÄ±rgan) tarafÄ±ndan kontrol edildiÄŸi iÃ§in mÃ¼mkÃ¼ndÃ¼r ve bu, alÄ±cÄ±ya ekstra e-postalarÄ± kaÃ§Ä±rmak iÃ§in ayrÄ±mcÄ±lÄ±klarÄ± kÃ¶tÃ¼ye kullanan Ã¶zel olarak oluÅŸturulmuÅŸ veriler gÃ¶nderebilecek bir saldÄ±rganÄ±n (saldÄ±rgan) varlÄ±ÄŸÄ±na izin verir. Bu zayÄ±flÄ±ktan kÃ¶tÃ¼ye kullanma olasÄ±lÄ±ÄŸÄ± olan bu Ã¶rneÄŸe bakÄ±n:

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption><p><a href="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png">https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png</a></p></figcaption></figure>

### NasÄ±l

Bu zayÄ±flÄ±ÄŸÄ± sÃ¶mÃ¼rmek iÃ§in bir saldÄ±rganÄ±n, **Giden SMTP sunucusunun bir e-posta olduÄŸunu dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼ ancak Gelen SMTP sunucusunun birden fazla e-posta olduÄŸunu dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼ bazÄ± veriler gÃ¶ndermesi gerekir**.

AraÅŸtÄ±rmacÄ±lar, farklÄ± **Gelen sunucularÄ±n e-posta mesajÄ±nÄ±n veri sonunu farklÄ± karakterler olarak dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼nÃ¼ keÅŸfettiler**.\
Ã–rneÄŸin, dÃ¼zenli bir veri sonu `\r\n.\r\n`'dir. Ancak Gelen SMTP sunucusu ayrÄ±ca `\n.\n`'yi de destekliyorsa, bir saldÄ±rgan sadece **bu veriyi e-postasÄ±na ekleyebilir ve Ã¶nceki resimde olduÄŸu gibi onu kaÃ§Ä±rmak iÃ§in yeni SMTP komutlarÄ±nÄ± belirtmeye baÅŸlayabilir**.

Tabii ki, bu yalnÄ±zca **Giden SMTP sunucusunun bu veriyi** de mesaj verisinin sonu olarak ele almazsa Ã§alÄ±ÅŸabilir, Ã§Ã¼nkÃ¼ o zaman 1 yerine 2 e-posta gÃ¶recektir, bu nedenle sonuÃ§ta bu, bu zayÄ±flÄ±ktan kÃ¶tÃ¼ye kullanÄ±lan desenkronizasyondur.

Potansiyel desenkronizasyon verileri:

* `\n.\n`
* `\n.\r\n`

AyrÄ±ca SPF'nin atlatÄ±ldÄ±ÄŸÄ±nÄ± unutmayÄ±n Ã§Ã¼nkÃ¼ `admin@outlook.com` adresinden bir e-postayÄ± `user@outlook.com` adresinden kaÃ§Ä±rÄ±rsanÄ±z, **gÃ¶nderen hala `outlook.com` olacaktÄ±r.**

## **Referanslar**

* [https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.**

</details>
