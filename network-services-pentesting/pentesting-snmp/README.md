# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert Red Team AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Si vous √™tes int√©ress√© par une **carri√®re en piratage** et pirater l'impiratable - **nous recrutons !** (_ma√Ætrise du polonais √† l'√©crit et √† l'oral requise_).

{% embed url="https://www.stmcyber.com/careers" %}

## Informations de base

**SNMP - Simple Network Management Protocol** est un protocole utilis√© pour surveiller diff√©rents appareils dans le r√©seau (comme les routeurs, les commutateurs, les imprimantes, les objets IoT...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP utilise √©galement le port **162/UDP** pour les **traps**. Ce sont des **paquets de donn√©es envoy√©s du serveur SNMP au client sans √™tre explicitement demand√©s**.
{% endhint %}

### MIB

Pour garantir que l'acc√®s SNMP fonctionne entre les fabricants et avec diff√©rentes combinaisons client-serveur, la **Base d'Information de Gestion (MIB)** a √©t√© cr√©√©e. La MIB est un **format ind√©pendant pour stocker les informations des appareils**. Une MIB est un fichier **textuel** dans lequel tous les **objets SNMP interrogeables** d'un appareil sont r√©pertori√©s dans une hi√©rarchie d'arborescence **standardis√©e**. Elle contient au **moins un `Identifiant d'Objet` (`OID`)**, qui, en plus de l'**adresse unique** n√©cessaire et d'un **nom**, fournit √©galement des informations sur le type, les droits d'acc√®s et une description de l'objet respectif.\
Les fichiers MIB sont √©crits dans le format texte ASCII bas√© sur la `Notation de Syntaxe Abstraite Un` (`ASN.1`). Les **MIB ne contiennent pas de donn√©es**, mais ils expliquent **o√π trouver quelles informations** et √† quoi elles ressemblent, renvoyant des valeurs pour l'OID sp√©cifique, ou quel type de donn√©es est utilis√©.

### OIDs

Les **Identifiants d'Objet (OID)** jouent un r√¥le crucial. Ces identifiants uniques sont con√ßus pour g√©rer les objets au sein d'une **Base d'Information de Gestion (MIB)**.

Les niveaux les plus √©lev√©s des ID d'objet MIB, ou OIDs, sont attribu√©s √† diverses organisations de normalisation. C'est √† l'int√©rieur de ces niveaux sup√©rieurs que le cadre des pratiques et normes de gestion mondiales est √©tabli.

De plus, les fournisseurs se voient accorder la libert√© d'√©tablir des branches priv√©es. √Ä l'int√©rieur de ces branches, ils ont l'**autonomie d'inclure des objets g√©r√©s pertinents pour leurs propres gammes de produits**. Ce syst√®me garantit qu'il existe une m√©thode structur√©e et organis√©e pour identifier et g√©rer une large gamme d'objets √† travers diff√©rents fournisseurs et normes.

![](../../.gitbook/assets/snmp_oid_mib_tree.png)

Vous pouvez **naviguer** dans un **arbre OID** depuis le web ici : [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) ou **voir ce que signifie un OID** (comme `1.3.6.1.2.1.1`) en acc√©dant √† [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Il existe quelques **OIDs bien connus** comme ceux √† l'int√©rieur de [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) qui font r√©f√©rence aux variables SNMP d√©finies par MIB-2. Et √† partir des **OIDs en attente de celui-ci**, vous pouvez obtenir des donn√©es h√¥tes int√©ressantes (donn√©es syst√®me, donn√©es r√©seau, donn√©es de processus...)

### **Exemple d'OID**

[**Exemple d'ici**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Voici une d√©composition de cette adresse.

* 1 - c'est appel√© l'ISO et cela √©tablit qu'il s'agit d'un OID. C'est pourquoi tous les OIDs commencent par "1"
* 3 - c'est appel√© ORG et il est utilis√© pour sp√©cifier l'organisation qui a construit l'appareil.
* 6 - c'est le dod ou le D√©partement de la D√©fense qui est l'organisation qui a √©tabli Internet en premier.
* 1 - c'est la valeur de l'internet pour indiquer que toutes les communications se feront via Internet.
* 4 - cette valeur d√©termine que cet appareil est fabriqu√© par une organisation priv√©e et non gouvernementale.
* 1 - cette valeur indique que l'appareil est fabriqu√© par une entreprise ou une entit√© commerciale.

Ces six premi√®res valeurs ont tendance √† √™tre les m√™mes pour tous les appareils et elles vous donnent des informations de base sur eux. Cette s√©quence de nombres sera la m√™me pour tous les OIDs, sauf lorsque l'appareil est fabriqu√© par le gouvernement.

Passons aux prochains chiffres.

* 1452 - donne le nom de l'organisation qui a fabriqu√© cet appareil.
* 1 - explique le type d'appareil. Dans ce cas, c'est un r√©veil.
* 2 - d√©termine que cet appareil est une unit√© de terminal √† distance.

Le reste des valeurs donne des informations sp√©cifiques sur l'appareil.

* 5 - indique un point d'alarme discret.
* 1 - point sp√©cifique dans l'appareil
* 3 - port
* 21 - adresse du port
* 1 - affichage pour le port
* 4 - num√©ro de point
* 7 - √©tat du point

### Versions SNMP

Il existe 2 versions importantes de SNMP :

* **SNMPv1** : La principale, c'est toujours la plus fr√©quente, l'**authentification est bas√©e sur une cha√Æne** (cha√Æne de communaut√©) qui voyage en **texte clair** (toutes les informations voyagent en texte clair). **La version 2 et 2c** envoient √©galement le **trafic en texte clair** et utilisent une **cha√Æne de communaut√© comme authentification**.
* **SNMPv3** : Utilise une meilleure **forme d'authentification** et les informations voyagent **chiffr√©es** (une **attaque par dictionnaire** pourrait √™tre effectu√©e mais il serait beaucoup plus difficile de trouver les bons identifiants que dans SNMPv1 et v2).

### Cha√Ænes de Communaut√©

Comme mentionn√© pr√©c√©demment, **pour acc√©der aux informations enregistr√©es sur la MIB, vous devez conna√Ætre la cha√Æne de communaut√© sur les versions 1 et 2/2c et les identifiants sur la version 3.**\
Il existe **2 types de cha√Ænes de communaut√©** :

* **`public`** principalement des fonctions **en lecture seule**
* **`private`** **Lecture/√âcriture** en g√©n√©ral

Notez que **la possibilit√© d'√©crire un OID d√©pend de la cha√Æne de communaut√© utilis√©e**, donc **m√™me** si vous d√©couvrez que "**public**" est utilis√©, vous pourriez √™tre en mesure d'**√©crire certaines valeurs**. De plus, il **peut** exister des objets qui sont **toujours "Lecture Seule"**.\
Si vous essayez d'**√©crire** un objet, une erreur **`noSuchName` ou `readOnly`** est re√ßue\*\*.\*\*

Dans les versions 1 et 2/2c, si vous utilisez une **mauvaise** cha√Æne de communaut√©, le serveur ne **r√©pondra** pas. Donc, s'il r√©pond, une **cha√Æne de communaut√© valide a √©t√© utilis√©e**.

## Ports

[De Wikipedia](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol):

* L'agent SNMP re√ßoit des demandes sur le port UDP **161**.
* Le gestionnaire re√ßoit des notifications ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) et [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) sur le port **162**.
* Lorsqu'il est utilis√© avec [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) ou [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), les demandes sont re√ßues sur le port **10161** et les notifications sont envoy√©es sur le port **10162**.

## Attaque par Force Brute de la Cha√Æne de Communaut√© (v1 et v2c)

Pour **deviner la cha√Æne de communaut√©**, vous pourriez effectuer une attaque par dictionnaire. Consultez [ici diff√©rentes fa√ßons d'effectuer une attaque par force brute contre SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Une cha√Æne de communaut√© fr√©quemment utilis√©e est `public`.

## √ânum√©ration SNMP

Il est recommand√© d'installer ce qui suit pour voir ce que signifie **chaque OID collect√©** √† partir de l'appareil:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Si vous connaissez une cha√Æne de communaut√© valide, vous pouvez acc√©der aux donn√©es en utilisant **SNMPWalk** ou **SNMP-Check** :
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Gr√¢ce aux requ√™tes √©tendues (download-mibs), il est possible d'en savoir encore plus sur le syst√®me avec la commande suivante :
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** contient beaucoup d'informations sur l'h√¥te et des √©l√©ments qui pourraient vous int√©resser sont : **Interfaces r√©seau** (adresse IPv4 et **IPv6**), Noms d'utilisateur, Temps de fonctionnement, Version du serveur/Syst√®me d'exploitation, et **processus**

**en cours d'ex√©cution** (peut contenir des mots de passe)....

### **Param√®tres Dangereux**

Dans le domaine de la gestion r√©seau, certaines configurations et param√®tres sont essentiels pour garantir une surveillance et un contr√¥le complets.

### Param√®tres d'Acc√®s

Deux param√®tres principaux permettent l'acc√®s √† l'**arbre OID complet**, qui est un √©l√©ment crucial dans la gestion r√©seau :

1. **`rwuser noauth`** est d√©fini pour permettre un acc√®s complet √† l'arbre OID sans n√©cessiter d'authentification. Ce param√®tre est simple et permet un acc√®s illimit√©.
2. Pour un contr√¥le plus sp√©cifique, l'acc√®s peut √™tre accord√© en utilisant :
* **`rwcommunity`** pour les adresses **IPv4**, et
* **`rwcommunity6`** pour les adresses **IPv6**.

Les deux commandes n√©cessitent une **cha√Æne communautaire** et l'adresse IP pertinente, offrant un acc√®s complet ind√©pendamment de l'origine de la demande.

### Param√®tres SNMP pour Microsoft Windows

Une s√©rie de **valeurs de Base d'Information de Gestion (MIB)** sont utilis√©es pour surveiller divers aspects d'un syst√®me Windows via SNMP :

* **Processus Syst√®me** : Accessible via `1.3.6.1.2.1.25.1.6.0`, ce param√®tre permet de surveiller les processus actifs dans le syst√®me.
* **Programmes en Cours d'Ex√©cution** : La valeur `1.3.6.1.2.1.25.4.2.1.2` est d√©sign√©e pour suivre les programmes actuellement en cours d'ex√©cution.
* **Chemin des Processus** : Pour d√©terminer d'o√π un processus est en cours d'ex√©cution, la valeur MIB `1.3.6.1.2.1.25.4.2.1.4` est utilis√©e.
* **Unit√©s de Stockage** : La surveillance des unit√©s de stockage est facilit√©e par `1.3.6.1.2.1.25.2.3.1.4`.
* **Nom du Logiciel** : Pour identifier le logiciel install√© sur un syst√®me, `1.3.6.1.2.1.25.6.3.1.2` est utilis√©.
* **Comptes Utilisateurs** : La valeur `1.3.6.1.4.1.77.1.2.25` permet de suivre les comptes utilisateurs.
* **Ports Locaux TCP** : Enfin, `1.3.6.1.2.1.6.13.1.3` est d√©sign√© pour surveiller les ports locaux TCP, fournissant un aper√ßu des connexions r√©seau actives.

### Cisco

Consultez cette page si vous utilisez du mat√©riel Cisco :

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## De SNMP √† RCE

Si vous avez la **cha√Æne** qui vous permet d'**√©crire des valeurs** dans le service SNMP, vous pourriez l'exploiter pour **ex√©cuter des commandes** :

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **SNMP Massif**

[Braa ](https://github.com/mteg/braa)est un scanner SNMP massif. L'usage pr√©vu d'un tel outil est bien s√ªr de faire des requ√™tes SNMP - mais contrairement √† snmpwalk de net-snmp, il est capable d'interroger des dizaines ou des centaines d'h√¥tes simultan√©ment, et dans un seul processus. Ainsi, il consomme tr√®s peu de ressources syst√®me et effectue le balayage TR√àS rapidement.

Braa impl√©mente sa PROPRE pile SNMP, il n'a donc pas besoin de biblioth√®ques SNMP comme net-snmp.

**Syntaxe :** braa \[Cha√Æne communautaire]@\[IP du serveur SNMP]:\[identifiant iso]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Cela peut extraire beaucoup de Mo d'informations que vous ne pouvez pas traiter manuellement.

Alors, cherchons les informations les plus int√©ressantes (de [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### **Appareils**

Le processus commence par l'extraction des donn√©es **sysDesc MIB** (1.3.6.1.2.1.1.1.0) de chaque fichier pour identifier les appareils. Cela est accompli gr√¢ce √† l'utilisation d'une **commande grep**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Identifier la cha√Æne priv√©e**

Une √©tape cruciale consiste √† identifier la **cha√Æne communautaire priv√©e** utilis√©e par les organisations, en particulier sur les routeurs Cisco IOS. Cette cha√Æne permet l'extraction des **configurations en cours d'ex√©cution** des routeurs. L'identification repose souvent sur l'analyse des donn√©es de **trap SNMP** pour le mot "trap" avec une commande **grep** :
```bash
grep -i "trap" *.snmp
```
### **Noms d'utilisateur/Mots de passe**

Les journaux stock√©s dans les tables MIB sont examin√©s pour les **tentatives de connexion √©chou√©es**, qui pourraient inclure accidentellement des mots de passe saisis en tant que noms d'utilisateur. Des mots-cl√©s tels que _fail_, _failed_, ou _login_ sont recherch√©s pour trouver des donn√©es pr√©cieuses:
```bash
grep -i "login\|fail" *.snmp
```
### **Emails**

Enfin, pour extraire les **adresses e-mail** des donn√©es, une commande **grep** avec une expression r√©guli√®re est utilis√©e, en se concentrant sur les motifs correspondant aux formats d'e-mail :
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modification des valeurs SNMP

Vous pouvez utiliser _**NetScanTools**_ pour **modifier les valeurs**. Vous devrez conna√Ætre la **cha√Æne priv√©e** pour le faire.

## Spoofing

S'il existe une ACL qui autorise uniquement certaines adresses IP √† interroger le service SMNP, vous pouvez usurper l'une de ces adresses √† l'int√©rieur du paquet UDP et intercepter le trafic.

## Examiner les fichiers de configuration SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Si vous √™tes int√©ress√© par une **carri√®re en piratage** et pirater l'impossible - **nous recrutons !** (_ma√Ætrise du polonais √† l'√©crit et √† l'oral requise_).

{% embed url="https://www.stmcyber.com/careers" %}

## Commandes automatiques HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp


```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert Red Team AWS de HackTricks)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
