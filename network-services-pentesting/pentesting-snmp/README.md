# 161,162,10161,10162/udp - Pentesting SNMP

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

If you are interested in **hacking career** and hack the unhackable - **we are hiring!** (_fluent polish written and spoken required_).

{% embed url="https://www.stmcyber.com/careers" %}

## Basic Information

**SNMP - Simple Network Management Protocol** √® un protocollo utilizzato per monitorare diversi dispositivi nella rete (come router, switch, stampanti, IoT...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP utilizza anche la porta **162/UDP** per i **traps**. Questi sono pacchetti di dati **inviati dal server SNMP al client senza essere esplicitamente richiesti**.
{% endhint %}

### MIB

Per garantire che l'accesso SNMP funzioni tra diversi produttori e con diverse combinazioni client-server, √® stata creata la **Management Information Base (MIB)**. MIB √® un **formato indipendente per memorizzare informazioni sui dispositivi**. Un MIB √® un file **testo** in cui tutti gli **oggetti SNMP** interrogabili di un dispositivo sono elencati in una gerarchia ad albero **standardizzata**. Contiene almeno un **`Object Identifier` (`OID`)**, che, oltre all'**indirizzo unico** necessario e a un **nome**, fornisce anche informazioni sul tipo, diritti di accesso e una descrizione dell'oggetto rispettivo.\
I file MIB sono scritti nel formato di testo ASCII basato su `Abstract Syntax Notation One` (`ASN.1`). Le **MIB non contengono dati**, ma spiegano **dove trovare quali informazioni** e come appaiono, quali valori restituiscono per l'OID specifico o quale tipo di dato viene utilizzato.

### OIDs

**Object Identifiers (OIDs)** svolgono un ruolo cruciale. Questi identificatori unici sono progettati per gestire oggetti all'interno di una **Management Information Base (MIB)**.

I livelli pi√π alti degli ID oggetto MIB, o OIDs, sono assegnati a diverse organizzazioni di standardizzazione. √à all'interno di questi livelli superiori che viene stabilito il quadro per le pratiche e gli standard di gestione globali.

Inoltre, ai fornitori √® concessa la libert√† di stabilire rami privati. All'interno di questi rami, hanno l'**autonomia di includere oggetti gestiti pertinenti alle proprie linee di prodotto**. Questo sistema garantisce che ci sia un metodo strutturato e organizzato per identificare e gestire una vasta gamma di oggetti tra diversi fornitori e standard.

![](<../../.gitbook/assets/SNMP\_OID\_MIB\_Tree (1).png>)

Puoi **navigare** attraverso un **albero OID** dal web qui: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) o **vedere cosa significa un OID** (come `1.3.6.1.2.1.1`) accedendo a [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Ci sono alcuni **OID ben noti** come quelli all'interno di [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) che fanno riferimento alle variabili del Simple Network Management Protocol (SNMP) definite in MIB-2. E dagli **OID in attesa di questo** puoi ottenere alcuni dati interessanti sull'host (dati di sistema, dati di rete, dati sui processi...)

### **Esempio di OID**

[**Esempio da qui**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Ecco una suddivisione di questo indirizzo.

* 1 ‚Äì questo √® chiamato ISO e stabilisce che questo √® un OID. Ecco perch√© tutti gli OID iniziano con "1"
* 3 ‚Äì questo √® chiamato ORG e viene utilizzato per specificare l'organizzazione che ha costruito il dispositivo.
* 6 ‚Äì questo √® il dod o il Dipartimento della Difesa, che √® l'organizzazione che ha stabilito per prima Internet.
* 1 ‚Äì questo √® il valore di internet per denotare che tutte le comunicazioni avverranno attraverso Internet.
* 4 ‚Äì questo valore determina che questo dispositivo √® realizzato da un'organizzazione privata e non da una governativa.
* 1 ‚Äì questo valore denota che il dispositivo √® realizzato da un'impresa o un'entit√† commerciale.

Questi primi sei valori tendono a essere gli stessi per tutti i dispositivi e forniscono le informazioni di base su di essi. Questa sequenza di numeri sar√† la stessa per tutti gli OID, tranne quando il dispositivo √® realizzato dal governo.

Passando al set successivo di numeri.

* 1452 ‚Äì fornisce il nome dell'organizzazione che ha fabbricato questo dispositivo.
* 1 ‚Äì spiega il tipo di dispositivo. In questo caso, √® una sveglia.
* 2 ‚Äì determina che questo dispositivo √® un'unit√† terminale remota.

Il resto dei valori fornisce informazioni specifiche sul dispositivo.

* 5 ‚Äì denota un punto di allerta discreto.
* 1 ‚Äì punto specifico nel dispositivo
* 3 ‚Äì porta
* 21 ‚Äì indirizzo della porta
* 1 ‚Äì display per la porta
* 4 ‚Äì numero del punto
* 7 ‚Äì stato del punto

### Versioni SNMP

Ci sono 2 versioni importanti di SNMP:

* **SNMPv1**: La principale, √® ancora la pi√π frequente, l'**autenticazione si basa su una stringa** (community string) che viaggia in **testo semplice** (tutte le informazioni viaggiano in testo semplice). **Versione 2 e 2c** inviano il **traffico in testo semplice** anche e utilizzano una **community string come autenticazione**.
* **SNMPv3**: Utilizza una forma di **autenticazione** migliore e le informazioni viaggiano **crittografate** (un **attacco a dizionario** potrebbe essere eseguito ma sarebbe molto pi√π difficile trovare le credenziali corrette rispetto a SNMPv1 e v2).

### Community Strings

Come accennato in precedenza, **per accedere alle informazioni salvate sulla MIB √® necessario conoscere la community string nelle versioni 1 e 2/2c e le credenziali nella versione 3.**\
Ci sono **2 tipi di community strings**:

* **`public`** principalmente **funzioni di sola lettura**
* **`private`** **Leggi/Scrivi** in generale

Nota che **la scrivibilit√† di un OID dipende dalla community string utilizzata**, quindi **anche** se scopri che viene utilizzato "**public**", potresti essere in grado di **scrivere alcuni valori.** Inoltre, potrebbero **esistere** oggetti che sono **sempre "Read Only".**\
Se provi a **scrivere** un oggetto, si riceve un errore **`noSuchName` o `readOnly`**.\*\*.\*\*

Nelle versioni 1 e 2/2c, se utilizzi una **community string** **errata**, il server non **risponder√†**. Quindi, se risponde, √® stata utilizzata una **community string valida**.

## Porte

[Da Wikipedia](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol):

* L'agente SNMP riceve richieste sulla porta UDP **161**.
* Il manager riceve notifiche ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) e [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) sulla porta **162**.
* Quando utilizzato con [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) o [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), le richieste vengono ricevute sulla porta **10161** e le notifiche vengono inviate alla porta **10162**.

## Brute-Force Community String (v1 e v2c)

Per **indovinare la community string** potresti eseguire un attacco a dizionario. Controlla [qui diversi modi per eseguire un attacco brute-force contro SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Una community string frequentemente utilizzata √® `public`.

## Enumerare SNMP

Si consiglia di installare quanto segue per vedere cosa significa **ogni OID raccolto** dal dispositivo:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Se conosci una stringa di comunit√† valida, puoi accedere ai dati utilizzando **SNMPWalk** o **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Grazie a query estese (download-mibs), √® possibile enumerare ancora di pi√π sul sistema con il seguente comando :
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** ha molte informazioni sull'host e le cose che potresti trovare interessanti sono: **Interfacce di rete** (indirizzo **IPv4** e **IPv6**), Nomi utente, Tempo di attivit√†, Versione del server/SO e **processi**

**in esecuzione** (potrebbero contenere password)....

### **Impostazioni pericolose**

Nel campo della gestione della rete, alcune configurazioni e parametri sono fondamentali per garantire un monitoraggio e un controllo completi.

### Impostazioni di accesso

Due impostazioni principali abilitano l'accesso all'**intero albero OID**, che √® un componente cruciale nella gestione della rete:

1. **`rwuser noauth`** √® impostato per consentire l'accesso completo all'albero OID senza la necessit√† di autenticazione. Questa impostazione √® semplice e consente un accesso illimitato.
2. Per un controllo pi√π specifico, l'accesso pu√≤ essere concesso utilizzando:
* **`rwcommunity`** per indirizzi **IPv4**, e
* **`rwcommunity6`** per indirizzi **IPv6**.

Entrambi i comandi richiedono una **stringa di comunit√†** e l'indirizzo IP pertinente, offrendo accesso completo indipendentemente dall'origine della richiesta.

### Parametri SNMP per Microsoft Windows

Una serie di **valori della Management Information Base (MIB)** sono utilizzati per monitorare vari aspetti di un sistema Windows tramite SNMP:

* **Processi di sistema**: Accessibile tramite `1.3.6.1.2.1.25.1.6.0`, questo parametro consente il monitoraggio dei processi attivi all'interno del sistema.
* **Programmi in esecuzione**: Il valore `1.3.6.1.2.1.25.4.2.1.2` √® designato per tracciare i programmi attualmente in esecuzione.
* **Percorso dei processi**: Per determinare da dove viene eseguito un processo, viene utilizzato il valore MIB `1.3.6.1.2.1.25.4.2.1.4`.
* **Unit√† di archiviazione**: Il monitoraggio delle unit√† di archiviazione √® facilitato da `1.3.6.1.2.1.25.2.3.1.4`.
* **Nome del software**: Per identificare il software installato su un sistema, viene impiegato `1.3.6.1.2.1.25.6.3.1.2`.
* **Account utente**: Il valore `1.3.6.1.4.1.77.1.2.25` consente di tracciare gli account utente.
* **Porte locali TCP**: Infine, `1.3.6.1.2.1.6.13.1.3` √® designato per monitorare le porte locali TCP, fornendo informazioni sulle connessioni di rete attive.

### Cisco

Dai un'occhiata a questa pagina se hai attrezzature Cisco:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Da SNMP a RCE

Se hai la **stringa** che ti consente di **scrivere valori** all'interno del servizio SNMP, potresti essere in grado di abusarne per **eseguire comandi**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **SNMP Massivo**

[Braa ](https://github.com/mteg/braa) √® uno scanner SNMP di massa. L'uso previsto di un tale strumento √®, ovviamente, effettuare query SNMP ‚Äì ma a differenza di snmpwalk di net-snmp, √® in grado di interrogare dozzine o centinaia di host simultaneamente, e in un unico processo. Pertanto, consuma pochissime risorse di sistema e esegue la scansione MOLTO velocemente.

Braa implementa il proprio stack SNMP, quindi non ha bisogno di librerie SNMP come net-snmp.

**Sintassi:** braa \[Stringa di comunit√†]@\[IP del server SNMP]:\[id iso]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Questo pu√≤ estrarre molti MB di informazioni che non puoi elaborare manualmente.

Quindi, cerchiamo le informazioni pi√π interessanti (da [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### **Dispositivi**

Il processo inizia con l'estrazione dei dati **sysDesc MIB** (1.3.6.1.2.1.1.1.0) da ciascun file per identificare i dispositivi. Questo viene realizzato attraverso l'uso di un **comando grep**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Identificare la Stringa Privata**

Un passaggio cruciale implica l'identificazione della **stringa di comunit√† privata** utilizzata dalle organizzazioni, in particolare sui router Cisco IOS. Questa stringa consente l'estrazione delle **configurazioni in esecuzione** dai router. L'identificazione si basa spesso sull'analisi dei dati SNMP Trap per la parola "trap" con un **grep command**:
```bash
grep -i "trap" *.snmp
```
### **Nome utente/Password**

I log memorizzati all'interno delle tabelle MIB vengono esaminati per **tentativi di accesso non riusciti**, che potrebbero accidentalmente includere password inserite come nomi utente. Parole chiave come _fail_, _failed_ o _login_ vengono cercate per trovare dati preziosi:
```bash
grep -i "login\|fail" *.snmp
```
### **Emails**

Infine, per estrarre **indirizzi email** dai dati, viene utilizzato un **comando grep** con un'espressione regolare, concentrandosi su modelli che corrispondono ai formati email:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modificare i valori SNMP

Puoi usare _**NetScanTools**_ per **modificare i valori**. Dovrai conoscere la **stringa privata** per farlo.

## Spoofing

Se c'√® un ACL che consente solo ad alcuni IP di interrogare il servizio SMNP, puoi spoofare uno di questi indirizzi all'interno del pacchetto UDP e sniffare il traffico.

## Esaminare i file di configurazione SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Se sei interessato a una **carriera nel hacking** e a hackare l'inhackabile - **stiamo assumendo!** (_richiesta di polacco fluente scritto e parlato_).

{% embed url="https://www.stmcyber.com/careers" %}

## HackTricks Comandi Automatici
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp


```
{% hint style="success" %}
Impara e pratica il hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Impara e pratica il hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
{% endhint %}
