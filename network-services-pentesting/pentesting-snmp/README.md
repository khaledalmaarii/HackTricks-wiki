# 161,162,10161,10162/udp - Pentesting SNMP

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

If you are interested in **hacking career** and hack the unhackable - **we are hiring!** (_se requiere polaco fluido escrito y hablado_).

{% embed url="https://www.stmcyber.com/careers" %}

## Basic Information

**SNMP - Protocolo Simple de Administraci√≥n de Red** es un protocolo utilizado para monitorear diferentes dispositivos en la red (como enrutadores, conmutadores, impresoras, IoTs...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP tambi√©n utiliza el puerto **162/UDP** para **traps**. Estos son datos **paquetes enviados desde el servidor SNMP al cliente sin ser solicitados expl√≠citamente**.
{% endhint %}

### MIB

Para asegurar que el acceso SNMP funcione entre diferentes fabricantes y con diferentes combinaciones de cliente-servidor, se cre√≥ la **Base de Informaci√≥n de Gesti√≥n (MIB)**. MIB es un **formato independiente para almacenar informaci√≥n del dispositivo**. Un MIB es un **archivo de texto** en el que se enumeran todos los **objetos SNMP** consultables de un dispositivo en una jerarqu√≠a de √°rbol **estandarizada**. Contiene al **menos un `Identificador de Objeto` (`OID`)**, que, adem√°s de la **direcci√≥n √∫nica** necesaria y un **nombre**, tambi√©n proporciona informaci√≥n sobre el tipo, derechos de acceso y una descripci√≥n del respectivo objeto.\
Los archivos MIB est√°n escritos en el formato de texto ASCII basado en `Notaci√≥n de Sintaxis Abstracta Uno` (`ASN.1`). Los **MIB no contienen datos**, pero explican **d√≥nde encontrar qu√© informaci√≥n** y c√≥mo se ve, qu√© valores devuelve para el OID espec√≠fico, o qu√© tipo de datos se utiliza.

### OIDs

**Identificadores de Objetos (OIDs)** juegan un papel crucial. Estos identificadores √∫nicos est√°n dise√±ados para gestionar objetos dentro de una **Base de Informaci√≥n de Gesti√≥n (MIB)**.

Los niveles m√°s altos de los IDs de objetos MIB, o OIDs, est√°n asignados a diversas organizaciones de establecimiento de est√°ndares. Es dentro de estos niveles superiores donde se establece el marco para las pr√°cticas y est√°ndares de gesti√≥n global.

Adem√°s, se otorga a los proveedores la libertad de establecer ramas privadas. Dentro de estas ramas, tienen la **autonom√≠a para incluir objetos gestionados pertinentes a sus propias l√≠neas de productos**. Este sistema asegura que haya un m√©todo estructurado y organizado para identificar y gestionar una amplia variedad de objetos a trav√©s de diferentes proveedores y est√°ndares.

![](<../../.gitbook/assets/SNMP\_OID\_MIB\_Tree (1).png>)

Puedes **navegar** a trav√©s de un **√°rbol OID** desde la web aqu√≠: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) o **ver qu√© significa un OID** (como `1.3.6.1.2.1.1`) accediendo a [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Hay algunos **OID bien conocidos** como los que est√°n dentro de [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) que hacen referencia a las variables del Protocolo Simple de Gesti√≥n de Red (SNMP) definidas en MIB-2. Y desde los **OID pendientes de este** puedes obtener algunos datos interesantes del host (datos del sistema, datos de red, datos de procesos...)

### **Ejemplo de OID**

[**Ejemplo de aqu√≠**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Aqu√≠ hay un desglose de esta direcci√≥n.

* 1 ‚Äì esto se llama el ISO y establece que este es un OID. Por eso todos los OIDs comienzan con "1"
* 3 ‚Äì esto se llama ORG y se utiliza para especificar la organizaci√≥n que fabric√≥ el dispositivo.
* 6 ‚Äì este es el dod o el Departamento de Defensa, que es la organizaci√≥n que estableci√≥ primero Internet.
* 1 ‚Äì este es el valor de internet para denotar que todas las comunicaciones ocurrir√°n a trav√©s de Internet.
* 4 ‚Äì este valor determina que este dispositivo es fabricado por una organizaci√≥n privada y no por una gubernamental.
* 1 ‚Äì este valor denota que el dispositivo es fabricado por una empresa o entidad comercial.

Estos primeros seis valores tienden a ser los mismos para todos los dispositivos y te dan la informaci√≥n b√°sica sobre ellos. Esta secuencia de n√∫meros ser√° la misma para todos los OIDs, excepto cuando el dispositivo es fabricado por el gobierno.

Pasando al siguiente conjunto de n√∫meros.

* 1452 ‚Äì da el nombre de la organizaci√≥n que fabric√≥ este dispositivo.
* 1 ‚Äì explica el tipo de dispositivo. En este caso, es un reloj despertador.
* 2 ‚Äì determina que este dispositivo es una unidad terminal remota.

El resto de los valores dan informaci√≥n espec√≠fica sobre el dispositivo.

* 5 ‚Äì denota un punto de alarma discreto.
* 1 ‚Äì punto espec√≠fico en el dispositivo
* 3 ‚Äì puerto
* 21 ‚Äì direcci√≥n del puerto
* 1 ‚Äì visualizaci√≥n para el puerto
* 4 ‚Äì n√∫mero de punto
* 7 ‚Äì estado del punto

### Versiones de SNMP

Hay 2 versiones importantes de SNMP:

* **SNMPv1**: Principal, sigue siendo la m√°s frecuente, la **autenticaci√≥n se basa en una cadena** (cadena de comunidad) que viaja en **texto plano** (toda la informaci√≥n viaja en texto plano). **La versi√≥n 2 y 2c** tambi√©n env√≠an el **tr√°fico en texto plano** y utilizan una **cadena de comunidad como autenticaci√≥n**.
* **SNMPv3**: Utiliza una mejor forma de **autenticaci√≥n** y la informaci√≥n viaja **encriptada** (se podr√≠a realizar un **ataque de diccionario**, pero ser√≠a mucho m√°s dif√≠cil encontrar las credenciales correctas que en SNMPv1 y v2).

### Cadenas de Comunidad

Como se mencion√≥ antes, **para acceder a la informaci√≥n guardada en el MIB necesitas conocer la cadena de comunidad en las versiones 1 y 2/2c y las credenciales en la versi√≥n 3.**\
Hay **2 tipos de cadenas de comunidad**:

* **`public`** principalmente funciones **solo de lectura**
* **`private`** **Lectura/Escritura** en general

Ten en cuenta que **la capacidad de escritura de un OID depende de la cadena de comunidad utilizada**, as√≠ que **incluso** si encuentras que se est√° utilizando "**public**", podr√≠as ser capaz de **escribir algunos valores.** Tambi√©n, puede **existir** objetos que son **siempre "Solo Lectura".**\
Si intentas **escribir** un objeto se recibe un error **`noSuchName` o `readOnly`**.\*\*.\*\*

En las versiones 1 y 2/2c, si usas una **mala** cadena de comunidad, el servidor no **responder√°**. As√≠ que, si responde, se utiliz√≥ una **cadena de comunidad v√°lida**.

## Puertos

[De Wikipedia](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol):

* El agente SNMP recibe solicitudes en el puerto UDP **161**.
* El administrador recibe notificaciones ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) y [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) en el puerto **162**.
* Cuando se utiliza con [Seguridad de Capa de Transporte](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) o [Seguridad de Transporte de Datagramas](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), las solicitudes se reciben en el puerto **10161** y las notificaciones se env√≠an al puerto **10162**.

## Fuerza Bruta de la Cadena de Comunidad (v1 y v2c)

Para **adivinar la cadena de comunidad** podr√≠as realizar un ataque de diccionario. Consulta [aqu√≠ diferentes formas de realizar un ataque de fuerza bruta contra SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Una cadena de comunidad frecuentemente utilizada es `public`.

## Enumerando SNMP

Se recomienda instalar lo siguiente para ver qu√© significa **cada OID recopilado** del dispositivo:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Si conoces una cadena de comunidad v√°lida, puedes acceder a los datos utilizando **SNMPWalk** o **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Gracias a las consultas extendidas (download-mibs), es posible enumerar a√∫n m√°s sobre el sistema con el siguiente comando :
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** tiene mucha informaci√≥n sobre el host y cosas que pueden resultar interesantes son: **Interfaces de red** (direcci√≥n **IPv4** y **IPv6**), Nombres de usuario, Tiempo de actividad, Versi√≥n del servidor/SO, y **procesos**

**en ejecuci√≥n** (puede contener contrase√±as)....

### **Configuraciones Peligrosas**

En el √°mbito de la gesti√≥n de redes, ciertas configuraciones y par√°metros son clave para garantizar una supervisi√≥n y control completos.

### Configuraciones de Acceso

Dos configuraciones principales permiten el acceso al **√°rbol OID completo**, que es un componente crucial en la gesti√≥n de redes:

1. **`rwuser noauth`** est√° configurado para permitir el acceso completo al √°rbol OID sin necesidad de autenticaci√≥n. Esta configuraci√≥n es sencilla y permite un acceso sin restricciones.
2. Para un control m√°s espec√≠fico, se puede otorgar acceso utilizando:
* **`rwcommunity`** para direcciones **IPv4**, y
* **`rwcommunity6`** para direcciones **IPv6**.

Ambos comandos requieren una **cadena de comunidad** y la direcci√≥n IP relevante, ofreciendo acceso completo independientemente del origen de la solicitud.

### Par√°metros SNMP para Microsoft Windows

Una serie de **valores de la Base de Informaci√≥n de Gesti√≥n (MIB)** se utilizan para monitorear varios aspectos de un sistema Windows a trav√©s de SNMP:

* **Procesos del Sistema**: Accedido a trav√©s de `1.3.6.1.2.1.25.1.6.0`, este par√°metro permite el monitoreo de procesos activos dentro del sistema.
* **Programas en Ejecuci√≥n**: El valor `1.3.6.1.2.1.25.4.2.1.2` est√° designado para rastrear programas actualmente en ejecuci√≥n.
* **Ruta de Procesos**: Para determinar de d√≥nde se est√° ejecutando un proceso, se utiliza el valor MIB `1.3.6.1.2.1.25.4.2.1.4`.
* **Unidades de Almacenamiento**: El monitoreo de unidades de almacenamiento se facilita mediante `1.3.6.1.2.1.25.2.3.1.4`.
* **Nombre del Software**: Para identificar el software instalado en un sistema, se emplea `1.3.6.1.2.1.25.6.3.1.2`.
* **Cuentas de Usuario**: El valor `1.3.6.1.4.1.77.1.2.25` permite el seguimiento de cuentas de usuario.
* **Puertos Locales TCP**: Finalmente, `1.3.6.1.2.1.6.13.1.3` est√° designado para monitorear puertos locales TCP, proporcionando informaci√≥n sobre conexiones de red activas.

### Cisco

Echa un vistazo a esta p√°gina si tienes equipos Cisco:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## De SNMP a RCE

Si tienes la **cadena** que te permite **escribir valores** dentro del servicio SNMP, es posible que puedas abusar de ella para **ejecutar comandos**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **SNMP Masivo**

[Braa ](https://github.com/mteg/braa) es un esc√°ner SNMP masivo. El uso previsto de tal herramienta es, por supuesto, realizar consultas SNMP, pero a diferencia de snmpwalk de net-snmp, es capaz de consultar decenas o cientos de hosts simult√°neamente, y en un solo proceso. As√≠, consume muy pocos recursos del sistema y realiza el escaneo MUY r√°pido.

Braa implementa su PROPIO stack SNMP, por lo que NO necesita ninguna biblioteca SNMP como net-snmp.

**Sintaxis:** braa \[Cadena-de-comunidad]@\[IP del servidor SNMP]:\[id iso]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Esto puede extraer muchos MB de informaci√≥n que no puedes procesar manualmente.

As√≠ que, busquemos la informaci√≥n m√°s interesante (de [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### **Dispositivos**

El proceso comienza con la extracci√≥n de **sysDesc MIB data** (1.3.6.1.2.1.1.1.0) de cada archivo para identificar los dispositivos. Esto se logra mediante el uso de un **grep command**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Identificar Cadena Privada**

Un paso crucial implica identificar la **cadena de comunidad privada** utilizada por las organizaciones, particularmente en los enrutadores Cisco IOS. Esta cadena permite la extracci√≥n de **configuraciones en ejecuci√≥n** de los enrutadores. La identificaci√≥n a menudo se basa en analizar los datos de SNMP Trap en busca de la palabra "trap" con un **comando grep**:
```bash
grep -i "trap" *.snmp
```
### **Nombres de usuario/Contrase√±as**

Los registros almacenados en las tablas MIB se examinan en busca de **intentos de inicio de sesi√≥n fallidos**, que podr√≠an incluir accidentalmente contrase√±as ingresadas como nombres de usuario. Se buscan palabras clave como _fail_, _failed_ o _login_ para encontrar datos valiosos:
```bash
grep -i "login\|fail" *.snmp
```
### **Emails**

Finalmente, para extraer **direcciones de correo electr√≥nico** de los datos, se utiliza un **comando grep** con una expresi√≥n regular, centr√°ndose en patrones que coinciden con formatos de correo electr√≥nico:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modificando valores SNMP

Puedes usar _**NetScanTools**_ para **modificar valores**. Necesitar√°s conocer la **cadena privada** para hacerlo.

## Suplantaci√≥n

Si hay una ACL que solo permite que algunas IPs consulten el servicio SMNP, puedes suplantar una de estas direcciones dentro del paquete UDP y espiar el tr√°fico.

## Examinar archivos de configuraci√≥n SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Si est√°s interesado en una **carrera de hacking** y en hackear lo inhackeable - **¬°estamos contratando!** (_se requiere polaco fluido escrito y hablado_).

{% embed url="https://www.stmcyber.com/careers" %}

## HackTricks Comandos Autom√°ticos
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp


```
{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
