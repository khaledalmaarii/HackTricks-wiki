# 161,162,10161,10162/udp - Pentesting SNMP

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Wenn Sie an einer **Hacking-Karriere** interessiert sind und das Unhackbare hacken m√∂chten - **wir stellen ein!** (_flie√üend Polnisch in Wort und Schrift erforderlich_).

{% embed url="https://www.stmcyber.com/careers" %}

## Grundinformationen

**SNMP - Simple Network Management Protocol** ist ein Protokoll, das verwendet wird, um verschiedene Ger√§te im Netzwerk (wie Router, Switches, Drucker, IoTs...) zu √ºberwachen.
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP verwendet auch den Port **162/UDP** f√ºr **Traps**. Dies sind Daten **Pakete, die vom SNMP-Server an den Client gesendet werden, ohne dass sie ausdr√ºcklich angefordert werden**.
{% endhint %}

### MIB

Um sicherzustellen, dass der SNMP-Zugriff hersteller√ºbergreifend und mit verschiedenen Client-Server-Kombinationen funktioniert, wurde die **Management Information Base (MIB)** erstellt. MIB ist ein **unabh√§ngiges Format zur Speicherung von Ger√§teinformationen**. Eine MIB ist eine **Text**-Datei, in der alle abfragbaren **SNMP-Objekte** eines Ger√§ts in einer **standardisierten** Baumhierarchie aufgef√ºhrt sind. Sie enth√§lt mindestens einen `Object Identifier` (`OID`), der neben der erforderlichen **eindeutigen Adresse** und einem **Namen** auch Informationen √ºber den Typ, die Zugriffsrechte und eine Beschreibung des jeweiligen Objekts bereitstellt.\
MIB-Dateien sind im `Abstract Syntax Notation One` (`ASN.1`) basierten ASCII-Textformat geschrieben. Die **MIBs enthalten keine Daten**, sondern erkl√§ren **wo welche Informationen zu finden sind** und wie sie aussehen, welche R√ºckgabewerte f√ºr die spezifische OID zur√ºckgegeben werden oder welcher Datentyp verwendet wird.

### OIDs

**Object Identifiers (OIDs)** spielen eine entscheidende Rolle. Diese eindeutigen Identifikatoren sind daf√ºr ausgelegt, Objekte innerhalb einer **Management Information Base (MIB)** zu verwalten.

Die h√∂chsten Ebenen der MIB-Objekt-IDs oder OIDs sind verschiedenen standardsetzenden Organisationen zugewiesen. Innerhalb dieser obersten Ebenen wird der Rahmen f√ºr globale Managementpraktiken und -standards festgelegt.

Dar√ºber hinaus haben Anbieter die Freiheit, private Zweige zu schaffen. Innerhalb dieser Zweige haben sie die **Autonomie, verwaltete Objekte, die f√ºr ihre eigenen Produktlinien relevant sind, einzuschlie√üen**. Dieses System stellt sicher, dass es eine strukturierte und organisierte Methode zur Identifizierung und Verwaltung einer Vielzahl von Objekten √ºber verschiedene Anbieter und Standards hinweg gibt.

![](<../../.gitbook/assets/SNMP\_OID\_MIB\_Tree (1).png>)

Sie k√∂nnen durch einen **OID-Baum** hier im Web navigieren: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) oder **sehen, was eine OID bedeutet** (wie `1.3.6.1.2.1.1`), indem Sie [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1) aufrufen.\
Es gibt einige **bekannte OIDs**, wie die innerhalb von [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1), die auf die MIB-2 definierten Simple Network Management Protocol (SNMP)-Variablen verweisen. Und von den **OIDs, die von dieser abh√§ngen**, k√∂nnen Sie einige interessante Hostdaten (Systemdaten, Netzwerkdaten, Prozessdaten...) erhalten.

### **OID Beispiel**

[**Beispiel von hier**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Hier ist eine Aufschl√ºsselung dieser Adresse.

* 1 ‚Äì dies wird als ISO bezeichnet und stellt fest, dass dies eine OID ist. Deshalb beginnen alle OIDs mit ‚Äû1‚Äú.
* 3 ‚Äì dies wird als ORG bezeichnet und wird verwendet, um die Organisation anzugeben, die das Ger√§t gebaut hat.
* 6 ‚Äì dies ist das dod oder das Department of Defense, das die Organisation ist, die das Internet zuerst etabliert hat.
* 1 ‚Äì dies ist der Wert des Internets, um anzuzeigen, dass alle Kommunikationen √ºber das Internet stattfinden.
* 4 ‚Äì dieser Wert bestimmt, dass dieses Ger√§t von einer privaten Organisation und nicht von einer Regierungsorganisation hergestellt wurde.
* 1 ‚Äì dieser Wert zeigt an, dass das Ger√§t von einem Unternehmen oder einer Gesch√§ftseinheit hergestellt wurde.

Diese ersten sechs Werte sind f√ºr alle Ger√§te gleich und geben Ihnen die grundlegenden Informationen √ºber sie. Diese Zahlenfolge wird f√ºr alle OIDs gleich sein, es sei denn, das Ger√§t wird von der Regierung hergestellt.

Weiter zu der n√§chsten Zahlenreihe.

* 1452 ‚Äì gibt den Namen der Organisation an, die dieses Ger√§t hergestellt hat.
* 1 ‚Äì erkl√§rt die Art des Ger√§ts. In diesem Fall handelt es sich um einen Wecker.
* 2 ‚Äì bestimmt, dass dieses Ger√§t eine Fernbedienungseinheit ist.

Die restlichen Werte geben spezifische Informationen √ºber das Ger√§t.

* 5 ‚Äì bezeichnet einen diskreten Alarmpunkt.
* 1 ‚Äì spezifischer Punkt im Ger√§t
* 3 ‚Äì Port
* 21 ‚Äì Adresse des Ports
* 1 ‚Äì Anzeige f√ºr den Port
* 4 ‚Äì Punktnummer
* 7 ‚Äì Zustand des Punktes

### SNMP-Versionen

Es gibt 2 wichtige Versionen von SNMP:

* **SNMPv1**: Hauptversion, sie ist immer noch die h√§ufigste, die **Authentifizierung basiert auf einer Zeichenfolge** (Community-String), die in **Klartext** √ºbertragen wird (alle Informationen werden im Klartext √ºbertragen). **Version 2 und 2c** senden den **Verkehr ebenfalls im Klartext** und verwenden einen **Community-String als Authentifizierung**.
* **SNMPv3**: Verwendet eine bessere **Authentifizierungs**form und die Informationen werden **verschl√ºsselt** √ºbertragen (ein **Dictionary-Angriff** k√∂nnte durchgef√ºhrt werden, w√§re aber viel schwieriger, die richtigen Anmeldeinformationen zu finden als in SNMPv1 und v2).

### Community-Strings

Wie bereits erw√§hnt, **um auf die im MIB gespeicherten Informationen zuzugreifen, m√ºssen Sie den Community-String in den Versionen 1 und 2/2c und die Anmeldeinformationen in Version 3 kennen.**\
Es gibt **2 Arten von Community-Strings**:

* **`public`** haupts√§chlich **nur Lese**-Funktionen
* **`private`** **Lese/Schreib** im Allgemeinen

Beachten Sie, dass **die Schreibbarkeit einer OID vom verwendeten Community-String abh√§ngt**, sodass **selbst** wenn Sie feststellen, dass ‚Äû**public**‚Äú verwendet wird, Sie m√∂glicherweise in der Lage sind, **einige Werte zu schreiben.** Au√üerdem **kann** es Objekte geben, die **immer "Nur Lesen" sind.**\
Wenn Sie versuchen, ein Objekt zu **schreiben**, wird ein **`noSuchName` oder `readOnly`-Fehler** empfangen\*\*.\*\*

In den Versionen 1 und 2/2c wird der Server nicht **antworten**, wenn Sie einen **schlechten** Community-String verwenden. Wenn er antwortet, wurde ein **g√ºltiger Community-String verwendet**.

## Ports

[Von Wikipedia](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol):

* Der SNMP-Agent empf√§ngt Anfragen am UDP-Port **161**.
* Der Manager empf√§ngt Benachrichtigungen ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) und [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) am Port **162**.
* Wenn er mit [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) oder [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security) verwendet wird, werden Anfragen am Port **10161** empfangen und Benachrichtigungen an den Port **10162** gesendet.

## Brute-Force Community-String (v1 und v2c)

Um den **Community-String zu erraten**, k√∂nnten Sie einen Dictionary-Angriff durchf√ºhren. √úberpr√ºfen Sie [hier verschiedene M√∂glichkeiten, einen Brute-Force-Angriff gegen SNMP durchzuf√ºhren](../../generic-methodologies-and-resources/brute-force.md#snmp). Ein h√§ufig verwendeter Community-String ist `public`.

## Aufz√§hlung von SNMP

Es wird empfohlen, Folgendes zu installieren, um zu sehen, was **jede gesammelte OID** vom Ger√§t bedeutet:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Wenn Sie eine g√ºltige Community-String kennen, k√∂nnen Sie die Daten mit **SNMPWalk** oder **SNMP-Check** abrufen:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Dank erweiterter Abfragen (download-mibs) ist es m√∂glich, noch mehr √ºber das System mit dem folgenden Befehl zu enumerieren:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** hat viele Informationen √ºber den Host, und Dinge, die Sie interessant finden k√∂nnten, sind: **Netzwerkschnittstellen** (IPv4- und **IPv6**-Adresse), Benutzernamen, Betriebszeit, Server-/Betriebssystemversion und **Prozesse**

**laufend** (kann Passw√∂rter enthalten)....

### **Gef√§hrliche Einstellungen**

Im Bereich des Netzwerkmanagements sind bestimmte Konfigurationen und Parameter entscheidend f√ºr eine umfassende √úberwachung und Kontrolle.

### Zugriffseinstellungen

Zwei Hauptkonfigurationen erm√∂glichen den Zugriff auf den **vollst√§ndigen OID-Baum**, der ein entscheidendes Element im Netzwerkmanagement ist:

1. **`rwuser noauth`** ist so eingestellt, dass es vollen Zugriff auf den OID-Baum ohne Authentifizierung erm√∂glicht. Diese Einstellung ist unkompliziert und erlaubt uneingeschr√§nkten Zugriff.
2. F√ºr spezifischere Kontrollen kann der Zugriff gew√§hrt werden mit:
* **`rwcommunity`** f√ºr **IPv4**-Adressen und
* **`rwcommunity6`** f√ºr **IPv6**-Adressen.

Beide Befehle erfordern eine **Community-String** und die relevante IP-Adresse, die vollen Zugriff unabh√§ngig von der Herkunft der Anfrage bieten.

### SNMP-Parameter f√ºr Microsoft Windows

Eine Reihe von **Management Information Base (MIB)-Werten** wird verwendet, um verschiedene Aspekte eines Windows-Systems √ºber SNMP zu √ºberwachen:

* **Systemprozesse**: √úber `1.3.6.1.2.1.25.1.6.0` aufgerufen, erm√∂glicht dieser Parameter die √úberwachung aktiver Prozesse im System.
* **Laufende Programme**: Der Wert `1.3.6.1.2.1.25.4.2.1.2` ist f√ºr die Verfolgung aktuell laufender Programme vorgesehen.
* **Prozesspfad**: Um zu bestimmen, wo ein Prozess ausgef√ºhrt wird, wird der MIB-Wert `1.3.6.1.2.1.25.4.2.1.4` verwendet.
* **Speichereinheiten**: Die √úberwachung von Speichereinheiten wird durch `1.3.6.1.2.1.25.2.3.1.4` erleichtert.
* **Softwarename**: Um die auf einem System installierte Software zu identifizieren, wird `1.3.6.1.2.1.25.6.3.1.2` verwendet.
* **Benutzerkonten**: Der Wert `1.3.6.1.4.1.77.1.2.25` erm√∂glicht die Verfolgung von Benutzerkonten.
* **TCP-Lokale Ports**: Schlie√ülich ist `1.3.6.1.2.1.6.13.1.3` f√ºr die √úberwachung von TCP-lokalen Ports vorgesehen, was Einblicke in aktive Netzwerkverbindungen bietet.

### Cisco

Schauen Sie sich diese Seite an, wenn Sie Cisco-Ger√§te haben:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Von SNMP zu RCE

Wenn Sie die **String** haben, die es Ihnen erm√∂glicht, **Werte** im SNMP-Dienst **zu schreiben**, k√∂nnten Sie in der Lage sein, dies auszunutzen, um **Befehle auszuf√ºhren**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **Massives SNMP**

[Braa ](https://github.com/mteg/braa) ist ein massiver SNMP-Scanner. Die beabsichtigte Verwendung eines solchen Tools besteht nat√ºrlich darin, SNMP-Abfragen durchzuf√ºhren ‚Äì aber im Gegensatz zu snmpwalk von net-snmp kann es Dutzende oder Hunderte von Hosts gleichzeitig und in einem einzigen Prozess abfragen. Dadurch verbraucht es sehr wenige Systemressourcen und f√ºhrt das Scannen SEHR schnell durch.

Braa implementiert seinen eigenen SNMP-Stack, sodass es keine SNMP-Bibliotheken wie net-snmp ben√∂tigt.

**Syntax:** braa \[Community-String]@\[IP des SNMP-Servers]:\[iso id]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Dies kann eine Menge MB an Informationen extrahieren, die Sie nicht manuell verarbeiten k√∂nnen.

Schauen wir uns also die interessantesten Informationen an (von [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### **Ger√§te**

Der Prozess beginnt mit der Extraktion von **sysDesc MIB-Daten** (1.3.6.1.2.1.1.1.0) aus jeder Datei, um die Ger√§te zu identifizieren. Dies wird durch die Verwendung eines **grep-Befehls** erreicht:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Identifizieren Sie die private Zeichenfolge**

Ein entscheidender Schritt besteht darin, die **private Community-Zeichenfolge** zu identifizieren, die von Organisationen verwendet wird, insbesondere auf Cisco IOS-Routern. Diese Zeichenfolge erm√∂glicht das Extrahieren von **laufenden Konfigurationen** von Routern. Die Identifizierung basiert oft auf der Analyse von SNMP-Trap-Daten nach dem Wort "trap" mit einem **grep-Befehl**:
```bash
grep -i "trap" *.snmp
```
### **Benutzernamen/Passw√∂rter**

Protokolle, die in MIB-Tabellen gespeichert sind, werden auf **fehlgeschlagene Anmeldeversuche** untersucht, die versehentlich Passw√∂rter enthalten k√∂nnten, die als Benutzernamen eingegeben wurden. Schl√ºsselw√∂rter wie _fail_, _failed_ oder _login_ werden durchsucht, um wertvolle Daten zu finden:
```bash
grep -i "login\|fail" *.snmp
```
### **Emails**

Schlie√ülich wird ein **grep-Befehl** mit einem regul√§ren Ausdruck verwendet, um **E-Mail-Adressen** aus den Daten zu extrahieren, wobei der Fokus auf Mustern liegt, die E-Mail-Formate entsprechen:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modifizieren von SNMP-Werten

Sie k√∂nnen _**NetScanTools**_ verwenden, um **Werte zu √§ndern**. Sie m√ºssen die **private Zeichenfolge** kennen, um dies zu tun.

## Spoofing

Wenn es eine ACL gibt, die nur einigen IPs erlaubt, den SNMP-Dienst abzufragen, k√∂nnen Sie eine dieser Adressen im UDP-Paket f√§lschen und den Verkehr sniffen.

## √úberpr√ºfen von SNMP-Konfigurationsdateien

* snmp.conf
* snmpd.conf
* snmp-config.xml

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Wenn Sie an einer **Hacking-Karriere** interessiert sind und das Unhackbare hacken m√∂chten - **wir stellen ein!** (_flie√üend Polnisch in Wort und Schrift erforderlich_).

{% embed url="https://www.stmcyber.com/careers" %}

## HackTricks Automatische Befehle
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp


```
{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
