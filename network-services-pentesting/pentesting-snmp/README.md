# 161,162,10161,10162/udp - Pentesting SNMP

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Wskaz贸wka dotyczca bug bounty**: **zarejestruj si** na platformie **Intigriti**, premium **platformie bug bounty stworzonej przez haker贸w, dla haker贸w**! Docz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ju偶 dzi i zacznij zarabia nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Podstawowe informacje

**SNMP - Simple Network Management Protocol** to protok贸 u偶ywany do monitorowania r贸偶nych urzdze w sieci (takich jak routery, przeczniki, drukarki, urzdzenia IoT...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP u偶ywa r贸wnie偶 portu **162/UDP** do **puapek**. S to dane **pakiet贸w wysyanych z serwera SNMP do klienta bez wyra藕nego 偶dania**.
{% endhint %}

### MIB

Aby zapewni, 偶e dostp SNMP dziaa w r贸偶nych kombinacjach producent贸w i klient贸w-serwer贸w, utworzono **Management Information Base (MIB)**. MIB to **niezale偶ny format przechowywania informacji o urzdzeniu**. MIB to **plik tekstowy**, w kt贸rym wszystkie zapytywalne **obiekty SNMP** urzdzenia s wymienione w **standaryzowanej** hierarchii drzewa. Zawiera co najmniej jeden `Object Identifier` (`OID`), kt贸ry opr贸cz niezbdnego **unikalnego adresu** i **nazwy**, zawiera r贸wnie偶 informacje o typie, prawach dostpu i opisie danego obiektu.\
Pliki MIB s pisane w opartym na tekcie ASCII formacie `Abstract Syntax Notation One` (`ASN.1`). **MIBy nie zawieraj danych**, ale wyjaniaj **gdzie znale藕 jakie informacje** i jak to wyglda, zwracajc wartoci dla okrelonego OID lub jakiego typu danych u偶ywane s.

### OIDs

**Object Identifiers (OIDs)** odgrywaj kluczow rol. Te unikalne identyfikatory s przeznaczone do zarzdzania obiektami w **Management Information Base (MIB)**.

Najwy偶sze poziomy identyfikator贸w obiekt贸w MIB, czyli OIDs, s przydzielane r贸偶nym organizacjom ustalajcym standardy. To na tych najwy偶szych poziomach ustalane s ramy dla globalnych praktyk zarzdzania i standard贸w.

Ponadto, producentom przyznaje si swobod tworzenia prywatnych gazi. W ramach tych gazi maj **autonomi do uwzgldniania zarzdzanych obiekt贸w zwizanych z ich wasnymi liniami produkt贸w**. Ten system zapewnia strukturaln i zorganizowan metod identyfikacji i zarzdzania r贸偶nymi obiektami w r贸偶nych producentach i standardach.

![](../../.gitbook/assets/snmp\_oid\_mib\_tree.png)

Mo偶esz **nawigowa** przez **drzewo OID** tutaj: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) lub **zobaczy, co oznacza OID** (jak `1.3.6.1.2.1.1`) przechodzc do [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Istniej pewne **znane OIDs**, takie jak te wewntrz [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1), kt贸re odnosz si do zmiennych protokou SNMP zdefiniowanych w MIB-2. A z **OID贸w zale偶nych od tego** mo偶na uzyska pewne interesujce dane hosta (dane systemowe, dane sieciowe, dane proces贸w...)

### **Przykad OID**

[**Przykad std**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Oto rozbicie tego adresu.

* 1 - to jest nazywane ISO i ustala, 偶e jest to OID. Dlatego wszystkie OIDs zaczynaj si od "1"
* 3 - to jest nazywane ORG i su偶y do okrelenia organizacji, kt贸ra zbudowaa urzdzenie.
* 6 - to jest dod lub Department of Defense, czyli organizacja, kt贸ra jako pierwsza ustanowia Internet.
* 1 - to jest warto internetu, oznaczajca, 偶e caa komunikacja bdzie odbywa si przez Internet.
* 4 - ta warto okrela, 偶e to urzdzenie jest produkowane przez prywatn organizacj, a nie rzdow.
* 1 - ta warto oznacza, 偶e urzdzenie jest produkowane przez przedsibiorstwo lub jednostk biznesow.

Te pierwsze sze wartoci s zwykle takie same dla wszystkich urzdze i daj podstawowe informacje o nich. Ta sekwencja liczb bdzie taka sama dla wszystkich OIDs, z wyjtkiem urzdze produkowanych przez rzd.

Przechodzc do nastpnego zestawu liczb.

* 1452 - podaje nazw organizacji, kt贸ra wyprodukowaa to urzdzenie.
* 1 - wyjania rodzaj urzdzenia. W tym przypadku jest to budzik.
* 2 - okrela, 偶e to urzdzenie jest zdaln jednostk terminalow.

Reszta wartoci podaje konkretne informacje o urzdzeniu.

* 5 - oznacza dyskretny punkt alarmowy.
* 1 - konkretny punkt w urzdzeniu
* 3 - port
* 21 - adres portu
* 1 - wywietlacz dla portu
* 4 - numer punktu
* 7 - stan punktu

### Wersje SNMP

Istniej 2 wa偶ne wersje SNMP:

* **SNMPv1**: G贸wna wersja, nadal najczstsza, **uwierzytelnianie oparte jest na cigu znak贸w** (community string), kt贸ry przesya si w **tekcie jawnym** (wszystkie informacje przesyane s w tekcie jawnym). **Wersje 2 i 2c** r贸wnie偶 przesyaj ruch w tekcie jawnym i u偶ywaj cigu znak贸w community jako uwierzytelnienia.
* **SNMPv3**: U偶ywa lepszej formy **uwierzytelniania**, a informacje przesyane s **szyfrowane** (atak sownikowy mo偶e by przeprowadzony, ale znalezienie poprawnych powiadcze byoby trudniejsze ni偶 w SNMPv1 i v2).

### Cigi community

Jak ju偶 wspomniano, **aby uzyska dostp do informacji zapisanych w MIB, musisz zna cig community w wersjach 1 i 2/2c oraz powiadczenia w wersji 3.**\
Istniej **2 rodzaje cig贸w community**:

* **`public`** g贸wnie funkcje **tylko do odczytu**
* **`private`** **Odczyt/Zapis** og贸lnie

Nale偶y zauwa偶y, 偶e **mo偶liwo zapisu OID zale偶y od u偶ytego cigu community**, wic **nawet** jeli oka偶e si, 偶e u偶ywane jest "**publiczne**", mo偶esz mie mo偶liwo **zapisu niekt贸rych wartoci**. Istniej r贸wnie偶 obiekty, kt贸re s **zawsze "tylko do odczytu"**.\
Jeli spr贸bujesz **zapisa** obiekt, otrzymasz bd **`noSuchName` lub `readOnly`**.

W wersjach 1 i 2/2c, jeli u偶yjesz **nieprawidowego** cigu community, serwer nie **odpowie**. Wic jeli otrzymasz odpowied藕, u偶yto **poprawnego cigu community**.

## Porty

[Z Wikipedii](https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol#:~:text=All%20SNMP%20messages%20are%20transported,port%20161%20in%20the%20agent.):

* Agent SNMP odbiera 偶dania na porcie UDP **161**.
* Manager odbiera powiadomienia ([Puapki](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) i [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) na porcie **162**.
* Gdy u偶ywane jest [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) lub [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), 偶dania s odbierane na porcie **10161**, a powiadomienia s wysyane na port **10162**.

## Brute-Force cigu community (v1 i v2c)

Aby **odgadn cig community**, mo偶na przeprowadzi atak sownikowy. Sprawd藕 [tutaj r贸偶ne sposoby przeprowadzania ataku brute-force na SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). Czsto u偶ywanym cigiem community jest `public`.
## Wyliczanie SNMP

Zaleca si zainstalowanie nastpujcych narzdzi, aby zobaczy, co oznacza **ka偶dy zebrany OID** z urzdzenia:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Jeli znasz prawidowy cig spoecznoci, mo偶esz uzyska dostp do danych za pomoc **SNMPWalk** lub **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Dziki rozszerzonym zapytaniom (download-mibs) mo偶na jeszcze bardziej wylicza informacje o systemie za pomoc nastpujcej komendy:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** zawiera wiele informacji o hocie, a interesujce mog by: **interfejsy sieciowe** (adresy IPv4 i **IPv6**), nazwy u偶ytkownik贸w, czas pracy, wersja serwera/OS oraz **procesy**

**uruchomione** (mog zawiera hasa)....

### **Niebezpieczne ustawienia**

W dziedzinie zarzdzania sieci istnieje kilka konfiguracji i parametr贸w, kt贸re s kluczowe dla zapewnienia wszechstronnego monitorowania i kontroli.

### Ustawienia dostpu

Dwa g贸wne ustawienia umo偶liwiaj dostp do **penego drzewa OID**, kt贸re jest kluczowym elementem w zarzdzaniu sieci:

1. **`rwuser noauth`** jest ustawione, aby umo偶liwi peny dostp do drzewa OID bez koniecznoci uwierzytelniania. To ustawienie jest proste i pozwala na nieograniczony dostp.

2. Dla bardziej szczeg贸owej kontroli dostpu mo偶na przyzna dostp za pomoc:
- **`rwcommunity`** dla adres贸w **IPv4**, oraz
- **`rwcommunity6`** dla adres贸w **IPv6**.

Oba polecenia wymagaj **cigu spoecznociowego** i odpowiedniego adresu IP, oferujc peny dostp niezale偶nie od pochodzenia 偶dania.

### Parametry SNMP dla systemu Microsoft Windows

Do monitorowania r贸偶nych aspekt贸w systemu Windows za pomoc SNMP wykorzystuje si seri wartoci **Management Information Base (MIB)**:

- **Procesy systemowe**: Dostpne za pomoc `1.3.6.1.2.1.25.1.6.0`, ten parametr umo偶liwia monitorowanie aktywnych proces贸w w systemie.
- **Uruchomione programy**: Warto `1.3.6.1.2.1.25.4.2.1.2` jest przeznaczona do ledzenia aktualnie uruchomionych program贸w.
- **cie偶ka proces贸w**: Aby okreli, z jakiego miejsca uruchamiany jest proces, u偶ywa si wartoci MIB `1.3.6.1.2.1.25.4.2.1.4`.
- **Jednostki pamici**: Monitorowanie jednostek pamici jest uatwione dziki `1.3.6.1.2.1.25.2.3.1.4`.
- **Nazwa oprogramowania**: Aby zidentyfikowa zainstalowane oprogramowanie na systemie, u偶ywa si `1.3.6.1.2.1.25.6.3.1.2`.
- **Konta u偶ytkownik贸w**: Warto `1.3.6.1.4.1.77.1.2.25` umo偶liwia ledzenie kont u偶ytkownik贸w.
- **Lokalne porty TCP**: Na koniec, `1.3.6.1.2.1.6.13.1.3` jest przeznaczony do monitorowania lokalnych port贸w TCP, co pozwala uzyska informacje o aktywnych poczeniach sieciowych.

### Cisco

Jeli korzystasz z urzdze Cisco, zajrzyj na t stron:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Od SNMP do RCE

Jeli masz **cig**, kt贸ry umo偶liwia **zapisywanie wartoci** w usudze SNMP, mo偶esz go wykorzysta do **wykonywania polece**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **Masywne SNMP**

[Braa](https://github.com/mteg/braa) to masowy skaner SNMP. Przeznaczeniem tego narzdzia jest oczywicie wykonywanie zapyta SNMP - ale w przeciwiestwie do snmpwalk z net-snmp, jest ono w stanie zapyta dziesitki lub setki host贸w jednoczenie, i to w jednym procesie. Dlatego zu偶ywa bardzo mao zasob贸w systemowych i skanuje BARDZO szybko.

Braa implementuje WASNY stos SNMP, wic nie potrzebuje 偶adnych bibliotek SNMP, takich jak net-snmp.

**Skadnia:** braa \[Cig spoecznociowy]@\[Adres IP serwera SNMP]:\[iso id]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
To mo偶e wydoby du偶o MB informacji, kt贸re nie da si przetworzy rcznie.


Wic, szukajmy najbardziej interesujcych informacji (z [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):


### **Urzdzenia**

Proces rozpoczyna si od wydobycia danych **sysDesc MIB** (1.3.6.1.2.1.1.1.0) z ka偶dego pliku, aby zidentyfikowa urzdzenia. Dokonuje si tego za pomoc polecenia **grep**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Zidentyfikuj prywatny cig znak贸w**

Kluczowym krokiem jest zidentyfikowanie **prywatnego cigu znak贸w spoecznociowego**, u偶ywanego przez organizacje, zwaszcza na routerach Cisco IOS. Ten cig znak贸w umo偶liwia wydobycie **konfiguracji dziaajcej** z router贸w. Identyfikacja czsto polega na analizie danych SNMP Trap w poszukiwaniu sowa "trap" za pomoc polecenia **grep**:
```bash
grep -i "trap" *.snmp
```
### **Nazwy u偶ytkownik贸w/Hasa**

Rejestry przechowywane w tabelach MIB s analizowane pod ktem **nieudanych pr贸b logowania**, kt贸re przypadkowo mog zawiera hasa wprowadzone jako nazwy u偶ytkownik贸w. Sowa kluczowe takie jak _fail_, _failed_ lub _login_ s wyszukiwane w celu znalezienia cennych danych:
```bash
grep -i "login\|fail" *.snmp
```
### **Emaile**

W kocu, aby wyodrbni **adresy e-mail** z danych, u偶ywane jest polecenie **grep** z wyra偶eniem regularnym, skupiajce si na wzorcach pasujcych do format贸w adres贸w e-mail:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modyfikowanie wartoci SNMP

Mo偶esz u偶y _**NetScanTools**_ do **modyfikowania wartoci**. Bdziesz musia zna **prywatny cig znak贸w**, aby to zrobi.

## Spoofing

Jeli istnieje lista kontrolna dostpu (ACL), kt贸ra pozwala tylko niekt贸rym adresom IP na zapytanie usugi SNMP, mo偶esz podszy si pod jeden z tych adres贸w wewntrz pakietu UDP i podsucha ruch.

## Badanie plik贸w konfiguracyjnych SNMP

* snmp.conf
* snmpd.conf
* snmp-config.xml

## Automatyczne polecenia HackTricks
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp
```
<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Wskaz贸wka dotyczca bug bounty**: **Zarejestruj si** na platformie **Intigriti**, premium platformie bug bounty stworzonej przez haker贸w dla haker贸w! Docz do nas ju偶 dzi na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) i zacznij zarabia nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
