# 161,162,10161,10162/udp - Pentesting SNMP

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

If you are interested in **hacking career** and hack the unhackable - **we are hiring!** (_fluent polish written and spoken required_).

{% embed url="https://www.stmcyber.com/careers" %}

## Basic Information

**SNMP - Simple Network Management Protocol** je protokol koji se koristi za praÄ‡enje razliÄitih ureÄ‘aja u mreÅ¾i (kao Å¡to su ruteri, prekidaÄi, Å¡tampaÄi, IoT ureÄ‘aji...).
```
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)
```
{% hint style="info" %}
SNMP takoÄ‘e koristi port **162/UDP** za **trape**. To su podaci **paketi poslati sa SNMP servera klijentu bez eksplicitnog zahteva**.
{% endhint %}

### MIB

Da bi se osiguralo da SNMP pristup funkcioniÅ¡e meÄ‘u proizvoÄ‘aÄima i sa razliÄitim kombinacijama klijent-server, **Management Information Base (MIB)** je stvoren. MIB je **nezavistan format za Äuvanje informacija o ureÄ‘aju**. MIB je **tekstualna** datoteka u kojoj su svi upitni **SNMP objekti** ureÄ‘aja navedeni u **standardizovanoj** hijerarhiji stabla. SadrÅ¾i najmanje jedan `Object Identifier` (`OID`), koji, pored potrebne **jedinstvene adrese** i **imena**, takoÄ‘e pruÅ¾a informacije o tipu, pravima pristupa i opisu odgovarajuÄ‡eg objekta.\
MIB datoteke su napisane u `Abstract Syntax Notation One` (`ASN.1`) zasnovanom ASCII tekstualnom formatu. **MIB-ovi ne sadrÅ¾e podatke**, ali objaÅ¡njavaju **gde pronaÄ‡i koje informacije** i kako izgledaju, koje vraÄ‡a vrednosti za specifiÄni OID, ili koji tip podataka se koristi.

### OIDs

**Object Identifiers (OIDs)** igraju kljuÄnu ulogu. Ovi jedinstveni identifikatori su dizajnirani za upravljanje objektima unutar **Management Information Base (MIB)**.

NajviÅ¡i nivoi MIB identifikatora objekata, ili OIDs, su dodeljeni raznim organizacijama koje postavljaju standarde. Unutar ovih najviÅ¡ih nivoa uspostavlja se okvir za globalne prakse i standarde upravljanja.

Pored toga, proizvoÄ‘aÄima je data sloboda da uspostave privatne grane. Unutar ovih grana, imaju **autonomiju da ukljuÄe upravljane objekte relevantne za svoje proizvodne linije**. Ovaj sistem osigurava da postoji strukturiran i organizovan naÄin za identifikaciju i upravljanje Å¡irokim spektrom objekata meÄ‘u razliÄitim proizvoÄ‘aÄima i standardima.

![](<../../.gitbook/assets/SNMP\_OID\_MIB\_Tree (1).png>)

MoÅ¾ete **navigirati** kroz **OID stablo** sa veba ovde: [http://www.oid-info.com/cgi-bin/display?tree=#focus](http://www.oid-info.com/cgi-bin/display?tree=#focus) ili **videti Å¡ta OID znaÄi** (kao `1.3.6.1.2.1.1`) pristupajuÄ‡i [http://oid-info.com/get/1.3.6.1.2.1.1](http://oid-info.com/get/1.3.6.1.2.1.1).\
Postoje neki **poznati OIDs** kao Å¡to su oni unutar [1.3.6.1.2.1](http://oid-info.com/get/1.3.6.1.2.1) koji se odnose na MIB-2 definisane Simple Network Management Protocol (SNMP) varijable. I iz **OIDs koji zavise od ovog** moÅ¾ete dobiti neke zanimljive podatke o hostu (sistemskim podacima, mreÅ¾nim podacima, podacima o procesima...)

### **Primer OID-a**

[**Primer odavde**](https://www.netadmintools.com/snmp-mib-and-oids/):

**`1 . 3 . 6 . 1 . 4 . 1 . 1452 . 1 . 2 . 5 . 1 . 3. 21 . 1 . 4 . 7`**

Evo razlaganja ove adrese.

* 1 â€“ ovo se zove ISO i uspostavlja da je ovo OID. Zato svi OIDs poÄinju sa â€œ1â€
* 3 â€“ ovo se zove ORG i koristi se za specificiranje organizacije koja je izgradila ureÄ‘aj.
* 6 â€“ ovo je dod ili Ministarstvo odbrane koje je organizacija koja je prvi uspostavila Internet.
* 1 â€“ ova vrednost oznaÄava internet da oznaÄi da Ä‡e sve komunikacije biti obavljene putem Interneta.
* 4 â€“ ova vrednost odreÄ‘uje da je ovaj ureÄ‘aj napravljen od strane privatne organizacije, a ne vladine.
* 1 â€“ ova vrednost oznaÄava da je ureÄ‘aj napravljen od strane preduzeÄ‡a ili poslovnog entiteta.

Ovih prvih Å¡est vrednosti obiÄno su iste za sve ureÄ‘aje i daju vam osnovne informacije o njima. Ova sekvenca brojeva biÄ‡e ista za sve OIDs, osim kada je ureÄ‘aj napravljen od strane vlade.

Prelazimo na sledeÄ‡i set brojeva.

* 1452 â€“ daje ime organizacije koja je proizvela ovaj ureÄ‘aj.
* 1 â€“ objaÅ¡njava tip ureÄ‘aja. U ovom sluÄaju, to je budilnik.
* 2 â€“ odreÄ‘uje da je ovaj ureÄ‘aj daljinski terminal.

Ostatak vrednosti daje specifiÄne informacije o ureÄ‘aju.

* 5 â€“ oznaÄava diskretnu taÄku alarma.
* 1 â€“ specifiÄna taÄka u ureÄ‘aju
* 3 â€“ port
* 21 â€“ adresa porta
* 1 â€“ prikaz za port
* 4 â€“ broj taÄke
* 7 â€“ stanje taÄke

### SNMP Verzije

Postoje 2 vaÅ¾ne verzije SNMP:

* **SNMPv1**: Glavna verzija, joÅ¡ uvek je najÄeÅ¡Ä‡a, **autentifikacija se zasniva na stringu** (community string) koji putuje u **plain-text** (sve informacije putuju u plain textu). **Verzija 2 i 2c** takoÄ‘e Å¡alju **saobraÄ‡aj u plain textu** i koriste **community string kao autentifikaciju**.
* **SNMPv3**: Koristi bolji **oblik autentifikacije** i informacije putuju **kriptovano** koristeÄ‡i (**dictionary attack** moÅ¾e biti izveden, ali bi bilo mnogo teÅ¾e pronaÄ‡i ispravne kredencijale nego u SNMPv1 i v2).

### Community Strings

Kao Å¡to je ranije pomenuto, **da biste pristupili informacijama saÄuvanim na MIB-u, morate znati community string za verzije 1 i 2/2c i kredencijale za verziju 3.**\
Postoje **2 tipa community strings**:

* **`public`** uglavnom **samo za Äitanje** funkcije
* **`private`** **ÄŒitanje/Pisanje** uopÅ¡te

Napomena da **pisivost OID-a zavisi od koriÅ¡Ä‡enog community stringa**, tako da **Äak i** ako otkrijete da se koristi "**public**", mogli biste biti u moguÄ‡nosti da **piÅ¡ete neke vrednosti.** TakoÄ‘e, moÅ¾e postojati objekata koji su **uvek "Samo za Äitanje".**\
Ako pokuÅ¡ate da **piÅ¡ete** objekat, dobiÄ‡ete **`noSuchName` ili `readOnly` greÅ¡ku**.\*\*.\*\*

U verzijama 1 i 2/2c, ako koristite **loÅ¡** community string, server neÄ‡e **odgovoriti**. Dakle, ako odgovara, koriÅ¡Ä‡en je **validan community string**.

## Portovi

[Sa Wikipedije](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol):

* SNMP agent prima zahteve na UDP portu **161**.
* MenadÅ¾er prima obaveÅ¡tenja ([Trape](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) i [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) na portu **162**.
* Kada se koristi sa [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) ili [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), zahtevi se primaju na portu **10161** i obaveÅ¡tenja se Å¡alju na port **10162**.

## Brute-Force Community String (v1 i v2c)

Da biste **pogodili community string**, mogli biste izvesti napad reÄnikom. Proverite [ovde razliÄite naÄine za izvoÄ‘enje brute-force napada protiv SNMP](../../generic-methodologies-and-resources/brute-force.md#snmp). ÄŒesto koriÅ¡Ä‡en community string je `public`.

## Enumerating SNMP

PreporuÄuje se instalacija sledeÄ‡eg da biste videli Å¡ta znaÄi **svaki OID prikupljen** sa ureÄ‘aja:
```bash
apt-get install snmp-mibs-downloader
download-mibs
# Finally comment the line saying "mibs :" in /etc/snmp/snmp.conf
sudo vi /etc/snmp/snmp.conf
```
Ako znate vaÅ¾eÄ‡i community string, moÅ¾ete pristupiti podacima koristeÄ‡i **SNMPWalk** ili **SNMP-Check**:
```bash
snmpbulkwalk -c [COMM_STRING] -v [VERSION] [IP] . #Don't forget the final dot
snmpbulkwalk -c public -v2c 10.10.11.136 .

snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP]
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] 1.3.6.1.2.1.4.34.1.3 #Get IPv6, needed dec2hex
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] NET-SNMP-EXTEND-MIB::nsExtendObjects #get extended
snmpwalk -v [VERSION_SNMP] -c [COMM_STRING] [DIR_IP] .1 #Enum all

snmp-check [DIR_IP] -p [PORT] -c [COMM_STRING]

nmap --script "snmp* and not snmp-brute" <target>

braa <community string>@<IP>:.1.3.6.* #Bruteforce specific OID
```
Hvala proÅ¡irenim upitima (download-mibs), moguÄ‡e je enumerisati joÅ¡ viÅ¡e o sistemu sa sledeÄ‡om komandom:
```bash
snmpwalk -v X -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
**SNMP** ima mnogo informacija o hostu, a stvari koje bi mogle biti zanimljive su: **MreÅ¾ni interfejsi** (IPv4 i **IPv6** adresa), KorisniÄka imena, Uptime, Verzija servera/OS-a, i **procesi**

**koji se izvrÅ¡avaju** (mogu sadrÅ¾ati lozinke)....

### **Opasne postavke**

U oblasti upravljanja mreÅ¾om, odreÄ‘ene konfiguracije i parametri su kljuÄni za osiguranje sveobuhvatnog nadgledanja i kontrole.

### Postavke pristupa

Dve glavne postavke omoguÄ‡avaju pristup **celom OID stablu**, Å¡to je kljuÄna komponenta u upravljanju mreÅ¾om:

1. **`rwuser noauth`** je postavljen da dozvoli potpuni pristup OID stablu bez potrebe za autentifikacijom. Ova postavka je jednostavna i omoguÄ‡ava neograniÄen pristup.
2. Za specifiÄniju kontrolu, pristup se moÅ¾e odobriti koriÅ¡Ä‡enjem:
* **`rwcommunity`** za **IPv4** adrese, i
* **`rwcommunity6`** za **IPv6** adrese.

Obe komande zahtevaju **community string** i relevantnu IP adresu, nudeÄ‡i potpuni pristup bez obzira na poreklo zahteva.

### SNMP parametri za Microsoft Windows

Serija **Management Information Base (MIB) vrednosti** se koristi za nadgledanje razliÄitih aspekata Windows sistema putem SNMP:

* **Sistemski procesi**: Pristupa se putem `1.3.6.1.2.1.25.1.6.0`, ovaj parametar omoguÄ‡ava nadgledanje aktivnih procesa unutar sistema.
* **Aktivni programi**: Vrednost `1.3.6.1.2.1.25.4.2.1.2` je namenjena praÄ‡enju trenutno aktivnih programa.
* **Putanja procesa**: Da bi se odredilo odakle se proces izvrÅ¡ava, koristi se MIB vrednost `1.3.6.1.2.1.25.4.2.1.4`.
* **SkladiÅ¡ne jedinice**: Nadgledanje skladiÅ¡nih jedinica olakÅ¡ano je putem `1.3.6.1.2.1.25.2.3.1.4`.
* **Ime softvera**: Da bi se identifikovao softver instaliran na sistemu, koristi se `1.3.6.1.2.1.25.6.3.1.2`.
* **KorisniÄki nalozi**: Vrednost `1.3.6.1.4.1.77.1.2.25` omoguÄ‡ava praÄ‡enje korisniÄkih naloga.
* **TCP lokalne portove**: Na kraju, `1.3.6.1.2.1.6.13.1.3` je namenjena za nadgledanje TCP lokalnih portova, pruÅ¾ajuÄ‡i uvid u aktivne mreÅ¾ne konekcije.

### Cisco

Pogledajte ovu stranicu ako imate Cisco opremu:

{% content-ref url="cisco-snmp.md" %}
[cisco-snmp.md](cisco-snmp.md)
{% endcontent-ref %}

## Od SNMP do RCE

Ako imate **string** koji vam omoguÄ‡ava da **piÅ¡ete vrednosti** unutar SNMP servisa, moÅ¾da Ä‡ete moÄ‡i da ga zloupotrebite da **izvrÅ¡ite komande**:

{% content-ref url="snmp-rce.md" %}
[snmp-rce.md](snmp-rce.md)
{% endcontent-ref %}

## **Masovni SNMP**

[Braa](https://github.com/mteg/braa) je masovni SNMP skener. PredviÄ‘ena upotreba ovog alata je, naravno, pravljenje SNMP upita â€“ ali za razliku od snmpwalk iz net-snmp, sposoban je da upita desetine ili stotine hostova istovremeno, i u jednom procesu. Tako, troÅ¡i vrlo malo sistemskih resursa i skeniranje obavlja VEOMA brzo.

Braa implementira svoj VLASTITI snmp stek, tako da mu nisu potrebne nikakve SNMP biblioteke poput net-snmp.

**Sintaksa:** braa \[Community-string]@\[IP SNMP servera]:\[iso id]
```bash
braa ignite123@192.168.1.125:.1.3.6.*
```
Ovo moÅ¾e da izvuÄe mnogo MB informacija koje ne moÅ¾ete obraditi ruÄno.

Dakle, hajde da potraÅ¾imo najzanimljivije informacije (sa [https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/](https://blog.rapid7.com/2016/05/05/snmp-data-harvesting-during-penetration-testing/)):

### **UreÄ‘aji**

Proces poÄinje ekstrakcijom **sysDesc MIB podataka** (1.3.6.1.2.1.1.1.0) iz svake datoteke kako bi se identifikovali ureÄ‘aji. To se postiÅ¾e koriÅ¡Ä‡enjem **grep komande**:
```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```
### **Identifikacija Privatnog Stringa**

KljuÄni korak ukljuÄuje identifikaciju **privatnog community stringa** koji koriste organizacije, posebno na Cisco IOS ruterima. Ovaj string omoguÄ‡ava ekstrakciju **running configurations** sa rutera. Identifikacija se Äesto oslanja na analizu SNMP Trap podataka za reÄ "trap" uz pomoÄ‡ **grep command**:
```bash
grep -i "trap" *.snmp
```
### **KorisniÄka imena/Lozinke**

Zapisi pohranjeni unutar MIB tabela se ispituju za **neuspeÅ¡ne pokuÅ¡aje prijavljivanja**, koji mogu sluÄajno ukljuÄivati lozinke unesene kao korisniÄka imena. KljuÄne reÄi kao Å¡to su _fail_, _failed_, ili _login_ se pretraÅ¾uju kako bi se pronaÅ¡li vredni podaci:
```bash
grep -i "login\|fail" *.snmp
```
### **Emails**

Na kraju, za ekstrakciju **email adresa** iz podataka, koristi se **grep komanda** sa regularnim izrazom, fokusirajuÄ‡i se na obrasce koji odgovaraju formatima email adresa:
```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```
## Modifying SNMP values

MoÅ¾ete koristiti _**NetScanTools**_ da **izmenite vrednosti**. TrebaÄ‡e vam **privatni string** da biste to uradili.

## Spoofing

Ako postoji ACL koji dozvoljava samo nekim IP adresama da upitaju SNMP servis, moÅ¾ete spoofovati jednu od ovih adresa unutar UDP paketa i prisluÅ¡kivati saobraÄ‡aj.

## Examine SNMP Configuration files

* snmp.conf
* snmpd.conf
* snmp-config.xml

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Ako ste zainteresovani za **hacking karijeru** i da hakujete nehakovano - **zapoÅ¡ljavamo!** (_potrebno je teÄno pisanje i govorenje poljskog_).

{% embed url="https://www.stmcyber.com/careers" %}

## HackTricks Automatic Commands
```
Protocol_Name: SNMP    #Protocol Abbreviation if there is one.
Port_Number:  161     #Comma separated if there is more than one.
Protocol_Description: Simple Network Managment Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for SNMP
Note: |
SNMP - Simple Network Management Protocol is a protocol used to monitor different devices in the network (like routers, switches, printers, IoTs...).

https://book.hacktricks.xyz/pentesting/pentesting-snmp

Entry_2:
Name: SNMP Check
Description: Enumerate SNMP
Command: snmp-check {IP}

Entry_3:
Name: OneSixtyOne
Description: Crack SNMP passwords
Command: onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt {IP} -w 100

Entry_4:
Name: Nmap
Description: Nmap snmp (no brute)
Command: nmap --script "snmp* and not snmp-brute" {IP}

Entry_5:
Name: Hydra Brute Force
Description: Need Nothing
Command: hydra -P {Big_Passwordlist} -v {IP} snmp


```
{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
