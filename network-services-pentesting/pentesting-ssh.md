# 22 - æ¸—é€æµ‹è¯• SSH/SFTP

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆçš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–**å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœæ‚¨å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶æƒ³è¦é»‘æ‰ä¸å¯èƒ½é»‘æ‰çš„ä¸œè¥¿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦é¢å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## åŸºæœ¬ä¿¡æ¯

**SSHï¼ˆSecure Shell æˆ– Secure Socket Shellï¼‰** æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œå¯åœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸Šå®ç°ä¸è®¡ç®—æœºçš„å®‰å…¨è¿æ¥ã€‚åœ¨è®¿é—®è¿œç¨‹ç³»ç»Ÿæ—¶ï¼Œå®ƒå¯¹äºç»´æŠ¤æ•°æ®çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§è‡³å…³é‡è¦ã€‚

**é»˜è®¤ç«¯å£ï¼š** 22
```
22/tcp open  ssh     syn-ack
```
**SSHæœåŠ¡å™¨:**

* [openSSH](http://www.openssh.org) â€“ OpenBSD SSHï¼Œåœ¨BSDã€Linuxå‘è¡Œç‰ˆå’ŒWindowsè‡ªWindows 10èµ·å†…ç½®
* [Dropbear](https://matt.ucc.asn.au/dropbear/dropbear.html) â€“ é€‚ç”¨äºå†…å­˜å’Œå¤„ç†å™¨èµ„æºè¾ƒä½ç¯å¢ƒçš„SSHå®ç°ï¼Œåœ¨OpenWrtä¸­å†…ç½®
* [PuTTY](https://www.chiark.greenend.org.uk/\~sgtatham/putty/) â€“ ç”¨äºWindowsçš„SSHå®ç°ï¼Œå®¢æˆ·ç«¯å¸¸ç”¨ï¼Œä½†æœåŠ¡å™¨çš„ä½¿ç”¨è¾ƒå°‘
* [CopSSH](https://www.itefix.net/copssh) â€“ ç”¨äºWindowsçš„OpenSSHå®ç°

**SSHåº“(å®ç°æœåŠ¡å™¨ç«¯):**

* [libssh](https://www.libssh.org) â€“ å¤šå¹³å°Cåº“ï¼Œå®ç°SSHv2åè®®ï¼Œæ”¯æŒ[Python](https://github.com/ParallelSSH/ssh-python)ã€[Perl](https://github.com/garnier-quentin/perl-libssh/)å’Œ[R](https://github.com/ropensci/ssh)ç»‘å®šï¼›è¢«KDEç”¨äºsftpï¼ŒGitHubç”¨äºgit SSHåŸºç¡€è®¾æ–½
* [wolfSSH](https://www.wolfssl.com/products/wolfssh/) â€“ ç”¨ANSI Cç¼–å†™çš„SSHv2æœåŠ¡å™¨åº“ï¼Œé’ˆå¯¹åµŒå…¥å¼ã€RTOSå’Œèµ„æºå—é™ç¯å¢ƒ
* [Apache MINA SSHD](https://mina.apache.org/sshd-project/index.html) â€“ åŸºäºApache MINAçš„Apache SSHD Javaåº“
* [paramiko](https://github.com/paramiko/paramiko) â€“ Python SSHv2åè®®åº“

## æšä¸¾

### æ¨ªå¹…æŠ“å–
```bash
nc -vn <IP> 22
```
### è‡ªåŠ¨åŒ–ssh-audit

ssh-auditæ˜¯ç”¨äºsshæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é…ç½®å®¡è®¡çš„å·¥å…·ã€‚

[https://github.com/jtesta/ssh-audit](https://github.com/jtesta/ssh-audit) æ˜¯ä»[https://github.com/arthepsy/ssh-audit/](https://github.com/arthepsy/ssh-audit/) æ›´æ–°çš„åˆ†æ”¯ã€‚

**ç‰¹ç‚¹:**

* æ”¯æŒSSH1å’ŒSSH2åè®®æœåŠ¡å™¨;
* åˆ†æSSHå®¢æˆ·ç«¯é…ç½®;
* è·å–æ¨ªå¹…ï¼Œè¯†åˆ«è®¾å¤‡æˆ–è½¯ä»¶å’Œæ“ä½œç³»ç»Ÿï¼Œæ£€æµ‹å‹ç¼©;
* æ”¶é›†å¯†é’¥äº¤æ¢ï¼Œä¸»æœºå¯†é’¥ï¼ŒåŠ å¯†å’Œæ¶ˆæ¯è®¤è¯ä»£ç ç®—æ³•;
* è¾“å‡ºç®—æ³•ä¿¡æ¯ï¼ˆå¯ç”¨è‡ªä»ï¼Œå·²ç§»é™¤/ç¦ç”¨ï¼Œä¸å®‰å…¨/å¼±/é—ç•™ç­‰ï¼‰;
* è¾“å‡ºç®—æ³•å»ºè®®ï¼ˆæ ¹æ®è¯†åˆ«çš„è½¯ä»¶ç‰ˆæœ¬è¿½åŠ æˆ–åˆ é™¤ï¼‰;
* è¾“å‡ºå®‰å…¨ä¿¡æ¯ï¼ˆç›¸å…³é—®é¢˜ï¼Œåˆ†é…çš„CVEåˆ—è¡¨ç­‰ï¼‰;
* åŸºäºç®—æ³•ä¿¡æ¯åˆ†æSSHç‰ˆæœ¬å…¼å®¹æ€§;
* æ¥è‡ªOpenSSHï¼ŒDropbear SSHå’Œlibsshçš„å†å²ä¿¡æ¯;
* å¯åœ¨Linuxå’ŒWindowsä¸Šè¿è¡Œ;
* æ— ä¾èµ–é¡¹
```bash
usage: ssh-audit.py [-1246pbcnjvlt] <host>

-1,  --ssh1             force ssh version 1 only
-2,  --ssh2             force ssh version 2 only
-4,  --ipv4             enable IPv4 (order of precedence)
-6,  --ipv6             enable IPv6 (order of precedence)
-p,  --port=<port>      port to connect
-b,  --batch            batch output
-c,  --client-audit     starts a server on port 2222 to audit client
software config (use -p to change port;
use -t to change timeout)
-n,  --no-colors        disable colors
-j,  --json             JSON output
-v,  --verbose          verbose output
-l,  --level=<level>    minimum output level (info|warn|fail)
-t,  --timeout=<secs>   timeout (in seconds) for connection and reading
(default: 5)
$ python3 ssh-audit <IP>
```
### æœåŠ¡å™¨çš„å…¬å…±SSHå¯†é’¥

[æŸ¥çœ‹æ¼”ç¤ºï¼ˆAsciinemaï¼‰](https://asciinema.org/a/96ejZKxpbuupTK9j7h8BdClzp)
```bash
ssh-keyscan -t rsa <IP> -p <PORT>
```
### å¼±å¯†ç ç®—æ³•

è¿™æ˜¯é»˜è®¤ç”± **nmap** å‘ç°çš„ã€‚ä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ **sslcan** æˆ– **sslyze**ã€‚
```bash
nmap -p22 <ip> -sC # Send default nmap scripts for SSH
nmap -p22 <ip> -sV # Retrieve version
nmap -p22 <ip> --script ssh2-enum-algos # Retrieve supported algorythms
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keys
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" # Check authentication methods
```
### Shodan

* `ssh`

## Brute force usernames, passwords and private keys

### ç”¨æˆ·åæšä¸¾

åœ¨æŸäº›ç‰ˆæœ¬çš„OpenSSHä¸­ï¼Œæ‚¨å¯ä»¥è¿›è¡Œæ—¶é—´æ”»å‡»ä»¥æšä¸¾ç”¨æˆ·ã€‚æ‚¨å¯ä»¥ä½¿ç”¨metasploitæ¨¡å—æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼š
```
msf> use scanner/ssh/ssh_enumusers
```
### [æš´åŠ›ç ´è§£](../generic-methodologies-and-resources/brute-force.md#ssh)

ä¸€äº›å¸¸è§çš„sshå‡­æ®[åœ¨è¿™é‡Œ](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt)å’Œ[è¿™é‡Œ](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt)ä»¥åŠä¸‹é¢ã€‚

### ç§é’¥æš´åŠ›ç ´è§£

å¦‚æœä½ çŸ¥é“ä¸€äº›å¯ä»¥ä½¿ç”¨çš„sshç§é’¥...è®©æˆ‘ä»¬è¯•è¯•ã€‚ä½ å¯ä»¥ä½¿ç”¨nmapè„šæœ¬ï¼š
```
https://nmap.org/nsedoc/scripts/ssh-publickey-acceptance.html
```
æˆ–è€…ä½¿ç”¨MSFè¾…åŠ©æ¨¡å—ï¼š
```
msf> use scanner/ssh/ssh_identify_pubkeys
```
æˆ–è€…ä½¿ç”¨`ssh-keybrute.py`ï¼ˆåŸç”Ÿpython3ï¼Œè½»é‡çº§ä¸”å¯ç”¨äº†ä¼ ç»Ÿç®—æ³•ï¼‰ï¼š[snowdroppe/ssh-keybrute](https://github.com/snowdroppe/ssh-keybrute)ã€‚

#### å·²çŸ¥çš„ç³Ÿç³•å¯†é’¥å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š

{% embed url="https://github.com/rapid7/ssh-badkeys/tree/master/authorized" %}

#### å¼±SSHå¯†é’¥ / Debianå¯é¢„æµ‹PRNG

ä¸€äº›ç³»ç»Ÿåœ¨ç”¨äºç”ŸæˆåŠ å¯†ææ–™çš„éšæœºç§å­ä¸­å­˜åœ¨å·²çŸ¥ç¼ºé™·ã€‚è¿™å¯èƒ½å¯¼è‡´å¯†é’¥ç©ºé—´å¤§å¹…ç¼©å°ï¼Œä»è€Œå¯ä»¥è¿›è¡Œæš´åŠ›ç ´è§£ã€‚åœ¨æ­¤å¤„æä¾›äº†åœ¨å—å¼±PRNGå½±å“çš„Debianç³»ç»Ÿä¸Šç”Ÿæˆçš„é¢„ç”Ÿæˆå¯†é’¥é›†ï¼š[g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh)ã€‚

æ‚¨åº”è¯¥åœ¨è¿™é‡Œæœç´¢å—å®³æœºå™¨çš„æœ‰æ•ˆå¯†é’¥ã€‚

### Kerberos

**crackmapexec** ä½¿ç”¨`ssh`åè®®å¯ä»¥ä½¿ç”¨é€‰é¡¹`--kerberos`æ¥**é€šè¿‡kerberosè¿›è¡Œèº«ä»½éªŒè¯**ã€‚\
è¦è·å–æ›´å¤šä¿¡æ¯ï¼Œè¯·è¿è¡Œ`crackmapexec ssh --help`ã€‚

## é»˜è®¤å‡­æ®

| **ä¾›åº”å•†** | **ç”¨æˆ·å**                                                                                               | **å¯†ç **                                                                                                                                                                                              |
| ---------- | ----------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| APC        | apc, device                                                                                                 | apc                                                                                                                                                                                                        |
| Brocade    | admin                                                                                                       | admin123, password, brocade, fibranne                                                                                                                                                                      |
| Cisco      | admin, cisco, enable, hsa, pix, pnadmin, ripeop, root, shelladmin                                           | admin, Admin123, default, password, secur4u, cisco, Cisco, \_Cisco, cisco123, C1sco!23, Cisco123, Cisco1234, TANDBERG, change\_it, 12345, ipics, pnadmin, diamond, hsadb, c, cc, attack, blender, changeme |
| Citrix     | root, nsroot, nsmaint, vdiadmin, kvm, cli, admin                                                            | C1trix321, nsroot, nsmaint, kaviza, kaviza123, freebsd, public, rootadmin, wanscaler                                                                                                                       |
| D-Link     | admin, user                                                                                                 | private, admin, user                                                                                                                                                                                       |
| Dell       | root, user1, admin, vkernel, cli                                                                            | calvin, 123456, password, vkernel, Stor@ge!, admin                                                                                                                                                         |
| EMC        | admin, root, sysadmin                                                                                       | EMCPMAdm7n, Password#1, Password123#, sysadmin, changeme, emc                                                                                                                                              |
| HP/3Com    | admin, root, vcx, app, spvar, manage, hpsupport, opc\_op                                                    | admin, password, hpinvent, iMC123, pvadmin, passw0rd, besgroup, vcx, nice, access, config, 3V@rpar, 3V#rpar, procurve, badg3r5, OpC\_op, !manage, !admin                                                   |
| Huawei     | admin, root                                                                                                 | 123456, admin, root, Admin123, Admin@storage, Huawei12#$, HwDec@01, hwosta2.0, HuaWei123, fsp200@HW, huawei123                                                                                             |
| IBM        | USERID, admin, manager, mqm, db2inst1, db2fenc1, dausr1, db2admin, iadmin, system, device, ufmcli, customer | PASSW0RD, passw0rd, admin, password, Passw8rd, iadmin, apc, 123456, cust0mer                                                                                                                               |
| Juniper    | netscreen                                                                                                   | netscreen                                                                                                                                                                                                  |
| NetApp     | admin                                                                                                       | netapp123                                                                                                                                                                                                  |
| Oracle     | root, oracle, oravis, applvis, ilom-admin, ilom-operator, nm2user                                           | changeme, ilom-admin, ilom-operator, welcome1, oracle                                                                                                                                                      |
| VMware     | vi-admin, root, hqadmin, vmware, admin                                                                      | vmware, vmw@re, hqadmin, default                                                                                                                                                                           |

## SSH-MitM

å¦‚æœæ‚¨åœ¨å—å®³è€…æ‰€åœ¨çš„æœ¬åœ°ç½‘ç»œä¸­ï¼Œè¯¥å—å®³è€…å°†ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¿æ¥åˆ°SSHæœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥å°è¯•**æ‰§è¡Œä¸­é—´äººæ”»å‡»ä»¥çªƒå–è¿™äº›å‡­æ®ï¼š**

**æ”»å‡»è·¯å¾„ï¼š**

* **æµé‡é‡å®šå‘ï¼š** æ”»å‡»è€…**è½¬ç§»**å—å®³è€…çš„æµé‡åˆ°å…¶è®¡ç®—æœºï¼Œæœ‰æ•ˆåœ°**æ‹¦æˆª**è¿æ¥å°è¯•åˆ°SSHæœåŠ¡å™¨ã€‚
* **æ‹¦æˆªå’Œè®°å½•ï¼š** æ”»å‡»è€…çš„è®¡ç®—æœºå……å½“**ä»£ç†**ï¼Œé€šè¿‡å‡è£…æ˜¯åˆæ³•çš„SSHæœåŠ¡å™¨**æ•è·**ç”¨æˆ·çš„ç™»å½•è¯¦ç»†ä¿¡æ¯ã€‚
* **å‘½ä»¤æ‰§è¡Œå’Œä¸­ç»§ï¼š** æœ€åï¼Œæ”»å‡»è€…çš„æœåŠ¡å™¨**è®°å½•ç”¨æˆ·çš„å‡­æ®**ï¼Œ**å°†å‘½ä»¤è½¬å‘**åˆ°çœŸå®çš„SSHæœåŠ¡å™¨ï¼Œ**æ‰§è¡Œ**å®ƒä»¬ï¼Œå¹¶å°†ç»“æœ**å‘é€å›**ç”¨æˆ·ï¼Œä½¿æ•´ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥æ— ç¼å’Œåˆæ³•ã€‚

[**SSH MITM**](https://github.com/jtesta/ssh-mitm)æ­£æ˜¯æè¿°çš„æ“ä½œã€‚

ä¸ºäº†æ•è·æ‰§è¡Œå®é™…MitMï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ARPæ¬ºéª—ã€DNSæ¬ºéª—æˆ–å…¶ä»–åœ¨[**ç½‘ç»œæ¬ºéª—æ”»å‡»**](../generic-methodologies-and-resources/pentesting-network/#spoofing)ä¸­æè¿°çš„æŠ€æœ¯ã€‚

## SSH-Snake

å¦‚æœæ‚¨æƒ³è¦ä½¿ç”¨åœ¨ç³»ç»Ÿä¸Šå‘ç°çš„SSHç§é’¥åœ¨ç³»ç»Ÿä¸Šéå†ç½‘ç»œï¼Œå¯¹æ¯ä¸ªæ–°ä¸»æœºä½¿ç”¨æ¯ä¸ªç§é’¥ï¼Œé‚£ä¹ˆ[**SSH-Snake**](https://github.com/MegaManSec/SSH-Snake)å°±æ˜¯æ‚¨éœ€è¦çš„å·¥å…·ã€‚

SSH-Snakeè‡ªåŠ¨ä¸”é€’å½’æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š

1. åœ¨å½“å‰ç³»ç»Ÿä¸ŠæŸ¥æ‰¾ä»»ä½•SSHç§é’¥ï¼Œ
2. åœ¨å½“å‰ç³»ç»Ÿä¸ŠæŸ¥æ‰¾å¯èƒ½æ¥å—ç§é’¥çš„ä»»ä½•ä¸»æœºæˆ–ç›®çš„åœ°ï¼ˆuser@hostï¼‰ï¼Œ
3. å°è¯•ä½¿ç”¨å‘ç°çš„æ‰€æœ‰ç§é’¥è¿æ¥åˆ°æ‰€æœ‰ç›®çš„åœ°ï¼Œ
4. å¦‚æœæˆåŠŸè¿æ¥åˆ°ç›®çš„åœ°ï¼Œåˆ™åœ¨è¿æ¥åˆ°çš„ç³»ç»Ÿä¸Šé‡å¤æ­¥éª¤ï¼ƒ1 - ï¼ƒ4ã€‚

å®ƒå®Œå…¨è‡ªæˆ‘å¤åˆ¶å’Œè‡ªæˆ‘ä¼ æ’­ - å®Œå…¨æ— æ–‡ä»¶ã€‚

## é…ç½®é”™è¯¯

### Rootç™»å½•

SSHæœåŠ¡å™¨é€šå¸¸é»˜è®¤å…è®¸rootç”¨æˆ·ç™»å½•ï¼Œè¿™æ„æˆäº†é‡å¤§å®‰å…¨é£é™©ã€‚**ç¦ç”¨rootç™»å½•**æ˜¯ä¿æŠ¤æœåŠ¡å™¨çš„å…³é”®æ­¥éª¤ã€‚é€šè¿‡è¿›è¡Œæ­¤æ›´æ”¹ï¼Œå¯ä»¥å‡è½»ä½¿ç”¨ç®¡ç†å‘˜ç‰¹æƒçš„æœªç»æˆæƒè®¿é—®å’Œæš´åŠ›æ”»å‡»ã€‚

**ç¦ç”¨OpenSSHä¸­çš„Rootç™»å½•ï¼š**

1. ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤**ç¼–è¾‘SSHé…ç½®æ–‡ä»¶**ï¼š`sudoedit /etc/ssh/sshd_config`
2. å°†è®¾ç½®ä»`#PermitRootLogin yes`æ›´æ”¹ä¸º**`PermitRootLogin no`**ã€‚
3. ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤**é‡æ–°åŠ è½½é…ç½®**ï¼š`sudo systemctl daemon-reload`
4. **é‡æ–°å¯åŠ¨SSHæœåŠ¡å™¨**ä»¥åº”ç”¨æ›´æ”¹ï¼š`sudo systemctl restart sshd`

### SFTPæš´åŠ›ç ´è§£

* [**SFTPæš´åŠ›ç ´è§£**](../generic-methodologies-and-resources/brute-force.md#sftp)

### SFTPå‘½ä»¤æ‰§è¡Œ

åœ¨SFTPè®¾ç½®ä¸­ç»å¸¸å‡ºç°ä¸€ä¸ªå¸¸è§çš„ç–å¿½ï¼Œç®¡ç†å‘˜æ‰“ç®—è®©ç”¨æˆ·åœ¨ä¸å¯ç”¨è¿œç¨‹shellè®¿é—®çš„æƒ…å†µä¸‹äº¤æ¢æ–‡ä»¶ã€‚å°½ç®¡å°†ç”¨æˆ·è®¾ç½®ä¸ºéäº¤äº’å¼shellï¼ˆä¾‹å¦‚ï¼Œ`/usr/bin/nologin`ï¼‰å¹¶å°†å…¶é™åˆ¶åœ¨ç‰¹å®šç›®å½•ï¼Œä½†ä»å­˜åœ¨ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚**ç”¨æˆ·å¯ä»¥é€šè¿‡åœ¨ç™»å½•åç«‹å³è¯·æ±‚æ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚`/bin/bash`ï¼‰æ¥ç»•è¿‡è¿™äº›é™åˆ¶**ï¼Œåœ¨ä»–ä»¬æŒ‡å®šçš„éäº¤äº’å¼shellæ¥ç®¡ä¹‹å‰ã€‚è¿™å…è®¸æœªç»æˆæƒçš„å‘½ä»¤æ‰§è¡Œï¼Œç ´åäº†é¢„æœŸçš„å®‰å…¨æªæ–½ã€‚

[æ­¤å¤„çš„ç¤ºä¾‹](https://community.turgensec.com/ssh-hacking-guide/)
```bash
ssh -v noraj@192.168.1.94 id
...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 192.168.1.94 ([192.168.1.94]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(noraj) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

$ ssh noraj@192.168.1.94 /bin/bash
```
ä»¥ä¸‹æ˜¯ç”¨æˆ·`noraj`çš„å®‰å…¨SFTPé…ç½®ç¤ºä¾‹ï¼ˆ`/etc/ssh/sshd_config` - openSSHï¼‰ï¼š
```
Match User noraj
ChrootDirectory %h
ForceCommand internal-sftp
AllowTcpForwarding no
PermitTunnel no
X11Forwarding no
PermitTTY no
```
è¿™ä¸ªé…ç½®å°†åªå…è®¸SFTPï¼šé€šè¿‡å¼ºåˆ¶å¯åŠ¨å‘½ä»¤ç¦ç”¨shellè®¿é—®ï¼Œå¹¶ç¦ç”¨TTYè®¿é—®ï¼ŒåŒæ—¶ç¦ç”¨æ‰€æœ‰ç±»å‹çš„ç«¯å£è½¬å‘æˆ–éš§é“ã€‚

### SFTPéš§é“

å¦‚æœä½ å¯ä»¥è®¿é—®ä¸€ä¸ªSFTPæœåŠ¡å™¨ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæœåŠ¡å™¨è¿›è¡Œæµé‡éš§é“ï¼Œä¾‹å¦‚ä½¿ç”¨å¸¸è§çš„ç«¯å£è½¬å‘ï¼š
```bash
sudo ssh -L <local_port>:<remote_host>:<remote_port> -N -f <username>@<ip_compromised>
```
### SFTP ç¬¦å·é“¾æ¥

**sftp** å‘½ä»¤ä¸­æœ‰ "**symlink**"ã€‚å› æ­¤ï¼Œå¦‚æœä½ åœ¨æŸä¸ªæ–‡ä»¶å¤¹ä¸­æ‹¥æœ‰**å¯å†™æƒé™**ï¼Œä½ å¯ä»¥åˆ›å»º**å…¶ä»–æ–‡ä»¶å¤¹/æ–‡ä»¶**çš„**ç¬¦å·é“¾æ¥**ã€‚ç”±äºä½ å¯èƒ½è¢«**é™åˆ¶**åœ¨ chroot ä¸­ï¼Œè¿™å¯¹ä½ æ¥è¯´**ä¸ä¼šç‰¹åˆ«æœ‰ç”¨**ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ å¯ä»¥ä»ä¸€ä¸ª**é chroot æœåŠ¡**ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœä½ å¯ä»¥ä» web è®¿é—®ç¬¦å·é“¾æ¥ï¼‰**è®¿é—®**åˆ›å»ºçš„**ç¬¦å·é“¾æ¥**ï¼Œä½ å¯ä»¥é€šè¿‡ web **æ‰“å¼€ç¬¦å·é“¾æ¥çš„æ–‡ä»¶**ã€‚

ä¾‹å¦‚ï¼Œè¦ä»æ–°æ–‡ä»¶ **"**_**froot**_**" åˆ›å»ºä¸€ä¸ª**ç¬¦å·é“¾æ¥**åˆ° "**_**/**_**"ï¼š
```bash
sftp> symlink / froot
```
å¦‚æœæ‚¨å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®æ–‡ä»¶"_froot_"ï¼Œæ‚¨å°†èƒ½å¤Ÿåˆ—å‡ºç³»ç»Ÿæ ¹ç›®å½•("/")ã€‚

### è®¤è¯æ–¹æ³•

åœ¨é«˜å®‰å…¨ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¼šå¯ç”¨åŸºäºå¯†é’¥æˆ–åŒå› ç´ è®¤è¯ï¼Œè€Œä¸æ˜¯ç®€å•çš„åŸºäºå¯†ç çš„è®¤è¯ã€‚ä½†ç»å¸¸ä¼šåœ¨å¯ç”¨æ›´å¼ºçš„è®¤è¯æ–¹æ³•çš„åŒæ—¶æœªç¦ç”¨è¾ƒå¼±çš„æ–¹æ³•ã€‚ä¸€ä¸ªå¸¸è§æƒ…å†µæ˜¯åœ¨openSSHé…ç½®ä¸­å¯ç”¨`publickey`å¹¶å°†å…¶è®¾ç½®ä¸ºé»˜è®¤æ–¹æ³•ï¼Œä½†æœªç¦ç”¨`password`ã€‚å› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨SSHå®¢æˆ·ç«¯çš„è¯¦ç»†æ¨¡å¼ï¼Œæ”»å‡»è€…å¯ä»¥çœ‹åˆ°å¯ç”¨äº†è¾ƒå¼±çš„æ–¹æ³•ï¼š
```bash
ssh -v 192.168.1.94
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive
```
ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®äº†èº«ä»½éªŒè¯å¤±è´¥é™åˆ¶ï¼Œå¹¶ä¸”æ‚¨ä»æœªæœ‰æœºä¼šåˆ°è¾¾å¯†ç æ–¹æ³•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`PreferredAuthentications`é€‰é¡¹æ¥å¼ºåˆ¶ä½¿ç”¨æ­¤æ–¹æ³•ã€‚
```bash
ssh -v 192.168.1.94 -o PreferredAuthentications=password
...
debug1: Next authentication method: password
```
### é…ç½®æ–‡ä»¶

å®¡æŸ¥SSHæœåŠ¡å™¨é…ç½®æ˜¯å¿…è¦çš„ï¼Œä»¥æ£€æŸ¥åªæœ‰é¢„æœŸçš„æ–¹æ³•è¢«æˆæƒã€‚åœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨è¯¦ç»†æ¨¡å¼å¯ä»¥å¸®åŠ©æŸ¥çœ‹é…ç½®çš„æœ‰æ•ˆæ€§ã€‚
```bash
ssh_config
sshd_config
authorized_keys
ssh_known_hosts
known_hosts
id_rsa
```
## Fuzzing

* [https://packetstormsecurity.com/files/download/71252/sshfuzz.txt](https://packetstormsecurity.com/files/download/71252/sshfuzz.txt)
* [https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2](https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2)

## References

* You can find interesting guides on how to harden SSH in [https://www.ssh-audit.com/hardening\_guides.html](https://www.ssh-audit.com/hardening\_guides.html)
* [https://community.turgensec.com/ssh-hacking-guide](https://community.turgensec.com/ssh-hacking-guide)

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœæ‚¨å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶æƒ³è¦å…¥ä¾µä¸å¯èƒ½å…¥ä¾µçš„ç³»ç»Ÿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆ_éœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦é¢å’Œå£å¤´è¡¨è¾¾èƒ½åŠ›_ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## HackTricks Automatic Commands
```
Protocol_Name: SSH
Port_Number: 22
Protocol_Description: Secure Shell Hardening

Entry_1:
Name: Hydra Brute Force
Description: Need Username
Command: hydra -v -V -u -l {Username} -P {Big_Passwordlist} -t 1 {IP} ssh

Entry_2:
Name: consolesless mfs enumeration
Description: SSH enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/ssh/ssh_version; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use scanner/ssh/ssh_enumusers; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ssh/juniper_backdoor; set RHOSTS {IP}; set RPORT 22; run; exit'

```
<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
