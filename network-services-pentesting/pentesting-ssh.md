# 22 - Testowanie penetracyjne SSH/SFTP

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

JeÅ›li interesuje CiÄ™ **kariera hakerska** i hakowanie niemoÅ¼liwych do zhakowania rzeczy - **zatrudniamy!** (_wymagane biegÅ‚e posÅ‚ugiwanie siÄ™ jÄ™zykiem polskim w mowie i piÅ›mie_).

{% embed url="https://www.stmcyber.com/careers" %}

## Podstawowe informacje

**SSH (Secure Shell lub Secure Socket Shell)** to protokÃ³Å‚ sieciowy umoÅ¼liwiajÄ…cy bezpieczne poÅ‚Ä…czenie z komputerem przez nieszyfrowanÄ… sieÄ‡. Jest niezbÄ™dny do utrzymania poufnoÅ›ci i integralnoÅ›ci danych podczas dostÄ™pu do zdalnych systemÃ³w.

**DomyÅ›lny port:** 22
```
22/tcp open  ssh     syn-ack
```
**Serwery SSH:**

* [openSSH](http://www.openssh.org) - OpenBSD SSH, dostarczany w dystrybucjach BSD, Linuxa i Windows od wersji 10
* [Dropbear](https://matt.ucc.asn.au/dropbear/dropbear.html) - implementacja SSH dla Å›rodowisk o niskiej pamiÄ™ci i zasobach procesora, dostarczana w OpenWrt
* [PuTTY](https://www.chiark.greenend.org.uk/\~sgtatham/putty/) - implementacja SSH dla systemu Windows, klient jest powszechnie uÅ¼ywany, ale uÅ¼ycie serwera jest rzadsze
* [CopSSH](https://www.itefix.net/copssh) - implementacja OpenSSH dla systemu Windows

**Biblioteki SSH (implementujÄ…ce po stronie serwera):**

* [libssh](https://www.libssh.org) - wieloplatformowa biblioteka C implementujÄ…ca protokÃ³Å‚ SSHv2 z wiÄ…zaniami w [Pythonie](https://github.com/ParallelSSH/ssh-python), [Perl](https://github.com/garnier-quentin/perl-libssh/) i [R](https://github.com/ropensci/ssh); jest uÅ¼ywana przez KDE do sftp i przez GitHub do infrastruktury git SSH
* [wolfSSH](https://www.wolfssl.com/products/wolfssh/) - biblioteka serwera SSHv2 napisana w ANSI C, przeznaczona dla wbudowanych, systemÃ³w operacyjnych czasu rzeczywistego i Å›rodowisk o ograniczonych zasobach
* [Apache MINA SSHD](https://mina.apache.org/sshd-project/index.html) - biblioteka SSHD Apache oparta na Apache MINA
* [paramiko](https://github.com/paramiko/paramiko) - biblioteka protokoÅ‚u SSHv2 dla Pythona

## Wyliczanie

### Pobieranie baneru
```bash
nc -vn <IP> 22
```
### Automatyczne audytowanie ssh-audit

ssh-audit to narzÄ™dzie do audytu konfiguracji serwera i klienta SSH.

[https://github.com/jtesta/ssh-audit](https://github.com/jtesta/ssh-audit) to zaktualizowana wersja od [https://github.com/arthepsy/ssh-audit/](https://github.com/arthepsy/ssh-audit/)

**Funkcje:**

* ObsÅ‚uga serwera protokoÅ‚u SSH1 i SSH2;
* Analiza konfiguracji klienta SSH;
* Pobieranie baneru, rozpoznawanie urzÄ…dzenia lub oprogramowania oraz systemu operacyjnego, wykrywanie kompresji;
* Zbieranie algorytmÃ³w wymiany klucza, klucza hosta, szyfrowania i kodu uwierzytelniania wiadomoÅ›ci;
* WyÅ›wietlanie informacji o algorytmach (dostÄ™pne od, usuniÄ™te/wyÅ‚Ä…czone, niebezpieczne/sÅ‚abe/przestarzaÅ‚e, itp.);
* WyÅ›wietlanie zaleceÅ„ dotyczÄ…cych algorytmÃ³w (dodawanie lub usuwanie na podstawie rozpoznanej wersji oprogramowania);
* WyÅ›wietlanie informacji o bezpieczeÅ„stwie (powiÄ…zane problemy, przypisana lista CVE, itp.);
* Analiza zgodnoÅ›ci wersji SSH na podstawie informacji o algorytmach;
* Historyczne informacje z OpenSSH, Dropbear SSH i libssh;
* DziaÅ‚a na systemach Linux i Windows;
* Brak zaleÅ¼noÅ›ci.
```bash
usage: ssh-audit.py [-1246pbcnjvlt] <host>

-1,  --ssh1             force ssh version 1 only
-2,  --ssh2             force ssh version 2 only
-4,  --ipv4             enable IPv4 (order of precedence)
-6,  --ipv6             enable IPv6 (order of precedence)
-p,  --port=<port>      port to connect
-b,  --batch            batch output
-c,  --client-audit     starts a server on port 2222 to audit client
software config (use -p to change port;
use -t to change timeout)
-n,  --no-colors        disable colors
-j,  --json             JSON output
-v,  --verbose          verbose output
-l,  --level=<level>    minimum output level (info|warn|fail)
-t,  --timeout=<secs>   timeout (in seconds) for connection and reading
(default: 5)
$ python3 ssh-audit <IP>
```
### Publiczny klucz SSH serwera

```plaintext
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDZz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6Xz6X
```bash
ssh-keyscan -t rsa <IP> -p <PORT>
```
### SÅ‚abe algorytmy szyfrujÄ…ce

To jest domyÅ›lnie wykrywane przez **nmap**. Ale moÅ¼na rÃ³wnieÅ¼ uÅ¼yÄ‡ **sslscan** lub **sslyze**.

### Skrypty Nmap
```bash
nmap -p22 <ip> -sC # Send default nmap scripts for SSH
nmap -p22 <ip> -sV # Retrieve version
nmap -p22 <ip> --script ssh2-enum-algos # Retrieve supported algorythms
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keys
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" # Check authentication methods
```
### Shodan

* `ssh`

## Brute force nazw uÅ¼ytkownikÃ³w, haseÅ‚ i kluczy prywatnych

### Wyliczanie nazw uÅ¼ytkownikÃ³w

W niektÃ³rych wersjach OpenSSH moÅ¼na przeprowadziÄ‡ atak czasowy w celu wyliczenia uÅ¼ytkownikÃ³w. MoÅ¼na uÅ¼yÄ‡ moduÅ‚u metasploit w celu wykorzystania tego:
```
msf> use scanner/ssh/ssh_enumusers
```
### [Atak siÅ‚owy](../generic-methodologies-and-resources/brute-force.md#ssh)

NiektÃ³re powszechne dane uwierzytelniajÄ…ce ssh [tutaj](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt) i [tutaj](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt) oraz poniÅ¼ej.

### Atak siÅ‚owy na klucz prywatny

JeÅ›li znasz jakieÅ› klucze prywatne ssh, ktÃ³re mogÄ… byÄ‡ uÅ¼yte... sprÃ³bujmy. MoÅ¼esz uÅ¼yÄ‡ skryptu nmap:
```
https://nmap.org/nsedoc/scripts/ssh-publickey-acceptance.html
```
Lub moduÅ‚ pomocniczy MSF:
```
msf> use scanner/ssh/ssh_identify_pubkeys
```
Lub uÅ¼yj `ssh-keybrute.py` (natywny python3, lekki i obsÅ‚uguje starsze algorytmy): [snowdroppe/ssh-keybrute](https://github.com/snowdroppe/ssh-keybrute).

#### Znane zÅ‚e klucze moÅ¼na znaleÅºÄ‡ tutaj:

{% embed url="https://github.com/rapid7/ssh-badkeys/tree/master/authorized" %}

#### SÅ‚abe klucze SSH / przewidywalny PRNG w Debianie

NiektÃ³re systemy majÄ… znane wady w losowym ziarnie uÅ¼ywanym do generowania materiaÅ‚u kryptograficznego. MoÅ¼e to prowadziÄ‡ do dramatycznego zmniejszenia przestrzeni kluczy, ktÃ³re moÅ¼na zÅ‚amaÄ‡ metodÄ… bruteforce. Tutaj moÅ¼na znaleÅºÄ‡ zestawy wczeÅ›niej wygenerowanych kluczy wygenerowanych na systemach Debian dotkniÄ™tych sÅ‚abym PRNG: [g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh).

PowinieneÅ› sprawdziÄ‡ tutaj, aby poszukaÄ‡ prawidÅ‚owych kluczy dla maszyny ofiary.

### Kerberos

**crackmapexec** uÅ¼ywajÄ…c protokoÅ‚u `ssh` moÅ¼e uÅ¼yÄ‡ opcji `--kerberos` do **uwierzytelniania za pomocÄ… Kerberosa**.\
Aby uzyskaÄ‡ wiÄ™cej informacji, uruchom `crackmapexec ssh --help`.

## DomyÅ›lne dane uwierzytelniajÄ…ce

| **Producent** | **Nazwy uÅ¼ytkownikÃ³w**                                                                                      | **HasÅ‚a**                                                                                                                                                                                                  |
| ------------- | ----------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| APC           | apc, device                                                                                                 | apc                                                                                                                                                                                                        |
| Brocade       | admin                                                                                                       | admin123, password, brocade, fibranne                                                                                                                                                                      |
| Cisco         | admin, cisco, enable, hsa, pix, pnadmin, ripeop, root, shelladmin                                           | admin, Admin123, default, password, secur4u, cisco, Cisco, \_Cisco, cisco123, C1sco!23, Cisco123, Cisco1234, TANDBERG, change\_it, 12345, ipics, pnadmin, diamond, hsadb, c, cc, attack, blender, changeme |
| Citrix        | root, nsroot, nsmaint, vdiadmin, kvm, cli, admin                                                            | C1trix321, nsroot, nsmaint, kaviza, kaviza123, freebsd, public, rootadmin, wanscaler                                                                                                                       |
| D-Link        | admin, user                                                                                                 | private, admin, user                                                                                                                                                                                       |
| Dell          | root, user1, admin, vkernel, cli                                                                            | calvin, 123456, password, vkernel, Stor@ge!, admin                                                                                                                                                         |
| EMC           | admin, root, sysadmin                                                                                       | EMCPMAdm7n, Password#1, Password123#, sysadmin, changeme, emc                                                                                                                                              |
| HP/3Com       | admin, root, vcx, app, spvar, manage, hpsupport, opc\_op                                                    | admin, password, hpinvent, iMC123, pvadmin, passw0rd, besgroup, vcx, nice, access, config, 3V@rpar, 3V#rpar, procurve, badg3r5, OpC\_op, !manage, !admin                                                   |
| Huawei        | admin, root                                                                                                 | 123456, admin, root, Admin123, Admin@storage, Huawei12#$, HwDec@01, hwosta2.0, HuaWei123, fsp200@HW, huawei123                                                                                             |
| IBM           | USERID, admin, manager, mqm, db2inst1, db2fenc1, dausr1, db2admin, iadmin, system, device, ufmcli, customer | PASSW0RD, passw0rd, admin, password, Passw8rd, iadmin, apc, 123456, cust0mer                                                                                                                               |
| Juniper       | netscreen                                                                                                   | netscreen                                                                                                                                                                                                  |
| NetApp        | admin                                                                                                       | netapp123                                                                                                                                                                                                  |
| Oracle        | root, oracle, oravis, applvis, ilom-admin, ilom-operator, nm2user                                           | changeme, ilom-admin, ilom-operator, welcome1, oracle                                                                                                                                                      |
| VMware        | vi-admin, root, hqadmin, vmware, admin                                                                      | vmware, vmw@re, hqadmin, default                                                                                                                                                                           |

## SSH-MitM

JeÅ›li znajdujesz siÄ™ w tej samej sieci lokalnej co ofiara, ktÃ³ra bÄ™dzie Å‚Ä…czyÄ‡ siÄ™ z serwerem SSH za pomocÄ… nazwy uÅ¼ytkownika i hasÅ‚a, moÅ¼esz sprÃ³bowaÄ‡ **przeprowadziÄ‡ atak typu MitM, aby ukraÅ›Ä‡ te dane uwierzytelniajÄ…ce**:

**ÅšcieÅ¼ka ataku:**

* **Przekierowanie ruchu:** AtakujÄ…cy **przekierowuje** ruch ofiary na swoje urzÄ…dzenie, efektywnie **przechwytujÄ…c** prÃ³bÄ™ poÅ‚Ä…czenia z serwerem SSH.
* **Przechwycenie i logowanie:** UrzÄ…dzenie atakujÄ…ce dziaÅ‚a jako **proxy**, **przechwytujÄ…c** dane logowania uÅ¼ytkownika, udajÄ…c prawidÅ‚owy serwer SSH.
* **Wykonanie poleceÅ„ i przekazywanie:** Na koniec, serwer atakujÄ…cego **rejestruje dane uwierzytelniajÄ…ce uÅ¼ytkownika**, **przekazuje polecenia** do prawdziwego serwera SSH, **wykonuje** je i **przesyÅ‚a wyniki** z powrotem do uÅ¼ytkownika, sprawiajÄ…c, Å¼e proces wydaje siÄ™ pÅ‚ynny i prawidÅ‚owy.

[**SSH MITM**](https://github.com/jtesta/ssh-mitm) robi dokÅ‚adnie to, co opisano powyÅ¼ej.

Aby przechwyciÄ‡ i przeprowadziÄ‡ rzeczywisty atak typu MitM, moÅ¼na uÅ¼yÄ‡ technik takich jak ARP spoofing, DNS spoofing lub inne opisane w [**ataki podstawiania**](../generic-methodologies-and-resources/pentesting-network/#spoofing).

## SSH-Snake

JeÅ›li chcesz przemierzaÄ‡ sieÄ‡, korzystajÄ…c z odkrytych prywatnych kluczy SSH na systemach, wykorzystujÄ…c kaÅ¼dy klucz prywatny na kaÅ¼dym systemie dla nowych hostÃ³w, to [**SSH-Snake**](https://github.com/MegaManSec/SSH-Snake) jest tym, czego potrzebujesz.

SSH-Snake automatycznie i rekurencyjnie wykonuje nastÄ™pujÄ…ce zadania:

1. Na bieÅ¼Ä…cym systemie znajduje wszystkie prywatne klucze SSH,
2. Na bieÅ¼Ä…cym systemie znajduje wszystkie hosty lub miejsca docelowe (uÅ¼ytkownik@host), ktÃ³re mogÄ… akceptowaÄ‡ prywatne klucze,
3. PrÃ³buje nawiÄ…zaÄ‡ poÅ‚Ä…czenie SSH ze wszystkimi miejscami docelowymi, uÅ¼ywajÄ…c wszystkich odkrytych prywatnych kluczy,
4. JeÅ›li poÅ‚Ä…czenie z miejscem docelowym powiedzie siÄ™, powtarza kroki #1 - #4 na podÅ‚Ä…czonym systemie.

Jest to w peÅ‚ni samoreplikujÄ…ce siÄ™ i samorozprzestrzeniajÄ…ce siÄ™ narzÄ™dzie - i caÅ‚kowicie bezplikowe.

## BÅ‚Ä™dy konfiguracji

### Logowanie jako root

CzÄ™sto serwery SSH pozwalajÄ… na logowanie uÅ¼ytkownika root domyÅ›lnie, co stanowi znaczne ryzyko dla bezpieczeÅ„stwa. **WyÅ‚Ä…czenie logowania jako root** to kluczowy krok w zabezpieczaniu serwera. Nieautoryzowany dostÄ™p z uprawnieniami administratora i ataki brute force moÅ¼na zminimalizowaÄ‡, dokonujÄ…c tej zmiany.

**Aby wyÅ‚Ä…czyÄ‡ logowanie jako root w OpenSSH:**

1. **Edytuj plik konfiguracyjny SSH** za pomocÄ… polecenia: `sudoedit /etc/ssh/sshd_config`
2. **ZmieÅ„ ustawienie** z `#PermitRootLogin yes` na **`PermitRootLogin no`**.
3. **PrzeÅ‚aduj konfiguracjÄ™** za pomocÄ… polecenia: `sudo systemctl daemon-reload`
4. **Uruchom ponownie serwer SSH**, aby zastosowaÄ‡ zmiany: `sudo systemctl restart sshd`

### Brute Force SFTP

* [**Brute Force SFTP**](../generic-methodologies-and-resources/brute-force.md#sftp)

### Wykonanie poleceÅ„ SFTP

CzÄ™sto popeÅ‚nianym bÅ‚Ä™dem w konfiguracji SFTP jest umoÅ¼liwienie uÅ¼ytkownikom wymiany plikÃ³w bez wÅ‚Ä…czania zdalnego dostÄ™pu do powÅ‚oki. Pomimo ustawienia uÅ¼ytkownikÃ³w z nieinteraktywnymi powÅ‚okami (np. `/usr/bin/nologin`) i ograniczenia ich do okreÅ›lonego katalogu, pozostaje luka w zabezpieczeniach. **UÅ¼ytkownicy mogÄ… ominÄ…Ä‡ te ograniczenia**, Å¼Ä…dajÄ…c wykonania polecenia (np. `/bin/bash`) zaraz po zalogowaniu, zanim przejmie kontrolÄ™ ich nieinteraktywna powÅ‚oka. Pozwala to na nieautoryzowane wykonanie poleceÅ„, podwaÅ¼ajÄ…c zamierzone Å›rodki bezpieczeÅ„stwa.

[PrzykÅ‚ad stÄ…d](https://community.turgensec.com/ssh-hacking-guide/):
```bash
ssh -v noraj@192.168.1.94 id
...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 192.168.1.94 ([192.168.1.94]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(noraj) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

$ ssh noraj@192.168.1.94 /bin/bash
```
Oto przykÅ‚ad bezpiecznej konfiguracji SFTP (`/etc/ssh/sshd_config` - openSSH) dla uÅ¼ytkownika `noraj`:

```plaintext
# Ustawienia SFTP
Subsystem sftp internal-sftp

Match User noraj
    ChrootDirectory /home/noraj
    ForceCommand internal-sftp
    AllowTcpForwarding no
    X11Forwarding no
    PasswordAuthentication yes
    PermitTunnel no
    AllowAgentForwarding no
    PermitRootLogin no
    PermitEmptyPasswords no
    PubkeyAuthentication yes
    AuthorizedKeysFile /home/noraj/.ssh/authorized_keys
```

Ta konfiguracja zapewnia bezpieczny dostÄ™p SFTP dla uÅ¼ytkownika `noraj`. UÅ¼ytkownik zostanie ograniczony do swojego katalogu domowego (`/home/noraj`), a jedynÄ… dozwolonÄ… operacjÄ… bÄ™dzie SFTP. Wymusza to uwierzytelnianie za pomocÄ… hasÅ‚a (`PasswordAuthentication yes`) lub klucza publicznego (`PubkeyAuthentication yes`). Wszystkie inne opcje, takie jak przekierowanie X11 czy przekierowanie agenta SSH, sÄ… wyÅ‚Ä…czone.
```
Match User noraj
ChrootDirectory %h
ForceCommand internal-sftp
AllowTcpForwarding no
PermitTunnel no
X11Forwarding no
PermitTTY no
```
Ta konfiguracja pozwoli tylko na SFTP: wyÅ‚Ä…cza dostÄ™p do powÅ‚oki, wymuszajÄ…c uruchomienie polecenia startowego oraz wyÅ‚Ä…cza dostÄ™p do TTY, ale rÃ³wnieÅ¼ wyÅ‚Ä…cza wszelkie przekierowania portÃ³w lub tunelowanie.

### Tunelowanie SFTP

JeÅ›li masz dostÄ™p do serwera SFTP, moÅ¼esz rÃ³wnieÅ¼ przekierowaÄ‡ swÃ³j ruch przez niego, na przykÅ‚ad za pomocÄ… powszechnego przekierowania portÃ³w:
```bash
sudo ssh -L <local_port>:<remote_host>:<remote_port> -N -f <username>@<ip_compromised>
```
### SFTP Symlink

**SFTP** posiada polecenie "**symlink**". Dlatego, jeÅ›li masz **prawa do zapisu** w pewnym folderze, moÅ¼esz tworzyÄ‡ **symlinki** do **innych folderÃ³w/plikÃ³w**. Prawdopodobnie jesteÅ› **uwiÄ™ziony** wewnÄ…trz chroot, wiÄ™c to **nie bÄ™dzie specjalnie przydatne** dla Ciebie, ale jeÅ›li moÅ¼esz **uzyskaÄ‡ dostÄ™p** do utworzonego **symlinku** z **usÅ‚ugi bez chroot** (na przykÅ‚ad, jeÅ›li moÅ¼esz uzyskaÄ‡ dostÄ™p do symlinku z sieci), moÅ¼esz **otworzyÄ‡ symlinkowane pliki przez sieÄ‡**.

Na przykÅ‚ad, aby utworzyÄ‡ **symlink** od nowego pliku **"**_**froot**_**" do "**_**/**_**"**:
```bash
sftp> symlink / froot
```
JeÅ›li masz dostÄ™p do pliku "_froot_" za poÅ›rednictwem sieci, bÄ™dziesz w stanie wyÅ›wietliÄ‡ zawartoÅ›Ä‡ folderu root ("/") systemu.

### Metody uwierzytelniania

W Å›rodowiskach o wysokim poziomie bezpieczeÅ„stwa powszechnÄ… praktykÄ… jest wÅ‚Ä…czanie tylko uwierzytelniania opartego na kluczach lub dwuskÅ‚adnikowego, zamiast prostego uwierzytelniania opartego na haÅ›le. Jednak czÄ™sto silniejsze metody uwierzytelniania sÄ… wÅ‚Ä…czane bez wyÅ‚Ä…czania sÅ‚abszych. CzÄ™stym przypadkiem jest wÅ‚Ä…czenie `publickey` w konfiguracji openSSH i ustawienie go jako domyÅ›lnÄ… metodÄ™, ale nie wyÅ‚Ä…czenie `password`. Dlatego, korzystajÄ…c z trybu verbose klienta SSH, atakujÄ…cy moÅ¼e zobaczyÄ‡, Å¼e wÅ‚Ä…czona jest sÅ‚absza metoda:
```bash
ssh -v 192.168.1.94
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive
```
Na przykÅ‚ad, jeÅ›li ustawiono limit nieudanych prÃ³b uwierzytelnienia i nigdy nie masz szansy dotrzeÄ‡ do metody hasÅ‚a, moÅ¼esz uÅ¼yÄ‡ opcji `PreferredAuthentications`, aby wymusiÄ‡ uÅ¼ycie tej metody.
```bash
ssh -v 192.168.1.94 -o PreferredAuthentications=password
...
debug1: Next authentication method: password
```
PrzeglÄ…d konfiguracji serwera SSH jest konieczny, aby sprawdziÄ‡, czy sÄ… upowaÅ¼nione tylko oczekiwane metody. UÅ¼ycie trybu verbose na kliencie moÅ¼e pomÃ³c w zobaczeniu skutecznoÅ›ci konfiguracji.

### Pliki konfiguracyjne
```bash
ssh_config
sshd_config
authorized_keys
ssh_known_hosts
known_hosts
id_rsa
```
## Fuzzing

* [https://packetstormsecurity.com/files/download/71252/sshfuzz.txt](https://packetstormsecurity.com/files/download/71252/sshfuzz.txt)
* [https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2](https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2)

## References

* MoÅ¼esz znaleÅºÄ‡ interesujÄ…ce poradniki dotyczÄ…ce zabezpieczania SSH na stronie [https://www.ssh-audit.com/hardening\_guides.html](https://www.ssh-audit.com/hardening\_guides.html)
* [https://community.turgensec.com/ssh-hacking-guide](https://community.turgensec.com/ssh-hacking-guide)

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

JeÅ›li interesuje CiÄ™ **kariera w dziedzinie hakowania** i chcesz zhakowaÄ‡ to, co nie do zhakowania - **zatrudniamy!** (_wymagane biegÅ‚e posÅ‚ugiwanie siÄ™ jÄ™zykiem polskim w mowie i piÅ›mie_).

{% embed url="https://www.stmcyber.com/careers" %}

## HackTricks Automatyczne Polecenia
```
Protocol_Name: SSH
Port_Number: 22
Protocol_Description: Secure Shell Hardening

Entry_1:
Name: Hydra Brute Force
Description: Need Username
Command: hydra -v -V -u -l {Username} -P {Big_Passwordlist} -t 1 {IP} ssh

Entry_2:
Name: consolesless mfs enumeration
Description: SSH enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/ssh/ssh_version; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use scanner/ssh/ssh_enumusers; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ssh/juniper_backdoor; set RHOSTS {IP}; set RPORT 22; run; exit'

```
<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
