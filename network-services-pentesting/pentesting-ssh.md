# 22 - å¯¹SSH/SFTPçš„æ¸—é€æµ‹è¯•

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœæ‚¨å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£ï¼Œå¹¶ä¸”æƒ³è¦é»‘å…¥ä¸å¯é»‘çš„ç³»ç»Ÿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆ_éœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­_ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## åŸºæœ¬ä¿¡æ¯

**SSHæˆ–Secure Shellæˆ–Secure Socket Shellï¼Œ** æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§é€šè¿‡ä¸å®‰å…¨ç½‘ç»œå®‰å…¨è®¿é—®è®¡ç®—æœºçš„**æ–¹å¼ã€‚**

**é»˜è®¤ç«¯å£ï¼š** 22
```
22/tcp open  ssh     syn-ack
```
**SSHæœåŠ¡å™¨ï¼š**

* [openSSH](http://www.openssh.org) â€“ OpenBSD SSHï¼ŒåŒ…å«åœ¨BSDã€Linuxå‘è¡Œç‰ˆå’ŒWindows 10åŠä»¥åç‰ˆæœ¬ä¸­
* [Dropbear](https://matt.ucc.asn.au/dropbear/dropbear.html) â€“ ä¸ºå†…å­˜å’Œå¤„ç†å™¨èµ„æºæœ‰é™çš„ç¯å¢ƒè®¾è®¡çš„SSHå®ç°ï¼ŒåŒ…å«åœ¨OpenWrtä¸­
* [PuTTY](https://www.chiark.greenend.org.uk/\~sgtatham/putty/) â€“ Windowsçš„SSHå®ç°ï¼Œå®¢æˆ·ç«¯å¸¸ç”¨ï¼Œä½†æœåŠ¡å™¨ä½¿ç”¨è¾ƒå°‘
* [CopSSH](https://www.itefix.net/copssh) â€“ Windowsçš„OpenSSHå®ç°

**SSHåº“ï¼ˆå®ç°æœåŠ¡å™¨ç«¯ï¼‰ï¼š**

* [libssh](https://www.libssh.org) â€“ å¤šå¹³å°Cè¯­è¨€åº“ï¼Œå®ç°SSHv2åè®®ï¼Œæä¾›[Python](https://github.com/ParallelSSH/ssh-python)ã€[Perl](https://github.com/garnier-quentin/perl-libssh/)å’Œ[R](https://github.com/ropensci/ssh)çš„ç»‘å®šï¼›å®ƒè¢«KDEç”¨äºsftpï¼Œä¹Ÿè¢«GitHubç”¨äºgit SSHåŸºç¡€è®¾æ–½
* [wolfSSH](https://www.wolfssl.com/products/wolfssh/) â€“ ç”¨ANSI Cç¼–å†™çš„SSHv2æœåŠ¡å™¨åº“ï¼Œé’ˆå¯¹åµŒå…¥å¼ã€RTOSå’Œèµ„æºå—é™ç¯å¢ƒ
* [Apache MINA SSHD](https://mina.apache.org/sshd-project/index.html) â€“ åŸºäºApache MINAçš„Apache SSHD Javaåº“
* [paramiko](https://github.com/paramiko/paramiko) â€“ Python SSHv2åè®®åº“

## æšä¸¾

### Banner Grabbing
```bash
nc -vn <IP> 22
```
### è‡ªåŠ¨åŒ– ssh-audit

ssh-audit æ˜¯ä¸€ä¸ªç”¨äº ssh æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é…ç½®å®¡è®¡çš„å·¥å…·ã€‚

[https://github.com/jtesta/ssh-audit](https://github.com/jtesta/ssh-audit) æ˜¯ä» [https://github.com/arthepsy/ssh-audit/](https://github.com/arthepsy/ssh-audit/) æ›´æ–°çš„åˆ†æ”¯ã€‚

**ç‰¹ç‚¹ï¼š**

* æ”¯æŒ SSH1 å’Œ SSH2 åè®®æœåŠ¡å™¨ï¼›
* åˆ†æ SSH å®¢æˆ·ç«¯é…ç½®ï¼›
* æŠ“å–æ¨ªå¹…ï¼Œè¯†åˆ«è®¾å¤‡æˆ–è½¯ä»¶å’Œæ“ä½œç³»ç»Ÿï¼Œæ£€æµ‹å‹ç¼©ï¼›
* æ”¶é›†å¯†é’¥äº¤æ¢ã€ä¸»æœºå¯†é’¥ã€åŠ å¯†å’Œæ¶ˆæ¯è®¤è¯ç ç®—æ³•ï¼›
* è¾“å‡ºç®—æ³•ä¿¡æ¯ï¼ˆè‡ªä½•æ—¶å¯ç”¨ï¼Œä½•æ—¶ç§»é™¤/ç¦ç”¨ï¼Œä¸å®‰å…¨/å¼±/é—ç•™ç­‰ï¼‰ï¼›
* è¾“å‡ºç®—æ³•å»ºè®®ï¼ˆæ ¹æ®è¯†åˆ«çš„è½¯ä»¶ç‰ˆæœ¬æ·»åŠ æˆ–ç§»é™¤ï¼‰ï¼›
* è¾“å‡ºå®‰å…¨ä¿¡æ¯ï¼ˆç›¸å…³é—®é¢˜ï¼Œåˆ†é…çš„ CVE åˆ—è¡¨ç­‰ï¼‰ï¼›
* æ ¹æ®ç®—æ³•ä¿¡æ¯åˆ†æ SSH ç‰ˆæœ¬å…¼å®¹æ€§ï¼›
* æ¥è‡ª OpenSSHã€Dropbear SSH å’Œ libssh çš„å†å²ä¿¡æ¯ï¼›
* åœ¨ Linux å’Œ Windows ä¸Šè¿è¡Œï¼›
* æ— ä¾èµ–
```bash
usage: ssh-audit.py [-1246pbcnjvlt] <host>

-1,  --ssh1             force ssh version 1 only
-2,  --ssh2             force ssh version 2 only
-4,  --ipv4             enable IPv4 (order of precedence)
-6,  --ipv6             enable IPv6 (order of precedence)
-p,  --port=<port>      port to connect
-b,  --batch            batch output
-c,  --client-audit     starts a server on port 2222 to audit client
software config (use -p to change port;
use -t to change timeout)
-n,  --no-colors        disable colors
-j,  --json             JSON output
-v,  --verbose          verbose output
-l,  --level=<level>    minimum output level (info|warn|fail)
-t,  --timeout=<secs>   timeout (in seconds) for connection and reading
(default: 5)
$ python3 ssh-audit <IP>
```
[æŸ¥çœ‹å®é™…æ“ä½œ (Asciinema)](https://asciinema.org/a/96ejZKxpbuupTK9j7h8BdClzp)

### æœåŠ¡å™¨çš„å…¬å…±SSHå¯†é’¥
```bash
ssh-keyscan -t rsa <IP> -p <PORT>
```
### å¼±å¯†ç ç®—æ³•

**nmap** é»˜è®¤ä¼šå‘ç°è¿™ä¸ªé—®é¢˜ã€‚ä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ **sslcan** æˆ– **sslyze**ã€‚

### Nmap è„šæœ¬
```bash
nmap -p22 <ip> -sC # Send default nmap scripts for SSH
nmap -p22 <ip> -sV # Retrieve version
nmap -p22 <ip> --script ssh2-enum-algos # Retrieve supported algorythms
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keys
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" # Check authentication methods
```
### Shodan

* `ssh`

## æš´åŠ›ç ´è§£ç”¨æˆ·åã€å¯†ç å’Œç§é’¥

### ç”¨æˆ·åæšä¸¾

åœ¨æŸäº›ç‰ˆæœ¬çš„OpenSSHä¸­ï¼Œæ‚¨å¯ä»¥è¿›è¡Œæ—¶åºæ”»å‡»æ¥æšä¸¾ç”¨æˆ·ã€‚æ‚¨å¯ä»¥ä½¿ç”¨metasploitæ¨¡å—æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼š
```
msf> use scanner/ssh/ssh_enumusers
```
### [æš´åŠ›ç ´è§£](../generic-methodologies-and-resources/brute-force.md#ssh)

ä¸€äº›å¸¸è§çš„sshå‡­æ®[åœ¨æ­¤](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt)å’Œ[åœ¨æ­¤](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt)ï¼Œä»¥åŠä¸‹é¢ã€‚

### ç§é’¥æš´åŠ›ç ´è§£

å¦‚æœä½ çŸ¥é“ä¸€äº›å¯èƒ½ä¼šç”¨åˆ°çš„sshç§é’¥...è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚ä½ å¯ä»¥ä½¿ç”¨nmapè„šæœ¬ï¼š
```
https://nmap.org/nsedoc/scripts/ssh-publickey-acceptance.html
```
æˆ–MSFè¾…åŠ©æ¨¡å—ï¼š
```
msf> use scanner/ssh/ssh_identify_pubkeys
```
æˆ–ä½¿ç”¨ `ssh-keybrute.py`ï¼ˆåŸç”Ÿ python3ï¼Œè½»é‡çº§ä¸”å¯ç”¨äº†ä¼ ç»Ÿç®—æ³•ï¼‰ï¼š[snowdroppe/ssh-keybrute](https://github.com/snowdroppe/ssh-keybrute)ã€‚

#### å·²çŸ¥çš„ä¸å®‰å…¨å¯†é’¥å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š

{% embed url="https://github.com/rapid7/ssh-badkeys/tree/master/authorized" %}

#### å¼±SSHå¯†é’¥ / Debianå¯é¢„æµ‹çš„PRNG

ä¸€äº›ç³»ç»Ÿåœ¨ç”ŸæˆåŠ å¯†ææ–™æ—¶ä½¿ç”¨çš„éšæœºç§å­å­˜åœ¨å·²çŸ¥ç¼ºé™·ã€‚è¿™å¯èƒ½å¯¼è‡´å¯†é’¥ç©ºé—´å¤§å¹…å‡å°‘ï¼Œå¯ä»¥è¢«æš´åŠ›ç ´è§£ã€‚åœ¨å—åˆ°å¼±PRNGå½±å“çš„Debianç³»ç»Ÿä¸Šé¢„ç”Ÿæˆçš„å¯†é’¥é›†åˆå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š[g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh)ã€‚

ä½ åº”è¯¥åœ¨è¿™é‡ŒæŸ¥æ‰¾å—å®³æœºå™¨çš„æœ‰æ•ˆå¯†é’¥ã€‚

### Kerberos

**crackmapexec** ä½¿ç”¨ `ssh` åè®®å¯ä»¥ä½¿ç”¨ `--kerberos` é€‰é¡¹æ¥**é€šè¿‡kerberosè®¤è¯**ã€‚\
æ›´å¤šä¿¡æ¯è¯·è¿è¡Œ `crackmapexec ssh --help`ã€‚

## é»˜è®¤å‡­è¯

| **ä¾›åº”å•†** | **ç”¨æˆ·å**                                                                                               | **å¯†ç **                                                                                                                                                                                              |
| ---------- | ----------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| APC        | apc, device                                                                                                 | apc                                                                                                                                                                                                        |
| Brocade    | admin                                                                                                       | admin123, password, brocade, fibranne                                                                                                                                                                      |
| Cisco      | admin, cisco, enable, hsa, pix, pnadmin, ripeop, root, shelladmin                                           | admin, Admin123, default, password, secur4u, cisco, Cisco, \_Cisco, cisco123, C1sco!23, Cisco123, Cisco1234, TANDBERG, change\_it, 12345, ipics, pnadmin, diamond, hsadb, c, cc, attack, blender, changeme |
| Citrix     | root, nsroot, nsmaint, vdiadmin, kvm, cli, admin                                                            | C1trix321, nsroot, nsmaint, kaviza, kaviza123, freebsd, public, rootadmin, wanscaler                                                                                                                       |
| D-Link     | admin, user                                                                                                 | private, admin, user                                                                                                                                                                                       |
| Dell       | root, user1, admin, vkernel, cli                                                                            | calvin, 123456, password, vkernel, Stor@ge!, admin                                                                                                                                                         |
| EMC        | admin, root, sysadmin                                                                                       | EMCPMAdm7n, Password#1, Password123#, sysadmin, changeme, emc                                                                                                                                              |
| HP/3Com    | admin, root, vcx, app, spvar, manage, hpsupport, opc\_op                                                    | admin, password, hpinvent, iMC123, pvadmin, passw0rd, besgroup, vcx, nice, access, config, 3V@rpar, 3V#rpar, procurve, badg3r5, OpC\_op, !manage, !admin                                                   |
| Huawei     | admin, root                                                                                                 | 123456, admin, root, Admin123, Admin@storage, Huawei12#$, HwDec@01, hwosta2.0, HuaWei123, fsp200@HW, huawei123                                                                                             |
| IBM        | USERID, admin, manager, mqm, db2inst1, db2fenc1, dausr1, db2admin, iadmin, system, device, ufmcli, customer | PASSW0RD, passw0rd, admin, password, Passw8rd, iadmin, apc, 123456, cust0mer                                                                                                                               |
| Juniper    | netscreen                                                                                                   | netscreen                                                                                                                                                                                                  |
| NetApp     | admin                                                                                                       | netapp123                                                                                                                                                                                                  |
| Oracle     | root, oracle, oravis, applvis, ilom-admin, ilom-operator, nm2user                                           | changeme, ilom-admin, ilom-operator, welcome1, oracle                                                                                                                                                      |
| VMware     | vi-admin, root, hqadmin, vmware, admin                                                                      | vmware, vmw@re, hqadmin, default                                                                                                                                                                           |

## SSH-MitM

å¦‚æœä½ å’Œå—å®³è€…åœ¨åŒä¸€ä¸ªæœ¬åœ°ç½‘ç»œä¸­ï¼Œå—å®³è€…å°†ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¿æ¥åˆ°SSHæœåŠ¡å™¨ï¼Œä½ å¯ä»¥å°è¯•**æ‰§è¡ŒMitMæ”»å‡»æ¥çªƒå–è¿™äº›å‡­è¯ï¼š**

**æ”»å‡»è·¯å¾„ï¼š**

* ç”¨æˆ·æµé‡è¢«é‡å®šå‘åˆ°æ”»å‡»æœºå™¨
* æ”»å‡»è€…ç›‘æ§å°è¯•è¿æ¥åˆ°SSHæœåŠ¡å™¨çš„å°è¯•ï¼Œå¹¶å°†å®ƒä»¬é‡å®šå‘åˆ°å…¶SSHæœåŠ¡å™¨
* æ”»å‡»è€…çš„SSHæœåŠ¡å™¨é¦–å…ˆé…ç½®ä¸ºè®°å½•æ‰€æœ‰è¾“å…¥çš„æ•°æ®ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„å¯†ç ï¼Œå…¶æ¬¡ï¼Œå‘ç”¨æˆ·æƒ³è¦è¿æ¥çš„åˆæ³•SSHæœåŠ¡å™¨å‘é€å‘½ä»¤ä»¥æ‰§è¡Œå®ƒä»¬ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™åˆæ³•ç”¨æˆ·

[**SSH MITM**](https://github.com/jtesta/ssh-mitm) æ­£æ˜¯å¦‚ä¸Šæ‰€è¿°çš„æ“ä½œã€‚

ä¸ºäº†æ•è·å¹¶æ‰§è¡Œå®é™…çš„MitMï¼Œä½ å¯ä»¥ä½¿ç”¨ARPæ¬ºéª—ã€DNSæ¬ºéª—æˆ–åœ¨ [**ç½‘ç»œæ¬ºéª—æ”»å‡»**](../generic-methodologies-and-resources/pentesting-network/#spoofing) ä¸­æè¿°çš„å…¶ä»–æŠ€æœ¯ã€‚

## SSH-Snake

å¦‚æœä½ æƒ³ä½¿ç”¨åœ¨ç³»ç»Ÿä¸Šå‘ç°çš„SSHç§é’¥ç©¿è¶Šç½‘ç»œï¼Œåˆ©ç”¨æ¯ä¸ªç³»ç»Ÿä¸Šçš„æ¯ä¸ªç§é’¥å¯»æ‰¾æ–°ä¸»æœºï¼Œé‚£ä¹ˆ [**SSH-Snake**](https://github.com/MegaManSec/SSH-Snake) å°±æ˜¯ä½ éœ€è¦çš„ã€‚

SSH-Snakeè‡ªåŠ¨å¹¶é€’å½’åœ°æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š

1. åœ¨å½“å‰ç³»ç»Ÿä¸Šï¼Œæ‰¾åˆ°ä»»ä½•SSHç§é’¥ï¼Œ
2. åœ¨å½“å‰ç³»ç»Ÿä¸Šï¼Œæ‰¾åˆ°å¯èƒ½æ¥å—ç§é’¥çš„ä»»ä½•ä¸»æœºæˆ–ç›®çš„åœ°ï¼ˆuser@hostï¼‰ï¼Œ
3. å°è¯•ä½¿ç”¨å‘ç°çš„æ‰€æœ‰ç§é’¥SSHè¿›å…¥æ‰€æœ‰ç›®çš„åœ°ï¼Œ
4. å¦‚æœæˆåŠŸè¿æ¥åˆ°ç›®çš„åœ°ï¼Œé‡å¤æ­¥éª¤#1 - #4åœ¨è¿æ¥åˆ°çš„ç³»ç»Ÿä¸Šã€‚

å®ƒå®Œå…¨è‡ªæˆ‘å¤åˆ¶å’Œè‡ªæˆ‘ä¼ æ’­ -- å¹¶ä¸”å®Œå…¨æ— æ–‡ä»¶ã€‚

## é…ç½®é”™è¯¯é…ç½®

### Rootç™»å½•

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°SSHæœåŠ¡å™¨å®ç°å°†å…è®¸rootç™»å½•ï¼Œå»ºè®®ç¦ç”¨å®ƒï¼Œå› ä¸ºå¦‚æœè¿™ä¸ªè´¦æˆ·çš„å‡­è¯æ³„éœ²ï¼Œæ”»å‡»è€…å°†ç›´æ¥è·å¾—ç®¡ç†æƒé™ï¼Œè¿™ä¹Ÿå°†å…è®¸æ”»å‡»è€…å¯¹è¿™ä¸ªè´¦æˆ·è¿›è¡Œæš´åŠ›ç ´è§£æ”»å‡»ã€‚

**å¦‚ä½•ä¸ºopenSSHç¦ç”¨rootç™»å½•ï¼š**

1. ç¼–è¾‘SSHæœåŠ¡å™¨é…ç½® `sudoedit /etc/ssh/sshd_config`
2. å°† `#PermitRootLogin yes` æ”¹ä¸º `PermitRootLogin no`
3. è€ƒè™‘é…ç½®æ›´æ”¹ï¼š`sudo systemctl daemon-reload`
4. é‡å¯SSHæœåŠ¡å™¨ `sudo systemctl restart sshd`

### SFTPæš´åŠ›ç ´è§£

* [**SFTPæš´åŠ›ç ´è§£**](../generic-methodologies-and-resources/brute-force.md#sftp)

### SFTPå‘½ä»¤æ‰§è¡Œ

SSHçš„å¦ä¸€ä¸ªå¸¸è§é”™è¯¯é…ç½®é€šå¸¸å‡ºç°åœ¨SFTPé…ç½®ä¸­ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œå½“åˆ›å»ºä¸€ä¸ªSFTPæœåŠ¡å™¨æ—¶ï¼Œç®¡ç†å‘˜å¸Œæœ›ç”¨æˆ·æœ‰ä¸€ä¸ªSFTPè®¿é—®æƒé™æ¥å…±äº«æ–‡ä»¶ï¼Œä½†ä¸å¸Œæœ›åœ¨æœºå™¨ä¸Šè·å¾—è¿œç¨‹shellã€‚æ‰€ä»¥ä»–ä»¬è®¤ä¸ºåˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œç»™ä»–ä¸€ä¸ªå ä½ç¬¦shellï¼ˆå¦‚ `/usr/bin/nologin` æˆ– `/usr/bin/false`ï¼‰å¹¶å°†ä»–chrootåœ¨ä¸€ä¸ªç›‘ç‹±ä¸­è¶³ä»¥é¿å…shellè®¿é—®æˆ–å¯¹æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ»¥ç”¨ã€‚ä½†ä»–ä»¬é”™äº†ï¼Œ**ç”¨æˆ·å¯ä»¥åœ¨é»˜è®¤å‘½ä»¤æˆ–shellæ‰§è¡Œä¹‹å‰ï¼Œè¯·æ±‚åœ¨è®¤è¯åç«‹å³æ‰§è¡Œä¸€ä¸ªå‘½ä»¤**ã€‚å› æ­¤ï¼Œä¸ºäº†ç»•è¿‡å°†æ‹’ç»shellè®¿é—®çš„å ä½ç¬¦shellï¼Œåªéœ€åœ¨ä¹‹å‰è¯·æ±‚æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼ˆä¾‹å¦‚ `/bin/bash`ï¼‰ï¼Œåªéœ€æ‰§è¡Œï¼š
```bash
ssh -v noraj@192.168.1.94 id
...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 192.168.1.94 ([192.168.1.94]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(noraj) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

$ ssh noraj@192.168.1.94 /bin/bash
```
```plaintext
è¿™æ˜¯ä¸ºç”¨æˆ· `noraj` é…ç½®å®‰å…¨SFTPçš„ä¸€ä¸ªä¾‹å­ï¼ˆ`/etc/ssh/sshd_config` - openSSHï¼‰ï¼š
```
```
Match User noraj
ChrootDirectory %h
ForceCommand internal-sftp
AllowTcpForwarding no
PermitTunnel no
X11Forwarding no
PermitTTY no
```
æ­¤é…ç½®å°†ä»…å…è®¸SFTPï¼šé€šè¿‡å¼ºåˆ¶å¯åŠ¨å‘½ä»¤ç¦ç”¨shellè®¿é—®ï¼Œå¹¶ç¦ç”¨TTYè®¿é—®ï¼Œä½†ä¹Ÿç¦ç”¨æ‰€æœ‰ç±»å‹çš„ç«¯å£è½¬å‘æˆ–éš§é“ã€‚

### SFTP éš§é“

å¦‚æœæ‚¨å¯ä»¥è®¿é—®SFTPæœåŠ¡å™¨ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€šè¿‡æ­¤æœåŠ¡å™¨éš§é“ä¼ è¾“æ‚¨çš„æµé‡ï¼Œä¾‹å¦‚ä½¿ç”¨å¸¸è§çš„ç«¯å£è½¬å‘ï¼š
```bash
sudo ssh -L <local_port>:<remote_host>:<remote_port> -N -f <username>@<ip_compromised>
```
### SFTP ç¬¦å·é“¾æ¥

**sftp** æ”¯æŒ "**symlink**" å‘½ä»¤ã€‚å› æ­¤ï¼Œå¦‚æœä½ åœ¨æŸä¸ªæ–‡ä»¶å¤¹ä¸­æ‹¥æœ‰**å¯å†™æƒé™**ï¼Œä½ å¯ä»¥åˆ›å»ºæŒ‡å‘**å…¶ä»–æ–‡ä»¶å¤¹/æ–‡ä»¶**çš„**ç¬¦å·é“¾æ¥**ã€‚ç”±äºä½ å¯èƒ½è¢«é™åˆ¶åœ¨ä¸€ä¸ª chroot ç¯å¢ƒä¸­ï¼Œè¿™**å¹¶ä¸ç‰¹åˆ«æœ‰ç”¨**ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ èƒ½å¤Ÿé€šè¿‡ä¸€ä¸ª**é chroot** **æœåŠ¡**è®¿é—®åˆ›å»ºçš„**ç¬¦å·é“¾æ¥**ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœä½ èƒ½å¤Ÿé€šè¿‡ç½‘é¡µè®¿é—®è¯¥ç¬¦å·é“¾æ¥ï¼‰ï¼Œä½ å¯ä»¥**é€šè¿‡ç½‘é¡µæ‰“å¼€é“¾æ¥çš„æ–‡ä»¶**ã€‚

ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªä»æ–°æ–‡ä»¶ **"**_**froot**_**" åˆ° "**_**/**_**"** çš„**ç¬¦å·é“¾æ¥**ï¼š
```bash
sftp> symlink / froot
```
å¦‚æœæ‚¨å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®æ–‡ä»¶ "_froot_"ï¼Œæ‚¨å°†èƒ½å¤Ÿåˆ—å‡ºç³»ç»Ÿçš„æ ¹ç›®å½•ï¼ˆ"/"ï¼‰ã€‚

### è®¤è¯æ–¹æ³•

åœ¨é«˜å®‰å…¨ç¯å¢ƒä¸­ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ä»…å¯ç”¨åŸºäºå¯†é’¥æˆ–åŒå› ç´ è®¤è¯ï¼Œè€Œä¸æ˜¯ç®€å•çš„åŸºäºå¯†ç çš„å•å› ç´ è®¤è¯ã€‚ä½†å¾€å¾€åœ¨å¯ç”¨äº†æ›´å¼ºçš„è®¤è¯æ–¹æ³•æ—¶ï¼Œå¹¶æ²¡æœ‰ç¦ç”¨è¾ƒå¼±çš„æ–¹æ³•ã€‚ä¸€ä¸ªå¸¸è§çš„æƒ…å†µæ˜¯åœ¨openSSHé…ç½®ä¸­å¯ç”¨`publickey`å¹¶å°†å…¶è®¾ç½®ä¸ºé»˜è®¤æ–¹æ³•ï¼Œä½†æ²¡æœ‰ç¦ç”¨`password`ã€‚å› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨SSHå®¢æˆ·ç«¯çš„è¯¦ç»†æ¨¡å¼ï¼Œæ”»å‡»è€…å¯ä»¥çœ‹åˆ°å¯ç”¨äº†è¾ƒå¼±çš„æ–¹æ³•ï¼š
```bash
ssh -v 192.168.1.94
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive
```
ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®äº†è®¤è¯å¤±è´¥é™åˆ¶ï¼Œå¹¶ä¸”ä½ æ°¸è¿œæ— æ³•è¾¾åˆ°å¯†ç æ–¹æ³•ï¼Œä½ å¯ä»¥ä½¿ç”¨ `PreferredAuthentications` é€‰é¡¹æ¥å¼ºåˆ¶ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚
```bash
ssh -v 192.168.1.94 -o PreferredAuthentications=password
...
debug1: Next authentication method: password
```
### é…ç½®æ–‡ä»¶

æ£€æŸ¥SSHæœåŠ¡å™¨é…ç½®æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿åªæœ‰é¢„æœŸçš„æ–¹æ³•è¢«æˆæƒã€‚åœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨è¯¦ç»†æ¨¡å¼å¯ä»¥å¸®åŠ©æŸ¥çœ‹é…ç½®çš„æœ‰æ•ˆæ€§ã€‚
```bash
ssh_config
sshd_config
authorized_keys
ssh_known_hosts
known_hosts
id_rsa
```
## Fuzzing

* [https://packetstormsecurity.com/files/download/71252/sshfuzz.txt](https://packetstormsecurity.com/files/download/71252/sshfuzz.txt)
* [https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2](https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2)

## å‚è€ƒèµ„æ–™

* ä½ å¯ä»¥åœ¨[https://www.ssh-audit.com/hardening\_guides.html](https://www.ssh-audit.com/hardening\_guides.html)æ‰¾åˆ°å…³äºå¦‚ä½•åŠ å›ºSSHçš„æœ‰è¶£æŒ‡å—
* [https://community.turgensec.com/ssh-hacking-guide](https://community.turgensec.com/ssh-hacking-guide)

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£ï¼Œå¹¶ä¸”æƒ³è¦hacké‚£äº›ä¸å¯hackçš„ä¸œè¥¿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆ_éœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­_ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## HackTricks è‡ªåŠ¨å‘½ä»¤
```
Protocol_Name: SSH
Port_Number: 22
Protocol_Description: Secure Shell Hardening

Entry_1:
Name: Hydra Brute Force
Description: Need Username
Command: hydra -v -V -u -l {Username} -P {Big_Passwordlist} -t 1 {IP} ssh

Entry_2:
Name: consolesless mfs enumeration
Description: SSH enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/ssh/ssh_version; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use scanner/ssh/ssh_enumusers; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ssh/juniper_backdoor; set RHOSTS {IP}; set RPORT 22; run; exit'

```
<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
