# 22 - Pentesting SSH/SFTP

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**æ¼æ´èµé‡‘æç¤º**ï¼š**æ³¨å†Œ** **Intigriti**ï¼Œä¸€ä¸ªç”±é»‘å®¢ä¸ºé»‘å®¢åˆ›å»ºçš„é«˜çº§ **æ¼æ´èµé‡‘å¹³å°**ï¼ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾ **$100,000** çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## åŸºæœ¬ä¿¡æ¯

**SSHï¼ˆå®‰å…¨å¤–å£³æˆ–å®‰å…¨å¥—æ¥å­—å¤–å£³ï¼‰** æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œèƒ½å¤Ÿåœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸Šä¸è®¡ç®—æœºå»ºç«‹å®‰å…¨è¿æ¥ã€‚å®ƒåœ¨è®¿é—®è¿œç¨‹ç³»ç»Ÿæ—¶å¯¹äºç»´æŠ¤æ•°æ®çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§è‡³å…³é‡è¦ã€‚

**é»˜è®¤ç«¯å£ï¼š** 22
```
22/tcp open  ssh     syn-ack
```
**SSH æœåŠ¡å™¨ï¼š**

* [openSSH](http://www.openssh.org) â€“ OpenBSD SSHï¼Œè‡ª Windows 10 èµ·åœ¨ BSDã€Linux å‘è¡Œç‰ˆå’Œ Windows ä¸­æä¾›
* [Dropbear](https://matt.ucc.asn.au/dropbear/dropbear.html) â€“ é’ˆå¯¹å†…å­˜å’Œå¤„ç†å™¨èµ„æºæœ‰é™ç¯å¢ƒçš„ SSH å®ç°ï¼Œéš OpenWrt æä¾›
* [PuTTY](https://www.chiark.greenend.org.uk/\~sgtatham/putty/) â€“ Windows çš„ SSH å®ç°ï¼Œå®¢æˆ·ç«¯å¸¸ç”¨ï¼Œä½†æœåŠ¡å™¨çš„ä½¿ç”¨è¾ƒå°‘
* [CopSSH](https://www.itefix.net/copssh) â€“ Windows çš„ OpenSSH å®ç°

**SSH åº“ï¼ˆå®ç°æœåŠ¡å™¨ç«¯ï¼‰ï¼š**

* [libssh](https://www.libssh.org) â€“ å¤šå¹³å° C åº“ï¼Œå®ç° SSHv2 åè®®ï¼Œæ”¯æŒ [Python](https://github.com/ParallelSSH/ssh-python)ã€[Perl](https://github.com/garnier-quentin/perl-libssh/) å’Œ [R](https://github.com/ropensci/ssh) çš„ç»‘å®šï¼›KDE ç”¨äº sftpï¼ŒGitHub ç”¨äº git SSH åŸºç¡€è®¾æ–½
* [wolfSSH](https://www.wolfssl.com/products/wolfssh/) â€“ ç”¨ ANSI C ç¼–å†™çš„ SSHv2 æœåŠ¡å™¨åº“ï¼Œé’ˆå¯¹åµŒå…¥å¼ã€RTOS å’Œèµ„æºå—é™ç¯å¢ƒ
* [Apache MINA SSHD](https://mina.apache.org/sshd-project/index.html) â€“ åŸºäº Apache MINA çš„ Apache SSHD Java åº“
* [paramiko](https://github.com/paramiko/paramiko) â€“ Python SSHv2 åè®®åº“

## æšä¸¾

### æ¨ªå¹…æŠ“å–
```bash
nc -vn <IP> 22
```
### è‡ªåŠ¨åŒ– ssh-audit

ssh-audit æ˜¯ä¸€ä¸ªç”¨äº ssh æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é…ç½®å®¡è®¡çš„å·¥å…·ã€‚

[https://github.com/jtesta/ssh-audit](https://github.com/jtesta/ssh-audit) æ˜¯ä¸€ä¸ªæ¥è‡ª [https://github.com/arthepsy/ssh-audit/](https://github.com/arthepsy/ssh-audit/) çš„æ›´æ–°åˆ†æ”¯

**ç‰¹ç‚¹ï¼š**

* æ”¯æŒ SSH1 å’Œ SSH2 åè®®æœåŠ¡å™¨ï¼›
* åˆ†æ SSH å®¢æˆ·ç«¯é…ç½®ï¼›
* æŠ“å–æ¨ªå¹…ï¼Œè¯†åˆ«è®¾å¤‡æˆ–è½¯ä»¶å’Œæ“ä½œç³»ç»Ÿï¼Œæ£€æµ‹å‹ç¼©ï¼›
* æ”¶é›†å¯†é’¥äº¤æ¢ã€ä¸»æœºå¯†é’¥ã€åŠ å¯†å’Œæ¶ˆæ¯è®¤è¯ç ç®—æ³•ï¼›
* è¾“å‡ºç®—æ³•ä¿¡æ¯ï¼ˆå¯ç”¨è‡ªã€å·²ç§»é™¤/ç¦ç”¨ã€ä¸å®‰å…¨/å¼±/é—ç•™ç­‰ï¼‰ï¼›
* è¾“å‡ºç®—æ³•å»ºè®®ï¼ˆæ ¹æ®è¯†åˆ«çš„è½¯ä»¶ç‰ˆæœ¬æ·»åŠ æˆ–ç§»é™¤ï¼‰ï¼›
* è¾“å‡ºå®‰å…¨ä¿¡æ¯ï¼ˆç›¸å…³é—®é¢˜ã€åˆ†é…çš„ CVE åˆ—è¡¨ç­‰ï¼‰ï¼›
* æ ¹æ®ç®—æ³•ä¿¡æ¯åˆ†æ SSH ç‰ˆæœ¬å…¼å®¹æ€§ï¼›
* æ¥è‡ª OpenSSHã€Dropbear SSH å’Œ libssh çš„å†å²ä¿¡æ¯ï¼›
* åœ¨ Linux å’Œ Windows ä¸Šè¿è¡Œï¼›
* æ— ä¾èµ–
```bash
usage: ssh-audit.py [-1246pbcnjvlt] <host>

-1,  --ssh1             force ssh version 1 only
-2,  --ssh2             force ssh version 2 only
-4,  --ipv4             enable IPv4 (order of precedence)
-6,  --ipv6             enable IPv6 (order of precedence)
-p,  --port=<port>      port to connect
-b,  --batch            batch output
-c,  --client-audit     starts a server on port 2222 to audit client
software config (use -p to change port;
use -t to change timeout)
-n,  --no-colors        disable colors
-j,  --json             JSON output
-v,  --verbose          verbose output
-l,  --level=<level>    minimum output level (info|warn|fail)
-t,  --timeout=<secs>   timeout (in seconds) for connection and reading
(default: 5)
$ python3 ssh-audit <IP>
```
[See it in action (Asciinema)](https://asciinema.org/a/96ejZKxpbuupTK9j7h8BdClzp)

### æœåŠ¡å™¨çš„å…¬é’¥ SSH
```bash
ssh-keyscan -t rsa <IP> -p <PORT>
```
### å¼±åŠ å¯†ç®—æ³•

è¿™å¯ä»¥é€šè¿‡**nmap**é»˜è®¤å‘ç°ã€‚ä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨**sslcan**æˆ–**sslyze**ã€‚

### Nmapè„šæœ¬
```bash
nmap -p22 <ip> -sC # Send default nmap scripts for SSH
nmap -p22 <ip> -sV # Retrieve version
nmap -p22 <ip> --script ssh2-enum-algos # Retrieve supported algorythms
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keys
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" # Check authentication methods
```
### Shodan

* `ssh`

## æš´åŠ›ç ´è§£ç”¨æˆ·åã€å¯†ç å’Œç§é’¥

### ç”¨æˆ·åæšä¸¾

åœ¨æŸäº›ç‰ˆæœ¬çš„ OpenSSH ä¸­ï¼Œæ‚¨å¯ä»¥è¿›è¡Œæ—¶é—´æ”»å‡»ä»¥æšä¸¾ç”¨æˆ·ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ metasploit æ¨¡å—æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼š
```
msf> use scanner/ssh/ssh_enumusers
```
### [æš´åŠ›ç ´è§£](../generic-methodologies-and-resources/brute-force.md#ssh)

ä¸€äº›å¸¸è§çš„ ssh å‡­æ® [åœ¨è¿™é‡Œ](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt) å’Œ [åœ¨è¿™é‡Œ](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt) ä»¥åŠä¸‹é¢ã€‚

### ç§é’¥æš´åŠ›ç ´è§£

å¦‚æœä½ çŸ¥é“ä¸€äº›å¯ä»¥ä½¿ç”¨çš„ ssh ç§é’¥... é‚£å°±è¯•è¯•å§ã€‚ä½ å¯ä»¥ä½¿ç”¨ nmap è„šæœ¬ï¼š
```
https://nmap.org/nsedoc/scripts/ssh-publickey-acceptance.html
```
æˆ– MSF è¾…åŠ©æ¨¡å—ï¼š
```
msf> use scanner/ssh/ssh_identify_pubkeys
```
Or use `ssh-keybrute.py` (native python3, lightweight and has legacy algorithms enabled): [snowdroppe/ssh-keybrute](https://github.com/snowdroppe/ssh-keybrute).

#### å·²çŸ¥çš„åå¯†é’¥å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š

{% embed url="https://github.com/rapid7/ssh-badkeys/tree/master/authorized" %}

#### å¼±SSHå¯†é’¥ / Debianå¯é¢„æµ‹çš„PRNG

ä¸€äº›ç³»ç»Ÿåœ¨ç”ŸæˆåŠ å¯†ææ–™æ—¶ä½¿ç”¨çš„éšæœºç§å­å­˜åœ¨å·²çŸ¥ç¼ºé™·ã€‚è¿™å¯èƒ½å¯¼è‡´å¯†é’¥ç©ºé—´æ˜¾è‘—å‡å°‘ï¼Œä»è€Œå¯ä»¥è¢«æš´åŠ›ç ´è§£ã€‚å—å¼±PRNGå½±å“çš„Debianç³»ç»Ÿä¸Šç”Ÿæˆçš„é¢„ç”Ÿæˆå¯†é’¥é›†å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š[g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh)ã€‚

æ‚¨åº”è¯¥åœ¨è¿™é‡ŒæŸ¥æ‰¾å—å®³è€…æœºå™¨çš„æœ‰æ•ˆå¯†é’¥ã€‚

### Kerberos

**crackmapexec** ä½¿ç”¨ `ssh` åè®®å¯ä»¥ä½¿ç”¨é€‰é¡¹ `--kerberos` æ¥ **é€šè¿‡kerberosè¿›è¡Œèº«ä»½éªŒè¯**ã€‚\
æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·è¿è¡Œ `crackmapexec ssh --help`ã€‚

## é»˜è®¤å‡­æ®

| **ä¾›åº”å•†** | **ç”¨æˆ·å**                                                                                               | **å¯†ç **                                                                                                                                                                                              |
| ---------- | ----------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| APC        | apc, device                                                                                                 | apc                                                                                                                                                                                                        |
| Brocade    | admin                                                                                                       | admin123, password, brocade, fibranne                                                                                                                                                                      |
| Cisco      | admin, cisco, enable, hsa, pix, pnadmin, ripeop, root, shelladmin                                           | admin, Admin123, default, password, secur4u, cisco, Cisco, \_Cisco, cisco123, C1sco!23, Cisco123, Cisco1234, TANDBERG, change\_it, 12345, ipics, pnadmin, diamond, hsadb, c, cc, attack, blender, changeme |
| Citrix     | root, nsroot, nsmaint, vdiadmin, kvm, cli, admin                                                            | C1trix321, nsroot, nsmaint, kaviza, kaviza123, freebsd, public, rootadmin, wanscaler                                                                                                                       |
| D-Link     | admin, user                                                                                                 | private, admin, user                                                                                                                                                                                       |
| Dell       | root, user1, admin, vkernel, cli                                                                            | calvin, 123456, password, vkernel, Stor@ge!, admin                                                                                                                                                         |
| EMC        | admin, root, sysadmin                                                                                       | EMCPMAdm7n, Password#1, Password123#, sysadmin, changeme, emc                                                                                                                                              |
| HP/3Com    | admin, root, vcx, app, spvar, manage, hpsupport, opc\_op                                                    | admin, password, hpinvent, iMC123, pvadmin, passw0rd, besgroup, vcx, nice, access, config, 3V@rpar, 3V#rpar, procurve, badg3r5, OpC\_op, !manage, !admin                                                   |
| Huawei     | admin, root                                                                                                 | 123456, admin, root, Admin123, Admin@storage, Huawei12#$, HwDec@01, hwosta2.0, HuaWei123, fsp200@HW, huawei123                                                                                             |
| IBM        | USERID, admin, manager, mqm, db2inst1, db2fenc1, dausr1, db2admin, iadmin, system, device, ufmcli, customer | PASSW0RD, passw0rd, admin, password, Passw8rd, iadmin, apc, 123456, cust0mer                                                                                                                               |
| Juniper    | netscreen                                                                                                   | netscreen                                                                                                                                                                                                  |
| NetApp     | admin                                                                                                       | netapp123                                                                                                                                                                                                  |
| Oracle     | root, oracle, oravis, applvis, ilom-admin, ilom-operator, nm2user                                           | changeme, ilom-admin, ilom-operator, welcome1, oracle                                                                                                                                                      |
| VMware     | vi-admin, root, hqadmin, vmware, admin                                                                      | vmware, vmw@re, hqadmin, default                                                                                                                                                                           |

## SSH-MitM

å¦‚æœæ‚¨åœ¨æœ¬åœ°ç½‘ç»œä¸­ä½œä¸ºå³å°†ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¿æ¥åˆ°SSHæœåŠ¡å™¨çš„å—å®³è€…ï¼Œæ‚¨å¯ä»¥å°è¯• **æ‰§è¡ŒMitMæ”»å‡»ä»¥çªƒå–è¿™äº›å‡­æ®ï¼š**

**æ”»å‡»è·¯å¾„ï¼š**

* **æµé‡é‡å®šå‘ï¼š** æ”»å‡»è€… **è½¬ç§»** å—å®³è€…çš„æµé‡åˆ°ä»–ä»¬çš„æœºå™¨ï¼Œæœ‰æ•ˆåœ° **æ‹¦æˆª** è¿æ¥å°è¯•åˆ°SSHæœåŠ¡å™¨ã€‚
* **æ‹¦æˆªå’Œè®°å½•ï¼š** æ”»å‡»è€…çš„æœºå™¨å……å½“ **ä»£ç†**ï¼Œé€šè¿‡å‡è£…æ˜¯åˆæ³•çš„SSHæœåŠ¡å™¨æ¥ **æ•è·** ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ã€‚
* **å‘½ä»¤æ‰§è¡Œå’Œè½¬å‘ï¼š** æœ€åï¼Œæ”»å‡»è€…çš„æœåŠ¡å™¨ **è®°å½•ç”¨æˆ·çš„å‡­æ®**ï¼Œ **å°†å‘½ä»¤è½¬å‘** åˆ°çœŸå®çš„SSHæœåŠ¡å™¨ï¼Œ **æ‰§è¡Œ** å®ƒä»¬ï¼Œå¹¶ **å°†ç»“æœå‘é€å›** ç”¨æˆ·ï¼Œä½¿è¿‡ç¨‹çœ‹èµ·æ¥æ— ç¼ä¸”åˆæ³•ã€‚

[**SSH MITM**](https://github.com/jtesta/ssh-mitm) å®Œå…¨æŒ‰ç…§ä¸Šè¿°æè¿°è¿›è¡Œã€‚

ä¸ºäº†æ•è·æ‰§è¡Œå®é™…çš„MitMï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ARPæ¬ºéª—ã€DNSæ¬ºéª—æˆ–åœ¨[**ç½‘ç»œæ¬ºéª—æ”»å‡»**](../generic-methodologies-and-resources/pentesting-network/#spoofing)ä¸­æè¿°çš„å…¶ä»–æŠ€æœ¯ã€‚

## SSH-Snake

å¦‚æœæ‚¨æƒ³ä½¿ç”¨åœ¨ç³»ç»Ÿä¸Šå‘ç°çš„SSHç§é’¥éå†ç½‘ç»œï¼Œåˆ©ç”¨æ¯ä¸ªç³»ç»Ÿä¸Šçš„æ¯ä¸ªç§é’¥è¿æ¥åˆ°æ–°ä¸»æœºï¼Œé‚£ä¹ˆ[**SSH-Snake**](https://github.com/MegaManSec/SSH-Snake) æ˜¯æ‚¨æ‰€éœ€è¦çš„ã€‚

SSH-Snakeè‡ªåŠ¨å’Œé€’å½’åœ°æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š

1. åœ¨å½“å‰ç³»ç»Ÿä¸Šï¼ŒæŸ¥æ‰¾ä»»ä½•SSHç§é’¥ï¼Œ
2. åœ¨å½“å‰ç³»ç»Ÿä¸Šï¼ŒæŸ¥æ‰¾ä»»ä½•ä¸»æœºæˆ–ç›®æ ‡ï¼ˆuser@hostï¼‰ï¼Œè¿™äº›ç§é’¥å¯èƒ½è¢«æ¥å—ï¼Œ
3. å°è¯•ä½¿ç”¨æ‰€æœ‰å‘ç°çš„ç§é’¥SSHè¿æ¥åˆ°æ‰€æœ‰ç›®æ ‡ï¼Œ
4. å¦‚æœæˆåŠŸè¿æ¥åˆ°æŸä¸ªç›®æ ‡ï¼Œåˆ™åœ¨è¿æ¥çš„ç³»ç»Ÿä¸Šé‡å¤æ­¥éª¤#1 - #4ã€‚

å®ƒæ˜¯å®Œå…¨è‡ªæˆ‘å¤åˆ¶å’Œè‡ªæˆ‘ä¼ æ’­çš„â€”â€”å¹¶ä¸”å®Œå…¨æ— æ–‡ä»¶ã€‚

## é…ç½®é”™è¯¯

### æ ¹ç™»å½•

SSHæœåŠ¡å™¨é»˜è®¤å…è®¸rootç”¨æˆ·ç™»å½•ï¼Œè¿™æ„æˆäº†é‡å¤§å®‰å…¨é£é™©ã€‚ **ç¦ç”¨rootç™»å½•** æ˜¯ä¿æŠ¤æœåŠ¡å™¨çš„å…³é”®æ­¥éª¤ã€‚é€šè¿‡è¿›è¡Œæ­¤æ›´æ”¹ï¼Œå¯ä»¥å‡è½»æœªç»æˆæƒçš„ç®¡ç†æƒé™è®¿é—®å’Œæš´åŠ›æ”»å‡»çš„é£é™©ã€‚

**åœ¨OpenSSHä¸­ç¦ç”¨æ ¹ç™»å½•ï¼š**

1. **ç¼–è¾‘SSHé…ç½®æ–‡ä»¶**ï¼š `sudoedit /etc/ssh/sshd_config`
2. **å°†è®¾ç½®æ›´æ”¹** ä» `#PermitRootLogin yes` åˆ° **`PermitRootLogin no`**ã€‚
3. **ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡æ–°åŠ è½½é…ç½®**ï¼š `sudo systemctl daemon-reload`
4. **é‡å¯SSHæœåŠ¡å™¨** ä»¥åº”ç”¨æ›´æ”¹ï¼š `sudo systemctl restart sshd`

### SFTPæš´åŠ›ç ´è§£

* [**SFTPæš´åŠ›ç ´è§£**](../generic-methodologies-and-resources/brute-force.md#sftp)

### SFTPå‘½ä»¤æ‰§è¡Œ

åœ¨SFTPè®¾ç½®ä¸­å¸¸è§çš„ä¸€ä¸ªç–å¿½æ˜¯ï¼Œç®¡ç†å‘˜å¸Œæœ›ç”¨æˆ·åœ¨ä¸å¯ç”¨è¿œç¨‹shellè®¿é—®çš„æƒ…å†µä¸‹äº¤æ¢æ–‡ä»¶ã€‚å°½ç®¡å°†ç”¨æˆ·è®¾ç½®ä¸ºéäº¤äº’å¼shellï¼ˆä¾‹å¦‚ï¼Œ`/usr/bin/nologin`ï¼‰å¹¶å°†å…¶é™åˆ¶åœ¨ç‰¹å®šç›®å½•ä¸­ï¼Œä½†ä»ç„¶å­˜åœ¨å®‰å…¨æ¼æ´ã€‚ **ç”¨æˆ·å¯ä»¥é€šè¿‡åœ¨ç™»å½•åç«‹å³è¯·æ±‚æ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚`/bin/bash`ï¼‰æ¥è§„é¿è¿™äº›é™åˆ¶**ï¼Œåœ¨å…¶æŒ‡å®šçš„éäº¤äº’å¼shellæ¥ç®¡ä¹‹å‰ã€‚è¿™å…è®¸æœªç»æˆæƒçš„å‘½ä»¤æ‰§è¡Œï¼Œç ´åäº†é¢„æœŸçš„å®‰å…¨æªæ–½ã€‚

[ç¤ºä¾‹æ¥è‡ªè¿™é‡Œ](https://community.turgensec.com/ssh-hacking-guide/):
```bash
ssh -v noraj@192.168.1.94 id
...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 192.168.1.94 ([192.168.1.94]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(noraj) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

$ ssh noraj@192.168.1.94 /bin/bash
```
è¿™æ˜¯ç”¨æˆ· `noraj` çš„å®‰å…¨ SFTP é…ç½®ç¤ºä¾‹ï¼ˆ`/etc/ssh/sshd_config` â€“ openSSHï¼‰ï¼š
```
Match User noraj
ChrootDirectory %h
ForceCommand internal-sftp
AllowTcpForwarding no
PermitTunnel no
X11Forwarding no
PermitTTY no
```
æ­¤é…ç½®å°†ä»…å…è®¸ SFTPï¼šé€šè¿‡å¼ºåˆ¶å¯åŠ¨å‘½ä»¤å¹¶ç¦ç”¨ TTY è®¿é—®æ¥ç¦ç”¨ shell è®¿é—®ï¼ŒåŒæ—¶è¿˜ç¦ç”¨æ‰€æœ‰ç±»å‹çš„ç«¯å£è½¬å‘æˆ–éš§é“ã€‚

### SFTP Tunneling

å¦‚æœæ‚¨å¯ä»¥è®¿é—® SFTP æœåŠ¡å™¨ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡æ­¤æ–¹å¼éš§é“æ‚¨çš„æµé‡ï¼Œä¾‹å¦‚ä½¿ç”¨å¸¸è§çš„ç«¯å£è½¬å‘ï¼š
```bash
sudo ssh -L <local_port>:<remote_host>:<remote_port> -N -f <username>@<ip_compromised>
```
### SFTP Symlink

The **sftp** have the command "**symlink**". Therefore, if you have **å¯å†™æƒé™** in some folder, you can create **symlinks** of **å…¶ä»–æ–‡ä»¶/æ–‡ä»¶å¤¹**. As you are probably **è¢«å›°** inside a chroot this **å¯¹ä½ æ¥è¯´ä¸ä¼šç‰¹åˆ«æœ‰ç”¨**, but, if you can **è®¿é—®** the created **symlink** from a **no-chroot** **æœåŠ¡** (for example, if you can access the symlink from the web), you could **é€šè¿‡ç½‘ç»œæ‰“å¼€é“¾æ¥çš„æ–‡ä»¶**.

For example, to create a **symlink** from a new file **"**_**froot**_**" to "**_**/**_**"**:
```bash
sftp> symlink / froot
```
å¦‚æœæ‚¨å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®æ–‡ä»¶ "_froot_"ï¼Œæ‚¨å°†èƒ½å¤Ÿåˆ—å‡ºç³»ç»Ÿçš„æ ¹ ("/") æ–‡ä»¶å¤¹ã€‚

### è®¤è¯æ–¹æ³•

åœ¨é«˜å®‰å…¨æ€§ç¯å¢ƒä¸­ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ä»…å¯ç”¨åŸºäºå¯†é’¥æˆ–åŒå› ç´ è®¤è¯ï¼Œè€Œä¸æ˜¯ç®€å•çš„åŸºäºå¯†ç çš„å•å› ç´ è®¤è¯ã€‚ä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œè¾ƒå¼ºçš„è®¤è¯æ–¹æ³•è¢«å¯ç”¨è€Œæ²¡æœ‰ç¦ç”¨è¾ƒå¼±çš„è®¤è¯æ–¹æ³•ã€‚ä¸€ä¸ªå¸¸è§çš„æƒ…å†µæ˜¯åœ¨ openSSH é…ç½®ä¸­å¯ç”¨ `publickey` å¹¶å°†å…¶è®¾ç½®ä¸ºé»˜è®¤æ–¹æ³•ï¼Œä½†æ²¡æœ‰ç¦ç”¨ `password`ã€‚å› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨ SSH å®¢æˆ·ç«¯çš„è¯¦ç»†æ¨¡å¼ï¼Œæ”»å‡»è€…å¯ä»¥çœ‹åˆ°è¾ƒå¼±çš„æ–¹æ³•è¢«å¯ç”¨ï¼š
```bash
ssh -v 192.168.1.94
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive
```
ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®äº†èº«ä»½éªŒè¯å¤±è´¥é™åˆ¶ï¼Œå¹¶ä¸”æ‚¨ä»æœªæœ‰æœºä¼šè¾¾åˆ°å¯†ç æ–¹æ³•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `PreferredAuthentications` é€‰é¡¹å¼ºåˆ¶ä½¿ç”¨æ­¤æ–¹æ³•ã€‚
```bash
ssh -v 192.168.1.94 -o PreferredAuthentications=password
...
debug1: Next authentication method: password
```
æ£€æŸ¥SSHæœåŠ¡å™¨é…ç½®æ˜¯å¿…è¦çš„ï¼Œä»¥ç¡®ä¿ä»…æˆæƒé¢„æœŸçš„æ–¹æ³•ã€‚ä½¿ç”¨å®¢æˆ·ç«¯çš„è¯¦ç»†æ¨¡å¼å¯ä»¥å¸®åŠ©æŸ¥çœ‹é…ç½®çš„æœ‰æ•ˆæ€§ã€‚

### é…ç½®æ–‡ä»¶
```bash
ssh_config
sshd_config
authorized_keys
ssh_known_hosts
known_hosts
id_rsa
```
## Fuzzing

* [https://packetstormsecurity.com/files/download/71252/sshfuzz.txt](https://packetstormsecurity.com/files/download/71252/sshfuzz.txt)
* [https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2](https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2)

## References

* ä½ å¯ä»¥åœ¨ [https://www.ssh-audit.com/hardening\_guides.html](https://www.ssh-audit.com/hardening\_guides.html) æ‰¾åˆ°æœ‰å…³å¦‚ä½•åŠ å›º SSH çš„æœ‰è¶£æŒ‡å—
* [https://community.turgensec.com/ssh-hacking-guide](https://community.turgensec.com/ssh-hacking-guide)

<figure><img src="../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**Bug bounty tip**: **æ³¨å†Œ** **Intigriti**ï¼Œä¸€ä¸ªç”±é»‘å®¢ä¸ºé»‘å®¢åˆ›å»ºçš„é«˜çº§ **bug bounty å¹³å°**ï¼ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾ **$100,000** çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## HackTricks Automatic Commands
```
Protocol_Name: SSH
Port_Number: 22
Protocol_Description: Secure Shell Hardening

Entry_1:
Name: Hydra Brute Force
Description: Need Username
Command: hydra -v -V -u -l {Username} -P {Big_Passwordlist} -t 1 {IP} ssh

Entry_2:
Name: consolesless mfs enumeration
Description: SSH enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/ssh/ssh_version; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use scanner/ssh/ssh_enumusers; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ssh/juniper_backdoor; set RHOSTS {IP}; set RPORT 22; run; exit'

```
{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
