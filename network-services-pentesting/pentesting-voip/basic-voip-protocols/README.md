# Podstawowe protokoy VoIP

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
{% endhint %}

## Protokoy sygnalizacyjne

### SIP (Protok贸 inicjacji sesji)

To standard bran偶owy, aby uzyska wicej informacji, sprawd藕:

{% content-ref url="sip-session-initiation-protocol.md" %}
[sip-session-initiation-protocol.md](sip-session-initiation-protocol.md)
{% endcontent-ref %}

### MGCP (Protok贸 kontroli bramy multimedialnej)

MGCP (Protok贸 kontroli bramy multimedialnej) to **protok贸 sygnalizacyjny** i **kontroli pocze**, opisany w RFC 3435. Dziaa w architekturze scentralizowanej, kt贸ra skada si z trzech g贸wnych komponent贸w:

1. **Agent pocze lub Kontroler bramy multimedialnej (MGC)**: G贸wna brama w architekturze MGCP jest odpowiedzialna za **zarzdzanie i kontrolowanie bram multimedialnych**. Obsuguje procesy zestawiania, modyfikacji i zakoczenia pocze. MGC komunikuje si z bramami multimedialnymi za pomoc protokou MGCP.
2. **Bramy multimedialne (MG) lub bramy podrzdne**: Te urzdzenia **konwertuj cyfrowe strumienie multimedialne midzy r贸偶nymi sieciami**, takimi jak tradycyjna telefonia przeczana obwodowo i sieci IP przeczane pakietowo. S zarzdzane przez MGC i wykonuj polecenia otrzymane od niego. Bramki multimedialne mog zawiera funkcje takie jak transkodowanie, pakietowanie i eliminacja echa.
3. **Bramy sygnalizacyjne (SG)**: Te bramy s odpowiedzialne za **konwersj wiadomoci sygnalizacyjnych midzy r贸偶nymi sieciami**, umo偶liwiajc pynn komunikacj midzy tradycyjnymi systemami telefonicznymi (np. SS7) a sieciami opartymi na IP (np. SIP lub H.323). Bramki sygnalizacyjne s kluczowe dla interoperacyjnoci i zapewnienia, 偶e informacje o kontroli pocze s prawidowo komunikowane midzy r贸偶nymi sieciami.

Podsumowujc, MGCP centralizuje logik kontroli pocze w agencie pocze, co upraszcza zarzdzanie bramami multimedialnymi i sygnalizacyjnymi, zapewniajc lepsz skalowalno, niezawodno i wydajno w sieciach telekomunikacyjnych.

### SCCP (Protok贸 kontroli klienta typu Skinny)

Protok贸 kontroli klienta typu Skinny (SCCP) to **proprietarny protok贸 sygnalizacyjny i kontroli pocze** nale偶cy do Cisco Systems. Jest g贸wnie **u偶ywany** do komunikacji midzy **Cisco Unified Communications Manager** (wczeniej znanym jako CallManager) a telefonami IP Cisco lub innymi punktami kocowymi gosowymi i wideo Cisco.

SCCP to lekki protok贸, kt贸ry upraszcza komunikacj midzy serwerem kontroli pocze a urzdzeniami kocowymi. Nazywa si go "Skinny" ze wzgldu na jego minimalistyczny design i zmniejszone wymagania dotyczce przepustowoci w por贸wnaniu do innych protoko贸w VoIP, takich jak H.323 czy SIP.

G贸wne komponenty systemu opartego na SCCP to:

1. **Serwer kontroli pocze**: Ten serwer, zazwyczaj Cisco Unified Communications Manager, zarzdza procesami zestawiania, modyfikacji i zakoczenia pocze, a tak偶e innymi funkcjami telekomunikacyjnymi, takimi jak przekazywanie pocze, transfer pocze i wstrzymywanie pocze.
2. **Punkty kocowe SCCP**: To urzdzenia takie jak telefony IP, jednostki wideokonferencyjne lub inne punkty kocowe gosowe i wideo Cisco, kt贸re u偶ywaj SCCP do komunikacji z serwerem kontroli pocze. Rejestruj si w serwerze, wysyaj i odbieraj wiadomoci sygnalizacyjne oraz wykonuj instrukcje dostarczone przez serwer kontroli pocze w zakresie obsugi pocze.
3. **Bramy**: Te urzdzenia, takie jak bramy gosowe lub bramy multimedialne, s odpowiedzialne za konwersj strumieni multimedialnych midzy r贸偶nymi sieciami, takimi jak tradycyjna telefonia przeczana obwodowo i sieci IP przeczane pakietowo. Mog r贸wnie偶 zawiera dodatkowe funkcje, takie jak transkodowanie lub eliminacja echa.

SCCP oferuje prost i wydajn metod komunikacji midzy serwerami kontroli pocze Cisco a urzdzeniami kocowymi. Warto jednak zauwa偶y, 偶e **SCCP jest protokoem proprietarnym**, co mo偶e ogranicza interoperacyjno z systemami nie-Cisco. W takich przypadkach inne standardowe protokoy VoIP, takie jak SIP, mog by bardziej odpowiednie.

### H.323

H.323 to **zestaw protoko贸w** do komunikacji multimedialnej, w tym gosu, wideo i konferencji danych w sieciach przeczanych pakietowo, takich jak sieci oparte na IP. Zosta opracowany przez **Midzynarodow Uni Telekomunikacyjn** (ITU-T) i zapewnia kompleksowy framework do zarzdzania sesjami komunikacji multimedialnej.

Niekt贸re kluczowe komponenty zestawu H.323 obejmuj:

1. **Terminale**: To urzdzenia kocowe, takie jak telefony IP, systemy wideokonferencyjne lub aplikacje programowe, kt贸re obsuguj H.323 i mog uczestniczy w sesjach komunikacji multimedialnej.
2. **Bramy**: Te urzdzenia konwertuj strumienie multimedialne midzy r贸偶nymi sieciami, takimi jak tradycyjna telefonia przeczana obwodowo i sieci IP przeczane pakietowo, umo偶liwiajc interoperacyjno midzy H.323 a innymi systemami komunikacyjnymi. Mog r贸wnie偶 zawiera dodatkowe funkcje, takie jak transkodowanie lub eliminacja echa.
3. **Brama kontrolna**: To opcjonalne komponenty, kt贸re zapewniaj usugi kontroli i zarzdzania poczeniami w sieci H.323. Wykonuj funkcje takie jak tumaczenie adres贸w, zarzdzanie przepustowoci i kontrola dostpu, pomagajc w zarzdzaniu i optymalizacji zasob贸w sieciowych.
4. **Jednostki kontroli multipoint (MCU)**: Te urzdzenia uatwiaj konferencje multipoint, zarzdzajc i miksujc strumienie multimedialne z wielu punkt贸w kocowych. MCU umo偶liwiaj funkcje takie jak kontrola ukadu wideo, przeczanie aktywowane gosem i ciga obecno, co umo偶liwia organizowanie du偶ych konferencji z wieloma uczestnikami.

H.323 obsuguje szereg kodek贸w audio i wideo, a tak偶e inne usugi dodatkowe, takie jak przekazywanie pocze, transfer pocze, wstrzymywanie pocze i oczekiwanie na poczenie. Pomimo szerokiego zastosowania w pocztkowych dniach VoIP, H.323 stopniowo zosta zastpiony przez nowoczeniejsze i bardziej elastyczne protokoy, takie jak **Protok贸 inicjacji sesji (SIP)**, kt贸ry oferuje lepsz interoperacyjno i atwiejsz implementacj. Niemniej jednak H.323 pozostaje w u偶yciu w wielu systemach starszej generacji i nadal jest wspierany przez r贸偶nych dostawc贸w sprztu.

### IAX (Inter Asterisk eXchange)

IAX (Inter-Asterisk eXchange) to **protok贸 sygnalizacyjny i kontroli pocze**, g贸wnie u偶ywany do komunikacji midzy serwerami Asterisk PBX (Prywatna Centrala Telefoniczna) a innymi urzdzeniami VoIP. Zosta opracowany przez Marka Spencera, tw贸rc oprogramowania Asterisk open-source PBX, jako alternatywa dla innych protoko贸w VoIP, takich jak SIP i H.323.

IAX jest znany z **prostoty, wydajnoci i atwoci implementacji**. Niekt贸re kluczowe cechy IAX obejmuj:

1. **Pojedynczy port UDP**: IAX u偶ywa jednego portu UDP (4569) zar贸wno do sygnalizacji, jak i ruchu multimedialnego, co upraszcza przechodzenie przez zapory i NAT, uatwiajc wdra偶anie w r贸偶nych rodowiskach sieciowych.
2. **Protok贸 binarny**: W przeciwiestwie do protoko贸w opartych na tekcie, takich jak SIP, IAX jest protokoem binarnym, co zmniejsza jego zu偶ycie pasma i czyni go bardziej wydajnym w przesyaniu danych sygnalizacyjnych i multimedialnych.
3. **Trunking**: IAX obsuguje trunking, co pozwala na czenie wielu pocze w jedno poczenie sieciowe, zmniejszajc narzut i poprawiajc wykorzystanie pasma.
4. **Natywne szyfrowanie**: IAX ma wbudowane wsparcie dla szyfrowania, u偶ywajc metod takich jak RSA do wymiany kluczy i AES do szyfrowania medi贸w, zapewniajc bezpieczn komunikacj midzy punktami kocowymi.
5. **Komunikacja peer-to-peer**: IAX mo偶e by u偶ywany do bezporedniej komunikacji midzy punktami kocowymi bez potrzeby centralnego serwera, co umo偶liwia prostsze i bardziej wydajne routowanie pocze.

Pomimo swoich zalet, IAX ma pewne ograniczenia, takie jak g贸wny nacisk na ekosystem Asterisk i mniejsze rozpowszechnienie w por贸wnaniu do bardziej ustalonych protoko贸w, takich jak SIP. W zwizku z tym IAX mo偶e nie by najlepszym wyborem do interoperacyjnoci z systemami lub urzdzeniami nie-Asterisk. Jednak dla tych, kt贸rzy pracuj w rodowisku Asterisk, IAX oferuje solidne i wydajne rozwizanie do komunikacji VoIP.

## Protokoy transmisji i transportu

### SDP (Protok贸 opisu sesji)

SDP (Protok贸 opisu sesji) to **format oparty na tekcie** u偶ywany do opisywania cech sesji multimedialnych, takich jak gos, wideo lub konferencje danych, w sieciach IP. Zosta opracowany przez **Internet Engineering Task Force (IETF)** i jest zdefiniowany w **RFC 4566**. SDP nie obsuguje rzeczywistej transmisji medi贸w ani ustanawiania sesji, ale jest u偶ywany w poczeniu z innymi protokoami sygnalizacyjnymi, takimi jak **SIP (Protok贸 inicjacji sesji)**, do negocjowania i wymiany informacji o strumieniach medi贸w i ich atrybutach.

Niekt贸re kluczowe elementy SDP obejmuj:

1. **Informacje o sesji**: SDP opisuje szczeg贸y sesji multimedialnej, w tym nazw sesji, opis sesji, czas rozpoczcia i czas zakoczenia.
2. **Strumienie medi贸w**: SDP definiuje cechy strumieni medi贸w, takie jak typ medi贸w (audio, wideo lub tekst), protok贸 transportowy (np. RTP lub SRTP) oraz format medi贸w (np. informacje o kodeku).
3. **Informacje o poczeniu**: SDP dostarcza informacji o adresie sieciowym (adres IP) i numerze portu, na kt贸ry media powinny by wysyane lub odbierane.
4. **Atrybuty**: SDP wspiera u偶ycie atrybut贸w do dostarczania dodatkowych, opcjonalnych informacji o sesji lub strumieniu medi贸w. Atrybuty mog by u偶ywane do okrelania r贸偶nych funkcji, takich jak klucze szyfrowania, wymagania dotyczce przepustowoci lub mechanizmy kontroli medi贸w.

SDP jest zazwyczaj u偶ywany w nastpujcym procesie:

1. Strona inicjujca tworzy opis SDP proponowanej sesji multimedialnej, w tym szczeg贸y strumieni medi贸w i ich atrybuty.
2. Opis SDP jest wysyany do strony odbierajcej, zazwyczaj osadzony w wiadomoci protokou sygnalizacyjnego, takiej jak SIP lub RTSP.
3. Strona odbierajca przetwarza opis SDP, a w zale偶noci od swoich mo偶liwoci, mo偶e zaakceptowa, odrzuci lub zmodyfikowa proponowan sesj.
4. Ostateczny opis SDP jest wysyany z powrotem do strony inicjujcej jako cz wiadomoci protokou sygnalizacyjnego, koczc proces negocjacji.

Prostota i elastyczno SDP sprawiaj, 偶e jest to szeroko przyjty standard do opisywania sesji multimedialnych w r贸偶nych systemach komunikacyjnych, odgrywajc kluczow rol w ustanawianiu i zarzdzaniu sesjami multimedialnymi w czasie rzeczywistym w sieciach IP.

### RTP / RTCP / SRTP / ZRTP

1. **RTP (Protok贸 transportu w czasie rzeczywistym)**: RTP to protok贸 sieciowy zaprojektowany do dostarczania danych audio i wideo lub innych medi贸w w czasie rzeczywistym przez sieci IP. Opracowany przez **IETF** i zdefiniowany w **RFC 3550**, RTP jest powszechnie u偶ywany z protokoami sygnalizacyjnymi, takimi jak SIP i H.323, aby umo偶liwi komunikacj multimedialn. RTP zapewnia mechanizmy do **synchronizacji**, **sekwencjonowania** i **znacznikowania czasowego** strumieni medi贸w, pomagajc zapewni pynne i terminowe odtwarzanie medi贸w.
2. **RTCP (Protok贸 kontroli transportu w czasie rzeczywistym)**: RTCP to protok贸 towarzyszcy RTP, u偶ywany do monitorowania jakoci usug (QoS) i dostarczania informacji zwrotnej na temat transmisji strumieni medi贸w. Zdefiniowany w tym samym **RFC 3550** co RTP, RTCP **okresowo wymienia pakiety kontrolne midzy uczestnikami sesji RTP**. Dzieli si informacjami takimi jak utrata pakiet贸w, jitter i czas okr偶enia, co pomaga w diagnozowaniu i dostosowywaniu si do warunk贸w sieciowych, poprawiajc og贸ln jako medi贸w.
3. **SRTP (Bezpieczny protok贸 transportu w czasie rzeczywistym)**: SRTP to rozszerzenie RTP, kt贸re zapewnia **szyfrowanie**, **uwierzytelnianie wiadomoci** i **ochron przed powt贸rkami** dla strumieni medi贸w, zapewniajc bezpieczn transmisj wra偶liwych danych audio i wideo. Zdefiniowany w **RFC 3711**, SRTP u偶ywa algorytm贸w kryptograficznych, takich jak AES do szyfrowania i HMAC-SHA1 do uwierzytelniania wiadomoci. SRTP jest czsto u偶ywany w poczeniu z bezpiecznymi protokoami sygnalizacyjnymi, takimi jak SIP przez TLS, aby zapewni bezpieczestwo end-to-end w komunikacji multimedialnej.
4. **ZRTP (Protok贸 transportu w czasie rzeczywistym Zimmermanna)**: ZRTP to protok贸 uzgadniania kluczy kryptograficznych, kt贸ry zapewnia **szyfrowanie end-to-end** dla strumieni medi贸w RTP. Opracowany przez Phila Zimmermanna, tw贸rc PGP, ZRTP jest opisany w **RFC 6189**. W przeciwiestwie do SRTP, kt贸ry polega na protokoach sygnalizacyjnych do wymiany kluczy, ZRTP jest zaprojektowany do pracy niezale偶nie od protokou sygnalizacyjnego. U偶ywa **wymiany kluczy Diffiego-Hellmana** do ustanowienia wsp贸lnego sekretu midzy komunikujcymi si stronami, bez potrzeby wczeniejszego zaufania lub infrastruktury kluczy publicznych (PKI). ZRTP zawiera r贸wnie偶 funkcje takie jak **Kr贸tkie cigi uwierzytelniajce (SAS)**, aby chroni przed atakami typu man-in-the-middle.

Te protokoy odgrywaj istotn rol w **dostarczaniu i zabezpieczaniu komunikacji multimedialnej w czasie rzeczywistym przez sieci IP**. Podczas gdy RTP i RTCP obsuguj rzeczywist transmisj medi贸w i monitorowanie jakoci, SRTP i ZRTP zapewniaj, 偶e przesyane media s chronione przed podsuchiwaniem, manipulacj i atakami powt贸rkowymi.

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
</details>
{% endhint %}
