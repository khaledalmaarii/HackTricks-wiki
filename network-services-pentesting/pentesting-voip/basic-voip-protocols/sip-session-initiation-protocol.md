# SIP (Oturum BaÅŸlatma ProtokolÃ¼)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
{% endhint %}

## Temel Bilgiler

SIP (Oturum BaÅŸlatma ProtokolÃ¼), IP aÄŸlarÄ± Ã¼zerinden ses, video ve anlÄ±k mesajlaÅŸma dahil olmak Ã¼zere Ã§oklu ortam oturumlarÄ±nÄ± baÅŸlatmak, deÄŸiÅŸtirmek ve sonlandÄ±rmak iÃ§in yaygÄ±n olarak kullanÄ±lan bir **sinyalizasyon ve Ã§aÄŸrÄ± kontrol protokolÃ¼dÃ¼r**. **Internet Engineering Task Force (IETF)** tarafÄ±ndan geliÅŸtirilen SIP, **RFC 3261**'de tanÄ±mlanmÄ±ÅŸtÄ±r ve VoIP ve birleÅŸik iletiÅŸim iÃ§in fiili standart haline gelmiÅŸtir.

SIP'in bazÄ± temel Ã¶zellikleri ÅŸunlardÄ±r:

1. **Metin TabanlÄ± Protokol**: SIP, insan tarafÄ±ndan okunabilir ve hata ayÄ±klamayÄ± kolaylaÅŸtÄ±ran metin tabanlÄ± bir protokoldÃ¼r. HTTP'ye benzer bir istek-cevap modeline dayanÄ±r ve Ã§aÄŸrÄ± oturumlarÄ±nÄ± kontrol etmek iÃ§in INVITE, ACK, BYE ve CANCEL gibi yÃ¶ntemler kullanÄ±r.
2. **Ã–lÃ§eklenebilirlik ve Esneklik**: SIP, yÃ¼ksek derecede Ã¶lÃ§eklenebilir olup, kÃ¼Ã§Ã¼k Ã¶lÃ§ekli daÄŸÄ±tÄ±mlardan bÃ¼yÃ¼k iÅŸletme ve taÅŸÄ±yÄ±cÄ± sÄ±nÄ±fÄ± ortamlara kadar kullanÄ±labilir. Yeni Ã¶zelliklerle kolayca geniÅŸletilebilir, bu da Ã§eÅŸitli kullanÄ±m senaryolarÄ±na ve gereksinimlere uyum saÄŸlamasÄ±nÄ± saÄŸlar.
3. **EtkileÅŸim**: SIP'in yaygÄ±n benimsenmesi ve standartlaÅŸmasÄ±, farklÄ± cihazlar, uygulamalar ve hizmet saÄŸlayÄ±cÄ±larÄ± arasÄ±nda daha iyi etkileÅŸim saÄŸlar ve Ã§eÅŸitli platformlar arasÄ±nda kesintisiz iletiÅŸimi teÅŸvik eder.
4. **ModÃ¼ler TasarÄ±m**: SIP, medya iletimi iÃ§in **RTP (GerÃ§ek ZamanlÄ± TaÅŸÄ±ma ProtokolÃ¼)** ve Ã§oklu ortam oturumlarÄ±nÄ± tanÄ±mlamak iÃ§in **SDP (Oturum TanÄ±m ProtokolÃ¼)** gibi diÄŸer protokollerle Ã§alÄ±ÅŸÄ±r. Bu modÃ¼ler tasarÄ±m, farklÄ± medya tÃ¼rleri ve kodeklerle daha bÃ¼yÃ¼k bir esneklik ve uyumluluk saÄŸlar.
5. **Proxy ve YÃ¶nlendirme SunucularÄ±**: SIP, Ã§aÄŸrÄ± yÃ¶nlendirmeyi kolaylaÅŸtÄ±rmak ve Ã§aÄŸrÄ± yÃ¶nlendirme, Ã§aÄŸrÄ± transferi ve sesli mesaj hizmetleri gibi geliÅŸmiÅŸ Ã¶zellikler saÄŸlamak iÃ§in proxy ve yÃ¶nlendirme sunucularÄ±nÄ± kullanabilir.
6. **VarlÄ±k ve AnlÄ±k MesajlaÅŸma**: SIP, ses ve video iletiÅŸimi ile sÄ±nÄ±rlÄ± deÄŸildir. AyrÄ±ca varlÄ±k ve anlÄ±k mesajlaÅŸmayÄ± destekler, bu da geniÅŸ bir birleÅŸik iletiÅŸim uygulamalarÄ± yelpazesini mÃ¼mkÃ¼n kÄ±lar.

BirÃ§ok avantajÄ±na raÄŸmen, SIP, Ã¶zellikle NAT geÃ§iÅŸi ve gÃ¼venlik duvarÄ± sorunlarÄ±yla baÅŸa Ã§Ä±karken yapÄ±landÄ±rmasÄ± ve yÃ¶netimi karmaÅŸÄ±k olabilir. Ancak, Ã§ok yÃ¶nlÃ¼lÃ¼ÄŸÃ¼, Ã¶lÃ§eklenebilirliÄŸi ve endÃ¼stri genelindeki geniÅŸ desteÄŸi, onu VoIP ve Ã§oklu ortam iletiÅŸimi iÃ§in popÃ¼ler bir seÃ§im haline getirir.

### SIP YÃ¶ntemleri

**RFC 3261**'de tanÄ±mlanan temel SIP yÃ¶ntemleri ÅŸunlardÄ±r:

1. **INVITE**: Yeni bir oturum (Ã§aÄŸrÄ±) baÅŸlatmak veya mevcut bir oturumu deÄŸiÅŸtirmek iÃ§in kullanÄ±lÄ±r. INVITE yÃ¶ntemi, Ã¶nerilen oturumun ayrÄ±ntÄ±larÄ±nÄ±, medya tÃ¼rleri, kodekler ve taÅŸÄ±ma protokolleri gibi bilgileri alÄ±cÄ±ya iletmek iÃ§in oturum tanÄ±mÄ±nÄ± (genellikle SDP kullanarak) taÅŸÄ±r.
2. **ACK**: Bir INVITE isteÄŸine verilen son yanÄ±tÄ±n alÄ±ndÄ±ÄŸÄ±nÄ± **onaylamak iÃ§in** gÃ¶nderilir. ACK yÃ¶ntemi, uÃ§tan uca onay saÄŸlayarak INVITE iÅŸlemlerinin gÃ¼venilirliÄŸini saÄŸlar.
3. **BYE**: KurulmuÅŸ bir oturumu (Ã§aÄŸrÄ±yÄ±) **sonlandÄ±rmak iÃ§in** kullanÄ±lÄ±r. BYE yÃ¶ntemi, iletiÅŸimi sonlandÄ±rmak isteyen taraf tarafÄ±ndan gÃ¶nderilir.
4. **CANCEL**: Oturum kurulmadan Ã¶nce bekleyen bir INVITE isteÄŸini **iptal etmek iÃ§in** gÃ¶nderilir. CANCEL yÃ¶ntemi, gÃ¶nderenin fikrini deÄŸiÅŸtirmesi veya alÄ±cÄ±dan yanÄ±t gelmemesi durumunda bir INVITE iÅŸlemini iptal etmesine olanak tanÄ±r.
5. **OPTIONS**: Bir SIP sunucusunun veya kullanÄ±cÄ± aracÄ±sÄ±nÄ±n **yeteneklerini sorgulamak iÃ§in** kullanÄ±lÄ±r. OPTIONS yÃ¶ntemi, oturum kurmadan desteklenen yÃ¶ntemler, medya tÃ¼rleri veya diÄŸer uzantÄ±lar hakkÄ±nda bilgi talep etmek iÃ§in gÃ¶nderilebilir.
6. **REGISTER**: Bir kullanÄ±cÄ± aracÄ± tarafÄ±ndan **bir SIP kayÄ±t sunucusuna mevcut konumunu kaydetmek iÃ§in** kullanÄ±lÄ±r. REGISTER yÃ¶ntemi, bir kullanÄ±cÄ±nÄ±n SIP URI'si ile mevcut IP adresi arasÄ±nda gÃ¼ncel bir eÅŸleme saÄŸlamaya yardÄ±mcÄ± olur, bu da Ã§aÄŸrÄ± yÃ¶nlendirme ve teslimatÄ±nÄ± mÃ¼mkÃ¼n kÄ±lar.

{% hint style="warning" %}
Birine Ã§aÄŸrÄ± yapmak iÃ§in **REGISTER** kullanmak **gerekli deÄŸildir**.\
Ancak, bir **INVITE** gerÃ§ekleÅŸtirmek iÃ§in arayanÄ±n Ã¶nce **kimlik doÄŸrulamasÄ±** yapmasÄ± gerekebilir veya **`401 Unauthorized`** yanÄ±tÄ± alabilir.
{% endhint %}

Bu temel yÃ¶ntemlerin yanÄ± sÄ±ra, diÄŸer RFC'lerde tanÄ±mlanan **birÃ§ok SIP uzantÄ± yÃ¶ntemi** bulunmaktadÄ±r:

1. **SUBSCRIBE**: RFC 6665'te tanÄ±mlanan SUBSCRIBE yÃ¶ntemi, belirli bir kaynaÄŸÄ±n durumu hakkÄ±nda **bildirim talep etmek iÃ§in** kullanÄ±lÄ±r, Ã¶rneÄŸin bir kullanÄ±cÄ±nÄ±n varlÄ±ÄŸÄ± veya Ã§aÄŸrÄ± durumu.
2. **NOTIFY**: RFC 6665'te de tanÄ±mlanan NOTIFY yÃ¶ntemi, bir sunucu tarafÄ±ndan **abonelikteki bir kullanÄ±cÄ± aracÄ±sÄ±na** izlenen bir kaynaÄŸÄ±n durumundaki deÄŸiÅŸiklikler hakkÄ±nda bilgi vermek iÃ§in gÃ¶nderilir.
3. **REFER**: RFC 3515'te tanÄ±mlanan REFER yÃ¶ntemi, alÄ±cÄ±nÄ±n bir transfer gerÃ§ekleÅŸtirmesini veya Ã¼Ã§Ã¼ncÃ¼ bir tarafa yÃ¶nlendirmesini **talep etmek iÃ§in** kullanÄ±lÄ±r. Bu genellikle **Ã§aÄŸrÄ± transferi** senaryolarÄ±nda kullanÄ±lÄ±r.
4. **MESSAGE**: RFC 3428'de tanÄ±mlanan MESSAGE yÃ¶ntemi, SIP kullanÄ±cÄ± araÃ§larÄ± arasÄ±nda **anlÄ±k mesajlar gÃ¶ndermek iÃ§in** kullanÄ±lÄ±r ve SIP Ã§erÃ§evesinde metin tabanlÄ± iletiÅŸimi mÃ¼mkÃ¼n kÄ±lar.
5. **UPDATE**: RFC 3311'de tanÄ±mlanan UPDATE yÃ¶ntemi, **mevcut diyalogun durumunu etkilemeden bir oturumu deÄŸiÅŸtirmeye** olanak tanÄ±r. Bu, devam eden bir Ã§aÄŸrÄ± sÄ±rasÄ±nda kodekler veya medya tÃ¼rleri gibi oturum parametrelerini gÃ¼ncellemek iÃ§in yararlÄ±dÄ±r.
6. **PUBLISH**: RFC 3903'te tanÄ±mlanan PUBLISH yÃ¶ntemi, bir kullanÄ±cÄ± aracÄ± tarafÄ±ndan **bir sunucuya olay durumu bilgilerini yayÄ±nlamak iÃ§in** kullanÄ±lÄ±r ve bu bilgileri diÄŸer ilgilenen taraflara sunar.

### SIP YanÄ±t KodlarÄ±

* **1xx (GeÃ§ici YanÄ±tlar)**: Bu yanÄ±tlar, isteÄŸin alÄ±ndÄ±ÄŸÄ±nÄ± ve sunucunun iÅŸlemeye devam ettiÄŸini gÃ¶sterir.
* 100 Trying: Ä°stek alÄ±ndÄ± ve sunucu Ã¼zerinde Ã§alÄ±ÅŸÄ±yor.
* 180 Ringing: Aranan kiÅŸi uyarÄ±lÄ±yor ve Ã§aÄŸrÄ±yÄ± alacak.
* 183 Session Progress: Ã‡aÄŸrÄ±nÄ±n ilerlemesi hakkÄ±nda bilgi saÄŸlar.
* **2xx (BaÅŸarÄ±lÄ± YanÄ±tlar)**: Bu yanÄ±tlar, isteÄŸin baÅŸarÄ±yla alÄ±ndÄ±ÄŸÄ±nÄ±, anlaÅŸÄ±ldÄ±ÄŸÄ±nÄ± ve kabul edildiÄŸini gÃ¶sterir.
* 200 OK: Ä°stek baÅŸarÄ±lÄ± oldu ve sunucu bunu yerine getirdi.
* 202 Accepted: Ä°stek iÅŸleme alÄ±ndÄ±, ancak henÃ¼z tamamlanmadÄ±.
* **3xx (YÃ¶nlendirme YanÄ±tlarÄ±)**: Bu yanÄ±tlar, isteÄŸi yerine getirmek iÃ§in daha fazla eylem gerektiÄŸini gÃ¶sterir, genellikle alternatif bir kaynaÄŸa baÅŸvurarak.
* 300 Multiple Choices: Birden fazla seÃ§enek mevcut ve kullanÄ±cÄ± veya istemci birini seÃ§melidir.
* 301 Moved Permanently: Ä°stenilen kaynak yeni bir kalÄ±cÄ± URI'ye atanmÄ±ÅŸtÄ±r.
* 302 Moved Temporarily: Ä°stenilen kaynak geÃ§ici olarak farklÄ± bir URI'de mevcuttur.
* 305 Use Proxy: Ä°stek belirtilen bir proxy'e gÃ¶nderilmelidir.
* **4xx (Ä°stemci HatasÄ± YanÄ±tlarÄ±)**: Bu yanÄ±tlar, isteÄŸin kÃ¶tÃ¼ bir sÃ¶zdizimi iÃ§erdiÄŸini veya sunucu tarafÄ±ndan yerine getirilemeyeceÄŸini gÃ¶sterir.
* 400 Bad Request: Ä°stek biÃ§imsel olarak hatalÄ± veya geÃ§ersizdi.
* 401 Unauthorized: Ä°stek kullanÄ±cÄ± kimlik doÄŸrulamasÄ± gerektirir.
* 403 Forbidden: Sunucu isteÄŸi anladÄ± ancak yerine getirmeyi reddetti.
* 404 Not Found: Ä°stenilen kaynak sunucuda bulunamadÄ±.
* 408 Request Timeout: Sunucu, beklemeye hazÄ±r olduÄŸu sÃ¼re iÃ§inde tamamlanmÄ±ÅŸ bir istek almadÄ±.
* 486 Busy Here: Aranan kiÅŸi ÅŸu anda meÅŸguldÃ¼r ve Ã§aÄŸrÄ±yÄ± alamaz.
* **5xx (Sunucu HatasÄ± YanÄ±tlarÄ±)**: Bu yanÄ±tlar, sunucunun geÃ§erli bir isteÄŸi yerine getirmekte baÅŸarÄ±sÄ±z olduÄŸunu gÃ¶sterir.
* 500 Internal Server Error: Sunucu isteÄŸi iÅŸlerken bir hata ile karÅŸÄ±laÅŸtÄ±.
* 501 Not Implemented: Sunucu, isteÄŸi yerine getirmek iÃ§in gereken iÅŸlevselliÄŸi desteklemiyor.
* 503 Service Unavailable: Sunucu, bakÄ±m veya aÅŸÄ±rÄ± yÃ¼k nedeniyle isteÄŸi ÅŸu anda iÅŸleyemiyor.
* **6xx (KÃ¼resel Hata YanÄ±tlarÄ±)**: Bu yanÄ±tlar, isteÄŸin herhangi bir sunucu tarafÄ±ndan yerine getirilemeyeceÄŸini gÃ¶sterir.
* 600 Busy Everywhere: Ã‡aÄŸrÄ± iÃ§in tÃ¼m olasÄ± varÄ±ÅŸ noktalarÄ± meÅŸguldÃ¼r.
* 603 Decline: Aranan kiÅŸi Ã§aÄŸrÄ±ya katÄ±lmak istemiyor.
* 604 Does Not Exist Anywhere: Ä°stenilen kaynak aÄŸda hiÃ§bir yerde mevcut deÄŸil.

## Ã–rnekler

### SIP INVITE Ã–rneÄŸi
```
INVITE sip:jdoe@example.com SIP/2.0
Via: SIP/2.0/UDP pc33.example.com;branch=z9hG4bK776asdhds
Max-Forwards: 70
To: John Doe <sip:jdoe@example.com>
From: Jane Smith <sip:jsmith@example.org>;tag=1928301774
Call-ID: a84b4c76e66710
CSeq: 314159 INVITE
Contact: <sip:jsmith@pc33.example.com>
User-Agent: ExampleSIPClient/1.0
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY, MESSAGE, SUBSCRIBE, INFO
Content-Type: application/sdp
Content-Length: 142

v=0
o=jsmith 2890844526 2890842807 IN IP4 pc33.example.com
s=-
c=IN IP4 pc33.example.com
t=0 0
m=audio 49170 RTP/AVP 0
a=rtpmap:0 PCMU/8000te
```
<details>

<summary>Her Parametre AÃ§Ä±klandÄ±</summary>

1. **Request-Line**: `INVITE sip:jdoe@example.com SIP/2.0` - Bu satÄ±r, yÃ¶ntemi (INVITE), istek URI'sini (sip:[jdoe@example.com](mailto:jdoe@example.com)) ve SIP sÃ¼rÃ¼mÃ¼nÃ¼ (SIP/2.0) belirtir.
2. **Via**: `Via: SIP/2.0/UDP pc33.example.com;branch=z9hG4bK776asdhds` - Via baÅŸlÄ±ÄŸÄ±, taÅŸÄ±ma protokolÃ¼nÃ¼ (UDP) ve istemcinin adresini (pc33.example.com) belirtir. "branch" parametresi dÃ¶ngÃ¼ tespiti ve iÅŸlem eÅŸleÅŸtirmesi iÃ§in kullanÄ±lÄ±r.
3. **Max-Forwards**: `Max-Forwards: 70` - Bu baÅŸlÄ±k alanÄ±, isteÄŸin proxyler tarafÄ±ndan kaÃ§ kez iletilebileceÄŸini sÄ±nÄ±rlayarak sonsuz dÃ¶ngÃ¼leri Ã¶nler.
4. **To**: `To: John Doe <sip:jdoe@example.com>` - To baÅŸlÄ±ÄŸÄ±, aramanÄ±n alÄ±cÄ±sÄ±nÄ±, gÃ¶rÃ¼ntÃ¼leme adÄ±nÄ± (John Doe) ve SIP URI'sini (sip:[jdoe@example.com](mailto:jdoe@example.com)) belirtir.
5. **From**: `From: Jane Smith <sip:jsmith@example.org>;tag=1928301774` - From baÅŸlÄ±ÄŸÄ±, aramanÄ±n gÃ¶nderenini, gÃ¶rÃ¼ntÃ¼leme adÄ±nÄ± (Jane Smith) ve SIP URI'sini (sip:[jsmith@example.org](mailto:jsmith@example.org)) belirtir. "tag" parametresi, gÃ¶nderenin diyalogdaki rolÃ¼nÃ¼ benzersiz olarak tanÄ±mlamak iÃ§in kullanÄ±lÄ±r.
6. **Call-ID**: `Call-ID: a84b4c76e66710` - Call-ID baÅŸlÄ±ÄŸÄ±, iki kullanÄ±cÄ± ajanÄ± arasÄ±ndaki bir Ã§aÄŸrÄ± oturumunu benzersiz olarak tanÄ±mlar.
7. **CSeq**: `CSeq: 314159 INVITE` - CSeq baÅŸlÄ±ÄŸÄ±, bir sÄ±ra numarasÄ± ve istekte kullanÄ±lan yÃ¶ntemi iÃ§erir. YanÄ±tlarÄ± isteklere eÅŸleÅŸtirmek ve sÄ±rasÄ±z mesajlarÄ± tespit etmek iÃ§in kullanÄ±lÄ±r.
8. **Contact**: `Contact: <sip:jsmith@pc33.example.com>` - Contact baÅŸlÄ±ÄŸÄ±, gÃ¶nderenin doÄŸrudan yolunu saÄŸlar; bu, sonraki istekler ve yanÄ±tlar iÃ§in kullanÄ±labilir.
9. **User-Agent**: `User-Agent: ExampleSIPClient/1.0` - User-Agent baÅŸlÄ±ÄŸÄ±, gÃ¶nderenin yazÄ±lÄ±mÄ± veya donanÄ±mÄ± hakkÄ±nda bilgi saÄŸlar; adÄ± ve sÃ¼rÃ¼mÃ¼nÃ¼ iÃ§erir.
10. **Allow**: `Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY, MESSAGE, SUBSCRIBE, INFO` - Allow baÅŸlÄ±ÄŸÄ±, gÃ¶nderen tarafÄ±ndan desteklenen SIP yÃ¶ntemlerini listeler. Bu, alÄ±cÄ±nÄ±n iletiÅŸim sÄ±rasÄ±nda hangi yÃ¶ntemlerin kullanÄ±labileceÄŸini anlamasÄ±na yardÄ±mcÄ± olur.
11. **Content-Type**: `Content-Type: application/sdp` - Content-Type baÅŸlÄ±ÄŸÄ±, mesaj gÃ¶vdesinin medya tÃ¼rÃ¼nÃ¼ belirtir; bu durumda, SDP (Oturum TanÄ±m ProtokolÃ¼).
12. **Content-Length**: `Content-Length: 142` - Content-Length baÅŸlÄ±ÄŸÄ±, mesaj gÃ¶vdesinin boyutunu bayt cinsinden belirtir.
13. **Message Body**: Mesaj gÃ¶vdesi, Ã¶nerilen oturum iÃ§in medya tÃ¼rleri, kodekler ve taÅŸÄ±ma protokolleri hakkÄ±nda bilgi iÃ§eren SDP oturum tanÄ±mÄ±nÄ± iÃ§erir.

* `v=0` - Protokol sÃ¼rÃ¼mÃ¼ (SDP iÃ§in 0)
* `o=jsmith 2890844526 2890842807 IN IP4 pc33.example.com` - BaÅŸlatÄ±cÄ± ve oturum tanÄ±mlayÄ±cÄ±
* `s=-` - Oturum adÄ± (tek bir tire, oturum adÄ± olmadÄ±ÄŸÄ±nÄ± belirtir)
* `c=IN IP4 pc33.example.com` - BaÄŸlantÄ± bilgileri (aÄŸ tÃ¼rÃ¼, adres tÃ¼rÃ¼ ve adres)
* `t=0 0` - Zamanlama bilgileri (baÅŸlangÄ±Ã§ ve bitiÅŸ zamanlarÄ±, 0 0 oturumun sÄ±nÄ±rlÄ± olmadÄ±ÄŸÄ±nÄ± belirtir)
* `m=audio 49170 RTP/AVP 0` - Medya tanÄ±mÄ± (medya tÃ¼rÃ¼, port numarasÄ±, taÅŸÄ±ma protokolÃ¼ ve format listesi). Bu durumda, RTP/AVP (GerÃ§ek ZamanlÄ± TaÅŸÄ±ma ProtokolÃ¼ / Ses Video Profili) kullanarak bir ses akÄ±ÅŸÄ±nÄ± ve format 0 (PCMU/8000) belirtir.
* `a=rtpmap:0 PCMU/8000` - FormatÄ± (0) kodek (PCMU) ve saat hÄ±zÄ± (8000 Hz) ile eÅŸleyen Ã¶zellik.

</details>

### SIP REGISTER Ã–rneÄŸi

REGISTER yÃ¶ntemi, bir kullanÄ±cÄ± ajanÄ±nÄ±n (UA), Ã¶rneÄŸin bir VoIP telefonu veya bir softphone'un, **bir SIP kayÄ±t sunucusuna konumunu kaydetmesine** olanak tanÄ±r. Bu sÃ¼reÃ§, sunucunun **kayÄ±tlÄ± kullanÄ±cÄ±ya yÃ¶nelik gelen SIP isteklerini nereye yÃ¶nlendireceÄŸini bilmesini saÄŸlar**. KayÄ±t sunucusu genellikle bir SIP proxy sunucusunun veya Ã¶zel bir kayÄ±t sunucusunun parÃ§asÄ±dÄ±r.

Ä°ÅŸte bir REGISTER kimlik doÄŸrulama sÃ¼recinde yer alan SIP mesajlarÄ±nÄ±n ayrÄ±ntÄ±lÄ± bir Ã¶rneÄŸi:

1. UA'dan kayÄ±t sunucusuna ilk **REGISTER** isteÄŸi:
```yaml
REGISTER sip:example.com SIP/2.0
Via: SIP/2.0/UDP 192.168.1.100:5060;branch=z9hG4bK776asdhds
Max-Forwards: 70
From: Alice <sip:alice@example.com>;tag=565656
To: Alice <sip:alice@example.com>
Call-ID: 1234567890@192.168.1.100
CSeq: 1 REGISTER
Contact: <sip:alice@192.168.1.100:5060>;expires=3600
Expires: 3600
Content-Length: 0
```
Bu baÅŸlangÄ±Ã§ REGISTER mesajÄ±, UA (Alice) tarafÄ±ndan kayÄ±t sunucusuna gÃ¶nderilir. Ä°stenilen kayÄ±t sÃ¼resi (Expires), kullanÄ±cÄ±nÄ±n SIP URI'si (sip:[alice@example.com](mailto:alice@example.com)) ve kullanÄ±cÄ±nÄ±n iletiÅŸim adresi (sip:alice@192.168.1.100:5060) gibi Ã¶nemli bilgileri iÃ§erir.

2. **401 Yetkisiz** yanÄ±tÄ± kayÄ±t sunucusundan:
```css
cssCopy codeSIP/2.0 401 Unauthorized
Via: SIP/2.0/UDP 192.168.1.100:5060;branch=z9hG4bK776asdhds
From: Alice <sip:alice@example.com>;tag=565656
To: Alice <sip:alice@example.com>;tag=7878744
Call-ID: 1234567890@192.168.1.100
CSeq: 1 REGISTER
WWW-Authenticate: Digest realm="example.com", nonce="abcdefghijk", algorithm=MD5, qop="auth"
Content-Length: 0
```
The registrar server responds with a "401 Unauthorized" message, which includes a "WWW-Authenticate" header. This header contains information required for the UA to authenticate itself, such as the **authentication realm, nonce, and algorithm**.

3. KAYIT isteÄŸi **kimlik doÄŸrulama bilgileri ile**:
```vbnet
REGISTER sip:example.com SIP/2.0
Via: SIP/2.0/UDP 192.168.1.100:5060;branch=z9hG4bK776asdhds
Max-Forwards: 70
From: Alice <sip:alice@example.com>;tag=565656
To: Alice <sip:alice@example.com>
Call-ID: 1234567890@192.168.1.100
CSeq: 2 REGISTER
Contact: <sip:alice@192.168.1.100:5060>;expires=3600
Expires: 3600
Authorization: Digest username="alice", realm="example.com", nonce="abcdefghijk", uri="sip:example.com", response="65a8e2285879283831b664bd8b7f14d4", algorithm=MD5, cnonce="lmnopqrst", qop=auth, nc=00000001
Content-Length: 0
```
UA, bu sefer gerekli kimlik bilgilerini iÃ§eren **"Authorization" baÅŸlÄ±ÄŸÄ±nÄ±, kullanÄ±cÄ± adÄ±, realm, nonce ve saÄŸlanan bilgiler ile kullanÄ±cÄ±nÄ±n ÅŸifresini kullanarak hesaplanan bir yanÄ±t deÄŸeri** ile birlikte baÅŸka bir REGISTER isteÄŸi gÃ¶nderir.

**Authorization yanÄ±tÄ±** bu ÅŸekilde hesaplanÄ±r:
```python
import hashlib

def calculate_sip_md5_response(username, password, realm, method, uri, nonce, nc, cnonce, qop):
# 1. Calculate HA1 (concatenation of username, realm, and password)
ha1_input = f"{username}:{realm}:{password}"
ha1 = hashlib.md5(ha1_input.encode()).hexdigest()

# 2. Calculate HA2 (concatenation of method and uri)
ha2_input = f"{method}:{uri}"
ha2 = hashlib.md5(ha2_input.encode()).hexdigest()

# 3. Calculate the final response value (concatenation of h1, stuff and h2)
response_input = f"{ha1}:{nonce}:{nc}:{cnonce}:{qop}:{ha2}"
response = hashlib.md5(response_input.encode()).hexdigest()

return response

# Example usage
username = "alice"
password = "mysecretpassword"
realm = "example.com"
method = "REGISTER"
uri = "sip:example.com"
nonce = "abcdefghijk"
nc = "00000001"
cnonce = "lmnopqrst"
qop = "auth"

response = calculate_sip_md5_response(username, password, realm, method, uri, nonce, nc, cnonce, qop)
print(f"MD5 response value: {response}")
```
4. **BaÅŸarÄ±lÄ± kayÄ±t** yanÄ±tÄ± kayÄ±t sunucusundan:
```yaml
SIP/2.0 200 OK
Via: SIP/2.0/UDP 192.168.1.100:5060;branch=z9hG4bK776asdhds
From: Alice <sip:alice@example.com>;tag=565656
To: Alice <sip:alice@example.com>;tag=7878744
Call-ID: 1234567890@192.168.1.100
CSeq: 2 REGISTER
Contact: <sip:alice@192.168.1.100:5060>;expires=3600
Expires: 3600
Content-Length: 0
```
After the registrar server verifies the provided credentials, **kayÄ±t iÅŸleminin baÅŸarÄ±lÄ± olduÄŸunu belirtmek iÃ§in "200 OK" yanÄ±tÄ± gÃ¶nderir**. YanÄ±t, kayÄ±tlÄ± iletiÅŸim bilgilerini ve kaydÄ±n sona erme zamanÄ±nÄ± iÃ§erir. Bu noktada, kullanÄ±cÄ± ajanÄ± (Alice) SIP kayÄ±t sunucusuna baÅŸarÄ±yla kaydedilmiÅŸtir ve Alice iÃ§in gelen SIP istekleri uygun iletiÅŸim adresine yÃ¶nlendirilebilir.

### Arama Ã–rneÄŸi

<figure><img src="../../../.gitbook/assets/image (1101).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
BahsedilmemiÅŸtir, ancak KullanÄ±cÄ± B'nin arama alabilmesi iÃ§in **Proxy 2'ye bir REGISTER mesajÄ± gÃ¶ndermiÅŸ olmasÄ± gerekir**.
{% endhint %}
{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
</details>
{% endhint %}
