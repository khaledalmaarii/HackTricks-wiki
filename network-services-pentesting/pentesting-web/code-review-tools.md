# Przegld kodu 藕r贸dowego / Narzdzia SAST

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Wskaz贸wki i listy narzdzi

* [**https://owasp.org/www-community/Source\_Code\_Analysis\_Tools**](https://owasp.org/www-community/Source\_Code\_Analysis\_Tools)
* [**https://github.com/analysis-tools-dev/static-analysis**](https://github.com/analysis-tools-dev/static-analysis)

## Narzdzia wielojzyczne

### [Naxus - AI-Gents](https://www.naxusai.com/)

Dostpny jest **darmowy pakiet do przegldu PR**.

### [**Semgrep**](https://github.com/returntocorp/semgrep)

To jest **narzdzie Open Source**.

#### Obsugiwane jzyki

| Kategoria     | Jzyki                                                                                                |
| ------------ | ----------------------------------------------------------------------------------------------------- |
| GA           | C# 路 Go 路 Java 路 JavaScript 路 JSX 路 JSON 路 PHP 路 Python 路 Ruby 路 Scala 路 Terraform 路 TypeScript 路 TSX |
| Beta         | Kotlin 路 Rust                                                                                         |
| Experimental | Bash 路 C 路 C++ 路 Clojure 路 Dart 路 Dockerfile 路 Elixir 路 HTML 路 Julia 路 Jsonnet 路 Lisp 路               |

#### Szybki start

{% code overflow="wrap" %}
```bash
# Install https://github.com/returntocorp/semgrep#option-1-getting-started-from-the-cli
brew install semgrep

# Go to your repo code and scan
cd repo
semgrep scan --config auto
```
{% endcode %}

Mo偶esz r贸wnie偶 u偶y [**rozszerzenia semgrep dla VSCode**](https://marketplace.visualstudio.com/items?itemName=Semgrep.semgrep), aby otrzyma wyniki wewntrz VSCode.

### [**SonarQube**](https://www.sonarsource.com/products/sonarqube/downloads/)

Dostpna jest bezpatna wersja instalacyjna.

#### Szybki start

{% code overflow="wrap" %}
```bash
# Run the paltform in docker
docker run -d --name sonarqube -e SONAR_ES_BOOTSTRAP_CHECKS_DISABLE=true -p 9000:9000 sonarqube:latest
# Install cli tool
brew install sonar-scanner

# Go to localhost:9000 and login with admin:admin or admin:sonar
# Generate a local project and then a TOKEN for it

# Using the token and from the folder with the repo, scan it
cd path/to/repo
sonar-scanner \
-Dsonar.projectKey=<project-name> \
-Dsonar.sources=. \
-Dsonar.host.url=http://localhost:9000 \
-Dsonar.token=<sonar_project_token>
```
{% endcode %}

### CodeQL

Istnieje **darmowa wersja instalacyjna**, ale zgodnie z licencj mo偶na jej u偶ywa **tylko w projektach Open Source**.

#### Instalacja

{% code overflow="wrap" %}
```bash
# Download your release from https://github.com/github/codeql-action/releases
## Example
wget https://github.com/github/codeql-action/releases/download/codeql-bundle-v2.14.3/codeql-bundle-osx64.tar.gz

# Move it to the destination folder
mkdir ~/codeql
mv codeql-bundle* ~/codeql

# Decompress it
cd ~/codeql
tar -xzvf codeql-bundle-*.tar.gz
rm codeql-bundle-*.tar.gz

# Add to path
echo 'export PATH="$PATH:/Users/username/codeql/codeql"' >> ~/.zshrc

# Check it's correctly installed
## Open a new terminal
codeql resolve qlpacks #Get paths to QL packs
```
{% endcode %}

#### Szybki start - Przygotuj baz danych

{% hint style="success" %}
Pierwsz rzecz, kt贸r musisz zrobi, jest **przygotowanie bazy danych** (utworzenie drzewa kodu), aby p贸藕niej mo偶na byo na niej wykonywa zapytania.
{% endhint %}

* Mo偶esz pozwoli codeql automatycznie zidentyfikowa jzyk repozytorium i utworzy baz danych

{% code overflow="wrap" %}
```bash
codeql database create <database> --language <language>

# Example
codeql database create /path/repo/codeql_db --source-root /path/repo
## DB will be created in /path/repo/codeql_db
```
{% endcode %}

{% hint style="danger" %}
To **zazwyczaj spowoduje bd**, kt贸ry m贸wi, 偶e okrelono wicej ni偶 jeden jzyk (lub wykryto je automatycznie). **Sprawd藕 nastpujce opcje**, aby to naprawi!
{% endhint %}

* Mo偶esz to zrobi **rcznie wskazujc** **repozytorium** i **jzyk** ([lista jzyk贸w](https://docs.github.com/en/code-security/codeql-cli/getting-started-with-the-codeql-cli/preparing-your-code-for-codeql-analysis#running-codeql-database-create))

{% code overflow="wrap" %}
```bash
codeql database create <database> --language <language> --source-root </path/to/repo>

# Example
codeql database create /path/repo/codeql_db --language javascript --source-root /path/repo
## DB will be created in /path/repo/codeql_db
```
{% endcode %}

* Jeli twoje repozytorium u偶ywa **wicej ni偶 1 jzyka**, mo偶esz r贸wnie偶 utworzy **1 baz danych na jzyk**, wskazujc ka偶dy jzyk.

{% code overflow="wrap" %}
```bash
export GITHUB_TOKEN=ghp_32849y23hij4...
codeql database create <database> --source-root /path/to/repo --db-cluster --language "javascript,python"

# Example
export GITHUB_TOKEN=ghp_32849y23hij4...
codeql database create /path/repo/codeql_db --source-root /path/to/repo --db-cluster --language "javascript,python"
## DBs will be created in /path/repo/codeql_db/*
```
{% endcode %}

* Mo偶esz r贸wnie偶 pozwoli `codeql` na **identyfikacj wszystkich jzyk贸w** za Ciebie i utworzenie bazy danych dla ka偶dego jzyka. Musisz poda **GITHUB\_TOKEN**. 

{% code overflow="wrap" %}
```bash
export GITHUB_TOKEN=ghp_32849y23hij4...
codeql database create <database> --db-cluster --source-root </path/to/repo>

# Example
export GITHUB_TOKEN=ghp_32849y23hij4...
codeql database create /tmp/codeql_db --db-cluster --source-root /path/repo
## DBs will be created in /path/repo/codeql_db/*
```
{% endcode %}

#### Szybki start - Analiza kodu

{% hint style="success" %}
Nadszed wreszcie czas na analiz kodu
{% endhint %}

Pamitaj, 偶e jeli u偶ye kilku jzyk贸w, **baza danych dla ka偶dego jzyka** zostaa utworzona w podanej cie偶ce.

{% code overflow="wrap" %}
```bash
# Default analysis
codeql database analyze <database> --format=<format> --output=</out/file/path>
# Example
codeql database analyze /tmp/codeql_db/javascript --format=sarif-latest --output=/tmp/graphql_results.sarif

# Specify QL pack to use in the analysis
codeql database analyze <database> \
<qls pack> --sarif-category=<language> \
--sarif-add-baseline-file-info \ --format=<format> \
--output=/out/file/path>
# Example
codeql database analyze /tmp/codeql_db \
javascript-security-extended --sarif-category=javascript \
--sarif-add-baseline-file-info --format=sarif-latest \
--output=/tmp/sec-extended.sarif
```
{% code overflow="wrap" %}

#### Szybki start - Skryptowany

{% endcode %}
```bash
export GITHUB_TOKEN=ghp_32849y23hij4...
export REPO_PATH=/path/to/repo
export OUTPUT_DIR_PATH="$REPO_PATH/codeql_results"
mkdir -p "$OUTPUT_DIR_PATH"
export FINAL_MSG="Results available in: "

echo "Creating DB"
codeql database create "$REPO_PATH/codeql_db" --db-cluster --source-root "$REPO_PATH"
for db in `ls "$REPO_PATH/codeql_db"`; do
echo "Analyzing $db"
codeql database analyze "$REPO_PATH/codeql_db/$db" --format=sarif-latest --output="${OUTPUT_DIR_PATH}/$db).sarif"
FINAL_MSG="$FINAL_MSG ${OUTPUT_DIR_PATH}/$db.sarif ,"
echo ""
done

echo $FINAL_MSG
```
{% endcode %}

Mo偶esz zwizualizowa wyniki na stronie [**https://microsoft.github.io/sarif-web-component/**](https://microsoft.github.io/sarif-web-component/) lub za pomoc rozszerzenia VSCode [**SARIF viewer**](https://marketplace.visualstudio.com/items?itemName=MS-SarifVSCode.sarif-viewer).

Mo偶esz r贸wnie偶 u偶y [**rozszerzenia VSCode**](https://marketplace.visualstudio.com/items?itemName=GitHub.vscode-codeql), aby uzyska wyniki wewntrz VSCode. Nadal bdziesz musia rcznie utworzy baz danych, ale potem mo偶esz wybra dowolne pliki i klikn `Prawy Klik` -> `CodeQL: Uruchom zapytania w wybranych plikach`

### [**Snyk**](https://snyk.io/product/snyk-code/)

Dostpna jest **darmowa wersja instalacyjna**.

#### Szybki start
```bash
# Install
sudo npm install -g snyk

# Authenticate (you can use a free account)
snyk auth

# Test for open source vulns & license issues
snyk test [--all-projects]

# Test for code vulnerabilities
## This will upload your code and you need to enable this option in: Settings > Snyk Code
snyk test code

# Test for vulns in images
snyk container test [image]

# Test for IaC vulns
snyk iac test
```
Mo偶esz r贸wnie偶 u偶y [**rozszerzenia Snyk dla VSCode**](https://marketplace.visualstudio.com/items?itemName=snyk-security.snyk-vulnerability-scanner), aby otrzyma wyniki wewntrz VSCode.

### [Insider](https://github.com/insidersec/insider)

Jest to **Open Source**, ale wyglda na **nieutrzymywane**.

#### Obsugiwane jzyki

Java (Maven i Android), Kotlin (Android), Swift (iOS), .NET Full Framework, C# i Javascript (Node.js).

#### Szybki start
```bash
# Check the correct release for your environment
$ wget https://github.com/insidersec/insider/releases/download/2.1.0/insider_2.1.0_linux_x86_64.tar.gz
$ tar -xf insider_2.1.0_linux_x86_64.tar.gz
$ chmod +x insider
$ ./insider --tech javascript  --target <projectfolder>
```
### [**DeepSource**](https://deepsource.com/pricing)&#x20;

Darmowe dla **repozytori贸w publicznych**.

## NodeJS

* **`yarn`**
```bash
# Install
brew install yarn
# Run
cd /path/to/repo
yarn audit
npm audit
```
* **`pnpm`**
```bash
# Install
npm install -g pnpm
# Run
cd /path/to/repo
pnpm audit
```
* [**nodejsscan**](https://github.com/ajinabraham/nodejsscan)**:** Statyczne narzdzie skanujce kod 藕r贸dowy (SAST) dla aplikacji Node.js, oparte na [libsast](https://github.com/ajinabraham/libsast) i [semgrep](https://github.com/returntocorp/semgrep).
```bash
# Install & run
docker run -it -p 9090:9090 opensecurity/nodejsscan:latest
# Got to localhost:9090
# Upload a zip file with the code
```
* [**RetireJS**](https://github.com/RetireJS/retire.js)**:** Celem Retire.js jest pom贸c w wykrywaniu u偶ycia wersji bibliotek JS znanymi podatnociami.
```bash
# Install
npm install -g retire
# Run
cd /path/to/repo
retire --colors
```
## Electron

* [**electronegativity**](https://github.com/doyensec/electronegativity)**:** Jest to narzdzie su偶ce do identyfikacji bdnych konfiguracji i antywzorc贸w bezpieczestwa w aplikacjach opartych na Electron.

## Python

* [**Bandit**](https://github.com/PyCQA/bandit)**:** Bandit to narzdzie zaprojektowane do wykrywania powszechnych problem贸w zwizanych z bezpieczestwem w kodzie Pythona. Aby to zrobi, Bandit przetwarza ka偶dy plik, buduje z niego AST i uruchamia odpowiednie wtyczki na wzach AST. Po zakoczeniu skanowania wszystkich plik贸w Bandit generuje raport.
```bash
# Install
pip3 install bandit

# Run
bandit -r <path to folder>
```
* [**safety**](https://github.com/pyupio/safety): Safety sprawdza zale偶noci Pythona pod ktem znanych podatnoci bezpieczestwa i sugeruje odpowiednie naprawy dla wykrytych podatnoci. Safety mo偶na uruchamia na maszynach programist贸w, w potokach CI/CD oraz na systemach produkcyjnych.
```bash
# Install
pip install safety
# Run
safety check
```
* [~~**Pyt**~~](https://github.com/python-security/pyt): Nieaktualizowane.

## .NET
```bash
# dnSpy
https://github.com/0xd4d/dnSpy

# .NET compilation
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe test.cs
```
## RUST

Rust is a systems programming language that focuses on safety, speed, and concurrency. It is designed to be memory safe and thread safe, making it a good choice for building reliable and efficient software. Rust's syntax is similar to C++, but it includes modern features such as pattern matching, type inference, and ownership semantics.

### Code Review Tools

When performing a code review in Rust, there are several tools that can help identify potential vulnerabilities and improve code quality. Here are some commonly used code review tools for Rust:

- **Clippy**: Clippy is a linter for Rust that provides helpful suggestions and warnings to improve code quality. It can catch common mistakes, enforce best practices, and identify potential bugs.

- **Rustfmt**: Rustfmt is a tool for formatting Rust code according to the official Rust style guidelines. It helps maintain consistent code formatting across projects and makes code easier to read and understand.

- **Cargo-audit**: Cargo-audit is a tool that checks Rust dependencies for known vulnerabilities. It scans the Cargo.lock file and compares it against a database of known vulnerabilities, providing a report of any insecure dependencies.

- **Rust-analyzer**: Rust-analyzer is an integrated development environment (IDE) extension that provides code analysis and navigation features for Rust. It offers features such as code completion, documentation lookup, and refactoring support.

- **Rustdoc**: Rustdoc is a tool for generating documentation from Rust source code. It can be used to automatically generate API documentation for libraries and projects, making it easier for developers to understand and use the code.

These tools can be integrated into the development workflow to ensure code quality and security in Rust projects. By using these tools, developers can catch potential issues early on and improve the overall reliability and maintainability of their code.
```bash
# Install
cargo install cargo-audit

# Run
cargo audit

#Update the Advisory Database
cargo audit fetch
```
## Java

Java jest popularnym jzykiem programowania, kt贸ry jest szeroko stosowany w tworzeniu aplikacji internetowych. Podczas przegldania kodu 藕r贸dowego aplikacji Java istnieje kilka narzdzi, kt贸re mog pom贸c w identyfikacji potencjalnych luk w zabezpieczeniach. Poni偶ej przedstawiamy kilka popularnych narzdzi do przegldu kodu Java:

### 1. FindBugs

FindBugs jest narzdziem statycznego analizatora kodu, kt贸re wykrywa potencjalne bdy i problemy z wydajnoci w kodzie Java. Mo偶e r贸wnie偶 pom贸c w identyfikacji podatnoci zwizanych z bezpieczestwem, takich jak nieprawidowe zarzdzanie pamici, niebezpieczne operacje na plikach i nieprawidowe u偶ycie kryptografii.

### 2. PMD

PMD to kolejne narzdzie statycznego analizatora kodu, kt贸re mo偶e pom贸c w identyfikacji potencjalnych problem贸w w kodzie Java. PMD sprawdza kod pod ktem zgodnoci z najlepszymi praktykami programistycznymi i wykrywa potencjalne bdy, takie jak nieprawidowe u偶ycie zmiennych, nieprawidowe formatowanie kodu i niebezpieczne operacje na plikach.

### 3. Checkstyle

Checkstyle jest narzdziem, kt贸re sprawdza kod Java pod ktem zgodnoci z okrelonymi reguami stylu kodowania. Mo偶e pom贸c w utrzymaniu sp贸jnoci i czytelnoci kodu, a tak偶e w identyfikacji potencjalnych problem贸w z bezpieczestwem, takich jak nieprawidowe u偶ycie kryptografii i niebezpieczne operacje na plikach.

### 4. SonarQube

SonarQube to platforma do kontroli jakoci kodu, kt贸ra mo偶e by u偶ywana do przegldu kodu Java. SonarQube analizuje kod pod ktem potencjalnych bd贸w, problem贸w z wydajnoci, zgodnoci z najlepszymi praktykami programistycznymi i zabezpieczeniami. Mo偶e r贸wnie偶 generowa raporty i metryki dotyczce jakoci kodu.

### 5. FindSecBugs

FindSecBugs jest narzdziem specjalnie zaprojektowanym do wykrywania podatnoci zwizanych z bezpieczestwem w kodzie Java. Wykorzystuje on statyczn analiz kodu, aby zidentyfikowa potencjalne luki w zabezpieczeniach, takie jak nieprawidowe uwierzytelnianie, nieprawidowe zarzdzanie sesj i niebezpieczne operacje na plikach.

Przy przegldzie kodu 藕r贸dowego aplikacji Java warto skorzysta z tych narzdzi, aby zidentyfikowa potencjalne problemy z bezpieczestwem i poprawi jako kodu.
```bash
# JD-Gui
https://github.com/java-decompiler/jd-gui

# Java compilation step-by-step
javac -source 1.8 -target 1.8 test.java
mkdir META-INF
echo "Main-Class: test" > META-INF/MANIFEST.MF
jar cmvf META-INF/MANIFEST.MF test.jar test.class
```
| Zadanie          | Komenda                                                   |
| --------------- | --------------------------------------------------------- |
| Wykonaj Jar     | java -jar \[jar]                                          |
| Rozpakuj Jar       | unzip -d \[katalog docelowy] \[jar]                       |
| Utw贸rz Jar      | jar -cmf META-INF/MANIFEST.MF \[jar docelowy] \*            |
| Base64 SHA256   | sha256sum \[plik] \| cut -d' ' -f1 \| xxd -r -p \| base64 |
| Usu podpis  | rm META-INF/_.SF META-INF/_.RSA META-INF/\*.DSA           |
| Usu z Jar | zip -d \[jar] \[plik do usunicia]                           |
| Dekompiluj klas | procyon -o . \[cie偶ka do klasy]                             |
| Dekompiluj Jar   | procyon -jar \[jar] -o \[katalog docelowy]                |
| Skompiluj klas   | javac \[cie偶ka do pliku .java]                               |

## Przejd藕 do
```bash
https://github.com/securego/gosec
```
## PHP

[Psalm](https://phpmagazine.net/2018/12/find-errors-in-your-php-applications-with-psalm.html) i [PHPStan](https://phpmagazine.net/2020/09/phpstan-pro-edition-launched.html).

### Wtyczki Wordpress

[https://www.pluginvulnerabilities.com/plugin-security-checker/](https://www.pluginvulnerabilities.com/plugin-security-checker/)

## Solidity

* [https://www.npmjs.com/package/solium](https://www.npmjs.com/package/solium)

## JavaScript

### Odkrywanie

1. Burp:
* Spider i odkryj zawarto
* Sitemap > filtr
* Sitemap > kliknij prawym przyciskiem na domen > Narzdzia zaanga偶owania > Znajd藕 skrypty
2. [WaybackURLs](https://github.com/tomnomnom/waybackurls):
* `waybackurls <domena> |grep -i "\.js" |sort -u`

### Statyczna analiza

#### Odminifikuj/Upiksz/Upiksz

* [https://prettier.io/playground/](https://prettier.io/playground/)
* [https://beautifier.io/](https://beautifier.io/)

#### Deobfuskacja/Odpakowanie

**Uwaga**: Mo偶e by niemo偶liwe pene odblokowanie.

1. Znajd藕 i u偶yj plik贸w .map:
* Jeli pliki .map s ujawnione, mo偶na je atwo odblokowa.
* Najczciej, foo.js.map mapuje na foo.js. Rcznie je wyszukaj.
* U偶yj [JS Miner](https://github.com/PortSwigger/js-miner), aby je znale藕.
* Upewnij si, 偶e przeprowadzono skanowanie aktywne.
* Przeczytaj '[Wskaz贸wki/Notatki](https://github.com/minamo7sen/burp-JS-Miner/wiki#tips--notes)'
* Jeli zostan znalezione, u偶yj [Maximize](https://www.npmjs.com/package/maximize), aby je odblokowa.
2. Bez plik贸w .map, spr贸buj JSnice:
* Odwoania: http://jsnice.org/ & https://www.npmjs.com/package/jsnice
* Wskaz贸wki:
* Jeli korzystasz z jsnice.org, kliknij przycisk opcji obok przycisku "Nicify JavaScript" i odznacz "Infer types", aby zmniejszy zanieczyszczenie kodu komentarzami.
* Upewnij si, 偶e nie zostawiasz pustych linii przed skryptem, poniewa偶 mo偶e to wpyn na proces odblokowywania i dawa nieprecyzyjne wyniki.
3. U偶yj console.log();
* Znajd藕 warto zwracan na kocu i zmie j na `console.log(<packerReturnVariable>);`, aby zamiast wykonywania, wydrukowa odblokowany js.
* Nastpnie wklej zmodyfikowany (i nadal zaszyfrowany) js do https://jsconsole.com/, aby zobaczy odblokowany js zapisany w konsoli.
* Na koniec, wklej odblokowany wynik do https://prettier.io/playground/, aby upikszy go do analizy.
* **Uwaga**: Jeli nadal widzisz spakowany (ale inny) js, mo偶e by rekurencyjnie spakowany. Powt贸rz proces.

Odwoania

* https://www.youtube.com/watch?v=\_v8r\_t4v6hQ
* https://blog.nvisium.com/angular-for-pentesters-part-1
* https://blog.nvisium.com/angular-for-pentesters-part-2

Narzdzia

* https://portswigger.net/burp/documentation/desktop/tools/dom-invader

#### Mniej u偶ywane odwoania

* https://cyberchef.org/
* https://olajs.com/javascript-prettifier
* https://jshint.com/
* https://github.com/jshint/jshint/

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
