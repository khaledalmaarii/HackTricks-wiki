# Flask

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨ä¸–ç•Œä¸Š**æœ€å…ˆè¿›çš„**ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

**å¦‚æœä½ åœ¨ç©CTFï¼ŒFlaskåº”ç”¨ç¨‹åºå¯èƒ½ä¸**[**SSTI**](../../pentesting-web/ssti-server-side-template-injection/)**ç›¸å…³ã€‚**

## Cookies

é»˜è®¤çš„cookieä¼šè¯åç§°æ˜¯**`session`**ã€‚

### è§£ç å™¨

åœ¨çº¿Flask cookieè§£ç å™¨ï¼š[https://www.kirsle.net/wizards/flask-session.cgi](https://www.kirsle.net/wizards/flask-session.cgi)

#### æ‰‹åŠ¨

è·å–cookieçš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªç‚¹ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64è§£ç >
```bash
echo "ImhlbGxvIg" | base64 -d
```
cookieä¹Ÿä½¿ç”¨å¯†ç è¿›è¡Œç­¾å

### **Flask-Unsign**

å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡çŒœæµ‹ç§˜é’¥æ¥è·å–ã€è§£ç ã€æš´åŠ›ç ´è§£å’Œæ„é€ Flaskåº”ç”¨ç¨‹åºçš„ä¼šè¯cookieã€‚

{% embed url="https://pypi.org/project/flask-unsign/" %}
```bash
pip3 install flask-unsign
```
#### **è§£ç  Cookie**

To decode a cookie, you can use various tools and techniques. One common method is to use a base64 decoder to decode the cookie value. Base64 encoding is commonly used to encode binary data into ASCII characters, and decoding it reverses the process.

Here is an example of how you can decode a cookie using Python and the Flask framework:

```python
import base64

from flask import Flask, request

app = Flask(__name__)

@app.route('/')
def index():
    cookie_value = request.cookies.get('cookie_name')
    decoded_value = base64.b64decode(cookie_value).decode('utf-8')
    return f'Decoded cookie value: {decoded_value}'

if __name__ == '__main__':
    app.run()
```

In this example, we import the `base64` module and the `Flask` class from the Flask framework. We define a route for the root URL ("/") and retrieve the value of the cookie named "cookie_name" using `request.cookies.get()`. We then decode the cookie value using `base64.b64decode()` and convert it to a UTF-8 string using `.decode('utf-8')`. Finally, we return the decoded cookie value as the response.

Keep in mind that decoding a cookie may not always reveal sensitive information. It depends on how the cookie is encoded and what data it contains. Always exercise caution and ensure you have proper authorization before attempting to decode or manipulate cookies.
```bash
flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'
```
#### **æš´åŠ›ç ´è§£**

Brute forceï¼ˆæš´åŠ›ç ´è§£ï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ç½‘ç»œæ”»å‡»æŠ€æœ¯ï¼Œç”¨äºå°è¯•æ‰€æœ‰å¯èƒ½çš„å¯†ç ç»„åˆæ¥è·å–æœªç»æˆæƒçš„è®¿é—®æƒé™ã€‚åœ¨Webåº”ç”¨ç¨‹åºä¸­ï¼Œæš´åŠ›ç ´è§£é€šå¸¸ç”¨äºå°è¯•ç ´è§£ç”¨æˆ·è´¦æˆ·çš„å¯†ç ã€‚

æš´åŠ›ç ´è§£æ”»å‡»å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œï¼ŒåŒ…æ‹¬ä½¿ç”¨å­—å…¸æ–‡ä»¶ã€ä½¿ç”¨å¸¸è§å¯†ç åˆ—è¡¨æˆ–ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„å¯†ç ç»„åˆã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ¥åŠ å¿«æš´åŠ›ç ´è§£çš„é€Ÿåº¦ï¼Œå¹¶å°è¯•å¤§é‡çš„å¯†ç ç»„åˆã€‚

ä¸ºäº†é˜²æ­¢æš´åŠ›ç ´è§£æ”»å‡»ï¼ŒWebåº”ç”¨ç¨‹åºå¯ä»¥é‡‡å–ä¸€äº›å®‰å…¨æªæ–½ï¼Œä¾‹å¦‚å®æ–½å¯†ç ç­–ç•¥ï¼ˆå¦‚å¼ºåˆ¶ä½¿ç”¨å¤æ‚å¯†ç ã€é™åˆ¶ç™»å½•å°è¯•æ¬¡æ•°ï¼‰ã€ä½¿ç”¨å¤šå› ç´ èº«ä»½éªŒè¯ã€å®æ–½å¸æˆ·é”å®šæœºåˆ¶ç­‰ã€‚

ä½œä¸ºæ¸—é€æµ‹è¯•äººå‘˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æš´åŠ›ç ´è§£æŠ€æœ¯æ¥æµ‹è¯•Webåº”ç”¨ç¨‹åºçš„å¯†ç å®‰å…¨æ€§ï¼Œå¹¶å‘å¼€å‘äººå‘˜æä¾›æ”¹è¿›å»ºè®®ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è´¦æˆ·çš„å®‰å…¨æ€§ã€‚
```bash
flask-unsign --wordlist /usr/share/wordlists/rockyou.txt --unsign --cookie '<cookie>' --no-literal-eval
```
#### **ç­¾å**

Signing is a process used to verify the authenticity and integrity of data. In the context of web applications, signing is often used to ensure that data sent between the client and the server has not been tampered with.

ç­¾åæ˜¯ä¸€ç§ç”¨äºéªŒè¯æ•°æ®çš„çœŸå®æ€§å’Œå®Œæ•´æ€§çš„è¿‡ç¨‹ã€‚åœ¨Webåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œç­¾åé€šå¸¸ç”¨äºç¡®ä¿åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å‘é€çš„æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

When a client sends a request to the server, the server can generate a signature for the request data using a secret key. This signature is then sent along with the request. Upon receiving the request, the server can verify the signature by recalculating it using the same secret key and comparing it to the received signature. If the calculated signature matches the received signature, it means that the data has not been tampered with.

å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç§˜å¯†å¯†é’¥ä¸ºè¯·æ±‚æ•°æ®ç”Ÿæˆä¸€ä¸ªç­¾åã€‚ç„¶åå°†æ­¤ç­¾åä¸è¯·æ±‚ä¸€èµ·å‘é€ã€‚åœ¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡ä½¿ç”¨ç›¸åŒçš„ç§˜å¯†å¯†é’¥é‡æ–°è®¡ç®—ç­¾åå¹¶å°†å…¶ä¸æ¥æ”¶åˆ°çš„ç­¾åè¿›è¡Œæ¯”è¾ƒæ¥éªŒè¯ç­¾åã€‚å¦‚æœè®¡ç®—å¾—åˆ°çš„ç­¾åä¸æ¥æ”¶åˆ°çš„ç­¾ååŒ¹é…ï¼Œåˆ™è¡¨ç¤ºæ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

Signing can be used to prevent tampering with data, as well as to verify the authenticity of the sender. It is commonly used in scenarios where data integrity and security are crucial, such as authentication tokens, API requests, and session cookies.

ç­¾åå¯ç”¨äºé˜²æ­¢æ•°æ®ç¯¡æ”¹ï¼Œä»¥åŠéªŒè¯å‘é€æ–¹çš„çœŸå®æ€§ã€‚å®ƒé€šå¸¸ç”¨äºæ•°æ®å®Œæ•´æ€§å’Œå®‰å…¨æ€§è‡³å…³é‡è¦çš„åœºæ™¯ï¼Œä¾‹å¦‚èº«ä»½éªŒè¯ä»¤ç‰Œã€APIè¯·æ±‚å’Œä¼šè¯Cookieã€‚

To implement signing in a web application, a cryptographic algorithm such as HMAC (Hash-based Message Authentication Code) can be used. HMAC uses a secret key and a hash function to generate the signature. The same secret key and hash function must be used for both signing and verifying the signature.

è¦åœ¨Webåº”ç”¨ç¨‹åºä¸­å®ç°ç­¾åï¼Œå¯ä»¥ä½¿ç”¨HMACï¼ˆåŸºäºå“ˆå¸Œçš„æ¶ˆæ¯è®¤è¯ç ï¼‰ç­‰åŠ å¯†ç®—æ³•ã€‚HMACä½¿ç”¨ä¸€ä¸ªç§˜å¯†å¯†é’¥å’Œä¸€ä¸ªå“ˆå¸Œå‡½æ•°æ¥ç”Ÿæˆç­¾åã€‚ç­¾åå’ŒéªŒè¯ç­¾åå¿…é¡»ä½¿ç”¨ç›¸åŒçš„ç§˜å¯†å¯†é’¥å’Œå“ˆå¸Œå‡½æ•°ã€‚

It is important to keep the secret key used for signing secure and confidential. If an attacker gains access to the secret key, they can generate valid signatures and tamper with the data.

ä¿æŒç”¨äºç­¾åçš„ç§˜å¯†å¯†é’¥å®‰å…¨å’Œä¿å¯†éå¸¸é‡è¦ã€‚å¦‚æœæ”»å‡»è€…è·å¾—ç§˜å¯†å¯†é’¥ï¼Œä»–ä»¬å¯ä»¥ç”Ÿæˆæœ‰æ•ˆçš„ç­¾åå¹¶ç¯¡æ”¹æ•°æ®ã€‚
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME'
```
#### ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼è¿›è¡Œç­¾åï¼ˆæ—§ç‰ˆæœ¬ï¼‰

In older versions of Flask, the `signing` module was used to sign cookies and other data. This module provided a way to ensure the integrity and authenticity of the data being transmitted.

åœ¨æ—§ç‰ˆæœ¬çš„Flaskä¸­ï¼Œä½¿ç”¨`signing`æ¨¡å—å¯¹cookieå’Œå…¶ä»–æ•°æ®è¿›è¡Œç­¾åã€‚è¯¥æ¨¡å—æä¾›äº†ä¸€ç§ç¡®ä¿ä¼ è¾“æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§çš„æ–¹å¼ã€‚

To sign data using the legacy method, you can import the `signing` module and use the `sign` function. This function takes the data to be signed and a secret key as parameters.

è¦ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•å¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œå¯ä»¥å¯¼å…¥`signing`æ¨¡å—å¹¶ä½¿ç”¨`sign`å‡½æ•°ã€‚è¯¥å‡½æ•°æ¥å—è¦ç­¾åçš„æ•°æ®å’Œä¸€ä¸ªå¯†é’¥ä½œä¸ºå‚æ•°ã€‚

```python
from flask import signing

data = "Hello, world!"
secret_key = "my_secret_key"

signed_data = signing.sign(data, secret_key)
```

The `sign` function returns a signed string that can be transmitted along with the data. To verify the signature, you can use the `unsign` function.

`sign`å‡½æ•°è¿”å›ä¸€ä¸ªå·²ç­¾åçš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä¸æ•°æ®ä¸€èµ·ä¼ è¾“ã€‚è¦éªŒè¯ç­¾åï¼Œå¯ä»¥ä½¿ç”¨`unsign`å‡½æ•°ã€‚

```python
verified_data = signing.unsign(signed_data, secret_key)
```

The `unsign` function will raise a `BadSignature` exception if the signature is invalid or if the data has been tampered with.

å¦‚æœç­¾åæ— æ•ˆæˆ–æ•°æ®è¢«ç¯¡æ”¹ï¼Œ`unsign`å‡½æ•°å°†å¼•å‘`BadSignature`å¼‚å¸¸ã€‚

It is important to note that the legacy signing method is not as secure as the current method provided by Flask. It is recommended to upgrade to the latest version of Flask and use the new signing method for improved security.

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼ ç»Ÿçš„ç­¾åæ–¹æ³•ä¸å¦‚Flaskæä¾›çš„å½“å‰æ–¹æ³•å®‰å…¨ã€‚å»ºè®®å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬çš„Flaskï¼Œå¹¶ä½¿ç”¨æ–°çš„ç­¾åæ–¹æ³•ä»¥æé«˜å®‰å…¨æ€§ã€‚
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME' --legacy
```
### **RIPsession**

å‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ç”¨ä½¿ç”¨flask-unsignç”Ÿæˆçš„cookieå¯¹ç½‘ç«™è¿›è¡Œæš´åŠ›ç ´è§£ã€‚

{% embed url="https://github.com/Tagvi/ripsession" %}
```bash
ripsession -u 10.10.11.100 -c "{'logged_in': True, 'username': 'changeMe'}" -s password123 -f "user doesn't exist" -w wordlist.txt
```
### åœ¨Flaskä¼šè¯cookieä¸­ä½¿ç”¨SQLmapè¿›è¡ŒSQLiæ”»å‡»

[**è¿™ä¸ªä¾‹å­**](../../pentesting-web/sql-injection/sqlmap/#eval) ä½¿ç”¨sqlmapçš„`eval`é€‰é¡¹æ¥ä½¿ç”¨å·²çŸ¥çš„å¯†é’¥è‡ªåŠ¨ç­¾åflaskçš„sqlmapè´Ÿè½½ã€‚

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)è½»æ¾æ„å»ºå’Œè‡ªåŠ¨åŒ–ç”±å…¨çƒæœ€å…ˆè¿›çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒçš„å·¥ä½œæµç¨‹ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
