# GraphQL

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Introduction

GraphQL, **REST API'ye** **verimli bir alternatif** olarak **vurgulanmaktadÄ±r**, arka uÃ§tan veri sorgulamak iÃ§in basitleÅŸtirilmiÅŸ bir yaklaÅŸÄ±m sunar. REST'in, verileri toplamak iÃ§in genellikle Ã§eÅŸitli uÃ§ noktalar arasÄ±nda Ã§ok sayÄ±da isteÄŸi gerektirmesiyle karÅŸÄ±laÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, GraphQL, gerekli tÃ¼m bilgilerin **tek bir istek** ile alÄ±nmasÄ±nÄ± saÄŸlar. Bu basitleÅŸtirme, veri alma sÃ¼reÃ§lerinin karmaÅŸÄ±klÄ±ÄŸÄ±nÄ± azaltarak **geliÅŸtiricilere** Ã¶nemli Ã¶lÃ§Ã¼de **fayda saÄŸlar**.

## GraphQL ve GÃ¼venlik

Yeni teknolojilerin, GraphQL dahil, ortaya Ã§Ä±kmasÄ±yla birlikte yeni gÃ¼venlik aÃ§Ä±klarÄ± da ortaya Ã§Ä±kmaktadÄ±r. Dikkate alÄ±nmasÄ± gereken Ã¶nemli bir nokta, **GraphQL'in varsayÄ±lan olarak kimlik doÄŸrulama mekanizmalarÄ± iÃ§ermemesidir**. Bu tÃ¼r gÃ¼venlik Ã¶nlemlerini uygulamak geliÅŸtiricilerin sorumluluÄŸundadÄ±r. Uygun kimlik doÄŸrulama olmadan, GraphQL uÃ§ noktalarÄ±, kimliÄŸi doÄŸrulanmamÄ±ÅŸ kullanÄ±cÄ±lara hassas bilgileri aÃ§Ä±ÄŸa Ã§Ä±karabilir ve bu da Ã¶nemli bir gÃ¼venlik riski oluÅŸturur.

### Dizin Kaba Kuvvet SaldÄ±rÄ±larÄ± ve GraphQL

AÃ§Ä±k GraphQL Ã¶rneklerini tanÄ±mlamak iÃ§in, dizin kaba kuvvet saldÄ±rÄ±larÄ±na belirli yollarÄ±n eklenmesi Ã¶nerilmektedir. Bu yollar ÅŸunlardÄ±r:

* `/graphql`
* `/graphiql`
* `/graphql.php`
* `/graphql/console`
* `/api`
* `/api/graphql`
* `/graphql/api`
* `/graphql/graphql`

AÃ§Ä±k GraphQL Ã¶rneklerini tanÄ±mlamak, desteklenen sorgularÄ±n incelenmesine olanak tanÄ±r. Bu, uÃ§ nokta aracÄ±lÄ±ÄŸÄ±yla eriÅŸilebilen verileri anlamak iÃ§in kritik Ã¶neme sahiptir. GraphQL'in introspection sistemi, bir ÅŸemanÄ±n desteklediÄŸi sorgularÄ± detaylandÄ±rarak bu sÃ¼reci kolaylaÅŸtÄ±rÄ±r. Bununla ilgili daha fazla bilgi iÃ§in, GraphQL'in introspection belgesine bakÄ±n: [**GraphQL: API'ler iÃ§in bir sorgu dili.**](https://graphql.org/learn/introspection/)

### Parmak Ä°zi

[**graphw00f**](https://github.com/dolevf/graphw00f) aracÄ±, bir sunucuda hangi GraphQL motorunun kullanÄ±ldÄ±ÄŸÄ±nÄ± tespit edebilir ve ardÄ±ndan gÃ¼venlik denetÃ§isi iÃ§in bazÄ± yararlÄ± bilgileri yazdÄ±rÄ±r.

#### Evrensel sorgular <a href="#universal-queries" id="universal-queries"></a>

Bir URL'nin bir GraphQL hizmeti olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in, bir **evrensel sorgu**, `query{__typename}`, gÃ¶nderilebilir. EÄŸer yanÄ±t `{"data": {"__typename": "Query"}}` iÃ§eriyorsa, bu URL'nin bir GraphQL uÃ§ noktasÄ± barÄ±ndÄ±rdÄ±ÄŸÄ±nÄ± doÄŸrular. Bu yÃ¶ntem, sorgulanan nesnenin tÃ¼rÃ¼nÃ¼ ortaya koyan GraphQL'in `__typename` alanÄ±na dayanÄ±r.
```javascript
query{__typename}
```
### Temel SayÄ±m

Graphql genellikle **GET**, **POST** (x-www-form-urlencoded) ve **POST**(json) destekler. Ancak gÃ¼venlik aÃ§Ä±sÄ±ndan CSRF saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in yalnÄ±zca json'a izin verilmesi Ã¶nerilir.

#### Ä°Ã§gÃ¶rÃ¼

Åema bilgilerini keÅŸfetmek iÃ§in iÃ§gÃ¶rÃ¼ kullanmak iÃ§in `__schema` alanÄ±nÄ± sorgulayÄ±n. Bu alan, tÃ¼m sorgularÄ±n kÃ¶k tÃ¼rÃ¼nde mevcuttur.
```bash
query={__schema{types{name,fields{name}}}}
```
Bu sorgu ile kullanÄ±lan tÃ¼m tÃ¼rlerin adÄ±nÄ± bulacaksÄ±nÄ±z:

![](<../../.gitbook/assets/image (1036).png>)

{% code overflow="wrap" %}
```bash
query={__schema{types{name,fields{name,args{name,description,type{name,kind,ofType{name, kind}}}}}}}
```
{% endcode %}

Bu sorgu ile tÃ¼m tÃ¼rleri, alanlarÄ±nÄ± ve argÃ¼manlarÄ±nÄ± (ve argÃ¼manlarÄ±n tÃ¼rÃ¼nÃ¼) Ã§Ä±karabilirsiniz. Bu, veritabanÄ±nÄ± nasÄ±l sorgulayacaÄŸÄ±nÄ±zÄ± bilmek iÃ§in Ã§ok faydalÄ± olacaktÄ±r.

![](<../../.gitbook/assets/image (950).png>)

**Hatalar**

**HatalarÄ±n** nasÄ±l **gÃ¶sterileceÄŸini** bilmek ilginÃ§tir Ã§Ã¼nkÃ¼ bu, faydalÄ± **bilgilerle** katkÄ±da bulunacaktÄ±r.
```
?query={__schema}
?query={}
?query={thisdefinitelydoesnotexist}
```
![](<../../.gitbook/assets/image (416).png>)

**VeritabanÄ± ÅemasÄ±nÄ± Ä°ntrospeksiyon ile Listeleme**

{% hint style="info" %}
EÄŸer introspeksiyon etkinse ancak yukarÄ±daki sorgu Ã§alÄ±ÅŸmÄ±yorsa, sorgu yapÄ±sÄ±ndan `onOperation`, `onFragment` ve `onField` direktiflerini kaldÄ±rmayÄ± deneyin.
{% endhint %}
```bash
#Full introspection query

query IntrospectionQuery {
__schema {
queryType {
name
}
mutationType {
name
}
subscriptionType {
name
}
types {
...FullType
}
directives {
name
description
args {
...InputValue
}
onOperation  #Often needs to be deleted to run query
onFragment   #Often needs to be deleted to run query
onField      #Often needs to be deleted to run query
}
}
}

fragment FullType on __Type {
kind
name
description
fields(includeDeprecated: true) {
name
description
args {
...InputValue
}
type {
...TypeRef
}
isDeprecated
deprecationReason
}
inputFields {
...InputValue
}
interfaces {
...TypeRef
}
enumValues(includeDeprecated: true) {
name
description
isDeprecated
deprecationReason
}
possibleTypes {
...TypeRef
}
}

fragment InputValue on __InputValue {
name
description
type {
...TypeRef
}
defaultValue
}

fragment TypeRef on __Type {
kind
name
ofType {
kind
name
ofType {
kind
name
ofType {
kind
name
}
}
}
}
```
SatÄ±r iÃ§i iÃ§gÃ¶rÃ¼ sorgusu:
```
/?query=fragment%20FullType%20on%20Type%20{+%20%20kind+%20%20name+%20%20description+%20%20fields%20{+%20%20%20%20name+%20%20%20%20description+%20%20%20%20args%20{+%20%20%20%20%20%20...InputValue+%20%20%20%20}+%20%20%20%20type%20{+%20%20%20%20%20%20...TypeRef+%20%20%20%20}+%20%20}+%20%20inputFields%20{+%20%20%20%20...InputValue+%20%20}+%20%20interfaces%20{+%20%20%20%20...TypeRef+%20%20}+%20%20enumValues%20{+%20%20%20%20name+%20%20%20%20description+%20%20}+%20%20possibleTypes%20{+%20%20%20%20...TypeRef+%20%20}+}++fragment%20InputValue%20on%20InputValue%20{+%20%20name+%20%20description+%20%20type%20{+%20%20%20%20...TypeRef+%20%20}+%20%20defaultValue+}++fragment%20TypeRef%20on%20Type%20{+%20%20kind+%20%20name+%20%20ofType%20{+%20%20%20%20kind+%20%20%20%20name+%20%20%20%20ofType%20{+%20%20%20%20%20%20kind+%20%20%20%20%20%20name+%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}++query%20IntrospectionQuery%20{+%20%20schema%20{+%20%20%20%20queryType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20mutationType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20types%20{+%20%20%20%20%20%20...FullType+%20%20%20%20}+%20%20%20%20directives%20{+%20%20%20%20%20%20name+%20%20%20%20%20%20description+%20%20%20%20%20%20locations+%20%20%20%20%20%20args%20{+%20%20%20%20%20%20%20%20...InputValue+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}
```
Son kod satÄ±rÄ±, graphql'den tÃ¼m meta-bilgileri (nesne adlarÄ±, parametreler, tÃ¼rler...) dÃ¶kecek bir graphql sorgusudur.

![](<../../.gitbook/assets/image (363).png>)

EÄŸer introspection etkinse, tÃ¼m seÃ§enekleri bir GUI'de gÃ¶rÃ¼ntÃ¼lemek iÃ§in [**GraphQL Voyager**](https://github.com/APIs-guru/graphql-voyager) kullanabilirsiniz.

### Sorgulama

ArtÄ±k veritabanÄ±nda hangi tÃ¼r bilgilerin saklandÄ±ÄŸÄ±nÄ± bildiÄŸimize gÃ¶re, bazÄ± **deÄŸerleri Ã§Ä±karmaya** Ã§alÄ±ÅŸalÄ±m.

Ä°ntrospection'da **hangi nesneyi doÄŸrudan sorgulayabileceÄŸinizi** bulabilirsiniz (Ã§Ã¼nkÃ¼ bir nesneyi sadece var olduÄŸu iÃ§in sorgulayamazsÄ±nÄ±z). AÅŸaÄŸÄ±daki gÃ¶rÃ¼ntÃ¼de "_queryType_"'Ä±n "_Query_" olarak adlandÄ±rÄ±ldÄ±ÄŸÄ±nÄ± ve "_Query_" nesnesinin alanlarÄ±ndan birinin "_flags_" olduÄŸunu gÃ¶rebilirsiniz; bu da bir nesne tÃ¼rÃ¼dÃ¼r. Bu nedenle, bayrak nesnesini sorgulayabilirsiniz.

![](<../../.gitbook/assets/Screenshot from 2021-03-13 18-17-48.png>)

"_flags_" sorgusunun tÃ¼rÃ¼nÃ¼n "_Flags_" olduÄŸunu ve bu nesnenin aÅŸaÄŸÄ±daki gibi tanÄ±mlandÄ±ÄŸÄ±nÄ± unutmayÄ±n:

![](<../../.gitbook/assets/Screenshot from 2021-03-13 18-22-57 (1).png>)

"_Flags_" nesnelerinin **isim** ve **deÄŸer** ile oluÅŸturulduÄŸunu gÃ¶rebilirsiniz. ArdÄ±ndan, bayraklarÄ±n tÃ¼m isimlerini ve deÄŸerlerini ÅŸu sorgu ile alabilirsiniz:
```javascript
query={flags{name, value}}
```
Not edin ki **sorgulanacak nesne** bir **ilkel** **tip** ise, Ã¶rneÄŸin **string** gibi, aÅŸaÄŸÄ±daki Ã¶rnekteki gibi

![](<../../.gitbook/assets/image (958).png>)

Bunu sadece ÅŸu ÅŸekilde sorgulayabilirsiniz:
```javascript
query={hiddenFlags}
```
BaÅŸka bir Ã¶rnekte "_Query_" tÃ¼rÃ¼ nesnesinin iÃ§inde "_user_" ve "_users_" adÄ±nda 2 nesne vardÄ±.\
EÄŸer bu nesnelerin arama yapmak iÃ§in herhangi bir argÃ¼mana ihtiyacÄ± yoksa, istediÄŸiniz veriyi **sadece** isteyerek **tÃ¼m bilgileri alabilirsiniz**. Ä°nternetten bu Ã¶rnekte, kaydedilmiÅŸ kullanÄ±cÄ± adlarÄ±nÄ± ve ÅŸifreleri Ã§Ä±karabilirsiniz:

![](<../../.gitbook/assets/image (880).png>)

Ancak, bu Ã¶rnekte bunu yapmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±zda bu **hata** ile karÅŸÄ±laÅŸÄ±rsÄ±nÄ±z:

![](<../../.gitbook/assets/image (1042).png>)

GÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re bir ÅŸekilde "_**uid**_" argÃ¼manÄ±nÄ± _**Int**_ tÃ¼rÃ¼ ile kullanarak arama yapacak.\
Neyse ki, [Temel SayÄ±m](graphql.md#basic-enumeration) bÃ¶lÃ¼mÃ¼nde, bize gerekli tÃ¼m bilgileri gÃ¶steren bir sorgu Ã¶nerildi: `query={__schema{types{name,fields{name, args{name,description,type{name, kind, ofType{name, kind}}}}}}}`

O sorguyu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mda saÄŸlanan resme bakarsanÄ±z, "_**user**_" nesnesinin _Int_ tÃ¼rÃ¼nde bir **arg** "_**uid**_" olduÄŸunu gÃ¶receksiniz.

Bu nedenle, hafif bir _**uid**_ brute force gerÃ§ekleÅŸtirerek, _**uid**=**1**_ olduÄŸunda bir kullanÄ±cÄ± adÄ± ve ÅŸifre elde ettim:\
`query={user(uid:1){user,password}}`

![](<../../.gitbook/assets/image (90).png>)

**parametreler** "_**user**_" ve "_**password**_" iÃ§in istekte bulunabileceÄŸimi **keÅŸfettim** Ã§Ã¼nkÃ¼ var olmayan bir ÅŸeyi aramaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±mda (`query={user(uid:1){noExists}}`) bu hatayÄ± alÄ±yorum:

![](<../../.gitbook/assets/image (707).png>)

Ve **sayÄ±m aÅŸamasÄ±nda**, "_**dbuser**_" nesnesinin "_**user**_" ve "_**password**_" alanlarÄ±na sahip olduÄŸunu keÅŸfettim.

**Sorgu dizesi dÃ¶kme hilesi (teÅŸekkÃ¼rler @BinaryShadow\_)**

Bir dize tÃ¼rÃ¼ ile arama yapabiliyorsanÄ±z, Ã¶rneÄŸin: `query={theusers(description: ""){username,password}}` ve **boÅŸ bir dize** ararsanÄ±z, **tÃ¼m verileri dÃ¶kecektir**. (_Bu Ã¶rneÄŸin, eÄŸitimlerin Ã¶rneÄŸi ile ilgili olmadÄ±ÄŸÄ±nÄ± unutmayÄ±n, bu Ã¶rnekte "**theusers**" ile "**description**" adÄ±nda bir Dize alanÄ± kullanarak arama yapabileceÄŸinizi varsayÄ±n_).

### Arama

Bu yapÄ±landÄ±rmada, bir **veritabanÄ±** **kiÅŸileri** ve **filmleri** iÃ§ermektedir. **KiÅŸiler**, **e-posta** ve **isim** ile tanÄ±mlanÄ±r; **filmler** ise **isim** ve **puan** ile tanÄ±mlanÄ±r. **KiÅŸiler** birbirleriyle arkadaÅŸ olabilir ve ayrÄ±ca filmlere sahip olabilir, bu da veritabanÄ±ndaki iliÅŸkileri gÃ¶sterir.

**Ä°sim** ile kiÅŸileri **arama** yapabilir ve e-posta adreslerini alabilirsiniz:
```javascript
{
searchPerson(name: "John Doe") {
email
}
}
```
KiÅŸileri **isim** ile **arama** yapabilir ve onlarÄ±n **abone olduklarÄ±** **filmleri** alabilirsiniz:
```javascript
{
searchPerson(name: "John Doe") {
email
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
Not edin ki, kiÅŸinin `subscribedMovies`'nin `name`'ini almak iÃ§in nasÄ±l gÃ¶sterildiÄŸi.

AynÄ± anda **birden fazla nesne arayabilirsiniz**. Bu durumda, 2 film aramasÄ± yapÄ±lmaktadÄ±r:
```javascript
{
searchPerson(subscribedMovies: [{name: "Inception"}, {name: "Rocky"}]) {
name
}
}r
```
Veya **takma adlar kullanarak birkaÃ§ farklÄ± nesnenin iliÅŸkileri**:
```javascript
{
johnsMovieList: searchPerson(name: "John Doe") {
subscribedMovies {
edges {
node {
name
}
}
}
}
davidsMovieList: searchPerson(name: "David Smith") {
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
### Mutations

**Mutasyonlar, sunucu tarafÄ±nda deÄŸiÅŸiklik yapmak iÃ§in kullanÄ±lÄ±r.**

**Ä°nceleme** bÃ¶lÃ¼mÃ¼nde **belirtilen** **mutasyonlarÄ±** bulabilirsiniz. AÅŸaÄŸÄ±daki gÃ¶rselde "_MutationType_" "_Mutation_" olarak adlandÄ±rÄ±lÄ±r ve "_Mutation_" nesnesi mutasyonlarÄ±n isimlerini (bu durumda "_addPerson_" gibi) iÃ§erir:

![](<../../.gitbook/assets/Screenshot from 2021-03-13 18-26-27 (1).png>)

Bu yapÄ±landÄ±rmada, bir **veritabanÄ±** **kiÅŸileri** ve **filmleri** iÃ§erir. **KiÅŸiler**, **e-posta** ve **isim** ile tanÄ±mlanÄ±r; **filmler** ise **isim** ve **puan** ile tanÄ±mlanÄ±r. **KiÅŸiler** birbirleriyle arkadaÅŸ olabilir ve ayrÄ±ca filmlere sahip olabilir, bu da veritabanÄ±ndaki iliÅŸkileri gÃ¶sterir.

VeritabanÄ±nda **yeni** filmler oluÅŸturmak iÃ§in bir mutasyon aÅŸaÄŸÄ±daki gibi olabilir (bu Ã¶rnekte mutasyon `addMovie` olarak adlandÄ±rÄ±lmÄ±ÅŸtÄ±r):
```javascript
mutation {
addMovie(name: "Jumanji: The Next Level", rating: "6.8/10", releaseYear: 2019) {
movies {
name
rating
}
}
}
```
**Sorguda hem deÄŸerlerin hem de veri tÃ¼rÃ¼nÃ¼n nasÄ±l belirtildiÄŸine dikkat edin.**

AyrÄ±ca, veritabanÄ±, mevcut **arkadaÅŸlar** ve **filmler** ile birlikte **kiÅŸilerin** oluÅŸturulmasÄ±na olanak tanÄ±yan `addPerson` adlÄ± bir **mutation** iÅŸlemini desteklemektedir. Yeni oluÅŸturulan kiÅŸiyi mevcut arkadaÅŸlar ve filmlerle iliÅŸkilendirmeden Ã¶nce, arkadaÅŸlarÄ±n ve filmlerin veritabanÄ±nda Ã¶nceden var olmasÄ± gerektiÄŸini belirtmek Ã¶nemlidir.
```javascript
mutation {
addPerson(name: "James Yoe", email: "jy@example.com", friends: [{name: "John Doe"}, {email: "jd@example.com"}], subscribedMovies: [{name: "Rocky"}, {name: "Interstellar"}, {name: "Harry Potter and the Sorcerer's Stone"}]) {
person {
name
email
friends {
edges {
node {
name
email
}
}
}
subscribedMovies {
edges {
node {
name
rating
releaseYear
}
}
}
}
}
}
```
### YÃ¶nerge AÅŸÄ±rÄ± YÃ¼kleme

Bu raporda aÃ§Ä±klanan [**zafiyetlerden birinde**](https://www.landh.tech/blog/20240304-google-hack-50000/) belirtildiÄŸi gibi, bir yÃ¶nerge aÅŸÄ±rÄ± yÃ¼klemesi, sunucunun DoS olana kadar iÅŸlemleri boÅŸa harcamasÄ± iÃ§in bir yÃ¶nergenin milyonlarca kez Ã§aÄŸrÄ±lmasÄ±nÄ± ifade eder.

### 1 API isteÄŸinde toplu brute-force

Bu bilgi [https://lab.wallarm.com/graphql-batching-attack/](https://lab.wallarm.com/graphql-batching-attack/) adresinden alÄ±nmÄ±ÅŸtÄ±r.\
GraphQL API Ã¼zerinden **farklÄ± kimlik bilgileri ile aynÄ± anda birÃ§ok sorgu gÃ¶ndererek** kimlik doÄŸrulama yapÄ±lÄ±r. Bu klasik bir brute force saldÄ±rÄ±sÄ±dÄ±r, ancak GraphQL toplama Ã¶zelliÄŸi sayesinde bir HTTP isteÄŸi baÅŸÄ±na birden fazla oturum aÃ§ma/ÅŸifre Ã§ifti gÃ¶ndermek mÃ¼mkÃ¼ndÃ¼r. Bu yaklaÅŸÄ±m, dÄ±ÅŸ hÄ±z izleme uygulamalarÄ±nÄ± her ÅŸeyin yolunda olduÄŸu ve ÅŸifreleri tahmin etmeye Ã§alÄ±ÅŸan bir brute-forcing botunun olmadÄ±ÄŸÄ± konusunda kandÄ±rÄ±r.

AÅŸaÄŸÄ±da, **aynÄ± anda 3 farklÄ± e-posta/ÅŸifre Ã§ifti** ile bir uygulama kimlik doÄŸrulama isteÄŸinin en basit gÃ¶sterimini bulabilirsiniz. AynÄ± ÅŸekilde tek bir istekte binlerce gÃ¶ndermek mÃ¼mkÃ¼ndÃ¼r:

![](<../../.gitbook/assets/image (1081).png>)

YanÄ±t ekran gÃ¶rÃ¼ntÃ¼sÃ¼nden gÃ¶rebileceÄŸimiz gibi, birinci ve Ã¼Ã§Ã¼ncÃ¼ istekler _null_ dÃ¶ndÃ¼rdÃ¼ ve _hata_ bÃ¶lÃ¼mÃ¼nde ilgili bilgileri yansÄ±ttÄ±. **Ä°kinci mutasyon doÄŸru kimlik doÄŸrulama** verilerine sahipti ve yanÄ±t doÄŸru kimlik doÄŸrulama oturum belirteci iÃ§eriyordu.

![](<../../.gitbook/assets/image (119) (1).png>)

## GraphQL Ä°Ã§in Ä°Ã§gÃ¶rÃ¼ Olmadan

Giderek daha fazla **graphql uÃ§ noktasÄ± iÃ§gÃ¶rÃ¼yÃ¼ devre dÄ±ÅŸÄ± bÄ±rakÄ±yor**. Ancak, beklenmedik bir istek alÄ±ndÄ±ÄŸÄ±nda graphql'nin attÄ±ÄŸÄ± hatalar, [**clairvoyance**](https://github.com/nikitastupin/clairvoyance) gibi araÃ§larÄ±n ÅŸemanÄ±n Ã§oÄŸunu yeniden oluÅŸturmasÄ± iÃ§in yeterlidir.

AyrÄ±ca, Burp Suite uzantÄ±sÄ± [**GraphQuail**](https://github.com/forcesunseen/graphquail) **Burp Ã¼zerinden geÃ§en GraphQL API isteklerini gÃ¶zlemler** ve her yeni sorgu gÃ¶rdÃ¼ÄŸÃ¼nde bir iÃ§ GraphQL **ÅŸemasÄ±** oluÅŸturur. AyrÄ±ca, GraphiQL ve Voyager iÃ§in ÅŸemayÄ± aÃ§Ä±ÄŸa Ã§Ä±karabilir. UzantÄ±, bir iÃ§gÃ¶rÃ¼ sorgusu aldÄ±ÄŸÄ±nda sahte bir yanÄ±t dÃ¶ndÃ¼rÃ¼r. SonuÃ§ olarak, GraphQuail API iÃ§inde kullanÄ±labilir tÃ¼m sorgularÄ±, argÃ¼manlarÄ± ve alanlarÄ± gÃ¶sterir. Daha fazla bilgi iÃ§in [**bunu kontrol edin**](https://blog.forcesunseen.com/graphql-security-testing-without-a-schema).

[**GraphQL varlÄ±klarÄ±nÄ± keÅŸfetmek iÃ§in gÃ¼zel bir kelime listesi burada bulunabilir**](https://github.com/Escape-Technologies/graphql-wordlist?).

### GraphQL iÃ§gÃ¶rÃ¼ savunmalarÄ±nÄ± aÅŸma <a href="#bypassing-graphql-introspection-defences" id="bypassing-graphql-introspection-defences"></a>

API'lerde iÃ§gÃ¶rÃ¼ sorgularÄ± Ã¼zerindeki kÄ±sÄ±tlamalarÄ± aÅŸmak iÃ§in, `__schema` anahtar kelimesinden sonra **Ã¶zel bir karakter eklemek** etkili olduÄŸu kanÄ±tlanmÄ±ÅŸtÄ±r. Bu yÃ¶ntem, iÃ§gÃ¶rÃ¼yÃ¼ engellemeyi amaÃ§layan regex desenlerindeki yaygÄ±n geliÅŸtirici gÃ¶zden kaÃ§Ä±rmalarÄ±nÄ± istismar eder. GraphQL'in gÃ¶rmezden geldiÄŸi ancak regex'te hesaba katÄ±lmayabilecek **boÅŸluklar, yeni satÄ±rlar ve virgÃ¼ller** gibi karakterler ekleyerek kÄ±sÄ±tlamalar aÅŸÄ±labilir. Ã–rneÄŸin, `__schema` sonrasÄ±nda bir yeni satÄ±r iÃ§eren bir iÃ§gÃ¶rÃ¼ sorgusu bu tÃ¼r savunmalarÄ± aÅŸabilir:
```bash
# Example with newline to bypass
{
"query": "query{__schema
{queryType{name}}}"
}
```
EÄŸer baÅŸarÄ±sÄ±z olursanÄ±z, **GET istekleri** veya **`x-www-form-urlencoded` ile POST** gibi alternatif istek yÃ¶ntemlerini dÃ¼ÅŸÃ¼nÃ¼n, Ã§Ã¼nkÃ¼ kÄ±sÄ±tlamalar yalnÄ±zca POST isteklerine uygulanabilir.

### WebSocket'leri Deneyin

[**bu konuÅŸmada**](https://www.youtube.com/watch?v=tIo\_t5uUK50) belirtildiÄŸi gibi, graphQL'e WebSocket'ler aracÄ±lÄ±ÄŸÄ±yla baÄŸlanmanÄ±n mÃ¼mkÃ¼n olup olmadÄ±ÄŸÄ±nÄ± kontrol edin, Ã§Ã¼nkÃ¼ bu, potansiyel bir WAF'Ä± atlamanÄ±za ve websocket iletiÅŸiminin graphQL ÅŸemasÄ±nÄ± sÄ±zdÄ±rmasÄ±na olanak tanÄ±yabilir.
```javascript
ws = new WebSocket('wss://target/graphql', 'graphql-ws');
ws.onopen = function start(event) {
var GQL_CALL = {
extensions: {},
query: `
{
__schema {
_types {
name
}
}
}`
}

var graphqlMsg = {
type: 'GQL.START',
id: '1',
payload: GQL_CALL,
};
ws.send(JSON.stringify(graphqlMsg));
}
```
### **AÃ§Ä±k GraphQL YapÄ±larÄ±nÄ± KeÅŸfetme**

Ä°Ã§gÃ¶rÃ¼ devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±ÄŸÄ±nda, Ã¶nceden yÃ¼klenmiÅŸ sorgularÄ± JavaScript kÃ¼tÃ¼phanelerinde bulmak iÃ§in web sitesinin kaynak kodunu incelemek faydalÄ± bir stratejidir. Bu sorgular, geliÅŸtirici araÃ§larÄ±ndaki `Sources` sekmesi kullanÄ±larak bulunabilir ve API'nin ÅŸemasÄ±na dair bilgiler sunarak potansiyel olarak **aÃ§Ä±k hassas sorgularÄ±** ortaya Ã§Ä±karÄ±r. GeliÅŸtirici araÃ§larÄ±nda arama yapmak iÃ§in kullanÄ±lan komutlar ÅŸunlardÄ±r:
```javascript
Inspect/Sources/"Search all files"
file:* mutation
file:* query
```
## GraphQL'de CSRF

EÄŸer CSRF'nin ne olduÄŸunu bilmiyorsanÄ±z, aÅŸaÄŸÄ±daki sayfayÄ± okuyun:

{% content-ref url="../../pentesting-web/csrf-cross-site-request-forgery.md" %}
[csrf-cross-site-request-forgery.md](../../pentesting-web/csrf-cross-site-request-forgery.md)
{% endcontent-ref %}

DÄ±ÅŸarÄ±da, **CSRF token'larÄ± olmadan yapÄ±landÄ±rÄ±lmÄ±ÅŸ** birkaÃ§ GraphQL uÃ§ noktasÄ± bulabileceksiniz.

GraphQL isteklerinin genellikle **`application/json`** iÃ§erik tÃ¼rÃ¼ kullanarak POST istekleri ile gÃ¶nderildiÄŸini unutmayÄ±n.
```javascript
{"operationName":null,"variables":{},"query":"{\n  user {\n    firstName\n    __typename\n  }\n}\n"}
```
Ancak, Ã§oÄŸu GraphQL uÃ§ noktasÄ± da **`form-urlencoded` POST isteklerini** destekler:
```javascript
query=%7B%0A++user+%7B%0A++++firstName%0A++++__typename%0A++%7D%0A%7D%0A
```
Bu nedenle, Ã¶nceki gibi CSRF istekleri **Ã¶n uÃ§ istekleri olmadan** gÃ¶nderildiÄŸinden, CSRF'yi kÃ¶tÃ¼ye kullanarak GraphQL'de **deÄŸiÅŸiklikler** **yapmak** **mÃ¼mkÃ¼ndÃ¼r**.

Ancak, Chrome'un `samesite` bayraÄŸÄ±nÄ±n yeni varsayÄ±lan Ã§erez deÄŸeri `Lax` olduÄŸunu unutmayÄ±n. Bu, Ã§erezin yalnÄ±zca Ã¼Ã§Ã¼ncÃ¼ taraf bir webden GET istekleriyle gÃ¶nderileceÄŸi anlamÄ±na gelir.

**Sorgu** **isteÄŸini** ayrÄ±ca **GET** **isteÄŸi olarak gÃ¶ndermek genellikle mÃ¼mkÃ¼ndÃ¼r ve CSRF token'Ä± GET isteÄŸinde doÄŸrulanmayabilir.**

AyrÄ±ca, bir [**XS-Search**](../../pentesting-web/xs-search/) **saldÄ±rÄ±sÄ±nÄ±** kÃ¶tÃ¼ye kullanarak, kullanÄ±cÄ±nÄ±n kimlik bilgilerini kÃ¶tÃ¼ye kullanarak GraphQL uÃ§ noktasÄ±ndan iÃ§erik sÄ±zdÄ±rmak mÃ¼mkÃ¼n olabilir.

Daha fazla bilgi iÃ§in **buradaki** [**orijinal gÃ¶nderiyi kontrol edin**](https://blog.doyensec.com/2021/05/20/graphql-csrf.html).

## GraphQL'de Cross-site WebSocket ele geÃ§irme

GraphQL'i kÃ¶tÃ¼ye kullanan CRSF zafiyetlerine benzer ÅŸekilde, **korumasÄ±z Ã§erezlerle GraphQL ile kimlik doÄŸrulamasÄ±nÄ± kÃ¶tÃ¼ye kullanmak iÃ§in bir Cross-site WebSocket ele geÃ§irme gerÃ§ekleÅŸtirmek** ve bir kullanÄ±cÄ±nÄ±n GraphQL'de beklenmedik eylemler gerÃ§ekleÅŸtirmesini saÄŸlamak da mÃ¼mkÃ¼ndÃ¼r.

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="../../pentesting-web/websocket-attacks.md" %}
[websocket-attacks.md](../../pentesting-web/websocket-attacks.md)
{% endcontent-ref %}

## GraphQL'de Yetkilendirme

UÃ§ noktada tanÄ±mlanan birÃ§ok GraphQL iÅŸlevi, talep edenin kimliÄŸini kontrol edebilir ancak yetkilendirmeyi kontrol etmeyebilir.

Sorgu girdi deÄŸiÅŸkenlerini deÄŸiÅŸtirmek, hassas hesap bilgilerini [sÄ±zdÄ±rabilir](https://hackerone.com/reports/792927).

Mutasyon, diÄŸer hesap verilerini deÄŸiÅŸtirmeye Ã§alÄ±ÅŸarak hesap ele geÃ§irmeye bile yol aÃ§abilir.
```javascript
{
"operationName":"updateProfile",
"variables":{"username":INJECT,"data":INJECT},
"query":"mutation updateProfile($username: String!,...){updateProfile(username: $username,...){...}}"
}
```
### GraphQL'de Yetkiyi AÅŸma

[Query'leri zincirleme](https://s1n1st3r.gitbook.io/theb10g/graphql-query-authentication-bypass-vuln) zayÄ±f bir kimlik doÄŸrulama sistemini aÅŸabilir.

AÅŸaÄŸÄ±daki Ã¶rnekte, iÅŸlemin "forgotPassword" olduÄŸunu ve bunun yalnÄ±zca ona baÄŸlÄ± olan forgotPassword sorgusunu Ã§alÄ±ÅŸtÄ±rmasÄ± gerektiÄŸini gÃ¶rebilirsiniz. Bu, sonuna bir sorgu ekleyerek aÅŸÄ±labilir; bu durumda "register" ve sistemin yeni bir kullanÄ±cÄ± olarak kaydolmasÄ± iÃ§in bir kullanÄ±cÄ± deÄŸiÅŸkeni ekliyoruz.

<figure><img src="../../.gitbook/assets/GraphQLAuthBypassMethod.PNG" alt=""><figcaption></figcaption></figure>

## GraphQL'de Takma Adlar Kullanarak HÄ±z SÄ±nÄ±rlarÄ±nÄ± AÅŸma

GraphQL'de, takma adlar, bir API isteÄŸi yaparken **Ã¶zelliklerin aÃ§Ä±kÃ§a adlandÄ±rÄ±lmasÄ±nÄ±** saÄŸlayan gÃ¼Ã§lÃ¼ bir Ã¶zelliktir. Bu yetenek, **aynÄ± tÃ¼rden birden fazla nesneyi** tek bir istekte almak iÃ§in Ã¶zellikle yararlÄ±dÄ±r. Takma adlar, GraphQL nesnelerinin aynÄ± isimde birden fazla Ã¶zelliÄŸe sahip olmasÄ±nÄ± engelleyen sÄ±nÄ±rlamayÄ± aÅŸmak iÃ§in kullanÄ±labilir.

GraphQL takma adlarÄ± hakkÄ±nda detaylÄ± bir anlayÄ±ÅŸ iÃ§in aÅŸaÄŸÄ±daki kaynak Ã¶nerilmektedir: [Takma Adlar](https://portswigger.net/web-security/graphql/what-is-graphql#aliases).

Takma adlarÄ±n birincil amacÄ±, Ã§ok sayÄ±da API Ã§aÄŸrÄ±sÄ± gereksinimini azaltmak olsa da, takma adlarÄ±n bir GraphQL uÃ§ noktasÄ±nda kaba kuvvet saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±labileceÄŸi beklenmedik bir kullanÄ±m durumu tespit edilmiÅŸtir. Bu, bazÄ± uÃ§ noktalarÄ±n, **HTTP isteklerinin sayÄ±sÄ±nÄ±** kÄ±sÄ±tlayarak kaba kuvvet saldÄ±rÄ±larÄ±nÄ± engellemek iÃ§in tasarlanmÄ±ÅŸ hÄ±z sÄ±nÄ±rlayÄ±cÄ±larÄ± tarafÄ±ndan korunduÄŸu iÃ§in mÃ¼mkÃ¼ndÃ¼r. Ancak, bu hÄ±z sÄ±nÄ±rlayÄ±cÄ±larÄ± her istekteki iÅŸlem sayÄ±sÄ±nÄ± dikkate almayabilir. Takma adlar, tek bir HTTP isteÄŸinde birden fazla sorgunun dahil edilmesine izin verdiÄŸinden, bu tÃ¼r hÄ±z sÄ±nÄ±rlama Ã¶nlemlerini aÅŸabilirler.

AÅŸaÄŸÄ±da saÄŸlanan Ã¶rneÄŸi dÃ¼ÅŸÃ¼nÃ¼n; bu, takma adlÄ± sorgularÄ±n maÄŸaza indirim kodlarÄ±nÄ±n geÃ§erliliÄŸini doÄŸrulamak iÃ§in nasÄ±l kullanÄ±labileceÄŸini gÃ¶stermektedir. Bu yÃ¶ntem, birkaÃ§ sorguyu tek bir HTTP isteÄŸine derleyerek hÄ±z sÄ±nÄ±rlamasÄ±nÄ± aÅŸabilir ve potansiyel olarak birÃ§ok indirim kodunun aynÄ± anda doÄŸrulanmasÄ±na olanak tanÄ±yabilir.
```bash
# Example of a request utilizing aliased queries to check for valid discount codes
query isValidDiscount($code: Int) {
isvalidDiscount(code:$code){
valid
}
isValidDiscount2:isValidDiscount(code:$code){
valid
}
isValidDiscount3:isValidDiscount(code:$code){
valid
}
}
```
## AraÃ§lar

### GÃ¼venlik tarayÄ±cÄ±larÄ±

* [https://github.com/dolevf/graphql-cop](https://github.com/dolevf/graphql-cop): graphql uÃ§ noktalarÄ±nÄ±n yaygÄ±n yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ±nÄ± test eder
* [https://github.com/assetnote/batchql](https://github.com/assetnote/batchql): Toplu GraphQL sorgularÄ± ve mutasyonlarÄ± gerÃ§ekleÅŸtirmeye odaklanan GraphQL gÃ¼venlik denetim scripti.
* [https://github.com/dolevf/graphw00f](https://github.com/dolevf/graphw00f): KullanÄ±lan graphql'yi parmak izi ile tanÄ±mlama
* [https://github.com/gsmith257-cyber/GraphCrawler](https://github.com/gsmith257-cyber/GraphCrawler): ÅemalarÄ± yakalamak ve hassas verileri aramak, yetkilendirmeyi test etmek, ÅŸemalarÄ± kaba kuvvetle denemek ve belirli bir tipe giden yollarÄ± bulmak iÃ§in kullanÄ±labilecek araÃ§ seti.
* [https://blog.doyensec.com/2020/03/26/graphql-scanner.html](https://blog.doyensec.com/2020/03/26/graphql-scanner.html): BaÄŸÄ±msÄ±z olarak veya [Burp uzantÄ±sÄ±](https://github.com/doyensec/inql) olarak kullanÄ±labilir.
* [https://github.com/swisskyrepo/GraphQLmap](https://github.com/swisskyrepo/GraphQLmap): SaldÄ±rÄ±larÄ± otomatikleÅŸtirmek iÃ§in CLI istemcisi olarak da kullanÄ±labilir
* [https://gitlab.com/dee-see/graphql-path-enum](https://gitlab.com/dee-see/graphql-path-enum): **Bir GraphQL ÅŸemasÄ±nda belirli bir tipe ulaÅŸmanÄ±n farklÄ± yollarÄ±nÄ±** listeleyen araÃ§.
* [https://github.com/doyensec/GQLSpection](https://github.com/doyensec/GQLSpection): InQL'nin BaÄŸÄ±msÄ±z ve CLI ModlarÄ±nÄ±n Halefidir
* [https://github.com/doyensec/inql](https://github.com/doyensec/inql): GeliÅŸmiÅŸ GraphQL testi iÃ§in Burp uzantÄ±sÄ±. _**TarayÄ±cÄ±**_, InQL v5.0'Ä±n merkezidir; burada bir GraphQL uÃ§ noktasÄ±nÄ± veya yerel bir introspection ÅŸema dosyasÄ±nÄ± analiz edebilirsiniz. TÃ¼m olasÄ± sorgularÄ± ve mutasyonlarÄ± otomatik olarak oluÅŸturur ve bunlarÄ± analiziniz iÃ§in yapÄ±landÄ±rÄ±lmÄ±ÅŸ bir gÃ¶rÃ¼nÃ¼mde dÃ¼zenler. _**SaldÄ±rgan**_ bileÅŸeni, kÃ¶tÃ¼ uygulanmÄ±ÅŸ oran sÄ±nÄ±rlamalarÄ±nÄ± aÅŸmak iÃ§in yararlÄ± olabilecek toplu GraphQL saldÄ±rÄ±larÄ±nÄ± gerÃ§ekleÅŸtirmenizi saÄŸlar.
* [https://github.com/nikitastupin/clairvoyance](https://github.com/nikitastupin/clairvoyance): BazÄ± Graphql veritabanlarÄ±nÄ±n yardÄ±mÄ±yla, introspection devre dÄ±ÅŸÄ± olsa bile ÅŸemayÄ± elde etmeye Ã§alÄ±ÅŸÄ±r; bu veritabanlarÄ± mutasyonlarÄ±n ve parametrelerin adlarÄ±nÄ± Ã¶nerecektir.

### Ä°stemciler

* [https://github.com/graphql/graphiql](https://github.com/graphql/graphiql): GUI istemcisi
* [https://altair.sirmuel.design/](https://altair.sirmuel.design/): GUI Ä°stemcisi

### Otomatik Testler

{% embed url="https://graphql-dashboard.herokuapp.com/" %}

* AutoGraphQL'Ã¼ aÃ§Ä±klayan video: [https://www.youtube.com/watch?v=JJmufWfVvyU](https://www.youtube.com/watch?v=JJmufWfVvyU)

## Referanslar

* [**https://jondow.eu/practical-graphql-attack-vectors/**](https://jondow.eu/practical-graphql-attack-vectors/)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4**](https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4)
* [**http://ghostlulz.com/api-hacking-graphql/**](http://ghostlulz.com/api-hacking-graphql/)
* [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://portswigger.net/web-security/graphql**](https://portswigger.net/web-security/graphql)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
