# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€… **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶ä¸”æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ç›®æ ‡- **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## è‡ªåŠ¨æ‰«æ

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan is a command-line tool used for scanning Moodle installations for vulnerabilities. It is written in Python and can be used to perform various security tests on Moodle websites.

To use moodlescan, you need to have Python installed on your system. Once you have Python installed, you can download moodlescan from its GitHub repository.

To scan a Moodle website, you need to provide the URL of the website as a parameter to the moodlescan command. For example:

```
moodlescan https://example.com/moodle
```

moodlescan will then perform a series of tests to identify vulnerabilities in the Moodle installation. It will check for common security issues such as outdated software versions, misconfigurations, and weak passwords.

The tool will generate a report detailing the vulnerabilities found, along with recommendations for remediation. It is important to note that moodlescan is a tool for identifying vulnerabilities, not for exploiting them. It should only be used for ethical hacking purposes and with proper authorization.

Overall, moodlescan is a useful tool for pentesters and security professionals to assess the security of Moodle installations and ensure that they are protected against potential attacks.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMapæ˜¯ä¸€æ¬¾ç”¨äºæ‰«æå’Œè¯†åˆ«Moodleç½‘ç«™çš„å·¥å…·ã€‚Moodleæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¼€æºå­¦ä¹ ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºåˆ›å»ºåœ¨çº¿è¯¾ç¨‹å’Œè™šæ‹Ÿå­¦ä¹ ç¯å¢ƒã€‚CMSMapå¯ä»¥å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å‘ç°Moodleç½‘ç«™ä¸Šçš„æ¼æ´å’Œå¼±ç‚¹ã€‚

ä½¿ç”¨CMSMapï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

- **ä¿¡æ¯æ”¶é›†**ï¼šCMSMapå¯ä»¥æ”¶é›†æœ‰å…³ç›®æ ‡Moodleç½‘ç«™çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬å·ã€æ’ä»¶å’Œä¸»é¢˜ã€‚
- **æ¼æ´æ‰«æ**ï¼šCMSMapå¯ä»¥æ‰«æMoodleç½‘ç«™ä»¥æŸ¥æ‰¾å·²çŸ¥çš„æ¼æ´å’Œå®‰å…¨é—®é¢˜ã€‚
- **è®¤è¯ç ´è§£**ï¼šCMSMapå¯ä»¥å°è¯•ä½¿ç”¨å¸¸è§çš„ç”¨æˆ·åå’Œå¯†ç ç»„åˆå¯¹Moodleç½‘ç«™è¿›è¡Œè®¤è¯ç ´è§£ã€‚
- **ç›®å½•çˆ†ç ´**ï¼šCMSMapå¯ä»¥é€šè¿‡å°è¯•è®¿é—®å¸¸è§çš„ç›®å½•å’Œæ–‡ä»¶è·¯å¾„æ¥å‘ç°Moodleç½‘ç«™ä¸Šçš„éšè—å†…å®¹ã€‚
- **æ¼æ´åˆ©ç”¨**ï¼šCMSMapå¯ä»¥åˆ©ç”¨å·²çŸ¥çš„æ¼æ´æ¥è·å–å¯¹Moodleç½‘ç«™çš„æœªæˆæƒè®¿é—®æˆ–æ‰§è¡Œç‰¹å®šçš„æ”»å‡»ã€‚

è¦ä½¿ç”¨CMSMapï¼Œæ‚¨éœ€è¦å®‰è£…Pythonå’Œä¸€äº›å¿…è¦çš„ä¾èµ–é¡¹ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œç•Œé¢è¿è¡ŒCMSMapï¼Œå¹¶æä¾›ç›®æ ‡Moodleç½‘ç«™çš„URLã€‚

è¯·æ³¨æ„ï¼Œä½¿ç”¨CMSMapè¿›è¡Œæ¸—é€æµ‹è¯•éœ€è¦è·å¾—åˆæ³•çš„æˆæƒï¼Œå¹¶éµå®ˆé€‚ç”¨çš„æ³•å¾‹å’Œé“å¾·å‡†åˆ™ã€‚
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

æˆ‘å‘ç°è‡ªåŠ¨å·¥å…·åœ¨å‘ç°å½±å“ Moodle ç‰ˆæœ¬çš„æ¼æ´æ–¹é¢ç›¸å½“æ— ç”¨ã€‚ä½ å¯ä»¥åœ¨ [https://snyk.io/vuln/composer:moodle%2Fmoodle](https://snyk.io/vuln/composer:moodle%2Fmoodle) ä¸Šæ£€æŸ¥å®ƒä»¬ã€‚

## RCE

ä½ éœ€è¦æ‹¥æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œå¹¶ä¸”å¯ä»¥åœ¨â€œç«™ç‚¹ç®¡ç†â€é€‰é¡¹å¡ä¸­å®‰è£…æ’ä»¶ï¼š

![](<../../.gitbook/assets/image (447).png>)

å³ä½¿ä½ æ˜¯ç®¡ç†å‘˜ï¼Œä½ å¯èƒ½ä»ç„¶éœ€è¦æ¿€æ´»æ­¤é€‰é¡¹ã€‚ä½ å¯ä»¥åœ¨ Moodle ç‰¹æƒå‡çº§ PoC ä¸­æŸ¥çœ‹å¦‚ä½•æ¿€æ´»ï¼š[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)ã€‚

ç„¶åï¼Œä½ å¯ä»¥å®‰è£…ä»¥ä¸‹åŒ…å«ç»å…¸ pentest-monkey php åå‘ shell çš„æ’ä»¶ï¼ˆåœ¨ä¸Šä¼ ä¹‹å‰ï¼Œä½ éœ€è¦è§£å‹ç¼©å®ƒï¼Œæ›´æ”¹åå‘ shell çš„ IP å’Œç«¯å£ï¼Œç„¶åå†æ¬¡å‹ç¼©ï¼‰ï¼š

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨æ¥è‡ª [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) çš„æ’ä»¶ï¼Œä»¥è·å–å¸¦æœ‰ "cmd" å‚æ•°çš„å¸¸è§„ PHP shellã€‚

è¦è®¿é—®å¯åŠ¨æ¶æ„æ’ä»¶ï¼Œä½ éœ€è¦è®¿é—®ï¼š
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### æŸ¥æ‰¾æ•°æ®åº“å‡­æ®

To find database credentials in a Moodle application, you can start by analyzing the POST requests made by the application. These requests often contain sensitive information, such as database credentials, that are sent from the client to the server.

To begin, intercept the POST requests using a proxy tool like Burp Suite. Once you have intercepted a POST request, analyze its parameters and look for any fields that may contain database credentials. Common parameter names to look for include "db_user", "db_password", "db_username", and "db_passwd".

If you find any parameters that appear to contain database credentials, note down their values. These values may be encrypted or encoded, so you may need to decrypt or decode them to obtain the actual credentials.

Once you have obtained the database credentials, you can use them to gain unauthorized access to the database. This can be done by connecting to the database using a database management tool or by using the credentials in other parts of the application that require database access.

Remember to always obtain proper authorization before attempting any penetration testing activities. Unauthorized access to databases or other systems is illegal and unethical.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### ä»æ•°æ®åº“ä¸­è·å–å‡­æ®

To dump credentials from a database, you can follow these steps:

1. Identify the target database: Determine the type of database being used by the web application. Common databases include MySQL, PostgreSQL, Oracle, and Microsoft SQL Server.

2. Enumerate database users: Use techniques such as SQL injection or brute-forcing to identify the database users. This can be done by exploiting vulnerabilities in the web application or by using default or weak credentials.

3. Gain database access: Once you have identified the database users, attempt to gain access to the database. This can be done by using the obtained credentials or by exploiting vulnerabilities in the database itself.

4. Dump the credentials: Once you have access to the database, you can extract the credentials stored within it. This can be done by executing SQL queries to retrieve the username and password information from the relevant tables.

5. Analyze the credentials: After extracting the credentials, analyze them to determine their validity and potential impact. This includes checking if the passwords are stored in plaintext or if they are hashed and salted.

Remember to always obtain proper authorization before performing any penetration testing activities. Unauthorized access to databases is illegal and unethical.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ä¸œè¥¿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦é¢å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
