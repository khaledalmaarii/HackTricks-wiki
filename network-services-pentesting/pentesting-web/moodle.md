# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶ä¸”æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ç³»ç»Ÿ- **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## è‡ªåŠ¨æ‰«æ

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan is a command-line tool used for scanning Moodle installations for vulnerabilities. It is specifically designed for penetration testers and security researchers to identify potential security weaknesses in Moodle-based websites.

#### Installation

To install moodlescan, follow these steps:

1. Clone the moodlescan repository from GitHub:

   ```
   git clone https://github.com/damnvulnerablemoodle/moodlescan.git
   ```

2. Change into the moodlescan directory:

   ```
   cd moodlescan
   ```

3. Install the required Python packages:

   ```
   pip install -r requirements.txt
   ```

#### Usage

To use moodlescan, run the following command:

```
python moodlescan.py [options]
```

The available options are:

- `-u, --url`: The URL of the Moodle installation to scan.
- `-f, --file`: The path to a file containing a list of URLs to scan.
- `-o, --output`: The path to the output file where the scan results will be saved.
- `-v, --verbose`: Enable verbose output for debugging purposes.
- `-h, --help`: Display the help message.

#### Example

To scan a single Moodle installation, use the following command:

```
python moodlescan.py -u https://example.com/moodle
```

To scan multiple Moodle installations listed in a file, use the following command:

```
python moodlescan.py -f urls.txt
```

The scan results will be displayed on the console and saved to the specified output file.

#### Conclusion

moodlescan is a powerful tool for identifying vulnerabilities in Moodle installations. By using this tool, penetration testers and security researchers can effectively assess the security posture of Moodle-based websites and help organizations mitigate potential risks.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMapæ˜¯ä¸€æ¬¾ç”¨äºæ‰«æå’Œè¯†åˆ«Moodleç½‘ç«™çš„å·¥å…·ã€‚Moodleæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¼€æºå­¦ä¹ ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºåˆ›å»ºåœ¨çº¿è¯¾ç¨‹å’Œè™šæ‹Ÿå­¦ä¹ ç¯å¢ƒã€‚CMSMapå¯ä»¥å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å‘ç°Moodleç½‘ç«™ä¸Šçš„æ¼æ´å’Œå¼±ç‚¹ã€‚

ä½¿ç”¨CMSMapï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

- **æ‰«æç½‘ç«™**ï¼šCMSMapå¯ä»¥æ‰«æç›®æ ‡ç½‘ç«™ï¼Œè¯†åˆ«æ˜¯å¦ä½¿ç”¨äº†Moodle CMSã€‚
- **è¯†åˆ«ç‰ˆæœ¬**ï¼šCMSMapå¯ä»¥ç¡®å®šç›®æ ‡Moodleç½‘ç«™çš„ç‰ˆæœ¬å·ï¼Œè¿™å¯¹äºæŸ¥æ‰¾å·²çŸ¥æ¼æ´å’Œå¼±ç‚¹éå¸¸æœ‰ç”¨ã€‚
- **æšä¸¾ç”¨æˆ·**ï¼šCMSMapå¯ä»¥æšä¸¾Moodleç½‘ç«™ä¸Šçš„ç”¨æˆ·ï¼ŒåŒ…æ‹¬ç®¡ç†å‘˜å’Œå…¶ä»–ç”¨æˆ·ã€‚
- **å‘ç°æ’ä»¶**ï¼šCMSMapå¯ä»¥å‘ç°ç›®æ ‡Moodleç½‘ç«™ä¸Šå®‰è£…çš„æ’ä»¶å’Œæ‰©å±•ã€‚
- **æ£€æŸ¥æ¼æ´**ï¼šCMSMapå¯ä»¥æ£€æŸ¥ç›®æ ‡Moodleç½‘ç«™æ˜¯å¦å­˜åœ¨å·²çŸ¥çš„æ¼æ´å’Œå®‰å…¨é—®é¢˜ã€‚

è¦ä½¿ç”¨CMSMapï¼Œæ‚¨éœ€è¦æä¾›ç›®æ ‡Moodleç½‘ç«™çš„URLã€‚ç„¶åï¼ŒCMSMapå°†è‡ªåŠ¨æ‰§è¡Œæ‰«æå¹¶æä¾›æœ‰å…³ç›®æ ‡ç½‘ç«™çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æ‚¨è¯„ä¼°ç›®æ ‡ç½‘ç«™çš„å®‰å…¨æ€§ï¼Œå¹¶é‡‡å–å¿…è¦çš„æªæ–½æ¥ä¿æŠ¤å®ƒå…å—æ½œåœ¨çš„æ”»å‡»ã€‚

è¯·æ³¨æ„ï¼Œä½¿ç”¨CMSMapè¿›è¡Œæ¸—é€æµ‹è¯•éœ€è¦è·å¾—åˆæ³•çš„æˆæƒã€‚æœªç»æˆæƒçš„æµ‹è¯•å¯èƒ½ä¼šè¿åæ³•å¾‹ï¼Œå¹¶å¯¹ç›®æ ‡ç½‘ç«™é€ æˆæŸå®³ã€‚è¯·å§‹ç»ˆéµå®ˆæ³•å¾‹å’Œé“å¾·å‡†åˆ™ï¼Œå¹¶ä»…åœ¨åˆæ³•çš„ç¯å¢ƒä¸­ä½¿ç”¨CMSMapã€‚
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

æˆ‘å‘ç°è‡ªåŠ¨å·¥å…·åœ¨å‘ç°å½±å“ Moodle ç‰ˆæœ¬çš„æ¼æ´æ–¹é¢ç›¸å½“æ— ç”¨ã€‚ä½ å¯ä»¥åœ¨ [https://snyk.io/vuln/composer:moodle%2Fmoodle](https://snyk.io/vuln/composer:moodle%2Fmoodle) ä¸Šæ£€æŸ¥å®ƒä»¬ã€‚

## RCE

ä½ éœ€è¦æ‹¥æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œå¹¶ä¸”å¯ä»¥åœ¨â€œç«™ç‚¹ç®¡ç†â€é€‰é¡¹å¡ä¸­å®‰è£…æ’ä»¶ï¼š

![](<../../.gitbook/assets/image (447).png>)

å³ä½¿ä½ æ˜¯ç®¡ç†å‘˜ï¼Œä½ å¯èƒ½ä»ç„¶éœ€è¦æ¿€æ´»æ­¤é€‰é¡¹ã€‚ä½ å¯ä»¥åœ¨ Moodle ç‰¹æƒå‡çº§ PoC ä¸­æŸ¥çœ‹å¦‚ä½•æ¿€æ´»ï¼š[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)ã€‚

ç„¶åï¼Œä½ å¯ä»¥å®‰è£…ä»¥ä¸‹åŒ…å«ç»å…¸ pentest-monkey php åå‘ shell çš„æ’ä»¶ï¼ˆåœ¨ä¸Šä¼ ä¹‹å‰ï¼Œä½ éœ€è¦è§£å‹ç¼©å®ƒï¼Œæ›´æ”¹åå‘ shell çš„ IP å’Œç«¯å£ï¼Œç„¶åå†æ¬¡å‹ç¼©ï¼‰ï¼š

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨æ¥è‡ª [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) çš„æ’ä»¶ï¼Œä»¥è·å–å¸¦æœ‰ "cmd" å‚æ•°çš„å¸¸è§„ PHP shellã€‚

è¦è®¿é—®å¯åŠ¨æ¶æ„æ’ä»¶ï¼Œä½ éœ€è¦è®¿é—®ï¼š
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### æŸ¥æ‰¾æ•°æ®åº“å‡­æ®

To find database credentials in a Moodle application, you can start by analyzing the POST requests made by the application. These requests often contain sensitive information, such as database credentials, that are sent from the client to the server.

ä¸ºäº†åœ¨ Moodle åº”ç”¨ç¨‹åºä¸­æŸ¥æ‰¾æ•°æ®åº“å‡­æ®ï¼Œæ‚¨å¯ä»¥å¼€å§‹åˆ†æåº”ç”¨ç¨‹åºå‘é€çš„ POST è¯·æ±‚ã€‚è¿™äº›è¯·æ±‚é€šå¸¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®åº“å‡­æ®ã€‚

To do this, you can use a web proxy tool like Burp Suite to intercept and analyze the POST requests. Follow these steps:

ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åƒ Burp Suite è¿™æ ·çš„ç½‘ç»œä»£ç†å·¥å…·æ¥æ‹¦æˆªå’Œåˆ†æ POST è¯·æ±‚ã€‚æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š

1. Configure your browser to use Burp Suite as a proxy.
2. Start Burp Suite and navigate to the Moodle application.
3. Perform actions in the application that trigger POST requests, such as logging in or submitting a form.
4. In Burp Suite, go to the "Proxy" tab and look for the intercepted POST requests.
5. Analyze the intercepted requests and look for parameters that may contain database credentials. These parameters are often named things like "db_user", "db_password", or "database".
6. Take note of any potential database credentials that you find.

1. é…ç½®æ‚¨çš„æµè§ˆå™¨ä»¥å°† Burp Suite è®¾ç½®ä¸ºä»£ç†ã€‚
2. å¯åŠ¨ Burp Suite å¹¶å¯¼èˆªåˆ° Moodle åº”ç”¨ç¨‹åºã€‚
3. åœ¨åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œè§¦å‘ POST è¯·æ±‚çš„æ“ä½œï¼Œä¾‹å¦‚ç™»å½•æˆ–æäº¤è¡¨å•ã€‚
4. åœ¨ Burp Suite ä¸­ï¼Œè½¬åˆ°â€œProxyâ€é€‰é¡¹å¡å¹¶æŸ¥æ‰¾æ‹¦æˆªçš„ POST è¯·æ±‚ã€‚
5. åˆ†ææ‹¦æˆªçš„è¯·æ±‚å¹¶æŸ¥æ‰¾å¯èƒ½åŒ…å«æ•°æ®åº“å‡­æ®çš„å‚æ•°ã€‚è¿™äº›å‚æ•°é€šå¸¸è¢«å‘½åä¸ºâ€œdb_userâ€ã€â€œdb_passwordâ€æˆ–â€œdatabaseâ€ç­‰ã€‚
6. è®°ä¸‹æ‚¨æ‰¾åˆ°çš„ä»»ä½•æ½œåœ¨çš„æ•°æ®åº“å‡­æ®ã€‚

By analyzing the POST requests and identifying the parameters that contain database credentials, you can gain access to the database and potentially extract sensitive information.

é€šè¿‡åˆ†æ POST è¯·æ±‚å¹¶è¯†åˆ«åŒ…å«æ•°æ®åº“å‡­æ®çš„å‚æ•°ï¼Œæ‚¨å¯ä»¥è®¿é—®æ•°æ®åº“å¹¶å¯èƒ½æå–æ•æ„Ÿä¿¡æ¯ã€‚
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### ä»æ•°æ®åº“ä¸­è·å–å‡­æ®

To dump credentials from a database, you can follow these steps:

1. Identify the target database: Determine the type of database being used by the web application. Common databases include MySQL, PostgreSQL, Oracle, and Microsoft SQL Server.

2. Enumerate database users: Use techniques such as SQL injection or brute-forcing to identify the database users. This can be done by exploiting vulnerabilities in the web application or by using default or weak credentials.

3. Extract credentials: Once you have identified the database users, you can extract their credentials from the database. This can be done by querying the database tables that store user information, such as the "users" table.

4. Decrypt or crack passwords: If the passwords are stored in a hashed or encrypted format, you may need to decrypt or crack them to obtain the plaintext passwords. This can be done using techniques such as password cracking or rainbow table attacks.

5. Use the credentials: Once you have obtained the credentials, you can use them to gain unauthorized access to the web application or other systems that use the same credentials.

It is important to note that dumping credentials from a database without proper authorization is illegal and unethical. This information is provided for educational purposes only and should not be used for any malicious activities. Always ensure you have proper authorization and follow ethical guidelines when conducting any security testing or penetration testing activities.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ä¸œè¥¿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family) - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTricksçš„è¡£ç‰©**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
