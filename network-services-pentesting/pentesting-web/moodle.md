# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€… **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶ä¸”æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ç›®æ ‡- **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## è‡ªåŠ¨æ‰«æ

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan is a command-line tool used for scanning and identifying vulnerabilities in Moodle installations. It is specifically designed for penetration testers and security professionals to assess the security of Moodle-based e-learning platforms.

#### Installation

To install moodlescan, follow these steps:

1. Clone the moodlescan repository from GitHub:

   ```
   git clone https://github.com/edduarte/moodlescan.git
   ```

2. Change into the moodlescan directory:

   ```
   cd moodlescan
   ```

3. Install the required dependencies using pip:

   ```
   pip install -r requirements.txt
   ```

#### Usage

To use moodlescan, run the following command:

```
python moodlescan.py [options] <target>
```

Replace `<target>` with the URL of the Moodle installation you want to scan.

#### Options

moodlescan supports the following options:

- `-h, --help`: Display the help message and exit.
- `-v, --version`: Display the version number and exit.
- `-u, --username <username>`: Specify the username to use for authentication.
- `-p, --password <password>`: Specify the password to use for authentication.
- `-c, --cookie <cookie>`: Specify the cookie to use for authentication.
- `-o, --output <output_file>`: Specify the output file to save the scan results.
- `-s, --ssl`: Use SSL/TLS for the connection.
- `-r, --redirects`: Follow redirects.
- `-t, --timeout <timeout>`: Specify the timeout value for requests (in seconds).

#### Example

Here is an example command to scan a Moodle installation:

```
python moodlescan.py -u admin -p password https://example.com/moodle
```

This will scan the Moodle installation at `https://example.com/moodle` using the specified username and password for authentication. The scan results will be displayed on the console.

#### Conclusion

moodlescan is a powerful tool for identifying vulnerabilities in Moodle installations. By using this tool, penetration testers and security professionals can assess the security of Moodle-based e-learning platforms and take appropriate measures to mitigate any identified risks.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMapæ˜¯ä¸€æ¬¾ç”¨äºæ‰«æå’Œè¯†åˆ«Moodleç½‘ç«™çš„å·¥å…·ã€‚Moodleæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¼€æºå­¦ä¹ ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºåˆ›å»ºåœ¨çº¿è¯¾ç¨‹å’Œè™šæ‹Ÿå­¦ä¹ ç¯å¢ƒã€‚CMSMapå¯ä»¥å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å‘ç°Moodleç½‘ç«™ä¸Šçš„æ¼æ´å’Œå¼±ç‚¹ã€‚

ä½¿ç”¨CMSMapï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

- **ä¿¡æ¯æ”¶é›†**ï¼šCMSMapå¯ä»¥æ”¶é›†æœ‰å…³ç›®æ ‡Moodleç½‘ç«™çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬å·ã€æ’ä»¶å’Œä¸»é¢˜ã€‚
- **æ¼æ´æ‰«æ**ï¼šCMSMapå¯ä»¥æ‰«æMoodleç½‘ç«™ä»¥æŸ¥æ‰¾å·²çŸ¥çš„æ¼æ´å’Œå®‰å…¨é—®é¢˜ã€‚
- **å¼±ç‚¹åˆ©ç”¨**ï¼šCMSMapå¯ä»¥åˆ©ç”¨å·²çŸ¥çš„æ¼æ´å’Œå¼±ç‚¹æ¥è·å–å¯¹Moodleç½‘ç«™çš„æœªæˆæƒè®¿é—®æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚
- **å¯†ç ç ´è§£**ï¼šCMSMapå¯ä»¥å°è¯•ä½¿ç”¨å¸¸è§çš„ç”¨æˆ·åå’Œå¯†ç ç»„åˆå¯¹Moodleç½‘ç«™è¿›è¡Œæš´åŠ›ç ´è§£ã€‚

è¦ä½¿ç”¨CMSMapï¼Œæ‚¨éœ€è¦æä¾›ç›®æ ‡Moodleç½‘ç«™çš„URLã€‚ç„¶åï¼ŒCMSMapå°†è‡ªåŠ¨æ‰§è¡Œå„ç§æ‰«æå’Œåˆ©ç”¨æŠ€æœ¯ï¼Œä»¥å¸®åŠ©æ‚¨å‘ç°æ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚

è¯·æ³¨æ„ï¼Œä½¿ç”¨CMSMapè¿›è¡ŒMoodleç½‘ç«™çš„æ¸—é€æµ‹è¯•éœ€è¦åˆæ³•çš„æˆæƒå’Œè®¸å¯ã€‚æœªç»æˆæƒçš„è®¿é—®å’Œæ”»å‡»æ˜¯è¿æ³•è¡Œä¸ºï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡çš„æ³•å¾‹åæœã€‚
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

æˆ‘å‘ç°è‡ªåŠ¨å·¥å…·åœ¨å‘ç°å½±å“ Moodle ç‰ˆæœ¬çš„æ¼æ´æ–¹é¢ç›¸å½“æ— ç”¨ã€‚ä½ å¯ä»¥åœ¨ [https://snyk.io/vuln/composer:moodle%2Fmoodle](https://snyk.io/vuln/composer:moodle%2Fmoodle) ä¸Šæ£€æŸ¥å®ƒä»¬ã€‚

## RCE

ä½ éœ€è¦æ‹¥æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œå¹¶ä¸”å¯ä»¥åœ¨â€œç«™ç‚¹ç®¡ç†â€é€‰é¡¹å¡ä¸­å®‰è£…æ’ä»¶ï¼š

![](<../../.gitbook/assets/image (447).png>)

å³ä½¿ä½ æ˜¯ç®¡ç†å‘˜ï¼Œä½ å¯èƒ½ä»ç„¶éœ€è¦æ¿€æ´»æ­¤é€‰é¡¹ã€‚ä½ å¯ä»¥åœ¨ Moodle ç‰¹æƒå‡çº§ PoC ä¸­æŸ¥çœ‹å¦‚ä½•æ¿€æ´»ï¼š[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)ã€‚

ç„¶åï¼Œä½ å¯ä»¥å®‰è£…ä»¥ä¸‹åŒ…å«ç»å…¸ pentest-monkey php åå‘ shell çš„æ’ä»¶ï¼ˆåœ¨ä¸Šä¼ ä¹‹å‰ï¼Œä½ éœ€è¦è§£å‹ç¼©å®ƒï¼Œæ›´æ”¹åå‘ shell çš„ IP å’Œç«¯å£ï¼Œç„¶åå†æ¬¡å‹ç¼©ï¼‰ï¼š

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨æ¥è‡ª [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) çš„æ’ä»¶ï¼Œä»¥è·å–å¸¦æœ‰ "cmd" å‚æ•°çš„å¸¸è§„ PHP shellã€‚

è¦è®¿é—®å¯åŠ¨æ¶æ„æ’ä»¶ï¼Œä½ éœ€è¦è®¿é—®ï¼š
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### æŸ¥æ‰¾æ•°æ®åº“å‡­æ®

åœ¨è¿›è¡Œç½‘ç»œæœåŠ¡æ¸—é€æµ‹è¯•æ—¶ï¼ŒæŸ¥æ‰¾æ•°æ®åº“å‡­æ®æ˜¯ä¸€é¡¹é‡è¦çš„ä»»åŠ¡ã€‚æ•°æ®åº“å‡­æ®é€šå¸¸å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ä¸­ï¼Œç”¨äºè¿æ¥å’Œè®¿é—®æ•°æ®åº“ã€‚é€šè¿‡è·å–è¿™äº›å‡­æ®ï¼Œé»‘å®¢å¯ä»¥è¿›ä¸€æ­¥è®¿é—®å’Œæ“çºµæ•°æ®åº“ä¸­çš„æ•æ„Ÿæ•°æ®ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ³•æ¥æŸ¥æ‰¾æ•°æ®åº“å‡­æ®ï¼š

1. **é…ç½®æ–‡ä»¶**ï¼šè®¸å¤šWebåº”ç”¨ç¨‹åºä½¿ç”¨é…ç½®æ–‡ä»¶æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•°æ®åº“å‡­æ®ã€‚é€šè¿‡æŸ¥æ‰¾åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ‰¾åˆ°æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç ã€‚

2. **ç¯å¢ƒå˜é‡**ï¼šæœ‰äº›åº”ç”¨ç¨‹åºä½¿ç”¨ç¯å¢ƒå˜é‡æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•°æ®åº“å‡­æ®ã€‚é€šè¿‡æ£€æŸ¥åº”ç”¨ç¨‹åºçš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥æ‰¾åˆ°æ•°æ®åº“çš„å‡­æ®ä¿¡æ¯ã€‚

3. **æºä»£ç **ï¼šæœ‰æ—¶ï¼Œæ•°æ®åº“å‡­æ®å¯èƒ½ç›´æ¥ç¡¬ç¼–ç åœ¨åº”ç”¨ç¨‹åºçš„æºä»£ç ä¸­ã€‚é€šè¿‡æ£€æŸ¥åº”ç”¨ç¨‹åºçš„æºä»£ç ï¼Œå¯ä»¥æ‰¾åˆ°æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç ã€‚

4. **é”™è¯¯ä¿¡æ¯**ï¼šæœ‰æ—¶ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šåœ¨é”™è¯¯æ¶ˆæ¯ä¸­æ³„éœ²æ•°æ®åº“å‡­æ®ã€‚é€šè¿‡æ£€æŸ¥åº”ç”¨ç¨‹åºçš„é”™è¯¯æ¶ˆæ¯ï¼Œå¯ä»¥æ‰¾åˆ°æ•°æ®åº“çš„å‡­æ®ä¿¡æ¯ã€‚

åœ¨æŸ¥æ‰¾æ•°æ®åº“å‡­æ®æ—¶ï¼Œé»‘å®¢éœ€è¦ä»”ç»†åˆ†æåº”ç”¨ç¨‹åºçš„ä¸åŒç»„ä»¶ï¼ŒåŒ…æ‹¬é…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€æºä»£ç å’Œé”™è¯¯æ¶ˆæ¯ã€‚é€šè¿‡ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œé»‘å®¢å¯ä»¥æˆåŠŸåœ°è·å–æ•°æ®åº“çš„å‡­æ®ï¼Œä»è€Œè¿›ä¸€æ­¥æ¸—é€å’Œæ“çºµç›®æ ‡ç³»ç»Ÿä¸­çš„æ•æ„Ÿæ•°æ®ã€‚
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### ä»æ•°æ®åº“ä¸­è·å–å‡­æ®

To dump credentials from a database, you can follow these steps:

1. Identify the target database: Determine the type of database being used by the web application. Common databases include MySQL, PostgreSQL, Oracle, and Microsoft SQL Server.

2. Enumerate database users: Use techniques such as SQL injection or brute-forcing to identify the database users. This can be done by exploiting vulnerabilities in the web application or by using default or weak credentials.

3. Extract credentials: Once you have identified the database users, you can extract their credentials from the database. This can be done by querying the database tables that store user information, such as the "users" table.

4. Decrypt or crack passwords: If the passwords are stored in a hashed or encrypted format, you may need to decrypt or crack them to obtain the plaintext passwords. This can be done using techniques such as password cracking or rainbow table attacks.

5. Use the credentials: Once you have obtained the credentials, you can use them to gain unauthorized access to the web application or other systems that use the same credentials.

It is important to note that dumping credentials from a database without proper authorization is illegal and unethical. These techniques should only be used for legitimate purposes, such as penetration testing or securing your own systems. Always ensure that you have the necessary permissions and legal authorization before attempting any database credential extraction.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ä¸œè¥¿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
