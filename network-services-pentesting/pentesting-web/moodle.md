# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€… **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶ä¸”æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ç›®æ ‡- **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## è‡ªåŠ¨æ‰«æ

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan is a command-line tool used for scanning and identifying vulnerabilities in Moodle installations. It is specifically designed for penetration testers and security professionals to assess the security of Moodle-based e-learning platforms.

#### Installation

To install moodlescan, follow these steps:

1. Clone the moodlescan repository from GitHub:

   ```
   git clone https://github.com/ethicalhack3r/moodlescan.git
   ```

2. Change into the moodlescan directory:

   ```
   cd moodlescan
   ```

3. Install the required dependencies using pip:

   ```
   pip install -r requirements.txt
   ```

#### Usage

To use moodlescan, run the following command:

```
python moodlescan.py [options]
```

The available options are:

- `-u, --url`: The URL of the Moodle installation to scan.
- `-f, --file`: The path to a file containing a list of URLs to scan.
- `-o, --output`: The path to the output file where the scan results will be saved.
- `-v, --verbose`: Enable verbose output for more detailed information.
- `-h, --help`: Display the help message and exit.

#### Example

To scan a single Moodle installation, use the following command:

```
python moodlescan.py -u https://example.com/moodle
```

To scan multiple Moodle installations listed in a file, use the following command:

```
python moodlescan.py -f urls.txt
```

The scan results will be displayed on the console and saved to the specified output file.

#### Conclusion

moodlescan is a powerful tool for identifying vulnerabilities in Moodle installations. By using this tool, penetration testers and security professionals can effectively assess the security of Moodle-based e-learning platforms and help mitigate potential risks.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMapæ˜¯ä¸€æ¬¾ç”¨äºæ‰«æå’Œè¯†åˆ«Moodleç½‘ç«™çš„å·¥å…·ã€‚Moodleæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¼€æºå­¦ä¹ ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºåˆ›å»ºåœ¨çº¿è¯¾ç¨‹å’Œè™šæ‹Ÿå­¦ä¹ ç¯å¢ƒã€‚CMSMapå¯ä»¥å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å‘ç°Moodleç½‘ç«™ä¸Šçš„æ¼æ´å’Œå¼±ç‚¹ã€‚

ä½¿ç”¨CMSMapï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

- **ä¿¡æ¯æ”¶é›†**ï¼šCMSMapå¯ä»¥æ”¶é›†æœ‰å…³ç›®æ ‡Moodleç½‘ç«™çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬å·ã€æ’ä»¶å’Œä¸»é¢˜ã€‚
- **æ¼æ´æ‰«æ**ï¼šCMSMapå¯ä»¥æ‰«æMoodleç½‘ç«™ä»¥æŸ¥æ‰¾å·²çŸ¥çš„æ¼æ´å’Œå®‰å…¨é—®é¢˜ã€‚
- **å¼±ç‚¹åˆ©ç”¨**ï¼šCMSMapå¯ä»¥åˆ©ç”¨å·²çŸ¥çš„æ¼æ´å’Œå¼±ç‚¹æ¥è·å–å¯¹Moodleç½‘ç«™çš„æœªæˆæƒè®¿é—®æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚
- **å¯†ç ç ´è§£**ï¼šCMSMapå¯ä»¥å°è¯•ä½¿ç”¨å¸¸è§çš„ç”¨æˆ·åå’Œå¯†ç ç»„åˆå¯¹Moodleç½‘ç«™è¿›è¡Œæš´åŠ›ç ´è§£ã€‚

è¦ä½¿ç”¨CMSMapï¼Œæ‚¨éœ€è¦æä¾›ç›®æ ‡Moodleç½‘ç«™çš„URLã€‚ç„¶åï¼ŒCMSMapå°†è‡ªåŠ¨æ‰§è¡Œå„ç§æ‰«æå’Œåˆ©ç”¨æŠ€æœ¯ï¼Œä»¥å¸®åŠ©æ‚¨å‘ç°æ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚

è¯·æ³¨æ„ï¼Œä½¿ç”¨CMSMapè¿›è¡ŒMoodleç½‘ç«™çš„æ¸—é€æµ‹è¯•éœ€è¦åˆæ³•çš„æˆæƒå’Œè®¸å¯ã€‚æœªç»æˆæƒçš„è®¿é—®å’Œæ”»å‡»æ˜¯è¿æ³•è¡Œä¸ºï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡çš„æ³•å¾‹åæœã€‚
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

æˆ‘å‘ç°è‡ªåŠ¨å·¥å…·åœ¨å‘ç°å½±å“ Moodle ç‰ˆæœ¬çš„æ¼æ´æ–¹é¢ç›¸å½“æ— ç”¨ã€‚ä½ å¯ä»¥åœ¨ [https://snyk.io/vuln/composer:moodle%2Fmoodle](https://snyk.io/vuln/composer:moodle%2Fmoodle) ä¸Šæ£€æŸ¥å®ƒä»¬ã€‚

## RCE

ä½ éœ€è¦æ‹¥æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œå¹¶ä¸”å¯ä»¥åœ¨â€œç«™ç‚¹ç®¡ç†â€é€‰é¡¹å¡ä¸­å®‰è£…æ’ä»¶ï¼š

![](<../../.gitbook/assets/image (447).png>)

å³ä½¿ä½ æ˜¯ç®¡ç†å‘˜ï¼Œä½ å¯èƒ½ä»ç„¶éœ€è¦æ¿€æ´»æ­¤é€‰é¡¹ã€‚ä½ å¯ä»¥åœ¨ Moodle ç‰¹æƒå‡çº§ PoC ä¸­æŸ¥çœ‹å¦‚ä½•æ¿€æ´»ï¼š[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)ã€‚

ç„¶åï¼Œä½ å¯ä»¥å®‰è£…ä»¥ä¸‹åŒ…å«ç»å…¸ pentest-monkey php åå‘ shell çš„æ’ä»¶ï¼ˆåœ¨ä¸Šä¼ ä¹‹å‰ï¼Œä½ éœ€è¦è§£å‹ç¼©å®ƒï¼Œæ›´æ”¹åå‘ shell çš„ IP å’Œç«¯å£ï¼Œç„¶åå†æ¬¡å‹ç¼©ï¼‰ï¼š

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨æ¥è‡ª [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) çš„æ’ä»¶ï¼Œä»¥è·å–å¸¦æœ‰ "cmd" å‚æ•°çš„å¸¸è§„ PHP shellã€‚

è¦è®¿é—®å¯åŠ¨æ¶æ„æ’ä»¶ï¼Œä½ éœ€è¦è®¿é—®ï¼š
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### æŸ¥æ‰¾æ•°æ®åº“å‡­æ®

To find database credentials in a Moodle application, you can start by analyzing the POST requests made by the application. These requests often contain sensitive information, such as database credentials, that are sent from the client to the server.

ä¸ºäº†åœ¨Moodleåº”ç”¨ç¨‹åºä¸­æŸ¥æ‰¾æ•°æ®åº“å‡­æ®ï¼Œæ‚¨å¯ä»¥å¼€å§‹åˆ†æåº”ç”¨ç¨‹åºå‘é€çš„POSTè¯·æ±‚ã€‚è¿™äº›è¯·æ±‚é€šå¸¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®åº“å‡­æ®ã€‚

To intercept and analyze the POST requests, you can use tools like Burp Suite or OWASP ZAP. These tools allow you to capture the requests and view their contents.

ä¸ºäº†æ‹¦æˆªå’Œåˆ†æPOSTè¯·æ±‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Burp Suiteæˆ–OWASP ZAPç­‰å·¥å…·ã€‚è¿™äº›å·¥å…·å…è®¸æ‚¨æ•è·è¯·æ±‚å¹¶æŸ¥çœ‹å…¶å†…å®¹ã€‚

Once you have intercepted a POST request, you can look for parameters that may contain database credentials. Common parameter names to look for include "db_user", "db_password", "db_username", and "db_passwd".

ä¸€æ—¦æ‹¦æˆªåˆ°POSTè¯·æ±‚ï¼Œæ‚¨å¯ä»¥æŸ¥æ‰¾å¯èƒ½åŒ…å«æ•°æ®åº“å‡­æ®çš„å‚æ•°ã€‚è¦æŸ¥æ‰¾çš„å¸¸è§å‚æ•°åç§°åŒ…æ‹¬"db_user"ã€"db_password"ã€"db_username"å’Œ"db_passwd"ã€‚

You can also look for other parameters that may indicate the presence of database credentials, such as "db_host" or "db_name".

æ‚¨è¿˜å¯ä»¥æŸ¥æ‰¾å…¶ä»–å¯èƒ½æŒ‡ç¤ºå­˜åœ¨æ•°æ®åº“å‡­æ®çš„å‚æ•°ï¼Œä¾‹å¦‚"db_host"æˆ–"db_name"ã€‚

Once you have identified the parameters that may contain database credentials, you can extract the values and test them to see if they are valid.

ä¸€æ—¦ç¡®å®šå¯èƒ½åŒ…å«æ•°æ®åº“å‡­æ®çš„å‚æ•°ï¼Œæ‚¨å¯ä»¥æå–è¿™äº›å€¼å¹¶æµ‹è¯•å®ƒä»¬ä»¥æŸ¥çœ‹æ˜¯å¦æœ‰æ•ˆã€‚

It is important to note that this technique assumes that the application is not properly securing the transmission of sensitive information. In a secure application, the database credentials should be encrypted or stored securely on the server side.

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æŠ€æœ¯å‡è®¾åº”ç”¨ç¨‹åºæœªæ­£ç¡®ä¿æŠ¤æ•æ„Ÿä¿¡æ¯çš„ä¼ è¾“ã€‚åœ¨å®‰å…¨çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ•°æ®åº“å‡­æ®åº”è¯¥æ˜¯åŠ å¯†çš„æˆ–åœ¨æœåŠ¡å™¨ç«¯å®‰å…¨å­˜å‚¨çš„ã€‚

Always ensure that you have proper authorization and legal permission before attempting any penetration testing activities.

åœ¨è¿›è¡Œä»»ä½•æ¸—é€æµ‹è¯•æ´»åŠ¨ä¹‹å‰ï¼Œå§‹ç»ˆç¡®ä¿æ‚¨å…·æœ‰é€‚å½“çš„æˆæƒå’Œåˆæ³•è®¸å¯ã€‚
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### ä»æ•°æ®åº“ä¸­è·å–å‡­æ®

To dump credentials from a database, you can follow these steps:

1. Identify the target database: Determine the type of database being used by the web application. Common databases include MySQL, PostgreSQL, Oracle, and Microsoft SQL Server.

2. Enumerate database users: Use techniques such as SQL injection or brute-forcing to identify the database users. This can be done by injecting SQL queries or attempting to log in with common usernames and passwords.

3. Extract credentials: Once you have identified the database users, you can extract their credentials by querying the database. This can be done using SQL commands such as SELECT or UNION.

4. Analyze the extracted data: Review the extracted credentials to identify valid usernames and passwords. Look for patterns or common practices that may help in cracking weak passwords.

5. Test the credentials: Use the extracted credentials to log in to the web application or other services associated with the database. This will help verify the validity of the credentials and assess their potential impact.

Remember to always obtain proper authorization before performing any database credential extraction. Unauthorized access to databases is illegal and unethical.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ç³»ç»Ÿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦è·å–**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
