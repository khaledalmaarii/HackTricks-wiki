# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Se vocÃª estÃ¡ interessado em uma **carreira de hacking** e hackear o inquebrÃ¡vel - **estamos contratando!** (_fluÃªncia em polonÃªs escrita e falada Ã© necessÃ¡ria_).

{% embed url="https://www.stmcyber.com/careers" %}

## Scaneamentos AutomÃ¡ticos

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
O comando `moodlescan` Ã© uma ferramenta de linha de comando usada para realizar a varredura de vulnerabilidades em instalaÃ§Ãµes do Moodle. Essa ferramenta Ã© especialmente Ãºtil durante testes de penetraÃ§Ã£o em ambientes Moodle, permitindo identificar possÃ­veis falhas de seguranÃ§a que podem ser exploradas por hackers.

O `moodlescan` Ã© capaz de verificar vÃ¡rias vulnerabilidades conhecidas no Moodle, incluindo problemas de configuraÃ§Ã£o, falhas de autenticaÃ§Ã£o, injeÃ§Ã£o de SQL, cross-site scripting (XSS) e muito mais. Ele tambÃ©m pode ser usado para verificar a versÃ£o do Moodle instalada e fornecer informaÃ§Ãµes detalhadas sobre a configuraÃ§Ã£o do sistema.

Para usar o `moodlescan`, basta executar o comando seguido pelo URL da instalaÃ§Ã£o do Moodle que deseja verificar. Por exemplo:

```
moodlescan https://example.com/moodle
```

O `moodlescan` irÃ¡ entÃ£o iniciar a varredura e exibir os resultados na tela. Ã‰ importante analisar cuidadosamente os resultados para identificar quaisquer vulnerabilidades encontradas e tomar as medidas necessÃ¡rias para corrigi-las.

Ã‰ importante ressaltar que o `moodlescan` deve ser usado apenas em ambientes autorizados e com permissÃ£o do proprietÃ¡rio do sistema. O uso indevido dessa ferramenta pode ser considerado ilegal e resultar em consequÃªncias legais.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
O CMSMap Ã© uma ferramenta de cÃ³digo aberto usada para realizar testes de penetraÃ§Ã£o em sistemas de gerenciamento de conteÃºdo (CMS). Ele Ã© projetado para identificar e explorar vulnerabilidades em CMS populares, como o Moodle. O CMSMap pode ser usado para descobrir informaÃ§Ãµes sobre a instalaÃ§Ã£o do Moodle, como versÃ£o, plugins instalados e temas ativos. Ele tambÃ©m pode ajudar a identificar possÃ­veis pontos fracos que podem ser explorados durante um teste de penetraÃ§Ã£o. O CMSMap Ã© uma ferramenta poderosa para hackers Ã©ticos e profissionais de seguranÃ§a que desejam avaliar a seguranÃ§a de um site baseado em Moodle.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

Descobri que as ferramentas automÃ¡ticas sÃ£o bastante **inÃºteis para encontrar vulnerabilidades que afetam a versÃ£o do Moodle**. VocÃª pode **verificÃ¡-las** em [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

VocÃª precisa ter a funÃ§Ã£o de **gerente** e **pode instalar plugins** dentro da guia **"AdministraÃ§Ã£o do site"**\*\*:\*\*

![](<../../.gitbook/assets/image (447).png>)

Se vocÃª for gerente, talvez ainda precise **ativar essa opÃ§Ã£o**. VocÃª pode ver como fazer isso no PoC de escalonamento de privilÃ©gios do Moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Em seguida, vocÃª pode **instalar o seguinte plugin** que contÃ©m o clÃ¡ssico shell reverso em PHP do pentest-monkey (_antes de fazer o upload, vocÃª precisa descompactÃ¡-lo, alterar o IP e a porta do revshell e compactÃ¡-lo novamente_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

Ou vocÃª pode usar o plugin de [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) para obter um shell PHP regular com o parÃ¢metro "cmd".

Para acessar o plugin malicioso, vocÃª precisa acessar:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
### Encontrar credenciais do banco de dados

Durante um teste de penetraÃ§Ã£o em um site Moodle, uma etapa importante Ã© encontrar as credenciais do banco de dados. Essas informaÃ§Ãµes sÃ£o essenciais para acessar e manipular os dados armazenados no banco de dados do Moodle.

Uma maneira comum de encontrar as credenciais do banco de dados Ã© explorar o cÃ³digo-fonte do site Moodle. Procure por arquivos como `config.php` ou `config-dist.php`, que geralmente contÃªm as informaÃ§Ãµes de conexÃ£o com o banco de dados.

Outra abordagem Ã© realizar uma anÃ¡lise de trÃ¡fego usando ferramentas como o Wireshark. Monitore o trÃ¡fego de rede enquanto realiza aÃ§Ãµes no site Moodle, como fazer login ou acessar pÃ¡ginas especÃ­ficas. Procure por pacotes que contenham informaÃ§Ãµes de conexÃ£o com o banco de dados, como consultas SQL ou solicitaÃ§Ãµes POST.

AlÃ©m disso, vocÃª pode tentar explorar vulnerabilidades conhecidas no Moodle que possam expor as credenciais do banco de dados. Verifique se hÃ¡ versÃµes desatualizadas ou vulnerabilidades conhecidas que possam ser exploradas para obter acesso Ã s informaÃ§Ãµes do banco de dados.

Uma vez que vocÃª tenha as credenciais do banco de dados, poderÃ¡ usÃ¡-las para acessar diretamente o banco de dados do Moodle e realizar atividades como extraÃ§Ã£o de dados, modificaÃ§Ã£o de registros ou atÃ© mesmo a exclusÃ£o de informaÃ§Ãµes sensÃ­veis. No entanto, Ã© importante lembrar que realizar essas aÃ§Ãµes sem permissÃ£o Ã© ilegal e pode ter consequÃªncias legais graves. Portanto, sempre realize testes de penetraÃ§Ã£o em um ambiente controlado e com permissÃ£o prÃ©via.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Extrair Credenciais do banco de dados

To dump credentials from a database, you can follow these steps:

1. Identify the target database: Determine the type of database being used, such as MySQL, PostgreSQL, or Oracle.

2. Enumerate the database: Use tools like Nmap or SQLMap to identify the database server and its version.

3. Exploit vulnerabilities: Exploit any known vulnerabilities in the database server or its associated web application to gain unauthorized access.

4. Gain database access: Once you have gained access to the database server, you can use SQL commands to extract the credentials from the database tables.

5. Dump the credentials: Use SQL commands like SELECT or UNION to retrieve the credentials from the relevant tables. You can also use tools like SQLDump or SQLMap to automate this process.

6. Analyze the dumped data: Review the extracted credentials to identify usernames, passwords, and other relevant information.

7. Use the credentials: The extracted credentials can be used for further exploitation, such as gaining access to other systems or escalating privileges.

It is important to note that performing these actions without proper authorization is illegal and unethical. Always ensure you have the necessary permissions and legal authorization before attempting any database credential extraction.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Se vocÃª estÃ¡ interessado em uma **carreira de hacking** e hackear o inquebrÃ¡vel - **estamos contratando!** (_fluÃªncia em polonÃªs escrita e falada Ã© necessÃ¡ria_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
