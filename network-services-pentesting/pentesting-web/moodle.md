# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€… **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶ä¸”æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ç›®æ ‡- **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## è‡ªåŠ¨æ‰«æ

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan is a command-line tool used for scanning and identifying vulnerabilities in Moodle installations. It is specifically designed for penetration testers and security professionals to assess the security of Moodle-based e-learning platforms.

#### Installation

To install moodlescan, follow these steps:

1. Clone the moodlescan repository from GitHub:

   ```
   git clone https://github.com/ethicalhack3r/moodlescan.git
   ```

2. Change into the moodlescan directory:

   ```
   cd moodlescan
   ```

3. Install the required dependencies using pip:

   ```
   pip install -r requirements.txt
   ```

#### Usage

To use moodlescan, run the following command:

```
python moodlescan.py [options]
```

The available options are:

- `-u, --url`: The URL of the Moodle installation to scan.
- `-f, --file`: The path to a file containing a list of URLs to scan.
- `-o, --output`: The path to the output file where the scan results will be saved.
- `-v, --verbose`: Enable verbose output for more detailed information.
- `-h, --help`: Display the help message and exit.

#### Example

To scan a single Moodle installation, use the following command:

```
python moodlescan.py -u https://example.com/moodle
```

To scan multiple Moodle installations listed in a file, use the following command:

```
python moodlescan.py -f urls.txt
```

The scan results will be displayed on the console and saved to the specified output file.

#### Conclusion

moodlescan is a powerful tool for identifying vulnerabilities in Moodle installations. By using this tool, penetration testers and security professionals can effectively assess the security of Moodle-based e-learning platforms and help mitigate potential risks.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMapæ˜¯ä¸€æ¬¾ç”¨äºæ‰«æå’Œè¯†åˆ«Moodleç½‘ç«™çš„å·¥å…·ã€‚Moodleæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¼€æºå­¦ä¹ ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºåˆ›å»ºåœ¨çº¿è¯¾ç¨‹å’Œè™šæ‹Ÿå­¦ä¹ ç¯å¢ƒã€‚CMSMapå¯ä»¥å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å‘ç°Moodleç½‘ç«™ä¸Šçš„æ¼æ´å’Œå¼±ç‚¹ã€‚

ä½¿ç”¨CMSMapï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

- **ä¿¡æ¯æ”¶é›†**ï¼šCMSMapå¯ä»¥æ”¶é›†æœ‰å…³ç›®æ ‡Moodleç½‘ç«™çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬å·ã€æ’ä»¶å’Œä¸»é¢˜ã€‚
- **æ¼æ´æ‰«æ**ï¼šCMSMapå¯ä»¥æ‰«æMoodleç½‘ç«™ä»¥æŸ¥æ‰¾å·²çŸ¥çš„æ¼æ´å’Œå®‰å…¨é—®é¢˜ã€‚
- **å¼±ç‚¹åˆ©ç”¨**ï¼šCMSMapå¯ä»¥åˆ©ç”¨å·²çŸ¥çš„æ¼æ´å’Œå¼±ç‚¹æ¥è·å–å¯¹Moodleç½‘ç«™çš„æœªæˆæƒè®¿é—®æˆ–æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚
- **å¯†ç ç ´è§£**ï¼šCMSMapå¯ä»¥å°è¯•ä½¿ç”¨å¸¸è§çš„ç”¨æˆ·åå’Œå¯†ç ç»„åˆå¯¹Moodleç½‘ç«™è¿›è¡Œæš´åŠ›ç ´è§£ã€‚

è¦ä½¿ç”¨CMSMapï¼Œæ‚¨éœ€è¦æä¾›ç›®æ ‡Moodleç½‘ç«™çš„URLã€‚ç„¶åï¼ŒCMSMapå°†è‡ªåŠ¨æ‰§è¡Œæ‰«æå’Œè¯†åˆ«æ“ä½œï¼Œå¹¶ç”Ÿæˆæœ‰å…³ç›®æ ‡ç½‘ç«™çš„æŠ¥å‘Šã€‚

è¯·æ³¨æ„ï¼Œä½¿ç”¨CMSMapè¿›è¡Œæ¸—é€æµ‹è¯•éœ€è¦è·å¾—åˆæ³•æˆæƒï¼Œå¹¶ä¸”åªèƒ½åœ¨åˆæ³•çš„æ¸—é€æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ã€‚æ»¥ç”¨CMSMapå¯èƒ½ä¼šå¯¼è‡´è¿æ³•è¡Œä¸ºå’Œæ³•å¾‹åæœã€‚
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

æˆ‘å‘ç°è‡ªåŠ¨å·¥å…·åœ¨å‘ç°å½±å“ Moodle ç‰ˆæœ¬çš„æ¼æ´æ–¹é¢ç›¸å½“æ— ç”¨ã€‚ä½ å¯ä»¥åœ¨ [https://snyk.io/vuln/composer:moodle%2Fmoodle](https://snyk.io/vuln/composer:moodle%2Fmoodle) ä¸Šæ£€æŸ¥å®ƒä»¬ã€‚

## RCE

ä½ éœ€è¦æ‹¥æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œå¹¶ä¸”å¯ä»¥åœ¨â€œç«™ç‚¹ç®¡ç†â€é€‰é¡¹å¡ä¸­å®‰è£…æ’ä»¶ï¼š

![](<../../.gitbook/assets/image (447).png>)

å³ä½¿ä½ æ˜¯ç®¡ç†å‘˜ï¼Œä½ å¯èƒ½ä»ç„¶éœ€è¦æ¿€æ´»æ­¤é€‰é¡¹ã€‚ä½ å¯ä»¥åœ¨ Moodle ç‰¹æƒå‡çº§ PoC ä¸­æŸ¥çœ‹å¦‚ä½•æ¿€æ´»ï¼š[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)ã€‚

ç„¶åï¼Œä½ å¯ä»¥å®‰è£…ä»¥ä¸‹åŒ…å«ç»å…¸ pentest-monkey php åå‘ shell çš„æ’ä»¶ï¼ˆåœ¨ä¸Šä¼ ä¹‹å‰ï¼Œä½ éœ€è¦è§£å‹ç¼©å®ƒï¼Œæ›´æ”¹åå‘ shell çš„ IP å’Œç«¯å£ï¼Œç„¶åå†æ¬¡å‹ç¼©ï¼‰ï¼š

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨æ¥è‡ª [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) çš„æ’ä»¶ï¼Œä»¥è·å–å¸¦æœ‰ "cmd" å‚æ•°çš„å¸¸è§„ PHP shellã€‚

è¦è®¿é—®å¯åŠ¨æ¶æ„æ’ä»¶ï¼Œä½ éœ€è¦è®¿é—®ï¼š
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### æŸ¥æ‰¾æ•°æ®åº“å‡­æ®

To find database credentials in a Moodle application, you can start by analyzing the POST requests made by the application. These requests often contain sensitive information, such as database credentials, that are sent from the client to the server.

ä¸ºäº†åœ¨Moodleåº”ç”¨ç¨‹åºä¸­æŸ¥æ‰¾æ•°æ®åº“å‡­æ®ï¼Œæ‚¨å¯ä»¥å¼€å§‹åˆ†æåº”ç”¨ç¨‹åºå‘é€çš„POSTè¯·æ±‚ã€‚è¿™äº›è¯·æ±‚é€šå¸¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®åº“å‡­æ®ã€‚

To do this, you can use a web proxy tool like Burp Suite to intercept and analyze the POST requests. Follow these steps:

ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åƒBurp Suiteè¿™æ ·çš„Webä»£ç†å·¥å…·æ¥æ‹¦æˆªå’Œåˆ†æPOSTè¯·æ±‚ã€‚æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š

1. Configure your web browser to use Burp Suite as a proxy.
2. Start Burp Suite and navigate to the Proxy tab.
3. Enable the Intercept feature in Burp Suite.
4. Access the Moodle application and perform actions that trigger POST requests.
5. When a POST request is intercepted by Burp Suite, it will appear in the Intercept tab.
6. Analyze the intercepted POST request and look for parameters that may contain database credentials.
7. Pay attention to parameters with names like "db_user", "db_password", or any other parameter related to database connection.
8. Extract the values of these parameters, as they may contain the database credentials.

1. é…ç½®æ‚¨çš„Webæµè§ˆå™¨ä»¥ä½¿ç”¨Burp Suiteä½œä¸ºä»£ç†ã€‚
2. å¯åŠ¨Burp Suiteå¹¶å¯¼èˆªåˆ°ä»£ç†é€‰é¡¹å¡ã€‚
3. åœ¨Burp Suiteä¸­å¯ç”¨æ‹¦æˆªåŠŸèƒ½ã€‚
4. è®¿é—®Moodleåº”ç”¨ç¨‹åºå¹¶æ‰§è¡Œè§¦å‘POSTè¯·æ±‚çš„æ“ä½œã€‚
5. å½“Burp Suiteæ‹¦æˆªåˆ°POSTè¯·æ±‚æ—¶ï¼Œå®ƒå°†å‡ºç°åœ¨æ‹¦æˆªé€‰é¡¹å¡ä¸­ã€‚
6. åˆ†ææ‹¦æˆªçš„POSTè¯·æ±‚ï¼Œå¹¶æŸ¥æ‰¾å¯èƒ½åŒ…å«æ•°æ®åº“å‡­æ®çš„å‚æ•°ã€‚
7. æ³¨æ„åç§°ä¸ºâ€œdb_userâ€ã€â€œdb_passwordâ€æˆ–ä¸æ•°æ®åº“è¿æ¥ç›¸å…³çš„ä»»ä½•å…¶ä»–å‚æ•°ã€‚
8. æå–è¿™äº›å‚æ•°çš„å€¼ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åŒ…å«æ•°æ®åº“å‡­æ®ã€‚

By analyzing the intercepted POST requests, you may be able to find the database credentials used by the Moodle application. These credentials can then be used for further penetration testing or security assessment purposes.

é€šè¿‡åˆ†ææ‹¦æˆªçš„POSTè¯·æ±‚ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿæ‰¾åˆ°Moodleåº”ç”¨ç¨‹åºä½¿ç”¨çš„æ•°æ®åº“å‡­æ®ã€‚ç„¶åï¼Œå¯ä»¥å°†è¿™äº›å‡­æ®ç”¨äºè¿›ä¸€æ­¥çš„æ¸—é€æµ‹è¯•æˆ–å®‰å…¨è¯„ä¼°ç›®çš„ã€‚
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### ä»æ•°æ®åº“ä¸­è·å–å‡­æ®

To dump credentials from a database, you can follow these steps:

1. Identify the target database: Determine the type of database being used by the web application. Common databases include MySQL, PostgreSQL, Oracle, and Microsoft SQL Server.

2. Enumerate database users: Use techniques such as SQL injection or brute-forcing to identify the database users. This can be done by exploiting vulnerabilities in the web application or by using default or weak credentials.

3. Extract credentials: Once you have identified the database users, you can extract their credentials from the database. This can be done by querying the database tables that store user information, such as the "users" table.

4. Decrypt or crack passwords: If the passwords are stored in a hashed or encrypted format, you may need to decrypt or crack them to obtain the plaintext passwords. This can be done using techniques such as password cracking or rainbow table attacks.

5. Use the credentials: Once you have obtained the credentials, you can use them to gain unauthorized access to the web application or other systems that use the same credentials.

Remember to always obtain proper authorization before performing any penetration testing activities. Unauthorized access to databases or systems is illegal and unethical.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ä¸œè¥¿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦é¢å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
