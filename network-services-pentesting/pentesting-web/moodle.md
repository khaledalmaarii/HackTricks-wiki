# Moodle

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Jeli interesuje Ci **kariera hakerska** i hakowanie niemo偶liwego - **zatrudniamy!** (_wymagane biege posugiwanie si jzykiem polskim w mowie i pimie_).

{% embed url="https://www.stmcyber.com/careers" %}

## Automatyczne Skanowanie

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

`moodlescan` is a tool used for scanning and enumerating Moodle instances. It helps in identifying vulnerabilities and misconfigurations in Moodle installations.

#### Usage

```
moodlescan [options] <target>
```

#### Options

- `-p, --port <port>`: Specify the port to connect to (default: 80).
- `-s, --ssl`: Use SSL/TLS for the connection.
- `-u, --username <username>`: Specify the username for authentication.
- `-P, --password <password>`: Specify the password for authentication.
- `-t, --threads <threads>`: Specify the number of threads to use for scanning (default: 10).
- `-o, --output <output>`: Specify the output file to save the results.

#### Examples

Scan a Moodle instance on the default port:

```
moodlescan example.com
```

Scan a Moodle instance on a specific port:

```
moodlescan -p 8080 example.com
```

Scan a Moodle instance using SSL/TLS:

```
moodlescan -s example.com
```

Scan a Moodle instance with authentication:

```
moodlescan -u admin -P password example.com
```

Scan a Moodle instance and save the results to a file:

```
moodlescan -o results.txt example.com
```

#### Note

`moodlescan` is a powerful tool that should only be used for legitimate purposes, such as penetration testing and security assessments. Unauthorized use of this tool is strictly prohibited.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap to skrypt napisany w jzyku Python, kt贸ry su偶y do skanowania i mapowania system贸w zarzdzania treci (CMS). Skrypt ten mo偶e pom贸c w identyfikacji u偶ywanego CMS na stronie internetowej oraz w odkrywaniu potencjalnych podatnoci.

#### Instalacja

Aby zainstalowa CMSMap, wykonaj nastpujce kroki:

1. Pobierz skrypt z repozytorium GitHub:

   ```
   git clone https://github.com/Dionach/CMSmap.git
   ```

2. Przejd藕 do katalogu CMSMap:

   ```
   cd CMSmap
   ```

3. Zainstaluj wymagane zale偶noci:

   ```
   pip install -r requirements.txt
   ```

#### U偶ycie

Po zainstalowaniu CMSMap, mo偶esz go uruchomi, wykonujc poni偶sz komend:

```
python3 cmsmap.py -t <adres_strony>
```

Gdzie `<adres_strony>` to adres URL strony, kt贸r chcesz zeskanowa.

#### Funkcje

CMSMap oferuje wiele funkcji, kt贸re mog by przydatne podczas testowania penetracyjnego stron internetowych opartych na CMS. Niekt贸re z tych funkcji to:

- Skanowanie strony w poszukiwaniu u偶ywanego CMS.
- Wykrywanie wersji CMS oraz zainstalowanych wtyczek i motyw贸w.
- Wyszukiwanie podatnoci w CMS.
- Wykonywanie atak贸w sownikowych na panel logowania CMS.
- Wykonywanie atak贸w wstrzykiwania SQL.
- Wykonywanie atak贸w wstrzykiwania XSS.
- Wykonywanie atak贸w wstrzykiwania kodu PHP.

#### Podsumowanie

CMSMap to przydatne narzdzie do skanowania i mapowania system贸w zarzdzania treci. Mo偶e pom贸c w identyfikacji u偶ywanego CMS na stronie internetowej oraz w odkrywaniu potencjalnych podatnoci.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

Zauwa偶yem, 偶e automatyczne narzdzia s do **bezu偶yteczne w znajdowaniu podatnoci dotyczcych wersji moodle**. Mo偶esz **sprawdzi** je tutaj: [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

Musisz mie rol **managera** i **mo偶esz instalowa wtyczki** w zakadce **"Administracja witryny"**\*\*:\*\*

![](<../../.gitbook/assets/image (447).png>)

Jeli jeste managerem, mo偶esz nadal potrzebowa **aktywowa t opcj**. Mo偶esz zobaczy, jak to zrobi w dowodzie koncepcyjnym eskalacji uprawnie moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Nastpnie mo偶esz **zainstalowa nastpujc wtyczk**, kt贸ra zawiera klasyczn powok php r**ev shell** (_przed jej przesaniem musisz j rozpakowa, zmieni IP i port revshell i ponownie spakowa_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

Mo偶esz r贸wnie偶 u偶y wtyczki z [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE), aby uzyska zwyk powok PHP z parametrem "cmd".

Aby uruchomi zoliw wtyczk, musisz uzyska dostp do:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
### Znajd藕 dane uwierzytelniajce bazy danych

Aby znale藕 dane uwierzytelniajce bazy danych w aplikacji Moodle, mo偶esz wykorzysta technik POST. Ta technika polega na wysyaniu 偶da POST do r贸偶nych cie偶ek aplikacji w celu znalezienia potencjalnych wyciek贸w danych.

#### Krok 1: Przechwycenie 偶dania POST

Najpierw musisz przechwyci 偶danie POST, kt贸re jest wysyane podczas logowania do aplikacji Moodle. Mo偶esz to zrobi za pomoc narzdzia do przechwytywania ruchu sieciowego, takiego jak Wireshark lub Burp Suite.

#### Krok 2: Analiza 偶dania POST

Po przechwyceniu 偶dania POST, musisz przeanalizowa jego zawarto w celu znalezienia potencjalnych danych uwierzytelniajcych bazy danych. Skup si na parametrach, kt贸re mog zawiera takie informacje, takich jak "username", "password" lub "db".

#### Krok 3: Testowanie danych uwierzytelniajcych

Po znalezieniu potencjalnych danych uwierzytelniajcych, mo偶esz przetestowa je, pr贸bujc si zalogowa do bazy danych. Mo偶esz to zrobi za pomoc narzdzi takich jak phpMyAdmin lub narzdzia wiersza polece, takie jak MySQL.

#### Krok 4: Wykorzystanie danych uwierzytelniajcych

Jeli dane uwierzytelniajce s poprawne, mo偶esz wykorzysta je do uzyskania dostpu do bazy danych Moodle. Mo偶esz przeglda, modyfikowa lub usuwa dane w bazie danych, w zale偶noci od uprawnie u偶ytkownika.

Pamitaj, 偶e przeprowadzanie test贸w penetracyjnych bez zgody waciciela systemu jest nielegalne. Wykonuj te techniki tylko na systemach, do kt贸rych masz uprawnienia i zgody.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Wydobd藕 dane uwierzytelniajce z bazy danych

To dump credentials from a Moodle database, you can follow these steps:

1. Identify the database credentials: Locate the Moodle configuration file (`config.php`) which contains the database connection details. Look for the variables `$CFG->dbuser` and `$CFG->dbpass` to find the username and password.

2. Connect to the database: Use the obtained credentials to connect to the Moodle database. You can use tools like phpMyAdmin or the command-line interface (CLI) to establish a connection.

3. Dump the user credentials: Once connected to the database, you can execute SQL queries to extract the user credentials. The relevant tables are usually `mdl_user` and `mdl_user_password_history`. Retrieve the necessary fields such as usernames and hashed passwords.

4. Decrypt the passwords (if necessary): If the passwords are stored in a hashed format, you may need to use techniques like rainbow tables or brute-force attacks to crack them. Tools like John the Ripper or Hashcat can assist in this process.

By following these steps, you can successfully dump credentials from a Moodle database during a penetration test. Remember to always obtain proper authorization before performing any hacking activities.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Jeli interesuje Ci **kariera hakera** i hakowanie nie do przebicia - **zatrudniamy!** (_wymagane biege posugiwanie si jzykiem polskim_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) **i** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repozytori贸w GitHub**.

</details>
