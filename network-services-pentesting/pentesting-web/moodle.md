# Moodle

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmaya Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

EÄŸer **hacking kariyeri** ile ilgileniyorsanÄ±z ve hacklenemez olanÄ± hacklemek istiyorsanÄ±z - **iÅŸe alÄ±yoruz!** (_akÄ±cÄ± LehÃ§e yazÄ±lÄ± ve sÃ¶zlÃ¼ gereklidir_).

{% embed url="https://www.stmcyber.com/careers" %}

## Otomatik Taramalar

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
#### moodlescan

`moodlescan` is a tool specifically designed for scanning Moodle installations. It can be used to identify vulnerabilities and misconfigurations in Moodle instances.

The tool performs various checks, including:

- Version detection: It identifies the version of Moodle being used, which can help in determining if any known vulnerabilities exist.
- Plugin enumeration: It lists all the installed plugins in the Moodle instance, which can help in identifying potential vulnerabilities associated with specific plugins.
- Directory enumeration: It scans for common directories and files that may contain sensitive information or configuration files.
- User enumeration: It attempts to enumerate valid usernames in the Moodle instance, which can be useful for further exploitation.
- Password brute-forcing: It can perform brute-force attacks to guess weak passwords of Moodle user accounts.

To use `moodlescan`, you need to provide the target Moodle URL and specify the desired scan options. The tool will then perform the specified checks and provide a report of any vulnerabilities or misconfigurations found.

It is important to note that `moodlescan` should only be used for ethical purposes, such as penetration testing or security auditing with proper authorization. Unauthorized use of this tool can lead to legal consequences.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap, bir iÃ§erik yÃ¶netim sistemi (CMS) keÅŸfetme ve sÄ±zma testi aracÄ±dÄ±r. Bu araÃ§, hedef web sitesinin hangi CMS'i kullandÄ±ÄŸÄ±nÄ± belirlemek iÃ§in farklÄ± teknikler kullanÄ±r. CMSMap, hedef sistemdeki zayÄ±f noktalarÄ± tespit etmek ve sÄ±zma testi yapmak iÃ§in kullanÄ±labilir.

#### Kurulum

CMSMap'i kurmak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyin:

1. Python'u yÃ¼kleyin (versiyon 2.7.x veya 3.x).
2. CMSMap'i indirin: `git clone https://github.com/Dionach/CMSmap.git`
3. Gerekli baÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼klemek iÃ§in aÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rÄ±n: `pip install -r requirements.txt`

#### KullanÄ±m

CMSMap'i kullanmak iÃ§in aÅŸaÄŸÄ±daki komutu kullanÄ±n:

```
python cmsmap.py -t <hedef URL>
```

`<hedef URL>` yerine hedef web sitesinin URL'sini girin. CMSMap, hedef web sitesinin hangi CMS'i kullandÄ±ÄŸÄ±nÄ± belirleyecek ve ilgili zayÄ±f noktalarÄ± tespit etmek iÃ§in otomatik olarak tarama yapacaktÄ±r.

#### Ã–rnek KullanÄ±m

AÅŸaÄŸÄ±daki Ã¶rnek, CMSMap'in nasÄ±l kullanÄ±lacaÄŸÄ±nÄ± gÃ¶stermektedir:

```
python cmsmap.py -t http://www.example.com
```

Bu komut, `http://www.example.com` adresindeki web sitesi iÃ§in CMS taramasÄ± yapacaktÄ±r. CMSMap, hedef web sitesinin hangi CMS'i kullandÄ±ÄŸÄ±nÄ± belirleyecek ve ilgili zayÄ±f noktalarÄ± tespit etmek iÃ§in otomatik olarak tarama yapacaktÄ±r.

#### SonuÃ§lar

CMSMap, tarama sonucunda elde edilen bilgileri ayrÄ±ntÄ±lÄ± bir ÅŸekilde sunar. Bu bilgiler, hedef web sitesinin hangi CMS'i kullandÄ±ÄŸÄ±nÄ±, CMS sÃ¼rÃ¼mÃ¼nÃ¼, kullanÄ±lan eklentileri ve diÄŸer ilgili bilgileri iÃ§erir. Bu bilgiler, sÄ±zma testi yaparken hedef sistemdeki zayÄ±f noktalarÄ± belirlemek iÃ§in kullanÄ±labilir.

#### CMSMap'in SÄ±nÄ±rlamalarÄ±

CMSMap, yalnÄ±zca hedef web sitesinin hangi CMS'i kullandÄ±ÄŸÄ±nÄ± belirlemek ve ilgili zayÄ±f noktalarÄ± tespit etmek iÃ§in kullanÄ±labilir. Bu araÃ§, hedef web sitesinin gÃ¼venlik aÃ§Ä±klarÄ±nÄ± otomatik olarak sÃ¶mÃ¼rmez veya sÄ±zma testi yapmaz. CMSMap'i kullanÄ±rken, elde edilen sonuÃ§larÄ± dikkatlice deÄŸerlendirmek ve manuel olarak sÄ±zma testi yapmak Ã¶nemlidir.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVE'ler

Otomatik araÃ§larÄ±n, moodle sÃ¼rÃ¼mÃ¼nÃ¼ etkileyen zafiyetleri bulmada oldukÃ§a **kullanÄ±ÅŸsÄ±z olduÄŸunu** tespit ettim. BunlarÄ± [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle) adresinden **kontrol edebilirsiniz**.

## **RCE**

**YÃ¶netici** rolÃ¼ne sahip olmanÄ±z ve **"Site yÃ¶netimi"** sekmesi iÃ§inde **eklentileri yÃ¼kleyebilmeniz gerekmektedir**:

![](<../../.gitbook/assets/image (447).png>)

YÃ¶netici olsanÄ±z bile, bu seÃ§eneÄŸi **etkinleÅŸtirmeniz gerekebilir**. Moodle ayrÄ±calÄ±k yÃ¼kseltme PoC'sinde nasÄ±l yapÄ±lacaÄŸÄ±nÄ± gÃ¶rebilirsiniz: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

ArdÄ±ndan, aÅŸaÄŸÄ±daki eklentiyi **yÃ¼kleyebilirsiniz**. Bu eklenti, klasik pentest-monkey php **rev shell**'i iÃ§ermektedir (_yÃ¼klemek iÃ§in Ã¶nce sÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ dosyayÄ± aÃ§manÄ±z, revshell'in IP ve portunu deÄŸiÅŸtirmeniz ve tekrar sÄ±kÄ±ÅŸtÄ±rmanÄ±z gerekmektedir_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

Veya "cmd" parametresiyle dÃ¼zenli bir PHP shell elde etmek iÃ§in [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) adresindeki eklentiyi kullanabilirsiniz.

KÃ¶tÃ¼ amaÃ§lÄ± eklentiyi baÅŸlatmak iÃ§in aÅŸaÄŸÄ±daki adrese eriÅŸmeniz gerekmektedir:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
### VeritabanÄ± Kimlik Bilgilerini Bulma

Bir Moodle uygulamasÄ±nÄ± hedef aldÄ±ÄŸÄ±nÄ±zda, veritabanÄ± kimlik bilgilerini bulmak, hedef sisteme eriÅŸim saÄŸlamak iÃ§in Ã¶nemli bir adÄ±mdÄ±r. Bu kimlik bilgileri, Moodle uygulamasÄ±nÄ±n veritabanÄ±na eriÅŸmek iÃ§in kullanÄ±lan kullanÄ±cÄ± adÄ± ve ÅŸifreyi iÃ§erir.

VeritabanÄ± kimlik bilgilerini bulmak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. Ä°lk olarak, hedef Moodle uygulamasÄ±nÄ±n web sayfasÄ±nÄ± inceleyin ve kaynak kodunu kontrol edin. Bu sayede, veritabanÄ± kimlik bilgilerinin doÄŸrudan kaynak kodunda yer alÄ±p almadÄ±ÄŸÄ±nÄ± kontrol edebilirsiniz.

2. EÄŸer veritabanÄ± kimlik bilgileri kaynak kodunda bulunmuyorsa, hedef sistemin konfigÃ¼rasyon dosyalarÄ±nÄ± kontrol edin. Moodle uygulamasÄ±nÄ±n genellikle `config.php` adÄ±nda bir konfigÃ¼rasyon dosyasÄ± bulunur. Bu dosyayÄ± inceleyerek, veritabanÄ± kimlik bilgilerini bulabilirsiniz.

3. KonfigÃ¼rasyon dosyasÄ±nda veritabanÄ± kimlik bilgilerini bulamazsanÄ±z, hedef sistemin diÄŸer dosyalarÄ±nÄ± kontrol edin. Ã–zellikle, Moodle uygulamasÄ±nÄ±n yÃ¼klendiÄŸi dizindeki `config.php` dosyasÄ±nÄ± kontrol edin. Bu dosya, veritabanÄ± kimlik bilgilerini iÃ§erebilir.

VeritabanÄ± kimlik bilgilerini bulduktan sonra, bu bilgileri kullanarak hedef sisteme eriÅŸim saÄŸlayabilir ve gerekli iÅŸlemleri gerÃ§ekleÅŸtirebilirsiniz. Ancak, bu iÅŸlemi yasal ve etik sÄ±nÄ±rlar iÃ§inde gerÃ§ekleÅŸtirmeniz Ã¶nemlidir.
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### VeritabanÄ±ndan Kimlik Bilgilerini Ã‡ekme

Bir Moodle uygulamasÄ± Ã¼zerinde Ã§alÄ±ÅŸÄ±rken, hedefin veritabanÄ±na eriÅŸim saÄŸlamak ve kimlik bilgilerini Ã§ekmek isteyebilirsiniz. Bu, hedefin kullanÄ±cÄ± adlarÄ± ve ÅŸifreler gibi hassas bilgilerini elde etmenizi saÄŸlar.

Bu iÅŸlemi gerÃ§ekleÅŸtirmek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. Ä°lk olarak, hedefin Moodle uygulamasÄ±nÄ±n veritabanÄ± bilgilerini elde etmeniz gerekmektedir. Bu bilgiler genellikle Moodle'nin yapÄ±landÄ±rma dosyasÄ±nda bulunur. Dosya genellikle `config.php` olarak adlandÄ±rÄ±lÄ±r ve Moodle uygulamasÄ±nÄ±n ana dizininde yer alÄ±r.

2. VeritabanÄ± bilgilerini elde ettikten sonra, bir veritabanÄ± yÃ¶netim aracÄ± kullanarak hedefin veritabanÄ±na baÄŸlanabilirsiniz. Ã–rneÄŸin, phpMyAdmin veya MySQL komut satÄ±rÄ± aracÄ±nÄ± kullanabilirsiniz.

3. VeritabanÄ±na baÄŸlandÄ±ktan sonra, kullanÄ±cÄ± tablosunu araÅŸtÄ±rabilirsiniz. Moodle'de kullanÄ±cÄ±lar genellikle `mdl_user` tablosunda saklanÄ±r. Bu tabloyu inceleyerek kullanÄ±cÄ± adlarÄ± ve ÅŸifreler gibi kimlik bilgilerini bulabilirsiniz.

4. Kimlik bilgilerini Ã§ekmek iÃ§in SQL sorgularÄ±nÄ± kullanabilirsiniz. Ã–rneÄŸin, aÅŸaÄŸÄ±daki sorgu kullanÄ±cÄ± adÄ± ve ÅŸifreleri Ã§ekmek iÃ§in kullanÄ±labilir:

   ```sql
   SELECT username, password FROM mdl_user;
   ```

   Bu sorguyu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda, kullanÄ±cÄ± adlarÄ± ve ÅŸifreler gibi kimlik bilgileri sonuÃ§ olarak dÃ¶necektir.

5. Elde ettiÄŸiniz kimlik bilgilerini kullanarak hedefin Moodle uygulamasÄ±na eriÅŸebilirsiniz. Bu, hedefin hesaplarÄ±na yetkisiz eriÅŸim saÄŸlamanÄ±za olanak tanÄ±r.

Bu iÅŸlemi gerÃ§ekleÅŸtirirken dikkatli olmanÄ±z Ã¶nemlidir. Yasal izinler olmadan veya yetkisiz eriÅŸim saÄŸlamadan baÅŸka bir kiÅŸinin veritabanÄ±na eriÅŸmek yasa dÄ±ÅŸÄ±dÄ±r ve ciddi sonuÃ§lara yol aÃ§abilir. Bu nedenle, her zaman yasal ve etik sÄ±nÄ±rlar iÃ§inde Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±zdan emin olun.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

EÄŸer **hacking kariyeri** ile ilgileniyorsanÄ±z ve hacklenemez olanÄ± hacklemek istiyorsanÄ±z - **iÅŸe alÄ±yoruz!** (_akÄ±cÄ± polonyaca yazÄ±lÄ± ve konuÅŸma becerisi gereklidir_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hacklemeyi Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
