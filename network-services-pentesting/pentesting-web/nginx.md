# Nginx

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="../../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conferenceæ˜¯ä¸€åœºå›½é™…ç½‘ç»œå®‰å…¨æ´»åŠ¨**](https://www.dragonjarcon.org/)ï¼Œå°†äº2023å¹´9æœˆ7æ—¥è‡³8æ—¥åœ¨å“¥ä¼¦æ¯”äºšæ³¢å“¥å¤§ä¸¾è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªå†…å®¹ä¸°å¯Œçš„æŠ€æœ¯æ´»åŠ¨ï¼Œå±•ç¤ºäº†å¸å¼•å…¨çƒé»‘å®¢å’Œç ”ç©¶äººå‘˜çš„æœ€æ–°ç ”ç©¶æˆæœã€‚\
ç«‹å³åœ¨ä»¥ä¸‹é“¾æ¥æ³¨å†Œï¼Œä¸è¦é”™è¿‡è¿™ä¸ªé‡è¦çš„ä¼šè®®ï¼:

{% embed url="https://www.dragonjarcon.org/" %}

## ç¼ºå°‘æ ¹ä½ç½® <a href="#missing-root-location" id="missing-root-location"></a>
```
server {
root /etc/nginx;

location /hello.txt {
try_files $uri $uri/ =404;
proxy_pass http://127.0.0.1:8080/;
}
}
```
`root`æŒ‡ä»¤æŒ‡å®šäº†Nginxçš„æ ¹æ–‡ä»¶å¤¹ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ ¹æ–‡ä»¶å¤¹æ˜¯`/etc/nginx`ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è®¿é—®è¯¥æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ã€‚ä¸Šé¢çš„é…ç½®æ²¡æœ‰é’ˆå¯¹`/ (location / {...})`çš„ä½ç½®ï¼Œåªæœ‰é’ˆå¯¹`/hello.txt`çš„ä½ç½®ã€‚å› æ­¤ï¼Œ`root`æŒ‡ä»¤å°†è¢«å…¨å±€è®¾ç½®ï¼Œè¿™æ„å‘³ç€å¯¹`/`çš„è¯·æ±‚å°†å¸¦æ‚¨åˆ°æœ¬åœ°è·¯å¾„`/etc/nginx`ã€‚

ä¸€ä¸ªç®€å•çš„è¯·æ±‚ï¼Œæ¯”å¦‚`GET /nginx.conf`ï¼Œå°†æ˜¾ç¤ºå­˜å‚¨åœ¨`/etc/nginx/nginx.conf`ä¸­çš„Nginxé…ç½®æ–‡ä»¶çš„å†…å®¹ã€‚å¦‚æœæ ¹ç›®å½•è®¾ç½®ä¸º`/etc`ï¼Œå¯¹`/nginx/nginx.conf`çš„`GET`è¯·æ±‚å°†æ˜¾ç¤ºé…ç½®æ–‡ä»¶ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½å¯ä»¥è®¿é—®å…¶ä»–é…ç½®æ–‡ä»¶ã€è®¿é—®æ—¥å¿—ç”šè‡³åŠ å¯†çš„HTTPåŸºæœ¬èº«ä»½éªŒè¯å‡­æ®ã€‚

## åˆ«åLFIé…ç½®é”™è¯¯ <a href="#alias-lfi-misconfiguration" id="alias-lfi-misconfiguration"></a>

åœ¨Nginxé…ç½®ä¸­æŸ¥æ‰¾"location"è¯­å¥ï¼Œå¦‚æœæœ‰ç±»ä¼¼ä»¥ä¸‹çš„è¯­å¥ï¼š
```
location /imgs {
alias /path/images/;
}
```
å› ä¸ºå­˜åœ¨LFIæ¼æ´ï¼ŒåŸå› å¦‚ä¸‹ï¼š
```
/imgs../flag.txt
```
ä»¥ä¸‹æ˜¯ä¸€æœ¬å…³äºé»‘å®¢æŠ€æœ¯çš„ä¹¦ç±ä¸­å…³äºé»‘å®¢æŠ€æœ¯çš„å†…å®¹ã€‚ä»¥ä¸‹å†…å®¹æ¥è‡ªæ–‡ä»¶/hive/hacktricks/network-services-pentesting/pentesting-web/nginx.mdã€‚å°†ç›¸å…³çš„è‹±æ–‡æ–‡æœ¬ç¿»è¯‘æˆä¸­æ–‡ï¼Œå¹¶ä¿æŒå®Œå…¨ç›¸åŒçš„markdownå’Œhtmlè¯­æ³•ã€‚ä¸è¦ç¿»è¯‘ä»£ç ã€é»‘å®¢æŠ€æœ¯åç§°ã€é»‘å®¢æœ¯è¯­ã€äº‘/SaaSå¹³å°åç§°ï¼ˆå¦‚Workspaceã€awsã€gcp...ï¼‰ã€æ³„æ¼ä¸€è¯ã€æ¸—é€æµ‹è¯•å’Œmarkdownæ ‡ç­¾ã€‚æ­¤å¤–ï¼Œè¯·ä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„å†…å®¹ï¼Œåªéœ€ç¿»è¯‘å’Œmarkdownè¯­æ³•ã€‚
```
/path/images/../flag.txt
```
æ­£ç¡®çš„é…ç½®åº”è¯¥æ˜¯ï¼š
```
location /imgs/ {
alias /path/images/;
}
```
**æ‰€ä»¥ï¼Œå¦‚æœä½ å‘ç°äº†ä¸€äº›NginxæœåŠ¡å™¨ï¼Œä½ åº”è¯¥æ£€æŸ¥è¿™ä¸ªæ¼æ´ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ å‘ç°æ–‡ä»¶/ç›®å½•æš´åŠ›ç ´è§£çš„è¡Œä¸ºå¼‚å¸¸ï¼Œä¹Ÿå¯èƒ½æ˜¯è¿™ä¸ªæ¼æ´ã€‚**

æ›´å¤šä¿¡æ¯ï¼š[https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/](https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/)

Accunetixæµ‹è¯•ï¼š
```
alias../ => HTTP status code 403
alias.../ => HTTP status code 404
alias../../ => HTTP status code 403
alias../../../../../../../../../../../ => HTTP status code 400
alias../ => HTTP status code 403
```
## ä¸å®‰å…¨çš„å˜é‡ä½¿ç”¨ <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

ä¸€ä¸ªæ˜“å—æ”»å‡»çš„Nginxé…ç½®ç¤ºä¾‹æ˜¯ï¼š
```
location / {
return 302 https://example.com$uri;
}
```
HTTPè¯·æ±‚çš„æ¢è¡Œç¬¦æ˜¯\rï¼ˆå›è½¦ï¼‰å’Œ\nï¼ˆæ¢è¡Œï¼‰ã€‚å¯¹æ¢è¡Œç¬¦è¿›è¡ŒURLç¼–ç ä¼šå¾—åˆ°ä»¥ä¸‹å­—ç¬¦çš„è¡¨ç¤ºï¼š%0d%0aã€‚å½“è¿™äº›å­—ç¬¦åŒ…å«åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œä¾‹å¦‚`http://localhost/%0d%0aDetectify:%20clrf`å‘é€åˆ°ä¸€ä¸ªå­˜åœ¨é…ç½®é”™è¯¯çš„æœåŠ¡å™¨æ—¶ï¼Œç”±äº$uriå˜é‡åŒ…å«URLè§£ç çš„æ¢è¡Œç¬¦ï¼ŒæœåŠ¡å™¨å°†ä¼šå“åº”ä¸€ä¸ªåä¸º`Detectify`çš„æ–°å¤´éƒ¨ã€‚
```
HTTP/1.1 302 Moved Temporarily
Server: nginx/1.19.3
Content-Type: text/html
Content-Length: 145
Connection: keep-alive
Location: https://example.com/
Detectify: clrf
```
äº†è§£CRLFæ³¨å…¥å’Œå“åº”æ‹†åˆ†çš„é£é™©ï¼Œè¯·è®¿é—®[https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/](https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/)ã€‚

### ä»»æ„å˜é‡

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·æä¾›çš„æ•°æ®å¯ä»¥è¢«è§†ä¸ºNginxå˜é‡ã€‚ç›®å‰å°šä¸æ¸…æ¥šä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œä½†è¿™å¹¶ä¸ç½•è§ï¼Œä¹Ÿä¸å®¹æ˜“æµ‹è¯•ï¼Œæ­£å¦‚åœ¨è¿™ä»½[H1æŠ¥å‘Š](https://hackerone.com/reports/370094)ä¸­æ‰€ç¤ºã€‚å¦‚æœæˆ‘ä»¬æœç´¢é”™è¯¯æ¶ˆæ¯ï¼Œå¯ä»¥çœ‹åˆ°å®ƒåœ¨[SSIè¿‡æ»¤æ¨¡å—](https://github.com/nginx/nginx/blob/2187586207e1465d289ae64cedc829719a048a39/src/http/modules/ngx\_http\_ssi\_filter\_module.c#L365)ä¸­æ‰¾åˆ°ï¼Œå› æ­¤æ­ç¤ºäº†è¿™æ˜¯ç”±SSIå¼•èµ·çš„ã€‚

æµ‹è¯•è¿™ç§æƒ…å†µçš„ä¸€ç§æ–¹æ³•æ˜¯è®¾ç½®ä¸€ä¸ªrefererå¤´çš„å€¼ï¼š
```
$ curl -H â€˜Referer: barâ€™ http://localhost/foo$http_referer | grep â€˜foobarâ€™
```
æˆ‘ä»¬æ‰«æäº†è¿™ä¸ªé…ç½®é”™è¯¯ï¼Œå¹¶å‘ç°äº†å‡ ä¸ªç”¨æˆ·å¯ä»¥æ‰“å°Nginxå˜é‡å€¼çš„å®ä¾‹ã€‚å‘ç°çš„æ˜“å—æ”»å‡»å®ä¾‹æ•°é‡æœ‰æ‰€å‡å°‘ï¼Œè¿™å¯èƒ½è¡¨æ˜å·²ç»ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ã€‚

## è¯»å–åŸå§‹åç«¯å“åº”

ä½¿ç”¨Nginxçš„`proxy_pass`ï¼Œæœ‰å¯èƒ½æ‹¦æˆªç”±åç«¯åˆ›å»ºçš„é”™è¯¯å’ŒHTTPå¤´ã€‚å¦‚æœæ‚¨æƒ³éšè—å†…éƒ¨é”™è¯¯æ¶ˆæ¯å’Œå¤´éƒ¨ï¼Œä»¥ä¾¿ç”±Nginxå¤„ç†ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚å¦‚æœåç«¯è¿”å›è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼ŒNginxå°†è‡ªåŠ¨æä¾›è¯¥é¡µé¢ã€‚ä½†æ˜¯ï¼Œå¦‚æœNginxæ— æ³•ç†è§£å®ƒæ˜¯ä¸€ä¸ªHTTPå“åº”å‘¢ï¼Ÿ

å¦‚æœå®¢æˆ·ç«¯å‘Nginxå‘é€æ— æ•ˆçš„HTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚å°†åŸæ ·è½¬å‘ç»™åç«¯ï¼Œåç«¯å°†ä»¥å…¶åŸå§‹å†…å®¹å›ç­”ã€‚ç„¶åï¼ŒNginxå°†æ— æ³•ç†è§£æ— æ•ˆçš„HTTPå“åº”ï¼Œåªä¼šå°†å…¶è½¬å‘ç»™å®¢æˆ·ç«¯ã€‚æƒ³è±¡ä¸€ä¸ªåƒè¿™æ ·çš„uWSGIåº”ç”¨ç¨‹åºï¼š
```python
def application(environ, start_response):
start_response('500 Error', [('Content-Type',
'text/html'),('Secret-Header','secret-info')])
return [b"Secret info, should not be visible!"]
```
è€Œä¸”ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤åœ¨Nginxä¸­ï¼š
```
http {
error_page 500 /html/error.html;
proxy_intercept_errors on;
proxy_hide_header Secret-Header;
}
```
[proxy\_intercept\_errors](http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html#proxy\_intercept\_errors)ä¼šåœ¨åç«¯è¿”å›çš„å“åº”çŠ¶æ€ç å¤§äº300æ—¶æä¾›è‡ªå®šä¹‰å“åº”ã€‚åœ¨ä¸Šé¢çš„uWSGIåº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å°†å‘é€ä¸€ä¸ª`500é”™è¯¯`ï¼Œè¿™å°†è¢«Nginxæ‹¦æˆªã€‚

[proxy\_hide\_header](http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html#proxy\_hide\_header)éå¸¸ç›´è§‚ï¼Œå®ƒå°†éšè—å®¢æˆ·ç«¯ä¸­æŒ‡å®šçš„ä»»ä½•HTTPå¤´ã€‚

å¦‚æœæˆ‘ä»¬å‘é€ä¸€ä¸ªæ™®é€šçš„`GET`è¯·æ±‚ï¼ŒNginxå°†è¿”å›ï¼š
```
HTTP/1.1 500 Internal Server Error
Server: nginx/1.10.3
Content-Type: text/html
Content-Length: 34
Connection: close
```
ä½†æ˜¯å¦‚æœæˆ‘ä»¬å‘é€ä¸€ä¸ªæ— æ•ˆçš„HTTPè¯·æ±‚ï¼Œæ¯”å¦‚ï¼š
```
GET /? XTTP/1.1
Host: 127.0.0.1
Connection: close
```
æˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹å“åº”ï¼š
```
XTTP/1.1 500 Error
Content-Type: text/html
Secret-Header: secret-info

Secret info, should not be visible!
```
## merge\_slashes è®¾ç½®ä¸º off

[merge\_slashes](http://nginx.org/en/docs/http/ngx\_http\_core\_module.html#merge\_slashes) æŒ‡ä»¤é»˜è®¤è®¾ç½®ä¸º "on"ï¼Œå®ƒæ˜¯ä¸€ç§å°†ä¸¤ä¸ªæˆ–å¤šä¸ªæ­£æ–œæ å‹ç¼©ä¸ºä¸€ä¸ªæ­£æ–œæ çš„æœºåˆ¶ï¼Œå› æ­¤ `///` å°†å˜ä¸º `/`ã€‚å¦‚æœ Nginx ç”¨ä½œåå‘ä»£ç†ï¼Œå¹¶ä¸”è¢«ä»£ç†çš„åº”ç”¨ç¨‹åºå®¹æ˜“å—åˆ°æœ¬åœ°æ–‡ä»¶åŒ…å«çš„æ”»å‡»ï¼Œé‚£ä¹ˆåœ¨è¯·æ±‚ä¸­ä½¿ç”¨é¢å¤–çš„æ–œæ å¯èƒ½ä¼šä¸ºæ”»å‡»ç•™ä¸‹æ¼æ´ã€‚è¿™ä¸€ç‚¹ç”± [Danny Robinson å’Œ Rotem Bar](https://medium.com/appsflyer/nginx-may-be-protecting-your-applications-from-traversal-attacks-without-you-even-knowing-b08f882fd43d) è¯¦ç»†æè¿°ã€‚

æˆ‘ä»¬å‘ç°äº† 33 ä¸ª Nginx é…ç½®æ–‡ä»¶å°† `merge_slashes` è®¾ç½®ä¸º "off"ã€‚

## map æŒ‡ä»¤æœªæŒ‡å®šé»˜è®¤å€¼

è¿™ä¼¼ä¹æ˜¯ä¸€ç§å¸¸è§æƒ…å†µï¼Œå½“ **`map` ç”¨äºæŸç§æˆæƒæ§åˆ¶** æ—¶ã€‚ç®€åŒ–çš„ç¤ºä¾‹å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```
http {
...
map $uri $mappocallow {
/map-poc/private 0;
/map-poc/secret 0;
/map-poc/public 1;
}
...
}
```

```
server {
...
location /map-poc {
if ($mappocallow = 0) {return 403;}
return 200 "Hello. It is private area: $mappocallow";
}
...
}
```
[æ ¹æ®æ‰‹å†Œ](https://nginx.org/en/docs/http/ngx\_http\_map\_module.html):

> é»˜è®¤å€¼\
> å¦‚æœæºå€¼ä¸æŒ‡å®šçš„å˜é‡éƒ½ä¸åŒ¹é…ï¼Œåˆ™è®¾ç½®ç»“æœå€¼ã€‚å½“æœªæŒ‡å®šé»˜è®¤å€¼æ—¶ï¼Œé»˜è®¤çš„ç»“æœå€¼å°†ä¸ºç©ºå­—ç¬¦ä¸²ã€‚

å¾ˆå®¹æ˜“å¿˜è®° `default` å€¼ã€‚æ‰€ä»¥**æ¶æ„ç”¨æˆ·å¯ä»¥ç»•è¿‡è¿™ä¸ª "æˆæƒæ§åˆ¶"**ï¼Œåªéœ€è®¿é—® `/map-poc` ä¸­ä¸å­˜åœ¨çš„æƒ…å†µï¼Œæ¯”å¦‚ `https://targethost.com/map-poc/another-private-area`ã€‚

## Nginx DNSæ¬ºéª—

æ ¹æ®è¿™ç¯‡æ–‡ç« ï¼š[http://blog.zorinaq.com/nginx-resol**ver-vulns/**](http://blog.zorinaq.com/nginx-resolver-vulns/)ï¼Œå¦‚æœä½ **çŸ¥é“Nginxä½¿ç”¨çš„DNSæœåŠ¡å™¨**ï¼ˆå¹¶ä¸”ä½ å¯ä»¥æ‹¦æˆªé€šä¿¡ï¼‰ï¼Œé‚£ä¹ˆ**å¯èƒ½å¯ä»¥æ¬ºéª—Nginxçš„DNSè®°å½•**ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨çš„æ˜¯**127.0.0.1**ï¼Œåˆ™æ— æ•ˆï¼Œå¹¶ä¸”çŸ¥é“å®ƒæ­£åœ¨è¯·æ±‚çš„**åŸŸå**ã€‚

Nginxå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æŒ‡å®šè¦ä½¿ç”¨çš„DNSæœåŠ¡å™¨ï¼š
```
resolver     8.8.8.8;
```
## `proxy_pass`å’Œ`internal`æŒ‡ä»¤

**`proxy_pass`**æŒ‡ä»¤å¯ç”¨äºå°†å†…éƒ¨è¯·æ±‚é‡å®šå‘åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œæ— è®ºæ˜¯å†…éƒ¨è¿˜æ˜¯å¤–éƒ¨ã€‚\
**`internal`**æŒ‡ä»¤ç”¨äºæ˜ç¡®å‘ŠçŸ¥Nginxè¯¥ä½ç½®åªèƒ½åœ¨å†…éƒ¨è®¿é—®ã€‚

ä½¿ç”¨è¿™äº›æŒ‡ä»¤**å¹¶ä¸æ˜¯ä¸€ä¸ªæ¼æ´ï¼Œä½†ä½ åº”è¯¥æ£€æŸ¥å®ƒä»¬çš„é…ç½®æ–¹å¼**ã€‚

## proxy\_set\_header Upgrade & Connection

å¦‚æœnginxæœåŠ¡å™¨é…ç½®ä¸ºä¼ é€’Upgradeå’ŒConnectionå¤´ï¼Œåˆ™å¯ä»¥æ‰§è¡Œ[h2c Smugglingæ”»å‡»](../../pentesting-web/h2c-smuggling.md)ä»¥è®¿é—®å—ä¿æŠ¤/å†…éƒ¨çš„ç«¯ç‚¹ã€‚

{% hint style="danger" %}
æ­¤æ¼æ´å°†å…è®¸æ”»å‡»è€…ä¸`proxy_pass`ç«¯ç‚¹ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º`http://backend:9999`ï¼‰å»ºç«‹ç›´æ¥è¿æ¥ï¼Œnginxä¸ä¼šæ£€æŸ¥å…¶å†…å®¹ã€‚
{% endhint %}

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ˜“å—æ”»å‡»é…ç½®çš„ç¤ºä¾‹ï¼Œç”¨äºä»[æ­¤å¤„](https://bishopfox.com/blog/h2c-smuggling-request)çªƒå–`/flag`ï¼š
```
server {
listen       443 ssl;
server_name  localhost;

ssl_certificate       /usr/local/nginx/conf/cert.pem;
ssl_certificate_key   /usr/local/nginx/conf/privkey.pem;

location / {
proxy_pass http://backend:9999;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection $http_connection;
}

location /flag {
deny all;
}
```
{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œå³ä½¿`proxy_pass`æŒ‡å‘ç‰¹å®šçš„**è·¯å¾„**ï¼Œä¾‹å¦‚`http://backend:9999/socket.io`ï¼Œè¿æ¥ä¹Ÿå°†ä¸`http://backend:9999`å»ºç«‹ï¼Œå› æ­¤æ‚¨å¯ä»¥**åœ¨è¯¥å†…éƒ¨ç«¯ç‚¹å†…è”ç³»ä»»ä½•å…¶ä»–è·¯å¾„ã€‚å› æ­¤ï¼Œåœ¨proxy\_passçš„URLä¸­æŒ‡å®šè·¯å¾„å¹¶ä¸é‡è¦ã€‚**
{% endhint %}

## äº²è‡ªå°è¯•

Detectifyåˆ›å»ºäº†ä¸€ä¸ªGitHubå­˜å‚¨åº“ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Dockerè®¾ç½®è‡ªå·±çš„æ˜“å—æ”»å‡»çš„Nginxæµ‹è¯•æœåŠ¡å™¨ï¼Œå¹¶å°è¯•æ‰¾åˆ°æœ¬æ–‡ä¸­è®¨è®ºçš„ä¸€äº›é…ç½®é”™è¯¯ï¼

[https://github.com/detectify/vulnerable-nginx](https://github.com/detectify/vulnerable-nginx)

## é™æ€åˆ†æå·¥å…·

### [GIXY](https://github.com/yandex/gixy)

Gixyæ˜¯ä¸€ä¸ªç”¨äºåˆ†æNginxé…ç½®çš„å·¥å…·ã€‚Gixyçš„ä¸»è¦ç›®æ ‡æ˜¯é˜²æ­¢å®‰å…¨é…ç½®é”™è¯¯å¹¶è‡ªåŠ¨æ£€æµ‹ç¼ºé™·ã€‚

### [Nginxpwner](https://github.com/stark0de/nginxpwner)

Nginxpwneræ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œç”¨äºæŸ¥æ‰¾å¸¸è§çš„Nginxé…ç½®é”™è¯¯å’Œæ¼æ´ã€‚

## å‚è€ƒèµ„æ–™

* [**https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/**](https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/)
* [**http://blog.zorinaq.com/nginx-resolver-vulns/**](http://blog.zorinaq.com/nginx-resolver-vulns/)
* [**https://github.com/yandex/gixy/issues/115**](https://github.com/yandex/gixy/issues/115)

<figure><img src="../../.gitbook/assets/image (1) (1) (2) (4).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conference es un evento internacional de ciberseguridad**](https://www.dragonjarcon.org/) con mÃ¡s de una dÃ©cada que se celebrarÃ¡ el 7 y 8 de septiembre de 2023 en BogotÃ¡, Colombia. Es un evento de gran contenido tÃ©cnico donde se presentan las Ãºltimas investigaciones en espaÃ±ol que atrae a hackers e investigadores de todo el mundo.\
Â¡RegÃ­strate ahora en el siguiente enlace y no te pierdas esta gran conferencia!:

{% embed url="https://www.dragonjarcon.org/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Join the** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **and** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
