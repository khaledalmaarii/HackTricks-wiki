# Nginx

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**å³æ—¶æä¾›çš„æ¼æ´è¯„ä¼°å’Œæ¸—é€æµ‹è¯•è®¾ç½®**ã€‚ä»ä»»ä½•åœ°æ–¹è¿è¡Œå®Œæ•´çš„æ¸—é€æµ‹è¯•ï¼Œä½¿ç”¨20å¤šç§å·¥å…·å’ŒåŠŸèƒ½ï¼Œä»ä¾¦å¯Ÿåˆ°æŠ¥å‘Šã€‚æˆ‘ä»¬ä¸å–ä»£æ¸—é€æµ‹è¯•äººå‘˜ - æˆ‘ä»¬å¼€å‘å®šåˆ¶å·¥å…·ã€æ£€æµ‹å’Œåˆ©ç”¨æ¨¡å—ï¼Œè®©ä»–ä»¬æœ‰æ›´å¤šæ—¶é—´æ·±å…¥æŒ–æ˜ã€å¼¹å‡ºshellå¹¶äº«å—ä¹è¶£ã€‚

{% embed url="https://pentest-tools.com/" %}

## ç¼ºå°‘æ ¹ä½ç½® <a href="#missing-root-location" id="missing-root-location"></a>

## **é…ç½®Nginxæ ¹ç›®å½•çš„åŸºæœ¬è¦ç‚¹**

åœ¨é…ç½®NginxæœåŠ¡å™¨æ—¶ï¼Œ**rootæŒ‡ä»¤**èµ·ç€å…³é”®ä½œç”¨ï¼Œå®šä¹‰äº†æ–‡ä»¶æä¾›æœåŠ¡çš„åŸºæœ¬ç›®å½•ã€‚è¯·è€ƒè™‘ä¸‹é¢çš„ç¤ºä¾‹ï¼š
```bash
server {
root /etc/nginx;

location /hello.txt {
try_files $uri $uri/ =404;
proxy_pass http://127.0.0.1:8080/;
}
}
```
åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼Œ`/etc/nginx` è¢«æŒ‡å®šä¸ºæ ¹ç›®å½•ã€‚è¿™ç§è®¾ç½®å…è®¸è®¿é—®æŒ‡å®šæ ¹ç›®å½•å†…çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ `/hello.txt`ã€‚ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åªå®šä¹‰äº†ç‰¹å®šä½ç½® (`/hello.txt`)ï¼Œå¹¶æ²¡æœ‰é…ç½®æ ¹ä½ç½® (`location / {...}`)ã€‚è¿™ä¸ªé—æ¼æ„å‘³ç€æ ¹æŒ‡ä»¤å…¨å±€é€‚ç”¨ï¼Œä½¿å¾—å¯¹æ ¹è·¯å¾„ `/` çš„è¯·æ±‚å¯ä»¥è®¿é—® `/etc/nginx` ä¸‹çš„æ–‡ä»¶ã€‚

è¿™ç§é…ç½®å¸¦æ¥äº†ä¸€ä¸ªå…³é”®çš„å®‰å…¨è€ƒè™‘ã€‚ä¸€ä¸ªç®€å•çš„ `GET` è¯·æ±‚ï¼Œæ¯”å¦‚ `GET /nginx.conf`ï¼Œå¯èƒ½é€šè¿‡æä¾›ä½äº `/etc/nginx/nginx.conf` çš„ Nginx é…ç½®æ–‡ä»¶æ¥æš´éœ²æ•æ„Ÿä¿¡æ¯ã€‚å°†æ ¹ç›®å½•è®¾ç½®ä¸ºä¸€ä¸ªä¸å¤ªæ•æ„Ÿçš„ç›®å½•ï¼Œæ¯”å¦‚ `/etc`ï¼Œå¯ä»¥å‡è½»è¿™ç§é£é™©ï¼Œä½†ä»å¯èƒ½å…è®¸æ„å¤–è®¿é—®å…¶ä»–å…³é”®æ–‡ä»¶ï¼ŒåŒ…æ‹¬å…¶ä»–é…ç½®æ–‡ä»¶ã€è®¿é—®æ—¥å¿—ï¼Œç”šè‡³ç”¨äº HTTP åŸºæœ¬è®¤è¯çš„åŠ å¯†å‡­æ®ã€‚

## åˆ«å LFI é…ç½®é”™è¯¯ <a href="#alias-lfi-misconfiguration" id="alias-lfi-misconfiguration"></a>

åœ¨ Nginx çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œéœ€è¦ä»”ç»†æ£€æŸ¥ "location" æŒ‡ä»¤ã€‚ä¸€ä¸ªç§°ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å« (LFI) çš„æ¼æ´å¯èƒ½ä¼šé€šè¿‡ç±»ä¼¼ä»¥ä¸‹é…ç½®è€Œä¸ç»æ„åœ°å¼•å…¥ï¼š
```
location /imgs {
alias /path/images/;
}
```
è¿™ç§é…ç½®å®¹æ˜“å—åˆ°LFIæ”»å‡»ï¼Œå› ä¸ºæœåŠ¡å™¨ä¼šå°†ç±»ä¼¼`/imgs../flag.txt`çš„è¯·æ±‚è§£é‡Šä¸ºè¯•å›¾è®¿é—®é¢„æœŸç›®å½•ä¹‹å¤–çš„æ–‡ä»¶ï¼Œæœ€ç»ˆè§£æä¸º`/path/images/../flag.txt`ã€‚è¿™ä¸ªæ¼æ´å…è®¸æ”»å‡»è€…ä»æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­æ£€ç´¢æœ¬ä¸åº”é€šè¿‡ç½‘ç»œè®¿é—®çš„æ–‡ä»¶ã€‚

ä¸ºäº†å‡è½»è¿™ç§æ¼æ´ï¼Œåº”è°ƒæ•´é…ç½®ä¸ºï¼š
```
location /imgs/ {
alias /path/images/;
}
```
æ›´å¤šä¿¡æ¯: [https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/](https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/)

Accunetix æµ‹è¯•:
```
alias../ => HTTP status code 403
alias.../ => HTTP status code 404
alias../../ => HTTP status code 403
alias../../../../../../../../../../../ => HTTP status code 400
alias../ => HTTP status code 403
```
## ä¸å®‰å…¨çš„è·¯å¾„é™åˆ¶ <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

æŸ¥çœ‹ä»¥ä¸‹é¡µé¢ä»¥äº†è§£å¦‚ä½•ç»•è¿‡è¯¸å¦‚ï¼š
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
## ä¸å®‰å…¨çš„å˜é‡ä½¿ç”¨ <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†Nginxé…ç½®ä¸­çš„ä¸€ä¸ªæ¼æ´ï¼š
```
location / {
return 302 https://example.com$uri;
}
```
å­—ç¬¦\rï¼ˆå›è½¦ï¼‰å’Œ\nï¼ˆæ¢è¡Œï¼‰è¡¨ç¤ºHTTPè¯·æ±‚ä¸­çš„æ¢è¡Œå­—ç¬¦ï¼Œå®ƒä»¬çš„URLç¼–ç å½¢å¼è¡¨ç¤ºä¸º`%0d%0a`ã€‚åœ¨è¯·æ±‚ä¸­åŒ…å«è¿™äº›å­—ç¬¦ï¼ˆä¾‹å¦‚ï¼Œ`http://localhost/%0d%0aDetectify:%20clrf`ï¼‰å‘é€åˆ°é…ç½®é”™è¯¯çš„æœåŠ¡å™¨ä¼šå¯¼è‡´æœåŠ¡å™¨å‘å‡ºä¸€ä¸ªåä¸º`Detectify`çš„æ–°æ ‡å¤´ã€‚è¿™æ˜¯å› ä¸º$uriå˜é‡è§£ç äº†URLç¼–ç çš„æ¢è¡Œå­—ç¬¦ï¼Œå¯¼è‡´å“åº”ä¸­å‡ºç°æ„å¤–çš„æ ‡å¤´ï¼š
```
HTTP/1.1 302 Moved Temporarily
Server: nginx/1.19.3
Content-Type: text/html
Content-Length: 145
Connection: keep-alive
Location: https://example.com/
Detectify: clrf
```
äº†è§£æœ‰å…³CRLFæ³¨å…¥å’Œå“åº”æ‹†åˆ†çš„é£é™©ï¼Œè¯·è®¿é—®[https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/](https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/).

### ä»»ä½•å˜é‡

å‘ç°åœ¨æŸäº›æƒ…å†µä¸‹**ç”¨æˆ·æä¾›çš„æ•°æ®**å¯èƒ½è¢«è§†ä¸º**Nginxå˜é‡**ã€‚è¿™ç§è¡Œä¸ºçš„åŸå› ä»ç„¶æœ‰äº›éš¾ä»¥æ‰æ‘¸ï¼Œä½†å¹¶ä¸ç½•è§ï¼Œä¹Ÿä¸å®¹æ˜“éªŒè¯ã€‚è¿™ä¸€å¼‚å¸¸åœ¨HackerOneçš„ä¸€ä»½å®‰å…¨æŠ¥å‘Šä¸­å¾—åˆ°äº†çªå‡ºï¼Œå¯ä»¥åœ¨[æ­¤å¤„](https://hackerone.com/reports/370094)æŸ¥çœ‹ã€‚å¯¹é”™è¯¯æ¶ˆæ¯çš„è¿›ä¸€æ­¥è°ƒæŸ¥å¯¼è‡´åœ¨[Nginxä»£ç åº“çš„SSIè¿‡æ»¤æ¨¡å—](https://github.com/nginx/nginx/blob/2187586207e1465d289ae64cedc829719a048a39/src/http/modules/ngx_http_ssi_filter_module.c#L365)ä¸­ç¡®å®šäº†å…¶å‘ç”Ÿçš„ä½ç½®ï¼Œå°†æœåŠ¡å™¨ç«¯åŒ…å«ï¼ˆSSIï¼‰ç¡®å®šä¸ºæ ¹æœ¬åŸå› ã€‚

è¦**æ£€æµ‹æ­¤é…ç½®é”™è¯¯**ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå…¶ä¸­æ¶‰åŠè®¾ç½®å¼•ç”¨è€…æ ‡å¤´ä»¥æµ‹è¯•å˜é‡æ‰“å°ï¼š
```bash
$ curl -H â€˜Referer: barâ€™ http://localhost/foo$http_referer | grep â€˜foobarâ€™
```
åœ¨ç³»ç»Ÿä¸­å¯¹æ­¤é”™è¯¯é…ç½®çš„æ‰«ææ˜¾ç¤ºï¼Œæœ‰å¤šä¸ªå®ä¾‹å…è®¸ç”¨æˆ·æ‰“å°Nginxå˜é‡ã€‚ç„¶è€Œï¼Œè„†å¼±å®ä¾‹æ•°é‡çš„å‡å°‘è¡¨æ˜ä¿®è¡¥æ­¤é—®é¢˜çš„åŠªåŠ›åœ¨ä¸€å®šç¨‹åº¦ä¸Šå–å¾—äº†æˆåŠŸã€‚

## åç«¯åŸå§‹å“åº”è¯»å–

Nginxé€šè¿‡`proxy_pass`æä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œå…è®¸æ‹¦æˆªåç«¯ç”Ÿæˆçš„é”™è¯¯å’ŒHTTPæ ‡å¤´ï¼Œæ—¨åœ¨éšè—å†…éƒ¨é”™è¯¯æ¶ˆæ¯å’Œæ ‡å¤´ã€‚è¿™æ˜¯é€šè¿‡Nginxåœ¨å“åº”åç«¯é”™è¯¯æ—¶æä¾›è‡ªå®šä¹‰é”™è¯¯é¡µé¢æ¥å®ç°çš„ã€‚ç„¶è€Œï¼Œå½“Nginxé‡åˆ°æ— æ•ˆçš„HTTPè¯·æ±‚æ—¶å°±ä¼šå‡ºç°æŒ‘æˆ˜ã€‚è¿™æ ·çš„è¯·æ±‚ä¼šåƒæ”¶åˆ°çš„é‚£æ ·è½¬å‘åˆ°åç«¯ï¼Œç„¶ååç«¯çš„åŸå§‹å“åº”ä¼šç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸ç»è¿‡Nginxçš„å¹²é¢„ã€‚

è€ƒè™‘ä¸€ä¸ªæ¶‰åŠuWSGIåº”ç”¨ç¨‹åºçš„ç¤ºä¾‹åœºæ™¯ï¼š
```python
def application(environ, start_response):
start_response('500 Error', [('Content-Type', 'text/html'), ('Secret-Header', 'secret-info')])
return [b"Secret info, should not be visible!"]
```
ä¸ºäº†ç®¡ç†è¿™ä¸ªï¼Œéœ€è¦åœ¨Nginxé…ç½®ä¸­ä½¿ç”¨ç‰¹å®šçš„æŒ‡ä»¤ï¼š
```
http {
error_page 500 /html/error.html;
proxy_intercept_errors on;
proxy_hide_header Secret-Header;
}
```
- **[proxy_intercept_errors](http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_intercept_errors)**: æ­¤æŒ‡ä»¤ä½¿Nginxèƒ½å¤Ÿä¸ºåç«¯å“åº”çŠ¶æ€ç å¤§äº300çš„æƒ…å†µæä¾›è‡ªå®šä¹‰å“åº”ã€‚ç¡®ä¿å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹uWSGIåº”ç”¨ç¨‹åºï¼Œ`500é”™è¯¯`å“åº”ä¼šè¢«Nginxæ‹¦æˆªå¹¶å¤„ç†ã€‚
- **[proxy_hide_header](http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_hide_header)**: æ­£å¦‚å…¶åç§°æ‰€ç¤ºï¼Œæ­¤æŒ‡ä»¤ä¼šä»å®¢æˆ·ç«¯éšè—æŒ‡å®šçš„HTTPæ ‡å¤´ï¼Œå¢å¼ºéšç§å’Œå®‰å…¨æ€§ã€‚

å½“å‘å‡ºæœ‰æ•ˆçš„`GET`è¯·æ±‚æ—¶ï¼ŒNginxä¼šæ­£å¸¸å¤„ç†å®ƒï¼Œè¿”å›æ ‡å‡†é”™è¯¯å“åº”è€Œä¸ä¼šé€éœ²ä»»ä½•ç§˜å¯†æ ‡å¤´ã€‚ç„¶è€Œï¼Œæ— æ•ˆçš„HTTPè¯·æ±‚ä¼šç»•è¿‡æ­¤æœºåˆ¶ï¼Œå¯¼è‡´åŸå§‹åç«¯å“åº”çš„æš´éœ²ï¼ŒåŒ…æ‹¬ç§˜å¯†æ ‡å¤´å’Œé”™è¯¯æ¶ˆæ¯ã€‚

## å°†merge\_slashesè®¾ç½®ä¸ºoff

é»˜è®¤æƒ…å†µä¸‹ï¼ŒNginxçš„**`merge_slashes`æŒ‡ä»¤**è®¾ç½®ä¸º**`on`**ï¼Œå®ƒä¼šå°†URLä¸­çš„å¤šä¸ªæ–œæ å‹ç¼©ä¸ºå•ä¸ªæ–œæ ã€‚è¿™ä¸ªåŠŸèƒ½è™½ç„¶ç®€åŒ–äº†URLå¤„ç†ï¼Œä½†å¯èƒ½ä¼šæ„å¤–åœ°æ©ç›–Nginxåé¢çš„åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´ï¼Œç‰¹åˆ«æ˜¯é‚£äº›å®¹æ˜“å—åˆ°æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰æ”»å‡»çš„åº”ç”¨ç¨‹åºã€‚å®‰å…¨ä¸“å®¶**Danny Robinsonå’ŒRotem Bar**å·²ç»å¼ºè°ƒäº†ä¸æ­¤é»˜è®¤è¡Œä¸ºç›¸å…³çš„æ½œåœ¨é£é™©ï¼Œç‰¹åˆ«æ˜¯å½“Nginxå……å½“åå‘ä»£ç†æ—¶ã€‚

ä¸ºäº†å‡è½»è¿™ç§é£é™©ï¼Œå»ºè®®**å…³é—­`merge_slashes`æŒ‡ä»¤**ï¼Œä»¥é˜²æ­¢è¿™äº›æ¼æ´æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºã€‚è¿™æ ·å¯ä»¥ç¡®ä¿Nginxå°†è¯·æ±‚è½¬å‘ç»™åº”ç”¨ç¨‹åºè€Œä¸ä¼šæ›´æ”¹URLç»“æ„ï¼Œä»è€Œä¸ä¼šæ©ç›–ä»»ä½•æ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[Danny Robinsonå’ŒRotem Bar](https://medium.com/appsflyer/nginx-may-be-protecting-your-applications-from-traversal-attacks-without-you-even-knowing-b08f882fd43d)ã€‚

### **MapæŒ‡ä»¤ä¸­çš„é»˜è®¤å€¼**

åœ¨**Nginxé…ç½®**ä¸­ï¼Œ`map`æŒ‡ä»¤é€šå¸¸åœ¨**æˆæƒæ§åˆ¶**ä¸­å‘æŒ¥ä½œç”¨ã€‚ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯æ²¡æœ‰æŒ‡å®š**é»˜è®¤**å€¼ï¼Œè¿™å¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„è®¿é—®ã€‚ä¾‹å¦‚ï¼š
```yaml
http {
map $uri $mappocallow {
/map-poc/private 0;
/map-poc/secret 0;
/map-poc/public 1;
}
}
```

```yaml
server {
location /map-poc {
if ($mappocallow = 0) {return 403;}
return 200 "Hello. It is private area: $mappocallow";
}
}
```
åœ¨æ²¡æœ‰`default`çš„æƒ…å†µä¸‹ï¼Œ**æ¶æ„ç”¨æˆ·**å¯ä»¥é€šè¿‡è®¿é—®`/map-poc`ä¸­æœªå®šä¹‰çš„URIç»•è¿‡å®‰å…¨æ€§ã€‚[Nginxæ‰‹å†Œ](https://nginx.org/en/docs/http/ngx_http_map_module.html)å»ºè®®è®¾ç½®ä¸€ä¸ª**é»˜è®¤å€¼**ä»¥é¿å…æ­¤ç±»é—®é¢˜ã€‚

### **DNSæ¬ºéª—æ¼æ´**

åœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œå¯¹Nginxè¿›è¡ŒDNSæ¬ºéª—æ˜¯å¯è¡Œçš„ã€‚å¦‚æœæ”»å‡»è€…çŸ¥é“Nginxä½¿ç”¨çš„**DNSæœåŠ¡å™¨**å¹¶èƒ½æ‹¦æˆªå…¶DNSæŸ¥è¯¢ï¼Œåˆ™å¯ä»¥æ¬ºéª—DNSè®°å½•ã€‚ç„¶è€Œï¼Œå¦‚æœNginxé…ç½®ä¸ºä½¿ç”¨**localhost (127.0.0.1)**è¿›è¡ŒDNSè§£æï¼Œåˆ™æ­¤æ–¹æ³•æ— æ•ˆã€‚Nginxå…è®¸å¦‚ä¸‹æŒ‡å®šDNSæœåŠ¡å™¨ï¼š
```yaml
resolver 8.8.8.8;
```
### **`proxy_pass`å’Œ`internal`æŒ‡ä»¤**

**`proxy_pass`**æŒ‡ä»¤ç”¨äºå°†è¯·æ±‚é‡å®šå‘åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œå¯ä»¥æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨ã€‚**`internal`**æŒ‡ä»¤ç¡®ä¿æŸäº›ä½ç½®ä»…åœ¨Nginxå†…éƒ¨å¯è®¿é—®ã€‚è™½ç„¶è¿™äº›æŒ‡ä»¤æœ¬èº«å¹¶éæ¼æ´ï¼Œä½†å®ƒä»¬çš„é…ç½®éœ€è¦ä»”ç»†æ£€æŸ¥ï¼Œä»¥é˜²æ­¢å®‰å…¨æ¼æ´ã€‚

## proxy\_set\_header Upgrade & Connection

å¦‚æœnginxæœåŠ¡å™¨é…ç½®ä¸ºä¼ é€’Upgradeå’ŒConnectionæ ‡å¤´ï¼Œåˆ™å¯èƒ½ä¼šæ‰§è¡Œ[h2c Smuggling attack](../../pentesting-web/h2c-smuggling.md)ä»¥è®¿é—®å—ä¿æŠ¤/å†…éƒ¨ç«¯ç‚¹ã€‚

{% hint style="danger" %}
æ­¤æ¼æ´å°†å…è®¸æ”»å‡»è€…ä¸`proxy_pass`ç«¯ç‚¹ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º`http://backend:9999`ï¼‰å»ºç«‹ç›´æ¥è¿æ¥ï¼Œnginxä¸ä¼šæ£€æŸ¥å…¶å†…å®¹ã€‚
{% endhint %}

ä»[è¿™é‡Œ](https://bishopfox.com/blog/h2c-smuggling-request)çªƒå–`/flag`çš„æ˜“å—æ”»å‡»é…ç½®ç¤ºä¾‹ï¼š
```
server {
listen       443 ssl;
server_name  localhost;

ssl_certificate       /usr/local/nginx/conf/cert.pem;
ssl_certificate_key   /usr/local/nginx/conf/privkey.pem;

location / {
proxy_pass http://backend:9999;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection $http_connection;
}

location /flag {
deny all;
}
```
{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œå³ä½¿ `proxy_pass` æŒ‡å‘ç‰¹å®šçš„ **è·¯å¾„**ï¼Œæ¯”å¦‚ `http://backend:9999/socket.io`ï¼Œè¿æ¥ä¹Ÿä¼šå»ºç«‹åœ¨ `http://backend:9999`ï¼Œå› æ­¤æ‚¨å¯ä»¥**è®¿é—®å†…éƒ¨ç«¯ç‚¹ä¸­çš„ä»»ä½•å…¶ä»–è·¯å¾„ã€‚å› æ­¤ï¼Œåœ¨ proxy\_pass çš„ URL ä¸­æŒ‡å®šè·¯å¾„å¹¶ä¸é‡è¦ã€‚**
{% endhint %}

## äº²è‡ªå°è¯•

Detectify åˆ›å»ºäº†ä¸€ä¸ª GitHub å­˜å‚¨åº“ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Docker è®¾ç½®è‡ªå·±çš„æ˜“å—æ”»å‡»çš„ Nginx æµ‹è¯•æœåŠ¡å™¨ï¼Œå…¶ä¸­åŒ…å«æœ¬æ–‡è®¨è®ºçš„ä¸€äº›é…ç½®é”™è¯¯ï¼Œå¹¶å°è¯•è‡ªè¡ŒæŸ¥æ‰¾å®ƒä»¬ï¼

[https://github.com/detectify/vulnerable-nginx](https://github.com/detectify/vulnerable-nginx)

## é™æ€åˆ†æå·¥å…·

### [GIXY](https://github.com/yandex/gixy)

Gixy æ˜¯ä¸€ä¸ªç”¨äºåˆ†æ Nginx é…ç½®çš„å·¥å…·ã€‚Gixy çš„ä¸»è¦ç›®æ ‡æ˜¯é˜²æ­¢å®‰å…¨é…ç½®é”™è¯¯å¹¶è‡ªåŠ¨åŒ–ç¼ºé™·æ£€æµ‹ã€‚

### [Nginxpwner](https://github.com/stark0de/nginxpwner)

Nginxpwner æ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œç”¨äºæŸ¥æ‰¾å¸¸è§çš„ Nginx é…ç½®é”™è¯¯å’Œæ¼æ´ã€‚

## å‚è€ƒèµ„æ–™

* [**https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/**](https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/)
* [**http://blog.zorinaq.com/nginx-resolver-vulns/**](http://blog.zorinaq.com/nginx-resolver-vulns/)
* [**https://github.com/yandex/gixy/issues/115**](https://github.com/yandex/gixy/issues/115)

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**å³æ—¶å¯ç”¨çš„æ¼æ´è¯„ä¼°å’Œæ¸—é€æµ‹è¯•è®¾ç½®**ã€‚ä»ä»»ä½•åœ°æ–¹è¿è¡Œå®Œæ•´çš„æ¸—é€æµ‹è¯•ï¼Œä½¿ç”¨ 20 å¤šç§å·¥å…·å’ŒåŠŸèƒ½ï¼Œä»ä¾¦å¯Ÿåˆ°æŠ¥å‘Šã€‚æˆ‘ä»¬ä¸å–ä»£æ¸—é€æµ‹è¯•äººå‘˜ - æˆ‘ä»¬å¼€å‘å®šåˆ¶å·¥å…·ã€æ£€æµ‹å’Œåˆ©ç”¨æ¨¡å—ï¼Œè®©ä»–ä»¬æœ‰æ›´å¤šæ—¶é—´æ·±å…¥æŒ–æ˜ã€å¼¹å‡º shell å¹¶äº«å—ä¹è¶£ã€‚

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹æˆä¸º AWS é»‘å®¢é«˜æ‰‹</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„ **å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š** æˆ– **ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢ [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github å­˜å‚¨åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
