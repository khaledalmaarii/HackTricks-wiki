# Nginx

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="/.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>

**Zafiyet deÄŸerlendirmesi ve penetrasyon testi iÃ§in anÄ±nda kullanÄ±labilir kurulum**. 20'den fazla araÃ§ ve Ã¶zellik ile her yerden tam bir pentest gerÃ§ekleÅŸtirin; bu araÃ§lar keÅŸiften raporlamaya kadar uzanÄ±r. Biz pentester'larÄ±n yerini almÄ±yoruz - onlara daha derinlemesine araÅŸtÄ±rma yapmalarÄ±, shell'leri patlatmalarÄ± ve eÄŸlenmeleri iÃ§in biraz zaman kazandÄ±rmak amacÄ±yla Ã¶zel araÃ§lar, tespit ve istismar modÃ¼lleri geliÅŸtiriyoruz.

{% embed url="https://pentest-tools.com/?utm_term=jul2024&utm_medium=link&utm_source=hacktricks&utm_campaign=spons" %}

## Missing root location <a href="#missing-root-location" id="missing-root-location"></a>

Nginx sunucusunu yapÄ±landÄ±rÄ±rken, **root direktifi** dosyalarÄ±n sunulduÄŸu temel dizini tanÄ±mlayarak kritik bir rol oynar. AÅŸaÄŸÄ±daki Ã¶rneÄŸi dikkate alÄ±n:
```bash
server {
root /etc/nginx;

location /hello.txt {
try_files $uri $uri/ =404;
proxy_pass http://127.0.0.1:8080/;
}
}
```
Bu yapÄ±landÄ±rmada, `/etc/nginx` kÃ¶k dizin olarak belirlenmiÅŸtir. Bu ayar, `/hello.txt` gibi belirtilen kÃ¶k dizin iÃ§indeki dosyalara eriÅŸim saÄŸlar. Ancak, yalnÄ±zca belirli bir konum (`/hello.txt`) tanÄ±mlandÄ±ÄŸÄ±nÄ± not etmek Ã¶nemlidir. KÃ¶k konumu iÃ§in bir yapÄ±landÄ±rma yoktur (`location / {...}`). Bu eksiklik, kÃ¶k direktifinin kÃ¼resel olarak uygulanmasÄ± anlamÄ±na gelir ve kÃ¶k yolu `/` iÃ§in yapÄ±lan isteklerin `/etc/nginx` altÄ±ndaki dosyalara eriÅŸmesine olanak tanÄ±r.

Bu yapÄ±landÄ±rmadan kaynaklanan kritik bir gÃ¼venlik dikkati vardÄ±r. `GET /nginx.conf` gibi basit bir `GET` isteÄŸi, `/etc/nginx/nginx.conf` konumundaki Nginx yapÄ±landÄ±rma dosyasÄ±nÄ± sunarak hassas bilgileri aÃ§Ä±ÄŸa Ã§Ä±karabilir. KÃ¶kÃ¼ daha az hassas bir dizine, Ã¶rneÄŸin `/etc` olarak ayarlamak bu riski azaltabilir, ancak yine de diÄŸer kritik dosyalara, diÄŸer yapÄ±landÄ±rma dosyalarÄ±na, eriÅŸim gÃ¼nlÃ¼klerine ve hatta HTTP temel kimlik doÄŸrulamasÄ± iÃ§in kullanÄ±lan ÅŸifrelenmiÅŸ kimlik bilgilerine istenmeyen eriÅŸime izin verebilir.

## Alias LFI YanlÄ±ÅŸ YapÄ±landÄ±rmasÄ± <a href="#alias-lfi-misconfiguration" id="alias-lfi-misconfiguration"></a>

Nginx yapÄ±landÄ±rma dosyalarÄ±nda, "location" direktifleri iÃ§in dikkatli bir inceleme gereklidir. AÅŸaÄŸÄ±daki gibi bir yapÄ±landÄ±rma aracÄ±lÄ±ÄŸÄ±yla istemeden Yerel Dosya Dahil Etme (LFI) olarak bilinen bir zafiyet tanÄ±tÄ±labilir:
```
location /imgs {
alias /path/images/;
}
```
Bu yapÄ±landÄ±rma, sunucunun `/imgs../flag.txt` gibi istekleri, hedef dizin dÄ±ÅŸÄ±ndaki dosyalara eriÅŸim giriÅŸimi olarak yorumlamasÄ± nedeniyle LFI saldÄ±rÄ±larÄ±na aÃ§Ä±ktÄ±r ve bu da `/path/images/../flag.txt` olarak Ã§Ã¶zÃ¼lmektedir. Bu hata, saldÄ±rganlarÄ±n web Ã¼zerinden eriÅŸilememesi gereken dosyalarÄ± sunucunun dosya sisteminden almasÄ±na olanak tanÄ±r.

Bu gÃ¼venlik aÃ§Ä±ÄŸÄ±nÄ± azaltmak iÃ§in yapÄ±landÄ±rma ÅŸu ÅŸekilde ayarlanmalÄ±dÄ±r:
```
location /imgs/ {
alias /path/images/;
}
```
Daha fazla bilgi: [https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/](https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/)

Accunetix testleri:
```
alias../ => HTTP status code 403
alias.../ => HTTP status code 404
alias../../ => HTTP status code 403
alias../../../../../../../../../../../ => HTTP status code 400
alias../ => HTTP status code 403
```
## GÃ¼vensiz yol kÄ±sÄ±tlamasÄ± <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

AÅŸaÄŸÄ±daki sayfayÄ± kontrol edin, ÅŸu gibi direktifleri nasÄ±l atlayacaÄŸÄ±nÄ±zÄ± Ã¶ÄŸrenin:
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
{% content-ref url="../../pentesting-web/proxy-waf-protections-bypass.md" %}
[proxy-waf-protections-bypass.md](../../pentesting-web/proxy-waf-protections-bypass.md)
{% endcontent-ref %}

## GÃ¼vensiz deÄŸiÅŸken kullanÄ±mÄ± / HTTP Ä°stek BÃ¶lme <a href="#unsafe-variable-use" id="unsafe-variable-use"></a>

{% hint style="danger" %}
ZayÄ±f deÄŸiÅŸkenler `$uri` ve `$document_uri` ve bunlar `$request_uri` ile deÄŸiÅŸtirilerek dÃ¼zeltilebilir.

Bir regex de zayÄ±f olabilir:

`location ~ /docs/([^/])? { â€¦ $1 â€¦ }` - ZayÄ±f&#x20;

`location ~ /docs/([^/\s])? { â€¦ $1 â€¦ }` - ZayÄ±f deÄŸil (boÅŸluklarÄ± kontrol ediyor)

`location ~ /docs/(.*)? { â€¦ $1 â€¦ }`  - ZayÄ±f deÄŸil
{% endhint %}

Nginx yapÄ±landÄ±rmasÄ±ndaki bir zayÄ±flÄ±k aÅŸaÄŸÄ±daki Ã¶rnekle gÃ¶sterilmektedir:
```
location / {
return 302 https://example.com$uri;
}
```
HTTP isteklerinde \r (Carriage Return) ve \n (Line Feed) karakterleri yeni satÄ±r karakterlerini belirtir ve URL kodlu formlarÄ± `%0d%0a` olarak temsil edilir. Bu karakterleri yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ bir sunucuya yapÄ±lan bir isteÄŸe (Ã¶rneÄŸin, `http://localhost/%0d%0aDetectify:%20clrf`) dahil etmek, sunucunun `Detectify` adÄ±nda yeni bir baÅŸlÄ±k oluÅŸturmasÄ±na neden olur. Bu, $uri deÄŸiÅŸkeninin URL kodlu yeni satÄ±r karakterlerini Ã§Ã¶zmesi nedeniyle gerÃ§ekleÅŸir ve yanÄ±t iÃ§inde beklenmedik bir baÅŸlÄ±k oluÅŸur:
```
HTTP/1.1 302 Moved Temporarily
Server: nginx/1.19.3
Content-Type: text/html
Content-Length: 145
Connection: keep-alive
Location: https://example.com/
Detectify: clrf
```
CRLF enjeksiyonu ve yanÄ±t bÃ¶lme riskleri hakkÄ±nda daha fazla bilgi edinin [https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/](https://blog.detectify.com/2019/06/14/http-response-splitting-exploitations-and-mitigations/).

AyrÄ±ca bu teknik [**bu konuÅŸmada aÃ§Ä±klanmÄ±ÅŸtÄ±r**](https://www.youtube.com/watch?v=gWQyWdZbdoY\&list=PL0xCSYnG\_iTtJe2V6PQqamBF73n7-f1Nr\&index=77) bazÄ± savunmasÄ±z Ã¶rnekler ve tespit mekanizmalarÄ± ile. Ã–rneÄŸin, bu yanlÄ±ÅŸ yapÄ±landÄ±rmayÄ± bir kara kutu perspektifinden tespit etmek iÃ§in bu istekleri kullanabilirsiniz:

* `https://example.com/%20X` - Herhangi bir HTTP kodu
* `https://example.com/%20H` - 400 Bad Request

EÄŸer savunmasÄ±zsa, ilki "X" herhangi bir HTTP yÃ¶ntemi olarak dÃ¶necek ve ikincisi H geÃ§erli bir yÃ¶ntem olmadÄ±ÄŸÄ±ndan bir hata dÃ¶necektir. BÃ¶ylece sunucu ÅŸunlarÄ± alacak: `GET / H HTTP/1.1` ve bu hatayÄ± tetikleyecektir.

DiÄŸer tespit Ã¶rnekleri ÅŸunlar olabilir:

* `http://company.tld/%20HTTP/1.1%0D%0AXXXX:%20x` - Herhangi bir HTTP kodu
* `http://company.tld/%20HTTP/1.1%0D%0AHost:%20x` - 400 Bad Request

O konuÅŸmada sunulan bazÄ± savunmasÄ±z yapÄ±landÄ±rmalar ÅŸunlardÄ±:

* **`$uri`**'nin son URL'de olduÄŸu gibi ayarlandÄ±ÄŸÄ±na dikkat edin.
```
location ^~ /lite/api/ {
proxy_pass http://lite-backend$uri$is_args$args;
}
```
* Dikkat edin ki yine **`$uri`** URL'de (bu sefer bir parametre iÃ§inde) bulunmaktadÄ±r.
```
location ~ ^/dna/payment {
rewrite ^/dna/([^/]+) /registered/main.pl?cmd=unifiedPayment&context=$1&native_uri=$uri break;
proxy_pass http://$back;
```
* Åimdi AWS S3'te
```
location /s3/ {
proxy_pass https://company-bucket.s3.amazonaws.com$uri;
}
```
### Herhangi bir deÄŸiÅŸken

**KullanÄ±cÄ± tarafÄ±ndan saÄŸlanan verilerin**, belirli koÅŸullar altÄ±nda **Nginx deÄŸiÅŸkeni** olarak ele alÄ±nabileceÄŸi keÅŸfedilmiÅŸtir. Bu davranÄ±ÅŸÄ±n nedeni biraz belirsiz kalmakta, ancak nadir ya da doÄŸrulamasÄ± basit deÄŸildir. Bu anomali, HackerOne'da yayÄ±nlanan bir gÃ¼venlik raporunda vurgulanmÄ±ÅŸtÄ±r, [buradan](https://hackerone.com/reports/370094) gÃ¶rÃ¼ntÃ¼lenebilir. Hata mesajÄ± Ã¼zerindeki daha fazla araÅŸtÄ±rma, bunun [Nginx'in kod tabanÄ±ndaki SSI filtre modÃ¼lÃ¼nde](https://github.com/nginx/nginx/blob/2187586207e1465d289ae64cedc829719a048a39/src/http/modules/ngx_http_ssi_filter_module.c#L365) meydana geldiÄŸini belirlemiÅŸ ve Sunucu TarafÄ± Dahil Etmelerin (SSI) kÃ¶k neden olduÄŸunu ortaya Ã§Ä±karmÄ±ÅŸtÄ±r.

Bu **yanlÄ±ÅŸ yapÄ±landÄ±rmayÄ± tespit etmek** iÃ§in, deÄŸiÅŸken yazdÄ±rmasÄ±nÄ± test etmek amacÄ±yla bir referer baÅŸlÄ±ÄŸÄ± ayarlamayÄ± iÃ§eren aÅŸaÄŸÄ±daki komut Ã§alÄ±ÅŸtÄ±rÄ±labilir:
```bash
$ curl -H â€˜Referer: barâ€™ http://localhost/foo$http_referer | grep â€˜foobarâ€™
```
Bu yanlÄ±ÅŸ yapÄ±landÄ±rmanÄ±n sistemler arasÄ±nda taranmasÄ±, bir kullanÄ±cÄ±nÄ±n Nginx deÄŸiÅŸkenlerini yazdÄ±rabileceÄŸi birden fazla Ã¶rneÄŸi ortaya Ã§Ä±kardÄ±. Ancak, savunmasÄ±z Ã¶rneklerin sayÄ±sÄ±ndaki azalma, bu sorunu dÃ¼zeltme Ã§abalarÄ±nÄ±n bir Ã¶lÃ§Ã¼de baÅŸarÄ±lÄ± olduÄŸunu gÃ¶stermektedir.

## Ham arka uÃ§ yanÄ±tÄ± okuma

Nginx, arka uÃ§ tarafÄ±ndan Ã¼retilen hatalarÄ± ve HTTP baÅŸlÄ±klarÄ±nÄ± yakalamak iÃ§in `proxy_pass` aracÄ±lÄ±ÄŸÄ±yla bir Ã¶zellik sunar; bu, dahili hata mesajlarÄ±nÄ± ve baÅŸlÄ±klarÄ± gizlemeyi amaÃ§lar. Bu, Nginx'in arka uÃ§ hatalarÄ±na yanÄ±t olarak Ã¶zel hata sayfalarÄ± sunmasÄ±yla gerÃ§ekleÅŸtirilir. Ancak, Nginx geÃ§ersiz bir HTTP isteÄŸiyle karÅŸÄ±laÅŸtÄ±ÄŸÄ±nda zorluklar ortaya Ã§Ä±kar. BÃ¶yle bir istek, alÄ±ndÄ±ÄŸÄ± gibi arka uca iletilir ve arka ucun ham yanÄ±tÄ±, Nginx'in mÃ¼dahalesi olmadan doÄŸrudan istemciye gÃ¶nderilir.

Bir uWSGI uygulamasÄ±nÄ± iÃ§eren Ã¶rnek bir senaryoyu dÃ¼ÅŸÃ¼nÃ¼n:
```python
def application(environ, start_response):
start_response('500 Error', [('Content-Type', 'text/html'), ('Secret-Header', 'secret-info')])
return [b"Secret info, should not be visible!"]
```
Bunu yÃ¶netmek iÃ§in Nginx yapÄ±landÄ±rmasÄ±nda belirli direktifler kullanÄ±lÄ±r:
```
http {
error_page 500 /html/error.html;
proxy_intercept_errors on;
proxy_hide_header Secret-Header;
}
```
* [**proxy\_intercept\_errors**](http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html#proxy\_intercept\_errors): Bu direktif, Nginx'in 300'den bÃ¼yÃ¼k durum kodlarÄ±na sahip arka uÃ§ yanÄ±tlarÄ± iÃ§in Ã¶zel bir yanÄ±t sunmasÄ±nÄ± saÄŸlar. Ã–rneÄŸimizdeki uWSGI uygulamasÄ± iÃ§in, `500 HatasÄ±` yanÄ±tÄ±nÄ±n Nginx tarafÄ±ndan yakalanÄ±p iÅŸlenmesini garanti eder.
* [**proxy\_hide\_header**](http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html#proxy\_hide\_header): AdÄ±ndan da anlaÅŸÄ±lacaÄŸÄ± gibi, bu direktif belirtilen HTTP baÅŸlÄ±klarÄ±nÄ± istemciden gizler, gizliliÄŸi ve gÃ¼venliÄŸi artÄ±rÄ±r.

GeÃ§erli bir `GET` isteÄŸi yapÄ±ldÄ±ÄŸÄ±nda, Nginx bunu normal ÅŸekilde iÅŸler ve herhangi bir gizli baÅŸlÄ±k ifÅŸa etmeden standart bir hata yanÄ±tÄ± dÃ¶ner. Ancak, geÃ§ersiz bir HTTP isteÄŸi bu mekanizmayÄ± atlayarak, gizli baÅŸlÄ±klar ve hata mesajlarÄ± da dahil olmak Ã¼zere ham arka uÃ§ yanÄ±tlarÄ±nÄ±n ifÅŸasÄ±na neden olur.

## merge\_slashes kapalÄ±

VarsayÄ±lan olarak, Nginx'in **`merge_slashes` direktifi** **`aÃ§Ä±k`** olarak ayarlanmÄ±ÅŸtÄ±r; bu, bir URL'deki birden fazla ileri eÄŸik Ã§izgiyi tek bir eÄŸik Ã§izgiye sÄ±kÄ±ÅŸtÄ±rÄ±r. Bu Ã¶zellik, URL iÅŸleme sÃ¼recini kolaylaÅŸtÄ±rÄ±rken, Nginx'in arkasÄ±ndaki uygulamalardaki zayÄ±flÄ±klarÄ±, Ã¶zellikle yerel dosya dahil etme (LFI) saldÄ±rÄ±larÄ±na yatkÄ±n olanlarÄ±, yanlÄ±ÅŸlÄ±kla gizleyebilir. GÃ¼venlik uzmanlarÄ± **Danny Robinson ve Rotem Bar**, Nginx'in ters proxy olarak hareket ettiÄŸi durumlarda bu varsayÄ±lan davranÄ±ÅŸla iliÅŸkili potansiyel riskleri vurgulamÄ±ÅŸlardÄ±r.

Bu tÃ¼r riskleri azaltmak iÃ§in, bu zayÄ±flÄ±klara duyarlÄ± uygulamalar iÃ§in **`merge_slashes` direktifini kapatmak** Ã¶nerilir. Bu, Nginx'in URL yapÄ±sÄ±nÄ± deÄŸiÅŸtirmeden uygulamaya istekleri iletmesini saÄŸlar ve bÃ¶ylece temel gÃ¼venlik sorunlarÄ±nÄ± gizlemez.

Daha fazla bilgi iÃ§in [Danny Robinson ve Rotem Bar](https://medium.com/appsflyer/nginx-may-be-protecting-your-applications-from-traversal-attacks-without-you-even-knowing-b08f882fd43d) baÄŸlantÄ±sÄ±nÄ± kontrol edin.

### **Maclicious YanÄ±t BaÅŸlÄ±klarÄ±**

[**bu yazÄ±da**](https://mizu.re/post/cors-playground) gÃ¶sterildiÄŸi gibi, web sunucusundan gelen yanÄ±tta mevcut olan belirli baÅŸlÄ±klar, Nginx proxy'sinin davranÄ±ÅŸÄ±nÄ± deÄŸiÅŸtirecektir. BunlarÄ± [**belgelerde**](https://www.nginx.com/resources/wiki/start/topics/examples/x-accel/) kontrol edebilirsiniz:

* `X-Accel-Redirect`: Nginx'e bir isteÄŸi belirtilen bir konuma dahili olarak yÃ¶nlendirmesini belirtir.
* `X-Accel-Buffering`: Nginx'in yanÄ±tÄ± tamponlayÄ±p tamponlamayacaÄŸÄ±nÄ± kontrol eder.
* `X-Accel-Charset`: X-Accel-Redirect kullanÄ±ldÄ±ÄŸÄ±nda yanÄ±t iÃ§in karakter setini ayarlar.
* `X-Accel-Expires`: X-Accel-Redirect kullanÄ±ldÄ±ÄŸÄ±nda yanÄ±t iÃ§in son kullanma sÃ¼resini ayarlar.
* `X-Accel-Limit-Rate`: X-Accel-Redirect kullanÄ±ldÄ±ÄŸÄ±nda yanÄ±tlar iÃ§in transfer hÄ±zÄ±nÄ± sÄ±nÄ±rlar.

Ã–rneÄŸin, **`X-Accel-Redirect`** baÅŸlÄ±ÄŸÄ±, nginx'de dahili bir **yÃ¶nlendirme** oluÅŸturur. Yani, **`root /`** gibi bir nginx yapÄ±landÄ±rmasÄ±na sahip olmak ve web sunucusundan **`X-Accel-Redirect: .env`** ile bir yanÄ±t almak, nginx'in **`/.env`** iÃ§eriÄŸini gÃ¶ndermesine neden olacaktÄ±r (Path Traversal).

### **Map Direktifinde VarsayÄ±lan DeÄŸer**

**Nginx yapÄ±landÄ±rmasÄ±nda**, `map` direktifi genellikle **yetkilendirme kontrolÃ¼** rolÃ¼ oynar. YaygÄ±n bir hata, **varsayÄ±lan** bir deÄŸer belirtmemektir; bu, yetkisiz eriÅŸime yol aÃ§abilir. Ã–rneÄŸin:
```yaml
http {
map $uri $mappocallow {
/map-poc/private 0;
/map-poc/secret 0;
/map-poc/public 1;
}
}
```

```yaml
server {
location /map-poc {
if ($mappocallow = 0) {return 403;}
return 200 "Hello. It is private area: $mappocallow";
}
}
```
`default` olmadan, **kÃ¶tÃ¼ niyetli bir kullanÄ±cÄ±** `/map-poc` iÃ§indeki **tanÄ±msÄ±z URI**'ye eriÅŸerek gÃ¼venliÄŸi atlayabilir. [Nginx kÄ±lavuzu](https://nginx.org/en/docs/http/ngx\_http\_map\_module.html) bu tÃ¼r sorunlarÄ± Ã¶nlemek iÃ§in bir **varsayÄ±lan deÄŸer** ayarlamayÄ± Ã¶nerir.

### **DNS Spoofing AÃ§Ä±ÄŸÄ±**

Nginx'e karÅŸÄ± DNS spoofing belirli koÅŸullar altÄ±nda mÃ¼mkÃ¼ndÃ¼r. EÄŸer bir saldÄ±rgan Nginx tarafÄ±ndan kullanÄ±lan **DNS sunucusunu** biliyorsa ve DNS sorgularÄ±nÄ± kesebiliyorsa, DNS kayÄ±tlarÄ±nÄ± sahteleyebilir. Ancak, Nginx **localhost (127.0.0.1)** kullanacak ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸsa, bu yÃ¶ntem etkisizdir. Nginx, bir DNS sunucusunu aÅŸaÄŸÄ±daki gibi belirtmeye izin verir:
```yaml
resolver 8.8.8.8;
```
### **`proxy_pass` ve `internal` Direktifleri**

**`proxy_pass`** direktifi, istekleri diÄŸer sunuculara, ister dahili ister harici olarak yÃ¶nlendirmek iÃ§in kullanÄ±lÄ±r. **`internal`** direktifi, belirli konumlarÄ±n yalnÄ±zca Nginx iÃ§inde eriÅŸilebilir olmasÄ±nÄ± saÄŸlar. Bu direktifler kendileri bir zafiyet olmasa da, yapÄ±landÄ±rmalarÄ± gÃ¼venlik aÃ§Ä±klarÄ±nÄ± Ã¶nlemek iÃ§in dikkatli bir ÅŸekilde incelenmelidir.

## proxy\_set\_header Upgrade & Connection

EÄŸer nginx sunucusu Upgrade ve Connection baÅŸlÄ±klarÄ±nÄ± geÃ§irecek ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸsa, korunan/dahili uÃ§ noktalarÄ±na eriÅŸmek iÃ§in bir [**h2c Smuggling saldÄ±rÄ±sÄ±**](../../pentesting-web/h2c-smuggling.md) gerÃ§ekleÅŸtirilebilir.

{% hint style="danger" %}
Bu zafiyet, bir saldÄ±rganÄ±n **`proxy_pass` uÃ§ noktasÄ± ile doÄŸrudan bir baÄŸlantÄ± kurmasÄ±na** izin verecektir (`http://backend:9999` bu durumda) ve iÃ§eriÄŸi nginx tarafÄ±ndan kontrol edilmeyecektir.
{% endhint %}

`/flag` Ã§almak iÃ§in zayÄ±f yapÄ±landÄ±rma Ã¶rneÄŸi [buradan](https://bishopfox.com/blog/h2c-smuggling-request):
```
server {
listen       443 ssl;
server_name  localhost;

ssl_certificate       /usr/local/nginx/conf/cert.pem;
ssl_certificate_key   /usr/local/nginx/conf/privkey.pem;

location / {
proxy_pass http://backend:9999;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection $http_connection;
}

location /flag {
deny all;
}
```
{% hint style="warning" %}
Not edin ki `proxy_pass` belirli bir **yola** iÅŸaret etse bile, baÄŸlantÄ± `http://backend:9999` ile kurulacaktÄ±r, bu nedenle o iÃ§ uÃ§ noktasÄ± iÃ§inde **herhangi bir baÅŸka yolla iletiÅŸim kurabilirsiniz. Bu nedenle, proxy_pass URL'sinde bir yol belirtilip belirtilmediÄŸi Ã¶nemli deÄŸildir.**
{% endhint %}

## Kendin dene

Detectify, bu makalede tartÄ±ÅŸÄ±lan bazÄ± yanlÄ±ÅŸ yapÄ±landÄ±rmalarla kendi savunmasÄ±z Nginx test sunucunuzu Docker kullanarak kurabileceÄŸiniz bir GitHub deposu oluÅŸturmuÅŸtur ve bunlarÄ± kendiniz bulmayÄ± deneyebilirsiniz!

[https://github.com/detectify/vulnerable-nginx](https://github.com/detectify/vulnerable-nginx)

## Statik Analiz AraÃ§larÄ±

### [GIXY](https://github.com/yandex/gixy)

Gixy, Nginx yapÄ±landÄ±rmasÄ±nÄ± analiz etmek iÃ§in bir araÃ§tÄ±r. Gixy'nin ana hedefi, gÃ¼venlik yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ±nÄ± Ã¶nlemek ve hata tespitini otomatikleÅŸtirmektir.

### [Nginxpwner](https://github.com/stark0de/nginxpwner)

Nginxpwner, yaygÄ±n Nginx yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ±nÄ± ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± aramak iÃ§in basit bir araÃ§tÄ±r.

## Referanslar

* [**https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/**](https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/)
* [**http://blog.zorinaq.com/nginx-resolver-vulns/**](http://blog.zorinaq.com/nginx-resolver-vulns/)
* [**https://github.com/yandex/gixy/issues/115**](https://github.com/yandex/gixy/issues/115)

<figure><img src="/.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>

**Zafiyet deÄŸerlendirmesi ve penetrasyon testi iÃ§in anÄ±nda kullanÄ±labilir kurulum**. 20'den fazla araÃ§ ve Ã¶zellik ile her yerden tam bir pentest gerÃ§ekleÅŸtirin; bu araÃ§lar keÅŸiften raporlamaya kadar uzanÄ±r. Biz pentester'larÄ±n yerini almÄ±yoruz - onlara daha derinlemesine araÅŸtÄ±rma yapmalarÄ±, shell'leri patlatmalarÄ± ve eÄŸlenmeleri iÃ§in biraz zaman kazandÄ±rmak amacÄ±yla Ã¶zel araÃ§lar, tespit ve istismar modÃ¼lleri geliÅŸtiriyoruz.

{% embed url="https://pentest-tools.com/?utm_term=jul2024&utm_medium=link&utm_source=hacktricks&utm_campaign=spons" %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub depolarÄ±na PR gÃ¶nderin.

</details>
{% endhint %}
