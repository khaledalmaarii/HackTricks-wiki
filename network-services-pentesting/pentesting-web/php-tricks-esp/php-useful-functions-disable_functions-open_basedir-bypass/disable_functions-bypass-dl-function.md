{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**рдорд╣рддреНрд╡рдкреВрд░реНрдг рдиреЛрдЯ:**

![image](https://user-images.githubusercontent.com/84577967/174675487-a4c4ca06-194f-4725-85af-231a2f35d56c.png)

**`dl`** рдПрдХ PHP рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ PHP рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдЕрдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **`disable_functions` рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдФрд░ рдордирдорд╛рдиреЗ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**ред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕рдХреЗ рдХреБрдЫ рд╕рдЦреНрдд рд╕реАрдорд╛рдПрдБ рд╣реИрдВ:

* `dl` рдлрд╝рдВрдХреНрд╢рди рдХреЛ **рдореМрдЬреВрдж** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ **рдЕрдХреНрд╖рдо рдирд╣реАрдВ** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП
* PHP рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рдЙрд╕ **рд╕рдорд╛рди рдореЗрдЬрд░ рд╕рдВрд╕реНрдХрд░рдг** (PHP API рд╕рдВрд╕реНрдХрд░рдг) рдХреЗ рд╕рд╛рде рд╕рдВрдХрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рд░реНрд╡рд░ рдХрд░ рд░рд╣рд╛ рд╣реИ (рдЖрдк рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА phpinfo рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ)
* PHP рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рдЙрд╕ **рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛** рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ **`extension_dir`** рдирд┐рд░реНрджреЗрд╢ рджреНрд╡рд╛рд░рд╛ **рдкрд░рд┐рднрд╛рд╖рд┐рдд** рд╣реИ (рдЖрдк рдЗрд╕реЗ phpinfo рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ)ред рдпрд╣ рдмрд╣реБрдд рдЕрд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЬреЛ рд╕рд░реНрд╡рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд░рдЦрддрд╛ рд╣реЛ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╢рд╛рдпрдж рдЖрдкрдХреЛ рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХ рджреЗрдЧреАред

**рдпрджрд┐ рдЖрдк рдЗрди рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЛ рдкрдврд╝рдирд╛ рдЬрд╛рд░реА рд░рдЦреЗрдВ** [**https://antichat.com/threads/70763/**](https://antichat.com/threads/70763/) **рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ `disable_functions` рдХреЛ рдХреИрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░реЗрдВ**ред рдпрд╣рд╛рдБ рдПрдХ рд╕рд╛рд░рд╛рдВрд╢ рд╣реИ:

[dl рдлрд╝рдВрдХреНрд╢рди](http://www.php.net/manual/en/function.dl.php) рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рджреМрд░рд╛рди PHP рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред PHP рдПрдХреНрд╕рдЯреЗрдВрд╢рди, рдЬреЛ рдЖрдорддреМрд░ рдкрд░ C/C++ рдореЗрдВ рд▓рд┐рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ, PHP рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдмрдврд╝рд╛рддреЗ рд╣реИрдВред рд╣рдорд▓рд╛рд╡рд░, рдЬрдм рджреЗрдЦрддрд╛ рд╣реИ рдХрд┐ `dl` рдлрд╝рдВрдХреНрд╢рди рдЕрдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ, рддреЛ рд╕рд┐рд╕реНрдЯрдо рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╕реНрдЯрдо PHP рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдмрдирд╛рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрддрд╛ рд╣реИред

### рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдЙрдард╛рдП рдЧрдП рдХрджрдо:

1. **PHP рд╕рдВрд╕реНрдХрд░рдг рдкрд╣рдЪрд╛рди:**
- рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ PHP рд╕рдВрд╕реНрдХрд░рдг рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ (`<?php echo 'PHP Version is '.PHP_VERSION; ?>`).

2. **PHP рд╕реНрд░реЛрдд рдЕрдзрд┐рдЧреНрд░рд╣рдг:**
- рдЖрдзрд┐рдХрд╛рд░рд┐рдХ [PHP рд╡реЗрдмрд╕рд╛рдЗрдЯ](http://www.php.net/downloads.php) рд╕реЗ PHP рд╕реНрд░реЛрдд рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдпрджрд┐ рд╕рдВрд╕реНрдХрд░рдг рдкреБрд░рд╛рдирд╛ рд╣реИ рддреЛ [рдЖрд░реНрдХрд╛рдЗрд╡](http://museum.php.net) рд╕реЗред

3. **рд╕реНрдерд╛рдиреАрдп PHP рд╕реЗрдЯрдЕрдк:**
- рдЕрдкрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ PHP рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдирд┐рдХрд╛рд▓рддрд╛ рдФрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИред

4. **рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдирд┐рд░реНрдорд╛рдг:**
- [PHP рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдмрдирд╛рдиреЗ](http://www.php.net/manual/en/zend.creating.php) рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рддрд╛ рд╣реИ рдФрд░ PHP рд╕реНрд░реЛрдд рдХреЛрдб рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИред
- `ext/standard/exec.c` рдореЗрдВ рд╕реНрдерд┐рдд [exec рдлрд╝рдВрдХреНрд╢рди](http://www.php.net/manual/en/function.exec.php) рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рджреЛрд╣рд░рд╛рдиреЗ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред

### рдХрд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреЛрдЯреНрд╕:

1. **ZEND_MODULE_API_NO:**
- `bypass.c` рдореЗрдВ `ZEND_MODULE_API_NO` рд╡рд░реНрддрдорд╛рди Zend Extension Build рд╕реЗ рдореЗрд▓ рдЦрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
php -i | grep "Zend Extension Build" |awk -F"API4" '{print $2}' | awk -F"," '{print $1}'
```

2. **PHP_FUNCTION рд╕рдВрд╢реЛрдзрди:**
- рд╣рд╛рд▓ рдХреЗ PHP рд╕рдВрд╕реНрдХрд░рдгреЛрдВ (5, 7, 8) рдХреЗ рд▓рд┐рдП, `PHP_FUNCTION(bypass_exec)` рдХреЛ рд╕рдорд╛рдпреЛрдЬрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХреЛрдб рд╕реНрдирд┐рдкреЗрдЯ рдЗрд╕ рд╕рдВрд╢реЛрдзрди рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрддрд╛ рд╣реИред

### рдХрд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ:

- **bypass.c**:
- рдХрд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдореБрдЦреНрдп рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред
- **php_bypass.h**:
- рд╣реЗрдбрд░ рдлрд╝рд╛рдЗрд▓, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЧреБрдгреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИред
- **config.m4**:
- рдХрд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдорд╛рдг рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `phpize` рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рдирд┐рд░реНрдорд╛рдг:

1. **рд╕рдВрдХрд▓рди рдХрдорд╛рдВрдб:**
- рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `phpize`, `./configure`, рдФрд░ `make` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред
- рдкрд░рд┐рдгрд╛рдореА `bypass.so` рдлрд┐рд░ рдореЙрдбреНрдпреВрд▓ рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддрд╛ рд╣реИред

2. **рд╕рд╛рдл-рд╕рдлрд╛рдИ:**
- рд╕рдВрдХрд▓рди рдХреЗ рдмрд╛рдж `make clean` рдФрд░ `phpize --clean` рдЪрд▓рд╛рддрд╛ рд╣реИред

### рдкреАрдбрд╝рд┐рдд рд╣реЛрд╕реНрдЯ рдкрд░ рдЕрдкрд▓реЛрдб рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди:

1. **рд╕рдВрд╕реНрдХрд░рдг рд╕рдВрдЧрддрддрд╛:**
- рд╣рдорд▓рд╛рд╡рд░ рдФрд░ рдкреАрдбрд╝рд┐рдд рдХреЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдмреАрдЪ PHP API рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХрд╛ рдореЗрд▓ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред

2. **рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд▓реЛрдбрд┐рдВрдЧ:**
- `dl` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рд╕рд╛рдкреЗрдХреНрд╖ рдкрдереЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИред

3. **рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрди:**
- рд╣рдорд▓рд╛рд╡рд░ `bypass.so` рдФрд░ рдПрдХ PHP рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдкреАрдбрд╝рд┐рдд рдХреЗ рд╕рд░реНрд╡рд░ рдкрд░ рдЕрдкрд▓реЛрдб рдХрд░рддрд╛ рд╣реИред
- рд╕реНрдХреНрд░рд┐рдкреНрдЯ `bypass.so` рдХреЛ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `dl_local` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ рдФрд░ рдлрд┐рд░ `cmd` рдХреНрд╡реЗрд░реА рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╛рд╕ рдХрд┐рдП рдЧрдП рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде `bypass_exec` рдХреЛ рдХреЙрд▓ рдХрд░рддреА рд╣реИред

### рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрди:

- рд╣рдорд▓рд╛рд╡рд░ рдЕрдм рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ: `http://www.example.com/script.php?cmd=<command>`


рдпрд╣ рд╡рд┐рд╕реНрддреГрдд рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдХрд╛ рдПрдХ PHP рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдмрдирд╛рдиреЗ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд░реЗрдЦрд╛рдВрдХрд┐рдд рдХрд░рддреА рд╣реИ, `dl` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдЬрд┐рд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдЙрд▓реНрд▓рдВрдШрдиреЛрдВ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
