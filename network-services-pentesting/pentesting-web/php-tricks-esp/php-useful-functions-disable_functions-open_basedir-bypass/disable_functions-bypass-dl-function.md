{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**Belangrike nota:**

![image](https://user-images.githubusercontent.com/84577967/174675487-a4c4ca06-194f-4725-85af-231a2f35d56c.png)

**`dl`** is 'n PHP-funksie wat gebruik kan word om PHP-uitbreidings te laai. As die funksie nie gedeaktiveer is nie, kan dit misbruik word om **`disable_functions` te omseil en arbitr√™re opdragte uit te voer**.\
Dit het egter 'n paar streng beperkings:

* Die `dl` funksie moet **teenwoordig** wees in die **omgewing** en **nie gedeaktiveer** wees nie
* Die PHP-uitbreiding **moet saamgecompileer wees met dieselfde hoofweergawe** (PHP API-weergawe) wat die bediener gebruik (jy kan hierdie inligting in die uitvoer van phpinfo sien)
* Die PHP-uitbreiding moet **gele√´ wees in die gids** wat **definieer** is deur die **`extension_dir`** riglyn (jy kan dit in die uitvoer van phpinfo sien). Dit is baie onwaarskynlik dat 'n aanvaller wat probeer om die bediener te misbruik, skryfre√´ls oor hierdie gids sal h√™, so hierdie vereiste sal waarskynlik voorkom dat jy hierdie tegniek misbruik).

**As jy aan hierdie vereistes voldoen, gaan voort om die pos te lees** [**https://antichat.com/threads/70763/**](https://antichat.com/threads/70763/) **om te leer hoe om disable\_functions te omseil**. Hier is 'n opsomming:

Die [dl funksie](http://www.php.net/manual/en/function.dl.php) word gebruik om PHP-uitbreidings dinamies tydens skripuitvoering te laai. PHP-uitbreidings, tipies geskryf in C/C++, verbeter PHP se funksionaliteit. Die aanvaller, toe hy opgemerk het dat die `dl` funksie nie gedeaktiveer is nie, besluit om 'n pasgemaakte PHP-uitbreiding te skep om stelselsopdragte uit te voer.

### Stappe geneem deur die aanvaller:

1. **PHP Weergawe Identifikasie:**
- Die aanvaller bepaal die PHP-weergawe met 'n skrip (`<?php echo 'PHP Version is '.PHP_VERSION; ?>`).

2. **PHP Bron Verkryging:**
- Laai die PHP-bron van die amptelike [PHP-webwerf](http://www.php.net/downloads.php) of die [argief](http://museum.php.net) af as die weergawe ouer is.

3. **Plaaslike PHP Opstelling:**
- Onthul en installeer die spesifieke PHP-weergawe op hul stelsel.

4. **Uitbreiding Skepping:**
- Bestudeer [die skepping van PHP-uitbreidings](http://www.php.net/manual/en/zend.creating.php) en ondersoek die PHP-bronkode.
- Fokus op die duplisering van die funksionaliteit van die [exec funksie](http://www.php.net/manual/en/function.exec.php) gele√´ by `ext/standard/exec.c`.

### Aantekeninge vir die saamstel van die pasgemaakte uitbreiding:

1. **ZEND_MODULE_API_NO:**
- Die `ZEND_MODULE_API_NO` in `bypass.c` moet ooreenstem met die huidige Zend Extension Build, wat verkry kan word met:
```bash
php -i | grep "Zend Extension Build" |awk -F"API4" '{print $2}' | awk -F"," '{print $1}'
```

2. **PHP_FUNCTION Wysiging:**
- Vir onlangse PHP-weergawe (5, 7, 8), mag `PHP_FUNCTION(bypass_exec)` aanpassing benodig. Die verskafde kode-snippet detail hierdie aanpassing.

### Pasgemaakte Uitbreidingsl√™ers:

- **bypass.c**:
- Implementeer die kernfunksionaliteit van die pasgemaakte uitbreiding.
- **php_bypass.h**:
- Kopl√™er, wat uitbreidingseienskappe definieer.
- **config.m4**:
- Gebruik deur `phpize` om die bou-omgewing vir die pasgemaakte uitbreiding te konfigureer.

### Bou van die Uitbreiding:

1. **Saamstel Opdragte:**
- Gebruik `phpize`, `./configure`, en `make` om die uitbreiding saam te stel.
- Die resulterende `bypass.so` is dan gele√´ in die modules subgids.

2. **Skoonmaak:**
- Voer `make clean` en `phpize --clean` uit na saamstel.

### Oplaai en Uitvoering op die Slachtoffer Gasheer:

1. **Weergawe Kompatibiliteit:**
- Verseker dat PHP API-weergawe ooreenstem tussen die aanvaller se en die slagoffer se stelsels.

2. **Uitbreiding Laai:**
- Gebruik die `dl` funksie, omseil beperkings deur relatiewe paaie of 'n skrip te gebruik om die proses te outomatiseer.

3. **Skrip Uitvoering:**
- Die aanvaller laai `bypass.so` en 'n PHP-skrip na die slagoffer se bediener op.
- Die skrip gebruik `dl_local` funksie om dinamies `bypass.so` te laai en roep dan `bypass_exec` aan met 'n opdrag wat deur die `cmd` vraeparameter oorgedra word.

### Opdrag Uitvoering:

- Die aanvaller kan nou opdragte uitvoer deur toegang te verkry tot: `http://www.example.com/script.php?cmd=<command>`


Hierdie gedetailleerde stap-vir-stap gids skets die proses van die skepping en implementering van 'n PHP-uitbreiding om stelselsopdragte uit te voer, wat die `dl` funksie misbruik, wat idealiter gedeaktiveer moet wees om sulke sekuriteitsbreuke te voorkom.


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
