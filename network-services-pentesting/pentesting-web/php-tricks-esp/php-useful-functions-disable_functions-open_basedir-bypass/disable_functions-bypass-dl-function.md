<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

**VaÅ¾na napomena:**

![image](https://user-images.githubusercontent.com/84577967/174675487-a4c4ca06-194f-4725-85af-231a2f35d56c.png)

**`dl`** je PHP funkcija koja se moÅ¾e koristiti za uÄitavanje PHP ekstenzija. Ako funkcija nije onemoguÄ‡ena, moÅ¾e se zloupotrebiti da bi se **zaobiÅ¡le `disable_functions` i izvrÅ¡ile proizvoljne komande**.\
MeÄ‘utim, postoje neka stroga ograniÄenja:

* Funkcija `dl` mora biti **prisutna** u **okruÅ¾enju** i **ne sme biti onemoguÄ‡ena**
* PHP ekstenzija mora biti **kompajlirana sa istom glavnom verzijom** (PHP API verzija) koju koristi server (ovu informaciju moÅ¾ete videti u izlazu phpinfo)
* PHP ekstenzija mora biti **smjeÅ¡tena u direktorijumu** koji je **definisan** direktivom **`extension_dir`** (moÅ¾ete je videti u izlazu phpinfo). Vrlo je malo verovatno da Ä‡e napadaÄ koji pokuÅ¡ava zloupotrebiti server imati pristup pisanju u ovaj direktorijum, pa Ä‡e ovo zahtevanje verovatno spreÄiti zloupotrebu ove tehnike).

**Ako ispunjavate ove zahteve, nastavite Äitati post** [**https://antichat.com/threads/70763/**](https://antichat.com/threads/70763/) **da biste nauÄili kako zaobiÄ‡i disable\_functions**. Evo saÅ¾etka:

[dl funkcija](http://www.php.net/manual/en/function.dl.php) se koristi za dinamiÄko uÄitavanje PHP ekstenzija tokom izvrÅ¡avanja skripte. PHP ekstenzije, obiÄno napisane u C/C++, poboljÅ¡avaju funkcionalnost PHP-a. NapadaÄ, primetivÅ¡i da funkcija `dl` nije onemoguÄ‡ena, odluÄuje da napravi prilagoÄ‘enu PHP ekstenziju za izvrÅ¡avanje sistemskih komandi.

### Koraci koje preduzima napadaÄ:

1. **Identifikacija verzije PHP-a:**
- NapadaÄ odreÄ‘uje verziju PHP-a koristeÄ‡i skriptu (`<?php echo 'PHP verzija je '.PHP_VERSION; ?>`).

2. **Dobavljanje izvornog koda PHP-a:**
- Preuzima izvorni kod PHP-a sa zvaniÄne [PHP veb stranice](http://www.php.net/downloads.php) ili [arhive](http://museum.php.net) ako je verzija starija.

3. **Lokalno podeÅ¡avanje PHP-a:**
- Izdvaja i instalira odreÄ‘enu verziju PHP-a na svom sistemu.

4. **Kreiranje ekstenzije:**
- ProuÄava [kreiranje PHP ekstenzija](http://www.php.net/manual/en/zend.creating.php) i pregleda izvorni kod PHP-a.
- Fokusira se na dupliciranje funkcionalnosti [exec funkcije](http://www.php.net/manual/en/function.exec.php) koja se nalazi u `ext/standard/exec.c`.

### Napomene za kompajliranje prilagoÄ‘ene ekstenzije:

1. **ZEND_MODULE_API_NO:**
- `ZEND_MODULE_API_NO` u `bypass.c` mora se podudarati sa trenutnom Zend Extension Build-om, koji se moÅ¾e dobiti sa:
```bash
php -i | grep "Zend Extension Build" |awk -F"API4" '{print $2}' | awk -F"," '{print $1}'
```

2. **Modifikacija PHP_FUNCTION:**
- Za nove verzije PHP-a (5, 7, 8), moÅ¾da Ä‡e biti potrebna prilagoÄ‘avanje `PHP_FUNCTION(bypass_exec)`. PriloÅ¾eni kod detaljno opisuje ovu modifikaciju.

### Datoteke prilagoÄ‘ene ekstenzije:

- **bypass.c**:
- Implementira osnovnu funkcionalnost prilagoÄ‘ene ekstenzije.
- **php_bypass.h**:
- Header datoteka koja definiÅ¡e osobine ekstenzije.
- **config.m4**:
- Koristi se od strane `phpize` za konfigurisanje okruÅ¾enja za izgradnju prilagoÄ‘ene ekstenzije.

### Izgradnja ekstenzije:

1. **Komande za kompajliranje:**
- Koristi `phpize`, `./configure` i `make` za kompajliranje ekstenzije.
- RezultirajuÄ‡i `bypass.so` se zatim nalazi u poddirektorijumu modules.

2. **ÄŒiÅ¡Ä‡enje:**
- PokreÄ‡e `make clean` i `phpize --clean` nakon kompajliranja.

### Postavljanje i izvrÅ¡avanje na Å¾rtvinoj maÅ¡ini:

1. **Kompatibilnost verzija:**
- Osigurava da se PHP API verzije podudaraju izmeÄ‘u napadaÄevog i Å¾rtvinog sistema.

2. **UÄitavanje ekstenzije:**
- Koristi funkciju `dl`, zaobilazeÄ‡i ograniÄenja koriÅ¡Ä‡enjem relativnih putanja ili skripta za automatizaciju procesa.

3. **IzvrÅ¡avanje skripte:**
- NapadaÄ postavlja `bypass.so` i PHP skriptu na server Å¾rtve.
- Skripta koristi funkciju `dl_local` za dinamiÄko uÄitavanje `bypass.so`, a zatim poziva `bypass_exec` sa komandom koja se prenosi putem upita `cmd`.

### IzvrÅ¡avanje komandi:

- NapadaÄ sada moÅ¾e izvrÅ¡avati komande pristupanjem: `http://www.example.com/script.php?cmd=<komanda>`


Ovaj detaljni vodiÄ opisuje proces kreiranja i implementacije PHP ekstenzije za izvrÅ¡avanje sistemskih komandi, iskoriÅ¡Ä‡avajuÄ‡i funkciju `dl`, koja bi idealno trebala biti onemoguÄ‡ena kako bi se spreÄila takva sigurnosna ugroÅ¾avanja.


<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**
