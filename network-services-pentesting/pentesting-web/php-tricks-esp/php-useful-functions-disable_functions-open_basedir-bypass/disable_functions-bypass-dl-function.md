{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**Ã–nemli not:**

![image](https://user-images.githubusercontent.com/84577967/174675487-a4c4ca06-194f-4725-85af-231a2f35d56c.png)

**`dl`** PHP uzantÄ±larÄ±nÄ± yÃ¼klemek iÃ§in kullanÄ±labilen bir PHP fonksiyonudur. EÄŸer bu fonksiyon devre dÄ±ÅŸÄ± bÄ±rakÄ±lmamÄ±ÅŸsa, **`disable_functions` bypass etmek ve keyfi komutlar Ã§alÄ±ÅŸtÄ±rmak iÃ§in kÃ¶tÃ¼ye kullanÄ±labilir**.\
Ancak, bazÄ± katÄ± sÄ±nÄ±rlamalarÄ± vardÄ±r:

* `dl` fonksiyonu **mevcut** olmalÄ± ve **devre dÄ±ÅŸÄ± bÄ±rakÄ±lmamalÄ±dÄ±r**
* PHP uzantÄ±sÄ±, sunucunun kullandÄ±ÄŸÄ± **aynÄ± ana sÃ¼rÃ¼mle** (PHP API sÃ¼rÃ¼mÃ¼) derlenmiÅŸ olmalÄ±dÄ±r (bu bilgiyi phpinfo Ã§Ä±ktÄ±sÄ±nda gÃ¶rebilirsiniz)
* PHP uzantÄ±sÄ±, **`extension_dir`** direktifi ile **tanÄ±mlanan** dizinde **bulunmalÄ±dÄ±r** (bunu phpinfo Ã§Ä±ktÄ±sÄ±nda gÃ¶rebilirsiniz). Bir saldÄ±rganÄ±n bu dizinde yazma eriÅŸimine sahip olmasÄ± Ã§ok olasÄ± deÄŸildir, bu nedenle bu gereklilik muhtemelen bu tekniÄŸi kÃ¶tÃ¼ye kullanmanÄ±zÄ± engelleyecektir.

**Bu gereklilikleri karÅŸÄ±lÄ±yorsanÄ±z, `disable_functions` bypass etmeyi Ã¶ÄŸrenmek iÃ§in yazÄ±yÄ± okumaya devam edin** [**https://antichat.com/threads/70763/**](https://antichat.com/threads/70763/). Ä°ÅŸte bir Ã¶zet:

[dl fonksiyonu](http://www.php.net/manual/en/function.dl.php), script Ã§alÄ±ÅŸtÄ±rma sÄ±rasÄ±nda PHP uzantÄ±larÄ±nÄ± dinamik olarak yÃ¼klemek iÃ§in kullanÄ±lÄ±r. Genellikle C/C++ ile yazÄ±lan PHP uzantÄ±larÄ±, PHP'nin iÅŸlevselliÄŸini artÄ±rÄ±r. SaldÄ±rgan, `dl` fonksiyonunun devre dÄ±ÅŸÄ± bÄ±rakÄ±lmadÄ±ÄŸÄ±nÄ± fark ettiÄŸinde, sistem komutlarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in Ã¶zel bir PHP uzantÄ±sÄ± oluÅŸturmayÄ± karar verir.

### SaldÄ±rganÄ±n AldÄ±ÄŸÄ± AdÄ±mlar:

1. **PHP SÃ¼rÃ¼m Belirleme:**
- SaldÄ±rgan, bir script kullanarak PHP sÃ¼rÃ¼mÃ¼nÃ¼ belirler (`<?php echo 'PHP Version is '.PHP_VERSION; ?>`).

2. **PHP KaynaÄŸÄ±nÄ± Temin Etme:**
- Resmi [PHP web sitesinden](http://www.php.net/downloads.php) veya sÃ¼rÃ¼m eskiyse [arÅŸivden](http://museum.php.net) PHP kaynaÄŸÄ±nÄ± indirir.

3. **Yerel PHP Kurulumu:**
- Belirli PHP sÃ¼rÃ¼mÃ¼nÃ¼ sistemine Ã§Ä±karÄ±r ve kurar.

4. **UzantÄ± OluÅŸturma:**
- [PHP uzantÄ±larÄ± oluÅŸturmayÄ±](http://www.php.net/manual/en/zend.creating.php) inceler ve PHP kaynak kodunu gÃ¶zden geÃ§irir.
- `ext/standard/exec.c` dosyasÄ±ndaki [exec fonksiyonunun](http://www.php.net/manual/en/function.exec.php) iÅŸlevselliÄŸini Ã§oÄŸaltmaya odaklanÄ±r.

### Ã–zel UzantÄ±yÄ± Derleme NotlarÄ±:

1. **ZEND_MODULE_API_NO:**
- `bypass.c` iÃ§indeki `ZEND_MODULE_API_NO`, mevcut Zend Extension Build ile eÅŸleÅŸmelidir, bu bilgi ÅŸu komutla alÄ±nabilir:
```bash
php -i | grep "Zend Extension Build" |awk -F"API4" '{print $2}' | awk -F"," '{print $1}'
```

2. **PHP_FUNCTION DeÄŸiÅŸikliÄŸi:**
- Son PHP sÃ¼rÃ¼mleri (5, 7, 8) iÃ§in `PHP_FUNCTION(bypass_exec)` ayarlanmasÄ± gerekebilir. SaÄŸlanan kod parÃ§asÄ± bu deÄŸiÅŸikliÄŸi detaylandÄ±rÄ±r.

### Ã–zel UzantÄ± DosyalarÄ±:

- **bypass.c**:
- Ã–zel uzantÄ±nÄ±n temel iÅŸlevselliÄŸini uygular.
- **php_bypass.h**:
- UzantÄ± Ã¶zelliklerini tanÄ±mlayan baÅŸlÄ±k dosyasÄ±.
- **config.m4**:
- Ã–zel uzantÄ±nÄ±n derleme ortamÄ±nÄ± yapÄ±landÄ±rmak iÃ§in `phpize` tarafÄ±ndan kullanÄ±lÄ±r.

### UzantÄ±yÄ± Derleme:

1. **Derleme KomutlarÄ±:**
- UzantÄ±yÄ± derlemek iÃ§in `phpize`, `./configure` ve `make` kullanÄ±r.
- Ortaya Ã§Ä±kan `bypass.so`, modÃ¼ller alt dizininde bulunur.

2. **Temizlik:**
- Derlemeden sonra `make clean` ve `phpize --clean` komutlarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rÄ±r.

### Kurban Sunucusuna YÃ¼kleme ve Ã‡alÄ±ÅŸtÄ±rma:

1. **SÃ¼rÃ¼m UyumluluÄŸu:**
- SaldÄ±rganÄ±n ve kurbanÄ±n sistemleri arasÄ±nda PHP API sÃ¼rÃ¼mlerinin eÅŸleÅŸtiÄŸinden emin olur.

2. **UzantÄ± YÃ¼kleme:**
- `dl` fonksiyonunu kullanarak, kÄ±sÄ±tlamalarÄ± aÅŸmak iÃ§in gÃ¶receli yollar veya sÃ¼reci otomatikleÅŸtiren bir script kullanÄ±r.

3. **Script Ã‡alÄ±ÅŸtÄ±rma:**
- SaldÄ±rgan, `bypass.so` ve bir PHP scriptini kurbanÄ±n sunucusuna yÃ¼kler.
- Script, `bypass.so`'yu dinamik olarak yÃ¼klemek iÃ§in `dl_local` fonksiyonunu kullanÄ±r ve ardÄ±ndan `cmd` sorgu parametresi aracÄ±lÄ±ÄŸÄ±yla geÃ§irilen bir komut ile `bypass_exec` Ã§aÄŸrÄ±sÄ±nda bulunur.

### Komut Ã‡alÄ±ÅŸtÄ±rma:

- SaldÄ±rgan artÄ±k komutlarÄ± ÅŸu ÅŸekilde Ã§alÄ±ÅŸtÄ±rabilir: `http://www.example.com/script.php?cmd=<command>`


Bu ayrÄ±ntÄ±lÄ± inceleme, sistem komutlarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in bir PHP uzantÄ±sÄ± oluÅŸturma ve daÄŸÄ±tma sÃ¼recini, `dl` fonksiyonunu kÃ¶tÃ¼ye kullanarak aÃ§Ä±klamaktadÄ±r; bu, bu tÃ¼r gÃ¼venlik ihlallerini Ã¶nlemek iÃ§in ideal olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±lmalÄ±dÄ±r.


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
