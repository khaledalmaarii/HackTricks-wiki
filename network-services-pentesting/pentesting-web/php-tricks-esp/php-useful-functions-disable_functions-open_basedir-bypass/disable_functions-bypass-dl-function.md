{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** π’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** π¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**μ¤‘μ”ν• μ°Έκ³  μ‚¬ν•­:**

![image](https://user-images.githubusercontent.com/84577967/174675487-a4c4ca06-194f-4725-85af-231a2f35d56c.png)

**`dl`**μ€ PHP ν™•μ¥μ„ λ΅λ“ν•λ” λ° μ‚¬μ©ν•  μ μλ” PHP ν•¨μμ…λ‹λ‹¤. μ΄ ν•¨μκ°€ λΉ„ν™μ„±ν™”λμ§€ μ•μ•λ‹¤λ©΄ **`disable_functions`λ¥Ό μ°νν•κ³  μ„μμ λ…λ Ήμ„ μ‹¤ν–‰ν•λ” λ° μ•…μ©λ  μ μμµλ‹λ‹¤**.\
κ·Έλ¬λ‚ λ‡ κ°€μ§€ μ—„κ²©ν• μ ν•μ΄ μμµλ‹λ‹¤:

* `dl` ν•¨μλ” **ν™κ²½μ— μ΅΄μ¬ν•΄μ•Ό ν•λ©°** **λΉ„ν™μ„±ν™”λμ§€ μ•μ•„μ•Ό ν•©λ‹λ‹¤**
* PHP ν™•μ¥μ€ μ„λ²„μ—μ„ μ‚¬μ©ν•λ” **λ™μΌν• μ£Όμ” λ²„μ „**(PHP API λ²„μ „)μΌλ΅ μ»΄νμΌλμ–΄μ•Ό ν•©λ‹λ‹¤(μ΄ μ •λ³΄λ” phpinfoμ μ¶λ ¥μ—μ„ ν™•μΈν•  μ μμµλ‹λ‹¤)
* PHP ν™•μ¥μ€ **`extension_dir`** μ§€μ‹μ–΄μ— μν•΄ **μ •μλ λ””λ ‰ν† λ¦¬**μ— **μ„μΉν•΄μ•Ό ν•©λ‹λ‹¤**(μ΄ μ •λ³΄λ” phpinfoμ μ¶λ ¥μ—μ„ ν™•μΈν•  μ μμµλ‹λ‹¤). μ„λ²„λ¥Ό μ•…μ©ν•λ ¤λ” κ³µκ²©μκ°€ μ΄ λ””λ ‰ν† λ¦¬μ— λ€ν• μ“°κΈ° κ¶ν•μ„ κ°€μ§ κ°€λ¥μ„±μ€ λ§¤μ° λ‚®μΌλ―€λ΅, μ΄ μ”κµ¬ μ‚¬ν•­μ€ μ•„λ§λ„ μ΄ κΈ°μ μ„ μ•…μ©ν•λ” κ²ƒμ„ λ°©μ§€ν•  κ²ƒμ…λ‹λ‹¤.

**μ΄ μ”κµ¬ μ‚¬ν•­μ„ μ¶©μ΅±ν•λ©΄, `disable_functions`λ¥Ό μ°νν•λ” λ°©λ²•μ„ λ°°μ°κΈ° μ„ν•΄ μ΄ κ²μ‹λ¬Όμ„ κ³„μ† μ½μΌμ‹­μ‹μ¤** [**https://antichat.com/threads/70763/**](https://antichat.com/threads/70763/). λ‹¤μμ€ μ”μ•½μ…λ‹λ‹¤:

[dl ν•¨μ](http://www.php.net/manual/en/function.dl.php)λ” μ¤ν¬λ¦½νΈ μ‹¤ν–‰ μ¤‘μ— PHP ν™•μ¥μ„ λ™μ μΌλ΅ λ΅λ“ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤. PHP ν™•μ¥μ€ μΌλ°μ μΌλ΅ C/C++λ΅ μ‘μ„±λμ–΄ PHPμ κΈ°λ¥μ„ ν–¥μƒμ‹ν‚µλ‹λ‹¤. κ³µκ²©μλ” `dl` ν•¨μκ°€ λΉ„ν™μ„±ν™”λμ§€ μ•μ€ κ²ƒμ„ λ°κ²¬ν•κ³  μ‹μ¤ν… λ…λ Ήμ„ μ‹¤ν–‰ν•κΈ° μ„ν•΄ μ‚¬μ©μ μ •μ PHP ν™•μ¥μ„ λ§λ“¤κΈ°λ΅ κ²°μ •ν•©λ‹λ‹¤.

### κ³µκ²©μκ°€ μ·¨ν• λ‹¨κ³„:

1. **PHP λ²„μ „ μ‹λ³„:**
- κ³µκ²©μλ” μ¤ν¬λ¦½νΈ(`<?php echo 'PHP Version is '.PHP_VERSION; ?>`)λ¥Ό μ‚¬μ©ν•μ—¬ PHP λ²„μ „μ„ ν™•μΈν•©λ‹λ‹¤.

2. **PHP μ†μ¤ νλ“:**
- κ³µμ‹ [PHP μ›Ήμ‚¬μ΄νΈ](http://www.php.net/downloads.php) λλ” λ²„μ „μ΄ μ¤λλ κ²½μ° [μ•„μΉ΄μ΄λΈ](http://museum.php.net)μ—μ„ PHP μ†μ¤λ¥Ό λ‹¤μ΄λ΅λ“ν•©λ‹λ‹¤.

3. **λ΅μ»¬ PHP μ„¤μ •:**
- νΉμ • PHP λ²„μ „μ„ μμ‹ μ μ‹μ¤ν…μ— μ¶”μ¶ν•κ³  μ„¤μΉν•©λ‹λ‹¤.

4. **ν™•μ¥ μƒμ„±:**
- [PHP ν™•μ¥ λ§λ“¤κΈ°](http://www.php.net/manual/en/zend.creating.php)λ¥Ό μ—°κµ¬ν•κ³  PHP μ†μ¤ μ½”λ“λ¥Ό κ²€μ‚¬ν•©λ‹λ‹¤.
- `ext/standard/exec.c`μ— μ„μΉν• [exec ν•¨μ](http://www.php.net/manual/en/function.exec.php)μ κΈ°λ¥μ„ λ³µμ ν•λ” λ° μ§‘μ¤‘ν•©λ‹λ‹¤.

### μ‚¬μ©μ μ •μ ν™•μ¥μ„ μ»΄νμΌν•κΈ° μ„ν• μ£Όμ μ‚¬ν•­:

1. **ZEND_MODULE_API_NO:**
- `bypass.c`μ `ZEND_MODULE_API_NO`λ” ν„μ¬ Zend Extension Buildμ™€ μΌμΉν•΄μ•Ό ν•λ©°, λ‹¤μ λ…λ ΉμΌλ΅ κ²€μƒ‰ν•  μ μμµλ‹λ‹¤:
```bash
php -i | grep "Zend Extension Build" |awk -F"API4" '{print $2}' | awk -F"," '{print $1}'
```

2. **PHP_FUNCTION μμ •:**
- μµκ·Ό PHP λ²„μ „(5, 7, 8)μ κ²½μ° `PHP_FUNCTION(bypass_exec)`λ¥Ό μ΅°μ •ν•΄μ•Ό ν•  μ μμµλ‹λ‹¤. μ κ³µλ μ½”λ“ μ¤λ‹ν«μ—μ„ μ΄ μμ •μ„ μμ„Έν μ„¤λ…ν•©λ‹λ‹¤.

### μ‚¬μ©μ μ •μ ν™•μ¥ νμΌ:

- **bypass.c**:
- μ‚¬μ©μ μ •μ ν™•μ¥μ ν•µμ‹¬ κΈ°λ¥μ„ κµ¬ν„ν•©λ‹λ‹¤.
- **php_bypass.h**:
- ν™•μ¥ μ†μ„±μ„ μ •μν•λ” ν—¤λ” νμΌμ…λ‹λ‹¤.
- **config.m4**:
- μ‚¬μ©μ μ •μ ν™•μ¥μ„ μ„ν• λΉλ“ ν™κ²½μ„ κµ¬μ„±ν•λ” λ° `phpize`μ— μν•΄ μ‚¬μ©λ©λ‹λ‹¤.

### ν™•μ¥ λΉλ“:

1. **μ»΄νμΌ λ…λ Ή:**
- `phpize`, `./configure`, `make`λ¥Ό μ‚¬μ©ν•μ—¬ ν™•μ¥μ„ μ»΄νμΌν•©λ‹λ‹¤.
- κ²°κ³Όμ μΌλ΅ μƒμ„±λ `bypass.so`λ” λ¨λ“ ν•μ„ λ””λ ‰ν† λ¦¬μ— μ„μΉν•©λ‹λ‹¤.

2. **μ •λ¦¬:**
- μ»΄νμΌ ν›„ `make clean` λ° `phpize --clean`μ„ μ‹¤ν–‰ν•©λ‹λ‹¤.

### ν”Όν•΄μ νΈμ¤νΈμ— μ—…λ΅λ“ λ° μ‹¤ν–‰:

1. **λ²„μ „ νΈν™μ„±:**
- κ³µκ²©μμ™€ ν”Όν•΄μμ μ‹μ¤ν… κ°„μ— PHP API λ²„μ „μ΄ μΌμΉν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

2. **ν™•μ¥ λ΅λ“:**
- μƒλ€ κ²½λ΅λ¥Ό μ‚¬μ©ν•κ±°λ‚ ν”„λ΅μ„Έμ¤λ¥Ό μλ™ν™”ν•λ” μ¤ν¬λ¦½νΈλ¥Ό μ‚¬μ©ν•μ—¬ `dl` ν•¨μλ¥Ό ν™μ©ν•μ—¬ μ ν•μ„ μ°νν•©λ‹λ‹¤.

3. **μ¤ν¬λ¦½νΈ μ‹¤ν–‰:**
- κ³µκ²©μλ” `bypass.so`μ™€ PHP μ¤ν¬λ¦½νΈλ¥Ό ν”Όν•΄μμ μ„λ²„μ— μ—…λ΅λ“ν•©λ‹λ‹¤.
- μ¤ν¬λ¦½νΈλ” `dl_local` ν•¨μλ¥Ό μ‚¬μ©ν•μ—¬ `bypass.so`λ¥Ό λ™μ μΌλ΅ λ΅λ“ν• λ‹¤μ `cmd` μΏΌλ¦¬ λ§¤κ°λ³€μλ¥Ό ν†µν•΄ μ „λ‹¬λ λ…λ ΉμΌλ΅ `bypass_exec`λ¥Ό νΈμ¶ν•©λ‹λ‹¤.

### λ…λ Ή μ‹¤ν–‰:

- κ³µκ²©μλ” μ΄μ  λ‹¤μμ„ ν†µν•΄ λ…λ Ήμ„ μ‹¤ν–‰ν•  μ μμµλ‹λ‹¤: `http://www.example.com/script.php?cmd=<command>`

μ΄ μƒμ„Έν• μ μ°¨λ” μ‹μ¤ν… λ…λ Ήμ„ μ‹¤ν–‰ν•κΈ° μ„ν•΄ PHP ν™•μ¥μ„ μƒμ„±ν•κ³  λ°°ν¬ν•λ” κ³Όμ •μ„ μ„¤λ…ν•λ©°, `dl` ν•¨μλ¥Ό μ•…μ©ν•μ—¬ μ΄λ¬ν• λ³΄μ• μΉ¨ν•΄λ¥Ό λ°©μ§€ν•κΈ° μ„ν•΄ μ΄μƒμ μΌλ΅ λΉ„ν™μ„±ν™”λμ–΄μ•Ό ν•©λ‹λ‹¤.


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** π’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** π¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
