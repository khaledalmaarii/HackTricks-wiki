# ç‰¹æ®Šçš„HTTPå¤´éƒ¨

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­è¢«å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## Wordlists & Tools

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## æ›´æ”¹ä½ç½®çš„å¤´éƒ¨

é‡å†™**IPæ¥æº**ï¼š

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For`ï¼ˆæ£€æŸ¥é€è·³å¤´éƒ¨ï¼‰

é‡å†™**ä½ç½®**ï¼š

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## é€è·³å¤´éƒ¨

é€è·³å¤´éƒ¨æ˜¯è®¾è®¡ä¸ºç”±å½“å‰å¤„ç†è¯·æ±‚çš„ä»£ç†å¤„ç†å’Œæ¶ˆè€—çš„å¤´éƒ¨ï¼Œè€Œä¸æ˜¯ç«¯åˆ°ç«¯å¤´éƒ¨ã€‚

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTPè¯·æ±‚åŠ«æŒ

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## ç¼“å­˜å¤´éƒ¨

**æœåŠ¡å™¨ç¼“å­˜å¤´éƒ¨**ï¼š

* **`X-Cache`**åœ¨å“åº”ä¸­çš„å€¼å¯èƒ½ä¸º**`miss`**ï¼ˆè¯·æ±‚æœªè¢«ç¼“å­˜ï¼‰æˆ–**`hit`**ï¼ˆå·²è¢«ç¼“å­˜ï¼‰
* **`Cache-Control`**æŒ‡ç¤ºèµ„æºæ˜¯å¦è¢«ç¼“å­˜ä»¥åŠä¸‹æ¬¡èµ„æºå†æ¬¡è¢«ç¼“å­˜çš„æ—¶é—´ï¼š`Cache-Control: public, max-age=1800`
* **`Vary`**é€šå¸¸åœ¨å“åº”ä¸­ç”¨äº**æŒ‡ç¤ºé¢å¤–çš„å¤´éƒ¨**ï¼Œå³ä½¿å®ƒä»¬é€šå¸¸ä¸æ˜¯å…³é”®çš„ä¹Ÿä¼šè¢«è§†ä¸º**ç¼“å­˜é”®**çš„ä¸€éƒ¨åˆ†ã€‚
* **`Age`**å®šä¹‰äº†å¯¹è±¡åœ¨ä»£ç†ç¼“å­˜ä¸­å­˜åœ¨çš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚
* **`Server-Timing: cdn-cache; desc=HIT`**ä¹Ÿè¡¨ç¤ºèµ„æºå·²è¢«ç¼“å­˜

{% content-ref url="../../pentesting-web/cache-deception.md" %}
[cache-deception.md](../../pentesting-web/cache-deception.md)
{% endcontent-ref %}

**æœ¬åœ°ç¼“å­˜å¤´éƒ¨**ï¼š

* `Clear-Site-Data`ï¼šæŒ‡ç¤ºåº”è¯¥è¢«ç§»é™¤çš„ç¼“å­˜çš„å¤´éƒ¨ï¼š`Clear-Site-Data: "cache", "cookies"`
* `Expires`ï¼šåŒ…å«å“åº”åº”è¯¥è¿‡æœŸçš„æ—¥æœŸ/æ—¶é—´ï¼š`Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache`ä¸`Cache-Control: no-cache`ç›¸åŒ
* `Warning`ï¼š**`Warning`**é€šç”¨HTTPå¤´éƒ¨åŒ…å«æœ‰å…³æ¶ˆæ¯çŠ¶æ€å¯èƒ½å­˜åœ¨é—®é¢˜çš„ä¿¡æ¯ã€‚å“åº”ä¸­å¯èƒ½ä¼šå‡ºç°å¤šä¸ª`Warning`å¤´éƒ¨ã€‚`Warning: 110 anderson/1.3.37 "Response is stale"`

## æ¡ä»¶

* ä½¿ç”¨è¿™äº›å¤´éƒ¨çš„è¯·æ±‚ï¼š**`If-Modified-Since`**å’Œ**`If-Unmodified-Since`**ä»…åœ¨å“åº”å¤´éƒ¨\*\*`Last-Modified`\*\*åŒ…å«ä¸åŒæ—¶é—´æ—¶æ‰ä¼šå“åº”æ•°æ®ã€‚
* ä½¿ç”¨**`If-Match`**å’Œ**`If-None-Match`**çš„æ¡ä»¶è¯·æ±‚ä½¿ç”¨Etagå€¼ï¼Œå› æ­¤å¦‚æœæ•°æ®ï¼ˆEtagï¼‰å·²æ›´æ”¹ï¼ŒWebæœåŠ¡å™¨å°†å‘é€å“åº”å†…å®¹ã€‚`Etag`æ˜¯ä»HTTPå“åº”ä¸­è·å–çš„ã€‚
* **Etag**å€¼é€šå¸¸åŸºäºå“åº”å†…å®¹è®¡ç®—ã€‚ä¾‹å¦‚ï¼Œ`ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"`è¡¨ç¤º`Etag`æ˜¯**37å­—èŠ‚**çš„å†…å®¹çš„**Sha1**ã€‚

## èŒƒå›´è¯·æ±‚

* **`Accept-Ranges`**ï¼šæŒ‡ç¤ºæœåŠ¡å™¨æ˜¯å¦æ”¯æŒèŒƒå›´è¯·æ±‚ï¼Œä»¥åŠèŒƒå›´å¯ä»¥ç”¨å“ªç§å•ä½è¡¨ç¤ºã€‚`Accept-Ranges: <range-unit>`
* **`Range`**ï¼šæŒ‡ç¤ºæœåŠ¡å™¨åº”è¿”å›æ–‡æ¡£çš„å“ªä¸ªéƒ¨åˆ†ã€‚
* **`If-Range`**ï¼šåˆ›å»ºä¸€ä¸ªæ¡ä»¶èŒƒå›´è¯·æ±‚ï¼Œä»…å½“ç»™å®šçš„ETagæˆ–æ—¥æœŸä¸è¿œç¨‹èµ„æºåŒ¹é…æ—¶æ‰ä¼šè¢«æ»¡è¶³ã€‚ç”¨äºé˜²æ­¢ä»ä¸å…¼å®¹ç‰ˆæœ¬çš„èµ„æºä¸‹è½½ä¸¤ä¸ªèŒƒå›´ã€‚
* **`Content-Range`**ï¼šæŒ‡ç¤ºå®Œæ•´æ¶ˆæ¯ä½“ä¸­éƒ¨åˆ†æ¶ˆæ¯æ‰€å±çš„ä½ç½®ã€‚

## æ¶ˆæ¯ä½“ä¿¡æ¯

* **`Content-Length`**ï¼šèµ„æºçš„å¤§å°ï¼Œä»¥åè¿›åˆ¶å­—èŠ‚æ•°è¡¨ç¤ºã€‚
* **`Content-Type`**ï¼šæŒ‡ç¤ºèµ„æºçš„åª’ä½“ç±»å‹
* **`Content-Encoding`**ï¼šç”¨äºæŒ‡å®šå‹ç¼©ç®—æ³•ã€‚
* **`Content-Language`**ï¼šæè¿°é¢å‘å—ä¼—çš„äººç±»è¯­è¨€ï¼Œä»¥ä¾¿ç”¨æˆ·æ ¹æ®è‡ªå·±çš„é¦–é€‰è¯­è¨€è¿›è¡ŒåŒºåˆ†ã€‚
* **`Content-Location`**ï¼šæŒ‡ç¤ºè¿”å›æ•°æ®çš„å¤‡ç”¨ä½ç½®ã€‚

ä»æ¸—é€æµ‹è¯•çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›ä¿¡æ¯é€šå¸¸æ˜¯â€œæ— ç”¨çš„â€ï¼Œä½†å¦‚æœèµ„æºå—åˆ°401æˆ–403çš„ä¿æŠ¤ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥æ‰¾åˆ°æŸç§æ–¹æ³•æ¥è·å–è¿™äº›ä¿¡æ¯ï¼Œé‚£å¯èƒ½ä¼šå¾ˆæœ‰è¶£ã€‚\
ä¾‹å¦‚ï¼Œé€šè¿‡HEADè¯·æ±‚ä¸­**`Range`**å’Œ**`Etag`**çš„ç»„åˆå¯ä»¥é€šè¿‡HEADè¯·æ±‚æ³„éœ²é¡µé¢å†…å®¹ï¼š

* å…·æœ‰å¤´éƒ¨`Range: bytes=20-20`çš„è¯·æ±‚ï¼Œå¹¶ä¸”å“åº”åŒ…å«`ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"`ï¼Œæ³„éœ²äº†å­—èŠ‚20çš„SHA1ä¸º`ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`

## æœåŠ¡å™¨ä¿¡æ¯

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## æ§åˆ¶

* **`Allow`**ï¼šæ­¤å¤´éƒ¨ç”¨äºé€šä¿¡èµ„æºå¯ä»¥å¤„ç†çš„HTTPæ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æŒ‡å®šä¸º`Allow: GET, POST, HEAD`ï¼Œè¡¨ç¤ºèµ„æºæ”¯æŒè¿™äº›æ–¹æ³•ã€‚
* **`Expect`**ï¼šå®¢æˆ·ç«¯ä½¿ç”¨æ­¤å¤´éƒ¨ä¼ è¾¾æœåŠ¡å™¨éœ€è¦æ»¡è¶³çš„æœŸæœ›ï¼Œä»¥ä¾¿æˆåŠŸå¤„ç†è¯·æ±‚ã€‚å¸¸è§ç”¨ä¾‹æ¶‰åŠ`Expect: 100-continue`å¤´éƒ¨ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ‰“ç®—å‘é€å¤§æ•°æ®è´Ÿè½½ã€‚å®¢æˆ·ç«¯åœ¨ç»§ç»­ä¼ è¾“ä¹‹å‰ç­‰å¾…`100 (Continue)`å“åº”ã€‚æ­¤æœºåˆ¶æœ‰åŠ©äºé€šè¿‡ç­‰å¾…æœåŠ¡å™¨ç¡®è®¤æ¥ä¼˜åŒ–ç½‘ç»œä½¿ç”¨ã€‚

## ä¸‹è½½

* HTTPå“åº”ä¸­çš„**`Content-Disposition`**å¤´éƒ¨æŒ‡ç¤ºæ–‡ä»¶åº”è¯¥æ˜¯**å†…è”**æ˜¾ç¤ºï¼ˆåœ¨ç½‘é¡µå†…éƒ¨ï¼‰è¿˜æ˜¯ä½œä¸º**é™„ä»¶**ï¼ˆä¸‹è½½ï¼‰ã€‚ä¾‹å¦‚ï¼š
```
Content-Disposition: attachment; filename="filename.jpg"
```
## å®‰å…¨å¤´éƒ¨

### å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰<a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **å—ä¿¡ä»»ç±»å‹**

é€šè¿‡CSPå¼ºåˆ¶æ‰§è¡Œå—ä¿¡ä»»ç±»å‹ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é˜²èŒƒDOM XSSæ”»å‡»ã€‚å—ä¿¡ä»»ç±»å‹ç¡®ä¿åªæœ‰ç¬¦åˆæ—¢å®šå®‰å…¨ç­–ç•¥çš„ç‰¹å®šå¯¹è±¡å¯ä»¥åœ¨å±é™©çš„Web APIè°ƒç”¨ä¸­ä½¿ç”¨ï¼Œä»è€Œé€šè¿‡é»˜è®¤æ–¹å¼ä¿æŠ¤JavaScriptä»£ç ã€‚
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

è¯¥æ ‡å¤´å¯é˜²æ­¢ MIME ç±»å‹å—…æ¢ï¼Œè¿™ç§åšæ³•å¯èƒ½å¯¼è‡´ XSS æ¼æ´ã€‚å®ƒç¡®ä¿æµè§ˆå™¨éµå®ˆæœåŠ¡å™¨æŒ‡å®šçš„ MIME ç±»å‹ã€‚
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

ä¸ºäº†é˜²æ­¢ç‚¹å‡»åŠ«æŒï¼Œè¯¥æ ‡å¤´é™åˆ¶äº†æ–‡æ¡£å¦‚ä½•åµŒå…¥åœ¨ `<frame>`, `<iframe>`, `<embed>`, æˆ– `<object>` æ ‡ç­¾ä¸­ï¼Œå»ºè®®æ‰€æœ‰æ–‡æ¡£æ˜ç¡®æŒ‡å®šå…¶åµŒå…¥æƒé™ã€‚
```
X-Frame-Options: DENY
```
### **è·¨æºèµ„æºç­–ç•¥ï¼ˆCORPï¼‰å’Œè·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰**

CORPå¯¹äºæŒ‡å®šç½‘ç«™å¯ä»¥åŠ è½½å“ªäº›èµ„æºè‡³å…³é‡è¦ï¼Œæœ‰åŠ©äºå‡è½»è·¨ç«™ç‚¹æ³„æ¼ã€‚å¦ä¸€æ–¹é¢ï¼ŒCORSå…è®¸æ›´çµæ´»çš„è·¨æºèµ„æºå…±äº«æœºåˆ¶ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ”¾å®½äº†åŒæºç­–ç•¥ã€‚
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **è·¨æºåµŒå…¥ç­–ç•¥ï¼ˆCOEPï¼‰å’Œè·¨æºæ‰“å¼€ç­–ç•¥ï¼ˆCOOPï¼‰**

COEPå’ŒCOOPå¯¹äºå¯ç”¨è·¨æºéš”ç¦»è‡³å…³é‡è¦ï¼Œå¤§å¤§é™ä½äº†ç±»ä¼¼Spectreçš„æ”»å‡»é£é™©ã€‚å®ƒä»¬åˆ†åˆ«æ§åˆ¶è·¨æºèµ„æºçš„åŠ è½½å’Œä¸è·¨æºçª—å£çš„äº¤äº’ã€‚
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP ä¸¥æ ¼ä¼ è¾“å®‰å…¨æ€§ï¼ˆHSTSï¼‰**

æœ€åï¼ŒHSTS æ˜¯ä¸€é¡¹å®‰å…¨åŠŸèƒ½ï¼Œå¼ºåˆ¶æµè§ˆå™¨åªèƒ½é€šè¿‡å®‰å…¨çš„ HTTPS è¿æ¥ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œä»è€Œå¢å¼ºéšç§å’Œå®‰å…¨æ€§ã€‚
```
Strict-Transport-Security: max-age=3153600
```
## å‚è€ƒèµ„æ–™

* [Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [HTTP Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [Security Headers](https://web.dev/security-headers/)
* [Security Headers Articles](https://web.dev/articles/security-headers)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
