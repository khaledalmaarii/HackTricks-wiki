# Specjalne nag贸wki HTTP

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

## Listy s贸w i narzdzia

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## Nag贸wki do zmiany lokalizacji

Zmiana **藕r贸da IP**:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (Sprawd藕 nag贸wki hop-by-hop)

Zmiana **lokalizacji**:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## Nag贸wki hop-by-hop

Nag贸wek hop-by-hop jest nag贸wkiem zaprojektowanym do przetwarzania i konsumowania przez aktualny serwer proxy obsugujcy 偶danie, w przeciwiestwie do nag贸wka end-to-end.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## Przemyt 偶da HTTP

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## Nag贸wki pamici podrcznej

**Nag贸wki pamici podrcznej serwera**:

* **`X-Cache`** w odpowiedzi mo偶e mie warto **`miss`**, gdy 偶danie nie byo buforowane, a warto **`hit`**, gdy jest buforowane
* Podobne zachowanie w nag贸wku **`Cf-Cache-Status`**
* **`Cache-Control`** wskazuje, czy zas贸b jest buforowany i kiedy zostanie ponownie buforowany: `Cache-Control: public, max-age=1800`
* **`Vary`** jest czsto u偶ywane w odpowiedzi do **wskazania dodatkowych nag贸wk贸w**, kt贸re s traktowane jako **cz klucza pamici podrcznej**, nawet jeli zazwyczaj nie s kluczowane.
* **`Age`** okrela czas w sekundach, przez jaki obiekt by w pamici podrcznej serwera proxy.
* **`Server-Timing: cdn-cache; desc=HIT`** r贸wnie偶 wskazuje, 偶e zas贸b by buforowany

{% content-ref url="../../pentesting-web/cache-deception.md" %}
[cache-deception.md](../../pentesting-web/cache-deception.md)
{% endcontent-ref %}

**Nag贸wki pamici podrcznej lokalnej**:

* `Clear-Site-Data`: Nag贸wek wskazujcy, jakie dane pamici podrcznej nale偶y usun: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: Zawiera dat/czas, kiedy odpowied藕 powinna wygasn: `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` to samo co `Cache-Control: no-cache`
* `Warning`: Og贸lny nag贸wek HTTP zawiera informacje o mo偶liwych problemach ze stanem wiadomoci. W odpowiedzi mo偶e pojawi si wicej ni偶 jeden nag贸wek `Warning`. `Warning: 110 anderson/1.3.37 "Response is stale"`

## Warunki

* 呕dania korzystajce z tych nag贸wk贸w: **`If-Modified-Since`** i **`If-Unmodified-Since`** zostan udzielone odpowiedzi tylko wtedy, gdy nag贸wek odpowiedzi **`Last-Modified`** zawiera inn godzin.
* 呕dania warunkowe za pomoc **`If-Match`** i **`If-None-Match`** u偶ywaj wartoci Etag, wic serwer WWW wyle zawarto odpowiedzi, jeli dane (Etag) zostay zmienione. Warto `Etag` jest pobierana z odpowiedzi HTTP.
* Warto **Etag** jest zwykle **obliczana na podstawie** zawartoci odpowiedzi. Na przykad `ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` wskazuje, 偶e `Etag` to **Sha1** z **37 bajt贸w**.

## 呕dania zakresu

* **`Accept-Ranges`**: Wskazuje, czy serwer obsuguje 偶dania zakresu, i jeli tak, w jakiej jednostce zakres mo偶e by wyra偶ony. `Accept-Ranges: <range-unit>`
* **`Range`**: Wskazuje cz dokumentu, kt贸r serwer powinien zwr贸ci.
* **`If-Range`**: Tworzy warunkowe 偶danie zakresu, kt贸re jest spenione tylko wtedy, gdy podany etag lub data pasuje do zdalnego zasobu. Su偶y do zapobiegania pobieraniu dw贸ch zakres贸w z niezgodnej wersji zasobu.
* **`Content-Range`**: Wskazuje, gdzie w penej wiadomoci ciaa czciowa wiadomo nale偶y.

## Informacje o treci wiadomoci

* **`Content-Length`:** Rozmiar zasobu, w dziesitnym liczbie bajt贸w.
* **`Content-Type`**: Wskazuje typ nonika zasobu
* **`Content-Encoding`**: U偶ywane do okrelenia algorytmu kompresji.
* **`Content-Language`**: Opisuje jzyk(i) przeznaczony dla odbiorc贸w, dziki czemu u偶ytkownik mo偶e r贸偶nicowa wedug wasnego preferowanego jzyka.
* **`Content-Location`**: Wskazuje alternatywn lokalizacj zwr贸conych danych.

Z punktu widzenia testu penetracyjnego te informacje s zazwyczaj "bezu偶yteczne", ale jeli zas贸b jest **chroniony** przez 401 lub 403 i mo偶na znale藕 **spos贸b** na **uzyskanie** tych **informacji**, mo偶e to by **interesujce.**\
Na przykad kombinacja **`Range`** i **`Etag`** w 偶daniu HEAD mo偶e ujawni zawarto strony za pomoc 偶da HEAD:

* 呕danie z nag贸wkiem `Range: bytes=20-20` i odpowiedzi zawierajc `ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` ujawnia, 偶e SHA1 bajtu 20 to `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`
## Informacje o serwerze

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## Kontrole

* **`Allow`**: Ten nag贸wek su偶y do komunikowania obsugiwanych metod HTTP przez zas贸b. Na przykad mo偶e by okrelony jako `Allow: GET, POST, HEAD`, co wskazuje, 偶e zas贸b obsuguje te metody.
* **`Expect`**: Wykorzystywany przez klienta do przekazywania oczekiwa, kt贸re serwer musi speni, aby 偶danie zostao pomylnie przetworzone. Powszechne zastosowanie to nag贸wek `Expect: 100-continue`, kt贸ry sygnalizuje, 偶e klient zamierza wysa du偶y adunek danych. Klient oczekuje odpowiedzi `100 (Continue)` przed kontynuacj transmisji. Mechanizm ten pomaga optymalizowa wykorzystanie sieci poprzez oczekiwanie na potwierdzenie serwera.

## Pobieranie

* Nag贸wek **`Content-Disposition`** w odpowiedziach HTTP okrela, czy plik powinien by wywietlany **inline** (wewntrz strony internetowej) czy traktowany jako **zacznik** (pobierany). Na przykad:
```
Content-Disposition: attachment; filename="filename.jpg"
```
To oznacza, 偶e plik o nazwie "filename.jpg" ma by pobrany i zapisany.

## Nag贸wki zabezpiecze

### Polityka zabezpiecze treci (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **Zaufane typy**

Poprzez egzekwowanie Zaufanych Typ贸w za pomoc CSP, aplikacje mog by chronione przed atakami DOM XSS. Zaufane Typy zapewniaj, 偶e tylko specjalnie opracowane obiekty, zgodne z ustalonymi politykami bezpieczestwa, mog by u偶ywane w niebezpiecznych wywoaniach interfejsu API sieci web, co zabezpiecza domylnie kod JavaScript.
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

Ten nag贸wek zapobiega analizowaniu typu MIME, praktyce, kt贸ra mo偶e prowadzi do podatnoci na XSS. Zapewnia, 偶e przegldarki bd szanowa typy MIME okrelone przez serwer.
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

Aby zwalczy clickjacking, ten nag贸wek ogranicza spos贸b osadzania dokument贸w w tagach `<frame>`, `<iframe>`, `<embed>` lub `<object>`, zalecajc wszystkim dokumentom okrelenie swoich uprawnie do osadzania w spos贸b jawny.
```
X-Frame-Options: DENY
```
### **Polityka zasob贸w midzydomenowych (CORP) i udostpnianie zasob贸w midzydomenowych (CORS)**

CORP jest kluczowy dla okrelenia, kt贸re zasoby mog by adowane przez strony internetowe, zmniejszajc wycieki midzy stronami. CORS natomiast umo偶liwia bardziej elastyczny mechanizm udostpniania zasob贸w midzy domenami, agodzc polityk tej samej domeny w okrelonych warunkach.
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Cross-Origin Embedder Policy (COEP) i Cross-Origin Opener Policy (COOP)**

COEP i COOP s kluczowe dla umo偶liwienia izolacji midzy-oryginalnej, znaczco zmniejszajc ryzyko atak贸w podobnych do Spectre. Kontroluj one adowanie zasob贸w z innych 藕r贸de oraz interakcje z oknami z innych 藕r贸de, odpowiednio.
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

Ostatecznie, HSTS to funkcja zabezpiecze, kt贸ra zmusza przegldarki do komunikowania si tylko z serwerami poprzez bezpieczne poczenia HTTPS, zwikszajc tym samym prywatno i bezpieczestwo.
```
Strict-Transport-Security: max-age=3153600
```
## Odnoniki

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

<details>

<summary><strong>Zdobd藕 wiedz na temat hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>
