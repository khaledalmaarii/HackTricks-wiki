# ç‰¹æ®Š HTTP å¤´

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## å­—å…¸ä¸å·¥å…·

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## æ›´æ”¹ä½ç½®çš„å¤´

é‡å†™ **IP æº**ï¼š

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (æ£€æŸ¥é€è·³å¤´)

é‡å†™ **ä½ç½®**ï¼š

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## é€è·³å¤´

é€è·³å¤´æ˜¯è®¾è®¡ç”¨äºç”±å½“å‰å¤„ç†è¯·æ±‚çš„ä»£ç†å¤„ç†å’Œæ¶ˆè´¹çš„å¤´ï¼Œä¸ç«¯åˆ°ç«¯å¤´ç›¸å¯¹ã€‚

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTP è¯·æ±‚èµ°ç§

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## ç¼“å­˜å¤´

**æœåŠ¡å™¨ç¼“å­˜å¤´**ï¼š

* **`X-Cache`** åœ¨å“åº”ä¸­å¯èƒ½æœ‰å€¼ **`miss`** å½“è¯·æ±‚æœªè¢«ç¼“å­˜ï¼Œå€¼ **`hit`** å½“å®ƒè¢«ç¼“å­˜
* åœ¨å¤´ **`Cf-Cache-Status`** ä¸­æœ‰ç±»ä¼¼çš„è¡Œä¸º
* **`Cache-Control`** æŒ‡ç¤ºèµ„æºæ˜¯å¦è¢«ç¼“å­˜ä»¥åŠä¸‹æ¬¡ç¼“å­˜èµ„æºçš„æ—¶é—´ï¼š`Cache-Control: public, max-age=1800`
* **`Vary`** é€šå¸¸åœ¨å“åº”ä¸­ä½¿ç”¨ï¼Œä»¥ **æŒ‡ç¤ºé¢å¤–çš„å¤´**ï¼Œè¿™äº›å¤´è¢«è§†ä¸º **ç¼“å­˜é”®çš„ä¸€éƒ¨åˆ†**ï¼Œå³ä½¿å®ƒä»¬é€šå¸¸ä¸ä½œä¸ºé”®ã€‚
* **`Age`** å®šä¹‰å¯¹è±¡åœ¨ä»£ç†ç¼“å­˜ä¸­å­˜åœ¨çš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚
* **`Server-Timing: cdn-cache; desc=HIT`** ä¹ŸæŒ‡ç¤ºèµ„æºå·²è¢«ç¼“å­˜

{% content-ref url="../../pentesting-web/cache-deception/" %}
[cache-deception](../../pentesting-web/cache-deception/)
{% endcontent-ref %}

**æœ¬åœ°ç¼“å­˜å¤´**ï¼š

* `Clear-Site-Data`: æŒ‡ç¤ºåº”åˆ é™¤çš„ç¼“å­˜çš„å¤´ï¼š`Clear-Site-Data: "cache", "cookies"`
* `Expires`: åŒ…å«å“åº”åº”è¿‡æœŸçš„æ—¥æœŸ/æ—¶é—´ï¼š`Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` ä¸ `Cache-Control: no-cache` ç›¸åŒ
* `Warning`: **`Warning`** ä¸€èˆ¬ HTTP å¤´åŒ…å«æœ‰å…³æ¶ˆæ¯çŠ¶æ€å¯èƒ½å­˜åœ¨é—®é¢˜çš„ä¿¡æ¯ã€‚å“åº”ä¸­å¯èƒ½å‡ºç°å¤šä¸ª `Warning` å¤´ã€‚`Warning: 110 anderson/1.3.37 "Response is stale"`

## æ¡ä»¶è¯·æ±‚

* ä½¿ç”¨è¿™äº›å¤´çš„è¯·æ±‚ï¼š**`If-Modified-Since`** å’Œ **`If-Unmodified-Since`** ä»…åœ¨å“åº”å¤´ **`Last-Modified`** åŒ…å«ä¸åŒæ—¶é—´æ—¶æ‰ä¼šè¿”å›æ•°æ®ã€‚
* ä½¿ç”¨ **`If-Match`** å’Œ **`If-None-Match`** çš„æ¡ä»¶è¯·æ±‚ä½¿ç”¨ Etag å€¼ï¼Œå› æ­¤å¦‚æœæ•°æ®ï¼ˆEtagï¼‰å·²æ›´æ”¹ï¼ŒWeb æœåŠ¡å™¨å°†å‘é€å“åº”çš„å†…å®¹ã€‚`Etag` æ˜¯ä» HTTP å“åº”ä¸­è·å–çš„ã€‚
* **Etag** å€¼é€šå¸¸æ˜¯ **åŸºäºå“åº”çš„å†…å®¹è®¡ç®—çš„**ã€‚ä¾‹å¦‚ï¼Œ`ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` è¡¨ç¤º `Etag` æ˜¯ **37 å­—èŠ‚** çš„ **Sha1**ã€‚

## èŒƒå›´è¯·æ±‚

* **`Accept-Ranges`**: æŒ‡ç¤ºæœåŠ¡å™¨æ˜¯å¦æ”¯æŒèŒƒå›´è¯·æ±‚ï¼Œå¦‚æœæ”¯æŒï¼Œåˆ™ä»¥å“ªç§å•ä½è¡¨ç¤ºèŒƒå›´ã€‚`Accept-Ranges: <range-unit>`
* **`Range`**: æŒ‡ç¤ºæœåŠ¡å™¨åº”è¿”å›æ–‡æ¡£çš„å“ªä¸€éƒ¨åˆ†ã€‚
* **`If-Range`**: åˆ›å»ºä¸€ä¸ªæ¡ä»¶èŒƒå›´è¯·æ±‚ï¼Œä»…åœ¨ç»™å®šçš„ etag æˆ–æ—¥æœŸä¸è¿œç¨‹èµ„æºåŒ¹é…æ—¶æ»¡è¶³ã€‚ç”¨äºé˜²æ­¢ä»ä¸å…¼å®¹ç‰ˆæœ¬çš„èµ„æºä¸‹è½½ä¸¤ä¸ªèŒƒå›´ã€‚
* **`Content-Range`**: æŒ‡ç¤ºéƒ¨åˆ†æ¶ˆæ¯åœ¨å®Œæ•´æ¶ˆæ¯ä¸­çš„ä½ç½®ã€‚

## æ¶ˆæ¯ä½“ä¿¡æ¯

* **`Content-Length`:** èµ„æºçš„å¤§å°ï¼Œä»¥å­—èŠ‚çš„åè¿›åˆ¶æ•°è¡¨ç¤ºã€‚
* **`Content-Type`**: æŒ‡ç¤ºèµ„æºçš„åª’ä½“ç±»å‹
* **`Content-Encoding`**: ç”¨äºæŒ‡å®šå‹ç¼©ç®—æ³•ã€‚
* **`Content-Language`**: æè¿°é¢å‘å—ä¼—çš„äººç±»è¯­è¨€ï¼Œä»¥ä¾¿å…è®¸ç”¨æˆ·æ ¹æ®ç”¨æˆ·è‡ªå·±çš„é¦–é€‰è¯­è¨€è¿›è¡ŒåŒºåˆ†ã€‚
* **`Content-Location`**: æŒ‡ç¤ºè¿”å›æ•°æ®çš„å¤‡ç”¨ä½ç½®ã€‚

ä»æ¸—é€æµ‹è¯•çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›ä¿¡æ¯é€šå¸¸æ˜¯â€œæ— ç”¨çš„â€ï¼Œä½†å¦‚æœèµ„æºè¢« **ä¿æŠ¤** ç”± 401 æˆ– 403ï¼Œå¹¶ä¸”ä½ èƒ½æ‰¾åˆ°æŸç§ **æ–¹æ³•** æ¥ **è·å–** è¿™äº› **ä¿¡æ¯**ï¼Œè¿™å¯èƒ½ä¼šæ˜¯ **æœ‰è¶£çš„**ã€‚\
ä¾‹å¦‚ï¼Œåœ¨ HEAD è¯·æ±‚ä¸­ **`Range`** å’Œ **`Etag`** çš„ç»„åˆå¯ä»¥é€šè¿‡ HEAD è¯·æ±‚æ³„éœ²é¡µé¢çš„å†…å®¹ï¼š

* å¸¦æœ‰å¤´ `Range: bytes=20-20` çš„è¯·æ±‚å’ŒåŒ…å« `ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` çš„å“åº”æ³„éœ²äº†å­—èŠ‚ 20 çš„ SHA1 ä¸º `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`

## æœåŠ¡å™¨ä¿¡æ¯

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## æ§åˆ¶

* **`Allow`**: æ­¤å¤´ç”¨äºä¼ è¾¾èµ„æºå¯ä»¥å¤„ç†çš„ HTTP æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½è¢«æŒ‡å®šä¸º `Allow: GET, POST, HEAD`ï¼Œè¡¨ç¤ºèµ„æºæ”¯æŒè¿™äº›æ–¹æ³•ã€‚
* **`Expect`**: å®¢æˆ·ç«¯ç”¨äºä¼ è¾¾æœåŠ¡å™¨éœ€è¦æ»¡è¶³çš„æœŸæœ›ï¼Œä»¥ä¾¿è¯·æ±‚èƒ½å¤ŸæˆåŠŸå¤„ç†ã€‚ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ¶‰åŠ `Expect: 100-continue` å¤´ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ‰“ç®—å‘é€å¤§é‡æ•°æ®è´Ÿè½½ã€‚å®¢æˆ·ç«¯åœ¨ç»§ç»­ä¼ è¾“ä¹‹å‰ä¼šå¯»æ‰¾ `100 (Continue)` å“åº”ã€‚æ­¤æœºåˆ¶æœ‰åŠ©äºé€šè¿‡ç­‰å¾…æœåŠ¡å™¨ç¡®è®¤æ¥ä¼˜åŒ–ç½‘ç»œä½¿ç”¨ã€‚

## ä¸‹è½½

* **`Content-Disposition`** å¤´åœ¨ HTTP å“åº”ä¸­æŒ‡ç¤ºæ–‡ä»¶åº”æ˜¾ç¤ºä¸º **å†…è”**ï¼ˆåœ¨ç½‘é¡µå†…ï¼‰è¿˜æ˜¯ä½œä¸º **é™„ä»¶**ï¼ˆä¸‹è½½ï¼‰ã€‚ä¾‹å¦‚ï¼š
```
Content-Disposition: attachment; filename="filename.jpg"
```
è¿™æ„å‘³ç€åä¸º "filename.jpg" çš„æ–‡ä»¶æ—¨åœ¨è¢«ä¸‹è½½å’Œä¿å­˜ã€‚

## å®‰å…¨å¤´éƒ¨

### å†…å®¹å®‰å…¨ç­–ç•¥ (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **å—ä¿¡ä»»çš„ç±»å‹**

é€šè¿‡ CSP å¼ºåˆ¶å®æ–½å—ä¿¡ä»»çš„ç±»å‹ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é˜²æ­¢ DOM XSS æ”»å‡»ã€‚å—ä¿¡ä»»çš„ç±»å‹ç¡®ä¿åªæœ‰ç¬¦åˆæ—¢å®šå®‰å…¨æ”¿ç­–çš„ç‰¹å®šæ„é€ å¯¹è±¡å¯ä»¥ç”¨äºå±é™©çš„ Web API è°ƒç”¨ï¼Œä»è€Œé»˜è®¤ä¿æŠ¤ JavaScript ä»£ç ã€‚
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

æ­¤å¤´éƒ¨é˜²æ­¢ MIME ç±»å‹å—…æ¢ï¼Œè¿™ç§åšæ³•å¯èƒ½å¯¼è‡´ XSS æ¼æ´ã€‚å®ƒç¡®ä¿æµè§ˆå™¨å°Šé‡æœåŠ¡å™¨æŒ‡å®šçš„ MIME ç±»å‹ã€‚
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

ä¸ºäº†å¯¹æŠ—ç‚¹å‡»åŠ«æŒï¼Œæ­¤å¤´éƒ¨é™åˆ¶äº†æ–‡æ¡£å¦‚ä½•åµŒå…¥åœ¨ `<frame>`ã€`<iframe>`ã€`<embed>` æˆ– `<object>` æ ‡ç­¾ä¸­ï¼Œå»ºè®®æ‰€æœ‰æ–‡æ¡£æ˜ç¡®æŒ‡å®šå…¶åµŒå…¥æƒé™ã€‚
```
X-Frame-Options: DENY
```
### **è·¨æºèµ„æºç­–ç•¥ (CORP) å’Œè·¨æºèµ„æºå…±äº« (CORS)**

CORP å¯¹äºæŒ‡å®šå“ªäº›èµ„æºå¯ä»¥è¢«ç½‘ç«™åŠ è½½è‡³å…³é‡è¦ï¼Œå‡è½»è·¨ç«™æ³„æ¼ã€‚å¦ä¸€æ–¹é¢ï¼ŒCORS å…è®¸æ›´çµæ´»çš„è·¨æºèµ„æºå…±äº«æœºåˆ¶ï¼Œåœ¨æŸäº›æ¡ä»¶ä¸‹æ”¾å®½åŒæºç­–ç•¥ã€‚
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **è·¨æºåµŒå…¥è€…ç­–ç•¥ (COEP) å’Œè·¨æºæ‰“å¼€è€…ç­–ç•¥ (COOP)**

COEP å’Œ COOP å¯¹äºå¯ç”¨è·¨æºéš”ç¦»è‡³å…³é‡è¦ï¼Œæ˜¾è‘—é™ä½äº†ç±»ä¼¼ Spectre æ”»å‡»çš„é£é™©ã€‚å®ƒä»¬åˆ†åˆ«æ§åˆ¶è·¨æºèµ„æºçš„åŠ è½½å’Œä¸è·¨æºçª—å£çš„äº¤äº’ã€‚
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

æœ€åï¼ŒHSTS æ˜¯ä¸€ç§å®‰å…¨åŠŸèƒ½ï¼Œå¼ºåˆ¶æµè§ˆå™¨ä»…é€šè¿‡å®‰å…¨çš„ HTTPS è¿æ¥ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œä»è€Œå¢å¼ºéšç§å’Œå®‰å…¨æ€§ã€‚
```
Strict-Transport-Security: max-age=3153600
```
## å‚è€ƒæ–‡çŒ®

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
