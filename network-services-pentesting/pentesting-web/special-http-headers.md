# Specjalne nag贸wki HTTP

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Listy s贸w i narzdzia

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## Nag贸wki do zmiany lokalizacji

Zmie **藕r贸do IP**:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (Sprawd藕 nag贸wki hop-by-hop)

Zmie **lokalizacj**:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## Nag贸wki hop-by-hop

Nag贸wek hop-by-hop jest nag贸wkiem, kt贸ry jest przeznaczony do przetwarzania i konsumowania przez aktualnie obsugujcy 偶danie serwer proxy, w przeciwiestwie do nag贸wka end-to-end.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTP Request Smuggling

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## Nag贸wki pamici podrcznej

**Nag贸wki pamici podrcznej serwera**:

* **`X-Cache`** w odpowiedzi mo偶e mie warto **`miss`**, jeli 偶danie nie byo w pamici podrcznej, i warto **`hit`**, jeli jest w pamici podrcznej
* **`Cache-Control`** wskazuje, czy zas贸b jest buforowany i kiedy zostanie ponownie buforowany: `Cache-Control: public, max-age=1800`
* **`Vary`** jest czsto u偶ywane w odpowiedzi, aby **wskaza dodatkowe nag贸wki**, kt贸re s traktowane jako **cz klucza pamici podrcznej**, nawet jeli normalnie nie s kluczowe.
* **`Age`** definiuje czas w sekundach, przez kt贸ry obiekt by w pamici podrcznej serwera poredniczcego.
* **`Server-Timing: cdn-cache; desc=HIT`** r贸wnie偶 wskazuje, 偶e zas贸b by buforowany

{% content-ref url="../../pentesting-web/cache-deception.md" %}
[cache-deception.md](../../pentesting-web/cache-deception.md)
{% endcontent-ref %}

**Nag贸wki pamici podrcznej lokalnej**:

* `Clear-Site-Data`: Nag贸wek wskazujcy, jakie dane pamici podrcznej powinny zosta usunite: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: Zawiera dat/czas, kiedy odpowied藕 powinna wygasn: `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` to samo co `Cache-Control: no-cache`
* `Warning`: Og贸lny nag贸wek HTTP **`Warning`** zawiera informacje o mo偶liwych problemach ze statusem wiadomoci. W odpowiedzi mo偶e pojawi si wicej ni偶 jeden nag贸wek `Warning`. `Warning: 110 anderson/1.3.37 "Response is stale"`

## Warunki

* 呕dania korzystajce z tych nag贸wk贸w: **`If-Modified-Since`** i **`If-Unmodified-Since`** bd otrzymywa dane tylko wtedy, gdy nag贸wek odpowiedzi **`Last-Modified`** zawiera inn godzin.
* 呕dania warunkowe korzystajce z **`If-Match`** i **`If-None-Match`** u偶ywaj wartoci Etag, wic serwer WWW wyle zawarto odpowiedzi, jeli dane (Etag) ulegy zmianie. Warto `Etag` jest pobierana z odpowiedzi HTTP.
* Warto **Etag** jest zwykle **obliczana na podstawie** zawartoci odpowiedzi. Na przykad, `ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` wskazuje, 偶e `Etag` to **Sha1** z **37 bajt贸w**.

## 呕dania zakresu

* **`Accept-Ranges`**: Wskazuje, czy serwer obsuguje 偶dania zakresu i w jakiej jednostce zakres mo偶e by wyra偶ony. `Accept-Ranges: <range-unit>`
* **`Range`**: Wskazuje cz dokumentu, kt贸r serwer powinien zwr贸ci.
* **`If-Range`**: Tworzy warunkowe 偶danie zakresu, kt贸re jest spenione tylko wtedy, gdy podany etag lub data pasuje do zdalnego zasobu. Su偶y do zapobiegania pobieraniu dw贸ch zakres贸w z niezgodnych wersji zasobu.
* **`Content-Range`**: Wskazuje, gdzie w penej wiadomoci ciaa znajduje si wiadomo czciowa.

## Informacje o treci wiadomoci

* **`Content-Length`:** Rozmiar zasobu, w postaci dziesitnego liczby bajt贸w.
* **`Content-Type`**: Wskazuje typ multimedi贸w zasobu
* **`Content-Encoding`**: U偶ywane do okrelenia algorytmu kompresji.
* **`Content-Language`**: Opisuje jzyk(i) ludzki(e) przeznaczony dla odbiorc贸w, umo偶liwiajc u偶ytkownikowi r贸偶nicowanie zgodnie z preferowanym przez u偶ytkownika jzykiem.
*
## Informacje o serwerze

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## Kontrole

* **`Allow`**: Ten nag贸wek su偶y do komunikacji metod HTTP, kt贸re zas贸b mo偶e obsu偶y. Na przykad, mo偶e by okrelony jako `Allow: GET, POST, HEAD`, co oznacza, 偶e zas贸b obsuguje te metody.
* **`Expect`**: Wykorzystywany przez klienta do przekazania oczekiwa, kt贸re serwer musi speni, aby 偶danie zostao pomylnie przetworzone. Powszechnym przypadkiem u偶ycia jest nag贸wek `Expect: 100-continue`, kt贸ry sygnalizuje, 偶e klient zamierza wysa du偶 ilo danych. Klient oczekuje odpowiedzi `100 (Continue)` przed kontynuacj transmisji. Ten mechanizm pomaga optymalizowa wykorzystanie sieci, oczekujc potwierdzenia serwera.

## Pobieranie

* Nag贸wek **`Content-Disposition`** w odpowiedziach HTTP okrela, czy plik powinien by wywietlany **wewntrznie** (wewntrz strony internetowej) czy traktowany jako **zacznik** (pobierany). Na przykad:
```
Content-Disposition: attachment; filename="filename.jpg"
```
To oznacza, 偶e plik o nazwie "filename.jpg" ma by pobrany i zapisany.

## Nag贸wki zabezpiecze

### Polityka zabezpiecze treci (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **Zaufane typy**

Poprzez wprowadzenie Zaufanych Typ贸w za pomoc CSP, aplikacje mog by chronione przed atakami DOM XSS. Zaufane Typy zapewniaj, 偶e tylko specjalnie opracowane obiekty, zgodne z ustalonymi politykami bezpieczestwa, mog by u偶ywane w niebezpiecznych wywoaniach interfejsu API sieci Web, co zabezpiecza kod JavaScript domylnie.
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

Ten nag贸wek zapobiega wykrywaniu typu MIME, praktyce, kt贸ra mo偶e prowadzi do podatnoci XSS. Zapewnia, 偶e przegldarki bd respektowa typy MIME okrelone przez serwer.
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

Aby zwalczy clickjacking, ten nag贸wek ogranicza spos贸b osadzania dokument贸w w znacznikach `<frame>`, `<iframe>`, `<embed>` lub `<object>`, zalecajc, aby wszystkie dokumenty jawnie okrelay swoje uprawnienia do osadzania.
```
X-Frame-Options: DENY
```
### **Cross-Origin Resource Policy (CORP) i Cross-Origin Resource Sharing (CORS)**

CORP jest kluczowy dla okrelenia, kt贸re zasoby mog by adowane przez strony internetowe, ograniczajc wycieki midzy stronami. CORS z kolei umo偶liwia bardziej elastyczny mechanizm udostpniania zasob贸w midzy r贸偶nymi 藕r贸dami, rozlu藕niajc polityk samego 藕r贸da w okrelonych warunkach.
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Cross-Origin Embedder Policy (COEP) i Cross-Origin Opener Policy (COOP)**

COEP i COOP s niezbdne do wczenia izolacji midzydomenowej, co znacznie redukuje ryzyko atak贸w podobnych do Spectre. Kontroluj adowanie zasob贸w z innych domen oraz interakcj z oknami z innych domen, odpowiednio.
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

Ostatni funkcj HSTS jest zabezpieczenie, kt贸re zmusza przegldarki do komunikowania si tylko przez bezpieczne poczenia HTTPS, co zwiksza prywatno i bezpieczestwo.
```
Strict-Transport-Security: max-age=3153600
```
## Odwoania

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
