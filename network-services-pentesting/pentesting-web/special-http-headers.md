# Specijalni HTTP zaglavlja

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr코ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Liste re캜i i alati

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## Zaglavlja za promenu lokacije

Prepisivanje **IP izvora**:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (Proverite hop-by-hop zaglavlja)

Prepisivanje **lokacije**:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## Hop-by-Hop zaglavlja

Hop-by-hop zaglavlje je zaglavlje koje je dizajnirano da bude obra캠eno i konzumirano od strane proksija koji trenutno obra캠uje zahtev, za razliku od zaglavlja end-to-end.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTP Request Smuggling

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## Cache zaglavlja

**Zaglavlja server ke코a**:

* **`X-Cache`** u odgovoru mo쬰 imati vrednost **`miss`** kada zahtev nije ke코iran i vrednost **`hit`** kada je ke코iran
* Sli캜no pona코anje u zaglavlju **`Cf-Cache-Status`**
* **`Cache-Control`** ozna캜ava da li se resurs ke코ira i kada 캖e biti slede캖i put ke코iran: `Cache-Control: public, max-age=1800`
* **`Vary`** se 캜esto koristi u odgovoru da **ozna캜i dodatna zaglavlja** koja se tretiraju kao **deo ke코 klju캜a** 캜ak i ako su obi캜no neklju캜evi.
* **`Age`** defini코e vreme u sekundama koliko je objekat bio u proksi ke코u.
* **`Server-Timing: cdn-cache; desc=HIT`** tako캠e ozna캜ava da je resurs ke코iran

{% content-ref url="../../pentesting-web/cache-deception/" %}
[cache-deception](../../pentesting-web/cache-deception/)
{% endcontent-ref %}

**Lokalna ke코 zaglavlja**:

* `Clear-Site-Data`: Zaglavlje koje ozna캜ava ke코 koji treba ukloniti: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: Sadr쬴 datum/vreme kada odgovor treba da istekne: `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` isto kao `Cache-Control: no-cache`
* `Warning`: **`Warning`** op코te HTTP zaglavlje sadr쬴 informacije o mogu캖im problemima sa statusom poruke. Mo쬰 se pojaviti vi코e od jednog `Warning` zaglavlja u odgovoru. `Warning: 110 anderson/1.3.37 "Response is stale"`

## Uslovi

* Zahtevi koji koriste ova zaglavlja: **`If-Modified-Since`** i **`If-Unmodified-Since`** 캖e dobiti odgovor sa podacima samo ako zaglavlje odgovora\*\*`Last-Modified`\*\* sadr쬴 druga캜ije vreme.
* Uslovni zahtevi koriste캖i **`If-Match`** i **`If-None-Match`** koriste Etag vrednost tako da web server po코alje sadr쬬j odgovora ako su podaci (Etag) promenjeni. `Etag` se uzima iz HTTP odgovora.
* Vrednost **Etag** se obi캜no **izra캜unava** na osnovu **sadr쬬ja** odgovora. Na primer, `ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` ozna캜ava da je `Etag` **Sha1** od **37 bajtova**.

## Zahtevi opsega

* **`Accept-Ranges`**: Ozna캜ava da li server podr쬬va zahteve opsega, i ako da, u kojoj jedinici se opseg mo쬰 izraziti. `Accept-Ranges: <range-unit>`
* **`Range`**: Ozna캜ava deo dokumenta koji server treba da vrati.
* **`If-Range`**: Stvara uslovni zahtev opsega koji se ispunjava samo ako dati etag ili datum odgovara udaljenom resursu. Koristi se da se spre캜i preuzimanje dva opsega iz nekompatibilnih verzija resursa.
* **`Content-Range`**: Ozna캜ava gde u punom telu poruke pripada delimi캜na poruka.

## Informacije o telu poruke

* **`Content-Length`:** Veli캜ina resursa, u decimalnom broju bajtova.
* **`Content-Type`**: Ozna캜ava medijski tip resursa
* **`Content-Encoding`**: Koristi se za specifikaciju algoritma kompresije.
* **`Content-Language`**: Opisuje ljudski jezik(e) namenjene publici, tako da omogu캖ava korisniku da razlikuje prema vlastitom preferiranom jeziku.
* **`Content-Location`**: Ozna캜ava alternativnu lokaciju za vra캖ene podatke.

Iz perspektive pentesta, ove informacije su obi캜no "beskorisne", ali ako je resurs **za코ti캖en** 401 ili 403 i mo쬰te prona캖i neki **na캜in** da **dobijete** ove **informacije**, to bi moglo biti **zanimljivo.**\
Na primer, kombinacija **`Range`** i **`Etag`** u HEAD zahtevu mo쬰 otkriti sadr쬬j stranice putem HEAD zahteva:

* Zahtev sa zaglavljem `Range: bytes=20-20` i sa odgovorom koji sadr쬴 `ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` otkriva da je SHA1 bajta 20 `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`

## Informacije o serveru

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## Kontrole

* **`Allow`**: Ovo zaglavlje se koristi za komunikaciju HTTP metoda koje resurs mo쬰 obraditi. Na primer, mo쬰 biti specificirano kao `Allow: GET, POST, HEAD`, 코to ozna캜ava da resurs podr쬬va ove metode.
* **`Expect`**: Koristi se od strane klijenta da prenese o캜ekivanja koja server treba da ispuni kako bi zahtev bio uspe코no obra캠en. Uobi캜ajena upotreba uklju캜uje zaglavlje `Expect: 100-continue`, koje signalizira da klijent namerava da po코alje veliki paket podataka. Klijent tra쬴 `100 (Continue)` odgovor pre nego 코to nastavi sa prenosom. Ovaj mehanizam poma쬰 u optimizaciji kori코캖enja mre쬰 캜ekaju캖i potvrdu servera.

## Preuzimanja

* **`Content-Disposition`** zaglavlje u HTTP odgovorima usmerava da li bi datoteka trebala biti prikazana **inline** (unutar veb stranice) ili tretirana kao **prilog** (preuzeta). Na primer:
```
Content-Disposition: attachment; filename="filename.jpg"
```
Ovo zna캜i da je datoteka pod imenom "filename.jpg" namenjena preuzimanju i 캜uvanju.

## Bezbednosni Headeri

### Politika Bezbednosti Sadr쬬ja (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **Poverljivi Tipovi**

Sprovode캖i Poverljive Tipove putem CSP-a, aplikacije se mogu za코tititi od DOM XSS napada. Poverljivi Tipovi osiguravaju da se samo posebno kreirani objekti, u skladu sa uspostavljenim bezbednosnim politikama, mogu koristiti u opasnim pozivima web API-ja, 캜ime se podrazumevano osigurava JavaScript kod.
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

Ova glava spre캜ava MIME tip sniffing, praksu koja mo쬰 dovesti do XSS ranjivosti. Osigurava da pregleda캜i po코tuju MIME tipove koje je odredio server.
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

Da bi se borili protiv clickjacking-a, ovaj header ograni캜ava kako se dokumenti mogu ugraditi u `<frame>`, `<iframe>`, `<embed>`, ili `<object>` tagove, preporu캜uju캖i svim dokumentima da eksplicitno navedu svoja dopu코tenja za ugradnju.
```
X-Frame-Options: DENY
```
### **Cross-Origin Resource Policy (CORP) i Cross-Origin Resource Sharing (CORS)**

CORP je klju캜an za odre캠ivanje koje resurse mogu u캜itati veb sajtovi, smanjuju캖i cross-site leak-ove. CORS, s druge strane, omogu캖ava fleksibilniji mehanizam deljenja resursa izme캠u razli캜itih izvora, opu코taju캖i politiku istog izvora pod odre캠enim uslovima.
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Cross-Origin Embedder Policy (COEP) i Cross-Origin Opener Policy (COOP)**

COEP i COOP su klju캜ni za omogu캖avanje izolacije izme캠u razli캜itih izvora, zna캜ajno smanjuju캖i rizik od napada sli캜nih Spectre-u. Oni kontroli코u u캜itavanje resursa iz drugih izvora i interakciju sa prozorima iz drugih izvora, redom.
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

Na kraju, HSTS je bezbednosna funkcija koja prisiljava pretra쬴va캜e da komuniciraju sa serverima samo preko sigurnih HTTPS veza, 캜ime se pobolj코ava privatnost i bezbednost.
```
Strict-Transport-Security: max-age=3153600
```
## References

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
