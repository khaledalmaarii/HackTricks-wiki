# En-t√™tes HTTP sp√©ciaux

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## Listes de mots et outils

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## En-t√™tes pour changer l'emplacement

R√©√©crire **l'IP source** :

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (V√©rifiez les en-t√™tes hop-by-hop)

R√©√©crire **l'emplacement** :

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## En-t√™tes hop-by-hop

Un en-t√™te hop-by-hop est un en-t√™te con√ßu pour √™tre trait√© et consomm√© par le proxy g√©rant actuellement la requ√™te, par opposition √† un en-t√™te de bout en bout.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## Contrebande de requ√™tes HTTP

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## En-t√™tes de cache

**En-t√™tes de cache serveur** :

* **`X-Cache`** dans la r√©ponse peut avoir la valeur **`miss`** lorsque la requ√™te n'√©tait pas mise en cache et la valeur **`hit`** lorsqu'elle est mise en cache
* Comportement similaire dans l'en-t√™te **`Cf-Cache-Status`**
* **`Cache-Control`** indique si une ressource est mise en cache et quand la ressource sera √† nouveau mise en cache : `Cache-Control: public, max-age=1800`
* **`Vary`** est souvent utilis√© dans la r√©ponse pour **indiquer des en-t√™tes suppl√©mentaires** trait√©s comme **partie de la cl√© de cache** m√™me s'ils ne sont normalement pas cl√©s.
* **`Age`** d√©finit en secondes le temps pendant lequel l'objet a √©t√© dans le cache du proxy.
* **`Server-Timing: cdn-cache; desc=HIT`** indique √©galement qu'une ressource a √©t√© mise en cache

{% content-ref url="../../pentesting-web/cache-deception.md" %}
[cache-deception.md](../../pentesting-web/cache-deception.md)
{% endcontent-ref %}

**En-t√™tes de cache local** :

* `Clear-Site-Data` : En-t√™te pour indiquer le cache qui doit √™tre supprim√© : `Clear-Site-Data: "cache", "cookies"`
* `Expires` : Contient la date/heure √† laquelle la r√©ponse doit expirer : `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` identique √† `Cache-Control: no-cache`
* `Warning` : L'en-t√™te HTTP g√©n√©ral **`Warning`** contient des informations sur d'√©ventuels probl√®mes avec le statut du message. Plus d'un en-t√™te `Warning` peut appara√Ætre dans une r√©ponse. `Warning: 110 anderson/1.3.37 "Response is stale"`

## Conditionnels

* Les requ√™tes utilisant ces en-t√™tes : **`If-Modified-Since`** et **`If-Unmodified-Since`** ne renverront des donn√©es que si l'en-t√™te de r√©ponse **`Last-Modified`** contient une heure diff√©rente.
* Les requ√™tes conditionnelles utilisant **`If-Match`** et **`If-None-Match`** utilisent une valeur Etag pour que le serveur Web envoie le contenu de la r√©ponse si les donn√©es (Etag) ont chang√©. L'Etag est extrait de la r√©ponse HTTP.
* La valeur **Etag** est g√©n√©ralement **calcul√©e en fonction** du **contenu** de la r√©ponse. Par exemple, `ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` indique que l'Etag est le **Sha1** de **37 octets**.

## Demandes de plage

* **`Accept-Ranges`** : Indique si le serveur prend en charge les demandes de plage, et si c'est le cas, dans quelle unit√© la plage peut √™tre exprim√©e. `Accept-Ranges: <unit√©-de-plage>`
* **`Range`** : Indique la partie d'un document que le serveur doit renvoyer.
* **`If-Range`** : Cr√©e une demande de plage conditionnelle qui n'est satisfaite que si l'Etag ou la date donn√©e correspond √† la ressource distante. Utilis√© pour emp√™cher le t√©l√©chargement de deux plages √† partir de versions incompatibles de la ressource.
* **`Content-Range`** : Indique o√π dans un message complet un message partiel appartient.

## Informations sur le corps du message

* **`Content-Length`** : La taille de la ressource, en nombre d√©cimal d'octets.
* **`Content-Type`** : Indique le type de m√©dia de la ressource
* **`Content-Encoding`** : Utilis√© pour sp√©cifier l'algorithme de compression.
* **`Content-Language`** : D√©crit la ou les langues humaines destin√©es au public, permettant ainsi √† un utilisateur de diff√©rencier selon sa propre langue pr√©f√©r√©e.
* **`Content-Location`** : Indique un emplacement alternatif pour les donn√©es renvoy√©es.

D'un point de vue de test d'intrusion, ces informations sont g√©n√©ralement "inutiles", mais si la ressource est **prot√©g√©e** par un 401 ou 403 et que vous pouvez trouver un **moyen** de **r√©cup√©rer** ces **informations**, cela pourrait √™tre **int√©ressant**.\
Par exemple, une combinaison de **`Range`** et **`Etag`** dans une requ√™te HEAD peut divulguer le contenu de la page via des requ√™tes HEAD :

* Une requ√™te avec l'en-t√™te `Range: bytes=20-20` et avec une r√©ponse contenant `ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` divulgue que le SHA1 de l'octet 20 est `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`
## Informations sur le serveur

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## Contr√¥les

* **`Allow`**: Cet en-t√™te est utilis√© pour communiquer les m√©thodes HTTP qu'une ressource peut g√©rer. Par exemple, il peut √™tre sp√©cifi√© comme `Allow: GET, POST, HEAD`, indiquant que la ressource prend en charge ces m√©thodes.
* **`Expect`**: Utilis√© par le client pour transmettre les attentes que le serveur doit satisfaire pour que la requ√™te soit trait√©e avec succ√®s. Un cas d'utilisation courant implique l'en-t√™te `Expect: 100-continue`, qui indique que le client a l'intention d'envoyer une charge utile de donn√©es importante. Le client attend une r√©ponse `100 (Continue)` avant de poursuivre la transmission. Ce m√©canisme aide √† optimiser l'utilisation du r√©seau en attendant la confirmation du serveur.

## T√©l√©chargements

* L'en-t√™te **`Content-Disposition`** dans les r√©ponses HTTP indique si un fichier doit √™tre affich√© **en ligne** (dans la page web) ou trait√© comme une **pi√®ce jointe** (t√©l√©charg√©). Par exemple :
```
Content-Disposition: attachment; filename="filename.jpg"
```
## En-t√™tes de s√©curit√©

### Politique de s√©curit√© du contenu (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **Types de confiance**

En imposant les Trusted Types via CSP, les applications peuvent √™tre prot√©g√©es contre les attaques XSS DOM. Les Trusted Types garantissent que seuls des objets sp√©cifiquement con√ßus, conformes aux politiques de s√©curit√© √©tablies, peuvent √™tre utilis√©s dans des appels d'API web dangereux, s√©curisant ainsi le code JavaScript par d√©faut.
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

Ce header emp√™che le sniffing de type MIME, une pratique qui pourrait entra√Æner des vuln√©rabilit√©s XSS. Il garantit que les navigateurs respectent les types MIME sp√©cifi√©s par le serveur.
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

Pour lutter contre le clickjacking, cet en-t√™te restreint la mani√®re dont les documents peuvent √™tre int√©gr√©s dans les balises `<frame>`, `<iframe>`, `<embed>`, ou `<object>`, recommandant √† tous les documents de sp√©cifier explicitement leurs autorisations d'int√©gration.
```
X-Frame-Options: DENY
```
### **Politique de ressources entre origines (CORP) et partage de ressources entre origines (CORS)**

CORP est crucial pour sp√©cifier quelles ressources peuvent √™tre charg√©es par les sites web, att√©nuant les fuites entre sites. CORS, en revanche, permet un m√©canisme de partage de ressources entre origines plus flexible, assouplissant la politique de m√™me origine dans certaines conditions.
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Politique d'int√©gration d'origine crois√©e (COEP) et Politique d'ouverture d'origine crois√©e (COOP)**

COEP et COOP sont essentiels pour activer l'isolation entre les origines crois√©es, r√©duisant consid√©rablement le risque d'attaques de type Spectre. Ils contr√¥lent le chargement des ressources d'origine crois√©e et l'interaction avec les fen√™tres d'origine crois√©e, respectivement.
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

Enfin, HSTS est une fonctionnalit√© de s√©curit√© qui oblige les navigateurs √† communiquer uniquement avec les serveurs via des connexions HTTPS s√©curis√©es, am√©liorant ainsi la confidentialit√© et la s√©curit√©.
```
Strict-Transport-Security: max-age=3153600
```
## R√©f√©rences

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
