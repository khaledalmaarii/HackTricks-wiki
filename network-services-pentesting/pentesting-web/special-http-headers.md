# Special HTTP headers

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Wordlists & Tools

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## Headers to Change Location

Rewrite **IP source**:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (Check hop-by-hop headers)

Rewrite **location**:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## Hop-by-Hop headers

Um cabe√ßalho hop-by-hop √© um cabe√ßalho que √© projetado para ser processado e consumido pelo proxy que est√° lidando com a solicita√ß√£o, em vez de um cabe√ßalho de ponta a ponta.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTP Request Smuggling

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## Cache Headers

**Cabe√ßalhos de Cache do Servidor**:

* **`X-Cache`** na resposta pode ter o valor **`miss`** quando a solicita√ß√£o n√£o foi armazenada em cache e o valor **`hit`** quando est√° armazenada em cache
* Comportamento semelhante no cabe√ßalho **`Cf-Cache-Status`**
* **`Cache-Control`** indica se um recurso est√° sendo armazenado em cache e quando ser√° a pr√≥xima vez que o recurso ser√° armazenado em cache novamente: `Cache-Control: public, max-age=1800`
* **`Vary`** √© frequentemente usado na resposta para **indicar cabe√ßalhos adicionais** que s√£o tratados como **parte da chave de cache** mesmo que normalmente n√£o sejam indexados.
* **`Age`** define o tempo em segundos que o objeto esteve no cache do proxy.
* **`Server-Timing: cdn-cache; desc=HIT`** tamb√©m indica que um recurso foi armazenado em cache

{% content-ref url="../../pentesting-web/cache-deception/" %}
[cache-deception](../../pentesting-web/cache-deception/)
{% endcontent-ref %}

**Cabe√ßalhos de Cache Local**:

* `Clear-Site-Data`: Cabe√ßalho para indicar o cache que deve ser removido: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: Cont√©m a data/hora quando a resposta deve expirar: `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` o mesmo que `Cache-Control: no-cache`
* `Warning`: O cabe√ßalho HTTP geral **`Warning`** cont√©m informa√ß√µes sobre poss√≠veis problemas com o status da mensagem. Mais de um cabe√ßalho `Warning` pode aparecer em uma resposta. `Warning: 110 anderson/1.3.37 "Response is stale"`

## Conditionals

* Solicita√ß√µes usando esses cabe√ßalhos: **`If-Modified-Since`** e **`If-Unmodified-Since`** ser√£o respondidas com dados apenas se o cabe√ßalho de resposta **`Last-Modified`** contiver um hor√°rio diferente.
* Solicita√ß√µes condicionais usando **`If-Match`** e **`If-None-Match`** usam um valor Etag para que o servidor web envie o conte√∫do da resposta se os dados (Etag) mudaram. O `Etag` √© retirado da resposta HTTP.
* O valor **Etag** √© geralmente **calculado com base** no **conte√∫do** da resposta. Por exemplo, `ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` indica que o `Etag` √© o **Sha1** de **37 bytes**.

## Range requests

* **`Accept-Ranges`**: Indica se o servidor suporta solicita√ß√µes de intervalo e, se sim, em qual unidade o intervalo pode ser expresso. `Accept-Ranges: <range-unit>`
* **`Range`**: Indica a parte de um documento que o servidor deve retornar.
* **`If-Range`**: Cria uma solicita√ß√£o de intervalo condicional que s√≥ √© atendida se o etag ou a data correspondem ao recurso remoto. Usado para evitar o download de dois intervalos de vers√µes incompat√≠veis do recurso.
* **`Content-Range`**: Indica onde em uma mensagem de corpo completo uma mensagem parcial pertence.

## Message body information

* **`Content-Length`:** O tamanho do recurso, em n√∫mero decimal de bytes.
* **`Content-Type`**: Indica o tipo de m√≠dia do recurso
* **`Content-Encoding`**: Usado para especificar o algoritmo de compress√£o.
* **`Content-Language`**: Descreve a(s) l√≠ngua(s) humana(s) destinadas ao p√∫blico, permitindo que um usu√°rio diferencie de acordo com a pr√≥pria l√≠ngua preferida.
* **`Content-Location`**: Indica uma localiza√ß√£o alternativa para os dados retornados.

Do ponto de vista de um pentest, essas informa√ß√µes s√£o geralmente "in√∫teis", mas se o recurso estiver **protegido** por um 401 ou 403 e voc√™ conseguir encontrar alguma **maneira** de **obter** essa **informa√ß√£o**, isso pode ser **interessante.**\
Por exemplo, uma combina√ß√£o de **`Range`** e **`Etag`** em uma solicita√ß√£o HEAD pode vazar o conte√∫do da p√°gina via solicita√ß√µes HEAD:

* Uma solicita√ß√£o com o cabe√ßalho `Range: bytes=20-20` e com uma resposta contendo `ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` est√° vazando que o SHA1 do byte 20 √© `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`

## Server Info

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## Controls

* **`Allow`**: Este cabe√ßalho √© usado para comunicar os m√©todos HTTP que um recurso pode manipular. Por exemplo, pode ser especificado como `Allow: GET, POST, HEAD`, indicando que o recurso suporta esses m√©todos.
* **`Expect`**: Utilizado pelo cliente para transmitir expectativas que o servidor precisa atender para que a solicita√ß√£o seja processada com sucesso. Um caso de uso comum envolve o cabe√ßalho `Expect: 100-continue`, que sinaliza que o cliente pretende enviar um grande payload de dados. O cliente aguarda uma resposta `100 (Continue)` antes de prosseguir com a transmiss√£o. Esse mecanismo ajuda a otimizar o uso da rede, aguardando a confirma√ß√£o do servidor.

## Downloads

* O cabe√ßalho **`Content-Disposition`** nas respostas HTTP direciona se um arquivo deve ser exibido **inline** (dentro da p√°gina da web) ou tratado como um **anexo** (baixado). Por exemplo:
```
Content-Disposition: attachment; filename="filename.jpg"
```
Isso significa que o arquivo nomeado "filename.jpg" √© destinado a ser baixado e salvo.

## Cabe√ßalhos de Seguran√ßa

### Content Security Policy (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **Tipos Confi√°veis**

Ao impor Tipos Confi√°veis atrav√©s do CSP, as aplica√ß√µes podem ser protegidas contra ataques XSS no DOM. Tipos Confi√°veis garantem que apenas objetos especificamente elaborados, em conformidade com pol√≠ticas de seguran√ßa estabelecidas, possam ser usados em chamadas de API web perigosas, garantindo assim que o c√≥digo JavaScript esteja seguro por padr√£o.
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

Este cabe√ßalho impede a detec√ß√£o de tipo MIME, uma pr√°tica que pode levar a vulnerabilidades XSS. Ele garante que os navegadores respeitem os tipos MIME especificados pelo servidor.
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

Para combater clickjacking, este cabe√ßalho restringe como documentos podem ser incorporados em `<frame>`, `<iframe>`, `<embed>` ou `<object>`, recomendando que todos os documentos especifiquem explicitamente suas permiss√µes de incorpora√ß√£o.
```
X-Frame-Options: DENY
```
### **Pol√≠tica de Recursos de Origem Cruzada (CORP) e Compartilhamento de Recursos de Origem Cruzada (CORS)**

CORP √© crucial para especificar quais recursos podem ser carregados por sites, mitigando vazamentos entre sites. CORS, por outro lado, permite um mecanismo de compartilhamento de recursos de origem cruzada mais flex√≠vel, relaxando a pol√≠tica de mesma origem sob certas condi√ß√µes.
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Pol√≠tica de Incorpora√ß√£o entre Origens (COEP) e Pol√≠tica de Abertura entre Origens (COOP)**

COEP e COOP s√£o essenciais para habilitar o isolamento entre origens, reduzindo significativamente o risco de ataques semelhantes ao Spectre. Eles controlam o carregamento de recursos entre origens e a intera√ß√£o com janelas entre origens, respectivamente.
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

Por fim, o HSTS √© um recurso de seguran√ßa que for√ßa os navegadores a se comunicarem com os servidores apenas por meio de conex√µes HTTPS seguras, melhorando assim a privacidade e a seguran√ßa.
```
Strict-Transport-Security: max-age=3153600
```
## Refer√™ncias

* [https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Headers](https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

{% hint style="success" %}
Aprenda e pratique AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
