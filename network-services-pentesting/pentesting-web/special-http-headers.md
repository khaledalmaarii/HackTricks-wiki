# Cabe√ßalhos HTTP Especiais

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Listas de Palavras & Ferramentas

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## Cabe√ßalhos para Alterar a Localiza√ß√£o

Reescrever **IP de origem**:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (Verifique cabe√ßalhos hop-by-hop)

Reescrever **localiza√ß√£o**:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## Cabe√ßalhos Hop-by-Hop

Um cabe√ßalho hop-by-hop √© um cabe√ßalho projetado para ser processado e consumido pelo proxy que est√° manipulando a solicita√ß√£o, em oposi√ß√£o a um cabe√ßalho end-to-end.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## Contrabando de Solicita√ß√£o HTTP

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## Cabe√ßalhos de Cache

**Cabe√ßalhos de Cache do Servidor**:

* **`X-Cache`** na resposta pode ter o valor **`miss`** quando a solicita√ß√£o n√£o foi armazenada em cache e o valor **`hit`** quando est√° em cache
* Comportamento semelhante no cabe√ßalho **`Cf-Cache-Status`**
* **`Cache-Control`** indica se um recurso est√° sendo armazenado em cache e quando ser√° a pr√≥xima vez que o recurso ser√° armazenado em cache novamente: `Cache-Control: public, max-age=1800`
* **`Vary`** √© frequentemente usado na resposta para **indicar cabe√ßalhos adicionais** que s√£o tratados como **parte da chave de cache** mesmo que normalmente n√£o sejam chaveados.
* **`Age`** define o tempo em segundos que o objeto esteve em cache no proxy.
* **`Server-Timing: cdn-cache; desc=HIT`** tamb√©m indica que um recurso foi armazenado em cache

{% content-ref url="../../pentesting-web/cache-deception/" %}
[cache-deception](../../pentesting-web/cache-deception/)
{% endcontent-ref %}

**Cabe√ßalhos de Cache Local**:

* `Clear-Site-Data`: Cabe√ßalho para indicar o cache que deve ser removido: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: Cont√©m a data/hora em que a resposta deve expirar: `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` igual a `Cache-Control: no-cache`
* `Warning`: O cabe√ßalho geral **`Warning`** cont√©m informa√ß√µes sobre poss√≠veis problemas com o status da mensagem. Mais de um cabe√ßalho `Warning` pode aparecer em uma resposta. `Warning: 110 anderson/1.3.37 "Response is stale"`

## Condicional

* Solicita√ß√µes usando estes cabe√ßalhos: **`If-Modified-Since`** e **`If-Unmodified-Since`** ser√£o respondidas com dados apenas se o cabe√ßalho de resposta **`Last-Modified`** contiver um hor√°rio diferente.
* Solicita√ß√µes condicionais usando **`If-Match`** e **`If-None-Match`** usam um valor Etag para que o servidor web envie o conte√∫do da resposta se os dados (Etag) tiverem mudado. O `Etag` √© retirado da resposta HTTP.
* O valor **Etag** √© geralmente **calculado com base** no **conte√∫do** da resposta. Por exemplo, `ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` indica que o `Etag` √© o **Sha1** de **37 bytes**.

## Solicita√ß√µes de Intervalo

* **`Accept-Ranges`**: Indica se o servidor suporta solicita√ß√µes de intervalo e, em caso afirmativo, em qual unidade o intervalo pode ser expresso. `Accept-Ranges: <range-unit>`
* **`Range`**: Indica a parte de um documento que o servidor deve retornar.
* **`If-Range`**: Cria uma solicita√ß√£o de intervalo condicional que s√≥ √© atendida se o etag ou data fornecida corresponder ao recurso remoto. Usado para evitar o download de dois intervalos de vers√µes incompat√≠veis do recurso.
* **`Content-Range`**: Indica onde em uma mensagem de corpo completo uma mensagem parcial pertence.

## Informa√ß√µes do Corpo da Mensagem

* **`Content-Length`:** O tamanho do recurso, em n√∫mero decimal de bytes.
* **`Content-Type`**: Indica o tipo de m√≠dia do recurso
* **`Content-Encoding`**: Usado para especificar o algoritmo de compress√£o.
* **`Content-Language`**: Descreve o(s) idioma(s) humano(s) destinado(s) ao p√∫blico, permitindo que um usu√°rio diferencie de acordo com o idioma preferido dos usu√°rios.
* **`Content-Location`**: Indica uma localiza√ß√£o alternativa para os dados retornados.

Do ponto de vista de um pentest, essas informa√ß√µes geralmente s√£o "in√∫teis", mas se o recurso for **protegido** por um 401 ou 403 e voc√™ conseguir encontrar alguma **maneira** de **obter** essas **informa√ß√µes**, isso pode ser **interessante**.\
Por exemplo, uma combina√ß√£o de **`Range`** e **`Etag`** em uma solicita√ß√£o HEAD pode vazar o conte√∫do da p√°gina via solicita√ß√µes HEAD:

* Uma solicita√ß√£o com o cabe√ßalho `Range: bytes=20-20` e com uma resposta contendo `ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` est√° vazando que o SHA1 do byte 20 √© `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`
## Informa√ß√µes do Servidor

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## Controles

* **`Allow`**: Este cabe√ßalho √© usado para comunicar os m√©todos HTTP que um recurso pode manipular. Por exemplo, pode ser especificado como `Allow: GET, POST, HEAD`, indicando que o recurso suporta esses m√©todos.
* **`Expect`**: Utilizado pelo cliente para transmitir expectativas que o servidor precisa atender para que a solicita√ß√£o seja processada com sucesso. Um caso de uso comum envolve o cabe√ßalho `Expect: 100-continue`, que sinaliza que o cliente pretende enviar uma carga de dados grande. O cliente aguarda uma resposta `100 (Continue)` antes de prosseguir com a transmiss√£o. Esse mecanismo ajuda a otimizar o uso da rede aguardando a confirma√ß√£o do servidor.

## Downloads

* O cabe√ßalho **`Content-Disposition`** nas respostas HTTP direciona se um arquivo deve ser exibido **inline** (dentro da p√°gina da web) ou tratado como um **attachment** (baixado). Por exemplo:
```
Content-Disposition: attachment; filename="filename.jpg"
```
## Cabe√ßalhos de Seguran√ßa

### Pol√≠tica de Seguran√ßa de Conte√∫do (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **Tipos Confi√°veis**

Ao fazer cumprir Tipos Confi√°veis atrav√©s do CSP, as aplica√ß√µes podem ser protegidas contra ataques DOM XSS. Os Tipos Confi√°veis garantem que apenas objetos especificamente elaborados, em conformidade com pol√≠ticas de seguran√ßa estabelecidas, possam ser usados em chamadas perigosas de API da web, garantindo assim o c√≥digo JavaScript por padr√£o.
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

Este cabe√ßalho previne a detec√ß√£o de tipo MIME, uma pr√°tica que poderia levar a vulnerabilidades de XSS. Ele garante que os navegadores respeitem os tipos MIME especificados pelo servidor.
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

Para combater o clickjacking, este cabe√ßalho restringe como os documentos podem ser incorporados em tags `<frame>`, `<iframe>`, `<embed>`, ou `<object>`, recomendando que todos os documentos especifiquem explicitamente suas permiss√µes de incorpora√ß√£o.
```
X-Frame-Options: DENY
```
### **Pol√≠tica de Recursos de Origem Cruzada (CORP) e Compartilhamento de Recursos de Origem Cruzada (CORS)**

CORP √© crucial para especificar quais recursos podem ser carregados por sites, mitigando vazamentos entre sites. CORS, por outro lado, permite um mecanismo mais flex√≠vel de compartilhamento de recursos de origem cruzada, relaxando a pol√≠tica de mesma origem sob certas condi√ß√µes.
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Cross-Origin Embedder Policy (COEP) e Cross-Origin Opener Policy (COOP)**

COEP e COOP s√£o essenciais para habilitar o isolamento entre origens, reduzindo significativamente o risco de ataques semelhantes ao Spectre. Eles controlam o carregamento de recursos de origens diferentes e a intera√ß√£o com janelas de origens diferentes, respectivamente.
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

Por √∫ltimo, o HSTS √© uma funcionalidade de seguran√ßa que obriga os navegadores a se comunicarem apenas com servidores por meio de conex√µes seguras HTTPS, aumentando assim a privacidade e seguran√ßa.
```
Strict-Transport-Security: max-age=3153600
```
## Refer√™ncias

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
