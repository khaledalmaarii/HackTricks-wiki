# Specjalne nag贸wki HTTP

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

## Listy s贸w i narzdzia

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## Nag贸wki do zmiany lokalizacji

Przepisz **IP 藕r贸dowe**:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (Sprawd藕 nag贸wki hop-by-hop)

Przepisz **lokacj**:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## Nag贸wki hop-by-hop

Nag贸wek hop-by-hop to nag贸wek, kt贸ry jest zaprojektowany do przetwarzania i konsumowania przez proxy obsugujce 偶danie, w przeciwiestwie do nag贸wka end-to-end.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## Smuggling 偶da HTTP

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## Nag贸wki pamici podrcznej

**Nag贸wki pamici podrcznej serwera**:

* **`X-Cache`** w odpowiedzi mo偶e mie warto **`miss`** gdy 偶danie nie zostao zapisane w pamici podrcznej i warto **`hit`** gdy jest zapisane w pamici podrcznej
* Podobne zachowanie w nag贸wku **`Cf-Cache-Status`**
* **`Cache-Control`** wskazuje, czy zas贸b jest zapisywany w pamici podrcznej i kiedy bdzie nastpny raz zapisywany w pamici podrcznej: `Cache-Control: public, max-age=1800`
* **`Vary`** jest czsto u偶ywane w odpowiedzi do **wskazania dodatkowych nag贸wk贸w**, kt贸re s traktowane jako **cz klucza pamici podrcznej**, nawet jeli normalnie nie s kluczowane.
* **`Age`** definiuje czas w sekundach, przez jaki obiekt by w pamici podrcznej proxy.
* **`Server-Timing: cdn-cache; desc=HIT`** r贸wnie偶 wskazuje, 偶e zas贸b by zapisany w pamici podrcznej

{% content-ref url="../../pentesting-web/cache-deception/" %}
[cache-deception](../../pentesting-web/cache-deception/)
{% endcontent-ref %}

**Nag贸wki pamici podrcznej lokalnej**:

* `Clear-Site-Data`: Nag贸wek wskazujcy, kt贸re dane w pamici podrcznej powinny zosta usunite: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: Zawiera dat/godzin, kiedy odpowied藕 powinna wygasn: `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` to samo co `Cache-Control: no-cache`
* `Warning`: Og贸lny nag贸wek HTTP **`Warning`** zawiera informacje o mo偶liwych problemach ze statusem wiadomoci. W odpowiedzi mo偶e pojawi si wicej ni偶 jeden nag贸wek `Warning`. `Warning: 110 anderson/1.3.37 "Response is stale"`

## Warunki

* 呕dania u偶ywajce tych nag贸wk贸w: **`If-Modified-Since`** i **`If-Unmodified-Since`** bd odpowiada danymi tylko wtedy, gdy nag贸wek odpowiedzi **`Last-Modified`** zawiera inn dat.
* Warunkowe 偶dania u偶ywajce **`If-Match`** i **`If-None-Match`** u偶ywaj wartoci Etag, aby serwer WWW wysa zawarto odpowiedzi, jeli dane (Etag) si zmieniy. `Etag` jest pobierany z odpowiedzi HTTP.
* Warto **Etag** jest zazwyczaj **obliczana na podstawie** **zawartoci** odpowiedzi. Na przykad, `ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` wskazuje, 偶e `Etag` to **Sha1** **37 bajt贸w**.

## 呕dania zakresu

* **`Accept-Ranges`**: Wskazuje, czy serwer obsuguje 偶dania zakresu, a jeli tak, w jakiej jednostce zakres mo偶e by wyra偶ony. `Accept-Ranges: <range-unit>`
* **`Range`**: Wskazuje cz dokumentu, kt贸r serwer powinien zwr贸ci.
* **`If-Range`**: Tworzy warunkowe 偶danie zakresu, kt贸re jest spenione tylko wtedy, gdy podany etag lub data pasuje do zdalnego zasobu. U偶ywane do zapobiegania pobieraniu dw贸ch zakres贸w z niekompatybilnych wersji zasobu.
* **`Content-Range`**: Wskazuje, gdzie w penej wiadomoci ciaa nale偶y umieci wiadomo czciow.

## Informacje o ciele wiadomoci

* **`Content-Length`:** Rozmiar zasobu, w dziesitnych bajtach.
* **`Content-Type`**: Wskazuje typ medi贸w zasobu
* **`Content-Encoding`**: U偶ywane do okrelenia algorytmu kompresji.
* **`Content-Language`**: Opisuje jzyk(languages) przeznaczony dla odbiorc贸w, aby umo偶liwi u偶ytkownikowi r贸偶nicowanie wedug wasnych preferencji jzykowych.
* **`Content-Location`**: Wskazuje alternatywn lokalizacj dla zwr贸conych danych.

Z punktu widzenia pentestu te informacje s zazwyczaj "bezu偶yteczne", ale jeli zas贸b jest **chroniony** przez 401 lub 403 i mo偶esz znale藕 jaki **spos贸b** na **uzyskanie** tych **informacji**, mo偶e to by **interesujce.**\
Na przykad kombinacja **`Range`** i **`Etag`** w 偶daniu HEAD mo偶e ujawni zawarto strony za pomoc 偶da HEAD:

* 呕danie z nag贸wkiem `Range: bytes=20-20` i odpowiedzi zawierajc `ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` ujawnia, 偶e SHA1 bajtu 20 to `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`

## Informacje o serwerze

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## Kontrole

* **`Allow`**: Ten nag贸wek jest u偶ywany do komunikowania metod HTTP, kt贸re zas贸b mo偶e obsugiwa. Na przykad mo偶e by okrelony jako `Allow: GET, POST, HEAD`, co wskazuje, 偶e zas贸b obsuguje te metody.
* **`Expect`**: Wykorzystywany przez klienta do przekazywania oczekiwa, kt贸re serwer musi speni, aby 偶danie mogo zosta pomylnie przetworzone. Typowym przypadkiem u偶ycia jest nag贸wek `Expect: 100-continue`, kt贸ry sygnalizuje, 偶e klient zamierza wysa du偶 ilo danych. Klient oczekuje na odpowied藕 `100 (Continue)` przed kontynuowaniem transmisji. Mechanizm ten pomaga w optymalizacji wykorzystania sieci poprzez oczekiwanie na potwierdzenie serwera.

## Pobierania

* Nag贸wek **`Content-Disposition`** w odpowiedziach HTTP wskazuje, czy plik powinien by wywietlany **inline** (w obrbie strony) czy traktowany jako **zacznik** (pobierany). Na przykad:
```
Content-Disposition: attachment; filename="filename.jpg"
```
To oznacza, 偶e plik o nazwie "filename.jpg" ma by pobrany i zapisany.

## Nag贸wki zabezpiecze

### Polityka bezpieczestwa treci (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **Zaufane typy**

Wymuszajc Zaufane Typy za pomoc CSP, aplikacje mog by chronione przed atakami XSS w DOM. Zaufane Typy zapewniaj, 偶e tylko specjalnie przygotowane obiekty, zgodne z ustalonymi politykami bezpieczestwa, mog by u偶ywane w niebezpiecznych wywoaniach API w sieci, co zabezpiecza kod JavaScript domylnie.
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

Ten nag贸wek zapobiega sniffingowi typu MIME, praktyce, kt贸ra mo偶e prowadzi do podatnoci XSS. Zapewnia, 偶e przegldarki respektuj typy MIME okrelone przez serwer.
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

Aby zwalczy clickjacking, ten nag贸wek ogranicza spos贸b, w jaki dokumenty mog by osadzane w tagach `<frame>`, `<iframe>`, `<embed>` lub `<object>`, zalecajc, aby wszystkie dokumenty wyra藕nie okrelay swoje uprawnienia do osadzania.
```
X-Frame-Options: DENY
```
### **Cross-Origin Resource Policy (CORP) i Cross-Origin Resource Sharing (CORS)**

CORP jest kluczowy dla okrelenia, kt贸re zasoby mog by adowane przez strony internetowe, agodzc cross-site leaks. CORS, z drugiej strony, pozwala na bardziej elastyczny mechanizm udostpniania zasob贸w midzy r贸偶nymi 藕r贸dami, agodzc polityk tego samego 藕r贸da w okrelonych warunkach.
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Polityka Osadzania Midzydomenowego (COEP) i Polityka Otwierania Midzydomenowego (COOP)**

COEP i COOP s niezbdne do umo偶liwienia izolacji midzydomenowej, znacznie zmniejszajc ryzyko atak贸w podobnych do Spectre. Kontroluj one adowanie zasob贸w midzydomenowych oraz interakcj z oknami midzydomenowymi, odpowiednio.
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

Na koniec, HSTS to funkcja zabezpiecze, kt贸ra zmusza przegldarki do komunikacji z serwerami tylko za porednictwem bezpiecznych pocze HTTPS, co zwiksza prywatno i bezpieczestwo.
```
Strict-Transport-Security: max-age=3153600
```
## References

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
