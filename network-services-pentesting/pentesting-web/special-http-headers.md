# Special HTTP headers

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Wordlists & Tools

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## Headers to Change Location

Rewrite **IP source**:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (Check hop-by-hop headers)

Rewrite **location**:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## Hop-by-Hop headers

A hop-by-hop header is a header which is designed to be processed and consumed by the proxy currently handling the request, as opposed to an end-to-end header.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTP Request Smuggling

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## Cache Headers

**Server Cache Headers**:

* **`X-Cache`** in the response may have the value **`miss`** when the request wasn't cached and the value **`hit`** when it is cached
* Similar behaviour in the header **`Cf-Cache-Status`**
* **`Cache-Control`** indicates if a resource is being cached and when will be the next time the resource will be cached again: `Cache-Control: public, max-age=1800`
* **`Vary`** is often used in the response to **indicate additional headers** that are treated as **part of the cache key** even if they are normally unkeyed.
* **`Age`** defines the times in seconds the object has been in the proxy cache.
* **`Server-Timing: cdn-cache; desc=HIT`** also indicates that a resource was cached

{% content-ref url="../../pentesting-web/cache-deception/" %}
[cache-deception](../../pentesting-web/cache-deception/)
{% endcontent-ref %}

**Local Cache headers**:

* `Clear-Site-Data`: ìºì‹œë¥¼ ì œê±°í•´ì•¼ í•¨ì„ ë‚˜íƒ€ë‚´ëŠ” í—¤ë”: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: ì‘ë‹µì´ ë§Œë£Œë˜ì–´ì•¼ í•˜ëŠ” ë‚ ì§œ/ì‹œê°„ì„ í¬í•¨: `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` `Cache-Control: no-cache`ì™€ ë™ì¼
* `Warning`: **`Warning`** ì¼ë°˜ HTTP í—¤ë”ëŠ” ë©”ì‹œì§€ ìƒíƒœì™€ ê´€ë ¨ëœ ê°€ëŠ¥í•œ ë¬¸ì œì— ëŒ€í•œ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ì‘ë‹µì— ì—¬ëŸ¬ ê°œì˜ `Warning` í—¤ë”ê°€ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `Warning: 110 anderson/1.3.37 "Response is stale"`

## Conditionals

* Requests using these headers: **`If-Modified-Since`** and **`If-Unmodified-Since`** will be responded with data only if the response header\*\*`Last-Modified`\*\* contains a different time.
* Conditional requests using **`If-Match`** and **`If-None-Match`** use an Etag value so the web server will send the content of the response if the data (Etag) has changed. The `Etag` is taken from the HTTP response.
* The **Etag** value is usually **calculated based** on the **content** of the response. For example, `ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` indicates that the `Etag` is the **Sha1** of **37 bytes**.

## Range requests

* **`Accept-Ranges`**: ì„œë²„ê°€ ë²”ìœ„ ìš”ì²­ì„ ì§€ì›í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ë©°, ì§€ì›í•˜ëŠ” ê²½ìš° ë²”ìœ„ë¥¼ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ë‹¨ìœ„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. `Accept-Ranges: <range-unit>`
* **`Range`**: ì„œë²„ê°€ ë°˜í™˜í•´ì•¼ í•˜ëŠ” ë¬¸ì„œì˜ ë¶€ë¶„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
* **`If-Range`**: ì£¼ì–´ì§„ etag ë˜ëŠ” ë‚ ì§œê°€ ì›ê²© ë¦¬ì†ŒìŠ¤ì™€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ì—ë§Œ ì´í–‰ë˜ëŠ” ì¡°ê±´ë¶€ ë²”ìœ„ ìš”ì²­ì„ ìƒì„±í•©ë‹ˆë‹¤. ë¦¬ì†ŒìŠ¤ì˜ í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ë²„ì „ì—ì„œ ë‘ ë²”ìœ„ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
* **`Content-Range`**: ì „ì²´ ë³¸ë¬¸ ë©”ì‹œì§€ì—ì„œ ë¶€ë¶„ ë©”ì‹œì§€ê°€ ì†í•˜ëŠ” ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

## Message body information

* **`Content-Length`:** ë¦¬ì†ŒìŠ¤ì˜ í¬ê¸°, ë°”ì´íŠ¸ì˜ 10ì§„ìˆ˜ ìˆ˜.
* **`Content-Type`**: ë¦¬ì†ŒìŠ¤ì˜ ë¯¸ë””ì–´ ìœ í˜•ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
* **`Content-Encoding`**: ì••ì¶• ì•Œê³ ë¦¬ì¦˜ì„ ì§€ì •í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
* **`Content-Language`**: ì²­ì¤‘ì„ ìœ„í•œ ì˜ë„ëœ ì¸ê°„ ì–¸ì–´ë¥¼ ì„¤ëª…í•˜ì—¬ ì‚¬ìš©ìê°€ ìì‹ ì˜ ì„ í˜¸í•˜ëŠ” ì–¸ì–´ì— ë”°ë¼ êµ¬ë³„í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
* **`Content-Location`**: ë°˜í™˜ëœ ë°ì´í„°ì˜ ëŒ€ì²´ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

From a pentest point of view this information is usually "useless", but if the resource is **protected** by a 401 or 403 and you can find some **way** to **get** this **info**, this could be **interesting.**\
For example a combination of **`Range`** and **`Etag`** in a HEAD request can leak the content of the page via HEAD requests:

* A request with the header `Range: bytes=20-20` and with a response containing `ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` is leaking that the SHA1 of the byte 20 is `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`

## Server Info

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## Controls

* **`Allow`**: ì´ í—¤ë”ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” HTTP ë©”ì„œë“œë¥¼ ì „ë‹¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `Allow: GET, POST, HEAD`ë¡œ ì§€ì •ë  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ì´ëŸ¬í•œ ë©”ì„œë“œë¥¼ ì§€ì›í•¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
* **`Expect`**: í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ê¸° ìœ„í•´ ì„œë²„ê°€ ì¶©ì¡±í•´ì•¼ í•˜ëŠ” ê¸°ëŒ€ë¥¼ ì „ë‹¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì¼ë°˜ì ì¸ ì‚¬ìš© ì‚¬ë¡€ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ëŒ€ëŸ‰ì˜ ë°ì´í„° í˜ì´ë¡œë“œë¥¼ ì „ì†¡í•  ì˜ë„ê°€ ìˆìŒì„ ë‚˜íƒ€ë‚´ëŠ” `Expect: 100-continue` í—¤ë”ì…ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ì „ì†¡ì„ ì§„í–‰í•˜ê¸° ì „ì— `100 (Continue)` ì‘ë‹µì„ ì°¾ìŠµë‹ˆë‹¤. ì´ ë©”ì»¤ë‹ˆì¦˜ì€ ì„œë²„ í™•ì¸ì„ ê¸°ë‹¤ë¦¼ìœ¼ë¡œì¨ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ì„ ìµœì í™”í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

## Downloads

* The **`Content-Disposition`** header in HTTP responses directs whether a file should be displayed **inline** (within the webpage) or treated as an **attachment** (downloaded). For instance:
```
Content-Disposition: attachment; filename="filename.jpg"
```
ì´ê²ƒì€ "filename.jpg"ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ê³  ì €ì¥ë˜ë„ë¡ ì˜ë„ë˜ì—ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

## ë³´ì•ˆ í—¤ë”

### ì½˜í…ì¸  ë³´ì•ˆ ì •ì±… (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ìœ í˜•**

CSPë¥¼ í†µí•´ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ìœ í˜•ì„ ê°•ì œí•¨ìœ¼ë¡œì¨, ì• í”Œë¦¬ì¼€ì´ì…˜ì€ DOM XSS ê³µê²©ìœ¼ë¡œë¶€í„° ë³´í˜¸ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ìœ í˜•ì€ íŠ¹ì • ë³´ì•ˆ ì •ì±…ì„ ì¤€ìˆ˜í•˜ëŠ” íŠ¹ë³„íˆ ì œì‘ëœ ê°ì²´ë§Œì´ ìœ„í—˜í•œ ì›¹ API í˜¸ì¶œì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•˜ì—¬, ê¸°ë³¸ì ìœ¼ë¡œ JavaScript ì½”ë“œë¥¼ ì•ˆì „í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

ì´ í—¤ë”ëŠ” MIME íƒ€ì… ìŠ¤ë‹ˆí•‘ì„ ë°©ì§€í•˜ë©°, ì´ëŠ” XSS ì·¨ì•½ì ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ” í–‰ìœ„ì…ë‹ˆë‹¤. ì´ í—¤ë”ëŠ” ë¸Œë¼ìš°ì €ê°€ ì„œë²„ì—ì„œ ì§€ì •í•œ MIME íƒ€ì…ì„ ì¤€ìˆ˜í•˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

í´ë¦­ì¬í‚¹ì„ ë°©ì§€í•˜ê¸° ìœ„í•´, ì´ í—¤ë”ëŠ” ë¬¸ì„œê°€ `<frame>`, `<iframe>`, `<embed>`, ë˜ëŠ” `<object>` íƒœê·¸ì— ì–´ë–»ê²Œ í¬í•¨ë  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì œí•œí•˜ë©°, ëª¨ë“  ë¬¸ì„œê°€ ìì‹ ì˜ í¬í•¨ ê¶Œí•œì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•  ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
```
X-Frame-Options: DENY
```
### **Cross-Origin Resource Policy (CORP) ë° Cross-Origin Resource Sharing (CORS)**

CORPëŠ” ì›¹ì‚¬ì´íŠ¸ê°€ ì–´ë–¤ ë¦¬ì†ŒìŠ¤ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì§€ì •í•˜ëŠ” ë° ì¤‘ìš”í•˜ë©°, êµì°¨ ì‚¬ì´íŠ¸ ëˆ„ìˆ˜ë¥¼ ì™„í™”í•©ë‹ˆë‹¤. ë°˜ë©´ CORSëŠ” íŠ¹ì • ì¡°ê±´ í•˜ì— ë™ì¼ ì¶œì²˜ ì •ì±…ì„ ì™„í™”í•˜ì—¬ ë³´ë‹¤ ìœ ì—°í•œ êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ  ë©”ì»¤ë‹ˆì¦˜ì„ í—ˆìš©í•©ë‹ˆë‹¤.
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Cross-Origin Embedder Policy (COEP) ë° Cross-Origin Opener Policy (COOP)**

COEPì™€ COOPëŠ” êµì°¨ ì¶œì²˜ ê²©ë¦¬ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ë° í•„ìˆ˜ì ì´ë©°, Spectreì™€ ìœ ì‚¬í•œ ê³µê²©ì˜ ìœ„í—˜ì„ í¬ê²Œ ì¤„ì…ë‹ˆë‹¤. ì´ë“¤ì€ ê°ê° êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ì˜ ë¡œë”©ê³¼ êµì°¨ ì¶œì²˜ ì°½ê³¼ì˜ ìƒí˜¸ì‘ìš©ì„ ì œì–´í•©ë‹ˆë‹¤.
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

ë§ˆì§€ë§‰ìœ¼ë¡œ, HSTSëŠ” ë¸Œë¼ìš°ì €ê°€ ì„œë²„ì™€ ì˜¤ì§ ì•ˆì „í•œ HTTPS ì—°ê²°ì„ í†µí•´ì„œë§Œ í†µì‹ í•˜ë„ë¡ ê°•ì œí•˜ëŠ” ë³´ì•ˆ ê¸°ëŠ¥ìœ¼ë¡œ, ê°œì¸ ì •ë³´ ë³´í˜¸ì™€ ë³´ì•ˆì„ ê°•í™”í•©ë‹ˆë‹¤.
```
Strict-Transport-Security: max-age=3153600
```
## References

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
