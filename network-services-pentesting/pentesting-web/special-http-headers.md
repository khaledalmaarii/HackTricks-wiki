# En-tÃªtes HTTP spÃ©ciaux

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Listes de mots et outils

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## En-tÃªtes pour changer l'emplacement

RÃ©Ã©crire **l'adresse IP source** :

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (VÃ©rifiez les en-tÃªtes hop-by-hop)

RÃ©Ã©crire **l'emplacement** :

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## En-tÃªtes hop-by-hop

Un en-tÃªte hop-by-hop est un en-tÃªte conÃ§u pour Ãªtre traitÃ© et consommÃ© par le proxy qui traite actuellement la requÃªte, par opposition Ã  un en-tÃªte de bout en bout.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTP Request Smuggling

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## En-tÃªtes de cache

**En-tÃªtes de cache du serveur** :

* **`X-Cache`** dans la rÃ©ponse peut avoir la valeur **`miss`** lorsque la requÃªte n'a pas Ã©tÃ© mise en cache et la valeur **`hit`** lorsqu'elle est mise en cache
* **`Cache-Control`** indique si une ressource est mise en cache et quand la prochaine fois que la ressource sera mise en cache : `Cache-Control: public, max-age=1800`
* **`Vary`** est souvent utilisÃ© dans la rÃ©ponse pour **indiquer des en-tÃªtes supplÃ©mentaires** qui sont traitÃ©s comme **partie de la clÃ© de cache** mÃªme s'ils ne sont normalement pas clÃ©s.
* **`Age`** dÃ©finit les temps en secondes pendant lesquels l'objet a Ã©tÃ© dans le cache proxy.
* **`Server-Timing: cdn-cache; desc=HIT`** indique Ã©galement qu'une ressource a Ã©tÃ© mise en cache

{% content-ref url="../../pentesting-web/cache-deception.md" %}
[cache-deception.md](../../pentesting-web/cache-deception.md)
{% endcontent-ref %}

**En-tÃªtes de cache local** :

* `Clear-Site-Data`: En-tÃªte pour indiquer le cache qui doit Ãªtre supprimÃ© : `Clear-Site-Data: "cache", "cookies"`
* `Expires`: Contient la date/heure Ã  laquelle la rÃ©ponse doit expirer
```http
Content-Security-Policy: require-trusted-types-for 'script'
```

```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
  // Name and create a policy
  const policy = trustedTypes.createPolicy('escapePolicy', {
    createHTML: str => {
      return str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
    }
  });
}
```

```javascript
// Assignment of raw strings is blocked by Trusted Types.
el.innerHTML = 'some string'; // This throws an exception.

// Assignment of Trusted Types is accepted safely.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // '&lt;img src=x onerror=alert(1)&gt;'
```
### X-Content-Type-Options <a href="#xcto" id="xcto"></a>

Lorsqu'un document HTML malveillant est servi depuis votre domaine (par exemple, si une image tÃ©lÃ©chargÃ©e sur un service de photos contient une balise HTML valide), certains navigateurs le traiteront comme un document actif et lui permettront d'exÃ©cuter des scripts dans le contexte de l'application, ce qui entraÃ®ne une faille de [cross-site scripting](https://www.google.com/about/appsecurity/learning/xss/).

`X-Content-Type-Options: nosniff` l'empÃªche en indiquant au navigateur que le [type MIME](https://mimesniff.spec.whatwg.org/#introduction) dÃ©fini dans l'en-tÃªte `Content-Type` pour une rÃ©ponse donnÃ©e est correct. Cette en-tÃªte est recommandÃ©e pour **toutes vos ressources**.
```http
X-Content-Type-Options: nosniff
```
### X-Frame-Options <a href="#xfo" id="xfo"></a>

Si un site Web malveillant peut intÃ©grer votre site en tant qu'iframe, cela peut permettre aux attaquants d'invoquer des actions non intentionnelles de l'utilisateur avec [clickjacking](https://portswigger.net/web-security/clickjacking). De plus, dans certains cas, les attaques de type [Spectre](https://en.wikipedia.org/wiki/Spectre\_\(security\_vulnerability\)) donnent aux sites Web malveillants une chance d'apprendre le contenu d'un document intÃ©grÃ©.

`X-Frame-Options` indique si un navigateur doit Ãªtre autorisÃ© ou non Ã  rendre une page dans un `<frame>`, `<iframe>`, `<embed>` ou `<object>`. **Tous les documents** sont recommandÃ©s d'envoyer cet en-tÃªte pour indiquer s'ils autorisent leur intÃ©gration par d'autres documents.

Si vous avez besoin d'un contrÃ´le plus granulaire, tel que permettre uniquement Ã  une origine spÃ©cifique d'intÃ©grer le document, utilisez la directive [CSP](https://web.dev/security-headers/#csp) [`frame-ancestors`](https://developer.mozilla.org/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).
```http
X-Frame-Options: DENY
```
### Politique de ressources entre origines (CORP) <a href="#corp" id="corp"></a>

Un attaquant peut intÃ©grer des ressources provenant d'une autre origine, par exemple de votre site, pour en apprendre davantage sur elles en exploitant des fuites inter-sites basÃ©es sur le web (cross-site leaks).

`Cross-Origin-Resource-Policy` attÃ©nue ce risque en indiquant l'ensemble de sites web Ã  partir duquel il peut Ãªtre chargÃ©. L'en-tÃªte prend l'une des trois valeurs suivantes : `same-origin`, `same-site` et `cross-origin`. **Toutes les ressources** sont recommandÃ©es d'envoyer cet en-tÃªte pour indiquer si elles autorisent leur chargement par d'autres sites web.
```
Cross-Origin-Resource-Policy: same-origin
```
### Politique de ressources inter-origines (CORB) <a href="#corp" id="corp"></a>

Elle aide Ã  attÃ©nuer la menace des attaques de canal secondaire (y compris Spectre). Elle est conÃ§ue pour empÃªcher le navigateur de **dÃ©livrer certaines rÃ©ponses de rÃ©seau inter-origines Ã  une page web**, lorsqu'elles pourraient contenir des informations sensibles et ne sont **pas nÃ©cessaires pour les fonctionnalitÃ©s web existantes**.\
De la mÃªme maniÃ¨re, elle aide Ã©galement Ã  attÃ©nuer les vulnÃ©rabilitÃ©s d'inclusion de script entre sites (XSSI).\
Par exemple, elle bloquera une rÃ©ponse text/html inter-origines demandÃ©e Ã  partir d'une balise \<script> ou \<img>, la remplaÃ§ant par une rÃ©ponse vide Ã  la place. C'est une partie importante des protections incluses avec [Site Isolation](https://www.chromium.org/Home/chromium-security/site-isolation).

### Politique d'ouverture inter-origines (COOP) <a href="#coop" id="coop"></a>

Le site d'un attaquant peut ouvrir un autre site dans une fenÃªtre contextuelle pour en apprendre des informations en exploitant des [fuites inter-sites basÃ©es sur le web](https://xsleaks.dev). Dans certains cas, cela peut Ã©galement permettre l'exploitation d'attaques de canal secondaire basÃ©es sur [Spectre](https://en.wikipedia.org/wiki/Spectre\_\(security\_vulnerability\)).

L'en-tÃªte `Cross-Origin-Opener-Policy` fournit un moyen Ã  un document de s'isoler des fenÃªtres inter-origines ouvertes via `window.open()` ou un lien avec `target="_blank"` sans `rel="noopener"`. En consÃ©quence, tout ouvreur inter-origines du document n'aura aucune rÃ©fÃ©rence Ã  celui-ci et ne pourra pas interagir avec lui.
```http
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### Partage des ressources entre origines multiples (CORS) <a href="#cors" id="cors"></a>

Contrairement aux autres Ã©lÃ©ments de cet article, le partage des ressources entre origines multiples (CORS) n'est pas un en-tÃªte, mais un mÃ©canisme de navigateur qui demande et permet l'accÃ¨s Ã  des ressources entre origines multiples.

Par dÃ©faut, les navigateurs appliquent [la politique de mÃªme origine](https://web.dev/same-origin-policy/) pour empÃªcher une page web d'accÃ©der Ã  des ressources entre origines multiples. Par exemple, lorsqu'une image entre origines multiples est chargÃ©e, mÃªme si elle est affichÃ©e sur la page web visuellement, le JavaScript sur la page n'a pas accÃ¨s aux donnÃ©es de l'image. Le fournisseur de ressources peut assouplir les restrictions et permettre Ã  d'autres sites web de lire la ressource en optant pour CORS.
```http
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### Politique d'intÃ©gration de l'origine croisÃ©e (COEP) <a href="#coep" id="coep"></a>

Pour rÃ©duire la capacitÃ© des attaques basÃ©es sur [Spectre](https://en.wikipedia.org/wiki/Spectre\_\(security\_vulnerability\)) Ã  voler des ressources d'origine croisÃ©e, des fonctionnalitÃ©s telles que `SharedArrayBuffer` ou `performance.measureUserAgentSpecificMemory()` sont dÃ©sactivÃ©es par dÃ©faut.

`Cross-Origin-Embedder-Policy: require-corp` empÃªche les documents et les travailleurs de charger des ressources d'origine croisÃ©e telles que des images, des scripts, des feuilles de style, des iframes et d'autres, Ã  moins que ces ressources n'optent explicitement pour le chargement via des en-tÃªtes [CORS](https://web.dev/security-headers/#cors) ou [CORP](https://web.dev/security-headers/#corp). COEP peut Ãªtre combinÃ© avec `Cross-Origin-Opener-Policy` pour opter un document pour l'isolation d'origine croisÃ©e.

Utilisez `Cross-Origin-Embedder-Policy: require-corp` lorsque vous souhaitez activer l'isolation d'origine croisÃ©e pour votre document.
```http
Cross-Origin-Embedder-Policy: require-corp
```
### HTTP Strict Transport Security (HSTS) <a href="#hsts" id="hsts"></a>

La communication sur une connexion HTTP non chiffrÃ©e n'est pas cryptÃ©e, ce qui rend les donnÃ©es transfÃ©rÃ©es accessibles aux espions du rÃ©seau.

L'en-tÃªte `Strict-Transport-Security` informe le navigateur qu'il ne doit jamais charger le site en utilisant HTTP et qu'il doit plutÃ´t utiliser HTTPS. Une fois qu'il est dÃ©fini, le navigateur utilisera HTTPS au lieu de HTTP pour accÃ©der au domaine sans redirection pendant une durÃ©e dÃ©finie dans l'en-tÃªte.
```http
Strict-Transport-Security: max-age=3153600
```
## Ressources

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
