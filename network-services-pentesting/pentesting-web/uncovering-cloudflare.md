# æ­éœ²CloudFlare

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºè‹±é›„</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

å°è¯•æ­éœ²CloudflareèƒŒåçš„webæœåŠ¡å™¨çš„æŠ€æœ¯ï¼š

### æŠ€æœ¯

* æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›æä¾›åŸŸå**å†å²DNSè®°å½•**çš„æœåŠ¡ã€‚ä¹Ÿè®¸ç½‘é¡µæ­£åœ¨ä¹‹å‰ä½¿ç”¨çš„IPåœ°å€ä¸Šè¿è¡Œã€‚
* é€šè¿‡**æ£€æŸ¥å†å²SSLè¯ä¹¦**ä¹Ÿå¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œè¿™äº›è¯ä¹¦å¯èƒ½æŒ‡å‘åŸå§‹IPåœ°å€ã€‚
* åŒæ ·æ£€æŸ¥æŒ‡å‘IPçš„**å…¶ä»–å­åŸŸçš„DNSè®°å½•**ï¼Œå› ä¸ºæœ‰å¯èƒ½å…¶ä»–å­åŸŸæŒ‡å‘åŒä¸€æœåŠ¡å™¨ï¼ˆå¯èƒ½æä¾›FTPã€é‚®ä»¶æˆ–å…¶ä»–æœåŠ¡ï¼‰ã€‚
* å¦‚æœæ‚¨åœ¨webåº”ç”¨ç¨‹åºä¸­å‘ç°äº†**SSRF**ï¼Œæ‚¨å¯ä»¥æ»¥ç”¨å®ƒæ¥è·å–æœåŠ¡å™¨çš„IPåœ°å€ã€‚
*

åœ¨shodanç­‰æµè§ˆå™¨ä¸­æœç´¢ç½‘é¡µçš„ç‹¬ç‰¹å­—ç¬¦ä¸²ï¼ˆä¹Ÿè®¸è¿˜æœ‰googleå’Œç±»ä¼¼çš„ï¼Ÿï¼‰ã€‚ä¹Ÿè®¸æ‚¨å¯ä»¥æ‰¾åˆ°å¸¦æœ‰è¯¥å†…å®¹çš„IPåœ°å€ã€‚

* ç±»ä¼¼åœ°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å·¥å…·ï¼š[https://github.com/karma9874/CloudFlare-IP](https://github.com/karma9874/CloudFlare-IP) æˆ– [https://github.com/pielco11/fav-up](https://github.com/pielco11/fav-up) æ¥æœç´¢faviconå›¾æ ‡ï¼Œè€Œä¸æ˜¯å¯»æ‰¾å”¯ä¸€å­—ç¬¦ä¸²
* è¿™ç§æ–¹æ³•ä¸ä¼šç»å¸¸æœ‰æ•ˆï¼Œå› ä¸ºæœåŠ¡å™¨å¿…é¡»åœ¨é€šè¿‡IPåœ°å€è®¿é—®æ—¶å‘é€ç›¸åŒçš„å“åº”ï¼Œä½†ä½ æ°¸è¿œä¸çŸ¥é“ã€‚

### å·¥å…·

* åœ¨ [http://www.crimeflare.org:82/cfs.html](http://www.crimeflare.org:82/cfs.html) æˆ– [https://crimeflare.herokuapp.com](https://crimeflare.herokuapp.com) ä¸­æœç´¢åŸŸåã€‚æˆ–ä½¿ç”¨å·¥å…· [CloudPeler](https://github.com/zidansec/CloudPeler)ï¼ˆä½¿ç”¨è¯¥APIï¼‰
* åœ¨ [https://leaked.site/index.php?resolver/cloudflare.0/](https://leaked.site/index.php?resolver/cloudflare.0/) ä¸­æœç´¢åŸŸå
* [**CloudFlair**](https://github.com/christophetd/CloudFlair) æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå°†ä½¿ç”¨Censysè¯ä¹¦æœç´¢åŒ…å«åŸŸåçš„è¯ä¹¦ï¼Œç„¶åå®ƒå°†åœ¨è¿™äº›è¯ä¹¦ä¸­æœç´¢IPv4ï¼Œæœ€åå®ƒå°†å°è¯•åœ¨è¿™äº›IPä¸­è®¿é—®ç½‘é¡µã€‚
* [Censys](https://search.censys.io/)
* [Shodan](https://shodan.io/)
* [Bypass-firewalls-by-DNS-history](https://github.com/vincentcox/bypass-firewalls-by-DNS-history)
* å¦‚æœæ‚¨æœ‰ä¸€ç»„æ½œåœ¨çš„IPï¼Œç½‘é¡µå¯èƒ½ä½äºé‚£é‡Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [https://github.com/hakluke/hakoriginfinder](https://github.com/hakluke/hakoriginfinder)
```bash
# You can check if the tool is working with
prips 1.0.0.0/30 | hakoriginfinder -h one.one.one.one

# If you know the company is using AWS you could use the previous tool to search the
## web page inside the EC2 IPs
DOMAIN=something.com
WIDE_REGION=us
for ir in `curl https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | select(.region|test("^us")) | .ip_prefix'`; do
echo "Checking $ir"
prips $ir | hakoriginfinder -h "$DOMAIN"
done
```
### æ­éœ²æ¥è‡ªAWSæœºå™¨çš„Cloudflare

è¦äº†è§£æ­¤è¿‡ç¨‹çš„æ›´å¥½æè¿°ï¼Œè¯·æŸ¥çœ‹ï¼š

{% embed url="https://trickest.com/blog/cloudflare-bypass-discover-ip-addresses-aws/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
```bash
# Find open ports
sudo masscan --max-rate 10000 -p80,443 $(curl -s https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | .ip_prefix' | tr '\n' ' ') | grep "open"  > all_open.txt
# Format results
cat all_open.txt | sed 's,.*port \(.*\)/tcp on \(.*\),\2:\1,' | tr -d " " > all_open_formated.txt
# Search actual web pages
httpx -silent -threads 200 -l all_open_formated.txt -random-agent -follow-redirects -json -no-color -o webs.json
# Format web results and remove eternal redirects
cat webs.json | jq -r "select((.failed==false) and (.chain_status_codes | length) < 9) | .url" | sort -u > aws_webs.json

# Search via Host header
httpx -json -no-color -list aws_webs.json -header Host: cloudflare.malwareworld.com -threads 250 -random-agent -follow-redirects -o web_checks.json
```
## ç»•è¿‡ Cloudflare

### è®¤è¯æºæ‹‰å–

æ­¤æœºåˆ¶ä¾èµ–äº**å®¢æˆ·ç«¯**çš„ [**SSL è¯ä¹¦**](https://socradar.io/how-to-monitor-your-ssl-certificates-expiration-easily-and-why/) **æ¥è®¤è¯è¿æ¥**ï¼Œåœ¨ **Cloudflare çš„åå‘ä»£ç†** æœåŠ¡å™¨å’Œ**æº**æœåŠ¡å™¨ä¹‹é—´ï¼Œè¿™ç§°ä¸º **mTLS**ã€‚

å®¢æˆ·æ— éœ€é…ç½®è‡ªå·±çš„è¯ä¹¦ï¼Œå¯ä»¥ç®€å•ä½¿ç”¨ Cloudflare çš„è¯ä¹¦å…è®¸æ¥è‡ª Cloudflare çš„ä»»ä½•è¿æ¥ï¼Œ**ä¸ç®¡ç§Ÿæˆ·å¦‚ä½•**ã€‚

{% hint style="danger" %}
å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥è®¾ç½®ä¸€ä¸ªåœ¨ Cloudflare ä¸Šä½¿ç”¨ Cloudflare è¯ä¹¦çš„**åŸŸå**ï¼Œå¹¶å°†å…¶æŒ‡å‘**å—å®³è€…**åŸŸåçš„**IP**åœ°å€ã€‚è¿™æ ·ï¼Œè®¾ç½®ä»–çš„åŸŸåå®Œå…¨æ— ä¿æŠ¤ï¼ŒCloudflare å°†ä¸ä¼šä¿æŠ¤å‘é€çš„è¯·æ±‚ã€‚
{% endhint %}

æ›´å¤šä¿¡æ¯[**è¿™é‡Œ**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/)ã€‚

### å…è®¸åˆ—è¡¨ Cloudflare IP åœ°å€

è¿™å°†**æ‹’ç»ä¸æ˜¯æ¥è‡ª Cloudflare** IP åœ°å€èŒƒå›´çš„è¿æ¥ã€‚è¿™ä¹Ÿå®¹æ˜“å—åˆ°å‰é¢è®¾ç½®çš„æ”»å‡»ï¼Œå…¶ä¸­æ”»å‡»è€…åªéœ€å°†ä»–è‡ªå·±çš„åŸŸååœ¨ Cloudflare ä¸Š**æŒ‡å‘å—å®³è€…çš„ IP** åœ°å€å¹¶æ”»å‡»å®ƒã€‚

æ›´å¤šä¿¡æ¯[**è¿™é‡Œ**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/)ã€‚

## ç»•è¿‡ Cloudflare è¿›è¡ŒæŠ“å–

### ç¼“å­˜

æœ‰æ—¶ä½ åªæƒ³ç»•è¿‡ Cloudflare æ¥æŠ“å–ç½‘é¡µã€‚æœ‰ä¸€äº›é€‰é¡¹ï¼š

* ä½¿ç”¨ Google ç¼“å­˜ï¼š`https://webcache.googleusercontent.com/search?q=cache:https://www.petsathome.com/shop/en/pets/dog`
* ä½¿ç”¨å…¶ä»–ç¼“å­˜æœåŠ¡ï¼Œå¦‚ [https://archive.org/web/](https://archive.org/web/)

### Cloudflare è§£å†³æ–¹æ¡ˆ

å·²ç»å¼€å‘äº†è®¸å¤š Cloudflare è§£å†³æ–¹æ¡ˆï¼š

* [FlareSolverr](https://github.com/FlareSolverr/FlareSolverr)
* [cloudscraper](https://github.com/VeNoMouS/cloudscraper) [æŒ‡å—åœ¨è¿™é‡Œ](https://scrapeops.io/python-web-scraping-playbook/python-cloudscraper/)
* [cloudflare-scrape](https://github.com/Anorov/cloudflare-scrape)
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)
* [Cloudflare-IUAM-Solver](https://github.com/ninja-beans/cloudflare-iuam-solver)
* [cloudflare-bypass](https://github.com/devgianlu/cloudflare-bypass) \[å·²å½’æ¡£]
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)

### åŠ å›ºçš„æ— å¤´æµè§ˆå™¨ <a href="#option-4-scrape-with-fortified-headless-browsers" id="option-4-scrape-with-fortified-headless-browsers"></a>

å¦ä¸€ä¸ªé€‰é¡¹æ˜¯ä½¿ç”¨ç»è¿‡åŠ å›ºçš„æ— å¤´æµè§ˆå™¨æ¥å®Œæˆæ•´ä¸ªæŠ“å–å·¥ä½œï¼Œä½¿å…¶çœ‹èµ·æ¥åƒçœŸå®ç”¨æˆ·çš„æµè§ˆå™¨ï¼š

* **Puppeteerï¼š** [puppeteer](https://github.com/puppeteer/puppeteer) çš„ [éšèº«æ’ä»¶](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth)ã€‚
* **Playwrightï¼š** [éšèº«æ’ä»¶](https://www.npmjs.com/package/playwright-stealth) å³å°†æ¥åˆ° Playwrightã€‚è·Ÿè¿›å‘å±•[è¿™é‡Œ](https://github.com/berstend/puppeteer-extra/issues/454)å’Œ[è¿™é‡Œ](https://github.com/berstend/puppeteer-extra/tree/master/packages/playwright-extra)ã€‚
* **Seleniumï¼š** [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver) æ˜¯ä¸€ä¸ªä¼˜åŒ–çš„ Selenium Chromedriver è¡¥ä¸ã€‚

### å†…ç½® Cloudflare ç»•è¿‡çš„æ™ºèƒ½ä»£ç† <a href="#option-5-smart-proxy-with-cloudflare-built-in-bypass" id="option-5-smart-proxy-with-cloudflare-built-in-bypass"></a>

ä½¿ç”¨å¼€æº Cloudflare ç»•è¿‡çš„æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨å¼€å‘å’Œç»´æŠ¤è‡ªå·±çš„ç§æœ‰ Cloudflare ç»•è¿‡çš„æ™ºèƒ½ä»£ç†ã€‚

è¿™äº›é€šå¸¸æ›´å¯é ï¼Œå› ä¸º Cloudflare æ›´éš¾ä¸ºå®ƒä»¬å¼€å‘è¡¥ä¸ï¼Œè€Œä¸”å®ƒä»¬æ˜¯ç”±ä»£ç†å…¬å¸å¼€å‘çš„ï¼Œè¿™äº›å…¬å¸åœ¨è´¢åŠ¡ä¸Šæœ‰åŠ¨åŠ›é¢†å…ˆ Cloudflare ä¸€æ­¥ï¼Œå¹¶åœ¨å®ƒä»¬çš„ç»•è¿‡åœæ­¢å·¥ä½œçš„é‚£ä¸€åˆ»ç«‹å³ä¿®å¤ã€‚

å¤§å¤šæ•°æ™ºèƒ½ä»£ç†æä¾›å•†ï¼ˆ[ScraperAPI](https://www.scraperapi.com/?fp_ref=scrapeops), [Scrapingbee](https://www.scrapingbee.com/?fpr=scrapeops), [Oxylabs](https://oxylabs.go2cloud.org/aff_c?offer_id=7&aff_id=379&url_id=32), [Smartproxy](https://prf.hn/click/camref:1100loxdG/[p_id:1100l442001]/destination:https%3A%2F%2Fsmartproxy.com%2Fscraping%2Fweb)ï¼‰éƒ½æœ‰æŸç§å½¢å¼çš„ Cloudflare ç»•è¿‡ï¼Œå®ƒä»¬çš„å·¥ä½œç¨‹åº¦å’Œæˆæœ¬å„ä¸ç›¸åŒã€‚

ç„¶è€Œï¼Œæœ€å¥½çš„é€‰æ‹©ä¹‹ä¸€æ˜¯ä½¿ç”¨ [ScrapeOps Proxy Aggregator](https://scrapeops.io/proxy-aggregator/)ï¼Œå› ä¸ºå®ƒå°†è¶…è¿‡ 20 ä¸ªä»£ç†æä¾›å•†é›†æˆåˆ°åŒä¸€ä¸ªä»£ç† API ä¸­ï¼Œå¹¶ä¸ºæ‚¨çš„ç›®æ ‡åŸŸæ‰¾åˆ°æœ€ä½³/æœ€ä¾¿å®œçš„ä»£ç†æä¾›å•†ã€‚

### åå‘å·¥ç¨‹ Cloudflare åçˆ¬è™«ä¿æŠ¤ <a href="#option-6-reverse-engineer-cloudflare-anti-bot-protection" id="option-6-reverse-engineer-cloudflare-anti-bot-protection"></a>

è¿™ç§æ–¹æ³•æœ‰æ•ˆï¼ˆè¿™æ˜¯è®¸å¤šæ™ºèƒ½ä»£ç†è§£å†³æ–¹æ¡ˆæ‰€åšçš„ï¼‰ï¼Œä½†å¹¶éè½»è€Œæ˜“ä¸¾ã€‚

**ä¼˜ç‚¹ï¼š** è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ï¼Œå¦‚æœä½ åœ¨å¤§è§„æ¨¡æŠ“å–ï¼Œè€Œä¸”ä½ ä¸æƒ³è¿è¡Œæ•°ç™¾ï¼ˆå¦‚æœä¸æ˜¯æ•°åƒï¼‰ä¸ªæ˜‚è´µçš„å®Œæ•´æ— å¤´æµè§ˆå™¨å®ä¾‹ã€‚ä½ å¯ä»¥å¼€å‘æœ€èµ„æºé«˜æ•ˆçš„ Cloudflare ç»•è¿‡ã€‚ä¸€ä¸ªä¸“é—¨è®¾è®¡ç”¨æ¥é€šè¿‡ Cloudflare JSã€TLS å’Œ IP æŒ‡çº¹æµ‹è¯•çš„ç»•è¿‡ã€‚

**ç¼ºç‚¹ï¼š** è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼Œä½ å°†ä¸å¾—ä¸æ·±å…¥ç ”ç©¶ä¸€ä¸ªæ•…æ„éš¾ä»¥ä»å¤–éƒ¨ç†è§£çš„åçˆ¬è™«ç³»ç»Ÿï¼Œå¹¶åˆ†æµ‹è¯•ä¸åŒçš„æŠ€æœ¯æ¥æ¬ºéª—ä»–ä»¬çš„éªŒè¯ç³»ç»Ÿã€‚ç„¶åç»´æŠ¤è¿™ä¸ªç³»ç»Ÿï¼Œå› ä¸º Cloudflare ç»§ç»­å¼€å‘ä»–ä»¬çš„åçˆ¬è™«ä¿æŠ¤ã€‚

## å‚è€ƒèµ„æ–™

* [https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/)

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨ **HackTricks** ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF** ç‰ˆæœ¬ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>
