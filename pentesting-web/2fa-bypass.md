# Bypass de 2FA/OTP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Bypass de autenticaÃ§Ã£o de dois fatores**

### **Bypass direto**

Para contornar o 2FA, basta **tentar acessar diretamente o prÃ³ximo endpoint** (vocÃª precisa saber o caminho do prÃ³ximo endpoint). Se isso nÃ£o funcionar, tente alterar o **cabeÃ§alho Referrer** como se vocÃª viesse da pÃ¡gina 2FA.

### **ReutilizaÃ§Ã£o de token**

Talvez vocÃª possa reutilizar um token previamente usado dentro da conta para autenticar.

### Compartilhamento de tokens nÃ£o utilizados

Verifique se vocÃª pode obter o token da sua conta e tente usÃ¡-lo para contornar o 2FA em uma conta diferente.

### Token vazado

O token vazou em uma resposta do aplicativo da web?

### Link de verificaÃ§Ã£o de e-mail

Tente usar o **link de verificaÃ§Ã£o de e-mail recebido quando a conta foi criada** para ver se, mesmo que o 2FA tenha sido configurado, vocÃª ainda pode acessar seu perfil apenas com esse link ([post](https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b)).

### PermissÃ£o de sessÃ£o

Usando a mesma sessÃ£o, inicie o fluxo usando sua conta e a conta da vÃ­tima. Ao atingir o ponto 2FA em ambas as contas, conclua o 2FA com sua conta, mas nÃ£o acesse a prÃ³xima parte. Em vez disso, tente acessar a prÃ³xima etapa com o fluxo da conta da vÃ­tima. Se o back-end apenas definir um booleano dentro de suas sessÃµes dizendo que vocÃª passou com sucesso pelo 2FA, vocÃª poderÃ¡ contornar o 2FA da vÃ­tima.

### **FunÃ§Ã£o de redefiniÃ§Ã£o de senha**

Em quase todas as aplicaÃ§Ãµes da web, a **funÃ§Ã£o de redefiniÃ§Ã£o de senha faz login automaticamente no aplicativo** apÃ³s o procedimento de redefiniÃ§Ã£o ser concluÃ­do.\
Verifique se um **e-mail** Ã© enviado com um **link** para **redefinir a senha** e se vocÃª pode **reutilizar** esse **link** para redefinir a senha **quantas vezes quiser** (mesmo que a vÃ­tima altere seu endereÃ§o de e-mail).

Outra opÃ§Ã£o para contornar o 2FA com a funcionalidade de redefiniÃ§Ã£o de senha Ã© **redefinir a senha com acesso ao e-mail** e usar a **nova senha para fazer login**, Ã© possÃ­vel que apÃ³s a alteraÃ§Ã£o da senha o 2FA nÃ£o seja usado.

### OAuth

Se vocÃª puder comprometer a conta do usuÃ¡rio em uma plataforma de **OAuth** confiÃ¡vel (Google, Facebook...)

### ForÃ§a bruta

#### Falta de limite de taxa

Existe algum limite no nÃºmero de cÃ³digos que vocÃª pode tentar, para que vocÃª possa simplesmente fazer uma forÃ§a bruta? Tenha cuidado com um possÃ­vel limite de taxa "silencioso", sempre tente vÃ¡rios cÃ³digos e depois o real para confirmar a vulnerabilidade.

#### Limite de fluxo, mas sem limite de taxa

Nesse caso, hÃ¡ um limite de fluxo (vocÃª precisa fazer uma forÃ§a bruta muito devagar: 1 thread e algum tempo de espera antes de 2 tentativas), mas sem limite de taxa. Portanto, com tempo suficiente, vocÃª pode encontrar o cÃ³digo vÃ¡lido.

#### Reenviar cÃ³digo e redefinir o limite

Existe um limite de taxa, mas quando vocÃª "reenvia o cÃ³digo", o mesmo cÃ³digo Ã© enviado e o limite de taxa Ã© redefinido. Em seguida, vocÃª pode fazer uma forÃ§a bruta no cÃ³digo enquanto o reenvia, para que o limite de taxa nunca seja atingido.

#### Bypass de limite de taxa no lado do cliente

{% content-ref url="rate-limit-bypass.md" %}
[rate-limit-bypass.md](rate-limit-bypass.md)
{% endcontent-ref %}

#### Falta de limite de taxa na conta do usuÃ¡rio

Ã€s vezes, vocÃª pode configurar o 2FA para algumas aÃ§Ãµes dentro da sua conta (alterar e-mail, senha...). No entanto, mesmo nos casos em que hÃ¡ um limite de taxa ao tentar fazer login, nÃ£o hÃ¡ limite de taxa para proteger as aÃ§Ãµes dentro da conta.

#### Falta de limite de taxa ao reenviar o cÃ³digo via SMS

VocÃª nÃ£o poderÃ¡ contornar o 2FA, mas poderÃ¡ gastar o dinheiro da empresa.

#### RegeneraÃ§Ã£o infinita de OTP

Se vocÃª puder **gerar um novo OTP infinitas vezes**, o OTP for **suficientemente simples** (4 nÃºmeros) e vocÃª puder tentar atÃ© 4 ou 5 tokens por OTP gerado, vocÃª pode simplesmente tentar os mesmos 4 ou 5 tokens todas as vezes e gerar OTPs atÃ© que corresponda aos que vocÃª estÃ¡ usando.

### CondiÃ§Ã£o de corrida

Verifique a seÃ§Ã£o sobre contorno de 2FA na seguinte pÃ¡gina:

{% content-ref url="race-condition.md" %}
[race-condition.md](race-condition.md)
{% endcontent-ref %}
### CSRF/Clickjacking

Verifique se hÃ¡ uma vulnerabilidade de Cross Site Request Forgery (CSRF) ou Clickjacking para desabilitar o 2FA.

### Funcionalidade "Lembrar-me"

#### Cookie previsÃ­vel

Se a funcionalidade "lembrar-me" usa um novo cookie com um cÃ³digo previsÃ­vel, tente adivinhÃ¡-lo.

#### EndereÃ§o IP

Se a funcionalidade "lembrar-me" estÃ¡ vinculada ao seu endereÃ§o IP, vocÃª pode tentar descobrir o endereÃ§o IP da vÃ­tima e se passar por ela usando o cabeÃ§alho **X-Forwarded-For**.

### VersÃµes antigas

#### SubdomÃ­nios

Se vocÃª encontrar alguns subdomÃ­nios de "teste" com a funcionalidade de login, eles podem estar usando versÃµes antigas que nÃ£o suportam 2FA (portanto, sÃ£o diretamente ignorados) ou esses endpoints podem suportar uma versÃ£o vulnerÃ¡vel do 2FA.

#### APIs

Se vocÃª descobrir que o 2FA estÃ¡ usando uma API localizada em um diretÃ³rio /v\* (como "/v3/"), isso provavelmente significa que existem endpoints de API mais antigos que podem ser vulnerÃ¡veis a algum tipo de bypass do 2FA.

### SessÃµes anteriores

Quando o 2FA estÃ¡ ativado, as sessÃµes anteriores criadas devem ser encerradas. Isso ocorre porque quando um cliente tem sua conta comprometida, ele pode querer protegÃª-la ativando o 2FA, mas se as sessÃµes anteriores nÃ£o forem encerradas, isso nÃ£o o protegerÃ¡.

### Controle de acesso inadequado a cÃ³digos de backup

Os cÃ³digos de backup sÃ£o gerados imediatamente apÃ³s a ativaÃ§Ã£o do 2FA e estÃ£o disponÃ­veis em uma Ãºnica solicitaÃ§Ã£o. ApÃ³s cada chamada subsequente Ã  solicitaÃ§Ã£o, os cÃ³digos podem ser regenerados ou permanecer inalterados (cÃ³digos estÃ¡ticos). Se houver configuraÃ§Ãµes incorretas de CORS/vulnerabilidades de XSS e outros bugs que permitam "puxar" os cÃ³digos de backup da resposta da solicitaÃ§Ã£o do endpoint de cÃ³digo de backup, o atacante pode roubar os cÃ³digos e ignorar o 2FA se o nome de usuÃ¡rio e a senha forem conhecidos.

### DivulgaÃ§Ã£o de informaÃ§Ãµes

Se vocÃª notar algumas informaÃ§Ãµes confidenciais aparecendo na pÃ¡gina do 2FA que vocÃª nÃ£o conhecia anteriormente (como o nÃºmero de telefone), isso pode ser considerado uma vulnerabilidade de divulgaÃ§Ã£o de informaÃ§Ãµes.

### **RedefiniÃ§Ã£o de senha == desabilitar 2FA**

1. Crie uma conta e ative o 2FA.
2. FaÃ§a logout dessa conta.
3. Agora, vÃ¡ para a pÃ¡gina de redefiniÃ§Ã£o de senha.
4. Altere sua senha.
5. Tente fazer login.
6. Se vocÃª nÃ£o for solicitado a inserir um cÃ³digo 2FA, vocÃª pode relatar.

## ReferÃªncias

{% embed url="https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35" %}

{% embed url="https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? VocÃª quer ver sua **empresa anunciada no HackTricks**? Ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
