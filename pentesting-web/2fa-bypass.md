# 2FA/MFA/OTP Bypass

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}


## **Techniki obejcia ulepszonej autoryzacji dwuetapowej**

### **Bezporedni dostp do punktu kocowego**

Aby obej 2FA, uzyskaj bezporedni dostp do kolejnego punktu kocowego, znajomo cie偶ki jest kluczowa. Jeli to si nie powiedzie, zmie **nag贸wek Referrer**, aby naladowa nawigacj z strony weryfikacji 2FA.

### **Ponowne wykorzystanie token贸w**

Ponowne wykorzystanie wczeniej u偶ywanych token贸w do autoryzacji w ramach konta mo偶e by skuteczne.

### **Wykorzystanie nieu偶ywanych token贸w**

Mo偶na spr贸bowa wyodrbni token z wasnego konta, aby obej 2FA w innym koncie.

### **Ujawnienie tokenu**

Sprawd藕, czy token jest ujawniony w odpowiedzi z aplikacji webowej.

### **Wykorzystanie linku weryfikacyjnego**

U偶ycie **linku weryfikacyjnego wysanego po utworzeniu konta** mo偶e umo偶liwi dostp do profilu bez 2FA, jak podkrelono w szczeg贸owym [pocie](https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b).

### **Manipulacja sesj**

Inicjowanie sesji zar贸wno dla konta u偶ytkownika, jak i ofiary, oraz zakoczenie 2FA dla konta u偶ytkownika bez kontynuacji, pozwala na pr贸b dostpu do nastpnego kroku w przepywie konta ofiary, wykorzystujc ograniczenia zarzdzania sesjami w zapleczu.

### **Mechanizm resetowania hasa**

Badanie funkcji resetowania hasa, kt贸ra loguje u偶ytkownika do aplikacji po resecie, pod ktem mo偶liwoci umo偶liwienia wielu reset贸w za pomoc tego samego linku jest kluczowe. Zalogowanie si z nowo zresetowanymi danymi mo偶e obej 2FA.

### **Kompromitacja platformy OAuth**

Kompromitacja konta u偶ytkownika na zaufanej platformie **OAuth** (np. Google, Facebook) mo偶e oferowa drog do obejcia 2FA.

### **Ataki brute force**

#### **Brak limitu szybkoci**

Brak limitu liczby pr贸b kodu umo偶liwia ataki brute force, chocia偶 nale偶y rozwa偶y potencjalne ciche ograniczenie szybkoci.

#### **Wolny brute force**

Wolny atak brute force jest wykonalny, gdy istniej ograniczenia przepywu bez og贸lnego limitu szybkoci.

#### **Reset limitu ponownego wysyania kodu**

Ponowne wysanie kodu resetuje limit szybkoci, co uatwia kontynuacj pr贸b brute force.

#### **Obchodzenie limitu szybkoci po stronie klienta**

Dokument szczeg贸owo opisuje techniki obchodzenia limitu szybkoci po stronie klienta.

#### **Brak limitu szybkoci dla dziaa wewntrznych**

Limity szybkoci mog chroni pr贸by logowania, ale nie dziaania wewntrzne konta.

#### **Koszty ponownego wysyania kod贸w SMS**

Nadmierne ponowne wysyanie kod贸w za porednictwem SMS wi偶e si z kosztami dla firmy, chocia偶 nie omija 2FA.

#### **Nieskoczona regeneracja OTP**

Nieskoczona generacja OTP z prostymi kodami umo偶liwia brute force poprzez ponowne pr贸by maego zestawu kod贸w.

### **Wykorzystanie warunk贸w wycigu**

Wykorzystanie warunk贸w wycigu do obejcia 2FA mo偶na znale藕 w konkretnym dokumencie.

### **Luki CSRF/Clickjacking**

Badanie luk CSRF lub Clickjacking w celu wyczenia 2FA jest wykonaln strategi.

### **Wykorzystanie funkcji "Zapamitaj mnie"**

#### **Przewidywalne wartoci ciasteczek**

Zgadnicie wartoci ciasteczka "zapamitaj mnie" mo偶e obej ograniczenia.

#### **Impersonacja adresu IP**

Impersonacja adresu IP ofiary za pomoc nag贸wka **X-Forwarded-For** mo偶e obej ograniczenia.

### **Wykorzystanie starszych wersji**

#### **Subdomeny**

Testowanie subdomen mo偶e wykorzystywa przestarzae wersje, kt贸re nie maj wsparcia dla 2FA lub zawieraj podatne implementacje 2FA.

#### **Punkty kocowe API**

Starsze wersje API, wskazane przez cie偶ki katalog贸w /v\*/, mog by podatne na metody obejcia 2FA.

### **Zarzdzanie poprzednimi sesjami**

Zakoczenie istniejcych sesji po aktywacji 2FA zabezpiecza konta przed nieautoryzowanym dostpem z kompromitowanych sesji.

### **Luki w kontroli dostpu z kodami zapasowymi**

Natychmiastowe generowanie i potencjalne nieautoryzowane pozyskiwanie kod贸w zapasowych po aktywacji 2FA, szczeg贸lnie przy bdach CORS/XSS, stanowi ryzyko.

### **Ujawnienie informacji na stronie 2FA**

Ujawnienie wra偶liwych informacji (np. numeru telefonu) na stronie weryfikacji 2FA jest problemem.

### **Resetowanie hasa wyczajce 2FA**

Proces demonstrujcy potencjaln metod obejcia obejmuje utworzenie konta, aktywacj 2FA, reset hasa i nastpne logowanie bez wymogu 2FA.

### **Faszywe 偶dania**

Wykorzystanie faszywych 偶da do zatarcia pr贸b brute force lub wprowadzenia w bd mechanizm贸w ograniczania szybkoci dodaje kolejny poziom do strategii obejcia. Tworzenie takich 偶da wymaga subtelnego zrozumienia rodk贸w bezpieczestwa aplikacji i zachowa ograniczania szybkoci.

### Bdy konstrukcji OTP

W przypadku, gdy OTP jest tworzony na podstawie danych, kt贸re u偶ytkownik ju偶 ma lub kt贸re s wysyane przed utworzeniem OTP, mo偶liwe jest, 偶e u偶ytkownik r贸wnie偶 go wygeneruje i obejdzie.

## References

* [https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35](https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/%22https:/medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35%22/README.md)
* [https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718](https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718)
* [https://getpocket.com/read/aM7dap2bTo21bg6fRDAV2c5thng5T48b3f0Pd1geW2u186eafibdXj7aA78Ip116\_1d0f6ce59992222b0812b7cab19a4bce](https://getpocket.com/read/aM7dap2bTo21bg6fRDAV2c5thng5T48b3f0Pd1geW2u186eafibdXj7aA78Ip116\_1d0f6ce59992222b0812b7cab19a4bce)
