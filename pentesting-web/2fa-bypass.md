# Contournement de l'authentification Ã  deux facteurs (2FA/OTP)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Contournement de l'authentification Ã  deux facteurs**

### **Contournement direct**

Pour contourner le 2FA, essayez simplement d'accÃ©der directement Ã  l'endpoint suivant (vous devez connaÃ®tre le chemin de l'endpoint suivant). Si cela ne fonctionne pas, essayez de modifier l'en-tÃªte **Referrer** comme si vous veniez de la page 2FA.

### **RÃ©utilisation du jeton**

Il est possible de rÃ©utiliser un jeton prÃ©cÃ©demment utilisÃ© Ã  l'intÃ©rieur du compte pour s'authentifier.

### Partage de jetons inutilisÃ©s

VÃ©rifiez si vous pouvez obtenir le jeton de votre compte et essayez de l'utiliser pour contourner le 2FA dans un autre compte.

### Jeton divulguÃ©

Le jeton est-il divulguÃ© dans une rÃ©ponse de l'application web ?

### Lien de vÃ©rification par e-mail

Essayez d'utiliser le **lien de vÃ©rification par e-mail reÃ§u lors de la crÃ©ation du compte** pour voir si mÃªme si le 2FA Ã©tait activÃ©, vous pouvez toujours accÃ©der Ã  votre profil uniquement avec ce lien ([post](https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b)).

### Autorisation de session

En utilisant la mÃªme session, dÃ©marrez le flux en utilisant votre compte et le compte de la victime. Lorsque vous atteignez le point 2FA sur les deux comptes, terminez le 2FA avec votre compte mais n'accÃ©dez pas Ã  la partie suivante. Au lieu de cela, essayez d'accÃ©der Ã  l'Ã©tape suivante avec le flux du compte de la victime. Si le back-end ne dÃ©finit qu'un boolÃ©en dans vos sessions indiquant que vous avez rÃ©ussi Ã  passer le 2FA, vous pourrez contourner le 2FA de la victime.

### **Fonction de rÃ©initialisation du mot de passe**

Dans presque toutes les applications web, la **fonction de rÃ©initialisation du mot de passe connecte automatiquement l'utilisateur Ã  l'application** une fois la procÃ©dure de rÃ©initialisation terminÃ©e.\
VÃ©rifiez si un **e-mail** est envoyÃ© avec un **lien** pour **rÃ©initialiser le mot de passe** et si vous pouvez **rÃ©utiliser** ce **lien** pour rÃ©initialiser le mot de passe autant de fois que vous le souhaitez (mÃªme si la victime change son adresse e-mail).

Une autre option pour contourner le 2FA avec la fonctionnalitÃ© de rÃ©initialisation du mot de passe est de **rÃ©initialiser le mot de passe avec accÃ¨s Ã  l'e-mail** et d'utiliser le **nouveau mot de passe pour vous connecter**, il est possible qu'aprÃ¨s un changement de mot de passe, le 2FA ne soit pas utilisÃ©.

### OAuth

Si vous pouvez compromettre le compte de l'utilisateur sur une plateforme **OAuth** de confiance (Google, Facebook...)

### Brute force

#### Absence de limite de taux

Y a-t-il une limite sur le nombre de codes que vous pouvez essayer, afin que vous puissiez simplement effectuer une attaque par force brute ? Faites attention Ã  une Ã©ventuelle limite de taux "silencieuse", essayez toujours plusieurs codes, puis le vrai pour confirmer la vulnÃ©rabilitÃ©.

#### Limite de dÃ©bit du flux mais pas de limite de taux

Dans ce cas, il y a une limite de dÃ©bit du flux (vous devez effectuer une attaque par force brute trÃ¨s lentement : 1 thread et une pause avant 2 tentatives), mais pas de limite de taux. Donc, avec suffisamment de temps, vous pouvez trouver le code valide.

#### Renvoi du code et rÃ©initialisation de la limite

Il y a une limite de taux, mais lorsque vous "renvoyez le code", le mÃªme code est renvoyÃ© et la limite de taux est rÃ©initialisÃ©e. Ensuite, vous pouvez effectuer une attaque par force brute du code tout en le renvoyant, de sorte que la limite de taux n'est jamais atteinte.

#### Contournement de la limite de taux cÃ´tÃ© client

{% content-ref url="rate-limit-bypass.md" %}
[rate-limit-bypass.md](rate-limit-bypass.md)
{% endcontent-ref %}

#### Absence de limite de taux dans le compte de l'utilisateur

Parfois, vous pouvez configurer le 2FA pour certaines actions Ã  l'intÃ©rieur de votre compte (changement d'e-mail, de mot de passe...). Cependant, mÃªme dans les cas oÃ¹ il y a une limite de taux lorsque vous essayez de vous connecter, il n'y a aucune limite de taux pour protÃ©ger les actions Ã  l'intÃ©rieur du compte.

#### Absence de limite de taux lors de la rÃ©ception du code via SMS

Vous ne pourrez pas contourner le 2FA, mais vous pourrez gaspiller l'argent de l'entreprise.

#### RÃ©gÃ©nÃ©ration infinie de l'OTP

Si vous pouvez **gÃ©nÃ©rer un nouvel OTP un nombre infini de fois**, que l'OTP est **suffisamment simple** (4 chiffres) et que vous pouvez essayer jusqu'Ã  4 ou 5 jetons par OTP gÃ©nÃ©rÃ©, vous pouvez simplement essayer les mÃªmes 4 ou 5 jetons Ã  chaque fois et gÃ©nÃ©rer des OTP jusqu'Ã  ce qu'ils correspondent Ã  ceux que vous utilisez.

### Condition de concurrence

Consultez la section sur le contournement du 2FA par condition de concurrence de la page suivante :

{% content-ref url="race-condition.md" %}
[race-condition.md](race-condition.md)
{% endcontent-ref %}
### CSRF/Clickjacking

VÃ©rifiez s'il existe une vulnÃ©rabilitÃ© de Cross Site Request Forgery (CSRF) ou de Clickjacking pour dÃ©sactiver la 2FA.

### FonctionnalitÃ© "Se souvenir de moi"

#### Cookie devinable

Si la fonctionnalitÃ© "Se souvenir de moi" utilise un nouveau cookie avec un code devinable, essayez de le deviner.

#### Adresse IP

Si la fonctionnalitÃ© "Se souvenir de moi" est liÃ©e Ã  votre adresse IP, vous pouvez essayer de dÃ©terminer l'adresse IP de la victime et vous faire passer pour elle en utilisant l'en-tÃªte **X-Forwarded-For**.

### Anciennes versions

#### Sous-domaines

Si vous trouvez des sous-domaines de "test" avec la fonctionnalitÃ© de connexion, ils pourraient utiliser d'anciennes versions qui ne prennent pas en charge la 2FA (donc elle est contournÃ©e directement) ou ces points d'extrÃ©mitÃ© pourraient prendre en charge une version vulnÃ©rable de la 2FA.

#### APIs

Si vous constatez que la 2FA utilise une API situÃ©e sous un rÃ©pertoire /v\* (comme "/v3/"), cela signifie probablement qu'il existe d'anciens points d'extrÃ©mitÃ© d'API qui pourraient Ãªtre vulnÃ©rables Ã  une certaine forme de contournement de la 2FA.

### Sessions prÃ©cÃ©dentes

Lorsque la 2FA est activÃ©e, les sessions prÃ©cÃ©dentes crÃ©Ã©es doivent Ãªtre terminÃ©es. Cela est nÃ©cessaire car lorsqu'un client voit son compte compromis, il peut vouloir le protÃ©ger en activant la 2FA, mais si les sessions prÃ©cÃ©dentes ne sont pas terminÃ©es, cela ne le protÃ©gera pas.

### ContrÃ´le d'accÃ¨s inappropriÃ© aux codes de sauvegarde

Les codes de sauvegarde sont gÃ©nÃ©rÃ©s immÃ©diatement aprÃ¨s l'activation de la 2FA et sont disponibles sur une seule requÃªte. AprÃ¨s chaque appel ultÃ©rieur Ã  la requÃªte, les codes peuvent Ãªtre rÃ©gÃ©nÃ©rÃ©s ou rester inchangÃ©s (codes statiques). S'il existe des erreurs de configuration CORS/XSS et d'autres bugs qui permettent de "tirer" les codes de sauvegarde de la rÃ©ponse de la requÃªte de l'endpoint du code de sauvegarde, alors l'attaquant pourrait voler les codes et contourner la 2FA si le nom d'utilisateur et le mot de passe sont connus.

### Divulgation d'informations

Si vous remarquez des informations confidentielles apparaissant sur la page de la 2FA que vous ne connaissiez pas auparavant (comme le numÃ©ro de tÃ©lÃ©phone), cela peut Ãªtre considÃ©rÃ© comme une vulnÃ©rabilitÃ© de divulgation d'informations.

### **RÃ©initialisation du mot de passe == dÃ©sactivation de la 2FA**

1. CrÃ©ez un compte et activez la 2FA.
2. DÃ©connectez-vous de ce compte.
3. Maintenant, allez sur la page de rÃ©initialisation du mot de passe.
4. Changez votre mot de passe.
5. Essayez maintenant de vous connecter.
6. Si on ne vous demande pas d'entrer un code 2FA, vous pouvez le signaler.

## RÃ©fÃ©rences

{% embed url="https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35" %}

{% embed url="https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Vous travaillez dans une **entreprise de cybersÃ©curitÃ©** ? Vous souhaitez voir votre **entreprise annoncÃ©e dans HackTricks** ? ou vous souhaitez avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
