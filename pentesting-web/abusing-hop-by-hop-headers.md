# hop-by-hop headers

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

**Dies ist eine Zusammenfassung des Beitrags [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)**

Hop-by-hop-Header sind spezifisch f√ºr eine einzelne Transportverbindung und werden haupts√§chlich in HTTP/1.1 verwendet, um Daten zwischen zwei Knoten (wie Client-Proxy oder Proxy-Proxy) zu verwalten, und sind nicht daf√ºr gedacht, weitergeleitet zu werden. Standard-Hop-by-Hop-Header umfassen `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` und `Proxy-Authenticate`, wie in [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1) definiert. Zus√§tzliche Header k√∂nnen √ºber den `Connection`-Header als hop-by-hop bezeichnet werden.

### Missbrauch von Hop-by-Hop-Headern
Eine unsachgem√§√üe Verwaltung von Hop-by-Hop-Headern durch Proxys kann zu Sicherheitsproblemen f√ºhren. W√§hrend von Proxys erwartet wird, dass sie diese Header entfernen, tun dies nicht alle, was potenzielle Schwachstellen schafft.

### Testen der Handhabung von Hop-by-Hop-Headern
Die Handhabung von Hop-by-Hop-Headern kann getestet werden, indem √Ñnderungen in den Serverantworten beobachtet werden, wenn bestimmte Header als hop-by-hop markiert sind. Tools und Skripte k√∂nnen diesen Prozess automatisieren, um zu identifizieren, wie Proxys diese Header verwalten und potenziell Fehlkonfigurationen oder Proxy-Verhalten aufzudecken.

Der Missbrauch von Hop-by-Hop-Headern kann zu verschiedenen Sicherheitsimplikationen f√ºhren. Im Folgenden sind einige Beispiele aufgef√ºhrt, die zeigen, wie diese Header f√ºr potenzielle Angriffe manipuliert werden k√∂nnen:

### Umgehung von Sicherheitskontrollen mit `X-Forwarded-For`
Ein Angreifer kann den `X-Forwarded-For`-Header manipulieren, um IP-basierte Zugriffskontrollen zu umgehen. Dieser Header wird h√§ufig von Proxys verwendet, um die urspr√ºngliche IP-Adresse eines Clients zu verfolgen. Wenn ein Proxy jedoch diesen Header als hop-by-hop behandelt und ohne ordnungsgem√§√üe Validierung weiterleitet, kann ein Angreifer seine IP-Adresse f√§lschen.

**Angriffsszenario:**
1. Der Angreifer sendet eine HTTP-Anfrage an eine Webanwendung hinter einem Proxy und f√ºgt eine gef√§lschte IP-Adresse im `X-Forwarded-For`-Header ein.
2. Der Angreifer f√ºgt auch den Header `Connection: close, X-Forwarded-For` hinzu, was den Proxy dazu bringt, `X-Forwarded-For` als hop-by-hop zu behandeln.
3. Der falsch konfigurierte Proxy leitet die Anfrage an die Webanwendung weiter, ohne den gef√§lschten `X-Forwarded-For`-Header.
4. Die Webanwendung, die den urspr√ºnglichen `X-Forwarded-For`-Header nicht sieht, k√∂nnte die Anfrage als direkt von einem vertrauensw√ºrdigen Proxy kommend betrachten, was potenziell unbefugten Zugriff erm√∂glicht.

### Cache-Poisoning durch Hop-by-Hop-Header-Injektion
Wenn ein Cache-Server Inhalte basierend auf Hop-by-Hop-Headern falsch zwischenspeichert, k√∂nnte ein Angreifer b√∂sartige Header injizieren, um den Cache zu vergiften. Dies w√ºrde falsche oder b√∂sartige Inhalte an Benutzer liefern, die dieselbe Ressource anfordern.

**Angriffsszenario:**
1. Ein Angreifer sendet eine Anfrage an eine Webanwendung mit einem Hop-by-Hop-Header, der nicht zwischengespeichert werden sollte (z. B. `Connection: close, Cookie`).
2. Der schlecht konfigurierte Cache-Server entfernt den Hop-by-Hop-Header nicht und speichert die Antwort, die spezifisch f√ºr die Sitzung des Angreifers ist.
3. Zuk√ºnftige Benutzer, die dieselbe Ressource anfordern, erhalten die zwischengespeicherte Antwort, die f√ºr den Angreifer ma√ügeschneidert war, was potenziell zu Sitzungs√ºbernahme oder Offenlegung sensibler Informationen f√ºhren kann.

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
