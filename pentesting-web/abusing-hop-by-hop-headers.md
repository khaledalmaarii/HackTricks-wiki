# hop-by-hop headers

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

**Este √© um resumo do post [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)**

Os cabe√ßalhos hop-by-hop s√£o espec√≠ficos para uma √∫nica conex√£o de n√≠vel de transporte, usados principalmente em HTTP/1.1 para gerenciar dados entre dois n√≥s (como cliente-proxy ou proxy-proxy), e n√£o devem ser encaminhados. Os cabe√ßalhos hop-by-hop padr√£o incluem `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` e `Proxy-Authenticate`, conforme definido na [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1). Cabe√ßalhos adicionais podem ser designados como hop-by-hop atrav√©s do cabe√ßalho `Connection`.

### Abusando dos Cabe√ßalhos Hop-by-Hop
O gerenciamento inadequado dos cabe√ßalhos hop-by-hop por proxies pode levar a problemas de seguran√ßa. Embora se espere que os proxies removam esses cabe√ßalhos, nem todos o fazem, criando vulnerabilidades potenciais.

### Testando o Tratamento de Cabe√ßalhos Hop-by-Hop
O tratamento de cabe√ßalhos hop-by-hop pode ser testado observando mudan√ßas nas respostas do servidor quando cabe√ßalhos espec√≠ficos s√£o marcados como hop-by-hop. Ferramentas e scripts podem automatizar esse processo, identificando como os proxies gerenciam esses cabe√ßalhos e potencialmente descobrindo configura√ß√µes incorretas ou comportamentos de proxy.

Abusar dos cabe√ßalhos hop-by-hop pode levar a v√°rias implica√ß√µes de seguran√ßa. Abaixo est√£o alguns exemplos demonstrando como esses cabe√ßalhos podem ser manipulados para potenciais ataques:

### Contornando Controles de Seguran√ßa com `X-Forwarded-For`
Um atacante pode manipular o cabe√ßalho `X-Forwarded-For` para contornar controles de acesso baseados em IP. Este cabe√ßalho √© frequentemente usado por proxies para rastrear o endere√ßo IP de origem de um cliente. No entanto, se um proxy tratar esse cabe√ßalho como hop-by-hop e o encaminhar sem valida√ß√£o adequada, um atacante pode falsificar seu endere√ßo IP.

**Cen√°rio de Ataque:**
1. O atacante envia uma solicita√ß√£o HTTP para uma aplica√ß√£o web atr√°s de um proxy, incluindo um endere√ßo IP falso no cabe√ßalho `X-Forwarded-For`.
2. O atacante tamb√©m inclui o cabe√ßalho `Connection: close, X-Forwarded-For`, solicitando que o proxy trate `X-Forwarded-For` como hop-by-hop.
3. O proxy mal configurado encaminha a solicita√ß√£o para a aplica√ß√£o web sem o cabe√ßalho `X-Forwarded-For` falsificado.
4. A aplica√ß√£o web, n√£o vendo o cabe√ßalho original `X-Forwarded-For`, pode considerar a solicita√ß√£o como vindo diretamente de um proxy confi√°vel, potencialmente permitindo acesso n√£o autorizado.

### Envenenamento de Cache via Inje√ß√£o de Cabe√ßalho Hop-by-Hop
Se um servidor de cache armazenar incorretamente conte√∫do com base em cabe√ßalhos hop-by-hop, um atacante poderia injetar cabe√ßalhos maliciosos para envenenar o cache. Isso serviria conte√∫do incorreto ou malicioso para usu√°rios que solicitam o mesmo recurso.

**Cen√°rio de Ataque:**
1. Um atacante envia uma solicita√ß√£o para uma aplica√ß√£o web com um cabe√ßalho hop-by-hop que n√£o deve ser armazenado em cache (por exemplo, `Connection: close, Cookie`).
2. O servidor de cache mal configurado n√£o remove o cabe√ßalho hop-by-hop e armazena a resposta espec√≠fica para a sess√£o do atacante.
3. Usu√°rios futuros que solicitam o mesmo recurso recebem a resposta em cache, que foi adaptada para o atacante, potencialmente levando ao sequestro de sess√£o ou exposi√ß√£o de informa√ß√µes sens√≠veis.

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
