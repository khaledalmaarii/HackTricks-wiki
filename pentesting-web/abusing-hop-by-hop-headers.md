# hop-by-hop headers

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**Ceci est un rÃ©sumÃ© du post [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)**

Les en-tÃªtes hop-by-hop sont spÃ©cifiques Ã  une seule connexion de niveau transport, utilisÃ©s principalement dans HTTP/1.1 pour gÃ©rer les donnÃ©es entre deux nÅ“uds (comme client-proxy ou proxy-proxy), et ne sont pas destinÃ©s Ã  Ãªtre transfÃ©rÃ©s. Les en-tÃªtes hop-by-hop standard incluent `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization`, et `Proxy-Authenticate`, comme dÃ©fini dans [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1). Des en-tÃªtes supplÃ©mentaires peuvent Ãªtre dÃ©signÃ©s comme hop-by-hop via l'en-tÃªte `Connection`.

### Abusing Hop-by-Hop Headers
Une gestion incorrecte des en-tÃªtes hop-by-hop par les proxies peut entraÃ®ner des problÃ¨mes de sÃ©curitÃ©. Bien que les proxies soient censÃ©s supprimer ces en-tÃªtes, tous ne le font pas, crÃ©ant ainsi des vulnÃ©rabilitÃ©s potentielles.

### Testing for Hop-by-Hop Header Handling
La gestion des en-tÃªtes hop-by-hop peut Ãªtre testÃ©e en observant les changements dans les rÃ©ponses du serveur lorsque des en-tÃªtes spÃ©cifiques sont marquÃ©s comme hop-by-hop. Des outils et des scripts peuvent automatiser ce processus, identifiant comment les proxies gÃ¨rent ces en-tÃªtes et dÃ©couvrant potentiellement des erreurs de configuration ou des comportements de proxy.

L'abus des en-tÃªtes hop-by-hop peut entraÃ®ner diverses implications de sÃ©curitÃ©. Voici quelques exemples dÃ©montrant comment ces en-tÃªtes peuvent Ãªtre manipulÃ©s pour des attaques potentielles :

### Bypassing Security Controls with `X-Forwarded-For`
Un attaquant peut manipuler l'en-tÃªte `X-Forwarded-For` pour contourner les contrÃ´les d'accÃ¨s basÃ©s sur l'IP. Cet en-tÃªte est souvent utilisÃ© par les proxies pour suivre l'adresse IP d'origine d'un client. Cependant, si un proxy traite cet en-tÃªte comme hop-by-hop et le transfÃ¨re sans validation appropriÃ©e, un attaquant peut usurper son adresse IP.

**ScÃ©nario d'attaque :**
1. L'attaquant envoie une requÃªte HTTP Ã  une application web derriÃ¨re un proxy, incluant une fausse adresse IP dans l'en-tÃªte `X-Forwarded-For`.
2. L'attaquant inclut Ã©galement l'en-tÃªte `Connection: close, X-Forwarded-For`, incitant le proxy Ã  traiter `X-Forwarded-For` comme hop-by-hop.
3. Le proxy mal configurÃ© transfÃ¨re la requÃªte Ã  l'application web sans l'en-tÃªte `X-Forwarded-For` usurpÃ©.
4. L'application web, ne voyant pas l'en-tÃªte `X-Forwarded-For` d'origine, pourrait considÃ©rer la requÃªte comme venant directement d'un proxy de confiance, permettant potentiellement un accÃ¨s non autorisÃ©.

### Cache Poisoning via Hop-by-Hop Header Injection
Si un serveur de cache met incorrectement en cache du contenu basÃ© sur des en-tÃªtes hop-by-hop, un attaquant pourrait injecter des en-tÃªtes malveillants pour empoisonner le cache. Cela servirait un contenu incorrect ou malveillant aux utilisateurs demandant la mÃªme ressource.

**ScÃ©nario d'attaque :**
1. Un attaquant envoie une requÃªte Ã  une application web avec un en-tÃªte hop-by-hop qui ne devrait pas Ãªtre mis en cache (par exemple, `Connection: close, Cookie`).
2. Le serveur de cache mal configurÃ© ne supprime pas l'en-tÃªte hop-by-hop et met en cache la rÃ©ponse spÃ©cifique Ã  la session de l'attaquant.
3. Les futurs utilisateurs demandant la mÃªme ressource reÃ§oivent la rÃ©ponse mise en cache, qui Ã©tait adaptÃ©e pour l'attaquant, ce qui pourrait entraÃ®ner un dÃ©tournement de session ou une exposition d'informations sensibles.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
