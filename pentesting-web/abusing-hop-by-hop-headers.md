# hop-by-hop headers

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

**è¿™æ˜¯å¯¹å¸–å­ [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers) çš„æ€»ç»“**

Hop-by-hop headers æ˜¯ç‰¹å®šäºå•ä¸ªä¼ è¾“çº§è¿æ¥çš„ï¼Œä¸»è¦ç”¨äº HTTP/1.1 ä¸­ç®¡ç†ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆå¦‚å®¢æˆ·ç«¯-ä»£ç†æˆ–ä»£ç†-ä»£ç†ï¼‰ä¹‹é—´çš„æ•°æ®ï¼Œå¹¶ä¸æ‰“ç®—è¢«è½¬å‘ã€‚æ ‡å‡†çš„ hop-by-hop headers åŒ…æ‹¬ `Keep-Alive`ã€`Transfer-Encoding`ã€`TE`ã€`Connection`ã€`Trailer`ã€`Upgrade`ã€`Proxy-Authorization` å’Œ `Proxy-Authenticate`ï¼Œå¦‚ [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1) ä¸­æ‰€å®šä¹‰ã€‚å¯ä»¥é€šè¿‡ `Connection` å¤´å°†å…¶ä»–å¤´æŒ‡å®šä¸º hop-by-hopã€‚

### æ»¥ç”¨ Hop-by-Hop Headers
ä»£ç†å¯¹ hop-by-hop headers çš„ä¸å½“ç®¡ç†å¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜ã€‚è™½ç„¶ä»£ç†åº”è¯¥åˆ é™¤è¿™äº›å¤´ï¼Œä½†å¹¶éæ‰€æœ‰ä»£ç†éƒ½è¿™æ ·åšï¼Œä»è€Œäº§ç”Ÿæ½œåœ¨çš„æ¼æ´ã€‚

### æµ‹è¯• Hop-by-Hop Header å¤„ç†
å¯ä»¥é€šè¿‡è§‚å¯Ÿåœ¨ç‰¹å®šå¤´è¢«æ ‡è®°ä¸º hop-by-hop æ—¶æœåŠ¡å™¨å“åº”çš„å˜åŒ–æ¥æµ‹è¯• hop-by-hop headers çš„å¤„ç†ã€‚å·¥å…·å’Œè„šæœ¬å¯ä»¥è‡ªåŠ¨åŒ–æ­¤è¿‡ç¨‹ï¼Œè¯†åˆ«ä»£ç†å¦‚ä½•ç®¡ç†è¿™äº›å¤´ï¼Œå¹¶å¯èƒ½å‘ç°é…ç½®é”™è¯¯æˆ–ä»£ç†è¡Œä¸ºã€‚

æ»¥ç”¨ hop-by-hop headers å¯èƒ½å¯¼è‡´å„ç§å®‰å…¨éšæ‚£ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•æ“çºµè¿™äº›å¤´ä»¥è¿›è¡Œæ½œåœ¨æ”»å‡»ï¼š

### é€šè¿‡ `X-Forwarded-For` ç»•è¿‡å®‰å…¨æ§åˆ¶
æ”»å‡»è€…å¯ä»¥æ“çºµ `X-Forwarded-For` å¤´ä»¥ç»•è¿‡åŸºäº IP çš„è®¿é—®æ§åˆ¶ã€‚æ­¤å¤´é€šå¸¸ç”±ä»£ç†ç”¨äºè·Ÿè¸ªå®¢æˆ·ç«¯çš„åŸå§‹ IP åœ°å€ã€‚ç„¶è€Œï¼Œå¦‚æœä»£ç†å°†æ­¤å¤´è§†ä¸º hop-by-hop å¹¶åœ¨æ²¡æœ‰é€‚å½“éªŒè¯çš„æƒ…å†µä¸‹è½¬å‘å®ƒï¼Œæ”»å‡»è€…å°±å¯ä»¥ä¼ªé€ ä»–ä»¬çš„ IP åœ°å€ã€‚

**æ”»å‡»åœºæ™¯ï¼š**
1. æ”»å‡»è€…å‘ä½äºä»£ç†åé¢çš„ Web åº”ç”¨ç¨‹åºå‘é€ HTTP è¯·æ±‚ï¼Œåœ¨ `X-Forwarded-For` å¤´ä¸­åŒ…å«ä¸€ä¸ªè™šå‡çš„ IP åœ°å€ã€‚
2. æ”»å‡»è€…è¿˜åŒ…æ‹¬ `Connection: close, X-Forwarded-For` å¤´ï¼Œä¿ƒä½¿ä»£ç†å°† `X-Forwarded-For` è§†ä¸º hop-by-hopã€‚
3. é…ç½®é”™è¯¯çš„ä»£ç†å°†è¯·æ±‚è½¬å‘åˆ° Web åº”ç”¨ç¨‹åºï¼Œè€Œæ²¡æœ‰ä¼ªé€ çš„ `X-Forwarded-For` å¤´ã€‚
4. Web åº”ç”¨ç¨‹åºæ²¡æœ‰çœ‹åˆ°åŸå§‹çš„ `X-Forwarded-For` å¤´ï¼Œå¯èƒ½ä¼šå°†è¯·æ±‚è§†ä¸ºç›´æ¥æ¥è‡ªå—ä¿¡ä»»çš„ä»£ç†ï¼Œä»è€Œå¯èƒ½å…è®¸æœªæˆæƒè®¿é—®ã€‚

### é€šè¿‡ Hop-by-Hop Header æ³¨å…¥è¿›è¡Œç¼“å­˜ä¸­æ¯’
å¦‚æœç¼“å­˜æœåŠ¡å™¨é”™è¯¯åœ°æ ¹æ® hop-by-hop headers ç¼“å­˜å†…å®¹ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„å¤´ä»¥æ¯’åŒ–ç¼“å­˜ã€‚è¿™å°†å‘è¯·æ±‚ç›¸åŒèµ„æºçš„ç”¨æˆ·æä¾›ä¸æ­£ç¡®æˆ–æ¶æ„çš„å†…å®¹ã€‚

**æ”»å‡»åœºæ™¯ï¼š**
1. æ”»å‡»è€…å‘ Web åº”ç”¨ç¨‹åºå‘é€è¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ªä¸åº”è¢«ç¼“å­˜çš„ hop-by-hop å¤´ï¼ˆä¾‹å¦‚ï¼Œ`Connection: close, Cookie`ï¼‰ã€‚
2. é…ç½®ä¸å½“çš„ç¼“å­˜æœåŠ¡å™¨æœªåˆ é™¤ hop-by-hop å¤´ï¼Œå¹¶ç¼“å­˜äº†ç‰¹å®šäºæ”»å‡»è€…ä¼šè¯çš„å“åº”ã€‚
3. æœªæ¥è¯·æ±‚ç›¸åŒèµ„æºçš„ç”¨æˆ·æ¥æ”¶åˆ°ç¼“å­˜çš„å“åº”ï¼Œè¯¥å“åº”æ˜¯ä¸ºæ”»å‡»è€…é‡èº«å®šåˆ¶çš„ï¼Œå¯èƒ½å¯¼è‡´ä¼šè¯åŠ«æŒæˆ–æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
