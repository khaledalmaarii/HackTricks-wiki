# Nag贸wki hop-by-hop

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujcej si cyberbezpieczestwem**? Chcesz zobaczy swoj **firm reklamowan w HackTricks**? A mo偶e chcesz mie dostp do **najnowszej wersji PEASS lub pobra HackTricks w formacie PDF**? Sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Docz do** [****](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze** [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

**To jest streszczenie postu [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)**

Nag贸wki hop-by-hop s specyficzne dla pojedynczego poczenia na poziomie transportu, u偶ywane g贸wnie w protokole HTTP/1.1 do zarzdzania danymi midzy dwoma wzami (np. klient-proxy lub proxy-proxy) i nie s przeznaczone do przekazywania. Standardowe nag贸wki hop-by-hop obejmuj `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` i `Proxy-Authenticate`, zdefiniowane w [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1). Dodatkowe nag贸wki mog by oznaczone jako hop-by-hop za pomoc nag贸wka `Connection`.

### Nadu偶ywanie nag贸wk贸w hop-by-hop
Niewaciwe zarzdzanie nag贸wkami hop-by-hop przez serwery proxy mo偶e prowadzi do problem贸w zwizanych z bezpieczestwem. Chocia偶 oczekuje si, 偶e serwery proxy usun te nag贸wki, nie wszystkie to robi, co tworzy potencjalne podatnoci.

### Testowanie obsugi nag贸wk贸w hop-by-hop
Obsug nag贸wk贸w hop-by-hop mo偶na przetestowa, obserwujc zmiany w odpowiedziach serwera, gdy okrelone nag贸wki s oznaczone jako hop-by-hop. Narzdzia i skrypty mog zautomatyzowa ten proces, identyfikujc, jak serwery proxy zarzdzaj tymi nag贸wkami i potencjalnie odkrywajc bdy konfiguracji lub zachowania serwer贸w proxy.

Nadu偶ywanie nag贸wk贸w hop-by-hop mo偶e prowadzi do r贸偶nych implikacji zwizanych z bezpieczestwem. Poni偶ej przedstawiamy kilka przykad贸w, pokazujcych, jak te nag贸wki mog by manipulowane w celu potencjalnych atak贸w:

### Ominiecie kontroli bezpieczestwa za pomoc `X-Forwarded-For`
Atakujcy mo偶e manipulowa nag贸wkiem `X-Forwarded-For`, aby omin kontrole dostpu oparte na adresach IP. Ten nag贸wek jest czsto u偶ywany przez serwery proxy do ledzenia adresu IP pochodzenia klienta. Jednak jeli serwer proxy traktuje ten nag贸wek jako hop-by-hop i przekazuje go bez odpowiedniej walidacji, atakujcy mo偶e podszy si pod sw贸j adres IP.

**Scenariusz ataku:**
1. Atakujcy wysya 偶danie HTTP do aplikacji internetowej za porednictwem serwera proxy, doczajc faszywy adres IP w nag贸wku `X-Forwarded-For`.
2. Atakujcy docza r贸wnie偶 nag贸wek `Connection: close, X-Forwarded-For`, co skania serwer proxy do traktowania `X-Forwarded-For` jako hop-by-hop.
3. 殴le skonfigurowany serwer proxy przekazuje 偶danie do aplikacji internetowej bez sfaszowanego nag贸wka `X-Forwarded-For`.
4. Aplikacja internetowa, nie widzc oryginalnego nag贸wka `X-Forwarded-For`, mo偶e uzna 偶danie za pochodzce bezporednio od zaufanego serwera proxy, co potencjalnie umo偶liwia nieautoryzowany dostp.

### Zatrucie pamici podrcznej poprzez wstrzyknicie nag贸wka hop-by-hop
Jeli serwer pamici podrcznej nieprawidowo buforuje zawarto na podstawie nag贸wk贸w hop-by-hop, atakujcy mo偶e wstrzykn zoliwe nag贸wki w celu zatrucia pamici podrcznej. Spowoduje to dostarczanie nieprawidowej lub zoliwej zawartoci u偶ytkownikom 偶dajcym tego samego zasobu.

**Scenariusz ataku:**
1. Atakujcy wysya 偶danie do aplikacji internetowej z nag贸wkiem hop-by-hop, kt贸ry nie powinien by buforowany (np. `Connection: close, Cookie`).
2. 殴le skonfigurowany serwer pamici podrcznej nie usuwa nag贸wka hop-by-hop i buforuje odpowied藕 specyficzn dla sesji atakujcego.
3. Przyszli u偶ytkownicy 偶dajcy tego samego zasobu otrzymuj buforowan odpowied藕, kt贸ra zostaa dostosowana do atakujcego, co potencjalnie prowadzi do przejcia sesji lub ujawnienia poufnych informacji.

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujcej si cyberbezpieczestwem**? Chcesz zobaczy swoj **firm reklamowan w HackTricks**? A mo偶e chcesz mie dostp do **najnowszej wersji PEASS lub pobra HackTricks w formacie PDF**? Sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Docz do** [****](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze** [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
