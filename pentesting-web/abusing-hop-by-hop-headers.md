# En-tÃªtes hop-by-hop

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©**? Vous voulez voir votre **entreprise annoncÃ©e dans HackTricks**? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version du PEASS ou tÃ©lÃ©charger HackTricks en PDF**? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* DÃ©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [dÃ©pÃ´t hacktricks](https://github.com/carlospolop/hacktricks) et au [dÃ©pÃ´t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

**Il s'agit d'un rÃ©sumÃ© de l'article [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)**

Les en-tÃªtes hop-by-hop sont spÃ©cifiques Ã  une seule connexion de niveau transport, utilisÃ©es principalement dans HTTP/1.1 pour gÃ©rer les donnÃ©es entre deux nÅ“uds (comme client-proxy ou proxy-proxy), et ne sont pas destinÃ©es Ã  Ãªtre transmises. Les en-tÃªtes hop-by-hop standard incluent `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` et `Proxy-Authenticate`, tels que dÃ©finis dans [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1). Des en-tÃªtes supplÃ©mentaires peuvent Ãªtre dÃ©signÃ©s comme hop-by-hop via l'en-tÃªte `Connection`.

### Abus des en-tÃªtes hop-by-hop
Une gestion incorrecte des en-tÃªtes hop-by-hop par les proxies peut entraÃ®ner des problÃ¨mes de sÃ©curitÃ©. Alors que l'on s'attend Ã  ce que les proxies suppriment ces en-tÃªtes, ce n'est pas toujours le cas, crÃ©ant des vulnÃ©rabilitÃ©s potentielles.

### Test de la gestion des en-tÃªtes hop-by-hop
La gestion des en-tÃªtes hop-by-hop peut Ãªtre testÃ©e en observant les changements dans les rÃ©ponses du serveur lorsque des en-tÃªtes spÃ©cifiques sont marquÃ©s comme hop-by-hop. Des outils et des scripts peuvent automatiser ce processus, identifiant comment les proxies gÃ¨rent ces en-tÃªtes et dÃ©couvrant Ã©ventuellement des mauvaises configurations ou des comportements de proxy.

L'abus des en-tÃªtes hop-by-hop peut entraÃ®ner diverses implications en matiÃ¨re de sÃ©curitÃ©. Voici quelques exemples dÃ©montrant comment ces en-tÃªtes peuvent Ãªtre manipulÃ©s pour des attaques potentielles:

### Contournement des contrÃ´les de sÃ©curitÃ© avec `X-Forwarded-For`
Un attaquant peut manipuler l'en-tÃªte `X-Forwarded-For` pour contourner les contrÃ´les d'accÃ¨s basÃ©s sur l'IP. Cet en-tÃªte est souvent utilisÃ© par les proxies pour suivre l'adresse IP d'origine d'un client. Cependant, si un proxy traite cet en-tÃªte comme hop-by-hop et le transmet sans validation appropriÃ©e, un attaquant peut usurper son adresse IP.

**ScÃ©nario d'attaque:**
1. L'attaquant envoie une requÃªte HTTP Ã  une application web derriÃ¨re un proxy, incluant une fausse adresse IP dans l'en-tÃªte `X-Forwarded-For`.
2. L'attaquant inclut Ã©galement l'en-tÃªte `Connection: close, X-Forwarded-For`, incitant le proxy Ã  traiter `X-Forwarded-For` comme hop-by-hop.
3. Le proxy mal configurÃ© transmet la requÃªte Ã  l'application web sans l'en-tÃªte `X-Forwarded-For` falsifiÃ©.
4. L'application web, ne voyant pas l'en-tÃªte `X-Forwarded-For` d'origine, pourrait considÃ©rer la requÃªte comme provenant directement d'un proxy de confiance, permettant potentiellement un accÃ¨s non autorisÃ©.

### Empoisonnement de cache via l'injection d'en-tÃªtes hop-by-hop
Si un serveur de cache met en cache incorrectement du contenu basÃ© sur des en-tÃªtes hop-by-hop, un attaquant pourrait injecter des en-tÃªtes malveillants pour empoisonner le cache. Cela servirait un contenu incorrect ou malveillant aux utilisateurs demandant la mÃªme ressource.

**ScÃ©nario d'attaque:**
1. Un attaquant envoie une requÃªte Ã  une application web avec un en-tÃªte hop-by-hop qui ne doit pas Ãªtre mis en cache (par exemple, `Connection: close, Cookie`).
2. Le serveur de cache mal configurÃ© ne supprime pas l'en-tÃªte hop-by-hop et met en cache la rÃ©ponse spÃ©cifique Ã  la session de l'attaquant.
3. Les futurs utilisateurs demandant la mÃªme ressource reÃ§oivent la rÃ©ponse mise en cache, qui a Ã©tÃ© adaptÃ©e Ã  l'attaquant, pouvant potentiellement entraÃ®ner un dÃ©tournement de session ou une exposition d'informations sensibles.
