# hop-by-hop headers

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**Ovo je saÅ¾etak posta [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)**

Hop-by-hop zaglavlja su specifiÄna za jednu transportnu vezu, koriste se prvenstveno u HTTP/1.1 za upravljanje podacima izmeÄ‘u dva Ävora (kao Å¡to su klijent-proxy ili proxy-proxy) i nisu namenjena za prosleÄ‘ivanje. Standardna hop-by-hop zaglavlja ukljuÄuju `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` i `Proxy-Authenticate`, kako je definisano u [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1). Dodatna zaglavlja mogu biti oznaÄena kao hop-by-hop putem `Connection` zaglavlja.

### Abusing Hop-by-Hop Headers
Nepravilno upravljanje hop-by-hop zaglavljima od strane proksija moÅ¾e dovesti do bezbednosnih problema. Dok se od proksija oÄekuje da uklone ova zaglavlja, ne rade svi to, Å¡to stvara potencijalne ranjivosti.

### Testing for Hop-by-Hop Header Handling
Upravljanje hop-by-hop zaglavljima moÅ¾e se testirati posmatranjem promena u odgovorima servera kada su odreÄ‘ena zaglavlja oznaÄena kao hop-by-hop. Alati i skripte mogu automatizovati ovaj proces, identifikujuÄ‡i kako proksiji upravljaju ovim zaglavljima i potencijalno otkrivajuÄ‡i pogreÅ¡ne konfiguracije ili ponaÅ¡anja proksija.

Zloupotreba hop-by-hop zaglavlja moÅ¾e dovesti do razliÄitih bezbednosnih implikacija. Ispod su dva primera koja pokazuju kako se ova zaglavlja mogu manipulisati za potencijalne napade:

### Bypassing Security Controls with `X-Forwarded-For`
NapadaÄ moÅ¾e manipulisati `X-Forwarded-For` zaglavljem kako bi zaobiÅ¡ao IP-bazirane kontrole pristupa. Ovo zaglavlje se Äesto koristi od strane proksija za praÄ‡enje izvorne IP adrese klijenta. MeÄ‘utim, ako proksi tretira ovo zaglavlje kao hop-by-hop i prosledi ga bez pravilne validacije, napadaÄ moÅ¾e laÅ¾irati svoju IP adresu.

**Scenarijo napada:**
1. NapadaÄ Å¡alje HTTP zahtev web aplikaciji iza proksija, ukljuÄujuÄ‡i laÅ¾nu IP adresu u `X-Forwarded-For` zaglavlju.
2. NapadaÄ takoÄ‘e ukljuÄuje `Connection: close, X-Forwarded-For` zaglavlje, podstiÄuÄ‡i proksi da tretira `X-Forwarded-For` kao hop-by-hop.
3. PogreÅ¡no konfigurisan proksi prosledi zahtev web aplikaciji bez laÅ¾iranog `X-Forwarded-For` zaglavlja.
4. Web aplikacija, ne videÄ‡i originalno `X-Forwarded-For` zaglavlje, moÅ¾e smatrati zahtev kao da dolazi direktno iz pouzdane proksi, potencijalno omoguÄ‡avajuÄ‡i neovlaÅ¡Ä‡en pristup.

### Cache Poisoning via Hop-by-Hop Header Injection
Ako server za keÅ¡iranje pogreÅ¡no keÅ¡ira sadrÅ¾aj na osnovu hop-by-hop zaglavlja, napadaÄ moÅ¾e injektovati zlonamerna zaglavlja kako bi otrovao keÅ¡. Ovo bi posluÅ¾ilo netaÄan ili zlonameran sadrÅ¾aj korisnicima koji traÅ¾e isti resurs.

**Scenarijo napada:**
1. NapadaÄ Å¡alje zahtev web aplikaciji sa hop-by-hop zaglavljem koje ne bi trebalo da se keÅ¡ira (npr. `Connection: close, Cookie`).
2. LoÅ¡e konfigurisan server za keÅ¡iranje ne uklanja hop-by-hop zaglavlje i keÅ¡ira odgovor specifiÄan za napadaÄevu sesiju.
3. BuduÄ‡i korisnici koji traÅ¾e isti resurs dobijaju keÅ¡irani odgovor, koji je bio prilagoÄ‘en za napadaÄa, potencijalno dovodeÄ‡i do preuzimanja sesije ili izlaganja osetljivih informacija.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
