# Preuzimanje naloga

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## **Problem sa autorizacijom**

Email naloga treba pokuÅ¡ati da se promeni, a proces potvrde **mora biti ispitan**. Ako se utvrdi da je **slab**, email treba promeniti na onaj koji pripada nameravanoj Å¾rtvi i zatim potvrditi.

## **Problem sa Unicode normalizacijom**

1. Nalog nameravane Å¾rtve `victim@gmail.com`
2. Treba kreirati nalog koristeÄ‡i Unicode\
na primer: `viÄ‡tim@gmail.com`

Kao Å¡to je objaÅ¡njeno u [**ovom predavanju**](https://www.youtube.com/watch?v=CiIyaZ3x49c), prethodni napad se takoÄ‘e moÅ¾e izvesti zloupotrebom identitetskih provajdera treÄ‡ih strana:

* Kreirati nalog kod identitetskog provajdera treÄ‡e strane sa sliÄnim emailom kao Å¾rtva koristeÄ‡i neki unicode karakter (`viÄ‡tim@company.com`).
* Provajder treÄ‡e strane ne bi trebao da verifikuje email
* Ako identitetski provajder verifikuje email, moÅ¾da moÅ¾ete napasti deo domene kao Å¡to je: `victim@Ä‡ompany.com` i registrovati tu domenu i nadati se da identitetski provajder generiÅ¡e ascii verziju domene dok platforma Å¾rtve normalizuje naziv domene.
* Prijavite se putem ovog identitetskog provajdera na platformu Å¾rtve koja bi trebala normalizovati unicode karakter i omoguÄ‡iti vam pristup nalogu Å¾rtve.

Za viÅ¡e detalja, pogledajte dokument o Unicode normalizaciji:

{% content-ref url="unicode-injection/unicode-normalization.md" %}
[unicode-normalization.md](unicode-injection/unicode-normalization.md)
{% endcontent-ref %}

## **Ponovno koriÅ¡Ä‡enje reset tokena**

Ako ciljni sistem dozvoljava **ponovno koriÅ¡Ä‡enje linka za reset**, treba uloÅ¾iti napore da se **pronaÄ‘e viÅ¡e linkova za reset** koristeÄ‡i alate kao Å¡to su `gau`, `wayback`, ili `scan.io`.

## **Pre preuzimanja naloga**

1. Email Å¾rtve treba koristiti za registraciju na platformi, a lozinka treba biti postavljena (pokuÅ¡aj potvrde treba biti napravljen, iako nedostatak pristupa emailovima Å¾rtve moÅ¾e uÄiniti ovo nemoguÄ‡im).
2. Treba Äekati dok Å¾rtva ne registruje koristeÄ‡i OAuth i potvrdi nalog.
3. Nadamo se da Ä‡e redovna registracija biti potvrÄ‘ena, omoguÄ‡avajuÄ‡i pristup nalogu Å¾rtve.

## **CORS pogreÅ¡na konfiguracija za preuzimanje naloga**

Ako stranica sadrÅ¾i **CORS pogreÅ¡ne konfiguracije**, moÅ¾da Ä‡ete moÄ‡i da **ukradete osetljive informacije** od korisnika kako biste **preuzeli njegov nalog** ili ga naterali da promeni informacije o autentifikaciji u istu svrhu:

{% content-ref url="cors-bypass.md" %}
[cors-bypass.md](cors-bypass.md)
{% endcontent-ref %}

## **CSRF za preuzimanje naloga**

Ako je stranica ranjiva na CSRF, moÅ¾da Ä‡ete moÄ‡i da naterate **korisnika da izmeni svoju lozinku**, email ili autentifikaciju kako biste zatim mogli da mu pristupite:

{% content-ref url="csrf-cross-site-request-forgery.md" %}
[csrf-cross-site-request-forgery.md](csrf-cross-site-request-forgery.md)
{% endcontent-ref %}

## **XSS za preuzimanje naloga**

Ako pronaÄ‘ete XSS u aplikaciji, moÅ¾da Ä‡ete moÄ‡i da ukradete kolaÄiÄ‡e, lokalnu memoriju ili informacije sa web stranice koje bi vam mogle omoguÄ‡iti preuzimanje naloga:

{% content-ref url="xss-cross-site-scripting/" %}
[xss-cross-site-scripting](xss-cross-site-scripting/)
{% endcontent-ref %}

## **Ista domena + KolaÄiÄ‡i**

Ako pronaÄ‘ete ograniÄen XSS ili preuzimanje poddomena, mogli biste se igrati sa kolaÄiÄ‡ima (fiksirajuÄ‡i ih na primer) kako biste pokuÅ¡ali da kompromitujete nalog Å¾rtve:

{% content-ref url="hacking-with-cookies/" %}
[hacking-with-cookies](hacking-with-cookies/)
{% endcontent-ref %}

## **Napad na mehanizam resetovanja lozinke**

{% content-ref url="reset-password.md" %}
[reset-password.md](reset-password.md)
{% endcontent-ref %}

## **Manipulacija odgovorom**

Ako se odgovor na autentifikaciju moÅ¾e **smanjiti na jednostavnu boolean vrednost, samo pokuÅ¡ajte da promenite false u true** i vidite da li dobijate bilo kakav pristup.

## OAuth za preuzimanje naloga

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

## Injekcija Host zaglavlja

1. Host zaglavlje se menja nakon iniciranja zahteva za resetovanje lozinke.
2. `X-Forwarded-For` proxy zaglavlje se menja u `attacker.com`.
3. Host, Referrer i Origin zaglavlja se istovremeno menjaju u `attacker.com`.
4. Nakon iniciranja resetovanja lozinke i zatim odabira ponovnog slanja maila, koriste se sve tri prethodno navedene metode.

## Manipulacija odgovorom

1. **Manipulacija kodom**: Status kod se menja u `200 OK`.
2. **Manipulacija kodom i telom**:
* Status kod se menja u `200 OK`.
* Telo odgovora se menja u `{"success":true}` ili prazan objekat `{}`.

Ove tehnike manipulacije su efikasne u scenarijima gde se JSON koristi za prenos i prijem podataka.

## Promena emaila trenutne sesije

Iz [ovog izveÅ¡taja](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

* NapadaÄ traÅ¾i da promeni svoj email na novi
* NapadaÄ dobija link za potvrdu promene emaila
* NapadaÄ Å¡alje Å¾rtvi link kako bi ga kliknula
* Email Å¾rtve se menja na onaj koji je naveo napadaÄ
* NapadaÄ moÅ¾e povratiti lozinku i preuzeti nalog

Ovo se takoÄ‘e dogodilo u [**ovom izveÅ¡taju**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).

### Stari kolaÄiÄ‡i

Kao Å¡to je objaÅ¡njeno [**u ovom postu**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), bilo je moguÄ‡e prijaviti se na nalog, saÄuvati kolaÄiÄ‡e kao autentifikovani korisnik, odjaviti se, a zatim se ponovo prijaviti.\
Sa novim prijavljivanjem, iako su moÅ¾da generisani razliÄiti kolaÄiÄ‡i, stari su ponovo poÄeli da rade.

## Reference

* [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
* [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
