# ë¸Œë¼ìš°ì € ìµìŠ¤í…ì…˜ íœí…ŒìŠ¤íŒ… ë°©ë²•ë¡ 

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¥¼ í†µí•´ ì œë¡œë¶€í„° ì˜ì›…ì´ ë  ë•Œê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê¸¸ ì›í•œë‹¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks êµ¿ì¦ˆ**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **ë‹¹ì‹ ì˜ í•´í‚¹ ê¸°ìˆ ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

ë¸Œë¼ìš°ì € ìµìŠ¤í…ì…˜ì€ JavaScriptë¡œ ì‘ì„±ë˜ë©° ë¸Œë¼ìš°ì €ì— ì˜í•´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¡œë“œë©ë‹ˆë‹¤. [DOM](https://www.w3schools.com/js/js\_htmldom.asp)ì„ ê°€ì§€ê³  ìˆì§€ë§Œ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì˜ DOMê³¼ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì˜ ê¸°ë°€ì„±, ë¬´ê²°ì„± ë° ê°€ìš©ì„±(CIA)ì„ ì¹¨í•´í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

## ì£¼ìš” êµ¬ì„± ìš”ì†Œ

ìµìŠ¤í…ì…˜ ë ˆì´ì•„ì›ƒì€ ì‹œê°í™”ë˜ì—ˆì„ ë•Œ ê°€ì¥ ì˜ ë³´ì´ë©° ì„¸ ê°€ì§€ êµ¬ì„± ìš”ì†Œë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ê° êµ¬ì„± ìš”ì†Œë¥¼ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

<figure><img src="../../.gitbook/assets/image (13).png" alt=""><figcaption><p><a href="http://webblaze.cs.berkeley.edu/papers/Extensions.pdf">http://webblaze.cs.berkeley.edu/papers/Extensions.pdf</a></p></figcaption></figure>

### **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**

ê° ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” **ë‹¨ì¼ ì›¹ í˜ì´ì§€ì˜ DOMì— ì§ì ‘ ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆìœ¼ë©° **ì ì¬ì ìœ¼ë¡œ ì•…ì˜ì ì¸ ì…ë ¥**ì— ë…¸ì¶œë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì—ëŠ” í™•ì¥ ê¸°ëŠ¥ ì½”ì–´ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ ì™¸ì—ëŠ” ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.

### **ìµìŠ¤í…ì…˜ ì½”ì–´**

ìµìŠ¤í…ì…˜ ì½”ì–´ì—ëŠ” ëŒ€ë¶€ë¶„ì˜ ìµìŠ¤í…ì…˜ ê¶Œí•œ/ì•¡ì„¸ìŠ¤ê°€ í¬í•¨ë˜ì–´ ìˆì§€ë§Œ, ìµìŠ¤í…ì…˜ ì½”ì–´ëŠ” [XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest) ë° ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ì›¹ ì½˜í…ì¸ ì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ìµìŠ¤í…ì…˜ ì½”ì–´ëŠ” í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì— ì§ì ‘ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

### **ë„¤ì´í‹°ë¸Œ ë°”ì´ë„ˆë¦¬**

ìµìŠ¤í…ì…˜ì€ ì‚¬ìš©ìì˜ ì „ì²´ ê¶Œí•œì„ ê°€ì§„ í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì— **ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ë„¤ì´í‹°ë¸Œ ë°”ì´ë„ˆë¦¬**ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. ë„¤ì´í‹°ë¸Œ ë°”ì´ë„ˆë¦¬ëŠ” í”Œë˜ì‹œ ë° ê¸°íƒ€ ë¸Œë¼ìš°ì € í”ŒëŸ¬ê·¸ì¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” í‘œì¤€ ë„·ìŠ¤ì¼€ì´í”„ í”ŒëŸ¬ê·¸ì¸ ì‘ìš© í”„ë¡œê·¸ë˜ë° ì¸í„°í˜ì´ìŠ¤([NPAPI](https://en.wikipedia.org/wiki/NPAPI))ë¥¼ í†µí•´ ìµìŠ¤í…ì…˜ ì½”ì–´ì™€ ìƒí˜¸ì‘ìš©í•©ë‹ˆë‹¤.

### ê²½ê³„

{% hint style="danger" %}
ì‚¬ìš©ìì˜ ì „ì²´ ê¶Œí•œì„ ì–»ìœ¼ë ¤ë©´ ê³µê²©ìëŠ” ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìµìŠ¤í…ì…˜ ì½”ì–´ë¡œ ì•…ì˜ì ì¸ ì…ë ¥ì„ ì „ë‹¬í•˜ê³  ìµìŠ¤í…ì…˜ ì½”ì–´ì—ì„œ ë„¤ì´í‹°ë¸Œ ë°”ì´ë„ˆë¦¬ë¡œ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}

ìµìŠ¤í…ì…˜ì˜ ê° êµ¬ì„± ìš”ì†ŒëŠ” **ê°•ë ¥í•œ ë³´í˜¸ ê²½ê³„**ì— ì˜í•´ ì„œë¡œ ë¶„ë¦¬ë©ë‹ˆë‹¤. ê° êµ¬ì„± ìš”ì†ŒëŠ” **ë³„ë„ì˜ ìš´ì˜ ì²´ì œ í”„ë¡œì„¸ìŠ¤**ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ ë° ìµìŠ¤í…ì…˜ ì½”ì–´ëŠ” ëŒ€ë¶€ë¶„ì˜ ìš´ì˜ ì²´ì œ ì„œë¹„ìŠ¤ì— ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” **ìƒŒë“œë°•ìŠ¤ í”„ë¡œì„¸ìŠ¤**ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

ë˜í•œ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” **ë³„ë„ì˜ JavaScript í™ì—ì„œ ì‹¤í–‰**ë˜ì–´ í•´ë‹¹ ì›¹ í˜ì´ì§€ì™€ ë¶„ë¦¬ë©ë‹ˆë‹¤. ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì™€ ì›¹ í˜ì´ì§€ëŠ” **ë™ì¼í•œ ê¸°ë³¸ DOMì— ì•¡ì„¸ìŠ¤**í•˜ì§€ë§Œ ë‘ ê°€ì§€ëŠ” **JavaScript í¬ì¸í„°ë¥¼ êµí™˜í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ** JavaScript ê¸°ëŠ¥ì´ ëˆ„ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

## **`manifest.json`**

Chrome ìµìŠ¤í…ì…˜ì€ [.crx íŒŒì¼ í™•ì¥ì](https://www.lifewire.com/crx-file-2620391)ë¥¼ ê°€ì§„ ZIP í´ë”ì¼ ë¿ì…ë‹ˆë‹¤. ìµìŠ¤í…ì…˜ì˜ ì½”ì–´ëŠ” í´ë” ë£¨íŠ¸ì— ìˆëŠ” **`manifest.json`** íŒŒì¼ë¡œ ë ˆì´ì•„ì›ƒ, ê¶Œí•œ ë° ê¸°íƒ€ êµ¬ì„± ì˜µì…˜ì„ ì§€ì •í•©ë‹ˆë‹¤.

ì˜ˆì‹œ:
```json
{
"manifest_version": 2,
"name": "My extension",
"version": "1.0",
"permissions": [
"storage"
],
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
"background": {
"scripts": [
"background.js"
]
},
"options_ui": {
"page": "options.html"
}
}
```
### `content_scripts`

ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‚¬ìš©ìê°€ ì¼ì¹˜í•˜ëŠ” í˜ì´ì§€ë¡œ íƒìƒ‰í•  ë•Œë§ˆë‹¤ **ë¡œë“œ**ë©ë‹ˆë‹¤. ìš°ë¦¬ì˜ ê²½ìš° **`https://example.com/*`** í‘œí˜„ê³¼ ì¼ì¹˜í•˜ê³  **`*://*/*/business*`** ì •ê·œ í‘œí˜„ì‹ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ëª¨ë“  í˜ì´ì§€ì— ë¡œë“œë©ë‹ˆë‹¤. ì´ë“¤ì€ í˜ì´ì§€ ìì²´ì˜ ìŠ¤í¬ë¦½íŠ¸ì²˜ëŸ¼ ì‹¤í–‰ë˜ë©° í˜ì´ì§€ì˜ [ë¬¸ì„œ ê°ì²´ ëª¨ë¸ (DOM)](https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model)ì— ì„ì˜ë¡œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```json
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
```
**`include_globs`** ë° **`exclude_globs`**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë” ë§ì€ URLì„ í¬í•¨í•˜ê±°ë‚˜ ì œì™¸í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì´ëŠ” í˜ì´ì§€ì— ì„¤ëª… ë²„íŠ¼ì„ ì¶”ê°€í•˜ëŠ” ì˜ˆì œ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì´ë©°, [ì €ì¥ì†Œ API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage)ë¥¼ ì‚¬ìš©í•˜ì—¬ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì €ì¥ì†Œì—ì„œ `message` ê°’ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.
```js
chrome.storage.local.get("message", result =>
{
let div = document.createElement("div");
div.innerHTML = result.message + " <button>Explain</button>";
div.querySelector("button").addEventListener("click", () =>
{
chrome.runtime.sendMessage("explain");
});
document.body.appendChild(div);
});
```
<figure><img src="../../.gitbook/assets/image (20).png" alt=""><figcaption></figcaption></figure>

ì´ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ê°€ [**runtime.sendMessage() API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage)ë¥¼ í™œìš©í•˜ì—¬ í™•ì¥ í˜ì´ì§€ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤. ì´ëŠ” ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ê°€ APIì— ì§ì ‘ ì•¡ì„¸ìŠ¤í•˜ëŠ” ê²ƒì— ì œí•œì´ ìˆê¸° ë•Œë¬¸ì— ë°œìƒí•˜ë©°, `storage`ê°€ ì†Œìˆ˜ì˜ ì˜ˆì™¸ ì‚¬í•­ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ì˜ˆì™¸ ì‚¬í•­ì„ ë„˜ì–´ì„œëŠ” ê¸°ëŠ¥ì„ ìœ„í•´ ë©”ì‹œì§€ê°€ í™•ì¥ í˜ì´ì§€ë¡œ ë³´ë‚´ì§€ë©°, ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ê°€ í•´ë‹¹ í˜ì´ì§€ì™€ í†µì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="warning" %}
ë¸Œë¼ìš°ì €ì— ë”°ë¼ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì˜ ê¸°ëŠ¥ì´ ì•½ê°„ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Chromium ê¸°ë°˜ ë¸Œë¼ìš°ì €ì˜ ê²½ìš°, ê¸°ëŠ¥ ëª©ë¡ì€ [Chrome ê°œë°œì ë¬¸ì„œ](https://developer.chrome.com/docs/extensions/mv3/content\_scripts/#capabilities)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, Firefoxì˜ ê²½ìš° [MDN](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content\_scripts#webextension\_apis)ì´ ì£¼ìš” ì†ŒìŠ¤ë¡œ ì‘ìš©í•©ë‹ˆë‹¤.\
ë˜í•œ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ì™€ í†µì‹ í•  ìˆ˜ ìˆì–´ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ì‘ë‹µì„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

Chromeì—ì„œ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë³´ê³  ë””ë²„ê¹…í•˜ê¸° ìœ„í•´ Chrome ê°œë°œì ë„êµ¬ ë©”ë‰´ì—ëŠ” Options > More tools > Developer toolsë¥¼ í†µí•´ ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ Ctrl + Shift + Ië¥¼ ëˆ„ë¥´ë©´ ë©ë‹ˆë‹¤.

ê°œë°œì ë„êµ¬ê°€ í‘œì‹œëœ í›„ **Source íƒ­**ì„ í´ë¦­í•œ ë‹¤ìŒ **Content Scripts íƒ­**ì„ í´ë¦­í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì—¬ëŸ¬ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ ì¤‘ì¸ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê´€ì°°í•˜ê³  ì‹¤í–‰ íë¦„ì„ ì¶”ì í•˜ê¸° ìœ„í•´ ì¤‘ë‹¨ì ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‚½ì…ëœ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸

{% hint style="success" %}
**ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” í•„ìˆ˜ì ì´ì§€ ì•ŠìŠµë‹ˆë‹¤**. **ë™ì ìœ¼ë¡œ** ìŠ¤í¬ë¦½íŠ¸ë¥¼ **ì‚½ì…**í•˜ê±°ë‚˜ **í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì‚½ì…**í•˜ì—¬ **`tabs.executeScript`**ë¥¼ í†µí•´ ì›¹ í˜ì´ì§€ì— ì‚½ì…í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ëŠ” ì‹¤ì œë¡œ ë” **ì„¸ë¶„í™”ëœ ì œì–´**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
{% endhint %}

ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì‚½ì…í•˜ë ¤ë©´, ìŠ¤í¬ë¦½íŠ¸ê°€ ì‚½ì…ë  í˜ì´ì§€ì— ëŒ€í•œ [í˜¸ìŠ¤íŠ¸ ê¶Œí•œ](https://developer.chrome.com/docs/extensions/reference/permissions)ì´ í™•ì¥ í”„ë¡œê·¸ë¨ì— í•„ìš”í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê¶Œí•œì€ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë‚´ì—ì„œ ìš”ì²­í•˜ê±°ë‚˜ [**activeTab**](https://developer.chrome.com/docs/extensions/reference/manifest/activeTab)ì„ í†µí•´ ì¼ì‹œì ìœ¼ë¡œ ë³´í˜¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### activeTabì„ ê¸°ë°˜ìœ¼ë¡œ í•œ í™•ì¥ í”„ë¡œê·¸ë¨ ì˜ˆì‹œ

{% code title="manifest.json" %}
```json
{
"name": "My extension",
...
"permissions": [
"activeTab",
"scripting"
],
"background": {
"service_worker": "background.js"
},
"action": {
"default_title": "Action Button"
}
}
```
{% endcode %}

* **í´ë¦­ ì‹œ JS íŒŒì¼ ì£¼ì…:**
```javascript
// content-script.js
document.body.style.backgroundColor = "orange";

//service-worker.js - Inject the JS file
chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target: { tabId: tab.id },
files: ["content-script.js"]
});
});
```
* **í´ë¦­ ì‹œ í•¨ìˆ˜ ì£¼ì…**:
```javascript
//service-worker.js - Inject a function
function injectedFunction() {
document.body.style.backgroundColor = "orange";
}

chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target : {tabId : tab.id},
func : injectedFunction,
});
});
```
#### ìŠ¤í¬ë¦½íŒ… ê¶Œí•œ ì˜ˆì œ
```javascript
// service-workser.js
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
excludeMatches : [ "*://*/*business*" ],
js : [ "contentScript.js" ],
}]);

// Another example
chrome.tabs.executeScript(tabId, { file: "content_script.js" });
```
### Content Scripts `run_at`

`run_at` í•„ë“œëŠ” **JavaScript íŒŒì¼ì´ ì›¹ í˜ì´ì§€ì— ì£¼ì…ë˜ëŠ” ì‹œì ì„ ì œì–´**í•©ë‹ˆë‹¤. ì„ í˜¸ë˜ëŠ” ê¸°ë³¸ê°’ì€ `"document_idle"`ì…ë‹ˆë‹¤.

ê°€ëŠ¥í•œ ê°’ì€:

- **`document_idle`**: ê°€ëŠ¥í•œ ê²½ìš° ì–¸ì œë“ ì§€
- **`document_start`**: `css`ì—ì„œ íŒŒì¼ì´ ë¡œë“œëœ í›„ì— DOMì´ êµ¬ì„±ë˜ê±°ë‚˜ ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ê¸° ì „ì—
- **`document_end`**: DOMì´ ì™„ì „íˆ ë¡œë“œëœ ì§í›„ì´ì§€ë§Œ ì´ë¯¸ì§€ë‚˜ í”„ë ˆì„ê³¼ ê°™ì€ í•˜ìœ„ ë¦¬ì†ŒìŠ¤ê°€ ë¡œë“œë˜ê¸° ì „ì—

#### `manifest.json`ì„ í†µí•´
```json
{
"name": "My extension",
...
"content_scripts": [
{
"matches": ["https://*.example.com/*"],
"run_at": "document_idle",
"js": ["contentScript.js"]
}
],
...
}

```
**`service-worker.js`**ë¥¼ í†µí•´
```javascript
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
runAt : "document_idle",
js : [ "contentScript.js" ],
}]);
```
### `ë°±ê·¸ë¼ìš´ë“œ`

ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¡œ ì „ì†¡ëœ ë©”ì‹œì§€ëŠ” **ë°±ê·¸ë¼ìš´ë“œ í˜ì´ì§€**ì—ì„œ ìˆ˜ì‹ ë˜ë©°, í™•ì¥ í”„ë¡œê·¸ë¨ êµ¬ì„± ìš”ì†Œ ê°„ì˜ í†µì‹  ë° ì¡°ì •ì„ ë‹´ë‹¹í•˜ëŠ” ì¤‘ì‹¬ ì—­í• ì„ í•©ë‹ˆë‹¤. íŠ¹íˆ ë°±ê·¸ë¼ìš´ë“œ í˜ì´ì§€ëŠ” ì§ì ‘ì ì¸ ì‚¬ìš©ì ìƒí˜¸ ì‘ìš© ì—†ì´ ì¡°ìš©íˆ ì‘ë™í•˜ë©´ì„œ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ìˆ˜ëª… ë™ì•ˆ ì§€ì†ë©ë‹ˆë‹¤. ë³¸ì¸ë§Œì˜ ë¬¸ì„œ ê°ì²´ ëª¨ë¸(DOM)ì„ ë³´ìœ í•˜ì—¬ ë³µì¡í•œ ìƒí˜¸ ì‘ìš© ë° ìƒíƒœ ê´€ë¦¬ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

**ì£¼ìš” í¬ì¸íŠ¸**:

* **ë°±ê·¸ë¼ìš´ë“œ í˜ì´ì§€ ì—­í• :** í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ë‹¤ì–‘í•œ ë¶€ë¶„ ê°„ì˜ í†µì‹  ë° ì¡°ì •ì„ ë³´ì¥í•˜ëŠ” ì‹ ê²½ ì„¼í„° ì—­í• ì„ í•©ë‹ˆë‹¤.
* **ì§€ì†ì„±:** ì‚¬ìš©ìì—ê²ŒëŠ” ë³´ì´ì§€ ì•Šì§€ë§Œ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ê¸°ëŠ¥ì— ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤.
* **ìë™ ìƒì„±:** ëª…ì‹œì ìœ¼ë¡œ ì •ì˜ë˜ì§€ ì•Šì€ ê²½ìš° ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ë°±ê·¸ë¼ìš´ë“œ í˜ì´ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ ìë™ ìƒì„±ëœ í˜ì´ì§€ì—ëŠ” í™•ì¥ í”„ë¡œê·¸ë¨ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì—ì„œ ì§€ì •ëœ ëª¨ë“  ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ í¬í•¨ë˜ì–´ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ì´ ì›í™œí•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤.

{% hint style="success" %}
ëª…ì‹œì ìœ¼ë¡œ ì„ ì–¸ë˜ì§€ ì•Šì€ ê²½ìš° ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ë°±ê·¸ë¼ìš´ë“œ í˜ì´ì§€ë¥¼ ìƒì„±í•˜ì—¬ í•„ìš”í•œ ëª¨ë“  ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ í†µí•©ë˜ê³  ì‘ë™ë˜ì–´ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì„¤ì • í”„ë¡œì„¸ìŠ¤ë¥¼ ê°„ì†Œí™”í•©ë‹ˆë‹¤.
{% endhint %}

ì˜ˆì‹œ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸:
```js
chrome.runtime.onMessage.addListener((request, sender, sendResponse) =>
{
if (request == "explain")
{
chrome.tabs.create({ url: "https://example.net/explanation" });
}
})
```
ì´ëŠ” [runtime.onMessage API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤. "explain" ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë©´ [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs)ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆ íƒ­ì—ì„œ í˜ì´ì§€ë¥¼ ì—½ë‹ˆë‹¤.

ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë””ë²„ê¹…í•˜ë ¤ë©´ **í™•ì¥ í”„ë¡œê·¸ë¨ ì„¸ë¶€ ì •ë³´ë¡œ ì´ë™í•˜ì—¬ ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ ê²€ì‚¬**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆëŠ” ê°œë°œì ë„êµ¬ê°€ ì—´ë¦½ë‹ˆë‹¤:

<figure><img src="https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/browser-extension-pentesting-methodology/broken-reference" alt=""><figcaption></figcaption></figure>

### ì˜µì…˜ í˜ì´ì§€ ë° ê¸°íƒ€

ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì—ëŠ” ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ í˜ì´ì§€ê°€ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **ì‘ì—… í˜ì´ì§€**ëŠ” **í™•ì¥ í”„ë¡œê·¸ë¨ ì•„ì´ì½˜ì„ í´ë¦­í•  ë•Œ ë“œë¡­ë‹¤ìš´**ì— í‘œì‹œë©ë‹ˆë‹¤.
* í™•ì¥ í”„ë¡œê·¸ë¨ì´ **ìƒˆ íƒ­ì—ì„œ ë¡œë“œí•˜ëŠ” í˜ì´ì§€**.
* **ì˜µì…˜ í˜ì´ì§€**: ì´ í˜ì´ì§€ëŠ” í´ë¦­í•  ë•Œ í™•ì¥ í”„ë¡œê·¸ë¨ ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤. ì´ì „ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì—ì„œ ë‚˜ëŠ” ì´ í˜ì´ì§€ì— `chrome://extensions/?options=fadlhnelkbeojnebcbkacjilhnbjfjca`ë¡œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë˜ëŠ” ë‹¤ìŒì„ í´ë¦­í•˜ì‹­ì‹œì˜¤:

<figure><img src="../../.gitbook/assets/image (21).png" alt="" width="375"><figcaption></figcaption></figure>

ì´ëŸ¬í•œ í˜ì´ì§€ëŠ” ë°±ê·¸ë¼ìš´ë“œ í˜ì´ì§€ì²˜ëŸ¼ ì§€ì†ì ì´ì§€ ì•Šìœ¼ë©° í•„ìš”ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì½˜í…ì¸ ë¥¼ë¡œë“œí•©ë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ì´ëŸ¬í•œ í˜ì´ì§€ëŠ” ë°±ê·¸ë¼ìš´ë“œ í˜ì´ì§€ì™€ ì¼ë¶€ ê¸°ëŠ¥ì„ ê³µìœ í•©ë‹ˆë‹¤:

* **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì™€ì˜ í†µì‹ :** ë°±ê·¸ë¼ìš´ë“œ í˜ì´ì§€ì™€ ìœ ì‚¬í•˜ê²Œ, ì´ëŸ¬í•œ í˜ì´ì§€ëŠ” ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ì—¬ í™•ì¥ í”„ë¡œê·¸ë¨ ë‚´ì—ì„œ ìƒí˜¸ ì‘ìš©ì„ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤.
* **í™•ì¥ í”„ë¡œê·¸ë¨ë³„ API ì•¡ì„¸ìŠ¤:** ì´ëŸ¬í•œ í˜ì´ì§€ëŠ” í™•ì¥ í”„ë¡œê·¸ë¨ë³„ APIì— ëŒ€í•œ í¬ê´„ì ì¸ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ê°–ìŠµë‹ˆë‹¤. í™•ì¥ í”„ë¡œê·¸ë¨ì— ì •ì˜ëœ ê¶Œí•œì— ë”°ë¼ ì œí•œë©ë‹ˆë‹¤.

### `permissions` ë° `host_permissions`

**`permissions`** ë° **`host_permissions`**ì€ ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì´ ê°€ì§€ëŠ” **ê¶Œí•œ(ì €ì¥ì†Œ, ìœ„ì¹˜ ë“±)** ë° **ì–´ë–¤ ì›¹ í˜ì´ì§€**ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” `manifest.json`ì˜ í•­ëª©ì…ë‹ˆë‹¤.

ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì´ ë§¤ìš° **íŠ¹ê¶Œì„ ê°€ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—**, ì•…ì˜ì ì¸ í™•ì¥ í”„ë¡œê·¸ë¨ ë˜ëŠ” ì¹¨ì…ë‹¹í•œ í™•ì¥ í”„ë¡œê·¸ë¨ì€ ê³µê²©ìê°€ **ë¯¼ê°í•œ ì •ë³´ë¥¼ íƒˆì·¨í•˜ê³  ì‚¬ìš©ìë¥¼ ê°ì‹œí•˜ëŠ” ë‹¤ì–‘í•œ ìˆ˜ë‹¨ì„ í—ˆìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ì„¤ì •ì´ ì–´ë–»ê²Œ ì‘ë™í•˜ê³  ì–´ë–»ê²Œ ì•…ìš©ë  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ ë‹¤ìŒì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤:

{% content-ref url="browext-permissions-and-host_permissions.md" %}
[browext-permissions-and-host\_permissions.md](browext-permissions-and-host\_permissions.md)
{% endcontent-ref %}

### `content_security_policy`

**content security policy**ëŠ” `manifest.json` ë‚´ì—ì„œë„ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ì˜ëœ ê²½ìš° **ì·¨ì•½**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ í˜ì´ì§€ì˜ ê¸°ë³¸ ì„¤ì •ì€ ìƒë‹¹íˆ ì œí•œì ì…ë‹ˆë‹¤:
```bash
script-src 'self'; object-src 'self';
```
CSP ë° ê°€ëŠ¥í•œ ìš°íšŒ ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì‹­ì‹œì˜¤:

{% content-ref url="../content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../content-security-policy-csp-bypass/)
{% endcontent-ref %}

### `web_accessible_resources`

ì›¹í˜ì´ì§€ê°€ ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì˜ í˜ì´ì§€(ì˜ˆ: `.html` í˜ì´ì§€)ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ í•´ë‹¹ í˜ì´ì§€ë¥¼ `manifest.json`ì˜ **`web_accessible_resources`** í•„ë“œì— ì–¸ê¸‰í•´ì•¼ í•©ë‹ˆë‹¤.\
ì˜ˆì‹œ:
```javascript
{
...
"web_accessible_resources": [
{
"resources": [ "images/*.png" ],
"matches": [ "https://example.com/*" ]
},
{
"resources": [ "fonts/*.woff" ],
"matches": [ "https://example.com/*" ]
}
],
...
}
```
ì´ëŸ¬í•œ í˜ì´ì§€ëŠ” ë‹¤ìŒê³¼ ê°™ì€ URLì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
chrome-extension://<extension-id>/message.html
```
ê³µê°œ í™•ì¥ í”„ë¡œê·¸ë¨ì—ì„œ **í™•ì¥ í”„ë¡œê·¸ë¨ IDì— ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<figure><img src="../../.gitbook/assets/image (1191).png" alt="" width="375"><figcaption></figcaption></figure>

ê·¸ëŸ¬ë‚˜ `manifest.json` ë§¤ê°œë³€ìˆ˜ **`use_dynamic_url`**ì„ ì‚¬ìš©í•˜ë©´ì´ **IDê°€ ë™ì  ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ì´ëŸ¬í•œ í˜ì´ì§€ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ìˆê²Œë˜ë©´ì´ í˜ì´ì§€ëŠ” **ì ì¬ì ìœ¼ë¡œ ì·¨ì•½í•œ ClickJacking**ì´ ë©ë‹ˆë‹¤:

{% content-ref url="browext-clickjacking.md" %}
[browext-clickjacking.md](browext-clickjacking.md)
{% endcontent-ref %}

{% hint style="success" %}
ì´ëŸ¬í•œ í˜ì´ì§€ê°€ ëœë¤ URLì´ ì•„ë‹Œ í™•ì¥ í”„ë¡œê·¸ë¨ì— ì˜í•´ì„œë§Œë¡œë“œë˜ë„ë¡ í—ˆìš©í•˜ë©´ CLickJacking ê³µê²©ì„ ë°©ì§€ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### `externally_connectable`

[**ë¬¸ì„œ**](https://developer.chrome.com/docs/extensions/reference/manifest/externally-connectable)ì— ë”°ë¥´ë©´, `"externally_connectable"` ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì†ì„±ì€ [runtime.connect](https://developer.chrome.com/docs/extensions/reference/runtime#method-connect) ë° [runtime.sendMessage](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage)ë¥¼ í†µí•´ í™•ì¥ í”„ë¡œê·¸ë¨ì— ì—°ê²°í•  ìˆ˜ìˆëŠ” **í™•ì¥ í”„ë¡œê·¸ë¨ ë° ì›¹ í˜ì´ì§€ë¥¼ ì„ ì–¸**í•©ë‹ˆë‹¤.

* **`externally_connectable`** í‚¤ê°€ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì— ì„ ì–¸ë˜ì§€ ì•Šì•˜ê±°ë‚˜ **`"ids": ["*"]`**ë¡œ ì„ ì–¸ ëœ ê²½ìš°, **ëª¨ë“  í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì—°ê²°í•  ìˆ˜ ìˆì§€ë§Œ ì›¹ í˜ì´ì§€ëŠ” ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**.
* íŠ¹ì • IDê°€ ì§€ì •ëœ ê²½ìš°ì™€ ê°™ì´ `"ids": ["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"]`ì™€ ê°™ì´ **íŠ¹ì • ì‘ìš© í”„ë¡œê·¸ë¨ ë§Œ** ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ì¼ì¹˜ í•­ëª©**ì´ ì§€ì •ëœ ê²½ìš° í•´ë‹¹ ì›¹ ì•±ì´ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```json
"matches": [
"https://*.google.com/*",
"*://*.chromium.org/*",
```
* ë¹„ì–´ ìˆìŒìœ¼ë¡œ ì§€ì •ëœ ê²½ìš°: **`"externally_connectable": {}`**, ì–´ë–¤ ì•± ë˜ëŠ” ì›¹ë„ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ì—¬ê¸°ì— í‘œì‹œëœ **í™•ì¥ í”„ë¡œê·¸ë¨ ë° URLì´ ì ì„ìˆ˜ë¡** **ê³µê²© í‘œë©´ì´ ì‘ì•„ì§‘ë‹ˆë‹¤**.

{% hint style="danger" %}
ë§Œì•½ **XSSì— ì·¨ì•½í•˜ê±°ë‚˜ íƒˆì·¨ ê°€ëŠ¥í•œ** ì›¹ í˜ì´ì§€ê°€ **`externally_connectable`**ì— í‘œì‹œë˜ì–´ ìˆë‹¤ë©´, ê³µê²©ìëŠ” **ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ì— ì§ì ‘ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆê²Œ** ë˜ì–´ Content Script ë° í•´ë‹¹ CSPë¥¼ ì™„ì „íˆ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ, ì´ê²ƒì€ **ë§¤ìš° ê°•ë ¥í•œ ìš°íšŒ**ì…ë‹ˆë‹¤.

ê²Œë‹¤ê°€, í´ë¼ì´ì–¸íŠ¸ê°€ ì•…ì„± í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•˜ë©´ ì·¨ì•½í•œ í™•ì¥ í”„ë¡œê·¸ë¨ê³¼ í†µì‹ ì´ í—ˆìš©ë˜ì§€ ì•Šë”ë¼ë„, í—ˆìš©ëœ ì›¹ í˜ì´ì§€ì— **XSS ë°ì´í„°ë¥¼ ì‚½ì…**í•˜ê±°ë‚˜ ëŒ€ìƒ ë„ë©”ì¸ì—ì„œ ìš”ì²­ì„ ì¡°ì‘í•˜ê¸° ìœ„í•´ **`WebRequest`** ë˜ëŠ” **`DeclarativeNetRequest`** APIë¥¼ ë‚¨ìš©í•˜ì—¬ **JavaScript íŒŒì¼**ì˜ ìš”ì²­ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ëŒ€ìƒ í˜ì´ì§€ì˜ CSPê°€ ì´ëŸ¬í•œ ê³µê²©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŒì— ìœ ì˜í•˜ì‹­ì‹œì˜¤). ì´ ì•„ì´ë””ì–´ëŠ” [**ì´ ì„¤ëª…ì„œì—ì„œ ë‚˜ì˜¨ ê²ƒì…ë‹ˆë‹¤**](https://www.darkrelay.com/post/opera-zero-day-rce-vulnerability).
{% endhint %}

##

## ì›¹ **â†”ï¸** ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ í†µì‹ 

**ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ê°€ ì‘ë™í•˜ëŠ” í™˜ê²½ê³¼ í˜¸ìŠ¤íŠ¸ í˜ì´ì§€ê°€ ì¡´ì¬í•˜ëŠ” í™˜ê²½ì€ **ë¶„ë¦¬**ë˜ì–´ ìˆì–´ **ê²©ë¦¬**ê°€ ë³´ì¥ë©ë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ë‘ í™˜ê²½ì€ í˜ì´ì§€ì˜ **ë¬¸ì„œ ê°ì²´ ëª¨ë¸(DOM)**ê³¼ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆëŠ” ê³µìœ  ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. í˜¸ìŠ¤íŠ¸ í˜ì´ì§€ê°€ **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ì™€ í†µì‹ í•˜ê±°ë‚˜ ê°„ì ‘ì ìœ¼ë¡œ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ í™•ì¥ í”„ë¡œê·¸ë¨ê³¼ í†µì‹ í•˜ê¸° ìœ„í•´ì„œëŠ” ì–‘ìª½ì´ ì ‘ê·¼ ê°€ëŠ¥í•œ **DOM**ì„ í†µì‹  ì±„ë„ë¡œ í™œìš©í•´ì•¼ í•©ë‹ˆë‹¤.

### í¬ìŠ¤íŠ¸ ë©”ì‹œì§€

{% code title="content-script.js" %}
```javascript
var port = chrome.runtime.connect();

window.addEventListener("message", (event) => {
// We only accept messages from ourselves
if (event.source !== window) {
return;
}

if (event.data.type && (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
port.postMessage(event.data.text);
}
}, false);
```
{% endcode %}

{% code title="example.js" %}
```javascript
document.getElementById("theButton").addEventListener("click", () => {
window.postMessage(
{type : "FROM_PAGE", text : "Hello from the webpage!"}, "*");
}, false);
```
{% endcode %}

ì•ˆì „í•œ í¬ìŠ¤íŠ¸ ë©”ì‹œì§€ í†µì‹ ì€ ìˆ˜ì‹ ëœ ë©”ì‹œì§€ì˜ ì‹ ë¢°ì„±ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì—¬ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **`event.isTrusted`**: ì´ëŠ” ì´ë²¤íŠ¸ê°€ ì‚¬ìš©ì ì¡°ì‘ì— ì˜í•´ íŠ¸ë¦¬ê±°ëœ ê²½ìš°ì—ë§Œ Trueì…ë‹ˆë‹¤.
- ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‚¬ìš©ìê°€ ì–´ë–¤ ì¡°ì¹˜ë¥¼ ì·¨í•  ë•Œë§Œ ë©”ì‹œì§€ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì›ë³¸ ë„ë©”ì¸**: ë©”ì‹œì§€ë¥¼ ê¸°ëŒ€í•˜ëŠ” ê²½ìš°ì—ëŠ” í—ˆìš© ëª©ë¡ì— ìˆëŠ” ë„ë©”ì¸ë§Œ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì •ê·œì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë§¤ìš° ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
- **ì†ŒìŠ¤**: `received_message.source !== window`ëŠ” ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ê°€ ì²­ì·¨ ì¤‘ì¸ **ë™ì¼í•œ ì°½**ì—ì„œ ë©”ì‹œì§€ê°€ ì˜¨ ê²ƒì¸ì§€ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì „ ì²´í¬ëŠ” ìˆ˜í–‰ë˜ì—ˆë”ë¼ë„ ì·¨ì•½í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **ì ì¬ì ì¸ í¬ìŠ¤íŠ¸ ë©”ì‹œì§€ ìš°íšŒ**ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../postmessage-vulnerabilities/" %}
[postmessage-vulnerabilities](../postmessage-vulnerabilities/)
{% endcontent-ref %}

### Iframe

ë˜ ë‹¤ë¥¸ í†µì‹  ë°©ë²•ì€ **Iframe URL**ì„ í†µí•´ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆì œë¥¼ ë‹¤ìŒì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

### DOM

ì´ê²ƒì€ "ì •í™•íˆ" í†µì‹  ë°©ë²•ì€ ì•„ë‹ˆì§€ë§Œ **ì›¹ê³¼ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” ì›¹ DOMì— ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ, **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ê°€ ê·¸ê²ƒì—ì„œ ì •ë³´ë¥¼ ì½ê³  **ì›¹ DOMì„ ì‹ ë¢°**í•œë‹¤ë©´, ì›¹ì€ **ì´ ë°ì´í„°ë¥¼ ìˆ˜ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì›¹ì€ ì‹ ë¢°í•´ì„œëŠ” ì•ˆ ë˜ê±°ë‚˜ XSS ì·¨ì•½ì ì´ ìˆê¸° ë•Œë¬¸ì—) ê·¸ë¦¬ê³  **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ compromise**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë¸Œë¼ìš°ì € ìµìŠ¤í…ì…˜ì„ compromiseí•˜ê¸° ìœ„í•œ DOM ê¸°ë°˜ XSS ì˜ˆì œ**ë¥¼ ë‹¤ìŒì—ì„œ ì°¾ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## ë©”ëª¨ë¦¬/ì½”ë“œ ë‚´ì˜ ë¯¼ê°í•œ ì •ë³´

ë¸Œë¼ìš°ì € ìµìŠ¤í…ì…˜ì´ **ë¯¼ê°í•œ ì •ë³´ë¥¼ ë‚´ë¶€ ë©”ëª¨ë¦¬ì— ì €ì¥**í•˜ëŠ” ê²½ìš°, ì´ëŠ” **ë¤í”„**ë  ìˆ˜ ìˆìœ¼ë©°(íŠ¹íˆ Windows ê¸°ê¸°ì—ì„œ) ì´ ì •ë³´ë¥¼ **ê²€ìƒ‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ, ë¸Œë¼ìš°ì € ìµìŠ¤í…ì…˜ì˜ ë©”ëª¨ë¦¬ëŠ” **ì•ˆì „í•˜ë‹¤ê³  ë³´ë©´ ì•ˆ ë˜ë©°** ìê²© ì¦ëª…ì´ë‚˜ ë‹ˆëª¨ë‹‰ êµ¬ì ˆê³¼ ê°™ì€ **ë¯¼ê°í•œ ì •ë³´ëŠ” ì €ì¥í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤**.

ë¬¼ë¡ , **ì½”ë“œì— ë¯¼ê°í•œ ì •ë³´ë¥¼ ë„£ì§€ ë§ˆì‹­ì‹œì˜¤**, ê·¸ê²ƒì€ **ê³µê°œ**ë  ê²ƒì…ë‹ˆë‹¤.

ë¸Œë¼ìš°ì €ì—ì„œ ë©”ëª¨ë¦¬ë¥¼ ë¤í”„í•˜ë ¤ë©´ **í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ë¥¼ ë¤í”„**í•˜ê±°ë‚˜ ë¸Œë¼ìš°ì € ìµìŠ¤í…ì…˜ì˜ **ì„¤ì •**ìœ¼ë¡œ ì´ë™í•˜ì—¬ **`Inspect pop-up`**ì„ í´ë¦­ -> **`Memory`** ì„¹ì…˜ì—ì„œ **`Take a snaphost`**ë¥¼ í´ë¦­í•˜ê³  ìŠ¤ëƒ…ìƒ· ë‚´ì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ **`CTRL+F`**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ **â†”ï¸** ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ í†µì‹ 

ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” [**runtime.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) **ë˜ëŠ”** [**tabs.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/tabs#method-sendMessage) í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì¼íšŒì„± JSON-ì§ë ¬í™” ê°€ëŠ¥í•œ** ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì‘ë‹µ**ì„ ì²˜ë¦¬í•˜ë ¤ë©´ ë°˜í™˜ëœ **Promise**ë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤. ê·¸ëŸ¬ë‚˜ ì—­í˜¸í™˜ì„±ì„ ìœ„í•´ ë§ˆì§€ë§‰ ì¸ìˆ˜ë¡œ **ì½œë°±**ì„ ì „ë‹¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

**ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ì—ì„œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```javascript
(async () => {
const response = await chrome.runtime.sendMessage({greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
**í™•ì¥ í”„ë¡œê·¸ë¨**ì—ì„œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒ (ë³´í†µ **ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸**). ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì–´ë–¤ íƒ­ìœ¼ë¡œ ë³´ë‚¼ì§€ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì„ íƒí•œ íƒ­ì˜ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ë°©ë²• ì˜ˆì‹œ:
```javascript
// From https://stackoverflow.com/questions/36153999/how-to-send-a-message-between-chrome-extension-popup-and-content-script
(async () => {
const [tab] = await chrome.tabs.query({active: true, lastFocusedWindow: true});
const response = await chrome.tabs.sendMessage(tab.id, {greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
**ìˆ˜ì‹  ì¸¡**ì—ì„œëŠ” ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ [**runtime.onMessage**](https://developer.chrome.com/docs/extensions/reference/runtime#event-onMessage) **ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ**ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ì½˜í…íŠ¸ ìŠ¤í¬ë¦½íŠ¸ë‚˜ í™•ì¥ í”„ë¡œê·¸ë¨ í˜ì´ì§€ì—ì„œ ë™ì¼í•˜ê²Œ ë³´ì…ë‹ˆë‹¤.
```javascript
// From https://stackoverflow.com/questions/70406787/javascript-send-message-from-content-js-to-background-js
chrome.runtime.onMessage.addListener(
function(request, sender, sendResponse) {
console.log(sender.tab ?
"from a content script:" + sender.tab.url :
"from the extension");
if (request.greeting === "hello")
sendResponse({farewell: "goodbye"});
}
);
```
ì˜ˆë¥¼ ë“¤ì–´, ê°•ì¡°ëœ ì˜ˆì œì—ì„œ **`sendResponse()`**ê°€ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. `sendResponse()`ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•˜ë„ë¡ `onMessage` ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ `return true;`ë¥¼ í†µí•©í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

ì¤‘ìš”í•œ ê³ ë ¤ ì‚¬í•­ì€ ì—¬ëŸ¬ í˜ì´ì§€ê°€ `onMessage` ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ë„ë¡ ì„¤ì •ëœ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ **íŠ¹ì • ì´ë²¤íŠ¸ì— ëŒ€í•´ `sendResponse()`ë¥¼ ì‹¤í–‰í•˜ëŠ” ì²« ë²ˆì§¸ í˜ì´ì§€**ë§Œì´ íš¨ê³¼ì ìœ¼ë¡œ ì‘ë‹µì„ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë™ì¼í•œ ì´ë²¤íŠ¸ì— ëŒ€í•œ ì´í›„ ì‘ë‹µì€ ê³ ë ¤ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ìƒˆë¡œìš´ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•  ë•ŒëŠ” ì½œë°± ëŒ€ì‹  í”„ë¡œë¯¸ìŠ¤ë¥¼ ì„ í˜¸í•´ì•¼ í•©ë‹ˆë‹¤. ì½œë°±ì˜ ì‚¬ìš©ì— ê´€í•œ ì¤‘ìš”í•œ ì ì€ `sendResponse()` í•¨ìˆ˜ê°€ ë™ê¸°ì ì¸ ì»¨í…ìŠ¤íŠ¸ ë‚´ì—ì„œ ì§ì ‘ ì‹¤í–‰ë˜ê±°ë‚˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ë¹„ë™ê¸° ì‘ì—…ì„ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ `true`ë¥¼ ë°˜í™˜í•  ë•Œë§Œ ìœ íš¨í•˜ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. í•¸ë“¤ëŸ¬ ì¤‘ ì–´ëŠ ê²ƒë„ `true`ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šê±°ë‚˜ `sendResponse()` í•¨ìˆ˜ê°€ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°ë˜ë©´(ê°€ë¹„ì§€ ìˆ˜ì§‘), `sendMessage()` í•¨ìˆ˜ì™€ ê´€ë ¨ëœ ì½œë°±ì´ ê¸°ë³¸ì ìœ¼ë¡œ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤.

## ë¸Œë¼ìš°ì €ì— í™•ì¥ í”„ë¡œê·¸ë¨ ë¡œë“œí•˜ê¸°

1. ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì„ **ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì••ì¶• í•´ì œí•©ë‹ˆë‹¤.
2. **`chrome://extensions/`**ë¡œ ì´ë™í•˜ê³  `ê°œë°œì ëª¨ë“œ`ë¥¼ **í™œì„±í™”**í•©ë‹ˆë‹¤.
3. **`ì••ì¶• í•´ì œëœ í™•ì¥ í”„ë¡œê·¸ë¨ ë¡œë“œ`** ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

**Firefox**ì—ì„œëŠ” **`about:debugging#/runtime/this-firefox`**ë¡œ ì´ë™í•˜ê³  **`ì„ì‹œ ì¶”ê°€ ê¸°ëŠ¥ ë¡œë“œ`** ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

## ìŠ¤í† ì–´ì—ì„œ ì†ŒìŠ¤ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°

í¬ë¡¬ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ì˜µì…˜ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ê³¼ ì§€ì¹¨ì€ ì•„ë˜ì— ë‚˜ì™€ ìˆìŠµë‹ˆë‹¤.

### ëª…ë ¹ì¤„ì„ í†µí•œ ZIP íŒŒì¼ë¡œ í™•ì¥ í”„ë¡œê·¸ë¨ ë‹¤ìš´ë¡œë“œ

í¬ë¡¬ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” ëª…ë ¹ì¤„ì„ ì‚¬ìš©í•˜ì—¬ ZIP íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ `curl`ì„ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • URLì—ì„œ ZIP íŒŒì¼ì„ ê°€ì ¸ì™€ì„œ ZIP íŒŒì¼ì˜ ë‚´ìš©ì„ ë””ë ‰í† ë¦¬ë¡œ ì¶”ì¶œí•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¦…ë‹ˆë‹¤:

1. `"extension_id"`ë¥¼ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì‹¤ì œ IDë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
2. ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤:
```bash
extension_id=your_extension_id   # Replace with the actual extension ID
curl -L -o "$extension_id.zip" "https://clients2.google.com/service/update2/crx?response=redirect&os=mac&arch=x86-64&nacl_arch=x86-64&prod=chromecrx&prodchannel=stable&prodversion=44.0.2403.130&x=id%3D$extension_id%26uc"
unzip -d "$extension_id-source" "$extension_id.zip"
```
### CRX Viewer ì›¹ì‚¬ì´íŠ¸ ì‚¬ìš©

[https://robwu.nl/crxviewer/](https://robwu.nl/crxviewer/)

### CRX Viewer í™•ì¥ í”„ë¡œê·¸ë¨ ì‚¬ìš©

ë˜ ë‹¤ë¥¸ í¸ë¦¬í•œ ë°©ë²•ì€ ì˜¤í”ˆ ì†ŒìŠ¤ í”„ë¡œì íŠ¸ì¸ Chrome Extension Source Viewerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. [Chrome Web Store](https://chrome.google.com/webstore/detail/chrome-extension-source-v/jifpbeccnghkjeaalbbjmodiffmgedin?hl=en)ì—ì„œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë·°ì–´ì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” [GitHub ì €ì¥ì†Œ](https://github.com/Rob--W/crxviewer)ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¡œì»¬ë¡œ ì„¤ì¹˜ëœ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì†ŒìŠ¤ ë³´ê¸°

ë¡œì»¬ë¡œ ì„¤ì¹˜ëœ Chrome í™•ì¥ í”„ë¡œê·¸ë¨ë„ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. "Profile Path" í•„ë“œë¥¼ ì°¾ì•„ `chrome://version/`ë¥¼ ë°©ë¬¸í•˜ì—¬ Chrome ë¡œì»¬ í”„ë¡œí•„ ë””ë ‰í† ë¦¬ì— ì•¡ì„¸ìŠ¤í•©ë‹ˆë‹¤.
2. í”„ë¡œí•„ ë””ë ‰í† ë¦¬ ë‚´ì˜ `Extensions/` í•˜ìœ„ í´ë”ë¡œ ì´ë™í•©ë‹ˆë‹¤.
3. ì´ í´ë”ì—ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì½ê¸° ê°€ëŠ¥í•œ í˜•ì‹ì˜ ì†ŒìŠ¤ ì½”ë“œê°€ í¬í•¨ëœ ëª¨ë“  ì„¤ì¹˜ëœ í™•ì¥ í”„ë¡œê·¸ë¨ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì‹ë³„í•˜ê¸° ìœ„í•´ IDë¥¼ ì´ë¦„ì— ë§¤í•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* `about:extensions` í˜ì´ì§€ì—ì„œ ê°œë°œì ëª¨ë“œë¥¼ í™œì„±í™”í•˜ì—¬ ê° í™•ì¥ í”„ë¡œê·¸ë¨ì˜ IDë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ê° í™•ì¥ í”„ë¡œê·¸ë¨ì˜ í´ë” ë‚´ì—ì„œ `manifest.json` íŒŒì¼ì—ëŠ” ì½ê¸° ê°€ëŠ¥í•œ `name` í•„ë“œê°€ í¬í•¨ë˜ì–´ ìˆì–´ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì‹ë³„í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

### íŒŒì¼ ì•„ì¹´ì´ë²„ ë˜ëŠ” ì–¸íŒ¨ì»¤ ì‚¬ìš©

Chrome Web Storeë¡œ ì´ë™í•˜ì—¬ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤. íŒŒì¼ì˜ í™•ì¥ìëŠ” `.crx`ì¼ ê²ƒì…ë‹ˆë‹¤. íŒŒì¼ í™•ì¥ìë¥¼ `.crx`ì—ì„œ `.zip`ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤. WinRAR, 7-Zip ë“±ì˜ íŒŒì¼ ì•„ì¹´ì´ë²„ë¥¼ ì‚¬ìš©í•˜ì—¬ ZIP íŒŒì¼ì˜ ë‚´ìš©ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.

### Chromeì˜ ê°œë°œì ëª¨ë“œ ì‚¬ìš©

Chromeì„ ì—´ê³  `chrome://extensions/`ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì˜¤ë¥¸ìª½ ìƒë‹¨ì—ì„œ "ê°œë°œì ëª¨ë“œ"ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤. "ì••ì¶• í•´ì œëœ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ë¡œë“œí•©ë‹ˆë‹¤..."ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì´ëŠ” ì†ŒìŠ¤ ì½”ë“œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì§€ëŠ” ì•Šì§€ë§Œ ì´ë¯¸ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜ ê°œë°œí•œ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì½”ë“œë¥¼ ë³´ê³  ìˆ˜ì •í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.

## ë³´ì•ˆ ê°ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì€ **ì œí•œëœ ê³µê²© í‘œë©´**ì„ ê°€ì§€ê³  ìˆì§€ë§Œ ì¼ë¶€ëŠ” **ì·¨ì•½ì **ì´ë‚˜ **ê°•í™”í•  ìˆ˜ ìˆëŠ” ì ì¬ì ì¸ ë¶€ë¶„**ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ê°€ì¥ ì¼ë°˜ì ì¸ ê²ƒë“¤ì…ë‹ˆë‹¤:

* [ ] ìš”ì²­ëœ **`permissions`**ì„ ìµœëŒ€í•œ **ì œí•œ**í•©ë‹ˆë‹¤.
* [ ] **`host_permissions`**ì„ ìµœëŒ€í•œ **ì œí•œ**í•©ë‹ˆë‹¤.
* **`content_security_policy`**ë¥¼ **ê°•ë ¥í•˜ê²Œ** ì‚¬ìš©í•©ë‹ˆë‹¤.
* **`externally_connectable`**ì„ ìµœëŒ€í•œ **ì œí•œ**í•˜ê³  í•„ìš” ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ìœ¼ë¡œ ë‚¨ê¸°ì§€ ì•Šê³  **`{}`**ë¥¼ ëª…ì‹œí•©ë‹ˆë‹¤.
* ì—¬ê¸°ì„œ **XSSë‚˜ íƒˆì·¨ ê°€ëŠ¥í•œ URL**ì´ ì–¸ê¸‰ëœ ê²½ìš°, ê³µê²©ìê°€ **ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì§ì ‘ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë§¤ìš° ê°•ë ¥í•œ ìš°íšŒì…ë‹ˆë‹¤.
* **`web_accessible_resources`**ë¥¼ ìµœëŒ€í•œ **ì œí•œ**í•˜ê³  ê°€ëŠ¥í•˜ë©´ ë¹„ì–´ ìˆê²Œ í•©ë‹ˆë‹¤.
* **`web_accessible_resources`**ê°€ ì—†ì§€ ì•Šì€ ê²½ìš° [**ClickJacking**](browext-clickjacking.md)ì„ í™•ì¸í•©ë‹ˆë‹¤.
* **í™•ì¥ í”„ë¡œê·¸ë¨**ì—ì„œ **ì›¹ í˜ì´ì§€**ë¡œ **í†µì‹ **ì´ ë°œìƒí•˜ëŠ” ê²½ìš°, í†µì‹ ìœ¼ë¡œ ì¸í•œ [**XSS ì·¨ì•½ì **](browext-xss-example.md)ì„ í™•ì¸í•©ë‹ˆë‹¤.
* Post Messagesë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° [**Post Message ì·¨ì•½ì **](../postmessage-vulnerabilities/)ì„ í™•ì¸í•©ë‹ˆë‹¤.
* **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ê°€ DOM ì„¸ë¶€ ì •ë³´ì— ì•¡ì„¸ìŠ¤**í•˜ëŠ” ê²½ìš°, í•´ë‹¹ ì •ë³´ê°€ ì›¹ì—ì„œ **ìˆ˜ì •**ë˜ì–´ XSSë¥¼ ë„ì…í•˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
* íŠ¹íˆ ì´ í†µì‹ ì´ **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ -> ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ í†µì‹ **ì— ê´€ì—¬í•˜ëŠ” ê²½ìš° íŠ¹ë³„íˆ ê°•ì¡°í•©ë‹ˆë‹¤.
* ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ ë‚´ì— **ë¯¼ê°í•œ ì •ë³´ë¥¼ ì €ì¥í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤**.
* ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ ë‚´ì— **ë¯¼ê°í•œ ì •ë³´ë¥¼ ì €ì¥í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤**.

## ë„êµ¬

### [**Tarnish**](https://thehackerblog.com/tarnish/)

* ì œê³µëœ Chrome ì›¹ìŠ¤í† ì–´ ë§í¬ì—ì„œ Chrome í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
* [**manifest.json**](https://developer.chrome.com/extensions/manifest) **ë·°ì–´**: í™•ì¥ í”„ë¡œê·¸ë¨ì˜ manifestì˜ JSON-prettified ë²„ì „ì„ ê°„ë‹¨íˆ í‘œì‹œí•©ë‹ˆë‹¤.
* **ì§€ë¬¸ ë¶„ì„**: [web\_accessible\_resources](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources)ì˜ ê°ì§€ ë° Chrome í™•ì¥ í”„ë¡œê·¸ë¨ ì§€ë¬¸ JavaScriptì˜ ìë™ ìƒì„±.
* **ì ì¬ì ì¸ Clickjacking ë¶„ì„**: [web\_accessible\_resources](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) ì§€ì‹œë¬¸ì´ ì„¤ì •ëœ í™•ì¥ í”„ë¡œê·¸ë¨ HTML í˜ì´ì§€ì˜ ê°ì§€. ì´ëŸ¬í•œ í˜ì´ì§€ëŠ” í˜ì´ì§€ì˜ ëª©ì ì— ë”°ë¼ Clickjackingì— ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ê¶Œí•œ ê²½ê³  ë·°ì–´**: ì‚¬ìš©ìê°€ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•˜ë ¤ê³  ì‹œë„í•  ë•Œ í‘œì‹œë˜ëŠ” ëª¨ë“  Chrome ê¶Œí•œ í”„ë¡¬í”„íŠ¸ ê²½ê³  ëª©ë¡ì„ í‘œì‹œí•©ë‹ˆë‹¤.
* **ìœ„í—˜í•œ ê¸°ëŠ¥**: ê³µê²©ìê°€ ì•…ìš©í•  ìˆ˜ ìˆëŠ” ìœ„í—˜í•œ ê¸°ëŠ¥ì˜ ìœ„ì¹˜ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤ (ì˜ˆ: innerHTML, chrome.tabs.executeScriptì™€ ê°™ì€ ê¸°ëŠ¥).
* **ì§„ì…ì **: í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì‚¬ìš©ì/ì™¸ë¶€ ì…ë ¥ì„ ë°›ëŠ” ìœ„ì¹˜ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ì´ëŠ” í™•ì¥ í”„ë¡œê·¸ë¨ì˜ í‘œë©´ì ì¸ ì˜ì—­ì„ ì´í•´í•˜ê³  ì•…ì˜ì ìœ¼ë¡œ ì¡°ì‘ëœ ë°ì´í„°ë¥¼ í™•ì¥ í”„ë¡œê·¸ë¨ì— ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì ì¬ì ì¸ ì§€ì ì„ ì°¾ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.
* ìœ„í—˜í•œ ê¸°ëŠ¥ ë° ì§„ì…ì  ìŠ¤ìºë„ˆëŠ” ë‹¤ìŒì„ ìƒì„±ëœ ê²½ê³ ì— ëŒ€í•´ ì œê³µí•©ë‹ˆë‹¤:
* ê²½ê³ ë¥¼ ì¼ìœ¼í‚¨ ì½”ë“œ ìŠ¤ë‹ˆí« ë° ë¼ì¸.
* ë¬¸ì œì— ëŒ€í•œ ì„¤ëª….
* ì½”ë“œë¥¼ í¬í•¨í•˜ëŠ” ì „ì²´ ì†ŒìŠ¤ íŒŒì¼ì„ ë³¼ ìˆ˜ ìˆëŠ” "íŒŒì¼ ë³´ê¸°" ë²„íŠ¼.
* ê²½ê³ ë¥¼ ì¼ìœ¼í‚¨ íŒŒì¼ì˜ ê²½ë¡œ.
* ê²½ê³ ë¥¼ ì¼ìœ¼í‚¨ íŒŒì¼ì˜ ì „ì²´ Chrome í™•ì¥ í”„ë¡œê·¸ë¨ URI.
* JavaScript íŒŒì¼ì— ì·¨ì•½í•œ ë¼ì¸ì´ ìˆëŠ” ê²½ìš°, í•´ë‹¹ ë¼ì¸ì´ í¬í•¨ëœ ëª¨ë“  í˜ì´ì§€ì˜ ê²½ë¡œì™€ í•´ë‹¹ í˜ì´ì§€ì˜ ìœ í˜•, [web\_accessible\_resource](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) ìƒíƒœ.
* **ì½˜í…ì¸  ë³´ì•ˆ ì •ì±… (CSP) ë¶„ì„ ë° ìš°íšŒ í™•ì¸ê¸°**: í™•ì¥ í”„ë¡œê·¸ë¨ì˜ CSPì˜ ì·¨ì•½ì ì„ ì§€ì í•˜ê³  í—ˆìš©ëœ CDNs ë“±ìœ¼ë¡œ ì¸í•´ CSPë¥¼ ìš°íšŒí•  ìˆ˜ ìˆëŠ” ì ì¬ì ì¸ ë°©ë²•ì„ ë°í˜€ëƒ…ë‹ˆë‹¤.
* **ì•Œë ¤ì§„ ì·¨ì•½í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬**: [Retire.js](https://retirejs.github.io/retire.js/)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•Œë ¤ì§„ ì·¨ì•½í•œ JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì‚¬ìš©ì„ í™•ì¸í•©ë‹ˆë‹¤.
* í™•ì¥ í”„ë¡œê·¸ë¨ ë° í˜•ì‹í™”ëœ ë²„ì „ ë‹¤ìš´ë¡œë“œ.
* ì›ë³¸ í™•ì¥ í”„ë¡œê·¸ë¨ ë‹¤ìš´ë¡œë“œ.
* í™•ì¥ í”„ë¡œê·¸ë¨ì˜ í˜•ì‹í™”ëœ ë²„ì „ ë‹¤ìš´ë¡œë“œ (ìë™ìœ¼ë¡œ ì˜ˆì˜ê²Œ ì •ë¦¬ëœ HTML ë° JavaScript).
* ìŠ¤ìº” ê²°ê³¼ì˜ ìë™ ìºì‹±, í™•ì¥ í”„ë¡œê·¸ë¨ ìŠ¤ìº”ì„ ì‹¤í–‰í•˜ëŠ” ë° ì²˜ìŒì—ëŠ” ë§ì€ ì‹œê°„ì´ ê±¸ë¦¬ì§€ë§Œ ë‘ ë²ˆì§¸ë¡œ ì‹¤í–‰í•  ë•Œ, í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì€ ê²½ìš° ê²°ê³¼ê°€ ìºì‹œë˜ì–´ ê±°ì˜ ì¦‰ì‹œ ì‹¤í–‰ë©ë‹ˆë‹¤.
* ë§í¬ ê°€ëŠ¥í•œ ë³´ê³ ì„œ URL, tarnishì— ì˜í•´ ìƒì„±ëœ í™•ì¥ í”„ë¡œê·¸ë¨ ë³´ê³ ì„œë¥¼ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì‰½ê²Œ ë§í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### [Neto](https://github.com/elevenpaths/neto)

í”„ë¡œì íŠ¸ NetoëŠ” Firefox ë° Chromeê³¼ ê°™ì€ ì˜ ì•Œë ¤ì§„ ë¸Œë¼ìš°ì €ìš© ë¸Œë¼ìš°ì € í”ŒëŸ¬ê·¸ì¸ ë° í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ìˆ¨ê²¨ì§„ ê¸°ëŠ¥ì„ ë¶„ì„í•˜ê³  í•´ë…í•˜ê¸° ìœ„í•´ ê³ ì•ˆëœ Python 3 íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤. ì´ëŠ” íŒ¨í‚¤ì§€ëœ íŒŒì¼ì„ ì••ì¶• í•´ì œí•˜ì—¬ `manifest.json`, ë¡œì»¬ë¼ì´ì œì´ì…˜ í´ë” ë˜ëŠ” Javascript ë° HTML ì†ŒìŠ¤ íŒŒì¼ê³¼ ê°™ì€ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ê´€ë ¨ ë¦¬ì†ŒìŠ¤ì—ì„œ ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ì¶”ì¶œí•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ìë™í™”í•©ë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ

* ì´ ë°©ë²•ë¡ ì— ëŒ€í•œ ë„ì›€ì„ ì¤€ [**@naivenom**](https://twitter.com/naivenom)ì—ê²Œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)
* [https://palant.info/2022/08/10/anatomy-of-a-basic-extension/](https://palant.info/2022/08/10/anatomy-of-a-basic-extension/)
* [https://palant.info/2022/08/24/attack-surface-of-extension-pages/](https://palant.info/2022/08/24/attack-surface-of-extension-pages/)
* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://help.passbolt.com/assets/files/PBL-02-report.pdf](https://help.passbolt.com/assets/files/PBL-02-report.pdf)
* [https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts)
* [https://developer.chrome.com/docs/extensions/mv2/background-pages](https://developer.chrome.com/docs/extensions/mv2/background-pages)
* [https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/](https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/)
* [https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0](https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œë¶€í„° AWS í•´í‚¹ì„ ì „ë¬¸ê°€ë¡œ ë°°ìš°ì„¸ìš”</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:
* **HackTricks**ì—ì„œ íšŒì‚¬ ê´‘ê³ ë¥¼ ë³´ê±°ë‚˜ **PDF í˜•ì‹ì˜ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks êµ¿ì¦ˆ**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”.
* [**PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ì €í¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì— ê°€ì…í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.
