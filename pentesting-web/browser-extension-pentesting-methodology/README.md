# Metodologia testowania penetracyjnego rozszerzeÅ„ przeglÄ…darki

<details>

<summary><strong>Zacznij od zera i staÅ„ siÄ™ ekspertem od hakowania AWS dziÄ™ki</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

## Podstawowe informacje

Rozszerzenia przeglÄ…darki sÄ… napisane w JavaScript i sÄ… Å‚adowane przez przeglÄ…darkÄ™ w tle. PosiadajÄ… swoje [DOM](https://www.w3schools.com/js/js\_htmldom.asp), ale mogÄ… wspÃ³Å‚dziaÅ‚aÄ‡ z DOM-ami innych stron. Oznacza to, Å¼e mogÄ… naruszaÄ‡ poufnoÅ›Ä‡, integralnoÅ›Ä‡ i dostÄ™pnoÅ›Ä‡ innych stron (CIA).

## GÅ‚Ã³wne skÅ‚adniki

UkÅ‚ady rozszerzeÅ„ prezentujÄ… siÄ™ najlepiej, gdy sÄ… wizualizowane i skÅ‚adajÄ… siÄ™ z trzech skÅ‚adnikÃ³w. Przyjrzyjmy siÄ™ kaÅ¼demu skÅ‚adnikowi dokÅ‚adniej.

<figure><img src="../../.gitbook/assets/image (13).png" alt=""><figcaption><p><a href="http://webblaze.cs.berkeley.edu/papers/Extensions.pdf">http://webblaze.cs.berkeley.edu/papers/Extensions.pdf</a></p></figcaption></figure>

### **Skrypty zawartoÅ›ci**

KaÅ¼dy skrypt zawartoÅ›ci ma bezpoÅ›redni dostÄ™p do DOM **jednej strony internetowej** i jest tym samym naraÅ¼ony na **potencjalnie zÅ‚oÅ›liwe dane wejÅ›ciowe**. Jednak skrypt zawartoÅ›ci nie posiada uprawnieÅ„ poza moÅ¼liwoÅ›ciÄ… wysyÅ‚ania wiadomoÅ›ci do rdzenia rozszerzenia.

### **RdzeÅ„ rozszerzenia**

RdzeÅ„ rozszerzenia zawiera wiÄ™kszoÅ›Ä‡ uprawnieÅ„/dostÄ™pu rozszerzenia, ale rdzeÅ„ rozszerzenia moÅ¼e wspÃ³Å‚dziaÅ‚aÄ‡ z zawartoÅ›ciÄ… internetowÄ… tylko za pomocÄ… [XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest) i skryptÃ³w zawartoÅ›ci. Ponadto rdzeÅ„ rozszerzenia nie ma bezpoÅ›redniego dostÄ™pu do maszyny hosta.

### **Binarny natywny**

Rozszerzenie pozwala na binarny plik natywny, ktÃ³ry moÅ¼e **uzyskaÄ‡ dostÄ™p do maszyny hosta z peÅ‚nymi uprawnieniami uÅ¼ytkownika**. Binarny plik natywny wspÃ³Å‚dziaÅ‚a z rdzeniem rozszerzenia za pomocÄ… standardowego interfejsu programowania aplikacji wtyczek Netscape ([NPAPI](https://en.wikipedia.org/wiki/NPAPI)) uÅ¼ywanego przez Flash i inne wtyczki przeglÄ…darki.

### Granice

{% hint style="danger" %}
Aby uzyskaÄ‡ peÅ‚ne uprawnienia uÅ¼ytkownika, atakujÄ…cy musi przekonaÄ‡ rozszerzenie do przekazania zÅ‚oÅ›liwych danych wejÅ›ciowych ze skryptu zawartoÅ›ci do rdzenia rozszerzenia oraz z rdzenia rozszerzenia do binarnego pliku natywnego.
{% endhint %}

KaÅ¼dy skÅ‚adnik rozszerzenia jest odseparowany od siebie za pomocÄ… **silnych granic ochronnych**. KaÅ¼dy skÅ‚adnik dziaÅ‚a w **oddzielnym procesie systemu operacyjnego**. Skrypty zawartoÅ›ci i rdzenie rozszerzeÅ„ dziaÅ‚ajÄ… w **procesach piaskownicy** niedostÄ™pnych dla wiÄ™kszoÅ›ci usÅ‚ug systemu operacyjnego.

Co wiÄ™cej, skrypty zawartoÅ›ci oddzielone sÄ… od powiÄ…zanych stron internetowych poprzez **dziaÅ‚anie w oddzielnej stercie JavaScript**. Skrypt zawartoÅ›ci i strona internetowa majÄ… **dostÄ™p do tego samego DOM**, ale **nigdy nie wymieniajÄ… wskaÅºnikÃ³w JavaScript**, co zapobiega wyciekowi funkcjonalnoÅ›ci JavaScript.

## **`manifest.json`**

Rozszerzenie Chrome to po prostu folder ZIP z rozszerzeniem [.crx](https://www.lifewire.com/crx-file-2620391). RdzeÅ„ rozszerzenia to plik **`manifest.json`** znajdujÄ…cy siÄ™ w gÅ‚Ã³wnym katalogu, ktÃ³ry okreÅ›la ukÅ‚ad, uprawnienia i inne opcje konfiguracyjne.

PrzykÅ‚ad:
```json
{
"manifest_version": 2,
"name": "My extension",
"version": "1.0",
"permissions": [
"storage"
],
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
"background": {
"scripts": [
"background.js"
]
},
"options_ui": {
"page": "options.html"
}
}
```
### `content_scripts`

Skrypty zawartoÅ›ci sÄ… **Å‚adowane** za kaÅ¼dym razem, gdy uÅ¼ytkownik **przechodzi do pasujÄ…cej strony**, w naszym przypadku do dowolnej strony pasujÄ…cej do wyraÅ¼enia **`https://example.com/*`** i nie pasujÄ…cej do wyraÅ¼enia **`*://*/*/business*`**. WykonujÄ… siÄ™ **jak wÅ‚asne skrypty strony** i majÄ… arbitralny dostÄ™p do [Modelu Obiektowego Dokumentu (DOM)](https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model) strony.
```json
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
```
Aby uwzglÄ™dniÄ‡ lub wykluczyÄ‡ wiÄ™cej adresÃ³w URL, moÅ¼na rÃ³wnieÅ¼ uÅ¼yÄ‡ **`include_globs`** i **`exclude_globs`**.

To przykÅ‚adowy skrypt zawartoÅ›ci, ktÃ³ry doda przycisk wyjaÅ›nienia na stronie, gdy [interfejs API przechowywania](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) do pobrania wartoÅ›ci `message` z pamiÄ™ci rozszerzenia.
```js
chrome.storage.local.get("message", result =>
{
let div = document.createElement("div");
div.innerHTML = result.message + " <button>Explain</button>";
div.querySelector("button").addEventListener("click", () =>
{
chrome.runtime.sendMessage("explain");
});
document.body.appendChild(div);
});
```
<figure><img src="../../.gitbook/assets/image (20).png" alt=""><figcaption></figcaption></figure>

Po klikniÄ™ciu tego przycisku skrypt zawartoÅ›ci wysyÅ‚a wiadomoÅ›Ä‡ do stron rozszerzenia za pomocÄ… [**API runtime.sendMessage()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage). Wynika to z ograniczenia skryptu zawartoÅ›ci w bezpoÅ›rednim dostÄ™pie do interfejsÃ³w API, przy czym `storage` naleÅ¼y do nielicznych wyjÄ…tkÃ³w. Dla funkcji poza tymi wyjÄ…tkami, wiadomoÅ›ci sÄ… wysyÅ‚ane do stron rozszerzenia, z ktÃ³rymi skrypty zawartoÅ›ci mogÄ… siÄ™ komunikowaÄ‡.

{% hint style="warning" %}
W zaleÅ¼noÅ›ci od przeglÄ…darki, moÅ¼liwoÅ›ci skryptu zawartoÅ›ci mogÄ… siÄ™ nieznacznie rÃ³Å¼niÄ‡. Dla przeglÄ…darek opartych na Chromium, lista moÅ¼liwoÅ›ci jest dostÄ™pna w [dokumentacji Chrome Developers](https://developer.chrome.com/docs/extensions/mv3/content_scripts/#capabilities), a dla Firefoksa, [MDN](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts#webextension_apis) sÅ‚uÅ¼y jako gÅ‚Ã³wne ÅºrÃ³dÅ‚o informacji.\
Warto rÃ³wnieÅ¼ zauwaÅ¼yÄ‡, Å¼e skrypty zawartoÅ›ci majÄ… zdolnoÅ›Ä‡ do komunikacji z skryptami tÅ‚a, umoÅ¼liwiajÄ…c im wykonywanie dziaÅ‚aÅ„ i przekazywanie odpowiedzi.
{% endhint %}

Aby wyÅ›wietliÄ‡ i debugowaÄ‡ skrypty zawartoÅ›ci w Chrome, menu narzÄ™dzi deweloperskich Chrome moÅ¼na uzyskaÄ‡, przechodzÄ…c do Opcje > WiÄ™cej narzÄ™dzi > NarzÄ™dzia deweloperskie LUB naciskajÄ…c Ctrl + Shift + I.

Po wyÅ›wietleniu narzÄ™dzi deweloperskich, naleÅ¼y kliknÄ…Ä‡ zakÅ‚adkÄ™ **Å¹rÃ³dÅ‚o**, a nastÄ™pnie zakÅ‚adkÄ™ **Skrypty zawartoÅ›ci**. Pozwala to na obserwacjÄ™ dziaÅ‚ajÄ…cych skryptÃ³w zawartoÅ›ci z rÃ³Å¼nych rozszerzeÅ„ oraz ustawianie punktÃ³w przerwania w celu Å›ledzenia przepÅ‚ywu wykonania.

### WstrzykniÄ™te skrypty zawartoÅ›ci

{% hint style="success" %}
ZauwaÅ¼, Å¼e **Skrypty zawartoÅ›ci nie sÄ… obowiÄ…zkowe**, poniewaÅ¼ istnieje rÃ³wnieÅ¼ moÅ¼liwoÅ›Ä‡ **dynamicznego** **wstrzykiwania** skryptÃ³w i **programowego wstrzykiwania** ich na strony internetowe za pomocÄ… **`tabs.executeScript`**. Zapewnia to faktycznie wiÄ™kszÄ… **kontrolÄ™ granularnÄ…**.
{% endhint %}

Aby programowo wstrzyknÄ…Ä‡ skrypt zawartoÅ›ci, konieczne jest, aby rozszerzenie miaÅ‚o [uprawnienia hosta](https://developer.chrome.com/docs/extensions/reference/permissions) dla strony, do ktÃ³rej majÄ… byÄ‡ wstrzykiwane skrypty. Uprawnienia te moÅ¼na zabezpieczyÄ‡ poprzez **Å¼Ä…danie ich** w manifeÅ›cie rozszerzenia lub tymczasowo za pomocÄ… [**activeTab**](https://developer.chrome.com/docs/extensions/reference/manifest/activeTab).

#### PrzykÅ‚adowe rozszerzenie oparte na activeTab

{% code title="manifest.json" %}
```json
{
"name": "My extension",
...
"permissions": [
"activeTab",
"scripting"
],
"background": {
"service_worker": "background.js"
},
"action": {
"default_title": "Action Button"
}
}
```
{% endcode %}

* **WstrzykniÄ™cie pliku JS po klikniÄ™ciu:**
```javascript
// content-script.js
document.body.style.backgroundColor = "orange";

//service-worker.js - Inject the JS file
chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target: { tabId: tab.id },
files: ["content-script.js"]
});
});
```
* **WstrzykniÄ™cie funkcji** po klikniÄ™ciu:
```javascript
//service-worker.js - Inject a function
function injectedFunction() {
document.body.style.backgroundColor = "orange";
}

chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target : {tabId : tab.id},
func : injectedFunction,
});
});
```
#### PrzykÅ‚ad z uprawnieniami skryptÃ³w
```javascript
// service-workser.js
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
excludeMatches : [ "*://*/*business*" ],
js : [ "contentScript.js" ],
}]);

// Another example
chrome.tabs.executeScript(tabId, { file: "content_script.js" });
```
Aby uwzglÄ™dniÄ‡ lub wykluczyÄ‡ wiÄ™cej adresÃ³w URL, moÅ¼na rÃ³wnieÅ¼ uÅ¼yÄ‡ **`include_globs`** i **`exclude_globs`**.

### Skrypty zawartoÅ›ci `run_at`

Pole `run_at` kontroluje **kiedy pliki JavaScript sÄ… wstrzykiwane do strony internetowej**. Preferowana i domyÅ›lna wartoÅ›Ä‡ to `"document_idle"`.

MoÅ¼liwe wartoÅ›ci to:

* **`document_idle`**: Kiedykolwiek to moÅ¼liwe
* **`document_start`**: Po plikach z `css`, ale przed zbudowaniem jakiegokolwiek innego DOM lub uruchomieniem jakiegokolwiek innego skryptu.
* **`document_end`**: Natychmiast po zakoÅ„czeniu budowy DOM, ale przed zaÅ‚adowaniem zasobÃ³w podrzÄ™dnych, takich jak obrazy i ramki.

#### Przez `manifest.json`
```json
{
"name": "My extension",
...
"content_scripts": [
{
"matches": ["https://*.example.com/*"],
"run_at": "document_idle",
"js": ["contentScript.js"]
}
],
...
}

```
Poprzez **`service-worker.js`**
```javascript
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
runAt : "document_idle",
js : [ "contentScript.js" ],
}]);
```
### `tÅ‚o`

WiadomoÅ›ci wysyÅ‚ane przez skrypty zawartoÅ›ci sÄ… odbierane przez **stronÄ™ tÅ‚a**, ktÃ³ra peÅ‚ni centralnÄ… rolÄ™ w koordynowaniu komponentÃ³w rozszerzenia. Strona tÅ‚a utrzymuje siÄ™ przez caÅ‚y okres istnienia rozszerzenia, dziaÅ‚a dyskretnie bez bezpoÅ›redniej interakcji uÅ¼ytkownika. Posiada wÅ‚asny Model Obiektowy Dokumentu (DOM), umoÅ¼liwiajÄ…cy kompleksowe interakcje i zarzÄ…dzanie stanem.

**Kluczowe punkty**:

* **Rola Strony TÅ‚a:** DziaÅ‚a jako centrum nerwowe rozszerzenia, zapewniajÄ…c komunikacjÄ™ i koordynacjÄ™ miÄ™dzy rÃ³Å¼nymi czÄ™Å›ciami rozszerzenia.
* **TrwaÅ‚oÅ›Ä‡:** Jest to zawsze obecna jednostka, niewidoczna dla uÅ¼ytkownika, ale integralna dla funkcjonalnoÅ›ci rozszerzenia.
* **Automatyczne Generowanie:** JeÅ›li nie jest jawnie zdefiniowana, przeglÄ…darka automatycznie utworzy stronÄ™ tÅ‚a. Ta automatycznie generowana strona bÄ™dzie zawieraÄ‡ wszystkie skrypty tÅ‚a okreÅ›lone w manifeÅ›cie rozszerzenia, zapewniajÄ…c bezproblemowÄ… pracÄ™ zadaÅ„ tÅ‚a rozszerzenia.

{% hint style="success" %}
WygodÄ™ zapewnianÄ… przez przeglÄ…darkÄ™ poprzez automatyczne generowanie strony tÅ‚a (gdy nie jest jawnie zadeklarowana) zapewnia, Å¼e wszystkie niezbÄ™dne skrypty tÅ‚a sÄ… zintegrowane i dziaÅ‚ajÄ…, usprawniajÄ…c proces konfiguracji rozszerzenia.
{% endhint %}

PrzykÅ‚adowy skrypt tÅ‚a:
```js
chrome.runtime.onMessage.addListener((request, sender, sendResponse) =>
{
if (request == "explain")
{
chrome.tabs.create({ url: "https://example.net/explanation" });
}
})
```
Wykorzystuje [API runtime.onMessage](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage), aby nasÅ‚uchiwaÄ‡ wiadomoÅ›ci. Gdy otrzyma wiadomoÅ›Ä‡ `"explain"`, uÅ¼ywa [API tabs](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs), aby otworzyÄ‡ stronÄ™ w nowej karcie.

Aby debugowaÄ‡ skrypt tÅ‚a, przejdÅº do **szczegÃ³Å‚Ã³w rozszerzenia i zbadaj serwis workera**, co otworzy narzÄ™dzia deweloperskie z skryptem tÅ‚a:

<figure><img src="https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/browser-extension-pentesting-methodology/broken-reference" alt=""><figcaption></figcaption></figure>

### Strony opcji i inne

Rozszerzenia przeglÄ…darki mogÄ… zawieraÄ‡ rÃ³Å¼ne rodzaje stron:

* **Strony akcji** sÄ… wyÅ›wietlane w **rozwijanym menu po klikniÄ™ciu ikony rozszerzenia**.
* Strony, ktÃ³re rozszerzenie **zaÅ‚aduje w nowej karcie**.
* **Strony opcji**: Ta strona wyÅ›wietla siÄ™ na wierzchu rozszerzenia po klikniÄ™ciu. W poprzednim manifeÅ›cie w moim przypadku mogÅ‚em uzyskaÄ‡ dostÄ™p do tej strony pod adresem `chrome://extensions/?options=fadlhnelkbeojnebcbkacjilhnbjfjca` lub klikajÄ…c:

<figure><img src="../../.gitbook/assets/image (21).png" alt="" width="375"><figcaption></figcaption></figure>

ZauwaÅ¼, Å¼e te strony nie sÄ… trwaÅ‚e jak strony tÅ‚a, poniewaÅ¼ dynamicznie Å‚adowane sÄ… treÅ›ci w razie potrzeby. Mimo to, dzielÄ… pewne moÅ¼liwoÅ›ci z stronÄ… tÅ‚a:

* **Komunikacja z skryptami zawartoÅ›ci:** Podobnie jak strona tÅ‚a, te strony mogÄ… otrzymywaÄ‡ wiadomoÅ›ci od skryptÃ³w zawartoÅ›ci, uÅ‚atwiajÄ…c interakcjÄ™ wewnÄ…trz rozszerzenia.
* **DostÄ™p do API specyficznych dla rozszerzenia:** Te strony majÄ… peÅ‚ny dostÄ™p do API specyficznych dla rozszerzenia, zgodnie z uprawnieniami zdefiniowanymi dla rozszerzenia.

### `permissions` i `host_permissions`

**`permissions`** i **`host_permissions`** to wpisy z pliku `manifest.json`, ktÃ³re wskazujÄ…, **jakie uprawnienia** ma rozszerzenie przeglÄ…darki (np. przechowywanie, lokalizacja...) i na **ktÃ³rych stronach internetowych**.

PoniewaÅ¼ rozszerzenia przeglÄ…darki mogÄ… byÄ‡ tak **uprzywilejowane**, zÅ‚oÅ›liwe lub skompromitowane mogÄ… umoÅ¼liwiÄ‡ atakujÄ…cemu **rÃ³Å¼ne sposoby kradzieÅ¼y wraÅ¼liwych informacji i szpiegowania uÅ¼ytkownika**.

SprawdÅº, jak dziaÅ‚ajÄ… te ustawienia i jak mogÄ… byÄ‡ wykorzystane w:

{% content-ref url="browext-permissions-and-host_permissions.md" %}
[browext-permissions-and-host\_permissions.md](browext-permissions-and-host\_permissions.md)
{% endcontent-ref %}

### `content_security_policy`

Polityka bezpieczeÅ„stwa treÅ›ci moÅ¼e byÄ‡ zadeklarowana rÃ³wnieÅ¼ w pliku `manifest.json`. JeÅ›li jest zdefiniowana, moÅ¼e byÄ‡ **podatna**.

DomyÅ›lne ustawienie dla stron rozszerzenia przeglÄ…darki jest raczej restrykcyjne:
```bash
script-src 'self'; object-src 'self';
```
Dla wiÄ™cej informacji na temat CSP i potencjalnych bypassÃ³w sprawdÅº:

{% content-ref url="../content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../content-security-policy-csp-bypass/)
{% endcontent-ref %}

### `web_accessible_resources`

aby strona internetowa mogÅ‚a uzyskaÄ‡ dostÄ™p do strony Rozszerzenia PrzeglÄ…darki, na przykÅ‚ad pliku `.html`, ta strona musi byÄ‡ wymieniona w polu **`web_accessible_resources`** pliku `manifest.json`.\
Na przykÅ‚ad:
```javascript
{
...
"web_accessible_resources": [
{
"resources": [ "images/*.png" ],
"matches": [ "https://example.com/*" ]
},
{
"resources": [ "fonts/*.woff" ],
"matches": [ "https://example.com/*" ]
}
],
...
}
```
Te strony sÄ… dostÄ™pne pod adresem URL:
```
chrome-extension://<extension-id>/message.html
```
W publicznych rozszerzeniach **identyfikator rozszerzenia jest dostÄ™pny**:

<figure><img src="../../.gitbook/assets/image (1191).png" alt="" width="375"><figcaption></figcaption></figure>

JednakÅ¼e, jeÅ›li uÅ¼ywany jest parametr `manifest.json` **`use_dynamic_url`**, ten **identyfikator moÅ¼e byÄ‡ dynamiczny**.

Zezwolenie na dostÄ™p do tych stron sprawia, Å¼e sÄ… one **potencjalnie podatne na ataki ClickJacking**:

{% content-ref url="browext-clickjacking.md" %}
[browext-clickjacking.md](browext-clickjacking.md)
{% endcontent-ref %}

{% hint style="success" %}
Zezwolenie na Å‚adowanie tych stron tylko przez rozszerzenie, a nie przez losowe adresy URL, moÅ¼e zapobiec atakom CLickJacking.
{% endhint %}

### `externally_connectable`

Zgodnie z [**dokumentacjÄ…**](https://developer.chrome.com/docs/extensions/reference/manifest/externally-connectable), WÅ‚aÅ›ciwoÅ›Ä‡ manifestu `"externally_connectable"` deklaruje, **ktÃ³re rozszerzenia i strony internetowe mogÄ… siÄ™ poÅ‚Ä…czyÄ‡** z Twoim rozszerzeniem za pomocÄ… [runtime.connect](https://developer.chrome.com/docs/extensions/reference/runtime#method-connect) i [runtime.sendMessage](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage).

* JeÅ›li klucz **`externally_connectable`** nie jest zadeklarowany w manifeÅ›cie Twojego rozszerzenia lub jest zadeklarowany jako **`"ids": ["*"]`**, **wszystkie rozszerzenia mogÄ… siÄ™ poÅ‚Ä…czyÄ‡, ale Å¼adna strona internetowa nie moÅ¼e**.
* JeÅ›li sÄ… **okreÅ›lone konkretne identyfikatory**, jak w `"ids": ["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"]`, **tylko te aplikacje** mogÄ… siÄ™ poÅ‚Ä…czyÄ‡.
* JeÅ›li sÄ… **okreÅ›lone dopasowania**, te aplikacje internetowe bÄ™dÄ… mogÅ‚y siÄ™ poÅ‚Ä…czyÄ‡:
```json
"matches": [
"https://*.google.com/*",
"*://*.chromium.org/*",
```
* JeÅ›li jest okreÅ›lone jako puste: **`"externally_connectable": {}`**, Å¼adna aplikacja ani strona internetowa nie bÄ™dzie mogÅ‚a siÄ™ poÅ‚Ä…czyÄ‡.

Im mniej rozszerzeÅ„ i adresÃ³w URL wskazanych tutaj, tym mniejsza bÄ™dzie powierzchnia ataku.

{% hint style="danger" %}
JeÅ›li strona internetowa podatna na XSS lub przejÄ™cie jest wskazana w **`externally_connectable`**, atakujÄ…cy bÄ™dzie mÃ³gÅ‚ **wysyÅ‚aÄ‡ wiadomoÅ›ci bezpoÅ›rednio do skryptu tÅ‚a**, caÅ‚kowicie omijajÄ…c Skrypt ZawartoÅ›ci i jego CSP.

Dlatego jest to **bardzo potÄ™Å¼ne obejÅ›cie**.

Co wiÄ™cej, jeÅ›li klient zainstaluje zÅ‚oÅ›liwe rozszerzenie, nawet jeÅ›li nie jest ono zezwolone na komunikacjÄ™ z podatnym rozszerzeniem, moÅ¼e wstrzyknÄ…Ä‡ dane XSS na dozwolonej stronie internetowej lub naduÅ¼yÄ‡ interfejsÃ³w API **`WebRequest`** lub **`DeclarativeNetRequest`** do manipulowania Å¼Ä…daniami na domenie docelowej, zmieniajÄ…c Å¼Ä…danie strony dla pliku **JavaScript**. (NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e CSP na stronie docelowej moÅ¼e zapobiec tym atakom). Ten pomysÅ‚ pochodzi [**z tego opisu**](https://www.darkrelay.com/post/opera-zero-day-rce-vulnerability).
{% endhint %}

##

## Komunikacja miÄ™dzy Skryptem ZawartoÅ›ci a stronÄ… internetowÄ…

Åšrodowiska, w ktÃ³rych dziaÅ‚ajÄ… **skrypty zawartoÅ›ci** i gdzie istniejÄ… strony hosta, sÄ… od siebie **oddzielone**, zapewniajÄ…c **izolacjÄ™**. Pomimo tej izolacji, obie strony majÄ… moÅ¼liwoÅ›Ä‡ interakcji z **Model Obiektu Dokumentu (DOM)** strony, wspÃ³lnego zasobu. Aby strona hosta mogÅ‚a komunikowaÄ‡ siÄ™ ze **skryptem zawartoÅ›ci**, lub poÅ›rednio z rozszerzeniem poprzez skrypt zawartoÅ›ci, konieczne jest wykorzystanie **DOM**, ktÃ³ry jest dostÄ™pny dla obu stron jako kanaÅ‚ komunikacji.

### WiadomoÅ›ci Post

{% code title="content-script.js" %}
```javascript
var port = chrome.runtime.connect();

window.addEventListener("message", (event) => {
// We only accept messages from ourselves
if (event.source !== window) {
return;
}

if (event.data.type && (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
port.postMessage(event.data.text);
}
}, false);
```
{% endcode %}

{% code title="example.js" %}
```javascript
document.getElementById("theButton").addEventListener("click", () => {
window.postMessage(
{type : "FROM_PAGE", text : "Hello from the webpage!"}, "*");
}, false);
```
{% endcode %}

Bezpieczna komunikacja Post Message powinna sprawdzaÄ‡ autentycznoÅ›Ä‡ otrzymanej wiadomoÅ›ci, moÅ¼na to zrobiÄ‡ sprawdzajÄ…c:

* **`event.isTrusted`**: Jest to prawdziwe tylko wtedy, gdy zdarzenie zostaÅ‚o wywoÅ‚ane przez akcjÄ™ uÅ¼ytkownika.
* Skrypt zawartoÅ›ci moÅ¼e oczekiwaÄ‡ wiadomoÅ›ci tylko wtedy, gdy uÅ¼ytkownik wykonuje jakÄ…Å› akcjÄ™.
* **Domena pochodzenia**: moÅ¼e oczekiwaÄ‡ wiadomoÅ›ci tylko z listy zaufanych domen.
* JeÅ›li uÅ¼ywany jest regex, naleÅ¼y byÄ‡ bardzo ostroÅ¼nym.
* **Å¹rÃ³dÅ‚o**: `received_message.source !== window` moÅ¼na uÅ¼yÄ‡ do sprawdzenia, czy wiadomoÅ›Ä‡ pochodzi **z tego samego okna**, w ktÃ³rym nasÅ‚uchuje Skrypt ZawartoÅ›ci.

Poprzednie sprawdzenia, nawet jeÅ›li wykonane, mogÄ… byÄ‡ podatne na ataki, wiÄ™c sprawdÅº na nastÄ™pnej stronie **potencjalne sposoby obejÅ›cia Post Message**:

{% content-ref url="../postmessage-vulnerabilities/" %}
[postmessage-vulnerabilities](../postmessage-vulnerabilities/)
{% endcontent-ref %}

### Iframe

InnÄ… moÅ¼liwÄ… drogÄ… komunikacji moÅ¼e byÄ‡ poprzez **adresy URL ramek (Iframe URLs)**, przykÅ‚ad moÅ¼na znaleÅºÄ‡ w:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

### DOM

To nie jest "dokÅ‚adnie" sposÃ³b komunikacji, ale **strona internetowa i skrypt zawartoÅ›ci bÄ™dÄ… miaÅ‚y dostÄ™p do DOM strony internetowej**. Dlatego jeÅ›li **skrypt zawartoÅ›ci** odczytuje jakieÅ› informacje z niego, **ufajÄ…c DOM-owi strony internetowej**, strona internetowa mogÅ‚aby **zmodyfikowaÄ‡ te dane** (poniewaÅ¼ strona internetowa nie powinna byÄ‡ ufaÅ‚a, lub poniewaÅ¼ strona internetowa jest podatna na XSS) i **naraÅ¼aÄ‡ Skrypt ZawartoÅ›ci**.

MoÅ¼na rÃ³wnieÅ¼ znaleÅºÄ‡ przykÅ‚ad **opartego na DOM XSS w celu naruszenia rozszerzenia przeglÄ…darki** w:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## WraÅ¼liwe Informacje w PamiÄ™ci/Kodzie

JeÅ›li Rozszerzenie PrzeglÄ…darki przechowuje **wraÅ¼liwe informacje w swojej pamiÄ™ci**, mogÄ… one zostaÄ‡ **wydobyte** (szczegÃ³lnie na maszynach z systemem Windows) i **przeszukane** w poszukiwaniu tych informacji.

Dlatego pamiÄ™Ä‡ Rozszerzenia PrzeglÄ…darki **nie powinna byÄ‡ uwaÅ¼ana za bezpiecznÄ…**, a **wraÅ¼liwe informacje** takie jak dane uwierzytelniajÄ…ce czy frazy mnemoniczne **nie powinny byÄ‡ przechowywane**.

OczywiÅ›cie, **nie umieszczaj wraÅ¼liwych informacji w kodzie**, poniewaÅ¼ bÄ™dÄ… one **publiczne**.

## Komunikacja Skryptu ZawartoÅ›ci **â†”ï¸** Skryptu TÅ‚a

Skrypt ZawartoÅ›ci moÅ¼e uÅ¼yÄ‡ funkcji [**runtime.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) **lub** [**tabs.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/tabs#method-sendMessage) do wysÅ‚ania **jednorazowej wiadomoÅ›ci serializowalnej w formacie JSON**.

Aby obsÅ‚uÅ¼yÄ‡ **odpowiedÅº**, uÅ¼yj zwrÃ³conego **Promise**. ChociaÅ¼, dla zachowania kompatybilnoÅ›ci wstecznej, nadal moÅ¼na przekazaÄ‡ **wywoÅ‚anie zwrotne** jako ostatni argument.

WysÅ‚anie Å¼Ä…dania z **skryptu zawartoÅ›ci** wyglÄ…da nastÄ™pujÄ…co:
```javascript
(async () => {
const response = await chrome.runtime.sendMessage({greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
WysyÅ‚anie Å¼Ä…dania z **rozszerzenia** (zwykle z **skryptu tÅ‚a**) Skrypt zawartoÅ›ci moÅ¼e korzystaÄ‡ z funkcji, z wyjÄ…tkiem koniecznoÅ›ci okreÅ›lenia, do ktÃ³rego karty ma zostaÄ‡ wysÅ‚ane. PrzykÅ‚ad, jak wysÅ‚aÄ‡ wiadomoÅ›Ä‡ do skryptu zawartoÅ›ci w wybranej karcie:
```javascript
// From https://stackoverflow.com/questions/36153999/how-to-send-a-message-between-chrome-extension-popup-and-content-script
(async () => {
const [tab] = await chrome.tabs.query({active: true, lastFocusedWindow: true});
const response = await chrome.tabs.sendMessage(tab.id, {greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
Na **koÅ„cu odbiorczym**, musisz skonfigurowaÄ‡ nasÅ‚uchiwanie zdarzenia [**runtime.onMessage**](https://developer.chrome.com/docs/extensions/reference/runtime#event-onMessage) aby obsÅ‚uÅ¼yÄ‡ wiadomoÅ›Ä‡. WyglÄ…da to tak samo zarÃ³wno z treÅ›ciÄ… skryptu, jak i z stronÄ… rozszerzenia.
```javascript
// From https://stackoverflow.com/questions/70406787/javascript-send-message-from-content-js-to-background-js
chrome.runtime.onMessage.addListener(
function(request, sender, sendResponse) {
console.log(sender.tab ?
"from a content script:" + sender.tab.url :
"from the extension");
if (request.greeting === "hello")
sendResponse({farewell: "goodbye"});
}
);
```
W podanym przykÅ‚adzie **`sendResponse()`** zostaÅ‚o wykonane synchronicznie. Aby zmodyfikowaÄ‡ obsÅ‚ugÄ™ zdarzenia `onMessage` w celu asynchronicznego wykonania `sendResponse()`, konieczne jest dodanie `return true;`.

WaÅ¼nym aspektem jest to, Å¼e w przypadkach, gdy wiele stron jest ustawionych do odbierania zdarzeÅ„ `onMessage`, **pierwsza strona wykonujÄ…ca `sendResponse()`** dla okreÅ›lonego zdarzenia bÄ™dzie jedynÄ… zdolnÄ… skutecznie dostarczyÄ‡ odpowiedÅº. Wszelkie kolejne odpowiedzi na to samo zdarzenie nie bÄ™dÄ… brane pod uwagÄ™.

Podczas tworzenia nowych rozszerzeÅ„, naleÅ¼y preferowaÄ‡ obietnice (promises) zamiast wywoÅ‚aÅ„ zwrotnych. W odniesieniu do uÅ¼ycia wywoÅ‚aÅ„ zwrotnych, funkcja `sendResponse()` jest uwaÅ¼ana za waÅ¼nÄ… tylko wtedy, gdy jest wykonywana bezpoÅ›rednio w kontekÅ›cie synchronicznym, lub jeÅ›li obsÅ‚uga zdarzenia wskazuje na operacjÄ™ asynchronicznÄ… poprzez zwrÃ³cenie `true`. JeÅ›li Å¼aden z obsÅ‚ugujÄ…cych nie zwrÃ³ci `true` lub jeÅ›li funkcja `sendResponse()` zostanie usuniÄ™ta z pamiÄ™ci (zebrana przez garbage collector), wywoÅ‚any zostanie domyÅ›lnie zwrotny wywoÅ‚anie zwiÄ…zane z funkcjÄ… `sendMessage()`.

## Åadowanie rozszerzenia w przeglÄ…darce

1. **Pobierz** rozszerzenie przeglÄ…darki i rozpakuj
2. PrzejdÅº do **`chrome://extensions/`** i **wÅ‚Ä…cz** `Tryb programisty`
3. Kliknij przycisk **`ZaÅ‚aduj rozpakowane`**

W **Firefoxie** przejdÅº do **`about:debugging#/runtime/this-firefox`** i kliknij przycisk **`ZaÅ‚aduj tymczasowe rozszerzenie`**.

## Pobieranie kodu ÅºrÃ³dÅ‚owego ze sklepu

Kod ÅºrÃ³dÅ‚owy rozszerzenia Chrome moÅ¼na uzyskaÄ‡ za pomocÄ… rÃ³Å¼nych metod. PoniÅ¼ej znajdujÄ… siÄ™ szczegÃ³Å‚owe wyjaÅ›nienia i instrukcje dla kaÅ¼dej opcji.

### Pobieranie rozszerzenia jako ZIP za pomocÄ… wiersza poleceÅ„

Kod ÅºrÃ³dÅ‚owy rozszerzenia Chrome moÅ¼na pobraÄ‡ jako plik ZIP za pomocÄ… wiersza poleceÅ„. Wymaga to uÅ¼ycia `curl` do pobrania pliku ZIP z okreÅ›lonego adresu URL, a nastÄ™pnie rozpakowania zawartoÅ›ci pliku ZIP do katalogu. Oto kroki:

1. ZastÄ…p `"extension_id"` rzeczywistym identyfikatorem rozszerzenia.
2. Wykonaj nastÄ™pujÄ…ce polecenia:
```bash
extension_id=your_extension_id   # Replace with the actual extension ID
curl -L -o "$extension_id.zip" "https://clients2.google.com/service/update2/crx?response=redirect&os=mac&arch=x86-64&nacl_arch=x86-64&prod=chromecrx&prodchannel=stable&prodversion=44.0.2403.130&x=id%3D$extension_id%26uc"
unzip -d "$extension_id-source" "$extension_id.zip"
```
### UÅ¼yj strony CRX Viewer

[https://robwu.nl/crxviewer/](https://robwu.nl/crxviewer/)

### UÅ¼yj rozszerzenia CRX Viewer

InnÄ… wygodnÄ… metodÄ… jest uÅ¼ycie przeglÄ…darki Chrome Extension Source Viewer, ktÃ³ry jest projektem open-source. MoÅ¼na go zainstalowaÄ‡ ze [Sklepu Chrome Web Store](https://chrome.google.com/webstore/detail/chrome-extension-source-v/jifpbeccnghkjeaalbbjmodiffmgedin?hl=en). Kod ÅºrÃ³dÅ‚owy przeglÄ…darki jest dostÄ™pny w [repozytorium GitHub](https://github.com/Rob--W/crxviewer).

### WyÅ›wietl ÅºrÃ³dÅ‚o lokalnie zainstalowanego rozszerzenia

Lokalnie zainstalowane rozszerzenia Chrome moÅ¼na rÃ³wnieÅ¼ sprawdziÄ‡. Oto jak:

1. OtwÃ³rz katalog profilu lokalnego Chrome, odwiedzajÄ…c `chrome://version/` i zlokalizuj pole "Profile Path".
2. PrzejdÅº do podfolderu `Extensions/` w katalogu profilu.
3. Ten folder zawiera wszystkie zainstalowane rozszerzenia, zazwyczaj z kodem ÅºrÃ³dÅ‚owym w czytelnej formie.

Aby zidentyfikowaÄ‡ rozszerzenia, moÅ¼na przyporzÄ…dkowaÄ‡ ich identyfikatory do nazw:

* WÅ‚Ä…cz tryb dewelopera na stronie `about:extensions`, aby zobaczyÄ‡ identyfikatory kaÅ¼dego rozszerzenia.
* W kaÅ¼dym folderze rozszerzenia plik `manifest.json` zawiera czytelnÄ… wartoÅ›Ä‡ pola `name`, co pomaga zidentyfikowaÄ‡ rozszerzenie.

### UÅ¼yj Archiwizatora lub Odpakowywacza plikÃ³w

PrzejdÅº do Sklepu Chrome Web Store i pobierz rozszerzenie. Plik bÄ™dzie miaÅ‚ rozszerzenie `.crx`. ZmieÅ„ rozszerzenie pliku z `.crx` na `.zip`. UÅ¼yj dowolnego archiwizatora plikÃ³w (np. WinRAR, 7-Zip itp.), aby wypakowaÄ‡ zawartoÅ›Ä‡ pliku ZIP.

### UÅ¼yj trybu dewelopera w Chrome

OtwÃ³rz Chrome i przejdÅº do `chrome://extensions/`. WÅ‚Ä…cz "Tryb dewelopera" w prawym gÃ³rnym rogu. Kliknij "ZaÅ‚aduj rozszerzenie bez pakowania...". PrzejdÅº do katalogu swojego rozszerzenia. To nie pobiera kodu ÅºrÃ³dÅ‚owego, ale jest przydatne do przeglÄ…dania i modyfikowania kodu juÅ¼ pobranego lub opracowanego rozszerzenia.

## Lista kontrolna audytu bezpieczeÅ„stwa

Mimo Å¼e rozszerzenia przeglÄ…darki majÄ… **ograniczonÄ… powierzchniÄ™ ataku**, niektÃ³re z nich mogÄ… zawieraÄ‡ **podatnoÅ›ci** lub **potencjalne ulepszenia zabezpieczeÅ„**. Oto najczÄ™stsze z nich:

* [ ] **Ograniczaj** jak najbardziej Å¼Ä…dane **`uprawnienia`**
* [ ] **Ograniczaj** jak najbardziej **`host_permissions`**
* UÅ¼yj **silnej** **`content_security_policy`**
* [ ] **Ograniczaj** jak najbardziej **`externally_connectable`**, jeÅ›li nie jest to potrzebne i moÅ¼liwe, nie pozostawiaj go domyÅ›lnie, okreÅ›l **`{}`**
* [ ] JeÅ›li tutaj wymieniony jest **URL podatny na XSS lub przejÄ™cie**, atakujÄ…cy bÄ™dzie mÃ³gÅ‚ **wysyÅ‚aÄ‡ wiadomoÅ›ci bezpoÅ›rednio do skryptÃ³w tÅ‚a**. Bardzo potÄ™Å¼ne obejÅ›cie.
* [ ] **Ograniczaj** jak najbardziej **`web_accessible_resources`**, nawet jeÅ›li jest puste, jeÅ›li to moÅ¼liwe.
* [ ] JeÅ›li **`web_accessible_resources`** nie jest puste, sprawdÅº [**ClickJacking**](browext-clickjacking.md)
* [ ] JeÅ›li zachodzi jakakolwiek **komunikacja** z **rozszerzenia** do **strony internetowej**, sprawdÅº **podatnoÅ›ci na XSS** spowodowane w komunikacji.
* [ ] JeÅ›li sÄ… uÅ¼ywane Post Messages, sprawdÅº [**podatnoÅ›ci na Post Message**](../postmessage-vulnerabilities/)**.**
* [ ] JeÅ›li **Skrypt zawartoÅ›ci uzyskuje dostÄ™p do szczegÃ³Å‚Ã³w DOM**, sprawdÅº, czy nie wprowadzajÄ… one XSS, jeÅ›li zostanÄ… **zmodyfikowane** przez stronÄ™ internetowÄ…
* [ ] ZwrÃ³Ä‡ szczegÃ³lnÄ… uwagÄ™, jeÅ›li ta komunikacja jest rÃ³wnieÅ¼ zaangaÅ¼owana w **komunikacjÄ™ Skryptu zawartoÅ›ci -> Skrypt tÅ‚a**
* [ ] **Informacje poufne nie powinny byÄ‡ przechowywane** w kodzie rozszerzenia przeglÄ…darki
* [ ] **Informacje poufne nie powinny byÄ‡ przechowywane** w pamiÄ™ci rozszerzenia przeglÄ…darki

## NarzÄ™dzia

### [**Tarnish**](https://thehackerblog.com/tarnish/)

* Pobiera dowolne rozszerzenie Chrome z podanego linku ze Sklepu Chrome.
* [**manifest.json**](https://developer.chrome.com/extensions/manifest) **viewer**: po prostu wyÅ›wietla sformatowanÄ… w JSON wersjÄ™ manifestu rozszerzenia.
* Analiza odcisku palca: Wykrywanie [web\_accessible\_resources](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) i automatyczna generacja JavaScriptu do odcisku palca rozszerzenia Chrome.
* Analiza potencjalnego Clickjackingu: Wykrywanie stron HTML rozszerzenia z dyrektywÄ… [web\_accessible\_resources](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources). SÄ… one potencjalnie podatne na clickjacking w zaleÅ¼noÅ›ci od celu stron.
* PrzeglÄ…darka ostrzeÅ¼eÅ„ o uprawnieniach: pokazuje listÄ™ wszystkich ostrzeÅ¼eÅ„ dotyczÄ…cych uprawnieÅ„ Chrome, ktÃ³re zostanÄ… wyÅ›wietlone podczas prÃ³by instalacji rozszerzenia przez uÅ¼ytkownika.
* **Funkcje niebezpieczne**: pokazuje lokalizacjÄ™ funkcji niebezpiecznych, ktÃ³re potencjalnie mogÄ… zostaÄ‡ wykorzystane przez atakujÄ…cego (np. funkcje takie jak innerHTML, chrome.tabs.executeScript).
* **Punkty wejÅ›cia**: pokazuje, gdzie rozszerzenie przyjmuje dane od uÅ¼ytkownika/zewnÄ™trzne. Jest to przydatne do zrozumienia obszaru powierzchni ataku rozszerzenia i poszukiwania potencjalnych punktÃ³w do przesÅ‚ania zÅ‚oÅ›liwie spreparowanych danych do rozszerzenia.
* ZarÃ³wno skanery Funkcji niebezpiecznych, jak i Punkty wejÅ›cia majÄ… nastÄ™pujÄ…ce elementy dla wygenerowanych alertÃ³w:
* Istotny fragment kodu i linia, ktÃ³ra spowodowaÅ‚a alert.
* Opis problemu.
* Przycisk â€WyÅ›wietl plikâ€, aby zobaczyÄ‡ peÅ‚ny plik ÅºrÃ³dÅ‚owy zawierajÄ…cy kod.
* ÅšcieÅ¼ka pliku, ktÃ³ry wywoÅ‚aÅ‚ alert.
* PeÅ‚ny URI rozszerzenia Chrome pliku, ktÃ³ry wywoÅ‚aÅ‚ alert.
* Typ pliku, taki jak skrypt strony tÅ‚a, skrypt zawartoÅ›ci, akcja przeglÄ…darki, itp.
* JeÅ›li podatna linia znajduje siÄ™ w pliku JavaScript, Å›cieÅ¼ki wszystkich stron, gdzie jest ona zawarta, oraz status [web\_accessible\_resource](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) tych stron.
* **Analizator i sprawdzarka polityki bezpieczeÅ„stwa zawartoÅ›ci (CSP)**: WskaÅ¼e sÅ‚abe punkty w polityce CSP Twojego rozszerzenia i oÅ›wietli potencjalne sposoby na jej obejÅ›cie z powodu zatwierdzonych na biaÅ‚o CDN itp.
* **Znane biblioteki podatne na ataki**: Wykorzystuje [Retire.js](https://retirejs.github.io/retire.js/) do sprawdzenia, czy uÅ¼ywane sÄ… znane biblioteki JavaScript podatne na ataki.
* Pobierz rozszerzenie i sformatowane wersje.
* Pobierz oryginalne rozszerzenie.
* Pobierz sformatowanÄ… wersjÄ™ rozszerzenia (automatycznie sformatowany HTML i JavaScript).
* Automatyczne buforowanie wynikÃ³w skanowania, pierwsze uruchomienie skanowania rozszerzenia zajmie sporo czasu. Jednak drugie uruchomienie, zakÅ‚adajÄ…c, Å¼e rozszerzenie nie zostaÅ‚o zaktualizowane, bÄ™dzie prawie natychmiastowe dziÄ™ki buforowaniu wynikÃ³w.
* Linkowalne adresy URL raportÃ³w, Å‚atwe przekazanie komuÅ› innemu raportu o rozszerzeniu wygenerowanego przez tarnish.

### [Neto](https://github.com/elevenpaths/neto)

Projekt Neto to pakiet Python 3 stworzony do analizy i odkrywania ukrytych funkcji wtyczek i rozszerzeÅ„ przeglÄ…darek takich jak Firefox i Chrome. Automatyzuje proces rozpakowywania spakowanych plikÃ³w w celu wydobycia tych funkcji z odpowiednich zasobÃ³w w rozszerzeniu, takich jak `manifest.json`, foldery lokalizacyjne czy pliki ÅºrÃ³dÅ‚owe Javascript i HTML.

## OdnoÅ›niki

* **DziÄ™ki dla** [**@naivenom**](https://twitter.com/naivenom) **za pomoc przy tej metodologii**
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)
* [https://palant.info/2022/08/10/anatomy-of-a-basic-extension/](https://palant.info/2022/08/10/anatomy-of-a-basic-extension/)
* [https://palant.info/2022/08/24/attack-surface-of-extension-pages/](https://palant.info/2022/08/24/attack-surface-of-extension-pages/)
* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://help.passbolt.com/assets/files/PBL-02-report.pdf](https://help.passbolt.com/assets/files/PBL-02-report.pdf)
* [https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts)
* [https://developer.chrome.com/docs/extensions/mv2/background-pages](https://developer.chrome.com/docs/extensions/mv2/background-pages)
* [https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/](https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/)
* [https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0](https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:
* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
