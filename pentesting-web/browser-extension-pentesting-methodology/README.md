# æµè§ˆå™¨æ‰©å±•æ¸—é€æµ‹è¯•æ–¹æ³•è®º

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## åŸºæœ¬ä¿¡æ¯

æµè§ˆå™¨æ‰©å±•ä½¿ç”¨JavaScriptç¼–å†™ï¼Œå¹¶ç”±æµè§ˆå™¨åœ¨åå°åŠ è½½ã€‚å®ƒæœ‰è‡ªå·±çš„[DOM](https://www.w3schools.com/js/js_htmldom.asp)ï¼Œä½†å¯ä»¥ä¸å…¶ä»–ç½‘ç«™çš„DOMäº¤äº’ã€‚è¿™æ„å‘³ç€å®ƒå¯èƒ½ä¼šå±åŠå…¶ä»–ç½‘ç«™çš„æœºå¯†æ€§ã€å®Œæ•´æ€§å’Œå¯ç”¨æ€§ï¼ˆCIAï¼‰ã€‚

## ä¸»è¦ç»„ä»¶

æ‰©å±•å¸ƒå±€åœ¨å¯è§†åŒ–æ—¶çœ‹èµ·æ¥æœ€ä½³ï¼Œç”±ä¸‰ä¸ªç»„ä»¶ç»„æˆã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£æ¯ä¸ªç»„ä»¶ã€‚

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption><p><a href="http://webblaze.cs.berkeley.edu/papers/Extensions.pdf">http://webblaze.cs.berkeley.edu/papers/Extensions.pdf</a></p></figcaption></figure>

### **å†…å®¹è„šæœ¬**

æ¯ä¸ªå†…å®¹è„šæœ¬éƒ½å¯ä»¥ç›´æ¥è®¿é—®**å•ä¸ªç½‘é¡µ**çš„DOMï¼Œå› æ­¤æš´éœ²äº**æ½œåœ¨çš„æ¶æ„è¾“å…¥**ã€‚ç„¶è€Œï¼Œå†…å®¹è„šæœ¬é™¤äº†èƒ½å¤Ÿå‘æ‰©å±•æ ¸å¿ƒå‘é€æ¶ˆæ¯ä¹‹å¤–ï¼Œæ²¡æœ‰å…¶ä»–æƒé™ã€‚

è¦åœ¨Chromeä¸­æŸ¥çœ‹å’Œè°ƒè¯•å†…å®¹è„šæœ¬ï¼Œæ‚¨å¯ä»¥ä»é€‰é¡¹ > æ›´å¤šå·¥å…· > å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€Chromeå¼€å‘è€…å·¥å…·èœå•ï¼Œæˆ–è€…ï¼ˆæŒ‰ - Ctrl + Shift + Iï¼‰ã€‚

æ˜¾ç¤ºå¼€å‘è€…å·¥å…·åï¼Œç‚¹å‡»**æºä»£ç æ ‡ç­¾**ï¼Œç„¶åç‚¹å‡»**å†…å®¹è„šæœ¬**æ ‡ç­¾ã€‚åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å„ç§æ‰©å±•çš„è¿è¡Œå†…å®¹è„šæœ¬ï¼Œå¹¶è®¾ç½®æ–­ç‚¹ä»¥ç›‘æ§æ‰§è¡Œæµç¨‹ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡Wappalyzeræµè§ˆå™¨æ‰©å±•å±•ç¤ºã€‚

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

### **æ‰©å±•æ ¸å¿ƒ**

æ‰©å±•æ ¸å¿ƒåŒ…å«äº†å¤§éƒ¨åˆ†æ‰©å±•æƒé™/è®¿é—®æƒé™ï¼Œä½†æ‰©å±•æ ¸å¿ƒåªèƒ½é€šè¿‡[XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest)å’Œå†…å®¹è„šæœ¬ä¸ç½‘é¡µå†…å®¹äº¤äº’ã€‚æ­¤å¤–ï¼Œæ‰©å±•æ ¸å¿ƒæ— æ³•ç›´æ¥è®¿é—®å®¿ä¸»æœºå™¨ã€‚

### **æœ¬åœ°äºŒè¿›åˆ¶**

æ‰©å±•å…è®¸ä¸€ä¸ªæœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥**ä»¥ç”¨æˆ·çš„å…¨éƒ¨æƒé™è®¿é—®å®¿ä¸»æœºå™¨ã€‚**æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶é€šè¿‡æ ‡å‡†çš„Netscapeæ’ä»¶åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆ[NPAPI](https://en.wikipedia.org/wiki/NPAPI)ï¼‰ä¸æ‰©å±•æ ¸å¿ƒäº¤äº’ï¼Œè¯¥æ¥å£è¢«Flashå’Œå…¶ä»–æµè§ˆå™¨æ’ä»¶ä½¿ç”¨ã€‚

### è¾¹ç•Œ

{% hint style="danger" %}
ä¸ºäº†è·å¾—ç”¨æˆ·çš„å…¨éƒ¨æƒé™ï¼Œæ”»å‡»è€…å¿…é¡»è¯´æœæ‰©å±•å°†æ¶æ„è¾“å…¥ä»å†…å®¹è„šæœ¬ä¼ é€’åˆ°æ‰©å±•çš„æ ¸å¿ƒï¼Œå†ä»æ‰©å±•çš„æ ¸å¿ƒä¼ é€’åˆ°æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶ã€‚
{% endhint %}

æ‰©å±•çš„æ¯ä¸ªç»„ä»¶éƒ½é€šè¿‡**å¼ºå¤§çš„ä¿æŠ¤è¾¹ç•Œ**å½¼æ­¤åˆ†éš”ã€‚æ¯ä¸ªç»„ä»¶åœ¨**å•ç‹¬çš„æ“ä½œç³»ç»Ÿè¿›ç¨‹**ä¸­è¿è¡Œã€‚å†…å®¹è„šæœ¬å’Œæ‰©å±•æ ¸å¿ƒè¿è¡Œåœ¨å¯¹å¤§å¤šæ•°æ“ä½œç³»ç»ŸæœåŠ¡ä¸å¯ç”¨çš„**æ²™ç®±è¿›ç¨‹**ä¸­ã€‚&#x20;

æ­¤å¤–ï¼Œå†…å®¹è„šæœ¬é€šè¿‡**åœ¨å•ç‹¬çš„JavaScriptå †ä¸­è¿è¡Œ**ä¸å…¶å…³è”çš„ç½‘é¡µåˆ†ç¦»ã€‚å†…å®¹è„šæœ¬å’Œç½‘é¡µéƒ½**å¯ä»¥è®¿é—®ç›¸åŒçš„åº•å±‚DOM**ï¼Œä½†ä¸¤è€…**ä»ä¸äº¤æ¢JavaScriptæŒ‡é’ˆ**ï¼Œé˜²æ­¢äº†JavaScriptåŠŸèƒ½çš„æ³„éœ²ã€‚

## **`manifest.json`**

Chromeæ‰©å±•åªæ˜¯ä¸€ä¸ªå¸¦æœ‰[.crxæ–‡ä»¶æ‰©å±•å](https://www.lifewire.com/crx-file-2620391)çš„ZIPæ–‡ä»¶å¤¹ã€‚æ‰©å±•çš„æ ¸å¿ƒæ˜¯æ–‡ä»¶å¤¹æ ¹ç›®å½•ä¸‹çš„**`manifest.json`**æ–‡ä»¶ï¼Œå®ƒæŒ‡å®šäº†å¸ƒå±€ã€æƒé™å’Œå…¶ä»–é…ç½®é€‰é¡¹ã€‚

ç¤ºä¾‹ï¼š
```json
{
"manifest_version": 2,
"name": "My extension",
"version": "1.0",
"permissions": [
"storage"
],
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
"background": {
"scripts": [
"background.js"
]
},
"options_ui": {
"page": "options.html"
}
}
```
### `content_scripts`

å†…å®¹è„šæœ¬åœ¨ç”¨æˆ·**å¯¼èˆªåˆ°åŒ¹é…çš„é¡µé¢**æ—¶**åŠ è½½**ï¼Œåœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œä»»ä½•ä¸**`https://example.com/*`** è¡¨è¾¾å¼åŒ¹é…ä¸”ä¸ä¸ **`*://*/*/business*`** æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„é¡µé¢éƒ½ä¼šåŠ è½½å†…å®¹è„šæœ¬ã€‚å®ƒä»¬**åƒé¡µé¢è‡ªå·±çš„è„šæœ¬ä¸€æ ·æ‰§è¡Œ**ï¼Œå¹¶ä¸”å¯ä»¥ä»»æ„è®¿é—®é¡µé¢çš„[æ–‡æ¡£å¯¹è±¡æ¨¡å‹ (DOM)](https://developer.mozilla.org/en-US/docs/Web/API/Document\_Object\_Model)ã€‚
```json
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
```
ä¸ºäº†åŒ…å«æˆ–æ’é™¤æ›´å¤šçš„URLï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ **`include_globs`** å’Œ **`exclude_globs`**ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹å†…å®¹è„šæœ¬ï¼Œå½“ä½¿ç”¨ [å­˜å‚¨ API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) ä»æ‰©å±•çš„å­˜å‚¨ä¸­æ£€ç´¢ `message` å€¼æ—¶ï¼Œå®ƒä¼šå‘é¡µé¢æ·»åŠ ä¸€ä¸ªè§£é‡ŠæŒ‰é’®ã€‚
```js
chrome.storage.local.get("message", result =>
{
let div = document.createElement("div");
div.innerHTML = result.message + " <button>Explain</button>";
div.querySelector("button").addEventListener("click", () =>
{
chrome.runtime.sendMessage("explain");
});
document.body.appendChild(div);
});
```
<figure><img src="../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

å½“ç‚¹å‡»è¿™ä¸ªæŒ‰é’®æ—¶ï¼Œå†…å®¹è„šæœ¬**ä½¿ç”¨** [**runtime.sendMessage() API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage) **å‘æ‰©å±•é¡µé¢å‘é€æ¶ˆæ¯**ã€‚è¿™æ˜¯å› ä¸ºå†…å®¹è„šæœ¬åªèƒ½ç›´æ¥è®¿é—®å°‘æ•°APIï¼Œå¦‚ `storage`ã€‚å…¶ä»–æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»é€šè¿‡å†…å®¹è„šæœ¬å¯ä»¥å‘é€æ¶ˆæ¯åˆ°çš„æ‰©å±•é¡µé¢æ¥å®Œæˆã€‚

{% hint style="warning" %}
**å†…å®¹è„šæœ¬çš„èƒ½åŠ›**æ ¹æ®æµè§ˆå™¨çš„ä¸åŒè€Œç•¥æœ‰å·®å¼‚ã€‚å¯¹äºåŸºäºChromiumçš„æµè§ˆå™¨ï¼Œä½ å¯ä»¥åœ¨ [Chrome Developers documentation](https://developer.chrome.com/docs/extensions/mv3/content\_scripts/#capabilities) æ‰¾åˆ°åˆ—è¡¨ï¼Œå¯¹äºFirefoxï¼Œ[MDN](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content\_scripts#webextension\_apis) æ˜¯æœ€ç»ˆçš„ä¿¡æ¯æ¥æºã€‚\
è®°ä½å†…å®¹è„šæœ¬ä¹Ÿå¯ä»¥**ä¸åå°è„šæœ¬é€šä¿¡**ï¼Œä»¥ä¾¿å®ƒä»¬æ‰§è¡Œæ“ä½œå¹¶å‘é€å›å“åº”
{% endhint %}

### æ³¨å…¥å†…å®¹è„šæœ¬

{% hint style="success" %}
æ³¨æ„**å†…å®¹è„šæœ¬ä¸æ˜¯å¼ºåˆ¶æ€§çš„**ï¼Œå› ä¸ºä¹Ÿå¯ä»¥é€šè¿‡ **`tabs.executeScript`** **åŠ¨æ€åœ°** **æ³¨å…¥**è„šæœ¬ï¼Œå¹¶ä¸”å¯ä»¥**ç¼–ç¨‹å¼åœ°æ³¨å…¥**åˆ°ç½‘é¡µä¸­ã€‚è¿™å®é™…ä¸Šæä¾›äº†æ›´å¤šçš„**ç»†ç²’åº¦æ§åˆ¶**ã€‚
{% endhint %}

è¦ä»¥ç¼–ç¨‹æ–¹å¼æ³¨å…¥å†…å®¹è„šæœ¬ï¼Œä½ çš„æ‰©å±•éœ€è¦å¯¹å…¶è¯•å›¾æ³¨å…¥è„šæœ¬çš„é¡µé¢æ‹¥æœ‰[ä¸»æœºæƒé™](https://developer.chrome.com/docs/extensions/reference/permissions)ã€‚ä¸»æœºæƒé™å¯ä»¥é€šè¿‡ä½œä¸ºæ‰©å±•æ¸…å•çš„ä¸€éƒ¨åˆ†**è¯·æ±‚å®ƒä»¬**æˆ–é€šè¿‡ [**activeTab**](https://developer.chrome.com/docs/extensions/reference/manifest/activeTab)**ä¸´æ—¶æˆäºˆ**ã€‚

#### ç¤ºä¾‹åŸºäºactiveTabçš„æ‰©å±•

{% code title="manifest.json" %}
```json
{
"name": "My extension",
...
"permissions": [
"activeTab",
"scripting"
],
"background": {
"service_worker": "background.js"
},
"action": {
"default_title": "Action Button"
}
}
```
{% endcode %}

* **ç‚¹å‡»æ—¶æ³¨å…¥JSæ–‡ä»¶ï¼š**
```javascript
// content-script.js
document.body.style.backgroundColor = "orange";

//service-worker.js - Inject the JS file
chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target: { tabId: tab.id },
files: ["content-script.js"]
});
});
```
* **åœ¨ç‚¹å‡»æ—¶æ³¨å…¥ä¸€ä¸ªå‡½æ•°**:
```javascript
//service-worker.js - Inject a function
function injectedFunction() {
document.body.style.backgroundColor = "orange";
}

chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target : {tabId : tab.id},
func : injectedFunction,
});
});
```
#### ç¤ºä¾‹åŒ…å«è„šæœ¬æƒé™
```javascript
// service-workser.js
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.nytimes.com/*" ],
excludeMatches : [ "*://*/*business*" ],
js : [ "contentScript.js" ],
}]);

// ANother example
chrome.tabs.executeScript(tabId, { file: "content_script.js" });
```
ä¸ºäº†åŒ…å«æˆ–æ’é™¤æ›´å¤šçš„URLï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ **`include_globs`** å’Œ **`exclude_globs`**ã€‚

### å†…å®¹è„šæœ¬ `run_at`

`run_at` å­—æ®µæ§åˆ¶ **ä½•æ—¶å°† JavaScript æ–‡ä»¶æ³¨å…¥åˆ°ç½‘é¡µä¸­**ã€‚é¦–é€‰ä¸”é»˜è®¤å€¼æ˜¯ `"document_idle"`ã€‚

å¯èƒ½çš„å€¼æœ‰ï¼š

* **`document_idle`**: å°½å¯èƒ½åœ°
* **`document_start`**: åœ¨ `css` çš„ä»»ä½•æ–‡ä»¶ä¹‹åï¼Œä½†åœ¨æ„å»ºä»»ä½•å…¶ä»–DOMæˆ–è¿è¡Œä»»ä½•å…¶ä»–è„šæœ¬ä¹‹å‰ã€‚
* **`document_end`**: åœ¨DOMå®Œæˆåç«‹å³ï¼Œä½†åœ¨å­èµ„æºå¦‚å›¾ç‰‡å’Œæ¡†æ¶åŠ è½½ä¹‹å‰ã€‚

#### é€šè¿‡ `manifest.json`
```json
{
"name": "My extension",
...
"content_scripts": [
{
"matches": ["https://*.nytimes.com/*"],
"run_at": "document_idle",
"js": ["contentScript.js"]
}
],
...
}

```
é€šè¿‡ **`service-worker.js`**
```javascript
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.nytimes.com/*" ],
runAt : "document_idle",
js : [ "contentScript.js" ],
}]);
```
### `èƒŒæ™¯`

å½“å†…å®¹è„šæœ¬å‘é€æ¶ˆæ¯æ—¶ï¼Œå…¶ç›®çš„åœ°æ˜¯**èƒŒæ™¯é¡µé¢**ã€‚èƒŒæ™¯é¡µé¢æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é¡µé¢ï¼Œé™¤éåœ¨æ‰©å±•æ¸…å•ä¸­å¦æœ‰æŒ‡å®šï¼Œå¦åˆ™å®ƒ**å§‹ç»ˆå­˜åœ¨**ã€‚å°½ç®¡å®ƒæ˜¯ä¸€ä¸ªæ‹¥æœ‰è‡ªå·±çš„DOMç­‰çš„æ™®é€šé¡µé¢ï¼Œä½†å¯¹ç”¨æˆ·æ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚å®ƒçš„åŠŸèƒ½é€šå¸¸æ˜¯åè°ƒæ‰©å±•çš„æ‰€æœ‰å…¶ä»–éƒ¨åˆ†ã€‚

{% hint style="success" %}
å¦‚æœæ²¡æœ‰æ˜ç¡®å£°æ˜èƒŒæ™¯é¡µé¢ï¼Œæµè§ˆå™¨ä¼šå¾ˆæœ‰å¸®åŠ©åœ°**è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª**ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰**å£°æ˜çš„èƒŒæ™¯è„šæœ¬éƒ½åŠ è½½**è¿›å»ï¼Œå°±åƒå‰é¢çš„manifest.jsonç¤ºä¾‹ä¸­é‚£æ ·ã€‚
{% endhint %}

èƒŒæ™¯è„šæœ¬ç¤ºä¾‹ï¼š
```js
chrome.runtime.onMessage.addListener((request, sender, sendResponse) =>
{
if (request == "explain")
{
chrome.tabs.create({ url: "https://example.net/explanation" });
}
})
```
å®ƒä½¿ç”¨ [runtime.onMessage API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage) æ¥ç›‘å¬æ¶ˆæ¯ã€‚å½“æ”¶åˆ° `"explain"` æ¶ˆæ¯æ—¶ï¼Œå®ƒä½¿ç”¨ [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€é¡µé¢ã€‚

### é€‰é¡¹é¡µé¢å’Œå…¶ä»–

æµè§ˆå™¨æ‰©å±•å¯ä»¥åŒ…å«å„ç§é¡µé¢ï¼š

* **æ“ä½œé¡µé¢** åœ¨ç‚¹å‡»æ‰©å±•å›¾æ ‡æ—¶æ˜¾ç¤ºåœ¨**ä¸‹æ‹‰èœå•ä¸­**ã€‚
* æ‰©å±•å°†**åœ¨æ–°æ ‡ç­¾é¡µä¸­åŠ è½½**çš„é¡µé¢ã€‚
* **é€‰é¡¹é¡µé¢**ï¼šç‚¹å‡»æ‰©å±•æ—¶ï¼Œæ­¤é¡µé¢æ˜¾ç¤ºåœ¨æ‰©å±•é¡¶éƒ¨ã€‚åœ¨ä¹‹å‰çš„ manifest ä¸­ï¼Œåœ¨æˆ‘çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘å¯ä»¥é€šè¿‡ `chrome://extensions/?options=fadlhnelkbeojnebcbkacjilhnbjfjca` è®¿é—®æ­¤é¡µé¢ï¼Œæˆ–ç‚¹å‡»ï¼š

<figure><img src="../../.gitbook/assets/image (8).png" alt="" width="375"><figcaption></figcaption></figure>

ä¸èƒŒæ™¯é¡µé¢ä¸åŒï¼Œè¿™äº›é¡µé¢ä¸æ˜¯æŒä¹…çš„ï¼Œè€Œæ˜¯åœ¨éœ€è¦æ—¶åŠ è½½ã€‚ç„¶è€Œï¼Œæ‰€æœ‰è¿™äº›é¡µé¢éƒ½å¯ä»¥**æ¥æ”¶æ¥è‡ªå†…å®¹è„šæœ¬çš„æ¶ˆæ¯**ã€‚å¹¶ä¸”å®ƒä»¬éƒ½æœ‰**å®Œå…¨è®¿é—®ç‰¹å®šäºæ‰©å±•çš„ API çš„æƒé™**ï¼Œåªè¦æ‰©å±•çš„æƒé™å…è®¸ã€‚

æ€»çš„æ¥è¯´ï¼Œæµè§ˆå™¨æ‰©å±•çš„ç›¸å…³ä¸Šä¸‹æ–‡å¦‚ä¸‹æ‰€ç¤ºï¼š

<figure><img src="../../.gitbook/assets/image (9).png" alt="" width="563"><figcaption></figcaption></figure>

### `permissions` å’Œ `host_permissions`

**`permissions`** å’Œ **`host_permissions`** æ˜¯ `manifest.json` ä¸­çš„æ¡ç›®ï¼Œå®ƒä»¬å°†æŒ‡ç¤ºæµè§ˆå™¨æ‰©å±•æ‹¥æœ‰**å“ªäº›æƒé™**ï¼ˆå­˜å‚¨ã€ä½ç½®ç­‰ï¼‰ä»¥åŠåœ¨**å“ªäº›ç½‘é¡µä¸Š**ã€‚

ç”±äºæµè§ˆå™¨æ‰©å±•å¯ä»¥å¦‚æ­¤**ç‰¹æƒ**ï¼Œä¸€ä¸ªæ¶æ„çš„æˆ–è¢«æ³„éœ²çš„æ‰©å±•å¯èƒ½å…è®¸æ”»å‡»è€…**ä»¥ä¸åŒæ–¹å¼çªƒå–æ•æ„Ÿä¿¡æ¯å’Œç›‘è§†ç”¨æˆ·**ã€‚

æ£€æŸ¥è¿™äº›è®¾ç½®å¦‚ä½•å·¥ä½œä»¥åŠå®ƒä»¬å¦‚ä½•å¯èƒ½è¢«æ»¥ç”¨ï¼š

{% content-ref url="browext-permissions-and-host_permissions.md" %}
[browext-permissions-and-host\_permissions.md](browext-permissions-and-host\_permissions.md)
{% endcontent-ref %}

### `content_security_policy`

**å†…å®¹å®‰å…¨ç­–ç•¥**ä¹Ÿå¯ä»¥åœ¨ `manifest.json` ä¸­å£°æ˜ã€‚å¦‚æœå®šä¹‰äº†ç­–ç•¥ï¼Œå®ƒå¯èƒ½æ˜¯**æ˜“å—æ”»å‡»çš„**ã€‚

æµè§ˆå™¨æ‰©å±•é¡µé¢çš„é»˜è®¤è®¾ç½®ç›¸å½“ä¸¥æ ¼ï¼š
```bash
script-src 'self'; object-src 'self';
```
æœ‰å…³CSPåŠå…¶æ½œåœ¨ç»•è¿‡æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="../content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../content-security-policy-csp-bypass/)
{% endcontent-ref %}

### `web_accessible_resources`

ä¸ºäº†è®©ç½‘é¡µè®¿é—®æµè§ˆå™¨æ‰©å±•çš„é¡µé¢ï¼Œä¾‹å¦‚`.html`é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢éœ€è¦åœ¨`manifest.json`çš„**`web_accessible_resources`**å­—æ®µä¸­æåŠã€‚\
ä¾‹å¦‚ï¼š
```javascript
{
...
"web_accessible_resources": [
{
"resources": [ "images/*.png" ],
"matches": [ "https://example.com/*" ]
},
{
"resources": [ "fonts/*.woff" ],
"matches": [ "https://example.com/*" ]
}
],
...
}
```
è¿™äº›é¡µé¢å¯ä»¥é€šè¿‡ç±»ä¼¼ä»¥ä¸‹çš„URLè®¿é—®ï¼š
```
chrome-extension://<extension-id>/message.html
```
åœ¨å…¬å…±æ‰©å±•ä¸­ï¼Œ**extension-id æ˜¯å¯è®¿é—®çš„**ï¼š

<figure><img src="../../.gitbook/assets/image (722).png" alt="" width="375"><figcaption></figcaption></figure>

ç„¶è€Œï¼Œå¦‚æœä½¿ç”¨äº† `manifest.json` å‚æ•° **`use_dynamic_url`**ï¼Œè¿™ä¸ª **id å¯ä»¥æ˜¯åŠ¨æ€çš„**ã€‚

è¢«å…è®¸è®¿é—®è¿™äº›é¡µé¢ä½¿å¾—è¿™äº›é¡µé¢ **å¯èƒ½å®¹æ˜“å—åˆ° ClickJacking æ”»å‡»**ï¼š

{% content-ref url="browext-clickjacking.md" %}
[browext-clickjacking.md](browext-clickjacking.md)
{% endcontent-ref %}

{% hint style="success" %}
åªå…è®¸æ‰©å±•åŠ è½½è¿™äº›é¡µé¢ï¼Œè€Œä¸æ˜¯éšæœº URLï¼Œå¯ä»¥é˜²æ­¢ ClickJacking æ”»å‡»ã€‚
{% endhint %}

### `externally_connectable`

æ ¹æ® [**æ–‡æ¡£**](https://developer.chrome.com/docs/extensions/reference/manifest/externally-connectable)ï¼Œ`"externally_connectable"` æ¸…å•å±æ€§å£°æ˜äº† **å“ªäº›æ‰©å±•å’Œç½‘é¡µå¯ä»¥é€šè¿‡** [runtime.connect](https://developer.chrome.com/docs/extensions/reference/runtime#method-connect) å’Œ [runtime.sendMessage](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) **è¿æ¥åˆ°ä½ çš„æ‰©å±•**ã€‚

* å¦‚æœ **`externally_connectable`** é”®åœ¨ä½ çš„æ‰©å±•æ¸…å•ä¸­ **æ²¡æœ‰å£°æ˜**ï¼Œæˆ–è€…å£°æ˜ä¸º **`"ids": ["*"]`**ï¼Œ**æ‰€æœ‰æ‰©å±•éƒ½å¯ä»¥è¿æ¥ï¼Œä½†æ²¡æœ‰ç½‘é¡µå¯ä»¥è¿æ¥**ã€‚
* å¦‚æœå£°æ˜äº† **ç‰¹å®šçš„ ID**ï¼Œå¦‚ `"ids": ["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"]`ï¼Œ**åªæœ‰é‚£äº›åº”ç”¨ç¨‹åº**å¯ä»¥è¿æ¥ã€‚
* å¦‚æœæŒ‡å®šäº† **matches**ï¼Œé‚£äº›ç½‘é¡µåº”ç”¨å°†èƒ½å¤Ÿè¿æ¥ï¼š
```json
"matches": [
"https://*.google.com/*",
"*://*.chromium.org/*",
```
* å¦‚æœæŒ‡å®šä¸ºç©ºï¼š**`"externally_connectable": {}`**ï¼Œåˆ™æ²¡æœ‰ä»»ä½•åº”ç”¨ç¨‹åºæˆ–ç½‘é¡µèƒ½å¤Ÿè¿æ¥ã€‚

è¿™é‡ŒæŒ‡ç¤ºçš„**æ‰©å±•å’ŒURLè¶Šå°‘**ï¼Œ**æ”»å‡»é¢å°±è¶Šå°**ã€‚

{% hint style="danger" %}
å¦‚æœåœ¨ **`externally_connectable`** ä¸­æŒ‡å‡ºäº†ä¸€ä¸ª**å®¹æ˜“å—åˆ°XSSæˆ–æ¥ç®¡æ”»å‡»çš„ç½‘é¡µ**ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿ**ç›´æ¥å‘åå°è„šæœ¬å‘é€æ¶ˆæ¯**ï¼Œå®Œå…¨ç»•è¿‡å†…å®¹è„šæœ¬åŠå…¶CSPã€‚

å› æ­¤ï¼Œè¿™æ˜¯ä¸€ä¸ª**éå¸¸å¼ºå¤§çš„ç»•è¿‡**ã€‚
{% endhint %}

## ç½‘é¡µ **â†”ï¸** å†…å®¹è„šæœ¬é€šä¿¡

å°½ç®¡**å†…å®¹è„šæœ¬å’Œæ‰˜ç®¡å®ƒä»¬çš„é¡µé¢**çš„æ‰§è¡Œç¯å¢ƒæ˜¯**ç›¸äº’éš”ç¦»**çš„ï¼Œä½†å®ƒä»¬**å…±äº«å¯¹é¡µé¢DOMçš„è®¿é—®**ã€‚å¦‚æœé¡µé¢å¸Œæœ›ä¸å†…å®¹è„šæœ¬é€šä¿¡ï¼Œæˆ–é€šè¿‡å†…å®¹è„šæœ¬ä¸æ‰©å±•é€šä¿¡ï¼Œå®ƒå¿…é¡»é€šè¿‡**å…±äº«çš„DOM**æ¥å®ç°ã€‚

### å‘é€æ¶ˆæ¯

{% code title="content-script.js" %}
```javascript
var port = chrome.runtime.connect();

window.addEventListener("message", (event) => {
// We only accept messages from ourselves
if (event.source !== window) {
return;
}

if (event.data.type && (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
port.postMessage(event.data.text);
}
}, false);
```
```
{% endcode %}

{% code title="example.js" %}
```
```javascript
document.getElementById("theButton").addEventListener("click", () => {
window.postMessage(
{type : "FROM_PAGE", text : "Hello from the webpage!"}, "*");
}, false);
```
{% endcode %}

å®‰å…¨çš„ Post Message é€šä¿¡åº”è¯¥æ£€æŸ¥æ¥æ”¶æ¶ˆæ¯çš„çœŸå®æ€§ï¼Œè¿™å¯ä»¥é€šè¿‡æ£€æŸ¥ä»¥ä¸‹æ–¹å¼å®Œæˆï¼š

* **`event.isTrusted`**ï¼šå¦‚æœäº‹ä»¶æ˜¯ç”±ç”¨æˆ·æ“ä½œè§¦å‘çš„ï¼Œåˆ™ä¸º True
* å†…å®¹è„šæœ¬å¯èƒ½åªåœ¨ç”¨æˆ·æ‰§è¡ŒæŸäº›æ“ä½œæ—¶æ‰æœŸæœ›æ¥æ”¶æ¶ˆæ¯
* **åŸå§‹åŸŸå**ï¼šå¯ä»¥ä¸å…è®¸åŸŸååˆ—è¡¨è¿›è¡Œå¯¹æ¯”ã€‚
* å¦‚æœä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¦éå¸¸å°å¿ƒ
* **æ¥æº**ï¼š`received_message.source !== window` å¯ç”¨äºæ£€æŸ¥æ¶ˆæ¯æ˜¯å¦**æ¥è‡ªåŒä¸€çª—å£**ï¼Œå³å†…å®¹è„šæœ¬æ­£åœ¨ç›‘å¬çš„çª—å£ã€‚

å³ä½¿æ‰§è¡Œäº†ä¸Šè¿°æ£€æŸ¥ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨æ¼æ´ï¼Œå› æ­¤è¯·åœ¨ä»¥ä¸‹é¡µé¢æ£€æŸ¥**æ½œåœ¨çš„ Post Message ç»•è¿‡**ï¼š

{% content-ref url="../postmessage-vulnerabilities/" %}
[postmessage-vulnerabilities](../postmessage-vulnerabilities/)
{% endcontent-ref %}

### Iframe

å¦ä¸€ç§å¯èƒ½çš„é€šä¿¡æ–¹å¼å¯èƒ½æ˜¯é€šè¿‡ **Iframe URLs**ï¼Œæ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­æ‰¾åˆ°ï¼š

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

### DOM

è¿™ä¸æ˜¯â€œç¡®åˆ‡çš„â€é€šä¿¡æ–¹å¼ï¼Œä½†æ˜¯**ç½‘é¡µå’Œå†…å®¹è„šæœ¬å°†èƒ½å¤Ÿè®¿é—®ç½‘é¡µ DOM**ã€‚å› æ­¤ï¼Œå¦‚æœ**å†…å®¹è„šæœ¬**ä»ä¸­è¯»å–ä¸€äº›ä¿¡æ¯ï¼Œ**ä¿¡ä»»ç½‘é¡µ DOM**ï¼Œç½‘é¡µå¯ä»¥**ä¿®æ”¹è¿™äº›æ•°æ®**ï¼ˆå› ä¸ºç½‘é¡µä¸åº”è¯¥è¢«ä¿¡ä»»ï¼Œæˆ–è€…å› ä¸ºç½‘é¡µå®¹æ˜“å—åˆ° XSS æ”»å‡»ï¼‰å¹¶ä¸”**å±åŠå†…å®¹è„šæœ¬**ã€‚

æ‚¨è¿˜å¯ä»¥åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­æ‰¾åˆ°ä¸€ä¸ª**åŸºäº DOM çš„ XSS æ¥å±åŠæµè§ˆå™¨æ‰©å±•**ï¼š

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## å†…å­˜/ä»£ç ä¸­çš„æ•æ„Ÿä¿¡æ¯

å¦‚æœæµè§ˆå™¨æ‰©å±•åœ¨å…¶å†…å­˜ä¸­å­˜å‚¨**æ•æ„Ÿä¿¡æ¯**ï¼Œè¿™äº›ä¿¡æ¯å¯èƒ½ä¼šè¢«**è½¬å‚¨**ï¼ˆç‰¹åˆ«æ˜¯åœ¨ Windows æœºå™¨ä¸Šï¼‰å¹¶**æœç´¢**è¿™äº›ä¿¡æ¯ã€‚

å› æ­¤ï¼Œæµè§ˆå™¨æ‰©å±•çš„å†…å­˜**ä¸åº”è¯¥è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„**ï¼Œè€Œä¸”åƒå‡­æ®æˆ–åŠ©è®°è¯è¿™æ ·çš„**æ•æ„Ÿä¿¡æ¯ä¸åº”è¯¥è¢«å­˜å‚¨**ã€‚

å½“ç„¶ï¼Œ**ä¸è¦å°†æ•æ„Ÿä¿¡æ¯æ”¾åœ¨ä»£ç ä¸­**ï¼Œå› ä¸ºå®ƒå°†æ˜¯**å…¬å¼€çš„**ã€‚

## å†…å®¹è„šæœ¬ **â†”ï¸** èƒŒæ™¯è„šæœ¬é€šä¿¡

å†…å®¹è„šæœ¬å¯ä»¥ä½¿ç”¨å‡½æ•° [**runtime.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) **æˆ–** [**tabs.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/tabs#method-sendMessage) æ¥å‘é€**ä¸€æ¬¡æ€§çš„ JSON-å¯åºåˆ—åŒ–**æ¶ˆæ¯ã€‚

è¦å¤„ç†**å“åº”**ï¼Œä½¿ç”¨è¿”å›çš„**Promise**ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä¸ºäº†å‘åå…¼å®¹ï¼Œæ‚¨ä»ç„¶å¯ä»¥å°†**å›è°ƒ**ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ä¼ é€’ã€‚

ä»**å†…å®¹è„šæœ¬**å‘é€è¯·æ±‚çœ‹èµ·æ¥åƒè¿™æ ·ï¼š
```javascript
(async () => {
const response = await chrome.runtime.sendMessage({greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
å°†è¯·æ±‚ä»**æ‰©å±•**ï¼ˆé€šå¸¸æ˜¯**èƒŒæ™¯è„šæœ¬**ï¼‰å‘é€åˆ°å†…å®¹è„šæœ¬ç±»ä¼¼ï¼Œä½†æ‚¨éœ€è¦æŒ‡å®šå‘é€åˆ°å“ªä¸ªæ ‡ç­¾é¡µã€‚æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†å‘é€‰å®šæ ‡ç­¾é¡µä¸­çš„å†…å®¹è„šæœ¬å‘é€æ¶ˆæ¯ã€‚
```javascript
(async () => {
const [tab] = await chrome.tabs.query({active: true, lastFocusedWindow: true});
const response = await chrome.tabs.sendMessage(tab.id, {greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
åœ¨**æ¥æ”¶ç«¯**ï¼Œæ‚¨éœ€è¦è®¾ç½®ä¸€ä¸ª [**runtime.onMessage**](https://developer.chrome.com/docs/extensions/reference/runtime#event-onMessage) **äº‹ä»¶ç›‘å¬å™¨**æ¥å¤„ç†æ¶ˆæ¯ã€‚æ— è®ºæ˜¯åœ¨å†…å®¹è„šæœ¬è¿˜æ˜¯æ‰©å±•é¡µé¢ä¸­ï¼Œè¿™çœ‹èµ·æ¥éƒ½æ˜¯ç›¸åŒçš„ã€‚
```javascript
chrome.runtime.onMessage.addListener(
function(request, sender, sendResponse) {
console.log(sender.tab ?
"from a content script:" + sender.tab.url :
"from the extension");
if (request.greeting === "hello")
sendResponse({farewell: "goodbye"});
}
);
```
åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ**`sendResponse()`** è¢«åŒæ­¥è°ƒç”¨ã€‚å¦‚æœä½ æƒ³è¦**å¼‚æ­¥**ä½¿ç”¨ `sendResponse()`ï¼Œåœ¨ `onMessage` äº‹ä»¶å¤„ç†å™¨ä¸­æ·»åŠ  `return true;`ã€‚

> å¦‚æœå¤šä¸ªé¡µé¢åœ¨ç›‘å¬ `onMessage` äº‹ä»¶ï¼Œ**åªæœ‰ç¬¬ä¸€ä¸ªè°ƒç”¨ `sendResponse()`** çš„é¡µé¢ä¼šæˆåŠŸå‘é€å“åº”ã€‚å¯¹é‚£ä¸ªäº‹ä»¶çš„æ‰€æœ‰å…¶ä»–å“åº”éƒ½å°†è¢«å¿½ç•¥ã€‚

å¯¹äºæ–°çš„æ‰©å±•ï¼Œä½ åº”è¯¥ä¼˜å…ˆä½¿ç”¨ promises è€Œä¸æ˜¯ callbacksã€‚å¦‚æœä½ åœ¨ä½¿ç”¨ callbacksï¼Œ`sendResponse()` å›è°ƒåªæœ‰åœ¨åŒæ­¥ä½¿ç”¨ï¼Œæˆ–è€…äº‹ä»¶å¤„ç†å™¨è¿”å› `true` æ¥è¡¨æ˜å®ƒå°†å¼‚æ­¥å“åº”æ—¶æ‰æœ‰æ•ˆã€‚å¦‚æœæ²¡æœ‰å¤„ç†å™¨è¿”å› true æˆ–è€… `sendResponse()` å›è°ƒè¢«åƒåœ¾å›æ”¶ï¼Œ`sendMessage()` å‡½æ•°çš„å›è°ƒå°†ä¼šè‡ªåŠ¨è¢«è°ƒç”¨ã€‚

## åœ¨æµè§ˆå™¨ä¸­åŠ è½½æ‰©å±•

1. **ä¸‹è½½** æµè§ˆå™¨æ‰©å±•å¹¶è§£å‹
2. è½¬åˆ° **`chrome://extensions/`** å¹¶**å¯ç”¨** `å¼€å‘è€…æ¨¡å¼`
3. ç‚¹å‡» **`åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº`** æŒ‰é’®

åœ¨ **Firefox** ä¸­ï¼Œä½ è½¬åˆ° **`about:debugging#/runtime/this-firefox`** å¹¶ç‚¹å‡» **`åŠ è½½ä¸´æ—¶é™„åŠ ç»„ä»¶`** æŒ‰é’®ã€‚

## ä»å•†åº—è·å–æºä»£ç 

ä» [**è¿™é‡Œ**](https://gist.github.com/paulirish/78d6c1406c901be02c2d):

### é€‰é¡¹ 1: å‘½ä»¤è¡Œä¸‹è½½æ‰©å±•ä¸º zip å¹¶è§£å‹

{% code overflow="wrap" %}
```bash
extension_id=jifpbeccnghkjeaalbbjmodiffmgedin   # change this ID
curl -L -o "$extension_id.zip" "https://clients2.google.com/service/update2/crx?response=redirect&os=mac&arch=x86-64&nacl_arch=x86-64&prod=chromecrx&prodchannel=stable&prodversion=44.0.2403.130&x=id%3D$extension_id%26uc"
unzip -d "$extension_id-source" "$extension_id.zip"
```
```
{% endcode %}

æ„Ÿè°¢ crxviewer æä¾›çš„[é­”æ³•ä¸‹è½½ URL](https://github.com/Rob--W/crxviewer/blob/6113c25e3569e1ec59365ad9a177aa97e2bcda61/src/cws_pattern.js#L27-L74)ã€‚

### é€‰é¡¹ 2ï¼šä½¿ç”¨ CRX Viewer ç½‘ç«™

[https://robwu.nl/crxviewer/](https://robwu.nl/crxviewer/)

### é€‰é¡¹ 3ï¼šä½¿ç”¨ CRX Viewer æ‰©å±•ç¨‹åº

[Chrome æ‰©å±•ç¨‹åºæºä»£ç æŸ¥çœ‹å™¨](https://chrome.google.com/webstore/detail/chrome-extension-source-v/jifpbeccnghkjeaalbbjmodiffmgedin?hl=en) æ˜¯å¼€æºçš„ï¼ˆ[github ä»“åº“](https://github.com/Rob--W/crxviewer)ï¼‰ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚

### é€‰é¡¹ 3ï¼šæŸ¥çœ‹æœ¬åœ°å®‰è£…çš„æ‰©å±•ç¨‹åºæºä»£ç 

1. æ‰¾åˆ°æ‚¨çš„ Chrome æœ¬åœ°é…ç½®æ–‡ä»¶ç›®å½•ã€‚æ‰“å¼€ `chrome://version/` å¹¶æ‰¾åˆ° "Profile Path:" å­—æ®µã€‚æ‰“å¼€é‚£ä¸ªæ–‡ä»¶å¤¹ã€‚
2. æ‰“å¼€ `Extensions/` å­æ–‡ä»¶å¤¹
3. è¿™é‡Œæœ‰æ‰€æœ‰æ‚¨çš„æ‰©å±•ç¨‹åºï¼Œé€šå¸¸æºä»£ç æ˜¯å¯è¯»çš„ã€‚

#### æœ¬åœ°å®‰è£…çš„æ‰©å±•ç¨‹åº ID ä¸åç§°ä¹‹é—´çš„æ˜ å°„

* åœ¨ `about:extensions` ä¸Šï¼Œæ‰“å¼€å¼€å‘è€…æ¨¡å¼ï¼Œæ‚¨å°†åœ¨æ¯ä¸ªæ¡ç›®ä¸‹çœ‹åˆ° ID
* åœ¨ `Extensions/` æ–‡ä»¶å¤¹å†…ï¼Œmanifest.json æœ‰ä¸€ä¸ªå¯è¯»çš„ `name` å­—æ®µ

## å®‰å…¨å®¡è®¡æ¸…å•

å°½ç®¡æµè§ˆå™¨æ‰©å±•ç¨‹åºçš„**æ”»å‡»é¢**æœ‰é™ï¼Œä½†å…¶ä¸­ä¸€äº›å¯èƒ½åŒ…å«**æ¼æ´**æˆ–**æ½œåœ¨çš„åŠ å›ºæ”¹è¿›**ã€‚ä»¥ä¸‹æ˜¯æœ€å¸¸è§çš„ä¸€äº›ï¼š

* [ ] å°½å¯èƒ½**é™åˆ¶**è¯·æ±‚çš„**`permissions`**
* [ ] å°½å¯èƒ½**é™åˆ¶** **`host_permissions`**
* [ ] ä½¿ç”¨**å¼ºå¤§çš„** **`content_security_policy`**
* [ ] å°½å¯èƒ½**é™åˆ¶** **`externally_connectable`**ï¼Œå¦‚æœä¸éœ€è¦ä¸”å¯èƒ½çš„è¯ï¼Œä¸è¦é»˜è®¤ç•™ç©ºï¼ŒæŒ‡å®š **`{}`**
* [ ] å¦‚æœè¿™é‡Œæåˆ°äº†**å®¹æ˜“å—åˆ° XSS æˆ–æ¥ç®¡çš„ URL**ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿ**ç›´æ¥å‘åå°è„šæœ¬å‘é€æ¶ˆæ¯**ã€‚éå¸¸å¼ºå¤§çš„ç»•è¿‡ã€‚
* [ ] å°½å¯èƒ½**é™åˆ¶** **`web_accessible_resources`**ï¼Œå¦‚æœå¯èƒ½çš„è¯ç”šè‡³ä¸ºç©ºã€‚
* [ ] å¦‚æœ **`web_accessible_resources`** ä¸ä¸ºç©ºï¼Œè¯·æ£€æŸ¥ [**ClickJacking**](browext-clickjacking.md)
* [ ] å¦‚æœ**æ‰©å±•ç¨‹åº**ä¸**ç½‘é¡µ**ä¹‹é—´å‘ç”Ÿä»»ä½•**é€šä¿¡**ï¼Œ[**æ£€æŸ¥ XSS**](browext-xss-example.md) **æ¼æ´**æ˜¯å¦å› é€šä¿¡è€Œå¼•èµ·ã€‚
* [ ] å¦‚æœä½¿ç”¨äº† Post Messagesï¼Œè¯·æ£€æŸ¥ [**Post Message æ¼æ´**](../postmessage-vulnerabilities/)ã€‚
* [ ] å¦‚æœ**å†…å®¹è„šæœ¬è®¿é—® DOM è¯¦æƒ…**ï¼Œè¯·æ£€æŸ¥å®ƒä»¬æ˜¯å¦**å¼•å…¥äº† XSS**ï¼Œå¦‚æœå®ƒä»¬è¢«ç½‘é¡µ**ä¿®æ”¹**ã€‚
* [ ] å¦‚æœè¿™ç§é€šä¿¡è¿˜æ¶‰åŠåˆ°**å†…å®¹è„šæœ¬ -> åå°è„šæœ¬é€šä¿¡**ï¼Œè¯·ç‰¹åˆ«å¼ºè°ƒã€‚
* [ ] **æ•æ„Ÿä¿¡æ¯ä¸åº”å­˜å‚¨**åœ¨æµè§ˆå™¨æ‰©å±•ç¨‹åº**ä»£ç **ä¸­
* [ ] **æ•æ„Ÿä¿¡æ¯ä¸åº”å­˜å‚¨**åœ¨æµè§ˆå™¨æ‰©å±•ç¨‹åº**å†…å­˜**ä¸­

## å·¥å…·

### [**Tarnish**](https://thehackerblog.com/tarnish/)

* ä»æä¾›çš„ Chrome ç½‘ä¸Šåº”ç”¨åº—é“¾æ¥ä¸­æå–ä»»ä½• Chrome æ‰©å±•ç¨‹åºã€‚
* [**manifest.json**](https://developer.chrome.com/extensions/manifest) **æŸ¥çœ‹å™¨**ï¼šç®€å•åœ°æ˜¾ç¤ºæ‰©å±•ç¨‹åºæ¸…å•çš„ JSON æ ¼å¼åŒ–ç‰ˆæœ¬ã€‚
* **æŒ‡çº¹åˆ†æ**ï¼šæ£€æµ‹ [web_accessible_resources](https://developer.chrome.com/extensions/manifest/web_accessible_resources) å¹¶è‡ªåŠ¨ç”Ÿæˆ Chrome æ‰©å±•ç¨‹åºæŒ‡çº¹è¯†åˆ« JavaScriptã€‚
* **æ½œåœ¨çš„ Clickjacking åˆ†æ**ï¼šæ£€æµ‹è®¾ç½®äº† [web_accessible_resources](https://developer.chrome.com/extensions/manifest/web_accessible_resources) æŒ‡ä»¤çš„æ‰©å±•ç¨‹åº HTML é¡µé¢ã€‚æ ¹æ®é¡µé¢çš„ç”¨é€”ï¼Œè¿™äº›é¡µé¢å¯èƒ½å®¹æ˜“å—åˆ°ç‚¹å‡»åŠ«æŒã€‚
* **æƒé™è­¦å‘ŠæŸ¥çœ‹å™¨**ï¼šæ˜¾ç¤ºç”¨æˆ·å°è¯•å®‰è£…æ‰©å±•ç¨‹åºæ—¶å°†æ˜¾ç¤ºçš„æ‰€æœ‰ Chrome æƒé™æç¤ºè­¦å‘Šçš„åˆ—è¡¨ã€‚
* **å±é™©åŠŸèƒ½**ï¼šæ˜¾ç¤ºå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨çš„å±é™©åŠŸèƒ½çš„ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œå¦‚ innerHTMLã€chrome.tabs.executeScript ç­‰åŠŸèƒ½ï¼‰ã€‚
* **å…¥å£ç‚¹**ï¼šæ˜¾ç¤ºæ‰©å±•ç¨‹åºæ¥æ”¶ç”¨æˆ·/å¤–éƒ¨è¾“å…¥çš„ä½ç½®ã€‚è¿™å¯¹äºäº†è§£æ‰©å±•ç¨‹åºçš„è¡¨é¢åŒºåŸŸå¹¶å¯»æ‰¾æ½œåœ¨çš„å‘é€æ¶æ„åˆ¶ä½œæ•°æ®åˆ°æ‰©å±•ç¨‹åºçš„ç‚¹å¾ˆæœ‰ç”¨ã€‚
* å±é™©åŠŸèƒ½å’Œå…¥å£ç‚¹æ‰«æå™¨çš„ç”Ÿæˆè­¦æŠ¥éƒ½æœ‰ä»¥ä¸‹å†…å®¹ï¼š
* å¼•èµ·è­¦æŠ¥çš„ç›¸å…³ä»£ç ç‰‡æ®µå’Œè¡Œã€‚
* é—®é¢˜æè¿°ã€‚
* â€œæŸ¥çœ‹æ–‡ä»¶â€æŒ‰é’®ï¼Œä»¥æŸ¥çœ‹åŒ…å«ä»£ç çš„å®Œæ•´æºæ–‡ä»¶ã€‚
* è­¦æŠ¥æ–‡ä»¶çš„è·¯å¾„ã€‚
* è­¦æŠ¥æ–‡ä»¶çš„å®Œæ•´ Chrome æ‰©å±•ç¨‹åº URIã€‚
* å®ƒæ˜¯ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚èƒŒæ™¯é¡µé¢è„šæœ¬ã€å†…å®¹è„šæœ¬ã€æµè§ˆå™¨æ“ä½œç­‰ã€‚
* å¦‚æœæ˜“å—æ”»å‡»çš„è¡Œä½äº JavaScript æ–‡ä»¶ä¸­ï¼Œåˆ™åŒ…æ‹¬å®ƒè¢«åŒ…å«çš„æ‰€æœ‰é¡µé¢çš„è·¯å¾„ä»¥åŠè¿™äº›é¡µé¢çš„ç±»å‹å’Œ [web_accessible_resource](https://developer.chrome.com/extensions/manifest/web_accessible_resources) çŠ¶æ€ã€‚
* **å†…å®¹å®‰å…¨ç­–ç•¥ (CSP) åˆ†æå™¨å’Œç»•è¿‡æ£€æŸ¥å™¨**ï¼šè¿™å°†æŒ‡å‡ºæ‰©å±•ç¨‹åº CSP ä¸­çš„å¼±ç‚¹ï¼Œå¹¶å°†ç…§äº®ç”±äºç™½åå• CDN ç­‰åŸå› å¯èƒ½ç»•è¿‡ CSP çš„ä»»ä½•æ½œåœ¨æ–¹å¼ã€‚
* **å·²çŸ¥æ˜“å—æ”»å‡»çš„åº“**ï¼šè¿™ä½¿ç”¨ [Retire.js](https://retirejs.github.io/retire.js/) æ£€æŸ¥ä»»ä½•å·²çŸ¥æ˜“å—æ”»å‡»çš„ JavaScript åº“çš„ä½¿ç”¨ã€‚
* ä¸‹è½½æ‰©å±•ç¨‹åºå’Œæ ¼å¼åŒ–ç‰ˆæœ¬ã€‚
* ä¸‹è½½åŸå§‹æ‰©å±•ç¨‹åºã€‚
* ä¸‹è½½æ‰©å±•ç¨‹åºçš„ç¾åŒ–ç‰ˆæœ¬ï¼ˆè‡ªåŠ¨ç¾åŒ–çš„ HTML å’Œ JavaScriptï¼‰ã€‚
* æ‰«æç»“æœçš„è‡ªåŠ¨ç¼“å­˜ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œæ‰©å±•ç¨‹åºæ‰«ææ—¶å°†èŠ±è´¹å¤§é‡æ—¶é—´ã€‚ç„¶è€Œï¼Œç¬¬äºŒæ¬¡ï¼Œå‡è®¾æ‰©å±•ç¨‹åºæ²¡æœ‰æ›´æ–°ï¼Œç”±äºç»“æœè¢«ç¼“å­˜ï¼Œå‡ ä¹æ˜¯ç¬é—´çš„ã€‚
* å¯é“¾æ¥çš„æŠ¥å‘Š URLï¼Œè½»æ¾å°†å…¶ä»–äººé“¾æ¥åˆ°ç”± tarnish ç”Ÿæˆçš„æ‰©å±•ç¨‹åºæŠ¥å‘Šã€‚

### [Neto](https://github.com/elevenpaths/neto)

Neto é¡¹ç›®æ˜¯ä¸€ä¸ª Python 3 åŒ…ï¼Œæ—¨åœ¨åˆ†æå’Œæ­ç¤º Firefox å’Œ Chrome ç­‰çŸ¥åæµè§ˆå™¨çš„æµè§ˆå™¨æ’ä»¶å’Œæ‰©å±•ç¨‹åºçš„éšè—åŠŸèƒ½ã€‚å®ƒè‡ªåŠ¨åŒ–äº†è§£å‹ç¼©æ‰“åŒ…æ–‡ä»¶çš„è¿‡ç¨‹ï¼Œä»¥ä»æ‰©å±•ç¨‹åºä¸­çš„ç›¸å…³èµ„æºï¼ˆå¦‚ `manifest.json`ã€æœ¬åœ°åŒ–æ–‡ä»¶å¤¹æˆ– JavaScript å’Œ HTML æºæ–‡ä»¶ï¼‰ä¸­æå–è¿™äº›åŠŸèƒ½ã€‚

## å‚è€ƒèµ„æ–™

* **æ„Ÿè°¢** [**@naivenom**](https://twitter.com/naivenom) **åœ¨è¿™ä¸ªæ–¹æ³•è®ºä¸Šçš„å¸®åŠ©**
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)
* [https://palant.info/2022/08/10/anatomy-of-a-basic-extension/](https://palant.info/2022/08/10/anatomy-of-a-basic-extension/)
* [https://palant.info/2022/08/24/attack-surface-of-extension-pages/](https://palant.info/2022/08/24/attack-surface-of-extension-pages/)
* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://help.passbolt.com/assets/files/PBL-02-report.pdf](https://help.passbolt.com/assets/files/PBL-02-report.pdf)
* [https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts)
* [https://developer.chrome.com/docs/extensions/mv2/background-pages](https://developer.chrome.com/docs/extensions/mv2/background-pages)
* [https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/](https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
```
