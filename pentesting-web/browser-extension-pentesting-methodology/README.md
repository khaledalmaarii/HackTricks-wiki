# Browser Extension Pentesting Methodology

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì€ JavaScriptë¡œ ì‘ì„±ë˜ë©° ë¸Œë¼ìš°ì €ì— ì˜í•´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¡œë“œë©ë‹ˆë‹¤. ê° í™•ì¥ í”„ë¡œê·¸ë¨ì€ [DOM](https://www.w3schools.com/js/js\_htmldom.asp)ì„ ê°€ì§€ê³  ìˆì§€ë§Œ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì˜ DOMê³¼ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì˜ ê¸°ë°€ì„±, ë¬´ê²°ì„± ë° ê°€ìš©ì„±(CIA)ì„ ìœ„í˜‘í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

## Main Components

í™•ì¥ í”„ë¡œê·¸ë¨ ë ˆì´ì•„ì›ƒì€ ì‹œê°í™”í•  ë•Œ ê°€ì¥ ì˜ ë³´ì´ë©° ì„¸ ê°€ì§€ êµ¬ì„± ìš”ì†Œë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ê° êµ¬ì„± ìš”ì†Œë¥¼ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

<figure><img src="../../.gitbook/assets/image (16) (1).png" alt=""><figcaption><p><a href="http://webblaze.cs.berkeley.edu/papers/Extensions.pdf">http://webblaze.cs.berkeley.edu/papers/Extensions.pdf</a></p></figcaption></figure>

### **Content Scripts**

ê° ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” **ë‹¨ì¼ ì›¹ í˜ì´ì§€**ì˜ DOMì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ë”°ë¼ì„œ **ì ì¬ì ìœ¼ë¡œ ì•…ì˜ì ì¸ ì…ë ¥**ì— ë…¸ì¶œë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” í™•ì¥ í”„ë¡œê·¸ë¨ ì½”ì–´ì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ ì™¸ì—ëŠ” ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.

### **Extension Core**

í™•ì¥ í”„ë¡œê·¸ë¨ ì½”ì–´ëŠ” ëŒ€ë¶€ë¶„ì˜ í™•ì¥ í”„ë¡œê·¸ë¨ ê¶Œí•œ/ì ‘ê·¼ì„ í¬í•¨í•˜ì§€ë§Œ, í™•ì¥ í”„ë¡œê·¸ë¨ ì½”ì–´ëŠ” [XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest) ë° ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ì„œë§Œ ì›¹ ì½˜í…ì¸ ì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, í™•ì¥ í”„ë¡œê·¸ë¨ ì½”ì–´ëŠ” í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

### **Native Binary**

í™•ì¥ í”„ë¡œê·¸ë¨ì€ **ì‚¬ìš©ìì˜ ì „ì²´ ê¶Œí•œìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë„¤ì´í‹°ë¸Œ ë°”ì´ë„ˆë¦¬**ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. ë„¤ì´í‹°ë¸Œ ë°”ì´ë„ˆë¦¬ëŠ” Flash ë° ê¸°íƒ€ ë¸Œë¼ìš°ì € í”ŒëŸ¬ê·¸ì¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” í‘œì¤€ Netscape Plugin Application Programming Interface ([NPAPI](https://en.wikipedia.org/wiki/NPAPI))ë¥¼ í†µí•´ í™•ì¥ í”„ë¡œê·¸ë¨ ì½”ì–´ì™€ ìƒí˜¸ì‘ìš©í•©ë‹ˆë‹¤.

### Boundaries

{% hint style="danger" %}
ì‚¬ìš©ìì˜ ì „ì²´ ê¶Œí•œì„ ì–»ìœ¼ë ¤ë©´ ê³µê²©ìëŠ” í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì½”ì–´ë¡œ, ê·¸ë¦¬ê³  í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì½”ì–´ì—ì„œ ë„¤ì´í‹°ë¸Œ ë°”ì´ë„ˆë¦¬ë¡œ ì•…ì˜ì ì¸ ì…ë ¥ì„ ì „ë‹¬í•˜ë„ë¡ ì„¤ë“í•´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}

í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ê° êµ¬ì„± ìš”ì†ŒëŠ” **ê°•ë ¥í•œ ë³´í˜¸ ê²½ê³„**ë¡œ ì„œë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê° êµ¬ì„± ìš”ì†ŒëŠ” **ë³„ë„ì˜ ìš´ì˜ ì²´ì œ í”„ë¡œì„¸ìŠ¤**ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì™€ í™•ì¥ í”„ë¡œê·¸ë¨ ì½”ì–´ëŠ” ëŒ€ë¶€ë¶„ì˜ ìš´ì˜ ì²´ì œ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” **ìƒŒë“œë°•ìŠ¤ í”„ë¡œì„¸ìŠ¤**ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

ë˜í•œ, ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” **ë³„ë„ì˜ JavaScript í™ì—ì„œ ì‹¤í–‰**ë˜ì–´ ê´€ë ¨ ì›¹ í˜ì´ì§€ì™€ ë¶„ë¦¬ë©ë‹ˆë‹¤. ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì™€ ì›¹ í˜ì´ì§€ëŠ” **ê°™ì€ ê¸°ë³¸ DOMì— ì ‘ê·¼**í•  ìˆ˜ ìˆì§€ë§Œ, ë‘ ê°œëŠ” **JavaScript í¬ì¸í„°ë¥¼ êµí™˜í•˜ì§€ ì•Š**ì•„ JavaScript ê¸°ëŠ¥ì˜ ìœ ì¶œì„ ë°©ì§€í•©ë‹ˆë‹¤.

## **`manifest.json`**

Chrome í™•ì¥ í”„ë¡œê·¸ë¨ì€ ë‹¨ìˆœíˆ [.crx íŒŒì¼ í™•ì¥ì](https://www.lifewire.com/crx-file-2620391)ë¥¼ ê°€ì§„ ZIP í´ë”ì…ë‹ˆë‹¤. í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì½”ì–´ëŠ” í´ë”ì˜ ë£¨íŠ¸ì— ìˆëŠ” **`manifest.json`** íŒŒì¼ë¡œ, ë ˆì´ì•„ì›ƒ, ê¶Œí•œ ë° ê¸°íƒ€ êµ¬ì„± ì˜µì…˜ì„ ì§€ì •í•©ë‹ˆë‹¤.

Example:
```json
{
"manifest_version": 2,
"name": "My extension",
"version": "1.0",
"permissions": [
"storage"
],
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
"background": {
"scripts": [
"background.js"
]
},
"options_ui": {
"page": "options.html"
}
}
```
### `content_scripts`

Content scriptsëŠ” ì‚¬ìš©ìê°€ **ì¼ì¹˜í•˜ëŠ” í˜ì´ì§€ë¡œ ì´ë™í•  ë•Œë§ˆë‹¤** **ë¡œë“œ**ë©ë‹ˆë‹¤. ì´ ê²½ìš° **`https://example.com/*`** í‘œí˜„ê³¼ ì¼ì¹˜í•˜ëŠ” ëª¨ë“  í˜ì´ì§€ì´ì§€ë§Œ **`*://*/*/business*`** ì •ê·œ í‘œí˜„ì‹ê³¼ëŠ” ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë“¤ì€ **í˜ì´ì§€ì˜ ìì²´ ìŠ¤í¬ë¦½íŠ¸ì²˜ëŸ¼** ì‹¤í–‰ë˜ë©° í˜ì´ì§€ì˜ [Document Object Model (DOM)](https://developer.mozilla.org/en-US/docs/Web/API/Document\_Object\_Model)ì— ì„ì˜ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```json
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
```
ë” ë§ì€ URLì„ í¬í•¨í•˜ê±°ë‚˜ ì œì™¸í•˜ê¸° ìœ„í•´ **`include_globs`** ë° **`exclude_globs`**ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì´ê²ƒì€ [ì €ì¥ì†Œ API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage)ë¥¼ ì‚¬ìš©í•˜ì—¬ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì €ì¥ì†Œì—ì„œ `message` ê°’ì„ ê²€ìƒ‰í•  ë•Œ í˜ì´ì§€ì— ì„¤ëª… ë²„íŠ¼ì„ ì¶”ê°€í•˜ëŠ” ì˜ˆì œ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.
```js
chrome.storage.local.get("message", result =>
{
let div = document.createElement("div");
div.innerHTML = result.message + " <button>Explain</button>";
div.querySelector("button").addEventListener("click", () =>
{
chrome.runtime.sendMessage("explain");
});
document.body.appendChild(div);
});
```
<figure><img src="../../.gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

ì´ ë²„íŠ¼ì´ í´ë¦­ë˜ë©´ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì— ì˜í•´ í™•ì¥ í˜ì´ì§€ë¡œ ë©”ì‹œì§€ê°€ ì „ì†¡ë©ë‹ˆë‹¤. ì´ëŠ” [**runtime.sendMessage() API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage)ë¥¼ í™œìš©í•˜ì—¬ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” APIì— ì§ì ‘ ì ‘ê·¼í•˜ëŠ” ë° ì œí•œì´ ìˆìœ¼ë©°, `storage`ê°€ ëª‡ ê°€ì§€ ì˜ˆì™¸ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ì˜ˆì™¸ë¥¼ ë„˜ì–´ì„œëŠ” ê¸°ëŠ¥ì„ ìœ„í•´ì„œëŠ” ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ê°€ í†µì‹ í•  ìˆ˜ ìˆëŠ” í™•ì¥ í˜ì´ì§€ë¡œ ë©”ì‹œì§€ê°€ ì „ì†¡ë©ë‹ˆë‹¤.

{% hint style="warning" %}
ë¸Œë¼ìš°ì €ì— ë”°ë¼ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì˜ ê¸°ëŠ¥ì´ ì•½ê°„ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Chromium ê¸°ë°˜ ë¸Œë¼ìš°ì €ì˜ ê²½ìš° ê¸°ëŠ¥ ëª©ë¡ì€ [Chrome Developers documentation](https://developer.chrome.com/docs/extensions/mv3/content\_scripts/#capabilities)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, Firefoxì˜ ê²½ìš° [MDN](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content\_scripts#webextension\_apis)ì´ ì£¼ìš” ì¶œì²˜ì…ë‹ˆë‹¤.\
ë˜í•œ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ì™€ í†µì‹ í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì´ ìˆì–´, ì´ë¥¼ í†µí•´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ì‘ë‹µì„ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì ë„ ì£¼ëª©í•  ë§Œí•©ë‹ˆë‹¤.
{% endhint %}

Chromeì—ì„œ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë³´ê¸° ë° ë””ë²„ê¹…í•˜ë ¤ë©´ Chrome ê°œë°œì ë„êµ¬ ë©”ë‰´ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: ì˜µì…˜ > ì¶”ê°€ ë„êµ¬ > ê°œë°œì ë„êµ¬ ë˜ëŠ” Ctrl + Shift + Ië¥¼ ëˆŒëŸ¬ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê°œë°œì ë„êµ¬ê°€ í‘œì‹œë˜ë©´ **ì†ŒìŠ¤ íƒ­**ì„ í´ë¦­í•œ í›„ **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸** íƒ­ì„ í´ë¦­í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë‹¤ì–‘í•œ í™•ì¥ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê´€ì°°í•˜ê³  ì‹¤í–‰ íë¦„ì„ ì¶”ì í•˜ê¸° ìœ„í•´ ì¤‘ë‹¨ì ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì£¼ì…ëœ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸

{% hint style="success" %}
**ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” í•„ìˆ˜ì ì´ì§€ ì•Š**ìœ¼ë©°, **ë™ì ìœ¼ë¡œ** **ì£¼ì…**í•˜ê±°ë‚˜ **`tabs.executeScript`**ë¥¼ í†µí•´ ì›¹ í˜ì´ì§€ì— **í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì£¼ì…**í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‹¤ì œë¡œ ë” **ì„¸ë°€í•œ ì œì–´**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
{% endhint %}

ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì£¼ì…í•˜ê¸° ìœ„í•´ì„œëŠ” í™•ì¥ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì£¼ì…í•  í˜ì´ì§€ì— ëŒ€í•œ [í˜¸ìŠ¤íŠ¸ ê¶Œí•œ](https://developer.chrome.com/docs/extensions/reference/permissions)ì„ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê¶Œí•œì€ í™•ì¥ì˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë‚´ì—ì„œ **ìš”ì²­**í•˜ê±°ë‚˜ [**activeTab**](https://developer.chrome.com/docs/extensions/reference/manifest/activeTab)ì„ í†µí•´ ì„ì‹œë¡œ í™•ë³´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì˜ˆì‹œ activeTab ê¸°ë°˜ í™•ì¥

{% code title="manifest.json" %}
```json
{
"name": "My extension",
...
"permissions": [
"activeTab",
"scripting"
],
"background": {
"service_worker": "background.js"
},
"action": {
"default_title": "Action Button"
}
}
```
{% endcode %}

* **í´ë¦­ ì‹œ JS íŒŒì¼ ì£¼ì…:**
```javascript
// content-script.js
document.body.style.backgroundColor = "orange";

//service-worker.js - Inject the JS file
chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target: { tabId: tab.id },
files: ["content-script.js"]
});
});
```
* **í´ë¦­ ì‹œ í•¨ìˆ˜ ì£¼ì…:**
```javascript
//service-worker.js - Inject a function
function injectedFunction() {
document.body.style.backgroundColor = "orange";
}

chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target : {tabId : tab.id},
func : injectedFunction,
});
});
```
#### ìŠ¤í¬ë¦½íŒ… ê¶Œí•œì´ ìˆëŠ” ì˜ˆì œ
```javascript
// service-workser.js
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
excludeMatches : [ "*://*/*business*" ],
js : [ "contentScript.js" ],
}]);

// Another example
chrome.tabs.executeScript(tabId, { file: "content_script.js" });
```
ë” ë§ì€ URLì„ í¬í•¨í•˜ê±°ë‚˜ ì œì™¸í•˜ë ¤ë©´ **`include_globs`** ë° **`exclude_globs`**ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

### ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ `run_at`

`run_at` í•„ë“œëŠ” **JavaScript íŒŒì¼ì´ ì›¹ í˜ì´ì§€ì— ì£¼ì…ë˜ëŠ” ì‹œì **ì„ ì œì–´í•©ë‹ˆë‹¤. ì„ í˜¸ë˜ëŠ” ê¸°ë³¸ ê°’ì€ `"document_idle"`ì…ë‹ˆë‹¤.

ê°€ëŠ¥í•œ ê°’ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* **`document_idle`**: ê°€ëŠ¥í•œ ê²½ìš° ì–¸ì œë“ ì§€
* **`document_start`**: `css`ì˜ íŒŒì¼ì´ ë¡œë“œëœ í›„, ê·¸ëŸ¬ë‚˜ ë‹¤ë¥¸ DOMì´ êµ¬ì„±ë˜ê±°ë‚˜ ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ê¸° ì „ì—.
* **`document_end`**: DOMì´ ì™„ë£Œëœ ì§í›„, ê·¸ëŸ¬ë‚˜ ì´ë¯¸ì§€ ë° í”„ë ˆì„ê³¼ ê°™ì€ í•˜ìœ„ ë¦¬ì†ŒìŠ¤ê°€ ë¡œë“œë˜ê¸° ì „ì—.

#### `manifest.json`ì„ í†µí•´
```json
{
"name": "My extension",
...
"content_scripts": [
{
"matches": ["https://*.example.com/*"],
"run_at": "document_idle",
"js": ["contentScript.js"]
}
],
...
}

```
**`service-worker.js`**ë¥¼ í†µí•´
```javascript
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
runAt : "document_idle",
js : [ "contentScript.js" ],
}]);
```
### `background`

ë‚´ìš© ìŠ¤í¬ë¦½íŠ¸ê°€ ì „ì†¡í•œ ë©”ì‹œì§€ëŠ” **ë°°ê²½ í˜ì´ì§€**ì—ì„œ ìˆ˜ì‹ ë˜ë©°, ì´ëŠ” í™•ì¥ êµ¬ì„± ìš”ì†Œë¥¼ ì¡°ì •í•˜ëŠ” ì¤‘ì•™ ì—­í• ì„ í•©ë‹ˆë‹¤. íŠ¹íˆ, ë°°ê²½ í˜ì´ì§€ëŠ” í™•ì¥ì˜ ìˆ˜ëª… ë™ì•ˆ ì§€ì†ë˜ë©°, ì‚¬ìš©ìì™€ì˜ ì§ì ‘ì ì¸ ìƒí˜¸ì‘ìš© ì—†ì´ ì¡°ìš©íˆ ì‘ë™í•©ë‹ˆë‹¤. ìì²´ ë¬¸ì„œ ê°ì²´ ëª¨ë¸(DOM)ì„ ê°€ì§€ê³  ìˆì–´ ë³µì¡í•œ ìƒí˜¸ì‘ìš© ë° ìƒíƒœ ê´€ë¦¬ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

**ì£¼ìš” ì‚¬í•­**:

* **ë°°ê²½ í˜ì´ì§€ ì—­í• :** í™•ì¥ì˜ ì‹ ê²½ ì„¼í„° ì—­í• ì„ í•˜ì—¬ ë‹¤ì–‘í•œ ë¶€ë¶„ ê°„ì˜ í†µì‹  ë° ì¡°ì •ì„ ë³´ì¥í•©ë‹ˆë‹¤.
* **ì§€ì†ì„±:** ì‚¬ìš©ìì—ê²ŒëŠ” ë³´ì´ì§€ ì•Šì§€ë§Œ í™•ì¥ì˜ ê¸°ëŠ¥ì— í•„ìˆ˜ì ì¸ í•­ìƒ ì¡´ì¬í•˜ëŠ” ê°œì²´ì…ë‹ˆë‹¤.
* **ìë™ ìƒì„±:** ëª…ì‹œì ìœ¼ë¡œ ì •ì˜ë˜ì§€ ì•Šì€ ê²½ìš°, ë¸Œë¼ìš°ì €ëŠ” ìë™ìœ¼ë¡œ ë°°ê²½ í˜ì´ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ ìë™ ìƒì„±ëœ í˜ì´ì§€ëŠ” í™•ì¥ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì— ì§€ì •ëœ ëª¨ë“  ë°°ê²½ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í¬í•¨í•˜ì—¬ í™•ì¥ì˜ ë°°ê²½ ì‘ì—…ì´ ì›í™œí•˜ê²Œ ì‘ë™í•˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.

{% hint style="success" %}
ëª…ì‹œì ìœ¼ë¡œ ì„ ì–¸ë˜ì§€ ì•Šì•˜ì„ ë•Œ ë¸Œë¼ìš°ì €ê°€ ë°°ê²½ í˜ì´ì§€ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” í¸ë¦¬í•¨ì€ ëª¨ë“  í•„ìš”í•œ ë°°ê²½ ìŠ¤í¬ë¦½íŠ¸ê°€ í†µí•©ë˜ê³  ì‘ë™í•˜ë„ë¡ ë³´ì¥í•˜ì—¬ í™•ì¥ ì„¤ì • í”„ë¡œì„¸ìŠ¤ë¥¼ ê°„ì†Œí™”í•©ë‹ˆë‹¤.
{% endhint %}

Example background script:
```js
chrome.runtime.onMessage.addListener((request, sender, sendResponse) =>
{
if (request == "explain")
{
chrome.tabs.create({ url: "https://example.net/explanation" });
}
})
```
It uses [runtime.onMessage API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage) to listen to messages. When an `"explain"` message is received, it uses [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) to open a page in a new tab.

To debug the background script you could go to the **extension details and inspect the service worker,** this will open the developer tools with the background script:

<figure><img src="https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/browser-extension-pentesting-methodology/broken-reference" alt=""><figcaption></figcaption></figure>

### ì˜µì…˜ í˜ì´ì§€ ë° ê¸°íƒ€

Browser extensions can contain various kinds of pages:

* **ì•¡ì…˜ í˜ì´ì§€**ëŠ” **í™•ì¥ ì•„ì´ì½˜**ì„ í´ë¦­í•  ë•Œ ë“œë¡­ë‹¤ìš´ì— í‘œì‹œë©ë‹ˆë‹¤.
* í™•ì¥ì´ **ìƒˆ íƒ­ì—ì„œ ë¡œë“œí• ** í˜ì´ì§€.
* **ì˜µì…˜ í˜ì´ì§€**: ì´ í˜ì´ì§€ëŠ” í´ë¦­í•  ë•Œ í™•ì¥ ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤. ì´ì „ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì—ì„œ ì œ ê²½ìš°ì—ëŠ” `chrome://extensions/?options=fadlhnelkbeojnebcbkacjilhnbjfjca`ì—ì„œ ì´ í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆì—ˆê±°ë‚˜ í´ë¦­í•˜ì—¬:

<figure><img src="../../.gitbook/assets/image (24).png" alt="" width="375"><figcaption></figcaption></figure>

Note that these pages aren't persistent like background pages as they load dynamically content on necessity. Despite this, they share certain capabilities with the background page:

* **Content Scriptsì™€ì˜ í†µì‹ :** ë°°ê²½ í˜ì´ì§€ì™€ ìœ ì‚¬í•˜ê²Œ, ì´ëŸ¬í•œ í˜ì´ì§€ëŠ” ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆì–´ í™•ì¥ ë‚´ ìƒí˜¸ì‘ìš©ì„ ì´‰ì§„í•©ë‹ˆë‹¤.
* **í™•ì¥ ì „ìš© APIì— ëŒ€í•œ ì ‘ê·¼:** ì´ëŸ¬í•œ í˜ì´ì§€ëŠ” í™•ì¥ì— ëŒ€í•´ ì •ì˜ëœ ê¶Œí•œì— ë”°ë¼ í™•ì¥ ì „ìš© APIì— ëŒ€í•œ í¬ê´„ì ì¸ ì ‘ê·¼ì„ ëˆ„ë¦½ë‹ˆë‹¤.

### `permissions` & `host_permissions`

**`permissions`**ì™€ **`host_permissions`**ëŠ” `manifest.json`ì˜ í•­ëª©ìœ¼ë¡œ, **ì–´ë–¤ ê¶Œí•œ**(ì €ì¥ì†Œ, ìœ„ì¹˜ ë“±)ì„ ë¸Œë¼ìš°ì € í™•ì¥ì´ ê°€ì§€ê³  ìˆëŠ”ì§€ì™€ **ì–´ë–¤ ì›¹ í˜ì´ì§€**ì—ì„œ ì´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

ë¸Œë¼ìš°ì € í™•ì¥ì´ ë§¤ìš° **íŠ¹ê¶Œì **ì¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì•…ì˜ì ì¸ í™•ì¥ì´ë‚˜ ì†ìƒëœ í™•ì¥ì€ ê³µê²©ìê°€ **ë¯¼ê°í•œ ì •ë³´ë¥¼ í›”ì¹˜ê³  ì‚¬ìš©ìì— ëŒ€í•´ ìŠ¤íŒŒì´í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ìˆ˜ë‹¨ì„ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

ì´ ì„¤ì •ì´ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ë° ì–´ë–»ê²Œ ë‚¨ìš©ë  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤:

{% content-ref url="browext-permissions-and-host_permissions.md" %}
[browext-permissions-and-host\_permissions.md](browext-permissions-and-host\_permissions.md)
{% endcontent-ref %}

### `content_security_policy`

**ì½˜í…ì¸  ë³´ì•ˆ ì •ì±…**ì€ `manifest.json` ë‚´ì—ì„œë„ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ì˜ëœ ê²ƒì´ ìˆë‹¤ë©´, **ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

ë¸Œë¼ìš°ì € í™•ì¥ í˜ì´ì§€ì˜ ê¸°ë³¸ ì„¤ì •ì€ ë‹¤ì†Œ ì œí•œì ì…ë‹ˆë‹¤:
```bash
script-src 'self'; object-src 'self';
```
CSP ë° ì ì¬ì ì¸ ìš°íšŒì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../content-security-policy-csp-bypass/)
{% endcontent-ref %}

### `web_accessible_resources`

ì›¹ í˜ì´ì§€ê°€ ë¸Œë¼ìš°ì € í™•ì¥ì˜ í˜ì´ì§€ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ”, ì˜ˆë¥¼ ë“¤ì–´ `.html` í˜ì´ì§€, ì´ í˜ì´ì§€ëŠ” `manifest.json`ì˜ **`web_accessible_resources`** í•„ë“œì— ì–¸ê¸‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.\
ì˜ˆë¥¼ ë“¤ì–´:
```javascript
{
...
"web_accessible_resources": [
{
"resources": [ "images/*.png" ],
"matches": [ "https://example.com/*" ]
},
{
"resources": [ "fonts/*.woff" ],
"matches": [ "https://example.com/*" ]
}
],
...
}
```
ì´ í˜ì´ì§€ëŠ” ë‹¤ìŒê³¼ ê°™ì€ URLì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
chrome-extension://<extension-id>/message.html
```
ê³µê°œ í™•ì¥ í”„ë¡œê·¸ë¨ì—ì„œëŠ” **extension-idì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:

<figure><img src="../../.gitbook/assets/image (1194).png" alt="" width="375"><figcaption></figcaption></figure>

í•˜ì§€ë§Œ, `manifest.json` ë§¤ê°œë³€ìˆ˜ **`use_dynamic_url`**ì´ ì‚¬ìš©ë˜ë©´, ì´ **idëŠ” ë™ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

{% hint style="success" %}
ì—¬ê¸°ì—ì„œ í˜ì´ì§€ê°€ ì–¸ê¸‰ë˜ë”ë¼ë„, **Content Security Policy** ë•ë¶„ì— **ClickJacking**ì— ëŒ€í•´ **ë³´í˜¸ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë”°ë¼ì„œ ClickJacking ê³µê²©ì´ ê°€ëŠ¥í•œì§€ í™•ì¸í•˜ê¸° ì „ì— ì´ë¥¼ (frame-ancestors ì„¹ì…˜) í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}

ì´ëŸ¬í•œ í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì´ í˜ì´ì§€ë“¤ì´ **ì ì¬ì ìœ¼ë¡œ ClickJackingì— ì·¨ì•½í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤**:

{% content-ref url="browext-clickjacking.md" %}
[browext-clickjacking.md](browext-clickjacking.md)
{% endcontent-ref %}

{% hint style="success" %}
ì´ëŸ¬í•œ í˜ì´ì§€ê°€ í™•ì¥ í”„ë¡œê·¸ë¨ì— ì˜í•´ì„œë§Œ ë¡œë“œë˜ê³  ë¬´ì‘ìœ„ URLì— ì˜í•´ ë¡œë“œë˜ì§€ ì•Šë„ë¡ í—ˆìš©í•˜ë©´ ClickJacking ê³µê²©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

{% hint style="danger" %}
**`web_accessible_resources`**ì˜ í˜ì´ì§€ì™€ í™•ì¥ì˜ ë‹¤ë¥¸ í˜ì´ì§€ë“¤ë„ **ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ì— ì—°ë½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë”°ë¼ì„œ ì´ëŸ¬í•œ í˜ì´ì§€ ì¤‘ í•˜ë‚˜ê°€ **XSS**ì— ì·¨ì•½í•˜ë‹¤ë©´ ë” í° ì·¨ì•½ì ì„ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ, **`web_accessible_resources`**ì— í‘œì‹œëœ í˜ì´ì§€ë§Œ iframe ë‚´ì—ì„œ ì—´ ìˆ˜ ìˆì§€ë§Œ, ìƒˆ íƒ­ì—ì„œ í™•ì¥ IDë¥¼ ì•Œê³  ìˆìœ¼ë©´ í™•ì¥ì˜ ëª¨ë“  í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë™ì¼í•œ ë§¤ê°œë³€ìˆ˜ë¥¼ ì•…ìš©í•˜ëŠ” XSSê°€ ë°œê²¬ë˜ë©´, í˜ì´ì§€ê°€ **`web_accessible_resources`**ì— êµ¬ì„±ë˜ì–´ ìˆì§€ ì•Šë”ë¼ë„ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### `externally_connectable`

[**ë¬¸ì„œ**](https://developer.chrome.com/docs/extensions/reference/manifest/externally-connectable)ì— ë”°ë¥´ë©´, `"externally_connectable"` ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì†ì„±ì€ **ì–´ë–¤ í™•ì¥ í”„ë¡œê·¸ë¨ê³¼ ì›¹ í˜ì´ì§€ê°€** [runtime.connect](https://developer.chrome.com/docs/extensions/reference/runtime#method-connect) ë° [runtime.sendMessage](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage)ë¥¼ í†µí•´ ê·€í•˜ì˜ í™•ì¥ í”„ë¡œê·¸ë¨ì— ì—°ê²°í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤.

* **`externally_connectable`** í‚¤ê°€ ê·€í•˜ì˜ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì— **ì„ ì–¸ë˜ì§€ ì•Šì•˜ê±°ë‚˜** **`"ids": ["*"]`**ë¡œ ì„ ì–¸ëœ ê²½ìš°, **ëª¨ë“  í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì—°ê²°í•  ìˆ˜ ìˆì§€ë§Œ, ì›¹ í˜ì´ì§€ëŠ” ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**.
* **íŠ¹ì • IDê°€ ì§€ì •ëœ ê²½ìš°**, ì˜ˆë¥¼ ë“¤ì–´ `"ids": ["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"]`ì™€ ê°™ì´, **ì˜¤ì§ í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ë§Œ** ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **matches**ê°€ ì§€ì •ëœ ê²½ìš°, í•´ë‹¹ ì›¹ ì•±ì€ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```json
"matches": [
"https://*.google.com/*",
"*://*.chromium.org/*",
```
* ë¹„ì–´ ìˆëŠ” ê²ƒìœ¼ë¡œ ì§€ì •ëœ ê²½ìš°: **`"externally_connectable": {}`**, ì–´ë–¤ ì•±ì´ë‚˜ ì›¹ë„ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ì—¬ê¸°ì—ì„œ **ì ì€ í™•ì¥ ë° URL**ì´ í‘œì‹œë ìˆ˜ë¡ **ê³µê²© í‘œë©´ì´ ì‘ì•„ì§‘ë‹ˆë‹¤**.

{% hint style="danger" %}
ì›¹ í˜ì´ì§€ê°€ **XSS ë˜ëŠ” íƒˆì·¨ì— ì·¨ì•½**í•œ ê²½ìš° **`externally_connectable`**ì— í‘œì‹œë˜ë©´, ê³µê²©ìëŠ” **ë°°ê²½ ìŠ¤í¬ë¦½íŠ¸ì— ì§ì ‘ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜** ìˆì–´, Content Scriptì™€ ê·¸ CSPë¥¼ ì™„ì „íˆ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ, ì´ëŠ” **ë§¤ìš° ê°•ë ¥í•œ ìš°íšŒ**ì…ë‹ˆë‹¤.

ê²Œë‹¤ê°€, í´ë¼ì´ì–¸íŠ¸ê°€ ì•…ì„± í™•ì¥ì„ ì„¤ì¹˜í•˜ë©´, ì·¨ì•½í•œ í™•ì¥ê³¼ í†µì‹ í•  ìˆ˜ ì—†ë”ë¼ë„ **í—ˆìš©ëœ ì›¹ í˜ì´ì§€ì— XSS ë°ì´í„°ë¥¼ ì£¼ì…**í•˜ê±°ë‚˜ **`WebRequest`** ë˜ëŠ” **`DeclarativeNetRequest`** APIë¥¼ ì•…ìš©í•˜ì—¬ íŠ¹ì • ë„ë©”ì¸ì—ì„œ ìš”ì²­ì„ ì¡°ì‘í•˜ê³  **JavaScript íŒŒì¼**ì— ëŒ€í•œ í˜ì´ì§€ ìš”ì²­ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ëŒ€ìƒ í˜ì´ì§€ì˜ CSPê°€ ì´ëŸ¬í•œ ê³µê²©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤). ì´ ì•„ì´ë””ì–´ëŠ” [**ì´ ê¸€**](https://www.darkrelay.com/post/opera-zero-day-rce-vulnerability)ì—ì„œ ë‚˜ì™”ìŠµë‹ˆë‹¤.
{% endhint %}

## í†µì‹  ìš”ì•½

### í™•ì¥ <--> ì›¹ì•±

ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì™€ ì›¹ í˜ì´ì§€ ê°„ì˜ í†µì‹ ì—ëŠ” ì¼ë°˜ì ìœ¼ë¡œ í¬ìŠ¤íŠ¸ ë©”ì‹œì§€ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ **`window.postMessage`** í•¨ìˆ˜ í˜¸ì¶œì„ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” **`window.addEventListener`**ì™€ ê°™ì€ ë¦¬ìŠ¤ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í™•ì¥ì´ **Post Messageë¥¼ ë³´ë‚´ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ í†µì‹ **í•  ìˆ˜ë„ ìˆìœ¼ë©° (ë”°ë¼ì„œ ì›¹ì€ ì´ë¥¼ ì˜ˆìƒí•´ì•¼ í•¨) ì›¹ì´ ìƒˆ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•˜ë„ë¡ ë§Œë“¤ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

### í™•ì¥ ë‚´ë¶€

ì¼ë°˜ì ìœ¼ë¡œ **`chrome.runtime.sendMessage`** í•¨ìˆ˜ê°€ í™•ì¥ ë‚´ì—ì„œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ë° ì‚¬ìš©ë˜ë©° (ì¼ë°˜ì ìœ¼ë¡œ `background` ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì²˜ë¦¬ë¨), ì´ë¥¼ ìˆ˜ì‹ í•˜ê³  ì²˜ë¦¬í•˜ê¸° ìœ„í•´ **`chrome.runtime.onMessage.addListener`**ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¦¬ìŠ¤ë„ˆê°€ ì„ ì–¸ë©ë‹ˆë‹¤.

ë‹¨ì¼ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ëŒ€ì‹  ì§€ì†ì ì¸ ì—°ê²°ì„ ìœ„í•´ **`chrome.runtime.connect()`**ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìœ¼ë©°, ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ **ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê³ ** **ë°›ëŠ”** ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<details>

<summary><code>chrome.runtime.connect()</code> ì˜ˆì œ</summary>
```javascript
var port = chrome.runtime.connect();

// Listen for messages from the web page
window.addEventListener("message", (event) => {
// Only accept messages from the same window
if (event.source !== window) {
return;
}

// Check if the message type is "FROM_PAGE"
if (event.data.type && (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
// Forward the message to the background script
port.postMessage({ type: 'FROM_PAGE', text: event.data.text });
}
}, false);

// Listen for messages from the background script
port.onMessage.addListener(function(msg) {
console.log("Content script received message from background script:", msg);
// Handle the response message from the background script
});
```
</details>

íŠ¹ì • íƒ­ì— ìœ„ì¹˜í•œ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¡œ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ë•Œ **`chrome.tabs.sendMessage`**ë¥¼ í˜¸ì¶œí•˜ë©°, ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ **íƒ­ì˜ ID**ë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.

### í—ˆìš©ëœ `externally_connectable`ì—ì„œ í™•ì¥ìœ¼ë¡œ

`externally_connectable` êµ¬ì„±ì—ì„œ í—ˆìš©ëœ **ì›¹ ì•± ë° ì™¸ë¶€ ë¸Œë¼ìš°ì € í™•ì¥**ì€ ë‹¤ìŒì„ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```javascript
chrome.runtime.sendMessage(extensionId, ...
```
ì–´ë””ì—ì„œ **í™•ì¥ ID**ë¥¼ ì–¸ê¸‰í•´ì•¼ í•˜ëŠ”ì§€.

### ë„¤ì´í‹°ë¸Œ ë©”ì‹œì§•

ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹œìŠ¤í…œ ë‚´ì˜ ë°”ì´ë„ˆë¦¬ì™€ í†µì‹ í•  ìˆ˜ ìˆìœ¼ë©°, ì´ í†µì‹ ì´ ì ì ˆí•˜ê²Œ ë³´í˜¸ë˜ì§€ ì•Šìœ¼ë©´ **RCEì™€ ê°™ì€ ì¹˜ëª…ì ì¸ ì·¨ì•½ì ì— ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. [ìì„¸í•œ ë‚´ìš©ì€ ë‚˜ì¤‘ì—](./#native-messaging).
```javascript
chrome.runtime.sendNativeMessage(
'com.my_company.my_application',
{text: 'Hello'},
function (response) {
console.log('Received ' + response);
}
);
```
## Web **â†”ï¸** Content Script Communication

**ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ê°€ ì‘ë™í•˜ëŠ” í™˜ê²½ê³¼ í˜¸ìŠ¤íŠ¸ í˜ì´ì§€ê°€ ì¡´ì¬í•˜ëŠ” í™˜ê²½ì€ **ë¶„ë¦¬**ë˜ì–´ ìˆì–´ **ê²©ë¦¬**ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê²©ë¦¬ì—ë„ ë¶ˆêµ¬í•˜ê³  ë‘ í™˜ê²½ ëª¨ë‘ í˜ì´ì§€ì˜ **ë¬¸ì„œ ê°ì²´ ëª¨ë¸(DOM)**ê³¼ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. í˜¸ìŠ¤íŠ¸ í˜ì´ì§€ê°€ **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ì™€ í†µì‹ í•˜ê±°ë‚˜ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ í™•ì¥ê³¼ ê°„ì ‘ì ìœ¼ë¡œ í†µì‹ í•˜ê¸° ìœ„í•´ì„œëŠ” ë‘ ë‹¹ì‚¬ìê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” **DOM**ì„ í†µì‹  ì±„ë„ë¡œ í™œìš©í•´ì•¼ í•©ë‹ˆë‹¤.

### Post Messages

{% code title="content-script.js" %}
```javascript
// This is like "chrome.runtime.sendMessage" but to maintain the connection
var port = chrome.runtime.connect();

window.addEventListener("message", (event) => {
// We only accept messages from ourselves
if (event.source !== window) {
return;
}

if (event.data.type && (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
// Forward the message to the background script
port.postMessage(event.data.text);
}
}, false);
```
{% endcode %}

{% code title="example.js" %}
```javascript
document.getElementById("theButton").addEventListener("click", () => {
window.postMessage(
{type : "FROM_PAGE", text : "Hello from the webpage!"}, "*");
}, false);
```
{% endcode %}

ì•ˆì „í•œ Post Message í†µì‹ ì€ ìˆ˜ì‹ ëœ ë©”ì‹œì§€ì˜ ì§„ìœ„ë¥¼ í™•ì¸í•´ì•¼ í•˜ë©°, ì´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì—¬ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **`event.isTrusted`**: ì´ ê°’ì€ ì´ë²¤íŠ¸ê°€ ì‚¬ìš©ì í–‰ë™ì— ì˜í•´ íŠ¸ë¦¬ê±°ëœ ê²½ìš°ì—ë§Œ Trueì…ë‹ˆë‹¤.
* ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‚¬ìš©ìê°€ íŠ¹ì • í–‰ë™ì„ ìˆ˜í–‰í•  ë•Œë§Œ ë©”ì‹œì§€ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **origin domain**: ë©”ì‹œì§€ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆëŠ” ë„ë©”ì¸ì˜ í—ˆìš© ëª©ë¡ë§Œ í—ˆìš©í•©ë‹ˆë‹¤.
* ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ë§¤ìš° ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
* **Source**: `received_message.source !== window`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ê°€ **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆ˜ì‹  ëŒ€ê¸° ì¤‘ì¸ ë™ì¼í•œ ì°½**ì—ì„œ ì˜¨ ê²ƒì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì „ì˜ í™•ì¸ ì‚¬í•­ì´ ìˆ˜í–‰ë˜ì—ˆë”ë¼ë„ ì·¨ì•½í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **ì ì¬ì ì¸ Post Message ìš°íšŒ**ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤:

{% content-ref url="../postmessage-vulnerabilities/" %}
[postmessage-vulnerabilities](../postmessage-vulnerabilities/)
{% endcontent-ref %}

### Iframe

ë˜ ë‹¤ë¥¸ ê°€ëŠ¥í•œ í†µì‹  ë°©ë²•ì€ **Iframe URL**ì„ í†µí•œ ê²ƒì…ë‹ˆë‹¤. ì˜ˆì‹œëŠ” ë‹¤ìŒì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

### DOM

ì´ê²ƒì€ "ì •í™•íˆ" í†µì‹  ë°©ë²•ì€ ì•„ë‹ˆì§€ë§Œ, **ì›¹ê³¼ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” ì›¹ DOMì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë”°ë¼ì„œ **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ê°€ ê·¸ë¡œë¶€í„° ì •ë³´ë¥¼ ì½ê³  **ì›¹ DOMì„ ì‹ ë¢°í•˜ëŠ” ê²½ìš°**, ì›¹ì€ **ì´ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤** (ì›¹ì„ ì‹ ë¢°í•´ì„œëŠ” ì•ˆ ë˜ê±°ë‚˜, ì›¹ì´ XSSì— ì·¨ì•½í•˜ê¸° ë•Œë¬¸ì—) ê·¸ë¦¬ê³  **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì†ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

**ë¸Œë¼ìš°ì € í™•ì¥ì„ ì†ìƒì‹œí‚¤ê¸° ìœ„í•œ DOM ê¸°ë°˜ XSSì˜ ì˜ˆì‹œ**ëŠ” ë‹¤ìŒì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ **â†”ï¸** ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ í†µì‹ 

ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” [**runtime.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) **ë˜ëŠ”** [**tabs.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/tabs#method-sendMessage) í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì¼íšŒì„± JSON ì§ë ¬í™” ê°€ëŠ¥** ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì‘ë‹µ**ì„ ì²˜ë¦¬í•˜ë ¤ë©´ ë°˜í™˜ëœ **Promise**ë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤. ê·¸ëŸ¬ë‚˜ ì´ì „ í˜¸í™˜ì„±ì„ ìœ„í•´ ë§ˆì§€ë§‰ ì¸ìˆ˜ë¡œ **ì½œë°±**ì„ ì—¬ì „íˆ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ì—ì„œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ëª¨ìŠµì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```javascript
(async () => {
const response = await chrome.runtime.sendMessage({greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
**í™•ì¥**ì—ì„œ ìš”ì²­ ë³´ë‚´ê¸° (ë³´í†µ **ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸**). ì„ íƒí•œ íƒ­ì˜ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ë°©ë²•ì˜ ì˜ˆ:
```javascript
// From https://stackoverflow.com/questions/36153999/how-to-send-a-message-between-chrome-extension-popup-and-content-script
(async () => {
const [tab] = await chrome.tabs.query({active: true, lastFocusedWindow: true});
const response = await chrome.tabs.sendMessage(tab.id, {greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
On the **receiving end**, you need to set up an [**runtime.onMessage**](https://developer.chrome.com/docs/extensions/reference/runtime#event-onMessage) **event listener** to handle the message. This looks the same from a content script or extension page.
```javascript
// From https://stackoverflow.com/questions/70406787/javascript-send-message-from-content-js-to-background-js
chrome.runtime.onMessage.addListener(
function(request, sender, sendResponse) {
console.log(sender.tab ?
"from a content script:" + sender.tab.url :
"from the extension");
if (request.greeting === "hello")
sendResponse({farewell: "goodbye"});
}
);
```
ì˜ˆì œì—ì„œ ê°•ì¡°ëœ ë°”ì™€ ê°™ì´, **`sendResponse()`**ëŠ” ë™ê¸° ë°©ì‹ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. `sendResponse()`ì˜ ë¹„ë™ê¸° ì‹¤í–‰ì„ ìœ„í•´ `onMessage` ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ `return true;`ë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.

ì¤‘ìš”í•œ ê³ ë ¤ ì‚¬í•­ì€ ì—¬ëŸ¬ í˜ì´ì§€ê°€ `onMessage` ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ë„ë¡ ì„¤ì •ëœ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ **íŠ¹ì • ì´ë²¤íŠ¸ì— ëŒ€í•´ `sendResponse()`ë¥¼ ì‹¤í–‰í•˜ëŠ” ì²« ë²ˆì§¸ í˜ì´ì§€**ë§Œì´ ì‘ë‹µì„ íš¨ê³¼ì ìœ¼ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë™ì¼í•œ ì´ë²¤íŠ¸ì— ëŒ€í•œ í›„ì† ì‘ë‹µì€ ê³ ë ¤ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ìƒˆë¡œìš´ í™•ì¥ì„ ë§Œë“¤ ë•ŒëŠ” ì½œë°±ë³´ë‹¤ í”„ë¡œë¯¸ìŠ¤ë¥¼ ì„ í˜¸í•´ì•¼ í•©ë‹ˆë‹¤. ì½œë°± ì‚¬ìš©ê³¼ ê´€ë ¨í•˜ì—¬, `sendResponse()` í•¨ìˆ˜ëŠ” ë™ê¸° ì»¨í…ìŠ¤íŠ¸ ë‚´ì—ì„œ ì§ì ‘ ì‹¤í–‰ë˜ê±°ë‚˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ `true`ë¥¼ ë°˜í™˜í•˜ì—¬ ë¹„ë™ê¸° ì‘ì—…ì„ ë‚˜íƒ€ë‚´ëŠ” ê²½ìš°ì—ë§Œ ìœ íš¨í•˜ë‹¤ê³  ê°„ì£¼ë©ë‹ˆë‹¤. ë§Œì•½ ì–´ë–¤ í•¸ë“¤ëŸ¬ë„ `true`ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šê±°ë‚˜ `sendResponse()` í•¨ìˆ˜ê°€ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°ë˜ë©´(ê°€ë¹„ì§€ ìˆ˜ì§‘ë¨), `sendMessage()` í•¨ìˆ˜ì™€ ì—°ê²°ëœ ì½œë°±ì´ ê¸°ë³¸ì ìœ¼ë¡œ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤.

## ë„¤ì´í‹°ë¸Œ ë©”ì‹œì§•

ë¸Œë¼ìš°ì € í™•ì¥ì€ **stdinì„ í†µí•´ ì‹œìŠ¤í…œì˜ ë°”ì´ë„ˆë¦¬ì™€ í†µì‹ í•  ìˆ˜** ìˆìŠµë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” jsonì„ ì„¤ì¹˜í•´ì•¼ í•˜ë©°, jsonì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```json
{
"name": "com.my_company.my_application",
"description": "My Application",
"path": "C:\\Program Files\\My Application\\chrome_native_messaging_host.exe",
"type": "stdio",
"allowed_origins": ["chrome-extension://knldjmfmopnpolahpmmgbagdohdnhkik/"]
}
```
`name`ì€ ë¸Œë¼ìš°ì € í™•ì¥ì˜ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ í†µì‹ í•˜ê¸° ìœ„í•´ [`runtime.connectNative()`](https://developer.chrome.com/docs/extensions/reference/api/runtime#method-connectNative) ë˜ëŠ” [`runtime.sendNativeMessage()`](https://developer.chrome.com/docs/extensions/reference/api/runtime#method-sendNativeMessage)ì— ì „ë‹¬ë˜ëŠ” ë¬¸ìì—´ì…ë‹ˆë‹¤. `path`ëŠ” ë°”ì´ë„ˆë¦¬ì˜ ê²½ë¡œì´ë©°, ìœ íš¨í•œ `type`ì€ stdio(í‘œì¤€ ì…ë ¥ ë° í‘œì¤€ ì¶œë ¥ ì‚¬ìš©) í•˜ë‚˜ë¿ì´ê³ , `allowed_origins`ëŠ” ì´ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í™•ì¥ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤(ì™€ì¼ë“œì¹´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤).

Chrome/Chromiumì€ ì´ jsonì„ ì¼ë¶€ Windows ë ˆì§€ìŠ¤íŠ¸ë¦¬ì™€ macOS ë° Linuxì˜ ì¼ë¶€ ê²½ë¡œì—ì„œ ê²€ìƒ‰í•©ë‹ˆë‹¤(ìì„¸í•œ ì •ë³´ëŠ” [**docs**](https://developer.chrome.com/docs/extensions/develop/concepts/native-messaging)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤).

{% hint style="success" %}
ë¸Œë¼ìš°ì € í™•ì¥ì€ ì´ í†µì‹ ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ `nativeMessaing` ê¶Œí•œì„ ì„ ì–¸í•´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}

ì´ê²ƒì€ ë„¤ì´í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ì¼ë¶€ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œì˜ ëª¨ìŠµì…ë‹ˆë‹¤:
```javascript
chrome.runtime.sendNativeMessage(
'com.my_company.my_application',
{text: 'Hello'},
function (response) {
console.log('Received ' + response);
}
);
```
In [**ì´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸**](https://spaceraccoon.dev/universal-code-execution-browser-extensions/)ì—ì„œëŠ” ë„¤ì´í‹°ë¸Œ ë©”ì‹œì§€ë¥¼ ì•…ìš©í•˜ëŠ” ì·¨ì•½í•œ íŒ¨í„´ì´ ì œì•ˆë©ë‹ˆë‹¤:

1. ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì€ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ì— ëŒ€í•œ ì™€ì¼ë“œì¹´ë“œ íŒ¨í„´ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
2. ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” `sendMessage`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ì— `postMessage` ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
3. ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ëŠ” `sendNativeMessage`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë„¤ì´í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
4. ë„¤ì´í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë©”ì‹œì§€ë¥¼ ìœ„í—˜í•˜ê²Œ ì²˜ë¦¬í•˜ì—¬ ì½”ë“œ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ê·¸ ì•ˆì—ì„œ **ë¸Œë¼ìš°ì € í™•ì¥ì„ ì•…ìš©í•˜ì—¬ ì–´ë–¤ í˜ì´ì§€ì—ì„œë“  RCEë¡œ ê°€ëŠ” ì˜ˆì‹œê°€ ì„¤ëª…ë©ë‹ˆë‹¤**.

## ë©”ëª¨ë¦¬/ì½”ë“œ/í´ë¦½ë³´ë“œì˜ ë¯¼ê°í•œ ì •ë³´

ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì´ **ë¯¼ê°í•œ ì •ë³´ë¥¼ ë©”ëª¨ë¦¬ ì•ˆì— ì €ì¥**í•˜ëŠ” ê²½ìš°, ì´ëŠ” **ë¤í”„**ë  ìˆ˜ ìˆìœ¼ë©° (íŠ¹íˆ Windows ê¸°ê¸°ì—ì„œ) ì´ ì •ë³´ë¥¼ **ê²€ìƒ‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ë©”ëª¨ë¦¬ëŠ” **ì•ˆì „í•˜ë‹¤ê³  ê°„ì£¼ë˜ì–´ì„œëŠ” ì•ˆ ë˜ë©°**, ìê²© ì¦ëª…ì´ë‚˜ ë‹ˆëª¨ë‹‰ êµ¬ë¬¸ê³¼ ê°™ì€ **ë¯¼ê°í•œ ì •ë³´ëŠ” ì €ì¥ë˜ì–´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤**.

ë¬¼ë¡ , **ì½”ë“œì— ë¯¼ê°í•œ ì •ë³´ë¥¼ ë„£ì§€ ë§ˆì‹­ì‹œì˜¤**, ì™œëƒí•˜ë©´ ì´ëŠ” **ê³µê°œ**ë  ê²ƒì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë¸Œë¼ìš°ì €ì—ì„œ ë©”ëª¨ë¦¬ë¥¼ ë¤í”„í•˜ë ¤ë©´ **í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ë¥¼ ë¤í”„**í•˜ê±°ë‚˜ ë¸Œë¼ìš°ì € í™•ì¥ì˜ **ì„¤ì •**ìœ¼ë¡œ ê°€ì„œ **`Inspect pop-up`**ì„ í´ë¦­í•œ í›„ **`Memory`** ì„¹ì…˜ì—ì„œ **`Take a snapshot`**ì„ í´ë¦­í•˜ê³  **`CTRL+F`**ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤ëƒ…ìƒ· ë‚´ì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê²Œë‹¤ê°€, ë‹ˆëª¨ë‹‰ í‚¤ë‚˜ ë¹„ë°€ë²ˆí˜¸ì™€ ê°™ì€ ë§¤ìš° ë¯¼ê°í•œ ì •ë³´ëŠ” **í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ëŠ” ê²ƒì„ í—ˆìš©í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤** (ë˜ëŠ” ìµœì†Œí•œ ëª‡ ì´ˆ í›„ì— í´ë¦½ë³´ë“œì—ì„œ ì œê±°í•´ì•¼ í•©ë‹ˆë‹¤) ì™œëƒí•˜ë©´ ê·¸ëŸ¬ë©´ í´ë¦½ë³´ë“œë¥¼ ëª¨ë‹ˆí„°ë§í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì´ë¥¼ ì–»ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

## ë¸Œë¼ìš°ì €ì— í™•ì¥ í”„ë¡œê·¸ë¨ ë¡œë“œí•˜ê¸°

1. **ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì„ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì••ì¶•ì„ í’‰ë‹ˆë‹¤.
2. **`chrome://extensions/`**ë¡œ ê°€ì„œ `ê°œë°œì ëª¨ë“œ`ë¥¼ **í™œì„±í™”**í•©ë‹ˆë‹¤.
3. **`Load unpacked`** ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

**Firefox**ì—ì„œëŠ” **`about:debugging#/runtime/this-firefox`**ë¡œ ê°€ì„œ **`Load Temporary Add-on`** ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

## ìŠ¤í† ì–´ì—ì„œ ì†ŒìŠ¤ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°

Chrome í™•ì¥ì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ê° ì˜µì…˜ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ê³¼ ì§€ì¹¨ì…ë‹ˆë‹¤.

### ëª…ë ¹ì¤„ì„ í†µí•´ ZIPìœ¼ë¡œ í™•ì¥ í”„ë¡œê·¸ë¨ ë‹¤ìš´ë¡œë“œ

Chrome í™•ì¥ì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” ëª…ë ¹ì¤„ì„ ì‚¬ìš©í•˜ì—¬ ZIP íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” `curl`ì„ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • URLì—ì„œ ZIP íŒŒì¼ì„ ê°€ì ¸ì˜¤ê³ , ZIP íŒŒì¼ì˜ ë‚´ìš©ì„ ë””ë ‰í† ë¦¬ì— ì¶”ì¶œí•˜ëŠ” ê³¼ì •ì„ í¬í•¨í•©ë‹ˆë‹¤. ë‹¨ê³„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. `"extension_id"`ë¥¼ í™•ì¥ì˜ ì‹¤ì œ IDë¡œ êµì²´í•©ë‹ˆë‹¤.
2. ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤:
```bash
extension_id=your_extension_id   # Replace with the actual extension ID
curl -L -o "$extension_id.zip" "https://clients2.google.com/service/update2/crx?response=redirect&os=mac&arch=x86-64&nacl_arch=x86-64&prod=chromecrx&prodchannel=stable&prodversion=44.0.2403.130&x=id%3D$extension_id%26uc"
unzip -d "$extension_id-source" "$extension_id.zip"
```
### CRX ë·°ì–´ ì›¹ì‚¬ì´íŠ¸ ì‚¬ìš©

[https://robwu.nl/crxviewer/](https://robwu.nl/crxviewer/)

### CRX ë·°ì–´ í™•ì¥ í”„ë¡œê·¸ë¨ ì‚¬ìš©

ë˜ ë‹¤ë¥¸ í¸ë¦¬í•œ ë°©ë²•ì€ ì˜¤í”ˆ ì†ŒìŠ¤ í”„ë¡œì íŠ¸ì¸ Chrome Extension Source Viewerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. [Chrome ì›¹ ìŠ¤í† ì–´](https://chrome.google.com/webstore/detail/chrome-extension-source-v/jifpbeccnghkjeaalbbjmodiffmgedin?hl=en)ì—ì„œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë·°ì–´ì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” [GitHub ì €ì¥ì†Œ](https://github.com/Rob--W/crxviewer)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¡œì»¬ì— ì„¤ì¹˜ëœ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì†ŒìŠ¤ ë³´ê¸°

ë¡œì»¬ì— ì„¤ì¹˜ëœ Chrome í™•ì¥ í”„ë¡œê·¸ë¨ë„ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. `chrome://version/`ë¥¼ ë°©ë¬¸í•˜ì—¬ "Profile Path" í•„ë“œë¥¼ ì°¾ìŠµë‹ˆë‹¤.
2. í”„ë¡œí•„ ë””ë ‰í† ë¦¬ ë‚´ì˜ `Extensions/` í•˜ìœ„ í´ë”ë¡œ ì´ë™í•©ë‹ˆë‹¤.
3. ì´ í´ë”ì—ëŠ” ëª¨ë“  ì„¤ì¹˜ëœ í™•ì¥ í”„ë¡œê·¸ë¨ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ì¼ë°˜ì ìœ¼ë¡œ ì½ê¸° ê°€ëŠ¥í•œ í˜•ì‹ì˜ ì†ŒìŠ¤ ì½”ë“œê°€ ìˆìŠµë‹ˆë‹¤.

í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì‹ë³„í•˜ë ¤ë©´ IDë¥¼ ì´ë¦„ì— ë§¤í•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* `about:extensions` í˜ì´ì§€ì—ì„œ ê°œë°œì ëª¨ë“œë¥¼ í™œì„±í™”í•˜ì—¬ ê° í™•ì¥ í”„ë¡œê·¸ë¨ì˜ IDë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
* ê° í™•ì¥ í”„ë¡œê·¸ë¨ì˜ í´ë” ë‚´ì—ì„œ `manifest.json` íŒŒì¼ì—ëŠ” ì½ê¸° ê°€ëŠ¥í•œ `name` í•„ë“œê°€ í¬í•¨ë˜ì–´ ìˆì–´ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì‹ë³„í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

### íŒŒì¼ ì••ì¶• í•´ì œê¸° ë˜ëŠ” ì–¸íŒ©ì»¤ ì‚¬ìš©

Chrome ì›¹ ìŠ¤í† ì–´ë¡œ ê°€ì„œ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤. íŒŒì¼ì€ `.crx` í™•ì¥ìë¥¼ ê°€ì§‘ë‹ˆë‹¤. íŒŒì¼ í™•ì¥ìë¥¼ `.crx`ì—ì„œ `.zip`ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤. WinRAR, 7-Zip ë“±ê³¼ ê°™ì€ íŒŒì¼ ì••ì¶• í•´ì œê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ ZIP íŒŒì¼ì˜ ë‚´ìš©ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.

### Chromeì—ì„œ ê°œë°œì ëª¨ë“œ ì‚¬ìš©

Chromeì„ ì—´ê³  `chrome://extensions/`ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì˜¤ë¥¸ìª½ ìƒë‹¨ì—ì„œ "ê°œë°œì ëª¨ë“œ"ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤. "ì••ì¶• í•´ì œëœ í™•ì¥ í”„ë¡œê·¸ë¨ ë¡œë“œ..."ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì´ëŠ” ì†ŒìŠ¤ ì½”ë“œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì§€ ì•Šì§€ë§Œ, ì´ë¯¸ ë‹¤ìš´ë¡œë“œë˜ì—ˆê±°ë‚˜ ê°œë°œëœ í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì½”ë“œë¥¼ ë³´ê¸° ë° ìˆ˜ì •í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.

## Chrome í™•ì¥ í”„ë¡œê·¸ë¨ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë°ì´í„°ì…‹

ì·¨ì•½í•œ ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì°¾ê¸° ìœ„í•´ [https://github.com/palant/chrome-extension-manifests-dataset](https://github.com/palant/chrome-extension-manifests-dataset)ë¥¼ ì‚¬ìš©í•˜ê³  ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì—ì„œ ì ì¬ì ìœ¼ë¡œ ì·¨ì•½í•œ ì§•í›„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, 25000ëª… ì´ìƒì˜ ì‚¬ìš©ìê°€ ìˆëŠ” í™•ì¥ í”„ë¡œê·¸ë¨, `content_scripts` ë° ê¶Œí•œ `nativeMessaging`ì„ í™•ì¸í•˜ë ¤ë©´:

{% code overflow="wrap" %}
```bash
# Query example from https://spaceraccoon.dev/universal-code-execution-browser-extensions/
node query.js -f "metadata.user_count > 250000" "manifest.content_scripts?.length > 0 && manifest.permissions?.includes('nativeMessaging')"
```
{% endcode %}

## ë³´ì•ˆ ê°ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì€ **ì œí•œëœ ê³µê²© í‘œë©´**ì„ ê°€ì§€ê³  ìˆì§€ë§Œ, ì¼ë¶€ëŠ” **ì·¨ì•½ì **ì´ë‚˜ **ê°•í™” ê°œì„  ì‚¬í•­**ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ê°€ì¥ ì¼ë°˜ì ì¸ í•­ëª©ì…ë‹ˆë‹¤:

* [ ] ê°€ëŠ¥í•œ í•œ ìš”ì²­ëœ **`permissions`**ë¥¼ **ì œí•œ**í•©ë‹ˆë‹¤.
* [ ] ê°€ëŠ¥í•œ í•œ **`host_permissions`**ë¥¼ **ì œí•œ**í•©ë‹ˆë‹¤.
* [ ] **ê°•ë ¥í•œ** **`content_security_policy`**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
* [ ] í•„ìš”í•˜ì§€ ì•Šë‹¤ë©´ ê°€ëŠ¥í•œ í•œ **`externally_connectable`**ì„ **ì œí•œ**í•©ë‹ˆë‹¤. ê¸°ë³¸ê°’ìœ¼ë¡œ ë‘ì§€ ë§ê³  **`{}`**ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
* [ ] ì—¬ê¸°ì—ì„œ **XSS ë˜ëŠ” takeoverì— ì·¨ì•½í•œ URL**ì´ ì–¸ê¸‰ë˜ë©´, ê³µê²©ìëŠ” **ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ì— ì§ì ‘ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë§¤ìš° ê°•ë ¥í•œ ìš°íšŒì…ë‹ˆë‹¤.
* [ ] ê°€ëŠ¥í•œ í•œ **`web_accessible_resources`**ë¥¼ **ì œí•œ**í•©ë‹ˆë‹¤. ê°€ëŠ¥í•˜ë‹¤ë©´ ë¹„ì›Œë‘ì„¸ìš”.
* [ ] **`web_accessible_resources`**ê°€ ì—†ì§€ ì•Šë‹¤ë©´, [**ClickJacking**](browext-clickjacking.md)ì„ í™•ì¸í•©ë‹ˆë‹¤.
* [ ] **í™•ì¥ í”„ë¡œê·¸ë¨**ì—ì„œ **ì›¹ í˜ì´ì§€**ë¡œ **í†µì‹ **ì´ ë°œìƒí•˜ë©´, í†µì‹ ìœ¼ë¡œ ì¸í•´ ë°œìƒí•œ [**XSS**](browext-xss-example.md) **ì·¨ì•½ì **ì„ í™•ì¸í•©ë‹ˆë‹¤.
* [ ] Post Messagesê°€ ì‚¬ìš©ë˜ë©´, [**Post Message ì·¨ì•½ì **](../postmessage-vulnerabilities/)**ì„ í™•ì¸í•©ë‹ˆë‹¤.**
* [ ] **Content Scriptê°€ DOM ì„¸ë¶€ì •ë³´ì— ì ‘ê·¼**í•˜ë©´, ì›¹ì— ì˜í•´ **ìˆ˜ì •**ë  ê²½ìš° **XSSë¥¼ ë„ì…í•˜ì§€ ì•ŠëŠ”ì§€** í™•ì¸í•©ë‹ˆë‹¤.
* [ ] ì´ í†µì‹ ì´ **Content Script -> Background script í†µì‹ **ì—ë„ ê´€ë ¨ë˜ì–´ ìˆë‹¤ë©´ íŠ¹ë³„íˆ ê°•ì¡°í•©ë‹ˆë‹¤.
* [ ] ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ **ë„¤ì´í‹°ë¸Œ ë©”ì‹œì§•**ì„ í†µí•´ í†µì‹ í•˜ëŠ” ê²½ìš°, í†µì‹ ì´ ì•ˆì „í•˜ê³  ì •ì œë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
* [ ] **ë¯¼ê°í•œ ì •ë³´ëŠ”** ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ **ì½”ë“œ** ë‚´ì— ì €ì¥ë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.
* [ ] **ë¯¼ê°í•œ ì •ë³´ëŠ”** ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ **ë©”ëª¨ë¦¬** ë‚´ì— ì €ì¥ë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.
* [ ] **ë¯¼ê°í•œ ì •ë³´ëŠ”** **íŒŒì¼ ì‹œìŠ¤í…œì— ë³´í˜¸ë˜ì§€ ì•Šì€ ìƒíƒœë¡œ ì €ì¥ë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.**

## ë„êµ¬

### [**Tarnish**](https://thehackerblog.com/tarnish/)

* ì œê³µëœ Chrome ì›¹ìŠ¤í† ì–´ ë§í¬ì—ì„œ Chrome í™•ì¥ í”„ë¡œê·¸ë¨ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
* [**manifest.json**](https://developer.chrome.com/extensions/manifest) **ë·°ì–´**: í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
* **ì§€ë¬¸ ë¶„ì„**: [web\_accessible\_resources](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) ê°ì§€ ë° Chrome í™•ì¥ í”„ë¡œê·¸ë¨ ì§€ë¬¸ ìƒì„±ì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
* **ì ì¬ì  Clickjacking ë¶„ì„**: [web\_accessible\_resources](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) ì§€ì‹œì–´ê°€ ì„¤ì •ëœ í™•ì¥ í”„ë¡œê·¸ë¨ HTML í˜ì´ì§€ ê°ì§€. í˜ì´ì§€ì˜ ëª©ì ì— ë”°ë¼ Clickjackingì— ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ê¶Œí•œ ê²½ê³  ë·°ì–´**: ì‚¬ìš©ìê°€ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•˜ë ¤ê³  í•  ë•Œ í‘œì‹œë  Chrome ê¶Œí•œ í”„ë¡¬í”„íŠ¸ ê²½ê³  ëª©ë¡ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
* **ìœ„í—˜í•œ í•¨ìˆ˜**: ê³µê²©ìê°€ ì•…ìš©í•  ìˆ˜ ìˆëŠ” ìœ„í—˜í•œ í•¨ìˆ˜ì˜ ìœ„ì¹˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤ (ì˜ˆ: innerHTML, chrome.tabs.executeScriptì™€ ê°™ì€ í•¨ìˆ˜).
* **ì§„ì…ì **: í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì‚¬ìš©ì/ì™¸ë¶€ ì…ë ¥ì„ ë°›ëŠ” ìœ„ì¹˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ëŠ” í™•ì¥ í”„ë¡œê·¸ë¨ì˜ í‘œë©´ì ì„ ì´í•´í•˜ê³  ì•…ì˜ì ìœ¼ë¡œ ì¡°ì‘ëœ ë°ì´í„°ë¥¼ í™•ì¥ í”„ë¡œê·¸ë¨ì— ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì ì¬ì  ì§€ì ì„ ì°¾ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.
* ìœ„í—˜í•œ í•¨ìˆ˜ ë° ì§„ì…ì  ìŠ¤ìºë„ˆëŠ” ìƒì„±ëœ ê²½ê³ ì— ëŒ€í•´ ë‹¤ìŒì„ ì œê³µí•©ë‹ˆë‹¤:
* ê²½ê³ ë¥¼ ìœ ë°œí•œ ê´€ë ¨ ì½”ë“œ ìŠ¤ë‹ˆí« ë° ì¤„.
* ë¬¸ì œì— ëŒ€í•œ ì„¤ëª….
* ì½”ë“œë¥¼ í¬í•¨í•˜ëŠ” ì „ì²´ ì†ŒìŠ¤ íŒŒì¼ì„ ë³´ê¸° ìœ„í•œ â€œíŒŒì¼ ë³´ê¸°â€ ë²„íŠ¼.
* ê²½ê³ ëœ íŒŒì¼ì˜ ê²½ë¡œ.
* ê²½ê³ ëœ íŒŒì¼ì˜ ì „ì²´ Chrome í™•ì¥ í”„ë¡œê·¸ë¨ URI.
* íŒŒì¼ì˜ ìœ í˜• (ì˜ˆ: ë°±ê·¸ë¼ìš´ë“œ í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸, ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸, ë¸Œë¼ìš°ì € ì•¡ì…˜ ë“±).
* ì·¨ì•½í•œ ì¤„ì´ JavaScript íŒŒì¼ì— ìˆëŠ” ê²½ìš°, í¬í•¨ëœ ëª¨ë“  í˜ì´ì§€ì˜ ê²½ë¡œì™€ ì´ í˜ì´ì§€ì˜ ìœ í˜• ë° [web\_accessible\_resource](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) ìƒíƒœ.
* **Content Security Policy (CSP) ë¶„ì„ê¸° ë° ìš°íšŒ ê²€ì‚¬ê¸°**: í™•ì¥ í”„ë¡œê·¸ë¨ì˜ CSPì˜ ì•½ì ì„ ì§€ì í•˜ê³  í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ì— ìˆëŠ” CDN ë“±ìœ¼ë¡œ ì¸í•´ CSPë¥¼ ìš°íšŒí•  ìˆ˜ ìˆëŠ” ì ì¬ì  ë°©ë²•ì„ ë°í˜€ëƒ…ë‹ˆë‹¤.
* **ì•Œë ¤ì§„ ì·¨ì•½í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬**: [Retire.js](https://retirejs.github.io/retire.js/)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•Œë ¤ì§„ ì·¨ì•½í•œ JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì‚¬ìš© ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
* í™•ì¥ í”„ë¡œê·¸ë¨ ë° í¬ë§·ëœ ë²„ì „ ë‹¤ìš´ë¡œë“œ.
* ì›ë³¸ í™•ì¥ í”„ë¡œê·¸ë¨ ë‹¤ìš´ë¡œë“œ.
* í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì•„ë¦„ë‹µê²Œ í¬ë§·ëœ ë²„ì „ ë‹¤ìš´ë¡œë“œ (ìë™ìœ¼ë¡œ í¬ë§·ëœ HTML ë° JavaScript).
* ìŠ¤ìº” ê²°ê³¼ì˜ ìë™ ìºì‹±, í™•ì¥ í”„ë¡œê·¸ë¨ ìŠ¤ìº”ì„ ì²˜ìŒ ì‹¤í–‰í•  ë•ŒëŠ” ì‹œê°„ì´ ê±¸ë¦¬ì§€ë§Œ, ë‘ ë²ˆì§¸ ì‹¤í–‰ ì‹œ í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ê±°ì˜ ì¦‰ì‹œ ê²°ê³¼ê°€ ìºì‹œë©ë‹ˆë‹¤.
* ë§í¬ ê°€ëŠ¥í•œ ë³´ê³ ì„œ URL, tarnishì— ì˜í•´ ìƒì„±ëœ í™•ì¥ í”„ë¡œê·¸ë¨ ë³´ê³ ì„œì— ë‹¤ë¥¸ ì‚¬ëŒì„ ì‰½ê²Œ ë§í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### [Neto](https://github.com/elevenpaths/neto)

Neto í”„ë¡œì íŠ¸ëŠ” Firefox ë° Chromeê³¼ ê°™ì€ ì˜ ì•Œë ¤ì§„ ë¸Œë¼ìš°ì €ì˜ ë¸Œë¼ìš°ì € í”ŒëŸ¬ê·¸ì¸ ë° í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ìˆ¨ê²¨ì§„ ê¸°ëŠ¥ì„ ë¶„ì„í•˜ê³  í’€ì–´ë‚´ê¸° ìœ„í•´ ê³ ì•ˆëœ Python 3 íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤. `manifest.json`, ì§€ì—­í™” í´ë” ë˜ëŠ” JavaScript ë° HTML ì†ŒìŠ¤ íŒŒì¼ê³¼ ê°™ì€ ê´€ë ¨ ë¦¬ì†ŒìŠ¤ì—ì„œ ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ì¶”ì¶œí•˜ê¸° ìœ„í•´ íŒ¨í‚¤ì§€ íŒŒì¼ì„ ì••ì¶• í•´ì œí•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ìë™í™”í•©ë‹ˆë‹¤.

## ì°¸ê³  ë¬¸í—Œ

* **ì´ ë°©ë²•ë¡ ì— ë„ì›€ì„ ì¤€** [**@naivenom**](https://twitter.com/naivenom) **ì—ê²Œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.**
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)
* [https://palant.info/2022/08/10/anatomy-of-a-basic-extension/](https://palant.info/2022/08/10/anatomy-of-a-basic-extension/)
* [https://palant.info/2022/08/24/attack-surface-of-extension-pages/](https://palant.info/2022/08/24/attack-surface-of-extension-pages/)
* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://help.passbolt.com/assets/files/PBL-02-report.pdf](https://help.passbolt.com/assets/files/PBL-02-report.pdf)
* [https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts)
* [https://developer.chrome.com/docs/extensions/mv2/background-pages](https://developer.chrome.com/docs/extensions/mv2/background-pages)
* [https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/](https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/)
* [https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0](https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
