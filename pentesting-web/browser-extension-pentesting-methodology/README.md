# TarayÄ±cÄ± Eklentisi Pentesting Metodolojisi

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Temel Bilgiler

TarayÄ±cÄ± eklentileri JavaScript ile yazÄ±lÄ±r ve tarayÄ±cÄ± tarafÄ±ndan arka planda yÃ¼klenir. Kendi [DOM](https://www.w3schools.com/js/js\_htmldom.asp) yapÄ±sÄ±na sahiptir ancak diÄŸer sitelerin DOM'larÄ±yla etkileÅŸimde bulunabilir. Bu, diÄŸer sitelerin gizliliÄŸini, bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ ve eriÅŸilebilirliÄŸini (CIA) tehlikeye atabileceÄŸi anlamÄ±na gelir.

## Ana BileÅŸenler

Eklenti dÃ¼zenleri en iyi ÅŸekilde gÃ¶rselleÅŸtirildiÄŸinde gÃ¶rÃ¼nÃ¼r ve Ã¼Ã§ bileÅŸenden oluÅŸur. Her bir bileÅŸeni derinlemesine inceleyelim.

<figure><img src="../../.gitbook/assets/image (16) (1).png" alt=""><figcaption><p><a href="http://webblaze.cs.berkeley.edu/papers/Extensions.pdf">http://webblaze.cs.berkeley.edu/papers/Extensions.pdf</a></p></figcaption></figure>

### **Ä°Ã§erik Scriptleri**

Her iÃ§erik scripti **tek bir web sayfasÄ±nÄ±n** DOM'una doÄŸrudan eriÅŸime sahiptir ve bu nedenle **potansiyel olarak kÃ¶tÃ¼ niyetli girdilere** maruz kalÄ±r. Ancak, iÃ§erik scriptinin eklenti Ã§ekirdeÄŸine mesaj gÃ¶ndermenin dÄ±ÅŸÄ±nda baÅŸka bir izni yoktur.

### **Eklenti Ã‡ekirdeÄŸi**

Eklenti Ã§ekirdeÄŸi, eklentinin Ã§oÄŸu ayrÄ±calÄ±klarÄ±nÄ±/eriÅŸimlerini iÃ§erir, ancak eklenti Ã§ekirdeÄŸi yalnÄ±zca [XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest) ve iÃ§erik scriptleri aracÄ±lÄ±ÄŸÄ±yla web iÃ§eriÄŸiyle etkileÅŸimde bulunabilir. AyrÄ±ca, eklenti Ã§ekirdeÄŸi ana makineye doÄŸrudan eriÅŸime sahip deÄŸildir.

### **Yerel Ä°kili**

Eklenti, **kullanÄ±cÄ±nÄ±n tam ayrÄ±calÄ±klarÄ±yla ana makineye eriÅŸebilen bir yerel ikiliyi** destekler. Yerel ikili, Flash ve diÄŸer tarayÄ±cÄ± eklentileri tarafÄ±ndan kullanÄ±lan standart Netscape Eklenti Uygulama Programlama ArayÃ¼zÃ¼ ([NPAPI](https://en.wikipedia.org/wiki/NPAPI)) aracÄ±lÄ±ÄŸÄ±yla eklenti Ã§ekirdeÄŸi ile etkileÅŸimde bulunur.

### SÄ±nÄ±rlar

{% hint style="danger" %}
KullanÄ±cÄ±nÄ±n tam ayrÄ±calÄ±klarÄ±nÄ± elde etmek iÃ§in, bir saldÄ±rgan eklentiyi kÃ¶tÃ¼ niyetli girdileri iÃ§erik scriptinden eklentinin Ã§ekirdeÄŸine ve eklentinin Ã§ekirdeÄŸinden yerel ikiliye geÃ§irmesi iÃ§in ikna etmelidir.
{% endhint %}

Eklentinin her bir bileÅŸeni, **gÃ¼Ã§lÃ¼ koruyucu sÄ±nÄ±rlarla** birbirinden ayrÄ±lmÄ±ÅŸtÄ±r. Her bileÅŸen, **ayrÄ± bir iÅŸletim sistemi sÃ¼recinde** Ã§alÄ±ÅŸÄ±r. Ä°Ã§erik scriptleri ve eklenti Ã§ekirdekleri, Ã§oÄŸu iÅŸletim sistemi hizmetlerine kapalÄ± olan **sandbox sÃ¼reÃ§lerinde** Ã§alÄ±ÅŸÄ±r.

AyrÄ±ca, iÃ§erik scriptleri, **ayrÄ± bir JavaScript yÄ±ÄŸÄ±nÄ±** iÃ§inde Ã§alÄ±ÅŸarak iliÅŸkili web sayfalarÄ±ndan ayrÄ±lÄ±r. Ä°Ã§erik scripti ve web sayfasÄ±, **aynÄ± temel DOM'a eriÅŸime** sahiptir, ancak ikisi **asla JavaScript iÅŸaretÃ§ilerini deÄŸiÅŸ tokuÅŸ etmez**, bu da JavaScript iÅŸlevselliÄŸinin sÄ±zmasÄ±nÄ± Ã¶nler.

## **`manifest.json`**

Bir Chrome eklentisi, [.crx dosya uzantÄ±sÄ±na](https://www.lifewire.com/crx-file-2620391) sahip bir ZIP klasÃ¶rÃ¼dÃ¼r. Eklentinin Ã§ekirdeÄŸi, klasÃ¶rÃ¼n kÃ¶kÃ¼nde bulunan **`manifest.json`** dosyasÄ±dÄ±r ve bu dosya dÃ¼zen, izinler ve diÄŸer yapÄ±landÄ±rma seÃ§eneklerini belirtir.

Ã–rnek:
```json
{
"manifest_version": 2,
"name": "My extension",
"version": "1.0",
"permissions": [
"storage"
],
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
"background": {
"scripts": [
"background.js"
]
},
"options_ui": {
"page": "options.html"
}
}
```
### `content_scripts`

Ä°Ã§erik betikleri, kullanÄ±cÄ± **eÅŸleÅŸen bir sayfaya gittiÄŸinde** **yÃ¼klenir**, bu durumda **`https://example.com/*`** ifadesine uyan ve **`*://*/*/business*`** regex'ine uymayan herhangi bir sayfa. SayfanÄ±n [Belge Nesne Modeli (DOM)](https://developer.mozilla.org/en-US/docs/Web/API/Document\_Object\_Model) Ã¼zerinde keyfi eriÅŸime sahip olarak **sayfanÄ±n kendi betikleri gibi** Ã§alÄ±ÅŸÄ±rlar.
```json
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
```
Daha fazla URL eklemek veya Ã§Ä±karmak iÃ§in **`include_globs`** ve **`exclude_globs`** kullanmak da mÃ¼mkÃ¼ndÃ¼r.

Bu, uzantÄ±nÄ±n depolama alanÄ±ndan `message` deÄŸerini almak iÃ§in [depolama API'sini](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) kullanan bir aÃ§Ä±klama butonu ekleyecek Ã¶rnek bir iÃ§erik betiÄŸidir.
```js
chrome.storage.local.get("message", result =>
{
let div = document.createElement("div");
div.innerHTML = result.message + " <button>Explain</button>";
div.querySelector("button").addEventListener("click", () =>
{
chrome.runtime.sendMessage("explain");
});
document.body.appendChild(div);
});
```
<figure><img src="../../.gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

Bu butona tÄ±klandÄ±ÄŸÄ±nda, iÃ§erik betiÄŸi tarafÄ±ndan uzantÄ± sayfalarÄ±na bir mesaj gÃ¶nderilir; bu, [**runtime.sendMessage() API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage) kullanÄ±larak gerÃ§ekleÅŸtirilir. Bu, iÃ§erik betiÄŸinin API'lere doÄŸrudan eriÅŸimindeki sÄ±nÄ±rlamadan kaynaklanmaktadÄ±r; `storage` bu istisnalardan biridir. Bu istisnalarÄ±n Ã¶tesindeki iÅŸlevler iÃ§in, iÃ§erik betiklerinin iletiÅŸim kurabileceÄŸi uzantÄ± sayfalarÄ±na mesajlar gÃ¶nderilir.

{% hint style="warning" %}
TarayÄ±cÄ±ya baÄŸlÄ± olarak, iÃ§erik betiÄŸinin yetenekleri biraz farklÄ±lÄ±k gÃ¶sterebilir. Chromium tabanlÄ± tarayÄ±cÄ±lar iÃ§in yetenekler listesi [Chrome GeliÅŸtiricileri belgelerinde](https://developer.chrome.com/docs/extensions/mv3/content\_scripts/#capabilities) mevcuttur ve Firefox iÃ§in [MDN](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content\_scripts#webextension\_apis) ana kaynak olarak hizmet etmektedir.\
AyrÄ±ca, iÃ§erik betiklerinin arka plan betikleriyle iletiÅŸim kurma yeteneÄŸine sahip olduÄŸu ve bu sayede eylemler gerÃ§ekleÅŸtirebildiÄŸi ve yanÄ±tlarÄ± iletebildiÄŸi de dikkate deÄŸerdir.
{% endhint %}

Chrome'da iÃ§erik betiklerini gÃ¶rÃ¼ntÃ¼lemek ve hata ayÄ±klamak iÃ§in, Chrome geliÅŸtirici araÃ§larÄ± menÃ¼sÃ¼ne SeÃ§enekler > Daha fazla araÃ§ > GeliÅŸtirici araÃ§larÄ± Ã¼zerinden veya Ctrl + Shift + I tuÅŸlarÄ±na basarak eriÅŸilebilir.

GeliÅŸtirici araÃ§larÄ± gÃ¶rÃ¼ntÃ¼lendikten sonra, **Kaynak sekmesine** tÄ±klanmalÄ± ve ardÄ±ndan **Ä°Ã§erik Betikleri** sekmesi seÃ§ilmelidir. Bu, Ã§eÅŸitli uzantÄ±lardan Ã§alÄ±ÅŸan iÃ§erik betiklerinin gÃ¶zlemlenmesini ve yÃ¼rÃ¼tme akÄ±ÅŸÄ±nÄ± izlemek iÃ§in kesme noktalarÄ±nÄ±n ayarlanmasÄ±nÄ± saÄŸlar.

### Enjekte edilmiÅŸ iÃ§erik betikleri

{% hint style="success" %}
**Ä°Ã§erik Betikleri zorunlu deÄŸildir**; ayrÄ±ca **dinamik olarak** **enjekte** etmek ve web sayfalarÄ±na **programatik olarak enjekte etmek** de mÃ¼mkÃ¼ndÃ¼r; bu, **`tabs.executeScript`** aracÄ±lÄ±ÄŸÄ±yla gerÃ§ekleÅŸtirilir. Bu, aslÄ±nda daha **detaylÄ± kontroller** saÄŸlar.
{% endhint %}

Bir iÃ§erik betiÄŸinin programatik olarak enjekte edilmesi iÃ§in, uzantÄ±nÄ±n betiklerin enjekte edileceÄŸi sayfa iÃ§in [host izinlerine](https://developer.chrome.com/docs/extensions/reference/permissions) sahip olmasÄ± gerekmektedir. Bu izinler, uzantÄ±nÄ±n manifestosunda **talep edilerek** veya geÃ§ici olarak [**activeTab**](https://developer.chrome.com/docs/extensions/reference/manifest/activeTab) aracÄ±lÄ±ÄŸÄ±yla gÃ¼vence altÄ±na alÄ±nabilir.

#### Ã–rnek activeTab tabanlÄ± uzantÄ±

{% code title="manifest.json" %}
```json
{
"name": "My extension",
...
"permissions": [
"activeTab",
"scripting"
],
"background": {
"service_worker": "background.js"
},
"action": {
"default_title": "Action Button"
}
}
```
{% endcode %}

* **TÄ±klama ile bir JS dosyasÄ± enjekte et:**
```javascript
// content-script.js
document.body.style.backgroundColor = "orange";

//service-worker.js - Inject the JS file
chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target: { tabId: tab.id },
files: ["content-script.js"]
});
});
```
* **TÄ±klamada bir fonksiyon enjekte et:**
```javascript
//service-worker.js - Inject a function
function injectedFunction() {
document.body.style.backgroundColor = "orange";
}

chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target : {tabId : tab.id},
func : injectedFunction,
});
});
```
#### Scripting izinleri ile Ã¶rnek
```javascript
// service-workser.js
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
excludeMatches : [ "*://*/*business*" ],
js : [ "contentScript.js" ],
}]);

// Another example
chrome.tabs.executeScript(tabId, { file: "content_script.js" });
```
Daha fazla URL eklemek veya Ã§Ä±karmak iÃ§in **`include_globs`** ve **`exclude_globs`** kullanmak da mÃ¼mkÃ¼ndÃ¼r.

### Ä°Ã§erik Scriptleri `run_at`

`run_at` alanÄ± **JavaScript dosyalarÄ±nÄ±n web sayfasÄ±na ne zaman enjekte edileceÄŸini** kontrol eder. Tercih edilen ve varsayÄ±lan deÄŸer `"document_idle"`dÄ±r.

OlasÄ± deÄŸerler ÅŸunlardÄ±r:

* **`document_idle`**: MÃ¼mkÃ¼n olduÄŸunda
* **`document_start`**: `css`'den herhangi bir dosya yÃ¼klendikten sonra, ancak baÅŸka bir DOM oluÅŸturulmadan veya baÅŸka bir script Ã§alÄ±ÅŸtÄ±rÄ±lmadan Ã¶nce.
* **`document_end`**: DOM tamamlandÄ±ktan hemen sonra, ancak resimler ve Ã§erÃ§eveler gibi alt kaynaklar yÃ¼klenmeden Ã¶nce.

#### `manifest.json` aracÄ±lÄ±ÄŸÄ±yla
```json
{
"name": "My extension",
...
"content_scripts": [
{
"matches": ["https://*.example.com/*"],
"run_at": "document_idle",
"js": ["contentScript.js"]
}
],
...
}

```
**`service-worker.js`** Ã¼zerinden
```javascript
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
runAt : "document_idle",
js : [ "contentScript.js" ],
}]);
```
### `background`

Ä°Ã§erik betikleri tarafÄ±ndan gÃ¶nderilen mesajlar, uzantÄ±nÄ±n bileÅŸenlerini koordine etmede merkezi bir rol oynayan **arka plan sayfasÄ±** tarafÄ±ndan alÄ±nÄ±r. Ã–zellikle, arka plan sayfasÄ± uzantÄ±nÄ±n Ã¶mrÃ¼ boyunca devam eder, doÄŸrudan kullanÄ±cÄ± etkileÅŸimi olmadan gizlice Ã§alÄ±ÅŸÄ±r. Kendi Belge Nesne Modeli (DOM) vardÄ±r, bu da karmaÅŸÄ±k etkileÅŸimler ve durum yÃ¶netimi saÄŸlar.

**Ana Noktalar**:

* **Arka Plan SayfasÄ± RolÃ¼:** UzantÄ±nÄ±n sinir merkezi olarak hareket eder, uzantÄ±nÄ±n Ã§eÅŸitli parÃ§alarÄ± arasÄ±nda iletiÅŸim ve koordinasyonu saÄŸlar.
* **SÃ¼reklilik:** KullanÄ±cÄ±ya gÃ¶rÃ¼nmez, ancak uzantÄ±nÄ±n iÅŸlevselliÄŸi iÃ§in hayati bir Ã¶neme sahip sÃ¼rekli bir varlÄ±ktÄ±r.
* **Otomatik OluÅŸturma:** AÃ§Ä±kÃ§a tanÄ±mlanmadÄ±ÄŸÄ± takdirde, tarayÄ±cÄ± otomatik olarak bir arka plan sayfasÄ± oluÅŸturur. Bu otomatik oluÅŸturulan sayfa, uzantÄ±nÄ±n manifestosunda belirtilen tÃ¼m arka plan betiklerini iÃ§erecek ÅŸekilde, uzantÄ±nÄ±n arka plan gÃ¶revlerinin kesintisiz Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlar.

{% hint style="success" %}
TarayÄ±cÄ±nÄ±n aÃ§Ä±kÃ§a belirtilmediÄŸinde arka plan sayfasÄ±nÄ± otomatik olarak oluÅŸturma kolaylÄ±ÄŸÄ±, gerekli tÃ¼m arka plan betiklerinin entegre edilmesini ve Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlar, uzantÄ±nÄ±n kurulum sÃ¼recini kolaylaÅŸtÄ±rÄ±r.
{% endhint %}

Ã–rnek arka plan betiÄŸi:
```js
chrome.runtime.onMessage.addListener((request, sender, sendResponse) =>
{
if (request == "explain")
{
chrome.tabs.create({ url: "https://example.net/explanation" });
}
})
```
Bu, mesajlarÄ± dinlemek iÃ§in [runtime.onMessage API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage) kullanÄ±r. Bir `"explain"` mesajÄ± alÄ±ndÄ±ÄŸÄ±nda, yeni bir sekmede bir sayfa aÃ§mak iÃ§in [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) kullanÄ±r.

Arka plan betiÄŸini hata ayÄ±klamak iÃ§in **uzantÄ± ayrÄ±ntÄ±larÄ±na gidip hizmet Ã§alÄ±ÅŸanÄ±nÄ± inceleyebilirsiniz,** bu, arka plan betiÄŸi ile geliÅŸtirici araÃ§larÄ±nÄ± aÃ§acaktÄ±r:

<figure><img src="https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/browser-extension-pentesting-methodology/broken-reference" alt=""><figcaption></figcaption></figure>

### SeÃ§enek sayfalarÄ± ve diÄŸerleri

TarayÄ±cÄ± uzantÄ±larÄ± Ã§eÅŸitli tÃ¼rde sayfalar iÃ§erebilir:

* **Eylem sayfalarÄ±**, uzantÄ± simgesine tÄ±klandÄ±ÄŸÄ±nda **aÃ§Ä±lÄ±r menÃ¼de** gÃ¶rÃ¼ntÃ¼lenir.
* UzantÄ±nÄ±n **yeni bir sekmede yÃ¼kleyeceÄŸi** sayfalar.
* **SeÃ§enek SayfalarÄ±**: Bu sayfa tÄ±klandÄ±ÄŸÄ±nda uzantÄ±nÄ±n Ã¼stÃ¼nde gÃ¶rÃ¼ntÃ¼lenir. Ã–nceki manifestoda, bu sayfaya `chrome://extensions/?options=fadlhnelkbeojnebcbkacjilhnbjfjca` adresinden veya tÄ±klayarak eriÅŸebildim:

<figure><img src="../../.gitbook/assets/image (24).png" alt="" width="375"><figcaption></figcaption></figure>

Bu sayfalarÄ±n, dinamik olarak iÃ§erik yÃ¼kledikleri iÃ§in arka plan sayfalarÄ± gibi kalÄ±cÄ± olmadÄ±ÄŸÄ±nÄ± unutmayÄ±n. Bununla birlikte, arka plan sayfasÄ±yla belirli yetenekleri paylaÅŸÄ±rlar:

* **Ä°Ã§erik Betikleri ile Ä°letiÅŸim:** Arka plan sayfasÄ±na benzer ÅŸekilde, bu sayfalar iÃ§erik betiklerinden mesaj alabilir, uzantÄ± iÃ§inde etkileÅŸimi kolaylaÅŸtÄ±rÄ±r.
* **UzantÄ±ya Ã–zel API'lere EriÅŸim:** Bu sayfalar, uzantÄ± iÃ§in tanÄ±mlanan izinlere tabi olarak uzantÄ±ya Ã¶zel API'lere kapsamlÄ± eriÅŸim saÄŸlar.

### `permissions` & `host_permissions`

**`permissions`** ve **`host_permissions`**, tarayÄ±cÄ± uzantÄ±sÄ±nÄ±n **hangi izinlere** sahip olduÄŸunu (depolama, konum...) ve **hangi web sayfalarÄ±nda** olduÄŸunu belirten `manifest.json` dosyasÄ±ndaki giriÅŸlerdir.

TarayÄ±cÄ± uzantÄ±larÄ± bu kadar **ayrÄ±calÄ±klÄ±** olabileceÄŸinden, kÃ¶tÃ¼ niyetli bir uzantÄ± veya ele geÃ§irilmiÅŸ bir uzantÄ±, saldÄ±rgana **hassas bilgileri Ã§almak ve kullanÄ±cÄ±yÄ± gÃ¶zetlemek iÃ§in farklÄ± yollar** saÄŸlayabilir.

Bu ayarlarÄ±n nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± ve nasÄ±l kÃ¶tÃ¼ye kullanÄ±labileceÄŸini kontrol edin:

{% content-ref url="browext-permissions-and-host_permissions.md" %}
[browext-permissions-and-host\_permissions.md](browext-permissions-and-host\_permissions.md)
{% endcontent-ref %}

### `content_security_policy`

Bir **iÃ§erik gÃ¼venlik politikasÄ±**, `manifest.json` iÃ§inde de tanÄ±mlanabilir. EÄŸer tanÄ±mlÄ±ysa, **aÃ§Ä±k** olabilir.

TarayÄ±cÄ± uzantÄ± sayfalarÄ± iÃ§in varsayÄ±lan ayar oldukÃ§a kÄ±sÄ±tlayÄ±cÄ±dÄ±r:
```bash
script-src 'self'; object-src 'self';
```
Daha fazla bilgi iÃ§in CSP ve potansiyel bypass'lar hakkÄ±nda kontrol edin:

{% content-ref url="../content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../content-security-policy-csp-bypass/)
{% endcontent-ref %}

### `web_accessible_resources`

Bir web sayfasÄ±nÄ±n bir TarayÄ±cÄ± UzantÄ±sÄ±nÄ±n sayfasÄ±na, Ã¶rneÄŸin bir `.html` sayfasÄ±na eriÅŸebilmesi iÃ§in, bu sayfanÄ±n `manifest.json` dosyasÄ±ndaki **`web_accessible_resources`** alanÄ±nda belirtilmesi gerekir.\
Ã–rneÄŸin:
```javascript
{
...
"web_accessible_resources": [
{
"resources": [ "images/*.png" ],
"matches": [ "https://example.com/*" ]
},
{
"resources": [ "fonts/*.woff" ],
"matches": [ "https://example.com/*" ]
}
],
...
}
```
Bu sayfalara ÅŸu URL'ler Ã¼zerinden eriÅŸilebilir:
```
chrome-extension://<extension-id>/message.html
```
Kamu uzantÄ±larÄ±nda **extension-id eriÅŸilebilir**:

<figure><img src="../../.gitbook/assets/image (1194).png" alt="" width="375"><figcaption></figcaption></figure>

Ancak, `manifest.json` parametresi **`use_dynamic_url`** kullanÄ±lÄ±yorsa, bu **id dinamik olabilir**.

{% hint style="success" %}
Burada bir sayfa belirtilse bile, **Content Security Policy** sayesinde **ClickJacking'e karÅŸÄ± korunmuÅŸ** olabilir. Bu nedenle, bir ClickJacking saldÄ±rÄ±sÄ±nÄ±n mÃ¼mkÃ¼n olduÄŸunu onaylamadan Ã¶nce bunu (frame-ancestors bÃ¶lÃ¼mÃ¼) kontrol etmeniz gerekir.
{% endhint %}

Bu sayfalara eriÅŸim izni verilmesi, bu sayfalarÄ± **potansiyel olarak savunmasÄ±z ClickJacking** hale getirir:

{% content-ref url="browext-clickjacking.md" %}
[browext-clickjacking.md](browext-clickjacking.md)
{% endcontent-ref %}

{% hint style="success" %}
Bu sayfalarÄ±n yalnÄ±zca uzantÄ± tarafÄ±ndan yÃ¼klenmesine izin vermek ve rastgele URL'ler tarafÄ±ndan yÃ¼klenmesine izin vermemek, ClickJacking saldÄ±rÄ±larÄ±nÄ± Ã¶nleyebilir.
{% endhint %}

{% hint style="danger" %}
**`web_accessible_resources`** ve uzantÄ±nÄ±n diÄŸer sayfalarÄ± da **arka plan betikleriyle iletiÅŸim kurma** yeteneÄŸine sahiptir. Bu nedenle, bu sayfalardan biri **XSS**'ye karÅŸÄ± savunmasÄ±zsa, daha bÃ¼yÃ¼k bir gÃ¼venlik aÃ§Ä±ÄŸÄ± aÃ§abilir.

AyrÄ±ca, yalnÄ±zca **`web_accessible_resources`** iÃ§inde belirtilen sayfalarÄ± iframe'ler iÃ§inde aÃ§abileceÄŸinizi, ancak yeni bir sekmeden uzantÄ±nÄ±n ID'sini bilerek herhangi bir sayfaya eriÅŸmenin mÃ¼mkÃ¼n olduÄŸunu unutmayÄ±n. Bu nedenle, aynÄ± parametreleri kÃ¶tÃ¼ye kullanan bir XSS bulunursa, sayfa **`web_accessible_resources`** iÃ§inde yapÄ±landÄ±rÄ±lmamÄ±ÅŸ olsa bile kÃ¶tÃ¼ye kullanÄ±labilir.
{% endhint %}

### `externally_connectable`

[**docs**](https://developer.chrome.com/docs/extensions/reference/manifest/externally-connectable) gereÄŸi, `"externally_connectable"` manifest Ã¶zelliÄŸi, **hangi uzantÄ±larÄ±n ve web sayfalarÄ±nÄ±n** uzantÄ±nÄ±za [runtime.connect](https://developer.chrome.com/docs/extensions/reference/runtime#method-connect) ve [runtime.sendMessage](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) aracÄ±lÄ±ÄŸÄ±yla baÄŸlanabileceÄŸini belirtir.

* EÄŸer **`externally_connectable`** anahtarÄ± uzantÄ±nÄ±zÄ±n manifestosunda **belirtilmemiÅŸse** veya **`"ids": ["*"]`** olarak belirtilmiÅŸse, **tÃ¼m uzantÄ±lar baÄŸlanabilir, ancak hiÃ§bir web sayfasÄ± baÄŸlanamaz**.
* EÄŸer **belirli ID'ler belirtilmiÅŸse**, Ã¶rneÄŸin `"ids": ["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"]`, **yalnÄ±zca o uygulamalar** baÄŸlanabilir.
* EÄŸer **eÅŸleÅŸmeler** belirtilmiÅŸse, o web uygulamalarÄ± baÄŸlanabilecektir:
```json
"matches": [
"https://*.google.com/*",
"*://*.chromium.org/*",
```
* EÄŸer boÅŸ olarak belirtilmiÅŸse: **`"externally_connectable": {}`**, hiÃ§bir uygulama veya web baÄŸlanamayacaktÄ±r.

Burada belirtilen **daha az uzantÄ± ve URL**, **saldÄ±rÄ± yÃ¼zeyinin** daha kÃ¼Ã§Ã¼k olacaÄŸÄ± anlamÄ±na gelir.

{% hint style="danger" %}
EÄŸer bir web sayfasÄ± **XSS veya ele geÃ§irme** iÃ§in **`externally_connectable`** iÃ§inde belirtilmiÅŸse, bir saldÄ±rgan **mesajlarÄ± doÄŸrudan arka plan betiÄŸine** gÃ¶nderebilir, bu da Ä°Ã§erik BetiÄŸini ve CSP'yi tamamen atlamasÄ± anlamÄ±na gelir.

Bu nedenle, bu **Ã§ok gÃ¼Ã§lÃ¼ bir atlatmadÄ±r**.

AyrÄ±ca, eÄŸer istemci kÃ¶tÃ¼ niyetli bir uzantÄ± yÃ¼klerse, bu uzantÄ±nÄ±n savunmasÄ±z uzantÄ±yla iletiÅŸim kurmasÄ±na izin verilse bile, **izin verilen bir web sayfasÄ±na XSS verisi enjekte edebilir** veya **`WebRequest`** veya **`DeclarativeNetRequest`** API'lerini kÃ¶tÃ¼ye kullanarak hedef bir alan Ã¼zerindeki istekleri manipÃ¼le edebilir ve bir sayfanÄ±n **JavaScript dosyasÄ±** isteÄŸini deÄŸiÅŸtirebilir. (Hedef sayfadaki CSP'nin bu saldÄ±rÄ±larÄ± Ã¶nleyebileceÄŸini unutmayÄ±n). Bu fikir [**bu yazÄ±dan**](https://www.darkrelay.com/post/opera-zero-day-rce-vulnerability) gelmektedir.
{% endhint %}

## Ä°letiÅŸim Ã¶zeti

### UzantÄ± <--> Web UygulamasÄ±

Ä°Ã§erik betiÄŸi ile web sayfasÄ± arasÄ±nda iletiÅŸim kurmak iÃ§in genellikle post mesajlarÄ± kullanÄ±lÄ±r. Bu nedenle, web uygulamasÄ±nda genellikle **`window.postMessage`** fonksiyonuna yapÄ±lan Ã§aÄŸrÄ±lar ve iÃ§erik betiÄŸinde **`window.addEventListener`** gibi dinleyiciler bulacaksÄ±nÄ±z. Ancak, uzantÄ±nÄ±n da **bir Post MesajÄ± gÃ¶ndererek web uygulamasÄ±yla iletiÅŸim kurabileceÄŸini** (bu nedenle webin bunu beklemesi gerektiÄŸini) veya sadece webin yeni bir betik yÃ¼klemesini saÄŸlayabileceÄŸini unutmayÄ±n.

### UzantÄ±nÄ±n iÃ§inde

Genellikle uzantÄ± iÃ§inde bir mesaj gÃ¶ndermek iÃ§in **`chrome.runtime.sendMessage`** fonksiyonu kullanÄ±lÄ±r (genellikle `background` betiÄŸi tarafÄ±ndan iÅŸlenir) ve bunu almak ve iÅŸlemek iÃ§in bir dinleyici **`chrome.runtime.onMessage.addListener`** Ã§aÄŸrÄ±sÄ± ile tanÄ±mlanÄ±r.

AyrÄ±ca, tekil mesajlar gÃ¶ndermek yerine sÃ¼rekli bir baÄŸlantÄ± kurmak iÃ§in **`chrome.runtime.connect()`** kullanmak da mÃ¼mkÃ¼ndÃ¼r, bu, aÅŸaÄŸÄ±daki Ã¶rnekte olduÄŸu gibi **mesajlar** gÃ¶ndermek ve **almak** iÃ§in kullanÄ±labilir:

<details>

<summary><code>chrome.runtime.connect()</code> Ã¶rneÄŸi</summary>
```javascript
var port = chrome.runtime.connect();

// Listen for messages from the web page
window.addEventListener("message", (event) => {
// Only accept messages from the same window
if (event.source !== window) {
return;
}

// Check if the message type is "FROM_PAGE"
if (event.data.type && (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
// Forward the message to the background script
port.postMessage({ type: 'FROM_PAGE', text: event.data.text });
}
}, false);

// Listen for messages from the background script
port.onMessage.addListener(function(msg) {
console.log("Content script received message from background script:", msg);
// Handle the response message from the background script
});
```
</details>

Arka plan betiÄŸinden belirli bir sekmede bulunan iÃ§erik betiÄŸine mesaj gÃ¶ndermek de mÃ¼mkÃ¼ndÃ¼r; bu, mesajÄ± gÃ¶ndermek iÃ§in **`chrome.tabs.sendMessage`** Ã§aÄŸrÄ±sÄ±nÄ± yaparak **sekmenin ID'sini** belirtmeniz gerektiÄŸi anlamÄ±na gelir.

### Ä°zin verilen `externally_connectable`'dan uzantÄ±ya

`externally_connectable` yapÄ±landÄ±rmasÄ±nda **izin verilen web uygulamalarÄ± ve harici tarayÄ±cÄ± uzantÄ±larÄ±** istek gÃ¶nderebilir:
```javascript
chrome.runtime.sendMessage(extensionId, ...
```
**extension ID**'nin belirtilmesi gereken yerler.

### Native Messaging

Arka plan betikleri, sistem iÃ§indeki ikili dosyalarla iletiÅŸim kurabilir; bu iletiÅŸim dÃ¼zgÃ¼n bir ÅŸekilde gÃ¼vence altÄ±na alÄ±nmazsa **RCE'ler gibi kritik gÃ¼venlik aÃ§Ä±klarÄ±na maruz kalabilir**. [Bununla ilgili daha fazla bilgi](./#native-messaging).
```javascript
chrome.runtime.sendNativeMessage(
'com.my_company.my_application',
{text: 'Hello'},
function (response) {
console.log('Received ' + response);
}
);
```
## Web **â†”ï¸** Ä°Ã§erik Scripti Ä°letiÅŸimi

**Ä°Ã§erik scriptlerinin** Ã§alÄ±ÅŸtÄ±ÄŸÄ± ortamlar ve ana sayfalarÄ±n bulunduÄŸu yerler **ayrÄ±dÄ±r**, bu da **izolasyon** saÄŸlar. Bu izolasyona raÄŸmen, her ikisi de sayfanÄ±n **Belge Nesne Modeli (DOM)** ile etkileÅŸimde bulunma yeteneÄŸine sahiptir, bu da paylaÅŸÄ±lan bir kaynaktÄ±r. Ana sayfanÄ±n **iÃ§erik scripti** ile veya dolaylÄ± olarak iÃ§erik scripti aracÄ±lÄ±ÄŸÄ±yla uzantÄ± ile iletiÅŸim kurabilmesi iÃ§in, her iki tarafÄ±n da eriÅŸebildiÄŸi **DOM**'u iletiÅŸim kanalÄ± olarak kullanmasÄ± gerekmektedir.

### Post MesajlarÄ±

{% code title="content-script.js" %}
```javascript
// This is like "chrome.runtime.sendMessage" but to maintain the connection
var port = chrome.runtime.connect();

window.addEventListener("message", (event) => {
// We only accept messages from ourselves
if (event.source !== window) {
return;
}

if (event.data.type && (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
// Forward the message to the background script
port.postMessage(event.data.text);
}
}, false);
```
{% endcode %}

{% code title="example.js" %}
```javascript
document.getElementById("theButton").addEventListener("click", () => {
window.postMessage(
{type : "FROM_PAGE", text : "Hello from the webpage!"}, "*");
}, false);
```
{% endcode %}

GÃ¼venli bir Post Message iletiÅŸimi, alÄ±nan mesajÄ±n doÄŸruluÄŸunu kontrol etmelidir, bu ÅŸu ÅŸekilde yapÄ±labilir:

* **`event.isTrusted`**: Bu, yalnÄ±zca olayÄ±n bir kullanÄ±cÄ± eylemi tarafÄ±ndan tetiklendiÄŸi durumlarda DoÄŸru'dur.
* Ä°Ã§erik betiÄŸi, yalnÄ±zca kullanÄ±cÄ± bir eylem gerÃ§ekleÅŸtirdiÄŸinde bir mesaj bekliyor olabilir.
* **origin domain**: yalnÄ±zca izin verilen alanlar listesinden bir mesaj bekliyor olabilir.
* Bir regex kullanÄ±lÄ±yorsa, Ã§ok dikkatli olun.
* **Source**: `received_message.source !== window`, mesajÄ±n **Content Script'in dinlediÄŸi aynÄ± pencereden** gelip gelmediÄŸini kontrol etmek iÃ§in kullanÄ±labilir.

Ã–nceki kontroller, yapÄ±lsa bile, savunmasÄ±z olabilir, bu nedenle aÅŸaÄŸÄ±daki sayfada **potansiyel Post Message atlatmalarÄ±nÄ±** kontrol edin:

{% content-ref url="../postmessage-vulnerabilities/" %}
[postmessage-vulnerabilities](../postmessage-vulnerabilities/)
{% endcontent-ref %}

### Iframe

Ä°letiÅŸim iÃ§in baÅŸka bir olasÄ± yol **Iframe URL'leri** aracÄ±lÄ±ÄŸÄ±yla olabilir, bir Ã¶rneÄŸi burada bulabilirsiniz:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

### DOM

Bu "tam olarak" bir iletiÅŸim yolu deÄŸildir, ancak **web ve iÃ§erik betiÄŸi web DOM'una eriÅŸime sahip olacaktÄ±r**. Yani, eÄŸer **iÃ§erik betiÄŸi** buradan bazÄ± bilgileri okuyorsa, **web DOM'una gÃ¼veniyorsa**, web bu veriyi **deÄŸiÅŸtirebilir** (Ã§Ã¼nkÃ¼ web gÃ¼venilir olmamalÄ±dÄ±r veya web XSS'e karÅŸÄ± savunmasÄ±zdÄ±r) ve **Content Script'i tehlikeye atabilir**.

AyrÄ±ca, bir **tarayÄ±cÄ± uzantÄ±sÄ±nÄ± tehlikeye atmak iÃ§in DOM tabanlÄ± XSS** Ã¶rneÄŸini burada bulabilirsiniz:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Ä°Ã§erik BetiÄŸi **â†”ï¸** Arka Plan BetiÄŸi Ä°letiÅŸimi

Bir Ä°Ã§erik BetiÄŸi, **bir kerelik JSON-serializable** mesaj gÃ¶ndermek iÃ§in [**runtime.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) **veya** [**tabs.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/tabs#method-sendMessage) fonksiyonlarÄ±nÄ± kullanabilir.

**YanÄ±tÄ±** iÅŸlemek iÃ§in dÃ¶ndÃ¼rÃ¼len **Promise**'i kullanÄ±n. Ancak, geriye dÃ¶nÃ¼k uyumluluk iÃ§in, son argÃ¼man olarak hala bir **callback** geÃ§ebilirsiniz.

Bir **iÃ§erik betiÄŸinden** istek gÃ¶ndermek ÅŸÃ¶yle gÃ¶rÃ¼nÃ¼r:
```javascript
(async () => {
const response = await chrome.runtime.sendMessage({greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
**uzantÄ±**'dan bir istek gÃ¶nderme (genellikle bir **arka plan betiÄŸi**). SeÃ§ilen sekmedeki iÃ§erik betiÄŸine mesaj gÃ¶ndermenin bir Ã¶rneÄŸi:
```javascript
// From https://stackoverflow.com/questions/36153999/how-to-send-a-message-between-chrome-extension-popup-and-content-script
(async () => {
const [tab] = await chrome.tabs.query({active: true, lastFocusedWindow: true});
const response = await chrome.tabs.sendMessage(tab.id, {greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
**AlÄ±cÄ± tarafÄ±nda**, mesajÄ± iÅŸlemek iÃ§in bir [**runtime.onMessage**](https://developer.chrome.com/docs/extensions/reference/runtime#event-onMessage) **olay dinleyicisi** kurmalÄ±sÄ±nÄ±z. Bu, bir iÃ§erik betiÄŸi veya uzantÄ± sayfasÄ±ndan aynÄ± gÃ¶rÃ¼nÃ¼r.
```javascript
// From https://stackoverflow.com/questions/70406787/javascript-send-message-from-content-js-to-background-js
chrome.runtime.onMessage.addListener(
function(request, sender, sendResponse) {
console.log(sender.tab ?
"from a content script:" + sender.tab.url :
"from the extension");
if (request.greeting === "hello")
sendResponse({farewell: "goodbye"});
}
);
```
Ã–ne Ã§Ä±kan Ã¶rnekte, **`sendResponse()`** senkron bir ÅŸekilde yÃ¼rÃ¼tÃ¼ldÃ¼. `sendResponse()`'nin asenkron yÃ¼rÃ¼tÃ¼lmesi iÃ§in `onMessage` olay iÅŸleyicisini deÄŸiÅŸtirmek iÃ§in `return true;` eklemek zorunludur.

Ã–nemli bir husus, birden fazla sayfanÄ±n `onMessage` olaylarÄ±nÄ± alacak ÅŸekilde ayarlandÄ±ÄŸÄ± senaryolarda, **belirli bir olay iÃ§in `sendResponse()`'yi yÃ¼rÃ¼ten ilk sayfa** yanÄ±tÄ± etkili bir ÅŸekilde iletebilecek tek sayfa olacaktÄ±r. AynÄ± olaya yÃ¶nelik sonraki yanÄ±tlar dikkate alÄ±nmayacaktÄ±r.

Yeni uzantÄ±lar oluÅŸtururken, geri Ã§aÄŸrÄ±lar yerine sÃ¶zleÅŸmelere yÃ¶nelmek tercih edilmelidir. Geri Ã§aÄŸrÄ±larÄ±n kullanÄ±mÄ±yla ilgili olarak, `sendResponse()` fonksiyonu yalnÄ±zca senkron baÄŸlamda doÄŸrudan yÃ¼rÃ¼tÃ¼ldÃ¼ÄŸÃ¼nde veya olay iÅŸleyicisi `true` dÃ¶ndÃ¼rerek asenkron bir iÅŸlemi belirttiÄŸinde geÃ§erli kabul edilir. HiÃ§bir iÅŸleyici `true` dÃ¶ndÃ¼rmezse veya `sendResponse()` fonksiyonu bellekten kaldÄ±rÄ±lÄ±rsa (Ã§Ã¶p toplayÄ±cÄ± tarafÄ±ndan), `sendMessage()` fonksiyonu ile iliÅŸkili geri Ã§aÄŸrÄ± varsayÄ±lan olarak tetiklenecektir.

## Native Messaging

TarayÄ±cÄ± uzantÄ±larÄ± ayrÄ±ca **sistemdeki ikili dosyalarla stdin Ã¼zerinden iletiÅŸim kurmaya** da olanak tanÄ±r. Uygulama, bunu belirten bir json yÃ¼klemelidir:
```json
{
"name": "com.my_company.my_application",
"description": "My Application",
"path": "C:\\Program Files\\My Application\\chrome_native_messaging_host.exe",
"type": "stdio",
"allowed_origins": ["chrome-extension://knldjmfmopnpolahpmmgbagdohdnhkik/"]
}
```
`name` deÄŸiÅŸkeni, tarayÄ±cÄ± uzantÄ±sÄ±nÄ±n arka plan betiklerinden uygulama ile iletiÅŸim kurmak iÃ§in [`runtime.connectNative()`](https://developer.chrome.com/docs/extensions/reference/api/runtime#method-connectNative) veya [`runtime.sendNativeMessage()`](https://developer.chrome.com/docs/extensions/reference/api/runtime#method-sendNativeMessage) fonksiyonuna geÃ§irilen dizedir. `path`, ikili dosyanÄ±n yoludur, geÃ§erli olan tek `type` stdio'dur (stdin ve stdout kullanÄ±n) ve `allowed_origins`, buna eriÅŸebilecek uzantÄ±larÄ± belirtir (wildcard olamaz).

Chrome/Chromium, bu json'u bazÄ± Windows kayÄ±t defterlerinde ve macOS ile Linux'taki bazÄ± yollarda arayacaktÄ±r (daha fazla bilgi iÃ§in [**docs**](https://developer.chrome.com/docs/extensions/develop/concepts/native-messaging) sayfasÄ±na bakÄ±n).

{% hint style="success" %}
TarayÄ±cÄ± uzantÄ±sÄ±nÄ±n bu iletiÅŸimi kullanabilmesi iÃ§in `nativeMessaing` izninin de tanÄ±mlanmasÄ± gerekir.
{% endhint %}

Bu, bir arka plan betiÄŸi kodunun yerel bir uygulamaya mesaj gÃ¶ndermesinin nasÄ±l gÃ¶rÃ¼ndÃ¼ÄŸÃ¼dÃ¼r:
```javascript
chrome.runtime.sendNativeMessage(
'com.my_company.my_application',
{text: 'Hello'},
function (response) {
console.log('Received ' + response);
}
);
```
In [**bu blog yazÄ±sÄ±nda**](https://spaceraccoon.dev/universal-code-execution-browser-extensions/), yerel mesajlarÄ± kÃ¶tÃ¼ye kullanan bir zayÄ±f desen Ã¶nerilmektedir:

1. TarayÄ±cÄ± uzantÄ±sÄ± iÃ§erik betiÄŸi iÃ§in bir joker karakter deseni vardÄ±r.
2. Ä°Ã§erik betiÄŸi `postMessage` mesajlarÄ±nÄ± arka plan betiÄŸine `sendMessage` kullanarak iletir.
3. Arka plan betiÄŸi mesajÄ± yerel uygulamaya `sendNativeMessage` kullanarak iletir.
4. Yerel uygulama mesajÄ± tehlikeli bir ÅŸekilde iÅŸler, bu da kod yÃ¼rÃ¼tmeye yol aÃ§ar.

Ve bunun iÃ§inde **herhangi bir sayfadan RCE'ye geÃ§iÅŸ yapma Ã¶rneÄŸi bir tarayÄ±cÄ± uzantÄ±sÄ±nÄ± kÃ¶tÃ¼ye kullanarak aÃ§Ä±klanmaktadÄ±r**.

## Bellekte/Kodda/Panoda Hassas Bilgiler

EÄŸer bir TarayÄ±cÄ± UzantÄ±sÄ± **hassas bilgileri belleÄŸinde saklÄ±yorsa**, bu **dÃ¶kÃ¼lebilir** (Ã¶zellikle Windows makinelerinde) ve bu bilgiler iÃ§in **arama yapÄ±labilir**.

Bu nedenle, TarayÄ±cÄ± UzantÄ±sÄ±nÄ±n belleÄŸi **gÃ¼venli olarak kabul edilmemelidir** ve **hassas bilgiler** (kimlik bilgileri veya mnemonik ifadeler gibi) **saklanmamalÄ±dÄ±r**.

Elbette, **hassas bilgileri kodda saklamayÄ±n**, Ã§Ã¼nkÃ¼ bu **kamusal** olacaktÄ±r.

TarayÄ±cÄ±dan bellek dÃ¶kmek iÃ§in **iÅŸlem belleÄŸini dÃ¶kebilir** veya tarayÄ±cÄ± uzantÄ±sÄ±nÄ±n **ayarlarÄ±na** gitmek iÃ§in **`Inspect pop-up`** Ã¼zerine tÄ±klayÄ±n -> **`Memory`** bÃ¶lÃ¼mÃ¼nde -> **`Take a snapshot`** ve hassas bilgileri bulmak iÃ§in anlÄ±k gÃ¶rÃ¼ntÃ¼ iÃ§inde **`CTRL+F`** ile arama yapÄ±n.

AyrÄ±ca, mnemonik anahtarlar veya ÅŸifreler gibi son derece hassas bilgilerin **panoya kopyalanmasÄ±na izin verilmemelidir** (veya en azÄ±ndan birkaÃ§ saniye iÃ§inde panodan kaldÄ±rÄ±lmalÄ±dÄ±r) Ã§Ã¼nkÃ¼ bu durumda panoyu izleyen iÅŸlemler bunlarÄ± alabilecektir.

## TarayÄ±cÄ±da Bir UzantÄ± YÃ¼kleme

1. **TarayÄ±cÄ± UzantÄ±sÄ±nÄ± indirin** ve aÃ§Ä±n
2. **`chrome://extensions/`** adresine gidin ve `GeliÅŸtirici Modu`nu **etkinleÅŸtirin**
3. **`YÃ¼klenmemiÅŸ`** butonuna tÄ±klayÄ±n

**Firefox'ta** **`about:debugging#/runtime/this-firefox`** adresine gidin ve **`GeÃ§ici Eklenti YÃ¼kle`** butonuna tÄ±klayÄ±n.

## MaÄŸazadan kaynak kodunu alma

Bir Chrome uzantÄ±sÄ±nÄ±n kaynak kodu Ã§eÅŸitli yÃ¶ntemlerle elde edilebilir. AÅŸaÄŸÄ±da her seÃ§enek iÃ§in ayrÄ±ntÄ±lÄ± aÃ§Ä±klamalar ve talimatlar bulunmaktadÄ±r.

### Komut SatÄ±rÄ± ile ZIP Olarak UzantÄ±yÄ± Ä°ndirme

Bir Chrome uzantÄ±sÄ±nÄ±n kaynak kodu, komut satÄ±rÄ± kullanÄ±larak ZIP dosyasÄ± olarak indirilebilir. Bu, belirli bir URL'den ZIP dosyasÄ±nÄ± almak iÃ§in `curl` kullanmayÄ± ve ardÄ±ndan ZIP dosyasÄ±nÄ±n iÃ§eriÄŸini bir dizine Ã§Ä±karmayÄ± iÃ§erir. Ä°ÅŸte adÄ±mlar:

1. `"extension_id"` kÄ±smÄ±nÄ± uzantÄ±nÄ±n gerÃ§ek ID'si ile deÄŸiÅŸtirin.
2. AÅŸaÄŸÄ±daki komutlarÄ± Ã§alÄ±ÅŸtÄ±rÄ±n:
```bash
extension_id=your_extension_id   # Replace with the actual extension ID
curl -L -o "$extension_id.zip" "https://clients2.google.com/service/update2/crx?response=redirect&os=mac&arch=x86-64&nacl_arch=x86-64&prod=chromecrx&prodchannel=stable&prodversion=44.0.2403.130&x=id%3D$extension_id%26uc"
unzip -d "$extension_id-source" "$extension_id.zip"
```
### CRX Viewer web sitesini kullanÄ±n

[https://robwu.nl/crxviewer/](https://robwu.nl/crxviewer/)

### CRX Viewer uzantÄ±sÄ±nÄ± kullanÄ±n

BaÅŸka bir pratik yÃ¶ntem, aÃ§Ä±k kaynaklÄ± bir proje olan Chrome Extension Source Viewer'Ä± kullanmaktÄ±r. [Chrome Web Store](https://chrome.google.com/webstore/detail/chrome-extension-source-v/jifpbeccnghkjeaalbbjmodiffmgedin?hl=en) Ã¼zerinden yÃ¼klenebilir. GÃ¶rÃ¼ntÃ¼leyicinin kaynak kodu [GitHub deposunda](https://github.com/Rob--W/crxviewer) mevcuttur.

### Yerel olarak yÃ¼klenmiÅŸ uzantÄ±nÄ±n kaynaÄŸÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyin

Yerel olarak yÃ¼klenmiÅŸ Chrome uzantÄ±larÄ± da incelenebilir. Ä°ÅŸte nasÄ±l:

1. `chrome://version/` adresine giderek Chrome yerel profil dizininize eriÅŸin ve "Profil Yolu" alanÄ±nÄ± bulun.
2. Profil dizinindeki `Extensions/` alt klasÃ¶rÃ¼ne gidin.
3. Bu klasÃ¶r, genellikle okunabilir formatta kaynak kodlarÄ±yla birlikte tÃ¼m yÃ¼klenmiÅŸ uzantÄ±larÄ± iÃ§erir.

UzantÄ±larÄ± tanÄ±mlamak iÃ§in, kimliklerini isimlere eÅŸleyebilirsiniz:

* Her uzantÄ±nÄ±n kimliklerini gÃ¶rmek iÃ§in `about:extensions` sayfasÄ±nda GeliÅŸtirici Modu'nu etkinleÅŸtirin.
* Her uzantÄ±nÄ±n klasÃ¶rÃ¼nde, `manifest.json` dosyasÄ± okunabilir bir `name` alanÄ± iÃ§erir ve bu, uzantÄ±yÄ± tanÄ±mlamanÄ±za yardÄ±mcÄ± olur.

### Bir Dosya ArÅŸivleyici veya AÃ§Ä±cÄ± KullanÄ±n

Chrome Web Store'a gidin ve uzantÄ±yÄ± indirin. Dosya `.crx` uzantÄ±sÄ±na sahip olacaktÄ±r. Dosya uzantÄ±sÄ±nÄ± `.crx`'den `.zip`'e deÄŸiÅŸtirin. ZIP dosyasÄ±nÄ±n iÃ§eriÄŸini Ã§Ä±karmak iÃ§in herhangi bir dosya arÅŸivleyici (WinRAR, 7-Zip vb.) kullanÄ±n.

### Chrome'da GeliÅŸtirici Modunu KullanÄ±n

Chrome'u aÃ§Ä±n ve `chrome://extensions/` adresine gidin. SaÄŸ Ã¼stte "GeliÅŸtirici modu"nu etkinleÅŸtirin. "PaketlenmemiÅŸ uzantÄ±yÄ± yÃ¼kle..." seÃ§eneÄŸine tÄ±klayÄ±n. UzantÄ±nÄ±zÄ±n dizinine gidin. Bu, kaynak kodunu indirmez, ancak zaten indirilmiÅŸ veya geliÅŸtirilmiÅŸ bir uzantÄ±nÄ±n kodunu gÃ¶rÃ¼ntÃ¼lemek ve deÄŸiÅŸtirmek iÃ§in faydalÄ±dÄ±r.

## Chrome uzantÄ± manifest veri seti

ZayÄ±f tarayÄ±cÄ± uzantÄ±larÄ±nÄ± tespit etmeye Ã§alÄ±ÅŸmak iÃ§in [https://github.com/palant/chrome-extension-manifests-dataset](https://github.com/palant/chrome-extension-manifests-dataset) adresini kullanabilir ve manifest dosyalarÄ±nÄ± potansiyel olarak zayÄ±f iÅŸaretler iÃ§in kontrol edebilirsiniz. Ã–rneÄŸin, 25000'den fazla kullanÄ±cÄ±sÄ± olan, `content_scripts` ve `nativeMessaing` iznine sahip uzantÄ±larÄ± kontrol etmek iÃ§in: 

{% code overflow="wrap" %}
```bash
# Query example from https://spaceraccoon.dev/universal-code-execution-browser-extensions/
node query.js -f "metadata.user_count > 250000" "manifest.content_scripts?.length > 0 && manifest.permissions?.includes('nativeMessaging')"
```
{% endcode %}

## GÃ¼venlik Denetimi Kontrol Listesi

TarayÄ±cÄ± UzantÄ±larÄ±nÄ±n **sÄ±nÄ±rlÄ± bir saldÄ±rÄ± yÃ¼zeyi** olmasÄ±na raÄŸmen, bazÄ±larÄ± **zayÄ±flÄ±klar** veya **potansiyel gÃ¼Ã§lendirme iyileÅŸtirmeleri** iÃ§erebilir. AÅŸaÄŸÄ±dakiler en yaygÄ±n olanlardÄ±r:

* [ ] Ä°stenen **`permissions`**'Ä± mÃ¼mkÃ¼n olduÄŸunca **sÄ±nÄ±rlayÄ±n**
* [ ] **`host_permissions`**'Ä± mÃ¼mkÃ¼n olduÄŸunca **sÄ±nÄ±rlayÄ±n**
* [ ] **GÃ¼Ã§lÃ¼** bir **`content_security_policy`** kullanÄ±n
* [ ] **`externally_connectable`**'Ä± mÃ¼mkÃ¼n olduÄŸunca **sÄ±nÄ±rlayÄ±n**, eÄŸer gerek yoksa ve mÃ¼mkÃ¼nse, varsayÄ±lan olarak bÄ±rakmayÄ±n, **`{}`** belirtin
* [ ] EÄŸer burada **XSS veya ele geÃ§irme** iÃ§in savunmasÄ±z bir **URL** belirtilmiÅŸse, bir saldÄ±rgan **arka plan betiklerine doÄŸrudan mesaj gÃ¶nderebilir**. Ã‡ok gÃ¼Ã§lÃ¼ bir atlatma.
* [ ] **`web_accessible_resources`**'Ä± mÃ¼mkÃ¼n olduÄŸunca **sÄ±nÄ±rlayÄ±n**, mÃ¼mkÃ¼nse boÅŸ bÄ±rakÄ±n.
* [ ] EÄŸer **`web_accessible_resources`** yoksa, [**ClickJacking**](browext-clickjacking.md) iÃ§in kontrol edin
* [ ] EÄŸer herhangi bir **iletiÅŸim** uzantÄ±dan **web sayfasÄ±na** oluyorsa, iletiÅŸimde oluÅŸan [**XSS**](browext-xss-example.md) **zayÄ±flÄ±klarÄ±nÄ±** kontrol edin.
* [ ] EÄŸer Post MesajlarÄ± kullanÄ±lÄ±yorsa, [**Post Message zayÄ±flÄ±klarÄ±**](../postmessage-vulnerabilities/)** iÃ§in kontrol edin.**
* [ ] EÄŸer **Content Script DOM detaylarÄ±na eriÅŸiyorsa**, web tarafÄ±ndan **deÄŸiÅŸtirilirse XSS** **giriÅŸine neden olmadÄ±klarÄ±nÄ±** kontrol edin
* [ ] Bu iletiÅŸimin **Content Script -> Arka plan betiÄŸi iletiÅŸimi** ile de ilgili olduÄŸuna Ã¶zel bir vurgu yapÄ±n
* [ ] EÄŸer arka plan betiÄŸi **native messaging** aracÄ±lÄ±ÄŸÄ±yla iletiÅŸim kuruyorsa, iletiÅŸimin gÃ¼venli ve temiz olduÄŸundan emin olun
* [ ] **Hassas bilgiler** TarayÄ±cÄ± UzantÄ±sÄ± **kodunun** iÃ§inde **saklanmamalÄ±dÄ±r**
* [ ] **Hassas bilgiler** TarayÄ±cÄ± UzantÄ±sÄ± **belleÄŸinin** iÃ§inde **saklanmamalÄ±dÄ±r**
* [ ] **Hassas bilgiler** **dosya sisteminde korunmasÄ±z** olarak **saklanmamalÄ±dÄ±r**

## AraÃ§lar

### [**Tarnish**](https://thehackerblog.com/tarnish/)

* SaÄŸlanan bir Chrome web maÄŸazasÄ± baÄŸlantÄ±sÄ±ndan herhangi bir Chrome uzantÄ±sÄ±nÄ± Ã§eker.
* [**manifest.json**](https://developer.chrome.com/extensions/manifest) **gÃ¶rÃ¼ntÃ¼leyici**: uzantÄ±nÄ±n manifestosunun JSON formatÄ±nda dÃ¼zenlenmiÅŸ bir versiyonunu basitÃ§e gÃ¶rÃ¼ntÃ¼ler.
* **Parmak Ä°zi Analizi**: [web\_accessible\_resources](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) tespiti ve Chrome uzantÄ±sÄ± parmak izi JavaScript'inin otomatik olarak Ã¼retilmesi.
* **Potansiyel Clickjacking Analizi**: [web\_accessible\_resources](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) direktifi ayarlanmÄ±ÅŸ uzantÄ± HTML sayfalarÄ±nÄ±n tespiti. Bu sayfalarÄ±n amacÄ± doÄŸrultusunda clickjacking'e karÅŸÄ± potansiyel olarak savunmasÄ±zdÄ±r.
* **Ä°zin UyarÄ±sÄ± gÃ¶rÃ¼ntÃ¼leyici**: uzantÄ±yÄ± yÃ¼klemeye Ã§alÄ±ÅŸan bir kullanÄ±cÄ±ya gÃ¶sterilecek tÃ¼m Chrome izin istem uyarÄ±larÄ±nÄ±n listesini gÃ¶sterir.
* **Tehlikeli Fonksiyon(lar)**: bir saldÄ±rgan tarafÄ±ndan potansiyel olarak istismar edilebilecek tehlikeli fonksiyonlarÄ±n yerini gÃ¶sterir (Ã¶rneÄŸin, innerHTML, chrome.tabs.executeScript gibi fonksiyonlar).
* **GiriÅŸ NoktasÄ±(larÄ±)**: uzantÄ±nÄ±n kullanÄ±cÄ±/dÄ±ÅŸ girdi aldÄ±ÄŸÄ± yerleri gÃ¶sterir. Bu, bir uzantÄ±nÄ±n yÃ¼zey alanÄ±nÄ± anlamak ve kÃ¶tÃ¼ niyetli olarak hazÄ±rlanmÄ±ÅŸ verileri uzantÄ±ya gÃ¶ndermek iÃ§in potansiyel noktalarÄ± aramak iÃ§in faydalÄ±dÄ±r.
* Hem Tehlikeli Fonksiyon(lar) hem de GiriÅŸ NoktasÄ±(larÄ±) tarayÄ±cÄ±larÄ±, Ã¼rettikleri uyarÄ±lar iÃ§in aÅŸaÄŸÄ±dakileri iÃ§erir:
* UyarÄ±ya neden olan ilgili kod parÃ§asÄ± ve satÄ±r.
* Sorunun aÃ§Ä±klamasÄ±.
* Kodu iÃ§eren tam kaynak dosyasÄ±nÄ± gÃ¶rÃ¼ntÃ¼lemek iÃ§in bir "DosyayÄ± GÃ¶rÃ¼ntÃ¼le" dÃ¼ÄŸmesi.
* UyarÄ±lan dosyanÄ±n yolu.
* UyarÄ±lan dosyanÄ±n tam Chrome uzantÄ±sÄ± URI'si.
* Arka Plan SayfasÄ± betiÄŸi, Ä°Ã§erik BetiÄŸi, TarayÄ±cÄ± Eylemi vb. gibi dosyanÄ±n tÃ¼rÃ¼.
* EÄŸer savunmasÄ±z satÄ±r bir JavaScript dosyasÄ±ndaysa, dahil edildiÄŸi tÃ¼m sayfalarÄ±n yollarÄ± ile bu sayfalarÄ±n tÃ¼rÃ¼ ve [web\_accessible\_resource](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) durumu.
* **Ä°Ã§erik GÃ¼venlik PolitikasÄ± (CSP) analizÃ¶rÃ¼ ve atlatma kontrolÃ¶rÃ¼**: Bu, uzantÄ±nÄ±zÄ±n CSP'sindeki zayÄ±flÄ±klarÄ± belirtecek ve beyaz listeye alÄ±nmÄ±ÅŸ CDN'ler vb. nedeniyle CSP'nizi atlatmanÄ±n potansiyel yollarÄ±nÄ± aydÄ±nlatacaktÄ±r.
* **Bilinen SavunmasÄ±z KÃ¼tÃ¼phaneler**: Bu, bilinen savunmasÄ±z JavaScript kÃ¼tÃ¼phanelerinin herhangi bir kullanÄ±mÄ±nÄ± kontrol etmek iÃ§in [Retire.js](https://retirejs.github.io/retire.js/) kullanÄ±r.
* UzantÄ±yÄ± ve biÃ§imlendirilmiÅŸ versiyonlarÄ±nÄ± indirin.
* Orijinal uzantÄ±yÄ± indirin.
* UzantÄ±nÄ±n gÃ¼zelleÅŸtirilmiÅŸ bir versiyonunu indirin (otomatik olarak dÃ¼zenlenmiÅŸ HTML ve JavaScript).
* Tarama sonuÃ§larÄ±nÄ±n otomatik Ã¶nbelleÄŸe alÄ±nmasÄ±, bir uzantÄ± taramasÄ± Ã§alÄ±ÅŸtÄ±rmak, ilk kez Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda iyi bir zaman alacaktÄ±r. Ancak ikinci kez, uzantÄ± gÃ¼ncellenmemiÅŸse, sonuÃ§larÄ±n Ã¶nbelleÄŸe alÄ±nmasÄ± nedeniyle neredeyse anÄ±nda olacaktÄ±r.
* BaÄŸlantÄ±lÄ± Rapor URL'leri, baÅŸkalarÄ±na tarnish tarafÄ±ndan Ã¼retilen bir uzantÄ± raporuna kolayca baÄŸlantÄ± vermek iÃ§in.

### [Neto](https://github.com/elevenpaths/neto)

Neto Projesi, Firefox ve Chrome gibi tanÄ±nmÄ±ÅŸ tarayÄ±cÄ±lar iÃ§in tarayÄ±cÄ± eklentilerinin ve uzantÄ±larÄ±nÄ±n gizli Ã¶zelliklerini analiz etmek ve Ã§Ã¶zmek iÃ§in tasarlanmÄ±ÅŸ bir Python 3 paketidir. Bu, ilgili kaynaklardan bu Ã¶zellikleri Ã§Ä±karmak iÃ§in paketlenmiÅŸ dosyalarÄ±n aÃ§Ä±lmasÄ±nÄ± otomatikleÅŸtirir, Ã¶rneÄŸin `manifest.json`, yerelleÅŸtirme klasÃ¶rleri veya JavaScript ve HTML kaynak dosyalarÄ±.

## Referanslar

* **Bu metodoloji iÃ§in yardÄ±mlarÄ± iÃ§in** [**@naivenom**](https://twitter.com/naivenom)'a **teÅŸekkÃ¼rler**
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)
* [https://palant.info/2022/08/10/anatomy-of-a-basic-extension/](https://palant.info/2022/08/10/anatomy-of-a-basic-extension/)
* [https://palant.info/2022/08/24/attack-surface-of-extension-pages/](https://palant.info/2022/08/24/attack-surface-of-extension-pages/)
* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://help.passbolt.com/assets/files/PBL-02-report.pdf](https://help.passbolt.com/assets/files/PBL-02-report.pdf)
* [https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts)
* [https://developer.chrome.com/docs/extensions/mv2/background-pages](https://developer.chrome.com/docs/extensions/mv2/background-pages)
* [https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/](https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/)
* [https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0](https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}
