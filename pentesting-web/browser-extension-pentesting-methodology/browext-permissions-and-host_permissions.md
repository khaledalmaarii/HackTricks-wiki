# BrowExt - Berechtigungen & host\_permissions

<details>

<summary>Lernen Sie AWS-Hacking von Grund auf mit <a href="https://training.hacktricks.xyz/courses/arte">htARTE (HackTricks AWS Red Team Expert)</a>!</summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

- Wenn Sie Ihr Unternehmen in HackTricks bewerben m√∂chten oder HackTricks als PDF herunterladen m√∂chten, √ºberpr√ºfen Sie die [ABONNEMENTPL√ÑNE](https://github.com/sponsors/carlospolop)!
- Holen Sie sich das offizielle PEASS & HackTricks-Merchandise
- Entdecken Sie die PEASS-Familie, unsere Sammlung exklusiver NFTs
- Treten Sie der Discord-Gruppe oder der Telegram-Gruppe bei oder folgen Sie uns auf Twitter
- Teilen Sie Ihre Hacking-Tricks, indem Sie PRs zu den HackTricks- und HackTricks Cloud-GitHub-Repositories einreichen

</details>

## Grundlegende Informationen

### `permissions`

Berechtigungen werden in der Datei **`manifest.json`** der Erweiterung definiert und erm√∂glichen den Zugriff auf fast alles, auf das ein Browser zugreifen kann (Cookies oder physischer Speicher):

Das vorherige Manifest gibt an, dass die Erweiterung die Berechtigung `storage` ben√∂tigt. Dies bedeutet, dass sie die [Storage-API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) verwenden kann, um ihre Daten dauerhaft zu speichern. Im Gegensatz zu Cookies oder `localStorage`-APIs, bei denen Benutzer eine gewisse Kontrolle haben, kann der Erweiterungsspeicher normalerweise nur durch Deinstallation der Erweiterung gel√∂scht werden.

Eine Erweiterung fordert die in ihrer **`manifest.json`**-Datei angegebenen Berechtigungen an. Nach der Installation der Erweiterung k√∂nnen Sie ihre Berechtigungen jederzeit in Ihrem Browser √ºberpr√ºfen, wie in diesem Bild gezeigt:

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

Sie k√∂nnen die [vollst√§ndige Liste der Berechtigungen, die eine Chromium-Browsererweiterung anfordern kann, hier finden](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) und eine [vollst√§ndige Liste f√ºr Firefox-Erweiterungen hier](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions).

### `host_permissions`

Die optionale, aber leistungsstarke Einstellung **`host_permissions`** gibt an, mit welchen Hosts die Erweiterung √ºber APIs wie [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) und [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) interagieren kann.

Die folgenden `host_permissions` erlauben im Grunde genommen jede Webseite:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Dies sind die Hosts, auf die die Browsererweiterung frei zugreifen kann. Dies liegt daran, dass eine Browsererweiterung beim Aufruf von **`fetch("https://gmail.com/")`** nicht durch CORS eingeschr√§nkt wird.

## Missbrauch von `permissions` und `host_permissions`

### Tabs

Dar√ºber hinaus erm√∂glichen **`host_permissions`** auch erweiterte [**Tabs-API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **Funktionalit√§ten**. Sie erm√∂glichen es der Erweiterung, [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) aufzurufen und nicht nur eine **Liste der Browser-Tabs des Benutzers** zur√ºckzugeben, sondern auch zu erfahren, welche **Webseite (Adresse und Titel) geladen ist**.

{% hint style="danger" %}
Nicht nur das, auch Listener wie [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) **werden ebenfalls viel n√ºtzlicher**. Diese werden benachrichtigt, wenn eine neue Seite in einem Tab geladen wird.
{% endhint %}

### Ausf√ºhren von Inhalts-Skripten <a href="#running-content-scripts" id="running-content-scripts"></a>

Inhaltsskripte sind nicht unbedingt statisch in das Erweiterungsmanifest geschrieben. Bei ausreichenden **`host_permissions`** k√∂nnen Erweiterungen sie auch dynamisch laden, indem sie [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) oder [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript) aufrufen.

Beide APIs erm√∂glichen nicht nur das Ausf√ºhren von Dateien, die in den Erweiterungen als Inhalts-Skripte enthalten sind, sondern auch **beliebigen Code**. Die erste API erlaubt das √úbergeben von JavaScript-Code als Zeichenkette, w√§hrend die zweite eine JavaScript-Funktion erwartet, die weniger anf√§llig f√ºr Injektionsl√ºcken ist. Dennoch k√∂nnen beide APIs gro√üen Schaden anrichten, wenn sie missbraucht werden.

{% hint style="danger" %}
Zus√§tzlich zu den oben genannten F√§higkeiten k√∂nnten Inhalts-Skripte zum Beispiel **Anmeldeinformationen abfangen**, die in Webseiten eingegeben werden. Eine klassische M√∂glichkeit, sie zu missbrauchen, besteht darin, auf jeder Website **Werbung einzuf√ºgen**. Es ist auch m√∂glich, **Betrugsnachrichten** hinzuzuf√ºgen, um die Glaubw√ºrdigkeit von Nachrichtenwebsites zu missbrauchen. Schlie√ülich k√∂nnten sie **Banking-Websites manipulieren**, um Geldtransfers umzuleiten.
{% endhint %}

### Implizite Berechtigungen <a href="#implicit-privileges" id="implicit-privileges"></a>

Einige Erweiterungsberechtigungen **m√ºssen nicht explizit deklariert werden**. Ein Beispiel daf√ºr ist die [Tabs-API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): Ihre grundlegende Funktionalit√§t ist ohne jegliche Berechtigungen zug√§nglich. Jede Erweiterung kann benachrichtigt werden, wenn Sie Tabs √∂ffnen und schlie√üen, sie wei√ü jedoch nicht, welche Website diesen Tabs entspricht.

Klingt zu harmlos? Die [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) ist etwas weniger harmlos. Sie kann verwendet werden, um **einen neuen Tab zu erstellen**, im Wesentlichen das Gleiche wie [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open), das von jeder Website aufgerufen werden kann. W√§hrend `window.open()` jedoch vom Pop-up-Blocker beeinflusst wird, gilt dies nicht f√ºr `tabs.create()`.

{% hint style="danger" %}
Eine Erweiterung kann jederzeit beliebig viele Tabs erstellen.
{% endhint %}

Wenn Sie die m√∂glichen Parameter von `tabs.create()` durchsehen, werden Sie auch feststellen, dass seine F√§higkeiten weit √ºber das hinausgehen, was `window.open()` steuern darf. Und w√§hrend Firefox nicht zul√§sst, dass `data:` URIs mit dieser API verwendet werden, hat Chrome keinen solchen Schutz. Die Verwendung solcher URIs auf der obersten Ebene wurde aufgrund von Missbrauch f√ºr Phishing **verboten** [**(Quelle)**](https://bugzilla.mozilla.org/show_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) ist der `tabs.create()` sehr √§hnlich, √§ndert jedoch einen vorhandenen Tab. Eine b√∂sartige Erweiterung kann beispielsweise willk√ºrlich eine Werbeseite in einen Ihrer Tabs laden und den entsprechenden Tab auch aktivieren.

### Webcam, Geolocation und Co. <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Sie wissen wahrscheinlich, dass Websites spezielle Berechtigungen anfordern k√∂nnen, z. B. um auf Ihre Webcam (Videokonferenz-Tools) oder geografischen Standort (Karten) zuzugreifen. Es handelt sich um Funktionen mit erheblichem Missbrauchspotenzial, sodass Benutzer jedes Mal best√§tigen m√ºssen, dass sie dies immer noch m√∂chten.

{% hint style="danger" %}
Nicht so bei Browsererweiterungen. **Wenn eine Browsererweiterung** [**Zugriff auf Ihre Webcam oder Ihr Mikrofon**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)** m√∂chte, muss sie dies nur einmal anfordern**
{% endhint %}

Normalerweise tut eine Erweiterung dies sofort nach der Installation. Sobald diese Aufforderung akzeptiert wurde, ist **der Zugriff auf die Webcam jederzeit m√∂glich**, auch wenn der Benutzer zu diesem Zeitpunkt nicht mit der Erweiterung interagiert. Ja, ein Benutzer wird diese Aufforderung nur akzeptieren, wenn die Erweiterung wirklich Zugriff auf die Webcam ben√∂tigt. Aber danach muss er der Erweiterung vertrauen, nichts heimlich aufzuzeichnen.

Bei Zugriff auf [Ihren genauen geografischen Standort](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) oder [Inhalte Ihrer Zwischenablage](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API) ist eine explizite Berechtigung √ºberhaupt nicht erforderlich. **Eine Erweiterung f√ºgt einfach `geolocation` oder `clipboard` zum** [**permissions-Eintrag**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **in ihrem Manifest hinzu**. Diese Zugriffsrechte werden dann implizit gew√§hrt, wenn die Erweiterung installiert wird. Daher kann eine b√∂sartige oder kompromittierte Erweiterung mit diesen Berechtigungen Ihr Bewegungsprofil erstellen oder Ihre Zwischenablage nach kopierten Passw√∂rtern √ºberwachen, ohne dass Sie etwas bemerken.

Das Hinzuf√ºgen des Schl√ºsselworts **`history`** zum [permissions-Eintrag](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) des Erweiterungsmanifests gew√§hrt **Zugriff auf die** [**history API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). Dadurch kann die gesamte Browser-History des Benutzers auf einmal abgerufen werden, ohne darauf zu warten, dass der Benutzer diese Websites erneut besucht.

Die **`bookmarks`**-Berechtigung hat ein √§hnliches Missbrauchspotenzial. Sie erm√∂glicht das **Auslesen aller Lesezeichen √ºber die** [**bookmarks API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks).

### Berechtigung f√ºr Speicher <a href="#the-storage-permission" id="the-storage-permission"></a>

Der Erweiterungsspeicher ist lediglich eine Schl√ºssel-Wert-Sammlung, die sehr √§hnlich zu [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) ist, das von jeder Website verwendet werden k√∂nnte. Daher sollten hier keine sensiblen Informationen gespeichert werden.

Jedoch k√∂nnten Werbeunternehmen diesen Speicher ebenfalls missbrauchen.

### Weitere Berechtigungen

Sie finden die [**vollst√§ndige Liste der Berechtigungen, die eine Chromium-Browsererweiterung anfordern kann, hier**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) und eine [**vollst√§ndige Liste f√ºr Firefox-Erweiterungen hier**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api_permissions)**.**

## Pr√§vention <a href="#why-not-restrict
## **Referenzen**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
