# BrowExt - izinler ve host\_permissions

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n veya** bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)'da **takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud** github depolarÄ±na PR'lar gÃ¶ndererek **paylaÅŸÄ±n**.

</details>

## Temel Bilgiler

### **`izinler`**

Ä°zinler, genellikle bir tarayÄ±cÄ±nÄ±n eriÅŸebileceÄŸi hemen hemen her ÅŸeye eriÅŸim saÄŸlayan **`manifest.json`** dosyasÄ±nda tanÄ±mlanÄ±r ve (Ã‡erezler veya Fiziksel Depolama):

Ã–nceki manifest dosyasÄ±, uzantÄ±nÄ±n `storage` iznini gerektirdiÄŸini belirtir. Bu, [depolama API'sini](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) kullanarak verilerini kalÄ±cÄ± olarak depolayabilir. KullanÄ±cÄ±lara belirli bir kontrol seviyesi saÄŸlayan Ã§erezler veya `localStorage` API'lerinin aksine, **uzantÄ± depolamasÄ± genellikle yalnÄ±zca uzantÄ±nÄ±n kaldÄ±rÄ±lmasÄ±yla temizlenebilir**.

Bir uzantÄ±, **`manifest.json`** dosyasÄ±nda belirtilen izinleri isteyecek ve UzantÄ±yÄ± yÃ¼kledikten sonra, tarayÄ±cÄ±nÄ±zda **her zaman izinlerini kontrol edebilirsiniz**, bu resimde gÃ¶sterildiÄŸi gibi:

<figure><img src="../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

[Chromium TarayÄ±cÄ± UzantÄ±sÄ±nÄ±n isteyebileceÄŸi izinlerin tam listesini burada bulabilirsiniz](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) ve [Firefox uzantÄ±larÄ± iÃ§in tam liste burada](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

Ä°steÄŸe baÄŸlÄ± ancak gÃ¼Ã§lÃ¼ olan **`host_permissions`** ayarÄ±, uzantÄ±nÄ±n [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) ve [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) gibi API'ler aracÄ±lÄ±ÄŸÄ±yla etkileÅŸimde bulunabileceÄŸi ana bilgisayarlarÄ± belirtir.

AÅŸaÄŸÄ±daki `host_permissions` temel olarak her web sitesine izin verir:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Bu, tarayÄ±cÄ± uzantÄ±sÄ±nÄ±n serbestÃ§e eriÅŸebileceÄŸi ana bilgisayarlar. Bu, bir tarayÄ±cÄ± uzantÄ±sÄ± **`fetch("https://gmail.com/")`** Ã§aÄŸÄ±rdÄ±ÄŸÄ±nda CORS tarafÄ±ndan kÄ±sÄ±tlanmadÄ±ÄŸÄ± iÃ§in geÃ§erlidir.

## `permissions` ve `host_permissions` KÃ¶tÃ¼ye KullanÄ±mÄ±

### Sekmeler

AyrÄ±ca, **`host_permissions`** ayrÄ±ca â€œgeliÅŸmiÅŸâ€ [**sekme API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **iÅŸlevselliÄŸini** aÃ§ar. Bunlar uzantÄ±nÄ±n [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) Ã§aÄŸrÄ±sÄ±na izin verir ve sadece kullanÄ±cÄ±nÄ±n tarayÄ±cÄ± sekmelerinin bir **listesini almakla kalmaz, aynÄ± zamanda yÃ¼klenen web sayfasÄ±nÄ±n (adres ve baÅŸlÄ±k anlamÄ±na gelen) hangisi olduÄŸunu da Ã¶ÄŸrenir**.

{% hint style="danger" %}
Bununla birlikte, [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) gibi dinleyiciler de **daha da kullanÄ±ÅŸlÄ± hale gelir**. Bunlar, bir sekme iÃ§ine yeni bir sayfa yÃ¼klendiÄŸinde bildirilecektir.
{% endhint %}

### Ä°Ã§erik betiklerinin Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ± <a href="#running-content-scripts" id="running-content-scripts"></a>

Ä°Ã§erik betikleri genellikle uzantÄ± manifestosuna statik olarak yazÄ±lmaz. Yeterli **`host_permissions`** verildiÄŸinde, **uzantÄ±lar ayrÄ±ca** [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **veya** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript) **Ã§aÄŸrÄ±larak bunlarÄ± dinamik olarak yÃ¼kleyebilir**.

Her iki API de, iÃ§erik betikleri olarak uzantÄ± iÃ§inde bulunan dosyalarÄ± deÄŸil, aynÄ± zamanda **keyfi kodu da yÃ¼rÃ¼tmeye olanak tanÄ±r**. Ä°lk olan, JavaScript kodunu bir dize olarak iletmeyi saÄŸlarken, ikincisi enjeksiyon gÃ¼venlik aÃ§Ä±klarÄ±na daha az duyarlÄ± bir JavaScript iÅŸlevini bekler. Yine de, her iki API de yanlÄ±ÅŸ kullanÄ±ldÄ±ÄŸÄ±nda ciddi sorunlara yol aÃ§abilir.

{% hint style="danger" %}
YukarÄ±daki yeteneklerin yanÄ± sÄ±ra, iÃ§erik betikleri Ã¶rneÄŸin **kimlik bilgilerini** girildiÄŸi gibi alabilir. BunlarÄ± kÃ¶tÃ¼ye kullanmanÄ±n klasik yollarÄ±ndan biri de her web sitesine **reklam enjekte etmektir**. Haber sitelerinin gÃ¼venilirliÄŸini kÃ¶tÃ¼ye kullanmak iÃ§in **dolandÄ±rÄ±cÄ±lÄ±k mesajlarÄ±** eklemek de mÃ¼mkÃ¼ndÃ¼r. Son olarak, bankacÄ±lÄ±k web sitelerini **para transferlerini yeniden yÃ¶nlendirmek iÃ§in manipÃ¼le edebilirler**.
{% endhint %}

### DolaylÄ± ayrÄ±calÄ±klar <a href="#implicit-privileges" id="implicit-privileges"></a>

BazÄ± uzantÄ± ayrÄ±calÄ±klarÄ± **aÃ§Ä±kÃ§a bildirilmek zorunda deÄŸildir**. Bir Ã¶rnek, [sekme API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) dir: temel iÅŸlevselliÄŸine hiÃ§bir ayrÄ±calÄ±k olmadan eriÅŸilebilir. Herhangi bir uzantÄ±, aÃ§tÄ±ÄŸÄ±nÄ±z ve kapattÄ±ÄŸÄ±nÄ±z sekmeleri bildirilebilir, yalnÄ±zca bu sekmelerin hangi web sitesine karÅŸÄ±lÄ±k geldiÄŸini bilemez.

Ã‡ok zararsÄ±z gÃ¶rÃ¼nÃ¼yor mu? [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) biraz daha az zararlÄ±dÄ±r. Yeni bir sekme oluÅŸturmak iÃ§in kullanÄ±labilir, temelde herhangi bir web sitesi tarafÄ±ndan Ã§aÄŸrÄ±labilen [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) ile aynÄ±dÄ±r. Ancak `window.open()` pop-up engeline tabidir, `tabs.create()` deÄŸildir.

{% hint style="danger" %}
Bir uzantÄ± istediÄŸinde her zaman istediÄŸi sayÄ±da sekme oluÅŸturabilir.
{% endhint %}

`tabs.create()` parametrelerini incelediÄŸinizde, yeteneklerinin `window.open()` tarafÄ±ndan kontrol edilmesine izin verilenin Ã§ok Ã¶tesine gittiÄŸini fark edeceksiniz. Ve Firefox, bu API ile `data:` URI'larÄ±nÄ±n kullanÄ±lmasÄ±na izin vermezken, Chrome'un bÃ¶yle bir korumasÄ± yoktur. **Bu tÃ¼r URI'larÄ±n Ã¼st dÃ¼zeyde kullanÄ±mÄ±** [**dolandÄ±rÄ±cÄ±lÄ±k iÃ§in kÃ¶tÃ¼ye kullanÄ±ldÄ±ÄŸÄ±ndan yasaklanmÄ±ÅŸtÄ±r**](https://bugzilla.mozilla.org/show\_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) `tabs.create()`'ye Ã§ok benzer ancak **mevcut bir sekmeyi deÄŸiÅŸtirir**. Bu nedenle, kÃ¶tÃ¼ niyetli bir uzantÄ± Ã¶rneÄŸin reklam sayfasÄ±nÄ± rastgele bir sekmesine yÃ¼kleyebilir ve ilgili sekmeyi de etkinleÅŸtirebilir.

### Kamera, coÄŸrafi konum ve arkadaÅŸlar <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Muhtemelen web sitelerinin Ã¶zel izinler isteyebileceÄŸini biliyorsunuz, Ã¶rneÄŸin kameranÄ±za (video konferans araÃ§larÄ±) veya coÄŸrafi konumunuza (haritalar) eriÅŸmek iÃ§in. Bu, kÃ¶tÃ¼ye kullanÄ±m potansiyeli yÃ¼ksek Ã¶zelliklerdir, bu nedenle kullanÄ±cÄ±lar her seferinde bunu hala istediklerine dair onay vermek zorundadÄ±r.

{% hint style="danger" %}
Ancak tarayÄ±cÄ± uzantÄ±larÄ± iÃ§in durum farklÄ±dÄ±r. **Bir tarayÄ±cÄ± uzantÄ±sÄ±** [**kameranÄ±za veya mikrofonunuza eriÅŸmek istiyorsa**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, sadece bir kez izin istemesi yeterlidir**
{% endhint %}

Genellikle, bir uzantÄ± bunu yÃ¼klendikten hemen sonra yapar. Bu izin verildiÄŸinde, **kamera eriÅŸimi her zaman mÃ¼mkÃ¼ndÃ¼r**, hatta kullanÄ±cÄ± bu noktada uzantÄ±yla etkileÅŸimde deÄŸilse. Evet, bir kullanÄ±cÄ± yalnÄ±zca uzantÄ±nÄ±n gerÃ§ekten kamera eriÅŸimine ihtiyaÃ§ duyduÄŸunda bu izni kabul eder. Ancak bundan sonra uzantÄ±nÄ±n gizlice bir ÅŸey kaydetmemesi iÃ§in uzantÄ±ya gÃ¼venmek zorundadÄ±r.

[DoÄŸru coÄŸrafi konumunuza](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) veya [panonuzun iÃ§eriÄŸine](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard\_API) eriÅŸim iÃ§in aÃ§Ä±kÃ§a izin vermek gerekli deÄŸildir. **Bir uzantÄ± sadece manifestosunun** [**izinler giriÅŸine**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **`geolocation` veya `clipboard` ekler**. Bu eriÅŸim ayrÄ±calÄ±klarÄ±, uzantÄ± yÃ¼klendiÄŸinde zÄ±mni olarak verilir. Bu nedenle, bu ayrÄ±calÄ±klara sahip kÃ¶tÃ¼ niyetli veya tehlikeye atÄ±lmÄ±ÅŸ bir uzantÄ±, fark etmeden hareket profilinizi oluÅŸturabilir veya panonuzu kopyalanan ÅŸifreler iÃ§in izleyebilir.

[**history`** anahtarÄ±nÄ± uzantÄ± manifestosunun [izinler giriÅŸine](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) eklemek, **kullanÄ±cÄ±nÄ±n tÃ¼m gezinme geÃ§miÅŸine** [**eriÅŸim saÄŸlar**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). Bu, kullanÄ±cÄ±nÄ±n bu web sitelerini tekrar ziyaret etmesini beklemeksizin tÃ¼m gezinme geÃ§miÅŸini almayÄ± saÄŸlar.

**`bookmarks`** **izin** benzer kÃ¶tÃ¼ye kullanÄ±m potansiyeline sahiptir, bu izin **tÃ¼m yer iÅŸaretlerini** [**yer iÅŸaretleri API'si**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks) **aracÄ±lÄ±ÄŸÄ±yla okumayÄ± saÄŸlar**.

### Depolama izni <a href="#the-storage-permission" id="the-storage-permission"></a>

UzantÄ± depolama alanÄ± yalnÄ±zca bir anahtar-deÄŸer koleksiyonudur, herhangi bir web sitesinin kullanabileceÄŸi [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) ile Ã§ok benzerdir. Bu nedenle burada hassas bilgiler saklanmamalÄ±dÄ±r.

Ancak, reklam ÅŸirketleri de bu depoyu kÃ¶tÃ¼ye kullanabilir.

### Daha fazla izin

[**Bir Chromium TarayÄ±cÄ± UzantÄ±sÄ±nÄ±n isteyebileceÄŸi izinlerin tam listesini burada bulabilirsiniz**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) ve [**Firefox uzantÄ±larÄ± iÃ§in tam listeyi burada bulabilirsiniz**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

## Ã–nleme <a href="#why-not-restrict-extension-privileges" id="why-not-restrict-extension-privileges"></a>

Google'Ä±n geliÅŸtirici politikasÄ±, uzantÄ±larÄ±n iÅŸlevselliÄŸi iÃ§in gerekli olan ayrÄ±calÄ±klardan fazlasÄ±nÄ± istemelerini aÃ§Ä±kÃ§a yasaklayarak aÅŸÄ±rÄ± izin isteklerini etkili bir ÅŸekilde azaltÄ±r. Bir tarayÄ±cÄ± uzantÄ±sÄ±nÄ±n bu sÄ±nÄ±rÄ± aÅŸmasÄ±yla ilgili bir Ã¶rnek, tarayÄ±cÄ±yla birlikte tarayÄ±cÄ±da daÄŸÄ±tÄ±lmasÄ±ydÄ±, bir eklenti maÄŸazasÄ± aracÄ±lÄ±ÄŸÄ±yla deÄŸil.

TarayÄ±cÄ±lar, uzantÄ± ayrÄ±calÄ±klarÄ±nÄ±n kÃ¶tÃ¼ye kullanÄ±mÄ±nÄ± daha da azaltabilir. Ã–rneÄŸin, ekran kaydÄ± iÃ§in kullanÄ±lan Chrome'un [tabCapture](https://developer.chrome.com/docs/extensions/reference/tabCapture/) ve [desktopCapture](https://developer.chrome.com/docs/extensions/reference/desktopCapture/) API'larÄ±, kÃ¶tÃ¼ye kullanÄ±mÄ± en aza indirmek amacÄ±yla tasarlanmÄ±ÅŸtÄ±r. tabCapture API'si, uzantÄ± simgesine tÄ±klama gibi doÄŸrudan kullanÄ±cÄ± etkileÅŸimi aracÄ±lÄ±ÄŸÄ±yla yalnÄ±zca etkinleÅŸtirilebilirken, desktopCapture, kaydedilecek pencerenin onayÄ±nÄ± almak iÃ§in kullanÄ±cÄ± onayÄ± gerektirir, gizlice kayÄ±t faaliyetlerini Ã¶nler.

Ancak, gÃ¼venlik Ã¶nlemlerini sÄ±kÄ±laÅŸtÄ±rmak genellikle uzantÄ±larÄ±n esnekliÄŸinin ve kullanÄ±cÄ± dostu olma Ã¶zelliÄŸinin azalmasÄ±na neden olur. [activeTab izni](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#activetab\_permission) bu dengeyi gÃ¶sterir. UzantÄ±larÄ±n tÃ¼m internet Ã¼zerinde ana bilgisayar ayrÄ±calÄ±klarÄ± istemelerine gerek kalmadan yalnÄ±zca kullanÄ±cÄ±nÄ±n aÃ§Ä±kÃ§a etkinleÅŸtirmesi durumunda yalnÄ±zca mevcut sekmeye eriÅŸmelerine izin vermek iÃ§in tanÄ±tÄ±ldÄ±. Bu model, kullanÄ±cÄ± tarafÄ±ndan baÅŸlatÄ±lan eylemler gerektiren uzantÄ±lar iÃ§in etkilidir ancak otomatik veya Ã¶nceden hareket gerektiren uzantÄ±lar iÃ§in yetersiz kalÄ±r, bu da kullanÄ±m kolaylÄ±ÄŸÄ±nÄ± ve anÄ±nda yanÄ±t verme yeteneÄŸini tehlikeye atar.
## **Referanslar**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
