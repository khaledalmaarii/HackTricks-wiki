# BrowExt - uprawnienia i host\_permissions

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCYJNY**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

### **`permissions`**

Uprawnienia sÄ… okreÅ›lane w pliku **`manifest.json`** rozszerzenia za pomocÄ… wÅ‚aÅ›ciwoÅ›ci **`permissions`** i umoÅ¼liwiajÄ… dostÄ™p do prawie wszystkiego, do czego przeglÄ…darka ma dostÄ™p (ciasteczka lub pamiÄ™Ä‡ fizycznÄ…):

Poprzedni manifest deklaruje, Å¼e rozszerzenie wymaga uprawnienia `storage`. Oznacza to, Å¼e moÅ¼e korzystaÄ‡ z [API pamiÄ™ci](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage), aby przechowywaÄ‡ swoje dane trwale. W przeciwieÅ„stwie do ciasteczek lub interfejsÃ³w `localStorage`, ktÃ³re dajÄ… uÅ¼ytkownikom pewien poziom kontroli, **pamiÄ™Ä‡ rozszerzenia moÅ¼na zazwyczaj wyczyÅ›ciÄ‡ tylko poprzez odinstalowanie rozszerzenia**.

Rozszerzenie bÄ™dzie prosiÄ‡ o uprawnienia wskazane w pliku **`manifest.json`**, a po zainstalowaniu rozszerzenia zawsze moÅ¼esz **sprawdziÄ‡ jego uprawnienia w przeglÄ…darce**, jak pokazano na tym obrazku:

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

MoÅ¼esz znaleÅºÄ‡ [**peÅ‚nÄ… listÄ™ uprawnieÅ„, ktÃ³re rozszerzenie przeglÄ…darki Chromium moÅ¼e Å¼Ä…daÄ‡ tutaj**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) oraz [**peÅ‚nÄ… listÄ™ dla rozszerzeÅ„ Firefox tutaj**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

Opcjonalne, ale potÄ™Å¼ne ustawienie **`host_permissions`** wskazuje, z ktÃ³rymi hostami rozszerzenie bÄ™dzie mogÅ‚o wspÃ³Å‚dziaÅ‚aÄ‡ za pomocÄ… interfejsÃ³w takich jak [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) i [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs).

NastÄ™pujÄ…ce `host_permissions` pozwalajÄ… praktycznie na interakcjÄ™ z kaÅ¼dÄ… stronÄ… internetowÄ…:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Oto hosty, do ktÃ³rych rozszerzenie przeglÄ…darki ma swobodny dostÄ™p. Dzieje siÄ™ tak, poniewaÅ¼ gdy rozszerzenie przeglÄ…darki wywoÅ‚uje **`fetch("https://gmail.com/")`**, nie jest ograniczone przez CORS.

## NaduÅ¼ywanie `permissions` i `host_permissions`

### Karty

Ponadto, **`host_permissions`** odblokowujÄ… rÃ³wnieÅ¼ "zaawansowane" [**funkcjonalnoÅ›ci API kart**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs). PozwalajÄ… rozszerzeniu na wywoÅ‚anie [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) i nie tylko otrzymaÄ‡ **listÄ™ kart przeglÄ…darki uÅ¼ytkownika**, ale takÅ¼e dowiedzieÄ‡ siÄ™, ktÃ³ra **strona internetowa (adres i tytuÅ‚) jest zaÅ‚adowana**.

{% hint style="danger" %}
Nie tylko to, sÅ‚uchacze takie jak [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) **stajÄ… siÄ™ rÃ³wnieÅ¼ znacznie bardziej przydatne**. ZostanÄ… powiadomieni, gdy nowa strona zostanie zaÅ‚adowana do karty.
{% endhint %}

### Wykonywanie skryptÃ³w treÅ›ci <a href="#running-content-scripts" id="running-content-scripts"></a>

Skrypty treÅ›ci nie muszÄ… byÄ‡ pisane statycznie w manifeÅ›cie rozszerzenia. DziÄ™ki wystarczajÄ…cym **`host_permissions`**, rozszerzenia mogÄ… rÃ³wnieÅ¼ Å‚adowaÄ‡ je dynamicznie, wywoÅ‚ujÄ…c [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **lub** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript).

Obie API umoÅ¼liwiajÄ… wykonanie nie tylko plikÃ³w zawartych w rozszerzeniach jako skrypty treÅ›ci, ale takÅ¼e **dowolnego kodu**. Pierwsze z nich umoÅ¼liwia przekazywanie kodu JavaScript jako ciÄ…gu znakÃ³w, podczas gdy drugie oczekuje funkcji JavaScript, ktÃ³ra jest mniej podatna na podatnoÅ›ci zwiÄ…zane z wstrzykiwaniem. Jednak oba API mogÄ… wyrzÄ…dziÄ‡ szkody, jeÅ›li sÄ… niewÅ‚aÅ›ciwie uÅ¼ywane.

{% hint style="danger" %}
OprÃ³cz powyÅ¼szych moÅ¼liwoÅ›ci, skrypty treÅ›ci mogÄ… na przykÅ‚ad **przechwytywaÄ‡ dane uwierzytelniajÄ…ce**, gdy sÄ… wprowadzane na strony internetowe. Inny klasyczny sposÃ³b ich naduÅ¼ycia to **wstrzykiwanie reklam** na kaÅ¼dej stronie internetowej. MoÅ¼liwe jest rÃ³wnieÅ¼ dodawanie **faÅ‚szywych wiadomoÅ›ci** w celu naduÅ¼ycia wiarygodnoÅ›ci stron informacyjnych. Wreszcie, mogÄ… **manipulowaÄ‡ stronami bankowymi**, przekierowujÄ…c transfery pieniÄ™Å¼ne.
{% endhint %}

### Niejawne uprawnienia <a href="#implicit-privileges" id="implicit-privileges"></a>

NiektÃ³re uprawnienia rozszerzeÅ„ **nie muszÄ… byÄ‡ jawnie deklarowane**. PrzykÅ‚adem jest [API kart](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): jego podstawowa funkcjonalnoÅ›Ä‡ jest dostÄ™pna bez Å¼adnych uprawnieÅ„. KaÅ¼de rozszerzenie moÅ¼e otrzymaÄ‡ powiadomienie, gdy otwierasz i zamykasz karty, po prostu nie bÄ™dzie wiedziaÅ‚o, ktÃ³re strony internetowe odpowiadajÄ… tym kartom.

Brzmi zbyt niewinnie? [API tabs.create()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) jest nieco mniej niewinne. MoÅ¼e byÄ‡ uÅ¼ywane do **tworzenia nowej karty**, co jest praktycznie toÅ¼same z [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open), ktÃ³re moÅ¼e byÄ‡ wywoÅ‚ywane przez dowolnÄ… stronÄ™ internetowÄ…. Jednak podczas gdy `window.open()` podlega **blokadzie wyskakujÄ…cych okienek, `tabs.create()` nie**.

{% hint style="danger" %}
Rozszerzenie moÅ¼e tworzyÄ‡ dowolnÄ… liczbÄ™ kart w dowolnym momencie.
{% endhint %}

JeÅ›li przejrzysz moÅ¼liwe parametry `tabs.create()`, zauwaÅ¼ysz rÃ³wnieÅ¼, Å¼e jego moÅ¼liwoÅ›ci wykraczajÄ… daleko poza to, co `window.open()` moÅ¼e kontrolowaÄ‡. I podczas gdy Firefox nie zezwala na uÅ¼ycie URI `data:` z tym API, Chrome nie ma takiej ochrony. **UÅ¼ycie takich URI na najwyÅ¼szym poziomie zostaÅ‚o** [**zakazane ze wzglÄ™du na naduÅ¼ycie w celu phishingu**](https://bugzilla.mozilla.org/show_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) jest bardzo podobne do `tabs.create()`, ale **modyfikuje istniejÄ…cÄ… kartÄ™**. ZÅ‚oÅ›liwe rozszerzenie moÅ¼e na przykÅ‚ad dowolnie Å‚adowaÄ‡ stronÄ™ reklamowÄ… do jednej z twoich kart i aktywowaÄ‡ tÄ™ kartÄ™.

### Kamera internetowa, geolokalizacja i inne <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Prawdopodobnie wiesz, Å¼e strony internetowe mogÄ… prosiÄ‡ o specjalne uprawnienia, na przykÅ‚ad dostÄ™p do kamery internetowej (narzÄ™dzia do wideokonferencji) lub lokalizacji geograficznej (mapy). SÄ… to funkcje z duÅ¼ym potencjaÅ‚em naduÅ¼ycia, dlatego uÅ¼ytkownicy muszÄ… za kaÅ¼dym razem potwierdzaÄ‡, czy nadal tego chcÄ….

{% hint style="danger" %}
Nie dotyczy to jednak rozszerzeÅ„ przeglÄ…darki. **JeÅ›li rozszerzenie przeglÄ…darki** [**chce uzyskaÄ‡ dostÄ™p do twojej kamery internetowej lub mikrofonu**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, musi poprosiÄ‡ o zgodÄ™ tylko raz**
{% endhint %}

Zazwyczaj rozszerzenie robi to od razu po zainstalowaniu. Po zaakceptowaniu tego monitu, **dostÄ™p do kamery internetowej jest moÅ¼liwy w dowolnym momencie**, nawet jeÅ›li uÅ¼ytkownik nie korzysta w tym momencie z rozszerzenia. Tak, uÅ¼ytkownik zaakceptuje ten monit tylko wtedy, gdy rozszerzenie rzeczywiÅ›cie potrzebuje dostÄ™pu do kamery internetowej. Ale potem musi zaufaÄ‡ rozszerzeniu, Å¼e nie bÄ™dzie nagrywaÄ‡ niczego potajemnie.

Z dostÄ™pem do [twojej dokÅ‚adnej lokalizacji geograficznej](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) lub [zawartoÅ›ci schowka](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API), nie jest konieczne udzielanie wyraÅºnej zgody. **Rozszerzenie po prostu dodaje `geolocation` lub `clipboard` do** [**wpisu uprawnieÅ„**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **w swoim manifeÅ›cie**. Te uprawnienia dostÄ™pu sÄ… udzielane domyÅ›lnie podczas instalacji rozszerzenia. ZÅ‚oÅ›liwe lub skompromitowane rozszerzenie z tymi uprawnieniami moÅ¼e tworzyÄ‡ twÃ³j profil ruchu lub monitorowaÄ‡ schowek w poszukiwaniu skopiowanych haseÅ‚, bez Å¼ebyÅ› cokolwiek zauwaÅ¼yÅ‚.

Dodanie sÅ‚owa kluczowego **`history`** do [wpisu uprawnieÅ„](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) w manifeÅ›cie rozszerzenia umoÅ¼liwia **dostÄ™p do** [**API historii**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). Pozwala to na pobranie caÅ‚ej historii przeglÄ…dania uÅ¼ytkownika od razu, bez oczekiwania, aÅ¼ uÅ¼ytkownik odwiedzi te strony internetowe ponownie.

**Uprawnienie `bookmarks`** ma podobny potencjaÅ‚ naduÅ¼ycia, umoÅ¼liwia **odczytanie wszystkich zakÅ‚
## **OdnoÅ›niki**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
