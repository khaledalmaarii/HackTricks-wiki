# BrowExt - izinler & host\_izinleri

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Temel Bilgiler

### **`izinler`**

Ä°zinler, uzantÄ±nÄ±n **`manifest.json`** dosyasÄ±nda **`permissions`** Ã¶zelliÄŸi kullanÄ±larak tanÄ±mlanÄ±r ve bir tarayÄ±cÄ±nÄ±n eriÅŸebileceÄŸi hemen her ÅŸeye eriÅŸim saÄŸlar (Ã‡erezler veya Fiziksel Depolama):

Ã–nceki manifest, uzantÄ±nÄ±n `storage` iznine ihtiyaÃ§ duyduÄŸunu belirtir. Bu, verilerini kalÄ±cÄ± olarak depolamak iÃ§in [depolama API'sini](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) kullanabileceÄŸi anlamÄ±na gelir. KullanÄ±cÄ±lara belirli bir kontrol seviyesi veren Ã§erezler veya `localStorage` API'lerinin aksine, **uzantÄ± depolamasÄ± genellikle yalnÄ±zca uzantÄ±yÄ± kaldÄ±rarak temizlenebilir**.

Bir uzantÄ±, **`manifest.json`** dosyasÄ±nda belirtilen izinleri talep edecektir ve uzantÄ±yÄ± yÃ¼kledikten sonra, **her zaman tarayÄ±cÄ±nÄ±zdaki izinlerini kontrol edebilirsiniz**, bu resimde gÃ¶sterildiÄŸi gibi:

<figure><img src="../../.gitbook/assets/image (18).png" alt=""><figcaption></figcaption></figure>

Bir Chromium TarayÄ±cÄ± UzantÄ±sÄ±nÄ±n talep edebileceÄŸi [**tam izin listesine buradan ulaÅŸabilirsiniz**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) ve Firefox uzantÄ±larÄ± iÃ§in [**tam listeye buradan ulaÅŸabilirsiniz**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

Ä°steÄŸe baÄŸlÄ± ancak gÃ¼Ã§lÃ¼ bir ayar olan **`host_permissions`**, uzantÄ±nÄ±n [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) ve [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) gibi API'ler aracÄ±lÄ±ÄŸÄ±yla hangi ana bilgisayarlarla etkileÅŸimde bulunabileceÄŸini belirtir.

AÅŸaÄŸÄ±daki `host_permissions` temelde her web'e izin verir:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Bu, tarayÄ±cÄ± uzantÄ±sÄ±nÄ±n serbestÃ§e eriÅŸebileceÄŸi hostlardÄ±r. Bunun nedeni, bir tarayÄ±cÄ± uzantÄ±sÄ± **`fetch("https://gmail.com/")`** Ã§aÄŸrÄ±sÄ± yaptÄ±ÄŸÄ±nda CORS tarafÄ±ndan kÄ±sÄ±tlanmamÄ±ÅŸ olmasÄ±dÄ±r.

## `permissions` ve `host_permissions` istismar etme

### Sekmeler

AyrÄ±ca, **`host_permissions`** â€œgeliÅŸmiÅŸâ€ [**sekme API'si**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **iÅŸlevselliÄŸini de aÃ§ar.** UzantÄ±nÄ±n [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) Ã§aÄŸrÄ±sÄ±nÄ± yapmasÄ±na ve yalnÄ±zca **kullanÄ±cÄ±nÄ±n tarayÄ±cÄ± sekmelerinin listesini** almakla kalmayÄ±p aynÄ± zamanda hangi **web sayfasÄ±nÄ±n (adres ve baÅŸlÄ±k anlamÄ±nda) yÃ¼klÃ¼ olduÄŸunu Ã¶ÄŸrenmesine** olanak tanÄ±r.

{% hint style="danger" %}
Bununla kalmaz, [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) **gibi dinleyiciler de Ã§ok daha kullanÄ±ÅŸlÄ± hale gelir.** Bu dinleyiciler, bir sekmeye yeni bir sayfa yÃ¼klendiÄŸinde bildirim alÄ±r.
{% endhint %}

### Ä°Ã§erik betiklerini Ã§alÄ±ÅŸtÄ±rma <a href="#running-content-scripts" id="running-content-scripts"></a>

Ä°Ã§erik betikleri, uzantÄ± manifestosuna statik olarak yazÄ±lmak zorunda deÄŸildir. Yeterli **`host_permissions`** verildiÄŸinde, **uzantÄ±lar bunlarÄ± dinamik olarak yÃ¼kleyebilir** [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **veya** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript) Ã§aÄŸrÄ±sÄ± yaparak.

Her iki API de yalnÄ±zca uzantÄ±larda bulunan dosyalarÄ± iÃ§erik betikleri olarak Ã§alÄ±ÅŸtÄ±rmakla kalmaz, aynÄ± zamanda **rastgele kod** da Ã§alÄ±ÅŸtÄ±rabilir. Ä°lki, JavaScript kodunu bir dize olarak geÃ§meye izin verirken, ikincisi, enjeksiyon gÃ¼venlik aÃ§Ä±klarÄ±na daha az eÄŸilimli olan bir JavaScript fonksiyonu bekler. Yine de, her iki API de kÃ¶tÃ¼ye kullanÄ±ldÄ±ÄŸÄ±nda bÃ¼yÃ¼k zararlara yol aÃ§abilir.

{% hint style="danger" %}
YukarÄ±daki yeteneklere ek olarak, iÃ§erik betikleri Ã¶rneÄŸin **kimlik bilgilerini** web sayfalarÄ±na girildiÄŸinde **yakalayabilir.** OnlarÄ± kÃ¶tÃ¼ye kullanmanÄ±n bir baÅŸka klasik yolu, her bir web sitesine **reklam enjekte etmektir.** Haber sitelerinin gÃ¼venilirliÄŸini kÃ¶tÃ¼ye kullanmak iÃ§in **dolandÄ±rÄ±cÄ±lÄ±k mesajlarÄ±** eklemek de mÃ¼mkÃ¼ndÃ¼r. Son olarak, **banka** web sitelerini para transferlerini yÃ¶nlendirmek iÃ§in **manipÃ¼le edebilirler.**
{% endhint %}

### DolaylÄ± ayrÄ±calÄ±klar <a href="#implicit-privileges" id="implicit-privileges"></a>

BazÄ± uzantÄ± ayrÄ±calÄ±klarÄ± **aÃ§Ä±kÃ§a beyan edilmek zorunda deÄŸildir.** Bir Ã¶rnek, [sekme API'si](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): temel iÅŸlevselliÄŸi herhangi bir ayrÄ±calÄ±k olmaksÄ±zÄ±n eriÅŸilebilir. Herhangi bir uzantÄ±, sekmeleri aÃ§tÄ±ÄŸÄ±nÄ±zda ve kapattÄ±ÄŸÄ±nÄ±zda bildirim alabilir, yalnÄ±zca bu sekmelerin hangi web sitesine karÅŸÄ±lÄ±k geldiÄŸini bilmeyecektir.

Bu Ã§ok zararsÄ±z mÄ± geliyor? [tabs.create() API'si](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) biraz daha az zararsÄ±zdÄ±r. Bu, **yeni bir sekme oluÅŸturmak iÃ§in** kullanÄ±labilir, temelde [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) ile aynÄ± olup, herhangi bir web sitesi tarafÄ±ndan Ã§aÄŸrÄ±labilir. Ancak `window.open()` **pop-up engelleyiciye tabi iken, `tabs.create()` deÄŸildir.**

{% hint style="danger" %}
Bir uzantÄ± istediÄŸi kadar sekme oluÅŸturabilir.
{% endhint %}

OlasÄ± `tabs.create()` parametrelerine gÃ¶z attÄ±ÄŸÄ±nÄ±zda, yeteneklerinin `window.open()`'un kontrol edebileceÄŸinden Ã§ok daha Ã¶teye gittiÄŸini de gÃ¶receksiniz. Ve Firefox, bu API ile `data:` URI'lerinin kullanÄ±lmasÄ±na izin vermezken, Chrome'un bÃ¶yle bir korumasÄ± yoktur. **Bu tÃ¼r URI'lerin Ã¼st dÃ¼zeyde kullanÄ±mÄ±,** [**oltalama iÃ§in kÃ¶tÃ¼ye kullanÄ±ldÄ±ÄŸÄ± gerekÃ§esiyle yasaklanmÄ±ÅŸtÄ±r**](https://bugzilla.mozilla.org/show\_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) `tabs.create()` ile Ã§ok benzer, ancak **mevcut bir sekmeyi deÄŸiÅŸtirir.** Yani, kÃ¶tÃ¼ niyetli bir uzantÄ± Ã¶rneÄŸin rastgele bir reklam sayfasÄ±nÄ± sekmelerinizden birine yÃ¼kleyebilir ve ilgili sekmeyi de etkinleÅŸtirebilir.

### Webcam, coÄŸrafi konum ve arkadaÅŸlar <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Web sitelerinin Ã¶zel izinler talep edebileceÄŸini muhtemelen biliyorsunuz, Ã¶rneÄŸin, web kameranÄ±zÄ± (video konferans araÃ§larÄ±) veya coÄŸrafi konumunuzu (haritalar) eriÅŸmek iÃ§in. Bu, kÃ¶tÃ¼ye kullanma potansiyeli olan Ã¶zelliklerdir, bu nedenle kullanÄ±cÄ±larÄ±n her seferinde bunu hala istediklerini onaylamalarÄ± gerekir.

{% hint style="danger" %}
TarayÄ±cÄ± uzantÄ±larÄ± iÃ§in durum bÃ¶yle deÄŸil. **EÄŸer bir tarayÄ±cÄ± uzantÄ±sÄ±** [**web kameranÄ±za veya mikrofonunuza eriÅŸim istiyorsa**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, yalnÄ±zca bir kez izin istemesi yeterlidir.**
{% endhint %}

Tipik olarak, bir uzantÄ± bunu kurulduktan hemen sonra yapar. Bu istem kabul edildiÄŸinde, **web kamera eriÅŸimi her zaman mÃ¼mkÃ¼ndÃ¼r**, kullanÄ±cÄ± bu noktada uzantÄ±yla etkileÅŸimde bulunmasa bile. Evet, bir kullanÄ±cÄ± yalnÄ±zca uzantÄ±nÄ±n gerÃ§ekten web kamera eriÅŸimine ihtiyacÄ± varsa bu istemi kabul eder. Ancak bundan sonra, uzantÄ±nÄ±n gizlice hiÃ§bir ÅŸey kaydetmeyeceÄŸine gÃ¼venmeleri gerekir.

[Tam coÄŸrafi konumunuza](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) veya [panonuzun iÃ§eriÄŸine](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard\_API) eriÅŸim izni vermek tamamen gereksizdir. **Bir uzantÄ±, manifestosunun** [**izinler giriÅŸine**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **`geolocation` veya `clipboard` ekler.** Bu eriÅŸim ayrÄ±calÄ±klarÄ±, uzantÄ± yÃ¼klendiÄŸinde dolaylÄ± olarak verilir. Bu nedenle, bu ayrÄ±calÄ±klara sahip kÃ¶tÃ¼ niyetli veya tehlikeye atÄ±lmÄ±ÅŸ bir uzantÄ±, hareket profilinizi oluÅŸturabilir veya kopyalanan ÅŸifreler iÃ§in panonuzu izleyebilir, siz hiÃ§bir ÅŸey fark etmeden.

**`history`** anahtar kelimesinin uzantÄ± manifestosunun [izinler giriÅŸine](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) eklenmesi, **`history API'sine`** [**eriÅŸim saÄŸlar**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). Bu, kullanÄ±cÄ±nÄ±n tÃ¼m tarayÄ±cÄ± geÃ§miÅŸini bir seferde almasÄ±na olanak tanÄ±r, kullanÄ±cÄ±nÄ±n bu web sitelerini tekrar ziyaret etmesini beklemeden.

**`bookmarks`** **izinleri** benzer kÃ¶tÃ¼ye kullanma potansiyeline sahiptir, bu, **tÃ¼m yer imlerini** [**yer imleri API'si**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks) aracÄ±lÄ±ÄŸÄ±yla okumaya izin verir.

### Depolama izni <a href="#the-storage-permission" id="the-storage-permission"></a>

UzantÄ± depolamasÄ±, herhangi bir web sitesinin kullanabileceÄŸi [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) ile Ã§ok benzer bir anahtar-deÄŸer koleksiyonudur. Bu nedenle, burada hassas bilgiler saklanmamalÄ±dÄ±r.

Ancak, reklam ÅŸirketleri bu depolamayÄ± da kÃ¶tÃ¼ye kullanabilir.

### Daha fazla izin

Bir Chromium TarayÄ±cÄ± UzantÄ±sÄ±nÄ±n talep edebileceÄŸi [**izinlerin tam listesini burada bulabilirsiniz**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) ve Firefox uzantÄ±larÄ± iÃ§in [**tam listeyi burada bulabilirsiniz**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

## Ã–nleme <a href="#why-not-restrict-extension-privileges" id="why-not-restrict-extension-privileges"></a>

Google'Ä±n geliÅŸtirici politikasÄ±, uzantÄ±larÄ±n iÅŸlevselliÄŸi iÃ§in gerekli olandan daha fazla ayrÄ±calÄ±k talep etmesini aÃ§Ä±kÃ§a yasaklar, bu da aÅŸÄ±rÄ± izin taleplerini etkili bir ÅŸekilde azaltÄ±r. Bir tarayÄ±cÄ± uzantÄ±sÄ±nÄ±n bu sÄ±nÄ±rÄ± aÅŸtÄ±ÄŸÄ± bir Ã¶rnek, uzantÄ±nÄ±n bir eklenti maÄŸazasÄ± yerine tarayÄ±cÄ± ile birlikte daÄŸÄ±tÄ±lmasÄ±dÄ±r.

TarayÄ±cÄ±lar, uzantÄ± ayrÄ±calÄ±klarÄ±nÄ±n kÃ¶tÃ¼ye kullanÄ±lmasÄ±nÄ± daha da sÄ±nÄ±rlayabilir. Ã–rneÄŸin, ekran kaydÄ± iÃ§in kullanÄ±lan Chrome'un [tabCapture](https://developer.chrome.com/docs/extensions/reference/tabCapture/) ve [desktopCapture](https://developer.chrome.com/docs/extensions/reference/desktopCapture/) API'leri, kÃ¶tÃ¼ye kullanÄ±mÄ± en aza indirmek iÃ§in tasarlanmÄ±ÅŸtÄ±r. tabCapture API'si yalnÄ±zca uzantÄ± simgesine tÄ±klamak gibi doÄŸrudan kullanÄ±cÄ± etkileÅŸimi ile etkinleÅŸtirilebilirken, desktopCapture, kaydedilecek pencere iÃ§in kullanÄ±cÄ± onayÄ± gerektirir ve gizli kayÄ±t faaliyetlerini Ã¶nler.

Ancak, gÃ¼venlik Ã¶nlemlerinin sÄ±kÄ±laÅŸtÄ±rÄ±lmasÄ± genellikle uzantÄ±larÄ±n esnekliÄŸini ve kullanÄ±cÄ± dostluÄŸunu azaltÄ±r. [activeTab izni](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#activetab\_permission) bu dengeyi gÃ¶stermektedir. Bu, uzantÄ±larÄ±n tÃ¼m internet Ã¼zerinde host ayrÄ±calÄ±klarÄ± talep etme gereÄŸini ortadan kaldÄ±rmak iÃ§in tanÄ±tÄ±lmÄ±ÅŸtÄ±r ve uzantÄ±larÄ±n yalnÄ±zca kullanÄ±cÄ± tarafÄ±ndan aÃ§Ä±kÃ§a etkinleÅŸtirildiÄŸinde mevcut sekmeye eriÅŸmesine izin verir. Bu model, kullanÄ±cÄ± tarafÄ±ndan baÅŸlatÄ±lan eylemler gerektiren uzantÄ±lar iÃ§in etkili olsa da, otomatik veya Ã¶nleyici eylemler gerektirenler iÃ§in yetersiz kalÄ±r ve bu da kullanÄ±m kolaylÄ±ÄŸÄ±nÄ± ve anlÄ±k yanÄ±t verme yeteneÄŸini tehlikeye atar.

## **Kaynaklar**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}
