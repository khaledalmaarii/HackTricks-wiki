# BrowExt - dozvole & host\_dozvole

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne Informacije

### **`dozvole`**

Dozvole su definisane u **`manifest.json`** fajlu pro코irenja koriste캖i svojstvo **`permissions`** i omogu캖avaju pristup skoro svemu 캜emu browser mo쬰 pristupiti (kola캜i캖i ili fizi캜ko skladi코te):

Prethodni manifest deklari코e da pro코irenje zahteva dozvolu `storage`. Ovo zna캜i da mo쬰 koristiti [API za skladi코tenje](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) da bi trajno 캜uvalo svoje podatke. Za razliku od kola캜i캖a ili `localStorage` API-ja koji daju korisnicima odre캠eni nivo kontrole, **skladi코te pro코irenja se obi캜no mo쬰 o캜istiti samo deinstaliranjem pro코irenja**.

Pro코irenje 캖e zatra쬴ti dozvole navedene u svom **`manifest.json`** fajlu i Nakon instaliranja pro코irenja, uvek mo쬰te **proveriti njegove dozvole u svom browseru**, kao 코to je prikazano na ovoj slici:

<figure><img src="../../.gitbook/assets/image (15).png" alt=""><figcaption></figcaption></figure>

Mo쬰te prona캖i [**kompletan spisak dozvola koje Chromium Browser Extension mo쬰 zatra쬴ti ovde**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) i [**kompletan spisak za Firefox ekstenzije ovde**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

Opciono, ali mo캖no pode코avanje **`host_permissions`** ukazuje sa kojim domenima 캖e pro코irenje mo캖i da interaguje putem API-ja kao 코to su [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) i [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs).

Slede캖e `host_permissions` prakti캜no dozvoljavaju svakom veb sajtu:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Ovo su doma캖ini kojima pro코irenje pregleda캜a mo쬰 slobodno pristupiti. To je zato 코to kada pro코irenje pregleda캜a pozove **`fetch("https://gmail.com/")`** nije ograni캜eno od strane CORS-a.

## Zloupotreba `permissions` i `host_permissions`

### Tabovi

Osim toga, **`host_permissions`** tako캠e otklju캜avaju "napredne" [**tabs API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **funkcionalnosti**. Dozvoljavaju pro코irenju da pozove [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) i ne samo da dobije **listu korisni캜kih tabova pregleda캜a** ve캖 i sazna koje **web stranice (zna캜i adresu i naslov) su u캜itane**.

{% hint style="danger" %}
Nije samo to, slu코a캜i poput [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) tako캠e postaju mnogo korisniji. Bi캖e obave코teni svaki put kada se nova stranica u캜ita u tab.
{% endhint %}

### Pokretanje skripti sadr쬬ja <a href="#running-content-scripts" id="running-content-scripts"></a>

Skripte sadr쬬ja nisu nu쬹o stati캜ki napisane u manifestu pro코irenja. Sa dovoljnim **`host_permissions`**, **pro코irenja tako캠e mogu ih dinami캜ki u캜itati pozivanjem** [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **ili** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript).

Oba API-ja omogu캖avaju izvr코avanje ne samo datoteka sadr쬬nih u pro코irenjima kao skripte sadr쬬ja ve캖 i **proizvoljnog koda**. Prvi omogu캖ava prosle캠ivanje JavaScript koda kao string dok drugi o캜ekuje JavaScript funkciju koja je manje podlo쬹a ranjivostima ubacivanja. Ipak, oba API-ja 캖e napraviti haos ako se zloupotrebe.

{% hint style="danger" %}
Pored gore navedenih mogu캖nosti, skripte sadr쬬ja na primer mogu **interceptovati akreditive** dok se unose na web stranice. Jo코 jedan klasi캜an na캜in zloupotrebe je **ubacivanje reklama** na svaku web stranicu. Dodavanje **prevara poruka** za zloupotrebu kredibiliteta vesti na web stranicama je tako캠e mogu캖e. Na kraju, mogu **manipulisati bankarskim** web stranicama da preusmere nov캜ane transfere.
{% endhint %}

### Implicitne privilegije <a href="#implicit-privileges" id="implicit-privileges"></a>

Neki privilegiji pro코irenja **ne moraju biti eksplicitno deklarisani**. Jedan primer je [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): njegova osnovna funkcionalnost je dostupna bez ikakvih privilegija. Svako pro코irenje mo쬰 biti obave코teno kada otvorite i zatvorite tabove, jednostavno ne캖e znati sa kojom web stranicom se ti tabovi odnose.

Zvu캜i previ코e bezopasno? [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) je ne코to manje bezopasan. Mo쬰 se koristiti za **kreiranje novog taba**, su코tinski isto kao [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) koji mo쬰 biti pozvan od strane bilo koje web stranice. Ipak, dok je `window.open()` podlo쬬n **blokatoru iska캜u캖ih prozora, `tabs.create()` nije**.

{% hint style="danger" %}
Pro코irenje mo쬰 kreirati bilo koji broj tabova kad god 쬰li.
{% endhint %}

Ako pogledate mogu캖e parametre `tabs.create()`, primeti캖ete da njegove mogu캖nosti idu daleko iznad onoga 코to je `window.open()` dozvoljeno da kontroli코e. I dok Firefox ne dozvoljava kori코캖enje `data:` URI-ja sa ovim API-jem, Chrome nema takvu za코titu. **Kori코캖enje takvih URI-ja na najvi코em nivou je** [**zabranjeno zbog zloupotrebe za ribarenje**](https://bugzilla.mozilla.org/show\_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) je vrlo sli캜an `tabs.create()` ali 캖e **modifikovati postoje캖i tab**. Dakle, zlonamerno pro코irenje na primer mo쬰 proizvoljno u캜itati stranicu sa reklamama u jedan od va코ih tabova, i mo쬰 aktivirati odgovaraju캖i tab tako캠e.

### Kamera, geolokacija i prijatelji <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Verovatno znate da web stranice mogu zatra쬴ti posebne dozvole, na primer za pristup va코oj kameri (alati za video konferencije) ili geografskoj lokaciji (mapi). To su funkcionalnosti sa zna캜ajnim potencijalom za zloupotrebu, tako da korisnici svaki put moraju potvrditi da to i dalje 쬰le.

{% hint style="danger" %}
Nije tako sa pro코irenjima pregleda캜a. **Ako pro코irenje pregleda캜a** [**쬰li pristup va코oj kameri ili mikrofonu**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, potrebno je samo jednom zatra쬴ti dozvolu**
{% endhint %}

Tipi캜no, pro코irenje 캖e to u캜initi odmah nakon instalacije. Kada se ovaj dijalog prihvati, **pristup kameri je mogu캖 u bilo koje vreme**, 캜ak i ako korisnik nije interaktivan sa pro코irenjem u tom trenutku. Da, korisnik 캖e prihvatiti ovaj dijalog samo ako pro코irenje zaista treba pristup kameri. Ali nakon toga moraju da veruju pro코irenju da ne snima ni코ta tajno.

Sa pristupom [va코oj ta캜noj geografskoj lokaciji](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) ili [sadr쬬ju va코eg clipboard-a](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard\_API), davanje eksplicitne dozvole nije potrebno uop코te. **Pro코irenje jednostavno dodaje `geolocation` ili `clipboard` u** [**unos dozvola**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **svog manifesta**. Ovi pristupni privilegiji se zatim implicitno dodeljuju prilikom instalacije pro코irenja. Dakle, zlonamerno ili kompromitovano pro코irenje sa ovim privilegijama mo쬰 kreirati va코 profil kretanja ili pratiti va코 clipboard za kopirane lozinke bez da primetite bilo 코ta.

Dodavanje klju캜ne re캜i **`history`** u [unos dozvola](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) manifesta pro코irenja omogu캖ava **pristup** [**history API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). To omogu캖ava dobijanje celokupne istorije pregledanja korisnika odjednom, bez 캜ekanja da korisnik ponovo poseti ove web stranice.

Dozvola **`bookmarks`** ima sli캜an potencijal za zloupotrebu, ova dozvola omogu캖ava **캜itanje svih obele쬴va캜a putem** [**bookmarks API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks).

### Dozvola za skladi코tenje <a href="#the-storage-permission" id="the-storage-permission"></a>

Skladi코te pro코irenja je samo kolekcija klju캜-vrednost, vrlo sli캜no [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) koju bi mogla koristiti bilo koja web stranica. Dakle, ovde ne bi trebale biti sme코tene osetljive informacije.

Me캠utim, kompanije za ogla코avanje tako캠e mogu zloupotrebiti ovo skladi코te.

### Vi코e dozvola

Mo쬰te prona캖i [**kompletan spisak dozvola koje Chromium Browser Extension mo쬰 zatra쬴ti ovde**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) i [**kompletan spisak za Firefox pro코irenja ovde**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

## Prevencija <a href="#why-not-restrict-extension-privileges" id="why-not-restrict-extension-privileges"></a>

Politika Google-ovog razvojnog tima eksplicitno zabranjuje pro코irenjima da tra쬰 vi코e privilegija nego 코to je potrebno za njihovu funkcionalnost, efikasno umanjuju캖i prekomerne zahteve za dozvolama. Primer gde je pro코irenje pregleda캜a prekora캜ilo ovu granicu uklju캜ivao je njegovu distribuciju sa samim pregleda캜em umesto putem prodavnice dodataka.

Pregleda캜i bi mogli dalje ograni캜iti zloupotrebu privilegija pro코irenja. Na primer, Chrome-ovi [tabCapture](https://developer.chrome.com/docs/extensions/reference/tabCapture/) i [desktopCapture](https://developer.chrome.com/docs/extensions/reference/desktopCapture/) API-ji, kori코캖eni za snimanje ekrana, dizajnirani su da minimiziraju zloupotrebu. TabCapture API mo쬰 biti aktiviran samo putem direktnog korisni캜kog interakcije, kao 코to je klik na ikonu pro코irenja, dok desktopCapture zahteva potvrdu korisnika da bi prozor bio snimljen, spre캜avaju캖i tajno snimanje aktivnosti.

Me캠utim, poo코travanje mera bezbednosti 캜esto rezultira smanjenom fleksibilno코캖u i korisni캜kom prijateljsko코캖u pro코irenja. [activeTab dozvola](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#activetab\_permission) ilustruje ovu kompromis. Uvedena je kako bi se eliminisala potreba za pro코irenjima da tra쬰 privilegije doma캖ina 코irom interneta, omogu캖avaju캖i pro코irenjima pristup samo trenutnom tabu nakon eksplicitne aktivacije od strane korisnika. Ovaj model je efikasan za pro코irenja koja zahtevaju akcije inicirane od strane korisnika, ali nije dovoljan za ona koja zahtevaju automatske ili preventivne akcije, time kompromituju캖i prakti캜nost i trenutnu odzivnost.
## **Reference**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
