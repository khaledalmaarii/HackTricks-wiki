# BrowExt - dozvole i host\_dozvole

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

### **`dozvole`**

Dozvole se defini코u u **`manifest.json`** fajlu ekstenzije koriste캖i **`permissions`** svojstvo i omogu캖avaju pristup skoro svemu 캜emu browser mo쬰 pristupiti (kola캜i캖ima ili fizi캜kom skladi코tu):

Prethodni manifest deklari코e da ekstenzija zahteva `storage` dozvolu. Ovo zna캜i da mo쬰 koristiti [storage API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) za trajno skladi코tenje podataka. Za razliku od kola캜i캖a ili `localStorage` API-ja koji korisnicima daju neki nivo kontrole, **skladi코te ekstenzije se obi캜no mo쬰 o캜istiti samo deinstaliranjem ekstenzije**.

Ekstenzija 캖e zatra쬴ti dozvole navedene u svom **`manifest.json`** fajlu i nakon instaliranja ekstenzije, uvek mo쬰te **proveriti njene dozvole u va코em browser-u**, kao 코to je prikazano na ovoj slici:

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

Mo쬰te prona캖i [**kompletan spisak dozvola koje Chromium Browser Extension mo쬰 zahtevati ovde**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) i [**kompletan spisak za Firefox ekstenzije ovde**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

Opciono, ali mo캖no pode코avanje **`host_permissions`** ukazuje sa kojim hostovima 캖e ekstenzija mo캖i da interaguje putem API-ja kao 코to su [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) i [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs).

Slede캖e `host_permissions` omogu캖avaju prakti캜no svakom web-u:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Ovo su hostovi kojima browser ekstenzija mo쬰 slobodno pristupiti. To je zato 코to kada browser ekstenzija pozove **`fetch("https://gmail.com/")`**, nije ograni캜ena od strane CORS-a.

## Zloupotreba `permissions` i `host_permissions`

### Tabovi

Osim toga, **`host_permissions`** tako캠e otklju캜avaju "napredne" [**tabs API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **funkcionalnosti**. Omogu캖avaju ekstenziji da pozove [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) i ne samo da dobije **listu korisni캜kih tabova pregleda캜a**, ve캖 i da sazna koja **web stranica (코to zna캜i adresa i naslov) je u캜itana**.

{% hint style="danger" %}
Nije samo to, slu코a캜i poput [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) **postaju mnogo korisniji**. Oni 캖e biti obave코teni svaki put kada se nova stranica u캜ita u tab.
{% endhint %}

### Pokretanje skripti sadr쬬ja <a href="#running-content-scripts" id="running-content-scripts"></a>

Skripte sadr쬬ja nisu nu쬹o stati캜ki napisane u manifestu ekstenzije. Uz dovoljno **`host_permissions`**, ekstenzije ih tako캠e mogu dinami캜ki u캜itati pozivaju캖i [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **ili** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript).

Oba API-ja omogu캖avaju izvr코avanje ne samo datoteka koje se nalaze u ekstenzijama kao skripte sadr쬬ja, ve캖 i **proizvoljnog koda**. Prvi API omogu캖ava prosle캠ivanje JavaScript koda kao string, dok drugi o캜ekuje JavaScript funkciju koja je manje podlo쬹a ranjivostima ubacivanja. Ipak, oba API-ja 캖e napraviti haos ako se zloupotrebe.

{% hint style="danger" %}
Pored gore navedenih mogu캖nosti, skripte sadr쬬ja na primer mogu **presresti akreditive** dok se unose na web stranicama. Jo코 jedan klasi캜an na캜in zloupotrebe je **ubacivanje reklama** na svaku web stranicu. Mogu캖e je dodavanje **prevara** kako bi se zloupotrebila kredibilnost vesti na web stranicama. Na kraju, mogu **manipulisati bankovnim** web stranicama kako bi preusmerile nov캜ane transfere.
{% endhint %}

### Implicitne privilegije <a href="#implicit-privileges" id="implicit-privileges"></a>

Neki privilegije ekstenzija **ne moraju biti eksplicitno deklarisane**. Jedan primer je [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): njegova osnovna funkcionalnost je dostupna bez ikakvih privilegija. Svaka ekstenzija mo쬰 biti obave코tena kada otvorite i zatvorite tabove, samo ne캖e znati sa kojom veb stranicom se ti tabovi podudaraju.

Zvu캜i bezopasno? [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) je ne코to manje bezopasan. Mo쬰 se koristiti za **kreiranje novog taba**, su코tinski isto kao [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) koji mo쬰 biti pozvan od strane bilo koje web stranice. Me캠utim, dok je `window.open()` podlo쬬n **blokiranju iska캜u캖ih prozora, `tabs.create()` nije**.

{% hint style="danger" %}
Ekstenzija mo쬰 kreirati bilo koji broj tabova kad god 쬰li.
{% endhint %}

Ako pogledate mogu캖e parametre `tabs.create()`, primeti캖ete da njegove mogu캖nosti idu mnogo dalje od onoga 코to je `window.open()` dozvoljeno da kontroli코e. I dok Firefox ne dozvoljava kori코캖enje `data:` URI-ja sa ovim API-jem, Chrome nema takvu za코titu. **Upotreba takvih URI-ja na najvi코em nivou je** [**zabranjena zbog zloupotrebe u phishing napadima**](https://bugzilla.mozilla.org/show_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) je vrlo sli캜an `tabs.create()` ali 캖e **izmeniti postoje캖i tab**. Dakle, zlonamerna ekstenzija na primer mo쬰 proizvoljno u캜itati stranicu sa reklamama u jedan od va코ih tabova i mo쬰 aktivirati odgovaraju캖i tab.

### Kamera, geolokacija i drugi <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Verovatno znate da web stranice mogu zatra쬴ti posebne dozvole, na primer za pristup va코oj kameri (alati za video konferencije) ili geografskoj lokaciji (mape). To su funkcionalnosti sa zna캜ajnim potencijalom za zloupotrebu, pa korisnici svaki put moraju potvrditi da li i dalje 쬰le to.

{% hint style="danger" %}
To nije slu캜aj sa browser ekstenzijama. **Ako browser ekstenzija** [**쬰li pristup va코oj kameri ili mikrofonu**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, samo treba jednom zatra쬴ti dozvolu**
{% endhint %}

Obi캜no 캖e ekstenzija to u캜initi odmah nakon instalacije. Nakon 코to se ovaj dijalog prihvati, **pristup kameri je mogu캖 u bilo koje vreme**, 캜ak i ako korisnik trenutno ne koristi ekstenziju. Da, korisnik 캖e prihvatiti ovaj dijalog samo ako ekstenzija zaista treba pristup kameri. Ali nakon toga moraju verovati ekstenziji da ne캖e tajno snimati ni코ta.

Sa pristupom [va코oj ta캜noj geografskoj lokaciji](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) ili [sadr쬬ju va코eg clipboard-a](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API), eksplicitno odobrenje nije potrebno. **Ekstenzija jednostavno dodaje `geolocation` ili `clipboard` u** [**ulaz za dozvole**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **svog manifesta**. Ove privilegije pristupa se automatski dodeljuju prilikom instalacije ekstenzije. Dakle, zlonamerna ili kompromitovana ekstenzija sa ovim privilegijama mo쬰 kreirati va코 profil kretanja ili pratiti va코 clipboard za kopirane lozinke, a da vi to ne primetite.

Dodavanje klju캜ne re캜i **`history`** u [ulaz za dozvole](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) manifesta ekstenzije omogu캖ava **pristup** [**history API-ju**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). To omogu캖ava dobijanje celokupne istorije pregledanja korisnika odjednom, bez 캜ekanja da korisnik ponovo poseti te web stranice.

Dozvola **`bookmarks`** ima sli캜an potencijal za zloupotrebu, ova dozvola omogu캖ava **캜itanje svih obele쬴va캜a putem** [**bookmarks API-ja**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks).

### Dozvola
## **Reference**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju ogla코enu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
