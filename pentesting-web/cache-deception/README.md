# Cache Poisoning and Cache Deception

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Bize katÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi** **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_source=hacktricks\&utm\_medium=text\&utm\_campaign=ppc\&utm\_term=trickest\&utm\_content=cache-deception) kullanarak dÃ¼nyanÄ±n **en geliÅŸmiÅŸ** topluluk araÃ§larÄ±yla desteklenen **iÅŸ akÄ±ÅŸlarÄ±nÄ±** kolayca oluÅŸturun ve **otomatikleÅŸtirin**.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=cache-deception" %}

## Fark

> **Web cache poisoning ile web cache deception arasÄ±ndaki fark nedir?**
>
> * **Web cache poisoning**'de, saldÄ±rgan uygulamanÄ±n Ã¶nbelleÄŸe bazÄ± kÃ¶tÃ¼ niyetli iÃ§erikler depolamasÄ±nÄ± saÄŸlar ve bu iÃ§erik Ã¶nbellekten diÄŸer uygulama kullanÄ±cÄ±larÄ±na sunulur.
> * **Web cache deception**'da, saldÄ±rgan uygulamanÄ±n baÅŸka bir kullanÄ±cÄ±ya ait bazÄ± hassas iÃ§erikleri Ã¶nbelleÄŸe depolamasÄ±nÄ± saÄŸlar ve ardÄ±ndan bu iÃ§eriÄŸi Ã¶nbellekten alÄ±r.

## Cache Poisoning

Cache poisoning, istemci tarafÄ± Ã¶nbelleÄŸini manipÃ¼le ederek istemcilerin beklenmedik, kÄ±smi veya bir saldÄ±rganÄ±n kontrolÃ¼ altÄ±ndaki kaynaklarÄ± yÃ¼klemeye zorlamayÄ± amaÃ§lar. Etkisi, etkilenen sayfanÄ±n popÃ¼laritesine baÄŸlÄ±dÄ±r, Ã§Ã¼nkÃ¼ kirlenmiÅŸ yanÄ±t yalnÄ±zca Ã¶nbellek kirlenme sÃ¼resi boyunca sayfayÄ± ziyaret eden kullanÄ±cÄ±lara sunulur.

Cache poisoning saldÄ±rÄ±sÄ±nÄ±n gerÃ§ekleÅŸtirilmesi birkaÃ§ adÄ±m iÃ§erir:

1. **AnahtarsÄ±z Girdilerin Belirlenmesi**: Bunlar, bir isteÄŸin Ã¶nbelleÄŸe alÄ±nmasÄ± iÃ§in gerekli olmasa da, sunucunun dÃ¶ndÃ¼rdÃ¼ÄŸÃ¼ yanÄ±tÄ± deÄŸiÅŸtirebilen parametrelerdir. Bu girdilerin belirlenmesi, Ã¶nbelleÄŸi manipÃ¼le etmek iÃ§in sÃ¶mÃ¼rÃ¼lebileceÄŸinden kritik Ã¶neme sahiptir.
2. **AnahtarsÄ±z Girdilerin SÃ¶mÃ¼rÃ¼lmesi**: AnahtarsÄ±z girdiler belirlendikten sonra, bir sonraki adÄ±m bu parametreleri saldÄ±rgana fayda saÄŸlayacak ÅŸekilde sunucunun yanÄ±tÄ±nÄ± deÄŸiÅŸtirmek iÃ§in nasÄ±l kÃ¶tÃ¼ye kullanacaÄŸÄ±nÄ±zÄ± bulmaktÄ±r.
3. **KirlenmiÅŸ YanÄ±tÄ±n Ã–nbelleÄŸe AlÄ±ndÄ±ÄŸÄ±nÄ±n Garantilenmesi**: Son adÄ±m, manipÃ¼le edilmiÅŸ yanÄ±tÄ±n Ã¶nbelleÄŸe kaydedildiÄŸinden emin olmaktÄ±r. Bu ÅŸekilde, Ã¶nbellek kirlenmiÅŸken etkilenen sayfaya eriÅŸen herhangi bir kullanÄ±cÄ± kirlenmiÅŸ yanÄ±tÄ± alacaktÄ±r.

### KeÅŸif: HTTP baÅŸlÄ±klarÄ±nÄ± kontrol et

Genellikle, bir yanÄ±t **Ã¶nbelleÄŸe alÄ±ndÄ±ÄŸÄ±nda** bununla ilgili bir **baÅŸlÄ±k olacaktÄ±r**, hangi baÅŸlÄ±klara dikkat etmeniz gerektiÄŸini bu yazÄ±da kontrol edebilirsiniz: [**HTTP Cache baÅŸlÄ±klarÄ±**](../../network-services-pentesting/pentesting-web/special-http-headers.md#cache-headers).

### KeÅŸif: Ã–nbellek hata kodlarÄ±

YanÄ±tÄ±n bir Ã¶nbelleÄŸe kaydedildiÄŸini dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z, **kÃ¶tÃ¼ bir baÅŸlÄ±kla istek gÃ¶ndermeyi** deneyebilirsiniz, bu da **400 durum kodu** ile yanÄ±tlanmalÄ±dÄ±r. ArdÄ±ndan isteÄŸi normal bir ÅŸekilde eriÅŸmeyi deneyin ve eÄŸer **yanÄ±t 400 durum koduysa**, bunun zayÄ±f olduÄŸunu bilirsiniz (ve hatta bir DoS gerÃ§ekleÅŸtirebilirsiniz).

Daha fazla seÃ§enek bulabilirsiniz:

{% content-ref url="cache-poisoning-to-dos.md" %}
[cache-poisoning-to-dos.md](cache-poisoning-to-dos.md)
{% endcontent-ref %}

Ancak, **bazen bu tÃ¼r durum kodlarÄ±nÄ±n Ã¶nbelleÄŸe alÄ±nmadÄ±ÄŸÄ±nÄ±** unutmayÄ±n, bu nedenle bu test gÃ¼venilir olmayabilir.

### KeÅŸif: AnahtarsÄ±z girdileri tanÄ±mlayÄ±n ve deÄŸerlendirin

[**Param Miner**](https://portswigger.net/bappstore/17d2949a985c4b7ca092728dba871943) kullanarak **sayfanÄ±n yanÄ±tÄ±nÄ± deÄŸiÅŸtirebilecek** parametreleri ve baÅŸlÄ±klarÄ± **kaba kuvvetle denemeyi** deneyebilirsiniz. Ã–rneÄŸin, bir sayfa `X-Forwarded-For` baÅŸlÄ±ÄŸÄ±nÄ± kullanarak istemcinin buradan script yÃ¼klemesini belirtiyor olabilir:
```markup
<script type="text/javascript" src="//<X-Forwarded-For_value>/resources/js/tracking.js"></script>
```
### Arka uÃ§ sunucudan zararlÄ± bir yanÄ±t elde etme

Parametre/baÅŸlÄ±k belirlendikten sonra, **nasÄ±l** **temizlendiÄŸini** ve **nerede** **yansÄ±tÄ±ldÄ±ÄŸÄ±nÄ±** veya baÅŸlÄ±ktan gelen yanÄ±tÄ± nasÄ±l etkilediÄŸini kontrol edin. Bunu herhangi bir ÅŸekilde kÃ¶tÃ¼ye kullanabilir misiniz (XSS gerÃ§ekleÅŸtirmek veya sizin kontrolÃ¼nÃ¼zde bir JS kodu yÃ¼klemek? DoS gerÃ§ekleÅŸtirmek?...)

### YanÄ±tÄ± Ã¶nbelleÄŸe al

KÃ¶tÃ¼ye kullanÄ±labilecek **sayfayÄ±** **belirledikten** sonra, hangi **parametre**/**baÅŸlÄ±k** kullanÄ±lacaÄŸÄ±nÄ± ve **nasÄ±l** **kÃ¶tÃ¼ye kullanÄ±lacaÄŸÄ±nÄ±** belirlemeniz gerekir, sayfayÄ± Ã¶nbelleÄŸe almanÄ±z gerekir. Ã–nbelleÄŸe almak istediÄŸiniz kaynaÄŸa baÄŸlÄ± olarak bu biraz zaman alabilir, birkaÃ§ saniye boyunca denemek zorunda kalabilirsiniz.

YanÄ±t iÃ§indeki **`X-Cache`** baÅŸlÄ±ÄŸÄ±, isteÄŸin Ã¶nbelleÄŸe alÄ±nmadÄ±ÄŸÄ±nda **`miss`** deÄŸerine ve Ã¶nbelleÄŸe alÄ±ndÄ±ÄŸÄ±nda **`hit`** deÄŸerine sahip olabileceÄŸinden Ã§ok faydalÄ± olabilir.\
**`Cache-Control`** baÅŸlÄ±ÄŸÄ± da bir kaynaÄŸÄ±n Ã¶nbelleÄŸe alÄ±nÄ±p alÄ±nmadÄ±ÄŸÄ±nÄ± ve kaynaÄŸÄ±n bir sonraki ne zaman Ã¶nbelleÄŸe alÄ±nacaÄŸÄ±nÄ± bilmek iÃ§in ilginÃ§tir: `Cache-Control: public, max-age=1800`

Bir diÄŸer ilginÃ§ baÅŸlÄ±k **`Vary`**. Bu baÅŸlÄ±k, genellikle **Ã¶nbellek anahtarÄ±** olarak **iÅŸlem gÃ¶ren ek baÅŸlÄ±klarÄ±** **belirtmek iÃ§in** kullanÄ±lÄ±r, normalde anahtarsÄ±z olsalar bile. Bu nedenle, hedeflediÄŸi kurbanÄ±n `User-Agent`'Ä±nÄ± bilen bir kullanÄ±cÄ±, o belirli `User-Agent`'Ä± kullanan kullanÄ±cÄ±lar iÃ§in Ã¶nbelleÄŸi zehirleyebilir.

Ã–nbellek ile ilgili bir baÅŸlÄ±k daha **`Age`**. Bu, nesnenin proxy Ã¶nbelleÄŸinde kaÃ§ saniye kaldÄ±ÄŸÄ±nÄ± tanÄ±mlar.

Bir isteÄŸi Ã¶nbelleÄŸe alÄ±rken, kullandÄ±ÄŸÄ±nÄ±z baÅŸlÄ±klarla **dikkatli olun** Ã§Ã¼nkÃ¼ bazÄ±larÄ± **beklenmedik ÅŸekilde** **anahtarlÄ±** olarak **kullanÄ±labilir** ve **kurbanÄ±n o aynÄ± baÅŸlÄ±ÄŸÄ± kullanmasÄ± gerekecektir**. Her zaman **farklÄ± tarayÄ±cÄ±larla** bir Cache Poisoning'i **test edin** ve Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol edin.

## SÃ¶mÃ¼rÃ¼ Ã–rnekleri

### En kolay Ã¶rnek

`X-Forwarded-For` gibi bir baÅŸlÄ±k, yanÄ±t iÃ§inde temizlenmeden yansÄ±tÄ±lÄ±yor.\
Temel bir XSS yÃ¼kÃ¼ gÃ¶nderebilir ve Ã¶nbelleÄŸi zehirleyerek sayfaya eriÅŸen herkesin XSS olmasÄ±nÄ± saÄŸlayabilirsiniz:
```markup
GET /en?region=uk HTTP/1.1
Host: innocent-website.com
X-Forwarded-Host: a."><script>alert(1)</script>"
```
_Note that this will poison a request to `/en?region=uk` not to `/en`_

### Cache poisoning to DoS

{% content-ref url="cache-poisoning-to-dos.md" %}
[cache-poisoning-to-dos.md](cache-poisoning-to-dos.md)
{% endcontent-ref %}

### Web cache poisoning kullanarak Ã§erez iÅŸleme zafiyetlerini istismar etme

Ã‡erezler, bir sayfanÄ±n yanÄ±tÄ±nda da yansÄ±tÄ±labilir. EÄŸer bunu bir XSS oluÅŸturmak iÃ§in kÃ¶tÃ¼ye kullanabilirseniz, kÃ¶tÃ¼ niyetli Ã¶nbellek yanÄ±tÄ±nÄ± yÃ¼kleyen birkaÃ§ istemcide XSS'i istismar edebilirsiniz.
```markup
GET / HTTP/1.1
Host: vulnerable.com
Cookie: session=VftzO7ZtiBj5zNLRAuFpXpSQLjS4lBmU; fehost=asd"%2balert(1)%2b"
```
Not edin ki, eÄŸer zayÄ±f cookie kullanÄ±cÄ±lar tarafÄ±ndan Ã§ok kullanÄ±lÄ±yorsa, dÃ¼zenli istekler Ã¶nbelleÄŸi temizleyecektir.

### AyÄ±rÄ±cÄ±lar, normalizasyon ve noktalar ile tutarsÄ±zlÄ±klar oluÅŸturma <a href="#using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities" id="using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities"></a>

Kontrol et:

{% content-ref url="cache-poisoning-via-url-discrepancies.md" %}
[cache-poisoning-via-url-discrepancies.md](cache-poisoning-via-url-discrepancies.md)
{% endcontent-ref %}

### API anahtarÄ±nÄ± Ã§almak iÃ§in yol geÃ§iÅŸi ile Ã¶nbellek zehirleme <a href="#using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities" id="using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities"></a>

[**Bu yazÄ±**](https://nokline.github.io/bugbounty/2024/02/04/ChatGPT-ATO.html) `https://chat.openai.com/share/%2F..%2Fapi/auth/session?cachebuster=123` gibi bir URL ile OpenAI API anahtarÄ±nÄ±n nasÄ±l Ã§alÄ±ndÄ±ÄŸÄ±nÄ± aÃ§Ä±klÄ±yor Ã§Ã¼nkÃ¼ `/share/*` ile eÅŸleÅŸen her ÅŸey, Cloudflare URL'yi normalleÅŸtirmeden Ã¶nbelleÄŸe alÄ±nacak, bu da isteÄŸin web sunucusuna ulaÅŸtÄ±ÄŸÄ±nda yapÄ±lmÄ±ÅŸtÄ±r.

Bu, daha iyi bir ÅŸekilde de aÃ§Ä±klanmÄ±ÅŸtÄ±r:

{% content-ref url="cache-poisoning-via-url-discrepancies.md" %}
[cache-poisoning-via-url-discrepancies.md](cache-poisoning-via-url-discrepancies.md)
{% endcontent-ref %}

### Web Ã¶nbellek zehirleme zayÄ±flÄ±klarÄ±nÄ± istismar etmek iÃ§in birden fazla baÅŸlÄ±k kullanma <a href="#using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities" id="using-multiple-headers-to-exploit-web-cache-poisoning-vulnerabilities"></a>

Bazen bir Ã¶nbelleÄŸi istismar edebilmek iÃ§in **birden fazla anahtarsÄ±z girdi** istismar etmeniz gerekecektir. Ã–rneÄŸin, `X-Forwarded-Host` baÅŸlÄ±ÄŸÄ±nÄ± sizin kontrolÃ¼nÃ¼zdeki bir alan adÄ±na ve `X-Forwarded-Scheme` baÅŸlÄ±ÄŸÄ±nÄ± `http` olarak ayarlarsanÄ±z bir **AÃ§Ä±k yÃ¶nlendirme** bulabilirsiniz. **EÄŸer** **sunucu** tÃ¼m **HTTP** isteklerini **HTTPS**'ye **yÃ¶nlendiriyorsa** ve `X-Forwarded-Scheme` baÅŸlÄ±ÄŸÄ±nÄ± yÃ¶nlendirme iÃ§in alan adÄ± olarak kullanÄ±yorsa, yÃ¶nlendirme ile sayfanÄ±n nereye iÅŸaret ettiÄŸini kontrol edebilirsiniz.
```markup
GET /resources/js/tracking.js HTTP/1.1
Host: acc11fe01f16f89c80556c2b0056002e.web-security-academy.net
X-Forwarded-Host: ac8e1f8f1fb1f8cb80586c1d01d500d3.web-security-academy.net/
X-Forwarded-Scheme: http
```
### SÄ±nÄ±rlÄ± `Vary` baÅŸlÄ±ÄŸÄ± ile istismar

EÄŸer **`X-Host`** baÅŸlÄ±ÄŸÄ±nÄ±n **JS kaynaÄŸÄ±nÄ± yÃ¼klemek iÃ§in alan adÄ±** olarak kullanÄ±ldÄ±ÄŸÄ±nÄ± ancak yanÄ±tÄ±n **`Vary`** baÅŸlÄ±ÄŸÄ±nÄ±n **`User-Agent`** belirttiÄŸini bulduysanÄ±z, o zaman kurbanÄ±n User-Agent'Ä±nÄ± dÄ±ÅŸarÄ± sÄ±zdÄ±rmanÄ±n ve bu kullanÄ±cÄ± ajanÄ±nÄ± kullanarak Ã¶nbelleÄŸi zehirlemenin bir yolunu bulmalÄ±sÄ±nÄ±z:
```markup
GET / HTTP/1.1
Host: vulnerbale.net
User-Agent: THE SPECIAL USER-AGENT OF THE VICTIM
X-Host: attacker.com
```
### Fat Get

URL'deki ve gÃ¶vdedeki isteÄŸi iÃ§eren bir GET isteÄŸi gÃ¶nderin. EÄŸer web sunucusu gÃ¶vdedekini kullanÄ±yorsa ama Ã¶nbellek sunucusu URL'dekini Ã¶nbelleÄŸe alÄ±yorsa, o URL'ye eriÅŸen herkes aslÄ±nda gÃ¶vdedeki parametreyi kullanacaktÄ±r. James Kettle'Ä±n Github web sitesinde bulduÄŸu zafiyet gibi:
```
GET /contact/report-abuse?report=albinowax HTTP/1.1
Host: github.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 22

report=innocent-victim
```
There it a portswigger lab about this: [https://portswigger.net/web-security/web-cache-poisoning/exploiting-implementation-flaws/lab-web-cache-poisoning-fat-get](https://portswigger.net/web-security/web-cache-poisoning/exploiting-implementation-flaws/lab-web-cache-poisoning-fat-get)

### Parametre Gizleme

Ã–rneÄŸin, ruby sunucularÄ±nda **parametreleri** **`&`** yerine **`;`** karakteri kullanarak ayÄ±rmak mÃ¼mkÃ¼ndÃ¼r. Bu, anahtarsÄ±z parametre deÄŸerlerini anahtarlÄ± olanlarÄ±n iÃ§ine yerleÅŸtirmek ve bunlarÄ± kÃ¶tÃ¼ye kullanmak iÃ§in kullanÄ±labilir.

Portswigger lab: [https://portswigger.net/web-security/web-cache-poisoning/exploiting-implementation-flaws/lab-web-cache-poisoning-param-cloaking](https://portswigger.net/web-security/web-cache-poisoning/exploiting-implementation-flaws/lab-web-cache-poisoning-param-cloaking)

### HTTP Ä°stemci KaÃ§Ä±rma ile HTTP Cache Zehirlemesini KÃ¶tÃ¼ye Kullanma

[HTTP Ä°stemci KaÃ§Ä±rma ile Cache Zehirleme saldÄ±rÄ±larÄ± nasÄ±l gerÃ§ekleÅŸtirilir](../http-request-smuggling/#using-http-request-smuggling-to-perform-web-cache-poisoning) hakkÄ±nda burada bilgi edinin.

### Web Cache Zehirlemesi iÃ§in Otomatik Test

[Web Cache Vulnerability Scanner](https://github.com/Hackmanit/Web-Cache-Vulnerability-Scanner), web cache zehirlemesi iÃ§in otomatik test yapmak Ã¼zere kullanÄ±labilir. BirÃ§ok farklÄ± tekniÄŸi destekler ve yÃ¼ksek derecede Ã¶zelleÅŸtirilebilir.

Ã–rnek kullanÄ±m: `wcvs -u example.com`

## AÃ§Ä±k Ã–rnekler

### Apache Traffic Server ([CVE-2021-27577](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-27577))

ATS, URL iÃ§indeki parÃ§ayÄ± kesmeden iletti ve yalnÄ±zca ana bilgisayar, yol ve sorgu kullanarak Ã¶nbellek anahtarÄ±nÄ± oluÅŸturdu (parÃ§ayÄ± gÃ¶z ardÄ± ederek). Bu nedenle, `/#/../?r=javascript:alert(1)` isteÄŸi arka uca `/#/../?r=javascript:alert(1)` olarak gÃ¶nderildi ve Ã¶nbellek anahtarÄ±nda yÃ¼k bulunmadÄ±, yalnÄ±zca ana bilgisayar, yol ve sorgu vardÄ±.

### GitHub CP-DoS

Ä°Ã§erik tÃ¼rÃ¼ baÅŸlÄ±ÄŸÄ±nda kÃ¶tÃ¼ bir deÄŸer gÃ¶ndermek, 405 Ã¶nbelleklenmiÅŸ yanÄ±tÄ± tetikledi. Ã–nbellek anahtarÄ± Ã§erezi iÃ§eriyordu, bu nedenle yalnÄ±zca yetkisiz kullanÄ±cÄ±larÄ± hedef almak mÃ¼mkÃ¼ndÃ¼.

### GitLab + GCP CP-DoS

GitLab, statik iÃ§eriÄŸi depolamak iÃ§in GCP bucket'larÄ±nÄ± kullanÄ±r. **GCP Buckets**, **`x-http-method-override`** baÅŸlÄ±ÄŸÄ±nÄ± destekler. Bu nedenle, `x-http-method-override: HEAD` baÅŸlÄ±ÄŸÄ±nÄ± gÃ¶ndermek ve Ã¶nbelleÄŸi boÅŸ bir yanÄ±t gÃ¶vdesi dÃ¶ndÃ¼rmesi iÃ§in zehirlemek mÃ¼mkÃ¼ndÃ¼. AyrÄ±ca `PURGE` yÃ¶ntemini de destekleyebilir.

### Rack Middleware (Ruby on Rails)

Ruby on Rails uygulamalarÄ±nda, Rack middleware sÄ±klÄ±kla kullanÄ±lmaktadÄ±r. Rack kodunun amacÄ±, **`x-forwarded-scheme`** baÅŸlÄ±ÄŸÄ±nÄ±n deÄŸerini almak ve bunu isteÄŸin ÅŸemasÄ± olarak ayarlamaktÄ±r. `x-forwarded-scheme: http` baÅŸlÄ±ÄŸÄ± gÃ¶nderildiÄŸinde, aynÄ± konuma 301 yÃ¶nlendirmesi gerÃ§ekleÅŸir ve bu durum, o kaynaÄŸa bir Hizmet Reddi (DoS) oluÅŸturabilir. AyrÄ±ca, uygulama `X-forwarded-host` baÅŸlÄ±ÄŸÄ±nÄ± tanÄ±yabilir ve kullanÄ±cÄ±larÄ± belirtilen ana bilgisayara yÃ¶nlendirebilir. Bu davranÄ±ÅŸ, bir saldÄ±rganÄ±n sunucusundan JavaScript dosyalarÄ±nÄ±n yÃ¼klenmesine yol aÃ§arak gÃ¼venlik riski oluÅŸturabilir.

### 403 ve Depolama Bucket'larÄ±

Cloudflare daha Ã¶nce 403 yanÄ±tlarÄ±nÄ± Ã¶nbelleÄŸe alÄ±yordu. YanlÄ±ÅŸ Yetkilendirme baÅŸlÄ±klarÄ± ile S3 veya Azure Storage Blobs'a eriÅŸmeye Ã§alÄ±ÅŸmak, Ã¶nbelleÄŸe alÄ±nan bir 403 yanÄ±tÄ± ile sonuÃ§lanÄ±yordu. Cloudflare 403 yanÄ±tlarÄ±nÄ± Ã¶nbelleÄŸe almayÄ± durdurmuÅŸ olsa da, bu davranÄ±ÅŸ diÄŸer proxy hizmetlerinde hala mevcut olabilir.

### AnahtarlÄ± Parametreleri Enjekte Etme

Ã–nbellekler genellikle Ã¶nbellek anahtarÄ±nda belirli GET parametrelerini iÃ§erir. Ã–rneÄŸin, Fastly'nin Varnish'i isteklerde `size` parametresini Ã¶nbelleÄŸe alÄ±yordu. Ancak, parametrenin URL kodlamalÄ± bir versiyonu (Ã¶rneÄŸin, `siz%65`) hatalÄ± bir deÄŸerle gÃ¶nderildiÄŸinde, Ã¶nbellek anahtarÄ± doÄŸru `size` parametresi kullanÄ±larak oluÅŸturuluyordu. Yine de, arka uÃ§ URL kodlamalÄ± parametredeki deÄŸeri iÅŸliyordu. Ä°kinci `size` parametresinin URL kodlamasÄ±, Ã¶nbellek tarafÄ±ndan atlanmasÄ±na ancak arka uÃ§ tarafÄ±ndan kullanÄ±lmasÄ±na yol aÃ§tÄ±. Bu parametreye 0 deÄŸeri atamak, Ã¶nbelleÄŸe alÄ±nabilir bir 400 Bad Request hatasÄ±na neden oldu.

### KullanÄ±cÄ± AracÄ± KurallarÄ±

BazÄ± geliÅŸtiriciler, sunucu yÃ¼kÃ¼nÃ¼ yÃ¶netmek iÃ§in FFUF veya Nuclei gibi yÃ¼ksek trafikli araÃ§larÄ±n kullanÄ±cÄ± ajanlarÄ±yla eÅŸleÅŸen istekleri engeller. Ironik bir ÅŸekilde, bu yaklaÅŸÄ±m Ã¶nbellek zehirlenmesi ve DoS gibi gÃ¼venlik aÃ§Ä±klarÄ± oluÅŸturabilir.

### GeÃ§ersiz BaÅŸlÄ±k AlanlarÄ±

[RFC7230](https://datatracker.ietf.mrg/doc/html/rfc7230), baÅŸlÄ±k adlarÄ±nda kabul edilebilir karakterleri belirtir. Belirtilen **tchar** aralÄ±ÄŸÄ±nÄ±n dÄ±ÅŸÄ±ndaki karakterleri iÃ§eren baÅŸlÄ±klarÄ±n, ideal olarak 400 Bad Request yanÄ±tÄ± tetiklemesi gerekir. Pratikte, sunucular her zaman bu standarda uymamaktadÄ±r. Ã–nemli bir Ã¶rnek, geÃ§ersiz karakterler iÃ§eren baÅŸlÄ±klarÄ± ileten ve `cache-control` baÅŸlÄ±ÄŸÄ± mevcut olmadÄ±kÃ§a herhangi bir 400 hatasÄ±nÄ± Ã¶nbelleÄŸe alan Akamai'dÄ±r. GeÃ§ersiz bir karakter iÃ§eren bir baÅŸlÄ±k gÃ¶nderildiÄŸinde, Ã¶rneÄŸin `\`, Ã¶nbelleÄŸe alÄ±nabilir bir 400 Bad Request hatasÄ± ile sonuÃ§lanan bir sÃ¶mÃ¼rÃ¼lebilir desen tespit edilmiÅŸtir.

### Yeni BaÅŸlÄ±klar Bulma

[https://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6](https://gist.github.com/iustin24/92a5ba76ee436c85716f003dda8eecc6)

## Ã–nbellek AldatmacasÄ±

Ã–nbellek AldatmacasÄ±'nÄ±n amacÄ±, istemcilerin **Ã¶nbellek tarafÄ±ndan kaydedilecek kaynaklarÄ± hassas bilgileriyle yÃ¼klemelerini saÄŸlamaktÄ±r**.

Ã–ncelikle, **.css**, **.js**, **.png** gibi **uzantÄ±larÄ±n** genellikle **Ã¶nbelleÄŸe** **kaydedilmek** Ã¼zere **yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±nÄ±** unutmayÄ±n. Bu nedenle, `www.example.com/profile.php/nonexistent.js` adresine eriÅŸirseniz, Ã¶nbellek muhtemelen yanÄ±tÄ± kaydedecektir Ã§Ã¼nkÃ¼ `.js` **uzantÄ±sÄ±nÄ±** gÃ¶rmektedir. Ancak, eÄŸer **uygulama**, _www.example.com/profile.php_ iÃ§inde saklanan **hassas** kullanÄ±cÄ± iÃ§erikleriyle **tekrar oynuyorsa**, diÄŸer kullanÄ±cÄ±lardan bu iÃ§erikleri **Ã§almÄ±ÅŸ** olursunuz.

Test edilecek diÄŸer ÅŸeyler:

* _www.example.com/profile.php/.js_
* _www.example.com/profile.php/.css_
* _www.example.com/profile.php/test.js_
* _www.example.com/profile.php/../test.js_
* _www.example.com/profile.php/%2e%2e/test.js_
* _Daha az bilinen uzantÄ±lar kullanÄ±n, Ã¶rneÄŸin_ `.avif`

Bu yazÄ±da Ã§ok net bir Ã¶rnek bulunabilir: [https://hackerone.com/reports/593712](https://hackerone.com/reports/593712).\
Ã–rnekte, _http://www.example.com/home.php/non-existent.css_ gibi var olmayan bir sayfayÄ± yÃ¼klediÄŸinizde, _http://www.example.com/home.php_ (**kullanÄ±cÄ±nÄ±n hassas bilgileriyle**) iÃ§eriÄŸin dÃ¶neceÄŸi ve Ã¶nbellek sunucusunun sonucu kaydedeceÄŸi aÃ§Ä±klanmaktadÄ±r.\
Daha sonra, **saldÄ±rgan**, kendi tarayÄ±cÄ±sÄ±nda _http://www.example.com/home.php/non-existent.css_ adresine eriÅŸebilir ve daha Ã¶nce eriÅŸen kullanÄ±cÄ±larÄ±n **gizli bilgilerini** gÃ¶zlemleyebilir.

**Ã–nbellek proxy'sinin**, dosyalarÄ±n **uzantÄ±sÄ±na** (_css_) gÃ¶re **Ã¶nbelleÄŸe** **alÄ±nacak** ÅŸekilde **yapÄ±landÄ±rÄ±lmasÄ±** gerektiÄŸini unutmayÄ±n ve iÃ§erik tÃ¼rÃ¼ne gÃ¶re deÄŸil. Ã–rneÄŸin, _http://www.example.com/home.php/non-existent.css_ adresinin `text/html` iÃ§erik tÃ¼rÃ¼ yerine `text/css` mime tÃ¼rÃ¼ne sahip olmasÄ± beklenmektedir (bu, bir _.css_ dosyasÄ± iÃ§in beklenendir).

[HTTP Ä°stemci KaÃ§Ä±rma ile Cache AldatmacasÄ± saldÄ±rÄ±larÄ± nasÄ±l gerÃ§ekleÅŸtirilir](../http-request-smuggling/#using-http-request-smuggling-to-perform-web-cache-deception) hakkÄ±nda burada bilgi edinin.

## Otomatik AraÃ§lar

* [**toxicache**](https://github.com/xhzeem/toxicache): Bir URL listesinde web cache zehirlenmesi aÃ§Ä±klarÄ±nÄ± bulmak ve birden fazla enjekte etme tekniÄŸini test etmek iÃ§in Golang tarayÄ±cÄ±.

## Referanslar

* [https://portswigger.net/web-security/web-cache-poisoning](https://portswigger.net/web-security/web-cache-poisoning)
* [https://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities](https://portswigger.net/web-security/web-cache-poisoning/exploiting#using-web-cache-poisoning-to-exploit-cookie-handling-vulnerabilities)
* [https://hackerone.com/reports/593712](https://hackerone.com/reports/593712)
* [https://youst.in/posts/cache-poisoning-at-scale/](https://youst.in/posts/cache-poisoning-at-scale/)
* [https://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9](https://bxmbn.medium.com/how-i-test-for-web-cache-vulnerabilities-tips-and-tricks-9b138da08ff9)
* [https://www.linkedin.com/pulse/how-i-hacked-all-zendesk-sites-265000-site-one-line-abdalhfaz/](https://www.linkedin.com/pulse/how-i-hacked-all-zendesk-sites-265000-site-one-line-abdalhfaz/)

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
DÃ¼nyanÄ±n **en geliÅŸmiÅŸ** topluluk araÃ§larÄ±yla desteklenen **iÅŸ akÄ±ÅŸlarÄ±nÄ±** kolayca oluÅŸturmak ve **otomatikleÅŸtirmek** iÃ§in [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=cache-deception) kullanÄ±n.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=cache-deception" %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **HackTricks** ve **HackTricks Cloud** github reposuna PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}
