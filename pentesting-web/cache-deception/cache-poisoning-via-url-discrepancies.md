# URL farklÄ±lÄ±klarÄ± ile Cache Zehirleme

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

Bu, **cache proxy'leri ve web sunucularÄ± arasÄ±ndaki farklÄ±lÄ±klardan yararlanarak cache zehirleme saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmek iÃ§in** Ã¶nerilen tekniklerin bir Ã¶zetidir [https://portswigger.net/research/gotta-cache-em-all](https://portswigger.net/research/gotta-cache-em-all).

{% hint style="info" %}
Bu saldÄ±rÄ±nÄ±n amacÄ±, **cache sunucusunu statik bir kaynaÄŸÄ±n yÃ¼klendiÄŸini dÃ¼ÅŸÃ¼ndÃ¼rmek** ve bÃ¶ylece onu Ã¶nbelleÄŸe alÄ±rken, cache sunucusunun Ã¶nbellek anahtarÄ± olarak yolun bir kÄ±smÄ±nÄ± saklamasÄ±dÄ±r; ancak web sunucusu baÅŸka bir yolu Ã§Ã¶zÃ¼mleyerek yanÄ±t verir. Web sunucusu, dinamik bir sayfa yÃ¼kleyecek gerÃ§ek yolu Ã§Ã¶zecektir (bu, kullanÄ±cÄ± hakkÄ±nda hassas bilgiler, XSS gibi kÃ¶tÃ¼ niyetli bir yÃ¼k veya Ã¶rneÄŸin saldÄ±rganÄ±n web sitesinden bir JS dosyasÄ± yÃ¼klemek iÃ§in yÃ¶nlendirme iÃ§erebilir).
{% endhint %}

## AyÄ±rÄ±cÄ±lar

**URL ayÄ±rÄ±cÄ±larÄ±**, Ã§erÃ§eve ve sunucuya gÃ¶re deÄŸiÅŸir ve isteklerin nasÄ±l yÃ¶nlendirildiÄŸini ve yanÄ±tlarÄ±n nasÄ±l iÅŸlendiÄŸini etkiler. BazÄ± yaygÄ±n kÃ¶ken ayÄ±rÄ±cÄ±larÄ± ÅŸunlardÄ±r:

* **NoktalÄ± virgÃ¼l**: Spring'de matris deÄŸiÅŸkenleri iÃ§in kullanÄ±lÄ±r (Ã¶rneÄŸin, `/hello;var=a/world;var1=b;var2=c` â†’ `/hello/world`).
* **Nokta**: Ruby on Rails'de yanÄ±t formatÄ±nÄ± belirtir (Ã¶rneÄŸin, `/MyAccount.css` â†’ `/MyAccount`).
* **Null Byte**: OpenLiteSpeed'de yollarÄ± keser (Ã¶rneÄŸin, `/MyAccount%00aaa` â†’ `/MyAccount`).
* **Yeni satÄ±r baytÄ±**: Nginx'de URL bileÅŸenlerini ayÄ±rÄ±r (Ã¶rneÄŸin, `/users/MyAccount%0aaaa` â†’ `/account/MyAccount`).

Bu sÃ¼reÃ§ten sonra diÄŸer Ã¶zel ayÄ±rÄ±cÄ±lar bulunabilir:

* **AdÄ±m 1**: Ã–nbelleÄŸe alÄ±namayan istekleri tanÄ±mlayÄ±n ve bunlarÄ± potansiyel ayÄ±rÄ±cÄ±larÄ±n nasÄ±l iÅŸlendiÄŸini izlemek iÃ§in kullanÄ±n.
* **AdÄ±m 2**: Yollara rastgele ekler ekleyin ve bir karakterin ayÄ±rÄ±cÄ± olarak iÅŸlev gÃ¶rÃ¼p gÃ¶rmediÄŸini belirlemek iÃ§in sunucunun yanÄ±tÄ±nÄ± karÅŸÄ±laÅŸtÄ±rÄ±n.
* **AdÄ±m 3**: YanÄ±tÄ±n deÄŸiÅŸip deÄŸiÅŸmediÄŸini gÃ¶rmek iÃ§in rastgele ekin Ã¶nÃ¼ne potansiyel ayÄ±rÄ±cÄ±lar ekleyin; bu, ayÄ±rÄ±cÄ± kullanÄ±mÄ±nÄ± gÃ¶sterir.

## Normalizasyon & Kodlamalar

* **AmaÃ§**: Hem cache hem de kÃ¶ken sunucularÄ±ndaki URL ayrÄ±ÅŸtÄ±rÄ±cÄ±larÄ±, uÃ§ nokta eÅŸlemesi ve Ã¶nbellek anahtarlarÄ± iÃ§in yollarÄ± Ã§Ä±karmak Ã¼zere URL'leri normalize eder.
* **SÃ¼reÃ§**: Yol ayÄ±rÄ±cÄ±larÄ±nÄ± tanÄ±mlar, karakterleri Ã§Ã¶zerek ve nokta segmentlerini kaldÄ±rarak yolu Ã§Ä±karÄ±r ve normalize eder.

### **Kodlamalar**

FarklÄ± HTTP sunucularÄ± ve proxy'leri, Nginx, Node ve CloudFront gibi, ayÄ±rÄ±cÄ±larÄ± farklÄ± ÅŸekilde Ã§Ã¶zer, bu da CDNs ve kÃ¶ken sunucularÄ± arasÄ±nda tutarsÄ±zlÄ±klara yol aÃ§ar. Ã–rneÄŸin, web sunucusu bu dÃ¶nÃ¼ÅŸÃ¼mÃ¼ gerÃ§ekleÅŸtirirse `/myAccount%3Fparam` â†’ `/myAccount?param` ancak cache sunucusu anahtar olarak yolu `/myAccount%3Fparam` olarak saklarsa, bir tutarsÄ±zlÄ±k vardÄ±r.&#x20;

Bu tutarsÄ±zlÄ±klarÄ± kontrol etmenin bir yolu, yolu herhangi bir kodlama olmadan yÃ¼kledikten sonra farklÄ± karakterleri URL kodlayarak istekler gÃ¶ndermek ve kodlanmÄ±ÅŸ yol yanÄ±tÄ±nÄ±n Ã¶nbellek yanÄ±tÄ±ndan gelip gelmediÄŸini kontrol etmektir.

### Nokta segmenti

NoktalarÄ±n dahil olduÄŸu yol normalizasyonu, cache zehirleme saldÄ±rÄ±larÄ± iÃ§in de oldukÃ§a ilginÃ§tir. Ã–rneÄŸin, `/static/../home/index` veya `/aaa..\home/index`, bazÄ± cache sunucularÄ± bu yollarÄ± kendileri anahtar olarak Ã¶nbelleÄŸe alÄ±rken, diÄŸerleri yolu Ã§Ã¶zebilir ve `/home/index`'i Ã¶nbellek anahtarÄ± olarak kullanabilir.\
Daha Ã¶nce olduÄŸu gibi, bu tÃ¼r istekler gÃ¶ndermek ve yanÄ±tÄ±n Ã¶nbellekten toplanÄ±p toplanmadÄ±ÄŸÄ±nÄ± kontrol etmek, `/home/index`'e verilen yanÄ±tÄ±n, bu yollar istendiÄŸinde gÃ¶nderilen yanÄ±t olup olmadÄ±ÄŸÄ±nÄ± belirlemeye yardÄ±mcÄ± olur.

## Statik Kaynaklar

BirÃ§ok cache sunucusu, yanÄ±tÄ± statik olarak tanÄ±mlanÄ±rsa her zaman Ã¶nbelleÄŸe alÄ±r. Bu, ÅŸu nedenlerden olabilir:

* **UzantÄ±**: Cloudflare, aÅŸaÄŸÄ±daki uzantÄ±lara sahip dosyalarÄ± her zaman Ã¶nbelleÄŸe alÄ±r: 7z, csv, gif, midi, png, tif, zip, avi, doc, gz, mkv, ppt, tiff, zst, avif, docx, ico, mp3, pptx, ttf, apk, dmg, iso, mp4, ps, webm, bin, ejs, jar, ogg, rar, webp, bmp, eot, jpg, otf, svg, woff, bz2, eps, jpeg, pdf, svgz, woff2, class, exe, js, pict, swf, xls, css, flac, mid, pls, tar, xlsx
* Dinamik bir yanÄ±tÄ± Ã¶nbelleÄŸe almak iÃ§in bir ayÄ±rÄ±cÄ± ve statik bir uzantÄ± kullanarak zorlamak mÃ¼mkÃ¼ndÃ¼r; Ã¶rneÄŸin, `/home$image.png` isteÄŸi `/home$image.png`'i Ã¶nbelleÄŸe alacak ve kÃ¶ken sunucusu `/home` ile yanÄ±t verecektir.
* **Ä°yi bilinen statik dizinler**: AÅŸaÄŸÄ±daki dizinler statik dosyalar iÃ§erir ve bu nedenle yanÄ±tlarÄ± Ã¶nbelleÄŸe alÄ±nmalÄ±dÄ±r: /static, /assets, /wp-content, /media, /templates, /public, /shared
* Bir ayÄ±rÄ±cÄ±, statik bir dizin ve noktalar kullanarak dinamik bir yanÄ±tÄ± Ã¶nbelleÄŸe almak mÃ¼mkÃ¼ndÃ¼r; Ã¶rneÄŸin, `/home/..%2fstatic/something` `/static/something`'i Ã¶nbelleÄŸe alacak ve yanÄ±t `/home` olacaktÄ±r.
* **Statik dizinler + noktalar**: `/static/..%2Fhome` veya `/static/..%5Chome` isteÄŸi olduÄŸu gibi Ã¶nbelleÄŸe alÄ±nabilir, ancak yanÄ±t `/home` olabilir.
* **Statik dosyalar:** BazÄ± Ã¶zel dosyalar her zaman Ã¶nbelleÄŸe alÄ±nÄ±r, Ã¶rneÄŸin `/robots.txt`, `/favicon.ico` ve `/index.html`. Bu, `/home/..%2Frobots.txt` gibi kÃ¶tÃ¼ye kullanÄ±labilir; burada Ã¶nbellek `/robots.txt`'i saklayabilir ve kÃ¶ken sunucusu `/home`'a yanÄ±t verebilir.

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
