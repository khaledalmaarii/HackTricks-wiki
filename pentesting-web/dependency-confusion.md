# Dependency Confusion

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## Basic Information

ìš”ì•½í•˜ìë©´, ì˜ì¡´ì„± í˜¼ë€ ì·¨ì•½ì ì€ í”„ë¡œì íŠ¸ê°€ **ì˜ëª» ì² ìëœ** ì´ë¦„, **ì¡´ì¬í•˜ì§€ ì•ŠëŠ”** ì´ë¦„ ë˜ëŠ” **ì§€ì •ë˜ì§€ ì•Šì€ ë²„ì „**ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ë•Œ ë°œìƒí•˜ë©°, ì‚¬ìš©ëœ ì˜ì¡´ì„± ì €ì¥ì†Œê°€ **ê³µê°œ** ì €ì¥ì†Œì—ì„œ **ì—…ë°ì´íŠ¸ëœ ë²„ì „ì„ ìˆ˜ì§‘**í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.

* **ì˜ëª» ì² ìëœ**: **`reqests`**ë¥¼ ëŒ€ì‹ í•˜ì—¬ `requests`ë¥¼ ê°€ì ¸ì˜¤ê¸°
* **ì¡´ì¬í•˜ì§€ ì•ŠëŠ”**: ë” ì´ìƒ **ì¡´ì¬í•˜ì§€ ì•ŠëŠ”** ë‚´ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ `company-logging` ê°€ì ¸ì˜¤ê¸°
* **ì§€ì •ë˜ì§€ ì•Šì€ ë²„ì „**: **ë‚´ë¶€**ì— **ì¡´ì¬í•˜ëŠ”** `company-requests` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°€ì ¸ì˜¤ì§€ë§Œ, ì €ì¥ì†Œê°€ **ë” í° ë²„ì „**ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ **ê³µê°œ ì €ì¥ì†Œ**ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

## Exploitation

{% hint style="warning" %}
ëª¨ë“  ê²½ìš°ì— ê³µê²©ìëŠ” í”¼í•´ íšŒì‚¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ **ì´ë¦„ì„ ê°€ì§„ ì•…ì„± íŒ¨í‚¤ì§€**ë¥¼ ê²Œì‹œí•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.
{% endhint %}

### Misspelled & Inexistent

íšŒì‚¬ê°€ **ë‚´ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ë‹Œ ë¼ì´ë¸ŒëŸ¬ë¦¬**ë¥¼ ê°€ì ¸ì˜¤ë ¤ê³  í•œë‹¤ë©´, ë¼ì´ë¸ŒëŸ¬ë¦¬ ì €ì¥ì†Œê°€ **ê³µê°œ ì €ì¥ì†Œ**ì—ì„œ ì´ë¥¼ ê²€ìƒ‰í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ê³µê²©ìê°€ ì´ë¥¼ ìƒì„±í–ˆë‹¤ë©´, ê·€í•˜ì˜ ì½”ë“œì™€ ì‹¤í–‰ ì¤‘ì¸ ë¨¸ì‹ ì€ ë§¤ìš° ë†’ì€ í™•ë¥ ë¡œ ì†ìƒë  ê²ƒì…ë‹ˆë‹¤.

### Unspecified Version

ê°œë°œìê°€ ì‚¬ìš©ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ **ë²„ì „ì„ ì§€ì •í•˜ì§€ ì•Šê±°ë‚˜** ë‹¨ì§€ **ì£¼ìš” ë²„ì „**ë§Œ ì§€ì •í•˜ëŠ” ê²½ìš°ê°€ ë§¤ìš° í”í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ì¸í„°í”„ë¦¬í„°ëŠ” í•´ë‹¹ ìš”êµ¬ ì‚¬í•­ì— ë§ëŠ” **ìµœì‹  ë²„ì „**ì„ ë‹¤ìš´ë¡œë“œí•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤.\
ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ **ì˜ ì•Œë ¤ì§„ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬**(ì˜ˆ: python `requests`)ì¸ ê²½ìš°, **ê³µê²©ìëŠ” ë§ì€ ê²ƒì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**, ì™œëƒí•˜ë©´ ê·¸ëŠ” `requests`ë¼ëŠ” ì´ë¦„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤(ê·¸ê°€ ì›ë˜ ì €ìê°€ ì•„ë‹Œ í•œ).\
ê·¸ëŸ¬ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ **ë‚´ë¶€**ì¸ ê²½ìš°, ì´ ì˜ˆì—ì„œ `requests-company`ì™€ ê°™ì´, **ë¼ì´ë¸ŒëŸ¬ë¦¬ ì €ì¥ì†Œ**ê°€ **ì™¸ë¶€ì—ì„œë„ ìƒˆë¡œìš´ ë²„ì „ì„ í™•ì¸**í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ë©´, ê³µê°œì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ë” ìµœì‹  ë²„ì „ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.\
ë”°ë¼ì„œ **ê³µê²©ìê°€** íšŒì‚¬ê°€ `requests-company` ë¼ì´ë¸ŒëŸ¬ë¦¬ **ë²„ì „ 1.0.1**(ì†Œê·œëª¨ ì—…ë°ì´íŠ¸ í—ˆìš©)ì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ ì•Œê³  ìˆë‹¤ë©´, ê·¸ëŠ” `requests-company` **ë²„ì „ 1.0.2**ë¥¼ **ê²Œì‹œ**í•  ìˆ˜ ìˆìœ¼ë©°, íšŒì‚¬ëŠ” ë‚´ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëŒ€ì‹  í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ **ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤**.

## AWS Fix

ì´ ì·¨ì•½ì ì€ AWS **CodeArtifact**ì—ì„œ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤(ìì„¸í•œ ë‚´ìš©ì€ [**ì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼**](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)ì—ì„œ í™•ì¸í•˜ì„¸ìš”).\
AWSëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë‚´ë¶€ì¸ì§€ ì™¸ë¶€ì¸ì§€ ì§€ì •í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ ì™¸ë¶€ ì €ì¥ì†Œì—ì„œ ë‚´ë¶€ ì˜ì¡´ì„±ì„ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê²ƒì„ ë°©ì§€í–ˆìŠµë‹ˆë‹¤.

## Finding Vulnerable Libraries

[**ì˜ì¡´ì„± í˜¼ë€ì— ëŒ€í•œ ì›ë˜ ê²Œì‹œë¬¼**](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)ì—ì„œ ì €ìëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ í”„ë¡œì íŠ¸ì˜ ì˜ì¡´ì„±ì„ í¬í•¨í•˜ëŠ” ìˆ˜ì²œ ê°œì˜ ë…¸ì¶œëœ package.json íŒŒì¼ì„ ê²€ìƒ‰í–ˆìŠµë‹ˆë‹¤.

## References

* [https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)
* [https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
