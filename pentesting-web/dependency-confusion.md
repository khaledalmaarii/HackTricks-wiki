# Dependency Confusion

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## Basic Information

Ukratko, ranjivost zavisnosti se javlja kada projekat koristi biblioteku sa **pogreÅ¡no napisanim** imenom, **nepostojeÄ‡om** ili sa **neodreÄ‘enom verzijom** i koriÅ¡Ä‡eni repozitorij zavisnosti omoguÄ‡ava da se **prikupe aÅ¾urirane verzije iz javnih** repozitorija.

* **PogreÅ¡no napisano**: Uvoz **`reqests`** umesto `requests`
* **NepostojeÄ‡e**: Uvoz `company-logging`, interne biblioteke koja **viÅ¡e ne postoji**
* **NeodreÄ‘ena verzija**: Uvoz **interne** **postojeÄ‡e** `company-requests` biblioteke, ali repozitorij proverava **javne repozitorije** da vidi da li postoje **veÄ‡e verzije**.

## Exploitation

{% hint style="warning" %}
U svim sluÄajevima napadaÄu je potrebno samo da objavi **zloÄ‡udni paket sa imenom** biblioteka koje koristi Å¾rtvinska kompanija.
{% endhint %}

### Misspelled & Inexistent

Ako vaÅ¡a kompanija pokuÅ¡ava da **uvozi biblioteku koja nije interna**, vrlo verovatno Ä‡e repozitorij biblioteka traÅ¾iti u **javnim repozitorijima**. Ako je napadaÄ to stvorio, vaÅ¡ kod i maÅ¡ine koje rade su vrlo verovatno kompromitovani.

### Unspecified Version

Veoma je uobiÄajeno da programeri **ne specificiraju nijednu verziju** koriÅ¡Ä‡ene biblioteke, ili specificiraju samo **glavnu verziju**. Tada Ä‡e interpreter pokuÅ¡ati da preuzme **najnoviju verziju** koja odgovara tim zahtevima.\
Ako je biblioteka **poznata spoljna biblioteka** (kao Å¡to je python `requests`), **napadaÄ ne moÅ¾e mnogo da uradi**, jer neÄ‡e moÄ‡i da stvori biblioteku pod imenom `requests` (osim ako nije originalni autor).\
MeÄ‘utim, ako je biblioteka **interna**, kao Å¡to je `requests-company` u ovom primeru, ako **repo biblioteke** dozvoljava da se **proveravaju nove verzije i spolja**, traÅ¾iÄ‡e noviju verziju koja je javno dostupna.\
Dakle, ako **napadaÄ zna** da kompanija koristi `requests-company` biblioteku **verzija 1.0.1** (dozvoljava manje aÅ¾uriranja). MoÅ¾e **objaviti** biblioteku `requests-company` **verzija 1.0.2** i kompanija Ä‡e **koristiti tu biblioteku umesto** interne.

## AWS Fix

Ova ranjivost je pronaÄ‘ena u AWS **CodeArtifact** (proÄitajte [**detalje u ovom blog postu**](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)).\
AWS je to ispravio omoguÄ‡avajuÄ‡i da se specificira da li je biblioteka interna ili eksterna, kako bi se izbeglo preuzimanje internih zavisnosti iz spoljnih repozitorija.

## Finding Vulnerable Libraries

U [**originalnom postu o zavisniÄkoj konfuziji**](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610) autor je pretraÅ¾ivao hiljade izloÅ¾enih package.json fajlova koji sadrÅ¾e zavisnosti javascript projekata.

## References

* [https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)
* [https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
