# Dependency Confusion

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## Basic Information

W skr贸cie, luka w zale偶noci nazywana dependency confusion wystpuje, gdy projekt u偶ywa biblioteki o **bdnie napisanej** nazwie, **nieistniejcej** lub z **niesprecyzowan wersj**, a u偶ywane repozytorium zale偶noci pozwala na **zbieranie zaktualizowanych wersji z publicznych** repozytori贸w.

* **Bdnie napisana**: Import **`reqests`** zamiast `requests`
* **Nieistniejca**: Import `company-logging`, wewntrznej biblioteki, kt贸ra **ju偶 nie istnieje**
* **Niesprecyzowana wersja**: Import **wewntrznej** **istniejcej** biblioteki `company-requests`, ale repozytorium sprawdza **publiczne repozytoria**, aby zobaczy, czy s **nowsze wersje**.

## Exploitation

{% hint style="warning" %}
W ka偶dym przypadku atakujcy musi tylko opublikowa **zoliwy pakiet o nazwie** bibliotek u偶ywanych przez firm ofiary.
{% endhint %}

### Misspelled & Inexistent

Jeli twoja firma pr贸buje **zaimportowa bibliotek, kt贸ra nie jest wewntrzna**, istnieje du偶e prawdopodobiestwo, 偶e repozytorium bibliotek bdzie jej szuka w **publicznych repozytoriach**. Jeli atakujcy j stworzy, tw贸j kod i dziaajce maszyny prawdopodobnie zostan skompromitowane.

### Unspecified Version

Bardzo czsto programici **nie okrelaj 偶adnej wersji** u偶ywanej biblioteki lub okrelaj tylko **g贸wn wersj**. Wtedy interpreter spr贸buje pobra **najnowoczeniejsz wersj** speniajc te wymagania.\
Jeli biblioteka jest **znan zewntrzn bibliotek** (jak python `requests`), atakujcy **nie mo偶e wiele zrobi**, poniewa偶 nie bdzie w stanie stworzy biblioteki o nazwie `requests` (chyba 偶e jest oryginalnym autorem).\
Jednak jeli biblioteka jest **wewntrzna**, jak `requests-company` w tym przykadzie, jeli **repozytorium biblioteki** pozwala na **sprawdzanie nowych wersji r贸wnie偶 zewntrznie**, bdzie szuka nowszej wersji dostpnej publicznie.\
Wic jeli **atakujcy wie**, 偶e firma u偶ywa biblioteki `requests-company` **w wersji 1.0.1** (pozwalajcej na drobne aktualizacje). Mo偶e **opublikowa** bibliotek `requests-company` **w wersji 1.0.2**, a firma **u偶yje tej biblioteki zamiast** wewntrznej.

## AWS Fix

Ta luka zostaa znaleziona w AWS **CodeArtifact** (przeczytaj [**szczeg贸y w tym pocie na blogu**](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)).\
AWS naprawio to, pozwalajc okreli, czy biblioteka jest wewntrzna czy zewntrzna, aby unikn pobierania wewntrznych zale偶noci z zewntrznych repozytori贸w.

## Finding Vulnerable Libraries

W [**oryginalnym pocie o dependency confusion**](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610) autor przeszuka tysice ujawnionych plik贸w package.json zawierajcych zale偶noci projekt贸w javascript.

## References

* [https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)
* [https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
