# Przejcie domeny/poddomeny

<details>

<summary><strong>Zacznij od zera i sta si ekspertem AWS z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan na HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa przepywy pracy** z wykorzystaniem najbardziej zaawansowanych narzdzi spoecznoci.\
Zdobd藕 dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Przejcie domeny

Jeli odkryjesz, 偶e pewna domena (domena.tld) jest **u偶ywana przez jaki serwis w zakresie**, ale **firma** stracia nad ni **wasno**, mo偶esz spr贸bowa j **zarejestrowa** (jeli jest wystarczajco tania) i poinformowa firm. Jeli ta domena otrzymuje jakie **wra偶liwe informacje**, takie jak ciasteczko sesji za pomoc parametru **GET** lub w nag贸wku **Referer**, jest to z pewnoci **luka**.

### Przejcie poddomeny

Poddomena firmy wskazuje na **usug zewntrzn o niezarejestrowanej nazwie**. Jeli mo偶esz **utworzy** konto w tej **usudze zewntrznej** i **zarejestrowa** nazw, kt贸ra jest w u偶yciu, mo偶esz dokona przejcia poddomeny.

Istnieje kilka narzdzi z sownikami do sprawdzania mo偶liwych przej:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)

#### Skanowanie podatnych na przejcie poddomen za pomoc [BBOT](https://github.com/blacklanternsecurity/bbot):

Sprawdzanie podatnoci na przejcie poddomeny jest zawarte w domylnym wyliczaniu poddomen BBOT. Sygnatury s pobierane bezporednio z [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Generowanie przejcia subdomeny poprzez dzik kart DNS

Kiedy u偶ywana jest dzika karta DNS w domenie, ka偶da 偶dana subdomena tej domeny, kt贸ra nie ma wyra藕nie innego adresu, bdzie **rozwizana do tych samych informacji**. Mo偶e to by adres IP A, CNAME...

Na przykad, jeli `*.testing.com` jest przypisany do `1.1.1.1`. Wtedy `not-existent.testing.com` bdzie wskazywa na `1.1.1.1`.

Jednak偶e, jeli zamiast wskazywa na adres IP, administrator systemu wska偶e to do **usugi os贸b trzecich poprzez CNAME**, jak na przykad **subdomen githuba** (`sohomdatta1.github.io`). Atakujcy m贸gby **utworzy swoj wasn stron os贸b trzecich** (w tym przypadku w Gihubie) i powiedzie, 偶e `something.testing.com` wskazuje tam. Poniewa偶 **dzika karta CNAME** zgodzi si, atakujcy bdzie m贸g **generowa dowolne subdomeny dla domeny ofiary wskazujce na swoje strony**.

Przykad tej podatnoci mo偶na znale藕 w opisie CTF: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Wykorzystanie przejcia subdomeny

Przejcie subdomeny to w zasadzie podszywanie si DNS dla konkretnej domeny w Internecie, pozwalajce atakujcym ustawi rekordy A dla domeny, co prowadzi do wywietlania treci z serwera atakujcego w przegldarkach. Ta **transparentno** w przegldarkach sprawia, 偶e domeny s podatne na phishing. Atakujcy mog wykorzysta [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) lub [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) w tym celu. Szczeg贸lnie podatne s domeny, w kt贸rych adres URL w wiadomoci phishingowej wydaje si prawdziwy, wprowadzajc w bd u偶ytkownik贸w i unikajc filtr贸w antyspamowych ze wzgldu na inherentne zaufanie do domeny.

Sprawd藕 ten [post dla dalszych szczeg贸贸w](https://0xpatrik.com/subdomain-takeover/)

### **Certyfikaty SSL**

Certyfikaty SSL, jeli generowane przez atakujcych poprzez usugi takie jak [_Let's Encrypt_](https://letsencrypt.org/), dodaj wiarygodnoci tym faszywym domenom, sprawiajc, 偶e ataki phishingowe s bardziej przekonujce.

### **Bezpieczestwo plik贸w cookie i transparentno przegldarki**

Transparentno przegldarki dotyczy r贸wnie偶 bezpieczestwa plik贸w cookie, regulowanego przez zasady takie jak [Polityka tego samego pochodzenia](https://en.wikipedia.org/wiki/Same-origin\_policy). Pliki cookie, czsto u偶ywane do zarzdzania sesjami i przechowywania token贸w logowania, mog by wykorzystane poprzez przejcie subdomeny. Atakujcy mog **zbiera pliki cookie sesji** po prostu kierujc u偶ytkownik贸w do skompromitowanej subdomeny, zagra偶ajc danym u偶ytkownik贸w i prywatnoci.

### **Emaile i przejcie subdomeny**

Inny aspekt przejcia subdomeny dotyczy usug e-mail. Atakujcy mog manipulowa **rekordami MX** w celu odbierania lub wysyania e-maili z prawidowej subdomeny, zwikszajc skuteczno atak贸w phishingowych.

### **Wy偶sze ryzyka**

Dodatkowe ryzyka obejmuj **przejcie rekord贸w NS**. Jeli atakujcy uzyska kontrol nad jednym rekordem NS domeny, potencjalnie mo偶e skierowa cz ruchu na serwer pod swoj kontrol. To ryzyko wzrasta, jeli atakujcy ustawia wysoki **TTL (czas 偶ycia)** dla rekord贸w DNS, przedu偶ajc czas trwania ataku.

### Podatno rekord贸w CNAME

Atakujcy mog wykorzysta nieprzydzielone rekordy CNAME wskazujce na zewntrzne usugi, kt贸re nie s ju偶 u偶ywane lub zostay wycofane. Pozwala to im utworzy stron pod zaufan domen, uatwiajc dalsze dziaania phishingowe lub dystrybucj zoliwego oprogramowania.

### **Strategie agodzenia**

Strategie agodzenia obejmuj:

1. **Usunicie podatnych rekord贸w DNS** - Jest to skuteczne, jeli subdomena nie jest ju偶 wymagana.
2. **Zarejestrowanie nazwy domeny** - Zarejestrowanie zasobu u dostawcy chmury lub ponowne zakupienie wygasej domeny.
3. **Regularne monitorowanie pod ktem podatnoci** - Narzdzia takie jak [aquatone](https://github.com/michenriksen/aquatone) mog pom贸c zidentyfikowa podatne domeny. Organizacje powinny r贸wnie偶 przejrze swoje procesy zarzdzania infrastruktur, zapewniajc, 偶e tworzenie rekord贸w DNS jest ostatnim krokiem w tworzeniu zasobu i pierwszym krokiem w jego usuniciu.

Dla dostawc贸w chmury weryfikacja wasnoci domeny jest kluczowa dla zapobie偶enia przejciom subdomen. Niekt贸re, jak [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), zday sobie spraw z tego problemu i wdro偶yy mechanizmy weryfikacji domeny.

## Referencje

* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) do atwego tworzenia i **automatyzacji prac** z wykorzystaniem najbardziej zaawansowanych narzdzi spoecznoci na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Zacznij od zera i zosta ekspertem w hakowaniu AWS z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
