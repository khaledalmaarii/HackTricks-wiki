# Domain/Subdomain takeover

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_source=hacktricks\&utm\_medium=text\&utm\_campaign=ppc\&utm\_term=trickest\&utm\_content=domain-subdomain-takeover) para construir e **automatizar fluxos de trabalho** facilmente, impulsionados pelas **ferramentas comunit√°rias mais avan√ßadas** do mundo.\
Obtenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

## Domain takeover

Se voc√™ descobrir algum dom√≠nio (domain.tld) que est√° **sendo usado por algum servi√ßo dentro do escopo** mas a **empresa** **perdeu** a **propriedade** dele, voc√™ pode tentar **registr√°-lo** (se for barato o suficiente) e avisar a empresa. Se este dom√≠nio estiver recebendo alguma **informa√ß√£o sens√≠vel** como um cookie de sess√£o via **GET** par√¢metro ou no cabe√ßalho **Referer**, isso √© com certeza uma **vulnerabilidade**.

### Subdomain takeover

Um subdom√≠nio da empresa est√° apontando para um **servi√ßo de terceiros com um nome n√£o registrado**. Se voc√™ conseguir **criar** uma **conta** neste **servi√ßo de terceiros** e **registrar** o **nome** que est√° em uso, voc√™ pode realizar a tomada de subdom√≠nio.

Existem v√°rias ferramentas com dicion√°rios para verificar poss√≠veis tomadas:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)
* [https://github.com/Stratus-Security/Subdominator](https://github.com/Stratus-Security/Subdominator)

### Subdomain Takeover Generation via DNS Wildcard

Quando um wildcard DNS √© usado em um dom√≠nio, qualquer subdom√≠nio solicitado desse dom√≠nio que n√£o tenha um endere√ßo diferente explicitamente ser√° **resolvido para as mesmas informa√ß√µes**. Isso pode ser um endere√ßo IP A, um CNAME...

Por exemplo, se `*.testing.com` √© wildcard para `1.1.1.1`. Ent√£o, `not-existent.testing.com` estar√° apontando para `1.1.1.1`.

No entanto, se em vez de apontar para um endere√ßo IP, o administrador do sistema apont√°-lo para um **servi√ßo de terceiros via CNAME**, como um subdom√≠nio do G**ithub** por exemplo (`sohomdatta1.github.io`). Um atacante poderia **criar sua pr√≥pria p√°gina de terceiros** (no Github neste caso) e dizer que `something.testing.com` est√° apontando para l√°. Porque, o **CNAME wildcard** concordar√° que o atacante poder√° **gerar subdom√≠nios arbitr√°rios para o dom√≠nio da v√≠tima apontando para suas p√°ginas**.

Voc√™ pode encontrar um exemplo dessa vulnerabilidade no write-up do CTF: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Exploiting a subdomain takeover

A tomada de subdom√≠nio √© essencialmente um spoofing DNS para um dom√≠nio espec√≠fico na internet, permitindo que atacantes definam registros A para um dom√≠nio, levando os navegadores a exibir conte√∫do do servidor do atacante. Essa **transpar√™ncia** nos navegadores torna os dom√≠nios propensos a phishing. Os atacantes podem empregar [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ou [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) para esse prop√≥sito. Especialmente vulner√°veis s√£o os dom√≠nios onde a URL em um e-mail de phishing parece leg√≠tima, enganando os usu√°rios e evitando filtros de spam devido √† confian√ßa inerente do dom√≠nio.

Confira este [post para mais detalhes](https://0xpatrik.com/subdomain-takeover/)

### **SSL Certificates**

Certificados SSL, se gerados por atacantes via servi√ßos como [_Let's Encrypt_](https://letsencrypt.org/), aumentam a legitimidade desses dom√≠nios falsos, tornando os ataques de phishing mais convincentes.

### **Cookie Security and Browser Transparency**

A transpar√™ncia do navegador tamb√©m se estende √† seguran√ßa dos cookies, regida por pol√≠ticas como a [Same-origin policy](https://en.wikipedia.org/wiki/Same-origin\_policy). Cookies, frequentemente usados para gerenciar sess√µes e armazenar tokens de login, podem ser explorados atrav√©s da tomada de subdom√≠nio. Os atacantes podem **coletar cookies de sess√£o** simplesmente direcionando os usu√°rios para um subdom√≠nio comprometido, colocando em risco os dados e a privacidade dos usu√°rios.

### **Emails and Subdomain Takeover**

Outro aspecto da tomada de subdom√≠nio envolve servi√ßos de e-mail. Os atacantes podem manipular **registros MX** para receber ou enviar e-mails de um subdom√≠nio leg√≠timo, aumentando a efic√°cia dos ataques de phishing.

### **Higher Order Risks**

Outros riscos incluem a **tomada de registro NS**. Se um atacante obtiver controle sobre um registro NS de um dom√≠nio, ele pode potencialmente direcionar uma parte do tr√°fego para um servidor sob seu controle. Esse risco √© amplificado se o atacante definir um **TTL (Time to Live)** alto para os registros DNS, prolongando a dura√ß√£o do ataque.

### CNAME Record Vulnerability

Os atacantes podem explorar registros CNAME n√£o reivindicados que apontam para servi√ßos externos que n√£o est√£o mais em uso ou foram desativados. Isso permite que eles criem uma p√°gina sob o dom√≠nio confi√°vel, facilitando ainda mais o phishing ou a distribui√ß√£o de malware.

### **Mitigation Strategies**

As estrat√©gias de mitiga√ß√£o incluem:

1. **Remover registros DNS vulner√°veis** - Isso √© eficaz se o subdom√≠nio n√£o for mais necess√°rio.
2. **Reivindicar o nome de dom√≠nio** - Registrar o recurso com o respectivo provedor de nuvem ou recomprar um dom√≠nio expirado.
3. **Monitoramento regular para vulnerabilidades** - Ferramentas como [aquatone](https://github.com/michenriksen/aquatone) podem ajudar a identificar dom√≠nios suscet√≠veis. As organiza√ß√µes tamb√©m devem revisar seus processos de gerenciamento de infraestrutura, garantindo que a cria√ß√£o de registros DNS seja a √∫ltima etapa na cria√ß√£o de recursos e a primeira etapa na destrui√ß√£o de recursos.

Para provedores de nuvem, verificar a propriedade do dom√≠nio √© crucial para prevenir tomadas de subdom√≠nio. Alguns, como [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), reconheceram esse problema e implementaram mecanismos de verifica√ß√£o de dom√≠nio.

## References

* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)
* [https://www.stratussecurity.com/post/subdomain-takeover-guide](https://www.stratussecurity.com/post/subdomain-takeover-guide)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_source=hacktricks\&utm\_medium=text\&utm\_campaign=ppc\&utm\_term=trickest\&utm\_content=domain-subdomain-takeover) para construir e **automatizar fluxos de trabalho** facilmente, impulsionados pelas **ferramentas comunit√°rias mais avan√ßadas** do mundo.\
Obtenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
