# Przejcie domeny/subdomeny

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=domain-subdomain-takeover), aby atwo budowa i **automatyzowa przepywy pracy** zasilane przez **najbardziej zaawansowane** narzdzia spoecznociowe na wiecie.\
Uzyskaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

## Przejcie domeny

Jeli odkryjesz jak domen (domain.tld), kt贸ra **jest u偶ywana przez jak usug w zakresie**, ale **firma** stracia **wasno** nad ni, mo偶esz spr贸bowa **zarejestrowa** j (jeli jest wystarczajco tania) i poinformowa firm. Jeli ta domena otrzymuje jakie **wra偶liwe informacje**, takie jak ciasteczko sesji przez **GET** parametr lub w nag贸wku **Referer**, to na pewno jest to **vulnerabilno**.

### Przejcie subdomeny

Subdomena firmy wskazuje na **usug zewntrzn z niezarejestrowan nazw**. Jeli mo偶esz **utworzy** **konto** w tej **usudze zewntrznej** i **zarejestrowa** u偶ywan **nazw**, mo偶esz przeprowadzi przejcie subdomeny.

Istnieje kilka narzdzi z sownikami do sprawdzania mo偶liwych przej:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)

#### Skanowanie pod ktem przejmowalnych subdomen za pomoc [BBOT](https://github.com/blacklanternsecurity/bbot):

Sprawdzanie przejcia subdomen jest wczone w domyln enumeracj subdomen BBOT. Podpisy s pobierane bezporednio z [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Przejcie subdomeny za pomoc wildcard DNS

Gdy w domenie u偶ywany jest wildcard DNS, ka偶da 偶dana subdomena tej domeny, kt贸ra nie ma innego adresu, zostanie **rozwizana na te same informacje**. Mo偶e to by adres IP A, CNAME...

Na przykad, jeli `*.testing.com` jest wildcardowane do `1.1.1.1`. Wtedy `not-existent.testing.com` bdzie wskazywa na `1.1.1.1`.

Jednak偶e, jeli zamiast wskazywa na adres IP, administrator systemu wska偶e na **usug zewntrzn za pomoc CNAME**, jak na przykad **subdomena githuba** (`sohomdatta1.github.io`). Atakujcy mo偶e **stworzy swoj wasn stron zewntrzn** (w tym przypadku na GitHubie) i powiedzie, 偶e `something.testing.com` wskazuje tam. Poniewa偶 **CNAME wildcard** zgadza si, atakujcy bdzie m贸g **generowa dowolne subdomeny dla domeny ofiary wskazujce na jego strony**.

Mo偶esz znale藕 przykad tej podatnoci w opisie CTF: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Wykorzystywanie przejcia subdomeny

Przejcie subdomeny to w zasadzie spoofing DNS dla konkretnej domeny w internecie, co pozwala atakujcym ustawia rekordy A dla domeny, prowadzc przegldarki do wywietlania treci z serwera atakujcego. Ta **przejrzysto** w przegldarkach sprawia, 偶e domeny s podatne na phishing. Atakujcy mog stosowa [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) lub [_domeny doppelganger_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) w tym celu. Szczeg贸lnie nara偶one s domeny, w kt贸rych URL w e-mailu phishingowym wydaje si legalny, oszukujc u偶ytkownik贸w i omijajc filtry spamowe z powodu wrodzonego zaufania do domeny.

Sprawd藕 ten [post po wicej szczeg贸贸w](https://0xpatrik.com/subdomain-takeover/)

### **Certyfikaty SSL**

Certyfikaty SSL, jeli s generowane przez atakujcych za pomoc usug takich jak [_Let's Encrypt_](https://letsencrypt.org/), zwikszaj wiarygodno tych faszywych domen, czynic ataki phishingowe bardziej przekonujcymi.

### **Bezpieczestwo ciasteczek i przejrzysto przegldarki**

Przejrzysto przegldarki obejmuje r贸wnie偶 bezpieczestwo ciasteczek, regulowane przez polityki takie jak [polityka tego samego pochodzenia](https://en.wikipedia.org/wiki/Same-origin_policy). Ciasteczka, czsto u偶ywane do zarzdzania sesjami i przechowywania token贸w logowania, mog by wykorzystywane przez przejcie subdomeny. Atakujcy mog **zbiera ciasteczka sesji** po prostu kierujc u偶ytkownik贸w do skompromitowanej subdomeny, zagra偶ajc danym i prywatnoci u偶ytkownik贸w.

### **E-maile i przejcie subdomeny**

Kolejny aspekt przejcia subdomeny dotyczy usug e-mailowych. Atakujcy mog manipulowa **rekordami MX**, aby odbiera lub wysya e-maile z legalnej subdomeny, zwikszajc skuteczno atak贸w phishingowych.

### **Wy偶sze ryzyko**

Dalsze ryzyka obejmuj **przejcie rekordu NS**. Jeli atakujcy zdobdzie kontrol nad jednym rekordem NS domeny, mog potencjalnie kierowa czci ruchu do serwera pod swoj kontrol. To ryzyko wzrasta, jeli atakujcy ustawi wysoki **TTL (Time to Live)** dla rekord贸w DNS, wydu偶ajc czas trwania ataku.

### Podatno rekordu CNAME

Atakujcy mog wykorzysta nieprzypisane rekordy CNAME wskazujce na zewntrzne usugi, kt贸re nie s ju偶 u偶ywane lub zostay wycofane. Pozwala to im stworzy stron pod zaufan domen, co dodatkowo uatwia phishing lub dystrybucj zoliwego oprogramowania.

### **Strategie agodzenia**

Strategie agodzenia obejmuj:

1. **Usunicie podatnych rekord贸w DNS** - To jest skuteczne, jeli subdomena nie jest ju偶 potrzebna.
2. **Przypisanie nazwy domeny** - Zarejestrowanie zasobu u odpowiedniego dostawcy chmurowego lub ponowne zakupienie wygasej domeny.
3. **Regularne monitorowanie podatnoci** - Narzdzia takie jak [aquatone](https://github.com/michenriksen/aquatone) mog pom贸c w identyfikacji podatnych domen. Organizacje powinny r贸wnie偶 zrewidowa swoje procesy zarzdzania infrastruktur, zapewniajc, 偶e tworzenie rekord贸w DNS jest ostatnim krokiem w tworzeniu zasob贸w i pierwszym krokiem w ich usuwaniu.

Dla dostawc贸w chmurowych weryfikacja wasnoci domeny jest kluczowa, aby zapobiec przejciom subdomen. Niekt贸rzy, jak [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), dostrzegli ten problem i wdro偶yli mechanizmy weryfikacji domen.

## Referencje

* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=domain-subdomain-takeover), aby atwo budowa i **automatyzowa przepywy pracy** zasilane przez **najbardziej zaawansowane** narzdzia spoecznociowe na wiecie.\
Uzyskaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w githubowych.

</details>
{% endhint %}
