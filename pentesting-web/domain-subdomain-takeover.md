# Domain/Subdomain takeover

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Verwende [**Trickest**](https://trickest.com/?utm\_source=hacktricks\&utm\_medium=text\&utm\_campaign=ppc\&utm\_term=trickest\&utm\_content=domain-subdomain-takeover), um einfach **Workflows** zu erstellen und zu **automatisieren**, die von den **fortschrittlichsten** Community-Tools der Welt unterst√ºtzt werden.\
Erhalte heute Zugang:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

## Domain takeover

Wenn du eine Domain (domain.tld) entdeckst, die **von einem Dienst innerhalb des Geltungsbereichs verwendet wird**, aber das **Unternehmen** die **Eigent√ºmerschaft** verloren hat, kannst du versuchen, sie zu **registrieren** (wenn sie g√ºnstig genug ist) und das Unternehmen dar√ºber informieren. Wenn diese Domain einige **sensible Informationen** wie ein Sitzungscookie √ºber einen **GET**-Parameter oder im **Referer**-Header erh√§lt, ist dies mit Sicherheit eine **Schwachstelle**.

### Subdomain takeover

Eine Subdomain des Unternehmens zeigt auf einen **Drittanbieterdienst mit einem nicht registrierten Namen**. Wenn du ein **Konto** in diesem **Drittanbieterdienst** erstellen und den **Namen**, der verwendet wird, **registrieren** kannst, kannst du den Subdomain-Takeover durchf√ºhren.

Es gibt mehrere Tools mit W√∂rterb√ºchern, um m√∂gliche √úbernahmen zu √ºberpr√ºfen:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)
* [https://github.com/Stratus-Security/Subdominator](https://github.com/Stratus-Security/Subdominator)
* [https://github.com/NImaism/takeit](https://github.com/NImaism/takeit)

### Subdomain Takeover Generation via DNS Wildcard

Wenn ein DNS-Wildcard in einer Domain verwendet wird, wird jede angeforderte Subdomain dieser Domain, die keine andere Adresse explizit hat, **auf dieselben Informationen aufgel√∂st**. Dies k√∂nnte eine A-IP-Adresse, ein CNAME...

Wenn zum Beispiel `*.testing.com` auf `1.1.1.1` wildcarded ist. Dann wird `not-existent.testing.com` auf `1.1.1.1` zeigen.

Wenn der Sysadmin jedoch anstelle einer IP-Adresse auf einen **Drittanbieterdienst √ºber CNAME** zeigt, wie zum Beispiel eine G**ithub-Subdomain** (`sohomdatta1.github.io`). K√∂nnte ein Angreifer **seine eigene Drittanbieter-Seite** (in diesem Fall auf GitHub) erstellen und sagen, dass `something.testing.com` dort hinzeigt. Denn der **CNAME-Wildcard** wird zustimmen, dass der Angreifer in der Lage sein wird, **willk√ºrliche Subdomains f√ºr die Domain des Opfers zu generieren, die auf seine Seiten zeigen**.

Du kannst ein Beispiel f√ºr diese Schwachstelle im CTF-Bericht finden: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Exploiting a subdomain takeover

Der Subdomain-Takeover ist im Wesentlichen DNS-Spoofing f√ºr eine bestimmte Domain im Internet, das es Angreifern erm√∂glicht, A-Records f√ºr eine Domain festzulegen, wodurch Browser Inhalte vom Server des Angreifers anzeigen. Diese **Transparenz** in Browsern macht Domains anf√§llig f√ºr Phishing. Angreifer k√∂nnen [_Typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) oder [_Doppelg√§nger-Domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) zu diesem Zweck verwenden. Besonders anf√§llig sind Domains, bei denen die URL in einer Phishing-E-Mail legitim erscheint, Benutzer t√§uscht und Spam-Filter aufgrund des inh√§renten Vertrauens der Domain umgeht.

√úberpr√ºfe diesen [Beitrag f√ºr weitere Details](https://0xpatrik.com/subdomain-takeover/)

### **SSL-Zertifikate**

SSL-Zertifikate, die von Angreifern √ºber Dienste wie [_Let's Encrypt_](https://letsencrypt.org/) generiert werden, erh√∂hen die Legitimit√§t dieser gef√§lschten Domains und machen Phishing-Angriffe √ºberzeugender.

### **Cookie-Sicherheit und Browser-Transparenz**

Die Browser-Transparenz erstreckt sich auch auf die Cookie-Sicherheit, die durch Richtlinien wie die [Same-origin policy](https://en.wikipedia.org/wiki/Same-origin\_policy) geregelt wird. Cookies, die h√§ufig zur Verwaltung von Sitzungen und zur Speicherung von Anmeldetoken verwendet werden, k√∂nnen durch Subdomain-Takeover ausgenutzt werden. Angreifer k√∂nnen **Sitzungscookies sammeln**, indem sie Benutzer einfach auf eine kompromittierte Subdomain leiten, was die Benutzerdaten und die Privatsph√§re gef√§hrdet.

### **E-Mails und Subdomain Takeover**

Ein weiterer Aspekt des Subdomain-Takeovers betrifft E-Mail-Dienste. Angreifer k√∂nnen **MX-Records** manipulieren, um E-Mails von einer legitimen Subdomain zu empfangen oder zu senden, was die Wirksamkeit von Phishing-Angriffen erh√∂ht.

### **H√∂here Risiken**

Weitere Risiken umfassen **NS-Record-√úbernahmen**. Wenn ein Angreifer die Kontrolle √ºber einen NS-Record einer Domain erlangt, kann er potenziell einen Teil des Traffics auf einen Server unter seiner Kontrolle umleiten. Dieses Risiko wird verst√§rkt, wenn der Angreifer eine hohe **TTL (Time to Live)** f√ºr DNS-Records festlegt, wodurch die Dauer des Angriffs verl√§ngert wird.

### CNAME-Record-Schwachstelle

Angreifer k√∂nnten unbeanspruchte CNAME-Records ausnutzen, die auf externe Dienste zeigen, die nicht mehr verwendet werden oder stillgelegt wurden. Dies erm√∂glicht es ihnen, eine Seite unter der vertrauensw√ºrdigen Domain zu erstellen, was Phishing oder die Verbreitung von Malware weiter erleichtert.

### **Minderungsstrategien**

Minderungsstrategien umfassen:

1. **Entfernen von anf√§lligen DNS-Records** - Dies ist effektiv, wenn die Subdomain nicht mehr ben√∂tigt wird.
2. **Beanspruchen des Domainnamens** - Registrierung der Ressource beim jeweiligen Cloud-Anbieter oder R√ºckkauf einer abgelaufenen Domain.
3. **Regelm√§√üige √úberwachung auf Schwachstellen** - Tools wie [aquatone](https://github.com/michenriksen/aquatone) k√∂nnen helfen, anf√§llige Domains zu identifizieren. Organisationen sollten auch ihre Infrastrukturmanagementprozesse √ºberarbeiten, um sicherzustellen, dass die Erstellung von DNS-Records der letzte Schritt bei der Ressourcenerstellung und der erste Schritt bei der Ressourcenzerst√∂rung ist.

F√ºr Cloud-Anbieter ist die √úberpr√ºfung des Domainbesitzes entscheidend, um Subdomain-Takeovers zu verhindern. Einige, wie [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), haben dieses Problem erkannt und Mechanismen zur Domainverifizierung implementiert.

## Referenzen

* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)
* [https://www.stratussecurity.com/post/subdomain-takeover-guide](https://www.stratussecurity.com/post/subdomain-takeover-guide)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Verwende [**Trickest**](https://trickest.com/?utm\_source=hacktricks\&utm\_medium=text\&utm\_campaign=ppc\&utm\_term=trickest\&utm\_content=domain-subdomain-takeover), um einfach **Workflows** zu erstellen und zu **automatisieren**, die von den **fortschrittlichsten** Community-Tools der Welt unterst√ºtzt werden.\
Erhalte heute Zugang:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
