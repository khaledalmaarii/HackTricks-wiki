# Prise de contr√¥le de domaine/sous-domaine

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm\_source=hacktricks\&utm\_medium=text\&utm\_campaign=ppc\&utm\_term=trickest\&utm\_content=domain-subdomain-takeover) pour cr√©er et **automatiser des flux de travail** facilement gr√¢ce aux **outils communautaires les plus avanc√©s** au monde.\
Obtenez un acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

## Prise de contr√¥le de domaine

Si vous d√©couvrez un domaine (domain.tld) qui est **utilis√© par un service dans le p√©rim√®tre** mais que la **soci√©t√©** a **perdu** la **propri√©t√©** de celui-ci, vous pouvez essayer de **l'enregistrer** (s'il est suffisamment bon march√©) et informer la soci√©t√©. Si ce domaine re√ßoit des **informations sensibles** comme un cookie de session via un param√®tre **GET** ou dans l'en-t√™te **Referer**, c'est certainement une **vuln√©rabilit√©**.

### Prise de contr√¥le de sous-domaine

Un sous-domaine de la soci√©t√© pointe vers un **service tiers avec un nom non enregistr√©**. Si vous pouvez **cr√©er** un **compte** dans ce **service tiers** et **enregistrer** le **nom** en cours d'utilisation, vous pouvez effectuer la prise de contr√¥le du sous-domaine.

Il existe plusieurs outils avec des dictionnaires pour v√©rifier les prises de contr√¥le possibles :

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)
* [https://github.com/Stratus-Security/Subdominator](https://github.com/Stratus-Security/Subdominator)
* [https://github.com/NImaism/takeit](https://github.com/NImaism/takeit)

### G√©n√©ration de prise de contr√¥le de sous-domaine via DNS Wildcard

Lorsque le wildcard DNS est utilis√© dans un domaine, tout sous-domaine demand√© de ce domaine qui n'a pas d'adresse diff√©rente explicitement sera **r√©solu √† la m√™me information**. Cela pourrait √™tre une adresse IP A, un CNAME...

Par exemple, si `*.testing.com` est wildcard√© √† `1.1.1.1`. Alors, `not-existent.testing.com` pointera vers `1.1.1.1`.

Cependant, si au lieu de pointer vers une adresse IP, l'administrateur syst√®me le pointe vers un **service tiers via CNAME**, comme un sous-domaine **Github** par exemple (`sohomdatta1.github.io`). Un attaquant pourrait **cr√©er sa propre page tierce** (dans Github dans ce cas) et dire que `something.testing.com` pointe l√†. Parce que, le **wildcard CNAME** permettra √† l'attaquant de **g√©n√©rer des sous-domaines arbitraires pour le domaine de la victime pointant vers ses pages**.

Vous pouvez trouver un exemple de cette vuln√©rabilit√© dans le rapport CTF : [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Exploitation d'une prise de contr√¥le de sous-domaine

La prise de contr√¥le de sous-domaine est essentiellement un spoofing DNS pour un domaine sp√©cifique sur Internet, permettant aux attaquants de d√©finir des enregistrements A pour un domaine, amenant les navigateurs √† afficher du contenu depuis le serveur de l'attaquant. Cette **transparence** dans les navigateurs rend les domaines vuln√©rables au phishing. Les attaquants peuvent utiliser [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ou [_domaines Doppelganger_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) √† cette fin. Sont particuli√®rement vuln√©rables les domaines o√π l'URL dans un e-mail de phishing semble l√©gitime, trompant les utilisateurs et √©vitant les filtres anti-spam en raison de la confiance inh√©rente au domaine.

Consultez ce [post pour plus de d√©tails](https://0xpatrik.com/subdomain-takeover/)

### **Certificats SSL**

Les certificats SSL, s'ils sont g√©n√©r√©s par des attaquants via des services comme [_Let's Encrypt_](https://letsencrypt.org/), ajoutent √† la l√©gitimit√© de ces faux domaines, rendant les attaques de phishing plus convaincantes.

### **S√©curit√© des cookies et transparence des navigateurs**

La transparence des navigateurs s'√©tend √©galement √† la s√©curit√© des cookies, r√©gie par des politiques comme la [politique de m√™me origine](https://en.wikipedia.org/wiki/Same-origin\_policy). Les cookies, souvent utilis√©s pour g√©rer les sessions et stocker des jetons de connexion, peuvent √™tre exploit√©s par la prise de contr√¥le de sous-domaine. Les attaquants peuvent **rassembler des cookies de session** simplement en dirigeant les utilisateurs vers un sous-domaine compromis, mettant en danger les donn√©es et la vie priv√©e des utilisateurs.

### **E-mails et prise de contr√¥le de sous-domaine**

Un autre aspect de la prise de contr√¥le de sous-domaine concerne les services de messagerie. Les attaquants peuvent manipuler les **enregistrements MX** pour recevoir ou envoyer des e-mails d'un sous-domaine l√©gitime, am√©liorant l'efficacit√© des attaques de phishing.

### **Risques de niveau sup√©rieur**

D'autres risques incluent la **prise de contr√¥le des enregistrements NS**. Si un attaquant prend le contr√¥le d'un enregistrement NS d'un domaine, il peut potentiellement diriger une partie du trafic vers un serveur sous son contr√¥le. Ce risque est amplifi√© si l'attaquant d√©finit un **TTL (Time to Live)** √©lev√© pour les enregistrements DNS, prolongeant la dur√©e de l'attaque.

### Vuln√©rabilit√© des enregistrements CNAME

Les attaquants pourraient exploiter des enregistrements CNAME non revendiqu√©s pointant vers des services externes qui ne sont plus utilis√©s ou ont √©t√© d√©sactiv√©s. Cela leur permet de cr√©er une page sous le domaine de confiance, facilitant davantage le phishing ou la distribution de logiciels malveillants.

### **Strat√©gies d'att√©nuation**

Les strat√©gies d'att√©nuation incluent :

1. **Supprimer les enregistrements DNS vuln√©rables** - Cela est efficace si le sous-domaine n'est plus n√©cessaire.
2. **Revendiquer le nom de domaine** - Enregistrer la ressource aupr√®s du fournisseur de cloud respectif ou racheter un domaine expir√©.
3. **Surveillance r√©guli√®re des vuln√©rabilit√©s** - Des outils comme [aquatone](https://github.com/michenriksen/aquatone) peuvent aider √† identifier les domaines susceptibles. Les organisations devraient √©galement r√©viser leurs processus de gestion d'infrastructure, en s'assurant que la cr√©ation d'enregistrements DNS est la derni√®re √©tape dans la cr√©ation de ressources et la premi√®re √©tape dans la destruction de ressources.

Pour les fournisseurs de cloud, v√©rifier la propri√©t√© du domaine est crucial pour pr√©venir les prises de contr√¥le de sous-domaine. Certains, comme [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), ont reconnu ce probl√®me et mis en ≈ìuvre des m√©canismes de v√©rification de domaine.

## R√©f√©rences

* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)
* [https://www.stratussecurity.com/post/subdomain-takeover-guide](https://www.stratussecurity.com/post/subdomain-takeover-guide)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm\_source=hacktricks\&utm\_medium=text\&utm\_campaign=ppc\&utm\_term=trickest\&utm\_content=domain-subdomain-takeover) pour cr√©er et **automatiser des flux de travail** facilement gr√¢ce aux **outils communautaires les plus avanc√©s** au monde.\
Obtenez un acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=domain-subdomain-takeover" %}

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
