# Przejcie domeny/poddomeny

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa przepywy pracy** przy u偶yciu najbardziej zaawansowanych narzdzi spoecznociowych na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Przejcie domeny

Jeli odkryjesz jak domen (domena.tld), kt贸ra jest **u偶ywana przez pewn usug w zakresie** ale **firma** utracia **wasno** nad ni, mo偶esz spr贸bowa j **zarejestrowa** (jeli jest wystarczajco tania) i poinformowa o tym firm. Jeli ta domena otrzymuje jakie **wra偶liwe informacje**, takie jak ciasteczko sesji za pomoc parametru **GET** lub w nag贸wku **Referer**, jest to z pewnoci **luka w zabezpieczeniach**.

### Przejcie poddomeny

Poddomena firmy wskazuje na **usug zewntrzn o niezarejestrowanej nazwie**. Jeli mo偶esz **utworzy** konto w tej **usudze zewntrznej** i **zarejestrowa** u偶ywan **nazw**, mo偶esz przeprowadzi przejcie poddomeny.

Istnieje kilka narzdzi z sownikami, kt贸re mo偶na sprawdzi pod ktem mo偶liwych przej:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)

#### Skanowanie podatnych na przejcie poddomen za pomoc [BBOT](https://github.com/blacklanternsecurity/bbot):

Sprawdzanie podatnoci na przejcie poddomen jest uwzgldnione w domylnym wyliczaniu poddomen BBOT. Sygnatury s pobierane bezporednio z [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).
```bash
bbot -t evilcorp.com -f subdomain-enum
```
### Generowanie przejcia subdomeny za pomoc DNS Wildcard

Kiedy w domenie u偶ywany jest DNS wildcard, ka偶da 偶dana subdomena tej domeny, kt贸ra nie ma innych jawnie okrelonych adres贸w, bdzie **rozwizana do tych samych informacji**. Mo偶e to by adres IP typu A, CNAME...

Na przykad, jeli `*.testing.com` jest ustawione jako wildcard na `1.1.1.1`. Wtedy `not-existent.testing.com` bdzie wskazywa na `1.1.1.1`.

Jednak jeli zamiast wskazywa na adres IP, administrator systemu wskazuje na **usug zewntrzn za pomoc CNAME**, na przykad **subdomen na GitHubie** (`sohomdatta1.github.io`). Atakujcy mo偶e **utworzy swoj wasn stron zewntrzn** (w tym przypadku na GitHubie) i stwierdzi, 偶e `something.testing.com` wskazuje tam. Poniewa偶 **wildcard CNAME** si zgodzi, atakujcy bdzie m贸g **generowa dowolne subdomeny dla domeny ofiary, wskazujce na swoje strony**.

Przykad tej podatnoci mo偶na znale藕 w opisie CTF: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Wykorzystywanie przejcia subdomeny

Przejcie subdomeny to w zasadzie podrobienie DNS dla konkretnej domeny w caym internecie, umo偶liwiajce atakujcym ustawienie rekord贸w A dla domeny, co powoduje wywietlanie treci z serwera atakujcego w przegldarkach. Ta **transparentno** w przegldarkach sprawia, 偶e domeny s podatne na phishing. Atakujcy mog wykorzysta [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) lub [_Doppelganger domains_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) w tym celu. Szczeg贸lnie nara偶one s domeny, w kt贸rych adres URL w wiadomoci phishingowej wydaje si prawidowy, wprowadzajc w bd u偶ytkownik贸w i unikajc filtr贸w antyspamowych ze wzgldu na inherentne zaufanie do domeny.

Sprawd藕 ten [post dla dalszych szczeg贸贸w](https://0xpatrik.com/subdomain-takeover/)

### **Certyfikaty SSL**
Certyfikaty SSL, jeli generowane przez atakujcych za pomoc usug takich jak [_Let's Encrypt_](https://letsencrypt.org/), dodaj wiarygodno tym faszywym domenom, sprawiajc, 偶e ataki phishingowe s bardziej przekonujce.

### **Bezpieczestwo plik贸w cookie i transparentno przegldarki**
Transparentno przegldarki dotyczy r贸wnie偶 bezpieczestwa plik贸w cookie, kt贸re s regulowane przez zasady takie jak [Same-origin policy](https://en.wikipedia.org/wiki/Same-origin_policy). Pliki cookie, czsto u偶ywane do zarzdzania sesjami i przechowywania token贸w logowania, mog by wykorzystane przez przejcie subdomeny. Atakujcy mog **zbiera pliki cookie sesji** po prostu kierujc u偶ytkownik贸w na skompromitowan subdomen, nara偶ajc dane u偶ytkownik贸w i prywatno.

### **E-maile i przejcie subdomeny**
Innym aspektem przejcia subdomeny s usugi pocztowe. Atakujcy mog manipulowa **rekordami MX**, aby odbiera lub wysya e-maile z prawidowej subdomeny, zwikszajc skuteczno atak贸w phishingowych.

### **Wy偶sze ryzyko**
Dodatkowe ryzyko obejmuje przejcie rekordu **NS**. Jeli atakujcy uzyska kontrol nad jednym rekordem NS domeny, mo偶e kierowa cz ruchu do serwera znajdujcego si pod jego kontrol. To ryzyko wzrasta, jeli atakujcy ustawia wysokie **TTL (Time to Live)** dla rekord贸w DNS, przedu偶ajc czas trwania ataku.

### Podatno rekordu CNAME
Atakujcy mog wykorzysta nieu偶ywane rekordy CNAME wskazujce na zewntrzne usugi, kt贸re nie s ju偶 u偶ywane lub zostay wycofane. Pozwala to im utworzy stron pod zaufan domen, uatwiajc phishing lub rozpowszechnianie zoliwego oprogramowania.

### **Strategie agodzenia**
Strategie agodzenia obejmuj:
1. **Usunicie podatnych rekord贸w DNS** - Jest to skuteczne, jeli subdomena nie jest ju偶 potrzebna.
2. **Zarejestrowanie nazwy domeny** - Zarejestrowanie zasobu u odpowiedniego dostawcy chmury lub ponowne zakupienie wygasej domeny.
3. **Regularne monitorowanie podatnoci** - Narzdzia takie jak [aquatone](https://github.com/michenriksen/aquatone) mog pom贸c w identyfikacji podatnych domen. Organizacje powinny r贸wnie偶 przeglda swoje procesy zarzdzania infrastruktur, zapewniajc, 偶e tworzenie rekord贸w DNS jest ostatnim krokiem w tworzeniu zasob贸w i pierwszym krokiem w ich usuwaniu.

Dla dostawc贸w chmury istotne jest zweryfikowanie wasnoci domeny w celu zapobie偶enia przejciu subdomeny. Niekt贸re z nich, takie jak [GitLab](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), rozpoznaj ten problem i wdro偶yy mechanizmy weryfikacji domeny.

## Odwoania
* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa zadania** przy u偶yciu najbardziej zaawansowanych narzdzi spoecznociowych na wiecie.\
Zdobd藕 dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy **reklam swojej firmy w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
