# Wstrzykiwanie e-maili

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby Å‚atwo tworzyÄ‡ i **automatyzowaÄ‡ przepÅ‚ywy pracy** z wykorzystaniem najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ciowych na Å›wiecie.\
Otrzymaj dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Zacznij od zera i zostaÅ„ ekspertem AWS z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na githubie.

</details>

## Wstrzykiwanie w wysÅ‚any e-mail

### Wstrzykiwanie Cc i Bcc po argumencie nadawcy
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
WiadomoÅ›Ä‡ zostanie wysÅ‚ana do kont odbiorcy i odbiorcy1.

### WstrzykniÄ™cie argumentu
```
From:sender@domain.com%0ATo:attacker@domain.com
```
### WstrzykniÄ™cie argumentu Temat
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
### Zmiana treÅ›ci wiadomoÅ›ci

Wstrzyknij dwie linie odstÄ™pu, a nastÄ™pnie napisz swojÄ… wiadomoÅ›Ä‡, aby zmieniÄ‡ treÅ›Ä‡ wiadomoÅ›ci.
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### Wykorzystanie funkcji PHP mail()
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### 5. parametr ($additional\_parameters)

Ta sekcja bÄ™dzie oparta na **sposobie naduÅ¼ycia tego parametru zakÅ‚adajÄ…c, Å¼e atakujÄ…cy go kontroluje**.

Ten parametr zostanie dodany do wiersza poleceÅ„, ktÃ³ry PHP bÄ™dzie uÅ¼ywaÅ‚ do wywoÅ‚ania binarnego sendmail. JednakÅ¼e, zostanie zdezynfekowany za pomocÄ… funkcji `escapeshellcmd($additional_parameters)`.

AtakujÄ…cy moÅ¼e **wstrzyknÄ…Ä‡ dodatkowe parametry dla sendmail** w tym przypadku.

#### RÃ³Å¼nice w implementacji /usr/sbin/sendmail

Interfejs **sendmail** jest **dostarczany przez oprogramowanie pocztowe MTA** (Sendmail, Postfix, Exim itp.) zainstalowane w systemie. ChociaÅ¼ **podstawowa funkcjonalnoÅ›Ä‡** (takie jak parametry -t -i -f) pozostaje **taka sama** ze wzglÄ™dÃ³w kompatybilnoÅ›ci, **inne funkcje i parametry** rÃ³Å¼niÄ… siÄ™ znacznie w zaleÅ¼noÅ›ci od zainstalowanego MTA.

Oto kilka przykÅ‚adÃ³w rÃ³Å¼nych stron podrÄ™cznika polecenia sendmail:

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

W zaleÅ¼noÅ›ci od **pochodzenia binarnego sendmail** odkryto rÃ³Å¼ne opcje naduÅ¼ycia ich i **wyciek plikÃ³w lub nawet wykonanie dowolnych poleceÅ„**. SprawdÅº jak to zrobiÄ‡ w [**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)

## Wstrzykiwanie w nazwÄ™ e-mail

### PominiÄ™te czÄ™Å›ci e-maila

Symbole: **+, -** i **{}** w rzadkich przypadkach mogÄ… byÄ‡ uÅ¼ywane do oznaczania i sÄ… ignorowane przez wiÄ™kszoÅ›Ä‡ serwerÃ³w pocztowych

* Np. john.doe+intigriti@example.com â†’ john.doe@example.com

**Komentarze miÄ™dzy nawiasami ()** na poczÄ…tku lub na koÅ„cu rÃ³wnieÅ¼ bÄ™dÄ… ignorowane

* Np. john.doe(intigriti)@example.com â†’ john.doe@example.com

### OminiÄ™cie biaÅ‚ej listy

<figure><img src="../.gitbook/assets/image (4) (6).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### Cytaty

<figure><img src="../.gitbook/assets/image (6) (4).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### Adresy IP

MoÅ¼esz rÃ³wnieÅ¼ uÅ¼ywaÄ‡ adresÃ³w IP jako nazwÄ™ domeny miÄ™dzy nawiasami kwadratowymi:

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### Inne podatnoÅ›ci

![https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](<../.gitbook/assets/image (296).png>)

## SSO zewnÄ™trzny

### XSS

NiektÃ³re usÅ‚ugi takie jak **github** lub **salesforce pozwalajÄ…** na utworzenie **adresu e-mail z Å‚adunkami XSS**. JeÅ›li moÅ¼esz **uÅ¼yÄ‡ tych dostawcÃ³w do logowania siÄ™ na inne usÅ‚ugi** i te usÅ‚ugi **nie dezynfekujÄ…** poprawnie adresu e-mail, moÅ¼esz spowodowaÄ‡ **XSS**.

### PrzejÄ™cie konta

JeÅ›li **usÅ‚uga SSO** pozwala na **utworzenie konta bez weryfikacji podanego adresu e-mail** (tak jak **salesforce**) a nastÄ™pnie moÅ¼esz uÅ¼yÄ‡ tego konta do **zalogowania siÄ™ na innÄ… usÅ‚ugÄ™**, ktÃ³ra **ufa** salesforce, moÅ¼esz uzyskaÄ‡ dostÄ™p do dowolnego konta.\
_ZauwaÅ¼, Å¼e salesforce wskazuje, czy podany adres e-mail zostaÅ‚ zweryfikowany czy nie, wiÄ™c aplikacja powinna uwzglÄ™dniÄ‡ tÄ™ informacjÄ™._

## OdpowiedÅº do

MoÅ¼esz wysÅ‚aÄ‡ e-mail uÅ¼ywajÄ…c _**Od: firma.com**_ i _**Odpowiedz do: atakujÄ…cy.com**_ i jeÅ›li zostanie wysÅ‚ana **automatyczna odpowiedÅº** z powodu wysÅ‚ania e-maila **z** wewnÄ™trznego adresu, **atakujÄ…cy** moÅ¼e byÄ‡ w stanie **otrzymaÄ‡** tÄ™ **odpowiedÅº**.

## WskaÅºnik odrzuceÅ„

Pewne usÅ‚ugi, takie jak AWS, implementujÄ… prÃ³g znanego jako **WskaÅºnik odrzuceÅ„**, zazwyczaj ustawiony na 10%. Jest to istotna metryka, zwÅ‚aszcza dla usÅ‚ug dostarczania e-maili. Przekroczenie tego wskaÅºnika moÅ¼e spowodowaÄ‡ zawieszenie lub zablokowanie usÅ‚ugi, takiej jak usÅ‚uga e-mailowa AWS.

**Twardy odrzut** odnosi siÄ™ do **e-maila**, ktÃ³ry zostaÅ‚ zwrÃ³cony do nadawcy, poniewaÅ¼ adresat jest nieprawidÅ‚owy lub nieistniejÄ…cy. MoÅ¼e to wystÄ…piÄ‡ z rÃ³Å¼nych powodÃ³w, takich jak wysÅ‚anie e-maila na nieistniejÄ…cy adres, domenÄ™, ktÃ³ra nie istnieje, lub odmowÄ™ serwera odbiorcy przyjÄ™cia **e-maili**.

W kontekÅ›cie AWS, jeÅ›li wysyÅ‚asz 1000 e-maili i 100 z nich koÅ„czy siÄ™ twardymi odrzutami (z powodu takich powodÃ³w jak nieprawidÅ‚owe adresy lub domeny), oznacza to wskaÅºnik twardych odrzutÃ³w wynoszÄ…cy 10%. OsiÄ…gniÄ™cie lub przekroczenie tego wskaÅºnika moÅ¼e spowodowaÄ‡ zablokowanie lub zawieszenie zdolnoÅ›ci do wysyÅ‚ania e-maili przez AWS SES (Simple Email Service).

Zachowanie niskiego wskaÅºnika twardych odrzutÃ³w jest kluczowe dla zapewnienia nieprzerwanej usÅ‚ugi e-mailowej i utrzymania reputacji nadawcy. Monitorowanie i zarzÄ…dzanie jakoÅ›ciÄ… adresÃ³w e-mail na listach mailingowych moÅ¼e znaczÄ…co pomÃ³c w osiÄ…gniÄ™ciu tego celu.

Aby uzyskaÄ‡ bardziej szczegÃ³Å‚owe informacje, moÅ¼na odwoÅ‚aÄ‡ siÄ™ do oficjalnej dokumentacji AWS dotyczÄ…cej obsÅ‚ugi odrzuceÅ„ i skarg [AWS SES Bounce Handling](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/notification-contents.html#bounce-types).

## Referencje

* [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
* [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
* [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
* [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF** SprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**Grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) do Å‚atwego tworzenia i **automatyzacji workflowÃ³w** z wykorzystaniem najbardziej zaawansowanych narzÄ™dzi spoÅ‚ecznoÅ›ciowych na Å›wiecie.\
ZdobÄ…dÅº dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
