# E-posta EnjeksiyonlarÄ±

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kullanarak dÃ¼nyanÄ±n en geliÅŸmiÅŸ topluluk araÃ§larÄ± tarafÄ±ndan desteklenen iÅŸ akÄ±ÅŸlarÄ±nÄ± kolayca oluÅŸturun ve otomatikleÅŸtirin.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'ler**](https://opensea.io/collection/the-peass-family)
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## GÃ¶nderilen e-postaya enjekte edin

### GÃ¶nderen argÃ¼manÄ±ndan sonra Cc ve Bcc enjekte edin
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
### ArgÃ¼man Enjeksiyonu

Mesaj, alÄ±cÄ± ve alÄ±cÄ±1 hesaplarÄ±na gÃ¶nderilecektir.
```
From:sender@domain.com%0ATo:attacker@domain.com
```
The message will be sent to the original recipient and the attacker account.

### Konu argÃ¼manÄ± enjekte edin
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
Sahte konu, orijinal konuya eklenir ve bazÄ± durumlarda onun yerine geÃ§er. Bu, posta servisinin davranÄ±ÅŸÄ±na baÄŸlÄ±dÄ±r.

### MesajÄ±n gÃ¶vdesini deÄŸiÅŸtirin

Ä°ki satÄ±r boÅŸluk ekleyin, ardÄ±ndan mesajÄ±n gÃ¶vdesini deÄŸiÅŸtirmek iÃ§in mesajÄ±nÄ±zÄ± yazÄ±n.
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### PHP mail() fonksiyonunun sÃ¶mÃ¼rÃ¼lmesi

PHP'de, `mail()` fonksiyonu, e-posta gÃ¶ndermek iÃ§in kullanÄ±lan bir iÅŸlevdir. Ancak, bu fonksiyonun yanlÄ±ÅŸ kullanÄ±lmasÄ±, e-posta enjeksiyonu saldÄ±rÄ±larÄ±na yol aÃ§abilir. E-posta enjeksiyonu saldÄ±rÄ±larÄ±, kÃ¶tÃ¼ niyetli kullanÄ±cÄ±larÄ±n hedef sisteme zararlÄ± kod enjekte etmesine olanak tanÄ±r.

E-posta enjeksiyonu saldÄ±rÄ±larÄ±, genellikle kullanÄ±cÄ± tarafÄ±ndan saÄŸlanan verilerin doÄŸrudan e-posta iÃ§eriÄŸine eklenmesiyle gerÃ§ekleÅŸtirilir. Bu, saldÄ±rganÄ±n e-posta gÃ¶vdesine ek komutlar veya ek e-posta baÅŸlÄ±klarÄ± eklemesine olanak tanÄ±r.

Bu saldÄ±rÄ±yÄ± gerÃ§ekleÅŸtirmek iÃ§in, saldÄ±rganÄ±n hedef sisteme zararlÄ± bir e-posta gÃ¶ndermesi gerekmektedir. ZararlÄ± e-posta, hedef sistemin e-posta sunucusu tarafÄ±ndan iÅŸlenirken, saldÄ±rganÄ±n istediÄŸi komutlarÄ± Ã§alÄ±ÅŸtÄ±rmasÄ±na olanak tanÄ±r.

E-posta enjeksiyonu saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in, kullanÄ±cÄ± tarafÄ±ndan saÄŸlanan verilerin doÄŸru bir ÅŸekilde doÄŸrulanmasÄ± ve filtrelenmesi Ã¶nemlidir. E-posta adresleri, baÅŸlÄ±klar ve gÃ¶vde iÃ§eriÄŸi gibi verilerin doÄŸrulanmasÄ± ve gerektiÄŸinde temizlenmesi gerekmektedir.

AyrÄ±ca, `mail()` fonksiyonunun gÃ¼venli bir ÅŸekilde kullanÄ±lmasÄ± iÃ§in, e-posta adreslerinin ve diÄŸer verilerin doÄŸru bir ÅŸekilde biÃ§imlendirilmesi gerekmektedir. Ã–rneÄŸin, e-posta adreslerinin geÃ§erli bir formatta olduÄŸunu doÄŸrulamak iÃ§in uygun doÄŸrulama yÃ¶ntemleri kullanÄ±lmalÄ±dÄ±r.

E-posta enjeksiyonu saldÄ±rÄ±larÄ±na karÅŸÄ± korunmak iÃ§in, gÃ¼venlik aÃ§Ä±klarÄ±nÄ± tespit etmek ve dÃ¼zeltmek iÃ§in dÃ¼zenli bir gÃ¼venlik denetimi yapÄ±lmasÄ± Ã¶nemlidir. AyrÄ±ca, gÃ¼ncel ve gÃ¼venli bir PHP sÃ¼rÃ¼mÃ¼nÃ¼n kullanÄ±lmasÄ± da Ã¶nemlidir, Ã§Ã¼nkÃ¼ daha eski sÃ¼rÃ¼mler genellikle bu tÃ¼r saldÄ±rÄ±lara daha savunmasÄ±zdÄ±r.
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### 5. parametre ($additional\_parameters)

Bu bÃ¶lÃ¼m, bir saldÄ±rganÄ±n bunu kontrol ettiÄŸi varsayÄ±larak bu parametreyi nasÄ±l istismar edeceÄŸi Ã¼zerine olacak.

Bu parametre, PHP'nin, ikili sendmail'i Ã§aÄŸÄ±rmak iÃ§in kullanacaÄŸÄ± komut satÄ±rÄ±na eklenecektir. Bununla birlikte, `escapeshellcmd($additional_parameters)` iÅŸleviyle temizlenecektir.

Bir saldÄ±rgan, bu durumda sendmail iÃ§in Ã§Ä±karÄ±lacak parametreleri enjekte edebilir.

#### /usr/sbin/sendmail'in uygulama farklÄ±lÄ±klarÄ±

**sendmail** arayÃ¼zÃ¼, sistemde yÃ¼klÃ¼ olan MTA e-posta yazÄ±lÄ±mÄ± (Sendmail, Postfix, Exim vb.) tarafÄ±ndan saÄŸlanÄ±r. Temel iÅŸlevsellik (-t -i -f parametreleri gibi) uyumluluk nedenleriyle aynÄ± kalÄ±rken, diÄŸer iÅŸlevler ve parametreler, yÃ¼klÃ¼ olan MTA'ya baÄŸlÄ± olarak bÃ¼yÃ¼k Ã¶lÃ§Ã¼de deÄŸiÅŸir.

Ä°ÅŸte sendmail komutu/arayÃ¼zÃ¼nÃ¼n farklÄ± man sayfalarÄ±ndan birkaÃ§ Ã¶rnek:

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

Sendmail'in kÃ¶kenine baÄŸlÄ± olarak, bunlarÄ± kÃ¶tÃ¼ye kullanmak ve dosyalarÄ± sÄ±zdÄ±rmak veya hatta keyfi komutlar Ã§alÄ±ÅŸtÄ±rmak iÃ§in farklÄ± seÃ§enekler keÅŸfedilmiÅŸtir. NasÄ±l yapÄ±ldÄ±ÄŸÄ±nÄ± [buradan](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html) kontrol edin.

## E-posta adÄ±na enjekte etme

### E-postanÄ±n yoksayÄ±lan kÄ±sÄ±mlarÄ±

**+, -** ve **{}** sembolleri nadir durumlarda etiketleme iÃ§in kullanÄ±labilir ve Ã§oÄŸu e-posta sunucusu tarafÄ±ndan yoksayÄ±lÄ±r.

* Ã–r. john.doe+intigriti@example.com â†’ john.doe@example.com

BaÅŸlangÄ±Ã§ta veya sonunda **parantezler ()** arasÄ±ndaki yorumlar da yoksayÄ±lÄ±r.

* Ã–r. john.doe(intigriti)@example.com â†’ john.doe@example.com

### Beyaz liste atlatma

<figure><img src="../.gitbook/assets/image (4) (6).png" alt="https://www.youtube.com/watch?app=desktop&v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### AlÄ±ntÄ±lar

<figure><img src="../.gitbook/assets/image (6) (4).png" alt="https://www.youtube.com/watch?app=desktop&v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### IP'ler

Kare parantezler arasÄ±nda IP'leri alan adÄ± olarak da kullanabilirsiniz:

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### DiÄŸer zafiyetler

![https://www.youtube.com/watch?app=desktop&v=4ZsTKvfP1g0](<../.gitbook/assets/image (296).png>)

## ÃœÃ§Ã¼ncÃ¼ taraf SSO

### XSS

**Github** veya **salesforce** gibi bazÄ± hizmetler, Ã¼zerinde XSS yÃ¼kleri olan bir e-posta adresi oluÅŸturmanÄ±za izin verir. Bu saÄŸlayÄ±cÄ±larÄ± baÅŸka hizmetlere giriÅŸ yapmak iÃ§in kullanabilir ve bu hizmetler e-postayÄ± doÄŸru bir ÅŸekilde temizlemiyorsa XSS oluÅŸturabilirsiniz.

### Hesap Ele GeÃ§irme

Bir **SSO hizmeti**, verilen e-posta adresini doÄŸrulamadan bir hesap oluÅŸturmanÄ±za izin veriyorsa (Ã¶rneÄŸin **salesforce**) ve daha sonra bu hesabÄ± salesforce'a gÃ¼venen baÅŸka bir hizmete giriÅŸ yapmak iÃ§in kullanabilirseniz, herhangi bir hesaba eriÅŸebilirsiniz.\
Salesforce, verilen e-postanÄ±n doÄŸrulanÄ±p doÄŸrulanmadÄ±ÄŸÄ±nÄ± belirtir, ancak uygulama bu bilgiyi dikkate almalÄ±dÄ±r.

## YanÄ±t Adresi

E-posta gÃ¶nderirken _**Kimden: sirket.com**_ ve _**YanÄ±t Adresi: saldÄ±rgan.com**_ kullanabilirsiniz ve e-posta **iÃ§eriden** gÃ¶nderildiÄŸi iÃ§in herhangi bir **otomatik yanÄ±t** gÃ¶nderilirse, **saldÄ±rgan** bu **yanÄ±tÄ± alabilir**.

## Sert Geri DÃ¶nÃ¼ÅŸ OranÄ±

AWS gibi bazÄ± hizmetler, genellikle %10 olarak ayarlanan bir **Sert Geri DÃ¶nÃ¼ÅŸ OranÄ±** adÄ± verilen bir eÅŸik uygular. Bu, Ã¶zellikle e-posta teslimat hizmetleri iÃ§in kritik bir Ã¶lÃ§Ã¼ttÃ¼r. Bu oran aÅŸÄ±ldÄ±ÄŸÄ±nda, AWS'nin e-posta hizmeti gibi bir hizmet, e-posta gÃ¶nderme yeteneklerinizi askÄ±ya alabilir veya engelleyebilir.

**Sert geri dÃ¶nÃ¼ÅŸ**, alÄ±cÄ±nÄ±n adresinin geÃ§ersiz veya mevcut olmadÄ±ÄŸÄ± iÃ§in gÃ¶nderenin geri dÃ¶ndÃ¼rÃ¼len bir e-postasÄ±dÄ±r. Bu, e-postanÄ±n mevcut olmayan bir adrese, gerÃ§ek olmayan bir alan adÄ±na veya alÄ±cÄ± sunucusunun e-postalarÄ± kabul etmeyi reddetmesi gibi Ã§eÅŸitli nedenlerle olabilir.

AWS baÄŸlamÄ±nda, 1000 e-posta gÃ¶nderirseniz ve bunlardan 100'Ã¼ sert geri dÃ¶nÃ¼ÅŸlere neden olursa (geÃ§ersiz adresler veya alanlar gibi nedenlerle), bu %10'luk bir sert geri dÃ¶nÃ¼ÅŸ oranÄ± anlamÄ±na gelir. Bu orana ulaÅŸmak veya aÅŸmak, AWS SES (Basit E-posta Hizmeti)'nin e-posta gÃ¶nderme yeteneklerinizi engellemesine veya askÄ±ya almasÄ±na neden olabilir.

Kesintisiz e-posta hizmeti saÄŸlamak ve gÃ¶nderen itibarÄ±nÄ± korumak iÃ§in dÃ¼ÅŸÃ¼k bir sert geri dÃ¶nÃ¼ÅŸ oranÄ±nÄ± korumak Ã¶nemlidir. Posta listelerinizdeki e-posta adreslerinin kalitesini izlemek ve yÃ¶netmek, bunu baÅŸarma konusunda Ã¶nemli Ã¶lÃ§Ã¼de yardÄ±mcÄ± olabilir.

Daha ayrÄ±ntÄ±lÄ± bilgi iÃ§in AWS'nin sert geri dÃ¶nÃ¼ÅŸ ve ÅŸikayetlerle ilgili resmi belgelerine baÅŸvurulabilir: [AWS SES Sert Geri DÃ¶nÃ¼ÅŸ Ä°ÅŸleme](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/notification-contents.html#bounce-types).

## Referanslar

* [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
* [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
* [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
* [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **tanÄ±tmak veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerine**](https://peass.creator-spring.com) gÃ¶z atÄ±n.
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonum
