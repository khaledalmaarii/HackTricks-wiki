# Email Injections

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da biste lako izgradili i **automatizovali radne tokove** pokretane najnaprednijim alatima zajednice na svetu.\
Dobijte pristup danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Ubacivanje u poslati e-mail

### Ubacivanje Cc i Bcc nakon argumenta poÅ¡iljaoca
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
Poruka Ä‡e biti poslata na naloge primaoca i primaoca1. 

### Ubacivanje argumenata
```
From:sender@domain.com%0ATo:attacker@domain.com
```
### Ubaci argument Predmet
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
### Promena tela poruke

Ubacite dva reda razmaka, zatim napiÅ¡ite svoju poruku kako biste promenili telo poruke.
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### IskoriÅ¡Ä‡avanje funkcije PHP mail()
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### 5. parametar ($dodatni_parametri)

Ova sekcija Ä‡e se bazirati na **kako zloupotrebiti ovaj parametar pretpostavljajuÄ‡i da napadaÄ ima kontrolu nad njim**.

Ovaj parametar Ä‡e biti dodat u komandnu liniju koju Ä‡e PHP koristiti za pozivanje binarnog sendmail-a. MeÄ‘utim, biÄ‡e saniran funkcijom `escapeshellcmd($dodatni_parametri)`.

NapadaÄ moÅ¾e **ubaciti dodatne parametre za sendmail** u ovom sluÄaju.

#### Razlike u implementaciji /usr/sbin/sendmail

**sendmail** interfejs je **pruÅ¾en od strane MTA softvera za e-poÅ¡tu** (Sendmail, Postfix, Exim itd.) instaliranog na sistemu. Iako **osnovne funkcionalnosti** (kao Å¡to su -t -i -f parametri) ostaju **iste** iz razloga kompatibilnosti, **ostale funkcije i parametri** se razlikuju znaÄajno u zavisnosti od instaliranog MTA.

Evo nekoliko primera razliÄitih stranica sa uputstvima za sendmail komandu/interfejs:

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

Zavisno od **porekla sendmail** binarnog fajla, otkrivene su razliÄite opcije za zloupotrebu i **curenje fajlova ili Äak izvrÅ¡avanje proizvoljnih komandi**. Proverite kako na [**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)

## Ubacivanje u ime e-poÅ¡te

### Ignorisani delovi e-poÅ¡te

Simboli: **+, -** i **{}** u retkim sluÄajevima mogu se koristiti za oznaÄavanje i biti ignorisani od strane veÄ‡ine e-poÅ¡tanskih servera

* Npr. john.doe+intigriti@example.com â†’ john.doe@example.com

**Komentari izmeÄ‘u zagrada ()** na poÄetku ili kraju takoÄ‘e Ä‡e biti ignorisani

* Npr. john.doe(intigriti)@example.com â†’ john.doe@example.com

### Bypass belih lista

<figure><img src="../.gitbook/assets/image (4) (6).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### Navodnici

<figure><img src="../.gitbook/assets/image (6) (4).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### IP adrese

TakoÄ‘e moÅ¾ete koristiti IP adrese kao imena domena izmeÄ‘u uglatih zagrada:

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### Ostale ranjivosti

![https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](<../.gitbook/assets/image (296).png>)

## SSO treÄ‡e strane

### XSS

Neke usluge poput **github** ili **salesforce dozvoljavaju** vam da kreirate **e-adresu sa XSS payload-om**. Ako moÅ¾ete **koristiti ove provajdere za prijavu na druge usluge** i ove usluge **ne saniraju** ispravno e-poÅ¡tu, moÅ¾ete izazvati **XSS**.

### Preuzimanje naloga

Ako **SSO usluga** dozvoljava da **kreirate nalog bez provere date e-adrese** (kao **salesforce**) i zatim moÅ¾ete koristiti taj nalog za **prijavu na drugu uslugu** koja **veruje** salesforce-u, moÅ¾ete pristupiti bilo kom nalogu.\
_Napomena da salesforce oznaÄava da li je data e-adresa verifikovana ili ne, tako da bi aplikacija trebalo da uzme u obzir ovu informaciju._

## Odgovori

MoÅ¾ete poslati e-poÅ¡tu koristeÄ‡i _**Od: company.com**_ i _**Odgovori: attacker.com**_ i ako se bilo koji **automatski odgovor** poÅ¡alje zbog toga Å¡to je e-poÅ¡ta poslata **sa** interne adrese, **napadaÄ** moÅ¾e biti u moguÄ‡nosti da **primi** taj **odgovor**.

## Stopa tvrdog odbijanja

OdreÄ‘ene usluge, poput AWS-a, implementiraju prag poznat kao **Stopa tvrdog odbijanja**, obiÄno postavljen na 10%. Ovo je kljuÄna metrika, posebno za usluge isporuke e-poÅ¡te. Kada se ova stopa premaÅ¡i, usluga, poput AWS-ove usluge e-poÅ¡te, moÅ¾e biti suspendovana ili blokirana.

**Tvrdi odbijanje** se odnosi na **e-poÅ¡tu** koja je vraÄ‡ena poÅ¡iljaocu jer je adresa primaoca nevaÅ¾eÄ‡a ili nepostojeÄ‡a. Ovo se moÅ¾e desiti iz razliÄitih razloga, kao Å¡to je slanje e-poÅ¡te na nevaÅ¾eÄ‡u adresu, domen koji nije stvaran ili odbijanje servera primaoca da prihvati **e-poruke**.

U kontekstu AWS-a, ako poÅ¡aljete 1000 e-poruka i 100 od njih rezultira tvrdim odbijanjem (zbog razloga poput nevaÅ¾eÄ‡ih adresa ili domena), to bi znaÄilo stopu tvrdog odbijanja od 10%. Dostizanje ili premaÅ¡ivanje ove stope moÅ¾e pokrenuti blokiranje ili suspenziju vaÅ¡ih sposobnosti slanja e-poÅ¡te putem AWS SES (Simple Email Service).

VaÅ¾no je odrÅ¾avati nisku stopu tvrdog odbijanja kako bi se osigurala neprekidna usluga e-poÅ¡te i oÄuvala reputacija poÅ¡iljaoca. PraÄ‡enje i upravljanje kvalitetom adresa e-poÅ¡te na vaÅ¡im listama za slanje moÅ¾e znaÄajno pomoÄ‡i u postizanju ovog cilja.

Za detaljnije informacije, moÅ¾e se pogledati zvaniÄna dokumentacija AWS-a o rukovanju odbijanjima i prigovorima na [AWS SES Rukovanje odbijanjima](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/notification-contents.html#bounce-types).

## Reference

* [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
* [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
* [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
* [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da lako izgradite i **automatizujete radne tokove** pokretane najnaprednijim alatima zajednice na svetu.\
Pristupite danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
