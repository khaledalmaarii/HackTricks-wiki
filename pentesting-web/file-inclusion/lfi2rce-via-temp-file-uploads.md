{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}



**√úberpr√ºfe die vollst√§ndigen Details dieser Technik unter [https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf](https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf)**

## **PHP Datei-Uploads**

Wenn eine **PHP**-Engine eine **POST-Anfrage** mit Dateien im Format gem√§√ü RFC 1867 erh√§lt, generiert sie tempor√§re Dateien, um die hochgeladenen Daten zu speichern. Diese Dateien sind entscheidend f√ºr die Handhabung von Datei-Uploads in PHP-Skripten. Die Funktion `move_uploaded_file` muss verwendet werden, um diese tempor√§ren Dateien an einen gew√ºnschten Ort zu verschieben, wenn eine dauerhafte Speicherung √ºber die Ausf√ºhrung des Skripts hinaus erforderlich ist. Nach der Ausf√ºhrung l√∂scht PHP automatisch alle verbleibenden tempor√§ren Dateien.

{% hint style="info" %}
**Sicherheitswarnung: Angreifer, die sich der Position der tempor√§ren Dateien bewusst sind, k√∂nnten eine Local File Inclusion-Schwachstelle ausnutzen, um Code auszuf√ºhren, indem sie auf die Datei w√§hrend des Uploads zugreifen.**
{% endhint %}

Die Herausforderung f√ºr unbefugten Zugriff besteht darin, den Namen der tempor√§ren Datei vorherzusagen, der absichtlich randomisiert ist.

#### Ausnutzung auf Windows-Systemen

Auf Windows generiert PHP tempor√§re Dateinamen mit der Funktion `GetTempFileName`, was zu einem Muster wie `<path>\<pre><uuuu>.TMP` f√ºhrt. Bemerkenswert:

- Der Standardpfad ist typischerweise `C:\Windows\Temp`.
- Das Pr√§fix ist normalerweise "php".
- Das `<uuuu>` steht f√ºr einen einzigartigen hexadezimalen Wert. Entscheidend ist, dass aufgrund der Einschr√§nkung der Funktion nur die unteren 16 Bits verwendet werden, was maximal 65.535 einzigartige Namen mit konstantem Pfad und Pr√§fix erm√∂glicht, wodurch Brute-Force-Angriffe machbar sind.

Dar√ºber hinaus ist der Ausnutzungsprozess auf Windows-Systemen vereinfacht. Eine Besonderheit in der Funktion `FindFirstFile` erlaubt die Verwendung von Platzhaltern in Local File Inclusion (LFI)-Pfaden. Dies erm√∂glicht das Erstellen eines Include-Pfades wie folgt, um die tempor√§re Datei zu finden:
```
http://site/vuln.php?inc=c:\windows\temp\php<<
```
In bestimmten Situationen kann eine spezifischere Maske (wie `php1<<` oder `phpA<<`) erforderlich sein. Man kann systematisch diese Masken ausprobieren, um die hochgeladene tempor√§re Datei zu entdecken.

#### Ausnutzung auf GNU/Linux-Systemen

F√ºr GNU/Linux-Systeme ist die Zuf√§lligkeit bei der Benennung tempor√§rer Dateien robust, wodurch die Namen weder vorhersehbar noch anf√§llig f√ºr Brute-Force-Angriffe sind. Weitere Details sind in der referenzierten Dokumentation zu finden.
