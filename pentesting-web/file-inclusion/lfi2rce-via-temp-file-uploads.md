{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}



**Sprawd藕 pene szczeg贸y tej techniki w [https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf](https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf)**

## **Przesyanie plik贸w PHP**

Gdy silnik **PHP** otrzymuje **偶danie POST** zawierajce pliki sformatowane zgodnie z RFC 1867, generuje pliki tymczasowe do przechowywania przesanych danych. Pliki te s kluczowe dla obsugi przesyania plik贸w w skryptach PHP. Funkcja `move_uploaded_file` musi by u偶yta do przeniesienia tych plik贸w tymczasowych do po偶danej lokalizacji, jeli potrzebne jest trwae przechowywanie poza wykonaniem skryptu. Po zakoczeniu wykonania PHP automatycznie usuwa wszelkie pozostae pliki tymczasowe.

{% hint style="info" %}
**Alert bezpieczestwa: Atakujcy, wiadomi lokalizacji plik贸w tymczasowych, mog wykorzysta luk w Local File Inclusion, aby wykona kod, uzyskujc dostp do pliku podczas przesyania.**
{% endhint %}

Wyzwanie zwizane z nieautoryzowanym dostpem polega na przewidywaniu nazwy pliku tymczasowego, kt贸ra jest celowo losowa.

#### Wykorzystanie na systemach Windows

Na Windows PHP generuje nazwy plik贸w tymczasowych za pomoc funkcji `GetTempFileName`, co skutkuje wzorem takim jak `<path>\<pre><uuuu>.TMP`. Warto zauwa偶y:

- Domylna cie偶ka to zazwyczaj `C:\Windows\Temp`.
- Prefiks to zazwyczaj "php".
- `<uuuu>` reprezentuje unikaln warto szesnastkow. Kluczowe jest to, 偶e z powodu ograniczenia funkcji, u偶ywane s tylko dolne 16 bit贸w, co pozwala na maksymalnie 65,535 unikalnych nazw przy staej cie偶ce i prefiksie, co czyni brute force wykonalnym.

Ponadto proces wykorzystania jest uproszczony na systemach Windows. Ciekawostk w funkcji `FindFirstFile` jest mo偶liwo u偶ycia symboli wieloznacznych w cie偶kach Local File Inclusion (LFI). Umo偶liwia to skonstruowanie cie偶ki do doczenia, takiej jak poni偶sza, aby zlokalizowa plik tymczasowy:
```
http://site/vuln.php?inc=c:\windows\temp\php<<
```
W niekt贸rych sytuacjach mo偶e by wymagana bardziej specyficzna maska (jak `php1<<` lub `phpA<<`). Mo偶na systematycznie pr贸bowa tych masek, aby odkry przesany plik tymczasowy.

#### Eksploatacja na systemach GNU/Linux

W systemach GNU/Linux losowo w nazewnictwie plik贸w tymczasowych jest solidna, co sprawia, 偶e nazwy s ani przewidywalne, ani podatne na ataki brute force. Dalsze szczeg贸y mo偶na znale藕 w odwoanej dokumentacji.
