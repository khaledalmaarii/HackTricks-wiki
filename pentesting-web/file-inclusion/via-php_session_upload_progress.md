# LFI2RCEë¥¼ í†µí•œ PHP\_SESSION\_UPLOAD\_PROGRESS

{% hint style="success" %}
AWS í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ ìš”ë ¹ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}

## ê¸°ë³¸ ì •ë³´

**ë¡œì»¬ íŒŒì¼ í¬í•¨**ì„ ë°œê²¬í–ˆì§€ë§Œ **ì„¸ì…˜ì´ ì—†ëŠ” ê²½ìš°**ì´ë©° `session.auto_start`ê°€ `Off`ì¸ ê²½ìš°ì—ë„ **`session.upload_progress.enabled`**ê°€ **`On`**ì´ê³  **`PHP_SESSION_UPLOAD_PROGRESS`**ë¥¼ **multipart POST** ë°ì´í„°ì— ì œê³µí•˜ë©´ PHPê°€ **ì„¸ì…˜ì„ í™œì„±í™”**í•©ë‹ˆë‹¤.
```bash
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -d 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -F 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'  -F 'file=@/etc/passwd'
$ ls -a /var/lib/php/sessions/
. .. sess_iamorange

In the last example the session will contain the string blahblahblah
```
**`PHP_SESSION_UPLOAD_PROGRESS`**ë¥¼ ì‚¬ìš©í•˜ë©´ **ì„¸ì…˜ ë‚´ë¶€ ë°ì´í„°ë¥¼ ì œì–´**í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì„¸ì…˜ íŒŒì¼ì„ í¬í•¨í•˜ë©´ ì œì–´í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„(ì˜ˆ: PHP ì‰˜ì½”ë“œ)ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="info" %}
ì¸í„°ë„·ì˜ ëŒ€ë¶€ë¶„ì˜ ììŠµì„œëŠ” ë””ë²„ê¹… ëª©ì ìœ¼ë¡œ `session.upload_progress.cleanup`ì„ `Off`ë¡œ ì„¤ì •í•˜ë„ë¡ ê¶Œì¥í•˜ì§€ë§Œ PHPì˜ ê¸°ë³¸ `session.upload_progress.cleanup`ì€ ì—¬ì „íˆ `On`ì…ë‹ˆë‹¤. ì´ëŠ” ì„¸ì…˜ì˜ ì—…ë¡œë“œ ì§„í–‰ ìƒí™©ì´ ê°€ëŠ¥í•œ í•œ ë¹¨ë¦¬ ì •ë¦¬ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ê²ƒì€ **ê²½ìŸ ì¡°ê±´(Race Condition)**ì´ ë  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### CTF

ì´ ê¸°ìˆ ì´ ì£¼ì„ ì²˜ë¦¬ëœ [**ì›ë³¸ CTF**](https://blog.orange.tw/2018/10/)ì—ì„œëŠ” ê²½ìŸ ì¡°ê±´ì„ ì•…ìš©í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•Šì•˜ìœ¼ë©° ë¡œë“œëœ ì½˜í…ì¸ ëŠ” `@<?php` ë¬¸ìì—´ë¡œ ì‹œì‘í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

`session.upload_progress.prefix`ì˜ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì¸í•´ **ì„¸ì…˜ íŒŒì¼ì€ ê·€ì°®ì€ ì ‘ë‘ì‚¬** `upload_progress_`ë¡œ ì‹œì‘í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `upload_progress_controlledcontentbyattacker`ì™€ ê°™ì´ ì‹œì‘í•©ë‹ˆë‹¤.

**ì´ˆê¸° ì ‘ë‘ì‚¬ë¥¼ ì œê±°í•˜ëŠ” ê¼¼ìˆ˜**ëŠ” í˜ì´ë¡œë“œë¥¼ **3ë²ˆ base64ë¡œ ì¸ì½”ë”©**í•œ ë‹¤ìŒ `convert.base64-decode` í•„í„°ë¥¼ í†µí•´ ë””ì½”ë”©í•˜ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” **base64 ë””ì½”ë”© ì‹œ PHPê°€ ì´ìƒí•œ ë¬¸ìë¥¼ ì œê±°**í•˜ê¸° ë•Œë¬¸ì—, 3ë²ˆ í›„ì—ëŠ” ê³µê²©ìê°€ **ë³´ë‚¸ í˜ì´ë¡œë“œë§Œ ë‚¨ê²Œ** ë©ë‹ˆë‹¤(ê·¸ë¦¬ê³  ê³µê²©ìëŠ” ì´ˆê¸° ë¶€ë¶„ì„ ì œì–´í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤).

ì›ë³¸ ê¸€ì—ì„œ ìì„¸í•œ ì •ë³´ í™•ì¸ [https://blog.orange.tw/2018/10/](https://blog.orange.tw/2018/10/) ë° ìµœì¢… ì•…ìš© [https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py](https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py)\
ë‹¤ë¥¸ ê¸€ì€ [https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/)

{% hint style="success" %}
AWS í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop) í™•ì¸!
* ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass) ì°¸ì—¬ ë˜ëŠ” **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** íŒ”ë¡œìš°**.
* [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—™ ë ˆí¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ ê³µìœ .

</details>
{% endhint %}
