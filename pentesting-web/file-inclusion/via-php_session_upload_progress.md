# LFI2RCEã‚’PHP\_SESSION\_UPLOAD\_PROGRESSã‚’ä»‹ã—ã¦å®Ÿè¡Œ

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**è³¼èª­ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨**HackTricks Cloud**ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦**ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰**ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

**ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒãªã**ã€`session.auto_start`ãŒ`Off`ã§ã‚ã£ã¦ã‚‚ã€**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ãŸå ´åˆã€**`session.upload_progress.enabled`**ãŒ**`On`**ã§ã‚ã‚Šã€**`PHP_SESSION_UPLOAD_PROGRESS`**ã‚’**ãƒãƒ«ãƒãƒ‘ãƒ¼ãƒˆPOST**ãƒ‡ãƒ¼ã‚¿ã§æä¾›ã™ã‚‹ã¨ã€PHPã¯**ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã¾ã™**ã€‚
```bash
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -d 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -F 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'  -F 'file=@/etc/passwd'
$ ls -a /var/lib/php/sessions/
. .. sess_iamorange

In the last example the session will contain the string blahblahblah
```
**`PHP_SESSION_UPLOAD_PROGRESS`**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€**ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ¶å¾¡**ã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚ã‚‹ã¨ã€åˆ¶å¾¡å¯èƒ½ãªéƒ¨åˆ†ï¼ˆãŸã¨ãˆã°ã€PHPã‚·ã‚§ãƒ«ã‚³ãƒ¼ãƒ‰ï¼‰ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% hint style="info" %}
ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ã»ã¨ã‚“ã©ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯ã€ãƒ‡ãƒãƒƒã‚°ç›®çš„ã§`session.upload_progress.cleanup`ã‚’`Off`ã«è¨­å®šã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€PHPã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`session.upload_progress.cleanup`ã¯ã¾ã `On`ã§ã™ã€‚ã¤ã¾ã‚Šã€ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²è¡ŒçŠ¶æ³ã¯ã§ãã‚‹ã ã‘æ—©ãã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã‚Œã¯**ç«¶åˆçŠ¶æ…‹**ã«ãªã‚Šã¾ã™ã€‚
{% endhint %}

### CTF

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹[**ã‚ªãƒªã‚¸ãƒŠãƒ«CTF**](https://blog.orange.tw/2018/10/)ã§ã¯ã€ç«¶åˆçŠ¶æ…‹ã‚’æ‚ªç”¨ã™ã‚‹ã ã‘ã§ã¯ä¸ååˆ†ã§ã€èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯`@<?php`ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

`session.upload_progress.prefix`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã«ã‚ˆã‚Šã€**SESSIONãƒ•ã‚¡ã‚¤ãƒ«ã¯å„ä»‹ãªæ¥é ­è¾** `upload_progress_`ã§å§‹ã¾ã‚Šã¾ã™ã€‚ä¾‹ï¼š`upload_progress_controlledcontentbyattacker`

**åˆæœŸæ¥é ­è¾ã‚’å‰Šé™¤**ã™ã‚‹ãƒˆãƒªãƒƒã‚¯ã¯ã€**ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’3å›base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰**ã—ã€ãã®å¾Œ`convert.base64-decode`ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä»‹ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã—ãŸã€‚ã“ã‚Œã¯ã€**base64ãƒ‡ã‚³ãƒ¼ãƒ‰æ™‚ã«PHPãŒå¥‡å¦™ãªæ–‡å­—ã‚’å‰Šé™¤**ã™ã‚‹ãŸã‚ã§ã™ã€‚ãã®ãŸã‚ã€3å›å¾Œã«ã¯ã€æ”»æ’ƒè€…ãŒ**é€ä¿¡ã—ãŸ** **ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã ã‘ãŒ** **æ®‹ã‚Š**ï¼ˆãã—ã¦æ”»æ’ƒè€…ãŒåˆæœŸéƒ¨åˆ†ã‚’åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼‰ã€‚

è©³ç´°ã¯ã‚ªãƒªã‚¸ãƒŠãƒ«ã®è§£èª¬[https://blog.orange.tw/2018/10/](https://blog.orange.tw/2018/10/)ãŠã‚ˆã³æœ€çµ‚çš„ãªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ[https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py](https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py)\
åˆ¥ã®è§£èª¬ã¯[https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
