# LFI2RCEë¥¼ í†µí•œ PHP_SESSION_UPLOAD_PROGRESS

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ìì‹ ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

**ë¡œì»¬ íŒŒì¼ ì¸í´ë£¨ì „**ì„ ë°œê²¬í–ˆì§€ë§Œ **ì„¸ì…˜ì´ ì—†ëŠ” ê²½ìš°**ì´ë©° `session.auto_start`ê°€ `Off`ì¸ ê²½ìš°ì—ë„ **`session.upload_progress.enabled`**ê°€ **`On`**ì´ê³  **`PHP_SESSION_UPLOAD_PROGRESS`**ë¥¼ **multipart POST** ë°ì´í„°ì—ì„œ ì œê³µí•˜ë©´ PHPê°€ **ì„¸ì…˜ì„ í™œì„±í™”**í•©ë‹ˆë‹¤.
```bash
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -d 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -F 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'  -F 'file=@/etc/passwd'
$ ls -a /var/lib/php/sessions/
. .. sess_iamorange

In the last example the session will contain the string blahblahblah
```
**`PHP_SESSION_UPLOAD_PROGRESS`**ë¥¼ ì‚¬ìš©í•˜ë©´ ì„¸ì…˜ ë‚´ì˜ ë°ì´í„°ë¥¼ ì œì–´í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì„¸ì…˜ íŒŒì¼ì„ í¬í•¨ì‹œí‚¤ë©´ ì œì–´ ê°€ëŠ¥í•œ ë¶€ë¶„(ì˜ˆ: PHP ì‰˜ ì½”ë“œ)ì„ í¬í•¨ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="info" %}
ì¸í„°ë„·ì˜ ëŒ€ë¶€ë¶„ì˜ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” ë””ë²„ê¹… ëª©ì ìœ¼ë¡œ `session.upload_progress.cleanup`ì„ `Off`ë¡œ ì„¤ì •í•˜ë„ë¡ ê¶Œì¥í•˜ì§€ë§Œ, PHPì˜ ê¸°ë³¸ `session.upload_progress.cleanup`ì€ ì—¬ì „íˆ `On`ì…ë‹ˆë‹¤. ì¦‰, ì„¸ì…˜ì˜ ì—…ë¡œë“œ ì§„í–‰ ìƒí™©ì€ ê°€ëŠ¥í•œ í•œ ë¹¨ë¦¬ ì •ë¦¬ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ëŠ” **ê²½ìŸ ì¡°ê±´**ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### CTF

ì´ ê¸°ë²•ì´ ì„¤ëª…ëœ [**ì›ë˜ì˜ CTF**](https://blog.orange.tw/2018/10/)ì—ì„œëŠ” ê²½ìŸ ì¡°ê±´ì„ ì•…ìš©í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•Šì•˜ìœ¼ë©°, ë¡œë“œëœ ì½˜í…ì¸ ëŠ” `@<?php` ë¬¸ìì—´ë¡œ ì‹œì‘í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

`session.upload_progress.prefix`ì˜ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì¸í•´ **ì„¸ì…˜ íŒŒì¼ì€ `upload_progress_`ë¼ëŠ” ê·€ì°®ì€ ì ‘ë‘ì‚¬ë¡œ ì‹œì‘**ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `upload_progress_controlledcontentbyattacker`ì™€ ê°™ìŠµë‹ˆë‹¤.

ì´ˆê¸° ì ‘ë‘ì‚¬ë¥¼ **ì œê±°í•˜ëŠ” íŠ¸ë¦­**ì€ í˜ì´ë¡œë“œë¥¼ **3ë²ˆ base64ë¡œ ì¸ì½”ë”©**í•œ ë‹¤ìŒ `convert.base64-decode` í•„í„°ë¥¼ í†µí•´ ë””ì½”ë”©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” **base64 ë””ì½”ë”© ì‹œ PHPê°€ ì´ìƒí•œ ë¬¸ìë¥¼ ì œê±°**í•˜ê¸° ë•Œë¬¸ì—, 3ë²ˆë§Œ ìˆ˜í–‰í•˜ë©´ ê³µê²©ìê°€ **ë³´ë‚¸ í˜ì´ë¡œë“œë§Œ ë‚¨ê²Œ**ë©ë‹ˆë‹¤(ê·¸ë¦¬ê³  ê³µê²©ìëŠ” ì´ˆê¸° ë¶€ë¶„ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤).

ì›ë˜ì˜ writeupì—ì„œ ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”. [https://blog.orange.tw/2018/10/](https://blog.orange.tw/2018/10/) ë° ìµœì¢… exploit [https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py](https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py)\
ë‹¤ë¥¸ writeupì€ [https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **ìì‹ ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
