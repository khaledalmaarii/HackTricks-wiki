# YÃ¼kseltme BaÅŸlÄ±ÄŸÄ± KaÃ§akÃ§Ä±lÄ±ÄŸÄ±

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana dÃ¶nÃ¼ÅŸÃ¼n</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na(https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi** **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

### H2C KaÃ§akÃ§Ä±lÄ±ÄŸÄ± <a href="#http2-over-cleartext-h2c" id="http2-over-cleartext-h2c"></a>

#### AÃ§Ä±k Metin Ãœzerinden HTTP2 (H2C) <a href="#http2-over-cleartext-h2c" id="http2-over-cleartext-h2c"></a>

H2C veya **aÃ§Ä±k metin Ã¼zerinden http2**, standart bir HTTP **baÄŸlantÄ±sÄ±nÄ± kalÄ±cÄ± bir baÄŸlantÄ±ya yÃ¼kselterek** geÃ§ici HTTP baÄŸlantÄ±larÄ±nÄ±n normundan sapar. Bu yÃ¼kseltilmiÅŸ baÄŸlantÄ±, sÃ¼rekli iletiÅŸim iÃ§in http2 ikili protokolÃ¼nÃ¼ kullanÄ±r, dÃ¼z metin HTTP'nin tek istek doÄŸasÄ±nÄ±n aksine.

KaÃ§akÃ§Ä±lÄ±k sorununun Ã¶zÃ¼, bir **ters proxy**'nin kullanÄ±mÄ±yla ortaya Ã§Ä±kar. Normalde, ters proxy HTTP isteklerini iÅŸler ve arka uca ileterek, ardÄ±ndan arka uÃ§tan gelen yanÄ±tÄ± dÃ¶ndÃ¼rÃ¼r. Ancak, bir HTTP isteÄŸinde `Connection: Upgrade` baÅŸlÄ±ÄŸÄ± bulunduÄŸunda (genellikle websocket baÄŸlantÄ±larÄ±yla gÃ¶rÃ¼lÃ¼r), ters **proxy istemci ve sunucu arasÄ±nda kalÄ±cÄ± bir baÄŸlantÄ±** sÃ¼rdÃ¼rÃ¼r, belirli protokoller tarafÄ±ndan gereken sÃ¼rekli deÄŸiÅŸimi kolaylaÅŸtÄ±rÄ±r. H2C baÄŸlantÄ±larÄ± iÃ§in, RFC'ye uyum, Ã¼Ã§ belirli baÅŸlÄ±ÄŸÄ±n varlÄ±ÄŸÄ±nÄ± gerektirir:
```
Upgrade: h2c
HTTP2-Settings: AAMAAABkAARAAAAAAAIAAAAA
Connection: Upgrade, HTTP2-Settings
```
### Zafiyetli Proxy'ler <a href="#exploitation" id="exploitation"></a>

Zafiyet, bir baÄŸlantÄ±yÄ± yÃ¼kselttikten sonra ters vekilin, yÃ¶nlendirme iÅŸleminin baÄŸlantÄ± kurulduktan sonra tamamlandÄ±ÄŸÄ±nÄ± varsayarak bireysel istekleri yÃ¶netmeyi durdurmasÄ± durumunda ortaya Ã§Ä±kar. H2C Smuggling'in sÃ¶mÃ¼rÃ¼lmesi, baÅŸarÄ±lÄ± bir H2C baÄŸlantÄ±sÄ± baÅŸlatÄ±ldÄ±ÄŸÄ±nda, istek iÅŸleme sÄ±rasÄ±nda uygulanan ters vekil kurallarÄ±nÄ± atlamayÄ± saÄŸlar, Ã¶rneÄŸin yol tabanlÄ± yÃ¶nlendirme, kimlik doÄŸrulama ve WAF iÅŸleme.

Zafiyetli Proxy'lerin `Upgrade` ve bazen `Connection` baÅŸlÄ±klarÄ±nÄ± nasÄ±l iÅŸlediÄŸine baÄŸlÄ±dÄ±r. AÅŸaÄŸÄ±daki proxy'ler bu baÅŸlÄ±klarÄ± varsayÄ±lan olarak iletir ve bÃ¶ylece H2C smuggling'i varsayÄ±lan olarak etkinleÅŸtirir:

- HAProxy
- Traefik
- Nuster

Bununla birlikte, aÅŸaÄŸÄ±daki hizmetler bu baÅŸlÄ±klarÄ± varsayÄ±lan olarak iletmez. Ancak, gÃ¼vensiz bir ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸ olabilirler ve `Upgrade` ve `Connection` baÅŸlÄ±klarÄ±nÄ± filtresiz olarak iletmeye izin verebilirler:

- AWS ALB/CLB
- NGINX
- Apache
- Squid
- Varnish
- Kong
- Envoy
- Apache Traffic Server

### SÃ¶mÃ¼rÃ¼ <a href="#exploitation" id="exploitation"></a>

Ã–nemli olan ÅŸudur ki, uyumlu bir H2C baÄŸlantÄ± yÃ¼kseltmesi iÃ§in gereken baÅŸlÄ±klarÄ± varsayÄ±lan olarak ileten tÃ¼m sunucularÄ±n olmadÄ±ÄŸÄ±dÄ±r. Bu nedenle, AWS ALB/CLB, NGINX ve Apache Traffic Server gibi sunucular, H2C baÄŸlantÄ±larÄ±nÄ± doÄŸal olarak engeller. Bununla birlikte, bazÄ± arka uÃ§larÄ±n standartlara uymayabileceÄŸi iÃ§in, uyumsuz `Connection: Upgrade` varyantÄ± ile test etmek faydalÄ± olabilir.

{% hint style="danger" %}
`proxy_pass` URL'sinde belirtilen belirli **yol** (Ã¶rneÄŸin, `http://backend:9999/socket.io`) varsayÄ±lan olarak `http://backend:9999` olarak belirlenir. Bu, bu tekniÄŸi kullanarak bu dahili uÃ§ noktadaki herhangi bir yolla etkileÅŸime izin verir. SonuÃ§ olarak, `proxy_pass` URL'sinde bir yol belirtmek eriÅŸimi kÄ±sÄ±tlamaz.
{% endhint %}

[**BishopFox tarafÄ±ndan h2csmuggler**](https://github.com/BishopFox/h2csmuggler) ve [**assetnote tarafÄ±ndan h2csmuggler**](https://github.com/assetnote/h2csmuggler) araÃ§larÄ±, bir H2C baÄŸlantÄ±sÄ± kurarak **proxy tarafÄ±ndan uygulanan korumalarÄ± atlamaya** yÃ¶nelik giriÅŸimleri kolaylaÅŸtÄ±rÄ±r ve bu sayede proxy tarafÄ±ndan korunan kaynaklara eriÅŸimi saÄŸlar.

Bu zafiyetle ilgili daha fazla bilgi iÃ§in Ã¶zellikle NGINX hakkÄ±nda [**bu detaylÄ± kaynaÄŸa**](../network-services-pentesting/pentesting-web/nginx.md#proxy\_set\_header-upgrade-and-connection) baÅŸvurun.
